[
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$.\u5f00\u59cb\u65f6\u6709 $n$ \u4e2a\u96c6\u5408 $\\{a_1\\},\\{a_2\\},\\dots,\\{a_{n-1}\\},\\{a_n\\}$.\u6bcf\u6b21\u53ef\u4ee5\u5408\u5e76\u4e24\u4e2a\u96c6\u5408 $S,T$,\u5176\u4e2d $S,T$ \u8981\u6ee1\u8db3 $S$ \u96c6\u5408\u4e2d\u7684\u6700\u5927\u503c\u5c0f\u4e8e $T$ \u96c6\u5408\u4e2d\u7684\u6700\u5c0f\u503c.\u63a5\u4e0b\u6765\u7ed9\u51fa $q$ \u6b21\u67e5\u8be2,\u6bcf\u6b21\u67e5\u8be2\u7ed9\u51fa $l_i,r_i$,\u9700\u8981\u5728 $2.2\\times10^6$ \u64cd\u4f5c\u5185\u5236\u4f5c\u51fa\u6240\u6709\u7684\u96c6\u5408 $\\{a_{l_i},a_{l_i+1},\\dots,a_{r_i-1},a_{r_i}\\}$.\u9700\u8981\u7ed9\u51fa\u64cd\u4f5c\u4ee5\u53ca\u6bcf\u4e2a\u67e5\u8be2\u7684\u96c6\u5408\u7684\u7f16\u53f7.\n\n# \u5206\u6790\n\n\u8003\u8651\u5408\u5e76\u4e24\u4e2a\u96c6\u5408\u6761\u4ef6\u4e3a\u4e00\u96c6\u5408\u7684\u6700\u5927\u503c\u5c0f\u4e8e\u53e6\u4e00\u96c6\u5408\u7684\u6700\u5c0f\u503c.\u67e5\u8be2\u7684\u662f\u53d6\u836f\u7ec4\u5408\u51fa\u5f00\u59cb\u7ed9\u51fa\u7684\u5e8f\u5217\u7684\u4e00\u4e2a\u5b50\u4e32.\u6240\u4ee5\u6700\u7b80\u5355\u7c97\u66b4\u7684\u65b9\u6cd5\u5c31\u662f\u627e\u5230\u5b50\u4e32\u5185\u7684\u6570\u6392\u5e8f\u540e\u9010\u4e2a\u5408\u5e76,\u4f46\u8fd9\u663e\u7136\u662f\u4e0d\u884c\u7684.\u4f46\u8fd9\u4e5f\u63d0\u793a\u4e86\u5355\u6b21\u67e5\u8be2\u7684\u64cd\u4f5c\u4e0a\u9650\u5fc5\u7136\u662f $n$.\u6240\u4ee5\u9700\u8981\u8003\u8651\u5982\u4f55\u5229\u7528\u4e00\u4e9b\u4ee5\u524d\u5229\u7528\u8fc7\u7684\u96c6\u5408.\u8003\u8651\u5f00\u4e00\u4e2a\u6743\u503c\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4,\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u4e0a\u9700\u8981\u7ef4\u62a4\u5f53\u524d\u8282\u70b9\u5185\u7684\u6570\u5728\u6570\u5217\u4e0a\u6240\u6709\u51fa\u73b0\u7684\u4f4d\u7f6e.\n\n\u90a3\u4e48\u66b4\u529b\u67e5\u8be2\u7684\u4ee3\u7801\u5c31\u5982\u4e0b:\n\n```cpp\nint Query(int now_left,int now_right,int now=1)\n{\n    //num \u4e2d\u8bb0\u5f55\u7684\u662f\u5f53\u524d\u8303\u56f4\u5185\u7684\u6570\u7684\u6240\u6709\u51fa\u73b0\u4f4d\u7f6e(\u5355\u8c03\u9012\u589e)\n\tint left=lower_bound(sgt[now].num.begin(),sgt[now].num.end(),now_left)-sgt[now].num.begin();\n\tint right=upper_bound(sgt[now].num.begin(),sgt[now].num.end(),now_right)-sgt[now].num.begin()-1;\n\t//\u627e\u5230\u5f53\u524d\u67e5\u8be2\u7684\u533a\u95f4\u4e2d\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u7684\u6570\u6700\u5de6\u8fb9\u548c\u6700\u53f3\u8fb9\u7684\u4f4d\u7f6e\n    if(right<left)//\u5982\u679c right<left \u663e\u7136\u4e0d\u5b58\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u7684\u6570\n\t{\n\t\treturn 0;\n\t}\n\tif(left==right)//\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u6570\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u7528\u5f00\u59cb\u7ed9\u51fa\u7684\u96c6\u5408\n\t{\n\t\treturn sgt[now].num[left];\n\t}\n\tint lson=Query(NOW,LSON),rson=Query(NOW,RSON);//\u67e5\u627e\u5b50\u6811\n\tif(!lson||!rson)//\u5982\u679c\u5de6\u5b50\u6811\u6216\u53f3\u5b50\u6811\u4e3a\u7a7a\u90a3\u4e48\u5f53\u524d\u5c42\u5c31\u53ef\u4ee5\u4e0d\u7528\u5408\u5e76\n\t{\n\t\treturn lson|rson;\n\t}\n    //use \u8868\u793a\u64cd\u4f5c\n\tuse[++cnt]=Range(lson,rson);//\u5426\u5219\u9700\u8981\u5408\u5e76\n\treturn cnt;\n}\n```\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5230\u5355\u6b21\u67e5\u8be2\u64cd\u4f5c\u6570\u5c0f\u4e8e $n$ \u4e86.\n\n\u8003\u8651\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a\u4e1c\u897f.\n\n\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u7684\u8282\u70b9\u53ea\u4f1a\u6709 $len^2$($len$ \u662f\u6240\u5bf9\u5e94\u7684\u503c\u57df\u7684\u8303\u56f4)\u79cd**\u672c\u8d28**\u4e0d\u540c\u7684\u67e5\u8be2(\u5373\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684 `left,right` \u7684\u4e0d\u540c\u79cd\u7c7b).\u90a3\u4e48\u53ef\u4ee5\u5c06 `left,right` \u6254\u5230 map \u4e2d,\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u6240\u4ea7\u751f\u7684\u64cd\u4f5c\u4e0a\u9650\u5c31\u662f $len^2$ \u7ea7\u522b\u4e86.\n\n\u4ee3\u7801\u5982\u4e0b:\n\n```cpp\nint Query(int now_left,int now_right,int now=1)\n{\n\tint left=lower_bound(sgt[now].num.begin(),sgt[now].num.end(),now_left)-sgt[now].num.begin();\n\tint right=upper_bound(sgt[now].num.begin(),sgt[now].num.end(),now_right)-sgt[now].num.begin()-1;\n\tif(right<left)\n\t{\n\t\treturn 0;\n\t}\n\tif(left==right)\n\t{\n\t\treturn sgt[now].num[left];\n\t}\n\tint p=sgt[now].Hash[make_pair(left,right)];\n\tif(p)//\u5982\u679c\u5b58\u5728\u8fc7\u5c31\u76f4\u63a5\u8fd4\u56de\n\t{\n\t\treturn p;\n\t}\n\tint lson=Query(NOW,LSON),rson=Query(NOW,RSON);\n\tif(!lson||!rson)\n\t{\n\t\treturn sgt[now].Hash[make_pair(left,right)]=lson|rson;//\u6bcf\u6b21\u67e5\u8be2\u5b8c\u5c31\u6254\u5230 map \u91cc\n\t}\n\tuse[++cnt]=Range(lson,rson);\n\treturn sgt[now].Hash[make_pair(left,right)]=cnt;\n}\n```\n\n\u7136\u540e\u5c31\u4f1a\u60ca\u8bb6\u7684\u53d1\u73b0\u53ef\u4ee5\u8fc7\u4e86.\n\n\u590d\u6742\u5ea6\u5206\u6790(\u611f\u8c22 [$\\color{black}{\\sf A}\\color{red}{\\sf{utumnKite}}$]( https://www.luogu.com.cn/user/20561 ) \u63d0\u4f9b\u8bc1\u660e\u601d\u8def):\n\n\u8bb0 $N=\\lceil\\log_2n\\rceil$,$Q=\\lceil\\log_2q\\rceil$.\n\n\u90a3\u4e48\u5bf9\u4e8e\u6df1\u5ea6\u5927\u4e8e $\\frac{Q}{2}$ \u5c42\u7684\u64cd\u4f5c\u6570\u4e0a\u9650\u4e3a(\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u7684 $len^2$ \u79cd\u60c5\u51b5\u90fd\u8dd1\u6ee1)\n$$\n\\sum_{i=1}^{\\frac{Q}{2}}(2^{N-i}\\cdot\\frac{2^{i^2}}{2})=\\sum_{i=1}^{\\frac{Q}{2}}2^{N+i-1}\\leq 2^{N+\\frac{Q}{2}}\n$$\n\u5bf9\u4e8e\u6df1\u5ea6\u5c0f\u4e8e\u7b49\u4e8e $\\frac{Q}{2}$ \u5c42\u7684\u64cd\u4f5c\u6570\u4e0a\u9650\u4e3a(\u6bcf\u6b21\u64cd\u4f5c\u90fd\u5c06\u6240\u6709\u8282\u70b9\u8dd1\u5230)\n$$\nq\\times2^{N-\\frac{Q}{2}}\\leq 2^{N+\\frac{Q}{2}}\n$$\n\u6240\u4ee5\u603b\u64cd\u4f5c\u6570\u4e0a\u9650\u4e3a $2^{N+\\frac{Q}{2}+1}$ \u4e0e $n\\sqrt{q}$ \u540c\u9636.\n\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REP(i,first,last) for(int i=first;i<=last;++i)\n#define DOW(i,first,last) for(int i=first;i>=last;--i)\nusing namespace std;\nconst int MAXN=1e5+5;\nconst int MAXQ=2e6+2e5+5;\nint n,q;\nint arr[MAXN];\nint app[MAXN];\nstruct Range//\u8bb0\u5f55\u64cd\u4f5c\n{\n\tint left,right;\n\tRange(int l=0,int r=0)\n\t{\n\t\tleft=l;\n\t\tright=r;\n\t}\n}use[MAXQ];\nint answer[MAXN];//\u8bb0\u5f55\u7b54\u6848\nint cnt=0;\nstruct SegmentTree\n{\n\tvector<int>num;\n\tmap<pair<int,int>,int>Hash;\n}sgt[MAXN*4];\n#define LSON (now<<1)\n#define RSON (now<<1|1)\n#define MIDDLE ((left+right)>>1)\n#define LEFT LSON,left,MIDDLE\n#define RIGHT RSON,MIDDLE+1,right\n#define NOW now_left,now_right\nvoid Build(int now=1,int left=1,int right=n)//\u5efa\u6811\u90e8\u5206\n{\n\tREP(i,left,right)//\u5c06\u5728\u5f53\u524d\u8303\u56f4\u5185\u7684\u6570\u6254\u5230\u8282\u70b9\u91cc\u9762\n\t{\n\t\tsgt[now].num.push_back(app[i]);\n\t}\n\tsort(sgt[now].num.begin(),sgt[now].num.end());//\u6309\u51fa\u73b0\u4f4d\u7f6e\u6392\u5e8f\n\tif(left==right)\n\t{\n\t\treturn;\n\t}\n\tBuild(LEFT);\n\tBuild(RIGHT);\n}\nint Query(int now_left,int now_right,int now=1)//\u540c\u4e0a\u7684\u8bb0\u5fc6\u5316\u67e5\u8be2\n{\n\tint left=lower_bound(sgt[now].num.begin(),sgt[now].num.end(),now_left)-sgt[now].num.begin();\n\tint right=upper_bound(sgt[now].num.begin(),sgt[now].num.end(),now_right)-sgt[now].num.begin()-1;\n\tif(right<left)\n\t{\n\t\treturn 0;\n\t}\n\tif(left==right)\n\t{\n\t\treturn sgt[now].num[left];\n\t}\n\tint p=sgt[now].Hash[make_pair(left,right)];\n\tif(p)\n\t{\n\t\treturn p;\n\t}\n\tint lson=Query(NOW,LSON),rson=Query(NOW,RSON);\n\tif(!lson||!rson)\n\t{\n\t\treturn sgt[now].Hash[make_pair(left,right)]=lson|rson;\n\t}\n\tuse[++cnt]=Range(lson,rson);\n\treturn sgt[now].Hash[make_pair(left,right)]=cnt;\n}\n#undef LSON\n#undef RSON\n#undef MIDDLE\n#undef LEFT\n#undef RIGHT\n#undef NOW\nint main()\n{\n\tscanf(\"%d%d\",&n,&q);\n\tcnt=n;\n\tREP(i,1,n)\n\t{\n\t\tscanf(\"%d\",&arr[i]);\n\t\tapp[arr[i]]=i;\n\t}\n\tBuild();\n\tint left,right;\n\tREP(i,1,q)\n\t{\n\t\tscanf(\"%d%d\",&left,&right);\n\t\tanswer[i]=Query(left,right);\n\t}\n\tprintf(\"%d\\n\",cnt);\n\tREP(i,n+1,cnt)\n\t{\n\t\tprintf(\"%d %d\\n\",use[i].left,use[i].right);\n\t}\n\tREP(i,1,q)\n\t{\n\t\tprintf(\"%d \",answer[i]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1595889452,
        "uid": 86625,
        "name": "Limit",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1375H \u3010Set Merging\u3011"
    },
    {
        "content": "#### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217 $a$\uff0c\u521d\u59cb\u7684\u65f6\u5019\u5b58\u5728 $n$ \u4e2a\u96c6\u5408\uff0c\u7b2c $i$ \u4e2a\u96c6\u5408\u4e3a $\\{a_i\\}$\u3002\u5982\u679c\u4e24\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u96c6\u5408 $X,Y$ \u6ee1\u8db3 $X_{max}<Y_{min}$\uff0c\u5219\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u96c6\u5408 $S=X\\cup Y$\uff0c\u79f0\u8fd9\u4e3a\u4e00\u6b21\u5408\u5e76\u64cd\u4f5c\u3002\n\n\u4f60\u53ef\u4ee5\u8fdb\u884c\u82e5\u5e72\u6b21\u5408\u5e76\uff0c\u4f46\u662f\u9700\u8981\u4fdd\u8bc1\u603b\u7684\u96c6\u5408\u6570\u91cf\u4e0d\u8d85\u8fc7 $2.2\\times 10^6$\u3002\n\n\u73b0\u5728\u6709 $q$ \u4e2a\u9650\u5236\uff0c\u6bcf\u4e2a\u9650\u5236\u5305\u542b\u4e00\u6bb5\u533a\u95f4 $[l,r]$\uff0c\u9700\u8981\u4fdd\u8bc1\u64cd\u4f5c\u5b8c\u540e\u7684\u6240\u6709\u96c6\u5408\u4e2d\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a\u96c6\u5408\u7b49\u4e8e $\\{a_i|i\\in[l,r]\\}$\u3002\n\n$1\\leq n\\leq 2^{12},1\\leq q\\leq 2^{16}$\u3002\n\n#### \u9898\u89e3\n\n\u7528\u503c\u57df\u533a\u95f4\u53bb\u62df\u5408\u5e8f\u5217\u7684\u533a\u95f4\uff0c\u64cd\u4f5c\u6b21\u6570\u9650\u5236\u53c8\u662f $2n\\sqrt{q}$\uff0c\u5c31\u5dee\u628a\u503c\u57df\u5206\u5757\u5199\u5728\u8138\u4e0a\u4e86\u3002\n\n\u6309\u503c\u57df\u5206\u5757\u6700\u91cd\u8981\u7684\u7ed3\u8bba\u5c31\u662f\uff0c\u5c06\u4e00\u4e2a\u5e8f\u5217\u6309\u67d0\u4e2a\u503c\u57df\u8303\u56f4\u5212\u5206\u6210\u82e5\u5e72\u5b50\u5e8f\u5217\u4e4b\u540e\uff0c\u6bcf\u4e2a\u8fde\u7eed\u533a\u95f4\u90fd\u53ef\u4ee5\u8868\u793a\u6210\u5212\u5206\u6210\u7684\u5b50\u5e8f\u5217\u4e2d\u7684\u8fde\u7eed\u533a\u95f4\u7684\u5e76\u3002\n\n\u5c06\u539f\u5e8f\u5217\u5bf9 $B$ \u505a\u503c\u57df\u5206\u5757\uff0c\u8fd9\u6837\u6bcf\u4e2a\u8be2\u95ee\u7684\u533a\u95f4 $[l,r]$ \u5c31\u53ef\u4ee5\u5bf9\u5e94\u5230\u6bcf\u5757\u4e2d\u7684\u4e00\u4e2a\u8fde\u7eed\u5b50\u533a\u95f4\uff0c\u800c\u4e0d\u540c\u5757\u4e4b\u95f4\u7684\u503c\u57df\u663e\u7136\u662f\u4e0d\u4ea4\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u5408\u5e76\uff0c\u8fd9\u90e8\u5206\u7684\u5408\u5e76\u6b21\u6570\u4e0d\u8d85\u8fc7 $\\frac{nq}{B}$\u3002\n\n\u63a5\u4e0b\u6765\u6c42\u6bcf\u4e2a\u5757\u5185\u7684\u6240\u6709\u8fde\u7eed\u5b50\u533a\u95f4\uff0c\u8003\u8651\u6309\u503c\u57df\u5206\u6cbb\u3002\u5f53\u524d\u5e8f\u5217\u7684\u6bcf\u4e2a\u8fde\u7eed\u5b50\u533a\u95f4\u53ef\u4ee5\u8868\u793a\u6210\u5212\u5206\u6210\u7684\u4e24\u4e2a\u503c\u57df\u8fde\u7eed\u7684\u5b50\u5e8f\u5217\u4e2d\u7684\u8fde\u7eed\u5b50\u533a\u95f4\u7684\u5e76\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5411\u4e0b\u5206\u6cbb\u518d\u5408\u5e76\u4e86\u3002\n\n\u5408\u5e76\u6b21\u6570\u4e3a $f(n)=\\frac{n^2}{2}+2f(\\frac{n}{2})=n^2$\uff0c\u56e0\u6b64\u8fd9\u90e8\u5206\u7684\u603b\u5408\u5e76\u6b21\u6570\u4e0d\u8d85\u8fc7 $nB$\u3002\n\n\u603b\u7684\u64cd\u4f5c\u6b21\u6570\u5373\u4e3a $n(\\frac{q}{B}+B)$\uff0c\u663e\u7136 $B$ \u53d6 $\\sqrt{q}$ \u7684\u65f6\u5019\u6709\u6700\u5c0f\u503c $2n\\sqrt{q}$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define rz resize\n#define I inline int\n#define V inline void\n#define VI vector<int>\n#define FOR(i,a,b) for(int i=a;i<=b;i++)\nconst int N=1<<12,M=1<<16,B=1<<8,K=1<<22;\nint n,m,tot,a[N],c[K],d[K],pos[N],ans[M];\nI merge(int x,int y){\n\tif(!x||!y)return!x*y+!y*x;\n\treturn c[tot]=x,d[tot]=y,++tot;\n}\nstruct seg{\n\tVI val;vector<VI>id;\n\tV init(int x){val.rz(x),id.rz(x);FOR(i,0,x-1)id[i].rz(x-i);}\n\tseg(int x=-1){if(~x)init(1),val[0]=pos[x],id[0][0]=pos[x]+1;}\n\tI ask(int l,int r)const{\n\t\tif(r<val.front()||l>val.back())return 0;\n\t\tl=lower_bound(val.begin(),val.end(),l)-val.begin();\n\t\tr=upper_bound(val.begin(),val.end(),r)-val.begin()-1;\n\t\treturn l>r?0:id[l][r-l];\n\t}\n\tseg update(const seg&x,const seg&y){\n\t\tinit(x.val.size()+y.val.size());\n\t\tmerge(x.val.begin(),x.val.end(),y.val.begin(),y.val.end(),val.begin());\n\t\tFOR(i,0,val.size()-1)FOR(j,i,val.size()-1)\n\t\t\tid[i][j-i]=merge(x.ask(val[i],val[j]),y.ask(val[i],val[j]));\n\t\treturn*this;\n\t}\n}t[N/B];\nV input(){\n\tscanf(\"%d%d\",&n,&m),tot=n--;\n\tFOR(i,0,n)scanf(\"%d\",a+i),a[i]--;\n}\nseg solve(int L,int R){\n\tif(L==R)return(L);\n\tint mid=L+R>>1;seg out;\n\treturn out.update(solve(L,mid),solve(mid+1,R));\n}\nV init(){\n\tFOR(i,0,n)pos[a[i]]=i;\n\tFOR(i,0,n/B)t[i]=solve(i*B,min(n,i*B+B-1));\n}\nV work(){\n\tint l,r;\n\tFOR(i,0,m-1){\n\t\tscanf(\"%d%d\",&l,&r),l--,r--;\n\t\tFOR(j,0,n/B)ans[i]=merge(ans[i],t[j].ask(l,r));\n\t}\n\tcout<<tot<<'\\n';\n\tFOR(i,n+1,tot-1)cout<<c[i]<<' '<<d[i]<<'\\n';\n\tFOR(i,0,m-1)cout<<ans[i]<<' ';\n}\nint main(){\n\tinput();\n\tinit();\n\twork();\n\treturn 0;\n}\n```",
        "postTime": 1594275126,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1375H \u3010Set Merging\u3011"
    },
    {
        "content": "### CF1375H Set Merging\n\n\u53d1\u73b0$n\\sqrt{q} \\approx 2.2\\times 10^6$\uff0c\u6211\u4eec\u8003\u8651\u5f80\u5206\u5757\u7684\u89d2\u5ea6\u60f3\u3002~~\u4e0d\u6127\u662fYnoi~~\n\n\u6211\u4eec\u5c06\u503c\u57df$[1,n]$\u5206\u5757\u3002\u8bbe\u5757\u5927\u5c0f\u4e3a$S$\u3002\u53d1\u73b0\u4e00\u4e2a\u5f88\u4f18\u79c0\u7684\u6027\u8d28\uff1a\u5982\u679c\u6211\u4eec\u628a$[1,n]$\u6309\u503c\u57df\u5212\u5206\u6210$\\frac{n}{S}$\u4e2a\u5b50\u5e8f\u5217\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee$[l,r]$\uff0c\u6211\u4eec\u4e5f\u5c06\u5176\u5212\u5206\u4e3a$\\frac{n}{S}$\u6bb5\uff0c\u90a3\u4e48\u6bcf\u4e00\u6bb5\u90fd\u662f\u5e8f\u5217$[1,n]$\u5212\u5206\u51fa\u6765\u7684\u5bf9\u5e94\u7684\u90a3\u4e2a\u6bb5\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\u3002\u6bd4\u5982\u539f\u5e8f\u5217\u4e3a$5,3,1,8,9,7,2,4,6$\uff0c\u6211\u4eec\u5c06\u5176\u5212\u5206\u4e3a{$3,1,2$}\uff0c{$5,4,6$}\uff0c{$8,9,7$}\u4e09\u6bb5\u3002\u90a3\u4e48\u5bf9\u4e8e\u8be2\u95ee$[2,6]$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u5176\u5212\u5206\u4e3a{$3,1$}\uff0c{}\uff0c{$8,9,7$}\u4e09\u6bb5\u3002\u8fd9\u4e09\u6bb5\u90fd\u662f\u539f\u5e8f\u5217\u5206\u51fa\u6765\u7684\u4e09\u4e2a\u5e8f\u5217\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\u3002\u4e00\u4e2a\u5757\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\u4e2a\u6570\u662f$\\frac{S\\times (S-1)}{2}$\uff0c\u90a3\u4e48\u603b\u4e2a\u6570\u5c31\u662f$n\\sqrt{n}$\u7684\u3002\u6211\u4eec\u5c06\u8fd9\u4e9b\u8fde\u7eed\u5b50\u5e8f\u5217\u5168\u90fd\u6c42\u51fa\u6765\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u76f4\u63a5merge\u5b83\u5bf9\u5e94\u7684\u8fd9$\\frac{n}{S}$\u4e2a\u8fde\u7eed\u5b50\u5e8f\u5217\u5c31\u884c\u4e86\u3002\n\n\u90a3\u4e48\u5982\u4f55\u6c42\u51fa\u4e00\u4e2a\u5757\u5185\u7684\u6240\u6709\u8fde\u7eed\u5b50\u5e8f\u5217\u5462\uff1f\u6211\u4eec\u8003\u8651\u4ee5\u6743\u503c\u5927\u5c0f\u6765\u8fdb\u884c\u5206\u6cbb\u3002\u5047\u8bbe\u6211\u4eec\u8981\u6c42\u51fa\u5e8f\u5217$5,3,1,8,9,7,2,4,6$\u7684\u6240\u6709\u8fde\u7eed\u5b50\u5e8f\u5217\uff0c\u5f53\u524d\u5df2\u7ecf\u6c42\u51fa\u4e86$5,3,1,2,4$\u548c$8,9,7,6$\u7684\u6240\u6709\u8fde\u7eed\u5b50\u5e8f\u5217\uff0c\u5408\u5e76\u65f6\uff0c\u7531\u4e8e\u8fd9\u4e24\u4e2a\u5e8f\u5217\u4e0e\u539f\u5e8f\u5217\u7684\u5173\u7cfb\u4f9d\u7136\u662f\u5b50\u5e8f\u5217\u7684\u5173\u7cfb\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ea\u9700\u8981\u7c7b\u4f3c\u5f52\u5e76\u6392\u5e8f\u90a3\u6837\u505a\u5c31\u884c\u3002\u53ea\u4e0d\u8fc7\u56e0\u4e3a\u8981\u6c42\u51fa\u6240\u6709\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6574\u4e2a\u5e8f\u5217\u7684\u5de6\u53f3\u7aef\u70b9\uff0c\u628a\u4e24\u4e2a\u5e8f\u5217\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u4fe1\u606f\u6254\u8fdb\u4e24\u4e2avector\u91cc\uff0c\u67e5\u4e00\u4e0b\u5206\u522b\u7684\u524d\u9a71\u548c\u540e\u7ee7\uff0c\u7136\u540e\u76f4\u63a5\u5408\u5e76\u5373\u53ef\u3002\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u8981\u5f97\u5230$1,8,9,7,2$\u8fd9\u4e00\u6bb5\uff0c\u6211\u4eec\u5c31\u5206\u522b\u627e\u51fa$1,2$\u548c$8,9,7$\u8fd9\u4e24\u4e2a\u5b50\u5e8f\u5217\uff0c\u7136\u540e\u76f4\u63a5merge\u3002\n\n$cnt=O(n\\sqrt{q})$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u662f$O((n+q)\\sqrt{n})$\u3002",
        "postTime": 1595246696,
        "uid": 93453,
        "name": "Purple_wzy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1375H \u3010Set Merging\u3011"
    },
    {
        "content": "[\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u8d85\u723d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/dysyn1314/p/14364992.html)\n\n# CF1375H Set Merging\n\n\u6734\u7d20\u7684\u505a\u6cd5\u662f\uff0c\u628a\u533a\u95f4 $[l_i, r_i]$ \u91cc\u7684\u6570\u503c\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u4f9d\u6b21\u5408\u5e76\u3002\u5171\u9700\u8981 $\\mathcal{O}(qn)$ \u6b21\u5408\u5e76\uff0c\u592a\u591a\u4e86\u3002\n\n\u4f18\u5316\u4e0a\u8ff0\u505a\u6cd5\uff0c\u8003\u8651\u5bf9**\u503c\u57df**\u5206\u5757\u3002\u8bbe\u5757\u7684\u5927\u5c0f\u4e3a $B$\uff0c\u5206\u51fa\u4e86 $\\lceil\\frac{n}{B}\\rceil$ \u4e2a\u5757\u3002\u6211\u4eec\u5728\u6bcf\u4e00\u5757\u5185\uff0c\u628a\u5143\u7d20\u6309\u7167**\u539f\u5e8f\u5217\u91cc\u7684\u51fa\u73b0\u4f4d\u7f6e**\u6392\u5e8f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a\u5757\u90fd\u662f\u539f\u5e8f\u5217\u7684\u4e00\u4e2a**\u5b50\u5e8f\u5217**\u3002\n\n\u8003\u8651\u67e5\u8be2 $[l_i, r_i]$ \u65f6\uff0c\u6211\u4eec\u4ece\u5c0f\u5230\u5927\u904d\u5386\u6240\u6709\u5757\uff0c\u628a\u6bcf\u4e00\u5757\u91cc\u4f4d\u7f6e\u5728 $[l_i, r_i]$ \u5185\u7684\u5143\u7d20\u63d0\u53d6\u51fa\u6765\uff0c\u663e\u7136\u6bcf\u4e00\u5757\u91cc\u63d0\u53d6\u51fa\u7684\u4e00\u5b9a\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u5143\u7d20\u3002\u5047\u8bbe\u5b83\u4eec\u7684\u96c6\u5408\u662f\u5df2\u77e5\u7684\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u628a\u6240\u6709\u5757\u5bf9\u5e94\u7684\u96c6\u5408\u4f9d\u6b21\u5408\u5e76\u5373\u53ef\u3002\u5355\u6b21\u8be2\u95ee\u9700\u8981 $\\mathcal{O}(\\frac{n}{B})$ \u6b21\u5408\u5e76\u64cd\u4f5c\u3002\u5728\u6bcf\u4e2a\u5757\u91cc\u63d0\u53d6\u533a\u95f4\u65f6\uff0c\u53ef\u80fd\u9700\u8981\u4e8c\u5206\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(q\\frac{n}{B}\\log B)$\u3002\n\n---\n\n\u90a3\u4e48\u95ee\u9898\u8f6c\u5316\u4e3a\uff0c**\u9884\u5904\u7406**\u51fa\u6bcf\u4e2a\u5757\u5185\u6240\u6709\u533a\u95f4\u5bf9\u5e94\u7684\u96c6\u5408\u3002\u8fd9\u6837\u7684\u533a\u95f4\u5171\u6709 $\\mathcal{O}(\\frac{n}{B}\\cdot B^2) = \\mathcal{O}(nB)$ \u4e2a\u3002\n\n\u6bcf\u4e2a\u5757\u5355\u72ec\u9884\u5904\u7406\u3002**\u5728\u503c\u57df\u4e0a\u5206\u6cbb**\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u539f\u5e8f\u5217\u7684\u4e00\u6bb5\u533a\u95f4\uff0c\u5728\u67d0\u4e00\u6bb5\u503c\u57df\u91cc\u7684\u6570\uff0c\u53ef\u4ee5\u8868\u793a\u4e3a\u8be5\u533a\u95f4\u7684\u4e00\u4e2a\u5b50\u5e8f\u5217\u3002\u5728\u5206\u6cbb\u7684\u7b2c\u4e00\u5c42\uff0c\u8fd9\u4e2a\u5b50\u5e8f\u5217\u5c31\u662f\u6211\u4eec\u7684\u5f53\u524d\u5757\uff0c\u8bbe\u5b83\u4e3a $p_1, p_2, \\dots ,p_{|p|}$\u3002\u4e0b\u9762\u628a\u503c\u57df\u4e00\u5206\u4e3a\u4e8c\uff1a$[l, m], [m + 1, r]$\u3002\u90a3\u4e48\u5b50\u5e8f\u5217 $p$\uff0c\u53c8\u4f1a\u5bf9\u5e94\u5730\u5212\u5206\u4e3a\u4e24\u4e2a\u5b50\u5e8f\u5217\uff1a$u_1, u_2, \\dots ,u_{|u|}$ \u548c $v_1, v_2, \\dots, v_{|v|}$\u3002\u5176\u4e2d $l\\leq a_{u_i}\\leq m$\uff0c$m < a_{v_i}\\leq r$\uff0c\u5e76\u4e14 $|u| = m - l + 1$\uff0c$|v| = r - m$\uff0c$u \\cup v = p$\u3002\n\n\u6211\u4eec\u6709 $\\mathcal{O}(B^2)$ \u4e2a\u533a\u95f4\u9700\u8981\u6c42\u7b54\u6848\uff08\u8fd9\u4e2a\u201c\u7b54\u6848\u201d\u5c31\u662f\u6307\u6784\u9020\u51fa\u7684\u4e00\u4e2a\u96c6\u5408\uff09\u3002\u9012\u5f52\u4e0b\u53bb\u3002\u5bf9\u6bcf\u4e2a\u533a\u95f4\uff0c\u6c42\u51fa\u5b83\u5728 $u$ \u5e8f\u5217\u4e0a\u7684\u7b54\u6848\uff0c\u548c\u5728 $v$ \u5e8f\u5217\u4e0a\u7684\u7b54\u6848\uff0c\u7136\u540e\u7528\u4e00\u6b21\u64cd\u4f5c\u5408\u5e76\u8d77\u6765\uff0c\u5c31\u80fd\u5f97\u5230\u5b83\u5728 $p$ \u5e8f\u5217\u4e0a\u7684\u7b54\u6848\u3002\n\n\u6734\u7d20\u5b9e\u73b0\u6240\u9700\u7684\u64cd\u4f5c\u6b21\u6570\u662f $\\mathcal{O}(B\\log B\\cdot B^2)$\uff0c\u56e0\u4e3a\u603b\u5171\u9012\u5f52\u5730\u8c03\u7528\u4e86 $\\mathcal{O}(B\\log B)$ \u6b21\u51fd\u6570\uff0c\u6bcf\u6b21\u5bf9 $\\mathcal{O}(B^2)$ \u4e2a\u96c6\u5408\u66f4\u65b0\u7b54\u6848\u3002\u8fd9\u6837\u592a\u591a\u4e86\u3002\u8003\u8651\u67d0\u4e2a\u9700\u8981\u6c42\u7b54\u6848\u7684\u533a\u95f4 $[i, j]$\uff08\u6ce8\u610f\u8fd9\u91cc $i, j$ \u6307\u7684\u662f\u4f4d\u7f6e\uff0c\u5373\u539f\u5e8f\u5217\u91cc\u7684\u4e0b\u6807\uff0c\u800c\u4e0d\u662f\u6570\u503c\u3002$l, r, m$ \u8fd9\u4e9b\u90fd\u662f\u6570\u503c\uff0c\u6211\u4eec\u5728\u503c\u57df\u4e0a\u505a\u7684\u5206\u6cbb\uff09\uff0c\u5b83\u5728 $p$ \u5e8f\u5217\u4e0a\u7684\u7b54\u6848\uff0c\u7b49\u540c\u4e8e\u533a\u95f4 $[p_{i'}, p_{j'}]$ \u7684\u7b54\u6848\u3002\u5176\u4e2d $p_{i'}$ \u662f $p$ \u5e8f\u5217\u91cc\u7b2c\u4e00\u4e2a $\\geq i$ \u7684\u5143\u7d20\uff0c$p_{j'}$ \u662f $p$ \u5e8f\u5217\u91cc\u6700\u540e\u4e00\u4e2a $\\leq j$ \u7684\u5143\u7d20\u3002\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u5bf9 $\\mathcal{O}(|p|^2)$ \u4e2a\u533a\u95f4\u6c42\u7b54\u6848\uff08\u800c\u4e0d\u662f\u539f\u6765\u7684 $\\mathcal{O}(B^2)$ \u4e2a\uff09\u3002\u5206\u6790\u73b0\u5728\u7684\u64cd\u4f5c\u6b21\u6570\uff0c\u8bbe\u67d0\u6b21\u8c03\u7528\u5206\u6cbb\u51fd\u6570\u65f6\uff0c$r - l + 1 = L$\uff0c\u5219\u64cd\u4f5c\u6b21\u6570\u4e3a $T(L) = 2T(\\frac{L}{2}) + \\mathcal{O}(L^2)$\uff0c\u89e3\u5f97 $T(L) = \\mathcal{O}(L^2)$\u3002\u6240\u4ee5\u73b0\u5728\u64cd\u4f5c\u6b21\u6570\u88ab\u4f18\u5316\u5230 $\\mathcal{O}(B^2)$\uff0c\u53ef\u4ee5\u63a5\u53d7\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\u5c31\u662f\u627e $i', j'$\u3002\u53ef\u4ee5\u7528\u4e3b\u5e2d\u6811\u67e5\u8be2\uff0c\u4f46\u6ca1\u5fc5\u8981\u3002\u6211\u4eec\u4ece\u524d\u5f80\u540e\u3001\u4ece\u540e\u5f80\u524d\u626b\u63cf\u4e24\u904d $p$ \u5e8f\u5217\uff0c\u5c31\u80fd\u5bf9\u6240\u6709 $i,j \\in p$\uff0c\u63a8\u51fa\u5b83\u4eec\u5bf9\u5e94\u7684 $i', j'$\u3002\u6240\u4ee5\u6574\u4e2a\u5206\u6cbb\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f $\\mathcal{O}(B^2)$\u3002\n\n\u5bf9\u6bcf\u4e2a\u5757\u90fd\u9884\u5904\u7406\u4e00\u6b21\uff0c**\u603b\u5171\u6240\u9700\u64cd\u4f5c\u6b21\u6570**\u548c**\u603b\u65f6\u95f4\u590d\u6742\u5ea6**\u90fd\u662f\uff1a$\\mathcal{O}(\\frac{n}{B}\\cdot B^2) = \\mathcal{O}(nB)$\u3002\n\n---\n\n\u7efc\u4e0a\uff0c\u5206\u6790\u4e00\u4e0b\u6240\u9700\u7684\u64cd\u4f5c\u6b21\u6570\uff0c\u662f $\\mathcal{O}(nB + q\\frac{n}{B})$\u3002\u663e\u7136\u53d6 $B = \\sqrt{q} = 2^{8}$ \u65f6\u662f\u6700\u4f18\u7684\u3002\u64cd\u4f5c\u6b21\u6570\u662f $\\mathcal{O}(n\\sqrt{q})$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(nB + q\\frac{n}{B}\\log B) = \\mathcal{O}(n\\sqrt{q}\\log(\\sqrt{q}))$\u3002\n\n## \u603b\u7ed3\n\n\u4e0a\u8ff0\u505a\u6cd5\u7684\u672c\u8d28\u662f\uff1a\u5c06\u4e00\u4e2a\u5e8f\u5217\u6309**\u503c\u57df\u8303\u56f4**\u5212\u5206\u6210\u82e5\u5e72**\u5b50\u5e8f\u5217**\u4e4b\u540e\uff0c\u539f\u5e8f\u5217\u7684\u6bcf\u4e2a**\u8fde\u7eed\u533a\u95f4**\u90fd\u53ef\u4ee5\u8868\u793a\u6210**\u5212\u5206\u6210\u7684\u5b50\u5e8f\u5217\u4e2d\u7684\u8fde\u7eed\u533a\u95f4**\u7684**\u5e76**\u3002\n\n**\u5206\u5757**\u548c**\u5206\u6cbb**\u90fd\u662f\u5bf9\u8fd9\u6837\u672c\u8d28\u7684\u5177\u4f53\u5b9e\u73b0\uff08\u5206\u51fa\u7684\u5757\u662f\u8fd9\u6837\u7684\u5b50\u5e8f\u5217\uff0c\u5206\u6cbb\u65f6\u5904\u7406\u7684 $p$ \u6570\u7ec4\u4e5f\u662f\u8fd9\u6837\u7684\u5b50\u5e8f\u5217\uff09\u3002\u5c06\u5b83\u4eec\u7ed3\u5408\u8d77\u6765\uff0c\u5c31\u80fd\u5f97\u5230\u6700\u4f18\u7684\u505a\u6cd5\u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n\u5b9e\u9645\u63d0\u4ea4\u65f6\u5efa\u8bae\u4f7f\u7528\u8bfb\u5165\u3001\u8f93\u51fa\u4f18\u5316\uff0c\u8be6\u89c1\u672c\u535a\u5ba2\u516c\u544a\u3002\n\n```cpp\n// problem: CF1375H\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define mk make_pair\n#define fi first\n#define se second\n#define SZ(x) ((int)(x).size())\n\ntypedef unsigned int uint;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int, int> pii;\n\ntemplate<typename T> inline void ckmax(T& x, T y) { x = (y > x ? y : x); }\ntemplate<typename T> inline void ckmin(T& x, T y) { x = (y < x ? y : x); }\n\nconst int MAXN = 1 << 12;\nconst int MAXQ = 1 << 16;\nconst int BLOCK_SIZE = 1 << 8, BLOCK_NUM = MAXN / BLOCK_SIZE;\nconst int MAXOP = 2200000;\n\nint n, q, a[MAXN + 5];\npii qs[MAXQ + 5];\nint ans[MAXQ + 5];\n\nint cnt_block, bel[MAXN + 5];\nint cnt_set;\n\npii op[MAXOP + 5];\nint merge(int s1, int s2) {\n\top[++cnt_set] = mk(s1, s2);\n\treturn cnt_set;\n}\n\nint rev[MAXN + 5];\nint nxtL[MAXN + 5], nxtR[MAXN + 5], preL[MAXN + 5], preR[MAXN + 5];\nint tmp_res[BLOCK_SIZE + 5][BLOCK_SIZE + 5];\nstruct Block {\n\tint L, R; // \u503c\u57df\u4e0a\u7684\n\tint pos[BLOCK_SIZE + 5], cnt_pos;\n\t\n\tint res[BLOCK_SIZE + 5][BLOCK_SIZE + 5]; // \u4f4d\u7f6e\u533a\u95f4 [i,j] \u7684\u96c6\u5408\u7f16\u53f7\n\t\n\tvoid solve(int l, int r, const vector<int>& p) { // \u503c\u57df\u533a\u95f4 [l, r]\n\t\tassert(SZ(p) == r - l + 1);\n\t\tif (l == r) {\n\t\t\tres[p[0]][p[0]] = pos[p[0]]; // \u8fd9\u662f\u521d\u59cb\u65f6\u5c31\u6709\u7684 n \u4e2a\u5927\u5c0f\u4e3a 1 \u7684\u96c6\u5408\u4e4b\u4e00\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tint mid = (l + r) >> 1;\n\t\t\n\t\tvector<int> pl, pr;\n\t\tfor (int _i = 0; _i < SZ(p); ++_i) {\n\t\t\tint i = p[_i];\n\t\t\tassert(a[pos[i]] >= l + L - 1 && a[pos[i]] <= r + L - 1);\n\t\t\tif (a[pos[i]] <= mid + L - 1) {\n\t\t\t\tpl.push_back(i);\n\t\t\t} else {\n\t\t\t\tpr.push_back(i);\n\t\t\t}\n\t\t}\n\t\tsolve(l, mid, pl);\n\t\tsolve(mid + 1, r, pr);\n\t\t\n\t\tfor (int _i = 0; _i < SZ(p); ++_i) {\n\t\t\tint i = p[_i];\n\t\t\tif (a[pos[i]] <= mid + L - 1) {\n\t\t\t\tpreL[_i] = _i;\n\t\t\t\tpreR[_i] = (_i == 0 ? -1 : preR[_i - 1]);\n\t\t\t} else {\n\t\t\t\tpreR[_i] = _i;\n\t\t\t\tpreL[_i] = (_i == 0 ? -1 : preL[_i - 1]);\n\t\t\t}\n\t\t}\n\t\tfor (int _i = SZ(p) - 1; _i >= 0; --_i) {\n\t\t\tint i = p[_i];\n\t\t\tif (a[pos[i]] <= mid + L - 1) {\n\t\t\t\tnxtL[_i] = _i;\n\t\t\t\tnxtR[_i] = (_i == SZ(p) - 1 ? SZ(p) : nxtR[_i + 1]);\n\t\t\t} else {\n\t\t\t\tnxtR[_i] = _i;\n\t\t\t\tnxtL[_i] = (_i == SZ(p) - 1 ? SZ(p) : nxtL[_i + 1]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor (int _i = 0; _i < SZ(p); ++_i) {\n\t\t\tint i = p[_i];\n\t\t\tfor (int _j = _i; _j < SZ(p); ++_j) {\n\t\t\t\tint j = p[_j];\n\t\t\t\ttmp_res[i][j] = res[i][j];\n\t\t\t}\n\t\t}\n\t\tfor (int _i = 0; _i < SZ(p); ++_i) {\n\t\t\tint i = p[_i];\n\t\t\tfor (int _j = _i; _j < SZ(p); ++_j) {\n\t\t\t\tint j = p[_j];\n#define x p[_x]\n#define y p[_y]\n\t\t\t\tif (a[pos[i]] <= mid + L - 1 && a[pos[j]] <= mid + L - 1) {\n\t\t\t\t\tint _x = nxtR[_i];\n\t\t\t\t\tint _y = preR[_j];\n\t\t\t\t\t\n\t\t\t\t\tif (_x <= _y) {\n\t\t\t\t\t\tres[i][j] = merge(tmp_res[i][j], tmp_res[x][y]);\n\t\t\t\t\t}\n\t\t\t\t} else if (a[pos[i]] > mid + L - 1 && a[pos[j]] > mid + L - 1) {\n\t\t\t\t\tint _x = nxtL[_i];\n\t\t\t\t\tint _y = preL[_j];\n\t\t\t\t\t\n\t\t\t\t\tif (_x <= _y) {\n\t\t\t\t\t\tres[i][j] = merge(tmp_res[x][y], tmp_res[i][j]);\n\t\t\t\t\t}\n\t\t\t\t} else if (a[pos[i]] <= mid + L - 1 && a[pos[j]] > mid + L - 1) {\n\t\t\t\t\tint _x = nxtR[_i];\n\t\t\t\t\tassert(_x <= _j);\n\t\t\t\t\tint _y = preL[_j];\n\t\t\t\t\tassert(_y >= _i);\n\t\t\t\t\t\n\t\t\t\t\tres[i][j] = merge(tmp_res[i][y], tmp_res[x][j]);\n\t\t\t\t\t\n\t\t\t\t} else if (a[pos[i]] > mid + L - 1 && a[pos[j]] <= mid + L - 1) {\n\t\t\t\t\tint _x = nxtL[_i];\n\t\t\t\t\tassert(_x <= _j);\n\t\t\t\t\tint _y = preR[_j];\n\t\t\t\t\tassert(_y >= _i);\n\t\t\t\t\t\n\t\t\t\t\tres[i][j] = merge(tmp_res[x][j], tmp_res[i][y]);\n\t\t\t\t}\n#undef x\n#undef y\n\t\t\t}\n\t\t}\n\t}\n\tvoid build(int _L, int _R) {\n\t\tL = _L;\n\t\tR = _R;\n\t\t\n\t\tcnt_pos = 0;\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\tif (a[i] >= L && a[i] <= R) {\n\t\t\t\tpos[++cnt_pos] = i;\n\t\t\t\trev[a[i]] = cnt_pos;\n\t\t\t}\n\t\t}\n\t\tassert(cnt_pos == R - L + 1);\n\t\t\n\t\tvector<int> p;\n\t\tfor (int i = 1; i <= cnt_pos; ++i) {\n\t\t\tp.push_back(i);\n\t\t}\n\t\tsolve(1, cnt_pos, p);\n\t}\n\t\n\tint query(int l, int r) {\n\t\tint x = lower_bound(pos + 1, pos + cnt_pos + 1, l) - pos;\n\t\tint y = upper_bound(pos + 1, pos + cnt_pos + 1, r) - pos - 1;\n\t\tif (x > y) return 0;\n\t\t\n\t\treturn res[x][y];\n\t}\n\t\n\tBlock() {}\n} blo[BLOCK_NUM + 5];\n\n\nint main() {\n\tcin >> n >> q;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tcin >> a[i];\n\t}\n\t\n\tcnt_set = n; // \u521d\u59cb\u65f6\u6709 n \u4e2a\u96c6\u5408\n\tfor (int i = 1; i <= n; i += BLOCK_SIZE) {\n\t\tint j = min(i + BLOCK_SIZE - 1, n);\n\t\t++cnt_block;\n\t\tfor (int k = i; k <= j; ++k) {\n\t\t\tbel[k] = cnt_block;\n\t\t}\n\t\tblo[cnt_block].build(i, j);\n\t}\n\t\n\tfor (int i = 1; i <= q; ++i) {\n\t\tcin >> qs[i].fi >> qs[i].se;\n\t\tint l = qs[i].fi, r = qs[i].se;\n\t\t\n\t\tans[i] = 0;\n\t\tfor (int b = 1; b <= cnt_block; ++b) {\n\t\t\tint s = blo[b].query(l, r);\n\t\t\tif (!s)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\tif (!ans[i]) {\n\t\t\t\tans[i] = s;\n\t\t\t} else {\n\t\t\t\tans[i] = merge(ans[i], s);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tcout << cnt_set << endl;\n\tfor (int i = n + 1; i <= cnt_set; ++i) {\n\t\tcout << op[i].fi << \" \" << op[i].se << endl;\n\t}\n\tfor (int i = 1; i <= q; ++i) {\n\t\tcout << ans[i] << \" \\n\"[i == q];\n\t}\n\treturn 0;\n}\n```\n\n\n\n\n\n",
        "postTime": 1612315549,
        "uid": 100674,
        "name": "duyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1375H \u3010Set Merging\u3011"
    },
    {
        "content": "\u9996\u5148\u4f60\u9700\u8981\u4f1a\u4e00\u4e2a $O(n^2)$ \u7684\u505a\u6cd5\u5904\u7406\u51fa\u6bcf\u4e2a\u533a\u95f4\u7684\u7b54\u6848\u3002\n\n\u5bf9\u503c\u57df\u5206\u6cbb\uff0c\u6bcf\u6b21\u5904\u7406\u51fa\u5de6\u90e8\u548c\u53f3\u90e8\u7684\u7b54\u6848\uff0c\u90a3\u4e48\u6574\u4f53\u7684\u7b54\u6848\u5c31\u662f\u4e24\u8fb9\u7684\u5e76\u3002\n\n\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u662f $f(n)=\\dfrac{n^2}{2}+2f(\\dfrac n2)=n^2$ \u7684\u3002\n\n\u8003\u8651\u5230\u5bf9\u4e8e $len$ \u4e2a\u6570\u6211\u4eec\u53ef\u4ee5 $O(len^2) $ \u5730\u5904\u7406\u51fa\u6bcf\u4e2a\u533a\u95f4\uff0c\u4e8e\u662f\u4e0d\u59a8\u5bf9 $len$ \u5206\u5757\uff0c\u8bbe $len=B$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u4e00\u5f00\u59cb\u5bf9\u6240\u6709\u5757\u7b97\u51fa\u6bcf\u4e2a\u533a\u95f4\u7684\u7b54\u6848\uff0c\u590d\u6742\u5ea6\u4e3a $O(nB)$\uff1b\u8be2\u95ee\u65f6\u4ece\u5c0f\u5230\u5927\u5408\u5e76\u6bcf\u4e2a\u5757\u7684\u7b54\u6848\u5373\u53ef\uff0c\u590d\u6742\u5ea6\u4e3a $O(q\\dfrac{n}{B})$\uff0c\u53d6 $B=\\sqrt q$\uff0c\u5219\u8be2\u95ee\u603b\u6b21\u6570\u4e3a $2n\\sqrt q$ \u6b63\u597d\u6ee1\u8db3\u9650\u5236\u3002\n\n\u4ee3\u7801\u53c2\u8003\u4e86 $\\text F\\color{red}\\text{uyuki}$\u3002\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=2e5+10;\nconst int mod=1e9+7;\n#define inf 1e9\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n\treturn x*f;\n}\nconst int N=1<<12;\nconst int M=1<<16;\nconst int B=1<<8;\nconst int K=1<<22;\n#define pb push_back\nint AA[K+1],BB[K+1],cnt,Ans[M+1];\ninline int merge(int x,int y){\n\tif(!x||!y)return x+y;\n\t++cnt;AA[cnt]=x,BB[cnt]=y;\n\treturn cnt;\n}\nstruct node{\n\tvector<int>pos;\n\tvector<vector<int> >res;\n\tinline void init(int x){\n\t\tpos.resize(x);res.resize(x);\n\t\tfor(int i=0;i<x;++i)res[i].resize(x-i);\n\t}\n\tinline int ask(int l,int r)const{\n\t\tif(r<pos.front()||l>pos.back())return 0;\n\t\tl=lower_bound(pos.begin(),pos.end(),l)-pos.begin();\n\t\tr=upper_bound(pos.begin(),pos.end(),r)-pos.begin()-1;\n\t\treturn l>r?0:res[l][r-l];\n\t}\n\tinline node upd(const node &l,const node &r){\n\t\tinit(l.pos.size()+r.pos.size());\n\t\tmerge(l.pos.begin(),l.pos.end(),r.pos.begin(),r.pos.end(),pos.begin());\n\t\tfor(int i=0;i<pos.size();++i)for(int j=i;j<pos.size();++j)\n\t\t\tres[i][j-i]=merge(l.ask(pos[i],pos[j]),r.ask(pos[i],pos[j]));\n\t\treturn *this;\n\t}\n}bl[N/B+1];\nint n,m,a[N+1],p[N+1];\ninline node solve(int l,int r){\n\tif(l==r){\n\t\tnode tmp;tmp.init(1);\n\t\ttmp.pos[0]=p[l];\n\t\ttmp.res[0][0]=p[l];\n\t\treturn tmp;\n\t}int mid=(l+r)>>1;node tmp;\n\treturn tmp.upd(solve(l,mid),solve(mid+1,r));\n}\nint main(){\n\tn=read(),m=read();cnt=n;\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read(),p[a[i]]=i;\n\tfor(int i=1;i<=n/B+(n%B>0);i++)\n\t\tbl[i]=solve((i-1)*B+1,min(i*B,n));\n\tfor(int i=1,l,r;i<=m;i++){\n\t\tint ans=0;l=read(),r=read();\n\t\tfor(int j=1;j<=n/B+(n%B>0);j++)\n\t\t\tans=merge(ans,bl[j].ask(l,r));\n\t\tAns[i]=ans;\n\t}printf(\"%d\\n\",cnt);\n\tfor(int i=n+1;i<=cnt;i++)\n\t\tprintf(\"%d %d\\n\",AA[i],BB[i]);\n\tfor(int i=1;i<=m;i++)\n\t\tprintf(\"%d \",Ans[i]);puts(\"\");\n\treturn 0;\n}\n```\n\n\u6df1\u6df1\u5730\u611f\u5230\u81ea\u5df1\u7684\u5f31\u5c0f\u3002",
        "postTime": 1668652950,
        "uid": 140876,
        "name": "syzf2222",
        "ccfLevel": 9,
        "title": "CF1375H Set Merging"
    }
]