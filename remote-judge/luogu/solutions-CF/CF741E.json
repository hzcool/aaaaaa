[
    {
        "content": "\u6839\u636e\u60ef\u4f8b\uff1a[\u6b22\u8fce\u6765\u6211\u7684blog\u901b\u901b~](https://blog.csdn.net/Dream_Lolita/article/details/86719290)\n\n\u3010\u9898\u76ee\u3011\n\n\u7ed9\u5b9a\u4e24\u4e2a\u5b57\u7b26\u4e32$S,T$\uff0c\u5b9a\u4e49$R_i$\u8868\u793a\u5728$S$\u7684\u7b2c$i$\u4e2a\u548c\u7b2c$i+1$\u4e2a\u5b57\u7b26\u4e4b\u95f4\u63d2\u5165$T$\u5f97\u5230\u7684\u5b57\u7b26\u4e32($R_0$\u5373\u52a0\u5728\u5f00\u5934\uff0c$R_n$\u5373\u52a0\u5728\u7ed3\u5c3e)\u3002\n\n$Q$\u4e2a\u8be2\u95ee\u5f62\u5982$(l,r,k,x,y)$\uff0c\u8868\u793a\u8be2\u95ee$l\\leq i\\leq r,x\\leq (i\\mod k) \\leq y$\u4e2d\u5b57\u5178\u5e8f\u6700\u5c0f\u7684$R_i$\u662f\u54ea\u4e2a$i$\n\n$|S|,|T|,Q\\leq 10^5$\n\n\n\u3010\u89e3\u9898\u601d\u8def\u3011\n\n\u9996\u5148\u8003\u8651\u5982\u4f55\u6bd4\u8f83\u5728\u4e24\u4e2a\u4f4d\u7f6e\u63d2\u5165$T$\u540e\u5b57\u7b26\u4e32\u7684\u5b57\u5178\u5e8f\u5927\u5c0f\uff0c\u663e\u7136\u53ef\u4ee5\u6309$T$\u7684\u7aef\u70b9\u62c6\u6210\u4e94\u4e2a\u90e8\u5206\uff0c\u7528\u540e\u7f00\u6570\u7ec4\u6c42$lcp$\u53ef\u4ee5\u7b80\u5355\u5f97\u5230\u8fd9\u4e94\u4e2a\u90e8\u5206\u7684\u5927\u5c0f\u5173\u7cfb\u3002\n\\l\u63a5\u4e0b\u6765\u8981\u89e3\u51b3\u8be2\u95ee\u7684\u95ee\u9898\uff0c\u9650\u5236\u6709\u53d6\u6a21\u4e0d\u592a\u597d\u5904\u7406\uff0c\u53d1\u73b0\u53ef\u4ee5\u5199\u6210$x+\\lfloor \\frac i k \\rfloor \\times k\\leq i\\leq y+\\lfloor \\frac i k \\rfloor \\times k$\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u8003\u8651\u5bf9$k$\u9608\u503c$S$\u3002\n\n\u5f53$k>S$\uff0c\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u679a\u4e3e$\\lfloor \\frac i k \\rfloor $\uff0c\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f\u5728\u4e00\u6bb5\u533a\u95f4\u4e2d\u53d6\u4e00\u4e2a\u6700\u4f18\u503c\uff0c\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u901a\u8fc7$\\text{RMQ}$\u9884\u5904\u7406\u505a\u5230$O(1)$\u5355\u6b21\u67e5\u8be2\uff0c\u56e0\u6b64\u4e00\u6b21\u8be2\u95ee\u7684\u590d\u6742\u5ea6\u662f$O(\\frac n S)$\u7684\uff0c\u6700\u574f\u60c5\u51b5\u5373$O(\\frac {n^2} S)$\u3002\n\n\u5f53$k\\leq S$\uff0c\u4e0d\u59a8\u5c06\u8be2\u95ee\u79bb\u7ebf\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e$k$\uff0c\u518d\u679a\u4e3e$x\\in [0,k-1]$\uff0c\u5bf9\u4e8e$i\\equiv x\\ mod\\ k$\u7684\u6240\u6709$i$\u5efa\u4e00\u4e2a$\\text{RMQ}$\uff0c\u8be2\u95ee\u7684\u65f6\u5019\u5c31\u5728$[x,y]$\u5185\u67e5\u8be2\uff0c\u8fd9\u90e8\u5206\u603b\u7684\u590d\u6742\u5ea6\u662f$O(Sn\\log n)$\u7684\u3002\n\n\u6839\u636e\u5747\u503c\u4e0d\u7b49\u5f0f\u53ef\u4ee5\u53d1\u73b0\u53d6$S=\\sqrt {\\frac n {\\log n}}$\u53ef\u4ee5\u6709\u6700\u4f18\u590d\u6742\u5ea6$O(n\\sqrt {n\\log n})$\n\n\u5b9e\u9645\u5b9e\u73b0\u4e2d\uff0c\u7531\u4e8e\u7b2c\u4e8c\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e0e$\\text{RMQ}$\u957f\u5ea6\u76f8\u5173\uff0c\u5b9e\u9645\u590d\u6742\u5ea6\u5c0f\u4e8e\u7406\u8bba\u590d\u6742\u5ea6\uff0c\u800c\u7b2c\u4e00\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e0e$k>S$\u7684\u8be2\u95ee\u6b21\u6570\u76f8\u5173\uff0c\u540c\u6837\u5c0f\u4e8e\u7406\u8bba\u590d\u6742\u5ea6\u3002\u5728\u5361\u6ee1\u7684\u60c5\u51b5\u4e0b\u5e94\u8be5$S$\u53d6\u5927\u4e00\u70b9\u4f1a\u66f4\u4f18\u79c0\u3002\n\n\u5b9e\u73b0\u4e0a\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u9700\u8981\u6ce8\u610f\uff0c\u6bd4\u5982\u8bf4$\\text{RMQ}$\u662f\u5168\u7528\u4e00\u4e2a\u6570\u7ec4\u8fd8\u662f\u5f00\u51e0\u4e2a\uff1f\u5f00\u51e0\u4e2a\u5199\u7684\u65f6\u5019\u6709\u6ca1\u6709\u7528\u5bf9\uff1f\n\n\u5efa\u8bae\u7528$\\text{namespace}$\u907f\u514d\u51b2\u7a81\u3002\n\n\u3010\u53c2\u8003\u4ee3\u7801\u3011\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int N=2e5+10,lim=90,INF=0x3f3f3f3f;\nint n,m,len,Q,fc[20],Log[N];\n\nnamespace IO\n{\n\tint read()\n\t{\n\t\tint ret=0;char c=getchar();\n\t\twhile(!isdigit(c)) c=getchar();\n\t\twhile(isdigit(c)) ret=ret*10+(c^48),c=getchar();\n\t\treturn ret;\n\t}\n\tvoid write(int x){if(x<0)x=-x,putchar('-');if(x>9)write(x/10);putchar(x%10^48);}\n\tvoid writesp(int x){write(x);putchar(' ');}\n}\nusing namespace IO;\n\nnamespace SA\n{\n\tint sa[N],rk[N],hi[N],h[18][N];\n\tint wx[N],wy[N],wa[N],wb[N];\n\tbool cmp(int *r,int a,int b,int l){return r[a]==r[b] && r[a+l]==r[b+l];}\n\tvoid getsa(int *r,int n,int m)\n\t{\n\t\tint *x=wa,*y=wb,*t,i,j,p;\n\t\tfor(i=0;i<m;++i) wx[i]=0;\n\t\tfor(i=0;i<n;++i) wx[x[i]=r[i]]++;\n\t\tfor(i=1;i<m;++i) wx[i]+=wx[i-1];\n\t\tfor(i=n-1;~i;--i) sa[--wx[x[i]]]=i;\n\t\tfor(p=0,j=1;p<n;j<<=1,m=p)\n\t\t{\n\t\t\tfor(p=0,i=n-j;i<n;++i) y[p++]=i;\n\t\t\tfor(i=0;i<n;++i) if(sa[i]>=j) y[p++]=sa[i]-j;\n\t\t\tfor(i=0;i<m;++i) wx[i]=0;\n\t\t\tfor(i=0;i<n;++i) wx[wy[i]=x[y[i]]]++;\n\t\t\tfor(i=1;i<m;++i) wx[i]+=wx[i-1];\n\t\t\tfor(i=n-1;~i;--i) sa[--wx[wy[i]]]=y[i];\n\t\t\tfor(t=x,x=y,y=t,i=1,p=1,x[sa[0]]=0;i<n;++i)\n\t\t\t\tx[sa[i]]=cmp(y,sa[i-1],sa[i],j)?p-1:p++;\n\t\t}\n\t}\n\tvoid getheight(int *r,int n)\n\t{\n\t\tint i,j,k=0;\n\t\tfor(i=1;i<=n;++i) rk[sa[i]]=i;\n\t\tfor(i=0;i<n;hi[rk[i++]]=k)\n\t\t\tfor(k?--k:0,j=sa[rk[i]-1];r[i+k]==r[j+k];++k);\n\t}\n\tvoid adjust(int n)\n\t{\n\t\tfor(int i=n;i;--i) sa[i]++,rk[i]=rk[i-1];\n\t\tsa[0]=rk[0]=0;\n\t}\n\tvoid output(int n)\n\t{\n\t\tfor(int i=0;i<=n;++i) printf(\"%d \",sa[i]); puts(\"\");\n\t\tfor(int i=0;i<=n;++i) printf(\"%d \",rk[i]); puts(\"\");\n\t\tfor(int i=0;i<=n;++i) printf(\"%d \",hi[i]); puts(\"\");\n\t}\n\tvoid initrmq(int n)\n\t{\n\t\tfor(int i=1;i<=n;++i) h[0][i]=hi[i];\n\t\tfor(int j=1;j<18;++j) for(int i=1;i+fc[j]-1<=n;++i)\n\t\t\th[j][i]=min(h[j-1][i],h[j-1][i+fc[j-1]]);\n\t}\n\tvoid buildsa(int *r,int n,int m)\n\t{\n\t\tgetsa(r,n+1,m);getheight(r,n);adjust(n);initrmq(n);//output(n);\n\t}\n\tint calc(int x,int y)\n\t{\n\t\tint t=Log[y-x+1];\n\t\t//printf(\"calc:%d %d %d\\n\",x,y,min(h[t][x],h[t][y-fc[t]+1]));\n\t\treturn min(h[t][x],h[t][y-fc[t]+1]);\n\t}\n\tint lcp(int x,int y)\n\t{\n\t\tx=rk[x];y=rk[y];\n\t\tif(x>y) swap(x,y);\n\t\treturn calc(x+1,y);\n\t}\n\tint comp(int x,int y,int l)\n\t{\n\t\tif(lcp(x,y)>=l) return 0;\n\t\treturn (rk[x]<rk[y])?-1:1;\n\t}\n\tbool cmpst(int x,int y)\n\t{\n\t\tint fg=x>y,t; if(fg) swap(x,y);\n\t\tif(m+x<=y)\n\t\t{\n\t\t\tt=comp(n+1,x+1,m);\n\t\t\tif(t) return (t<0)^fg;\n\t\t\tt=comp(x+1,x+m+1,y-(x+m));\n\t\t\tif(t) return (t<0)^fg;\n\t\t\tt=comp(y-m+1,n+1,m);\n\t\t\tif(t) return (t<0)^fg;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tt=comp(n+1,x+1,y-x);\n\t\t\tif(t) return (t<0)^fg;\n\t\t\tt=comp(n+y-x+1,n+1,x+m-y);\n\t\t\tif(t) return (t<0)^fg;\n\t\t\tt=comp(x+1,m+n+x-y+1,y-x);\n\t\t\tif(t) return (t<0)^fg;\n\t\t}\n\t\treturn fg^1;\n\t}\n}\n\nnamespace DreamLolita\n{\n\tint a[N],b[N],c[N],ans[N],mi[18][N];\n\tchar s1[N],s2[N];\n\n\tstruct data\n\t{\n\t\tint l,r,k,x,y,id;\n\t\tvoid in(int t){l=read();r=read();k=read();x=read();y=read();id=t;}\n\t\tbool operator <(const data&rhs){return k<rhs.k;}\n\t}q[N];\n\tvoid init()\n\t{\n\t\tscanf(\"%s%s\",s1,s2);Q=read();\n\t\tn=strlen(s1);m=strlen(s2);len=n+m;\n\t\tfor(int i=2;i<=len;++i) Log[i]=Log[i>>1]+1;\n\t\tfc[0]=1;for(int i=1;i<18;++i)fc[i]=fc[i-1]<<1;\n\t\tfor(int i=0;i<n;++i)a[i]=s1[i]-'a'+1;\n\t\tfor(int i=0;i<m;++i) a[n+i]=s2[i]-'a'+1;\t\n\t}\n\tint calp(int x,int y)\n\t{\n\t\tif(x>y) return INF;\n\t\tint t=Log[y-x+1];\n\t\t//printf(\"calp:%d %d %d\\n\",x,y,min(mi[t][x],mi[t][y-fc[t]+1]));\n\t\treturn min(mi[t][x],mi[t][y-fc[t]+1]);\n\t}\n\tvoid solvesmall()\n\t{\n\t\tsort(q+1,q+Q+1);\n\t\tfor(int i=1,j=1;i<=lim && j<=Q;++i) if(i==q[j].k)//solve1\n\t\t{\n\t\t\tint t=j;\n\t\t\twhile(t<Q && q[t+1].k==i) ++t;\n\t\t\tfor(int k=0;k<i;++k)\n\t\t\t{\n\t\t\t\tint tmp=(n+1)/i+(k<=n%i);\n\t\t\t\tfor(int i1=1;i1<=tmp;++i1) mi[0][i1]=c[(i1-1)*i+k];\n\t\t\t\tfor(int j1=1;j1<18;++j1) for(int i1=1;i1+fc[j1]-1<=tmp;++i1)\n\t\t\t\t\tmi[j1][i1]=min(mi[j1-1][i1],mi[j1-1][i1+fc[j1-1]]);\n\t\t\t\tfor(int i1=j;i1<=t;++i1)\n\t\t\t\t{\n\t\t\t\t\t//cerr<<q[i1].id<<\" \"<<ans[q[i1].id]<<endl;\n\t\t\t\t\tif(q[i1].x<=k && k<=q[i1].y) \n\t\t\t\t\t\tans[q[i1].id]=min(ans[q[i1].id],calp((q[i1].l-k+i-1)/i+1,(q[i1].r-k+i)/i));\n\t\t\t\t\t//cerr<<q[i1].id<<\" \"<<ans[q[i1].id]<<endl;\n\t\t\t\t}\n\t\t\t}\n\t\t\tj=t+1;\n\t\t}\n\t}\n\tvoid solvebig()\n\t{\n\t\tfor(int i=1;i<=n+1;++i) mi[0][i]=c[i-1];\n\t\tfor(int j=1;j<18;++j) for(int i=1;i+fc[j]-1<=n+1;++i)\n\t\t\tmi[j][i]=min(mi[j-1][i],mi[j-1][i+fc[j-1]]);\n\t\tfor(int i=1;i<=Q;++i) if(q[i].k>lim)\n\t\t{\n\t\t\tfor(int j=0;j*q[i].k<=n;++j) \n\t\t\t\tans[q[i].id]=min(ans[q[i].id],calp(max(j*q[i].k+q[i].x,q[i].l)+1,min(j*q[i].k+q[i].y,q[i].r)+1));\n\t\t}\n\t}\n\tvoid solve()\n\t{\n\t\tSA::buildsa(a,len,30);\n\t\tfor(int i=0;i<=n;++i) b[i]=i;\n\t\tsort(b,b+n+1,SA::cmpst);\n\t\t//for(int i=0;i<=n;++i) printf(\"%d \",b[i]); puts(\"\");\n\t\tfor(int i=0;i<=n;++i) c[b[i]]=i;\n\t\tfor(int i=1;i<=Q;++i) q[i].in(i),ans[i]=INF;\n\t\tsolvesmall();solvebig();\n\t\tfor(int i=1;i<=Q;++i) writesp(ans[i]<INF?b[ans[i]]:-1);\n\t}\n}\n\nint main()\n{\n#ifndef ONLINE_JUDGE\n\tfreopen(\"CF741E.in\",\"r\",stdin);\n\tfreopen(\"CF741E.out\",\"w\",stdout);\n#endif\n\tDreamLolita::init();DreamLolita::solve();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1548928294,
        "uid": 15438,
        "name": "Durant_Lee",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF741E \u3010Arpa\u2019s abnormal DNA and Mehrdad\u2019s deep interest\u3011"
    }
]