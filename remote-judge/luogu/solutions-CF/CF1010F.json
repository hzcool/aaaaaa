[
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u6bd2\u7624\u9898\n\n\u9996\u5148\u4ee4 $A_i$ \u4e3a $i$ \u53f7\u8282\u70b9\u7684\u679c\u679c\u6570\uff0c\u4ee4 $B_i=A_i-\\displaystyle\\sum_{c\\in \\mathrm{son}_i}A_c$\n\n\u80fd\u53d1\u73b0\u7531 $B_i$ \u80fd\u552f\u4e00\u786e\u5b9a $A_i$\uff0c\u4e14 $B_i \\geq 0$\uff0c\u7531\u4e8e\u6839\u8282\u70b9\u7684\u679c\u679c\u6709 $X$ \u4e2a\n\n\u90a3\u4e48\u7531\u5dee\u5206\u53ef\u4ee5\u5f97\u5230 $\\displaystyle\\sum B_i=X$\n\n\u73b0\u5728\u5982\u679c\u6811\u4e0a\u8fd8\u6709 $P$ \u4e2a\u70b9\u90a3\u4e48\u7531\u63d2\u677f\u6cd5\u5f97\u5230\u5408\u6cd5\u7684 $B_i$ \u6570\u91cf\u4e3a $\\displaystyle\\binom{X+P-1}{P-1}$\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u70b9\u6570\u4e3a $P$ \u7684\u5305\u542b $1$ \u8fde\u901a\u5b50\u6811\u4e2a\u6570\n\n\u4e00\u4e2a\u5f88\u66b4\u529b\u7684\u60f3\u6cd5\u662f\u6811\u5f62dp\n\n$f[i][j]$ \u8868\u793a $i$ \u7684\u5b50\u6811\u4e2d\u5305\u542b $i$ \u4e14\u70b9\u6570\u4e3a $j$ \u7684\u8fde\u901a\u5b50\u6811\u4e2a\u6570\n\n\u7279\u6b8a\u5730\uff0c$f[i][0] = 1$\n\n\u7531\u4e8e\u7ed9\u7684\u662f\u4e8c\u53c9\u6811\uff08\u5176\u5b9e\u4e0d\u662f\u4e8c\u53c9\u6811\u4e5f\u53ef\u4ee5\u505a\uff09\n\n\u679a\u4e3e\u5de6\u513f\u5b50\u7684\u5927\u5c0f\n\n$$f[i][j]=\\displaystyle\\sum_{k=0}^{j-1}f[L][k]\\times f[R][j-k-1]$$\n\n\u53d1\u73b0\u662f\u5377\u79ef\u5f62\u5f0f\uff0c\u5982\u679c\u5199\u6210\u751f\u6210\u51fd\u6570\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\n\n$$F_i(x)=xF_L(x)\\times F_R(x)+1$$\n\n\u7279\u6b8a\u5730\uff0c\u5982\u679c $i$ \u53ea\u6709\u4e00\u4e2a\u513f\u5b50\n\n$$F_i(x)=xF_L(x)+1$$\n\n\u5982\u679c $i$ \u662f\u53f6\u5b50\n\n$$F_i(x)=x+1$$\n\n\u5230\u4e86\u8fd9\u4e00\u6b65\u53d1\u73b0\uff0c\u5373\u4f7f\u4f7f\u7528 FFT \u4f18\u5316\uff0c\u4e5f\u5f88\u96be\u7ee7\u7eed\u4f18\u5316\n\n\u4e8e\u662f\u5148\u628a\u6811\u91cd\u94fe\u5256\u5206\uff0c\u4e00\u6b21\u6027\u8ba1\u7b97\u91cd\u94fe\u4e0a\u6240\u6709\u70b9\u7684 dp \u503c\uff08\u5b9e\u9645\u4e0a\u53ea\u8ba1\u7b97\u91cd\u94fe\u94fe\u9876\u7684 dp \u503c\uff09\n\n\u5982\u679c\u628a\u9664\u91cd\u94fe\u4ee5\u5916\u7684 dp \u503c\u90fd\u8ba1\u7b97\u51fa\u6765\u4e86\n\n\u90a3\u4e48\u94fe\u9876 dp \u503c\u53ef\u4ee5\u8868\u793a\u4e3a\n\n$$F_i(x)=((((a_1+1)a_2+1)a_3+1)\\dots )a_k+1$$\n\n\u4e8e\u662f\n\n$$F_i(x)=a_1a_2\\dots a_k+a_2a_3\\dots a_k+\\dots+a_k+1$$\n\n\n\u7531\u4e8e $a_i$ \u603b\u6b21\u6570\u4e0d\u8d85\u8fc7 $n$ \u6240\u4ee5\u8fd9\u4e2a\u53ef\u4ee5 \u5206\u6cbbFFT \u8ba1\u7b97\n\n\u5177\u4f53 $a_i$ \u7684\u503c\u662f\u4ec0\u4e48\uff0c\u8bf7\u8bfb\u8005\u81ea\u5df1\u601d\u8003\u6216\u9605\u8bfb\u4ee3\u7801\uff0c\u8fd9\u91cc\u4e0d\u8d58\u8ff0\u4e86\n\n\u4ee4 \n\n$$Z_{L,R}=a_La_{L+1}a_{L+2}\\dots a_R+a_{L+1}\\dots a_R+\\dots+1$$\n\n$$W_{L,R}=a_La_{L+1}a_{L+2}\\dots a_R$$\n\n\u90a3\u4e48 \n\n$$Z_{L,R}=(Z_{L,M}-1)W_{M+1,R}+Z_{M+1,R}$$\n\n$$W_{L,R}=W_{L,M}W_{M+1,R}$$\n\n\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6\u662f $O(n \\log^3 n)$\n\n\u8fd8\u6709\u5c31\u662f\u5982\u679c\u4e0d\u662f\u4e8c\u53c9\u6811\u4e5f\u53ef\u4ee5\u505a\uff0c\u5177\u4f53\u5c31\u662f\u628a\u9664\u91cd\u513f\u5b50\u4ee5\u5916\u7684\u6240\u6709\u513f\u5b50 dp \u503c\u7528 \u5206\u6cbbFFT \u4e58\u8d77\u6765\n\n\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\u5c31\u5f88\u6bd2\u7624\u4e86\uff0c\u7ed9\u51fa\u6211\u4e11\u964b\u7684\u4ee3\u7801\n```cpp\n#include <iostream>\n#include <cstring>\n#include <vector>\n\nconst int N = 262144;\nconst int mod = 998244353;\nusing LL = long long;\n\nint rev[N], wn[N + 1], lim, s;\n\nint pow(int x, int y)\n{\n\tint ans = 1;\n\tfor (; y; y >>= 1, x = static_cast<LL> (x) * x % mod)\n\t\tif (y & 1)\n\t\t\tans = static_cast<LL> (ans) * x % mod;\n\treturn ans;\n}\n\nvoid fffffftinit(int len)\n{\n\twn[0] = lim = 1, s = -1;\n\twhile (lim < len)\n\t\tlim <<= 1, ++s;\n\tfor (int i = 0; i < lim; ++i)\n\t\trev[i] = rev[i >> 1] >> 1 | (i & 1) << s;\n\tconst int g = pow(3, (mod - 1) / lim);\n\tfor (int i = 1; i <= lim; ++i)\n\t\twn[i] = static_cast<LL> (wn[i - 1]) * g % mod;\n}\n\nvoid reduce(int &x)\n{\n\tx += x >> 31 & mod;\n}\nvoid fffffft(int *A, int typ)\n{\n\tfor (int i = 0; i < lim; ++i)\n\t\tif (i < rev[i])\n\t\t\tstd::swap(A[i], A[rev[i]]);\n\tfor (int i = 1; i < lim; i <<= 1)\n\t{\n\t\tconst int t = lim / i / 2;\n\t\tfor (int j = 0; j < lim; j += i << 1)\n\t\t\tfor (int k = 0; k < i; ++k)\n\t\t\t{\n\t\t\t\tconst int x = A[k + j], y = static_cast<LL> (A[k + j + i]) * wn[typ ? t * k : lim - t * k] % mod;\n\t\t\t\treduce(A[k + j] += y - mod), reduce(A[k + j + i] = x - y);\n\t\t\t}\n\t}\n\tif (!typ)\n\t{\n\t\tconst int il = pow(lim, mod - 2);\n\t\tfor (int i = 0; i < lim; ++i)\n\t\t\tA[i] = static_cast<LL> (A[i]) * il % mod;\n\t}\n}\n\nint tA[N], tB[N];\nstruct poly\n{\n\tstd::vector<int> poly_;\n\tvoid assign(int *L, int *R)\n\t{\n\t\tpoly_.assign(L, R);\n\t}\n\tpoly operator ~ () const\n\t{\n\t\tpoly P = *this;\n\t\tP.poly_.insert(P.poly_.begin(), 0);\n\t\treturn P;\n\t}\n\tpoly operator - (const int &rhs) const\n\t{\n\t\tpoly P = *this;\n\t\tP.poly_[0] -= rhs;\n\t\treturn P;\n\t}\n\tpoly operator + (const int &rhs) const\n\t{\n\t\tpoly P = *this;\n\t\tP.poly_[0] += rhs;\n\t\treturn P;\n\t}\n\tpoly operator + (const poly &rhs) const\n\t{\n\t\tpoly P;\n\t\tP.poly_.assign(std::max(this->size(), rhs.size()), 0);\n\t\tfor (int i = 0; i < this->size(); ++i)\n\t\t\treduce(P.poly_[i] += this->poly_[i] - mod);\n\t\tfor (int i = 0; i < rhs.size(); ++i)\n\t\t\treduce(P.poly_[i] += rhs.poly_[i] - mod);\n\t\treturn P;\n\t}\n\tint size() const\n\t{\n\t\treturn poly_.size();\n\t}\n\tvoid debug()\n\t{\n\t\tfor (int i = 0; i < size(); ++i)\n\t\t\tstd::cout << poly_[i] << ' ';\n\t\tstd::cout << '\\n';\n\t}\n\tfriend poly operator * (const poly &A, const poly &B)\n\t{\n\t\tpoly res;\n\t\tint n = A.size(), m = B.size();\n\t\tfffffftinit(n + m - 1);\n\t\tstd::copy(A.poly_.begin(), A.poly_.end(), tA), std::copy(B.poly_.begin(), B.poly_.end(), tB);\n\t\tstd::memset(tA + n, 0, lim - n << 2), std::memset(tB + m, 0, lim - m << 2);\n\t\tfffffft(tA, 1), fffffft(tB, 1);\n\t\tfor (int i = 0; i < lim; ++i)\n\t\t\ttA[i] = static_cast<LL> (tA[i]) * tB[i] % mod;\n\t\tfffffft(tA, 0);\n\t\tres.assign(tA, tA + n + m - 1);\n\t\treturn res;\n\t}\n};\n\nint head[N], tot;\nstruct edge\n{\n\tint to, nxt;\n} e[N];\n\nvoid link(int x, int y)\n{\n\te[++tot] = (edge) { y, head[x] }, head[x] = tot;\n\te[++tot] = (edge) { x, head[y] }, head[y] = tot;\n}\n\nint size[N], go[N][2], n;\nLL X;\nint dfs0(int x, int f = 0)\n{\n\tfor (int i = head[x]; i; i = e[i].nxt)\n\t\tif (e[i].to != f)\n\t\t\tgo[x][static_cast<bool> (go[x][0])] = e[i].to, size[x] += dfs0(e[i].to, x);\n\tif (size[go[x][0]] < size[go[x][1]])\n\t\tstd::swap(go[x][0], go[x][1]);\n\treturn ++size[x];\n}\n\nstd::vector<poly> v[N];\nint sum[N];\nstd::pair<poly, poly> solve_(int pos, int L, int R)\n{\n\tif (L == R)\n\t{\n\t\tpoly P = v[pos][L];\n\t\treturn std::make_pair(P + 1, P);\n\t}\n\tint mid = L + R >> 1;\n\tstd::pair<poly, poly> l = solve_(pos, L, mid), r = solve_(pos, mid + 1, R);\n\treturn std::make_pair((l.first - 1) * r.second + r.first, l.second * r.second);\n}\npoly solve(int x, int top)\n{\n\tif (go[x][0])\n\t\tsolve(go[x][0], top);\n\tif (go[x][1])\n\t{\n\t\tv[top].push_back(~solve(go[x][1], go[x][1]));\n\t}\n\telse\n\t{\n\t\tpoly P; \n\t\tP.poly_ = {0, 1};\n\t\tv[top].push_back(P);\n\t}\n\tif (x == top)\n\t\treturn solve_(top, 0, v[top].size() - 1).first;\n\telse\n\t{\n\t\tpoly P;\n\t\treturn P;\n\t}\n}\nint main()\n{\n\tstd::cin >> n >> X;\n\tint x, y;\n\tfor (int i = 1; i < n; ++i)\n\t\tstd::cin >> x >> y, link(x, y);\n\tdfs0(1);\n\tpoly ret = solve(1, 1);\n\tX %= mod;\n\tint C = 1, ans = 0;\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\treduce(ans += static_cast<LL> (C) * ret.poly_[i] % mod - mod);\n\t\tC = static_cast<LL> (C) * pow(i, mod - 2) % mod * (X + i) % mod;\n\t}\n\tstd::cout << ans << std::endl;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1545208632,
        "uid": 26127,
        "name": "Weng_Weijie",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1010F \u3010Tree\u3011"
    },
    {
        "content": "\u8bb0\u5f55\u4e00\u4e0b\u81ea\u5df1 $O(n^{1.58})$ \u7684\u795e\u5947\u505a\u6cd5\u3002  \n\u9996\u5148\uff0c\u5bf9\u4f60\u9009\u51fa\u6765\u7684\u8fd9\u4e2a\u8fde\u901a\u5757\u8fdb\u884c\u6811\u4e0a\u5dee\u5206\uff0c\u6211\u4eec\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u628a $x$ \u7684\u6743\u503c\u653e\u5230\u8fd9\u4e2a\u8fde\u901a\u5757\u4e0a\uff0c\u8fd9\u4e2a\u7528\u63d2\u677f\u6cd5\u7b97\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\u6211\u4eec\u9700\u8981\u89e3\u51b3\u5982\u4f55\u6c42\u51fa\u5bf9\u4e8e\u6bcf\u4e2a $k$\uff0c\u5927\u5c0f\u4e3a $k$ \u5305\u542b\u6839\u7684\u8fde\u901a\u5757\u6570\u91cf\u3002  \n\u6211\u4eec\u6709\u4e00\u4e2a\u6734\u7d20\u7684 $O(n^2)$ \u6811\u5f62 dp\uff0c\u5373\u8bb0 $f_{u,k}$ \u4e3a $u$ \u5b50\u6811\u9009 $k$ \u4e2a\u70b9\u7684\u65b9\u6848\uff0c\u8f6c\u79fb $f_{u,1}=1,f_{u,j+k}=\\sum\\limits_{v\\in son_u} f_{u,j}\\times f_{v,k},f_{u,0}=1$\u3002\u6211\u4eec\u8003\u8651\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a\u6811\u5f62 dp\u3002  \n\u5bf9\u4e8e\u6811\u4e0a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u70b9\u5206\u6cbb\u3002\u5047\u8bbe\u6211\u4eec\u9700\u8981\u6c42\u51fa $u$ \u5b50\u6811\u7684 $f$\uff0c\u73b0\u5728\u627e\u5230\u4e86\u4e00\u4e2a\u91cd\u5fc3 $w$\u3002\u5982\u679c $u=w$\uff0c\u76f4\u63a5\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u6811\u5206\u5f00\u8ba1\u7b97\uff0c\u7136\u540e\u518d\u5206\u6cbb NTT \u5377\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86\u3002\u5982\u679c $u\\neq w$\uff0c\u5bf9\u4e8e\u4e0d\u5305\u542b $u$ \u7684\u5b50\u6811\uff0c\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u76f4\u63a5\u9012\u5f52\u8fdb\u53bb\u8ba1\u7b97\uff0c\u518d\u5206\u6cbb NTT \u5377\u8d77\u6765\u5f97\u5230 $w$ \u5b50\u6811\u7684 $f$\u3002\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u628a $u$ \u5b50\u6811\u7684 $f$ \u5206\u6210\u5305\u542b $w$ \u548c\u4e0d\u5305\u542b $w$ \u4e24\u90e8\u5206\u3002\u5bf9\u4e8e\u4e0d\u5305\u542b $w$ \u7684\u90e8\u5206\uff0c\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u8fdb $u$ \u53bb\u8ba1\u7b97\u3002\u5bf9\u4e8e\u5305\u542b $w$ \u7684\u90e8\u5206\uff0c\u6211\u4eec\u5fc5\u987b\u8981\u9009\u5b8c $u\\sim w$ \u8fd9\u6761\u94fe\u3002\u628a\u8fd9\u6761\u94fe\u9009\u5b8c\u4e4b\u540e\uff0c $u\\sim w$ \u8fd9\u6761\u94fe\u4e0a\u5176\u5b83\u7684\u513f\u5b50\u4e0e $w$ \u662f\u5e76\u5217\u5173\u7cfb\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u628a\u8fd9\u4e9b\u513f\u5b50\u4e5f\u5377\u8d77\u6765\uff08\u4e0b\u56fe\u7ea2\u8272\u90e8\u5206\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u9012\u5f52\u8fdb\u53bb\u6c42\u5b83\u4eec\u7684\u7b54\u6848\u3002  \n![](https://cdn.luogu.com.cn/upload/image_hosting/xghf07u9.png)  \n\u65f6\u95f4\u590d\u6742\u5ea6 $T(n)=3T(\\dfrac{n}{2})+O(n\\log^2n)$\uff0c\u7531\u4e3b\u5b9a\u7406 $T(n)=O(n^{\\log_23})\\approx O(n^{1.58})$\u3002  \n```cpp\n#include<bits/stdc++.h>\n#define fi first\n#define sc second\nusing namespace std;\ntypedef long long ll;\ntypedef vector<int>::iterator iter;\ntypedef vector<int> pl;\nconst int lim=18,maxn=(1<<lim)+5,mod=998244353,ig=332748118;\nint n,a[maxn],siz[maxn],mx[maxn],s,root,fa[maxn],dep[maxn],vis[maxn],tp,tot;\nbool bj[maxn];\npl e[maxn],v[maxn];\nll k,inv[maxn];\nvoid add(pl &a,pl b) {\n\tif(b.size()>a.size())swap(a,b);\n\tfor(int i=0; i<b.size(); i++)a[i]=(a[i]+b[i])%mod;\n}\nvoid prt(pl x) {\n\tfor(int i=0; i<x.size(); i++)cout<<x[i]<<\" \\n\"[i==x.size()-1];\n}\nll qpow(ll x,int y) {\n\tll w=1;\n\twhile(y) {\n\t\tif(y&1)w=w*x%mod;\n\t\tx=x*x%mod,y>>=1;\n\t}\n\treturn w;\n}\nnamespace poly {\n\tll inv[maxn],*t[maxn*4],*pw[lim][2],x[maxn],y[maxn],on[maxn];\n\tpl zc[maxn];\n\tint rev[maxn],las=-1,liv=1;\n\tint geto(int n) {\n\t\tfor(int i=lim-1; ~i; i--)\n\t\t\tif(n>>i&1)return 1<<i+(n!=1<<i);\n\t\treturn 1;\n\t}\n\tvoid clr(ll *a,int l,int r) {\n\t\tmemset(a+l,0,(r-l)*8);\n\t}\n\tvoid copy(ll *a,ll *b,int r) {\n\t\tmemcpy(a,b,r*8);\n\t}\n\tvoid NTT(ll *a,int n,bool pd) {\n\t\tif(n!=las)for(int i=0; i<n; i++)rev[i]=(rev[i>>1]>>1)|(i&1?n>>1:0),las=n;\n\t\tfor(int i=0; i<n; i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\t\tfor(int m=1,k=0; m<n; m<<=1,k++) {\n\t\t\tfor(int i=0; i<n; i+=m<<1)\n\t\t\t\tfor(int j=0; j<m; j++) {\n\t\t\t\t\tll y=pw[k][pd][j]*a[i+j+m]%mod;\n\t\t\t\t\ta[i+j+m]=a[i+j]-y+mod,a[i+j]+=y;\n\t\t\t\t}\n\t\t\tif(k%8==0||m*2>=n)for(int i=0; i<n; i++)a[i]%=mod;\n\t\t}\n\t}\n\tvoid init() {\n\t\tinv[1]=1;\n\t\tfor(int j=1; j<=(1<<lim); j++) {\n\t\t\tfor(int i=lim; ~i; i--)\n\t\t\t\tif(j>>i&1) {\n\t\t\t\t\ton[j]=1<<i+(j!=1<<i);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t}\n\t\tfor(int i=0,m=1; i<lim; i++,m<<=1) {\n\t\t\tconst ll b1=qpow(3,(mod-1)/m/2),b0=qpow(ig,(mod-1)/m/2);\n\t\t\tll *p0=pw[i][0]=new ll[m],*p1=pw[i][1]=new ll[m];\n\t\t\t*p0=*p1=1;\n\t\t\tfor(int j=1; j<m; j++)p1[j]=p1[j-1]*b1%mod,p0[j]=p0[j-1]*b0%mod;\n\t\t}\n\t}\n\tvoid mul(pl &a,const pl b) {\n\t\tint n=a.size(),m=b.size(),o=on[n+m-1];\n\t\tfor(int i=0; i<n; i++)x[i]=a[i];\n\t\tfor(int i=0; i<m; i++)y[i]=b[i];\n\t\tclr(x,n,o),clr(y,m,o),NTT(x,o,1),NTT(y,o,1);\n\t\tfor(int i=0; i<o; i++)x[i]=x[i]*y[i]%mod;\n\t\tNTT(x,o,0);\n\t\tconst int lim=n+m-1,invn=qpow(o,mod-2);\n\t\ta.resize(lim);\n\t\tfor(int i=0; i<lim; i++)a[i]=x[i]*invn%mod;\n\t}\n\tpl divide(int l,int r) {\n\t\tif(l==r)return zc[l];\n\t\tint mid=l+r>>1;\n\t\tpl f=divide(l,mid);\n\t\tpoly::mul(f,divide(mid+1,r));\n\t\treturn f;\n\t}\n}\nvoid dfs1(int u,int ff) {\n\tfa[u]=ff,dep[u]=dep[ff]+1;\n\tfor(iter it=e[u].begin(); it!=e[u].end(); it++)if(*it!=ff)dfs1(*it,u);\n}\nbool dfs(int u,int fa) {\n\tsiz[u]=1,mx[u]=0;\n\tbool pd=0;\n\tfor(iter it=e[u].begin(); it!=e[u].end(); it++) {\n\t\tif(vis[*it])pd=1;\n\t\telse if(*it!=fa)pd|=dfs(*it,u),siz[u]+=siz[*it],mx[u]=max(mx[u],siz[*it]);\n\t}\n\tmx[u]=max(mx[u],s-siz[u]);\n\tif(mx[u]<mx[root])root=u;\n\treturn pd;\n}\nvoid clr(int u,int fa,int k) {\n\tvis[u]=0;\n\tfor(iter it=e[u].begin(); it!=e[u].end(); it++)if(*it!=fa&&vis[*it]>=k)clr(*it,u,k);\n}\npl solve(int rt) {\n\ts=siz[rt],root=0;\n\tbool pd=dfs(rt,0);\n\tif(!pd&&bj[rt])return v[rt];\n\tvector<pl> z;\n\tint u=root;\n\twhile(u!=rt&&mx[fa[u]]<1.5*mx[root])u=fa[u];//\u5361\u5e38\uff0c\u5c06\u91cd\u5fc3\u79fb\u5230\u66f4\u9760\u4e0a\u7684\u4f4d\u7f6e\u51cf\u5c11\u7ea2\u8272\u5b50\u6811\u5927\u5c0f\n\tvis[u]=++tp;\n\tfor(iter it=e[u].begin(); it!=e[u].end(); it++) {\n\t\tif(vis[*it]||dep[*it]<dep[u])continue;\n\t\tz.push_back(solve(*it));\n\t}\n\tpl ans,now;\n\tif(u!=rt)ans=solve(rt);\n\telse ans.push_back(0);\n\tint dlt=dep[u]-dep[fa[rt]];\n\tif(z.size()) {\n\t\tfor(int i=0; i<z.size(); i++)poly::zc[i]=z[i];\n\t\tnow=poly::divide(0,z.size()-1),now.resize(now.size()+dlt);\n\t} else now.resize(dlt+1),now[0]=1;\n\tfor(int i=now.size()-dlt-1; ~i; i--)now[i+dlt]=now[i];\n\tfor(int i=0; i<dlt; i++)now[i]=0;//\u7531\u4e8e\u63d0\u524d\u9009\u4e86u-w\u8fd9\u6761\u94fe\uff0c\u6240\u4ee5w\u5b50\u6811\u5185\u7684f\u4f1a\u8fdb\u884c\u5e73\u79fb\n\tz.clear();\n\tint x=u;\n\twhile(x!=rt) {\n\t\tint y=fa[x];\n\t\tfor(iter it=e[y].begin(); it!=e[y].end(); it++) {\n\t\t\tif(vis[*it]<vis[u]||*it==x||*it==fa[y])continue;\n\t\t\tclr(*it,y,vis[u]),z.push_back(solve(*it));//\u8ba1\u7b97\u7ea2\u8272\u5b50\u6811\uff0c\u9012\u5f52\u524d\u8981\u6e05\u7a7a\u6807\u8bb0\n\t\t}\n\t\tx=y;\n\t}\n\tfor(int i=0; i<z.size(); i++)poly::zc[i]=z[i];\n\tif(z.size())poly::mul(now,poly::divide(0,z.size()-1));\n\tadd(ans,now);\n\tif(u==rt)ans[0]+=1;//\u4e0d\u9009u\u5b50\u6811\n\tif(!pd)bj[rt]=1,v[rt]=ans;\n\treturn ans;\n}\nint main() {\n\tint x,y;\n\tscanf(\"%d%lld\",&n,&k),poly::init(),inv[1]=1;\n\tfor(int i=2; i<=n; i++)inv[i]=mod-(mod/i)*inv[mod%i]%mod;\n\tfor(int i=1; i<n; i++) {\n\t\tscanf(\"%d%d\",&x,&y);\n\t\te[x].push_back(y),e[y].push_back(x);\n\t}\n\tmx[0]=1e9,s=n,dfs(1,0),dfs1(1,0);\n\tpl w=solve(1);\n\tll ans=0,now=1;\n\tfor(int i=1; i<=n; i++)ans=(ans+now*w[i])%mod,now=(k+i)%mod*inv[i]%mod*now%mod;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1657780207,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--CF1010F Tree"
    },
    {
        "content": "[Codeforces \u9898\u9762\u4f20\u9001\u95e8](https://codeforces.ml/contest/997/problem/D) & [\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1010F)\n\n\u795e\u4ed9\u9898\u3002\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u6309\u7167[\u8fd9\u9898](https://www.cnblogs.com/ET2006/p/arc096D.html)\u7684\u5957\u8def\uff0c\u8bb0 $t_i$ \u8868\u793a $i$ \u4e0a\u7684\u679c\u5b50\u6570\u91cf\u51cf\u53bb\u5176\u513f\u5b50\u679c\u5b50\u6570\u91cf\u4e4b\u548c\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u5408\u6cd5\u7684\u653e\u7f6e\u679c\u5b50\u7684\u65b9\u6848\uff0c\u5fc5\u7136\u6709 $t_i\\ge 0,\\sum\\limits_{i=1}^nt_i=X$\uff0c\u800c\u6839\u636e\u9694\u677f\u6cd5\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5927\u5c0f\u4e3a $s$ \u7684\u8fde\u901a\u5757\uff0c\u5206\u914d\u8be5\u8fde\u901a\u5757\u4e2d\u7684 $t_i$ \u7684\u65b9\u6848\u6570\u4e3a $\\dbinom{X+s-1}{s-1}$\uff0c\u56e0\u6b64\u5047\u8bbe\u5927\u5c0f\u4e3a $i$ \u7684\u8fde\u901a\u5757\u4e2a\u6570\u4e3a $c_i$\uff0c\u90a3\u4e48\u7b54\u6848\u5373\u4e3a $\\sum\\limits_{i=1}^nc_i\\dbinom{X+i-1}{i-1}$\uff0c\u540e\u9762\u90a3\u5768\u7ec4\u5408\u6570\u663e\u7136\u53ef\u4ee5\u9012\u63a8\u6c42\u51fa\uff0c\u56e0\u6b64\u6211\u4eec\u7684\u4efb\u52a1\u5c31\u662f\u6c42\u51fa $c_i$\u3002\n\n\u8003\u8651\u6811\u5f62 DP\uff0c$dp_{i,j}$ \u8868\u793a $i$ \u5b50\u6811\u5185\u5927\u5c0f\u4e3a $j$ \u7684\u8fde\u901a\u5757\u6709\u591a\u5c11\u4e2a\uff0c\u90a3\u4e48\u5047\u8bbe $u,v$ \u4e3a $i$ \u7684\u4e24\u4e2a\u513f\u5b50\uff0c\u90a3\u4e48\u663e\u7136\u6709 $dp_{i,j}=\\sum\\limits_{p+q=j-1}dp_{u,p}dp_{v,q}$\uff0c$dp_{i,0}=1$\u3002\u76f4\u63a5\u505a\u662f\u5e73\u65b9\u7684\uff0c\u4e0d\u8fc7\u6ce8\u610f\u5230\u8fd9\u4e1c\u897f\u4e00\u8138\u5377\u7684\u6837\u5b50\uff0c\u56e0\u6b64\u8003\u8651\u8bbe $F_i(x)$ \u8868\u793a $dp_i$ \u7684 OGF\uff0c\u90a3\u4e48\u6709 $F_i(x)=F_u(x)F_v(x)\u00b7x+1$\uff0c\u4f46\u662f\u76f4\u63a5\u5377\u4f9d\u7136\u4f1a\u88ab\u5361\u6210 $n^2\\log n$\u3002\u8fd9\u65f6\u5019\u5c31\u8981\u7528\u5230\u7c7b\u4f3c\u4e8e**\u52a8\u6001 $dp$ **\u7684\u601d\u8def\u4e86\uff0c\u6211\u4eec\u8003\u8651\u5bf9\u6574\u68f5\u6811\u8fdb\u884c\u6811\u94fe\u5256\u5206\u5e76\u5bf9\u4e8e\u4e00\u6761\u91cd\u94fe\u4e0a\u7684\u8282\u70b9\u6211\u4eec\u76f4\u63a5\u8ba1\u7b97\u5176\u94fe\u9876\u4e0a\u7684 $dp$ \u503c\uff0c\u90a3\u4e48\u5047\u8bbe\u8fd9\u6761\u91cd\u94fe\u4e0a\u7684\u70b9\u4ece\u4e0a\u81f3\u4e0b\u5206\u522b\u662f $p_1,p_2,p_3,\\cdots,p_k$\uff0c\u5e76\u4e14\u5bf9\u4e8e\u6bcf\u4e2a $p_i(i\\ne k)$\uff0c\u5176\u4e0d\u540c\u4e8e $p_{i+1}$ \u7684\u53e6\u4e00\u4e2a\u513f\u5b50\u4e3a $q_i$\uff08\u5982\u679c\u8fd9\u6837\u7684\u513f\u5b50\u4e0d\u5b58\u5728\u90a3\u6211\u4eec\u9ed8\u8ba4 $q_i=0,F_{q_i}=1$\uff09\uff0c\u90a3\u4e48\u663e\u7136 $F_{p_k}=x+1,F_{p_i}=xF_{q_i}F_{p_{i+1}}+1$\uff0c\u9012\u63a8\u4ee5\u4e0b\u53ef\u77e5 $F_{p_1}=\\sum\\limits_{i=1}^k\\prod\\limits_{j=k-i+1}^kxF_{q_i}$\u3002\u56e0\u6b64\u5230\u8fd9\u91cc\uff0c\u8be5\u95ee\u9898\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff0c\u6709 $k$ \u4e2a\u751f\u6210\u51fd\u6570 $a_1,a_2,\\cdots,a_k$\uff0c\u8981\u6c42 $a_1+a_1a_2+a_1a_2a_3+\\cdots+a_1a_2\\cdots a_k$ \u7684\u503c\u3002\u8be5\u95ee\u9898\u53ef\u4ee5\u5206\u6cbb FFT\uff08\u5176\u5b9e\u4e25\u683c\u6765\u8bf4\u4e0d\u80fd\u53eb\u5206\u6cbb FFT\uff0c\u56e0\u4e3a\u6ca1\u6709 cdq \u5206\u6cbb\uff09 \u6c42\u89e3\uff0c\u5177\u4f53\u6765\u8bf4\u5f53\u6211\u4eec\u5206\u6cbb\u5230\u533a\u95f4 $[l,r]$ \u65f6\u6211\u4eec\u6c42\u51fa $A_{l,r}=\\prod\\limits_{i=l}^ra_i$\uff0c\u4ee5\u53ca $B_{l,r}=\\sum\\limits_{i=l}^r\\prod\\limits_{j=i}^ra_j$\uff0c\u90a3\u4e48\u8bbe $mid=\\lfloor\\dfrac{l+r}{2}\\rfloor$\uff0c\u6709 $A_{l,r}=A_{l,mid}A_{mid+1,r},B_{l,r}=B_{l,mid}+A_{l,mid}B_{mid+1,r}$\uff0c\u5206\u6cbb\u6c42\u89e3\u5373\u53ef\u3002\n\n\u81f3\u4e8e\u590d\u6742\u5ea6\uff0c\u5927\u6982\u5c31\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u5176\u6700\u591a\u4f1a\u5bf9 $\\log n$ \u4e2a\u591a\u9879\u5f0f\u7684\u5ea6\u4ea7\u751f $1$ \u7684\u8d21\u732e\uff0c\u518d\u52a0\u4e0a\u5206\u6cbb FFT \u7684\u590d\u6742\u5ea6\uff0c\u603b\u590d\u6742\u5ea6 $n\\log^3n$\n\nu1s1 vector \u5b9e\u73b0\u7684 NTT \u662f\u771f\u7684\u597d\u5199\uff0c\u4f46\u5e38\u6570\u662f\u771f\u7684\u5927\u2026\u2026\u628a\u591a\u9879\u5f0f\u5377\u79ef\u91cc\u7684 vector \u6362\u6210\u6570\u7ec4\u540e\u5e38\u6570\u7adf\u4e00\u4e0b\u5b50\u5c06\u4e3a\u539f\u6765\u7684 $\\dfrac{1}{8}$\u2026\u2026\n\n\u8d34\u4e2a\u7a0d\u5fae\u80fd\u770b\u70b9\u7684\u4ee3\u7801\uff1a\n\n```cpp\nconst int MAXN=1e5;\nconst int MAXP=1<<18;\nconst int pr=3;\nconst int ipr=332748118;\nconst int MOD=998244353;\nint inv[MAXN+5];\nint qpow(int x,int e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint rev[MAXP+5],A[MAXP+5],B[MAXP+5],C[MAXP+5];\nvoid NTT(int *a,int len,int type){\n\tint lg=31-__builtin_clz(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<lg-1);\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=qpow((type<0)?ipr:pr,(MOD-1)/i);\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tfor(int k=0,w=1;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*a[(i>>1)+j+k]*w%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(!~type){\n\t\tint ivn=qpow(len,MOD-2);\n\t\tfor(int i=0;i<len;i++) a[i]=1ll*a[i]*ivn%MOD;\n\t}\n}\nvector<int> conv(vector<int> x,vector<int> y){\n\tif(x.size()+y.size()<=16){\n\t\tvector<int> res(x.size()+y.size()-1);\n\t\tfor(int i=0;i<x.size();i++) for(int j=0;j<y.size();j++)\n\t\t\tres[i+j]=(res[i+j]+1ll*x[i]*y[j])%MOD;\n\t\treturn res;\n\t}\n\tint LEN=1;while(LEN<x.size()+y.size()) LEN<<=1;\n\tfor(int i=0;i<LEN;i++) A[i]=B[i]=C[i]=0;\n\tfor(int i=0;i<x.size();i++) A[i]=x[i];\n\tfor(int i=0;i<y.size();i++) B[i]=y[i];\n\tNTT(A,LEN,1);NTT(B,LEN,1);\n\tfor(int i=0;i<LEN;i++) C[i]=1ll*A[i]*B[i]%MOD;NTT(C,LEN,-1);\n\tvector<int> res;for(int i=0;i<x.size()+y.size()-1;i++) res.pb(C[i]);\n\treturn res;\n}\nint n,hd[MAXN+5],to[MAXN*2+5],nxt[MAXN*2+5],ec=0;ll X;\nvoid adde(int u,int v){to[++ec]=v;nxt[ec]=hd[u];hd[u]=ec;}\nint siz[MAXN+5],wson[MAXN+5],fa[MAXN+5];\nvoid dfs0(int x,int f){\n\tsiz[x]=1;fa[x]=f;\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f) continue;\n\t\tdfs0(y,x);siz[x]+=siz[y];\n\t\tif(siz[y]>siz[wson[x]]) wson[x]=y;\n\t}\n}\nvector<vector<int> > p;\nvector<int> dp[MAXN+5];\nvoid addzero(vector<int> &v){v.insert(v.begin(),0);}\nvector<int> plus_one(vector<int> v){(v[0]+=1)%=MOD;return v;}\nvector<int> minus_one(vector<int> v){(v[0]+=MOD-1)%=MOD;return v;}\nvector<int> plus_vec(vector<int> a,vector<int> b){\n\tif(a.size()<b.size()) swap(a,b);b.resize(a.size(),0);\n\tfor(int i=0;i<a.size();i++) (a[i]+=b[i])%=MOD;\n\treturn a;\n}\npair<vector<int>,vector<int> > solve(int l,int r){\n\tif(l==r) return mp(plus_one(p[l]),p[l]);int mid=l+r>>1;\n\tpair<vector<int>,vector<int> > L=solve(l,mid);\n\tpair<vector<int>,vector<int> > R=solve(mid+1,r);\n//\tprintf(\"%d %d %d %d!!!\\n\",L.fi.size(),L.se.size(),R.fi.size(),R.se.size());\n\treturn mp(plus_vec(conv(minus_one(L.fi),R.se),R.fi),conv(L.se,R.se));\n}\nvoid dfs(int x){\n\tif(!wson[x]) return dp[x]=vector<int>(2,1),void();\n\tfor(int y=x;y;y=wson[y]){\n\t\tfor(int e=hd[y];e;e=nxt[e]){\n\t\t\tint z=to[e];if(z==fa[y]||z==wson[y]) continue;\n\t\t\tdfs(z);\n\t\t}\n\t} p.clear();\n\tfor(int y=x;y;y=wson[y]){\n\t\tbool flg=0;\n\t\tfor(int e=hd[y];e;e=nxt[e]){\n\t\t\tint z=to[e];if(z==fa[y]||z==wson[y]) continue;\n\t\t\taddzero(dp[z]);p.pb(dp[z]);flg=1;\n\t\t} if(!flg) p.pb(minus_one(vector<int>(2,1)));\n\t} assert(!p.empty());reverse(p.begin(),p.end());\n\tdp[x]=solve(0,p.size()-1).fi;//printf(\"%d: \",x);\n//\tfor(int i=0;i<dp[x].size();i++) printf(\"%d \",dp[x][i]);\n//\tprintf(\"!\\n\");\n}\nint main(){\n\tscanf(\"%d%lld\",&n,&X);X%=MOD;\n\tfor(int i=1,u,v;i<n;i++){scanf(\"%d%d\",&u,&v);adde(u,v),adde(v,u);}\n\tdfs0(1,0);dfs(1);int ans=0;\n\tfor(int i=(inv[0]=inv[1]=1)+1;i<=n;i++) inv[i]=1ll*inv[MOD%i]*(MOD-MOD/i)%MOD;\n//\tfor(int i=0;i<dp[1].size();i++) printf(\"%d%c\",dp[1][i],\" \\n\"[i+1==dp[1].size()]);\n\tfor(int i=1,t=1;i<dp[1].size();i++){\n\t\tans=(ans+1ll*dp[1][i]*t)%MOD;\n\t\tt=1ll*t*(X+i)%MOD*inv[i]%MOD;\n\t} printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1628260548,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1010F Tree"
    }
]