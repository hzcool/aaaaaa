[
    {
        "content": "\u770b\u5230\u5176\u4ed6\u9898\u89e3\u90fd\u662f\u679a\u4e3e\u7aef\u70b9\u5411\u4e0a\u5411\u4e0b dp \uff0c\u4e8b\u5b9e\u4e0a\u679a\u4e3e LCA \u4e5f\u662f\u53ef\u884c\u7684\u3002\n\n## \u7ea6\u5b9a\n\n\u4ee4 $M(i,j)=\\prod_{k=i}^{i+j-1}a_k$ \u3002\n\n\u4ee4 $g_i=\\prod_{k=1}^{i}a_i$ \u3002\n\n\u8bbe $Ans_i$ \u8868\u793a\u957f\u5ea6\u4e3a $i$ \u7684\u8def\u5f84\u4e2a\u6570\uff0c\u5373\u7b54\u6848\u3002\n\n## \u5206\u7c7b\u8ba8\u8bba\n\n#### \u4e00\u3001\u6709\u4e00\u4e2a\u7aef\u70b9\u4e3a LCA\n\n\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u679a\u4e3e LCA \u7684\u6df1\u5ea6\uff0c\u7136\u540e\u679a\u4e3e\u94fe\u7684\u957f\u5ea6\u6765\u8ba1\u7b97\uff0c\u4e5f\u5373\n$$Ans_t\\leftarrow Ans_t+\\sum_{i=1}^{n-1}M(i,t)M(1,i-1)$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$ \u3002\n\n#### \u4e8c\u3001\u6ca1\u6709\u7aef\u70b9\u4e3a LCA\n\n\u8fd9\u79cd\u60c5\u51b5\u9700\u8981\u679a\u4e3e LCA \u7684\u6df1\u5ea6\uff0c\u518d\u679a\u4e3e\u5de6\u53f3\u513f\u5b50\u5206\u522b\u7684\u6df1\u5ea6\uff0c\u5373\n\n$$Ans_t\\leftarrow Ans_t+\\sum_{i=1}^{n-1}\\binom{a_i}{2}M(1,i-1)\\sum_{j=1}^{t-1}M(i+1,j-1)M(i+1,t-j-1)$$\n\n\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^3)$ \u7684\uff0c\u8003\u8651\u4f18\u5316\uff0c\u6211\u4eec\u628a $M(i,j)$ \u62c6\u6210 $\\frac{g_{i+j-1}}{g_{i-1}}$ \u7684\u5f62\u5f0f\uff0c\u6574\u7406\u4e00\u4e0b\u5f0f\u5b50\uff1a\n\n$$\nAns_t\\leftarrow Ans_t+\\sum_{i=1}^{n-1}g_{i-1}\\frac{1}{g_i^2}\\binom{a_i}{2}\\sum_{j=1}^{t-1}g_{i+j-1}g_{i+t-j-1}\n$$\n\n\u89c2\u5bdf\u5230\u540e\u9762\u8fd9\u4e2a $\\sum_{j=1}^{t-1}g_{i+j-1}g_{i+t-j-1}$ \u7684\u5377\u79ef\u5f0f\uff0c\u8003\u8651\u9884\u5904\u7406\u5b83\u3002\n\n\u6211\u4eec\u8bbe $f_{t,i}=\\sum_{j=1}^{t-1}g_{i+j-1}g_{i+t-j-1}$ \uff0c\u4e0d\u96be\u53d1\u73b0 $f_{t,i}=f_{t-2,i+1}+2g_ig_{i+t-2}(t>2)$ \uff0c\u800c $f_{2,i}=g_i^2$ \u3002\n\n\u56e0\u6b64 $f_{t,i}$ \u80fd\u591f\u88ab $O(n^2)$ \u9012\u63a8\u51fa\u6765\uff0c\u8fd9\u6837\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u53d8\u6210\u4e86 $O(n^2)$ \u3002\n\n## Code\n```cpp\nint a[MAXN], _g[MAXN << 2], g[MAXN << 2], Ans[MAXN << 2], f[MAXN << 1][MAXN];\nint upd(int x, int y) { return x + y >= mods ? x + y - mods : x + y; }\nint quick_pow(int x, int y) {\n\tint ret = 1;\n\tfor (; y ; y >>= 1) {\n\t\tif (y & 1) ret = 1ll * ret * x % mods;\n\t\tx = 1ll * x * x % mods;\n\t}\n\treturn ret;\n}\nsigned main() {\n#ifndef ONLINE_JUDGE\n\tfreopen(\"a.in\", \"r\", stdin);\n#endif\n\tint n;\n\tread(n), g[0] = 1;\n\tfor (int i = 1; i < n ; ++ i) read(a[i]), g[i] = 1ll * g[i - 1] * a[i] % mods, _g[i] = quick_pow(g[i], mods - 2);\n\tfor (int t = 1; t < n ; ++ t)\n\t\tfor (int i = 1; i <= n - t ; ++ i)\n\t\t\tAns[t] = upd(Ans[t], g[i + t - 1]);\n\n\tfor (int i = 1; i < n ; ++ i) f[2][i] = 1ll * g[i] * g[i] % mods;\n\tfor (int t = 3; t <= n + n - 2 ; ++ t)\n\t\tfor (int i = 1; i < n ; ++ i)\n\t\t\tf[t][i] = upd(f[t - 2][i + 1], 2ll * g[i] * g[i + t - 2] % mods);\n\n\tfor (int t = 2; t <= n + n - 2 ; ++ t)\n\t\tfor (int i = 1; i < n ; ++ i)\n\t\t\tAns[t] = upd(Ans[t], 1ll * (a[i] - 1) * inv2 % mods * _g[i] % mods * f[t][i] % mods);\n\n\tfor (int t = 1; t <= n + n - 2 ; ++ t) print(Ans[t]), putc(' ');\n\treturn 0;\n}\n```\n",
        "postTime": 1625490203,
        "uid": 32063,
        "name": "fade_away",
        "ccfLevel": 0,
        "title": "CF954H Path Counting"
    },
    {
        "content": "[\u535a\u5ba2\u94fe\u63a5](https://www.cnblogs.com/Laoli-2020/p/16696709.html)\n\n\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u5b9a\u4e00\u9897\u4ee5 $1$ \u4e3a\u6839\uff0c\u6df1\u5ea6\u4e3a $n$ \u7684\u6709\u6839\u6811\uff08\u89c4\u5b9a\u6839\u7684\u6df1\u5ea6\u4e3a $1$\uff09\uff0c\u6811\u4e0a\u6bcf\u4e00\u4e2a\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u90fd\u6709 $a_i$ \u4e2a\u513f\u5b50\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $k \\in [1,2n-2]$ \u6c42\u51fa\u957f\u5ea6\u4e3a $k$ \u7684\u8def\u5f84\u6570\u91cf\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$2 \\le n \\le 5000$\uff0c$2 \\le a_i \\le 10^9$\u3002\n\n\u8def\u5f84\u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u79cd\u4e3a\u4e24\u7aef\u70b9\u7684LCA\u5728\u8def\u5f84\u4e2d\u95f4\uff08\u4e0d\u5728\u7aef\u70b9\u4e0a\uff09\uff0c\u53e6\u4e00\u79cd\u4e3a\u4e24\u7aef\u70b9\u7684LCA\u5728\u7aef\u70b9\u4e0a\uff0c\u6211\u4eec\u5206\u522b\u6c42\u89e3\uff0c\u7136\u540e\u5c06\u8def\u5f84\u6570\u91cf\u76f8\u52a0\u3002\n\n#### LCA\u5728\u8def\u5f84\u4e2d\u95f4\n\u6211\u4eec\u8003\u8651\u5728LCA\u5904\u7edf\u8ba1\u8def\u5f84\u6570\u3002\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u4ee5\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u4e3aLCA\u7684\u8def\u5f84\u4e2d\uff0c\u957f\u5ea6\u4e3a $j$ \u7684\u6709\u591a\u5c11\u6761\u3002\n\n\u6211\u4eec\u8003\u8651\u5982\u4f55\u8ba1\u7b97 $f_{i,j}$\uff0c\u6709\u4e00\u4e2a\u975e\u5e38\u663e\u7136\u7684\u5f0f\u5b50\uff0c\u5c31\u662f\u679a\u4e3e\u5de6\u53f3\u7aef\u70b9\u7684\u6df1\u5ea6\uff0c\u7136\u540e\u8ba1\u7b97\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u7aef\u70b9\u7684LCA\u6df1\u5ea6\u4e3a $i$ \u7684\u65b9\u6848\u6570\uff0c\u5373\uff1a\n\n$$\n\\large f_{i,j}=\\frac{a_i \\times (a_i-1)} 2 \\times \\sum_{k=i+1}^{i+j-1}(\\prod_{x=i+1}^{k-1} a_x \\prod_{x=i+1}^{j-k-1} a_x) \n$$\n\n\u5f0f\u5b50\u7684\u542b\u4e49\u5c31\u662f\u5148\u9009\u51fa\u8be5\u8282\u70b9\u7684\u4e24\u4e2a\u513f\u5b50\uff0c\u7136\u540e\u4ece\u8fd9\u4e24\u4e2a\u513f\u5b50\u5411\u4e0b\u6269\u5c55\u8def\u5f84\uff0c\u4e00\u4e2a\u6269\u5c55 $k-1$ \u957f\u5ea6\uff0c\u53e6\u5916\u4e00\u4e2a\u6269\u5c55 $j-k-1$\uff0c\u53ef\u4ee5\u7b80\u5355\u524d\u7f00\u79ef\u4f18\u5316\u4e00\u4e0b\u505a\u5230 $O(N^3)$\u3002\n\n\u9700\u8981\u8fdb\u884c\u4f18\u5316\uff0c\u6ce8\u610f\u5230 $f_{i,j}$ \u5f0f\u5b50\u53f3\u8fb9\u7684\u5f0f\u5b50\u548c $f_{i+1,j-2}$ \u7684\u5f88\u50cf\uff0c\u6211\u4eec\u628a\u8fd9\u4e24\u4e2a\u5f0f\u5b50\u653e\u5728\u4e00\u8d77\u3002\n\n\n\n$$\\large f_{i,j}=\\frac{a_i \\times (a_i-1)} 2 \\times \\sum_{k=i+1}^{i+j-1}(\\prod_{x=i+1}^{k-1} a_x \\prod_{x=i+1}^{j-k-1} a_x) $$\n$$\n\\large f_{i+1,j-2}=\\frac{a_{i+1} \\times (a_{i+1}-1)} 2 \\times \\sum_{k=i+2}^{i+j-2}(\\prod_{x=i+2}^{k-1} a_x \\prod_{x=i+2}^{j-k-3} a_x)$$\n\n\u53d1\u73b0 $f_{i,j}$ \u7684\u5927\u90e8\u5206\u8d21\u732e\u90fd\u662f\u4ece $\\frac{a_i \\times (a_i-1)} 2 \\times f_{i+1,j-2} \\times \\frac{2a_{i+1}}{a_{i+1}-1}$\uff0c\u9664\u53bb $k=1$ \u548c $k=i+j-1$ \u7684\u60c5\u51b5\uff0c\u8fd9\u4e24\u79cd\u60c5\u51b5\u7528\u524d\u7f00\u79ef\u7b97\u4e0a\u5c31\u597d\u4e86\u3002\n\n\u6700\u540e\uff0c$f_{i,j}$ \u4e58\u4e0a\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u7684\u6570\u91cf\u5c31\u662f\u8fd9\u4e00\u90e8\u5206\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\u4e86\u3002\n\n#### LCA\u5728\u7aef\u70b9\n\u8fd9\u4e2a\u66f4\u597d\u505a\u4e86\uff0cLCA\u5728\u7aef\u70b9\u7684\u8def\u5f84\u4e2d\u957f\u5ea6\u4e3a $i$ \u7684\u53ea\u6709\u53ef\u80fd\u5728\u6df1\u5ea6\u5927\u4e8e $i$ \u7684\u70b9\u53d6\u5230\uff0c\u7edf\u8ba1\u6bcf\u4e2a\u6df1\u5ea6\u6709\u591a\u5c11\u4e2a\u70b9\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=5005;\nconst int mod=1000000007;\nint n;\nint a[maxn];\nint f[maxn][maxn*2],g[maxn*2],inv[maxn];\nint power(int x,int y)\n{\n\tint ans=1;\n\twhile(y)\n\t{\n\t\tif(y&1)\n\t\t\tans=1ll*ans*x%mod;\n\t\ty>>=1;\n\t\tx=1ll*x*x%mod;\n\t}\n\treturn ans;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++)\n\t\tscanf(\"%d\",&a[i]),inv[i]=power(a[i]-1,mod-2);\n\tf[n-1][2]=1ll*a[n-1]*(a[n-1]-1)/2%mod;\n\tfor(int i=n-2;i>=1;i--)\n\t{\n\t\tfor(int p=2*n-2;p>=2;p--)\n\t\t\tf[i][p]=1ll*a[i]*(a[i]-1)/2%mod*f[i+1][p-2]%mod*inv[i+1]%mod*2ll%mod*a[i+1]%mod;//\u4ecef[i+1][p-2]\u8f6c\u79fb\u8d21\u732e\n\t\t//\u52a0\u4e0ak=1\u548ck=i+j-1\u7684\u8d21\u732e\n\t\tf[i][2]=(f[i][2]+1ll*a[i]*(a[i]-1)/2%mod)%mod;\n\t\tint cnt=1;\n\t\tfor(int p=3;p<=2*n-2;p++)\n\t\t{\n\t\t\tcnt=1ll*cnt*a[i+p-2]%mod;\n\t\t\tf[i][p]=(f[i][p]+1ll*a[i]*(a[i]-1)%mod*cnt%mod)%mod;\n\t\t}\n\t}\n\tint cnt=1,sum=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=2*n-2;j++)\n\t\t\tg[j]=(g[j]+1ll*cnt*f[i][j]%mod)%mod;//\u8ba1\u7b97\u5bf9\u7b54\u6848\u7684\u8d21\u732e\n\t\tsum=(sum+cnt)%mod;\n\t\tcnt=1ll*cnt*a[i]%mod;\n\t}\n\tcnt=1;int num=0;\n\tfor(int i=1;i<n;i++)\n\t\tnum=(num+cnt)%mod,g[i]=(0ll+g[i]+sum-num+mod)%mod,cnt=1ll*cnt*a[i]%mod;//LCA\u5728\u7aef\u70b9\u7684\u8def\u5f84\n\tfor(int i=1;i<=2*n-2;i++)\n\t\tprintf(\"%d \",g[i]);\n\tputs(\"\");\n\t\n\treturn 0;\n}\n```",
        "postTime": 1663227435,
        "uid": 104711,
        "name": "\u6211\u6253",
        "ccfLevel": 0,
        "title": "Path Counting\u9898\u89e3"
    },
    {
        "content": "\u51fa\u4e8e\u4e2a\u4eba\u4e60\u60ef\uff0c\u6211\u4eec\u628a\u539f\u9898\u7684 $a_{[1,n-1]}$ \u6574\u4f53\u5e73\u79fb\u5230 $a_{[2,n]}$\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u4ee4 $g_{i,j}$ \u8868\u793a\u4e00\u4e2a\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u6709\u591a\u5c11\u4e2a\u6df1\u5ea6\u4e3a $i+j$ \u7684\u5b50\u5b59\uff0c\u663e\u7136\u8fd9\u4e9b\u5b50\u5b59\u5230\u8fd9\u4e2a\u70b9\u7684\u8ddd\u79bb\u4e3a $j$\u3002\n\n\u5176\u5b9e\u6211\u4e00\u5f00\u59cb\u8bbe\u7684\u662f\u6df1\u5ea6\u4e3a $j$\uff0c\u6ca1\u5565\u533a\u522b\uff0c\u53ea\u662f\u540e\u9762\u5f0f\u5b50\u91cc\u4e0a\u9762\u7684\u8bbe\u6cd5\u4f1a\u8212\u670d\u4e00\u70b9\u3002\n\n\u90a3\u4e48\u663e\u7136\u6709 $g_{i,j}=\\prod_{k=i+1}^ja_k$\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u8def\u5f84\u4e24\u7aef\u7684 LCA \u7684\u6df1\u5ea6 $i$\uff0c\u5bf9\u4e8e\u4e00\u7aef\u5c31\u662f LCA \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u76f4\u63a5\u5c06 $g_{i,j}$ \u52a0\u5230 $ans_j$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u5269\u4e0b\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u5217\u51fa\u4ee5\u4e0b\u5f0f\u5b50\u3002\n\n$\\binom{a_{i+1}}{2}\\sum_{k=0}^jg_{i+1,k}\\times g_{i+1,j-k}\\to ans_j$\u3002\n\n\u7136\u540e\u5c31\u6709\u4e86\u4e00\u4e2a $O(n^3)$ \u7684\u505a\u6cd5\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u628a\u8fd9\u90e8\u5206\u5355\u72ec\u63d0\u51fa\u6765\u3002\n\n\u8bbe $f_{i,j}=\\sum_{k=0}^jg_{i,k}\\times g_{i,j-k}$\u3002\n\n\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6027\u8d28\u5728\u4e8e $g_{i,j}=\\frac{g_{i-1,j+1}}{a_i}$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u8f6c\u79fb\u548c $j$ \u65e0\u5173\u3002\u7136\u540e\u6bcf\u4e2a $g_{i,j}$ \u90fd\u6709\u4e2a $\\frac{1}{a_i}$ \u610f\u5473\u7740 $f_{i,j}$ \u6574\u4f53\u6709\u4e00\u4e2a $\\frac{1}{a_i^2}$\u3002\n\n\u7136\u540e\u6ce8\u610f $g_{i-1,j+1}$\uff0c\u76f8\u5f53\u4e8e\u96c6\u4f53\u5e73\u79fb\u4e00\u4f4d\uff0c\u90a3\u4e48\u5bf9\u5e94\u5230 $f_{i,j}$ \u5c31\u662f\u96c6\u4f53\u5e73\u79fb\u4e24\u904d\u3002\n\n\u90a3\u4e48\u6211\u4eec\u628a\u7279\u6b8a\u7684 $g_{i-1,0}$ \u7684\u5f71\u54cd\u51cf\u6389\u540e\uff0c\u6709 $f_{i,j}=\\frac{f_{i-1,j+2}}{a_i^2}$\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u7528 $O(n^2)$ \u7684\u590d\u6742\u5ea6\u6c42\u51fa\u4e86 $f_{i,j}$\u3002\n\nhttps://codeforces.com/contest/954/submission/183982007",
        "postTime": 1670250069,
        "uid": 115936,
        "name": "\u6cf7\u6cfd\u4e09\u6708",
        "ccfLevel": 0,
        "title": "CF954H"
    }
]