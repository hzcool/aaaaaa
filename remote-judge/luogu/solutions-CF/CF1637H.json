[
    {
        "content": "\u5728\u535a\u5ba2\u56ed\u98df\u7528\u66f4\u4f73\uff1a[https://www.cnblogs.com/PinkRabbit/p/CF1637.html](https://www.cnblogs.com/PinkRabbit/p/CF1637.html)\u3002\n\n**\u3010\u9898\u610f\u7b80\u8ff0\u3011**\n\n\u7ed9\u5b9a\u4e00\u4e2a $1 \\sim n$ \u7684\u6392\u5217 $p_1, p_2, \\ldots, p_n$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $k = 0, 1, \\ldots, n$\uff1a\n\n- \u4f60\u9700\u8981\u5728 $p_1, p_2, \\ldots, p_n$ \u4e2d\u53d6\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $k$ \u7684\u5b50\u5e8f\u5217\uff0c\u5e76\u5c06\u5176\u6309\u539f\u987a\u5e8f\u79fb\u52a8\u5230 $p$ \u7684\u5f00\u5934\u3002\n- \u4f60\u9700\u8981\u6c42\u51fa\u5728\u6240\u6709\u9009\u53d6\u65b9\u6848\u4e2d\u7684\u9006\u5e8f\u5bf9\u6570\u7684\u6700\u5c0f\u503c\u3002\n\n\u8f93\u51fa\u8fd9 $n + 1$ \u4e2a\u7b54\u6848\u3002\n\n**\u3010\u9898\u89e3\u3011**\n\n\u8003\u8651 $k = 1$ \u65f6\u7684\u60c5\u51b5\uff0c\u5373\u9009\u53d6\u4e00\u4e2a\u6570\u79fb\u52a8\u5230\u9996\u4f4d\u3002\n\n- \u5982\u679c\u9009\u53d6\u4e86 $p_i$\uff0c\u9006\u5e8f\u5bf9\u6570\u5c06\u51cf\u5c11 $\\displaystyle \\sum_{j = 1}^{i - 1} [p_j > p_i] - \\sum_{j = 1}^{i - 1} [p_j < p_i]$\uff0c\u5373\u4f4d\u7f6e $i$ \u4e4b\u524d\u7684\u4e0e $p_i$ \u6784\u6210\u7684\u9006\u5e8f\u5bf9\u6570\u51cf\u53bb\u987a\u5e8f\u5bf9\u6570\u3002\n- \u5c06\u8fd9\u4e2a\u6570\u8bb0\u4e3a $d_i$\u3002\n\n\u663e\u7136\uff0c\u5f53 $k = 1$ \u65f6\uff0c\u5373\u662f\u9009\u62e9 $d_i$ \u6700\u5927\u7684\u90a3\u4e2a\u79fb\u52a8\u5230\u9996\u4f4d\u5373\u53ef\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5f53 $k \\ge 2$ \u65f6\uff0c\u9006\u5e8f\u5bf9\u6570\u7684\u53d8\u5316\u91cf\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u5982\u679c\u6309\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u5c06\u9009\u53d6\u7684\u5b50\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u79fb\u5230\u9996\u4f4d\uff0c\u5219\u53d8\u5316\u91cf\u6070\u597d\u4e3a\u5b50\u5e8f\u5217\u7684 $d_i$ \u4e4b\u548c\u3002\u7136\u800c\u5982\u6b64\u64cd\u4f5c\u540e\u5f97\u5230\u7684\u6392\u5217\u4e0e\u5b9a\u4e49\u4e0d\u540c\uff1a\u9009\u53d6\u7684\u5b50\u5e8f\u5217\u88ab\u7ffb\u8f6c\u4e86\uff0c\u4e8e\u662f\u9700\u8981\u5c06\u5b50\u5e8f\u5217\u7ffb\u8f6c\u56de\u6765\uff0c\u6545\u539f\u5e8f\u5217\u7684\u9006\u5e8f\u5bf9\u6570\u5c06\u51cf\u5c11\u300c\u9009\u53d6\u7684\u5b50\u5e8f\u5217\u4e2d\u7684\u987a\u5e8f\u5bf9\u6570\u51cf\u53bb\u9006\u5e8f\u5bf9\u6570\u300d\u3002\n\n\u5373\uff0c\u5047\u8bbe\u9009\u53d6\u7684\u5b50\u5e8f\u5217\u4e0b\u6807\u4e3a $\\{ i_1, i_2, \\ldots, i_k \\}$\uff0c\u5b50\u5e8f\u5217\u4e3a $q_1, q_2, \\ldots, q_k$\uff08$q_i = p_{i_j}$\uff09\uff0c\u5219\u539f\u5e8f\u5217\u7684\u9006\u5e8f\u5bf9\u6570\u7b49\u4e8e $\\displaystyle \\operatorname{inv}(p_{1 \\sim n}) - \\left( \\sum_{j = 1}^{k} d_{i_j} + \\left( \\left( \\binom{k}{2} - \\operatorname{inv}(q_{1 \\sim k}) \\right) - \\operatorname{inv}(q_{1 \\sim k}) \\right) \\right)$\uff0c\u5176\u4e2d $\\displaystyle \\binom{k}{2} - \\operatorname{inv}(q_{1 \\sim k})$ \u4e00\u9879\u5373\u4e3a\u987a\u5e8f\u5bf9\u6570\u3002\n\n\u6574\u7406\u4e00\u4e0b\u5373\u5f97\u5230\u9700\u8981\u6700\u5927\u5316 $\\displaystyle \\sum_{j = 1}^{k} d_{i_j} - 2 \\operatorname{inv}(q_{1 \\sim k})$\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5173\u952e\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u9006\u5e8f\u5bf9 $(i, j)$\uff08\u5373 $i < j$ \u4e14 $p_i > p_j$\uff09\uff0c\u5982\u679c $i$ \u88ab\u9009\u53d6\u5728\u5b50\u5e8f\u5217\u4e2d\uff0c\u5219 $j$ \u4e5f\u88ab\u9009\u53d6\u5728\u5b50\u5e8f\u5217\u4e2d\u4e00\u5b9a\u4e0d\u66f4\u52a3\u3002\u6211\u4eec\u4f7f\u7528\u53cd\u8bc1 + \u8c03\u6574\u6cd5\u8bc1\u660e\u6b64\u7ed3\u8bba\uff1a\n\n- \u5047\u8bbe\u5b58\u5728\u9006\u5e8f\u5bf9 $(i, j)$ \u4e14 $p_i$ \u88ab\u9009\u53d6\u800c $p_j$ \u672a\u88ab\u9009\u53d6\uff0c\u6211\u4eec\u5c06\u8bc1\u660e\u5b58\u5728\u6bd4\u6b64\u79cd\u60c5\u51b5\u4e0d\u66f4\u52a3\u7684\u60c5\u51b5\u3002\n- \u7531\u4e8e\u6ee1\u8db3\u6b64\u6761\u4ef6\u7684\u9006\u5e8f\u5bf9\u5b58\u5728\uff0c\u8003\u8651\u9009\u53d6\u5176\u4e2d $i, j$ \u8ddd\u79bb\u6700\u5c0f\u7684\u90a3\u4e00\u5bf9\uff0c\u5373 $j - i$ \u6700\u5c0f\u7684\u4e14\u6ee1\u8db3 $i$ \u88ab\u9009\u53d6\u800c $j$ \u672a\u88ab\u9009\u53d6\u7684\u9006\u5e8f\u5bf9\u3002\n- \u7531\u6b64\uff0c\u5728 $i, j$ \u4e4b\u95f4\u4e0d\u5b58\u5728\uff1a\n  \n  - \u503c\u5728 $p_j$ \u4e0e $p_i$ \u4e4b\u95f4\u7684\u5143\u7d20\uff1b\n  - \u503c\u5927\u4e8e $p_i$ \u4e14\u5df2\u88ab\u9009\u53d6\u7684\u5143\u7d20\uff1b\n  - \u503c\u5c0f\u4e8e $p_j$ \u4e14\u672a\u88ab\u9009\u53d6\u7684\u5143\u7d20\u3002\n  \n  \u5426\u5219\uff0c\u5c06\u4e0e $j - i$ \u7684\u6700\u5c0f\u6027\u77db\u76fe\u3002\n- \u8003\u8651\u5c06 $i$ \u4ece\u5b50\u5e8f\u5217\u4e2d\u5220\u53bb\uff0c\u5e76\u52a0\u5165 $j$\uff0c\u8003\u5bdf\u5143\u7d20 $p_k$ \u5bf9\u6700\u7ec8\u9006\u5e8f\u5bf9\u6570\u91cf\u7684\u8d21\u732e\uff1a\n  \n  - \u5982\u679c $k < i$ \u4e14 $p_k$ \u88ab\u9009\u53d6\uff1a$p_k$ \u4e0e $p_i, p_j$ \u7684\u76f8\u5bf9\u4f4d\u7f6e\u65e0\u53d8\u5316\uff0c\u8d21\u732e $0$\uff1b\n  - \u5982\u679c $k < i$ \u4e14 $p_k$ \u672a\u88ab\u9009\u53d6\uff1a\u53ea\u6709 $p_k$ \u4ecb\u4e8e $p_j$ \u4e0e $p_i$ \u4e4b\u95f4\u65f6\uff0c\u4f1a\u6709\u8d21\u732e $-2$\uff0c\u5426\u5219\u8d21\u732e $0$\uff1b\n  - \u5982\u679c $k > j$ \u4e14 $p_k$ \u672a\u88ab\u9009\u53d6\uff1a$p_k$ \u4e0e $p_i, p_j$ \u7684\u76f8\u5bf9\u4f4d\u7f6e\u65e0\u53d8\u5316\uff0c\u8d21\u732e $0$\uff1b\n  - \u5982\u679c $k > j$ \u4e14 $p_k$ \u88ab\u9009\u53d6\uff1a\u53ea\u6709 $p_k$ \u4ecb\u4e8e $p_j$ \u4e0e $p_i$ \u4e4b\u95f4\u65f6\uff0c\u4f1a\u6709\u8d21\u732e $-2$\uff0c\u5426\u5219\u8d21\u732e $0$\uff1b\n  - \u5982\u679c $i < k < j$\uff1a\u53ea\u6709\u300c$p_k > p_i$ \u4e14 $p_k$ \u88ab\u9009\u53d6\u300d\u6216\u300c$p_k < p_j$ \u4e14 $p_k$ \u672a\u88ab\u9009\u53d6\u300d\u65f6\u624d\u6709\u8d21\u732e $1$\uff0c\u5176\u4ed6\u60c5\u51b5\u5747\u8d21\u732e $-1$\u3002\n  \n  \u7136\u800c\u524d\u6587\u5df2\u8bf4\u660e\u5e76\u4e0d\u5b58\u5728\u8fd9\u4e24\u7c7b\uff08\u300c$p_k > p_i$ \u4e14 $p_k$ \u88ab\u9009\u53d6\u300d\u6216\u300c$p_k < p_j$ \u4e14 $p_k$ \u672a\u88ab\u9009\u53d6\u300d\uff09\u4f7f\u5f97\u8d21\u732e\u4e3a\u6b63\u6570\u7684\u60c5\u51b5\uff0c\u518d\u52a0\u4e0a $i, j$ \u672c\u8eab\u4ece\u9006\u5e8f\u5bf9\u53d8\u4e3a\u987a\u5e8f\u5bf9\u7684 $-1$ \u8d21\u732e\uff0c\u4e8e\u662f\u603b\u53d8\u5316\u91cf\u5fc5\u7136\u4e3a\u8d1f\u6570\u3002\n- \u56e0\u4e3a\u6bcf\u6b21\u8c03\u6574\u540e\u9009\u53d6\u7684\u5b50\u5e8f\u5217\u7684\u4e0b\u6807\u4e4b\u548c\u5fc5\u7136\u589e\u52a0\uff0c\u8c03\u6574\u6cd5\u5c06\u5728\u6709\u9650\u6b65\u5185\u7ed3\u675f\u3002\u8bc1\u6bd5\u3002\n\n\u4e8e\u662f\uff0c\u524d\u6587\u9700\u6700\u5927\u5316\u7684 $\\displaystyle \\sum_{j = 1}^{k} d_{i_j} - 2 \\operatorname{inv}(q_{1 \\sim k})$ \u4e2d\u7684\u7b2c\u4e8c\u9879\u53ef\u6539\u4e3a $\\displaystyle \\sum_{j = 1}^{k} \\sum_{l = i_j + 1}^{n} [p_l < p_{i_j}]$\u3002\n\n\u4ee4 $\\displaystyle c_i = d_i - 2 \\sum_{j = i + 1}^{n} [p_j < p_i]$\u3002\u5373\u662f\u8981\u6700\u5927\u5316 $\\displaystyle \\sum_{j = 1}^{k} c_{i_j}$\u3002\n\n\u5c06 $c$ \u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u540e\u9010\u4e2a\u9009\u53d6\u5373\u53ef\u3002\n\n\u6240\u6709 $c_i$ \u7684\u8ba1\u7b97\u548c\u6700\u521d\u9006\u5e8f\u5bf9\u6570 $\\operatorname{inv}(a_{1 \\sim n})$ \u7684\u8ba1\u7b97\u5747\u53ef\u5728 $\\mathcal O(n \\log n)$ \u5185\u5b8c\u6210\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n \\log n)$\u3002\n\n**\u3010AC \u4ee3\u7801\u3011**\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <functional>\n\n#define F(i, a, b) for(int i = a; i <= (b); ++i)\n#define dF(i, a, b) for(int i = a; i >= (b); --i)\n\nvoid Solve();\n\nint main() {\n\tint tests = 1;\n\tscanf(\"%d\", &tests);\n\twhile (tests--)\n\t\tSolve();\n\treturn 0;\n}\n\ntypedef long long ll;\nconst int MN = 500005;\n\nint n, a[MN], c[MN];\nint b[MN];\ninline void Add(int i, int x) {\n\tfor (; i <= n; i += i & -i)\n\t\tb[i] += x;\n}\ninline int Qur(int i) {\n\tint s = 0;\n\tfor (; i; i -= i & -i)\n\t\ts += b[i];\n\treturn s;\n}\n\nvoid Solve() {\n\tscanf(\"%d\", &n);\n\tF(i, 1, n) scanf(\"%d\", &a[i]);\n\tll ans = 0;\n\tF(i, 1, n) b[i] = 0;\n\tF(i, 1, n) {\n\t\tint d = Qur(a[i]);\n\t\tans += i - 1 - d;\n\t\tc[i] = i - 1 - 2 * d;\n\t\tAdd(a[i], 1);\n\t}\n\tF(i, 1, n) b[i] = 0;\n\tdF(i, n, 1) {\n\t\tc[i] -= 2 * Qur(a[i]);\n\t\tAdd(a[i], 1);\n\t}\n\tstd::sort(c + 1, c + n + 1, std::greater<>());\n\tprintf(\"%lld \", ans);\n\tfor (int k = 1; k <= n; ++k) {\n\t\tans -= c[k] + (k - 1);\n\t\tprintf(\"%lld%c\", ans, \" \\n\"[k == n]);\n\t}\n}\n```",
        "postTime": 1644834295,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1637H\u3010Minimize Inversions Number\u3011"
    },
    {
        "content": "## CF1637H\n\n_vp\u7684\u65f6\u5019\u731c\u7ed3\u8bba\u8fc7\u4e86\uff0c\u8865\u4e2a\u4e25\u8c28\u9898\u89e3_\u3002\n\n### \u9898\u610f\u7b80\u8ff0\n\u7ed9\u5b9a\u4e00\u4e2a $1\\sim n$ \u7684\u6392\u5217 $P$\u3002\u5bf9\u4e8e $\\forall k\\in[0,n]$ \u6c42\uff0c\u82e5\u4ece\u6392\u5217\u4e2d\u9009\u62e9\u4e00\u4e2a\u957f\u4e3a $k$ \u7684\u5b50\u5e8f\u5217\uff0c\u4fdd\u6301\u5b83\u4eec\u7684\u76f8\u5bf9\u4f4d\u7f6e\u653e\u5230\u6392\u5217\u7684\u5f00\u5934\uff0c\u5219\u6392\u5217\u7684\u9006\u5e8f\u5bf9\u6570\u91cf\u6700\u5c0f\u662f\u591a\u5c11\u3002\n\n$1\\leq n\\leq 5\\times 10^5$\u3002\n\n### \u9898\u76ee\u5206\u6790\n\n\u4e0b\u9762\u6211\u4eec\u5c06\u6392\u5217\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\u5f53\u4f5c\u4e8c\u7ef4\u5e73\u9762\u4e0a\u7684\u4e00\u4e2a\u70b9 $(i,p_i)$\u3002\n\n#### \u7ed3\u8bba\n\u6700\u4f18\u7684\u9009\u62e9\u65b9\u6848\u6ee1\u8db3\uff1a\u82e5 $p_i$ \u88ab\u9009\u62e9\uff0c\u5219\u6ee1\u8db3 $i<j,p_i>p_j$ \u7684 $p_j$ \u4e00\u5b9a\u88ab\u9009\u62e9\u3002\u5426\u5219\uff0c\u4e00\u5b9a\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u65b9\u6848\uff0c\u4f7f\u5f97\u65b0\u65b9\u6848\u4e0d\u6bd4\u5f53\u524d\u65b9\u6848\u52a3\u3002\n\n#### \u8bc1\u660e\n\u53cd\u8bc1\u6cd5\u3002\u5047\u8bbe\u6700\u4f18\u65b9\u6848\u4e2d\uff0c\u5b58\u5728 $i,j$ \u6ee1\u8db3 $p_i$ \u88ab\u9009\u62e9\uff0c$p_j$ \u672a\u88ab\u9009\u62e9\uff0c\u4e14$i<j,p_i>p_j$\u3002\n\n\u8003\u8651\u5c06\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u7684\u7b2c\u4e00\u8c61\u9650\u6839\u636e $(i,p_i),(j,p_j)$ \u4e24\u70b9\u5212\u5206\u4e3a $9$ \u4e2a\u90e8\u5206\u3002\u5373\u4ee5\u76f4\u7ebf $x=i,x=j,y=p_i,y=p_j$ \u4e3a\u5206\u754c\u7ebf\u3002\u5bf9\u4e8e $9$ \u4e2a\u90e8\u5206\uff0c\u5206\u522b\u8003\u8651\u5c06 $p_i$ \u6362\u6210 $p_j$ \u540e\uff0c\u9006\u5e8f\u5bf9\u51cf\u5c11\u7684\u6570\u91cf\u3002\n\n\u82e5\u67d0\u4e2a\u5143\u7d20 $(k,p_k)$ \u6ee1\u8db3 $k<i,p_k>p_i$ \u6216 $k<i,p_k<p_j$ \u6216 $k>j,p_k>p_i$ \u6216 $k>j,p_k<p_j$\uff0c\u5219\u5c06 $p_i$ \u6362\u6210 $p_j$ \u540e\u5143\u7d20 $(k,p_k)$ \u5bf9\u9006\u5e8f\u5bf9\u4e2a\u6570\u7684\u8d21\u732e\u4e0d\u53d8\u3002\n\n\u82e5\u67d0\u4e2a\u5143\u7d20 $(k,p_k)$ \u6ee1\u8db3 $k<i,p_j<p_k<p_i$\uff0c\u5219\u5c06 $p_i$ \u6362\u6210 $p_j$ \u540e\uff0c\u82e5\u5143\u7d20 $(k,p_k)$ \u539f\u6765\u88ab\u9009\u62e9\uff0c\u5219\u5b83\u5bf9\u9006\u5e8f\u5bf9\u4e2a\u6570\u7684\u8d21\u732e\u4e0d\u53d8\uff1b\u5426\u5219\uff0c\u5b83\u5bf9\u9006\u5e8f\u5bf9\u4e2a\u6570\u7684\u8d21\u732e $+2$\u3002\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5047\u8bbe\u5b58\u5728\u5143\u7d20 $(k,p_k)$\uff0c\u4e14\u5b83\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u79cd\u6761\u4ef6\u4e4b\u4e00\uff0c\u5219\u5c06 $p_i$ \u6362\u6210 $p_j$ \u540e\uff0c\u5b83\u5bf9\u9006\u5e8f\u5bf9\u4e2a\u6570\u7684\u8d21\u732e\u4f1a\u51cf\u5c11\uff1a\n\n- \u8be5\u5143\u7d20\u672c\u6765\u88ab\u9009\u62e9\uff0c\u4e14 $i<k<j,p_k>p_i$\u3002\n\n- \u8be5\u5143\u7d20\u672c\u6765\u672a\u88ab\u9009\u62e9\uff0c\u4e14 $i<k<j,p_k<p_j$\u3002\n\n\u6240\u4ee5\u53ea\u8981\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u7b97\u6cd5\uff0c\u5c31\u53ef\u4ee5\u4e0d\u65ad\u7f29\u51cf $j-i$ \u7684\u5927\u5c0f\uff1a\n\n- \u4e0d\u65ad\u627e\u5230\u67d0\u4e2a\u88ab\u9009\u4e14\u8d21\u732e\u4e3a\u8d1f\u7684\u5143\u7d20\uff0c\u7136\u540e\u8ba9 $i$ \u53d8\u4e3a\u8be5\u5143\u7d20\u3002\n\n- \u4e0d\u65ad\u627e\u5230\u67d0\u4e2a\u672a\u88ab\u9009\u4e14\u8d21\u732e\u4e3a\u8d1f\u7684\u5143\u7d20\uff0c\u7136\u540e\u8ba9 $j$ \u53d8\u4e3a\u8be5\u5143\u7d20\u3002\n\n\u8fd9\u65f6\uff0c$i,j$ \u4e2d\u95f4\u6ca1\u6709\u8d1f\u8d21\u732e\u7684\u5143\u7d20\uff0c\u6240\u4ee5\u628a $i$ \u6362\u6210 $j$ \u4e0d\u4f1a\u4f7f\u7b54\u6848\u66f4\u52a3\u3002\n\n\u8bc1\u6bd5\u3002\n\n#### \u89e3\u6cd5\n\u5b9a\u4e49 $d_i$ \u8868\u793a**\u9009\u62e9\u4e14\u4ec5\u9009\u62e9**\u7b2c $i$ \u4e2a\u5143\u7d20\u653e\u5230\u6392\u5217\u5f00\u5934\uff0c\u9006\u5e8f\u5bf9\u4e2a\u6570\u7684\u51cf\u5c11\u91cf\u3002\u663e\u7136 $d_i=\\sum_{j=1}^i [p_j>p_i]-\\sum_{j=1}^i [p_j<p_i]$\u3002\n\n\u90a3\u4e48\u8bbe\u6211\u4eec\u9009\u62e9\u4e86\u4e00\u4e2a\u5b50\u5e8f\u5217 $seq$\uff0c\u6392\u5217\u4e2d\u7684\u9006\u5e8f\u5bf9\u603b\u4e2a\u6570\u4e3a $tot$\uff0c$seq$ \u4e2d\u7684\u5143\u7d20\u6784\u6210\u7684\u9006\u5e8f\u5bf9\u4e2a\u6570\u4e3a $cnt$\uff0c\u5219\u9009\u62e9\u8be5\u5b50\u5e8f\u5217\u653e\u5230\u6392\u5217\u5f00\u5934\u540e\uff0c\u65b0\u7684\u9006\u5e8f\u5bf9\u4e2a\u6570\u4e3a\n\n$$tot-\\sum_{i\\in seq}d_i+cnt-(\\frac{|seq|(|seq|-1)}{2}-cnt)$$\n\n\u8bbe\u6ee1\u8db3 $i<j,p_i>p_j$ \u7684\u6570\u5bf9\u4e2a\u6570\u4e3a $s_i$\uff0c\u5219\u6ee1\u8db3 $i>j,p_i>p_j$ \u7684\u6570\u5bf9\u4e2a\u6570\u663e\u7136\u4e3a $p_i-s_i-1$\uff0c\u6ee1\u8db3 $i>j,p_i<p_j$ \u7684\u6570\u5bf9\u4e2a\u6570\u4e3a $(i-1)-(p_i-s_i-1)=i-p_i+s_i$\u3002\n\n\u6240\u4ee5\uff0c$cnt=\\sum_{i\\in seq}s_i,d_i=(i-p_i+s_i)-(p_i-s_i-1)=i-2p_i+2s_i+1$\u3002\n\n\u65b0\u9006\u5e8f\u5bf9\u4e2a\u6570\u5373\u53ef\u5316\u4e3a\n\n$$tot-\\sum_{i\\in  seq}i-2p_i+1-\\frac{|seq|(|seq|-1)}{2}$$\n\n\u8bbe $c_i=i-2p_i-1$\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e $i<j,p_i>p_j$ \u7684\u70b9\u5bf9 $(i,j)$\uff0c\u5fc5\u7136\u6709 $c_i<c_j$\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u6700\u5c0f\u5316\u9006\u5e8f\u5bf9\u4e2a\u6570\uff0c\u6211\u4eec\u5e94\u8be5\u5148\u9009 $c_i$ \u8f83\u5927\uff0c\u4e5f\u5373\u66f4\u504f\u53f3\u4e0b\u65b9\u7684\u5143\u7d20\u3002\u8fd9\u4e5f\u5370\u8bc1\u4e86\u6211\u4eec\u521a\u521a\u7684\u7ed3\u8bba\u3002\n\nCode\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=5e5+10;\nint t,n,p[N],v[N];\nstruct BIT\n{\n\tint c[N];\n\tvoid add(int x,int y){for(;x<=n;x+=x&(-x))c[x]+=y;}\n\tll ask(int x)\n\t{\n\t\tll res=0;\n\t\tfor(;x;x-=x&(-x))res+=c[x];\n\t\treturn res;\n\t}\n}tr;\nint main()\n{\n\tscanf(\"%d\",&t);\n\twhile(t--)\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i=1;i<=n;i++)scanf(\"%d\",&p[i]),v[i]=i-2*p[i];\n\t\tll tot=0,sum=0;\n\t\tfor(int i=1;i<=n;i++)tot+=tr.ask(n)-tr.ask(p[i]),tr.add(p[i],1);\n\t\tprintf(\"%lld \",tot);\n\t\tsort(v+1,v+n+1),reverse(v+1,v+n+1);\n\t\tfor(int k=1;k<=n;k++)\n\t\t{\n\t\t\tsum+=v[k];\n\t\t\tprintf(\"%lld \",tot-sum-1ll*k*(k+1)/2);\n\t\t}\n\t\tputs(\"\");\n\t\tfor(int i=1;i<=n;i++)tr.c[i]=0;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1644742718,
        "uid": 333574,
        "name": "Tyyyyyy",
        "ccfLevel": 7,
        "title": "CF1637H\u9898\u89e3"
    }
]