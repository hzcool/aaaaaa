[
    {
        "content": "\u540c\u673a\u623f\u5927\u4f6c[minxu](https://www.luogu.com.cn/user/251572)\u8bb2\u89e3\u4e86\u8fd9\u4e2a\u9898\uff0c\u4f7f\u849f\u84bb\u6211\u53d7\u76ca\u532a\u6d45\u3002\n\n\u518d\u52a0\u4e0a\u849f\u84bb\u5199\u7684\u8ba1\u6570DP\u9898\u4e0d\u8d85\u8fc7 0 \u9053\uff0c\u6240\u4ee5\u9047\u5230\u8fd9\u79cd\u597d\u9898\u8d76\u7d27\u5199\u9898\u89e3\u52a0\u6df1\u5370\u8c61\u3002\n\n### Solution\n\n\u56e0\u4e3a\u6bcf\u4e00\u5c42\u4e4b\u95f4\u662f\u6709\u4e92\u76f8\u5f71\u54cd\u7684\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u7528\u7ec4\u5408\u6570\u6c42\u89e3\uff0c\u8003\u8651\u4f7f\u7528\u8ba1\u6570DP\u3002\n\n**\u6211\u4eec\u5148\u5904\u7406\u53ea\u5728\u4e00\u884c\u5185\u7684\u5f69\u7403\u7684\u65b9\u6848\u6570**\n\n\u8bbe $g_{i,j}$ \u8868\u793a\u6709 $i$ \u4e2a\u5c0f\u7403\u4e32\u8d77\u6765\uff0c\u4e00\u5171\u7528\u4e86 $j$ \u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u3002\n\n\u56e0\u4e3a\u6bcf\u79cd\u989c\u8272\u662f\u7b49\u4ef7\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f3a\u5236\u7ed9\u6bcf\u4e2a\u989c\u8272\u4e00\u4e2a\u7f16\u53f7\uff0c\u5e76\u4f7f\u5f97\u7f16\u53f7\u5c0f\u7684\u7b2c\u4e00\u6b21\u51fa\u73b0\u5728\u524d\u9762\uff0c\u5927\u7684\u5728\u540e\u9762\u3002\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u8f6c\u79fb\u7684\u65f6\u5019\u7b80\u5355\u4e00\u4e9b\uff0c\u6700\u540e\u6c42\u7b54\u6848\u7684\u65f6\u5019\u4e58\u4e0a\u4e00\u4e2a\u9636\u4e58\u5373\u53ef\uff08\u4ed6\u4eec\u90fd\u8bf4\u8fd9\u53eb\u6700\u5c0f\u8868\u793a\u6cd5\uff09\u3002\n\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5199\u8f6c\u79fb\u65b9\u7a0b\uff1a \n$$\ng_{i,j}=g_{i-1,j-1}+(j-1)\\cdot g_{i-1,j}\n$$\n\u610f\u601d\u662f\u53ef\u4ee5\u5728 $i-1$ \u4e2a\u5c0f\u7403\u540e\u52a0\u4e00\u4e2a\u65b0\u989c\u8272\u7684\u5c0f\u7403\u6216\u8005\u52a0\u4e00\u4e2a\u548c\u7b2c $i-1$ \u4e2a\u989c\u8272\u4e0d\u4e00\u6837\u7684\u5c0f\u7403\uff0c\u6709 $j-1$ \u79cd\u989c\u8272\u9009\u62e9\u3002\n\n**\u518d\u601d\u8003\u884c\u4e0e\u884c\u4e4b\u95f4\u7684\u5f71\u54cd**\n\n\u8bbe $f_{i,j}$ \u4e3a\u524d $i$ \u884c\uff0c\u5176\u4e2d\u7b2c $i$ \u884c\u9009\u4e86 $j$ \u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u3002\n\n\u5982\u679c\u6ca1\u6709\u9898\u76ee\u4e2d\u7684\u90a3\u4e2a\u9650\u5236\uff0c\u662f\u6709\u4e00\u4e2a\u6bd4\u8f83\u663e\u7136\u7684\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\nf_{i,j}=\\dbinom mjg_{l_i,j}\\times \\sum_{k=1}^{\\min(l_{i-1},m)} f_{i-1,k}\n$$\n\u610f\u601d\u5c31\u662f\u5728\u524d $i-1$ \u5c42\u53ef\u80fd\u7684\u72b6\u6001\u57fa\u7840\u4e0a\uff0c\u4ece $m$ \u79cd\u989c\u8272\u4e2d\u9009\u51fa $j$ \u79cd\u6765\u6784\u6210\u7b2c $i$ \u5c42\n\n\u90a3\u4e48\u52a0\u4e0a\u4e86\u9650\u5236\uff0c\u5c31\u662f\uff1a\n$$\nf_{i,j}=\\binom mjg_{l_i,j}\\times \\sum_{k=1}^{\\min(l_{i-1},m)} f_{i-1,k}-g_{l_i,j}\\times f_{i-1,j}\n$$\n\u5176\u5b9e\u5c31\u662f\u51cf\u53bb\u4e86\u4e00\u4e2a $i-1$ \u5c42\u548c $i$ \u5c42\u989c\u8272\u5b8c\u5168\u76f8\u540c\u7684\u60c5\u51b5\n\n\u6b64\u65f6\u518d\u628a\u4e00\u76f4\u6ca1\u52a0\u4e0a\u7684\u9636\u4e58\u52a0\u4e0a\u5c31\u662f $f_{i,j}=j!\\cdot\\left(\\binom mjg_{l_i,j}\\times \\sum_{k=1}^{\\min(l_{i-1},m)} f_{i-1,k}-g_{l_i,j}\\times f_{i-1,j}\\right)$ \n\n\u800c\u6700\u540e\u7684\u7b54\u6848\u662f $ans=\\sum_{i=1}^{\\min(m,l_n)}f_{n,i}$ \n\n~~\u5b8c\u7ed3\u6492\u53d1~~\n\n\u7b49\u7b49\uff0c\u4e0d\u4f1a\u4f60\u4ee5\u4e3a\u8fd9\u5c31\u5b8c\u4e86\u5427\n\n**last but not least**\n\n1. \u5f53\u4f60\u6572\u7740\u6572\u7740\u53d1\u73b0\uff1a\u56e0\u4e3a\u4e00\u4e2a\u6ca1\u786e\u5b9a\u7684 $p$ \uff0c $\\binom mj$ \u4eff\u4f5b\u4e00\u4e2a\u6bd2\u7624\u3002\u4f60\u60f3\u8d77\u4e86 $exLucas$ \u8fd9\u79cd\u4ee3\u7801\u53ef\u80fd\u6bd4DP\u8f6c\u79fb\u65b9\u7a0b\u4ee3\u7801\u8fd8\u957f\u7684\u4e1c\u897f\u3002\n\n   \u4f46\u662f\u6211\u4eec\u5176\u5b9e\u4e0d\u9700\u8981\u3002\n\n   \u56e0\u4e3a\u5c06 $j!$ \u6254\u56de\u62ec\u53f7\u91cc\uff0c\u539f\u5f0f\u5c31\u4f1a\u53d8\u6210 $f_{i,j}=A_m^j\\times g_{l_i,j}\\times \\sum_{k=1}^{\\min(l_{i-1},m)} f_{i-1,k}-j!\\times g_{l_i,j}\\times f_{i-1,j}$ \n\n   \u6b64\u65f6\u9884\u5904\u7406 $A_m^j$ \u548c $j!$ \u5373\u53ef\u3002\n\n2. \u73b0\u5728\u4f60\u6253\u5b8c\u4e86\u6574\u4e2a\u7a0b\u5e8f\uff0c\u6ee1\u5fc3\u6b22\u559c\u7684\u4ea4\u4e0a\u53bb\uff0c\u4f1a~~\u66f4\u6b22\u559c~~\u53d1\u73b0\u5b83T\u98de\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u5f97\u4f18\u5316**\u65f6\u95f4**\u590d\u6742\u5ea6\u3002\n\n   \u89c2\u5bdf\u65b9\u7a0b\u53ef\u4ee5\u53d1\u73b0 $\\sum_{k=1}^{\\min(l_{i-1},m)}f_{i-1,k}$ \u624d\u662f\u8ba9\u4f60\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u6210 $O((\\sum l_i)^2)$ \u7684\u7f6a\u9b41\u7978\u9996\u3002\u4f18\u5316\u65b9\u5f0f\u662f\u5728 $i-1$ \u5c42\u8bb0\u5f55\u524d\u7f00\u548c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5230 $O(1)$ \u8f6c\u79fb\u3002\n\n3. \u7ec8\u4e8e\uff0c\u4f60\u5f00\u5f00\u5fc3\u5fc3\u7684\u52a0\u4e0a\u4e86\u524d\u7f00\u548c\uff0c\u53c8\u4ea4\u4e86\u4e0a\u53bb\uff0c\u6b63\u51c6\u5907\u548c\u673a\u623f\u540c\u5b66\u70ab\u8000\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u5b83\u53c8M\u98de\u4e86\uff0c\u4ed4\u7ec6\u4e00\u770b\u5185\u5b58\u662f $250MB$ \uff0c\u6240\u4ee5\u8fd8\u5f97\u4f18\u5316**\u7a7a\u95f4**\u590d\u6742\u5ea6\u3002\n\n   \u7ee7\u7eed\u770b\u65b9\u7a0b\u5427\u3002\u53c8\u53d1\u73b0 $g$ \u6570\u7ec4\u5728 $f$ \u8f6c\u79fb\u7684\u65f6\u5019\u6709\u5927\u7528\uff0c\u4f46\u662f $f$ \u53ea\u548c\u5b83\u7684\u524d\u4e00\u5c42\u6709\u5173\u7cfb\uff0c\u6240\u4ee5\u5c06\u53ef\u4ee5\u5c06\u5b83\u7684\u524d\u4e00\u7ef4\u62b9\u53bb\u3002\n\n   \u8fd8\u6709\u7ec6\u5fae\u7684\u5c0f\u4f18\u5316\uff0c\u56e0\u4e3a $A_m^j$ \u4e2d\u5e95\u4e0b\u7684 $m$ \u662f\u4e0d\u53d8\u7684\uff0c\u53ea\u6709 $j$ \u4f1a\u53d8\uff0c\u6240\u4ee5\u8fd9\u4e5f\u662f\u4e2a\u4e00\u7ef4\u6570\u7ec4(\u25cf'\u25e1'\u25cf)\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a $O(\\sum l_i)+O(l_i^2)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a $O(l_i^2+m)$ \n\n### \u4ee3\u7801\n\n```c++\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define ll long long\n\nusing namespace std;\nconst int L=5010,N=1e6+10;\nint n,m,p;\nll A[N],l[N],f[L],fac[L],tmp[L];//tmp\u5c31\u662f\u6eda\u52a8\u6570\u7ec4\nint g[L][L];\n\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n    while(isdigit(ch)){x=x*10+(ch^48);ch=getchar();}\n    return x*f;\n}\n\ninline void init(){\n    A[0]=1;\n    for(int i=1;i<=m;i++)\n        A[i]=A[i-1]*(m-i+1)%p;\n    g[0][0]=1;\n    for(int i=1;i<=5000;i++)\n        for(int j=1;j<=min(i,m);j++){\n            g[i][j]=(ll)g[i-1][j]*(j-1)%p+g[i-1][j-1];\n            g[i][j]%=p;\n        }\n    fac[0]=1;\n    for(int i=1;i<=5000;i++) fac[i]=fac[i-1]*i%p;\n}\n\nint main(){\n    n=read();m=read();p=read();\n    init();\n    for(int i=1;i<=n;i++) l[i]=read();\n    ll sum=1,res;\n    for(int i=1;i<=n;i++){\n        res=0;\n        for(int j=1;j<=l[i];j++)\n            f[j]=(sum*A[j]%p*g[l[i]][j]%p-g[l[i]][j]*tmp[j]%p*fac[j]%p+p)%p,\n        \t//\u9632\u6b62\u51cf\u6cd5\u51fa\u73b0\u8d1f\u6570\uff0c\u6240\u4ee5+p\n        \tres=(res+f[j])%p;\n        sum=res;\n        for(int j=1;j<=l[i-1];j++) tmp[j]=0;\n        for(int j=1;j<=l[i];j++) tmp[j]=f[j];\n    }\n    printf(\"%lld\\n\",sum);\n    return 0;\n}\n```\n\n\u770b\u5230\u8fd9\u91cc\u7684\u5c0f\u4f19\u4f34\u4e00\u5b9a\u53d1\u73b0\u6211\u76f4\u63a5\u628a\u6700\u540e\u4e00\u5c42\u7684 $sum$ \u8f93\u51fa\u4e86\u3002\n\n\u89c2\u5bdf\u6211\u524d\u7f00\u548c\u4f18\u5316\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u5f0f\u5b50 $\\sum_{k=1}^{\\min(l_{i-1},m)}f_{i-1,k}$ \u548c\u6700\u540e\u7b54\u6848\u7684\u5f0f\u5b50 $\\sum_{i=1}^{\\min(l_n,m)}f_{n,i}$ \uff0c\u662f\u4e0d\u662f\u60ca\u5947\u7684\u53d1\u73b0\u4ed6\u4eec\u957f\u5f97\u4e00\u6837\u3002\n\n\u5176\u5b9e\u662f\u56e0\u4e3a\u865a\u65e0\u7684\u7b2c $n+1$ \u5c42\u6ca1\u6709\u5c0f\u7403\uff0c\u4e5f\u6ca1\u6709\u989c\u8272\uff0c\u7b2c $n$ \u5c42\u600e\u4e48\u9009\u90fd\u884c\\^o^/",
        "postTime": 1602902280,
        "uid": 272143,
        "name": "\u662f\u4e2a\u6c49\u5b50",
        "ccfLevel": 4,
        "title": "CF140E New Year Garland"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.com.cn/problem/CF140E)\n\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u662f\u8ba1\u6570$dp$\n\n\u6211\u4eec\u8003\u8651\u5982\u4f55\u8868\u793a\u72b6\u6001 \u4e00\u822c\u72b6\u6001\u7684\u8bbe\u8ba1\u662f\u95ee\u4ec0\u4e48\u8bbe\u4ec0\u4e48\n\n\u8bbe$g[i][j]$\u8868\u793a\u7b2c$i$\u5c42\u7528$j$\u79cd\u989c\u8272\u4e4b\u524d\u968f\u610f\u4e14\u5408\u6cd5\u7684\u65b9\u6848\u6570\n\n\u56e0\u4e3a\u8981\u6c42\u76f8\u90bb\u4e24\u884c\u96c6\u5408\u4e0d\u80fd\u4e00\u6837 \u6211\u4eec\u60f3\u5230\u53ef\u4ee5\u7b97\u51fa\u603b\u65b9\u6848\u6570\u7136\u540e\u51cf\u53bb\u91cd\u590d\u7684\u5373\u53ef\n\n\u90a3\u4e48\u8003\u8651\u603b\u65b9\u6848\u6570\u5982\u4f55\u6c42 \u5982\u679c\u5728\u4e0d\u8003\u8651\u76f8\u90bb\u4e24\u884c\u4e0d\u5408\u6cd5\u7684\u60c5\u51b5 \u90a3\u4e48\u76f8\u90bb\u7684\u662f\u4e92\u4e0d\u5f71\u54cd\u7684 \u6240\u4ee5\u6211\u4eec\u53ea\u8981\u6c42\u51fa\u4e00\u884c\u7684 \u518d\u4e58\u6cd5\u539f\u7406\u5373\u53ef\n\n\u6211\u4eec\u8bbe$f[i][j]$\u8868\u793a\u4e00\u884c\u524d$i$\u4e2a\u7528\u4e86$j$\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570 \u8fd9\u91cc\u6211\u4eec\u7528\u4e00\u79cd\u7c7b\u4f3c\u6700\u5c0f\u8868\u793a\u6cd5\u7684\u65b9\u6cd5 \u5373\u5f3a\u5236\u8981\u6c42\u7b2c$j+1$\u79cd\u989c\u8272\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u5927\u4e8e\u7b2c$j$\u79cd\u989c\u8272\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\n\n\u90a3\u4e48\u8f6c\u79fb\u5c31\u6709$f[i][j]=f[i-1][j-1]+f[i-1][j]*(j-1)$\n\n\u610f\u601d\u662f\u5982\u679c\u7b2c$i$\u4f4d\u8981\u4e48\u662f\u7b2c$j$\u8fd9\u79cd \u90a3\u4e48\u5c31\u968f\u4fbf\u653e$j-1$\u79cd(\u4e0d\u80fd\u548c\u4e0a\u4e00\u4e2a\u76f8\u540c) \n\n\u8fd9\u6837\u6700\u540e\u518d\u4e58\u4e2a\u9636\u4e58\u548c\u7ec4\u5408\u6570\u5c31\u662f\u603b\u65b9\u6848\u4e86\n\n\u90a3\u4e48 $g[i][j]=\\sum_{k=1}^{\\min(l[i-1],m)} g[i-1][k]*f[l[i]][j]*C_m^j*j!-g[i-1][j]*j!*f[l[i]][j]$\n\n\u56e0\u4e3a\u8981\u51cf\u53bb\u7684\u662f\u96c6\u5408\u76f8\u540c\u7684 \u6240\u4ee5\u76f8\u5f53\u4e8e$j$\u79cd\u662f\u5df2\u7ecf\u56fa\u5b9a\u4e86 \u5c31\u4e0d\u7528\u518d\u9009$j$\u79cd\u4e86\n\n$ans=\\sum_{i=1}^{\\min(m,l[n])}g[n][i]$\n\n\u7136\u540e\u628a\u7b2c\u4e00\u7ef4\u6eda\u52a8\u4e00\u4e0b\u7a7a\u95f4\u5c31\u591f\u4e86\n\n```\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N = 1e6 + 10;\nint n, m, mod;\nll fac[N], c[N], l[N], g[5005], p[5005];\nll f[5005][5005], ans = 1, tmp;\ninline int read()\n{\n    int x = 0, f = 1;\n    char ch = getchar();\n    while (ch < '0' || ch > '9')\n    {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while (ch >= '0' && ch <= '9')\n    {\n        x = x * 10 + ch - '0';\n        ch = getchar();\n    }\n    return x * f;\n}\nint main()\n{\n    cin >> n >> m >> mod;\n    for (int i = 1; i <= n; ++i)\n        l[i] = read();\n    c[0] = 1;\n    for (int i = 1; i <= m; ++i)\n        c[i] = c[i - 1] * (m - i + 1) % mod;\n    f[0][0] = 1;\n    for (int i = 1; i <= 5000; ++i)\n        for (int j = 1; j <= min(i, m); ++j)\n        {\n            f[i][j] = (f[i - 1][j] * 1ll * (j - 1) % mod + f[i - 1][j - 1]) % mod;\n        }\n    fac[1] = 1;\n    for (int i = 2; i <= 5000; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    for (int i = 1; i <= n; ++i)\n    {\n        tmp = 0;\n        for (int j = 1; j <= min(l[i], 1ll * m); ++j)\n            g[j] = (ans * c[j] % mod * f[l[i]][j] % mod - f[l[i]][j] * p[j] % mod * fac[j] % mod + mod) % mod;\n        for (int j = 1; j <= min(l[i], 1ll * m); ++j)\n            tmp = (tmp + g[j]) % mod;\n        ans = tmp;\n        for (int j = 1; j <= min(l[i - 1], 1ll * m); ++j)\n            p[j] = 0;\n        for (int j = 1; j <= min(l[i], 1ll * m); ++j)\n            p[j] = g[j];\n    }\n    printf(\"%lld\", ans);\n    return 0;\n}\n```",
        "postTime": 1602856710,
        "uid": 251572,
        "name": "minxu",
        "ccfLevel": 0,
        "title": "CF140E New Year Garland"
    },
    {
        "content": "### \u9898\u610f\n\n\u6709\u4e00\u68f5\u5723\u8bde\u6811\uff0c\u4e00\u5171\u6709 $n$ \u5c42\uff0c\u6bcf\u5c42\u7531 $l_i$ \u4e2a\u5c0f\u7403\u7ec4\u6210\uff0c\u6bcf\u4e2a\u5c0f\u7403\u989c\u8272\u662f $1\\sim m$ \u4e2d\u7684\u4e00\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u5c42\u5185\u90e8\uff0c\u76f8\u90bb\u7684\u5c0f\u7403\u7684\u90fd\u4e0d\u76f8\u540c\u3002  \n\u540c\u65f6\uff0c\u5916\u90e8\u6765\u770b\uff0c\u76f8\u90bb\u7684\u4e24\u5c42\u7684\u5c0f\u7403\u96c6\u5408\u4e0d\u76f8\u540c\u3002\n\n\u6c42\u51fa\u4e00\u5171\u6709\u591a\u5c11\u79cd\u5408\u6cd5\u88c5\u9970\u65b9\u6848\uff0c\u7b54\u6848\u5bf9 $p$ \u53d6\u6a21\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a $1\\le n,m\\le 10^6,2\\le p\\le 10^9,1\\le l_i\\le 5000,\\sum\\limits^n_{i=1}l_i\\le 10^7$\u3002\n\n\n### \u505a\u6cd5\n\n\u8bbe $dp_{i,j}$ \u8868\u793a\u7b2c $i$ \u884c\u7684\u96c6\u5408\u6709 $j$ \u79cd\u989c\u8272\uff0c\u524d $i$ \u884c\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u9700\u8981\u5148 DP \u51fa\u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u4e1c\u897f\uff1a\u8bbe $f_{i,j}$ \u8868\u793a\u4e00\u5c42\u4e2d\u6709 $i$ \u4e2a\u7403\uff0c\u6784\u6210\u989c\u8272\u96c6\u5408\u5927\u5c0f\u4e3a $j$ \u7684\u65b9\u6848\u6570\uff0c\u4e14\u8fd9 $i$ \u4e2a\u7403\u7684\u989c\u8272\u9075\u5faa\u5176\u6700\u5c0f\u8868\u793a\u6cd5\uff1a\u4f9d\u6b21\u626b\u8fc7\u6bcf\u4e2a\u7403\uff0c\u82e5\u67d0\u4e2a\u989c\u8272\u662f\u7b2c\u4e00\u6b21\u51fa\u73b0\u5219\u8d4b\u4e88\u5176\u989c\u8272\u7f16\u53f7\u4e3a\u5f53\u524d\u989c\u8272\u603b\u6570\u3002  \n\u5219\u53ef\u5f97\u51fa $f$ \u7684 DP \u5f0f\u5b50\uff1a$f_{1,1}=1,f_{i,j}=f_{i-1,j-1}+f_{i-1,j}\\times (j-1)$\u3002\u5206\u522b\u8868\u793a\u65b0\u5f00\u4e00\u4e2a\u989c\u8272\u6216\u8005\u9009\u62e9\u4e00\u4e2a\u4e0e\u4e0a\u4e00\u4e2a\u7403\u4e0d\u540c\u7684\u989c\u8272\u3002\n\n\u56de\u5230\u6c42 $dp$\uff1a\u8bb0\u5f55\u4e00\u4e2a $dps_i=\\sum\\limits_j dp_{i,j}$\uff0c\u6709 $dp_{i,j}=dps_{i-1}\\times f_{l_i,j}\\times m^{\\underline{j}}-dp_{i-1,j}\\times f_{l_i,j}\\times j!$\uff0c\u51cf\u53f7\u524d\u4ee3\u8868\u7684\u662f\u524d $i-1$ \u884c\u7684\u603b\u65b9\u6848\u6570\u4e58\u4ee5\u8fd9\u4e00\u884c\u7684\u65b9\u6848\u6570\uff0c\u8fd9\u4e00\u884c\u7684\u65b9\u6848\u6570\u8ba1\u7b97\u65b9\u6cd5\u4e5f\u5c31\u662f $f_{l_i,j}$ \u4e58\u4e0a $m$ \u4e2a\u989c\u8272\u91cc\u9009 $j$ \u4e2a\u51fa\u6765\u6392\u5217\u7684\u65b9\u6848\u6570\uff0c\u51cf\u53f7\u540e\u9762\u4ee3\u8868\u7684\u662f\u4e0d\u80fd\u4e0e\u4e0a\u4e00\u884c\u7684\u989c\u8272\u96c6\u5408\u76f8\u540c\uff0c\u6240\u4ee5\u9700\u8981\u51cf\u53bb $dp_{i,j}$ \u4e58 $f_{l_i,j}$ \u518d\u4e58\u4e0a $j$ \u4e2a\u989c\u8272\u7684\u6392\u5217\u65b9\u6848\u6570\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e6 + 5;\nint n, m, mod, L[N];\nint qpow(int a, int b) {\n\tint res = 1 % mod;\n\twhile (b) {\n\t\tif (b & 1) res = 1ll * res * a % mod;\n\t\ta = 1ll * a * a % mod;\n\t\tb /= 2;\n\t}\n\treturn res;\n}\nvector<int> dp[N];\nint dps[N];\nint f[5005][5005], A[N], fac[N];\nint read() {\n\tint x = 0, ch = getchar();\n\twhile (!isdigit(ch)) ch = getchar();\n\twhile (isdigit(ch)) x = x * 10 + (ch - '0'), ch = getchar();\n\treturn x;\n}\nint main() {\n\tn = read(), m = read(), mod = read();\n\tf[1][1] = 1;\n\tfor (int i = 2; i < 5005; ++i)\n\t\tfor (int j = 1; j <= i; ++j)\n\t\t\tf[i][j] = (f[i - 1][j - 1] + 1ll * (j - 1) * f[i - 1][j] % mod) % mod;\n\tfac[0] = 1;\n\tfor (int i = 1; i < N; ++i) fac[i] = 1ll * fac[i - 1] * i % mod;\n\tA[0] = 1;\n\tfor (int i = 1; i <= m; ++i) A[i] = 1ll * A[i - 1] * (m - i + 1) % mod;\n\tfor (int i = 1; i <= n; ++i) L[i] = read(), dp[i].resize(L[i] + 1);\n\tfor (int i = 1; i <= min(m, L[1]); ++i)\n\t\tdp[1][i] = 1ll * f[L[1]][i] * A[i] % mod, (dps[1] += dp[1][i]) %= mod;\n\tfor (int i = 2; i <= n; ++i) {\n\t\tfor (int j = 1; j <= min(m, L[i]); ++j) {\n\t\t\tdp[i][j] = 1ll * dps[i - 1] * f[L[i]][j] % mod * A[j] % mod;\n\t\t\tif (j <= L[i - 1])\n\t\t\t\t(dp[i][j] -= 1ll * dp[i - 1][j] * f[L[i]][j] % mod * fac[j] % mod - mod) %= mod;\n\t\t\t(dps[i] += dp[i][j]) %= mod;\n\t\t}\n\t}\n\tcout << dps[n];\n\treturn 0;\n}\n```",
        "postTime": 1671627372,
        "uid": 127284,
        "name": "ieeqwq",
        "ccfLevel": 7,
        "title": "CF140E New Year Garland \u9898\u89e3"
    },
    {
        "content": "[\u535a\u5ba2\u6b22\u8fce\u6765\u8e29QAQ](https://www.cnblogs.com/blog-Dr-J/p/10356883.html)\n\n\u8981\u6c42\u76f8\u90bb\u4e24\u884c\u5c0f\u7403\u989c\u8272\u96c6\u5408\u4e0d\u540c\uff0c\u5e76\u4e14\u9650\u5236\u884c\u5185\u5c0f\u7403\u76f8\u90bb\u4e0d\u540c\u3002\n\n\u7531\u6b64\u53ef\u5f97\uff1a\u6bcf\u884c\u5c0f\u7403\u6392\u5217\u90fd\u662f\u72ec\u7acb\u4e0e\u5916\u754c\u7684\uff0c\n\n\u6240\u4ee5\u7b54\u6848\u5e94\u8be5\u662f\u5bf9\u4e8e\u6240\u6709\u884c\u7684\u989c\u8272\u96c6\u5408\u5206\u7c7b\uff0c\u5728\u5c06\u884c\u5185\u7684\u7b54\u6848\u4e58\u5230\u4e0a\u9762\u3002\n\n\u5148\u8003\u8651\u5982\u4f55\u5206\u7c7b:\n\n\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u5bf9\u4e8e\u6bcf\u884c\u6240\u53d6\u7684\u989c\u8272\u79cd\u7c7b$x=|S|$\uff0c\n\n\u82e5\u76f8\u90bb\u4e24\u884c$i,j$\uff0c\u5176$x_i!=x_j$\uff0c\u90a3\u4e48\u4e00\u5b9a\u662f\u5408\u6cd5\u7684\uff0c\u6709$C_m^x$\u79cd\u9009\u62e9\u65b9\u6cd5\u3002\n\n\u800c\u5bf9\u4e8e\u76f8\u90bb\u4e24\u884c$x_i=x_j$\uff0c\u5bf9\u4e8e\u884c$i$\u7684\u4e00\u79cd\u65b9\u6848\uff0c\u53ea\u6709\u4e00\u79cd\u53ef\u80fd\u4f7f\u5f97$S_i=S_j$,\n\n\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5bb9\u65a5\u6765\u8ba1\u7b97\u7b54\u6848\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u6309\u7167\u6bcf\u884c\u7684\u989c\u8272\u79cd\u7c7b\u6570\u6765\u5206\u7c7b\u6216\u8bb8\u662f\u53ef\u884c\u7684\u3002\n\n\u6240\u4ee5\u8bf4\u6211\u4eec\u8868\u793a\u51fa\u7b54\u6848\uff1a\n\n\u8bbe\u8be5\u884c\u5171\u7528$x$\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u4e3a$f(x)$\uff0c$f(x)$\u662f\u5bf9\u4e8e\u6240\u6709\u7684\u79cd\u7c7b\u8fdb\u884c\u8ba1\u6570\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4e0e\u989c\u8272\u6570\u4e3a$x$\u7684\u5176\u4ed6\u8ba1\u6570\u53d8\u91cf\u76f8\u4e58\uff0c\u8bbe\u7b2c$n$\u884c\u4e2d\u989c\u8272\u4e3a$i$\u5bf9\u6574\u4f53\u7684\u8d21\u732e\u4e3a$ans_{n,i}$\u5219\uff1a\n\n$ans_n=C_m^x*f(x)*ans_{n-1}-f(x)*ans_{n-1,j}$\n\n$ans_n=\\sum\\limits_{c=1}^{l_n}ans_{n,c}$\n\n\u7528\u51fd\u6570$g_{i,j}$\u8868\u793a\u5c31\u662f$ans_i=\\sum g_{i,j}$\u8868\u793a\u524d$i$\u884c\u4e2d\u6700\u540e\u4e00\u884c\u7528$j$\u4e2a\u989c\u8272\u65b9\u6848\u6570\u3002\n\n\u884c\u95f4\u8ba1\u6570\u641e\u5b9a\u4e86\uff0c\u5c31\u8be5\u8003\u8651\u5982\u4f55\u8ba1\u7b97$f(x)$\n\u7531\u4e8e\u521a\u624d\u8bbe$f(x)$\u4e3a\u8be5\u884c\u7684\u65b9\u6848\u6570\u3002\u8fd9\u4e2a\u770b\u8d77\u6765\u4e0d\u592a\u597d\u6c42\u3002\n\n\u8003\u8651\u4ec0\u4e48\u51b3\u5b9a\u4e86\u8fd9\u4e2a\u65b9\u6848\u6570\u3002\n\n\u662f\u8be5\u884c\u7684\u7403\u6570\u4ee5\u53ca\u989c\u8272\u6570\u3002\n\n\u6240\u4ee5\u4e0d\u59a8\u6539\u5199\u4e00\u4e0b\uff0c$f(i,j)$\u8868\u793a\u7528\u4e86$i$\u4e2a\u7403\uff0c\u5171$j$\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u7b2c$i$\u884c\u7684$f(x)$\u91cd\u5199\u4e3a$f(l_i,x)$\n\n\u8003\u8651\u4e00\u4e2a\u4e00\u4e2a\u6765\u6dfb\u52a0\u7403\uff0c\u7531\u4e8e\u8981\u6c42\u548c\u524d\u4e00\u4e2a\u989c\u8272\u4e0d\u540c\uff0c\u5373\u53ef\u83b7\u5f97\u9012\u63a8\u5f0f\uff1a\n\n$f(i,j)=f(i-1,j-1)+f(i-1,j)*(j-1)$\n\n\u7531\u4e8e\u6bcf\u6b21\u7528\u5230\u6ca1\u6709\u7528\u8fc7\u7684\u989c\u8272\u987a\u5e8f\u662f\u6709\u5e8f\u7684\uff0c\u800c\u6240\u6c42\u7684\u662f\u5bf9\u7403\u989c\u8272\u987a\u5e8f\u65e0\u8981\u6c42\uff0c\u90a3\u4e48\u6700\u540e\u4f7f\u7528\u7684\u65f6\u5019\u5e94\u5199\u6210\uff1a\n$j!*f(i,j)$\n\n\u7403\u989c\u8272\u6570\u4e0d\u4f1a\u591a\u4e8e\u603b\u6570\uff0c\u90a3\u4e48$f(i,j)$\uff0c\u53ef\u4ee5\u7528\u4e8c\u7ef4\u6570\u7ec4\u6765\u50a8\u5b58\n\n\n\u6700\u540e\u4e00\u4e2a\u95ee\u9898\u5c31\u662fp\u4e0d\u662f\u8d28\u6570\u4e0d\u80fd\u76f4\u63a5\u7528\u9006\u5143\u3002\n\n~~\u96be\u4e0d\u6210\u8981\u7528\u62d3\u5c55Lucas\uff1f~~\n\n\u7ec4\u5408\u6570\u53ef\u4ee5\u63d0\u51fa\u6765\uff1a\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f\uff1a\n\n$g_{i,j}=A_{m}{j}*f(i,j)*\\sum{g_{i-1}}-j!*f(i,j)*g_{i-1,j}$\n\n \u5176\u4e2d$f_{(i,j)},j!,A_m^j$\u9884\u5904\u7406\u5c31\u53ef\u4ee5\u5f88\u6109\u5feb\u5730A\u6389\u8fd9\u9053\u9898\u76ee\u4e86\n \n \u4ee3\u7801\uff1a\n ```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\ntypedef long long lnt;\nlnt n,m,p;\nlnt lmax;\nlnt Am[50001];\nlnt fac[50001];\nlnt l[2000000];\nlnt f[5010][5010];\nlnt g[2][5010];\nint main()\n{\n    scanf(\"%lld%lld%lld\",&n,&m,&p);\n    fac[0]=Am[0]=f[0][0]=1;\n    for(int i=1;i<=n;i++)\n        scanf(\"%lld\",&l[i]),lmax=std::max(lmax,l[i]);\n    for(int i=1;i<=lmax;i++)Am[i]=Am[i-1]*(m-i+1)%p;\n    for(int i=1;i<=lmax;i++)fac[i]=fac[i-1]*i%p;\n    for(int i=1;i<=lmax;i++)for(int j=1;j<=i&&j<=m;j++)\n        f[i][j]=(f[i-1][j-1]+f[i-1][j]*(j-1))%p;\n    lnt ans=1,sum=0;\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=1;j<=l[i];j++)\n        {\n            lnt tmp=(Am[j]*ans-g[i&1^1][j]*fac[j])%p;\n            g[i&1][j]=f[l[i]][j]*tmp%p;\n            sum+=g[i&1][j];\n        }\n        ans=(sum%p+p)%p;\n        sum=0;\n        memset(g[i&1^1],0,sizeof(g[0]));\n    }\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n\n```",
        "postTime": 1549636046,
        "uid": 66914,
        "name": "Unstoppable728",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF140E \u3010New Year Garland\u3011"
    }
]