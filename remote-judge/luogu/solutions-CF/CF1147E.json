[
    {
        "content": "# [CF1147E](https://www.luogu.com.cn/problem/CF1147E)  Rainbow Coins\n\n\u6211\u4eec\u53ea\u80fd\u8be2\u95ee $7$ \u6b21\uff0c$n$ \u7684\u5927\u5c0f\u5e94\u8be5\u57fa\u672c\u4e0e\u8be2\u95ee\u6b21\u6570\u65e0\u5173\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u8981\u4f7f\u5206\u7ec4\u80fd\u5145\u5206\u5229\u7528\u4fe1\u606f\uff0c\u4ece\u800c\u5bb9\u6613\u60f3\u5230\u8f83\u4e3a\u7b80\u5355\u7684\u4e24\u79cd\u5206\u7ec4\u8be2\u95ee\u65b9\u5f0f\uff1a\n\n1. \u8be2\u95ee $[1~2]~~[3~4]~~[5~6]~\\cdots~[2k-1~2k]$\uff1b\n2. \u8be2\u95ee $[2~3]~~[4~5]~~[6~7]~\\cdots~[2k~2k+1]$\u200b\u3002\n\n\u4e0a\u9762\u4e24\u6b21\u8be2\u95ee\u5df2\u7ecf\u6db5\u76d6\u4e86\u6240\u6709\u76f8\u90bb\u7684\u4f4d\u7f6e\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u76f8\u90bb\u7684\u540c\u79cd\u989c\u8272\u7684\u7528\u5e76\u67e5\u96c6\u7f29\u5230\u4e00\u8d77\uff0c\u5f97\u5230\u4e86\u82e5\u5e72\u4e0d\u540c\u989c\u8272\u6bb5\uff0c\u800c\u6bcf\u6bb5\u5185\u90e8\u662f\u540c\u79cd\u989c\u8272\u3002\n\n\u76f8\u90bb\u6bb5\u4e4b\u95f4\u4e00\u5b9a\u662f\u4e0d\u540c\u989c\u8272\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u786e\u5b9a\u9694\u4e00\u6bb5\u7684\u4e24\u4e2a\u989c\u8272\u6bb5\u7684\u989c\u8272\u5173\u7cfb\uff0c\u7528 $A~B~C\\cdots$ \u6765\u8868\u793a\u4e0d\u540c\u7684\u989c\u8272\u6bb5\uff0c\u8003\u8651\u8be2\u95ee\uff1a\n\n1. \u8be2\u95ee $[A~C]~~[D~F]~~[G~I]\\cdots$\u200b\uff1b\n2. \u8be2\u95ee $[B~D]~~[E~G]~~[H~J]\\cdots$\u200b\uff1b\n3. \u8be2\u95ee $[C~E]~~[F~H]~~[I~K]\\cdots$\u3002\n\n\u8fd9\u91cc\u8be2\u95ee\u6bb5\u4e0e\u6bb5\u4e4b\u95f4\u53d6\u4e2a\u4ee3\u8868\u5143\u7d20\u5373\u53ef\uff0c\u6700\u540e\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4efb\u610f\u4e09\u4e2a\u76f8\u90bb\u7684\u989c\u8272\u6bb5\u4e24\u4e24\u4e4b\u95f4\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4ee5\u6700\u524d\u9762\u7684 $A~B~C$\u200b\u200b \u4e09\u6bb5\u4e3a\u4f8b\uff1a\n\n\u56e0\u4e3a\u53ea\u6709\u4e09\u79cd\u989c\u8272\uff0c\u5e76\u4e14\u6700\u540e\u7b54\u6848\u987a\u5e8f\u65e0\u6240\u8c13\uff0c\u4e0d\u59a8\u4ee4 $Col_A=1,Col_B=2$\u200b \uff1a\n\n- \u9996\u5148\u4e00\u5b9a\u6709 $Col_A \\not= Col_B,Col_B \\not=Col_C$\n- \u82e5 $Col_A =Col_C$\u200b\u200b\u200b\u200b\uff0c\u5219 $Col_C=1$\u200b\u200b\u200b\uff1b\n\u5426\u5219\uff0c$Col_C\\not=1$\u200b\u200b\u200b \u4e14 $Col_C \\not= 2$\u200b\u200b\u200b\uff0c\u6240\u4ee5 $Col_C=3$\u200b\u200b\u200b\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 $B~C~D$ \u7684\u5173\u7cfb\u63a8\u51fa $Col_D$\uff0c\u8fdb\u800c\u7528\u7c7b\u4f3c\u7684\u65b9\u5f0f\u63a8\u51fa\u6240\u6709\u6bb5\u7684\u989c\u8272\uff0c\u4e5f\u5c31\u77e5\u9053\u4e86\u6240\u6709\u4f4d\u7f6e\u7684\u989c\u8272\uff0c\u603b\u5171\u4f7f\u7528\u4e86 $5$ \u6b21\u8be2\u95ee\u3002\n\n## Code\n```cpp\n#include<bits/stdc++.h>\n#define pb push_back\n#define mkr make_pair\nusing namespace std;\nconst int N=1e5+10;\n\nint T,n;\nvector<pair<int,int> >q;\nvector<bool>res;\nchar str[N];\n\nvoid ask(){\n\tif(!(int)q.size()) return ;\n\tres.clear();\n\tprintf(\"Q %d\",(int)q.size());\n\tfor(auto v:q) printf(\" %d %d\",v.first,v.second);\n\tputchar('\\n');\n\tfflush(stdout);\n\tscanf(\"%s\",str);\n\tfor(int i=0;i<(int)q.size();i++) res.pb(str[i]-'0');\n\tq.clear();\n}\nstruct Dsu{\n\tint fa[N],siz[N];\n\tvoid prepare(int n){for(int i=1;i<=n;i++) fa[i]=i,siz[i]=1;}\n\tinline int find(int x){return (x==fa[x])?x:find(fa[x]);}\n\tvoid merge(int x,int y){\n\t\tint fx=find(x),fy=find(y);\n\t\tif(fx==fy) return ;\n\t\tif(siz[fx]>siz[fy]) swap(fx,fy);\n\t\tfa[fx]=fy,siz[fy]+=siz[fx];\n\t}\n}d;\nint pos[N],cnt,col[N];\nint pre[N];\nvector<int>ans[3];\n\nint main(){\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%d\",&n);\n\t\td.prepare(n);\n\t\tcnt=0;\n\t\tans[0].clear(),ans[1].clear(),ans[2].clear();\n\t\tfor(int i=1;i<n;i+=2) q.pb(mkr(i,i+1));\n\t\task();\n\t\tfor(int i=1,j=0;i<n;i+=2,j++) if(res[j]) d.merge(i,i+1);\n\t\tfor(int i=2;i<n;i+=2) q.pb(mkr(i,i+1));\n\t\task();\n\t\tfor(int i=2,j=0;i<n;i+=2,j++) if(res[j]) d.merge(i,i+1);\n\t\t\n\t\tfor(int i=1;i<=n;i++) if(i==d.find(i)) pos[++cnt]=i;\n\n\t\tfor(int i=1;i+2<=cnt;i+=3) q.pb(mkr(pos[i],pos[i+2]));\n\t\task();\n\t\tfor(int i=1,j=0;i+2<=cnt;i+=3,j++) pre[i+2]=res[j];\n\t\tfor(int i=2;i+2<=cnt;i+=3) q.pb(mkr(pos[i],pos[i+2]));\n\t\task();\n\t\tfor(int i=2,j=0;i+2<=cnt;i+=3,j++) pre[i+2]=res[j];\n\t\tfor(int i=3;i+2<=cnt;i+=3) q.pb(mkr(pos[i],pos[i+2]));\n\t\task();\n\t\tfor(int i=3,j=0;i+2<=cnt;i+=3,j++) pre[i+2]=res[j];\n\n\t\tcol[pos[1]]=0,col[pos[2]]=1;\n\t\tfor(int i=3;i<=cnt;i++)\n\t\t\tif(pre[i]==0) col[pos[i]]=3-col[pos[i-1]]-col[pos[i-2]];\n\t\t\telse col[pos[i]]=col[pos[i-2]];\n\t\tfor(int i=1;i<=n;i++) ans[col[d.find(i)]].push_back(i);\n\n\t\tprintf(\"A %d %d %d\\n\",(int)ans[0].size(),(int)ans[1].size(),(int)ans[2].size());\n\t\tfor(int v:ans[0]) printf(\"%d \",v);\n\t\tputchar('\\n');\n\t\tfor(int v:ans[1]) printf(\"%d \",v);\n\t\tputchar('\\n');\n\t\tfor(int v:ans[2]) printf(\"%d \",v);\n\t\tputchar('\\n');\n\t\tfflush(stdout);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1642333417,
        "uid": 304532,
        "name": "DJRzjl",
        "ccfLevel": 7,
        "title": "CF1147E"
    },
    {
        "content": "[\u6d1b\u8c37\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1147E)\t[CF\u4f20\u9001\u95e8](http://codeforces.com/problemset/problem/1147/E)\n\n### \u9898\u610f\n\n\u6709 $n$ \u4e2a\u786c\u5e01\uff0c\u6bcf\u4e2a\u786c\u5e01\u6709\u4e00\u79cd\u989c\u8272\uff0c\u662fR\uff0cG\uff0cB\u4e2d\u7684\u4e00\u79cd\u3002\u53ef\u4ee5\u9009\u62e9\u4e24\u4e2a\u786c\u5e01\u8fdb\u884c\u8be2\u95ee\u989c\u8272\u662f\u5426\u4e00\u6837\uff0c\u6bcf\u6b21\u53ef\u4ee5\u540c\u65f6\u8be2\u95ee\u82e5\u5e72\u5bf9\u786c\u5e01\uff08\u4e00\u4e2a\u786c\u5e01\u4e0d\u80fd\u540c\u65f6\u5c5e\u4e8e\u4e24\u5bf9\uff09\u3002\u6700\u591a7\u6b21\u8be2\u95ee\uff0c\u5c06\u786c\u5e01\u5206\u4e3a\u989c\u8272\u4e0d\u540c\u7684\u4e09\u7ec4\u3002\n\n### Solution\n\n\u8fd9\u662f\u4e2a\u601d\u7ef4\u5f88\u68d2\u7684\u4ea4\u4e92\u9898\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u8be2\u95ee\u4e24\u6b21\uff1a\n\n1.\u7b2c\u4e00\u6b21\u8be2\u95ee $2i-1,2i\\rightarrow 1 2|3 4|56 |\\cdots$ \n\n2.\u7b2c\u4e8c\u6b21\u8be2\u95ee $2i,2i+1\\rightarrow 23|45|67|\\cdots$ \n\n\u8fd9\u6837\u505a\u53ef\u4ee5\u5f97\u5230\u4e24\u8fb9\u76f8\u90bb\u7684\u989c\u8272\u662f\u5426\u4e00\u6837\u3002\n\n\u5982\u679c\u4e00\u6837\uff0c\u5c31\u5c06\u4ed6\u4eec\u5408\u5e76\u3002\u8bbe\u5408\u5e76\u5b8c\u7528 $now$ \u8868\u793a\uff0c\u90a3\u4e48\u6b64\u65f6\u5bf9\u4e8e $now_i$ \uff0c $now_{i-1},now_{i+1}$ \u548c\u5b83\u7684\u989c\u8272\u90fd\u4e0d\u4e00\u6837\u3002\n\n \u4f46\u662f $now_{i-1},now_{i+1}$ \u4e4b\u95f4\u7684\u5173\u7cfb\u6211\u4eec\u8fd8\u4e0d\u77e5\u9053\uff0c\u6240\u4ee5\u8fd8\u8981\u8be2\u95ee\u4e24\u6b21\uff1a\n\n1.\u7b2c\u4e09\u6b21\u8be2\u95ee $now_{i-2},now_{i}$ \n\n2.\u7b2c\u56db\u6b21\u8be2\u95ee $now_i,now_{i+2}$ \n\n\u6b64\u65f6\u6211\u4eec\u5bf9\u4e8e\u6240\u6709\u786c\u5e01\u4e4b\u95f4\u7684\u5173\u7cfb\u5c31\u90fd\u77e5\u9053\u4e86\uff0c\u7136\u540e\u626b\u4e00\u904d\u6c42\u7b54\u6848\u5373\u53ef\n\n### Code\n\n```c++\n#include<bits/stdc++.h>\n#define PII pair<int,int>\n\nusing namespace std;\nconst int N=100010;\nint T,n,cnt,now[N],ans[N];\nchar ch[N];\nvector<int>A,B,C;\nmap<PII,bool>col;\n\ninline void ask(){\n    if(!A.size()) return ;\n    printf(\"Q %d \",(int)A.size());\n    for(int i=0;i<A.size();i++) printf(\"%d %d \",A[i],B[i]);\n    puts(\"\");\n    fflush(stdout);\n    scanf(\"%s\",ch+1);\n    for(int i=0;i<A.size();i++) col[make_pair(A[i],B[i])]=(ch[i+1]=='1');\n}\n\nint main(){\n    scanf(\"%d\",&T);\n    while(T--){\n        cnt=0;col.clear();\n        memset(ans,0,sizeof(ans));\n        scanf(\"%d\",&n);\n        A.clear();B.clear();\n        for(int i=2;i<=n;i+=2){\n            A.push_back(i-1);\n            B.push_back(i);\n        }\n        ask();\n        A.clear();B.clear();\n        for(int i=3;i<=n;i+=2){\n            A.push_back(i-1);\n            B.push_back(i);\n        }\n        ask();\n        now[++cnt]=1;\n        for(int i=2;i<=n;i++)\n            if(!col[make_pair(i-1,i)]) now[++cnt]=i;\n        A.clear();B.clear();\n        for(int i=3;i<=cnt;i+=4) A.push_back(now[i-2]),B.push_back(now[i]);\n        for(int i=4;i<=cnt;i+=4) A.push_back(now[i-2]),B.push_back(now[i]);\n        ask();\n        A.clear();B.clear();\n        for(int i=3;i<=cnt-2;i+=4) A.push_back(now[i]),B.push_back(now[i+2]);\n        for(int i=4;i<=cnt-2;i+=4) A.push_back(now[i]),B.push_back(now[i+2]);\n        ask();\n        ans[now[1]]=1;\n        if(cnt>1) ans[now[2]]=2;\n        for(int i=3;i<=cnt;i++){\n            if(col[make_pair(now[i-2],now[i])]) ans[now[i]]=ans[now[i-2]];\n            else ans[now[i]]=6-ans[now[i-2]]-ans[now[i-1]];\n        }\n        A.clear();B.clear();C.clear();\n        for(int i=1,t;i<=n;i++){\n            if(ans[i]) t=ans[i];\n            ans[i]=t;\n            if(ans[i]==1) A.push_back(i);\n            else if(ans[i]==2) B.push_back(i);\n            else if(ans[i]==3) C.push_back(i);\n        }\n        printf(\"A %d %d %d\\n\",(int)A.size(),(int)B.size(),(int)C.size());\n        for(int i=0;i<A.size();i++) printf(\"%d \",A[i]);\n        puts(\"\");\n        for(int i=0;i<B.size();i++) printf(\"%d \",B[i]);\n        puts(\"\");\n        for(int i=0;i<C.size();i++) printf(\"%d \",C[i]);\n        puts(\"\");\n        fflush(stdout);\n    }\n}\n```\n\n",
        "postTime": 1603380184,
        "uid": 272143,
        "name": "\u662f\u4e2a\u6c49\u5b50",
        "ccfLevel": 4,
        "title": "CF1147E Rainbow Coins"
    }
]