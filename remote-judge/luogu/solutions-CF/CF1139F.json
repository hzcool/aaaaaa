[
    {
        "content": "\u9898\u610f\n=\n\n- $n$ \u79cd\u83dc\u548c $m$ \u4e2a\u4eba\n\n- \u6bcf\u79cd\u83dc $i$ \u6709\u4e09\u4e2a\u5c5e\u6027 $p_i,s_i,b_i$\n\n- \u6bcf\u4e2a\u4eba $j$ \u6709\u4e24\u4e2a\u5c5e\u6027 $inc_j,pref_j$\n\n- \u4e00\u4e2a\u4eba $j$ \u80fd\u54c1\u5c1d\u83dc $i$ \u5f53\u4e14\u4ec5\u5f53 $p_i\\le inc_j\\le s_i$ \u4e14 $|b_i-pref_j|\\le inc_j-p_i$\n\n- \u6c42\u6bcf\u4e2a\u4eba\u80fd\u54c1\u5c1d\u591a\u5c11\u79cd\u83dc\n\n- $1\\le n,m\\le 10^5$ \uff0c\u5176\u4ed6\u6570\u636e\u5747\u4e3a $10^9$ \u7ea7\u522b\n\n\u7b97\u6cd5\uff1a\u626b\u63cf\u7ebf + \u6811\u72b6\u6570\u7ec4\n=\n\n- \u6b64\u9898\u6709\u4e00\u4e2a\u975e\u5e38\u5957\u8def\u7684 $O((n+m)\\log^2n)$ \u505a\u6cd5\uff08 CDQ \u5206\u6cbb\uff09\u548c\u4e00\u4e2a\u6bd4\u8f83\u5999\u7684\u5b98\u65b9\u9898\u89e3\u505a\u6cd5\uff0c\u590d\u6742\u5ea6\u5c11\u4e00\u4e2a $\\log$ \uff0c\u4e0b\u9762\u53ea\u8ba8\u8bba\u540e\u8005\n\n- \u9996\u5148\uff0c $|b_i-pref_j|\\le inc_j-p_i$ \u5c31\u76f8\u5f53\u4e8e $b_i-pref_j\\le inc_j-p_i$ \u4e14 $pref_j-b_i\\le inc_j-p_i$\n\n- \u628a\u95ee\u9898\u62bd\u8c61\u5230\u4e8c\u7ef4\u5e73\u9762\u4e0a\uff0c\u4e00\u4e2a\u70b9 $(x,y)$ \u8868\u793a\u4e00\u4e2a\u4eba\u7684 $inc$ \u4e3a $x$ \uff0c $pref$ \u4e3a $y$\n\n- \u6574\u7406\u4e00\u4e0b\u5f97\u51fa\u6761\u4ef6\n\n- \uff081\uff09 $p_i\\le inc_j\\le s_i$\n\n- \uff082\uff09 $inc_j+pref_j\\ge b_i+p_i$\n\n- \uff083\uff09 $pref_j-inc_j\\le b_i-p_i$\n\n- \u8fd9\u76f8\u5f53\u4e8e\u70b9 $(inc_j,pref_j)$ \u4f4d\u4e8e\u5982\u4e0b\u56fe\u6240\u793a\u7684\u4e09\u89d2\u5f62\u5185\uff08\u542b\u8fb9\u754c\uff09\n\n![(p[i],b[i])(s[i],b[i]+p[i]-s[i])(s[i],b[i]+s[i]-p[i])\u4e09\u70b9\u6784\u6210\u7684\u4e09\u89d2\u5f62](https://img-blog.csdnimg.cn/20190326213144721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3h5ejMyNzY4,size_16,color_FFFFFF,t_70)\n\n- \u8003\u8651\u626b\u63cf\u7ebf\uff0c\u628a\u6240\u6709\u4eba\u79bb\u7ebf\u6309\u7167 $inc$ \u6392\u5e8f\uff0c\u6309\u7167 $x$ \u5750\u6807\u9012\u589e\u7684\u987a\u5e8f\u626b\u63cf\uff0c\u5f53\u626b\u5230 $b_i$ \u65f6\u52a0\u5165\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u7684\u5f71\u54cd\uff0c\u626b\u5230 $s_i+1$ \u65f6\u53bb\u9664\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u7684\u5f71\u54cd\n\n- \u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u4eba $(inc_j,pref_j)$ \u9700\u8981\u8be2\u95ee\u8fd9\u4e2a\u70b9\u5728\u591a\u5c11\u4e2a\u4e09\u89d2\u5f62\u5185\n\n- \u8003\u8651\u5dee\u5206\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53 $x=x_0$ \u65f6\uff0c\u5982\u679c\u76f4\u7ebf $x=x_0$ \u7ecf\u8fc7\u4e86\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u4e14 $y$ \u5750\u6807\u8303\u56f4 $[l,r]$ \u88ab\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u8986\u76d6\uff0c\u5219\u5728 $l$ \u5904\u8d21\u732e $1$ \uff0c $r+1$ \u5904\u8d21\u732e $-1$ \uff0c\u5219\u5f53 $inc_j=x_0$ \u65f6\uff0c\u5355\u70b9\u8be2\u95ee $(inc_j,pref_j)$ \u8f6c\u5316\u6210\u8be2\u95ee\u524d\u7f00\u548c $pref_j$\n\n- \u4e8e\u662f\u6211\u4eec\u8003\u8651\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u7684\u5f71\u54cd\uff0c\u53ef\u4ee5\u770b\u6210\n\n- \uff081\uff09\u5728\u76f4\u7ebf $x+y=b_i+p_i$ \u4e0a\u8d21\u732e $1$\n\n- \uff082\uff09\u5728\u76f4\u7ebf $y-x=b_i-p_i+1$ \u4e0a\u8d21\u732e $-1$\n\n- \u6d88\u9664\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u7684\u5f71\u54cd\u5219\u540c\u7406\n\n- \u8be2\u95ee\u76f8\u5f53\u4e8e\u8be2\u95ee\u6a2a\u5750\u6807\u4e3a $inc_j$ \uff0c\u7eb5\u5750\u6807\u4e0d\u8d85\u8fc7 $pref_j$ \u7684\u8d21\u732e\u4e4b\u548c\n\n- \u7528\u4e24\u4e2a\u6570\u636e\u7ed3\u6784 $A$ \u548c $B$ \u5206\u522b\u8bb0\u5f55 $x+y$ \u548c $y-x$ \u7684\u8d21\u732e\n\n- \u76f4\u7ebf $x+y=k$ \u80fd\u4e3a $(inc_j,pref_j)$ \u8d21\u732e\u5f53\u4e14\u4ec5\u5f53 $k\\le inc_j+pref_j$\n\n- \u6240\u4ee5\u52a0\u5165\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u65f6\uff0c\u5728\u6570\u636e\u7ed3\u6784 $A$ \u7684 $b_i+p_i$ \u5904\u8fdb\u884c\u5355\u70b9\u52a0 $1$\n\n- \u76f4\u7ebf $y-x=k$ \u80fd\u4e3a\u8be2\u95ee\u8d21\u732e\u5f53\u4e14\u4ec5\u5f53 $k\\le pref_j-inc_j$\n\n- \u6240\u4ee5\u52a0\u5165\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u65f6\uff0c\u5728\u6570\u636e\u7ed3\u6784 $B$ \u7684 $b_i-p_i+1$ \u5904\u8fdb\u884c\u5355\u70b9\u52a0 $1$\n\n- \u8fd9\u6837\u7b2c $j$ \u4e2a\u8be2\u95ee\u7684\u7b54\u6848\u5c31\u662f\u5f53 $x$ \u626b\u63cf\u5230 $inc_j$ \u65f6\uff0c\u6570\u636e\u7ed3\u6784 $A$ \u7684\u524d\u7f00\u548c $inc_j+pref_j$ \u51cf\u53bb\u6570\u636e\u7ed3\u6784 $B$ \u7684\u524d\u7f00\u548c $pref_j-inc_j$\n\n- \u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7b49\u5b9e\u73b0\n\n- \u590d\u6742\u5ea6 $O((n+m)\\log(n+m))$\n\n\u4ee3\u7801\n=\n\n```cpp\n#include <bits/stdc++.h>\n\n// 20030830\n\ninline int read()\n{\n\tint res = 0; bool bo = 0; char c;\n\twhile (((c = getchar()) < '0' || c > '9') && c != '-');\n\tif (c == '-') bo = 1; else res = c - 48;\n\twhile ((c = getchar()) >= '0' && c <= '9')\n\t\tres = (res << 3) + (res << 1) + (c - 48);\n\treturn bo ? ~res + 1 : res;\n}\n\nconst int N = 1e5 + 5, M = N << 2;\n\nint n, m, p[N], s[N], b[N], inc[N], pref[N], tot, a[M], A[M], B[M], cnt, ans[N];\n\nstruct node\n{\n\tint tm, x, y, op, id;\n} que[M];\n\ninline bool comp(node a, node b)\n{\n\treturn a.tm < b.tm || (a.tm == b.tm && a.op < b.op);\n}\n\nvoid changeA(int x, int v)\n{\n\tfor (; x <= tot; x += x & -x)\n\t\tA[x] += v;\n}\n\nint askA(int x)\n{\n\tint res = 0;\n\tfor (; x; x -= x & -x)\n\t\tres += A[x];\n\treturn res;\n}\n\nvoid changeB(int x, int v)\n{\n\tfor (; x <= tot; x += x & -x)\n\t\tB[x] += v;\n}\n\nint askB(int x)\n{\n\tint res = 0;\n\tfor (; x; x -= x & -x)\n\t\tres += B[x];\n\treturn res;\n}\n\nint main()\n{\n\tn = read(); m = read();\n\tfor (int i = 1; i <= n; i++) p[i] = read();\n\tfor (int i = 1; i <= n; i++) s[i] = read();\n\tfor (int i = 1; i <= n; i++) b[i] = read();\n\tfor (int i = 1; i <= m; i++) inc[i] = read();\n\tfor (int i = 1; i <= m; i++) pref[i] = read();\n\tfor (int i = 1; i <= n; i++)\n\t\ta[++tot] = p[i] + b[i], a[++tot] = b[i] - p[i] + 1;\n\tfor (int i = 1; i <= m; i++)\n\t\ta[++tot] = inc[i] + pref[i], a[++tot] = pref[i] - inc[i];\n\tstd::sort(a + 1, a + tot + 1);\n\tint tt = std::unique(a + 1, a + tot + 1) - a - 1;\n\ttot = tt;\n\tfor (int i = 1; i <= n; i++)\n\t\tque[++cnt] = (node) {p[i], p[i], b[i], 1, 0},\n\t\tque[++cnt] = (node) {s[i] + 1, p[i], b[i], -1, 0};\n\tfor (int i = 1; i <= m; i++)\n\t\tque[++cnt] = (node) {inc[i], inc[i], pref[i], 2, i};\n\tstd::sort(que + 1, que + cnt + 1, comp);\n\tfor (int i = 1; i <= cnt; i++)\n\t\tif (que[i].op <= 1)\n\t\t{\n\t\t\tchangeA(std::lower_bound(a + 1, a + tot + 1,\n\t\t\t\tque[i].x + que[i].y) - a, que[i].op);\n\t\t\tchangeB(std::lower_bound(a + 1, a + tot + 1,\n\t\t\t\tque[i].y - que[i].x + 1) - a, que[i].op);\n\t\t}\n\t\telse ans[que[i].id] = askA(std::lower_bound(a + 1, a + tot + 1,\n\t\t\tque[i].x + que[i].y) - a) -\n\t\t\taskB(std::lower_bound(a + 1, a + tot + 1,\n\t\t\tque[i].y - que[i].x) - a);\n\tfor (int i = 1; i <= m; i++) printf(\"%d \", ans[i]);\n\treturn puts(\"\"), 0;\n}\n```",
        "postTime": 1553829354,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1139F \u3010Dish Shopping\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1139F)\n\n## \u601d\u8def\n\n\u6211\u7684 $\\rm cdq$ \u5206\u6cbb\u6bd4\u8f83\u5947\u602a\uff0c\u7801\u6bd4\u8f83\u957f\uff0c\u4f46\u662f\u5f88\u597d\u7406\u89e3\u3002\n\n\u9996\u5148\u8fd9\u4e2a\u9898\u76ee\u663e\u7136\u662f\u4e09\u7ef4\u504f\u5e8f\uff0c\u7edd\u5bf9\u503c\u62c6\u62c6\u5c31\u597d\u4e86\u3002\n\n\u6211\u4eec\u5148\u8ba8\u8bba $b_i \\ge pref_j$ \u7684\u60c5\u51b5\uff0c\u76f8\u5f53\u4e8e\u6ee1\u8db3\u4e09\u4e2a\u9650\u5236\uff1a\n\n$$b_i \\ge pref_j$$\n\n$$b_i+p_i \\le inc_j+pref_j$$\n\n$$inc_j \\le s_i$$\n\n\n\u8fd9\u4e2a\u4e1c\u897f\u6bd4\u8f83\u96be\u53d7\uff0c\u8003\u8651\u53d6\u53cd\u4e00\u4e9b\u503c\uff0c\u7136\u540e\u5168\u90e8\u90fd\u53d8\u6210 $\\le$ \u6216 $\\ge$\u3002\n\n$$-b_i \\le -pref_j$$\n\n$$b_i+p_i \\le inc_j+pref_j$$\n\n$$-s_i \\le -inc_j$$\n\n\u76f4\u63a5\u4e09\u7ef4\u504f\u5e8f\u5c31\u597d\u4e86\uff0c\u53e6\u4e00\u79cd\u60c5\u51b5\u540c\u7406\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f $\\rm cdq$ \u7684\u5b9e\u73b0\u95ee\u9898\u4e86\u3002\n\n\u5148\u6309\u7b2c\u4e00\u7ef4\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\n\n\u7136\u540e\u5206\u6cbb\uff0c\u5bf9\u5de6\u53f3\u533a\u95f4\u5206\u522b\u6309\u7b2c\u4e8c\u7ef4\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\n\n\u7136\u540e\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u7b2c\u4e09\u7ef4\u5750\u6807\uff0c\u76f4\u63a5\u6765\u5c31\u597d\u4e86\u3002\n\n\u4f46\u662f\u771f\u7684\u5417\uff1f\n\n\u53f3\u533a\u95f4\u6709\u6728\u6709\u53ef\u80fd\u5bf9\u5de6\u533a\u95f4\u4ea7\u751f\u8d21\u732e\u5462\u3002\n\n\u663e\u7136\u6709\u53ef\u80fd\uff0c\u8003\u8651\u6709\u4e00\u6bb5\u533a\u95f4 $(s,t)$\uff0c\u8fd9\u4e9b\u6570\u7684\u7b2c\u4e00\u7ef4\u503c\u76f8\u7b49\uff0c\u4e14 $s \\le mid \\le mid+1 \\le t$\u3002\n\n\u6211\u7684\u5904\u7406\u65b9\u5f0f\u5c31\u662f\u76f4\u63a5\u628a\u8fd9\u4e9b\u6570\u62ce\u51fa\u6765\uff0c\u7136\u540e\u76f4\u63a5\u7b97\u53f3\u8fb9\u5bf9\u5de6\u8fb9\u7684\u8d21\u732e\u3002\n\n\u53ef\u80fd\u5904\u7406\u65b9\u5f0f\u6bd4\u8f83\u50bb\uff0c\u4f46\u662f\u786e\u5b9e\u5f88\u597d\u7406\u89e3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O((n+m) \\log^2 (n+m))$\u3002\n\n\u636e\u8bf4\u6709\u5355 $\\log$ \u4e8c\u7ef4\u6570\u70b9\uff0c\u53ef\u662f\u6211\u4e0d\u60f3\u7528\u8111\u5b50\u3002\n\n## \u4ee3\u7801\n\n\u8d34\u4e00\u4e2a $\\rm cdq$ \u90e8\u5206\u4ee3\u7801\u5427\uff1a\n\n```cpp\ninline void cdq(int l,int r){\n    if (l==r) return;\n    cdq(l,mid);cdq(mid+1,r);\n    sort(q+l,q+mid+1,cmp2);\n    sort(q+mid+1,q+r+1,cmp2);\n    int j=l;\n    for (int i=mid+1;i<=r;++i){\n        while (q[i].b>=q[j].b && j<=mid)\n            if (!q[j].id) T.update(q[j].c,1),++j;\n            else ++j;\n        if (q[i].id) ans[q[i].id]+=T.query(q[i].c);\n    }\n    for (int i=l;i<j;++i) if (!q[i].id) T.update(q[i].c,-1);\n        \n    int cnt1=0,Min=9e18;\n    for (int i=mid+1;i<=r;++i) Min=min(Min,q[i].s);\n    for (int i=mid+1;i<=r;++i) if (q[i].s==Min) Q[++cnt1]=q[i];\n    int cnt2=0,Max=-9e18;\n    for (int i=l;i<=mid;++i) Max=max(Max,q[i].s);\n    for (int i=l;i<=mid;++i) if (q[i].s==Max) P[++cnt2]=q[i];\n    if (Min!=Max) return;\n\n    j=1;\n    for (int i=1;i<=cnt2;++i){\n        while (P[i].b>=Q[j].b && j<=cnt1)\n            if (!Q[j].id) T.update(Q[j].c,1),++j;\n            else ++j;\n        if (P[i].id) ans[P[i].id]+=T.query(P[i].c);\n    }\n    for (int i=1;i<j;++i) if (!Q[i].id) T.update(Q[i].c,-1);\n}\n```",
        "postTime": 1673407977,
        "uid": 253608,
        "name": "Tx_Lcy",
        "ccfLevel": 7,
        "title": "CF1139F Dish Shopping"
    },
    {
        "content": "## \u524d\u8a00\n\n\u6ca1\u4eba\u5199 CDQ \u5206\u6cbb\uff0c\u90a3\u5c31\u8ba9\u6211\u6765\u8865\u4e00\u53d1\u3002\n\n## \u9898\u89e3\n\n\u7ecf\u5178\u5957\u8def\u2014\u2014\u770b\u5230\u7edd\u5bf9\u503c\u5c31\u5206\u7c7b\u8ba8\u8bba\uff08\u5c24\u5176\u662f\u5728\u7edd\u5bf9\u503c\u7b26\u53f7\u6bd4\u8f83\u5c11\u7684\u65f6\u5019\uff09\u3002\n\n\u90a3\u4e48\uff0c\u9898\u76ee\u6240\u6c42\u7684\u7b2c $j$ \u4e2a\u7b54\u6848\u5373\u4e3a\u4e0b\u9762**\u4e24\u4e2a\u65b9\u7a0b\u7ec4\u4e2d $i$ \u7684\u53d6\u503c\u4e2a\u6570\u4e4b\u548c**\uff1a\n\n$$\\begin{cases}\nb_i+p_i \\le inc_j+pref_j\\\\\ns_i \\ge inc_j\\\\\nb_i \\ge pref_j\n\\end{cases}$$\n\n$$\\begin{cases}\np_i-b_i \\le inc_j-pref_j\\\\\ns_i \\ge inc_j\\\\\nb_i<pref_j\n\\end{cases}$$\n\n\uff08\u5bf9\u9898\u76ee\u6761\u4ef6\u7684\u5f0f\u5b50\u8fdb\u884c\u7edd\u5bf9\u503c\u7684\u8ba8\u8bba\u4ee5\u53ca\u79fb\u9879\u5373\u53ef\u5f97\u5230\uff09\n\n\u5bb9\u6613\u770b\u51fa\u8fd9\u662f**\u4e09\u7ef4\u504f\u5e8f**\uff0c\u4e8e\u662f\u76f4\u63a5\u4e0a **bitset\uff0cCDQ \u5206\u6cbb\u6216 KD-Tree** \u5373\u53ef\u3002\n\n\u4e0d\u4f1a\u7684\u8bf7\u5de6\u8f6c\u6a21\u677f\u533a\uff1a[\u6d1b\u8c37 P3810 \u3010\u6a21\u677f\u3011\u4e09\u7ef4\u504f\u5e8f\uff08\u964c\u4e0a\u82b1\u5f00\uff09](https://www.luogu.com.cn/problem/P3810)\uff0c\u8fd9\u91cc\u53ea\u63d0\u4e00\u4e9b\u7ec6\u8282\u95ee\u9898\u3002\n\n------------\n\n\u4e3a\u4e86\u4fbf\u4e8e\u5904\u7406\uff0c\u53ef\u5c06\u4e0a\u8ff0\u4e24\u4e2a\u65b9\u7a0b\u7ec4\u4e2d\u7684 $\\ge$ \u548c $<$ \u90fd\u53d8\u6210 $\\le$\uff0c\u5f97\u5230\u5982\u4e0b\u65b9\u7a0b\u7ec4\uff1a\n\n$$\\begin{cases}\nb_i+p_i \\le inc_j+pref_j\\\\\n-s_i \\le -inc_j\\\\\n-b_i \\le -pref_j\n\\end{cases}$$\n\n$$\\begin{cases}\np_i-b_i \\le inc_j-pref_j\\\\\n-s_i \\le -inc_j\\\\\nb_i+1 \\le pref_j\n\\end{cases}$$\n\n------------\n\n\u5b9e\u73b0\u65f6\u9700**\u6ce8\u610f\u67d0\u4e00\u7ef4\u76f8\u540c\u7684\u60c5\u51b5**\u2014\u2014\u7b14\u8005\u4f7f\u7528\u7684\u662f CDQ \u5206\u6cbb\uff0c\u5177\u4f53\u5305\u62ec\uff1a\u7b2c\u4e00\u7ef4\u7684\u6bd4\u8f83\u51fd\u6570\uff0c\u7b2c\u4e8c\u7ef4\u7684\u5f52\u5e76\u6392\u5e8f\u3002\n\n\u4f60\u4e5f\u53ef\u4ee5\u5c06\u4e0a\u8ff0 $\\le$ \u6539\u6210 $<$ \u800c\u8fdb\u884c\u5176\u4ed6\u5904\u7406\u3002\n\n\u800c\u7b2c\u4e09\u7ef4\u53ea\u9700\u6ce8\u610f\uff1a\u9700\u8981\u63d0\u524d**\u79bb\u6563\u5316**\uff0c\u4ee5\u4f7f\u7528**\u6811\u72b6\u6570\u7ec4**\u3002\n\n------------\n\n\u4f7f\u7528 CDQ \u5206\u6cbb\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((n+m)\\log^2{(n+m)})$\u3002\n\n## \u4ee3\u7801\n\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,cnt;\nconst int max_n=1e5+5;\nint p[max_n],s[max_n],b[max_n];\nconst int max_m=1e5+5;\nint inc[max_m],pref[max_m],ans[max_m];\nconst int max_cnt=2e5+5;\nstruct Triplet\n{\n\tint x,y,z,id;\n\tinline Triplet(int p=0,int q=0,int r=0,int k=0)\n\t{\n\t\tx=p,y=q,z=r,id=k;\n\t}\n}t[max_cnt],now[max_cnt];\ninline bool operator < (const Triplet &a,const Triplet &b)\n{\n\treturn a.x!=b.x?a.x<b.x:a.id<b.id;\n}\nconst int max_R=2e5+5;\nint Hash[max_R],R;\nnamespace BIT\n{\n\tint val[max_R];\n\tinline void modify(int k,int v)\n\t{\n\t\tfor(int i=k;i<=R;i+=i&(-i))\n\t\t\tval[i]+=v;\n\t}\n\tinline int query(int k)\n\t{\n\t\tint res=0;\n\t\tfor(int i=k;i>0;i-=i&(-i))\n\t\t\tres+=val[i];\n\t\treturn res;\n\t}\n}\nvoid CDQ(int l,int r)\n{\n\tif(l==r)\n\t\treturn;\n\tint mid=(l+r)>>1;\n\tCDQ(l,mid),CDQ(mid+1,r);\n\tint k=l;\n\tfor(int i=l,j=mid+1;i<=mid||j<=r;)\n\t{\n\t\tif(i<=mid&&(j>r||t[i].y<=t[j].y))\n\t\t{\n\t\t\tif(!t[i].id)\n\t\t\t\tBIT::modify(t[i].z,1);\n\t\t\tnow[k++]=t[i++];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(t[j].id)\n\t\t\t\tans[t[j].id]+=BIT::query(t[j].z);\n\t\t\tnow[k++]=t[j++];\n\t\t}\n\t}\n\tfor(int i=l;i<=mid;++i)\n\t{\n\t\tif(!t[i].id)\n\t\t\tBIT::modify(t[i].z,-1);\n\t}\n\tfor(int i=l;i<=r;++i)\n\t\tt[i]=now[i];\n}\ninline void solve()\n{\n\tsort(t+1,t+cnt+1);\n\tfor(int i=1;i<=cnt;++i)\n\t\tHash[i]=t[i].z;\n\tsort(Hash+1,Hash+cnt+1);\n\tR=unique(Hash+1,Hash+cnt+1)-Hash-1;\n\tfor(int i=1;i<=cnt;++i)\n\t\tt[i].z=lower_bound(Hash+1,Hash+R+1,t[i].z)-Hash;\n\tCDQ(1,cnt);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d\",p+i);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d\",s+i);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d\",b+i);\n\tfor(int i=1;i<=m;++i)\n\t\tscanf(\"%d\",inc+i);\n\tfor(int i=1;i<=m;++i)\n\t\tscanf(\"%d\",pref+i);\n\tcnt=n+m;\n\tfor(int i=1;i<=n;++i)\n\t\tt[i]=Triplet(b[i]+p[i],-s[i],-b[i],0);\n\tfor(int i=1;i<=m;++i)\n\t\tt[n+i]=Triplet(inc[i]+pref[i],-inc[i],-pref[i],i);\n\tsolve();\n\tfor(int i=1;i<=n;++i)\n\t\tt[i]=Triplet(p[i]-b[i],-s[i],b[i]+1,0);\n\tfor(int i=1;i<=m;++i)\n\t\tt[n+i]=Triplet(inc[i]-pref[i],-inc[i],pref[i],i);\n\tsolve();\n\tfor(int i=1;i<=m;++i)\n\t\tprintf(\"%d%c\",ans[i],i<m?' ':'\\n');\n\treturn 0;\n}\n```",
        "postTime": 1631533085,
        "uid": 145355,
        "name": "wsyhb",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF1139F Dish Shopping"
    },
    {
        "content": "\n\u89c2\u5bdf\u5230\u8fd9\u4e2a\u5f62\u5f0f\uff0c\u9996\u5148\u60f3\u5230\u4e86\u504f\u5e8f\u3002\u4f46\u662f\u7b2c\u4e8c\u4e2a\u504f\u5e8f\u5e26\u7edd\u5bf9\u503c\uff0c\u800c\u4e14\u4e24\u8fb9\u90fd\u6709\u4eba\u548c\u83dc\uff0c\u4e0d\u597d\u5904\u7406\u3002\n\n\u6240\u4ee5\u8003\u8651\u5206\u7c7b\u8ba8\u8bba\u62c6\u5f00\u7edd\u5bf9\u503c\uff0c\u518d\u628a\u4eba\u7684\u5c5e\u6027\u653e\u5728\u4e00\u8fb9\u3001\u83dc\u7684\u5c5e\u6027\u653e\u5728\u4e00\u8fb9\u3002\u4f46\u662f\u7531\u4e8e\u6709\u5206\u8ba8\u7684\u9650\u5236\uff0c\u4f1a\u4ece\u4e8c\u4f4d\u504f\u5e8f\u53d8\u6210\u4e09\u7ef4\u504f\u5e8f\u3002\n\n\u5206\u7c7b\u8ba8\u8bba\u4e4b\u540e\uff0c\u6574\u7406\u4e00\u4e0b\u53ef\u5f97\u4ee5\u4e0b\u4e24\u79cd\u9650\u5236\uff1a\n\n- $\\begin{cases}b_i+p_i \\leq pref_j+inc_j\\\\p_i \\leq\tinc_j \\leq s_i\\\\b_i \\geq pref_j\\end{cases}$\n\n- $\\begin{cases}p_i \\leq inc_j \\leq s_i\\\\p_i-b_i\\geq inc_j-pref_j\\\\b_i<pref_j\\end{cases}$\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898\u5566\u3002CDQ \u5206\u6cbb\u7ef4\u62a4\u4e00\u4e0b\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n \\log^2 n)$\u3002\n\n\u5982\u679c\u4e3a\u4e86\u4ee3\u7801\u5b9e\u73b0\u7b80\u5355\uff0c\u53ef\u4ee5\u628a\u5f0f\u5b50\u90fd\u8f6c\u5316\u6210 $<$ \u548c $\\leq$ \u8fde\u63a5\u7684\uff0c\u7136\u540e\u5c01\u88c5 CDQ \u4e4b\u540e\u8dd1\u4e24\u904d\u3002",
        "postTime": 1681812511,
        "uid": 195198,
        "name": "E1_de5truct0r",
        "ccfLevel": 7,
        "title": "CF1139F"
    },
    {
        "content": "\u6ce8\u610f\u5230 $|b_i-pref_j|\\ge 0$\uff0c\u6240\u4ee5\u53ea\u8981\u6ee1\u8db3 $inc_j-p_i\\ge |b_i-pref_j|$ \u5c31\u4e00\u5b9a\u6ee1\u8db3 $inc_j\\ge p_i$\u3002\n\n\u7edd\u5bf9\u503c\u4e0d\u597d\u5904\u7406\uff0c\u628a\u4ed6\u62c6\u6210\u4e24\u4e2a\uff1a\n\n$$\n\\begin{cases}\ninc_j\\le s_i\\\\\ninc_j-p_i\\ge b_i-pref_j\\\\\ninc_j-p_i\\ge pref_j-b_i\n\\end{cases}\n$$\n\n\u6574\u7406\u4e00\u4e0b\uff1a\n\n$$\n\\begin{cases}\n-inc_j\\ge -s_i\\\\\ninc_j+pref_j\\ge b_i+p_i\\\\\ninc_j-pref_j\\ge p_i-b_i\n\\end{cases}\n$$\n\n\u76f4\u63a5 cdq \u5206\u6cbb\u8dd1\u4e09\u7ef4\u504f\u5e8f\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log^2 n)$\u3002\n\n```cpp\nconst int N=2e5+10;\nint p[N],s[N],b[N];\nint inc[N],pref[N];\nstruct node{\n\tint x,y,z,tp;\n}a[N];\nbool cmp(node x,node y)\n{\n\tif(x.x!=y.x)return x.x<y.x;\n\treturn x.tp<y.tp;\n}\nbool cmp1(node x,node y)\n{\n\tif(x.y!=y.y)return x.y<y.y;\n\treturn x.tp<y.tp;\n}\nint t[N],cc=0;\nstruct bit{\n\tint c[N];\n\tbit(){memset(c,0,sizeof(c));}\n\tint query(int x){int ans=0;for(;x;x-=x&-x)ans+=c[x];return ans;}\n\tvoid modify(int x,int d){for(;x<=cc;x+=x&-x)c[x]+=d;}\n}T;\nint Ans[N];\nvoid cdq(int L,int R)\n{\n\tif(L>=R)return;int mid=(L+R)>>1;\n\tcdq(L,mid),cdq(mid+1,R);\n\tsort(a+L,a+mid+1,cmp1),sort(a+mid+1,a+R+1,cmp1);\n\tint j=L;\n\tfor(int i=mid+1;i<=R;i++)\n\t{\n\t\twhile(j<=mid&&a[j].y<=a[i].y)\n\t\t{\n\t\t\tif(!a[j].tp)T.modify(a[j].z,1);\n\t\t\tj++;\n\t\t}\n\t\tif(a[i].tp)Ans[a[i].tp]+=T.query(a[i].z);\n\t}\n\tfor(int i=L;i<j;i++)if(!a[i].tp)T.modify(a[i].z,-1);\n}\nint main()\n{\n\tint n=read(),m=read();\n\tfor(int i=1;i<=n;i++)p[i]=read();\n\tfor(int i=1;i<=n;i++)s[i]=read();\n\tfor(int i=1;i<=n;i++)b[i]=read();\n\tfor(int i=1;i<=m;i++)inc[i]=read();\n\tfor(int i=1;i<=m;i++)pref[i]=read();\n\tfor(int i=1;i<=n;i++)t[++cc]=-s[i];\n\tfor(int i=1;i<=m;i++)t[++cc]=-inc[i];\n\tsort(t+1,t+cc+1),cc=unique(t+1,t+cc+1)-t-1;\n\tint c=0;\n\tfor(int i=1;i<=n;i++)c++,a[c].tp=0,a[c].x=b[i]+p[i],a[c].y=p[i]-b[i],a[c].z=-s[i];\n\tfor(int i=1;i<=m;i++)c++,a[c].tp=i,a[c].x=inc[i]+pref[i],a[c].y=inc[i]-pref[i],a[c].z=-inc[i];\n\tfor(int i=1;i<=c;i++)a[i].z=lower_bound(t+1,t+cc+1,a[i].z)-t;\n\tsort(a+1,a+c+1,cmp);\n\t\n//\tfor(int i=1;i<=c;i++)printf(\"tp=%d, x=%d, y=%d, z=%d\\n\",a[i].tp,a[i].x,a[i].y,a[i].z);\n\tcdq(1,c);\n\tfor(int i=1;i<=m;i++)printf(\"%d \",Ans[i]);\n\treturn 0;\n}\n//zzt qwq\n```",
        "postTime": 1646966643,
        "uid": 125913,
        "name": "zztqwq",
        "ccfLevel": 8,
        "title": "CF1139F Solution"
    },
    {
        "content": "\u4e00\u773c CDQ \u5206\u6cbb\uff0c\u7136\u540e\u53d1\u73b0\u662f\u4e2a\u88f8\u626b\u63cf\u7ebf+\u4e8c\u7ef4\u6570\u70b9\uff0c\u5c31\u5f53\u6210\u4e86\u6811\u5957\u6811\u677f\u5b50\u6765\u5199\u3002\n\n\u4e0b\u6587\u7684\u6240\u6709\u503c\u90fd\u662f\u79bb\u6563\u5316\u540e\u7684\uff0c~~\u4e0d\u7136 $10^9$ \u7684\u6570\u636e\u8303\u56f4\u663e\u7136\u8fc7\u4e0d\u4e86~~\uff0c\u76f8\u4fe1\u80fd\u627e\u5230\u8fd9\u9898\u7684\u4eba\u90fd\u77e5\u9053\u79bb\u6563\u5316\u600e\u4e48\u5199\u3002\n\n$p_i\\le inc_j\\le s_i$ \u7684\u6761\u4ef6\u76f4\u63a5\u4f7f\u7528\u626b\u63cf\u7ebf\u5c31\u80fd\u6ee1\u8db3\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u5728 $p_i$ \u4f4d\u7f6e\u63d2\u5165 $i$ \u8fd9\u4e2a\u70b9\uff0c\u5728 $inc_j$ \u4f4d\u7f6e\u67e5\u8be2 $j$ \u7684\u7b54\u6848\uff0c\u5728 $s_i+1$ \u4f4d\u7f6e\u5220\u9664 $i$ \u8fd9\u4e2a\u70b9\u3002\n\n\u53e6\u4e00\u4e2a\u6761\u4ef6 $|b_i-pref_j|\\le inc_j-p_i$ \u5e26\u4e2a\u7edd\u5bf9\u503c\u5c31\u6709\u70b9\u68d8\u624b\u4e86\uff0c\u8fd9\u4e2a\u7edd\u5bf9\u503c\u663e\u7136\u662f\u8981\u62c6\u7684\uff0c\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\u3002\n\n- $b_i\\ge pref_j$ \u65f6\uff0c\u539f\u5f0f\u53ef\u5316\u4e3a $b_i+p_i\\le inc_j+pref_j$\u3002\n\n- $b_i< pref_j$ \u65f6\uff0c\u539f\u5f0f\u53ef\u5316\u4e3a $p_i-b_i\\le inc_j-pref_j$\u3002\n\n\u663e\u7136\u7edf\u8ba1\u7b54\u6848\u662f\u4e8c\u7ef4\u6570\u70b9\u7684\u5f62\u5f0f\uff0c\u5f00\u4e24\u9897\u6811\u5957\u6811\uff0c\u5206\u522b\u7edf\u8ba1\u6ee1\u8db3\u4e0a\u9762\u5f0f\u5b50\u7684\u70b9\u7684\u6570\u91cf\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)\\log^2n)$\uff0c\u6700\u6162\u7684\u70b9\u8dd1\u4e86 1949 ms\uff0c\u57fa\u672c\u4e0a\u662f\u5361\u7740\u8fc7\u7684\uff0c\u5feb\u8bfb\u662f\u80af\u5b9a\u8981\u52a0\u7684\uff0c\u8fd8\u5f97\u6ce8\u610f\u5361\u5361\u5e38\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ri register int\ntypedef long long ll;\nconst int maxn=1e5+10;\nstatic char pbuf[1000000],*p1=pbuf,*p2=pbuf,obuf[1000000],*o=obuf;\n#define getchar() p1==p2&&(p2=(p1=pbuf)+fread(pbuf,1,1000000,stdin),p1==p2)?EOF:*p1++\n#define putchar(x) (o-obuf<1000000)?(*o++=(x)):(fwrite(obuf,o-obuf,1,stdout),o=obuf,*o++=(x))\ninline int qr(){\n\tri in=0;register char ch;\n\twhile(!isdigit(ch=getchar()));\n\tdo in=(in<<1)+(in<<3)+(ch^48);while(isdigit(ch=getchar()));\n\treturn in;\n}\ntemplate<class T>\nvoid qw(T out){\n\tif(out>9)qw(out/10);\n\tputchar(out%10|48);\n}\nstruct flusher{~flusher(){fwrite(obuf,o-obuf,1,stdout);}}autoflush;\nstruct discretize{\n\tint b[maxn*3],bl;\n\tinline void insert(int k){\n\t\tb[++bl]=k;\n\t}\n\tinline void init(){\n\t\tsort(b+1,b+bl+1);\n\t\tbl=unique(b+1,b+bl+1)-b-1;\n\t}\n\tinline int query(int k){\n\t\treturn lower_bound(b+1,b+bl+1,k)-b;\n\t}\n}b1,b2,b3;\n// b1: bi prefj\n// b2: bi+pi incj+prefj\n// b3: pi-bi incj-prefj\nstruct BIT_SGT{\n\tstruct SGT{\n\t\tint ls,rs,sum;\n\t}t[maxn*100];\n\tint cnt;\n\tinline void push_up(int p){\n\t\tt[p].sum=t[t[p].ls].sum+t[t[p].rs].sum;\n\t}\n\tvoid insert(int &p,int l,int r,int k,int v){\n\t\tif(!p)p=++cnt;\n\t\tif(l==r){\n\t\t\tt[p].sum+=v;\n\t\t\treturn;\n\t\t}\n\t\tri mid=l+r>>1;\n\t\tif(k<=mid)insert(t[p].ls,l,mid,k,v);\n\t\telse insert(t[p].rs,mid+1,r,k,v);\n\t\tpush_up(p);\n\t}\n\ttypedef vector<int> vi;\n\tint query(vi &pt,int l,int r,int ql,int qr){\n\t\tif(ql<=l&&r<=qr){\n\t\t\tri ret=0;\n\t\t\tfor(auto p:pt)ret+=t[p].sum;\n\t\t\treturn ret;\n\t\t}\n\t\tri mid=l+r>>1,ret=0;\n\t\tif(ql<=mid){\n\t\t\tvi tmp=pt;\n\t\t\tfor(auto &p:tmp)p=t[p].ls;\n\t\t\tret+=query(tmp,l,mid,ql,qr);\n\t\t}\n\t\tif(qr>mid){\n\t\t\tvi tmp=pt;\n\t\t\tfor(auto &p:tmp)p=t[p].rs;\n\t\t\tret+=query(tmp,mid+1,r,ql,qr);\n\t\t}\n\t\treturn ret;\n\t}\n\t#define lowbit(k) ((k)&(-k))\n\tint len1,len2,rt[maxn*3];\n\tinline void modify(int k1,int k2,int v){\n\t\tfor(ri i=k1;i<=len1;i+=lowbit(i))insert(rt[i],1,len2,k2,v);\n\t}\n\tinline int query(int k1,int k2){\n\t\tvi tmp;\n\t\tfor(ri i=k1;i;i^=lowbit(i))tmp.push_back(rt[i]);\n\t\treturn query(tmp,1,len2,1,k2);\n\t}\n}t1,t2;\nstruct node{\n\tint id,op,pos;\n\tinline bool operator<(const node &k)const{\n\t\treturn pos!=k.pos?pos<k.pos:op<k.op;\n\t}\n}q[maxn*3];\nint ans[maxn],b[maxn],bp[maxn],cnt,inc[maxn],ip[maxn],m,n,p[maxn],pb[maxn],pi[maxn],pref[maxn],s[maxn];\nint main(){\n\tn=qr(),m=qr();\n\tfor(ri i=1;i<=n;++i)p[i]=qr();\n\tfor(ri i=1;i<=n;++i)s[i]=qr();\n\tfor(ri i=1;i<=n;++i){\n\t\tb[i]=qr();\n\t\tb1.insert(b[i]);\n\t\tb2.insert(b[i]+p[i]);\n\t\tb3.insert(p[i]-b[i]);\n\t\tq[++cnt]={i,1,p[i]};\n\t\tq[++cnt]={i,2,s[i]+1};\n\t}\n\tfor(ri i=1;i<=m;++i)inc[i]=qr();\n\tfor(ri i=1;i<=m;++i){\n\t\tpref[i]=qr();\n\t\tb1.insert(pref[i]);\n\t\tb2.insert(inc[i]+pref[i]);\n\t\tb3.insert(inc[i]-pref[i]);\n\t\tq[++cnt]={i,3,inc[i]};\n\t}\n\tb1.init();\n\tt1.len1=t2.len1=b1.bl;\n\tb2.init();\n\tt1.len2=b2.bl;\n\tb3.init();\n\tt2.len2=b3.bl;\n\tfor(ri i=1;i<=n;++i){\n\t\tbp[i]=b2.query(b[i]+p[i]);\n\t\tpb[i]=b3.query(p[i]-b[i]);\n\t\tb[i]=b1.query(b[i]);\n\t}\n\tfor(ri i=1;i<=m;++i){\n\t\tip[i]=b2.query(inc[i]+pref[i]);\n\t\tpi[i]=b3.query(inc[i]-pref[i]);\n\t\tpref[i]=b1.query(pref[i]);\n\t}\n\tsort(q+1,q+cnt+1);\n\tfor(ri i=1;i<=cnt;++i)\n\t\tif(q[i].op==1){\n\t\t\tt1.modify(b1.bl-b[q[i].id]+1,bp[q[i].id],1);\n\t\t\tt2.modify(b[q[i].id],pb[q[i].id],1);\n\t\t}\n\t\telse if(q[i].op==2){\n\t\t\tt1.modify(b1.bl-b[q[i].id]+1,bp[q[i].id],-1);\n\t\t\tt2.modify(b[q[i].id],pb[q[i].id],-1);\n\t\t}\n\t\telse{\n\t\t\tri sum=0;\n\t\t\tsum+=t1.query(b1.bl-pref[q[i].id]+1,ip[q[i].id]);\n\t\t\tsum+=t2.query(pref[q[i].id]-1,pi[q[i].id]);\n\t\t\tans[q[i].id]=sum;\n\t\t}\n\tfor(ri i=1;i<=m;++i)qw(ans[i]),putchar(32);\n\treturn 0;\n}\n```\n",
        "postTime": 1629556953,
        "uid": 67942,
        "name": "meyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1139F \u3010Dish Shopping\u3011"
    },
    {
        "content": "\u8865\u4e00\u53d1\u65e0\u8111\u4e8c\u7ef4\u6570\u70b9\u505a\u6cd5\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u4eba\u5c31\u76f8\u5f53\u4e8e\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a\n\n- $ \\left| b - pref\\right| + p \\leq inc$\n\n- $inc \\leq s$\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u5bf9\u7edd\u5bf9\u503c\u5206\u60c5\u51b5\u8ba8\u8bba\uff0c\u5373 $b - pref + p \\leq inc$ \u4e0e $pref - b + p \\leq inc$\u3002\n\n\u7edf\u8ba1\u7b54\u6848\u65f6\uff0c\u5bf9\u4e8e $b \\leq pref$ \u7684\u83dc\uff0c\u6211\u4eec\u8981\u8be2\u95ee\u6ee1\u8db3 $- b + p \\leq inc - pref$ \u4e0e $inc \\leq s$\u7684\u7b54\u6848\u603b\u548c\uff0c\u4e5f\u5c31\u662f\u5c06\u6bcf\u4e2a\u83dc\u5f53\u6210 $(p - b, s)$ \u7684\u70b9\uff0c\u8be2\u95ee $(1, inc)$ \u5230 $(inc - pref, s_{max})$ \u8fd9\u4e00\u77e9\u5f62\u7684\u70b9\u6570\u548c\u3002\u5bf9\u4e8e\u5176\u4ed6\u7684\u83dc\uff0c\u8981\u8be2\u95ee\u6ee1\u8db3 $b + p \\leq inc + pref$ \u4e0e $inc \\leq s$ \u7684\u7b54\u6848\u603b\u548c\u3002\uff0c\u4e5f\u5c31\u662f\u5c06\u6bcf\u4e2a\u83dc\u5f53\u6210 $(p + b, s)$ \u7684\u70b9\uff0c\u8be2\u95ee $(1, inc)$ \u5230 $(inc + pref, s_{max})$ \u8fd9\u4e00\u77e9\u5f62\u7684\u70b9\u6570\u548c\u3002\n\n\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5f00\u4e24\u4e2a\u6811\u5957\u6811\uff0c\u5728\u4e00\u5f00\u59cb\u628a\u6240\u6709\u83dc\u653e\u5230\u4e00\u9897\u6811\u5957\u6811\u4e0a\uff0c\u5e76\u628a\u70b9\u5f53\u6210 $(p + b, s)$ \uff0c\u4e4b\u540e\u5c06\u83dc\u548c\u4eba\u5206\u522b\u6309 $b$ \u4e0e $pref$ \u6392\u5e8f\uff0c\u6309 $pref$ \u987a\u5e8f\u4ece\u5c0f\u5230\u5927\u8be2\u95ee\u6bcf\u4e2a\u4eba\u7684\u7b54\u6848\uff0c\u5e76\u4e14\u5c06\u6240\u6709 $b \\leq pref$ \u7684\u83dc\u6254\u5230\u53e6\u4e00\u9897\u6811\u5957\u6811\u4e0a\uff0c\u6bcf\u4e2a\u83dc\u53d8\u6210 $(p - b, s)$\u3002\u4e4b\u540e\u5c06\u4e24\u9897\u6811\u5957\u6811\u4e0a\u7684\u7b54\u6848\u76f8\u52a0\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)\\log^2n)$\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\nconst int N = 1e5 + 10;\nint n, m;\nstatic char buf[1000000],*p1=buf,*p2=buf;\n#define getchar() p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++\ninline int read()\n{\n\tregister int x = 0;\n\tregister char a = getchar();\n\twhile (a < '0' || a > '9')  a = getchar();\n\twhile (a >= '0'&& a <= '9') x = x * 10 + (a ^ 48), a = getchar();\n\treturn x;\n}\nstruct tree_in_tree\n{\n\tint bit[N];\n\tstruct t\n\t{\n\t\tint ch[2];\n\t\tint val;\n\t}tree[10500000];\n\tint root[N * 3], num;\n\tvoid opt1(int &o, int l, int r, int i, int w)\n\t{\n\t\tif(o == 0)\n\t\to = ++ num;\n\t\ttree[o].val += w;\n\t\tif(l == r)return;\n\t\tint mid = (l + r) >> 1;\n\t\tif(mid >= i) opt1(tree[o].ch[0], l, mid, i, w);\n\t\telse opt1(tree[o].ch[1], mid + 1, r, i, w);\n\t}\n\t\n\tvoid add(int pos, int y, int val)\n\t{\n\t\tif(pos == 0)return;\n\t\tfor (; pos <= 3 * n + 1; pos += pos & -pos)opt1(root[pos], 1, 3 * n + 1, y, val);\n\t}\n\t\n\tint to2[30][30], num2;\n\tint opt2(int now, int l, int r, int L, int R)\n\t{\n\t\tif(R < L)return 0;\n\t\tif(l >= L && r <= R)\n    \t\t{\n\t\t\tint re = 0;\n\t\t\tfor (int i = 1; i <= num2; ++ i)\n\t\t\tre += tree[to2[now][i]].val;\n\t\t\treturn re;\n\t\t}\n\t\tint mid = (l + r) >> 1;\n\t\tint ans = 0;\n\t\tif(mid >= L)\n\t\t{\n\t\t\tfor (int i = 1; i <= num2; ++ i)\n\t\t\tto2[now + 1][i] = tree[to2[now][i]].ch[0];\n\t\t\tans += opt2(now + 1, l, mid, L, R);\n\t\t}\n\t\tif(mid < R)\n\t\t{\n\t\t\tfor (int i = 1; i <= num2; ++ i)\n\t\t\tto2[now + 1][i] = tree[to2[now][i]].ch[1];\n\t\t\tans += opt2(now + 1, mid + 1, r, L, R);\n\t\t}\n\t\treturn ans;\n\t}\n\t\n\tint que(int l, int r, int L, int R)\n\t{\n\t\tif(r < l)return 0;\n\t\tnum2 = 0;\n\t\tif(r >= 0)\n\t\tfor (int i = r; i; i -= i & -i)to2[0][++ num2] = root[i];\n\t\treturn opt2(0, 1, 3 * n + 1, L, R);\n\t}\n}t1, t2;\nstruct dish\n{\n\tint p, s, b;\n}d[N];\nstruct person\n{\n\tint ids, inc, pref;\n}p[N];\nint nums[N];\nbool pd1(person i, person j)\n{\n\treturn i.pref < j.pref;\n}\nbool pd2(dish i, dish j)\n{\n\treturn i.s < j.s;\n}\nbool pd3(int i, int j)\n{\n\treturn d[i].b < d[j].b;\n}\nint val[N * 3];\nint ans[N];\nint main()\n{\n\tn = read();\n\tm = read();\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\tnums[i] = i;\n\t\td[i].p = read();\n\t}\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\td[i].s = read();\n\t}\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\td[i].b = read();\n\t\tval[i * 3 - 2] = d[i].s;\n\t\tval[i * 3 - 1] = d[i].p + d[i].b;\n\t\tval[i * 3] = d[i].p - d[i].b;\n\t}\n\tsort(val + 1, val + 1 + 3 * n);\n\tfor (int i = 1; i <= m; ++ i)\n\t{\n\t\tp[i].ids = i;\n\t\tp[i].inc = read();\n\t}\n\tfor (int i = 1; i <= m; ++ i)\n\t{\n\t\tp[i].pref = read();\n\t}\n\tsort(p + 1, p + 1 + m, pd1);\n\tsort(d + 1, d + 1 + n, pd2);\n\tsort(nums + 1, nums + 1 + n, pd3);\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\tint xx = lower_bound(val + 1, val + 1 + 3 * n, d[i].b + d[i].p) - val;\n\t\tint yy = lower_bound(val + 1, val + 1 + 3 * n, d[i].s) - val;\n\t\tt1.add(xx, yy, 1);\n\t}\n\tint now = 1;\n\tfor (int i = 1; i <= m; ++ i)\n\t{\n\t\twhile(now <= n && d[nums[now]].b < p[i].pref)\n\t\t{\n\t\t\tint xx = lower_bound(val + 1, val + 1 + 3 * n, d[nums[now]].p + d[nums[now]].b) - val;\n\t\t\tint yy = lower_bound(val + 1, val + 1 + 3 * n, d[nums[now]].s) - val;\n\t\t\tt1.add(xx, yy, -1);\n\t\t\txx = lower_bound(val + 1, val + 1 + 3 * n, - d[nums[now]].b + d[nums[now]].p) - val;\n\t\t\tt2.add(xx, yy, 1);\n\t\t\t++ now;\n\t\t}\n\t\tint xx = lower_bound(val + 1, val + 1 + 3 * n, p[i].inc + p[i].pref + 1) - val;\n\t\t-- xx;\n\t\tint yy = lower_bound(val + 1, val + 1 + 3 * n, p[i].inc) - val;\n\t\tans[p[i].ids] += t1.que(1, xx, yy, 3 * n + 1);\n\t\txx = lower_bound(val + 1, val + 1 + 3 * n, p[i].inc - p[i].pref + 1) - val;\n\t\t-- xx;\n\t\tans[p[i].ids] += t2.que(1, xx, yy, 3 * n + 1);\n\t}\n\tfor (int i = 1; i <= m; ++ i)\n\tprintf(\"%d \", ans[i]);\n}\n```\n",
        "postTime": 1625471072,
        "uid": 111728,
        "name": "\u5e7b\u5f71\u661f\u575a\u5f3a",
        "ccfLevel": 7,
        "title": "CF1139F"
    }
]