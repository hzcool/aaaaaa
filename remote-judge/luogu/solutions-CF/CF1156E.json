[
    {
        "content": "\u9898\u610f\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3an\u7684\u6392\u5217p\uff0c\u6c42\u6709\u591a\u5c11\u533a\u95f4[l,r]\u6ee1\u8db3\uff0cp[l]+p[r]=max{p[i]}\uff0c\u5176\u4e2dl<=i<=r\n\n\u89e3\u6790\uff1a\n\n\u9996\u5148\u663e\u7136\u8981\u9884\u5904\u7406\u6700\u5927\u503c\u3002\n\n\u5148\u5c06\u6bcf\u4e2a\u6570\u6240\u63a7\u5236\u7684\u533a\u95f4(\u5411\u5de6\u53f3\u7b2c\u4e00\u4e2a\u5927\u4e8ea[i]\u7684\u6570\u7684\u4f4d\u7f6e)\u9884\u5904\u7406\uff08\u6b63\u53cd\u4e24\u904d\u5355\u8c03\u6808O(N)\uff09\uff1aL[i],R[i]\n\n\u4e4b\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u6570,\u6ee1\u8db3\u6761\u4ef6\u7684\u533a\u95f4[L,R] : L[i]<L<i , i<R<R[i].\n\n\u4e4b\u540e\u679a\u4e3eL,R,\u7531\u4e8e\u7528pos[]\u8bb0\u5f55\u4e86\u6bcf\u4e2a\u6570\u503c\u7684\u4f4d\u7f6e,\u5bf9\u4e8ea[i]\uff1a\u5047\u8bbe\u679a\u4e3e\u7684\u4f4d\u7f6e\u662fx,\u53ea\u9700\u5224\u65ada[i]-a[x]\u662f\u5426\u5728\u76f8\u53cd\u7684\u533a\u95f4\u5373\u53ef\u5224\u65ad\u662f\u5426\u6ee1\u8db3\u8981\u6c42\u3002\n\n\u4ee5\u4e0a\u542c\u8d77\u6765\u4f3c\u4e4e\u662fO(N^2),\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e9b\u4f18\u5316\uff1a\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8ea[i]\uff0c\u6211\u4eec\u4f3c\u4e4e\u53ea\u9700\u8981\u626b\u63cf\u5de6\u53f3\u533a\u95f4\u4e2d\u8f83\u5c0f\u7684\u4e00\u4e2a\u5373\u53ef,\u56e0\u4e3a\u4ece\u54ea\u8fb9\u626b\u63cf\u662f\u4e00\u6837\u7684\uff08\u5e94\u8be5\u5f88\u597d\u7406\u89e3\u5427~\uff09\n\n\u597d\u5427\u8fd8\u662f\u89e3\u91ca\u4e00\u4e0b\u5427\uff1a\u4e24\u8fb9\u6ee1\u8db3\u6761\u4ef6\u7684\u70b9\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u6240\u4ee5\u4ece\u4efb\u610f\u4e00\u8fb9\u626b\u63cf,\u627e\u5230\u7684\u70b9\u5bf9\u662f\u76f8\u540c\u7684\u3002\n\n\u6817\u5b50\uff1a 3 4 5 2 1\n\n\u5bf9\u4e8e5\u8fd9\u4e2a\u6570\uff0c\u5de6\u53f3\u7684 4-1 \u662f\u5bf9\u5e94\u7684,\u4f60\u4f1a\u53d1\u73b0\u53ef\u4ee5\u4ece\u5de6\u8fb9\u7684 4\u53d1\u73b0 \u53f3\u8fb9\u7684 1, \u4ece\u53f3\u8fb9\u7684 1 \u4e5f\u540c\u6837\u80fd\u627e\u5230 4,\u627e\u5230\u7684\u70b9\u5bf9\u662f\u76f8\u540c\u7684\n \n \n \u597d\u7684\u6211\u4eec\u6210\u529f\u5c06\u6bcf\u4e2a\u6570\u7684\u533a\u95f4\u5207\u534a\uff08\u6700\u5c0f\u90a3\u4e00\u8fb9\u7684\u957f\u5ea6\u5fc5\u5b9a\u4e0d\u8d85\u8fc7\u8be5\u533a\u95f4\u957f\u5ea6\u7684\u4e00\u534a\uff09\n\n\u8003\u8651\u6bcf\u4e2a\u70b9\u6700\u591a\u88ablog\u4e2a\u5904\u7406\u533a\u95f4\u8986\u76d6,\u603b\u590d\u6742\u5ea6\uff1aO(NlogN\uff09\n\ncode\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=200010;\nint n,top;\nint a[maxn],pos[maxn],L[maxn],R[maxn],s[maxn];\nlong long ans;\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]),pos[a[i]]=i;\n\t//printf(\"1111\\n\");\n\tfor(int i=1;i<=n;i++)//\u6b63\u5411. \n\t{\n\t\twhile(top&&a[s[top]]<a[i]) top--;\n\t\tL[i]=s[top],s[++top]=i;\n\t}\n\ttop=0,s[top]=n+1;\n\t//printf(\"1111\\n\");\n\tfor(int i=n;i>=1;i--)//\u53cd\u5411. \n\t{\n\t\twhile(top&&a[s[top]]<a[i]) top--;\n\t\tR[i]=s[top],s[++top]=i;\n\t}\n\t//printf(\"1111\\n\");\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(i-L[i]<R[i]-i)\n\t\t{\n\t\t\tfor(int j=L[i]+1;j<i;j++)\n\t\t\t\tif(pos[a[i]-a[j]]>i&&pos[a[i]-a[j]]<R[i]) ans++;\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(int j=i+1;j<R[i];j++)\n\t\t\t\tif(pos[a[i]-a[j]]>L[i]&&pos[a[i]-a[j]]<i) ans++;\n\t\t}\n\t}\n\t//printf(\"1111\\n\");\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1558806095,
        "uid": 145441,
        "name": "nofind",
        "ccfLevel": 6,
        "title": "CF1156E Special Segments of Permutation(\u5355\u8c03\u6808+\u9884\u5904\u7406)"
    },
    {
        "content": "### 1156E Special Segments of Permutation\n\n\u5206\u6cbb\u5957\u8def\u9898\u3002\n\n\u5f00\u59cb\u6ca1\u60f3\u5230\u6309\u7167\u9898\u89e3\u8bf4\u7684\u76f4\u63a5\u679a\u4e3e\u8f83\u5c0f\u7684\u4e00\u8fb9\u3002\u3002\n\n\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u6309\u7167\u5957\u8def\u4ece\u4e2d\u95f4\u5206\u5f00\uff0c\u7136\u540e\u8003\u8651\u679a\u4e3e\u4ece\u4e2d\u95f4\u70b9\u5f00\u59cb\u5411\u53f3\u679a\u4e3e\u53f3\u7aef\u70b9\uff0c\u5047\u8bbe\u5f53\u524d\u679a\u4e3e\u5230\u7684\u53f3\u7aef\u70b9\u662f $R$ \uff0c\u6211\u4eec\u94a6\u5b9a\u6700\u5927\u503c\u5728 $[mid+1,R]$ \u533a\u95f4\u5185\uff0c\u90a3\u4e48\u5de6\u7aef\u70b9\u53ef\u4ee5\u5b58\u5728\u7684\u4e00\u5b9a\u662f $[L,mid]$ \u7684\u4e00\u6bb5\u540e\u7f00\uff0c\u76f4\u63a5\u53cc\u6307\u9488\u626b\u8fd9\u4e2a\u540e\u7f00\u5c31\u5b8c\u4e8b\u4e86\uff0c\u7528\u4e00\u4e2a set \u6216\u8005 hash \u8868\u7ef4\u62a4\u4e00\u4e0b $[L,mid]$ \u7684\u6570\u3002\u518d\u5bf9\u94a6\u5b9a\u5728\u5de6\u8fb9\u540c\u6837\u64cd\u4f5c\u4e00\u4e0b\uff0c\u590d\u6742\u5ea6 \u662f $O(n\\log^2n)$ \u6216\u8005 $O(n\\log n)$ \u3002\u5f88\u597d\u5199\uff0c\u800c\u4e14\u8dd1\u5f97\u633a\u5feb\u7684\u3002\u3002\n\n\u800c\u4e14\u8fd9\u4e48\u505a\u5373\u4f7f\u7ed9\u7684\u4e0d\u662f\u6392\u5217\u4e00\u6837\u80fd\u505a\u5427\u3002\u3002\u53ea\u662f\u6362\u6210 `multiset` \u800c\u5df2\u4e86\u3002\n\n```cpp\n#include \"iostream\"\n#include \"algorithm\"\n#include \"cstring\"\n#include \"cstdio\"\n#include \"cmath\"\n#include \"vector\"\n#include \"map\"\n#include \"set\"\n#include \"queue\"\nusing namespace std;\n#define MAXN 200006\n//#define int long long\n#define rep(i, a, b) for (int i = (a), i##end = (b); i <= i##end; ++i)\n#define per(i, a, b) for (int i = (a), i##end = (b); i >= i##end; --i)\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define eb emplace_back\n#define vi vector<int>\n#define all(x) (x).begin() , (x).end()\n#define mem( a ) memset( a , 0 , sizeof a )\n#define min( a , b ) ( (a) < (b) ? (a) : (b) )\n#define max( a , b ) ( (a) > (b) ? (a) : (b) )\n#define P 998244353\ntypedef long long ll;\nint n , m;\nint A[MAXN];\nlong long ans = 0;\nset<int> S;\nvoid solve( int l , int r ) {\n    if( l == r ) return;\n    int mid = l + r >> 1;\n    int L = mid + 1 , R = mid + 1 , mxr = 0 , mxl;\n    S.clear();\n    for( ; R <= r ; ++ R ) {\n        mxr = max( mxr , A[R] );\n        while( L > l && A[L - 1] < mxr ) -- L , S.insert( A[L] );\n        if( S.find( mxr - A[R] ) != S.end() ) ++ ans;\n    }\n    L = mid , R = mid , mxl = 0;\n    S.clear();\n    for( ; L >= l ; -- L ) {\n        mxl = max( mxl , A[L] );\n        while( R < r && A[R + 1] < mxl ) ++ R , S.insert( A[R] );\n        if( S.find( mxl - A[L] ) != S.end() ) ++ ans;\n    }\n    solve( l , mid ) , solve( mid + 1 , r );\n}\nvoid solve() {\n    cin >> n;\n    rep( i , 1 , n ) scanf(\"%d\",A + i);\n    solve( 1 , n );\n    cout << ans << endl;\n}\n\nsigned main() {\n//    freopen(\"input\",\"r\",stdin);\n//    freopen(\"fuckout\",\"w\",stdout);\n//    int T;cin >> T;while( T-- ) solve();\n    solve();\n}\n\n```\n\n",
        "postTime": 1585532409,
        "uid": 63398,
        "name": "yijan",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1156E \u3010Special Segments of Permutation\u3011"
    },
    {
        "content": "\u542f\u53d1\u5f0f\u5408\u5e76\u7b97\u662f\u4e00\u79cd\u88ab\u4eba\u4eec\u719f\u77e5\u7684\u7b97\u6cd5\uff0c\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u590d\u6742\u5ea6\u6b63\u786e\u6027\u8bc1\u660e\u7b49\u4ef7\u4e8e\u91cd\u94fe\u5256\u5206\u7684\u6b63\u786e\u6027\u8bc1\u660e\u3002\n\n\u4e0d\u8fc7\u5728\u5f88\u591a\u9898\u76ee\u4e2d\uff0c\u6211\u4eec\u6216\u8bb8\u9700\u8981\u9006\u7528\u542f\u53d1\u5f0f\u5408\u5e76\uff0c\u4ece\u800c\u5728\u53ef\u80fd\u975e\u5e38\u4e0d\u5e73\u8861\u7684\u6811\u4e0a\u8fbe\u5230\u6b63\u786e\u7684\u590d\u6742\u5ea6\u3002\n\n\uff08\u672c\u9898\u548c\u4e24 edu \u573a\u540e\u7684 [CF1175F](https://www.luogu.com.cn/problem/CF1175F)\uff0c\u90fd\u662f\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u8fdb\u884c\u542f\u53d1\u5f0f\u5408\u5e76\u6216\u6a21\u62df\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u7b1b\u5361\u5c14\u6811\u5c31\u662f\u5178\u578b\u7684\u671f\u671b\u6df1\u5ea6 $O(\\log n)$ \u4f46\u662f\u5bb9\u6613\u88ab\u5361\u4e14\u65e0\u6cd5\u901a\u8fc7\u968f\u673a\u5316\u4fdd\u8bc1\u6df1\u5ea6\u7684\u4f8b\u5b50\uff09\n\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6392\u5217\uff0c\u6c42\u6709\u591a\u5c11\u4e2a\u533a\u95f4 $[l,r]$ \u6ee1\u8db3\uff1a$p(l)+p(r)=max_{i=l}^{r}{p(i)}$\n\n### \u66b4\u529b\u7684\u706b\u79cd\n\n\u5982\u679c\u679a\u4e3e $l$ \u6216 $r$\uff0c\u5f88\u660e\u663e $i$ \u4f1a\u968f\u7740\u53e6\u4e00\u4e2a\u7aef\u70b9\u7684\u53d8\u5316\u800c\u53d8\u5316\uff0c\u5355\u8c03\u6808\u5f88\u96be\u7ef4\u62a4\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5c1d\u8bd5\u522b\u7684\u65b9\u6cd5\u2014\u2014\u679a\u4e3e $i$\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c$i$ \u4e00\u5b9a\u53ea\u4f1a\u5bf9\u81ea\u5df1\u662f\u533a\u95f4\u6700\u5927\u503c\u7684\u533a\u95f4\u4ea7\u751f\u8d21\u732e\u3002\n\n\u60f3\u5230\u4f7f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u6bcf\u4e00\u4e2a\u70b9\u5de6\u8fb9\u548c\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u81ea\u5df1\u5927\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e2ai\uff0c\u7528\u5355\u8c03\u6808\u5904\u7406\u51fa $lm(i)$ \u548c $rm(i)$\u3002\n\n\u7136\u540e\uff1f\u6734\u7d20\u7684\u505a\u6cd5\u662f\u679a\u4e3e $[lm(i),i)$ \u548c $(i,rm(i)]$ \u4e2d\u7684\u6240\u6709\u6570\u8fdb\u884c\u914d\u5bf9\u3002\n\n\u8fd9\u6837\u505a\u662f $O(n^3)$ \u7684\u3002\n\n### \u4f18\u5316\u7684\u5e0c\u671b\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u505a\u6cd5\uff0c\u53ea\u679a\u4e3e $[lm(i),i-1]$ \u4e2d\u7684\u6240\u6709\u6570 $j$\uff0c\u63d0\u524d\u5904\u7406\u6392\u5217\u7684\u9006\uff08\u4e5f\u5c31\u662f\u5904\u7406\u6bcf\u4e00\u4e2a\u6570\u51fa\u73b0\u7684\u4f4d\u7f6e\uff09\uff0c\u5224\u65ad $p(i)-p(j)$ \u7684\u4f4d\u7f6e\u662f\u5426\u5728 $[i+1,rm(i)]$ \u4e2d\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $O(n^2)$ \u7684\u505a\u6cd5\uff0c\u5361\u6389\u5b83\u4e5f\u5f88\u5bb9\u6613\uff0c\u6784\u9020\u4e00\u4e2a\u5b8c\u5168\u6709\u5e8f\u7684\u6392\u5217\u5c31\u53ef\u4ee5\u4e86\u3002\n\n### \u901a\u8fc7\u7684\u5947\u8ff9\n\n\u6bcf\u6b21\u90fd\u679a\u4e3e $[lm(i),i-1]$ \u4e2d\u7684\u6570\u4f1a\u6302\uff0c\u90a3\u4e48\u5982\u679c\u6211\u6bcf\u6b21\u6311 $[lm(i),i-1]$ \u548c $[i+1,rm(i)]$ \u4e2d\u77ed\u7684\u4e00\u4e2a\u679a\u4e3e\u800c\u5339\u914d\u53e6\u4e00\u4e2a\uff0c\u600e\u4e48\u6837\u5462\uff1f\n\n\u8fd9\u6837\u770b\u4e0a\u53bb\u662f\u9519\u7684\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5 AC\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u5176\u5b9e\uff0c\u8fd9\u5c31\u662f\u5728\u6a21\u62df\u7b1b\u5361\u5c14\u6811\u4e0a\u9006\u5411\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u8fc7\u7a0b\u3002\n\n### \u901a\u8fc7\u540e\u7684\u53cd\u601d \n\n$i$ \u7684\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5927\u4e8e $i$ \u7684\u4f4d\u7f6e\u662f $lm(i)$\uff0c$i$ \u7684\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u5927\u4e8e $i$ \u7684\u4f4d\u7f6e\u662f $rm(i)$\u3002\n\n\u5982\u679c\u7ed9\u8fd9\u4e2a\u5e8f\u5217\u5efa\u7acb\u7b1b\u5361\u5c14\u6811\u7684\u8bdd\uff0c __$i$ \u4e00\u5b9a\u662f $lm(i)$ \u6216 $rm(i)$ \u7684\u513f\u5b50\u3002\u5e76\u4e14\u662f $i$ \u7236\u4eb2\u7684\u90a3\u4e00\u4e2a\u4e00\u5b9a\u662f\u53e6\u4e00\u4e2a\u7684\u540e\u4ee3\u3002__\n\n1. \u5982\u679c $i$ \u65e2\u4e0d\u662f $lm(i)$ \u7684\u513f\u5b50\u4e5f\u4e0d\u662f $rm(i)$ \u7684\u513f\u5b50\uff0c\u90a3\u4e48\u610f\u5473\u7740 $i$ \u548c\u7236\u4eb2\u4e4b\u95f4\u6709\u4e00\u4e2a\u5927\u4e8e $i$ \u7684\u70b9\uff0c\u7236\u4eb2\u7684\u5de6/\u53f3\u513f\u5b50\u5df2\u7ecf\u88ab\u5360\u53bb\uff0c\u800c $i$ \u4e0d\u80fd\u6210\u4e3a\u8fd9\u4e2a\u70b9\u7684\u7956\u5148\uff0c\u8fd9\u4e2a\u70b9\u5c31\u6ca1\u6709\u7236\u4eb2\u4e86\u3002\n\n2. \u5982\u679c $i$ \u7684\u7236\u4eb2\u4e0d\u662f\u53e6\u4e00\u4e2a\u7684\u540e\u4ee3\uff1a\u90a3\u4e48\u8003\u8651\u5b83\u4eec\u7684 LCA\uff0c\u4e00\u5b9a\u5728$(lm(i),rm(i))$\u533a\u95f4\u5185\u3002\u5426\u5219\u4e00\u5b9a\u4f1a\u6709\u4e00\u4e2a\u70b9\u540c\u65f6\u6709\u4e24\u4e2a\u5de6/\u53f3\u513f\u5b50\u3002\u4f46\u662f\u8fd9\u6bb5\u533a\u95f4\u6ca1\u6709\u6bd4\u4ed6\u4eec\u5927\u7684\u6570\u3002\n\n__\u56e0\u6b64\uff0c $(lm(i),rm(i))$ \u4e2d\u7684\u6bcf\u4e2a\u70b9\u90fd\u5728\u4ee5i\u4e3a\u6839\u7684\u5b50\u6811\u4e0a__ \u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\u73b0\u5728\u5148\u5047\u8bbe $rm(i)$ \u662f $i$ \u7684\u7236\u4eb2\u800c $lm(i)$ \u662f $i$ \u7684\u7956\u5148\uff0c\u90a3\u4e48 $lm(i)$ \u7684\u53f3\u513f\u5b50\u4f4d\u7f6e\u88ab\u5360\u53bb\uff0c$(lm(i),i)$ \u4e2d\u7684\u6240\u6709\u4f4d\u7f6e\u90fd\u5e94\u5f53\u5904\u4e8e $i$ \u7684\u5de6\u5b50\u6811\u3002$rm(i)$ \u7684\u53f3\u513f\u5b50\u4f4d\u7f6e\u88ab\u5360\u53bb\uff0c$(i,rm(i))$ \u90fd\u5e94\u5904\u4e8e $i$ \u7684\u53f3\u5b50\u6811\u3002\n\n\u6240\u4ee5\uff0c __\u6211\u4eec\u524d\u6587\u7684\u201c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u627e\u5230\u6700\u5927\u7684\u4ee5\u5b83\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\u201d\u5176\u5b9e\u5c31\u662f\u201c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u627e\u5230\u5b83\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u7684\u5b50\u6811\u201d\u3002__\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u626b\u4e00\u904d\u6240\u6709\u70b9\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u626b\u5176\u8f83\u5c0f\u7684\u4e00\u68f5\u5b50\u6811\uff08\u76f8\u5f53\u4e8e\u628a\u8f83\u5c0f\u5b50\u6811\u7684\u4fe1\u606f\u5408\u5e76\u5230\u8f83\u5927\u5b50\u6811\u4e0a\uff09\u4ece\u800c\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u5c31\u662f\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u9006\u8fc7\u7a0b\uff0c\u4e24\u8005\u5728\u6b63\u786e\u6027\u4e0a\u4e5f\u662f\u7b49\u4ef7\u7684\u3002\n\n\u672c\u505a\u6cd5\u6709\u4e09\u79cd\u5b9e\u73b0\u3002\n\n\u7b2c\u4e00\u79cd\u662f\u771f\u7684\u5efa\u51fa\u7b1b\u5361\u5c14\u6811\uff0c\u7136\u540e\u771f\u7684\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u8dd1\u542f\u53d1\u5f0f\u5408\u5e76\u3002\n\n\u5bf9\u6bcf\u4e00\u4e2a\u70b9\u7ef4\u62a4\u4e00\u4e2a `set` \u5b58\u50a8\u5b50\u6811\u4fe1\u606f\uff0c\u6bcf\u6b21\u5408\u5e76\u7684\u65f6\u5019\uff0c\u5148\u904d\u5386\u5c0f `set` \u8ba1\u7b97\u7b54\u6848\uff0c\u518d\u628a\u5c0f `set` \u52a0\u5230\u5927 `set` \u4e2d\u3002\u8fd9\u5c31\u662f\u5b8c\u5168\u6807\u51c6\u7684\u542f\u53d1\u5f0f\u5408\u5e76\u3002\u542f\u53d1\u5f0f\u4e00\u4e2a  $\\log$\uff0c\u5e26\u4e0a `set` \u4e00\u4e2a $\\log$\uff0c\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\n\n```cpp\n\nint n,a[200005],ls[200005],rs[200005],st[200005],top,rt;\nset<int>s[200005];\ninline void build(){\n\tst[top=1]=1,rt=1;\n\trep(i,2,n){\n\t\tint lst=0;\n\t\twhile(top&&a[st[top]]<a[i])lst=st[top--];\n\t\tif(lst)ls[i]=lst;\n\t\tif(!top)rt=i;\n\t\telse rs[st[top]]=i;\n\t\tst[++top]=i;\n\t}\n}\nint ans=0;\ninline void merge(int i,int j){\n\tif(s[j].size()>s[i].size())swap(s[i],s[j]);\n\tfor(auto v:s[j]){\n\t\tif(s[i].find(a[i]-v)!=s[i].end())ans++;\n\t}\n\tfor(auto v:s[j]){\n\t\ts[i].insert(v);\n\t}\n}\ninline void dfs(int i){\n\tif(ls[i]){\n\t\tdfs(ls[i]);\n\t\tmerge(i,ls[i]);\n\t}\n\tif(rs[i]){\n\t\tdfs(rs[i]);\n\t\tmerge(i,rs[i]);\n\t}\n\ts[i].insert(a[i]);\n\t\n}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0);cout.tie(0);\n\tcin>>n;\n\trp(i,n)cin>>a[i];\n\tbuild();\n\tdfs(rt);\n\tcout<<ans<<endl;\n\treturn 0;\n}\n//Crayan_r\n```\n\n\u7b2c\u4e8c\u79cd\u662f\u4e24\u6b21\u5355\u8c03\u6808\u5904\u7406\u51fa $lm(i)$ \u548c $rm(i)$\uff0c\u7136\u540e\u53bb\u6a21\u62df\u8fd9\u4e2a\u8fc7\u7a0b\u3002\n\n\u56e0\u4e3a\u8fd9\u4e2a\u7b97\u6cd5\u548c\u70b9\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u7684\u7956\u5148\u987a\u5e8f\u65e0\u5173\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4ece\u5de6\u5f80\u53f3\u679a\u4e3e $i$\u3002\n\n\u56e0\u4e3a\u8fd9\u9053\u9898\u662f\u6392\u5217\uff0c\u53ef\u4ee5 $O(1)$ \u5224\u65ad\u533a\u95f4\u5185\u662f\u5426\u6709\u67d0\u4e00\u4e2a\u503c\uff0c\u6240\u4ee5\u53ea\u6709\u542f\u53d1\u5f0f\u7684\u4e00\u4e2a $\\log$\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u5b9e\u9645\u4e0a\uff0c\u8fd9\u79cd\u505a\u6cd5\u867d\u7136\u7b80\u5355\uff0c\u4f46\u662f\u53ea\u6709\u5b8c\u5168\u7406\u89e3\u4e0a\u4e00\u4e2a\u505a\u6cd5\u4e4b\u540e\uff0c\u624d\u80fd\u660e\u767d\u3001\u6562\u5199\u8fd9\u4e00\u79cd\u505a\u6cd5\u3002\n\n```cpp\nint n,a[200005],b[200005];\nint lm[200005],rm[200005],st[200005],top;\ninline void init(){\n\ta[0]=1e9,st[top=1]=0;\n\trep(i,1,n){\n\t\twhile(top&&a[st[top]]<a[i])top--;\n\t\tlm[i]=st[top];\n\t\tst[++top]=i;\n\t}\n\ta[n+1]=1e9,st[top=1]=n+1;\n\tper(i,1,n){\n\t\twhile(top&&a[st[top]]<a[i])top--;\n\t\trm[i]=st[top];\n\t\tst[++top]=i;\n\t}\n}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0);cout.tie(0);\n\tcin>>n;\n\trp(i,n)cin>>a[i];\n\trp(i,n)b[a[i]]=i;\n\tinit();\n\tint ans=0;\n\trp(i,n){\n\t\tint l=lm[i]+1,r=rm[i]-1;\n\t\tif(l<i&&i<r){\n\t\t\tif(r-i>i-l)rep(j,l,i-1){\n\t\t\t\tint to=b[a[i]-a[j]];\n\t\t\t\tans+=(i<to&&to<=r);\n\t\t\t}else rep(j,i+1,r){\n\t\t\t\tint to=b[a[i]-a[j]];\n\t\t\t\tans+=(l<=to&&to<i);\n\t\t\t}\n\t\t}\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n//Crayan_r\n```\n\n\u7b2c\u4e09\u79cd\u662f\u5206\u6cbb\u6a21\u62df\u7b1b\u5361\u5c14\u6811\uff0c\u6bcf\u6b21\u89e3\u51b3\u533a\u95f4 $[l,r]$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406 st \u8868\u7136\u540e\u6bcf\u6b21 $O(1)$ \u67e5\u8be2\u5f53\u524d\u533a\u95f4\u6700\u5927\u4f4d\u7f6e $mid$\uff0c\u4e5f\u5c31\u662f\u627e\u5230\u5f53\u524d\u5b50\u6811\u7684\u6839\u3002\n\n\u7136\u540e\u66b4\u529b\u626b\u63cf\u8f83\u5c0f\u7684\u533a\u95f4\u8ba1\u7b97\u7b54\u6848\uff0c\u9012\u5f52\u5904\u7406 $[l,mid-1]$ \u548c $[r,mid+1]$ \u3002\u76f8\u5f53\u4e8e\u4e0d\u5efa\u6811\u5b8c\u6210\u7b2c\u4e00\u4e2a\u505a\u6cd5\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\nint n,a[200005],b[200005];\nint st[200005][20],ans=0;\ninline int cmp(int x,int y){\n\tif(a[x]>a[y])return x;\n\treturn y;\n}\ninline void init(){\n\trep(i,1,n)st[i][0]=i;\n\trep(j,1,20)rep(i,1,n)if(i+(1<<j)-1<=n){\n\t\tst[i][j]=cmp(st[i][j-1],st[i+(1<<(j-1))][j-1]);\n\t}\n}\ninline int rmq(int l,int r){\n\tint x=__lg(r-l+1);\n\treturn cmp(st[l][x],st[r-(1<<x)+1][x]);\n}\ninline void solve(int l,int r){\n\tif(l==r||l>r)return;\n\tint mid=rmq(l,r);\n\tif(r-mid>=mid-l){\n\t\trep(i,l,mid-1){\n\t\t\tint to=b[a[mid]-a[i]];\n\t\t\tif(mid<to&&to<=r)ans++;\n\t\t}\n\t}else{\n\t\trep(i,mid+1,r){\n\t\t\tint to=b[a[mid]-a[i]];\n\t\t\tif(l<=to&&to<mid)ans++;\n\t\t}\n\t}\n\tsolve(l,mid-1);\n\tsolve(mid+1,r);\n}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0);cout.tie(0);\n\tcin>>n;\n\trp(i,n)cin>>a[i];\n\trp(i,n)b[a[i]]=i;\n\tinit();\n\tsolve(1,n);\n\tcout<<ans<<endl;\n\treturn 0;\n}\n//Crayan_r\n```\n\u5206\u6790\u8fd9\u4e09\u79cd\u505a\u6cd5\u7684\u4f18\u52a3\uff1a\n\n\u7b2c\u4e00\u79cd\u65f6\u95f4\u6700\u52a3\uff08\u65f6\u95f4\u53cc $\\log$ `483ms` \uff09\n\n\u7b2c\u4e8c\u79cd\u5c5e\u4e8e\u5bf9\u505a\u6cd5\u672c\u8d28\u7406\u89e3\u4e4b\u540e\u624d\u80fd\u5199\u51fa\u7684\u505a\u6cd5\uff0c\u6700\u7b80\u5355\u3002\n\n\u7b2c\u4e09\u79cd\u53ef\u4ee5\u6269\u5c55\u5230\u66f4\u591a\u7684\u76f8\u4f3c\u9898\u76ee\uff0c\u6bd4\u5982\u8bf4 [CF1175F](https://www.luogu.com.cn/problem/CF1175F)\u3002\n\n",
        "postTime": 1669724369,
        "uid": 304222,
        "name": "jucason_xu",
        "ccfLevel": 0,
        "title": "CF1156E"
    },
    {
        "content": "\u770b\u5230Unrated\u5c31\u4e0d\u6253\u4e86\uff0c\u53e3\u80e1\u4e86\u4e00\u4e2a\u5206\u6cbb\u505a\u6cd5\uff0c\u4e00\u5199\u53d1\u73b0\uff0c\u5b83\u5c45\u7136\u8fc7\u4e86\u3002\n\n\u505a\u6cd5\u5927\u81f4\u5982\u4e0b\uff1a\u76f4\u63a5\u7b97\u5f88\u96be\u5904\u7406\uff0c\u8003\u8651\u5206\u6cbb\uff0c\u5bf9\u4e8e\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e3\u7684\u533a\u95f4[l,r]\uff0c\u8003\u8651\u8986\u76d6mid\u548cmid+1\u7684\u6240\u6709\u533a\u95f4\uff0c\u53ef\u4ee5\u628a[l,r]\u5206\u4e3a[l,mid]\u548c[mid+1,r]\u4e24\u534a\uff0c\u7136\u540emx[i]\u5bf9\u4e8e\u5de6\u534a\u90e8\u5206\u8868\u793a\u540e\u7f00\u6700\u5927\u503c\uff0c\u5bf9\u4e8e\u53f3\u534a\u90e8\u5206\u8868\u793a\u524d\u7f00\u6700\u5927\u503c\uff0c\u7136\u540e\u679a\u4e3e\u4f4d\u7f6e\u8ba1\u7b97\u53e6\u4e00\u7aef\u7684\u4f4d\u7f6e\u662f\u5426\u7b26\u5408\u9898\u610f\uff0c\u56e0\u4e3a\u533a\u95f4\u7684max\u503c\u51fa\u73b0\u5728\u4e24\u7aef\u7684mx\u4e4b\u4e00\uff0c\u6240\u4ee5\u5de6\u53f3\u90fd\u641c\u4e00\u4e0b\u5373\u53ef\u7edf\u8ba1\u6240\u6709\u7b54\u6848\u3002\u590d\u6742\u5ea6O(nlogn)\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+7;\nint n,ans,a[N],b[N],mx[N];\nvoid solve(int l,int r)\n{\n\tif(l+1>=r)return;\n\tint mid=l+r>>1;\n\tsolve(l,mid),solve(mid+1,r);\n\tmx[mid]=a[mid];for(int i=mid-1;i>=l;i--)mx[i]=max(mx[i+1],a[i]);\n\tmx[mid+1]=a[mid+1];for(int i=mid+2;i<=r;i++)mx[i]=max(mx[i-1],a[i]);\n\tfor(int i=l;i<=mid;i++)\n\t{\n\t\tint pos=b[mx[i]-a[i]];\n\t\tif(pos>mid&&pos<=r&&mx[pos]<mx[i])ans++;\n\t}\n\tfor(int i=mid+1;i<=r;i++)\n\t{\n\t\tint pos=b[mx[i]-a[i]];\n\t\tif(pos>=l&&pos<=mid&&mx[pos]<mx[i])ans++;\n\t}\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),b[a[i]]=i;\n\tsolve(1,n);\n\tprintf(\"%d\",ans);\n}\n```\n",
        "postTime": 1556943187,
        "uid": 3525,
        "name": "hfctf0210",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1156E \u3010Special Segments of Permutation\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u4e09\u53ea\u8001\u54e5\u7684\u505a\u6cd5\uff0c\u559c\u63d0\u6700\u70c8\u89e3/cy\n\n\u8003\u8651 CDQ \u5206\u6cbb\u540e\uff0c\u9700\u8981\u6c42\u51fa\u5de6\u53f3\u7aef\u70b9\u5206\u522b\u5728 $[l,mid]$ \u548c $(mid,r]$ \u7684\u6570\u5bf9\u6570\u91cf\u3002\n\n\u8bbe $b_i$ \u4e3a $[i,mid]$ \u6216 $[mid+1,r]$ \u4e2d $a_i$ \u7684\u6700\u5927\u503c\u3002\n\n\u5219\u539f\u5f0f\u8f6c\u5316\u4e3a $a_i+a_j=\\max(b_i,b_j)$\u3002\n\n\u6709\u4e00\u4e2a $\\max$\uff0c\u5206\u60c5\u51b5\u8ba8\u8bba\u5c31\u597d\u4e86\uff1a\n\n- \u82e5 $b_i>b_j$\uff0c\u9700\u8981\u6c42\u51fa $(mid,r]$ \u4e2d $a_j=b_i-a_i$ \u7684 $j$ \u7684\u6570\u91cf\u3002\n\n- \u82e5 $b_i\\le b_j$\uff0c\u9700\u8981\u6c42\u51fa $(mid,r]$ \u4e2d $b_j-a_j=a_i$ \u7684 $j$ \u7684\u6570\u91cf\u3002\n\n\u628a $b$ \u770b\u505a\u4e0b\u6807\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u5957 vector \u7ef4\u62a4\u5c31\u597d\u4e86\uff0c\u67e5\u8be2\u7b49\u4e8e\u67d0\u4e2a\u6570\u7684\u6570\u91cf\u53ea\u9700\u8981\u4e24\u6b21\u4e8c\u5206\u3002\n\n\u6ce8\u610f\u6bcf\u6b21\u63d2\u5165\u6570\u540e vector \u90fd\u6392\u5e8f\u4f1a T\uff0c\u5219\u5148\u5c06\u4e0b\u6807\u548c\u952e\u503c\u770b\u505a\u4e8c\u5143\u7ec4\u6392\u5e8f\uff0c\u7136\u540e\u987a\u5e8f\u63d2\u5165\u5c31\u597d\u4e86\u3002\n\n\u6ce8\u610f\u6bcf\u6b21\u6e05\u7a7a\u65f6\u8bb0\u5f55\u6811\u72b6\u6570\u7ec4\u7528\u4e86\u54ea\u4e9b\u8282\u70b9\uff0c\u6bcf\u6b21\u53ea\u6e05\u7a7a\u90a3\u4e9b\u8282\u70b9\u5bf9\u5e94\u7684 vector \u5c31\u597d\u4e86\u3002\n\n",
        "postTime": 1654073148,
        "uid": 360511,
        "name": "UperFicial",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010CF1156E Special Segments of Permutation\u3011"
    },
    {
        "content": "### \u601d\u8def\uff1a\u7b1b\u5361\u5c14\u6811\uff1f\uff08\u597d\u50cf\u5e76\u4e0d\u4e00\u5b9a\u8981\u5efa\u51fa\u6765\uff0c\u4f46\u662f\u53ef\u4ee5\u66f4\u597d\u7406\u89e3\uff09\n### \u63d0\u4ea4\uff1a2\u6b21\n#### \u9519\u56e0\uff1a\u6ca1\u6709\u5224\u5de6\u53f3\u513f\u5b50\u662f\u5426\u4e3a\u7a7a\u6765\u56de\u6eaf\u5bfc\u81f4\u5b83T\u4e86\n### \u9898\u89e3\uff1a\n\u5efa\u51fa\u7b1b\u5361\u5c14\u6811\uff0c\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u7b54\u6848\uff1a  \n\n\u5148\u9884\u5904\u7406\u6bcf\u4e00\u4e2a\u503c\u51fa\u73b0\u7684\u4f4d\u7f6e $pos[]$\uff1b\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6709\u5de6\u53f3\u513f\u5b50\u7684\u70b9\uff0c\u8bbe\u4ed6\u5728\u539f\u5e8f\u5217\u4e2d\u7684\u503c\u4e3a $mx$\uff0c\u6839\u636e\u7b1b\u5361\u5c14\u6811\u7684\u6027\u8d28\uff0c\u4ed6\u6bd4\u81ea\u5df1\u7684\u5b50\u6811\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u5143\u7d20\u90fd\u5927 \u3002\u8fd9\u6837\uff0c \u6211\u4eec\u904d\u5386\u4ed6\u7684\u8f7b\u513f\u5b50\u4e2d\u7684\u5143\u7d20 $vl$ \uff0c\u67e5\u8be2 $pos[mx-vl]$ \u662f\u5426\u5728\u91cd\u5b50\u6811\u4e2d\u3002\n\n\u5176\u5b9e\u53ef\u4ee5\u4e0d\u5efa\u6811\uff0c\u76f4\u63a5\u6c42\u51fa\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u6700\u5927\u503c\u80fd\u591f\u5411\u5de6\u53f3\u6269\u5c55\u7684\u533a\u95f4\uff0c\u679a\u4e3e\u5c0f\u7684\u533a\u95f4\u5c31\u591f\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(nlogn)$ \uff0c\u539f\u56e0\u662f\u7c7b\u4f3c\u6811\u5256\uff0c\u6bcf\u4e2a\u70b9\u6700\u591a\u53ea\u4f1a\u5411\u4e0a\u8df3 $logn$ \u6761\u8f7b\u8fb9\uff1b\u800c\u4e00\u4e2a\u70b9\u88ab\u8ba1\u7b97\uff0c\u53ea\u6709\u5728\u679a\u4e3e\u8f7b\u5b50\u6811\u7684\u65f6\u5019\uff1b\u5176\u5b9e\u7c7b\u4f3c dsu on tree\u3002\n\n\u5f53\u7136\uff0c\u4e0d\u5efa\u6811\u7684\u505a\u6cd5\u7684\u590d\u6742\u5ea6\u867d\u7136\u89e3\u91ca\u4e0d\u540c\uff0c\u4f46\u672c\u8d28\u90fd\u662f\u4e00\u6837\u7684.\n\n\n### \u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define R register int\nusing namespace std;\nnamespace Luitaryi {\ninline int g() { R x=0,f=1;\n  register char ch; while(!isdigit(ch=getchar())) f=ch=='-'?-1:f;\n  do x=x*10+(ch^48); while(isdigit(ch=getchar())); return x*f;\n} const int N=250010;\nint n,rt,a[N],pos[N],ans;\nstruct node {int ls,rs,sz,l,r;} t[N];\n#define ls(tr) t[tr].ls\n#define rs(tr) t[tr].rs\n#define sz(tr) t[tr].sz\n#define l(tr) t[tr].l\n#define r(tr) t[tr].r\nint stk[N],top;\ninline void calc(int tr,int rn,int mx) {\n  for(R i=l(tr);i<=r(tr);++i) \n    ans+=(pos[mx-a[i]]>=l(rn)&&pos[mx-a[i]]<=r(rn));\n}\ninline void dfs(int tr) {\n  sz(tr)=1,l(tr)=r(tr)=tr;\n  if(ls(tr)) dfs(ls(tr)),l(tr)=l(ls(tr)); \n  if(rs(tr)) dfs(rs(tr)),r(tr)=r(rs(tr));\n  if(!ls(tr)||!rs(tr)) return ;\n  sz(tr)=sz(ls(tr))+sz(rs(tr));\n  if(sz(ls(tr))<sz(rs(tr))) calc(ls(tr),rs(tr),a[tr]);\n  else calc(rs(tr),ls(tr),a[tr]);\n}\ninline void main() {\n  n=g(); for(R i=1;i<=n;++i) a[i]=g(),pos[a[i]]=i; \n  stk[++top]=0,a[0]=1e9;\n  for(R i=1;i<=n;++i) { R lst=0;\n    while(a[stk[top]]<a[i]) lst=stk[top],--top;\n    ls(i)=lst,rs(stk[top])=i; stk[++top]=i;\n  } rt=stk[2];\n  dfs(rt); printf(\"%d\\n\",ans);\n}\n} signed main() {Luitaryi::main(); return 0;}\n```\n***\n2019.09.15  \n61",
        "postTime": 1568561330,
        "uid": 115086,
        "name": "Tari",
        "ccfLevel": 7,
        "title": "Jack's \u9898\u89e3 CF1156E \u3010Special Segments of Permutation\u3011"
    },
    {
        "content": "\u8003\u8651\u5bf9\u5e8f\u5217\u5efa\u7acb\u7b1b\u5361\u5c14\u6811\uff0c\u90a3\u4e48\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u8fdb\u884c\u542f\u53d1\u5f0f\u5408\u5e76\u5373\u53ef\n\n\u5bf9\u5e94\u5230\u5e8f\u5217\u4e0a\u7684\u5b9e\u9645\u64cd\u4f5c\u5c31\u662f\uff0c\u9996\u5148\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u641e\u51fa\u5b83\u4f5c\u4e3a\u6700\u5927\u503c\u6240\u80fd\u6269\u5c55\u7684\u533a\u95f4\uff0c\u7136\u540e\u679a\u4e3e\u5c0f\u533a\u95f4\u7684\u6bcf\u4e00\u4e2a\u6570\u5b57\uff0c\u5224\u65ad\u53e6\u4e00\u4e2a\u6570\u5b57\u662f\u5426\u53ef\u4ee5\u5728\u5927\u533a\u95f4\u53d6\u5230\n\n``` cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\ntypedef long long ll;\nconst int N = 2e5 + 10;\nint n, pos[N], a[N], L[N], R[N];\n\nint main() {\n    scanf(\"%d\", &n);\n    for(int i = 1 ; i <= n ; ++ i) {\n        scanf(\"%d\", &a[i]);\n        pos[a[i]] = i;\n        L[i] = R[i] = i;\n    }\n    stack<int> sta;\n    for(int i = 1 ; i <= n ; ++ i) {\n        while(sta.size() && a[sta.top()] < a[i]) {\n            sta.pop();\n        }\n        if(sta.size()) {\n            L[i] = sta.top() + 1;\n        } else {\n            L[i] = 1;\n        }\n        sta.push(i);\n    }\n    sta = stack<int> ();\n    for(int i = n ; i >= 1 ; -- i) {\n        while(sta.size() && a[sta.top()] < a[i]) {\n            sta.pop();\n        }\n        if(sta.size()) {\n            R[i] = sta.top() - 1;\n        } else {\n            R[i] = n;\n        }\n        sta.push(i);\n    }\n\n    // for(int i = 1 ; i <= n ; ++ i) {\n    //     printf(\"[%d, %d]\\n\", L[i], R[i]);\n    // }\n\n    ll ans = 0;\n    for(int i = 1 ; i <= n ; ++ i) {\n        int la = i - L[i];\n        int ra = R[i] - i;\n        if(la < ra) {\n            for(int j = L[i] ; j <= i ; ++ j) {\n                int y = a[i] - a[j];\n                if(1 <= y && y <= n) {\n                    if(i <= pos[y] && pos[y] <= R[i]) {\n                        ++ ans;\n                    }\n                }\n            }\n        } else {\n            for(int j = i ; j <= R[i] ; ++ j) {\n                int y = a[i] - a[j];\n                if(1 <= y && y <= n) {\n                    if(L[i] <= pos[y] && pos[y] <= i) {\n                        ++ ans;\n                    }\n                }\n            }\n        }\n    }\n    printf(\"%lld\\n\", ans);\n}\n```",
        "postTime": 1557471108,
        "uid": 47111,
        "name": "nekko",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1156E \u3010Special Segments of Permutation\u3011"
    },
    {
        "content": "\u9898\u89e3\uff1a\u4e8c\u5206+\u641c\u7d22\n\n\n\u5927\u4f53\u601d\u8def\u89c1\u7a0b\u5e8f\u6ce8\u91ca\n\n```cpp\n#include<bits/stdc++.h>\n#pragma GCC diagnostic error \"-std=c++11\"\n#define ll long long\nusing namespace std;\nconst int N=2e5+5;\nint n;\nint a[N],b[N],mx[N];\nll ans=0;\ninline void solve(int l,int r){//\u7c7b\u4f3c\u4e8e\u4e8c\u5206+\u641c\u7d22 \n\tif(l==r) return;\n\tint md=l+r>>1,i;\n\tsolve(l,md);\n\tsolve(md+1,r);\n\tmx[md]=a[md];\n\tmx[md+1]=a[md+1];\n\tfor(i=md-1;i>=l;--i) mx[i]=max(mx[i+1],a[i]);        //\u4ece\u4e2d\u95f4\u5f80\u5916\u53d6max \n\tfor(i=md+2;i<=r;++i) mx[i]=max(mx[i-1],a[i]);        //\u540c\u4e0a \n\tfor(i=md;i>=l;--i){\n\t\tint t=b[mx[i]-a[i]];\n\t\tif(t>md and t<=r and mx[t]<=mx[i]) ++ans;        //\u627e\u4e00\u627e:\u5982\u679c\u5728\u5b83\u4e4b\u524d\u6709mx[i]-a[i]\u5219\u5c06\u7b54\u6848\u7d2f\u52a0 \n\t}\n\tfor(int i=md+1;i<=r;i++){                            //\u540c\u4e0a \n\t\tint t=b[mx[i]-a[i]];\n\t\tif(t<=md and t>=l and mx[t]<=mx[i]) ++ans;\n\t}\n}\nint main(){\n\tios_base::sync_with_stdio(false);\n\tcin.tie(0);\n\tcout.tie(0);\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) cin>>a[i],b[a[i]]=i;              //\u56e0\u4e3a\u662f\u5168\u6392\u5217\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a\u6570\u5b57\u53ea\u51fa\u73b0\u4e00\u6b21\uff0cb[]\u5b58\u50a8\u51fa\u73b0\u7684\u4f4d\u7f6e \n\tsolve(1,n);\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1556794661,
        "uid": 125964,
        "name": "\u4e16\u672bOIer",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1156E \u3010Special Segments of Permutation\u3011"
    },
    {
        "content": "\n\u8fd9\u4e00\u7c7b\u95ee\u9898\u8fd8\u662f\u633a\u5957\u8def\u7684\u3002\n\n---\n\n### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217 $p$\uff0c\u6c42\u6709\u591a\u5c11\u533a\u95f4 $[l,r]$ \u6ee1\u8db3\uff0c$p[l]+p[r]=max{p[i]}$\uff0c\u5176\u4e2d $l<=i<=r$\n\n---\n\n### \u89e3\u6cd5\n\n\u9996\u5148\u8fd9\u4e2a\u4e1c\u897f\u7684\u66b4\u529b\u5e94\u8be5\u5f88\u597d\u60f3\u3002\n\n\u4e0d\u8003\u8651\u4efb\u4f55\u4f18\u5316\uff0c\u679a\u4e3e\u5de6\u53f3\u7aef\u70b9\uff0c\u518d\u627e\u6700\u5927\u503c\u7684\u505a\u6cd5\u5e94\u8be5\u662f $\\Theta(n^3)$ \u7684\uff0c\u7528 ST \u8868\u53bb\u627e\u6700\u5927\u503c\u53ef\u4ee5\u505a\u5230 $\\Theta(n^2)$\u3002\n\n\u4f46\u662f\u8fd9\u8fd8\u8fdc\u8fdc\u4e0d\u591f\u3002\n\n\u5982\u679c\u4e00\u76f4\u8003\u8651\u679a\u4e3e\u7aef\u70b9\u7684\u8bdd\u590d\u6742\u5ea6\u662f\u964d\u4e0d\u4e0b\u6765\u7684\uff0c\u6362\u79cd\u89d2\u5ea6\u8003\u8651\u679a\u4e3e\u533a\u95f4\u5185\u7684\u6700\u5927\u503c\u3002\n\n\u4f46\u662f\u6bcf\u4e2a\u503c\u7684\u4f5c\u7528\u8303\u56f4\uff0c\u4e5f\u5c31\u662f\u90a3\u4e9b\u533a\u95f4\u7684\u6700\u5927\u503c\u662f\u8fd9\u4e2a\u6570\u662f\u4e0d\u786e\u5b9a\u7684\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5148\u7528\u5355\u8c03\u6808\u5904\u7406\u51fa\u6bcf\u4e2a\u6570\u524d\u9762\u548c\u540e\u9762\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\uff0c\u8bb0\u4e3a  $pre_i,suf_i$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u8d77\u4f5c\u7528\u7684\u5b50\u533a\u95f4\u7684\u7aef\u70b9 $l,r\\in[pre_i+1,suf_i-1]$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u6bd4\u8f83\u5957\u8def\u7684\u5904\u7406\u65b9\u5f0f\u4e86\uff1a\u679a\u4e3e\u6bcf\u4e00\u4e2a\u6700\u5927\u503c\uff0c\u7136\u540e\u679a\u4e3e\u77ed\u7684\u4e00\u8fb9\u8ba1\u7b97\u8d21\u732e\uff0c\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230\u5747\u644a $\\log$\u3002\n\n~~\u8fd9\u4e2a\u9898\u5b9e\u5728\u662f\u592a\u5f31\u5316\u4e86~~\u7edf\u8ba1\u8fd9\u4e2a\u8d21\u732e\u751a\u81f3\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u90fd\u4e0d\u9700\u8981\uff0c\u76f4\u63a5\u8bb0\u4e00\u4e2a $pos$ \u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5982\u679c\u8981\u6c42\u53ef\u91cd\u96c6\u7684\u7b54\u6848\u7684\u8bdd\uff0c\u9700\u8981\u7528\u4e00\u4e2a\u4e3b\u5e2d\u6811\uff0c\u590d\u6742\u5ea6\u662f $\\Theta(n\\log^2n)$ \u7684\u3002\n\n~~\u867d\u7136\u4e3b\u5e2d\u6811\u6ca1\u7528\u4f46\u6211\u8fd8\u662f\u7528\u4e86~~\n\n### Code\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N = 2e5 + 10, mod = 1e9 + 7;\nnamespace IO {\n    template<typename T>\n    inline void read(T &x) {\n        x = 0;\n        bool f = false;\n        char c = getchar();\n        for (; !isdigit(c); c = getchar()) f |= (c == '-');\n        for (; isdigit(c); c = getchar()) x = (x << 1) + (x << 3) + (c ^ 48);\n        if (f) x = ~x + 1;\n    }\n    template<typename T, typename ...Args>\n    inline void read(T &t, Args &...args) {\n        read(t), read(args...);\n    }\n    template<typename T>\n    inline void write(T x, char ed = ' ') {\n        static char sk[50];\n        int tp = 0;\n        if (!x) putchar('0');\n        if (x < 0) x = ~x + 1, putchar('-');\n        while (x) sk[++tp] = x % 10 + '0', x /= 10;\n        while (tp) putchar(sk[tp--]);\n        putchar(ed);\n    }\n    template<typename T, typename ...Args>\n    inline void write(T t, Args ...args) {\n        write(t), write(args...);\n    }\n}\nusing namespace IO;\nint n, a[N];\nnamespace Chairman_Tree {\n    struct Tree {\n        int l, r, v;\n    } t[N * 100];\n#define ls(x) t[x].l\n#define rs(x) t[x].r\n#define mid ((l + r) >> 1)\n    int rt[N], tot;\n    void update(int &x, int pre, int l, int r, int pos) {\n        x = ++tot, t[x] = t[pre], t[x].v++;\n        if (l == r) return;\n        if (pos <= mid)\n            update(ls(x), ls(pre), l, mid, pos);\n        else\n            update(rs(x), rs(pre), mid + 1, r, pos);\n    }\n    int query(int x, int y, int l, int r, int pos) {\n        if (l == r) return t[y].v - t[x].v;\n        if (pos <= mid)\n            return query(ls(x), ls(y), l, mid, pos);\n        else\n            return query(rs(x), rs(y), mid + 1, r, pos);\n    }\n}\nusing namespace Chairman_Tree;\nint stk[N], top, pre[N], suf[N], ans;\nint main() {\n#ifdef LOCAL\n    freopen(\"aa.in\", \"r\", stdin);\n    freopen(\"aa.out\", \"w\", stdout);\n#endif  \n    read(n);\n    for (int i = 1; i <= n; i++) {\n        read(a[i]);\n        pre[i] = 1, suf[i] = n;\n        update(rt[i], rt[i - 1], 1, n, a[i]);\n    }   \n    stk[top = 0] = 0;\n    for (int i = 1; i <= n; i++) {\n        while (top && a[stk[top]] < a[i]) top--;\n        pre[i] = stk[top], stk[++top] = i;\n    }\n    stk[top = 0] = n + 1;\n    for (int i = n; i; i--) {\n        while (top && a[stk[top]] < a[i]) top--;\n        suf[i] = stk[top], stk[++top] = i;\n    }\n\n    // for (int i = 1; i <= n; i++) {\n    //     printf(\"pre = %d, suf = %d\\n\", pre[i], suf[i]);\n    // }\n\n    for (int i = 1; i <= n; i++) {\n        int l = pre[i] + 1, r = suf[i] - 1;\n        if (i - l < r - i) {\n            for (int j = l; j < i; j++) {\n                int x = a[i] - a[j];\n                ans += query(rt[i - 1], rt[r], 1, n, x);\n            }\n        } else {\n            for (int j = i + 1; j <= r; j++) {\n                int x = a[i] - a[j];\n                ans += query(rt[l - 1], rt[i], 1, n, x);\n            }\n        }\n    }\n    write(ans, '\\n');\n#ifdef LOCAL\n    fclose(stdin), fclose(stdout);\n#endif\n    return 0;\n}\n```\n\n",
        "postTime": 1635927292,
        "uid": 375030,
        "name": "CG__HeavenHealer",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF1156E Special Segments of Permutation"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u53e6\u7c7b\u7684\u89e3\u6cd5\n\n## \u601d\u8def\n\n\u9996\u5148\u770b\u5230\u8fd9\u79cd\u9898\u7684\u7b2c\u4e00\u53cd\u5e94\u5e94\u8be5\u662f\u679a\u4e3e\u4e2d\u95f4\u90a3\u4e2a $\\max$\n\n\u6211\u4eec\u8003\u8651\u7ef4\u62a4\u4e00\u4e2a $[1, n]$ \u7684\u96c6\u5408\uff0c\u8868\u793a\u8fd9\u4e9b **\u4f4d\u7f6e** \u4e0a\u7684\u6570\u6ca1\u6709\u88ab\u8bbf\u95ee\u8fc7\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5728\u503c\u57df\u4e0a\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\uff0c\u53d1\u73b0 **\u524d\u9a71+1 \u5230 \u540e\u7ee7-1** \u8fd9\u4e9b\u4f4d\u7f6e\u90fd\u4ee5\u5f53\u524d\u503c\u4e3a\u6700\u5927\u503c\uff0c\u800c\u66f4\u8fdc\u4e00\u4e9b\u5219\u4e0d\u884c\n\n\u53d1\u73b0\u53ef\u4ee5\u94fe\u8868\u7ef4\u62a4\u524d\u9a71\u540e\u7ee7\uff0c\u8fd9\u90e8\u5206\u662f $O(n)$ \u7684\n\n\u90a3\u4e48\u5904\u7406\u65f6\u4e5f\u5f88\u7b80\u5355\uff0c\u53d1\u73b0\u5f53\u524d\u4f4d\u7f6e\u628a\u533a\u95f4\u5206\u6210\u4e86\u4e24\u8fb9\uff0c\u6211\u4eec\u626b\u63cf\u8f83\u5c0f\u7684\u4e00\u8fb9\uff0c\u7136\u540e\u53d1\u73b0\u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u786e\u5b9a\u4e86 $\\max$ \u548c $l, r$ \u4e2d\u7684\u4e00\u4e2a\uff0c\u90a3\u4e48\u53e6\u4e00\u4e2a\u7684\u503c\u4e5f\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\uff0c\u7531\u4e8e\u539f\u5e8f\u5217\u662f\u4e00\u4e2a\u6392\u5217\uff0c\u56e0\u6b64\u76f4\u63a5\u5224\u65ad\u53e6\u4e00\u4e2a\u6570\u7684\u51fa\u73b0\u4f4d\u7f6e\u662f\u5426\u5728\u53e6\u4e00\u534a\u533a\u95f4\u5185\u5373\u53ef\uff0c\u82e5\u662f\u5219\u52a0\u4e0a\u8d21\u732e\n\n\u6211\u4eec\u8003\u8651\u5206\u6790\u5176\u590d\u6742\u5ea6\uff0c\u53d1\u73b0\u5982\u679c\u8981\u5361\u6ee1\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$T(n)=\\max_{i=1}^{{\\lfloor{n\\over 2}\\rfloor}}\\{T(i)+T(n-i)+i\\}$$\n\n\u8fd9\u4e2a\u81ea\u884c\u7406\u89e3\u4e0d\u96be\uff0c\u53ef\u4ee5\u8003\u8651\u4ece\u5927\u5f80\u5c0f\u679a\u4e3e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff0c\u672c\u8d28\u4e0a\u662f\u76f8\u540c\u7684\n\n\u7136\u540e\u672c\u5730\u8dd1\u4e00\u904d dp \u4f1a\u53d1\u73b0\u8fd9\u4e1c\u897f\u662f $O(n\\log n)$ \u7ea7\u522b\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\n\n## \u4ee3\u7801\n\u53ea\u4fdd\u7559\u5173\u952e\u90e8\u5206\n```cpp\nconst int MAXN = 2e5 + 5;\nint n, a[MAXN], p[MAXN], suc[MAXN], pre[MAXN], ans = 0;\ninline void solve(int l, int r, int mid, const int x) {\n    if(r - mid > mid - l) rep(i, l, mid - 1) ans += (p[x - a[i]] > mid && p[x - a[i]] <= r);\n    else rep(i, mid + 1,r) ans += (p[x - a[i]] < mid && p[x - a[i]] >= l);\n}\n\nsigned main(){\n    read(n); read(a + 1, a + n + 1); rep(i, 1, n) p[a[i]] = i, pre[i] = i - 1, suc[i] = i + 1;\n    rep(i, 1, n) {\n        const int x = p[i];\n        solve(pre[x] + 1, suc[x] - 1, x, i);\n        pre[suc[x]] = pre[x]; suc[pre[x]] = suc[x];\n    } print(ans);\n}\n```",
        "postTime": 1630484259,
        "uid": 66511,
        "name": "DPair",
        "ccfLevel": 0,
        "title": "\u53e6\u7c7b\u89e3\u6cd5 \u3010CF1156E Special Segments of Permutation\u3011"
    },
    {
        "content": "\u51ed\u611f\u89c9\u601d\u8003\u4e86\u4e00\u4e0b\uff0c\u56e0\u4e3a\u662f\u4e00\u4e2a\u6392\u5217\uff0c\u90a3\u4e48\u5982\u679c\u6211\u4eec\u679a\u4e3e\u6bcf\u4e2a\u6570\u4f5c\u4e3a\u6700\u5927\u503c\u65f6\uff0c\u7136\u540e\u5f80\u4e24\u8fb9\u626b\uff0c\u7edf\u8ba1\u7b54\u6848\u3002\u56e0\u4e3a\u662f\u6392\u5217\u561b\uff0c\u6240\u4ee5\u4e0d\u53ef\u80fd\u4e00\u76f4\u90fd\u662f\u626b\u5f88\u957f\u7684\u533a\u95f4\uff0c\u6240\u4ee5\u8bf4\u5c31\u662f\u4e00\u4e2a\u66b4\u529b\u3002\n\u5177\u4f53\u8bc1\u660e\u4e0d\u4f1a\uff0c\u4e5f\u4e0d\u77e5\u9053\u662f\u4e0d\u662f\u6570\u636e\u6c34\uff0c\u4f46\u662f\u611f\u89c9\u4e0a\u5b8c\u5168\u4e0d\u53ef\u80fd\u8fbe\u5230O(n^2)\n\nAC\u4ee3\u7801\uff1a\n```c\n#pragma GCC optimize(\"-Ofast\",\"-funroll-all-loops\")\n#include<bits/stdc++.h>\n//#define int long long\nusing namespace std;\nconst int N=2e5+10;\nint n,p[N],vis[N]; long long res;\nsigned main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++)\tscanf(\"%d\",&p[i]);\n\tfor(int i=2,j,k;i<n;i++){\n\t\tif(p[i-1]>p[i]||p[i+1]>p[i])\tcontinue;\tj=i-1;\n\t\twhile(p[j]<p[i]&&j>0)\tvis[p[j]]=1,j--;\tk=i+1;\n\t\twhile(p[k]<p[i]&&k<=n){if(vis[p[i]-p[k]])\tres++;\tk++;}\tj=i-1;\n\t\twhile(p[j]<p[i]&&j>0)\tvis[p[j]]=0,j--;\n\t}\n\tcout<<res;\n\treturn 0;\n}\n```",
        "postTime": 1582366801,
        "uid": 133654,
        "name": "\u9752\u70df\u7ed5\u6307\u67d4",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1156E \u3010Special Segments of Permutation\u3011"
    }
]