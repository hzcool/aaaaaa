[
    {
        "content": "\u662f\u5728\u505a\u6709\u5173\u540e\u7f00\u6570\u7ec4\u7684\u9898\u4e2d\u53d1\u73b0\u8fd9\u4e2a\u9898\uff0c\u7136\u800c\u9898\u89e3\u4e2d\u7684\u5927\u4f6c\u4eec\u7528\u7684\u540e\u7f00\u81ea\u52a8\u673a\uff0c\u849f\u84bb\u8868\u793a\u4e0d\u4f1a\u554aQwQ\uff0c\u4f46\u662f\u53d1\u73b0\u8fd9\u9053\u9898\u7528kmp\u5c31\u53ef\u4ee5\u505aw\u3002\n\u4e0b\u9762\u7ed9\u51fakmp\u7684\u505a\u6cd5\u3002\n\n#### \u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u51fa\u5b57\u7b26\u4e32$S$,\u518d\u7ed9$m$\u4e2a\u5b57\u7b26\u4e32$T$\uff0c\u5224\u65ad\u6709\u51e0\u4e2a$T$\u662f\u53ef\u4ee5\u5728$S$\u4e2d\u627e\u5230\u5750\u6807$a,b,c,d$ \u6ee1\u8db3$1 \\leq a \\leq b < c \\leq d \\leq n$\u4f7f\u5f97$S[a...b] + S[c...d] = T$.\n\n\u5148\u6b63\u5411kmp\uff0c\u8bb0\u5f55$T$\u7684\u524d\u7f00\u7684\u6bcf\u4e00\u4e2a\u957f\u5ea6\uff0c\u5728$S$\u80fd\u5339\u914d\u7684\u6700\u5de6\u8fb9\uff0c\u4e5f\u5c31\u662f\u9996\u6b21\u5339\u914d\u7684\u4f4d\u7f6e\u3002\n\n\u7136\u540e\u5c31\u662f\u628a\u5bfb\u627e\u540e\u7f00\uff0c\u628a$S$\u548c$T$\u90fd\u9006\u5e8f\u5b58\u597d\uff0c\u518dkmp\u4e00\u6b21\u3002\n\n\u770b\u662f\u5426\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u957f\u5ea6\u4e3a$x$\u7684\u540e\u7f00\u7684\u4f4d\u7f6e\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a$len-x$\u7684\u524d\u7f00\u7684\u4f4d\u7f6e\u4e4b\u540e\uff0c\u5982\u679c\u53ef\u4ee5\u627e\u5230\u8be5$T$\u5c31\u662f\u5408\u6cd5\u7684\n\n```cpp\n#define B cout << \"BreakPoint\" << endl;\n#define O(x) cout << #x << \" \" << x << endl;\n#define O_(x) cout << #x << \" \" << x << \" \";\n#define Msz(x) cout << \"Sizeof \" << #x << \" \" << sizeof(x)/1024/1024 << \" MB\" << endl;\n#include<cstdio>\n#include<cmath>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#include<set>\n#define LL long long\nconst int inf = 1e9 + 9;\nconst int N = 2e5 + 5;\nusing namespace std;\ninline int read() {\n\tint s = 0,w = 1;\n\tchar ch = getchar();\n\twhile(ch < '0' || ch > '9') {\n\t\tif(ch == '-')\n\t\t\tw = -1;\n\t\tch = getchar();\n\t}\n\twhile(ch >= '0' && ch <= '9') {\n\t\ts = s * 10 + ch - '0';\n\t\tch = getchar();\n\t}\n\treturn s * w;\n}\nchar s[N],t[N],c[N];\nint a[N],nxt[N]; \nvoid next(char x[],int f[]){\n    int m = strlen(x);\n    f[0] = f[1] = 0;\n    for(int i = 1 ; i < m; i++){\n        int j = f[i];\n        while(j && x[i] != x[j]) j = f[j];\n        f[i + 1] = x[i] == x[j] ? 1 + j : 0;\n    }\n}\nbool find(char s[],char t[],int f[],int v){\n    next(t,f);\n    int n = strlen(s),m = strlen(t),j = 0;\n    for(int i = 0; i < n; i++){\n        while(j && s[i] != t[j]) j = f[j];\n        if(s[i] == t[j]) ++j;\n        if(v == 1 && j && a[j] == -1) a[j] = i;\n        if(v == 2 && j && a[m - j] != -1 && a[m - j] < n - i - 1) return 1;\n    }\n    return 0;\n}\nvoid back(char s[],int n){\n    char ch;\n    for(int i = 0,k = n - 1; i < n / 2; i++,k--){\n        ch = s[i]; \n\t\ts[i] = s[k]; \n\t\ts[k] = ch;\n\t}\n}\nint main(){\n    scanf(\"%s\",s);\n    int m = read(),cnt = 0;\n    while(m--){\n        scanf(\"%s\",t);\n        memset(a,-1,sizeof(a));\n        find(s,t,nxt,1);\n        int n = strlen(s);\n        for(int i = n - 1,k = 0;i >= 0;i--) c[k++] = s[i];\n        back(t,strlen(t));\n        if(find(c,t,nxt,2)) cnt++;\n    }\n    printf(\"%d\\n\",cnt);\n    return 0;\n}\n```",
        "postTime": 1582630792,
        "uid": 160811,
        "name": "\u4f18\u79c0\u7684\u6e23\u6e23\u79b9",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF149E \u3010Martian Strings\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u7ed9\u51fa\u6765\u4e00\u4e2a\u540e\u7f00\u81ea\u52a8\u673a\u7684\u9898\u89e3. \n\n\u8003\u8651\u5bf9 $s$ \u7684\u6b63\u4e32\u548c\u53cd\u4e32\u5206\u522b\u5efa\u540e\u7f00\u81ea\u52a8\u673a.\n\n\u5bf9\u4e8e\u6b63\u4e32\u7684\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4 $endpos$ \u7684\u6700\u5c0f\u503c.\n\n\u5bf9\u4e8e\u53cd\u4e32\u7684\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4 $endpos$ \u7684\u6700\u5927\u503c. \n\n\u8fd9\u4e24\u4e2a\u4e1c\u897f\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u57fa\u6570\u6392\u5e8f\u5c31\u53ef\u4ee5\u5b9e\u73b0. \n\n\u5c06 $p$ \u7684\u6b63\u4e32\u5728\u6b63\u4e32\u7684 SAM \u4e0a\u53bb\u5339\u914d\uff0c\u4e00\u76f4\n\u5339\u914d\u5230\u5339\u914d\u4e0d\u4e86\u4e3a\u6b62\uff0c\u5e76\u8bb0\u5f55 $p[i]$ \u5728\u6b63\u4e32\u4e2d\u81ea\u52a8\u673a\u8282\u70b9\u4e0a $endpos$ \u7684\u6700\u5c0f\u503c $a[i]$. \n\n\u5bf9 $p$ \u7684\u53cd\u4e32\u4e5f\u8fdb\u884c\u76f8\u540c\u7684\u5904\u7406\uff0c\u8bb0\u5f55 $endpos$ \u7684\u6700\u5927\u503c $b[i]$.\n\n\u6b63\u4e32\u4e2d\u7684 $endpos$ \u5c31\u662f $p[1...i]$ \u4e2d $i$ \u7684\u6700\u5c0f\u7ed3\u675f\u4f4d\u7f6e\uff0c\u90a3\u4e48\u53cd\u4e32\u4e2d\u7684 $endpos$ \u5c31\u662f $p[i...length(p)]$ \u4e2d $i$ \u7684\u6700\u5927\u5f00\u59cb\u4f4d\u7f6e. \n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ea\u9700\u679a\u4e3e $1$~length(p) \u5e76\u5224\u65ad $a[i]&&b[i]&&a[i]<b[i+1]$ \u5373\u53ef. \n\n\u5982\u679c\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u8be2\u95ee\u662f\u6709\u89e3\u7684. \n\n\u5f53\u7136\uff0c\u8981\u6ce8\u610f\u5224\u65ad\u4e00\u4e0b\u957f\u5ea6\u4e3a $1$ \u7684\u60c5\u51b5\uff0c\u8fd9\u663e\u7136\u662f\u65e0\u89e3\u7684. \n\n```cpp\n#include <cstdio> \n#include <cstring> \n#include <algorithm> \n#define N 200004 \n#define setIO(s) freopen(s\".in\",\"r\",stdin) \nusing namespace std;    \ninline void getmin(int &a,int b) { if(b<a)a=b; } \ninline void getmax(int &a,int b) { if(b>a)a=b; } \nint a[1002],b[1002],n; \nchar str[N],P[N];   \nstruct SAM \n{ \n    int c[N],rk[N],tot,last; \n    struct Node { int len,ch[27],f,minv,maxv; }t[N]; \n    void init() { last=tot=1; } \n    inline void extend(int c,int lst) \n    {\n        int np=++tot,p=last; \n        last=np, t[np].len=t[p].len+1; \n        while(p&&!t[p].ch[c]) t[p].ch[c]=np,p=t[p].f;  \n        if(!p) t[np].f=1;\n        else \n        {\n            int q=t[p].ch[c]; \n            if(t[q].len==t[p].len+1) t[np].f=q; \n            else \n            {\n                int nq=++tot;\n                t[nq].len=t[p].len+1,t[nq].minv=t[nq].maxv=t[q].maxv;   \n                memcpy(t[nq].ch,t[q].ch,sizeof(t[q].ch)); \n                t[nq].f=t[q].f,t[q].f=t[np].f=nq;   \n                while(p&&t[p].ch[c]==q) t[p].ch[c]=nq,p=t[p].f;   \n            }\n        }   \n        t[np].minv=t[np].maxv=lst; \n    }       \n    inline void prepare() \n    { \n        int i,u; \n        for(i=1;i<=tot;++i) c[i]=0;  \n        for(i=1;i<=tot;++i) ++c[t[i].len];   \n        for(i=1;i<=tot;++i) rk[c[t[i].len]--]=i;  \n        for(i=tot;i>=1;--i) \n            u=rk[i],getmin(t[t[u].f].minv,t[u].minv),getmax(t[t[u].f].maxv,t[u].maxv);      \n    }\n}t1,t2;  \nint main() \n{\n    int i,j,m,re=0,ans=0; \n    // setIO(\"input\"); \n    t1.init(),t2.init();    \n    scanf(\"%s\",str+1),n=strlen(str+1); \n    for(i=1;i<=n;++i) t1.extend(str[i]-'A',i); \n    for(i=n;i>=1;--i) t2.extend(str[i]-'A',i); \n    t1.prepare(),t2.prepare(),scanf(\"%d\",&m); \n    for(i=1;i<=m;++i) \n    {\n        int len,p; \n        scanf(\"%s\",P+1),len=strlen(P+1),memset(a,0,sizeof(a)),memset(b,0,sizeof(b));       \n        for(p=j=1;j<=len;++j) \n        {\n            int c=P[j]-'A';      \n            if(t1.t[p].ch[c]) a[j]=t1.t[t1.t[p].ch[c]].minv,p=t1.t[p].ch[c]; else break; \n        } \n        for(p=1,j=len;j>=1;--j) \n        {\n            int c=P[j]-'A'; \n            if(t2.t[p].ch[c]) b[j]=t2.t[t2.t[p].ch[c]].maxv,p=t2.t[p].ch[c]; else break;  \n        } \n        re=0;   \n        for(j=1;j<len;++j) {\n            if(a[j]&&b[j+1]&&a[j]<b[j+1]) re=1;     \n        }\n        if(a[len]) re=1; \n        if(len==1) re=0;   \n        ans+=re;  \n    }\n    printf(\"%d\\n\",ans); \n    return 0; \n}\n```\n",
        "postTime": 1566386818,
        "uid": 53622,
        "name": "EM_LGH",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF149E \u3010Martian Strings\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u7b26\u4e32 $s$ \u548c $m$ \u4e2a\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa\u4e00\u4e2a\u5b57\u7b26\u4e32 $p$ \uff0c\u95ee\u4f60\u662f\u5426\u53ef\u80fd\u627e\u5230\u56db\u4e2a\u6b63\u6574\u6570 $a,b,c,d$ \uff0c\u6ee1\u8db3 $a\\le b<c\\le d$ \uff0c\u4e14 $s_{[a,b]}+s_{[c,d]}=p$ \u3002\u7edf\u8ba1\u6ee1\u8db3\u6761\u4ef6\u7684\u5b57\u7b26\u4e32 $p$ \u7684\u4e2a\u6570\u3002\n\n\uff08 $s_{[l,r]}$ \u4ee3\u8868 $s$ \u7684\u4e0b\u6807\u8303\u56f4\u5728\u533a\u95f4 $[l,r]$ \u4e2d\u7684\u5b50\u4e32\uff0c $+$ \u662f\u5b57\u7b26\u4e32\u62fc\u63a5\u8fd0\u7b97\uff09\n\n$2\\le |n|\\le 10^5,1\\le m\\le 100,1\\le |p|\\le 1000$\n\n## \u89e3\u9898\u601d\u8def\n\n\u6211\u4eec\u5b9a\u4e49 $pre_i$ \u4e3a\u5b57\u7b26\u4e32 $p$ \u957f\u5ea6\u4e3a $i$ \u7684\u524d\u7f00\u5728\u5b57\u7b26\u4e32\u4e2d\u51fa\u73b0\u7684\u6700\u9760\u5de6\u7684\u4f4d\u7f6e\uff0c $suf_i$ \u4e3a\u8be5\u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a $i$ \u7684\u540e\u7f00\u5728\u5b57\u7b26\u4e32\u4e2d\u51fa\u73b0\u7684\u6700\u9760\u53f3\u7684\u4f4d\u7f6e\u3002\u5728\u672c\u9898\u7684\u4ee3\u7801\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u5206\u522b\u5b9a\u4e49\u4f4d\u7f6e\u4e3a\u5b57\u7b26\u4e32\u7b2c\u4e00\u4e2a\u5b57\u7b26\u7684\u4e0b\u6807\u548c\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u7684\u4e0b\u6807\u3002\u89c2\u5bdf\u53d1\u73b0\uff0c\u5982\u679c $suf_i-pre_{|p|-i}+1\\ge |p|$ \uff0c\u90a3\u4e48\u5c31\u4fdd\u8bc1\u5b58\u5728\u8fd9\u6837\u7684 $a,b,c,d$ \u3002\u5982\u679c\u6211\u4eec\u80fd\u6c42\u51fa $pre$ \u548c $suf$ \u8fd9\u4e24\u4e2a\u6570\u7ec4\u7684\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u8003\u8651\u5355\u72ec\u6c42\u89e3 $pre$ \u6570\u7ec4\u3002\u6211\u4eec\u5bf9 $s$ \u8fdb\u884c\u540e\u7f00\u6392\u5e8f\uff0c\u5728\u540e\u7f00\u6392\u5e8f\u4e2d\uff0c\u524d\u7f00\u4e2d\u542b\u6709\u4efb\u610f\u5b57\u7b26\u4e32\u7684\u4f4d\u7f6e\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\uff0c\u8fd9\u4e9b\u524d\u7f00\u4e2d\u542b\u6709 $p$ \u7684\u6307\u5b9a\u957f\u5ea6\u7684\u524d\u7f00\u7684\u4f4d\u7f6e\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\u3002\u5bf9\u4e8e $p$ \u7684\u957f\u5ea6\u4e3a $i$ \u7684\u524d\u7f00\uff0c\u6211\u4eec\u5728\u4e0a\u4e00\u4e2a\u957f\u5ea6\u4e3a $i-1$ \u7684\u533a\u95f4\u7684\u57fa\u7840\u4e0a\u8fdb\u884c ** \u4e24\u6b21 ** \u4e8c\u5206\uff0c\u786e\u5b9a\u533a\u95f4\u7684\u5de6\u53f3\u7aef\u70b9\uff0c\u8fdb\u800c\u786e\u5b9a\u5176\u8303\u56f4\uff0c\u6700\u540e\u7684 $pre_i$ \u7684\u503c\u5c31\u662f\u8fd9\u4e2a\u533a\u95f4\u5bf9\u5e94\u7684\u4e0b\u6807\u7684\u6700\u5c0f\u503c\u3002\u7531\u4e8e\u6bcf\u6b21\u4e8c\u5206\u90fd\u662f\u5728\u4e0a\u4e00\u6b21\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u7684\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u533a\u95f4\u6bcf\u6b21\u957f\u5ea6\u4fbf\u9664\u4ee5 $2$ \uff0c\u8fd9\u6837\u5355\u6b21\u8ba1\u7b97 $pre$ \u6570\u7ec4\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(|p|+\\log_2 n)$ \u7684\u3002\n\n\u6211\u4eec\u53cd\u8f6c\u5b57\u7b26\u4e32 $s$ \u548c $p$ \uff0c\u5c31\u53ef\u4ee5\u6c42\u89e3 $suf$ \u6570\u7ec4\u3002\n\n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((n+m)\\log_2 n+\\sum |p|)$ \uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u6b64\u9898\u8fd8\u6709\u4e00\u79cd\u4f7f\u7528 $Z$ \u51fd\u6570\u6c42\u89e3\u7684\u65b9\u6cd5\uff0c\u5728\u6b64\u4e0d\u52a0\u8d58\u8ff0\u3002\n\n## \u4ee3\u7801\u5c55\u793a\n\n~~\u4ee3\u7801\u771f\u7684\u5f88\u4e11\u3002\u3002\u3002\u53d8\u91cf\u540d\u4ec0\u4e48\u7684\u957f\u77ed\u4e0d\u4e00\u592a\u96be\u770b\u4e86~~\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int maxn=100010;\nint n,m,sa[maxn],sa2[maxn],x[maxn],y[maxn],c[maxn],cur;\nint q,le,lg[maxn],st1[maxn][30],st2[maxn][30],ans,pre[1010],suf[1010];\nint L,R,l,r,mid;\nchar s[maxn],revs[maxn],que[1010],rev[1010];\nint rmq1(int l,int r)\n{\n    int k=lg[r-l+1];\n    return min(st1[l][k],st1[r-(1<<k)+1][k]);\n}\nint rmq2(int l,int r)\n{\n\tint k=lg[r-l+1];\n\treturn max(st2[l][k],st2[r-(1<<k)+1][k]);\n} \nint main()\n{\n\tscanf(\"%s\",s+1);\n\tn=strlen(s+1);m=128;\n\tfor(int i=1;i<=n;i++)revs[i]=s[n-i+1];\n\tfor(int i=2;i<=n;i++)lg[i]=lg[i/2]+1;\n\tfor(int i=1;i<=n;i++)x[i]=s[i];\n\tfor(int i=1;i<=m;i++)c[i]=0;\n\tfor(int i=1;i<=n;i++)c[x[i]]++;\n\tfor(int i=1;i<=m;i++)c[i]+=c[i-1];\n\tfor(int i=n;i>=1;i--)sa[c[x[i]]--]=i;\n\tfor(int k=1,cur;k<=n;k<<=1)\n\t{\n\t\tcur=0;\n\t\tfor(int i=n;i>n-k;i--)y[++cur]=i;\n\t\tfor(int i=1;i<=n;i++)if(sa[i]>k)y[++cur]=sa[i]-k;\n\t\tfor(int i=0;i<=m;i++)c[i]=0;\n\t\tfor(int i=1;i<=n;i++)c[x[i]]++;\n\t\tfor(int i=1;i<=m;i++)c[i]+=c[i-1];\n\t\tfor(int i=n;i>=1;i--)sa[c[x[y[i]]]--]=y[i];\n\t\tcur=y[sa[1]]=1;\n\t\tint a,b;\n\t\tfor(int i=2;i<=n;i++)\n\t\t{\n\t\t\ta=(sa[i]+k>n)?-1:x[sa[i]+k];\n\t\t\tb=(sa[i-1]+k>n)?-1:x[sa[i-1]+k];\n\t\t\ty[sa[i]]=((x[sa[i]]==x[sa[i-1]])&&(a==b))?cur:(++cur);\n\t\t}\n\t\tswap(x,y);\n\t\tif(cur>=n)break;\n\t\tm=cur; \n\t}\n\t//for(int i=1;i<=n;i++)printf(\"%d \",sa[i]);printf(\"\\n\");\n\tfor(int i=1;i<=n;i++)st1[i][0]=sa[i];\n\tfor(int i=1;i<=lg[n];i++)for(int j=1;j+(1<<i)-1<=n;j++)\n\tst1[j][i]=min(st1[j][i-1],st1[j+(1<<(i-1))][i-1]);\n\tfor(int i=1;i<=n;i++)x[i]=revs[i];\n\tfor(int i=1;i<=m;i++)c[i]=0;\n\tfor(int i=1;i<=n;i++)c[x[i]]++;\n\tfor(int i=1;i<=m;i++)c[i]+=c[i-1];\n\tfor(int i=n;i>=1;i--)sa2[c[x[i]]--]=i;\n\tfor(int k=1,cur;k<=n;k<<=1)\n\t{\n\t\tcur=0;\n\t\tfor(int i=n;i>n-k;i--)y[++cur]=i;\n\t\tfor(int i=1;i<=n;i++)if(sa2[i]>k)y[++cur]=sa2[i]-k;\n\t\tfor(int i=0;i<=m;i++)c[i]=0;\n\t\tfor(int i=1;i<=n;i++)c[x[i]]++;\n\t\tfor(int i=1;i<=m;i++)c[i]+=c[i-1];\n\t\tfor(int i=n;i>=1;i--)sa2[c[x[y[i]]]--]=y[i];\n\t\tcur=y[sa2[1]]=1;\n\t\tint a,b;\n\t\tfor(int i=2;i<=n;i++)\n\t\t{\n\t\t\ta=(sa2[i]+k>n)?-1:x[sa2[i]+k];\n\t\t\tb=(sa2[i-1]+k>n)?-1:x[sa2[i-1]+k];\n\t\t\ty[sa2[i]]=((x[sa2[i]]==x[sa2[i-1]])&&(a==b))?cur:(++cur);\n\t\t}\n\t\tswap(x,y);\n\t\tif(cur>=n)break;\n\t\tm=cur; \n\t}\n\tfor(int i=1;i<=n;i++)st2[i][0]=n-sa2[i]+1;\n\tfor(int i=1;i<=lg[n];i++)for(int j=1;j+(1<<i)-1<=n;j++)\n\tst2[j][i]=max(st2[j][i-1],st2[j+(1<<(i-1))][i-1]);\n\tscanf(\"%d\",&q);\n\twhile(q--)\n\t{\n\t\tmemset(pre,-1,sizeof pre);\n\t\tmemset(suf,-1,sizeof suf); \n\t\tscanf(\"%s\",que+1);\n\t\tle=strlen(que+1);rev[le+1]=0;\n\t\tfor(int i=1;i<=le;i++)rev[i]=que[le-i+1];\n\t\tL=1;R=n; \n\t\tfor(int i=1;i<=le;i++)\n\t\t{\n\t\t\tl=L;r=R+1;\n\t\t\twhile(l+1<r)\n\t\t\t{\n\t\t\t\tmid=(l+r)>>1;\n\t\t\t\tif(sa[mid]+i-1>n||s[sa[mid]+i-1]>=que[i])r=mid;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tif(sa[l]+i-1<=n&&s[sa[l]+i-1]==que[i])L=l;\n\t\t\telse if(r!=R+1&&sa[r]+i-1<=n&&s[sa[r]+i-1]==que[i])L=r;\n\t\t\telse L=-1;\n\t\t\tl=L;r=R+1;\n\t\t\twhile(l+1<r)\n\t\t\t{\n\t\t\t\tmid=(l+r)>>1;\n\t\t\t\tif(s[sa[mid]+i-1]>que[i])r=mid;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tR=l;\n\t\t\tif(L==-1||L>R)break;\n\t\t\tpre[i]=rmq1(L,R);\n\t\t}\n\t\t//for(int i=1;i<=le;i++)printf(\"%d \",pre[i]);printf(\"\\n\");\n\t\tL=1;R=n; \n\t\tfor(int i=1;i<=le;i++)\n\t\t{\n\t\t\tl=L;r=R+1;\n\t\t\twhile(l+1<r)\n\t\t\t{\n\t\t\t\tmid=(l+r)>>1;\n\t\t\t\tif(sa2[mid]+i-1>n||revs[sa2[mid]+i-1]>=rev[i])r=mid;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tif(sa2[l]+i-1<=n&&revs[sa2[l]+i-1]==rev[i])L=l;\n\t\t\telse if(r!=R+1&&sa2[r]+i-1<=n&&revs[sa2[r]+i-1]==rev[i])L=r;\n\t\t\telse L=-1;\n\t\t\tl=L;r=R+1;\n\t\t\twhile(l+1<r)\n\t\t\t{\n\t\t\t\tmid=(l+r)>>1;\n\t\t\t\tif(revs[sa2[mid]+i-1]>rev[i])r=mid;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tR=l;\n\t\t\tif(L==-1||L>R)break;\n\t\t\tsuf[i]=rmq2(L,R);\n\t\t}\n\t\t//for(int i=1;i<=le;i++)printf(\"%d \",suf[i]);printf(\"\\n\");\n\t\tfor(int i=1;i<=le;i++)if(suf[le-i]!=-1&&pre[i]!=-1)\n\t\tif(suf[le-i]-pre[i]+1>=le){ans++;break;}\n\t} \n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1550325821,
        "uid": 43486,
        "name": "hsfzLZH1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF149E \u3010Martian Strings\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n(1\\leq n \\leq 10^5)$\u7684\u4ec5\u7531\u5927\u5199\u5b57\u6bcd\u7ec4\u6210\u5b57\u7b26\u4e32 $s$ \u3002\n\n\u6709 $m(1\\leq m\\leq 100)$ \u4e2a\u5b57\u7b26\u4e32 $p_1,p_2,\\ldots,p_m$\uff0c$|p_i|\\le 1000$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u7b26\u4e32\uff0c\u95ee\u80fd\u5426\u627e\u5230 $1\\leq a\\leq b \\lt c \\leq d \\leq n$ \u4f7f\u5f97\uff1a\n$$s[a\\ldots b]+s[c\\ldots d]=p_i$$\n( $+$ \u8868\u793a\u62fc\u63a5)\n\n\u95ee\u80fd\u627e\u5230\u7684\u5b57\u7b26\u4e32\u7684\u4e2a\u6570\u3002\n## \u9898\u89e3\n\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u6bd4\u8f83 $\\rm Naive$ \u7684 $\\rm Hash+SA$ \u7684 $\\mathcal{O}(n\\log n+nm)$ \u7b97\u6cd5\n\n\u9996\u5148\u6211\u4eec\u5bf9\u4e8e $p$ \u7684\u4e00\u4e2a\u524d\u7f00 $p[1\\ldots i]$\uff0c\u8003\u8651\u627e\u5230\u7b49\u4e8e\u5b83\u7684\u6700\u5de6\u4f4d\u7f6e $pre_i$\u3002\n\n\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u4e32\u540e\u7f00\u6392\u5e8f\u4e4b\u540e\uff0c\u53ef\u4ee5\u53d8\u6210 $p[1\\ldots i]$ \u4e0e\u4e00\u4e2a\u540e\u7f00\u7684\u524d\u7f00\u76f8\u7b49\u3002\u7136\u540e\u56e0\u4e3a\u540e\u7f00\u6392\u8fc7\u5e8f\uff0c\u524d\u7f00\u7b49\u4e8e $p[1\\ldots i]$ \u7684\u4e00\u5b9a\u662f\u4e00\u4e2a\u8fde\u7eed\u533a\u95f4\u3002\u8fd9\u4e2a\u53ef\u4ee5\u7528\u53cd\u8bc1\u6cd5\u8bc1\u660e\uff0c\u5047\u8bbe\u4e0d\u8fde\u7eed\uff0c\u968f\u4fbf\u63a8\u4e00\u63a8\u5c31\u77e5\u9053\u4e0d\u5bf9\u52b2\u3002\n\n\u8fd8\u5bb9\u6613\u53d1\u73b0 $p[1\\ldots i]\\to p[1\\ldots i+1]$ \uff0c\u533a\u95f4\u5fc5\u7136\u7f29\u5c0f\uff0c\u8111\u8865\u4e00\u4e0b\u5373\u53ef\u3002\u4e8e\u662f\u6211\u4eec\u5f00\u4e24\u4e2a\u6307\u9488 $l,r$ \u5206\u522b\u6307\u5411\u5f53\u524d\u533a\u95f4\uff0c\u6bcf\u6b21 $i+1$ \u65f6\u66b4\u529b\u7f29\u5c0f\u533a\u95f4\uff0c\u6700\u540e\u4e00\u5b9a\u662f $\\mathcal{O}(n)$ \u7684\u3002\n\n\u90a3\u4e48 $pre_i$ \u5c31\u662f\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u540e\u7f00\u4e2d\u6700\u65e9\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5199\u4e2a $\\rm ST$ \u8868\u5c31\u53ef\u4ee5 $\\mathcal{O}(1)$ \u5f97\u51fa\u4e86\u3002\n\n\u53cd\u8f6c $S$ \u4e0e $P$ \uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7c7b\u4f3c\u7684\u6570\u7ec4 $suf$\u3002\n\n\u90a3\u4e48\u4e00\u4e2a\u5b57\u7b26\u4e32\u53ef\u884c\uff0c\u9700\u8981\u4ec0\u4e48\u6761\u4ef6\u5462\uff1f\n\n\u5176\u5b9e\u753b\u4e00\u4e0b\u5c31\u4e00\u76ee\u4e86\u7136\u4e86\uff1a\n\n![sjyakioi](https://cdn.luogu.com.cn/upload/image_hosting/1cf4ntiw.png)\n\n\u4e8e\u662f\u53ea\u8981\u6709 $i\\in(0,|p|)$ \u6ee1\u8db3 $|S|+2-pre_i-suf_{|P|-i}\u2265 |p|$ \u5373\u53ef\n## \u4ee3\u7801\n\u5c01\u88c5\u4e86\u4e00\u6ce2\u7ed3\u6784\u8fd8\u662f\u5f88\u6e05\u6670\u7684\u3002\n```cpp\n#include<bits/stdc++.h>\n#pragma comment(linker,\"/stack:200000000\")\n#pragma GCC optimize(\"Ofast,no-stack-protector\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,tune=native\")\nusing namespace std;\ntemplate<const int N>\nstruct String{\n\t//\u7cfb\u7edfstring buxing\n\tint n;\n\t/*\u540e\u7f00\u6570\u7ec4*/\n\tchar s[N];int x[N],y[N],c[N],sa[N];\n\tbool cmp(int a,int b,int c){return y[a]==y[b]&&y[a+c]==y[b+c];}\n\tvoid SA(int m='Z'){\n\t\tfor(int i=0;i<=m;i++)c[i]=0;\n\t\tfor(int i=1;i<=n;i++)c[x[i]=s[i]]++;\n\t\tfor(int i=1;i<=m;i++)c[i]+=c[i-1];\n\t\tfor(int i=n;i>=1;i--)sa[c[x[i]]--]=i;\n\t\tfor(int k=1;k<=n;k<<=1){\n\t\t\tint num=0;\n\t\t\tfor(int i=0;i<=m;i++)c[i]=0;\n\t\t\tfor(int i=n-k+1;i<=n;i++)y[++num]=i;\n\t\t\tfor(int i=1;i<=n;i++)if(sa[i]>k)y[++num]=sa[i]-k;\n\t\t\tfor(int i=1;i<=n;i++)c[x[i]]++;\n\t\t\tfor(int i=1;i<=m;i++)c[i]+=c[i-1];\n\t\t\tfor(int i=n;i>=1;i--)sa[c[x[y[i]]]--]=y[i],y[i]=0;\n\t\t\tswap(x,y);num=1;x[sa[1]]=1;\n\t\t\tfor(int i=2;i<=n;i++){\n\t\t\t\tif(cmp(sa[i],sa[i-1],k))x[sa[i]]=num;\n\t\t\t\telse x[sa[i]]=++num;\n\t\t\t}\n\t\t\tif(num==n)break;m=num;\n\t\t}\n\t}\n\t/*HASH*/\n\tconst int mod=998244353,base=107;\n\tint power[100100],val[N];\n\tvoid HASH(){\n\t\tpower[0]=1;for(int i=1;i<=n;i++)power[i]=1ll*power[i-1]*base%mod;\n\t\tval[0]=0;for(int i=1;i<=n;i++)val[i]=(1ll*val[i-1]*base+s[i])%mod;\n\t}\n\tint get(int l,int r){\n\t\tlong long V=val[r]-1ll*val[l-1]*power[r-l+1];\n\t\treturn (V%mod+mod)%mod;\n\t}\n\t/*\u8bfb\u5165*/\n\tvoid read(){scanf(\"%s\",s+1);n=strlen(s+1);}\n\tvoid print(){printf(\"%s\\n\",s+1);}\n\t/*\u7ffb\u8f6c*/\n\tvoid reverse(String<N> &b){\n\t\tb.n=n;\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tb.s[i]=s[n-i+1];\n\t}\n};\ntemplate<const int N,const int M>\nstruct ST{\n\tint cmp(int a,int b){return a>b?b:a;}\n\tint dp[M][N];\n\tint &operator[](int x){return dp[0][x];}\n    void init(int n){\n        for(int j=1;(1<<j)<=n;j++)\n            for(int i=1;i+(1<<j)-1<=n;i++)\n                dp[j][i]=cmp(dp[j-1][i],dp[j-1][i+(1<<j-1)]);\n    }\n    int query(int st,int ed){\n        int j=log(ed-st+1)/log(2);\n        return cmp(dp[j][st],dp[j][ed-(1<<j)+1]);\n    }\n};\ntemplate<class A,class B>\nbool Strcmp(A &S1,int st1,B &S2,int st2,int len,int get2=-1){\n\tif(len==0)return true;\n\tif(S1.n<st1+len-1)return false;\n\tif(S2.n<st2+len-1)return false;\n\tif(get2==-1)\n\t\treturn S1.get(st1,st1+len-1)==S2.get(st2,st2+len-1);\n\telse return S1.get(st1,st1+len-1)==get2;\n}\nST<100100,18>ST1,ST2;\nString<100100>S1,S2;\nString<1005>P1,P2;\nint m,ans=0;\nint pre[1005],suf[1005];\nsigned main(){\n\t//freopen(\"aaa\",\"r\",stdin);\n\tS1.read();S1.SA();S1.HASH();\n\tS1.reverse(S2);S2.SA();S2.HASH();\n\tfor(int i=1;i<=S1.n;i++)ST1[i]=S1.sa[i];\n\tfor(int i=1;i<=S2.n;i++)ST2[i]=S2.sa[i];\n\tST1.init(S1.n);ST2.init(S2.n);\n\tscanf(\"%d\",&m);\n\twhile(m--){\n\t\tP1.read();P1.HASH();\n\t\tP1.reverse(P2);P2.HASH();\n\t\tauto f=[&](int *arr,String<100100>&S,ST<100100,18>&RMQ,String<1005>&P){\n\t\t\tmemset(arr,255,sizeof pre);\n\t\t\tint l=1,r=S.n;\n\t\t\tfor(int i=0;i<=P.n;i++){\n\t\t\t\tint now=P.get(1,i);\n\t\t\t\twhile(l<=r&&!Strcmp(S,S.sa[l],P,1,i,now))l++;\n\t\t\t\twhile(r>=l&&!Strcmp(S,S.sa[r],P,1,i,now))r--;\n\t\t\t\tif(l>r)break;\n\t\t\t\tarr[i]=RMQ.query(l,r);\n\t\t\t}\n\t\t};\n\t\tf(pre,S1,ST1,P1);f(suf,S2,ST2,P2);\n\t\t//for(int i=0;i<=P1.n;i++)printf(\"%d \",pre[i]);puts(\"\");\n\t\t//for(int i=0;i<=P1.n;i++)printf(\"%d \",suf[i]);puts(\"\");\n\t\tfor(int i=1;i<P1.n;i++)\n\t\t\tif(pre[i]!=-1&&suf[P1.n-i]!=-1)\n\t\t\t\tif(S1.n+2-pre[i]-suf[P1.n-i]>=P1.n){\n\t\t\t\t\tans++;break;\n\t\t\t\t}\n\t}\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1611639820,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF149E \u3010Martian Strings\u3011"
    }
]