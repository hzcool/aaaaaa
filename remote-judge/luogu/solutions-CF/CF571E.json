[
    {
        "content": "\u9996\u5148\u628a\u6240\u6709$a$\u548c$b$\u90fd\u5206\u89e3\u8d28\u56e0\u6570. \u8bbe\u6700\u540e\u5171\u6709$m$\u79cd\u8d28\u56e0\u5b50, $c_{i,j}$\u8868\u793a$a_i$\u91cc$p_j$\u7684\u6b21\u6570, $d_{i,j}$\u8868\u793a$b_i$\u91cc$p_j$\u7684\u6b21\u6570.\n\n\u9996\u5148\u82e5\u5bf9\u4e8e\u67d0\u4e2a\u8d28\u56e0\u5b50$p_j$, \u5b58\u5728$u$\u4f7f$d_{u,j}=0$. \u53ef\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba:\n\n- \u82e5\u5bf9\u4e8e\u4efb\u610f$i$, $d_{i,j}=0$, \u5219\u5f53\u6240\u6709$c_{i,j}$\u76f8\u7b49\u65f6, $p_j$\u53ef\u5ffd\u7565, \u6700\u540e\u7b54\u6848\u4e58\u4e0a$p_j^{c_{i,j}}$\u5373\u53ef; \u5426\u5219\u65e0\u89e3.\n- \u5426\u5219\u6709$c_{u,j}=k\\cdot d_{v,j}+c_{v,j}$, \u89e3\u51fa$k$\u7136\u540e\u5224\u65ad\u662f\u5426\u5408\u6cd5\u5373\u53ef.\n\n\u7ecf\u8fc7\u4e0a\u8ff0\u5904\u7406, \u53ef\u4ee5\u8ba4\u4e3a\u6240\u6709$d_{i,j}$\u90fd\u4e0d\u7b49\u4e8e$0$.\n\n\u53ef\u4ee5\u5217\u51fa\u65b9\u7a0b\u7ec4:\n\n$$\nc_{1,1}+x\\cdot d_{1,1}=c_{i,1}+y\\cdot d_{i,1}\n$$\n$$\nc_{1,j}+x\\cdot d_{1,j}=c_{i,j}+y\\cdot d_{i,j}\n$$\n\n\u79fb\u9879\u53ef\u5f97:\n$$\nd_{1,1}x-d_{i,1}y=c_{i,1}-c_{1,1}\n$$\n$$\nd_{1,j}x-d_{i,j}y=c_{i,j}-c_{1,j}\n$$\n\u5982\u679c\u5bf9\u4e8e\u6bcf\u4e2a$i$, \u90fd\u6709:\n$$\n\\frac{d_{1,1}}{d_{1,j}}=\\frac{d_{i,1}}{d_{i,j}}=\\frac{c_{i,1}-c_{1,1}}{c_{i,j}-c_{1,j}}\n$$\n\u5219\u8bf4\u660e$p_j$\u4e0e$p_1$\u7b49\u4ef7, \u53ef\u4ee5\u5ffd\u7565$p_j$.\n\n\u5426\u5219\u53ef\u4ee5\u76f4\u63a5\u89e3\u51fa$x$\u548c$y$\u5e76\u5224\u65ad\u662f\u5426\u5408\u6cd5.\n\n\u7ecf\u8fc7\u4e00\u7cfb\u5217\u5ffd\u7565\u64cd\u4f5c\u540e, \u6211\u4eec\u7ec8\u4e8e\u53ea\u7528\u5904\u7406$p_1$\u4e86.\n\n\u8bbe\u5728\u6700\u540e\u7684\u7b54\u6848\u4e2d$p_1$\u7684\u6b21\u6570\u662f$X$, \u5bf9\u4e8e\u4efb\u610f\u7684$i$, \u6709$X\\equiv c_{i,1}(\\bmod\\ d_{i,1})$. \u8fd9\u5c31\u662f\u4e00\u4e2a\u663e\u7136\u53ef\u4ee5\u7528excrt\u89e3\u51b3\u7684\u95ee\u9898\u4e86. \u6ce8\u610f\u8981\u5224\u65ad\u65e0\u89e3, \u4ee5\u53ca\u6700\u7ec8\u89e3\u51fa\u6765\u7684\u6700\u5c0f\u7684$X$\u53ef\u80fd\u5c0f\u4e8e\u67d0\u4e2a$c_{i,1}$, \u9700\u8981\u9002\u5f53\u8c03\u6574.\n\nCode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define FAIL puts(\"-1\"),exit(0)\n#define llong long long\nllong gcd(llong a,llong b){return b?gcd(b,a%b):a;}\nllong lcm(llong a,llong b){return a*b/gcd(a,b);}\nconst int mod=1e9+7;\nint add(int x,int y){return x+y<mod?x+y:x+y-mod;}\nvoid ade(int& x,int y){x+=y;if(x>=mod)x-=mod;}\nint qpow(int x,llong k)\n{\n\tint r=1;\n\twhile(k)\n\t{\n\t\tif(k&1)r=1ll*r*x%mod;\n\t\tk>>=1;x=1ll*x*x%mod;\n\t}\n\treturn r;\n}\nint n;\nint pri[100100],m;\nint a_[110],b_[110];\nvoid pia(int x)\n{\n\tfor(int i=2;i*i<=x;++i)\n\t\tif(x%i==0)\n\t\t{\n\t\t\twhile(x%i==0)x/=i;\n\t\t\tpri[++m]=i;\n\t\t}\n\tif(x!=1)pri[++m]=x;\n}\nint c[110][2020],d[110][2020];\nvoid build(int id,int a,int b)\n{\n\tint p;\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tp=pri[i];\n\t\twhile(a%p==0)a/=p,c[id][i]++;\n\t\twhile(b%p==0)b/=p,d[id][i]++;\n\t}\n}\nbool ign[2020];\n\nllong pro=1;\nllong ans[2020];\nvoid CheckAns()\n{\n\tfor(int j=1;j<=m;++j)\n\t\tfor(int i=1;i<=n;++i)\n\t\t{\n\t\t\tif(ign[j])continue;\n\t\t\tif(!d[i][j]){if(ans[j]-c[i][j])FAIL;}\n\t\t\telse if(ans[j]<c[i][j]||(ans[j]-c[i][j])%d[i][j])FAIL;\n\t\t}\n\tint out=pro;\n\tfor(int i=1;i<=m;++i)\n\t\tif(!ign[i])out=1ll*out*qpow(pri[i],ans[i])%mod;\n\tprintf(\"%d\\n\",out);\n}\nvoid Equa(int a1,int b1,int c1,int a2,int b2,int c2)\n{\n\tint lc=lcm(a1,a2),p1=lc/a1,p2=lc/a2;\n\ta1=a2=lc;\n\tb1*=p1,c1*=p1;\n\tb2*=p2,c2*=p2;\n\tint b,nc;\n\tint x,y;\n\tb=b2-b1,nc=c2-c1;\n\tif(nc%b)FAIL;\n\ty=nc/b;\n\tc1-=b1*y;\n\tif(c1%a1)FAIL;\n\tx=c1/a1;\n\tif(x<0||y<0)FAIL;\n\tfor(int i=1;i<=m;++i)ans[i]=c[1][i]+x*d[1][i];\n\tCheckAns();\n}\nvoid exgcd(llong a,llong b,llong& x,llong& y)\n{\n\tif(!b) { x=1,y=0; return; }\n\texgcd(b,a%b,y,x);\n\ty-=(a/b)*x;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tscanf(\"%d%d\",&a_[i],&b_[i]);\n\t\tpia(a_[i]);pia(b_[i]);\n\t}\n\tsort(pri+1,pri+m+1);\n\tm=unique(pri+1,pri+m+1)-pri-1;\n\tfor(int i=1;i<=n;++i)build(i,a_[i],b_[i]);\n\t\n\tfor(int j=1;j<=m;++j)\n\t{\n\t\tint fl1=0,fl2=0;\n\t\tfor(int u=1;u<=n;++u)\n\t\t\tif(!d[u][j])fl1=u;\n\t\t\telse fl2=u;\n\t\tif(!fl1)continue;\n\t\tif(!fl2)\n\t\t{\n\t\t\tfor(int i=1;i<=n;++i)if(c[i][j]!=c[1][j])FAIL;\n\t\t\t(pro*=qpow(pri[j],c[1][j]))%=mod;\n\t\t\tign[j]=1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint k=c[fl1][j]-c[fl2][j];\n\t\t\tif(k%d[fl2][j]||k<0)FAIL;\n\t\t\tk/=d[fl2][j];\n\t\t\tfor(int i=1;i<=m;++i)\n\t\t\t\tans[i]=k*d[fl2][i]+c[fl2][i];\n\t\t\tCheckAns();\n\t\t\treturn 0;\n\t\t}\n\t}\n\tint pos=1;\n\twhile(ign[pos])pos++;\n\tif(pos>m)\n\t{\n\t\tprintf(\"%lld\\n\",pro);\n\t\treturn 0;\n\t}\n\tswap(pri[1],pri[pos]);swap(ign[1],ign[pos]);\n\tfor(int i=1;i<=n;++i)swap(c[i][1],c[i][pos]),swap(d[i][1],d[i][pos]);\n\n\tfor(int j=2;j<=m;++j)\n\t{\n\t\tfor(int i=2;i<=n;++i)\n\t\t{\n\t\t\tif(d[1][1]*d[i][j]!=d[1][j]*d[i][1])\n\t\t\t{\n\t\t\t\tEqua(d[1][1],-d[i][1],c[i][1]-c[1][1],\n\t\t\t\t\t\td[1][j],-d[i][j],c[i][j]-c[1][j]);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse if((c[i][j]-c[1][j])*d[1][1]!=(c[i][1]-c[1][1])*d[1][j])\n\t\t\t\tFAIL;\n\t\t}\n\t}\n\n\tllong A=c[1][1],M=d[1][1];\n\tllong a,g,x,y,t;\n\tfor(int i=2;i<=n;++i)\n\t{\n\t\ta=c[i][1]-A;\n\t\tg=gcd(M,d[i][1]);\n\t\tif(a%g)FAIL;\n\t\tt=d[i][1]/g;\n\t\texgcd(M,d[i][1],x,y);\n\t\tx=(x%t+t)%t;\n\t\tx*=a/g;\n\t\tx=(x%t+t)%t;\n\t\tA+=x*M;\n\t\tM=lcm(M,d[i][1]);\n\t\tA=(A%M+M)%M;\n\t}\n\tfor(int i=1;i<=n;++i)while(A<c[i][1])A+=M;\n\tllong k;\n\tif(!d[1][1])k=0;\n\telse k=(A-c[1][1])/d[1][1];\n\tfor(int i=1;i<=m;++i)ans[i]=c[1][i]+k*d[1][i];\n\tCheckAns();\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1594900376,
        "uid": 52285,
        "name": "\u9017\u903c\u9886\u4e3b",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF571E \u3010Geometric Progressions\u3011"
    },
    {
        "content": "~~upd: \u4fee\u6b63\u4e86\u4ebf\u4e9b\u5c0f\u95ee\u9898~~\n\n\u9996\u5148\u53d1\u73b0\u8fd9\u4e2a\u4e58\u79ef\u4f1a\u5f88\u5927\uff0c\u76f4\u63a5\u5b58\u4e0d\u65b9\u4fbf\uff0c\u4e0d\u5982\u8d28\u56e0\u6570\u5206\u89e3\u540e\u5b58\u6307\u6570\u3002\n\n\u7136\u540e\u518d\u8003\u8651\u600e\u4e48\u505a\uff1a\n\n\u6211\u4eec\u8003\u8651\u6bcf\u6b21\u5bf9\u4e24\u4e2a\u96c6\u5408\u53d6\u4ea4\u96c6\uff0c\u663e\u7136\u53ea\u4f1a\u6709\u4e09\u79cd\u60c5\u51b5\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. \u4ea4\u96c6\u4e3a\u7a7a\u96c6\uff1a\u663e\u7136\u786e\u5b9a\u4e86\u7b54\u6848\u4e3a $-1$\u3002\n2. \u4ea4\u96c6\u4e3a\u4e00\u4e2a\u6570\uff1a\u90a3\u4e48\u53ea\u9700\u8003\u8651\u8fd9\u4e2a\u6570\u662f\u5426\u5b58\u5728\u5728\u540e\u9762\u7684\u96c6\u5408\u4e2d\u5c31\u884c\u4e86\u3002\n3. \u4ea4\u96c6\u4e3a\u4e00\u4e2a\u96c6\u5408\uff1a\u8fd9\u4e2a\u96c6\u5408\u663e\u7136\u53ef\u4ee5\u7528\u4e0e\u5176\u4ed6\u96c6\u5408\u76f8\u540c\u7684\u65b9\u6cd5\u8868\u793a\uff0c\u76f8\u5f53\u4e8e\u5408\u5e76\u4e86\u4e24\u4e2a\u96c6\u5408\u3002\n\n\u90a3\u4e48\u5982\u679c\u6ca1\u6709\u51fa\u73b0\u524d\u4e24\u79cd\u60c5\u51b5\uff0c\u53ea\u8981\u80fd\u505a\u5b8c $n-1$ \u6b21\u5408\u5e76\uff0c\u6211\u4eec\u5c31\u53ea\u9700\u8981\u8f93\u51fa\u6700\u540e\u7684\u96c6\u5408\u7684 $a$ \u5c31\u884c\u4e86\u3002\uff08$a$ \u7684\u542b\u4e49\u540c\u9898\u9762\uff09\n\n\u8003\u8651\u5982\u4f55\u8fdb\u884c\u5408\u5e76\u7684\u8fc7\u7a0b\uff1a\n\n\u8bbe $c_p(x)$ \u4e3a $x$ \u7684\u8d28\u56e0\u6570\u5206\u89e3\u4e2d $p$ \u7684\u4e2a\u6570\u3002\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u96c6\u5408\u7684 $a_i$ \u548c $b_i$ \u8fdb\u884c\u8d28\u56e0\u6570\u5206\u89e3\u540e\uff0c\u96c6\u5408\u5185\u7684\u7b2c $j$ \u4e2a\u6570 $s_{i,j}$ \u6ee1\u8db3\u5bf9\u4e8e\u4efb\u610f\u8d28\u6570 $p$\uff0c$c_p(s_{i,j})=c_p(a_i)+(j - 1) \\times c_p(b_i)$\u3002\n\n\u8003\u8651\u5408\u5e76\u4e24\u4e2a\u96c6\u5408\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u679a\u4e3e\u8d28\u6570 $p$\u3002\u7136\u540e\u5206\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n1. \u4e24\u4e2a\u96c6\u5408\u7684 $c_p(b_i)$ \u90fd\u4e3a $0$\uff1a\u4ec5\u9700\u5224\u65ad\u4e24\u4e2a\u96c6\u5408\u7684 $c_p(a_i)$ \u662f\u5426\u76f8\u7b49\u3002\u82e5\u76f8\u7b49\u5219\u8003\u8651\u4e0b\u4e00\u4e2a\u8d28\u6570 $p$\uff1b\u82e5\u4e0d\u76f8\u7b49\u5219\u4e00\u5b9a\u4e0d\u5408\u6cd5\u3002\n2. \u53ea\u6709\u4e00\u4e2a\u96c6\u5408\u7684 $c_p(b_i)$ \u4e3a $0$\uff1a\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a\u8d28\u6570 $p$ \u7684\u6307\u6570\u662f\u4e00\u5b9a\u662f\u56fa\u5b9a\u4e86\u7684\u3002\u90a3\u4e48\u5bf9\u4e8e $c_p(b_i)$ \u4e0d\u4e3a\u96f6\u7684\u90a3\u4e00\u4e2a\u96c6\u5408\u5c31\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a $c_p(s_{i,j})=c_p(a_i)+(j - 1) \\times c_p(b_i)$ \u7684 $j$\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u5c06\u53ef\u80fd\u5c5e\u4e8e\u5e76\u96c6\u7684\u6570\u7684\u4e2a\u6570\u9650\u5236\u5728\u4e86\u8fd9\u4e00\u4e2a\u6570\u4e0a\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u8fd9\u4e2a\u6570\u662f\u4e0d\u662f\u6240\u6709\u96c6\u5408\u7684\u5e76\u5c31\u884c\u4e86\u3002\n3. \u4e24\u4e2a\u96c6\u5408\u7684 $c_p(b_i)$ \u90fd\u4e0d\u4e3a $0$\uff1a\u5148\u653e\u7740\u4e0d\u7ba1\uff0c\u4e4b\u540e\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u5904\u7406\u5b8c\u6240\u6709\u8d28\u6570\u4e4b\u540e\uff0c\u82e5\u8fd8\u6ca1\u7ed3\u675f\u5408\u5e76\uff0c\u90a3\u4e48\u5c31\u662f\u5b58\u5728\u82e5\u5e72\u4e2a\u8d28\u6570\u90fd\u5c5e\u4e8e\u60c5\u51b5\u4e09\u3002\u8003\u8651\u60c5\u51b5\u4e09\u7684\u672c\u8d28\u662f\u82e5\u5e72\u4e2a\u5982\u4e0b\u7684\u65b9\u7a0b\uff1a\n\n$$ c_p(a_i) + x \\times c_p(b_i) = c_p(a_j) + y \\times c_p(b_j)$$\n\n\u4e0d\u96be\u53d1\u73b0\u79fb\u9879\u540e\u5c31\u662f\u5173\u4e8e $x,y$ \u7684\u4e8c\u5143\u4e00\u6b21\u65b9\u7a0b\uff08\u7ec4\uff09\u3002\u8003\u8651\u5220\u9664\u6389\u91cd\u590d\u7684\u65b9\u7a0b\u540e\uff08\u5c06\u7cfb\u6570\u540c\u65f6\u9664\u6389\u6700\u5927\u516c\u7ea6\u6570\uff09\uff0c\u82e5\u65b9\u7a0b\u6570\u5927\u4e8e\u7b49\u4e8e $2$\uff0c\u90a3\u4e48\u5c31\u4e00\u5b9a\u80fd\u89e3\u51fa\u4e00\u7ec4\u89e3\uff0c\u6216\u8005\u65e0\u89e3\u3002\u8fd9\u5206\u522b\u5bf9\u5e94\u7b2c\u4e00\u6b21\u5206\u7c7b\u8ba8\u8bba\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u3001\u7b2c\u4e00\u4e2a\u60c5\u51b5\u3002\n\n\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u65b9\u7a0b\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u89e3\u4e00\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\uff1a\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u89e3\u51fa $x$ \u548c $y$ \u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\u6216\u8005\u5224\u65ad\u65e0\u89e3\u3002\u82e5\u5b58\u5728\u975e\u8d1f\u6574\u6570\u89e3\uff0c\u5219\u53ef\u4ee5\u5c06\u96c6\u5408\u7684\u4ea4\u96c6\u5199\u6210\u8fd9\u6837\u7684\u5f62\u5f0f\uff1a\uff08\u8bbe $x_0$ \u4e3a\u4e0a\u9762\u65b9\u7a0b\u7684 $x$ \u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\uff09\n\n$$c_p(a')=c_p(a_i) + x_0 \\times c_p(b_i)$$\n$$c_p(b')=lcm(c_p(b_i), c_p(b_j))$$\n\n\u7136\u540e\u63a5\u7740\u4e0e\u4e0b\u4e00\u4e2a\u65b9\u7a0b\u5408\u5e76\u5c31\u884c\u4e86\u3002\n\n\u5408\u5e76\u5230\u6700\u540e\uff0c$a'$ \u4f5c\u4e3a\u7b54\u6848\u5c31\u884c\u4e86\u3002\n\n\u5f53\u7136\uff0c\u5982\u679c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u4e0d\u628a\u7b2c\u4e00\u6b21\u5206\u7c7b\u8ba8\u8bba\u7684\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5355\u72ec\u62ff\u51fa\u6765\u8003\u8651\uff0c\u653e\u5165\u7b2c\u4e09\u79cd\u60c5\u51b5\u4ee5\u8282\u7ea6\u7801\u91cf\u4e5f\u884c\u3002\uff08\u6211\u5c31\u662f\u8fd9\u4e48\u5199\u7684\uff09\n\n${\\rm Code}$\uff1a\uff08\u7ec6\u8282\u591a\uff0c\u6240\u4ee5\u770b\u4e0a\u53bb\u5f88\u957f\uff09\n\n```cpp\nconst int mod = 1e9 + 7;\n\ninline int fsp(int x, ll k) {\n\tint s = 1;\n\twhile(k) {\n\t\tif(k & 1) s = 1LL * s * x % mod;\n\t\tx = 1LL * x * x % mod, k >>= 1;\n\t} return s;\n}\n\ninline ll exgcd(ll a, ll b, ll&x, ll&y) {\n\tif(!b) return x = 1, y = 0, a;\n\tll d = exgcd(b, a % b, y, x);\n\ty -= a / b * x;\n\treturn d;\n}\n\nstruct Node {\n\tll k, b;\n\n\tNode() {}\n\tNode(int k, int b):k(k), b(b) {}\n};\n\nint a[110];\nint b[110];\nint P[6100];\nNode f[6100];\nNode g[6100];\nint N;\n\ninline void GetPri(int x) {\n\tint t = x;\n\tfor(int i = 2; i * i <= x; i++) {\n\t\tif(t % i == 0) {\n\t\t\tP[++N] = i;\n\t\t\twhile(t % i == 0) t /= i;\n\t\t}\n\t} if(t > 1) P[++N] = t;\n}\n\nstruct Func {\n\tll A, B, C;\n\n\tFunc() {}\n\tFunc(ll A, ll B, ll C):A(A), B(B), C(C) {}\n};\n\nint vis = 0;\n\ninline int solve(int b, int k) {\n\tfor(int i = 1; i <= N; i++) g[i] = Node(0, 0);\n\tfor(int i = 1; i <= N; i++) {\n\t\twhile(k % P[i] == 0) k /= P[i], ++g[i].k;\n\t\twhile(b % P[i] == 0) b /= P[i], ++g[i].b;\n\t}\n\tif(!vis) {\n\t\tfor(int i = 1; i <= N; i++) f[i] = g[i];\n\t\tvis = 1;\n\t\treturn 1;\n\t}\n\tfor(int t = 0; t < 3; t++) {\n\t\tfor(int i = 1; i <= N; i++) {\n\t\t\tll fb = f[i].b;\n\t\t\tll fk = f[i].k;\n\t\t\tll gb = g[i].b;\n\t\t\tll gk = g[i].k;\n\t\t\tif(!fk && !gk) {\n\t\t\t\tif(fb != gb) return 0;\n\t\t\t} else if(!fk || !gk) {\n\t\t\t\tint tag = 0;\n\t\t\t\tif(!fk) swap(fk, gk), swap(fb, gb), tag = 1;\n\t\t\t\tif(gb < fb || (gb - fb) % fk) return 0;\n\t\t\t\tll k = (gb - fb) / fk;\n\t\t\t\tif(tag)\n\t\t\t\t\tfor(int j = 1; j <= N; j++)\n\t\t\t\t\t\tg[j].b += g[j].k * k, g[j].k = 0;\n\t\t\t\telse\n\t\t\t\t\tfor(int j = 1; j <= N; j++)\n\t\t\t\t\t\tf[j].b += f[j].k * k, f[j].k = 0;\n\t\t\t}\n\t\t}\n\t}\n\tFunc F;\n\tint flag = 0;\n\tll X = -1, Y = -1;\n\tfor(int i = 1; i <= N; i++) {\n\t\tll fb = f[i].b;\n\t\tll fk = f[i].k;\n\t\tll gb = g[i].b;\n\t\tll gk = g[i].k;\n\t\tif(fk && gk) {\n\t\t\tif(!flag) F = Func(fk, -gk, gb - fb), flag = 1;\n\t\t\telse if(flag == 1) {\n\t\t\t\tll A = fk, B = -gk, C = gb - fb;\n\t\t\t\tll d = __gcd(F.A, A);\n\t\t\t\tll m1 = A / d;\n\t\t\t\tll m2 = F.A / d;\n\t\t\t\tF.A *= m1, F.B *= m1, F.C *= m1;\n\t\t\t\tA *= m2, B *= m2, C *= m2; \n\t\t\t\tif(F.A == A && F.B == B) {\n\t\t\t\t\tif(F.C != C) return 0;\n\t\t\t\t\telse {\n\t\t\t\t\t\tll d = __gcd(__gcd(F.A, abs(F.B)), abs(F.C));\n\t\t\t\t\t\tF.A /= d, F.B /= d, F.C /= d;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tC -= F.C, B -= F.B;\n\t\t\t\t\tif(C < 0) C *= -1, B *= -1;\n\t\t\t\t\tif(B < 0 || C % B) return 0;\n\t\t\t\t\tY = C / B;\n\t\t\t\t\tX = (F.C - F.B * Y) / F.A;\n\t\t\t\t\tif(X < 0 || (F.C - F.B * Y) % F.A) return 0;\n\t\t\t\t\tflag = 2;\n\t\t\t\t}\n\t\t\t} else if(flag == 2) {\n\t\t\t\tll A = fk, B = -gk, C = gb - fb;\n\t\t\t\tif(A * X + B * Y != C) return 0;\n\t\t\t}\n\t\t}\n\t}\n\tif(flag == 2) {\n\t\tfor(int i = 1; i <= N; i++)\n\t\t\tf[i].b += f[i].k * X, f[i].k = 0;\n\t}\n\tif(flag == 1) {\n\t\tll x, y;\n\t\tll d = exgcd(F.A, -F.B, x, y);\n\t\ty = -y;\n\t\tif(F.C % d) return 0;\n\t\tll kx = -F.B / d;\n\t\tll ky = F.A / d;\n\t\tx *= F.C / d;\n\t\ty *= F.C / d;\n\t\tll tx = 0, ty = 0;\n\t\tif(x < 0) tx = -((-x + kx - 1) / kx);\n\t\telse tx = x / kx;\n\t\tif(y < 0) ty = -((-y + ky - 1) / ky);\n\t\telse ty = y / ky;\n\t\tx -= kx * min(tx, ty);\n\t\ty -= ky * min(tx, ty);\n\t\tfor(int i = 1; i <= N; i++)\n\t\t\tf[i].b += f[i].k * x, f[i].k *= kx;\n\t}\n\treturn 1;\n}\n\nint main() {\n\tint n = ri;\n\tfor(int i = 1; i <= n; i++) {\n\t\tGetPri(a[i] = ri);\n\t\tGetPri(b[i] = ri);\n\t}\n\tsort(P + 1, P + 1 + N);\n\tN = unique(P + 1, P + 1 + N) - P - 1;\n\tfor(int i = 1; i <= n; i++)\n\t\tif(!solve(a[i], b[i])) return puts(\"-1\"), 0;\n\tint res = 1;\n\tfor(int i = 1; i <= N; i++)\n\t\tres = 1LL * res * fsp(P[i], f[i].b) % mod;\n\tcout << res << endl;\n\treturn 0;\n}\n```",
        "postTime": 1580617048,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF571E \u3010Geometric Progressions\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u51fa $n$ \u5bf9\u6570 $(a_i,b_i)$ \u8868\u793a\u7b2c $i$ \u4e2a\u96c6\u5408\u4e3a $\\{a_i,a_i\\times b_i,a_i\\times b_i^2,\\dots\\}$\n\n\u95ee\u6700\u5c0f\u7684\u540c\u65f6\u51fa\u73b0\u5728 $n$ \u4e2a\u96c6\u5408\u7684\u6570\uff0c\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n$n\\le 100,1\\le a_i,b_i\\le 10^9$\n## \u9898\u89e3\n\n\u63d0\u4f9b\u4e00\u79cd\u6bd4\u8f83\u7b28\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u6ca1\u4ec0\u4e48\u7ec6\u8282\u3002\n\n\u8003\u8651\u628a\u6240\u6709\u7684 $a_i,b_i$ \u8d28\u56e0\u6570\u5206\u89e3\u5f97\u5230\u5411\u91cf $\\mathbf a_i,\\mathbf b_i$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u76f8\u5f53\u4e8e\u8981\u6c42\u4e00\u7ec4 $\\{k_i\\}$ \u6ee1\u8db3 $k_i$ \u90fd\u662f\u81ea\u7136\u6570\uff0c\u5e76\u4e14 $\\forall i\\in[1,n],\\mathbf a_i+k_i\\mathbf b_i=\\mathbf X$\u3002\u6211\u4eec\u5e0c\u671b\u8fd9\u4e2a $\\mathbf X$ \u6700\u5c0f\u3002\n\n\u7136\u540e\u8003\u8651\u5982\u679c $b_i=1$ \u90a3\u4e48\u6700\u7ec8\u53ef\u80fd\u7684\u6570\u53ea\u6709 $a_i$ \u76f4\u63a5\u5224\u65ad\u5373\u53ef\u3002\u5426\u5219\u6240\u6709\u7684 $\\mathbf b_i$ \u90fd\u4e0d\u662f $\\mathbf 0$\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0\u4e86\u4e24\u4e2a $\\mathbf b_i,\\mathbf b_j$ \u7ebf\u6027\u65e0\u5173\uff0c\u5373\u5b58\u5728 $p,q$ \u6ee1\u8db3 $\\mathbf b_{i,p}\\times \\mathbf b_{j,q}-\\mathbf b_{i,q}\\times \\mathbf b_{j,p}\\ne0$\uff0c\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $\\mathbf a_{i,p},\\mathbf a_{i,q},\\mathbf a_{j,p},\\mathbf a_{j,q},\\mathbf b_{i,p},\\mathbf b_{i,q},\\mathbf b_{j,p},\\mathbf b_{j,q}$ \u8ba1\u7b97\u51fa $\\mathbf X_p,\\mathbf X_q$\u3002\u56e0\u4e3a $\\mathbf b_{i,p},\\mathbf b_{i,q}$ \u81f3\u5c11\u6709\u4e00\u4e2a\u4e0d\u4e3a $0$ \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8ba1\u7b97\u51fa $k_i$\uff0c\u8ba1\u7b97\u51fa $k_i$ \u4e4b\u540e\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa $\\mathbf X$\uff0c$\\mathbf X$ \u7b97\u51fa\u6765\u4e4b\u540e\u66b4\u529b\u68c0\u9a8c\u5373\u53ef\u3002\u56e0\u4e3a\u5bf9\u4e8e\u975e\u96f6\u5411\u91cf\u7ebf\u6027\u76f8\u5173\u6ee1\u8db3\u4f20\u9012\u6027\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u76f8\u90bb\u7684\u68c0\u9a8c\u662f\u5426\u7ebf\u6027\u76f8\u5173\u5373\u53ef\u3002\n\n\u5982\u679c\u6240\u6709 $\\mathbf b_i$ \u90fd\u662f\u7ebf\u6027\u76f8\u5173\u7684\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u8ba1\u7b97\u3002\u6211\u4eec\u4e0d\u59a8\u8bbe $\\mathbf b_i=\\frac{w_i}{l_i}\\times \\mathbf b_1$\uff0c\u90a3\u4e48\u5c31\u6709\uff1a\n$$\n\\mathbf a_1+k_1\\mathbf b_1=\\mathbf a_i+k_i\\times \\frac{w_i}{l_i}\\mathbf b_1\\iff \\mathbf a_i-\\mathbf a_1=(k_1-k_i\\times \\frac{w_i}{l_i})\\mathbf b_1\n$$\n\u4e8e\u662f\u5c31\u5f97\u5230\u5982\u679c\u6709\u89e3\uff0c\u6240\u6709 $\\mathbf a_i-\\mathbf a_1$ \u90fd\u4e0e $\\mathbf b_1$ \u7ebf\u6027\u76f8\u5173\u3002\n\n\u5982\u679c\u4e0a\u4e00\u4e2a\u6761\u4ef6\u6ee1\u8db3\uff0c\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u628a $\\mathbf a_i$ \u5199\u6210 $\\mathbf a_1+\\frac{u_i}{v_i}\\mathbf b_1$\u3002\u5982\u679c $\\mathbf a_1$ \u662f\u6700\u5c0f\u7684\u90a3\u4e48\u5c31\u4f1a\u6709 $\\frac{u_i}{v_i}\\ge 0$\uff0c\u5982\u679c\u4e0d\u662f\u90a3\u4e48\u53ef\u4ee5\u628a\u6700\u5c0f\u7684\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u3002\u90a3\u4e48\u73b0\u5728\u5c31\u662f\uff1a\n\n$$\n\\mathbf a_1+\\frac{u_i}{v_i}\\mathbf b_1+\\frac{w_i}{l_i}\\times k_i\\mathbf b_1=\\mathbf X\\iff \\frac{u_i}{v_i}\\mathbf b_i+\\frac{w_i}{l_i}\\times k_i\\mathbf b_i=\\mathbf X-\\mathbf a_1\n$$\n\u4e0d\u59a8\u8bbe $N=\\mathrm{lca}(v_1,\\dots,v_n,l_1,\\dots,l_n),p_i=\\frac{u_i}{v_i}\\times N,q_i=\\frac{w_i}{l_i}\\times N$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u5f62\u5f0f\uff1a\n$$\np_1+q_1\\times k_1=p_2+q_2\\times k_2=\\dots=p_n+q_n\\times k_n=R\n$$\n\u8fd9\u4e2a\u5c31\u5f88\u5bb9\u6613\u505a\u4e86\uff0c\u5c31\u662f\u6c42 $R\\equiv p_i\\bmod q_i,R\\ge p_i$ \u7684\u6700\u5c0f\u7684 $R$\uff0c\u76f4\u63a5\u4e0a exCRT \u5c31\u505a\u5b8c\u4e86\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u8fd9\u4e2a\u6570\u4f1a\u4e0d\u4f1a\u592a\u5927\uff0c\u8ba9 exCRT \u6302\u6389\uff0c\u4f46\u662f\u5206\u6790\u4e00\u6ce2\u662f\u4e0d\u4f1a\u7684\uff0c\u56e0\u4e3a\u56e0\u5b50\u4e2a\u6570 $\\le 30$\uff0c\u6240\u6709\u7684 $q_i$  \u7684\u6700\u5927\u516c\u7ea6\u6570\u6700\u5927\u662f $2^4\\times 3^3\\times 5^2\\times 7\\times 11\\times 13\\times 17\\times 19\\times 23\\times 29$ \u4e0d\u8d85\u8fc7 `long long` \u7528 `__int128` \u5c31\u5b8c\u5168\u5b58\u7684\u4e0b\u3002\n\n\u7136\u540e\u5c31\u4e0d\u96be\u7b97\u51fa $\\mathbf X$ \u8ba1\u7b97\u7b54\u6848\u4e86\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define mp make_pair\n#define mt make_tuple\n#define eb emplace_back\n#define pb push_back\n#define pc putchar\n#define chkmx(a,b) (a)=max((a),(b))\n#define chkmn(a,b) (a)=min((a),(b))\n#define fi first\n#define se second\nusing namespace std;\ntemplate<class T>\nvoid read(T&x){x=0;char c=getchar();bool f=0;for(;!isdigit(c);c=getchar())f^=c=='-';for(;isdigit(c);c=getchar())x=x*10+c-'0';if(f)x=-x;}\ntemplate<class T,class ...ARK>void read(T&x,ARK&...ark){read(x);read(ark...);}\ntemplate<class T>void write(T x){if(x<0)pc('-'),x=-x;if(x>=10)write(x/10);pc(x%10+'0');}\ntemplate<class T,class ...ARK>void write(T x,ARK...ark){write(x);pc(' ');write(ark...);}\ntemplate<class ...ARK>void writeln(ARK...ark){write(ark...);pc('\\n');}\ntypedef __int128 ll;\nconst int mod=1e9+7;\nstruct mint{\n\tint x;mint(int o=0){x=o;}mint&operator+=(mint a){return(x+=a.x)%=mod,*this;}mint&operator-=(mint a){return(x+=mod-a.x)%=mod,*this;}\n\tmint&operator*=(mint a){return(x=1ll*x*a.x%mod),*this;}mint&operator^=( int b){mint a=*this;x=1;while(b)(b&1)&&(*this*=a,1),a*=a,b>>=1;return*this;}\n\tmint&operator/=(mint a){return*this*=(a^=mod-2);}friend mint operator+(mint a,mint b){return a+=b;}friend mint operator-(mint a,mint b){return a-=b;}\n\tfriend mint operator*(mint a,mint b){return a*=b;}friend mint operator/(mint a,mint b){return a/=b;}friend mint operator^(mint a, int b){return a^=b;}\n};\nconst int N=110;\nint n,a[N],b[N];\nint u[N],v[N],w[N],l[N];\nll p[N],q[N];\nvoid exgcd(ll x,ll y,ll&a,ll&b){\n\tif(!y)return a=1,b=0,void();\n\texgcd(y,x%y,b,a);b-=(x/y)*a;\n}\nvector<int>prs;\nvoid ins(int x){\n\tfor(int i=2;i*i<=x;i++)\n\t\twhile(x%i==0)prs.pb(i),x/=i;\n\tif(x>1)prs.pb(x);\n}\nbool ispow(int a,int b){\n\t//\u662f\u5426a^x=b\n\tif(a==1&&b>1)return 0;\n\tll res=1;\n\twhile(res<b)res*=a;\n\treturn res==b;\n}\nstruct vec{\n\tvector<ll>a;\n\tll&operator[](int x){return a[x];}\n\tvoid init(int x){\n\t\ta.resize(prs.size());\n\t\tfor(ll i=2;i*i<=x;i++)\n\t\t\twhile(x%i==0){\n\t\t\t\ta[lower_bound(prs.begin(),prs.end(),i)-prs.begin()]++;\n\t\t\t\tx/=i;\n\t\t\t}\n\t\tif(x>1)a[lower_bound(prs.begin(),prs.end(),x)-prs.begin()]++;\n\t}\n\tfriend vec operator+(vec a,vec b){\n\t\tfor(int i=0;i<(int)prs.size();i++)a[i]+=b[i];\n\t\treturn a;\n\t}\n\tfriend vec operator-(vec a,vec b){\n\t\tfor(int i=0;i<(int)prs.size();i++)a[i]-=b[i];\n\t\treturn a;\n\t}\n\tfriend vec operator*(vec a,ll b){\n\t\tfor(int i=0;i<(int)prs.size();i++)a[i]*=b;\n\t\treturn a;\n\t}\n\tfriend bool operator==(vec a,vec b){return a.a==b.a;}\n\tfriend bool operator!=(vec a,vec b){return a.a!=b.a;}\n\tfriend bool operator<(vec a,vec b){return a.a<b.a;}\n\tfriend bool operator%(vec a,vec b){\n\t\t//\u5224\u65ada,b\u662f\u5426\u7ebf\u6027\u76f8\u5173\n\t\tfor(int i=0;i<(int)prs.size();i++)\n\t\t\tfor(int j=i+1;j<(int)prs.size();j++)\n\t\t\t\tif(a[i]*b[j]-a[j]*b[i])\n\t\t\t\t\treturn 0;\n\t\treturn 1;\n\t}\n\tfriend pair<int,int>operator^(vec a,vec b){\n\t\t//\u627e\u5230\u4e00\u4e2a\u4e0d\u76f8\u5173\u7684\n\t\tfor(int i=0;i<(int)prs.size();i++)\n\t\t\tfor(int j=i+1;j<(int)prs.size();j++)\n\t\t\t\tif(a[i]*b[j]-a[j]*b[i])\n\t\t\t\t\treturn mp(i,j);\n\t\texit(-1);\n\t}\n}A[N],B[N],X;\n#define orz return puts(\"-1\"),0\npair<int,int>deal(vec v){\n\t//\u8fd4\u56de mp(a,b) \u8868\u793a v = a/b b1\n\tfor(int i=0;i<(int)prs.size();i++)if(B[1][i]){\n\t\tint x=v[i],y=B[1][i];\n\t\treturn mp(x/__gcd(x,y),y/__gcd(x,y));\n\t}\n\texit(-1);\n}\nsigned main(){\n\tread(n);\n\tfor(int i=1;i<=n;i++)read(a[i],b[i]),ins(a[i]),ins(b[i]);\n\tsort(prs.begin(),prs.end());prs.resize(unique(prs.begin(),prs.end())-prs.begin());\n\tfor(int i=1;i<=n;i++)if(b[i]==1){\n\t\tfor(int j=1;j<=n;j++)if(a[i]%a[j]||!ispow(b[j],a[i]/a[j]))orz;\n\t\twriteln(a[i]);return 0;\n\t}\n\tfor(int i=1;i<=n;i++)A[i].init(a[i]),B[i].init(b[i]);\n\tfor(int i=1;i<n;i++)if(!(B[i]%B[i+1])){\n\t\tpair<int,int>r=B[i]^B[i+1];\n\t\tll u=-(A[i][r.se]*B[i][r.fi]*B[i+1][r.fi]-A[i+1][r.se]*B[i][r.fi]*B[i+1][r.fi]-A[i][r.fi]*B[i][r.se]*B[i+1][r.fi]+A[i+1][r.fi]*B[i][r.fi]*B[i+1][r.se]);\n\t\tll v=B[i][r.se]*B[i+1][r.fi]-B[i][r.fi]*B[i+1][r.se];\n\t\tif(u%v)orz;\n\t\t//\u7b97\u51fa\u5b8c\u6574\u7684x\n\t\tint val=u/v;\n\t\tu=i;if(!B[u][r.fi])u=i+1;\n\t\tassert(B[u][r.fi]);\n\t\tif((val-A[u][r.fi])%B[u][r.fi])orz;\n\t\tv=(val-A[u][r.fi])/B[u][r.fi];\n\t\tif(v<0)orz;\n\t\tX=A[u]+B[u]*v;\n\t\t//\u7136\u540echk\u4e00\u904d\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(u=0;!B[i][u];u++);\n\t\t\tif((X[u]-A[i][u])%B[i][u])orz;\n\t\t\tv=(X[u]-A[i][u])/B[i][u];\n\t\t\tif(v<0)orz;\n\t\t\tif(X!=A[i]+B[i]*v)orz;\n\t\t}\n\t\tmint ans=1;\n\t\tfor(int i=0;i<(int)prs.size();i++)\n\t\t\tans*=(mint(prs[i])^(X[i]%(mod-1)));\n\t\twriteln(ans.x);\n\t\treturn 0;\n\t}\n\t//\u5426\u5219\u6240\u6709B[i]\u90fd\u662f\u7ebf\u6027\u76f8\u5173\u7684\uff0c\u6211\u4eec\u8981\u6c42\u6240\u6709 (A[i]-A[1]) \u4e0e B[?] \u7ebf\u6027\u76f8\u5173\n\tfor(int i=2;i<=n;i++)\n\t\tif(!((A[i]-A[1])%B[1]))\n\t\t\torz;\n\tfor(int i=2;i<=n;i++)if(a[i]<a[1])swap(a[i],a[1]),swap(b[i],b[1]);\n\t//\u90fd\u8868\u793a\u6210 A1 + ui/vi B1 + wi/li ki B1 \u7684\u5f62\u5f0f \u8981\u6c42ki\u662f\u6574\u6570 \u5168\u90e8\u76f8\u7b49\n\tll M=1;\n\tfor(int i=1;i<=n;i++){\n\t\ttie(u[i],v[i])=deal(A[i]-A[1]);\n\t\ttie(w[i],l[i])=deal(B[i]);\n\t\tM=M/__gcd(M,(ll)v[i])*v[i];\n\t\tM=M/__gcd(M,(ll)l[i])*l[i];\n\t}\n\t//pi + qi ki \u5168\u90e8\u76f8\u7b49 =X  X>=pi X%qi=pi\n\tfor(int i=1;i<=n;i++)p[i]=M/v[i]*u[i],q[i]=M/l[i]*w[i];\n\t//\u7136\u540eexcrt\n\tM=1;ll R=0;\n\tfor(int i=1;i<=n;i++){\n\t\t//x mod m = r\n\t\t//x mod M = R\n\t\t//x mod lcm(M,m) = ?\n\t\tll m=q[i],r=p[i],d=__gcd(M,m);\n\t\tif((R-r)%d)orz;\n\t\tll k1,k2;exgcd(M/d,m/d,k1,k2);\n\t\tk1*=(r-R)/d;ll nm=M/d*m;k1%=nm;\n\t\tR=k1*M+R;R=(R%nm+nm)%nm;M=nm;\n\t}\n\tfor(int i=1;i<=n;i++)while(R<p[i])R+=M;\n\tmint ans=1;\n\t//\u76f4\u63a5\u8ba1\u7b97k1\n\tll k1=(R-p[1])/q[1];\n\tfor(int i=0;i<(int)prs.size();i++)\n\t\tans*=(mint(prs[i])^((A[1][i]+B[1][i]*k1)%(mod-1)));\n\twriteln(ans.x);\n\tcerr<<\"luogu is the greatest OJ!!\";\n}\n```\n\n",
        "postTime": 1648625759,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF571E \u3010Geometric Progressions\u3011"
    },
    {
        "content": "### \u601d\u8def\n\n\u8fd9\u9898\u601d\u7ef4\u96be\u5ea6\u80af\u5b9a\u6ca1\u6709 Medium+\uff0c\u4f46\u662f\u8fd9\u73a9\u610f\u7ec6\u8282\u548c\u7801\u91cf\u548c 538G \u6709\u7684\u4e00\u62fc\u3002\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\u4e24\u4e2a\u5e8f\u5217\u7684\u5408\u5e76\u4e00\u5b9a\u4ecd\u7136\u6ee1\u8db3\u8fd9\u4e2a\u5f62\u5f0f\u3002\u7b80\u5355\u8bc1\u660e\uff1a\n\n* \u5bf9\u4e8e\u53ea\u5b58\u5728 $0$ \u4e2a\u6216 $1$ \u4e2a\u5143\u7d20\u7684\u5e8f\u5217\u663e\u7136\u5408\u6cd5\u3002\n* \u5b58\u5728\u6b63\u6574\u6570 $t_1,t_2$ \u4f7f\u5f97\u6b21\u5c0f\u7684\u6570\u662f\u6700\u5c0f\u7684\u6570\u4e58\u4e0a $b_1^{t_1}=b_2^{t_2}$\u3002\n* \u6700\u5c0f\u7684\u6570\u4e58  $b_1^{t_1}$ \u7684\u4efb\u610f\u975e\u8d1f\u6574\u6570\u6b21\u65b9\u90fd\u5408\u6cd5\uff0c\u4e0d\u7136\u4e00\u5b9a\u4e0d\u5408\u6cd5\u3002\n\n\u73b0\u5728\u7684\u95ee\u9898\u6709\u4e24\u4e2a\uff1a\u627e\u6700\u5c0f\u6570\u548c\u627e\u5468\u671f\u3002\n\n\u5468\u671f\u76f8\u5bf9\u597d\u627e\uff0c\u663e\u7136\u53ea\u6709\u5728\u5b58\u5728\u4e00\u4e2a\u6570 $b_0>1$ \u548c\u975e\u8d1f\u6574\u6570 $f_1,f_2$ \u4f7f\u5f97 $b_1=b_0^{f_1},b_2=b_0^{f_2}$ \u624d\u662f\u5408\u6cd5\u7684\uff0c\u65b0\u7684\u5468\u671f\u5c31\u53d8\u6210\u4e86 $b_0^{\\text{lcm}(f_1,f_2)}$\uff0c\u901a\u8fc7\u7ef4\u62a4\u8d28\u56e0\u5b50\u96c6\u5408\u7684\u65b9\u5f0f\u8868\u793a\u5373\u53ef\u3002\n\n\u6700\u5c0f\u6570\u76f8\u5bf9\u96be\u627e\uff0c\u4ecd\u7136\u8003\u8651\u4ece\u8d28\u56e0\u5b50\u96c6\u5408\u5165\u624b\uff0c\u6bcf\u4e2a\u8d28\u56e0\u5b50\u96c6\u5408\u76f8\u5f53\u4e8e\u4e00\u4e2a\u65b9\u7a0b\uff0c\u5373 $a_1b_1^{c_1}=a_2b_2^{c_2}$ \u4e2d\u53ef\u4ee5\u9650\u5b9a $Ac_1-Bc_2=C$\uff0c\u5c06\u82e5\u5e72\u4e2a\u65b9\u7a0b\u8054\u7acb\u4e4b\u540e\u786e\u8ba4\u65e0\u89e3\u6216\u6c42\u51fa\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\u5373\u53ef\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67d0\u4e2a\u65b9\u7a0b\u6c42\u51fa\u65e0\u89e3\u6216 $c_1=d_1+h_1k,c_2=d_2+h_2k$ \u7684\u5f62\u5f0f\uff0c\u5728\u540e\u9762\u7684\u65b9\u7a0b\u6c42\u51fa $k$ \u7684\u89e3\u3002\u5982\u679c\u5b58\u5728\u4e00\u4e2a\u65b9\u7a0b\u65e0\u89e3\u6216 $k$ \u7684\u503c\u5b58\u5728\u51b2\u7a81\u6216 $x,y<0$\uff0c\u6574\u4e2a\u95ee\u9898\u65e0\u89e3\uff0c\u5982\u679c $k$ \u7684\u503c\u672a\u786e\u5b9a\u5219\u76f4\u63a5\u53d6\u4f7f\u5f97 $x,y\\geq 0$ \u4e14\u6700\u5c0f\u7684\u89e3\u5373\u53ef\u3002\n\n\u5206\u6790\u65f6\u95f4\u590d\u6742\u5ea6\uff1a\u5206\u89e3\u8d28\u56e0\u6570 $\\frac{\\sqrt a}{\\log a}$\uff0c\u8d28\u56e0\u5b50\u96c6\u5408\u5927\u5c0f $n\\omega(a)$\uff0cexgcd \u53ea\u9700\u8981\u505a\u4e00\u6b21\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\frac{\\sqrt a}{\\log a}+n\\log a+n^2\\omega(a))$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n// Problem: E. Geometric Progressions\n// Contest: Codeforces - Codeforces Round #317 [AimFund Thanks-Round] (Div. 1)\n// URL: https://codeforces.com/problemset/problem/571/E\n// Memory Limit: 256 MB\n// Time Limit: 1000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n//And in that light,I find deliverance.\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"unroll-loops\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")\nusing namespace std;\n#define int long long\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\n#define hhz pair<vector<pair<int,int>>,vector<pair<int,int>>>\nconst int p=1e9+7;\nconst int TRASH=-1e18;\nint qp(int x,int y)\n{\n\tint res=1;\n\tfor(int t=x; y; y>>=1,t=t*t%p) if(y&1) res=res*t%p;\n\treturn res;\n}\nconst int MX=32000;\nint prime[32003],pcnt;\nbool vis[32003];\nvoid init()\n{\n\tfor(int i=2; i<=MX; ++i) if(!vis[i])\n\t{\n\t\tprime[++pcnt]=i;\n\t\tfor(int j=2; i*j<=MX; ++j) vis[i*j]=1;\n\t}\n\treturn ;\n}\nvoid Read(hhz &t)\n{\n\tt.fi.clear(),t.se.clear();\n\tint A=read(),B=read();\n\tfor(int i=1; i<=pcnt&&A>1; ++i) if(!(A%prime[i]))\n\t{\n\t\tint F=prime[i],G=0;\n\t\twhile(!(A%prime[i])) A/=prime[i],++G;\n\t\tt.fi.pb(mp(F,G));\n\t}\n\tif(A>1) t.fi.pb(mp(A,1));\n\tfor(int i=1; i<=pcnt&&B>1; ++i) if(!(B%prime[i]))\n\t{\n\t\tint F=prime[i],G=0;\n\t\twhile(!(B%prime[i])) B/=prime[i],++G;\n\t\tt.se.pb(mp(F,G));\n\t}\n\tif(B>1) t.se.pb(mp(B,1));\n\treturn ;\n}\nhhz X,Y,Z;\nvoid exgcd(int &x,int &y,int a,int b)\n{\n    if(!b)\n    {\n        x=1,y=0;\n        return;\n    }\n    exgcd(x,y,b,a%b);\n    int t=x;\n    x=y,y=t-a/b*y;\n}\nvoid merge()\n{\n\tZ.fi.clear(),Z.se.clear();\n\tif(X.se.empty()&&Y.se.empty())\n\t\tif(X==Y) { Z=X; return ; }\n\t\telse puts(\"-1\"),exit(0);\n\tauto it1=X.fi.begin(),it2=X.se.begin(),it3=Y.fi.begin(),it4=Y.se.begin();\n\tauto ed1=X.fi.end(),ed2=X.se.end(),ed3=Y.fi.end(),ed4=Y.se.end();\n\tint vX=-1,vY=-1,dX=-1,dY=-1,k=-1;\n\twhile(it1!=ed1||it2!=ed2||it3!=ed3||it4!=ed4)\n\t{\n\t\tint A=0,B=0,C=0,D=0,v=0x3f3f3f3f3f3f3f3f;\n\t\tif(it1!=ed1) v=min(v,it1->fi);\n\t\tif(it2!=ed2) v=min(v,it2->fi);\n\t\tif(it3!=ed3) v=min(v,it3->fi);\n\t\tif(it4!=ed4) v=min(v,it4->fi);\n\t\tif(it1!=ed1&&it1->fi==v) A=it1->se,++it1;\n\t\tif(it2!=ed2&&it2->fi==v) B=it2->se,++it2;\n\t\tif(it3!=ed3&&it3->fi==v) C=it3->se,++it3;\n\t\tif(it4!=ed4&&it4->fi==v) D=it4->se,++it4;\n\t\tif(vX==-1&&vY==-1&&dX==-1&&dY==-1&&k==-1)\n\t\t{\n\t\t\t//A+Bx=C+Dy -> Bx-Dy=C-A\n\t\t\tint a=B,b=D,x,y,v=C-A,o=abs(__gcd(__gcd(a,b),v));\n\t\t\tif(a==0&&b==0) \n\t\t\t\tif(v) puts(\"-1\"),exit(0);\n\t\t\t\telse continue;\n\t\t\ta/=o,b/=o,v/=o;\n\t\t\tif(abs(__gcd(a,b))!=1) puts(\"-1\"),exit(0);\n\t\t\texgcd(x,y,a,b),y*=-1;\n\t\t\tassert(x*a-y*b==1);\n\t\t\tx*=v,y*=v,vX=x,vY=y,dX=b,dY=a,k=TRASH;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//A+B(kdX+X)=C+D(kdY+Y)\n\t\t\t//A+BdXk+BX=C+DdYk+dY\n\t\t\t//(BdX-DdY)k=(C+DY-A-BX)\n\t\t\tint F=(B*dX-D*dY),G=(C+D*vY-A-B*vX);\n\t\t\tif(F==0) if(G==0) continue;\n\t\t\t\telse puts(\"-1\"),exit(0);\n\t\t\telse if(G%F||(k!=TRASH&&G/F!=k)) puts(\"-1\"),exit(0);\n\t\t\t\telse if(k==TRASH) k=G/F;\n\t\t}\n\t}\n\tif(k==TRASH)\n\t{\n\t\tif(vX<0&&dX==0) puts(\"-1\"),exit(0);\n\t\tif(vY<0&&dY==0) puts(\"-1\"),exit(0);\n\t\t// while(vX<0||vY<0) vX+=dX,vY+=dY;\n\t\tif(vX<0||vY<0)\n\t\t{\n\t\t\tint G=max((-vX-1)/dX+1,(-vY-1)/dY+1);\n\t\t\tvX+=dX*G,vY+=dY*G;\n\t\t}\n\t\tif(vX>=dX&&vY>=dY)\n\t\t{\n\t\t\tint G=min(vX/dX,vY/dY);\n\t\t\tvX-=dX*G,vY-=dY*G;\n\t\t}\n\t\tk=0;\n\t}\n\tit1=X.fi.begin(),it2=X.se.begin(),it3=Y.fi.begin(),it4=Y.se.begin();\n\tvX+=dX*k,vY+=dY*k;\n\tif(vX<0||vY<0) puts(\"-1\"),exit(0);\n\twhile(it1!=ed1||it2!=ed2||it3!=ed3||it4!=ed4)\n\t{\n\t\tint A=0,B=0,C=0,D=0,v=0x3f3f3f3f3f3f3f3f;\n\t\tif(it1!=ed1) v=min(v,it1->fi);\n\t\tif(it2!=ed2) v=min(v,it2->fi);\n\t\tif(it3!=ed3) v=min(v,it3->fi);\n\t\tif(it4!=ed4) v=min(v,it4->fi);\n\t\tif(it1!=ed1&&it1->fi==v) A=it1->se,++it1;\n\t\tif(it2!=ed2&&it2->fi==v) B=it2->se,++it2;\n\t\tif(it3!=ed3&&it3->fi==v) C=it3->se,++it3;\n\t\tif(it4!=ed4&&it4->fi==v) D=it4->se,++it4;\n\t\tassert(A+B*vX==C+D*vY);\n\t\tZ.fi.pb(mp(v,A+B*vX));\n\t}\n\tit2=X.se.begin(),it4=Y.se.begin();\n\tpair<int,int> cur=mp(0ll,0ll);\n\twhile(it2!=ed2||it4!=ed4)\n\t{\n\t\tint A=0,B=0,v=0x3f3f3f3f;\n\t\tif(it2!=ed2) v=min(v,it2->fi);\n\t\tif(it4!=ed4) v=min(v,it4->fi);\n\t\tif(it2!=ed2&&it2->fi==v) A=it2->se,++it2;\n\t\tif(it4!=ed4&&it4->fi==v) B=it4->se,++it4;\n\t\tint T=__gcd(A,B);\n\t\tA/=T,B/=T;\n\t\tif(cur==mp(0ll,0ll)) cur=mp(A,B);\n\t\telse if(cur!=mp(A,B)) \n\t\t{\n\t\t\tZ.se.clear();\n\t\t\tbreak;\n\t\t}\n\t\tZ.se.pb(mp(v,A*B*T));\n\t}\n\treturn ;\n}\nint prod(vector<pair<int,int>>&x)\n{\n\tint ans=1;\n\tfor(auto i:x) ans=ans*qp(i.fi,i.se)%p;\n\treturn ans;\n}\nsigned main()\n{\n\tinit();\n\tint T=read()-1;\n\tRead(X);\n\twhile(T--) Read(Y),merge(),swap(X,Z);\n\tprintf(\"%lld\\n\",prod(X.fi));\n\treturn 0;\n}\n```",
        "postTime": 1638026393,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF571E"
    },
    {
        "content": "> [CF571E Geometric Progressions](https://codeforces.com/contest/571/problem/E)\n\n## \u9898\u610f\n\n- \u7ed9\u5b9a $n$ \u4ee5\u53ca $n$ \u4e2a\u6b63\u6574\u6570\u5bf9 $a_i, b_i$\u3002\n- \u7b2c $i$ \u5bf9 $a_i, b_i$ \u786e\u5b9a\u4e86\u4e00\u4e2a\u5e8f\u5217 $\\{a_i, a_i b_i, a_i b_i^2, a_i b_i^3, \\ldots \\}$\u3002\n- \u8be2\u95ee\u6700\u5c0f\u7684\u5728 $n$ \u4e2a\u5e8f\u5217\u4e2d\u90fd\u6709\u51fa\u73b0\u7684\u6570\uff0c\u6216\u8005\u5224\u65ad\u4e0d\u5b58\u5728\u3002\n- $n \\le 100$\uff0c$a_i, b_i \\le {10}^9$\uff0c\u7b54\u6848\u5bf9 ${10}^9 + 7$ \u53d6\u6a21\u3002\n\n## \u9898\u89e3\n\n\u672c\u9898\u6570\u636e\u8303\u56f4\u76f8\u5bf9\u8f83\u5c0f\uff0c\u56e0\u6b64\u4fdd\u8bc1\u6b63\u786e\u6027\u5373\u53ef\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u663e\u7136\u8981\u5c06\u6240\u6709 $a_i,b_i$ \u5206\u89e3\u8d28\u56e0\u6570\uff0c\u6839\u53f7\u8bd5\u9664\u5373\u53ef\u3002\n\n\u5728\u5148\u5904\u7406\u6389\u67d0\u4e2a $a_i$ \u5c31\u662f\u7b54\u6848\u7684\u60c5\u51b5\u4e4b\u540e\uff0c\u8bbe $P(x)$ \u4e3a $x$ \u7684\u8d28\u56e0\u6570\u96c6\u5408\uff0c\u82e5\u5b58\u5728 $i,j$ \u6709 $P(a_i) \\cup P(b_i) \\ne P(a_j) \\cup P(b_j)$\uff0c\u5219\u663e\u7136\u65e0\u89e3\u3002\n\n\u5426\u5219\uff0c\u8bbe $P = P(a_i) \\cup P(b_i)$\u3002\n\n\u8bbe $c_i$ \u8868\u793a\u6700\u7ec8\u7684\u7b54\u6848\u5728\u7b2c $i$ \u4e2a\u5e8f\u5217\u4e2d\u88ab\u8868\u793a\u6210 $a_ib_i^{c_i}$\uff0c\u53e6\u5916\u8bbe $c_p(x)$ \u8868\u793a $x$ \u4e2d\u8d28\u6570 $p$ \u7684\u6b21\u6570\u3002\n\n\u6bcf\u6b21\u8003\u8651\u5408\u5e76\u4e24\u4e2a\u5e8f\u5217 $i,j$\uff0c\u5373\u5bf9\u4e8e $p \\in P$\uff0c\u9700\u8981\u627e\u5230\u6ee1\u8db3 $c_p(a_i) + c_i \\cdot c_p(b_i) = c_p(a_j) + c_j \\cdot c_p(b_j)$ \u7684 $c_i$ \u7684\u53d6\u503c\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a $p \\in P$\uff0c\u6211\u4eec\u90fd\u80fd\u5217\u51fa\u4e00\u4e2a\u8fd9\u6837\u7684\u65b9\u7a0b\u3002\n\n\u89e3\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\uff0c\u7ed3\u679c\u8981\u4e48\u5224\u65ad\u51fa\u65e0\u89e3\uff0c\u8981\u4e48\u76f4\u63a5\u786e\u5b9a $c_i$ \u7684\u503c\uff0c\u8981\u4e48\u8981\u89e3\u4e00\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u3002\n\n\u524d\u9762\u4e24\u79cd\u60c5\u51b5\u90fd\u5f88\u597d\u5904\u7406\u3002\u5bf9\u4e8e\u6700\u540e\u4e00\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u51fa\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\uff0c\u82e5\u8bbe\u4e3a $x$\uff0c\u5219\u5408\u5e76\u540e\u7684\u65b0\u5e8f\u5217\u4e2d\uff0c$a^{\\prime} = a_i \\cdot b_i^x$\uff0c$b^{\\prime} = \\sum_{p} p^{\\operatorname{lcm}(c_p(b_i), c_p(b_j))}$\u3002\n\n\u5408\u5e76\u5230\u6700\u540e\uff0c$a^{\\prime}$ \u5373\u4e3a\u7b54\u6848\u3002\n\n\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6d89\u53ca\u5230\u7684\u6570\u80af\u5b9a\u4f1a\u5f88\u5927\uff0c\u56e0\u6b64\u76f4\u63a5\u628a\u6bcf\u4e2a\u6570\u7528\u5176\u552f\u4e00\u5206\u89e3\u5f0f\u5b58\u5c31\u884c\u4e86\u3002\n\n\u6ce8\u610f\uff0c\u6307\u6570\u4f1a\u7206 `int ` \u4f46\u4e0d\u4f1a\u7206 `long long`\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#define Fail print(-1), exit(0)\nconst int N = 107;\nint n;\nstruct Num {\n\tvector<pair<int, ll>> p;\n\tinline void in() {\n\t\tint x;\n\t\trd(x);\n\t\tfor (int i = 2; i * i <= x; i++)\n\t\t\tif (!(x % i)) {\n\t\t\t\tp.pb(mp(i, 0ll));\n\t\t\t\twhile (!(x % i)) ++p.back().se, x /= i;\n\t\t\t}\n\t\tif (x != 1) p.pb(mp(x, 1ll));\n\t}\n\tinline void out() {\n\t\tmodint ans = 1;\n\t\tfor (auto o : p) ans *= (modint)o.fi ^ o.se;\n\t\tprint(ans);\n\t}\n\t#define s(o) o.p.size()\n\t#define x(o) x.p[o]\n\t#define y(o) y.p[o]\n\t#define z(o) z.p.pb(o)\n\tinline friend Num operator * (Num x, Num y) {\n\t\tNum z;\n\t\tui i = 0, j = 0;\n\t\twhile (i < s(x) && j < s(y))\n\t\t\tif (x(i).fi == y(j).fi)\n\t\t\t\tz(mp(x(i).fi, x(i).se + y(j).se)), ++i, ++j;\n\t\t\telse if (x(i).fi < y(j).fi) z(x.p[i++]);\n\t\t\telse z(y.p[j++]);\n\t\twhile (i < s(x)) z(x.p[i++]);\n\t\twhile (j < s(y)) z(y.p[j++]);\n\t\treturn z;\n\t}\n\tinline friend bool operator % (Num x, Num y) {\n\t\tfor (ui i = 0, j = 0; j < s(y); i++, j++) {\n\t\t\twhile (i < s(x) && x(i).fi != y(j).fi) ++i;\n\t\t\tif (i == s(x) || x(i).se < y(j).se) return 1;\n\t\t}\n\t\treturn 0;\n\t}\n\tinline friend Num operator / (Num x, Num y) {\n\t\tNum z;\n\t\tfor (ui i = 0, j = 0; i < s(x); i++)\n\t\t\tif (j < s(y) && x(i).fi == y(j).fi) {\n\t\t\t\tz(mp(x(i).fi, x(i).se - y(j++).se));\n\t\t\t\tif (!z.p.back().se) z.p.pop_back();\n\t\t\t} else z(x(i));\n\t\treturn z;\n\t}\n\tinline friend Num operator & (Num x, Num y) {\n\t\tNum z;\n\t\tfor (ui i = 0, j = 0; i < s(x); i++)\n\t\t\tif (j < s(y) && x(i).fi == y(j).fi)\n\t\t\t\tz(mp(x(i).fi, x(i).se - y(j++).se));\n\t\t\telse z(x(i));\n\t\treturn z;\n\t}\n\tinline friend bool operator | (Num x, Num y) {\n\t\tif (!s(x)) return 0;\n\t\tll k;\n\t\tfor (ui i = 0, j = 0; i <= s(x); i++, j++) {\n\t\t\twhile (j < s(y) && !y(j).se) ++j;\n\t\t\tif (i == s(x)) {\n\t\t\t\tif (j == s(y)) return 0;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (j == s(y)) return 1;\n\t\t\tif (x(i).fi != y(j).fi || x(i).se % y(j).se) return 1;\n\t\t\tif (!i) k = x(i).se / y(j).se;\n\t\t\telse if ((x(i).se / y(j).se) != k) return 1;\n\t\t}\n\t\treturn 0;\n\t}\n\tinline friend Num operator ^ (Num x, ll y) {\n\t\tfor (auto &o : x.p) o.se *= y;\n\t\treturn x;\n\t}\n\tinline friend Num operator + (Num x, Num y) {\n\t\tNum z;\n\t\tfor (ui i = 0; i < s(x); i++)\n\t\t\tz(mp(x(i).fi, x(i).se * y(i).se / __gcd(x(i).se, y(i).se)));\n\t\treturn z;\n\t}\n} a[N], b[N], c[N], A, B;\n\ninline bool pd(Num x) {\n\tfor (int i = 1; i <= n; i++)\n\t\tif ((x % a[i]) || ((x / a[i]) | b[i])) return 0;\n\treturn 1;\n}\n\nstruct Pro {\n\tll k, b, p;\n\tinline Pro() {}\n\tinline Pro(ll k, ll b, ll p) : k(k), b(b), p(p) {}\n\tinline bool operator == (const Pro o) const {\n\t\treturn k == o.k && b == o.b && p == o.p;\n\t}\n};\n\ninline ll solve(Pro x, Pro y) {\n\tll a = x.b * y.p - y.b * x.p, b = x.k * y.p - y.k * x.p;\n\tif (!b || a % b) Fail;\n\treturn a / b;\n}\n\nll exgcd(ll a, ll b, ll &x, ll &y, ll d = 0ll) {\n\treturn b ? (d = exgcd(b, a % b, y, x), y -= a / b * x, d) : (x = 1, y = 0, a);\n}\n\ninline bool merge(int o) {\n\tvector<Pro> pro;\n\tfor (ui i = 0; i < A.p.size(); i++) {\n\t\tll k1 = B.p[i].se, b1 = A.p[i].se;\n\t\tll k2 = b[o].p[i].se, b2 = a[o].p[i].se;\n\t\tif (!k1 && !k2) {\n\t\t\tif (b1 != b2) Fail;\n\t\t\tcontinue;\n\t\t}\n\t\tif (!k1) {\n\t\t\tif (b1 < b2 || (b1 - b2) % k2) Fail;\n\t\t\tA = a[o] * (b[o] ^ ((b1 - b2) / k2));\n\t\t\treturn 0;\n\t\t}\n\t\tif (!k2) {\n\t\t\tif (b2 < b1 || (b2 - b1) % k1) Fail;\n\t\t\tA = A * (B ^ ((b2 - b1) / k1));\n\t\t\treturn 0;\n\t\t}\n\t\tll d = __gcd(k1, k2), g = b2 - b1;\n\t\tif (g % d) Fail;\n\t\tg /= d, k1 /= d, k2 /= d;\n\t\tif (pro.size()) {\n\t\t\tif (pro[0] == Pro(k1, g, k2)) continue;\n\t\t\tA = A * (B ^ solve(pro[0], Pro(k1, g, k2)));\n\t\t\treturn 0;\n\t\t}\n\t\tpro.pb(Pro(k1, g, k2));\n\t}\n\tif (pro.size()) {\n\t\tll k = pro[0].k, b = pro[0].b, p = pro[0].p, x, y;\n\t\tb = (b % p + p) % p;\n\t\texgcd(k, p, x, y);\n\t\tx = (x * b % p + p) % p;\n\t\tA = A * (B ^ x);\n\t\tB = B + ::b[o];\n\t}\n\treturn 1;\n}\n\nint main() {\n\trd(n);\n\tfor (int i = 1; i <= n; i++) a[i].in(), b[i].in(), c[i] = a[i] * b[i];\n\tfor (int i = 1; i <= n; i++) if (pd(a[i])) return a[i].out(), 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tif (c[i].p.size() != c[1].p.size()) Fail;\n\t\tfor (ui j = 0; j < c[1].p.size(); j++)\n\t\t\tif (c[i].p[j].fi != c[1].p[j].fi) Fail;\n\t\ta[i] = c[i] & b[i], b[i] = c[i] & a[i];\n\t}\n\tA = a[1], B = b[1];\n\tfor (int i = 2; i <= n; i++)\n\t\tif (!merge(i)) {\n\t\t\tif (pd(A)) return A.out(), 0;\n\t\t\tFail;\n\t\t}\n\tA.out();\n\treturn 0;\n}\n```",
        "postTime": 1582043106,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF571E \u3010Geometric Progressions\u3011"
    },
    {
        "content": "[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/571/problem/E) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF571E)\n\nu1s1 \u611f\u89c9\u6b64\u9898\u601d\u7ef4\u96be\u5ea6\u4e0d\u592a\u5927\uff0c\u4e0d\u8fc7\u5927\u6982\u662f\u7ec6\u8282\u591a\u5f97\u5230\u4e86\u7cbe\u795e\u6c61\u67d3\u7684\u5730\u6b65\u6240\u4ee5\u624d\u653e\u5230 D1E \u7684\u7f62\uff08\uff08\uff08\n\n\u9996\u5148\u6211\u4eec\u5bf9\u6240\u6709 $a_i,b_i$ \u5206\u89e3\u8d28\u56e0\u6570\u5e76\u5c06\u5b83\u4eec\u5168\u90e8\u8d28\u56e0\u5b50\u62ce\u51fa\u6765\u7f16\u4e2a\u53f7 $1,2,3,\\cdots,m$\u2014\u2014\u8fd9\u6837\u7684\u8d28\u56e0\u5b50\u4e2a\u6570\u80af\u5b9a\u4e0d\u4f1a\u8d85\u8fc7 $2n\\omega(a_i)$\u3002\u6211\u4eec\u8bb0 $ap_{i,j}$ \u8868\u793a $a_i$ \u4e2d\u6807\u53f7\u4e3a $j$ \u7684\u8d28\u56e0\u5b50\u51fa\u73b0\u7684\u6b21\u6570\uff0c$bp_{i,j}$ \u8868\u793a $b_i$ \u4e2d\u6807\u53f7\u4e3a $j$ \u7684\u8d28\u56e0\u5b50\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u90a3\u4e48\u672c\u9898\u7b49\u4ef7\u4e8e\u627e\u51fa\u4e24\u4e2a\u5e8f\u5217 $k_1,k_2,\\cdots,k_n$ \u548c $X_{1},X_2,\\cdots,X_m$\u4f7f\u5f97\u5bf9\u4e8e\u4efb\u610f\u8d28\u56e0\u5b50 $j$ \u90fd\u6709 $ap_{1,j}+k_1bp_{1,j}=ap_{2,j}+k_2bp_{2,j}=\\cdots=ap_{n,j}+k_nbp_{n,j}=X_j$\uff0c$k_i$ \u8868\u793a\u6700\u7ec8\u7684\u7b54\u6848 $=a_ib_i^{k_i}$\uff0c$X_i$ \u8868\u793a\u5728\u6700\u7ec8\u7b54\u6848\u7684\u8d28\u56e0\u6570\u5206\u89e3\u5f0f\u4e2d\u7f16\u53f7\u4e3a $i$ \u7684\u8d28\u56e0\u5b50\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u8003\u8651\u5bf9\u8d28\u56e0\u5b50\u5206\u5f00\u6765\u8003\u8651\uff0c\u5bf9\u4e8e\u67d0\u4e2a\u8d28\u56e0\u5b50 $j$\uff0c\u5982\u679c $\\exists i$ \u4f7f\u5f97 $bp_{i,j}=0$\uff0c\u90a3\u4e48\u610f\u5473\u7740 $X_j$ \u53ea\u80fd\u7b49\u4e8e $ap_{i,j}$\uff0c\u6b64\u65f6\u6211\u4eec\u68c0\u67e5\u662f\u5426 $\\exists l\\ne i$ \u6ee1\u8db3 $bp_{l,j}>0$\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u6211\u4eec\u53ea\u9700\u68c0\u9a8c\u662f\u5426\u6240\u6709 $ap_{l,j}$ \u90fd\u7b49\u4e8e $ap_{i,j}$\uff0c\u5982\u679c\u662f\u90a3\u4e48\u7b54\u6848\u4e58\u4e0a $p_j^{X_j}$ \u5e76\u5ffd\u7565\u8fd9\u4e2a\u65b9\u7a0b\uff0c\u5426\u5219\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u4e00\u5143\u4e00\u6b21\u65b9\u7a0b $ap_{l,j}+k_lbp_{l,j}=ap_{i,j}$\uff0c\u5982\u679c $ap_{i,j}<ap_{l,j}$ \u6216 $ap_{i,j}-ap_{l,j}$ \u4e0d\u662f $bp_{l,j}$ \u7684\u500d\u6570\u90a3\u5c31\u65e0\u89e3\uff0c\u5426\u5219\u89e3\u51fa $k_l$ \u4e4b\u540e\u5c31\u53ef\u4ee5\u89e3\u51fa\u6240\u6709 $X_j$\uff0c\u89e3\u51fa $X_j$ \u4e4b\u540e\u518d\u5e26\u56de\u53bb\u6c42\u51fa\u5176\u4ed6\u7684 $k_i$\uff0c\u89e3\u5b8c\u4e4b\u540e\u518d\u4ee3\u56de\u53bb\u770b\u770b\u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u4e0d\u5408\u6cd5\u5219 $-1$\uff0c\u5408\u6cd5\u5c31\u76f4\u63a5\u8f93\u51fa $\\prod p_j^{X_j}$ \u7136\u540e\u9000\u51fa\u5373\u53ef\u3002\n\n\u5904\u7406\u5b8c $\\exists bp_{i,j}=0$ \u7684\u8d28\u56e0\u5b50\u4e4b\u540e\u6211\u4eec\u9ed8\u8ba4\u5176\u4f59\u7684 $bp_{i,j}$ \u90fd\u4e0d\u7b49\u4e8e $0$\uff0c\u6211\u4eec\u4e0d\u59a8\u5047\u8bbe $1$ \u53f7\u8d28\u56e0\u5b50\u6ee1\u8db3 $\\forall i,bp_{i,1}\\ne 0$\uff0c\u90a3\u4e48\u663e\u7136\u6709 $\\forall i,ap_{1,1}+k_1bp_{1,1}=ap_{i,1}+k_ibp_{i,1}$\uff0c\u6211\u4eec\u5c06 $k_1,k_i$ \u5f53\u4f5c\u4e24\u4e2a\u53d8\u91cf\uff0c\u5176\u4f59\u5f53\u4f5c\u5e38\u6570\uff0c\u53ef\u5f97\u65b9\u7a0b $k_1bp_{1,1}-k_ibp_{i,1}=ap_{i,1}-ap_{1,1}$\uff0c\u6211\u4eec\u8003\u8651\u53e6\u5916\u679a\u4e3e\u4e00\u4e2a\u6ee1\u8db3 $\\forall i,bp_{i,j}\\ne 0$ \u7684\u8d28\u56e0\u5b50 $j$\uff0c\u90a3\u4e48\u4e5f\u53ef\u5f97\u7c7b\u4f3c\u7684\u65b9\u7a0b $k_1bp_{1,j}-k_ibp_{i,j}=ap_{i,j}-ap_{1,j}$\uff0c\u5982\u679c\u8be5\u65b9\u7a0b\u6ee1\u8db3 $\\dfrac{bp_{1,1}}{bp_{1,j}}=\\dfrac{bp_{i,1}}{bp_{i,j}}=\\dfrac{ap_{i,1}-ap_{1,1}}{ap_{i,j}-ap_{1,j}}$ \u5219\u8be5\u65b9\u7a0b\u4e0e\u7b2c\u4e00\u4e2a\u65b9\u7a0b\u662f\u7b49\u4ef7\u7684\u53ef\u4ee5\u5ffd\u7565\uff0c\u5426\u5219\u6211\u4eec\u5c31\u66b4\u529b\u89e3\u51fa $k_1,k_i$ \u5e76\u5e26\u56de\u53bb\u6c42\u51fa\u6240\u6709\u7684 $X_i$\uff0c\u518d\u6c42\u51fa\u522b\u7684 $k_i$ \u5373\u53ef\u3002\u5426\u5219\u6211\u4eec\u6839\u636e $ap_{1,1}+k_1bp_{1,1}=ap_{2,1}+k_2bp_{2,1}=\\cdots=ap_{n,1}+k_nbp_{n,1}=X_1$ \u53ef\u4ee5\u5f97\u5230 $n$ \u4e2a\u5f62\u5982 $X_1\\equiv ap_{i,1}\\pmod{bp_{i,1}}$ \u7684\u540c\u4f59\u65b9\u7a0b\u7ec4\uff0cexCRT \u5408\u5e76\u5373\u53ef\uff0c\u6700\u540e\u53ef\u4ee5\u5f97\u5230\u5f62\u5982 $X_1\\equiv A\\pmod{B}$ \u7684\u5f0f\u5b50\uff0c\u8bb0 $mx=\\max\\limits_{i=1}^nap_{i,1}$\uff0c\u5f53\u7136\u6709\u53ef\u80fd\u8fd9\u91cc $A<mx$\uff0c\u90a3\u4e48\u5c31\u4f1a\u5b58\u5728 $k_i$ \u662f\u8d1f\u6570\u7684\u60c5\u51b5\uff0c\u8fd9\u662f\u4e0d\u5408\u6cd5\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u4ee4 $A$ \u4e0d\u65ad\u52a0\u4e0a $B$ \u76f4\u5230 $A\\ge mx$\uff0c\u6700\u540e\u6211\u4eec\u5e0c\u671b\u627e\u5230\u7684\u6700\u5c0f\u7684 $X_1$ \u5c31\u662f $A$\uff0c\u89e3\u51fa $X_1$ \u540e\u5c31\u53ef\u4ee5\u6c42\u51fa $k_i$\uff0c\u4e5f\u5c31\u53ef\u4ee5\u6c42\u51fa\u522b\u7684 $X_j$ \u4e86\u3002\n\nu1s1 \u8fd9\u9898\u771f\u662f\u7cbe\u795e\u6c61\u67d3\uff0c\u5199\u4e86\u6211 3h\u2026\u2026\n\n```cpp\nconst int MAXN=100;\nconst int MAXP=1200;\nconst int MOD=1e9+7;\nvoid exgcd(ll a,ll b,ll &x,ll &y){\n\tif(!b){x=1;y=0;return;} exgcd(b,a%b,y,x);y-=(a/b)*x;\n}\nint qpow(int x,ll e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint n,m,a[MAXN+5],b[MAXN+5],p[MAXP+5];\nbool vis[MAXN+5];\nvoid getpri(int x){\n\tfor(int i=2;i*i<=x;i++) if(x%i==0){\n\t\tp[++m]=i;while(x%i==0) x/=i;\n\t} if(x>1) p[++m]=x;\n}\nint ap[MAXN+5][MAXP+5],bp[MAXN+5][MAXP+5],ans=1;\nll ans1[MAXP+5],ans2[MAXN+5];\nvoid calc(int x){\n\tint tmpa=a[x],tmpb=b[x];\n\tfor(int i=1;i<=m;i++){\n\t\twhile(tmpa%p[i]==0) tmpa/=p[i],ap[x][i]++;\n\t\twhile(tmpb%p[i]==0) tmpb/=p[i],bp[x][i]++;\n\t}\n}\nvoid solve(int a1,int b1,int c1,int a2,int b2,int c2){\n//\tdebug(20060729);\n//\tprintf(\"%dx+%dy=%d\\n%dx+%dy=%d\\n\",a1,b1,c1,a2,b2,c2);\n\tint lcm=a1/__gcd(a1,a2)*a2;\n\tint mul1=lcm/a1,mul2=lcm/a2;\n\tb1*=mul1;c1*=mul1;b2*=mul2;c2*=mul2;\n\tif((c1-c2)%(b1-b2)) puts(\"-1\"),exit(0);\n\tint x,y;y=(c1-c2)/(b1-b2);\n\tb1/=mul1;c1/=mul1;b2/=mul2;c2/=mul2;\n\tint rem=c1-b1*y;if(rem%a1) puts(\"-1\"),exit(0);\n\tx=rem/a1;if(x<0||y<0) puts(\"-1\"),exit(0);\n//\tprintf(\"%d %d\\n\",x,y);\n\tfor(int i=1;i<=m;i++) ans1[i]=ap[1][i]+x*bp[1][i];\n//\tfor(int i=1;i<=m;i++) printf(\"%d^%lld\\n\",p[i],ans1[i]);\n\tmemset(ans2,-1,sizeof(ans2));\n\tfor(int j=1;j<=n;j++){\n\t\tfor(int k=1;k<=m;k++){\n\t\t\tif(vis[k]) continue;\n\t\t\tif(!bp[j][k]){\n\t\t\t\tif(ap[j][k]!=ans1[k]) return puts(\"-1\"),void();\n\t\t\t} else {\n\t\t\t\tif(ap[j][k]>ans1[k]||(ans1[k]-ap[j][k])%bp[j][k]) return puts(\"-1\"),void();\n\t\t\t\telse if(~ans2[j]&&(ans1[k]-ap[j][k])/bp[j][k]!=ans2[j]) return puts(\"-1\"),void();\n\t\t\t\telse ans2[j]=(ans1[k]-ap[j][k])/bp[j][k];\n\t\t\t}\n\t\t}\n\t}\n\tfor(int j=1;j<=m;j++) if(!vis[j])\n\t\tans=1ll*ans*qpow(p[j],ans1[j])%MOD;\n\tprintf(\"%d\\n\",ans);\n}\nbool combine(ll &a1,ll &m1,ll a2,ll m2){\n//\tprintf(\"%lld %lld %lld %lld\\n\",a1,m1,a2,m2);\n\tll k1,k2,g=__gcd(m1,m2);exgcd(m1,m2,k1,k2);\n\tif((a2-a1)%g) return 0;ll t=((a2-a1)/g*k1%m2+m2)%m2;\n\treturn a1+=t*m1%(m1/g*m2),m1*=m2/g,a1=(a1%m1+m1)%m1,1;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%d%d\",&a[i],&b[i]);\n\tfor(int i=1;i<=n;i++) getpri(a[i]),getpri(b[i]);\n\tsort(p+1,p+m+1);m=unique(p+1,p+m+1)-p-1;\n\tfor(int i=1;i<=n;i++) calc(i);\n\tfor(int i=1;i<=m;i++){\n\t\tint pos0=0,pos1=0;\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tif(!bp[j][i]) pos0=j;\n\t\t\telse pos1=j;\n\t\t}\n\t\tif(pos0){\n//\t\t\tprintf(\"%d\\n\",i);\n\t\t\tif(!pos1){\n\t\t\t\tfor(int j=1;j<=n;j++) if(ap[j][i]!=ap[1][i])\n\t\t\t\t\treturn puts(\"-1\"),0;\n\t\t\t\tans=1ll*ans*qpow(p[i],ap[1][i])%MOD;vis[i]=1;\n\t\t\t} else {\n\t\t\t\tif(ap[pos0][i]<ap[pos1][i]) return puts(\"-1\"),0;\n\t\t\t\tif((ap[pos0][i]-ap[pos1][i])%bp[pos1][i]) return puts(\"-1\"),0;\n\t\t\t\tint cc=(ap[pos0][i]-ap[pos1][i])/bp[pos1][i];\n//\t\t\t\tprintf(\"%d %d %d\\n\",pos0,pos1,cc);\n\t\t\t\tfor(int j=1;j<=m;j++) ans1[j]=1ll*bp[pos1][j]*cc+ap[pos1][j];\n\t\t\t\tmemset(ans2,-1,sizeof(ans2));\n\t\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\t\tfor(int k=1;k<=m;k++){\n\t\t\t\t\t\tif(vis[k]) continue;\n\t\t\t\t\t\tif(!bp[j][k]){\n\t\t\t\t\t\t\tif(ap[j][k]!=ans1[k]) return puts(\"-1\"),0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(ap[j][k]>ans1[k]||(ans1[k]-ap[j][k])%bp[j][k]) return puts(\"-1\"),0;\n\t\t\t\t\t\t\telse if(~ans2[j]&&(ans1[k]-ap[j][k])/bp[j][k]!=ans2[j]) return puts(\"-1\"),0;\n\t\t\t\t\t\t\telse ans2[j]=(ans1[k]-ap[j][k])/bp[j][k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int j=1;j<=m;j++) if(!vis[j])\n\t\t\t\t\tans=1ll*ans*qpow(p[j],ans1[j])%MOD;\n\t\t\t\tprintf(\"%d\\n\",ans);return 0;\n\t\t\t}\n\t\t}\n\t} int pos=1;while(vis[pos]) pos++;\n\tif(pos==m+1) return printf(\"%d\\n\",ans),0;\n\tfor(int i=1;i<=n;i++) swap(ap[i][pos],ap[i][1]),swap(bp[i][pos],bp[i][1]);\n\tswap(vis[pos],vis[1]);swap(p[pos],p[1]);debug(1);\n//\tprintf(\"%d\\n\",pos);\n\tfor(int j=2;j<=m;j++) if(!vis[j]){\n\t\tfor(int i=2;i<=n;i++){\n\t\t\tif(bp[1][1]*bp[i][j]!=bp[1][j]*bp[i][1]){\n\t\t\t\tsolve(bp[1][1],-bp[i][1],ap[i][1]-ap[1][1],\n\t\t\t\tbp[1][j],-bp[i][j],ap[i][j]-ap[1][j]);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t} //debug(20060617);\n\tll A=ap[1][1]%bp[1][1],M=bp[1][1],mx=ap[1][1];\n//\tdebug(114514);\n\tfor(int i=2;i<=n;i++){\n\t\tif(!combine(A,M,ap[i][1]%bp[i][1],bp[i][1]))\n\t\t\treturn puts(\"-1\"),0;\n\t\tchkmax(mx,ap[i][1]);\n\t} //debug(20210406);\n\tif(A<mx) A+=(mx-A+M-1)/M*M;\n\tll cc=(A-ap[1][1])/bp[1][1];\n\tfor(int i=1;i<=m;i++) ans1[i]=ap[1][i]+cc*bp[1][i];\n//\tfor(int i=1;i<=m;i++) printf(\"%d^%lld\\n\",p[i],ans1[i]);\n\tmemset(ans2,-1,sizeof(ans2));\n\tfor(int j=1;j<=n;j++){\n\t\tfor(int k=1;k<=m;k++){\n\t\t\tif(vis[k]) continue;\n\t\t\tif(!bp[j][k]){\n\t\t\t\tif(ap[j][k]!=ans1[k]) return puts(\"-1\"),0;\n\t\t\t} else {\n\t\t\t\tif(ap[j][k]>ans1[k]||(ans1[k]-ap[j][k])%bp[j][k]) return puts(\"-1\"),0;\n\t\t\t\telse if(~ans2[j]&&(ans1[k]-ap[j][k])/bp[j][k]!=ans2[j]) return puts(\"-1\"),0;\n\t\t\t\telse ans2[j]=(ans1[k]-ap[j][k])/bp[j][k];\n\t\t\t}\n\t\t}\n\t}\n\tfor(int j=1;j<=m;j++) if(!vis[j])\n\t\tans=1ll*ans*qpow(p[j],ans1[j])%MOD;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1617894580,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF571E Geometric Progressions"
    }
]