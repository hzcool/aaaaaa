[
    {
        "content": "## \u524d\u8a00\n\n[\u9898\u76ee\u4f20\u9001\u95e8\uff01](https://www.luogu.com.cn/problem/CF1182E)\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1f](https://www.cnblogs.com/liangbowen/p/16974079.html)\n\n$\\texttt{z\\color{red}ltqwq}$ ![](https://rin.kagamine.xyz:16300/gou.php?color=f1c40f) \u63a8\u8350\u77e9\u9635\u52a0\u901f\u9898\u76ee\u3002\u5176\u5b9e\u5f88\u4e0d\u7b97\u96be\u554a\uff0c\u4e0d\u5c31\u662f\u6a21\u62df\u5417\u3002\n\n## \u601d\u8def\n\n\u9996\u5148\u4e58\u6cd5\u662f\u4e0d\u80fd\u7528\u77e9\u9635\u52a0\u901f\u76f4\u63a5\u7ef4\u62a4\u7684\uff0c\u8003\u8651\u7b54\u6848\u4e3a $f_n = c^{k_1} \\times f_1^{k_2} \\times f_2^{k_3} \\times f_3^{k_4}$\u3002\n\n\u8fd9\u4e9b\u90fd\u662f\u53ef\u4ee5\u8f6c\u79fb\u7684\u3002\n\n\u5bf9\u4e8e $c$ \u7684**\u6307\u6570**\u7684\u8f6c\u79fb\uff1a$\\begin{pmatrix}t_{i-2}, t_{i-1}, t_i, 2i-6, 1\\end{pmatrix}$ \u5206\u522b\u8868\u793a\u6700\u8fd1\u7684\u4e09\u9879\uff08$f_{i-2}, f_{i-1}, f_i$\uff09\u7684 $c$ \u7684\u6307\u6570\u3001\u4ee5\u53ca\u4e00\u4e9b\u5e38\u6570\u3002\n\n$$f_{i+1} = c^{2i - 6} \\times f_i \\times f_{i-1} \\times f_{i-2}$$\n\n$\\therefore$ \u5bf9\u5e94\u7684\u6307\u6570 $k_{i+1} = 2\\cdot(i + 1) - 6 + k_i + k_{i-1} + k_{i-2}$\u3002\n\n\u77e9\u9635\u8f6c\u79fb\uff1a\n\n$$\n\\begin{pmatrix}\nk_{i-2} & k_{i-1} & k_i & 2i-6 & 1\n\\end{pmatrix}\n\n\\times\n\n\\begin{pmatrix}\n0 & 0 & 1 & 0 & 0 \\\\\n1 & 0 & 1 & 0 & 0 \\\\\n0 & 1 & 1 & 0 & 0 \\\\\n0 & 0 & 1 & 1 & 0 \\\\\n0 & 0 & 2 & 2 & 1 \\\\\n\\end{pmatrix}\n\n=\n\n\\begin{pmatrix}\nk_{i-1} & k_i & k_{i+1} & 2\\cdot(i+1)-6 & 1\n\\end{pmatrix}\n$$\n\n---\n\n\u5bf9\u4e8e $f_1$ \u7684**\u6307\u6570**\u7684\u8f6c\u79fb\uff1a$\\{t_{i-2}, t_{i-1}, t_i\\}$ \u5206\u522b\u8868\u793a\u6700\u8fd1\u7684\u4e09\u9879\uff08$f_{i-2}, f_{i-1}, f_i$\uff09\u7684 $f_1$ \u7684\u6307\u6570\u3002\n\n$$f_{i+1} = c^{2i - 6} \\times f_i \\times f_{i-1} \\times f_{i-2}$$\n\n$\\therefore$ \u5bf9\u5e94\u7684\u6307\u6570 $k_{i+1} = k_i + k_{i-1} + k_{i-2}$\u3002\n\n\u77e9\u9635\u8f6c\u79fb\uff1a\n\n$$\n\\begin{pmatrix}\nk_{i-2} & k_{i-1} & k_i\n\\end{pmatrix}\n\n=\n\n\\begin{pmatrix}\n0 & 0 & 1 \\\\\n1 & 0 & 1 \\\\\n0 & 1 & 1\n\\end{pmatrix}\n\n\\times\n\n\\begin{pmatrix}\nk_{i-1} & k_i & k_{i+1}\n\\end{pmatrix}\n$$\n\n---\n\n\u5bf9\u4e8e $f_2$ \u4e0e $f_3$ \u7684\u6307\u6570\u8f6c\u79fb\uff0c\u77e9\u9635\u8f6c\u79fb\u662f\u4e0e $f_1$ \u7684\u76f8\u540c\u7684\u3002\n\n\u4ec5\u4ec5\u662f\u521d\u59cb\u5316\u4e0d\u540c\u3002\n\n---\n\n\u4e09\u8005\u5bf9\u5e94\u7684\u6307\u6570\u5c31\u662f\u7b2c $3$ \u9879\uff0c\u8fd9\u4e2a\u81ea\u5df1\u5bf9\u4e0a\u5373\u53ef\u3002\n\n\u6700\u540e\u518d\u4e0a\u5feb\u901f\u5e42\u5373\u53ef\u6c42\u51fa\u3002\n\n## \u4ee3\u7801\n\n\u4e0d\u559c\u6b22\u7528\u91cd\u8f7d\uff08\u6b21\u6b21\u8003\u573a\u90fd\u4e0d\u4f1a\u5199\u91cd\u8f7d\u683c\u5f0f\uff09\uff0c\u6240\u4ee5\u4ee3\u7801\u770b\u8d77\u6765\u4f1a\u5f88\u957f\u3002\n\n\u4ee3\u7801\u5176\u5b9e\u4e0d\u7528\u653e\u7684\uff0c\u6284\u4e00\u904d\u4e0a\u9762\u7684\u77e9\u9635\u5373\u53ef\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\nusing namespace std;\n\nconst int mod = 1e9 + 7;\ntypedef long long ll;\n\nnamespace martix_3 { //\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u61c2\u7684\u76f4\u63a5\u5ffd\u7565\u5373\u53ef\n    void mul(int ANS[][3], int x[][3], int y[][3])\n    {\n        int ans[3][3] = {};\n        for (int i = 0; i < 3; i++)\n            for (int j = 0; j < 3; j++)\n                for (int k = 0; k < 3; k++)\n                    ans[i][j] = (ans[i][j] + 1ll * x[i][k] * y[k][j]) % (mod - 1);\n        memcpy(ANS, ans, sizeof ans);\n    }\n    void ksm(int f[][3], int a[][3], ll y)\n    {\n        while (y)\n        {\n            if (y & 1) mul(f, f, a);\n            mul(a, a, a);\n            y >>= 1;\n        }\n    }\n};\nnamespace martix_5 { //\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u61c2\u7684\u76f4\u63a5\u5ffd\u7565\u5373\u53ef\n    void mul(int ANS[][5], int x[][5], int y[][5])\n    {\n        int ans[5][5] = {};\n        for (int i = 0; i < 5; i++)\n            for (int j = 0; j < 5; j++)\n                for (int k = 0; k < 5; k++)\n                    ans[i][j] = (ans[i][j] + 1ll * x[i][k] * y[k][j]) % (mod - 1);\n        memcpy(ANS, ans, sizeof ans);\n    }\n    void ksm(int f[][5], int a[][5], ll y)\n    {\n        while (y)\n        {\n            if (y & 1) mul(f, f, a);\n            mul(a, a, a);\n            y >>= 1;\n        }\n    }\n};\nint qpow(int x, int y) //\u5feb\u901f\u5e42\uff0c\u61c2\u7684\u76f4\u63a5\u5ffd\u7565\u5373\u53ef\n{\n    int ans = 1;\n    while (y)\n    {\n        if (y & 1) ans = (1ll * ans * x) % mod;\n        x = (1ll * x * x) % mod;\n        y >>= 1;\n    }\n    return ans;\n}\nint main()\n{\n    ll n; int f1, f2, f3, c;\n    cin >> n >> f1 >> f2 >> f3 >> c;\n\n    int getc_f[5][5] = {0, 0, 0, 0, 1}; //i=3\uff0c\u7b97c\n    int getc_a[5][5] = {\n        0, 0, 1, 0, 0,\n        1, 0, 1, 0, 0, \n        0, 1, 1, 0, 0,\n        0, 0, 1, 1, 0,\n        0, 0, 2, 2, 1\n    };\n    martix_5::ksm(getc_f, getc_a, n - 3);\n    int c_k = getc_f[0][2];\n\n    int getf1_f[3][3] = {1, 0, 0}; //i=3\uff0c\u7b97f1\n    int getf1_a[3][3] = {\n        0, 0, 1, \n        1, 0, 1, \n        0, 1, 1\n    };\n    martix_3::ksm(getf1_f, getf1_a, n - 3);\n    int f1_k = getf1_f[0][2];\n\n    int getf2_f[3][3] = {0, 1, 0}; //i=3\uff0c\u7b97f2\n    int getf2_a[3][3] = {\n        0, 0, 1, \n        1, 0, 1, \n        0, 1, 1\n    };\n    martix_3::ksm(getf2_f, getf2_a, n - 3);\n    int f2_k = getf2_f[0][2];\n\n    int getf3_f[3][3] = {0, 0, 1}; //i=3\uff0c\u7b97f3\n    int getf3_a[3][3] = {\n        0, 0, 1, \n        1, 0, 1, \n        0, 1, 1\n    };\n    martix_3::ksm(getf3_f, getf3_a, n - 3);\n    int f3_k = getf3_f[0][2];\n\n    //printf(\"f_n = c^%d * f1^%d * f2^%d * f3^%d\\n\", c_k, f1_k, f2_k, f3_k);\n    int ans = 1;\n    ans = 1ll * ans * qpow(c, c_k) % mod;\n    ans = 1ll * ans * qpow(f1, f1_k) % mod;\n    ans = 1ll * ans * qpow(f2, f2_k) % mod;\n    ans = 1ll * ans * qpow(f3, f3_k) % mod;\n    cout << ans;\n    return 0;\n}\n```\n\n\u5e0c\u671b\u80fd\u5e2e\u52a9\u5230\u5927\u5bb6\uff01",
        "postTime": 1670754505,
        "uid": 367488,
        "name": "liangbowen",
        "ccfLevel": 0,
        "title": "CF1182E \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a\u4e94\u4e2a\u6574\u6570 $n,f_1,f_2,f_3,c$\uff0c\u5176\u4e2d\u6570\u5217 $f$ \u6ee1\u8db3\u4ee5\u4e0b\u9012\u63a8\u5f0f\uff1a\n\n$$f_x=c^{2x-6}f_{x-1}f_{x-2}f_{x-3}$$\n\n\u6c42 $f_n$\u3002\n\n$\\texttt{Data Range:}4\\leq n\\leq 10^{18},1\\leq f_1,f_2,f_3,c\\leq 10^9$\n\n### \u9898\u89e3\n\n[\u4e0d\u4e00\u5b9a\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Karry5307/p/13800860.html)\n\n\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u9996\u5148\u8fd9\u4e2a\u4e58\u8d77\u6765\u7684\u4e1c\u897f\u663e\u7136\u6ca1\u6709\u4ec0\u4e48\u65b9\u6cd5\u53bb\u9012\u63a8\uff0c\u7136\u800c\u4ece\u9012\u63a8\u5f0f\u4e2d\u53ef\u4ee5\u76f4\u63a5\u770b\u51fa $f_n$ \u662f\u7c7b\u4f3c\u4e8e $c^gf_1^{i}f_2^{j}f_3^{k}$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u8003\u8651\u628a\u6bcf\u4e2a\u6b21\u6570\u7b97\u51fa\u6765\u7136\u540e\u5feb\u901f\u5e42\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u6b21\u6570\u5f88\u597d\u7b97\u7684\u3002\u8bbe $f_n$ \u4e2d $c$ \u7684\u6b21\u6570\u4e3a $g_n$\uff0c\u90a3\u4e48\u663e\u7136\u6709\u9012\u63a8\u5f0f\n\n$$g_n=2n-6+g_{n-1}+g_{n-2}+g_{n-3}=2(n-1)-4+g_{n-1}+g_{n-2}+g_{n-3}$$\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u4e1c\u897f\u662f\u5e38\u89c1\u7684\u975e\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u6a21\u6837\uff0c\u4e8e\u662f\u53ef\u4ee5\u9ad8\u9ad8\u5174\u5174\u7684\u8d70\u4e00\u6ce2\u77e9\u9635\uff1a\n\n$$\\begin{pmatrix}g_n\\\\g_{n-1}\\\\g_{n-2}\\\\n\\\\1\\end{pmatrix}=\\begin{pmatrix}1&1&1&2&-4\\\\1&0&0&0&0\\\\0&1&0&0&0\\\\0&0&0&1&1\\\\0&0&0&0&1\\end{pmatrix}\\begin{pmatrix}g_{n-1}\\\\g_{n-2}\\\\g_{n-3}\\\\n-1\\\\1\\end{pmatrix}$$\n\n\u7136\u540e\u8003\u8651\u9012\u63a8 $f_1,f_2,f_3$ \u7684\u6b21\u6570\u3002\u4ee5 $f_1$ \u4e3a\u4f8b\uff0c\u8bbe $f_n$ \u4e2d $f_1$ \u7684\u6b21\u6570\u4e3a $h_n$\uff0c\u90a3\u4e48\u6709\n\n$$h_n=h_{n-1}+h_{n-2}+h_{n-3}$$\n\n\u8fd9\u4e2a\u8f6c\u79fb\u77e9\u9635\u633a\u597d\u5199\u7684\uff0c\u4e5f\u5c31\u662f\uff1a\n\n$$\\begin{pmatrix}h_n\\\\h_{n-1}\\\\h_{n-2}\\end{pmatrix}=\\begin{pmatrix}1&1&1\\\\1&0&0\\\\0&1&0\\end{pmatrix}\\begin{pmatrix}h_{n-1}\\\\h_{n-2}\\\\h_{n-3}\\end{pmatrix}$$\n\n\u540c\u65f6\u6ce8\u610f\u5230 $f_2$ \u548c $f_3$ \u6b21\u6570\u7684\u9012\u63a8\u5f0f\u4e5f\u662f\u8fd9\u4e2a\u4e1c\u897f\uff0c\u53ea\u4e0d\u8fc7 $h_1,h_2,h_3$ \u4e0d\u540c\u800c\u5df2\uff0c\u4e8e\u662f\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u9012\u63a8\u51fa\u6765\u4e86\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=2e5+51,MOD=1e9+7;\nstruct Matrix{\n\tll num[6][6];\n\tMatrix()\n\t{\n\t\tmemset(num,0,sizeof(num));\n\t}\n\tinline ll* operator [](const ll &x)\n\t{\n\t\treturn num[x];\n\t}\n\tinline const ll* operator [](const ll &x)const\n\t{\n\t\treturn num[x];\n\t}\n};\nMatrix mat,mat2,x,x2;\nll f1,f2,f3,c,res;\nli n;\ninline li read()\n{\n    register li num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n\tll res=1;\n\twhile(exponent)\n\t{\n\t\tif(exponent&1)\n\t\t{\n\t\t\tres=(li)res*base%MOD;\n\t\t}\n\t\tbase=(li)base*base%MOD,exponent>>=1;\n\t}\n\treturn res;\n}\ninline Matrix operator *(Matrix x,Matrix y)\n{\n\tMatrix res;\n\tfor(register int i=1;i<=5;i++)\n\t{\n\t\tfor(register int j=1;j<=5;j++)\n\t\t{\n\t\t\tfor(register int k=1;k<=5;k++)\n\t\t\t{\n\t\t\t\tres[i][j]=(res[i][j]+(li)x[i][k]*y[k][j]%(MOD-1))%(MOD-1);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n}\ninline Matrix qpow(Matrix base,li exponent)\n{\n\tMatrix res;\n\tfor(register int i=1;i<=5;i++)\n\t{\n\t\tres[i][i]=1;\n\t}\n\twhile(exponent)\n\t{\n\t\tif(exponent&1)\n\t\t{\n\t\t\tres=res*base;\n\t\t}\n\t\tbase=base*base,exponent>>=1;\n\t}\n\treturn res;\n}\nint main()\n{\n\tn=read(),f1=read(),f2=read(),f3=read(),c=read(),res=1;\n\tmat[1][1]=mat[2][1]=mat[3][1]=mat[1][2]=mat[2][3]=mat[4][4]=mat[5][4]=1;\n\tmat[5][5]=x[1][5]=mat2[1][1]=1,mat[4][1]=2,mat[5][1]=MOD-5,x[1][4]=3;\n\tmat2[2][1]=mat2[3][1]=mat2[1][2]=mat2[2][3]=x2[1][3]=1;\n\tres=qpow(c,(x*qpow(mat,n-3))[1][1]);\n\tres=(li)res*qpow(f1,(x2*qpow(mat2,n-3))[1][1])%MOD,x2[1][3]=0,x2[1][2]=1;\n\tres=(li)res*qpow(f2,(x2*qpow(mat2,n-3))[1][1])%MOD,x2[1][2]=0,x2[1][1]=1;\n\tres=(li)res*qpow(f3,(x2*qpow(mat2,n-3))[1][1])%MOD,printf(\"%d\\n\",res);\n}\n```",
        "postTime": 1602464568,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "## Description\n\n\u5f53 $x \\geq 4$ \u65f6\uff0c$f_x = c^{2x - 6} \\cdot f_{x - 1} \\cdot f_{x - 2} \\cdot f_{x - 3}$ \u3002\n\n\u73b0\u5728\u5df2\u77e5 $n,f_1,f_2,f_3,c$ \u7684\u503c\uff0c\u6c42 $f_n$ \u7684\u503c\uff0c\u5bf9 $10^9 + 7$ \u53d6\u6a21\u3002\n\n$(4 \\leq n \\leq 10^{18},1 \\leq f_1,f_2,f_3,c \\leq 10^9)$\n\n## Solution\n\n\u4e00\u9053\u6bd4\u8f83\u6709\u601d\u7ef4\u96be\u5ea6\u7684 **\u77e9\u9635\u52a0\u901f** \u3002\n\n\u4e00\u822c\u60c5\u51b5\u4e0b\u8f6c\u79fb\u90fd\u662f\u52a0\u6cd5\uff0c\u800c\u8fd9\u9053\u9898\u662f\u4e58\u6cd5\uff0c\u6240\u4ee5\u8003\u8651\u8f6c\u6362\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u5217\u4e3e\u51fa\u524d\u51e0\u4e2a\u6570\u3002\u540c\u5e95\u6570\u5e42\u76f8\u4e58\uff0c\u5e95\u6570\u4e0d\u53d8\uff0c\u6307\u6570\u76f8\u52a0\u3002\n\n$f_1 = c^0 \\cdot f_1^1 \\cdot f_2^0 \\cdot f_3^0$\n\n$f_2 = c^0 \\cdot f_1^0 \\cdot f_2^1 \\cdot f_3^0$\n\n$f_3 = c^0 \\cdot f_1^0 \\cdot f_2^0 \\cdot f_3^1$\n\n$f_4 = c^2 \\cdot f_1^1 \\cdot f_2^1 \\cdot f_3^1$\n\n$f_5 = c^6 \\cdot f_1^1 \\cdot f_2^2 \\cdot f_3^2$\n\n$f_6 = c^{14} \\cdot f_1^2 \\cdot f_2^3 \\cdot f_3^4$\n\n$f_7 = c^{30} \\cdot f_1^4 \\cdot f_2^6 \\cdot f_3^7$\n\n$\\cdots\\cdots$\n\n\u4e0d\u96be\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $f_i$\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u8868\u793a\u4e3a\n\n$$f_i = c^{w_i} \\cdot f_{1}^{x_i} \\cdot f_{2}^{y_i} \\cdot f_{3}^{z_i}$$\n\n$w_i,x_i,y_i,z_i$ \u7684\u9012\u63a8\u65b9\u7a0b\u4e5f\u53ef\u4ee5\u5199\u51fa\u3002\n\n$w_i = w_{i - 1} + w_{i - 2} + w_{i - 3} + 2i - 6$\n\n$x_i = x_{i - 1} + x_{i - 2} + x_{i - 3}$\n\n$y_i = y_{i - 1} + y_{i - 2} + y_{i - 3}$\n\n$z_i = z_{i - 1} + z_{i - 2} + z_{i - 3}$\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u7528 **\u77e9\u9635\u52a0\u901f** \u5206\u522b\u6c42\u51fa $4$ \u4e2a\u6307\u6570 $w_n,x_n,y_n,z_n$ \u7684\u503c\uff0c\u518d\u7528\u5feb\u901f\u5e42\u6c42\u5f97 $f_n$ \u3002\n\n\u5bf9\u4e8e $x,y,z$ \u6570\u7ec4\uff0c\u56e0\u4e3a\u8f6c\u79fb\u65b9\u7a0b\u76f8\u540c\uff0c\u6240\u4ee5\u8f6c\u79fb\u77e9\u9635\u4e5f\u76f8\u540c\u3002\u8fd9\u91cc\u4ee5 $x$ \u4e3a\u4f8b\u3002\n\n$$\\begin{bmatrix}1&1&1\\\\1&0&0\\\\0&1&0\\end{bmatrix}\\times \\begin{bmatrix}x_{i-1}\\\\x_{i-2}\\\\x_{i-3}\\end{bmatrix}=\\begin{bmatrix}x_i\\\\x_{i-1}\\\\x_{i-2}\\end{bmatrix}$$\n\n\u56e0\u4e3a $x_i = x_{i - 1} + x_{i - 2} + x_{i - 3}$\uff0c\u6240\u4ee5\u77e9\u9635\u7b2c\u4e00\u884c\u5168\u90e8\u662f $1$ \u3002$x_{i - 1},x_{i - 2}$ \u90fd\u53ef\u4ee5\u5728\u4e0a\u4e00\u4e2a\u77e9\u9635\u4e2d\u627e\u5230\uff0c\u5bf9\u5e94\u4f4d\u7f6e\u6807\u4e3a $1$ \u3002\n\n\u521d\u59cb\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}0\\\\0\\\\1\\end{bmatrix}=\\begin{bmatrix}x_3\\\\x_2\\\\x_1\\end{bmatrix}$$\n\n$$\\begin{bmatrix}0\\\\1\\\\0\\end{bmatrix}=\\begin{bmatrix}y_3\\\\y_2\\\\x_1\\end{bmatrix}$$\n\n$$\\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix}=\\begin{bmatrix}z_3\\\\z_2\\\\z_1\\end{bmatrix}$$\n\n\u901a\u8fc7 $f_1,f_2,f_3$ \u5f97\u5230\u3002\n\n\u7b54\u6848\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}1&1&1\\\\1&0&0\\\\0&1&0\\end{bmatrix}^{n - 3}\\times \\begin{bmatrix}x_{3}\\\\x_{2}\\\\x_{1}\\end{bmatrix}=\\begin{bmatrix}x_n\\\\x_{n-1}\\\\x_{n-2}\\end{bmatrix}$$\n\n$x_n,y_n,z_n$ \u90fd\u662f\u53d6\u77e9\u9635\u7b2c\u4e00\u884c\u7b2c\u4e00\u5217\u7684\u503c\u3002\n\n$w$ \u6570\u7ec4\u5c31\u7a0d\u5fae\u9ebb\u70e6\u4e00\u4e9b\u4e86\uff0c\u56e0\u4e3a\u591a\u4e86\u4e00\u9879 $2i - 6$ \u3002\n\n$$\\begin{bmatrix}1&1&1&1&1\\\\1&0&0&0&0\\\\0&1&0&0&0\\\\0&0&0&1&1\\\\0&0&0&0&1\\end{bmatrix}\\times \\begin{bmatrix}w_{i-1}\\\\w_{i-2}\\\\w_{i-3}\\\\2(i - 1) - 6\\\\2\\end{bmatrix}=\\begin{bmatrix}w_i\\\\w_{i-1}\\\\w_{i-2}\\\\2i - 6\\\\2\\end{bmatrix}$$\n\n\u56e0\u4e3a $w_i = w_{i - 1} + w_{i - 2} + w_{i - 3} + 2(i - 1) - 6 + 2$\uff0c\u6240\u4ee5\u7b2c\u4e00\u884c\u5168\u90e8\u662f $1$ \u3002$w_{i - 1},w_{i - 2}$ \u53ef\u4ee5\u5728\u4e0a\u4e00\u4e2a\u77e9\u9635\u4e2d\u627e\u5230\uff0c\u5bf9\u5e94\u4f4d\u7f6e\u6807\u4e3a $1$ \u3002$2i - 6 = 2(i - 1) - 6 + 2$\uff0c\u6240\u4ee5\u7b2c\u56db\u5217\u548c\u7b2c\u4e94\u5217\u4e3a $1$ \u3002\u5bf9\u4e8e $2 = 2$\uff0c\u628a\u7b2c\u4e94\u5217\u6807\u4e3a $1$ \u3002\n\n\u521d\u59cb\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\2\\end{bmatrix}=\\begin{bmatrix}w_3\\\\w_2\\\\w_1\\\\2 \\cdot 3 - 6 = 0\\\\2\\end{bmatrix}$$\n\n\u53ef\u4ee5\u76f4\u63a5\u5f97\u51fa\u3002\n\n\u7b54\u6848\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}1&1&1&1&1\\\\1&0&0&0&0\\\\0&1&0&0&0\\\\0&0&0&1&1\\\\0&0&0&0&1\\end{bmatrix}^{n - 3}\\times \\begin{bmatrix}w_3\\\\w_2\\\\w_1\\\\2 \\cdot 3 - 6 = 0\\\\2\\end{bmatrix}=\\begin{bmatrix}w_n\\\\w_{n-1}\\\\w_{n-2}\\\\2n - 6\\\\2\\end{bmatrix}$$\n\n$w_n$ \u4e5f\u540c\u6837\u53d6\u77e9\u9635\u7b2c\u4e00\u884c\u7b2c\u4e00\u5217\u7684\u503c\u3002\n\n\u6700\u540e\u7684\u7ed3\u679c\u8981\u5bf9 $10^9 + 7$ \u53d6\u6a21\uff0c\u4f46\u662f\u5728\u505a **\u77e9\u9635\u52a0\u901f** \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6307\u6570\u80af\u5b9a\u4e0d\u80fd\u76f4\u63a5\u5bf9\u5b83\u53d6\u6a21\u3002\u8fd9\u91cc\u8981\u7528\u5230 **\u6269\u5c55\u6b27\u62c9\u5b9a\u7406**\uff1a\n\n\u82e5 $a,p$ \u4e92\u8d28\uff0c\u5219\n\n$$a^b \\equiv a^{b \\bmod \\varphi(p)} \\pmod p$$\n\n\u56e0\u4e3a $p$ \u662f\u8d28\u6570\uff0c\u6240\u4ee5 $a,p$ \u4e00\u5b9a\u4e92\u8d28\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u6307\u6570\u5bf9 $\\varphi(p) = p - 1 = 10^9 + 6$ \u53d6\u6a21\uff0c\u5c31\u80fd\u8fbe\u5230\u964d\u5e42\u7684\u6548\u679c\u3002\n\n\u5206\u522b\u6c42\u51fa $w_n,x_n,y_n,z_n$\uff0c\u6700\u540e\u7528\u5feb\u901f\u5e42\u5408\u5e76\u7b54\u6848\u5f97\u5230 $f_n$ \u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log n)$ \u3002\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\n\ntemplate <class T>\ninline void read(T &x) {\n    x = 0;\n    char c = getchar();\n    bool f = 0;\n    for (; !isdigit(c); c = getchar()) f ^= c == '-';\n    for (; isdigit(c); c = getchar()) x = x * 10 + (c ^ 48);\n    x = f ? -x : x;\n}\n\ntemplate <class T>\ninline void write(T x) {\n    if (x < 0) {\n        putchar('-');\n        x = -x;\n    }\n    T y = 1;\n    int len = 1;\n    for (; y <= x / 10; y *= 10) ++len;\n    for (; len; --len, x %= y, y /= 10) putchar(x / y + 48);\n}\n\nconst LL MOD = 1e9 + 7, PHI = 1e9 + 6;\nLL n, f1, f2, f3, c, ans;\n\nstruct Matrix {\n    int size;\n    LL mat[6][6];\n    \n    Matrix(int x) {\n        size = x;\n        memset(mat, 0, sizeof (mat));\n    }\n    inline friend Matrix operator*(Matrix a, Matrix b) {//\u77e9\u9635\u4e58\u6cd5 \n        Matrix c(a.size);\n        for (int i = 1; i <= c.size; ++i)\n            for (int k = 1; k <= c.size; ++k)\n                for (int j = 1; j <= c.size; ++j)\n                    c.mat[i][j] = (c.mat[i][j] + a.mat[i][k] * b.mat[k][j]) % PHI;\n                    //\u8fd9\u91cc\u5bf9 \u03c6(p) \u53d6\u6a21 \n        return c;\n    }\n} baseA(3), x(3), y(3), z(3), baseB(5), w(5);\n\ninline LL quickPow(LL x, LL p) {//\u5feb\u901f\u5e42 \n    LL res = 1;\n    for (; p; p >>= 1, x = x * x % MOD)\n        if (p & 1) res = res * x % MOD;\n    return res;\n}\n\ninline Matrix quickPow(Matrix x, LL p) {//\u77e9\u9635\u5feb\u901f\u5e42 \n    Matrix res(x.size);\n    for (int i = 1; i <= res.size; ++i) res.mat[i][i] = 1;//\u5355\u4f4d\u77e9\u9635 \n    for (; p; p >>= 1, x = x * x)\n        if (p & 1) res = res * x;\n    return res;\n}\n\ninline void build() {//\u6784\u9020\u521d\u59cb\u77e9\u9635\u548c\u8f6c\u79fb\u77e9\u9635 \n    x.mat[3][1] = y.mat[2][1] = z.mat[1][1] = 1;\n    w.mat[5][1] = 2;\n    baseA.mat[1][1] = baseA.mat[1][2] = baseA.mat[1][3] = \n    baseA.mat[2][1] = baseA.mat[3][2] = 1;//baseA \u662f x,y,z \u7684\u8f6c\u79fb\u77e9\u9635 \n    for (int i = 1; i <= 5; ++i) baseB.mat[1][i] = 1;\n    baseB.mat[2][1] = baseB.mat[3][2] = baseB.mat[4][4] = \n    baseB.mat[4][5] = baseB.mat[5][5] = 1;//baseB \u662f w \u7684\u8f6c\u79fb\u77e9\u9635 \n}\n\nint main() {\n    read(n), read(f1), read(f2), read(f3), read(c);\n    build();\n    baseA = quickPow(baseA, n - 3), baseB = quickPow(baseB, n - 3);\n    w = baseB * w, x = baseA * x, y = baseA * y, z = baseA * z;\n    //\u6c42\u51fa\u56db\u4e2a\u7b54\u6848\u77e9\u9635\u540e\u5f97\u5230 w[n],x[n],y[n],z[n]\n    ans = quickPow(c, w.mat[1][1]) * quickPow(f1, x.mat[1][1]) % MOD * \n    quickPow(f2, y.mat[1][1]) % MOD * quickPow(f3, z.mat[1][1]) % MOD;\n    //\u5feb\u901f\u5e42\u5408\u5e76\u7b54\u6848 \n    write(ans);\n    putchar('\\n');\n    return 0;\n}\n```",
        "postTime": 1560400212,
        "uid": 32139,
        "name": "Heartlessly",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "\u770b\u5230\u9012\u63a8\u5f0f\u5f88\u5bb9\u6613\u8054\u60f3\u5230\u77e9\u9635\u52a0\u901f\uff0c\u4f46\u662f\u77e9\u9635\u65e0\u6cd5\u4fbf\u6377\u5730\u5904\u7406\u8fd9\u79cd\u9012\u63a8\u5f0f\u3002\u7531\u4e8e\u8be5\u9012\u63a8\u5f0f\u662f\u4e00\u4e9b\u6570\u7684\u4e58\u79ef\u7684\u5f62\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u6c42\u51fa\u6bcf\u4e00\u9879\u7684\u6307\u6570\n\n\u4ee4 $a_{i,\\ 1/2/3}$ \u8868\u793a $f_i$ \u7531\u591a\u5c11\u4e2a $f_{1/2/3}$ \u7684\u4e58\u79ef\u7ec4\u6210\uff0c\u53ef\u4ee5\u53d1\u73b0 $a_{i,\\ j}=a_{i-1,\\ j}+a_{i-2,\\ j}+a_{i-3,\\ j}$ \uff0c\u521d\u503c\u4e3a $a_{1,\\ 1}=a_{2,\\ 2}=a_{3,\\ 3}=1$ \uff0c\u53ef\u4ee5\u4f7f\u7528\u77e9\u9635\u52a0\u901f\n\n\u4ee4 $g_i$ \u4e3a $f_i$ \u7531\u591a\u5c11\u4e2a $c$ \u7684\u4e58\u79ef\u7ec4\u6210\uff0c\u9012\u63a8\u5f0f\u5373\u4e3a $g_i=g_{i-1}+g_{i-2}+g_{i-3}+2i-6$ \uff0c\u521d\u503c $g_i=0$ \uff0c\u53ef\u4ee5\u4f7f\u7528\u77e9\u9635\u52a0\u901f\uff0c\u6c42\u51fa\u7684\u77e9\u9635\u5373\u4e3a $\\begin{bmatrix}0&0&0&8&1\\end{bmatrix}\\times\\begin{bmatrix}1&1&0&0&0\\\\1&0&1&0&0\\\\1&0&0&0&0\\\\1&0&0&1&0\\\\-6&0&0&2&1\\end{bmatrix}^{n-3}$\n\n\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u8fd8\u539f\u7b54\u6848\uff0c\u4f46\u662f\u7531\u4e8e\u6307\u6570\u53ef\u80fd\u8fc7\u5927\uff0c\u56e0\u6b64\u5f97\u5c06\u6307\u6570 $\\operatorname{mod} \\varphi(10^9+7)=10^9+6$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log n)$\n\n\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\nconst int P = 1e9 + 7, mod = 1e9 + 6;\nll n;\n\n#define rep(i) for (int i = 0; i < 5; i++)\n\nstruct matrix {\n  int array[5][5];\n\n  inline void clr() {\n    memset(array, 0, sizeof array);\n  }\n\n  inline int* operator [] (int pos) {\n    return array[pos];\n  }\n} E, A, M;\n\ninline matrix operator * (matrix a, matrix b) {\n  static matrix s;\n  s.clr();\n  rep(i) rep(j) rep(k) s[i][j] = (s[i][j] + 1ll * a[i][k] * b[k][j]) % mod;\n  return s;\n}\n\ninline qp(int a, int k) {\n  int res = 1;\n  for (; k; k >>= 1, a = 1ll * a * a % P) {\n    if (k & 1) res = 1ll * res * a % P;\n  }\n  return res;\n}\n\ninline matrix qp(matrix a, ll k) {\n  matrix res = E;\n  for (; k; k >>= 1, a = a * a) {\n    if (k & 1) res = res * a;\n  }\n  return res;\n}\n\ninline int calc(int x) {\n  A.clr(), A[0][x] = 1;\n  return (A * qp(M, n - 3))[0][0];\n}\n\nint main() {\n  int c, f1, f2, f3;\n  scanf(\"%I64d %d %d %d %d\", &n, &f1, &f2, &f3, &c);\n  rep(i) E[i][i] = 1;\n  M[0][0] = M[0][1] = M[1][0] = M[2][0] = M[1][2] = 1;\n  int c1 = calc(2);\n  int c2 = calc(1);\n  int c3 = calc(0);\n  A.clr(), A[0][3] = 8, A[0][4] = 1;\n  M[4][3] = 2, M[4][0] = -6, M[3][0] = M[3][3] = M[4][4] = 1;\n  int cnt = (A * qp(M, n - 3))[0][0];\n  int ans = 1ll * qp(f1, c1) * qp(f2, c2) % P * qp(f3, c3) % P * qp(c, cnt) % P;\n  printf(\"%d\", ans);\n  return 0;\n}\n```",
        "postTime": 1560299807,
        "uid": 73934,
        "name": "Juanzhang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "# \u5199\u5728\u524d\u9762\n\n\u4e00\u53ea\u849f\u84bb\u6b63\u5728\u505a\u5b66\u6821\u4f5c\u4e1a\u3002\u5728\u88ab\u6781\u5176\u9700\u8981\u601d\u7ef4\u7684[\u7d2b\u9898](https://www.luogu.com.cn/problem/P3263)\u8650\u54ed\u4e4b\u540e\uff0c\u4ed6\u51e0\u4e4e\u5d29\u6e83\u3002\u4e0d\u8fc7\u4ed6\u53d1\u8a93\uff0c\u4ece\u90a3\u9898\u4e4b\u540e\u518d\u4e5f\u4e0d\u770b\u9898\u89e3\u4e86\uff0c\u4e8e\u662f\u505a\u4e86\u8fd9\u9053\u9898\u3002\u4e0d\u8fc7\u771f\u7684\u662f\u5e78\u8fd0\uff0c\u4ed6\u771f\u7684\u505a\u51fa\u6765\u4e86\uff01\n\n\u4e0a\u6b21\u72ec\u81ea\u4e00\u4eba\u505a\u51fa\u7d2b\u9898\u8fd8\u662f\u5728\u4e0a\u6b21\u3002\u5176\u5b9e\u8fd9\u9053\u9898\u7684\u9898\u89e3\u5df2\u7ecf\u5f88\u591a\u4e86\uff0c\u4e0d\u8fc7\u6211\u8fd8\u662f\u60f3\u5199\uff0c\u56e0\u4e3a\u6211\u592a\u5174\u594b\u4e86\u3002\u540c\u65f6\u953b\u70bc\u4e00\u4e0b\u6211\u7684 LaTeX \u80fd\u529b\u3002\n\n## \u524d\u7f6e\u77e5\u8bc6\n\n- \u77e9\u9635\n- \u8d39\u9a6c\u5c0f\u5b9a\u7406\n- \u5feb\u901f\u5e42\n\n## \u9898\u76ee\u63cf\u8ff0\uff08\u6233\u8fd9\u91cc[\u67e5\u770b\u539f\u9898](https://www.luogu.com.cn/problem/CF1182E)\uff09\n\n\u7ed9\u5b9a $n$\u3001$f_1$\u3001$f_2$\u3001$f_3$\u3001$c$\uff0c\u6ee1\u8db3\u901a\u9879 $f_x = c^{2x - 6}f_{x-1}f_{x-2}f_{x-3}$ \uff08$n \u2265 4$\uff09\uff0c\u6c42 $f_n$ \u7684\u503c\u3002\u7ed3\u679c\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n**\u6ce8\u610f $n$ \u53ef\u80fd\u5f88\u5927**\u3002\n\n# \u6b63\u6587\n\n## \u786e\u5b9a\u65b9\u5411\n\n\u9996\u5148\u4e00\u70b9\uff0c$n$ \u8fd9\u4e48\u5927\uff0c\u6839\u636e\u7ecf\u9a8c\u590d\u6742\u5ea6\u91cc\u8fd8\u4e00\u5b9a\u6709 $n$\uff0c\u5219\u4e00\u5b9a\u662f $\\log n$ \u6216 $\\sqrt n$ \u4e4b\u7c7b\u7684\u3002\u53c8\u6709\u9012\u63a8\u5f0f\uff0c\u5f88\u5bb9\u6613\u8054\u60f3\u5230\u77e9\u9635\u52a0\u901f\u9012\u63a8\u3002\n\n## \u5206\u6790\n\n\u8003\u8651\u77e9\u9635\u505a\u6cd5\u3002\u9996\u5148\u76f4\u63a5\u8bd5\u8bd5\u5efa\u7acb\u9012\u63a8\u5f0f\uff0c\u5bb9\u6613\u53d1\u73b0\u539f\u5f0f\u4e2d\u90fd\u662f\u4e58\u79ef\u3002\u7136\u800c\uff0c\u77e9\u9635\u6ee1\u8db3\u7684\u9012\u63a8\u662f\u57fa\u4e8e\u52a0\u6cd5\u7684\u3002\u53ef\u80fd\u6709\u540c\u5b66\u4f1a\u8003\u8651\u628a\u77e9\u9635\u53d8\u5f62\uff0c\u8ba9\u5176\u6ee1\u8db3\u53ef\u4e58\u6027\u3002\u4e0d\u8fc7\u4ed4\u7ec6\u60f3\u60f3\u6b63\u786e\u6027\u4e0d\u597d\u8bc1\u660e\uff0c\u800c\u4e14\u8fd9\u79cd\u8f6c\u5316\u65b9\u6cd5\u957f\u8fd9\u4e48\u5927\u5c31\u6ca1\u542c\u8bf4\u8fc7\u3002\u56e0\u6b64**\u786c\u642c\u77e9\u9635\u4f18\u5316\u7684\u601d\u8def\u5931\u8d25\u4e86**\u3002\n\n\u77aa\u773c\u6cd5\u51fa\u4e0d\u6765\uff0c\u6211\u4eec\u5c1d\u8bd5\u628a\u524d\u51e0\u9879\u5199\u51fa\u6765\uff0c\u770b\u770b\u6709\u4ec0\u4e48\u7279\u70b9\u3002\u5219\u6709\uff1a\n\n$f_4 = c^2\\times f_3 \\times f_2 \\times f_1$\uff1b     \n$f_5 = c^4\\times f_4 \\times f_3 \\times f_2$\uff1b     \n$f_6 = c^6\\times f_5 \\times f_4 \\times f_3$\uff1b     \n$f_7 = c^8\\times f_6 \\times f_5 \\times f_4$\uff1b    \n$\\ \\ \\cdots$\n\n\u53c8\u56e0\u4e3a\u76f4\u63a5\u9012\u63a8\u6216\u8005\u627e\u901a\u9879\u4e0d\u884c\uff0c\u6211\u4eec\u5c1d\u8bd5\u628a\u5f0f\u5b50\u90fd\u4ee3\u6362\u6210\u6211\u4eec\u7684\u5df2\u77e5\u91cf\uff0c\u5219\u6709\uff1a\n\n$f_4 = c^2\\times f_3 \\times f_2 \\times f_1$\uff1b     \n$f_5 = c^6\\times f_3^2 \\times f_2^2 \\times f_1$\uff1b     \n$f_6 = c^{14}\\times f_3^4 \\times f_2^3 \\times f_1^2$\uff1b     \n$f_7 = c^{30}\\times f_3^7 \\times f_2^6 \\times f_1^4$\uff1b    \n$\\ \\ \\cdots$\n\n\u8bf6\uff1f\u4f3c\u4e4e\u6307\u6570\u4e58\u79ef\u6709\u4ee5\u4e0b\u6027\u8d28\uff1a$x^a\\times x^b = x^{a+b}$\uff0c\u90a3\u4e48\u5982\u679c\u6211\u4eec\u53ea\u8003\u8651\u6bcf\u4e2a\u6570\u7684\u6b21\u6570\uff0c\u800c\u6bcf\u4e2a\u6570\u7684\u5e95\u6570\u90fd\u5df2\u77e5\uff0c\u6700\u540e\u53ef\u4ee5\u5feb\u901f\u5e42\uff0c\u597d\u50cf\u5c31\u7b26\u5408\u4e86\u52a0\u6cd5\u9012\u63a8\uff0c\u80fd\u591f\u5e94\u7528\u77e9\u9635\u52a0\u901f\u4e86\uff01\n\n\u4ee5 $f1$ \u4e3a\u4f8b\u3002\u7531 $f_x = c^{2x - 6}f_{x-1}f_{x-2}f_{x-3}$ \u53ef\u77e5\u7ec4\u6210 $x$ \u7684 $f1$ \u7684\u6b21\u6570\u7531 $x-1$\u3001$x-2$\u3001$x-3$ \u4e09\u4e2a\u72b6\u6001\u7684\u603b\u548c\u5f97\u51fa\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5411\u91cf $F_{1_i} = [g_i,\\ \\ g_{i-1},\\ \\ g_{i-2}]$\uff0c$g_i$ \u8868\u793a $i$ \u72b6\u6001\u4e0b $f_1$ \u7684\u6307\u6570\u3002\u73b0\u5728\u601d\u8003\uff0c\u5982\u4f55\u63a8\u51fa $F_{1_{i+1}}$\uff1f\u5219\u6709\uff1a\n\n$\\begin{bmatrix}\ng_i,\\ \\  g_{i-1},\\ \\  g_{i-2}\n\\end{bmatrix} \\times\n\\begin{bmatrix}\n1,\\ \\ 1, \\ \\ 0 \\\\\n1,\\ \\  0, \\ \\ 1 \\\\\n1, \\ \\ 0,\\  \\ 0\n\\end{bmatrix} = \n\\begin{bmatrix}\ng_{i+1},\\ \\  g_{i},\\ \\  g_{i-1}\n\\end{bmatrix}\n$\n\n\u540c\u7406\u53ef\u5f97\u51fa $f_2$\u3001$f_3$ \u7684\u8f6c\u79fb\u65b9\u6cd5\uff0c**\u8f6c\u79fb\u77e9\u9635\u76f8\u540c**\u3002\n\n$c$ \u7684\u8f6c\u79fb\u7565\u663e\u590d\u6742\u3002\u9996\u5148\uff0c\u5982\u679c\u4e0d\u6362\u5143\uff0c\u6bcf\u6b21 $c$ \u7684\u6307\u6570\u5e94\u8be5\u6784\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\u5176\u6b21\uff0c\u6362\u5143\u540e\u6bcf\u6b21\u6307\u6570\u8fd8\u8981\u7d2f\u52a0\u524d\u9762\u7684\u6307\u6570\u548c\u3002\u56e0\u6b64\u6211\u4eec\u6784\u9020\u7684\u5411\u91cf\u8981\u5305\u542b\u524d 3 \u4e2a\u72b6\u6001\u5e76\u80fd\u8f6c\u79fb\u7b49\u5dee\u6570\u5217\u3002\u89c2\u5bdf\u53ef\u77e5\u7b49\u5dee\u6570\u5217\u516c\u5dee $d = 2$\uff0c\u5219\u6709\u5411\u91cf $C = [h_i,\\ \\ h_{i-1},\\ \\ h_{i-2},\\ \\ a_i,\\ \\ d]$\uff0c\u5176\u4e2d $h_i$ \u8868\u793a $i$ \u65f6 $c$ \u7684\u6307\u6570\uff0c$a_i$ \u662f\u7b49\u5dee\u6570\u5217\u6b64\u65f6\u7684\u503c\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u6709\u5982\u4e0b\u8f6c\u79fb\uff1a\uff08\u6ce8\u610f $d$ \u662f\u5e38\u6570\uff09\u3002\n\n$\\begin{bmatrix}\nh_i,\\ \\ h_{i-1},\\ \\ h_{i-2},\\ \\ a_i,\\ \\ d\n\\end{bmatrix} \\times\n\\begin{bmatrix}\n1,\\ \\ 1, \\ \\ 0, \\ \\ 0, \\ \\ 0 \\\\\n1,\\ \\  0, \\ \\ 1, \\ \\ 0, \\ \\ 0 \\\\\n1, \\ \\ 0,\\  \\ 0, \\ \\ 0,\\  \\ 0 \\\\\n1, \\ \\ 0,\\ \\ 0,\\ \\ 1,\\ \\ 0 \\\\\n1, \\ \\ 0,\\ \\ 0,\\ \\ 1,\\ \\ 1 \n\\end{bmatrix} = \n\\begin{bmatrix}\nh_{i+1},\\ \\ h_{i},\\ \\ h_{i-1},\\ \\ a_{i+1},\\ \\ d\n\\end{bmatrix}\n$\n\n\u56e0\u6b64\u53ea\u8981**\u6c42\u51fa $n$ \u65f6\u7684\u5404\u5411\u91cf**\u7136\u540e**\u5feb\u901f\u5e42\u7b97\u7b54\u6848**\u5373\u53ef\u3002\n\n## \u7ec6\u8282\n\n1. \u89c2\u5bdf\u521a\u624d\u7684\u4e24\u4e2a\u8f6c\u79fb\u77e9\u9635\u3002\u53ef\u4ee5\u53d1\u73b0\u5de6\u4e0a\u89d2 $3 \\times 3$ \u7684\u90e8\u5206\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06 3 \u4e2a $F$ \u5411\u91cf\u6269\u5145\u81f3 $1\\times 5$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u7528\u4e00\u4e2a\u8f6c\u79fb\u77e9\u9635\u4e86\u3002\n2. \u73b0\u5728\u6765\u8003\u8651\u51e0\u4e2a\u5411\u91cf\u7684\u521d\u59cb\u503c\u3002\u8003\u8651\u5230\u6211\u4eec\u7684\u5b9a\u4e49\uff0c\u521d\u59cb\u65f6\u5305\u62ec\u524d\u4e09\u4e2a\u72b6\u6001\u662f\u6700\u597d\u4e14\u7b80\u5355\u7684\u3002\u56e0\u6b64\u6709\uff1a\uff08\u76f4\u63a5\u6839\u636e\u5b9a\u4e49\u586b\u5165\u5c31\u884c\uff09\n\n\t$F_{1} = [0, \\ \\ 0, \\ \\ 1]$\uff0c$F_{2} = [0, \\ \\ 1, \\ \\ 0]$\uff0c$F_{3} = [1, \\ \\ 0, \\ \\ 0]$\u3002\uff08\u7701\u7565\u4e86\u6269\u5145\u90e8\u5206\uff09\n    \n    \u6b64\u5916\uff0c\u6839\u636e\u5bf9 $C$ \u7684\u5b9a\u4e49\uff0c\u524d\u4e09\u4e2a\u72b6\u6001\u90fd\u662f\u975e\u6cd5\u7684\u3002\u6240\u4ee5\u90fd\u5e94\u8be5\u662f 0\u3002\u800c\u7b49\u5dee\u6570\u5217\u7684\u9996\u9879 $a_1 = 2$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u865a\u62df\u9996\u9879 $a_0 = a_1 - d = 0$\uff08\u53ea\u8f6c\u79fb\u4e00\u6b21\u5c31\u5408\u6cd5\uff0c\u9006\u63a8\u5f97\u51fa\uff09\uff0c\u6545\u63a8\u51fa\u521d\u59cb\u5411\u91cf\uff1a\n    \n    $C = [0,\\ \\ 0,\\ \\ 0,\\ \\ 0,\\ \\ 2]$\u3002\n\n3. \u89c2\u5bdf\u6570\u636e\u8303\u56f4\u3002\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u8f6c\u79fb\u7684\u6307\u6570\u4e0d\u4ec5\u589e\u957f\u8fc5\u901f\uff0c\u800c\u4e14\u589e\u957f\u57fa\u6570\u5927\u3002\u5f88\u6709\u53ef\u80fd ```unsigned long long``` \u4e5f\u65e0\u6cd5\u4fdd\u5b58\u6b63\u786e\u7684\u6307\u6570\u3002\u8003\u8651\u4e00\u4e0b\u662f\u5426\u53ef\u4ee5\u53d6\u6a21\u3002\n\n\t\u56e0\u4e3a\u6a21\u6570\uff08$10^9+7$\uff09\u662f\u4e00\u4e2a\u8d28\u6570\uff0c\u56fa\u7531\u8d39\u9a6c\u5c0f\u5b9a\u7406\n    \n    $a^{p-1} \\equiv 1 \\pmod p$\n    \n    \u6211\u4eec\u77e5\u9053\u5728\u6a21 $p$ \u610f\u4e49\u4e0b $c^{p-1} = c^{0}$\uff0c\u6240\u4ee5\u5176\u6307\u6570\u7684\u6a21\u57df\u662f $[0, p-2]$\u3002\u56fa\u8f6c\u79fb\u65f6\u9700\u4e0e $10^9+6$ \u53d6\u6a21\u3002\n    \n### \u65f6\u95f4\u590d\u6742\u5ea6\n\n\u771f\u7684\u53ea\u662f\u4e00\u4e2a\u77e9\u9635\u52a0\u901f\uff0c\u8fd8\u6709\u77e9\u9635\u8fd0\u7b97\u7684\u5e38\u6570 $q$\uff0c\u56fa\u5927\u7ea6 $O(q^3\\log n)$\u3002\uff08$q = 5$\uff09\n    \n# \u4ee3\u7801\n\n\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u4ee3\u7801\u5f88\u7b80\u5355\u3002\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstring>\n\nusing namespace std;\ntypedef long long ll;\nconst int maxM = 5;\nconst int mod = 1e9 + 7; //\u7b54\u6848\u7684\u6a21\u6570\nconst int P = mod - 1; //\u77e9\u9635\u4f18\u5316\u8f6c\u79fb\u7684\u6a21\u6570\n\nll n;\nint f1, f2, f3, c;\nstruct Matrix{\n    int v[maxM][maxM];\n    int L, C;\n\n    Matrix(int l, int c, bool st = false){\n        L = l, C = c;\n        memset(v, 0, sizeof v);\n        if (st){\n            for (int i = 0; i < max(l, c); i ++){\n                v[i][i] = 1;\n            }\n        }\n    }\n\n    Matrix operator * (const Matrix &b) const{\n        Matrix res(L, b.C);\n        for (int i = 0; i < res.L; i ++){\n            for (int j = 0; j < res.C; j ++){\n                for (int k = 0; k < C; k ++){\n                    (res.v[i][j] += (ll)v[i][k] * b.v[k][j] % P) %= P;\n                }\n            }\n        }\n        return res;\n    }\n};\n\nMatrix qmi(Matrix A, ll b){\n    Matrix res(A.L, A.C, true);\n    while (b){\n        if (b & 1) res = res * A;\n        A = A * A;\n        b >>= 1;\n    }\n    return res;\n}\n\nint qmi(int a, int b){\n    int res = 1;\n    while (b){\n        if (b & 1) res = (ll)res * a % mod;\n        a = (ll)a * a % mod;\n        b >>= 1;\n    }\n    return res;\n}\n\nint main(){\n    ios::sync_with_stdio(false);\n    cin.tie(0), cout.tie(0);\n\n    cin >> n >> f1 >> f2 >> f3 >> c;\n\n    /* building matrix */\n    Matrix A(5, 5);\n    Matrix C(1, 5),F1(1, 5), F2(1, 5), F3(1, 5);\n    const int Exmp[5][5] = {\n        {1, 1, 0, 0, 0},\n        {1, 0, 1, 0, 0},\n        {1, 0, 0, 0, 0},\n        {1, 0, 0, 1, 0},\n        {1, 0, 0, 1, 1}\n    }; \n    memcpy(A.v, Exmp, sizeof Exmp);\n    C.v[0][4] = 2; //[0,0,0,0,2]\n    F1.v[0][2] = 1, F2.v[0][1] = 1, F3.v[0][0] = 1;\n\n    /* process */\n    A = qmi(A, n-3);\n    C = C * A,F1 =F1 * A, F2 = F2 * A, F3 = F3 * A;\n\n    /* get answer */\n    int temp_c = qmi(c, C.v[0][0]);\n    int temp_f1 = qmi(f1,F1.v[0][0]);\n    int temp_f2 = qmi(f2, F2.v[0][0]);\n    int temp_f3 = qmi(f3, F3.v[0][0]);\n\n    int ans = (ll)temp_c * temp_f1 % mod * temp_f2 % mod * temp_f3 % mod;\n    cout << ans << endl;\n\n    return 0;\n}\n```\n\n# \u603b\u7ed3\n\nu1s1\uff0c\u611f\u89c9\u628a\u81ea\u5df1\u60f3\u6cd5\u5199\u51fa\u6765\u7ecf\u5e38\u4f1a\u8868\u8fbe\u4e0d\u6e05\u3002\u800c\u4e14\u6211\u603b\u662f\u5e0c\u671b\u80fd\u7528\u6700\u5c11\u7684\u8bdd\u8868\u8fbe\u6700\u6e05\u695a\u7684\u610f\u601d\uff0c\u4f46\u6bcf\u56de\u90fd\u4f1a\u5f88\u5570\u55e6\uff0c\u5df2\u7ecf\u659f\u914c\u4fee\u6539\u5f88\u591a\u4e86\uff0c\u8fd8\u671b\u89c1\u8c05\uff0c\u5982\u6709\u95ee\u9898\u6b22\u8fce\u6307\u51fa\uff01\n\n\u8c22\u8c22\u89c2\u770b\uff01\n",
        "postTime": 1659268380,
        "uid": 528114,
        "name": "jjsnam",
        "ccfLevel": 6,
        "title": "CF1182E\u9898\u89e3"
    },
    {
        "content": "\u7b2c\u4e00\u773c\uff1a~~\u5f88\u660e\u663e\u5730\u9012\u63a8\u554a~~\n\n\u7b2c\u4e8c\u773c\uff1a$n \\leq 10^{18}$\uff1f\n\n\u7b2c\u4e09\u773c\uff1a~~\u5f88\u660e\u663e\u7684\u77e9\u9635\u52a0\u901f\u554a~~\n\n\u7136\u540e\u8003\u573a\u4e0a\u6210\u529f\u5730\u6ca1\u5199\u51fa\u6765\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u5728\u60f3\u5230\u77e9\u9635\u52a0\u901f\u4e4b\u540e\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c$f$\u548c$c$\u4e00\u5b9a\u662f\u8981\u5206\u5f00\u5904\u7406\u7684\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u53d1\u73b0$f$\u7528\u4e58\u79ef\u9012\u63a8\u8c8c\u4f3c\u4e0d\u597d\u7528\u77e9\u9635\u52a0\u901f\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u4ee5\u5c06\u6240\u6709$f_i$\u8868\u793a\u4e3a$f_1^p\u00b7f_2^q\u00b7f_3^r$\u7684\u5f62\u5f0f\uff08\u6ce8\u610f\u8fd9\u91cc\u5df2\u7ecf\u53bb\u6389\u4e86$c$\uff0c\u6700\u540e\u518d\u4e58\u4e0a\u5c31\u53ef\u4ee5\u4e86\uff09\u3002\n\n\u4e8e\u662f\u6211\u5f00\u59cb\u8ba1\u7b97\u548c\u5316\u7b80\uff1a\n\n$f_4=f_1^1\u00b7f_2^1\u00b7f_3^1$\n\n$f_5=f_1^1\u00b7f_2^2\u00b7f_3^2$\n\n$f_6=f_1^2\u00b7f_2^3\u00b7f_3^4$\n\n$f_7=f_1^4\u00b7f_2^6\u00b7f_3^7$\n\n\u663e\u7136\uff0c\u5f53\u6211\u4eec\u8981\u4ece$(p,q,r)$\u63a8\u5bfc\u5230$(p_1,q_1,r_1)(f_i=f_1^p\u00b7f_2^q\u00b7f_3^r,f_{i+1}=f_1^{p_1}\u00b7f_2^{q_1}\u00b7f_3^{r_1})$\u65f6\uff0c\u53ef\u4ee5\u627e\u5230\u89c4\u5f8b\uff1a$p_1=r,q_1=p+r,r_1=q+r$\u3002\n\n\u6613\u5f97\u8f6c\u79fb\u77e9\u96351\u4e3a$\\begin{bmatrix}0&1&0\\\\0&0&1\\\\1&1&1\\end{bmatrix}$\uff0c\u8ba1\u7b97$\\begin{bmatrix}1&1&1\\end{bmatrix} \\times \\begin{bmatrix}0&1&0\\\\0&0&1\\\\1&1&1\\end{bmatrix}^{n-3}$\u7684\u4f4d\u4e8e$(1,1)$\u7684\u5143\u7d20\u5c31\u662f$p$\uff0c\u4f4d\u4e8e$(1,2)$\u7684\u5143\u7d20\u5c31\u662f$q$\uff0c\u4f4d\u4e8e$(1,3)$\u7684\u5143\u7d20\u5c31\u662f$r$\u3002\n\n\u95ee\u9898\u5728\u4e8e\u600e\u4e48\u5904\u7406$c$\u3002\n\n\u8fd8\u662f\u53ef\u4ee5\u5199\u51fa$c$\u7684\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$c_i=c_{i-1}+c_{i-2}+c_{i-3}+2i-6$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a$5 \\times 5$\u7684\u8f6c\u79fb\u77e9\u9635\u548c$1 \\times 5$\u7684\u7b54\u6848\u77e9\u9635\uff0c\u8bbe\u5176\u4e3a$\\begin{bmatrix}k_1&k_2&k_3&k_4&k_5\\end{bmatrix}$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8ba9$k_1$\u7ef4\u62a4$c_{i-1}$\uff0c$k_2$\u7ef4\u62a4$c_{i-2}$\uff0c$k_3$\u7ef4\u62a4$c_{i-3}$\uff0c$k_4$\u7ef4\u62a4$2i$\uff0c$k_5$\u7ef4\u62a4$-6$\u3002\n\n\u7136\u540e\u6211\u4eec\u5f00\u59cb\u586b\u8fd9\u4e2a\u77e9\u9635\uff1a\u521d\u59cb\u4e3a$\\begin{bmatrix}0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&0&0\\end{bmatrix}$\n\n\u90a3\u4e48\u56e0\u4e3a\u8f6c\u79fb\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8ba9$k_1$\u5f97\u5230\u8fd9\u4e2a$-6$\u5c31\u53ef\u4ee5\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4fdd\u6301$k_5=1$\uff0c\u5e76\u8ba9$k_1$\u4e58\u4e0a\u4e00\u4e2a$-6$\uff0c\u4e8e\u662f\u586b\u51fa2\u9879\uff1a$\\begin{bmatrix}0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&0&0\\\\-6&0&0&0&1\\end{bmatrix}$\n\n\u7136\u540e\uff0c\u6bcf\u8f6c\u79fb\u4e00\u6b21\u9700\u8981\u8ba9$k_4\\ +2$\uff0c\u540c\u65f6\u56e0\u4e3a$k_5$\u4e00\u76f4\u4e3a$1$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8ba9$k_5\\times 2$\uff0c\u7136\u540e\u4fdd\u6301$k_4$\u4e0d\u53d8\u5c31\u53ef\u4ee5\u4e86\u3002\n\n$\\begin{bmatrix}0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&0&0\\\\0&0&0&1&0\\\\-6&0&0&2&1\\end{bmatrix}$\n\n$k_2$\u548c$k_3$\u975e\u5e38\u597d\u6574\uff1a\u6211\u4eec\u76f4\u63a5\u628a$k_1$\u8f6c\u79fb\u5230$k_2$\uff0c\u628a$k_2$\u8f6c\u79fb\u5230$k_3$\u5c31\u53ef\u4ee5\u4e86\u3002\n\n$\\begin{bmatrix}0&1&0&0&0\\\\0&0&1&0&0\\\\0&0&0&0&0\\\\0&0&0&1&0\\\\-6&0&0&2&1\\end{bmatrix}$\n\n\u5b8c\u6210\u4e86\u8fd9\u4e9b\uff0c\u4f1a\u53d1\u73b0$k_1$\u66f4\u52a0\u597d\u6574\uff1a\u76f4\u63a5\u6309\u7167\u8f6c\u79fb\u65b9\u7a0b\uff0c\u628a\u6240\u6709\u9664$-6$\uff08\u8fd9\u9879\u5df2\u7ecf\u5b8c\u6210\u8f6c\u79fb\uff09\u7684\u9879\u8f6c\u79fb\u5230$k_1$\u5373\u53ef\u3002\n\n$\\begin{bmatrix}1&1&0&0&0\\\\1&0&1&0&0\\\\1&0&0&0&0\\\\1&0&0&1&0\\\\-6&0&0&2&1\\end{bmatrix}$\n\n\u4e0b\u9762\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5b8c\u6210\u521d\u59cb\u77e9\u9635\u4e86\u3002\n\n\u663e\u7136\uff0c\u6211\u4eec\u5e94\u8be5\u4ece$i=4$\u5f00\u59cb\uff0c\u6240\u4ee5\u6211\u4eec\u8bbe\u8ba1\u7684\u5b9e\u9645\u4e0a\u662f$i=4$\u65f6\u7684\u72b6\u6001\u3002\u76f4\u63a5\u4ee3\u5165\u5c31\u53ef\u4ee5\u4e86\uff1a$[0,0,0,8,1]$\u3002\n\n\u7136\u540e\uff0c\u8ba1\u7b97\u7b54\u6848\u77e9\u9635\u4e3a$[0,0,0,8,1]\\times\\begin{bmatrix}1&1&0&0&0\\\\1&0&1&0&0\\\\1&0&0&0&0\\\\1&0&0&1&0\\\\-6&0&0&2&1\\end{bmatrix}^{n-3}$\n\n\u6700\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u7b54\u6848\u5c31\u662f\u7b54\u6848\u77e9\u9635\u7684$(1,1)$\uff0c\u8bbe\u5176\u4e3a$s$\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u4e86$p,q,r,s$\uff0c\u90a3\u4e48\u663e\u7136\uff0c\u7b54\u6848\u5c31\u662f$f_1^p\u00b7f_2^q\u00b7f_3^r\u00b7c^s \\bmod 10^9+7$\u3002\n\n\u6ce8\u610f\uff1a\u6211\u4eec\u5bf9\u6307\u6570\u53d6\u6a21\u7684\u65f6\u5019\uff0c\u8981\u6a21$phi(10^9+7)=10^9+6$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6$\\Theta(\\log N)$\u3002\n\n\u9644\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <cstdio>\nusing namespace std;\n\nconst long long mod1 = 1e9 + 7ll, mod2 = 1e9 + 6ll;\nstruct Matrix {\n    long long a[10][10];\n    int n, m;\n    Matrix() {\n        n = m = 0;\n        memset(a, 0, sizeof(a));\n    }\n    //\u77e9\u9635\u4e58\u6cd5\n    Matrix operator * (const Matrix& b) const {\n        Matrix c;\n        c.n = n;\n        c.m = b.m;\n        for (int i = 1;i <= c.n;i++) {\n            for (int j = 1;j <= c.m;j++) {\n                for (int k = 1;k <= m;k++) {\n                    c.a[i][j] = (c.a[i][j] + (a[i][k] * b.a[k][j]) % mod2) % mod2;\n                }\n            }\n        }\n        return c;\n    }\n};\nlong long n, f1, f2, f3, c;\n//\u751f\u6210\u5355\u4f4d\u77e9\u9635\nMatrix Unit(int n) {\n    Matrix mtx;\n    mtx.n = n;\n    mtx.m = n;\n    for (int i = 1;i <= n;i++) {\n        for (int j = 1;j <= n;j++) {\n            mtx.a[i][j] = (i == j);\n        }\n    }\n    return mtx;\n}\n//\u77e9\u9635\u5feb\u901f\u5e42\nMatrix Power(Matrix x, long long y) {\n    Matrix ans = Unit(x.n);\n    while (y) {\n        if (y & 1) {\n            ans = ans * x;\n        }\n        y >>= 1;\n        x = x * x;\n    }\n    return ans;\n}\n//\u6574\u6570\u5feb\u901f\u5e42\nlong long Power_(long long x, long long y) {\n    long long ans = 1;\n    while (y) {\n        if (y & 1) {\n            ans = (ans * x) % mod1;\n        }\n        y >>= 1;\n        x = (x * x) % mod1;\n    }\n    return ans;\n}\n\nvoid Solve() {\n//\u5b8c\u62102\u4e2a\u521d\u59cb\u77e9\u9635\u548c2\u4e2a\u8f6c\u79fb\u77e9\u9635\n    Matrix mtx1, mtx2, mtx3, mtx4;\n    mtx1.n = 1; mtx1.m = 3; mtx1.a[1][1] = mtx1.a[1][2] = mtx1.a[1][3] = 1;\n    mtx2.n = 3; mtx2.m = 3; mtx2.a[1][2] = mtx2.a[2][3] = mtx2.a[3][1] = mtx2.a[3][2] = mtx2.a[3][3] = 1;\n    mtx3.n = 1; mtx3.m = 5; mtx3.a[1][4] = 8; mtx3.a[1][5] = 1;\n    mtx4.n = 5; mtx4.m = 5; mtx4.a[1][1] = mtx4.a[1][2] = mtx4.a[2][1] = mtx4.a[2][3] = mtx4.a[3][1] = mtx4.a[4][1] = mtx4.a[4][4] = mtx4.a[5][5] = 1;\n    mtx4.a[5][1] = -6; mtx4.a[5][4] = 2;\n    //\u5229\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97p,q,r,s\n    mtx1 = mtx1 * Power(mtx2, n - 4);\n    mtx3 = mtx3 * Power(mtx4, n - 3);\n    long long ans1 = mtx1.a[1][1], ans2 = mtx1.a[1][2], ans3 = mtx1.a[1][3], ans4 = mtx3.a[1][1];\n    long long ans = 1;\n    //\u6c42\u5f97\u6700\u7ec8\u7b54\u6848\n    ans = (ans * Power_(f1, ans1)) % mod1;\n    ans = (ans * Power_(f2, ans2)) % mod1;\n    ans = (ans * Power_(f3, ans3)) % mod1;\n    ans = (ans * Power_(c, ans4)) % mod1;\n    printf(\"%I64d\", ans);\n}\n\nint main() {\n    scanf(\"%I64d%I64d%I64d%I64d%I64d\", &n, &f1, &f2, &f3, &c);\n    Solve();\n    return 0;\n}\n```",
        "postTime": 1560348504,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "\u5df2\u77e5 $f_1,f_2,f_3$ \u548c $c$\uff0c$f_i=c^{2i-6}f_{i-1}f_{i-2}f_{i-3}(i>3)$\uff0c\u6c42 $f_n$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8fd9\u91cc\u4e0d\u518d\u662f\u52a0\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u77e9\u9635\u5feb\u901f\u5e42\u3002\u4f46\u662f\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u5bf9\u4e8e\u4e00\u4e2a\u5927\u4e8e 1 \u7684\u6570 $a$ \u6709 $\\log_ax\\cdot y=\\log_ax+\\log_ay$\uff0c\u4f46\u662f\uff0c\u5982\u679c\u7528 $\\log$ \u7684\u8bdd\uff0c\u4f60\u7684\u7cbe\u5ea6\u7206\u4e0a\u4e2a\u5341\u51e0\u904d\u662f\u4e0d\u6210\u95ee\u9898\u7684\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u63a8\u4e00\u63a8\u3002\n$$f_1=c^0f_3^0f_2^0f_1$$\n$$f_2=c^0f_3^0f_2f_1^0$$\n$$f_3=c^0f_3f_2^0f_1^0$$\n$$f_4=c^2f_3f_2f_1$$\n$$f_5=c^6f_3^2f_2^2f_1$$\n$$f_6=c^{14}f_3^4f_2^3f_1^2$$\n$$f_7=c^{30}f_3^7f_2^6f_1^4$$\n$$f_8=c^{60}f_3^{13}f_2^{11}f_1^7$$\n\n\u6211\u4eec\u8bbe $t_{i,j},(i>3,j=\\overline{1,2,3})$ \u8868\u793a $f_i$ \u5206\u89e3\u8fc7\u540e $f_j$ \u7684\u7cfb\u6570\uff0c$g_i$ \u8868\u793a $f_i$ \u4e2d $c$ \u7684\u7cfb\u6570\u3002\u6211\u4eec\u53d1\u73b0\uff1a\n$$t_{i,j}=t_{i-1,j}+t_{i-2,j}+t_{i-3,j}$$\n$$g_i=2i-6+g_{i-1}+g_{i-2}+g_{i-3}$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u63a8\u8fc7\u53bb\u4e86\uff0c\u4f46\u662f\uff0c\u5982\u679c\u4e0d\u53d6\u6a21\u7684\u8bdd\uff0c\u4f1a\u70b8\u6389\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6b27\u62c9\u964d\u5e42\uff1a\n$$a^b\\equiv a^{b\\bmod\\varphi(p)}\\pmod{p}$$\n\n\u56e0\u4e3a\u672c\u9898\u7684\u6a21\u6570\u662f\u7ed9\u8d28\u6570\uff0c\u6240\u4ee5\u5bf9\u6307\u6570\u7684\u6a21\u6570\u4e3a\u5176\u51cf\u4e00\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n  #include<bits/stdc++.h>\n  #define int long long\n  using namespace std;\n  const int mod=1e9+7,Mod=mod-1;\n  int n,c,x,y,z,res=1;\n  struct M{\n      int a[5][5];\n      M operator*(M t){\n          M res;\n          for(int i=0;i<5;i++)for(int j=0;j<5;j++)res.a[i][j]=0;\n          for(int i=0;i<5;i++){\n              for(int j=0;j<5;j++){\n                  for(int k=0;k<5;k++){\n                      res.a[i][j]=((res.a[i][j]+a[i][k]*t.a[k][j]%Mod+Mod)%Mod+Mod)%Mod;\n                  }\n              }\n          }\n          return res;\n      }\n      M operator^(int x){\n          M res,_=*this;\n          for(int i=0;i<5;i++)for(int j=0;j<5;j++)res.a[i][j]=(i==j);\n          while(x){\n              if(x&1)res=res*_;\n              _=_*_;\n              x>>=1; \n          }\n          return res;\n      }\n  }ans,base;\n  int fpow(int a,int b){\n      int res=1;\n      while(b){\n          if(b&1)res=res*a%mod;\n          a=a*a%mod;\n          b>>=1;\n      }\n      return res;\n  }\n  signed main()\n  {\n      scanf(\"%lld%lld%lld%lld%lld\",&n,&x,&y,&z,&c);\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)ans.a[i][j]=0;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)base.a[i][j]=0;\n      ans.a[2][0]=1;\n      base.a[0][0]=base.a[0][1]=base.a[0][2]=base.a[1][0]=base.a[2][1]=1;\n      ans=(base^(n-3))*ans;\n      res=res*fpow(x,ans.a[0][0])%mod;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)ans.a[i][j]=0;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)base.a[i][j]=0;\n      ans.a[1][0]=1;\n      base.a[0][0]=base.a[0][1]=base.a[0][2]=base.a[1][0]=base.a[2][1]=1;\n      ans=(base^(n-3))*ans;\n      res=res*fpow(y,ans.a[0][0])%mod;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)ans.a[i][j]=0;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)base.a[i][j]=0;\n      ans.a[0][0]=1;\n      base.a[0][0]=base.a[0][1]=base.a[0][2]=base.a[1][0]=base.a[2][1]=1;\n      ans=(base^(n-3))*ans;\n      res=res*fpow(z,ans.a[0][0])%mod;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)ans.a[i][j]=0;\n      for(int i=0;i<5;i++)for(int j=0;j<5;j++)base.a[i][j]=0;\n      ans.a[3][0]=3;ans.a[4][0]=1;\n      base.a[0][0]=1;base.a[0][1]=1;base.a[0][2]=1;base.a[0][3]=2;base.a[0][4]=-4;\n      base.a[1][0]=1;\n      base.a[2][1]=1;\n      base.a[3][3]=1;base.a[3][4]=1;\n      base.a[4][4]=1;\n      ans=(base^(n-3))*ans;\n      res=res*fpow(c,ans.a[0][0])%mod;\n      printf(\"%lld\",res);\n      return 0;\n  }\n```",
        "postTime": 1660696807,
        "uid": 428358,
        "name": "cqbztzl",
        "ccfLevel": 5,
        "title": "CF1182E\u9898\u89e3"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u4f60$n,f_1,f_2,f_3,c$,\u8ba9\u4f60\u6c42$f_n=c^{2n-6} \\times f_{n-1} \\times f_{n-2} \\times f_{n-3}$\n\n### \u89e3\u6790\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0:\n\n$f_n \\times c^n$\n$ = c^{3n-6} \\times f_{n-1} \\times f_{n-2} \\times f_{n-3}$\n$ = c^{n-1} \\times f_{n-1} \\times c^{n-2} \\times f_{n-2} \\times c^{n-3} \\times f_{n-3}$\n\n\u8bbe$g_n=f_n*c_n$\uff0c\u5219\u6709$g_n=g_{n-1} \\times g_{n-2} \\times g_{n-3}$\n\n\u628a\u5b83\u5c55\u5f00\uff0c\u53d1\u73b0\n\n$$g_n=g_{n-1} \\times g_{n-2} \\times g_{n-3}=g_{n-2}^2 \\times g_{n-3}^2 \\times g_{n-4} = g_{n-3}^4 \\times g_{n-4}^3 \\times g_{n-5}^2 = \\cdots = g_3^{h_{2n-5}} \\times g_2^{h_{2n-6}} \\times g_1^{h_{2n-7}}$$\n\n\u4e8e\u662f\u6211\u4eec\u7684\u5de5\u4f5c\u5c31\u53d8\u6210\u4e86\u6c42$h_n$\n\n\u89c2\u5bdf~~oeis~~\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n$$h_{2n}=h_{2n-1}+h_{2n-3},h_{2n+1}=h_{2n-1}+h_{2n-2},$$\n\n\u6211\u4eec\u8bbe$a_n=h_{2n+1},b_n=h_{2n}$\uff0c\u5219\u53ef\u4ee5\u5f97\u51fa\u5982\u4e0b\u77e9\u9635\n\n![TZXNM`YV~1Q1W3MI626M44P.png](https://i.loli.net/2019/10/18/34HNXTQDpyAFO8G.png)\n\n\u6211\u4eec\u53c8\u6ce8\u610f\u5230$mod=10^9+7$,\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u6b21\u6570\u6a21\u4e0a$\\phi(mod)=10^9+6$(\u6b27\u62c9\u5b9a\u7406)\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u4e50\u7684\u7528\u77e9\u5feb\u8ba1\u7b97\u6b21\u6570\u5566\n\n\u6ce8\u610f\u6700\u540e\u7684$f_n=\\frac{g_n}{c^n}$\u54e6\n\n``` cpp\n#include <bits/stdc++.h>\n\n#define R register\n#define ll unsigned long long\n#define sum(a, b, mod) ((a + b) % mod)\n\nconst ll mod = 1e9 + 7, mode = 1e9 + 6;\n\nll fast_mul(ll a, ll b, ll mod)\n{\n    ll ans = 0;\n    while (b)\n    {\n        if (b & 1)\n            ans = (ans + a) % mod;\n        a = (a + a) % mod;\n        b >>= 1;\n    }\n    return ans;\n}\n\nll fast_pow(ll a, ll b)\n{\n    ll ret = 1;\n    while (b)\n    {\n        if (b & 1)\n            ret = fast_mul(ret, a, mod) % mod;\n        a = fast_mul(a, a, mod) % mod;\n        b >>= 1;\n    }\n    return ret;\n}\n\nstruct matrix\n{\n    ll n, m, a[10][10];\n    matrix(ll x, ll y)\n    {\n        n = x, m = y;\n        memset(a, 0, sizeof(a));\n    }\n};\n\nmatrix mul(matrix a, matrix b)\n{\n    ll n = a.n, m = a.m, k = b.m;\n    matrix c(n, k);\n    for (ll i = 1; i <= n; i++)\n        for (ll l = 1; l <= k; l++)\n            for (ll j = 1; j <= m; j++)\n                c.a[i][j] = (c.a[i][j] + fast_mul(a.a[i][l], b.a[l][j], mode)) % mode;\n    return c;\n}\nmatrix pow_(matrix a, ll b)\n{\n    matrix ret = a;\n    while (b)\n    {\n        if (b & 1ll)\n            ret = mul(ret, a);\n        a = mul(a, a);\n        b >>= 1ll;\n    }\n    return ret;\n}\n\ninline matrix init()\n{\n    matrix a(3, 3);\n    a.a[1][1] = a.a[1][3] = a.a[2][1] = a.a[3][1] = a.a[3][2] = 1;\n    return a;\n}\n\ninline matrix init_()\n{\n    matrix a(3, 1);\n    a.a[1][1] = a.a[2][1] = a.a[3][1] = 1;\n    return a;\n}\n\nint main()\n{\n    ll f[4], n, c;\n    std::cin >> n >> f[1] >> f[2] >> f[3] >> c;\n    matrix a = init(), b = init_(), x = pow_(a, n - 4), y = pow_(a, n - 4), z = pow_(a, n - 5);\n    x = mul(x, b), y = mul(y, b), z = mul(z, b);\n    ll A = x.a[1][1], B = y.a[3][1], C = z.a[1][1], X = fast_mul(f[3], fast_pow(c, 3), mod), Y = fast_mul(f[2], fast_pow(c, 2), mod), Z = fast_mul(f[1], c, mod);\n    ll ans = fast_mul(fast_mul(fast_mul(fast_pow(X, A), fast_pow(Y, B), mod), fast_pow(Z, C), mod), fast_pow(fast_pow(c, n), mod - 2llu), mod);\n    std::cout << ans;\n    return 0;\n}\n\n```\n\n",
        "postTime": 1571395315,
        "uid": 61966,
        "name": "little_sun",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "## \u770b\u5230\u5176\u5b83\u9898\u89e3\u7684\u77e9\u9635\u8f83\u4e3a\u9ebb\u70e6\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u7b80\u5355\u4e00\u70b9\u7684\u529e\u6cd5\u3002\n\n\u4e4d\u4e00\u773c\u770b\u5230\u8fd9\u9053\u9898\u6ca1\u6709\u4efb\u4f55\u601d\u8def\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u9898\u76ee\uff0c\u6211\u4eec\u5f97\u7528\u5230\u4e00\u79cd\u6700\u539f\u59cb\u7684\u529e\u6cd5\uff1a**\u627e\u89c4\u5f8b\uff01**\n\n\u5217\u51fa\u4e86\u524d\u51e0\u9879$f_{x}$\uff0c\u5217\u51fa\u6bcf\u4e00\u9879\u7684\u7cfb\u6570\uff0c\u7a81\u7136\u53d1\u73b0\u8fd9\u4e2a\u7cfb\u6570\u662f\u53ef\u4ee5\u76f4\u63a5\u9012\u63a8\u7684\uff01\n\n\u5047\u8bbe$f_{x}=c^{a_{x}}f^{b_{x}}_{1}f^{d_{x}}_{2}f^{e_{x}}_{3}$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c$a_{x}=a_{x-1}+a_{x-2}+a_{x-3}+2x-6$\uff0c\u4f46\u662f\u8fd9\u4e2a\u540e\u9762\u6709\u4e00\u4e2a$2x-6$\u5f88\u4e0d\u597d\u5904\u7406\uff0c\u7136\u540e\u6211\u53d1\u73b0\uff0c$(x-1)+(x-2)+(x-3)=3x-6$\uff0c\u90a3\u4e48\uff0c\u4ee4$g_{x}=a_{x}+x$\uff0c\u539f\u5f0f\u5c45\u7136\u53d8\u6210\u4e86$g_{x}=g_{x-1}+g_{x-2}+g_{x-3}$\uff01\u8fd9\u4e0d\u5c31\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5417\uff1f\n\n\u518d\u8003\u8651\u540e\u9762\u4e09\u4e2a\u6570\u7ec4$b$\uff0c$d$\uff0c$e$\uff0c\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5~~\u6216\u627e\u89c4\u5f8b~~\u5f97\u5230\u5b83\u4eec\u7684\u9012\u63a8\u5f0f\u548c\u4e0a\u9762\u7684$g$\u76f8\u540c,\u53ea\u662f\u521a\u5f00\u59cb\u51e0\u9879\u4e0d\u540c\u800c\u5df2\uff01\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8f7b\u677e\u6c42\u51fa\u8fd9\u4e9b\u7cfb\u6570\u4e86\uff0c\u6839\u636e\u8fd9\u4e9b\u7cfb\u6570\u5373\u53ef\u5f97\u5230$f_{x}$\u3002\n\n\u4f46\u662f\uff0c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u8fd9\u4e9b\u7cfb\u6570\u90fd\u5f88\u5927\u3002\u6ce8\u610f\u5230\u6a21\u6570\u4e3a$1e9+7$\uff0c\u662f\u4e2a\u8d28\u6570\uff0c\u6839\u636e\u6b27\u62c9\u5b9a\u7406\uff0c\u5373\u53ef\u628a\u7cfb\u6570\u6a21$1e9+6$\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u4e86\u3002\n\n### \u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cctype>\n#include<utility>\n#include<algorithm>\n#include<cmath>\nusing namespace std;\n#define res register int\n#define ll long long\nconst ll mod=1e9+7;\nstruct node{\n\tint a[3][3];\n\tnode operator *(const node &b)const { //\u77e9\u9635\u4e58\u6cd5\uff0c\u6ce8\u610f\u6a21\u6570\uff01\n\t\tnode tot;memset(tot.a,0,sizeof(tot.a));\n\t\tfor(res i=0;i<3;++i)\n\t\t  for(res k=0;k<3;++k)\n\t\t    for(res j=0;j<3;++j) tot.a[i][j]=(tot.a[i][j]+(ll)a[i][k]*b.a[k][j])%(mod-1);\n\t\treturn tot;\n\t}\n} f,a;\nll n,tot,nn,now;\nint f1,f2,f3,c;\ninline ll kuai(ll p,ll q) {ll tot=1;for(;q;p=p*p%mod,q>>=1) if(q&1) tot=tot*p%mod;return tot;}\nint main()\n{\n\tfor(res i=0;i<3;++i) f.a[0][i]=i;\n    a.a[0][2]=a.a[1][0]=a.a[1][2]=a.a[2][1]=a.a[2][2]=1,scanf(\"%lld%d%d%d%d\",&n,&f1,&f2,&f3,&c),nn=n;\n    for(;nn;a=a*a,nn>>=1) if(nn&1) f=f*a;\n    tot=kuai(c,((f.a[0][0]-n)%(mod-1)+mod-1)%(mod-1)); //\u8fd9\u91cc\u8981\u6ce8\u610f\uff01\u522b\u5fd8\u4e86\u6c42\u51fa\u7684\u662fg\uff0c\u800c\u7cfb\u6570\u662fa\uff0c\u7b54\u6848\u9700\u8981\u51cfn\uff0c\u4f46\u53c8\u5f97\u9632\u6b62\u8d1f\u6570\u3002\n    nn=n-1,memset(a.a,0,sizeof(a.a)),a.a[0][2]=a.a[1][0]=a.a[1][2]=a.a[2][1]=a.a[2][2]=1,f.a[0][0]=1,f.a[0][1]=0,f.a[0][2]=0; //\u7531\u4e8e\u9012\u63a8\u5f0f\u76f8\u540c\uff0c\u63a5\u4e0b\u6765\u76f4\u63a5Ctrl+CV\u5373\u53ef\u3002\n    for(;nn;a=a*a,nn>>=1) if(nn&1) f=f*a;\n    tot=tot*kuai(f1,f.a[0][0])%mod;\n    nn=n-1,memset(a.a,0,sizeof(a.a)),a.a[0][2]=a.a[1][0]=a.a[1][2]=a.a[2][1]=a.a[2][2]=1,f.a[0][0]=0,f.a[0][1]=1,f.a[0][2]=0;\n    for(;nn;a=a*a,nn>>=1) if(nn&1) f=f*a;\n    tot=tot*kuai(f2,f.a[0][0])%mod;\n    nn=n-1,memset(a.a,0,sizeof(a.a)),a.a[0][2]=a.a[1][0]=a.a[1][2]=a.a[2][1]=a.a[2][2]=1,f.a[0][0]=0,f.a[0][1]=0,f.a[0][2]=1;\n    for(;nn;a=a*a,nn>>=1) if(nn&1) f=f*a;\n    tot=tot*kuai(f3,f.a[0][0])%mod;printf(\"%lld\\n\",tot);\n    return 0;\n}\n```",
        "postTime": 1562245706,
        "uid": 43697,
        "name": "chenyewei_1234",
        "ccfLevel": 7,
        "title": "CF1182E Product Oriented Recurrence"
    },
    {
        "content": "\u9898\u89e3\u533a\u90fd\u662f\u7528\u77e9\u9635\u76f4\u63a5\u7b97\u5c01\u95ed\u5f62\u5f0f\u4e2d $f_1,f_2,f_3$ \u7684\u7cfb\u6570\u7684\uff0c\u8fd9\u91cc\u7ed9\u4e2a\u66f4\u504f MO \u98ce\u683c\u4e14\u597d\u5199\u7684\u505a\u6cd5\u3002\n\n\u9996\u5148\u5148\u60f3\u529e\u6cd5\u7528 $f_x \\cdot k(x)$ \u4ee3 $f_x$ \u4ee5\u6d88\u6389 $c^{2x-6}$ \u8fd9\u4e2a\u4e0d\u597d\u5904\u7406\u7684\u4e1c\u897f\u3002\n\n\u660e\u663e $k(x)$ \u662f $c^{ax+b}$ \u7684\u5f62\u5f0f\uff0c\u4ee3\u8fdb\u53bb\u5bf9\u6bd4\u7cfb\u6570\u53ef\u4ee5\u53d1\u73b0 $a=1,b=0$\u3002\n\n\u4e8e\u662f $f_x \\cdot c^{x} = (f_{x-1}\\cdot c^{x-1}) (f_{x-2}\\cdot c^{x-2})(f_{x-3}\\cdot c^{x-3})$\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u770b\u7684\u5f62\u5f0f\u3002\n\n\u505a\u4e2a\u6362\u5143\uff0c$h_x=f_x \\cdot c^{x}$\uff0c$h$ \u7684\u524d\u4e09\u9879\u53ef\u4ee5\u4ee5 $f$ \u7b97\u51fa\u3002\n\n\u6211\u4eec\u77e5\u9053\u53d6\u4e2a $\\ln$ \u5c31\u662f\u6807\u51c6\u77e9\u4e58\u5f62\u5f0f\uff0c\u4f46\u662f\u663e\u7136\u6ca1\u5fc5\u8981\u3002\u5728\u77e9\u4e58\u4e2d\u7528\u4e58\u65b9\u4ee3\u66ff\u4e58\u53f7\uff0c\u7528\u4e58\u6cd5\u4ee3\u66ff\u52a0\u6cd5\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u505a\u8fd9\u79cd\u4e1c\u897f\u4e86\u3002\u4e8b\u5b9e\u4e0a\u5c31\u662f\u53d6\u4e2a\u6307\u6570\u540e\u7684\u666e\u901a\u77e9\u4e58\u3002\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u7684\u77e9\u9635\u4e0a\u9012\u63a8\u7684\u662f\u6307\u6570\u3002\n\n~~\u8fd9\u6837\u80fd\u5927\u5927\u51cf\u5c11\u4ee3\u7801\u91cf\uff0c\u81f3\u4e8e\u901f\u5ea6\uff0c\u6211\u8fd8\u6ca1\u8bd5\uff08~~\n\n\u7531\u4e8e\u6211\u7684\u77e9\u9635\u7528\u7684\u662f\u6a21\u677f\uff0c\u4ee3\u7801\u8fbe\u5230\u4e86 `2k`\uff0c\u7136\u800c\u6838\u5fc3\u90e8\u5206\u975e\u5e38\u77ed\u3002\n\n\u968f\u4fbf\u5199\u4e0d\u5361\u5e38\u5c31\u6709 `45ms`\uff0c\u8f7b\u677e\u8dd1\u8fdb\u7b2c\u4e00\u9875\uff0c\u540a\u6253\u90a3\u4e9b\u4e0a\u767e\u6beb\u79d2\u7684\u6bcf\u4e00\u9879\u5355\u72ec\u9012\u63a8\u3002\n\n\u6838\u5fc3\u90e8\u5206\u957f\u8fd9\u4e2a\u6837\uff1a\n\n```cpp\nsigned main(){\n    scanf(\"%lld %lld %lld %lld %lld\", &n, &f1, &f2, &f3, &c);\n    int h0 = 1ll * f3 * qpow(c, 3) % mod,\n        h1 = 1ll * f2 * qpow(c, 2) % mod,\n        h2 = 1ll * f1 * qpow(c, 1) % mod;\n    matrix tran(3, 3);\n    tran[0][0] = tran[0][1] = tran[1][0] = tran[1][2] = tran[2][0] = 1;\n    tran = tran ^ (n-1);\n    int ans = 1ll * qpow(h0, tran[0][2]) * qpow(h1, tran[1][2]) % mod\n                  * qpow(h2, tran[2][2]) % mod;\n    ans = 1ll * ans * qpow(inv(c), n % phi) % mod;\n    printf(\"%lld\\n\", ans);\n}\n```\n\n\u5b8c\u6574\u4ee3\u7801\u89c1 [\u6b64](https://www.luogu.com.cn/paste/t8motnhq)\uff0c\u4e5f\u53ea\u662f\u591a\u4e00\u4e9b\u77e9\u9635\u677f\u5b50\u548c\u5feb\u901f\u5e42\u677f\u5b50\u3002\n\n\u6ce8\u610f\u56e0\u4e3a\u77e9\u9635\u9012\u63a8\u7684\u662f\u6307\u6570\uff0c\u77e9\u9635\u8fd0\u7b97\u65f6\u8981\u819c $\\varphi(mod) = mod-1$\u3002\n\n\u8fd9\u9053\u9898\u7684\u5341\u51e0\u7bc7\u9898\u89e3\u51e0\u4e4e\u90fd\u662f\u53c8\u6162\u53c8\u96be\u5199\u7684\u6bcf\u9879\u5206\u5f00\u77e9\u4e58\uff0c\u552f\u4e00\u7684\u4e00\u7bc7\u4e0e\u6211\u7684\u601d\u8def\u76f8\u540c\u7684\u8fd8\u662f\u9760\u7075\u611f\u53d1\u73b0\u80fd\u591f\u505a\u6b64\u53d8\u6362\uff0c\u5b9e\u5728\u4ee4\u4eba\u611f\u6168\u3002",
        "postTime": 1664374532,
        "uid": 443664,
        "name": "Missa",
        "ccfLevel": 0,
        "title": "CF1182E \u9898\u89e3"
    },
    {
        "content": "\u9898\u610f\uff1a\n\n\u7ed9\u5b9a $n, f_1, f_2, f_3, c$, \u6709\u6570\u5217 $f$ \u6ee1\u8db3 $f_x = f_{x-1}f_{x-2}f_{x-3}c^{2x-6}(4 \\le x)$\n\n\u544a\u8bc9\u4f60\u6b63\u6574\u6570 $n\\ (4 \\le n \\le 10^{18})$ , \u8bd5\u6c42 $f_n$\u3002\n\n~~\u4ece\u6570\u636e\u8303\u56f4\u53ef\u4ee5\u770b\u51fa~~, \u8fd9\u9053\u9898\u662f\u4e00\u9053\u77e9\u9635\u5feb\u901f\u5e42\u7684\u9898\u76ee\n\n\u6bd4\u8f83\u5e38\u89c1\u7684\u77e9\u9635\u5feb\u901f\u5e42\u4e00\u822c\u5f62\u5982 $f_x = \\sum_{i=1}^{a}b_if_{x-i} + k$\n\n\u4f46\u6211\u4eec\u53d1\u73b0\u8fd9\u9053\u9898\u6709\u591a\u4e2a $f_i$ \u8fdb\u884c\u76f8\u4e58, \u56e0\u6b64\u6362\u4e00\u4e2a\u601d\u8def, \u6211\u4eec\u8003\u8651 $f_x$ \u4e2d $f_1, f_2, f_3$ \u7684\u6307\u6570\n\n\u5177\u4f53\u5730, \u6211\u4eec\u6709\u5982\u4e0b\u53d1\u73b0\uff1a\n\n$f_1 = f_1^1f_2^0f_3^0$\n\n$f_2 = f_1^0f_2^1f_3^0$\n\n$f_3 = f_1^0f_2^0f_3^1$\n\n$f_4 = f_1^1f_2^1f_3^1c^2$\n\n$f_5 = f_1^1f_2^2f_3^2c^6$\n\n$f_6=f_c^2f_2^3f_3^4c^{14}$\n\n\u7b49\u7b49\u3002\n\n\u7531\u4e8e $f_x=f_{x-1}f_{x-2}f_{x-3}c^{2x-6}$\n\n\u6211\u4eec\u80fd\u5f97\u5230 $f_x$ \u4e2d $f_1,f_2,f_3$ \u7684\u6307\u6570\u5747\u4e3a $f_{x-1},f_{x-2},f_{x-3}$ \u4e2d\u4ed6\u4eec\u5404\u81ea\u7684\u6307\u6570\u548c\u3002\n\n\u53c8\u6709 $2x-6-(2(x-1)-6) = 2$, \u5f97\u5230 $f_x$ \u4e2d $c$ \u7684\u6307\u6570\u4e3a $f_{x-1}, f_{x-2}, f_{x-3}$ \u4e2d\u5404\u81ea\u7684\u6307\u6570\u548c\u52a0\u4e0a $2$\n\n\u8fd9\u65f6\u6211\u4eec\u53d1\u73b0, \u6211\u4eec\u7b97\u6307\u6570\u7684\u6b65\u9aa4, \u5df2\u7ecf\u662f\u6211\u4eec\u719f\u77e5\u7684\u77e9\u9635\u5feb\u901f\u5e42\u4e86\n\n\u56e0\u6b64, \u5bf9\u4e8e $f_x$ \u4e2d $f_1, f_2, f_3, c$ \u7684\u6307\u6570\u6211\u4eec\u5747\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u6c42\u51fa\u6765\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u8bbe\u8ba1\u77e9\u9635:\n\n\u6211\u4eec\u7528 $C_i$ \u6765\u8868\u793a $f_i$ \u4e2d $c$ \u7684\u6307\u6570, \u7531\u4e0a\u6709 $C_i = C_{i-1} + C_{i-2} + C_{i-3} + 2i-6$\n\n\u5219 $[C_{i-1}, C_{i-2}, C_{i-3}, 2i-6] \\times base = [C_i, C_{i-1}, C_{i-2}, C_{i-3}, 2i-4]$ \n\n\u503c\u5f97\u6ce8\u610f\u7684\u662f, \u6211\u4eec\u8981\u4f7f $2i-6$ \u53d8\u4e3a $2i-4$, \u6211\u4eec\u8981\u65b0\u6dfb\u52a0\u4e00\u4e2a $2$ \u8ba9\u539f\u672c\u7684 $2i-6$ \u52a0\u4e0a\u53bb\n\n\u56e0\u6b64$[C_{i-1}, C_{i-2}, C_{i-3}, 2i-6, 2] \\times base = [C_i, C_{i-1}, C_{i-2}, C_{i-3}, 2i-4, 2]$ \n\n\u56e0\u6b64\u6709 $base = \\begin{bmatrix}1&1&0&0&0\\\\1&0&1&0&0&\\\\1&0&0&0&0&\\\\1&0&0&2&0\\\\0&0&0&0&1\\end{bmatrix}$\n\n\u5bf9\u4e8e $f_1, f_2, f_3$ \u7684\u60c5\u51b5, \u6211\u4eec\u80fd\u63a8\u51fa:\n\n$base2 = \\begin{bmatrix}1&1&0\\\\1&0&1\\\\1&0&0\\end{bmatrix}$\n\n\u8fd9\u65f6, \u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86 $f_x$ \u4e2d $f_1, f_2, f_3, c$ \u7684\u6307\u6570, \u4f46\u6211\u4eec\u53d1\u73b0, \u4ed6\u4eec\u53ef\u80fd\u4f1a\u7206\u6389 $long\\ long$\n\n\u8fd9\u65f6\u6211\u4eec\u8981\u7528\u6389\u6b27\u62c9\u5b9a\u7406: $a^b \\equiv a^{b \\%\\varphi(p)} (mod\\ p)$\n\n\u7531\u4e8e\u6b64\u9898\u7684\u6a21\u6570\u5f0f\u4e00\u4e2a\u8d28\u6570, \u4e0d\u96be\u5f97\u51fa $\\varphi(p) = p - 1$, \u76f4\u63a5\u5bf9\u5176\u8fdb\u884c\u53d6\u6a21\u5373\u53ef\n\n\u4ee3\u7801\u5982\u4e0b:\n\n```\n#include <bits/stdc++.h>\n#define int long long\n#define mod 1000000007\nusing namespace std;\nstruct matrix {\n\tint s[6][6];\n\tmatrix() {memset(s, 0, sizeof(s));};\n\tmatrix operator * (const matrix &rhs) const {\n\t\tmatrix res;\n\t\tfor(int i = 1;i <= 5;i++) {\n\t\t\tfor(int j = 1;j <= 5;j++) {\n\t\t\t\tfor(int k = 1;k <= 5;k++) {\n\t\t\t\t\tres.s[i][j] += s[i][k] * rhs.s[k][j];\n\t\t\t\t\tres.s[i][j] %= (mod - 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n}base1, base2, w, x, y, z;\nint n, f1, f2, f3, c;\nvoid init() {\n\tbase1.s[1][1] = base1.s[1][2] = base1.s[2][1] = base1.s[2][3] = base1.s[3][1] = base1.s[4][1] = 1;\n\tbase1.s[4][4] = 1, base1.s[5][4] = 1, base1.s[5][5] = 1;\n\tbase2.s[1][1] = base2.s[1][2] = base2.s[2][1] = base2.s[3][1] = base2.s[2][3] = 1;\n\tw.s[1][1] = 0, w.s[1][2] = 0, w.s[1][3] = 0, w.s[1][4] = 2, w.s[1][5] = 2;\n\tx.s[1][3] = 1;\n\ty.s[1][2] = 1;\n\tz.s[1][1] = 1;\n}\nvoid cksm(int q) {\n\twhile(q) {\n\t\tif(q & 1) w = w * base1;\n\t\tbase1 = base1 * base1;\n\t\tq >>= 1;\n\t}\n}\nvoid qksm(int q) {\n\twhile(q) {\n\t\tif(q & 1) {\n\t\t\t\n\t\t\tx = x * base2;\n\t\t\ty = y * base2;\n\t\t\tz = z * base2;\n\t\t}\n\t\tbase2 = base2 * base2;\n\t\tq >>= 1;\n\t}\n}\nint ksm(int p, int q) {\n\tint res = 1;\n\twhile(q) {\n\t\tif(q & 1) {\n\t\t\tres *= p;\n\t\t\tres %= mod;\n\t\t}\n\t\tp *= p;\n\t\tp %= mod;\n\t\tq >>= 1;\n\t}\n\treturn res;\n}\nsigned main() {\n\tscanf(\"%lld%lld%lld%lld%lld\", &n, &f1, &f2, &f3, &c);\n\tinit();\n\tif(n == 1) cout << f1 << endl;\n\telse if(n == 2) cout << f2 << endl;\n\telse if(n == 3) cout << f3 << endl;\n\telse {\n\t\tcksm(n - 3);\n\t\tqksm(n - 3);\n\t\tint p1 = w.s[1][1], p2 = x.s[1][1], p3 = y.s[1][1], p4 = z.s[1][1];\n\t\tcout << (ksm(c, p1) % mod * ksm(f1, p2) % mod * ksm(f2, p3) % mod * ksm(f3, p4) % mod) % mod << endl;\n\t}\n}\n```\n",
        "postTime": 1634891655,
        "uid": 503822,
        "name": "Essinsop",
        "ccfLevel": 0,
        "title": "CF1182E\u9898\u89e3"
    },
    {
        "content": "# \u601d\u8def\u5206\u6790\n\n\u6211\u4eec\u5316\u4e58\u4e3a\u52a0\n\n$f_i=c^{w_i}f_1^{x_i}f_2^{y_i}f_3^{z_i}$\n\n$w_i=w_{i-1}+w_{i-2}+w_{i-3}+2i-6$\n\n$x_i=x_{i-1}+x_{i-2}+x_{i-3}$\n\n$y_i=y_{i-1}+y_{i-2}+y_{i-3}$\n\n$z_i=z_{i-1}+z_{i-2}+z_{i-3}$\n\n\u90a3\u4e48\u8fd9\u5c31\u662f\u77e9\u9635\u5feb\u901f\u5e42\u88f8\u9898\u4e86\u3002\n\n\u6839\u636e\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\uff0c\u77e9\u9635\u5feb\u901f\u5e42\u7684\u65f6\u5019\u8981\u5bf9 $\\phi(10^9+7)=10^9+6$ \u53d6\u6a21\u3002\n\n\u53e6\u5916\u8fd9\u662f\u6211\u4e2a\u4eba\u603b\u7ed3\u7684\u4e00\u4e2a\u89c4\u5f8b\uff0c\u4e0d\u4fdd\u8bc1\u6b63\u786e\u6027\uff1a\u9012\u63a8\u5f0f\u5e26\u4e86\u4e00\u4e2a\u591a\u9879\u5f0f\u65f6\uff08$w_i=w_{i-1}+w_{i-2}+...+A(i)$\uff09\uff0c\u6bd4\u5982\u672c\u9898 $A(i)=2i-6$\uff0c\u591a\u9879\u5f0f\u6709\u51e0\u9879\uff0c\u8f6c\u79fb\u77e9\u9635\u5c31\u8981\u591a\u51e0\u884c\u548c\u5217\u3002\n\n\u5b9e\u73b0\u7ec6\u8282\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n# \u4ee3\u7801\u65f6\u95f4\n```cpp\n#include<cstdio>\n#include<cstring>\n#define int long long\nnamespace QiFeng233{\n\tconst int PHI=1e9+6,MOD=1e9+7;\n\tstruct matrix{\n\t\tint size,mat[6][6];\n\t\tmatrix(int sz){\n\t\t\tsize=sz;\n\t\t\tmemset(mat,0,sizeof(mat));\n\t\t}\n\t\tfriend matrix operator*(matrix a,matrix b){\n\t\t\tmatrix c(a.size);\n        \tfor(int i=1;i<=c.size;++i)\n                for(int j=1;j<=c.size;++j)\n            \t\tfor(int k=1;k<=c.size;++k)\n                    \tc.mat[i][j]=(c.mat[i][j]+a.mat[i][k]*b.mat[k][j])%PHI;\n        \treturn c;\n\t\t}\n\t};\n\tint ksm(int a,int b){\n\t\tint res=1,tmp=a;\n\t\twhile(b){\n\t\t\tif(b&1){\n\t\t\t\tres=res*tmp;\n\t\t\t\tres%=MOD;\n\t\t\t}\n\t\t\ttmp=tmp*tmp;\n\t\t\ttmp%=MOD;\n\t\t\tb>>=1;\n\t\t}\n\t\treturn res;\n\t}\n\tmatrix ksm(matrix a,int b){\n\t\tmatrix res=matrix(a.size),tmp=a;\n\t\tfor(int i=1;i<=a.size;++i)res.mat[i][i]=1; \n\t\twhile(b){\n\t\t\tif(b&1){\n\t\t\t\tres=res*tmp;\n\t\t\t}\n\t\t\ttmp=tmp*tmp;\n\t\t\tb>>=1;\n\t\t}\n\t\treturn res;\n\t}\n\tint n,f1,f2,f3,c;\n\tmatrix x(3),y(3),z(3),w(5),A(3),B(5);\n\tvoid solve(){\n\t\tscanf(\"%lld%lld%lld%lld%lld\",&n,&f1,&f2,&f3,&c);\n\t\tx.mat[3][1]=y.mat[2][1]=z.mat[1][1]=1;\n\t\tw.mat[5][1]=2;\n\t\tA.mat[1][1]=A.mat[1][2]=A.mat[1][3]=A.mat[2][1]=A.mat[3][2]=1;\n\t\tB.mat[1][1]=B.mat[1][2]=B.mat[1][3]=B.mat[1][4]=B.mat[1][5]=B.mat[2][1]=B.mat[3][2]=B.mat[4][4]=B.mat[4][5]=B.mat[5][5]=1;\n\t\tA=ksm(A,n-3),B=ksm(B,n-3);\n\t\tx=A*x,y=A*y,z=A*z,w=B*w;\n\t\tint ans=ksm(c,w.mat[1][1])%MOD*ksm(f1,x.mat[1][1])%MOD*ksm(f2,y.mat[1][1])%MOD*ksm(f3,z.mat[1][1])%MOD;\n\t\tprintf(\"%lld\",ans%MOD);\n\t}\n}\nsigned main(){\n\tQiFeng233::solve();\n\treturn 0;\n}\n```",
        "postTime": 1585204028,
        "uid": 233357,
        "name": "QiFeng233",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "\u5fc3\u8def\u5386\u7a0b\uff1a\n\n\u6bd4\u8d5b\u65f6\u4e00\u770b\u5230\u9012\u63a8\u9898\u9762\uff0c\u679c\u65ad\u5224\u65ad\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u6240\u4ee5$Tribonacci$\u662f\u8001\u5957\u8def\uff0c\u90a3\u4e48$c$\u7684\u6b21\u6570\u600e\u4e48\u8ba1\u7b97\u5462\uff1f\n\n\u6211\u63a8\u4e86\u524d\u51e0\u9879\u7684\u6b21\u6570\uff0c\u770b\u770b\u80fd\u5426\u627e\u5230\u89c4\u5f8b\u3002\n\n$0,0,0,2,6,14,30,60,...$\n\n\u7531\u4e8e\u8fd9\u4e2a\u6570\u5217\u662f\u524d\u4e09\u9879\u4e4b\u548c\u52a0\u4e00\u4e2a\u6570\uff0c\u5f88\u81ea\u7136\u60f3\u5230\u5dee\u5206\u3002\n\n\u6211\u7684\u5dee\u5206\u8fc7\u7a0b\uff1a\n\n\u539f\u6570\u5217\uff1a$0,0,0,2,6,14,30,60,...$\n\n\u9664\u4ee5$2$\u540e\uff08\u7531\u4e8e\u6bcf\u9879\u90fd\u662f\u5076\u6570\uff09\uff1a$0,0,0,1,3,7,15,30,...$\n\n\u4e00\u9636\u5dee\u5206\uff1a$0,0,1,2,4,8,15,...$\n\n\u4e8c\u9636\u5dee\u5206\uff1a$0,1,1,2,4,7,...$\n\n\u4e8e\u662f\u6211\u4eec\u770b\u5230\u4e86\u8457\u540d\u7684$Tribonacci$\u6570\u5217\uff01\n\n\u7531$Tribonacci$\u6570\u5217\u7684\u6027\u8d28\u56de\u63a8\u53ef\u4ee5\u5f97\u51fa$c$\u6b21\u6570\u7684\u9012\u63a8\u5f0f\uff1a\n\n$a_n=a_{n-5}-2a_{n-4}-2a_{n-2}+3a_{n-1}(n \\ge 6,a_1=a_2=a_3=0,a_4=2,a_5=6)$\uff0c\u4e8e\u662f\u5f97\u51fa\u77e9\u9635\u5982\u4e0b\uff1a\n\n$$\\begin{bmatrix}0&0&0&0&1\\\\1&0&0&0&-2\\\\0&1&0&0&0\\\\0&0&1&0&-2\\\\0&0&0&1&3\\end{bmatrix}$$\n\n\u77e9\u9635\n\n$$\\begin{bmatrix}2&6&14&30&60\\end{bmatrix}$$\n\n\u4e0e\u4ee5\u4e0a\u77e9\u9635\u7684$(n-4)$\u6b21\u65b9\u76f8\u4e58\u540e\u7684\u77e9\u9635\u7b2c\u4e00\u884c\u7b2c\u4e00\u5217\u7684\u6570\u5373\u4e3a\u7b54\u6848\u4e2d$c$\u7684\u6b21\u6570\u3002\n\n\u7136\u800c\u6211\u6bd4\u8d5b\u65f6\u4e00\u76f4`TLE on pretest 18`\uff0c\u540e\u6765\u624d\u53d1\u73b0\u77e9\u4e58\u65f6\u4e58\u8d1f\u6570\u4f7f\u5f97\u8d1f\u6b21\u6570\u5feb\u901f\u5e42\u8dd1\u4e0d\u52a8\u3002\u3002\u3002\u52a0\u4e0a\u4e00\u4e2a(+MOD)%MOD\u5c31AC\u4e86\uff0c\u6211\u8fd8\u662f\u592a\u83dc\u4e86\u3002\n\n\u4f3c\u4e4edalao\u4eec\u548c\u6211\u7684\u77e9\u9635\u90fd\u4e0d\u4e00\u6837\u8036\u3002\n\nCode:\n```cpp\n#pragma G++ optimize(2)\n#pragma G++ optimize(3)\n#include<cstdio>\n#include<cstring>\n#define rg register\n#define ll long long\nconst int MOD=1e9+6;\nconst int P=1e9+7;\nconst int BUF_SIZE=1000000;\ninline char rc()\n{\n    static char buf[BUF_SIZE],*ps=buf,*pe=buf;\n    if(ps==pe)\n    {\n        pe=buf+fread(buf,1,BUF_SIZE,stdin);\n    }\n    return *ps++;\n}\ninline ll read()\n{\n    ll x=0;char c=rc();\n    while(c<'0'||c>'9')c=rc();\n    while(c>='0'&&c<='9')x=x*10+c-'0',c=rc();\n    return x;\n}\ninline void mul(ll s[5][5],ll t[5][5])\n{\n    ll p[5][5];\n    for(rg int i=0;i<5;++i)\n    {\n        for(rg int j=0;j<5;++j)\n        {\n            p[i][j]=0;\n            for(rg int k=0;k<5;++k)\n            {\n                p[i][j]=((p[i][j]+s[i][k]*t[k][j]%MOD+MOD)%MOD\n            }\n        }\n    }\n    for(rg int i=0;i<5;++i)\n    {\n        for(rg int j=0;j<5;++j)\n        {\n            s[i][j]=p[i][j];\n        }\n    }\n}\ninline void mul1(ll s[3][3],ll t[3][3])\n{\n    ll p[3][3];\n    for(rg int i=0;i<3;++i)\n    {\n        for(rg int j=0;j<3;++j)\n        {\n            p[i][j]=0;\n            for(rg int k=0;k<3;++k)\n            {\n                p[i][j]=(p[i][j]+s[i][k]*t[k][j])%MOD;\n            }\n        }\n    }\n    for(rg int i=0;i<3;++i)\n    {\n        for(rg int j=0;j<3;++j)\n        {\n            s[i][j]=p[i][j];\n        }\n    }\n}\nll n,a,b,c,k,ans=1;\nll r[5][5],r1[3][3];\nll s1[3][3]={\n    {0,0,1},\n    {1,0,1},\n    {0,1,1}\n    };\nll s2[5][5]={\n    {0,0,0,0,1},\n    {1,0,0,0,-1},\n    {0,1,0,0,0},\n    {0,0,1,0,-2},\n    {0,0,0,1,3}\n    };\nll s3[3][3]={\n    {1,0,0},\n    {0,0,0},\n    {0,0,0}\n    };\nll s4[3][3]={\n    {0,1,0},\n    {0,0,0},\n    {0,0,0}\n    };\nll s5[3][3]={\n    {0,0,1},\n    {0,0,0},\n    {0,0,0}\n    };\nll s6[5][5]={\n    {2,6,14,30,60},\n    {0,0,0,0,0},\n    {0,0,0,0,0},\n    {0,0,0,0,0},\n    {0,0,0,0,0}\n    };\ninline void qpw(rg ll s[5][5],rg ll k)\n{\n    for(rg int i=0;i<5;++i)\n    {\n        for(rg int j=0;j<5;++j)\n        {\n            r[i][j]=(i==j);\n        }\n    }\n    while(k)\n    {\n        (k&1)&&(mul(r,s),1);\n        mul(s,s),k>>=1;\n    }\n}\ninline void qpw1(rg ll s[3][3],rg ll k)\n{\n    for(rg int i=0;i<3;++i)\n    {\n        for(rg int j=0;j<3;++j)\n        {\n            r1[i][j]=(i==j);\n        }\n    }\n    while(k)\n    {\n        (k&1)&&(mul1(r1,s),1);\n        mul1(s,s),k>>=1;\n    }\n}\ninline ll qpwr(rg ll x,rg ll k)\n{\n    rg ll res=1;\n    while(k)\n    {\n        (k&1)&&(res=res*x%P);\n        x=x*x%P,k>>=1;\n    }\n    return res;\n}\nint main()\n{\n    n=read(),a=read(),b=read(),c=read(),k=read();\n    qpw1(s1,n-3);\n    mul1(s3,r1),mul1(s4,r1),mul1(s5,r1),qpw(s2,n-4);\n    mul(s6,r);\n    a=qpwr(a,s3[0][2]),b=qpwr(b,s4[0][2]),c=qpwr(c,s5[0][2]),k=qpwr(k,s6[0][0]);\n    ans=((ans*a*b%P)*c%P)*k%P;\n    printf(\"%I64d\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1561020420,
        "uid": 59388,
        "name": "VinstaG173",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1182E \u3010Product Oriented Recurrence\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\n\n- \u6c42\uff1a\n\n$$f_x=c^{2x-6}f_{x-1}f_{x-2}f_{x-3}$$\n\n---\n\n\u8003\u8651\u9010\u4e2a\u62c6\u5f00\uff0c\u9012\u63a8\u6c42\u6307\u6570\uff0c\u6b27\u62c9\u5b9a\u7406+\u5feb\u901f\u5e42\u5408\u5e76\u3002\n\n$x=3$ \u4e4b\u524d\u7684\u6307\u6570\u4e0d\u7528\u7b97\u4e86\u3002\n\n1. $x=4$ \u65f6\uff0c$f_4=c^2\\times f_1\\times f_2\\times f_3$\n2. $x=5$ \u65f6\uff0c$f_5=c^6\\times f_1\\times f_2^2\\times f_3^2$\n3. $x=6$ \u65f6\uff0c$f_6=c^{14}\\times f_1^2\\times f_2^3\\times f_3^4$\n4. ...\n\n\u7531\u4e8e $f_x=c^{2x-6}f_{x-1}f_{x-2}f_{x-3}$\uff0c\u6240\u4ee5 $c,f_1,f_2,f_3$ \u7684\u6307\u6570\u662f\u53ef\u4ee5\u5199\u6210\u9012\u63a8\u5f62\u5f0f\u7684\uff1a\n\n- $c:x_i=x_{i-1}+x_{i-2}+x_{i-3}+2i-6$\n- $f_{1},f_{2},f_{3}:y_i=y_{i-1}+y_{i-2}+y_{i-3}$\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c$f_1,f_2$ \u548c $f_3$ \u7cfb\u6570\u9012\u63a8\u5f0f\u524d\u4e09\u4f4d\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u5373\u4f7f\u8f6c\u79fb\u77e9\u9635\u4e00\u6837\uff0c $ans$ \u77e9\u9635\u521d\u59cb\u5316\u7684\u65f6\u5019\u4e5f\u8981\u8d4b\u4e0d\u540c\u7684\u6570\u503c\u3002\n\n\u540e\u9762\u90a3\u4e2a $f_1,f_2,f_3$ \u5f88\u597d\u8bf4\uff0c\u4e3b\u8981\u662f\u524d\u9762\u8fd9\u4e2a $c$\uff1a\n\n$$x_i=x_{i-1}+x_{i-2}+x_{i-3}+2i-6$$\n\n\u540e\u9762\u8fd9\u4e2a $2i-6$ \u548b\u529e\uff1f\n\n\u53d1\u73b0\u6bcf\u4e00\u6b21 $i$ \u53d8\u6210 $i+1$ \u7684\u65f6\u5019 $2i-6$ \u9012\u589e\u4e00\u4e2a**\u5b9a\u503c** $2$\u3002\n\n\u6211\u4eec\u628a\u8fd9\u4e2a $2$ \u585e\u5230\u77e9\u9635\u91cc\u9762\u548c\u4e4b\u524d\u7684 $2(i-1)-6=2i-8$ \u505a\u4e2a\u52a0\u6cd5\uff1a\n\n$\\begin{bmatrix}f_{i-1}\\quad f_{i-2}\\quad f_{i-3}\\quad 2i-8\\quad 2\\end{bmatrix}\\times \\mathtt{base}=\\begin{bmatrix}f_{i}\\quad f_{i-1}\\quad f_{i-2}\\quad 2i-6\\quad 2\\end{bmatrix}$\n\n\u7531 $x_i=x_{i-1}+x_{i-2}+x_{i-3}+2i-6$ \u89e3\u51fa\uff1a\n\n$$\\mathtt{base}=\\begin{bmatrix}1\\quad 1\\quad 0\\quad 0\\quad 0\\\\1\\quad 0\\quad 1\\quad 0\\quad 0\\\\1\\quad 0\\quad 0\\quad 0\\quad 0\\\\1\\quad 0\\quad 0\\quad 1\\quad 0\\\\1\\quad 0\\quad 0\\quad 1\\quad 1\\end{bmatrix}$$\n\n\u7136\u540e\u4e4b\u540e\u5c31\u7b80\u5355\u4e86\uff0c\u521d\u59cb\u5316\u7b54\u6848\u77e9\u9635\u5373\u53ef\u3002\n\n---\n\n\u548b\u5408\u5e76\u7b54\u6848\u5462\uff1f\n\n\u7531\u6b27\u62c9\u5b9a\u7406\u6211\u4eec\u77e5\u9053\uff1a\n\n$$a^b\\equiv a^{b\\mod \\varphi(p)}\\mod p$$\n\n\u7136\u540e $\\varphi(p)=\\sum\\limits_{i=1}^{p-1}[\\gcd(i,p)=1]$\uff0c\u7531\u4e8e $p=10^9+7$ \u662f\u4e00\u4e2a\u5947\u6570\uff0c\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u6307\u6570\u5bf9 $10^9+6$ \u53d6\u6a21\u5373\u53ef\u3002\n\n\u6700\u540e\u5feb\u901f\u5e42\u518d\u4e58\u8d77\u6765\u5c31\u7ed3\u675f\u5566\u3002![](https://\u5567.tk/doge)\n\n\u590d\u6742\u5ea6 $O(t^3 \\log n)$\uff0c$t$ \u4e3a\u77e9\u9635\u5927\u5c0f\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nconst int mod = 1e9 + 7, phi = 1e9 + 6;\nstruct matrix {// \u77e9\u9635\u7ed3\u6784\u4f53\n\tint s[10][10], sz;\n\tmatrix () { memset(s, 0, sizeof(s)); }\n\tmatrix operator * (const matrix &rhs) const { \n\t\tmatrix res;\n\t\tres.sz = sz;\n\t\tfor (int i = 1; i <= sz; i++) {\n\t\t\tfor (int j = 1; j <= sz; j++) {\n\t\t\t\tfor (int k = 1; k <= sz; k++) {\n\t\t\t\t\tres.s[i][j] = (res.s[i][j] + s[i][k] * rhs.s[k][j]) % phi;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n} base1, base2, ans1, ans2, ans3, ans4;\nint n, c, f1, f2, f3, p1, p2, p3, p4;\n\nvoid init() {// \u521d\u59cb\u5316\u77e9\u9635\n\tbase1.sz = ans1.sz = 5;\n\tbase2.sz = ans2.sz = ans3.sz = ans4.sz = 3;\n\tbase1.s[1][1] = base1.s[1][2] = base1.s[2][1] = base1.s[2][3] = base1.s[3][1] = base1.s[4][1] = base1.s[4][4] = base1.s[5][1] = base1.s[5][4] = base1.s[5][5] = 1;\n\tbase2.s[1][1] = base2.s[1][2] = base2.s[2][1] = base2.s[2][3] = base2.s[3][1] = 1;\n\tans2.s[1][1] = 4, ans3.s[1][1] = 3, ans2.s[1][2] = ans3.s[1][2] = ans4.s[1][1] = 2;\n\tans2.s[1][3] = ans3.s[1][3] = ans4.s[1][2] = ans4.s[1][3] = 1;\n\tans1.s[1][5] = 2, ans1.s[1][1] = 14, ans1.s[1][2] = 6, ans1.s[1][3] = 2, ans1.s[1][4] = 6;\n}\n\nvoid ksm_matrix(int p) {// \u77e9\u9635\u5feb\u901f\u5e42\n\twhile (p) {\n\t\t\n\t\tif (p & 1) ans1 = ans1 * base1, ans2 = ans2 * base2, ans3 = ans3 * base2, ans4 = ans4 * base2;\n\t\tbase1 = base1 * base1, base2 = base2 * base2;\n\t\tp >>= 1;\n\t}\n}\n\nint ksm_int(int p, int q) {\n\tint res = 1;\n\twhile (q) {\n\t\tif (q & 1) res = res * p % mod;\n\t\tp = p * p % mod;\n\t\tq >>= 1;\n\t}\n\treturn res;\n}\n\nsigned main() {\n\tscanf(\"%lld%lld%lld%lld%lld\", &n, &f1, &f2, &f3, &c);\n\tif (n <= 6) {\n\t\tif (n == 4) printf(\"%lld\", c * c % mod * f3 % mod * f2 % mod * f1 % mod);\n\t\telse if (n == 5) printf(\"%lld\", ksm_int(c, 6) * ksm_int(f3, 2) % mod * ksm_int(f2, 2) % mod * f1 % mod);\n\t\telse printf(\"%lld\", ksm_int(c, 14) * ksm_int(f3, 4) % mod * ksm_int(f2, 3) % mod * ksm_int(f1, 2) % mod);\n\t\treturn 0;\n\t}\n\tinit();\n\tksm_matrix(n - 6);\n\tp1 = ksm_int(c, ans1.s[1][1]);\n\tp2 = ksm_int(f3, ans2.s[1][1]);\n\tp3 = ksm_int(f2, ans3.s[1][1]);\n\tp4 = ksm_int(f1, ans4.s[1][1]);\n\tprintf(\"%lld\", p1 * p2 % mod * p3 % mod * p4 % mod);\n\treturn 0;\n}\n```",
        "postTime": 1634890835,
        "uid": 306573,
        "name": "Ender32k",
        "ccfLevel": 0,
        "title": "CF1182E Product Oriented Recurrence \u9898\u89e3"
    }
]