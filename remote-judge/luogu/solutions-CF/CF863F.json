[
    {
        "content": "\u8d39\u7528\u6d41\u4e4b\u5dee\u5206\u5efa\u56fe\n\n\u7ed9\u6211\u7684[\u7f51\u7edc\u6d41 blog](https://www.luogu.com.cn/blog/et2006/wang-lao-liu-hao-ti-ti-xie-hui-zong) \u6253\u4e2a call\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709\u9650\u5236\u90fd\u8f6c\u5316\u4e3a $a_i$ \u5728\u533a\u95f4 $[l_i,r_i]$ \u4e2d\u3002\u5982\u679c $l_i \\geq r_i$\uff0c\u90a3\u4e48\u8bf4\u660e\u65e0\u89e3\uff0c\u5426\u5219\u4e00\u5b9a\u6709\u89e3\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u8003\u8651\u8fd9\u4e2a\u89e3\u600e\u4e48\u6c42\u3002\u6211\u4eec\u5c06\u6bcf\u4e2a\u70b9\u62c6\u6210 $2$ \u4e2a\u70b9\uff0c\u5176\u4e2d\u4e24\u4e2a\u662f\u5165\u70b9\u548c\u51fa\u70b9 $in,out$\u3002\u7531\u4e8e\u4ee3\u4ef7\u4e3a $\\sum cnt(i)^2$\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5dee\u5206\u5efa\u56fe\uff0c\u5373 $n^2=1+3+\\dots+(2n-1)$\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff08\u6ce8\u610f\uff0c\u4e0d\u8981\u8ddf\u4e0b\u6807\u641e\u6df7\u4e86\uff09\u518d\u5efa $2$ \u4e2a\u70b9\uff0c\u79f0\u4e3a $i.a,i.b$\u3002\u8fd9\u6837\u5efa\u56fe\u65b9\u5f0f\u5c31\u6bd4\u8f83\u663e\u7136\u4e86\uff1a\n\n1. \u5bf9\u4e8e\u6bcf\u4e2a\u4e0b\u6807 $i$\uff0c\u8fde\u4e00\u6761\u8fb9 $(S,i.in,1,0)$\uff0c\u8868\u793a\u6bcf\u4e2a $a_i$ \u53ea\u80fd\u53d6 $1$ \u4e2a\u503c\u3002\u540c\u7406\uff0c\u8fde\u8fb9 $(i.out,T,1,0)$\u3002\n2. \u5bf9\u4e8e\u6bcf\u4e2a\u4e0b\u6807 $i$\uff0c\u679a\u4e3e $a_i$ \u53ef\u4ee5\u53d6\u7684\u503c $j \\in [l_i,r_i]$\uff0c\u8fde\u8fb9 $(i.in,j.a,1,0),(j.b,i.out,1,0)$\u3002\n3. \u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u503c $val$\uff0c\u5728 $i.a$ \u4e0e $i.b$ \u4e4b\u95f4\u8fde $n$ \u6761\u8fb9\uff0c\u5bb9\u91cf\u5747\u4e3a $1$\uff0c\u8d39\u7528\u5206\u522b\u4e3a $1,3,5,7,\\dots,2n-1$\uff0c\u5dee\u5206\u5904\u7406\u90a3\u4e2a\u201c\u5e73\u65b9\u201d\u3002\n\n\u7136\u540e\u8dd1\u6700\u5c0f\u8d39\u7528\u6700\u5927\u6d41\u5c31\u662f\u7b54\u6848\u3002\n\n```cpp\n/*\n\u6570\u636e\u4e0d\u6e05\u7a7a\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u591a\u6d4b\u4e0d\u8bfb\u5b8c\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8fb9\u754c\u4e0d\u7279\u5224\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d2a\u5fc3\u4e0d\u8bc1\u660e\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\nD P \u987a\u5e8f\u9519\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u5927\u5c0f\u5c11\u7b49\u53f7\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u53d8\u91cf\u4e0d\u7edf\u4e00\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d8a\u754c\u4e0d\u5224\u65ad\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8c03\u8bd5\u4e0d\u6ce8\u91ca\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u6ea2\u51fa\u4e0d l l\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n*/\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi\t\t\tfirst\n#define se\t\t\tsecond\n#define fz(i,a,b)\tfor(int i=a;i<=b;i++)\n#define fd(i,a,b)\tfor(int i=a;i>=b;i--)\n#define foreach(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define put(x)\t\tputchar(x)\n#define eoln        put('\\n')\n#define space\t\tput(' ')\n#define y1\t\t\ty_chenxiaoyan_1\n#define y0\t\t\ty_chenxiaoyan_0\ninline int read(){\n\tint x=0,neg=1;char c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-')\tneg=-1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c))\tx=x*10+c-'0',c=getchar();\n\treturn x*neg;\n}\ninline void print(int x){\n\tif(x<0){\n\t\tputchar('-');\n\t\tprint(abs(x));\n\t\treturn;\n\t}\n\tif(x<=9)\tputchar(x+'0');\n\telse{\n\t\tprint(x/10);\n\t\tputchar(x%10+'0');\n\t}\n}\ninline int qpow(int x,int e,int _MOD){\n\tint ans=1;\n\twhile(e){\n\t\tif(e&1)\tans=ans*x%_MOD;\n\t\tx=x*x%_MOD;\n\t\te>>=1;\n\t}\n\treturn ans;\n}\nint head[100005],ecnt=1;\nstruct edge{\n\tint to,nxt,cap,cost;\n} e[1000005];\ninline void addedge(int u,int v,int f,int c){\n\te[++ecnt].to=v;e[ecnt].cap=f;e[ecnt].cost=c;e[ecnt].nxt=head[u];head[u]=ecnt;\n}\nbool vis[100005];\nint dist[100005],flow[100005],pre[100005],pos[100005];\ninline bool spfa(int s,int t){\n\tmemset(vis,1,sizeof(vis));\n\tmemset(dist,63,sizeof(dist));\n\tqueue<int> q;\n\tvis[s]=0;\n\tdist[s]=0;\n\tflow[s]=0x3f3f3f3f;\n\tq.push(s);\n\twhile(!q.empty()){\n\t\tint x=q.front();\n//\t\tcout<<x<<endl;\n\t\tvis[x]=true;\n\t\tfor(int i=head[x];i;i=e[i].nxt){\n\t\t\tint y=e[i].to;\n//\t\t\tcout<<y<<endl;\n\t\t\tif(e[i].cap>0&&dist[y]>dist[x]+e[i].cost){\n\t\t\t\tdist[y]=dist[x]+e[i].cost;pos[y]=x;pre[y]=i;\n\t\t\t\tflow[y]=min(flow[x],e[i].cap);\n//\t\t\t\tcout<<flow[y]<<endl;\n\t\t\t\tif(vis[y]){\n\t\t\t\t\tq.push(y);\n\t\t\t\t\tvis[y]=false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tq.pop();\n\t}\n//\tcout<<flow[t]<<endl;\n\treturn dist[t]<0x3f3f3f3f;\n}\ninline int Dinic(int s,int t){\n\tint sum=0;\n\twhile(spfa(s,t)){\n\t\tsum+=flow[t]*dist[t];\n\t\tfor(int i=t;i!=s;i=pos[i]){\n\t\t\te[pre[i]].cap-=flow[t];\n\t\t\te[pre[i]^1].cap+=flow[t];\n\t\t}\n\t}\n\treturn sum;\n}\nint n=read(),m=read();\nint mn[55],mx[55]; \nsigned main(){\n\tfz(i,1,n)\tmn[i]=1,mx[i]=n; \n\tfz(i,1,m){\n\t\tint opt=read(),l=read(),r=read(),x=read();\n\t\tif(opt==1){\n\t\t\tfor(int j=l;j<=r;j++)\tmn[j]=max(mn[j],x);\n\t\t}\n\t\telse{\n\t\t\tfor(int j=l;j<=r;j++)\tmx[j]=min(mx[j],x);\n\t\t}\n\t}\n\tfz(i,1,n){\n\t\tif(mn[i]>mx[i]){\n\t\t\tputs(\"-1\");\n\t\t\treturn 0;\n\t\t}\n\t}\n\tfz(i,1,n){\n\t\taddedge(0,i,1,0);\n\t\taddedge(i,0,0,0);\n\t\taddedge(n+n+n+i,5000,1,0);\n\t\taddedge(5000,n+n+n+i,0,0);//\u5efa\u56fe\u65b9\u5f0f1\n\t\tfz(j,mn[i],mx[i]){\n\t\t\taddedge(i,n+j,1,0);\n\t\t\taddedge(n+j,i,0,0);\n\t\t\taddedge(n+n+j,n+n+n+i,1,0);\n\t\t\taddedge(n+n+n+i,n+n+j,0,0);//\u5efa\u56fe\u65b9\u5f0f2\n\t\t}\n\t}\n\tfz(i,1,n){\n\t\tfz(j,1,n){\n\t\t\taddedge(n+i,n+n+i,1,2*j-1);\n\t\t\taddedge(n+n+i,n+i,0,-(2*j-1));//\u5efa\u56fe\u65b9\u5f0f3\n\t\t}\n\t}\n\tcout<<Dinic(0,5000)<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1581736747,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF863F \u3010Almost Permutation\u3011"
    },
    {
        "content": "## \u672c\u5f31\u9e21\u7684\u7b2c\u4e00\u9053\u9ed1\u9898\uff01\n## \u53d1\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\uff01\n\n\u8fd9\u9053\u9898\u76ee\u6211\u4eec\u53ef\u4ee5\u7528\u6700\u5c0f\u8d39\u7528\u6700\u5927\u6d41\u6765\u89e3\u51b3\u3002\n\n\u9996\u5148\uff0c\u4f60\u8981\u4f1a\u6253\u8d39\u7528\u6d41\u7684\u6a21\u677f\u3002\n\n\u4e0d\u4f1a\u7684\u53ef\u4ee5\u53c2\u8003[\u8fd9\u91cc](https://www.cnblogs.com/Xsmyy/p/13458370.html)\u3002\n\n\u7136\u540e\u6211\u4eec\u5f00\u59cb\u63a8\u5f0f\u5b50...\n\n\u8bbe$U_i$\u8868\u793a\u7b2c$i$\u4e2a\u6570$\\ge U_i$\n\n\u8bbe$D_i$\u8868\u793a\u7b2c$i$\u4e2a\u6570$\\ge D_i$\n\n\u6211\u4eec\u5148\u5c06\u6e90\u70b9$Start$\u5411\u7b2c\u4e00\u5c42\u6d41\u91cf\u4e3a$\\mathcal{1}$\u8d39\u7528\u4e3a$0$\n\n\u7136\u540e\u8dd1\u4e00\u8fb9\u8d39\u7528\u6d41\u5c31\u597d\u4e86\u5440\uff01\n\n\u4e0d\u4f1a\u8d39\u7528\u6d41\u7684\u53bb[\u8fd9\u91cc](https://www.cnblogs.com/Xsmyy/p/13458370.html)\u3002\n\n[\u6211\u7684\u4ee3\u7801\u8dd1\u7684\u8fd8\u4e0d\u9519\uff0cRank2](https://cdn.luogu.com.cn/upload/image_hosting/o3z0neym.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n```cpp\n#include<bits/stdc++.h>\n#define MAX 201\nusing namespace std;\nint TotalPoint,TotalEdge;\nint Start,End,Sp;\nint Ans,AllCost;\nbool Visit[MAX];\nbool VisitDfs[MAX];\nint Dist[MAX];\nint U[MAX],D[MAX];\nvector<int>Edge[MAX];\nvector<int>Stream[MAX];\nvector<int>Cost[MAX];\nvector<int>Size[MAX];\ninline void AddEdge(int From,int To,int NowStream,int NowCost)\n{\n    Edge[From].push_back(To);\n    Edge[To].push_back(From);\n    Stream[From].push_back(NowStream);\n    Stream[To].push_back(0);\n    Cost[From].push_back(NowCost);\n    Cost[To].push_back(-NowCost);\n    Size[From].push_back(Edge[To].size()-1);\n    Size[To].push_back(Edge[From].size()-1);\n}\ninline bool Spfa(int Start,int End)\n{\n    register queue<int>Queue;\n    register int i;\n    for(i=1;i<=Sp;i++)\n    {\n        VisitDfs[i]=false;\n        Visit[i]=false;\n        Dist[i]=2147483647;\n    }\n    Visit[Start]=true;\n    Dist[Start]=0;\n    Queue.push(Start);\n    while(!Queue.empty())\n    {\n        register int Top;\n        Top=Queue.front();\n        Queue.pop();\n        Visit[Top]=false;\n        for(i=0;i<Edge[Top].size();i++)\n        {\n            register int Next;\n            Next=Edge[Top][i];\n            if(Dist[Top]+Cost[Top][i]<Dist[Next]&&Stream[Top][i])\n            {\n                Dist[Next]=Dist[Top]+Cost[Top][i];\n                if(!Visit[Next])\n                {\n                    Visit[Next]=true;\n                    Queue.push(Next);\n                }\n            }\n        }\n    }\n    return Dist[End]!=2147483647;\n}\ninline int Dfs(int Now,int End,int Min)\n{\n    if(!Min||Now==End)\n    {\n        return Min;\n    }\n    register int Return;\n    Return=0;\n    VisitDfs[Now]=1;\n    register int i;\n    for(i=0;i<Edge[Now].size();i++)\n    {\n        register int Next=Edge[Now][i];\n        if(Dist[Now]+Cost[Now][i]==Dist[Next]&&Stream[Now][i]&&!VisitDfs[Next])\n        {\n            register int MinStream;\n            MinStream=Dfs(Next,End,min(Min,Stream[Now][i]));\n            Stream[Now][i]-=MinStream;\n            Stream[Next][Size[Now][i]]+=MinStream;\n            Min-=MinStream;\n            Return+=MinStream;\n            AllCost+=MinStream*Cost[Now][i];\n        }\n    }\n    return Return;\n}\ninline void Mcmf()\n{\n    while(Spfa(Start,End))\n    {\n        Ans=Ans+Dfs(Start,End,2147483647);\n    }\n}\nint main(void)\n{\n    register int i,j;\n    cin>>TotalPoint>>TotalEdge;\n    Start=TotalPoint*2+1;\n    End=TotalPoint*2+2;\n    Sp=TotalPoint*2+2;\n    for(i=1;i<=TotalPoint;i++)\n    {\n    \tU[i]=1;\n    \tD[i]=TotalPoint;\n\t}\n    for(i=1;i<=TotalEdge;i++)\n    {\n        register int Left,Right,Opt,Value;\n        cin>>Opt>>Left>>Right>>Value;\n        for(j=Left;j<=Right;j++)\n        {\n        \tif(Opt==1)\n        \t{\n        \t\tU[j]=max(U[j],Value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tD[j]=min(D[j],Value);\n\t\t\t}\n\t\t}\n    }\n    for(i=1;i<=TotalPoint;i++)\n    {\n    \tAddEdge(Start,i,1,0);\n\t}\n\tfor(i=1;i<=TotalPoint;i++)\n\t{\n\t\tfor(j=U[i];j<=D[i];j++)\n\t\t{\n\t\t\tAddEdge(i,j+TotalPoint,1,0);\n\t\t}\n\t}\n\tfor(i=1;i<=TotalPoint;i++)\n\t{\n\t\tfor(j=1;j<=TotalPoint;j++)\n\t\t{\n\t\t\tAddEdge(i+TotalPoint,End,1,2*j-1);\n\t\t}\n\t}\n    Mcmf();\n    if(Ans==TotalPoint)\n    {\n    \tcout<<AllCost<<endl;\n\t}\n\telse\n\t{\n\t\tcout<<-1<<endl;\n\t}\n    return 0;\n}\n```",
        "postTime": 1597406916,
        "uid": 132168,
        "name": "_Clown_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF863F \u3010Almost Permutation\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u7528\u8d39\u7528\u6d41\n\n\u8bbe$u_i$\u4e3a\u7b2c$i$\u4e2a\u6570\u5b57$\\ge u_i$\n\n\u8bbe$d_i$\u4e3a\u7b2c$i$\u4e2a\u6570\u5b57$\\le d_i$\n\n\u6211\u4eec\u5148\u5c06\u6e90\u70b9$s$\u5411\u7b2c$1$\u5c42\u7684\u70b9\u8fde\u6d41\u91cf\u4e3a$1$,\u8d39\u7528\u4e3a$0$\u8fb9\n\n\u518d\u5c06\u7b2c$1$\u5c42\u6bcf\u4e00\u4e2a\u70b9\u5411\u7b2c$1$\u5c42\u7684\u7b2c$x,x\\in[u_i,d_i]$\u4e2a\u70b9\u8fde\u4e00\u6761\u6d41\u91cf\u4e3a$1$\uff0c\u8d39\u7528\u4e3a$0$\u7684\u8fb9\n\n\u56e0\u4e3a\u8d39\u7528\u662f$k^2(k$\u662f\u76f8\u540c\u7684\u6570\u6570\u91cf$)$\uff0c\u4e14$k^2$\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u7b2c$2$\u5c42\u6bcf\u4e00\u4e2a\u70b9\u5411\u6c47\u70b9$t$\u8fde$n$\u6761\u8fb9,\u6bcf\u4e00\u6761\u8fb9\u7684\u6d41\u91cf\u4e3a$1$,\u8d39\u7528\u4f9d\u6b21\u4e3a$1^2-0^2$,$2^2-1^2$,$\\cdot\\cdot\\cdot$,$n^2-(n-1)^2$\uff0c\u7b2c$k$\u6b21\u8d70\u8fd9\u6761\u8fb9\u65f6\u8d39\u7528\u4ece$(k-1)^2$\u53d8\u6210$k^2$,\u589e\u52a0\u4e86$k^2-(k-1)^2$,\u800c\u8fd9\u4e00\u7ec4\u8fb9\u7b2c$k$\u5c0f\u7684\u8d39\u7528\u6b63\u597d\u4e3a$k^2-(k-1)^2$\n\n\u7136\u540e\u8dd1\u4e00\u8fb9\u8d39\u7528\u6d41\n\n\u5982\u679c\u6d41\u91cf$<n$,\u8bf4\u660e\u65e0\u89e3\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\nstd::vector<int> a[105],b[105],c[105],f[105];\nint n,m,s,t,sp,flow=0,cost=0,dis[105],vis[105],use[105],u[55],d[55];\nstd::queue<int> q;\nvoid add(int x,int y,int v,int w)\n{\n\ta[x].push_back(y);a[y].push_back(x);\n\tb[x].push_back(v);b[y].push_back(0);\n\tc[x].push_back(w);c[y].push_back(-w);\n\tf[x].push_back(a[y].size()-1),f[y].push_back(a[x].size()-1); \n}\nint spfa(int s,int t)\n{\n\tfor (int i=1;i<=sp;i++) dis[i]=1000000000,vis[i]=0,use[i]=0;\n\tdis[s]=0;vis[s]=1;q.push(s);\n\twhile (!q.empty())\n\t{\n\t\tint v=q.front();q.pop();vis[v]=0;\n\t\tfor (int i=0;i<a[v].size();i++)\n\t\t{\n\t\t\tint u=a[v][i];\n\t\t\tif (dis[v]+c[v][i]<dis[u]&&b[v][i])\n\t\t\t{\n\t\t\t\tdis[u]=dis[v]+c[v][i];\n\t\t\t\tif (!vis[u]) q.push(u),vis[u]=1;\n\t\t\t}\n\t\t}\n\t}\n\treturn dis[t]!=1000000000;\n}\nint dfs(int v,int t,int now)\n{\n\tif (v==t||!now) return now;\n\tint fl=0;use[v]=1;\n\tfor (int i=0;i<a[v].size();i++)\n\t{\n\t\tint u=a[v][i];\n\t    if (dis[v]+c[v][i]==dis[u]&&b[v][i]&&!use[u])\n\t\t{\n\t\t\tint k=dfs(u,t,std::min(b[v][i],now));\n\t\t\tb[v][i]=b[v][i]-k;b[u][f[v][i]]=b[u][f[v][i]]+k;\n\t\t\tfl=fl+k;now=now-k;cost=cost+k*c[v][i];\n\t\t}\n\t}\n\treturn fl;\n}\nvoid mcmf(){while (spfa(s,t)) flow=flow+dfs(s,t,1000000000);}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);s=n*2+1,t=2*n+2,sp=2*n+2;\n\tfor (int i=1;i<=n;i++) u[i]=1,d[i]=n;\n\tfor (int i=1;i<=m;i++)\n\t{\n\t\tint opt,l,r,v;\n\t\tscanf(\"%d%d%d%d\",&opt,&l,&r,&v);\n\t\tfor (int i=l;i<=r;i++) opt==1?u[i]=std::max(u[i],v):d[i]=std::min(d[i],v);\n\t}\n\tfor (int i=1;i<=n;i++) add(s,i,1,0);\n\tfor (int i=1;i<=n;i++) for (int j=u[i];j<=d[i];j++) add(i,j+n,1,0);\n\tfor (int i=1;i<=n;i++) for (int j=1;j<=n;j++) add(i+n,t,1,2*j-1);\n\tmcmf();\n\tif (flow==n) printf(\"%d\\n\",cost);\n\telse puts(\"-1\");\n\treturn 0;\n}\n```\n\u7136\u540e\u5c31$AC$\u4e86\n\n$QAQ$",
        "postTime": 1580609630,
        "uid": 36957,
        "name": "RainFestival",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF863F \u3010Almost Permutation\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF863F)\n\n\u540c\u6b65\u53d1\u8868\u4e8e\u6211\u7684 [$\\texttt{cnblog}$](https://www.cnblogs.com/UperFicial/p/16149816.html)\u3002\n\n### $\\texttt{Description}$\n\n$n$ \u4e2a\u6570\uff0c\u6bcf\u4e2a\u6570\u90fd\u5728 $1$ \u81f3 $n$ \u95f4\u3002$m$ \u4e2a\u5f62\u5982 $[l,r]$ \u4e2d\u7684\u6570\u4e0d\u5c0f\u4e8e\u6216\u4e0d\u5927\u4e8e $v$ \u7684\u9650\u5236\u3002\u8bbe $cnt(i)$ \u8868\u793a $i$ \u7684\u51fa\u73b0\u6b21\u6570\uff0c\u6c42 $\\sum cnt_i^2$ \u7684\u6700\u5c0f\u503c\u3002\n\n$1\\le n\\le 50$\uff0c$1\\le m\\le 100$\u3002\n\n### $\\texttt{Solution}$\n\n\u53d1\u73b0\u6570\u636e\u8303\u56f4\u8fd9\u4e48\u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u9884\u5904\u7406\u51fa\uff0c\u5e8f\u5217\u4e2d\u6bcf\u4e00\u4e2a $a_i$ \u53ef\u80fd\u53d6\u5230\u7684\u8303\u56f4\uff0c\u8bbe\u4e3a $[down_i,up_i]$\u3002\n\n\u7136\u540e\u8003\u8651\u4e00\u4e2a\u4e8c\u5206\u56fe\u6a21\u578b\u3002\n\n\u5de6\u8fb9\u662f $1$ \u81f3 $n$\uff0c\u4ee3\u8868\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u53f3\u8fb9\u662f $1$ \u81f3 $n$\uff0c\u4ee3\u8868\u5e8f\u5217\u4e2d\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u53ef\u80fd\u7684\u503c\u3002\n\n\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u53ea\u80fd\u6709\u4e00\u4e2a\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u8fde $s\\to i$\uff0c\u5bb9\u91cf\u4e3a $0$\uff0c\u8d39\u7528\u4e3a $1$\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u8fde\u5411\u5b83\u80fd\u53d6\u5230\u7684\u533a\u95f4\u5373 $[down_i,up_i]$\uff0c\u6d41\u91cf\u4e3a $1$\uff0c\u8d39\u7528\u4e3a $0$\u3002\n\n\u8fd9\u4e9b\u90fd\u662f\u975e\u5e38\u663e\u7136\u7684\u3002\n\n\u4f46\u95ee\u9898\u5728\u4e8e\uff0c\u5982\u679c\u6211\u4eec\u53f3\u8fb9\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u5411 $t$ \u8fde\u4e00\u6761\u5bb9\u91cf\u4e3a $\\infty$ \u8d39\u7528\u4e3a $1$ \u7684\u8fb9\uff08\u8868\u793a\u4e00\u4e2a\u6570\u53ef\u80fd\u88ab\u591a\u4e2a\u4f4d\u7f6e\u5339\u914d\uff0c\u7136\u540e\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u90fd\u8981\u6709 $1$ \u7684\u8d21\u732e\uff09\uff0c\u6700\u7ec8\u9700\u8981\u6c42\u5f97\u662f $\\sum cnt_i^2$\uff0c\u65e0\u6cd5\u89e3\u51b3\u3002\n\n\u8003\u8651\u53f3\u8fb9\u4e00\u4e2a\u6570\uff0c\u6700\u591a\u88ab\u5339\u914d\u7684\u4e0a\u9650\u662f $n$\uff0c\u90a3\u4e48\u5c06\u8fd9\u4e2a\u70b9\u5411 $t$ \u8fde $n$ \u6761\u8fb9\uff0c\u7b2c $i$ \u6761\u8fb9\uff0c\u5bb9\u91cf\u4e3a $1$\uff0c\u8d39\u7528\u4e3a $i^2-(i-1)^2$\u3002\n\n\u8fd9\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\n\n\u8003\u8651\u5b83\u7684\u5339\u914d\uff0c\u5bb9\u91cf\u90fd\u4e00\u6837\uff0c\u90a3\u4e48\u6211\u4eec $\\texttt{spfa}$ \u5728\u627e\u589e\u5149\u8def\u7684\u65f6\u5019\u80af\u5b9a\u4f1a\u627e\u8d39\u7528\u6700\u5c0f\u7684\u51e0\u6761\u3002\n\n\u5f53\u4ece\u7b2c $i$ \u5c0f\u7684\u8fb9\uff0c\u52a0\u5165\u4e86\u7b2c $i+1$ \u5c0f\u7684\u8fb9\u65f6\uff0c$i^2$ \u7684\u90a3\u4e00\u9879\u6070\u597d\u88ab\u524a\u6389\uff0c$(i-1)^2$ \u7684\u90a3\u4e00\u9879\u53c8\u88ab\u524d\u9762\u7684\u6d88\u6389\uff0c\u6240\u4ee5\u6c42\u548c\u8d77\u6765\u5c31\u662f $(i+1)^2$\u3002\n\n\u4e2a\u4eba\u611f\u89c9\u50cf\u662f\u6784\u9020\u7684\u601d\u60f3\uff0c\u5341\u5206\u5de7\u5999\u3002\u4e5f\u8bb8\u662f\u4e00\u79cd $\\texttt{trick}$ \u4f46\u6211\u5e76\u4e0d\u77e5\u9053\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\nint main()\n{\n\tn=read(),m=read();\n\ts=0,t=n<<1|1;\n\tfor(register int i=1;i<=n;i++) down[i]=1,up[i]=n;\n\tfor(register int i=1;i<=m;i++)\n\t{\n\t\tint opt=read(),l=read(),r=read(),v=read();\n\t\tif(opt==1) for(register int j=l;j<=r;j++) down[j]=Max(down[j],v);\n\t\telse for(register int j=l;j<=r;j++) up[j]=Min(up[j],v);\n\t} \n\tfor(register int i=1;i<=n;i++) if(down[i]>up[i])\n\t{\n\t\tputs(\"-1\");\n\t\treturn 0;\n\t}\n\tfor(register int i=1;i<=n;i++)\n\t\tfor(register int j=down[i];j<=up[i];j++)\n\t\t\tadd_edge(i,j+n,1,0);\n\tfor(register int i=1;i<=n;i++) add_edge(s,i,1,0);\n\tfor(register int i=1;i<=n;i++)\n\t\tfor(register int j=1;j<=n;j++)\n\t\t\tadd_edge(i+n,t,1,(j<<1)-1);\n\tMCMF();\n\treturn 0;\n}\n```\n\n\u6ce8\u610f\u6570\u7ec4\u4e0d\u8981\u5f00\u5c0f\u4e86\u3002\n\n$$\\texttt{The End.by UF}$$",
        "postTime": 1650011243,
        "uid": 360511,
        "name": "UperFicial",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010CF863F Almost Permutation\u3011"
    }
]