[
    {
        "content": "\u8003\u8651\u5230 $x_i$ \u548c $x_{-i}$ \u4e00\u5171\u53ea\u4f1a\u51fa\u73b0\u6700\u591a\u4e24\u6b21\u3002\n\n\u6211\u4eec\u5c31\u5c06\u6bcf\u4e2a\u8868\u8fbe\u5f0f\u770b\u6210\u4e00\u4e2a\u70b9\uff0c\u82e5\u67d0\u4e24\u4e2a\u8868\u8fbe\u5f0f\u5b58\u5728 $x_i$ \u6216 $x_{-i}$\uff0c\u5219\u5c06\u8fd9\u4e24\u4e2a\u8868\u8fbe\u5f0f\u4ee3\u8868\u7684\u70b9\u4e4b\u95f4\u8fde\u4e00\u6761\u8fb9\uff0c\u8fb9\u6743\u4e3a $0/1$\uff0c\u8868\u793a\u4e24\u4e2a\u8868\u8fbe\u5f0f\u4e2d\uff0c $x$ \u7684\u4e0b\u6807\u76f8\u540c/\u4e0d\u540c\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u6837\u8fde\u51fa\u7684\u4e1c\u897f\u4e00\u5b9a\u662f\u4e00\u5806\u73af\u548c\u94fe\u3002\u73af\u53ef\u4ee5\u901a\u8fc7\u62c6\u4e00\u6761\u8fb9\u53d8\u6210\u94fe\uff0c\u6210\u4e86\u94fe\u4e4b\u540e\u5c31\u6ca1\u6709\u540e\u6548\u6027\u4e86\uff0c\u5c31\u53ef\u4ee5\u8003\u8651 dp \u4e86\u3002\n\n\u8003\u8651\u8bbe\u72b6\u6001 $f_{i,0/1,0/1}$ \u8868\u793a\uff0c\u8003\u8651\u5230\u5f53\u524d\u8fd9\u4e2a\u8fde\u901a\u5757\u7684\u7b2c $i$ \u4e2a\u8868\u8fbe\u5f0f\uff0c\u5f53\u524d\u5f02\u6216\u503c\u4e3a $0/1$\uff0c\u7b2c $i-1$ \u5230\u7b2c $i$ \u4e2a\u8868\u8fbe\u5f0f\u6240\u5171\u6709\u7684\u53d8\u91cf\uff0c\u5728\u7b2c $i$ \u4e2a\u8868\u8fbe\u5f0f\u4e2d\u7684\u503c\u4e3a $0/1$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\u4e0d\u96be\u8003\u8651\uff0c\u5c31\u624b\u52a8\u8ba1\u7b97\u4e00\u4e0b\u5305\u62ec\u8fb9\u6743\u5728\u5185\u7684 $8$ \u79cd\u60c5\u51b5\uff0c\u7b97\u51fa\u8868\u8fbe\u5f0f\u7684\u53d6\u503c\u4ee5\u53ca\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u624b\u52a8\u8f6c\u79fb\u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u5148\u8003\u8651\u4e00\u4e9b\u7279\u6b8a\u4e00\u70b9\u7684\u60c5\u51b5\uff1a\uff08\u8fd9\u91cc\u4ec5\u505a\u6574\u5408\uff0c\u5177\u4f53\u7ec6\u8282\u53c2\u89c1\u4ee3\u7801\uff09\n\n#### \u4e00\u3001\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u540c\u65f6\u6709 $x_i$ \u548c $x_{-i}$\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u4e2a\u70b9\u4e00\u5b9a\u5bf9\u7b54\u6848\u6709\u4e00\u4e2a $1$ \u7684\u8d21\u732e\u3002\u63d0\u524d\u7b97\u597d\u5c31\u884c\u4e86\u3002\n\n#### \u4e8c\u3001\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u6709\u4e24\u4e2a $x_i$ \u6216 $x_{-i}$\n\n\u8fd9\u6837\u7684\u8868\u8fbe\u5f0f\uff0c\u6211\u4eec\u5c31\u5f53\u5b83\u662f\u53ea\u6709\u4e00\u4e2a\u7684\u5b64\u70b9\u5c31\u884c\u4e86\u3002\uff08\u867d\u7136\u4e0d\u77e5\u9053\u6570\u636e\u91cc\u5934\u6709\u6ca1\u6709\u8fd9\u79cd\u60c5\u51b5\uff09\n\n#### \u4e09\u3001\u4e00\u6761\u94fe\u7684\u7aef\u70b9\u7684\u8868\u8fbe\u5f0f\u53ef\u80fd\u6709\u4e00\u4e2a\u53ea\u51fa\u73b0\u4e86\u4e00\u6b21\u7684 $x_i$\n\n\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c31\u8003\u8651\u679a\u4e3e\u5f00\u5934\u90a3\u4e2a $x_i$ \u662f\u5565\uff0c\u5728 $f_{1,0,x_i}$ \u8d4b\u503c\u4e3a $1$ \u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u7ed3\u5c3e\u4e0a\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u679a\u4e3e\u4e00\u4e0b $x_i$ \u4e0a\u662f\u5565\uff0c\u624b\u52a8\u7b97\u4e00\u4e0b $x_i$ \u5bf9\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u7684\u72b6\u6001\u5f71\u54cd\u5c31\u884c\u4e86\u3002\n\n#### \u56db\u3001\u73af\u62c6\u94fe\n\n\u968f\u4fbf\u9009\u4e00\u6761\u8fb9\uff0c\u679a\u4e3e $x_i$ \u7684\u53d6\u503c\uff0c\u7136\u540e\u7c7b\u4f3c\u7b2c\u4e09\u6761\u505a\u5c31\u884c\u4e86\u3002\n\n#### \u4e94\u3001\u4e00\u4e2a\u70b9\u540c\u65f6\u6709\u4e24\u4e2a\u53ea\u51fa\u73b0\u4e86\u4e00\u6b21\u7684 $x_i$\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u4e2a\u70b9\u6709 $3$ \u79cd\u60c5\u51b5\u4e3a $1$\uff0c $1$ \u79cd\u60c5\u51b5\u4e3a $0$\u3002\n\n\u8fd9\u4e2a\u6570\u503c\u4e0d\u96be\u8ba1\u7b97\uff0c\u4f46\u662f\u53ef\u80fd\u5728\u5206\u6790\u7684\u65f6\u5019\u6f0f\u4e86\u8fd9\u79cd\u60c5\u51b5\u5bfc\u81f4\u5b9e\u73b0\u4e0d\u597d\u7684\u60c5\u51b5\u4e0b\u4f1a\u7b97\u6302\u3002\n\n---\n\n\u603b\u4e4b\u8fd9\u9898\u7ec6\u8282\u633a\u591a\uff0c\u633a\u6076\u5fc3\u4eba\u7684\uff0c\u5982\u679c\u60f3\u4e0d\u6e05\u695a\u53ef\u4ee5\u53c2\u89c1\u4ee3\u7801\u3002\n\n$\\rm Code$\uff1a\n\n```cpp\nconst int MAXN = 100010;\nconst int mod = 1e9 + 7;\n\ninline int Mod(int x) { return x >= mod ? x - mod : x; }\ninline void Add(int&x, int y) { x += y, x -= x >= mod ? mod : 0; }\n\nint id[MAXN];\nint sgn[MAXN];\nint deg[MAXN];\nint vis[MAXN];\n\nint tot;\nint to[MAXN << 1];\nint ne[MAXN << 1];\nint rv[MAXN << 1];\nint fi[MAXN];\nint dg[MAXN];\n\ninline void Link(int u, int v, int w) {\n\ttot++;\n\tto[tot] = v;\n\trv[tot] = w;\n\tne[tot] = fi[u];\n\tfi[u] = tot;\n}\n\ninline void AddEdge(int u, int v, int w) {\n\tLink(u, v, w), Link(v, u, w), ++dg[u], ++dg[v];\n}\n\nint rev[MAXN];\nint sta[MAXN];\nint top;\n\ninline void dfs(int x) {\n\tsta[++top] = x, vis[x] = 1;\n\tfor(int i = fi[x]; i; i = ne[i]) {\n\t\tint u = to[i];\n\t\tif(vis[u]) continue;\n\t\trev[top] = rv[i];\n\t\tdfs(u);\n\t}\n}\n\nint res[2];\n\nint main() {\n\tint m = ri, n = ri, c0 = 0, c1 = 0;\n\tfor(int i = 1; i <= m; i++) {\n\t\tint k = ri, x, y;\n\t\tif(k == 2) x = ri, y = ri;\n\t\telse x = ri;\n\t\tdeg[i] = k;\n\t\tif(k == 2) {\n\t\t\tif(x == y) { c0++, vis[i] = 1, id[abs(x)] = i; continue; }\n\t\t\tif(x == -y) { c1++, vis[i] = 1, id[abs(x)] = i; continue; }\n\t\t}\n\t\tif(id[abs(x)]) AddEdge(i, id[abs(x)], (x < 0) ^ sgn[abs(x)]);\n\t\telse id[abs(x)] = i, sgn[abs(x)] = x < 0;\n\t\tif(k == 2) {\n\t\t\tif(id[abs(y)]) AddEdge(i, id[abs(y)], (y < 0) ^ sgn[abs(y)]);\n\t\t\telse id[abs(y)] = i, sgn[abs(y)] = y < 0;\n\t\t}\n\t} res[0] = 1;\n\twhile(c0--) res[0] = res[1] = Mod(res[0] + res[1]);\n\twhile(c1--) res[0] = Mod(res[0] << 1), res[1] = Mod(res[1] << 1), swap(res[0], res[1]);\n\tint mul = 1;\n\tfor(int i = 1; i <= n; i++) if(!id[i]) mul = Mod(mul << 1);\n\tfor(int i = 1; i <= m; i++) {\n\t\tif(vis[i]) continue;\n\t\tif(!dg[i]) {\n\t\t\tvis[i] = 1;\n\t\t\tif(deg[i] == 1) res[0] = res[1] = Mod(res[0] + res[1]);\n\t\t\telse {\n\t\t\t\tint tr0 = (res[0] + 3LL * res[1]) % mod;\n\t\t\t\tint tr1 = (3LL * res[0] + res[1]) % mod;\n\t\t\t\tres[0] = tr0, res[1] = tr1;\n\t\t\t}\n\t\t}\n\t\tif(dg[i] == 1) {\n\t\t\ttop = 0, dfs(i);\n\t\t\tint r0 = 1, r1 = 0, r2 = 0, r3 = 0;\n\t\t\tif(deg[sta[1]] == 2) r2 = 1;\n\t\t\tfor(int j = 1; j < top; j++) {\n\t\t\t\tint tr0, tr1, tr2, tr3;\n\t\t\t\tif(rev[j]) {\n\t\t\t\t\ttr0 = Mod(r1 + r3), tr1 = Mod(r0 + r2);\n\t\t\t\t\ttr2 = Mod(r0 + r3), tr3 = Mod(r1 + r2);\n\t\t\t\t} else {\n\t\t\t\t\ttr0 = Mod(r0 + r3), tr1 = Mod(r1 + r2);\n\t\t\t\t\ttr2 = Mod(r1 + r3), tr3 = Mod(r0 + r2);\n\t\t\t\t} r0 = tr0, r1 = tr1, r2 = tr2, r3 = tr3;\n\t\t\t}\n\t\t\tif(deg[sta[top]] == 2) Add(r2, Mod(r0 + r2)), Add(r3, Mod(r3 + r1));\n\t\t\tAdd(r0, r3), Add(r1, r2);\n\t\t\tint tr0 = (1LL * r0 * res[0] + 1LL * r1 * res[1]) % mod;\n\t\t\tint tr1 = (1LL * r1 * res[0] + 1LL * r0 * res[1]) % mod;\n\t\t\tres[0] = tr0, res[1] = tr1;\n\t\t}\n\t}\n\tfor(int i = 1; i <= m; i++) {\n\t\tif(vis[i]) continue;\n\t\ttop = 0, dfs(i);\n\t\tint R0 = 0, R1 = 0, r0, r1, r2, r3, Rv = 0;\n\t\tfor(int j = fi[sta[1]]; j; j = ne[j])\n\t\t\tif(to[j] == sta[top]) Rv = rv[j];\n\t\tr0 = 1, r1 = 0, r2 = 0, r3 = 0;\n\t\tfor(int j = 1; j < top; j++) {\n\t\t\tint tr0, tr1, tr2, tr3;\n\t\t\tif(rev[j]) {\n\t\t\t\ttr0 = Mod(r1 + r3), tr1 = Mod(r0 + r2);\n\t\t\t\ttr2 = Mod(r0 + r3), tr3 = Mod(r1 + r2);\n\t\t\t} else {\n\t\t\t\ttr0 = Mod(r0 + r3), tr1 = Mod(r1 + r2);\n\t\t\t\ttr2 = Mod(r1 + r3), tr3 = Mod(r0 + r2);\n\t\t\t} r0 = tr0, r1 = tr1, r2 = tr2, r3 = tr3;\n\t\t}\n\t\tif(Rv) R0 = Mod(r1 + r3), R1 = Mod(r0 + r2);\n\t\telse R0 = Mod(r0 + r3), R1 = Mod(r1 + r2);\n\t\tr0 = 0, r1 = 0, r2 = 1, r3 = 0;\n\t\tfor(int j = 1; j < top; j++) {\n\t\t\tint tr0, tr1, tr2, tr3;\n\t\t\tif(rev[j]) {\n\t\t\t\ttr0 = Mod(r1 + r3), tr1 = Mod(r0 + r2);\n\t\t\t\ttr2 = Mod(r0 + r3), tr3 = Mod(r1 + r2);\n\t\t\t} else {\n\t\t\t\ttr0 = Mod(r0 + r3), tr1 = Mod(r1 + r2);\n\t\t\t\ttr2 = Mod(r1 + r3), tr3 = Mod(r0 + r2);\n\t\t\t} r0 = tr0, r1 = tr1, r2 = tr2, r3 = tr3;\n\t\t}\n\t\tif(Rv) Add(R0, Mod(r0 + r3)), Add(R1, Mod(r1 + r2));\n\t\telse Add(R0, Mod(r1 + r3)), Add(R1, Mod(r0 + r2));\n\t\tint tr0 = (1LL * R0 * res[0] + 1LL * R1 * res[1]) % mod;\n\t\tint tr1 = (1LL * R1 * res[0] + 1LL * R0 * res[1]) % mod;\n\t\tres[0] = tr0, res[1] = tr1;\n\t} cout << 1LL * res[1] * mul % mod << endl;\n\treturn 0;\n}\n```",
        "postTime": 1582514211,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF704C \u3010Black Widow\u3011"
    },
    {
        "content": "\u5b89\u5229\u4e2a\u4eba blog\uff1ahttps://www.cnblogs.com/ET2006/\n\n[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/704/problem/C) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF704C)\n\n~~u1s1 \u611f\u89c9\u8fd9\u79cd\u9898\u88ab\u8bc4\u5230 *2900 \u662f\u56e0\u4e3a\u7ec6\u8282\u592a\u7e41\u7410\u4e86\uff0c\u800c\u4e0d\u662f\u9898\u76ee\u672c\u8eab\u7684\u96be\u5ea6\uff0c\u6240\u4ee5\u6211\u5207\u6389\u8fd9\u79cd\u9898\u6839\u672c\u4e0d\u80fd\u8bf4\u660e\u4ec0\u4e48\u2026\u2026~~\n\n\u9996\u5148\u9898\u76ee\u4e2d\u6709\u4e00\u4e2a\u975e\u5e38\u559c\u95fb\u4e50\u89c1\u7684\u6761\u4ef6\u90a3\u5c31\u662f $k_i\\le 2$\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u5c06\u6bcf\u4e2a\u5e03\u5c14\u578b\u53d8\u91cf\u770b\u4f5c\u4e00\u4e2a\u70b9\uff0c\u5bf9\u4e8e\u51fa\u73b0\u5728\u540c\u4e00\u7ec4\u7684\u4e24\u4e2a\u5e03\u5c14\u578b\u53d8\u91cf $x,y$ \u8fde\u8fb9 $(x,y)$\uff0c\u90a3\u4e48\u663e\u7136\u5f97\u5230\u7684\u56fe\u4e00\u5b9a\u662f\u4e00\u5806\u73af\u3001\u4e00\u5806\u94fe\u4ee5\u53ca\u4e00\u5806\u5b64\u7acb\u70b9\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u53ca\u6bcf\u4e2a\u94fe\u5206\u522b\u8dd1\u4e00\u904d DP\u3002\u5bf9\u4e8e\u94fe\u6211\u4eec\u5c31\u8bbe $dp_{i,j,k}$ \u8868\u793a\u8003\u8651\u5230\u94fe\u4e0a\u7b2c $i$ \u4e2a\u70b9\uff0c\u7b2c $i$ \u4e2a\u70b9\u5bf9\u5e94\u7684\u5e03\u5c14\u53d8\u91cf\u7684\u53d6\u503c\u4e3a $j$\uff0c\u5f53\u524d\u6240\u6709\u5e03\u5c14\u8868\u8fbe\u5f0f\u7684\u503c\u5f02\u6216\u8d77\u6765\u4e3a $k$ \u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u5c31\u679a\u4e3e\u4e0a\u4e00\u4e2a\u5e03\u5c14\u53d8\u91cf\u7684\u503c\u5373\u53ef\u3002\u5bf9\u4e8e\u73af\u6211\u4eec\u5c31\u591a\u5f00\u4e00\u7ef4 $dp_{i,j,k,fst}$\uff0c$fst$ \u8868\u793a\u73af\u4e0a\u7b2c\u4e00\u4e2a\u6570\u4e3a $fst$\uff0c\u7136\u540e\u6211\u4eec\u6700\u540e\u5c31\u5f3a\u5236\u4ece $j=fst$ \u7684 $dp$ \u8ba1\u7b97\u7b54\u6848\u5373\u53ef\u3002\u6700\u540e\u518d\u5957\u4e00\u4e2a\u5927\u80cc\u5305\uff0c$f_{i,j}$ \u8868\u793a\u8003\u8651\u5230\u524d $i$ \u4e2a\u8fde\u901a\u5757\uff08\u73af+\u94fe\uff09\uff0c\u8fd9\u4e9b\u8fde\u901a\u5757\u4e2d\u6240\u6709\u8868\u8fbe\u5f0f\u5f02\u6216\u8d77\u6765\u4e3a $j$ \u7684\u65b9\u6848\u6570\uff0c\u8fd9\u4e2a\u540c\u6837\u53ef\u4ee5 $\\mathcal O(1)$ \u8f6c\u79fb\uff0c\u603b\u590d\u6742\u5ea6\u7ebf\u6027\u3002\n\n\u7a0b\u5e8f\u5927\u81f4\u6846\u67b6\u5c31\u8fd9\u4e48\u591a\uff0c\u4e0d\u8fc7\u6b64\u9898\u7ec6\u8282\u5b9e\u5728\u662f\u592a\u592a\u592a\u591a\u4e86\uff0c\u5982\u679c\u80fd 1A \u5c31\u771f\u7684\u662f\u795e\u4ed9\u4e86\uff0c\u8fd9\u91cc\u5217\u51fa\u51e0\u4e2a\u5bb9\u6613\u72af\u7684\u9519\u8bef\uff1a\n\n- \u5bf9\u4e8e $x_i\\lor\\lnot x_i$ \u7684\u8868\u8fbe\u5f0f\uff0c\u4e0d\u8bba $x_i$ \u53d6\u4ec0\u4e48\u8be5\u8868\u8fbe\u5f0f\u7684\u503c\u90fd\u662f $1$\uff0c\u6211\u4eec\u8003\u8651\u968f\u65f6\u7ef4\u62a4\u4e00\u4e2a $goal$ \u53d8\u91cf\u8868\u793a\u6211\u4eec\u6700\u7ec8\u5e0c\u671b\u6240\u6709\u5e03\u5c14\u8868\u8fbe\u5f0f\u5f02\u6216\u8d77\u6765\u662f\u591a\u5c11\uff0c\u521d\u59cb $goal=1$\uff0c\u6211\u4eec\u6bcf\u9047\u5230\u4e00\u4e2a\u8fd9\u6837\u7684\u8868\u8fbe\u5f0f\u90fd\u4ee4 $goal\\leftarrow goal\\oplus 1$\uff0c\u6700\u7ec8\u8f93\u51fa $f_{\\text{\u8fde\u901a\u5757\u4e2a\u6570},goal}$ instead of $f_{\\text{\u8fde\u901a\u5757\u4e2a\u6570},1}$ \u5373\u53ef\u3002\n- \u5bf9\u4e8e $x_i\\lor x_i$ \u6216\u8005 $\\lnot x_i\\lor\\lnot x_i$ \u7684\u8868\u8fbe\u5f0f\uff0c\u663e\u7136\u5176\u7b49\u6548\u4e8e\u4e00\u4e2a\u5b64\u7acb\u70b9\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u5b64\u7acb\u70b9\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u4e00\u4e2a\u8fde\u901a\u5757\uff0c$f_{i,0}=f_{i,1}=f_{i-1,0}+f_{i-1,1}$\uff0c\u5176\u4e2d $i$ \u4e3a\u8be5\u5b64\u7acb\u70b9\u5bf9\u5e94\u7684\u8fde\u901a\u5757\u7684\u7f16\u53f7\u3002\n- \u5bf9\u4e8e\u5355\u4e00\u53d8\u91cf\u7684\u5e03\u5c14\u8868\u8fbe\u5f0f\uff0c\u6211\u4eec\u8bb0\u5f55\u4e00\u4e2a $msk_i$\uff0c\u53d6\u503c\u8303\u56f4 $\\{-1,0,1\\}$\uff0c$msk_i=-1$ \u8868\u793a $i$ \u4ee5 $\\lnot x_i$ \u7684\u5f62\u5f0f\u8ba1\u5165\u7b54\u6848\uff0c$msk_i=1$ \u8868\u793a $i$ \u4ee5 $x_i$ \u7684\u5f62\u5f0f\u8ba1\u5165\u7b54\u6848\uff0c$msk_i=0$ \u8868\u793a $i$ \u4e0d\u8ba1\u5165\u7b54\u6848\u3002\u663e\u7136\u6211\u4eec\u6bcf\u9047\u5230\u4e00\u4e2a\u5355\u4e00\u53d8\u91cf\u7684\u5e03\u5c14\u8868\u8fbe\u5f0f\u90fd\u53ef\u4ee5 $\\mathcal O(1)$ \u66f4\u65b0 $msk_i$\u3002\u6700\u540e\u5bf9\u4e8e\u6240\u6709\u5bf9\u4e8e\u56fe\u4e0a\u7684\u5b64\u7acb\u70b9\uff0c\u82e5 $msk_i=\\pm 1$\uff0c\u5219\u6211\u4eec\u53ef\u5c06\u5176\u89c6\u4f5c\u4e00\u4e2a\u8fde\u901a\u5757\uff0c$f_{i,0}=f_{i,1}=f_{i-1,0}+f_{i-1,1}$\u3002\u5426\u5219\u4f60\u8fd9\u4e2a\u53d8\u91cf\u7231\u53d6 $1$ \u5c31\u53d6 $1$\uff0c\u7231\u53d6 $0$ \u5c31\u53d6 $0$\uff0c\u5bf9\u5f02\u6216\u503c\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\uff0c\u7b54\u6848\u4e58 $2$\u3002\n- \u5bf9\u4e8e\u6bcf\u6761\u94fe\uff0c\u82e5\u5176\u7aef\u70b9\u4ee5\u5355\u4e00\u53d8\u91cf\u7684\u5f62\u5f0f\u8ba1\u5165\u7b54\u6848\uff0c\u5373 $msk_i\\ne 0$\uff0c\u4ee5 $msk_i=1$ \u4e3a\u4f8b\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u5728 $dp$ \u65f6\u5019\u4ee4 $dp$ \u521d\u503c\u4e3a $dp_{0,x_i,x_i}=1$ instead of $dp_{0,x_i,0}=1$ \u5373\u53ef\uff1b$msk_i=-1$ \u5c31\u4ee4 $dp_{0,x_i,\\lnot x_i}=1$\u3002\u7ed3\u5c3e\u5904\u4e5f\u540c\u7406\uff0c\u5c31\u5728\u6839\u636e\u7ed3\u5c3e\u5904\u7684 $dp$ \u503c\u8f6c\u79fb $f_{i,j}$ \u65f6\u7a0d\u5fae\u6539\u51e0\u4e2a\u7ec6\u8282\u5373\u53ef\u3002\n\n\u603b\u800c\u8a00\u4e4b\u662f\u4e00\u9053\u963f\u5df4\u7ec6\u8282\u9898\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntypedef unsigned int u32;\ntypedef unsigned long long u64;\nnamespace fastio{\n\t#define FILE_SIZE 1<<23\n\tchar rbuf[FILE_SIZE],*p1=rbuf,*p2=rbuf,wbuf[FILE_SIZE],*p3=wbuf;\n\tinline char getc(){return p1==p2&&(p2=(p1=rbuf)+fread(rbuf,1,FILE_SIZE,stdin),p1==p2)?-1:*p1++;}\n\tinline void putc(char x){(*p3++=x);}\n\ttemplate<typename T> void read(T &x){\n\t\tx=0;char c=getchar();T neg=0;\n\t\twhile(!isdigit(c)) neg|=!(c^'-'),c=getchar();\n\t\twhile(isdigit(c)) x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\t\tif(neg) x=(~x)+1;\n\t}\n\ttemplate<typename T> void recursive_print(T x){if(!x) return;recursive_print(x/10);putc(x%10^48);}\n\ttemplate<typename T> void print(T x){if(!x) putc('0');if(x<0) putc('-'),x=~x+1;recursive_print(x);}\n\tvoid print_final(){fwrite(wbuf,1,p3-wbuf,stdout);}\n}\nconst int MAXN=1e5;\nconst int MOD=1e9+7;\nvoid add(int &x,int y){x+=y;if(x>=MOD) x-=MOD;}\nint n,m,msk[MAXN+5],deg[MAXN+5];bool vis[MAXN+5];\nint sgn(int x){return (x>0)?0:1;}\nstruct edge{\n\tint u,v,su,sv,id;\n\tedge(int _u,int _v,int _su,int _sv,int _id):u(_u),v(_v),su(_su),sv(_sv),id(_id){}\n};\nvector<edge> g[MAXN+5];\nint f[MAXN+5][2];\nvector<pair<int,pii> > ch;\nvoid dfs(int x,int pre,int rt){\n\tvis[x]=1;\n\tfor(int i=0;i<g[x].size();i++){\n\t\tint y=g[x][i].v,sx=g[x][i].su,sy=g[x][i].sv,id=g[x][i].id;\n\t\tif(id==pre) continue;ch.pb(mp(y,mp(sx,sy)));\n\t\tif(y^rt){dfs(y,id,rt);return;}\n\t}\n}\nint main(){\n\tscanf(\"%d%d\",&m,&n);int goal=1;\n\tmemset(msk,-1,sizeof(msk));int mul=1;\n\tf[0][0]=1;int grp_n=0;\n\tfor(int i=1;i<=m;i++){\n\t\tint k;scanf(\"%d\",&k);\n\t\tif(k==1){\n\t\t\tint x;scanf(\"%d\",&x);\n\t\t\tif(!~msk[abs(x)]) msk[abs(x)]=sgn(x);\n\t\t\telse{\n\t\t\t\tif(msk[abs(x)]^sgn(x)) goal^=1;\n\t\t\t\tmsk[abs(x)]=-1;\n\t\t\t}\n\t\t} else {\n\t\t\tint u,v;scanf(\"%d%d\",&u,&v);\n\t\t\tif(u==v){\n\t\t\t\tvis[abs(u)]=1;grp_n++;\n\t\t\t\tf[grp_n][0]=f[grp_n][1]=(f[grp_n-1][0]+f[grp_n-1][1])%MOD;\n\t\t\t} else if(u+v==0) goal^=1,vis[abs(u)]=1,mul=2ll*mul%MOD;\n\t\t\telse if(u+v!=0){\n\t\t\t\tg[abs(u)].pb(edge(abs(u),abs(v),sgn(u),sgn(v),i));\n\t\t\t\tg[abs(v)].pb(edge(abs(v),abs(u),sgn(v),sgn(u),i));\n\t\t\t\tdeg[abs(u)]++;deg[abs(v)]++;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tif(!deg[i]){\n\t\t\tif(!~msk[i]&&!vis[i]) mul=2ll*mul%MOD;\n\t\t\telse if(!vis[i]){\n\t\t\t\tgrp_n++;\n\t\t\t\tf[grp_n][0]=f[grp_n][1]=(f[grp_n-1][0]+f[grp_n-1][1])%MOD;\n\t\t\t}\n\t\t} else if(deg[i]==1&&!vis[i]){\n\t\t\tch.clear();ch.pb(mp(i,mp(0,0)));dfs(i,0,0);vector<int> dp[2][2];\n\t\t\tfor(int j=0;j<2;j++) for(int k=0;k<2;k++) dp[j][k].resize(ch.size());\n\t\t\tif(~msk[i]) for(int j=0;j<2;j++) dp[j][j^msk[i]][0]=1;\n\t\t\telse for(int j=0;j<2;j++) dp[j][0][0]=1;\n\t\t\tfor(int j=1;j<ch.size();j++){\n\t\t\t\tint su=ch[j].se.fi,sv=ch[j].se.se;\n\t\t\t\tfor(int o=0;o<2;o++) for(int p=0;p<2;p++) for(int q=0;q<2;q++){\n\t\t\t\t\tadd(dp[o][((p^su)|(o^sv))^q][j],dp[p][q][j-1]);\n\t\t\t\t}\n\t\t\t} grp_n++;int lst=ch.back().fi;\n\t\t\tfor(int o=0;o<2;o++) for(int p=0;p<2;p++){\n\t\t\t\tint res=o;if(~msk[lst]) res^=(p^msk[lst]);\n\t\t\t\tadd(f[grp_n][0],1ll*f[grp_n-1][res]*dp[p][o].back()%MOD);\n\t\t\t\tadd(f[grp_n][1],1ll*f[grp_n-1][res^1]*dp[p][o].back()%MOD);\n\t\t\t}\n//\t\t\tprintf(\"Group %d:\\n\",grp_n);\n//\t\t\tfor(int j=0;j<ch.size();j++) printf(\"%d %d %d\\n\",ch[j].fi,ch[j].se.fi,ch[j].se.se);\n//\t\t\tfor(int j=0;j<ch.size();j++) printf(\"%d %d %d %d\\n\",dp[0][0][j],dp[0][1][j],dp[1][0][j],dp[1][1][j]);\n//\t\t\tprintf(\"%d %d %d\\n\",i,f[grp_n][0],f[grp_n][1]);\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) if(deg[i]==2&&!vis[i]){\n\t\tch.clear();ch.pb(mp(i,mp(0,0)));dfs(i,0,i);vector<int> dp[2][2][2];\n\t\tfor(int j=0;j<2;j++) for(int k=0;k<2;k++) for(int l=0;l<2;l++) dp[j][k][l].resize(ch.size());\n\t\tfor(int j=0;j<2;j++) dp[j][0][j][0]=1;\n\t\tfor(int j=1;j<ch.size();j++){\n\t\t\tint su=ch[j].se.fi,sv=ch[j].se.se;\n\t\t\tfor(int o=0;o<2;o++) for(int p=0;p<2;p++)\n\t\t\t\tfor(int q=0;q<2;q++) for(int r=0;r<2;r++){\n\t\t\t\t\tadd(dp[o][((p^su)|(o^sv))^q][r][j],dp[p][q][r][j-1]);\n\t\t\t\t}\n\t\t} grp_n++;int lst=ch.back().fi;\n\t\tfor(int o=0;o<2;o++) for(int p=0;p<2;p++){\n\t\t\tadd(f[grp_n][0],1ll*f[grp_n-1][o]*dp[p][o][p].back()%MOD);\n\t\t\tadd(f[grp_n][1],1ll*f[grp_n-1][o^1]*dp[p][o][p].back()%MOD);\n\t\t}\n//\t\tprintf(\"Group %d:\\n\",grp_n);\n//\t\tfor(int j=0;j<ch.size();j++) printf(\"%d %d %d\\n\",ch[j].fi,ch[j].se.fi,ch[j].se.se);\n//\t\tprintf(\"%d %d %d\\n\",i,f[grp_n][0],f[grp_n][1]);\n\t}\n\tprintf(\"%d\\n\",1ll*f[grp_n][goal]*mul%MOD);\n\treturn 0;\n}\n/*\n8 10\n1 -5\n2 4 -6\n2 -2 -6\n2 -7 9\n2 10 -1\n2 3 -1\n2 -8 9\n2 5 8\n*/\n```\n\n",
        "postTime": 1615905233,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF704C Black Widow"
    },
    {
        "content": "> [CF704C Black Widow](https://codeforces.com/contest/704/problem/C)\r\n\r\n## \u9898\u610f\r\n\r\n- \u6709 $m$ \u4e2a\u5e03\u5c14\u53d8\u91cf $x_{1\\dots m}$\uff0c\u8bbe $x_{-i}=\\neg x_{i}$\u3002\r\n- \u7ed9\u5b9a $n$ \u4e2a\u5f62\u5982 $x_i$ \u6216 $x_i \\operatorname{or} x_j$ \u7684\u8868\u8fbe\u5f0f\uff0c\u4fdd\u8bc1 $x_i$ \u548c $x_{-i}$ \u5728\u6240\u6709\u8868\u8fbe\u5f0f\u4e2d\u4e00\u5171\u53ea\u4f1a\u51fa\u73b0\u6700\u591a\u4e24\u6b21\u3002\r\n- \u8be2\u95ee\u5728 $2^m$ \u79cd\u4e0d\u540c\u7684\u53d6\u503c\u65b9\u6848\u4e2d\uff0c\u6709\u591a\u5c11\u79cd\u65b9\u6848\u4f7f\u5f97\u6240\u6709\u8868\u8fbe\u5f0f\u7684\u503c\u7684\u5f02\u6216\u4e3a $1$\u3002\r\n- $n,m \\le 10^5$\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\r\n\r\n## \u9898\u89e3\r\n\r\n\u5c06\u6bcf\u4e2a\u8868\u8fbe\u5f0f\u770b\u6210\u4e00\u4e2a\u70b9\u3002\u5b9a\u4e49\u4e00\u4e2a\u70b9\u7684\u503c\u4e3a\u8fd9\u4e2a\u70b9\u5bf9\u5e94\u7684\u8868\u8fbe\u5f0f\u7684\u503c\uff0c\u4e00\u4e2a\u8fde\u901a\u5757\u7684\u503c\u4e3a\u8fde\u901a\u5757\u5185\u70b9\u7684\u503c\u7684\u5f02\u6216\uff0c\u6574\u4e2a\u56fe\u7684\u503c\u4e3a\u6240\u6709\u8fde\u901a\u5757\u7684\u503c\u7684\u5f02\u6216\u3002\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u6574\u4e2a\u56fe\u7684\u503c\u4e3a $1$ \u7684\u65b9\u6848\u6570\u3002\r\n\r\n\u7531\u4e8e\u4fdd\u8bc1 $x_i$ \u548c $x_{-i}$ \u5728\u6240\u6709\u8868\u8fbe\u5f0f\u4e2d\u4e00\u5171\u53ea\u4f1a\u51fa\u73b0\u6700\u591a\u4e24\u6b21\uff0c\u5982\u679c\u4e24\u4e2a\u8868\u8fbe\u5f0f\u5b58\u5728\u76f8\u540c\u7684 $x_{|i|}$\uff0c\u5219\u8fde\u4e00\u6761\u8fb9\u3002\r\n\r\n\u5047\u8bbe\u6211\u4eec\u6c42\u51fa\u6765\u4e86\u6bcf\u4e2a\u8fde\u901a\u5757\u7684\u503c\u4e3a $0/1$ \u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48 dp \u4e00\u6b21\u5373\u53ef\u6c42\u51fa\u6574\u4e2a\u56fe\u7684\u503c\u4e3a $0/1$ \u7684\u65b9\u6848\u6570\uff1a\r\n\r\n> \u8bbe $c_{i,0/1}$ \u8868\u793a\u7b2c $i$ \u4e2a\u8fde\u901a\u5757\u503c\u4e3a $0/1$ \u7684\u65b9\u6848\u6570\u3002\r\n>\r\n> \u8bbe $f_{i,0/1}$ \u8868\u793a\u53ea\u8003\u8651\u524d $i$ \u4e2a\u8fde\u901a\u5757\uff0c\u503c\u4e3a $0/1$ \u7684\u65b9\u6848\u6570\u3002\r\n>\r\n> \u521d\u59cb\u72b6\u6001\uff1a$f_{0,0} = 1$\u3002\r\n>\r\n> \u76ee\u6807\u72b6\u6001\uff1a$f_{*,1}$\u3002\r\n>\r\n> \u8f6c\u79fb\uff1a$f_{i,j} = f_{i-1,j} \\times c_{i,0} + f_{i-1,j \\operatorname{xor} 1} \\times c_{i,1}$\u3002\r\n\r\n\u73b0\u5728\u8003\u8651\u5982\u4f55\u5bf9\u4e8e\u6bcf\u4e2a\u8fde\u901a\u5757\u6c42 $c_{0/1}$\u3002\r\n\r\n\u6ce8\u610f\u5230\u8fde\u51fa\u6765\u7684\u56fe\u4e00\u5b9a\u7531\u82e5\u5e72\u4e2a\u8fde\u901a\u5757\u7ec4\u6210\u7684\uff0c\u800c\u8fde\u901a\u5757\u53ea\u6709\u56db\u79cd\u5f62\u6001\uff0c\u6211\u4eec\u5206\u522b\u8003\u8651\u3002\r\n\r\n### \u4e00\u4e2a\u70b9\u7684\u94fe\r\n\r\n\u8868\u8fbe\u5f0f\u5f62\u5982 $x_i$\uff0c\u5219 $c_{0} = c_1 = 1$\u3002\r\n\r\n\u8868\u8fbe\u5f0f\u5f62\u5982 $x_i \\operatorname{or} x_j$\uff0c\u5219 $c_0 = 1$\uff0c$c_1 = 3$\u3002\r\n\r\n### \u4e00\u4e2a\u70b9\u7684\u73af\r\n\r\n\u8868\u8fbe\u5f0f\u5f62\u5982 $x_i \\operatorname{or} x_i$\uff0c\u5219 $c_0 = c_1 = 1$\u3002\r\n\r\n\u8868\u8fbe\u5f0f\u5f62\u5982 $x_i \\operatorname{or} x_{-i}$\uff0c\u5219 $c_0 = 0$\uff0c$c_1 = 2$\u3002\r\n\r\n### \u81f3\u5c11\u4e24\u4e2a\u70b9\u7684\u94fe\r\n\r\n\u8fd9\u79cd\u5f62\u6001\u4e0b\uff0c\u94fe\u7684\u4e24\u7aef\u5bf9\u5e94\u7684\u8868\u8fbe\u5f0f\u53ef\u80fd\u5f62\u5982 $x_i$\uff0c\u4e5f\u53ef\u80fd\u5f62\u5982 $x_i \\operatorname{or} x_j$\u3002\r\n\r\n\u5982\u679c\u5f62\u5982 $x_i$\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5f53\u505a $x_i \\operatorname{or} 0$ \u770b\u5f85\uff0c\u7136\u540e\u4f9d\u7136\u8003\u8651 dp\u3002\r\n\r\n> \u8bbe\u7b2c $i$ \u4e2a\u70b9\u4e0a\u7684\u8868\u8fbe\u5f0f\u4e3a $x_{p_i} \\operatorname{or} x_{q_i}$\uff0c\u5176\u4e2d $x_{|q_{i-1}|} = x_{|p_i|}$\u3002\r\n>\r\n> \u8bbe $g_{i,0/1,0/1}$ \u8868\u793a\u53ea\u8003\u8651\u524d $i$ \u4e2a\u70b9\uff0c\u503c\u4e3a $0/1$\uff0c$x_{|q_i|} = 0/1$ \u7684\u65b9\u6848\u6570\u3002\r\n>\r\n> \u521d\u59cb\u72b6\u6001\uff1a\u5bf9\u4e8e $x_{|p_1|}$ \u7684\u6bcf\u79cd\u53d6\u503c\uff0c$g_{0,0,x_{|p_1|}} = 1$\u3002\r\n>\r\n> \u76ee\u6807\u72b6\u6001\uff1a\u5bf9\u4e8e $x_{|q_{*}|}$ \u7684\u6bcf\u79cd\u53d6\u503c\uff0c$c_0 \\leftarrow g_{*,0,x_{|q_{*}|}}$\uff0c$c_1 \\leftarrow g_{*,1,x_{|q_{*}|}}$\u3002\r\n>\r\n> \u8f6c\u79fb\uff1a\u5bf9\u4e8e $x_{|p_i|},x_{|q_i|}$ \u7684\u6bcf\u79cd\u53d6\u503c\uff0c$g_{i,(x_{p_i} \\operatorname{or} x_{q_i}) \\operatorname{xor} j,x_{|q_i|}} \\leftarrow \\sum_{j=0}^1 g_{i-1,j,x_{|p_i|}}$\u3002\r\n\r\n### \u81f3\u5c11\u4e24\u4e2a\u70b9\u7684\u73af\r\n\r\n\u968f\u4fbf\u9009\u4e00\u6761\u8fb9\u65ad\u5f00\uff0c\u8f6c\u5316\u6210**\u81f3\u5c11\u4e24\u4e2a\u70b9\u7684\u94fe**\u7684\u5f62\u6001\u3002\r\n\r\n\u5bf9\u4e8e\u65ad\u5f00\u5904\u7684\u53d8\u91cf\uff0c\u679a\u4e3e\u5b83\u7684\u503c $w$ \u4e3a $0/1$\uff0c\u7136\u540e\u628a\u4e24\u7aef\u5f53\u505a $x_i \\operatorname{or} w$ \u770b\u5f85\u3002\r\n\r\n\u7136\u540e\u7528**\u81f3\u5c11\u4e24\u4e2a\u70b9\u7684\u94fe**\u7684\u65b9\u6cd5\u505a\u5373\u53ef\u3002\r\n\r\n## \u4ee3\u7801\r\n\r\n```cpp\r\nconst int N = 1e5 + 7;\r\nint n, m, d[N], k, v[N];\r\nvi a[N], b[N], e[N], s;\r\nmodint f[N][2], c[2], g[N][2][2], ans = 1;\r\n\r\nvoid dfs(int x) {\r\n\tv[x] = k, s.pb(x);\r\n\tfor (int y : e[x])\r\n\t\tif (!v[y]) dfs(y);\r\n}\r\n\r\ninline void dp(int l1, int r1, int l2, int r2) {\r\n\tint t = s.size();\r\n\tfor (int i = 0; i <= t; i++)\r\n\t\tfor (int j = 0; j < 2; j++)\r\n\t\t\tfor (int k = 0; k < 2; k++)\r\n\t\t\t\tg[i][j][k] = 0;\r\n\tfor (int i = l1; i <= r1; i++) g[0][0][i] = 1;\r\n\tif (!a[s[0]][1] || (abs(a[s[0]][1]) != abs(a[s[1]][0]) && abs(a[s[0]][1]) != abs(a[s[1]][1]))) swap(a[s[0]][0], a[s[0]][1]);\r\n\tfor (int i = 1; i < t; i++)\r\n\t\tif (abs(a[s[i]][0]) != abs(a[s[i-1]][1]))\r\n\t\t\tswap(a[s[i]][0], a[s[i]][1]);\r\n\tfor (int i = 1; i <= t; i++) {\r\n\t\tint x = s[i-1];\r\n\t\tfor (int p = 0; p < 2; p++)\r\n\t\t\tfor (int q = 0; q < 2; q++)\r\n\t\t\t\tfor (int j = 0; j < 2; j++)\r\n\t\t\t\t\tg[i][(((a[x][0]<0)^p)|((a[x][1]<0)^q))^j][q] += g[i-1][j][p];\r\n\t}\r\n\tfor (int i = 0; i < 2; i++)\r\n\t\tfor (int j = l2; j <= r2; j++)\r\n\t\t\tc[i] += g[t][i][j];\r\n}\r\n\r\ninline void solve(int o) {\r\n\tif (s.size() == 1u) {\r\n\t\tint x = s[0];\r\n\t\tif (a[x].size() == 1u) return c[0] = c[1] = 1, void();\r\n\t\tif (abs(a[x][0]) != abs(a[x][1])) return c[0] = 1, c[1] = 3, void();\r\n\t\tif (a[x][0] == a[x][1]) return c[0] = c[1] = 1, void();\r\n\t\treturn c[0] = 0, c[1] = 2, void();\r\n\t}\r\n\tint rt = 0;\r\n\tfor (int x : s)\r\n\t\tif (d[x] == 1) rt = x;\r\n\tc[0] = c[1] = 0;\r\n\tif (rt) {\r\n\t\tfor (int x : s) v[x] = 0;\r\n\t\ts.clear(), dfs(rt);\r\n\t\tint x = s[0], l1 = 0, r1 = 1, l2 = 0, r2 = 1;\r\n\t\tif (a[x].size() == 1u) r1 = 0, a[x].pb(0);\r\n\t\tx = s.back();\r\n\t\tif (a[x].size() == 1u) r2 = 0, a[x].pb(0);\r\n\t\treturn dp(l1, r1, l2, r2);\r\n\t}\r\n\tdp(0, 0, 0, 0), dp(1, 1, 1, 1);\r\n}\r\n\r\nint main() {\r\n\trd(n), rd(m);\r\n\tfor (int i = 1, o, x; i <= n; i++) {\r\n\t\trd(o);\r\n\t\twhile (o--) rd(x), a[i].pb(x), b[abs(x)].pb(i);\r\n\t}\r\n\tfor (int i = 1; i <= m; i++)\r\n\t\tif (b[i].size() == 2u) {\r\n\t\t\tint x = b[i][0], y = b[i][1];\r\n\t\t\te[x].pb(y), e[y].pb(x), ++d[x], ++d[y];\r\n\t\t} else if (!b[i].size()) ans *= 2;\r\n\tf[0][0] = 1;\r\n\tfor (int i = 1; i <= n; i++)\r\n\t\tif (!v[i]) {\r\n\t\t\ts.clear(), ++k, dfs(i), solve(k);\r\n\t\t\tfor (int j = 0; j < 2; j++)\r\n\t\t\t\tf[k][j] = f[k-1][j] * c[0] + f[k-1][j^1] * c[1];\r\n\t\t}\r\n\tans *= f[k][1];\r\n\tprint(ans);\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1583593878,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF704C \u3010Black Widow\u3011"
    },
    {
        "content": "\u53d1\u73b0\u6bcf\u4e2a\u53d8\u91cf\u6700\u591a\u51fa\u73b0$2$\u6b21\uff0c\u90a3\u4e48\u8003\u8651\u82e5\u5c06\u6709\u7b49\u5f0f\u5173\u7cfb\u7684\u4e24\u4e2a\u70b9\u4e4b\u95f4\u8fde\u4e00\u6761\u8fb9\uff0c\u90a3\u4e48\u8fd9\u5f20\u56fe\u4e00\u5b9a\u662f\u4e00\u5806\u5355\u72ec\u7684\u73af\u548c\u94fe\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u7684\u5ea6\u6570\u81f3\u591a\u4e3a$2$\u3002\n\n\u90a3\u4e48\u9996\u5148\u8003\u8651\u94fe\uff0c\u53ef\u4ee5\u8bbe$f[i][0/1][0/1]$\u8868\u793a\u5f53\u524d\u8003\u8651\u5230\u4e86\u7b2c$i$\u4e2a\u70b9\uff0c\u524d\u4e00\u4e2a\u7684\u6743\u503c\u4e3a$0/1$\uff0c\u5f53\u524d\u6d89\u53ca\u7684\u7b49\u5f0f\u7684\u5f02\u6216\u548c\u4e3a$0/1$\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u7684\u8bdd\u76f4\u63a5\u679a\u4e3e$2^3$\u79cd\u60c5\u51b5\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u73af\u7684\u8bdd\u8003\u8651\u5148\u679a\u4e3e\u8d77\u70b9\u7684\u53d6\u503c\uff0c\u7136\u540e\u505a\u4e00\u904d\u8ddf\u4e0a\u9762\u4e00\u6837\u7684$dp$\uff0c\u7136\u540e\u518d\u7b97\u65b9\u6848\u6570\u5373\u53ef\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e\u505a\u4e24\u904d\u3002\n\n\u90a3\u4e48\u628a\u73af\u548c\u94fe\u53d6$0$\u548c$1$\u7684\u65b9\u6848\u6570\u6c42\u51fa\u6765\u6700\u540e\u7efc\u5408\u518d\u505a\u4e00\u4e2a$dp$\u5408\u5e76\u5373\u53ef\u3002\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6$O(n)$\u3002\n\n\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e00\u4e2a\u5f0f\u5b50\u53ea\u6709\u4e00\u4e2a\u70b9\u548c\u4e00\u4e2a\u5f0f\u5b50\u91cc\u7684\u4e24\u4e2a\u53d8\u91cf\u662f\u540c\u4e00\u4e2a\u70b9\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u60c5\u51b5\u76f4\u63a5\u7ed9\u6bcf\u4e2a\u70b9\u8bb0\u4e00\u4e2a$val[i][0/1]$\u8868\u793a\u8fd9\u4e2a\u70b9\u9009$0$\u548c\u9009$1$\u7684\u9644\u52a0\u6743\u503c\uff0c$dp$\u7684\u65f6\u5019\u987a\u4fbf\u8bb0\u4e00\u4e0b\u5373\u53ef\u3002\n\ncode\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define maxn 100010\n#define mod 1000000007\nusing namespace std;\ntypedef long long ll;\nint read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch-'0'<0||ch-'0'>9){if(ch=='-') f=-1;ch=getchar();}\n    while(ch-'0'>=0&&ch-'0'<=9){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nint n,m;\nint val[maxn][2];\nstruct P{\n    int to,a,b,id;\n};\nvector<P>e[maxn];\nint cnt,col[maxn],cnt_edge,deg[maxn],cntx;\nint f[maxn][2][2],g[maxn][2];\nvoid add(int &x,int y)\n{\n    x=(x+y>=mod)?x+y-mod:x+y;\n}\nvoid dfs_chain(int x,int st)\n{\n    ++cntx;col[x]=cnt;\n    if(x==st)  f[cntx][0][val[x][0]]=f[cntx][1][val[x][1]]=1;\n    for(int i=0;i<e[x].size();i++)\n    {\n        P p=e[x][i];\n        if(col[p.to])  continue;\n        for(int j=0;j<2;j++)\n          for(int k=0;k<2;k++)\n            for(int l=0;l<2;l++) \n              add(f[cntx+1][l][k^((j^p.a)|(l^p.b))^val[p.to][l]],f[cntx][j][k]);\n        dfs_chain(p.to,st);\n    }\n}\nvoid init()\n{\n    for(int i=1;i<=cntx;i++)\n      for(int j=0;j<2;j++)\n        for(int k=0;k<2;k++)  f[i][j][k]=0;\n}\nint book[2][maxn];\nvoid dfs_cir(int x,int st,int c)\n{\n    ++cntx;col[x]=cnt;\n    if(x==st)  f[cntx][c][val[x][c]]=1;\n    for(int i=0;i<e[x].size();i++)\n    {\n        P p=e[x][i];\n        if(book[c][p.id])  continue;\n        book[c][p.id]=1;\n        if(p.to==st)\n        {\n            for(int j=0;j<2;j++)\n            {\n                for(int k=0;k<2;k++)\n                {\n                    int op=(k^((j^p.a)|(c^p.b)));\n                    add(g[cnt][op],f[cntx][j][k]);\n                }\n            }\n        }\n        else{\n            for(int j=0;j<2;j++)\n              for(int k=0;k<2;k++)\n                for(int l=0;l<2;l++)\n                  add(f[cntx+1][l][k^((j^p.a)|(l^p.b))^val[p.to][l]],f[cntx][j][k]); \n            dfs_cir(p.to,st,c);      \n        }\n    }\n}\nint h[maxn][2];\nint main()\n{\n    n=read();m=read();\n    for(int i=1;i<=n;i++)\n    {\n        int k=read();\n        if(k==1)\n        {\n            int x=read();\n            if(x<0)  val[-x][0]^=1;\n            else     val[x][1]^=1;\n        }\n        else{\n            int x=read(),y=read();\n            if(abs(x)==abs(y))\n            {\n                if(x<0&&y<0)  val[abs(x)][0]^=1;\n                else if(x>0&&y>0)  val[abs(x)][1]^=1;\n                else val[abs(x)][0]^=1,val[abs(x)][1]^=1;\n                continue;\n            }\n            ++cnt_edge;\n            e[abs(x)].push_back((P){abs(y),(x<0),(y<0),cnt_edge});\n            e[abs(y)].push_back((P){abs(x),(y<0),(x<0),cnt_edge});\n            deg[abs(x)]++;deg[abs(y)]++;\n        }\n    }\n    for(int i=1;i<=m;i++)\n    {\n        if(!col[i]&&deg[i]<=1)\n        {\n            ++cnt;cntx=0;\n            dfs_chain(i,i);\n            g[cnt][0]=(f[cntx][0][0]+f[cntx][1][0])%mod;\n            g[cnt][1]=(f[cntx][0][1]+f[cntx][1][1])%mod;\n            init();\n        }\n    }\n    for(int i=1;i<=m;i++)\n    {\n        if(!col[i])\n        {\n            ++cnt;cntx=0;\n            dfs_cir(i,i,0);\n            init();cntx=0;\n            dfs_cir(i,i,1);\n            init();\n        }\n    }\n    h[0][0]=1;\n    for(int i=1;i<=cnt;i++)\n      for(int j=0;j<2;j++)\n        for(int k=0;k<2;k++)  add(h[i][j],1ll*h[i-1][k]*g[i][j^k]%mod);\n    cout<<h[cnt][1]<<endl;\n    return 0;\n}\n```",
        "postTime": 1582542323,
        "uid": 46396,
        "name": "justin_cao",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF704C \u3010Black Widow\u3011"
    }
]