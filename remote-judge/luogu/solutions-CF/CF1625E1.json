[
    {
        "content": "# CF1625E1 - Cats on the Upgrade (easy version) \u9898\u89e3\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u62ec\u53f7\u5e8f\u5217 $S$\u3002\n\n\u5171\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee $S$ \u4ece $l$ \u5230 $r$ \u7684\u5b57\u4e32 $T$ \u7684\u5b57\u4e32\u4e2d\u4e2d\u542b\u6709\u591a\u5c11\u4e2a\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\uff0c\u4fdd\u8bc1\u6bcf\u4e2a $T$ \u4e00\u5b9a\u662f\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\u3002\n\n\u6570\u636e\u8303\u56f4\u4fdd\u8bc1\uff1a$n,q\\le3\\times 10^5$\u3002\n\n## \u601d\u8def\u5206\u6790\n\n\u9996\u5148\u8003\u8651 $S$ \u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u7684\u60c5\u51b5\uff1a\n\n\u7ea6\u5b9a $s[i]$ \u662f\u5de6\u62ec\u53f7\u65f6 $g[i]=0$\uff0c\u5426\u5219 $g[i]=1$\uff0c$ans(l,r)$ \u8868\u793a\u67e5\u8be2\u4ece $l$ \u5230 $r$ \u7684\u5b57\u4e32 $T$ \u7684\u5b57\u4e32\u4e2d\u4e2d\u542b\u6709\u591a\u5c11\u4e2a\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u7684\u7b54\u6848\u3002\n\n\u6ce8\u610f\u5230\u7279\u6b8a\u6027\u8d28 $T$ \u4e00\u5b9a\u662f\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5206\u6790 $T$ \u5185\u90e8\u7684\u5408\u6cd5\u62ec\u53f7\u5b50\u5e8f\u5217\u3002\n\n\u8003\u8651\u5bf9 $S$ \u91cc\u7684\u62ec\u53f7\u5bf9\u8fdb\u884c\u5206\u5c42\uff0c\u7528 $d[i]$ \u8868\u793a\u53f3\u62ec\u53f7\u5728 $i$ \u4f4d\u7f6e\u4e0a\u7684\u62ec\u53f7\u5bf9\u5d4c\u5957\u4e86\u51e0\u4e2a\u62ec\u53f7\uff0c\u8fd9\u53ef\u4ee5\u5728\u7528\u6808\u5339\u914d\u7684\u65f6\u5019\u5b8c\u6210\u3002\n\n- $g[i]=0$ \u65f6 $d[i]=0$\u3002\n- $g[i]=1$ \u65f6 $d[i]=$\u5bf9\u5e94\u5de6\u62ec\u53f7\u51fa\u6808\u540e\u6808\u7684\u5927\u5c0f\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u6574\u4e2a\u62ec\u53f7\u5e8f\u5217\u8f6c\u6210\u4e00\u68f5\u6811\uff0c\u4e00\u5bf9\u62ec\u53f7\u5bf9\u5e94\u4e00\u4e2a\u8282\u70b9\uff0c\u6bcf\u5bf9\u62ec\u53f7\u5185\u90e8\u5d4c\u5957\u7684\u5c31\u662f\u5176\u5b50\u8282\u70b9\uff0c\u5f62\u6210\u4e00\u4e2a\u68ee\u6797\u540e\uff0c\u65b0\u5efa\u4e00\u4e2a\u865a\u62df\u6839\u8282\u70b9\u8f6c\u6210\u6811\u3002\n\n\u7528 $f[i]$ \u8868\u793a\u6bcf\u4e2a\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5728\u5176\u4e4b\u524d\u51fa\u73b0\uff0c\u663e\u7136\u8fd9\u4e5f\u53ef\u4ee5\u5728\u6808\u7ef4\u62a4\u7684\u65f6\u5019\u987a\u4fbf\u5b8c\u6210\uff1a\n- $g[i]=0$ \u65f6 $f[i]=0$\u3002\n- $g[i]=1$ \u65f6 $f[i]=$\u5bf9\u5e94\u5de6\u62ec\u53f7\u51fa\u6808\u524d\u4e00\u4f4d\u7684 $f$ \u503c $+1$\u3002\n\n\u4ee5\u5e8f\u5217\"\uff08\uff08\uff08  \uff09\uff08  \uff09\uff08  \uff09\uff09\uff08  \uff09\uff09\uff08\uff08  \uff09\uff09\"\u4e3a\u4f8b\uff0c\u6211\u4eec\u628a\u8fd9\u68f5\u6811\u5efa\u51fa\u6765\u770b\u4e00\u770b\uff08\u8282\u70b9\u4e0a\u7684\u7f16\u53f7\u662f\u53f3\u62ec\u53f7\u7684\u4f4d\u7f6e\uff0croot\u662f\u865a\u62df\u6839\u8282\u70b9\uff09\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/xbut7jsk.png)\n\n\u6b64\u65f6\u6811\u4e2d\u7684\u6ca1\u4e00\u4e2a\u8282\u70b9\u90fd\u4ee3\u8868\u4e86\u4e00\u4e2a\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u3002\n\n\u7136\u540e\u518d\u628a\u5bf9\u5e94\u7684 $f$ \u503c\u5199\u51fa\u6765\uff1a\n\n| i     | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   | 16   |\n| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |\n| $f[i]=$ | 0    | 0    | 0    | 1    | 0    | 2    | 0    | 3    | 1    | 0    | 2    | 1    | 0    | 0    | 1    | 2    |\n\n\u7136\u540e\u6211\u4eec\u6765\u770b\u4e00\u770b\u8fd9\u548c\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u5bf9\u6570\u7684\u5173\u7cfb\uff0c\u6765\u9020\u51e0\u7ec4\u6837\u4f8b\u6d4b\u8bd5\u4e00\u4e0b\uff01\n$$\n\\begin{cases}\nans(3,8)=6=\\sum_{i=3}^8f[i]\\\\\nans(1,12)=10=\\sum_{i=1}^{12}f[i]\\\\\nans(1,16)=13=\\sum_{i=1}^{16}f[i]\n\\end{cases}\n$$\n\u597d\u50cf\u53d1\u73b0\u4e86\u4e00\u4e9b\u89c4\u5f8b\uff0c\u5927\u80c6\u731c\u60f3\u4e00\u4e0b $ans(l,r)=\\sum_{i=l}^rf[i]$\n\n\u8ba9\u6211\u4eec\u6765\u5c1d\u8bd5\u8bc1\u660e\u4e00\u4e0b\u8fd9\u4e2a\u7ed3\u8bba\uff1a\n\n\u8003\u8651\u7b2c\u4e00\u7ec4\u6837\u4f8b\uff1a\u67e5\u8be2 $3\\sim8$ \u7684\u7b54\u6848\u65f6\uff0c\u8003\u8651\u4e09\u4e2a\u62ec\u53f7 $(3\\sim4,5\\sim6,7\\sim8)$ \u9009\u8fd8\u662f\u4e0d\u9009\uff0c\u53d1\u73b0\u65e2\u4e0d\u80fd\u4e00\u4e2a\u90fd\u4e0d\u9009\uff0c\u4e5f\u4e0d\u80fd\u9009\u5206\u5f00\u7684\u51e0\u4e2a\u62ec\u53f7\uff0c\u6240\u4ee5\u6ee1\u8db3\u6761\u4ef6\u7684\u7b54\u6848\u662f $\\operatorname{C}_{3}^{2}+3$ \u7684\u503c\uff0c\u76f8\u5f53\u4e8e\u8003\u8651\u5de6\u53f3\u7aef\u70b9\u4e0d\u76f8\u540c\u7684\u52a0\u4e0a\u5de6\u53f3\u7aef\u70b9\u76f8\u540c\u7684\u3002\n\n\u53c8\u6ce8\u610f\u5230 $f[4]=1,f[6]=2,f[8]=3$\n\n\u6240\u4ee5 $\\sum_{i=3}^8f[i]=f[4]+f[6]+f[8]=1+2+3=\\dfrac{2\\times3}{2}+3=\\operatorname{C}_{3}^{2}+3$ \u5e76\u4e0d\u662f\u4e00\u4e2a\u5de7\u5408\u3002\n\n\u8003\u8651\u7b2c\u4e8c\u7ec4\u6837\u4f8b\uff1a\u67e5\u8be2 $1\\sim12$ \u7684\u7b54\u6848\uff0c\u8fd9\u597d\u50cf\u548c\u7b2c\u4e00\u7ec4\u6837\u4f8b\u6ca1\u4ec0\u4e48\u4e0d\u540c\uff0c\u4e0d\u8fc7\u662f\u51fa\u73b0\u4e86\u62ec\u53f7\u5d4c\u5957\u7684\u73b0\u8c61\uff0c\u4f46\u662f\u540c\u5c42\u4e4b\u95f4\u7684\u62ec\u53f7\u5339\u914d\u65f6\u5bf9\u66f4\u9ad8\u5c42\u7684\u62ec\u53f7\u5339\u914d\u5e76\u6ca1\u6709\u5173\u7cfb\uff0c\u4f8b\u5982\uff1a\u5bf9\u4e8e\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217 $2\\sim9$ \u548c\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217 $10\\sim11$ \u7684\u5339\u914d\u65f6\uff0c$2\\sim9$ \u5185\u90e8\u662f\u4e00\u5b9a\u5168\u90e8\u9009\u4e0a\u7684\uff0c\u6240\u4ee5\u7edf\u8ba1\u7684 $ans(2,9)$ \u5bf9\u4e8e\u8fd9\u91cc\u5e76\u6ca1\u6709\u8d21\u732e\uff0c\u540c\u7406 $2\\sim9$ \u5185\u90e8\u7684\u5339\u914d\u4e5f\u548c $10\\sim11$ \u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\uff0c\u6240\u4ee5\u4e0d\u540c\u5c42\u4e4b\u95f4\u7684\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u662f\u4e92\u4e0d\u5f71\u54cd\u7684\uff08\u66f4\u51c6\u786e\u7684\u8bf4\uff0c\u662f\u67d0\u4e00\u4e9b\u7236\u8282\u70b9\u76f8\u540c\u7684\u540c\u5c42\u8282\u70b9\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\uff09\uff0c\u6240\u4ee5\u8fd9\u4e5f\u662f\u5bf9\u7684\u3002\n\n\u7b2c\u4e09\u7ec4\u6837\u4f8b\u540c\u7406\uff0c\u56e0\u4e3a root \u8282\u70b9\u6ca1\u6709 $f$ \u503c\uff0c\u6240\u4ee5\u6ca1\u6709\u5f71\u54cd\uff0c\u6b63\u786e\u6027\u540c\u4e8c\u3002\n\n\u6240\u4ee5\u8fd9\u4e2a\u7ed3\u8bba\u8c8c\u4f3c\u662f\u5bf9\u7684\uff01 \n\n\u7136\u800c\u3002\u3002\u3002\u518d\u6765\u4e00\u7ec4\u6837\u4f8b\uff1a\n\n$ans(5,8)=3\\ne5=\\sum_{i=5}^8f[i]$\n\n\u6240\u4ee5\u8fd9\u4e2a\u7ed3\u8bba\u662f\u9519\u8bef\u7684~~\u4f46\u4e5f\u4e0d\u5b8c\u5168\u9519\u8bef~~\uff0c\u6211\u4eec\u6765\u627e\u4e00\u4e0b $ans(5,8)$ \u548c $ans(3,8)$ \u4e4b\u95f4\u7684\u533a\u522b\u3002\n\n\u53d1\u73b0\u4ed6\u4eec\u4e4b\u95f4\u7684\u533a\u522b\u662f $ans(3,8)$ \u7edf\u8ba1\u7684\u662f\u67d0\u4e00\u5c42\u540c\u7236\u4eb2\u7684**\u6240\u6709**\u5144\u5f1f\u8282\u70b9\uff0c\u800c $ans(5,8)$ \u5e76\u4e0d\u662f\uff0c\u8fd9\u4e2a\u65f6\u5019\u7684\u7b54\u6848\u5e94\u8be5\u662f $1+2=3$ \u800c\u4e0d\u662f $2+3=5$ \u6240\u4ee5\u8981\u8fdb\u884c\u53bb\u91cd\uff0c$ans(5,8)$ \u7edf\u8ba1\u7684\u8d77\u70b9\u5e94\u8be5\u662f $1$\uff0c\u800c\u4e0d\u662f $2$ \u8fd9\u610f\u5473\u7740\u6bcf\u4e2a\u6570\u90fd\u5c11\u4e86 $1$\uff0c\u6240\u4ee5\u8fd9\u79cd\u60c5\u51b5\u8981\u51cf\u53bb $f[l-1]\\times(f[r]-f[l-1])$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u4e86\u6700\u7ec8\u7684\u7b54\u6848\uff1a\n$$\nans(l,r)=\\sum_{i=l}^rf[i]-f[l-1]\\times(f[r]-f[l-1])\n$$\n\n\n\u7136\u540e\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u662f\u5bf9\u7684\u4e86\uff0c\u56e0\u4e3a\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e2a $g[l-1]=0$ \u4e5f\u5c31\u662f\u524d\u9762\u662f\u4e00\u4e2a\u5de6\u62ec\u53f7\uff0c$f[l-1]=0$ \u5bf9 $ans(l,r)$ \u6ca1\u6709\u5f71\u54cd\u3002\n\n\u53d1\u73b0\u524d\u9762\u6c42\u548c\u7684\u64cd\u4f5c\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u4f18\u5316\u5728 $\\Theta(1)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u8ba1\u7b97\u3002\n\n\u6240\u4ee5\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(n)$ \u9884\u5904\u7406\uff0c$\\Theta(1)$ \u56de\u7b54\u3002\n\n\u7136\u540e\u8003\u8651\u5bf9\u4e8e $S$ \u4e0d\u662f\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u8bc1\u660e\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6ca1\u6709\u88ab\u5339\u914d\u7684\u5b57\u7b26\u4e00\u5b9a\u4e0d\u5728 $T$ \u7684\u9009\u62e9\u8303\u56f4\u4e4b\u5185\uff0c\u6240\u4ee5\u76f4\u63a5\u5ffd\u7565\u6389\u8fd9\u4e9b\u5b57\u7b26\uff0c\u6b63\u5e38\u505a\u5c31\u53ef\u4ee5\u4e86\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int MAXN=3e5+1;\nint f[MAXN],s[MAXN];\nstack <int> st; //\u7528\u6765\u5339\u914d\u7684\u62ec\u53f7\u6808 \nsigned main() {\n\tios::sync_with_stdio(false),cin.tie(0),cout.tie(0);\n\tint n,q;\n\tcin>>n>>q;\n\tfor(register int i=1;i<=n;++i) {\n\t\tchar ch;\n\t\tcin>>ch;\n\t\tswitch(ch) {\n\t\t\tcase '(': {\n\t\t\t\tst.push(i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ')': {\n\t\t\t\tif(!st.empty()) {\n\t\t\t\t\tf[i]=f[st.top()-1]+1;\n\t\t\t\t\tst.pop();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\ts[i]=s[i-1]+f[i];\n\t}\n\twhile(q--) {\n\t\tint d,l,r;\n\t\tcin>>d>>l>>r;\n\t\tcout<<s[r]-s[l-1]-f[l-1]*(f[r]-f[l-1])<<'\\n';\n\t\t//\u5f0f\u5b50\u7684\u542b\u4e49\u9898\u89e3\u91cc\u5df2\u7ecf\u8bf4\u5f97\u5f88\u6e05\u695a\u4e86 \n\t}\n\treturn 0;\n}\n```",
        "postTime": 1643285455,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "CF1625E1\u9898\u89e3"
    },
    {
        "content": "\u521a\u521a\u5b66\u5b8c whk \u65f6\u65e0\u804a\u770b\u4e86\u4e0b\u63d0\u4ea4\u8bb0\u5f55\uff0c\u53d1\u73b0\u8fd9\u9053\u5bcc\u6709\u542f\u53d1\u610f\u4e49\u7684\u9898\u76ee\u3002\n\n\u9996\u5148\uff0c\u6ce8\u610f\u5230\u8fd9\u5b9e\u9645\u4e0a\u5c31\u662f\u4e2a\u5e8f\u5217\u7684 \u300a\u62ec\u53f7\u6811\u300b\uff0c\u62ff\u6765\u505a\u5c31\u884c\uff0c$f_i$ \u4e3a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u5408\u6cd5\u62ec\u53f7\u4e32\u6570\u91cf\uff0c$f_i=f_{L_i-1}+1$\uff0c\u7136\u540e\u518d\u505a\u4e00\u904d\u524d\u7f00\u548c\uff0c\u76f8\u51cf\u6c42\u51fa\u4ee5\u533a\u95f4 $[x,y]$ \u4e3a\u7ed3\u5c3e\u7684\u6570\u91cf\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u4f1a\u7b97\u91cd\uff0c\u5177\u4f53\u7684\uff0c\u7b97\u91cd\u4e86 $[1,x-1]$ \u53d6\u540e\u7f00\uff0c$[x,y]$ \u53d6\u524d\u7f00\u6240\u7ec4\u5408\u6210\u7684\u5408\u6cd5\u4e32\u6570\u91cf\u3002\n\n\u76ee\u524d\u9898\u76ee\u8fd8\u6709\u4e00\u4e2a\u6027\u8d28\u6ca1\u7528\u5230\uff0c\u5c31\u662f\u4fdd\u8bc1\u6bcf\u6b21\u8be2\u95ee $[x,y]$ \u5408\u6cd5\u3002\u90a3\u4e48\uff0c\u663e\u7136\u4e00\u5b9a\u662f\u4ee5 $x-1$ \u4e3a\u53f3\u7aef\u70b9\u7684\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u4e0e\u4ee5 $x$ \u4e3a\u5de6\u7aef\u70b9\u7684\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u7684\u7ec4\u5408\u3002\u56e0\u4e3a\u4e0d\u53ef\u80fd\u51fa\u73b0\u4e00\u4e2a\u5408\u6cd5\u7684\u7531\u8fd9 $2$ \u4e2a\u4e0d\u5408\u6cd5\u7684\u7ec4\u6210\u3002\u82e5\u6709\uff0c\u663e\u7136\u5b58\u5728\u4e00\u4e2a $p\\in [x,y]$ \u4e3a\u53f3\u62ec\u53f7\uff0c\u9700\u8981\u5339\u914d $q\\in [1,x-1]$\uff0c\u90a3\u4e48 $[x,y]$ \u4e0d\u5408\u6cd5\u3002\n\n\u9996\u5148 $f_{x-1}$ \u5373\u540e\u7f00\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\uff0c\u90a3\u4e48\u8fd8\u8981\u6709 $[x,y]$ \u7684\u524d\u7f00\u5408\u6cd5\u7136\u540e\u76f8\u4e58\u624d\u5bf9\uff0c\u4e8e\u662f\u6211\u4eec\u671f\u671b\u627e\u5230\u4e00\u4e2a\u80fd\u8868\u793a $[x,y]$ \u7684\u524d\u7f00\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u524d\u7f00\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\uff0c\u4e00\u5b9a\u662f $[x,p]$\uff0c\u90a3\u4e48\u56e0\u4e3a $[x,y]$ \u5408\u6cd5\uff0c\u663e\u7136 $[p+1,y]$ \u4e5f\u5408\u6cd5\u3002\n\n\u4e8e\u662f\uff0c\u6bcf\u4e2a\u524d\u7f00\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u90fd\u5b58\u5728\u552f\u4e00\u4e00\u4e2a\u4ee5 $y$ \u4e3a\u7ed3\u5c3e\uff0c\u5f00\u5934\u5728 $[x,y]$ \u7684\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u4e0e\u4e4b\u5bf9\u5e94\u3002\uff08\u53cc\u5c04\uff09\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u73b0\u5728\u671f\u671b\u901a\u8fc7 $f$ \u6c42\u540e\u8005\u3002\n\n\u53d1\u73b0\u5018\u82e5\u4ee5 $y$ \u4e3a\u53f3\u7aef\u70b9\uff0c\u4f46\u5de6\u7aef\u70b9\u5728 $[1,x-1]$ \u7684\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\uff0c\u5b83\u4e00\u5b9a\u53ef\u4ee5\u5212\u5206\u4e3a $s:[p,x-1]+[x,y]$\u3002\u5426\u5219\uff0c\u82e5\u5de6\u7aef\u70b9\u5728 $[x,y]$ \u5219\u4e00\u5b9a\u65e0\u6cd5\u5212\u5206\uff0c\u5373\u4e0d\u4f1a\u8ba1\u5165 $f_{x-1}$\uff0c\u4f46 $2$ \u90e8\u5206\u90fd\u4f1a\u8ba1\u5165 $f_y$\u3002\n\n\u7efc\u4e0a\uff0c\u51cf\u53bb $f_{x-1}\\cdot(f_y-f_{x-1})$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\nint rd() {\n\tint f=1,sum=0; char ch=getchar();\n\twhile(!isdigit(ch)) {if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)) {sum=(sum<<3)+(sum<<1)+ch-'0';ch=getchar();}\n\treturn sum*f;\n}\nconst int N=(int)(3e5+5);\nchar s[N];\nint n,m,f[N],st[N],sum[N],top;\nsigned main() {\n\tn=rd(); m=rd(); scanf(\"%s\",s+1);\n\tfor(int i=1;i<=n;i++) {\n\t\tif(s[i]=='(') st[++top]=i;\n\t\telse {\n\t\t\tif(!top) continue ;\n\t\t\tf[i]=f[st[top]-1]+1; --top;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) {\n\t\tsum[i]=sum[i-1]+f[i];\n//\t\tprintf(\"%d \",f[i]);\n\t}\n\twhile(m--) {\n\t\trd(); int x=rd(),y=rd();\n\t\tprintf(\"%lld\\n\",sum[y]-sum[x-1]-f[x-1]*(f[y]-f[x-1]));\n\t\t// [1,x-1]*[x,y] ,[x,y]=[y,x]\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1660819747,
        "uid": 297515,
        "name": "double_zero",
        "ccfLevel": 0,
        "title": "\u5bcc\u6709\u8fdc\u89c1\u7684"
    },
    {
        "content": "\u7531\u4e8e\u592a\u83dc\u4e86\u6240\u4ee5\u53ea\u80fd\u60f3\u5230\u5e26\u6839\u53f7\u7684\u505a\u6cd5\uff0c\u800c\u4e14\u662f\u79bb\u7ebf\u7684\u4e0d\u652f\u6301\u4fee\u6539\u3002\n\n\u6309\u7167\u53f3\u7aef\u70b9\u6392\u5e8f\u540e\u79bb\u7ebf\u4e0b\u6765\u3002\u6bcf\u6b21\u52a0\u5165\u4e00\u4e2a\u62ec\u53f7\u65f6\u90fd\u8981\u770b\u4e00\u4e0b\u662f\u5426\u6709\u914d\u5bf9\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5c31\u628a\u4e0e\u5b83\u5e76\u5217\u7684\u6240\u6709\u5de6\u7aef\u70b9\u90fd\u52a0\u4e0a $1$\uff0c\u8be2\u95ee\u5c31\u662f\u67e5\u8be2\u533a\u95f4\u5185\u6240\u6709\u5de6\u7aef\u70b9\u7684\u548c\u3002\n\n\u663e\u7136\u4e0d\u80fd\u771f\u66b4\u529b\u628a\u6240\u6709\u5e76\u5217\u7684\u5de6\u7aef\u70b9\u90fd\u4fee\u6539\uff0c\u56e0\u6b64\u8bbe\u4e00\u4e2a\u9608\u503c $B$\uff0c\u6bcf\u6b21\u53ea\u66b4\u529b\u4fee\u6539\u957f\u5ea6\u4e3a $B$ \u7684\u5757\u4ee5\u5185\u7684\uff0c\u6ee1\u4e00\u5757\u540e\u518d\u7ed9\u524d\u9762\u7684\u6240\u6709\u5e76\u5217\u7684\u5de6\u7aef\u70b9\u90fd\u52a0\u4e0a $B$\u3002\u8be2\u95ee\u7684\u65f6\u5019\u5c31\u8981\u989d\u5916\u52a0\u4e0a\u5f53\u524d\u5757\u5927\u5c0f\u4e58\u4e0a\u5757\u524d\u9762\u5e76\u5217\u7684\u6570\u91cf\u3002\n\n\u4e00\u4e2a\u70b9\u88ab\u4fee\u6539 $\\mathcal O\\left(\\dfrac nB\\right)$ \u6b21\uff0c\u53d6 $B=\\sqrt n$ \u5c31\u53ef\u4ee5\u505a\u5230\u603b\u4fee\u6539\u6b21\u6570\u4e3a $\\mathcal O(n\\sqrt n)$\uff0c\u91c7\u7528 $\\mathcal O(1)-\\mathcal O(\\sqrt n)$ \u7684\u5206\u5757\u5c31\u53ef\u4ee5\u505a\u5230\u603b\u590d\u6742\u5ea6 $\\mathcal O((n+q)\\sqrt n)$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#define ll long long\nusing namespace std;\nconst int N=300000,B=550;\nint n,q;\nchar s[N+5];\nint a[N+5],b[N/B+5];\nint id[N+5],L[N/B+5],R[N/B+5];\nint stk[N+5],top,pr[N+5],cnt[N+5];\nint lst[N+5],pre[N+5],ad[N+5];\nll ans[N+5];\nstruct qry{\n\tint l,r,id;\n}p[N+5];\nbool operator<(qry x,qry y){\n\treturn x.r<y.r;\n}\nvoid init(){\n\tfor(int i=1;i<=n;i+=1){\n\t\tid[i]=(i-1)/B+1;\n\t\tif(i%B==1) L[id[i]]=i;\n\t\tR[id[i]]=i;\n\t}\n\treturn;\n}\nvoid update(int x,int y){\n\ta[x]+=y; b[id[x]]+=y;\n\treturn;\n}\nll sum(int l,int r){\n\tll res=0;\n\tif(id[l]==id[r]){\n\t\tfor(int i=l;i<=r;i+=1) res+=1ll*a[i];\n\t\treturn res;\n\t}\n\tfor(int i=l;i<=R[id[l]];i+=1) res+=1ll*a[i];\n\tfor(int i=L[id[r]];i<=r;i+=1) res+=1ll*a[i];\n\tfor(int i=id[l]+1;i<id[r];i+=1) res+=1ll*b[i];\n\treturn res;\n}\nvoid insert(int x){\n\tif(s[x]=='('){\n\t\tstk[++top]=x;\n\t\treturn;\n\t}\n\tif(s[stk[top]]==')'||!top){\n\t\tstk[++top]=x;\n\t\treturn;\n\t}\n\tpr[x]=stk[top--];\n\tpr[pr[x]]=x;\n\tx=pr[x];\n\tlst[x]=pr[x-1];\n\tcnt[x]=cnt[lst[x]]+1;\n\tif(ad[lst[x]]) pre[x]=x;\n\telse pre[x]=pre[lst[x]];\n\tfor(int i=x;i;i=lst[i]){\n\t\tupdate(i,1);\n\t\tif(pre[i]==i) break;\n\t}\n\tif(cnt[x]-cnt[lst[pre[x]]]==B){\n\t\tad[x]=1;\n\t\tfor(int i=lst[pre[x]];i;i=lst[i]){\n\t\t\tupdate(i,B);\n\t\t}\n\t}\n\tif(pr[x]==x+1) return;\n\tx=pr[pr[x]-1];\n\tif(!ad[x]){\n\t\tint now=cnt[x]-cnt[lst[pre[x]]];\n\t\tfor(int i=lst[pre[x]];i;i=lst[i]){\n\t\t\tupdate(i,now);\n\t\t}\n\t}\n\treturn;\n}\nll query(int l,int r){\n\tll res=sum(l,r);\n\tif(pr[l]==r) return res;\n\tif(pre[pr[r]]==pre[l]) return res;\n\tif(ad[pr[r]]) return res;\n\tint cnt1=cnt[pr[r]]-cnt[lst[pre[pr[r]]]];\n\tint cnt2=cnt[lst[pre[pr[r]]]]-cnt[lst[l]];\n\tres+=1ll*cnt1*cnt2;\n\treturn res;\n}\nint main(){\n\tint t,l,r;\n\tscanf(\"%d%d\",&n,&q); init();\n\tscanf(\"%s\",s+1);\n\tfor(int i=1;i<=q;i+=1){\n\t\tscanf(\"%d%d%d\",&t,&l,&r);\n\t\tp[i].l=l; p[i].r=r; p[i].id=i;\n\t}\n\tsort(p+1,p+q+1);\n\tfor(int i=1,j=0;i<=n;i+=1){\n\t\tinsert(i);\n\t\twhile(p[j+1].r==i){\n\t\t\tl=p[++j].l; r=p[j].r;\n\t\t\tans[p[j].id]=query(l,r);\n\t\t}\n\t}\n\tfor(int i=1;i<=q;i+=1){\n\t\tprintf(\"%lld\\n\",ans[i]);\n\t}\n\treturn 0;\n}\n```\n\nThanks~",
        "postTime": 1663722671,
        "uid": 189682,
        "name": "QQ82272760",
        "ccfLevel": 7,
        "title": "CF1625E1 Cats on the Upgrade (easy version) \u9898\u89e3"
    },
    {
        "content": "~~\u5728\u6253\u6a21\u62df\u8d5b\u7684\u65f6\u5019\u5199\u9898\u89e3\u597d\u523a\u6fc0\u554a~~\n\n\u9996\u5148\u8003\u8651\u4e0d\u5305\u542b\u5d4c\u5957\u5173\u7cfb\u7684\u62ec\u53f7\u5e8f\u5217\u9009\u53d6\uff0c\u90a3\u8fd9\u4e2a\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u4ece\u4e00\u4e2a\u5e8f\u5217\u4e2d\u9009\u53d6\u4e00\u4e2a\u975e\u7a7a\u5b50\u6bb5\u7684\u65b9\u6848\u6570\uff0c\u4e3a ${ n+1 \\choose 2 }$ \u79cd\u3002\n\n\u8003\u8651\u6709\u5d4c\u5957\u5173\u7cfb\u7684\u62ec\u53f7\u5e8f\u5217\uff0c\u540c\u5c42\uff08\u5373\u4e92\u76f8\u6ca1\u6709\u5d4c\u5957\u5173\u7cfb\uff09\u7684\u62ec\u53f7\u6309\u7167\u4e0a\u9762\u6240\u8bf4\u7684\u65b9\u5f0f\u9009\u53d6\u3002\u82e5\u9009\u53d6\u4e00\u4e2a\u62ec\u53f7\uff0c\u5219\u88ab\u8fd9\u4e2a\u62ec\u53f7\u5305\u542b\u7684\u4e00\u6574\u6bb5\u62ec\u53f7\u5e8f\u5217\u5fc5\u987b\u5168\u90e8\u9009\u53d6\uff0c\u56e0\u6b64\u4e0d\u540c\u5c42\u7684\u62ec\u53f7\u4e4b\u95f4\u4e0d\u4e92\u76f8\u5f71\u54cd\uff0c\u53ef\u4ee5\u5206\u5f00\u8003\u8651\u3002\n\n\u8003\u8651\u5982\u4f55\u7edf\u8ba1\u6bcf\u4e00\u5c42\u7684\u8d21\u732e\u3002\u7528\u6808\u5339\u914d\u62ec\u53f7\uff0c\u89c2\u5bdf\u5230\u4e00\u4e2a\u53f3\u62ec\u53f7\u5bf9\u5e94\u7684\u5de6\u62ec\u53f7\uff0c\u8fd9\u4e2a\u5de6\u62ec\u53f7\u7684\u5de6\u8fb9\u8981\u4e48\u662f\u53f3\u62ec\u53f7\uff0c\u5373\u4e3a\u540c\u5c42\u62ec\u53f7\uff0c\u8981\u4e48\u662f\u5de6\u62ec\u53f7\uff0c\u5373\u4e3a\u5305\u542b\u81ea\u5df1\u7684\u62ec\u53f7\u3002\u56e0\u6b64\u6211\u4eec\u5728\u53f3\u62ec\u53f7\u7684\u4f4d\u7f6e\u4e0a\u8bb0 $f_i$ \u8868\u793a\u540c\u5c42\u7684\u62ec\u53f7\u4e2d\uff0c\u4ee5\u8fd9\u4e2a\u62ec\u53f7\u4e3a\u53f3\u7aef\u70b9\uff0c\u80fd\u9009\u53d6\u51e0\u6bb5\u975e\u7a7a\u5b50\u6bb5\u3002\u8bbe $i$ \u4f4d\u7f6e\u7684\u53f3\u62ec\u53f7\u5bf9\u5e94\u7684\u5de6\u62ec\u53f7\u7684\u4f4d\u7f6e\u4e3a $l_i$ \uff0c\u5219 $f_i=f_{l_i-1}+1$\u3002\u9009\u53d6\u8fd9\u4e00\u5c42\u62ec\u53f7\u7684\u603b\u8d21\u732e\u5373\u4e3a\u8fd9\u4e00\u5c42\u62ec\u53f7\u7684 $f_i$ \u4e4b\u548c\u3002\n\n\u8003\u8651\u8be2\u95ee\u3002\u8be2\u95ee\u7684\u533a\u95f4\u662f\u4e00\u6bb5\u5408\u6cd5\u62ec\u53f7\uff0c\u56e0\u6b64\u76f4\u63a5\u7edf\u8ba1 $f_i$ \u4e4b\u548c\u5373\u53ef\u3002\u8be2\u95ee\u533a\u95f4\u7684 $f_i$ \u4e4b\u548c\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u7528\u524d\u7f00\u548c\u6c42\u51fa\u6765\uff0c\u8fd9\u91cc\u6ce8\u610f\u4e00\u70b9\u7531\u4e8e\u8be2\u95ee\u533a\u95f4\u5185\u7684\u4e0d\u4e00\u5b9a\u662f\u540c\u5c42\u7684\u6240\u6709\u62ec\u53f7\uff0c\u56e0\u6b64\u8981\u51cf\u53bb $f_{l-1} \\times (r-l+1)$ \u3002\u81f3\u6b64\u9898\u76ee\u5706\u6ee1\u5b8c\u6210\u3002\n\n",
        "postTime": 1646376588,
        "uid": 124918,
        "name": "LinkyChristian",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011CF1625E1 Cats on the Upgrade (easy version)"
    }
]