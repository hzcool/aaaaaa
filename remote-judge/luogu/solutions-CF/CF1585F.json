[
    {
        "content": "\u4e09\u500d\u7ecf\u9a8c\uff1a[CF1591F](https://www.luogu.com.cn/problem/CF1591F)\uff0c[CF1585F](https://www.luogu.com.cn/problem/CF1585F)\uff08\u8fd9\u4e24\u9053 CF \u4e0a\u662f\u4e00\u6837\u7684\uff09\uff0c[ARC115E](https://atcoder.jp/contests/arc115/tasks/arc115_e)\uff08\u6570\u636e\u8303\u56f4\u52a0\u5927\uff09.\n\n\u4ee4\u6ee1\u8db3 $b_i=b_{i+1}$ \u7684\u70b9 $i$ \u4e3a U \u70b9\uff0c\u5219\u6211\u4eec\u5c31\u662f\u8981\u7b97\u6070\u6709 $0$ \u4e2a U \u70b9\u7684\u65b9\u6848 .\n\n\u8003\u8651\u5bb9\u65a5\uff0c\u4ee4 $f(k)$ \u4e3a\u81f3\u5c11 $k$ \u4e2a U \u70b9\u7684\u65b9\u6848\u6570\uff0c\u5219\u7b54\u6848\u4e3a\n$$ans=\\sum_{k=0}^n(-1)^kf(k)$$\n\n\u53d1\u73b0\u81f3\u5c11\u6709 $k$ \u4e2a U \u70b9\u7684\u4e00\u7ec4\u6ee1\u8db3\u6761\u4ef6\u7684 $\\{b\\}$ \u5fc5\u7136\u53ef\u4ee5\u88ab\u5206\u4e3a $n-k$ \u4e2a\u5185\u90e8\u5168\u90e8\u76f8\u7b49\u7684\u8fde\u7eed\u6bb5\uff0c\u56e0\u4e3a\u662f\u81f3\u5c11\u6240\u4ee5\u76f8\u90bb\u7684\u4e24\u6bb5\u7684\u6570\u4e0d\u4e00\u5b9a\u8981\u4e0d\u540c .\n\n\u4ee4 $dp_{i,j}$ \u4e3a $b_{1\\dots i}$ \u5206\u4e3a $j$ \u6bb5\u7684\u65b9\u6848\u6570\uff0c\u4e8e\u662f\u7b54\u6848\u5c31\u662f $(-1)^n(dp_{n,n}-dp_{n,n-1})$ .\n\n\u679a\u4e3e $i$ \u6240\u5728\u7684\u4e00\u6bb5\u7684\u5de6\u7aef\u70b9 $k$\uff0c\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\n$$dp_{i,j}=\\sum_{k=1}^jdp_{k-1,j-1}\\min_{k\\in[k,i]}\\{a_k\\}$$\n\u56e0\u4e3a $dp_{\\dots,j}$ \u53ea\u548c $dp_{\\dots,j-1}$ \u6709\u5173\uff0c\u6240\u4ee5\u53ef\u4ee5\u6eda\u52a8\u6570\u7ec4\uff0c\u540c\u65f6\u6bcf\u6b21 min \u7684\u533a\u95f4\u603b\u4e0d\u53d8\u5c0f\uff0c\u6240\u4ee5\u5355\u8c03\u6808\u7ef4\u62a4\u4e00\u4e0b\u5373\u53ef .\n\n\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $O(n)$ .\n\nCF Submission: [168961015](https://codeforces.com/contest/1585/submission/168961015) .",
        "postTime": 1660911609,
        "uid": 227514,
        "name": "jijidawang",
        "ccfLevel": 0,
        "title": "CF1585F"
    },
    {
        "content": "\u8bbe $f(i,j)$ \u8868\u793a\u8003\u8651\u524d $i$ \u4e2a\u6570\uff0c\u5f53\u524d $b_i=j$ \u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u663e\u7136\u6709\uff1a\n\n$$\nf(i,j)=\\begin{cases}0, &j>a_i\\\\(\\sum_{x=1}^{a_{i-1}}f(i-1,x))-f(i-1,j), &j\\le a_i\\end{cases}\n$$\n\n\u628a $f(i)$ \u770b\u4f5c\u5e8f\u5217\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002\u9700\u8981\u652f\u6301\u533a\u95f4\u63a8\u5e73\uff08$j>a_i$ \u7684\u60c5\u51b5\uff09\uff0c\u533a\u95f4\u53d6\u53cd\uff08$f(i,j)\\gets -f(i-1,j)$\uff09\uff0c\u533a\u95f4\u52a0\uff08$f(i,j)\\gets -f(i-1,j)+\\sum_{x=1}^{a_{i-1}}f(i-1,x)$\uff09\uff0c\u533a\u95f4\u67e5\u8be2\uff08\u67e5\u8be2 $\\sum_{x=1}^{a_{i-1}}f(i-1,x)$\uff09\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int> pii;\ntypedef vector<int> vi;\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\ninline int read()\n{\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n\treturn x*f;\n}\nvoid write(int n)\n{\n\tif(n<0){putchar('-');n=-n;}\n\tif(n>9)write(n/10);\n\tputchar(n%10^48);\n}\nconst int N=2e5+10,mod=998244353;\nint a[N],b[N];\nvoid f(int &x){x=(x%mod+mod)%mod;}\nstruct sgt{\n\tstruct seg{\n\t\tint l,r,sum;\n\t\tint cov,add,neg;\n\t\t//cover, add, negative\n\t\tseg(){l=r=sum=add=cov=neg=0;}\n\t}t[N<<2];\n\t//cov -> neg  -> add\n\tvoid build(int p,int l,int r)\n\t{\n\t\tt[p].l=l,t[p].r=r;\n\t\tif(l==r)return;\n\t\tint mid=(l+r)>>1;\n\t\tbuild(p*2,l,mid),build(p*2+1,mid+1,r);\n\t}\n\tvoid pd(int p)\n\t{\n\t\tif(t[p].cov)\n\t\t{\n\t\t\tt[p*2].cov=t[p*2+1].cov=t[p].cov,t[p].cov=0;\n\t\t\tt[p*2].neg=t[p*2+1].neg=0;\n\t\t\tt[p*2].add=t[p*2+1].add=0;\n\t\t\tt[p*2].sum=0;\n\t\t\tt[p*2+1].sum=0;\n\t\t}\n\t\tif(t[p].neg)\n\t\t{\n\t\t\tt[p*2].neg^=1,t[p*2+1].neg^=1;\n\t\t\tt[p*2].add*=-1,t[p*2+1].add*=-1;\n\t\t\tf(t[p*2].add),f(t[p*2+1].add);\n\t\t\tt[p*2].sum*=-1,t[p*2+1].sum*=-1;\n\t\t\tf(t[p*2].sum),f(t[p*2+1].sum);\n\t\t\tt[p].neg=0;\n\t\t}\n\t\tif(t[p].add)\n\t\t{\n\t\t\tt[p*2].add+=t[p].add,t[p*2].add%=mod;\n\t\t\tt[p*2].sum+=1ll*(b[t[p*2].r]-b[t[p*2].l-1])*t[p].add%mod,t[p*2].sum%=mod;\n\t\t\tt[p*2+1].add+=t[p].add,t[p*2+1].add%=mod;\n\t\t\tt[p*2+1].sum+=1ll*(b[t[p*2+1].r]-b[t[p*2+1].l-1])*t[p].add%mod,t[p*2+1].sum%=mod;\n\t\t\tt[p].add=0;\n\t\t}\n\t}\n\tvoid modify(int p,int l,int r,int d)//add\n\t{\n\t\tif(l>r)return;\n\t\tif(l<=t[p].l&&t[p].r<=r)\n\t\t{\n\t\t\tt[p].sum+=1ll*(b[t[p].r]-b[t[p].l-1])*d%mod,t[p].sum%=mod;\n\t\t\tt[p].add+=d,t[p].add%=mod;\n\t\t\treturn;\n\t\t}\n\t\tpd(p);int mid=(t[p].l+t[p].r)>>1;\n\t\tif(l<=mid)modify(p*2,l,r,d);\n\t\tif(r>mid)modify(p*2+1,l,r,d);\n\t\tt[p].sum=t[p*2].sum+t[p*2+1].sum;\n\t\tt[p].sum%=mod;\n\t}\n\tvoid cover(int p,int l,int r)\n\t{\n\t\tif(l>r)return;\n\t\tif(l<=t[p].l&&t[p].r<=r)\n\t\t{\n\t\t\tt[p].cov=1;\n\t\t\tt[p].add=t[p].sum=t[p].neg=0;\n\t\t\treturn;\n\t\t}\n\t\tpd(p);int mid=(t[p].l+t[p].r)>>1;\n\t\tif(l<=mid)cover(p*2,l,r);\n\t\tif(r>mid)cover(p*2+1,l,r);\n\t\tt[p].sum=t[p*2].sum+t[p*2+1].sum;\n\t\tt[p].sum%=mod;\n\t}\n\tvoid modify1(int p,int l,int r)\n\t{\n\t\tif(l>r)return;\n\t\tif(l<=t[p].l&&t[p].r<=r)\n\t\t{\n\t\t\tt[p].neg^=1;\n\t\t\tt[p].sum*=-1,t[p].add*=-1;\n\t\t\tf(t[p].sum);\n\t\t\tf(t[p].add);\n\t\t\treturn;\n\t\t}\n\t\tpd(p);int mid=(t[p].l+t[p].r)>>1;\n\t\tif(l<=mid)modify1(p*2,l,r);\n\t\tif(r>mid)modify1(p*2+1,l,r);\n\t\tt[p].sum=t[p*2].sum+t[p*2+1].sum;\n\t\tt[p].sum%=mod; \n\t}\n\tint query(int p,int l,int r)\n\t{\n\t\tif(l>r)return 0;\n\t\tif(l<=t[p].l&&t[p].r<=r)return t[p].sum;\n\t\tpd(p);int mid=(t[p].l+t[p].r)>>1,ans=0;\n\t\tif(l<=mid)ans+=query(p*2,l,r),ans%=mod;\n\t\tif(r>mid)ans+=query(p*2+1,l,r),ans%=mod;\n\t\treturn ans;\n\t}\n}T;\nint main()\n{\n\tint n=read(),c=n;\n\tfor(int i=1;i<=n;i++)a[i]=b[i]=read();\n\tsort(b+1,b+c+1),c=unique(b+1,b+c+1)-b-1;\n\tfor(int i=1;i<=n;i++)a[i]=lower_bound(b+1,b+c+1,a[i])-b;\n//\tfor(int i=1;i<=n;i++)printf(\"%d \",a[i]);puts(\"!!!\"); \n\tT.build(1,1,c);\n\tfor(int i=1;i<=a[1];i++)T.modify(1,i,i,1);\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint sum=T.query(1,1,c);\n//\t\tprintf(\"sum=%d\\n\",sum);\n\t\tT.cover(1,a[i]+1,c);\n//\t\tprintf(\"sum=%d\\n\",T.query(1,1,c));\n\t\tT.modify1(1,1,a[i]);\n//\t\tprintf(\"sum=%d\\n\",T.query(1,1,c));\n\t\tT.modify(1,1,a[i],sum);\n//\t\tprintf(\"sum=%d\\n\",T.query(1,1,c));\n\t}\n\tint ans=0;\n\tfor(int i=1;i<=a[n];i++)ans+=T.query(1,i,i),ans%=mod;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n//zzt qwq\n```",
        "postTime": 1643095067,
        "uid": 125913,
        "name": "zztqwq",
        "ccfLevel": 8,
        "title": "CF1585F Non-equal Neighbours"
    },
    {
        "content": "\u5bb9\u65a5 DP \u795e\u4ed9\u9898 qwq\u3002\n\n\u8003\u8651\u5bb9\u65a5\uff0c\u94a6\u5b9a $k$ \u4e2a $i$ \u6ee1\u8db3 $b_i = b_{i + 1}, \\, (1 \\le i < n)$\uff0c\u8bb0\u5176\u65b9\u6848\u6570\u4e3a $F(k)$\u3002\n\n\u8fd9\u6837\uff0c\u7b54\u6848\u5373\u4e3a\uff1a\n$$\nans = \\sum_{k = 0}^{n - 1} (-1) ^ k F(k)\n$$\n\u9996\u5148\u6709\u4e00\u4e2a\u8f6c\u5316\uff0c\u94a6\u5b9a $k$ \u4e2a $i$ \u6ee1\u8db3 $b_i = b_{i + 1}, \\, (1 \\le i < n)$\uff0c\u76f8\u5f53\u4e8e\u628a $b$ \u6570\u7ec4 `unique` \u540e\u5269\u4e0b\u6700\u591a $n - k$ \u4e2a\u5143\u7d20\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u6027\u8d28\uff0c\u4e0d\u96be\u5f97\u5230\u4e00\u4e2a $O(n ^ 3)$ \u7684\u6734\u7d20\u505a\u6cd5\u3002\u8bbe $f_{i, j}$ \u8868\u793a\u8003\u8651\u524d $i$ \u4e2a\u4f4d\u7f6e\uff0c\u5212\u5206\u6210 $j$ \u6bb5\u7684\u65b9\u6848\u6570\u3002\n\nDP \u8f6c\u79fb\u4e3a\uff1a$f_{i, j} = \\sum\\limits_{k = 1}^{i - 1} f_{k, j - 1} \\times \\min\\limits_{l = k + 1}^{i} a_l$\u3002\n\n\u4f46\u8fd9\u6837\u590d\u6742\u5ea6\u7206\u70b8\uff0c\u600e\u4e48\u529e\u5462\uff1f\u89c2\u5bdf\u8f6c\u79fb\u65b9\u7a0b\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff1a\u7b2c\u4e8c\u7ef4\u4e0b\u6807\u4e3a $j$ \u7684\u6240\u6709\u72b6\u6001\u53ea\u4f1a\u7531\u4e0b\u6807\u4e3a $j - 1$ \u7684\u72b6\u6001\u8f6c\u79fb\u5f97\u5230\u3002\u800c\u6211\u4eec\u6700\u540e\u7edf\u8ba1\u7b54\u6848\u65f6\uff0c\u4e5f\u53ea\u5173\u5fc3 $k$ \u7684\u5947\u5076\u6027\u6765\u51b3\u5b9a\u5bb9\u65a5\u7cfb\u6570\u3002\u4e8e\u662f\u53ef\u4ee5\u91cd\u65b0\u8bbe\u8ba1\u72b6\u6001 $f_{i, 0 / 1}$ \u8868\u793a\u8003\u8651\u524d $i$ \u4e2a\u4f4d\u7f6e\uff0c\u5212\u5206\u6210 \u5076\u6570 / \u5947\u6570 \u6bb5\u7684\u65b9\u6848\u6570\u3002\n\n\u65b0\u7684\u8f6c\u79fb\u4e3a\uff1a$f_{i, j} = \\sum\\limits_{k = 1}^{i - 1} f_{k, j \\oplus  1} \\times \\min\\limits_{l = k + 1}^{i} a_l$\uff0c\u5176\u4e2d $\\oplus$ \u4e3a\u5f02\u6216\u8fd0\u7b97\u7b26\u3002\n\n\u53ef\u8fd9\u6837\u8fd8\u662f $O(n^2)$ \u7684\u3002\u67ff\u5b50\u524d\u9762\u662f\u4e00\u4e2a\u524d\u7f00\u548c\u5f62\u5f0f\uff0c\u4e0d\u597d\u4f18\u5316\u7684\u662f\u540e\u9762 $\\min$ \u7684\u90e8\u5206\u3002\n\n\u82e5 $a_i = \\min\\limits_{j = 1}^{i} a_j$\uff0c\u8f6c\u79fb\u663e\u7136\u6709\uff1a\n$$\nf_{i, j} = \\sum\\limits_{k = 1}^{i - 1} f_{k, j \\oplus  1} \\times a_i\n$$\n\u5426\u5219\uff0c\u8bbe $a_i$ \u524d\u9762\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5c0f\u7684\u4f4d\u7f6e\u4e3a $p$\uff08\u53ef\u4ee5\u5355\u8c03\u6808\u6c42\u51fa\uff09\u3002\u6211\u4eec\u6309\u7167 $k$ \u4e0e $p$ \u7684\u5173\u7cfb\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $k \\in [1, p - 1]$\uff0c\u8fd9\u90e8\u5206 $f_{k, j \\oplus  1} \\times \\min\\limits_{l = k + 1}^{i} a_l$ \u7684\u8d21\u732e\u4e0e $a_{p + 1 \\dots i}$ \u65e0\u5173\uff0c\u53ef\u4ee5\u91cd\u65b0\u5199\u6210 $f_{k, j \\oplus  1} \\times \\min\\limits_{l = k + 1}^{p} a_l$\u3002\u53d1\u73b0 $\\sum\\limits_{k = 1}^{p - 1} f_{k, j \\oplus  1} \\times \\min\\limits_{l = k + 1}^{p} a_l$ \u7684\u503c\u5c31\u662f $f_{p, j}$\uff0c\u4e8e\u662f\u76f4\u63a5\u7ee7\u627f DP \u503c\u5373\u53ef\u3002\n2. $k \\in [p, i - 1]$\uff0c\u8fd9\u90e8\u5206\u4fdd\u8bc1\u4e86 $\\min\\limits_{l = k + 1}^{i} a_l = a_i$\uff0c\u53ef\u4ee5\u8f6c\u5316\u4e3a $f_{i, j} = \\sum\\limits_{k = p}^{i - 1} f_{k, j \\oplus  1} \\times a_i$\u3002\n\n\u7efc\u4e0a\u6709\uff1a\n$$\nf_{i, j} = f_{p, j} + \\sum\\limits_{k = p}^{i - 1} f_{k, j \\oplus  1} \\times a_i\n$$\n\u7528\u524d\u7f00\u548c\u4f18\u5316\u5373\u53ef\u505a\u5230 $O(1)$ \u8f6c\u79fb\u3002\n\n\u6700\u540e\uff0c\u82e5 $n$ \u4e3a\u5076\u6570\uff0c$n - k$ \u7684\u5947\u5076\u6027\u540c $k$ \u7684\u5947\u5076\u6027\uff0c\u7b54\u6848\u4e3a $f_{n, 0} - f_{n, 1}$\u3002\u53cd\u4e4b\u4e3a $f_{n, 1} - f_{n, 0}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n**Code**\n\n```cpp\n#include <cstdio>\n#include <stack>\ntypedef long long ll;\nconst int n_max = 2e5 + 5;\nconst ll mod = 998244353;\nint a[n_max], n;\nll f[n_max][2], g[n_max][2];\nstd::stack<int> stk;\nint main() {\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; ++i)\n\t\tscanf(\"%d\", &a[i]);\n\tf[0][0] = g[0][0] = 1ll;\n\tfor (int i = 1; i <= n; ++i) {\n\t\twhile (!stk.empty() && a[stk.top()] >= a[i])\n\t\t\tstk.pop();\n\t\tif (stk.empty()) {\n\t\t\tfor (int j : {0, 1})\n\t\t\t\tf[i][j] = g[i - 1][j ^ 1] * a[i] % mod;\n\t\t} else {\n\t\t\tfor (int j : {0, 1})\n\t\t\t\tf[i][j] = (f[stk.top()][j] + (g[i - 1][j ^ 1] - g[stk.top() - 1][j ^ 1]) * a[i] % mod) % mod;\n\t\t}\n\t\tfor (int j : {0, 1})\n\t\t\tg[i][j] = (g[i - 1][j] + f[i][j]) % mod;\n\t\tstk.push(i);\n\t}\n\tint sgn = (n & 1) ? -1 : 1;\n\tprintf(\"%lld\\n\", ((f[n][0] - f[n][1]) * sgn % mod + mod) % mod);\n\treturn 0;\n}\n```",
        "postTime": 1669282938,
        "uid": 482605,
        "name": "_Cx330",
        "ccfLevel": 6,
        "title": "CF1585F Non-equal Neighbours \u9898\u89e3"
    }
]