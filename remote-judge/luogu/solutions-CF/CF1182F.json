[
    {
        "content": "[\u70b9\u8fd9\u91cc\u6709\u60ca\u559c](https://www.cnblogs.com/AThousandMoons/p/11108875.html)\n\n\uff08\u6ed1\u7a3d\uff09\n\n\u7b2c\u4e00\u9053\u7c7b\u6b27\u7684\u4e0d\u662f\u6a21\u677f\u7684\u9898\uff1f\uff1f\n\n\u5176\u5b9e\u5c31\u662f\u6c42\u6574\u6570$x\\in [a,b]$\u4f7f\u5f97$|2px \\ mod \\ 2q-q|$\u6700\u5c0f\u3002\n\n\u9996\u5148\u4e00\u770b\u5c31\u5c1d\u8bd5\u4e00\u4e0b\u4e8c\u5206\uff0c\u5982\u4f55\u5224\u65ad$2px \\ mod \\ 2q \\in [l,r]$\u5462\uff1f\u6211\u4eec\u53d1\u73b0\n\n$$[2px \\ mod \\ 2q \\in [l,r]]=\\lfloor\\frac{2px-l}{2q}\\rfloor-\\lfloor\\frac{2px-r-1}{2q}\\rfloor$$\n\n\u6240\u4ee5\u5b58\u5728$x\\in [a,b]$\u4f7f\u5f97$2px \\ mod \\ 2q \\in [l,r]$\uff0c\u53ea\u9700\u8981\u5224\u65ad$\\sum_{x=a}^b(\\lfloor\\frac{2px-l}{2q}\\rfloor-\\lfloor\\frac{2px-r-1}{2q}\\rfloor)$\u662f\u5426\u5927\u4e8e0\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u4e2a\u4f7f\u7528\u7c7b\u6b27\u8ba1\u7b97\u3002\n\n\u627e\u5230\u6700\u5c0f\u7684\u504f\u5dee\u503c$l$\u4e4b\u540e\u53ef\u4ee5\u4f7f\u7528\u6269\u6b27\u89e3\u540c\u4f59\u65b9\u7a0b\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O(\\log^2 n)$\u3002\n```cpp\n#include<bits/stdc++.h>\n#define Rint register int\nusing namespace std;\ntypedef long long LL;\nLL t, a, b, p, q, len;\ninline LL calc(LL a, LL b, LL c, LL n){\n\tif(!a || !n) return (n + 1) * (b / c);\n\tif(n < 0) return 0;\n\tLL m = (a * n + b) / c;\n\tif(a >= c || b >= c) return calc(a % c, b % c, c, n) + (n * (n + 1) >> 1) * (a / c) + (n + 1) * (b / c);\n\treturn m * n - calc(c, c - b - 1, a, m - 1);\n}\ninline LL exgcd(LL a, LL b, LL &x, LL &y){\n\tif(!b){x = 1; y = 0; return a;}\n\tLL gcd = exgcd(b, a % b, y, x);\n\ty -= a / b * x;\n\treturn gcd;\n}\nint main(){\n\tscanf(\"%lld\", &t);\n\twhile(t --){\n\t\tscanf(\"%lld%lld%lld%lld\", &a, &b, &p, &q);\n\t\tLL l = 0, r = q, mid, P = p << 1, Q = q << 1;\n\t\twhile(l < r){\n\t\t\tmid = l + r >> 1;\n\t\t\tLL L = q - mid, R = q + mid + 1;\n\t\t\tif(calc(P, Q - L, Q, b) + calc(P, Q - R, Q, a - 1) - calc(P, Q - L, Q, a - 1) - calc(P, Q - R, Q, b) > 0) r = mid;\n\t\t\telse l = mid + 1;\n\t\t}\n\t\tLL x, y, gcd = exgcd(P, Q, x, y), ans = 1e9; P /= gcd; Q /= gcd;\n\t\tif((q - l) % gcd == 0){\n\t\t\tLL xx = (q - l) / gcd * x; xx += (a - xx) / Q * Q;\n\t\t\twhile(xx >= a) xx -= Q; while(xx < a) xx += Q;\n\t\t\tans = min(ans, xx);\n\t\t}\n\t\tif((q + l) % gcd == 0){\n\t\t\tLL xx = (q + l) / gcd * x; xx += (a - xx) / Q * Q;\n\t\t\twhile(xx >= a) xx -= Q; while(xx < a) xx += Q;\n\t\t\tans = min(ans, xx);\n\t\t}\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n}\n```\n\u540e\u6765\u770b\u4e86\u4e00\u6ce2\u5b98\u65b9\u9898\u89e3\uff0c\u7ed3\u679c\u53d1\u73b0\u662f\u4e00\u4e2a\u7c7b\u4f3cBSGS\u7684\u5206\u5757\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(\\sqrt{n})$\u3002\uff08\u5199\u5f97\u4e0d\u597d\u8fd8\u8981\u5e26\u4e00\u4e2alog...\uff09\n\n\uff08\u8fd8\u662f\u4e0a\u9762\u90a3\u4e2a\u65b9\u6cd5\u66f4\u597d\u4e00\u4e9b\uff09\n\n~~\uff08\u6700\u4e3b\u8981\u662f\u770b\u8d77\u6765\u66f4\u9ad8\u5927\u4e0a\u4e00\u70b9\u3002\u3002\u3002\uff09~~",
        "postTime": 1561861436,
        "uid": 68148,
        "name": "watermoon",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1182F \u3010Maximum Sine\u3011"
    },
    {
        "content": "$$\\text{\u6c42 } [a,b] \\text{ \u4e2d\u4f7f\u5f97 } f(x)=\\left|\\sin\\left(\\frac{p}{q}x\\pi\\right)\\right| \\text{\u6700\u5927\u7684\u6574\u6570 }x$$\n\n---\n\n$\\sin(x)$ \u7684**\u6700\u503c**\u5728 $\\left(k+\\dfrac{1}{2}\\right)\\pi, k\\in\\mathbb{Z}$ \u5904\u53d6\u5230\u3002\n\n\u65e2\u7136\u5982\u6b64\uff0c\u6211\u4eec\u4fbf\u8981\u8ba9 $px/q$ \u6700\u63a5\u8fd1\u4e8e\u4e00\u4e2a\u6574\u6570\u52a0\u4e0a\u4e8c\u5206\u4e4b\u4e00\u3002\u4e0d\u4e25\u8c28\u5730\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u8ba9\uff1a\n\n$$\n\\begin{aligned}\n\\frac{px}{q} &\\approx k+\\frac{1}{2} \\\\\n&\\Downarrow \\\\\n\\frac{2px}{q} &\\approx 2k+1 \\\\\n&\\Downarrow \\\\\n\\frac{2px+q}{q} &\\approx 2k \\\\\n&\\Downarrow \\\\\n\\frac{2px+q}{2q} &\\approx k \\\\\n\\end{aligned}\n$$\n\n\u53e6\u5916\uff0c\u5982\u679c\u5206\u6570 $\\dfrac{p}{q}$ \u8d8a\u63a5\u8fd1\u4e00\u4e2a\u6574\u6570\uff0c\u5219 $p  \\bmod q$ \u7684\u503c\u5219\u8d8a\u63a5\u8fd1\u4e8e $0$ \u6216 $q$\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u6240\u6c42\u4fbf\u662f\u4f7f\uff1a\n\n$$g(x)=(2px+q)\\bmod 2q\\quad (x\\in[a,b])$$\n\n\u6700\u5c0f/\u6700\u5927\u7684 $x$ \u503c\u3002\n\n---\n\n\u6211\u4eec\u4e0d\u59a8\u5148\u601d\u8003\u4e00\u4e2a\u66f4\u4e00\u822c\u7684\u95ee\u9898\u3002\u6c42\uff1a\n\n$$\\min\\{(Ax+B)\\bmod C\\}\\quad x\\in[l,r]$$\n\n\u53ef\u4ee5\u5229\u7528\u5206\u5757\uff08\u6216BSGS\uff09\u7684\u601d\u60f3\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a\n\n1. \u5148\u5c06\u533a\u95f4 $[l,r]$ \u5206\u4e3a\u957f\u5ea6\u4e3a $T=\\sqrt{r-l+1}$ \u7684\u82e5\u5e72\u5757\u3002\n\n2. \u9884\u5904\u7406\u51fa\u5f53 $x\\in[0,T)$ \u65f6\uff0c\u6240\u6709 $Ax\\bmod C$ \u7684\u503c\uff08\u5e76\u6392\u5e8f\uff09\uff0c\u8fd9\u4e9b\u76f8\u5f53\u4e8e\u6211\u4eec\u7684 baby step\u3002\n\n3. \u63a5\u7740\u5f00\u59cb\u4ee5 $T$ \u4e3a\u6b65\u957f\uff0c\u5f00\u59cb\u8fc8\u5927\u6b65\u3002\u5f62\u5f0f\u5316\u5730\uff0c\u65e2\u7136\u6bcf\u4e2a $x$ \u90fd\u53ef\u4ee5\u8868\u793a\u6210 $mT+n\\;(n\\in[0,T))$ \u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5 $l,l+T,l+2T,\\cdots,r-T$ \u7684\u987a\u5e8f\u679a\u4e3e $x$ \u7684\u5927\u5757\u90e8\u5206\u3002\u8bbe\u5f53\u524d\u679a\u4e3e\u5230\u7684\u503c\u4e3a $i$\uff0c\u5219\u539f\u95ee\u9898\u53d8\u4e3a\u6c42 $(Ai+An+B)\\bmod C\\;(n\\in[0,T))$ \u6700\u5c0f\u7684 $n$\u3002\n\n4. \u5c06\u4e0a\u8ff0\u95ee\u9898\u79fb\u9879\uff0c\u5373\u662f\u6c42\u4f7f\u5f97 $An\\bmod C$ \u6070\u597d\u5927\u4e8e $C-((Ai+B)\\bmod C)$ \u7684\u6700\u5c0f\u7684 $n$\u3002\u7531\u4e8e\u6211\u4eec\u7b2c\u4e00\u6b65\u5df2\u7ecf\u9884\u5904\u7406\u51fa\u4e86\u6240\u6709 $An \\bmod C$ \u5e76\u6392\u597d\u4e86\u5e8f\uff0c\u53ea\u9700\u8981\u4e8c\u5206\u51fa $n$ \u7684\u4f4d\u7f6e\u5e76\u66f4\u65b0\u7b54\u6848\u5373\u53ef\u3002\n\n\u6c42 $\\max$ \u7684\u505a\u6cd5\u662f\u4e00\u6837\u7684\uff0c\u987a\u5e26\u7740\u66f4\u65b0\u4e00\u4e0b\u5373\u53ef\u3002\n\n---\n\n\u597d\u4e86\uff0c\u65e2\u7136\u6211\u4eec\u5df2\u7ecf\u6c42\u5f97\u4f7f\n\n$$g(x)=(2px+q)\\bmod 2q\\quad (x\\in[a,b])$$\n\n\u6700\u5c0f\u7684\u6574\u6570 $x_1$ \u548c\u4f7f\u5b83\u6700\u5927\u7684\u6574\u6570 $x_2$ \u4e86\uff0c\u90a3\u4e48\u8be5\u9009\u62e9\u54ea\u4e2a\u8f93\u51fa\u5462\uff1f\u6211\u4eec\u53ea\u9700\u8981\u6bd4\u8f83 $g(x_1)$ \u4e0e $2q-g(x_2)$ \u7684\u5927\u5c0f\uff0c\u54ea\u4e2a\u66f4\u5c0f\uff0c\u8bf4\u660e\u54ea\u4e2a $x$ \u503c\u8ba9 $\\dfrac{2px+q}{2q}$ \u66f4\u63a5\u8fd1\u6574\u6570\uff0c\u4e8e\u662f\u5c31\u8f93\u51fa\u54ea\u4e2a $x$ \u503c\u3002\u4e24\u8005\u76f8\u540c\u4fbf\u8f93\u51fa\u8f83\u5c0f\u7684 $x$\u3002\n\n>\u6700\u540e\u63d0\u4e00\u4e2a\u5c0f\u7ec6\u8282\uff0c$f(x)$ \u80af\u5b9a\u662f\u4f1a\u5faa\u73af\u7684\uff0c\u5faa\u73af\u8282\u662f $d=\\dfrac{\\text{lcm}(2p,2q)}{2p}=\\dfrac{q}{\\gcd(p,q)}$\u3002\u4e8e\u662f\uff0c\u5f53\u6211\u4eec\u53d1\u73b0\u6c42\u51fa\u7684 $x-l\\ge d$ \u65f6\uff0c\u8bf4\u660e\u6211\u4eec\u8df3\u8fc7\u4e86\u81f3\u5c11\u4e00\u4e2a\u5faa\u73af\u8282\uff0c\u524d\u9762\u8fd8\u6709 $x$ \u66f4\u5c0f\u7684\u89e3\u3002\n\u4ee4 $x=l+(x-l)\\bmod d$ \u5373\u53ef\u3002\n\n---\n\n```cpp\n#include<bits/stdc++.h>\n#define update {\\\n    now = (bbs[idx].mod + i * A + B) % C;\\\n    if(now < minn) minn = now, ans1 = i + bbs[idx].x;\\\n    if(now > maxx) maxx = now, ans2 = i + bbs[idx].x;\\\n}\n#define int long long\nusing namespace std;\n \nint _, a, b, p, q;\nstruct babystep{\n    int x, mod;\n    bool operator < (const babystep &tmp) const{\n        return mod < tmp.mod || (mod == tmp.mod && x < tmp.x);\n    }\n}bbs[50000];\n\nint solve(int A, int B, int C, int l, int r){\n    int t = sqrt(r - l + 1), ans1, ans2, minn = 2e15, maxx = -1;\n    for(int i = 0; i < t; i++) bbs[i] = (babystep){i, i * A % C};\n    sort(bbs, bbs + t);\n    for(int i = l; i <= r - t; i += t){\n        int idx = lower_bound(bbs, bbs + t, (babystep){0, C - (i * A + B) % C}) - bbs, now;\n        if(idx >= t) idx--; update\n        if(idx) idx--;      update\n        idx = (idx + 2) % t;update // \u4e8c\u5206\u5230\u9644\u8fd1\u7684\u503c\u90fd\u8bd5\u4e00\u4e0b\n    }\n    int idx = 49999, now, tmp = q / __gcd(p, q);\n    for(int i = r; i >= max(l, r - t * 2); i--) update  // \u6700\u540e\u4e24\u4e2a\u5757\u66b4\u529b\u66f4\u65b0\n    ans1 = l + (ans1 - l) % tmp, ans2 = l + (ans2 - l) % tmp;\n    return ((minn < C - maxx || (minn == C - maxx && ans1 < ans2)) ? ans1 : ans2);\n}\n \nsigned main(){\n    for(cin >> _; _; _--){\n        // min/max{(2px + q) mod 2q}    (a <= x <= b)\n        cin >> a >> b >> p >> q;\n        cout << solve(2 * p, q, 2 * q, a, b) << endl;\n    }\n    return 0;\n}\n```\n\n\n\n\n\n\n\n",
        "postTime": 1616210076,
        "uid": 142338,
        "name": "pythoner713",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1182F \u3010Maximum Sine\u3011"
    },
    {
        "content": "\u5b66\u8fc7\u4e09\u89d2\u51fd\u6570\u7684\u540c\u5b66\u90fd\u77e5\u9053\uff0c$|\\sin x|$\u7684\u5468\u671f\u4e3a$\\pi$\uff0c\u6bcf\u4e2a\u5468\u671f$[k \\pi, (k+1) pi]$\uff08$k$\u4e3a\u6574\u6570\uff09\u5185\u7684\u6700\u5927\u503c\u5728$k \\pi+\\frac{1}{2}$\u5904\u53d6\u5230\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c$\\frac{px}{q}=\\frac{2px}{2q}$\u7684\u5c0f\u6570\u90e8\u5206\u8981\u5c3d\u53ef\u80fd\u5730\u63a5\u8fd1$\\frac{1}{2}=\\frac{q}{2q}$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c$2px \\bmod 2q$\u8981\u5c3d\u53ef\u80fd\u63a5\u8fd1$q$\u3002\n\n\u5229\u7528\u4e00\u79cd\u7c7b\u4f3cBSGS\u7684\uff0c\u4e00\u8fb9\u8d70\u5927\u6b65\u4e00\u8fb9\u8d70\u5c0f\u6b65\u7684\u601d\u8def\uff0c\u5c06$[l,r]$\u533a\u95f4\u5206\u6210$\\sqrt{r-l+1}$\u5757\uff08\u6700\u540e\u4e00\u5757\u6bd4\u5176\u4ed6\u5757\u5c0f\uff0c\u66b4\u529b\u5904\u7406\u5b83\uff09\u3002\u5148\u5c06\u6bcf\u4e2a\u5757\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20$x$\u7684$2px \\bmod 2q$\u8bb0\u5f55\u4e0b\u6765\uff0c\u6392\u5e8f\u3002\n\n\u63a5\u7740\uff0c\u5c06\u8bb0\u5f55\u4e0b\u6765\u7684\u5143\u7d20\u4e00\u6b21\u4e00\u6b21\u5730\u96c6\u4f53\u53d8\u4e3a$2p(x+1) \\bmod 2q$\u3002\n\n\u7531\u4e8e\u6bcf\u4e00\u6b21\u6539\u53d8\uff0c\u76f8\u5f53\u4e8e\u5c06\u6240\u6709\u8bb0\u5f55\u4e0b\u6765\u7684\u5143\u7d20\u90fd\u52a0\u4e0a$2p$\u8fd9\u4e2a\u5b9a\u503c\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e\u662f\u5c06\u539f\u6765\u6392\u597d\u5e8f\u7684\u5e8f\u5217\u65cb\u8f6c\u4e00\u4e0b\uff0c\u4e8e\u662f\u53ef\u4ee5\u4e0d\u7528\u771f\u7684\u5c06\u8fd9\u4e9b\u5143\u7d20\u90fd\u52a0\u4e0a\u5b9a\u503c\uff0c\u800c\u662f\u5c06\u8fd9\u4e2a\u5b9a\u503c\u8bb0\u5f55\u4e0b\u6765\uff0c\u5229\u7528\u4e8c\u5206\u627e\u5230\u6240\u6709\u5143\u7d20\u52a0\u4e0a\u8fd9\u4e2a\u5b9a\u503c\u540e\uff0c\u6700\u63a5\u8fd1$q$\u7684\u5143\u7d20\u3002\n\n\u590d\u6742\u5ea6$O(\\sqrt{n}\\log \\sqrt{n})$\n\n~~\u5168\u9760CF\u8bc4\u6d4b\u673a\u5feb\u7eed\u547d~~\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define RI register int\ninline int read() {\n\tint q=0;char ch=' ';\n\twhile(ch<'0'||ch>'9') ch=getchar();\n\twhile(ch>='0'&&ch<='9') q=q*10+ch-'0',ch=getchar();\n\treturn q;\n}\nconst int N=100005;\ntypedef long long LL;\nint T;LL l,r,p,q;\nstruct node{LL v,id;}a[N];\nbool operator < (node A,node B) {return A.v==B.v?A.id<B.id:A.v<B.v;}\n\nint main()\n{\n\tscanf(\"%d\",&T);\n\twhile(T--) {\n\t\tscanf(\"%lld%lld%lld%lld\",&l,&r,&p,&q);\n\t\tint sqn=sqrt(r-l+1),kjs=0,js;\n\t\tLL ans1=LLONG_MAX,ans2=-1;\n\t\tfor(LL i=l;i<=r;i+=sqn) {\n\t\t\tif(i+sqn-1<=r) a[++kjs]=(node){i*(p+p)%(q+q),i};\n\t\t\telse {\n\t\t\t\tfor(RI j=i;j<=r;++j) {\n\t\t\t\t\tLL val=abs(j*(p+p)%(q+q)-q);\n\t\t\t\t\tif(val<ans1||(val==ans1&&j<ans2)) ans1=val,ans2=j;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsort(a+1,a+1+kjs);\n\t\tjs=1;for(RI i=2;i<=kjs;++i) if(a[i].v!=a[js].v) a[++js]=a[i];\n\t\tfor(LL i=0,now=0;i<sqn;++i,now=(now+(p+p))%(q+q)) {\n\t\t\tLL pos=(q-now+q+q)%(q+q);\n\t\t\tint k=lower_bound(a+1,a+1+js,(node){pos,-1})-a;\n\t\t\tif(k<=js) {\n\t\t\t\tif(a[k].v-pos<ans1||(a[k].v-pos==ans1&&a[k].id+i<ans2))\n\t\t\t\t\tans1=a[k].v-pos,ans2=a[k].id+i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(q+q-(pos-a[1].v)<ans1||(q+q-(pos-a[1].v)==ans1&&a[1].id+i<ans2))\n\t\t\t\t\tans1=q+q-(pos-a[1].v),ans2=a[1].id+i;\n\t\t\t}\n\t\t\t--k;\n\t\t\tif(k>=1) {\n\t\t\t\tif(pos-a[k].v<ans1||(pos-a[k].v==ans1&&a[k].id+i<ans2))\n\t\t\t\t\tans1=pos-a[k].v,ans2=a[k].id+i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(q+q-(a[js].v-pos)<ans1||(q+q-(a[js].v-pos)==ans1&&a[js].id+i<ans2))\n\t\t\t\t\tans1=q+q-(a[js].v-pos),ans2=a[js].id+i;\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\",ans2);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1562913369,
        "uid": 20604,
        "name": "litble",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1182F \u3010Maximum Sine\u3011"
    },
    {
        "content": "\u6839\u636e $\\sin$ \u7684\u6027\u8d28\uff0c\u9898\u76ee\u7b49\u4ef7\u4e8e\u6c42\u6700\u5c0f\u7684 $x$ \u6765\u6700\u5c0f\u5316 $|2(px\\bmod q)-q|$\u3002  \n\u8003\u8651\u4e71\u641e\uff0c\u5982\u4f55\u4e71\u641e\uff1f\n\n - \u9996\u5148\uff0c\u5f53 $b-a\\le10^6$ \u7684\u65f6\u5019\u66b4\u529b\u3002\n - \u53e6\u5916\uff0c\u5f53 $[a,b]$ \u6700\u591a\u5728\u4e00\u4e2a $\\sin$ \u534a\u5468\u671f\u91cc\u65f6\u5e76\u4e14 $q$ \u592a\u5927\uff0c\u76f4\u63a5\u4e8c\u5206/\u4e09\u5206\u51fa\u6765\u6700\u5927\u503c\u5728\u54ea\u91cc\u3002\n - \u6700\u540e\uff0c$q$ \u5f88\u5927 $p$ \u4e5f\u5f88\u5927\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u505a $px\\bmod q$ \u5f53\u4e00\u4e2a\u968f\u673a\u51fd\u6570\u3002\u53ef\u4ee5\u679a\u4e3e\u7b54\u6848\u7136\u540e\u7528 exgcd \u6c42\u51fa\u6765\u9006\u5143\u4e4b\u540e\u5224\u65ad\u8fd9\u4e2a\u7b54\u6848\u5728 $[a,b]$ \u91cc\u9762\u53ef\u80fd\u4e0d\u53ef\u80fd\u51fa\u73b0\u3002\u8fd9\u4e2a\u53ef\u4ee5\u7528\u7ef4\u62a4\u4e00\u4e2a $l$ \u4e00\u4e2a $r$ \u6765\u505a\uff1b\u521d\u59cb $l=\\lfloor q/2\\rfloor,r=\\lceil q/2\\rceil$\uff0c\u7136\u540e\u4e00\u4e2a\u4e00\u4e2a\u7684\u5f80\u5916\u6eda\u52a8\u3002\n\n~~\u627f\u8ba4\u9762\u5411\u6570\u636e\u3002~~  \n\u8fc7\u4e86\u4e4b\u540e\u53d1\u73b0\u53ef\u4ee5\u76f4\u63a5\u88ab $p=q-1$ \u53c9\u6389\uff0c\u5f88\u5c11\u89c1\u5230\u4e00\u4e2a CF \u6570\u636e\u6c34\u7684\u9898\u76ee\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6:~~O(\u7384\u5b66)~~\n - \u7b2c\u4e00\u4e2a\u662f $O(b-a)$\n - \u7b2c\u4e8c\u4e2a\u662f $O(\\log(b-a))$\uff0c\u53ea\u80fd\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\u7528\n - \u7b2c\u4e09\u4e2a\u662f\u671f\u671b $O(\\frac{q}{b-a})$\n\n\u8d3c\u957f\u7684\u4ee3\u7801\uff1a\n\n```cpp\n// writer: w33z8kqrqk8zzzx33\n#include <bits/stdc++.h>\nusing namespace std;\n\n// begin fast read template by CYJian (source: https://www.luogu.com.cn/paste/i11c3ppx)\n\nnamespace io {\n\tconst int __SIZE = (1 << 21) + 1;\n\tchar ibuf[__SIZE], *iS, *iT, obuf[__SIZE], *oS = obuf, *oT = oS + __SIZE - 1, __c, qu[55]; int __f, qr, _eof;\n\t#define Gc() (iS == iT ? (iT = (iS = ibuf) + fread (ibuf, 1, __SIZE, stdin), (iS == iT ? EOF : *iS ++)) : *iS ++)\n\tinline void flush () { fwrite (obuf, 1, oS - obuf, stdout), oS = obuf; }\n\tinline void gc (char &x) { x = Gc(); }\n\tinline void pc (char x) { *oS ++ = x; if (oS == oT) flush (); }\n\tinline void pstr (const char *s) { int __len = strlen(s); for (__f = 0; __f < __len; ++__f) pc (s[__f]); }\n\tinline void gstr (char *s) { for(__c = Gc(); __c < 32 || __c > 126 || __c == ' ';)  __c = Gc();\n\t\tfor(; __c > 31 && __c < 127 && __c != ' '; ++s, __c = Gc()) *s = __c; *s = 0; }\n\ttemplate <class I> inline bool gi (I &x) { _eof = 0;\n\t\tfor (__f = 1, __c = Gc(); (__c < '0' || __c > '9') && !_eof; __c = Gc()) { if (__c == '-') __f = -1; _eof |= __c == EOF; }\n\t\tfor (x = 0; __c <= '9' && __c >= '0' && !_eof; __c = Gc()) x = x * 10 + (__c & 15), _eof |= __c == EOF; x *= __f; return !_eof; }\n\ttemplate <class I> inline void print (I x) { if (!x) pc ('0'); if (x < 0) pc ('-'), x = -x;\n\t\twhile (x) qu[++ qr] = x % 10 + '0',  x /= 10; while (qr) pc (qu[qr --]); }\n\tstruct Flusher_ {~Flusher_(){flush();}}io_flusher_;\n} using io::pc; using io::gc; using io::pstr; using io::gstr; using io::gi; using io::print;\n\n// end fast read template by CYJian\n\n#define iter(i, a, b) for(int i=(a); i<(b); i++)\n#define rep(i, a) iter(i, 0, a)\n#define rep1(i, a) iter(i, 1, (a)+1)\n#define log(a) cerr<<\"\\033[32m[DEBUG] \"<<#a<<'='<<(a)<<\" @ line \"<<__LINE__<<\"\\033[0m\"<<endl\n#define all(a) a.begin(), a.end()\n#define fi first\n#define se second\n#define pb push_back\n#define mp make_pair\n \nusing ll=long long;\nusing pii=pair<int, int>;\n//#define int ll\nconst int MOD = 1000000007;\n\nll bruteforce(ll a, ll b, ll p, ll q) {\n\tp %= q;\n\tll best = 0x3f3f3f3f3f3f3f3f, bestp = 0, cur = p*a % q;\n\titer(i, a, b+1) {\n\t\tif(abs(2*cur-q) < best) {\n\t\t\tbest = abs(2*cur-q);\n\t\t\tbestp = i;\n\t\t}\n\t\tcur += p; cur -= (cur >= q ? q : 0);\n\t}\n\treturn bestp;\n}\nconstexpr ll infty = 1e18;\nvoid exgcd(ll a, ll b, ll&x, ll&y) {\n\tif(!b) x=1,y=0;\n\telse exgcd(b, a%b, y, x), y-=a/b*x;\n}\nll sv(ll p, ll q) { ll x,y; exgcd(p,q,x,y); return (x%q+q)%q; }\nll solution(ll p, ll q, ll g, ll tg, ll v, ll l, ll r) {\n\tif(!(0 <= tg && tg < q)) return infty;\n\tif(tg % g) return infty;\n\tll tmp = v * (tg/g) % q;\n\tif(tmp < l) {\n\t\tll k = (l - tmp + q - 1) / q;\n\t\ttmp += k * q;\n\t} else {\n\t\tll k = (tmp - l) / q;\n\t\ttmp -= k * q;\n\t}\n\tassert(l <= tmp);\n\tassert(tmp-q < l);\n\tif(r < tmp) return infty;\n\treturn tmp;\n}\nll bruteforce2(ll a, ll b, ll p, ll q) {\n\tll g = 1;\n\tll low, high;\n\tll v = sv(p, q);\n\tif(q % 2 == 0) {\n\t\tll t = solution(p, q, g, q/2, v, a, b);\n\t\tif(t != infty) return t;\n\t\tlow = q/2 - 1, high = q/2+1;\n\t} else low = q/2, high = q/2+1;\n\twhile(1) {\n\t\t//if(low % 1000000 == 0) cout << low << ' ' << high << endl;\n\t\tif(low <= -1 && high >= q) return -1;\n\t\tll t1 = solution(p, q, g, low, v, a, b);\n\t\tll t2 = solution(p, q, g, high, v, a, b);\n\t\tt2 = min(t1, t2);\n\t\tif(t2 != infty) return t2;\n\t\tlow--; high++;\n\t}\n\treturn -1;\n}\nll check1(ll a, ll b, ll p, ll q) {\n\tauto eval = [&](ll x){return abs(2*(p*x%q)-q);};\n\tll low = a, high = b;\n\tpair<ll, ll> ans = {infty,0};\n\tans = min(ans, {eval(a), a});\n\tans = min(ans, {eval(b), b});\n\tif(eval(a)<eval(a+1)) {\n\t\twhile(low <= high) {\n\t\t\tll mid = (low+high)/2;\n\t\t\tans = min(ans, {eval(mid), mid});\n\t\t\tans = min(ans, {eval(mid+1), mid+1});\n\t\t\tif(eval(mid)<eval(mid+1)) low = mid + 1;\n\t\t\telse high = mid - 1;\n\t\t}\n\t}\n\treturn ans.se;\n}\n\nsigned main() {\n    ios_base::sync_with_stdio(false); cin.tie(0);\n    int t; cin >> t;\n\twhile(t--) {\n\t\tll a, b, p, q; cin >> a >> b >> p >> q;\n\t\tll g = __gcd(p, q);\n\t\tp /= g;\n\t\tq /= g;\n\t\tif(b-a+1 <= 1000000) cout << bruteforce(a, b, p, q) << endl;\n\t\telse if(2 * p * (b-a+1) < q && q > 1000000) cout << check1(a, b, p, q) << endl;\n\t\telse cout << bruteforce2(a, b, p, q) << endl;\n\t}\n}\n\n```",
        "postTime": 1596627667,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1182F \u3010Maximum Sine\u3011"
    },
    {
        "content": "\u9898\u76ee\u94fe\u63a5\uff1a[$\\texttt{Link}$](https://www.luogu.com.cn/problem/CF1182F)\n\n$\\Large\\texttt{Description}$\n\n\u6c42 $[a, b]$ \u4e2d\u4f7f\u5f97 $f(x)\\! =\\!\\left|\\ \\sin\\left(\\dfrac{p}{q}\\pi x\\right)\\ \\right|$ \u53d6\u5f97\u6700\u5927\u503c\u7684\u6574\u6570 $x$\u3002\u4e14 $x$ \u53ef\u80fd\u6709\u591a\u4e2a\u53d6\u503c\uff0c\u8bf7\u8f93\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6700\u5c0f\u7684 $x$\u3002\n\n$ 0 \\le a \\le b \\le 10^{9} $ , $ 1 \\le p $ , $ q \\le 10^{9} $\u3002\n\n$\\Large\\texttt{Analysis}$\n\n\u9996\u5148\u6211\u4eec\u5f97\u5230\u5f53 $x = k\\pi + \\dfrac{\\pi}{2} (k \\in \\mathbb{Z})$ \u65f6\u53d6\u5230\u8be5\u51fd\u6570\u7684\u6781\u503c\uff0c\u6240\u4ee5 $\\dfrac{p}{q}\\pi x$ \u8d8a\u63a5\u8fd1 $k\\pi + \\dfrac{\\pi}{2}$ \u65f6\u51fd\u6570\u503c\u8d8a\u5927\u3002\n\n\u4e5f\u5c31\u662f\u8981\u8ba9 $\\left|\\dfrac{p}{q}\\pi x - (k\\pi + \\dfrac{\\pi}{2})\\right|$ \u6700\u5c0f\u3002\n\n\u7a0d\u4f5c\u53d8\u5f62\u5f97 \n$$\\dfrac{\\pi}{2q}\\times\\left|2px - q - 2qk\\right|$$\n\n\u7531\u4e8e\u5de6\u8fb9\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u53ea\u9700\u8ba9\u53f3\u8fb9\u7684\u7edd\u5bf9\u503c\u6700\u5c0f\u5373\u53ef\u3002\n\n\u8fd9\u7b49\u4ef7\u4e8e\u8ba9 $2px - q$ \u5c3d\u91cf\u63a5\u8fd1 $2q$ \u7684\u500d\u6570\uff0c\u5373 $2px \\to q\\pmod {2q}$\u3002\n\n\u6211\u4eec\u8bbe $\\left|2px \\bmod 2q - q\\right|_{\\min} = y$\uff0c\u663e\u7136\u53ef\u4ee5\u4e8c\u5206\u6c42 $y$\uff0c\u8bbe\u5f53\u524d\u4e8c\u5206\u7684\u503c\u4e3a $\\Delta\\ (\\Delta \\in [0, q])$\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u662f\u5426\u5b58\u5728 $x$ \u6ee1\u8db3\uff1a\n\n$$q - \\Delta \\le 2px \\bmod 2q \\leq q + \\Delta$$\n\n\u8bb0\u5de6\u8fb9\u754c $q - \\Delta\n = l$\uff0c\u53f3\u8fb9\u754c $q + \\Delta = r$\uff0c\u5373\u5224\u65ad\uff1a\n \n$$\\sum\\limits_{x=a}^b\\left[\\ 2px \\bmod 2q \\in [l, r]\\ \\right] \\gt\n 0$$\n \n\u662f\u5426\u6210\u7acb\u3002\n\n---\n\n$\\textbf{Key Conclusion :}$ $\\left[\\ 2px \\bmod 2q \\in [l, r]\\ \\right] = \\left\\lfloor \\dfrac{2px-l}{2q} \\right\\rfloor - \\left\\lfloor \\dfrac{2px-r-1}{2q} \\right\\rfloor$\n\n$\\textbf{Proof :}$\n\n\u8bb0 $u=2px, v=2q$\u3002\n\n\u9996\u5148 $l \\leq r$\uff0c\u56e0\u6b64\u6709 $\\left\\lfloor \\dfrac{u-l}{v} \\right\\rfloor - \\left\\lfloor \\dfrac{u-r-1}{v}\\right\\rfloor \\geq 0$\u3002\n\n\u53c8\u56e0\u4e3a $l, r \\in [0, 2q]$\uff0c\u6240\u4ee5 $\\left\\lfloor \\dfrac{u-l}{v} \\right\\rfloor - \\left\\lfloor \\dfrac{u-r-1}{v}\\right\\rfloor \\leq 1$\u3002\n\n\u6545\u8be5\u5f0f\u5b50\u53ef\u80fd\u7684\u53d6\u503c\u53ea\u80fd\u4e3a $0$ \u6216 $1$\u3002\n\n\u5f53 $u \\bmod v \\in [l, r]$ \u65f6\uff0c\u6211\u4eec\u5f97\u5230\u4e0b\u9762\u4e24\u4e2a\u5f0f\u5b50\uff1a\n\n$$\n\\begin{cases}\nu \\bmod v - l \\geq 0 \\\\\nu \\bmod v - r \\leq 0 \\\\\n\\end{cases}\n$$\n\n\u6839\u636e $u \\bmod v = u - v\\cdot\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor$ \u53d8\u5f62\u5f97\uff1a\n\n$$\n\\begin{cases}\n\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor \\leq \\dfrac{u - l}{v} \\\\\n\\\\\n\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor \\geq \\dfrac{u - r}{v} \\\\\n\\end{cases}\n$$\n\n\u7531\u4e8e $u - l \\leq u$\uff0c\u8fdb\u4e00\u6b65\u5f97\uff1a\n\n$$\n\\begin{cases}\n\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor = \\left\\lfloor\\dfrac{u - l}{v}\\right\\rfloor \\\\\n\\\\\n\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor \\geq \\left\\lceil\\dfrac{u - r}{v}\\right\\rceil \\\\\n\\end{cases}\n$$\n\n\u5c06\u4e0a\u53d6\u6574\u8f6c\u4e3a\u4e0b\u53d6\u6574\uff1a\n\n$$\n\\begin{cases}\n\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor = \\left\\lfloor\\dfrac{u - l}{v}\\right\\rfloor \\\\\n\\\\\n\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor \\gt \\left\\lfloor\\dfrac{u - r - 1}{v}\\right\\rfloor \\\\\n\\end{cases}\n$$\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86 $\\left\\lfloor\\dfrac{u - l}{v}\\right\\rfloor \\gt \\left\\lfloor\\dfrac{u - r - 1}{v}\\right\\rfloor$\uff0c\u7ed3\u5408\u4e4b\u524d\u63a8\u51fa\u7684\u7ed3\u8bba\u53ef\u5f97 $\\left\\lfloor\\dfrac{u - l}{v}\\right\\rfloor - \\left\\lfloor\\dfrac{u - r - 1}{v}\\right\\rfloor = 1$\u3002\n\n\u5f53 $u \\bmod v \\notin [l, r]$ \u65f6\uff1a\n\n\u4ee4 $\\left\\lfloor\\dfrac{u}{v}\\right\\rfloor = k$\uff0c\u5f53 $u \\bmod v \\lt l$ \u65f6\uff0c\u6570\u5f62\u7ed3\u5408\u53ef\u5f97 $\\left\\lfloor\\dfrac{u - l}{v}\\right\\rfloor = k - 1$\uff0c$\\left\\lfloor\\dfrac{u - r - 1}{v}\\right\\rfloor = k - 1$\uff0c\u6545\u4e24\u8005\u4e4b\u5dee\u4e3a $0$\uff0c$u \\bmod v \\gt r$ \u65f6\u540c\u7406\u3002\n\n$\\textbf{Q.E.D.}$\n\n---\n\n\u6839\u636e\u4e0a\u9762\u7684\u7ed3\u8bba\uff0c\u6211\u4eec\u5c06\u8981\u5224\u65ad\u7684\u4e1c\u897f\u8f6c\u5316\u4e3a\uff1a\n\n$$\\sum\\limits_{x=a}^b\\left(\\left\\lfloor \\dfrac{2px-l}{2q} \\right\\rfloor - \\left\\lfloor \\dfrac{2px-r-1}{2q} \\right\\rfloor\\right) \\gt 0$$\n\n\u663e\u7136\u53ef\u4ee5\u7c7b\u6b27\u6c42\u89e3\uff08\u53c2\u8003 [$\\texttt{P5170}$](https://www.luogu.com.cn/problem/P5170)\uff09\uff0c\u4f46\u662f\u6709\u8d1f\u6570\u65f6\u7c7b\u6b27\u4f1a\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u4e24\u4e2a\u4e0b\u53d6\u6574\u5185\u7684\u4e1c\u897f\u90fd\u52a0\u4e0a $2$\uff0c\u628a\u7c7b\u6b27\u4e2d\u7684 $b$ \u4ece\u8d1f\u7684\u53d8\u6210\u6b63\u7684\uff0c\u6700\u540e\u7684\u7ed3\u679c\u8fd8\u662f\u4e00\u6837\u7684\u3002\n\n\u5373\uff1a\n\n$$\\sum\\limits_{x=a}^b\\left(\\left\\lfloor \\dfrac{2px + (4q-l)}{2q} \\right\\rfloor - \\left\\lfloor \\dfrac{2px+(4q - r - 1)}{2q} \\right\\rfloor\\right) \\gt 0$$\n\n\u4e8c\u5206\u7ed3\u675f\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u4e86 $\\left|2px \\bmod 2q - q\\right|$ \u7684\u6700\u5c0f\u503c $y$\uff0c\u6545 $2px \\equiv q \\pm y \\pmod {2q}$\uff0c\u76f4\u63a5\u6269\u6b27\u6c42\u89e3\uff0c\u6700\u540e\u5c06\u89e3\u7684\u8303\u56f4\u8c03\u6574\u5230 $[a,b]$ \u5373\u53ef\u3002\n\n$\\Large\\texttt{AC Code}$\n\n```cpp\n#include <bits/stdc++.h>\n\n#define i64 long long \n#define all(x) x.begin(), x.end()\n#define seg(a, l, r) a + l, a + r + 1\n#define rep(i, a, b) for(int i = (a); i <= (b); i++)\n#define per(i, a, b) for(int i = (a); i >= (b); i--)\n\nusing namespace std;\n\nint T;\ni64 a, b, p, q;\n\ni64 f(i64 a, i64 b, i64 c, i64 n) {\n\tif(a == 0) return (n + 1) * (b / c);\n\tif(a >= c || b >= c) return (n + 1) * n / 2 * (a / c) + (n + 1) * (b / c) + f(a % c, b % c, c, n);\n\t\n\ti64 t = (a * n + b) / c;\n\t\n\treturn n * t - f(c, c - b - 1, a, t - 1);\n}\n\ni64 solve(i64 a, i64 b, i64 c,i64 l, i64 r) {\n\treturn f(a, b, c, r) - (l == 0 ? 0 : f(a, b, c, l - 1));\n}\n\nbool check(i64 y) {\n\ti64 l = q - y, r = q + y;\n\t\n\treturn solve(2 * p, 4 * q - l, 2 * q, a, b) - solve(2 * p, 4 * q - r - 1, 2 * q, a, b) > 0;\n}\n\ni64 exgcd(i64 a, i64 b, i64 &x, i64 &y) {\n\tif(b == 0) {\n\t\tx = 1;\n\t\ty = 0;\n\t\t\n\t\treturn a;\n\t}\n\t\n\ti64 ret = exgcd(b, a % b, x, y);\n\ti64 tx = y, ty = x - a / b * y;\n\t\n\tx = tx;\n\ty = ty;\n\t\n\treturn ret;\n}\n\nint main(){\n\n    ios::sync_with_stdio(false);\n    cin.tie(nullptr); cout.tie(nullptr);\n\n    cin >> T;\n    while(T--) {\n    \tcin >> a >> b >> p >> q;\n    \t\n    \ti64 l = 0, r = q;\n    \twhile(l < r) {\n    \t\ti64 mid = l + r >> 1;\n    \t\t\n    \t\tif(check(mid)) r = mid;\n    \t\telse l = mid + 1;\n    \t}\n    \t\n    \ti64 x, y;\n    \ti64 g = exgcd(2 * p, 2 * q, x, y);\n    \t\n    \ti64 ans = LLONG_MAX;\n    \ti64 m = 2 * q / g;\n    \t\n    \tif((q + r) % g == 0) {\n    \t\ti64 tx = x * ((q + r) / g);\n    \t\ttx += (a - tx) / m * m;\n    \t\t\n    \t\tif(tx >= a) tx -= m;\n    \t\tif(tx < a) tx += m;\n\n    \t\tans = min(ans, tx);\n    \t}\n    \tif((q - r) % g == 0) {\n    \t\ti64 tx = x * ((q - r) / g);\n    \t\ttx += (a - tx) / m * m;\n    \t\t\n    \t\tif(tx >= a) tx -= m;\n    \t\tif(tx < a) tx += m;\n    \t\t\n    \t\tans = min(ans, tx);\n    \t}\n    \t\n    \tcout << ans << \"\\n\";\n    }\n\n    return 0;\n}\n```\n\n$\\text{Author: xhgua}$\n\n$\\text{Check: Matrix\\_mlt}$\n",
        "postTime": 1678882941,
        "uid": 410239,
        "name": "xhgua",
        "ccfLevel": 6,
        "title": "CF1182F Maximum Sine \u9898\u89e3"
    }
]