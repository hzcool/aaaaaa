[
    {
        "content": "\u53f2\u4e0a\u6700\u6c34 2600\uff0c\u4e0d\u4fe1\u81ea\u5df1\u5199\u4e00\u4e0b\u3002\n\n\u622a\u6b62 2022/2/14 18:17 \u6211\u662f\u5168 CF \u6700\u4f18\u89e3\uff0c\u6700\u6162\u70b9\u9886\u5148 rk2 126ms\uff0c\uff08~~\u6211\u76f8\u4fe1\u6211\u6491\u4e0d\u8fc7\u4e00\u5929~~\uff09\u3002 \n\n$\\large\\text{Solution}$\n\n\u4e0b\u6587\u4e2d\uff0c\u5b9a\u4e49 $[(x_1,y_1),(x_2,y_2)]=\\sum\\limits_{i=x_1}^{x_2}\\sum\\limits_{j=y_1}^{y_2}A_{i,j}$\u3002\n\n\u9996\u5148\uff0c\u4e00\u4e2a\u4f20\u7edf\u7684\u5dee\u5206+\u5bb9\u65a5\uff0c\u628a\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\uff1a \n\n$[(1,1),(x_2,y_2)]-[(1,1),(x_1-1,y_2)]-[(1,1),(x_2,y_1-1)]+[(1,1),(x_1-1,y_1-1)]$\n\n[\u5982\u679c\u60a8\u4e0d\u7406\u89e3](https://www.luogu.com.cn/paste/6jweyrzq)\n\n\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42 $[(1,1),(x,y)]$\u3002\n\n\u6839\u636e\u9898\u610f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8868\u683c\u5206\u4e3a\u8fd9\u6837\uff1a\n\n[![H6TrKs.md.png](https://s4.ax1x.com/2022/02/14/H6TrKs.md.png)](https://imgtu.com/i/H6TrKs)\n\n\u5176\u4e2d\u4ece\u5de6\u4e0a\u5230\u53f3\u4e0b\u7b2c $x$ \u4e2a \u201cL\u201d\u578b\u5757\u6309\u7bad\u5934\u65b9\u5411\u4f9d\u6b21\u4e3a $(x-1)^2+1,(x-1)^2+2,\\dots,x^2$\uff0c\u800c $1\\dots x$ \u6784\u6210\u7684\u6b63\u65b9\u5f62\u5927\u5c0f\u4e3a $x^2$\uff0c\u91cc\u9762\u6b63\u597d \u5305\u542b\u4e86 $1\\dots x^2$ \u7684\u6240\u6709\u6570\u3002\n\n\uff08~~\u8bb2\u4e86\u90a3\u4e48\u591a\u5e9f\u8bdd~~\uff09\n\n\u8fd9\u9898\u76f4\u63a5\u505a\u54ea\u91cc\u9ebb\u70e6\uff1f\u8f6c\u89d2\u3002\u8003\u8651\u4efb\u610f\u4e00\u4e2a\u4ee5 $(1,1)$ \u4e3a\u5de6\u4e0a\u89d2\u7684\u77e9\u5f62\u4e00\u5b9a\u5305\u542b\u4e00\u4e2a\u4ee5 $(1,1)$ \u4e3a\u5de6\u4e0a\u89d2\uff0c$(\\min(x,y),\\min(x,y))$ \u7684\u6b63\u65b9\u5f62\uff0c\u51cf\u53bb\u8fd9\u4e2a\u6b63\u65b9\u5f62\u4e4b\u540e\uff0c\u5c31\u6ca1\u6709\u8f6c\u89d2\u4e86\u3002\n\n\u7ed3\u5408\u56fe\u7406\u89e3\u4e00\u4e0b\n\n[![H6bWPf.md.png](https://s4.ax1x.com/2022/02/14/H6bWPf.md.png)](https://imgtu.com/i/H6bWPf)\n\n\u63a5\u4e0b\u6765\u5bf9\u4e8e\u6c42 $[(1,1),(x,y)]$ \u6839\u636e\u4e0d\u540c\u60c5\u51b5\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- $x=y$\n\n\u53ef\u4ee5\u53d1\u73b0\u662f\u6c42\u4e00\u4e2a\u4ee5 $(1,1)$ \u4e3a\u5de6\u4e0a\u89d2\u7684\u6b63\u65b9\u5f62\uff0c\u5c31\u662f\u7b97 $1+2+\\dots+n^2=\\frac{(n^2+1)*n^2}{2}$\n\n- $x>y$\n\n\u5148\u7b97\u5de6\u4e0a\u89d2\u7684\u6b63\u65b9\u5f62\uff1a$1+2+\\dots+\\min(x,y)^2=\\frac{(\\min(x,y)^2+1)*\\min(x,y)^2}{2}$\n\n\u5176\u5b9e\u8fd9\u91cc $\\min(x,y)$ \u5c31\u662f $y$\u3002\n\n\u518d\u7b97\u4e0b\u9762\u90e8\u5206\u3002\n\n\u5f0f\u5b50 \uff08\u4ece\u7b2c $y+1$ \u884c\u7b2c $1$ \u5217\u5f00\u59cb\uff0c\u4ece\u4e0a\u5230\u4e0b\uff0c\u4ece\u5de6\u5230\u53f3\uff09\uff1a\n\n$(y+1)^2$\uff08\u7bad\u5934\u5c3e\u7aef\uff09+$(y+2)^2+\\dots+x^2$\n\n$+(y+1)^2-1+(y+1)^2-1+\\dots+x^2-1$\n\n$+\\dots+$\n\n$+(y+1)^2-y+1+(y+1)^2-y+1+\\dots+x^2-y+1$\n\n\u5f62\u5f0f\u5316\u7684\uff1a$\\sum\\limits_{i=0}^{y-1}\\sum\\limits_{j=y+1}^x j^2-i=\\sum\\limits_{i=0}^{y-1}\\sum\\limits_{j=y+1}^x j^2-\\sum\\limits_{i=0}^{y-1}\\sum\\limits_{j=y+1}^xi=y\\sum\\limits_{j=y+1}^x j^2-(x-y)\\sum\\limits_{i=0}^{y-1}i$\n\n\u6ce8\u610f\u5230\u7b2c\u4e00\u90e8\u5206\u53ef\u4ee5\u901a\u8fc7\u5e73\u65b9\u548c\u516c\u5f0f $\\sum\\limits_{i=1}^{n}i^2=\\frac{n(n+1)(2n+1)}{6}$ \u8fdb\u884c\u5dee\u5206\u6c42\u548c\uff0c\u7b2c\u4e8c\u90e8\u5206\u662f\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u53ef\u4ee5\u76f4\u63a5\u7b97\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff1a$[(1,1),(x,y)]=\\frac{(\\min(x,y)^2+1)*\\min(x,y)^2}{2}+y(\\frac{x(x+1)(2x+1)}{6}-\\frac{y(y+1)(2y+1)}{6})-(x-y)\\frac{(y-1)y}{2}$\n\n- $x<y$ \n\n\u5176\u5b9e\u5dee\u4e0d\u591a\uff0c\u7b2c\u4e00\u90e8\u5206\u4e0d\u8bb2\u4e86\u3002\n\n\n\u5f0f\u5b50 \uff08\u4ece\u7b2c $y+1$ \u5217\u5f00\u59cb\uff0c**\u4ece\u5de6\u5230\u53f3\uff0c\u4ece\u4e0a\u5230\u4e0b**\uff09\uff1a\n\n$x^2+1+(x+1)^2+1+\\dots+(y-1)^2+1$\n\n$+x^2+2+(x+1)^2+2+\\dots+(y-1)^2+2$\n\n$+\\dots+$\n\n$+x^2+x+(x+1)^2+x+\\dots+(y-1)^2+x$\n\n\u5f62\u5f0f\u5316\u7684\uff1a$\\sum\\limits_{i=x}^{y-1}\\sum\\limits_{j=1}^x i^2-j=\\sum\\limits_{i=x}^{y-1}\\sum\\limits_{j=1}^x i^2-\\sum\\limits_{i=x}^{y-1}\\sum\\limits_{j=1}^xj=x\\sum\\limits_{i=x}^{y-1} i^2-(y-x)\\sum\\limits_{j=1}^xj$\n\n\u540c\u6837\u65b9\u6cd5\u5f97\u5230 $[(1,1),(x,y)]=\\frac{(\\min(x,y)^2+1)*\\min(x,y)^2}{2}+x(\\frac{(y-1)(y-1+1)(2(y-1)+1)}{6}-\\frac{(x-1)(x-1+1)(2(x-1)+1)}{6})-(y-x)\\frac{(x+1)x}{2}$\n\n\n------------\n\n\u7136\u540e\u5c31\u597d\u4e86\uff0c\u7b54\u6848\u6700\u5927\u662f $x^4$ \u7ea7\u522b\u7684\uff0c\u4e2d\u9014\u8981\u5f00 `int128`\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#define i128 __int128\ninline i128 work(i128 x,i128 y){\n\ti128 k=min(x,y),ans=(k*k*(k*k+1))>>1;//\u5de6\u4e0a\u89d2\u6b63\u65b9\u5f62\n    //\u4ee5\u4e0b\u5c31\u662f\u6839\u636e\u521a\u624d\u7684\u6a21\u62df\u3002\n\tif(x==y)return ans;\n\tif(x>y)return ans+(x*(x+1)*(x<<1|1)-y*(y+1)*(y<<1|1))/6*y-(x-y)*(y*(y-1)>>1);\n\treturn ans+((y-1)*y*((y-1)<<1|1)-(x-1)*x*((x-1)<<1|1))/6*x+(y-x)*(x*(x+1)>>1);\n}\nsigned main(){\n\tfor(int T=read();T;T--){\n\t\tint x=read(),y=read(),u=read(),v=read();\n\t\ti128 ans=work(u,v)-work(x-1,v)-work(u,y-1)+work(x-1,y-1);\n\t\tif(ans>10000000000)printf(\"...%010lld\\n\",(ll)ans%10000000000);//\u6ce8\u610f\u4e00\u4e0b\u8f93\u51fa\u683c\u5f0f\n\t\telse printf(\"%lld\\n\",(ll)ans);\n\t}\n}\n```",
        "postTime": 1644849442,
        "uid": 185864,
        "name": "TOBapNw",
        "ccfLevel": 7,
        "title": "\u9898\u89e3\u3010CF249E Endless Matrix\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/syzf2222/p/14332342.html)\n\n\u8fd9\u9898\u6839\u672c\u914d\u4e0d\u4e0a\u7d2b\u9898\u96be\u5ea6\uff0c\u9664\u4e86\u7ec6\u8282\u5de8\u96be\u8c03\u4ee5\u5916\uff0c\u601d\u7ef4\u96be\u5ea6\u51e0\u4e4e\u4e3a\u96f6\u3002\n\n\u8003\u8651\u8ba1\u7b97$calc(x,y)=(1,1)\\rightarrow(x,y)$\u7684\u503c\uff0c\u7b54\u6848\u5373\u4e3a$calc(x1-1,y1-1)+calc(x2,y2)-calc(x1-1,y2)-calc(x2,y1-1)$\n\n1. $x=y\\quad calc(x,y)=\\frac12(1+x^2)x^2$\n\n2. $x>y\\quad calc(x,y)=\\frac12(1+y^2)y^2+\\sum\\limits_{i=y+1}^x \\sum\\limits_{j=i^2-y+1}^{i^2}j=\\frac12(1+y^2)y^2+\\frac12y\\sum\\limits_{i=y+1}^x(2i^2-y+1)$\n\n3. $x<y\\quad calc(x,y)=\\frac12(1+x^2)x^2+\\sum\\limits_{i=x+1}^y \\sum\\limits_{j=(i-1)^2+1}^{(i-1)^2+x}j=\\frac12(1+x^2)x^2+\\frac12x\\sum\\limits_{i=x+1}^y(2i^2-4i+3+x)$\n\n\u5982\u679c\u8fd9\u9898\u662f\u6a21$998244353$\uff0c$1e9+7$\u4e4b\u7c7b\u7684\u6570\uff0c\u90a3\u4e48\u606d\u559c\u505a\u5b8c\u4e86\u3002\n\n\u4f46\u8fd9\u9898\u7684\u6a21\u6570\u662f$1e10$\uff0c\u4e0d\u4f46\u662f\u5408\u6570\uff0c\u4e58\u8d77\u6765\u8fd8\u4f1a\u7206$long long$\uff0c\u8fd9\u4f7f\u6211\u4eec\u4e0d\u5f97\u4e0d\u8003\u8651\u4e00\u4e9b\u7ec6\u8282\u3002\n\n1. \u5224\u65ad\u662f\u5426\u7ed3\u679c\u5c0f\u4e8e$1e10$\uff1a\u518d\u6a21\u4e00\u4e2a$1e10+9$\uff0c\u6bd4\u5bf9\u7ed3\u679c\u3002\n\n2. \u9632\u6b62\u4e58\u6cd5\u7206$long long$\uff1a\u4f7f\u7528\u7c7b\u4f3c\u5feb\u901f\u5e42\u7684\u5feb\u901f\u4e58\u6cd5\u3002\n\n3. \u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u6709\u51fa\u73b0\u53d6\u8fc7\u6a21\u7684\u6570\u9664\u4ee5$2$\uff0c\u5bfc\u81f4\u7b54\u6848\u6709$5e9$\u7684\u8bef\u5dee\uff1a\u628a\u6a21\u6570\u6539\u4e3a$2e10$\n\n\u8fd9\u65f6\u53d1\u73b0\u56e0\u4e3a\u8fc7\u591a\u7684\u53d6\u6a21\uff0c\u6211\u4eec\u5b8c\u7f8e\u5730$TLE$\u4e86\uff0c\u4e0b\u9762\u6709\u4e00\u4e9b\u5361\u5e38$tricks$\u3002\n\n1. \u56e0\u4e3a$1e10$\u5bf9\u4e8e$long long$\u6765\u8bf4\u5f88\u5c0f\uff0c\u6240\u4ee5\u6700\u540e\u53d6\u4e00\u6b21\u6a21\u5c31\u597d\u4e86\u3002\n\n2. \u5feb\u901f\u4e58\u6cd5\u4e2d\u5efa\u8bae\u53d6\u4e00\u4e2a\u503c\uff0c\u5927\u4e8e\u8fd9\u4e2a\u503c\u518d\u53d6\u6a21\u3002\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u6109\u5feb\u5730$AC$\u672c\u9898\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$\\Theta(n\\log n)$\n\n\u4ee3\u7801\u5982\u4e0b\uff0c\u4ee5\u4f9b\u53c2\u8003\uff1a\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int mod1=2e10;\nconst int mod2=1e10+9;\nconst int mod3=1e10;\nconst int val=1e16;\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n\treturn x*f;\n}\nint mod,T;\ninline int mul(int x,int y){\n\tint res=0;\n\twhile(y){\n\t\tif(y&1)res+=x;\n\t\tx<<=1;\n\t\tif(x>=val)x%=mod;\n\t\ty>>=1;\n\t}\n\treturn res%mod;\n}\ninline int calc(int x,int y){\n\tif(!x||!y)return 0;\n\tint res=0;\n\tif(x==y){\n\t\tint t=mul(x,x);\n\t\tif(t&1)res=mul(t,(t+1)>>1);\n\t\telse res=mul(t>>1,t+1);\n\t\treturn res;\n\t}else if(x<y){\n\t\tint t=mul(x,x);\n\t\tif(t&1)res=mul(t,(t+1)>>1);\n\t\telse res=mul(t>>1,t+1);\n\t\tt=mul(x+3,y-x);\n\t\tt-=mul(x+y+1,(y-x)<<1);\n\t\tif(y%3==0)t+=mul(y/3,mul(y+1,y<<1|1));\n\t\telse if(y%3==1)t+=mul(y,mul(y+1,(y<<1|1)/3));\n\t\telse t+=mul(y,mul((y+1)/3,y<<1|1));\n\t\tif(x%3==0)t-=mul(x/3,mul(x+1,x<<1|1));\n\t\telse if(x%3==1)t-=mul(x,mul(x+1,(x<<1|1)/3));\n\t\telse t-=mul(x,mul((x+1)/3,x<<1|1));\n\t\tt=t%mod+mod;\n\t\tif(!(t&1))res=(res+mul(x,t>>1))%mod;\n\t\telse if(mod&1)res=(res+mul(x,(t+mod)>>1))%mod;\n\t\telse res=(res+mul(x>>1,t))%mod;\n\t\treturn res;\n\t}else{\n\t\tswap(x,y);\n\t\tint t=mul(x,x);\n\t\tif(t&1)res=mul(t,(t+1)>>1);\n\t\telse res=mul(t>>1,t+1);\n\t\tt=mod-mul(y-x,x-1);\n\t\tif(y%3==0)t+=mul(y/3,mul(y+1,y<<1|1));\n\t\telse if(y%3==1)t+=mul(y,mul(y+1,(y<<1|1)/3));\n\t\telse t+=mul(y,mul((y+1)/3,y<<1|1));\n\t\tif(x%3==0)t-=mul(x/3,mul(x+1,x<<1|1));\n\t\telse if(x%3==1)t-=mul(x,mul(x+1,(x<<1|1)/3));\n\t\telse t-=mul(x,mul((x+1)/3,x<<1|1));\n\t\tt=t%mod+mod;\n\t\tif(!(t&1))res=(res+mul(x,t>>1))%mod;\n\t\telse if(mod&1)res=(res+mul(x,(t+mod)>>1))%mod;\n\t\telse res=(res+mul(x>>1,t))%mod;\n\t\treturn res;\n\t}\n}\ninline int solve(int x1,int y1,int x2,int y2){\n\treturn ((calc(x1-1,y1-1)+calc(x2,y2)-calc(x1-1,y2)-calc(x2,y1-1))%mod+mod)%mod;\n}\nsigned main(){\n\tT=read();\n\tint x1,x2,y1,y2;\n\twhile(T--){\n\t\tx1=read(),y1=read();\n\t\tx2=read(),y2=read();\n\t\tmod=mod1;int res1=solve(x1,y1,x2,y2)%mod3;\n\t\tmod=mod2;int res2=solve(x1,y1,x2,y2);\n\t\tif(res1^res2)printf(\"...%.10lld\\n\",res1);\n\t\telse printf(\"%lld\\n\",res1);\n\t}\n\treturn 0;\n}\n```\n\u7136\u800c\u4e3a\u4ec0\u4e48\u4eba\u5bb6\u90fd\u662f$8$\u79d2$9$\u79d2\uff0c\u6211\u4e00\u4e2a\u4eba$48$\u79d2\uff08\u5927\u96fe",
        "postTime": 1611665137,
        "uid": 140876,
        "name": "syzf2222",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF249E \u3010Endless Matrix\u3011"
    }
]