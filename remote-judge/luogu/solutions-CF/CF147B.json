[
    {
        "content": "\n## Solution 1\n\n\u8bbe $dp_{s,i,j}$ \u8868\u793a\u8d70\u4e86\u4e0d\u8d85\u8fc7 $s$ \u6761\u8fb9\uff0c$i \\to j$ \u7684\u6700\u957f\u8def\u5f84(\u8d70\u4e0d\u901a\u4e3a\u6781\u5c0f\u503c)\n\n\u5982\u679c\u6709 $u \\to v$ \u7684\u4e00\u6761\u8fb9\uff0c\u90a3\u4e48 $dp_{1,u,v}=w$ \uff08$w$\u4e3a\u8fd9\u6761\u8fb9\u7684\u6743\u503c\uff09\n\n\u8f6c\u79fb\u4e3a\uff1a\n$$\ndp_{s,i,j}=\\max_{1 \\le k \\le n}\\{dp_{s-1,i,k}+dp_{1,k,j}\\}\n$$\n\n\u663e\u7136\uff0c\u7b54\u6848\u4e3a\u4f7f\u5f97 $\u2203i \\in [1,n],\\ dp_{k,i,i}>0$ \u7684\u6700\u5c0f $k$\u3002 \n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^4)$\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\nusing namespace std;\n\nconst int MAXN = 300;\nint n , m , x , y , z , w , Ans;\nint dp[ MAXN + 5 ][ MAXN + 5 ][ MAXN + 5 ];\n\nint main( ) {\n    memset( dp , 0xcf , sizeof( dp ) );\n\n    scanf(\"%d %d\",&n,&m);\n    for( int i = 1 ; i <= m ; i ++ ) {\n        scanf(\"%d %d %d %d\",&x,&y,&z,&w);\n        dp[ 1 ][ x ][ y ] = z;\n        dp[ 1 ][ y ][ x ] = w;\n    }\n    for( int s = 2 ; s <= n ; s ++ ) {\n        for( int k = 1 ; k <= n ; k ++ )\n            for( int i = 1 ; i <= n ; i ++ ) {\n                for( int j = 1 ; j <= n ; j ++ )\n                    dp[ s ][ i ][ j ] = max( dp[ s ][ i ][ j ] , dp[ s - 1 ][ i ][ k ] + dp[ 1 ][ k ][ j ] );\n                if( dp[ s ][ i ][ i ] > 0 ) {\n                    Ans = s;\n                    goto there;\n                }\n            }     \n    } \n    there:;\n    printf(\"%d\",Ans);\n    return 0;\n}\n```\n\n## Solution 2\n\n\u6211\u4eec\u6709\u5fc5\u8981\u91cd\u65b0\u5b9a\u4e49\u4e00\u4e0b $dp$ \uff0c\u8bbe $dp_{s,i,j}$ \u8868\u793a\u8d70\u4e86\u4e0d\u8d85\u8fc7 $2^s$ \u6761\u8fb9\uff0c$i \\to j$ \u7684\u6700\u957f\u8def\u5f84(\u8d70\u4e0d\u901a\u4e3a\u6781\u5c0f\u503c)\u3002\n\n\u8f6c\u79fb\u4e3a\uff1a\n\n$$\ndp_{s,i,j}=\\max_{1 \\le k \\le n}\\{dp_{s-1,i,k}+dp_{s-1,k,j}\\}\n$$\n\n\u53ef\u4ee5\u4f7f\u7528\u500d\u589e $\\mathcal O(n^3 \\log_n)$ \u6c42\u5f97\u3002\n\n\u5728\u6211\u4eec\u8ba1\u7b97\u7b54\u6848\u65f6\uff0c\u6211\u4eec\u7528\u7c7b\u4f3c\u500d\u589e\u722c\u6811\u7684\u65b9\u6cd5\u3002\n\n\u5148\u4ece\u5c0f\u5230\u5927\u5c1d\u8bd5\u4e0d\u8d85\u8fc7 $2^s$ \u6761\u8fb9\u7684\u8def\u5f84\u662f\u5426\u6709\u6b63\u73af\u3002\n\n1.\u5982\u679c\u6ca1\u6709\u6b63\u73af\uff0c\u8bf4\u660e\u7b54\u6848\u5927\u4e8e$2^s$ , \u90a3\u4e48\u4e0b\u4e00\u6b65**\u589e\u52a0**$2^{s-1}$\u6761\u8fb9\n\n\u8f6c\u79fb\u65f6\u9700\u7528\u5230\u4e0a\u4e00\u6b21\u72b6\u6001\uff0c\u9700\u989d\u5916\u8bb0\u5f55\u4e0a\u4e00\u6b21\u5c1d\u8bd5 $i \\to j$ \u7684\u6700\u957f\u8def\u5f84\u3002\n\n2.\u5982\u679c\u6709\u6b63\u73af\uff0c\u8bf4\u660e\u7b54\u6848\u5c0f\u4e8e\u7b49\u4e8e$2^s$\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b65**\u5c1d\u8bd5**$2^{s-1}$\u6761\u8fb9\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6$\\mathcal O(n^3\\log_n)$\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\nusing namespace std;\n\nconst int MAXN = 300 , MAXK = 10;\nint n , m , x , y , z , w , Ans;\nint dp[ MAXK + 5 ][ MAXN + 5 ][ MAXN + 5 ];\nint tmp[ MAXN + 5 ][ MAXN + 5 ] , now[ MAXN + 5 ][ MAXN + 5 ];\n\nint main( ) {\n    memset( now , 0xcf , sizeof( now ) );\n    memset( dp , 0xcf , sizeof( dp ) );\n\n    scanf(\"%d %d\",&n,&m);\n    for( int i = 1 ; i <= m ; i ++ ) {\n        scanf(\"%d %d %d %d\",&x,&y,&z,&w);\n        dp[ 0 ][ x ][ y ] = z;\n        dp[ 0 ][ y ][ x ] = w;\n    }\n    for( int i = 1 ; i <= n ; i ++ )\n        now[ i ][ i ] = 0 , dp[ 0 ][ i ][ i ] = 0;\n    \n    for( int s = 1 ; s <= MAXK ; s ++ )\t\t//\u9884\u5904\u7406\n        for( int k = 1 ; k <= n ; k ++ )\n            for( int i = 1 ; i <= n ; i ++ )\n                for( int j = 1 ; j <= n ; j ++ )\n                    dp[ s ][ i ][ j ] = max( dp[ s ][ i ][ j ] , dp[ s - 1 ][ i ][ k ] + dp[ s - 1 ][ k ][ j ] );\n    \n    for( int s = MAXK ; s >= 0 ; s -- ) {\n        memset( tmp , 0xcf , sizeof( tmp ) );\n\n        for( int k = 1 ; k <= n ; k ++ )\t//\u8f6c\u79fb\n            for( int i = 1 ; i <= n ; i ++ )\n                for( int j = 1 ; j <= n ; j ++ )\n                    tmp[ i ][ j ] = max( tmp[ i ][ j ] , now[ i ][ k ] + dp[ s ][ k ][ j ] );\n\n        bool f = 0;\n        for( int i = 1 ; i <= n ; i ++ )\n            if( tmp[ i ][ i ] > 0 ) {\n                f = 1;\n                break;\n            }\n        if( f ) continue;\t//\u6709\u6b63\u73af\n        else {\t\t\t\t//\u65e0\u6b63\u73af\n            for( int i = 1 ; i <= n ; i ++ )\n                for( int j = 1 ; j <= n ; j ++ )\n                    now[ i ][ j ] = tmp[ i ][ j ];\n            Ans += 1 << s;\n        }\n    }\n    printf(\"%d\\n\", Ans >= n ? 0 : Ans + 1 );\n    return 0;\n}\n```\n",
        "postTime": 1566808183,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF147B \u3010Smile House\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u662f\u6211\u8003\u8bd5\u65f6\u9047\u5230\u7684\uff0c\u5f53\u65f6\u53ea\u6253\u4e86\u4e2a\u66b4\u529b\uff0c\u4e4b\u540e\u6539\u4e86\u51e0\u5929\u624d\u6539\u51fa\u6765\uff0c\n\u770b\u5230\u8fd9\u9053\u9898\u8fd8\u6ca1\u6709\u9898\u89e3\uff0c\u5c31\u81ea\u5df1\u5199\u4e00\u4e2a\uff0c\u52a0\u6df1\u7406\u89e3\uff0c\u4e5f\u6743\u5f53\u629b\u7816\u5f15\u7389\n\n#### Part1.\u90e8\u5206\u5206\u505a\u6cd5\n\u7528\u4e8e\u63d0\u4f9b\u4e00\u4e9b\u542f\u793a\n\n\u8bbef[i][j][k]\u4e3a \u6240\u6709\u4ecej\u5230k\uff0c\u7ecf\u8fc7i\u6761\u8fb9\u7684\u8def\u5f84\u4e0a\u6743\u503c\u7684\u6700\u5927\u503c\uff0c\u5f97\u51fa\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n```cpp\nf[i][j][k]=max(f[i][j][k],f[i-1][j][l]+f[1][l][k]);\n```\n\u8fb9\u754c\u6761\u4ef6\uff1a\u82e5\u5b58\u5728\u4e00\u6761\u4eceu\u5230v,\u6743\u503c\u4e3aw\u7684\u8def\u5f84\uff0c\u5219\n```cpp\nf[1][u][v]=w\n```\n\u5373\u5c06\u8fd9\u6761\u4ecej\u5230k\uff0c\u7ecf\u8fc7i\u6761\u8fb9\u7684\u8def\u5f84\uff0c\u5206\u4e3a [\u4ecej\u5230l\uff0c\u7ecf\u8fc7(i-1)\u6761\u8fb9\u7684\u8def\u5f84] \u4e0e [\u4ece\n\nl\u5230k\uff0c\u7ecf\u8fc71\u6761\u8fb9\u7684\u8def\u5f84] \u4e24\u90e8\u5206\u6c42\u89e3(\u7c7b\u4f3c\u4e8eFloyd\u7b97\u6cd5\u7684\u8f6c\u79fb)\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u82e5f[i][j][j]>0\uff0c\u5219\u5b58\u5728\u4e00\u4e2a\u5305\n\n\u542bi\u4e2a\u70b9\u7684\u73af\uff0c\u6545\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u7b2c\u4e00\u6b21\u51fa\u73b0f[i][j][j]>0\u65f6\uff0c\u5c31\u53ef\u4ee5\u786e\u5b9ai\u4e3a\u7b54\u6848\n\ncode\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint f[320][320][320];\nint main()\n{\n    int i,j,k,l,n,m;\n    ios::sync_with_stdio(0);\n    cin.tie(0);\n    cout.tie(0);\n    cin>>n>>m;\n    for(k=1;k<=n;k++)\n        for(i=1;i<=n;i++)\n            for(j=1;j<=n;j++)\n                f[k][i][j]=-1000000000;//\u521d\u59cb\u5316\n    for(i=1;i<=m;i++)\n    {\n        cin>>j>>k;\n        cin>>f[1][j][k]>>f[1][k][j];\n    }\n    for(l=2;l<=n;l++)\n        for(k=1;k<=n;k++)\n            for(i=1;i<=n;i++)\n            {\n                for(j=1;j<=n;j++)\n                    f[l][i][j]=max(f[l][i][j],f[1][i][k]+f[l-1][k][j]);//\u72b6\u6001\u8f6c\u79fb\n                if(f[l][i][i]>0)\n                {\n                    cout<<l<<\"\\n\";\n                    return 0;\n                }\n            }\n    cout<<0<<\"\\n\";\n    return 0;\n}\n```\n\u65f6\u95f4\u590d\u6742\u5ea6O(n^4)\uff0c\u8fc7\u4e0d\u4e86\n#### Part2.\u6b63\u89e3\n\u8003\u8651\u7528\u500d\u589e\u601d\u60f3\u6765\u4f18\u5316\u4e0a\u9762\u7684\u7b97\u6cd5\uff0c\u5bf9\u4e8edp[ans][i][j]\u53ef\u4ee5\u4ece\u5927\u5230\u5c0f\u679a\u4e3ek,\u6bcf\u6b21\u5c06ans\u589e\n\n\u52a02\u7684k\u6b21\u65b9\u3002\u82e5\u6b64\u65f6\u5b58\u5728dp[ans][i][i]>0\uff0c\u5219k--\uff0c\u7ee7\u7eed\u679a\u4e3e\uff1b\u82e5\u6b64\u65f6\u4e0d\u5b58\u5728\uff0c\u5219\n\nans+=k\uff1b\u8fd9\u6837\u4e00\u76f4\u4e0b\u53bb\uff0c\u6700\u540eans\u7684\u503c\u5373\u4e3a\u6240\u6c42\u7b54\u6848\u51cf\u53bb\u4e00\uff0cans++\uff0c\u8f93\u51fa\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u201c\u6bcf\u6b21\u5c06ans\u589e\u52a02\u7684k\u6b21\u65b9\u201d\u65f6\uff0c\u53ef\u4ee5\u5148\u7528\u4e0e\u4e0a\u9762\u7c7b\u4f3c\u7684\u65b9\u6cd5\u9884\u5904\u7406\u51fa\u8f85\u52a9\u6570\u7ec4f\uff0cf[i][j][k]\u8868\u793a\u4ecej\u5230k\n\n\uff0c\u7ecf\u8fc72^i\u6761\u8fb9\u7684\u8def\u5f84\u4e0a\u6743\u503c\u7684\u6700\u5927\u503c\u3002\u8fd9\u6837\u6bcf\u6b21\u5c06f[i][j][l]\u201c\u62fc\u63a5\u201d\u5230dp[ans][l][k]\u4e0a\u5373\u53ef\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n```cpp\nf[l][i][j]=max(f[l-1][i][j],f[l-1][i][k]+f[l-1][k][j]);\n```\n```cpp\ndp[ans+(1<<l)][i][j]=max(dp[ans+(1<<l)][i][j],dp[ans][i][k]+f[l][k][j]);\n```\ncode\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint f[10][320][320],dp[320][320][320];\nint main()\n{\n    int i,j,k,l,n,m,ans=1,t,maxn;\n    ios::sync_with_stdio(0);\n    cin.tie(0);\n    cout.tie(0);\n    cin>>n>>m;\n    maxn=log2(n);\n    for(k=0;k<9;k++)\n        for(i=1;i<=n;i++)\n            for(j=1;j<=n;j++)\n                dp[1][i][j]=f[k][i][j]=-1e9;//\u521d\u59cb\u5316\n    for(i=1;i<=m;i++)\n    {\n        cin>>j>>k;\n        cin>>f[0][j][k]>>f[0][k][j];//\u8f93\u5165\n        dp[1][j][k]=f[0][j][k];\n        dp[1][k][j]=f[0][k][j];\n    }\n    for(l=1;l<maxn;l++)\n        for(k=1;k<=n;k++)\n            for(i=1;i<=n;i++)\n                for(j=1;j<=n;j++)\n                    f[l][i][j]=max(f[l][i][j],f[l-1][i][k]+f[l-1][k][j]);//\u9884\u5904\u7406f\u6570\u7ec4\n    for(l=maxn;l>=0;l--)//\u500d\u589e\n    {\n    \tif(ans>=n)\n\t\t{\n\t\t\tcout<<\"0\\n\";\n\t\t\treturn 0;\n\t\t}\n    \tt=ans+(1<<l);\n    \tif(ans+(1<<l)>=n)continue;//\u8fd9\u91cc\u5f88\u91cd\u8981\n    \tfor(i=1;i<=n;i++)\n    \t\tfor(j=1;j<=n;j++)\n    \t\t\tdp[t][i][j]=-1e9;\n    \tfor(k=1;k<=n;k++)\n    \t\tfor(i=1;i<=n;i++)\n    \t\t\tfor(j=1;j<=n;j++)\n    \t\t\t\tdp[t][i][j]=max(dp[t][i][j],dp[ans][i][k]+f[l][k][j]);//\u201c\u62fc\u63a5\u201d\u6570\u7ec4\u7684\u72b6\u6001\u8f6c\u79fb\n    \tfor(i=1;i<=n;i++)\n    \t\tif(dp[t][i][i]>0)\n    \t\t\tbreak;\n    \tif(i==n+1)\n    \t\tans=t;\n    }\n    ans++;\n    cout<<ans<<\"\\n\";\n    return 0;\n}\n```\n\u65f6\u95f4\u590d\u6742\u5ea6O(n^3*log(n))\n\n~~\u77ac\u95f4AC~~\n\nAh,that's\u2642good\n\n~~\u54f2\u2642\u5b66\u5bb6\u8eab\u4efd\u66b4\u9732~~",
        "postTime": 1541585957,
        "uid": 137869,
        "name": "DDF_Van",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF147B \u3010Smile House\u3011 \u500d\u589e+floyd\u505a\u6cd5"
    },
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\uff1a[\u4f20\u9001\u95e8](https://payphone-x.top/2019/10/29/CF147B/)\n\n------------------------------\n\n## \u5206\u6790\n\n\u4e00\u9053\u770b\u8d77\u6765\u5f88\u50cf\u641c\u7d22\u7684\u52a8\u6001\u89c4\u5212\u3002~~(\u8003\u573a\u4e0a\u7206\u641c\u6253\u6302\u7684\u6211\u54ed\u51fa\u58f0\u6765)~~\n\n\u4e0d\u96be\u770b\u51fa\uff0c\u8fd9\u9898\u662f\u5728\u56fe\u4e0a\u505a\u7684\uff0c\u4e14\u8fd9\u9898\u7684\u6570\u636e\u8303\u56f4\u6781\u5c0f\u3002\u5f88\u5bb9\u6613\u5c31\u80fd\u60f3\u5230$Floyd$\u3002\n\n\u800c$Floyd$\u7684\u672c\u8d28\u662f$DP$\u3002\u8003\u8651\u5982\u4f55\u5728$Floyd$\u7684\u57fa\u7840\u4e0a$DP$\u3002\n\n\u8bbe$f[l][i][j]$\u8868\u793a\u4ece$i$\u5230$j$\u7ecf\u8fc7$l$\u6761\u8fb9\u7684\u8def\u5f84\u5927\u5c0f\uff0c\u53ef\u5f97\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n$$f[l][i][j] = max(f[l][i][j] , f[l - 1][i][k] + f[1][k][j])$$\n\n\u5176\u4e2d\uff0c$l,i,j,k$\u5747\u9700\u8981\u5728\u8f6c\u79fb\u65f6\u679a\u4e3e\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n^4)$\uff0c\u65e0\u6cd5\u901a\u8fc7$100\\%$\u7684\u6570\u636e\u3002\n\n\u8003\u8651\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a$DP$\u3002\u7531\u4e8e\u8fd9\u4e2a$DP$\u57fa\u4e8e$Floyd$\uff0c\u56e0\u6b64$i , j , k$\u5fc5\u987b\u8fdb\u884c\u679a\u4e3e\uff0c\u800c$l$\u5374\u53ef\u4ee5\u4f7f\u7528\u500d\u589e\u6765\u4f18\u5316\u3002\n\n\u5219\u6211\u4eec\u91cd\u65b0\u8bbe\u8ba1\u72b6\u6001\u3002\u8bbe$f[l][i][j]$\u8868\u793a\u4ece$i$\u5230$j$\u7ecf\u8fc7$2^l$\u6761\u8fb9\u7684\u8def\u5f84\u5927\u5c0f\uff0c\u53ef\u5f97\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n$$f[l][i][j] = max(f[l][i][j] , f[l - 1][i][k] + f[l - 1][k][j])$$\n\n\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(n^3 \\log n)$\u7684\u3002\n\n\u4e4b\u540e\u6211\u4eec\u91c7\u7528\u7c7b\u4f3c\u4e8e\u500d\u589e\u722c\u6811\u7684\u65b9\u6cd5\u6765\u6c42\u89e3\u7b54\u6848\u3002\u9996\u5148\uff0c\u6211\u4eec\u5148\u5c1d\u8bd5\u8d70$2^l$\u6761\u8fb9\u4ece$i$\u5230$j$\u7684\u8def\u5f84\u5927\u5c0f\u3002\n\n\u82e5\u4e0d\u5b58\u5728\u6b63\u73af(\u5373$f[l][i][i] < 0$)\uff0c\u5219\u8bc1\u660e\u7b54\u6848\u5927\u4e8e$2^l$\u3002\u4e0b\u4e00\u6b21\u8f6c\u79fb\u65f6**\u589e\u52a0**$2^{l - 1}$\u6761\u8fb9\u5373\u53ef\u3002\n\n\u5426\u5219\u7684\u8bdd\u8bc1\u660e\u7b54\u6848\u5c0f\u7b49\u4e8e$2^l$\uff0c\u4e0b\u4e00\u6b21\u8f6c\u79fb\u65f6\u4ec5**\u5c1d\u8bd5**$2^{l - 1}$\u6761\u8fb9\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n^3 \\log n)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u5269\u4e0b\u7684\u89c1\u4ee3\u7801\u6ce8\u91ca\u3002\n\n\n\n## Code[Accepted]\n\n```Cpp\n#include <bits/stdc++.h>\n\n#define ll long long\n#define I inline\n#define N 301\n\nusing namespace std;\n\nint n, m, ans;\nint u , v , d1 , d2;\nint f[15][N][N];\nint tmp[N][N], last[N][N];\n\nint main(){\n    memset(last, -0x3f3f3f3f, sizeof(last));\n    memset(f, -0x3f3f3f3f, sizeof(f));\n\n    cin >> n >> m;\n    for (int i = 1; i <= m; i++){\n        cin >> u >> v >> d1 >> d2;\n        f[0][u][v] = d1;\n        f[0][v][u] = d2;\n    }\n    for (int i = 1; i <= n; i++){\n        last[i][i] = 0;\n        f[0][i][i] = 0;\n    }\n\n    for (int l = 1; l <= 10; l++){\n        for (int k = 1; k <= n; k++){\n            for (int i = 1; i <= n; i++){\n                for (int j = 1; j <= n; j++){\n                    f[l][i][j] = max(f[l][i][j], f[l - 1][i][k] + f[l - 1][k][j]);\n                }\n            }\n        }\n    } \n    for (int l = 10; l >= 0; l--){\n        memset(tmp, -0x3f3f3f3f, sizeof(tmp));\n\n        for (int k = 1; k <= n; k++){\n            for (int i = 1; i <= n; i++){\n                for (int j = 1; j <= n; j++){\n                    tmp[i][j] = max(tmp[i][j], last[i][k] + f[l][k][j]);\n                }\n            } \n        }\n\n        bool flag = false;\n        for (int i = 1; i <= n; i++){\n            if (tmp[i][i] > 0){\n                flag = true;\n                break;\n            }\n        }\n\n        if (flag) continue; \n        else{ \n            for (int i = 1; i <= n; i++){\n                for (int j = 1; j <= n; j++){\n                    last[i][j] = tmp[i][j];\n                }  \n            }\n                \n            ans += 1 << l;\n        }\n    }\n    cout << (ans >= n ? 0 : ans + 1) << \"\\n\";\n    return 0;\n}\n```\n\n---------------------------------------\n\n# THE END\n",
        "postTime": 1588600540,
        "uid": 129639,
        "name": "_Album_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF147B \u3010Smile House\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\uff0c\u770b\u7740\u50cf\u56fe\u8bba\uff0c\u7b97\u6b63\u73af\uff0c\u5f53\u7136\u53ef\u4ee5\u7528floyd\uff0c\u4f46\u662f\u4f60\u8981\u6c42\u51fa\u6700\u5c0f\u7684\u6b63\u73af\uff0c\u5c31\u53ef\u4ee5\u7528dp\u505a\u6cd5\u3002\n\ndp[c][i][j]:\u8868\u793a\u8d70\u4e86\u4e0d\u8d85\u8fc7c\u6761\u8fb9\u7684i,j\u7684\u6700\u5927\u7684\u8fb9\u6743\u548c\u3002folyd*\u679a\u4e3ec    =O\uff08n^4\uff09\n\n\u770b\u5230\u8fd9\u79cd\u4e00\u6761\u4e00\u6761\u8fb9\u722c\u7684\u7b97\u6cd5\uff0c\u662f\u4e0d\u662f\u5c31\u6709\u6709\u70b9\u60f3LCA\u7684\u722c\u5c71\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u500d\u589e\u4f18\u5316;\n\nf[c][i][j]:\u8868\u793a\u8d70\u4e86\u4e0d\u8d85\u8fc72^c\u6761\u8fb9\u4ecei\u8d70\u5230\u4e86j\u7684\u6700\u5c0f\u8fb9\u6743\u548c\uff08\u9884\u5904O(logn * n^3),\u7136\u540e\u518d\u4e8c\u5206\u7b54\u6848M\uff0c\u628aM\u62c6\u6210\u4e8c\u8fdb\u5236:\u518d\u7528\u6bcf\u4e00\u4f4d\u4e0a\u7684\u5bf9\u5e94\u4f4d\u53bb\u62fc\u51d1\u7b54\u6848\uff08O(logn * n^3\uff09\uff09\uff0cdp[M][i][j]\uff0c\u5728\u5224\u65ad\u7b54\u6848\u662f\u5426\u6b63\u786e\u3002floyd*\u62fc\u51d1M*\u4e8c\u5206\u7b54\u6848 =O(n^3*logn*logn)\n\n\u8fd8\u662f\u6709\u53ef\u80fd\u8d85\u65f6\uff0c\u518d\u89c2\u5bdf\uff0c\u5728\u6b65\u6570\u589e\u5927\u7684\u540c\u65f6\uff0c\u6b63\u73af\u4f1a\u589e\u591a\uff0c\u800c\u4e0d\u4f1a\u51cf\u5c11\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u7b54\u6848M\u4e5f\u7ed9\u4e00\u8d77\u500d\u589e\u4e86\u3002\u6bd4\u5982\u8bf42^s\u6b21\u65b9\u53ef\u4ee5\u51d1\u51fa\uff0c\u90a3\u6211\u4eec\u5c31\u53bb\u5c1d\u8bd52^(s-1),\u4e0d\u884c\u5c31\u53bb\u8bd52^s+2^(s-1),\u76f4\u5230\u521a\u597d\u53ea\u5dee\u4e00\u6b65\u5c31\u6709\u6b63\u73af\u3002\n\n\u90a3\u4e48\u5c31\u6709\u70b9\u6570\u4e3a\u51d1\u51fa\u7684\u7b54\u6848\uff08\u8d70\u8fc7\u53d8\u6570\uff09\u52a01\u3002\u4f46\u5982\u679c\u8d70\u4e86n\u6b65\uff0c\u5373\u4f7f\u4e4b\u524d\u4e00\u76f4\u6ca1\u8d70\u8d70\u8fc7\u7684\u70b9\uff0c\u90a3\u4e48\u8fd9\u91cc\u5fc5\u7136\u8d70\u56de\u53bb\u4e86\uff0c\u90a3\u4e48\u5982\u679c\u70b9\u6570>n+1,\u8fb9\u6570>n\u5373\u4e3a\u8bef\u89e3\uff0c\u8f93\u51fa0\u3002\n\n\u6211\u7684\u4ee3\u7801\uff0c\u548b\u4e00\u773c\u770b\u50cf\u662f\u77e9\u9635\u52a0\u901f\uff0c\u4f46\u4ed4\u7ec6\u4e00\u770b\u5c31\u662ffloyd\u3002\u4e3b\u8981\u662f\u6211\u770b\u7684\u6807\u7a0b\u6765\u81ea[\u8fd9\u91cc](https://www.cnblogs.com/mle-world/p/11167595.html)(\u6211\u603b\u89c9\u5f97\u4f1a\u6709\u8bf4\u6284\u9898\u89e3\uff0c\u8fd8\u662f\u8d34\u5728\u8fd9\u4e86\uff0c\u4ed6\u662f\u6ca1\u6709\u89e3\u91ca\u7684)\n\ncode\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<vector>\n#include<queue>\n#include<vector>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n#define LL long long\n#define Log 10\n#define M 315\n#define Mod 12345\nconst double eps=1e-9;\nLL read() {\n    LL x=0;\n    LL f=1;\n    char c=getchar();\n    while(c<'0'||c>'9') {\n        if(c=='-')\n            f=-f;\n        c=getchar();\n    }\n    while(c>='0'&&c<='9') {\n        x=x*10+c-'0';\n        c=getchar();\n    }\n    x*=f;\n    return x;\n}\nLL n,m;\nstruct matrix{\n\tLL s[M][M];\n\tvoid inti(){\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\ts[i][j]=-0x3f3f3f3f;\n\t\treturn ;\n\t}\n\tmatrix operator *(matrix b)const{\n\t\tmatrix f;\n\t\tf.inti();\n\t\tfor(int k=1;k<=n;k++)\n\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\t\tf.s[i][j]=max(f.s[i][j],s[i][k]+b.s[k][j]);\n\t\treturn f;\n\t}\n}t[Log],now,p;\nint main(){\n\tn=read(),m=read();\n\tt[0].inti();\n\tfor(int i=1;i<=n;i++)\n\t\tt[0].s[i][i]=0;\n\tfor(int i=1;i<=m;i++){\n\t\tLL u = read(),v= read();\n\t\tt[0].s[u][v]=read();\n\t\tt[0].s[v][u]=read();\n\t}\n\tfor(int i=1;i<Log;i++)\n\t\tt[i] = t[i-1] * t[i-1];\n\tnow.inti(),p.inti();\n\tfor(int i=1;i<=n;i++)\n\t\tnow.s[i][i]=0;\n\tLL ans=0;\n\tfor(int i=Log-1;~i;i--){\n\t\tp=now * t[i];\n\t\tbool flag=0;\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tif(p.s[j][j]>0){\n\t\t\t\tflag=1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tif(flag)\n\t\t\tcontinue;\n\t\tans+=(1<<i),now=p;\t\n\t}\n\tif(ans>n)\n\t\tputs(\"0\");\n\telse\n\t\tprintf(\"%lld\",ans+1);\n}\n```\n\n\n",
        "postTime": 1566807153,
        "uid": 105090,
        "name": "wyl_AC",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF147B \u3010Smile House\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.org/problem/CF147B)\u770b\u9898\u76ee\u3002\n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u770b\u5230\u73af\u5c31\u53ef\u4ee5\u60f3\u5230$Floyd$\uff1b\u4f46\u662f\u6b64\u9898\u8981\u6c42\u4e24\u4e2a\u6700\u4f18\u2014\u2014\u8fb9\u6743\u548c\u5c3d\u91cf\u5927\uff0c\u8fb9\u6570\u5c3d\u91cf\u5c11\u3002\u4e8e\u662f\u6211\u4eec\u53ea\u80fd\u9009\u62e9\u5c06\u8fb9\u6570\u653e\u5230\u72b6\u6001\u91cc\u9762\u3002\u4fbf\u6709\u4e86\u72b6\u6001\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$DP(l,u,v)$\uff1a\u4ece$u$\u8d77\u7ecf\u8fc7\u4e0d\u8d85\u8fc7$l$\u6761\u8fb9\u5230\u8fbe$v$\u7684\u6700\u5927\u8fb9\u6743\u548c\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8f6c\u79fb\u662f$O(n^4)$\uff0c\u4f1a$T$\u7684\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9000\u800c\u6c42\u5176\u6b21\uff0c\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u500d\u589e\u3002\u8bbe$f(k,u,v)$\u8868\u793a\u4ece$u$\u8d77\u7ecf\u8fc7\u4e0d\u8d85\u8fc7$2^k$\u6761\u8fb9\u540e\u5230\u8fbe$v$\u7684\u6700\u5927\u8fb9\u6743\u548c\u3002\u5148\u7528$O(n^3log_2n)$\u9884\u5904\u7406\u51fa$f$\u6570\u7ec4\uff0c\u7136\u540e$DP$\u6570\u7ec4\u5c31\u53ef\u4ee5\u786e\u5b9a$l$\u7684\u60c5\u51b5\u4e0b\u7528$O(n^3log_2n)$\u5904\u7406\u51fa\u6765\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u53e6\u5916\uff0c\u6211\u4eec\u53d1\u73b0\u7b54\u6848\u5177\u6709\u5355\u8c03\u6027\u2014\u2014\u5982\u679c\u5728$DP(k,u,v)$\u4e2d\u5b58\u5728\u6b63\u6743\u73af\uff0c\u90a3\u4e48\u5728$DP(k+1,u,v)$\u4e2d\u4e5f\u4f1a\u5b58\u5728\u3002\u6240\u4ee5\u6211\u4eec\u4e8c\u5206\u7b54\u6848\uff0c\u7ec4\u5408\u51fa$DP$\u6570\u7ec4\u540e\u68c0\u67e5\u3002\u65f6\u95f4$O(n^3log_2^2n)$\uff0c\u867d\u7136\u5f88\u60ac\uff0c\u4f46\u662f\u80fd$A$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u8fc7\uff0c\u7b54\u6848\u4e5f\u662f\u53ef\u4ee5\u500d\u589e\u641e\u51fa\u6765\u7684\u3002\u6a21\u4eff\u500d\u589e\u8df3$LCA$\u7684\u505a\u6cd5\uff0c\u6211\u4eec\u4e0b\u964d\u5730\u6784\u9020\u7b54\u6848\u3002\u5047\u5982\u6b63\u786e\u7b54\u6848\u4e3a$ans$\uff0c\u5f53\u524d\u7684\u4e3a$r$\uff0c\u679a\u4e3e\u5230\u4e86\u4e8c\u8fdb\u5236\u4e0a\u7684\u7b2c$s$\u4f4d\u3002\u5982\u679c\u5728$r+2^s$\u7684$DP$\u91cc\u9762\u627e\u5230\u4e86\u6b63\u6743\u73af\uff0c\u5219\u6211\u4eec\u77e5\u9053$ans\\leq r+2^s$\uff0c\u53ef\u4ee5\u7ee7\u7eed\u679a\u4e3e\u7b2c$s-1$\u4f4d\uff1b\u5426\u5219\u6211\u4eec\u5728\u7b54\u6848\u4e2d\u7d2f\u52a0$2^s$\uff0c\u5e76\u4e14\u679a\u4e3e\u7b2c$s-1$\u4f4d\uff08\u6839\u636e\u4e0a\u4e00\u6b65\u7684\u63a8\u8bba\uff0c\u6211\u4eec\u77e5\u9053$r+2^s\\leq ans<r+2^{s+1}$\uff09\u3002\u6700\u540e\u5c31\u80fd\u5f97\u5230\u7b54\u6848\u3002    \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u4e8e\u662f\u6211\u8fd8\u662f\u5199\u4e86\u4e8c\u5206\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u60f3\u770b\u500d\u589e\u5c31\u8bf7\u79fb\u6b65\u697c\u4e0a\uff08\u697c\u4e0b\uff1f\uff09~~\n# \u4ee3\u7801\n```cpp\n#include <cmath>\n#include <cstdio>\n\nconst int MAXN = 305, MAXLOG = 10, INF = 0x3f3f3f3f, inf = 0x3f3f3f3f;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n    x = 0;char s = getchar();int f = 1;\n    while( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n    while( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n    x *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n    if( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n    if( 9 < x ){ write( x / 10 ); }\n    putchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MIN( const _T a, const _T b )\n{\n\treturn a < b ? a : b;\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n\treturn a > b ? a : b;\n}\n\nint dis[MAXLOG][MAXN][MAXN], DP[2][MAXN][MAXN];\nint N, M, lg2;\n\nbool chk( const int len )\n{\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\tDP[0][i][j] = i == j ? 0 : -INF;\n\tint now = 0;\n\tfor( int t = 0 ; ( 1 << t ) <= len ; t ++ )\n\t{\n\t\tif( len & ( 1 << t ) )\n\t\t{\n\t\t\tnow ^= 1;\n\t\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\t\tfor( int j = 1 ; j <= N ; j ++ ) DP[now][i][j] = -INF;\n\t\t\tfor( int k = 1 ; k <= N ; k ++ )\n\t\t\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\t\t\tDP[now][i][j] = MAX( DP[now][i][j], DP[now ^ 1][i][k] + dis[t][k][j] );\n\t\t}\n\t}\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t\tif( DP[now][i][i] > 0 ) return true;\n\treturn false;\n}\n\nint main()\n{\n\tint fr, to, w1, w2;\n\tread( N ), read( M );\n\tlg2 = log2 ( N );\n\tfor( int k = 0 ; k <= lg2 ; k ++ )\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\tdis[k][i][j] = i == j ? 0 : -INF;\n\tfor( int i = 1 ; i <= M ; i ++ )\n\t{\n\t\tread( fr ), read( to );\n\t\tread( w1 ), read( w2 );\n\t    dis[0][fr][to] = w1, dis[0][to][fr] = w2;\n\t}\n\tfor( int t = 1 ; t <= lg2 ; t ++ )\n\t\tfor( int k = 1 ; k <= N ; k ++ )\n\t\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\t\tdis[t][i][j] = MAX( dis[t - 1][i][k] + dis[t - 1][k][j], dis[t][i][j] );\n\tint l = 2, r = N + 1, mid;\n\twhile( r > l )\n\t{\n\t\tmid = ( l + r ) >> 1;\n\t\tif( chk( mid ) ) r = mid;\n\t\telse l = mid + 1;\n\t}\n\twrite( l % ( N + 1 ) ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1566735002,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[CF147B]Smile House"
    }
]