[
    {
        "content": "### \u6e29\u99a8\u63d0\u9192:\u5230[$QAQ$\u4e16\u754c](https://www.cnblogs.com/Garbage-Only-one/p/11141878.html)\u98df\u7528\u66f4\u4f73\n\n\u7adf\u7136\u6ca1\u4eba\u5199\u9898\u89e3?\u6211\u6765\u6c34\u4e00\u7bc7\uff5e\uff5e\n\n\u5176\u5b9e\u611f\u89c9\u5e94\u8be5\u662f$\\colorbox{#3bb4f2}{\\color{white}\\text{\u63d0\u9ad8+/\u7701\u9009-}}$\u7684\u6837\u5b50,233\u3002\n\n~~\u5176\u5b9e\u6211\u6ca1\u5495\u503c\u5b50~~\n\n\u5148\u8bf4\u8bf4\u601d\u8def:\n\n1. \u7ef4\u62a4\u4e00\u4e2a[l,r]\u533a\u95f4\u4e2d\u56db\u4e2a\u89d2\u76f8\u4e92\u4e4b\u95f4\u7684\u6700\u77ed\u8def\n1. \u67e5\u8be2\u65f6\u7528\u4e8c\u5206\n\n\u601d\u8def\u51fa\u6765\u4e86,\u7b97\u6cd5\u4e5f\u5c31\u51fa\u6765\u4e86,\u90a3\u5c31\u662f\u2014\u2014**\u7ebf\u6bb5\u6811**!\n\n~~\u6b64\u5904\u5e94\u6709\u638c\u58f0~~\n\n\u9996\u5148,\u6211\u4eec\u77e5\u9053\u7ebf\u6bb5\u6811\u662f\u4e8c\u5206\u7ef4\u62a4\u533a\u95f4\u503c\u7684\u3002\n\n\u7136\u540e,\u6211\u4eec\u4e5f\u77e5\u9053\u7ebf\u6bb5\u6811\u662f\u4e8c\u5206\u67e5\u627e\u503c\u3002\n\n\u6700\u540e,\u6211\u4eec\u53d1\u73b0\u8fd9\u9053\u9898\u6ca1\u6709\u4fee\u6539\u3002\n\n\u7d27\u63a5\u7740,\u6211\u4eec\u5f00\u59cb\u5199\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint mmp[3][200001];\n#define INF 500000000\nint n;\nint ans;\nchar c[300001];\nstruct data{\n\tint d1,d2,d3,d4;\t\t\t//\u56db\u4e2a\u6700\u77ed\u8def\n};\nstruct tree{\n    int l, r;\n    data d;\n}t[4*200001];\t\t\t\t\t//\u7ebf\u6bb5\u6811\u6807\u51c6\u7ed3\u6784\u4f53\ndata merge(data a,data b)\t\t//\u5408\u5e76\u6700\u77ed\u8def\n{\n    data s;\n    s.d1=min(INF,min(a.d1+b.d1,a.d2+b.d3)+1);\n    s.d2=min(INF,min(a.d1+b.d2,a.d2+b.d4)+1);\n    s.d3=min(INF,min(a.d3+b.d1,a.d4+b.d3)+1);\n    s.d4=min(INF,min(a.d3+b.d2,a.d4+b.d4)+1);\n    return s;\n}\nvoid init(int s,int l,int r)\t//\u6807\u51c6\u7ebf\u6bb5\u6811\u6784\u5efa\n{\n    t[s].l=l,t[s].r=r;\n    if(l==r){\n        t[s].d.d1=t[s].d.d2=t[s].d.d3=t[s].d.d4=INF;\n        if(mmp[1][l]) t[s].d.d1=0;\n        if(mmp[2][l]) t[s].d.d4=0;\n        if(mmp[1][l]&&mmp[2][l]) t[s].d.d2=t[s].d.d3=1;\n        return ;\n    }\n    int m=(l+r)/2;\n    init(2*s,l,m);\n    init(2*s+1,m+1,r);\n    t[s].d=merge(t[2*s].d,t[2*s+1].d);\n}\ndata q(int s,int x,int y)\t\t//\u67e5\u8be2\u65f6\u7684\u5408\u5e76\n{\n    int l=t[s].l,r=t[s].r;\n    if(x==l&&y==r) return t[s].d;\n    int m=(l+r)/2;\n    /*\u4e0b\u9762\u5206\u7c7b\u8ba8\u8bba\u4e0d\u7528\u8bb2\u4e86\u5427*/\n    if(m>=y) return q(2*s,x,y);\t\t\t//\u6bd2\u7624\u5440,\u5c11\u5199return\n    else if(m<x) return q(2*s+1,x,y);\t//\u6bd2\u7624\u5440,\u5c11\u5199return\n    else\n        return merge(q(2*s,x,m),q(2*s+1,m+1,y));\n}\nvoid ask(int x,int y)\t\t\t//\u67e5\u8be2\u6700\u77ed\u8def\n{\n    int a=(x-1)%n+1,b=(y-1)%n+1;\n    if(a>b){\n        swap(x,y);\n        swap(a,b);\n    }\n    data s=q(1,a,b);\t\t\t//\u627e\u5230\u6700\u77ed\u8def\n    /*\u6839\u636e\u60c5\u51b5\u8fd4\u56de\u56db\u79cd\u8def\u5f84\u7684\u6700\u77ed\u8def*/\n    if(x<=n&&y<=n) ans=s.d1;\n    if(x<=n&&y>n) ans=s.d2;\n    if(x>n&&y<=n) ans=s.d3;\n    if(x>n&&y>n) ans=s.d4;\n}\nint main()\t\t\t\t\t\t//\u8bf7\u4ece\u8fd9\u91cc\u5f00\u59cb\u9605\u8bfb,\u8fd9\u662f\u4e00\u4e2a\u597d\u4e60\u60ef\n{\n    int m;\n    cin>>n>>m;\n    int i,j;\n    for(i=1;i<=2;i++)\t\t\t//\u65e0\u8111O(2n)\u8bfb\u5165\n    {\n    \tscanf(\"%s\",c);\n    \tfor(j=1;j<=n;j++)\n    \t   if(c[j-1]=='.') mmp[i][j]=1;\n    }\n    init(1,1,n);\n    int x,y;\n    for(i=1;i<=m;i++){\t\t\t//\u65e0\u8111\u67e5\u8be2\n        cin>>x>>y;\n        ask(x,y);\n        if(ans<INF) cout<<ans<<endl;\n        else cout<<\"-1\\n\";\n    }\n\treturn (0-0);\t\t\t\t//\u65e0\u8111\u5356\u840cQAQ\n}\n```\n\n**\u5343\u4e07\u8bb0\u5f97\u6240\u6709\u67e5\u8be2\u90fd\u8981`return`!**\n\n~~\u4e3a\u6ca1\u6709\u51fa\u4fee\u6539\u9898\u7684\u51fa\u9898\u4eba\u559d\u5f69!!!~~",
        "postTime": 1562380964,
        "uid": 85933,
        "name": "\u26a1GG\u26a1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF413E \u3010Maze 2D\u3011"
    },
    {
        "content": "<https://www.luogu.com.cn/problem/CF413E>\n\n\u7ffb\u8bd1\u662f\u6211\u7ed9\u7684\uff08\u9003\n\n# Solution\n\n\u7ebf\u6bb5\u6811\u3002\n\n[\u8fd9\u9898](https://www.luogu.com.cn/problem/P4246) \u7684\u7b80\u5316\u7248\u3002\n\n\u7ebf\u6bb5\u6811\u5185\u7ef4\u62a4\u56db\u4e2a\u503c\uff1a\u6bcf\u6bb5\u533a\u95f4\u5de6\u4e0a\u5230\u53f3\u4e0a\uff0c\u5de6\u4e0a\u5230\u53f3\u4e0b\uff0c\u5de6\u4e0b\u5230\u53f3\u4e0a\uff0c\u5de6\u4e0b\u5230\u53f3\u4e0b\u7684\u6700\u77ed\u8def\uff1a\n\n```cpp\nstruct Node\n{\n\tint uu,ud,du,dd;\n};\n```\n\n\u753b\u4e2a\u56fe\u5c31\u80fd\u5f97\u51fa `pushUp`\uff1a\n\n![](https://i.loli.net/2020/05/17/o2HOdPF5fV8ep4Q.png)\n\n```cpp\n#define CN const Node\n\ninline Node pushUp(CN& x,CN& y)\n{\n\tNode res;\n\tres.uu=std::min(inf,std::min(x.uu+y.uu,x.ud+y.du)+1);\n\tres.ud=std::min(inf,std::min(x.uu+y.ud,x.ud+y.dd)+1);\n\tres.du=std::min(inf,std::min(x.dd+y.du,x.du+y.uu)+1);\n\tres.dd=std::min(inf,std::min(x.dd+y.dd,x.du+y.ud)+1);\n\treturn res;\n}\n```\n\n\u67e5\u8be2\u7684\u65f6\u5019\u5206\u7c7b\u8ba8\u8bba\u5224\u4e00\u5224\u5c31\u884c\u4e86\u3002\n\n\u5177\u4f53\u7ec6\u8282\u89c1\u4ee3\u7801\u6ce8\u91ca\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n# Code\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n\n#define CN const Node\n\nconst int N=2e5;\nconst int inf=0x3f3f3f3f;\n\nstruct Node\n{\n\tint uu,ud,du,dd;\n};\n\nNode t[(N<<2)+10];\nint n,m;\nchar s[N+10][2],tmp[N+10];\n\n#define ls(x) (x<<1)\n#define rs(x) (x<<1|1)\n\ninline Node pushUp(CN& x,CN& y)\n{\n\tNode res;\n\tres.uu=std::min(inf,std::min(x.uu+y.uu,x.ud+y.du)+1);\n\tres.ud=std::min(inf,std::min(x.uu+y.ud,x.ud+y.dd)+1);\n\tres.du=std::min(inf,std::min(x.dd+y.du,x.du+y.uu)+1);\n\tres.dd=std::min(inf,std::min(x.dd+y.dd,x.du+y.ud)+1);\n\treturn res;\n}\n\nvoid build(int i,int l,int r)\n{\n\tif(l==r) // l = r \u65f6\uff0c\u5c31\u662f\u4e00\u4e2a 2 \u00d7 1 \u7684\u683c\u5b50\n\t{\n\t\tt[i].uu=t[i].ud=t[i].du=t[i].dd=inf; // inf \u8868\u793a\u4e0d\u80fd\u8d70\n\t\tif(s[l][0]=='.')t[i].uu=0;\n\t\tif(s[l][1]=='.')t[i].dd=0;\n\t\tif(s[l][0]=='.'&&s[l][1]=='.')t[i].ud=t[i].du=1;\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tbuild(ls(i),l,mid);\n\tbuild(rs(i),mid+1,r);\n\tt[i]=pushUp(t[ls(i)],t[rs(i)]);\n}\n\nNode query(int i,int l,int r,int ql,int qr)\n{\n\tif(ql<=l&&r<=qr)return t[i];\n\tint mid=(l+r)>>1;\n\tif(qr<=mid)return query(ls(i),l,mid,ql,qr);\n\tif(ql>mid) return query(rs(i),mid+1,r,ql,qr);\n\treturn pushUp(query(ls(i),l,mid,ql,qr),query(rs(i),mid+1,r,ql,qr));\n}\n\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=0;i<=1;i++)\n\t{\n\t\tscanf(\"%s\",tmp+1);\n\t\tfor(int j=1;j<=n;j++)\n\t\t\ts[j][i]=tmp[j];\n\t}\n\tbuild(1,1,n);\n\twhile(m--)\n\t{\n\t\tint u,v,a,b;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\ta=u,b=v;\n\t\tif(a>n)a-=n; // \u627e\u5230 u \u5b9e\u9645\u4f4d\u4e8e\u54ea\u4e00\u5217\n\t\tif(b>n)b-=n; // \u540c\u7406\n\t\tif(a>b)std::swap(a,b),std::swap(u,v);\n\t\tNode res=query(1,1,n,a,b);\n\t\tint ans;\n\t\tif(u<=n&&v<=n)ans=res.uu; // u \u5728\u7b2c\u4e00\u884c\uff0cv \u5728\u7b2c\u4e00\u884c\n\t\tif(u<=n&&v>n) ans=res.ud; // u \u5728\u7b2c\u4e00\u884c\uff0cv \u5728\u7b2c\u4e8c\u884c\n\t\tif(u>n&&v<=n) ans=res.du; // u \u5728\u7b2c\u4e8c\u884c\uff0cv \u5728\u7b2c\u4e00\u884c\n\t\tif(u>n&&v>n)  ans=res.dd; // u \u5728\u7b2c\u4e8c\u884c\uff0cv \u5728\u7b2c\u4e8c\u884c\n\t\tprintf(\"%d\\n\",ans<inf?ans:-1);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1591403257,
        "uid": 242702,
        "name": "registerGen",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF413E \u3010Maze 2D\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\n\u5c45\u7136\u53ea\u6709\u4e00\u7bc7\u9898\u89e3\u8fd8\u662f\u6211\u540c\u5b66\u7684\n\n~~\u8d76\u7d27\u6c34\u4e00\u6ce2~~\n\n## \u9700\u8981\u77e5\u8bc6\n\n[\u7ebf\u6bb5\u6811](https://pks-loving.blog.luogu.org/senior-data-structure-qian-tan-xian-duan-shu-segment-tree)\n## \u601d\u8def\n\n~~\u4e4d\u4e00\u770b\u5c45\u7136\u60f3\u5230\u4e86\u5e76\u67e5\u96c6~~\n\n\u4e0d\u8fc7\u8fd8\u662f\u8981\u8d70\u6b63\u5e38\u89e3\u6cd5\u3002\n\n\u521d\u770b\u9898\u76ee\uff0c\u7528\u7ebf\u6bb5\u6811\u505a\u597d\u50cf\u505a\u4e0d\u51fa\u3002\n\n\u4ed4\u7ec6\u5206\u6790\u4e00\u4e0b\u65e0\u975e\u5c31\u662f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u56db\u4e2a\u9876\u70b9\u7684\u8ddd\u79bb\n\n\u6ca1\u770b\u61c2\u7684\u540c\u5b66\uff0c\u6211\u6765\u5206\u6790\u4e00\u6ce2\u3002\n\n\u8bbe\u77e9\u9635\u7684\u5de6\u4e0a\u89d2\u4e3aL1\u5de6\u4e0b\u89d2\u4e3aL2\u53f3\u4e0b\u89d2\u4e3aR2\u53f3\u4e0a\u89d2\u4e3aR1\n\n\u8bbe\n\nL1 TO R1 \u4e3ad1\n\nL2 TO R2\u4e3ad2\n\nL1 TO R2\u4e3ad3\n\nL2 TO R1\u4e3ad4\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u7ebf\u6bb5\u6811\u7ef4\u62a4d1,d2,d3,d4\u4fbf\u53ef\n```cpp\nstruct node {\n    int d1,d2,d3,d4;\n}a[800001];\n```\n\n\u7136\u540e\u6211\u4eec\u601d\u8003\u5982\u4f55\u5408\u5e76\n\n\u8bbe\u5408\u5e76\u7684\u4e24\u4e2a\u77e9\u9635\u4e3aAB\uff0c\u5408\u5e76\u540e\u5f97\u5230C\u7531\u6b64\u53ef\u5f97\n\n```cpp\nc.d1=std::min(inf,std::min(a.d1+b.d1,a.d3+b.d4)+1);\nc.d2=std::min(inf,std::min(a.d2+b.d2,a.d4+b.d3)+1);\nc.d3=std::min(inf,std::min(a.d3+b.d2,a.d1+b.d3)+1);\nc.d4=std::min(inf,std::min(a.d4+b.d1,a.d2+b.d4)+1);\n```\n\u6ca1\u61c2\u7684\u540c\u5b66\u53ef\u4ee5\u624b\u753b\u4e00\u4e0b\u56fe\n\n\u5c31\u6b64\u53ef\u5f97\u51fa\u7684\u4ee3\u7801\n\n\n## \u4ee3\u7801\n\u4e2a\u4eba\u7801\u98ce\u4e0d\u592a\u597d\u8bf7\u89c1\u8c05\uff01\n```cpp\n#include <bits/stdc++.h>\n#define inf 500000000\nstruct node\n{\n    int d1,d2,d3,d4;\n}a[800001];\nbool map[3][200001];\nnode add(node a,node b)\n{\n    node c;\n    c.d1=std::min(inf,std::min(a.d1+b.d1,a.d3+b.d4)+1);\n    c.d2=std::min(inf,std::min(a.d2+b.d2,a.d4+b.d3)+1);\n    c.d3=std::min(inf,std::min(a.d3+b.d2,a.d1+b.d3)+1);\n    c.d4=std::min(inf,std::min(a.d4+b.d1,a.d2+b.d4)+1);\n    return c;\n}\nvoid build(int l,int r,int k)\n{\n    if(l==r)\n    {\n        a[k].d1=a[k].d2=a[k].d3=a[k].d4=inf;\n        if(map[1][l]) a[k].d1=0;\n        if(map[2][l]) a[k].d2=0;\n        if(map[1][l]&&map[2][l]) a[k].d3=a[k].d4=1;\n        return;\n    }\n    int mid=(l+r)/2;\n    build(l,mid,k*2);\n    build(mid+1,r,k*2+1);\n    a[k]=add(a[k*2],a[k*2+1]);\n    return;\n}\nnode get(int L,int R,int l,int r,int k)\n{\n    if(L<=l&&R>=r)\n        return a[k];\n    int mid=(l+r)/2;\n    node b,c;\n    bool q1=0,q2=0;\n    if(L<=mid) q1=1,b=get(L,R,l,mid,k*2);\n    if(R>mid) q2=1,c=get(L,R,mid+1,r,k*2+1);\n    if(q1&&!q2) return b;\n    if(!q1&&q2) return c;\n    if(q1&&q2) return add(b,c);\n}\nint main()\n{\n    int i,n,m,j,ans;\n    char p;\n    int xa,xb,ya,yb;\n    node k;\n    scanf(\"%d%d\",&n,&m);\n    for(i=1;i<=2;i++)\n        for(j=1;j<=n;j++)\n        {\n            std::cin>>p;\n            if(p=='.') map[i][j]=1;\n        }\n    build(1,n,1);\n    for(i=1;i<=m;i++)\n    {\n        xa=1;xb=1;\n        scanf(\"%d%d\",&ya,&yb);\n        if(ya>n) {ya-=n;xa=2;}\n        if(yb>n) {yb-=n;xb=2;}\n        if(ya>yb) {std::swap(xa,xb);std::swap(ya,yb);}\n        k=get(ya,yb,1,n,1);\n        if(xa==xb&&xa==1) ans=k.d1;\n        else if(xa==xb&&xa==2) ans=k.d2;\n        else if(xa>xb) ans=k.d4;\n        else ans=k.d3;\n        if(ans<inf) printf(\"%d\\n\",ans);\n        else printf(\"-1\\n\");\n    }\n    return 0;\n}\n```",
        "postTime": 1563021812,
        "uid": 86266,
        "name": "AFOer_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF413E \u3010Maze 2D\u3011"
    },
    {
        "content": "### $\\text{Difficulty : 2200}$\n---\n### \u89e3\u9898\u601d\u8def\uff1a\n\n\u672c\u8d28\u4e0a\u6765\u8bb2\u662f\u6c42\u4e00\u4e2a $n\\times 2$ \u533a\u95f4\u4e0a\u6c42\u4e00\u4e2a\u56db\u4e2a\u7aef\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\u8fd9\u4e2a\u4fe1\u606f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u62c6\u6210\u82e5\u5e72\u4e2a\u90e8\u5206\u8fdb\u884c\u5408\u5e76\uff0c\u8003\u8651\u4f7f\u7528\u7ebf\u6bb5\u6811\u3002\n\n\u7ebf\u6bb5\u6811\u4e0a\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u8bb0\u5f55\u4e0b\u5f53\u524d\u7684 $n\\times 2$ \u7684\u533a\u95f4\u4e0a\u5de6\u4e0a\u89d2\uff0c\u5de6\u4e0b\u89d2\u5206\u522b\u5230\u53f3\u4e0a\u89d2\uff0c\u53f3\u4e0b\u89d2\u7684\u8ddd\u79bb\u3002\u6bcf\u4e00\u6b21\u5408\u5e76\u7684\u65f6\u5019\uff0c\u8003\u8651\u5de6\u533a\u95f4\u5230\u4e2d\u95f4\u7684\u67d0\u4e00\u4e2a\u4f4d\u7f6e\u8fdb\u884c\u4e2d\u8f6c\u4e4b\u540e\u518d\u5230\u53f3\u533a\u95f4\uff0c\u4e00\u5171\u6709\u4e24\u79cd\u4e2d\u8f6c\u65b9\u5f0f\uff0c\u90fd\u8003\u8651\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u9884\u5904\u7406\u7684\u65f6\u5019\u6839\u636e\u4f4d\u7f6e\u662f\u5426\u53ef\u8d70\u51b3\u5b9a\u4e00\u4e2a $1\\times 2$ \u533a\u95f4\u4e0a\u7684\u4fe1\u606f\u5373\u53ef\u3002\n\n---\n### \u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\nconst int MAXN=200005,INF=1e9;\nstruct str{\n\tint d13,d14,d23,d24;\n//\t1 3\n//\t2 4\n}t[MAXN<<2];\nint n,q,m1[MAXN],m2[MAXN],x,y;\nchar c;\nint MIN(int a,int b){return min(INF,min(a,b));}\nstr merge(str a,str b){//a-b\n\tstr c={0};\n\tc.d13=MIN(a.d13+b.d13+1,a.d14+b.d23+1);\n\tc.d14=MIN(a.d13+b.d14+1,a.d14+b.d24+1);\n\tc.d23=MIN(a.d23+b.d13+1,a.d24+b.d23+1);\n\tc.d24=MIN(a.d23+b.d14+1,a.d24+b.d24+1);\n\treturn c;\n}\nvoid build(int p,int l,int r){\n\tif(l==r){\n\t\tt[p].d13=0;t[p].d24=0;\n\t\tt[p].d14=1;t[p].d23=1;\n\t\tif(m1[l]==1)t[p].d13=t[p].d14=t[p].d23=INF;\n\t\tif(m2[l]==1)t[p].d24=t[p].d14=t[p].d23=INF;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tbuild(p<<1,l,mid);\n\tbuild(p<<1|1,mid+1,r);\n\tt[p]=merge(t[p<<1],t[p<<1|1]);\n\treturn;\n}\nstr query(int p,int l,int r,int L,int R){\n\tif(L<=l&&r<=R)return t[p];\n\tint mid=(l+r)>>1;\n\tif(R<=mid)return query(p<<1,l,mid,L,R);\n\tif(L>mid)return query(p<<1|1,mid+1,r,L,R);\n\treturn merge(query(p<<1,l,mid,L,R),query(p<<1|1,mid+1,r,L,R));\n}\nchar get(){\n\tchar c=getchar();\n\twhile(c==' '||c=='\\r'||c=='\\n')c=getchar();\n\treturn c;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&q);\n\tfor(int i=1;i<=n;i++){c=get();if(c=='.')m1[i]=0;else m1[i]=1;}\n\tfor(int i=1;i<=n;i++){c=get();if(c=='.')m2[i]=0;else m2[i]=1;}\n\tbuild(1,1,n);\n\tfor(int i=1;i<=q;i++){\n\t\tscanf(\"%d %d\",&x,&y);\n\t\tif((x-1)%n+1>(y-1)%n+1)swap(x,y);\n\t\tstr ans=query(1,1,n,(x-1)%n+1,(y-1)%n+1);\n\t\tif(x>n&&y>n)printf(\"%d\\n\",ans.d24==INF?-1:ans.d24);\n\t\tif(x<=n&&y<=n)printf(\"%d\\n\",ans.d13==INF?-1:ans.d13);\n\t\tif(x>n&&y<=n)printf(\"%d\\n\",ans.d23==INF?-1:ans.d23);\n\t\tif(x<=n&&y>n)printf(\"%d\\n\",ans.d14==INF?-1:ans.d14);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1656830571,
        "uid": 223559,
        "name": "qxp101",
        "ccfLevel": 6,
        "title": "CF413E Maze 2D \u9898\u89e3"
    },
    {
        "content": "\u89c2\u5bdf\u5230\u8fd9\u9898\u5e76\u6ca1\u6709\u4fee\u6539\u64cd\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u597d\u5199\u597d\u60f3\u7684\u500d\u589e\u7b97\u6cd5\u4ee3\u66ff\u7ebf\u6bb5\u6811\u3002\n\n\u5b9a\u4e49 $f[0/1][i][j]$ \u8868\u793a\u4ece\u7b2c $0/1$ \u884c\u7684\u7b2c $i$ \u5217\u5f00\u59cb\uff0c\u5411\u53f3\u79fb\u52a8 $2^j$ \u5217\u6240\u82b1\u8d39\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u5b9a\u4e49 $g[0/1][i][j]$ \u8868\u793a\u4ece\u7b2c $0/1$ \u884c\u7684\u7b2c $i$ \u5217\u5f00\u59cb\uff0c\u5411\u53f3\u79fb\u52a8 $2^j$ \u5217\u5230\u8fbe\u7684\u6700\u7ec8\u4f4d\u7f6e\u662f\u54ea\u4e00\u884c\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u500d\u589e\u4f18\u5316\u3002\n\n$$f[0/1][i][j]=f[0/1][i][j-1]+f[g[0/1][i][j-1]][i+2^{j-1}][j-1]$$\n$$g[0/1][i][j]=g[g[0/1][i][j-1]][i+2^{j-1}][j-1]$$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 $\\log N$ \u7684\u65f6\u95f4\u5185\u56de\u7b54\u8be2\u95ee\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 200005\nusing namespace std;\nint n,m,f[2][N][18],g[2][N][18],t,op[N];char s[2][N];\ninline int calc(int x,int y){if(!x||!y)return 0;return x+y;}\nint main(){\n\n\tscanf(\"%d%d\",&n,&m);t=log2(n);\n\tscanf(\"%s%s\",s[0]+1,s[1]+1);\n\trep(i,1,n){\n\t\tif(s[0][i]=='X'&&s[1][i]=='X')op[i]=-1;\n\t\telse if(s[0][i]=='X')op[i]=0;\n\t\telse if(s[1][i]=='X')op[i]=1;\n\t\telse op[i]=2;\n\t}\n\trep(i,1,n-1)if(~op[i]&&~op[i+1]&&(op[i]+op[i+1])!=1){\n\t\trep(j,0,1)if(op[i]!=j){\n\t\t\tif(op[i+1]!=j)f[j][i][0]=1,g[j][i][0]=j;\n\t\t\telse f[j][i][0]=2,g[j][i][0]=j^1;\n\t\t}\n\t}\n\trep(j,1,t)rep(i,1,n-(1<<j)){\n\t\tf[0][i][j]=calc(f[0][i][j-1],f[g[0][i][j-1]][i+(1<<(j-1))][j-1]);\n\t\tg[0][i][j]=g[g[0][i][j-1]][i+(1<<(j-1))][j-1];\n\t\tf[1][i][j]=calc(f[1][i][j-1],f[g[1][i][j-1]][i+(1<<(j-1))][j-1]);\n\t\tg[1][i][j]=g[g[1][i][j-1]][i+(1<<(j-1))][j-1];\n\t}\n\trep(i,1,m){\n\t\tint x,y;scanf(\"%d%d\",&x,&y);\n\t\tint u=(x-1)/n,v=(y-1)/n;\n\t\tif(x>n)x-=n;if(y>n)y-=n;\n\t\tif(x>y)swap(x,y),swap(u,v);\n\t\tint ans=1,res=y-x,cur=u;\n\t\tpre(j,t,0)if((res>>j)&1){\n\t\t\tans=calc(ans,f[cur][x][j]);\n\t\t\tcur=g[cur][x][j];x+=1<<j;\n\t\t}\n\t\tif(!ans){puts(\"-1\");continue;}\n\t\tprintf(\"%d\\n\",ans-1+(cur!=v));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1617876739,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "CF413E Maze 2D \u9898\u89e3"
    }
]