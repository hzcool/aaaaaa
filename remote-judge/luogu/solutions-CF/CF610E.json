[
    {
        "content": "\u5355\u6b21\u8be2\u95ee\uff1a\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u8d2a\u5fc3\uff1a\u5982\u679c\u4e24\u4e2a\u6328\u5728\u4e00\u8d77\u7684\u5b57\u7b26\uff0c\u4ed6\u4eec\u7684\u987a\u5e8f\u4e0e\u5728\u6a21\u677f\u4e32\u91cc\u7684\u987a\u5e8f\u662f\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u5fc5\u7136\u628a\u5b83\u653e\u5728\u540c\u4e00\u4e2a\u5faa\u73af\u8282\u91cc\uff0c\u5426\u5219\u5c31\u4f1a\u4f7f\u7b54\u6848\u589e\u52a0\u4e00\u3002\u8fd9\u4e2a\u505a\u6cd5\u7684\u6b63\u786e\u6027\u663e\u7136\u3002\n\n\u65e0\u4fee\u6539\uff1a\u6bcf\u6b21\u904d\u5386\u4e00\u904d\u6587\u672c\u4e32\u975e\u5e38\u5403\u4e8f\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u6bcf\u4e00\u5bf9\u5b57\u7b26\u8ba1\u7b97\u8d21\u732e\u3002\u9884\u5904\u7406\u51fa\u6bcf\u4e24\u4e2a\u5b57\u7b26\u5728\u6587\u672c\u4e32\u4e2d\u4e00\u524d\u4e00\u540e\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u5e73\u65b9\u679a\u4e3e\u6a21\u677f\u4e32\u4e2d\u7684\u5b57\u7b26\u5bf9\u5e76\u8ba1\u7b97\u8d21\u732e\u3002\n\n\u539f\u9898\uff1a\u6211\u4eec\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e0a\u4e00\u4e2a\u505a\u6cd5\u4e2d\u6240\u63d0\u5230\u7684\u6570\u7ec4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(k^2n+k^2m\\log n)$\uff0c\u6ce8\u610f\u672c\u9898\u4e2d $n$ \u4e0e $m$ \u5e76\u4e0d\u540c\u9636\u3002\n```cpp\n#include<cstring>\n#include<cctype>\n#include<cstdio>\nusing namespace std;\ninline int readint(){\n\tint x=0;\n\tbool f=0;\n\tchar c=getchar();\n\twhile(!isdigit(c)&&c!='-') c=getchar();\n\tif(c=='-'){\n\t\tf=1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst int maxn=2e5+5,maxk=10+5;\nint n,m,k;\nchar s[maxn],t[maxk];\nstruct node{\n\tint l,r;\n\tnode* ch[2];\n\tint lv,rv,cnt[maxk][maxk],setv;\n\tvoid pushup(){\n\t\tlv=ch[0]->lv;\n\t\trv=ch[1]->rv;\n\t\tfor(int i=0;i<k;i++) for(int j=0;j<k;j++)\n\t\t\tcnt[i][j]=ch[0]->cnt[i][j]+ch[1]->cnt[i][j];\n\t\tcnt[ch[0]->rv][ch[1]->lv]++;\n\t}\n\tnode(int l,int r):l(l),r(r),setv(-1){\n\t\tif(l<r){\n\t\t\tint mid=l+(r-l)/2;\n\t\t\tch[0]=new node(l,mid);\n\t\t\tch[1]=new node(mid+1,r);\n\t\t\tpushup();\n\t\t}\n\t\telse{\n\t\t\tlv=rv=s[r]-'a';\n\t\t\tmemset(cnt,0,sizeof(cnt));\n\t\t}\n\t}\n\tvoid pushtag(int k){\n\t\tsetv=k;\n\t\tlv=rv=k;\n\t\tmemset(cnt,0,sizeof(cnt));\n\t\tcnt[k][k]=r-l;\n\t}\n\tvoid pushdown(){\n\t\tif(setv>=0){\n\t\t\tch[0]->pushtag(setv);\n\t\t\tch[1]->pushtag(setv);\n\t\t\tsetv=-1;\n\t\t}\n\t}\n\tvoid modify(int ql,int qr,int k){\n\t\tif(ql<=l&&qr>=r) pushtag(k);\n\t\telse{\n\t\t\tpushdown();\n\t\t\tif(ql<=ch[0]->r) ch[0]->modify(ql,qr,k);\n\t\t\tif(qr>=ch[1]->l) ch[1]->modify(ql,qr,k);\n\t\t\tpushup();\n\t\t}\n\t}\n}*rt;\ninline char readchar(){\n\tchar c=getchar();\n\twhile(isspace(c)) c=getchar();\n\treturn c;\n}\nint main(){\n\t#ifdef LOCAL\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n\t#endif\n\tn=readint();\n\tm=readint();\n\tk=readint();\n\tscanf(\"%s\",s+1);\n\trt=new node(1,n);\n\twhile(m--){\n\t\tint opt=readint();\n\t\tif(opt==1){\n\t\t\tint l,r;\n\t\t\tl=readint();\n\t\t\tr=readint();\n\t\t\trt->modify(l,r,readchar()-'a');\n\t\t}\n\t\telse{\n\t\t\tscanf(\"%s\",t);\n\t\t\tint ans=1;\n\t\t\tfor(int i=0;i<k;i++) for(int j=0;j<=i;j++)\n\t\t\t\tans+=rt->cnt[t[i]-'a'][t[j]-'a'];\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1594143630,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF610E \u3010Alphabet Permutations\u3011"
    },
    {
        "content": "\u6ce8\u610f\u5230\u6a21\u5f0f\u4e32\u5faa\u73af\u4e00\u6b21\u53ea\u4f1a\u7ed9\u6bcf\u4e2a\u5b57\u6bcd\u81f3\u591a $1$ \u7684\u8d21\u732e\u3002\u5e76\u4e14\u5982\u679c\u4e3b\u4e32\u4e2d\u4e24\u4e2a\u5b57\u6bcd\u8fde\u7eed\u51fa\u73b0\uff0c\u5728\u6a21\u5f0f\u4e32\u5bf9\u5e94\u4e24\u4e2a\u5b57\u6bcd\u4e5f\u662f\u8fde\u7eed\u51fa\u73b0\uff0c\u90a3\u53ef\u4ee5\u7528 $1$ \u4e2a\u5faa\u73af\u6a21\u5f0f\u4e32\u5339\u914d\u6389\u8fd9\u4e24\u4e2a\u5b57\u6bcd\u3002\u56e0\u4e3a\u5982\u679c\u4e0d\u8fd9\u4e48\u505a\uff0c\u5faa\u73af\u6b21\u6570 $+1$\uff0c\u4f1a\u4f7f\u89e3\u66f4\u52a3\u3002\n\n\u4e8e\u662f\u60f3\u5230\u7ef4\u62a4\u4e3b\u4e32\u4e2d\u76f8\u90bb\u4e24\u4e2a\u5b57\u6bcd\u7684\u51fa\u73b0\u6b21\u6570\u3002\u6839\u636e\u4e4b\u524d\u7684\u7ed3\u8bba\uff0c\u5982\u679c\u5728\u4e3b\u4e32\u4e2d\u76f8\u90bb\u4e24\u4e2a\u5b57\u6bcd\u5728\u6a21\u5f0f\u4e32\u4e2d\u4e00\u540e\u4e00\u524d\u51fa\u73b0\uff0c\u5c31\u4f1a\u4f7f\u5f97\u5faa\u73af\u6b21\u6570 $+1$\u3002\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5e76\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nk^2+mk^2\\log n)$\u3002\n\n```cpp\n/* stuff you should look for\n\tSomething interesting tip copied from _kubic\n\t* int overflow, array bounds, uppercase/lowercase\n\t* special cases (n=1?)\n\t* do sth. instead of nothing and stay organized\n\t* WRITE STUFF DOWN\n\t* DON'T GET STUCK ON ONE APPROACH  \n*/\n#include<cstdio>\nclass SegmentTree {\n\t#define ls p<<1\n\t#define rs p<<1|1\n\tint n,K,buc[800005][10][10],chl[800005],chr[800005],tag[800005];\npublic:\n\tinline void pushup(int p) {\n\t\tfor(register int i=0;i<K;++i) for(register int j=0;j<K;++j) buc[p][i][j]=buc[ls][i][j]+buc[rs][i][j];\n\t\t++buc[p][chr[ls]][chl[rs]]; chl[p]=chl[ls]; chr[p]=chr[rs]; \n\t}\n\tinline void build(int p,int l,int r,char *s) {\n\t\ttag[p]=-1;\n\t\tif(l==r) {\n\t\t\tfor(register int i=0;i<K;++i) for(register int j=0;j<K;++j) buc[p][i][j]=0; \n\t\t\tchl[p]=chr[p]=s[l]-'a'; return;\n\t\t}\n\t\tint mid=l+r>>1; build(ls,l,mid,s); build(rs,mid+1,r,s); pushup(p);\n\t} \n\tinline void init(int n,int k,char *s) {this->n=n; this->K=k; build(1,1,n,s);}\n\tinline void work(int p,int l,int r,const int& val) {\n\t\ttag[p]=val;\n\t\tfor(register int i=0;i<K;++i) for(register int j=0;j<K;++j) buc[p][i][j]=0; \n\t\tbuc[p][val][val]=r-l; chl[p]=val; chr[p]=val; return;\n\t}\n\tinline void spread(int p,int l,int r) {\n\t\tint mid=l+r>>1;\n\t\tif(tag[p]!=-1) {work(ls,l,mid,tag[p]); work(rs,mid+1,r,tag[p]); tag[p]=-1;}\n\t} \n\tinline void _modify(int p,int L,int R,int l,int r,const int& val) {\n\t\tif(L<=l&&r<=R) {work(p,l,r,val);return;}\n\t\tint mid=l+r>>1; spread(p,l,r);\n\t\tif(L<=mid) _modify(ls,L,R,l,mid,val);\n\t\tif(R>mid) _modify(rs,L,R,mid+1,r,val);\n\t\tpushup(p);\n\t}\n\tinline void modify(int L,int R,const char& val) {_modify(1,L,R,1,n,val-'a');}\n\tinline int getPair(int x,int y) {return buc[1][x][y];}\n}SGT;\nchar s[200005],tmp[15];\nint rev[200005];\ninline int read() {\n\tregister int x=0,f=1;register char s=getchar();\n\twhile(s>'9'||s<'0') {if(s=='-') f=-1;s=getchar();}\n\twhile(s>='0'&&s<='9') {x=x*10+s-'0';s=getchar();}\n\treturn x*f;\n}\nint main() {\n\tint n=read(),Q=read(),K=read();\n\tscanf(\"%s\",s+1); SGT.init(n,K,s);\n\twhile(Q--) {\n\t\tint op=read();\t\n\t\tif(op==1) {\n\t\t\tint l=read(),r=read();\n\t\t\tscanf(\"%s\",tmp);\n\t\t\tSGT.modify(l,r,tmp[0]);\n\t\t}\n\t\telse {\n\t\t\tscanf(\"%s\",tmp);\n\t\t\tint ans=1;\n\t\t\tfor(register int i=0;i<K;++i) rev[tmp[i]-'a']=i;\n\t\t\tfor(register int i=0;i<K;++i) {\n\t\t\t\tfor(register int j=0;j<K;++j) {\n\t\t\t\t\tif(rev[i]>=rev[j]) ans+=SGT.getPair(i,j);\n\t\t\t\t}\n\t\t\t}\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1616309106,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF610E\u3010Alphabet Permutations\u3011"
    },
    {
        "content": "# Alphabet Permutations\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3an\uff08n<200000\uff09\u7684\u5b57\u7b26\u4e32s,\u6709\u4e24\u79cd\u6307\u4ee4\uff1a\n\n1.\u5c06\u533a\u95f4[L,R]\u5185\u7684\u5b57\u7b26\u53d8\u4e3ach\n\n2.\u7ed9\u5b9a\u957f\u5ea6\u4e3ak\uff081<=k<=10\uff09\u7684\u5b57\u7b26\u4e32\u6392\u5217t\uff0c\u5411s\u4e32\u4e2d\u6dfb\u52a0\u5b57\u7b26\uff0c\u4f7f\u5f97s\u4ee5t\u4e3a\u6a21\u5f0f\u5faa\u73af\uff0c\u6c42\u6700\u5c11\u7684\u5faa\u73af\u6b21\u6570\n\n\u6700\u591a20000\u6761\u6307\u4ee4\n## \u5e7f\u544a\u63d2\u5165\n\u5728\u6211\u7684\u535a\u5ba2\u91cc\u770b\u9898\u89e3\u4f7f\u7528\u6548\u679c\u66f4\u4f73\u54e6QwQ\n\n[\u6155\u5bb9\u7433\u7684\u540e\u82b1\u56ed](https://muronglin.top/hgoi-20190515/)\n\n[\u535a\u5ba2\u56ed(\u540c\u6b65\u66f4\u65b0)](https://www.cnblogs.com/muronglin/p/hgoi-20190515.html)\n## \u89e3\u6cd5\n\u5efa\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u5728\u6bcf\u4e2a\u8282\u70b9\u91cc\u653e\u4e00\u4e2ak^2\u7684\u6570\u7ec4\uff0c\u8bb0\u5f55\u4e24\u4e2ach\u76f4\u63a5\u76f8\u8fde\u7684\u60c5\u51b5\uff0c\u64cd\u4f5c1\u5c31\u662f\u533a\u95f4\u4fee\u6539\n\n\u81f3\u4e8e\u8be2\u95ee\uff0c\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u5b57\u6bcd\u5728\u6a21\u5f0f\u4e32\u4e2d\u7684\u51fa\u73b0\u4f4d\u7f6e\uff0c\u5373rk\uff0c\u5f53rk[i]>rk[j]\u65f6ans+=[1][i][j]\n\n\u5373\u5f53\u4e00\u4e2a\u5b57\u6bcd\u5728\u53e6\u4e00\u4e2a\u5b57\u6bcd\u7684\u540e\u9762\u65f6\uff0c\u4e0e\u5b83\u76f8\u8fde\u7684\u53e6\u4e00\u4e2a\u5b57\u6bcd\u4e00\u5b9a\u4f1a\u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u6a21\u5f0f\u4e32\uff0c\u53731\u7684\u8d21\u732e\n## ac\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define mem(a) memset(a,0,sizeof(a))\n#define mid ((l+r)>>1)\nusing namespace std;\nchar ch;\nint n,m,k,c,l,r,ans,rk[10],a[800010][10][10],tg[800010],lc[800010],rc[800010];\nvoid f(int x,int c,int len){mem(a[x]),a[x][c][c]=len-1,lc[x]=rc[x]=tg[x]=c;}\nvoid down(int x,int l,int r){if(tg[x]>-1)f(x<<1,tg[x],mid-l+1),f(x<<1|1,tg[x],r-mid);}\nvoid upd(int x)\n{\n\tint l=x<<1,r=x<<1|1;\n\tfor(int i=0;i<k;i++)for(int j=0;j<k;j++)a[x][i][j]=a[l][i][j]+a[r][i][j];\n\ta[x][rc[l]][lc[r]]++,lc[x]=lc[l],rc[x]=rc[r];\n}\nvoid build(int x,int l,int r)\n{\n\tif(l==r){scanf(\" %c\",&ch),lc[x]=rc[x]=ch-'a';return;}\n\tbuild(x<<1,l,mid),build(x<<1|1,mid+1,r),upd(x);\n}\nvoid modify(int x,int l,int r,int p,int q,int d)\n{\n\tif(l>=p&&r<=q){f(x,d,r-l+1);return;}else if(l>q||r<p)return;\n\tdown(x,l,r),tg[x]=-1,modify(x<<1,l,mid,p,q,d),modify(x<<1|1,mid+1,r,p,q,d),upd(x);\n}\nint main()\n{\n\tmemset(tg,-1,sizeof(tg)),scanf(\"%d%d%d\",&n,&m,&k),build(1,1,n);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%d\",&c),ans=0;\n\t\tif(c==1)scanf(\"%d%d %c\",&l,&r,&ch),modify(1,1,n,l,r,ch-'a');\n\t\telse\n\t\t{\n\t\t\tfor(int i=0;i<k;i++)scanf(\" %c\",&ch),rk[ch-'a']=i;\n\t\t\tfor(int i=0;i<k;i++)for(int j=0;j<k;j++)if(rk[i]>=rk[j])ans+=a[1][i][j];\n\t\t\tprintf(\"%d\\n\",ans+1);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1557902827,
        "uid": 24663,
        "name": "\u6ce0\u5c0f\u6bd2",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF610E \u3010Alphabet Permutations\u3011"
    }
]