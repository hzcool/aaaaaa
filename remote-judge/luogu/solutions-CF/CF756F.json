[
    {
        "content": "\u7b2c\u4e00\u773c\u770b\u4e0a\u53bb\uff1a\u8fd9\u4e48\u591a\u8303\u5f0f\u5b9a\u4e49\uff0c\u663e\u7136\u662f\u5927\u6a21\u62df\uff0c\u5927\u6a21\u62df\u653e div1F\uff0c\u8fd9\u573a\u6ca1\u6551\u4e86\u3002\n\n\u7136\u540e\u5c31\u5f00\u59cb\u5199\u5927\u6a21\u62df\u4e86\u3002\u5bf9\u4e8e\u6bcf\u6bb5\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(val,ten)$ \u63cf\u8ff0\u4e4b\uff0c\u8868\u793a\u8fd9\u6bb5\u53d6\u6a21\u540e\u7684\u503c\u662f $val$\uff0c\u8fd9\u6bb5\u957f\u5ea6\u5173\u4e8e $10$ \u7684\u5e42\u6b21\u662f $ten$\u3002\u5408\u5e76\u4e24\u4e2a\u4e8c\u5143\u7ec4\u662f\u7b80\u5355\u7684\uff1b\u5bf9\u4e00\u4e2a\u4e8c\u5143\u7ec4\u91cd\u590d\u82e5\u5e72\u6b21\u53ef\u4ee5\u7c7b\u5feb\u901f\u5e42\uff08\u53ea\u4e0d\u8fc7\u662f\u4ee5 $10$ \u4e3a\u5e95\uff09\u5730\u5904\u7406\u3002\n\n\u7136\u540e\u5199\u5230 $l-r$ \u8fd9\u4e2a\u64cd\u4f5c\u5c31\u7ed9\u6211\u6574\u4e0d\u4f1a\u4e86\u3002\n\n\u6211\u4eec\u9996\u5148\u628a\u5b83\u505a\u4e00\u6b65\u5dee\u5206\uff0c\u53d8\u6210 $1-r$ \u9664\u53bb $1-l$ \u518d\u52a0\u4e0a $l$ \u81ea\u8eab\u3002\u4e8c\u5143\u7ec4\u663e\u7136\u662f\u53ef\u4ee5\u652f\u6301\u6c42\u9006\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u73b0\u5728\u5c31\u53ea\u9700\u8981\u4f1a\u6c42 $1-x$ \u62fc\u63a5\u7684\u7ed3\u679c\u5373\u53ef\u3002\n\n\u628a\u5b83\u518d\u505a\u4e00\u6b65\u8f6c\u6362\uff0c\u53d8\u6210\u4f4d\u6570\u5c0f\u4e8e $x$ \u7684\u4e1c\u897f\u62fc\u63a5\u6210\u4f4d\u6570\u7b49\u4e8e $x$ \u7684\u4e1c\u897f\u3002\n\n\u5148\u770b\u524d\u8005\u3002\u8fd9\u662f\u53ef\u4ee5\u9884\u5904\u7406\u7684\uff0c\u6211\u4eec\u9884\u5904\u7406 $f_x$ \u8868\u793a\u4f4d\u6570\u4e0d\u8d85\u8fc7 $x$ \u7684\u5143\u7d20\u62fc\u63a5\u6210\u7684\u4e8c\u5143\u7ec4\u3002\n\n\u8003\u8651\u7531 $f_x$ \u63a8\u51fa $f_{x+1}$\u3002\u8fd9\u8981\u628a\u4f4d\u6570\u4e3a $x+1$ \u7684\u4e1c\u897f\u5168\u90e8\u8003\u8651\u5230\u3002\n\n\u8003\u8651\u628a $val$ \u548c $ten$ \u5206\u5f00\u7b97\u3002\n\n\u5bf9\u4e8e $ten$\uff0c\u5176\u663e\u7136\u5c31\u662f $(10^{x+1})^{10^{x+1}-10^x}$\u3002\n\n\u5bf9\u4e8e $val$\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f $\\sum\\limits_{i=10^x}^{10^{x+1}-1}i(10^{x+1})^{10^{x+1}-i-1}$\u3002\n\n\u628a\u5b83\u505a\u4e00\u6b65\u5dee\u5206\u53d8\u6210 $\\sum\\limits_{i=0}^{10^{x+1}-1}i(10^{x+1})^{10^{x+1}-i-1}-\\sum\\limits_{i=0}^{10^x-1}i(10^{x+1})^{10^{x+1}-i-1}$\u3002\n\n\u628a\u5b83\u62bd\u8c61\u6210 $\\sum\\limits_{i=0}^{n-1}ia^i$ \u8fd9\u4e2a\u6a21\u578b\u3002\u800c\u8fd9\u4e2a\u6a21\u578b\u662f\u7ecf\u5178\u7684\u3002\n$$\nX=\\sum\\limits_{i=0}^{n-1}ia^i\n\\\\aX=\\sum\\limits_{i=0}^{n-1}ia^{i+1}\n\\\\aX=\\sum\\limits_{i=1}^n(i-1)a^i\n\\\\(a-1)X=(n-1)a^n-\\sum\\limits_{i=1}^{n-1}a^i\n\\\\(a-1)X=(n-1)a^n-\\dfrac{a^n-1}{a-1}+1\n\\\\X=\\dfrac{(n-1)a^n-\\dfrac{a^n-1}{a-1}+1}{a-1}\n$$\n\u6839\u636e\u8be5\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u5927\u529b\u7b97\u5feb\u901f\u5e42\uff0c\u7528\u6b27\u62c9\u5b9a\u7406\u5904\u7406\u6307\u6570\u4e0a\u7684\u4e1c\u897f\uff0c\u5e76\u5728 $O(\\log n)$ \u7684\u65f6\u95f4\u5185\u4ece $f_x$ \u63a8\u5230 $f_{x+1}$\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ea\u9700\u8ba1\u7b97\u4f4d\u6570\u7b49\u4e8e $x$ \u7684\u4e1c\u897f\u4e86\u3002\u8fd0\u7528\u6211\u4eec\u4e0a\u9762\u7684\u5206\u6790\u6d41\u7a0b\uff0c\u8fd9\u662f\u7b80\u5355\u7684\u3002\n\n\u8003\u8651\u5206\u6790\u590d\u6742\u5ea6\u3002\u6211\u4eec\u53ef\u4ee5\u5728 $O(n\\log n)$ \u7684\u65f6\u95f4\u5185\u9884\u5904\u7406\u51fa $f$\uff0c\u5728 $O(|s|\\log n)$ \u7684\u65f6\u95f4\u5185\u5904\u7406\u51fa\u4e00\u6bb5 $l-r$\u3002\u9884\u5148\u5efa\u51fa\u8868\u8fbe\u5f0f\u6811\uff0c\u603b\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230 $O(n\\log n)$\u3002\n\n\uff08\u6211\u89c9\u5f97\u8fd9\u9898\u51fa\u9898\u4eba\u9634\u95f4\u7684\u5730\u65b9\u5c31\u662f\uff0c\u4f60\u660e\u660e\u76f4\u63a5\u51fa $l-r$ \u5c31\u597d\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u5957\u4e00\u5806\u8868\u8fbe\u5f0f\u5904\u7406\u7684\u7ec6\u8282\uff09\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nconst int phi=mod-1;\nint ksm(int x,int y=phi-1){int z=1;for(;y;y>>=1,x=1ll*x*x%mod)if(y&1)z=1ll*z*x%mod;return z;}\nint msk(int x,int y){int z=1;for(;y;y>>=1,x=1ll*x*x%phi)if(y&1)z=1ll*z*x%phi;return z;}\nstruct dat{\nint val,ten;\ndat(){val=0,ten=1;}\ndat(int V,int T){val=V,ten=T;}\nfriend dat operator+(const dat&u,const dat&v){return dat((1ll*u.val*v.ten+v.val)%mod,1ll*u.ten*v.ten%mod);}\nfriend dat operator-(const dat&u,const dat&v){\n\tdat w;\n\tw.ten=1ll*u.ten*ksm(v.ten)%mod;\n\tw.val=(u.val+mod-1ll*v.val*w.ten%mod)%mod;\n\treturn w;\n}\nvoid print()const{printf(\"[%d,%d]\",val,ten);}\n}f[100100];\ndat ksm(dat x,int y){dat z;for(;y;y>>=1,x=x+x)if(y&1)z=z+x;return z;}\ndat KSM(char*l,char*r,dat d){\n\tstatic dat pov[10];for(int i=1;i<10;i++)pov[i]=pov[i-1]+d;\n\tdat ret;\n\twhile(l!=r)ret=ksm(ret,10)+pov[*(l++)-'0'];\n\treturn ret;\n}\ndat gene(char*l,char*r){\n\tdat ret;ret.ten=ksm(10,r-l);\n\twhile(l!=r)ret.val=(10ll*ret.val+*(l++)-'0')%mod;\n\treturn ret;\n}\nint stereotype(int a,int modn,int phin){\n\t// printf(\"STER:%d,%d,%d\\n\",a,modn,phin);\n\tint an=ksm(a,phin);\n\tint ia1=ksm((a+mod-1)%mod);\n\treturn (1ll*(modn+mod-1)*an-1ll*(an+mod-1)*ia1%mod+mod+1)%mod*ia1%mod;\n}\ndat conca(char*l,char*r){\n\tint modn=0,phin=0;\n\tfor(char*i=l;i!=r;i++)modn=(10ll*modn+(*i-'0'))%mod,phin=(10ll*phin+(*i-'0'))%phi;\n\t(++modn)%=mod,(++phin)%=phi;\n\tint i=r-l-1;\n\tint fv=stereotype(ksm(10,phi-(i+1)),modn,phin);\n\tint rv=stereotype(ksm(10,phi-(i+1)),ksm(10,i),msk(10,i));\n\tint val=1ll*(fv+mod-rv)*ksm(ksm(10,i+1),(phin+phi-1)%phi)%mod;\n\tint ten=ksm(ksm(10,i+1),(phin+phi-msk(10,i))%phi);\n\t// for(char*i=l;i!=r;i++)putchar(*i);printf(\":\"),(f[i]+dat(val,ten)).print();puts(\"\");\n\treturn f[i]+dat(val,ten);\n}\nint S,mat[100100],stk[100100],tp;\nchar s[100100];\ndat solve(int l,int r){\n\t// printf(\"SOLVE:[%d,%d]\",l,r);for(int i=l;i<r;i++)putchar(s[i]);puts(\"\");\n\tif(l>=r)return dat();\n\tint p=l;while(s[p]>='0'&&s[p]<='9')p++;\n\tif(p==r)return gene(s+l,s+r);\n\tif(s[p]=='(')return KSM(s+l,s+p,solve(p+1,mat[p]))+solve(mat[p]+2,r);\n\tif(s[p]=='+')return gene(s+l,s+p)+solve(p+1,r);\n\tif(s[p]=='-'){\n\t\tint q=p+1;\n\t\twhile(s[q]>='0'&&s[q]<='9')q++;\n\t\treturn (gene(s+l,s+p)+(conca(s+p+1,s+q)-conca(s+l,s+p)))+solve(q+1,r);\n\t}\n}\nint main(){\n\tscanf(\"%s\",s),S=strlen(s);\n\tfor(int i=0;i<S;i++){\n\t\tint fv=stereotype(ksm(10,phi-(i+1)),ksm(10,i+1),msk(10,i+1));\n\t\tint rv=stereotype(ksm(10,phi-(i+1)),ksm(10,i),msk(10,i));\n\t\tint val=1ll*(fv+mod-rv)*ksm(ksm(10,i+1),(msk(10,i+1)+phi-1)%phi)%mod;\n\t\tint ten=ksm(ksm(10,i+1),(msk(10,i+1)+phi-msk(10,i))%phi);\n\t\tf[i+1]=f[i]+dat(val,ten);\n\t}\n\tfor(int i=0;i<S;i++){\n\t\tif(s[i]=='(')stk[++tp]=i;\n\t\tif(s[i]==')')mat[stk[tp]]=i,mat[i]=stk[tp--];\n\t}\n\tprintf(\"%d\\n\",solve(0,S).val);\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1652355082,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF756F\u3010Long number\u3011"
    }
]