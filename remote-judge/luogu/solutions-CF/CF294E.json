[
    {
        "content": "# \u9898\u610f\uff1a\n## \u4e00\u68f5\u6811\u62c6\u4e00\u4e2a\u8fb9\u91cd\u8fde\uff0c\u8fb9\u957f\u4e0d\u53d8\uff0c\u6c42\u6240\u5f97\u65b0\u6811\u4e24\u4e24\u8282\u70b9\u8def\u5f84\u603b\u548c\u6700\u5c0f\u503c\n# \u601d\u8def\n### \u62c6\u6210\u4e24\u68f5\u6811\u540e\u4e24\u6811\u5185\u90e8\u4e24\u4e24\u8ddd\u79bb\u548c\u4e0d\u53d8\uff0c\u518d\u52a0\u4e0au\uff08\u4e00\u6811\u8282\u70b9\u6570\uff09\u4e58v\uff08\u53e6\u4e00\u6811\u8282\u70b9\u6570\uff09\u4e58w\uff08\u91cd\u8fde\u7684\u8fb9\u7684\u957f\u5ea6\uff09+\u4e24\u4e66\u95f4\u8282\u70b9\u8def\u5f84\u548c\n### \u4ee5\u4e0a\u7686\u53efdfs\u5904\u7406\n### \u679a\u4e3e\u62c6\u7684\u8fb9\uff0c\u53cd\u8bc1\u6cd5\u53ef\u5f97\u65b0\u8fde\u7684\u4e24\u4e66\u8282\u70b9\u5206\u522b\u662f\u4e24\u6811\u91cd\u5fc3\uff0c\u6c42\u51fa\u91cd\u5fc3\u518d\u7b97\u5373\u53ef\n```cpp\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\n#include<queue>\n#include<stack>\n#include<iomanip>\n#define maxn 200005\ntypedef long long ll;\nconst int inf = 0x3f3f3f3f;\nll ans=-1,sum,tol;\nint sig1,sig2;//rua\u6389\u7684\u8def \nint n,cnt;//\u62c6\u51fa\u7684\u4e24\u68f5\u6811\u8fde\u63a5\u4e24\u4e2a\u7684\u91cd\u5fc3\u8def\u5f84\u548c\u4e00\u5b9a\u6700\u5c0f \nint emp,pos;//\u6c42\u91cd\u5fc3\u7684 \nint head[maxn],son[maxn];\nusing namespace std;\nstruct fuck\n{\n\tint from,to,next;ll w;\n}e[maxn*2];\nvoid add(int u,int v,ll w)\n{\n\t/*\u52a0\u8fb9*/\n}\nvoid init()\n{\n\t/*\u521d\u59cb\u5316*/\n}\nvoid erzi(int u,int dad)\n{\n\t/*\u6c42\u513f\u5b50\u6570*/\n}\nvoid zhongxin(int u,int dad,int tol)\n{\n\tint maxm=0;\n\tfor(int i=head[u];~i;i=e[i].next)\n\t{\n\t\tint j=e[i].to;\n\t\tif(j==dad||i==sig1||i==sig2)continue;\n\t\tzhongxin(j,u,tol);\n\t\tmaxm=max(maxm,son[j]);\n\t}\n\tmaxm=max(maxm,tol-son[u]);\n\tif(maxm<emp)\n\t{\n\t\temp=maxm;pos=u;\n\t}\n}\nvoid dfs(int u,int dad)\n{\n\tson[u]=1;\n\tfor(int i=head[u];~i;i=e[i].next)\n\t{\n\t\tint j=e[i].to;\n\t\tif(j==dad||i==sig1||i==sig2)continue;\n\t\tdfs(j,u);son[u]+=son[j];\n\t\tsum+=e[i].w*son[j]*(n-son[j]);\n\t}\n}\nint main()\n{\n\tint u,v;ll w;\n\tread(n);init();\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tread(u);read(v);read(w);\n\t\tadd(u,v,w);add(v,u,w);\n\t}\n\tfor(int i=0;i<cnt;i+=2)\n\t{\n\t\tint x=e[i].from,y=e[i].to;\n\t\tsig1=i;sig2=i+1;sum=0;\n\t\terzi(x,-1);u=son[x];//v=n-u;\n\t\terzi(y,-1);v=son[y];\n\t\temp=inf;zhongxin(x,-1,u);\n\t\tdfs(pos,-1);\n\t\temp=inf;zhongxin(y,-1,v);\n\t\tdfs(pos,-1);\n\t\t//cout<<u<<\" \"<<v<<endl;\n\t\tif(ans==-1)ans=sum+e[i].w*u*v;\n\t\telse ans=min(ans,sum+e[i].w*u*v);\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1548299597,
        "uid": 19814,
        "name": "\u89de\u7fb0\u6d99",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF294E \u3010Shaass the Great\u3011"
    },
    {
        "content": "\u53d1\u73b0 $n$ \u5f88\u5c0f\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u8fb9\uff1a\u6211\u4eec\u679a\u4e3e\u65ad\u6389 $(u,v,w)$ \u8fd9\u6761\u8fb9\uff0c\u7136\u540e\u8fd9\u68f5\u6811\u5c31\u53d8\u6210\u4e86\u4e24\u68f5\uff0c\n\n\u7136\u540e\u56e0\u4e3a\u4e24\u68f5\u6811\u7684\u70b9\u4e2a\u6570\u4e0d\u53d8\uff0c\u6240\u4ee5\u8fd9\u6761\u8fb9\u65e0\u8bba\u8fde\u5728\u54ea\u4e24\u4e2a\u70b9\u4e4b\u95f4\u8d21\u732e\u90fd\u4e00\u6837\uff0c\n\n\u6240\u4ee5\u73b0\u5728\u53ea\u8981\u8003\u8651\u5982\u4f55\u6700\u5c0f\u5316\u8de8\u7acb\u8fd9\u6761\u8fb9\u7684\u8def\u5f84\u7684\u8d21\u732e\uff0c\n\n\u5f88\u5bb9\u6613\u53d1\u73b0\u5c31\u662f\u5206\u522b\u6c42\u4e24\u4e2a\u6811\u7684\u201c\u91cd\u5fc3\u201c\uff1a\u6240\u6709\u70b9\u5230\u6839\u8282\u70b9\u7684\u5e26\u6743\u8def\u5f84\u7684\u548c\u7684\u548c\u7684\u6700\u5c0f\u503c\u7684\u8fd9\u4e2a\u6839\u3002\n\n~~\u76f2\u731c\u8fd9\u4e2a\u201c\u91cd\u5fc3\u201d\u5c31\u662f\u91cd\u5fc3\u3002~~\uff0c\u6211\u4eec\u5bf9\u5355\u68f5\u6811\u8003\u8651\u4e00\u4e0b\u3002\n\n\u968f\u4fbf\u9009\u4e00\u4e2a\u6839\u4e3a $u$ \uff0c\u90a3\u4e48\u9009\u4e00\u4e2a\u513f\u5b50 $v$ \uff08\u901a\u8fc7\u8fb9 $(u,v,w)$\uff09\uff0c\u628a\u91cd\u5fc3\u4ece $u$ \u53d8\u6210 $v$ \u4f1a\u53d1\u751f\u4ec0\u4e48\u4e8b\uff1a\n\n\u53d1\u73b0\u53ea\u6709 $(u,v,w)$ \u8fd9\u6761\u8fb9\u7684\u8d21\u732e\u7684\u7cfb\u6570\u4ece $siz_v$ \u53d8\u4e3a\u4e86 $(n-siz_v)$\uff0c\n\n\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u53ea\u8981\u6709\u4e00\u4e2a $v$ \u4f7f\u5f97 $siz_v>n-siz_v$ \uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8d2a\u5fc3\u628a\u91cd\u5fc3\u6539\u4e3a $v$\uff0c\n\n\u76f4\u5230\u6240\u6709 $v$ \u90fd\u6709 $siz_v\\le n-siz_v$ \uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u8fd9\u4e2a $u$ \u662f\u552f\u4e00\u7684\uff0c\u6216\u8005\u8bf4\u5373\u4f7f\u6709\u591a\u4e2a\u4f46\u548c\u662f\u4e00\u6837\u7684\u3002\n\n\u628a\u5f0f\u5b50\u6539\u4e00\u4e0b $2\\times siz_v\\le n$ \u3002\u3002\u3002\u8fd9\u4e0d\u5c31\u662f\u91cd\u5fc3\u5b9a\u4e49\u4e48\u3002\u3002\u3002\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^2)$\n\n```cpp\n// This code wrote by chtholly_micromaker(MicroMaker)\n#include <bits/stdc++.h>\n#define reg register\n#define int long long\n#define mem(x,y) memset(x,y,sizeof x)\n#define ln std::puts(\"\")\nconst int MaxN=5050;\ntemplate <class t> inline void read(t &s){s=0;\nreg int f=1;reg char c=getchar();while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\nwhile(isdigit(c))s=(s<<3)+(s<<1)+(c^48),c=getchar();s*=f;return;}\ntemplate<class t,class ...A> inline void read(t &x,A &...a){read(x);read(a...);}\ntemplate <class t> inline void write(t x){if(x<0)putchar('-'),x=-x;\nint buf[21],top=0;while(x)buf[++top]=x%10,x/=10;if(!top)buf[++top]=0;\nwhile(top)putchar(buf[top--]^'0');return;}\ntemplate <class t>inline bool checkmin(t&x,t y){if(x>y){x=y;return 1;}return 0;}\ntemplate <class t>inline bool checkmax(t&x,t y){if(x<y){x=y;return 1;}return 0;}\nstruct Edge{int nxt,to,w;}E[MaxN<<2];\nstruct edge{int u,v,w;}e[MaxN];\nint hd[MaxN],en,n;\ninline void adde(int u,int v,int w){E[++en]=(Edge){hd[u],v,w},hd[u]=en;}\nnamespace BG\n{\n\tint siz[MaxN],sum;\n\tinline void dfs(int u,int fa)\n\t{\n\t\tsiz[u]=1;\n\t\tfor(int i=hd[u];~i;i=E[i].nxt)\n\t\t{\n\t\t\treg int v=E[i].to;\n\t\t\tif(v==fa)\n\t\t\t\tcontinue;\n\t\t\tdfs(v,u),siz[u]+=siz[v];\n\t\t\tsum+=siz[u]*(n-siz[u])*E[i].w;\n\t\t}\n\t}\n}\nstruct Getroot\n{\n\tint siz[MaxN],allsiz,mnsiz,root,locked,sum,cur;\n\tinline void dfs(int u,int fa)\n\t{\n\t\tsiz[u]=1;\n\t\treg int mx=0;\n\t\tfor(int i=hd[u];~i;i=E[i].nxt)\n\t\t{\n\t\t\treg int v=E[i].to;\n\t\t\tif(v==fa||v==locked)\n\t\t\t\tcontinue;\n\t\t\tdfs(v,u);\n\t\t\tsiz[u]+=siz[v],checkmax(mx,siz[v]);\n\t\t\tsum+=siz[v]*(allsiz-siz[v])*E[i].w,cur+=siz[v]*E[i].w;\n\t\t}\n\t\tcheckmax(mx,allsiz-siz[u]);\n\t\tif(checkmin(mnsiz,mx))root=u;\n\t}\n\tinline void init(int u,int fa,int S)\n\t{\n\t\tallsiz=S,mnsiz=1e9,locked=fa,root=0,sum=0;\n\t\tdfs(u,0),sum=cur=0,dfs(root,0);\n\t}\n}tr1,tr2;\nsigned main(void)\n{\n\tstd::mem(hd,-1);\n\tread(n);\n\treg int u,v,w;\n\tfor(int i=1;i<n;++i)\n\t\tread(u,v,w),e[i]=(edge){u,v,w},adde(u,v,w),adde(v,u,w);\n\tBG::dfs(1,0);\n\treg int ans=1e18;\n\tfor(int i=1;i<n;++i)\n\t{\n\t\tu=e[i].u,v=e[i].v,w=e[i].w;\n\t\tif(BG::siz[u]>BG::siz[v])std::swap(u,v);\n\t\ttr1.init(u,v,BG::siz[u]),tr2.init(v,u,n-BG::siz[u]);\n\t\tcheckmin(ans,tr1.sum+tr2.sum+\n\t\t\t\t(tr1.cur+BG::siz[u]*w)*(n-BG::siz[u])+tr2.cur*(BG::siz[u]));\n\t}\n\twrite(ans),ln;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1619012888,
        "uid": 51376,
        "name": "MyukiyoMekya",
        "ccfLevel": 9,
        "title": "CF294E Shaass the Great \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\uff1a\n\n\u6709\u4e00\u68f5 $n$ \u4e2a\u70b9\u7684\u6811\uff0c\u4ece $n-1$ \u6761\u8fb9\u4e2d\u53bb\u6389\u4e00\u6761\u8fb9\uff0c\u518d\u6784\u5efa\u4e00\u6761\u76f8\u540c\u957f\u5ea6\u7684\u8fb9\u91cd\u65b0\u6784\u6210\u4e00\u68f5\u6811\uff08\u53bb\u6389\u7684\u8fb9\u548c\u6784\u9020\u7684\u8fb9\u53ef\u4ee5\u76f8\u540c\uff09\uff0c\u95ee\u65b0\u7684\u6811\u4e2d\u4efb\u610f\u4e24\u70b9\u4e4b\u95f4\u8ddd\u79bb\u7684\u603b\u548c\u6700\u5c0f\u662f\u591a\u5c11\u3002\n\n$n \\leq 5000$\n\n### \u5206\u6790\uff1a\n\n\u8bbe\u53bb\u6389\u7684\u662f\u957f\u5ea6\u4e3a $w$ \u7684\u8fb9 $u\\rightarrow v$\uff0c\u5e76\u5728\u70b9 $x,y$ \u95f4\u8fde\u4e00\u6761\u957f\u5ea6\u4e3a $w$ \u7684\u8fb9\uff0c\u5219 $ans=sz_u\\cdot sz_v\\cdot w+sum_u+sum_v+\\min\\limits_{i\\in u\u6240\u5728\u6811\u7684\u8282\u70b9\u96c6\u5408}\\{sum_i\\}\\cdot sz_v+\\min\\limits_{i\\in v\u6240\u5728\u6811\u7684\u8282\u70b9\u96c6\u5408}\\{sum_v\\}\\cdot sz_u$\uff0c\u5176\u4e2d $sz_i$ \u8868\u793a\u53bb\u6389\u4e00\u6761\u8fb9\u540e\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u5927\u5c0f\uff0c $sum_i$ \u8868\u793a\u76f8\u540c\u60c5\u51b5\u4e0b\u4ee5 $i$ \u4e3a\u6839\u65f6\uff0c\u5176\u5b83\u6811\u4e0a\u8282\u70b9\u5230\u5b83\u7684\u8ddd\u79bb\u603b\u548c\u3002\n\n\u5bf9\u4e8e $sz_u$ \u548c $sz_v$\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u505a\u4e00\u6b21 `dfs` \u6765\u6c42\uff1b\u81f3\u4e8e $sum_i$ \u5219\u53ef\u4ee5\u901a\u8fc7 `\u6362\u6839dp` \u6765\u6c42\u3002\u5bf9\u4e8e\u6bcf\u68f5\u6811\u7684\u6700\u5c0f\u503c\uff0c\u53ef\u4ee5\u5728\u6362\u6839\u65f6\u81ea\u5e95\u5411\u4e0a\u66f4\u65b0\u3002\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6bcf\u6b21\u679a\u4e3e\u4e00\u6761\u8fb9\uff0c\u6bcf\u6b21\u5728\u4e0d\u7ecf\u8fc7\u8fd9\u6761\u8fb9\u505a `\u6362\u6839dp` \uff0c\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u53ef\u4ee5\u63a5\u53d7\u3002\n\n\u5bf9\u4e8e `\u6362\u6839dp` \u65f6\u7684\u6c42\u503c\uff0c\u8bbe $d_x$ \u4e3a\u4ee5 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d $x$ \u4e0e\u5b50\u6811\u5185\u8282\u70b9\u7684\u8ddd\u79bb\u603b\u548c\uff0c$f_x$ \u4e3a\u4ee5 $x$ \u4e3a\u6839\u7684\u6811\u4e2d $x$ \u4e0e\u5176\u5b83\u8282\u70b9\u7684\u8ddd\u79bb\u603b\u548c\u3002\u5047\u8bbe $f_x$ \u5df2\u7ecf\u6c42\u51fa\uff0c\u4e14 $y\\in son_x$\uff0c\u8fb9 $x\\rightarrow y$ \u7684\u503c\u4e3a $z$\uff0c\u5219 $f_y=d_y+(f_x-d_y)+[(sz_{root}-sz_y)-sz_y]\\cdot z=f_x+(sz_{root}-2sz_y)z$\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u89c1\u4ee3\u7801\u3002\n\n### Code\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nconst int N = 5010;\n\nint n, ans = 2e18, cnt, d[N], f[N], U[N], V[N], W[N], sz[N], fa[N], mn[N], head[N];\n\nstruct xcj{\n\tint to, nxt, value;\n} e[N << 1];\n\ninline int read(){\n\tint s = 0, w = 1;\n\tchar ch = getchar();\n\tfor (; ch < '0' || ch > '9'; w *= ch == '-' ? -1 : 1, ch = getchar());\n\tfor (; ch >= '0' && ch <= '9'; s = s * 10 + ch - '0', ch = getchar());\n\treturn s * w;\n}\n\nvoid add(int u, int v, int w){e[++cnt] = {v, head[u], w}, head[u] = cnt;}\n\nvoid dfs(int x){\n\tsz[x] = 1, d[x] = 0;\n\tfor (int i = head[x]; i; i = e[i].nxt){\n\t\tint y = e[i].to, z = e[i].value;\n\t\tif (y == fa[x]) continue;\n\t\tfa[y] = x, dfs(y), sz[x] += sz[y], d[x] += d[y] + sz[y] * z;\n\t}\n}\n\nvoid dp(int x, int root){\n\tmn[x] = f[x];\n\tfor (int i = head[x]; i; i = e[i].nxt){\n\t\tint y = e[i].to, z = e[i].value;\n\t\tif (y == fa[x]) continue;\n\t\tf[y] = f[x] + (sz[root] - 2 * sz[y]) * z, dp(y, root), mn[x] = min(mn[x], mn[y]);\n\t}\n}\n\nsigned main(){\n\tn = read();\n\tfor (int i = 1; i < n; ++i) U[i] = read(), V[i] = read(), W[i] = read(), add(U[i], V[i], W[i]), add(V[i], U[i], W[i]);\n\tfor (int i = 1, u, v, w, res; i < n; ++i){\n\t\tmemset(mn, 0x3f, sizeof(mn));\n\t\tu = U[i], v = V[i], w = W[i], fa[u] = v, fa[v] = u, dfs(u), f[u] = d[u], dp(u, u), dfs(v), f[v] = d[v], dp(v, v), res = 0;\n\t\tfor (int j = 1; j <= n; ++j) res += f[j];\n\t\tans = min(ans, res / 2 + sz[u] * sz[v] * w + mn[u] * sz[v] + mn[v] * sz[u]);\n\t}\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1661172328,
        "uid": 124527,
        "name": "leoair",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF294E \u3010CF294E Shaass the Great\u3011"
    },
    {
        "content": "\u4e2a\u4eba\u8ba4\u4e3a *2300 \u548c\u8bc4\u84dd\u90fd\u6709\u70b9\u4f4e\u4e86\u3002\n\n\u7ed9\u4e00\u4e2a\u4e0d\u4e00\u6837\u7684\u6811\u5f62 dp \u505a\u6cd5\u3002\n\n\n\n\u8003\u8651 $O(N)$ \u679a\u4e3e\u54ea\u6761\u8fb9\u65ad\u6389\u3002\u7136\u540e\u65ad\u6210\u4e86\u4e24\u68f5\u6811\uff0c\u901a\u8fc7\u6811\u5f62 dp \u6765\u786e\u5b9a\u5982\u4f55\u8fde\u8fb9\u3002\u5177\u4f53\u800c\u8a00\uff0c\u4e24\u68f5\u6811\u5404\u81ea\u72ec\u7acb\uff0c\u5c31\u662f\u8bf4\u5bf9\u6bcf\u68f5\u6811\u5206\u522b\u8fdb\u884c\u4e00\u6b21\u6811\u5f62 dp \u5c31\u884c\u4e86\u3002\n\n\u72b6\u6001\uff1a$f(u,0)$ \u8868\u793a $u$ \u8fd9\u68f5\u6811\u5185\u4e0d\u8fde\u8fb9\uff0c\u5b50\u6811\u5230\u53e6\u4e00\u68f5\u6811\u5f97\u6700\u77ed\u8ddd\u79bb\u4e00\u5171\u662f\u591a\u5c11\u3002$f(u,1)$ \u8868\u793a $u$ \u8fd9\u68f5\u6811\u5185\u8fde\u8fb9\uff0c\u5b50\u6811\u5230\u53e6\u4e00\u68f5\u6811\u5f97\u6700\u77ed\u8ddd\u79bb\u4e00\u5171\u662f\u591a\u5c11\u3002\n\n\u8f6c\u79fb\uff1a$f(u,0) = \\sum_{v \\in son_u} f(v, 0) + w \\ \\cdot \\ sz_v \\ \\cdot \\ (N_{0/1} + N_{1/0} - sz_v)$\uff08$N_i$ \u4e3a\u8fd9\u68f5\u780d\u65ad\u7684\u6811\u7684\u5927\u5c0f\uff09\uff1b\u800c $f(u,1) = \\min\\{A + B\\}$\uff0c$A$ \u8868\u793a\u5176\u4ed6\u5b50\u6811\u90fd\u4e0d\u8fde\uff0c$B$ \u8868\u793a\u6709\u4e2a\u5b50\u6811\uff08$v$\uff09\u8fde\u4e86\u7684\u8d21\u732e\u3002\n\n\u600e\u4e48\u6c42 $A,B$ \u5462\uff1f\n$$\nA = \\sum_{v' \\in son_u \\text{and} v' \\neq v} f(v', 0) + w \\ \\cdot \\ sz_{v'} \\ \\cdot \\ (N_{0/1} - sz_{v'})\n$$\n$$\n= f(u,0) - f(v, 0) - w \\ \\cdot \\ sz_{v} \\ \\cdot \\ (N_{0/1} - sz_{v})\n$$\n\n$$\nB = \\min(f(v,0),f(v,1)) + w \\ \\cdot \\ (N_{0/1}-sz_{v}) \\ \\cdot \\ (N_{1/0} + sz_{v})\n$$\n\n\n\u5982\u56fe\u3002\u5708\u51fa\u6765\u7684\u4fbf\u662f\u4e24\u90e8\u5206\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/eavei4pg.png)\n![](https://cdn.luogu.com.cn/upload/image_hosting/dp0hnmau.png)\n\n\n\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\u6ce8\u610f\u4eba\u50bb\u5e38\u6570\u5927\uff0c\u53ef\u80fd\u5361\u5e38\u3002\n\n```cpp\n#include<bits/stdc++.h>\n//default source omitted\n\nconstexpr int N = 5010, M = N<<1;\n\nclass AdjTab {\n    int head[N], tot, t[N], ind[N], outd[N];\n    struct { int u, v, w, nxt; } E[M];\npublic:\n    void addEdge(int u, int v, int w = 1) {\n        E[++tot] = {u, v, w, head[u]};\n        head[u] = t[u] = tot;\n        ++ind[v]; ++outd[u];\n    }\n    void next(int u) {\n        if(!t[u]) reset(u);\n        t[u] = E[t[u]].nxt;\n    }\n    bool ok(int u) {\n        if(!t[u]) {\n            reset(u);\n            return 0;\n        } else\n            return 1;\n    }\n    int ver(int u) const {\n        return E[t[u]].v;\n    }\n    int wei(int u) const {\n        return E[t[u]].w;\n    }\n    void reset(int u) {\n        t[u] = head[u];\n    }\n    int incnt(int u) const {\n        return ind[u];\n    }\n    int outcnt(int u) const {\n        return outd[u];\n    }\n    void clear(int n) {\n    \ttot = 1;\n    \tRpp(i, n)\n    \t\thead[i] = ind[i] = outd[i] = t[i] = 0;\n    \tRpp(i, n<<1)\n    \t\tE[i].u = E[i].v = E[i].w = E[i].nxt = 0;\n    }\n    AdjTab() { clear(N - 10); }\n} G;\ntypedef AdjTab Graph;\n//travel every edge of its:\n#define Trv(u) for(G.reset(u); G.ok(u); G.next(u))\n//However, this thing has a shortage:\n//if you go like Trv(u) Trv(u) it would break down\n\nclass Solver {\n\tGraph G;\n\tlong long dp[2][N], sz[N], x, y;\npublic:\n\tvoid addEdge(int u, int v, int w) {\n\t\tG.addEdge(u, v, w);\n\t}\n\tvoid clear(int n) {\n\t\tG.clear(n);\n\t\tRpp(i, n) Rep(j, 2)\n\t\t\tdp[j][i] = sz[i] = 0;\n\t}\n\tvoid dfs(int u, int p) {\n\t\t// cout << u << ' ' << p << endl << flush;\n\t\tsz[u] = 1;\n\t\tTrv(u) {\n\t\t\tint v = G.ver(u), w = G.wei(u);\n\t\t\t// cout << '#' << v << ' ' << w << endl;\n\t\t\tif(v == p) continue;\n\t\t\tdfs(v, u);\n\t\t\tdp[0][u] += dp[0][v] + 1ll * w * sz[v] * (x + y - sz[v]);\n\t\t\tsz[u] += sz[v];\n\t\t}\n\t\tdp[1][u] = Pinf;\n\t\tTrv(u) {\n\t\t\tint v = G.ver(u), w = G.wei(u);\n\t\t\tif(v == p) continue;\n\t\t\tCheckMin(dp[1][u], dp[0][u]\n\t\t\t\t- (dp[0][v] + 1ll * w * sz[v] * (x + y - sz[v]))\n\t\t\t\t+ min(dp[0][v], dp[1][v]) + 1ll * w * (x - sz[v]) * (y + sz[v]));\n\t\t}\n\t}\n\tlong long solve(int _x, int _y) {\n\t\tx = _x, y = _y;\n\t\tint rt = 1;\n\t\twhile(rt <= x+y && !G.incnt(rt)) ++rt;\n\t\tdfs(rt, 0);\n\t\treturn min(dp[0][rt], dp[1][rt]);\n\t}\n\tSolver() { clear(N - 10); }\n} g1, g2;\n\nint n, vis[N];\n\nvoid dfs(int u, int p, int bu, int bv) {\n\tvis[u] = 1;\n\tTrv(u) {\n\t\tint v = G.ver(u);\n\t\tif(u == bu && v == bv) continue;\n\t\tif(u == bv && v == bu) continue;\n\t\tif(v != p) dfs(v, u, bu, bv);\n\t}\n}\n\nlong long solve(int bu, int bv, int w) {\n\tg1.clear(n);\n\tg2.clear(n);\n\tRpp(i, n) vis[i] = 0;\n\tdfs(1, 0, bu, bv);\n\tRpp(u, n) Trv(u) {\n\t\tint v = G.ver(u), w = G.wei(u);\n\t\tif(u == bu && v == bv) continue;\n\t\tif(u == bv && v == bu) continue;\n\t\tif(vis[u]) g1.addEdge(u, v, w);\n\t\telse g2.addEdge(u, v, w);\n\t}\n\tint g1c = accumulate(vis+1, vis+n+1, 0ll), g2c = n - g1c;\n\t// cout << g1c << ' ' << g2c << endl;\n\treturn 1ll * g1c * g2c * w + g1.solve(g1c, g2c) + g2.solve(g2c, g1c);\n}\n\nsigned main()\n{\n\tios_base :: sync_with_stdio(0), cin.tie(0), cout.tie(0);\n\t\tcin >> n;\n\t\tG.clear(n);\n\t\tRpp(i, n-1) {\n\t\t\tint u, v, w;\n\t\t\tcin >> u >> v >> w;\n\t\t\tG.addEdge(u, v, w);\n\t\t\tG.addEdge(v, u, w);\n\t\t}\n\t\tlong long res = Pinf;\n\t\tRpp(u, n) {\n\t\t\tvector <pjj> vec;\n\t\t\tTrv(u) vec.push_back({G.ver(u), G.wei(u)});\n\t\t\tfor(const auto& P : vec) {\n\t\t\t\tint v = P.ff;\n\t\t\t\tif(u > v) continue;\n\t\t\t\tCheckMin(res, solve(u, v, P.ss));\n\t\t\t\t// cout << u << ' ' << v << ' ' << res << endl;\n\t\t\t}\n\t\t}\n\t\tcout << res << endl << flush;\n\t\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1680674066,
        "uid": 380730,
        "name": "LKX_Wata",
        "ccfLevel": 7,
        "title": "CF294E \u9898\u89e3"
    },
    {
        "content": "\u679a\u4e3e\u5220\u9664\u7684\u8fb9$(u,v)$ ,\u53ef\u4ee5\u5206\u522b\u5f97\u5230\u4ee5$u$,$v$\u4e3a\u6839\u7684\u4e24\u68f5\u6811\u3002\n\n\u663e\u7136\u5220\u9664\u6389\u7684\u4e24\u6761\u8fb9\u8d21\u732e\u4e3a$sz_u\\times sz_v\\times w(u,v)$\n\n\u63a5\u4e0b\u6765\u66b4\u529b\u8ba1\u7b97\u65b0\u8fde\u63a5\u7684\u8fb9\u8ba9\u4e24\u4e2a\u6811\u8d21\u732e\u6700\u5c0f\u3002\n\n$dp[u][0]=$\u65b0\u7684\u8fb9\u8fde\u63a5v\u5b50\u6811\u65f6\u8fd9\u4e2a\u5b50\u6811\u7684\u8d21\u732e\n\n$dp[u][1]=$\u65b0\u7684\u8fb9\u8fde\u63a5u\u5b50\u6811\u65f6\u8fd9\u4e2a\u5b50\u6811\u7684\u8d21\u732e\n\n\u5177\u4f53\u89c1\u4ee3\u7801\n```\n#include<bits/stdc++.h>\n#define ld long double\n#define test puts(\"QAQ\");\n#define int long long\n#define pb push_back\n#define pii pair<int,int> \n#define mp make_pair\n#define Max(a,b) (a>b)?a:b\nusing namespace std;\nconst long long inf=0x7f7f7f7f7f7f7f;\n\nconst int MAXN=10000000;\ninline char gc(){\n    static char In[MAXN],*at=In,*en=In;\n    return at==en&&(en=(at=In)+fread(In,1,MAXN,stdin)),at==en?EOF:*at++;\n}\ntemplate<class tp>\nvoid read(tp &x){\n    x=0;\n    char c=gc();\n    bool sgn=0;\n    while((c<'0'||c>'9')&&c!='-')c=gc();\n    if(c=='-')sgn=1,c=gc();\n    while(c>='0'&&c<='9')x=(x<<3)+(x<<1)+(c^'0'),c=gc();\n    if(sgn)x=-x;\n}\nchar _In[MAXN],*_at=_In;\ninline void flush(){fwrite(_In,1,_at-_In,stdout),_at=_In;}\nstruct _init{~_init(){flush();}}__init;\ninline void pc(char c){if(_at==_In+MAXN)flush();*_at++=c;}\ntemplate<class tp>\nvoid write(tp x){\n    if(!x){pc('0');return;}\n    static char buf[43],*at;\n    at=buf;\n    if(x<0)pc('-'),x=-x;\n    while(x)*at++=x%10+'0',x/=10;\n    do pc(*--at); while(at!=buf);\n}\n\nconst int N=5010;\nint n;\nint head[N],cnt;\nint sz[N];\nlong long dp[N][2];\nstruct edge\n{\n    int frm,nxt,to,val;\n}e[N<<2];\nvoid add_edge(int u,int v,int d)\n{\n    e[++cnt].nxt=head[u];\n    e[cnt].frm=u;\n    e[cnt].to=v;\n    e[cnt].val=d;\n    head[u]=cnt;\n}\nvoid dfs1(int u,int f)//size\n{\n    sz[u]=1;\n    for(int i=head[u];i!=-1;i=e[i].nxt)\n    {\n        int v=e[i].to;\n        if(v==f) continue;\n        dfs1(v,u);\n        sz[u]+=sz[v];\n    }\n}\nvoid dfs2(int u,int f,int rt)\n{    \n    dp[u][0]=0;\n    dp[u][1]=inf;\n    for(int i=head[u];i!=-1;i=e[i].nxt)\n    {\n        int v=e[i].to;\n        if(v==f) continue;\n        dfs2(v,u,rt);\n        dp[u][0]+=dp[v][0]+1ll*e[i].val*sz[v]*(n-sz[v]);\n    }\n    for(int i=head[u];i!=-1;i=e[i].nxt)\n    {\n        int v=e[i].to;\n        if(v==f) continue;\n        dp[u][1]=min(dp[u][1],dp[u][0]-dp[v][0]-1ll*e[i].val*sz[v]*(n-sz[v])+min(dp[v][0],dp[v][1])+1ll*e[i].val*(sz[rt]-sz[v])*(n-sz[rt]+sz[v]));\n    }\n}   \nsigned main()\n{\n    for(int i=1;i<N;i++) head[i]=-1;\n    read(n);\n    for(int i=1,u,v,w;i<n;i++)\n    {\n        read(u);read(v);read(w);\n        add_edge(u,v,w);\n        add_edge(v,u,w);\n    }\n    long long res=inf;\n    for(int i=1;i<=cnt;i+=2)//\u4e00\u6761\u8fb9\u4e0d\u7528\u5220\u4e24\u6b21\n    {\n        int u=e[i].frm,v=e[i].to;\n        dfs1(u,v),dfs1(v,u);\n        dfs2(u,v,u),dfs2(v,u,v);\n        res=min(res,min(dp[u][0],dp[u][1])+min(dp[v][0],dp[v][1])+1ll*e[i].val*sz[u]*sz[v]);\n    }\n    printf(\"%lld\\n\",res);\n}\n```\n",
        "postTime": 1603260325,
        "uid": 115779,
        "name": "\u6781\u5bd2\u795e\u51b0",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF294E \u3010Shaass the Great\u3011"
    }
]