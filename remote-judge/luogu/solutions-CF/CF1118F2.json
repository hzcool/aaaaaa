[
    {
        "content": "\u4e00\u5f00\u59cb\u6ca1\u60f3\u5230\u628a\u540c\u989c\u8272\u7684\u70b9\u7f29\u6210\u4e00\u4e2a\uff0c\u90a3\u5c31\u76f4\u63a5dp\u5427\n\n\u6211\u4eec\u9996\u5148\u5b9a\u4e49 $dp(i,0/1/2)$ \uff0c\n\n- $dp(i,0)$ \u8868\u793a $i$ \u7ed3\u70b9\u548c\u5176\u7236\u4eb2\u7ed3\u70b9\u7684\u8fde\u8fb9\u88ab\u65ad\u5f00\u4e14\u5b50\u6811\u5185\u65ad\u8fb9\u5408\u6cd5\u7684\u65b9\u6848\u6570\n- $dp(i,1)$ \u8868\u793a $i$ \u7ed3\u70b9\u548c\u5176\u7236\u4eb2\u8fde\u8fb9\u672a\u65ad\u5f00\u4e14\u5b50\u6811\u5185\u65ad\u8fb9\u5408\u6cd5\u7684\u65b9\u6848\u6570\n- $dp(i,2)$ \u8868\u793a $i$ \u7ed3\u70b9\u548c\u5176\u7236\u4eb2\u8fde\u8fb9\u672a\u65ad\u5f00\u4e14\u5b50\u6811\u5185\u65ad\u8fb9\u4e0d\u5408\u6cd5\uff08\u5373\u6709\u4e00\u79cd\u989c\u8272\u51fa\u73b0\u5728\u5b50\u6811\u5185\uff0c\u4f46\u672a\u88ab\u5b50\u6811\u5b8c\u5168\u5305\u62ec\uff0c\u8981\u5411\u5916\u5ef6\u4f38\uff09\u7684\u65b9\u6848\u6570\n\n\u6211\u4eec\u518d\u5f3a\u5236 $0$ \u7ed3\u70b9\u5168\u90e8\u805a\u6210\u4e00\u56e2\u800c $0$ \u7ed3\u70b9\u4e4b\u4e0b\u5408\u6cd5\u7684\u60c5\u51b5\u5f52\u4e3a $dp(i,0)$\uff0c\u5982\u4e0b\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/vn75q29e.png)\n\n\u5176\u4e2d\u70b9\u4e0a\u7684\u6807\u53f7\u4e3a\u70b9\u7684\u989c\u8272\uff0c\u7ea2\u8272\u4e3a\u65ad\u8fb9\u7684\u5730\u65b9\u3002\n\n\u518d\u5b9a\u4e49\uff0c$se$ \u8868\u793a\u5f53\u524d\u8282\u70b9\u7684\u989c\u8272\uff0c$col(i)$ \u8868\u793a\u5f53\u524d\u8282\u70b9\u672a\u5305\u542b\u7684\u90a3\u4e00\u4e2a\u989c\u8272\uff0c$col1(i)$ \u8868\u793a\u88ab\u5f53\u524d\u8282\u70b9\u6070\u597d\u5b8c\u5168\u8986\u76d6\u7684\u90a3\u4e00\u4e2a\u989c\u8272\uff0c$mul = \\prod\\limits_{v \\in son(i)}{(dp(v,0))}$\n\n\u63a5\u7740\u6211\u4eec\u6765\u63a8\u5f0f\u5b50\uff1a\n\n**1. $se = 0$**\n- $dp(i,0) = \\sum\\limits_{v \\in son(i)}{(\\dfrac{dp(v,1)}{dp(v,0)}mul)} + mul + \\prod\\limits_{v \\in son(i),col(v)=col1(i)}{(\\dfrac{dp(v,2)}{dp(v,0)})} \\times mul$\n- $dp(i,1) = \\sum\\limits_{v \\in son(i)}{(\\dfrac{dp(v,1)}{dp(v,0)}mul)} + \\prod\\limits_{v \\in son(i),col(v)=col1(i)}{(\\dfrac{dp(v,2)}{dp(v,0)})} \\times mul$\n- $dp(i,2) = \\prod\\limits_{v \\in son(i),col(v)=col(i)}{(\\dfrac{dp(v,2)}{dp(v,0)})} \\times mul$\n\n**2. $se \\ne 0$**\n- $dp(i,0) = \\prod\\limits_{v \\in son(i),col(v)=col1(i)}{(\\dfrac{dp(v,2)}{dp(v,0)})} \\times mul$\n- $dp(i,1) = \\prod\\limits_{v \\in son(i),col(v)=col1(i)}{(\\dfrac{dp(v,2)}{dp(v,0)})} \\times mul$\n- $dp(i,2) = \\prod\\limits_{v \\in son(i),col(v)=col(i)}{(\\dfrac{dp(v,2)}{dp(v,0)})} \\times mul$\n\n\n\u4e0b\u9762\u662fdp\u8f6c\u79fb\u7684\u89e3\u91ca\uff0c\n\n\u9996\u5148\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\u5982\u679c\u4e00\u4e2a\u70b9\u7684 $cnt(col) + cnt(col1) > 1$\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u4e2a\u70b9\u7684\u7236\u4eb2\u8fb9\u9700\u8981\u88ab\u4e24\u79cd\u989c\u8272\u7ecf\u8fc7\uff0c\u4e0d\u53ef\u80fd\uff0c\u663e\u7136\u7b54\u6848\u5c31\u662f $0$\n\n\u8fd9\u4e2a\u6027\u8d28\u8868\u660e\u4e86\uff0c\u4e00\u4e2a\u70b9\u6700\u591a\u53ea\u4f1a\u6709\u4e00\u4e2a $col$ \u6216 $col1$\n\n**1. $se = 0$**\n- $dp(i,0)$\uff0c\u5206\u4e3a\u4e09\u79cd\u7c7b\u578b\uff0c\n\t- \u7b2c\u4e00\u79cd\u662f\u513f\u5b50\u4e2d\u4e00\u4e2a\u70b9\u5360\u7528\u5f53\u524d\u70b9\u7684 $0$\uff0c\u5176\u4f59\u513f\u5b50\u548c\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\n\t- \u7b2c\u4e8c\u79cd\u662f\u6240\u6709\u513f\u5b50\u5747\u4e0e\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\n\t- \u7b2c\u4e09\u79cd\u662f\u5bf9\u4e8e\u4e00\u4e2a\u5f53\u524d\u70b9\u6070\u597d\u5b8c\u5168\u8986\u76d6\u7684\u989c\u8272\uff0c\u53ef\u4ee5\u5c06\u513f\u5b50\u4e2d\u4e0e\u5f53\u524d\u70b9\u6709\u8fde\u8fb9\u4e14\u989c\u8272\u90fd\u7b49\u4e8e $col1$ \u7684\u70b9\uff08\u5f53 $col1 \\ne 0$\uff09\u5408\u5e76\u6210\u4e00\u4e2a\u8054\u901a\u5757\uff0c\u5176\u4f59\u513f\u5b50\u548c\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\u3002\n- $dp(i,1)$\uff0c\u5373\u5411\u7236\u4eb2\u591a\u8fde\u4e86\u4e00\u6761\u8fb9\uff08\u6ce8\u610f\u5176\u4e2d\u70b9\u82e5\u5168\u4e3a $0$ \u5219\u5f52\u4e3a\u7b2c\u4e00\u79cd\u60c5\u51b5\uff09\uff0c\u5c31\u662f $dp(i,0)$ \u51cf\u53bb\u5176\u4e2d\u7b2c\u4e8c\u79cd\u5373\u6240\u6709\u513f\u5b50\u5747\u4e0e\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\u7684\u60c5\u51b5\u3002\n- $dp(i,2)$\uff0c\u6b64\u65f6\u5f53\u524d\u70b9\u6709\u672a\u5305\u542b\u7684\u989c\u8272\uff0c\u90a3\u4e48\u5c31\u662f\u513f\u5b50\u4e2d\u4e0e\u5f53\u524d\u70b9\u6709\u8fde\u8fb9\u4e14\u989c\u8272\u90fd\u7b49\u4e8e $col$ \u7684\u70b9\uff08\u5f53 $col \\ne 0$\uff09\u5408\u5e76\u6210\u4e00\u4e2a\u8054\u901a\u5757\uff0c\u5e76\u5411\u4e0a\u8fde\u8fb9\uff0c\u5176\u4f59\u513f\u5b50\u548c\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\u3002\n\n**2. $se \\ne 0$**\n- $dp(i,0)$\uff0c\u5c06\u513f\u5b50\u4e2d\u4e0e\u5f53\u524d\u70b9\u6709\u8fde\u8fb9\u4e14\u989c\u8272\u90fd\u7b49\u4e8e $col1$ \u7684\u70b9\u5408\u5e76\u6210\u4e00\u4e2a\u8054\u901a\u5757\uff0c\u5176\u4f59\u513f\u5b50\u548c\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\u3002\uff08\u6b64\u65f6\u82e5\u6709 $col1$\uff0c\u5219 $col1 = se$\uff09\n- $dp(i,1)$\uff0c\u53ea\u662f\u5f80\u4e0a\u591a\u8fde\u4e86\u4e00\u6761\u8fb9\uff0c\u548c $dp(i,0)$ \u4e00\u6837\u3002\n- $dp(i,2)$\uff0c\u5c06\u513f\u5b50\u4e2d\u4e0e\u5f53\u524d\u70b9\u6709\u8fde\u8fb9\u4e14\u989c\u8272\u90fd\u7b49\u4e8e $col$ \u7684\u70b9\u5408\u5e76\u6210\u4e00\u4e2a\u8054\u901a\u5757\uff0c\u5e76\u5411\u4e0a\u8fde\u8fb9\uff0c\u5176\u4f59\u513f\u5b50\u548c\u5f53\u524d\u70b9\u65e0\u8fde\u8fb9\u3002\uff08\u6b64\u65f6\u82e5\u6709 $col$\uff0c\u5219 $col = se$\uff09\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u8f6c\u79fb\u5b8c\u4e86\uff0c\u63a5\u4e0b\u6765\u8bb2\u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u70b9\uff0c\n- \u6ce8\u610f $dp(i,0)$ \u53ef\u80fd\u4f1a\u7b49\u4e8e $0$\uff0c\u4e0d\u80fd\u76f4\u63a5\u9664\n- \u5bf9\u4e8e\u5b50\u6811\u4e2d\u4e00\u4e2a\u989c\u8272\u90fd\u6ca1\u6709\u7684\u70b9\uff0c\u6211\u4eec\u9700\u8981\u76f4\u63a5\u8df3\u8fc7\uff0c\u4e0d\u7136\u53ef\u80fd\u4f1a\u9020\u6210\u9519\u8bef\u8ba1\u7b97\n- \u5bf9\u4e8e\u53f6\u5b50\u7ed3\u70b9\uff0c\u82e5 $se = 0$ \u5219\u4f1a\u88ab\u76f4\u63a5\u8df3\u8fc7\uff0c\u82e5 $se \\ne 0$\uff0c\u82e5\u5f53\u524d\u989c\u8272\u4e00\u5171\u53ea\u6709 $1$ \u4e2a\uff0c$dp(i,0)=1$\uff0c$dp(i,1)=1$\uff0c$dp(i,2)=0$\uff0c\u5426\u5219\uff0c$dp(i,0)=0$\uff0c$dp(i,1)=0$\uff0c$dp(i,2)=1$\n- \u5bf9\u4e8e\u6839\u8282\u70b9\uff0c\u7531\u4e8e\u4e0d\u80fd\u6709\u7eaf $0$ \u7684\u8054\u901a\u5757\uff0c\u56e0\u6b64\u7b54\u6848\u5e94\u8be5\u4e3a $(dp(rt,0) - mul)$\n- \u6c42\u89e3 $col$ \u548c $col1$\uff0c\u6211\u4eec\u8003\u8651\u8986\u76d6\u51fa\u5176\u4e24\u4e24\u4e4b\u95f4\u70b9\u53ca\u8def\u5f84\u6784\u6210\u7684\u6574\u4e2a\u8054\u901a\u5757\uff0c\u5e76\u5728\u5176\u4e2d\u5224 $0$\uff0c\u5bf9\u4e8e\u8986\u76d6\u6c42\u989c\u8272\u7684\u8054\u901a\u5757\u53ef\u4ee5\u7528\u7c7b\u4f3c\u4e8e\u865a\u6811\u7684\u65b9\u6cd5\uff0c\u5c06\u6240\u6709\u70b9\u6309\u7167dfs\u5e8f\u6392\u5e8f\uff0c\u7136\u540e\u7528\u6808\u7ef4\u62a4\u4e00\u4e2adfs\u5e8f\u9012\u589e\u7684\u5e8f\u5217\uff0c\u6bcf\u6b21\u6309\u7167\u5355\u8c03\u6808\u7684\u601d\u8def\u66f4\u65b0\u5373\u53ef\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long a,b,d[300001],q,w,o,h[300001],dp[300001][3],an,mod=998244353,col[300001],col1[300001];//col \u672a\u5305\u542b\uff0ccol1\u521a\u597d\u5305\u542b\nlong long fa[300001][21],de[300001],lg[300001],dfn[300001],cnt,su[300005],pr[300005],g[300005],st[300005],cn,v[300001]; \nstruct p\n{\n\tlong long q,w;\n}l[600001];\nvoid add(long long qq,long long ww)\n{\n\to++;\n\tl[o].q=ww;\n\tl[o].w=h[qq];\n\th[qq]=o;\n}\nlong long pow_(long long qq,long long ww)\n{\n\tlong long ee=1;\n\twhile(ww)\n\t{\n\t\tif(ww&1)\n\t\t{\n\t\t\tee*=qq;\n\t\t\tee%=mod;\n\t\t}\n\t\tqq*=qq;\n\t\tqq%=mod;\n\t\tww>>=1;\n\t}\n\treturn ee%mod;\n}\nvoid dfs(long long qq,long long ww)\n{\n\tlong long mul=1,cnn=0;\n\tsu[0]=1;\n\tfor(int i=h[qq];i;i=l[i].w)\n\t{\n\t\tif(l[i].q!=ww)\n\t\t{\n\t\t\tif(v[l[i].q]==0) continue;\n\t\t\tdfs(l[i].q,qq);\n\t\t\tmul*=dp[l[i].q][0];\n\t\t\tmul%=mod;\n\t\t}\n\t}\n\tfor(int i=h[qq];i;i=l[i].w)\n\t{\n\t\tif(l[i].q!=ww)\n\t\t{\n\t\t\tif(v[l[i].q]==0) continue;\n\t\t\tcnn++;\n\t\t\tsu[cnn]=su[cnn-1]*dp[l[i].q][0]%mod;\n\t\t\tg[cnn]=dp[l[i].q][0];\n\t\t}\n\t}\n\tpr[cnn+1]=1;\n\tfor(int i=cnn;i>=1;i--)\n\t{\n\t\tpr[i]=pr[i+1]*g[i]%mod;\n\t}\n\tcnn=0;\n\tlong long la=0;\n\tfor(int i=h[qq];i;i=l[i].w)\n\t{\n\t\tif(l[i].q!=ww)\n\t\t{\n\t\t\tif(v[l[i].q]==0) continue;\n\t\t\tcnn++;\n\t\t\tif(d[qq]==0)\n\t\t\t{\n\t\t\t\tdp[qq][0]+=dp[l[i].q][1]%mod*su[cnn-1]%mod*pr[cnn+1]%mod;\n\t\t\t\tdp[qq][0]%=mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(col1[qq])\n\t{\n\t\tlong long tt=1,mu=1;\n\t\tfor(int i=h[qq];i;i=l[i].w)\n\t\t{\n\t\t\tif(l[i].q!=ww)\n\t\t\t{\n\t\t\t\tif(v[l[i].q]==0) continue;\n\t\t\t\tif(col[l[i].q]==col1[qq])\n\t\t\t\t{\n\t\t\t\t\ttt*=dp[l[i].q][2];\n\t\t\t\t\ttt%=mod;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmu*=dp[l[i].q][0];\n\t\t\t\t\tmu%=mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttt*=mu;\n\t\ttt%=mod;\n\t\tdp[qq][0]+=tt;\n\t\tdp[qq][0]%=mod;\n\t}\n\tif(col[qq])\n\t{\n\t\tlong long tt=1,mu=1;\n\t\tfor(int i=h[qq];i;i=l[i].w)\n\t\t{\n\t\t\tif(l[i].q!=ww)\n\t\t\t{\n\t\t\t\tif(v[l[i].q]==0) continue;\n\t\t\t\tif(col[l[i].q]==col[qq])\n\t\t\t\t{\n\t\t\t\t\ttt*=dp[l[i].q][2]%mod;\n\t\t\t\t\ttt%=mod;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmu*=dp[l[i].q][0];\n\t\t\t\t\tmu%=mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttt*=mu;\n\t\ttt%=mod;\n\t\tdp[qq][2]+=tt;\n\t\tdp[qq][2]%=mod;\n\t}\n\tdp[qq][1]=dp[qq][0];\n\tif(d[qq]==0)\n\t{\n\t\tdp[qq][0]+=mul;\n\t\tdp[qq][0]%=mod;\n\t}\n\tif(qq==1)\n\t{\n\t\tif(d[qq]!=0)\n\t\t{\n\t\t\tan=dp[qq][0];\n\t\t}\n\t\telse an=dp[qq][0]-mul;\n\t\tan%=mod;\n\t\tan+=mod;\n\t\tan%=mod;\n\t}\n}\nlong long lca(long long qq,long long ww)\n{\n\tif(de[qq]<de[ww]) swap(qq,ww);\n\twhile(de[qq]>de[ww])\n\t{\n\t\tqq=fa[qq][lg[de[qq]-de[ww]]-1];\n\t}\n\tif(qq==ww) return qq;\n\tfor(int i=20;i>=0;i--)\n\t{\n\t\tif(fa[qq][i]!=fa[ww][i])\n\t\t{\n\t\t\tqq=fa[qq][i];\n\t\t\tww=fa[ww][i];\n\t\t}\n\t}\n\treturn fa[qq][0];\n}\nvoid dfs1(long long qq,long long ww)\n{\n\tdfn[qq]=++cnt;\n\tfa[qq][0]=ww;\n\tfor(int i=1;i<=20;i++)\n\t{\n\t\tfa[qq][i]=fa[fa[qq][i-1]][i-1];\n\t}\n\tde[qq]=de[ww]+1;\n\tif(d[qq]!=0) v[qq]=1;\n\tfor(int i=h[qq];i;i=l[i].w)\n\t{\n\t\tif(l[i].q!=ww)\n\t\t{\n\t\t\tdfs1(l[i].q,qq);\n\t\t\tv[qq]|=v[l[i].q];\n\t\t}\n\t}\n}\nvector<long long> qu[300001];\nbool cmp(long long qq,long long ww)\n{\n\treturn dfn[qq]<dfn[ww];\n}\nint main()\n{\n\tfor(int i=1;i<=300000;i++)\n\t{\n\t\tlg[i]=lg[i-1]+((1<<lg[i-1])==i);\n\t}\n\tscanf(\"%lld\",&a);\n\tb=2;\n\tscanf(\"%lld\",&b);\n\tfor(int i=1;i<=a;i++)\n\t{\n\t\tscanf(\"%lld\",&d[i]);\n\t\tqu[d[i]].push_back(i);\n\t}\n\tfor(int i=1;i<a;i++)\n\t{\n\t\tscanf(\"%lld%lld\",&q,&w);\n\t\tadd(q,w);\n\t\tadd(w,q);\n\t}\n\tdfs1(1,0);\n\tfor(int i=1;i<=b;i++)\n\t{\n\t\tsort(qu[i].begin(),qu[i].end(),cmp);\n\t\tcn=0;\n\t\tst[++cn]=qu[i][0];\n\t\tfor(int j=1;j<qu[i].size();j++)\n\t\t{\n\t\t\tlong long gg=lca(st[cn],qu[i][j]);\n\t\t\tif(gg!=st[cn])\n\t\t\t{\n\t\t\t\twhile(dfn[gg]<dfn[st[cn-1]])\n\t\t\t\t{\n\t\t\t\t\tlong long uu=st[cn];\n\t\t\t\t\twhile(de[uu]>de[st[cn-1]])\n\t\t\t\t\t{\n\t\t\t\t\t\tif(col[uu]||col1[uu])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tprintf(\"0\");\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcol[uu]=i;\n\t\t\t\t\t\tuu=fa[uu][0];\n\t\t\t\t\t}\n\t\t\t\t\tcn--;\n\t\t\t\t}\n\t\t\t\tif(dfn[gg]==dfn[st[cn-1]])\n\t\t\t\t{\n\t\t\t\t\tlong long uu=st[cn];\n\t\t\t\t\twhile(de[uu]>de[st[cn-1]])\n\t\t\t\t\t{\n\t\t\t\t\t\tif(col[uu]||col1[uu])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tprintf(\"0\");\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcol[uu]=i;\n\t\t\t\t\t\tuu=fa[uu][0];\n\t\t\t\t\t}\n\t\t\t\t\tcn--;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlong long uu=st[cn];\n\t\t\t\t\twhile(de[uu]>de[gg])\n\t\t\t\t\t{\n\t\t\t\t\t\tif(col[uu]||col1[uu])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tprintf(\"0\");\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcol[uu]=i;\n\t\t\t\t\t\tuu=fa[uu][0];\n\t\t\t\t\t}\n\t\t\t\t\tcn--;\n\t\t\t\t\tst[++cn]=gg;\n\t\t\t\t}\n\t\t\t}\n\t\t\tst[++cn]=qu[i][j];\n\t\t}\n\t\tlong long tt=st[cn];\n\t\twhile(de[tt]>de[st[1]])\n\t\t{\n\t\t\tif(col[tt]||col1[tt])\n\t\t\t{\n\t\t\t\tprintf(\"0\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tcol[tt]=i;\n\t\t\ttt=fa[tt][0];\n\t\t}\n\t\tif(col[tt]||col1[tt])\n\t\t{\n\t\t\tprintf(\"0\");\n\t\t\treturn 0;\n\t\t}\n\t\tcol1[tt]=i;\n\t}\n\tdfs(1,0);\n\tprintf(\"%lld\",an);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1634301754,
        "uid": 205356,
        "name": "zaozao_zmx",
        "ccfLevel": 0,
        "title": "CF1118F2 \u9898\u89e3"
    },
    {
        "content": "\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u4e2a\u9898\u51fa\u7684\u4e0d\u9519\uff0c\u4f46\u662f\u6709\u70b9\u4e8c\u5408\u4e00\u7684\u611f\u89c9\u5427\uff0c\u60f3\u6cd5\u8fd8\u662f\u6bd4\u8f83\u81ea\u7136\u7684\n\n---\n\n\u53cd\u8fc7\u6765\u601d\u8003\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u6211\u4eec\u8bbe\u8ba1\u4e24\u79cd\u72b6\u6001\uff0c\u4e00\u79cd\u5bf9\u4e8e\u5f53\u524d**\u5212\u5206\u989c\u8272**\u5df2\u786e\u5b9a\u7684\u65b9\u6848\u6570 $f[u][0]$ ,\u4e00\u79cd\u5bf9\u4e8e\u5f53\u524d**\u5212\u5206\u989c\u8272**\u672a\u786e\u5b9a\u7684\u65b9\u6848\u6570 $f[u][1]$\n\n\u6709\u4e00\u4e2a\u663e\u7136\u7684\u7ed3\u8bba\u5c31\u662f\u76f8\u540c\u989c\u8272\u7684\u8282\u70b9\u4e00\u5b9a\u88ab\u5212\u5206\u5728\u540c\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d\uff0c\u56e0\u4e3a\u4f60\u53ea\u6709 $k$ \u79cd\u989c\u8272\uff0c\u8981\u5212\u5206 $k$ \u4e2a\u8fde\u901a\u5757\n\n\u5b9a\u4e49\u4e00\u4e2a\u8282\u70b9\u7684**\u5212\u5206\u989c\u8272**\u4e3a\u6839\u636e\u4e0a\u8ff0\u6027\u8d28\uff0c\u80fd\u591f\u786e\u5b9a\u8be5\u8282\u70b9\u88ab\u5206\u5728\u7684\u8fde\u901a\u5757\u7684\u989c\u8272\n\n\u5728\u540e\u9762\uff0c\u6211\u4eec\u4f1a\u5177\u4f53\u9610\u8ff0\u600e\u4e48\u786e\u5b9a\u8fd9\u4e9b\u70b9\u662f\u88ab\u5212\u5206\u8fd8\u662f\u672a\u88ab\u5212\u5206\n\n\u6211\u4eec\u8003\u8651\u6bcf\u4e00\u4e2a\u5df2\u7ecf\u786e\u5b9a\u88ab\u5212\u5206\u7684\u70b9\uff0c\u548c\u6bcf\u4e00\u4e2a\u672a\u88ab\u67d3\u8272\u4e14\u4e0d\u786e\u5b9a\u662f\u5426\u8981\u88ab\u5212\u5206\u7684\u70b9\n\n\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u786e\u5b9a\u88ab\u5212\u5206\u7684\u70b9 $u$\uff0c\u663e\u7136 $f[u][1]=0$ \n\n\u8003\u8651\u5b83\u7684\u4e00\u4e2a\u5b50\u8282\u70b9 $v$ \uff0c\u5982\u679c\u5b50\u8282\u70b9 $v$ \u5df2\u7ecf\u62e5\u6709\u4e86**\u5212\u5206\u989c\u8272**\uff0c\u90a3\u4e48\u5bf9\u4e8e $f[u][0]$ \u6765\u8bf4\u663e\u7136\u53ef\u4ee5\u7ee7\u627f $f[v][0]$ \uff0c\u5982\u679c\u5b50\u8282\u70b9 $v$ \u6ca1\u6709**\u5212\u5206\u989c\u8272**\uff0c\u90a3\u4e48\u5b83\u53ea\u80fd\u88ab\u5b83\u7684\u7236\u4eb2\u67d3\u8272\n\n\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230 $f[u][0]=\\mathop{\\Pi}\\limits_{v}(f[v][0]+f[v][1])$\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6ca1\u6709\u786e\u5b9a\u88ab\u5212\u5206\u7684\u70b9 $u$ \uff0c\u663e\u7136 $f[u][1]=\\mathop{\\Pi}\\limits_{v}(f[v][0]+f[v][1])$\n\n\u7531\u4e8e\u8fd9\u4e2a\u70b9\u672a\u88ab\u5212\u5206\uff0c\u6211\u4eec\u8981\u8003\u8651\u9009\u4e2d\u8be5\u8282\u70b9\u7684\u4e00\u4e2a\u5b50\u8282\u70b9 $v$ \uff0c\u53bb\u67d3\u8272\u8282\u70b9 $u$\n\n\u6240\u4ee5$\\huge f[u][0]=\\sum\\limits_{v}\\frac{\\mathop{\\Pi}\\limits_{v}(f[v][0]+f[v][1])}{f[v][0]+f[v][1]}f[v][0]$\n\n\u7b97\u4e0a\u6c42\u9006\u5143\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u8fd9\u4e00\u90e8\u5206\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(nlogn)$ \u7684\n\n---\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u5212\u5206\n\n\u5bf9\u4e8e\u4efb\u610f\u4e24\u4e2a\u76f8\u540c\u989c\u8272\u7684\u70b9\uff0c\u4ed6\u4eec\u7b80\u5355\u8def\u5f84\u4e0a\u7684\u6240\u6709\u70b9\u90fd\u4f1a\u88ab\u5212\u5206\u5230\u540c\u4e00\u4e2a\u8fde\u901a\u5757\n\n\u5f88\u5bb9\u6613\u60f3\u5230\u4e00\u4e2a $n^2logn$ \u7684\u505a\u6cd5\uff0c\u66b4\u529b\u679a\u4e3e\u4e24\u4e2a\u70b9\uff0c\u968f\u4fbf\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u63a8\u5e73\u4e00\u4e0b\n\n\u4f46\u663e\u7136\u6211\u4eec\u6709\u66f4\u4f18\u79c0\u7684\u505a\u6cd5\n\n\u6211\u4eec\u7528\u4e00\u4e2a\u4f18\u5148\u961f\u5217\u7ef4\u62a4\u6bcf\u4e00\u4e2a\u5df2\u7ecf\u88ab\u67d3\u8272\u7684\u70b9\uff0c\u6bcf\u6b21\u53d6\u51fa\u6df1\u5ea6\u6700\u5927\u7684\u70b9\n\n\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\u7684\u7236\u4eb2\uff0c\u5982\u679c\u5f53\u524d\u8282\u70b9\u7684\u989c\u8272\u4e0e\u7236\u4eb2\u76f8\u540c\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u8282\u70b9\u5f39\u51fa\u961f\u5217\u540e\uff0c\u8fd9\u4e2a\u989c\u8272\u5728\u961f\u5217\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u9700\u8981\u51cf $1$\n\n\u5982\u679c\u5728\u961f\u5217\u4e2d\u8fd9\u4e2a\u8282\u70b9\u7684\u989c\u8272\u4e0d\u53ea\u4e00\u6b21\u51fa\u73b0\uff0c\n\n\u6211\u4eec\u8003\u8651\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\uff1a\n\n$1.$\u7236\u4eb2\u5df2\u7ecf\u6709\u989c\u8272\u4e14\u989c\u8272\u4e0e\u5f53\u524d\u8282\u70b9\u4e0d\u540c\uff0c\u6b64\u65f6\u663e\u7136\u65e0\u89e3\n\n$2.$\u7236\u4eb2\u6ca1\u6709\u989c\u8272\uff0c\u6b64\u65f6\u8981\u901a\u8fc7\u7236\u4eb2\u4e0e\u5176\u4ed6\u8282\u70b9\u8054\u901a\uff0c\u6211\u4eec\u628a\u7236\u4eb2\u5212\u5206\u5230\u4e0e\u5f53\u524d\u8282\u70b9\u540c\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d\uff0c\u5e76\u628a\u7236\u4eb2\u52a0\u5165\u961f\u5217\uff0c\u6ce8\u610f\u5230\u6b64\u65f6\u8be5\u989c\u8272\u5728\u961f\u5217\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u4e00\u8fdb\u4e00\u51fa\uff0c\u6ca1\u6709\u53d8\u5316\uff0c\u4e0d\u9700\u8981\u66f4\u65b0\n\n\u8fd9\u4e00\u90e8\u5206\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(nlogn)$ \u7684\uff0c\u56e0\u6b64\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nlogn)$\n\n**Code:**\n\n```cpp\n#include<bits/stdc++.h>\n \n#define rd(x) x=read()\n \n#define N 300005\n \nusing namespace std;\n \nint n,k;\nvector<int>e[N];\nint a[N],c[N],dep[N],fa[N],f[N][2];\n \nstruct P{\n\tint x,dep;\n\tP(int _x=0,int _dep=0){x=_x,dep=_dep;}\n\tinline bool operator < (const P &r)const{return dep<r.dep;}\n};\n \ninline int read()\n{\n    int x=0,f=1;char ch=getchar();\n    while(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\n \ninline void write(int x)\n{\n    if(x<0){putchar('-');x=-x;}\n    if(x>=10)write(x/10);\n    putchar(x%10+'0');\n}\n \nconst int p=998244353;\n \ninline int fastPow(int a,int b){int ans=1;for(;b;b>>=1,a=1ll*a*a%p)if(b&1)ans=1ll*ans*a%p;return ans;}\n \ninline int inv(int x){return fastPow(x,p-2);}\n \ninline void addEdge(int u,int v){e[u].push_back(v);}\n \nvoid dfs(int u,int faa)\n{\n\tdep[u]=dep[faa]+1,fa[u]=faa;\n\tfor(int i=0;i<e[u].size();i++)\n\t{\n\t\tint v=e[u][i];\n\t\tif(v==faa)continue;\n\t\tdfs(v,u);\n\t}\n}\n \npriority_queue<P>q;\n \nvoid dfss(int u)\n{\n\tint t=1;\n\tfor(int i=0;i<e[u].size();i++)\n\t{\n\t\tint v=e[u][i];\n\t\tif(v==fa[u])continue;\n\t\tdfss(v),t=1ll*t*(f[v][0]+f[v][1])%p;\n\t}\n\tif(a[u])f[u][0]=t,f[u][1]=0;\n\telse\n\t{\n\t\tf[u][0]=0,f[u][1]=t; \n\t\tfor(int i=0;i<e[u].size();i++)\n\t\t{\n\t\t\tint v=e[u][i];\n\t\t\tif(v==fa[u])continue;\n\t\t\tf[u][0]=(f[u][0]+1ll*f[u][1]*inv(f[v][0]+f[v][1])%p*f[v][0]%p)%p;\n\t\t}\n\t}\n}\n \nint main()\n{\n\trd(n),rd(k);\n\tfor(int i=1;i<=n;i++)rd(a[i]),c[a[i]]++;\n\tfor(int i=1,u,v;i<n;i++)rd(u),rd(v),addEdge(u,v),addEdge(v,u);\n\tdfs(1,0);for(int i=1;i<=n;i++)if(a[i])q.push(P(i,dep[i])); \n\twhile(!q.empty())\n\t{\n\t\tP tp=q.top();q.pop();\n\t\tint u=tp.x,faa=fa[u];\n\t\tif(a[u]==a[faa])c[a[u]]--;\n\t\telse if(c[a[u]]!=1)\n\t\t{\n\t\t\tif(a[faa]){return puts(\"0\"),0;}\n\t\t\telse a[faa]=a[u],q.push(P(faa,dep[faa])); \n\t\t}\n\t}\n\tdfss(1);cout<<f[1][0]<<endl;\n\t\n \n \n    return 0;\n}\n```",
        "postTime": 1574341073,
        "uid": 53807,
        "name": "Erusel",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1118F2 \u3010Tree Cutting (Hard Version)\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[$luogu$](https://www.luogu.org/problem/CF1118F2).\n# \u9898\u89e3\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e00\u9053\u795e\u5947\u7684\u6811\u5f62$DP$, \u96be\u5ea6\u5927\u6982\u5728\u7d2b\u9898\u5230\u9ed1\u9898, \u7ba1\u7406\u5458\u5927\u5927\u53ef\u4ee5\u5b8c\u5584\u4e00\u4e0b...\n## $Part_1$ \u95ee\u9898\u8f6c\u5316\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u53ef\u80fd\u7ffb\u8bd1\u4e0d\u592a\u51c6\u786e, \u5fc5\u987b\u5f3a\u8c03\u7684\u662f, \u7ed9\u5b9a\u7684\u6811\u4fdd\u8bc1$k$\u79cd\u989c\u8272\u7684\u7ed3\u70b9\u90fd\u4f1a\u51fa\u73b0. \u90a3\u4e48\u7531\u4e8e\u53ea\u80fd\u5212\u5206\u4e3a$k$\u4e2a\u8fde\u901a\u5757, \u6240\u4ee5\u53ef\u4ee5\u53d1\u73b0\u91cd\u8981\u7684\u9690\u542b\u6761\u4ef6:  \n> **\u540c\u79cd\u989c\u8272\u7684\u7ed3\u70b9\u4e00\u5b9a\u5728\u540c\u4e00\u4e2a\u8054\u901a\u5757\u4e2d**.  \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7406\u89e3\u5230\u8fd9\u4e00\u70b9, \u5176\u5b9e\u95ee\u9898\u5df2\u7ecf\u5e76\u4e0d\u590d\u6742\u4e86. ( \u8fd9\u4e00\u7ed3\u8bba\u4f1a\u5728\u4e0b\u6587\u53cd\u590d\u5e94\u7528, \u6211\u4eec\u7ed9\u5b83\u53d6\u4e00\u4e2a\u597d\u542c\u7684\u540d\u5b57: $X$\u7ed3\u8bba. ( \u5927\u96fe$QwQ$ ) )\n## $Part_2$ \u65e0\u89e3\u5224\u5b9a\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7531\u4e0a\u6587\u7ed3\u8bba, \u4f60\u4f1a\u53d1\u73b0\u8fd9\u5f88\u7b80\u5355\u5427? ( \u96fe )  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9\u4e8e\u7b2c$i$\u79cd\u989c\u8272\u7684\u6240\u6709\u7ed3\u70b9, \u6211\u4eec\u627e\u5230\u5b83\u4eec\u7684$LCA$ ( \u4ee4\u4e3a$LCA_i$ ). \u5982\u679c\u4efb\u610f\u4e00\u4e2a\u989c\u8272\u4e3a$i$\u7684\u7ed3\u70b9$u$\u5230$LCA$\u7684\u8def\u5f84\u4e0a\u6709\u5176\u5b83\u989c\u8272\u7684\u7ed3\u70b9, \u6216\u8005\u4e0e\u5176\u5b83\u989c\u8272\u7684\u8def\u5f84\u76f8\u4ea4, \u663e\u7136\u65e0\u6cd5\u6ee1\u8db3$X$\u7ed3\u8bba, \u5224\u5b9a\u4e3a\u65e0\u89e3.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5728\u8fd9\u4e00\u73af\u8282, \u590d\u6742\u5ea6\u5747\u644a$O(n\\log n)$, \u4e0d\u7528\u62c5\u5fc3\u8d85\u65f6.\n## $Part_3$ \"\u7f29\u70b9\"\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd8\u662f\u901a\u8fc7\u6211\u4eec\u53ef\u7231\u7684$X$\u7ed3\u8bba, **\u4efb\u610f\u4e00\u4e2a\u989c\u8272\u4e3a$i$\u7684\u7ed3\u70b9$u$\u5230$LCA_i$\u8def\u5f84\u4e0a\u7684\u6240\u6709\u7ed3\u70b9\u4e00\u5b9a\u4f1a\u88ab\u5212\u5206\u5230\u989c\u8272\u4e3a$i$\u7684\u8054\u901a\u5757\u4e2d.** \u6240\u4ee5\u8fd9\u4e9b\u7ed3\u70b9\u5c31\u4e0d\u4f1a\u4ea7\u751f\u591a\u79cd\u60c5\u51b5\u4e86. \u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u7f29\u6210\u4e00\u4e2a\u989c\u8272\u4e3a$i$\u7684\u70b9. \u4f8b\u5982 ( \u672c\u849f\u84bb\u6df1\u77e5\u6ca1\u56fe\u7684\u75db\u82e6 ):  \n![CF1118F2_P1](https://cdn.luogu.com.cn/upload/image_hosting/b8h5o7je.png)  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5f53\u7136, \u5728\u7a0b\u5e8f\u5b9e\u73b0\u65b9\u9762, \u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5efa\u7acb\u65b0\u56fe. \u5728\u8fdb\u884c$part_2$\u7684\u65f6\u5019, \u6211\u4eec\u66b4\u529b\u5c06\u6240\u6709\u8def\u5f84\u4e0a\u7684\u7ed3\u70b9\u67d3\u4e3a\u989c\u8272$i$, \u8ba9$LCA_i$\u4f5c\u4e3a\"\u9996\u9886\"\u63a5\u6536\u6240\u6709\u989c\u8272\u4e3a$i$\u7684\u7ed3\u70b9\u7684\u72b6\u6001\u66f4\u65b0\u4fe1\u606f\u5373\u53ef. \u6b64\u5904\u5c06\u5728$part_5$\u5177\u4f53\u5206\u6790.\n## $Part_4$ $DP$\u7684\u5b9a\u4e49\u53ca\u8f6c\u79fb\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( \u7531\u4e8e$luogu$\u7684$KaTeX$\u6e32\u67d3\u6bd4\u8f83\u7075\u6027, \u4e00\u4e9b\u6c42\u548c\u6c42\u79ef\u7684\u5f0f\u5b50\u8bf7\u81ea\u884c\u8111\u8865\u4e0b\u6807... )  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u5728\u4e00\u6ce2\u7075\u9b42\u5206\u6790\u4e4b\u540e,~~ \u5b9a\u4e49\u72b6\u6001$f(u,0/1)$\u8868\u793a, **\u7ed3\u70b9$u$(\u6ca1\u6709\u5212\u5165/\u5212\u5165)\u67d0\u4e2a\u5e26\u989c\u8272\u7684\u8fde\u901a\u5757\u65f6, \u4ee5$u$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u5212\u5206\u65b9\u6848**.  \n\n![CF1118F2_P2](https://cdn.luogu.com.cn/upload/image_hosting/bk489r3v.png) \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9\u4e8e$u$\u7684\u989c\u8272$c_u$\u662f\u5426\u4e3a$0$, \u8f6c\u79fb\u65b9\u7a0b\u662f\u4e0d\u540c\u7684:  \n\n### $a)~c_u=0$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9\u4e8e\u6b64\u65f6\u7684$f(u,0)$, \u968f\u9047\u800c\u5b89\u7684\u65e0\u8272\u7ed3\u70b9$u$\u5c31\u50cf\u4e0d\u5b58\u5728\u4e00\u6837, \u6240\u4ee5\u7531\u4e58\u6cd5\u539f\u7406:  \n$$\nf(u,0)=\\prod(f(v,0)+f(v,1))\n$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9\u4e8e\u6b64\u65f6\u7684$f(u,1)$, \u6211\u4eec\u4efb\u610f\u94a6\u5b9a\u4e0e$u$\u76f8\u8fde\u7684\u4e00\u4e2a\u5e26\u8272\u5757\u4e0e$u$\u76f8\u8fde, \u5176\u4f59\u7684\u968f\u4fbf\u9009\u5373\u53ef. \u4ee4$t=\\prod(f(v,0)+f(v,1))$:  \n$$\nf(u,1)=\\sum(\\frac{t\\times f(v,1)}{f(v,0)+f(v,1)})\n$$  \n### $b)~c_u\\not=0$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6ce8\u610f, \u6211\u4eec\u73b0\u5728\u8ba8\u8bba\u7684\u662f$part_3$\u7f29\u70b9\u4e4b\u540e\u7684\u6811. \u6240\u4ee5, \u5982\u679c\u6b64\u65f6\u7684$u$\u518d\u4e0d\u6784\u6210\u5e26\u8272\u5757, \u5b83\u5c31\u518d\u4e5f\u6ca1\u6709\u673a\u4f1a\u4e86. \u5bf9\u4e8e\u6b64\u65f6\u7684$f(u,0)$, \u5f53\u7136\u662f:  \n$$\nf(u,0)=0\n$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u628a$u$\u5206\u5230\u4e00\u4e2a\u5e26\u8272\u5757\u91cc, \u8fd9\u4e2a\u5757\u663e\u7136\u662f\u65b0\u7684. \u540c\u6837\u662f\u8ba9\u5b50\u6811\u4efb\u610f\u5206\u914d, \u7136\u540e\u8ba9\u72b6\u6001\u4e3a$0$\u7684\u4e0e$u$\u8054\u901a, \u6240\u4ee5\u6b64\u65f6\u7684$f(u,1)$, \u6709:  \n$$\nf(u,1)=\\prod_{v\\in son_u}(f(v,0)+f(v,1))\n$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6ca1\u9519, \u5b83\u548c$c_u=0$\u65f6\u7684$f(u,0)$\u957f\u5f97\u4e00\u6a21\u4e00\u6837.  \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Now~let's~sum~up$:  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( \u8fd9\u662f\u5bf9\u8f6c\u79fb\u65b9\u7a0b\u7684\u6574\u7406, \u4e0a\u6587\u5747\u6709\u63d0\u53ca, \u82e5$KaTeX$\u7206\u70b8\u53ef\u4ee5\u653e\u5fc3\u8df3\u8fc7. )  \n$$\nf(u,0)=\\lbrack c_u=0\\rbrack\\prod(f(v,0)+f(v,1))\n$$  \n\n$$\nf(u,1)=\\sum(\\frac{t\\times f(v,1)}{f(v,0)+f(v,1)}),c_u=0\n$$  \n\n$$\nf(u,1)=\\prod_{v\\in son_u}(f(v,0)+f(v,1)),c_u\\not=0\n$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6211\u4eec\u4ee5$1$\u4e3a\u6839, \u5219\u7b54\u6848\u5c31\u662f$f(1,1)$.\n## $Part_5$ \u7ec6\u8282\u95ee\u9898\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9996\u5148, $catch$\u4f4f\u6765\u81ea$part_3$\u7684\u9505, \u6765\u5206\u6790\u4e00\u4e0b\u51e0\u4efd\u4ee3\u7801.  \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0b\u9762\u662f\u81ea\u95ed\u7684$A$\u540c\u5b66 ( \u6211 ) \u5bf9\u8def\u5f84\u67d3\u8272\u7684\u4ee3\u7801:\n```cpp\ninline bool Paint ( int lf, const int rt ) {\n\tint TarCol = c[lf]; // \u76ee\u6807\u989c\u8272\n\twhile ( lf ^ rt ) {\n\t\tif ( DiffColor ( TarCol, c[lf = Par[lf][0]] ) ) { // c[lf]\u6709\u989c\u8272\u4e14\u4e0d\u662f\u76ee\u6807\u989c\u8272\n\t\t\treturn false;\n\t\t}\n\t\tc[lf] = TarCol; // \u67d3\u8272\n\t}\n\treturn true; // \u6ca1\u6709\u5f02\u5e38\n}\n```\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9, \u5b83$T$\u4e86. \u5982\u679c\u6240\u6709\u70b9\u540c\u8272, $n$\u4e2a\u7ed3\u70b9\u5206\u522b\u722c\u5411\u6839\u8282\u70b9, $O(n^2)$...  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8003\u8651$u$\u5728\u722c\u6811\u7684\u8fc7\u7a0b\u4e2d, \u9047\u5230\u4e86\u4e0e\u76ee\u6807\u989c\u8272\u76f8\u540c\u7684\u7ed3\u70b9$v$, \u5b83\u4eec\u76f8\u89c6\u4e00\u7b11...  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u611f\u6027\u7406\u89e3, \u53ef\u4ee5$return$\u4e86?  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7406\u6027\u5206\u6790, $v$\u53ef\u80fd\u672c\u6765\u5c31\u6709\u989c\u8272, \u6216\u5728\u4e00\u6761\u88ab\u67d3\u8272\u7684\u8def\u5f84\u4e2d. \u5bf9\u4e8e\u7b2c\u4e00\u7c7b, $v$\u722c\u5411$LCA$\u7684\u9014\u4e2d\u5c31\u4f1a\u5b8c\u6210$u$\u7684\u67d3\u8272\u4efb\u52a1; \u5bf9\u4e8e\u7b2c\u4e8c\u7c7b, \u4e5f\u8868\u660e\u6709\u5176\u5b83\u7ed3\u70b9\u6bd4$u$\u6377\u8db3\u5148\u767b\u4e86.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7efc\u4e0a, \u4e00\u65e6\u9047\u5230\u4e0e\u76ee\u6807\u989c\u8272\u76f8\u540c\u7684\u7ed3\u70b9, \u82e6\u903c\u722c\u6811\u7684$u$\u5c31\u80fd\u4e0b\u73ed\u4e86.  \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e8e\u662f, \u6709\u4e86\u53e6\u4e00\u4f4d\u81ea\u95ed\u540c\u5b66$B$ ( \u8fd8\u662f\u6211 ) \u7684\u4ee3\u7801:\n```cpp\ninline bool Paint ( int lf, const int rt ) {\n\tint TarCol = c[lf];\n\twhile ( lf ^ rt ) {\n\t\tif ( c[lf = Par[lf][0]] ) return c[lf] == TarCol; // \u4e00\u65e6lf\u6709\u989c\u8272, \u8981\u4e0d\"\u4e0b\u73ed\", \u8981\u4e0d\u51fa\u73b0\u5f02\u5e38\n\t\tc[lf] = TarCol;\n\t}\n\treturn true;\n}\n```\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9707\u60ca, \u5b83$WA$\u4e86!  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$B$\u540c\u5b66\u51a5\u60f3\u4e86\u534a\u4e2a\u5c0f\u65f6, \u5927\u53eb\u4e00\u58f0:\"\u6211$duang$!\"  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6765\u770b\u770b\u4ed6\u60f3\u5230\u4e86\u4ec0\u4e48.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9\u4e8e\u4e0b\u56fe, \u6211\u4eec\u6309$1$, $LCA(1,2)$, $LCA(LCA(1,2),3)$, ...\u7684\u65b9\u5f0f\u6c42$LCA$, \u5e76\u5728\u7b2c$i$\u6b21\u6c42$LCA$\u4e4b\u540e\u8ba9$LCA(1,2,...,i-1)$\u548c$i$\u722c\u5411$LCA(1,2,...,i)$:  \n![CF1118F2_P3](https://cdn.luogu.com.cn/upload/image_hosting/nswjkss4.png)  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( \u5bf9\u4e0d\u8d77, $LCA(1,2)$, \u662f\u65e0\u8272\u7684, \u4f46\u6211\u61d2\u5f97\u6539\u4e86$QwQ$ )  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7075\u9b42\u62f7\u95ee: \u7ea2\u8272\u865a\u7ebf\u53d1\u751f\u4e86\u4ec0\u4e48?  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$LCA(1,2)$\u5411\u4e0a\u722c\u6811\u65f6, \u56e0\u4e3a\u722c\u5411\u81ea\u5df1\u7684\u7ed3\u70b9\u5728\u4e2d\u9014\u9047\u5230\u4e86\u540c\u8272\u7ed3\u70b9, $LCA(1,2)$\u5e76\u6ca1\u6709\u88ab\u67d3\u8272, \u76ee\u6807\u989c\u8272\u662f$0$, \u5b83\u4e0e$3$\u53f7\u70b9\u989c\u8272\u76f8\u65a5...  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\"\u539f\u6765\u662f\u5c0f\u95ee\u9898\u5440!\"$B$\u540c\u5b66\u8001\u6fc0\u52a8\u4e86.\n## $Part_6$ \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <vector>\n\n#define Int register int\n\nusing namespace std;\n\nconst int MAXN = 3e5, MAXK = MAXN, LGMAXN = 19, MOD = 998244353;\nint n, k, Cnte, c[MAXN + 5] = {}, Head[MAXN + 5] = {}, Depth[MAXN + 5] = {}, Top[MAXK + 5] = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Top[i]\u662f\u989c\u8272\u4e3ai\u7684\u7ed3\u70b9\u7684LCA \nint Par[MAXN + 5][LGMAXN + 5] = {}, F[MAXN + 5][2] = {};\nvector<int> Colnd[MAXK + 5] = {}; // \u8bb0\u5f55\u5404\u79cd\u989c\u8272\u7684\u7ed3\u70b9 \n\nstruct Edge {\n\tint To, _nxt;\n} Graph[MAXN << 1] = {};\n\ninline void Link ( const int From, const int To ) {\n\tGraph[++ Cnte] = { To, Head[From] };\n\tHead[From] = Cnte;\n}\n\ninline int qkpow ( int a, int b, const int p ) {\n\tint ret = 1;\n\twhile ( b ) {\n\t\tret = 1LL * ret * ( b & 1 ? a : 1 ) % p;\n\t\ta = 1LL * a * a % p, b >>= 1;\n\t}\n\treturn ret;\n}\n\ninline void Prepare ( const int u, const int fa ) { // LCA\u500d\u589e\u9884\u5904\u7406 \n\tDepth[u] = Depth[fa] + 1, Par[u][0] = fa;\n\tfor ( Int i = 1; i ^ 20; ++ i ) Par[u][i] = Par[Par[u][i - 1]][i - 1];\n\tfor ( Int i = Head[u], v; i; i = Graph[i]._nxt ) {\n\t\tif ( ( v = Graph[i].To ) ^ fa ) {\n\t\t\tPrepare ( v, u );\n\t\t}\n\t}\n}\n\ninline int LCA ( int a, int b ) { // LCA \n\tfor ( Int i = 19; ~ i; -- i ) {\n\t\tif ( Depth[Par[a][i]] >= Depth[b] ) a = Par[a][i];\n\t\tif ( Depth[Par[b][i]] >= Depth[a] ) b = Par[b][i];\n\t}\n\tif ( a ^ b ) {\n\t\tfor ( Int i = 19; ~ i; -- i ) {\n\t\t\tif ( Par[a][i] ^ Par[b][i] ) {\n\t\t\t\ta = Par[a][i], b = Par[b][i];\n\t\t\t}\n\t\t}\n\t\treturn Par[a][0];\n\t}\n\treturn a;\n}\n\ninline bool Paint ( int lf, const int rt, const int cl ) { // \u66b4\u529b\u722c\u6811, \u6d82\u8272 \n\twhile ( lf ^ rt ) {\n\t\tif ( c[lf = Par[lf][0]] ) return c[lf] == cl;\n\t\tc[lf] = cl;\n\t}\n\treturn true;\n}\n\ninline int GetColTop ( const int cl ) { // \u53cd\u590dLCA\u6c42\u5f97Top \n\tint ret = Colnd[cl][0], tmp;\n\tfor ( unsigned int i = 1; i ^ Colnd[cl].size (); ++ i ) {\n\t\ttmp = ret, ret = LCA ( tmp, Colnd[cl][i] );\n\t\tif ( ! Paint ( tmp, ret, cl ) || ! Paint ( Colnd[cl][i], ret, cl ) ) return -1;\n\t}\n\treturn ret;\n}\n\ninline void DFS ( const int u, const int fa ) {\n\tint t = 1;\n\tfor ( Int i = Head[u], v; i; i = Graph[i]._nxt ) {\n\t\tif ( ( v = Graph[i].To ) ^ fa ) {\n\t\t\tDFS ( v, u ); \n\t\t\tif ( c[u] && c[v] ^ c[u] ) { // \u76f4\u63a5\u4e3aTop\u63d0\u4f9b\u66f4\u65b0\u4fe1\u606f \n\t\t\t\tF[Top[c[u]]][1] = 1LL * F[Top[c[u]]][1] * ( F[v][0] + F[v][1] ) % MOD;\n\t\t\t} else if ( ! c[u] ) {\n\t\t\t\tt = 1LL * t * ( F[v][0] + F[v][1] ) % MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif ( c[u] ) return ;\n\tF[u][0] = t, F[u][1] = 0; // c[u] = 0\u65f6\u7684\u66f4\u65b0 \n\tfor ( Int i = Head[u], v; i; i = Graph[i]._nxt ) {\n\t\tif ( ( v = Graph[i].To ) ^ fa ) {\n\t\t\tF[u][1] = ( F[u][1] + 1LL * F[v][1] * t % MOD * qkpow ( F[v][0] + F[v][1], MOD - 2, MOD ) % MOD ) % MOD;\n\t\t}\n\t}\n}\n\ninline void Work () {\n\tscanf ( \"%d %d\", &n, &k );\n\tfor ( Int i = 1; i <= n; ++ i ) {\n\t\tscanf ( \"%d\", &c[i] );\n\t\tColnd[c[i]].push_back ( i );\n\t}\n\tfor ( Int i = 1, u, v; i ^ n; ++ i ) {\n\t\tscanf ( \"%d %d\", &u, &v );\n\t\tLink ( u, v ), Link ( v, u );\n\t}\n\tPrepare ( 1, 1 );\n\tfor ( Int i = 1; i <= k; ++ i ) {\n\t\tif ( ! ~ ( Top[i] = GetColTop ( i ) ) ) {\n\t\t\tputs ( \"0\" );\n\t\t\treturn ;\n\t\t}\n\t\tF[Top[i]][1] = 1; // \u8bb0\u5f97\u8d4b\u521d\u503c \n\t}\n\tDFS ( 1, 1 );\n\tprintf ( \"%d\\n\", F[1][1] );\n}\n\nint main () {\n\tWork ();\n\treturn 0;\n}\n```",
        "postTime": 1569660203,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1118F2 \u3010Tree Cutting (Hard Version)\u3011"
    },
    {
        "content": "\u5934\u4e00\u6b21\u5199\u8fd9\u79cd\u9898\uff0c\u5199\u7bc7\u9898\u89e3\u3002\n\n\u4f46\u662f\u5176\u5b9e\u4e0d\u662f\u7279\u522b\u56f0\u96be\u3002\n\n\u7531\u4e8e\u4ed6\u8981\u6c42\u6211\u4eec\u53ea\u80fd\u65ad\u5f00 $k-1$ \u6761\u8fb9\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u80af\u5b9a\u662f\u4e00\u4e2a\u8fde\u901a\u5757\u5185\u53ea\u7559\u4e0b\u540c\u4e00\u4e2a\u989c\u8272\u3002\n\n\u6211\u4eec\u5927\u81f4\u521d\u6b65\u731c\u6d4b\uff0c\u4ed6\u5e94\u8be5\u662f\u7f29\u6210\u82e5\u5e72\u4e2a\u6709\u989c\u8272\u7684\u8fde\u901a\u5757\u548c\u82e5\u5e72\u4e2a\u7a7a\u8282\u70b9\uff0c\u5757\u5185\u4e0d\u80fd\u65ad\u8fb9\uff0c\u7136\u540e\u8981\u6c42\u65ad\u5f00\u8fb9\u4f7f\u5f97\u6bcf\u4e2a\u6807\u8bb0\u70b9\u90fd\u88ab\u4e92\u76f8\u72ec\u7acb\u3002\n\n\u6211\u4eec\u5177\u4f53\u53bb\u601d\u8003\u8fd9\u90e8\u5206\u8be5\u600e\u4e48\u505a\u3002\n\n\u9996\u5148\u662f\u7f29\u70b9\uff0c\u6211\u4eec\u628a\u540c\u4e00\u4e2a\u989c\u8272\u7684\u70b9\u90fd\u62bd\u51fa\u6765\uff0c\u7136\u540e\u9700\u8981\u641e\u51fa\u5c5e\u4e8e\u4ed6\u7684\u8fde\u901a\u5757\u3002\n\n\u8fd9\u4e1c\u897f\u662f\u4e2a\u7ecf\u5178\u7684\u4e1c\u897f\uff0c\u5c31\u662f\u76f8\u90bb\u505a\u4e00\u4e0b LCA\uff0c\u6c42\u51fa\u4ed6\u4eec\u6df1\u5ea6\u6700\u5c0f\u7684 LCA\uff0c\u7136\u540e\u6bcf\u4e2a\u70b9\u66b4\u529b\u5f80\u4e0a\u8df3\u5373\u53ef\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u8fde\u901a\u5757\u662f\u6709\u4ea4\u96c6\u7684\uff0c\u90a3\u4e48\u5fc5\u5b9a\u65e0\u89e3\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8df3 LCA \u7684\u65f6\u5019\u6bcf\u4e2a\u70b9\u81f3\u591a\u8df3 $1$ \u6b21\u3002\n\n\u7136\u540e\u6211\u4eec\u518d\u7528\u5e76\u67e5\u96c6\u53bb\u628a\u4ed6\u7f29\u6210\u4e00\u4e2a\u70b9\u3002\n\n\u7136\u540e\u5c31\u53d8\u6210\u4e86\u82e5\u5e72\u4e2a\u6807\u8bb0\u70b9\u548c\u7a7a\u8282\u70b9\u7684\u6811\uff0c\u8981\u6c42\u5728\u8fd9\u68f5\u6811\u4e0a\u65ad $k-1$ \u6761\u8fb9\uff0c\u4f7f\u5f97\u4ed6\u53d8\u6210\u82e5\u5e72\u4e2a\u6070\u597d\u5305\u542b\u4e00\u4e2a\u6807\u8bb0\u70b9\u7684\u8fde\u901a\u5757\u3002\n\n\u6253\u8fc7 NOIP 2022 \u7684\u5e94\u8be5\u90fd\u660e\u767d\uff0c\u8fd9\u4e1c\u897f\u548c\u5efa\u9020\u519b\u8425\u7c7b\u4f3c\uff0c\u90a3\u4e48\u6211\u4eec\u7c7b\u4f3c\u8bbe\u51fa dp \u72b6\u6001\uff0c\u8bbe $f_{x,0/1,0/1}$ \u8868\u793a\u5f53\u524d\u5230 $x$ \u8282\u70b9\uff0c\u5b50\u6811\u5916\u662f\u5426\u6709\u70b9\uff0c\u5b50\u6811\u5185\u662f\u5426\u6709\u70b9\u3002\n\n\u7136\u540e\u6211\u4eec\u601d\u8003\u8f6c\u79fb\u3002\n\n\u6bd4\u5982\u5f53\u524d\u679a\u4e3e\u5230\u7684\u70b9\u662f $x$\uff0c\u4ed6\u7684\u513f\u5b50\u8bbe\u4e3a $v$\u3002\n\n\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u5f97\u51fa\u4e00\u4e2a\u4e0d\u5408\u6cd5\u72b6\u6001 $f_{x,1,1}$ \u662f\u6c38\u8fdc\u5e94\u8be5\u4e3a $0$ \u7684\u3002\n\n\u90a3\u4e48\u5047\u5982\u8bf4\u8981\u65ad\u5f00\uff0c\u5c31\u662f $f_{x,j,k}=f_{x,j,k} \\times f_{v,0,1}$\uff0c\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u5c31\u662f\u4ed6\u513f\u5b50\u5185\u90e8\u80af\u5b9a\u90fd\u6709\u4e2a\u5173\u952e\u70b9\uff0c\u5426\u5219\u4e0d\u80fd\u65ad\u5f00\u3002\n\n\u5047\u5982\u4e0d\u65ad\u5f00\uff0c\u90a3\u4e48\u5c31\u5206\u7c7b\u8ba8\u8bba\u3002\n\n$f_{x,0,0}$ \u7684\u60c5\u51b5\uff0c\u8981\u4e48\u513f\u5b50\u91cc\u6709\uff0c\u8981\u4e48\u6ca1\u6709\u3002\n\n$f_{x,1,0}$ \u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u5c31\u662f\u513f\u5b50\u91cc\u4e0d\u80fd\u6709\uff0c\u513f\u5b50\u7684\u5b50\u6811\u5916\u6709\u3002\n\n$f_{x,0,1}$ \u7684\u60c5\u51b5\uff0c\u513f\u5b50\u91cc\u9762\u4e0d\u80fd\u6709\uff0c\u513f\u5b50\u7684\u5b50\u6811\u5916\u6709\u3002\n\n\u641e\u6e05\u695a\u8fd9\u4e9b\u5c31\u505a\u5b8c\u4e86\uff0c\u8fd9\u8fb9\u6ce8\u610f\u7ec6\u8282\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long \n#define pb push_back\nusing namespace std;\nconst int INF=5e5+5;\nconst int Mod=998244353;\nint n,m,a[INF];\nstruct _node_edge{\n    int to_,next_;\n}edge[INF<<1];\nsigned tot,head[INF],dep[INF],vis2[INF],fath[INF][25],fa_set[INF],vis[INF];\nvoid add_edge(int x,int y) {\n    edge[++tot]={y,head[x]};\n    head[x]=tot;\n}\nmap <int,map<int,int> >Map;\nvector <int> co[INF];\nint find_set(int x) {return x==fa_set[x]?x:fa_set[x]=find_set(fa_set[x]);}\nvoid mer(int x,int y) {\n    x=find_set(x);y=find_set(y);\n    if (x==y) return ;\n    fa_set[x]=y;\n}\nvoid DFS(int x,int fa) {\n    dep[x]=dep[fa]+1;fath[x][0]=fa;\n    int len=__lg(dep[x]);\n    for (int i=1;i<=len;i++)\n        fath[x][i]=fath[fath[x][i-1]][i-1];\n    for (int i=head[x];i;i=edge[i].next_) {\n        int v=edge[i].to_;\n        if (v==fa) continue;\n        DFS(v,x);\n    }\n    return ;\n}\nint LCA(int x,int y) {\n    if (dep[x]<dep[y]) swap(x,y);\n    while (dep[x]!=dep[y]) \n        x=fath[x][__lg(dep[x]-dep[y])];\n    if (x==y) return x;\n    int len=__lg(dep[x]);\n    for (int i=len;~i;i--) {\n        int xx=fath[x][i],yy=fath[y][i];\n        if (xx==yy) continue;\n        x=xx;y=yy;\n    }\n    return fath[x][0];\n}\nvector <int> cnt;\nint Get(int x) {return lower_bound(cnt.begin(),cnt.end(),x)-cnt.begin()+1;}\nnamespace S{\n    struct _node_edge{\n        int to_,next_;\n    }edge[INF<<1];\n    int tot,head[INF],aa[INF],n;\n    void add_edge(int x,int y) {\n        n=max(n,x);n=max(n,y);\n        edge[++tot]={y,head[x]};\n        head[x]=tot;\n    }\n    int f[INF][3][3],f1[3][3];\n    void DFS2(int x,int fa) {\n        if (aa[x]) f[x][0][1]=f[x][1][1]=1;\n        else f[x][0][0]=f[x][1][0]=1;\n        // cout<<x<<\" \"<<fa<<\"\\n\";\n        for (int i=head[x];i;i=edge[i].next_) {\n            int v=edge[i].to_;\n            if (v==fa) continue;\n            DFS2(v,x);\n            memset(f1,0,sizeof f1);\n            for (int j=0;j<2;j++) {\n                for (int k=0;k<2;k++) {\n                    for (int l=1;l<2;l++) {\n                        // break\n                        f1[j][k]+=f[x][j][k]*f[v][0][l]%Mod;\n                    }\n                }\n            }\n\n            f1[0][0]+=f[x][0][0]*f[v][0][0]%Mod;f1[0][0]%=Mod;\n            f1[1][0]+=f[x][1][0]*f[v][1][0]%Mod;f1[1][0]%=Mod;\n            f1[0][1]+=f[x][0][0]*f[v][0][1]%Mod;f1[0][1]%=Mod;\n            f1[0][1]+=f[x][0][1]*f[v][1][0]%Mod;f1[0][1]%=Mod;\n\n            for (int j=0;j<2;j++)\n                for (int k=0;k<2;k++)\n                    f[x][j][k]=f1[j][k];\n        }\n        f[x][1][1]=0;\n        return ;\n    }\n    int ksm(int x,int y) {\n        int ba=x%Mod,ans=1;\n        while (y) {\n            if (y&1) ans=(ans*ba)%Mod;\n            ba=(ba*ba)%Mod;y>>=1;\n        }\n        return ans;\n    }\n    void main() {\n        // for (int i=1;i<=n;i++) cout<<aa[i]<<\" \";\n        // cout<<\"\\n\";\n        DFS2(1,0);\n        cout<<f[1][0][1]<<\"\\n\";\n        return ;\n    }\n}\nvoid solve() {\n    cin>>n>>m;\n    for (int i=1;i<=n;i++) {\n        cin>>a[i];\n        fa_set[i]=i;\n        co[a[i]].pb(i);\n    }\n    for (int i=1;i<n;i++) {\n        int x=0,y=0;\n        cin>>x>>y;\n        add_edge(x,y);\n        add_edge(y,x);\n    }\n    DFS(1,0);\n    for (int i=1;i<=m;i++) {\n        if (co[i].size()==0) continue;\n        int L=co[i][0],len=co[i].size();\n        for (int j=1;j<len;j++) {\n            L=LCA(L,co[i][j]);\n            mer(co[i][j],co[i][j-1]);\n        }\n        vector <int> cnt;\n        if (vis[L]) {\n            // if (fl) {cout<<\"26127360\\n\";return ;}\n            // if (fl1) {cout<<\"395652393\\n\";return ;}\n            // if (fl2) {cout<<\"267406296\\n\";return ;}\n            // if (fl) cout<<L<<\" bomb\\n\";\n            cout<<\"0\\n\";\n            return ;\n        }\n        cnt.pb(L);mer(L,co[i][0]);\n        for (int j=0;j<len;j++) {\n            int X=co[i][j];\n            while (X!=L) {\n                if (vis[X]) {\n                    // if (fl) {cout<<\"26127360\\n\";return ;}\n                    // if (fl1) {cout<<\"395652393\\n\";return ;}\n                    // if (fl2) {cout<<\"267406296\\n\";return ;}\n                    cout<<\"0\\n\";\n                    return ;\n                }\n                if (vis2[X]) break;\n                vis2[X]=1;\n                cnt.pb(X);mer(X,co[i][j]);\n                X=fath[X][0];\n            }\n        }\n        for (int j:cnt) vis[j]=1;\n        len=cnt.size();\n        while (len--) cnt.pop_back();\n    }\n    for (int x=1;x<=n;x++) cnt.pb(find_set(x));\n    sort(cnt.begin(),cnt.end());\n    cnt.erase(unique(cnt.begin(),cnt.end()),cnt.end());\n\n    \n    for (int x=1;x<=n;x++) {\n        // cout<<x<<\" \"<<find_set(x)<<\" kelkel\\n\";\n        if (a[x]) S::aa[Get(find_set(x))]=1;\n        for (int i=head[x];i;i=edge[i].next_) {\n            int v=edge[i].to_;\n            if (find_set(x)==find_set(v)) continue;\n            int xx=find_set(x),yy=find_set(v);\n            if (Map[xx][yy]) continue;\n            Map[xx][yy]=Map[yy][xx]=1;\n            S::add_edge(Get(xx),Get(yy));\n            S::add_edge(Get(yy),Get(xx));\n        }\n    }\n\n    S::main();\n    return ;\n}\nsigned main()\n{\n    ios::sync_with_stdio(false);\n    int t=1;\n    while (t--) solve();\n    return 0;\n}\n```\n",
        "postTime": 1671004698,
        "uid": 208653,
        "name": "_edge_",
        "ccfLevel": 0,
        "title": "CF1118F2"
    },
    {
        "content": "\u9996\u5148\uff0c\u5bf9\u4e8e\u540c\u989c\u8272\u7684\u70b9\u96c6\uff0c\u5b83\u4eec\u7684\u6700\u5c0f\u8fde\u901a\u5757\u4e00\u5b9a\u4e0d\u80fd\u591f\u88ab\u5207\u5f00\u3002\u6240\u4ee5\u5148\u628a\u6bcf\u4e2a\u540c\u989c\u8272\u70b9\u96c6\u7684\u6700\u5c0f\u8fde\u901a\u5757\u627e\u51fa\u6765\uff0c\u5982\u679c\u6709\u4ea4\u90a3\u5c31\u4e0d\u5408\u6cd5\u3002\n\n\u5177\u4f53\u800c\u8a00\uff0c\u5148\u6c42\u51fa\u70b9\u96c6\u7684 LCA\uff0c\u518d\u5bf9\u6bcf\u4e2a\u70b9\u5411 LCA \u66b4\u529b\u5411\u4e0a\u8df3\u6253\u6807\u8bb0\u5373\u53ef\u3002\u5982\u679c\u9047\u5230\u6709\u6807\u8bb0\u7684\u70b9\uff0c\u5c31\u5224\u65ad\u989c\u8272\u662f\u5426\u76f8\u540c\u3002\u7531\u4e8e\u6bcf\u4e2a\u70b9\u81f3\u591a\u88ab\u6807\u8bb0\u4e00\u6b21\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u8fd9\u4e9b\u8fde\u901a\u5757\u663e\u7136\u53ef\u4ee5\u7f29\u6210\u4e00\u4e2a\u70b9\u3002\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\uff1a\u5728\u4e00\u68f5\u6811\u4e0a\u4e14\u82e5\u5e72\u5200\uff0c\u4f7f\u5f97\u6bcf\u4e00\u4e2a\u88ab\u67d3\u8272\u7684\u70b9\u90fd\u6070\u597d\u5728\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d\uff0c\u4e14\u6240\u5728\u7684\u8fde\u901a\u5757\u4e92\u4e0d\u76f8\u540c\u3002\n\n\u8bbe $f_{i,0/1}$ \u4e3a\u5728 $i$ \u7ed3\u70b9\u7684\u5b50\u6811\u4e2d\uff0c\u4ee5 $i$ \u4e3a\u6839\u7684\u8fde\u901a\u5757\u662f\u5426\u5b58\u5728\u67d3\u8272\u7ed3\u70b9\u7684\u65b9\u6848\u6570\u3002\u521d\u59cb $f_{x,col_x}=1$\uff0c\u5176\u4e2d $col_x$ \u4e3a $x$ \u662f\u5426\u88ab\u67d3\u8272\u3002\n\n\u6bcf\u6b21\u5408\u5e76 $x$ \u4e0e\u5b83\u7684\u4e00\u4e2a\u513f\u5b50 $y$\uff1a\n\n$$\n\\begin{cases}\nf_{x,0}&\\gets f_{x,0}\\times (f_{y,0}+f_{y,1})\\\\\nf_{x,1}&\\gets f_{x,1}\\times (f_{y,0}+f_{y,1})+f_{x,0}\\times f_{y,1}\n\\end{cases}\n$$\n\n\u8f6c\u79fb\u7684\u542b\u4e49\u53ef\u4ee5\u7ed3\u5408\u8fd9\u5f20\u8868\u6765\u89e3\u91ca\uff1a\n\n| \u4e0d\u5207\u5f00 | $y$ \u65e0\u8272 | $y$ \u6709\u8272 |\n| :----------: | :----------: | :----------: |\n| **$x$ \u65e0\u8272** | $x$ \u65e0\u8272 | $x$ \u6709\u8272 |\n| **$x$ \u6709\u8272** | $x$ \u6709\u8272 | \u4e0d\u5408\u6cd5 |\n\n| \u5207\u5f00 | $y$ \u65e0\u8272 | $y$ \u6709\u8272 |\n| :----------: | :----------: | :----------: |\n| **$x$ \u65e0\u8272** | \u4e0d\u5408\u6cd5 | $x$ \u65e0\u8272 |\n| **$x$ \u6709\u8272** | \u4e0d\u5408\u6cd5 | $x$ \u6709\u8272 |\n\n\u6700\u540e\u7b54\u6848\u5373\u4e3a $f_{root,1}$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define For(i,a,b) for(int i=(a);i<=(b);++i)\n#define Rof(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\nconst int Maxn=3e5,Mod=998244353;\n\ninline int read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0' || ch>'9')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9')\n    {\n        x=x*10+ch-'0';\n        ch=getchar();\n    }\n    return x*f;\n}\n\nint n,m,val[Maxn+5],vis[Maxn+5];\n\nstruct Graph\n{\n    int f[Maxn+5][2];\n    vector<int> v[Maxn+5];\n    inline void dfs(int x,int fa)\n    {\n        f[x][vis[x]]=1;\n        for(auto y:v[x]) if(y!=fa) dfs(y,x);\n        for(auto y:v[x]) if(y!=fa)\n        {\n            int a=1ll*f[x][0]*(f[y][0]+f[y][1])%Mod;\n            int b=(1ll*f[x][1]*(f[y][0]+f[y][1])%Mod+1ll*f[x][0]*f[y][1]%Mod)%Mod;\n            f[x][0]=a,f[x][1]=b;\n        }\n    }\n    inline void Run()\n    {\n        dfs(1,0);\n        printf(\"%d\\n\",f[1][1]);\n    }\n} G;\n\nstruct Tree\n{\n    int col[Maxn+5],fa[Maxn+5],dep[Maxn+5];\n    int top[Maxn+5],son[Maxn+5],siz[Maxn+5],chk[Maxn+5];\n    vector<int> v[Maxn+5],w[Maxn+5];\n    inline void dfs1(int x,int f)\n    {\n        fa[x]=f,siz[x]=1,dep[x]=dep[f]+1;\n        for(auto y:v[x]) if(y!=f)\n        {\n            dfs1(y,x),siz[x]+=siz[y];\n            son[x]=(siz[y]>siz[son[x]]?y:son[x]);\n        }\n    }\n    inline void dfs2(int x,int t)\n    {\n        top[x]=t;\n        if(son[x]) dfs2(son[x],t);\n        for(auto y:v[x]) if(y!=fa[x] && y!=son[x]) dfs2(y,y);\n    }\n    inline int LCA(int x,int y)\n    {\n        while(top[x]!=top[y]) (dep[top[x]]>dep[top[y]]?x=fa[top[x]]:y=fa[top[y]]);\n        return (dep[x]<dep[y]?x:y);\n    }\n    inline void Jump(int x,int y,int id,int c)\n    {\n        while(x!=y && !col[x]) col[x]=id,chk[x]=c,x=fa[x];\n        if(chk[x] && chk[x]!=c) {printf(\"0\\n\"); exit(0);}\n        col[y]=id,chk[y]=c;\n    }\n    inline void Run()\n    {\n        n=read(),m=read();\n        For(i,1,n)\n        {\n            col[i]=read();\n            if(col[i]) w[col[i]].push_back(i);\n        }\n        For(i,1,n) col[i]=0;\n        For(i,1,n-1)\n        {\n            int a=read(),b=read();\n            v[a].push_back(b),v[b].push_back(a);\n        }\n        dfs1(1,0),dfs2(1,1);\n        For(id,1,m)\n        {\n            int lca=0;\n            for(auto i:w[id])\n            {\n                if(!lca) lca=i;\n                else lca=LCA(lca,i);\n            }\n            for(auto i:w[id]) Jump(i,lca,lca,id);\n            vis[lca]=1;\n        }\n        For(i,1,n) for(auto j:v[i])\n        {\n            if(col[i]!=col[j] || !col[i] || !col[j])\n            {\n                int a=(!col[i]?i:col[i]),b=(!col[j]?j:col[j]);\n                G.v[a].push_back(b);\n            }\n        }\n    }\n} T;\n\nint main()\n{\n    T.Run(),G.Run();\n    return 0;\n}\n```",
        "postTime": 1669866110,
        "uid": 148913,
        "name": "Graphcity",
        "ccfLevel": 8,
        "title": "\u9898\u89e3  CF1118F2\u3010Tree Cutting (Hard Version)\u3011"
    }
]