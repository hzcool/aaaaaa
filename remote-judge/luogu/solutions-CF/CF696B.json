[
    {
        "content": "[$\\texttt{Link}$](https://www.luogu.com.cn/problem/CF696B)    \n\n## \u9898\u610f  \n\n\u7ed9\u5b9a\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u5bf9\u5b83\u8fdb\u884c DFS\uff0c\u6bcf\u6b21 DFS \u968f\u673a\u6392\u5217\u5f53\u524d\u8282\u70b9\u7684\u6240\u6709\u513f\u5b50\uff0c\u6c42\u6bcf\u4e2a\u70b9\u7684\u671f\u671b\u65f6\u95f4\u6233\u3002  \n\n\u6570\u636e\u8303\u56f4\uff1a $1\\le n\\le10^5$  \n\n## \u505a\u6cd5  \n\u4ee5\u4e0b\u7528 $f_x$ \u8868\u793a\u70b9 $x$ \u65f6\u95f4\u6233\u7684\u671f\u671b\u503c\uff0c$siz_x$ \u8868\u793a\u70b9 $x$ \u7684\u5b50\u6811\u5927\u5c0f\u3002\n\n\u5bf9\u4e8e\u8282\u70b9 $u$\uff0c\u663e\u7136\u4ed6\u4f1a\u7ee7\u627f\u5176\u7236\u8282\u70b9 $fa$ \u7684\u65f6\u95f4\u6233\u4e3a\u57fa\u7840\uff0c\u518d\u52a0\u4e0a\u5144\u5f1f\u8282\u70b9\u7684\u8d21\u732e\u3002  \n\n\u5bf9\u4e8e\u70b9 $u$ \u7684\u5144\u5f1f\u8282\u70b9 $v$\uff0c\u5148\u88ab\u641c\u6982\u7387\u662f\u76f8\u7b49\u7684\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u5f88\u663e\u7136\uff0c\u56e0\u4e3a\u5c06 DFS \u987a\u5e8f\u53cd\u8f6c\u540e\u4e24\u79cd\u65f6\u95f4\u6233\u5927\u5c0f\u5173\u7cfb\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u6240\u4ee5\u70b9 $v$ \u5bf9\u70b9 $u$ \u7684\u8d21\u732e\u5373\u4e3a $\\frac{siz_v}{2}$\u3002\u53c8\u56e0\u4e3a $\\sum\\limits_{v\\in son(fa)}siz_v=siz_{fa}-siz_u-1$\uff0c\u6240\u4ee5\u5bf9\u4e8e\u70b9 $u$\uff0c $f_u=f_{fa}+\\frac{siz_{fa}-siz_u-1}{2}+1$\u3002  \n\n\u7136\u540e\u6811\u5f62 DP  \u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e5 + 10;\nint n, siz[N];\ndouble f[N];\nstruct edge {\n\tint to, nxt;\n} e[N];\nint head[N], cnt;\nvoid add(int u, int v) {\n\te[++cnt] = (edge){v, head[u]};\n\thead[u] = cnt;\n}\nvoid dfs1(int u) {\n\tsiz[u] = 1;\n\tfor(int i = head[u], v; i; i = e[i].nxt) {\n\t\tv = e[i].to;\n\t\tdfs1(v);\n\t\tsiz[u] += siz[v];\n\t}\n}\nvoid dfs2(int u, int fa) {\n\tif(fa) f[u] = f[fa] + (siz[fa] - siz[u] - 1) * 0.5 + 1;\n\tfor(int i = head[u], v; i; i = e[i].nxt) {\n\t\tv = e[i].to;\n\t\tdfs2(v, u);\n\t}\n}\nint main() {\n\tscanf(\"%d\", &n);\n\tfor(int i = 2, u; i <= n; i++)\n\t\tscanf(\"%d\", &u), add(u, i);\n\tdfs1(1);\n\tf[1] = 1.;\n\tdfs2(1, 0);\n\tfor(int i = 1; i <= n; i++) printf(\"%.1lf \", f[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1626412998,
        "uid": 365107,
        "name": "Terac",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF696B Puzzles"
    },
    {
        "content": "# \u9898\u89e3 - 10445 Puzzles\n\n## Link - \u94fe\u63a5\n\n[Luogu RMJ CF696B](https://www.luogu.com.cn/problem/CF696B)  \n[CF 696B](http://codeforces.com/problemset/problem/696/B)\n\n## Description - \u9898\u76ee\u7b80\u8ff0\n\n\u73b0\u6709\u5982\u4e0b\u7b97\u6cd5\uff1a\n\n```plain\nlet starting_time be an array of length n\ncurrent_time = 0\ndfs(v):\n    current_time = current_time + 1\n    starting_time[v] = current_time\n    shuffle children[v] randomly (each permutation with equal possibility)\n    // children[v] is vector of children cities of city v\n    for u in children[v]:\n        dfs(u)\ndfs(1)\n```\n\n\u5373\uff0c\u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u6309\u968f\u673a\u987a\u5e8f\u641c\u7d22\u5b50\u8282\u70b9\uff0c\u8bf7\u8f93\u51fa\u6bcf\u4e2a\u8282\u70b9 u \u7684\u65f6\u95f4\u6233\uff08`starting_time[u]`\uff09\u7684\u671f\u671b\u503c\u3002\n\n## Solution - \u9898\u89e3\n\n\u9996\u5148\uff0c\u8bbe\u8282\u70b9 u \u7684\u671f\u671b\u65f6\u95f4\u6233\u4e3a $dp_u$\u3002\n\n\u4e00\u4e2a\u8282\u70b9\u7684\u671f\u671b\u65f6\u95f4\u6233\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8ba1\u7b97\uff1a\n\n$dp_u = dp_{\\text{fa}_u} + 1 + \\text{something}$\n\n$dp_{\\text{fa}_u}$ \u662f\u6765\u81ea\u4e8e\u7236\u4eb2\u8282\u70b9\u7684\u8d21\u732e\uff0c$1$ \u662f\u6765\u81ea\u4e8e $u$ \u672c\u8eab\u7684\u8d21\u732e\uff0c$\\text{something}$ \u5373\u6765\u81ea\u4e8e\u5144\u5f1f\u8282\u70b9\u548c\u5b50\u8282\u70b9\u7684\u8d21\u732e\uff0c\u662f\u9700\u8981\u91cd\u70b9\u63a2\u8ba8\u7684\u3002\n\n\u53ef\u8bc1\uff0c\u5bf9\u4e8e $fa$ \u7684\u5b50\u8282\u70b9 $u,v$\uff0c$u$ \u5148\u4e8e $v$ \u88ab\u641c\u7d22\u7684\u6982\u7387\u5373\u4e3a $\\frac{1}{2}$\uff0c\u53cd\u4e4b\u4ea6\u6210\u7acb\u3002\n\n\u90a3\u4e48\uff0c\u5bf9\u4e8e $fa$ \u9664 $u$ \u4ee5\u5916\u6240\u6709\u5b50\u8282\u70b9 $v$\uff0c\u4ee5\u4e0a\u8bf4\u6cd5\u90fd\u6210\u7acb\uff0c\u5373 $v$ \u5bf9 $u$ \u7684\u8d21\u732e\u662f $\\text{size}_v \\times \\frac{1}{2} + 0 = \\frac{\\text{size}_v}{2}$\u3002\n\n\u7ee7\u800c\uff0c$\\text{something}$ \u5373\u4e3a $\\sum\\limits_{v\\in \\text{sons}_{fa}, v\\neq u}\\frac{\\text{size}_v}{2}$\u3002\n\n\u8fd9\u6837\u7684\u5f62\u5f0f\u4e0d\u592a\u597d\u770b\uff0c\u4e0d\u65b9\u4fbf\u8fdb\u4e00\u6b65\u5316\u7b80\u3002\n\n$$\n\\begin{aligned}\n& \\sum\\limits_{v\\in \\text{sons}_{fa}, v\\neq u}\\frac{\\text{size}_v}{2}\\\\\n= & \\frac{\\sum\\limits_{v\\in \\text{sons}_{fa}, v\\neq u}\\text{size}_v}{2}\\\\\n= & \\frac{\\text{size}_{fa} - \\text{size}_u - 1}{2}\\\\\n\\end{aligned}\n$$\n\n\u6ce8\u610f\u7b2c\u4e8c\u6b21\u5316\u7b80\u3002\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8fd9\u6837\u5316\u7b80\u5462\uff1f\n\n\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u9700\u8981\u7edf\u8ba1\u7684\u662f $u$ \u6240\u6709\u5144\u5f1f\u8282\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u4e4b\u548c\u3002\u8fd9\u6070\u597d\u662f $fa$ \u5b50\u6811\u5927\u5c0f - $u$ \u5b50\u6811\u5927\u5c0f - $fa$ \u672c\u8eab\uff08$1$\uff09\u3002\n\n**\u90a3\u4e48\uff0c\u6574\u4e2a dp \u65b9\u7a0b\u5219\u4e3a $dp_u = dp_{\\text{fa}_u} + 1 + \\frac{\\text{size}_{fa} - \\text{size}_u - 1}{2}$\u3002**\n\n\u4e24\u6b21 dfs\uff0c\u7b2c\u4e00\u6b21\u9884\u5904\u7406 $\\text{size}$\uff0c\u7b2c\u4e8c\u6b21 DP \u5373\u53ef\u3002\n\n### \u793a\u4f8b\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int maxn = 102400;\nstruct Edge\n{\n    int v, next;\n} e[maxn << 1];\nint head[maxn], cnt;\nint n, m;\nvoid add(int u, int v)\n{\n    e[++cnt].v = v;\n    e[cnt].next = head[u];\n    head[u] = cnt;\n}\nint siz[maxn];\ndouble dp[maxn];\nvoid pre(int u, int fa)\n{\n    siz[u] = 1;\n    for (int i = head[u]; i; i = e[i].next)\n    {\n        int v = e[i].v;\n        if (v == fa)\n            continue;\n        pre(v, u);\n        siz[u] += siz[v];\n    }\n    return;\n}\nvoid solve(int u, int fa)\n{\n    for (int i = head[u]; i; i = e[i].next)\n    {\n        int v = e[i].v;\n        if (v == fa)\n            continue;\n        dp[v] = dp[u] + 1.0 + (siz[u] - siz[v] - 1) * 0.5;\n        solve(v, u);\n    }\n    return;\n}\nint main()\n{\n    scanf(\"%d\", &n);\n    for (int i = 2; i <= n; ++i)\n    {\n        scanf(\"%d\", &m);\n        add(i, m);\n        add(m, i);\n    }\n    pre(1, 0);\n    dp[1] = 1;\n    solve(1, 0);\n    for (int i = 1; i <= n; ++i)\n        printf(\"%.8lf \", dp[i]);\n    printf(\"\\n\");\n    return 0;\n}\n```\n",
        "postTime": 1655116328,
        "uid": 371468,
        "name": "qidirj",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    },
    {
        "content": "### Description\n\n\u7ed9\u51fa\u4e00\u68f5\u6811\uff0c\u6309\u4e00\u5b9a\u7b97\u6cd5DFS\u6574\u68f5\u6811\uff0c\u6c42\u51fa\u6bcf\u4e2a\u8282\u70b9\u671f\u671b\u7684\u65f6\u95f4\u6233\u3002\n\n### Solution\n\n\u4e00\u9053\u5f88\u597d\u7684\u6982\u7387\u671f\u671bdp\u9898\u76ee\u3002\n\n\u8bbe\u6bcf\u4e2a\u70b9\u7684\u671f\u671b\u65f6\u95f4\u6233\u4e3aans\uff0c\u89c2\u5bdf\u9898\u76ee\u53ef\u4ee5\u53d1\u73b0\u7531\u4e8e\u662f\u968f\u673a\u8fdb\u884cDFS\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684ans\u53ea\u548c\u5176\u7236\u4eb2\u7684ans\u548c\u5b83\u5144\u5f1f\u7684\u5b50\u6811\u5927\u5c0f\u6709\u5173\u3002\u5bf9\u4e8e\u7236\u8282\u70b9\u7684\u5904\u7406\u76f8\u4f3c\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u53ea\u8003\u8651\u5144\u5f1f\u8282\u70b9\u4e4b\u95f4\u7684\u60c5\u51b5\u3002\n\n\u8003\u8651\u8bbe\u8282\u70b9\u7236\u4eb2\u7684\u513f\u5b50\u4e2a\u6570\u4e3at\uff08\u5305\u62ec\u8282\u70b9\u672c\u8eab\uff09\uff0c\u5982\u679c\u5176\u5728\u5f53\u524d\u6240\u6709\u5144\u5f1f\u7684dfs\u5e8f\u4e2d\u6392\u540d\u4e3a i\uff0c\u90a3\u4e48\u603b\u7684\u8d21\u732e\u5c31\u662f $\\frac{i-1}{t-1}$ \u3002\u5bf9\u5176\u6c42\u548c\u4e4b\u540e\u53ef\u5f97\u51fa\u8f6c\u79fb\u65b9\u7a0b\u4e3a\n\n$$\nans[x]=\\frac{size[fa]-size[x]-1}{2}+ans[fa]+1\n$$\n\n\u4e24\u904ddfs\u5373\u53ef\u5f97\u51fa\u89e3\u3002\n\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ninline int read()\n{\n\tint x=0,f=1,c=getchar();\n\twhile(c<48) c=='-'&&(f=-1),c=getchar();\n\twhile(c>47) x=x*10+c-'0',c=getchar();\n\treturn x*f;\n}\n\nconst int MAXN = 100005;\nstd::vector<int> G[MAXN];\nint size[MAXN],sum[MAXN];\ndouble ans[MAXN];\nint n;\n\ninline void addedge(int u,int v)\n{\n\tG[u].push_back(v);\n\tG[v].push_back(u);\n}\n\nvoid dfs(int x,int fa)\n{\n\tsize[x]=1;\n\tfor(int &y : G[x])\n\t\tif(y^fa) dfs(y,x),size[x]+=size[y];\n\tfor(int &y : G[x])\n\t\tif(y^fa) sum[y]=size[x]-size[y]-1;\n}\n\ninline void dp(int x,int fa)\n{\n\tfor(int &y : G[x])\n\t\tif(y^fa) ans[y]=ans[x]+1+0.5*sum[y],dp(y,x);\n}\n\nint main(int argc, char const *argv[])\n{\n\tn=read();\n\tfor(int i=1; i<n; ++i)\n\t\taddedge(read(),i+1);\n\tans[1]=1; dfs(1,1); dp(1,1);\n\tfor(int i=1; i<=n; ++i)\n\t\tprintf(\"%.1lf%c\", ans[i],\" \\n\"[i==n]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1591101440,
        "uid": 107735,
        "name": "shiroi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8\uff1a \u6d1b\u8c37 CF696B Puzzles](https://www.luogu.com.cn/problem/CF696B) \n\n\u9996\u5148\u5728\u6b64\u611f\u8c22 @[OneZzz6174](https://www.luogu.com.cn/user/368107) \u5927\u4f6c\u63d0\u4f9b\u7684\u5b66\u672f\u652f\u6301\u3002\n\n## \u601d\u8def\n\n\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9 $i$ \u7684\u671f\u671b\u65f6\u95f4\u6233\uff0c\u6211\u4eec\u8bb0\u4e3a $f_i$\u3002\n\n\u4e0e\u5176\u4ed6\u9898\u89e3\u6240\u8ff0\u76f8\u4f3c\uff0c\u6211\u4eec\u6839\u636e $i$ \u7684\u7236\u4eb2\u8282\u70b9\u548c\u5b83\u7684\u5144\u5f1f\u8282\u70b9\u53ef\u4ee5\u5f97\u5230 $f_i$\u3002\n\n\u5177\u4f53\u5730\uff0c\u5b83\u7684\u5144\u5f1f\u8282\u70b9\u5bf9\u5b83\u7684\u8d21\u732e\uff08\u4e5f\u662f\u4ece\u5b83\u7684\u7236\u4eb2\u8d70\u5230\u5b83\u8fd9\u4e2a\u8282\u70b9\u7684\u6982\u7387\uff09\u662f $\\dfrac{siz_{fa}-siz_u-1}{2}$\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5f97\u5230 $f_i=f_{fa} + \\dfrac{siz_{fa}-siz_u-1}{2} + 1$\u3002\n\n\u5176\u4ed6\u633a\u591a\u9898\u89e3\u5927\u81f4\u90fd\u8bf4\u5230\u8fd9\u91cc\u3002\n\n\u6240\u4ee5\u6211\u4e0d\u59a8\u6765\u8bf4\u8bf4\u6700\u540e\u90a3\u4e2a\u52a0\u4e00\u662f\u600e\u4e48\u6765\u7684\u3002\n\n\u4e0a\u9762\u5f97\u5230 $f_i$ \u7684\u5f0f\u5b50\u4e2d\uff0c\u4e2d\u95f4\u90a3\u4e00\u9879\uff0c\u65e0\u7591\u662f\u7236\u4eb2\u8d70\u5230\u8282\u70b9 $i$ \u7684\u6982\u7387\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u6b64\u9898\u6c42\u7684\u662f\u6bcf\u4e2a\u8282\u70b9\u7684\u671f\u671b**\u65f6\u95f4\u6233**\uff0c\u6240\u4ee5\u5728\u8d70\u5230\u8282\u70b9 $i$ \u7684\u65f6\u5019\uff0c\u65f6\u95f4\u6233\u8981\u52a0\u4e00\uff0c\u8fd9\u5c31\u662f\u6700\u540e\u4e00\u4e2a\u52a0\u4e00\u7684\u7f18\u7531\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define rep(i, a, b) for(register int i = a; i <= b; ++i)\n#define per(i, a, b) for(register int i = a; i >= b; --i)\n#define go(u) for(int i = hd[u], v = e[i].to; i; i = e[i].nxt, v = e[i].to)\n#define add(u, v) (e[++cnt].to = v, e[cnt].nxt = hd[u], hd[u] = cnt)\n#define Add(u, v) (add(u, v), add(v, u))\ntypedef long long ll ;\ninline int rd(){\n\tint x = 1, s = 0; char ch = getchar();\n\twhile(ch < '0' or ch > '9'){if(ch == '-') x = -1; ch = getchar();}\n\twhile(ch >= '0' and ch <= '9') s = s * 10 + ch - '0', ch = getchar();\n\treturn x * s;\n}\ninline void wr(int x){\n\tif(x < 0) putchar('-'), x *= -1;\n\tif(x > 9) wr(x / 10);\n\tputchar(x % 10 + '0');\n}\n//----------------------------------//\nconst int maxn = 1e5 + 5;\nint cnt, hd[maxn];\nstruct edge{\n\tint to, nxt;\n}e[maxn << 1];\nint n, siz[maxn];\ndouble f[maxn];\n\ninline void dfs1(int u, int fa){\n\tsiz[u] = 1;\n\tgo(u) if(v ^ fa)\n\t\tdfs1(v, u), siz[u] += siz[v];\n}\n\ninline void dfs2(int u, int fa){\n\tif(fa) f[u] = f[fa] + (siz[fa] - siz[u] - 1.0) / 2.0 + 1.0;\n\tgo(u) if(v ^ fa) dfs2(v, u);\n}\n\nint main(){\n\tn = rd(); int x;\n\trep(i, 2, n) x = rd(), Add(x, i);\n\tf[1] = 1.0, dfs1(1, 0), dfs2(1, 0);\n\trep(i, 1, n) printf(\"%.1lf \", f[i]);\n\treturn 0;\n}\n```\n\n\n------------\n\u611f\u8c22\u9605\u8bfb\u3002\n\n\u8f9b\u82e6\u7ba1\u7406\u5458\u5ba1\u6838\uff0c\u5982\u6709\u95ee\u9898\u70e6\u8bf7\u6307\u51fa\u3002",
        "postTime": 1656596586,
        "uid": 469672,
        "name": "\u4f0d\u53c1\u58f9",
        "ccfLevel": 7,
        "title": "CF696B Puzzles \u9898\u89e3"
    },
    {
        "content": "### CF696B Puzzles  \n\n---\n\n#### \u9898\u610f  \n\n>$\\ \\ \\ \\ $ \u7ed9\u51fa\u4e00\u4e2a\u6253\u65f6\u95f4\u6233\u7684 dfs,\u6bcf\u6b21\u5c06\u6240\u6709\u513f\u5b50\u7b49\u6982\u7387\u91cd\u65b0\u6392\u5217\u540e\u518d\u904d\u5386\uff0c\u6c42\u6bcf\u4e2a\u8282\u70b9\u7684\u671f\u671b\u65f6\u95f4\u6233\u3002\n\n---\n\n#### \u9898\u89e3  \n\n$~~~~$ \u4e4d\u4e00\u770b\u968f\u673a\u5316\u65e0\u4ece\u4e0b\u624b\uff0c\u4f46\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9 $u$ ,\u82e5\u6709\u4e00\u4e2a\u5b50\u8282\u70b9 $v$ \uff0c\u8003\u8651\u5176\u4ed6\u5b50\u8282\u70b9 $v'(v' \\not = v)$ \u5bf9\u5b83\u7684\u8d21\u732e\u3002\u82e5 $v'$ \u5728\u91cd\u6392\u7684\u5e8f\u5217\u4e2d\u5728\u5b83\u524d\u9762\uff0c\u5bf9\u5b83\u7684\u8d21\u732e\u5c31\u662f $\\operatorname{siz(v')}$ \uff0c\u5176\u4e2d $\\operatorname{siz(u)}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u5927\u5c0f\u3002  \n\n$~~~~$ \u518d\u6765\u8003\u8651\u6bcf\u4e2a $v'$ \u5728 $v$ \u524d\u9762\u7684\u6982\u7387\uff0c\u4e0d\u96be\u60f3\u5230\u5f53\u6709\u4e00\u79cd\u60c5\u51b5 $v'$ \u5728 $v$ \u524d\u9762\u65f6\uff0c\u76f4\u63a5\u5c06\u5e8f\u5217\u7ffb\u8f6c\u53ef\u4ee5\u5f97\u5230\u4e0e\u4e4b\u5bf9\u5e94\u7684 $v'$ \u5728 $v$ \u540e\u9762\u7684\u6982\u7387\u3002\u56e0\u6b64 $v'$ \u7b49\u6982\u7387\u5728 $v$ \u7684\u524d\u540e\uff0c\u56e0\u6b64 $v'$ \u5bf9 $v$ \u7684\u65f6\u95f4\u6233\u7684\u671f\u671b\u7684\u8d21\u732e\u4e3a $\\dfrac{\\operatorname{siz(v')}}{2}$ \u3002\u603b\u7684\u8d21\u732e\u4e3a\u6240\u6709 $u$ \u7684\u5b50\u8282\u70b9\u4e2d\u6240\u6709\u4e0d\u662f $v$ \u7684\u5b50\u6811\u5927\u5c0f\u548c\u7684\u4e00\u534a\uff0c\u8f6c\u6362\u4e00\u4e0b\u5c31\u662f $\\dfrac{\\operatorname{siz(u)-siz(v)-1}}{2}$.\u56e0\u6b64 $dp$ \u8f6c\u79fb\u5373\u53ef\n\n$~~~~$ \u8bbe\uff1a$dp_{u}$ \u8868\u793a $u$ \u8282\u70b9\u7684\u671f\u671b\u65f6\u95f4\u6233\uff0c\u82e5 $u$ \u7684\u7236\u8282\u70b9\u4e3a $fa$ \u5219\u6709\uff1a  \n\n$$\ndp_{u}=dp_{fa}+1+\\dfrac{\\operatorname{siz(u)-siz(v)-1}}{2}\n$$\n\n---\n\n#### \u4ee3\u7801  \n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <algorithm>\nusing namespace std;\nvector <int> G[100005];\nint sz[100005];\ndouble dp[100005];\nvoid dfs(int u,int fa)\n{\n\tsz[u]=1;\n\tfor(int i=0;i<G[u].size();i++) \n\t{\n\t\tint v=G[u][i];\n\t\tif(v==fa) continue;\n\t\tdfs(v,u);\n\t\tsz[u]+=sz[v];\n\t}\n}\nvoid DP(int u,int fa)\n{\n\tif(fa!=0) dp[u]=dp[fa]+1+(sz[fa]-sz[u]-1)*1.0/2;\n\tfor(int i=0;i<G[u].size();i++)\n\t{\n\t\tint v=G[u][i];\n\t\tif(v==fa) continue;\n\t\tDP(v,u);\n\t}\n}\nint main() {\n\tint n;\n\tscanf(\"%d\",&n);\n\tfor(int i=2,f;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&f);\n\t\tG[f].push_back(i);\n\t\tG[i].push_back(f);\n\t}\n\tdfs(1,0);\n\tdp[1]=1;\n\tDP(1,0);\n\tfor(int i=1;i<=n;i++) printf(\"%.1f \",dp[i]);\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1597325175,
        "uid": 160701,
        "name": "Azaz\u0435l",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF696B)\n\n---\n\n\u5176\u5b9e\u4e0a\u624b\u8fd9\u9053\u9898\u611f\u89c9\u8fd8\u662f\u4e0d\u662f\u975e\u5e38\u96be\uff0c\u5b9a\u4e49 $dp_i$ \u4e3a\u5230\u7b2c $i$ \u4e2a\u70b9\u7684\u671f\u671b\u3002\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u77e5\u9053\uff0c\u4e00\u4e2a\u8282\u70b9\u7684\u671f\u671b\u80af\u5b9a\u4e0e\u5b83\u7684\u7238\u7238\u6709\u5173\uff0c\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u5f97\u51fa\u8981\u5148\u7b97\u5f53\u524d\u8282\u70b9\u7684\u671f\u671b\uff0c\u518d\u641c\u5b50\u6811\u7684\u89c4\u5f8b\u3002\n\n\u8bbe\u7238\u7238\u662f $u$ ,\u5b83\u7684\u4e00\u4e2a\u513f\u5b50\u662f $v$ \u5176\u4ed6\u513f\u5b50\u662f $v'$ ,\u5176\u4ed6\u513f\u5b50\u5bf9 $v$ \u7684\u8d21\u732e\u662f$\\dfrac{size_{v'}}{2}$\uff0c\u5c31\u53ef\u63a8\u51fa:\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ $ $dp_v = dp_x + (sz_x - sz_v - 1) / 2 + 1$\n\n$sz_x - sz_v - 1$ \u662f\u5176\u4ed6\u7684\u5b50\u6811\u5927\u5c0f\u7684\u548c\u3002\n\n```cpp\n#include <cmath>\n#include <vector>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\n\ntemplate<typename T>void read(T &x) {\n    T f = 1;x = 0;char s = getchar();\n    while(s < '0' || s > '9') {if(s == '-')f = -1;s = getchar();}\n    while(s >= '0' && s <= '9') {x = x * 10 + s - '0';s = getchar();}\n    x *= f;\n}\ntemplate<typename T>void print(T x) {\n    if(x < 0) putchar('-'),x = -x;\n    if(x > 9) print(x / 10);\n    putchar(x % 10 + '0');\n}\n\nint n,sz[100005];\ndouble dp[100005];\nvector<int> g[100005];\n\nvoid dfs1(int x,int fa) {\n\tsz[x] = 1;\n\tfor (int i = 0 ; i < g[x].size() ; ++ i) {\n\t\tint v = g[x][i];\n\t\tdfs1(v,x);\n\t\tsz[x] += sz[v];\n\t}\n}\n\nvoid dfs(int x,int fa) {\n\tfor (int i = 0 ; i < g[x].size() ; ++ i) {\n\t\tint v = g[x][i];\n\t\tdp[v] = dp[x] + (sz[x] - sz[v] - 1.0) * 1.0 / 2 + 1;\n\t\tdfs(v,x);\n\t}\n}\n\nint main () {\n\tread(n);\n\tint x;\n\tfor (int i = 2 ; i <= n ; ++ i) {\n\t\tread(x);\n\t\tg[x].push_back(i);\n\t}\n\tdp[1] = 1;\n\tdfs1(1,0);\n\tdfs(1,0);\n\tfor (int i = 1 ; i <= n ; ++ i) {\n\t\tprintf(\"%.1lf \",dp[i]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1597308458,
        "uid": 163516,
        "name": "Strelitzia",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\u82e5\u662f\u663e\u793a\u6709\u95ee\u9898\u5c31\u6765\u849f\u84bb\u7684[\u535a\u5ba2](https://www.luogu.com.cn/blog/bzlz-zdx/solution-cf696b)\u770b\u770b\u5427\uff01~~\u6ca1\u6709\u95ee\u9898\u4e5f\u53ef\u4ee5\u770b\u770b\u54af\uff01~~\n\n## \u9898\u610f\u7b80\u8ff0\n\u4ece\u6839\u7ed3\u70b9\u5f00\u59cb\uff0c\u6309\u7167\u6bcf\u6b21\u968f\u673a\u8fdb\u5165\u4e00\u4e2a\u672a\u8fdb\u5165\u8fc7\u7684\u513f\u5b50\u7684\u7b56\u7565\uff0c\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u4e00\u68f5\u6811\uff0c\u6c42\u8bbf\u95ee\u6bcf\u4e2a\u7ed3\u70b9\u7684\u671f\u671b\u65f6\u95f4\u3002\n\n## \u9898\u76ee\u5206\u6790\n\u9996\u5148\u5bb9\u6613\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4efb\u610f\u7ed3\u70b9\uff0c\u8bbf\u95ee\u5b83\u7684\u671f\u671b\u65f6\u95f4\u4e0e\u5176\u7236\u7ed3\u70b9\u7684\u671f\u671b\u8bbf\u95ee\u65f6\u95f4\u548c\u5728\u5b83\u4e4b\u524d\u8bbf\u95ee\u7684\u5144\u5f1f\u7ed3\u70b9\u7684\u671f\u671b\u8bbf\u95ee\u65f6\u95f4\u6709\u5173\u3002\u5176\u7236\u7ed3\u70b9\u7684\u671f\u671b\u8bbf\u95ee\u65f6\u95f4\u548c\u8fd9\u4e2a\u95ee\u9898\u662f\u4e00\u4e2a\u540c\u6837\u7ed3\u6784\u7684\u95ee\u9898\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u7684\u5c31\u662f\u5728\u5b83\u4e4b\u524d\u8bbf\u95ee\u7684\u5144\u5f1f\u7ed3\u70b9\u7684\u671f\u671b\u8bbf\u95ee\u65f6\u95f4\u3002  \n\n\u7a76\u7adf\u6709\u54ea\u4e9b\u5144\u5f1f\u7ed3\u70b9\u5728\u8fd9\u4e2a\u7ed3\u70b9\u4e4b\u524d\u8bbf\u95ee\u5462\uff1f~~\u8fd9\u662f\u4e2a\u597d\u95ee\u9898\u3002~~ \u5bf9\u4e8e\u671f\u671b\u7684\u95ee\u9898\uff0c\u95ee\u9898\u7684\u601d\u8003\u5e94\u8be5\u8f6c\u4e3a\u53e6\u4e00\u4e2a\u65b9\u5411\u3002\u8bbe\u4ee5\u7ed3\u70b9 $x$ \u4e3a\u6839\u7ed3\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u4e3a $\\operatorname{size}(x)$\uff0c\u5bb9\u6613\u77e5\u9053\uff0c\u5982\u679c\u7ed3\u70b9 $x$ \u7684\u5144\u5f1f\u7ed3\u70b9 $i$ \u6bd4\u5176\u5148\u8bbf\u95ee\uff0c\u90a3\u4e48\u5b83\u4f1a\u4f7f\u5f97\u7ed3\u70b9 $x$ \u7684\u671f\u671b\u8bbf\u95ee\u65f6\u95f4\u589e\u52a0 $\\operatorname{size}(i)$\u3002\u8bbe\u7ed3\u70b9 $x$ \u7684\u671f\u671b\u8bbf\u95ee\u65f6\u95f4\u4e3a $\\operatorname{E}(x)$\uff0c\u7236\u7ed3\u70b9\u4e3a$\\operatorname{father}(x)$\uff0c\u5176\u6bcf\u4e2a\u5144\u5f1f\u7ed3\u70b9\u5728\u5b83\u4e4b\u524d\u8bbf\u95ee\u5230\u7684\u6982\u7387\u4e3a $\\operatorname{P}(i)$\uff0c\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u516c\u5f0f\uff1a\n$$\n\\operatorname{E}(x)=\\operatorname{E}(\\operatorname{father}(x))+\\sum \\operatorname{P}(i)\\operatorname{size}(i)+1\n$$\n\u90a3\u4e48 $\\operatorname{P}(i)$ \u5230\u5e95\u662f\u591a\u5c11\u5462\uff1f\u7531\u4e8e\u6bcf\u4e2a\u5144\u5f1f\u7ed3\u70b9 $i$ \u4e0e $x$ \u7684\u5173\u7cfb\u53ea\u6709\u4e24\u79cd\u53ef\u80fd\uff1a\u5728\u5176\u4e4b\u524d\u4e0e\u5728\u5176\u4e4b\u540e\uff0c\u6545\u6240\u6709 $\\operatorname{P}(i)$ \u5747\u7b49\u4e8e $\\dfrac{1}{2}$\u3002  \n\n\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u5316\u7b80\u5f0f\u5b50\u5982\u4e0b\uff1a\n$$\n\\operatorname{E}(x)=\\operatorname{E}(\\operatorname{father}(x))+\\dfrac{\\sum\\operatorname{size}(i)}{2}+1\n$$\n\u5bf9\u4e8e $\\sum\\operatorname{size}(i)$ \u7684\u5feb\u901f\u8ba1\u7b97\uff0c\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u5f0f\u5b50\uff1a\n$$\n\\sum\\operatorname{size}(i)=\\operatorname{size}(\\operatorname{father}(x))-\\operatorname{size}(x)-1\n$$\n\u6545\u53ef\u4ee5\u4e00\u904d dfs \u9884\u5904\u7406 $\\operatorname{size}(x)$\uff0c\u7136\u540e\u518d\u4e00\u904d\u7edf\u8ba1\u7b54\u6848\u3002\n## \u4ee3\u7801\n\u6ce8\u610f\u8fb9\u754c\uff1a$\\operatorname{E}(1)=1$\u3002\n```cpp\n#include<cstdio>\nusing namespace std;\nint n,tot,father[100001],size[100001],head[100001],go[100001],suc[100001];\ndouble f[100001];\nvoid dfs1(int x)\n{\n\tsize[x]=1;\n\tfor(int i=head[x];i;i=suc[i])\n\t{\n\t\tdfs1(go[i]);\n\t\tsize[x]+=size[go[i]];\n\t}\n\treturn;\t\n}\nvoid dfs2(int x)\n{\n\tf[x]=f[father[x]]+(size[father[x]]-size[x]-1)/2.0+1;\n\tfor(int i=head[x];i;i=suc[i])\n\t\tdfs2(go[i]);\n\treturn;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=2;i<=n;++i)\n\t{\n\t\tscanf(\"%d\",&father[i]);\n\t\tgo[++tot]=i;\n\t\tsuc[tot]=head[father[i]];\n\t\thead[father[i]]=tot;\n\t\t++size[head[i]];\n\t}\n\tdfs1(1);\n\tsize[0]=size[1]+1;//\u4f7f\u5f97f[1]\u6ee1\u8db3\u8fb9\u754c\n\tdfs2(1);\n\tfor(int i=1;i<=n;++i)\n\t\tprintf(\"%.1lf \",f[i]);\n\treturn 0;\n}\n```",
        "postTime": 1587033599,
        "uid": 67952,
        "name": "\u767d\u9c9f",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    },
    {
        "content": "\u7528 $f[u]$ \u8868\u793a\u8bbf\u95ee\u8282\u70b9 $u$ \u7684\u671f\u671b\u65f6\u95f4\uff0c$siz[u]$ \u8868\u793a\u5b50\u6811 $u$ \u7684\u5927\u5c0f\u3002\n\n\u4ee4 $v$ \u4e3a $u$ \u7684\u4e00\u4e2a\u513f\u5b50\uff0c\u90a3\u4e48 $f[v]=f[u]+1+\\frac{siz[u]-siz[v]-1}2$ \u3002\n\n\u56e0\u4e3a $u$ \u9664\u4e86 $v$ \u4ee5\u5916\u7684\u5176\u5b83\u513f\u5b50\uff0c\u6bcf\u4e2a\u513f\u5b50\u90fd\u6709 $\\frac 1 2$ \u7684\u6982\u7387\u5728 $v$ \u4e4b\u524d\u88ab\u8bbf\u95ee\u3001$\\frac 1 2$ \u7684\u6982\u7387\u5728 $v$ \u4e4b\u540e\u88ab\u8bbf\u95ee\uff0c\u4e00\u4e2a\u513f\u5b50 $v'$ \u5bf9 $f[v]$ \u7684\u8d21\u732e\u5c31\u662f $\\frac{siz[v']}2$ \u3002\n\n\u53c2\u8003\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n\nusing namespace std;\n\nconst int N=100010;\n\nvoid add(int u,int v);\nvoid dfs1(int u);\nvoid dfs2(int u);\n\nint head[N],nxt[N],to[N],cnt;\nint n,p[N],siz[N];\ndouble f[N];\n\nint main()\n{\n\tint i;\n\t\n\tscanf(\"%d\",&n);\n\t\n\tfor (i=2;i<=n;++i)\n\t{\n\t\tscanf(\"%d\",p+i);\n\t\tadd(p[i],i);\n\t}\n\t\n\tdfs1(1);\n\tf[1]=1;\n\tdfs2(1);\n\t\n\tfor (i=1;i<=n;++i)\n\t{\n\t\tprintf(\"%.6lf \",f[i]);\n\t}\n\t\n\treturn 0;\n}\n\nvoid add(int u,int v)\n{\n\tnxt[++cnt]=head[u];\n\thead[u]=cnt;\n\tto[cnt]=v;\n}\n\nvoid dfs1(int u)\n{\n\tint i,v;\n\tsiz[u]=1;\n\tfor (i=head[u];i;i=nxt[i])\n\t{\n\t\tv=to[i];\n\t\tdfs1(v);\n\t\tsiz[u]+=siz[v];\n\t}\n}\n\nvoid dfs2(int u)\n{\n\tint i,v;\n\tfor (i=head[u];i;i=nxt[i])\n\t{\n\t\tv=to[i];\n\t\tf[v]=f[u]+1+(siz[u]-1-siz[v])/2.0;\n\t\tdfs2(v);\n\t}\n}\n```",
        "postTime": 1544505897,
        "uid": 49742,
        "name": "ouuan",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    },
    {
        "content": "\u4e0d\u4f1a\u5427\u4e0d\u4f1a\u5427\u8fd9\u9053\u9898 CF \u8bc4\u5206 $1700$ \u4e0d\u4f1a\u771f\u7684\u662f\u7d2b\u9898\u5427\u3002\n\n\u770b\u5230\u968f\u673a\u5316\u5c31\u5bb3\u6015\u3002\u95ee\u9898\u8ba9\u6211\u4eec\u6c42\u671f\u671b\uff0c\u6211\u4eec\u5f53\u7136\u8981\u7528\u4e00\u4e2a\u65b9\u6cd5\u53bb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u5b9a\u4e49\u4e00\u4e2a\u8282\u70b9 $u$ \u7684\u7b54\u6848\u4e3a $dp_u$\uff0c\u7b54\u6848\u663e\u7136\uff0c\u521d\u59cb\u72b6\u6001\u5373\u4e3a $dp_1 \\gets 1$\u3002\u5982\u4f55\u8f6c\u79fb\uff1f\n\n\u8003\u8651\u4e00\u4e2a\u8282\u70b9\u7684\u7b54\u6848\uff08\u5373\u65f6\u95f4\u6233\u7684\u671f\u671b\uff09\uff0c\u4ece\u5b83\u7684\u7236\u4eb2\u548c\u5b83\u7684\u7236\u4eb2\u7684\u5176\u4ed6\u5b50\u8282\u70b9\u5165\u624b\u3002\u8282\u70b9 $v$ \u5fc5\u987b\u7ee7\u627f\u7236\u4eb2 $u$ \u7684\u671f\u671b $dp_u$\uff0c\u8fd8\u8981\u52a0\u4e0a\u4e00\u4e2a $1$\u3002\u8ba1\u7b97\u5b83\u7684\u7236\u4eb2\u7684\u5176\u4ed6\u5b50\u8282\u70b9\u7684\u5f71\u54cd\u3002\u611f\u6027\u7406\u89e3\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a $v$ \u7236\u4eb2 $u$ \u7684\u5b50\u8282\u70b9 $v'(v' \\neq v)$\uff0c\u5176\u65f6\u95f4\u6233\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u6bd4 $v$ \u65e9\uff0c\u6bd4 $v$ \u665a\u3002\u56e0\u6b64\u4ee4 $\\operatorname{size}({v'})$ \u4e3a\u4ee5 $v'$ \u4e3a\u6839\u7684\u5b50\u6811\u5927\u5c0f\uff0c$v'$ \u7684\u8d21\u732e\u5b9e\u9645\u4e0a\u662f $\\dfrac{\\operatorname{size}(v')}{2}$\u3002\u4e8e\u662f\u6bcf\u4e2a $v'$ \u90fd\u4f1a\u7c7b\u4f3c\u7684\u7ed9 $v$ \u8fd9\u6837\u7684\u8d21\u732e\u3002\u53ef\u662f\u8fd9\u6837\u505a\u662f $O(n^2)$ \u7684\u3002\u4e8e\u662f\u6211\u4eec\u6c42\u51fa\u6bcf\u4e00\u4e2a $\\operatorname{size}(v)$\uff0c\u5c31\u53ef\u4ee5\u505a\u5230 $O(n)$ \u6c42\u89e3\u3002\u6ce8\u610f\u8ba1\u7b97\u8d21\u732e\u7684\u65f6\u5019\u6c42\u8d21\u732e\u91cf\u8981\u6392\u9664\u6389 $u$ \u8fd9\u4e2a\u8282\u70b9\u7684\u8d21\u732e\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$dp_v=dp_u+1+\\dfrac{\\operatorname{size}(u)-\\operatorname{size}(v)-1}{2}$$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nvector<int> G[100005];\nint n,sizen[100005];\ndouble dp[100005];\nvoid dfs1(int now)\n{\n\tsizen[now]=1;\n\tfor(unsigned int i=0;i<G[now].size();++i)\n\t{\n\t\tint to=G[now][i];\n\t\tdfs1(to);\n\t\tsizen[now]+=sizen[to];\n\t}\n}\nvoid dfs2(int now)\n{\n\tfor(unsigned int i=0;i<G[now].size();++i)\n\t{\n\t\tint to=G[now][i];\n\t\tdp[to]=dp[now]+1+(double)((double)sizen[now]-(double)sizen[to]-1)/(double)2;\n\t\tdfs2(to);\n\t}\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=2;i<=n;++i)\n\t{\n\t\tint fa;\n\t\tscanf(\"%d\",&fa);\n\t\tG[fa].push_back(i);\n\t}\n\tdfs1(1);\n\tdp[1]=1;\n\tdfs2(1);\n\tfor(int i=1;i<=n;++i)\tprintf(\"%.1f \",dp[i]);\n\treturn 0;\n}\n```",
        "postTime": 1597303375,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF696B \u3010Puzzles\u3011"
    }
]