[
    {
        "content": "### \u9898\u76ee\u5927\u610f\n- \u7ed9\u5b9a\u7531\u6392\u5217\u968f\u673a\u751f\u6210\u7684\u5206\u6cbb\u6811\uff0c\u5206\u6cbb\u6811\u53ef\u4ee5\u4e0a\u6bcf\u4e2a\u8282\u70b9\u53ef\u4ee5\u4ea4\u6362\u5de6\u53f3\u513f\u5b50\u3002\n- \u5728\u968f\u673a\u4ea4\u6362\u4e24\u4e2a\u503c\u5f97\u60c5\u51b5\u4e0b\uff0c\u6c42\u5206\u6cbb\u6811\u5148\u5e8f\u904d\u5386\u53f6\u5b50\u8282\u70b9\u7684\u6700\u5c0f\u9006\u5e8f\u5bf9\u4e2a\u6570\u3002\n\n### solution\n- \u6574\u4f53\u4ea4\u6362\u5de6\u53f3\u513f\u5b50\u53d1\u73b0\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\u53ea\u6709\u8de8\u8d8a\u5f53\u524d\u5206\u6cbb\u6811\u8282\u70b9\u7684\u9006\u5e8f\u5bf9\u6709\u5f71\u54cd\uff0c\u4e0d\u4f1a\u5f71\u54cd\u7236\u4eb2\u8282\u70b9\u3001\u513f\u5b50\u8282\u70b9\u7684\u7b54\u6848\u8d21\u732e\u3002\n- \u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u5206\u5206\u6cbb\u8282\u70b9\u76f4\u63a5\u8d2a\u5fc3\u8003\u8651\uff0c\u5982\u679c\u4ea4\u6362\u540e\u7b54\u6848\u51cf\u5c0f\u5c31\u76f4\u63a5\u4ea4\u6362\u3002\n- \u5373\u7ef4\u62a4 $lval$\u3001$rval$ \u5206\u522b\u8868\u793a\u5148\u8d70\u5de6\u5de6\u513f\u5b50\u3001\u53f3\u513f\u5b50\u7684\u7b54\u6848\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u5728\u6bcf\u4e2a\u8282\u70b9\u5f00\u4e00\u9897\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u5b8c\u6210\u3002\n- \u90a3\u4e48\u7b97\u6cd5\u5927\u4f53\u6846\u67b6\u5c31\u51fa\u6765\u4e86\uff1a\n\t- \u5bf9\u4e8e\u5206\u6cbb\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u5f00\u7ebf\u6bb5\u6811\u7ef4\u62a4 $lval$\u3001$rval$\uff0c\u8d2a\u5fc3\u9009\u62e9\u4ea4\u6362\u513f\u5b50\u3002\n   - \u4ea4\u6362\u4e24\u4e2a\u503c\u5f97\u65f6\u5019\u5c31\u5728\u5206\u6cbb\u6811\u4e0a\u66b4\u529b\u8df3\u7236\u4eb2\uff0c\u5728\u7ebf\u6bb5\u6811\u4e0a\u63d2\u5165\u5220\u9664\uff0c\u540c\u65f6\u8ba1\u7b97 $lval$\u3001$rval$\uff0c\u5982\u679c $rval > lval$ \u76f4\u63a5\u4ea4\u6362\u5de6\u53f3\u513f\u5b50\u53ca\u4fe1\u606f\u5373\u53ef\u3002\n- \u8003\u8651\u590d\u6742\u5ea6\uff0c\u9996\u5148\u662f\u7ebf\u6bb5\u6811\u6709\u4e00\u53ea $\\log$\u3002\u8003\u8651\u5206\u6cbb\u6811\uff0c\u9898\u76ee\u5f53\u4e2d\u660e\u786e\u8868\u793a\uff1a\u5206\u6cbb\u6811\u57fa\u4e8e\u4e00\u4e2a\u968f\u673a\u6392\u5217\u751f\u6210\u3001\u5e76\u4e14\u6240\u6709\u4fee\u6539\u968f\u673a\u751f\u6210\u3002\n- \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u6bcf\u4e00\u6b21\u8be2\u95ee\u7684\u8282\u70b9\u5230\u8fbe\u5206\u6cbb\u6811\u6839\u7684\u8ddd\u79bb\u671f\u671b\u4e3a $\\log$\u3002\n- \u90a3\u4e48\u6211\u4eec\u7b97\u6cd5\u590d\u6742\u5ea6\u4e3a\u671f\u671b $\\mathcal O(n\\log^{2}n)$\uff0c\u57fa\u4e8e\u6570\u636e\u968f\u673a\u3002\n\n```\n//ayanami\u4fdd\u4f51\uff0c\u5938\u54e5\u4fdd\u4f51\uff0c\u72d7\u5988\u4fdd\u4f51\uff0cMDR\u4fdd\u4f51\uff0c\u9509\u5200\u602a\u4fdd\u4f51\uff0cM99\u4fdd\u4f51\uff0c\u514b\u7239\u4fdd\u4f51\n#include<bits/stdc++.h>\nusing namespace std;\nint p1=1000000,p2=0;\nchar buf[1000005],wb[1000005];\nint gc() {\n\tif(p1>=1000000)fread(buf,1,1000000,stdin),p1=0;\n\treturn buf[p1++];\n}\n#define gc getchar\n#define Loli true\n#define Kon xor true\nlong long getint() {\n\tlong long ret=0,flag=1;\n\tchar c=gc();\n\twhile(c<'0'||c>'9') {\n\t\tif(c=='-')flag=-1;\n\t\tc=gc();\n\t}\n\twhile(c<='9'&&c>='0') {\n\t\tret=(ret<<3)+(ret<<1)+c-'0';\n\t\tc=gc();\n\t}\n\treturn ret*flag;\n}\nvoid pc(char x) {\n\tif(p2>=1000000)fwrite(wb,1,1000000,stdout),p2=0;\n\twb[p2++]=x;\n}\nvoid wrt(long long x) {\n\tif(x<0)pc('-'),x=-x;\n\tint c[24]= {0};\n\tif(!x)return pc('0'),void();\n\twhile(x)c[++c[0]]=x%10,x/=10;\n\twhile(c[0])pc(c[c[0]--]+'0');\n}\nlong long ans;\nint n,m,w[200005],p[200005],wp[200005];\nnamespace Seg{\n\tstruct node{int l,r,val;}v[800005];\n\tvoid build(int rt,int l,int r){\n\t\tv[rt].l=l,v[rt].r=r;\n\t\tif(l==r)return v[rt].val=w[l],void();\n\t\tint mid=(l+r)>>1;build(rt<<1,l,mid),build(rt<<1|1,mid+1,r);\n\t\tv[rt].val=min(v[rt<<1].val,v[rt<<1|1].val);\n\t}\n\tint ask(int rt,int l,int r){\n\t\tif(l<=v[rt].l&&v[rt].r<=r)return v[rt].val;\n\t\tint mid=v[rt<<1].r,res=0x3f3f3f3f;\n\t\tif(l<=mid)res=min(res,ask(rt<<1,l,r));\n\t\tif(mid<r)res=min(res,ask(rt<<1|1,l,r));\n\t\treturn res;\n\t}\n}\nnamespace S{\n\tint tot;\n\tstruct node{int ls,rs,val;}v[80000005];\n\tvoid ins(int &rt,int p,int val,int L=1,int R=n){\n\t\tif(!rt)rt=++tot;\n\t\tv[rt].val+=val;\n\t\tif(L==R)return;\n\t\tint mid=(L+R)>>1;\n\t\tif(p<=mid)ins(v[rt].ls,p,val,L,mid);\n\t\telse ins(v[rt].rs,p,val,mid+1,R);\n\t}\n\tint ask(int rt,int l,int r,int L=1,int R=n){\n\t\tif(!rt||l<=L&&R<=r)return v[rt].val;\n\t\tint mid=(L+R)>>1,res=0;\n\t\tif(l<=mid)res+=ask(v[rt].ls,l,r,L,mid);\n\t\tif(mid<r)res+=ask(v[rt].rs,l,r,mid+1,R);\n\t\treturn res;\n\t}\n}\nstruct node{int ls,rs,lrt,rrt,fa;long long lval,rval;}v[200005];\nint fa[200005];\nint build(int l,int r,int prt){\n\tif(l>r)return 0;\n\tif(l==r)return fa[l]=fa[l+1]=l,v[l].fa=prt,v[l].ls=l,v[l].rs=l+1,l;\n\tint rt=wp[Seg::ask(1,l,r)];\n\tv[rt].fa=prt;\n\tv[rt].ls=l<rt?build(l,rt-1,rt):(fa[l]=rt,l);\n\tv[rt].rs=rt<r?build(rt+1,r,rt):(fa[rt+1]=rt,rt+1);\n\treturn rt;\n}\nvoid REV(int x){swap(v[x].ls,v[x].rs),swap(v[x].lrt,v[x].rrt),swap(v[x].lval,v[x].rval);}\nvoid INS(int pl,int val){\n\tans-=v[fa[pl]].lval;\n\tif(pl==v[fa[pl]].ls)S::ins(v[fa[pl]].lrt,val,1),v[fa[pl]].lval+=S::ask(v[fa[pl]].rrt,1,val),v[fa[pl]].rval+=S::ask(v[fa[pl]].rrt,val,n);\n\telse                S::ins(v[fa[pl]].rrt,val,1),v[fa[pl]].rval+=S::ask(v[fa[pl]].lrt,1,val),v[fa[pl]].lval+=S::ask(v[fa[pl]].lrt,val,n);\n\tif(v[fa[pl]].lval>v[fa[pl]].rval)REV(fa[pl]);\n\tans+=v[fa[pl]].lval,pl=fa[pl];\n\twhile(v[pl].fa){\n\t\tans-=v[v[pl].fa].lval;\n\t\tif(pl==v[v[pl].fa].ls)S::ins(v[v[pl].fa].lrt,val,1),v[v[pl].fa].lval+=S::ask(v[v[pl].fa].rrt,1,val),v[v[pl].fa].rval+=S::ask(v[v[pl].fa].rrt,val,n);\n\t\telse                  S::ins(v[v[pl].fa].rrt,val,1),v[v[pl].fa].rval+=S::ask(v[v[pl].fa].lrt,1,val),v[v[pl].fa].lval+=S::ask(v[v[pl].fa].lrt,val,n);\n\t\tif(v[v[pl].fa].lval>v[v[pl].fa].rval)REV(v[pl].fa);\n\t\tans+=v[v[pl].fa].lval,pl=v[pl].fa;\n\t}\n}\nvoid DEL(int pl,int val){\n\tans-=v[fa[pl]].lval;\n\tif(pl==v[fa[pl]].ls)S::ins(v[fa[pl]].lrt,val,-1),v[fa[pl]].lval-=S::ask(v[fa[pl]].rrt,1,val),v[fa[pl]].rval-=S::ask(v[fa[pl]].rrt,val,n);\n\telse                S::ins(v[fa[pl]].rrt,val,-1),v[fa[pl]].rval-=S::ask(v[fa[pl]].lrt,1,val),v[fa[pl]].lval-=S::ask(v[fa[pl]].lrt,val,n);\n\tif(v[fa[pl]].lval>v[fa[pl]].rval)REV(fa[pl]);\n\tans+=v[fa[pl]].lval,pl=fa[pl];\n\twhile(v[pl].fa){\n\t\tans-=v[v[pl].fa].lval;\n\t\tif(pl==v[v[pl].fa].ls)S::ins(v[v[pl].fa].lrt,val,-1),v[v[pl].fa].lval-=S::ask(v[v[pl].fa].rrt,1,val),v[v[pl].fa].rval-=S::ask(v[v[pl].fa].rrt,val,n);\n\t\telse                  S::ins(v[v[pl].fa].rrt,val,-1),v[v[pl].fa].rval-=S::ask(v[v[pl].fa].lrt,1,val),v[v[pl].fa].lval-=S::ask(v[v[pl].fa].lrt,val,n);\n\t\tif(v[v[pl].fa].lval>v[v[pl].fa].rval)REV(v[pl].fa);\n\t\tans+=v[v[pl].fa].lval,pl=v[pl].fa;\n\t}\n}\nint main() {\n\tn=getint();\n\tfor(int i=1;i<=n;i++)p[i]=getint();\n\tfor(int i=1;i<n;i++)wp[w[i]=getint()]=i;\n\tSeg::build(1,1,n-1),build(1,n-1,0);\n\tfor(int i=1;i<=n;i++)INS(i,p[i]);\n\tm=getint();\n\tfor(int i=1;i<=m;i++){\n\t\tint l=getint(),r=getint();\n\t\tDEL(l,p[l]),DEL(r,p[r]),swap(p[l],p[r]),INS(l,p[l]),INS(r,p[r]);\n\t\twrt(ans),pc('\\n');\n\t}\n\tfwrite(wb,1,p2,stdout);\n\treturn Loli Kon;\n}\n```",
        "postTime": 1644754169,
        "uid": 27338,
        "name": "jerry3128",
        "ccfLevel": 9,
        "title": "\u9898\u89e3\u3010CF1361F Johnny and New Toy\u3011"
    },
    {
        "content": "\u6ca1\u548b\u5199\u8fc7\u7ebf\u6bb5\u6811\u5408\u5e76\uff0c\u4e8e\u662f\u6765\u5199\u5199\u8fd9\u9053\u6c34\u9898\u3002\n\n\u9996\u5148\u89c2\u5bdf $W$ \u7684\u4ea4\u6362\u5b9a\u4e49\uff0c\u663e\u7136\u7684\u53d1\u73b0\u5c31\u662f\u7b1b\u5361\u5c14\u6811\u53ef\u4ee5\u4ea4\u6362\u5de6\u53f3\u5b50\u6811\u8fdb\u884c\u9006\u5e8f\u5bf9\u8d21\u732e\u3002\n\n\u5047\u8bbe\u4ea4\u6362\u70b9 $x$ \u7684\u5de6\u53f3\u5b50\u6811 $ls_x,rs_x$\uff0c\u90a3\u4e48 $ls_x,rs_x$ \u5b50\u6811\u5185\u90e8\u7684\u8d21\u732e\u4e0d\u53d8\uff0c\u56e0\u4e3a\u6bb5\u6574\u4f53\u4ea4\u6362\u3002\n\n\u540c\u65f6 $x$ \u5b50\u6811\u4ee5\u5916\u7684\u8d21\u732e\u4e0d\u53d8\uff0c\u5206\u522b\u770b $x$ \u5b50\u6811\u5de6\u8fb9\u548c\u53f3\u8fb9\u5c31\u4f1a\u53d1\u73b0\u90fd\u6ca1\u53d8\u3002\n\n\u6240\u4ee5\u8fb9\u7684\u8d21\u732e\u5c31\u53ea\u6709 $ls_x,rs_x$ \u4e92\u76f8\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f\u672c\u6765\u7684\u9006\u5e8f\u5bf9\u53d8\u6210\u4e86\u6b63\u5e8f\u5bf9\u3002\n\n\u90a3\u4e48\u6211\u4eec\u7edf\u8ba1\u9006\u5e8f\u5bf9\u7684\u4e2a\u6570\uff0c\u6b63\u5e8f\u5bf9\u5c31\u662f\u6240\u6709\u5bf9\u6570\u51cf\u53bb\u9006\u5e8f\u5bf9\u6570\uff0c\u8d2a\u5fc3\u53d6\u4e24\u4e2a\u4e2d\u6700\u5c0f\u7684\u5373\u53ef\u3002\n\n\u4e24\u4e2a\u5b50\u6811\u4e92\u76f8\u7684\u9006\u5e8f\u5bf9\u6570\u76f4\u63a5\u4e0a\u7ebf\u6bb5\u6811\u5408\u5e76\uff0c\u6211\u4eec\u5c31\u4f1a\u505a\u6ca1\u6709\u4fee\u6539\u7684\u95ee\u9898\u4e86\u3002\n\n~~\u7531\u4e8e\u6211\u53ea\u60f3\u7ec3\u4e60\u5199\u7ebf\u6bb5\u6811\u5408\u5e76\u800c\u4e0d\u60f3\u7ec3\u4e60\u7ebf\u6bb5\u6811\u5408\u5e76\u7edf\u8ba1\u8d21\u732e\uff0c\u4e8e\u662f\u6211\u4f7f\u7528\u4e86\u542f\u53d1\u5f0f\u7edf\u8ba1\u8d21\u732e\u3002~~\n\n\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\uff0c\u5982\u679c\u662f\u542f\u53d1\u5f0f\u5408\u5e76/\u7edf\u8ba1\u8d21\u732e\u4e5f\u53ef\u4ee5\u505a\uff0c\u590d\u6742\u5ea6\u662f $O(n\\log^2n)$ \u7684\u3002\n\n\u7a7a\u95f4\u590d\u6742\u5ea6\u7531\u4e8e\u540e\u9762\u8981\u53ef\u6301\u4e45\u5316\u6240\u4ee5\u662f $O(n\\log n)$ \u7684\uff0c\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u8bdd\u4f1a\u662f $O(n\\log^2 n)$\uff0c\u542f\u53d1\u5f0f\u7edf\u8ba1\u8d21\u732e\u6ca1\u6709\u7a7a\u95f4\u590d\u6742\u5ea6\u3002\n\n\u8003\u8651\u4fee\u6539\uff0c\u9996\u5148\u7531\u4e8e $W$ \u662f\u968f\u7684\uff0c\u6240\u4ee5\u7b1b\u5361\u5c14\u6811\u6811\u9ad8\u662f $\\log n$ \u7684\u3002\n\n\u76f4\u63a5\u5bf9\u6bcf\u4e2a\u70b9\u7684\u8d21\u732e\u90fd\u8fdb\u884c\u4fee\u6539\uff0c\u53d1\u73b0\u5c31\u662f\u770b\u6539\u7684\u90a3\u4e2a\u503c\u6709\u51e0\u4e2a\u9006\u5e8f\u5bf9\u52a0\u4e0a\u6216\u51cf\u53bb\u5373\u53ef\uff0c\u6211\u4eec\u4e4b\u524d\u7ebf\u6bb5\u6811\u5408\u5e76\u7684\u65f6\u5019\u53ef\u6301\u4e45\u5316\u4e00\u4e0b\u8fd9\u91cc\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u4e86\u3002\n\n\u7531\u4e8e\u8be2\u95ee\u4e0d\u72ec\u7acb\uff0c\u4e8e\u662f\u6bcf\u6b21\u8fd8\u8981\u4fee\u6539\uff0c\u5982\u679c\u76f4\u63a5\u53ef\u6301\u4e45\u5316\u4fee\u6539\u6211\u5c31\u7206\u7a7a\u95f4\u4e86\uff0c\u6240\u4ee5\u518d\u5f00\u4e00\u68f5\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u8be2\u95ee\u7684\u5f71\u54cd\u3002\n\n\u53cd\u6b63\u7ebf\u6bb5\u6811\u90e8\u5206\u90fd\u662f $O(\\log n)$ \u7684\uff0c\u7136\u540e\u4e58\u4e0a\u4fee\u6539\u7684\u70b9\u6570 $\\log n$\uff0c\u8be2\u95ee\u590d\u6742\u5ea6 $O(q\\log^2n)$\u3002\n\n~~\u7a7a\u95f4\u590d\u6742\u5ea6\u4e5f\u662f $O(q\\log^2n)$ \u7684\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u5c31\u6ca1\u88ab\u5361\u7a7a\u95f4\u4e86\uff08~~\n\n\u8fd8\u6709\u7b1b\u5361\u5c14\u6811\u968f\u4fbf\u5efa\u5c31\u884c\u4e86\uff0c\u603b\u590d\u6742\u5ea6 $O(n\\log n+q\\log^2n)$\uff0c\u6211\u542f\u53d1\u5f0f\u6240\u4ee5\u662f $n\\log^2n$ \u7684\uff0c\u4f46 CF \u673a\u5b50\u5feb\u4e5f\u5c31\u8fc7\u4e86\u3002\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/l0rk8ahi)\u8fd8\u662f\u653e\u4e00\u4e0b\u3002",
        "postTime": 1644899681,
        "uid": 158948,
        "name": "\u7ea6\u745f\u592b\u7528\u8111\u73a9",
        "ccfLevel": 0,
        "title": "CF1361F Johnny and New Toy"
    }
]