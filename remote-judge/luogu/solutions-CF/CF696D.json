[
    {
        "content": "# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/CF696D)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790  \n&emsp;&emsp;\u9996\u5148\u5bf9\u4e8e\u6a21\u5f0f\u4e32\u5efa\u7acb AC \u81ea\u52a8\u673a\uff0c\u5e76\u4e14\u8ba1\u7b97\u51fa\u6bcf\u4e2a\u72b6\u6001$p$\u7684\u8d21\u732e\u603b\u548c$con(p)$\u3002  \n&emsp;&emsp;\u8003\u8651\u4e00\u4e2a\u6734\u7d20\u7684 DP \uff1a  \n&emsp;&emsp;$f(i,p)$\uff1a\u5f53\u524d\u4e32\u957f\u5ea6\u4e3a$i$\uff0c\u5339\u914d\u5230$p$\u4e0a\u7684\u6700\u5927\u7b54\u6848\u3002  \n&emsp;&emsp;\u8bbe\u5728$p$\u540e\u52a0\u5165\u5b57\u7b26$c$\u4f1a\u8f6c\u79fb\u5230$t(p,c)$\uff0c DP \u7684\u8f6c\u79fb\u5982\u4e0b\uff1a  \n$$f(i+1,t(p,c))=\\max\\{f(i,p)+con(t(p,c))\\}$$  \n&emsp;&emsp;\u5982\u4f55\u8868\u793a\u8fd9\u79cd\u8f6c\u79fb\uff1f \u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\u77e9\u9635\uff1a  \n$$\nT_{i,j}=\n\\begin{cases}\n      con(j)&\\exists c, t(i,c)=j\\\\\n      -\\infty& otherwise\n\\end{cases}\n$$  \n&emsp;&emsp;\u5e76\u4e14\u53ef\u4ee5\u518d\u5b9a\u4e49\u4e00\u79cd\u77e9\u9635\u4e0a\u7684\u65b0\u8fd0\u7b97 ' $\\cdot$ ' \uff1a  \n$$C=A\\cdot B\\Leftrightarrow C_{i,j}=\\max\\{A_{i,k}+B_{k,j}\\}$$  \n&emsp;&emsp;\u90a3\u4e48\u6211\u4eec\u5bf9$T$\u8fdb\u884c$L$\u6b21$T\\cdot T$\uff0c\u518d\u4e0e\u521d\u59cb\u5411\u91cf$\\boldsymbol v$\u79ef\u8d77\u6765\uff0c\u5373\u662f\u7b54\u6848\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u7b54\u6848\u4e3a\uff1a  \n$$\\boldsymbol v\\cdot T^L$$    \n&emsp;&emsp;\u672c\u8d28\u7406\u89e3\uff1a  \n&emsp;&emsp;\u6211\u4eec\u7684 DP \u662f\u5728\u505a\u4ec0\u4e48\uff1f\u4f60\u4f1a\u53d1\u73b0\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u5728 AC \u81ea\u52a8\u673a\u7684\u6709\u5411\u56fe\u4e0a\u9762\u505a\u4e86\u4e00\u4e2a\u4ece\u6839\u51fa\u53d1\u8d70$l$\u6b65\u7684\u6700\u957f\u8def\u3002   \n&emsp;&emsp;\u90a3\u4e48$T$\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u90bb\u63a5\u77e9\u9635\uff0c\u800c ' $\\cdot$ ' \u7684\u672c\u8d28\u662f\u679a\u4e3e\u4e2d\u8f6c\u70b9\u8ba1\u7b97\u51fa\u4e0b\u4e00\u6b65\u7684\u6700\u957f\u8def\u3002  \n&emsp;&emsp;\u5176\u5b9e\u4e00\u6b21\u201c\u4e58\u6cd5\u201d\u5c31\u50cf\u662f\u505a\u4e86\u4e00\u6b21 Floyd \uff0c\u6211\u4eec\u662f\u505a\u4e86\u57fa\u4e8e Floyd \u7684\u5feb\u901f\u5e42\u8fd0\u7b97\uff01   \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cstring>\n\n#define Tour( c ) for( int c = 0 ; c < 26 ; c ++ )\n\ntypedef long long LL;\n\nconst int MAXN = 205, MAXL = 205;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n\treturn a > b ? a : b;\n}\n\nstruct matrix\n{\n\tLL mat[MAXL][MAXL];\n\tint n, m;\n\tmatrix() { m = n = 0, memset( mat, 0xc0, sizeof mat ); }\n\tmatrix( const int N, const int M ) { n = N, m = M, memset( mat, 0xc0, sizeof mat ); }\n\tLL* operator [] ( const int indx ) { return mat[indx]; }\n\t\n\tmatrix operator * ( matrix b ) \n\t{\n\t\tmatrix ret = matrix( n, b.m );\n\t\tfor( int i = 1 ; i <= ret.n ; i ++ )\n\t\t\tfor( int j = 1 ; j <= ret.m ; j ++ )\n\t\t\t\tfor( int k = 1 ; k <= m ; k ++ )\n\t\t\t\t\tret[i][j] = MAX( ret[i][j], mat[i][k] + b[k][j] );\n\t\treturn ret;\n\t}\n\t\n\tvoid operator *= ( matrix b ) { *this = *this * b; }\n};\n\nint ch[MAXL][26], fail[MAXL], con[MAXL], q[MAXL];\nint a[MAXN];\nint N, cnt; LL L;\nchar S[MAXL];\n\nmatrix I( const int n ) { matrix ret = matrix( n, n ); for( int i = 1 ; i <= n ; i ++ ) ret[i][i] = 0; return ret; }\n\nvoid insert( const int contri )\n{\n\tint p = 0, id;\n\tfor( int i = 1 ; S[i] ; i ++ )\n\t{\n\t\tid = S[i] - 'a';\n\t\tif( ! ch[p][id] ) ch[p][id] = ++ cnt;\n\t\tp = ch[p][id];\n\t}\n\tcon[p] += contri;\n}\n\nvoid init()\n{\n\tint h = 1, t = 0, u, v;\n\tTour( i ) if( ch[0][i] ) q[++ t] = ch[0][i];\n\twhile( h <= t )\n\t{\n\t\tu = q[h ++];\n\t\tTour( i )\n\t\t{\n\t\t\tif( v = ch[u][i] ) fail[v] = ch[fail[u]][i], q[++ t] = v;\n\t\t\telse ch[u][i] = ch[fail[u]][i];\n\t\t}\n\t\tcon[u] += con[fail[u]];\n\t}\n}\n\nmatrix qkpow( matrix base, LL indx )\n{\n\tmatrix ret = I( base.n );\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret *= base;\n\t\tbase *= base, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nint main()\n{\n\tread( N ), read( L );\n\tfor( int i = 1 ; i <= N ; i ++ ) read( a[i] );\n\tfor( int i = 1 ; i <= N ; i ++ ) scanf( \"%s\", S + 1 ), insert( a[i] );\n\tinit();\n\tmatrix A = matrix( 1, cnt + 1 ), B = matrix( cnt + 1, cnt + 1 );\n\tfor( int p = 0 ; p <= cnt ; p ++ )\n\t\tTour( c )\n\t\t\tB[p + 1][ch[p][c] + 1] = MAX( B[p + 1][ch[p][c] + 1], ( LL ) con[ch[p][c]] );\n\tA[1][1] = 0;\n\tA *= qkpow( B, L );\n\tLL ans = 0;\n\tfor( int p = 1 ; p <= cnt + 1 ; p ++ ) ans = MAX( ans, A[1][p] );\n\twrite( ans ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1589782057,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[CF696D]Legen..."
    },
    {
        "content": "## Description\n\n[link](https://www.luogu.com.cn/problem/CF696D)\n\n## Solution\n\n\u9996\u5148\u80af\u5b9a\u8981\u628a AC \u81ea\u52a8\u673a\u677f\u5b50\u6572\u4e86\u3002\n\n\u5148\u770b\u4e00\u4e0b\u5df2\u77e5\u77ed\u4fe1\u5185\u5bb9\uff0c\u6c42\u7b54\u6848\u7684\u8fc7\u7a0b\uff1a\n\n```cpp\nint query(string s) {\n  int ret = 0, cur = 0;\n  for (int i = 0; i < s.size(); ++i) {\n    cur = trie[cur][s[i] - 'a'];\n    ret += sum[j];\n  }\n  return ret;\n}\n```\n\n\u8fd9\u91cc\u7684 `sum` \u5c31\u662f\u5f53\u524d\u8282\u70b9\u5230 fail \u6811\u6839\u8282\u70b9\u8def\u5f84\u4e0a\u7684\u6743\u503c\u548c\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u77e5\u9053\u4e86\u6240\u6709\u957f\u5ea6\u4e3a $i$ \u7684\u7b54\u6848\uff0c\u5c31\u80fd\u63a8\u51fa\u957f\u5ea6\u4e3a $i+1$ \u7684\u7b54\u6848\u3002\n\n\u5f62\u8c61\u5316\u7684\u8bb2\u5c31\u662f\u8fd9\u6837\uff1a\u8bbe $f[i,j]$ \u8868\u793a\u5f53\u524d\u7684 `cur` \u662f $i$\uff0c\u957f\u5ea6\u4e3a $j$ \u7684\u7b54\u6848\uff0c\u90a3\u4e48 $f[trie[j,k],j+1]=\\max\\big\\{f[i,j]+sum[trie[i,k]](k=0,1,...,25)\\big\\}$\u3002\n\n\u5229\u7528\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53ef\u4ee5\u505a\u5230 $O(26\\times l\\times \\sum|s|)$\u3002\n\n\u4f46\u662f\u8fd9\u91cc\u7684 $l$ \u975e\u5e38\u5927\uff0c\u6240\u4ee5\u8981\u4f18\u5316\u3002\n\n\u6ce8\u610f\u5230\u957f\u5ea6\u4e3a $i+1$ \u7684\u7b54\u6848\u53ea\u4f1a\u8ddf\u957f\u5ea6\u4e3a $i$ \u7684\u6709\u5173\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u5229\u7528\u7c7b\u4f3c\u52a8\u6001 dp \u7684\u77e9\u4e58\u4f18\u5316\u4e86\u3002\uff08\u600e\u4e48\u77e9\u4e58\u5c31\u4e0d\u8bf4\u4e86\uff09\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O((\\sum|s|)^3\\log l)$\uff0c\u8fd8\u6709\u4e2a\u5de8\u5927\u5e38\u6570\uff0c\u56e0\u4e3a $sum$ \u6570\u7ec4\u4e5f\u8981\u641e\u5230\u77e9\u9635\u91cc\u9762\u3002\n\n\uff08\u8fd9\u4e9b\u4e1c\u897f\u5305\u62ec\u4ee3\u7801\u6211\u5728\u8d5b\u65f6\u90fd\u5199\u5b8c\u4e86\uff0c\u4f46\u662f\u5c31\u56e0\u4e3a\u91cd\u8f7d\u8fd0\u7b97\u7b26\u65f6\u5fd8\u8bb0\u52a0\u4e86\u4e2a\u53d6\u5740\u7b26\u4e00\u76f4\u7384\u5b66 RE\uff0c\u867d\u7136\u6539\u4e86\u8fd8\u662f\u6709\u4e2a\u5c0f\u5730\u65b9\u5199\u9519\u4e86\uff09\n\n## Code\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <cassert>\n#include <iostream>\n#include <queue>\n#include <vector>\n\n#define int long long\n\nusing namespace std;\n\nconst int kMaxN = 505;\n\n// \u77e9\u9635\u4e58\u6cd5 Begin\n\nstruct Matrix {\n  int n, m, a[kMaxN][kMaxN];\n\n  void inf() {\n    memset(a, 0xcf, sizeof(a));\n  }\n\n  void set(int _n, int _m) { n = _n, m = _m; }\n\n  void print() {\n    for (int i = 1; i <= n; ++i, cerr << '\\n') {\n      for (int j = 1; j <= m; ++j, cerr << ' ')\n        cerr << a[i][j];\n    }\n  }\n} M, S;\n\nMatrix operator *(const Matrix &a, const Matrix &b) {\n  assert(a.m == b.n);\n  // cerr << \"dfaksdflasd \" << a.n << ' ' << a.m << '\\n';\n  Matrix c;\n  c.set(a.n, b.m);\n  for (int i = 1; i <= c.n; ++i) {\n    for (int j = 1; j <= c.m; ++j) {\n      c.a[i][j] = -1e18;\n      for (int k = 1; k <= a.m; ++k) {\n        c.a[i][j] = max(c.a[i][j], a.a[i][k] + b.a[k][j]);\n      }\n    }\n  }\n  return c;\n}\n\nMatrix qpow(Matrix bs, int idx) {\n  // cerr  << \"kkksc03\\n\";\n  Matrix ret = bs;\n  --idx;\n  // cerr  << \"kkksc03\\n\";\n  for (; idx; idx >>= 1, bs = bs * bs) {\n    if (idx & 1)\n      ret = ret * bs;\n  }\n  return ret;\n}\n\n// \u77e9\u9635\u4e58\u6cd5 End\n\nint n, l;\nint a[kMaxN];\nstring s[kMaxN];\nvector<int> G[kMaxN];\n\n// AC\u81ea\u52a8\u673a Begin\n\nint tot, trie[kMaxN][26], fail[kMaxN], sum[kMaxN], g[kMaxN];\n\nvoid ins(string s, int idx) {\n  int cur = 0;\n  for (int i = 0; i < s.size(); ++i) {\n    int k = s[i] - 'a';\n    if (!trie[cur][k])\n      trie[cur][k] = ++tot;\n    cur = trie[cur][k];\n  }\n  sum[cur] += a[idx];\n}\n\nvoid getfail() {\n  queue<int> q;\n  for (int i = 0; i < 26; ++i) {\n    if (trie[0][i]) {\n      q.emplace(trie[0][i]);\n    }\n  }\n  while (!q.empty()) {\n    int u = q.front();\n    q.pop();\n    for (int i = 0; i < 26; ++i) {\n      if (trie[u][i]) {\n        fail[trie[u][i]] = trie[fail[u]][i];\n        q.emplace(trie[u][i]);\n      } else {\n        trie[u][i] = trie[fail[u]][i];\n      }\n    }\n  }\n}\n\nvoid dfs(int u) {\n  for (auto v : G[u]) {\n    g[v] = g[u] + sum[v];\n    dfs(v);\n  }\n}\n\nvoid getg() {\n  for (int i = 1; i <= tot; ++i)\n    G[fail[i]].emplace_back(i);\n  dfs(0);\n  for (int i = 1; i <= tot; ++i)\n    cerr << g[i] << ' ';\n  cerr << '\\n';\n}\n\n// AC\u81ea\u52a8\u673a End\n\nint getpos_f(int x) {\n  return x + 1;\n}\n\nint getpos_g(int x) {\n  return x + tot + 2;\n}\n\nvoid build_matrix() {\n  M.set(2 * tot + 2, 2 * tot + 2), S.set(1, 2 * tot + 2);\n  M.inf(), S.inf();\n  S.a[1][1] = 0;\n  for (int i = 0; i <= tot; ++i) {\n    int pos = getpos_g(i);\n    S.a[1][pos] = g[i];\n    // cerr << \"***\" << g[i] << '\\n';\n  }\n  for (int i = 0; i <= tot; ++i) {\n    auto pos_i = getpos_f(i);\n    for (int j = 0; j < 26; ++j) {\n      int k = trie[i][j];\n      auto pos_k = getpos_f(k);\n      M.a[pos_i][pos_k] = g[k];\n    }\n    int pp_i = getpos_g(i);\n    M.a[pp_i][pp_i] = 0;\n  }\n}\n\nvoid bf() {\n  int f[205][205];\n  memset(f, 0xcf, sizeof(f));\n  f[0][0] = 0;\n  for (int i = 0; i < l; ++i) {\n    for (int j = 0; j <= tot; ++j) {\n      for (int k = 0; k < 26; ++k)\n        f[i + 1][trie[j][k]] = max(f[i + 1][trie[j][k]], f[i][j] + g[trie[j][k]]);\n    }\n  }\n  int ans = 0;\n  for (int i = 0; i <= tot; ++i)\n    ans = max(ans, f[l][i]);\n  cout << ans << '\\n';\n}\n\nsigned main() {\n#ifdef ORZXKR\n  freopen(\"in.txt\", \"r\", stdin);\n  freopen(\"out.txt\", \"w\", stdout);\n#endif\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  cin >> n >> l;\n  for (int i = 1; i <= n; ++i) {\n    cin >> a[i];\n  }\n  for (int i = 1; i <= n; ++i) {\n    cin >> s[i];\n    ins(s[i], i);\n  }\n  getfail();\n  getg();\n  // bf();\n  build_matrix();\n  auto rr = qpow(M, l);\n  // cerr << rr.n << ' ' << rr.m << '\\n' << S.n << ' ' << S.m << '\\n';\n  Matrix res = S * rr;\n  // cerr << \"kkk\\n\";\n  int ans = 0;\n  for (int i = 1; i <= tot + 1; ++i)\n    ans = max(ans, res.a[1][i]);\n  cout << ans << '\\n';\n  return 0;\n}\n```",
        "postTime": 1673100777,
        "uid": 176843,
        "name": "Scarab",
        "ccfLevel": 0,
        "title": "CF696D Legen... \u9898\u89e3"
    },
    {
        "content": "\u9898\u76ee\u662f\u591a\u4e32\u5339\u914d\uff0c\u5f88\u5bb9\u6613\u60f3\u5230 $\\texttt{AC}$ \u81ea\u52a8\u673a\n\n\u90a3\u4e48\u6211\u4eec\u6bcf\u4e00\u6b21\u5230\u8fbe\u4e00\u4e2a\u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\u5728fail\u6811\u4e0a\u4ece\u6839\u8282\u70b9\u5230\u8fd9\u4e2a\u70b9\u4e0a\u70b9\u7684\u6743\u503c\u548c\uff0c\u8fd9\u4e2a\u5728\u6c42 $fail$ \u7684\u65f6\u5019\u53ef\u4ee5\u987a\u5e26\u7b97\u51fa\u6765\n\n\u73b0\u5728\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u5728 $\\texttt{AC}$ \u81ea\u52a8\u673a\u4e0a\u8df3 $l$ \u6b65\u53ef\u4ee5\u5f97\u5230\u7684\u6743\u503c\u6700\u5927\u503c\n\n\u8003\u8651\u8bbe\u4e00\u4e2a $\\texttt{dp}$ \u72b6\u6001\uff0c$f_{i,j}$ \u8868\u793a\u5df2\u7ecf\u8df3\u4e86 $i$ \u6b65\uff0c\u73b0\u5728\u5728\u4f4d\u7f6e $j$\u3002\u5f88\u5bb9\u6613\u5217\u51fa\u72b6\u6001\n\n$f_{i+1,go_{j,k}}=f_{i,j}+sum_{go_{j,k}}$\n\n\u5176\u4e2d $k$ \u662f\u65b0\u6dfb\u52a0\u7684\u5b57\u7b26\n\n\u7b54\u6848\u5c31\u662f\u6240\u6709 $f_{l,s}$ \u6c42\u548c\n\n\u56e0\u4e3a $l$ \u7684\u8303\u56f4\u6bd4\u8f83\u5927\uff0c\u8fd9\u6837\u80af\u5b9a\u4f1a\u8d85\u65f6\uff0c\u4f46\u662f\u53d1\u73b0\u8fd9\u4e2a\u72b6\u6001\u53ea\u6709\u53d6 $max$ \u548c\u6c42\u548c\uff0c\u4e8e\u662f\u53ef\u4ee5\u5e7f\u4e49\u77e9\u9635\u4e58\u6cd5\u52a0\u901f\uff0c\u6700\u540e\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(s^3\\log n)$\n\n\u4e0b\u9762\u662f\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nint go[205][26],fail[205],tot,n;\nll ed[205];\nvoid insert(char *s,int len,ll v){\n\tint now=0;\n\tfor(int i=1;i<=len;i++){\n\t\tif(!go[now][s[i]-'a'])go[now][s[i]-'a']=++tot;\n\t\tnow=go[now][s[i]-'a'];\n\t}\n\ted[now]+=v;\n}\nvoid get_fail(){\n\tqueue<int>q;\n\tfor(int i=0;i<26;i++){\n\t\tif(go[0][i])fail[go[0][i]]=0,q.push(go[0][i]);\n\t}\n\twhile(!q.empty()){\n\t\tint tp=q.front();\n\t\tq.pop();\n\t\ted[tp]+=ed[fail[tp]];\n\t\tfor(int i=0;i<26;i++){\n\t\t\tif(go[tp][i]){\n\t\t\t\tfail[go[tp][i]]=go[fail[tp]][i],q.push(go[tp][i]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tgo[tp][i]=go[fail[tp]][i];\n\t\t\t}\n\t\t}\n\t}\n}\nll val[205];\nll l;\nchar s[205];\nstruct matrix{\n\tll arr[205][205];\n\tvoid init(){\n\t\tmemset(arr,-0x3f,sizeof arr);\n\t}\n\tvoid init1(){\n\t\tmemset(arr,0,sizeof arr);\n\t}\n\tvoid print(){\n\t\tfor(int i=0;i<=tot;i++){\n\t\t\tfor(int j=0;j<=tot;j++)cout<<arr[i][j]<<' ';puts(\"\");\n\t\t}\n\t}\n};\nmatrix mul(matrix a,matrix b){\n\tmatrix c;\n\tc.init();\n\tfor(int k=0;k<=tot;k++)\n\t\tfor(int i=0;i<=tot;i++)\n\t\t\tfor(int j=0;j<=tot;j++){\n\t\t\t\tc.arr[i][j]=max(c.arr[i][j],a.arr[i][k]+b.arr[k][j]);\n\t\t\t}\n\treturn c;\n}\nmatrix ksm(matrix a,ll m){\n\tmatrix ans;\n\tans=a;\n\tm--;\n\twhile(m){\n\t\tif(m&1ll)ans=mul(ans,a);\n\t\ta=mul(a,a);\n\t\tm>>=1ll;\n\t}\n\treturn ans;\n}\nint main(){\n\tscanf(\"%d%lld\",&n,&l);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&val[i]);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%s\",s+1);\n\t\tinsert(s,strlen(s+1),val[i]);\n\t}\n\tget_fail();\n\tmatrix a,b;\n\ta.init();\n\tfor(int i=0;i<=tot;i++){\n\t\tfor(int j=0;j<26;j++)a.arr[i][go[i][j]]=ed[go[i][j]];\n\t}\n\tmatrix v=ksm(a,l);\n\tll ans=0;\n\tfor(int i=0;i<=tot;i++)ans=max(ans,v.arr[0][i]);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1672099984,
        "uid": 301817,
        "name": "QZJ666",
        "ccfLevel": 7,
        "title": "CF696D"
    },
    {
        "content": "## \u601d\u8def\n\n\u591a\u4e32\u5339\u914d\uff0c\u8003\u8651\u5efa\u51fa $\\texttt{AC}$ \u81ea\u52a8\u673a\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651 $\\texttt{dp}$\u3002\n\n\u5957\u8def\u5730\uff0c\u8bbe $f_{i,j}$ \u8868\u793a\u5df2\u7ecf\u586b\u4e86 $i$ \u4e2a\u5b57\u7b26\uff0c\u5f53\u524d\u5728 $\\texttt{AC}$ \u81ea\u52a8\u673a\u4e2d\u7684\u72b6\u6001 $j$\u3002\u90a3\u4e48\u65b0\u7684\u8d21\u732e\u662f\u53ef\u4ee5\u5339\u914d\u4e0a\u5f53\u524d\u540e\u7f00\u7684\u6a21\u5f0f\u4e32\u7684\u6743\u503c\u548c\u3002\n\n$\\texttt{AC}$ \u81ea\u52a8\u673a\u4e00\u4e2a\u7ed3\u70b9\u5230\u6839\u7ed3\u70b9\u7684\u8def\u5f84\u4e0a\u90fd\u662f\u8be5\u7ed3\u70b9\u7684\u540e\u7f00\uff0c\u6240\u4ee5\u5f53\u524d\u65b0\u589e\u7684\u8d21\u732e\u4e3a $ed_j$\u3002\u5176\u4e2d $ed_i$ \u8868\u793a $i$ \u5728 $\\texttt{fail}$ \u6811\u4e0a\u5230\u6839\u7ed3\u70b9\u7684\u8def\u5f84\u603b\u548c\u3002\n\n\u4e8e\u662f\u6709\u8f6c\u79fb\uff1a\n\n$$\nf_{i,j}+ed_{go_{j,k}}\\to f_{i+1,go_{j,k}}\n$$\n\n\u5176\u4e2d $k$ \u662f\u679a\u4e3e\u7684\u65b0\u6dfb\u52a0\u7684\u5b57\u7b26\u3002\n\n\u663e\u7136\u8fd9\u6837\u8f6c\u79fb\u4f1a\u8d85\u65f6\u3002\u53d1\u73b0\u6bcf\u6b21\u90fd\u662f\u4ece $i$ \u8f6c\u79fb\u5230 $i+1$\uff0c\u4e14\u7b2c\u4e8c\u7ef4\u8f6c\u79fb\u4e0e\u7b2c\u4e00\u7ef4\u65e0\u5173\uff0c\u53d6 $\\texttt{max}$ \u7684\u64cd\u4f5c\u4e5f\u662f\u6ee1\u8db3\u77e9\u9635\u4e58\u6cd5\u7684\uff0c\u6240\u4ee5\u8003\u8651\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <queue>\n#define ll long long\nusing namespace std;\nconst int N = 205, S = 26;\n\nll a[N];\nstring s;\n\nint idx, go[N][S], fa[N];\nll ed[N];\nvoid ins(string s, ll val) {\n\tint u = 0;\n\tfor (auto i : s) {\n\t\tint c = i - 'a';\n\t\tif (!go[u][c]) go[u][c] = ++idx;\n\t\tu = go[u][c];\n\t}\n\ted[u] += val;\n}\nvoid build() {\n\tqueue<int> q;\n\tfor (int i = 0; i < S; i++)\n\t\tif (go[0][i]) q.push(go[0][i]);\n\twhile (!q.empty()) {\n\t\tint u = q.front();\n\t\tq.pop();\n\t\ted[u] += ed[fa[u]];\n\t\tfor (int i = 0; i < S; i++) {\n\t\t\tif (go[u][i]) fa[go[u][i]] = go[fa[u]][i], q.push(go[u][i]);\n\t\t\telse go[u][i] = go[fa[u]][i];\n\t\t}\n\t}\n}\n\nstruct matrix {\n\tint n, m;\n\tll a[N][N];\n\t\n\tmatrix() {memset(a, -0x3f3f, sizeof(a));}\n} base, ans;\nmatrix operator * (matrix x, matrix y) {\n\tmatrix z;\n\tz.n = x.n;\n\tz.m = y.m;\n\tfor (int k = 0; k <= x.m; k++)\n\t\tfor (int i = 0; i <= x.n; i++)\n\t\t\tfor (int j = 0; j <= y.m; j++) z.a[i][j] = max(z.a[i][j], x.a[i][k] + y.a[k][j]);\n\treturn z;\n}\nmatrix quick_pow(matrix a, ll k) {\n\tmatrix res;\n\tres.n = res.m = a.n;\n\tfor (int i = 0; i <= a.n; i++) res.a[i][i] = 0;\n\twhile (k) {\n\t\tif (k & 1) res = res * a;\n\t\ta = a * a;\n\t\tk >>= 1;\n\t}\n\treturn res;\n}\nvoid init_base() {\n\tbase.n = base.m = idx;\n\tfor (int i = 0; i <= idx; i++)\n\t\tfor (int j = 0; j < S; j++) base.a[i][go[i][j]] = ed[go[i][j]];\n}\nvoid init_ans() {\n\tans.n = 0;\n\tans.m = idx;\n\tans.a[0][0] = 0;\n}\n\nint main() {\n\tint n;\n\tll L, mx = 0;\n\tscanf(\"%d %lld\", &n, &L);\n\tfor (int i = 1; i <= n; i++) scanf(\"%lld\", &a[i]);\n\tfor (int i = 1; i <= n; i++) cin >> s, ins(s, a[i]);\n\tbuild();\n\tinit_base();\n\tinit_ans();\n\tans = ans * quick_pow(base, L);\n\tfor (int i = 0; i <= idx; i++) mx = max(mx, ans.a[0][i]);\n\tprintf(\"%lld\", mx);\n\treturn 0;\n}\n```",
        "postTime": 1670918203,
        "uid": 365542,
        "name": "SDqwq",
        "ccfLevel": 7,
        "title": "CF696D Legen..."
    },
    {
        "content": "\u8003\u8651\u5efa\u51fa$AC$\u81ea\u52a8\u673a\uff0c\u4e0d\u96be\u60f3\u5230\u6734\u7d20\u7684$dp$\uff0c\u5b9a\u4e49$f[i][j]$\u8868\u793a\u8003\u8651\u524d$i$\u4e2a\u5b57\u7b26\uff0c\u5728$AC$\u81ea\u52a8\u673a\u4e0a$j$\u53f7\u70b9\u7684\u6700\u5927\u6743\u503c\n\n$f[i][j]=max_{k->j}f[i-1][k]+val[j]$\n\n\u53d1\u73b0\u8fd9\u4e2a\u53ef\u4ee5\u77e9\u4e58\u4f18\u5316\uff0c\u590d\u6742\u5ea6$n^3log(l)$\n\n```cpp\nconst int N=205;\nconst int S=26;\n\nll n,m,tot;\nchar a[N];\nll val[N],endpos[N];\nint ch[N][S],fail[N];\n\nstruct mat\n{\n    ll c[N][N];\n    mat(){memset(c,-LINF,sizeof(c));}\n    mat operator*(const mat &x)const\n    {\n        mat res;\n        for(int k=0;k<=tot;++k)\n            for(int i=0;i<=tot;++i)\n                for(int j=0;j<=tot;++j)\n                    res.c[i][j]=max(res.c[i][j],c[i][k]+x.c[k][j]);\n        return res;\n    }\n}base;\nvoid insert(char *s,ll z)\n{\n    int cur=0,len=strlen(s+1);\n    for(int i=1;i<=len;++i)\n    {\n        int c=s[i]-'a';\n        if(!ch[cur][c]) ch[cur][c]=++tot;\n        cur=ch[cur][c];\n    }\n    endpos[cur]+=z;\n}\nvoid build()\n{\n    queue<int>q;\n    for(int i=0;i<26;++i)\n    {\n        int v=ch[0][i];\n        if(v) q.push(v);\n    }\n    while(!q.empty())\n    {\n        int u=q.front();\n        q.pop();\n        endpos[u]+=endpos[fail[u]];\n        for(int i=0;i<26;++i)\n        {\n            int v=ch[u][i];\n            if(v) fail[v]=ch[fail[u]][i],q.push(v);\n            else ch[u][i]=ch[fail[u]][i];\n        }\n    }\n}\nvoid init()\n{\n    for(int i=0;i<=tot;++i)\n    {\n        for(int j=0;j<26;++j)\n        {\n            int cur=ch[i][j];\n            base.c[i][cur]=endpos[cur];\n        }\n    }\n}\nmat qpow(mat x,ll y)\n{\n    mat res;\n    for(int i=0;i<=tot;++i) res.c[i][i]=0;\n    while(y)\n    {\n        if(y&1) res=res*x;\n        x=x*x;\n        y>>=1;\n    }\n    return res;\n}\nint main()\n{\n    fio();\n    gi(n,m);\n    for(int i=1;i<=n;++i) gi(val[i]);\n    for(int i=1;i<=n;++i)\n    {\n        scanf(\"%s\",a+1);\n        insert(a,val[i]);\n    }\n    build();\n    init();\n    base=qpow(base,m);\n    ll ans=0;\n    for(int i=0;i<=tot;++i) ans=max(ans,base.c[0][i]);\n    print(ans);\n    end();\n}\n```",
        "postTime": 1583923134,
        "uid": 208081,
        "name": "MikukuOvO",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF696D \u3010Legen...\u3011"
    },
    {
        "content": "\u8fd9\u4e00\u9898\u660e\u663e\u662fAC\u81ea\u52a8\u673a\u4e0aDP\uff0c\u4e5f\u5f88\u5bb9\u6613\u60f3\u5230DP\u72b6\u6001\uff1adp[i][j]=\u8003\u8651\u5230\u6700\u7ec8\u5b57\u7b26\u4e32\u7684\u7b2ci\u4e2a\u4f4d\u7f6e\uff0c\u5728AC\u81ea\u52a8\u673a\u4e0a\u7684\u7b2cj\u4e2a\u70b9\u65f6\u7684\u6700\u5927\u7b54\u6848\u3002\n\n\u4e0d\u8fc7\uff0c\u5f88\u53ef\u60dc\uff0cl\u662f10\u768414\u6b21\u5e42\uff0c\u5f88\u660e\u663e\u4e0d\u80fd\u76f4\u63a5DP\u3002\n\n\u6240\u4ee5\u9700\u8981\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u3002\u7531\u4e8ej\u7ef4\u5ea6\u6700\u5927\u53ea\u6709200\uff0c\u6240\u4ee5\u662f\u53ef\u884c\u7684\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n``` cpp\n//\u5934\u6587\u4ef6\u7701\u7565\n#define LL long long\n#define pb push_back\n#define pob pop_back\n#define mp make_pair\n#define FILL(a,v) memset((void*)a,v,sizeof(a))\n#define FILL0(a) FILL(a,0)\n#define FILL1(a) FILL(a,-1)\n#define FILLBIG(a) FILL(a,0x3f)\n#define ALL(a) (a).begin(),(a).end()\n#define Inf ((int)0x3f3f3f3f)\n#define INF ((long long)0x3f3f3f3f3f3f3f3f)\n#define Mod 1000000007\n#define foreach(it,x) for(__typeof(x.begin()) it=x.begin();it!=x.end();it++)\n#define FOR(i,x) for(int i=0;i<x;i++)\n#define RFOR(i,x) for(int i=x-1;i>=0;i--)\n#define FFOR(i,a,b) for(int i=a;i<b;i++)\n#define FRFOR(i,a,b) for(int i=a-1;i>=b;i--)\n#define SZ(a) ((int)(a).size())\n#define FI first\n#define SE second\n#define OVER(...) return printf(__VA_ARGS__),0\n#define fastio ios::sync_with_stdio(0)\n#define filei(f) freopen(f,\"r\",stdin)\n#define fileo(f) freopen(f,\"w\",stdout)\n#define eprintf(...) fprintf(stderr,__VA_ARGS__)\n#define MASK(a) (1<<(a))\n#define MASKX(x,a) ((x)<<(a))\n#define BIT(a,b) (((a)>>(b))&1)\n#define cddx(a) priority_queue<a >\n#define cxdd(a) priority_queue<a,vector<a >,greater<a > >\n#define deval(a) {cerr<<#a<<\" = \"<<a<<endl;}\n#define dearr(be,en) {cerr<<#be;cerr<<\" = {\";for(auto i=be;i!=en;i++)cerr<<' '<<*i;cerr<<\" }\\n\";}\n#define reg register\n#define prtime eprintf(\"\\n\\nTime used: %dms\\n\",clock());\n#define PI 3.1415926535897932384626\n#define TODEG(a) (a*180/PI)\n#define endl '\\n'\nusing namespace std;\ntypedef pair<int,int> pii;\ntypedef unsigned long long UINT;\ntypedef unsigned int uint;\ntypedef long long INT;\ntypedef long double ldouble;\ntypedef pair<INT,INT> PII;\ntypedef stringstream sst;\ntypedef istringstream iss;\ntypedef vector<int> vint;\ntypedef vector<INT> VINT;\ntypedef vector<pii> vpii;\ntypedef vector<PII> VPII;\ntypedef priority_queue<int> pqi;\ntypedef priority_queue<INT> PQI;\ntypedef priority_queue<pii> pqp;\ntypedef priority_queue<PII> PQP;\ntypedef priority_queue<int,vint,greater<int> > xqi;\ntypedef priority_queue<INT,VINT,greater<INT> > XQI;\ntypedef priority_queue<pii,vpii,greater<pii> > xqp;\ntypedef priority_queue<PII,VPII,greater<PII> > XQP;\nstruct fastIO\n{\n\tinline fastIO operator>>(int& num)\n\t{\n\t\tnum=0;\n\t\tchar c=getchar();\n\t\twhile(c!='-'&&(c<'0'||c>'9'))c=getchar();\n\t\tbool foo=0;\n\t\tif(c=='-')\n\t\t{\n\t\t\tfoo=1;\n\t\t\tc=getchar();\n\t\t}\n\t\twhile(c>='0'&&c<='9')\n\t\t{\n\t\t\tnum=(num<<3)+(num<<1)+c-'0';\n\t\t\tc=getchar();\n\t\t}\n\t\tif(foo)num=-num;\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(INT& num)\n\t{\n\t\tnum=0;\n\t\tchar c=getchar();\n\t\twhile(c!='-'&&(c<'0'||c>'9'))c=getchar();\n\t\tbool foo=0;\n\t\tif(c=='-')\n\t\t{\n\t\t\tfoo=1;\n\t\t\tc=getchar();\n\t\t}\n\t\twhile(c>='0'&&c<='9')\n\t\t{\n\t\t\tnum=(num<<3)+(num<<1)+c-'0';\n\t\t\tc=getchar();\n\t\t}\n\t\tif(foo)num=-num;\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(float& num)\n\t{\n\t\tscanf(\"%f\",&num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(double& num)\n\t{\n\t\tscanf(\"%lf\",&num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(long double& num)\n\t{\n\t\tscanf(\"%Lf\",&num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(char& num)\n\t{\n\t\tnum=getchar();\n\t\twhile(num==' '||num=='\\n')num=getchar();\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(char* num)\n\t{\n\t\tint cnt=0;\n\t\tchar c=getchar();\n\t\twhile(c==' '||c=='\\n')c=getchar();\n\t\twhile(c!=' '&&c!='\\n')\n\t\t{\n\t\t\tnum[cnt++]=c;\n\t\t\tc=getchar();\n\t\t}\n\t\tnum[cnt]=0;\n\t\treturn *this;\n\t}\n\tinline fastIO operator>>(string& num)\n\t{\n\t\tcin>>num;\n\t\treturn *this;\n\t}\n\tinline void printInt(const int& num)\n\t{\n\t\tif(num<10)\n\t\t{\n\t\t\tputchar(num+'0');\n\t\t\treturn;\n\t\t}\n\t\tprintInt(num/10);\n\t\tputchar((num%10)+'0');\n\t}\n\tinline void printINT(const INT& num)\n\t{\n\t\tif(num<10)\n\t\t{\n\t\t\tputchar(num+'0');\n\t\t\treturn;\n\t\t}\n\t\tprintINT(num/10);\n\t\tputchar((num%10)+'0');\n\t}\n\tinline fastIO operator<<(const int& num)\n\t{\n\t\tif(num<0)putchar('-'),printInt(-num);\n\t\telse printInt(num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const INT& num)\n\t{\n\t\tif(num<0)putchar('-'),printINT(-num);\n\t\telse printINT(num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const float& num)\n\t{\n\t\tprintf(\"%.10f\",num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const double& num)\n\t{\n\t\tprintf(\"%.16lf\",num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const long double& num)\n\t{\n\t\tprintf(\"%.20Lf\",num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const char& num)\n\t{\n\t\tputchar(num);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const char* num)\n\t{\n\t\tfor(int i=0;num[i];i++)\n\t\t\tputchar(num[i]);\n\t\treturn *this;\n\t}\n\tinline fastIO operator<<(const string& num)\n\t{\n\t\tcout<<num;\n\t\treturn *this;\n\t}\n}fio;\n\nint nei[205][26];\nint fail[205];\nstring s[205];\nint to[205];\nint cnt=1;\n\nvoid add(const string& S){\n\tint now=0;\n\tstring cur=\"\";\n\tfor(int i=0;i<SZ(S);i++){\n\t\tif(!nei[now][S[i]-'a']){\n\t\t\tnei[now][S[i]-'a']=cnt++;\n\t\t}\n\t\tnow=nei[now][S[i]-'a'];\n\t\tcur+=S[i];\n\t\ts[now]=cur;\n\t}\n}\n\nvoid build(){\n\tfail[0]=0;\n\tqueue<int> q;\n\tfor(int i=0;i<26;i++){\n\t\tif(nei[0][i]){\n\t\t\tq.push(nei[0][i]);\n\t\t}\n\t}\n\twhile(SZ(q)){\n\t\tint x=q.front();\n\t\tq.pop();\n\t\tfor(int i=0;i<26;i++){\n\t\t\tif(nei[x][i]){\n\t\t\t\tq.push(nei[x][i]);\n\t\t\t\tfail[nei[x][i]]=nei[fail[x]][i];\n\t\t\t}else{\n\t\t\t\tnei[x][i]=nei[fail[x]][i];\n\t\t\t}\n\t\t}\n\t}\n}\n\nINT pw[60][205][205],ans[205][205],c[205][205],bg[205][205];\nvoid times(INT a[][205],INT b[][205]){\n\tfor(int i=0;i<cnt;i++){\n\t\tfor(int j=0;j<cnt;j++){\n\t\t\tc[i][j]=-INF;\n\t\t}\n\t}\n\tfor(int i=0;i<cnt;i++){\n\t\tfor(int j=0;j<cnt;j++){\n\t\t\tfor(int k=0;k<cnt;k++){\n\t\t\t\tif(a[i][k]>=0){\n\t\t\t\t\tc[i][j]=max(c[i][j],a[i][k]+b[k][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nint n;\nINT m;\nint ass[205];\nstring ss[205];\n\nint main(){\n\tfio>>n>>m;\n\tfor(int i=0;i<n;i++){\n\t\tfio>>ass[i];\n\t}\n\tfor(int i=0;i<n;i++){\n\t\tfio>>ss[i];\n\t\tadd(ss[i]);\n\t}\n\tbuild();//\u6784\u5efaAC\u81ea\u52a8\u673a\n\tfor(int i=0;i<cnt;i++){\n\t\tfor(int j=0;j<n;j++){\n\t\t\tif(SZ(s[i])>=SZ(ss[j])&&s[i].substr(SZ(s[i])-SZ(ss[j]))==ss[j]){\n\t\t\t\tto[i]+=ass[j];\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=0;i<cnt;i++){\n\t\tfor(int j=0;j<cnt;j++){\n\t\t\tbg[i][j]=ans[i][j]=-INF;\n\t\t\tfor(int k=0;k<26;k++){\n\t\t\t\tif(nei[i][k]==j){\n\t\t\t\t\tbg[i][j]=to[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tans[0][0]=0;\n\tmemcpy(pw[0],bg,sizeof(bg));\n\tfor(int i=1;i<60;i++){\n\t\ttimes(pw[i-1],pw[i-1]);\n\t\tmemcpy(pw[i],c,sizeof(c));\n\t}\n\tfor(int i=0;i<60;i++){\n\t\tif(BIT(m,i)){\n\t\t\ttimes(ans,pw[i]);//\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97\u7b54\u6848\n\t\t\tmemcpy(ans,c,sizeof(c));\n\t\t}\n\t}\n\tINT Ans=0;\n\tfor(int i=0;i<cnt;i++){\n\t\tAns=max(Ans,ans[0][i]);\n\t}\n\tfio<<Ans<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1550364933,
        "uid": 60845,
        "name": "Acetyl",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF696D \u3010Legen...\u3011"
    }
]