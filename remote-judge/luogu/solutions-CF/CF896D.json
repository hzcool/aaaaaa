[
    {
        "content": "## \u795e\u5947\u7684\u73c2\u5b66\u7ec4\u5408\u9898\u2014\u2014Nephren Runs a Cinema\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/CF896D)\n\n### \u9898\u610f\n\n\u5bf9\u4e00\u4e2a\u5b57\u7b26\u4e32 $S$\uff0c\u5b9a\u4e49 $f(S)$ \u8868\u793a $S$ \u4e2d\u542b\u6709\u7684\u5de6\u62ec\u53f7\u6570\u4e0e\u53f3\u62ec\u53f7\u6570\u4e4b\u5dee\uff08\u65b9\u4fbf\u8d77\u89c1\uff0c\u4ee5\u4e0b\u4f7f\u7528\u5c16\u62ec\u53f7 $\\mathtt{<}$ \u548c $\\mathtt{>}$\uff09\u3002\u5982 $f(\\mathtt{<>})=0,f(\\mathtt{<>>})=-1,f(\\mathtt{<oo})=1,f(\\mathtt{o})=0$\u3002\n\n\u5b9a\u4e49\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u5b57\u7b26\u4e32 $S$ \u4e3a\u201c\u5408\u6cd5\u5b57\u7b26\u4e32\u201d\uff1a\n\n- $S$ \u53ea\u7531\u5de6\u62ec\u53f7 $\\mathtt{<}$\u3001\u53f3\u62ec\u53f7 $\\mathtt{>}$ \u548c\u5b57\u7b26 $\\mathtt{o}$ \u7ec4\u6210\uff08\u4f46\u4e09\u79cd\u5b57\u7b26\u4e0d\u4e00\u5b9a\u90fd\u8981\u51fa\u73b0\uff09\u3002\n- \u5bf9 $S$ \u7684\u4efb\u610f\u524d\u7f00 $T$\uff08\u5305\u62ec $S$ \u672c\u8eab\uff09\uff0c\u90fd\u6ee1\u8db3 $f(T)\\ge 0$\uff0c\u5373 $T$ \u4e2d\u5de6\u62ec\u53f7\u6570\u4e0d\u591a\u4e8e\u53f3\u62ec\u53f7\u6570\u3002\n\n\u6c42\u957f\u5ea6\u4e3a $n$ \u4e14 $f(S)\\in [l,r]$ \u7684\u5408\u6cd5\u5b57\u7b26\u4e32 $S$ \u7684\u4e2a\u6570\u6a21 $p$ \u7684\u503c\u3002\n\n$1\\le n\\le 10^5,\\ 0\\le l\\le r\\le n,\\ 1\\le p\\le 2\\times 10^9$\uff0c\u4e0d\u4fdd\u8bc1 $p$ \u662f\u8d28\u6570\u3002\n\n\u8fd9\u4e2a\u9898\u610f\u7ffb\u8bd1\u4e2d\u7684\u201c\u5de6\u62ec\u53f7\u201d\u5bf9\u5e94\u539f\u9898\u4e2d\u643a\u5e26 100 \u5143\u949e\u7968\u7684\u987e\u5ba2\uff0c\u201c\u53f3\u62ec\u53f7\u201d\u5bf9\u5e94\u643a\u5e26 50 \u5143\u949e\u7968\u7684\u987e\u5ba2\uff0c\u201c$\\mathtt{o}$\u201d\u5bf9\u5e94 VIP \u987e\u5ba2\uff0c$f(S)$ \u5bf9\u5e94\u7535\u5f71\u9662\u5269\u4e0b\u7684 50 \u5143\u949e\u7968\u7684\u6570\u76ee\u3002 \n\n### \u89e3\u6cd5\n\n\uff08\u63d0\u793a\uff1a\u5982\u679c\u770b\u4e0d\u6e05\u516c\u5f0f\uff0c\u5c1d\u8bd5\u653e\u5927\u9875\u9762\uff09\n\n#### \u5217\u51fa\u5f0f\u5b50\n\n$S$ \u4e2d\u6709\u4e09\u79cd\u5b57\u7b26\uff0c\u592a\u590d\u6742\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u8fdb\u884c\u4e00\u4e2a\u8f6c\u5316\u3002\u56e0\u4e3a\u5b57\u7b26 $\\mathtt{o}$ \u5bf9\u5176\u4ed6\u5f71\u54cd\u4e0d\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u4ece $n$ \u4e2a\u4f4d\u7f6e\u4e2d\u9009\u51fa\u82e5\u5e72\u4e2a\u653e\u5b57\u7b26 $\\mathtt{o}$\uff0c\u5269\u4e0b\u7684\u4f4d\u7f6e\u4f9d\u6b21\u653e\u62ec\u53f7\u3002\u8bbe\u62ec\u53f7\u5171\u6709 $i$ \u4e2a\uff0c\u90a3\u4e48\u653e\u7f6e\u5b57\u7b26 $\\mathrm{o}$ \u7684\u65b9\u6cd5\u5c31\u6709 $\\mathrm{C}^i_n$ \u79cd\u3002\u7ecf\u8fc7\u8fd9\u4e00\u5904\u7406\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u7ba1\u5b57\u7b26 $\\mathrm{o}$ \u4e86\u3002\n\n\u73b0\u5728\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\u53d8\u6210\uff0c\u6c42\u957f\u4e3a $i\\ (0\\le i\\le n)$ \u7684**\u5408\u6cd5**\u7684\u62ec\u53f7\u4e32\uff08\u53ea\u542b\u62ec\u53f7\uff09$S$ \u4e2d\uff0c$f(S)\\in [l,r]$ \u7684\u6709\u591a\u5c11\u79cd\u3002\n\n\u9996\u5148\u60f3\u60f3\u6211\u4eec\u53ef\u4ee5\u600e\u4e48\u8ba1\u7b97 $f$\u3002\u7814\u7a76\u5b9a\u4e49\uff0c\u6211\u4eec\u53d1\u73b0\uff0c$f(S\\mathtt{<})=f(S)+1$\uff0c$f(S\\mathtt{>})=f(S)-1$\uff0c\u5f53\u7136\u7b2c\u4e8c\u4e2a\u8f6c\u5316\u53ea\u6709\u5f53 $f(S)>0$ \u65f6 $S\\mathtt{>}$ \u624d\u662f\u5408\u6cd5\u7684\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u8fd9\u6837\u4e00\u4e2a dp\uff1a\u8bbe $g[i][j]$ \u8868\u793a\u957f\u5ea6\u4e3a $i$ \u7684\u5b57\u7b26\u4e32\u4e2d\uff0c$f(S)=j$ \u7684\u6709\u591a\u5c11\u4e2a\uff0c\u8fd9\u91cc $j\\ge 0$\u3002\u6839\u636e $f$ \u7684\u8ba1\u7b97\u65b9\u6cd5\uff0c\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b $g[i][j]=g[i-1][j-1]+g[i-1][j+1]$\uff0c\u5176\u4e2d\u7684\u7b2c\u4e00\u9879\u53ea\u6709 $j\\ge 1$ \u65f6\u624d\u52a0\u5165\u3002\n\n\u8fd9\u4e2a\u65b9\u7a0b\u662f $\\mathrm{O}(n^2)$ \u7684\uff0c\u5e76\u4e0d\u6ee1\u8db3\u6211\u4eec\u7684\u8981\u6c42\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u80fd\u8981\u8f6c\u53d8\u601d\u8def\uff0c\u6362\u4e00\u79cd\u65b9\u6cd5\u89e3\u9898\u3002\n\n\u5173\u4e8e\u201c\u62ec\u53f7\u201d\uff0c\u4f60\u60f3\u5230\u4e86\u4ec0\u4e48\u5462\uff1f\u5982\u679c\u60f3\u5230\u201c\u5361\u7279\u5170\u6570\u201d\uff0c\u90a3\u4e48\u4f60\u79bb AC \u5c31\u66f4\u8fd1\u4e86\u4e00\u6b65\u3002\u5361\u7279\u5170\u6570 $C_n$ \u8868\u793a\u7684\u662f\u201c\u957f\u4e3a $n$ \u7684**\u5408\u6cd5**\u7684\u62ec\u53f7\u4e32 $S$ \u4e2d\uff0c$f(S)=0$ \u7684\u6709\u591a\u5c11\u4e2a\u201d\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\u5462\uff1f\n\n~~\u63a8\u5012\u5361\u7279\u5170\u6570\u5a18~~ \u63a8\u5bfc\u5361\u7279\u5170\u6570\u7684\u901a\u9879\u516c\u5f0f\u65f6\uff0c\u6211\u4eec\u770b\u5230\u4e86\u8fd9\u6837\u4e00\u79cd\u56fe\u5f62\u89e3\u6cd5\uff1a\u8bbe\u6a2a\u5750\u6807 $x$ \u8868\u793a\u5f53\u524d\u524d\u7f00 $T$ \u4e2d\u5de6\u62ec\u53f7\u7684\u4e2a\u6570\uff0c\u7eb5\u5750\u6807 $y$ \u8868\u793a\u5f53\u524d\u524d\u7f00 $T$ \u4e2d\u53f3\u62ec\u53f7\u7684\u4e2a\u6570\uff0c\u90a3\u4e48\u5f53\u524d\u524d\u7f00\u5bf9\u5e94\u7684\u5750\u6807\u70b9\u5c31\u662f $(x,y)$\u3002\u6839\u636e\u5b9a\u4e49\uff0c$f(T)=x-y$\uff0c\u56e0\u4e3a\u8981\u6c42 $f(T)\\ge 0$\uff0c\u56e0\u6b64 $x\\ge y$\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e9b\u5750\u6807\u70b9\u4e0d\u80fd\u5230\u8fbe\u76f4\u7ebf $y=x$ \u7684\u4e0a\u65b9\u3002\n\n\u4e0b\u56fe\u4e2d\u7684\u8def\u5f84 $AGHIJKLMNOPQB$ \u8868\u793a\u7684\u662f $\\mathtt{<<><>><<>><>}$\uff0c\u8fd9\u662f\u4e00\u4e2a\u5408\u6cd5\u62ec\u53f7\u5b57\u7b26\u4e32\uff0c\u4e14\u5de6\u62ec\u53f7\u548c\u53f3\u62ec\u53f7\u5404\u6709 $6$ \u4e2a\u3002\n\n![\u5361\u7279\u5170\u6570\u56de\u987e](https://cdn.luogu.com.cn/upload/image_hosting/7nuyhwwq.png)\n\n\u90a3\u6211\u4eec\u80fd\u4e0d\u80fd\u7528\u8fd9\u79cd\u65b9\u6cd5\u8868\u793a\u672c\u9898\u4e2d\u7684\u5408\u6cd5\u62ec\u53f7\u5b57\u7b26\u4e32\u5462\uff1f\u5f53\u7136\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u5982\u679c\u6211\u4eec\u7684\u5408\u6cd5\u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a $i$\uff0c$f(S)$ \u4e3a $j$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5bf9\u5e94\u7684\u8def\u5f84\u8d77\u70b9\u5c31\u662f $(0,0)$\uff0c\u7ec8\u70b9\u662f $\\left(\\cfrac{i+j}{2},\\cfrac{i-j}{2}\\right)$\uff08\u6ce8\u610f\u6a2a\u5750\u6807\u8868\u793a\u5de6\u62ec\u53f7\u4e2a\u6570\uff0c\u7eb5\u5750\u6807\u8868\u793a\u53f3\u62ec\u53f7\u4e2a\u6570\uff09\uff0c\u6bcf\u6b21\u53ea\u5f80\u53f3\uff08\u8868\u793a\u52a0\u4e00\u4e2a\u5de6\u62ec\u53f7\uff09\u6216\u5f80\u4e0a\uff08\u8868\u793a\u52a0\u4e00\u4e2a\u53f3\u62ec\u53f7\uff09\u8d70\u4e00\u4e2a\u5355\u4f4d\uff0c\u5e76\u4e14\u59cb\u7ec8\u4e0d\u5230\u8fbe\u76f4\u7ebf $y=x$ \u7684\u4e0a\u65b9\uff08\u4e5f\u53ef\u4ee5\u8bf4\uff0c\u59cb\u7ec8\u4e0d\u89e6\u53ca\u76f4\u7ebf $y=x+1$\uff09\u3002\u8fd9\u6837\u7684\u8def\u5f84\u548c\u672c\u9898\u4e2d\u7684\u5408\u6cd5\u5b57\u7b26\u4e32\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002\n\n\u4f8b\u5982\uff0c\u4e0b\u56fe\u4e2d\u7684\u8def\u5f84 $AGHIJKLMNOP$ \u8868\u793a\u7684\u662f $\\mathtt{<><<>><<><}$\uff0c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u4e3a $6+4=10$\uff0c\u5176\u4e2d\u6709 $6$ \u4e2a\u53f3\u62ec\u53f7\u548c $4$ \u4e2a\u5de6\u62ec\u53f7\u3002\n\n![\u7528\u56fe\u8868\u793a\u5408\u6cd5\u5b57\u7b26\u4e32](https://cdn.luogu.com.cn/upload/image_hosting/sm404867.png)\n\n\u6839\u636e\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb\uff0c\u53ea\u8981\u6211\u4eec\u8ba1\u7b97\u51fa\u4e86\u5408\u6cd5\u7684\u8def\u5f84\u7684\u6761\u6570\uff0c\u4e5f\u5c31\u5f97\u5230\u4e86\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u6570\u3002\n\n\u90a3\u4e48\u5982\u4f55\u8ba1\u7b97\u5408\u6cd5\u8def\u5f84\u6761\u6570\u5462\uff1f\u4e3a\u65b9\u4fbf\u8d77\u89c1\uff0c\u4e0b\u9762\u4ee4 $q$ \u8868\u793a $\\cfrac{i+j}{2}$\uff0c$r$ \u8868\u793a $\\cfrac{i-j}{2}$\uff0c\u90a3\u4e48\u6211\u4eec\u60f3\u8981\u8ba1\u7b97\u7684\u8def\u5f84\u7684\u7ec8\u70b9\u5c31\u662f $(q,r)$\u3002\n\n\u5982\u679c\u53ea\u9700\u8981\u8ba1\u6570\u4ece $(0,0)$ \u5230 $(q,r)$ \u7684\uff08\u6700\u77ed\uff09\u8def\u5f84\u6761\u6570\uff0c\u8fd9\u5e76\u4e0d\u592a\u96be\uff0c\u53ea\u9700 $\\mathrm{C}_{q+r}^q$ \u5373\u53ef\u3002\u4f46\u5408\u6cd5\u8def\u5f84\u591a\u4e86\u4e00\u4e2a\u6761\u4ef6\u2014\u2014\u4e0d\u80fd\u89e6\u53ca\u76f4\u7ebf $y=x+1$\uff0c\u8fd9\u8be5\u600e\u4e48\u529e\u5462\uff1f\n\n\u6211\u4eec\u7528\u8fd9\u6837\u7684\u601d\u8def\uff0c\u7528\u603b\u8def\u5f84\u6761\u6570 $\\mathrm{C}_{q+r}^q$ \u51cf\u53bb\u4e0d\u5408\u6cd5\uff08\u89e6\u53ca\u76f4\u7ebf $y=x+1$\uff09\u7684\u8def\u5f84\u6761\u6570\uff0c\u5c31\u80fd\u5f97\u5230\u5408\u6cd5\u7684\u8def\u5f84\u6761\u6570\u3002\n\n\u73b0\u5728\u6211\u4eec\u8981\u8ba1\u7b97\u4e0d\u5408\u6cd5\u7684\u8def\u5f84\u6761\u6570\uff0c\u8fd9\u65f6\u6211\u4eec\u8981\u7528\u63a8\u5361\u7279\u5170\u6570\u901a\u9879\u65f6\u7684\u7ecf\u5178\u65b9\u6cd5\u2014\u2014\u5bf9\u79f0\u3002\u4f5c\u7ec8\u70b9 $T(q,r)$ \u5173\u4e8e\u76f4\u7ebf $l: y=x+1$ \u7684\u5bf9\u79f0\u70b9 $T'(r-1,q+1)$\uff0c\u90a3\u4e48\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u5982\u679c\u628a\u4e00\u6761\u4e0d\u5408\u6cd5\u8def\u5f84**\u7b2c\u4e00\u6b21\u89e6\u53ca\u76f4\u7ebf $l$ \u4e4b\u540e\u7684\u90e8\u5206**\u5173\u4e8e $l$ \u4f5c\u5bf9\u79f0\uff0c\u90a3\u4e48\u8fd9\u6761\u8def\u5f84\u6700\u7ec8\u5c06\u4f1a\u5230\u8fbe $T\u2019$ \u70b9\uff08\u4e0b\u9762\u4f1a\u8bf4\u660e\u4e3a\u4ec0\u4e48\uff09\u3002\n\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c$l$ \u5728\u4e0b\u56fe\u4e2d\u88ab\u6807\u4e3a\u7ea2\u8272\uff08\u201c\u7ea2\u7ebf\u201d\uff09\u3002\u56fe\u4e2d\u8fd9\u6761\u4e0d\u5408\u6cd5\u8def\u5f84\u7684\u7ec8\u70b9\u662f $P(6,4)$\uff0c\u800c\u5bf9\u79f0\u540e\u7684\u8def\u5f84\u7ec8\u70b9\u662f $P'(4-1,6+1)=P'(3,7)$\u3002\n\n![\u5c06\u4e0d\u5408\u6cd5\u8def\u5f84\u5bf9\u79f0](https://cdn.luogu.com.cn/upload/image_hosting/dol9geig.png)\n\n\u6211\u4eec\u4e0b\u9762\u8981\u8bf4\u660e\uff0c\u4ece $(0,0)$ \u5230 $(q,r)$ \u7684**\u4e0d\u5408\u6cd5\u8def\u5f84**\u4e0e\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684**\u8def\u5f84**\u4e00\u4e00\u5bf9\u5e94\u3002\n\n\u9996\u5148\u8bf4\u660e\uff0c\u6839\u636e\u4efb\u610f\u4e00\u6761\u4ece $(0,0)$ \u5230 $(q,r)$ \u7684\u4e0d\u5408\u6cd5\u8def\u5f84\uff0c\u90fd\u6070\u80fd\u6784\u9020\u4e00\u6761\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684\u8def\u5f84\u3002\u4efb\u610f\u4e00\u6761\u4e0d\u5408\u6cd5\u8def\u5f84\u90fd\u4e00\u5b9a\u4f1a\u89e6\u53ca\u5230\u76f4\u7ebf $l:y=x+1$\uff0c\u627e\u5230\u7b2c\u4e00\u6b21\u89e6\u53ca\u7684\u4f4d\u7f6e\uff08\u8bbe\u4e3a $(t,t+1)$\uff09\uff0c\u90a3\u4e48\u539f\u8def\u5f84\u5728\u6b64\u540e\u8fd8\u8981\u5411\u53f3\u8d70 $q-t$ \u6b65\uff0c\u5411\u4e0a\u8d70 $r-t-1$ \u6b65\uff0c\u4e5f\u5c31\u662f\u4eca\u540e\u7684\u603b\u4f4d\u79fb\u662f $(q-t,r-t-1)$\u3002\u73b0\u5728\u5c06\u539f\u8def\u5f84\u5bf9\u79f0\uff0c\u4e5f\u5c31\u662f\u539f\u5148\u5411\u53f3\u7684\u6b65\u6539\u6210\u5411\u4e0a\uff0c\u539f\u5148\u5411\u4e0a\u7684\u6539\u6210\u5411\u53f3\uff0c\u90a3\u4e48\u65b0\u8def\u5f84\u6b64\u540e\u7684\u4f4d\u79fb\u5c31\u5c06\u662f $(r-t-1,q-t)$\uff0c\u4e8e\u662f\u7ec8\u70b9\u5c31\u662f $(t+r-t-1,t+1+q-t)$\uff0c\u5373\u4e3a $(r-1,q+1)$\u3002\u800c\u4e14\u4e24\u6761\u4e0d\u540c\u7684\u4e0d\u5408\u6cd5\u8def\u5f84\uff0c\u6240\u5bf9\u79f0\u51fa\u6765\u7684\u8def\u5f84\u4e5f\u662f\u4e0d\u540c\u7684\u3002\n\n\u518d\u8bf4\u660e\uff0c\u6839\u636e\u4efb\u610f\u4e00\u6761\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684\u8def\u5f84\uff0c\u90fd\u6070\u80fd\uff08\u9006\u5411\uff09\u6784\u9020\u4e00\u6761\u4ece $(0,0)$ \u5230 $(q,r)$ \u7684\u4e0d\u5408\u6cd5\u8def\u5f84\u3002\u7531\u4e8e $(r-1,q+1)$ \u5728 $y=x+1$ \u7684\u4e0a\u65b9\uff08\u8bc1\u660e\u4ece\u7565\uff0c\u53ef\u770b\u56fe\uff09\uff0c\u5e76\u4e14\u8d77\u70b9 $(0,0)$ \u5728 $l$ \u7684\u4e0b\u65b9\uff0c\u56e0\u6b64\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684\u8def\u5f84\u4e00\u5b9a\u4f1a\u8de8\u8d8a\u76f4\u7ebf $l$\u3002\u53d6\u8def\u5f84\u4e0e $l$ \u7684\u4ea4\u70b9\uff0c\u5728\u4ea4\u70b9\u540e\u50cf\u4e0a\u9762\u4e00\u6837\u4f5c\u5bf9\u79f0\uff0c\u4eff\u7167\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u5bf9\u79f0\u540e\u8def\u5f84\u4f1a\u5230\u8fbe $(q,r)$\u3002\u7531\u4e8e\u89e6\u53ca\u4e86\u76f4\u7ebf $l$\uff0c\u56e0\u6b64\u8fd9\u6837\u6784\u9020\u51fa\u6765\u7684\u8def\u5f84\u662f\u4e0d\u5408\u6cd5\u7684\u3002\u4e24\u6761\u4e0d\u540c\u7684\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684\u8def\u5f84\uff0c\u6240\u5bf9\u79f0\u51fa\u6765\u7684\u4e0d\u5408\u6cd5\u8def\u5f84\u4e5f\u662f\u4e0d\u540c\u7684\u3002\n\n\u7efc\u4e0a\uff0c\u4ece $(0,0)$ \u5230 $(q,r)$ \u7684\u4e0d\u5408\u6cd5\u8def\u5f84\u4e0e\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684\u8def\u5f84\u4e00\u4e00\u5bf9\u5e94\uff1b\u56e0\u6b64\uff0c\u4ece $(0,0)$ \u5230 $(q,r)$ \u7684\u4e0d\u5408\u6cd5\u8def\u5f84\u6570\u5c31\u7b49\u4e8e\u4ece $(0,0)$ \u5230 $(r-1,q+1)$ \u7684\u8def\u5f84\uff0c\u4e5f\u5c31\u662f $\\mathrm{C}^{q+1}_{r-1+q+1}=\\mathrm{C}_{q+r}^{q+1}$\u3002\n\n\u7efc\u5408\u524d\u9762\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u5f97\u51fa\uff0c\u957f\u5ea6\u4e3a $i$\uff0c$f(S)$ \u4e3a $j$ \u7684\u5408\u6cd5\u5b57\u7b26\u4e32 $S$ \u7684\u4e2a\u6570\u662f $\\mathrm{C}_{q+r}^{q}-\\mathrm{C}_{q+r}^{q+1}=\\mathrm{C}_{i}^{\\frac{i+j}{2}}-\\mathrm{C}_{i}^{\\frac{i+j+2}{2}}$\u3002\n\n#### \u5316\u7b80\u5f0f\u5b50\n\n\u5f97\u51fa\u4e86\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\u7684\u4e5f\u5c31\u662f\n$$\n\\sum_{i=0}^{n}\\mathrm{C}_{n}^{i}\\left(\\sum_{j=l}^{r}\\mathrm{C}_{i}^{\\frac{i+j}{2}}-\\mathrm{C}^{\\frac{i+j+2}{2}}_i\\right)\n$$\n\u6ce8\u610f\uff0c\u4e3a\u4e86\u5199\u5f0f\u5b50\u548c\u8ba1\u7b97\u65b9\u4fbf\uff0c\u5f53 $r>n$ \u65f6\uff0c\u6211\u4eec\u5b9a\u4e49 $\\mathrm{C}_{n}^r=0$\u3002\u53e6\u5916\uff0c\u5982\u679c\u4f60\u60f3\u4e0d\u8d77\u6765 $\\mathrm{C}_n^i$ \u662f\u4ec0\u4e48\uff0c\u56de\u5fc6\u6211\u4eec\u5bf9 $\\mathtt{o}$ \u5b57\u7b26\u7684\u5904\u7406\u8fc7\u7a0b\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u76f4\u63a5\u8ba1\u7b97\u662f $\\mathrm{O}(n^2)$ \u7684\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u5316\u7b80\u5462\uff1f\n\n\u9996\u5148\u641e\u6e05\u695a\u4e00\u4e2a\u95ee\u9898\uff1a\u4e0a\u5f0f\u7684\u7ec4\u5408\u6570\u4e2d\u51fa\u73b0\u4e86 $\\frac{i+j}{2}$ \u8fd9\u6837\u7684\u90e8\u5206\uff0c\u90a3\u4e07\u4e00\u8fd9\u662f\u4e2a\u5206\u6570\u5462\uff1f\u8054\u7cfb\u95ee\u9898\u7684\u610f\u4e49\uff0c$i$ \u662f\u62ec\u53f7\u603b\u6570\uff0c$j$ \u662f\u5de6\u62ec\u53f7\u4e0e\u53f3\u62ec\u53f7\u6570\u4e4b\u5dee\uff0c\u800c $\\frac{i+j}{2}$ \u8868\u793a\u4e86\u5de6\u62ec\u53f7\u7684\u6570\u91cf\uff0c\u5fc5\u987b\u8981\u662f\u6574\u6570\u3002\u56e0\u6b64\u4e0a\u5f0f\u8fd8\u6709\u4e00\u4e2a\u9690\u542b\u6761\u4ef6\uff0c\u5373 $i,j$ \u7684\u5947\u5076\u6027\u76f8\u540c\u3002\n\n\u63a5\u4e0b\u6765\u53ef\u4ee5\u4e0a\u624b\u5316\u7b80\u4e86\u3002\u5148\u522b\u6025\u7740\u628a\u7ec4\u5408\u6570\u6309\u5b9a\u4e49\u5c55\u5f00\uff0c\u5982\u679c\u641e\u61c2\u4e86\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u4e0a\u5f0f\u4e2d\u5927\u5706\u62ec\u53f7\u5305\u88f9\u7684\u6c42\u548c\u53f7\u53ef\u4ee5\u76f4\u63a5\u5316\u7b80\uff01\u4e3a\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u6ce8\u610f\u5230 $\\mathrm{C}_i^{\\frac{i+j}{2}}$ \u548c $\\mathrm{C}_i^{\\frac{i+j+2}{2}}$ \u6709\u5bc6\u5207\u7684\u5173\u7cfb\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8ba8\u8bba\uff0c\u6211\u4eec\u4ee4 $b_{j} =\\mathrm{C}_{i}^{\\frac{i+j}{2}}$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6c42\u548c\u53ef\u4ee5\u8868\u793a\u4e3a $\\sum_{j=l}^{r}b_j-b_{j+2}$\u3002\u5982\u679c\u8fd8\u6ca1\u6709\u770b\u51fa\u6765\uff0c\u628a\u5b83\u5c55\u5f00\uff0c\u6ce8\u610f $i,j$ \u7684\u5947\u5076\u6027\u76f8\u540c\u3002\u8bbe\u7b2c\u4e00\u4e2a\u4f7f\u5f0f\u5b50\u6709\u610f\u4e49\u7684 $j$ \u662f $j_0$\uff0c\u6700\u540e\u4e00\u4e2a\u4f7f\u5f0f\u5b50\u6709\u610f\u4e49\u7684 $j$ \u662f $j_1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6c42\u548c\u5f0f\u5c31\u662f $b_{j_0}-b_{j_0+2}+b_{j_0+2}-b_{j_0+4}+\\cdots + b_{j_{1}}-b_{j_{1}+2}$\u3002\u4ed4\u7ec6\u770b\uff0c\u76f8\u90bb\u9879\u6d88\u6389\u4e86\uff0c\u53ea\u5269\u4e0b $b_{j_0}-b_{j_1+2}$\uff0c\u4e5f\u5c31\u662f $\\mathrm{C}_i^{\\frac{i+j_{0}}{2}}-\\mathrm{C}_i^{\\frac{i+j_{1}+2}{2}}$\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u7684\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\n$$\n\\sum_{i=0}^{n}\\mathrm{C}_{n}^{i}\\left(\\mathrm{C}_{i}^{\\frac{i+j_0}{2}}-\\mathrm{C}^{\\frac{i+j_1+2}{2}}_i\\right)\n$$\n\u4ece\u800c\u53ef\u4ee5\u5728 $\\mathrm{O}(n)$ \u7ea7\u522b\u5b8c\u6210\u8ba1\u7b97\u3002\n\n$j_0$ \u548c $j_1$ \u662f\u591a\u5c11\u5462\uff1f\u6211\u4eec\u770b\u770b $j$ \u9700\u8981\u6ee1\u8db3\u7684\u9650\u5236\u6761\u4ef6\u3002$j\\ge 0$ \u662f\u9898\u76ee\u8981\u6c42\u7684\uff0c$j\\le i$ \u662f\u5b9e\u9645\u610f\u4e49\u8981\u6c42\u7684\uff08\u56de\u5fc6 $j=f(S)$ \u548c $f$ \u7684\u5b9a\u4e49\uff09\uff0c$l\\le j\\le r$ \u4e5f\u662f\u9898\u76ee\u8981\u6c42\u7684\uff0c\u540c\u65f6 $i,j$ \u7684\u5947\u5076\u6027\u76f8\u540c\u3002\u4ece\u800c\uff0c$l\\le j\\le \\min(i,r)$\uff0c\u5e76\u4e14\u786e\u5b9a\u4e0a\u4e0b\u754c\u540e\u8fd8\u8981\u5c06 $j$ \u52a0 $1$ \u6216\u51cf $1$\uff08\u4e0a\u754c\u51cf $1$\uff0c\u4e0b\u754c\u52a0 $1$\uff09\uff0c\u4ee5\u4fdd\u8bc1 $i,j$ \u7684\u5947\u5076\u6027\u76f8\u540c\u3002\n\n#### \u7a0b\u5e8f\u8bbe\u8ba1\n\n\u95ee\u9898\u8fd8\u6ca1\u6709\u89e3\u51b3\u5b8c\uff0c\u7ec4\u5408\u6570\u600e\u4e48\u7b97\uff1f\n\n\u8fd9\u91cc $1\\le p\\le 2\\times 10^9$\uff0c\u5e76\u4e14\u4e0d\u4fdd\u8bc1\u662f\u8d28\u6570\uff0c\u8fd9\u8ba9\u6211\u4eec\u8ba1\u7b97\u9636\u4e58\u9006\u5143\u6709\u4e86\u56f0\u96be\u3002\u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u79cd\u7c7b\u4f3c\u201c\u6269\u57df\u201d\u7684\u601d\u60f3\u5904\u7406\u3002\n\n\u9996\u5148\u7279\u5224 $p=1$ \u7684\u60c5\u5f62\uff0c\u5982\u679c $p=1$ \u76f4\u63a5\u8f93\u51fa $0$\uff0c\u5b8c\u5168\u4e0d\u7528\u8ba1\u7b97\u3002\n\n\u63a5\u4e0b\u6765\u5c06 $p$ \u5206\u89e3\u8d28\u56e0\u6570\uff0c\u5206\u89e3\u6210 $p_1^{\\alpha_1}p_2^{\\alpha_2}p_3^{\\alpha_3}\\cdots p_k^{\\alpha_k}$ \u7684\u5f62\u5f0f\u3002$p$ \u81f3\u591a\u6709 $9$ \u4e2a\u4e0d\u540c\u8d28\u56e0\u5b50\uff08\u8fd9\u662f\u56e0\u4e3a $2\\times 3\\times 5\\times 7\\times 11\\times 13\\times 17\\times 19\\times 23\\times 29>2\\times 10^9$\uff09\u3002\n\n\u5728\u8ba1\u7b97\u9636\u4e58\u548c\u9636\u4e58\u7684\u9006\u5143\u65f6\uff0c\u6211\u4eec\u628a\u6bcf\u4e2a\u6570\u8868\u793a\u6210 $x\\cdot p_1^{\\beta_1}p_2^{\\beta_2}p_3^{\\beta_3}\\cdots p_k^{\\beta_k}$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $x$ \u4e0e $p$ \u4e92\u8d28\u3002\u8fd9\u6837\uff0c\u4e24\u4e2a\u6570\u76f8\u4e58\uff0c\u5c31\u8ba9\u5b83\u4eec\u7684 $x$ \u76f8\u4e58\u5e76\u6a21 $p$\uff0c\u6307\u6570\u76f8\u52a0\uff1b\u4e24\u4e2a\u6570\u76f8\u9664\uff0c\u5c31\u8ba9\u5b83\u4eec\u7684 $x$ \u76f8\u9664\uff08\u5c31\u662f\u4e58\u9006\u5143\uff09\u5e76\u6a21 $p$\uff0c\u6307\u6570\u76f8\u51cf\u3002\n\n\u53ef\u662f\u8fd9\u4e2a\u7ed3\u6784\u600e\u4e48\u652f\u6301\u52a0\u51cf\u6cd5\u5462\uff1f\u4e8b\u5b9e\u4e0a\uff0c\u4e0d\u9700\u8981\u652f\u6301\u52a0\u51cf\u6cd5\uff01\u6211\u4eec\u4f7f\u7528\u8fd9\u6837\u7684\u7ed3\u6784\u7684\u539f\u56e0\uff0c\u662f\u6211\u4eec\u60f3\u8981\u5904\u7406**\u9664\u6cd5**\u3002\u5982\u679c\u5904\u7406\u7684\u662f\u52a0\u3001\u51cf\u3001\u4e58\uff0c\u90a3\u4e0d\u7ba1\u64cd\u4f5c\u6570\u662f\u5426\u4e0e $p$ \u4e92\u8d28\uff0c\u90fd\u53ef\u4ee5\u50cf\u6211\u4eec\u719f\u6089\u7684\u90a3\u6837\u64cd\u4f5c\u3002\u800c\u6574\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u6709\u7ec4\u5408\u6570\u7684\u8ba1\u7b97\u9700\u8981\u7528\u5230\u9664\u6cd5\uff0c\u56e0\u6b64\u6211\u4eec\u8ba1\u7b97\u5b8c\u7ec4\u5408\u6570\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u628a\u7ed3\u679c\u7684 $x\\cdot p_1^{\\beta_1}p_2^{\\beta_2}p_3^{\\beta_3}\\cdots p_k^{\\beta_k}$ \u6a21 $p$\uff0c\u6309\u7167\u6b63\u5e38\u7684\u65b9\u5f0f\u8fdb\u884c\u4e0b\u9762\u7684\u8ba1\u7b97\u3002\n\n\u56e0\u4e3a\u8981\u4f7f\u7528\u8fd9\u6837\u7684\u7ed3\u6784\uff0c\u6574\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u5c06\u662f $\\mathrm{O}(n\\log n)$ \u7684\u3002\n\n\u53e6\u5916\uff0c\u8fd8\u8981\u989d\u5916\u6ce8\u610f\uff0c\u56e0\u4e3a $p\\le 2\\times 10^9$\uff0c\u56e0\u6b64\u4e0d\u50cf\u5e73\u5e38\u6211\u4eec\u5199\u7684\u90a3\u6837\uff0c\u5728\u8fd9\u91cc\u4e24\u4e2a\u6a21 $p$ \u540e\u7684\u6570\u76f8\u52a0\u4ecd\u4f1a\u8d85\u51fa `signed int` \u7684\u8303\u56f4\u3002\u5728\u8fd9\u91cc\u63a8\u8350\u4e00\u4e0b Codeforces \u7684\u63d0\u793a\u529f\u80fd\uff0c\u5728\u5e73\u65f6\u7ec3\u4e60\u4ea4\u9898\u65f6\uff0c\u5b83\u53ef\u80fd\u4f1a\u63d0\u793a\u5982\u6574\u6570\u6ea2\u51fa\u3001\u6570\u7ec4\u8d8a\u754c\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u50cf\u8fd9\u4e2a\u6574\u6570\u8d8a\u754c\u5b83\u5c31\u4f1a\u63d0\u793a Probably, the solution is executed with error 'signed integer overflow' on the line xx\u3002\u771f\u662f\u611f\u8c22 Codeforces \u8282\u7ea6\u4e86\u6211\u7684\u65f6\u95f4\uff01~~\u53e6\u5916\uff0c\u6d1b\u8c37\u5565\u65f6\u5019\u6574\u4e2a\u8fd9\u6837\u7684\u529f\u80fd\u554a\uff1f~~\n\n#### \u505a\u9898\u603b\u7ed3\n\n\u8fd9\u662f\u4e00\u9053\u5f88\u6709\u4ef7\u503c\u7684\u9898\u76ee\uff0c\u81f3\u5c11\u6709\u4e09\u4e2a\u70b9\u53ef\u4ee5\u79ef\u7d2f\u3002\n\n- \u5217\u51fa\u5f0f\u5b50\u65b9\u9762\uff0c\u79ef\u7d2f\u5361\u7279\u5170\u6570\u7684\u7ecf\u5178\u5904\u7406\u65b9\u6cd5\u3002\n- \u5316\u7b80\u5f0f\u5b50\u65b9\u9762\uff0c\u5f3a\u5316\u201c\u6ce8\u610f\u76f8\u540c\u7684\u7ed3\u6784\u201d\u7684\u601d\u60f3\u3002\n- \u7a0b\u5e8f\u8bbe\u8ba1\u65b9\u9762\uff0c\u6a21\u4efb\u610f\u6a21\u6570\u7684\u7ec4\u5408\u6570\u5904\u7406\u65b9\u6cd5\u3002\n\n#### \u4ee3\u7801\u53c2\u8003\n\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <algorithm>\n#define MAXIOLG 25\n#define FILENAME(x)\\\nfreopen(x\".in\",\"r\",stdin);\\\nfreopen(x\".out\",\"w\",stdout);\n#define LOWBIT(x) ((x)&(-(x)))\n#define MD(x) (((x)>=(p))?((x)-=(p)):(0))\n#define MAXPR 10\n#define MAXN 100005\nusing namespace std;\n\ntypedef long double ld;\ntypedef long long ll;\ntypedef ll io_t;\nio_t shin[MAXIOLG];\nio_t seto(void); //\u5feb\u901f\u8bfb\u5165\nvoid ayano(io_t x,char spliter='\\n'); //\u5feb\u901f\u8f93\u51fa\n\nint p,phip,phipm; //p, p \u7684\u6b27\u62c9\u51fd\u6570\uff0cp \u7684\u6b27\u62c9\u51fd\u6570\u51cf 1\uff08\u7528\u4e8e\u8ba1\u7b97\u9006\u5143\uff09\nint prims[MAXPR],primdeg[MAXPR],primcnt=0; //\u5206\u89e3\u8d28\u56e0\u6570\u7684\u7ed3\u679c\n\nint kasumi(int a,int b); //\u5feb\u901f\u5e42\nint comb(int a,int b); //\u7ec4\u5408\u6570\n\nstruct Num{\n    int x,xinv,degs[MAXPR]; //\u4e92\u8d28\u90e8\u5206, \u4e92\u8d28\u90e8\u5206\u7684\u9006\u5143, \u6307\u6570\u90e8\u5206\n    Num(void):x(1),xinv(1){ //\u6784\u9020\u51fd\u6570\n        for (int i=1;i<=primcnt;i++)\n            this->degs[i]=0;\n    }\n    Num(int y){ //\u4ece\u4e00\u4e2a\u6574\u6570\u6784\u9020\n        for (int i=1;i<=primcnt;i++){\n            int ip=prims[i];\n            int d=y/ip;\n            this->degs[i]=0;\n            while (d*ip==y)\n                this->degs[i]++,y=d,d=y/ip;\n        }\n        y%=p;\n        this->x=y,this->xinv=kasumi(y,phipm);\n    }\n    Num(const Num& tn):x(tn.x),xinv(tn.xinv){ //\u201c\u590d\u5236\u6784\u9020\u201d\n        for (int i=1;i<=primcnt;i++)\n            this->degs[i]=tn.degs[i];\n    }\n    int output(void){ //\u8f6c\u6362\u4e3a\u666e\u901a\u6570\n        int oans=this->x;\n        for (int i=1;i<=primcnt;i++)\n            oans=1ll*oans*kasumi(prims[i],this->degs[i])%p;\n        return oans;\n    }\n    friend Num operator*(const Num& lhs,const Num& rhs); //\u76f8\u9664\n    friend Num operator/(const Num& lhs,const Num& rhs); //\u76f8\u4e58\n};\n\nNum factors[MAXN]; //\u9884\u5904\u7406\u9636\u4e58\n\nint main(void){\n    int n,l,r;\n    n=seto(),p=seto(),l=seto(),r=seto();\n    if (p==1){ //\u7279\u5224\n        ayano(0);\n        return 0;\n    }\n    int tp=p; //\u5206\u89e3\u8d28\u56e0\u6570\uff0c\u6ce8\u610f\u4e0d\u8981\u5728\u539f\u6765\u7684\u6570\u4e0a\u5206\u89e3\n    phip=p; //\u540c\u65f6\u8ba1\u7b97 phi \u503c\n    for (int ip=2;ip*ip<=tp;ip++){\n        int d=tp/ip;\n        if (!(d*ip==tp))\n            continue;\n        primcnt++,prims[primcnt]=ip,phip=phip/ip*(ip-1);\n        while (d*ip==tp)\n            primdeg[primcnt]++,tp=d,d=tp/ip;\n    }\n    if (tp>1) //\u5927\u4e8e sqrt(p) \u7684\u8d28\u56e0\u5b50\n        primcnt++,prims[primcnt]=tp,primdeg[primcnt]=1,phip=phip/tp*(tp-1);\n    phipm=phip-1;\n    factors[0]=Num(1); //\u9884\u5904\u7406\u9636\u4e58\n    for (int i=1;i<=n;i++)\n        factors[i]=Num(i)*factors[i-1];\n    ll ans=0;\n    for (int i=l;i<=n;i++){\n        int lb=l;\n        ((lb^i)&1)?(lb++):(0); // i,j \u5947\u5076\u6027\u4e00\u81f4\n        int rb=min(i,r);\n        ((rb^i)&1)?(rb--):(0); // i,j \u5947\u5076\u6027\u4e00\u81f4\n        if (lb>rb)\n            continue;\n        ll tans=1ll*comb(i,(i+lb)/2)+p-comb(i,(i+rb+2)/2); //\u8fd9\u4e2a\u5730\u65b9\u8bb0\u5f97\u7528 long long\uff0c\u5426\u5219\u52a0\u6cd5\u6ea2\u51fa\n        MD(tans);\n        tans=1ll*tans*comb(n,i)%p;\n        ans+=tans,MD(ans);\n    }\n    ayano(ans);\n    return 0;\n}\n//\u8ba1\u7b97\u7ec4\u5408\u6570\nint comb(int a,int b){\n    //C_a^b\n    if (b>a)\n        return 0;\n    Num cansn=factors[a]/factors[b];\n    cansn=cansn/factors[a-b];\n    return cansn.output(); //\u8f6c\u6362\u4e3a\u666e\u901a\u7684\u6570\n}\n//\u5feb\u901f\u5e42\nint kasumi(int a,int b){\n    int kans=1;\n    while (b)\n        (b&1)?(kans=1ll*kans*a%p):(0),\n        b>>=1,a=1ll*a*a%p;\n    return kans;\n}\n//\u4e24\u4e2a\u6570\u7684\u76f8\u4e58\uff0c\u4e92\u8d28\u90e8\u5206\u76f8\u4e58\uff0c\u6307\u6570\u76f8\u51cf\nNum operator*(const Num& lhs,const Num& rhs){\n    Num mans(lhs);\n    mans.x=1ll*mans.x*rhs.x%p;\n    mans.xinv=1ll*mans.xinv*rhs.xinv%p;\n    for (int i=1;i<=primcnt;i++)\n        mans.degs[i]+=rhs.degs[i];\n    return mans;\n}\n//\u4e24\u4e2a\u6570\u7684\u76f8\u9664\uff0c\u4e58\u9006\u5143\uff0c\u6307\u6570\u76f8\u51cf\nNum operator/(const Num& lhs,const Num& rhs){\n    Num mans(lhs);\n    mans.x=1ll*mans.x*rhs.xinv%p;\n    mans.xinv=1ll*mans.xinv*rhs.x%p;\n    for (int i=1;i<=primcnt;i++)\n        mans.degs[i]-=rhs.degs[i];\n    return mans;\n}\n//\u5feb\u901f\u8bfb\u5165\nio_t seto(void){\n    io_t seto_x=0;\n    int symbol=0;\n    char ch=getchar();\n    while (!isdigit(ch))\n        (ch=='-')?(symbol=1):(0),ch=getchar();\n    while (isdigit(ch))\n        (seto_x=seto_x*10+(ch-'0')),ch=getchar();\n    return (symbol)?(-seto_x):(seto_x);\n}\n//\u5feb\u901f\u8f93\u51fa\nvoid ayano(io_t ayano_x,char spliter){\n    if (!ayano_x){\n        putchar('0'),putchar(spliter);\n        return;\n    }\n    if (ayano_x<0)\n        putchar('-'),ayano_x=-ayano_x;\n    int ayano_len=0;\n    while (ayano_x){\n        io_t ayano_d=ayano_x/10;\n        shin[ayano_len++]=ayano_x-ayano_d*10;\n        ayano_x=ayano_d;\n    }\n    while (ayano_len--)\n        putchar(shin[ayano_len]+'0');\n    putchar(spliter);\n}\n```\n\n\n\n#### \u73c2\u5b66\u5ba3\u4f20\n\n[\u73c2\u6735\u8389\uff08Chtholly\uff09](https://www.chtholly.ac.cn/)\u662f\u5929\uff01\n\n[![Chtholly](https://cdn.luogu.com.cn/upload/pic/9235.png)](https://www.luogu.com.cn/problem/P3933)\n\n[\u5948\u8299\u83b2\uff08Nephren\uff09](https://nephren.ac.cn/)\u5929\u4e0b\u7b2c\u4e00\uff01\n\n[![Nephren](https://cdn.luogu.com.cn/upload/pic/9263.png)](https://www.luogu.com.cn/problem/P4691)\n\n[\u83c8\u742a\u65ed\uff08Lakhesh\uff09](https://wiki.sukasuka.cn/%E8%8F%88%E7%90%AA%E6%97%AD%C2%B7%E5%B0%BC%E5%85%8B%E6%96%AF%C2%B7%E7%91%9F%E5%B0%BC%E6%AC%A7%E9%87%8C%E6%96%AF)\u4e5f\u5f88\u53ef\u7231\uff01\uff08\u672c\u9898\u4e2d\u83c8\u742a\u65ed\u4e5f\u6709\u51fa\u73b0\u54e6\uff09\n\n[![Lakhesh](https://cdn.luogu.com.cn/upload/image_hosting/i3gotdn1.png)](https://img.sukasuka.cn:2333/post/1479)",
        "postTime": 1595835630,
        "uid": 25008,
        "name": "Sweetlemon",
        "ccfLevel": 9,
        "title": "\u795e\u5947\u7684\u73c2\u5b66\u7ec4\u5408\u9898\u2014\u2014Nephren Runs a Cinema"
    },
    {
        "content": "\u94fe\u63a5[CF896D Nephren Runs a Cinema](https://www.luogu.com.cn/problem/CF896D)\n\n###\u5927\u7231\u5948\u8299\u83b2\u3002\u3002\u3002\u3002\n\n\u4e2a\u4eba\u611f\u89c9\u8fd9\u9898\u548c [P3266 [JLOI2015]\u9a97\u6211\u5462](https://www.luogu.com.cn/problem/P3266)\u6709\u70b9\u50cf\u3002\n\n\u9996\u5148\u53ef\u4ee5\u8003\u8651dp\uff0c$f[i][j]$\u4e3a\u6392\u5230\u7b2c i \u4e2a\u4eba\uff0c\u5f53\u524d\u5269\u4f59 j \u5f2050\u5143\u94b1\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u65b9\u7a0b\u663e\u7136\uff0c\u8d85\u65f6\u4e5f\u663e\u7136\u3002\n\n\u53d7P3266\u7684\u542f\u53d1\uff0c\u8003\u8651\u653e\u5230\u4e8c\u7ef4\u5750\u6807\u7cfb\u4e2d\uff0cx\u5750\u6807\u8868\u793a\u6392\u5230\u4e86\u54ea\u4e00\u4f4d\uff0cy\u5750\u6807\u8868\u793a\u5269\u4f5950\u5143\u94b1\u7684\u6570\u91cf\uff0c\u5148\u4e0d\u8003\u8651vip\u7528\u6237\uff0c\u5047\u8bbe\u6700\u540e\u5269\u4f59 p \u5f2050\u5143\u94b1\uff0c\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u662f\u4ece$(0, 0)$\u5411\u53f3\u4e0a\u6216\u5411\u53f3\u4e0b\u8d70\u5230$(n, p)$ \u7684\u65b9\u6848\u6570\uff0c\u5728 n \u6b65\u4e2d\uff0c\u5411\u4e0a\u7684\u6b65\u6570 - \u5411\u4e0b\u7684\u6b65\u6570 = p\uff0c\u5411\u4e0a\u7684\u6b65\u6570 + \u5411\u4e0b\u7684\u6b65\u6570 = n\uff0c\u53ef\u89e3\u5f97\u65b9\u6848\u6570\u4e3a$C_{n}^{(n - p) / 2}$, \u5176\u4e2d\u6709\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\u6570\uff0c\u5373\u89e6\u78b0\u4e86\u76f4\u7ebf$y = -1$\u7684\u8def\u5f84\uff0c\u6211\u4eec\u9700\u8981\u51cf\u53bb\u4ece$(0, -2)$\u5230$(n, p)$\u00a0\u7684\u65b9\u6848\u6570\uff0c\u5373$C_{n}^{(n - p) / 2 - 1}$\u3002\u6700\u540e\u56e0\u4e3a\u4ece l \u5230 r \u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u6240\u6709\u5f0f\u5b50\u7b97\u51fa\u6765\u76f8\u52a0\u53ef\u4ee5\u6d88\u6389\u4e2d\u95f4\u9879\uff0c\u6700\u540e\u53ea\u5269$C_{n}^{(n - l) / 2} - C_{n} ^ {(n - r - 1) / 2}$\uff0c\u6211\u4eec\u9700\u8981\u679a\u4e3evip\u7528\u6237\u6570\u91cf\uff0c\u6700\u7b97\u7684\u65f6\u5019\u628a\u603b\u6570\u51cf\u53bbvip\u6570\u91cf\uff0c\u6c42\u51fa\u7684\u7ed3\u679c\u4e58\u4e0a$C_{n}^{i}$ \uff08i\u4e3avip\u6570\u91cf\uff09\u3002\n\n\u56e0\u4e3a\u6a21\u6570\u4e0d\u662f\u8d28\u6570\uff0c\u65e0\u6cd5\u7528\u80a5\u5988\u5c0f\u5b9a\u7406\uff0c\u7528exgcd\u4e5f\u6709\u53ef\u80fd\u627e\u4e0d\u5230\u9006\u5143\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u6a21\u6570 p \u8d28\u56e0\u6570\u5206\u89e3\uff0c\u5728\u9884\u5904\u7406\u9636\u4e58\u7684\u65f6\u5019\u628a\u5305\u542b\u7684 p \u7684\u8d28\u56e0\u5b50\u53d6\u51fa\u6765\uff0c\u8bb0\u4e0b\u6307\u6570\uff0c\u7136\u540e\u518d\u4e58\u56de\u6765\u3002\u7b97\u9006\u5143\u76f4\u63a5\u7528\u6b27\u62c9\u5b9a\u7406\u3002\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\nusing namespace std;\ntypedef long long lld;\nconst int N = 100005;\nlld p, n, l, r;\nlld pr[N], inv[N], f[N], c[N][40], phi;\n//pr[]\u4e3ap\u7684\u8d28\u56e0\u5b50\uff0cc[i][j]\u4e3ai\u7684\u9636\u4e58\u4e2dp\u7684\u7b2cj\u4e2a\u8d28\u56e0\u5b50\u7684\u6307\u6570\nint cnt = 0;\nlld powe(lld a, lld b) {\n\tlld base = 1;\n\twhile(b) {\n\t\tif(b & 1) base = (base * a) % p;\n\t\ta = (a * a) % p;\n\t\tb >>= 1;\n\t}\n\treturn base;\n}\nvoid calc() {\n\tf[0] = inv[0] = 1;\n\tf[1] = inv[1] = 1;\n\tlld x = p;\n\tfor(lld i = 2; i * i <= x; i++) {//\u5206\u89e3p\n\t\tif(x % i) continue;\n\t\tpr[++cnt] = i;\n\t\twhile(!(x % i)) x /= i;\n\t}\n\tif(x > 1) pr[++cnt] = x;\n\tfor(int i = 2; i <= n; i++) {\n\t\tlld x = i;\n\t\tfor(int j = 1; j <= cnt; j++) {\n\t\t\tc[i][j] = c[i - 1][j];//\u6307\u6570\u52a0\u4e0a\u4e4b\u524d\u7684\n\t\t\twhile(!(x % pr[j])) x /= pr[j], c[i][j]++;\n\t\t}\n\t\tf[i] = f[i - 1] * x % p;//\u9636\u4e58\n\t\tinv[i] = powe(f[i], phi - 1);//\u9006\u5143\n\t}\n}\nlld comb(lld _n, lld m) {\n\tif(m < 0 || _n < m || n <= 0) return 0;\n\tif(m == 0) return 1;\n\tlld tmp = f[_n] * inv[m] % p * inv[_n - m] % p;\n\tfor(int i = 1; i <= cnt; i++) {\n\t\ttmp = (tmp * powe(pr[i], c[_n][i] - c[m][i] - c[_n - m][i])) % p;//\u4e58\u56de\u6765\n\t}\n\treturn tmp;\n}\nint main() {\n//\tfreopen(\"data.in\", \"r\", stdin);\n\tscanf(\"%lld%lld%lld%lld\", &n, &p, &l, &r);\n\tphi = p; lld d = p;//\u7b97phi\u51fd\u6570\n\tfor(lld i = 2; i * i <= d; i++) {\n\t\tif(d % i) continue;\n\t\tphi = phi / i * (i - 1);\n\t\twhile(!(d % i)) d /= i;\n\t}\n\tif(d > 1) phi = phi / d * (d - 1);\n\tcalc(); lld ans = 0; \n\tr = min(n, r);\n\tfor(lld i = 0; i <= n - l; i++) {\n\t\tlld tmp = (comb(n - i, (n - i - l) >> 1) - comb(n - i, (n - i - r - 1) >> 1) + p) % p;\n\t\tans += (tmp * comb(n, i)) % p; \n\t\tans = ans % p;\n\t}\n\tprintf(\"%lld\", ans);\n\treturn 0;\n}\n```\n![](https://cdn.luogu.com.cn/upload/image_hosting/w85erx84.png)",
        "postTime": 1583942580,
        "uid": 84066,
        "name": "Mcggvc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF896D \u3010Nephren Runs a Cinema\u3011"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\u5361\u7279\u5170\u6570\n\n\u4e0d\u4f1a\u7684\u53ef\u4ee5\u770b\u8fd9\u91cc\uff1a[\u5361\u7279\u5170\u6570\u5b66\u4e60\u7b14\u8bb0](https://www.cnblogs.com/Daidly/p/16793216.html)\n\n---\n\n\u8003\u8651\u5148\u6392\u9664 VIP \u5ba2\u6237\u7684\u5f71\u54cd\uff0c\u679a\u4e3e VIP \u5ba2\u6237\u7684\u4e2a\u6570\uff0c\u5bf9\u4e8e $i$ \u4e2a VIP \u5ba2\u6237\uff0c\u8d21\u732e\u4e3a ${n \\choose i}$\u3002\n\n\u679a\u4e3e\u6709 $50$ \u5143\u4eba\u7684\u4e2a\u6570 $j$\uff0c\u5219\u6709 $100$ \u5143\u4eba\u7684\u4e2a\u6570\u4e3a $n-i-j$\uff0c\u53ef\u4ee5\u53d1\u73b0 $j$ \u6ee1\u8db3\uff1a$l\\leq j-(n-i-j)\\leq r$\uff0c\u610f\u4e3a $50$ \u5143\u6700\u7ec8\u7684\u5f20\u6570\u8303\u56f4\u3002\n\n\u89e3\u5f97\uff1a$\\lceil\\frac{l+n-i}{2}\\rceil\\leq j\\leq \\lfloor\\frac{r+n-i}{2}\\rfloor$\uff0c\u53c8\u7531\u4e8e\u5bf9\u4e8e\u6bcf\u4e2a $100$ \u5143\u7684\u4ed8\u6b3e\uff0c\u90fd\u8981\u627e\u94b1 $50$\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4efb\u610f\u524d\u7f00\u90fd\u6ee1\u8db3\u6709 $50$ \u5143\u7684\u4eba\u7684\u4e2a\u6570\u5927\u4e8e\u7b49\u4e8e\u6709 $100$ \u5143\u7684\u4eba\u7684\u4e2a\u6570\uff0c\u76f4\u63a5\u5957\u7528\u5361\u7279\u5170\u6570\u8ba1\u7b97\u5f0f\u3002\n\n\u53ef\u5f97\u7b54\u6848\uff1a\n$$\n\\sum_{i=0}^n{n\\choose i}\\bigg(\\sum_{j=\\lceil\\frac{l+n-i}{2}\\rceil}^{\\lfloor\\frac{r+n-i}{2}\\rfloor}{n-i\\choose j}-{n-i\\choose j+1}\\bigg)\n$$\n\u53d1\u73b0\u53ef\u4ee5\u6d88\u6389\u5176\u4e2d\u5927\u90e8\u5206\uff0c\u5316\u7b80\u4e3a\uff1a\n$$\n\\sum_{i=0}^n{n\\choose i}\\bigg({n-i\\choose \\lceil\\frac{l+n-i}{2}\\rceil}-{n-i\\choose \\lfloor\\frac{r+n-i}{2}\\rfloor+1}\\bigg)\n$$\n\u505a\u5230\u8fd9\u91cc\uff0c\u6709\u5173\u5361\u7279\u5170\u6570\u7684\u90e8\u5206\u5c31\u7ed3\u675f\u4e86\uff0c\u4f46\u662f\u9898\u76ee\u8fd8\u6ca1\u6709\u89e3\u51b3\u3002\n\n\u9898\u76ee\u7ed9\u51fa\u7684\u6a21\u6570\u975e\u8d28\u6570\uff0c\u4e5f\u4e0d\u4fdd\u8bc1\u4e92\u8d28\uff0c\u4e0d\u80fd\u4f7f\u7528\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6216\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u9006\u5143\u3002\n\n\u8fd9\u65f6\u5019\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528 $\\rm{exLucas}$\uff08\u8d28\u56e0\u6570\u5206\u89e3\uff0cCRT \u5408\u5e76\u4e4b\u7c7b\u7684\uff09\uff0c\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u4ece $p$ \u5165\u624b\uff1a\n\n\u53d1\u73b0 $p\\leq 2\\times 10^9$ \u6700\u591a\u6709 $9$ \u4e2a\u4e0d\u540c\u7684\u8d28\u56e0\u5b50\uff0c\u6211\u4eec\u5c06 $p$ \u5206\u89e3\u8d28\u56e0\u6570\u3002\n$$\np=\\prod_{i=1}^{num}p_i^{\\alpha_i}\n$$\n\u5728\u9884\u5904\u7406\u7ec4\u5408\u6570\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230\u4e58\u6cd5\u548c\u9664\u6cd5\uff0c\u4e0d\u59a8\u5c06 $fac[i]=i!$ \u8868\u793a\u6210\u6709\u5173 $p$ \u7684\u8d28\u56e0\u5b50\u7684\u5f62\u5f0f\uff1a\n$$\nfac[i]=i!=p_0\\times \\prod_{i=1}^{num}p_i^{\\beta_i}\n$$\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u6b64\u65f6 $\\gcd(p_0,p)=1$\uff0c\u53ef\u4ee5\u4f7f\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u6c42\u9006\u5143\u3002\n\n \u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u9636\u4e58\uff0c\u6211\u4eec\u8bb0\u5f55 $p_0$ \u4ee5\u53ca $\\{\\beta_i\\}$\u3002\u91cd\u8f7d\u4e58\u6cd5\u548c\u9664\u6cd5\uff0c\u5173\u4e8e\u4e58\u6cd5\uff0c\u6211\u4eec\u5c06\u4e24\u4e2a\u6570\u7684 $\\{\\beta_i\\}$ \u76f8\u52a0\uff0c$p_0$ \u76f8\u4e58\u5e76\u5bf9 $p$ \u53d6\u6a21\uff1b\u5173\u4e8e\u9664\u6cd5\uff0c\u6211\u4eec\u5c06\u4e24\u4e2a\u6570\u7684 $\\{\\beta_i\\}$ \u76f8\u51cf\uff0c$p_0$ \u6c42\u9006\u5143\u76f8\u4e58\u5e76\u5bf9 $p$ \u53d6\u6a21\uff0c\u6700\u540e\u5c06\u7b54\u6848\u8fd8\u539f\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5f00 `long long`\uff0c\u4ee3\u7801\u5982\u4e0b\uff08\u4e2a\u4eba\u611f\u89c9\u8fd8\u662f\u8f83\u4e3a\u7b80\u6d01\u660e\u4e86\u7684\uff09\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\ninline int read(){\n\tint x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c<='9'&&c>='0'){\n\t\tx=(x<<1)+(x<<3)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\n\nvoid print(int x){\n\tif(x<0)putchar('-'),x=-x;\n\tif(x>9)print(x/10);\n\tputchar(x%10^48);\n}\n\nconst int N=1e5+5;\nint mod,num,p[10],a[10];\nstruct node{\n\tint p0=1,a0[10]={0};\n}fac[N],invfac[N];\n\nint calc(node x){\n\tint ans=x.p0;\n\tfor(int i=1;i<=num;++i)while(x.a0[i]--)ans=ans*p[i]%mod;\n\treturn ans;\n}\n\nnode work(int x){\n\tnode ans;\n\tfor(int i=1;i<=num;++i)while(x%p[i]==0)x/=p[i],ans.a0[i]++;\n\tans.p0=x;\n\treturn ans;\n}\n\nvoid exgcd(int a,int b,int &x,int &y){\n\tif(!b){x=1,y=0;return;}\n\tint x0,y0;\n\texgcd(b,a%b,x0,y0);\n\tx=y0,y=x0-(a/b)*y0;\n}\n\nnode mul(node x,node y){\n\tnode ans;\n\tans.p0=x.p0*y.p0%mod;\n\tfor(int i=1;i<=num;++i)ans.a0[i]=x.a0[i]+y.a0[i];\n\treturn ans;\n}\n\nnode div(node x,node y){\n\tnode ans;\n\tint X,Y;\n\texgcd(y.p0,mod,X,Y);\n\tans.p0=x.p0*X%mod;\n\tfor(int i=1;i<=num;++i)ans.a0[i]=x.a0[i]-y.a0[i];\n\treturn ans;\n}\n\nvoid init(int n){\n\tint tmp=mod;\n\tfor(int i=2;i*i<=tmp;++i){\n\t\tif(tmp%i==0){\n\t\t\tp[++num]=i;\n\t\t\tint cnt=0;\n\t\t\twhile(tmp%i==0)tmp/=i,cnt++;\n\t\t\ta[num]=cnt;\n\t\t}\n\t}\n\tif(tmp>1){\n\t\tp[++num]=tmp;\n\t\ta[num]=1;\n\t}\n\tfor(int i=2;i<=n;++i)fac[i]=mul(work(i),fac[i-1]);\n}\n\nint C(int n,int m){\n\tif(m>n)return 0;\n\treturn calc(div(fac[n],mul(fac[m],fac[n-m])));\n}\n\nsigned main(){\n\tint n=read();mod=read();int l=read(),r=read(),ans=0;\n\tinit(n);\n\tfor(int i=0;i<=n;++i){\n\t\tint tmp=((C(n-i,(l+n-i+1)/2)-C(n-i,(r+n-i)/2+1))%mod+mod)%mod;\n\t\tif(tmp<=0)continue;\n\t\tans=(ans+C(n,i)*tmp%mod)%mod;\n\t}\n\tprint((ans+mod)%mod);\n\treturn 0;\n}\n```\n\u5b8c\u7ed3\u6492\u82b1\uff0c\u6c42\u8d5e\uff01\n",
        "postTime": 1665757441,
        "uid": 271736,
        "name": "Daidly",
        "ccfLevel": 6,
        "title": "CF896D Nephren Runs a Cinema \u9898\u89e3"
    },
    {
        "content": "\u548c\u5176\u4ed6\u9898\u89e3\u4e0d\u592a\u4e00\u6837\u7684\u67ff\u5b50\u3002\n\n\u628a 0 \u5143\uff0c50 \u5143\uff0c100 \u5143\u5206\u522b\u770b\u6210 $-1$\uff0c$0$\uff0c$1$\uff0c\u5219\u95ee\u9898\u8f6c\u5316\u6210\u6709\u591a\u5c11\u79cd\u7531 $-1$\uff0c$0$\uff0c$1$\uff0c\u6784\u6210\u7684\u957f\u4e3a $n$ \u7684\u5e8f\u5217\u6ee1\u8db3\uff1a\n\n- \u4efb\u610f\u524d\u7f00\u548c\u975e\u8d1f\u3002\n\n- \u5e8f\u5217\u603b\u548c\u5728 $[L,R]$ \u4e4b\u95f4\u3002\n\n\u7531\u524d\u4e00\u4e2a\u6761\u4ef6\u53ef\u4ee5\u60f3\u5230\u5361\u7279\u5170\u6570\u3002\u5982\u679c\u5df2\u7ecf\u786e\u5b9a\u8981\u7528 $n$ \u4e2a $1$\uff0c$m$ \u4e2a $-1$\uff0c\u6784\u6210\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u6761\u4ef6\u7684\u5e8f\u5217\uff0c\u5219\u7531\u5361\u7279\u5170\u6570\u5f97\u7b54\u6848\u4e3a $\\binom{n+m}{n} - \\binom{n+m}{n+1}$\u3002\n\n\u4e8e\u662f\u60f3\u5230\u5148\u679a\u4e3e $1$ \u7684\u4e2a\u6570\uff0c\u518d\u679a\u4e3e $-1$ \u7684\u4e2a\u6570\u3002\u4ee4 $1$ \u7684\u4e2a\u6570\u4e3a $i$\uff0c$-1$ \u7684\u4e2a\u6570\u4e3a $j$\uff0c\u5bb9\u6613\u5f97\u5230\u7b26\u5408\u6761\u4ef6\u7684 $j$ \u7684\u533a\u95f4 $[l,r]$\u3002\u7136\u540e\u8fd8\u8981\u628a\u8fd9 $i+j$ \u4e2a\u6570\u653e\u8fdb\u5e8f\u5217\u91cc\uff0c\u65b9\u6848\u4e3a $\\binom{n}{i+j}$\u3002\n\n\u4e8e\u662f\u5c31\u6709\u67ff\u5b50\uff1a\n\n$$\\sum_{j=l}^{r}{\\binom{n}{i+j}\\cdot\\left(\\binom{i+j}{i}-\\binom{i+j}{i+1} \\right)}$$\n\n\u8fd9\u4e2a\u67ff\u5b50\u62ec\u53f7\u91cc\u5916\u90fd\u6709 $i+j$ \u4e0d\u592a\u597d\u5316\u7b80\u7684\u6837\u5b50\u3002\u4e0d\u5982\u5148\u628a\u5b83\u62c6\u5f00\uff0c\u4e3a\uff1a\n\n$$\\sum_{j=l}^{r}{\\binom{n}{i+j}\\cdot\\binom{i+j}{i}}-\\sum_{j=l}^{r}{\\binom{n}{i+j}\\cdot\\binom{i+j}{i+1}}$$\n\n\u5148\u770b\u524d\u9762\u90a3\u90e8\u5206\uff0c\u7ec4\u5408\u610f\u4e49\uff1a\u5148\u4ece $n$ \u4e2a\u91cc\u9009 $i+j$ \u4e2a\uff0c\u518d\u4ece\u4e2d\u9009 $i$ \u4e2a\u3002\u4e0d\u59a8\u6539\u53d8\u987a\u5e8f\uff0c\u5148\u4ece $n$ \u4e2a\u91cc\u9009 $i$ \u4e2a\uff0c\u518d\u4ece\u5269\u4e0b $n-i$ \u4e2a\u91cc\u9009 $j$ \u4e2a\uff0c\u4e8e\u662f\u5c31\u53d8\u6210\u4e86\uff1a\n\n$$\\binom{n}{i}\\cdot\\sum_{j=l}^{r}{\\binom{n-i}{j}}$$\n\n\u53d1\u73b0\u540e\u9762\u662f\u7ec4\u5408\u6570\u5355\u884c\u533a\u95f4\u548c\u7684\u5f62\u5f0f\uff0c\u7b49\u4f1a\u53ef\u4ee5\u89e3\u51b3\u3002\u540e\u534a\u90e8\u5206\u540c\u7406\uff0c\u4e0b\u9762\u6709\u5f0f\u5b50\u3002\n\n\u4ee4 $l_j,r_j$ \u4e3a\u4e00\u4e2a $i$ \u5bf9\u5e94 $j$ \u7684\u533a\u95f4\u5de6\u53f3\u7aef\u70b9\uff0c\u603b\u7684\u67ff\u5b50\u5c31\u53d8\u6210\u4e86\uff1a\n\n$$\\sum_{i=L}^{n}{\\left(\\binom{n}{i}\\cdot\\sum_{j=l_i}^{r_i}{\\binom{n-i}{j}}-\\binom{n}{i+1}\\cdot\\sum_{j=l_i}^{r_i}{\\binom{n-i-1}{j-1}}\\right)}$$\n\n\u518d\u6765\u8bf4\u90a3\u4e2a\u7ec4\u5408\u6570\u5355\u884c\u533a\u95f4\u548c\u3002\u9996\u5148\u53ef\u4ee5\u62c6\u6210\u524d\u7f00\u548c\u76f8\u51cf\uff0c\u73b0\u5728\u6765\u8ba8\u8bba\u524d\u7f00\u548c\u3002\u8bbe\u7b2c $n$ \u884c\u524d $m$ \u5217\u6c42\u548c\u4e3a $S(n,m)$\u3002\n\n\u8bd5\u7740\u628a\u6bcf\u4e2a $S$ \u90fd\u5199\u51fa\u6765\u53ef\u4ee5\u53d1\u73b0 $S(n,m)=S(n-1,m-1)+S(n-1,m)$\uff0c\u4e0e\u7ec4\u5408\u6570\u9012\u63a8\u5f0f\u76f8\u540c\u3002\u628a $S(n,m)$ \u7684\u6bcf\u4e2a\u7ec4\u5408\u6570\u90fd\u62c6\u5230\u4e0a\u4e00\u884c\u5373\u53ef\u8bc1\u660e\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u7528\u4e00\u4e2a\u6307\u9488\u8bb0\u5f55\u67d0\u4e00\u4f4d\u7f6e\u7684 $S(n,m)$\uff0c\u518d\u6765\u8ba8\u8bba\u6307\u9488\u7684\u79fb\u52a8\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c$S(n,m)$ \u8bb0\u4e3a $y$\uff0c\u6307\u9488\u518d\u8bb0\u5f55\u4e00\u4e2a $S(n-1,m-1)$ \u8bb0\u4e3a $x$\u3002\n\n\u5de6\u53f3\u79fb\u52a8\u5c31\u76f4\u63a5\u8ba1\u7b97\u5355\u70b9\u7ec4\u5408\u6570\u5c31\u53ef\u4ee5\u505a\u5230\u3002\n\n\u4e0b\u79fb\uff1a$y$ \u5de6\u79fb\u4e00\u4f4d\u5373\u53ef\u5f97\u5230\u65b0\u7684 $x$\uff0c\u518d\u7531\u65b0\u7684 $x$ \u4e0e\u65e7\u7684 $y$ \u52a0\u548c\uff0c\u7531\u4e0a\u9762\u7684\u9012\u63a8\u5f0f\u5f97\uff0c\u5373\u4e3a\u65b0\u7684 $y$\u3002\n\n\u4e0a\u79fb\uff1a$x$ \u53f3\u79fb\u4e00\u4f4d\u5f97\u5230\u65b0\u7684 $y$\u3002\u5982\u679c\u73b0\u5728\u8981\u7531 $S(n,m)$ \u5f97\u5230 $S(n-1,m)$\uff0c\u53ef\u4ee5\u77e5\u9053\uff1a\n\n$$S(n,m)=S(n-1,m-1)+S(n-1,m)=2\\cdot S(n-1,m) -\\binom{n-1}{m}$$\n\n\u6240\u4ee5 $S(n-1,m)=\\frac{S(n,m)+\\binom{n-1}{m}}{2}$\u3002\n\n\u8981\u62ff\u6765\u51cf\u7684\u5de6\u53f3\u524d\u7f00\u548c\u5206\u4e24\u4e2a\u6307\u9488\u7684\u8bdd\uff0c\u53ef\u4ee5\u53d1\u73b0\u6bcf\u6b21\u8981\u6c42\u7684 $S(n,m)$ \u4f4d\u7f6e\u76f8\u8fd1\uff0c\u76f4\u63a5\u66b4\u529b\u79fb\u6307\u9488\u5373\u53ef\u3002\n\n\u7136\u540e\u8fd9\u9898\u53c8\u662f\u4e2a\u4efb\u610f\u6a21\u6570\u00b7\u00b7\u00b7\u628a\u6a21\u6570\u8d28\u56e0\u6570\u5206\u89e3\u6210 $\\prod{p_i^{c_i}}$\uff0c\u7136\u540e\u628a\u6bcf\u4e2a\u6570\u5206\u6210\u4e0e\u6a21\u6570\u4e92\u8d28\u7684\u90e8\u5206\uff0c\u7528 ${p_i^{c`_i}}$ \u6765\u8868\u793a\u4e0d\u4e92\u8d28\u7684\u90e8\u5206\u3002\u4e92\u8d28\u7684\u5b58\u5728\u9006\u5143\uff0c\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u53ef\u4ee5\u6c42\uff0c\u4e0d\u4e92\u8d28\u7684\u5df2\u7ecf\u5206\u89e3\uff0c\u4e58\u9664\u6cd5\u5bb9\u6613\u5b9a\u4e49\uff0c\u5316\u6210\u666e\u901a\u7684\u5f62\u5f0f\u53ef\u4ee5\u52a0\u51cf\u3002\u9884\u5904\u7406\u51fa\u7aed\u8bda\uff0c\u7ec4\u5408\u6570\u5c31\u53ef\u4ee5\u6c42\u4e86\u3002\n\n\u00b7\u00b7\u00b7\u4f46\u662f\u8fd8\u6709\u4e2a\u95ee\u9898\uff0c\u6ce8\u610f\u5230 $S(n,m)$ \u7684\u6307\u9488\u4e0a\u79fb\u540c\u65f6\u9700\u8981\u52a0\u6cd5\u548c\u9664\u6cd5\uff0c$2$ \u53ef\u80fd\u4e0d\u5b58\u5728\u9006\u5143\uff0c\u8981\u5957\u7528\u4e0a\u9762\u65b9\u6cd5\u7684\u8bdd\u52a0\u6cd5\u5e76\u4e0d\u597d\u5b9a\u4e49\uff0c\u90a3\u600e\u4e48\u529e\u5462\uff1f\n\n\u00b7\u00b7\u00b7\u90a3\u5c31\u907f\u514d\u4e0a\u79fb\u5c31\u597d\u4e86\u3002\u9006\u5e8f\u679a\u4e3e $i$\uff0c\u603b\u5f0f\u5b50\u5148\u7b97\u53f3\u8fb9\uff0c\u5c31\u53ef\u4ee5\u8ba9\u6307\u9488\u5355\u8c03\u4e0d\u5347\u4e86\u3002\u4e0a\u2606\u952e\u2606\u5df2\u2606\u6263\u3002\n\n\u4f18\u96c5\u7684\u4ee3\u7801\u4e0d\u4f1a `#define int long long`\u3002\u7801\u55b5\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define EL puts(\"Elaina\")\n#define reg register int\ntypedef long long ll;\nusing namespace std;\nconst int maxn=1e5+3,maxp=11;\nint n,mod,L,R,cnt,p[maxp];\ninline int qpow(int a,int b){\n\tassert(b>=0);\n\tint ans=1;\n\tfor(;b;b>>=1,a=1ll*a*a%mod)\n\t\tif(b&1)ans=1ll*ans*a%mod;\n\treturn ans;\n}\ninline void exgcd(int a,int b,ll &x,ll &y){\n\tif(!b){x=1,y=0;return;}\n\texgcd(b,a%b,y,x),y-=a/b*x;\n}\ninline int inv(int a){\n\tll x,y;exgcd(a,mod,x,y);\n\treturn (x+mod)%mod;\n}\ninline void init(){\n\tint res=mod;\n\tfor(reg i=2;i*i<=mod;++i)\n\t\tif(res%i==0){\n\t\t\tp[++cnt]=i;\n\t\t\twhile(res%i==0)res/=i;\n\t\t}\n\tif(res^1)p[++cnt]=res;\n}\nstruct number{\n\tint c[maxp];\n\tnumber(){}\n\tnumber(ll x){\n\t\tmemset(c,0,sizeof(c));\n\t\tfor(reg i=1;i<=cnt;++i)\n\t\t\twhile(x%p[i]==0)c[i]++,x/=p[i];\n\t\tc[0]=x;\n\t}\n\tinline int calc()const{\n\t\tint ans=c[0];\n\t\tfor(reg i=1;i<=cnt;++i)if(c[i])\n\t\t\tans=1ll*ans*qpow(p[i],c[i])%mod;\n\t\treturn ans;\n\t}\n\tinline void operator *=(const number &a){\n\t\tc[0]=1ll*c[0]*a.c[0]%mod;\n\t\tfor(reg i=1;i<=cnt;++i)c[i]+=a.c[i];\n\t}\n\tinline number operator *(const number &a)const{\n\t\tnumber ans=*this;ans*=a;return ans;\n\t}\n\tinline void operator /=(const number &a){\n\t\tc[0]=1ll*c[0]*inv(a.c[0])%mod;\n\t\tfor(reg i=1;i<=cnt;++i)c[i]-=a.c[i];\n\t}\n\tinline number operator /(const number &a)const{\n\t\tnumber ans=*this;ans/=a;return ans;\n\t}\n}fac[maxn];\ninline int C(int n,int m){\n\tif(m>n)return 0;if(m==0||n==m)return 1;\n\treturn (fac[n]/fac[m]/fac[n-m]).calc();\n}\nstruct CombinationPointer{\n\tint n,m,x,y;\n\tCombinationPointer(){n=m=1,x=1,y=2;}\n\tinline void left(){\n\t\tx=(1ll*x+mod-C(n-1,m-1))%mod;\n\t\ty=(1ll*y+mod-C(n,m))%mod,--m;\n\t}\n\tinline void right(){\n\t\tx=(1ll*x+C(n-1,m))%mod;\n\t\ty=(1ll*y+C(n,m+1))%mod,++m;\n\t}\n\tinline void down(){\n\t\tx=(1ll*y+mod-C(n,m))%mod;\n\t\ty=(1ll*x+y)%mod,++n;\n\t}\n\tinline int query(int tx,int ty){\n\t\tif(ty<0)return 0;\n\t\tif(!tx)return 1;\n\t\tif(!ty)return 1;\n\t\twhile(m>ty)left();\n\t\twhile(n<tx)down();\n\t\twhile(m<ty)right();\n\t\treturn y;\n\t}\n}p1,p2;\ninline void MyDearMoments(){\n\tscanf(\"%d%d%d%d\",&n,&mod,&L,&R),init();\n\tfac[0]=fac[1]=number(1);\n\tfor(reg i=2;i<=n;++i)fac[i]=fac[i-1]*number(i);\n\tint ans=0;\n\tfor(reg i=n;i>=L;--i){\n\t\tif(i==n){if(i>=L&&i<=R)ans=(ans+1)%mod;continue;}\n\t\tint l=max(i-R,0),r=min(n-i,i-L);\n\t\tif(l>r)continue;\n\t\tif(!l)ans=(1ll*ans+C(n,i))%mod,++l;\n\t\tif(l>r)continue;\n\t\tll res2=((1ll*p1.query(n-i-1,r-1)+mod-p2.query(n-i-1,l-2))%mod)%mod;\n\t\tll res1=((1ll*p1.query(n-i,r)+mod-p2.query(n-i,l-1))%mod)%mod;\n\t\tres1=1ll*C(n,i)*res1%mod,res2=1ll*C(n,i+1)*res2%mod;\n\t\tans=((1ll*ans+res1)%mod+mod-res2)%mod;\n\t}\n\tprintf(\"%d\\n\",ans);\n}\nint main(){return MyDearMoments(),0;}\n```",
        "postTime": 1665236785,
        "uid": 280633,
        "name": "Muel_imj",
        "ccfLevel": 7,
        "title": "CF896D Nephren Runs a Cinema \u9898\u89e3"
    },
    {
        "content": "> $n$ \u4e2a\u987e\u5ba2\u6392\u6210\u4e00\u6392\uff0c\u987e\u5ba2\u5206\u4e3a $3$ \u79cd $A,B,C$\uff0c\u5176\u4e2d\u5bf9\u4e8e\u4efb\u610f\u524d\u7f00\u987e\u5ba2\uff0c\u9700\u6ee1\u8db3 $A$ \u987e\u5ba2\u4e0d\u6bd4 $B$ \u987e\u5ba2\u5c11\uff0c\u6700\u7ec8\u5e0c\u671b $A$ \u987e\u5ba2\u6bd4 $B$ \u987e\u5ba2\u591a $l\\sim r$ \u4e2a\uff0c\u6c42\u6709\u591a\u5c11\u79cd\u53ef\u80fd\u7684\u961f\u4f0d\u3002\n>\n> $1\\le n\\le 10^5$\uff0c$1\\le p\\le 2\\times 10^9$\uff0c$1\\le l\\le r\\le n$\u3002\n\n\u770b\u5230\u300c\u4efb\u610f\u524d\u7f00\uff0c\u4e0d\u5c11\u4e8e\u300d\u7b49\u5b57\u6837\uff0c\u8003\u8651\u5361\u7279\u5170\u6570\u3002\n\n\u76f4\u89c2\u5730\u60f3\u8c61\u683c\u8def\uff0c\u8bbe $A$ \u987e\u5ba2\u4e3a $x$ \u8f74\uff0c$B$ \u987e\u5ba2\u4e3a $y$ \u8f74\uff0c\u8bbe\u7ec8\u70b9\u5750\u6807\u4e3a $(a,b)$\uff0c\u5219 $b+l\\le a\\le b+r$\u3002\n\n\u518d\u8003\u8651\u82e5 $AB$ \u987e\u5ba2\u5171\u6709 $s$ \u4e2a\u5df2\u7ecf\u6392\u597d\u961f\uff0c\u5c06 $n-s$ \u4e2a $C$ \u987e\u5ba2\u63d2\u5165\u961f\u4f0d\u65f6\uff0c\u76f8\u5f53\u4e8e\u5c06 $n-s$ \u4e2a\u5143\u7d20\u6254\u8fdb $s+1$ \u4e2a\u76d2\u5b50\u4e2d\uff0c\u6839\u636e\u9694\u677f\u6cd5\uff0c\u6b64\u65f6\u7684\u65b9\u6848\u6570\u4e3a $C_{n}^{s}$\u2014\u2014\u6216\u8bb8\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u5bf9\u4e8e $n$ \u4e2a\u6392\u597d\u7684\u5143\u7d20\uff0c\u94a6\u5b9a $s$ \u4e2a\u4e3a $AB$\uff0c\u5269\u4f59 $n-s$ \u4e2a\u4e3a $C$ \u7684\u65b9\u6848\u6570\u3002\n\n\u6545\u603b\u65b9\u6848\u6570\u4e3a\uff1a\n$$\n\\sum_{b=0}^{2b+l\\le n}\\sum_{a=b+l}^{\\min(b+r,n)}C_{n}^{a+b}(C_{a+b}^b-C_{a+b}^{b-1})\n$$\n\n\n\u53d1\u73b0\u8fd9\u5176\u5b9e\u662f\u4e2a\u5dee\u5f0f\uff0c\u4f46\u662f\u6211\u4eec\u4e0d\u80fd\u5dee\u5206\u76f8\u6d88\u2014\u2014\u56e0\u4e3a\u5728\u6211\u4eec\u7684\u679a\u4e3e\u4e2d\uff0c\u4e0b\u6807\u4f1a\u53d8\u2014\u2014\u90a3\u5c31\u8ba9\u5b83\u56fa\u5b9a\uff01\n\n\u8003\u8651\u6539\u53d8\u679a\u4e3e\u987a\u5e8f\uff0c\u5148\u679a\u4e3e $a+b$\uff0c\u518d\u679a\u4e3e $a$\uff0c\u5373\uff1a\n$$\n\\begin{aligned}ans&=\\sum_{a+b=l}^{n}C_{n}^{a+b}\\sum_{b=\\frac{a+b-r}{2}\\&b\\ge0}^{\\frac{a+b-l}{2}}(C_{a+b}^b-C_{a+b}^{b-1})\\\\&=\\sum_{a+b=l}^nC_n^{a+b}(C_{a+b}^{\\frac{a+b-l}{2}}-C_{a+b}^{\\frac{a+b-r}{2}-1})\\end{aligned}\n$$\n\u4e8e\u662f\u5c31\u53ef\u4ee5 $O(n)$ \u6c42\u89e3\u4e86\uff01\u8bb0\u5f97\u6ce8\u610f\u4e0b\u5f0f\u5b50\u4e2d\u7684\u53d6\u6574\u65b9\u5f0f\uff08\n\n**\u8fd9\u5145\u5206\u4f53\u73b0\u4e86\u679a\u4e3e\u987a\u5e8f\u7684\u91cd\u8981\u6027\uff01\u5f53\u5f0f\u5b50\u65e0\u6cd5\u6709\u6548\u5316\u7b80\u65f6\uff0c\u4e0d\u59a8\u89c2\u5bdf\u5f0f\u5b50\uff0c\u8003\u8651\u8c03\u6362\u679a\u4e3e\u987a\u5e8f\uff01**\n\n\u6ce8\u610f $p$ \u4e0d\u4e00\u5b9a\u4e3a\u6a21\u6570\uff0c\u65e0\u6cd5\u76f4\u63a5\u5904\u7406\u9006\u5143\uff0c\u9700\u8981\u7279\u6b8a\u5904\u7406\u3002\u8003\u8651\u5c06 $p$ \u8fdb\u884c\u8d28\u56e0\u5b50\u62c6\u89e3\uff0c\u5c06\u9884\u5904\u7406\u7684\u9636\u4e58\u4e2d $p$ \u7684\u8d28\u56e0\u6570\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u5355\u72ec\u8bb0\u5f55\uff0c\u4f7f\u5269\u4e0b\u7684\u6570\u4e0e $p$ \u4e92\u8d28\u3002\n\n\u5bf9\u4e8e\u4e58\u6cd5\uff0c\u6211\u4eec\u5c06\u5355\u72ec\u8bb0\u5f55\u7684\u8d28\u56e0\u6570\u76f8\u52a0\uff0c\u5269\u4f59\u6570\u76f8\u4e58\uff1b\u5bf9\u4e8e\u9664\u6cd5\uff0c\u6211\u4eec\u5c06\u5355\u72ec\u8bb0\u5f55\u7684\u8d28\u56e0\u6570\u76f8\u51cf\uff0c\u5269\u4f59\u6570\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u4e58\u9006\u5143\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+5;\nconst int V=2e5;\nint n,p,l,r,s[15],stot;\nstruct node{\n    ll x;\n    int num[10];\n    node(){\n        memset(num,0,sizeof(num));\n        x=0;\n    }\n    void init(){\n        x=1;\n    }\n}jc[N];\nnode operator *(const node x,const node y){\n    node z;\n    z.x=x.x*y.x%p;\n    //if (x.x==1&&y.x==1) cout<<x.x<<\" \"<<y.x<<\" \"<<x.x*y.x<<\" \"<<z.x<<\"\\n\";\n    for (int i=1;i<=stot;i++) z.num[i]=x.num[i]+y.num[i];\n    return z;\n}\nvoid exgcd(int a,int b,ll &x,ll &y){\n    if (b==0){\n        x=1,y=0;\n        return;\n    }\n    exgcd(b,a%b,y,x);\n    y-=(a/b)*x;\n}\nnode operator /(const node x,const node y){\n    node z;\n    ll r,t;\n    exgcd(y.x,p,r,t);\n    z.x=(x.x*r%p+p)%p;\n    for (int i=1;i<=stot;i++) z.num[i]=x.num[i]-y.num[i];\n    return z;\n}\nint read(){\n    int w=0,f=1;\n    char ch=getchar();\n    while (ch>'9'||ch<'0') {\n        if (ch=='-') f=-1;\n        ch=getchar();\n    }\n    while (ch>='0'&&ch<='9') {\n        w=(w<<3)+(w<<1)+(ch^48);\n        ch=getchar();\n    }\n    return w*f;\n}\nnode work(int y){\n    node x;\n    for (int i=1;i<=stot;i++){\n        while (y%s[i]==0) y/=s[i],x.num[i]++;\n    }\n    x.x=y;\n    return x;\n}\nvoid init(){\n    int now=p;\n    for (int i=2;i*i<=p;i++)\n        if (now%i==0){\n            s[++stot]=i;\n            while (now%i==0) now/=i;\n        }\n    if (now>1) s[++stot]=now;\n    jc[0].init();\n    for (int i=1;i<=V;i++) jc[i]=jc[i-1]*work(i);\n}\nll ksm(ll x,ll y){\n    ll ans=1;\n    while (y){\n        if (y&1) ans=ans*x%p;\n        x=x*x%p;\n        y>>=1;\n    }\n    return ans;\n}\nll chan(node x){\n    ll ans=x.x;\n    for (int i=1;i<=stot;i++)\n        ans=ans*ksm(s[i],x.num[i])%p;\n    return ans;\n}\nvoid print(node x){\n    cout<<x.x<<\"\\n\";\n    for (int i=1;i<=stot;i++)\n        cout<<x.num[i]<<\" \";\n    puts(\"\");\n}\nll C(int x,int y){\n    if (x<y||x<0||y<0) return 0;\n    return chan((jc[x]/jc[x-y])/jc[y]);\n}\nint main(){\n#ifndef ONLINE_JUDGE\n    freopen(\"in.in\",\"r\",stdin);\n    freopen(\"out.out\",\"w\",stdout);\n#endif\n    n=read(),p=read(),l=read(),r=read();\n    init();\n    //print(jc[0]*work(1));\n    ll ans=0;\n    for (int i=l;i<=n;i++){\n        int x=max(0,(i-r+1)/2)-1,y=(i-l)/2;\n        ll num=C(n,i)*(C(i,y)-C(i,x)+p)%p;\n        ans=(ans+num)%p;\n    }\n    cout<<ans<<\"\\n\";\n    return 0;\n}\n```",
        "postTime": 1678883043,
        "uid": 257621,
        "name": "\u7ffc\u5fb7\u5929\u5c0a",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 CF896D Nephren Runs a Cinema"
    },
    {
        "content": "**CF896D sol**\n\n\u5148\u8003\u8651\u8fd9\u4e2a $+0$ \u64cd\u4f5c\u5f88\u70e6\uff0c\u6211\u4eec\u76f4\u63a5\u5148\u7528\u7ec4\u5408\u6570\u679a\u4e3e\u51fa\u6765\u653e\u54ea\u91cc\u94a6\u5b9a\u5b83\u5f97\u4e86\u3002\n\n\u8003\u8651\u5c06 $-1,+1$ \u95ee\u9898\u8f6c\u5316\u5230\u5361\u7279\u5170\u6570\u7684\u51e0\u4f55\u610f\u4e49\u4e0a\u53bb\uff0c\u6211\u4eec\u53d1\u73b0\u82e5\u77e5\u9053 $-1$ \u4e2a\u6570 $m$ \u548c $1$ \u7684\u4e2a\u6570 $n$ \u5c31\u53ef\u4ee5\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u53ea\u5411\u53f3\u548c\u5411\u4e0a\u8d70\u5230\u4e00\u4e2a\u7f51\u683c\u70b9 $n,m$ \u7684\u65b9\u6848\u6570\uff0c\u663e\u7136\u7b54\u6848\u4e3a $C_{n + m}^m$ \uff0c\u5373\u94a6\u5b9a $m$ \u4e2a\u4f4d\u7f6e\u662f $-1$\u3002\n\n\u6211\u4eec\u51cf\u53bb\u4e0d\u5408\u6cd5\u6570\u91cf\uff0c\u5373\u8de8\u8d8a\u76f4\u7ebf $y = x + 1$ \u7684\u65b9\u6848\uff0c\u53d1\u73b0\u4efb\u610f\u8de8\u8fc7\u8be5\u76f4\u7ebf\u7684\u8def\u7ebf\u90fd\u53ef\u4ee5\u548c\u5230 $(m - 1,n + 1)$\uff0c\u5373 $(n,m)$ \u5173\u4e8e $y = x + 1$ \u7684\u5bf9\u79f0\u70b9\u7684\u8def\u7ebf\u4e00\u4e00\u5bf9\u5e94\u3002\u8fd9\u4e2a\u6784\u9020\u5f88\u7b80\u5355\uff0c\u5c31\u76f4\u63a5\u5c06\u8def\u5f84\u4e0a\u7b2c\u4e00\u4e2a\u548c $y = x + 1$ \u76f8\u4ea4\u70b9\u4ee5\u540e\u7684\u8def\u5f84\u5bf9\u79f0\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u5bf9\u4e8e\u4e0d\u5408\u6cd5\u8def\u5f84\u7684\u65b9\u6848\u6570\u5c31\u53ef\u4ee5\u8868\u793a\u4e3a $C_{n + m} ^ m - C_{n + m} ^ {m + 1}$\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6c42\u548c\uff0c\u9996\u5148\u679a\u4e3e\u4e86 $+0$ \u7684\u4e2a\u6570\uff0c\u63a5\u7740\u6211\u4eec\u679a\u4e3e $-1$ \u7684\u6570\u91cf\uff0c\u5f0f\u5b50\u957f\u6210\u8fd9\u6837\uff1a\n\n$\\sum_{i = 0} ^ n C_n^i \\times (\\sum_{j = l,2 \\mid (i + j)} ^ r C_{n - i} ^ {\\frac{i + j}{2}} - C_{n - i} ^ {\\frac{i + j + 2}{2}})$\n\n\u8003\u8651\u5bf9\u4e8e\u62ec\u53f7\u5185\u663e\u7136\u5dee\u5206\u4e00\u4e0b\u5c31\u53d8\u6210\u4e24\u9879\u4e86\u3002\u95ee\u9898\u53d8\u6210\u4e86 $O(n)$ \u4e2a\u7ec4\u5408\u6570\u7684\u8ba1\u7b97\u3002\n\n\u6211\u4eec\u8003\u8651\u5c06 $p$ \u8d28\u56e0\u6570\u5206\u89e3\uff0c\u5c06\u6240\u6709\u6570\u5199\u6210 $x \\times p_1^{k_1} \\times p_2^{k_2} \\times \\dots p_m ^ {k_m}$ \u7684\u5f62\u5f0f\u3002\n\n\u5219\u5bf9\u4e8e $x$ \u8fd9\u4e00\u90e8\u5206\u548c $p$ \u4e92\u8d28\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b27\u62c9\u5b9a\u7406\u5f97\u5230\u5b83\u4eec\u7684\u9006\u5143 $x ^ {\\varphi(p) - 1}$\u3002\n\n\u5bf9\u4e8e\u9636\u4e58\u6eda\u6307\u6570\u7684\u524d\u7f00\u548c\u7136\u540e\u76f8\u51cf\u4e00\u4e0b\u5c31\u53ef\u4ee5\u7b97\u8fd9\u90e8\u5206\u7684\u8d21\u732e\u4e86\u3002  \n\ncode: $O(n \\log ^ 2 n)$\uff0c\u968f\u4fbf\u7cbe\u7ec6\u5b9e\u73b0\u4e00\u4e0b\u5c31 $O(n \\log n)$ \u4e86\u3002\n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\nconst int Len = 2e5 + 5;\n#define ll long long\nint n,p,f[Len],c[Len][15],invf[Len],pr[25],len,l,r;\nll ph;\nint qpow(int a,ll b)\n{\n\tint res = 1;\n\twhile(b)\n\t{\n\t\tif(b & 1) res = 1ll * res * a % p;\n\t\ta = 1ll * a * a % p;\n\t\tb = b >> 1;\n\t}\n\treturn res;\n}\nvoid init()\n{\n\tint bot = p;\n\tfor(int i = 2 ; i * i <= bot ; i ++)\n\t{\n\t\tif(bot % i == 0)\n\t\t{\n\t\t\tpr[++ len] = i;\n\t\t\twhile(bot % i == 0) bot /= i;\n\t\t}\n\t}\n\tif(bot != 1) pr[++ len] = bot;\n\tf[0] = invf[0] = 1;invf[1] = f[1] = 1;\n\tfor(int i = 2 ; i <= n ; i ++)\n\t{\n\t\tint x = i;\n\t\tfor(int j = 1 ; j <= len ; j ++) \n\t\t{\n\t\t\tif(x % pr[j] == 0)\n\t\t\t{\n\t\t\t\twhile(x % pr[j] == 0) c[i][j] ++ , x /= pr[j];\n\t\t\t}\n\t\t\tc[i][j] += c[i - 1][j];\n\t\t}\n\t\tf[i] = 1ll * f[i - 1] * x % p;\n\t\tinvf[i] = qpow(f[i] , ph - 1);\n\t}\n}\ninline int C(int N,int M)\n{\n\tif(M < 0 || N < M) return 0;if(!M) return 1;\n\tint ret = 1ll * f[N] * invf[N - M] % p * invf[M] % p;\n\tfor(int j = 1 ; j <= len ; j ++) ret = 1ll * ret * qpow(pr[j] , c[N][j] - c[N - M][j] - c[M][j]) % p;\n\treturn ret;\n}\nsigned main()\n{\n\tscanf(\"%d %d %d %d\",&n,&p,&l,&r);\n\tll fft = p;ph = p;\n\tfor(int i = 2 ; 1ll * i * i <= fft ; i ++) \n\t{\n\t\tif(fft % i) continue;\n\t\tph = ph / i * (i - 1);\n\t\twhile(fft % i == 0) fft /= i;\n\t}\n\tif(fft != 1) ph = ph / fft * (fft - 1);\n\tinit();\n\tint as = 0;\n\tfor(int i = 0 ; i <= n - l ; i ++)\n\t{\n\t\tll nb = ((1ll * C(n - i , (n - i - l) >> 1) - C(n - i , (n - i - r - 1) >> 1) + p) % p);\n\t\tas = (as + 1ll * C(n , i) * nb % p) % p;\t\n\t}\n\tprintf(\"%d\\n\",as);\n\treturn 0;\n}\n```",
        "postTime": 1665214816,
        "uid": 782894,
        "name": "Kuon",
        "ccfLevel": 0,
        "title": "\u9a7b\u8db3\u8fdc\u65b9\u53ef\u89c1\u7684\u5c71\u4e18\uff0c\u5b9a\u80fd\u5c06\u61a7\u61ac\u63e1\u5165\u624b\u4e2d"
    },
    {
        "content": "### PART 0\n\u73c2\u6735\u8389\uff01\u597d\u8bf6\uff01\n\n~~\u8bf6\u90a3\u9053\u9898\u597d\u50cf\u662f CF896E \u6765\u7740....~~\n\n\u53cd\u6b63\u662f\u7b2c\u4e00\u9053\u9ed1\u9898\uff0c\u597d\u8bf6\uff01\n## PART 1\n\u7ed9\u5b9a\u56db\u4e2a\u6570 $n,p,L,R$\u3002\n\n\u6709 $n$ \u4e2a\u4eba\u6765\u6392\u961f\uff0c\u4ed6\u4eec\u53ef\u4ee5\u5206\u4e3a 3 \u7c7b\uff0c\u7b2c\u4e00\u7c7b\u662f\u624b\u4e0a\u6709 50 \u5143\u7684\uff0c\u7b2c\u4e8c\u7c7b\u624b\u4e0a\u6709 100 \u5143\uff0c\u7b2c\u4e09\u7c7b\u4e0d\u7528\u4ed8\u94b1\u3002\n\n\u6bcf\u4e2a\u4eba\u9664\u4e86\u7b2c\u4e09\u7c7b\u90fd\u9700\u8981\u4ed8 50 \u5143\uff0c\u56e0\u6b64\u7b2c\u4e8c\u7c7b\u7684\u4eba\u9700\u8981\u627e\u96f6\u3002\n\n\u6c42\u6709\u51e0\u79cd\u6392\u961f\u65b9\u6848\u6ee1\u8db3\u4efb\u610f\u65f6\u523b\u90fd\u80fd\u627e\u96f6\u5e76\u4e14\u6700\u540e\u5269\u4e0b\u7684 50 \u5143\u6570\u91cf\u5728 $[l,r]$ \u8303\u56f4\u5185\u3002\n## PART 2\n\n\u7b2c\u4e09\u7c7b\u4eba\u7684\u6570\u91cf\u53ef\u4ee5\u679a\u4e3e\u3002\n\n\u6211\u4eec\u9996\u5148\u5206\u6790\uff1a\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u652f\u51fa\u4e00\u5f20 50\uff1f\n\n\u6536\u7b2c\u4e8c\u7c7b\u4eba\u7684\u94b1\u7684\u65f6\u5019\u3002\n\n\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u591a\u4e00\u5f20 50\uff1f\n\n\u6536\u7b2c\u4e00\u7c7b\u4eba\u7684\u94b1\u7684\u65f6\u5019\u3002\n\n\u6240\u4ee5\u8bbe $x$ \u4e2a\u7b2c\u4e00\u7c7b\u4eba\uff0c$y$ \u4e2a\u7b2c\u4e8c\u7c7b\u4eba\uff0c\u90a3\u4e48\u5fc5\u987b\u6ee1\u8db3 $L\\le x-y\\le R$\u3002\n\n\u63a5\u7740\u6211\u4eec\u679a\u4e3e $x-y$\u3002\n\n\u6709\u4e86 $x+y=n-i$\uff0c$x-y=j$\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u89e3\u51fa $x,y$\u3002\n\n\u90a3\u4e48\u8981\u4fdd\u8bc1\u201c\u4efb\u610f\u65f6\u523b\u90fd\u80fd\u627e\u96f6\u201d\uff0c\u5c31\u9700\u8981\u4fdd\u8bc1\u4efb\u610f\u65f6\u523b\u7b2c\u4e8c\u7c7b\u4eba\u7684\u6570\u91cf\u90fd\u5c0f\u4e8e\u7b2c\u4e00\u7c7b\u7684\uff08\u5426\u5219\u6ca1\u6709\u90a3\u4e48\u591a 50\uff0c\u627e\u4e0d\u8fc7\u6765\uff09\u3002\n\n\u6839\u636e[\u5361\u7279\u5170\u6570](https://cn.bing.com/search?q=%E5%8D%A1%E7%89%B9%E5%85%B0%E6%95%B0&form=ANNTH1&refig=23ec0e536dbc43b297cc39bce4920b3a&sp=1&lq=0&qs=SC&pq=%E5%8D%A1%E7%89%B9%E5%85%B0%E6%95%B0&sc=10-4&cvid=23ec0e536dbc43b297cc39bce4920b3a)\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u5f53\u7b2c\u4e00\u7c7b\u4eba\u6570\u4e3a $x$\uff0c\u7b2c\u4e8c\u7c7b\u4eba\u6570\u4e3a $y$ \u65f6\u6b64\u65f6\u7684\u516c\u5f0f\uff1a\n\n$C_{x+y}^{x}-C_{x+y}^{x+1}$\u3002\n\n\u5c06 $x,y$ \u7528 $i,j$ \u8868\u793a\uff1a\n\n$C_{n-i}^{(n-i+j)\\div 2}-C_{n-i}^{(n-i+j)\\div 2+1}$\u3002\n\n\u590d\u6742\u5ea6 $O(n\\times (R-L))$\u3002\n\n\u6ce8\u610f\u8981\u4fdd\u8bc1 $n-i+j$ \u662f\u4e2a\u5076\u6570\u3002\n\n## PART 3\n\n\u8003\u8651\u6bcf\u6b21\u679a\u4e3e $j$ \u7684\u65f6\u5019\uff0c\u6709\u4e9b $C$ \u662f\u4f1a\u88ab\u7ea6\u6389\u7684\u3002\n\n\u6bd4\u5982\u8bf4\u5f53 $n-i=6,L=2,R=9$ \u65f6\uff0c\u7b54\u6848\u5c31\u662f\n\n$C_6^4-C_6^5+C_6^5-C_6^6+C_6^6-C_6^7$\u3002\n\n\u53d1\u73b0 $C_6^5,C_6^6$ \u88ab\u7ea6\u6389\u4e86\u3002\n\n\u6240\u4ee5\u8fd9\u5806\u67ff\u5b50\u5176\u5b9e\u5c31\u662f $C_6^4-C_6^7$\uff0c\n\n\u4e5f\u5c31\u662f $C_{n-i}^{(n-i+l)\\div 2}-C_{n-i}^{(n-i+r)\\div 2+1}$\u3002\n\n\u5176\u4e2d $l$ \u662f\u5927\u4e8e $L$ \u4e14\u4e0e $n-i$ \u540c\u5947\u5076\u6027\u7684\u6570\u4e2d\u6700\u5c0f\u7684\uff0c$r$ \u662f\u5c0f\u4e8e $R$ \u4e14\u4e0e $n-i$ \u540c\u5947\u5076\u6027\u7684\u6570\u4e2d\u6700\u5927\u7684\u3002\n\n\u6574\u7406\uff0c\u5f97\u51fa\u7b54\u6848\uff1a\n\n$ans=\\sum_{i=0}^n C_{n-i}^{(n-i+l)\\div 2}-C_{n-i}^{(n-i+r)\\div2 +1}$\u3002\n\n## PART 4\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u91cc\u7684 $p$ \u4e0d\u662f\u8d28\u6570\uff0c\u76f4\u63a5\u8ba1\u7b97\u9006\u5143\u663e\u7136\u662f\u884c\u4e0d\u901a\u7684\u3002\n\n\u8003\u8651\u5bf9 $p$ \u5206\u89e3\u8d28\u56e0\u6570\uff1a\n\n$p=pr_1^{r_1}\\times pr_2^{r_2}\\times ....$\n\n$pr_i$ \u662f $p$ \u7684\u7b2c $i$ \u4e2a\u8d28\u56e0\u6570\uff0c**\u4e0b\u6587\u540c\u7406**\u3002\n\n\u518d\u5c06\u6bcf\u6b21\u8981\u7b97\u7684 $\\dfrac{n!}{m!}$ \u5206\u89e3\u8d28\u56e0\u6570\uff1a\n\n$\\dfrac{n!}{m!}$\n\n$=\\dfrac{k\\times pr_1^{x_1}\\times pr_2^{x_2}\\times ....}{s\\times pr_1^{y_1}\\times pr_2^{y_2}\\times ....}$\n\n$=\\dfrac{k}{s}\\times pr_1^{x_1-y_1}\\times pr_2^{x_2-y_2}\\times ....$\n\n\u7531\u4e8e $k,s$ \u662f $n,m$ \u69a8\u5e72\u4e86\u6240\u6709 $p$ \u7684\u8d28\u56e0\u5b50\u4e4b\u540e\u7684~~\u6b8b\u6e23~~\uff0c\u6240\u4ee5\u5b83\u4eec\u4e00\u5b9a\u4e0e $p$ \u4e92\u8d28\uff0c\u76f4\u63a5\u7b97\u9006\u5143\u5c31\u597d\u3002\n\n\u63a5\u7740\u6211\u4eec\u8bbe $r_{i,j}$ \u8868\u793a $i!$ \u4e2d\u542b $pr_j$ \u7684\u4e2a\u6570\uff0c\u53ef\u4ee5 $O(n)$ \u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u9636\u4e58\u4e5f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u201c\u9636\u4e58\u201d\u9012\u63a8\u5f0f\u4e0d\u662f ``fac[i]=fac[i-1]*i`` \u800c\u662f ``fac[i]=fac[i-1]*k``\uff0c\u5176\u4e2d $k$ \u662f **$i$ \u9664\u53bb\u6240\u6709 $p$ \u7684\u8d28\u56e0\u5b50\u4e4b\u540e\u7684\u90a3\u4e2a\u6b8b\u6e23**\u3002\n\n\u540c\u65f6\u4e5f\u6ce8\u610f\uff0c\u7531\u4e8e $p$ \u4e0d\u662f\u8d28\u6570\uff0c\u6240\u4ee5 $inv_i=i^{\\varphi(p)-1}$\u3002\n\n## PART 5\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 100001\n#define int long long\nint r[N][21],pr[21],fac[N],inv[N];\nint n,i,j,k,s,x,y,L,R,cnt,phi,mod;\nbool is[N];\nint qm_n(int a,int b)\n{\n\tint ans=1;\n\twhile(b)\n\t{\n\t\tif(b&1)ans=ans*a%mod;\n\t\ta=a*a%mod;b>>=1;\n\t}\n\treturn ans%mod;\n}\nvoid init()\n{\n\tint tmp;\n\tfac[0]=inv[0]=1;//\u540c\u65f6\u53ef\u4ee5\u9884\u5904\u7406\u9006\u5143\n\ttmp=phi=mod;\n\tfor(i=2;i*i<=tmp;i++)\n\t{\n\t\tif(tmp%i==0)pr[++cnt]=i,phi=phi*(i-1)/i;\n\t\twhile(tmp%i==0) tmp/=i;\n\t}//\u7b97\u8d28\u56e0\u5b50\u53ca\u6b27\u62c9\u51fd\u6570\n\tif(tmp>1)pr[++cnt]=tmp,phi=phi*(tmp-1)/tmp;\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tk=i;\n\t\tfor(j=1;j<=cnt;j++)\n\t\t{\n\t\t\tr[i][j]=r[i-1][j];//\u521d\u59cb\u5316\n\t\t\twhile(k%pr[j]==0) k/=pr[j],r[i][j]++;//\u8ba1\u7b97\u6b64\u65f6\u7684i\u5305\u542b\u4e86\u51e0\u4e2a\u5f53\u524d\u7684\u8d28\u56e0\u5b50\u5e76\u52a0\u4e0a\n\t\t}\n\t\tfac[i]=fac[i-1]*k%mod;\n\t\tinv[i]=qm_n(fac[i],phi-1);//\u6309\u7167\u4e0a\u6587\u8ba1\u7b97\u9636\u4e58\u53ca\u9006\u5143\n\t}\n}\nint C(int n,int m)\n{\n\tif(n<m)return 0;\n\tif(!m)return 1;\n\tint ans=fac[n]*inv[m]%mod*inv[n-m]%mod;//\u5148\u8ba1\u7b97\u524d\u9762\u7684\u90e8\u5206\n\tfor(int i=1;i<=cnt;i++)\n\t\tans=ans*qm_n(pr[i],r[n][i]-r[m][i]-r[n-m][i])%mod;//\u518d\u628a\u8d28\u56e0\u6570\u90e8\u5206\u52a0\u4e0a\n\treturn ans;\n}\nsigned main()\n{\n\tscanf(\"%lld%lld%lld%lld\",&n,&mod,&L,&R);\n\tinit();s=0;\n\tfor(i=0;i<=n;i++)\n\t{\n\t\tk=n-i;\n\t\tx=L+((k&1)==(L&1) ? 0:1);\n\t\ty=R-((k&1)==(R&1) ? 0:1);//\u8ba1\u7b97\u6700\u5c0f\u4e0e\u6700\u5927\u7684\u53ef\u53d6\u7684j\n\t\ts=(s+(C(k,k+x>>1)-C(k,(k+y>>1)+1)+mod)*C(n,i)%mod)%mod;\n\t}\n\tprintf(\"%lld\",s);\n\treturn 0;\n}\n```",
        "postTime": 1679297808,
        "uid": 643735,
        "name": "RNTBW",
        "ccfLevel": 0,
        "title": "CF896D-solution"
    },
    {
        "content": "## CF896D Nephren Runs a Cinema\n\n### \u9898\u610f\n\n\u552e\u7968\u5458\u6700\u5f00\u59cb\u6ca1\u6709\u7eb8\u5e01\uff0c\u6bcf\u6b21\u6765\u4e00\u4e2a\u987e\u5ba2\u53ef\u4ee5\u7ed9\u5979\u4e00\u5f20\u3001\u62ff\u8d70\u5979\u4e00\u5f20\u6216\u4e0d\u64cd\u4f5c\u3002\u6c42\u51fa\u4e0d\u51fa\u73b0\u4e2d\u9014\u6ca1\u94b1\u7ed9\u7684\u60c5\u51b5 $n$ \u540d\u987e\u5ba2\u540e\u5269\u4f59\u94b1\u6570\u5728 $l\\sim r$ \u7684\u65b9\u6848\u6570\u3002\n\n### \u601d\u8def\n\n\u8fd9\u662f\u6211\u4eec\u4e00\u9053\u6a21\u62df\u8d5b\u9898\u3002\n\n\u89e3\u6cd5 1\uff1a\u5957\u8def\u7ec4\u5408\u8ba1\u6570\u3002\u5148\u4e0d\u8003\u8651\u4e0d\u64cd\u4f5c\u7684\u987e\u5ba2\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u662f\u6c42\u4e8c\u7ef4\u5e73\u9762\u4e0d\u8fc7\u4e00\u6761\u76f4\u7ebf\u5230\u8fbe\u4e00\u70b9\u7684\u65b9\u6848\u6570\u3002\u76f4\u63a5\u679a\u4e3e\u64cd\u4f5c\u987e\u5ba2\u6570\uff0c\u7528\u7ec4\u5408\u6570\u51cf\u53bb\u53e6\u5916\u4e00\u4e2a\u7ec4\u5408\u6570\u7136\u540e\u4e58\u4e0a\u6240\u6709\u987e\u5ba2\u4e2d\u9009\u8fd9\u4e9b\u987e\u5ba2\u7684\u65b9\u6848\u6570\u5373\u53ef\u3002\n\n\u89e3\u6cd5 2\uff1a\u66b4\u529b\u52a8\u6001\u89c4\u5212\u3002\u6bcf\u6b21\u4ece\u81f3\u591a\u4e09\u4e2a\u65b9\u5411\u8f6c\u79fb\u3002\n\n\u8d5b\u65f6\u6211\u5148\u60f3\u5230\u7b2c\u4e00\u4e2a\u89e3\u6cd5\u4f46\u662f\u6ca1\u60f3\u5230\u679a\u4e3e\u64cd\u4f5c\u4eba\u6570\uff0c\u4ee5\u4e3a\u4e0d\u53ef\u505a\uff0c\u4e8e\u662f\u60f3\u5230\u4e86\u4f18\u5316\u66b4\u529b\u7684\u89e3\u6cd5\u3002\n\n**\u89e3\u6cd5 3**\uff1a\u89e3\u6cd5 2 \u7684\u4f18\u5316\u3002\u6c42\u51fa $F=(x^{-1}+1+x)^n$ \uff0c\u7136\u540e $f(x)-f(x+2)$ \u7684\u7b2c $l \\sim r$ \u9879\u7684\u548c\u5373\u4e3a\u7b54\u6848\u3002\n\n$(x^{-1}+1+x)$ \u8868\u793a\u4e09\u79cd\u8f6c\u79fb\u65b9\u5f0f\uff0c\u4f46\u662f\u6c42\u51fa\u6765\u7684 $F$ \u663e\u7136\u4e0d\u662f\u6b63\u786e\u7b54\u6848\uff0c\u56e0\u4e3a\u4f1a\u6709\u4ece\u8d1f\u6570\u5e42\u7684\u8d21\u732e\u662f\u5e94\u8be5\u51cf\u6389\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u8003\u8651\u51cf\u6389\u5b83\uff0c\u5b9e\u9645\u4e0a\u548c\u89e3\u6cd5\u4e00\u76f8\u540c\uff0c$f(x)-f(x+2)$ \u76f8\u5f53\u4e8e\u51cf\u53bb\u4e86\u9519\u89e3\uff0c\u90a3\u4e48\u51cf\u5b8c\u4e4b\u540e\u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n\u56e0\u4e3a\u6bcf\u6b21\u8981\u500d\u957f\u591a\u9879\u5f0f\uff0c\u4f7f\u7528\u5feb\u901f\u5e42\u4e00\u6837\u7684\u65b9\u5f0f\u5377\u5c31\u53ef\u4ee5\u4e86\u3002\u6839\u636e\u4e3b\u5b9a\u7406\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u8003\u573a\u4e0a\u6709\u90e8\u5206\u5206\uff0c\u6a21\u6570\u4e3a $998244353$\uff0c\u90a3\u4e48\u6b63\u89e3\u53ea\u9700\u8981\u6539\u6210\u4efb\u610f\u6a21\u6570\u591a\u9879\u5f0f\u4e58\u6cd5\u5c31\u884c\u4e86\u3002\n\n### \u4ee3\u7801\n\n\u6ce8\u610f\uff0c\u6b64\u4ee3\u7801\u4e0d\u53ef AC \u6b64\u9898\uff0c\u4ec5\u5728\u6a21\u6570\u4e3a $998244353$ \u65f6\u6b63\u786e\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<cctype>\n#include<cstdlib>\nusing namespace std;\ninline int read(){\n\tint x=0,w=0;char c=getchar();\n\twhile(!isdigit(c)) w|=c=='-',c=getchar();\n\twhile(isdigit(c)) x=x*10+(c^48),c=getchar();\n\treturn w?-x:x;\n}\nnamespace star\n{\n\tconst int maxn=2e6+10,mod=998244353,ge=3,gi=998244354/3;\n\tinline int fpow(int a,int b){int ans=1;for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;return ans;}\n\tstruct NTT{\n\t\tint r[maxn],lim;\n\t\tinline void getr(int li){lim=li;for(int i=0;i<lim;i++) r[i]=(r[i>>1]>>1)|((i&1)*(lim>>1));}\n\t\tinline void operator () (int *a,int type) const {\n\t\t\tfor(int i=0;i<lim;i++) if(i<r[i]) swap(a[i],a[r[i]]);\n\t\t\tfor(int mid=1;mid<lim;mid<<=1){\n\t\t\t\tint rt=fpow(type==1?ge:gi,(mod-1)/(mid<<1));\n\t\t\t\tfor(int r=mid<<1,j=0;j<lim;j+=r){\n\t\t\t\t\tint p=1;\n\t\t\t\t\tfor(int k=0;k<mid;k++,p=1ll*p*rt%mod){\n\t\t\t\t\t\tint x=a[j+k],y=1ll*p*a[j+k+mid]%mod;\n\t\t\t\t\t\ta[j+k]=(x+y)%mod,a[j+k+mid]=(x-y+mod)%mod;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(type==-1) for(int p=fpow(lim,mod-2),i=0;i<lim;i++) a[i]=1ll*a[i]*p%mod;\n\t\t}\n\t}ntt;\n\tint n;\n\tint a[maxn],ans[maxn];\n\tinline void work(){\n\t\tn=read();read();\n\t\tint Lim=4,lim=2;\n\t\ta[0]=a[1]=a[2]=ans[0]=1;\n\t\tint x=n,Len=3,len=1;\n\t\twhile(x){\n\t\t\tstatic int res[maxn],tmp[maxn];\n\t\t\tif(x&1){\n\t\t\t\tfor(int i=0;i<Lim;i++) res[i]=a[i];\n\t\t\t\tfor(int i=Lim;i<Lim+lim;i++) res[i]=0;\n\t\t\t\tfor(int i=0;i<lim;i++) tmp[i]=ans[i];\n\t\t\t\tfor(int i=lim;i<Lim+lim;i++) tmp[i]=0;\n\t\t\t\tlen+=Len;lim=Lim;\n\t\t\t\twhile(lim<len) lim<<=1;\n\t\t\t\tntt.getr(lim<<1);\n\t\t\t\tntt(res,1),ntt(tmp,1);\n\t\t\t\tfor(int i=0;i<lim<<1;i++) tmp[i]=1ll*res[i]*tmp[i]%mod;\n\t\t\t\tntt(tmp,-1);\n\t\t\t\tfor(int i=0;i<lim;i++) ans[i]=tmp[i];\n\t\t\t}\n\t\t\tfor(int i=0;i<Lim;i++) res[i]=a[i];\n\t\t\tfor(int i=Lim;i<Lim<<1;i++) res[i]=0;\n\t\t\tLim<<=1;Len<<=1;\n\t\t\tfor(int i=Lim;i<Lim<<1;i++) res[i]=0;\n\t\t\tntt.getr(Lim<<1);\n\t\t\tntt(res,1);\n\t\t\tfor(int i=0;i<Lim<<1;i++) res[i]=1ll*res[i]*res[i]%mod;\n\t\t\tntt(res,-1);\n\t\t\tfor(int i=0;i<Lim;i++) a[i]=res[i];\n\t\t\tx>>=1;\n\t\t}\n\t\tint l=read(),r=read();\n\t\tfor(int i=n;i<n<<1;i++) ans[i]=(ans[i]-ans[i+2]+mod)%mod;\n\t\tint Ans=0;\n\t\tfor(int i=n+l;i<=n+r;i++) Ans=(Ans+ans[i])%mod;\n\t\tprintf(\"%d\\n\",Ans);\n\t}\n}\nsigned main(){\n\tstar::work();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1615430071,
        "uid": 280015,
        "name": "Star_Cried",
        "ccfLevel": 9,
        "title": "CF896D Nephren Runs a Cinema"
    }
]