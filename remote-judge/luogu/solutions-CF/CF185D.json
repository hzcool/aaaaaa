[
    {
        "content": "[CF185D Visit of the Great](https://www.luogu.com.cn/problem/CF185D)\u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/xiaoziyao/p/15237270.html)\n\n## \u9898\u610f\n\n$T$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u5b9a $k,l,r,p$\uff0c\u6c42 $\\text{lcm}(k^{2^l}+1,k^{2^{l+1}}+1,\\cdots,k^{2^r}+1)\\bmod p$\u3002\n\n$1\\leqslant T\\leqslant 10^5,1\\leqslant k\\leqslant 10^6,0\\leqslant l\\leqslant r\\leqslant 10^{18},2\\leqslant p\\leqslant 10^9$\uff0c\u4fdd\u8bc1 $p$ \u662f\u8d28\u6570\u3002\n\n## \u5206\u6790\n\n\u5c0f\u6e05\u65b0\u6570\u8bba\u9898\u3002\n\n\u6211\u4eec\u7b80\u5355\u731c\u4e2a\u7ed3\u8bba\uff0c\u4efb\u610f\u4e24\u4e2a\u6570\u7684 $\\gcd$ \u90fd\u4e0d\u4f1a\u5f88\u5927\u3002\u53d6\u4efb\u610f\u4e24\u4e2a\u4f4d\u7f6e $a,b(a<b)$\uff0c\u8bbe $\\gcd(k^{2^a}+1,k^{2^b}+1)=d$\uff1a\n\n$$k^{2^a}\\equiv k^{2^b}\\equiv -1\\pmod d\\\\1\\equiv(-1)^{2^{b-a}}\\equiv (k^{2^{a}})^{2^{b-a}}\\equiv k^{2^b}\\equiv -1\\pmod d$$\n\n\u4e8e\u662f $d=1$ \u6216 $2$\uff0c\u4e14 $d=2$ \u5f53\u4e14\u4ec5\u5f53 $k$ \u4e3a\u5947\u6570\u3002\n\n\u8bbe $t=\\prod_{i=l}^r(k^{2^t}+1)$\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\begin{cases}\\frac{t}{2^{r-l}}&k\\equiv1\\pmod 2\\\\t&k\\equiv 0\\pmod 2\\end{cases}$$\n\n\u90a3\u4e48\u6211\u4eec\u8f6c\u6c42 $t$ \u7684\u503c\uff0c\u8003\u8651\u76f4\u63a5\u63a8\u5f0f\u5b50\uff1a\n\n$$(k^{2^l}+1)((k^{2^l})^2+1)((k^{2^l})^4+1)\\cdots((k^{2^l})^{2^{r-l}}+1)\\\\=\\sum_{p=0}^{2^{r-l+1}-1}(k^{2^l})^p=\\frac{(k^{2^l})^{2^{r-l+1}}-1}{k^{2^l}-1}=\\frac{k^{2^{r+1}}-1}{k^{2^l}-1}$$\n\n\u7136\u540e\u76f4\u63a5\u7b97\u5c31\u597d\u4e86\uff0c\u6ce8\u610f\u7279\u5224 $k^{2^l}\\equiv 1\\pmod p$ \u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u4e0a\u5f0f\u7684\u503c\u4e3a\uff1a\n\n$$(1+1)(1^2+1)(1^4+1)\\cdots(1^{2^{r-l}}+1)=2^{r-l+1}$$\n\n## \u4ee3\u7801\n\n```\n#include<stdio.h>\nint T,k,p;\nlong long l,r;\nint ksm(int a,long long b,int mod){\n\tint res=1;\n\twhile(b){\n\t\tif(b&1)\n\t\t\tres=1ll*res*a%mod;\n\t\ta=1ll*a*a%mod,b>>=1;\n\t}\n\treturn res;\n}\nint f(long long x){\n\treturn k%p==0? 0:ksm(k,ksm(2,x,p-1),p);\n}\nint main(){\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%d%lld%lld%d\",&k,&l,&r,&p);\n\t\tif(p==2)\n\t\t\tprintf(\"%d\\n\",(k&1)^1);\n\t\telse{\n\t\t\tint ans=(f(l)==1? ksm(2,r-l+1,p):(1ll*(f(r+1)-1+p)%p*ksm((f(l)-1+p)%p,p-2,p)%p));\n\t\t\tif(k&1)\n\t\t\t\tans=1ll*ans*ksm(ksm(2,r-l,p),p-2,p)%p;\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1630990374,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF185D\u3010Visit of the Great\u3011"
    },
    {
        "content": "**\u5f15\u7406 1**\uff1a\u82e5 $k,x,y,d\\in \\mathbb N,x\\neq y$\uff0c\u6ee1\u8db3 $d\\mid \\left(k^{2^{x}}+1\\right),d\\mid \\left(k^{2^y}+1\\right)$\uff0c\u5219 $d = 1$ \u6216 $2$.\n\n**\u8bc1\u660e**\uff1a\u4e0d\u59a8\u8bbe $x<y$\uff0c\u5219\uff1a\n\n$$\n\\begin{aligned}\n& k^{2^x}\\equiv k^{2^y}\\equiv - 1\\pmod d\\\\\n\\Rightarrow & \\left(k^{2^x}\\right)^{2^{y-x}}\\equiv (-1)^{2^{y-x}}\\equiv 1 \\equiv - 1 \\pmod d\n\\end{aligned}\n$$\n\n\u6240\u4ee5\u6709 $d = 1$ \u6216 $2$.\n\n**\u5f15\u7406 2**\uff1a\u82e5 $k,x,t\\in \\mathbb N$\uff0c$x\\neq 0$\uff0c\u6ee1\u8db3 $2^t\\mid \\left(k^{2^x} + 1\\right)$\uff0c\u5219 $t = 0$ \u6216 $1$.\n\n**\u8bc1\u660e**\uff1a\u5373\u8bc1 $4\\nmid \\left(k^{2^x}+1\\right)$\uff0c\u5373 $\\left(k^{2^{x-1}}\\right)^2\\equiv -1\\pmod 4$\uff0c\u663e\u7136\u4efb\u4f55\u5b8c\u5168\u5e73\u65b9\u6570\u6a21 $4$ \u5f97 $0$ \u6216 $1$\uff0c\u6240\u4ee5\u4e0d\u53ef\u80fd\u3002\n\n\u4e8e\u662f\u7b54\u6848\u53ef\u4ee5\u53d8\u4e3a\u7ed9\u51fa\u7684\u6570\u4e58\u79ef\u7684\u5f62\u5f0f\uff0c\u7136\u540e\u9664\u6389\u4e00\u4e2a\u4e8c\u7684\u82e5\u5e72\u6b21\u5e42\u3002\n\n\u518d\u5bb9\u6613\u53d1\u73b0\u7ed9\u51fa\u7684\u6570\u4e58\u79ef\u76f8\u5f53\u4e8e\u679a\u4e3e\u6307\u6570\u4e0a\u7684\u6570\u4e8c\u8fdb\u5236\u4e0b\u7684\u6bcf\u4e2a\u4f4d\u662f\u5426\u4e3a $1$\uff0c\u4e8e\u662f\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u7b49\u6bd4\u6570\u5217\uff0c\u7136\u540e\u7b54\u6848\u5c31\u5f88\u597d\u6c42\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(t\\log p)$.\n\n[\u4ee3\u7801](https://codeforces.com/contest/185/submission/123078400)",
        "postTime": 1626764832,
        "uid": 34238,
        "name": "zhylj",
        "ccfLevel": 9,
        "title": "CF185D Visit of the Great"
    },
    {
        "content": "\u7b80\u5355\u63d0\u4e00\u4e0b\u505a\u6cd5\uff0c\u6ce8\u610f\u5230 $k^{2^a}\\equiv k^{2^b}\\equiv-1\\equiv (-1)^{2^{b-a}}\\equiv1\\pmod{(k^{2^a}+1,k^{2^{b}}+1)}$\uff0c\u6240\u4ee5 $\\gcd$ \u53ea\u4f1a\u662f $1$ \u6216 $2^{r-l}$\uff0c\u53d6\u51b3\u4e8e $k$ \u7684\u5947\u5076\u6027\uff0c\u4e8e\u662f\u6c42\u4e00\u4e2a product \u5373\u53ef\u3002\n\n\u63a5\u4e0b\u6765\u662f\u8fd9\u7bc7\u9898\u89e3\u7684\u91cd\u70b9\uff0c\u805a\u7126 $\\displaystyle \\prod\\left(k^{2^i}+1\\right)=\\sum_{i=0}^{2^{r-l+1}-1}\\left(k^{2^l}\\right)^i$ \u505a\u8865\u5145\u3002\n\n\u4e0d\u59a8\u4ece\u4e8c\u9879\u5f0f\u4e58\u6cd5\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u4e3e\u4f8b $\\left(k^{2^i}+1\\right)\\left(k^{2^j}+1\\right)\\left(k^{2^w}+1\\right)$\uff0c\u4e0d\u59a8\u5c06 $k^{2^x}$ \u770b\u4f5c\u662f\u9009\u62e9\uff0c\u5c06 $1$ \u770b\u4f5c\u662f\u4e0d\u9009\u62e9\uff0c\u90a3\u4e48\u4e00\u4e2a\u957f\u5ea6\u4e3a $r-l+1$ \u7684\u4e8c\u8fdb\u5236\u6570\u5373\u53ef\u8868\u793a\u51fa\u8fd9\u4e2a\u4e58\u79ef\u6240\u6709\u7684\u72b6\u6001\uff0c\u4e0d\u59a8\u8bbe\u8fd9\u4e2a\u72b6\u6001\u4e3a $S$\uff0c\u6ce8\u610f\u5230 $S$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f\u5728\u505a\u52a0\u6cd5\uff0c\u5e76\u4e14\u56e0\u4e3a\u7c7b\u4f3c $2^i+2^j+2^w$ \u7684\u6307\u6570\u76f8\u52a0\u6b63\u597d\u53ef\u4ee5\u51d1\u51fa $S$\uff0c\u6240\u4ee5 $S$ \u7684\u8d21\u732e\u5c31\u662f $\\left(k^{2^l}\\right)^S$\uff0c\u5f97\u8bc1\u3002\n\n```cpp\nvoid executer() {\n    int k, p;\n    LL l, r;\n    cin >> k >> l >> r >> p;\n    SetMod(p-1);\n    int e = qpow(2, l), e2 = qpow(2, r-l+1);\n    SetMod(p);\n    int K = k%p ? qpow(k, e) : 0, ans;\n    if (K == 0) {\n        ans = 1;\n    }\n    else {\n        if (K == 1) {\n            ans = qpow(2, r-l+1);\n        }\n        else {\n            ans = mul(sub(qpow(K, e2), 1), inv(sub(K, 1)));\n        }\n    }\n    if (k%2) {\n        mul_eq(ans, inv(qpow(2, r-l)));\n    }\n    cout << ans << \"\\n\";\n}\n```",
        "postTime": 1657598197,
        "uid": 161849,
        "name": "cirnovsky",
        "ccfLevel": 6,
        "title": "Kidulthood \u4f60\u540d\u5b57\u8fd9\u4e48\u5199\u554a"
    },
    {
        "content": "## \u5206\u6790\n\n\u9996\u5148\uff0c\u9898\u76ee\u8981\u6c42 $\\operatorname{lcm}$\uff0c\u8003\u8651\u5148\u7b97 $\\gcd$\u3002\n\n$$\n\\begin{aligned}\n\\gcd(k^{2^i}+1,k^{2^j}+1)=&\\gcd(k^{2^i}+1,k^{2^i}\\times(k^{2^j-2^i}-1))\\\\\n=&\\gcd(k^{2^i}+1,k^{2^i}\\times(k^{2^j-2^{i+1}}+1))\\\\\n=&\\ldots\\\\\n=&\\gcd(k^{2^i}+1,k^0+1)\\\\\n=&\\left\\{\n\\begin{array}{l}\n2,2\\nmid k\\\\\n1,2\\mid k\n\\end{array}\n\\right.\n\\end{aligned}\n$$\n\n\u6240\u4ee5\uff0c\u8bbe $M=\\prod_{i=l}^r(k^{2^i}+1)$\uff0c\u5219\n\n$$\n\\operatorname{lcm}(k^{2^l}+1,k^{2^{l+1}}+1,\\ldots k^{2^r}+1)=\\left\\{\n\\begin{array}{l}\nM,2\\mid k\\\\\n\\frac{M}{2^{r-l}},2\\nmid k\n\\end{array}\n\\right.\n$$\n\n\u53ea\u9700\u8981\u6c42 $M$\u3002\u8bbe $K=k^{2^l}$\uff0c\u5219\n\n$$\nM=\\sum_{i=0}^{2^{r-l+1}-1}K^i=\\left\\{\n\\begin{array}{l}\n2^{r-l+1},K\\equiv1\\pmod p\\\\\n\\frac{K^{2^{r-l+1}}-1}{K-1},K\\not\\equiv1\\pmod p\n\\end{array}\n\\right.\n$$\n\n\u8981\u7528\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff0c\u6240\u4ee5\u8fd8\u8981\u7279\u5224 $p\\mid k$ \u7684\u60c5\u51b5\u3002\n\n## \u5b9e\u73b0\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#define LL long long\n#define TO static_cast\n\nusing namespace std;\n\nint power(int a, LL b, int p) {\n  int ans = 1;\n  for (int i = a; b; i = TO<LL>(i) * i % p, b >>= 1)\n    if (b & 1) ans = TO<LL>(ans) * i % p;\n  return ans;\n}\n\ntemplate <typename T>\nvoid read(T &ret) {\n  ret = 0;\n  char ch = getchar();\n  while (!isdigit(ch) && ch != '-') ch = getchar();\n  bool vis = ch == '-' && (ch = getchar());\n  while (isdigit(ch)) ret = ret * 10 + ch - '0', ch = getchar();\n  if (vis) ret = -ret;\n}\n\ntemplate <typename T, typename... Args>\nvoid read(T &ret, Args &...rest) {\n  read(ret), read(rest...);\n}\n\nvoid test_case() {\n  int k, p;\n  LL l, r;\n  read(k, l, r, p);\n  int K = k % p == 0 ? 0 : power(k, power(2, l, p - 1), p);\n  int ans = K == 0   ? 1\n            : K == 1 ? power(2, r - l + 1, p)\n                     : TO<LL>(power(K, power(2, r - l + 1, p - 1), p) - 1) *\n                           power(K - 1, p - 2, p) % p;\n  if (k & 1) ans = TO<LL>(ans) * power(power(2, r - l, p), p - 2, p) % p;\n  printf(\"%d\\n\", ans);\n}\n\nint main() {\n  int T;\n  cin >> T;\n  while (T--) test_case();\n  return 0;\n}\n```",
        "postTime": 1640943485,
        "uid": 253946,
        "name": "ClHg2",
        "ccfLevel": 7,
        "title": "\u300e\u9898\u89e3\u300fVisit Of The Great"
    }
]