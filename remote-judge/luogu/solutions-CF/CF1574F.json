[
    {
        "content": "# CF1574F Occurrences\n\n## \u9898\u610f\n\n\u5b9a\u4e49 $a$ \u7684\u5b50\u5e8f\u5217\u662f $[a_l,a_{l+1},\\cdots,a_r]$ \u6784\u6210\u7684\u5e8f\u5217\uff0c\u5b9a\u4e49 $a$ \u5e8f\u5217\u5728 $b$ \u5e8f\u5217\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u4e3a $b$ \u5e8f\u5217\u4e2d\u4e0e $a$ \u76f8\u540c\u7684\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\n\n\u6709 $n$ \u4e2a\u503c\u57df\u5728 $[1,k]$ \u7684\u6570\u5217 $A_1,A_2,\\cdots,A_n$\uff0c\u8981\u6c42\u6784\u9020\u4e00\u4e2a\u957f\u4e3a $m$ \u7684\u5e8f\u5217 $a$\uff0c\u6ee1\u8db3\u5bf9\u4e8e\u6240\u6709\u6570\u5217 $A_i$\uff0c$A_i$ \u5728\u5e8f\u5217 $a$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e\u5176\u4efb\u610f\u4e00\u4e2a\u975e\u7a7a\u5b50\u5e8f\u5217\u5728 $a$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u6c42\u4e0d\u540c\u7684 $a$ \u7684\u6570\u91cf\uff0c\u7b54\u6848 $\\bmod 998244353$\u3002\n\n**\u6570\u636e\u8303\u56f4**\uff1a$1\\le n,m,k\\le 3\\times 10^5,\\sum c_i\\le 3\\times 10^5$\u3002\n\n## \u9898\u89e3\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5982\u679c $a$ \u4e2d\u5305\u542b\u4e86 $A_i$ \u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5143\u7d20\uff0c\u4e00\u5b9a\u9700\u8981\u628a $A_i$ \u5168\u90e8\u586b\u5b8c\uff0c\u800c\u4e14\u5fc5\u987b\u4e25\u683c\u6309\u7167 $A_i$ \u91cc\u7684\u987a\u5e8f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u628a\u76f8\u90bb\u5143\u7d20\u8fde\u6709\u5411\u8fb9\u7684\u8bdd\uff0c\u6211\u4eec\u8981\u628a $A_i$ \u6784\u6210\u7684\u94fe\u5168\u90e8\u586b\u8fdb\u53bb\u3002\n\n\u5176\u6b21\uff0c\u6211\u4eec\u586b\u5b8c $A_i$ \u4e4b\u540e\uff0c$A_i$ \u4e2d\u53ef\u80fd\u8fd8\u5305\u542b $A_j$ \u4e2d\u7684\u5143\u7d20\uff0c$A_j$ \u4e5f\u9700\u8981\u586b\u5b8c\uff0c\u800c\u4e14\u662f\u5bf9\u4f4d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u628a $A_i$ \u7684\u94fe\u548c $A_j$ \u7684\u94fe\u5408\u6210\u5728\u4e00\u8d77\u3002\u4f8b\u5982 $3\\ 4\\ 1\\ 2 $ \u548c $1\\ 2\\ 6$\uff0c\u4ed6\u4eec\u4f1a\u53d8\u6210\u4e00\u6761\u65b0\u7684\u94fe\uff1a$3\\ 4\\ 1\\ 2\\ 6$\u3002\n\n\u5f53\u7136\uff0c\u8fd9\u6761\u94fe\u4e0a\u5fc5\u987b\u4e0d\u80fd\u5305\u542b\u73af\uff0c\u4f8b\u5982 $1\\ 2\\ 1$\uff0c$1$ \u7684\u51fa\u73b0\u6c38\u8fdc\u5927\u4e8e $1\\ 2\\ 1$ \u7684\u51fa\u73b0\u6b21\u6570\u3002\u8fd9\u6761\u94fe\u4e5f\u4e0d\u80fd\u6709\u5206\u652f\uff0c\u4f8b\u5982 $1\\ 2\\ 3 $ \u548c $1\\ 2\\ 4$\uff0c\u4e0d\u7ba1\u600e\u4e48\u586b\uff0c\u603b\u4f1a\u628a\u4e00\u6761\u94fe\u65ad\u5f00\uff0c\u7136\u540e\u5c31\u4e0d\u6ee1\u8db3\u6761\u4ef6\u4e86\u3002\n\n\u6240\u4ee5\uff0c\u628a\u56fe\u5efa\u51fa\u6765\u4e4b\u540e\uff0c\u6bcf\u4e2a\u8fde\u901a\u5757\u5206\u522b\u8003\u8651\uff0c\u53ea\u6709\u8be5\u8fde\u901a\u5757\u662f\u4e00\u6761\u94fe\u7684\u65f6\u5019\u624d\u80fd\u88ab\u9009\uff0c\u6240\u5360\u7684\u957f\u5ea6\u662f\u8fde\u901a\u5757\u7684\u5927\u5c0f\uff08\u5143\u7d20\u4e2a\u6570\uff09\u3002\u800c\u4e0d\u540c\u7684\u8fde\u901a\u5757\u5927\u5c0f\u6700\u591a $O(\\sqrt k)$ \u4e2a\uff0c\u76f4\u63a5\u505a DP\uff0c\u679a\u4e3e\u6240\u6709\u80fd\u591f\u8f6c\u79fb\u7684\u957f\u5ea6\u3002\n\n\u5177\u4f53\u7684\uff0c\u8bb0 $g_i$ \u8868\u793a\u957f\u4e3a $i$ \u7684\u8f6c\u79fb\u6709\u591a\u5c11\u4e2a\u3002\n$$\nf_i=\\sum_{j=1}^{k}f_{i-k}\n$$\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(m\\sqrt k)$\n\n\u5177\u4f53\u7684\u5b9e\u73b0\u4e0a\uff0c\u4f7f\u7528\u5e76\u67e5\u96c6\uff0c\u7ef4\u62a4\u6bcf\u4e2a\u96c6\u5408\u7684 $size$ \u548c $tag$ \u8868\u793a\u8fd9\u4e2a\u96c6\u5408\u662f\u4e0d\u662f\u4e00\u6761\u94fe\u3002\u540c\u65f6\u7ef4\u62a4\u6bcf\u4e2a\u5143\u7d20\u7684\u524d\u9a71\u540e\u7ee7\uff0c\u5408\u5e76\u4e24\u6761\u94fe\u65f6\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u4e0e\u539f\u6765\u4e0d\u540c\u7684\u524d\u9a71\u6216\u8005\u540e\u7ee7\uff0c\u8bf4\u660e\u8fd9\u4e2a\u96c6\u5408\u7684\u94fe\u4ea7\u751f\u4e86\u5206\u652f\uff0c\u4e0d\u518d\u662f\u4e00\u6761\u94fe\uff1b\u5982\u679c\u8fde\u8fb9\u65f6\u4e24\u4e2a\u5143\u7d20\u5df2\u7ecf\u5728\u4e00\u4e2a\u96c6\u5408\uff0c\u90a3\u4e48\u8fd9\u4e2a\u96c6\u5408\u4f1a\u51fa\u73b0\u73af\uff0c\u4e5f\u4e0d\u518d\u662f\u4e00\u6761\u94fe\u3002\n\n\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N=3e5+5,mod=998244353;\ninline void Add(int &a,int b){a+=(a+b>=mod)?b-mod:b;}\nint fa[N],sz[N],to[N],a[N],n,m,k,pre[N],tag[N];\nint find_fa(int x){return fa[x]==x?x:fa[x]=find_fa(fa[x]);}\ninline void merge(int x,int y){\n\tint fy=find_fa(y),fx=find_fa(x);\n\tif(fy==fx){tag[fx]=1;return;}\n\tfa[fy]=fx;\n\tsz[fx]+=sz[fy];\n\ttag[fx]|=tag[fy];\n}\nint buc[N],tot,g[N],f[N];\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tfor(int i=1;i<=k;++i)fa[i]=i,sz[i]=1;\n\tfor(int i=1,c;i<=n;++i){\n\t\tscanf(\"%d\",&c);\n\t\tfor(int j=1;j<=c;++j){\n\t\t\tscanf(\"%d\",&a[j]);\n\t\t\tif(j==1)continue;\n\t\t\tif((pre[a[j]]&&pre[a[j]]!=a[j-1])||(to[a[j-1]]&&to[a[j-1]]!=a[j])){\n\t\t\t\tmerge(a[j-1],a[j]);\n\t\t\t\ttag[find_fa(a[j])]=1;\n\t\t\t}else if(!to[a[j-1]]){\n\t\t\t\tto[a[j-1]]=a[j];\n\t\t\t\tpre[a[j]]=a[j-1];\n\t\t\t\tmerge(a[j-1],a[j]);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=k;++i){\n\t\tif(find_fa(i)!=i||tag[i])continue;\n\t\t++g[sz[i]];\n\t}\n\tfor(int i=1;i<=k;++i)if(g[i])buc[++tot]=i;\n\tf[0]=1;\n\tfor(int i=0;i<=m;++i)\n\t\tfor(int j=1;j<=tot&&i+buc[j]<=m;++j)\n\t\t\tf[i+buc[j]]=(f[i+buc[j]]+1ll*f[i]*g[buc[j]])%mod;\n\tprintf(\"%d\\n\",f[m]);\n\treturn 0;\n}\n```",
        "postTime": 1632555357,
        "uid": 152128,
        "name": "harryzhr",
        "ccfLevel": 9,
        "title": "CF1574F Occurrences \u9898\u89e3"
    },
    {
        "content": "## \u524d\u8a00\n\u8fd9 F \u600e\u4e48\u6bd4 A \u8fd8\u7b80\u5355\u554a\uff1f\n## \u601d\u8def\n\u9996\u5148\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u5e8f\u5217 $a_1,a_2,\\cdots,a_n$ \u7684\u610f\u4e49\u5c31\u662f\u5bf9\u4e8e $i=1,2,\\cdots,n-1$\uff0c\u7b54\u6848\u4e2d\u7684 $a_1$ \u540e\u5fc5\u987b\u662f $a_2$\uff0c$a_2$ \u524d\u5fc5\u987b\u662f $a_1$\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u5982\u679c\u4e00\u4e2a\u6570\u7684\u540e\u7ee7\u6216\u8005\u524d\u9a71\u6709 $>1$ \u4e2a\u5c31\u4e0d\u80fd\u9009\u4e86\uff0c\u5982\u679c\u4e00\u4e2a\u6570\u7684\u82e5\u5e72\u524d\u9a71\u548c\u540e\u7ee7\u4e2d\u6709\u4e00\u4e2a\u4e0d\u80fd\u9009\uff0c\u8fd9\u4e2a\u6570\u4e5f\u4e0d\u80fd\u9009\u3002\u5982\u679c\u4e0a\u8ff0\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u5c31\u80fd\u9009\u4e86\u3002\n\n\u663e\u7136\uff0c\u80fd\u9009\u7684\u90e8\u5206\u4e00\u5b9a\u662f\u82e5\u5e72\u6761\u94fe\u3002\u6240\u4ee5\u5b9e\u73b0\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u5173\u7cfb\u4f5c\u4e3a\u4e00\u5f20\u65e0\u5411\u56fe\u5b58\u50a8\uff08\u6ce8\u610f\u91cd\u8fb9\u9700\u8981\u53bb\u91cd\uff0c\u81ea\u73af\u8981\u88ab\u76f4\u63a5\u6392\u9664\uff09\uff0c\u7136\u540e\u628a\u6bcf\u4e00\u4e2a\u8fde\u901a\u5757\u904d\u5386\u4e00\u6b21\u5224\u65ad\u662f\u5426\u4e3a\u94fe\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u6240\u6709\u7684\u5408\u6cd5\u5e8f\u5217\u7247\u6bb5\uff0c\u7b54\u6848\u5e8f\u5217\u5c31\u662f\u7531\u82e5\u5e72\u4e2a\u7247\u6bb5\u62fc\u63a5\u800c\u6210\u7684\u3002\n\n\u60f3\u5230\u5e8f\u5217\u62fc\u63a5\uff0c\u6ce8\u610f\u5230\u6570\u636e\u8303\u56f4\u5e76\u4e0d\u5927\uff0c\u6211\u4eec\u76f4\u63a5\u7528 GF \u89e3\u51b3\u3002\n\n\u8bbe\u957f\u5ea6\u4e3a $i$ \u7684\u5e8f\u5217\u7247\u6bb5\u6570\u91cf\u4e3a $a_i$\uff0c\u6211\u4eec\u76f4\u63a5\u8bb0 $F(x)=\\sum\\limits_{i=1}a_ix^i$\uff0c\u6c42 $G(x)=\\sum\\limits_{i=0}F(x)^i=\\frac{1}{1-F(x)}$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n## \u4ee3\u7801\n\u8d5b\u65f6\u5199\u7684\uff0c\u975e\u5e38\u4e11\u3002\n\n```cpp\n// Problem: F. Occurrences\n// Contest: Codeforces - Educational Codeforces Round 114 (Rated for Div. 2)\n// URL: https://codeforces.com/contest/1574/problem/F\n// Memory Limit: 512 MB\n// Time Limit: 7000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n \n//And in that light,I find deliverance.\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace getinv\n{\n\tconst long long p=998244353;\n\tlong long qp(long long x,int y)\n\t{\n\t    long long res=1;\n\t    for(long long now=x; y; now=now*now%p,y>>=1)\n\t     if(y&1) res=res*now%p;\n\t    return res;\n\t}\n\tlong long A[1<<22],B[1<<22],ans[2][1<<22];\n\tint rev[1<<22],N,M;\n\tvoid init()\n\t{\n\t    int d=N>>1;\n\t    rev[0]=0,rev[1]=N>>1;\n\t    for(int i=2; i<=N; i<<=1)\n\t    {\n\t        d>>=1;\n\t        for(int j=0; j<i; ++j) rev[i+j]=rev[j]|d;\n\t    }\n\t    return ;\n\t}\n\tvoid NTT(long long* F,int op)\n\t{\n\t    for(int i=0; i<N; ++i) if(rev[i]>i) swap(F[i],F[rev[i]]);\n\t    for(int len=2,M=1; len<=N; len<<=1,M<<=1)\n\t    {\n\t        long long w=qp(op?3:332748118,998244352/len);\n\t        //omega(m,1)\n\t        for(int l=0,r=len-1; l<=N; l+=len,r+=len)\n\t        {\n\t            long long w0=1;\n\t            for(int i=l; i<l+M; ++i)\n\t            {\n\t                long long x=(F[i]+w0*F[i+M]%p)%p,y=(F[i]+p-w0*F[i+M]%p)%p;\n\t                F[i]=x,F[i+M]=y,w0=w0*w%p;\n\t            }\n\t        }\n\t    }\n\t}\n\tvoid getinv(long long* BB,int len)\n\t{\n\t\tint t=1;\n\t    ans[0][0]=qp(BB[0],998244351);\n\t    for(N=2,M=1; M<(len<<1); t^=1)\n\t    {\n\t        init();\n\t        for(int i=0; i<M; ++i) ans[t][i]=(ans[t^1][i]<<1)%p;\n\t        for(int i=0; i<M; ++i) A[i]=BB[i];\n\t        NTT(ans[t^1],1),NTT(A,1);\n\t        for(int i=0; i<N; ++i) ans[t^1][i]=ans[t^1][i]*ans[t^1][i]%p*A[i]%p;\n\t        NTT(ans[t^1],0);\n\t        long long inv=qp(N,998244351);\n\t        for(int i=0; i<N; ++i) ans[t^1][i]=ans[t^1][i]*inv%p;  \n\t        for(int i=0; i<M; ++i) ans[t][i]=(ans[t][i]+p-ans[t^1][i])%p;\n\t        N<<=1,M<<=1;      \n\t    }\n\t    memset(A,0,sizeof(A));\n\t    for(int i=0; i<1048576; ++i) A[i]=ans[t^1][i];\n\t    return ;\n\t}\n\tlong long cnt[1<<22];\n\tvoid main(vector<long long>&Q,int MMM)\n\t{\n\t\tfor(int i:Q) if(i<=MMM) ++cnt[i];\n\t\tint M=1;\n\t\tfor(;M<=MMM;M<<=1);\n\t\tcnt[0]=1;\n\t\tfor(int i=1; i<M; ++i) cnt[i]=(p-cnt[i])%p;\n\t\tgetinv(cnt,M);\n\t\tprintf(\"%lld\\n\",A[MMM]%p);\n\t}\n};\n#define int long long\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nconst int p=998244353;\nint qp(int x,int y)\n{\n\tint res=1;\n\tfor(int t=x; y; y>>=1,t=t*t%p) if(y&1) res=res*t%p;\n\treturn res;\n}\nvector<int> a[300003];\nvector<int> Q;\nint sz[1000003];\nvector<int> e[1000003];\nint in[1000003],out[1000003];\nmap<pair<int,int>,bool> mp;\nvoid add(int x,int y)\n{\n\tif(mp[make_pair(x,y)]) return ;\n\te[x].push_back(y);\n\te[y].push_back(x);\n\t++in[y],++out[x];\n\tmp[make_pair(x,y)]=1;\n\treturn ;\n}\nint res=1;\nbool vis1[1000003],vis2[1000003];\nint gg=0,sss=0;\nvoid dfs1(int x)\n{\n\tif(vis1[x]) return ;\n\tvis1[x]=1;++gg;\n\tif(!in[x]) sss|=1;\n\tif(!out[x]) sss|=2;\n\tif(in[x]>1||out[x]>1) res=0;\n\tfor(int i:e[x]) dfs1(i);\n\treturn ;\n}\nvoid dfs2(int x)\n{\n\tif(vis2[x]) return ;\n\tvis2[x]=1;sz[x]=gg;\n\tfor(int i:e[x]) dfs2(i);\n\treturn ;\n}\nsigned main()\n{\n\tint n=read(),m=read(),k=read();\n\tfor(int i=1; i<=k; ++i) sz[i]=1;\n\tfor(int i=1; i<=n; ++i)\n\t{\n\t\tint T=read();\n\t\ta[i].resize(T);\n\t\tfor(int j=0; j<T; ++j) a[i][j]=read();\n\t\tfor(int j=0; j+1<T; ++j) \n\t\t\tadd(a[i][j],a[i][j+1]);\n\t}\n\tfor(int i=1; i<=k; ++i) if(!vis1[i]) \n\t{\n\t\tres=1;gg=0;sss=0;\n\t\tdfs1(i);\n\t\tif(sss!=3) res=0;\n\t\tif(res) dfs2(i);\n\t}\n\tfor(int i=1; i<=k; ++i) if(!in[i]&&vis2[i])\n\tQ.push_back(sz[i]); \n\tgetinv::main(Q,m);\n\treturn 0;\n}\n```",
        "postTime": 1632390312,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1574F"
    },
    {
        "content": "\u8003\u8651\u6700\u4e25\u7684\u9650\u5236\u5c31\u662f\u6bcf\u4e2a\u5b57\u4e32\u7684\u51fa\u73b0\u6b21\u6570\u7b49\u4e8e\u5176\u5355\u4e2a\u5b57\u7b26\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e $a\\in S$\uff0c\u6bcf\u5f53 $a$ \u51fa\u73b0\uff0c\u5219\u5176\u5fc5\u987b\u662f\u51fa\u73b0\u5728 $S$ \u4e2d\uff1b\u6362\u8a00\u4e4b\uff0c\u6bcf\u5f53\u4e00\u4e2a $a$ \u51fa\u73b0\uff0c\u6211\u4eec\u9700\u8981\u5728\u5176\u524d\u540e\u8865\u4e0a\u82e5\u5e72\u4e2a\u5b57\u7b26\uff0c\u628a\u5b83\u8865\u6210 $S$\u3002\n\n\u6211\u4eec\u5e76\u4e0d\u603b\u80fd\u5c06\u4e00\u4e2a $a$ \u8865\u6210 $S$\uff0c\u90a3\u6211\u4eec\u73b0\u5728\u6765\u8003\u8651\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u8fd9\u662f\u4e0d\u80fd\u505a\u5230\u7684\uff1b\u5373\uff0c\u82e5\u4ee5\u4e0b\u6761\u4ef6\u6ee1\u8db3\uff0c$a$ \u548c $S$ \u4e2d\u51fa\u73b0\u7684\u6240\u6709\u5b57\u7b26\u90fd\u4e0d\u80fd\u5728\u7b54\u6848\u4e32\u4e2d\u51fa\u73b0\u3002\n\n\u9996\u5148\uff0c$a$ \u5e94\u5f53\u6709\u4e00\u4e2a\u540e\u7ee7\uff0c\u5728\u8865\u5168\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u5c06\u5176\u7f6e\u4e8e $a$ \u540e\u3002\u5982\u679c $a$ \u62e5\u6709\u4e86\u4e24\u4e2a\u4e0d\u540c\u7684\u540e\u7ee7\uff0c\u5219\u663e\u7136\u4e0d\u80fd\u505a\u5230\u3002\u4f8b\u5982 $\\{1,3,5\\}$ \u548c $\\{1,2,4\\}$\uff0c\u5bf9\u4e8e\u524d\u9a71\u4e5f\u662f\u540c\u7406\u3002 \n\n\u5176\u6b21\uff0c\u4e0d\u80fd\u51fa\u73b0\u5faa\u73af\uff0c\u4f8b\u5982 $\\{1,2\\}$ \u548c $\\{2,1\\}$\uff0c\u8fd9\u6837\u663e\u7136\u662f\u8865\u4e0d\u5168\u7684\u3002\n\n\u5bf9\u4e8e\u524d\u8005\uff0c\u6211\u4eec\u7ef4\u62a4\u6bcf\u4e2a\u6570\u6709\u51e0\u4e2a\u4e0d\u540c\u7684\u524d\u9a71\u540e\u7ee7\uff1b\u5bf9\u4e8e\u540e\u8005\uff0c\u7528\u4e00\u4e2a\u5e76\u67e5\u96c6\u6765\u5224\u73af\u5373\u53ef\u3002\n\n\u6700\u7ec8\uff0c\u6211\u4eec\u62ff\u5408\u6cd5\u7684\u5b57\u4e32\u6765\u8dd1\u4e00\u4e2a\u80cc\u5305\u5c31\u53ef\u4ee5\u4e86\u3002\u6ce8\u610f\u5bf9\u4e8e\u957f\u5ea6\u4e00\u6837\u7684\u4e32\uff0c\u6211\u4eec\u53ef\u4ee5\u4e00\u6b21\u6027\u8f6c\u79fb\uff0c\u800c\u957f\u5ea6\u4e0d\u540c\u7684\u4e32\u662f $O(\\sqrt k)$ \u7684\u3002\u6700\u7ec8\u590d\u6742\u5ea6\u6309\u540c\u9636\u6765\u7b97\u5c31\u662f $O(n\\sqrt n)$\u3002\n\n```cpp\nfor(int i=1;i<=n;i++){\n\tcin>>ln[i]>>pr;\n\tfor(int j=2;j<=ln[i];j++,pr=nw) {\n\t\tcin>>nw;\n\t\tif(a[pr][nw])continue;\n\t\ta[pr][nw]=1;\n\t\tl[pr]++,r[nw]++;\n\t\tint fx=gf(pr),fy=gf(nw);\n\t\tif(fx==fy||l[pr]>1||r[pr]>1||l[nw]>1||r[nw]>1)\n        \tfl[fy]=0;//fx==fy -> \u6709\u5faa\u73af \n            \t\t //\u540e\u9762\u4e00\u5768 -> \u524d\u9a71\u540e\u7ee7\u6709\u591a\u4e2a\n\t\tfl[fx]&=fl[fy];\n\t\tif(fx!=fy)sz[fx]+=sz[fy],fa[fy]=fx;\t\t\n\t}\n}\nfor(int i=1;i<=k;i++)\n\tif(gf(i)==i&&fl[i])\n\t\tw[sz[i]]++;\nfor(int i=1;i<=k;i++)\n\tif(w[i])\n\t\ttr.push_back(i);\nf[0]=1;\nfor(int i=0;i<=m;i++)\n\tfor(auto k:tr)\n\t\t(f[i+k]+=f[i]*w[k])%=mod;\ncout<<f[m];\n```",
        "postTime": 1632193771,
        "uid": 79067,
        "name": "dottle",
        "ccfLevel": 10,
        "title": "CF1574F"
    },
    {
        "content": "### \u524d\u8a00\uff1a\n\u5b66\u6821 test \u538b\u8f74\u9898\uff01\uff01\uff01\n### \u9898\u76ee\u5927\u610f\uff08\u611f\u89c9\u7ffb\u8bd1\u4e0d\u5bf9\u52b2\uff09\uff1a\n\u7ed9 $n$ \u4e2a\u957f\u5ea6\u5c0f\u4e8e $m$\uff0c\u503c\u57df\u4e3a $[1,k]$ \u7684\u5e8f\u5217 $A_1$ ~ $A_n$ \uff0c\u95ee\u4f60\u6709\u591a\u5c11\u4e2a\u957f\u5ea6\u4e3a $m$\uff0c\u503c\u57df\u4e3a $[1,k]$ \u7684\u5e8f\u5217 $B$\uff0c\u4f7f\u5f97\u4efb\u610f $A_i$ \u5728\u5e8f\u5217 $B$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u7b49\u4e8e\u5176\u4efb\u610f\u4e00\u4e2a\u975e\u7a7a **\u5b50\u4e32** \u5728 $B$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u3002\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n\u5b9a\u4e49 $A$ \u5728 $B$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\uff1a\n $$ \\sum_{l=1}^{m}\\sum_{r=l+1}^{m}[B[l,r]=A] $$ \n### \u601d\u8def\uff1a\n\u56e0\u4e3a\u8981\u4f7f\u5f97\u4efb\u610f $A_i$ \u5728\u5e8f\u5217 $B$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u7b49\u4e8e\u5176\u4efb\u610f\u4e00\u4e2a\u975e\u7a7a **\u5b50\u4e32** \u5728 $B$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a $A_i$ \u91cc\u7684\u6570\u5b57\u4e0d\u80fd\u91cd\u590d\uff0c\u8981\u662f\u91cd\u590d\u4e86\u7684\u8bdd\uff0c\u5c31\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff1a$\\verb!1231!$ \u6709\u4e24\u4e2a $\\verb!1!$\uff0c\u7136\u540e\u6211\u4eec\u5c31\u8981\u518d\u52a0\u4e00\u4e2a $\\verb!1231!$\uff0c\u5c31\u53c8\u591a\u4e86\u4e00\u4e2a $\\verb!1!$\uff0c\u7136\u540e\u65e0\u9650\u5faa\u73af\u4e0b\u53bb\u3002\n\n\u5176\u6b21\uff0c\u5047\u5982\u6709\u4e24\u4e2a\u4e32\uff1a$\\verb!1234!$ \u548c $\\verb!1237!$\uff0c\u5047\u5982\u6211\u4eec\u9009\u4e86 $\\verb!1234!$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u80fd\u9009 $\\verb!1237!$\uff0c\u56e0\u4e3a $\\verb!123!$ \u8fd9\u4e2a\u5b50\u4e32\u53ea\u51fa\u73b0\u4e86\u4e00\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u4e8c\u9009\u4e00\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u4e5f\u662f\u4e0d\u5408\u6cd5\u7684\uff0c\u56e0\u4e3a $\\verb!123!$ \u4e5f\u662f $\\verb!1237!$ \u7684\u5b50\u4e32\uff0c$\\verb!1237!$ \u5e94\u8be5\u4e5f\u8981\u51fa\u73b0\u4e00\u6b21\uff0c\u6240\u4ee5\u4e24\u4e2a\u90fd\u4e0d\u80fd\u9009\u3002\n\n\u4ece\u4ee5\u4e0a\u4e24\u4e2a\u7ed3\u8bba\uff0c\u6211\u4eec\u4e0d\u96be\u770b\u51fa\u6bcf\u4e00\u4e2a\u6570\u524d\u540e\u4e24\u4e2a\u6570\u662f\u56fa\u5b9a\u7684\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u5b83\u4eec\u662f\u7ed1\u5b9a\u5728\u4e00\u8d77\u7684\uff0c\u5c31\u662f\u4e00\u6761\u94fe\uff0c\u6240\u4ee5\u539f\u95ee\u9898\u5c31\u7b80\u5316\u6210\u4e86\u6c42\u5728\u4e00\u4e2a\u56fe\u4e2d\uff0c\u6709\u591a\u5c11\u6761\u94fe\uff0c\u7136\u540e\u628a\u5b83\u4eec\u586b\u5728\u8fd9\u4e2a\u957f\u5ea6\u4e3a $m$ \u7684 $B$ \u4e32\u91cc\u9762\u3002\n\n\u8fd9\u4e0d\u5c31\u662f\u4e00\u4e2a\u5b8c\u5168\u80cc\u5305\u5417\uff01\u4f46\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nm)$ \u8981\u8d85\u65f6\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u518d\u4f18\u5316\u4e00\u4e0b\uff0c\u5b50\u4e32\u7684\u957f\u5ea6\u80af\u5b9a\u6709\u76f8\u540c\u7684\uff0c\u5b83\u4eec\u7684\u8d21\u732e\u90fd\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97\u76f8\u540c\u5b50\u4e32\u7684\u6570\u91cf\uff0c\u6700\u540e\u518d\u628a\u5b83\u4eec\u5728\u8ba1\u7b97\u8d21\u732e\u7684\u65f6\u5019\u4e58\u4e0a\u53bb\u5c31\u884c\u4e86\uff0c\u56e0\u4e3a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\u4e2d\u5b50\u4e32\u7684\u957f\u5ea6\u6700\u591a\u6709 $\\sqrt n$ \u79cd\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u65f6\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u6210 $O(\\sqrt nm)$\u3002\n### Code:\n```\n#include <bits/stdc++.h>\nusing namespace std;\ninline int read() {\n    register int s = 0, f = 1;\n    register char ch = getchar();\n    while (!isdigit(ch)) { if (ch == '-') f = -f; ch = getchar(); }\n    while (isdigit(ch)) { s = (s << 1) + (s << 3) + (ch ^ 48); ch = getchar(); }\n    return s * f;\n}\n\nconst int N = 3e5 + 10; \nconst int P = 998244353;\nint n, m, k, par[N], sz[N], to[N], a[N], pre[N], tag[N];\nvoid upd(int &x, int y) { x += y; if(x >= P) x -= P; }\nint find(int x) { return par[x] == x ? x : par[x] = find(par[x]); }\ninline void merge(int x,int y){\n\tx = find(x), y = find(y);\n\tif(x == y) { tag[x] = 1; return; }\n\tpar[y] = x;\n\tsz[x] += sz[y];\n\ttag[x] |= tag[y];\n}\n\nint g[N], sum[N], f[N], cnt;\nsigned main() {\n\t//freopen(\"sequence.in\", \"r\", stdin);\n\t//freopen(\"sequence.out\", \"w\", stdout);\n\tn = read(), m = read(), k = read();\n\tfor (int i = 1; i <= k; i++) par[i] = i, sz[i] = 1;\n\tfor (int i = 1; i <= n; i++) {\n\t\tint c = read();\n\t\tfor (int j = 1; j <= c; j++) a[j] = read(); \n\t\tfor (int j = 2; j <= c; j++) {\n\t\t\tif ((pre[a[j]] && pre[a[j]] != a[j - 1]) || (to[a[j - 1]] && to[a[j - 1]] != a[j])) {\n\t\t\t\tmerge(a[j - 1], a[j]);\n\t\t\t\ttag[find(a[j])] = 1;\n\t\t\t} else if (!to[a[j - 1]]) {\n\t\t\t\tto[a[j - 1]] = a[j];\n\t\t\t\tpre[a[j]] = a[j - 1];\n\t\t\t\tmerge(a[j - 1], a[j]);\n\t\t\t}\n\t\t}\n\t}\n\tfor (int i = 1; i <= k; i++) {\n\t\tif(find(i) != i || tag[i]) continue;\n\t\tg[sz[i]]++;\n\t}\n\tfor (int i = 1; i <= k; i++) if(g[i]) sum[++cnt] = i;\n\tf[0] = 1;\n\tfor (int i = 0; i <= m; i++) {\n\t\tfor (int j = 1; j <= cnt && i + sum[j] <= m; j++) {\n\t\t\tupd(f[i + sum[j]], 1ll * f[i] * g[sum[j]] % P);\n\t\t}\n\t}\n\tcout << f[m];\n\treturn 0;\n}\n```\n",
        "postTime": 1673340565,
        "uid": 212423,
        "name": "FrozenDream",
        "ccfLevel": 4,
        "title": "CF1574F\u9898\u89e3"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9 $n$ \u4e2a\u503c\u57df\u4e3a $[1,k]$\uff0c\u957f\u5ea6\u90fd\u5c0f\u4e8e $m$ \u7684\u5e8f\u5217 $A_i$\uff0c\u95ee\u4f60\u6709\u591a\u5c11\u4e2a\u957f\u5ea6\u4e3a $m$ \u7684\u5e8f\u5217 $a$\uff0c\u503c\u57df\u4e3a $[1,k]$\uff0c\u4efb\u610f $A_i$ \u5728\u5e8f\u5217 $a$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e\u5176\u4efb\u610f\u4e00\u4e2a\u975e\u7a7a**\u5b50\u6bb5**\u5728 $a$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u3002\u5b9a\u4e49 $a$ \u5728 $b$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a \n\n$$\\sum_{l=1}^n\\sum_{r=l+1}^n[b[l,r]=a]$$\n\n\u524d\u7f6e\u829d\u58eb\uff1a\u5206\u6e05 subarray \u548c subsequence\n\n\u5f88\u5999\u7684\u4e00\u9053\u9898\u3002\n\n\u663e\u7136 $A_i$ \u7684\u4e00\u4e2a\u6570\u5728 $a$ \u4e2d\u51fa\u73b0\uff0c\u90a3\u4e48 $A_i$ \u7684\u4e0b\u4e00\u4e2a\u6570\u5fc5\u987b\u8ddf\u7740\u5b83\u554a\uff01\n\n\u90a3\u4e48\u5f62\u8c61\u5316\u7684\u8868\u8fbe\uff0c\u628a\u76f8\u90bb\u7684\u6570\u524d\u9762\u5411\u540e\u9762\u8fde\u8fb9\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u91cd\u8fb9\u548c\u81ea\u73af\u3002\n\n\u51fa\u73b0\u73af\u5373\u51fa\u73b0\u76f8\u540c\u5143\u7d20\uff0c\u5fc5\u7136\u6392\u9664\u4e86\uff0c\u51fa\u73b0\u5206\u5c94\u5c31\u4e8c\u8005\u4e0d\u53ef\u5f97\u517c\uff0c\u4e5f G \u4e86\uff0c\u8fd9\u79cd\u65f6\u5019\uff0c\u5c31\u5269\u4e0b\u4e86\u82e5\u5e72\u4e2a\u94fe\uff08**\u70b9\u4e5f\u7b97\u94fe\u554a**\n\n\u8bbe\u94fe\u957f\u5ea6\u7684\u53ef\u91cd\u96c6\u4e3a $S$\uff0c\u4f60\u4e00\u4e0b\u5b50\u634f\u51fa\u4e00\u4e2a\u751f\u6210\u51fd\u6570 $f(x)=\\sum_{siz\\in S}x^{siz}$\uff0c\u679a\u4e3e\u9009\u7684\u94fe\u7684\u6761\u6570 $i$\uff0c\u5219\u7b54\u6848\u4e3a $[x^m]1+f(x)+f(x)^2+\\ldots=(1-f(x))^{-1}$\u3002\n\n\u5224\u94fe\u76f4\u63a5\u6309\u7167\u51fa\u5165\u5ea6\u5224\u5c31\u884c\u4e86\uff0c\u723d\u554a\n\n```cpp\nsigned main(){\n  int n,m,k;\n  cin>>n>>m>>k;\n  vector<vector<int> >g(k);\n  vector<int>fa(k),in(k),out(k);\n  iota(all(fa),0);\n  map<pair<int,int>,int>M;\n  function<int(int)>get=[&](int x){\n    if(x==fa[x])return x;\n    return fa[x]=get(fa[x]);\n  };\n  auto Add=[&](int x,int y){\n    if(M[{x,y}])return;\n    M[{x,y}]=1;\n    g[x].push_back(y);\n    fa[get(x)]=get(y);\n    in[y]++,out[x]++;\n  };\n  while(n--){\n    int c,lst;\n    cin>>c>>lst;\n    while(--c){\n      int u;cin>>u;\n      Add(lst-1,u-1);lst=u;\n    }\n  }\n  vector<vector<int> >faset(k);\n  vector<bool>vis(k);\n  rep(i,0,k-1)faset[get(i)].push_back(i);\n  vector<int>S;\n  for(auto j:faset)if(j.size()){\n    int u=0;\n    for(int i:j)u+=in[i];\n    bool gg=u!=j.size()-1;\n    for(int i:j)gg|=in[i]>1||out[i]>1;\n    if(gg)continue;\n    S.push_back(j.size());\n  }\n  poly a(m+1);\n  for(int i:S)if(i<=m)a[i]++;\n  a=-a;\n  add(a[0],1);\n  cout<<Inv(a)[m]<<endl;\n}\n```",
        "postTime": 1648555303,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "CF1574F Occurrences \u8bb0\u5f55"
    }
]