[
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1ahttps://memset0.cn/cf1336e2\r\n\r\n\u8fd9\u7bc7\u9898\u89e3\u662f\u51fa\u9898\u4eba\u628a\u5200\u67b6\u5728\u6211\u8116\u5b50\u4e0a\u5199\u7684\uff0c\u9505\u4e86\u4e0d\u5173\u6211\u4e8b\uff08\u96fe\r\n\r\n---\r\n\r\n\u7ed9\u5b9a $n$ \u4e2a\u6574\u6570 $\\langle a_1, a_2 ... a_n \\rangle$\uff0c\u5728 $[0; 2^m)$ \u7684\u8303\u56f4\u5185\u3002\u5bf9\u4e8e $k \\in [0; m]$\uff0c\u6c42\u9009\u51fa\u4e00\u4e2a\u5b50\u96c6\u4f7f\u5f97\u5f02\u6216\u548c\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u6709 $k$ \u4e2a $1$ \u7684\u65b9\u6848\u6570\u3002\r\n\r\n$1 \\leq n \\leq 2 \\times 10^5,\\ 0 \\leq m \\leq 53$\u3002\r\n\r\n---\r\n\r\n## 0x00\r\n\r\n\u505a\u9898\u4e4b\u524d\uff0c\u6700\u91cd\u8981\u7684\uff1a\r\n\r\n**\u5f53\u7136\u662f\u819c\u6b64\u9898\u51fa\u9898\u4eba Sooke \u5927\u795e**\uff01\r\n\r\n## 0x01\r\n\r\n\u5b9a\u4e49\uff1a\r\n\r\n- $\\operatorname{popcount}(x)$ \u8868\u793a $x$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b $1$ \u7684\u4e2a\u6570\r\n- $\\langle i, j \\rangle = \\operatorname{popcount(i \\& j)}$\r\n\r\n\u5bf9\u4e8e\u7ebf\u6027\u57fa $S$\uff0c\u5b9a\u4e49\uff1a\r\n\r\n- $\\operatorname{span}(S)$ \u8868\u793a $S$ \u5f20\u6210\u7684\u5411\u91cf\u7a7a\u95f4\r\n- $F(S) = \\sum_{x \\in \\operatorname{span}(S)} z^x$\r\n- $P(S) = \\sum_{x \\in \\operatorname{span}(S)} z^{\\operatorname{popcount}(x)}$\r\n\r\n\u5bf9\u4e8e\u6b64\u9898\uff0c\u5b9a\u4e49\r\n\r\n- $A$ \u4e3a\u7531\u9898\u4e2d\u7ed9\u5b9a\u6570\u5f97\u5230\u7684\u7ebf\u6027\u57fa\r\n\r\n\u9996\u5148\u4f60\u5df2\u7ecf\u4f1a\u4e86\u4e00\u4e2a $O(2^{\\operatorname{rank}(A)})$ \u7684\u66b4\u529b\uff0c\u4e0b\u6587\u6211\u4eec\u4ecb\u7ecd\u4e00\u79cd $O(2^{m-\\operatorname{rank}(A)})$ \u7684\u7b97\u6cd5\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5206\u6cbb\u5728 $O(2^{m/2})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u901a\u8fc7\u672c\u9898\u3002\r\n\r\n## 0x02\r\n\r\n\u7531\u7ebf\u6027\u57fa\u7684\u57fa\u672c\u6027\u8d28\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\r\n\r\n$$\r\n(z^x) * F(A) = F(A)\r\n$$\r\n\r\n\u5728\u6b64\u57fa\u7840\u4e0a\u679a\u4e3e $x \\in \\operatorname{span}(A)$ \u6709\r\n\r\n$$\r\n\\begin{aligned}\r\n\tF(A) * F(A) &= F(A) \\cdot 2^{\\operatorname{rank}(A)} \\\\\r\n\t\\operatorname{FWT}(F(A)) \\cdot \\operatorname{FWT}(F(A)) &= \\operatorname{FWT}(F(A)) \\cdot 2^{\\operatorname{rank}(A)}\r\n\\end{aligned}\r\n$$\r\n\r\n\u7531\u4e8e\u662f\u6309\u4f4d\u76f8\u4e58\uff0c\u8003\u8651\u65b9\u7a0b $x^2=x+1$ \u7684\u5b9e\u6839\u4ec5\u6709 $\\left\\{ \\begin{aligned} x_1 &= 0 \\\\ x_2 &= 2^{\\operatorname{rank}(A)} \\end{aligned} \\right.$\uff0c\u6545 $[z^i] \\operatorname{FWT}(F(A))  \\in \\{0, 2^{\\operatorname{rank}(A)}\\}$\u3002\r\n\r\n## 0x03\r\n\r\n\u8ba9\u6211\u4eec\u518d\u56de\u5230 $\\operatorname{FWT}$ \u8fd0\u7b97\u672c\u8eab\u7684\u610f\u4e49\uff1a\r\n\r\n$$\r\n\\begin{aligned}\r\n[z^i] \\operatorname{FWT}(F(A))\r\n&= \\sum_{x \\in \\operatorname{span}(A)} (-1)^{\\langle i,x \\rangle} \\\\\r\n&\\in \\{ 0, 2^{\\operatorname{rank}(A)} \\} \\\\\r\n\\end{aligned}\r\n$$\r\n\r\n\u5982\u679c\u5b58\u5728 $x$ \u4f7f\u5f97 $(-1)^{\\langle i,x \\rangle} = -1$\uff0c\u5219 $\\operatorname{FWT}(A)_i$ \u53ea\u80fd\u4e3a $0$\u3002\r\n\r\n$\\langle x,y \\rangle$ \u548c $\\oplus$ \u8fd0\u7b97\u6ee1\u8db3\u7ed3\u5408\u5f8b\uff1a\r\n\r\n$$\r\n\\langle i,x \\rangle \\oplus \\langle j,x \\rangle = \\langle i \\oplus j, x \\rangle\r\n$$\r\n\r\n\u53ef\u4ee5\u901a\u8fc7\u628a $\\&$ \u7406\u89e3\u4e3a\u4e8c\u8fdb\u5236\u6309\u4f4d\u4e58\u6cd5\uff0c$\\oplus$ \u7406\u89e3\u4e3a\u4e8c\u8fdb\u5236\u4e0d\u8fdb\u4f4d\u52a0\u6cd5\u6765\u8bc1\u660e\u3002\r\n\r\n\u6545\u6211\u4eec\u53ea\u9700\u68c0\u9a8c $A$ \u4e2d\u7684\u6bcf\u4e2a\u57fa\u5e95\u800c\u975e $\\operatorname{span}(A)$ \u5373\u53ef\u5224\u65ad\u8fd9\u4e00\u4f4d\u7684\u503c\u3002\r\n\r\n## 0x04\r\n\r\n\u5b9a\u4e49 $A$ \u7684\u6b63\u4ea4\u7ebf\u6027\u57fa\u4e3a $B$\uff0c\u4f7f\u5f97\u5bf9\u4e8e\u6240\u6709 $x \\in \\operatorname{span}(A), y \\in \\operatorname{span}(B)$\uff0c\u6ee1\u8db3 $\\operatorname{popcount(x \\& y)}$ \u662f\u5076\u6570\uff0c\u4e14 $\\operatorname{rank}(A) + \\operatorname{rank}(B) = m$\u3002\r\n\r\n\u6839\u636e\u524d\u9762\u7684\u5f15\u7406\uff0c\u6709\r\n\r\n$$\r\nB \\cdot 2^{\\operatorname{rank}(A)} = \\operatorname{FWT} (A) \\Leftrightarrow \\operatorname{IFWT}(B \\cdot 2^{\\operatorname{rank}(A)}) = A\r\n$$\r\n\r\n\u4e00\u79cd\u7b80\u5355\u7684\u6b63\u4ea4\u7ebf\u6027\u57fa\u6784\u9020\u65b9\u5f0f\u662f\r\n\r\n![](https://i.loli.net/2020/04/26/wKc3le9s8vBzQYr.png)\r\n\r\n\u7528\u9ad8\u65af\u6d88\u5143\u6574\u7406\u5173\u952e\u4f4d\uff0c\u65cb\u8f6c\u53f3\u4e0a\u89d2\u5230\u5de6\u4e0b\u89d2\u5f97\u5230\u3002\r\n\r\n![](https://i.loli.net/2020/04/26/QckSaT4BjewVXNE.png)\r\n\r\n\u8bc1\u660e\u53ef\u4ee5\u8003\u8651\u56fe\u4e2d\u5708\u51fa\u77e9\u5f62\u7684\u5de6\u4e0a\u89d2\u548c\u53f3\u4e0a\u89d2\u4e00\u5b9a\u4e3a $1$\uff0c\u800c\u4e24\u5411\u91cf\u7684\u5f02\u6216\u7684 $\\operatorname{popcount}$ \u4e3a\u5076\u6570\uff0c\u90a3\u4e48\u5de6\u4e0b\u89d2\u548c\u53f3\u4e0a\u89d2\u7684\u6570\u8981\u4e48\u5168\u4e3a $0$\uff0c\u8981\u4e48\u5168\u4e3a $1$\u3002\r\n\r\n## 0x05\r\n\r\n\u77e5\u9053\u4e86\u6b63\u4ea4\u7ebf\u6027\u57fa\u600e\u4e48\u6c42\uff0c\u5982\u4f55\u8ba1\u7b97\u7b54\u6848\u5462\uff1f\r\n\r\n\u8003\u8651\u7528 $\\operatorname{FWT}$ \u8868\u793a\u7b54\u6848\u7edf\u8ba1\uff1a\r\n\r\n$$\r\n[z^c]P(A) = [z^0] (A * G^c) = [z^0] \\operatorname{IFWT}(\\operatorname{FWT}(F(A)) \\cdot \\operatorname{FWT}(G^c))\r\n$$\r\n\r\n\u5176\u4e2d $G^c$ \u8868\u793a $\\sum_{x \\geq 0} z^x [\\operatorname{popcount}(x)=c]$\u3002\r\n\r\n\u5176\u4e2d\uff1a\r\n\r\n$$\r\n[z^0] \\operatorname{IFWT}(X) = 2^{-m} [z^0] \\operatorname{FWT}(X) = 2^{-m} \\sum_{i \\geq 0} [z^i] X\r\n$$\r\n\r\n\u7531\u4e8e $\\operatorname{FWT}(F(A)) = F(B) \\cdot 2^k$\uff0c\u800c $B$ \u4e2d\u7684\u5143\u7d20\u53ea\u6709 $2^{\\operatorname{rank}(B)} = 2^{m - \\operatorname{rank}(A)}$ \u4e2a\u3002\u6545\u901a\u8fc7\u66b4\u529b\u5f97\u5230 $P(B)$\uff0c\u5373\u53ef\u901a\u8fc7\u7ec4\u5408\u6570\u8ba1\u7b97\u5f97 $P(A)$\u3002\r\n\r\n$$\r\n[z^c]P(A) = 2^{k-m} \\sum_{d \\geq 0} [z^d] P(B) \\sum_{i \\geq 0} (-1)^i \\binom d i \\binom {m-d} {c-i}\r\n$$",
        "postTime": 1587916324,
        "uid": 53495,
        "name": "memset0",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1336E2 \u3010Chiori and Doll Picking (hard version)\u3011"
    },
    {
        "content": "\u6c42\u51fa\u8fd9 $n$ \u4e2a\u6570\u7684\u7ebf\u6027\u57fa $A$\uff0c\u5047\u8bbe\u7ebf\u6027\u57fa\u7684\u79e9\u4e3a $k$\u3002\n\n\u4e3a\u4e86\u7b80\u6d01\uff0c\u7528 $|x|$ \u8868\u793a $x$ \u4e8c\u8fdb\u5236\u4e0b $1$ \u7684\u4e2a\u6570\uff0c\u5373 $\\text{ popcount }(x)$\u3002\n\n\u5b9a\u4e49 $F_c=\\{x:|x|=c,x<2^m\\},(x,y) =|x\\& y|$\u3002\n\n\u539f\u95ee\u9898\u5373\u53ef\u8f6c\u5316\u6c42\u6210 $2^{n-k}\\times \\sum_{x\\in F_c}[x\\in A]$\uff0c\u4e0b\u9762\u5148\u4e0d\u8003\u8651\u524d\u9762\u7684\u5e38\u6570\u9879\u3002\n\n\u6784\u9020 $B=\\{y:\\forall x\\in A,(x,y)\\equiv 0\\pmod 2\\}$ \uff0c\u5219\u6709\uff1a\n$$\n[x\\in A]=\\frac{1}{|B|}\\sum_{y}(-1)^{(x,y)}[y\\in B]\n$$\n\n$$\n\\sum_{x\\in F_c}[x\\in A]=\\frac{1}{|B|}\\sum_y[y\\in B](\\sum_{x\\in F_c}(-1)^{(x,y)})\n$$\n\n\u8003\u8651\u6700\u540e\u4e00\u9879\u7684\u53d6\u503c\uff1a\n\n$$\n\\sum_{x\\in F_c}(-1)^{(x,y)}=\\sum_{x\\in F_c}\\sum_{(x,y)=k}(-1)^k\\binom{|y|}{k}\\binom{m-|y|}{|x|-k}\n$$\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u53d6\u503c\u53ea\u548c $|y|$ \u6709\u5173\uff0c\u56e0\u6b64\u53ef\u4ee5\u9884\u5904\u7406\u51fa $w_{c,d}=\\sum_{x\\in F_c}(-1)^{(x,y)}(c=|x|,d=|y|)$ \u3002\n\n\u63a5\u4e0b\u6765\u6784\u9020 $B$\uff0c\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\u662f\u5148\u5c06 $A$ \u6d88\u5143\u6210\u6bcf\u4e2a\u4e3b\u5143\u5217\u53ea\u6709\u4e00\u4e2a $1$\uff0c\u7136\u540e\u8f6c\u7f6e\u5e76\u4ea4\u6362\u6240\u6709\u7684\u4e3b\u5143\u548c\u975e\u4e3b\u5143\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/1l0a8lag.png)\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e $A$ \u4e2d\u7684\u4e00\u4e2a\u57fa\u5411\u91cf $x$ \u548c $B$ \u4e2d\u7684\u4e00\u4e2a\u57fa\u5411\u91cf $y$\uff0c\u53ea\u6709\u5f53 $y$ \u7684\u4e3b\u5143\u5bf9\u5e94\u5230 $x$ \u4e0a\u7684\u90a3\u4e00\u4f4d\u4e3a $1$ \u7684\u65f6\u5019\u624d\u6709 $(x,y)=2$\uff0c\u5426\u5219\u6052\u6709 $(x,y)=0$\u3002\n\n\u56e0\u4e3a $|x\\&z|+|y\\&z|\\equiv|(x\\oplus y)\\&z|\\pmod 2$ \uff0c\u800c $A$ \u6216 $B$ \u80fd\u8868\u793a\u51fa\u7684\u6bcf\u4e2a\u6570\u90fd\u53ef\u4ee5\u62c6\u6210\u82e5\u5e72\u7684\u57fa\u5411\u91cf\u7684\u5f02\u6216\u548c\uff0c\u56e0\u6b64\u8fd9\u5c31\u4fdd\u8bc1\u4e86 $(x,y)\\equiv 0\\pmod 2$ \u5bf9\u4e8e $x\\in A,y\\in B$ \u6052\u6210\u7acb\u3002\n\n\u5e76\u4e14\uff0c\u56e0\u4e3a $B$ \u7684\u6bcf\u4e2a\u4e3b\u5143\u5217\u4e0a\u53ea\u6709\u4e00\u4e2a $1$\uff0c\u6240\u4ee5 $B$ \u5185\u7684\u6bcf\u4e2a\u5411\u91cf\u90fd\u7ebf\u6027\u65e0\u5173\uff0c\u5373 $B$ \u662f\u4e00\u4e2a\u79e9\u4e3a $m-k$ \u7684\u7ebf\u6027\u57fa\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5728 $O(2^{m-k})$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u6240\u6709\u7684 $y\\in B$\uff0c\u7ed3\u5408\u9884\u5904\u7406\u7684 $w$ \u5c31\u53ef\u4ee5\u8ba1\u7b97\u7b54\u6848\u4e86\u3002\n\n\u5982\u679c $k$ \u8f83\u5c0f\uff0c\u53ef\u4ee5 $O(2^k)$ \u679a\u4e3e\u6240\u6709 $x\\in A$ \u5e76\u8ba1\u7b97\u7b54\u6848\uff0c\u5982\u679c $k$ \u8f83\u5927\uff0c\u5219\u53ef\u4ee5\u6309\u4e0a\u8ff0\u65b9\u6cd5\u5728 $O(2^{m-k})$ \u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u53d6\u4e24\u8005\u4e2d\u8f83\u5feb\u7684\u65b9\u6cd5\u6c42\u89e3\uff0c\u5373\u53ef\u8fbe\u5230 $O(nm+2^{m/2})$ \u7684\u603b\u590d\u6742\u5ea6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5168\u90e8\u7684\u6d4b\u8bd5\u70b9\u3002\n\nP.S. \u4e00\u7ec4\u7ebf\u6027\u57fa\u5bf9\u5e94\u4e00\u4e2a\u7ebf\u6027\u7a7a\u95f4\uff0c$B$ \u5c31\u662f $A$ \u5728 $m$ \u7ef4\u7a7a\u95f4\u4e2d\u7684\u6b63\u4ea4\uff0c\u56e0\u4e3a\u5728\u8fd9\u91cc\u6bcf\u4e00\u7ef4\u7684\u53d6\u503c\u90fd\u53ea\u6709 $0,1$ \u4e24\u79cd\uff0c\u6240\u4ee5 $B$ \u662f\u552f\u4e00\u7684\u3002\uff08\u4e0d\u552f\u4e00\u7684\u65f6\u5019\uff0c\u5176\u4f59\u7684\u6b63\u4ea4\u7a7a\u95f4\u90fd\u4e0e $B$ \u7ebf\u6027\u76f8\u5173\uff09\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define I inline int\n#define V inline void\n#define ll long long int\n#define cnt(x) __builtin_popcountll(x)\n#define FOR(i,a,b) for(int i=a;i<=b;i++)\n#define ROF(i,a,b) for(int i=a;i>=b;i--)\nconst int N=2e5+1,M=64,mod=998244353;\nV check(int&x){x-=mod,x+=x>>31&mod;}\nint n,k,m,tot;\nll a[N],f[M],g[M],t[M];\nint ans[M],tmp[M],pw[N],c[M][M],w[M][M];\nV ins(ll x){\n\tROF(i,m,0)if(x>>i&1){\n\t\tif(f[i])x^=f[i];\n\t\telse return f[i]=x,k++,void();\n\t}\n}\nV dfs(int p,ll x){\n\tif(p==tot)tmp[cnt(x)]++;\n\telse dfs(p+1,x),dfs(p+1,x^t[p]);\n}\nint main(){\n\tcin.tie(0),cin>>n>>m,pw[0]=1,m--;\n\tFOR(i,1,n)cin>>a[i],ins(a[i]),check(pw[i]=pw[i-1]<<1);\n\tFOR(i,0,m)FOR(j,0,i-1)if(f[i]>>j&1)f[i]^=f[j];\n\tif(k<=26){\n\t\tFOR(i,0,m)if(f[i])t[tot++]=f[i];\n\t\tdfs(0,0);\n\t\tFOR(i,0,m+1)cout<<1ll*pw[n-k]*tmp[i]%mod<<' ';\n\t}\n\telse{\n\t\tFOR(i,0,m)FOR(j,0,m)g[j]|=(f[i]>>j&1)<<i;\n\t\tFOR(i,0,m)if(g[i]^=1ll<<i)t[tot++]=g[i];\n\t\tk=++m-k,dfs(0,0);\n\t\tFOR(i,0,m)c[i][0]=1;\n\t\tFOR(i,1,m)FOR(j,1,m)check(c[i][j]=c[i-1][j]+c[i-1][j-1]);\n\t\tFOR(i,0,m)FOR(j,0,m)FOR(p,0,i)\n\t\t\tif(p&1)check(w[i][j]+=mod-1ll*c[j][p]*c[m-j][i-p]%mod);\n\t\t\telse check(w[i][j]+=1ll*c[j][p]*c[m-j][i-p]%mod);\n\t\tFOR(i,0,m)FOR(j,0,m)\n\t\t\tcheck(ans[i]+=1ll*tmp[j]*w[i][j]%mod);\n\t\tint tag=pw[max(0,n-m+k)];\n\t\tFOR(i,1,k)tag=1ll*(mod+1>>1)*tag%mod;\n\t\tFOR(i,0,m)cout<<1ll*ans[i]*tag%mod<<' ';\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1587131970,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1336E2 \u3010Chiori and Doll Picking (hard version)\u3011"
    },
    {
        "content": "\u5047\u8bbe\u7ebf\u6027\u57fa\u5927\u5c0f\u4e3a$cnt$\uff0c\u8bbe\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\u4e2d\u4e00\u7684\u4e2a\u6570\u4e3a$pc(x)$\u3002\n\n\u6709\u4e00\u4e2a\u7ebf\u6027\u57fa\u7684\u7ed3\u8bba\uff1a\u4e00\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5b50\u96c6\u7684\u5f02\u6216\u548c\u7684\u53ef\u80fd\u503c\u6709$2^{cnt}$\u79cd\uff0c\u5e76\u4e14\u6bcf\u4e00\u79cd\u4f1a\u6070\u597d\u51fa\u73b0$2^{n-cnt}$\u6b21\u3002\n\n\u8bc1\u660e\uff1a\u4e0d\u5728\u7ebf\u6027\u57fa\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u53ef\u4ee5\u7531\u7ebf\u6027\u57fa\u7684\u82e5\u5e72\u4e2a\u5143\u7d20\u8868\u793a\u51fa\u6765\uff0c\u800c\u6211\u4eec\u4efb\u610f\u9009\u62e9\u4e0d\u5728\u7ebf\u6027\u57fa\u4e2d\u7684\u5143\u7d20\uff0c\u603b\u5171\u6709$2^{n-cnt}$\u79cd\u53d6\u6cd5\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6700\u7ec8\u5f02\u6216\u548c\u4e3a$x$\u7684\u65b9\u6848\uff0c\u6211\u4eec\u5148\u4efb\u610f\u9009\u62e9\u5728\u8fd9$2^{n-cnt}$\u79cd\u53d6\u6cd5\u79cd\u9009\u62e9\u4e00\u79cd\uff0c\u7136\u540e\u901a\u8fc7\u7ebf\u6027\u57fa\u5185\u90e8\u7684\u5143\u7d20\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a\u96c6\u5408\u4f7f\u5f97\u9009\u51fa\u7684\u6570\u5f02\u6216\u548c\u4e3a$x$\uff0c\u6240\u4ee5\u6bcf\u4e00\u79cd\u53ef\u4ee5\u88ab\u7ebf\u6027\u57fa\u8868\u793a\u51fa\u6765\u7684\u5143\u7d20\u90fd\u4f1a\u6070\u597d\u51fa\u73b0$2^{n-cnt}$\u6b21\u3002\n\n\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a$2^{cnt}$\u7684\u66b4\u529b\uff0c\u6bcf\u6b21\u66b4\u529b\u679a\u4e3e\u7ebf\u6027\u57fa\u4e2d\u7684\u5143\u7d20\u662f\u5426\u88ab\u9009\u62e9\uff0c\u7136\u540e\u5f97\u5230\u7684\u5143\u7d20\u4f1a\u51fa\u73b0$2^{n-cnt}$\u6b21\uff0c\u7ed9\u5bf9\u5e94\u4f4d\u7f6e\u4e0a\u7684\u7b54\u6848\u52a0\u4e0a$2^{n-cnt}$\u5373\u53ef\u3002\n\n---\n\n\u90a3\u4e48\u6211\u4eec\u63a5\u4e0b\u6765\u8ba8\u8bba\u4e00\u4e2a\u60ca\u8273\u7684$2^{m-cnt}$\u7684\u505a\u6cd5\uff0c\u7efc\u5408\u8fd9\u4e24\u79cd\u505a\u6cd5\uff0c\u8fdb\u884c\u6839\u53f7\u5206\u6cbb\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a$2^{\\frac{m}{2}}$\u7684\u4f18\u79c0\u590d\u6742\u5ea6\u3002\n\n\u8003\u8651\u8bbe\uff1a$Z(S)$\u8868\u793a\u7ebf\u6027\u57fa\u80fd\u8868\u793a\u7684\u96c6\u5408\uff0c$F(S)=\\sum_{i\\in Z(S)}x^i, G_c(S)=\\sum_{i\\in S}[pc(i)==c]x^i$\n\n\u90a3\u4e48$F(S)\\times G_c(S)$\u7684\u7b2c$0$\u9879\u7684\u610f\u4e49\uff08\u8fd9\u91cc\u4e58\u6cd5\u8868\u793a\u5f02\u6216\u5377\u79ef\uff09\u5c31\u8868\u793a\u7684\u662f$c$\u7684\u7b54\u6848\u3002\u56e0\u4e3a\u5b83\u6bcf\u4e00\u4f4d\u53ea\u6709\u5f53\u4e24\u4e2a\u5e42\u7ea7\u6570\u7cfb\u6570\u90fd\u4e3a$1$\u7684\u65f6\u5019\u624d\u6709$1$\u7684\u8d21\u732e\uff0c\u800c\u8fd9\u6b63\u662f\u6211\u4eec\u60f3\u8ba1\u7b97\u7684\u7b54\u6848\u3002\u5f53\u7136\u7531\u4e8e$2^{cnt}$\u7684\u8bc1\u660e\uff0c\u6211\u4eec\u77e5\u9053\u6bcf\u4e00\u79cd\u65b9\u6848\u90fd\u5bf9\u5e94$2^{n-cnt}$\u79cd\u9009\u62e9\uff0c\u6240\u4ee5\u6700\u540e\u8fd8\u8981\u4e58\u4ee5$2^{n-cnt}$\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c$ans_c=2^{n-cnt}\\times F(S)\\times G_c(S)[x^0]$\uff0c\u76f4\u63a5\u6c42\u662f\u4e0d\u592a\u53ef\u80fd\u7684\uff0c\u4f46\u662f$F(S), G_c(S)$\u7684\u70b9\u503c\u4f3c\u4e4e\u6709\u4ec0\u4e48\u5999\u4e0d\u53ef\u8a00\u7684\u89c4\u5f8b\uff0c\u4e8e\u662f\u6211\u4eec\u60f3\u529e\u6cd5\u6c42\u51fa\u5bf9\u5e94\u7684\u70b9\u503c\u5373\u53ef\u3002\u5728\u6b64\u4e4b\u524d\uff0c\u5148\u6765\u8bc1\u660e\u51e0\u4e2a\u7ed3\u8bba\uff1a\n\n---\n\n$1.F(S)$\u7684\u70b9\u503c\u53ea\u6709\u53ef\u80fd\u4e3a$0$\u6216\u8005$2^{cnt}$\u3002\n\n\u6211\u4eec\u8003\u8651$F(S)\\times F(S)$\uff0c\u5b83\u7684\u610f\u4e49\u662f\u8bf4\u5c06\u7ebf\u6027\u57fa\u5185\u7684\u5143\u7d20\u8fdb\u884c\u81ea\u6211\u7684\u5f02\u6216\u3002\u548c$2^{cnt}$\u7684\u8bc1\u6cd5\u4e00\u6837\uff0c\u6211\u4eec\u4efb\u610f\u9009\u62e9$F(S)$\u4e2d\u7684\u4e00\u4e2a\u70b9\u603b\u80fd\u901a\u8fc7\u672c\u8eab\u5f02\u6216\u5f97\u5230\uff0c\u6240\u4ee5\u6bcf\u4e00\u79cd\u5143\u7d20\u53d6\u503c\u662f$2^{cnt}$\u79cd\u7684\u3002\u6240\u4ee5$F(S)\\times F(S)[x^i]=[i\\in Z(S)]2^{cnt}$\u3002\u800c\u4e14\u7531\u4e8e$FWT$\u662f\u4e00\u4e2a\u7ebf\u6027\u53d8\u6362\uff0c\u6240\u4ee5\u6211\u4eec\u6709$FWT_i(F(S))\\times FWT_i(F(S))=2^{cnt}\\times FWT_i(F(S))$\u3002\u6613\u77e5$FWT_i(F(S))$\u7684\u53d6\u503c\u53ea\u6709$2^{cnt}, 0$\u4e24\u79cd\u3002\n\n$2.$\u82e5$FWT_i(F(S))=2^{cnt}$\uff0c\u5219$pc(i\\&j)$\u5747\u4e3a\u5076\u6570\u3002\n\n\u8003\u8651$FWT_i(F(S))=\\sum_{j\\in Z(S)}(-1)^{pv(i\\&j)}F[j]$\uff0c\u7531\u4e8e$F[j]=1$\uff0c\u800c\u9879\u6570\u53ea\u6709$2^{cnt}$\uff0c\u6bcf\u4e00\u9879\u6700\u5927\u503c\u662f$1$\uff0c\u6240\u4ee5\u53ea\u6709\u6bcf\u4e00\u9879\u90fd\u662f\u53d6\u5230$1$\u7684\u65f6\u5019\u624d\u6709\u53ef\u80fd\u53d6\u5230$2^{cnt}$\uff0c\u6b64\u65f6$pc(i\\&j)$\u5747\u4e3a\u5076\u6570\n\n$3.$\u6240\u6709\u6ee1\u8db3$FWT_i(F(S))=2^{cnt}$\u7684\u6240\u6709$i$\u672c\u662f\u662f\u4e00\u4e2a\u7ebf\u6027\u57fa\u3002\n\n\u8003\u8651$FWT_i(F(S))=2^{cnt}$\u5f53\u4e14\u4ec5\u5f53\u6240\u6709$pc(i\\&j)$\u5747\u4e3a\u5076\u6570\uff0c\u90a3\u4e48\u5982\u679c$FWT_i(F(S))=2^{cnt}$\uff0c\u5e76\u4e14$FWT_j(F(S))=2^{cnt}$\uff0c\u90a3\u4e48$FWT_{i\\oplus j}(F(S))=2^{cnt}$\u3002\u8bc1\u660e\u6bd4\u8f83\u663e\u7136\u3002\u6240\u4ee5\u6211\u4eec\u7b26\u5408\u6761\u4ef6\u7684\u96c6\u5408\u4e00\u5b9a\u662f\u4e00\u4e2a\u5c01\u95ed\u96c6\u5408\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u88ab\u4e00\u4e2a\u7ebf\u6027\u57fa\u6765\u8868\u793a\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u627e\u5230\u8fd9\u4e2a\u7ebf\u6027\u57fa\u5c31\u53ef\u4ee5\u6c42\u51fa$FWT_i(F(S))$\u7684\u70b9\u503c\u3002\n\n$4.$\u6ee1\u8db3\u7ed3\u8bba$3$\u7684\u7ebf\u6027\u57fa\u5927\u5c0f\u4e3a$n-cnt$\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ebf\u6027\u57fa\u3002\n\n\u6211\u4eec\u628a\u7ed3\u8bba$3$\u4e2d\u7684\u4e00\u4e2a\u5f15\u7406\u53cd\u8fc7\u6765\u7528\uff0c\u663e\u7136\u4ecd\u7136\u6210\u7acb\u3002\u90a3\u4e48\u5982\u679c$pc(i\\&k)$\u4e3a\u5747\u5076\u6570\uff0c\u5e76\u4e14$pc(j\\&k)$\u4e3a\u5747\u5076\u6570\uff0c\u90a3\u4e48$pc((i\\oplus j)\\&k)$\u4e5f\u5747\u4e3a\u5076\u6570\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6ee1\u8db3\u539f\u7ebf\u6027\u57fa\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u548c\u65b0\u7684\u7ebf\u6027\u57fa\u4e2d\u7684\u5143\u7d20\u6ee1\u8db3$pc(i\\&j)$\u5747\u4e3a\u5076\u6570\u90a3\u4e48\u8fd9\u4e2a\u65b0\u7684\u7ebf\u6027\u57fa\u5c31\u662f\u5408\u6cd5\u7684\u3002\n\n\u6211\u4eec\u5bf9\u539f\u7ebf\u6027\u57fa\u7684\u6bcf\u4e00\u4f4d\u8fdb\u884c\u9ad8\u65af\u6d88\u5143\uff0c\u4e5f\u5c31\u662f\u5c06\u6bcf\u4e00\u4e2a\u57fa\u4f4d\u90fd\u53ea\u6709\u4e00\u4e2a\u6570\u662f$1$\uff0c\u800c\u975e\u57fa\u4f4d\u53ef\u80fd\u4e3a$0$\u4e5f\u53ef\u80fd\u4e3a$1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ebf\u6027\u57fa\u663e\u7136\u548c\u539f\u7ebf\u6027\u57fa\u7b49\u4ef7\uff0c\u6211\u4eec\u53ea\u8981\u6ee1\u8db3\u8fd9\u4e2a\u7ebf\u6027\u57fa\u5408\u6cd5\u5373\u53ef\u3002\n\n\u8003\u8651\u600e\u4e48\u6784\u9020\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u975e\u57fa\u4f4d\uff0c\u6211\u4eec\u6784\u9020\u7684\u65b0\u7ebf\u6027\u57fa\u4e2d\u6539\u4e3a\u628a\u5b83\u53d8\u6210$1$\uff0c\u6b64\u65f6\u7531\u4e8e\u8981\u4fdd\u8bc1\u548c\u539f\u7ebf\u6027\u57fa\u5e76\u8d77\u6765\u4e3a\u5076\u6570\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6240\u6709\u8fd9\u4e00\u4f4d\u4e3a$1$\u7684\u7ebf\u6027\u57fa\u4e2d\u7684\u5143\u7d20\uff0c\u627e\u5230\u4ed6\u8868\u793a\u7684\u57fa\u4f4d\uff0c\u8ba9\u8fd9\u4e2a\u65b0\u7684\u7ebf\u6027\u57fa\u5bf9\u5e94\u4f4d\u7f6e\u6539\u6210$1$\u3002\u7136\u540e\u4e00\u76f4\u8fd9\u4e48\u6784\u9020\u51fa$m-cnt$\u4f4d\u7684\u65b0\u7ebf\u6027\u57fa\u3002\n\n\u4e0b\u9762\u6765\u8bc1\u660e\u4e3a\u4ec0\u4e48\u662f\u5bf9\u7684\uff1a\u7531\u4e8e\u57fa\u4f4d\u4e0a\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u662f$1$\uff0c\u90a3\u4e48\u6211\u4eec\u628a\u8fd9\u4e00\u4f4d\u6539\u6210$1$\u53ea\u4f1a\u8ba9\u8fd9\u4e2a\u5143\u7d20\u7684\u5947\u5076\u6027\u53d8\u5316\u3002\u6211\u4eec\u6bcf\u6b21\u628a\u8fd9\u4e00\u4f4d\u53d8\u6210$1$\u7684\u65f6\u5019\uff0c\u5f53\u4e14\u4ec5\u5f53\u65b0\u7ebf\u6027\u57fa\u5728\u975e\u57fa\u4f4d\u4e0a\u548c\u4ed6\u6709\u4e00\u4e2a\u5339\u914d\uff0c\u6240\u4ee5\u4e24\u4e2a\u5339\u914d\u62b5\u6d88\uff0c\u5947\u5076\u6027\u4e0d\u53d8\u3002\u6240\u4ee5\u6211\u4eec\u8fd9\u6837\u6784\u9020\u7684\u7ebf\u6027\u57fa\u662f\u7b26\u5408\u6211\u4eec\u7684\u9884\u671f\u7684\u3002\n\n\u6211\u4eec\u4ee4\u6c42\u51fa\u7684\u65b0\u7ebf\u6027\u57fa\u4e3a$B$\u3002$FWT_i(F(S))$\u5728$B$\u6240\u80fd\u8868\u793a\u7684\u5143\u7d20\u4f4d\u7f6e\u4e0a\u4e3a$2^{cnt}$\uff0c\u5176\u4f59\u4f4d\u7f6e\u4e0a\u4e3a$0$\n\n---\n\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u5f97\u5230$FWT_i(F(S))$\u4e86\uff0c\u90a3\u4e48\u73b0\u5728\u95ee\u9898\u4e3b\u8981\u662f\u600e\u4e48\u5feb\u901f\u5f97\u5230$FWT_i(G_c(S))$\u3002\u53d1\u73b0$FWT_i(G_c(S))$\u4e5f\u6709\u60ca\u4eba\u7684\u6027\u8d28\u3002$G_c(S)=\\sum_{i\\in S}[pc(i)==c]x^i$\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651$FWT_i(G_c(S))$\u3002\u540c\u6837\u6211\u4eec\u9700\u8981\u4e00\u4e9b\u6027\u8d28\u3002\n\n$1.$\u5bf9\u4e8e$pc(i)=pc(j)$\uff0c\u6ee1\u8db3$FWT_i(G_c(S))=FWT_j(G_c(S))$\u3002\n\n\u8003\u8651$FWT_i(G_c(S))$\u7684\u5b9a\u4e49\u5f0f\uff0c\u4e5f\u5c31\u662f$\\sum_{j\\in S}G_c[j](-1)^{pc(i\\& j)}$\u3002\u7531\u4e8e\u6211\u4eec\u662f\u679a\u4e3e\u7684\u5168\u96c6\uff0c\u90a3\u4e48$FWT_i(G_c(S))$\u663e\u7136\u7b49\u4e8e$FWT_j(G_c(S))$\u3002\n\n$2.FWT_i(G_c(S))=\\sum_{0\\le k}(-1)^k\\dbinom{pc(i)}{k}\\dbinom{m-pc(i)}{c-k}$\n\n\u8003\u8651\u5b9a\u4e49\u5f0f\uff0c\u679a\u4e3e$pc(i\\&j)=k$\uff0c\u7531\u4e8e\u6211\u4eec\u662f\u679a\u4e3e\u7684\u5168\u96c6\uff0c\u90a3\u4e48$j$\u5728$pc(i)$\u4e2a\u4f4d\u7f6e\u4e2d\u80af\u5b9a\u8981\u9009\u62e9$k$\u4e2a\u4f4d\u7f6e\uff0c\u5728\u5269\u4e0b\u7684$m-pc(i)$\u4e2a\u4f4d\u7f6e\u4e2d\u9009\u62e9$c-k$\u4e2a\u4f4d\u7f6e\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f97\u51fa\u4e0a\u9762\u7684\u5f0f\u5b50\u3002\n\n---\n\n\u90a3\u4e48\u73b0\u5728\u53ef\u4ee5\u6c42\u51fa$FWT(F(S))$\u4ee5\u53ca$FWT(G_c(S))$\u4e86\uff0c\u6211\u4eec\u73b0\u5728\u8003\u8651\u600e\u4e48\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u4ee4$p(i, B)$\u8868\u793a\u5143\u7d20$i$\u662f\u5426\u5728\u6211\u4eec\u5f97\u5230\u7684\u65b0\u7ebf\u6027\u57fa$B$\u4e2d\u51fa\u73b0\u8fc7\u3002\n\n\u8003\u8651\u5230\uff1a\n$$ans_c=2^{n-cnt}\\times F(S)\\times G_c(S)[x^0]=2^{n-cnt}\\times IFWT(FWT(F(S))\\times FWT(G_c(S)))[x^0]$$\n\u800c$IFWT(i)[x^0]=\\dfrac{1}{2^m}FWT(i)[z^0]$\uff0c\u6240\u4ee5\uff1a\n$$ans_c=\\dfrac{1}{2^m}\\times 2^{n-cnt}\\times \\Bigg(\\sum_{i\\in S}2^{cnt}p(i, B)\\times \\sum_{0\\le k}(-1)^k\\dbinom{pc(i)}{k}\\dbinom{m-pc(i)}{c-k}\\Bigg)$$\n### $\\rm Code:$\n```cpp\n/* This code is written by Nemlit */\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define rep(i, a, b) for(int i = (a); i <= (b); ++ i)\n#define drep(i, a, b) for(int i = (b); i >= (a); -- i)\n#define mod 998244353\nint qpow(int a, int b) {\n\tint r = 1;\n\twhile(b) {\n\t\tif(b & 1) r = r * a % mod;\n\t\ta = a * a % mod, b >>= 1;\n\t}\n\treturn r;\n}\nint read() {\n    int x = 0, f = 1; char c = getchar();\n    while(c < '0' || c > '9') { if(c == '-') f = -1; c = getchar();}\n    while(c >= '0' && c <= '9') x = x * 10 + c - 48, c = getchar();\n    return x * f;\n}\n#define N 200005\n#define M 60\nint n, m, b[N], a[N], c[N], ans[N], d[N], cnt, fac[N], inv[N], dp[M][M], w[N];\nvoid insert(int x) {\n\tdrep(i, 0, m) {\n\t\tif(!(x & (1ll << i))) continue;\n\t\tif(d[i]) x ^= d[i];\n\t\telse return d[i] = x, ++ cnt, void();\n\t}\n}\nint C(int n, int m) {\n\tif(n < m) return 0;\n\treturn fac[n] * inv[m] % mod * inv[n - m] % mod;\n}\nvoid dfs(int x, int S) {\n\tif(x > m) return ++ ans[__builtin_popcountll(S)], void();\n\tdfs(x + 1, S);\n\tif(d[x]) dfs(x + 1, S ^ d[x]);\n}\nvoid dfs1(int x, int S) {\n\tif(x < 0) return ++ w[__builtin_popcountll(S)], void();\n\tdfs1(x - 1, S);\n\tif(b[x]) dfs1(x - 1, S ^ b[x]);\n}\nsigned main() {\n\tn = read(), m = read(), inv[0] = fac[0] = 1;\n\trep(i, 1, m) fac[i] = fac[i - 1] * i % mod, inv[i] = qpow(fac[i], mod - 2);\n\trep(i, 1, n) a[i] = read(), insert(a[i]);\n\tif(cnt <= 26) dfs(0, 0);\n\telse {\n\t\tdrep(i, 0, m) drep(j, 0, m) if((d[j] & (1ll << i)) && (i != j)) d[j] ^= d[i];\n\t\tdrep(i, 0, m - 1) {\n\t\t\tif(d[i]) continue;\n\t\t\tb[i] = (1ll << i);\n\t\t\trep(j, 0, m) if(d[j] & (1ll << i)) b[i] |= (1ll << j);\n\t\t}\n\t\trep(i, 0, m) rep(j, 0, m) rep(k, 0, m) {\n\t\t\tif(k & 1) dp[i][j] = (dp[i][j] - C(j, k) * C(m - j, i - k) % mod + mod) % mod;\n\t\t\telse dp[i][j] = (dp[i][j] + C(j, k) * C(m - j, i - k) % mod) % mod;\n\t\t}\n\t\tdfs1(m, 0);\n\t\trep(i, 0, m) rep(j, 0, m) ans[j] = (ans[j] + 1ll * dp[j][i] * w[i] % mod) % mod;\n\t\trep(i, 0, m) ans[i] = qpow(2, cnt) * ans[i] % mod * qpow(qpow(2, m), mod - 2) % mod;\n\t}\n\trep(i, 0, m) printf(\"%lld \", ans[i] * qpow(2, n - cnt) % mod); \n\treturn 0;\n}\n```",
        "postTime": 1603467293,
        "uid": 57014,
        "name": "Nemlit",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1336E2 \u3010Chiori and Doll Picking (hard version)\u3011"
    },
    {
        "content": "> \u9898\u76ee\u94fe\u63a5\uff1a[CF1336E Chiori and Doll Picking](https://www.luogu.com.cn/problem/CF1336E2)\n\n> **\u672c\u9898\u89e3\u540c\u6b65\u53d1\u5e03\u4e8e [My Blog](http://www.cxy07.blog/index.php/archives/291/)**\n\n\u9898\u610f\uff1a\n\n> \u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $\\{a_n\\}$\uff0c$\\forall i\\in [1,n],\\ a_i\\in[0,2^m)$\u3002\n\n> \u5bf9 $c\\in[0,m]$\uff0c\u8ba1\u7b97\u6709\u591a\u5c11\u5b50\u5e8f\u5217\u7684\u5f02\u6216\u548c\u7684 $\\text{popcount}=c$\u3002\n\n> $1\\le n\\le 2\\times 10^5,0\\le m\\le 53$\u3002\n\n~~\u770b\u4e86\u4e00\u5e74 \u7ec8\u4e8e\u770b\u61c2\u4e86~~\n\n\u9996\u5148\uff0c\u5bf9\u4e8e\u5b50\u5e8f\u5217\u7684\u5f02\u6216\u548c\u8fd9\u79cd\u64cd\u4f5c\uff0c\u8ba9\u6211\u4eec\u8054\u60f3\u5230\u7ebf\u6027\u57fa\u3002\u5c06\u4e00\u4e2a\u6574\u6570\u770b\u4f5c $\\mathbb{F}_2$ \u4e0a\u7684 $m$ \u7ef4\u5411\u91cf\uff0c\u8bbe $V=\\text{span}(a_1,a_2,\\cdots,a_n)$\uff0c\u5373\u5e8f\u5217\u4e2d\u5143\u7d20\u5f20\u51fa\u7684\u5411\u91cf\u7a7a\u95f4\uff0c$k=\\dim V$\uff0c\u5373\u7ebf\u6027\u57fa\u7684\u5927\u5c0f\u3002\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u4efb\u610f $x\\in V$\uff0c\u90fd\u6709\u6070\u597d $2^{n-k}$ \u79cd\u65b9\u5f0f\u901a\u8fc7\u5e8f\u5217\u4e2d\u7684\u5143\u7d20\u5f02\u6216\u6765\u5f97\u5230\u4ed6\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5c06\u95ee\u9898\u8f6c\u53d8\u4e3a\u5728\u7ebf\u6027\u57fa\u4e0a\u8ba1\u7b97\u7b54\u6848\uff0c\u6700\u540e\u5c06\u7b54\u6848 $\\times 2^{n-k}$\u3002\n\n\u5bf9\u7ebf\u6027\u57fa\u5927\u5c0f\u8fdb\u884c\u8ba8\u8bba\u3002\n\n\u5f53 $k\\le 26$ \u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5 $\\mathcal{O}(2^{k})$ \u679a\u4e3e\u7ebf\u6027\u57fa\u4e2d\u6bcf\u4e2a\u5143\u7d20\u662f\u5426\u88ab\u9009\u62e9\u3002\n\n\u800c\u5728 $k>26$ \u7684\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u5f97\u5230\u4e00\u4e2a $\\mathcal{O}(2^{m-k})$ \u7684\u7b97\u6cd5\uff0c\u5c06\u4e24\u4e2a\u7b97\u6cd5\u7ed3\u5408\u5f97\u5230\u4e00\u4e2a $\\mathcal{O}(2^{\\frac{m}{2}})$ \u7684\u7b97\u6cd5\u3002\u8bbe\uff1a\n\n$$\nA_i=[i\\in V]\n$$\n\n$$\nF^{(c)}_i=[\\text{popcount}(i)=c]\n$$\n\n\u5219\u6211\u4eec\u9700\u8981\u7684\u5e94\u8be5\u662f\uff1a\n\n$$\n\\text{Ans}_c=\\sum_{i=0}^{2^m-1} A_i F^{(c)}_i\n$$\n\n\u5373\u6211\u65e2\u8981\u80fd\u88ab\u5f20\u51fa\uff0c\u53c8\u8981\u6ee1\u8db3 $\\text{popcount}$ \u4e3a\u5b9a\u503c $c$\u3002\u53ef\u4ee5\u5199\u4f5c\uff1a\n\n$$\n\\sum_{i=0}^{2^m-1} A_i\\sum_{j=0}^{2^m-1} F^{(c)}_j [i=j]\n$$\n\u5c06\u5176\u5199\u6210\u5f02\u6216\u5377\u79ef\u7684\u5f62\u5f0f\uff0c$i=j\\iff i\\oplus j=0$\uff0c\u4e8e\u662f\u6240\u6c42\u5373\u4e3a\uff1a\n$$\n(A*F^{(c)})_0\n$$\n\n\u5176\u4e2d $*$ \u8868\u793a\u5f02\u6216\u5377\u79ef\u3002\u6211\u4eec\u4ee4 $\\langle i,j\\rangle=\\text{popcount}(i \\text{ and }j)\\bmod 2$\uff0c\u5373 $i,j$ \u6309\u4f4d\u4e0e\u7684\u4e8c\u8fdb\u5236\u4f4d\u4e0b $1$ \u7684\u4e2a\u6570\u5947\u5076\u6027\u3002\u7531\u4e8e\u5df2\u7ecf\u8f6c\u5316\u4e3a\u5f02\u6216\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u4e0d\u59a8\u8003\u8651 $\\text{FWT}(A)$ \u4e0e $\\text{FWT}(F^{(c)})$\u3002\n\n\u9996\u5148\u8003\u8651 $\\hat F^{(c)} =\\text{FWT}(F^{(c)})$\uff0c\u4ed6\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n$$\n\\hat F^{(c)}_i=\\sum_{\\text{popcount(j)=c}} (-1)^{\\langle i, j\\rangle}\n$$\n\u4ee4 $\\text{popcount}(i)=a$\uff0c\u679a\u4e3e $b=\\text{popcount}(i\\text{ and }j)$\uff0c\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n$$\n\\hat F^{(c)}_i=\\sum_{\\text{popcount(j)=c}} (-1)^{\\langle i, j\\rangle}=\\sum_{b=0}^m (-1)^b \\binom{m-a}{c-b}\\binom{a}{b}\n$$\n\u6ce8\u610f\u5230\u5176\u503c\u53ea\u4e0e $a,c$ \u76f8\u5173\uff0c\u8bbe\u5176\u4e3a $f(a,c)$\u3002\u63a5\u4e0b\u6765\u8003\u8651 $\\hat A=\\text{FWT}(A)$\uff0c\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n$$\n\\hat A_i=\\sum_{j\\in V}(-1)^{\\langle i,j\\rangle}\n$$\n\u7ed9\u51fa\u5982\u4e0b\u7ed3\u8bba\uff1a\n\n> \u5bf9\u4e8e\u4efb\u610f $i\\in[0,2^m)$\uff0c\u6709 $\\hat A_i\\in\\{0, 2^k\\}$\u3002\n\n\u8bc1\u660e\uff1a\n\n\u9996\u5148\uff0c\u4e00\u4e2a\u4e8b\u5b9e\u662f\uff1a$\\langle a,c\\rangle\\oplus \\langle b,c\\rangle=\\langle a\\oplus b, c\\rangle$\u3002\u5bf9\u4e8e $\\forall x\\in V$\uff0c\u5728\u679a\u4e3e\u7684\u5143\u7d20 $j$ \u5728\u904d\u5386 $V$ \u4e2d\u6240\u6709\u5143\u7d20\u7684\u65f6\u5019\uff0c$j\\oplus x$ \u4e5f\u5728\u904d\u5386 $V$ \u4e2d\u6240\u6709\u5143\u7d20\u3002\u56e0\u6b64\u5982\u679c $\\exists j\\in V$\uff0c$\\langle i, j\\rangle=1$\uff0c\u5219 $\\langle i,j\\oplus x\\rangle=0$\uff0c\u4e8e\u662f\u4e0a\u8ff0 $\\hat A_i$ \u4e2d $\\pm 1$ \u8d21\u732e\u62b5\u6d88\uff0c\u548c\u4e3a $0$\u3002\n\n\u5982\u679c $\\forall j\\in V, \\langle i,j\\rangle=0$\uff0c\u5219 $\\hat A_i = 2^k$\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u662f\u4e00\u4e2a\u9f50\u6b21\u7ebf\u6027\u65b9\u7a0b\u7ec4\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u627e\u5230\u4e00\u7ec4\u57fa\u7840\u89e3\u7cfb\uff0c\u8fd9\u4e9b\u5411\u91cf\u5f20\u51fa\u7684\u5411\u91cf\u7a7a\u95f4\u4e2d\u6bcf\u4e2a\u5143\u7d20\u90fd\u6ee1\u8db3 $\\hat A_i=2^k$\u3002\u8bbe\u539f\u7ebf\u6027\u57fa\u6d88\u5143\u4e4b\u540e\u4e3a $M$\uff0c\u5219 $M$ \u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n$$\nM=\\begin{bmatrix} E_k & X \\end{bmatrix}\n$$\n\u53ef\u4ee5\u53d1\u73b0\uff0c$\\begin{bmatrix} X\\\\E_{m-k}\\end{bmatrix}$ \u7684\u5217\u5411\u91cf\u6784\u6210\u57fa\u7840\u89e3\u7cfb\uff08\u53ef\u4ee5\u9a8c\u8bc1\u4e24\u4e24\u6309\u4f4d\u4e0e\u540e $1$ \u7684\u4e2a\u6570\u4e3a\u5076\u6570\uff09\u3002\u7531\u4e8e\u8fd9\u91cc\u6709 $m-k$ \u4e2a\u5411\u91cf\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728 $\\mathcal{O}(2^{m-k})$ \u7684\u65f6\u95f4\u5185\uff0c\u627e\u5230\u6240\u6709 $\\hat A_i=2^k$ \u7684\u4f4d\u7f6e $i$\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u6240\u6c42\u7684\u7b54\u6848\uff1a\n$$\n\\text{Ans}_c=\\sum_{i=0}^{2^m-1} A_i F^{(c)}_i=(A*F^{(c)})_0=\\dfrac{1}{2^{m}}\\sum_{i=0}^{2^m-1} \\hat A_i\\hat F^{(c)}_i\n$$\n\n$$\n=\\dfrac{1}{2^m}\\sum_{a=0}^m 2^k\\text{cnt}_a\\times f(a,c)\n$$\n\n\u5176\u4e2d $\\text{cnt}_a$ \u8868\u793a $\\hat A_i =2^k$ \u7684 $i$ \u4e2d\uff0c$\\text{popcount}(i)=a$ \u7684\u4f4d\u7f6e\u4e2a\u6570\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u795e\u5947\u7684 $\\mathcal{O}(2^{m-k})$ \u505a\u6cd5\u3002\u7ed3\u5408\u5bf9\u7ebf\u6027\u57fa\u5185\u5143\u7d20\u641c\u7d22\u7684\u66b4\u529b\uff0c\u53ef\u4ee5\u5f97\u5230 $\\mathcal{O}(2^{\\frac{m}{2}})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n```cpp\n//Code By CXY07 - It's My Fiesta.\n#include<bits/stdc++.h>\nusing namespace std;\n\n//#define FILE\n#define int long long\n#define randint(l, r) (rand() % ((r) - (l) + 1) + (l))\n#define abs(x) ((x) < 0 ? (-(x)) : (x))\n#define popc(x) __builtin_popcountll(x)\n#define inv(x) qpow((x), mod - 2)\n#define lowbit(x) ((x) & (-(x)))\n#define ull unsigned long long\n#define pii pair<int, int>\n#define LL long long\n#define mp make_pair\n#define pb push_back\n#define scd second\n#define vec vector\n#define fst first\n#define endl '\\n'\n#define y1 _y1\n\nconst int MAXN = 2e5 + 10;\nconst int MAXD = 60;\nconst int INF = 2e9;\nconst double eps = 1e-6;\nconst double PI = acos(-1);\n//const int mod = 1e9 + 7;\nconst int mod = 998244353;\n//const int G = 3;\n//const int base = 131;\n\nint n, m, k, tot;\nint a[MAXN], d[MAXD], b[MAXD], cnt[MAXD], Ans[MAXD], s[MAXD];\nint f[MAXD][MAXD], C[MAXD][MAXD];\n\ntemplate<typename T> inline bool read(T &a) {\n\ta = 0; char c = getchar(); int f = 1;\n\twhile(c < '0' || c > '9') { if(c == '-') f = -1; c = getchar(); }\n\twhile(c >= '0' && c <= '9') { a = a * 10 + (c ^ 48); c = getchar(); }\n\treturn a *= f, true;\n}\n\ntemplate<typename A, typename ...B>\ninline bool read(A &x, B &...y) { return read(x) && read(y...); }\n\nvoid Insert(int x) {\n\tfor(int i = m - 1; ~i; --i) {\n\t\tif(!((x >> i) & 1)) continue;\n\t\tif(!d[i]) return d[i] = x, ++k, void();\n\t\tx ^= d[i];\n\t}\n}\n\nint qpow(int x, int b) {\n\tint res = 1; if(b < 0) b += mod - 1;\n\tfor(; b; b >>= 1, (x *= x) %= mod) if(b & 1) (res *= x) %= mod;\n\treturn res;\n}\n\nvoid DFS(int x, int S) {\n\tif(x > tot) return ++cnt[popc(S)], void();\n\tDFS(x + 1, S);\n\tif(s[x]) DFS(x + 1, S ^ s[x]);\n}\n\nsigned main () {\n#ifdef FILE\n\tfreopen(\"CF1336E2.in\", \"r\", stdin);\n\tfreopen(\"CF1336E2.out\", \"w\", stdout);\n#endif\n\tread(n), read(m);\n\tfor(int i = 0; i < MAXD; ++i) {\n\t\tC[i][0] = 1;\n\t\tfor(int j = 1; j <= i; ++j)\n\t\t\tC[i][j] = (C[i - 1][j] + C[i - 1][j - 1]) % mod;\n\t}\n\tfor(int i = 1; i <= n; ++i) read(a[i]), Insert(a[i]);\n\tif(k <= 26) {\n\t\tfor(int i = 0; i <= m; ++i) if(d[i]) s[++tot] = d[i];\n\t\tDFS(0, 0);\n\t\tfor(int i = 0; i <= m; ++i) Ans[i] = cnt[i];\n\t} else {\n\t\tfor(int i = m - 1; ~i; --i)\n\t\t\tfor(int j = 0; j < m; ++j)\n\t\t\t\tif(i != j && (d[j] >> i) & 1) d[j] ^= d[i];\n\t\tfor(int i = 0; i < m; ++i) {\n\t\t\tif(d[i]) continue;\n\t\t\tb[i] = (1ll << i); \n\t\t\tfor(int j = 0; j < m; ++j) if((d[j] >> i) & 1) b[i] |= (1ll << j);\n\t\t} \n\t\tfor(int i = 0; i <= m; ++i) if(b[i]) s[++tot] = b[i];\n\t\tfor(int a = 0; a <= m; ++a)\n\t\t\tfor(int c = 0; c <= m; ++c)\n\t\t\t\tfor(int b = 0, opt = 1; b <= c; ++b) {\n\t\t\t\t\t(f[a][c] += C[m - a][c - b] * C[a][b] % mod * opt) %= mod;\n\t\t\t\t\topt = (mod - opt) % mod;\n\t\t\t\t}\n\t\tDFS(0, 0);\n\t\tfor(int i = 0; i <= m; ++i) {\n\t\t\tfor(int j = 0; j <= m; ++j) (Ans[i] += cnt[j] * f[j][i]) %= mod;\n\t\t\tAns[i] = Ans[i] * qpow(2, k - m) % mod;\n\t\t}\n\t}\n\tfor(int i = 0; i <= m; ++i) Ans[i] = Ans[i] * qpow(2, n - k) % mod;\n\tfor(int i = 0; i <= m; ++i) printf(\"%lld \", Ans[i]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1635841004,
        "uid": 53489,
        "name": "CXY07",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011CF1336E Chiori and Doll Picking"
    },
    {
        "content": "* \u53ea\u8981\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u6c42\u51fa\u7ed9\u5b9a\u6570\uff08\u5f62\u6210\u7684\u7ebf\u6027\u57fa $A$\uff09\u5f20\u6210\u7684\u7a7a\u95f4\u4e2d\u6709\u591a\u5c11\u503c\u7684popcount\u4e3a $i$ \uff08\u8bb0\u4e3a $p_i$\uff09\uff0c\u90a3\u4e48\u95ee\u9898\u5c31\u8fce\u5203\u800c\u89e3\u4e86\u3002\n* \u5982\u679c\u7ebf\u6027\u57fa\u5927\u5c0f $k\\le m-k$\uff0c\u90a3\u4e48\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u6bcf\u4e2a\u57fa\u9009\u6216\u4e0d\u9009\u5373\u53ef\uff0c\u53ef\u4ee5\u505a\u5230 $O(2^{\\frac{m}{2}})$\u3002\n* \u5426\u5219\u8003\u8651\u628a $p_c$ \u8868\u793a\u4e3a\u4e24\u4e2a\u6570\u7ec4\u7684xor\u5377\u79ef\u7ed3\u679c\u7684\u7b2c $0$ \u9879\uff1a\n  * $F[i]=[i\\in S]$\n  * $G_c[i]=[popcount(i)=c]$\n* $FWT(F)$ \u6570\u7ec4\u6709\u4e09\u4e2a\u91cd\u8981\u7684\u6027\u8d28\uff1a\n  * \u6027\u8d28\u4e00\uff1a\u5176\u53d6\u503c\u53ea\u53ef\u80fd\u662f $0$ \u6216 $2^k$\u3002\n    * \u8bc1\u660e\u4e00\uff1a\u7531\u7ebf\u6027\u57fa\u5f20\u6210\u7a7a\u95f4\u7684\u5c01\u95ed\u6027\uff0c $(F\\oplus F)[i]=[i\\in S]2^k$\uff0c\u56e0\u6b64 $FWT(F)[i]\\times FWT(F)[i]=FWT(F)[i]\\times 2^k$\u3002\n  * \u6027\u8d28\u4e8c\uff1a $FWT(F)[i]=2^k$ \u7684\u5145\u8981\u6761\u4ef6\u662f $\\prod\\limits_{j\\in S}[2|popcount(i\\&j)]=1$\u3002\n    * \u8bc1\u660e\u4e8c\uff1a$FWT(H)[i]=\\sum\\limits_{j=0}^{2^m-1}H[j](-1)^{popcount(i\\&j)}$\uff0c $F[j]$ \u53ea\u6709\u6070\u597d $2^k$ \u4e2a\u4f4d\u7f6e\u6709\u503c\u4e14\u503c\u4e3a $1$\uff0c\u800c\u5982\u679c $popcount(i\\&j)$ \u4e3a\u5947\u6570\uff0c\u90a3\u4e48\u4e00\u5b9a\u6709\u4e00\u9879\u4e3a $-1$\uff0c\u8fd9\u6837\u7ed3\u679c\u5c31\u722c\u4e0d\u5230 $2^k$ \u4e86\u3002\u53cd\u4e4b\u663e\u7136\u6210\u7acb\u3002\n  * \u6027\u8d28\u4e09\uff1a $FWT(F)[i]=2^k$ \u7684\u6240\u6709 $i$ \u53ef\u4ee5\u7531\u4e00\u7ec4\u7ebf\u6027\u57fa $B$ \u5f20\u6210\uff0c\u4e14 $B$ \u6070\u597d\u4e0e $A$ \u201c\u4e92\u8865\u201d\uff08\u6bcf\u4e2a\u4e3b\u5143\u6070\u88ab\u4e00\u4e2a\u57fa\u62e5\u6709\uff09\u3002\n    * \u8bc1\u660e\u4e09\uff1a\u5982\u4e0b\u56fe\uff08\u5b98\u65b9\u9898\u89e3\u56fe\uff09\u3002\u6211\u4eec\u9009\u7528\u9ad8\u65af-\u7ea6\u65e6\u6d88\u5143\u5f62\u6210\u7684\u5bf9\u89d2\u7ebf\u6027\u57fa\u3002\u6211\u4eec\u53ef\u4ee5\u628a $A$ \u7684\u4e3b\u5143\u632a\u5230\u5de6\u4e0a\u89d2\u6765\uff0c \u5e76\u6784\u9020\u5982\u56fe\u6240\u793a\u7ebf\u6027\u57fa $B$\uff0c\u6ee1\u8db3\u53f3\u4e0b\u89d2\u662f\u5bf9\u89d2\u77e9\u9635\uff0c\u5de6\u4e0b\u89d2\u548c\u53f3\u4e0a\u89d2\u5173\u4e8e\u4e3b\u5bf9\u89d2\u7ebf\u5bf9\u79f0\u3002\u4e0d\u96be\u53d1\u73b0 $B$ \u7684\u6bcf\u4e00\u4f4d\u57fa\u4e0e $A$ \u7684\u6bcf\u4e00\u4f4d\u57fa\u4e0e\u8d77\u6765popcount\u90fd\u662f\u5076\u6570\uff0c\u800cxor\u662f\u4e0d\u8fdb\u4f4d\u52a0\u6cd5\uff0c\u56e0\u6b64\u4e24\u4e2a\u57fa\u5185\u90e8xor\u4e0d\u4f1a\u5f71\u54cd\u4e24\u8fb9\u4e0e\u8d77\u6765\u7684popcount\u5947\u5076\u6027\u3002\u800c\u6ee1\u8db3\u6761\u4ef6\u7684\u6240\u6709\u503c\u90fd\u5728 $B$ \u5f20\u6210\u7684\u7a7a\u95f4\u4e2d\uff0c\u5426\u5219\u53ef\u4ee5\u7406\u89e3\u4e3a\u9009\u62e9\u4e86 $B$ \u4e2d\u6240\u6709\u9700\u8981\u9009\u7684\u4e3b\u5143xor\uff0c\u8fd8\u591a\u51fa\u4e00\u4e9b\u4f4d\u65e0\u6cd5\u7528 $B$ \u7684\u4e3b\u5143\u8868\u793a\u7684\uff08\u8fd9\u4e9b\u4f4d\u5728\u7ad6\u4e2d\u7ebf\u4ee5\u5de6\uff09\uff0c\u800c\u540e\u8005\u4e00\u5b9a\u4f1a\u7834\u574f\u4e0e\u8fd0\u7b97\u7ed3\u679c\u7684\u5947\u5076\u6027\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u8bc1\u660e\u4e86\u5408\u6cd5\u7684\u90fd\u7edf\u8ba1\u5728\u5185\uff0c\u7edf\u8ba1\u5728\u5185\u7684\u90fd\u5408\u6cd5\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/dz2131pu.png)\n* \u800c $FWT(G_c)$ \u4e5f\u6709\u4e00\u6761\u7b80\u5355\u800c\u91cd\u8981\u7684\u6027\u8d28\uff1a\n  * \u6027\u8d28\uff1a\u5bf9\u4e8e $popcount(i)=popcount(j)$ \u7684 $(i,j)$\uff0c\u6ee1\u8db3 $FWT(G_c)[i]=FWT(G_c)[j]$\u3002\n    * \u8bc1\u660e\uff1a\u8fd8\u662f\u8fd9\u6761\u5f0f\u5b50\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4f4d\u4e4b\u95f4\u7684\u7b49\u4ef7\u7f6e\u6362\uff1a\n    $$FWT(H)[i]=\\sum\\limits_{j=0}^{2^m-1}H[j](-1)^{popcount(i\\&j)}$$\n* \u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa\u7ebf\u6027\u57fa $B$\uff0c\u5e76\u4e14\u5bf9\u5b83\u8fdb\u884cpopcount\u66b4\u641c\uff0c\u8bb0\u7ed3\u679c\u4e3a\u6570\u7ec4 $q$\uff0c\u590d\u6742\u5ea6\u540c\u6837\u662f $O(2^{\\frac{m}{2}})$\u3002\n* \u7136\u540e\uff0c\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $G_c$\uff0c\u6c42\u51fa\u5176\u4e0b\u6807\u6309\u7167popcount\u5206\u7c7b\uff0c\u6bcf\u4e00\u7c7b\u5bf9\u5e94\u7684\u503c\uff0c\u8bb0 $G_i$ \u4e2dpopcount\u4e3a $j$ \u7684\u503c\u4e3a $dp_{i,j}$\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u679a\u4e3e\u4e0e\u8fd0\u7b97\u7ed3\u679c\u7684popcount\uff0c\u4f7f\u7528\u7b80\u5355\u7ec4\u5408\u6570\u6c42\u89e3\uff1a\n$$dp_{i,j}=\\sum_{k=0}^m\\binom{j}{k}\\binom{m-j}{i-k}$$\n* \u6700\u540e\uff0c\u53ef\u4ee5\u679a\u4e3e\u4e0b\u6807\u7684popcount\u8ba1\u7b97\u5176\u76f8\u5e94\u4e0b\u6807\u5bf9\u4f4d\u76f8\u4e58\u503c\u7684\u548c\uff0c\u624b\u7b97IFWT\u540e\u7684 $0$ \u53f7\u4f4d\u7f6e\u5f97\u5230 $p$ \u6570\u7ec4\uff1a\n$$p_c=(F\\oplus G_c)[0]=\\frac{1}{2^m}\\sum\\limits_{i=0}^{2^m-1}2^kq_idp_{c,i}$$\n* \u65f6\u95f4\u590d\u6742\u5ea6 $O(n+2^{\\frac{m}{2}}+m^3)$\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cctype>\nusing namespace std;\ntypedef long long ll;\n#define G getchar()\nll read()\n{\n\tll x=0; char ch=G;\n\tfor (;!isdigit(ch);ch=G);\n\tfor (;isdigit(ch);ch=G) x=(x<<3)+(x<<1)+(ch^48);\n\treturn x;\n}\n#undef G\nconst int Mod=998244353,inv2=Mod+1>>1,MAXW=(1<<18)-1;\nint upd(int x){return x+(x>>31&Mod);}\nint qpow(int x,int y){\n\tint res=1;\n\tfor (;y;y>>=1,x=1LL*x*x%Mod)\n\t\tif (y&1) res=1LL*res*x%Mod;\n\treturn res;\n}\n\nint n,m; ll w[200010],lb[60],Atot;\nll bin[60]; int bintop; int p[60],q[60],ans[60];\nint ins(ll x){\n\tfor (int i=m-1;i>=0;i--)\n\t\tif (x>>i&1){\n\t\t\tif (lb[i]){x^=lb[i]; continue;}\n\t\t\tlb[i]=x;\n\t\t\tfor (int j=i-1;j>=0;j--) if (lb[i]>>j&1) lb[i]^=lb[j];\n\t\t\tfor (int j=i+1;j<m;j++) if (lb[j]>>i&1) lb[j]^=lb[i];\n\t\t\treturn 1;\n\t\t}\n\treturn 0;\n}\nvoid dfs(int *p){\n\tstatic ll h[1<<10]; static int popcnt[1<<18];\n\tfor (int i=1;i<=MAXW;i++) popcnt[i]=popcnt[i>>1]+(i&1);\n\tfor (int i=0;i<bintop;i++) h[(1<<i)%1007]=bin[i+1];\n\tll msk=0; p[0]++;\n\tfor (int i=1;i<(1<<bintop);i++){\n\t\tmsk^=h[(i&-i)%1007];\n\t\tp[popcnt[msk&MAXW]+popcnt[msk>>18&MAXW]+popcnt[msk>>36&MAXW]]++;\n\t}\n}\nint dp[60][60]; int C[60][60];\nint main()\n{\n\tn=read(),m=read();\n\tfor (int i=1;i<=n;i++) Atot+=ins(w[i]=read());\n\tif (Atot<=26){\n\t\tfor (int i=0;i<m;i++) if (lb[i]) bin[++bintop]=lb[i];\n\t\tdfs(p);\n\t\tint t=qpow(2,n-Atot);\n\t\tfor (int i=0;i<=m;i++) printf(\"%d%c\",ans[i]=1LL*p[i]*t%Mod,\" \\n\"[i==m]);\n\t\treturn 0;\n\t}\n\tfor (int i=0;i<m;i++) if (!lb[i]){\n\t\tll x=1LL<<i;\n\t\tfor (int j=i+1;j<m;j++)\n\t\t\tif (lb[j]>>i&1)\n\t\t\t\tx|=1LL<<j;\n\t\tbin[++bintop]=x;\n\t}\n\tdfs(q);\n\tfor (int i=0;i<=m;i++){\n\t\tC[i][0]=1;\n\t\tfor (int j=1;j<=i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%Mod;\n\t}\n\tfor (int i=0;i<=m;i++)\n\t\tfor (int j=0;j<=m;j++){\n\t\t\tfor (int k=0,t=1;k<=i&&k<=j;k++,t=Mod-t){\n\t\t\t\tdp[i][j]=(dp[i][j]+1LL*t*C[j][k]%Mod*C[m-j][i-k])%Mod;\n\t\t\t}\n\t\t}\n\tfor (int c=0;c<=m;c++)\n\t\tfor (int i=0;i<=m;i++)\n\t\t\tp[c]=(p[c]+1LL*q[i]*dp[c][i])%Mod;\n\tint t=qpow(inv2,m-Atot);\n\tfor (int i=0;i<=m;i++) p[i]=1LL*p[i]*t%Mod;\n\tt=qpow(2,n-Atot);\n\tfor (int i=0;i<=m;i++) printf(\"%d%c\",ans[i]=1LL*p[i]*t%Mod,\" \\n\"[i==m]);\n\treturn 0;\n}\n```",
        "postTime": 1587129453,
        "uid": 38182,
        "name": "dqa2022",
        "ccfLevel": 9,
        "title": "CF1336E2 Chiori and Doll Picking (hard version) \u9898\u89e3"
    },
    {
        "content": "upd on 2023.3.1\uff1a\u4fee\u4e86\u4e00\u70b9\u5c0f\u9519\u8bef\u3002\n\n2023.1.21~2023.1.27\n\n\u8fc7\u5e74\u90fd\u5728\u505a\u8fd9\u9898\u634f\u3002\n\n\u73b0\u5728\u5927\u591a\u6570\u9898\u89e3\u5199\u7684\u505a\u6cd5\u90fd\u4e0d\u662f\u6b63\u5e38\u4eba\u80fd\u60f3\u51fa\u6765\u7684\uff08\u53ef\u80fd\u6211\u6ca1\u770b\u6e05\u695a\uff09\uff0c\u51b3\u5b9a\u4ee5\u4e00\u79cd\u6bd4\u8f83\u81ea\u7136\u7684\u601d\u8def\u6765\u5199\u8fd9\u9898\u3002\n\n\u5148\u5b9a\u4e49\u8bb0\u53f7\uff1a\n\n- \u8bb0\u539f\u5e8f\u5217\u7684\u53ef\u91cd\u96c6\u4e3a $G$\u3002\n\n- $\\textsf{sig}(i)=(-1)^i$\n\n- $\\textsf{span}(S)$ \u8868\u793a $S$ \u5f20\u6210\u7684\u5411\u91cf\u7a7a\u95f4\u3002\n\n- $\\textsf{P}(x)$ \u4e3a $x$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b $1$ \u7684\u4e2a\u6570\u3002\n\n- $A,B$ \u4e3a\u96c6\u5408\uff0c\u5b9a\u4e49 $A-B$ \u4e3a\u96c6\u5408 $\\{x|x\\in A,x\\not\\in B\\}$\u3002\n\n- $\\textsf{P}_{01}(x)=\\textsf{P}(x)\\% 2$\u3002\n\n\u770b\u5230\u5f02\u6216\uff0c\u8003\u8651\u7ebf\u6027\u57fa\uff0c\u6c42\u51fa\u7ed9\u5b9a\u6570\u7ec4\u7684\u7ebf\u6027\u57fa $A$\u3002\n\n- $\\textsf{Lemma 1}$\uff1a$\\textsf{span}(A)$ \u4e2d\u7684\u6bcf\u4e2a\u6570\u90fd\u5728\u539f\u95ee\u9898\u7684 $2^n$ \u4e2a\u5b50\u5e8f\u5217\u7684\u6743\u503c\u4e2d\u51fa\u73b0\u4e86 $2^{n-|A|}$ \u6b21\u3002\n\n\u8bc1\u660e\uff1a\u5728 $G-A$ \u4e2d\u4efb\u610f\u9009\u51fa\u82e5\u5e72\u4e2a\u6570\uff0c\u8bb0\u5b83\u4eec\u7684\u5f02\u6216\u548c\u4e3a $x$\uff0c\u5219 $x\\in \\textsf{span}(A)$\uff0c\u6839\u636e\u7ebf\u6027\u57fa\u7684\u6027\u8d28\uff0c\u663e\u7136\u5f97\u5230 $\\{k|k=x\\oplus t,t\\in \\textsf{span}(A)\\}=\\textsf{span}(A)$\uff0c\u4e8e\u662f\u4efb\u610f\u4e00\u4e2a\u9009\u6cd5\u90fd\u5bf9 $\\textsf{span}(A)$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u4ea7\u751f\u5f71\u54cd\uff0c\u5f97\u8bc1\u3002\n\n\u81f3\u6b64\uff0c\u95ee\u9898\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5bf9\u4e00\u7ec4**\u7ebf\u6027\u65e0\u5173**\u7684 $A$\uff0c$|A|\\leq 53$\uff0c$\\forall i\\in[0,m]$\uff0c\u6c42 $\\sum\\limits_{x\\in\\textsf{span}(A)}[\\textsf{P}(x)=i]$\uff0c\u4ee5\u4e0b\u8bb0 $n=|A|$\u3002\n\n\u63a5\u4e0b\u6765\u53ef\u4ee5\u4f7f\u7528 meet in middle \u89e3\u51b3 E1\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u9898\u4e0e\u5f02\u6216\u6709\u6781\u5927\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u4f7f\u7528 FWT\u3002\n\n\u6211\u4eec\u8bb0 $F=\\sum\\limits_{x\\in \\textsf{span}(A)} z^x,G_c=\\sum\\limits_{\\textsf{P}(x)=c}z^x$\u3002\n\n\u6240\u6c42\u5373\u4e3a $[z^0]F\\times G_c$\u3002\n\n\u5bf9\u4e24\u8fb9 FWT \u6240\u6c42\u5373\u4e3a\uff1a\n\n$$[z^0]\\textsf{IFWT}(\\textsf{FWT}(F)\\times \\textsf{FWT}(G_c))$$\n\n\u81ea\u6b64\u4ee5\u540e\uff0c\u601d\u8def\u5c06\u4f1a\u4e0e\u5176\u4ed6\u9898\u89e3\u6709\u4e9b\u533a\u522b\u3002\n\n- $\\textsf{Lemma 2.1}$\uff1a$\\textsf{P}_{01}(A\\oplus B)=\\textsf{P}_{01}(A)+\\textsf{P}_{01}(B)$\u3002\n\n\u8bc1\u660e\uff1a\u53ef\u4ee5\u6839\u636e\u5f02\u6216\u662f\u4e0d\u8fdb\u4f4d\u52a0\u6cd5\u5f97\u5230\u3002\n\n- $\\textsf{Lemma 2.2}$\uff1a$A\\&(B\\oplus C)=(A\\&B)\\oplus(A\\&C)$\u3002\n\n\u8bc1\u660e\uff1a\u663e\u7136\u3002\n\n$$[z^i]\\textsf{FWT}(F)=\\sum\\limits_{x\\in \\textsf{span}(A)}\\textsf{sig}(x\\&i)$$\n\n$$=\\sum\\limits_{x_1\\in\\{0,A_1\\}}\\sum\\limits_{x_2\\in\\{0,A_2\\}}\\dots \\sum\\limits_{x_n\\in\\{0,A_n\\}} \\textsf{sig}((x_1\\oplus x_2 \\oplus \\dots \\oplus x_n)\\&i)$$\n\n$$=\\sum\\limits_{x_1\\in\\{0,A_1\\}}\\sum\\limits_{x_2\\in\\{0,A_2\\}}\\dots \\sum\\limits_{x_n\\in\\{0,A_n\\}} \\textsf{sig}((x_1\\&i)\\oplus (x_2\\&i) \\oplus \\dots \\oplus (x_n\\&i))$$\n\n$$=\\sum\\limits_{x_1\\in\\{0,A_1\\}}\\sum\\limits_{x_2\\in\\{0,A_2\\}}\\dots \\sum\\limits_{x_n\\in\\{0,A_n\\}} \\textsf{sig}(x_1\\&i)\\textsf{sig} (x_2\\&i) \\dots \\textsf{sig} (x_n\\&i)$$\n\n$$=\\sum\\limits_{x_1\\in\\{0,A_1\\}}\\textsf{sig}(x_1\\&i)\\sum\\limits_{x_2\\in\\{0,A_2\\}}\\textsf{sig} (x_2\\&i)\\dots \\sum\\limits_{x_n\\in\\{0,A_n\\}}\\textsf{sig} (x_n\\&i)$$\n\n$$=\\prod\\limits_{t\\in A}\\sum\\limits_{x\\in\\{0,t\\}}\\textsf{sig}(x\\&i)$$\n\n\u5f53\u540e\u9762\u90a3\u4e2a\u5f0f\u5b50 $x$ \u53d6 $0$ \u65f6\uff0c$\\textsf{sig}(0)=1$\u3002\n\n\u82e5\u5b58\u5728 $t\\in A$\uff0c\u4f7f\u5f97 $\\textsf{sig}(t\\&i)=-1$\uff0c\u5219\u539f\u5f0f\u4e3a $0$\uff0c\u5426\u5219\u4e3a $2^{|A|}$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u60f3\u8981\u5c06 $\\forall t\\in A,\\textsf{P}_{01}(t\\&i)=0$ \u7684 $i$ \u8868\u793a\u51fa\u6765\uff0c\u8bbe\u8fd9\u6837\u7684 $i$ \u6784\u6210\u96c6\u5408 $B$\u3002\n\n- $\\textsf{Lemma 3}$\uff1a\u82e5 $i\\in B,j\\in B$\uff0c\u5219 $i\\oplus j\\in B$\u3002\n\n\u8bc1\u660e\uff1a\u7531 $i\\in B,j\\in B$ \u53ef\u5f97 $\\forall t\\in A,\\textsf{P}_{01}(t\\&i)=0,\\textsf{P}_{01}(t\\& j)=0$ \uff0c\u7531 $\\textsf{Lemma 2.1},\\textsf{Lemma 2.2}$ \u5f97\u5230 $\\textsf{P}_{01}(t\\& (i\\oplus j))=\\textsf{P}_{01}((t\\& i)\\oplus(t\\& j))=\\textsf{P}_{01}(t\\& i)+\\textsf{P}_{01}(t\\& j)=0$\uff0c\u5f97\u8bc1\u3002\n\n\u4e8e\u662f\u8003\u8651\u6784\u9020\u51fa $B',s.t. \\textsf{span}(B')=B$\u3002\n\n\u5bb9\u6613\u60f3\u5230\uff0c$\\forall t\\in A,\\textsf{P}_{01}(t\\&i)=0$ \u53ef\u4ee5\u8868\u793a\u4e3a $|A|$ \u4e2a\u65b9\u7a0b\uff0c\u4fbf\u6709 $|A|$ \u4e2a\u4e3b\u5143\uff0c$m-|A|$ \u4e2a\u81ea\u7531\u5143\uff0c\u4e5f\u5c31\u662f\u8bf4 $|B'|=m-|A|$\u3002\n\n![](https://i.loli.net/2020/04/26/wKc3le9s8vBzQYr.png)\n\n\u6211\u4eec\u7528\u5982\u56fe\u6240\u793a\u7684\u65b9\u6cd5\u6784\u9020 $B'$\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u5de6\u4e0a\u89d2\u4e3a $A$ \u7684\u4e3b\u5143\uff0c\u6784\u9020\u5bf9\u89d2\u7ebf\u5168\u4e3a $1$\uff0c\u5c06\u53f3\u4e0a\u89d2\u7ffb\u8f6c\u5230\u5de6\u4e0b\u89d2\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u8fd9\u6837\u6784\u9020\u51fa\u7684 $B'$ \u662f\u5408\u6cd5\u7684\u3002\n\n\u73b0\u5728\uff0c\u6211\u4eec\u770b\u5230\u4e00\u4e2a $|B'|=m-|A|$\uff0c\u7ed3\u5408\u66b4\u529b $\\mathcal{O}(2^{|A|})$\uff0c\u53ef\u4ee5\u60f3\u5230\u6211\u4eec\u8981\u8bbe\u8ba1\u4e00\u4e2a $\\mathcal{O}(2^{m-|A|})$ \u7684\u505a\u6cd5\u3002\n\n\u4e8e\u662f\u7206\u641c $\\textsf{span}(B')$\uff0c\u7b54\u6848\u7684\u5f62\u5f0f\u4fbf\u53ef\u4ee5\u8f6c\u5316\u4e3a\u8fd9\u6837\uff1a\n\n$$[z^0]\\textsf{IFWT}(\\textsf{FWT}(F)\\times \\textsf{FWT}(G_c))$$\n\n$$=\\frac1{2^m}[z^0]\\textsf{FWT}(\\textsf{FWT}(F)\\times \\textsf{FWT}(G_c))=\\frac1{2^m}\\sum\\limits_{x\\in \\textsf{span}(B')}2^{|A|}[z^x]G_{c}$$\n\n\u95ee\u9898\u53c8\u8f6c\u5316\u5230 $G_c$ \u4e0a\u3002\n\n\u5bf9\u4e8e $G_c$ \u6211\u4eec\u5bf9\u4e8e $\\textsf{FWT}(G_c)$ \u6709\u5982\u4e0b\u6027\u8d28\uff1a\n\n$\\forall \\textsf{P}(i)=\\textsf{P}(j),[z^i]\\textsf{FWT}(G_c)=[z^j]\\textsf{FWT}(G_c)$\u3002\n\n\u8bc1\u660e\uff1a\u5c06\u4f4d\u4e0e\u4f4d\u4e4b\u95f4\u7f6e\u6362\u53ef\u5f97\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5bf9\u6bcf\u4e2a $\\textsf{P}(i)=k$ \u8ba1\u7b97\u51fa $G_{c,k}$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5148\u679a\u4e3e $c$\uff0c\u518d\u679a\u4e3e $\\textsf{P}(i)=k$\uff0c\u5269\u4e0b\u7684\u5c31\u662f\uff1a\n\n$$\\frac{2^{|A|}}{2^m}\\sum\\limits_{k}G_{c,k}\\sum\\limits_{x\\in \\textsf{span}(B'),\\textsf{P}(x)=k}1$$\n\n\u540e\u534a\u90e8\u5206\u5728\u7206\u641c $\\textsf{span}(B')$ \u540e\u5bb9\u6613\u8ba1\u7b97\u3002\n\n\u4e8e\u662f\uff0c\u6b64\u9898\u5728 $\\mathcal{O}(2^{\\frac m 2}+\\textsf{poly}(m))$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0b\u5f97\u5230\u89e3\u51b3\u3002\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1674814656,
        "uid": 359952,
        "name": "_lbw_",
        "ccfLevel": 6,
        "title": "1.27 \u9c9c\u82b1"
    },
    {
        "content": "\u601d\u8def\u6765\u81ea ix35\uff0corzorzorz\u3002\r\n\r\n\u597d\u9898\uff0c\u597d\u9898\u554a\u3002\r\n\r\n\u9898\u610f\u7ffb\u8bd1\u8bf4\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u76f4\u63a5\u8bf4\u505a\u6cd5\u3002\r\n\r\n\u8bb0 $|S|=\\mathrm{popcount(S)}$\uff0c$\\mathrm{span}(A)$ \u4e3a\u57fa\u5e95 $A$ \u5f20\u6210\u7684\u7ebf\u6027\u7a7a\u95f4\uff0c$|\\mathrm{span}(A)|$ \u8868\u793a $A$ \u5f20\u6210\u7684\u7ebf\u6027\u7a7a\u95f4\u7684\u5927\u5c0f\uff0c$(i,j)=|i \\land j|\\mod 2$\uff0c\u4e5f\u5373\u5411\u91cf $i$ \u4e0e\u5411\u91cf $j$ \u7684\u5185\u79ef\u3002\r\n\r\n\u663e\u7136\u6211\u4eec\u5e94\u8be5\u5efa\u51fa\u8fd9\u4e2a\u5e8f\u5217\u7684\u7ebf\u6027\u57fa $A$\uff0c\u6211\u4eec\u8bb0\u8fd9\u4e2a\u7ebf\u6027\u57fa\u7684\u79e9\u4e3a $r(A)$\u3002\r\n\r\n\u5219\u7b54\u6848\u662f $ans_i=2^{n-r(A)}\\sum\\limits_{x\\in\\mathrm{span}(A)}[|x|=i]$\uff0c\u76f4\u63a5\u679a\u4e3e $\\mathrm{span}(A)$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u5411\u91cf\u5373\u53ef\u505a\u5230 $O(2^{r(A)})$\u3002\r\n\r\n---\r\n\r\n\u8fd9\u4e2a\u505a\u6cd5\u9002\u7528\u4e8e $r(A)$ \u5c0f\u7684\u60c5\u51b5\uff0c\u5bf9\u4e8e $r(A)$ \u8f83\u5927\u7684\u60c5\u51b5\uff0c\u8003\u8651\u6c42\u51fa $A$ \u7684\u6b63\u4ea4\u7ebf\u6027\u57fa $B$\uff0c\u6211\u4eec\u6709\u7ed3\u8bba $[x\\in \\mathrm{span}(A)]=\\frac1{|\\mathrm{span}(B)|}\\sum\\limits_{y\\in\\mathrm{span}(B)}(-1)^{(x,y)}$\u3002\r\n\r\n\u4e3a\u4e86\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u6211\u4eec\u5148\u8bc1\u660e\u5f15\u7406\uff1a $[z^T]\\mathrm{FWT}(F(\\mathrm{span}(A)))$ \u53ea\u6709 $0,2^{r(A)}$ \u4e24\u79cd\u53d6\u503c\u3002\u5176\u4e2d $F(z)=\\sum\\limits_Tf_Tz^T$\uff0c\u662f\u4e00\u4e2a\u96c6\u5408\u5e42\u7ea7\u6570\u3002\r\n\r\n\u5f15\u7406\u8bc1\u660e\uff1a\u8003\u8651\u7ebf\u6027\u7a7a\u95f4\u4efb\u610f\u5f02\u6216\u4e00\u4e2a\u6570\u540e\u7ebf\u6027\u7a7a\u95f4\u4e0d\u53d8\uff0c\u56e0\u6b64\u6709 $F(\\mathrm{span}(A))\\times z^P=F(\\mathrm{span}(A))$\u3002\r\n\r\n\u628a\u7ebf\u6027\u7a7a\u95f4\u4e2d\u6240\u6709\u5411\u91cf\u4ee3\u5165\u4e0a\u5f0f\u6c42\u548c\u53ef\u4ee5\u5f97\u5230 $F(\\mathrm{span}(A))\\times F(\\mathrm{span}(A))=2^{r(A)}\\times F(\\mathrm{span}(A))$\u3002\r\n\r\n\u4e24\u8fb9\u540c\u65f6 $\\mathrm{FWT}$\uff0c\u53ef\u4ee5\u5f97\u5230 $\\mathrm{FWT}(F(\\mathrm{span}(A)))\\cdot\\mathrm{FWT}(F(\\mathrm{span}(A)))=2^{r(A)}\\times\\mathrm{FWT}(F(\\mathrm{span}(A)))$\u3002\r\n\r\n\u56e0\u6b64\u5bf9\u4e8e\u4efb\u610f\u7cfb\u6570\u90fd\u6709 $z^2=2^{r(A)}z$ \u8fd9\u4e2a\u65b9\u7a0b\u663e\u7136\u53ea\u6709 $z=0,z=2^{r(A)}$ \u4e24\u4e2a\u89e3\uff0c\u56e0\u6b64\u5f15\u7406\u5f97\u8bc1\u3002\r\n\r\n\u8fd9\u4e2a\u5f15\u7406\u6709\u4e00\u4e2a\u663e\u7136\u7684\u63a8\u8bba\uff1a$[z^T]\\mathrm{FWT}(F(\\mathrm{span}(A)))$ \u53d6 $2^{r(A)}$ \u5f53\u4e14\u4ec5\u5f53 $\\forall S\\in \\mathrm{span}(A),(S,T)=0$\uff0c\u4e5f\u5373 $T$ \u548c $\\mathrm{span}(A)$ \u4e2d\u6240\u6709\u5411\u91cf\u6b63\u4ea4\uff0c\u6211\u4eec\u79f0\u8fd9\u4e3a $T$ \u4e0e $\\mathrm{span}(A)$ \u6b63\u4ea4\u3002\r\n\r\n\u518d\u6765\u8003\u8651\u6211\u4eec\u8981\u8bc1\u660e\u7684\u7ed3\u8bba\uff0c\u53d1\u73b0 $\\sum\\limits_{y\\in\\mathrm{span}(B)}(-1)^{(x,y)}=[z^x]\\mathrm{FWT}(F(\\mathrm{span}(B))$\uff0c\u6839\u636e\u6b63\u4ea4\u7ebf\u6027\u57fa\u7684\u5b9a\u4e49\uff0c\u4e00\u4e2a\u5411\u91cf $P$ \u4e0e $\\mathrm{span}(B)$ \u6b63\u4ea4\u5f53\u4e14\u4ec5\u5f53 $P\\in \\mathrm{span}(A)$\uff0c\u56e0\u6b64\u7ed3\u8bba\u5f97\u8bc1\u3002\r\n\r\n---\r\n\r\n\u8bc1\u660e\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u6211\u4eec\u518d\u56de\u6765\u770b\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\uff0c\u53ef\u4ee5\u5f97\u5230 $ans_i=2^{n-r(A)}\\sum\\limits_{x\\in\\mathrm{span}(A)}[|x|=i]=2^{n-r(A)}\\sum\\limits_{|x|=i}[x\\in\\mathrm{span}(A)]=\\frac{2^{n-r(A)}}{|\\mathrm{span}(B)|}\\sum\\limits_{|x|=i}\\sum\\limits_{y\\in\\mathrm{span}(B)}(-1)^{(x,y)}=2^{n-r(A)-r(B)}\\sum\\limits_{y\\in\\mathrm{span}(B)}\\sum\\limits_{|x|=i}(-1)^{(x,y)}$\r\n\r\n\u53d1\u73b0\u5411\u91cf\u7684\u6bcf\u4e00\u4f4d\u662f\u672c\u8d28\u76f8\u540c\u7684\uff0c\u56e0\u6b64 $\\sum\\limits_{|x|=i}(-1)^{(x,y)}$ \u7684\u503c\u53ea\u548c $|x|,|y|$ \u6709\u5173\uff0c\u6211\u4eec\u8bb0\u4e3a $f(|x|,|y|)$\uff0c\u5219\u5bb9\u6613\u5f97\u5230 $f(|x|,|y|)=\\sum\\limits_{i=0}^m(-1)^i\\dbinom {|y|}i\\dbinom{m-|y|}{|x|-i}$\uff0c\u5bb9\u6613\u5728 $O(m^3)$ \u7684\u65f6\u95f4\u5185\u9884\u5904\u7406\u51fa\u5168\u90e8 $f$ \u7684\u503c\u3002\r\n\r\n\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u5c31\u662f $ans_i=2^{n-m}\\sum\\limits_{j=0}^mf(i,j)\\sum\\limits_{y\\in\\mathrm{span}(B)}[|y|=j]$\uff0c\u5176\u4e2d $\\sum\\limits_{y\\in\\mathrm{span}(B)}[|y|=j]$ \u76f4\u63a5\u679a\u4e3e $\\mathrm{span}(B)$ \u4e2d\u7684\u6240\u6709\u5143\u7d20\u5bb9\u6613\u5728 $O(2^{r(B)})=O(2^{m-r(A)})$ \u7684\u590d\u6742\u5ea6\u5185\u5f97\u5230\uff0c\u4e8e\u662f\u6211\u4eec\u6709\u4e86\u4e00\u4e2a $O(2^{m-r(A)})$ \u7684\u505a\u6cd5\u3002\r\n\r\n---\r\n\r\n\u6700\u540e\u6211\u4eec\u5c06\u4e24\u4e2a\u505a\u6cd5\u5408\u5e76\uff0c$r(A)\\leq \\frac m2$ \u65f6\u4f7f\u7528 $O(2^{r(A)})$ \u7684\u505a\u6cd5\uff0c\u5426\u5219\u4f7f\u7528 $O(2^{m-r(A)})$ \u7684\u505a\u6cd5\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u4ee5\u4f4e\u4e8e $O(2^{m-r(A)})$ \u7684\u590d\u6742\u5ea6\u6784\u9020\u51fa $A$ \u7684\u6b63\u4ea4\u7ebf\u6027\u57fa $B$\uff0c\u5c31\u53ef\u4ee5\u5728 $O(2^{\\frac m2})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u901a\u8fc7\u672c\u9898\u3002\r\n\r\n\u6b63\u4ea4\u7ebf\u6027\u57fa\u7684\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\u662f\u5148\u5bf9\u7ebf\u6027\u57fa\u9ad8\u6d88\u4f7f\u5f97\u4e3b\u5143\u6240\u5728\u7684\u5217\u53ea\u6709\u4e00\u4e2a $1$\uff0c\u7136\u540e\u5c06\u975e\u4e3b\u5143\u5217\u8f6c\u7f6e\u5373\u53ef\uff0c\u4e0b\u56fe\u662f\u4e00\u4e2a\u6784\u9020\u7684\u4f8b\u5b50\uff0c\u5176\u4e2d $A$ \u662f\u539f\u7ebf\u6027\u57fa\uff0c$B$ \u662f\u6784\u9020\u51fa\u7684\u6b63\u4ea4\u7ebf\u6027\u57fa\uff08\u76f4\u63a5\u62c9\u4e86\u522b\u4eba\u7684\u56fe\uff09\uff1a\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/1l0a8lag.png)\r\n\r\n\u4e8e\u662f\u53ef\u4ee5\u5728 $O(m^2)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6784\u9020 $A$ \u7684\u6b63\u4ea4\u7ebf\u6027\u57fa $B$\uff0c\u56e0\u6b64\u6211\u4eec\u5728 $O(2^{\\frac m2})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u4e86\u672c\u9898\u3002\r\n\r\n```c++\r\n#include<iostream>\r\n#include<cstdio>\r\nusing namespace std;\r\n#define int long long\r\nconst int mod=998244353;\r\nint n,m,a[55],w[200001],cnt,b[55],c[55][55],sum[55][55],p[200001],ans[55],res[55];\r\ninline void init()\r\n{\r\n    ios::sync_with_stdio(0);\r\n    cin.tie(0);\r\n}\r\ninline int read()\r\n{\r\n    int x;\r\n    cin>>x;\r\n    return x;\r\n}\r\ninline int pw(int a,int b)\r\n{\r\n    int res=1;\r\n    while(b)\r\n    {\r\n        if(b&1)\r\n            res=1ll*res*a%mod;\r\n        b>>=1;\r\n        a=1ll*a*a%mod;\r\n    }\r\n    return res;\r\n}\r\ninline int Mod(int x)\r\n{\r\n    return x>=mod? x-mod:x;\r\n}\r\ninline void ins(int x)\r\n{\r\n    for(int i=m-1;~i;--i)\r\n        if(x>>i&1)\r\n        {\r\n            if(!a[i])\r\n            {\r\n                a[i]=x;\r\n                ++cnt;\r\n                return;\r\n            }\r\n            x^=a[i];\r\n        }\r\n}\r\ninline void T()\r\n{\r\n    for(int i=m-1;~i;--i)\r\n        for(int j=i-1;~j;--j)\r\n            if(a[i]>>j&1)\r\n                a[i]^=a[j];\r\n    for(int i=m-1;~i;--i)\r\n        if(!a[i])\r\n        {\r\n            b[i]=1ll<<i;\r\n            for(int j=m-1;~j;--j)\r\n                b[i]|=(a[j]>>i&1)<<j;\r\n        }\r\n    for(int i=0;i<m;++i)\r\n        a[i]=b[i];\r\n}\r\ninline void dfs1(int k,int val)\r\n{\r\n    if(k>cnt)\r\n    {\r\n        int t=__builtin_popcountll(val);\r\n        ans[t]=Mod(ans[t]+p[n-cnt]);\r\n        return;\r\n    }\r\n    dfs1(k+1,val);\r\n    dfs1(k+1,val^b[k]);\r\n}\r\ninline void dfs2(int k,int val)\r\n{\r\n    if(k>cnt)\r\n    {\r\n        int t=__builtin_popcountll(val);\r\n        ++res[t];\r\n        return;\r\n    }\r\n    dfs2(k+1,val);\r\n    dfs2(k+1,val^b[k]);\r\n}\r\nsigned main()\r\n{\r\n    init();\r\n    n=read(),m=read();\r\n    p[0]=1;\r\n    for(int i=1;i<=n;++i)\r\n        p[i]=Mod(p[i-1]<<1);\r\n    if(!m)\r\n    {\r\n        cout<<p[n]<<'\\n';\r\n        cout.flush();\r\n        return 0;\r\n    }\r\n    for(int i=1;i<=n;++i)\r\n        ins(w[i]=read());\r\n    if(cnt<=(m>>1))\r\n    {\r\n        int tmp=0;\r\n        for(int i=0;i<m;++i)\r\n            if(a[i])\r\n                b[++tmp]=a[i];\r\n        dfs1(1,0);\r\n    }\r\n    else\r\n    {\r\n        T();\r\n        cnt=m-cnt;\r\n        c[0][0]=1;\r\n        for(int i=1;i<=m;++i)\r\n        {\r\n            c[i][0]=1;\r\n            for(int j=1;j<=i;++j)\r\n                c[i][j]=Mod(c[i-1][j]+c[i-1][j-1]);\r\n        }\r\n        for(int i=0;i<=m;++i)\r\n            for(int j=0;j<=m;++j)\r\n                for(int k=0;k<=m;++k)\r\n                    if(k<=i&&j-k<=m-i&&j-k>=0)\r\n                        sum[i][j]=Mod(sum[i][j]+1ll*(k&1? mod-1:1)*c[i][k]%mod*c[m-i][j-k]%mod);\r\n        int tmp=0;\r\n        for(int i=0;i<m;++i)\r\n            if(a[i])\r\n                b[++tmp]=a[i];\r\n        dfs2(1,0);\r\n        int inv=pw(p[cnt],mod-2);\r\n        for(int i=0;i<=m;++i)\r\n        {\r\n            for(int j=0;j<=m;++j)\r\n                ans[i]=Mod(ans[i]+1ll*res[j]*sum[j][i]%mod);\r\n            ans[i]=1ll*ans[i]*inv%mod*p[n-(m-cnt)]%mod;\r\n        }\r\n    }\r\n    for(int i=0;i<=m;++i)\r\n        cout<<ans[i]<<\" \";\r\n    cout<<'\\n';\r\n    cout.flush();\r\n    return 0;\r\n}\r\n```",
        "postTime": 1679470046,
        "uid": 85682,
        "name": "\u7edd\u9876\u6211\u4e3a\u5cf0",
        "ccfLevel": 8,
        "title": "CF1336E Chiori and Doll Picking \u9898\u89e3"
    }
]