[
    {
        "content": "#### \u9898\u89e3\n\n\u5148\u8003\u8651\u4e00\u4e2a $nq$ \u7684\u505a\u6cd5\uff1a\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\u7684\u6570\uff0c\u6211\u4eec\u77e5\u9053\u5b83\u662f\u524d\u7f00\u7b2c $x$ \u5c0f\uff0c\u4ee4 $ans=x$\uff0c\u4f9d\u6b21\u5f80\u540e\u6269\u5c55\uff0c\u8bb0\u5f55\u6269\u5c55\u540e\u7684\u76f8\u5bf9\u5927\u5c0f\u53d8\u5316\uff0c\u82e5 $ans\\geq a_i$\uff0c\u5219\u4ee4 $ans=ans+1$\uff0c\u8bf4\u660e\u6269\u5c55\u7684\u90a3\u4e00\u4e2a\u6570\u6bd4\u5f53\u524d\u6570\u5c0f\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5f97\u5230 $O(nq)$ \u7684\u505a\u6cd5\u3002~~\u6709\u5927\u4f6c\u76f4\u63a5\u526a\u679d\u8fc7\u4e86\u4f46\u88ab\u6211 hack \u4e86~~\n\n\u770b\u5230 $n=10^5$ \u4e14\u65f6\u9650\u662f $5s$ \u5f88\u5bb9\u6613\u60f3\u5230\u5206\u5757\u3002\n\n\u901a\u8fc7\u5206\u6790\u8be2\u95ee\u5757\u7684\u65b9\u5f0f\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6574\u5757\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u8fd9\u6837\u4e00\u4e2a\u64cd\u4f5c\uff1a\n\n\u521d\u59cb\u6709\u4e00\u4e2a\u6570 $x$\uff0c\u6bcf\u6b21\u4ece $l$ \u904d\u5386\u5230 $r$\uff0c\u82e5 $x\\geq a_i$ \u5219 $x=x+1$\u3002\n\n\u53d1\u73b0\u6700\u540e\u7684\u52a0\u4e00\u7684\u6b21\u6570\u81f3\u591a\u53ea\u6709 $r-l+1$ \u4e2a\uff0c\u4e14 $x$ \u8d8a\u5927\u6700\u540e\u7684\u52a0\u4e00\u7684\u6b21\u6570\u4f1a\u8d8a\u5927\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5757\u5b58\u5728 $\\sqrt n$ \u79cd\u5206\u754c\u7ebf\uff0c\u4f7f\u5f97\u6bcf\u8d85\u8fc7\u4e00\u6761\u5206\u754c\u7ebf $x$ \u5c31\u4f1a\u53d8\u5927 $1$\u3002\n\n\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u8fd9\u6837\u7684\u4e1c\u897f\uff1a\n\n\u521d\u59cb\u6709\u4e00\u4e2a\u6570\u5217 $b$ \u5747\u4e3a $x$\uff0c\u4e00\u4e2a\u6570\u5217 $c$ \u521d\u59cb\u4e3a $a_i$\uff0c\u6bcf\u6b21\u627e\u5230 $c_i-b_i$ \u6700\u5c0f\u7684\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5220\u9664\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u7136\u540e\u540e\u7f00\u52a0\u4e00\u3002\n\n\u5176\u5b9e\u5c31\u662f\u6a21\u62df\u8fd9\u4e2a\u8fc7\u7a0b\uff0c $b_i$ \u5373\u4e3a\u5230\u8fbe $i$ \u65f6 $x$ \u7684\u53d6\u503c\uff0c\u4ee4\u6700\u540e\u7684\u5206\u754c\u7ebf\u6570\u7ec4\u4e3a $f$\uff0c\u5219 $f_x=f_{x-1}+\\max(0,c_i-b_i)$\u3002\n\n\u8fd9\u91cc\u5bf9 $0$ \u53d6 $\\max$ \u662f\u56e0\u4e3a\u521d\u59cb\u65f6\u53ef\u80fd\u6709\u591a\u4e2a\u5408\u6cd5\u4f4d\u7f6e\uff0c\u5982\u679c\u9009\u5728\u4e86\u524d\u9762\u7684\u70b9\u53ef\u80fd\u51fa\u73b0\u8d1f\u6570\uff0c\u4f46\u6839\u636e\u5b9e\u9645\u610f\u4e49\u662f\u4e0d\u80fd\u5b58\u5728\u8d1f\u6570\u7684\u3002\n\n\u5177\u4f53\u7ef4\u62a4\u7684\u8bdd\u53ef\u4ee5\u76f4\u63a5\u7528\u4e00\u4e2a\u7ebf\u6bb5\u6811\u652f\u6301\u5355\u70b9\u4fee\u6539\u533a\u95f4\u52a0\u6c42\u5168\u5c40\u6700\u503c\u53ca\u4f4d\u7f6e\u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u65f6\u66b4\u529b\u8df3\u5757\uff0c\u5728\u6574\u5757\u7684 $f$ \u6570\u7ec4\u4e2d upper_bound \u627e\u5230\u5206\u754c\u7ebf\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt n\\log n)$\uff0c\u4f3c\u4e4e\u6ca1\u6709\u6807\u7b97\u4f18\u4f46\u53ef\u8fc7\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,fma\")\n#pragma GCC optimize(\"unroll-loops\")\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read(){\n\tre int t=0;re char v=getchar();\n\twhile(v<'0')v=getchar();\n\twhile(v>='0')t=(t<<3)+(t<<1)+v-48,v=getchar();\n\treturn t;\n}\nconst int M=998244353;\ninline void add(re int &x,re int y){(x+=y)>=M?x-=M:x;}\ninline int ksm(re int x,re int y){\n\tre int s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%M;\n\t\tx=1ll*x*x%M,y>>=1;\n\t}\n\treturn s;\n}\nstruct edge{int to,next;}e[2000002];\nint t,n,m,a[1000002],ans,cnt,head[1000002],bl[1000002],num,blk[100002],B,st[100002],ed[100002],stk[502][502],tg[2002],vis[100002],len[100002],mn[2002],c[2002],pos[2002];\n\ninline void pu(re int p){\n\tif(mn[p<<1]<mn[p<<1|1])mn[p]=mn[p<<1],pos[p]=pos[p<<1];\n\telse mn[p]=mn[p<<1|1],pos[p]=pos[p<<1|1];\n}\ninline void build(re int p,re int l,re int r){\n\tif(l==r){\n\t\tmn[p]=c[l],pos[p]=l;return;\n\t}\n\tre int mid=l+r>>1;\n\tbuild(p<<1,l,mid),build(p<<1|1,mid+1,r);\n\tpu(p);\n}\ninline void Add(re int p,re int x){\n\ttg[p]+=x,mn[p]+=x;\n}\ninline void pd(re int p){\n\tif(tg[p])Add(p<<1,tg[p]),Add(p<<1|1,tg[p]),tg[p]=0;\n}\ninline void cg(re int p,re int l,re int r,re int x,re int y){\n\tif(l==r){mn[p]=y;return;}\n\tpd(p);\n\tre int mid=l+r>>1;\n\tif(x<=mid)cg(p<<1,l,mid,x,y);\n\telse cg(p<<1|1,mid+1,r,x,y);\n\tpu(p);\n}\ninline void add(re int p,re int l,re int r,re int x,re int y){\n\tif(l>=x&&r<=y)return Add(p,-1);\n\tpd(p);\n\tre int mid=l+r>>1;\n\tif(x<=mid)add(p<<1,l,mid,x,y);\n\tif(y>mid)add(p<<1|1,mid+1,r,x,y);\n\tpu(p);\n}\ninline void buildd(re int p,re int l,re int r){\n\tmemset(tg,0,sizeof(tg)),memset(mn,0,sizeof(mn)),memset(pos,0,sizeof(pos));\n\tfor(re int i=l;i<=r;++i)c[i-l+1]=a[i];\n\tre int L=r-l+1;\n\tbuild(1,1,L);\n\tfor(re int i=1;i<=r-l+1;++i){\n\t\tstk[p][i]=mn[1],stk[p][i]=max(stk[p][i],stk[p][i-1]);\n\t\tre int xx=pos[1];\n\t\tif(xx^L)add(1,1,L,xx+1,L);\n\t\tcg(1,1,L,xx,1e9);\n\t}\n\tstk[p][len[p]+1]=1e9;\n}\nsigned main(){\n\tn=read(),B=sqrt(n);\n\tfor(re int i=1;i<=n;++i)a[i]=read(),bl[i]=(i-1)/B+1;\n\tfor(re int i=1;i<=n;++i){\n\t\tif(!st[bl[i]])st[bl[i]]=i;\n\t\ted[bl[i]]=i;\n\t}\n\tfor(re int i=1;i<=bl[n];++i)len[i]=ed[i]-st[i]+1,buildd(i,st[i],ed[i]);\n\tm=read();\n\twhile(m--){\n\t\tre int o=read(),x=read();\n\t\tif(o==1)a[x]=read(),buildd(bl[x],st[bl[x]],ed[bl[x]]);\n\t\telse{\n\t\t\tre int ans=a[x];\n\t\t\tfor(re int j=x+1;j<=ed[bl[x]];++j)ans+=(ans>=a[j]);\n\t\t\tfor(re int j=bl[x]+1;j<=bl[n];++j){\n\t\t\t\tre int pos=upper_bound(stk[j]+1,stk[j]+len[j]+2,ans)-stk[j];\n\t\t\t\tans+=pos-1;\n\t\t\t}\n\t\t\tprintf(\"%d\\n\",n-ans); \n\t\t}\n\t}\n}\n```",
        "postTime": 1624669360,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1540D"
    },
    {
        "content": "[link](https://www.luogu.com.cn/problem/CF1540D)\n\n\u9898\u610f\uff1a\n\n\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$\uff0c\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\n`1 x y`\uff1a\u4ee4 $a_x\\gets y$\u3002\n\n`2 x`\uff1a\u6784\u9020 $1\\sim n$ \u7684\u6392\u5217 $p$\uff0c\u6ee1\u8db3 $\\forall i\\in[1,n]$\uff0c$p_1\\sim p_{i-1}$ \u6070\u6709 $a_i$ \u4e2a\u6570\u5927\u4e8e $p_i$\u3002\u6c42 $p_x$\u3002\n\n---\n\n\u4e3a\u65b9\u4fbf\uff0c\u5c06 $a_i\\gets i-a_i$\uff0c\u8fd9\u6837 $a_i$ \u5c31\u662f $p_1\\sim p_i$ \u4e2d $p_i$ \u7684\u6392\u540d\u3002\n\n\u624b\u73a9\u4e00\u4e0b\u6784\u9020\u3002\u5047\u8bbe\u6709 $a=\\{1,2,2,1,3\\}$\uff0c\u4ece $1$ \u5230 $5$ \u9010\u4e2a\u6784\u9020 $p_i$\u3002\n\n```\na : 1 2 2 1 3\np : 1\np : 1 2\np : 1 3 2\np : 2 4 3 1\np : 2 5 4 1 3\n```\n\n\u4f60\u53d1\u73b0\u6bcf\u6b21\u6784\u9020 $p_i$ \u65f6\u5c31\u662f\u5c06 $p_i\\gets a_i$\uff0c\u5c06\u524d\u9762\u6240\u6709 $\\ge a_i$ \u7684 $p$ \u5168\u90e8 $+1$\u3002\n\n\u8fd9\u91cc\u6709\u91cd\u8981\u6027\u8d28\uff1a**\u6bcf\u6b21\u6784\u9020\u53ea\u4f1a\u5f71\u54cd\u524d\u9762\u5df2\u6784\u9020\u7684 $p$\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u540e\u9762\u8fd8\u6ca1\u6784\u9020\u7684 $p$\u3002**\n\n\u56de\u5230\u539f\u9898\uff0c\u9898\u76ee\u6bcf\u6b21\u8981\u6c42 $p_x$\uff0c\u90a3\u4e48\u6839\u636e\u4e0a\u9762\u7684\u6027\u8d28\uff0c\u6211\u4eec\u76f4\u63a5\u4ece $p_x$ \u5f00\u59cb\u6784\u9020\uff0c\u5e76\u8ba1\u7b97\u6784\u9020\u540e\u9762 $p$ \u65f6\u5bf9 $p_x$ \u7684\u5f71\u54cd\u3002\n\n\u90a3\u4e48\u8be2\u95ee\u8f6c\u5316\u4e3a\uff0c\u521d\u59cb $ans=p_x$\uff0c\u7136\u540e\u4ece $x+1$ \u679a\u4e3e\u5230 $n$\uff0c\u5982\u679c $ans\\ge a_i$ \u5219 $ans\\gets ans+1$\u3002\n\n\u8003\u8651\u5e8f\u5217\u5206\u5757\uff0c\u5757\u957f\u4e3a $B$\u3002\u6211\u4eec\u5c1d\u8bd5\u5728\u6bcf\u5757\u5185\u7ef4\u62a4 $nxt_x$ \u8868\u793a\u6570 $x$ \u4ece\u5757\u5de6\u7aef\u70b9\u8d70\u5230\u53f3\u7aef\u70b9\u4f1a\u589e\u52a0\u591a\u5c11\u3002\n\n\u90a3\u4e48\u7531\u4e8e\u5757\u957f\u4e3a $B$\uff0c$nxt$ \u7684\u503c\u5168\u90e8\u90fd $\\le B$ \u4e14\u5355\u8c03\u4e0d\u964d\u3002\n\n\u5373 $nxt$ \u53ef\u4ee5\u88ab\u770b\u505a\u4e00\u4e2a\u53ea\u6709 $B$ \u79cd\u53d6\u503c\u7684\u5206\u6bb5\u51fd\u6570\uff0c\u51fd\u6570\u503c\u5206\u522b\u4e3a $1,2,3,\\cdots,B$\u3002\n\n\u6211\u4eec\u76f4\u63a5\u7ef4\u62a4\u5757\u5185\u7684\u5206\u6bb5\u51fd\u6570\u7684 $B$ \u4e2a\u81ea\u53d8\u91cf\u8fb9\u754c\uff0c\u8be2\u95ee\u66b4\u529b\u8df3\u5757\u7528 `upper_bound` \u8be2\u95ee\u51fd\u6570\u503c\u5373\u53ef\u3002\n\n\u6700\u540e\u5904\u7406\u5355\u70b9\u4fee\u6539\u3002\u8003\u8651\u6bcf\u5757\u5f00\u7ebf\u6bb5\u6811\uff0c\u7ebf\u6bb5\u6811\u7ed3\u70b9\u7ef4\u62a4\u5b83\u5bf9\u5e94\u533a\u95f4\u7684\u5206\u6bb5\u51fd\u6570\u8fb9\u754c\uff0c`push_up` \u76f4\u63a5\u7ebf\u6027\u5f52\u5e76\u5373\u53ef\u3002\n\n\u8fd9\u6837\u5355\u70b9\u4fee\u6539\u590d\u6742\u5ea6\u662f $\\displaystyle\\sum_{i}\\frac B{2^i}=\\mathcal O(B)$ \u7684\u3002\n\n\u590d\u6742\u5ea6\u662f $\\mathcal O(n(B+\\frac n B\\log n))$ \u7684\uff0c\u53d6 $B=\\sqrt{n\\log n}$\uff0c\u6700\u7ec8\u65f6\u95f4 $\\mathcal O(n\\sqrt{n\\log n})$\uff0c\u7a7a\u95f4 $\\mathcal O(n\\log n)$\u3002\n\n\u542c\u8bf4\u53ef\u4ee5\u5206\u6563\u5c42\u53e0 $\\mathcal O(n\\sqrt n)$\uff08\uff1f\n\n---\n\nupd\uff1a\u597d\u50cf\u4e0d\u7528\u5206\u6563\u5c42\u53e0\u4e5f\u53ef\u4ee5 $\\mathcal O(n\\sqrt n)$\n\n\u5177\u4f53\u5730\uff0c\u628a\u8be2\u95ee\u548c\u4fee\u6539\u585e\u5230\u6bcf\u4e2a\u5757\u4e2d\uff0c\u79bb\u7ebf\u4ece\u5de6\u5230\u53f3\u9010\u5757\u5904\u7406\uff0c\n\n\u6bcf\u4e2a\u5757\u7684\u4fee\u6539\u64cd\u4f5c\u5c06\u8be2\u95ee\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6bcf\u6bb5\u5185\u7ebf\u6bb5\u6811\u6839\u8282\u70b9\u7684\u5f62\u6001\u662f\u4e00\u6837\u7684\u3002\u4e8e\u662f\u53ef\u4ee5\u53cc\u6307\u9488\u76f4\u63a5\u626b\u3002\n\n\u6ce8\u610f\u53cc\u6307\u9488\u4e4b\u524d\u8981\u628a\u540c\u4e00\u6bb5\u4e2d\u7684\u8be2\u95ee\u6309\u7167\u5b83\u672c\u6765\u7684 $ans$ \u6392\u5e8f\uff0c\u8fd9\u4e2a\u6392\u5e8f\u7528\u5feb\u6392\u590d\u6742\u5ea6\u4f1a\u9000\u5316\uff0c\u7528\u8ba1\u6570\u6392\u5e8f\u5373\u53ef\u3002\n\n\u8fd8\u6709\u4e3a\u4e86\u505a\u5230\u7ebf\u6027\u7a7a\u95f4\uff0c\u6211\u4eec\u5728\u585e\u8be2\u95ee\u65f6\u53ea\u628a\u8be2\u95ee\u585e\u5230\u6700\u5de6\u8fb9\u7684\u5757\uff0c\u7136\u540e\u5904\u7406\u5b8c\u8fd9\u4e2a\u5757\u628a\u8be2\u95ee\u585e\u5230\u4e0b\u4e00\u4e2a\u5757\u4e2d\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(n\\sqrt n)$\uff0c\u7a7a\u95f4 $\\mathcal O(n)$\u3002\u7136\u800c\u5e38\u6570\u8fc7\u5927\u88ab\u5e26 log \u7684\u540a\u7740\u8e29\u3002",
        "postTime": 1647579712,
        "uid": 203763,
        "name": "iorit",
        "ccfLevel": 7,
        "title": "CF1540D Solution"
    },
    {
        "content": "\u5047\u8bbe $n,q$ \u540c\u9636\uff0c\u4e0b\u9762\u7684 $b_i\\gets i-1-b_i$ \u5373\u8868\u793a\u524d\u9762\u6bd4\u5b83\u5c0f\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u8003\u8651\u5982\u4f55\u8fd8\u539f\u6392\u5217\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a\n\n\u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\uff0c\u4ee4 $i$ \u4ece\u5c0f\u5230\u5927\u904d\u5386\uff0c\u6bcf\u6b21\u5c31\u4ee4 $p_i=b_i+1$\uff0c\u7136\u540e\u4ee4\u539f\u5148\u5927\u4e8e\u7b49\u4e8e $b_i+1$ \u7684\u6570\u5168\u90e8 $+1$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86\u786e\u5b9a $p_x$ \u7684\u4e00\u4e2a\u6734\u7d20\u65b9\u6cd5\uff1a\u4ee4 $j=x+1,x+2,\\cdots,n$\uff0c\u521d\u59cb $p_x=b_x+1$\uff0c\u6bcf\u6b21\u82e5 $b_j+1\\ge p_x$\uff0c\u5219\u4ee4 $p_x\\gets p_x+1$\u3002\n\n\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\uff0c\u4ee4 $i$ \u4ece\u5927\u5230\u5c0f\u904d\u5386\uff0c\u7ef4\u62a4\u4e00\u4e2a\u96c6\u5408 $S=\\{1,2,\\cdots,n\\}$ \u8868\u793a\u5269\u4e0b\u7684\u6570\uff0c\u6bcf\u6b21\u53d6 $S$ \u4e2d\u7b2c $b_i+1$ \u5927\u7684\u5143\u7d20\u5373\u4e3a $p_i$\u3002\n\n\u5206\u5927\u5c0f\u4e3a $B=\\mathcal O(\\sqrt n)$ \u7684\u5757\uff0c\u7136\u540e\u9010\u5757\u5904\u7406\uff0c\u8003\u8651\u7528\u7b2c\u4e00\u79cd\u65b9\u6cd5\u8df3\u8fc7\u6563\u5757\uff0c\u7136\u540e\u8981\u5904\u7406\u7684\u662f\u5982\u4f55\u8df3\u8fc7\u6574\u5757\uff0c\u6211\u4eec\u7ef4\u62a4\u4ece\u6bcf\u4e2a\u5757\u7684\u7ed3\u5c3e\u5f00\u59cb\u6267\u884c\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u7684\u7ed3\u679c\uff08\u5373\u8bb0 $S$ \u5c11\u4e86\u4e00\u4e9b\u5143\u7d20\u53d8\u4e3a\u4e86 $S'$\uff0c\u7ef4\u62a4\u8fd9\u4e9b\u5c11\u4e86\u7684\u5143\u7d20\u4ee5\u53ca\u5b83\u4eec\u662f\u5728\u54ea\u91cc\u88ab\u53d6\u8d70\u4e86\uff09\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5757\u524d\u9762\u7684\u524d\u7f00\u5bf9\u5e94\u7684\u6392\u5217\uff08\u5373\u53ea\u4fdd\u7559\u524d\u7f00\u7684 $b_i$ \u8fd8\u539f\u7684\u6392\u5217\uff09\u5373\u4f1a\u4fdd\u6301\u76f8\u5bf9\u987a\u5e8f\u53d8\u4e3a $S'$ \u4e2d\u7684\u5143\u7d20\u3002\u6bcf\u6b21\u7d2f\u8ba1\u67e5\u8be2\uff0c\u76f4\u5230\u5757\u88ab\u4fee\u6539\u7684\u65f6\u5019\u5904\u7406\u8fd9\u4e2a\u4fee\u6539\u524d\u7684\u6240\u6709\u8be2\u95ee\uff0c\u7ed9\u8be2\u95ee\u4ee5 $B$ \u4e3a\u5e95\u505a\u57fa\u6570\u6392\u5e8f\u518d two-pointer \u626b\u4e00\u4e0b\u4e0d\u96be\u505a\u5230\u6b63\u786e\u7684\u590d\u6742\u5ea6\u3002\n\n\u5bf9\u4e8e\u4fee\u6539\uff0c\u8003\u8651\u6211\u4eec\u53ef\u4ee5\u8f7b\u6613\u5229\u7528\u73b0\u6709\u4fe1\u606f\u5c06\u8fd9\u4e2a\u5757\u62c6\u5f00\uff0c\u4e5f\u53ef\u4ee5\u7528\u7c7b\u4f3c\u4e0a\u9762 two-pointer \u7684\u65b9\u6cd5\u5c06\u4e24\u4e2a\u5757\u7684\u7ed3\u679c\u5f52\u5e76\u5230\u4e00\u8d77\uff0c\u4e8e\u662f\u53ef\u4ee5\u66b4\u529b\u62c6\u6210\u4e09\u6bb5\uff0c\u7136\u540e\u4fee\u6539\u518d\u5f52\u5e76\u56de\u53bb\uff0c\u590d\u6742\u5ea6\u4e5f\u662f\u5bf9\u7684\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\sqrt n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n)$\u3002\n\n```cpp\nconst int N = 1e5 + 5, B = 320;\n\nstruct Ask {\n\tint opt, x, y;\n} Q[N];\nint n, q, b[N], _b[N];\n\nstd::vector <int> bk[B], bk_2[B];\nvoid Sort(std::vector <int> &p) {\n\tfor(int i : p)\n\t\tbk[Q[i].y % B].push_back(i);\n\tfor(int i = 0; i < B; ++i) {\n\t\tfor(int j : bk[i]) bk_2[Q[j].y / B].push_back(j);\n\t\tbk[i].clear();\n\t}\n\tp.clear();\n\tfor(int i = 0; i < B; ++i) {\n\t\tfor(int j : bk_2[i]) p.push_back(j);\n\t\tbk_2[i].clear();\n\t}\n}\n\nvoid Split(std::vector <pii> f, int x,\n\t\tstd::vector <pii> &f_l, std::vector <pii> &f_r) {\n\tf_l.clear(); f_r.clear();\n\tint j = 0;\n\tfor(pii i : f) {\n\t\tif(i.se <= x) f_l.push_back(mkp(i.fi - j, i.se));\n\t\telse f_r.push_back(i), ++j;\n\t}\n}\nvoid Merge(std::vector <pii> f_l, std::vector <pii> f_r,\n\t\tstd::vector <pii> &f) {\n\tf.clear();\n\tint j = 0;\n\tfor(int i = 0; i < f_l.size(); ++i) {\n\t\tfor(; j < f_r.size() && f_r[j].fi <= f_l[i].fi + j; ++j)\n\t\t\tf.push_back(f_r[j]);\n\t\tf.push_back(mkp(f_l[i].fi + j, f_l[i].se));\n\t}\n\tfor(; j < f_r.size(); ++j)\n\t\tf.push_back(f_r[j]);\n}\n\nstd::vector <pii> f;\nstd::vector <int> p;\nvoid Modify(int x, int y) {\n\tif(b[x] == y) return;\n\tstd::vector <pii> f_l, f_x, f_r;\n\tSplit(f, x - 1, f_l, f_r);\n\tSplit(f_r, x, f_x, f_r);\n\tf_x[0].fi += y - b[x];\n\tMerge(f_x, f_r, f_r);\n\tMerge(f_l, f_r, f);\n\tb[x] = y;\n}\nvoid Jump() {\n\tif(p.empty()) return;\n\tSort(p);\n\tstd::vector <pii> p_f;\n\tfor(int i : p) p_f.push_back(mkp(Q[i].y, -i));\n\tMerge(p_f, f, p_f);\n\tfor(pii i : p_f)\n\t\tif(i.se < 0) Q[-i.se].y = i.fi;\n\tp.clear();\n}\n\nvoid Solve(int L, int R) {\n\tf.clear(); p.clear();\n\tfor(int i = R; i >= L; --i)\n\t\tMerge((std::vector <pii>) { mkp(b[i] + 1, i) }, f, f);\n\tfor(int i = 1; i <= q; ++i) {\n\t\tint opt = Q[i].opt, x = Q[i].x, y = Q[i].y;\n\t\tif(opt == 1) {\n\t\t\tif(x > R || x < L) continue;\n\t\t\tJump();\n\t\t\tModify(x, y);\n\t\t} else if(opt == 2) {\n\t\t\tif(x > R) continue;\n\t\t\tif(x > L) {\n\t\t\t\tfor(int j = std::max(L, x); j <= R; ++j)\n\t\t\t\t\tQ[i].y += (Q[i].y >= b[j] + 1);\n\t\t\t} else p.push_back(i);\n\t\t}\n\t}\n\tJump();\n}\n\nint main() {\n\trd(n);\n\tfor(int i = 1; i <= n; ++i) rd(b[i]), b[i] = i - 1 - b[i];\n\tmemcpy(_b, b, sizeof(_b));\n\trd(q);\n\tfor(int i = 1; i <= q; ++i) {\n\t\tint opt, x; rd(opt, x);\n\t\tif(opt == 1) {\n\t\t\tint y; rd(y); y = x - 1 - y;\n\t\t\tQ[i] = (Ask) { opt, x, y };\n\t\t\tb[x] = y;\n\t\t} else {\n\t\t\tQ[i] = (Ask) { opt, x + 1, b[x] + 1 };\n\t\t}\n\t}\n\tmemcpy(b, _b, sizeof(b));\n\tfor(int i = 0; i <= n / B; ++i) {\n\t\tint L = std::max(i * B, 1),\n\t\t\tR = std::min((i + 1) * B - 1, n);\n\t\tSolve(L, R);\n\t}\n\tfor(int i = 1; i <= q; ++i)\n\t\tif(Q[i].opt == 2) printf(\"%d\\n\", Q[i].y);\n\treturn 0;\n}\n```",
        "postTime": 1657767167,
        "uid": 34238,
        "name": "zhylj",
        "ccfLevel": 9,
        "title": "CF1540D"
    }
]