[
    {
        "content": "[\u82f1\u6587\u9898\u9762](https://codeforces.com/problemset/problem/356/E)\n\n\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32$S$\u3002\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u4e32$t$\u662f\"gray\"\u4e32\uff0c\u5f53\u4e14\u4ec5\u5f53\uff1a\n\n- $|t|$\u662f\u5947\u6570\uff1b\n- \u8bbe$mid=(1+|t|)/2$\uff0c\u5219$t_{mid}$\u4ec5\u5728$t$\u4e2d\u51fa\u73b0\u4e00\u6b21\uff1b\n- $t_{1,\\cdots mid-1}$\u548c$t_{mid+1,\\cdots |t|}$\u76f8\u540c\uff0c\u4e14\u90fd\u4e3agray\u4e32\u3002\n\n\u5b9a\u4e49\u4e00\u4e2a\u4e32$t$\u7684\u7f8e\u4e3d\u5ea6\u4e3a\uff1a$\\sum_{l,r} (r-l+1)^2 \\times [t_{l,\\cdots r}\u662fgray\u4e32]$\u3002\n\n\u4f60\u53ef\u4ee5\u4fee\u6539$S$\u7684\u4e00\u4e2a\u5b57\u7b26\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u4fee\u6539\u3002\u6c42\u4fee\u6539\u540e\u7684$S$\u7684\u7f8e\u4e3d\u5ea6\u7684\u6700\u5927\u503c\u3002\n\n\u9898\u89e3\uff1a\n\n\u8bbe$n=|S|$\u3002\u8003\u8651\u5230gray\u4e32\u7684\u957f\u5ea6\u4e3a$2^k -1$\uff0c\u6240\u4ee5gray\u4e32\u7684\u603b\u6570\u662f$nlogn$\u7ea7\u522b\u7684\u3002\n\n\u5148\u8003\u8651\u5982\u4f55\u6c42\u51fa\u6240\u6709\u7684gray\u4e32\u3002\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u7c7b\u4f3c\u6c42st\u8868\u7684\u4e1c\u897f\uff0c\u8bbe$g_{i,j}$\u8868\u793a\u4ee5$i$\u4e3a\u5de6\u7aef\u70b9\uff0c\u957f\u5ea6\u4e3a$2^j -1$\u7684\u4e32\u662f\u5426\u4e3agray\u4e32\u3002\u53ef\u4ee5\u901a\u8fc7\u5b57\u7b26\u4e32\u54c8\u5e0c\u6216\u8005\u540e\u7f00\u6570\u7ec4\u6c42\u5f97\u4e24\u8fb9\u7684\u4e32\u662f\u5426\u76f8\u540c\u3002\u7136\u540e\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u9650\u5236\uff0c\u8bb0\u4e00\u4e2a\u524d\u7f00\u548c\u6570\u7ec4$s_{i,j}$\u8868\u793a\u5b57\u7b26$j$\u5728$[1,i]$\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u5c31\u884c\u4e86\u3002\n\n\u518d\u8003\u8651\u6539\u53d8\u4e00\u4e2a\u5b57\u7b26\u5bf9\u7f8e\u4e3d\u5ea6\u7684\u5f71\u54cd\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u4f5c\u662f\u5c06\u5176\u5220\u9664\uff0c\u7136\u540e\u518d\u52a0\u5165\u3002\u5220\u9664\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u5305\u542b\u5f53\u524d\u70b9\u7684\u5b50\u4e32\u7684\u8d21\u732e\u90fd\u9700\u8981\u88ab\u51cf\u53bb\u3002\u8fd9\u4e2a\u53ea\u9700\u8981\u5f00\u4e00\u4e2a\u6570\u7ec4\uff0c\u5728\u7b97\u4e0a\u9762\u7684\u4e1c\u897f\u7684\u540c\u65f6\u7ef4\u62a4\u4e00\u4e0b\u3002\u7531\u4e8e\u662f\u533a\u95f4\u52a0\uff0c\u7528\u5dee\u5206\u5c31\u597d\u4e86\u3002\n\n\u5bf9\u4e8e\u5c06\u5176\u52a0\u5165\u540e\u5982\u4f55\u7b97\u65b0\u7684\u8d21\u732e\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u679a\u4e3e\u5de6\u7aef\u70b9\u4ee5\u53ca\u5176\u5bf9\u5e94\u7684\u53f3\u7aef\u70b9\uff0c\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\u3002\u8bbe\u5f53\u524d\u7684\u533a\u95f4\u4e3a$[l,r]$\uff0c\u4e2d\u95f4\u70b9\u4e3a$md$\uff0c\u5f53\u524d\u957f\u5ea6\u4e3a$len_j=2^j-1$\uff0c$lcp$\u4e3a$s_{l,\\cdots md-1}$\u548c$s_{md+1,\\cdots r}$\u7684$lcp$\u3002\n\n1. $g_{l,j-1}=1,g_{md+1,j-1}=1,lcp=len_{j-1}$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u7b2c\u4e8c\u4e2a\u9650\u5236\uff0c\u679a\u4e3e$s_{md}$\u53ef\u4ee5\u662f\u54ea\u4e2a\u5b57\u7b26\u5373\u53ef\uff1b\n2. $g_{l,j-1}=1,g_{md+1,j-1}=1,_l=len_{j-1}$\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b$lcp$\u5fc5\u987b\u7b49\u4e8e$len_{j-2}$\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u5141\u8bb8$s_{l+len_{j-2}}\\neq s_{md+1+len_{j-2}}$\uff0c\u5426\u5219\u8fd9\u4e2a\u4e32\u5c31\u6ca1\u6709\u8d21\u732e\u3002\u6240\u4ee5\u6b64\u65f6\u6211\u4eec\u5224\u4e00\u4e0b\u5c06\u8fd9\u4e24\u4e2a\u5b57\u7b26\u4e2d\u7684\u4e00\u4e2a\u6539\u4e3a\u53e6\u4e00\u4e2a\u4e4b\u540e\u8fd9\u4e2a\u4e32\u662f\u5426\u5408\u6cd5\u5c31\u884c\u4e86\uff1b\n3. $g_{l,j-1}+g_{md+1,j-1}=1$\uff0c\u6b64\u65f6\u6211\u4eec\u53ea\u5141\u8bb8$s_{l+lcp}\\neq s_{md+1+lcp}$\uff0c\u6240\u4ee5\u518d\u6c42\u4e00\u4e0b\u8fd9\u4e24\u4e2a\u4f4d\u7f6e\u540e\u9762\u7684$lcp$\uff0c\u5224\u4e00\u4e0b\uff0c\u7136\u540e\u770b\u80fd\u4e0d\u80fd\u628a\u4e0d\u4e3agray\u4e32\u7684\u90a3\u8fb9\u7684\u90a3\u4e2a\u4e0d\u4e00\u6837\u7684\u5b57\u7b26\u6362\u6210\u662fgray\u4e32\u7684\u90a3\u8fb9\u5bf9\u5e94\u7684\u5b57\u7b26\u5373\u53ef\u3002\n\n4. \u5176\u4f59\u60c5\u51b5\u90fd\u65e0\u6cd5\u4ea7\u751f\u8d21\u732e\u3002\n\n\u6211\u4eec\u5c06\u4e0a\u8ff0\u64cd\u4f5c\u7684\u8fc7\u7a0b\u7528\u4e00\u4e2a\u6570\u7ec4$con_{i,j}$\u8bb0\u5f55\u4e0b\u6765\u5373\u53ef\u3002\u5269\u4e0b\u7684\u4e1c\u897f\u5c31\u5f88\u597d\u505a\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(nlogn \\times 26)$\uff0c\u5f53\u7136\u80af\u5b9a\u4e0d\u4f1a\u8dd1\u6ee1\u3002\u5efa\u8bae\u7528sa\u6c42lcp\uff0c\u53ef\u4ee5\u5c11\u4e00\u4e2a\u4e8c\u5206\u7684log\u3002\n\n\u4ee3\u7801\uff1a\n\n```c++\n#include<bits/stdc++.h>\nusing namespace std;\n#define re register int\n#define F(x,y,z) for(re x=y;x<=z;x++)\n#define FOR(x,y,z) for(re x=y;x>=z;x--)\ntypedef long long ll;\n#define I inline void\n#define IN inline int\n#define C(x,y) memset(x,y,sizeof(x))\n#define STS system(\"pause\")\ntemplate<class D>I read(D &res){\n\tres=0;register D g=1;register char ch=getchar();\n\twhile(!isdigit(ch)){\n\t\tif(ch=='-')g=-1;\n\t\tch=getchar();\n\t}\n\twhile(isdigit(ch)){\n\t\tres=(res<<3)+(res<<1)+(ch^48);\n\t\tch=getchar();\n\t}\n\tres*=g;\n}\nchar c[101000];\nint n,m,mx,val,ln[30],s[101000][30],g[101000][20],a[101000],sa[101000],tp[101000],buc[101000],tot,rk[101000],hei[101000],f[101000][20],lg[101000];\nll w[101000],ans,sum,con[101000][30];\nI build_sa(){\n\tm=30;\n\tF(i,1,n)buc[rk[i]=a[i]]++;\n\tF(i,1,m)buc[i]+=buc[i-1];\n\tFOR(i,n,1)sa[buc[rk[i]]--]=i;\n\tfor(re k=1;k<=n;k<<=1){\n\t\tre tot=0;\n\t\tF(i,n-k+1,n)tp[++tot]=i;\n\t\tF(i,1,n)if(sa[i]>k)tp[++tot]=sa[i]-k;\n\t\tF(i,1,m)buc[i]=0;\n\t\tF(i,1,n)buc[rk[i]]++;\n\t\tF(i,1,m)buc[i]+=buc[i-1];\n\t\tFOR(i,n,1)sa[buc[rk[tp[i]]]--]=tp[i],tp[i]=0;\n\t\tswap(rk,tp);\n\t\trk[sa[1]]=tot=1;\n\t\tF(i,2,n)rk[sa[i]]=(tp[sa[i-1]]==tp[sa[i]]&&tp[sa[i-1]+k]==tp[sa[i]+k])?tot:++tot;\n\t\tif(tot==n)break;\n\t\tm=tot;\n\t}\n\tre k=0;\n\tF(i,1,n){\n\t\tif(rk[i]==1)continue;\n\t\tif(k)k--;\n\t\tre p=sa[rk[i]-1];\n\t\twhile(a[i+k]==a[p+k])k++;\n\t\thei[rk[i]]=k;\n\t}\n\tlg[0]=-1;F(i,1,n)f[i][0]=hei[i],lg[i]=lg[i>>1]+1;\n\tF(j,1,lg[n])F(i,1,n-(1<<j)+1)f[i][j]=min(f[i][j-1],f[i+(1<<(j-1))][j-1]);\n}\nIN ques_lcp(int x,int y){\n\tif(x==y)return n-x+1;x=rk[x];y=rk[y];if(x>y)swap(x,y);x++;\n\tre len=lg[y-x+1];return min(f[x][len],f[y-(1<<len)+1][len]);\n}\nint main(){\n\tios::sync_with_stdio(false);\n\tcin>>c+1;n=strlen(c+1);\n\tF(i,1,n)a[i]=c[i]-'a'+1;\n\tbuild_sa();\n\tF(i,1,n){\n\t\tF(j,1,26)s[i][j]=s[i-1][j];\n\t\ts[i][a[i]]++;\n\t}\n\tF(i,1,n)g[i][1]=1;w[1]=1;\n\tre l,r,md,_l,_r,sn;mx=lg[n]+1;ans=n;\n\tF(i,1,mx)ln[i]=(1<<i)-1;\n\tF(j,2,mx)F(i,1,n-(1<<j)+2){\n\t\tl=i;r=i+(1<<j)-2;md=(l+r)>>1;\n\t\tif(!g[i][j-1]||!g[md+1][j-1]||ques_lcp(l,md+1)<ln[j-1]||s[r][a[md]]-s[l-1][a[md]]>1)continue;\n\t\tg[i][j]=1;w[l]+=(ll)ln[j]*ln[j];w[r+1]-=(ll)ln[j]*ln[j];ans+=(ll)ln[j]*ln[j];\n\t}\n\tF(i,2,n)w[i]+=w[i-1];\n\tF(i,1,n)F(j,1,26)con[i][j]=1;\n\tF(j,2,mx)F(i,1,n-(1<<j)+2){\n\t\tl=i;r=i+(1<<j)-2;md=(l+r)>>1;_l=ques_lcp(l,md+1);\n\t\tif(g[i][j-1]&&g[md+1][j-1]){\n\t\t\tif(_l>=ln[j-1]){\n\t\t\t\tF(k,1,26)if(s[r][k]==s[l-1][k])con[md][k]+=(ll)ln[j]*ln[j];\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(_l<ln[j-2])continue;\n\t\t\tval=a[l+ln[j-2]];if(a[r-ln[j-2]]==a[md])sn=1;else if(val==a[md])sn=-1;else sn=0;\n\t\t\tif(s[r][a[md]]-s[l-1][a[md]]-sn==1)con[r-ln[j-2]][val]+=(ll)ln[j]*ln[j];\n\t\t\tval=a[r-ln[j-2]];if(a[l+ln[j-2]]==a[md])sn=1;else if(val==a[md])sn=-1;else sn=0;\n\t\t\tif(s[r][a[md]]-s[l-1][a[md]]-sn==1)con[l+ln[j-2]][val]+=(ll)ln[j]*ln[j];\n\t\t\tcontinue;\n\t\t}\n\t\tif(!g[i][j-1]&&!g[md+1][j-1])continue;\n\t\tif(g[i][j-1]){\n\t\t\t_r=ques_lcp(l+_l+1,md+_l+2);if(_l+_r+1<ln[j-1])continue;\n\t\t\tval=a[l+_l];if(a[md+1+_l]==a[md])sn=1;else if(val==a[md])sn=-1;else sn=0;\n\t\t\tif(s[r][a[md]]-s[l-1][a[md]]-sn==1)con[md+1+_l][val]+=(ll)ln[j]*ln[j];\n\t\t}\n\t\tif(g[md+1][j-1]){\n\t\t\t_r=ques_lcp(l+_l+1,md+_l+2);if(_l+_r+1<ln[j-1])continue;\n\t\t\tval=a[md+1+_l];if(a[l+_l]==a[md])sn=1;else if(val==a[md])sn=-1;else sn=0;\n\t\t\tif(s[r][a[md]]-s[l-1][a[md]]-sn==1)con[l+_l][val]+=(ll)ln[j]*ln[j];\n\t\t}\n\t}\n\tsum=0;\n\tF(i,1,n)F(j,1,26)if(a[i]^j)sum=max(sum,con[i][j]-w[i]);\n\tans+=sum;cout<<ans;\n\treturn 0;\n}\n\n\n```",
        "postTime": 1594264683,
        "uid": 93453,
        "name": "Purple_wzy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF356E \u3010Xenia and String Problem\u3011"
    },
    {
        "content": "[\u4e5f\u8bb8\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Morning-Glory/p/11218174.html)\n\n# $\\mathcal{Description}$\n\n\u5b9a\u4e49\u4e00\u79cd\u5b57\u7b26\u4e32$gray$\u4e32\u6ee1\u8db3\uff1a\n* \u957f\u5ea6\u4e3a\u5947\u6570\n* \u6b63\u4e2d\u95f4\u7684\u5b57\u6bcd\u53ea\u51fa\u73b0\u4e00\u6b21\n* \u5de6\u53f3\u4e24\u7aef\u76f8\u540c\uff0c\u5de6\u53f3\u4e24\u7aef\u4e5f\u662fgray\u4e32\n\t\n\u4e00\u4e2a$gray$\u4e32\u7684\u8d21\u732e\u4e3a\u8fd9\u4e2a\u4e32\u957f\u5ea6\u7684\u5e73\u65b9\n\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e00\u4e2a\u957f\u5ea6\u4e3a$7$\u7684$gray$\u4e32\u662f\u5305\u542b\u4e86\u957f\u5ea6\u4e3a$1,3$\u7684$gray$\u7684\n\n\u73b0\u7ed9\u4f60\u4e00\u4e2a\u957f\u4e3a$n(n<=100,000)$\u7684\u5b57\u7b26\u4e32\uff0c\u4f60\u53ef\u4ee5\u4fee\u6539\u81f3\u591a\u4e00\u4e2a\u5b57\u6bcd\uff0c\u4f7f\u5f97\u603b\u8d21\u732e\u503c\u6700\u5927\n\u8f93\u5165\u65b9\u5f0f\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\n\n---\n\n# $\\mathcal{Solution}$\n\n\n* \u8003\u8651\u600e\u4e48\u53bb\u6c42\u4fee\u6539\u5b57\u7b26\u7684\u8d21\u732e\t\n\u6211\u4eec\u4fee\u6539\u4e00\u4e2a\u5b57\u7b26\u65f6\u5e94\u8be5\u8003\u8651\u4e24\u70b9:\t\t\t\n\u4e00\u662f\u8be5\u5b57\u7b26\u539f\u672c\u9020\u6210\u7684\u8d21\u732e\u6ca1\u6709\u4e86\t\t\n\u4e8c\u662f\u5c06\u5176\u4fee\u6539\u540e\u4f1a\u5f97\u5230\u65b0\u7684\u8d21\u732e\t\t\n\u5f53\u6211\u4eec\u5bf9\u7b2c$i$\u4e2a\u5b57\u7b26\u4fee\u6539\u65f6\t\t\n\u7528$cost[i]$\u8868\u793a$i$\u4f4d\u7f6e\u539f\u672c\u7684\u8d21\u732e\t\n\u7528$bef[i][x](benefit)$\u8868\u793a\u5c06$i$\u4f4d\u7f6e\u7684\u5b57\u7b26\u4fee\u6539\u4e3a$x$\u6240\u5f97\u5230\u7684\u8d21\u732e,\u7279\u522b\u7684,\u8bbei\u4f4d\u7f6e\u672c\u6765\u7684\u5b57\u7b26\u4e3a$x$,\u90a3\u4e48$cost[i]=bef[i][x]$\t\n\u90a3\u4e48\u5c06$i$\u4f4d\u7f6e\u7684\u5b57\u7b26\u4fee\u6539\u4e3a$x$\u5f97\u5230\u7684\u8d21\u732e\u5e94\u4e3a$bef[i][x]-cost[i]$\t\n\t\n* \u6839\u636e$gray$\u4e32\u7684\u5b9a\u4e49,\u6211\u4eec\u77e5\u9053\u4e00\u4e2a$gray$\u4e32\u7684\u957f\u5ea6\u5e94\u8be5\u662f$1,3,7,15,31\\dots(2^x-1)$\t\n\u6240\u4ee5\u6211\u4eec\u6700\u591a\u6709$log_2(n)$\u79cd\u957f\u5ea6\u4e0d\u540c\u7684$gray$\u4e32,$n$\u6700\u5927\u4e3a$100,000$\u4e5f\u5c31\u662f\u8bf4\u6700\u591a\u6709$16$\u79cd\t\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6c42\u51fa\u6240\u6709\u957f\u5ea6\u7684\u60c5\u51b5\t\n\t\n* \u6c42$cost$\t\n$cost[i]$\u8868\u793a\u7684\u662f$i$\u4f4d\u7f6e\u7684\u5b57\u7b26\u539f\u672c\u7684\u8d21\u732e,\u5176\u5305\u542b\u4e86\u4e0d\u540c\u957f\u5ea6\u7684\u8d21\u732e\t\n\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684$gray$\u4e32\u6240\u6709\u4f4d\u7f6e\u7684\u8d21\u732e\u5e94\u8be5\u90fd\u662f$n*n$\t\n\u8003\u8651\u5dee\u5206,\u627e\u51fa\u6240\u6709\u4e0d\u540c\u957f\u5ea6\u7684$gray$\u4e32,\u5728\u5176\u5f00\u5934\u8d21\u732e\u52a0\u4e0a$n*n$,\u5728\u5176\u672b\u5c3e\u52a0\u4e00\u7684\u4f4d\u7f6e\u51cf\u53bb$n*n$\t\n\t\n* \u5982\u4f55\u5224\u65ad\u539f\u4e32\u4e2d\u4e00\u4e2a\u4e32\u662f\u5426\u4e3a$gray$\u4e32(\u8fc7\u6c34\u53ef\u8df3\u8fc7)\t\n\u5148\u5c06\u539f\u4e32\u54c8\u5e0c\u4e00\u904d\t\n\u7528$pef[i][j]$\u8868\u793a\u4ee5$i$\u4e3a\u5f00\u5934,\u957f\u5ea6\u4e3a$2^j-1$\u7684\u4e32\u662f\u5426\u4e3a$gray$\u4e32 $($\u6211\u559c\u6b22\u53eb\u5b83\u5b8c\u7f8e\u4e32$pef \\Rightarrow perfect)$\t\n\u7528$sum[i][j]$\u8868\u793a\u5b57\u7b26$i$\u5728\u524d$j$\u4e2a\u5b57\u7b26\u4e2d\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\t\n\u8bbe\u4e00\u4e2a\u957f\u5ea6\u4e3a$2^i-1$\u7684\u4e32\u5de6\u7aef\u70b9\u4e3a$l$,\u4e2d\u70b9\u4e3a$mid$,\u53f3\u7aef\u70b9\u4e3a$r$,\u4e2d\u70b9\u5b57\u7b26\u4e3a$ch$,\u5b57\u7b26\u4e32\u7684\u54c8\u5e0c\u503c\u4e3a$sub$\t\n\u5219\u5e94\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\t\n$sum[ch][r]-sum[ch][l-1]==1$\t\n$pef[l][i-1]=true$\t\n$pef[mid+1][i-1]=true$\t\n$sub(l,mid-1)==sub(mid+1,r)$\t\n\t\n* \u6c42$bef$\t\n\u679a\u4e3e\u6240\u6709\u957f\u5ea6\u4ee5\u53ca\u5176\u8d77\u70b9\t\n\u8003\u8651\u5c06\u5176\u53d8\u4e3a$gray$\u4e32\t\n\u6b64\u65f6\u5bf9\u4e8e\u4e00\u4e2a\u4e32\u6709\u4e24\u79cd\u60c5\u51b5\t\n\u4e00\u662f\u5de6\u534a\u8fb9\u4e0e\u53f3\u534a\u8fb9\u90fd\u662f$gray$\u4e32,\u4f46\u662f\u4e2d\u95f4\u7684\u5b57\u7b26\u6709\u91cd\u590d,\u679a\u4e3e\u5c06\u4e2d\u95f4\u7684\u5b57\u7b26\u4fee\u6539\u4e3a\u4ec0\u4e48\u5b57\u7b26\u5373\u53ef\t\n\u4e8c\u662f\u5de6\u534a\u8fb9\u4e0e\u53f3\u534a\u8fb9\u6709\u4e00\u4e2a\u4e3a$gray$\u4e32,\u6b64\u65f6\u4e24\u4e32\u4e0d\u76f8\u540c\u7684\u5b57\u7b26\u5e94\u53ea\u6709\u4e00\u4e2a\u5e76\u4e14\u4e2d\u95f4\u7684\u5b57\u7b26\u5e94\u4e0d\u4f1a\u91cd\u590d\t\n\u8fd9\u4e00\u6bb5\u7684\u6253\u6cd5\u5e76\u6ca1\u6709\u7279\u6b8a\u6280\u5de7,\u6ce8\u610f\u5904\u7406\u65b9\u6cd5\u5373\u53ef,\u7ec6\u8282\u770b\u4ee3\u7801,\u601d\u8def\u5f88\u6e05\u6670\t\n\t\n# $\\mathcal{Code}$\t\n\u4ee3\u7801\u91cc\u6709\u6298\u53e0,\u4f7f\u7528vim\u7684\u670b\u53cb\u53ef\u4ee5\u5c06\u5176\u5206\u5f00\u770b\t\n\u5efa\u8bae\u6253\u4ee3\u7801\u65f6\u4e5f\u5206\u5f00\u6253\t\n\t\n```cpp\n/*******************************\nAuthor:Morning_Glory\nLANG:C++\nCreated Time:2019\u5e7407\u670819\u65e5 \u661f\u671f\u4e94 20\u65f641\u520651\u79d2\n*******************************/\n#include <iostream>\n#include <fstream>\n#include <cstring>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\nconst int maxn = 100050;\nconst int limit = 16;\nconst int h = 31;\nint n;\nint len[maxn];\nll ans,inc;\nll cost[maxn];\nll bef[maxn][30];\null ha[maxn],mi[maxn];\nint sum[30][maxn];\nchar s[maxn];\nbool pef[maxn][limit+5];\n//{{{sub\ninline ull sub (int l,int r)\n{\t\n\treturn ha[r]-ha[l-1]*mi[r-l+1];\n}\n//}}}\n//{{{check\ninline bool check (int l1,int r1,int l2,int r2)\n{\n\treturn sub(l1,r1)==sub(l2,r2);\n}\n//}}}\n//{{{lcp\ninline int lcp (int l1,int l2)\n{\n\tint res=0;\n\tfor (int i=limit;i>=0;--i){\n\t\tint le=res+len[i];\n\t\tif (l1+le<=n&&l2+le<=n&&check(l1,l1+le,l2,l2+le))\tres+=len[i]+1;\n\t}\n\treturn res;\n}\n//}}}\n//{{{init\ninline void init ()\n{\n\tfor (int i=1;i<=limit+1;++i)\tlen[i]=len[i-1]<<1|1;\n\tmi[0]=1,ans=n=strlen(s+1);\n\tfor (int i=1;i<=n;++i){\n\t\tfor (int j=1;j<=26;++j)\n\t\t\tsum[j][i]=sum[j][i-1]+(s[i]-'a'+1==j);\n\t\tpef[i][1]=true,mi[i]=mi[i-1]*h;\n\t\tha[i]=ha[i-1]*h+s[i]-'a'+1;\n\t}\n}\n//}}}\n//{{{get_pef\ninline void get_pef()\n{\n\tfor (int i=2;len[i]<=n;++i)\n\t\tfor (int l=1,r=len[i];r<=n;++l,++r){\n\t\t\tint mid=l+len[i-1],ch=s[mid]-'a'+1;\n\t\t\tif (sum[ch][r]-sum[ch][l-1]==1)\tpef[l][i]=pef[l][i-1]&pef[mid+1][i-1]&check(l,mid-1,mid+1,r);\n\t\t\tans+=1ll*pef[l][i]*len[i]*len[i];\n\t\t}\n}\n//}}}\n//{{{get_cost\ninline void get_cost ()\n{\n\tfor (int i=1;len[i]<=n;++i)\n\t\tfor (int l=1,r=len[i];r<=n;++l,++r){\n\t\t\tcost[l]+=1ll*pef[l][i]*len[i]*len[i];\n\t\t\tcost[r+1]-=1ll*pef[l][i]*len[i]*len[i];\n\t\t}\n\tfor (int i=1;i<=n;++i)\tcost[i]+=cost[i-1];\n}\n//}}}\n//{{{calc\ninline void calc (int l1,int k)// from l1   len[k]\n{\n\tif (k==1){\n\t\tfor (int i=1;i<=26;++i)\t++bef[l1][i];\n\t\treturn;\n\t}\n\tint mid=l1+len[k-1],l2=mid+1;\n\tll tmp=1ll*len[k]*len[k];\n\tif (pef[l1][k-1]&&pef[l2][k-1]&&check(l1,mid-1,l2,l2+len[k-1]-1)){\n\t\tfor (int i=1;i<=26;++i)\n\t\t\tif (sum[i][l1-1]==sum[i][mid-1])\tbef[mid][i]+=tmp;\n\t\treturn;\n\t}\n\n\tint prf1=lcp(l1,l2);\n\tint m1=l1+prf1,m2=l2+prf1;\n\tint prf2=lcp(m1+1,m2+1);\n\tif (m1+1+prf2<mid)\treturn;\n\tif (pef[l1][k-1]&&sum[s[mid]-'a'+1][l1-1]==sum[s[mid]-'a'+1][mid-1])\tbef[m2][s[m1]-'a'+1]+=tmp;\n\tif (pef[l2][k-1]&&sum[s[mid]-'a'+1][mid]==sum[s[mid]-'a'+1][l2+len[k-1]-1])\tbef[m1][s[m2]-'a'+1]+=tmp;\n}\n//}}}\nint main()\n{\n\tfreopen(\"356E.in\",\"r\",stdin);\n\tfreopen(\"356E.out\",\"w\",stdout);\n\tios::sync_with_stdio(false);\n\tcin>>(s+1);\n\tinit();\n\tget_pef();\n\tget_cost();\n\n\tfor (int i=1;i<=n;++i)\n\t\tfor (int j=1;i+len[j]-1<=n;++j)\n\t\t\tcalc(i,j);\n\n\tfor (int i=1;i<=n;++i)\n\t\tfor (int j=1;j<=26;++j)\t\n\t\t\tinc=max(inc,bef[i][j]-cost[i]);\n\n\tcout<<ans+inc<<endl;\n\treturn 0;\n}\n\n```\n",
        "postTime": 1563612593,
        "uid": 89048,
        "name": "Morning_Glory",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF356E \u3010Xenia and String Problem\u3011"
    },
    {
        "content": "**CF356E sol**\n\n\u8003\u8651\u5230\u597d\u4e32\u7684\u4e32\u957f\u53ef\u4ee5\u8868\u793a\u4e3a $2 ^ x - 1$ \u7684\u5f62\u5f0f\uff0c\u8fd9\u9650\u5236\u4e86\u603b\u7684\u597d\u4e32\u6570\u91cf\u7ea7\u662f $O(n \\log n)$ \u7684\u3002\n\n\u8003\u8651\u4fe1\u606f\u662f\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\u7684\u9012\u63a8\u5173\u7cfb\uff0c\u8f6c\u79fb\u662f\u53ef\u4ee5\u505a\u5230 $O(1)$ \u7684\uff0c\u6240\u4ee5\u9884\u5904\u7406\u6240\u6709\u597d\u4e32\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6570\u91cf\u7ea7\u7b49\u4e8e\u4e32\u6570\u91cf\u7ea7 $O(n \\log n)$\u3002\n\n\u6c42\u51fa\u540e\u9884\u5904\u7406\u5982\u679c\u5c06\u4e00\u4e2a\u4f4d\u7f6e $i$ \u8fdb\u884c\u4e00\u6b21\u975e\u65e0\u7528\u4fee\u6539\u65f6\u4f1a\u9020\u6210\u7684\u635f\u5931\u8d21\u732e $a_i$\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u5dee\u5206\u505a\u5230 $O(n \\log n)$\u3002\n\n\n\u8003\u8651\u7ef4\u62a4\u6bcf\u4e2a\u5171 $26n$ \u4e2a\u5355\u6b21\u4fee\u6539\u4f1a\u9020\u6210\u7684\u8d21\u732e\uff0c\u6211\u4eec\u4e0d\u59a8\u679a\u4e3e\u6240\u6709\u7684\u53ef\u80fd\u4e32\u8fdb\u884c\u5982\u4e0b\u7684\u8ba8\u8bba\uff1a\n\n- \u5982\u679c\u4fee\u6539\u4e86\u4e00\u4e2a\u53ef\u80fd\u4e32\u7684\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u5219\u679a\u4e3e\u6240\u6709\u53ef\u80fd\u7684\u4fee\u6539\u8fdb\u884c $O(1)$ \u5224\u65ad\uff0c\u6b64\u5904\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(26 n \\log n)$\uff1b\n\n- \u5982\u679c\u8981\u5728\u4e24\u8fb9\u4fee\u6539\uff0c\u5bf9\u4e8e\u672c\u8eab\u662f\u597d\u4e32\u7684\u4f4d\u7f6e\u6211\u4eec\u53d1\u73b0\u5982\u679c\u8fdb\u884c\u4e86\u4e00\u4e2a $x \\rightarrow x$ \u8fd9\u6837\u7684\u64cd\u4f5c\u662f\u4e25\u683c\u4e0d\u4f18\u7684\uff0c\u6b64\u65f6\u4e0d\u8fdb\u884c\u7edf\u8ba1\uff1b\u5bf9\u4e8e\u672c\u8eab\u4e0d\u662f\u597d\u4e32\u7684\u53ef\u80fd\u4e32\uff0c\u4e24\u8fb9\u81f3\u591a\u6709\u4e00\u4e2a\u4f4d\u7f6e\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u901a\u8fc7\u4e8c\u5206\u6216\u4e00\u4e9b\u5947\u602a\u7684\u9884\u5904\u7406\u6c42\u51fa\u8fd9\u4e2a\u4f4d\u7f6e\u540e\u5728\u8fdb\u884c\u662f\u5426\u4e3a\u597d\u4e32\u7684\u5224\u65ad\u5373\u53ef\u76f4\u63a5\u7ef4\u62a4\u5f53\u524d\u53ef\u80fd\u4e32\u5bf9\u4e8e\u6240\u6709\u201c\u5355\u6b21\u4fee\u6539\u201d\u9020\u6210\u7684\u8d21\u732e\uff0c\u6ce8\u610f\u9700\u8981\u5728\u5de6\u53f3\u4e24\u8fb9\u5206\u522b\u679a\u4e3e\u4fee\u6539\u3002\n\n\u8bbe\u521d\u59cb\u7684\u7b54\u6848\u4e3a $M$\uff0c\u5e76\u4e14 $b_{i,c}$ \u8868\u793a\u5c06 $i$ \u4f4d\u7f6e\u4fee\u6539\u4e3a $c$ \u65f6\u65b0\u589e\u7684\u8d21\u732e\uff0c\u539f\u4e32\u4e3a $S$\uff0c\u5219\u6700\u540e\u7684\u7b54\u6848\u4e3a $\\max(M,\\max_{i = 1} ^ {|S|}\\max_{j = 0} ^ {25} M - a_i + b_{i,j})$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(26 n \\log n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(26n)$\u3002\n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\n#define ll long long\nconst int Len = 1e5 + 5;\nchar s[Len];int n,m,sum[Len][26],isr[Len][20];\nll a[Len],b[Len][26];\nstruct hash\n{\n    int n,k,mod;\n    ll hsh[Len],bs[Len];\n    void init(int N,int K,int MOD)\n    {\n        n = N , k = K , mod = MOD;\n        bs[0] = 1;\n        for(int i = 1 ; i <= n ; i ++) bs[i] = bs[i - 1] * k % mod;\n        for(int i = 1 ; i <= n ; i ++) hsh[i] = hsh[i - 1] * K % mod + s[i] - '0';\n    }\n    ll calc(int l,int r){return (hsh[r] - hsh[l - 1] * bs[r - l + 1] % mod + mod) % mod;}\n}T1,T2;\ninline bool jug(int l,int r,int L,int R)\n{\n    if(l > r && L > R) return 1;\n    return (T1.calc(l , r) == T1.calc(L , R) && (T2.calc(l , r) == T2.calc(L , R)));\n}\ninline bool check(int c,int l,int r,int L,int R){return (!(sum[r][c] - sum[l - 1][c]) && !(sum[R][c] - sum[L - 1][c]));}\nsigned main()\n{\n    freopen(\"J.in\",\"r\",stdin);\n    scanf(\"%s\",s + 1);n = strlen(s + 1);\n    T1.init(n , 131 , 1000000007) , T2.init(n , 13331 , 998244353);ll ans = 0 , sm = 0;\n    for(int i = 1 ; i <= n ; i ++) \n    {\n        sum[i][s[i] - 'a'] ++;\n        for(int j = 0 ; j < 26 ; j ++) sum[i][j] += sum[i - 1][j];\n        isr[i][1] = 1 , sm ++ , a[i] ++ , a[i + 1] --;\n        for(int j = 0 ; j < 26 ; j ++) b[i][j] ++;\n    }\n    for(int len = 2 ; (1 << len) - 1 <= n ; len ++)\n    {\n        const int LEN = ((1 << len) - 1);int r = 0 , mid = 0;\n        for(int l = 1 ; l + LEN - 1 <= n ; l ++) \n        {\n            r = l + LEN - 1 , mid = (l + r) >> 1;\n            if(isr[l][len - 1] && jug(l , mid - 1 , mid + 1 , r) && check(s[mid] - 'a' , l , mid - 1 , mid + 1 , r)) \n            {\n                isr[l][len] = 1;const ll add = 1ll * (r - l + 1) * (r - l + 1);\n                a[l] += add , a[r + 1] -= add;\n                sm += add;           \n            }\n        }\n    }\n    //printf(\"%lld\\n\",sm);\n    ans = sm;\n    for(int i = 1 ; i <= n ; i ++) a[i] += a[i - 1];\n    //for(int i = 1 ; i <= n ; i ++) printf(\"%d %lld\\n\",i,a[i]);\n    for(int len = 2 ; (1 << len) - 1 <= n ; len ++)\n    {\n        const int LEN = ((1 << len) - 1);int r = 0 , mid = 0;\n        for(int l = 1 ; l + LEN - 1 <= n ; l ++) \n        {\n            r = l + LEN - 1 , mid = (l + r) >> 1;\n            const ll add = 1ll * (r - l + 1) * (r - l + 1);\n            for(int j = 0 ; j < 26 ; j ++) if(isr[l][len - 1] && jug(l , mid - 1 , mid + 1 , r) && check(j , l , mid - 1 , mid + 1 , r)){b[mid][j] += add;}//printf(\"%d %d %d %d %lld\\n\",mid,j,l,r,add);}\n            if(!jug(l , mid - 1 , mid + 1 , r) && isr[mid + 1][len - 1] && check(s[mid] - 'a' , 2 , 1 , mid + 1 , r))//\u6539\u5de6\u8fb9\n            {\n                const int llen = (1 << (len - 1)) - 1;int anss = 0;\n                int L = 1 , R = llen;\n                while(L <= R) \n                {\n                    int md = (L + R) >> 1;\n                    if(jug(l , l + md - 1 , mid + 1 , mid + 1 + md - 1)) anss = md , L = md + 1;\n                    else R = md - 1;\n                }\n                int now = anss + 2;\n                if(jug(l + now - 1 , mid - 1 , mid + 1 + now - 1 , r)) \n                {\n                    b[l + anss][s[mid + 1 + anss] - 'a'] += add;\n                    //printf(\"%d %d %d %d %lld\\n\",l + anss,s[mid + 1 + anss] - 'a',l,r,add);\n                }\n            }\n            if(!jug(l , mid - 1 , mid + 1 , r) && isr[l][len - 1] && check(s[mid] - 'a' , 2 , 1 , l , mid - 1))//\u6539\u53f3\u8fb9\n            {\n                const int llen = (1 << (len - 1)) - 1;int anss = 0;\n                int L = 1 , R = llen;\n                while(L <= R) \n                {\n                    int md = (L + R) >> 1;\n                    if(jug(l , l + md - 1 , mid + 1 , mid + 1 + md - 1)) anss = md , L = md + 1;\n                    else R = md - 1;\n                }\n                int now = anss + 2;\n                if(jug(l + now - 1 , mid - 1 , mid + 1 + now - 1 , r)) \n                {\n                    b[mid + 1 + anss][s[l + anss] - 'a'] += add;\n                    //printf(\"#%d %d %d %d %lld\\n\",mid + 1 + anss,s[l + anss] - 'a',l,r,add);\n                }\n            }\n        }\n    }\n    for(int i = 1 ; i <= n ; i ++) for(int j = 0 ; j < 26 ; j ++){ans = max(ans , sm - a[i] + b[i][j]);}\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1664271743,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u5426\uff0c\u543e\u4e43\u5929\uff0c\u54c0\u53f9\u4e4b\u5929\uff01"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://codeforces.com/contest/356/problem/E)\n\n\u4e0a\u53e4\u65f6\u4ee3\u6c34 3000 \u9ed1\u9898\uff0c\u5b9e\u9645 2500 \u7d2b\u5dee\u4e0d\u591a\u3002\n\n\u5982\u679c\u6211\u4eec\u8bbe $a_i$ \u662f\u7b2c $i$ \u957f\u7684 $gray$ \u4e32\u7684\u957f\u5ea6\uff0c\u4e0d\u96be\u5f97\u5230\uff1a\n$$\n\\begin{cases}a_i=2a_{i-1}-1,i>1 \\\\ \na_1=1\\end{cases}\n$$\n\u663e\u7136\u5f97 $a_i=2^i-1$.\n\n\u4e5f\u5c31\u610f\u5473\u7740 $gray$ \u4e32\u7684\u957f\u5ea6\u53d6\u503c\u53ea\u6709 $O(\\log n)$ \u79cd\uff0c\u603b\u7684\u4e32\u6570\u91cf\u4e3a $O(n\\log n)$ \u7ea7\u522b\u7684\u3002\n\n\u77ac\u95f4\u5c31\u4f1a\u53d1\u73b0\u53ef\u4ee5 $O(n\\log n)$ \u7528\u500d\u589e+\u54c8\u5e0c+\u6876\u7684\u5f62\u5f0f\u8ba1\u7b97\u51fa\u6240\u6709 $gray$ \u4e32\u3002\n\n\u8003\u8651\u679a\u4e3e\u4fee\u6539\u7684\u4f4d\u7f6e\u548c\u4fee\u6539\u540e\u8be5\u4f4d\u7f6e\u7684\u5b57\u7b26\uff0c\u4e00\u5171\u6709 $26n$ \u79cd\u65b9\u6848\u3002\u6b64\u65f6\u9996\u5148\u53d1\u73b0\u6211\u4eec\u5e94\u8be5\u9700\u8981\u8ba1\u7b97\u539f\u4e32\u4e2d\u6240\u6709\u8ddf\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u6709\u5173\u7684 $gray$ \u4e32\u7684\u6743\u503c\u4e4b\u548c\uff0c\u8fd8\u9700\u8981\u77e5\u9053\u5f53\u7b2c $i$ \u4e2a\u5b57\u7b26\u6362\u6210\u5b57\u7b26 $j$ \u7684\u65f6\u5019\u65b0\u4ea7\u751f\u7684 $gray$ \u4e32\u6743\u503c\u4e4b\u548c\u3002\u5206\u522b\u8bbe\u4e3a $w(i),g(i,j)$.\n\n\u663e\u7136\u8003\u8651 $w(i)$ \u4f1a\u7b80\u5355\u4e00\u70b9\uff1a\u8003\u8651 $i$ \u6240\u5728\u7684\u6240\u6709 $gray$ \u4e32\u53d1\u73b0\u4e0d\u662f\u5f88\u597d\u641e\u3002\u6362\u4e2a\u65b9\u5411\uff0c\u679a\u4e3e\u6240\u6709 $gray$ \u4e32\uff0c\u5047\u8bbe $s[i...j]$ \u662f\u4e00\u4e2a $gray$ \u4e32\u3002\u90a3\u4e48 $g(i)$ \u5230 $g(j)$ \u90fd\u5e94\u8be5\u52a0\u4e0a $(j-i+1)^2$. \u9759\u6001\u533a\u95f4\u4fee\u6539\u4e0a\u5dee\u5206\uff0c\u4e8e\u662f\u5728 $O(n \\log n)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u4e86\u8fd9\u90e8\u5206\u3002\n\n\u7136\u540e\u8003\u8651\u8ba1\u7b97 $g(i,j)$. \u6211\u4eec\u540c\u6837\u8fd8\u662f\u53cd\u8fc7\u6765\u7b97\u8d21\u732e\u3002\u679a\u4e3e $O(n\\log n)$ \u4e2a\u957f\u5ea6\u4e3a $2^k-1$ \u7684\u533a\u95f4 $[i,j]$\uff0c\u8003\u8651\u5982\u679c\u5b83\u4e3a $gray$ \u4e32\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u54ea\u4e9b\u4f4d\u7f6e\u5f97\u5230\uff0c\u8fd9\u4e9b\u4f4d\u7f6e\u7684\u5bf9\u5e94\u5b57\u7b26\u7b54\u6848\u589e\u52a0\u3002\u7b2c\u4e00\u773c\uff0c\u4f3c\u4e4e\u4e0d\u80fd\u5feb\u901f\u786e\u5b9a\u54ea\u4e9b\u4f4d\u7f6e\u4fee\u6539\u540e\u5408\u6cd5\u3002\u5206\u8ba8\u4e00\u4e0b\u4fee\u6539\u4e2d\u95f4\u4f4d\u7f6e\u548c\u4fee\u6539\u4e24\u8fb9\uff1a\n\n- \u5982\u679c\u4fee\u6539\u4e2d\u95f4\u4f4d\u7f6e\u540e\u5408\u6cd5\uff0c\u610f\u5473\u7740\u4e24\u8fb9\u672c\u5c31\u5b8c\u5168\u76f8\u7b49\u540c\u65f6\u90fd\u662f $gray$ \u4e32\uff0c\u53ea\u662f\u5b57\u7b26 $s[mid]$ \u5728\u4e24\u8fb9\u51fa\u73b0\u8fc7\u3002\u8fd9\u90e8\u5206\u5f88\u597d\u641e\u3002\u679a\u4e3e $s[mid]$ \u4fee\u6539\u7684\u5b57\u7b26\uff0c$O(1)$ \u8ba1\u7b97\u5b83\u662f\u5426\u5728\u4e24\u8fb9\u51fa\u73b0\u8fc7\u3002\n\n- \u5982\u679c\u4fee\u6539\u4e24\u4fa7\u7684\u67d0\u4e00\u4e2a\u4f4d\u7f6e\u540e\u5408\u6cd5\uff0c\u4e0d\u59a8\u8bbe\u4fee\u6539\u7684\u662f\u5de6\u4fa7\u3002\u5373\u610f\u5473\u7740\u5de6\u53f3\u4e24\u4fa7\u53ea\u6709\u8fd9\u4e00\u4e2a\u4f4d\u7f6e\u4e0d\u540c\uff0c\u540c\u65f6\u53f3\u4fa7\u5df2\u7ecf\u662f $gray$ \u4e32\uff0c\u540c\u65f6 $s[mid]$ \u5b57\u7b26\u672a\u5728\u53f3\u8fb9\u51fa\u73b0\u3002\u5de6\u8fb9\u540c\u7406\u3002\n\n  \u6ce8\u610f\u5230\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u6c42\u51fa\u90a3\u4e2a\u4e0d\u540c\u7684\u4f4d\u7f6e\u3002\u53ef\u4ee5\u4e8c\u5206\u627e\u5230\u4e24\u4e2a\u4e32\u7b2c\u4e00\u4e2a\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u5224\u65ad\u540e\u9762\u7684\u90e8\u5206\u662f\u5426\u8fd8\u662f\u5b8c\u5168\u76f8\u540c\uff0c\u5982\u679c\u662f\uff0c\u8bf4\u660e\u8fd9\u4e2a\u4e0d\u540c\u4f4d\u7f6e\u552f\u4e00\u3002\n\n\u663e\u7136\u8fd9\u90e8\u5206 $g$ \u7684\u8ba1\u7b97\u662f $O(26n\\log n)$ \u7684\u3002\n\n\u6700\u540e\u6c42 $\\max\\{sum-w(i)+g(i,j)\\}$ \u5373\u53ef\uff0c$sum$ \u662f\u539f\u4e32\u7684\u7f8e\u4e3d\u503c\uff0c\u53ef\u4ee5\u5728\u5f00\u59cb\u7b97\u51fa\u6240\u6709 $gray$ \u4e32\u7684\u65f6\u5019\u987a\u5e26\u641e\u51fa\u6765\u3002\n\n\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u4e3a $O(26n\\log n)$.\n\n```C++\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(ll i=(a);i<=(b);i++)\n#define per(i,a,b) for(ll i=(a);i>=(b);i--)\n#define op(x) ((x&1)?x+1:x-1)\n#define odd(x) (x&1)\n#define even(x) (!odd(x))\n#define lc(x) (x<<1)\n#define rc(x) (lc(x)|1)\n#define lowbit(x) (x&-x)\n#define Max(a,b) (a>b?a:b)\n#define Min(a,b) (a<b?a:b)\n#define next Cry_For_theMoon\n#define il inline\n#define pb(x) push_back(x)\n#define is(x) insert(x)\n#define sit set<int>::iterator\n#define mapit map<int,int>::iterator\n#define pi pair<int,int>\n#define ppi pair<int,pi>\n#define pp pair<pi,pi>\n#define fr first\n#define se second\n#define vit vector<int>::iterator\n#define mp(x,y) make_pair(x,y)\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef unsigned int uint;\ntypedef double db;\nusing namespace std;\nconst int MAXN=1e5+10,base=13331;\nint n,valid[MAXN][27];\nint bucket[MAXN][27]; //\u524d\u7f00\u6876 \nchar s[MAXN];\null power[MAXN],preh[MAXN]; //\u524d\u7f00hash\u503c\nll w[MAXN],g[MAXN][27]; //\u539f\u6709\u8d21\u732e\uff0c\u4fee\u6539\u589e\u52a0\u8d21\u732e\nll ans; \nil ull gethash(int i,int j){\n\t//hash(S[i..j])\n\tif(i>j)return 0;\n\treturn preh[j]-preh[i-1]*power[j-i+1];\n}\nil int getcnt(int i,int j,char ch){\n\t//ch\u5728S[i..j]\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\n\tif(i>j)return 0;\n\treturn bucket[j][ch-'a'+1]-bucket[i-1][ch-'a'+1]; \n}\nint main(){\n\tscanf(\"%s\",s+1);n=strlen(s+1);\n\tpower[0]=1;\n\trep(i,1,n){\n\t\tpreh[i]=preh[i-1]*base+(s[i]-'a'+1);\n\t\tpower[i]=power[i-1]*base;\n\t\trep(j,1,26)bucket[i][j]=bucket[i-1][j];\n\t\tbucket[i][s[i]-'a'+1]++;\n\t}\n\t//\u9884\u5904\u7406\u6240\u6709gray\u4e32\n\trep(i,1,n)valid[i][1]=1;\n\trep(k,2,29){\n\t\trep(i,1,n){\n\t\t\tif(i+(1<<k)-2>n)break;\n\t\t\tint j=i+(1<<k)-2;int mid=(i+j)/2; \n\t\t\tvalid[i][k]=(getcnt(i,j,s[mid])==1) && (valid[i][k-1] && valid[mid+1][k-1]) && \n\t\t\t(gethash(i,mid-1)==gethash(mid+1,j));\n\t\t}\n\t} \n\t//\u8ba1\u7b97w\n\trep(i,1,n){\n\t\trep(k,1,19){\n\t\t\tint len=(1<<k)-1;\n\t\t\tint j=i+len-1;\n\t\t\tif(valid[i][k])ans+=(ll)len*len,w[i]+=(ll)len*len,w[j+1]-=(ll)len*len;\n\t\t}\n\t} \n\trep(i,1,n)w[i]+=w[i-1];\n\t//\u8ba1\u7b97g \n\trep(i,1,n){\n\t\trep(j,1,26){g[i][j]++;} //\u957f\u5ea6\u4e3a1\u7684\u5b57\u7b26 \n\t\trep(k,2,19){\n\t\t\tint len=(1<<k)-1;int j=i+len-1;int mid=(i+j)/2;\n\t\t\tif(j>n)break;\n\t\t\t//\u4fee\u6539s[i...j]\u4f7f\u5176\u53d8\u6210gray\u4e32 \n\t\t\tif(gethash(i,mid-1)==gethash(mid+1,j)){\n\t\t\t\t//\u6539\u4e2d\u95f4 \n\t\t\t\tif(valid[i][k-1] && valid[mid+1][k-1]){\n\t\t\t\t\trep(x,1,26){\n\t\t\t\t\t\tif(!getcnt(i,mid-1,'a'+x-1))g[mid][x]+=(ll)len*len;\n\t\t\t\t\t} \n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t//\u6539\u4e24\u8fb9\u7684\u552f\u4e00\u4e0d\u540c\u5b57\u7b26\n\t\t\t\t//\u4e8c\u5206\u67e5\u627e\u8fd9\u4e2a\u4f4d\u7f6e\n\t\t\t\tint L=1,R=(1<<(k-1))-1,ret=0;\n\t\t\t\twhile(L<=R){\n\t\t\t\t\tint MID=(L+R)>>1;\n\t\t\t\t\tif(gethash(i,i+MID-1)!=gethash(mid+1,mid+MID)){\n\t\t\t\t\t\tret=MID;\n\t\t\t\t\t\tR=MID-1;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tL=MID+1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//s[i+ret-1]\u548cs[mid+ret]\u4e0d\u540c \n\t\t\t\tif(gethash(i+ret,mid-1) != gethash(mid+ret+1,j))continue;\n\t\t\t\t\n\t\t\t\t//1.\u5de6\u6539\u53f3\n\t\t\t\tif(valid[mid+1][k-1]){\n\t\t\t\t\tif(!getcnt(mid+1,j,s[mid]))g[i+ret-1][s[mid+ret]-'a'+1]+=(ll)len*len;\n\t\t\t\t} \n\t\t\t\t//2.\u53f3\u6539\u5de6\n\t\t\t\tif(valid[i][k-1]){\n\t\t\t\t\tif(!getcnt(i,mid-1,s[mid]))g[mid+ret][s[i+ret-1]-'a'+1]+=(ll)len*len;\n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t} \n\tll t=0;\n\trep(i,1,n){\n\t\tll tmp=ans;\n\t\trep(j,1,26)tmp=Max(tmp,ans-w[i]+g[i][j]);\n\t\tt=Max(t,tmp);\n\t}\n\tans=t;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1623678644,
        "uid": 340632,
        "name": "Cry_For_theMoon",
        "ccfLevel": 8,
        "title": "\u3010CF356E\u3011Xenia and String Problem"
    },
    {
        "content": "**[\u76f8\u5dee\u65e0\u51e0\u7684\u9605\u8bfb\u4f53\u9a8c](https://charleswu.site/archives/2757)**\u3002\n\n\u8fd9\u662f\u4e00\u79cd\u4e0d\u9700\u8981\u4efb\u4f55\u6570\u636e\u7ed3\u6784\u548c\u5904\u7406\u5b57\u7b26\u4e32\u7684\u5de5\u5177\uff0c\u4f46\u7ec6\u8282\u7e41\u591a\u7684\u505a\u6cd5\u3002\n\n\u8bbe\u5168\u4e32\u4e3a $s_{1\\dots n}$\u3002\u4e0d\u96be\u53d1\u73b0\uff0cGray string \u7684\u4e32\u957f\u5fc5\u7136\u662f $2^w-1\\quad (w\\geq 1)$ \u7684\u5f62\u5f0f\u3002\u82e5\u5176\u957f\u4e3a $2^w-1$\uff0c\u6211\u4eec\u79f0\u5176\u4e3a $w-1$ \u9636 Gray string\u3002\n\n\u540c\u65f6\u7528\u5f52\u7eb3\u6cd5\u53ef\u4ee5\u8bc1\u660e\uff0c\u8bbe\u4e00\u4e2a $w$ \u9636 Gray string \u7684\u8d77\u59cb\u4f4d\u7f6e\u4e3a $x+1$\uff08\u5176\u7ec8\u5230\u4f4d\u7f6e\u4e3a $x+2^{w+1}$\uff09\uff0c\u90a3\u4e48\u5fc5\u7136\u6709\n$$\n\\forall k\\in\\{0,1,\\cdots,w\\},s_{x+2^k}=s_{x+2^k+2^{k+1}}=s_{x+2^k+2\\times 2^{k+1}}=\\cdots=s_{x+2^k+(2^{w-k}-1)2^{k+1}}\\\\\n\\forall i,j,0\\leq i<j\\leq w,s_{x+2^i}\\neq s_{x+2^j}\n$$\n\u6210\u7acb\u3002\u4f8b\u5982\u4e00\u4e2a $3$ \u9636 Gray string \u53ef\u4ee5\u88ab\u63cf\u8ff0\u4e3a $\\mathtt{abacabadabacaba}$\u3002\n\n\u8003\u8651\u5728\u4e0d\u66f4\u6539\u5b57\u7b26\u7684\u60c5\u51b5\u4e0b\uff0c\u8ba1\u7b97\u6240\u6709\u4f4d\u7f6e $x\\quad (0\\leq x<n)$ \u6709\u591a\u5c11 $w$ \u6ee1\u8db3 $s_{x+1\\dots x+2^{w+1}}$ \u662f Gray string\u3002\u6211\u4eec\u8bb0 $g(y,w)$ \u4e3a\u6700\u5927\u7684 $k$\uff0c\u6ee1\u8db3 $s_y=s_{y+2^{w+1}}=s_{y+2\\times 2^{w+1}}=\\cdots=s_{y+(k-1)2^{w+1}}$\uff0c\u4e5f\u5373\u95f4\u9694\u4e3a $2^{w+1}$ \u7684**\u6781\u957f\u90bb\u9879\u5b57\u7b26\u76f8\u7b49\u7684\u94fe**\u3002\u8fd9\u53ef\u4ee5\u66b4\u529b $\\operatorname{O}(n\\log n)$ \u6c42\u51fa\u3002\u90a3\u4e48\u4f4d\u7f6e $x$ \u80fd\u591f\u8d21\u732e\u4e00\u4e2a $w$ \u9636 Gray string\uff0c\u5f53\u4e14\u4ec5\u5f53\n$$\n\\forall 0\\leq i\\leq w,w\\leq i+\\lfloor\\log_2 g(x+2^i,i)\\rfloor\\\\\n\\forall 0\\leq i<j\\leq w,s_{x+2^i}\\neq s_{x+2^j}\n$$\n\u8fd9\u4f9d\u7136\u53ef\u4ee5 $\\operatorname{O}(n\\log n)$ \u6c42\u51fa\u2014\u2014\u6211\u4eec\u4ece\u5c0f\u5230\u5927\u904d\u5386 $w$ \u5e76\u66f4\u65b0\u4e0a\u6587\u5f0f\u5b50\u7684\u6700\u5c0f\u503c\uff0c\u76f4\u5230 $w$ \u8d85\u8fc7\u8fd9\u4e2a\u6700\u5c0f\u503c\u6216\u8005\u51fa\u73b0\u91cd\u590d\u5b57\u7b26\u3002\u56fa\u5b9a\u4f4d\u7f6e $x$\uff0c\u8bb0 $w_0$ \u662f\u6ee1\u8db3\u4e0a\u5f0f\u7684\u6700\u5927 $w$\u3002\n\n\u73b0\u5728\u601d\u8003\u5f53\u67d0\u4e2a\u4f4d\u7f6e\u7684\u5b57\u7b26\u88ab\u66ff\u6362\u540e\uff0c$x$ \u7684\u8d21\u732e\u6709\u4f55\u53d8\u5316\u3002\u6211\u4eec\u5206\u4e24\u4e2a\u90e8\u5206\u8003\u8651\uff1a**\u5220\u9664**\u548c**\u65b0\u589e**\u3002\u8bb0\u5728\u5168\u4e32\u8303\u56f4\u5185\uff0c\u5c06 $s_u$ \u53d8\u4e3a\u5b57\u7b26 $c$ \u4f1a\u65b0\u589e $h(u,c)$ \u7684\u6743\u503c\u548c\u3002\n\n### \u88ab\u5220\u9664\u7684\u4e32\n\n\u6613\u5f97\u5bf9\u4e8e\u6240\u6709 $u\\quad (x<u<x+2^{w+1})$\uff0c$s_u$ \u7684\u6539\u53d8\u5c06\u76f4\u63a5\u7834\u574f Gray string $s_{x+1\\dots x+2^{w+1}-1}$\uff1b\u7279\u522b\u5730\uff0c\u82e5 $u=x+2^w$\uff08\u8be5 Gray string \u7684\u4e2d\u592e\u5b57\u7b26\uff09\uff0c\u4e14\u6709 $\\forall 0\\leq i<w, {s_u}'\\neq s_{x+2^i}$\uff08\u4e0d\u4e0e\u66f4\u4f4e\u9636\u7684\u5b57\u7b26\u91cd\u590d\uff09\uff0c\u5219\u8fd9\u4e2a $w$ \u9636 Gray string \u4e0d\u4f1a\u88ab\u7834\u574f\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8bbe\u7acb\u5dee\u5206\u6570\u7ec4 $d(x)\\quad(1\\leq x\\leq n)$\uff0c\u7ef4\u62a4\u7834\u574f\u9020\u6210\u7684\u8d1f\u6743\u503c\u3002\u8bb0 $b_w=(2^{w+1}-1)^2$\u3002\u4ee4\n$$\\begin{aligned}\n{d(x+1)}'&\\leftarrow d(x+1)-b_w\\\\\n{d(x+2^{w+1})}'&\\leftarrow d(x+2^{w+1})+b_w\\\\\n{d(x+2^w)}'&\\leftarrow d(x+2^w)+b_w\\\\\n{d(x+2^w+1)}'&\\leftarrow d(x+2^w+1)-b_w&\\text{\uff08\u4e2d\u592e\u5b57\u7b26\u53ef\u4ee5\u6539\u53d8\uff09}\\\\\n\\forall i,0\\leq i<w,{h(x+2^w,s_{x+2^i})}'&\\leftarrow h(x+2^w,s_{x+2^i})-(2^{w+1}-1)^2&\uff08\u4f46\u4e0d\u80fd\u6539\u4e3a\u91cd\u590d\u5b57\u7b26\uff09\n\\end{aligned}$$\n\n### \u65b0\u589e\u7684\u4e32\n\n\u6211\u4eec\u79f0\u4f4d\u7f6e $x$ \u7684\u6269\u5c55**\u88ab\u963b\u62e6**\uff0c\u5f53\u4e14\u4ec5\u5f53\u6709 $\\forall 0\\leq w\\leq w_0,w_0<w+\\lfloor\\log_2 g(x+2^w,w)\\rfloor$\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740 $w_o+1$ \u9636\u4f4d\u7f6e\u51fa\u73b0\u4e86\u91cd\u590d\u5b57\u7b26\uff1b\u53cd\u4e4b\uff0c**\u672a\u88ab\u963b\u62e6**\u662f\u8bf4 $w_0$ \u6070\u7b49\u4e8e\u4e86\u9650\u5236\u5f0f\u7684\u4e0a\u754c\u3002\u6309\u7167\u8fd9\u4e2a\u5b9a\u4e49\uff0c\u540c\u65f6\u51fa\u73b0 $w_0$ \u5361\u5230\u4e0a\u754c\u548c $w_0+1$ \u9636\u4f4d\u7f6e\u6709\u91cd\u590d\u5b57\u7b26\u7684\u8bdd\uff0c\u4f1a\u88ab\u5f52\u4e3a\u201c\u672a\u963b\u62e6\u201d\u3002\n\n#### \u672a\u88ab\u963b\u62e6\n\n\u6211\u4eec\u4ee4 $j$ \u662f\u6240\u6709 $w\\quad (0\\leq w\\leq w_0)$ \u4e2d\u53d6\u5230 $w_0=w+\\lfloor\\log_2 g(x+2^w,w)\\rfloor$ \u7684\u503c\uff0c\u4e5f\u5373\u4e0a\u754c\u7684\u6765\u6e90\u3002\u82e5 $j$ \u4e0d\u552f\u4e00\uff0c\u7531\u4e8e\u66ff\u6362\u5355\u4e2a\u5b57\u7b26\u6700\u591a\u66f4\u6539\u4e00\u4e2a $g(x+2^w,w)$\uff0c\u6545\u800c $w_0$ \u4e0d\u4f1a\u6539\u53d8\uff0c\u4e0d\u53ef\u80fd\u5728 $x$ \u5904\u6709\u65b0\u7684\u8d21\u732e\u3002\n\n\u82e5 $j$ \u552f\u4e00\uff0c\u6709\u4e24\u79cd\u53ef\u80fd\u4f7f\u5f97 $g(x+2^j,j)$ \u53d8\u5927\u3002\u8bb0\u5e94\u7528 ${g(x+2^j,j)}'$ \u5f97\u5230\u7684\u65b0\u4e0a\u754c\u4e3a ${w_0}'$\u3002\n\n- $u=x+2^j+2^{j+1}g(x+2^j,j)$ \u4e14 ${s_u}'=s_{x+2^j}$\uff0c\u4e5f\u5373 $u$ \u4e3a $j$ \u9636\u94fe\u5c3e\u7684\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u3002\u5c06 $s_u$ \u8bbe\u7f6e\u4e3a $s_{x+2^j}$\uff0c\u5c31\u662f\u5c06\u5b83\u5408\u5e76\u5230 $j$ \u9636\u6781\u957f\u94fe\u4e0a\u2014\u2014\u8fd9\u751a\u81f3\u8fd8\u53ef\u80fd\u5bfc\u81f4 $u$ \u4e24\u4fa7\u4e24\u6761 $j$ \u9636\u94fe\u7684\u5408\u5e76\uff1b\n- $j=w_0$ \u4e14 $u=x+2^j$ \u4e14 $\\forall 0\\leq w\\leq w_0, {s_u}'\\neq s_{x+2^w}$\u3002\u7531 $j=w_0$ \u53ef\u4ee5\u63a8\u51fa $\\lfloor\\log_2 g(x+2^j,j)\\rfloor=0\\iff g(x+2^j,j)=1$\uff0c\u4e5f\u5373\u8fd9\u6761\u94fe\u957f\u4e3a $1$\u3002\u6b64\u65f6\u5c06\u8be5\u4f4d\u7f6e\u672c\u8eab\u66ff\u6362\u6210 $s_{u+2^{j+1}}$\uff08\u5982\u679c\u5176\u4e0e\u4f4e\u9636\u7684\u94fe\u4e0d\u91cd\u590d\uff09\uff0c\u53ef\u80fd\u4f1a\u5f15\u53d1\u4e0e\u53f3\u4fa7 $j$ \u9636\u94fe\u7684\u5408\u5e76\uff0c\u8f83\u539f\u4e32\u66f4\u4f18\u3002\n\n\u4e0d\u96be\u8bf4\u660e\uff0c\u5176\u4ed6\u4efb\u4f55\u4f4d\u7f6e\u66ff\u6362\u4efb\u4f55\u5b57\u7b26\uff0c\u90fd\u53ea\u4f1a\u4f7f\u5f97 $x$ \u7684\u8d21\u732e\u524a\u51cf\uff08$g(x+2^w,w)$ \u4e0d\u589e\uff09\uff1b\u800c\u8d1f\u8d21\u732e\u5df2\u7ecf\u5728\u4e0a\u6587\u4e2d\u8ba1\u7b97\u5b8c\u6210\u4e86\u3002\u5982\u679c\u4e0a\u6587\u4e24\u79cd\u60c5\u51b5\u6709\u65b0\u7684\u8d21\u732e\uff0c\u5219\u6211\u4eec\u5206\u522b\u7d2f\u52a0 $h(u,{s_u}')'\\leftarrow h(u,{s_u}')+\\sum_{w=w_0+1}^{{w_0}'} b_w$\u3002\n\n#### \u88ab\u963b\u62e6\n\n\u53ef\u4ee5\u9a8c\u8bc1\uff0c\u88ab\u963b\u62e6\u65f6\u53ea\u6709\u6539\u53d8 $s_{u=x+2^{w_0+1}}$\uff0c\u4e5f\u5373 $w_0+1$ \u9636\u94fe\u7684\u9996\u5b57\u7b26\uff0c\u624d\u6709\u53ef\u80fd\u5728 $x$ \u5904\u6709\u65b0\u8d21\u732e\u3002\u82e5\u6709 ${s_u}'\\neq s_{x+2^{w_0+1}x+2^{w_0+2}}$\uff08\u8bd5\u56fe\u5408\u5e76\u4e24\u6761 $w_0+1$ \u9636\u94fe\uff09\uff0c\u53ef\u80fd\u6709 ${w_0}'>w_0+1$\uff1b\u5426\u5219\u5fc5\u7136\u6709 ${g(u,w_0+1)}'=1,{w_0}'=w_0+1$\u3002\u53ea\u6709\u4e00\u79cd\u60c5\u51b5\u9700\u8981\u91cd\u65b0\u66b4\u529b\u8ba1\u7b97\u3002\u53ca\u65f6\u66f4\u65b0 $h(u,*)$ \u5373\u53ef\u3002\n\n\u6700\u540e\u6211\u4eec\u4ece\u524d\u5230\u540e\u7d2f\u52a0\u5dee\u5206\uff0c\u5229\u7528 $h$ \u66f4\u65b0\u7b54\u6848\u5373\u53ef\u3002\n\n\u6309\u7167\u4e0a\u8ff0\u65b9\u6cd5\u7cbe\u7ec6\u5b9e\u73b0\uff0c\u53ef\u4ee5\u505a\u5230 $\\operatorname{O}(n\\log n)$\uff0c\u5e38\u6570\u5c0f\u3002[\u662f\u4e3a\u76ee\u524d\u672c\u9898\u6700\u4f18\u89e3](https://codeforces.com/contest/356/status?order=BY_CONSUMED_TIME_ASC)\u3002\n\n**[Submission #187976651](https://codeforces.com/contest/356/submission/187976651)**\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define inl __attribute__((always_inline)) inline\ntypedef long long ll;\n#define all(p) begin (p), end (p)\n\nconstexpr int N = 1e5 + 10;\nconstexpr ll b[] = { 1, 9, 49, 225, 961, 3969, 16129, 65025, 261121, 1046529,\n\t4190209, 16769025, 67092481, 268402689, 1073676289, 4294836225, 17179607041 };\nconstexpr ll bpre[] = { 1, 10, 59, 284, 1245, 5214, 21343, 86368, 347489, 1394018,\n\t5584227, 22353252, 89445733, 357848422, 1431524711, 5726360936, 22905967977 };\nint n, g[17][N]; char s[N]; ll ans, dt[N], ata[N][26];\n\ninl int cnxt (int x, int i) { return x + g[i][x+(1<<i)] * (1<<i+1) + (1<<i); }\ninl int ced (int x, int i) { return x + g[i][x+(1<<i)] * (1<<i+1) - (1<<i); }\ninl int cst (int x, int i) { return x + (1<<i); }\ninl int imple (int x) {\n\tstatic bool occ[26];\n\tint w = 0, lmt = INT_MAX, y;\n\tmemset (occ, 0, 26);\n\twhile (w <= lmt && !occ[s[y = cst (x, w)]-'a'])\n\t\tlmt = min (lmt, __lg (g[w][y]) + w),\n\t\tocc[s[y] - 'a'] = 1, ++w;\n\treturn --w;\n}\n\nint main () {\n\t/*  */\n\tscanf (\"%s\", s + 1); n = strlen (s + 1);\n\tfor (int w = 0; (1<<w) <= n; ++w)\n\t\tfor (int st = 1; st <= 1<<w+1; ++st) {\n\t\t\tint x = st, y = st, cnt = 0;\n\t\t\twhile (x <= n) {\n\t\t\t\twhile (y <= n && s[x] == s[y]) y += 1<<w+1, ++cnt;\n\t\t\t\twhile (x < y) g[w][x] = cnt--, x += 1<<w+1;\n\t\t\t}\n\t\t}\n\n\tfor (int x = 0; x < n; ++x) {\n\t\tstatic bool occ[26];\n\t\tstatic int bd[17], lst[17];\n\t\tmemset (occ, 0, 26);\n\t\tint w = 0, lmt = INT_MAX, y, z, c, _g, alp;\n\t\twhile (w <= lmt && !occ[s[y = cst (x, w)]-'a'])\n\t\t\tlmt = min (lmt, bd[w] = __lg (g[w][y]) + w),\n\t\t\tocc[lst[w++] = s[y] - 'a'] = 1;\n\t\t\n\t\tans += bpre[--w], dt[x + 1] -= bpre[w];\n\t\tfor (int i = 0; i <= w; ++i) {\n\t\t\tdt[x+(1<<i+1)] += b[i],\n\t\t\tdt[y = cst (x, i)] += b[i], dt[y+1] -= b[i];\n\t\t\tfor (int k = 0; k < i; ++k)\n\t\t\t\tata[y][lst[k]] -= b[i];\n\t\t}\n\n\t\tif (w == lmt) {\n\t\t\t// ? \u65e0\u963b\u62e6/\u975e\u4e25\u683c\u963b\u62e6\u3002\n\t\t\tint j = -1;\n\t\t\tfor (int i = 0; i <= w; ++i)\n\t\t\t\tif (bd[i] == w) j = ~j ? INT_MAX : i;\n\t\t\tif (j == INT_MAX) continue;\n\t\t\t// ? \u5728j\u9636\u540e\u9762\u8865\u8db3\u3002\n\t\t\tif ((z = cnxt (x, j)) > n) goto KAWA;\n\t\t\tc = s[z], s[z] = s[y = cst (x, j)];\n\t\t\t_g = g[j][y], g[j][y] += 1 + ((alp = z + (1<<j+1)) <= n\n\t\t\t\t&& s[alp] == s[y] ? g[j][alp] : 0);\n\t\t\tata[z][s[y]-'a'] += bpre[imple (x)] - bpre[w];\n\t\t\tg[j][y] = _g, s[z] = c;\n\t\t\t// ? \u82e5\u6709j = w\uff0c\u5219\u81ea\u7136\u6709j\u9636\u8fde\u901a\u5757\u5927\u5c0f\u4e3a1\u3002\u5c1d\u8bd5\u6539\u6362\u5b83\u81ea\u5df1\u7684\u989c\u8272\u3002\n\t\t\tKAWA: if (j != w || (z = cnxt (x, w)) > n\n\t\t\t\t|| occ[s[z] - 'a']) continue;\n\t\t\tc = s[y = cst (x, w)], s[y] = s[z];\n\t\t\t_g = g[w][y], g[w][y] += g[w][z];\n\t\t\tata[y][s[z]-'a'] += bpre[imple (x)] - bpre[w];\n\t\t\tg[w][y] = _g, s[y] = c;\n\t\t} else {\n\t\t\t// ? \u4e25\u683c\u963b\u62e6\u3002\n\t\t\t// ? \u6dfb\u7f6e\u4e00\u4e2a\u6ca1\u6709\u51fa\u73b0\u8fc7\u7684\u5b57\u7b26\u3002\n\t\t\tfor (c = 0, y = cst (x, w+1); c < 26; ++c)\n\t\t\t\tata[y][c] += !occ[c] * b[w+1];\n\t\t\tif (g[w+1][y] > 1 || (z = y + (1<<w+2)) > n) continue;\n\t\t\tata[y][s[z]-'a'] -= b[w+1];\n\t\t\tc = s[y], s[y] = s[z], g[w+1][y] += g[w+1][z];\n\t\t\tata[y][s[z]-'a'] += bpre[imple (x)] - bpre[w];\n\t\t\ts[y] = c, g[w+1][y] = 1;\n\t\t}\n\t}\n\n\tfor (ll ima = ans, x = 1; x <= n; ++x)\n\t\tans = max (ans, (ima += dt[x]) + *max_element (all (ata[x])));\n\tprintf (\"%lld\", ans);\n\n\treturn 0;\n}\n```",
        "postTime": 1672889296,
        "uid": 241614,
        "name": "NGC5457",
        "ccfLevel": 8,
        "title": "CF356E - Xenia and String Problem - \u9898\u89e3"
    }
]