[
    {
        "content": "<http://39.107.58.77/archives/cf-1250d.html>\n\n\u627e\u4e0d\u5230\u4e2d\u6587\u7684\u9898\u89e3...\u7ed3\u679c\u662f\u6700\u540e\u88ab\u8feb\u53bb\u770b\u4e86CF\u5b98\u7f51\u7684\u9898\u89e3.\u53c2\u8003\u4e86@[dafeng](https://codeforces.ml/profile/dafeng)\u7684[\u9898\u89e3(\u5728\u8bc4\u8bba\u533a\u91cc)](https://codeforces.ml/blog/entry/70915)\u7684\u60f3\u6cd5.\u53e6\u5916\u6700\u8fd1\u597d\u50cf\u6d1b\u8c37\u7684RMJ\u6709\u4e9b\u9505,\u5728CF\u4e0a\u663e\u793aAC\u7684\u6d1b\u8c37\u662fUKE.\u7ffb\u8bd1\u597d\u50cf\u6709\u70b9\u95ee\u9898,\u5efa\u8bae\u770b\u8fd9\u4e2a.\n\n## \u9898\u610f\n\n> \u6709$n$\u4e2a\u4eba\u51fa\u5e2d\u4e00\u4e2a\u4f1a\u8bae,\u7b2c$i$\u4eba\u5c06\u5728$[l_i,r_i]$\u65f6\u95f4\u5185\u51fa\u5e2d,\u56fd\u7c4d\u662f$c_i$(\u5982\u679c$c_i=0$\u8868\u793a\u4e0d\u6e05\u695a\u56fd\u7c4d,\u4f46\u662f\u4e00\u5b9a\u5c5e\u4e8e\u67d0\u4e2a\u56fd\u5bb6).\u5982\u679c$i$\u505c\u7559\u671f\u95f4\u4e0d\u5b58\u5728\u67d0\u4e2a$j$\u6ee1\u8db3$c_i\\not=c_j$,\u4ed6\u5c31\u4f1a\u4e0d\u9ad8\u5174.\n>\n> \u5bf9\u4e8e\u4e00\u79cd\u53ef\u80fd\u7684\u5bf9\u4e8e$c_i=0$\u7684$i$\u7684\u56fd\u7c4d\u60c5\u51b5,\u4f1a\u6709$x$\u4e2a\u4eba\u4e0d\u9ad8\u5174.\u6c42\u6700\u5927\u7684\u53ef\u80fd\u7684$x$.\n\n## \u89e3\u9898\u601d\u8def\n\n\u9996\u5148**\u6309$r$\u6392\u5e8f**,\u8fd9\u6837\u5c31\u53ef\u4ee5\u6309\u7167\u65f6\u95f4\u5148\u540e\u987a\u5e8f\u4f9d\u6b21\u8003\u8651.**\u4ee4$S_i$\u8868\u793a\u5728$i$\u8bbf\u95ee\u671f\u95f4\u80fd\u89c1\u5230\u7684\u4eba\u7684\u96c6\u5408**,\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5:\n\n- **\u4e00\u5b9a\u4f1a\u4e0d\u9ad8\u5174\u7684**,\u6ee1\u8db3$\\forall j\\in S_i,c_i=c_j\\not=0$;\n- **\u4e00\u5b9a\u4e0d\u4f1a\u4e0d\u9ad8\u5174\u7684**,\u6ee1\u8db3$\\exists j\\in S_i,c_i\\not=c_j,c_{i,j}\\not=0$;\n- \u53ef\u80fd\u4f1a\u4e0d\u9ad8\u5174\u7684,$\\forall j\\in S_i,c_j=0$;\n- \u53ef\u80fd\u4f1a\u4e0d\u9ad8\u5174\u7684,$\\exists j,k\\in S_i,c_j=0,c_k\\not=0$.\n\n\u524d\u4e24\u79cd\u60c5\u51b5\u4e0e\u5176\u4ed6\u4eba\u65e0\u5173,\u53ef\u4ee5\u63d0\u524d\u5904\u7406,\u53ea\u7528\u8003\u8651\u540e\u4e24\u79cd\u60c5\u51b5.\n\n### DP\n\n\u663e\u7136\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6ee1\u8db3\u540e\u4e24\u79cd\u60c5\u51b5\u7684$i$\u5bf9\u5e94\u7684$S_i$,\u6709$\\exists j\\in S_i,c_j=0$(\u5982\u679c\u6ca1\u6709\u90a3\u72b6\u6001\u5e94\u8be5\u5df2\u7ecf\u88ab\u786e\u5b9a\u4e86).\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u7ed9\u6bcf\u4e2a$S_i$\u5206\u914d\u56fd\u5bb6.\u4e0d\u59a8\u5148**\u8bbe$p[i]$\u8868\u793a\u6700\u5c0f\u7684\u6ee1\u8db3$S_i$\u4e0e$S_{p[i]}$\u6709\u4ea4**,\u5bb9\u6613\u8bc1\u660e\u6392\u5e8f\u540e$\\forall j<i$\u6ee1\u8db3\u8be5\u6761\u4ef6\u7684\u4e00\u5b9a\u662f\u4ece$1$\u5f00\u59cb\u7684\u8fde\u7eed\u7684\u4e00\u6bb5.**\u7528$f[i]$\u8868\u793a\u4f7f$i$\u4e0d\u9ad8\u5174\u65f6$0\\sim i-1$\u4e2d\u4e0d\u9ad8\u5174\u7684\u6700\u5927\u4eba\u6570**,\u5206\u522b\u8003\u8651\u540e\u4e24\u79cd\u60c5\u51b5,\u8fdb\u884cDP.\n\n\u5982\u679c\u662f**\u7b2c\u4e09\u79cd\u60c5\u51b5**,\u90a3\u4e48\u679a\u4e3e\u7ed9$S_i$\u5206\u914d\u7684\u989c\u8272,\u6709\n$$\nf[i]=\\max\\{f[i-1],f[k-1]+g_0[k,i]+g_j[k,i]\\},k\\le p[i]\n$$\n\u5176\u4e2d,$j$\u53d6\u904d\u6240\u6709\u989c\u8272.$k$\u679a\u4e3e\u6240\u6709$S_k$\u4e0e$S_i$\u6ca1\u6709\u4ea4\u7684\u4eba,\u8fd9\u6837\u7684\u4eba\u5bf9\u5e94\u7684\u96c6\u5408\u5206\u914d\u4efb\u4f55\u56fd\u5bb6\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230$i$.\u8fd9\u4e2a\u5f0f\u5b50\u7684\u610f\u4e49\u662f\u7ed9$S_k,k\\le j\\le i$\u5206\u914d\u56fd\u5bb6$j$,\u7528$g_j[k,i]$\u8868\u793a$k\\sim i$\u4e2d\u5206\u914d\u56fd\u5bb6$j$\u4e0d\u9ad8\u5174\u7684\u4eba\u7684\u603b\u6570,\u56fd\u5bb6\u4e3a$0$\u8868\u793a\u65e0\u8bba\u5206\u914d\u54ea\u79cd\u989c\u8272\u90fd\u4f1a\u4e0d\u9ad8\u5174.\u6ce8\u610f\u8fd9\u91cc\u4e0d\u9ad8\u5174\u4e0d\u662f\u56e0\u4e3a\u7b2c\u4e00\u79cd\u60c5\u51b5,\u800c\u662f**\u5bf9\u5e94\u96c6\u5408\u56fd\u5bb6\u90fd\u4e3a$0$\u610f\u5473\u7740\u53ef\u4ee5\u4efb\u610f\u5206\u914d**.\n\n\u5bb9\u6613\u60f3\u5230\u8fd9\u610f\u5473\u7740\u9700\u8981\u5728\u8003\u8651\u7b2c$i$\u4e2a\u65f6\u5148\u7ed9$g_0[i]\\gets g_0[i]+1$(\u56e0\u4e3a\u7b2c\u4e09\u79cd\u60c5\u51b5\u5c31\u610f\u5473\u7740\u53ef\u4ee5\u4efb\u610f\u5206\u914d).\n\n\u5982\u679c\u662f**\u7b2c\u56db\u79cd\u60c5\u51b5**\u6709\u7c7b\u4f3c\u7684\u8f6c\u79fb,\u533a\u522b\u5728\u4e8e\u4e3a\u4e86\u4f7f$i$\u4e0d\u9ad8\u5174,\u5fc5\u987b\u5206\u914d$S_i$\u5df2\u6709\u7684\u56fd\u5bb6(\u663e\u7136\u662f\u552f\u4e00\u7684).\u8f6c\u79fb\u65b9\u7a0b\n$$\ng_{c_i}[i]\\gets g_{c_i}[i]+1\\\\\nf[i]=\\max\\{f[i-1],f[k-1]+g_0[k,i]+g_{c_i}[k,i]\\},k\\le p[i]\n$$\n\u7528\u67d0\u79cd\u6ecb\u78c1\u533a\u95f4\u6c42\u548c\u7684\u6570\u636e\u7ed3\u6784\u6bd4\u5982(\u6811\u72b6\u6570\u7ec4,\u7ebf\u6bb5\u6811)\u7ef4\u62a4\u4e00\u4e0b$g$\u5c31\u53ef\u4ee5$\\mathrm O(n^2k\\log(n))$\u6c42\u89e3\u4ee5\u4e0a\u90e8\u5206.**\u63a5\u4e0b\u6765\u8003\u8651$p$\u7684\u6c42\u6cd5.**\n\n### \u6c42\u89e3$p$\n\n\u9996\u5148\u8003\u8651\u76f4\u63a5\u4e0e$S_i$\u6709\u4ea4\u7684$S_j$,\u8fd9\u6837\u7684$j$\u4e00\u5b9a\u6ee1\u8db3$l_i\\le r_j$,$n^2$\u968f\u4fbf\u641e\u4e00\u4e0b\u5373\u53ef,\u8bb0\u7ed3\u679c\u4e3a$p_0$,\u5219\n$$\np[i]=\\min\\{p_0[j]\\},j\\ge p_0[i]\n$$\n**\u5c06$q$\u8bbe\u4e3a$p_0$\u7684\u540e\u7f00$\\min$\u6ee1\u8db3$q[i]=\\min\\{p_0[j]\\},j\\ge i$**.\u96c6\u5408$S_i$\u7531\u4e24\u90e8\u5206\u6784\u6210,\u5206\u522b\u662f$\\{j|p[i]\\le j\\le i\\}$\u548c$\\{j|p[j]\\le i<j\\}$,\u524d\u4e00\u79cd\u60c5\u51b5\u663e\u7136\u662f\u8fde\u7eed\u7684\u4e00\u6bb5,\u800c\u540e\u4e00\u79cd\u662f\u4e00\u4e9b\u5b64\u7acb\u7684\u70b9.\u8003\u8651\u5982\u679c$S_i$\u548c$S_j,i<j$\u6709\u4ea4:\n\n- $S_i$\u7684\u524d\u4e00\u90e8\u5206\u548c$S_j$\u7684\u524d\u4e00\u90e8\u5206,\u6ee1\u8db3$p_0[j]\\le i$\n- $S_i$\u7684\u540e\u4e00\u90e8\u5206\u548c$S_j$\u7684\u524d\u4e00\u90e8\u5206,\u6ee1\u8db3$\\exists k,p_0[k]\\le i~\\text{and}~p_0[j]\\le k\\le j$;\n- $S_i$\u7684\u540e\u4e00\u90e8\u5206\u548c$S_j$\u7684\u540e\u4e00\u90e8\u5206,\u6ee1\u8db3$\\exists k,p_0[k]\\le i,j<k$;\n- $S_i$\u7684\u524d\u4e00\u90e8\u5206\u548c$S_j$\u7684\u540e\u4e00\u90e8\u5206,\u663e\u7136**\u4e0d\u53ef\u80fd**.\n\n\u6574\u7406\u4ee5\u4e0a\u60c5\u51b5,\u5f97\u5230$p_0[j]\\le i$\u6216$\\exists k,p_0[j]\\le k~\\text{and}~p_0[k]\\le i$.\u5c06$q$\u4ee3\u5165\u540e\u4e00\u79cd\u60c5\u51b5\u6709$q[p_0[j]]\\le i$,\u53d1\u73b0\u5bf9\u4e8e**\u4ec5\u6ee1\u8db3\u524d\u4e00\u79cd\u60c5\u51b5**\u7684\u6761\u4ef6,\u6b64\u65f6\u4e5f\u662f\u552f\u4e00\u53ef\u80fd\u6210\u7acb\u7684\u60c5\u51b5.\u6545\u6709$p[i]=q[p_0[i]]$\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u5f0f\u5b50.\n\n### \u590d\u6742\u5ea6\u5206\u6790\n\n\u6c42$p$\u7528\u4e86`set`\u662f$n^2\\log n$,\u540e\u9762\u7684DP\u662f$n^2k\\log n$,\u603b\u4f53\u4e0a\u5e94\u8be5\u662f$\\mathrm O(n^2k\\log n)$.\u4e0d\u8fc7\u7531\u4e8e\u4f1a\u53bb\u6389\u524d\u4e24\u79cd\u60c5\u51b5,\u7b2c\u56db\u79cd\u60c5\u51b5\u4e0d\u9700\u8981\u679a\u4e3e\u989c\u8272,\u6240\u4ee5\u4e00\u822c\u662f\u8dd1\u4e0d\u5230\u4e0a\u9650\u7684,\u6700\u540e\u8dd1\u4e86$77\\mathrm{ms}$.\n\n## Code\n\n```cpp\n#include <algorithm>\n#include <cstdio>\n#include <cstring>\n#include <set>\nusing namespace std;\n\nint n,f[505],p[505],q[505]; set<int> s[505];\nstruct bxt {\n\tint l,r,c; inline bxt() {}\n\tinline bxt(int _l,int _r,int _c):\n\t\tl(_l),r(_r),c(_c) {}\n\tinline bool operator <(const bxt &op) {\n\t\treturn r==op.r?l<op.l:r<op.r;\n\t}\n} b[505];\nstruct txb {\n\tint x[505];\n\tinline void clear() {\n\t\tmemset(x,0x00,sizeof(int)*(n+1));\n\t}\n\tinline int lowbit(int u) {return u&(-u);}\n\tinline void modify(int u,int v) {\n\t\tfor (;u<=n;u+=lowbit(u)) x[u]+=v;\n\t}\n\tinline int query(int u) {\n\t\tint v=0;\n\t\tfor (;u;u-=lowbit(u)) v+=x[u];\n\t\treturn v;\n\t}\n\tinline int query(int u,int v) {\n\t\treturn query(v)-query(u-1);\n\t}\n} g[205];\n\nint main() {\n\tint t,w; scanf(\"%d\",&t);\n\twhile (t--) {\n\t\tscanf(\"%d\",&n); w=0;\n\t\tmemset(f,0x00,sizeof(int)*(n+1));\n\t\tmemset(p,0x00,sizeof(int)*(n+1));\n\t\tfor (int i=0;i<201;++i) g[i].clear();\n\t\tfor (int i=1;i<=n;++i) {\n\t\t\ts[i].clear();\n\t\t\tscanf(\"%d%d%d\",&b[i].l,&b[i].r,&b[i].c);\n\t\t}\n\t\tsort(b+1,b+n+1);\n\t\tfor (int i=1;i<=n;++i) for (int j=1;j<=i;++j)\n\t\t\tif (b[i].l<=b[j].r) {\n\t\t\t\tif (!p[i]) p[i]=j;\n\t\t\t\ts[i].insert(b[j].c); s[j].insert(b[i].c);\n\t\t\t}\n\t\tq[n]=p[n]; for (int i=n-1;i;--i) q[i]=min(p[i],q[i+1]);\n\t\tfor (int i=1;i<=n;++i) p[i]=q[p[i]];\n\t\tfor (int i=1;i<=n;++i) {\n\t\t\tf[i]=f[i-1];\n\t\t\tif (s[i].count(0)) {\n\t\t\t\ts[i].erase(0);\n\t\t\t\tif (s[i].empty()) {\n\t\t\t\t\tg[0].modify(p[i],1);\n\t\t\t\t\tfor (int j=1;j<201;++j) for (int k=1;k<=p[i];++k)\n\t\t\t\t\t\tf[i]=max(f[i],f[k-1]+g[0].query(k,i)+g[j].query(k,i));\n\t\t\t\t}\n\t\t\t\telse if (s[i].size()==1) {\n\t\t\t\t\tg[*s[i].begin()].modify(p[i],1);\n\t\t\t\t\tfor (int j=*s[i].begin(),k=1;k<=p[i];++k)\n\t\t\t\t\t\tf[i]=max(f[i],f[k-1]+g[0].query(k,i)+g[j].query(k,i));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (s[i].size()==1) ++w;\n\t\t}\n\t\tprintf(\"%d\\n\",w+f[n]);\n\t}\n\treturn 0;\n}\n```\n\n## Reference\n\n- [dafeng](https://codeforces.ml/profile/dafeng)\u7684\u9898\u89e3,\u5728<https://codeforces.ml/blog/entry/70915>\u8bc4\u8bba\u533a.\n- Google\u7ffb\u8bd1(\u7b11.",
        "postTime": 1602674601,
        "uid": 54189,
        "name": "konjacq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1250D \u3010Conference Problem\u3011"
    }
]