[
    {
        "content": "\u4ee5\u4e0b\u7b80\u79f0 `leftmost-maximum` \u4e3a $\\text{lmax}$\u3002\n\n\u8003\u8651\u628a $a_i$ \u5728\u54ea\u4e9b\u533a\u95f4\u91cc\u6210\u4e3a $\\text{lmax}$ \u5206\u522b\u62ce\u51fa\u6765\u3002\n\n\u5bf9\u4e8e $a_i$ \u4ece\u5927\u5230\u5c0f\uff0c\u4ece\u5de6\u81f3\u53f3\u5730\u770b\uff0c \u53d1\u73b0\u6700\u5927\uff0c\u6700\u5de6\u7684\u6570\u4e00\u5b9a\u662f\u6240\u6709\u5305\u542b\u5b83\u7684\u533a\u95f4\u7684 $\\text{lmax}$\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u82e5\u4e00\u4e2a\u533a\u95f4\u7684 $\\text{lmax}$ \u662f $a_k$\uff0c\u90a3\u4e48\u5728\u6b64\u533a\u95f4\u5185\u5305\u542b $a_k$ \u7684\u5b50\u533a\u95f4\u7684 $\\text{lmax}$ \u90fd\u662f\u5b83\u3002\u4e8e\u662f\u628a\u6574\u4e2a\u5e8f\u5217\u5206\u6210\u4e24\u4e2a\u72ec\u7acb\u5b50\u533a\u95f4\uff08\u53ef\u80fd\u4e3a\u7a7a\uff09\uff0c\u53ef\u4ee5\u5206\u6cbb\u4e0b\u53bb\u7136\u540e\u518d\u5408\u5e76\u4fe1\u606f\u3002\n\n\u56e0\u6b64\u8003\u8651 $\\text{dp}$\u3002\n\n\u8bbe\u5728\u67d0\u4e2a\u533a\u95f4 $[L,R]$ \u5185\u7684 $\\text{lmax}$ \u4e3a $k$\uff0c\u90a3\u4e48\u8bb0 $\\text{dp}_{k,j}$ \u8868\u793a\u5f53 $b_k\\le j$ \u65f6 $b_L\\dots b_R$ \u7684\u65b9\u6848\u6570\u3002\n\n\u53c8\u8bb0 $[L,k-1]$ \u7684 $\\text{lmax}$ \u4e3a $k_L$\uff0c$[k+1,R]$ \u7684 $\\text{lmax}$ \u4e3a $k_R$\uff0c\n\n\u90a3\u4e48\u6839\u636e $\\text{lmax}$ \u7684\u6027\u8d28\uff0c$b_{k_L}<j$\uff0c$b_{k_R}\\le j$\uff0c\u56e0\u6b64\uff1a\n\n$$\\text{dp}_{k,j}=\\text{dp}_{k.j-1}+\\text{dp}_{k_L,j-1}\\times\\text{dp}_{k_R,j}$$\n\n\u6ce8\u610f\u7279\u5224\u5b50\u533a\u95f4\u4e3a\u7a7a\u7684\u60c5\u51b5\u3002\n\n\u81f3\u4e8e\u5982\u4f55\u8ba1\u7b97\u4e00\u4e2a\u533a\u95f4\u5185\u7684 $\\text{lmax}$\uff0c\u7528 $\\text{ST}$ \u8868\u6216\u7ebf\u6bb5\u6811\u7b49\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n +nm)$\uff0c\n```cpp\n#include<bits/stdc++.h>\n#define mod 998244353\n#define MOD 1000000007\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\n#define N 500005\n#define ls p<<1\n#define rs p<<1|1\ntypedef long long ll;\nusing namespace std;\nint a[N];\nvector<ll> dp[200005];\nint n,m;\nint ind[8000005];\ninline void pushup(int p){\n    if(a[ind[ls]]<a[ind[rs]]) ind[p]=ind[rs];\n    else ind[p]=ind[ls];\n}\nvoid build(int p,int l,int r){\n    if(l==r){\n        ind[p]=l;\n        return;\n    }\n    int mid=l+r>>1;\n    build(ls,l,mid);\n    build(rs,mid+1,r);\n    pushup(p);\n}\nint query(int p,int l,int r,int ql,int qr){\n    if(ql<=l&&r<=qr) return ind[p];\n    int mid=l+r>>1,res=0;\n    if(ql>mid) return query(rs,mid+1,r,ql,qr);\n    else if(qr<=mid) return query(ls,l,mid,ql,qr);\n    res=query(ls,l,mid,ql,qr);\n    int k=query(rs,mid+1,r,ql,qr);\n    if(a[res]<a[k]) return k;\n    else return res;\n}\nint dfs(int l,int r){ \n    if(l>r) return -1;\n    if(l==r){\n        for(int i=1;i<=m;i++) dp[l][i]=i;\n        return l;\n    }\n    int id=query(1,1,n,l,r);\n    int L=dfs(l,id-1);\n    int R=dfs(id+1,r);\n    if(L==-1){\n        for(int i=1;i<=m;i++) dp[id][i]=dp[R][i]+dp[id][i-1],dp[id][i]%=MOD;\n    }\n    else if(R==-1){\n        for(int i=1;i<=m;i++) dp[id][i]=dp[L][i-1]+dp[id][i-1],dp[id][i]%=MOD;\n    }\n    else{\n        for(int i=1;i<=m;i++) dp[id][i]=dp[L][i-1]*dp[R][i]%MOD+dp[id][i-1],dp[id][i]%=MOD;\n    }\n    return id;\n}\nvoid solve(){\n    cin>>n>>m;\n    for(int i=1;i<=n;i++) cin>>a[i],dp[i].clear(),dp[i].resize(m+1);\n    build(1,1,n);\n    int x=dfs(1,n);\n    cout<<dp[x][m]<<'\\n';\n}\nint main(){\n//    std::ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n    int Case;cin>>Case;while(Case--)\n    solve();\n}\n```",
        "postTime": 1668385275,
        "uid": 258085,
        "name": "\u6c5f\u6237\u5ddd\u00b7\u841d\u535c",
        "ccfLevel": 7,
        "title": "CF1748E \u9898\u89e3"
    },
    {
        "content": "\u5148\u8003\u8651 $1\\sim n$ \u4e2d\u6700\u5927\u503c\u6700\u5de6\u7684\u4f4d\u7f6e $pos$\uff0c\u53ea\u8981\u5305\u542b\u5b83\u7684\u533a\u95f4\uff0c\u90a3\u6240\u6709\u9898\u76ee\u8981\u6c42\u7684\u503c\u662f\u4e00\u6837\u7684\u3002\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5bf9\u4e8e\u4e00\u6bb5\u533a\u95f4\u6700\u5927\u503c\u6700\u5de6\u7684\u4f4d\u7f6e\u8fdb\u884c\u5206\u6cbb\u3002\n\n\u8003\u8651\u7b54\u6848\u600e\u4e48\u5904\u7406\u3002\n\n\u9996\u5148\u53d1\u73b0 $\\sum n\\times m\\le10^6$\uff0c\u8bf4\u660e\u53ef\u4ee5\u5b58\u6bcf\u4e2a\u4f4d\u7f6e\u586b\u4e86\u54ea\u4e9b\u6570\u3002\n\n\u8bbe $dp_{i,j}$ \u8868\u793a\u5728\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u586b\u4e86 $j$ \u5e76\u4e14\u5408\u6cd5\u7684\u65b9\u6848\u6570\u3002\n\n\u89c2\u5bdf\u8fd9\u4e2a\u4f4d\u7f6e $pos$\uff0c\u6709 $\\forall l\\le i < pos\\ a_i<a_{pos},\\forall pos < i \\le r\\ a_i\\le a_{pos}$\u3002\n\n\u6240\u4ee5\u8f6c\u79fb\u5c31\u6709 $dp_{i,j}=\\sum\\limits_{a=1}^{j-1}\\sum\\limits_{b=1}^j dp_{ls,a} \\times dp_{rs, b}$\uff0c\u53d1\u73b0\u5f0f\u5b50\u91cc\u7684\u53ef\u4ee5\u524d\u7f00\u548c\u4f18\u5316\u505a\u5230 $\\Theta(1)$\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u627e\u533a\u95f4\u7684\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u7528 ST \u8868\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6\u662f $\\Theta(\\sum n\\times m+n\\log n)$\u3002\n\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define IOS ios::sync_with_stdio(0),cin.tie(0),cout.tie(0)\n#define pii pair<int, int>\n#define fi first\n#define se second\n#define pb push_back\nusing namespace std;\n\nconst int mod = 1e9 + 7;\n\nint a[200010];\nint st[18][200001], pos[18][200001];\nint Log[200010], len[18];\n\nvoid init()\n{\n    for (int i = 2;i <= 200000;i++)\n    Log[i] = Log[i >> 1] + 1;\n    len[0] = 1;\n    for (int i = 1;i <= 17;i++)\n    {\n        len[i] = len[i - 1] * 2;\n    }\n}\n\nint qry(int l, int r)\n{\n    int low = Log[r - l + 1];\n    r = r - len[low] + 1;\n    if (st[low][l] >= st[low][r])\n    return pos[low][l];\n    return pos[low][r];\n}\n\nvoid solve()\n{\n    int n, m;\n    cin >> n >> m;\n    vector< vector<int> > dp(n + 1, vector<int>(m + 1, 0));\n    for (int i = 1;i <= n;i++)\n    {\n        cin >> a[i];\n    }\n    for (int i = 1;i <= Log[n];i++)\n    {\n        for (int j = 1;j <= n;j++)\n        {\n            st[i][j] = pos[i][j] = 0;\n        }\n    }\n    for (int i = 1;i <= n;i++)\n    {\n        st[0][i] = a[i];\n        pos[0][i] = i;\n    }\n    for (int j = 1;j <= 17;j++)\n    {\n        for (int i = 1;i <= n - len[j] + 1;i++)\n        {\n            if (st[j - 1][i] >= st[j - 1][i + len[j - 1]])\n            {\n                st[j][i] = st[j - 1][i];\n                pos[j][i] = pos[j - 1][i];\n            }\n            else\n            if (st[j - 1][i] < st[j - 1][i + len[j - 1]])\n            {\n                st[j][i] = st[j - 1][i + len[j - 1]];\n                pos[j][i] = pos[j - 1][i + len[j - 1]];\n            }\n        }\n    }\n\n    auto dfs = [&](auto &self, int l, int r) -> int\n    {\n        if (l > r)\n        {\n            return 0;\n        }\n        if (l == r)\n        {\n            for (int i = 1;i <= m;i++)\n            {\n                dp[l][i] = i;\n            }\n            return l;\n        }\n        int _ = qry(l, r);\n        int ls = self(self, l, _ - 1), rs = self(self, _ + 1, r);\n\n        for (int i = 1;i <= m;i++)\n        {\n            if (ls && rs)\n            dp[_][i] = dp[ls][i - 1] * dp[rs][i] % mod + dp[_][i];\n            if (ls && rs == 0)\n            dp[_][i] = dp[ls][i - 1] + dp[_][i];\n            if (ls == 0 && rs)\n            dp[_][i] = dp[rs][i] + dp[_][i];\n            dp[_][i] %= mod;\n        }\n\n        for (int i = 1;i <= m;i++)\n        {\n            dp[_][i] = (dp[_][i] + dp[_][i - 1]) % mod;\n        }\n\n        return _;\n    };\n\n    cout << dp[dfs(dfs, 1, n)][m] << '\\n';\n\n    dp.shrink_to_fit();\n\n    return;\n}\n\nsigned main()\n{\n    IOS;\n    int t = 1;\n    cin >> t;\n    init();\n    while (t--)\n    {\n        solve();\n    }\n}\n```",
        "postTime": 1675999653,
        "uid": 173424,
        "name": "Hovery",
        "ccfLevel": 6,
        "title": "CF1748E"
    },
    {
        "content": "[\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/jiangtaizhe001/p/16886525.html)\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/1748/problem/E)\n\n### \u9898\u76ee\u5927\u610f\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$ \u548c $m$\uff0c\u5b9a\u4e49 $[l,r]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ \u4e3a \u6700\u5c0f\u7684 $l\\le i\\le r$ \u6ee1\u8db3 $x_i=\\max\\{a_l,a_{l+1},\\dots,a_r\\}$  \n\u6c42\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $b$ \u7684\u6570\u91cf\n\n- \u5bf9\u4e8e\u6240\u6709\u7684 $1\\le i\\le n$\uff0c\u6709 $1\\le b_i\\le m$\n- \u5bf9\u4e8e\u6240\u6709\u7684 $1\\le l\\le r\\le n$\uff0c\u6ee1\u8db3\u5e8f\u5217 $a$ \u7684\u533a\u95f4 $[l,r]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ \u7b49\u4e8e\u5e8f\u5217 $b$ \u7684\u533a\u95f4 $[l,r]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_\n\n\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21  \n$2\\le n,m\\le 10^5$\uff0c$1\\le a_i\\le m$\uff0c$n\\cdot m\\le 10^6$\uff0c$\\sum n\\cdot m\\le 10^6$  \n### \u9898\u76ee\u89e3\u6790\n> \u8bb2\u4e2a\u7b11\u8bdd\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53eb\u7b1b\u5361\u5c14\u6811\uff0c\u5728HHHOJ\u6a21\u62df\u8d5b\u8003\u4e86\u4e0d\u4e0b\u4e94\u6b21   \n\u2014\u2014@[275307894a](https://www.luogu.com.cn/user/181766)\n\n\u539f\u6765\u5c0f\u4e11\u7adf\u662f\u6211\u81ea\u5df1\u3002\uff08HHHOJ \u4e3a\u67d0\u4e2d\u5b66\u5185\u90e8 OJ\uff09\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u5e8f\u5217 $a$ \u7684\u4efb\u610f\u4e00\u4e2a\u533a\u95f4 $[L,R]$\uff0c\u5982\u679c $[L,R]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ \u4e3a $t$\uff0c\u90a3\u4e48\u4e0d\u96be\u53d1\u73b0\uff1a\n\n- \u5bf9\u4e8e $L\\le l\\le t\\le r\\le R$\uff0c$[l,r]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ \u4e3a $t$\n- \u5bf9\u4e8e $L\\le l\\le r< t$\uff0c$[l,r]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ $p$ \u6ee1\u8db3 $a_p<a_t$\n- \u5bf9\u4e8e $L\\le l\\le r< t$\uff0c$[l,r]$ \u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ $q$ \u6ee1\u8db3 $a_q\\le a_t$  \n\n\u6839\u636e\u4ee5\u4e0a\u6027\u8d28\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u5bf9\u4e8e\u5927\u5c0f\u7684\u9650\u5236\u5c31\u9012\u5f52\u5230\u4e86\u4e24\u4e2a\u5b50\u533a\u95f4\u5185\u3002  \n\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e9b\u6570\u636e\u7ed3\u6784\uff08\u6211\u5199\u4e86\u4e2a\u7ebf\u6bb5\u6811\uff09\u6765\u5feb\u901f\u67e5\u627e\u4efb\u610f\u5b50\u533a\u95f4\u7684 _\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c_ \uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u6240\u6709\u5173\u4e8e\u5927\u5c0f\u7684\u7ea6\u675f\u5efa\u7acb\u8d77\u6765\u3002  \n\u4e0d\u96be\u53d1\u73b0\u6700\u540e\u6240\u6709\u7684\u5927\u5c0f\u7ea6\u675f\u5173\u7cfb\u4f1a\u53d8\u6210\u4e00\u68f5\u4e8c\u53c9\u6811\uff0c\u7136\u540e\u5728\u4e0a\u9762\u8dd1 DP \u5c31\u53ef\u4ee5\u4e86\u3002\u8bbe $f_{i,j}$ \u4e3a\u8282\u70b9 $i$ \u4e3a $j$ \u7684\u65f6\u5019\u8fd9\u68f5\u5b50\u6811\u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u76f4\u63a5 DP \u8f6c\u79fb\u5373\u53ef\u3002$f_{i,j}$ \u8ba1\u7b97\u5b8c\u4e4b\u540e\uff0c\u9700\u8981\u8ba1\u7b97 $j$ \u4e00\u7ef4\u524d\u7f00\u548c\u65b9\u4fbf\u63a5\u4e0b\u6765\u7684\u8f6c\u79fb\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nm+n\\log n)$\n```cpp\n#include<cstdio>\n#define db double\n#define gc getchar\n#define pc putchar\n#define U unsigned\n#define ll long long\n#define ld long double\n#define ull unsigned long long\n#define Tp template<typename _T>\n#define Me(a,b) memset(a,b,sizeof(a))\nTp _T mabs(_T a){ return a>0?a:-a; }\nTp _T mmax(_T a,_T b){ return a>b?a:b; }\nTp _T mmin(_T a,_T b){ return a<b?a:b; }\nTp void mswap(_T &a,_T &b){ _T tmp=a; a=b; b=tmp; return; }\nTp void print(_T x){ if(x<0) pc('-'),x=-x; if(x>9) print(x/10); pc((x%10)+48); return; }\n#define EPS (1e-7)\n#define INF (0x7fffffff)\n#define LL_INF (0x7fffffffffffffff)\n#define maxn 200039\n#define maxm 1000039\n#define MOD 1000000007\n#define Type int\n#ifndef ONLINE_JUDGE\n//#define debug\n#endif\nusing namespace std;\nType read(){\n\tchar c=gc(); Type s=0; int flag=0;\n\twhile((c<'0'||c>'9')&&c!='-') c=gc(); if(c=='-') c=gc(),flag=1;\n\twhile('0'<=c&&c<='9'){ s=(s<<1)+(s<<3)+(c^48); c=gc(); }\n\tif(flag) return -s; return s;\n}\nclass SGT{//Segment Tree\n\tprivate:\n\t\tstruct JTZ{ int maxx,pos; }sum[maxn<<2];\n\t\tJTZ merge(JTZ x,JTZ y){\n\t\t\tif(x.maxx!=y.maxx) return x.maxx>y.maxx?x:y;\n\t\t\telse return x.pos<y.pos?x:y;\n\t\t}\n\t\tint *arr,siz,L,R;\n\t\tvoid up(int rt){ sum[rt]=merge(sum[rt<<1],sum[rt<<1|1]); return; }\n\t\tvoid build(int l,int r,int rt){\n\t\t\tif(l==r){ sum[rt].maxx=arr[l]; sum[rt].pos=l; return; } int mid=(l+r)>>1;\n\t\t\tbuild(l,mid,rt<<1); build(mid+1,r,rt<<1|1); up(rt); return;\n\t\t}\n\t\tJTZ querymax(int l,int r,int rt){\n\t\t\tif(L<=l&&r<=R) return sum[rt]; int mid=(l+r)>>1; JTZ tmp;\n\t\t\tif(mid>=L){\n\t\t\t\ttmp=querymax(l,mid,rt<<1);\n\t\t\t\tif(mid<R) tmp=merge(tmp,querymax(mid+1,r,rt<<1|1));\n\t\t\t} else if(mid<R) tmp=querymax(mid+1,r,rt<<1|1); return tmp;\n\t\t}\n\tpublic:\n\t\tvoid init(int _siz,int *_arr){ siz=_siz; arr=_arr; build(1,siz,1); return; }\n\t\tint query(int l,int r){ L=l,R=r; return querymax(1,siz,1).pos; }\n}tr;\nstruct Node{ int ls,rs; }bt[maxn]; int siz;//Binary Tree\nint build(int l,int r){\n\tif(l>r) return 0; int mid=tr.query(l,r),tmp=++siz;\n\tbt[tmp].ls=build(l,mid-1); bt[tmp].rs=build(mid+1,r); return tmp;\n}\nint n,m,a[maxn]; ll f[maxm];\n#define get(i,j) (((i)-1)*m+(j))\nvoid dfs(int x){\n\tint i;\n\tif(!bt[x].ls&&!bt[x].rs) for(i=1;i<=m;i++) f[get(x,i)]=i%MOD;\n\telse if(!bt[x].ls&&bt[x].rs){\n\t\tdfs(bt[x].rs);\n\t\tfor(i=1;i<=m;i++) f[get(x,i)]=f[get(bt[x].rs,i)];\n\t\tfor(i=2;i<=m;i++) f[get(x,i)]+=f[get(x,i-1)],f[get(x,i)]%=MOD;\n\t} else if(bt[x].ls&&!bt[x].rs){\n\t\tdfs(bt[x].ls); f[get(x,1)]=0;\n\t\tfor(i=2;i<=m;i++) f[get(x,i)]=f[get(bt[x].ls,i-1)];\n\t\tfor(i=2;i<=m;i++) f[get(x,i)]+=f[get(x,i-1)],f[get(x,i)]%=MOD;\n\t} else{\n\t\tdfs(bt[x].ls); dfs(bt[x].rs); f[get(x,1)]=0;\n\t\tfor(i=2;i<=m;i++) f[get(x,i)]=f[get(bt[x].ls,i-1)]*f[get(bt[x].rs,i)]%MOD;\n\t\tfor(i=2;i<=m;i++) f[get(x,i)]+=f[get(x,i-1)],f[get(x,i)]%=MOD;\n\t} return;\n}\nvoid work(){\n\tn=read(); m=read(); int i; for(i=1;i<=n;i++) a[i]=read();\n\ttr.init(n,a); siz=0; build(1,n); for(i=1;i<=n*m;i++) f[i]=0;\n\tdfs(1); print(f[m]),pc('\\n'); return;\n}\nint main(){\n#ifdef LOCAL\n\tfreopen(\"1.in\",\"r\",stdin);\n#endif\n\tint T=read(); while(T--) work(); return 0;\n}\n```",
        "postTime": 1668334558,
        "uid": 215042,
        "name": "jiangtaizhe001",
        "ccfLevel": 7,
        "title": "CF1748E Yet Another Array Counting Problem \u9898\u89e3"
    },
    {
        "content": "\u7b80\u5355\u7b1b\u5361\u5c14\u6811\u4e0a dp\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u7b1b\u5361\u5c14\u6811\u3002\n\n\u6839\u636e\u5927\u6839\u5806\u6027\u8d28\u5efa\u51fa\u7b1b\u5361\u5c14\u6811\uff0c\u90a3\u4e48 $[l,r]$ \u7684\u201c\u6700\u5de6\u7aef\u6700\u5927\u503c\u4f4d\u7f6e\u201d\u5c31\u662f $l$ \u548c $r$ \u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u7684 $\\textrm{lca}$\u3002\n\n\u82e5\u4e24\u4e2a\u5e8f\u5217\u7684\u6240\u6709\u201c\u6700\u5de6\u7aef\u6700\u5927\u503c\u201d\u90fd\u76f8\u7b49\uff0c\u90a3\u4e48\u610f\u5473\u7740\u8fd9\u4e24\u4e2a\u5e8f\u5217\u6240\u5efa\u51fa\u7684\u7b1b\u5361\u5c14\u6811\u5f62\u6001\u76f8\u540c\u3002\u8f6c\u6362\u4e3a\u6743\u503c $\\le m$ \u7684\u7b1b\u5361\u5c14\u6811\u8ba1\u6570\u95ee\u9898\u3002\n\n\u4e0d\u59a8\u8bbe $f_{u,j}$ \u8868\u793a\u7b1b\u5361\u5c14\u6811\u4e0a\u70b9 $u$ \u6743\u503c\u4e3a $j$\uff0c\u5176\u5b50\u6811\u7684\u7b54\u6848\u3002\u5219\u6709\n\n$$f_{u,j}=\\sum_{k=1}^{j-1}f_{lc_u,k}\\times \\sum_{k=1}^{j}f_{rc_u,k}$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(\\sum n\\times m)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n\nusing namespace std;\n\nconst int maxn = 1e6 + 10;\nconst int mod = 1e9 + 7;\n\nint n, m, t;\nint p[maxn];\nint s[maxn], cnt;\nint lc[maxn], rc[maxn];\nvector<vector<int>> f;\n\nvoid dfs(int u) {\n    for (int i = 1; i <= m; i++) f[u][i] = 1;\n    if (lc[u]) dfs(lc[u]);\n    if (rc[u]) dfs(rc[u]);\n    if (lc[u]) for (int i = 1; i <= m; i++) f[u][i] = f[u][i] * f[lc[u]][i - 1] % mod;\n    if (rc[u]) for (int i = 1; i <= m; i++) f[u][i] = f[u][i] * f[rc[u]][i] % mod;\n    for (int i = 2; i <= m; i++) f[u][i] = (f[u][i] + f[u][i - 1]) % mod;\n}\n\nsigned main() {\n    cin >> t;\n    while (t--) {\n        cin >> n >> m;\n        for (int i = 1; i <= n; i++) cin >> p[i];\n        for (int i = 1; i <= n; i++) {\n            int top = cnt;\n            while (top && p[s[top]] < p[i]) --top;\n            if (top) rc[s[top]] = i;\n            if (top < cnt) lc[i] = s[top + 1];\n            s[cnt = ++top] = i;\n        }\n        f.resize(n + 1);\n        for (int i = 1; i <= n; i++) f[i].resize(m + 1);\n        dfs(s[1]);\n        cout << f[s[1]][m] << endl;\n        for (int i = 1; i <= cnt; i++) s[i] = 0;\n        for (int i = 1; i <= n; i++) lc[i] = rc[i] = 0;\n        cnt = 0;\n    }\n    \n    return 0;\n}\n\n```",
        "postTime": 1683968939,
        "uid": 362750,
        "name": "TernaryTree",
        "ccfLevel": 0,
        "title": "CF1748E Yet Another Array Counting Problem"
    },
    {
        "content": "\u6211\u4eec\u5148\u6c42\u51fa\u5168\u5c40\u6700\u5927\u6700\u5de6\uff0c\u5c31\u77e5\u9053\u4e86\u6240\u6709\u5de6\u7aef\u70b9\u5c0f\u4e8e\u7b49\u4e8e\u5b83\u4e14\u53f3\u7aef\u70b9\u5927\u4e8e\u7b49\u4e8e\u5b83\u7684\u5b50\u533a\u95f4\u7684\u6700\u5927\u6700\u5de6\uff0c\u7136\u540e\u5e8f\u5217\u5c31\u53ef\u4ee5\u88ab\u5206\u6210\u4e24\u90e8\u5206\uff0c\u5206\u522b\u518d\u8fdb\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u4e00\u76f4\u9012\u5f52\u4e0b\u53bb\u5c31\u53ef\u4ee5\u6c42\u51fa\u6240\u6709\u5b50\u533a\u95f4\u7684\u6700\u5927\u6700\u5de6\u3002\n\n\u73b0\u5728 $b$ \u7684\u6240\u6709\u5b50\u533a\u95f4\u7684\u6700\u5927\u6700\u5de6\u4e0e $a$ \u7684\u4e00\u6837\uff0c\u5c31\u4e00\u5b9a\u6709 $b$ \u6bcf\u4e00\u6b21\u62c6\u5206\u5e8f\u5217\u7684\u4f4d\u7f6e\u4e0e $a$ \u4e00\u81f4\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e2a\u62c6\u5206\u8fc7\u7a0b\u76f8\u5f53\u4e8e\u5728\u904d\u5386 $a$ \u7684[\u7b1b\u5361\u5c14\u6811](https://oi-wiki.org/ds/cartesian-tree/)\uff0c\u5e76\u4e14\u662f\u4e00\u68f5\u5927\u6839\u7b1b\u5361\u5c14\u6811\uff08\u82e5\u6743\u503c\u76f8\u7b49\u5c06\u4f4d\u7f6e\u9760\u5de6\u7684\u89c6\u4e3a\u66f4\u5927\uff09\u3002\u8fd9\u68f5\u7b1b\u5361\u5c14\u6811\u7684\u5f62\u72b6\u4e0e $a$ \u7684\u62c6\u5206\u65b9\u6848\u552f\u4e00\u5bf9\u5e94\uff0c\u6240\u4ee5\u5b83\u7684\u5f62\u72b6\u4e00\u5b9a\u4e0e $b$ \u7684\u7b1b\u5361\u5c14\u6811\u7684\u5f62\u72b6\u76f8\u540c\u3002\n\n\u90a3\u4e48\u95ee\u9898\u53d8\u6210\u6c42\u51fa $a$ \u7684\u7b1b\u5361\u5c14\u6811\uff0c\u7136\u540e\u95ee\u6709\u591a\u5c11\u79cd\u5728\u6811\u4e0a\u586b\u6570\u7684\u65b9\u6848\u4f7f\u5f97\u91cd\u65b0\u586b\u6570\u7684\u6811\u4f9d\u7136\u662f\u4e00\u68f5\u7b26\u5408\u6211\u4eec\u8981\u6c42\u7684\u7b1b\u5361\u5c14\u6811\u3002\n\n\u770b\u773c\u6570\u636e\u8303\u56f4 $n\\cdot m\\le 10^6$\uff0c\u76f4\u63a5 $O(nm)$ \u7684\u6811\u5f62 dp \u5373\u53ef\u3002$f(i,j)$ \u8868\u793a\u9650\u5236 $i$ \u53f7\u8282\u70b9\u4e0a\u53ea\u80fd\u586b\u5c0f\u4e8e\u7b49\u4e8e $j$ \u7684\u6570\u65f6\uff0c\u6574\u68f5\u5b50\u6811\u7684\u586b\u6570\u65b9\u6848\u3002\n\n\u663e\u7136\u6709 $f(i,j)=f(i,j-1)+f(ls,j-1)\\cdot f(rs,j)$\uff0c\u82e5 $i$ \u4e3a\u7a7a\u5219\u8fd4\u56de $1$\uff0c\u82e5 $j<1$ \u5219\u8fd4\u56de $0$\u3002\n\n##### \u4ee3\u7801\n```cpp\n#include<iostream>\n#include<map>\nusing namespace std;\n#define int long long\nconst int N=200100,P=1000000007;\nint n,m,a[N];\nint stk[N],top;\nint ls[N],rs[N];\nmap<pair<int,int>,int>f;\nvoid init(){\n    cin>>n>>m;\n    for(int i=1;i<=n;i++)cin>>a[i];\n    for(int i=1;i<=n;i++)ls[i]=rs[i]=stk[i]=0;\n    top=0;\n    f.clear();\n    for(int i=1;i<=n;i++){\n        while(top&&a[stk[top]]<a[i])ls[i]=stk[top--];\n        if(top)rs[stk[top]]=i;\n        stk[++top]=i;\n    }\n}\nint dp(int nd,int k){\n    if(f.count(make_pair(nd,k)))return f[make_pair(nd,k)];\n    if(!nd)return 1;\n    if(k<1)return 0;\n    return f[make_pair(nd,k)]=(dp(nd,k-1)+dp(ls[nd],k-1)*dp(rs[nd],k)%P)%P;\n}\nsigned main(){\n    // freopen(\"read.in\",\"r\",stdin);\n    int t;cin>>t;\n    while(t--){\n        init();\n        cout<<dp(stk[1],m)<<endl;\n    }\n    return 0;\n}\n```",
        "postTime": 1672977196,
        "uid": 455558,
        "name": "yuanjiabao",
        "ccfLevel": 0,
        "title": "CF1748E Yet Another Array Counting Problem \u9898\u89e3"
    },
    {
        "content": "### \u6027\u8d28\uff1a\r\n\r\n\u8003\u8651\u8fd9\u4e00\u53e5\u8bdd\u3002\r\n\r\n\u5bf9\u4efb\u610f\u6574\u6570 $l,r(1\\leq l\\leq r\\leq n)$\uff0c\u603b\u6709 $a,b$ \u5728\u5b50\u6bb5 $[l;r]$ \u7684\u201c\u6700\u5de6\u7aef\u6700\u5927\u503c\u4f4d\u7f6e\u201d\u76f8\u540c\u3002\r\n\r\n\u5bb9\u6613\u60f3\u5230\u5f53 $a_i=b_i$ \u7684\u65f6\u5019\u4e00\u5b9a\u6210\u7acb\uff0c\u6216\u8005\u8bf4\u5f53 $a_i$ \u4e92\u4e0d\u76f8\u540c\u65f6 $b$ \u79bb\u6563\u5316\u540e\u548c $a$ \u4e00\u6837\u65f6\u4e00\u5b9a\u6210\u7acb\uff08\u6bd4\u5982 $(1,2,3,4)$ \u548c $(2,3,4,5)$\uff09\u3002\r\n\r\n\u4f46\u662f\u5982\u679c $a$ \u4e2d\u6709\u91cd\u590d\u51fa\u73b0\u7684\u503c\u5462\uff1f\u9898\u76ee\u8981\u6c42\u201c\u6700\u5de6\u7aef\u6700\u5927\u503c\u4f4d\u7f6e\u201d\u76f8\u540c\u3002\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e2a\u503c\u770b\u4f5c\u4e00\u4e2a $(a_i,i)$ \u7684\u4e8c\u5143\u7ec4\uff0c$a_i$ \u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$i$ \u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u3002\u6211\u4eec\u53d1\u73b0 $b$ \u6ee1\u8db3\u6761\u4ef6\u5f53\u4e14\u4ec5\u5f53 $a,b$ \u6309\u7167\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u7684\u6bd4\u8f83\u5927\u5c0f\u65b9\u5f0f\u79bb\u6563\u5316\u540e\u76f8\u540c\u3002\r\n\r\n\u6709\u4e9b\u62bd\u8c61\uff0c\u6bd4\u5982\uff1a$(1,3,2,2)$\uff0c\u5176\u5b9e\u5f53\u8fd9\u4e24\u4e2a $2$ \u540c\u65f6\u5b58\u5728\u4e8e\u4e00\u4e2a\u533a\u95f4\u7684\u65f6\u5019\uff0c\u53f3\u8fb9\u90a3\u4e2a\u4e8c\u6c38\u8fdc\u4e5f\u4e0d\u4f1a\u53d6\u5230\uff0c\u6211\u4eec\u5c31\u5f53\u4f5c\u524d\u9762\u7684 $2$ \u6bd4\u540e\u9762\u7684 $2$ \u5927\u5c31\u597d\u4e86\u3002\r\n\r\n\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9 $a$ \u79bb\u6563\u5316\uff0c\u53d8\u6210\u4e00\u4e2a $n$ \u7ea7\u6392\u5217\uff0c\u6bd4\u5982 $(1,3,2,2)$ \u53d8\u6210 $(1,4,3,2)$\u3002\r\n\r\n### \u6784\u9020\r\n\u4e00\u4e2a\u663e\u7136\u7684\u601d\u8def\u662f\uff1a\r\n\u627e\u51fa\u533a\u95f4 $[L,R]$ \u6700\u5927\u503c $a_p$\uff0c\u663e\u7136 $[L,p)$ \u6bcf\u4e2a\u5143\u7d20\u5fc5\u987b\u5c0f\u4e8e $b_p$\uff0c$(p,R]$ \u6bcf\u4e2a\u5143\u7d20\u5fc5\u987b\u5c0f\u4e8e\u7b49\u4e8e $b_p$\uff0c\u6211\u4eec\u4ee4 $b_p$ \u5411 \u5176\u4ed6\u7684\u4f4d\u7f6e\u8fde\u8fb9\uff0c\u8fd9\u6837\u5f97\u5230\u4e00\u4e2a\u6709\u5411\u65e0\u73af\u56fe\uff0c\u7136\u540e\u5404\u79cd\u52a8\u6001\u89c4\u5212\u3002\r\n\r\n\u663e\u7136\u8fd9\u4f1a\u70b8~~\u6240\u4ee5\u6211\u4eec\u7528\u6570\u636e\u7ed3\u6784\u4f18\u5316\u5efa\u56fe\u3002~~\r\n\r\n\u5176\u5b9e\u5f88\u591a\u8fb9\u662f\u4e0d\u5fc5\u8981\u7684\uff0c\u6211\u4eec\u76f4\u63a5\u628a $b_p$ \u5206\u522b\u5411 $[L,p),(p,R]$ \u6700\u5927\u503c\u8fde\u8fb9\u5c31\u591f\u4e86\uff0c\u7136\u540e\u53d1\u73b0\u8fd9\u73a9\u610f\u5176\u5b9e\u5c31\u662f\u4e00\u9897\u7b1b\u5361\u5c14\u6811\u3002\r\n\r\n\u6240\u4ee5\u6700\u540e\u7684\u89e3\u6cd5\u5c31\u662f\uff0c\u5efa\u7b1b\u5361\u5c14\u6811\u7136\u540e\u6811\u4e0a $dp$ \u5c31\u5b8c\u4e86\u3002\r\n\r\n\u4ee4 $f_{i,j}$ \u8868\u793a\u8282\u70b9 $i$ \u503c\u4e3a $j$ \u65f6\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u6709\u591a\u5c11\u79cd\u65b9\u6848\u3002\r\n\r\n\uff08\u6211\u4e3a\u4ec0\u4e48\u5199\u4e86\u4e2a ST \u8868\u6765\u6784\u9020\u7b1b\u5361\u5c14\u6811\uff1f\uff09\r\n\r\n```cpp\r\n#include<vector>\r\n#include<cstdio>\r\n#include<cstring>\r\n#include<iostream>\r\n#include<algorithm>\r\n#define cmin(a, b) (a)=min((a), (b))\r\n#define cmax(a, b) (a)=max((a), (b))\r\n#define mem(a, x) memset(a, x, sizeof(a))\r\n#define rps(i, b, e) for(int i=(b);i<=(e);i++)\r\n#define prs(i, e, b) for(int i=(e);i>=(b);i--)\r\n#define rpg(i, g, x) for(int i=g.head[x];i;i=g.e[i].nxt)\r\n#define opf(s) freopen(s\".in\", \"r\", stdin), freopen(s\".out\", \"w\", stdout)\r\nusing namespace std;\r\ntemplate<class T>\r\ninline void read(T &x) {\r\n\tx=0;\r\n\tbool f=false;\r\n\tchar c=getchar();\r\n\twhile(!isdigit(c))f|=(c=='-'), c=getchar();\r\n\twhile(isdigit(c))x=x*10+(c-'0'), c=getchar();\r\n\tif(f)x=-x;\r\n}\r\ntypedef long long LL;\r\nconst int NR=2e5+10, CF=20;\r\nconst LL MOD=1e9+7;\r\nLL T, n, m, a[NR], fmx[NR][CF+5], lg[NR];\r\nvector<LL>f[NR], ss[NR];\r\nLL lt[NR], rt[NR];\r\ninline LL gtmx(LL l, LL r) {\r\n    LL tp=lg[r-l+1];\r\n    LL x=fmx[l][tp], y=fmx[r-(1<<tp)+1][tp];\r\n    if(a[x]>=a[y])return x;\r\n    return y;\r\n}\r\nLL build(LL l, LL r) {\r\n    if(l>r)return 0;\r\n    LL p=gtmx(l, r);\r\n    lt[p]=build(l, p-1);\r\n    rt[p]=build(p+1, r);\r\n    return p;\r\n}\r\nvoid dp(LL x) {\r\n    if(lt[x]==0 && rt[x]==0) {\r\n        rps(i, 1, m)f[x][i]=1, ss[x][i]=i;\r\n        return;\r\n    }\r\n    if(lt[x]>0)dp(lt[x]);\r\n    if(rt[x]>0)dp(rt[x]);\r\n    if(lt[x]>0 && rt[x]>0)rps(i, 1, m)f[x][i]=ss[lt[x]][i-1]*ss[rt[x]][i]%MOD;\r\n    else if(lt[x]>0)rps(i, 1, m)f[x][i]=ss[lt[x]][i-1];\r\n    else rps(i, 1, m)f[x][i]=ss[rt[x]][i];\r\n    rps(i, 1, m)ss[x][i]=(ss[x][i-1]+f[x][i])%MOD;\r\n}\r\nvoid work() {\r\n    read(n), read(m);\r\n    rps(i, 1, n)read(a[i]), fmx[i][0]=i;\r\n    rps(j, 1, CF)rps(i, 1, n-(1<<j)+1) {\r\n        fmx[i][j]=fmx[i][j-1];\r\n        if(a[fmx[i+(1<<j-1)][j-1]]>a[fmx[i][j]])\r\n            fmx[i][j]=fmx[i+(1<<j-1)][j-1];\r\n    }\r\n    rps(i, 1, n)lt[i]=rt[i]=0;\r\n    LL rt=build(1, n);\r\n    // rps(i, 1, n)printf(\"%lld %lld ;;\\n\", lt[i], ::rt[i]);\r\n    rps(i, 1, n)f[i].assign(m+1, 0), ss[i].assign(m+1, 0);\r\n    dp(rt);\r\n    printf(\"%lld\\n\", ss[rt][m]);\r\n}\r\nint main() {\r\n    lg[1]=0;\r\n    rps(i, 2, NR-1)lg[i]=lg[i/2]+1;\r\n    read(T);\r\n    while(T--)work();\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1669091433,
        "uid": 389050,
        "name": "cszhpdx",
        "ccfLevel": 0,
        "title": "CF1748E Yet Another Array Counting Problem"
    },
    {
        "content": "# \u524d\u8a00\r\n\r\n\u4f4f\u6821\u751f\u5468\u516d\u56de\u5bb6\u96be\u5f97\u6253\u4e00\u573a CF\uff0c\u6ca1\u4ea4\u4ee3\u7801\uff0c\u770b\u5230 LG Aca \u7fa4\u91cc\u8bf4 E \u9898\u6c34\u5c31\u53bb\u770b\u4e86\u770b\uff0c\u81ea\u5df1\u624b\u63a8\u4e86\u4e00\u4f1a\u513f\uff0c\u53d1\u73b0\u5206\u6cbb\u5c31\u80fd\u89e3\u51b3\u2026\uff08\u849f\u84bb\u521a\u5b66 OI\uff0c\u968f\u624b\u7cca\u7684\uff09\r\n\r\n\u9898\u610f\u4e0d\u5728\u6b64\u8d58\u8ff0\u3002\r\n\r\n# \u601d\u8def\r\n\r\n\u76f4\u89c9\u544a\u8bc9\u6211\u4eec\uff0c\u5bf9\u4e8e\u5e8f\u5217 $a$\uff0c\u7b26\u5408\u9898\u76ee\u8981\u6c42\u7684\u65b9\u6848\u6570\u5e94\u8be5\u53ea\u4e0e\u5143\u7d20\u95f4\u7684\u76f8\u5bf9\u4f4d\u7f6e\u548c\u5927\u5c0f\u5173\u7cfb\u6709\u5173\u3002\r\n\r\n\u5bf9\u4e8e\u5e8f\u5217 $a_{l..r}$\uff0c\u6784\u9020\u4e00\u68f5\u5bf9\u5e94\u7684\u4e8c\u53c9\u6811\uff0c\u6ee1\u8db3\uff1a\r\n\r\n+ \u6bcf\u4e2a\u8282\u70b9\u5bf9\u5e94\u5e8f\u5217\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\uff08\u82e5\u5e8f\u5217\u4e3a\u7a7a\uff0c\u5219\u6811\u4e3a\u7a7a\uff09\uff1b\r\n+ \u6839\u8282\u70b9\u4e3a\u9898\u76ee\u6240\u8ff0\u7684\u300c\u6700\u5de6\u7aef\u6700\u5927\u503c\u300d\u7684\u4f4d\u7f6e\uff08\u8bb0\u4e3a $rt$\uff09\uff1b\r\n+ \u5de6\u5b50\u6811\u4e3a $a_{l..rt-1}$ \u5bf9\u5e94\u7684\u6811\uff0c\u53f3\u5b50\u6811\u4e3a $a_{rt+1..r}$ \u5bf9\u5e94\u7684\u6811\uff08\u8bb0\u5de6\u53f3\u5b50\u6811\u5bf9\u5e94\u7684\u6839\u8282\u70b9\u4e3a $ls, rs$\uff09\u3002\r\n\r\n\u6784\u9020\u6570\u7ec4 $f$\uff0c$f_{i,j}$ \u7ef4\u62a4 $b_i=j$ \u65f6\uff0c\u4ee5 $i$ \u4e3a\u6839\u8282\u70b9\u7684\u5b50\u6811\u5bf9\u5e94\u7684\u5e8f\u5217\u7684\u65b9\u6848\u6570\uff0c\u6ce8\u610f\u5230 $b_{ls}\\ngeq b_{rt}, b_{rs}\\ngtr b_{rt}$\uff0c\u5219\u6613\u5f97\u8f6c\u79fb\u65b9\u7a0b\u4e3a $f_{i,j} = \\left(\\sum\\limits_{k=1}^{j-1}f_{ls,k}\\right)\\left(\\sum\\limits_{k=1}^{j}f_{rs, k}\\right)$\u3002\r\n\r\n\u663e\u7136\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u4f18\u5316\uff08$g_{i,j}=\\sum\\limits_{k=1}^{j}f_{i,k}$\uff09\uff0c\u5219\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u53d8\u4e3a $f_{i,j} = g_{ls,j-1}\\times g_{rs,j}$\u3002\r\n\r\n\u7b54\u6848\u5373\u4e3a $g_{rt, m}$\u3002\r\n\r\n\u7ec6\u8282\uff1a\u6ce8\u610f\u591a\u7ec4\u6570\u636e\u4e4b\u95f4\u7684\u6e05\u96f6\u95ee\u9898\uff0c\u672c\u4eba\u4fdd\u8bc1\u4e86\u6bcf\u4e2a\u6570\u636e\u90fd\u88ab\u66f4\u65b0\uff0c\u6545\u6ca1\u6709\u4f7f\u7528 `memset`\u3002\r\n\r\n# \u4ee3\u7801\r\n\r\n```cpp\r\n#include<iostream>\r\n#define sfor(i, h, t) for(int i = (h); i <= (t); ++i)\r\n#define il inline\r\n#define f(i, j) f[i * M + i + j]\r\n#define g(i, j) g[i * M + i + j]\r\nusing namespace std;\r\ntypedef long long ll;\r\nconst int MAXN = 200008;\r\nconst int MAXNM = 2000008;\r\nconst ll P = 1000000007;\r\nint T, N, M;\r\nint num[MAXN];\r\nll f[MAXNM], g[MAXNM];\r\nstruct SEGT {\r\n    int val[MAXN << 2];\r\n    il int pushup(int x, int y) {\r\n        return num[x] >= num[y] ? x : y;\r\n    }\r\n    il void build(int l, int r, int p) {\r\n        if(l == r) {\r\n            val[p] = l;\r\n            return;\r\n        }\r\n        int mid = (l & r) + ((l ^ r) >> 1), ls = p << 1, rs = p << 1 | 1;\r\n        build(l, mid, ls);\r\n        build(mid + 1, r, rs);\r\n        val[p] = pushup(val[ls], val[rs]);\r\n    }\r\n    il int query(int L, int R, int l, int r, int p) {\r\n        if(L <= l && r <= R)\r\n            return val[p];\r\n        int res = 0, mid = (l & r) + ((l ^ r) >> 1), ls = p << 1, rs = p << 1 | 1;\r\n        if(L <= mid)\r\n            res = pushup(res, query(L, R, l, mid, ls));\r\n        if(mid < R)\r\n            res = pushup(res, query(L, R, mid + 1, r, rs));\r\n        return res;\r\n    }\r\n}segT;\r\nil int solve(int l, int r) {\r\n    if(l > r)\r\n        return 0;\r\n    if(l == r) {\r\n        sfor(i, 0, M) {\r\n            f(l, i) = 1;\r\n            g(l, i) = i;\r\n        }\r\n        return l;\r\n    }\r\n    int rt = segT.query(l, r, 1, N, 1);\r\n    int ls = solve(l, rt - 1), rs = solve(rt + 1, r);\r\n    g(rt, 0) = 0;\r\n    sfor(i, 1, M) {\r\n        f(rt, i) = g(ls, i - 1) * g(rs, i) % P;\r\n        g(rt, i) = (g(rt, i - 1) + f(rt, i)) % P;\r\n    }\r\n    return rt;\r\n}\r\nsigned main(void) {\r\n    ios::sync_with_stdio(false);\r\n    cin >> T;\r\n    while(T--) {\r\n        cin >> N >> M;\r\n        sfor(i, 1, N)\r\n            cin >> num[i];\r\n        segT.build(1, N, 1);\r\n        sfor(i, 0, M)\r\n            g[i] = 1;\r\n        int rt = solve(1, N);\r\n        cout << g(rt, M) << '\\n';\r\n    }\r\n}\r\n```",
        "postTime": 1668917610,
        "uid": 261507,
        "name": "Ender_hz",
        "ccfLevel": 6,
        "title": "CF1748E"
    },
    {
        "content": "\u5f88\u5bb9\u6613\u770b\u51fa\u662f dp \u9898\uff0c\u9996\u5148\u8003\u8651\u6784\u9020\u4e00\u68f5\u7b1b\u5361\u5c14\u6811\uff1a\u5de6\u513f\u5b50\u4e3a $a$ \u5e8f\u5217\u5de6\u4fa7\u7b2c\u4e00\u4e2a\u6743\u503c\u6bd4\u5b83\u5c0f\u7684\u4f4d\u7f6e\uff0c\u53f3\u513f\u5b50\u4e3a\u53f3\u4fa7\u7b2c\u4e00\u4e2a\u6743\u503c\u5c0f\u4e8e\u7b49\u4e8e\u5b83\u7684\u4f4d\u7f6e\u3002\u4e4b\u540e\u5728\u7b1b\u5361\u5c14\u6811\u4e0a dp\u3002\u8bbe $dp_{i,j}$ \u8868\u793a $i$ \u53f7\u8282\u70b9\u5b50\u6811\u6240\u8868\u793a\u7684\u8fde\u7eed\u6bb5\u5168\u90e8\u5904\u7406\u5b8c\uff0c$b_i$ \u7684\u6743\u503c\u4e3a $j$ \u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u5f88\u663e\u7136\uff1a\n\n$$\ndp_{i,j}=(\\sum\\limits_{k=1}^{j-1}dp_{ls_{i},j})(\\sum\\limits_{k=1}^{j}dp_{rs_{i},{j}})\n$$\n\n\u8fd9\u9053\u9898\u5c31\u89e3\u51b3\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n// Problem: E. Yet Another Array Counting Problem\n// Contest: Codeforces - Codeforces Round #833 (Div. 2)\n// URL: https://codeforces.com/contest/1748/problem/E\n// Memory Limit: 512 MB\n// Time Limit: 2000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n#define Wilson_Inversion_AUTHOR            \\\n|****************************************| \\\n|                                        | \\\n|     $$\\   $$\\   $$\\         $$$$\\      | \\\n|     $$ |  $$ |  $$ |        \\$$  |     | \\\n|     $$ |  $$ |  $$ |         $$ /      | \\\n|     $$ |  $$ |  $$ |         $$ |      | \\\n|     \\$$\\ $$$$\\ $$  |         $$ |      | \\\n|      $$ |$$$$ |$$ /          $$ |      | \\\n|      \\$$$$ \\$$$$  |          $$ |      | \\\n|       \\$$  /\\$$  /          $$$$\\      | \\\n|        \\__/  \\__/           \\____|     | \\\n|                                        | \\\n|****************************************|\n#include <bits/stdc++.h>\n#define gdb\n#ifdef gdb\n#define dbg cerr << \"Wilson_Inversion\\n\"\n#define debug(x) cerr << \"[\" << #x << \"=\" << x << \"]\\n\"\n#define DEBUG(x, __n) {                                                         \\\n\tcerr << \"[\" << #x << \":\\n\";                                                 \\\n\tfor (int __i = 0; __i < __n; ++ __i) cerr << __i << \":\" << x[__i] << \",\\n\"; \\\n\tcerr << __n << \":\" << x[__n] << \"]\\n\"                                       \\\n}\n#else\n#define dbg 0\n#define debug(x) 0\n#define DEBUG(x, __n) 0\n#endif\n#define pb push_back\n#define mk make_pair\n#define ff first\n#define ss second\n#define int long long\n#define db double\n#define miny(x, y) x = min(x, y)\n#define maxy(x, y) x = max(x, y)\n#define lowbit(x) ((x) & (-(x)))\n#define fu(i, l, r) for (int i = (l); i <= (r); ++i)\n#define fd(i, r, l) for (int i = (r); i >= (l); --i)\n#define mem(x, y) memset(x, y, sizeof (x))\n#define file(x)                   \\\n\tfreopen(x \".in\", \"r\", stdin); \\\n\tfreopen(x \".out\", \"w\", stdout);\n#define mod 1000000007\n#ifdef int\n#define inf 0x3f3f3f3f3f3f3f3f\n#else\n#define inf 0x3f3f3f3f\n#endif\n#define inv(x) qp(x, mod - 2)\nusing namespace std;\nnamespace Std {\n\tvoid read(int &x) {\n\t\tx = 0;\n\t\tint y = 1;\n\t\tchar c = getchar();\n\t\twhile (c < '0' || c > '9') {\n\t\t\tif (c == '-') y = -1;\n\t\t\tc = getchar();\n\t\t}\n\t\twhile (c >= '0' && c<= '9') {\n\t\t\tx = (x << 1) + (x << 3) + (c & 15);\n\t\t\tc = getchar();\n\t\t}\n\t\tx *= y;\n\t}\n\tvoid write(int x) {\n\t\tchar s[50];\n\t\tint tot = 0;\n\t\twhile (x) {\n\t\t\ts[++tot] = (x % 10);\n\t\t\tx /= 10;\n\t\t}\n\t\twhile (tot) putchar(s[tot--]);\n\t}\n\tint qp(int x, int y) {\n\t\tint cmp = 1;\n\t\twhile (y) {\n\t\t\tif (y & 1) (cmp *= x) %= mod;\n\t\t\t(x *= x) %= mod;\n\t\t\ty >>= 1;\n\t\t}\n\t\treturn cmp;\n\t}\n\tint T, n, m, f[1000010], a[1000010];\n\tvector <int> vec[1000010];\n\tint find(int x) {\n\t\treturn ((f[x] == x) ? x : (f[x] = find(f[x])));\n\t}\n\tvoid main() {\n\t\tread(T);\n\t\twhile (T --) {\n\t\t\tread(n);\n\t\t\tread(m);\n\t\t\tfor (int i = 0; i <= m; ++ i) vec[i].clear();\n\t\t\tfor (int i = 1; i <= n; ++ i) {\n\t\t\t\tread(a[i]);\n\t\t\t\tf[i] = i;\n\t\t\t}\n\t\t\tfor (int i = n; i; -- i) vec[a[i]].pb(i);\n\t\t\tint dp[n + 3][m + 3], sum[n + 3][m + 3];\n\t\t\tfor (int i = 1; i <= n; ++ i) {\n\t\t\t\tfor (int j = 0; j <= m; ++ j) dp[i][j] = sum[i][j] = 0;\n\t\t\t}\n\t\t\tfor (int i = 1; i <= m; ++ i) {\n\t\t\t\tfor (auto j : vec[i]) {\n\t\t\t\t\tif (a[j + 1] <= a[j] && a[j - 1] < a[j] && j != n && j != 1) {\n\t\t\t\t\t\tfor (int k = 1; k <= m; ++ k) {\n\t\t\t\t\t\t\tdp[j][k] = (sum[find(j - 1)][k - 1]) * sum[find(j + 1)][k] % mod;\n\t\t\t\t\t\t\tsum[j][k] = (sum[j][k - 1] + dp[j][k]) % mod;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf[find(j - 1)] = f[find(j + 1)] = j;\n\t\t\t\t\t} else if (a[j - 1] < a[j] && j != 1) {\n\t\t\t\t\t\tfor (int k = 1; k <= m; ++ k) {\n\t\t\t\t\t\t\tdp[j][k] = sum[find(j - 1)][k - 1];\n\t\t\t\t\t\t\tsum[j][k] = (sum[j][k - 1] + dp[j][k]) % mod;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf[find(j - 1)] = j;\n\t\t\t\t\t} else if(a[j + 1] <= a[j] && j != n) {\n\t\t\t\t\t\tfor (int k = 1; k <= m; ++ k) {\n\t\t\t\t\t\t\tdp[j][k] = sum[find(j + 1)][k];\n\t\t\t\t\t\t\tsum[j][k] = (sum[j][k - 1] + dp[j][k]) % mod;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf[find(j + 1)] = j;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (int k = 1; k <= m; ++ k) {\n\t\t\t\t\t\t\tdp[j][k] = 1;\n\t\t\t\t\t\t\tsum[j][k] = (sum[j][k - 1] + dp[j][k]) % mod;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tint ans = 0;\n\t\t\tfor (int i = 1; i <= m; ++ i) (ans += dp[find(1)][i]) %= mod;\n\t\t\tprintf(\"%lld\\n\", ans);\n\t\t}\n\t}\n}  // namespace Std\n#undef int\nint main() {\n\tStd :: main();\n\treturn 0;\n}\n```\n",
        "postTime": 1668440772,
        "uid": 576737,
        "name": "Wilson_Inversion",
        "ccfLevel": 7,
        "title": "CF1748E Yet Another Array Counting Problem \u9898\u89e3"
    },
    {
        "content": "# Preface\n\n\u4e00\u9053\u597d\u9898\uff0c\u5e8f\u5217\u8f6c\u6811\u4e0a\u95ee\u9898\u5c5e\u5b9e\u4f18\u7f8e\uff0c\u4f46\u662f\u505a\u591a\u4e86\u5c31\u5957\u8def\u4e86\uff1f\n\n# Statement\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u7ec4 $[a_1,a_2,...,a_n]$ \u6ee1\u8db3 $a_i \\leq m$\uff0c\u8981\u6c42\u6709\u591a\u5c11\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u7ec4 $[b_1,b_2,...,b_n]$ \u6ee1\u8db3\uff1a\n+ $1\\leq b_i\\leq m$\n+ \u5bf9\u4e8e\u4efb\u610f\u533a\u95f4 $[l,r]$\uff0c\u90fd\u6709 $[a_l,a_{l+1},...,a_r]$ \u7684\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c\u7684\u4f4d\u7f6e\u7b49\u4e8e $[b_l,b_{l+1},...,b_r]$ \u7684\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c\u7684\u4f4d\u7f6e\n\n\u8f93\u51fa\u7b54\u6848\u6a21 $10^9+7$\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$n,m\\leq 2\\cdot 10^5,n\\cdot m\\leq 10^6$\u3002\n\n# Solution\n\n\u9996\u5148\u5148\u4ece $[1,n]$ \u5165\u624b\uff0c\u5148\u53ef\u4ee5\u6c42\u51fa\u8fd9\u4e2a\u533a\u95f4\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c\u7684\u4f4d\u7f6e\uff0c\u8bbe\u4e3a $m$\uff0c\u8bbe $[l,m-1]$ \u7684\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c\u7684\u4f4d\u7f6e\u4e3a $x$\uff0c$[m+1,r]$ \u7684\u6700\u5de6\u8fb9\u7684\u6700\u5927\u503c\u4f4d\u7f6e\u4e3a $y$\uff0c\u5bb9\u6613\u53d1\u73b0 $b_u>b_x,b_u\\geq b_y$\u3002\n\n\u8fd9\u542f\u53d1\u6211\u4eec\u53bb\u8f6c\u4e8c\u53c9\u6811\u6811\u5f62 dp\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5 $u$ \u4e3a\u6839\u8282\u70b9 $x,y$ \u4e3a\u5de6\u53f3\u513f\u5b50\u9012\u5f52\u4e0b\u53bb\u5efa\u6811\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u672c\u6765\u662f $O(n^2)$ \u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u7528 ST \u8868 + \u4e8c\u5206\u8fbe\u5230 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n\u8bbe $f(u,i)$ \u8868\u793a dp \u5230\u70b9 $u$\uff0c$b_u=i$ \u7684\u65b9\u6848\u6570\u3002\u8bbe $u$ \u7684\u5de6\u53f3\u513f\u5b50\u5206\u522b\u4e3a $x,y$\uff0c\u5219\uff1a\n+ \u82e5 $x,y$ \u90fd\u4e0d\u5b58\u5728\uff0c\u5219 $f(u,i)=1$\n+ \u82e5\u53ea\u6709 $x$ \u5b58\u5728\u4e14 $i=1$\uff0c\u5219 $f(u,i)=0$\n+ \u5426\u5219\u82e5\u53ea\u6709 $x$ \u5b58\u5728\uff0c\u5219 $f(u,i)=\\sum_{j=1}^{i-1}f(x,j)$\n+ \u82e5\u53ea\u6709 $y$ \u5b58\u5728\uff0c\u5219 $f(u,i)=\\sum_{j=1}^if(y,j)$\n+ \u82e5 $x,y$ \u90fd\u5b58\u5728\uff0c\u5219 $f(u,i)=\\sum_{j=1}^{i-1}f(x,j)\\cdot\\sum_{j=1}^if(y,j)$\n\n\u7528\u524d\u7f00\u548c\u4f18\u5316\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n+nm)$\u3002\n\n# Summary\n\n\u5947\u6280\u6deb\u5de7\uff0c\u6211\u65e0\u8bdd\u53ef\u8bf4\u2026\u2026\n\n# Code\n\n```cpp\n//AC!\n//After_contest\n#include<bits/stdc++.h>\n//#define int long long\n#define repe(i,l,r) for(int (i)=l;(i)<=r;(i)++)\n#define rep(i,n) for(int (i)=1;(i)<=n;(i)++)\n#define FOR(i,r,l) for(int (i)=r;(i)>=l;(i)--)\n#define INF 0x3f3f3f\n#define pii pair<int,int>\n#define ll long long\n#define mpr make_pair\n#define pb push_back\n#define F first\n#define S second\n#define sz(v) (int)((v).size())\n#define ALL(v) (v).begin(),(v).end()\n#define rALL(v) (v).rbegin(),(v).rend()\n#define srt(v) sort(ALL(v))\n#define rsrt(v) sort(rALL(v))\n#define rev(v) reverse(ALL(v))\n#define lb(v,x) (int)(lower_bound(ALL(v),x)-v.begin())\n#define ub(v,x) (int)(upper_bound(ALL(v),x)-v.begin())\n#define uni(v) v.resize(unique(ALL(v))-v.begin())\nusing namespace std;\nint read(){int sum=0,f=1;char c;c=getchar();while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}while(c>='0'&&c<='9'){sum=(sum<<1)+(sum<<3)+(c-'0');c=getchar();}return sum*f;}\nvoid out(int x){if(x<0){x=-x;putchar('-');}if(x>=10)out(x/10);putchar(x%10+'0');}\nvoid die(string s){puts(s.c_str());exit(0);}\nint fast(int a,int b,int P){int res=1;if(P<=0){while(b){if(b&1)res=res*a;a=a*a;b>>=1;}}else{while(b){if(b&1)res=res*a%P;a=a*a%P;b>>=1;}}return res;}\nconst int N=2e5+10,P=1e9+7;\nint n,m,a[N],st[N][20];\nvector<int> vec[N];\nvector<vector<int>> dp,sum;\nint getmx(int l,int r){\n\tint k=log2(r-l+1);\n\treturn max(st[l][k],st[r-(1<<k)+1][k]);\n}\nint calc(int l,int r){\n\tif(l>r)return -1;\n\tint val=getmx(l,r);\n\treturn *lower_bound(vec[val].begin(),vec[val].end(),l);\n}\nvoid dfs(int u,int l,int r){\n\tint lson=calc(l,u-1),rson=calc(u+1,r);\n\tif(lson!=-1)dfs(lson,l,u-1);\n\tif(rson!=-1)dfs(rson,u+1,r);\n\tfor(int x=1;x<=m;x++){\n\t\tif(lson==-1&&rson==-1)dp[u][x]=1;\n\t\telse if(rson==-1&&x==1)dp[u][x]=0;\n\t\telse if(rson==-1)dp[u][x]=sum[lson][x-1];\n\t\telse if(lson==-1)dp[u][x]=sum[rson][x];\n\t\telse dp[u][x]=1LL*sum[lson][x-1]*sum[rson][x]%P;\n\t\tsum[u][x]=(sum[u][x-1]+dp[u][x])%P;\n\t}\n}\nvoid solve(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=m;i++)vec[i].clear();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i]=read();\n\t\tvec[a[i]].pb(i);\n\t\tst[i][0]=a[i];\n\t}\n\tfor(int j=1;j<20;j++){\n\t\tfor(int i=1;i+(1<<j)-1<=n;i++){\n\t\t\tst[i][j]=max(st[i][j-1],st[i+(1<<(j-1))][j-1]);\n\t\t}\n\t}\n\tvector<int> tmp(m+1,0);\n\tdp.clear();\n\tsum.clear();\n\tfor(int i=0;i<=n;i++){\n\t\tdp.pb(tmp);\n\t\tsum.pb(tmp);\n\t}\n\tint rt=calc(1,n);\n\tdfs(rt,1,n);\n\tout(sum[rt][m]),putchar('\\n');\n}\nint main(){\n\tint t=read();\n\twhile(t--){\n\t\tsolve();\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1668308175,
        "uid": 229669,
        "name": "Jerry__Jiang",
        "ccfLevel": 7,
        "title": "CF1748E Yet Another Array Counting Problem"
    },
    {
        "content": "\u4e0d\u9519\u7684\u4e00\u4e2a dp \u5957\u8def\u3002\n\n## \u601d\u8def\n\n\u6700\u7b80\u5355\u7684\u601d\u60f3\u662f\u8003\u8651 $dp_{i,j,k}$ \u8868\u793a $i\\sim j$ \u533a\u95f4\u5185\u6700\u5927\u503c\u4e3a $k$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u65f6\u5408\u5e76\u4e24\u4e2a\u533a\u95f4\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e24\u4e2a\u7684\u6700\u5927\u503c\u5173\u7cfb\u548c\u5728\u539f\u6570\u5217\u4e2d\u4e00\u6a21\u4e00\u6837\u3002\n\n\u8fd9\u6837\u662f $O(n^2m)$ \u7684\u663e\u7136\u4e0d\u53ef\u8fc7\u3002\n\n\u8003\u8651\u6309\u539f\u6570\u5217\u4ece\u5c0f\u5411\u5927\u586b\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6bcf\u6b21\u589e\u52a0\u4e00\u4e2a\u6570\u53ea\u4f1a\u591a\u51fa\u4e00\u7ec4 $dp_{x,k}$\uff0c\u4e8e\u662f\u72b6\u6001\u6570\u964d\u4f4e\u5230\u4e86 $O(nm)$ \u7ea7\u522b\u3002\n\n\u8f6c\u79fb\u7684\u8bdd\uff0c\u6bcf\u6b21\u8003\u8651\u5408\u5e76\u8fd9\u4e2a\u6570\u4e24\u8fb9\u76ee\u524d\u6bd4\u4ed6\u5c0f\u7684\u6570\uff0c\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u4e00\u4e0b\u3002\u5177\u4f53\u4e5f\u548c\u5148\u6587\u4e00\u6837\u9700\u8981\u4fdd\u8bc1\u6700\u5927\u503c\u5728\u539f\u6570\u5217\u5173\u7cfb\u4e00\u6837\u3002\n\n\u8865\u5145\u8bf4\u660e\uff1a\u5408\u5e76\u65f6\uff08\u5373\u72b6\u6001\u8f6c\u79fb\u65f6\uff09\uff0c\u76ee\u524d\u770b\u5230\u4f4d\u7f6e\u7684\u5de6\u8fb9\u8981\u6c42\u4e25\u683c\u6bd4\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u503c\u5c0f\u3002\u53f3\u8fb9\u5219\u5c0f\u4e8e\u7b49\u4e8e\u5373\u53ef\u3002\u539f\u56e0\u662f\u6bcf\u6b21\u6c42 $\\max$ \u4f4d\u7f6e\u65f6\u7b97\u7684\u662f\u6700\u5de6\u8fb9\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n#define double long double\n#define mid ((l+r)>>1)\nusing namespace std;\nconst int mod=1e9+7;\nint f[1000005];\nint find(int i){\n\treturn (f[i]==i?f[i]:f[i]=find(f[i]));\n}\nsigned main(){\n\tint t;\n\tcin>>t;\n\twhile(t--){\n\t\tint n,m;\n\t\tcin>>n>>m;\n\t\tint a[n+1];\n\t\tvector<int> vc[m+1];\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tcin>>a[i];\n\t\t\tvc[a[i]].push_back(i);\n\t\t}\n\t\tfor(int i=1;i<=n;i++) f[i]=i;\n\t\tint dp[n+1][m+1],pre[n+1][m+1];\n\t\tfor(int i=1;i<=n;i++) for(int j=0;j<=m;j++) dp[i][j]=0,pre[i][j]=0;\n\t\tfor(int i=1;i<=m;i++){\n\t\t\treverse(vc[i].begin(),vc[i].end());\n\t\t\tfor(auto v:vc[i]){\n\t\t\t\tif(a[v+1]<=a[v]&&a[v-1]<a[v]&&v+1<=n&&v-1>0){\n\t\t\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\t\t\tdp[v][j]=(pre[find(v-1)][j-1]*pre[find(v+1)][j])%mod;\n\t\t\t\t\t\tpre[v][j]=(pre[v][j-1]+dp[v][j])%mod;\n\t\t\t\t\t}\n\t\t\t\t\tf[find(v-1)]=v;\n\t\t\t\t\tf[find(v+1)]=v;\n\t\t\t\t}\n\t\t\t\telse if(a[v+1]<=a[v]&&v+1<=n){\n\t\t\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\t\t\tdp[v][j]=(pre[find(v+1)][j])%mod;\n\t\t\t\t\t\tpre[v][j]=(pre[v][j-1]+dp[v][j])%mod;\n\t\t\t\t\t}\n\t\t\t\t\tf[find(v+1)]=v;\n\t\t\t\t}\n\t\t\t\telse if(a[v-1]<a[v]&&v-1>0){\n\t\t\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\t\t\tdp[v][j]=(pre[find(v-1)][j-1])%mod;\n\t\t\t\t\t\tpre[v][j]=(pre[v][j-1]+dp[v][j])%mod;\n\t\t\t\t\t}\n\t\t\t\t\tf[find(v-1)]=v;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\t\t\tdp[v][j]=1;\n\t\t\t\t\t\tpre[v][j]=(pre[v][j-1]+dp[v][j])%mod;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tint ans=0;\n\t\tfor(int i=1;i<=m;i++){\n\t\t\tans=(ans+dp[find(1)][i])%mod;\n\t\t}\n\t\tcout<<ans<<endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1667663389,
        "uid": 116664,
        "name": "Daniel_lele",
        "ccfLevel": 8,
        "title": "CF1748E \u9898\u89e3"
    }
]