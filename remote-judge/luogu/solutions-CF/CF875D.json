[
    {
        "content": "[CF875D. High Cry](https://www.luogu.com.cn/problem/CF875D)\n\n7KByte \u7684\u9898\u89e3\u91cc\uff0c\u6240\u8c13\u7684\u300e\u6781\u503c\u5206\u6cbb\u300f\uff0c\u5176\u5b9e\u5c31\u662f\u7b1b\u5361\u5c14\u6811\u3002\u5728\u4e00\u7c7b\u548c\u6700\u5c0f\u503c / \u6700\u5927\u503c\u76f8\u5173\u7684\u95ee\u9898\u4e2d\uff0c\u7b1b\u5361\u5c14\u6811\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u601d\u8003\u65b9\u5411\u3002\n\n\u7136\u800c 7KByte \u53ea\u63d0\u51fa\u4e86 $O(n \\log^2 n)$ \u7684\u505a\u6cd5\uff0c\u4f46 $\\text{or}$ \u7684\u6027\u8d28\u90a3\u4e48\u5f3a\uff0c\u6211\u4eec\u7406\u5e94\u6709\u66f4\u4f18\u7684\u505a\u6cd5\u3002\n\n---\n\n\u548c\u5176\u5b83\u9898\u89e3\u4e00\u6837\uff0c\u8fd8\u662f\u5148\u505a\u8865\u96c6\u8f6c\u5316\uff0c\u7b54\u6848\u4e3a\u603b\u533a\u95f4\u6570\u91cf\u51cf\u53bb $\\text{or} = \\max$ \u7684\u533a\u95f4\u6570\u91cf\u3002\n\n\u5efa\u51fa\u5e8f\u5217\u7684\u7b1b\u5361\u5c14\u6811\u3002\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $i$\uff0c\u8bbe\u5b83\u7684\u5b50\u6811\u5bf9\u5e94\u7684\u533a\u95f4\u4e3a $[x_i, y_i]$\uff0c\u90a3\u4e48\u4ee5 $a_i$ \u4e3a $\\max$ \u7684\u533a\u95f4 $[l, r]$ \u4e00\u5b9a\u6ee1\u8db3 $l \\in [x_i, i]$ \u4e14 $r \\in [i, y_i]$\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u9650\u5236\u662f $\\text{or} = \\max$\u3002\u8fd9\u7b49\u4ef7\u4e8e $\\forall x \\in [l, r]$\uff0c$x~\\text{or}~a_i = 0$\u3002\u90a3\u4e48\u627e\u5230**\u6700\u5927\u7684 $\\text{vl} \\in [l, i - 1]$\uff0c\u6ee1\u8db3 $a_{\\text{vl}}~\\text{or}~a_i \\ne 0$**\uff1b\u540c\u7406\u627e\u5230**\u6700\u5c0f\u7684 $\\text{vr} \\in [i + 1, r]$\uff0c\u6ee1\u8db3 $a_{\\text{vr}}~\\text{or}~a_i \\ne 0$**\u3002\u90a3\u4e48\u6ee1\u8db3\u6761\u4ef6\u7684\u533a\u95f4\u4e2a\u6570\u4e3a $(i - \\text{vl}) \\cdot (\\text{vr} - i)$\u3002\n\n\u6c42 $\\text{vl}$ \u548c $\\text{vr}$ \u662f\u590d\u6742\u5ea6\u74f6\u9888\u3002\n\n## Algorithm 1. $O(n \\log V)$\n\n\u5176\u4e2d $V$ \u662f\u503c\u57df\u3002\n\n\u5047\u8bbe\u6c42 $\\text{vl}$\uff1a\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $k \\in [0, \\log(V)]$\uff0c**\u9884\u5904\u7406\u51fa $1 \\sim i$ \u4e2d $a_j$ \u51fa\u73b0 $2^k$ \u7684\u6700\u5927\u7684 $j$\uff0c\u8bb0\u4e3a $\\text{fl}(i, k)$**\uff1b\u5bf9\u4e8e\u6bcf\u4e2a\u6ca1\u6709\u5728 $a_i$ \u4e2d\u51fa\u73b0\u7684 $2^k$\uff0c\u53d6 $\\max\\{\\text{fl}(i - 1, k)\\}$ \u5373\u4e3a $\\text{vl}$\u3002$\\text{vr}$ \u7684\u6c42\u6cd5\u662f\u7c7b\u4f3c\u7684\u3002\n\n## Algorithm 2. $O(n \\log n)$\n\n\u5f53 $l$ \u56fa\u5b9a\u65f6\uff0c\u533a\u95f4 $[l, r]$ \u7684 $\\text{or}$ \u4e00\u5b9a\u968f $r$ \u5355\u8c03\u4e0d\u964d\u3002\u4e8c\u5206\u5373\u53ef\u3002\n\n\u8fd9\u91cc\u7ed9\u51fa Algorithm 2 \u7684\u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long LL; const int N = 2e5 + 7, LogN = 20, LogV = 30;\nint n, a[N]; LL ans = 0;\nstruct ST{\n\tint lg2[N], f[N][LogN], s[N][LogN];\n\tvoid build() {\n\t\tlg2[0] = -1;\n\t\tfor(int i = 1; i <= n; i++) lg2[i] = lg2[i >> 1] + 1, f[i][0] = i, s[i][0] = a[i];\n\t\tfor(int i = 1; i <= lg2[n]; i++)\n\t\t\tfor(int l = 1; l + (1 << i) - 1 <= n; l++) {\n\t\t\t\tif(a[f[l][i - 1]] > a[f[l + (1 << (i - 1))][i - 1]]) f[l][i] = f[l][i - 1];\n\t\t\t\telse f[l][i] = f[l + (1 << (i - 1))][i - 1];\n\t\t\t\ts[l][i] = s[l][i - 1] | s[l + (1 << (i - 1))][i - 1];\n\t\t\t}\n\t}\n\tint qmax(int l, int r) {\n\t\tint len = lg2[r - l + 1];\n\t\tif(a[f[l][len]] > a[f[r - (1 << len) + 1][len]]) return f[l][len];\n\t\telse return f[r - (1 << len) + 1][len];\n\t}\n\tint qor(int l, int r) {\n\t\tint len = lg2[r - l + 1];\n\t\treturn s[l][len] | s[r - (1 << len) + 1][len];\n\t}\n} st;\nvoid dfs(int l, int r) {\n\tif(l == r) return ans++, void();\n\tint mid = st.qmax(l, r), vl = l - 1, vr = r + 1;\n\tif(st.qor(l, mid) != a[mid]) {\n\t\tint pl = l, pr = mid;\n\t\twhile(pl < pr) {\n\t\t\tint pmid = (pl + pr + 1) >> 1;\n\t\t\tif(st.qor(pmid, mid) == a[mid]) pr = pmid - 1;\n\t\t\telse pl = pmid;\n\t\t}\n\t\tvl = pl;\n\t}\n\tif(st.qor(mid, r) != a[mid]) {\n\t\tint pl = mid, pr = r;\n\t\twhile(pl < pr) {\n\t\t\tint pmid = (pl + pr) >> 1;\n\t\t\tif(st.qor(mid, pmid) == a[mid]) pl = pmid + 1;\n\t\t\telse pr = pmid;\n\t\t}\n\t\tvr = pl;\n\t}\n\tans += LL(mid - vl) * (vr - mid);\n\tif(l != mid) dfs(l, mid - 1);\n\tif(mid != r) dfs(mid + 1, r);\n}\nint main() {\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i <= n; i++) scanf(\"%d\", a + i);\n\tst.build(), dfs(1, n), printf(\"%lld\\n\", n * LL(n + 1) / 2 - ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1667446924,
        "uid": 622514,
        "name": "ii45i4",
        "ccfLevel": 0,
        "title": "\u6298\u83ca\u5bc4\u5230\u4f60\u8eab\u65c1"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217 $a$,\u6c42\u6709\u591a\u5c11\u5b50\u4e32\u6ee1\u8db3\u5b50\u4e32\u7684 $\\max$ \u4e25\u683c\u5c0f\u4e8e\u5b50\u4e32\u4e2d\u6240\u6709\u6570\u7684\u6216\u503c.\n\n# \u5206\u6790\n\n\u663e\u7136\u4e00\u4e2a\u5b50\u4e32\u7684\u6216\u8005\u80af\u5b9a\u662f\u5927\u4e8e\u7b49\u4e8e\u5b50\u4e32\u7684 $\\max$,\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u8981\u6c42\u51fa\u6709\u591a\u5c11\u7684\u5b50\u4e32\u7684\u6216\u503c\u7b49\u4e8e\u5b50\u4e32\u7684 $\\max$.\u518d\u7ecf\u8fc7\u7b80\u5355\u7684\u5206\u6790,\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u5b50\u4e32\u6700\u5927\u503c\u7684\u4e8c\u8fdb\u5236\u4e2d\u7b2c $k$ \u4f4d\u4e3a $0$,\u4f46\u5b50\u4e32\u4e2d\u5b58\u5728\u67d0\u6570\u4e8c\u8fdb\u5236\u4e0b\u7b2c $k$ \u4f4d\u7684\u503c\u4e3a $1$,\u90a3\u4e48\u8fd9\u4e2a\u5b50\u4e32\u7684\u6216\u503c\u5fc5\u7136\u5927\u4e8e\u6700\u5927\u503c(\u6700\u5927\u503c\u4e0e\u8fd9\u4e2a\u6570\u7684\u6216\u503c\u5fc5\u7136\u5927\u4e8e\u6700\u5927\u503c).\n\n\u8003\u8651\u5bf9\u6bcf\u4e2a\u6570\u8ba1\u7b97\u4ee5\u5f53\u524d\u6570\u4e3a\u6700\u5927\u503c\u65f6\u7684\u4e0d\u5408\u6cd5\u7684\u5b50\u4e32\u6570,\u5373\u8ba1\u7b97\u6709\u591a\u5c11\u5b50\u4e32\u7684\u6700\u5927\u503c\u5728\u67d0\u4e2a\u4f4d\u7f6e($i$)\u65f6\u6709\u5f02\u6216\u503c\u7b49\u4e8e\u6700\u5927\u503c.\u90a3\u4e48\u8fd9\u4e2a\u5b50\u4e32\u7684\u5de6\u7aef\u70b9($l$),\u53f3\u7aef\u70b9($r$)\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6:\n\n1.  $l\\leq i\\leq r$($i$ \u4f4d\u7f6e\u5fc5\u987b\u5728\u5b50\u4e32\u4e2d)\n2.  $\\max\\limits_{l\\leq j\\leq r}a_j=a_l\\lor a_{l+1}\\lor a_{l+2}\\lor\\dots\\lor a_{r-2}\\lor a_{r-1}\\lor a_r=a_i$(\u5b50\u4e32\u7684\u6700\u5927\u503c\u7b49\u4e8e\u5b50\u4e32\u7684\u5f02\u6216\u503c\u7b49\u4e8e $a_i$)\n\n\u4e8e\u662f\u53ef\u4ee5\u5904\u7406\u51fa\u4ee5\u67d0\u4e2a\u6570\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\u4ee5\u53ca\u5bf9\u4e8e\u67d0\u4e2a\u6570\u6240\u4e0d\u5b58\u5728\u7684\u4e8c\u8fdb\u5236\u7684\u4f4d\u7f6e\u4e0a\u4e00\u6b21\u548c\u4e0b\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e,\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u8ba1\u7b97\u8ba1\u7b97\u51fa\u7ed3\u679c.\n\n\u4f46\u662f\u5982\u679c\u5728\u5e8f\u5217\u4e2d\u5b58\u5728\u591a\u4e2a\u76f8\u540c\u7684\u6570\u53ef\u80fd\u4f1a\u51fa\u70b9\u5c0f\u95ee\u9898.\n\n\u5982\u7b2c\u4e8c\u4e2a\u6837\u4f8b\u4e2d\u7684 `3 3 3 3`,\u76f4\u63a5\u8ba1\u7b97\u67d0\u4e2a\u6570\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\u4f1a\u8ba1\u7b97\u7684\u7ed3\u679c\u90fd\u662f $[1,4]$,\u4f46\u8fd9\u6837\u5728\u540e\u9762\u7684\u8ba1\u7b97\u4e2d\u4f1a\u51fa\u95ee\u9898,\u4f46 $[1,4],[2,4],[3,4],[4,4]$ \u5c31\u4e0d\u4f1a\u6709\u95ee\u9898\u4e86,\u6240\u4ee5\u53ef\u4ee5\u5f3a\u5236\u67d0\u4e2a\u6570\u662f\u67d0\u4e2a\u533a\u95f4\u7684\u6700\u5927\u503c\u9700\u8981\u6ee1\u8db3\u5728\u8fd9\u4e2a\u6570\u4e4b\u524d(\u6216\u8005\u4e4b\u540e)\u4e0d\u5b58\u5728\u5927\u4e8e\u7b49\u4e8e\u8fd9\u4e2a\u6570\u7684\u6570.\n\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REP(i,first,last) for(int i=first;i<=last;++i)\n#define DOW(i,first,last) for(int i=first;i>=last;--i)\nnamespace IO\n//\u5feb\u8bfb\u6a21\u677f\nusing namespace IO;\nusing namespace std;\nconst int MAXN=2e5+5;\nint n;\nint place[100];\nstruct Number\n{\n\tint num,left,right,l,r;//\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u6570,\u8fd9\u4e2a\u6570\u4e0d\u5b58\u5728\u7684\u4e8c\u8fdb\u5236\u4f4d\u7f6e\u4e0a\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e,\u4e0b\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e,\u8fd9\u4e2a\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\u7684\u5de6\u7aef\u70b9,\u53f3\u7aef\u70b9\n}arr[MAXN];\nint st[MAXN],top=0;\nint main()\n{\n\tRead(n);\n\tREP(i,1,n)\n\t{\n\t\tRead(arr[i].num);\n\t\tarr[i].left=0;\n\t\tarr[i].right=n+1;\n\t\tREP(j,0,31)\n\t\t{\n\t\t\tif(arr[i].num&(1<<j))//\u5982\u679c\u8fd9\u4e2a\u6570\u7684\u4e8c\u8fdb\u5236\u4e2d\u5b58\u5728\u7b2c j \u4f4d,\u90a3\u4e48\u5c31\u628a\u7b2c j \u4f4d\u7684\u4e0a\u4e00\u6b21\u51fa\u73b0\u4f4d\u7f6e\u53d8\u4e3a i\n\t\t\t{\n\t\t\t\tplace[j]=i;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tarr[i].left=Max(arr[i].left,place[j]);//\u5426\u5219\u5c31\u4e0e\u6700\u8fd1\u51fa\u73b0\u4f4d\u7f6e\u53d6\u66f4\u8fd1\u7684\u4f4d\u7f6e\n\t\t\t}\n\t\t}\n\t\twhile(top&&arr[st[top]].num<arr[i].num)//\u8ba1\u7b97\u5de6\u7aef\u70b9\u65f6\u7528 <,\u53f3\u7aef\u70b9\u7528 <=(\u53cd\u4e4b\u540c\u7406)\n\t\t{\n\t\t\ttop--;\n\t\t}\n\t\tarr[i].l=st[top];//\u5355\u8c03\u6808\u5904\u7406\u51fa\u8fd9\u4e2a\u6570\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\u7684\u5de6\u7aef\u70b9(\u53f3\u7aef\u70b9\u540c\u7406)\n\t\tst[++top]=i;\n\t}\n\ttop=0;\n\tREP(i,0,31)\n\t{\n\t\tplace[i]=n+1;\n\t}\n\tDOW(i,n,1)//\u540c\u7406\n\t{\n\t\tREP(j,0,31)\n\t\t{\n\t\t\tif(arr[i].num&(1<<j))\n\t\t\t{\n\t\t\t\tplace[j]=i;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tarr[i].right=Min(arr[i].right,place[j]);\n\t\t\t}\n\t\t}\n\t\twhile(top&&arr[st[top]].num<=arr[i].num)\n\t\t{\n\t\t\ttop--;\n\t\t}\n\t\tarr[i].r=st[top]?st[top]:n+1;\n\t\tst[++top]=i;\n\t}\n\tlong long answer=1ll*n*(n+1)>>1;//\u603b\u65b9\u6848\u6570\n\tREP(i,1,n)\n\t{\n\t\tanswer-=1ll*(i-Max(arr[i].l,arr[i].left))*(Min(arr[i].r,arr[i].right)-i);//\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u9650\u5236,\u6240\u4ee5\u76f4\u63a5\u5bf9\u533a\u95f4\u7684\u7aef\u70b9\u53d6\u8ddd\u79bb i \u8fd1\u7684\u90a3\u4e2a\u5c31\u884c\u4e86\n\t}\n\tWriteln(answer);\n\treturn 0;\n}\n```",
        "postTime": 1601478453,
        "uid": 86625,
        "name": "Limit",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF875D \u3010High Cry\u3011"
    },
    {
        "content": "\u8003\u8651 or \u4e0d\u4f1a\u8d85\u8fc7 $\\log$ \u6b21\u53d8\u5316\uff0c\u53ef\u4ee5\u4e8c\u5206\u51fa\u6765\u4e00\u4e2a\u4f4d\u7f6e\u968f\u4fbf\u505a\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u5728\u9610\u8ff0\u3002\n\n\u8fd9\u5176\u5b9e\u53ef\u4ee5\u7528\u5355\u8c03\u6808\uff0c\u8003\u8651\u4e00\u4e2a\u6570\u4f5c\u4e3a\u4e00\u4e2a\u533a\u95f4\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u5982\u679c\u6216\u503c\u6bd4\u8fd9\u4e2a\u6570\u8981\u5927\uff0c\u5f53\u4e14\u4ec5\u5f53\u6709\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u662f\u6700\u5927\u503c\u6240\u4e0d\u5b58\u5728\u7684\uff0c\u6240\u4ee5\u5de6\u53f3\u7aef\u70b9\u53ef\u4ee5\u6b63\u53cd\u5904\u7406\uff0c\u7136\u540e\u505a\u5b8c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,x,y) for(int i=x,I=y+1;i<I;++i)\n#define per(i,x,y) for(int i=x,I=y-1;i>I;--i)\nusing namespace std;\nusing ll=long long;\nvoid cmax(int&x,const int&y){x=x>y?x:y;}\nvoid cmin(int&x,const int&y){x=x<y?x:y;}\ntemplate<class T>istream&operator>>(istream&in,vector<T>&V){for(auto&x:V)in>>x;return in;}\ntemplate<class T>ostream&operator<<(ostream&out,const vector<T>&V){for(auto x:V)out<<x<<' ';return out;}\ntemplate<class T>void sort(vector<T>&V){sort(V.begin(),V.end());}\ntemplate<class T>void reverse(vector<T>&V){reverse(V.begin(),V.end());}\ntemplate<class T>int SZ(const vector<T>&V){return (int)V.size();}\nvoid debug(){cerr<<\"whxorz\"<<'\\n';}\n\nconst int N = 200000 + 5;\nint n, a[N];\nint L[N], R[N];\n\nint main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(NULL);\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i];\n\tstatic int st[N], top;\n\tst[top = 0] = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\twhile (top && a[st[top]] < a[i]) { R[st[top--]] = i; }\n\t\tL[i] = st[top]; st[++top] = i;\n\t}\n\twhile (top) R[st[top--]] = n + 1;\n\tfor (int i = 1; i <= n; i++) {\n\t\tL[i]++;\n\t\tR[i]--;\n\t}\n\tstatic int tmpL[N], tmpR[N], tmp[32];\n\tfor (int i = 1; i <= n; i++) tmpL[i] = 0;\n\tfor (int j = 0; j < 31; j++) tmp[j] = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tfor (int j = 0; j < 31; j++)\n\t\t\tif (a[i] >> j & 1)\n\t\t\t\ttmp[j] = i;\n\t\t\telse\n\t\t\t\tcmax(tmpL[i], tmp[j]);\n\t}\n\tfor (int i = 1; i <= n; i++) tmpR[i] = n + 1;\n\tfor (int j = 0; j < 31; j++) tmp[j] = n + 1;\n\tfor (int i = n; i >= 1; i--) {\n\t\tfor (int j = 0; j < 31; j++)\n\t\t\tif (a[i] >> j & 1)\n\t\t\t\ttmp[j] = i;\n\t\t\telse\n\t\t\t\tcmin(tmpR[i], tmp[j]);\n\t}\n\tll ans = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tif (L[i] <= tmpL[i])\n\t\t\tans += 1ll * (R[i] - i + 1) * (tmpL[i] - L[i] + 1);\n\t\tif (tmpR[i] <= R[i])\n\t\t\tans += 1ll * (i - L[i] + 1) * (R[i] - tmpR[i] + 1);\n\t\tif (L[i] <= tmpL[i] && tmpR[i] <= R[i])\n\t\t\tans -= 1ll * (tmpL[i] - L[i] + 1) * (R[i] - tmpR[i] + 1);\n\t}\n\tcout << ans << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1601343406,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF875D \u3010High Cry\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u7ffb\u8bd1\u5df2\u7ecf\u6709\u5f88\u7cbe\u7b80\u7684\u4e86\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n## \u601d\u8def\n**Main Idea:\u53cd\u9762\u8003\u8651\uff0cst-table\uff0c\u4e8c\u5206**\n\n\n\u9996\u5148\uff0c\u6211\u4eec\u53d1\u73b0\u867d\u7136\u6ee1\u8db3\u533a\u95f4\u6216\u5927\u4e8e\u533a\u95f4\u6700\u5927\u503c\u7684\u533a\u95f4\u4e2a\u6570\u5f88\u96be\u6c42\uff0c\u4f46\u5b83\u7684\u53cd\u9762\u2014\u2014\u533a\u95f4\u6216\u7b49\u4e8e\u533a\u95f4\u6700\u5927\u503c\u5f88\u597d\u6c42\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u600e\u4e48\u6c42\u533a\u95f4\u7684\u6216\u7b49\u4e8e\u533a\u95f4\u6700\u5927\u503c\u7684\u533a\u95f4\u3002\n\n\u663e\u800c\u6613\u89c1\u7684\u601d\u8def\u662f\u5206\u522b\u7edf\u8ba1\u6700\u5927\u503c\u4e3a\u67d0\u4e2a\u6570\u7684\u533a\u95f4\uff0c\u800c\u8fd9\u4e2a\u533a\u95f4\u53ef\u80fd\u5305\u542b\u6700\u5927\u503c\u5de6\u8fb9\u7684\u4e00\u4e9b\u6570\u548c\u6700\u5927\u503c\u53f3\u8fb9\u7684\u4e00\u4e2a\u6570\u3002\u4e8e\u662f\uff0c\u4f60\u9700\u8981\u627e\u5230\u6bcf\u4e2a\u6700\u5927\u503c\u4e2d\u6ee1\u8db3\u8981\u6c42\u7684\u533a\u95f4\u7684\u6700\u5de6\u7aef\u70b9\u548c\u6700\u53f3\u7aef\u70b9\u3002\n\n\u7136\u540e\uff0c\u4f60\u53c8\u53d1\u73b0\u8fd9\u4e2a\u6700\u5de6/\u53f3\u7aef\u70b9\u6709\u5355\u8c03\u6027\uff0c\u90a3\u4e48\u76f4\u63a5\u4e0a st-table \u9884\u5904\u7406\u533a\u95f4 sum \u548c or\uff0c\u52a0\u4e0a\u4e8c\u5206\u7edf\u8ba1\uff0c\u6700\u540e\u628a\u4e24\u8fb9\u6269\u5c55\u7684\u957f\u5ea6\u4e58\u8d77\u6765\uff0c\u5c31\u662f\u8fd9\u4e2a\u6570\u5bf9\u5e94\u7684\u4e0d\u5408\u6cd5\u533a\u95f4\u6570\u91cf\uff0c\u6700\u540e\u7528\u603b\u533a\u95f4\u6570\u91cf\u51cf\u6389\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\u770b\u4e86\u4e00\u773c\u6570\u636e\u8303\u56f4\uff0c\u653e\u4e86 $O(nlogn)$ \u8fc7\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u4e0a\u8ff0\u66b4\u529b\u6c34\u8fc7\u53bb\u3002\n## \u4ee3\u7801\n```\n#include<bits/stdc++.h>\n#define int long long \ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nusing namespace std;\nint a[200003],st[200003][23],qwq[200003][23],n=read();\ninline void init(int l)\n{\n\tst[l][0]=a[l],qwq[l][0]=a[l];\n\tfor(int i=1; i<=20; i++) \n    st[l][i]=max(st[l][i-1],st[min(l+(1<<(i-1)),n)][i-1]),\n    qwq[l][i]=qwq[l][i-1]|qwq[min(l+(1<<(i-1)),n)][i-1];\n}\ninline int query(int l,int r)\n{\n\tint L=log(r-l+1)/log(2);\n\treturn max(st[l][L],st[min(r-(1<<L)+1,n)][L]);\n}\ninline int qwqry(int l,int r)\n{\n\tint L=log(r-l+1)/log(2);\n\treturn qwq[l][L]|qwq[min(r-(1<<L)+1,n)][L];\n}\nlong long bs(int x)\n{\n    int l,r,ans1=x,ans2=x;\n    l=1,r=x-1;\n    while(l<=r)\n    {\n        int mid=(l+r)>>1;\n        if(query(mid,x-1)<a[x] && qwqry(mid,x)<=a[x]) ans1=mid,r=mid-1; else l=mid+1;\n    }\n    l=x+1,r=n;\n    while(l<=r)\n    {\n        int mid=(l+r)>>1;\n        if(query(x+1,mid)<=a[x] && qwqry(x,mid)<=a[x]) ans2=mid,l=mid+1; else r=mid-1;\n    }\n    return (ans2-x+1)*(x-ans1+1);\n}\nsigned main()\n{\n    for(int i=1; i<=n; i++) a[i]=read();\n    for(int i=n; i>=1; i--) init(i);\n    long long ans=1LL*n*(n+1LL)/2LL;\n    for(int i=1; i<=n; i++) ans-=bs(i);\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1597323586,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF875D \u3010High Cry\u3011"
    },
    {
        "content": "\u53d1\u73b0\u9898\u89e3\u533a\u91cc\u6709\u4e8c\u5206 + ST \u8868 $O(N\\log^2N)$ \u7684\uff0c\u4f46\u662f\u4ed4\u7ec6\u4e00\u601d\u91cf\uff0c\u53d1\u73b0\u5982\u679c\u4e0d\u7528 $O(1)$ \u7684\u65b9\u6cd5\u8df3\u800c\u7528 $O(\\log n)$ \u7684\u65b9\u6cd5\u8df3\uff0c\u8fd9\u6837\u53ef\u4ee5\u7701\u6389\u4e00\u4e2a\u4e8c\u5206\uff0c\u6700\u540e\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u4e00\u6837\u7684\u4e14\u4ee3\u7801\u8c8c\u4f3c\u66f4\u53ef\u89c2\u4e00\u70b9\u3002(\u4e2a\u4eba\u611f\u89c9\u3002)\n\n\u5927\u4f53\u601d\u8def\u4e0e\u9898\u89e3\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u8fc7\u6211\u4eec\u662f\u66b4\u529b\u679a\u4e3e\u6700\u5c0f\u503c\uff0c\u7136\u540e ST \u8868\u627e\u7aef\u70b9\u3002\n\n\u6240\u4ee5\u5c31\u8fc7\u6765\u6c34\u4e00\u53d1\u9898\u89e3\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+5;\nll ans;\nint mx[N][19],st[N][19],n,a[N];\nvoid init(){\n\tfor(int j=1;j<=18;++j)\n\t\tfor(int i=1;i+(1<<j)-1<=n;++i){\n\t\t\tmx[i][j]=max(mx[i][j-1],mx[i+(1<<j-1)][j-1]);\n\t\t\tst[i][j]=st[i][j-1]|st[i+(1<<j-1)][j-1];\n\t\t}\n}\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;++i){\n\t\tcin>>a[i];\n\t\tmx[i][0]=st[i][0]=a[i]; \n\t}\n\tinit();\n\tfor(int i=1;i<=n;++i){\n\t\tint l1=i,l2=i,r1=i,r2=i;\n        //\u66b4\u529b\u679a\u4e3e\u6bcf\u4e2a\u70b9\u4e3a\u6700\u5c0f\u503c\u3002\n\t\tfor(int j=18;j>=0;--j)\n\t\t\tif(l1>(1<<j)&&mx[l1-(1<<j)][j]<a[i])l1-=(1<<j);\n\t\tfor(int j=18;j>=0;--j)\n\t\t\tif(r1+(1<<j)<=n&&mx[r1+1][j]<=a[i])r1+=(1<<j);\n\t\tfor(int j=18;j>=0;--j)\n\t\t\tif(l2>(1<<j) && (a[i]|st[l2-(1<<j)][j])==a[i])l2-=(1<<j);\n\t\t--l2;\n\t\tfor(int j=18;j>=0;--j)\n\t\t\tif(r2+(1<<j)<=n && (st[r2+1][j]|a[i])==a[i]) r2+=(1<<j);\n\t\t++r2;\n\t\tif(l2>=l1)ans+=1ll*(l2-l1+1)*(r1-i+1);\n\t\tif(r1>=r2)ans+=1ll*(i-l1+1)*(r1-r2+1);\n\t\tif(l2>=l1 && r1>=r2)ans-=1ll*(l2-l1+1)*(r1-r2+1);\n\t}\n\tcout<<ans<<endl;\n\treturn(0-0);\n}\n```\n",
        "postTime": 1667830537,
        "uid": 388414,
        "name": "comcopy",
        "ccfLevel": 0,
        "title": "CF875D \u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\u53ef\u4ee5\u679a\u4e3e\u6700\u5927\u503c\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $a_{i}$ \u6c42\u51fa\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4e0b\u6807\u548c\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4e0b\u6807 $l_1$ \u548c $r_1$\uff0c\u518d\u6c42\u51fa\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u548c\u5b83\u4ea6\u6216\u540e\u7684\u503c\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4e0b\u6807\u548c\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u548c\u5b83\u4ea6\u6216\u540e\u7684\u503c\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4e0b\u6807 $l_2$ \u548c $r_2$\u3002\n\n\u5373\u6c42\u6700\u5927\u7684\u533a\u95f4 $\\left ( l_1, r_1 \\right ) $ \u4f7f\u5f97 $\\max_{j\\in \\left ( l_1, r_1 \\right )} a_{j} = a_i$\u3002\n\n\u518d\u6c42\u6700\u5927\u7684\u533a\u95f4 $\\left ( l_2, r_2 \\right ) $ \u4f7f\u5f97 $a_{l_2+1}\\operatorname{or}a_{l_2+2}\\operatorname{or}...\\operatorname{or}a_{r_2-1} = a_i$\u3002\n\n## \u8ba1\u7b97\u7b54\u6848\uff08**\u5bb9\u65a5**\uff09\n\n\u5de6\u7aef\u70b9\u5728 $\\left ( l_1, l_2 \\right ] $ \u5185\uff0c\u8fd9\u65f6\u53f3\u7aef\u70b9\u53ef\u4ee5\u53d6 $\\left [ i, r_1 \\right ) $\u3002\n\n\u53f3\u7aef\u70b9\u5728 $\\left [ r_2, r_1 \\right ) $ \u5185\uff0c\u8fd9\u65f6\u5de6\u7aef\u70b9\u53ef\u4ee5\u53d6 $\\left ( l_1, i \\right ]$\u3002\n\n\u5de6\u7aef\u70b9\u5728 $\\left ( l_1, l_2 \\right ] $ \u5185\uff0c\u53f3\u7aef\u70b9\u5728 $\\left [ r_2, r_1 \\right ) $ \u5185\uff0c\u4f1a\u91cd\u590d\u7b97\u51cf\u53bb\u3002\n\n\u6700\u540e\u8981\u6ce8\u610f\u4e00\u4e2a\u533a\u95f4\u5185\u591a\u4e2a\u6700\u5927\u503c\u7684\u60c5\u51b5\uff0c\u5728\u591a\u4e2a\u6700\u5927\u503c\u4e2d\u53ea\u7b97\u6700\u5de6\u8fb9\u7684\u5c31\u53ef\u4ee5\u4e86\u3002\n\n------------\n\u6700\u540e\u4ee3\u7801\u3002\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint a[200003],st[200003][23],b[200003][23],n;\ninline void init(int l) {\n\tst[l][0]=a[l],b[l][0]=a[l];\n\tfor(int i=1; i<=20; i++)\n\t\tst[l][i]=max(st[l][i-1],st[min(l+(1<<(i-1)),n)][i-1]),\n\t\t         b[l][i]=b[l][i-1]|b[min(l+(1<<(i-1)),n)][i-1];\n}\ninline int rmq1(int l,int r) {\n\tint L=log(r-l+1)/log(2);\n\treturn max(st[l][L],st[min(r-(1<<L)+1,n)][L]);\n}\ninline int rmq2(int l,int r) {\n\tint L=log(r-l+1)/log(2);\n\treturn b[l][L]|b[min(r-(1<<L)+1,n)][L];\n}\nlong long bs(int x) {\n\tint l,r,ans1=x,ans2=x;\n\tl=1,r=x-1;\n\twhile(l<=r) {\n\t\tint mid=(l+r)>>1;\n\t\tif(rmq1(mid,x-1)<a[x] && rmq2(mid,x)<=a[x]) ans1=mid,r=mid-1;\n\t\telse l=mid+1;\n\t}\n\tl=x+1,r=n;\n\twhile(l<=r) {\n\t\tint mid=(l+r)>>1;\n\t\tif(rmq1(x+1,mid)<=a[x] && rmq2(x,mid)<=a[x]) ans2=mid,l=mid+1;\n\t\telse r=mid-1;\n\t}\n\treturn (ans2-x+1)*(x-ans1+1);\n}\nsigned main() {\n\tscanf(\"%d\",&n);\n\tfor(int i=1; i<=n; i++) scanf(\"%d\",&a[i]);\n\tfor(int i=n; i>=1; i--) init(i);\n\tlong long ans=1LL*n*(n+1LL)/2LL;\n\tfor(int i=1; i<=n; i++) ans-=bs(i);\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n\u6c42 $l_1,r_1,l_2,r_2$ \u7528 **ST \u8868**\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\n\u8fd8\u6709 $l_1$ \u548c $r_1$ \u53ef\u4ee5\u7528**\u5355\u8c03\u6808** $O(n)$ \u9884\u5904\u7406\uff0c\u4f1a\u5feb\u4e00\u70b9\u70b9\u3002",
        "postTime": 1667825144,
        "uid": 367677,
        "name": "lyt_awa",
        "ccfLevel": 5,
        "title": "CF875D High Cry\u9898\u89e3"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\u3002\n\n\u9700\u8981\u6c42\u533a\u95f4\u6700\u5927\u503c\u5c0f\u4e8e\u533a\u95f4\u6216\u7684\u533a\u95f4\u4e2a\u6570\u3002\n\n\u6211\u4eec\u9700\u8981\u5148\u9884\u5904\u7406st\u8868\u4f7f\u5f97\u80fd\u591f$\\rm O(1)$\u6c42\u51fa\u533a\u95f4\u6216\u548c\u533a\u95f4\u6700\u5927\u503c\u3002\n\n\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u4e0a\u6781\u503c\u5206\u6cbb\uff0c\u4ee5\u533a\u95f4\u6700\u5927\u503c\u6240\u5728\u7684\u4f4d\u7f6e\u4e3a\u5206\u6cbb\u4e2d\u70b9\uff0c\u679a\u4e3e\u8f83\u5c0f\u4e00\u6bb5\u7684\u7aef\u70b9\uff0c\u53e6\u4e00\u4e2a\u7aef\u70b9\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u6c42\u5f97\u3002\n\n\u7531\u4e8e\u6781\u503c\u5206\u6cbb\u7684\u590d\u6742\u5ea6\u4e5f\u662f$\\rm O(N\\log N)$\uff0c\u7b97\u4e0a\u4e8c\u5206\u603b\u590d\u6742\u5ea6\u4e3a$\\rm O(N\\log^2 N)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 200005\nusing namespace std;\nint cur,n,a[N],f[N][18],g[N][18],t,bt[N];long long ed;\ninline int ck(int x,int y){return a[x]>a[y]?x:y;}\ninline int ask(int l,int r){\n\tcur=bt[r-l+1];\n\treturn ck(f[l][cur],f[r-(1<<cur)+1][cur]);\n}\ninline int get(int l,int r){\n\tcur=bt[r-l+1];\n\treturn g[l][cur]|g[r-(1<<cur)+1][cur];\n}\nvoid calc(int l,int r){\n\tif(l>=r)return;\n\tint mid=ask(l,r);\n\tcalc(l,mid-1);calc(mid+1,r);\n\tint lim=a[mid];\n\tif(mid<=((l+r)>>1)){\n\t\trep(i,l,mid){\n\t\t\tint L=mid,R=r,ans=r+1;\n\t\t\twhile(L<=R){\n\t\t\t\tint cur=(L+R)>>1;\n\t\t\t\tif(get(i,cur)>lim)ans=cur,R=cur-1;\n\t\t\t\telse L=cur+1;\n\t\t\t}\n\t\t\ted+=r+1-ans;\n\t\t}\n\t}\n\telse{\n\t\trep(i,mid,r){\n\t\t\tint L=l,R=mid,ans=l-1;\n\t\t\twhile(L<=R){\n\t\t\t\tint cur=(L+R)>>1;\n\t\t\t\tif(get(cur,i)>lim)ans=cur,L=cur+1;\n\t\t\t\telse R=cur-1;\n\t\t\t}\n\t\t\ted+=ans-l+1;\n\t\t}\n\t}\n}\nint main(){\n\tscanf(\"%d\",&n);t=log2(n);bt[0]=-1;\n\trep(i,1,n)bt[i]=bt[i>>1]+1;\n\trep(i,1,n)scanf(\"%d\",&a[i]),g[i][0]=a[i],f[i][0]=i;\n\trep(j,1,t)rep(i,1,n-(1<<j)+1)f[i][j]=ck(f[i][j-1],f[i+(1<<(j-1))][j-1]),g[i][j]=g[i][j-1]|g[i+(1<<(j-1))][j-1];\n\tcalc(1,n);printf(\"%lld\\n\",ed);return 0;\n}\n```",
        "postTime": 1616319186,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "CF875D High Cry\u9898\u89e3"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\r\n\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u5217 $a_i$\uff0c\u6c42\u6ee1\u8db3\u533a\u95f4\u6216 $>$ \u533a\u95f4\u6700\u5927\u503c\u7684\u533a\u95f4\u4e2a\u6570\u3002\r\n# \u601d\u8def\r\n\u770b\u5230\u9898\u76ee\u540e\u6ca1\u6709\u601d\u8def\uff0c\u90a3\u5c31\u4ece\u6700\u66b4\u529b\u7684\u65b9\u5f0f\u5f00\u59cb\uff0c\u518d\u7ee7\u7eed\u4f18\u5316\u3002\r\n## \u65b9\u6848\u4e00\r\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u533a\u95f4\uff0c\u518d\u5206\u522b\u6c42\u51fa\u533a\u95f4\u6700\u5927\u503c\u548c\u533a\u95f4\u6700\u5927\u6216\uff0c\u5982\u679c\u8be5\u533a\u95f4\u5408\u6cd5\u5c31\u5c06\u7b54\u6848\u52a0\u4e00\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u7b97\u90fd\u4e0d\u7528\u7b97\uff0c\u80af\u5b9a\u8d85\u65f6\u3002\r\n## \u65b9\u6848\u4e8c\r\n\u4e0d\u96be\u770b\u51fa\uff0c\u65b9\u6848\u4e00\u4e2d\u6709\u5927\u90e8\u5206\u65f6\u95f4\u6d6a\u8d39\u5728\u8ba1\u7b97\u533a\u95f4\u6700\u5927\u503c\u548c\u533a\u95f4\u6700\u5927\u6216\u4e0a\uff0c\u56e0\u4e3a\u6700\u5927\u503c\u548c\u6700\u5927\u6216\u7684\u8ba1\u7b97\u90fd\u6709\u53ef\u91cd\u590d\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ST \u8868\u6765\u4f18\u5316\u641c\u7d22\u533a\u95f4\u6700\u5927\u503c\u548c\u533a\u95f4\u6700\u5927\u6216\u3002\u6b64\u65f6\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u770b\u4e86\u4e00\u773c\u6570\u636e\u8303\u56f4\uff0c\u8fd8\u662f\u4f1a\u65f6\u95f4\u8d85\u9650\u3002\r\n## \u65b9\u6848\u4e09\r\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u533a\u95f4\u663e\u7136\u6548\u7387\u592a\u4f4e\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u533a\u95f4\u6700\u5927\u503c\uff0c\u7136\u540e\u627e\u5230\u5b83\u524d\u9762\u6700\u540e\u4e00\u4e2a\u4e0d\u5927\u4e8e\u5b83\u7684\u6570\uff0c\u4e0b\u6807\u8bb0\u4e3a $l _ 1$\uff0c\u518d\u627e\u5230\u5b83\u524d\u9762\u7b2c\u4e00\u4e2a\u62e5\u6709\u5b83\u6ca1\u6709\u7684\u4e8c\u8fdb\u5236\u4f4d\u7684\u6570\uff0c\u4e0b\u6807\u8bb0\u4e3a $l _ 2$\uff0c$r _ 1$ \u548c $r _ 2$ \u540c\u7406\u3002\r\n\r\n\u6240\u4ee5\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u533a\u95f4\u6570\u7b49\u4e8e\u524d\u9762\u7684\u6570\u7684\u4e2a\u6570\u4e58\u4e0a\u540e\u9762\u7684\u6570\u7684\u4e2a\u6570\uff0c\u7136\u540e\u5728 $l _ 1$\u3001$l _ 2$ \u4e4b\u95f4\u548c $r _ 1$\u3001$r _ 2$ \u4e4b\u95f4\u7684\u90e8\u5206\u8981\u53bb\u91cd\uff0c\u8fd9\u6837\u4ece $1$ \u5230 $n$ \u4f9d\u6b21\u679a\u4e3e\u8fc7\u6765\u5c31\u80fd\u5f97\u5230\u7b54\u6848\u3002\r\n\r\n\u63a8\u5bfc\u516c\u5f0f\u5982\u4e0b\uff0c\u5c06\u4e0b\u6807\u4e3a $i$ \u65f6\u7684\u5408\u6cd5\u533a\u95f4\u6570\u8bb0\u4e3a $a_i$\uff0c\u6ce8\u610f\u53bb\u6389\u91cd\u590d\u7684\u90e8\u5206\uff1a\r\n\r\n$\\left\\{\\begin{matrix}\r\na_i=a_i+(l2-l1+1)\\times(r1-i+1)\\left ( l1<l2 \\right )  \r\n \\\\\r\na_i=a_i+(i-l1+1)\\times(r1-r2+1)\\left ( r2<r1 \\right ) \r\n \\\\\r\na_i=a_i-(l2-l1+1)\\times (r1-r2+1)\\left ( r1<l2,l1<l2 \\right ) \r\n\\end{matrix}\\right.$\r\n\r\n\u5728\u5bfb\u627e\u8fd9\u4e9b\u6570\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u500d\u589e ST \u8868\u4f18\u5316\uff0c\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u5230\u4e86 $O(n\\log n)$\uff0c\u5c31\u80fd\u8fc7\u6389\u8fd9\u9053\u9898\u4e86\uff0c\u4ee3\u7801\u4e5f\u975e\u5e38\u7b80\u77ed\u3002\r\n# \u4ee3\u7801\r\n```\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\nconst int N=2e5+5;\r\nint n,a[N],st[N][20][2];\r\nlong long ans;\r\nvoid init(){\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tst[i][0][0]=st[i][0][1]=a[i];\r\n\t}\r\n\tfor(int j=1;1<<j<=n;j++){\r\n\t\tfor(int i=1;i+(1<<j)-1<=n;i++){\r\n\t\t\tst[i][j][0]=max(st[i][j-1][0],st[i+(1<<j-1)][j-1][0]);\r\n\t\t\tst[i][j][1]=st[i][j-1][1]|st[i+(1<<j-1)][j-1][1];\r\n\t\t}\r\n\t}\r\n}\r\nint main(){\r\n\tscanf(\"%d\",&n);\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tscanf(\"%d\",&a[i]);\r\n\t}\r\n\tinit();\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tint l1=i,l2=i,r1=i,r2=i;\r\n\t\tfor(int j=18;j>=0;j--){\r\n\t\t\tif(l1>(1<<j)&&st[l1-(1<<j)][j][0]<a[i])l1-=1<<j;\r\n\t\t}\r\n\t\tfor(int j=18;j>=0;j--){\r\n\t\t\tif(r1+(1<<j)<=n&&st[r1+1][j][0]<=a[i])r1+=1<<j;\r\n\t\t}\r\n\t\tfor(int j=18;j>=0;j--){\r\n\t\t\tif(l2>(1<<j)&&(a[i]|st[l2-(1<<j)][j][1])==a[i])l2-=1<<j;\r\n\t\t}\r\n\t\tl2--;\r\n\t\tfor(int j=18;j>=0;j--){\r\n\t\t\tif(r2+(1<<j)<=n&&(a[i]|st[r2+1][j][1])==a[i])r2+=1<<j;\r\n\t\t}\r\n\t\tr2++;\r\n\t\tif(l2>=l1)ans+=1ll*(l2-l1+1)*(r1-i+1);\r\n\t\tif(r1>=r2)ans+=1ll*(i-l1+1)*(r1-r2+1);\r\n\t\tif(l2>=l1&&r1>=r2)ans-=1ll*(l2-l1+1)*(r1-r2+1);\r\n\t}\r\n\tprintf(\"%lld\",ans);\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1667916953,
        "uid": 698657,
        "name": "free_fall",
        "ccfLevel": 5,
        "title": "High Cry \u9898\u89e3"
    },
    {
        "content": "[$\\tt Link$](/problem/CF875D)\u3002\n\n\u9996\u5148\u5b83\u662f\u7edf\u8ba1\u533a\u95f4\u9898\uff0c\u7136\u540e\u4f60\u5c31\u5e38\u89c4\u5957\u8def\uff1a\u679a\u4e3e\u4e00\u4e2a\u70b9\uff0c\u5728\u8ba1\u7b97\u7279\u5b9a\u5305\u542b\u6b64\u70b9\u7684\u533a\u95f4\u7684\u7b54\u6848\uff08\u6ce8\u610f\u4f60\u4e0d\u80fd\u6570\u91cd\uff09\u3002\n\n\u8fd9\u4e2a\u9898\u6b63\u597d\u591a\u65b9\u9762\u5730\u7b26\u5408\u6211\u4eec\u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u5982\u679c\u4ece\u5df2\u77e5\u533a\u95f4\u5411\u5916\u62d3\u5c55\uff0c$\\max$ \u548c $\\operatorname{or}$ \u503c\u4e5f\u53ea\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $i$\uff0c\u6211\u4eec\u6839\u636e $\\max$ \u8fd9\u4e2a\u9650\u5236\u627e\u5230\u6700\u5927\u503c\u662f\u5b83\u7684\u6700\u957f\u533a\u95f4\uff0c\u7136\u540e\u518d\u627e\u5230 $\\operatorname{or}$ \u503c\u4e5f\u662f\u5b83\u7684\u6700\u957f\u533a\u95f4\uff0c\u7136\u540e\u7b97\u7b97\u7b54\u6848\u5c31\u884c\u4e86\u3002\n\n\u6bd4\u5982\u8bf4\u5411\u5916\u62d3\u5c55\uff0c\u4f7f\u5f97 $\\max{a_{l\\cdots r}}=a_i,\\operatorname{or}a_{L\\cdots R}=a_i$\u3002\n\n\u7136\u540e\u8ba8\u8bba\u51e0\u79cd\u7b54\u6848\u533a\u95f4\u3002\n\n+ \u5de6\u7aef\u70b9\u5728 $[l,L)$ \u5185\uff0c\u8fd9\u65f6\u53f3\u7aef\u70b9\u53ef\u4ee5\u53d6 $[i,r]$\u3002\n+ \u53f3\u7aef\u70b9\u5728 $(R,r]$ \u5185\uff0c\u8fd9\u65f6\u5de6\u7aef\u70b9\u53ef\u4ee5\u53d6 $[l,i]$\u3002\n+ \u5de6\u7aef\u70b9\u5728 $[l,L)$ \u5185\uff0c\u53f3\u7aef\u70b9\u5728 $(R,r]$ \u5185\uff0c\u7b97\u91cd\u4e86\u51cf\u53bb\u3002\n\n\u4ece\u67d0\u79cd\u610f\u4e49\u4e0a\u6765\u8bf4\u50cf\u4e00\u4e2a\u5bb9\u65a5\u3002\n\n---\n\n\u7136\u540e\u6302\u7b2c\u5341\u4e2a\u70b9\u3002\n\n\u7136\u540e\u8c03\uff0c\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u7b49\u4e8e\u6700\u5927\u503c\u7684\u6570\u6709\u4e24\u4e2a\uff0c\u6211\u7684\u679a\u4e3e\u533a\u95f4\u90e8\u5206\u5c31\u4f1a\u51fa\u73b0\u6570\u91cd\u6216\u6570\u6f0f\u7684\u60c5\u51b5\u3002\n\n\u6240\u4ee5\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u6709\u591a\u4e2a\u6700\u5927\u503c\uff0c\u6211\u4eec\u5728\u679a\u4e3e\u6700\u5de6\u8fb9\u90a3\u4e2a\u7684\u65f6\u5019\u7edf\u8ba1\u3002\n\n\u4ee3\u7801\u771f\u7684\u77ed\u800c\u96be\u5199\uff0c\u4f46\u662f\u8bfb\u8d77\u6765\u6bd4\u8f83\u901a\u4fd7\u6613\u61c2\u3002\n\n```cpp\nconst int N = 2e5 + 5;\n\nint n,a[N],nx[N],pv[N],st[N],tp;\nint b[32][N],len[32];\n\nint main(){\n\tscanf(\"%d\",&n);\n\trep(i,1,n) scanf(\"%d\",a + i);\n\tst[tp = 0] = n + 1;\n\trep(i,n,1){\n\t\twhile(tp && a[st[tp]] < a[i]) --tp;\n\t\tnx[i] = st[tp],st[++tp] = i;\n\t}\n\tst[tp = 0] = 0;\n\trep(i,1,n){\n\t\twhile(tp && a[st[tp]] <= a[i]) --tp;\n\t\tpv[i] = st[tp],st[++tp] = i;\n\t}\n\trep(d,0,31) rep(i,1,n) if(a[i] >> d & 1) b[d][++len[d]] = i;\n\trep(d,0,31) b[d][len[d] + 1] = n + 1;\n\tlong long ans = 0;\n\trep(i,1,n){\n\t\tint l = pv[i] + 1,r = nx[i] - 1,L = 1,R = n;\n\t\trep(d,0,31) if(!(a[i] >> d & 1)){\n\t\t\tint *_ = lower_bound(b[d] + 1,b[d] + len[d] + 1,i);\n\t\t\tL = max(L,*prev(_) + 1); R = min(R,*_ - 1);\n\t\t}\n\t\tif(l < L) ans += 1LL * (L - l) * (r - i + 1);\n\t\tif(R < r) ans += 1LL * (r - R) * (i - l + 1);\n\t\tif(l < L && R < r) ans -= 1LL * (L - l) * (r - R);\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1661772021,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "CF875D"
    },
    {
        "content": "\u4e8b\u5b9e\u4e0a\u6ca1\u5fc5\u8981\u50cf\u53e6\u4e00\u7bc7\u9898\u89e3\u4e00\u6837\u500d\u589e\u7684\n\n\u6211\u4eec\u9884\u5904\u7406\u51fa$l_i$,$r_i$\u5206\u522b\u8868\u793a\u7b2ci\u4e2a\u6570\u5de6\u8fb9\u6216\u53f3\u8fb9\u503c\u6bd4\u5b83\u5927 \u7684\u6700\u8fd1\u7684\u6570\u7684\u4f4d\u7f6e\n\n\u90a3\u4e48 [$l_i+1,r_i-1$]\u5c31\u662fi\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\n\n\u8fd9\u4e2a\u73c2\u4ee5\u7528\u5355\u8c03\u6808\u6c42\u51faqwq\n\n\u7136\u540e\u4e00\u4e2a\u4f4d\u7f6ei,\u6211\u4eec\u5b9a\u4e49 $lx_i$ \u4e3a\u5728$i$\u5de6\u8fb9\uff0c\u79bb$i$\u6700\u8fd1\u7684\u6570\u7684\u4f4d\u7f6e\u4f7f\u5f97 $a_i$ $or$ $a_{lx_i} > a_i$\n\n\u540c\u7406\u5b9a\u4e49$rx_i$ \u4e3a\u5728$i$\u53f3\u8fb9\uff0c\u79bb$i$\u6700\u8fd1\u7684\u6570\u7684\u4f4d\u7f6e\u4f7f\u5f97 $a_i$ $or$ $a_{lx_i} > a_i$\n\n\uff08\u6ce8\uff0c\u4ee5\u4e0a\u6700\u8fd1\u6307\u4f4d\u7f6e\u6700\u8fd1\uff09\n\n\u6c42\u6cd5\u5f88\u7b80\u5355\uff0c\u5982\u6c42$lx_i$\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e$a_i$\u7684\u6bcf\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4e3a0\u7684\u4f4d\u7f6e\uff0c\u6c42\u51fa\u524d\u9762\u6700\u8fd1\u7684\u4e00\u4e2a\u6570\uff0c\u4f7f\u5f97\u8fd9\u4e00\u4f4d\u4e3a1\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4f4d\u6c42\u51fa\u7684\u8fd9\u6837\u7684\u6570\u53d6\u51famax\u5373\u53ef\u3002\u6c42$rx_i$\u65b9\u6cd5\u7c7b\u4f3c\n\n\u4e4b\u540e\u5c31\u662f\u6c42\u503c\u4e86\n\n\u4e00\u4e2a\u6700\u5927\u503c\u662f$a_i$\u533a\u95f4$[l,r]$\u5408\u6cd5\uff0c\u5f53\u4e14\u4ec5\u5f53$l_i <= l <=lx_i$\u6216$rx_i <= r <=r_i$\n\n\u8fd9\u6837\u5bb9\u65a5\u4e00\u4e0b\u6c42\u89e3\u5c31\u884c\u4e86\n\n\u5177\u4f53\u53ef\u4ee5\u89c1\u4ee3\u7801\n```\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define MAXN 200005\n#define pii pair<int,int>\n#define fs first\n#define sd second\n#define mp make_pair\n#define INF 0x3f3f3f3f\n#define int long long\n\nint n,m,ans;\nint a[MAXN];\nint l[MAXN],r[MAXN];\nint t[MAXN];\nint lx[MAXN],rx[MAXN];\nstack< pii >s;\n\nvoid rd() {\n\tcin >> n;\n\tfor(int i = 1; i <= n; i ++) \n\t\tcin >> a[i]; \n}\n\nvoid ql()\n{\n\tfor(int i = 1; i <= n; i ++) {\n\t\twhile(!s.empty() && a[i] > s.top().fs)\n\t\t\ts.pop();\n\t\tif(!s.empty()) l[i] = s.top().sd;\n\t\ts.push( mp(a[i],i) );\n\t}\n\twhile(!s.empty()) s.pop();\n\t\n\tfor(int i = n; i >= 1; i --) {\n\t\twhile(!s.empty() && a[i] >= s.top().fs) s.pop();\n\t\tif(!s.empty()) r[i] = s.top().sd;\n\t\telse r[i] = n+1;\n\t\ts.push( mp(a[i],i) ); \n\t}\n}\n\nsigned main()\n{\n\trd();\n\tql();\n\tfor(int i = 1; i <= n; i ++)\n\t{\n\t\tlx[i] = 0;\n\t\tfor(int j = 0; j <= 30; j ++) {\n\t\t\tif(a[i]&(1<<j)) {\n\t\t\t\tt[j] = i;\n\t\t\t} else\n\t\t\tlx[i] = max(lx[i],t[j]);\n\t\t} \n\t}\n\tfor(int i = 0; i <= 30; i ++)\n\t\tt[i] = n+1;\n\tfor(int i = n; i >= 1; i --) {\n\t\trx[i] = INF;\n\t\tfor(int j = 0; j <= 30; j ++) {\n\t\t\tif(a[i]&(1<<j)) \n\t\t\t\tt[j] = i;\n\t\t\telse  rx[i] = min(rx[i],t[j]);\n\t\t} \n\t}\n\tfor(int i = 1; i <= n; i ++) { \n\t\tif(r[i] >= rx[i]) ans += (i - l[i]) * (r[i] - rx[i]);\n\t\tif(lx[i] >= l[i])\tans += (lx[i] - l[i]) * (r[i] - i);\n\t\tif(r[i] >= rx[i] && lx[i] >= l[i])\tans -= (lx[i] - l[i]) * (r[i] - rx[i]);\n\t} \n\tcout<<ans<<\"\\n\";\n\treturn 0;\n}\n\n```\n\n\n\n",
        "postTime": 1562297285,
        "uid": 124721,
        "name": "Ynoi",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF875D \u3010High Cry\u3011"
    },
    {
        "content": "\u9996\u5148\u8f6c\u5316\u4e00\u4e0b\u6c42\u4e0d\u5408\u6cd5\u7684\u6570\u91cf\uff0c\u7136\u540e\u7528\u603b\u6570\u51cf\u53bb\u4e0d\u5408\u6cd5\u7684\u5c31\u662f\u7b54\u6848\u4e86\n\n\u8003\u8651\u7528\u5355\u8c03\u6808\u628a\u6bcf\u4e2a\u503c\u4f5c\u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4\u627e\u51fa\u6765\uff0c\u8bb0i\u7684\u5de6\u53f3\u8fb9\u754c\u4e3aL[i],R[i]\n\n\u6211\u4eec\u53ea\u9700\u8981\u6bd4\u8f83i-L[i]\u548cR[i]-i\u679a\u4e3e\u8f83\u77ed\u7684\u4e00\u6bb5\u5373\u53ef\uff0c\u8bb0\u679a\u4e3e\u7aef\u70b9\u4e3aj\n\n\u6ce8\u610f\u5230or\u7684\u548c\u662f\u5355\u8c03\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u4e00\u4e2a\u6700\u53f3\u7684\u4f4d\u7f6ek\uff0c\u4f7f\u5f97j\u4e0ek\u5728i\u7684\u4e24\u4fa7\uff0c\u4e14sum[j,k]<=a[i]\u3002\u7528\u7ebf\u6bb5\u6811\u6216\u8005\u4ec0\u4e48\u7684\u5c31\u53efnlog^2n\u7edf\u8ba1\u4e0d\u5408\u6cd5\u533a\u95f4\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e0a\u9762\u4e8c\u5206\u7684\u8fc7\u7a0b\u975e\u5e38\u6162\uff0c\u6539\u6210\u500d\u589e\u5c31\u53ef\u4ee5\u4e00\u4e2alog\u8fc7\u4e86\n\n\u9700\u8981\u6ce8\u610f\u76f8\u540c\u76f8\u90bb\u6570\u5b57\u7684L\u548cR\u600e\u4e48\u6c42\uff0c\u8fd9\u4e2a\u5355\u8c03\u6808\u7684\u65f6\u5019(\u52a0\u4e00\u4e2aor\u5220\u4e00\u4e2a)\u7b49\u53f7\u5c31\u884c\u4e86\n\n```cpp\n#include <stdio.h>\n#include <string.h>\n#define rep(i,st,ed) for (register int i=st;i<=ed;++i)\n#define drp(i,st,ed) for (register int i=st;i>=ed;--i)\n\ntypedef long long LL;\nconst int N=400005;\n\nint stack[N],a[N];\nint L[N],R[N];\nLL wjp[N][21],lzh[N][21];\n\nint read() {\n\tint x=0,v=1; char ch=getchar();\n\tfor (;ch<'0'||ch>'9';v=(ch=='-')?(-1):(v),ch=getchar());\n\tfor (;ch<='9'&&ch>='0';x=x*10+ch-'0',ch=getchar());\n\treturn x*v;\n}\n\nint main(void) {\n\t// freopen(\"data.in\",\"r\",stdin);\n\t// freopen(\"myp.out\",\"w\",stdout);\n\tint n=read();\n\trep(i,1,n) lzh[i][0]=wjp[i][0]=a[i]=read();\n\trep(j,1,18) {\n\t\trep(i,1,n) wjp[i][j]=wjp[i][j-1]|wjp[i+(1<<(j-1))][j-1];\n\t\tdrp(i,n,1) {\n\t\t\tlzh[i][j]=lzh[i][j-1];\n\t\t\tif (i>=(1<<(j-1))) lzh[i][j]|=lzh[i-(1<<(j-1))][j-1];\n\t\t}\n\t}\n\tfor (register int i=1,top=0;i<=n;++i) {\n\t\tfor (;top&&a[stack[top]]<=a[i];) top--;\n\t\tL[i]=stack[top]+1; stack[++top]=i;\n\t} stack[0]=n+1;\n\tfor (register int i=n,top=0;i>=1;--i) {\n\t\tfor (;top&&a[stack[top]]<a[i];) top--;\n\t\tR[i]=stack[top]-1; stack[++top]=i;\n\t}\n\tLL ans=0;\n\trep(i,1,n) if (i-L[i]<=R[i]-i) {\n\t\tfor (register int j=L[i];j<=i;++j) {\n\t\t\tLL ly=a[j]; int now=j;\n\t\t\tdrp(k,18,0) {\n\t\t\t\tif ((now+(1<<k)<=R[i])&&((ly|wjp[now+1][k])<=a[i])) {\n\t\t\t\t\tly|=wjp[now+1][k];\n\t\t\t\t\tnow+=(1<<k);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (now>=i&&now<=R[i]) ans+=now-i+1;\n\t\t}\n\t} else {\n\t\tfor (register int j=i;j<=R[i];++j) {\n\t\t\tLL ly=a[j]; int now=j;\n\t\t\tdrp(k,18,0) {\n\t\t\t\tif ((now-(1<<k)>=L[i])&&((ly|lzh[now-1][k])<=a[i])) {\n\t\t\t\t\tly|=lzh[now-1][k];\n\t\t\t\t\tnow-=(1<<k);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (now<=i&&now>=L[i]) ans+=i-now+1;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", 1LL*n*(n+1LL)/2LL-ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1537881977,
        "uid": 18867,
        "name": "jpwang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF875D \u3010High Cry\u3011"
    }
]