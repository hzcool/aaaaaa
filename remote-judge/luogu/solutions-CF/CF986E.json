[
    {
        "content": "\u600e\u4e48\u8bc4\u4ef7\u8fd9\u4e2a\u9898\u5462\u2026\u2026\u662f\u81ea\u5df1\u505a\u51fa\u6765\u4e86\uff0c\u4f46\u505a\u5b8c\u4e4b\u540e\u611f\u89c9\u65e0\u6cd5\u7406\u89e3\u81ea\u5df1\u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u6211\u662f DS \u83dc\u9e21\u561b\u2026\u2026\u60f3\u4e86\u4e00\u4f1a\u513f\u4e4b\u540e\uff0c\u6765\u5199\u4e86\u8fd9\u4e2a\u9898\u89e3\u3002\n\n---\n\n**[Portal]( https://www.luogu.com.cn/problem/CF986E )**\n\n\u8981\u5904\u7406 $\\gcd$\uff0c\u8003\u8651\u5206\u89e3\u8d28\u56e0\u6570\u3002\u7136\u540e\u94fe\u4e0a\u6bcf\u4e2a\u6570\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\u5b83\u6bcf\u4e2a\u8d28\u56e0\u5b50\u7684\u6b21\u6570\u4e0e $w$ \u7684\u8be5\u8d28\u56e0\u5b50\u7684\u6b21\u6570\u53d6\u4e2a $\\min$\u3002\n\n\u6211\u4eec\u8003\u8651\u6811\u5256\u3002\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u5230\u533a\u95f4\u4e0a\u3002\u6ce8\u610f\u5230\u4efb\u610f\u4e00\u4e2a\u6570\u7684\u8d28\u56e0\u5b50\u4e2a\u6570\u662f $\\mathrm O(\\log v)$ \u7ea7\u522b\u7684\uff0c\u90a3\u4e48\u76f4\u63a5\u679a\u4e3e $w$ \u7684\u6bcf\u4e2a\u8d28\u56e0\u5b50\u3002\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u4e3a\u5982\u4f55\u8ba1\u7b97\u4e00\u4e2a\u533a\u95f4\u4e0a\u67d0\u4e2a\u8d28\u56e0\u5b50\u7684\u6b21\u6570\u4eec\u4e0e\u7ed9\u5b9a\u6570\u7684 $\\min$ \u7684\u548c\u3002\u76f4\u63a5 DS \u7ef4\u62a4\u8c8c\u4f3c\u4e0d\u592a\u53ef\u505a\uff0c\u4f46\u6ce8\u610f\u5230\u6b21\u6570\u4e5f\u662f $\\mathrm O(\\log v)$ \u7ea7\u522b\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u679a\u4e3e\u6b21\u6570\u3002\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u4e3a\u5982\u4f55\u8ba1\u7b97\u4e00\u4e2a\u533a\u95f4\u4e0a\u67d0\u4e2a\u8d28\u56e0\u5b50\u6b21\u6570\u4e3a\u7ed9\u5b9a\u6570\u7684\u4e2a\u6570\u3002\u8fd9\u4e2a\u5c31\u6bd4\u8f83\u597d\u529e\u4e86\uff0c\u5728\u9884\u5904\u7406\u5206\u89e3\u8d28\u56e0\u6570\u7684\u65f6\u5019\uff0c\u628a\u8fd9\u4e9b\u8d28\u56e0\u5b50\u7684\u6b21\u6570\u538b\u5165\u8d28\u56e0\u5b50\u6240\u5bf9\u5e94\u7684 `vector`\uff0c\u6bcf\u4e2a `vector` \u8bb0\u5f55\u524d\u7f00\u548c\uff0c\u7136\u540e\u5728\u91cc\u9762\u4e8c\u5206\u3002\u7136\u540e\u8fd9\u4e2a\u4e8c\u5206\u64cd\u4f5c\u662f\u548c\u679a\u4e3e\u6b21\u6570\u5e73\u884c\u7684\uff0c\u6570\u4e00\u4e0b\u53d1\u73b0\u662f 3log\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u662f\u4e2a\u9759\u6001\u95ee\u9898\uff0c\u4e8e\u662f\u60f3\u5230\u6811\u4e0a\u524d\u7f00\u548c instead of \u6811\u5256\u3002\u4f9d\u7136\u679a\u4e3e $w$ \u7684\u8d28\u56e0\u5b50\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8d28\u56e0\u5b50\u4f9d\u7136\u679a\u4e3e\u6b21\u6570\uff08\u8fd9\u6837 $\\sum\\alpha$ \u4f9d\u7136\u662f 1log \u7ea7\u522b\u7684\uff0c\u524d\u9762\u867d\u7136\u4e5f\u6d89\u53ca\u5230\u8fd9\u4e2a $\\sum\\alpha$\uff0c\u4f46\u8fd8\u6709\u4e00\u4e2a\u4e8c\u5206\u5f3a\u5236\u589e\u52a0\u4e86\u4e00\u4e2a log\uff09\u3002\u4e8e\u662f\u6211\u4eec\u73b0\u5728\u60f3\u77e5\u9053\u7684\u662f\u4e00\u6761\u94fe\u4e0a\u67d0\u4e2a\u8d28\u56e0\u5b50\u6b21\u6570\u4e3a\u7ed9\u5b9a\u6570\u7684\u4e2a\u6570\u3002\u8003\u8651\u5bf9\u8fd9\u4e2a\u8fdb\u884c\u524d\u7f00\u548c\u3002\u4f46\u662f\u8981\u662f\u5728\u6811\u7684\u67d0\u5904\u90fd\u653e\u4e00\u4e2a\u524d\u7f00\u548c\u7684\u6570\u7ec4\u7684\u8bdd\uff0c\u90a3\u65f6\u7a7a\u90fd\u4f1a\u70b8\uff0c\u4f46\u662f\u6ce8\u610f\u5230\u8fd9\u662f\u6709\u53ef\u4f18\u5316\u6027\u7684\uff0c\u56e0\u4e3a\u603b\u5171\u66f4\u65b0\u524d\u7f00\u548c\u7684\u6b21\u6570\u662f\u4e0d\u4f1a\u70b8\u7684\uff0c\u70b8\u7684\u662f\u590d\u5236\u7c98\u8d34\u6570\u7ec4\u7684\u4ee3\u4ef7\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u60ef\u7528\u5957\u8def\uff1a\u5728 DFS \u7684\u8fc7\u7a0b\u4e2d\u5b9e\u65f6\u7ef4\u62a4\u524d\u7f00\u548c\u6570\u7ec4\uff0c\u8be5\u56de\u6eaf\u56de\u6eaf\uff0c\u8fd9\u4e2a\u7c7b\u4f3c\u4e8e\u626b\u63cf\u7ebf\u7684\u601d\u60f3\u3002\u7136\u540e\u5c06\u9700\u8981\u67e5\u8be2\u524d\u7f00\u548c\u7684\u5730\u65b9\u7ed9\u6807\u8bb0\u5230\u5bf9\u5e94\u8282\u70b9\u4e0a\uff0c\u5230\u65f6\u8d21\u732e\u7ed9\u76f8\u5e94\u8be2\u95ee\u3002\u8fd9\u6837\u5b50\u662f 1log \u7684\u3002\n\n\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u4e00\u4e9b\u5c0f\u7ec6\u8282\u3002\u5206\u89e3\u8d28\u56e0\u6570\u7684\u6839\u53f7\u590d\u6742\u5ea6\u8981\u7b97\u4e0a\u3002\u524d\u7f00\u548c\u7b97 lca \u9700\u8981\u6811\u4e0a\u500d\u589e\u3002\u8fd8\u8981\u628a\u8d28\u6570\u7b5b\u4e00\u4e0b\u6765\u7f29\u5c0f\u503c\u57df\uff0c\u4e0d\u7136\u6570\u7ec4\u5f00\u4e0d\u4e0b\u3002\u603b\u7684\u6765\u8bf4\u633a\u96be\u5199\u7684\u3002\n\n**_[code]( https://www.luogu.com.cn/paste/zzjv2jrs )_**",
        "postTime": 1606833075,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF986E \u3010Prince's Problem\u3011"
    },
    {
        "content": "## \u3010\u9898\u89e3\u3011CF986E Prince's Problem(\u6811\u4e0a\u5dee\u5206+\u6570\u8bba\u6027\u8d28)\n\n\u9898\u76ee\u5927\u610f\uff1a\n\n> \u7ed9\u5b9a\u4f60\u4e00\u68f5\u6811\uff0c\u6709\u70b9\u6743$val_i\\le 10^7$\u3002\u73b0\u5728\u6709$m$\u7ec4\u8be2\u95ee\u7ed9\u5b9a\u53c2\u6570$x,y,w$\u95ee\u4f60\u5bf9\u4e8e$(x->y)$\u7684\u8def\u5f84\u7ecf\u8fc7\u7684\u70b9\u96c6$P$\uff0c\u95ee\u4f60\u8fd9\u4e2a\u4e1c\u897f\uff1a\n> $$\n> \\prod_{u \\in P} {\\mathrm{gcd}(w,val_u)} \\mod 1000000007\n> $$\n\n\u8003\u8651\u8fd9\u6837\u4e00\u79cd\u505a\u6cd5\uff1a\n\n- \u628a\u8be2\u95ee\u5dee\u5206\u6210\n$$\n\tans(1,x) \\times ans(1,y) \\times \\mathrm{gcd}(w,val_{lca(x,y)})\\over ans(w,lca_{x,y})^2\n$$\n\t\u73b0\u5728\u5c31\u628a\u95ee\u9898\u8f6c\u6362\u4e3a\u4e86\u4ece\u6839\u5230\u8282\u70b9\u7684\u8be2\u95ee\u3002\u8003\u8651\u8fd9\u6837\u7136\u540e\u600e\u4e48\u505a\u3002\n\n- \u8003\u8651\u8fd9\u7c7b\u4ece\u6839\u51fa\u53d1\u5982\u4f55\u89e3\u51b3\uff0c\u76f4\u63a5\u904d\u5386\u6574\u68f5\u6811\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u5148\u5c06\u81ea\u5df1\u7684\u8d21\u732e\u52a0\u5165\u67d0\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u518d\u9012\u5f52\u5b50\u6811\uff0c\u6700\u540e\u56de\u6eaf\u65f6\u64a4\u56de\u8d21\u732e\u3002\u95ee\u9898\u5c31\u53d8\u4e3a\u5982\u4f55\u5feb\u901f\u6c42$\\prod \\mathrm{gcd}$\n\n- \u8003\u8651$gcd$\u7684\u672c\u8d28\u5c31\u662f\u5bf9\u4e8e\u8d28\u56e0\u5b50\u53d6$min$\u4e14\u6c42\u548c\uff0c\u800c\u4e14\u6211\u4eec\u77e5\u9053$1e7$\u4ee5\u5185\u7684\u8d28\u6570\u662f\u4e0d\u591a\u7684($5e6$\u5de6\u53f3)\uff0c\u6240\u4ee5\u76f4\u63a5\u5bf9\u4e8e\u6bcf\u4e2a\u8d28\u6570\u5f00\u4e00\u4e2a$vector$\u3002$vector_i$\u4e2d\u7684\u4e0b\u6807$j$\u8868\u793a\u552f\u4e00\u5206\u89e3\u540e$\\alpha(prime[i])=j$\u7684\u6811\u4e0a\u8282\u70b9\u6709\u591a\u5c11\u4e2a\u3002($\\alpha$\u662f\u552f\u4e00\u5206\u89e3\u540e\u7684\u6307\u6570)\u3002\u8003\u8651\u5230$\\sum \\alpha$\u5f88\u5c0f\u662f$\\log$\u7ea7\u522b\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u662f$O(1e7+(n+m)\\log 1e7)$\u7a7a\u95f4\u590d\u6742\u5ea6$O((n +q)\\log 1e7)$\n\n\u4e3b\u8981\u5c31\u662f\u6811\u4e0a\u5dee\u5206\uff0c\u8fd8\u6709\u5904\u7406$\\sum \\min\\{...\\}$\u7684\u65b9\u6cd5\u3002\n\n```cpp\n//@winlere\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<vector> \n#define inv(x) (ksm((x)%mod,mod-2))\n\nusing namespace std;  typedef long long ll;   \ninline int qr(){\n      register int ret=0,f=0;\n      register char c=getchar();\n      while(c<48||c>57)f|=c==45,c=getchar();\n      while(c>=48&&c<=57) ret=ret*10+c-48,c=getchar();\n      return f?-ret:ret;\n}\n\nconst int mod=1e9+7;\nint n,m;\ninline int ksm(const int&ba,const int&p){\n      int ret=1;\n      for(int t=p,b=ba%mod;t;t>>=1,b=1ll*b*b%mod)\n\t    if(t&1) ret=1ll*ret*b%mod;\n      return ret;\n}\n\nvector< vector<int> > s;\nnamespace PRE{\n      const int maxn=1e7+5;\n      int rank[maxn],usd[maxn],arc[maxn],Min[maxn];\n      vector<int> pr;\n      inline void pre(const int&n){\n\t    usd[1]=1; Min[1]=10;\n\t    for(int t=2;t<=n;++t){\n\t\t  if(!usd[t]) Min[t]=t,pr.push_back(t),rank[t]=pr.size(),arc[rank[t]]=t;\n\t\t  for(auto f:pr){\n\t\t\tif(1ll*f*t>n)break;\n\t\t\tusd[f*t]=1;\n\t\t\tMin[f*t]=f;\n\t\t\tif(t%f==0)break;\n\t\t  }\n\t    }\n\t    s.resize(pr.size()+1);\n      }\n}\n\nnamespace TREE{\n      const int maxn=1e5+5;\n      int d[maxn];\n      vector<int> e[maxn];\n      vector<int> q[maxn];\n      int W[maxn],ans[maxn],w[maxn];\n      inline void add(const int&fr,const int&to){\n\t    e[fr].push_back(to);\n\t    e[to].push_back(fr);\n      }\n      int son[maxn],top[maxn],r[maxn],siz[maxn];\n      void pre(const int&now,const int&last){\n\t    siz[now]=1;\n\t    r[now]=last;\n\t    d[now]=d[last]+1;\n\t    for(auto t:e[now])\n\t\t  if(t^last) {\n\t\t\tpre(t,now); siz[now]+=siz[t];\n\t\t\tif(siz[now]>siz[son[now]]) son[now]=t;\n\t\t  }\n      }\n      void qaq(const int&now,const int&last){\n\t    top[now]=last;\n\t    if(son[now]) qaq(son[now],last);\n\t    for(auto t:e[now])\n\t\t  if((t^r[now])&&(t^son[now]))\n\t\t\tqaq(t,t);\n      }\n      inline void init(const int&n){pre(1,0);qaq(1,0);}\n      inline int lca(int u,int v){\n\t    if(d[u]<d[v])swap(u,v);\n\t    while(top[u]^top[v]){\n\t\t  if(d[top[u]]<d[top[v]]) swap(u,v);\n\t\t  u=r[top[u]];\n\t    }\n\t    return d[u]<d[v]?u:v;\n      }\n      inline void addq(const int&x,const int&y,const int&id,const int&w){\n\t    ans[id]=1;\n\t    q[x].push_back(id);\n\t    q[y].push_back(id);\n\t    q[lca(x,y)].push_back(-id);\n\t    W[id]=w;\n      }\n}\n\nnamespace sol{\n      const int maxn=1e5+5;\n      using namespace TREE;\n      using PRE::rank;\n      using PRE::Min;\n      inline void add(const int&now,const int&tag){\n\t    //now \u662f\u8282\u70b9\u7f16\u53f7 tag \u662f\u64cd\u4f5c\u7c7b\u578b\n\t    int k=w[now],cnt=0;\n\t    static int a[23],p[23];\n\t    while(k>1){\n\t\t  int f=Min[k];\n\t\t  a[++cnt]=0;\n\t\t  p[cnt]=f;\n\t\t  while(k%f==0) k/=f,++a[cnt];\n\t    }\n\t    for(int t=1;t<=cnt;++t){\n\t\t  if(((int)s[rank[p[t]]].size())<=1+a[t])\n\t\t\ts[rank[p[t]]].resize(a[t]+2);\n\t\t  s[rank[p[t]]][a[t]]+=tag;\n\t    }\n      }\n      inline void que(const int&now,const int&id){\n\t    //now \u662f\u8be2\u95ee\u7f16\u53f7\n\t    int k=W[now>0?now:-now],cnt=0,ret=1;\n\t    static int a[23],p[23];\n\t    while(k>1){\n\t\t  int f=Min[k];\n\t\t  a[++cnt]=0;\n\t\t  p[cnt]=f;\n\t\t  while(k%f==0) k/=f,++a[cnt];\n\t    }\n\t    for(int t=1;t<=cnt;++t)\n\t\t  for(int i=1,ed=s[rank[p[t]]].size();i<ed;++i)\n\t\t\tret=1ll*ret*ksm(p[t],1ll*s[rank[p[t]]][i]*min(a[t],i)%(mod-1))%mod;\n\t    if(now<0)  ans[-now]=1ll*ans[-now]*inv(ret)%mod*inv(ret)%mod*__gcd(W[-now],w[id])%mod;\n\t    else  ans[now]=1ll*ans[now]*ret%mod;\n\t    \n      }\n      void dfs(const int&now,const int&last){\n\t    add(now,1);\n\t    for(auto t:q[now]) que(t,now);\n\t    for(auto t:e[now])\n\t\t  if(t^last) dfs(t,now);\n\t    add(now,-1);\n      }\n}\n\nint main(){\n      PRE::pre(1e7);\n      n=qr();\n      for(int t=2;t<=n;++t) TREE::add(qr(),qr());\n      for(int t=1;t<=n;++t) TREE::w[t]=qr();\n      TREE::init(n);\n      m=qr();\n      for(int t=1,t1,t2,t3;t<=m;++t) {\n\t    t1=qr(); t2=qr(); t3=qr();\n\t    TREE::addq(t1,t2,t,t3);\n      }\n      sol::dfs(1,0);\n      for(int t=1;t<=m;++t) printf(\"%d\\n\",TREE::ans[t]);\n      return 0;\n}\n\n\n```",
        "postTime": 1569306762,
        "uid": 113460,
        "name": "\u8c01\u662f\u9e3d\u738b",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF986E \u3010Prince's Problem\u3011"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://codeforces.ml/contest/986/problem/E)\n\n\u9898\u610f\uff1a\n\n\u6709\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u70b9\u4e0a\u6709\u70b9\u6743 $a_i$\uff0c$q$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa $u,v,w$\uff0c\u8981\u6c42\uff1a\n\n- $\\prod\\limits_{x\\in P(u,v)}\\operatorname{gcd}(a_x,w)$\n\n\u5176\u4e2d $P(u,v)$ \u4e3a $u$ \u5230 $v$ \u7684\u7b80\u5355\u8def\u5f84\u4e0a\u7ecf\u8fc7\u7684\u70b9\u7684\u96c6\u5408\u3002\n\n$n,q \\leq 10^5,a_i \\leq 10^7$\n\n\u663e\u7136\u672c\u9898\u9700\u8981\u5206\u89e3\u8d28\u56e0\u6570\uff0c\u4e0d\u59a8\u8bbe $w$ \u5206\u89e3\u8d28\u56e0\u6570\u5f97\u5230 $p_1^{f_1}\\times p_2^{f_2}\\times\\dots\\times p_k^{f_k}$\u3002\n\n\u6211\u4eec\u5bf9 $w$ \u7684\u6bcf\u4e2a\u8d28\u56e0\u5b50 $p_i$ \u8ba1\u7b97\u5bf9\u5e94\u7684\u8d21\u732e\uff0c\u5bf9\u4e8e\u94fe\u4e0a\u7684\u6bcf\u4e2a\u6570 $a_x$\uff0c\u5047\u8bbe\u5b83\u8d28\u56e0\u6570 $p_i$ \u7684\u6b21\u6570\u4e3a $g_i$\uff0c\u90a3\u4e48\u5b83\u7684\u8d21\u732e\u5c31\u662f $p_i^{\\min(f_i,g_i)}$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e $p_i$ \u7684\u6b21\u6570 $g_i$\uff0c\u5047\u8bbe $u\\to v$ \u7684\u8def\u5f84\u4e0a\u6709 $cnt$ \u4e2a $a_x$ \u4e2d $p_i$ \u7684\u6b21\u6570\u6070\u597d\u4e3a $g_i$\uff0c\u8fd9\u90e8\u5206\u7684\u7b54\u6848\u5e94\u4e3a $(p_i^{\\min(f_i,g_i)})^{cnt}$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u600e\u6837\u6c42\u8fd9\u4e2a $cnt$\uff0c\u5bf9 $a_i$ \u5206\u89e3\u8d28\u56e0\u6570\u5f97\u5230 $a_i=q_1^{h_1}\\times q_2^{h_2}\\times\\dots\\times q_l^{h_l}$\uff0c\u5c06\u6bcf\u4e2a $(q_i,h_i)$ \u770b\u4f5c\u4e00\u79cd\u201c\u989c\u8272\u201d\uff0c\u6bcf\u4e2a\u70b9\u4e0a\u6700\u591a\u6709 $7$ \u79cd\u989c\u8272\u3002\u90a3\u4e48\u9898\u76ee\u5c31\u8f6c\u5316\u4e3a\u6c42 $u$ \u5230 $v$ \u8def\u5f84\u4e0a\u6709\u67d0\u79cd\u201c\u989c\u8272\u201d\u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n\u8003\u8651\u7528\u6811\u5256\u628a\u539f\u533a\u95f4\u62c6\u6210 $\\log n$ \u4e2a\u5c0f\u533a\u95f4\uff0c\u7136\u540e\u7528\u4e3b\u5e2d\u6811\u7ef4\u62a4\u533a\u95f4\u5185\u503c\u4e3a $x$ \u7684\u6570\u7684\u4e2a\u6570\u5c31\u53ef\u4ee5\u6c42\u51fa $cnt$ \u7684\u503c\u3002\n\n\u7b97\u7b97\u590d\u6742\u5ea6\uff0c\u66b4\u529b\u679a\u4e3e $g_i$  \u7684\u5e38\u6570\u6700\u5927\u53ef\u4ee5\u8fbe\u5230\u4e3a $\\log_2(10^7)+\\log_3(10^7)+\\log_5(10^7)+\\log_7(10^7)+\\log_{11}(10^7)+\\log_{13}(10^7)$ \uff0c\u5927\u7ea6 $60$\uff0c\u6811\u5256+\u4e3b\u5e2d\u6811\u5404\u6709\u4e00\u4e2a $\\log$\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u662f $60q\\log^2n$\uff0c\u592a\u900a\u4e86\u3002\n\n\u53d1\u73b0\u672c\u9898\u5e76\u6ca1\u6709\u5f3a\u5236\u5728\u7ebf\uff0c\u6240\u4ee5\u53ef\u4ee5\u79bb\u7ebf\u5730\u53bb\u5b8c\u6210\u8def\u5f84\u4e0a\u6570\u989c\u8272\u8fd9\u4e00\u5de5\u4f5c\u3002\u8fd9\u73a9\u610f\u513f\u53ef\u4ee5\u5229\u7528\u6811\u4e0a\u5dee\u5206\u62c6\u4e3a $u,v,\\operatorname{lca}(u,v),fa_{\\operatorname{lca}(u,v)}$ \u56db\u4e2a\u90e8\u5206\uff0c\u6700\u7ec8\u7684 $cnt=cnt_u+cnt_v-cnt_{\\operatorname{lca}(u,v)}-cnt_{fa_{\\operatorname{lca}(u,v)}}$\u3002\n\n\u679a\u4e3e\u6bcf\u4e00\u79cd\u989c\u8272 $c$\uff0c\u7136\u540e\u4f9d\u6b21\u5904\u7406\u67e5\u8be2\u989c\u8272\u4e3a $c$ \u7684\u8be2\u95ee\u3002\u5047\u8bbe\u67d0\u4e2a\u70b9 $x$ \u62e5\u6709\u989c\u8272 $c$\uff0c\u90a3\u4e48\u5b83\u4f1a\u5bf9 $x$ \u7684\u5b50\u6811\u5185\u7684\u8be2\u95ee\u4ea7\u751f $1$ \u7684\u8d21\u732e\uff0c\u5229\u7528 DFS \u5e8f\u5c06\u5b50\u6811\u53d8\u4e3a DFS \u5e8f\u4e0a\u7684\u4e00\u4e2a\u533a\u95f4\uff0c\u4e8e\u662f\u672c\u9898\u5c31\u53d8\u4e3a\u533a\u95f4\u52a0\u3001\u5355\u70b9\u67e5\u8be2\u7684\u95ee\u9898\uff0c\u4e00\u4e2a\u7ebf\u6bb5\u6811\u5c31\u53ef\u4ee5\u641e\u5b9a\u4e86\u3002\n\n\u590d\u6742\u5ea6\u53ef\u4ee5\u5c11\u6389\u4e00\u4e2a $\\log$\uff0c $60q\\log n$ \u5927\u7ea6\u4e3a $1.5\\times 10^8$\u3002\n\n\u60f3\u5230\u8fd9\u91cc\uff0c\u6211\u5c31\u6ca1\u6709\u518d\u60f3\u4e0b\u53bb\u3002\u5f53\u6211\u7f8e\u6ecb\u6ecb\u5730\u4ea4\u4e0a\u53bb\uff0c\u62e5\u6709\u5341\u8db3\u7684\u4fe1\u5fc3 A \u6389\u8fd9\u9053\u9898\u7684\u65f6\u5019\u2026\u2026\n\nTLE on test 9\uff1f\n\n\u867d\u7136\u7406\u8bba\u590d\u6742\u5ea6\u662f ok \u7684\uff0c\u4f46\u5b9e\u6d4b\u5e38\u6570\u5f88\u5927\u3002\u9996\u5148\u4f60\u8981\u5c06\u6bcf\u4e2a\u627e\u989c\u8272\u7684\u8be2\u95ee\u62c6\u6210\u56db\u4e2a\u8be2\u95ee\uff0c\u5c31\u5df2\u7ecf\u6709\u4e86 $4$ \u7684\u5e38\u6570\uff0c\u518d\u52a0\u4e0a\u5feb\u901f\u5e42\u3001\u53d6\u6a21\u7684\u5e38\u6570\uff0c\u5c06\u8fd1\u6709 $10^9$\u3002\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u54ea\u6015\u518d\u795e\u7684\u8bc4\u6d4b\u673a\u4e5f\u6ca1\u6cd5\u513f\u7ed9\u4f60\u8dd1\u8fc7\u554a\u2026\u2026\n\n\u987a\u4fbf\u9644\u4e0a T \u6389\u4e86\u7684\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntypedef pair<int,int> pii;\ntypedef long long ll;\nconst int MOD=1e9+7; \nconst int MAXN=1e5+5;\nconst int MAXC=MAXN*10;\nconst int MAXQ=MAXN*150;\nint n,q,qn,a[MAXN],tnum=0,num=0;\nvector<pii> fac[MAXN];\npii key[MAXC],hs[MAXC];\nmap<pii,bool> vis;\nint hd[MAXN],nxt[MAXN<<1],to[MAXN<<1],ec=0;\nvoid adde(int u,int v){\n\tto[++ec]=v;nxt[ec]=hd[u];hd[u]=ec;\n}\nint fa[MAXN][22],dfn[MAXN],ed[MAXN],tim=0,dep[MAXN];\nvoid dfs(int x,int f){\n\tfa[x][0]=f;dfn[x]=++tim;\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f) continue;\n\t\tdep[y]=dep[x]+1;dfs(y,x);\n\t} ed[x]=tim;\n}\nint getlca(int x,int y){\n\tif(dep[x]<dep[y]) swap(x,y);\n\tfor(int i=20;~i;i--) if(dep[x]-(1<<i)>=dep[y]) x=fa[x][i];\n\tif(x==y) return x;\n\tfor(int i=20;~i;i--) if(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}\nstruct Query{\n\tint f,id,x,v;//ans[id]*=v^{num}\n\tQuery(){/*var nothing*/}\n\tQuery(int _f,int _id,int _x,int _v){\n\t\tf=_f;id=_id;x=_x;v=_v;\n\t}\n\tfriend bool operator <(Query lhs,Query rhs){\n\t\treturn lhs.f<rhs.f;\n\t}\n} qu[MAXQ];\nvector<int> add[MAXC];\nint qpow(int x,int e){\n\tint ret=1;\n\twhile(e){\n\t\tif(e&1) ret=1ll*ret*x%MOD;\n\t\tx=1ll*x*x%MOD;e>>=1;\n\t} return ret;\n}\nint ans[MAXN];\nstruct node{\n\tint l,r,val,lz;\n} s[MAXN<<2];\nvoid build(int k,int l,int r){\n\ts[k].l=l;s[k].r=r;if(l==r) return;\n\tint mid=(l+r)>>1;build(k<<1,l,mid);build(k<<1|1,mid+1,r);\n}\nvoid pushdown(int k){\n\tif(s[k].lz){\n\t\ts[k<<1].val+=s[k].lz*(s[k<<1].r-s[k<<1].l+1);\n\t\ts[k<<1].lz+=s[k].lz;\n\t\ts[k<<1|1].val+=s[k].lz*(s[k<<1|1].r-s[k<<1|1].l+1);\n\t\ts[k<<1|1].lz+=s[k].lz;\n\t\ts[k].lz=0;\n\t}\n}\nvoid modify(int k,int l,int r,int x){\n\tif(l<=s[k].l&&s[k].r<=r){\n\t\ts[k].val+=(s[k].r-s[k].l+1)*x;s[k].lz+=x;return;\n\t} pushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) modify(k<<1,l,r,x);\n\telse if(l>mid) modify(k<<1|1,l,r,x);\n\telse modify(k<<1,l,mid,x),modify(k<<1|1,mid+1,r,x);\n\ts[k].val=s[k<<1].val+s[k<<1|1].val;\n}\nint query(int k,int l,int r){\n\tif(l<=s[k].l&&s[k].r<=r) return s[k].val;\n\tpushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) return query(k<<1,l,r);\n\telse if(l>mid) return query(k<<1|1,l,r);\n\telse return query(k<<1,l,mid)+query(k<<1|1,mid+1,r);\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++){\n\t\tint u,v;scanf(\"%d%d\",&u,&v);adde(u,v);adde(v,u);\n\t}\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<=n;i++){\n\t\tint tmp=a[i];\n\t\tfor(int j=2;j*j<=tmp;j++){\n\t\t\tif(tmp%j==0){\n\t\t\t\tint cnt=0;\n\t\t\t\twhile(tmp%j==0) tmp/=j,cnt++;\n\t\t\t\tfac[i].pb(mp(j,cnt));\n//\t\t\t\tprintf(\"{%d,%d} \",j,cnt);\n\t\t\t\tkey[++tnum]=mp(j,cnt);\n\t\t\t}\n\t\t}\n\t\tif(tmp>1){\n\t\t\tfac[i].pb(mp(tmp,1));\n//\t\t\tprintf(\"{%d,%d} \",tmp,1);\n\t\t\tkey[++tnum]=mp(tmp,1);\n\t\t}\n//\t\tprintf(\"\\n\");\n\t}\n\tsort(key+1,key+tnum+1);\n\tfor(int i=1;i<=tnum;i++) if(key[i]!=key[i-1])\n\t\ths[++num]=key[i],vis[key[i]]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=0;j<fac[i].size();j++){\n\t\t\tint id=lower_bound(hs+1,hs+num+1,fac[i][j])-hs;\n\t\t\tadd[id].push_back(i);//printf(\"%d %d\\n\",id,i);\n\t\t}\n\t}\n\tdfs(1,0);\n\tfor(int i=1;i<=20;i++) for(int j=1;j<=n;j++)\n\t\tfa[j][i]=fa[fa[j][i-1]][i-1];\n\tscanf(\"%d\",&q);\n\tfor(int i=1;i<=q;i++){\n\t\tint u,v,w;scanf(\"%d%d%d\",&u,&v,&w);\n\t\tint tmp=w;vector<pii> ff;ans[i]=1;\n\t\tfor(int j=2;j*j<=tmp;j++){\n\t\t\tif(tmp%j==0){\n\t\t\t\tint cnt=0;\n\t\t\t\twhile(tmp%j==0) tmp/=j,cnt++;\n\t\t\t\tff.pb(mp(j,cnt));\n\t\t\t}\n\t\t}\n\t\tif(tmp>1) ff.pb(mp(tmp,1));\n\t\tfor(int j=0;j<ff.size();j++){\n\t\t\tint val=1,pw=qpow(ff[j].fi,ff[j].se);\n\t\t\tfor(int k=1;val<=1e7;k++){\n\t\t\t\tval*=ff[j].fi;\n\t\t\t\tif(!vis[mp(ff[j].fi,k)]) continue;\n\t\t\t\tint f=lower_bound(hs+1,hs+num+1,mp(ff[j].fi,k))-hs;\n\t\t\t\tqu[++qn]=Query(f,i,u,min(val,pw));\n\t\t\t\tqu[++qn]=Query(f,i,v,min(val,pw));\n\t\t\t\tint lca=getlca(u,v);\n\t\t\t\tqu[++qn]=Query(f,i,lca,qpow(min(val,pw),MOD-2));\n\t\t\t\tif(lca!=1) qu[++qn]=Query(f,i,fa[lca][0],qpow(min(val,pw),MOD-2));\n\t\t\t}\n\t\t}\n\t}\n\tbuild(1,1,n);sort(qu+1,qu+qn+1);int j=1;\n\tfor(int i=1;i<=num;i++){\n\t\tffe(it,add[i]) modify(1,dfn[*it],ed[*it],1);\n\t\twhile(j<=qn&&qu[j].f==i){\n\t\t\tint cnt=query(1,dfn[qu[j].x],dfn[qu[j].x]);\n//\t\t\tprintf(\"%d %d\\n\",j,cnt);\n\t\t\tans[qu[j].id]=1ll*ans[qu[j].id]*qpow(qu[j].v,cnt)%MOD;j++;\n\t\t}\n\t\tffe(it,add[i]) modify(1,dfn[*it],ed[*it],-1);\n\t}\n\tfor(int i=1;i<=q;i++) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n\nwtcl \u554a\uff0c\u4e0b\u9762\u5f00\u59cb\u8bb2\u6b63\u89e3\uff0c\u5176\u5b9e\u7a0d\u5fae\u53d8\u901a\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u6b63\u89e3\u8fd8\u662f\u57fa\u4e8e\u4e4b\u524d\u90a3\u4e2a\u201c\u6570\u989c\u8272\u201d\u7684\u505a\u6cd5\uff0c\u4e0d\u8fc7\u6211\u4eec\u60f3\u60f3\uff0c\u4e4b\u524d\u6211\u4eec\u79bb\u7ebf\u662f\u679a\u4e3e\u989c\u8272\uff0c\u7136\u540e\u7ef4\u62a4\u6811\u4e0a\u6bcf\u4e2a\u70b9\u8be2\u95ee\u7684\u7b54\u6848\u3002\u5982\u679c\u662f\u679a\u4e3e\u6811\u4e0a\u7684\u70b9\uff0c\u7136\u540e\u7528\u4e2a\u4ec0\u4e48\u4e1c\u897f\u7ef4\u62a4\u6bcf\u79cd\u989c\u8272\u7684\u6570\u91cf\u4f1a\u4e0d\u4f1a\u597d\u4e00\u4e9b\u554a\uff1f\n\n\u6811\u4e0a\u524d\u7f00\u548c\u554a\uff01\n\n\u6309\u7167\u5957\u8def\u5bf9\u6811\u8fdb\u884c\u4e00\u904d DFS\uff0c\u5c06\u8be2\u95ee\u6807\u8bb0\u5728\u70b9\u4e0a\u3002\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a $sum_x$ \u8868\u793a\u6839\u8282\u70b9\u5230\u5f53\u524d\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u989c\u8272\u4e3a $x$ \u7684\u8282\u70b9\u7684\u4e2a\u6570\u3002\u5728 DFS \u7684\u8fc7\u7a0b\u4e2d\u5b9e\u65f6\u7ef4\u62a4 $sum$ \u6570\u7ec4\uff0c\u56de\u6eaf\u7684\u65f6\u5019\u5c31\u51cf\u6389\u5f53\u524d\u8282\u70b9\u7684\u8d21\u732e\u3002\n\n\u524d\u7f00\u548c\u53ef\u4ee5 $\\mathcal O(1)$ \u7684\u65f6\u95f4\u5185\u7ef4\u62a4\uff0c\u8fd9\u6837\u53c8\u5c11\u6389\u4e00\u4e2a $\\log$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntypedef pair<int,int> pii;\ntypedef long long ll;\nconst int MOD=1e9+7; \nconst int MAXN=1e5+5;\nconst int MAXV=1e7+5;\nint n,q,qn,a[MAXN];\nint hd[MAXN],nxt[MAXN<<1],to[MAXN<<1],ec=0;\nvoid adde(int u,int v){\n\tto[++ec]=v;nxt[ec]=hd[u];hd[u]=ec;\n}\nint fa[MAXN][22],dep[MAXN];\nvoid dfs(int x,int f){\n\tfa[x][0]=f;\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f) continue;\n\t\tdep[y]=dep[x]+1;dfs(y,x);\n\t}\n}\nint getlca(int x,int y){\n\tif(dep[x]<dep[y]) swap(x,y);\n\tfor(int i=20;~i;i--) if(dep[x]-(1<<i)>=dep[y]) x=fa[x][i];\n\tif(x==y) return x;\n\tfor(int i=20;~i;i--) if(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}\nvector<pii> fac[MAXN];\nstruct Query{\n\tint w,x,id,mul;\n} qu[MAXN<<2];\nint qpow(int x,int e){\n\tint ret=1;\n\twhile(e){\n\t\tif(e&1) ret=1ll*ret*x%MOD;\n\t\tx=1ll*x*x%MOD;e>>=1;\n\t} return ret;\n}\nint ans[MAXN];\nint sum[MAXV/5][24];\nvector<int> qv[MAXN];\nint pid[MAXV],pr[MAXV/5],pcnt=0;\nbitset<MAXV> vis;\nvoid prework(){\n\tfor(int i=2;i<MAXV;i++){\n\t\tif(!vis[i]){pr[++pcnt]=i;pid[i]=pcnt;}\n\t\tfor(int j=1;j<=pcnt&&pr[j]*i<MAXV;j++){\n\t\t\tvis[pr[j]*i]=1;if(i%pr[j]==0) break;\n\t\t}\n\t}\n}\nvoid calc(int x){\n\tffe(it,fac[x]) sum[pid[it->fi]][it->se]++;\n\tffe(it,qv[x]){\n\t\tint id=*it,tmp=qu[id].w;\n\t\tvector<pii> ff;\n\t\tfor(int i=2;i*i<=tmp;i++){\n\t\t\tif(tmp%i==0){\n\t\t\t\tint cnt=0;\n\t\t\t\twhile(tmp%i==0) tmp/=i,cnt++;\n\t\t\t\tff.pb(mp(i,cnt));\n\t\t\t}\n\t\t}\n\t\tif(tmp>1) ff.pb(mp(tmp,1));\n\t\tint tot_mul=1;\n\t\tfor(int i=0;i<ff.size();i++){\n\t\t\tint pw=1,val=ff[i].fi;\n\t\t\tfor(int j=1;j<=ff[i].se;j++) pw*=ff[i].fi;\n\t\t\tfor(int j=1;val<MAXV;j++,val*=ff[i].fi){\n\t\t\t\tint cnt=sum[pid[ff[i].fi]][j];\n\t\t\t\tint mul=qpow(min(val,pw),cnt);\n\t\t\t\ttot_mul=1ll*tot_mul*mul%MOD;\n\t\t\t}\n\t\t}\n\t\tif(qu[id].mul==1) ans[qu[id].id]=1ll*ans[qu[id].id]*tot_mul%MOD;\n\t\telse ans[qu[id].id]=1ll*ans[qu[id].id]*qpow(tot_mul,MOD-2)%MOD;\n\t}\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==fa[x][0]) continue;calc(y);\n\t}\n\tffe(it,fac[x]) sum[pid[it->fi]][it->se]--;\n}\nint main(){\n\tprework();\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++){\n\t\tint u,v;scanf(\"%d%d\",&u,&v);adde(u,v);adde(v,u);\n\t}\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<=n;i++){\n\t\tint tmp=a[i];\n\t\tfor(int j=2;j*j<=tmp;j++){\n\t\t\tif(tmp%j==0){\n\t\t\t\tint cnt=0;\n\t\t\t\twhile(tmp%j==0) tmp/=j,cnt++;\n\t\t\t\tfac[i].pb(mp(j,cnt));\n\t\t\t}\n\t\t}\n\t\tif(tmp>1) fac[i].pb(mp(tmp,1));\n\t}\n\tdfs(1,0);\n\tfor(int i=1;i<=20;i++) for(int j=1;j<=n;j++)\n\t\tfa[j][i]=fa[fa[j][i-1]][i-1];\n\tscanf(\"%d\",&q);\n\tfor(int i=1;i<=q;i++){\n\t\tint u,v,w;scanf(\"%d%d%d\",&u,&v,&w);ans[i]=1;\n\t\tint lca=getlca(u,v);\n\t\tqu[++qn]={w,u,i,1};qu[++qn]={w,v,i,1};\n\t\tqu[++qn]={w,lca,i,-1};if(lca!=1) qu[++qn]={w,fa[lca][0],i,-1};\n\t}\n\tfor(int i=1;i<=qn;i++) qv[qu[i].x].pb(i);calc(1);\n\tfor(int i=1;i<=q;i++) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n\n\u6700\u540e\uff0cycxtxdy\uff01",
        "postTime": 1606906814,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF986E \u3010Prince's Problem\u3011"
    },
    {
        "content": "\u4e00\u79cd\u65b9\u6cd5\u662f\u79bb\u7ebf\u5dee\u5206\u8f6c\u4e3a\u6839\u5230\u70b9\u7684\u8d21\u732e\u7136\u540e\u7b97\u4e00\u4e0b\uff0c\u6bd4\u8f83\u5e38\u89c1\u7684\u5dee\u5206\u65b9\u6cd5\u3002\n\n\u4f46\u662f\u5982\u679c\u4f60~~\u56f0\u4e86~~\u601d\u7ef4\u50f5\u5316\u4e86\uff1a\n\n\u5148\u89c2\u5bdf\u5230\uff0c\u6240\u6709\u6743\u7684\u8d28\u56e0\u5b50\u4e2a\u6570 $\\le n \\log$,\u7136\u540e\u4e00\u4e2a\u4e00\u4e2a\u8d28\u56e0\u5b50\u8003\u8651\uff0c\u8bbe\u5f53\u524d\u8d28\u56e0\u5b50\u4e3a $p$\uff0c\u628a\u5305\u542b $p$ \u8fd9\u4e2a\u8d28\u56e0\u5b50\u7684\u70b9\u5efa\u865a\u6811\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u5305\u542b $p$ \u8fd9\u4e2a\u8d28\u56e0\u5b50\u7684\u8be2\u95ee\uff0c\u6309\u542b $p$ \u7684\u6b21\u6570\u6392\u5e8f\uff0c\u5bb9\u6613\u53d1\u73b0\u4e0d\u540c\u7684\u6b21\u6570 $\\le \\log$\uff0c\u5c31\u5bf9\u4e8e\u6bcf\u4e2a\u6b21\u6570\uff0c\u9650\u5236\u4e00\u4e0b\u865a\u6811\u4e0a\u7684\u6743\u3002\n\n\u7136\u540e\u8ba8\u8bba\u4e00\u4e0b\u3002\u8bbe\u8be2\u95ee\u7684\u4e24\u4e2a\u70b9\u4e3a $x,y(dep_x \\le dep_y)$\uff0c\u5728\u865a\u6811\u4e0a\u7b2c\u4e00\u4e2a $dep < dep_{x/y}$ \u7684\u70b9\u4e3a $X,Y$\uff0c\u5982\u679c\u4e24\u70b9\u90fd\u5728\u539f\u6811\u4e0a\u7684 $LCA$ \u4e4b\u4e0a\uff0c\u5c31\u8df3\u8fc7\u3002\u5426\u5219\n\n\u8bbe\u865a\u6811\u4e0a $LCA$ \u4e3a $l2$ ,\u5f53\u524d $lim$ \u7684\u6876\u4e3a $finval$\u3002\n\n1. $x=X:finval[y]-finval[x]$\u3002\n\n2. $y=Y:finval[x]-finval[y]$\u3002\n\nelse 3.$finval[x]+finval[y]-finval[l2]-finval[fa[l2]]$\u3002\n\n\u5982\u679c\u4e0d\u8003\u8651\u6392\u5e8f\u7684\u590d\u6742\u5ea6\uff0c\u7406\u8bba\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f\u4e0d\u4f18\u7684\uff0c\u4e0a\u9650\u4e3a \uff1a$n \\log n \\times $ \u4e0d\u540c\u8d28\u56e0\u5b50\u4e2a\u6570\u3002\u4f46\u662f\u5e38\u6570\u5b9e\u9645\u5f88\u5c0f\uff08\uff1f\uff09\uff0c\u53ef\u4ee5\u8dd1\u8fdb\u4e00\u79d2\u3002\n\n\u6bd4\u8f83\u597d\u60f3\uff0c\u6bd4\u8f83\u96be\u5199\u3002\n\n[\u4ee3\u7801\u592a\u957f\u4e86\uff0c\u88ab\u8981\u6c42\u653e\u4e86\u3002](https://www.luogu.com.cn/paste/2hsfeodm)\n\n\u592a\u8822\u4e86\uff0c\u6253\u4e2a\u516c\u5f0f\u53c8\u5197\u4f59\u53c8\u4e11\uff01\uff01",
        "postTime": 1668598791,
        "uid": 164437,
        "name": "yeaDonaby",
        "ccfLevel": 0,
        "title": "\u8c03\u4e86114514\u5e74\uff0c\u597d\uff01"
    },
    {
        "content": "## \u9898\u89e3\uff1a$CF986E$\n\n### \u5e9f\u8bdd\uff1a\n\n\u4e07\u91cc\u957f\u5f81\u7b2c\u4e8c\u6b65\u3002\n\n[\u7b2c\u4e00\u6b65](https://www.luogu.com.cn/blog/CDFLS-stu4-60/solution-cf1140f)\n\n### \u9898\u610f\uff1a\n\n\u7ed9\u51fa\u4e00\u9897\u5e26\u70b9\u6743\u7684\u6811\uff0c\u7ed9\u82e5\u5e72\u8be2\u95ee\uff0c\u6bcf\u6761\u8be2\u95ee\u7ed9\u4e00\u4e2a\u6570$w$\u3002\n\n\u6c42\u4e00\u6761\u8def\u5f84\u4e0a\u6240\u6709\u70b9\u70b9\u6743\u4e0e $w$ \u7684 $gcd$ \u4e58\u79ef\u3002\n\n$\\bmod1e9+7$\n\n### \u601d\u8def:\n\n\u548b\u4e00\u770b\u80af\u5b9a\u8981\u7ef4\u62a4\u4e0d\u540c\u8d28\u6570\uff0c\u4e8e\u662f\u60f3\u5230\u4e86\u6811\u5256\u5957\u4e3b\u5e2d\u6811\uff0c\u7136\u9e45\u5e76\u4e0d\u597d\u5b9e\u73b0\uff0c\u4e8e\u662f $yyh$ \u5927\u4f6c\u6765\u4e86\uff0c\u7559\u4e0b\u4e86\u4e24\u4e2a\u5b57\u201c\u79bb\u7ebf\u201d\u3002\n\n\u604d\u7136\u5927\u609f\uff0c\u9700\u8981\u5904\u7406\u7684\u8d28\u6570\u7684\u4e2a\u6570\u662f\u5f88\u5c11\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u6570\u8d28\u56e0\u6570\u4e2a\u6570\u7684\u7ea7\u522b\u662f $log$ \u7684\uff0c\u5b8c\u5168\u53ef\u4ee5\u6bcf\u4e00\u4e2a\u8d28\u6570\u5206\u5f00\u5904\u7406\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5148\u641e\u51fa\u6bcf\u4e2a\u70b9\u4e0a\u6743\u503c\u7684\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u5bf9\u6bcf\u4e2a\u8d28\u6570\u5f00\u4e00\u4e2a $vector$ \u5b58\u4e00\u4e0b\u54ea\u4e9b\u70b9\u7684\u8d28\u56e0\u6570\u4e2d\u6709\u5b83\uff0c\u5e76\u8bb0\u5f55\u6307\u6570\u3002\u518d\u5f00\u4e00\u4e2a $vector$ \u8bb0\u5f55\u54ea\u4e9b\u8be2\u95ee\u4e2d\u7684 $w$ \u7684\u8d28\u56e0\u6570\u4e2d\u6709\u5b83\uff0c\u540c\u6837\u8bb0\u5f55\u6307\u6570\uff0c\u518d\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4e86\uff0c\u53d1\u73b0\u8fd9\u6837\u7684\u64cd\u4f5c\u6b21\u6570\u548c\u67e5\u8be2\u6b21\u6570\u90fd\u662f $nlogn$ \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\u6811\u4e0a\u8def\u5f84\u67e5\u8be2\u6bcf\u4e2a\u70b9\u6743\u503c\u4e0e\u7ed9\u5b9a\u6570\u5b57\u6700\u5c0f\u503c\u7684\u548c\uff08\u5c31\u662f\u6c42 $gcd $ \u7684\u8fc7\u7a0b \uff09\u6811\u94fe\u5256\u5206\u5957\u4e3b\u5e2d\u6811\u5373\u53ef\u3002\n\n\u7ed3\u679c\u4f3c\u4e4e\u6709$4$\u4e2a $log$\uff0c\u663e\u7136\u4e0d\u592a\u53ef\u884c\uff0c\u6211\u4eec\u53d1\u73b0\u8d28\u56e0\u6570\u7684\u6307\u6570\u662f $log$ \u7ea7\u522b\u7684\uff0c\u975e\u5e38\u5c0f\uff0c\u6240\u4ee5\u5b8c\u5168\u6ca1\u5fc5\u8981\u4e3b\u5e2d\u6811\uff0c\u53ea\u9700\u8981\u7edf\u8ba1\u6bcf\u4e00\u4e2a\u503c\u7684\u4e2a\u6570\u5c31\u53ef\u4ee5\u4e86\uff0c\u800c\u4e14\u8fd9\u4e2a $log$ \u975e\u5e38\u7684\u5c0f\uff0c\u53ef\u4ee5\u5ffd\u7565\u4e86\u3002\u6211\u4eec\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u4ee3\u66ff\u4e3b\u5e2d\u6811\uff0c\u5e38\u6570\u5927\u5927\u4e0b\u964d\uff0c\u7406\u8bba\u590d\u6742\u5ea6 $O(nlog^3n)$  \uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u4ed4\u7ec6\u4e00\u770b\u539f\u6765\u4e0d\u9700\u8981\u652f\u6301\u4fee\u6539\uff0c\u5bf9\u8be2\u95ee\u5dee\u5206\u4e00\u4e0b\uff0c\u8fd8\u53ef\u4ee5\u505a\u5230 $O(nlogn)$ \uff0c\u4f46\u7531\u4e8e\u5dee\u5206\u4e4b\u540e\u4f1a\u6709 $4$  \u4e2a\u8be2\u95ee\uff0c\u5b9e\u9645\u8fd0\u884c\u5e76\u4e0d\u6bd4\u6811\u94fe\u5256\u5206\u5feb\u591a\u5c11(\u697c\u4e0a\u697c\u4e0b\u7684\u5927\u4f6c\u5bf9\u5176\u6709\u8be6\u7ec6\u8bb2\u89e3)\u3002\n\n### \u4ee3\u7801\u53ca\u5b9e\u73b0\u7ec6\u8282\uff08\u6811\u94fe\u5256\u5206\uff09:\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<set>\n#include<map>\n#include<queue>\n#include<cmath>\n#include<string>\n#include<cstring>\n#include<ctime>\n#include<stack>\n#include<bitset>\n#include<vector>\n#define next nxt\n#define itn int\n#define y1 y3647\n#define LL long long\nusing namespace std;\ninline void read(int &x)\n{\n\tx=0;\n\tint f=1;\n\tchar ch=getchar();\n\twhile((ch<'0'||ch>'9')&&ch!='-')\n\tch=getchar();\n\tif(ch=='-')\n\t{\n\t\tf=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9')\n\t{\n\t\tx=x*10+ch-'0';\n\t\tch=getchar();\n\t}\n\tx*=f;\n}\nint i,j,k,m,n,s,t,dfxn;\nconst int N=7e5+10,mod=1e9+7;//\u6a21\u6570\u8bb0\u5f97\u5f00\u5e38\u91cf\uff0c\u4f1a\u5feb\u5f88\u591a\u3002\nstruct q{\n\tint u,v,w,rk;\n};\nstruct q2{\n\tint first,second;\n};\nint p[10000010];\nint zs[N],head[N],son[N],size[N],dfn[N],rak[N];\nint fa[N],ans[N],c[N][29],dep[N],top[N];\nvector <q2> vct[N];\nvector <q> vctt[N];\nstruct fu{\n\tint v,next;\n}a[N<<1];\nvoid work(int aa,int bb)\n{\n\ta[++k].next=head[aa];\n\thead[aa]=k;\n\ta[k].v=bb;\n}\nvoid init()\n{\n\tdep[1]=1;\n\tfor(i=2;i<=1e7;i++)\n\t{\n\t\tif(p[i]!=1)zs[++t]=i,p[i]=t;//\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e2a\u8d28\u6570\u662f\u7b2c\u51e0\u4e2a\uff0c\u8981\u7528\u3002\n\t\tfor(j=1;j<=t&&zs[j]*i<=1e7;j++)\n\t\t{\n\t\t\tp[i*zs[j]]=1;\n\t\t\tif(i%zs[j]==0)//\u5148break\u8fd8\u662f\u5148\u8d4b\u503c\u4e3a1\u641e\u6e05\u695a\u3002\n\t\t\tbreak;\n\t\t}\n\t}\n}\nvoid dfs(int u)\n{\n\tfor(int i=head[u];i;i=a[i].next)\n\t{\n\t\tint v=a[i].v;\n\t\tif(fa[u]==v)\n\t\tcontinue;\n\t\tdep[v]=dep[u]+1;\n\t\tfa[v]=u;\n\t\tdfs(v);\n\t\tsize[u]+=size[v];\n\t\tif(size[v]>size[son[u]])\n\t\tson[u]=v;\n\t}\n\tsize[u]++;\n}\nvoid dfs2(int u)\n{\n\tdfn[u]=++dfxn;\n\trak[dfn[u]]=u;\n\tif(son[fa[u]]==u)\n\ttop[u]=top[fa[u]];\n\telse\n\ttop[u]=u;\n\tif(son[u])\n\tdfs2(son[u]);\n\tfor(itn i=head[u];i;i=a[i].next)\n\t{\n\t\tint v=a[i].v;\n\t\tif(v==son[u]||v==fa[u])\n\t\tcontinue;\n\t\tdfs2(v);\n\t}\n}\nvoid fj(int x,int u)\n{\n\tint tmp=sqrt(x+1);\n\tfor(int i=1;zs[i]<=tmp;i++)\n\t{\n\t\tint cnt=0;\n\t\twhile(x%zs[i]==0)\n\t\t{\n\t\t\tcnt++;\n\t\t\tx/=zs[i];\n\t\t}\n\t\tif(cnt)\n\t\tvct[i].push_back((q2){u,cnt});\n\t}//\u53ea\u9700\u8981\u5c1d\u8bd5\u5230sqrt(x)\n\tif(x!=1)\n\tvct[p[x]].push_back((q2){u,1});//\u5982\u679c\u8fd8\u6ca1\u5206\u5b8c\u90a3\u4e48\u5c31\u6709\u4e00\u4e2a\u5927\u4e8esqrt(n)\u7684\u8d28\u6570\uff0c\u8981\u8bb0\u5f55\u3002\n    //\u6240\u4ee5\u8bf4\u8981\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u6570\u662f\u7b2c\u51e0\u4e2a\u8d28\u6570\u3002\n}\nint quick(int aa,int ss)\n{\n\tint ret=1;\n\twhile(ss)\n\t{\n\t\tif(ss&1)\n\t\tret=(LL)ret*aa%mod;\n\t\taa=(LL)aa*aa%mod;\n\t\tss>>=1;\n\t}\n\treturn ret;\n}\nvoid fj2(int x,int u,int v,int rk)\n{\n\tint tmp=sqrt(x+1);\n\tfor(int i=1;zs[i]<=tmp;i++)\n\t{\n\t\tint cnt=0;\n\t\twhile(x%zs[i]==0)\n\t\t{\n\t\t\tcnt++;\n\t\t\tx/=zs[i];\n\t\t}\n\t\tif(cnt)\n\t\tvctt[i].push_back((q){u,v,cnt,rk});\n\t}\n\tif(x!=1)\n\tvctt[p[x]].push_back((q){u,v,1,rk});\n}\nvoid updata(int x,int pp,int cc)\n{\n\tfor(int i=x;i<=n;i+=i&(-i))\n\tc[i][pp]+=cc;\n}\nint quert(int x,int tc)\n{\n\tint ss=0;\n\tfor(int i=x;i>=1;i-=i&(-i))\n\tss+=c[i][tc]\uff1b\n\treturn ss;\n}\nint query(int u,int v,int tc)\n{\n\tif(dep[u]<dep[v])\n\tswap(u,v);\n\tif(top[u]==top[v])\n\treturn quert(dfn[u],tc)-quert(dfn[v]-1,tc);//\u6ce8\u610f\u6811\u5256\u7684\u7ec6\u8282\u3002\n\tif(dep[top[u]]<dep[top[v]])\n\tswap(u,v);\n\treturn quert(dfn[u],tc)-quert(dfn[top[u]]-1,tc)+query(fa[top[u]],v,tc);\n}\nint main()\n{\n\t//freopen(\".in\",\"r\",stdin);\n\t//freopen(\".out\",\"w\",stdout);\n\t//freopen(\".ans\",\"w\",stdout);\n\tinit();\n\tread(n);\n\tfor(i=1;i<n;i++)\n\t{\n\t\tint x,y;\n\t\tread(x),read(y);\n\t\twork(x,y);\n\t\twork(y,x);\n\t}\n\tdfs(1);\n\tdfs2(1);\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tint x;\n\t\tread(x);\n\t\tfj(x,i);\n\t}\n\tread(m);\n\tfor(i=1;i<=m;i++)\n\t{\n\t\tint x,y,w;\n\t\tread(x),read(y),read(w);\n\t\tans[i]=1;\n\t\tfj2(w,x,y,i);\n\t}\n\tfor(i=1;i<=t;i++)\n\t{\t//\u6ce8\u610f\u679a\u4e3e\u7684\u662f\u8d28\u6570\u3002\n\t\tfor(j=0;j<vct[i].size();j++)\n\t\tupdata(dfn[vct[i][j].first],vct[i][j].second,1);\n\t\tfor(j=0;j<vctt[i].size();j++)\n\t\t{\n\t\t\tint tmp=0;\n\t\t\tint rc=log2(1e7)/log2(zs[i])+1;//\u8ba1\u7b97\u4e0a\u754c\u3002\n\t\t\tfor(int k=1;k<=rc;k++)\n\t\t\ttmp+=(long long)query(vctt[i][j].u,vctt[i][j].v,k)*min(k,vctt[i][j].w);\n\t\t\tans[vctt[i][j].rk]=(long long)ans[vctt[i][j].rk]*quick(zs[i],tmp)%mod;\n\t\t}\n\t\tfor(j=0;j<vct[i].size();j++)\t\n\t\tupdata(dfn[vct[i][j].first],vct[i][j].second,-1);//\u8bb0\u5f97\u628a\u5f53\u524d\u7684\u4fee\u6539\u8be5\u56de\u53bb\uff0c\u5904\u7406\u4e0b\u4e00\u4e2a\u8d28\u6570\u3002\n\t}\n\tfor(i=1;i<=m;i++)\n\tprintf(\"%d \",ans[i]);\n\treturn 0;\n}\n\n```\n\n### \u81ea\u6211\u53cd\u601d\uff1a\n\n\u770b\u5230\u6709\u5173\u8d28\u56e0\u6570\u7684\u5904\u7406\u5c31\u5e94\u8be5\u60f3\u5230\u5bf9\u4e8e\u6bcf\u4e2a\u8d28\u6570\u5206\u522b\u5904\u7406\u3002\n\n\u9009\u62e9\u6570\u636e\u7ed3\u6784\u65f6\u89c2\u5bdf\u597d\u503c\u57df\u3002\n\n\n\n\n\n",
        "postTime": 1609290907,
        "uid": 177535,
        "name": "CDFLS_mao_zx",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF986E \u3010Prince's Problem\u3011"
    }
]