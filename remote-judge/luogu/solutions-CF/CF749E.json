[
    {
        "content": "[\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](http://m-sea-blog.com/archives/4591/)\n\n---\n\n\u8003\u8651\u4e00\u4e2a\u70b9\u5bf9 $(i,j)\\;(i<j)$ \u7684\u8d21\u732e\u3002\n\n\u5206\u4e24\u79cd\u60c5\u51b5\u8003\u8651\uff1a$i,j$ \u90fd\u5728\u8fde\u7eed\u6bb5\u5185\u3001$i,j$ \u4e0d\u90fd\u5728\u8fde\u7eed\u6bb5\u5185\u3002\n\n------\n\n\u5148\u8003\u8651\u7b2c\u4e00\u79cd\u60c5\u51b5\u3002\u663e\u7136\u8fde\u7eed\u6bb5\u7684\u5de6\u7aef\u70b9 $\\in[1,i]$\uff0c\u53f3\u7aef\u70b9 $\\in[j,n]$\uff0c\u4e8e\u662f\u968f\u673a\u51fa\u7684\u8fde\u7eed\u6bb5\u5305\u542b $i,j$ \u7684\u6982\u7387\u4e3a\n\n$$\\frac{i(n-j+1)}{\\frac{n(n+1)}{2}}$$\n\n\u53c8\u56e0\u4e3a $(i,j)$ \u91cd\u6392\u540e\u6709 $\\frac{1}{2}$ \u7684\u6982\u7387\u4f1a\u5f62\u6210\u4e00\u4e2a\u9006\u5e8f\u5bf9\uff0c\u56e0\u6b64 $(i,j)$ \u7684\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684\u8d21\u732e\u4e3a\n\n$$P_{i,j}=\\frac{i(n-j+1)}{n(n+1)}$$\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684\u603b\u8d21\u732e\u4e3a\n\n$$\\begin{aligned}E_1&=\\sum_{i=1}^n\\sum_{j=i+1}^nP_{i,j}\\\\&=\\sum_{i=1}^n\\sum_{j=i+1}^n\\frac{i(n-j+1)}{n(n+1)}\\\\&=\\sum_{i=1}^n\\frac{i(n-i)(n-i+1)}{2n(n+1)}\\\\&=\\frac{1}{2n(n+1)}\\sum_{i=1}^ni(n-i)(n-i+1)\\end{aligned}$$\n\n\u76f4\u63a5 $\\mathcal{O}(n)$ \u8ba1\u7b97\u5373\u53ef\u3002\n\n------\n\n\u518d\u8003\u8651\u7b2c\u4e8c\u79cd\u60c5\u51b5\u3002\u663e\u7136\u8fde\u7eed\u6bb5\u662f $[1,j-1]$ \u6216 $[i+1,n]$ \u7684\u5b50\u533a\u95f4\uff0c\u4e8e\u662f\u968f\u673a\u51fa\u7684\u8fde\u7eed\u6bb5\u5305\u542b $i,j$ \u7684\u6982\u7387\u4e3a\n\n$$\\begin{aligned}&\\frac{\\frac{j(j-1)}{2}+\\frac{(n-i)(n-i+1)}{2}-\\frac{(j-i-1)(j-i)}{2}}{\\frac{n(n+1)}{2}}\\\\=&\\frac{j(j-1)+(n-i)(n-i+1)-(j-i-1)(j-i)}{n(n+1)}\\\\=&\\frac{n^2+n-2ni-2i+2ij}{n(n+1)}\\end{aligned}$$\n\n\u8fd9\u91cc\u5206\u5b50\u51cf\u6389 $\\frac{(j-i-1)(j-i)}{2}$ \u7684\u539f\u56e0\u662f $[i+1,j-1]$ \u7b97\u4e86 $2$ \u6b21\u3002\n\n\u5982\u679c $a_i<a_j$\uff0c\u90a3\u4e48 $(i,j)$ \u4e0d\u53ef\u80fd\u5f62\u6210\u9006\u5e8f\u5bf9\uff0c\u5426\u5219 $(i,j)$ \u4e00\u5b9a\u5f62\u6210\u9006\u5e8f\u5bf9\u3002\u56e0\u6b64 $(i,j)$ \u7684\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u8d21\u732e\u4e3a\n\n$$P_{i,j}=[a_i>a_j]\\frac{n^2+n-2ni-2i+2ij}{n(n+1)}$$\n\n\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u603b\u8d21\u732e\u4e3a\n\n$$\\begin{aligned}E_2&=\\sum_{i=1}^n\\sum_{j=i+1}^nP_{i,j}\\\\&=\\sum_{i=1}^n\\frac{n^2+n-2ni-2i+2ij}{n(n+1)}\\\\&=\\frac{1}{n(n+1)}\\sum_{i=1}^n\\sum_{j=i+1}^n[a_i>a_j](n^2+n-2ni-2i+2ij)\\end{aligned}$$\n\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u6211\u4eec\u53ea\u8981\u77e5\u9053\u6ee1\u8db3 $j>i,a_j<a_i$ \u7684 $j$ \u7684\u6570\u91cf\u4ee5\u53ca $j$ \u7684\u548c\u5c31\u53ef\u4ee5\u6c42\u51fa $E_2$ \u4e86\u3002\u76f4\u63a5\u7528\u6811\u72b6\u6570\u7ec4\u6c42\u9006\u5e8f\u5bf9\u7684\u65b9\u6cd5\u505a\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n------\n\n\u8fd9\u9898\u8fd0\u7b97\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u7206 `long long`\uff0c\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u3002\n\n------\n\n```cpp\n// ===================================\n//   author: M_sea\n//   website: http://m-sea-blog.com/\n// ===================================\n#include <algorithm>\n#include <iostream>\n#include <cstdlib>\n#include <cstring>\n#include <cstdio>\n#include <vector>\n#include <cmath>\n#define re register\n#define int long long\nusing namespace std;\n\ninline int read() {\n    int X=0,w=1; char c=getchar();\n    while (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n    while (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n    return X*w;\n}\n\nconst int N=100000+10;\n\nint n,a[N];\n\nstruct BIT {\n    int c[N];\n    inline void add(int x,int y) { for (;x<=n;x+=x&-x) c[x]+=y; }\n    inline int sum(int x) { int s=0; for (;x;x-=x&-x) s+=c[x]; return s; }\n} C,S;\n\nsigned main() {\n    n=read();\n    for (re int i=1;i<=n;++i) a[i]=read();\n    double ans=0;\n    for (re int i=1;i<=n;++i) ans+=0.5*i*(n-i)*(n-i+1);\n    for (re int i=n;i;--i) {\n        ans+=C.sum(a[i]-1)*(n*n+n-2*i-2*n*i);\n        ans+=2*S.sum(a[i]-1)*i;\n        C.add(a[i],1),S.add(a[i],i);\n    }\n    printf(\"%.20lf\\n\",1.0*ans/n/(n+1));\n    return 0;\n}\n```",
        "postTime": 1579052301,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF749E \u3010Inversions After Shuffle\u3011"
    },
    {
        "content": "\u4e24\u4e2a\u6708\u524d vp \u65f6\u4e0d\u4f1a\u505a\u7684\u9898\u73b0\u5728\u770b\u5230\u53d1\u73b0\u5f88\u7b80\u5355\u3002\u3002\n\n\u76f4\u63a5\u679a\u4e3e $l$ \u548c $r$ \u663e\u7136\u662f\u4e0d\u53ef\u884c\u7684\uff0c\u6211\u4eec\u8003\u8651\u6bcf\u4e00\u5bf9 $(i,j)$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u5148\u6c42\u51fa\u66f4\u6539\u524d\u7684\u9006\u5e8f\u5bf9\u6570\u91cf\uff0c\u518d\u8003\u8651\u66f4\u6539\u540e\u6bcf\u4e00\u5bf9\u7684\u53d8\u5316\u3002\u4e0d\u59a8\u8bbe $i<j$\n\n\u82e5 $a_i>a_j$\uff0c\u5219\u5982\u679c\u9009\u62e9\u7684\u533a\u95f4\u5305\u542b $(i,j)$\uff0c\u5c31\u4f1a\u6709 $\\frac{1}{2}$ \u7684**\u8d1f**\u8d21\u732e\uff0c\u533a\u95f4\u5305\u542b $(i,j)$ \u7684\u6982\u7387\u662f $\\frac{2(n-j+1)i}{n*(n+1)}$\uff0c\u8d21\u732e\u4e3a $-1*\\frac{(n-j+1)i}{n*(n+1)}$ \n\n\u540c\u7406\uff0c\u82e5 $a_i<a_j$\uff0c**\u6b63**\u8d21\u732e\u4e3a $\\frac{(n-j+1)i}{n*(n+1)}$\n\n\u8fd9\u4e2a\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5feb\u901f\u7edf\u8ba1\uff0c\u91cc\u9762\u7684\u503c\u7ef4\u62a4\u7684\u662f $1-i$ \u5185\u7684**\u4e0b\u6807\u4e4b\u548c**\u3002\n\n\u6700\u540e\u7528\u9006\u5e8f\u5bf9\u6570\u51cf\u53bb\u603b\u8d21\u732e\u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define ull unsigned long long\n#define int long long\n#define YES puts(\"YES\")\n#define NO puts(\"NO\")\n#define Yes puts(\"Yes\")\n#define No puts(\"No\")\n#define edl puts(\"\")\n#define mc cerr<<\"qwq\\n\"\n#define error goto gg\n#define def gg:\n#define rd(x) x=read()\n#define opl(x) printf(\"%lld\",x)\n#define opls(x) printf(\"%lld \",x)\n#define opd(x) printf(\"%d\",x)\n#define opds(x) printf(\"%d \",x)\n#define ver(x) for(int i=head[x];i;i=nxt[i])\n#define up(i,x,y) for(int i=x,i##end=y;i<=i##end;++i)\n#define pu(i,x,y) for(int i=x,i##end=y;i>=i##end;--i)\n#define ft(x) for(int i=head[x];i;i=nxt[i])\n#define upn up(i,1,n)\n#define upm up(j,1,m)\n#define pun pu(i,n,1)\n#define pum pu(j,m,1)\n#define up_(x) up(i,1,x)\n#define pu_(x) pu(j,x,1)\n#define ep emplace_back\n#define fp for(auto to:\n#define pf )\n#define pii pair<int,int>\n#define pis pair<int,string>\n#define psi pair<string,int>\n#define mkp make_pair\n#define fi first\n#define se second\n#define mii map<int,int>\n#define mis map<int,string>\n#define msi map<string,int>\n#define mvi map<vector<int>,int>\n#define miv map<int,vector<int>>\n#define rdn rd(n)\n#define rdm rd(m)\n#define rdk rd(k)\nusing namespace std;\nint n, m, k;\nint read()\n{\n    int s = 0, f = 1;\n    char ch = getchar();\n    while (ch < '0' || ch > '9')\n    {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while (ch >= '0' && ch <= '9')\n    {\n        s = s * 10 + ch - '0';\n        ch = getchar();\n    }\n    return s * f;\n}\n\n#define inf 1000000000000000000ll\nll Max(ll a=-inf,ll b=-inf,ll c=-inf,ll d=-inf,ll e=-inf,ll f=-inf,ll g=-inf,ll h=-inf)\n{\n\treturn max(max(max(a,b),max(c,d)),max(max(e,f),max(g,h)));\n}\nll Min(ll a=inf,ll b=inf,ll c=inf,ll d=inf,ll e=inf,ll f=inf,ll g=inf,ll h=inf)\n{\n\treturn min(min(min(a,b),min(c,d)),min(min(e,f),min(g,h)));\n}\n#undef inf\nconst int maxn=202020;\nint a[maxn];\nstruct bit\n{\n    int c[maxn];\n    int lowbit(int x){return x&(-x);}\n    void upd(int x,int y=1){for(;x<=n;x+=lowbit(x))c[x]+=y;}\n    int qry(int x){int ans=0;for(;x;x-=lowbit(x))ans+=c[x];return ans;}\n    int operator[](int x) {return qry(x);}\n}b,c;\nsigned main()\n{\n\tint T=1;\n\twhile(T--)\n\t{\n\t\trdn;\n\t\tupn rd(a[i]);\n\t\tdouble ans=0;\n\t\tdouble q=0;\n\t\tupn\n\t\t{\n\t\t\tq+=(c[n]-c[a[i]]);c.upd(a[i]);\n\t\t\tans+=(n-i+1)*(b[n]-b[a[i]]);\n\t\t\tans-=(n-i+1)*(b[a[i]]);\n\t\t\tb.upd(a[i],i);\n\t\t}\n\t\tans/=n;ans/=(n+1);\n\t\tprintf(\"%.10lf\",q-ans);\n\t}\n}\n```\n",
        "postTime": 1643432455,
        "uid": 154101,
        "name": "fily",
        "ccfLevel": 0,
        "title": "\u88ab\u6253\u7206\u4e86/kk"
    },
    {
        "content": "\u8003\u8651\u4e24\u4e2a\u4f4d\u7f6e $i,j(i<j)$ \u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u6709\u8d21\u732e\u3002\n\n\u663e\u7136\u5982\u679c\u91cd\u6392\u533a\u95f4 $[l,r]$\uff0c\u6709\u4efb\u610f $l\\le x<y\\le r$\uff0c$a_x,a_y$ \u5f62\u6210\u9006\u5e8f\u5bf9\u7684\u6982\u7387\u662f $\\dfrac 1 2$\u3002\n\n\u8003\u8651\u5f53 $a_i<a_j$\uff0c\u90a3\u4e48\u5982\u679c\u533a\u95f4\u5305\u542b $i,j$\uff0c\u90a3\u4e48\u6709 $\\dfrac 1 2$ \u7684\u6982\u7387\u4ea7\u751f\u9006\u5e8f\u5bf9\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\u533a\u95f4\u8981\u6ee1\u8db3 $l\\le i, j\\le r$\u3002\n\n\u5bb9\u6613\u7b97\u51fa\u8d21\u732e\u4e3a $\\dfrac {(n-j+1)i}{n(n-1)}$\u3002\n\n\u540c\u6837\u5982\u679c $a_i>a_j$ \u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u7b97\u3002\n\n\u679a\u4e3e\u53f3\u7aef\u70b9 $j$\uff0c\u90a3\u4e48 $a_i<a_j$ \u8d21\u732e\u4e3a $\\sum\\limits_{j < i\\land a_j<a_i}\\frac {(n-j+1)i}{n(n-1)}=\\frac {(n-j+1)}{n(n-1)}\\sum\\limits_{j < i\\land a_j<a_i}i$\u3002\n\n\u7c7b\u4f3c\u7b97\u51fa $a_j<a_i$ \u7684\u8d21\u732e\uff0c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4 $\\le i$ \u7684\u6570\u7684\u4e2a\u6570\u548c\u4e0b\u6807\u4e4b\u548c\u3002\n\n```cpp\n#define rg(x) for(int i=1;i<=(x);i++){\n#define gr }\nint a[1000005];\nint n=read();\nstruct BIT{\n\tint a[1000005];\n\tvoid add(int x,int p)\n\t{\n\t\tfor(;x<=n;x+=x&-x)a[x]+=p;\n\t}\n\tint operator[](int x)\n\t{\n\t\tint res=0;\n\t\twhile(x)res+=a[x],x-=x&-x;\n\t\treturn res;\n\t}\n\tint operator()(int l,int r){\n\t\treturn (*this)[r]-(*this)[l-1];\n\t}\n}t1,t2;\nsigned main()\n{\n\trg(n)a[i]=read();gr\n\tdouble ans=0;\n\trg(n)\n\t//left gongxian\n\tint D=t1[a[i]-1];\n\tdouble rate=1.0*(n-i+1)/n/(n+1);\n\tans+=t2[a[i]-1]*rate;\n\tans+=t1(a[i]+1,n);\n\tD=t1(a[i]+1,n);\n\trate=1.0*(n-i+1)/n/(n+1);\n\t//printf(\". %.10lf\\n\",rate);\n\tans-=rate*t2(a[i]+1,n);\n\tt1.add(a[i],1);\n\tt2.add(a[i],i);\n\t//printf(\"%.10lf\\n\",ans);\n\tgr\n\tprintf(\"%.10lf\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1635495617,
        "uid": 171487,
        "name": "cmll02",
        "ccfLevel": 8,
        "title": "qwq"
    },
    {
        "content": "\u5199\u4e2a\u671f\u671b\u5c0f\u6c34\u9898\u7ec3\u7ec3\u624b\uff5e\n\n[CF749E Inversions After Shuffle](https://www.luogu.com.cn/problem/CF749E)\n\n\u5bf9\u4e8e\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(i,j)$\uff0c\u5176\u88ab\u5305\u542b\u5728\u6240\u9009\u533a\u95f4\u5185\u7684\u6982\u7387\u4e3a $\\frac{i(n-j+1)}{n(n+1)/2}$\uff0c $(i,j)$ \u4e3a\u9006\u5e8f\u5bf9\u7684\u6982\u7387\u4e3a $\\frac{1}{2}$\uff0c\u8fd9\u79cd\u60c5\u51b5\u7684\u603b\u8d21\u732e\u4e3a\n$$\n\\sum_{i=1}^n\\sum_{j=i+1}^n\\frac{i(n-j+1)}{n(n+1)}=\\frac{1}{n(n+1)}\\sum_{i=1}^ni\\sum_{j=i+1}^n(n-j+1)=\\frac{1}{2n(n+1)}\\sum_{i=1}^n{i(n-i)(n-i+1)}\n$$\n\u5176\u4e0d\u88ab\u5305\u542b\u5728\u6240\u9009\u533a\u95f4\u5185\u7684\u6982\u7387\u4e3a $1-\\frac{i(n-j+1)}{n(n-1)/2}$\uff0c\u8fd9\u79cd\u60c5\u51b5\u7684\u603b\u8d21\u732e\u4e3a\n\n$$\n\\sum_{i=1}^n\\sum_{j=i+1}^n[a_i>a_j]\\left(1-\\frac{i(n-j+1)}{n(n+1)/2}\\right)\\\\\n=\\sum_{i=1}^n\\sum_{j=i+1}^n[a_i>a_j]-\\frac{2}{n(n+1)}\\sum_{i=1}^ni\\sum_{j=i+1}^n[a_i>a_j](n-j+1)\n$$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace FGF\n{\n\tconst int N=1e5+5;\n\tint a[N],n;\n\tlong long c[N];\n\tdouble ans,sum;\n\tvoid updat(int x,int y){while(x<=n)c[x]+=y,x+=x&(-x);}\n\tlong long query(int x){long long s=0;while(x)s+=c[x],x-=x&(-x);return s;}\n\tvoid work()\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tscanf(\"%d\",&a[i]);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tsum+=1.0*i*(n-i)*(n-i+1);\n\t\tfor(int i=n;i;i--)\n\t\t\tans+=query(a[i])*i,updat(a[i],n-i+1);\n\t\tans=-ans*2.0/n/(n+1)+sum/2.0/n/(n+1);\n\t\tmemset(c,0,sizeof(c));\n\t\tfor(int i=n;i;i--)\n\t\t\tans+=query(a[i]),updat(a[i],1);\n\t\tprintf(\"%.10f\",ans);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```",
        "postTime": 1623755624,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "CF749E Inversions After Shuffle\uff08\u671f\u671b\u9006\u5e8f\u5bf9\uff09"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\u6811\u72b6\u6570\u7ec4\u6c42\u9006\u5e8f\u5bf9\u3002\n\n\u9898\u76ee\u8981\u6c42\u671f\u671b\u9006\u5e8f\u5bf9\u6570\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651**\u91cd\u6392\u524d\u4e0b\u6807**\u4e3a $(i,j)$ \u7684\u70b9\u5bf9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\u5176\u4e2d $i<j$\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a\n\n- $i,j$ \u90fd\u5728\u9009\u4e2d\u7684\u6bb5\u5185  \n\u8bbe\u9009\u4e2d\u6bb5\u4e3a $[l,r]$\uff0c\u5219\u6ee1\u8db3 $l\\in [1,i],r\\in [j,n]$\uff0c\u6613\u77e5\u5168\u90e8\u53ef\u80fd\u7684\u9009\u6cd5\u6709 $\\dfrac{n(n+1)}{2}$ \u79cd\u3002  \n\u90a3\u4e48\u9009\u4e2d\u7684\u6bb5\u6ee1\u8db3\u6b64\u60c5\u51b5\u7684\u6982\u7387\u4e3a $\\dfrac{2i(n-j+1)}{n(n+1)}$\u3002  \n$(i,j)$ \u5728\u968f\u673a\u91cd\u6392\u540e\u6709 $\\dfrac{1}{2}$ \u7684\u6982\u7387\u6784\u6210\u9006\u5e8f\u5bf9\uff0c\u5219 $(i,j)$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $\\dfrac{i(n-j+1)}{n(n+1)}$\u3002  \n\u8fd9\u79cd\u60c5\u51b5\u7684\u603b\u8d21\u732e\u4e3a \n\n$$\n\\begin{aligned}\n ans&=\\sum \\limits_{i=1}^n \\sum\\limits_{j=i+1}^n \\frac{i(n-j+1)}{n(n+1)}\\\\\n&=\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{n-i}\\frac{ij}{n(n+1)}\\\\\n&=\\sum\\limits_{i=1}^n \\frac{i}{n(n+1)} \\times \\frac{(n-i+1)(n-i)}{2}\\\\\n&=\\sum\\limits_{i=1}^n \\frac{i(n-i+1)(n-i)}{2n(n+1)}\\\\\n\\end{aligned}\n$$\n\n- $i,j$ \u4e0d\u90fd\u5728\u9009\u4e2d\u6bb5\u5185  \n\u4e00\u5171\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u90a3\u4e48\u663e\u7136\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u6982\u7387\u4e3a $1-\\dfrac{2i(n-j+1)}{n(n+1)}$\u3002  \n\u7531\u4e8e $i,j$ \u4e0d\u90fd\u5728\u9009\u4e2d\u6bb5\u5185\uff0c\u91cd\u6392\u540e $i,j$ \u7684\u76f8\u5bf9\u4f4d\u7f6e\u4e0d\u53d8\uff0c\u5219\u5f53\u4e14\u4ec5\u5f53 $a_i>a_j$ \u65f6\uff0c$(i,j)$ \u5bf9\u7b54\u6848\u6709\u8d21\u732e\u3002  \n\u6240\u4ee5\u603b\u8d21\u732e\u4e3a $\\sum \\limits_{i=1}^n \\sum\\limits_{j=i+1}^n [a_i>a_j]\\dfrac{n(n+1)-2i(n-j+1)}{n(n+1)}$\u3002  \n\u628a\u8fd9\u4e2a\u5f0f\u5b50\u4ece\u51cf\u53f7\u5904\u62c6\u6210\u4e24\u90e8\u5206\uff0c\u5728\u6811\u72b6\u6570\u7ec4\u6c42\u9006\u5e8f\u5bf9\u7684\u540c\u65f6\u5206\u522b\u7ef4\u62a4\u5373\u53ef\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u7167\u4ee3\u7801\u3002\n\nAC code:\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read()\n{\n\tint xr=0,F=1;char cr=getchar();\n\twhile(cr<'0'||cr>'9') {if(cr=='-') F=-1;cr=getchar();}\n\twhile(cr>='0'&&cr<='9')\n\t    xr=(xr<<3)+(xr<<1)+(cr^48),cr=getchar();\n\treturn xr*F;\n}\n#define int long long\nconst int N=1e5+5;\nint n,a[N];\ndouble sum;// \u5168\u90e8\u4e58\u8d77\u6765\u4f1a\u70b8 long long\uff0c\u8981\u7528 double  \nint tr[N],cnt[N];//tr \u7ef4\u62a4\u6743\u503c\u548c\uff0ccnt \u7ef4\u62a4\u70b9\u7684\u4e2a\u6570 \nint lowbit(int x) {return x&(-x);}\nvoid add(int x,int k){\n\tfor(int i=x;i<=n;i+=lowbit(i)) tr[i]+=k,cnt[i]++;\n}\nint asktr(int x)\n{\n\tint res=0;\n\tfor(int i=x;i;i-=lowbit(i)) res+=tr[i];\n\treturn res;\n}\nint askcnt(int x)\n{\n\tint res=0;\n\tfor(int i=x;i;i-=lowbit(i)) res+=cnt[i];\n\treturn res;\n}\ndouble ans;\nsigned main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tfor(int i=1;i<=n;i++) sum+=1.0*i*(n-i+1)*(n-i);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint ncnt=askcnt(n)-askcnt(a[i]-1);\n\t\tint ntr=asktr(n)-asktr(a[i]-1);\n\t\tans+=(double)ncnt*n*(n+1);\n\t\tans-=(double)2*ntr*(n-i+1);\n\t\tadd(a[i],i);\n\t}\n\tdouble qwq=(double)ans/n/(n+1);\n\tdouble qaq=(double)sum/2/n/(n+1);\n\tprintf(\"%.11lf\\n\",qwq+qaq);\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1672821278,
        "uid": 234074,
        "name": "\u6a31\u96ea\u55b5",
        "ccfLevel": 7,
        "title": "CF749E Inversions After Shuffle"
    },
    {
        "content": "### problem\n\u7ed9\u51fa\u4e00\u4e2a1~n\u7684\u6392\u5217,\u4ece\u4e2d\u7b49\u6982\u7387\u62bd\u53d6\u4e00\u4e2a\u8fde\u7eed\u7684\u7247\u6bb5,\u5e76\u5bf9\u5176\u8fdb\u884c\u7b49\u6982\u7387\u5168\u6392\u5217,\u6c42\u6392\u5217\u540e\u6574\u4e2a\u5e8f\u5217\u7684\u9006\u5e8f\u5bf9\u7684\u671f\u671b\u4e2a\u6570.\n\n### solution\n\u8bbe\u6240\u9009\u7684\u533a\u95f4\u957f\u5ea6\u4e3al,\u8003\u8651\u4e00\u4e2a\u6709\u5e8f\u6570\u5bf9 ${a_i,a_j (i<j)}$ \u5e76\u8ba1\u7b97\u5176\u8d21\u732e.\n\u8fd9\u6837\u4e00\u6765,\u5c31\u6709\u4e24\u79cd\u60c5\u51b5:\n\n1. ${a_i,a_j}$\u5728\u6240\u9009\u7684\u8fde\u7eed\u6bb5\u4e2d\n2. ${a_i,a_j}$\u5728\u6240\u9009\u7684\u8fde\u7eed\u6bb5\u4e4b\u5916\n\n\u5bf9\u4e8e\u60c5\u51b52,\u5f53${a_i<a_j}$\u65f6,\u5f88\u663e\u7136\u4ed6\u4eec\u4e0d\u4f1a\u5bf9\u7b54\u6848\u6709\u8d21\u732e.\u5bf9\u4e8e${a_i>a_j}$,\u5bf9\u4e8e\u533a\u95f4 ${[1,j-1],[i+1,n]}$ \u624d\u4f1a\u6709\u8d21\u732e.\u4f46\u5f88\u663e\u7136\u5730\u770b\u5230,\u533a\u95f4 ${[i+1,j-1]}$ \u88ab\u91cd\u590d\u8ba1\u7b97,\u8981\u5728\u8ba1\u7b97\u6982\u7387\u65f6\u5c06\u5176\u526a\u6389.\u5982\u679c\u4f7f\u7528 ${O(n^2)}$\u66b4\u529b\u663e\u7136\u4f1a\u8d85\u65f6,\u53ef\u4ee5\u5c06\u5176\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4.\n\n\u5bf9\u4e8e\u60c5\u51b51\u5c31\u5f88\u7b80\u5355,\u6ee1\u8db3\u5168\u6392\u5217\u6982\u7387\u4e3a${\\frac{1}{2}}$,\u6ee1\u8db3\u8fde\u7eed\u6bb5\u5305\u542b\u5173\u7cfb\u7684\u6982\u7387\u4e3a ${2*\\frac{i*(n-j+1)}{n*(n+1)}}$,\u6982\u7387\u76f8\u4e58\u7ed3\u679c\n\n$${P_{i,j}=\\frac{i*(n-j+1)}{n*(n+1)}}$$\n\n\u90a3\u4e48\u603b\u671f\u671b\u4e3a\n\n$${P=\\sum_{i=1}^n\\sum_{j=i+1}^n  \\frac{i*(n-j+1)}{n*(n+1)}}$$\n$${P=\\frac{1}{2}\\sum_{i=1}^n\\frac {i*(n-i)*(n-i+1)} {n*(n+1)}}$$\n\n### code\n\u52a0\u5165\u64cd\u4f5c\n```cpp\ninline void add (int x, int w, ll *c)\n{\n\twhile (x) {\n\t\tc[x] += w;\n\t\tx &= x-1;\n\t}\n}\n```\n\u8be2\u95ee\u64cd\u4f5c\n```cpp\ninline ll query (int x, ll *c)\n{\n\tlong long ret = 0;\n\twhile (x<=n) {\n\t\tret += c[x];\n\t\tx += lowbit(x);\n\t}\n\treturn ret;\n}\n```\n\u4e3b\u7a0b\u5e8f\n```cpp\nstatic int main ()\n{\n\tn = read();\n\tfor (rint i = 1; i <= n; i ++)\n\t{\n\t\ta = read();\n\t\ttmp += query (a+1, c1);\n\t\tans -= (double)query(a+1, c2)*(n-i+1);\n\t\tans += (double)(n-i+1)*i*(i-1)/4.0;\n\t\tadd (a, 1, c1); add (a, i, c2);\n\t}\n\tprintf (\"%.20lf\", (double)(tmp+ans/((double)n*(n+1)/2.0)));\n\treturn 0;\n}\n```",
        "postTime": 1534224270,
        "uid": 65678,
        "name": "ELLIAS",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 CF749E \u3010Inversions After Shuffle\u3011"
    }
]