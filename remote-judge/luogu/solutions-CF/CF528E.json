[
    {
        "content": "# **\u3010\u9898\u89e3\u3011Triangles 3000 [CF528E]**\n\n[$\\mathcal{My}\\ \\mathcal{Blog}$](https://www.cnblogs.com/Xing-Ling/p/12679963.html)\n\n\u4f20\u9001\u95e8\uff1a[$\\text{Triangles 3000 [CF528E]}$](https://www.luogu.com.cn/problem/CF528E)\n\n## **\u3010\u9898\u76ee\u63cf\u8ff0\u3011**\n\n\u7ed9\u51fa $n$ $(n \\leqslant 3000)$ \u6761\u76f4\u7ebf\u7684\u65b9\u7a0b $ax+by=c$\uff08\u4e0d\u4f1a\u6709\u4e09\u7ebf\u4ea4\u4e8e\u4e00\u70b9\u7684\u60c5\u51b5\uff09\uff0c\u6c42\u4efb\u9009\u4e09\u6761\u76f4\u7ebf\u7ec4\u6210\u7684\u4e09\u89d2\u5f62\u9762\u79ef\u671f\u671b\u503c\u3002\n\n## **\u3010\u5206\u6790\u3011**\n\n[\u3010\u5b66\u4e60\u7b14\u8bb0\u3011\u8ba1\u7b97\u51e0\u4f55\u5168\u5bb6\u6876](https://www.luogu.com.cn/blog/ChenXingLing/post-xue-xi-bi-ji-ji-suan-ji-he-quan-jia-tong)\n\n\u6c42 $\\frac{\\sum S_{\\Delta ABC}}{C_{n}^{3}}$ \u3002\n\n\u6700 $\\text{naive}$ \u7684\u60f3\u6cd5\u662f\u66b4\u529b\u679a\u4e3e\u4e09\u6761\u76f4\u7ebf\u8ba1\u7b97\u4ea4\u70b9\uff0c\u518d\u4e71\u641e\u7b97\u9762\u79ef\uff0c\u4f3c\u4e4e\u65e0\u6cd5\u4f18\u5316\u3002\n\n\u8003\u8651\u591a\u8fb9\u5f62\u9762\u79ef\u7684\u4e00\u822c\u5f0f\uff1a$S=\\frac{1}{2}\\sum_{i\\in[1,n]}\\vec{OP_i}\\times \\vec{OP}_{i\\%n+1}$ \uff08\u70b9\u96c6 $\\{P_1,P_2...P_n\\}$ \u5448\u9006\u65f6\u9488\u6392\u5217\uff0c$O$ \u4e3a\u5e73\u9762\u4e0a\u4efb\u610f\u4e00\u70b9\uff09\n\n\u653e\u5230\u4e09\u89d2\u5f62\u4e2d\u5c31\u662f $S=\\frac{1}{2}(\\vec{OA}\\times \\vec{OB}+\\vec{OB}\\times \\vec{OC}+\\vec{OC}\\times \\vec{OA})$\n\n\u5373\u5bf9\u4e8e\u4e09\u89d2\u5f62\u7684\u6bcf\u6761\u8fb9 $EF$\uff08\u8bbe $\\vec{EF}$ \u5de6\u65b9\u4e3a\u4e09\u89d2\u5f62\u5185\u90e8\uff09\uff0c$\\vec{OE}$ \u53c9\u4e58 $\\vec{OF}$ \u518d\u6c42\u548c\u3002\n\n\u8003\u8651\u679a\u4e3e\u4e00\u6761\u76f4\u7ebf\uff0c\u8bbe\u6cd5\u7edf\u8ba1\u8be5\u76f4\u7ebf\u4e0a\u6240\u6709\u9700\u8981\u8ba1\u7b97\u7684 \u201c$\\vec{EF}$\u201d \u3002\n\n\u5982\u679c\u5c06\u5176\u4f59\u7684\u76f4\u7ebf\u6309\u6781\u89d2\u4ece\u5c0f\u5230\u5927\u4f9d\u6b21\u52a0\u5165\uff0c\u5bf9\u4e8e\u5f53\u524d\u8981\u52a0\u5165\u7684\u76f4\u7ebf $Line$\uff0c\u8bbe $EF$ \u4e0e $Line$ \u4ea4\u70b9\u4e3a $P$\uff0c\u524d\u9762\u5df2\u7ecf\u52a0\u5165\u7684\u76f4\u7ebf\u4e0e $Line$ \u4ea4\u70b9\u7684\u96c6\u5408\u4e3a $\\{Q_1,Q_2...Q_m\\}$\uff0c\u53ef\u77e5\u5bf9\u4e8e\u4efb\u610f\u7684 $Q_{i\\in[1,m]}$\uff0c$\\vec{Q_iP}$ \u5747\u662f\u9700\u8981\u8ba1\u7b97\u7684\uff08\u81ea\u5df1\u753b\u4e2a\u56feyy\u4e0b\uff0c\u65b9\u5411\u5728\u4e09\u89d2\u5f62\u4e2d\u5747\u4e3a\u9006\u65f6\u9488\uff0c\u800c\u4e14\u7279\u6b8a\u60c5\u51b5\u90fd\u88ab\u9898\u610f\u4e2d\u7684\u201c\u4e0d\u4f1a\u6709\u4e09\u7ebf\u4ea4\u4e8e\u4e00\u70b9\u201d\u5e72\u6389\u4e86\uff09\uff0c\u6240\u4ee5\u7b54\u6848\u9700\u8981\u7d2f\u52a0 $\\sum_{i=1}^{m}OQ_i \\times OP$\uff0c\u5c06\u53c9\u79ef\u5f0f\u5b50\u62c6\u5f00\uff0c\u5f97\u5230 $\\sum_{i=1}^{m}({Q_i}_{x}*P_{y}-{Q_i}_{y}*P_{x})$ $=(\\sum_{i=1}^{m}{Q_i}_{x})*P_{y}-(\\sum_{i=1}^{m}{Q_i}_{y})*P_{x}$\uff0c\u76f4\u63a5\u8bb0\u5f55\u4e0b\u5df2\u7ecf\u6c42\u51fa\u7684 $Q_i$ \u5750\u6807\u503c\u603b\u548c\u5373\u53ef\u3002\n\n\u6ce8\u610f\u6700\u540e\u7b54\u6848\u8981\u9664\u4ee5 $(2C_{n}^{3}=\\frac{n(n-1)(n-2)}{3})$ \u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^2)$ \u3002\n\n\uff08\u6ca1\u6709\u5361\u7cbe\u5ea6\u597d\u8bc4\uff09\n\n## **\u3010Code\u3011**\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<cmath>\n#define LD double\n#define LL long long\n#define Re register int\n#define Vector Point\nusing namespace std;\nconst int N=3003;\nconst LD eps=1e-8;\ninline int dcmp(LD a){return a<-eps?-1:(a>eps?1:0);}//\u5904\u7406\u7cbe\u5ea6\nstruct Point{\n    LD x,y;Point(LD X=0,LD Y=0){x=X,y=Y;}\n    inline void in(){scanf(\"%lf%lf\",&x,&y);}\n    inline void print(){printf(\"%.3lf %.3lf\\n\",x,y);}\n};\ninline void in(Re &x){\n    int f=0;x=0;char c=getchar();\n    while(c<'0'||c>'9')f|=c=='-',c=getchar();\n    while(c>='0'&&c<='9')x=(x<<1)+(x<<3)+(c^48),c=getchar();\n    x=f?-x:x;\n}\ninline LD Dot(Vector a,Vector b){return a.x*b.x+a.y*b.y;}//\u3010\u70b9\u79ef\u3011\ninline LD Cro(Vector a,Vector b){return a.x*b.y-a.y*b.x;}//\u3010\u53c9\u79ef\u3011\ninline LD Len(Vector a){return sqrt(Dot(a,a));}//\u3010\u6a21\u957f\u3011\ninline Vector operator+(Vector a,Vector b){return Vector(a.x+b.x,a.y+b.y);}\ninline Vector operator-(Vector a,Vector b){return Vector(a.x-b.x,a.y-b.y);}\ninline Vector operator*(Vector a,LD b){return Vector(a.x*b,a.y*b);}\ninline Point cross_LL(Point a,Point b,Point c,Point d){//\u3010\u4e24\u76f4\u7ebfAB,CD\u7684\u4ea4\u70b9\u3011\n    Vector x=b-a,y=d-c,z=a-c;\n    return a+x*(Cro(y,z)/Cro(x,y));//\u70b9A\u52a0\u4e0a\u5411\u91cfAF\n}\ninline int judge(Point a,Point L,Point R){//\u5224\u65adAL\u662f\u5426\u5728AR\u53f3\u8fb9\n    return dcmp(Cro(L-a,R-a))>0;//\u5fc5\u987b\u4e25\u683c\u4ee5\u5185\n}\nstruct Line{\n    Point a,b;LD k;Line(Point A=Point(0,0),Point B=Point(0,0)){a=A,b=B,k=atan2(b.y-a.y,b.x-a.x);}\n    inline bool operator<(const Line &O)const{return dcmp(k-O.k)?dcmp(k-O.k)<0:judge(O.a,O.b,a);}//\u5982\u679c\u89d2\u5ea6\u76f8\u7b49\u5219\u53d6\u5de6\u8fb9\u7684\n}L[N];\ninline Point cross(Line L1,Line L2){return cross_LL(L1.a,L1.b,L2.a,L2.b);}//\u83b7\u53d6\u76f4\u7ebfL1,L2\u7684\u4ea4\u70b9\nint n,a,b,c;LD x,y,ans;\nint main(){\n//    freopen(\"123.txt\",\"r\",stdin);\n    in(n);\n    for(Re i=1;i<=n;++i){\n        in(a),in(b),in(c);\n        if(!dcmp(a))L[i]=Line(Point(0,(LD)c/b),Point(1,(LD)c/b));//by=c -> y=c/b\n        else if(!dcmp(b))L[i]=Line(Point((LD)c/a,0),Point((LD)c/a,1));//ax=c -> x=c/a\n        else L[i]=Line(Point(0,(LD)c/b),Point(1,(LD)(c-a)/b));//ax+by=c -> y=(c-a*x)/b\n    }\n    sort(L+1,L+n+1);\n    for(Re i=1;i<=n;++i){\n        Point S,P;\n        for(Re j=i<n?i+1:1;j!=i;j=j<n?j+1:1)//\u6ce8\u610f\u8fd9\u91cc\u5e94\u8be5\u4ecei\u7684\u4e0b\u4e00\u4e2a\u5f00\u59cb\u679a\u4e3e\n            P=cross(L[i],L[j]),ans+=Cro(S,P),S=S+P;\n    }\n    printf(\"%lf\\n\",ans*3/n/(n-1)/(n-2));\n}\n```\n",
        "postTime": 1586590676,
        "uid": 110985,
        "name": "\u8fb0\u661f\u51cc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF528E \u3010Triangles 3000\u3011"
    },
    {
        "content": "$ O(n^{3}) $ \u66b4\u529b\u505a\u6cd5:\u679a\u4e3e\u4e09\u6761\u76f4\u7ebf\uff0c\u7b97\u51fa\u4e24\u4e24\u4e4b\u95f4\u4ea4\u70b9\uff0c\u5e76\u8ba1\u7b97\u4e09\u89d2\u5f62\u9762\u79ef\u3002\n***\n\u6211\u4eec\u8003\u8651\u8ba1\u7b97\u4e09\u89d2\u5f62\u9762\u79ef\u7684\u5f0f\u5b50\n$S_{ABC}=\\frac{1}{2}*(OA\\times OB+OB\\times OC+OC \\times OA) $\n\n\u90a3\u4e48\u6700\u7ec8\u7b54\u6848\u5176\u5b9e\u5c31\u662f$ \\sum $\uff08 \u539f\u70b9\u5230\u76f4\u7ebf\u4ea4\u70b9\u7684\u5411\u91cf\u4e24\u4e24\u4e4b\u95f4\u7684\u53c9\u79ef\uff09\n\n\u4f17\u6240\u5468\u77e5\uff0c\u53c9\u79ef\u662f\u5177\u6709\u5206\u914d\u7387\u7684\uff08\u6839\u636e\u5b9a\u4e49\u63a8\u4e00\u4e0b\u5f0f\u5b50\u5c31\u77e5\u9053\u4e86\uff09\n\n\u6211\u4eec\u679a\u4e3e\u4e24\u6761\u76f4\u7ebf\uff0c\u8003\u8651\u5f53\u524d\u4ea4\u70b9A\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3aOA$\\times \\sum $ (\u5176\u4ed6\u7684\u5411\u91cf\uff09\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u5411\u91cf\u7684\u524d\u7f00\u548c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5230$O(n^2)$\u5f97\u5230\u7b54\u6848\u4e86\n***\n#### \u6ce8\u610f\uff1a\u4e3a\u4e86\u4fdd\u8bc1\u53c9\u79ef\u7684\u987a\u5e8f\u6b63\u786e\uff0c\u9700\u8981\u5148\u5bf9\u76f4\u7ebf\u8fdb\u884c\u6781\u89d2\u6392\u5e8f\n***\n\u4e0b\u9762\u653e\u4ee3\u7801\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n#define re register\n#define FOR(i,a,b) for(i=a;i<=b;++i)\nusing namespace std;\nconst int N(3010);\ntypedef double ld;\nint n;\nld ans;\nstruct point\n{\n\tld x,y;\n\tpoint(){}\n\tinline point(ld xx,ld yy){x=xx;y=yy;}\n\tinline point operator -(const point&p)const{return point(x-p.x,y-p.y);}\n\tinline point operator +(const point&p)const{return point(x+p.x,y+p.y);}\n\tinline point operator *(const ld&p)const{return point(x*p,y*p);}\n}s,p;\ninline ld cross(const point&a,const point&b){return a.x*b.y-a.y*b.x;}\nstruct line\n{\n\tpoint s,v;\n\tld ang;\n\tline(){}\n\tinline line(const point&x,const point&y)\n\t{\n\t\ts=x;v=y-s;\n\t\tang=atan2(v.y,v.x);\n\t}\n\tinline bool operator <(const line&p)const{return ang<p.ang;}\n}L[N];\ninline point Intersect(const line&a,const line&b)\n{\n\tpoint v(a.s-b.s);\n\tld t(cross(v,b.v)/cross(b.v,a.v));\n\treturn a.s+a.v*t;\n}\ninline int read()\n{\n\tre int x(0),t(1);re char ch(getchar());\n\twhile((ch<'0'||ch>'9')&&ch!='-')ch=getchar();\n\tif(ch=='-')t=-1,ch=getchar();\n\twhile(ch>='0'&&ch<='9')x=x*10+(ch^'0'),ch=getchar();\n\treturn x*t;\n}\nint main()\n{\n\tre int i,j;\n\tre ld a,b,c;\n\tn=read();\n\tFOR(i,1,n)\n\t{\n\t\ta=read();b=read();c=read();\n\t\tif(a==0)L[i]=line(point(0,c/b),point(100,c/b));\n\t\telse if(b==0)L[i]=line(point(c/a,0),point(c/a,100));\n\t\telse L[i]=line(point(0,c/b),point(100,(a*-100+c)/b));\n\t}\n\tsort(L+1,L+n+1);//\u6781\u89d2\u6392\u5e8f\n\tFOR(i,1,n)\n\t{\n\t\ts=point(0,0);\n\t\tFOR(j,i+1,n)\n\t\t{\n\t\t\tp=Intersect(L[i],L[j]);\n\t\t\tans+=cross(s,p);s=s+p;\n\t\t}\n\t\tFOR(j,1,i-1)\n\t\t{\n\t\t\tp=Intersect(L[i],L[j]);\n\t\t\tans+=cross(s,p);s=s+p;\n\t\t}\n\t}\n\tans/=1.0*n*(n-1)*(n-2)/3;\n\tprintf(\"%.4f\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1565334327,
        "uid": 108254,
        "name": "colemak",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF528E \u3010Triangles 3000\u3011"
    }
]