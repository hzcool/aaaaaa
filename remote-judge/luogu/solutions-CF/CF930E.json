[
    {
        "content": "\u770b\u5230\u6709\u8001\u54e5\u8bf4\u4ec0\u4e48\u201c\u672c\u9898\u7684\u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u4e0d\u53bb\u60f3\u5bb9\u65a5\u201d\uff0c\u4e8e\u662f\u6765\u63d0\u4f9b\u4e00\u4e2a\u5bb9\u65a5\u505a\u6cd5\uff08\n\n\u6b64\u5bb9\u65a5\u505a\u6cd5\u6765\u6e90\u4e8e @Autumnkite \u7684\u6307\u5bfc\uff0c\u4ed6\u597d\u50cf\u8868\u793a\u8fd9\u662f\u5bb9\u65a5\u5957\u8def\u3002\n\n## \u9898\u89e3\n\n\u4e00\u4e2a\u6307\u6570\u7ea7\u505a\u6cd5\u662f\u76f4\u63a5\u94a6\u5b9a\u67d0\u4e9b\u533a\u95f4\u4e0d\u6ee1\u8db3\u6761\u4ef6\uff0c\u7136\u540e\u7b97\u5b83\u4eec\u7684\u5e76\u96c6\uff0c\u5b83\u4eec\u7684\u5bb9\u65a5\u7cfb\u6570\u662f $(-1)^{\\text{\u533a\u95f4\u4e2a\u6570}}\\times 2^{n-\\text{\u5e76\u96c6\u5927\u5c0f}}$\uff0c\u628a\u8fd9\u4e2a\u62c6\u89e3\u4e00\u4e0b\u5c31\u662f $(-1)^{\\text{\u533a\u95f4\u4e2a\u6570}} \\times \\dfrac{1}{2^{\\text{\u5e76\u96c6\u5927\u5c0f}}}$\uff0c\u9700\u8981\u503c\u5f97\u4e00\u63d0\u7684\u662f\u533a\u95f4\u5982\u679c\u6709\u76f8\u4ea4\u7684\uff0c\u90a3\u4e48\u5b83\u4eec\u7684\u79cd\u7c7b\u5e94\u5f53\u76f8\u540c\u3002\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4ee5\u4e0a\u7684\u66b4\u529b\u8fc7\u7a0b\u8fdb\u884c dp \u4f18\u5316\uff0c$f_{i}$ \u8868\u793a\u524d $i$ \u4e2a\u533a\u95f4\u91cc\u7b2c $i$ \u4e2a\u533a\u95f4\u5fc5\u987b\u9009\uff0c\u5176\u4ed6\u533a\u95f4\u968f\u4fbf\u9009\u7684\u5bb9\u65a5\u7cfb\u6570\u4e4b\u548c\u3002\n\n\u5bf9\u4e8e\u76f8\u79bb\u7684\u533a\u95f4\uff0c\u663e\u7136\u5bb9\u65a5\u7cfb\u6570\u5c31\u662f $-\\dfrac{1}{2^{r_i-l_i+1}}$\uff0c\u7b97\u4e0b $f_i$ \u7684\u524d\u7f00\u548c\u7136\u540e dp \u8f6c\u79fb\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5bf9\u4e8e\u76f8\u4ea4\u7684\u533a\u95f4\uff0c\u663e\u7136\u5982\u679c\u8fd9\u4e2a\u533a\u95f4\u8981\u8003\u8651\u7684\u8bdd\uff0c\u548c $i$ \u5e94\u5f53\u662f\u540c\u4e00\u4e2a\u79cd\u7c7b\u7684\u533a\u95f4\u3002\u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u600e\u4e48\u7b97\u5e76\u96c6\uff0c\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5e76\u96c6\u662f\u4ee5 $r_i-r_j$ \u7684\u5f62\u5f0f\u589e\u52a0\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u7b97\u4e00\u4e0b $f_j \\times 2^{-r_j}$ \u7684\u524d\u7f00\u548c\u5c31\u597d\u4e86\uff0cdp \u8f6c\u79fb\u8fc7\u7a0b\u4e5f\u662f\u5dee\u4e0d\u591a\u7684\u3002\n\n\u5305\u542b\u60c5\u51b5\u5982\u679c\u76f4\u63a5\u8003\u8651\u5bb9\u65a5\u5c31\u6bd4\u8f83\u590d\u6742\uff0c\u7136\u800c\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u533a\u95f4 $i$ \u5982\u679c\u5305\u542b\u67d0\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u5bf9\u5bb9\u65a5\u7cfb\u6570\u7684\u8d21\u732e\u662f $0$\uff08\u5177\u4f53\u8bc1\u660e\u7684\u8bdd\u5c31\u662f\u6839\u636e\u9898\u610f\uff0c\u533a\u95f4 $i$ \u663e\u7136\u65e0\u7528\uff09\uff0c\u4e00\u79cd\u5904\u7406\u65b9\u6cd5\u662f\u628a\u533a\u95f4\u6392\u5e8f\u540e\u8ba9 $l_i$ \u53d6\u524d\u7f00 $\\max$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u5305\u542b\u60c5\u51b5\u5904\u7406\u6210\u76f8\u4ea4\u60c5\u51b5\uff0c\u4e14\u5bf9\u5bb9\u65a5\u7cfb\u6570\u7684\u8d21\u732e\u4ecd\u7136\u662f $0$\u3002\n\n\u5982\u679c\u770b\u4e0d\u61c2\u7684\u8bdd\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5+5,mod=1e9+7,inv2=(mod+1)/2;\nint ksm(int b,int n){\n    int res=1;\n    while(n){\n        if(n&1) res=1ll*res*b%mod;\n        b=1ll*b*b%mod; n>>=1;\n    }\n    return res;\n}\nstruct segment{\n    int l,r,type;\n    bool operator < (const segment & b) const {\n        if(r == b.r) return l > b.l;\n        return r < b.r;\n    }\n}a[N],b[N],c[N];\nint f[N],s[N],sum[2][N];\nvoid merge(int n,int m){\n    int i=1,j=1,k=1;\n    while(i<=n && j<=m){\n        if(a[i]<b[j]) c[k++]=a[i++];\n        else c[k++]=b[j++];\n    }\n    while(i<=n) c[k++]=a[i++];\n    while(j<=m) c[k++]=b[j++];\n}\nint Find(int i,int val){\n    int p=0,l=1,r=i;\n    for(int cnt=0;cnt<=100;++cnt){\n        int mid=(l+r)>>1;\n        if(c[mid].r>val) p=mid,r=mid-1;\n        else l=mid+1;\n    }\n    return p;\n}\nsigned main(){\n    ios::sync_with_stdio(false);\n    int k,n,m;\n    cin>>k>>n>>m;\n    for(int i=1;i<=n;++i) cin>>a[i].l>>a[i].r,a[i].l--,a[i].type=0;\n    for(int i=1;i<=m;++i) cin>>b[i].l>>b[i].r,b[i].l--,b[i].type=1;\n    sort(a+1,a+n+1),sort(b+1,b+m+1);\n    for(int i=1;i<=n;++i) a[i].l=max(a[i-1].l,a[i].l);\n    for(int i=1;i<=m;++i) b[i].l=max(b[i-1].l,b[i].l);\n    merge(n,m);\n    int ans=1;\n    for(int i=1;i<=n+m;++i){\n        int t1=mod-ksm(inv2,c[i].r-c[i].l),t2=mod-ksm(inv2,c[i].r);\n        int p=Find(i,c[i].l);\n        f[i]=(1ll*t1*((p==0?0:s[p-1])+1)+1ll*t2*(p==i?0:(mod+sum[c[i].type][i-1]-sum[c[i].type][p-1])))%mod;\n        s[i]=(s[i-1]+f[i])%mod;\n        sum[!c[i].type][i]=sum[!c[i].type][i-1];\n        sum[c[i].type][i]=(sum[c[i].type][i-1]+1ll*f[i]*ksm(2,c[i].r))%mod;\n        ans=(ans+f[i])%mod;\n    }\n    cout<<1ll*ans*ksm(2,k)%mod;\n    return 0;\n}\n```\n",
        "postTime": 1633440161,
        "uid": 344016,
        "name": "wurzang",
        "ccfLevel": 7,
        "title": "CF930E \u9898\u89e3"
    },
    {
        "content": "\u9898\u5916\u8bdd\uff1a\u672c\u9898\u7684\u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u4e0d\u53bb\u60f3\u5bb9\u65a5\uff08\n\n___\n\u8003\u8651\u6b63\u9762\u4e3a 1\uff0c\u53cd\u9762\u4e3a 0\u3002\n\n\u5148\u6765\u8003\u8651\u6700\u6700\u66b4\u529b\u7684 dp\uff0c\u4e3a\u4e86\u8003\u8651\u9650\u5236\uff0c\u6211\u4eec\u8bbe $dp_{i,l_0,l_1}$ \u8868\u793a\u8003\u8651\u4e86\u524d i \u4e2a\u4f4d\u7f6e\uff0c\u4e0a\u4e00\u4e2a 0 \u5728 $l_0$\uff0c\u4e0a\u4e00\u4e2a 1 \u5728 $l_1$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\u90fd\u975e\u5e38\u663e\u7136\uff0c\u5904\u7406\u9650\u5236\u5c31\u76f4\u63a5\u5c06\u4e0d\u5408\u6cd5\u7684 dp \u503c\u7f6e\u4e3a 0 \u5373\u53ef\u3002\u4f46\u662f\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(k^3)$\u3002\n\n\u4e00\u4e2a\u975e\u5e38\u663e\u7136\u7684\u6027\u8d28\u2014\u2014\u6700\u540e\u4e00\u4f4d\u5fc5\u7136\u662f 0 \u6216 1\u3002\u6211\u4eec\u53ef\u4ee5\u636e\u6b64\u780d\u6389\u4e00\u7ef4\u3002\n\n\u6211\u4eec\u73b0\u5728\u8bbe $dp_{0,i,l_1},dp_{1,i,l_0}$ \u5206\u522b\u8868\u793a\u6700\u540e\u4e00\u4f4d\u662f 0/1\uff0c\u73b0\u5728\u8003\u8651\u4e86\u524d $i$ \u4f4d\uff0c\u4e0a\u4e00\u4e2a 1/0 \u5728 $l_{1/0}$ \u65f6\u7684\u65b9\u6848\u6570\u3002\n\n\u4e00\u5207\u4f9d\u65e7\u5f88\u663e\u7136\uff0c\u4f46\u662f\u590d\u6742\u5ea6\u4f9d\u7136\u9ad8\u8fbe $O(k^2)$\u3002\n\n\u6309\u7167\u4e00\u822c\u5957\u8def\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u503c\u57df\u5f88\u5927\u4f46\u662f\u6d89\u53ca\u5230\u7684\u5750\u6807\u5f88\u5c11\u7684\u9898\uff0c\u8003\u8651**\u79bb\u6563\u5316**\u540e\u6c42\u89e3\u3002\n\n\u6216\u8005\u8bf4\u56e0\u4e3a\uff0c\u4e3a\u4e86\u5904\u7406\u9650\u5236\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5173\u5fc3\u4e0a\u4e00\u4e2a 0/1 \u5728\u67d0\u4e24\u4e2a\u79bb\u6563\u5316\u540e\u7684\u70b9\u4e4b\u95f4\u7684\u5177\u4f53\u54ea\u4e2a\u4f4d\u7f6e\uff0c\u53ea\u9700\u8981\u77e5\u9053\u5728\u8fd9\u4e24\u4e2a\u4e4b\u95f4\u5373\u53ef\u3002\u6240\u4ee5\u53ef\u4ee5\u79bb\u6563\u5316\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c06\u6240\u6709\u9650\u5236\u4e2d\u7684 $l_i,r_i$ \u4e22\u53bb\u79bb\u6563\u5316\uff0c\u8bbe $\\{\\text{lsh}\\}$ \u4e3a\u79bb\u6563\u5316\u7684\u524d\u7684\u503c\u3002\n\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u91cd\u5b9a\u4e49 dp \u6570\u7ec4\u7684\u6700\u540e\u4e00\u7ef4\u2014\u2014\u5176\u4e3a $x$ \u8868\u793a\u771f\u6b63\u7684 0/1 \u5904\u4e8e $\\text{lsh}_{x-1}+1\\sim \\text{lsh}_x$ \u4e4b\u95f4\u3002\n\n\u6765\u91cd\u65b0\u8003\u8651\u8f6c\u79fb\u4e0e\u9650\u5236\u3002\u4e0d\u5931\u4e00\u822c\u6027\uff0c\u6211\u4eec\u53ea\u8003\u8651 $dp_{0,i,l_1}$ \u5f80\u540e\u7684\u8f6c\u79fb\uff0c\u5bf9\u4e8e $dp_{1,i,l_0}$ \u7684\u601d\u8def\u5f88\u5bf9\u79f0\u3002\n\n\u5904\u7406\u8f6c\u79fb\u7684\u601d\u8def\u663e\u7136\u662f\uff1a\u8865\u4e0a $\\text{lsh}_i+1\\sim\\text{lsh}_{i+1}$ \u7684 0/1\uff0c\u770b\u4e0d\u540c\u7684\u586b\u6cd5\u4f1a\u8f6c\u79fb\u5230\u54ea\u4e9b\u4f4d\u7f6e\u3002\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n- \u5982\u679c\u5168\u90e8\u586b 0\uff0c$1\\times dp_{0,i,l_1}\\rightarrow dp_{0,i+1,l_1}$\u3002\n\n- \u5982\u679c\u5168\u90e8\u586b 1\uff0c$1\\times dp_{0,i,l_1}\\rightarrow dp_{1,i+1,i}$\u3002\n\n- \u5982\u679c 0/1 \u6df7\u6742\uff0c\u90a3\u4e48\u6211\u4eec\u56fa\u5b9a\u6700\u540e\u4e00\u4f4d\uff0c\u5e76\u4e14\u5f3a\u5236\u4e0d\u80fd\u4e0e\u4e0a\u9762\u4e24\u79cd\u8f6c\u79fb\u91cd\u590d\uff1a$(2^{\\text{lsh}_{i+1}-\\text{lsh}_i-1}-1)\\times dp_{0,i,l_1}\\rightarrow \\begin{cases}dp_{0,i+1,i+1}\\\\dp_{1,i+1,i+1}\\end{cases}$\u3002\n\n\u5904\u7406\u9650\u5236\u65f6\uff0c\u6211\u4eec\u5bf9\u4e8e\u79bb\u6563\u5316\u540e\u53f3\u7aef\u70b9\u5728 $i+1$ \u7684\u6bcf\u4e00\u4e2a \u201c$[l,i+1]$ \u4e2d\u81f3\u5c11\u4e00\u4e2a 1\u201d \u7684\u9650\u5236\uff0c\u5c06 $l_1<l$ \u7684 $dp_{0,i,l_1}$ \u56e0\u4e0d\u5408\u6cd5\u7f6e 0 \u5373\u53ef\u3002\n\n\u6709\u4e9b\u8bfb\u8005\u5728\u8fd9\u91cc\u4f1a\u53d1\u73b0\u4e00\u4e2a\u95ee\u9898\u2014\u2014\u5982\u679c $l_1 = l$\uff0c\u90a3\u4e48\u6709\u53ef\u80fd\u5408\u6cd5\u4e5f\u6709\u53ef\u80fd\u4e0d\u5408\u6cd5\uff1f\u7684\u786e\u5982\u6b64\uff0c\u6211\u4eec\u9700\u8981\u89c4\u907f\u8fd9\u4e00\u70b9\u3002\n\n\u89e3\u51b3\u65b9\u6848\u662f\uff1a\u5c06\u6240\u6709 $l_i -1$ \u4e5f\u653e\u8fdb\u53bb\u79bb\u6563\u5316\u5373\u53ef\u3002\u6b63\u786e\u6027\u663e\u7136\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a $O((n+m)^2\\log k)$ \u7684\u505a\u6cd5\uff0c\u6765\u63a5\u7740\u4f18\u5316\u3002\n\n\u4f18\u5316\u601d\u8def\u662f\uff1a\u6211\u4eec\u628a $i$ \u8fd9\u4e00\u7ef4\u6eda\u52a8\uff0c**\u5feb\u901f\u5904\u7406 $dp_{0,l_1}$ \u7684\u53d8\u5316**\u5373\u53ef\u3002\n\n- \u5bf9\u4e8e\u7b2c\u4e00\u79cd\u8f6c\u79fb\uff0c\u76f8\u5f53\u4e8e\u539f\u5c01\u4e0d\u52a8\u7684 copy\uff0c\u4e0d\u8ba8\u8bba\u3002\n\n- \u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u8f6c\u79fb\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u6240\u6709\u7684 $l_1$\uff0cdp \u503c\u90fd\u4f1a\u8f6c\u79fb\u81f3 $dp_{1,i+1,i}$\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u52a8\u6001\u7ef4\u62a4 $\\sum_{l_1}dp_{0,i,l_1}$ \u5373\u53ef\u5b8c\u6210\u8f6c\u79fb\u3002\n\n- \u7b2c\u4e09\u79cd\u60c5\u51b5\u7c7b\u4f3c\u3002\n\n\u4f46\u662f\u6211\u4eec\u8fd8\u9700\u8981\u52a8\u6001\u5730\u652f\u6301\u5c06\u4e00\u6bb5\u524d\u7f00\u7f6e 0 \u7684\u64cd\u4f5c\u3002\u4f60\u53ef\u4ee5\u91c7\u7528\u7ebf\u6bb5\u6811\u7b49\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\uff0c\u4f46\u662f\u5927\u53ef\u4e0d\u5fc5\u3002\n\n\u53d1\u73b0\u8f6c\u79fb\u4e2d\uff0c\u53ea\u6709 $dp_{0/1,i+1,i/i+1}$ \u53ef\u80fd\u4f1a\u5f97\u5230\u65b0\u7684\u503c\uff0c\u6362\u8a00\u4e4b\uff0c\u4e00\u65e6\u4e00\u4e2a\u4f4d\u7f6e\u88ab\u7f6e 0\uff0c\u90a3\u4ed6\u5c31\u6c38\u8fdc\u4e3a 0\u3002\n\n\u4e8e\u662f\u4e3a 0 \u7684\u90e8\u5206\u662f\u4e00\u4e2a\u968f\u7740 $i$ \u589e\u52a0\uff0c\u957f\u5ea6\u4e0d\u964d\u7684\u524d\u7f00\u3002\u6211\u4eec\u7528\u4e00\u4e2a\u6307\u9488\u7ef4\u62a4\u90a3\u4e2a\u524d\u7f00\u4f4d\u7f6e\u5c31\u53ef\u4ee5\u505a\u5230\u5747\u644a\u7ebf\u6027\u3002\n\n\u8fd9\u4e0b\u771f\u7684\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)(\\log(n+m)+\\log k))$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nconst int maxn = 1e5+5,maxM = 6e5+5,mod = 1e9+7,i2 = 5e8+4;\ninline int ksm(int a,int x){\n\tint bas = a,ans = 1;\n\twhile(x){\n\t\tif(x&1)ans = 1ll*ans*bas%mod;\n\t\tbas = 1ll*bas*bas%mod,x >>= 1;\n\t}return ans;\n}\nint k,n,m,lsh[maxM],M;\nvoid gmax(int &x,int v){(x<v?x=v:0);}\nint getId(int x){return std :: lower_bound(lsh+1,lsh+M+1,x)-lsh;}\nstruct itv{int l,r;}b[maxn],w[maxn];\nint dp[2][maxM],maxb[maxM],maxw[maxM];\nint main(){\n\tscanf(\"%d %d %d\",&k,&n,&m),lsh[++M] = 0,lsh[++M] = k;\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d %d\",&b[i].l,&b[i].r),lsh[++M] = b[i].l,lsh[++M] = b[i].l-1,lsh[++M] = b[i].r;\n\tfor(int i=1;i<=m;++i)\n\t\tscanf(\"%d %d\",&w[i].l,&w[i].r),lsh[++M] = w[i].l,lsh[++M] = w[i].l-1,lsh[++M] = w[i].r;\n\tstd :: sort(lsh+1,lsh+M+1),M = std :: unique(lsh+1,lsh+M+1)-lsh-1;\n\tfor(int i=1;i<=n;++i)gmax(maxb[getId(b[i].r)],getId(b[i].l));\n\tfor(int i=1;i<=m;++i)gmax(maxw[getId(w[i].r)],getId(w[i].l));\n\tdp[0][1] = dp[1][1] = 1;int sum0=1,sum1=1,pos0=0,pos1=0;\n\tfor(int i=1,t;i<M;++i){\n\t\tdp[1][i] = (dp[1][i]+sum0)%mod,dp[0][i] = (dp[0][i]+sum1)%mod;\n\t\tt = 1ll*(ksm(2,lsh[i+1]-lsh[i]-1)-1)*(sum0+sum1)%mod;\n\t\tdp[0][i+1] = (dp[0][i+1]+t)%mod,dp[1][i+1] = (dp[1][i+1]+t)%mod;\n\t\tsum0 = sum1 = (1ll*t+sum0+sum1)%mod;\n\t\twhile(pos0+1<maxw[i+1])sum0 = (sum0-dp[0][++pos0]+mod)%mod;\n\t\twhile(pos1+1<maxb[i+1])sum1 = (sum1-dp[1][++pos1]+mod)%mod;\n\t}\n\treturn printf(\"%d\\n\",1ll*(sum0+sum1)*i2%mod),0;\n}\n```",
        "postTime": 1631666623,
        "uid": 114153,
        "name": "Sali\u0435ri",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF930E"
    },
    {
        "content": "\u770b\u5230\u9898\u5c31\u5148\u5bb9\u65a5\u3002\u7136\u540e\u5bb9\u65a5\u7cfb\u6570\u592a\u96be\u7b97\u4e86\u5c31\u5bc4\u4e86\uff0c\u5927\u6982\u8981\u5206\u597d\u51e0\u79cd\u60c5\u51b5\u8ba8\u8bba\uff0c\u4e8e\u662f\u5c31\u5f03\u4e86\u3002\n\n\u4e0d\u5bb9\u65a5\u4e5f\u80fd\u505a\u3002\u8003\u8651\u9650\u5236\u5c06\u4e32\u5212\u5206\u6210\u4e86\u82e5\u5e72\u6bb5\uff0c\u7136\u540e\u4e00\u6bb5\u4e00\u6bb5 dp\uff0e\n\n\u6709\u6ca1\u6709\u4ec0\u4e48\u597d\u7684\u65b9\u6cd5\u63cf\u8ff0\u8fd9\u4e2a\u6027\u8d28\uff1f\u8fd9\u91cc\u8003\u8651\u7684\u662f\uff0c\u5982\u679c\u5f3a\u5236 $[l,r]$ \u81f3\u5c11\u51fa\u73b0\u4e00\u4e2a $1$\uff0c\u90a3\u4e48\u5c31\u8ba9 $r$ \u53ca\u4ee5\u540e\u7684\u70b9\uff0c\u8ba9\u5b83\u4eec\u5f80\u524d\u627e\u7b2c\u4e00\u4e2a $1$ \u7684\u4f4d\u7f6e\u8981 $\\geq l$\uff0e$0$ \u4e5f\u7c7b\u4f3c\u8ba1\u7b97\u4e00\u4e2a\u8fd9\u4e2a\u4e1c\u897f\u3002\n\n\u7136\u540e dp\uff0c$f_i,g_i,h_i$ \u5206\u522b\u8868\u793a\uff0c\u7b2c $i$ \u4e2a\u7aef\u70b9\u7ed3\u5c3e\u7684\u8fd9\u4e00\u6bb5\uff0c\u5168\u9009 $0$\uff0c\u5168\u9009 $1$\uff0c\u65e2\u6709 $0$ \u53c8\u6709 $1$ \u7684\u65b9\u6848\u6570\u3002\u5373\u6709\u8f6c\u79fb $h_i=(2^{len_i}-2)(f_{i-1}+g_{i-1}+h_{i-1})$\uff0e\n\n\u800c $f$ \u7684\u8f6c\u79fb\u5c31\u662f\u679a\u4e3e\u4e0a\u4e00\u4e2a $0$ \u5728\u54ea\u4e00\u6bb5\u91cc\u9762\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5c31\u662f\u4e00\u4e2a\u540e\u7f00\u7684 $g$ \u548c $h$ \u7684\u548c\u3002\u524d\u7f00\u548c\u4f18\u5316\u8f6c\u79fb\u5373\u53ef\u3002$g$ \u7684\u8f6c\u79fb\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef pair<int,ll>pil;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntypedef vector<pil>vpil;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x,T2& ...y){read(x);read(y...);}\nconst int mod=1000000007;\ninline void cadd(int &x,int y){x=(x+y>=mod)?(x+y-mod):(x+y);}\ninline void cdel(int &x,int y){x=(x-y<0)?(x-y+mod):(x-y);}\ninline int add(int x,int y){return (x+y>=mod)?(x+y-mod):(x+y);}\ninline int del(int x,int y){return (x-y<0)?(x-y+mod):(x-y);}\nint qpow(int x,int y){\n\tint s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn s;\n}\nconst int N=2000010;\nint k,n,m;\nint p[N],tot,p1[N],p2[N];\nint f[N],g[N],h[N],F[N],G[N],H[N];\npii a[N],b[N];\nint pos(int x){\n\treturn lower_bound(p+1,p+tot+1,x)-p;\n}\nint calc(int *a,int l,int r){\n\treturn del(a[r],a[l]);\n}\nsigned main(){\n\t#ifdef do_while_true\n//\t\tassert(freopen(\"data.in\",\"r\",stdin));\n//\t\tassert(freopen(\"data.out\",\"w\",stdout));\n\t#endif\n\tread(k,n,m);\n\tp[++tot]=k;p[++tot]=0;\n\tfor(int i=1;i<=n;i++){\n\t\tread(a[i].fi,a[i].se);--a[i].fi;\n\t\tp[++tot]=a[i].fi,p[++tot]=a[i].se;\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tread(b[i].fi,b[i].se);--b[i].fi;\n\t\tp[++tot]=b[i].fi,p[++tot]=b[i].se;\n\t}\n\tsort(p+1,p+tot+1);\n\ttot=unique(p+1,p+tot+1)-p-1;\n\tfor(int i=1;i<=n;i++)\n\t\tcmax(p1[pos(a[i].se)],pos(a[i].fi));\n\tfor(int i=1;i<=m;i++)\n\t\tcmax(p2[pos(b[i].se)],pos(b[i].fi));\n\tfor(int i=1;i<=tot;i++)cmax(p1[i],p1[i-1]),cmax(p2[i],p2[i-1]);\n//\tfor(int i=1;i<=tot;i++)cout << p1[i] << ' ' << p2[i] << '\\n';\n\th[1]=H[1]=1;\n\tfor(int i=2;i<=tot;i++){\n\t\tf[i]=add(calc(G,p1[i],i-1),calc(H,p1[i],i-1));\n\t\tg[i]=add(calc(F,p2[i],i-1),calc(H,p2[i],i-1));\n\t\th[i]=1ll*del(qpow(2,p[i]-p[i-1]),2)*add(add(f[i-1],g[i-1]),h[i-1])%mod;\n\t\tF[i]=add(F[i-1],f[i]);\n\t\tG[i]=add(G[i-1],g[i]);\n\t\tH[i]=add(H[i-1],h[i]);\n//\t\tcout << f[i] << ' ' << g[i] << ' ' << h[i] << '\\n';\n\t}\n\tcout << add(add(f[tot],g[tot]),h[tot]) << '\\n';\n    #ifdef do_while_true\n\t\tcerr<<'\\n'<<\"Time:\"<<1.0*clock()/CLOCKS_PER_SEC*1000<<\" ms\"<<'\\n';\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1667357002,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dCodeforces 930E Coins Exhibition"
    },
    {
        "content": "\u770b\u4e0a\u53bb\u4e0d\u597d\u4e0b\u624b\uff0c\u6211\u4eec\u5e94\u8be5\u4ece\u66b4\u529b\u51fa\u53d1\u3002\n\n\u9996\u5148\u6765\u4e00\u4e2a\u4e0d\u7528\u8111\u5b50\u7684\u66b4\u529b\uff1a\u8bbe $f_{i,0/1,j}$ \u8868\u793a\u5904\u7406\u4e86\u524d $i$ \u4e2a\u4f4d\u7f6e\uff0c$a_i=0/1$\uff0c\u4e14 $j$ \u4e3a\u6700\u8fd1\u4e00\u4e2a\u6ee1\u8db3 $a_j \\neq a_i$ \u7684\u4f4d\u7f6e\u7684\u5408\u6cd5\u65b9\u6848\u6570\u3002\u76f4\u63a5\u505a\u590d\u6742\u5ea6 $O(k^2)$\uff0c\u80af\u5b9a\u662f\u4e0d\u884c\u7684\u3002\n\n\u5f53\u7136\u6211\u4eec\u9700\u8981\u79bb\u6563\u5316\u4e00\u4e0b\uff0c\u6539\u6210\u4e00\u6bb5\u4e00\u6bb5\u533a\u95f4\u8f6c\u79fb\u3002\u6211\u4eec\u8bb0\u79bb\u6563\u5316\u540e\u7b2c $i$ \u6bb5\u533a\u95f4\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u4e3a $r_i$\u3002\n\n\u4fee\u6539\u4e00\u4e0b dp \u72b6\u6001\uff1a$f_{i,0/1,j}$ \u8868\u793a\u5904\u7406\u5230\u7b2c $i$ \u4e2a\u533a\u95f4\uff0c$a_{r_i}=0/1$\uff0c \u4e0a\u4e00\u4e2a\u6ee1\u8db3 $a_x \\neq a_{r_i}$ \u7684\u4f4d\u7f6e $x$ \u5904\u5728\u7b2c $j$ \u4e2a\u533a\u95f4\u7684\u5408\u6cd5\u65b9\u6848\u6570\u3002\u4ee5 $f_{i,0,j}$ \u4e3a\u4f8b\uff0c\u4f9d\u6b21\u8003\u8651\u4ee5\u4e0b\u8f6c\u79fb\uff1a\n\n1. \u6574\u4e2a\u533a\u95f4\u5168\u90e8\u586b $0$\n\n$f_{i,0,j} \\to f_{i+1,0,j}$\n\n2. \u6574\u4e2a\u533a\u95f4\u5168\u90e8\u586b $1$\n\n$f_{i,0,j} \\to f_{i+1,1,i}$\n\n3. \u533a\u95f4\u5185\u6709 $0$ \u548c $1$\uff0c\u4e14 $a_{r_i}=0$\n\n$f_{i,0,j} \\times (2^{len_i-1}-1) \\to f_{i+1,0,i+1}$\n\n4. \u533a\u95f4\u5185\u6709 $0$ \u548c $1$\uff0c\u4e14 $a_{r_i}=1$\n\n$f_{i,0,j} \\times (2^{len_i-1}-1) \\to f_{i+1,1,i+1}$\n\n\u5176\u4e2d $len_i$ \u8868\u793a\u7b2c $i$ \u6bb5\u533a\u95f4\u7684\u957f\u5ea6\u3002\n\n\u5bf9\u4e8e $f_{i,1,j}$ \u7684\u8f6c\u79fb\u662f\u7c7b\u4f3c\u7684\u3002\n\n\u518d\u8003\u8651\u53bb\u9664\u6389\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\uff0c\u6bcf\u4e00\u5c42 $i$ \u8f6c\u79fb\u5b8c\u540e\uff0c\u6211\u4eec\u5bf9\u4e8e\u5f62\u5982 $[0/1,x,i+1]$ \u7684\u9650\u5236\uff0c\u5c06\u5bf9\u5e94\u7684 $f_{i+1,1/0,j}(j<x)$ \u7f6e\u4e3a $0$ \u5373\u53ef\u3002\u6b64\u65f6\u4f60\u5e94\u8be5\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u5728\u79bb\u6563\u5316\u65f6\u9700\u8981\u5c06 $x-1$ \u4e5f\u8fdb\u884c\u79bb\u6563\u5316\uff0c\u5426\u5219 $x$ \u4e4b\u524d\u6240\u5728\u7684\u4e00\u6bb5\u4f1a\u6ca1\u6709\u88ab\u8986\u76d6\u5230\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $O((n+m)^2)$ \u7684\u505a\u6cd5\u3002\u5b83\u8fd8\u662f\u8fc7\u4e0d\u4e86\u3002\n\n```cpp\n    f[1][0][1]=1;\n    for(int i=1;i<lcnt;i++){\n        int siz=b[i+1]-b[i],val=(qpow(siz-1)+mod-1)%mod;\n        for(int j=1;j<=i;j++){\n            (f[i+1][0][j] += f[i][0][j]) %= mod;\n            (f[i+1][1][i] += f[i][0][j]) %= mod;\n            (f[i+1][0][i+1] += 1ll*val*f[i][0][j]%mod) %= mod;\n            (f[i+1][1][i+1] += 1ll*val*f[i][0][j]%mod) %= mod;\n            (f[i+1][1][j] += f[i][1][j]) %= mod;\n            (f[i+1][0][i] += f[i][1][j]) %= mod;\n            (f[i+1][1][i+1] += 1ll*val*f[i][1][j]%mod) %= mod;\n            (f[i+1][0][i+1] += 1ll*val*f[i][1][j]%mod) %= mod;\n        }\n        for(int j=0;j<q[i+1].size();j++)\n            for(int k=0;k<q[i+1][j].l;k++)\n                f[i+1][q[i+1][j].v^1][k]=0;\n    }\n    for(int j=1;j<=lcnt;j++) (ans += (f[lcnt][0][j]+f[lcnt][1][j])%mod ) %= mod;\n    printf(\"%d\\n\",ans);\n```\n\n\n\u4f46\u5176\u5b9e\u63a5\u4e0b\u6765\u7684\u4f18\u5316\u662f\u7b80\u5355\u7684\u3002\u6211\u4eec\u8003\u8651\u8ddf\u968f $i$ \u7684\u79fb\u52a8\uff0c\u52a8\u6001\u7ef4\u62a4\u6574\u4e2a dp \u8fc7\u7a0b\u3002\u5bf9\u5e94\u4e0a\u9762\u8f6c\u79fb\u7684\u6807\u53f7\uff1a\n\n- 1 \u548c 2 \u4e0d\u9700\u8981\u505a\u4efb\u4f55\u4e8b\u3002\n\n- 3 \u548c 4 \u4e8b\u5b9e\u4e0a\u662f\u4e00\u4e2a **\u5168\u5c40\u548c** \u7684\u5f62\u5f0f\u3002\n\n- \u53bb\u9664\u6389\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\u76f8\u5f53\u4e8e\u524d\u7f00\u63a8\u5e73\u4e3a $0$\u3002\n\n\u8fd9\u5176\u5b9e\u90fd\u4e0d\u9700\u8981\u4efb\u4f55\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5bf9\u4e8e\u524d\u7f00\u7ef4\u62a4\u63a8\u5e73\u6307\u9488\uff08\u663e\u7136\u4e00\u4e2a\u4f4d\u7f6e\u88ab\u63a8\u5e73\u540e\u5c31\u6c38\u8fdc\u90fd\u662f $0$ \u4e86\uff09\uff0c\u5e76\u7ef4\u62a4\u597d $0/1$ \u7684\u5168\u5c40\u548c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((n+m) \\log (n+m) + (n+m) \\log k)$\uff0c\u524d\u9762\u662f\u79bb\u6563\u5316\u7684\u590d\u6742\u5ea6\uff0c\u540e\u9762\u662f\u7b97\u8d21\u732e\u90a3\u91cc\u6c42\u4e00\u4e2a\u5feb\u901f\u5e42\u7684\u590d\u6742\u5ea6\u3002\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nconst int N=600005;\nconst int mod=1000000007;\ninline int read(){\n    int x=0,f=1; char c=getchar();\n    while(c<'0'||c>'9'){ if(c=='-') f=-1; c=getchar(); }\n    while(c>='0'&&c<='9') x=x*10+c-'0',c=getchar();\n    return x*f;\n}\n/*\ndp[i][0/1][j] : \u5904\u7406\u5230\u7b2c i \u4e2a\u533a\u95f4 sta[r[i]]=0/1 \u4e0a\u4e00\u4e2a\u4e0e sta[r[i]] \u4e0d\u4e00\u6837\u7684\u4f4d\u7f6e\u5728\u7b2c j \u4e2a\u533a\u95f4 \n1.dp[i][0][j] -> dp[i+1][0][j]\n2.dp[i][0][j] -> dp[i+1][1][i]\n3.dp[i][0][j]*(2^(len-1)-1) -> dp[i+1][0/1][i+1]\n\n1.dp[i][1][j] -> dp[i+1][1][j]\n2.dp[i][1][j] -> dp[i+1][0][i]\n3.dp[i][1][j]*(2^(len-1)-1) -> dp[i+1][0/i][i+1]\n\n\u8003\u8651\u52a8\u6001\u7ef4\u62a4\n1. \u4e0d\u7528\u52a8\n2. \u4e00\u4e2a\u5168\u5c40\u548c\u7684\u5f62\u5f0f\n3. \u4e00\u4e2a\u5168\u5c40\u548c\u7684\u5f62\u5f0f\n4. \u524d\u7f00\u63a8\u5e73\u4e3a 0\n\u4e0d\u9700\u8981 ds \u5c31\u80fd\u7ef4\u62a4\n*/\nint K,m,n,lcnt,b[N],dp[2][N],sum[2],pos[2]={1,1},ans;\nstruct A{\n    int l,r;\n}a[N];\nstruct Q{\n    int l,v;\n};  vector<Q>q[N];\ninline int qpow(int y){\n    int x=2,r=1;\n    while(y){\n        if(y&1) r=1ll*r*x%mod;\n        x=1ll*x*x%mod;\n        y>>=1;\n    }\n    return r;\n}\nint main(){\n    K=read(),n=read(),m=read();\n    for(int i=1;i<=n;i++){\n        a[i].l=read(),a[i].r=read();\n        b[++lcnt]=a[i].l-1; b[++lcnt]=a[i].l; b[++lcnt]=a[i].r;\n    }\n    for(int i=n+1;i<=n+m;i++){\n        a[i].l=read(),a[i].r=read();\n        b[++lcnt]=a[i].l-1; b[++lcnt]=a[i].l; b[++lcnt]=a[i].r;\n    }\n    b[++lcnt]=0; b[++lcnt]=1; b[++lcnt]=K;\n    sort(b+1,b+lcnt+1); lcnt=unique(b+1,b+lcnt+1)-b-1;\n    for(int i=1;i<=n+m;i++){\n        int j=lower_bound(b+1,b+lcnt+1,a[i].r)-b,k=lower_bound(b+1,b+lcnt+1,a[i].l)-b;\n        q[j].emplace_back(Q{k,(i>n)});\n    }\n    dp[0][1]=sum[0]=1;\n    for(int i=1;i<lcnt;i++){\n        int siz=b[i+1]-b[i],val=(qpow(siz-1)+mod-1)%mod,tot=(sum[0]+sum[1])%mod;\n        (dp[0][i] += sum[1]) %= mod;\n        (dp[0][i+1] += 1ll*tot*val%mod) %= mod;\n        (dp[1][i] += sum[0]) %= mod;\n        (dp[1][i+1] += 1ll*tot*val%mod) %= mod;\n        int nxt = ( (sum[0] + sum[1]) % mod + 1ll*tot*val%mod ) % mod;\n        sum[0]=sum[1]=nxt;\n        for(int j=0;j<q[i+1].size();j++){\n            int op=q[i+1][j].v^1;\n            while(pos[op]<q[i+1][j].l)\n                (sum[op]+=mod-dp[op][pos[op]])%=mod,dp[op][pos[op]]=0,pos[op]++;\n        }\n    }\n    for(int j=1;j<=lcnt;j++) (ans += (dp[0][j]+dp[1][j])%mod ) %= mod;\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1676372795,
        "uid": 236862,
        "name": "DitaMirika",
        "ccfLevel": 7,
        "title": "CF930E"
    },
    {
        "content": "# [CF930E]/[CF944G]Coins Exhibition\n\n### \u9898\u76ee\u5730\u5740\uff1a\n\n[CF930E](http://codeforces.com/contest/930/problem/E)/[CF944G](http://codeforces.com/contest/944/problem/G)\n\n### \u535a\u5ba2\u5730\u5740\uff1a\n\n[[CF930E]/[CF944G]Coins Exhibition - skylee](https://www.cnblogs.com/skylee03/p/9078791.html)\n\n### \u9898\u76ee\u5927\u610f\uff1a\n\n\u4e00\u4e2a\u957f\u5ea6\u4e3a$k(k\\le10^9)$\u7684$01$\u4e32\uff0c\u7ed9\u51fa$n+m(n,m\\le10^5)$\u4e2a\u7ea6\u675f\u6761\u4ef6\uff0c\u5176\u4e2d$n$\u6761\u63cf\u8ff0\u533a\u95f4$[l_i,r_i]$\u81f3\u5c11\u6709\u4e00\u4e2a$0$\uff0c\u5176\u4e2d$m$\u6761\u63cf\u8ff0\u533a\u95f4$[l_i,r_i]$\u81f3\u5c11\u6709\u4e00\u4e2a$1$\u3002\u6c42\u5408\u6cd5\u7684$01$\u4e32\u6570\u91cf\u3002\n\n### \u601d\u8def\uff1a\n\n\u663e\u7136\u76f4\u63a5\u8003\u8651\u6240\u6709\u7684$k$\u4f4d\uff0c\u5c31\u7b97$\\mathcal O(k)$\u7684\u7ebf\u6027\u7b97\u6cd5\u4e5f\u4f1a\u8d85\u65f6\uff0c\u56e0\u6b64\u5bf9\u4e8e\u6240\u6709\u7684$l_i-1,r_i$\u4ee5\u53ca$0,k$\u79bb\u6563\u5316\u4ee5\u540e\u8003\u8651\u8fd9\u4e9b\u5173\u952e\u70b9\u5373\u53ef\u3002\n\n\u8bbe\u5173\u952e\u70b9\u6709$lim$\u4e2a\uff0c\u5bf9\u6240\u6709\u5173\u952e\u70b9\u6392\u5e8f\uff0c$tmp[i]$\u4e3a$i$\u79bb\u6563\u5316\u524d\u5bf9\u5e94\u7684\u6570\u3002\u5bf9\u6240\u6709\u5173\u952e\u70b9\u6392\u5e8f\uff0c\u8003\u8651\u52a8\u6001\u89c4\u5212\uff0c\u8bbe$f[i][j\\in\\{0,1,2\\}]$\u8868\u793a\u4ece\u540e\u5f80\u524d\u8003\u8651\u7b2c$i\\sim lim$\u4e2a\u5173\u952e\u70b9\u3002\u82e5$j\\in\\{0,1\\}$\uff0c\u5219$f[i][j]$\u8868\u793a$tmp[i]\\sim tmp[i+1]$\u4e2d\u542b\u6709$j$\u7684\u65b9\u6848\u6570\u540e\u7f00\u548c\u3002\u82e5$j=2$\uff0c\u5219$f[i][j]$\u8868\u793a\u6700\u540e\u4e00\u6bb5\u540c\u65f6\u6709$0$\u548c$1$\u7684\u65b9\u6848\u6570\u3002\u7528$min[j\\in\\{0,1\\}][i]$\u8868\u793a\u5bf9\u5e94\u7ea6\u675f\u6761\u4ef6\u7c7b\u578b\u4e3a$j$\uff0c$i$\u53f3\u4fa7\u6700\u8fd1\u7684\u3001\u5bf9\u5e94\u5de6\u7aef\u70b9\u4e0d\u5728$i$\u5de6\u4fa7\u7684\u53f3\u7aef\u70b9\u3002\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b\uff1a\n\n- $f[i][0]=f[i+1][0]+f[i+1][1]-f[min[1][i]][1]+f[i+1][2]\\times(2^{tmp[i+1]-tmp[i]}-2)$\n- $f[i][1]=f[i+1][1]+f[i+1][0]-f[min[0][i]][0]+f[i+1][2]\\times(2^{tmp[i+1]-tmp[i]}-2)$\n- $f[i][2]=f[i+1][0]-f[min[0][i]][0]+f[i+1][1]-f[min[1][i]][1]+f[i+1][2]\\times(2^{tmp[i+1]-tmp[i]}-2)$\n\n\u6700\u7ec8\u7b54\u6848\u4e3a$f[0][2]$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$\\mathcal O((n+m)(\\log(n+m)+\\log k))$\u3002\u5176\u4e2d$\\mathcal O(\\log(n+m))$\u4e3a\u79bb\u6563\u5316\u590d\u6742\u5ea6\uff0c$\\mathcal O(\\log k)$\u4e3a\u5feb\u901f\u5e42\u590d\u6742\u5ea6\u3002\n\n### \u6e90\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<cctype>\n#include<algorithm>\nusing int64=long long;\ninline int getint() {\n\tregister char ch;\n\twhile(!isdigit(ch=getchar()));\n\tregister int x=ch^'0';\n\twhile(isdigit(ch=getchar())) x=(((x<<2)+x)<<1)+(ch^'0');\n\treturn x;\n}\nconstexpr int N=1e5,mod=1e9+7;\nstd::pair<int,int> p[2][N];\nint tmp[N*4+2],min[2][N*4+2],f[N*4+2][3];\ninline int power(int a,int k) {\n\tint ret=1;\n\tfor(;k;k>>=1) {\n\t\tif(k&1) ret=(int64)ret*a%mod;\n\t\ta=(int64)a*a%mod;\n\t}\n\treturn ret;\n}\nint main() {\n\tconst int k=getint(),n=getint(),m=getint();\n\tint lim=0;\n\tfor(register int i=0;i<n;i++) {\n\t\ttmp[++lim]=p[0][i].first=getint()-1;\n\t\ttmp[++lim]=p[0][i].second=getint();\n\t}\n\tfor(register int i=0;i<m;i++) {\n\t\ttmp[++lim]=p[1][i].first=getint()-1;\n\t\ttmp[++lim]=p[1][i].second=getint();\n\t}\n\ttmp[++lim]=k;\n\tstd::sort(&tmp[0],&tmp[lim]+1);\n\tlim=std::unique(&tmp[0],&tmp[lim]+1)-&tmp[1];\n\tfor(register int i=0;i<=lim;i++) {\n\t\tmin[0][i]=min[1][i]=lim+1;\n\t}\n\tfor(register int i=0;i<n;i++) {\n\t\tp[0][i].first=std::lower_bound(&tmp[0],&tmp[lim]+1,p[0][i].first)-tmp;\n\t\tp[0][i].second=std::lower_bound(&tmp[0],&tmp[lim]+1,p[0][i].second)-tmp;\n\t\tmin[0][p[0][i].first]=std::min(min[0][p[0][i].first],p[0][i].second);\n\t}\n\tfor(register int i=0;i<m;i++) {\n\t\tp[1][i].first=std::lower_bound(&tmp[0],&tmp[lim]+1,p[1][i].first)-tmp;\n\t\tp[1][i].second=std::lower_bound(&tmp[0],&tmp[lim]+1,p[1][i].second)-tmp;\n\t\tmin[1][p[1][i].first]=std::min(min[1][p[1][i].first],p[1][i].second);\n\t}\n\tfor(register int i=lim;i;i--) {\n\t\tmin[0][i-1]=std::min(min[0][i-1],min[0][i]);\n\t\tmin[1][i-1]=std::min(min[1][i-1],min[1][i]);\n\t}\n\tf[lim][0]=f[lim][1]=f[lim][2]=1;\n\tfor(register int i=lim-1;i>=0;i--) {\n\t\tint g[3];\n\t\tg[0]=(f[i+1][0]-f[min[0][i]][0]+mod)%mod;\n\t\tg[1]=(f[i+1][1]-f[min[1][i]][1]+mod)%mod;\n\t\tg[2]=(int64)f[i+1][2]*((power(2,tmp[i+1]-tmp[i])-2+mod)%mod)%mod;\n\t\tf[i][0]=((int64)f[i+1][0]+g[1]+g[2])%mod;\n\t\tf[i][1]=((int64)f[i+1][1]+g[0]+g[2])%mod;\n\t\tf[i][2]=((int64)g[0]+g[1]+g[2])%mod;\n\t}\n\tprintf(\"%d\\n\",f[0][2]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1527074382,
        "uid": 10086,
        "name": "skylee",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF930E \u3010Coins Exhibition\u3011"
    }
]