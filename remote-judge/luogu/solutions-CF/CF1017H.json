[
    {
        "content": "\u6211\u4eec\u5148\u8003\u8651\u600e\u4e48\u6c42\u5355\u6b21\u8be2\u95ee\u7684\u7b54\u6848\u3002\n\n\u8bbe\u989c\u8272 $i$ \u5728\u539f\u5e8f\u5217\u4e2d\u603b\u5171\u51fa\u73b0\u4e86 $s_i$ \u6b21\uff0c\u5728\u7ed9\u5b9a\u7684\u533a\u95f4\u91cc\u51fa\u73b0\u4e86 $c_i$ \u6b21\u3002\u6211\u4eec\u5148\u628a\u533a\u95f4\u5185\u7684\u4f4d\u7f6e\u586b\u597d\uff0c\u8fd9\u9700\u8981\u6211\u4eec\u4fdd\u6301\u524d\u540e\u989c\u8272\u4e00\u81f4\uff0c\u6709 $\\prod_{i=1}^m (s_i+k)^{\\underline {c_i}}$ \u79cd\u65b9\u6848\uff1b\u63a5\u7740\u533a\u95f4\u5916\u7684\u4f4d\u7f6e\u53ef\u4ee5\u968f\u4fbf\u586b\uff0c\u4e00\u5171\u662f $(mk+n-(r-l+1))^{\\underline{n-(r-l+1)}}$ \u79cd\u65b9\u6848\u3002\u4e24\u8fb9\u76f8\u4e58\u5373\u53ef\u5f97\u5230\u7b54\u6848\u3002\n\n\uff08$x^{\\underline a}$ \u8868\u793a $x$ \u7684 $a$ \u6b21\u4e0b\u964d\u5e42\uff0c$x^{\\underline a}=x(x-1)\\cdots (x-a+1)$\u3002\uff09\n\n\u4e0b\u9762\u7684\u590d\u6742\u5ea6\u5206\u6790\u4e2d\u7528 $K$ \u8868\u793a\u4e0d\u540c\u7684 $k$ \u7684\u4e2a\u6570\u3002\u7531\u4e8e $K\\leq 100$\uff0c\u4e00\u4e2a\u5f88\u81ea\u7136\u7684\u60f3\u6cd5\u662f\u5bf9\u6bcf\u4e2a $k$ \u7684\u8be2\u95ee\u90fd\u5206\u5f00\u5904\u7406\uff0c\u8dd1\u4e00\u904d\u83ab\u961f\u3002\u603b\u590d\u6742\u5ea6 $O(n\\sqrt {qK})$\uff0c\u5df2\u7ecf\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\u4e86\u3002\n\n\u53e6\u4e00\u4e2a\u505a\u6cd5\u9700\u8981\u66f4\u591a\u7684\u89c2\u5bdf\u3002\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c$s_i$ \u7684\u4e0d\u540c\u975e $0$ \u503c\u4e0d\u8d85\u8fc7 $2\\sqrt n$\u3002\u8fd9\u662f\u56e0\u4e3a $\\sum_{i=1}^ms_i=n$\uff0c\u82e5\u8981\u51fa\u73b0 $x$ \u4e2a\u4e0d\u540c\u7684\u975e $0$ \u503c\u5219\u5fc5\u6709 $\\sum_{i=1}^xi=\\dfrac{x(x+1)}{2}\\leq n$\u3002\u8fdb\u4e00\u6b65\u5730\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u53d1\u73b0\u5982\u4e0b\u7ed3\u8bba\uff1a\n\n- \u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u533a\u95f4 $[l,r]$\uff0c\u4e0d\u540c\u7684 $(s_i,c_i)$ \u7684\u6570\u5bf9\u7684\u6570\u91cf\u4e0d\u8d85\u8fc7 $O(n^{2/3})$\u3002\n\n\u8bc1\u660e\u53ef\u4ee5\u8fd9\u4e48\u8003\u8651\uff1a\u6211\u4eec\u5229\u7528 $\\sum s_i=n$\uff0c$\\sum c_i=r-l+1\\leq n$\u3002\u82e5\u51fa\u73b0\u4e86 $t$ \u5bf9\u4e0d\u540c\u7684 $(s,c)$\uff0c\u90a3\u4e48\u6700\u4f18\u60c5\u51b5\u4e00\u5b9a\u662f\u6309 $s+c$ \u6392\u5e8f\u800c\u4f18\u5148\u9009\u8f83\u5c0f\u7684\u3002\u6211\u4eec\u6682\u4e14\u4e0d\u8003\u8651 $c \\leq s$\uff0c\u90a3\u4e48 $s+c=x$ \u7684 $(s,c)$ \u6570\u91cf\u6070\u6709 $x$ \u79cd\u3002\u4ee4 $k=\\lfloor \\sqrt n\\rfloor$\uff0c\u90a3\u4e48\u53ef\u77e5\n\n$$\n\\sum_{i=1}^k i^2\\leq 2n\n$$\n\n\u6211\u4eec\u77e5\u9053\u5de6\u5f0f $=\\dfrac{k(k-1)(2k-1)}{3}$\uff0c\u6545\u5f97 $k=O(n^{1/3})$\uff0c\u6240\u4ee5 $t=O(n^{2/3})$\uff0c\u5373\u8bc1\u51fa\u539f\u547d\u9898\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u6027\u8d28\u540e\u4e8b\u60c5\u53d8\u7b80\u5355\u4e86\u3002\u6211\u4eec\u4ecd\u65e7\u8003\u8651\u83ab\u961f\uff0c\u7528\u54c8\u5e0c\u8868\u7ef4\u62a4\u6240\u6709\u51fa\u73b0\u8fc7\u7684 $(s,c)$ \u5bf9\u7684\u51fa\u73b0\u6b21\u6570\u5373\u53ef\u3002\u5bf9\u6bcf\u7ec4\u8be2\u95ee\uff0c\u6211\u4eec\u66b4\u529b\u8ba1\u7b97\u6bcf\u4e2a $(s,c)$ \u5bf9\u7684\u8d21\u732e\uff0c\u53ef\u4ee5\u901a\u8fc7\u9884\u5904\u7406\u9636\u4e58\u53ca\u5176\u9006\u5143\u6765\u5b8c\u6210\u8ba1\u7b97\u3002\u4e2d\u95f4\u8fd8\u8981\u8ba1\u7b97\u5feb\u901f\u5e42\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(Kn+n\\sqrt q+qn^{2/3}\\log m)$\u3002\u7406\u8bba\u4e0a\u8fd9\u4e2a\u590d\u6742\u5ea6\u8f83\u76f4\u63a5\u83ab\u961f\u4f18\uff0c\u4f46\u4f3c\u4e4e\u7531\u4e8e\u5e38\u6570\u95ee\u9898\u5e76\u6ca1\u6709\u76f4\u63a5\u83ab\u961f\u5feb\u3002\n\n\u76f4\u63a5\u83ab\u961f\u7684\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n\nusing namespace std;\n\nconst long long MOD=998244353;\nlong long fast_pow(long long b,long long p)\n{\n\tlong long ans=1;while(p){if(p&1)ans=ans*b%MOD;b=b*b%MOD;p>>=1;}\n\treturn ans;\n}\nlong long INV(long long x){return fast_pow(x,MOD-2);}\nlong long inv[500000];\n\nint a[200000],cnt[200000],sum[200000];long long pre[200000];\n\nstruct query\n{\n\tint l,r,k,id;\n}Q[200000];\nconst int SZ=300;\n\nbool operator<(query A,query B)\n{\n\tif(A.k!=B.k)return A.k<B.k;\n\tif(A.l/SZ!=B.l/SZ)return A.l<B.l;return A.r<B.r;\n}\n\nlong long ret[200000];\n\nint main()\n{\n\tfor(int i=1;i<=450000;i++)inv[i]=INV(i);\n\tint n=0,m=0,q=0;scanf(\"%d%d%d\",&n,&m,&q);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),sum[a[i]]++;\n\tfor(int i=1;i<=q;i++)scanf(\"%d%d%d\",&Q[i].l,&Q[i].r,&Q[i].k),Q[i].id=i;\n\tsort(Q+1,Q+q+1);\n\tlong long ans=1;\n\tfor(int i=1,l=1,r=0;i<=q;i++)\n\t{\n\t\tif(i==1||Q[i].k!=Q[i-1].k)\n\t\t{\n\t\t\tl=1,r=0,ans=1;for(int j=1;j<=m;j++)cnt[j]=0;\n\t\t\tpre[0]=1;long long p=(long long)m*Q[i].k%MOD;for(int j=1;j<=n;j++)pre[j]=pre[j-1]*(p+j)%MOD;\n\t\t}\n\t\twhile(r<Q[i].r){r++;cnt[a[r]]++;ans=ans*(sum[a[r]]+Q[i].k-cnt[a[r]]+1)%MOD;}\n\t\twhile(l>Q[i].l){l--;cnt[a[l]]++;ans=ans*(sum[a[l]]+Q[i].k-cnt[a[l]]+1)%MOD;}\n\t\twhile(l<Q[i].l){ans=ans*inv[(sum[a[l]]+Q[i].k-cnt[a[l]]+1)]%MOD;cnt[a[l]]--;l++;}\n\t\twhile(r>Q[i].r){ans=ans*inv[(sum[a[r]]+Q[i].k-cnt[a[r]]+1)]%MOD;cnt[a[r]]--;r--;}\n\t\tret[Q[i].id]=ans*pre[n-(Q[i].r-Q[i].l+1)]%MOD;\n\t}\n\tfor(int i=1;i<=q;i++)printf(\"%lld\\n\",ret[i]);\n}\n```",
        "postTime": 1630049416,
        "uid": 112794,
        "name": "\u5468\u5b50\u8861",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1017H \u3010The Films\u3011"
    },
    {
        "content": "## \u524d\u8a00  \n\n\u5927\u5bb6\u597d\u6211\u559c\u6b22\u66b4\u529b\u6240\u4ee5\u6211\u7528\u66b4\u529b\u8279\u8fc7\u4e86\u8fd9\u9053\u9898\u3002  \n\u4e0d\u8fc7\u8bdd\u8bf4\u8fd9\u9053\u9898\u672c\u6765\u7684 tag \u5c31\u662f\u66b4\u529b\u6765\u7740\uff1f  \n![](https://cdn.luogu.com.cn/upload/image_hosting/j7dr5nte.png)  \n\n## \u9898\u610f  \n[\u8f83\u590d\u6742\uff0c\u5efa\u8bae\u53bb\u770b\u539f\u9898\u9762](https://www.luogu.com.cn/problem/CF1017H)  \n\n## \u9898\u89e3  \n\n### \u505a\u6cd5\n\n> \u4fdd\u8bc1\u4e0d\u540c\u7684 $k$ \u53ea\u6709 $100$ \u79cd\u3002\n\n\u4e8e\u662f\u60f3\u5230\u628a\u6bcf\u79cd\u8be2\u95ee\u6309\u7167 $k$ \u5206\u7ec4\u3002  \n\n\u6211\u4eec\u5148\u6c42\u51fa\u8fd9\u4e2a\u72b6\u6001\u4e0b\uff0c\u53ef\u91cd\u96c6 $S$ \u4e2d\u6bcf\u79cd\u4e0d\u540c\u7684\u6570\u6709\u51e0\u4e2a\uff0c\u8bbe $x$ \u51fa\u73b0\u4e86 $b[x]$ \u6b21\u3002  \n\u7136\u540e\u6211\u4eec\u8003\u8651\uff0c\u5047\u5982\u4e00\u4e2a\u533a\u95f4\u4e2d\u4e00\u4e2a\u6570 $x$ \u51fa\u73b0\u4e86 $c[x]$ \u6b21\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u5728 $b[x]$ \u4e2d\u9009 $c[x]$ \u4e2a\u8fdb\u884c\u6392\u5217\uff0c\u4e5f\u5c31\u662f $b[x]^{\\underline{c[x]}}$ \u6b21\u3002\u8fd9\u4e2a\u5728 $c[x]$ \u52a0\u4e00\u6216\u8005\u51cf\u4e00\u7684\u65f6\u5019\u53ef\u4ee5 $O(1)$ \u7ef4\u62a4\u51fa\u6765\u3002  \n\n\u4e8e\u662f\u6211\u4eec\u60f3\u5230\u7528\u83ab\u961f\u3002  \n```cpp\nvoid add(int x){res=1LL*res*(b[x]-c[x])%mod;c[x]++;}\nvoid del(int x){c[x]--;res=1LL*res*inv[b[x]-c[x]]%mod;}\n```\n\u63a5\u4e0b\u6765\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff0c\u6211\u4eec\u6c42\u5f97\u662f\u94a6\u5b9a\u4e86 $[l,r]$ \u533a\u95f4\u5185\u9009\u7684\u6570\u7684\u65b9\u6848\u6570\uff0c\u8fd8\u6709\u5269\u4e0b\u968f\u673a\u6392\u5217\u7684\u65b9\u6848\u6570\u8981\u4e58\u4e0a\u53bb\u3002  \n\u4ee4 $A=n+mk,L=r-l+1$\u3002  \n\u90a3\u4e48\u5b9e\u9645\u4e0a\u8981\u6c42\u7684\u5c31\u662f $(A-L)^{\\underline{n-L}}= \\prod _{i=A-n+1}^{A-L} i$\u3002\u8fd9\u4e2a\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u79cd $k$ \u9884\u5904\u7406\u51fa\u6765\u3002  \n\n### \u590d\u6742\u5ea6\u5206\u6790  \n\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u8bbe\u6709 $K$ \u79cd\u4e0d\u540c\u7684 $k$\uff0c\u90a3\u4e48\u6709 $K\\le 100$\u3002  \n\u9996\u5148\u5176\u4ed6\u90e8\u5206\u90fd\u662f\u4e0d\u8d85\u8fc7 $O((n+m)k+q\\log K)$ \u7684\uff08\u6c42\u51fa\u73b0\u4e86\u54ea\u4e9b $k$ \u6211\u7528\u4e86 `set`\uff09\uff0c\u91cd\u70b9\u5728\u4e8e\u83ab\u961f\u7684\u590d\u6742\u5ea6\u5206\u6790\u3002  \n  \n\u5047\u8bbe\u5bf9\u4e8e\u6bcf\u79cd $k$\uff0c\u8fd9\u6837\u7684\u8be2\u95ee\u5171\u6709 $q_1,q_2,\\cdots q_K$ \u4e2a\u3002  \n\u83ab\u961f\u7684\u590d\u6742\u5ea6\u4e3a $O(n \\sqrt {q})$\uff0c\u56e0\u6b64\u603b\u590d\u6742\u5ea6\u4e3a $O(n \\sum_i \\sqrt {q_i})$\u3002  \n\u6709 $\\sum_{q_i} =q$\uff0c\u663e\u7136\u6240\u6709 $q_i$ \u76f8\u7b49\u590d\u6742\u5ea6\u6700\u9ad8\uff0c\u8bc1\u660e\u53ef\u4ee5\u7528\u6743\u65b9\u548c\u4e0d\u7b49\u5f0f\uff0c\u6216\u8005\u8c03\u6574\u6cd5\u611f\u6027\u7406\u89e3\u3002  \n\u6b64\u65f6\u7684\u590d\u6742\u5ea6\u4e3a $O(nK \\sqrt { \\frac q K})=O(n\\sqrt {qK} )$\uff0c\u603b\u590d\u6742\u5ea6\u4e3a $O(q\\log K+(n+m)K+n \\sqrt {qK})$\uff0c\u65f6\u9650 5s \u975e\u5e38\u7a33\u3002  \n\n\n### \u4ee3\u7801  \n\n\u7a0d\u5fae\u5361\u4e86\u4e0b\u5e38\u6570\u4ee5\u540e\u8dd1\u5f97\u98de\u5feb\uff0c\u751a\u81f3\u662f CF \u4e0a\u7684\u6700\u4f18\u89e3\u3002  \n<https://codeforces.com/contest/1017/submission/128020315>\n\n```cpp\n\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"unroll-loops\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")\n#define rd(x) x=read()\n#define wt(x) write(x)\n#define pos(x) (((x)-1)/SZ+1)\n#define endl \"\\n\"\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\n#define ls (rt<<1)\n#define rs (rt<<1|1)\n#define y1 _________\nusing namespace std;\nconst int N=2e5+5;\nconst int M=1e5+5;\nint SZ=450;\nconst int mod=998244353;\nint read(){int x=0,f=1;char ch=getchar();while(ch>'9'||ch<'0'){if (ch=='-')f=-1;ch=getchar();}while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}return x*f;}\nvoid write(int x){if(x<0){putchar('-');x=-x;}if(x>=10)write(x/10);putchar(x%10+'0');}\nint inv[N]; \nint n,m,q,ans[M],res;\nint a[M],b[M],c[M],s[M];\nstruct query{int l,r,k,id;}Q[M];\nset<int> K;\nvector<query> p;\nbool cmp(query x,query y){if (pos(x.l)!=pos(y.l)) return x.l<y.l;return pos(x.l)&1?x.r<y.r:x.r>y.r;}\nvoid add(int x){res=1LL*res*(b[x]-c[x])%mod;c[x]++;}\nvoid del(int x){c[x]--;res=1LL*res*inv[b[x]-c[x]]%mod;}\nsigned main()\n{\n    inv[1]=1;for (int i=2;i<N;i++) inv[i]=1LL*inv[mod%i]*(mod-mod/i)%mod;\n    rd(n);rd(m);rd(q);\n    for (int i=1;i<=n;i++) rd(a[i]);\n    for (int i=1;i<=q;i++) rd(Q[i].l),rd(Q[i].r),rd(Q[i].k),Q[i].id=i,K.insert(Q[i].k);\n    for (int k:K)\n    {\n        p.clear();for (int i=1;i<=q;i++) if (Q[i].k==k) p.push_back(Q[i]);\n        memset(b,0,sizeof(b));memset(c,0,sizeof(c));for (int i=1;i<=n;i++) b[a[i]]++;for (int i=1;i<=m;i++) b[i]+=k;\n        SZ=n/sqrt(p.size());SZ=max(SZ,3);\n        sort(p.begin(),p.end(),cmp);\n        int l=1,r=0;res=1;\n        long long A=n+1LL*m*k;\n        s[n]=1;for (int i=n-1;i>=0;i--) s[i]=1LL*s[i+1]*((A-i)%mod)%mod;\n        for (query x:p)\n        {\n            while (l>x.l) add(a[--l]);\n            while (l<x.l) del(a[l++]);\n            while (r>x.r) del(a[r--]);\n            while (r<x.r) add(a[++r]);\n            int L=x.r-x.l+1;\n            ans[x.id]=1LL*res*s[L]%mod;\n        }\n    }\n    for (int i=1;i<=q;i++) cout<<ans[i]<<\"\\n\";\n}\n```",
        "postTime": 1630912330,
        "uid": 70132,
        "name": "AsunderSquall",
        "ccfLevel": 7,
        "title": "CF1017H"
    }
]