[
    {
        "content": "### \u9898\u76ee\u7ffb\u8bd1\n\n\u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$\uff0c\u6c42\u6709\u591a\u5c11\u7ec4 $(l,r)$ \u6ee1\u8db3 $\\sum\\limits_{i=l}^ra_i=k^i$\u3002\n\n### \u9898\u76ee\u601d\u8def\n\n\u9996\u5148\u8003\u8651\uff0c\u679a\u4e3e $l$ \u548c $r$\uff0c\u5224\u65ad $\\sum\\limits_{i=l}^r$ \u662f\u5426\u4e3a $k$ \u7684\u500d\u6570\u3002\u4f46\u662f\u663e\u7136\u8fd9\u79cd\u505a\u6cd5\u590d\u6742\u5ea6\u4e3a $n^2$ \u65e0\u6cd5\u901a\u8fc7\u3002\n\n\u8bbe $s$ \u4e3a $a$ \u7684\u524d\u7f00\u548c\u6570\u7ec4\uff0c\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u67e5\u627e $s_r-s_{l-1}=k^i$\uff0c\u5176\u5b9e\u7b49\u4ef7\u4e8e\u627e $s$ \u4e2d\u662f\u5426\u6709 $s_r-k^i$ \u8fd9\u4e2a\u5143\u7d20\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u679a\u4e3e\u4e00\u4e2a\u7aef\u70b9\u4ee5\u53ca\u4e00\u4e2a $k$ \u7684\u6b21\u5e42\u3002\n\n\u663e\u7136\u5728\u8fd9\u4e2a\u9898\u4e2d\uff0c\u9664\u53bb $k=\\pm1$\uff0c\u4e0a\u8ff0\u7684 $i$ \u6700\u591a\u53ea\u9700\u679a\u4e3e\u81f3 $\\log_2 (10^9\\times 10^5)\\approx 60$ \u6b21\u3002\n\n\u56e0\u6b64\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n\\times 60)$\u3002\u5bf9\u4e8e C++ \u9009\u624b\uff0c\u5982\u679c\u4f60\u7528 map \u6765\u5224\u65ad $s_r-k^i$ \u662f\u5426\u5b58\u5728\u8fd8\u9700\u4e58\u4e0a\u4e00\u4e2a $\\log_2 n$\u3002\n\n### \u5b8c\u6574\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nint n;\nll st[100];\nint top;\nll pw=1;\nll k,ans;\nll a[100020];\nll s[100020];\nmap<ll,int>mp;\nint main()\n{\n    cin>>n>>k;\n    for(int i=1;i<=n;i++)\n    {\n        cin>>a[i];\n        s[i]=a[i]+s[i-1];\n    }\n    for(int i=0;i<=60;i++)\n    {\n        if(abs(pw)>1e14)break;\n        st[++top]=pw;\n        pw*=k;\n    }\n    mp[0]=1;\n    for(int i=1;i<=n;i++)\n    {\n        if(k==1)ans+=mp[s[i]-1];\n        else if(k==-1)ans+=mp[s[i]-1]+mp[s[i]+1];\n        else \n        {\n            for(int _=1;_<=top;_++)\n            {\n                ans+=mp[s[i]-st[_]];\n            }\n        }\n        mp[s[i]]++;\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1679811689,
        "uid": 516346,
        "name": "_YXJS_",
        "ccfLevel": 4,
        "title": "CF776C"
    },
    {
        "content": "\u3010\u9898\u610f\u3011\uff1a\n\n\u7ed9\u4f60$n$\u4e2a\u6570\u548c\u4e00\u4e2a\u6570$k$\uff0c\u8ba9\u4f60\u6c42\u6709\u591a\u5c11\u4e2a\u533a\u95f4\u7684\u548c\u662f$k$\u7684\u6574\u6570\u6b21\u5e42\uff1f\n\n\u3010\u5206\u6790\u3011\uff1a\n\n\u533a\u95f4\u7684\u548c\u660e\u663e\u53ef\u4ee5\u901a\u8fc7\u524d\u7f00\u548c\u5904\u7406\n\n\u90a3\u4e48\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f\u6709\u591a\u5c11\u533a\u95f4$sum[r]-sum[l]=pow(k,i)$\u5462\uff1f\n\n\u6211\u4eec\u80fd\u591f\u53d1\u73b0$i$\u6700\u5927\u4e5f\u5c31\u662f$log(10^{14})\u224860$\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u679a\u4e3e$i$\uff0c\u7136\u540e\u8f6c\u5316\u6210\u5224\u5b9a\u6027\u95ee\u9898\u6709\u591a\u5c11l\u548cr\u6ee1\u8db3$sum[r]-pow(k,i)=sum[l]$\n\n\u663e\u800c\u6613\u89c1\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u901a\u8fc7\u4e00\u53ea$map$\u53bb\u67e5\u627e\n\n\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u53d8\u6210\u4e86$O(60n)\u2248O(n)$\n\n\u4e0d\u9519\u554a\u3002\n\n\u3010\u4ee3\u7801\u3011\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std ;\n\n#define rep(i, a, b) for (int (i) = (a); (i) <= (b); (i)++)\n#define Rep(i, a, b) for (int (i) = (a) - 1; (i) < (b); (i)++)\n#define REP(i, a, b) for (int (i) = (a); (i) >= (b); (i)--)\n#define clr(a) memset(a, 0, sizeof(a))\n#define Sort(a, len, cmp) sort(a + 1, a + len + 1, cmp)\n#define ass(a, sum) memset(a, sum, sizeof(a))\n\n#define ls ((rt) << 1)\n#define rs ((rt) << 1 | 1)\n#define lowbit(x) (x & -x)\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\n#define endl '\\n'\n#define ENDL cout << endl\n#define SZ(x) ((int)x.size())\n\ntypedef long long ll ;\ntypedef unsigned long long ull ;\ntypedef vector <int> vi ;\ntypedef pair <int, int> pii ;\ntypedef pair <ll, ll> pll ;\ntypedef map <int, int> mii ;\ntypedef map <string, int> msi ;\ntypedef map <ll, ll> mll ;\n\nconst int N = 100010 ;\nconst double eps = 1e-8 ;\nconst int iinf = INT_MAX ;\nconst ll linf = 1e14 ;\nconst double dinf = 1e30 ;\nconst int MOD = 1000000007 ;\n\ninline int read(){\n    int X = 0, w = 0 ;\n\tchar ch = 0 ;\n    while (!isdigit(ch)) { w |= ch == '-' ; ch = getchar() ; }\n    while (isdigit(ch)) X = (X << 3) + (X << 1) + (ch ^ 48), ch = getchar() ;\n    return w ? - X : X ;\n}\n\nvoid write(int x){\n     if (x < 0) putchar('-'), x = - x ;\n     if (x > 9) write(x / 10) ;\n     putchar(x % 10 + '0') ;\n}\n\nvoid print(int x) {\n\tcout << x << endl ;\n\texit(0) ;\n}\n\nvoid PRINT(string x) {\n\tcout << x << endl ;\n\texit(0) ;\n}\n\nvoid douout(double x){\n\t printf(\"%lf\\n\", x + 0.0000000001) ;\n}\n\nint n ;\nll k, ans ;\nll sum[N] ;\nset <ll> a ;\nmap <ll, ll> x ;\n\nsigned main(){\n    scanf(\"%d%lld\", &n, &k) ;\n\tsum[0] = 0 ;\n\tfor (int i = 1; i <= n; i++) scanf(\"%lld\", &sum[i]), sum[i] += sum[i - 1] ;\n\ta.insert(1) ;\n\tll tmp = k ;\n\tfor (int i = 1; i <= 60; i++) { // \u679a\u4e3epow(k,i)\n\t\tif (tmp > linf) break ;\n\t\ta.insert(tmp) ;\n\t\ttmp *= k ;\n\t}\n\tll ans = 0 ;\n\tx[0] = 1 ;\n\tfor (int i = 1; i <= n; i++) {\n\t\tfor (set <ll>::iterator it = a.begin(); it != a.end(); it++) ans += x[sum[i] - *it] ;\n\t\tx[sum[i]]++ ;\n\t}\n\tprintf(\"%lld\\n\", ans) ;\n}\n```\n\n\n",
        "postTime": 1544322341,
        "uid": 54900,
        "name": "__Hacheylight__",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF776C \u3010Molly's Chemicals\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u4f60\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\uff0c\u95ee\u6709\u591a\u5c11\u4e2a\u5b50\u5e8f\u5217\u6ee1\u8db3\u548c\u4e3a $m$ \u7684\u6b21\u5e42\uff1f\n## \u89e3\u9898\u601d\u8def\n\u5982\u679c\u6211\u4eec\u56fa\u5b9a\u67d0\u4e00\u4e2a\u548c\uff0c\u8fd9\u9053\u9898\u5c31\u597d\u505a\u4e86\u3002\u4e5f\u5c31\u662f\u8fd0\u7528 map \u6765\u7ef4\u62a4\u51fa\u73b0\u8fc7\u548c\u7684\u6b21\u6570\u518d\u51cf\u5c31\u884c\u4e86\u3002\n\n\u6b64\u65f6\u6ca1\u6709\u56fa\u5b9a\u503c\uff0c\u6211\u4eec\u5c31\u679a\u4e3e\uff01\u53ea\u9700\u8981\u679a\u4e3e $m$ \u7684\u6b21\u5e42\u5c31\u53ef\u4ee5\u4e86\u3002\u89c2\u5bdf\u5230\u6700\u5927\u7684\u533a\u95f4\u548c\u4e3a $10^9 \\times 10^5 = 10^{14}$\uff0c\u4f46\u662f $10^{18}$ \u4e5f\u4e0d\u8fc7\u5c31\u662f $2$ \u7684\u516d\u5341\u51e0\u6b21\u5e42\u3002\u6240\u4ee5\u6b21\u6570\u5c0f\u5230\u51e0\u4e4e\u53ef\u4ee5\u4e0d\u8003\u8651\u3002\n\n\u6b64\u9898\u89e3\u7ec8\u4e86......\u54ce\uff0c\u9519\u4e86\uff01\n\n\u53d1\u73b0\u6ca1\u6709\u8003\u8651 $1$ \u548c $-1$ \u7684\u60c5\u51b5\u3002\u8fd9\u4e24\u79cd\u53ef\u4ee5\u7279\u5224\u4e00\u4e0b\u3002\n## AC \u4ee3\u7801\n```cpp\n/*\nwritten by : zjs123\n*/\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long  \n#pragma GCC optimize(1)\n#pragma GCC optimize(2)\n#pragma GCC optimize(3)\nint n,m;\nint a[100010];\nint z;\nint x,c,ans;\nint d[100010];\nmain(){\n    ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    cin>>n>>m;\n    for(int i=1;i<=n;i++){\n        cin>>a[i];\n        z=max(z,a[i]);\n    }\n    x=1;\n    while((x<=1e15&&abs(m)!=1)||(m==-1&&c<2)||(m==1&&c<1)){\n        c++;\n        map<int,int> mm;//\u7edf\u8ba1\u51fa\u73b0\u6b21\u6570\n        int zz=0;\n        mm[0]=1;\n//        cout<<x<<\" \";\n        for(int i=1;i<=n;i++){\n            d[i]=d[i-1]+a[i];//\u524d\u7f00\u548c\n            zz+=mm[d[i]-x];//\u589e\u52a0\u7b54\u6848\n//            cout<<mm[d[i]-x]<<\" \"<<d[i]<<\"\\n\";\n            mm[d[i]]++;\n        }\n//        cout<<zz<<\"\\n\";\n        ans+=zz;\n        x*=m;//\u8ba1\u7b97\u76ee\u524d\u7684\u603b\u548c\n    }\n    cout<<ans;\n    return 0;\n}\n\n```",
        "postTime": 1679810828,
        "uid": 754000,
        "name": "_JSYX_",
        "ccfLevel": 5,
        "title": "CF776C"
    }
]