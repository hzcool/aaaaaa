[
    {
        "content": "### \u9898\u610f\n\n\u6709 $n$ \u4e2a\u96c6\u5408 $S_1,S_2,\\cdots,S_n$\u3002\n\n$S_i=\\left\\{ x|x\\in [L_i,R_i],x\\in \\N \\right\\}$\n\n\u6709\u4e09\u79cd\u96c6\u5408\u95f4\u7684\u4e8c\u5143\u8fd0\u7b97\uff0c\u5206\u522b\u4e3a\u4ea4\uff08 $\\cap$ \uff09\u3001\u5e76\uff08 $\\cup$ \uff09\u3001\u5bf9\u79f0\u5dee\uff08 $\\oplus$ \uff09\u3002\n\n\u89c4\u5b9a\u6bcf\u79cd\u8fd0\u7b97\u4f18\u5148\u7ea7\u76f8\u540c\uff0c\u8fd0\u7b97\u987a\u5e8f\u4ece\u5de6\u5411\u53f3\u3002\n\n$a \\cap b=\\left\\{ x| x \\in a \\operatorname{and} x \\in b \\right\\}$\n\n$a \\cup b=\\left\\{ x| x \\in a \\operatorname{or} x \\in b \\right\\}$\n\n$a \\oplus b=\\left\\{ x| x \\in a, x \\not \\in b \\operatorname{or} x \\not \\in a, x \\in b \\right\\}$\n\n\u6709 $n-1$ \u4e2a\u8fd0\u7b97\u7b26 $op_1,op_2,\\cdots,op_{n-1}(op_i\\in \\left\\{ \\cap,\\cup,\\oplus \\right\\})$\u3002\n\n\u5bf9\u4e8e $op_i$ \u7684 $3^{n-1}$ \u79cd\u65b9\u6848\uff0c\u6c42\u51fa\uff1a\n\n$$\\left| S_1\\ op_1\\ S_2  \\ op_2 \\ \\cdots \\ op_{n-1} \\ S_n \\right|$$\n\n\u4e4b\u548c\u3002\n\n$1 \\leq n \\leq 3\\times 10^5$\n\n$0 \\leq L_i,R_i \\leq 3\\times 10^5$\n\n### \u9898\u89e3\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u4e58\u6cd5\u9006\u5143\u3001\u7ebf\u6bb5\u6811\u61d2\u6807\u8bb0\u3002\n\n---\n\n\u53ef\u4ee5\u628a\u539f\u95ee\u9898\u8f6c\u5316\u6210\u4ee5\u4e0b\u7684\u5f62\u5f0f\uff1a\n\n\u6709 $n$ \u4e2a $\\texttt{01}$ \u4e32 $S_1,S_2,\\cdots,S_n$\u3002\n\n$S_i$ \u7b2c $[L_i,R_i]$ \u4f4d\u4e3a $\\texttt{1}$\uff0c\u5176\u4f59\u4f4d\u4e3a $\\texttt{0}$\u3002\n\n\u6709\u4e09\u79cd\u8fd0\u7b97\uff0c\u5206\u522b\u4e3a\u4e0e\uff08 $\\land$ \uff09\uff0c\u6216\uff08 $\\lor$ \uff09\uff0c\u5f02\u6216\uff08 $\\oplus$ \uff09\u3002\n\n\u89c4\u5b9a\u6bcf\u79cd\u8fd0\u7b97\u4f18\u5148\u7ea7\u76f8\u540c\uff0c\u8fd0\u7b97\u987a\u5e8f\u4ece\u5de6\u5411\u53f3\u3002\n\n\u6709 $n-1$ \u4e2a\u8fd0\u7b97\u7b26 $op_1,op_2,\\cdots,op_{n-1}(op_i\\in \\left\\{ \\land,\\lor,\\oplus \\right\\})$\u3002\n\n\u6c42\u51fa\uff1a\n\n$$S_1\\ op_1\\ S_2  \\ op_2 \\ \\cdots \\ op_{n-1} \\ S_n$$\n\n\u4e2d $\\texttt{1}$ \u7684\u671f\u671b\u4e2a\u6570\uff0c\u4e58\u4ee5 $3^{n-1}$\u3002\n\n---\n\n\u8003\u8651\u628a\u6bcf\u4e00\u4f4d\u62c6\u5f00\u5206\u522b\u8ba1\u7b97\u8d21\u732e\u3002\n\n$p_i$ \u8868\u793a $\\texttt{01}$ \u4e32\u7b2c $i$ \u4f4d\u4e3a $\\texttt{1}$ \u7684\u6982\u7387\u3002\n\n$p_i$ \u4e0e $\\texttt{1}$ \u540e\uff0c$p_i'=1$\u3002\n\n$p_i$ \u6216 $\\texttt{1}$ \u540e\uff0c$p_i'=p_i$\u3002\n\n$p_i$ \u5f02\u6216 $\\texttt{1}$ \u540e\uff0c$p_i'=1-p_i$\u3002\n\n$p_i$ \u4e0e $\\texttt{0}$ \u540e\uff0c$p_i'=0$\u3002\n\n$p_i$ \u6216 $\\texttt{0}$ \u540e\uff0c$p_i'=p_i$\u3002\n\n$p_i$ \u5f02\u6216 $\\texttt{0}$ \u540e\uff0c$p_i'=p_i$\u3002\n\n$p_i$ \u548c $\\texttt{1}$ \u8fdb\u884c\u4e00\u6b21\u968f\u673a\u64cd\u4f5c\u540e\uff0c$p_i'=\\dfrac{(1)+(p_i)+(1-p_i)}{3}=\\dfrac{2}{3}$\u3002\n\n$p_i$ \u548c $\\texttt{0}$ \u8fdb\u884c\u4e00\u6b21\u968f\u673a\u64cd\u4f5c\u540e\uff0c$p_i'=\\dfrac{(0)+(p_i)+(p_i)}{3}=\\dfrac{2}{3}p_i$\u3002\n\n---\n\n$E_i$ \u8868\u793a $\\texttt{01}$ \u4e32\u7b2c $i$ \u4f4d\u4e3a $\\texttt{1}$ \u7684\u671f\u671b\uff0c$E_i=p_i$\u3002\n\n$E$ \u8868\u793a $\\texttt{01}$ \u4e32\u4e2d $\\texttt{1}$ \u7684\u671f\u671b\u4e2a\u6570\uff0c$E=\\sum E_i=\\sum p_i$\u3002\n\n\u53ea\u8981\u80fd\u591f\u9ad8\u6548\u7ef4\u62a4 $p_i$ \u7684\u53d8\u52a8\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97 $E$\u3002\n\n\u53d1\u73b0\u6240\u6709\u7684 $\\texttt{01}$ \u4e32\u4e2d $\\texttt{1}$ \u90fd\u662f\u8fde\u7eed\u7684\uff0c\u5e76\u4e14\u53ea\u6709\u4e00\u6bb5\uff0c\u770b\u4e0a\u53bb\u975e\u5e38\u7684\u7ebf\u6bb5\u6811\u3002\n\n\u548c $\\texttt{1}$ \u7684\u968f\u673a\u64cd\u4f5c\u53ef\u4ee5\u770b\u4f5c\u533a\u95f4\u63a8\u5e73\u6210 $\\dfrac{2}{3}$\u3002\n\n\u548c $\\texttt{0}$ \u7684\u968f\u673a\u64cd\u4f5c\u53ef\u4ee5\u770b\u4f5c\u533a\u95f4\u4e58 $\\dfrac{2}{3}$\u3002\n\n\u533a\u95f4 $[1,L_i-1]$ \u548c $\\texttt{0}$ \u968f\u673a\u64cd\u4f5c\uff0c\u533a\u95f4 $[L_i,R_i]$ \u548c $\\texttt{1}$ \u968f\u673a\u64cd\u4f5c\uff0c\u533a\u95f4 $[R_i+1,V]$ \u548c $\\texttt{0}$ \u968f\u673a\u64cd\u4f5c\u3002\n\n\u7528\u61d2\u6807\u8bb0\u7ef4\u62a4\u5c31\u597d\u5566\uff01\n\n---\n\n\u6ca1\u770b\u89c1 $L_i,R_i$ \u53ef\u4ee5\u53d6\u5230 $0$\uff0c\u88ab\u6570\u636e\u521b\u601d\u4e86\u3002\n\n### \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define mod 998244353\n#define rep(i,j,k) for(int i=(j);i<=(k);i++)\n#define per(i,j,k) for(int i=(j);i>=(k);i--)\nusing namespace std;\ntypedef pair<int,int> pii;\nvoid setIn(string s){freopen(s.c_str(),\"r\",stdin);}\nvoid setOu(string s){freopen(s.c_str(),\"w\",stdout);}\nvoid setIO(string s){setIn(s+\".in\"),setOu(s+\".out\");}\ntemplate<class T>void chkmax(T &a,T b){a=max(a,b);}\ntemplate<class T>void chkmin(T &a,T b){a=min(a,b);}\ntemplate<class T>T read(T &x)\n{\n\tx=0;T f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^'0');c=getchar();}\n\treturn x*=f;\n}\ntemplate<class T,class ...L>void read(T &x,L &...l){read(x),read(l...);}\ntemplate<class T>void write(T x)\n{\n\tif(x<0){putchar('-');x=-x;}\n\tif(x>9){write(x/10);}putchar(x%10+'0');\n}\ntemplate<class T>void write(T x,char c){write(x),putchar(c);}\nint qpow(int a,int b)\n{\n\tint ans=1;\n\tfor(;b;a=a*a%mod,b>>=1)\n\t\tif(b&1)ans=ans*a%mod;\n\treturn ans;\n}\nint inv(int x){return qpow(x,mod-2);}\nconst int QwQ=2*inv(3)%mod;\nconst int V=300005;\n#define ls (pos<<1)\n#define rs (pos<<1|1)\n#define mid ((l+r)>>1)\nint sum[300015<<2],tag1[300015<<2],tag2[300015<<2];\n// tag1 \u533a\u95f4\u63a8\u5e73\u6210 2/3 \u7684 tag2 \u6b21\u5e42\n// tag2 \u533a\u95f4\u4e58 2/3\nvoid pushup(int pos)\n{\n\tsum[pos]=(sum[ls]+sum[rs])%mod;\n}\nvoid pushdown(int pos,int l,int r)\n{\n\tif(tag1[pos])\n\t{\n\t\ttag1[ls]=1,tag2[ls]=tag2[pos];\n\t\ttag1[rs]=1,tag2[rs]=tag2[pos];\n\t\tsum[ls]=qpow(QwQ,tag2[pos])*(mid-l+1)%mod;\n\t\tsum[rs]=qpow(QwQ,tag2[pos])*(r-mid)%mod;\n\t}\n\telse if(tag2[pos])\n\t{\n\t\ttag2[ls]+=tag2[pos];\n\t\ttag2[rs]+=tag2[pos];\n\t\tsum[ls]=qpow(QwQ,tag2[pos])*sum[ls]%mod;\n\t\tsum[rs]=qpow(QwQ,tag2[pos])*sum[rs]%mod;\n\t}\n\ttag1[pos]=0,tag2[pos]=0;\n\tpushup(pos);\n}\nvoid build(int lx,int rx,int pos=1,int l=1,int r=V)\n{\n\tif(l==r){sum[pos]=(lx<=l&&r<=rx);return;}\n\tbuild(lx,rx,ls,l,mid),build(lx,rx,rs,mid+1,r);\n\tpushup(pos);\n}\nvoid upd1(int lx,int rx,int pos=1,int l=1,int r=V)\n{\n\tif(lx<=l&&r<=rx)\n\t{\n\t\tsum[pos]=(r-l+1)*QwQ%mod;\n\t\ttag1[pos]=1,tag2[pos]=1;\n\t\treturn;\n\t}\n\tpushdown(pos,l,r);\n\tif(lx<=mid)upd1(lx,rx,ls,l,mid);\n\tif(rx>mid)upd1(lx,rx,rs,mid+1,r);\n\tpushup(pos);\n}\nvoid upd2(int lx,int rx,int pos=1,int l=1,int r=V)\n{\n\tif(lx<=l&&r<=rx)\n\t{\n\t\ttag2[pos]++;\n\t\tsum[pos]=sum[pos]*QwQ%mod;\n\t\treturn;\n\t}\n\tpushdown(pos,l,r);\n\tif(lx<=mid)upd2(lx,rx,ls,l,mid);\n\tif(rx>mid)upd2(lx,rx,rs,mid+1,r);\n\tpushup(pos);\n}\nint n,l,r;\nsigned main()\n{\n\tread(n);\n\tread(l,r);l++,r++;\n\tbuild(l,r);\n\trep(i,2,n)\n\t{\n\t\tread(l,r);l++;r++;\n\t\tupd1(l,r);\n\t\tif(l!=1)upd2(1,l-1);\n\t\tif(r!=V)upd2(r+1,V);\n\t}\n\twrite(sum[1]*qpow(3,n-1)%mod);\n}\n```",
        "postTime": 1668829840,
        "uid": 87434,
        "name": "_Life_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1743F Intersection and Union"
    },
    {
        "content": "#### \u9898\u610f   \n\u7ed9\u5b9a\u82e5\u5e72\u4e2a\u7ebf\u6bb5 $S_i=[L_i,R_i]$\uff0c\u4e24\u4e2a\u7ebf\u6bb5\u4e4b\u95f4\u6709\u4ea4\uff0c\u5e76\u548c\u5f02\u6216 $3$ \u79cd\u64cd\u4f5c\u3002   \n\n\u5bf9\u4e8e  \n\n$$|(((S_1\\space opt_1\\space S_2)\\space opt_2\\space S_3)\\space ...\\space opt_{n-1}\\space S_n)|$$\n\n\u6c42\u6240\u6709 $3^{n-1}$ \u79cd\u64cd\u4f5c\u5e8f\u5217\u7684\u7ed3\u679c\u7684\u603b\u548c\u3002$|S|$\u8868\u793a\u88ab $S$ \u8986\u76d6\u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n#### \u89e3\u6790\n\n\u8003\u8651\u6bcf\u4e2a\u503c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u82e5\u4e00\u4e2a\u503c $i$ \u6700\u540e\u4e00\u6b21\u88ab\u5305\u542b\u662f\u5728 $S_n$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4ece $S_{1}$ \u5230 $S_{n-1}$ \u7684\u4efb\u610f\u64cd\u4f5c\u5e8f\u5217\uff0c\u82e5\u5f53\u524d\u7684\u7b54\u6848\u5305\u542b $i$\uff0c\u53ef\u4ee5\u9009\u62e9\u4ea4\u4e0a $S_n$ \u6216\u8005\u5e76\u4e0a $S_n$ \uff1b\u82e5\u4e0d\u5305\u542b $i$ \u53ef\u4ee5\u9009\u62e9\u5f02\u6216\u4e0a $S_n$ \u6216\u8005\u5e76\u4e0a $S_n$ \u3002\u5305\u542b\u6216\u8005\u4e0d\u5305\u542b\u90fd\u53ea\u6709\u4e24\u79cd\u9009\u62e9\u3002\u6240\u4ee5 $i$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f $3^{n-2}\\times 2$.\n\n\u7c7b\u4f3c\u5730\uff0c\u82e5\u4e00\u4e2a\u503c $i$ \u6700\u540e\u4e00\u6b21\u88ab\u5305\u542b\u662f\u5728 $S_k$\uff0c\u90a3\u4e48\u4ece $S_1$ \u5230 $S_{k-1}$ \u7684\u4efb\u610f\u64cd\u4f5c\u5e8f\u5217\uff0c$(((S_1\\space opt_1\\space S_2)\\space opt_2\\space S_3)\\space ...\\space opt_{k-1}\\space S_k)$ \u5305\u542bi\u7684\u64cd\u4f5c\u5e8f\u5217\u7684\u6570\u91cf\u4e3a $3^{k-2}\\times 2$.\u5bf9\u4e8e\u4ece $S_k+1$ \u5230 $S_n$ \u7684\u6240\u6709\u7ebf\u6bb5\uff0c\u56e0\u4e3a\u5b83\u4eec\u6bcf\u4e2a\u90fd\u4e0d\u5305\u542b $i$\uff0c\u8981\u8ba9\u7b54\u6848\u5305\u542b $i$\uff0c\u9700\u8981\u6bcf\u6b21\u7684\u64cd\u4f5c\u90fd\u5fc5\u987b\u662f\u5e76\u6216\u8005\u5f02\u6216\u3002\u6240\u4ee5\u6700\u7ec8 $i$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $3^{k-2}\\times 2^{n-k+1}$\u3002   \n\u53e6\u5916 $S_1$,$S_2$\u8d21\u732e\u90fd\u662f $2^{n-1}$.\n\n\u8981\u6c42 $k$\uff0c\u53ef\u4ee5\u5199\u4e00\u4e2a\u652f\u6301\u533a\u95f4\u8d4b $1$ \u548c\u533a\u95f4\u67e5\u8be2\u7684\u6570\u636e\u7ed3\u6784\uff0c\u505a\u6cd5\u5c31\u662f\u4ece\u540e\u5f80\u524d\u679a\u4e3e\u7ebf\u6bb5\uff0c\u6bcf\u6b21\u67e5\u8be2$[L,R]$\u4e2d\u6709\u591a\u5c11\u4f4d\u662f $0$\uff0c\u7b97\u51fa\u8d21\u732e\u76f4\u63a5\u52a0\u5230\u7b54\u6848\u4e2d\uff0c\u7136\u540e\u628a\u533a\u95f4\u8d4b $1$\u3002\u4f7f\u7528\u7ebf\u6bb5\u6811\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log V)$\uff0c\u5176\u4e2d $V$ \u662f\u503c\u57df\uff0c\u53ef\u4ee5\u52a8\u6001\u5f00\u70b9\u6216\u79bb\u6563\u5316\u6269\u5c55\u5230 $10^9$ \u7684\u7ea7\u522b\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n/********************\n  *author:Spouter_27\n  *place:spst Alego\n  *with:marmoreal_777\n********************/\n#include<bits/stdc++.h>\n#define ls (nw<<1)\n#define rs ((nw<<1)|1)\n#define mid ((l+r)>>1)\nusing namespace std;\ntypedef long long ll;\nconst ll N=3e5+10,mod=998244353;\nll n,l[N],r[N],p[N],t[N<<2],tg[N<<2],ans;\nll qpow(ll a,ll b){//\u8d21\u732e\u53ef\u4ee5\u6539\u7528\u9884\u5904\u7406\uff0c\u5176\u5b9e\u4e0d\u9700\u8981\u6c42\u5feb\u901f\u5e42\u3002\n\tll ans=1,base=a;\n\twhile(b){\n\t\tif(b&1)\tans=ans*base%mod;\n\t\tbase=base*base%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nvoid update(ll nw,ll l,ll r,ll x,ll y){\n\tif(x<=l&&y>=r){\n\t\ttg[nw]=1;\n\t\tt[nw]=r-l+1;\n\t\treturn;\n\t}\n\tif(tg[nw])\treturn;\n\tif(x<=mid)\tupdate(ls,l,mid,x,y);\n\tif(y>mid)\tupdate(rs,mid+1,r,x,y);\n\tt[nw]=t[ls]+t[rs];\n} \nll query(ll nw,ll l,ll r,ll x,ll y){\n\tif(x<=l&&y>=r){\n\t\treturn t[nw];\n\t}\n\tif(tg[nw]){\n\t\ttg[ls]=tg[rs]=1;\n\t\tt[ls]=mid-l+1;\n\t\tt[rs]=r-mid;\n\t}\n\tll ans=0;\n\tif(x<=mid)\tans+=query(ls,l,mid,x,y);\n\tif(y>mid)\tans+=query(rs,mid+1,r,x,y);\n\treturn ans;\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld %lld\",&l[i],&r[i]);\n\t}\n\tll p1=1;\n\tfor(int i=2;i<=n;i++){\n\t\tp1=p1*2%mod;\n\t}\n\tp[1]=p[2]=p1;\n\tfor(int i=3;i<=n;i++){\n\t\tp[i]=p[i-1]*qpow(2,mod-2)%mod*3%mod;//\u8fd9\u4e2a**\u8d5b\u65f6\u7528\u4e86\u9006\u5143\u3002\u3002\n\t}\n\tfor(int i=n;i>=1;i--){\n\t\tans=(ans+((r[i]-l[i]+1)-query(1,0,3e5,l[i],r[i]))*p[i]%mod)%mod;//\u6ce8\u610f\u8fd9\u91cc\u8981\u4ece0\u5f00\u59cb\u3002\n\t\tupdate(1,0,3e5,l[i],r[i]);\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1666097321,
        "uid": 310801,
        "name": "Spouter_27",
        "ccfLevel": 7,
        "title": "CF1743-F Intersection and Union \u9898\u89e3"
    },
    {
        "content": "\u770b\u9898\u89e3\u533a\u7684\u5927\u4f6c\u4eec\u597d\u591a\u90fd\u7528\u4e86\u7ebf\u6bb5\u6811\u7ef4\u62a4\u77e9\u9635qwq\uff0c\u4f46\u662f\u6211\u592a\u83dc\u4e86\u4e0d\u4f1a\uff0c\u6240\u4ee5\u63d0\u4f9b\u4e00\u79cd\u7eaf\u7ebf\u6bb5\u6811\u533a\u95f4\u4fee\u6539\uff08\u4e0d\u9700\u8981\u67e5\u8be2\uff09\u7684\u65b9\u6cd5\u3002\n\n\u6211\u4eec\u4f7f\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u5f53\u524d\u6240\u6709\u7ecf\u8fc7\u8fd0\u7b97\u540e\u7684\u7ebf\u6bb5\uff0c\u90a3\u4e48\u8bbe\u5f53\u524d\u5f85\u8fd0\u7b97\u7ebf\u6bb5\u4e3a $[l,r]$\uff0c\u90a3\u4e48\u6211\u4eec\u6709\u4e09\u79cd\u8fd0\u7b97\uff1a\n\n### \u4e0e\u8fd0\u7b97\n\n\u4e24\u6761\u7ebf\u6bb5\u7684\u4e0e\u5c31\u662f\u4ed6\u4eec\u91cd\u53e0\u7684\u90a3\u4e00\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u503c\u57df\u4e2d\uff0c\u9664\u4e86 $[l,r]$ \u533a\u95f4\u5185\u7684\u6240\u6709\u503c\u90fd\u5e94\u8be5\u6e05\u96f6\uff0c\u56e0\u4e3a\u4ed6\u4eec\u6ca1\u6709\u91cd\u53e0\u90e8\u5206\u3002\n\n### \u5f02\u6216\u8fd0\u7b97\n\n\u4e24\u6761\u7ebf\u6bb5\u7684\u5f02\u6216\u5c31\u662f\u4ed6\u4eec\u4e0d\u91cd\u53e0\u7684\u90a3\u4e00\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u5e94\u8be5\u5c06 $[l,r]$ \u4e2d\u6240\u6709\u503c\u90fd\u6e05\u96f6\uff0c\u4ee5\u4e3a\u5b83\u4eec\u6709\u91cd\u53e0\u90e8\u5206\u3002\n\n\u4e4b\u6240\u4ee5\u628a\u4e0e\u8fd0\u7b97\u548c\u5f02\u6216\u8fd0\u7b97\u653e\u5230\u4e00\u8d77\u8bf4\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u53d1\u73b0\uff0c\u4e0e\u8fd0\u7b97\u7684\u7ed3\u679c\u4e0e\u5f02\u6216\u8fd0\u7b97\u7684\u7ed3\u679c\u52a0\u8d77\u6765\u7b49\u4e8e\u6216\u8fd0\u7b97\u7684\u7ed3\u679c\u3002\u56e0\u4e3a\u4e24\u4e2a\u8fd0\u7b97\u662f\u4e92\u8865\u7684\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u5b9e\u9645\u4e0a\u53ea\u7528\u8fdb\u884c\u4e00\u6b21\u6216\u8fd0\u7b97\uff0c\u7136\u540e\u4e58\u4e8c\u5373\u53ef\u3002\n\n### \u6216\u8fd0\u7b97\n\n\u4e24\u6761\u7ebf\u6bb5\u7684\u6216\u5c31\u662f\u4e24\u6761\u7ebf\u6bb5\u4e00\u5171\u8986\u76d6\u7684\u5730\u65b9\uff0c\u53ea\u8981\u4e00\u4e2a\u5730\u65b9\u88ab\u8986\u76d6\u4e86\u81f3\u5c11\u4e00\u6b21\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5730\u65b9\u5c31\u5728\u8fd9\u4e24\u6761\u7ebf\u6bb5\u7684\u6216\u4e2d\u3002\n\n\u90a3\u4e48\u5982\u4f55\u7ef4\u62a4\u8fd9\u4e2a\u64cd\u4f5c\u5462\uff1f\n\n\u9996\u5148\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u5728\u7ecf\u5386 $i(i>1)$ \u6b21\u64cd\u4f5c\u540e\u5df2\u7ecf\u5f62\u6210\u4e86 $3^{i-2}$ \u6761\u7ebf\u6bb5\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u8981\u7ed9\u6240\u6709\u7684\u7ebf\u6bb5\u90fd\u6216\u4e0a $[l,r]$\uff0c\u4f53\u73b0\u5728\u5177\u4f53\u64cd\u4f5c\u4e2d\u5c31\u662f\u5c06 $[l,r]$ \u533a\u95f4\u8d4b\u503c\u4e3a $3^{i-2}$\uff0c\u56e0\u4e3a\u5b83\u88ab\u6240\u6709\u7ebf\u6bb5\u90fd\u7b97\u4e86\u4e00\u6b21\u3002\n\n### code\n\n```cpp\n//Linkwish's code\n#include<bits/stdc++.h>\n#define int long long\n#define fi first\n#define se second\nusing namespace std;\ntypedef const int ci;\ntypedef long long ll;\ntypedef pair<int,int> pii;\nconst int iinf=0x7ffffff;\nconst ll linf=4e18;\nusing namespace std;\nnamespace _Fast_IO{\n\tchar ch;\n\tint _stack[55],_top,_sign,_strlen;\n\tinline int read_str(char *_s,const int _index){\n\t\tch=getchar();\n\t\twhile((ch<'a'||ch>'z')&&(ch<'0'||ch>'9')&&(ch<'A'||ch>'Z'))ch=getchar();\n\t\tfor(_strlen=_index;(ch>='a'&&ch<='z')||(ch>='0'&&ch<='9')||(ch>='A'&&ch<='Z');ch=getchar(),_strlen++)_s[_strlen]=ch;\n\t\treturn _strlen-1;\n\t}\n\tinline int get_01(char *_s,const int _index){\n\t\tch=getchar();\n\t\twhile(ch!='0'&&ch!='1')ch=getchar();\n\t\tfor(_strlen=_index;ch=='0'||ch=='1';ch=getchar(),_strlen++)_s[_strlen]=ch;\n\t\treturn _strlen-1;\n\t}\n\tinline int get_01(int *_s,const int _index){\n\t\tch=getchar();\n\t\twhile(ch!='0'&&ch!='1')ch=getchar();\n\t\tfor(_strlen=_index;ch=='0'||ch=='1';ch=getchar(),_strlen++)_s[_strlen]=ch^48;\n\t\treturn _strlen-1;\n\t}\n\ttemplate<typename _T>inline void read(_T &x){\n\t\tch=getchar(),_sign=1;\n\t\tfor(;ch<'0'||ch>'9';ch=getchar())if(ch=='-')_sign=-1;\n\t\tfor(x=0;ch>='0'&&ch<='9';ch=getchar())x=(x<<1)+(x<<3)+(ch^48);\n\t\tx*=_sign;\n\t}\n\ttemplate<typename _T>inline void write(_T x){\n\t\t_sign=_top=0;\n\t\tif(x<0)_sign=1,x=-x;\n\t\tif(!x)_stack[++_top]=0;\n\t\twhile(x){\n\t\t\t_stack[++_top]=x%10;\n\t\t\tx/=10;\n\t\t}\n\t\tif(_sign)putchar('-');\n\t\twhile(_top)putchar(_stack[_top--]+48);\n\t}\n\ttemplate<typename _T>inline void writeln(_T x){\n\t\twrite(x);\n\t\tputs(\"\");\n\t}\n\ttemplate<typename _T>inline void writesp(_T x){\n\t\twrite(x);\n\t\tputchar(' ');\n\t}\n}\nusing namespace _Fast_IO;\nnamespace Mod_Int{\n\tint mod=998244353;\n\tstruct modint{\n\t\tint val;\n\t\tinline int qpow(int x,int y){\n\t\t\tint res=1;\n\t\t\twhile(y){\n\t\t\t\tif(y&1)res=x*res%mod;\n\t\t\t\tx=x*x%mod;\n\t\t\t\ty>>=1;\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t\tint get_mod(long long x){return (x%mod+mod)%mod;}\t\t\n\t\tbool operator ! (){return !val;}\n\t\tmodint operator + (const int b){return {get_mod(1ll*val+1ll*b)};}\n\t\tmodint operator - (const int b){return {get_mod(1ll*val-1ll*b)};}\n\t\tmodint operator * (const int b){return {get_mod(1ll*val*b)};}\n\t\tmodint operator / (const int b){return {get_mod(val*qpow(b,mod-2))};}\n\t\tmodint operator + (const modint b){return {get_mod(1ll*val+1ll*b.val)};}\n\t\tmodint operator - (const modint b){return {get_mod(1ll*val-1ll*b.val)};}\n\t\tmodint operator * (const modint b){return {get_mod(1ll*val*b.val)};}\n\t\tmodint operator / (const modint b){return {get_mod(val*qpow(b.val,mod-2))};}\n\t\tvoid operator += (const int b){val=get_mod(1ll*val+1ll*b);}\n\t\tvoid operator -= (const int b){val=get_mod(1ll*val-1ll*b);}\n\t\tvoid operator *= (const int b){val=get_mod(1ll*val*b);}\n\t\tvoid operator /= (const int b){val=get_mod(val*qpow(b,mod-2));}\n\t\tvoid operator += (const modint b){val=get_mod(1ll*val+1ll*b.val);}\n\t\tvoid operator -= (const modint b){val=get_mod(1ll*val-1ll*b.val);}\n\t\tvoid operator *= (const modint b){val=get_mod(1ll*val*b.val);}\n\t\tvoid operator /= (const modint b){val=get_mod(val*qpow(b.val,mod-2));}\n\t};\n}\nusing namespace Mod_Int;\nconst int N=5000005,MX=300001;\nmodint sum[N],mul[N],tag[N];\nmodint pw[N];\nint n;\ninline int ls(int x){return x<<1;}\ninline int rs(int x){return x<<1|1;}\ninline void push_up(int x){sum[x]=sum[ls(x)]+sum[rs(x)];}\ninline void push_down(int x,int l,int r){\n\tif(mul[x].val==1&&!tag[x])return ;\n\tint lc=ls(x),rc=rs(x),mid=(l+r)>>1;\n\tif(tag[x].val){\n\t\ttag[lc]=tag[rc]=tag[x];\n\t\tmul[lc]=mul[rc]={1};\n\t\tsum[lc]=tag[x]*(mid-l+1);\n\t\tsum[rc]=tag[x]*(r-mid);\n\t\ttag[x]={0};\n\t}\n\tif(mul[x].val!=1){\n\t\tsum[lc]=sum[lc]*mul[x];\n\t\tsum[rc]=sum[rc]*mul[x];\n\t\tmul[lc]=mul[lc]*mul[x];\n\t\tmul[rc]=mul[rc]*mul[x];\n\t\tmul[x]={1};\n\t}\n}\nvoid build(int x,int l,int r){\n\tmul[x]={1};\n\tif(l==r)return ;\n\tint mid=(l+r)>>1;\n\tbuild(ls(x),l,mid);\n\tbuild(rs(x),mid+1,r);\n}\nvoid change(int x,int l,int r,int L,int R,modint val){\n\tif(l>=L&&r<=R){\n\t\tsum[x]=val*(r-l+1);\n\t\ttag[x]=val,mul[x]={1};\n\t\treturn ;\n\t}\n\tpush_down(x,l,r);\n\tint mid=(l+r)>>1;\n\tif(L<=mid)change(ls(x),l,mid,L,R,val);\n\tif(R>mid)change(rs(x),mid+1,r,L,R,val);\n\tpush_up(x);\n}\nsigned main(){\n\tread(n);\n\tpw[0]={1};\n\tfor(int i=1;i<=MX;i++)pw[i]=pw[i-1]*3;\n\tint l,r;\n\tread(l),read(r);\n\tl++,r++;\n\tchange(1,1,MX,l,r,{1});\n\tfor(int i=2;i<=n;i++){\n\t\tread(l),read(r);\n\t\tl++,r++;\n\t\tchange(1,1,MX,l,r,pw[i-2]);\n\t\tmul[1]=mul[1]*2,sum[1]=sum[1]*2;\n\t}\n\tcout<<sum[1].val;\n\treturn 0;\n}\n```\n",
        "postTime": 1668266745,
        "uid": 408180,
        "name": "LinkWish",
        "ccfLevel": 7,
        "title": "CF1743F\u9898\u89e3"
    },
    {
        "content": "\u7ebf\u6bb5\u4e0d\u597d\u7ef4\u62a4\uff0c\u5355\u72ec\u8003\u8651\u6bcf\u4e00\u4e2a\u70b9\u7684\u8d21\u732e\u3002\n\n\u8003\u8651\u679a\u4e3e\u5f53\u524d\u4f4d $p$\u3002\n\n\u8bbe $f(i,0/1)$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u6761\u7ebf\u6bb5\uff0c$p$ \u8fd9\u4e2a\u70b9\u662f $0/1$ \u7684\u65b9\u6848\u6570\uff0c\u8bbe $g(i)$ \u8868\u793a\u7b2c $i$ \u6761\u7ebf\u6bb5\u662f\u5426\u5305\u542b\u70b9 $p$\u3002\n$$\n\\begin{bmatrix}\nf(i,0)&f(i,1)\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nf(i-1,0)&f(i-1,1)\n\\end{bmatrix}\n\\times\n\\begin{bmatrix}\n3-2g(i)&2g(i)\\\\\n1&2\\\\\n\\end{bmatrix}\n$$\n$p$ \u7684\u8d21\u732e\u662f $f(n,1)$\u3002\n\n\u628a\u6bcf\u4e2a\u7ebf\u6bb5\u533a\u95f4\u5dee\u5206\uff0c \u5728\u7aef\u70b9\u5904\u6807\u8bb0\u4fee\u6539\uff0c\u8f6c\u79fb $p$ \u65f6\u4fee\u6539 $g(i)$\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u77e9\u9635\u5373\u53ef\uff0c\u76f4\u63a5\u52a8\u6001 dp\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002",
        "postTime": 1666328543,
        "uid": 86576,
        "name": "zlxFTH",
        "ccfLevel": 7,
        "title": "CF1743F Intersection and Union"
    },
    {
        "content": "\u53d1\u73b0 $0\\leq l_i,r_i\\leq3\\times10^5$\uff0c\u5341\u5206\u7684\u6709\u8da3\u3002\n\n\u6574\u4f53\u8ba1\u7b97\u6709\u4e00\u70b9\u6076\u5fc3\uff0c\u6240\u4ee5\u628a\u6bcf\u4e00\u4e2a\u5355\u72ec\u62c6\u51fa\u6765\u7b97\u8d21\u732e\u3002\n\n\u73b0\u5728\u5047\u8bbe\u6570 $x$ \u6700\u540e\u4e00\u6b21\u51fa\u73b0\u5728\u96c6\u5408 $s_i$ \u4e2d\uff0c\u770b\u770b\u6709\u591a\u5c11\u79cd\u60c5\u51b5\u4ed6\u662f\u4f1a\u6709\u8d21\u732e\u7684\u3002\n\n\u5047\u8bbe\u6211\u4eec\u8fdb\u884c\u64cd\u4f5c\u8fdb\u884c\u5230\u7b2c $i-1$ \u7684\u96c6\u5408\u65f6\uff0c\u4ed6\u4e0d\u542b\u6709 $x$ \u8fd9\u4e2a\u5143\u7d20\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u5e76\u6216\u8005\u5bf9\u79f0\u5dee\u4f7f\u8fdb\u884c\u5b8c\u7b2c $i-1$ \u6b21\u64cd\u4f5c\u540e\u5b58\u5728 $x$\uff1b\u540c\u7406\uff0c\u5f53\u8fdb\u884c\u5230\u7b2c $i-1$ \u4e2a\u96c6\u5408\u65f6\u542b\u6709 $x$ \u8fd9\u4e2a\u5143\u7d20\uff0c\u7b2c $i-1$ \u6b21\u64cd\u4f5c\u4e3a\u4ea4\u6216\u5e76\u90fd\u53ef\u4ee5\u3002\n\n\u7531\u4e8e $s_i$ \u96c6\u5408\u662f\u6700\u540e\u4e00\u4e2a\u542b\u6709\u8be5\u5143\u7d20\u7684\u96c6\u5408\uff0c\u6240\u4ee5\u540e\u9762\u5c31\u90fd\u6ca1\u6709\u4e86\uff0c\u6240\u4ee5\u53ea\u80fd\u9009\u62e9\u5e76\u6216\u8005\u5bf9\u79f0\u5dee\uff0c\u56e0\u6b64\u6709\u8d21\u732e\u60c5\u51b5\u4e3a $3^{i-2}\\times 2\\times 2^{n-i}$ \u79cd\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u6bcf\u79cd\u5143\u7d20\u7684\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u96c6\u5408\u7684\u4f4d\u7f6e\uff0c\u53ea\u9700\u8981\u533a\u95f4\u8986\u76d6\u548c\u5355\u70b9\u67e5\u8be2\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\max{r_i}\\times \\log{\\max{r_i}})$\u3002",
        "postTime": 1670580194,
        "uid": 377440,
        "name": "Y2y7m",
        "ccfLevel": 6,
        "title": "CF1743F Intersection and Union \u9898\u89e3"
    },
    {
        "content": "[\u66f4\u597d\u4f53\u9a8c](https://www.cnblogs.com/caijiLYC/p/16890460.html)  \n\u7ebf\u6bb5\u7684\u8d21\u732e\u4e0d\u597d\u7edf\u8ba1\uff0c\u8003\u8651\u7edf\u8ba1\u6bcf\u4e00\u4e2a\u70b9\u5728\u4e0d\u540c\u60c5\u51b5\u4e2d\u7684\u88ab\u8986\u76d6\u6b21\u6570\uff0c\u90a3\u4e48\u6bcf\u4e2a\u70b9\u7684\u88ab\u8986\u76d6\u6b21\u6570\u603b\u548c\u5373\u4e3a\u7b54\u6848\u3002  \n\u8bbe $f_{i,j,0/1}$ \u8868\u793a $i$ \u70b9\u5728\u626b\u63cf\u5230\u7ebf\u6bb5 $j$ \u65f6\u662f\u5426\u88ab\u8986\u76d6\u7684\u60c5\u51b5\u6570\u91cf\uff0c\u6734\u7d20\u7684\u8f6c\u79fb\u662f\u66b4\u529b\u679a\u4e3e\u6bcf\u4e00\u6761\u7ebf\u6bb5\uff0c\u65b9\u7a0b\u5982\u4e0b\u3002\n\n\u5f53\u7ebf\u6bb5 $j$ \u53ef\u8986\u76d6\u70b9 $i$ \u65f6\n$$f_{i,j,0}=f_{i,j-1,0}+f_{i,j-1,1}$$\n$$f_{i,j,1}=2\\times f_{i,j-1,0}+2\\times f_{i,j-1,1}$$  \n\u7b2c\u4e00\u6761\u67ff\u5b50\u4e2d\uff0c\u5982\u679c $i$ \u5c1a\u672a\u88ab\u8986\u76d6\uff0c\u90a3\u4e48\u5fc5\u987b\u4f7f\u7528\u4e14\u8fd0\u7b97\uff0c\u5982\u679c\u5df2\u88ab\u8986\u76d6\uff0c\u90a3\u4e48\u5c31\u5fc5\u987b\u7528\u53d6\u53cd\u3002\u7b2c\u4e8c\u6761\u67ff\u5b50\u540c\u7406\uff0c\u5f53 $i$ \u5c1a\u672a\u88ab\u8986\u76d6\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u6216\u548c\u53d6\u53cd\uff0c\u5982\u679c\u88ab\u8986\u76d6\uff0c\u5219\u53ef\u4ee5\u7528\u4e14\u548c\u6216\u3002\n\n\u5f53\u7ebf\u6bb5\u4e0d\u8986\u76d6 $i$ \u65f6\n$$f_{i,j,0}=3\\times f_{i,j-1,0}+f_{i,j-1,1}$$\n$$f_{i,j,1}=2\\times f_{i,j-1,1}$$  \n\u5728\u7b2c\u4e00\u4e2a\u67ff\u5b50\u4e2d\uff0c\u5982\u679c $i$ \u5c1a\u672a\u8986\u76d6\uff0c\u4e09\u79cd\u8fd0\u7b97\u90fd\u5408\u6cd5\uff0c\u5982\u679c\u88ab\u8986\u76d6\u5c31\u5fc5\u987b\u4e14\u8fd0\u7b97\u3002\u5728\u7b2c\u4e8c\u4e2a\u67ff\u5b50\u4e2d\u53ea\u80fd\u4ece\u5df2\u8986\u76d6\u4e2d\u8f6c\u79fb\u800c\u6765\uff0c\u6b64\u65f6\u53ef\u4ee5\u7528\u6216\u548c\u53d6\u53cd\u3002\n\n---\n\u6b64\u65f6\u7559\u610f\u5230\u8fd9\u4e2a\u67ff\u5b50\u8f6c\u79fb\u65b9\u5f0f\u4e00\u5b9a\uff0c\u7b26\u5408\u52a8\u6001 dp \u7684\u5f62\u5f0f\uff0c\u8003\u8651\u7528\u52a8\u6001 dp \u7ef4\u62a4\u3002\u53bb\u6389\u7b2c\u4e8c\u7ef4\uff0c\u53ef\u5c06 dp \u65b9\u7a0b\u6539\u5199\u4e3a\u77e9\u9635\u5f62\u5f0f\u3002\n\n $$\\begin{bmatrix} f_{i,0}&f_{i,1}\\end{bmatrix} =\\begin{bmatrix} f_{i-1,0}&f_{i-1,1}\\end{bmatrix} \\times  \\begin{bmatrix}1&2\\\\1&2\\\\\\end{bmatrix} $$\n $$\\begin{bmatrix} f_{i,0}&f_{i,1}\\end{bmatrix} =\\begin{bmatrix} f_{i-1,0}&f_{i-1,1}\\end{bmatrix} \\times  \\begin{bmatrix}3&0\\\\1&2\\\\\\end{bmatrix} $$\n \u5176\u4e2d\u7b2c\u4e00\u4e2a\u662f\u70b9\u88ab\u8986\u76d6\uff0c\u7b2c\u4e8c\u4e2a\u662f\u70b9\u4e0d\u88ab\u8986\u76d6\uff0c\n\u7528\u4e00\u4e2a\u7c7b\u4f3c\u5dee\u5206\u7684\u65b9\u5f0f\u8bb0\u5f55\u7ebf\u6bb5\u7684\u8986\u76d6\u60c5\u51b5\uff0c\u5728\u7aef\u70b9\u5904\u4fee\u6539\u5bf9\u5e94\u7ebf\u6bb5\u7684\u77e9\u9635\u5373\u53ef\uff0c\u5177\u4f53\u53ef\u770b\u4ee3\u7801\u3002\n```c++11\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<vector>\ntypedef long long ll;\nusing namespace std;\nconst ll mod=998244353,N=3e5+100;\nvector<ll>inc[N],decd[N];\nll n,m,nn,ans,t1,t2;\n\nstruct matrix{\n\tll a[3][3];\n\tvoid clear(){memset(a,0,sizeof(a));}\n\tvoid one(){\n\t\tfor(ll i=1;i<=2;i++){\n\t\t\tfor(ll j=1;j<=2;j++){\n\t\t\t\tif(i==j)a[i][j]=1;\n\t\t\t\telse a[i][j]=0;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tmatrix operator *(const matrix&tmp )const{\n\t\tmatrix c;\n\t\tc.clear();\n\t\tfor(ll i=1;i<=2;i++)\n\t\t\tfor(ll j=1;j<=2;j++)\n\t\t\t\tfor(ll k=1;k<=2;k++)\n\t\t\t\t\t(c.a[i][j]+=a[i][k]*tmp.a[k][j]%mod)%=mod;\n\t\treturn c;\n\t}\n}D,ini;\n\nstruct EX_segment_tree{\n\tmatrix f[N<<2];\n\t\n\tvoid modify(ll l,ll r,ll o,const ll &x,const matrix &d){\n\t\tif(l==r)f[o]=d;\n\t\telse {\n\t\t\tll mid=(l+r)>>1;\n\t\t\tif(mid>=x)modify(l,mid,o<<1,x,d);\n\t\t\telse modify(mid+1,r,o<<1|1,x,d);\n\t\t\tf[o]=f[o<<1]*f[o<<1|1];\n\t\t}\n\t}\n}T;\n\nvoid non(){\n\tD.a[1][1]=3,D.a[1][2]=0;\n\tD.a[2][1]=1,D.a[2][2]=2;\n}\n\nvoid yeh(){\n\tD.a[1][1]=1,D.a[1][2]=2;\n\tD.a[2][1]=1,D.a[2][2]=2;\n}\n\nint main(){\n\tcin>>n;\n\tfor(ll i=1;i<=n;i++){\n\t\tll a1,a2;\n\t\tscanf(\"%lld%lld\",&a1,&a2);\n\t\tif(i==1)t1=a1,t2=a2;\n\t\telse {\n\t\t\tinc[a1].push_back(i-1);\n\t\t\tdecd[a2+1].push_back(i-1);\n\t\t}\n\t\tnn=max(nn,a2);\n\t}\n\tnon();\n\tfor(ll i=1;i<n;i++)T.modify(1,n-1,1,i,D);\n\tfor(ll i=0;i<=nn;i++){\n\t\tini.clear();\n\t\tif(i>=t1&&i<=t2)ini.a[1][2]=1;\n\t\telse ini.a[1][1]=1;\n\t\tyeh();\n\t\tfor(ll j=0;j<inc[i].size();j++){\n\t\t\tll x=inc[i][j];\n\t\t\tT.modify(1,n-1,1,x,D);\n\t\t}\n\t\tnon();\n\t\tfor(ll j=0;j<decd[i].size();j++){\n\t\t\tll x=decd[i][j];\n\t\t\tT.modify(1,n-1,1,x,D);\n\t\t}\n\t\tini=ini*T.f[1];\n\t\t(ans+=ini.a[1][2])%=mod;\n\t}\n\tcout<<ans;\n}\n```",
        "postTime": 1668431880,
        "uid": 251882,
        "name": "\u849f\u84bb\u4e01",
        "ccfLevel": 6,
        "title": "CF1743F Intersection and Union \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://codeforces.com/contest/1743/problem/F)\n\n----\n### \u5199\u5728\u524d\u9762\n\n\u9ad8\u4e2d\u65f6\u4fbf\u542c\u8bf4\u8fc7\u52a8\u6001dp\uff0cNOIP 2018 d2t3 \u4e5f\u8003\u8fc7\u4e00\u6b21\uff0c\u4f46\u662f\u7531\u4e8e\u90a3\u9053\u9898\u662f\u5728\u6811\u4e0a\uff0c\u9700\u8981\u7528\u6811\u5256\u6765\u5904\u7406\uff0c\u4e8e\u662f\u5f53\u65f6\u8dd1\u53bb\u5b66\u4e86\u6811\u5256\uff0c\u4f46\u662f\u5374\u628a\u52a8\u6001 dp \u9057\u5fd8\u5230\u8111\u540e\uff0c\u8fd9\u6b21\u53c8\u9047\u5230\u4e86\uff0c\u7279\u5730\u6765\u5199\u4e00\u7bc7\u535a\u5ba2\u8bb0\u5f55\u4e00\u4e0b\uff0c\u7b97\u662f\u586b\u8865\u4e00\u4e0b\u9ad8\u4e2d\u65f6\u6ca1\u5b66\u7684\u9057\u61be,~~\u975e\u5e38\u611f\u8c22wygg\u4e00\u6b65\u4e00\u6b65\u7684\u5f15\u5bfc~~\n\n**\u8be5\u7bc7\u535a\u5ba2\u9002\u5408\u6ca1\u6709\u63a5\u89e6\u8fc7\u52a8\u6001dp\u7684\u521d\u5b66\u8005\uff0c\u56e0\u6b64\u524d\u9762\u7684\u7b80\u5355dp\u5c06\u4e0d\u4f1a\u8be6\u7ec6\u7ed9\u51fa\u63a8\u5bfc\u8fc7\u7a0b**\n\n\n-----\n### \u9898\u76ee\u5927\u610f\n\u6709 $n$ \u4e2a\u7ebf\u6bb5\uff0c\u7ebf\u6bb5 $i$ \u6240\u8986\u76d6\u7684\u70b9\u7ec4\u6210\u96c6\u5408$S_i$\uff0c\u5b9a\u4e49 $op_i$ \u4e3a $\u222a$\uff0c$\u2229$\uff0c$\u2295$\u7684\u5176\u4e2d\u4e00\u79cd\uff0c(\u5176\u4e2d $\u2295$ \u4e3a\u5bf9\u79f0\u5dee\uff0c\u5373\u4e00\u4e2a\u5305\u542b $A$ \u7684\u6240\u6709\u5143\u7d20\u548c $B$ \u7684\u6240\u6709\u5143\u7d20\u7684\u96c6\u5408\uff0c\u4f46\u4e0d\u5305\u62ec\u540c\u65f6\u5c5e\u4e8e\u8fd9\u4e24\u4e2a\u96c6\u5408\u7684\u5143\u7d20)\n\n\u5bf9\u4e8e\u6240\u6709\u53ef\u80fd\u7684 $3^{n-1}$ \u79cd\u60c5\u51b5\uff0c\u5bf9\u4ee5\u4e0b\u5f0f\u5b50\u6c42\u548c: \n$$|(((S_1\\ op_1\\ S_2)\\ op_2\\ S_3)\\ op_3\\ S_4)...\\ op_{n-1}\\ S_n|$$\n\n\n\u5176\u4e2d $|S|$ \u4e3a\u96c6\u5408 $S$ \u7684\u5927\u5c0f\n\n--------\n### \u5206\u6790\n\n\u9996\u5148\u8003\u8651 $n$ \u4e2a\u7ebf\u6bb5\u5bf9\u4e00\u4e2a\u5355\u72ec\u7684\u70b9\u7684\u8d21\u732e\uff0c\u5047\u8bbe\u8be5\u70b9\u7684\u5750\u6807\u4e3a $x$\uff0c\u5bb9\u6613\u60f3\u5230\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n- \u70b9\u5728\u7ebf\u6bb5\u5185\n- \u70b9\u5728\u7ebf\u6bb5\u5916\n\n\u5bf9\u4e8e\u4e0a\u8ff0\u6bcf\u79cd\u60c5\u51b5\uff0c\u53c8\u53ef\u4ee5\u5206\u6210\u4e09\u79cd\u5c0f\u60c5\u51b5\uff1a\n\n- \u8fd9\u6b21\u8fd0\u7b97\u7b26\u4e3a $\u222a$\n- \u8fd9\u6b21\u8fd0\u7b97\u7b26\u4e3a $\u2229$\n- \u8fd9\u6b21\u8fd0\u7b97\u7b26\u4e3a $\u2295$\n\n\u6839\u636e\u4e0a\u8ff0\u60c5\u51b5\uff0c\u4ee4 $f(i,1)$ \u8868\u793a\u7ecf\u8fc7\u8fd0\u7b97 $(S_1\\ op_1\\  S_2)...op_{i-1}\\ S_i$ \u4e4b\u540e\uff0c\u70b9 $x$ \u53ef\u4ee5\u505a\u51fa\u8d21\u732e\u7684\u65b9\u6848\u6570\u3002\u7c7b\u4f3c\u5730\uff0c $f(i,0)$ \u8868\u793a\u4e0d\u80fd\u505a\u51fa\u8d21\u732e\u7684\u65b9\u6848\u6570\u3002\n\n\u56e0\u6b64\u53ef\u4ee5\u5f97\u5230\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n- \u70b9 $x$ \u5728\u7ebf\u6bb5 $i$ \u5185\u65f6\n$$f(i,0) = f(i-1,0)+f(i-1,1)$$\n$$f(i,1) = 2\\times f(i-1,0)+2\\times f(i-1,1)$$\n\n- \u70b9 $x$ \u5728\u7ebf\u6bb5 $i$ \u5916\u65f6\n$$f(i,0) = 3\\times f(i-1,0)+f(i-1,1)$$\n$$f(i,1) = 2\\times f(i-1,1)$$\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 $O(n)$ \u6765\u6c42\u51fa\uff0c\u4f46\u662f\u590d\u6742\u5ea6\u4e0d\u80fd\u63a5\u53d7\uff0c\u4e0b\u9762\u8003\u8651\u4f18\u5316\u3002\n\n-------\n\n\u53d1\u73b0\u5bf9\u4e8e $f(i)$ \u6765\u8bf4\uff0c\u4ed6\u7684\u72b6\u6001\u53ea\u548c $f(i-1)$\u6709\u5173\n\n\u8003\u8651\u77e9\u9635\uff1a\n$\n\\left[\n\\begin{matrix}\nf(i,0) & f(i,1)\n\\end{matrix}\n\\right]\n$ \uff0c\u5173\u4e8e\u5b83\u600e\u4e48\u7531\u4e0a\u4e2a\u72b6\u6001\u5f97\u5230\uff0c\u8fd8\u662f\u8981\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- \u70b9 $x$ \u5728\u7ebf\u6bb5 $i$ \u5185\u65f6 \uff1a\n$\n\\left[\n\\begin{matrix}\nf(i,0) & f(i,1)\n\\end{matrix}\n\\right]\n = \n\\left[\n\\begin{matrix}\nf(i - 1,0) & f(i - 1,1)\n\\end{matrix}\n\\right]\n\\times \\left[\n\\begin{matrix}\n1 & 2\\\\\n1 & 2\n\\end{matrix}\n\\right]\n$ \n- \u70b9 $x$ \u5728\u7ebf\u6bb5 $i$ \u5916\u65f6 \uff1a\n$\n\\left[\n\\begin{matrix}\nf(i,0) & f(i,1)\n\\end{matrix}\n\\right]\n = \n\\left[\n\\begin{matrix}\nf(i - 1,0) & f(i - 1,1)\n\\end{matrix}\n\\right]\n\\times \\left[\n\\begin{matrix}\n3 & 0\\\\\n1 & 2\n\\end{matrix}\n\\right]\n$ \n\n\u7136\u540e\u6211\u4eec\u8003\u8651\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u53ef\u4ee5\u6839\u636e\u4ed6\u7684\u6240\u5728\u4f4d\u7f6e\uff0c\u6bcf\u4e2a $op_i$ \u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u552f\u4e00\u7684\u77e9\u9635\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5728\u5f97\u5230 $n - 1$ \u4e2a\u77e9\u9635\u4e4b\u540e\uff0c$\n\\left[\n\\begin{matrix}\nf(1,0) & f(1,1)\n\\end{matrix}\n\\right]\n\\times $ \u4ed6\u4eec\u7684\u4e58\u79ef\u5c31\u662f\u6211\u4eec\u6240\u8981\u7684\u7b54\u6848\uff0c\u4f46\u662f\u8fd9\u6837\u590d\u6742\u5ea6\u4ecd\u7136\u662f $O(n)$ \u7684\uff0c\u751a\u81f3\u5e38\u6570\u8fd8\u589e\u5927\u4e86\u3002\n\n\u4f46\u662f\u901a\u8fc7\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86\u70b9 $x$ \u7684\u7b54\u6848\u4e4b\u540e\uff0c\u90a3\u4e48\u5bf9\u4e8e\u70b9 $x + 1$\uff0c\u5982\u679c\u4ed6\u4eec\u540c\u65f6\u5728\u67d0\u7ebf\u6bb5\u5185\uff0c\u6216\u8005\u540c\u65f6\u4e0d\u5728\u67d0\u7ebf\u6bb5\u5185\uff0c\u90a3\u4e48\u8be5\u7ebf\u6bb5\u5bf9\u4ed6\u4eec\u7684\u5f71\u54cd\u662f\u76f8\u540c\u7684\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u4e5f\u5c31\u662f\u8be5\u7ebf\u6bb5\u524d\u9762\u5bf9\u5e94\u7684\u7b26\u53f7\u6240\u5bf9\u5e94\u7684\u77e9\u9635\u662f\u4e0d\u53d8\u7684\uff0c\u518d\u6b21\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ea\u6709\u5de6\u7aef\u70b9\u5728 $x + 1$ \u5904\u7684\u7ebf\u6bb5\u548c\u53f3\u7aef\u70b9\u5728 $x$ \u5904\u7684\u7ebf\u6bb5\u6240\u5bf9\u5e94\u7684\u7b26\u53f7\u5bf9\u5e94\u7684\u77e9\u9635\u624d\u4f1a\u6539\u53d8\uff0c\u56e0\u6b64\u5bf9\u4e8e\u6bcf\u6b21 $x$ \u7684\u6539\u53d8\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6539\u53d8\u8fd9\u4e24\u4e2a\u4f4d\u7f6e\u7684\u82e5\u5e72\u4e2a\u77e9\u9635\u7136\u540e\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e58\u79ef\u5373\u53ef\u3002\n\n\u663e\u7136\uff0c\u7531\u4e8e\u6bcf\u4e2a\u7ebf\u6bb5\u53ea\u6709\u4e24\u4e2a\u7aef\u70b9\uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ebf\u6bb5\u6240\u5728\u4f4d\u7f6e\u77e9\u9635\u6700\u591a\u6539\u53d8 2 \u6b21\uff0c\u590d\u6742\u5ea6\u662f $O(n\\log n)$\n\n\u53ef\u4ee5\u53d1\u73b0 \u52a8\u6001dp \u662f\u5728 \u666e\u901adp \u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4fee\u6539\u64cd\u4f5c\uff0c\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u628a\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5199\u6210\u77e9\u9635\u7684\u5f62\u5f0f\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u4fee\u6539\u6211\u4eec\u53ea\u4fee\u6539\u77e9\u9635\uff0c\u7136\u540e\u5bf9\u4e8e\u77e9\u9635\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u6211\u4eec\u6240\u8981\u7684\u4fe1\u606f\u5373\u53ef\u3002\n\n### $\\texttt{Code}$\n```cpp\n#include<bits/stdc++.h>\n\ntypedef long long ll;\n\ntemplate<class T>\nchar prt(T x) {\n\tif(!x) return '\\n';\n\tif(x < 0) printf(\"-\") , x = -x;\n\tprt(x / 10); printf(\"%d\",x % 10);\n\treturn '\\n';\n}\n\ntemplate<class T>\nvoid pr(T x) {\n\tprintf(\"%c\",prt(x));\n}\n\nvoid debug() {\n\n}\n\nconst int p = 998244353;\nconst int N = 3e5 + 10;\nint n; \nstruct JZ {\n    int a[3][3];\n\n    JZ operator * (JZ B) {\n        JZ ans;\n        for(int i = 1; i <= 2; i++)\n            for(int j = 1; j <= 2; j++)\n                ans.a[i][j] = 0;\n        \n        for(int k = 1; k <= 2; k++)\n            for(int i = 1; i <= 2; i++)\n                for(int j = 1; j <= 2; j++)\n                    ans.a[i][j] = (ans.a[i][j] + (1ll * a[i][k] * B.a[k][j]) % p) % p;\n        return ans;\n    }\n}A,C;\n\nstd::vector<JZ> b(N);\n\nstruct NO {\n    int l;\n    int r;\n    JZ w;\n};\n\nstruct SigmentT {\n    NO t[N * 4];\n\n    void Pushup(int p) {\n        t[p].w = t[p << 1].w * t[p << 1 | 1].w;\n    }\n\n    void Build(int p , int l , int r) {\n        t[p].l = l; t[p].r = r;\n        if(l == r) {\n            t[p].w = b[l];\n            return;\n        }\n        int mid = (l + r) >> 1;\n        Build(p << 1 , l , mid); Build(p << 1 | 1 , mid + 1 , r);\n        Pushup(p);\n    }\n\n    void Updata(int p , int l , int r , JZ w) {\n        if(l <= t[p].l && r >= t[p].r) {\n            t[p].w = w;\n            return;\n        }\n        int mid = (t[p].l + t[p].r) >> 1;\n        if(l <= mid) Updata(p << 1 , l , r , w);\n        if(r > mid) Updata(p << 1 | 1 , l , r , w);\n        Pushup(p);\n    }\n\n}tr;\n\nstd::vector<int> L[N],R[N];\nint main() {\n#ifdef LOCAL\n    freopen(\"aa.in\",\"r\",stdin);\n    freopen(\"aa.out\",\"w\",stdout);\n#endif\n    scanf(\"%d\",&n);\n    struct El {\n        int l;\n        int r;\n        bool operator < (const El &B) const {\n            if(l != B.l) return l < B.l;\n            return r < B.r;\n        }\n    }a[n + 1];\n    \n    for(int i = 1; i <= n; i++)\n        scanf(\"%d%d\",&a[i].l,&a[i].r) , L[a[i].l].push_back(i) , R[a[i].r].push_back(i);\n    //std::sort(a + 2 , a + 1 + n);\n\n    A.a[1][1] = 1 , A.a[1][2] = 2;\n    A.a[2][1] = 1 , A.a[2][2] = 2;\n    C.a[1][1] = 3 , C.a[1][2] = 0;\n    C.a[2][1] = 1 , C.a[2][2] = 2;\n\n\n    int ans = 0;\n    for(int j = 2; j <= n; j++) \n        if(0 <= a[j].r && 0 >= a[j].l)  b[j - 1] = A;\n        else  b[j - 1] = C;\n    tr.Build(1 , 1 , n - 1);\n    for(int i = 0; i <= N - 10; i++) {\n        JZ f; memset(f.a , 0 , sizeof(f.a));    \n        if(i <= a[1].r && i >= a[1].l) f.a[1][2]++;\n        else f.a[1][1]++;\n\n        // if(i)\n        // for(int j = 2; j <= n; j++) {\n        //     int l = a[j].l , r = a[j].r;\n        //     std::function<bool(int)> check = [l , r](int x) {\n        //         if(x <= r && x >= l) return true;\n        //         return false;\n        //     };\n        //     if(!((check(i) && check(i - 1)) || ((!check(i)) && (!check(i - 1))))) \n        //         if(check(i)) tr.Updata(1 , j - 1 , j - 1 , A);\n        //         else tr.Updata(1 , j - 1 , j - 1 , C);\n                \n        // }\n        if(i) {\n            for(auto x:L[i]) {\n                if(x == 1) continue;\n                tr.Updata(1 , x - 1 , x - 1 , A);\n            }\n            for(auto x:R[i - 1]) {\n                if(x == 1) continue;\n                tr.Updata(1 , x - 1 , x - 1 , C);\n            }\n        }\n\n\n        f = f * tr.t[1].w;\n        ans = (ans + f.a[1][2]) % p;\n        //printf(\"%d\\n\",f.a[1][2]);\n    }\n    printf(\"%lld\",ans);\n}\n\n\n```",
        "postTime": 1666195893,
        "uid": 232191,
        "name": "NXYorz",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF1743F\u3010 Intersection and Union\u3011"
    },
    {
        "content": "\u7b49\u4e00\u6ce2\u6d1b\u8c37\u722cCF\n\n\u663e\u7136\u7684\u662f\u6bcf\u4e00\u4f4d\u53ea\u548c\u81ea\u5df1\u90a3\u4e00\u4f4d\u6709\u5173\uff1a\uff08\u6837\u4f8b2\uff09\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/wbrdvxgg.png)\n\n\u56e0\u4e3a\u7b54\u6848\u6c42\u7684\u662f\u96c6\u5408\u5927\u5c0f\uff0c\u6240\u4ee5\u73c2\u4ee5\u5c06\u7b54\u6848\u5206\u89e3\u4e3a\uff1a$\\sum_{i=0}^{300000} \\text{\u7b2ci\u4f4d\u88ab\u586b\u5145\u7684\u65b9\u6848\u6570}$\n\n\u4e8e\u662f\u6211\u4eec\u6316\u51fa\u6bcf\u4e00\u4f4d\u6765DP\uff1a\n\n\u8bb0 $dp_{i,0/1}$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u533a\u95f4\uff0c\u4e0d\u88ab\u586b\u5145/\u88ab\u586b\u5145 \u7684\u65b9\u6848\u6570\u3002\n\n\u521d\u59cb\u72b6\u6001 $dp_{1,0/1} = 0/1$\uff0c\u53d6\u51b3\u4e8e\u88ab\u4e0d\u88ab\u7b2c\u4e00\u4e2a\u533a\u95f4\u5305\u542b\u3002\n\n\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fmfv2ix1.png)\n\n\uff08\u7b49\u53f7\u5de6\u8fb9\u8868\u793a $dp_{i,0/1}$\uff0c\u4e2d\u95f4\u8868\u793a\u8fd9\u4e2a\u70b9\u88ab\u4e0d\u88ab\u533a\u95f4 $l_i,r_i$ \u8986\u76d6\uff0c\u53f3\u8fb9\u7ea2\u8272\u8868\u793a $dp_{i-1,0/1}$\uff09\n\n\u7efc\u4e0a\uff0c\u5728\u8fd9\u4e2a\u70b9\u88ab\u8986\u76d6\u7684\u60c5\u51b5\u4e0b\uff0c\u8f6c\u79fb\u4e3a\uff1a\n\n$$dp_{i,0}=dp_{i-1,0}+dp_{i-1,1}$$\n\n$$dp_{i,1}=2\\times dp_{i-1,0}+2\\times dp_{i-1,1}$$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dyqdi8d9.png)\n\n\u7efc\u4e0a\uff0c\u5728\u8fd9\u4e2a\u70b9\u6ca1\u88ab\u8986\u76d6\u7684\u60c5\u51b5\u4e0b\uff0c\u8f6c\u79fb\u4e3a\uff1a\n\n$$dp_{i,0}=3\\times dp_{i-1,0}+ dp_{i-1,1}$$\n\n$$dp_{i,1}=2\\times dp_{i-1,1}$$\n\n\u7136\u800c\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u663e\u7136\u662f $O(3\\times 10^5 \\times n)$ \u7684\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u6709\u54ea\u4e9b\u533a\u95f4\u7684\u72b6\u6001\u7684\u91cd\u590d\u7684\u3002\n\n\u89c2\u5bdf\u6837\u4f8b\uff0c\u5982\u679c\u79f0\u8fd9\u4e2a\u70b9\u7684\u72b6\u6001\uff08\u79f0\u4e4b\u4e3a $a_{i,j}$\uff09\u4e0e\u4e0a\u4e00\u4e2a\u70b9\uff08\u5bf9\u5e94 $a_{i,j-1}$\uff09\u7684\u72b6\u6001\u4e0d\u540c\uff0c\u5c31\u79f0\u4e4b\u4e3a _\u73c2\u7231\u70b9_\uff0c\u5bb9\u6613\u53d1\u73b0\uff0c\u5f71\u54cd dp \u72b6\u6001\u7684\u53ea\u6709\u8fd9\u4e9b\u70b9\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/for1fdqp.png)\n\n\u56e0\u4e3a _\u73c2\u7231\u70b9_ \u4e2a\u6570\u4e0d\u8d85\u8fc7 $O(n)$ \uff0c\u4e8e\u662f\u505a\u6cd5\u975e\u5e38\u663e\u7136\u4e86\uff0c\u628a $dp_{i,0/1}$ \u8bbe\u7f6e\u6210\u4e8c\u5143\u77e9\u9635\uff1a\n\n$$dp_i=\\begin{bmatrix}dp_{i,0}&dp_{i,1}\\end{bmatrix}$$\n\n\u66f4\u65b0\u4e00\u4e0b\u6211\u4eec\u7684\u8f6c\u79fb\uff1a\n\n\u521d\u59cb\u72b6\u6001\uff1a\n\n$$dp_1=\\begin{bmatrix}\\text{\u662f\u4e0d\u662f\u4e0d\u88ab\u533a\u95f41\u8986\u76d6}&\\text{\u662f\u4e0d\u662f\u88ab\u533a\u95f41\u8986\u76d6}\\end{bmatrix}$$\n\n\u5982\u679c\u88ab $i$ \u533a\u95f4\u8986\u76d6\uff0c\u8f6c\u79fb\u4e3a\uff1a\n\n$$dp_i=dp_{i-1}\\times \\begin{bmatrix}1&2\\\\1&2\\end{bmatrix}$$\n\n\u5982\u679c\u672a\u88ab $i$ \u533a\u95f4\u8986\u76d6\uff0c\u8f6c\u79fb\u4e3a\uff1a\n\n$$dp_i=dp_{i-1}\\times \\begin{bmatrix}3&0\\\\1&2\\end{bmatrix}$$\n\n\u4e8e\u662f\u6211\u4eec\u73b0\u5728\u9700\u8981\u5e72\u7684\u5c31\u662f\uff1a\n\n- \u533a\u95f4\u77e9\u9635\u4e58\n- \u5355\u70b9\u4fee\u6539\uff08_\u73c2\u7231\u70b9_\uff09\n\n\u663e\u7136\u7684\uff0c\u6254\u8fdb\u7ebf\u6bb5\u6811\u4e0a\u5373\u53ef\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <vector>\n\n#define mod 998244353\n#define int long long\n\n#define N 300010\nint n;\n\nstruct matrix\n{\n\tint x,y;\n\tint a[3][3];\n\tvoid make_unit()\n\t{\n\t\tfor(int i = 0;i < x;i++)\n\t\t\tfor(int j = 0;j < y;j++)\n\t\t\t\ta[i][j] = (i == j);\n\t}\n\tinline int* operator [](const int &x)\n\t{\n\t\treturn a[x];\n\t}\n\tinline void out()\n\t{\n\t\tfor(int i = 0;i < x;i++)\n\t\t{\n\t\t\tfor(int j = 0;j < y;j++)\n\t\t\t\tprintf(\"%lld \",a[i][j]);\n\t\t\tputchar('\\n');\n\t\t}\n\t}\n};\n\ninline matrix mul(matrix p,matrix q)\n{\n\tmatrix res;\n\tres.x = p.x;\n\tres.y = q.y;\n\tfor(int i = 0;i < res.x;i++)\n\t\tfor(int j = 0;j < res.y;j++)\n\t\t\tres.a[i][j] = 0;\n\tfor(int i = 0;i < p.x;i++)\n\t{\n\t\tfor(int j = 0;j < q.x;j++)\n\t\t{\n\t\t\tfor(int k = 0;k < q.y;k++)\n\t\t\t{\n\t\t\t\tres.a[i][j] = (res.a[i][j] + p.a[i][k] * q.a[k][j] % mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n}\n\nstruct Tree\n{\n\tint l,r;\n\tmatrix sum;\n}tr[N << 2];\n\n#define lson k << 1\n#define rson k << 1 | 1\nint a[N];\n\nmatrix get_mat(bool v)\n{\n\tmatrix res;\n\tres.x = 2,res.y = 2;\n\tif(v == 0)\n\t{\n\t\tres[0][0] = 3;\n\t\tres[0][1] = 0;\n\t\tres[1][0] = 1;\n\t\tres[1][1] = 2;\n\t}\n\telse\n\t{\n\t\tres[0][0] = 1;\n\t\tres[0][1] = 2;\n\t\tres[1][0] = 1;\n\t\tres[1][1] = 2;\n\t}\n\treturn res;\n}\n\nvoid build(int k,int l,int r)\n{\n\ttr[k].l = l,tr[k].r = r;\n\ttr[k].sum.x = 2;\n\ttr[k].sum.y = 2;\n\tif(l == r)\n\t{\n\t\ttr[k].sum = get_mat(a[l]);\n\t\treturn;\n\t}\n\tint mid = l + r >> 1;\n\tbuild(lson,l,mid);\n\tbuild(rson,mid + 1,r);\n\ttr[k].sum = mul(tr[lson].sum,tr[rson].sum);\n}\n\nvoid change(int k,int q,bool z)\n{\n\tint l = tr[k].l,r = tr[k].r;\n\tif(l == r)\n\t{\n\t\ttr[k].sum = get_mat(z);\n\t\treturn;\n\t}\n\tint mid = l + r >> 1;\n\tif(q <= mid)\n\t\tchange(lson,q,z);\n\telse\n\t\tchange(rson,q,z);\n\ttr[k].sum = mul(tr[lson].sum,tr[rson].sum);\t\n}\nstd::vector <int> l[N];\nstd::vector <int> r[N];\n\nint ans;\nint mx;\n\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i = 1,x,y;i <= n;i++)\n\t{\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tif(x > mx)\n\t\t\tmx = x;\n\t\tif(y > mx)\n\t\t\tmx = y;\n\t\tl[x].push_back(i);\n\t\tr[y].push_back(i);\n\t}\n\tbuild(1,2,n);\n\tfor(int i = 0;i <= mx;i++)\n\t{\n\t\tint sz = l[i].size();\t\n\t\tfor(int j = 0;j < sz;j++)\n\t\t{\n\t\t\ta[l[i][j]] = 1;\n\t\t\tchange(1,l[i][j],1);\n\t\t}\n\t\tmatrix base;\n\t\tbase.x = 1;\n\t\tbase.y = 2;\n\t\tbase[0][0] = (a[1] == 0);\n\t\tbase[0][1] = (a[1] == 1);\n\t\tans += mul(base,tr[1].sum).a[0][1];\n\t\tans %= mod;\n\t\tsz = r[i].size();\t\n\t\tfor(int j = 0;j < sz;j++)\n\t\t{\n\t\t\ta[r[i][j]] = 0;\n\t\t\tchange(1,r[i][j],0);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1666076861,
        "uid": 371968,
        "name": "ningago",
        "ccfLevel": 4,
        "title": "CF1743F"
    },
    {
        "content": "\u7b2c\u4e00\u6b21\u72ec\u7acb\u505a\u51fa div2D+ \u7684\u9898\uff0c\u4f46\u662f\u6ca1\u5728 VP \u65f6\u5199\u5b8c\u3002\r\n\r\n\u9898\u76ee\u6761\u4ef6 $0\\le l\\le r\\le 3\\times 10^5$\uff0c\u63d0\u793a\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u6570 $x$ \u7b97\u8d21\u732e\uff0c\u5373 $x$ \u5728\u6700\u540e\u7684\u96c6\u5408\u4e2d\u7684\u65b9\u6848\u6570\u3002\r\n\r\n\u4ee4 $S_{pos}$ \u4e3a $x$ \u6700\u540e\u51fa\u73b0\u7684\u96c6\u5408\uff0c\u5219 $op_{\\max\\{1,pos-1\\}}$ \u662f\u6709\u5173\u8fd9\u4e2a\u96c6\u5408\u7684\u8fd0\u7b97\u7b26\u3002\u8bbe $p=\\max\\{1,pos-1\\}$\u3002\r\n\r\n\u5047\u8bbe\u8fd9\u6b21\u64cd\u4f5c\u540e $x$ \u8fd8\u5728\u96c6\u5408\u4e2d\u3002\u8003\u8651\u8fd9\u4e2a\u8fd0\u7b97\u7b26\u540e\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a $x$ \u4e0d\u4f1a\u518d\u51fa\u73b0\uff0c\u6240\u4ee5\u540e\u9762\u7684\u8fd0\u7b97\u53ea\u80fd\u662f\u5e76\u6216\u8005\u5bf9\u79f0\u5dee\uff0c\u8fd9\u91cc\u6709 $2^{(n-1)-p+1}=2^{n-p}$ \u79cd\u65b9\u6848\u3002\r\n\r\n\u518d\u6765\u770b $op_p$ \u8fd9\u4e2a\u8fd0\u7b97\u7b26\uff0c\u8ba8\u8bba\u4e0e $S_{pos}$ \u8fd0\u7b97\u7684\u96c6\u5408\u662f\u5426\u5b58\u5728 $x$\u3002\r\n\r\n\u5982\u679c\u5b58\u5728\uff0c\u8fd9\u4e2a\u8fd0\u7b97\u7b26\u5c31\u662f\u5e76\u6216\u4ea4\uff1b\u5426\u5219\u662f\u5e76\u6216\u5bf9\u79f0\u5dee\u3002\u56e0\u6b64 $op_p$ \u65e0\u8bba\u4e4b\u524d\u7684\u503c\u662f\u591a\u5c11\uff0c\u90fd\u6709\u4e24\u79cd\u9009\u62e9\u4f7f $x$ \u5bf9\u7b54\u6848\u6709\u8d21\u732e\u3002\u4e5f\u53ef\u4ee5\u53d1\u73b0\u524d $p-1$ \u4e2a\u8fd0\u7b97\u600e\u4e48\u9009\u90fd\u5408\u6cd5\u3002\u65b9\u6848\u6570 $2\\times 3^{p-1}$\u3002\r\n\r\n\u4e8e\u662f\u53ea\u8981\u6c42\u51fa $pos$\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u8986\u76d6\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n\\log V)$\uff0c$V$ \u4e3a\u503c\u57df\u3002\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define ls (cur<<1)\r\n#define rs (cur<<1|1)\r\n#define fir first\r\n#define sec second\r\n#define pii pair<int,int>\r\n#define Mp make_pair\r\nusing namespace std;\r\ntypedef long long ll;\r\nconst int N=3e5+5,K=1.3e6+5,mod=998244353;\r\nint n,pos[N],ans;\r\npii op[N];\r\nstruct SegmentTree{//\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u8986\u76d6\uff0c\u5355\u70b9\u67e5\u8be2\r\n    int tag[K];\r\n    SegmentTree(){\r\n        memset(tag,0,sizeof(tag));\r\n    }\r\n    void addtg(int cur,int val){\r\n        if(!tag[cur]) tag[cur]=val;\r\n    }\r\n    void pd(int cur){\r\n        if(!tag[cur]) return;\r\n        int t=tag[cur];\r\n        addtg(ls,t);\r\n        addtg(rs,t);\r\n        return;\r\n    }\r\n    void upd(int cur,int l,int r,int qx,int qy,int val){\r\n        if(l>qy || r<qx || tag[cur]) return;\r\n        if(l>=qx && r<=qy){\r\n            addtg(cur,val);\r\n            return;\r\n        }\r\n        pd(cur);\r\n        int mid=l+r>>1;\r\n        upd(ls,l,mid,qx,qy,val);\r\n        upd(rs,mid+1,r,qx,qy,val);\r\n        return;\r\n    }\r\n    int qry(int cur,int l,int r,int qx){\r\n        if(l==r) return tag[cur];\r\n        pd(cur);\r\n        int mid=l+r>>1;\r\n        if(qx<=mid) return qry(ls,l,mid,qx);\r\n        return qry(rs,mid+1,r,qx);\r\n    }\r\n}T;\r\nint qp(int x,int y){\r\n    if(!y) return 1;\r\n    int tm=qp(x,y>>1);\r\n    if(y&1) return 1ll*tm*tm%mod*x%mod;\r\n    return 1ll*tm*tm%mod;\r\n}\r\nint main(){\r\n    scanf(\"%d\",&n);\r\n    for(int i=1;i<=n;i++){\r\n        int l,r;\r\n        scanf(\"%d%d\",&l,&r);\r\n        op[i]=Mp(l,r);\r\n    }\r\n    for(int i=n;i;i--)\r\n        T.upd(1,0,N-5,op[i].fir,op[i].sec,i);\r\n    for(int i=0;i<=N-5;i++)//\u6c42\u51fa pos\r\n        pos[i]=T.qry(1,0,N-5,i);\r\n    for(int i=0;i<=N-5;i++){\r\n        int x=pos[i];\r\n        if(!x) continue;\r\n        if(x==1){\r\n            ans=(ans+qp(2,n-1)%mod)%mod;continue;\r\n        }\r\n        ans=(ans+1ll*qp(2,n-x+1)*qp(3,x-2)%mod)%mod;\r\n    }\r\n    printf(\"%d\",ans);\r\n    return 0;\r\n}\r\n```",
        "postTime": 1669173806,
        "uid": 431487,
        "name": "_zdc_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1743F"
    },
    {
        "content": "\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e $i$ \u7684\u8d21\u732e\u3002\n\n\u6ce8\u610f\u5230\u5bf9\u4e8e\u6bcf\u6b21\u64cd\u4f5c $[l_j, r_j]$\uff0c\u6211\u4eec\u6839\u636e $i$ \u7684\u4f4d\u7f6e\u53ca\u4e4b\u524d\u7684\u503c $v = 0/1$ \u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u3002\n\n1. $i \\in [0, l_j) \\cup (r_j, N]$\n\n- \u6c42\u5e76\uff1a$v = 0 \\to v = 0$\uff0c$v = 1 \\to v = 1$\u3002\n- \u6c42\u4ea4\uff1a$v = 0 \\to v = 0$\uff0c$v = 1 \\to v = 0$\u3002\n- \u6c42\u5f02\u6216\uff08\u4e5f\u5c31\u662f symmetric difference \u5728\u4e00\u4e2a\u4f4d\u7f6e\u7684\u8868\u73b0\uff09\uff1a$v = 0 \\to v = 0$\uff0c$v = 1 \\to v = 1$\u3002\n\n2. $i \\in [l_j, r_j]$\n\n- \u6c42\u5e76\uff1a$v = 0 \\to v = 1$\uff0c$v = 1 \\to v = 1$\u3002\n- \u6c42\u4ea4\uff1a$v = 0 \\to v = 0$\uff0c$v = 1 \\to v = 1$\u3002\n- \u6c42\u5f02\u6216\uff08\u4e5f\u5c31\u662f symmetric difference \u5728\u4e00\u4e2a\u4f4d\u7f6e\u7684\u8868\u73b0\uff09\uff1a$v = 0 \\to v = 1$\uff0c$v = 1 \\to v = 0$\u3002\n\n\u8fd9\u662f\u5bb9\u6613\u7528\u4e00\u4e2a $2 \\times 2$ \u7684\u77e9\u9635\u63cf\u8ff0\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u4e0a\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u4e58\u77e9\u9635\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N + n \\log N)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n#include <string.h>\n\ntypedef struct Matrix_tag {\n\tint n;\n\tint m;\n\tint a[3][3];\n\t\n\tMatrix_tag(){}\n\t\n\tinline void clear(int n_, int m_){\n\t\tn = n_;\n\t\tm = m_;\n\t\tmemset(a, 0, sizeof(a));\n\t}\n\t\n\tMatrix_tag(int n_, int m_){\n\t\tclear(n_, m_);\n\t}\n} Matrix;\n\ntypedef struct {\n\tint l;\n\tint r;\n\tMatrix tag;\n} Node;\n\nconst int N = 3e5, M = 1.2e6 + 7, mod = 998244353;\nMatrix a(2, 2), b(2, 2), e(2, 2);\nbool vis[N + 7];\nNode tree[M];\n\ninline void add(int &x, int y){\n\tif ((x += y) >= mod) x -= mod;\n}\n\nMatrix operator *(const Matrix a, const Matrix b){\n\tMatrix ans(a.n, b.m);\n\tfor (register int i = 1; i <= a.n; i++){\n\t\tfor (register int j = 1; j <= a.m; j++){\n\t\t\tfor (register int k = 1; k <= b.m; k++){\n\t\t\t\tadd(ans.a[i][j], 1ll * a.a[i][k] * b.a[k][j] % mod);\n\t\t\t}\n\t\t}\n\t}\n\treturn ans;\n}\n\nMatrix operator *=(Matrix &a, const Matrix b){\n\treturn a = a * b;\n}\n\ninline void init(){\n\ta.a[1][1] = a.a[2][1] = 1;\n\ta.a[1][2] = a.a[2][2] = 2;\n\tb.a[1][1] = 3;\n\tb.a[2][1] = 1;\n\tb.a[2][2] = 2;\n\tfor (register int i = 1; i <= 2; i++){\n\t\te.a[i][i] = 1;\n\t}\n}\n\nvoid build(int x, int l, int r){\n\ttree[x].l = l;\n\ttree[x].r = r;\n\ttree[x].tag = e;\n\tif (l == r) return;\n\tint mid = (l + r) >> 1;\n\tbuild(x * 2, l, mid);\n\tbuild(x * 2 + 1, mid + 1, r);\n}\n\ninline void pushdown(int x){\n\ttree[x * 2].tag *= tree[x].tag;\n\ttree[x * 2 + 1].tag *= tree[x].tag;\n\ttree[x].tag = e;\n}\n\nvoid mul(int x, int l, int r, Matrix &mat){\n\tif (l <= tree[x].l && tree[x].r <= r){\n\t\ttree[x].tag *= mat;\n\t\treturn;\n\t}\n\tint mid = (tree[x].l + tree[x].r) >> 1;\n\tpushdown(x);\n\tif (l <= mid) mul(x * 2, l, r, mat);\n\tif (r > mid) mul(x * 2 + 1, l, r, mat);\n}\n\nint dfs(int x){\n\tif (tree[x].l == tree[x].r) return !vis[tree[x].l] ? tree[x].tag.a[1][2] : tree[x].tag.a[2][2];\n\tpushdown(x);\n\treturn (dfs(x * 2) + dfs(x * 2 + 1)) % mod;\n}\n\nint main(){\n\tint n;\n\tscanf(\"%d\", &n);\n\tinit();\n\tbuild(1, 0, N);\n\tfor (register int i = 1; i <= n; i++){\n\t\tint l, r;\n\t\tscanf(\"%d %d\", &l, &r);\n\t\tif (i == 1){\n\t\t\tfor (register int j = l; j <= r; j++){\n\t\t\t\tvis[j] = true;\n\t\t\t}\n\t\t} else {\n\t\t\tmul(1, l, r, a);\n\t\t\tif (l > 0) mul(1, 0, l - 1, b);\n\t\t\tif (r < N) mul(1, r + 1, N, b);\n\t\t}\n\t}\n\tprintf(\"%d\", dfs(1));\n\treturn 0;\n}\n```",
        "postTime": 1666176348,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1743F \u3010Intersection and Union\u3011"
    }
]