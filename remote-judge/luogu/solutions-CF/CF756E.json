[
    {
        "content": "\u6211\u4eec\u8bbe $f_{i, j}$ \u8868\u793a\u524d $i$ \u79cd\u91d1\u5e01\uff0c\u603b\u9762\u989d\u4e3a $j$ \u7684\u65b9\u6848\u6570\u3002$d_i$ \u8868\u793a $\\prod_{j=1}^i a_j$\uff0c$k=20$ \u8868\u793a $a_i=1$ \u7684\u8fde\u7eed\u6bb5\u6700\u5927\u957f\u5ea6\u3002\n\n\u663e\u7136\uff0c$f_{i, j}$ \u7ed9\u7b54\u6848\u8d21\u732e\u4ec5\u5f53 $j\\equiv m\\pmod {d_i}$\u3002\u56e0\u4e3a $i$ \u4e4b\u540e\u7684\u9762\u989d\u90fd\u662f $d_i$ \u7684\u500d\u6570\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u8bbe $g_{i, j}$ \u8868\u793a $f_{i, d_i\\times j+m\\bmod d_i}$\u3002\u8bbe $sz_i = \\max\\{j|g_{i, j}\\neq 0\\}$\uff0c\u5219\u6709\n\n$$sz_i\\leq \\sum_{j=1}^i b_j\\frac{d_j}{d_i}$$\n\n\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709 $\\frac{d_i}{d_j}$ \u7684\u500d\u6570\u624d\u662f\u6709\u53ef\u80fd\u5bf9\u7b54\u6848\u6709\u8d21\u732e\u7684 $j$\uff0c\u5171 $b_j\\frac{d_j}{d_i}$ \u4e2a\u3002\n\n$d_i$ \u81f3\u591a\u5f80\u524d $k$ \u6b65\u53d8\u5316\u4e00\u6b21\uff0c\u4e00\u6b21\u53d8\u5316\u662f\u9664\u4ee5\u4e00\u4e2a\u4e0d\u4e3a $1$ \u7684 $a_j$\uff0c\u4e5f\u5c31\u662f\u81f3\u5c11\u7f29\u5c0f\u4e00\u534a\u3002\u56e0\u6b64\uff1a\n\n$$\\sum_{i=1}^n sz_i\\leq \\sum_{i=1}^n\\sum_{j=1}^ib_j\\frac{d_j}{d_i}=\\sum_{j=1}^nb_j\\sum_{i=j}^n\\frac{d_j}{d_i}\\leq \\sum_{j=1}^n b_j (\\frac {k}{2^0}+\\frac{k}{2^1}+\\frac{k}{2^2}+\\ldots)=2k\\sum_{j=1}^n b_j$$\n\n\u611f\u6027\u5730\u7406\u89e3\u4e3a\uff0c\u5c0f\u7684\u9762\u503c\u518d\u5f80\u540e $k\\log b_i$ \u6b65\u5c31\u65e0\u7528\u4e86\uff0c\u5e76\u4e14\u4f5c\u7528\u6b21\u6b21\u51cf\u534a\u3002\n\n\u6240\u4ee5\uff0c$\\sum sz_i$ \u7684\u8303\u56f4\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\n\n\u6211\u4eec\u7528\u524d\u7f00\u548c\u4f18\u5316\u591a\u91cd\u80cc\u5305\uff0c\u590d\u6742\u5ea6\u6b63\u597d\u662f $\\sum sz_i$\u3002\n\n\u5982\u4f55\u6c42\u51fa $m \\bmod d_i$\uff1f\u5b9e\u73b0\u4e00\u4e2a\u7ebf\u6027\u590d\u6742\u5ea6\u7684\u9ad8\u7cbe\u5ea6\u5c31\u597d\u3002\u5f53 $a_i=1$ \u7684\u65f6\u5019\u76f4\u63a5\u7ee7\u627f\uff0c\u8fd9\u6837\u7ecf\u8fc7\u81f3\u591a $\\log_2m$ \u6b21\uff0c$\\prod a_i> m$\uff0c\u6b64\u65f6\u9000\u51fa\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(\\log^2m+k\\sum b_i)$\u3002\n\n\u56e0\u4e3a\u9ad8\u7cbe\u5ea6\u672c\u6765\u5c31\u6bd4\u8f83\u607c\u4eba\u6240\u4ee5\u4ee3\u7801\u7528\u4e86\u5f88\u591a\u786c\u7f16\u7801\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int Maxn = 600005, p = 1e9 + 7;\nint n, b[Maxn], c[Maxn];\nlong long a[Maxn], f[Maxn], g[Maxn], sum[Maxn];\nstring str;\nstruct big\n{\n\tint pos, val[1205];\n\tbig()\n\t{\n\t\tmemset(val, 0, sizeof(val));\n\t\tval[0] = 1;\n\t}\n\tbig operator + (const big &x) const\n\t{\n\t\tbig result;\n\t\tresult.val[0] = 0;\n\t\tfor (int i = 0; i <= 1200; i++)\n\t\t{\n\t\t\tresult.val[i] += val[i] + x.val[i];\n\t\t\tif (result.val[i] >= 1000000000) result.val[i] -= 1000000000, result.val[i + 1]++;\n\t\t}\n\t\treturn result;\n\t}\n\tbig operator - (const big &x) const\n\t{\n\t\tbig result;\n\t\tresult.val[0] = 0;\n\t\tfor (int i = 0; i <= 1200; i++)\n\t\t{\n\t\t\tresult.val[i] += val[i] - x.val[i];\n\t\t\tif (result.val[i] < 0) result.val[i] += 1000000000, result.val[i + 1]--;\n\t\t}\n\t\treturn result;\n\t}\n\tbig operator * (long long x) const\n\t{\n\t\tbig result;\n\t\tresult.val[0] = 0;\n\t\tfor (int i = 0; i <= 1200; i++)\n\t\t{\n\t\t\tlong long tmp = val[i] * x;\n\t\t\tresult.val[i] += tmp % 1000000000, result.val[i + 1] += tmp / 1000000000;\n\t\t\tif (result.val[i] >= 1000000000) result.val[i] -= 1000000000, result.val[i + 1]++;\n\t\t}\n\t\treturn result;\n\t}\n\tbig operator / (long long x)\n\t{\n\t\tbig result;\n\t\tresult.val[0] = 0;\n\t\tresult.pos = pos;\n\t\tlong long tmp = 0;\n\t\tfor (int i = pos; i >= 0; i--)\n\t\t{\n\t\t\tresult.val[i] = (tmp + val[i]) / x;\n\t\t\ttmp = (tmp + val[i]) % x * 1000000000;\n\t\t\tif (!result.val[i] && i == result.pos) result.pos--;\n\t\t}\n\t\treturn result;\n\t}\n\tvoid get(string s)\n\t{\n\t\tint siz = s.size();\n\t\tval[0] = 0;\n\t\tfor (int i = 0; i < siz; i++)\n\t\t{\n\t\t\tfor (int j = 1200; j >= 0; j--)\n\t\t\t{\n\t\t\t\tlong long tmp = val[j] * 10LL;\n\t\t\t\tval[j] = tmp % 1000000000;\n\t\t\t\tval[j + 1] += tmp / 1000000000;\n\t\t\t}\n\t\t\tval[0] += s[i] - '0';\n\t\t\tfor (int j = 0; j <= 1200; j++)\n\t\t\t\tif (val[j] >= 1000000000)\n\t\t\t\t\tval[j] -= 1000000000, val[j + 1]++;\n\t\t}\n\t\tpos = 1200;\n\t}\n\tbool empty(void)\n\t{\n\t\tfor (int i = 0; i <= 1200; i++)\n\t\t\tif (val[i]) return false;\n\t\treturn true;\n\t}\n} m, D[10005];\nint main()\n{\n\tscanf(\"%d\", &n);\n\ta[1] = 1;\n\tfor (int i = 2; i <= n; i++)\n\t\tscanf(\"%lld\", &a[i]);\n\tfor (int i = 1; i <= n; i++)\n\t\tscanf(\"%d\", &b[i]);\n\tcin >> str;\n\tm.get(str);\n\tbig now = m;\n\tfor (int i = 2; i <= n; i++)\n\t{\n\t\tif (now.empty())\n\t\t{\n\t\t\tn = i - 1;\n\t\t\tbreak;\n\t\t}\n\t\tif (a[i] != 1)\n\t\t{\n\t\t\tbig tmp = now / a[i];\n\t\t\tc[i] = (now - tmp * a[i]).val[0];\n\t\t\tnow = tmp;\n\t\t}\n\t}\n\tint limit = 0;\n\tf[0] = 1;\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tmemcpy(g, f, sizeof(long long[limit + 1]));\n\t\tmemset(f, 0, sizeof(long long[limit + 1]));\n\t\tfor (int j = c[i]; j <= limit; j += a[i])\n\t\t\tf[j / a[i]] = g[j];\n\t\tlimit = limit / a[i] + b[i];\n\t\tfor (int j = 1; j <= limit + 1; j++)\n\t\t\tsum[j] = (sum[j - 1] + f[j - 1]) % p;\n\t\tfor (int j = 0; j <= limit; j++)\n\t\t\tf[j] = (sum[j + 1] - sum[max(0, j - b[i])] + p) % p;\n\t}\n\tfor (int i = 1; i <= 1200; i++)\n\t\tif (now.val[i])\n\t\t{\n\t\t\tputs(\"0\");\n\t\t\treturn 0;\n\t\t}\n\tif (now.val[0] > limit)\n\t{\n\t\tputs(\"0\");\n\t\treturn 0;\n\t}\n\tprintf(\"%lld\", f[now.val[0]]);\n\treturn 0;\n}\n```",
        "postTime": 1603424776,
        "uid": 49093,
        "name": "_sys",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF756E \u3010Byteland coins\u3011"
    }
]