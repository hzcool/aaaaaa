[
    {
        "content": "## \u9898\u610f\n\n\u6709 $n$ \u4e2a\u602a\uff0c\u7b2c $i$ \u4e2a\u602a\u6709 $h_i$ \u6ef4\u8840\u3002\u4f60\u53ef\u4ee5\u8fdb\u884c\u4e24\u79cd\u64cd\u4f5c:\u9009\u4e00\u4e2a\u602a\uff0c\u8ba9\u5bf9\u4ed6\u9020\u6210 $1$ \u70b9\u4f24\u5bb3\uff0c\u82b1\u8d39 $1$ MP\uff1b\u9009\u62e9\u4e00\u4e2a\u602a\uff0c\u5bf9\u4ed6\u65bd\u653e\u201c\u7206\u70b8\"\u3002\u7206\u70b8\u4f1a\u6839\u636e\u4f60\u82b1\u8d39\u7684 MP \u5bf9\u602a\u7269\u9020\u6210\u4f24\u5bb3\uff0c\u82b1\u8d39 $x$ MP \u7206\u70b8\u4f1a\u6839\u636e\u76ee\u6807\u7684\u751f\u547d\u503c\u9020\u6210\u4ee5\u4e0b\u6548\u679c\uff1a \n\n- \u5982\u679c\u76ee\u6807\u7684\u751f\u547d\u503c $h_i>x$\uff0c\u5219\u8ba9\u4ed6\u7684\u751f\u547d\u503c\u51cf\u5c11 $x$\n\n- \u5982\u679c\u76ee\u6807\u7684\u751f\u547d\u503c $h_i \\le x$\uff0c\u5219\u76ee\u6807\u6b7b\u4ea1\uff0c\u5e76\u5bf9 $i+1$ \u548c $i-1$ \u4f4d\u7f6e\u4e0a\u7684\u602a\u5206\u522b\u9020\u6210 $h_i - 1$ \u70b9\u7206\u70b8\u4f24\u5bb3\u3002\n\n- \u5982\u679c\u4f20\u9012\u51fa\u53bb\u7684\u7206\u70b8\u6740\u6b7b\u4e86\u53e6\u4e00\u4e2a\u602a\u7269\uff0c\u5219\u8fd9\u4e2a\u602a\u7269\u4f1a\u7ee7\u7eed\u5bf9\u5468\u56f4\u7684\u602a\u7269\u9020\u6210 $h_j-1$ \u7684\u7206\u70b8\u4f24\u5bb3\uff0c\u76f4\u5230\u7206\u70b8\u65e0\u6cd5\u4f20\u9012\u3002\n\n\u7206\u70b8\u53ea\u80fd\u4f7f\u7528\u4e00\u6b21\uff0c\u6c42\u6700\u5c11\u8981\u591a\u5c11 MP \u624d\u80fd\u6740\u6b7b\u6240\u6709\u602a\u3002\n\n## \u9898\u89e3\n\n\u663e\u7136\uff0c\u8981\u662f\u603b\u82b1\u8d39\u6700\u5c11\uff0c\u5c31\u8981\u8ba9\u4f20\u9012\u51fa\u53bb\u7684\u7206\u70b8\u9020\u6210\u7684\u603b\u4f24\u5bb3\u66f4\u9ad8\u3002\u540c\u65f6\uff0c\u5728\u6700\u540e\u4e00\u6b65\u4f7f\u7528\u7206\u70b8\u6765\u6740\u6b7b\u6240\u6709\u5269\u4e0b\u7684\u654c\u4eba\u4e5f\u4e00\u5b9a\u662f\u6700\u4f18\u7684\u3002\n\n\u73b0\u5728\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u6574\u6570\u5e8f\u5217\uff0c\u9700\u8981\u901a\u8fc7\u5bf9\u6bcf\u4e2a\u6570\u51cf\u4e00\u6765\u4f7f\u5176\u4e25\u683c\u5355\u5cf0\uff0c\u6c42\u51cf\u4e00\u64cd\u4f5c\u7684\u6b21\u6570\u4e0e\u5355\u5cf0\u7684\u5e8f\u5217\u4e2d\u7684\u6700\u5927\u503c\u7684\u548c\u7684\u6700\u5c0f\u503c\u3002\n\n- \u8bbe $dp_i$ \u8868\u793a\u7ecf\u8fc7\u82e5\u5e72\u6b21\u64cd\u4f5c\u540e\u4ee5 $i$ \u7ed3\u5c3e\u7684\u5b57\u4e32\u80fd\u6784\u6210\u7684\u4e25\u683c\u9012\u589e\u5b57\u4e32\u7684\u548c\u7684\u6700\u5927\u503c\n\n- \u5c1d\u8bd5\u4ece\u5de6\u4fa7\u8f6c\u79fb\uff0c\u4ece $i$ \u5f00\u59cb\u679a\u4e3e\u6240\u6709 $j<i$ \n\n- \u5982\u679c $h_{i-j} \\ge h_i-j$\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7 $h_{i-j}-h_i+j$ \u6b21\u64cd\u4f5c\u5c06\u5176\u8f6c\u6362\u4e3a $h_i-j$\uff0c$j$ \u5904\u5bf9 $dp_i$ \u7684\u8d21\u732e\u4e3a $h_i-j$\n\n- \u5982\u679c $h_{i-j}<h_i-j$\uff0c\u5219\u4e0d\u7528\u4fee\u6539 $j$ \u5904\uff0c\u90a3\u4e48 $j$ \u5904\u53ca $j$ \u5904\u4ee5\u524d\u5bf9 $dp_i$ \u7684\u8d21\u732e\u5df2\u7ecf\u5728 $j$ \u5904\u7b97\u51fa\uff0c\u4e3a $dp_j$\n\n\u73b0\u5728\u8fd9\u4e2a\u7b97\u6cd5\u662f $O(n^2)$ \u7684\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u8f6c\u79fb\u65f6\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u627e\u5230\u7b2c\u4e00\u4e2a $h_{i-j}<h_i-j$\uff0c\u4e24\u8fb9\u540c\u65f6\u51cf $i$ \u5f97\u5230 $h_{i-j}-i<h_i-i-j$\uff0c\u5373 $h_{i-j}-(i-j)<h_i-i$\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u6808\uff08\u6808\u5e95\u5230\u6808\u9876\u5355\u8c03\u9012\u589e\uff09\u7ef4\u62a4 $h_i-i$ \u7684\u503c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u5982\u679c\u6808\u9876\u5143\u7d20\u5927\u4e8e\u7b49\u4e8e $h_i-i$\uff0c\u5c31\u76f4\u63a5\u5f39\u51fa\uff0c\u56e0\u4e3a\u5b83\u76f8\u6bd4\u5f53\u524d\u5143\u7d20\u5177\u6709\u66f4\u5927\u7684\u503c\u548c\u66f4\u5c0f\u7684\u4e0b\u6807\uff0c\u4e0d\u53ef\u80fd\u4f5c\u4e3a\u4e4b\u540e\u67e5\u8be2\u7684\u7b54\u6848\u3002\n\n\u5982\u679c\u6808\u9876\u5143\u7d20\u5c0f\u4e8e $h_i-i$\uff0c\u90a3\u5b83\u5bf9\u5e94\u7684\u4f4d\u7f6e\u5c31\u662f\u6211\u4eec\u8981\u627e\u7684 $j$\uff0c\u4ece $j$ \u8f6c\u79fb\u3002\n\n\u5982\u679c\u6808\u7a7a\uff0c\u90a3\u5c31\u8bf4\u660e\u4ece $1$ \u5230 $i$ \u6574\u4e2a\u524d\u7f00\u53ef\u4ee5\u88ab\u4fee\u6539\u6210\u4e25\u683c\u9012\u589e\uff0c\u7b49\u5dee\u6570\u5217\u6c42\u548c\u5373\u53ef\u3002\n\n\u518d\u7528\u540c\u6837\u7684\u65b9\u6cd5\u4ece\u53f3\u5f80\u5de6\u7edf\u8ba1\u6240\u6709\u4ee5 $i$ \u5f00\u5934\u7684\u4e25\u683c\u9012\u51cf\u5b50\u4e32\u7684\u548c\u7684\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n)$\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>\nvoid read(T &res) {\n\tres=0;bool f=false;char ch=getchar();\n\twhile(ch<'0'||ch>'9') {if(ch=='-') f=true; ch=getchar();}\n\twhile(ch>='0'&&ch<='9') res=(res<<3)+(res<<1)+(ch^48),ch=getchar();\n\tres=f?-res:res;\n}\ntemplate<typename T,typename ...Args>\nvoid read(T &res,Args &...args) {read(res); read(args...);}\ntemplate<typename T>\nvoid write(T x) {if(x<0) putchar('-'),x=-x; if(x>9) write(x/10); putchar(x%10+'0');}\ntemplate<typename T>\ninline void writeln(T x) {write(x);putchar('\\n');}\ntemplate<typename T,typename ...Args>\nvoid write(T x,Args ...args) {write(x); putchar(' '); write(args...);}\ntemplate<typename T,typename ...Args>\nvoid writeln(T x,Args ...args) {writeln(x); writeln(args...);}\n#define MAXN 300011\nint n,top;\nlong long lh[MAXN],rh[MAXN],h[MAXN],stk[MAXN],pos[MAXN];\ninline void solve() {\n\tlong long sum=0;\n\tread(n);\n\tfor(int i=1;i<=n;i++) read(h[i]);\n\tlh[0]=rh[n+1]=0;\n\ttop=0;\n\tfor(int i=1;i<=n;i++) {\n\t\twhile(top&&stk[top]>=h[i]-i) --top;\n\t\tint p=0;\n\t\tlong long len=1;\n\t\tif(!top) len=i;\n\t\telse len=i-pos[top],p=pos[top];\n\t\tstk[++top]=h[i]-i;\n\t\tpos[top]=i;\n\t\tif(len<=h[i]) lh[i]=lh[p]+h[i]*len-len*(len-1)/2;\n\t\telse lh[i]=h[i]*h[i]-h[i]*(h[i]-1)/2;\n\t}\n\ttop=0;\n\tfor(int i=n;i>=1;i--) {\n\t\tint r=n-i+1;\n\t\twhile(top&&stk[top]>=h[i]-r) --top;\n\t\tint p=n+1;\n\t\tlong long len=1;\n\t\tif(!top) len=r;\n\t\telse len=pos[top]-i,p=pos[top];\n\t\tstk[++top]=h[i]-r;\n\t\tpos[top]=i;\n\t\tif(len<=h[i]) rh[i]=rh[p]+h[i]*len-len*(len-1)/2;\n\t\telse rh[i]=h[i]*h[i]-h[i]*(h[i]-1)/2;\n\t}\n\tfor(int i=1;i<=n;i++) sum+=h[i];\n\tlong long ans=0x7fffffffffffffff;\n\tfor(int i=1;i<=n;i++) {\n\t\tlong long cur=lh[i]+rh[i]-h[i]*2;\n\t\tans=min(ans,sum-cur);\n\t}\n\twriteln(ans);\n}\nint main() {\n\tint T=0;\n\tread(T);\n\twhile(T--) solve();\n\treturn 0;\n}\n```",
        "postTime": 1677140337,
        "uid": 180576,
        "name": "Transparent",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1795E \u3010Explosions?\u3011"
    },
    {
        "content": "### [CF1795E Explosions? ](https://www.luogu.com.cn/problem/CF1795E)\n\n\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u7206\u70b8\uff0c\u7136\u540e\u518d\u666e\u653b\u3002\u90a3\u4e48\u5c31\u662f\u627e\u5230\u7701\u53bb\u666e\u653b\u6700\u591a\u7684\u7206\u70b8\u662f\u5728\u54ea\u4e2a\u4f4d\u7f6e\u3002\u5148\u8003\u8651\u7206\u70b8\u70b9\u5bf9\u5de6\u8fb9\u7684\u5f71\u54cd\u3002\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $i$\uff0c\u6211\u4eec\u679a\u4e3e\u6240\u6709 $j < i$\u3002\u5982\u679c $h_{i-j} \\geq h_i-j$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u666e\u653b\u628a\u5b83\u6539\u5230 $h_i-j$\u3002\u5982\u679c $h_{i-j} < h_i-j$\uff0c\u90a3\u4e48\u5f53\u524d\u8fd9\u4e2a\u4f4d\u7f6e\u4e0d\u7528\u4fee\u6539\uff0c\u81f3\u4e8e\u8fd9\u4e2a\u70b9\u5de6\u8fb9\u5bf9\u7206\u70b8\u7684\u8d21\u732e\u4e4b\u524d\u5df2\u7ecf\u8ba1\u7b97\u8fc7\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u662f\u8981\u627e\u5230\u4e00\u4e2a\u6700\u5c0f\u7684 $j$\uff0c\u6ee1\u8db3 $h_{i-j} < h_i-j$\u3002\u4e24\u8fb9\u540c\u65f6\u51cf\u53bb\u4e00\u4e2a $i$\uff0c\u5f97 $h_{i-j}-(i-j)<h_i-i$\u3002\u8fd9\u53ef\u4ee5\u7528\u5355\u8c03\u6808\u4f18\u5316\u3002\n\n\u505a\u5b8c\u4e00\u904d\u540e\u628a\u6570\u7ec4\u7ffb\u8fc7\u6765\u518d\u505a\u4e00\u904d\u5c31\u53ef\u4ee5\u4e86\u3002\n\ncode\n```\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int N=300010;\nint T,n;\nint h[N],a[N];\nint dp[N][2];\nstack<int> stk;\ninline void stkclear()\n{\n    while (stk.size()) stk.pop();\n}\nsigned main()\n{\n#ifndef ONLINE_JUDGE\n    freopen(\"zsr.in\",\"r\",stdin);\n    freopen(\"zsr.out\",\"w\",stdout);\n#endif\n    scanf(\"%lld\",&T);\n    while (T--)\n    {\n        memset(dp,0,sizeof dp);\n        stkclear();\n        scanf(\"%lld\",&n);\n        int sum=0;\n        for (int i=1;i<=n;++i) \n        {\n            scanf(\"%lld\",&h[i]);\n            a[i]=h[i]-i;\n            sum+=h[i];\n        }\n        for (int i=1;i<=n;++i)\n        {\n            while (stk.size()&&a[stk.top()]>=a[i]) stk.pop();\n            if (!stk.size()) dp[i][0]=(h[i]+max(1ll,h[i]-i+1))*(h[i]-max(1ll,h[i]-i+1)+1)/2;\n            else dp[i][0]=dp[stk.top()][0]+(h[i]+h[i]-(i-stk.top()-1))*(i-stk.top())/2;\n            stk.push(i);\n        }\n        stkclear();\n        reverse(h+1,h+n+1);\n        for (int i=1;i<=n;++i) a[i]=h[i]-i;\n        for (int i=1;i<=n;++i)\n        {\n            while (stk.size()&&a[stk.top()]>=a[i]) stk.pop();\n            if (!stk.size()) dp[i][1]=(h[i]+max(1ll,h[i]-i+1))*(h[i]-max(1ll,h[i]-i+1)+1)/2;\n            else dp[i][1]=dp[stk.top()][1]+(h[i]+h[i]-(i-stk.top()-1))*(i-stk.top())/2;\n            stk.push(i);\n        }\n        int res=0;\n        for (int i=1;i<=n;++i) res=max(res,dp[n-i+1][0]+dp[i][1]-h[i]*2);\n        printf(\"%lld\\n\",sum-res);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1683899014,
        "uid": 767793,
        "name": "_ZSR_",
        "ccfLevel": 0,
        "title": "CF1795E Explosions?"
    },
    {
        "content": "\u8003\u8651\u6c42\u51fa\u4e24\u6570\u7ec4 $f_{i,j}$ \u548c $g_{i,j}$ \u8868\u793a\u82e5\u4ee5 $i$ \u4e3a\u7206\u70b8\u70b9\uff0c\u5f53\u524d\u751f\u547d\u4e3a $j$ \u5de6\u4fa7/\u53f3\u4fa7\u6700\u591a\u53ef\u4ee5**\u989d\u5916**\u9020\u6210\u591a\u5c11\u4f24\u5bb3\uff08\u4e0d\u5305\u62ec\u672c\u8eab\uff0c\u56e0\u4e3a\u672c\u8eab\u7684\u4f24\u5bb3\u662f\u9700\u8981\u4ed8\u51fa\u4ee3\u4ef7\u7684\uff09\u3002\n\n\u5982\u679c\u80fd\u6c42\u51fa\uff0c\u7b54\u6848\u5c31\u5f88\u663e\u7136\u4e86\uff0c\u6211\u4eec\u73b0\u5728\u8003\u8651\u600e\u4e48\u6c42\u3002\n\n\u7a0d\u5fae\u60f3\u4e00\u4e0b\u5c31\u53ef\u4ee5\u5f97\u51fa DP \u65b9\u7a0b\uff08$g$ \u540c\u7406\uff09\uff1a\n\n$$\nf_{i,j} =\n\\left \\{ \\begin{matrix} \n\nf_{i-1,h_{i-1}}+h_{i-1} \\qquad j>h_{i-1}\n\\\\\nf_{i-1,j-1}+j-1 \\qquad j \\le h_{i-1}\n\n\\end {matrix} \\right.\n$$\n\n\u65f6\u7a7a\u90fd\u662f $O(nV)$ \u7684\uff08$V$ \u4e3a\u503c\u57df\uff09\uff0c\u8c8c\u4f3c\u5f88\u96be\u4f18\u5316\u3002\n\n\u4f46\u89c2\u5bdf\u53d1\u73b0\uff0c$f_{i}$ \u7684\u540e\u82e5\u5e72\u9879\u76f8\u540c\uff0c\u524d\u82e5\u5e72\u9879\u4e3a $f_{i-1}$ **\u5e73\u79fb\u4e00\u4f4d**\u540e\u52a0\u4e0a\u4e00\u4e2a**\u516c\u5dee\u4e3a $1$ \u7684\u7b49\u5dee\u6570\u5217**\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5dee\u5206\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u8be5\u7ebf\u6bb5\u6811\u9700\u8981\u652f\u6301\uff1a\u533a\u95f4\u52a0\uff0c\u533a\u95f4\u8d4b\u503c\uff0c\u533a\u95f4\u6c42\u548c\u3002\n\n- \u5982\u4f55\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217\uff1f\n\n\u5728\u5dee\u5206\u6570\u7ec4\u4e0a\u7b49\u5dee\u6570\u5217\u4e3a\u4e00\u6bb5\u8fde\u7eed\u4e14\u76f8\u7b49\u7684\u533a\u95f4\uff0c\u533a\u95f4\u52a0\u6cd5\u53ef\u4ee5\u76f4\u63a5\u5b9e\u73b0\u3002\n\n- \u5982\u4f55\u5b9e\u73b0\u5e73\u79fb\uff1f\n\n\u5c06\u7ebf\u6bb5\u6811\u5f00\u4e24\u500d\uff0c\u4ece\u4e2d\u95f4\u5f00\u59cb\uff0c\u6bcf\u6b21\u5411\u53f3\u5e73\u79fb\u4e00\u4f4d\u76f8\u5f53\u4e8e\u628a\u8fb9\u754c\u5411\u5de6\u79fb\u4e00\u4f4d\u3002\n\n\u6ca1\u8bf4\u6e05\u695a\u7684\u770b\u4ee3\u7801\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\u6bd4\u8f83\u611a\u8822\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define N 600010\n#define M 1300010\n#define LL long long\n#define ULL unsigned long long\n#define DB double\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define per(i,a,b) for(int i=a;i>=b;i--)\n#define INF 0x3f3f3f3f3f3f3f3f\n#define mod 998244353\n#define pir pair<int,int>\n#define mp(i,j) make_pair(i,j)\n#define fi first\n#define se second\nusing namespace std;\ntemplate <typename T> inline void read(T &a)\n{\n\ta=0;T w=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){a=(a<<3)+(a<<1)+(ch^48);ch=getchar();}\n\ta*=w;\n}\ntemplate <typename T,typename ...Args> inline\nvoid read(T &x,Args &...args){read(x);read(args...);}\nint T,n,L;\nLL h[N],f[N],g[N],sum,ans;\nstruct DELTA_SGT//\u9664\u4e86\u540d\u5b57\u5916\u6ca1\u4ec0\u4e48\u7279\u522b\u7684\u7ebf\u6bb5\u6811 \n{\n\t#define lc rt<<1\n\t#define rc rt<<1|1\n\t#define mid ((l+r)>>1)\n\tLL sum[M<<2],add[M<<2],ass[M<<2];\n\tint len[M<<2];\n\tinline void pushup(int rt){sum[rt]=sum[lc]+sum[rc];}\n\tinline void pushdown(int rt)\n\t{\n\t\tif(~ass[rt])\n\t\t{\n\t\t\tsum[lc]=ass[rt]*len[lc];\n\t\t\tsum[rc]=ass[rt]*len[rc];\n\t\t\tadd[lc]=add[rc]=0;\n\t\t\tass[lc]=ass[rc]=ass[rt];\n\t\t\tass[rt]=-1;\n\t\t}\n\t\tif(add[rt])\n\t\t{\n\t\t\tsum[lc]+=add[rt]*len[lc];\n\t\t\tsum[rc]+=add[rt]*len[rc];\n\t\t\t~ass[lc] ? ass[lc]+=add[rt] : add[lc]+=add[rt];\n\t\t\t~ass[rc] ? ass[rc]+=add[rt] : add[rc]+=add[rt];\n\t\t\tadd[rt]=0;\n\t\t}\n\t}\n\tinline void build(int rt,int l,int r)\n\t{\n\t\tlen[rt]=r-l+1;sum[rt]=add[rt]=0;ass[rt]=-1;\n\t\tif(l==r) return;\n\t\tbuild(lc,l,mid);build(rc,mid+1,r);\n\t}\n\tinline void update(int rt,int l,int r,int L,int R,LL v)\n\t{\n\t\tif(L<=l&&r<=R){sum[rt]+=v*len[rt];~ass[rt]?ass[rt]+=v:add[rt]+=v;return;}\n\t\tpushdown(rt);\n\t\tif(L<=mid) update(lc,l,mid,L,R,v);\n\t\tif(mid<R) update(rc,mid+1,r,L,R,v);\n\t\tpushup(rt);\n\t}\n\tinline LL query(int rt,int l,int r,int L,int R)\n\t{\n\t\tif(L<=l&&r<=R) return sum[rt];\n\t\tpushdown(rt);LL res=0;\n\t\tif(L<=mid) res+=query(lc,l,mid,L,R);\n\t\tif(mid<R) res+=query(rc,mid+1,r,L,R);\n\t\treturn res;\n\t}\n\tinline void assign(int rt,int l,int r,int L,int R,LL v)\n\t{\n\t\tif(L<=l&&r<=R){sum[rt]=v*len[rt];ass[rt]=v;add[rt]=0;return;}\n\t\tpushdown(rt);\n\t\tif(L<=mid) assign(lc,l,mid,L,R,v);\n\t\tif(mid<R) assign(rc,mid+1,r,L,R,v);\n\t\tpushup(rt);\n\t}\n\tinline void clear(){sum[1]=add[1]=ass[1]=0;}\n\tinline void pr(){rep(i,L,M) printf(\"%lld \",query(1,1,M,1,i));printf(\"\\n\");}\n\t#undef lc\n\t#undef rc\n\t#undef mid\n}t;\nsigned main()\n{\n\tread(T);t.build(1,1,M);\n\trep(tt,1,T)\n\t{\n\t\tread(n);h[n+1]=sum=0;ans=INF;\n\t\trep(i,1,n) read(h[i]),sum+=h[i];\n\t\tt.clear();L=n+1;//L \u5de6\u8fb9\u754c \u4ece\u4e2d\u95f4\u5f00\u59cb \n\t\trep(i,1,n)\n\t\t{\n\t\t\tL--;//\u5411\u53f3\u5e73\u79fb\u4e00\u4f4d\uff0c\u76f8\u5f53\u4e8e\u8fb9\u754c\u5de6\u79fb \n\t\t\t//\u5b9e\u9645\u4e0a\u7684\u7b2ci\u4f4d\u4e3a\u7ebf\u6bb5\u6811\u4e0aL+i \n\t\t\tt.update(1,1,M,L+2,L+h[i-1]+1,1);//\u7b49\u5dee\u6570\u5217 \n\t\t\tt.assign(1,1,M,L+h[i-1]+2,M,0);//\u540e\u90e8\u76f8\u7b49 \n\t\t\tf[i]=t.query(1,1,M,1,L+h[i]);\n\t\t}\n\t\tt.clear();L=n+1;\n\t\tper(i,n,1)\n\t\t{\n\t\t\tL--;\n\t\t\tt.update(1,1,M,L+2,L+h[i+1]+1,1);\n\t\t\tt.assign(1,1,M,L+h[i+1]+2,M,0);\n\t\t\tg[i]=t.query(1,1,M,1,L+h[i]);\n\t\t}\n\t\trep(i,1,n) ans=min(ans,sum-f[i]-g[i]);\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n}\n```",
        "postTime": 1677900318,
        "uid": 251324,
        "name": "stntn",
        "ccfLevel": 0,
        "title": "CF1795E \u53e6\u7c7b\u505a\u6cd5"
    },
    {
        "content": "\u9898\u76ee\u62bd\u8c61\u4e3a\u73b0\u6709\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u7ec4 $a_1,a_2,\\cdots,a_n$ $(1\\le a_i\\le 10^{6})$\u3002\n\n\u5b9a\u4e49\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u533a\u95f4 $[l,r]$ $(1\\le l,r\\le n)$ \u4e3a\u7206\u70b8\u533a\u95f4\uff1a  \n$\\exists i\\in [l,r]$ \u4f7f\u5f97 $a$ \u5728 $[l,i]$ \u4e25\u683c\u5355\u8c03\u9012\u589e\uff0c$a$ \u5728 $[i,r]$ \u4e25\u683c\u5355\u8c03\u9012\u51cf\u3002\n\n\u8bbe\u5b9a $[l,r]$ \u4e3a\u7206\u70b8\u533a\u95f4\uff0c$i$ \u6ee1\u8db3  $a_i=\\max\\limits_{j=l}^{r}a_j$ \u4e3a\u7206\u70b8\u70b9\u3002  \n\n\u6bcf\u6b21\u64cd\u4f5c\u53ef\u4ee5\u9009\u4e00\u4e2a $a_i$ $(a_i> 0)$ \u51cf $1$\uff0c\u4ee3\u4ef7\u4e3a $1$\uff0c\u5728\u4efb\u610f\u6b21\u64cd\u4f5c\u540e\u6ee1\u8db3 $a_i=0$ $(i\\notin [l,r])$\uff0c\u5e76\u4e14 $[l,r]$ \u4e3a\u7206\u70b8\u533a\u95f4\uff0c\u90a3\u4e48\u53ef\u4ee5\u82b1\u8d39\u4ee3\u4ef7 $\\max\\limits_{i=l}^{r}a_i$ \u5c06\u8be5\u533a\u95f4\u7684\u6240\u6709\u6570\u51cf\u4e3a $0$\uff0c\u6c42\u5c06\u8be5\u6570\u7ec4\u5168\u90e8\u6e05\u96f6\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u90a3\u4e48\u6211\u4eec\u679a\u4e3e $i$ \u4f5c\u4e3a\u7206\u70b8\u70b9\uff0c\u8bb0 $[p,q]$ \u4e3a\u4ee5 $i$ \u4f5c\u4e3a\u7206\u70b8\u70b9\u80fd\u9020\u6210\u7684\u6700\u5927\u7684\u7206\u70b8\u533a\u95f4\uff0c\u6c42\u51fa\u6700\u5927\u7684 $(\\sum\\limits_{j=p}^{q}a_j)-a_i$\uff0c\u8bb0\u4e3a $x$\uff0c\u90a3\u4e48 $(\\sum\\limits_{j=1}^{n}a_j)-x$ \u5c31\u662f\u7b54\u6848\u3002\n\n\u9009\u62e9\u4e00\u4e2a\u6570\u4f5c\u4e3a\u7206\u70b8\u70b9\u90a3\u4e48\u8fd9\u4e2a\u6570\u80af\u5b9a\u4e0d\u6267\u884c\u51cf $1$ \u64cd\u4f5c\uff0c\u5c06 $a$ \u8dd1\u4e24\u6b21\u5355\u8c03\u6808\uff0c\u662f\u4e00\u4e2a\u4e0d\u4e25\u683c\u5355\u8c03\u9012\u589e\u6808\uff08\u5355\u8c03\u4e0d\u9012\u51cf\u6808\uff09\uff0c\u5148\u6b63\u7740\u8dd1\uff0c\u8fd9\u6837\u53ef\u4ee5\u8dd1\u51fa $i$ \u53ea\u5411\u5de6\u7206\u70b8\u6700\u591a\u80fd\u9020\u6210\u591a\u5c11\u4f24\u5bb3\uff0c\u7ffb\u8f6c $a$ \u518d\u8dd1\u4e00\u6b21\uff0c\u8fd9\u6837\u53ef\u4ee5\u8dd1\u51fa $i$ \u53ea\u5411\u53f3\u7206\u70b8\u6700\u591a\u80fd\u9020\u6210\u591a\u5c11\u4f24\u5bb3\u3002\n\nC++ Code\n\n```cpp\n#include <bits/stdc++.h>\n\nusing i64 = long long;\n\nvoid solve() {\n    int n;\n    std::cin >> n;\n\n    std::vector<int> a(n);\n    for (int i = 0; i < n; i++) {\n        std::cin >> a[i];\n    }\n\n    auto work = [&](auto &a) {\n        auto b = a;\n        for (int i = 0; i < n; i++) {\n            b[i] -= i;\n        }\n\n        std::vector<i64> res(n);\n        std::vector<int> st;\n\n        for (int i = 0; i < n; i++) {\n            while (!st.empty() && b[st.back()] > b[i]) {\n                st.pop_back();\n            }\n            if (!st.empty() && a[i] - (i - st.back()) >= 0) {\n                int d = i - st.back();\n                res[i] = res[st.back()] + 1LL * d * (a[i] + a[i] - d + 1) / 2;\n            } else {\n                int d = std::min(i + 1, a[i] + 1);\n                res[i] = 1LL * d * (a[i] + a[i] - d + 1) / 2;\n            }\n            st.push_back(i);\n        }\n\n        return res;\n    };\n\n    auto l = work(a);\n    reverse(a.begin(), a.end());\n    auto r = work(a);\n    reverse(r.begin(), r.end());\n    reverse(a.begin(), a.end());\n    \n    i64 ans = 0;\n    for (int i = 0; i < n; i++) {\n        ans = std::max(ans, l[i] + r[i] - 2 * a[i]);\n    }\n    \n    i64 sum = std::accumulate(a.begin(), a.end(), 0LL);\n    std::cout << sum - ans << '\\n';\n}\n\nint main() {\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n\n    int t = 1;\n    std::cin >> t;\n    \n    while (t--) {\n        solve();\n    }\n    \n    return 0;\n}\n```\n\n\n",
        "postTime": 1677817105,
        "uid": 584838,
        "name": "Kidding_Ma",
        "ccfLevel": 0,
        "title": "CF1795E Explosions?"
    },
    {
        "content": "\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u7ed3\u8bba\uff1a\u6211\u4eec\u9700\u8981\u5148\u5c06\u8fd9\u4e2a\u5e8f\u5217\u53d8\u6210\u4e00\u4e2a\u4e25\u683c\u7684\u5355\u5cf0\u5e8f\u5217\uff08\u5176\u4ed6\u4f4d\u4e3a $0$\uff09\uff0c\u7136\u540e\u4e00\u6ce2\u89e3\u51b3\u6389\u5269\u4e0b\u7684\u602a\u7269\u3002\n\n\u5355\u5cf0\u53ef\u4ee5\u8f6c\u5316\u4e3a\u4e0a\u5347\u533a\u95f4\u548c\u4e0b\u964d\u533a\u95f4\u3002\u5148\u6765\u770b\u4e0a\u5347\u533a\u95f4\u600e\u4e48\u6c42\uff1a\n\n\u6211\u4eec\u4ee4 $l_i$ \u8868\u793a\uff1a\u5c06\u533a\u95f4 $[1,i]$ \u5728\u4e0d\u524a\u51cf $a_i$ \u7684\u60c5\u51b5\u4e0b\u53d8\u6210\u4e0a\u5347\u533a\u95f4\u7684\u6700\u5c0f\u6d88\u8017\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8d2a\u5fc3\u6c42 $l_i$\uff1a\u679a\u4e3e $j$ \u4ece $i-1$ \u5230 $1$\uff0c$a_j=\\min(a_j,a_{j+1}-1)$\u3002\u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u6211\u4eec\u4ece $i$ \u5f80\u524d\u6539\uff0c\u6bcf\u6b21 $-1$\uff0c\u5982\u679c\u672c\u6765\u7684\u503c\u66f4\u5c0f\u90a3\u5c31\u4e0d\u66f4\u6539\u3002\n\n\u90a3\u4e48\u6211\u4eec\u6c42\u51fa $i$ \u524d\u9762\u6700\u9760\u540e\u7684\u4e0d\u9700\u8981\u66f4\u6539\u7684 $a_j$\uff0c\u4e00\u5b9a\u6ee1\u8db3 $(k\\in[j+1,i-1],a_k> a_{k+1}-1)$\u3002\u8fd9\u6837 $j$ \u524d\u9762\u7684\u66f4\u6539\u9700\u8981 $l_j$\uff0c\u800c\u8ba1\u7b97 $j$ \u548c $i$ \u4e4b\u95f4\u7684\u66f4\u6539\u6d88\u8017\u6211\u4eec\u53ef\u4ee5\u7528\uff08\u524d\u7f00\u548c \u7b97\u51fa\u7684 \u533a\u95f4\u548c\uff09\u51cf\u53bb\uff08\u7528\u7b49\u5dee\u6570\u5217\u8ba1\u7b97\u516c\u5f0f \u7b97\u51fa\u7684 \u66f4\u6539\u540e\u7684\u533a\u95f4\u548c\uff09\u4fbf\u662f\u7ed3\u679c\u3002\n\n\u6c42 $i$ \u524d\u9762\u6700\u9760\u540e\u7684\u4e0d\u9700\u8981\u66f4\u6539\u7684 $a_j$\uff0c\u6ee1\u8db3 $a_j\\leq a_i-(i-j)$\uff0c\u5373 $a_j-j\\leq a_i-i$\u3002\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u5c31\u4ee5 $a_i-i$ \u4f5c\u4e3a\u4e0b\u6807\uff0c$i$ \u4f5c\u4e3a\u6743\u503c\uff0c\u5efa\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u5b9e\u73b0\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u4e0b\u964d\u533a\u95f4\u6765\u8bf4\uff0c\u5012\u7740\u505a\u4e00\u904d\uff0c\u6c42\u51fa $r_i$ \u5373\u53ef\u3002\n\n\u7136\u540e\u679a\u4e3e\u4ee5\u6bcf\u4e2a $i$ \u4f5c\u4e3a\u5cf0\u503c\uff0c\u5176\u6d88\u8017\u4e3a $l_i+r_i+a_i$\u3002\u53d6\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int inf=0x3f3f3f3f3f3f3f3f;\nconst int W=1e6;\nint n,m;\nint a[300010],b[300010];\nstruct sgt\n{\n\tstruct node\n\t{\n\t\tint ls,rs;\n\t\tint mx;\n\t}t[10000010];\n\tint tot=0;\n\tvoid push_up(int p)\n\t{\n\t\tt[p].mx=max(t[t[p].ls].mx,t[t[p].rs].mx);\n\t}\n\tint add()\n\t{\n\t\tt[++tot]=node{0,0,0};\n\t\treturn tot;\n\t}\n\tvoid update(int p,int l,int r,int x,int val)\n\t{\n\t\tif(l==r)\n\t\t{\n\t\t\tt[p].mx=max(t[p].mx,val);\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tif(x<=mid)\n\t\t{\n\t\t\tif(!t[p].ls) t[p].ls=add();\n\t\t\tupdate(t[p].ls,l,mid,x,val);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(!t[p].rs) t[p].rs=add();\n\t\t\tupdate(t[p].rs,mid+1,r,x,val);\n\t\t}\n\t\tpush_up(p);\n\t}\n\tint query(int p,int l,int r,int x,int y)\n\t{\n\t\tif(x>y) return 0;\n\t\tif(x<=l&&r<=y) return t[p].mx;\n\t\tint mid=(l+r)>>1;\n\t\tint maxn=0;\n\t\tif(x<=mid) maxn=max(maxn,query(t[p].ls,l,mid,x,y));\n\t\tif(mid<y) maxn=max(maxn,query(t[p].rs,mid+1,r,x,y));\n\t\treturn maxn;\n\t}\n}t;\nint calc(int y,int k)\n{\n\tint x=y-k+1;\n\treturn (x+y)*k/2;\n}\nint s[300010];\nint l[300010],r[300010];\nvoid solve()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<=n;i++) b[i]=a[n-i+1];\n\tt.tot=0; t.add();\n\ts[0]=0; for(int i=1;i<=n;i++) s[i]=s[i-1]+a[i];\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint x=t.query(1,-W,W,-W,a[i]-i);\n\t\tif(x) l[i]=l[x]+(s[i]-s[x]-calc(a[i],i-x));\n\t\telse l[i]=s[i]-calc(a[i],min(a[i],i));\n\t\tt.update(1,-W,W,a[i]-i,i);\n\t}\n\tt.tot=0; t.add();\n\ts[0]=0; for(int i=1;i<=n;i++) s[i]=s[i-1]+b[i];\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint x=t.query(1,-W,W,-W,b[i]-i);\n\t\tif(x) r[i]=r[x]+(s[i]-s[x]-calc(b[i],i-x));\n\t\telse r[i]=s[i]-calc(b[i],min(b[i],i));\n\t\tt.update(1,-W,W,b[i]-i,i);\n\t}\n\tint ans=inf;\n\tfor(int i=1;i<=n;i++) ans=min(ans,a[i]+l[i]+r[n-i+1]);\n\tprintf(\"%lld\\n\",ans);\n}\nsigned main()\n{\n\tint T;\n\tscanf(\"%lld\",&T);\n\twhile(T--) solve();\n\treturn 0;\n}\n```\n",
        "postTime": 1676684993,
        "uid": 444135,
        "name": "thostever",
        "ccfLevel": 7,
        "title": "CF1795E\u9898\u89e3"
    },
    {
        "content": "[\u5728\u535a\u5ba2\u98df\u7528\u66f4\u4f73](https://www.luogu.com.cn/blog/DUCKPEAR/solution-cf1795e)\n\n\u573a\u5207\u7684 $2200$\uff0c\u611f\u89c9\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\n\n## \u89e3\u9898\u601d\u8def\uff1a\n\n\u9996\u5148\uff0c\u6211\u4eec\u8f6c\u5316\u4e00\u4e0b\uff0c\u8f6c\u5316\u6210\u6211\u4eec\u9700\u8981\u4f7f Explosions \u6253\u51fa\u6700\u5927\u7684\u4f24\u5bb3\u3002\n\n\u7136\u540e\uff0c\u8003\u8651\u8d2a\u5fc3\uff0c\u5982\u679c\u6253\u7b97\u5bf9 $i$ \u65bd\u653e Explosions\uff0c\u5219\u7528\u5355\u53d1\u70b9 $i$ \u5fc5\u7136\u4e0d\u4f18\u3002\u56e0\u4e3a Explosions \u548c\u5355\u53d1\u7b97\u8d21\u732e\u7684\u65b9\u5f0f\u662f\u4e00\u6837\u7684\uff0c\u800c\u4e14 $h_i$ \u8d8a\u5927\uff0c\u8d8a\u53ef\u80fd\u5411\u5de6\u53f3\u4f20\u9012\u4f24\u5bb3\u3002\n\n\u8fd8\u6709\u4e00\u6b65\u8d2a\u5fc3\uff0c\u5fc5\u7136\u4f7f\u5f97 Explosions \u6253\u6700\u591a\u7684\u602a\uff0c\u6b63\u786e\u6027\u663e\u7136\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u5982\u679c\u8981\u5728 $i$ \u65bd\u653e Explosions\uff0c\u76f8\u5f53\u4e8e\u6267\u884c\u4ee5\u4e0b\u4ee3\u7801\u3002\n\n```cpp\nint beg=h[j],ans=0;//beg\u4ee3\u8868\u5f53\u524d\u4f24\u5bb3,ans\u4ee3\u8868\u80fd\u6253\u51fa\u7684\u603b\u4f24\u5bb3\nfor(int j=i-1;j>=1;j--)\n{\n\tif(!beg)break;\n\tbeg--;//\u8fd9\u91cc\u51cf1\u662f\u56e0\u4e3a\u5728\u5411\u5de6\u53f3\u4f20\u9012\u4f24\u5bb3\u65f6\u4f24\u5bb3\u4f1a\u51cf1\n\tans+=min(beg,h[j]);\n}\n```\n\u5f53\u7136\uff0c\u8fd9\u4efd\u4ee3\u7801\u53ea\u7b97\u4e86\u5411\u5de6\u7684\u8d21\u732e\uff0c\u5411\u53f3\u7684\u540c\u7406\u3002\n\n\u4f46\u8fd9\u6837\u662f $n^2$ \u7684\uff0c\u8003\u8651\u600e\u4e48\u4f18\u5316\uff0c\u8bbe $dp_i$ \u4ee3\u8868\u5728 $i$ \u70b9\u65bd\u653e\u4e00\u4e2a Explosions \u540e\u5411\u5de6\u4f20\u9012\u80fd\u9020\u6210\u591a\u5c11\u4f24\u5bb3\uff08\u5373\u5728 $i$ \u6267\u884c\u4e0a\u8ff0\u4ee3\u7801\u540e\u7684 ans\uff09\u3002\n\n\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $i$\uff0c\u5982\u679c\u5728 $i$ \u65bd\u653e Explosions\uff0c\u4f24\u5bb3\u5411\u5de6\u4f20\u9012\u5230 $j$ \u65f6\u4f1a\u53d8\u4e3a $\\min(h_j,h_i-(i-j))$\u3002\n\n\u8f6c\u5316\u4e00\u4e0b\u5f0f\u5b50\uff0c\u5982\u679c\u6211\u4eec\u8981\u4f7f\u5f97 $h_j$ \u66f4\u5c0f\uff0c\u5c31\u76f8\u5f53\u4e8e $h_i-i+j>h_j$\uff0c\u518d\u5316\u7b80\u4e00\u4e0b\uff0c\u76f8\u5f53\u4e8e $h_i-i>h_j-j$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u7528 $st$ \u8868\u9884\u5904\u7406 $h_j-j$ \u7684\u503c\uff0c\u7136\u540e\u4e8c\u5206\u5230\u7b2c\u4e00\u4e2a $k$ \u4f7f\u5f97 $h_i-i>h_k-k$\u3002\n\n\u5728 $k$ \u8fd9\u4e2a\u4f4d\u7f6e\u4e0a $h_k$ \u66f4\u5c0f\uff0c\u6240\u4ee5 $k$ \u4ee5\u524d\u7684\u7b54\u6848\u5c31\u76f8\u5f53\u4e8e $dp_k$\uff0c\u800c $k+1 \\sim i$ \u4e2d $h_i-(i-j)$ \u66f4\u5c0f\uff0c\u6240\u4ee5\u662f\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u8fd9\u6837\u5c31\u80fd\u5728 $O(n\\log_2n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u4e86\u3002\n\n\u8fd9\u91cc\u6709\u4e2a\u5c0f\u6280\u5de7\uff0c\u4e0d\u7528\u5bf9\u5de6\u8fb9\u53f3\u8fb9\u7684\u5904\u7406\u5206\u522b\u5199\u4ee3\u7801\uff0c\u53ea\u9700\u8981\u5199\u5904\u7406\u5de6\u8fb9\u7684\uff0c\u7136\u540e\u5c06\u6574\u4e2a\u6570\u7ec4\u7ffb\u8f6c\u8fc7\u6765\u518d\u6c42\u4e00\u904d\u5c31\u597d\u4e86\u3002\n\n## \u4ee3\u7801\uff1a\n\n```cpp\n//This code is written by Hmz(Hmz is cute!!!)\n#include<bits/stdc++.h>\nusing namespace std;\n#define TY long long\n#define mod (TY)(1e9+7)\n#define MAXN 300005\n#define MAXM 200005\n#define MAXK 27\n#define For(i,a,b) for(TY i=(a);i<=(b);++i)\n#define FOR(i,a,b) for(TY i=(a);i<(b);++i)\n#define Rof(i,a,b) for(TY i=(a);i>=(b);--i)\n#define ROF(i,a,b) for(TY i=(a);i>(b);--i)\ninline TY qr(){\n\tTY x=0,f=1;char op=getchar();\n\tfor(;op<'0'||op>'9';op=getchar())if(op=='-')f=-1;\n\tfor(;op>='0'&&op<='9';op=getchar())x=x*10+(op^48);\n\treturn x*f;\n}inline char getc(){\n    char op=getchar();\n    while(op==' '||op=='\\n'||op=='\\r')op=getchar();\n\treturn op;\n}inline string qs(){\n\tstring op=\"\";char u=getchar();\n\twhile(u=='\\n'||u=='\\r'||u==' ')u=getchar();\n\twhile(u!='\\n'&&u!='\\r'&&u!=' ')op+=u,u=getchar();\n\treturn op;\n}inline void qw(TY x){\n\tif(!x){putchar('0');return;}\n\tif(x<0)putchar('-'),x=-x;\n\tif(x>=10)qw(x/10);putchar(x%10+'0');\n}inline void qw(TY x,char op){qw(x),putchar(op);}\ninline void ws(string s){FOR(i,0,s.size())putchar(s[i]);}\ninline TY Ceil(TY a,TY b){return a/b+(a%b!=0);}\ninline TY Mod(TY a){return (a>=mod?a-mod:a);}\ninline TY Pow(TY a,TY b){\n\tTY ans=1,base=a;\n\twhile(b){\n\t\tif(b&1)ans=ans*base%mod;\n\t\tbase=base*base%mod;b>>=1;\n\t}return ans;\n}TY T,n,a[MAXN],Ans[MAXN],Log[MAXN],st[MAXN][25],tans[MAXN];\ninline TY query(TY u,TY v){\n\tTY k=Log[v-u+1];\n\treturn min(st[u][k],st[v-(1ll<<k)+1][k]);\n}inline void init(){\n\tFor(i,1,n)st[i][0]=a[i]-i;\n\tFor(j,1,24)for(TY i=1;i+(1ll<<j)-1<=n;++i){\n\t\tst[i][j]=min(st[i][j-1],st[i+(1ll<<j-1)][j-1]);\n\t}\n}inline void solve(bool op){\n\tinit();For(i,1,n)tans[i]=0;\n\tFor(i,1,n){\n\t\tTY l=max(1ll,i-a[i]+1),r=i-1,ans=0;while(l<=r){\n\t\t\tTY mid=(l+r)>>1;\n\t\t\tif(a[i]-i>=query(mid,i-1))ans=mid,l=mid+1;\n\t\t\telse r=mid-1;\n\t\t}TY len=i-(!ans?max(1ll,i-a[i]+1)-1:ans)-1;\n\t\ttans[i]=tans[ans]+(a[i]-1+(a[i]-len))*len/2;\n\t\tAns[op==0?i:n-i+1]+=tans[i];tans[i]+=a[i];\n\t}\n}int main(){\n\tFor(i,2,300000)Log[i]=Log[i/2]+1;\n\tT=qr();while(T--){\n\t\tTY sum=0,lastans=-1e9;\n\t\tn=qr();For(i,1,n)a[i]=qr(),sum+=a[i],Ans[i]=0;\n\t\tsolve(0);reverse(a+1,a+1+n);solve(1);\n\t\tFor(i,1,n)lastans=max(lastans,Ans[i]);\n\t\tqw(sum-lastans,'\\n');\n\t}return 0;\n}\n```\n\n",
        "postTime": 1676937390,
        "uid": 355640,
        "name": "_HMZ_",
        "ccfLevel": 7,
        "title": "CF1795E \u9898\u89e3"
    }
]