[
    {
        "content": "## [\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF919D)\n\n### \u89e3\u51b3\u601d\u8def\uff1a\n\nDP \u4e0e\u62d3\u6251\u7ed3\u5408\u3002$f_{i,j}$ \u8868\u793a\u5230 $i$ \u4f4d\u7f6e $j$ \u7684\u6700\u5927\u6b21\u6570\u3002\n\n\u5c06 $a \\sim z$ \u8f6c\u6210\u6570\u5b57 $0\\sim 25$ \uff0c\u65b9\u4fbf\u5b58\u50a8\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\u8fd9\u4e00\u90e8\u5206\u5176\u4ed6\u9898\u89e3\u8bb2\u7684\u5f88\u8be6\u7ec6\u4e86\uff0c\u4e5f\u5f88\u597d\u7406\u89e3\u3002\u5bf9\u4e8e\u4e8c\u5341\u516d\u4e2a\u5b57\u6bcd\uff08$j$\uff09\uff1a\n\n- \u82e5\u662f\u5f53\u524d\u8282\u70b9\uff0c\u5219 $f_{tmp,j}=\\max(f_{tmp,j},f_{k,j}+1)$\n\n- \u5426\u5219 $f_{tmp,j}=\\max(f_{tmp,j},f_{k,j})$\n\n\u5176\u4e2d $tmp$ \u4e3a\u5f53\u524d\u641c\u5230\u7684\u8282\u70b9\uff0c$k$ \u4e3a\u5176\u7236\u8282\u70b9\u3002\n\n\u7136\u540e\u8003\u8651\u5982\u4f55\u5224\u73af\u3002\u4f8b\u5982\u4ee5\u4e0b\u60c5\u51b5\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/nnur6eks.png)\n\n\u7ea2\u6846\u4e2d\u663e\u7136\u662f\u73af\u3002\n\n\u6a21\u62df\u5176\u5904\u7406\u8fc7\u7a0b\u3002\u7b2c\u4e00\u6b21\u5220\u6389\u4e86\u5165\u5ea6\u4e3a $0$ \u7684 $1$ \u53f7\u8282\u70b9\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/o6v6dfum.png)\n\n\u7136\u540e\u4f1a\u53d1\u73b0\uff0c\u8fd9\u65f6\u6ca1\u6709\u5165\u5ea6\u4e3a $0$ \u7684\u8282\u70b9\u53ef\u4ee5\u627e\u4e86\uff0c\u961f\u5217\u4e3a\u7a7a\uff0c\u7ed3\u675f BFS\u3002\n\n\u800c\u5bf9\u4e8e\u6ca1\u6709\u73af\u7684\u60c5\u51b5\uff0c\u6240\u6709\u70b9\u90fd\u662f\u4f1a\u88ab\u904d\u5386\u5230\u7684\u3002\n\n\u6240\u4ee5\uff0c\u7528 $cnt$ \u8bb0\u5f55\u904d\u5386\u8fc7\u70b9\u7684\u6570\u91cf\uff0c\u82e5\u6700\u540e $cnt<n$\uff0c\u5219\u8bf4\u660e\u6709\u73af\u3002\n\n\u7ec6\u8282\u8bb2\u597d\u4e86\uff0c\u7a0b\u5e8f\u4e2d\u5c31\u4e0d\u518d\u6ce8\u91ca\u4e86\u3002\n\n### Code\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,b[300005],in[300005],f[300005][26];\nint ans,cnt,x,y;\nstring s;\nvector<int> a[300005];\nqueue<int> q;\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tcin>>s;\n\tfor(int i=1;i<=n;i++) b[i]=s[i-1]-'a',f[i][b[i]]++;\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tin[y]++;\n\t\ta[x].push_back(y);\n\t}\n\tfor(int i=1;i<=n;i++) if(!in[i]) q.push(i);\n\twhile(q.size()){\n\t\tint k=q.front();\n\t\tq.pop();\n\t\tcnt++;\n\t\tfor(int i=0;i<a[k].size();i++){\n\t\t\tint tmp=a[k][i];\n\t\t\tfor(int j=0;j<26;j++){\n\t\t\t\tif(b[tmp]==j) f[tmp][j]=max(f[tmp][j],f[k][j]+1);\n\t\t\t\telse f[tmp][j]=max(f[tmp][j],f[k][j]);\n\t\t\t}\n\t\t\tin[tmp]--;\n\t\t\tif(!in[tmp]) q.push(tmp);\n\t\t}\n\t}\n\tif(cnt<n) printf(\"-1\");\n\telse{\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=0;j<26;j++) ans=max(ans,f[i][j]);\n\t\t}\n\t\tprintf(\"%d\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1662372679,
        "uid": 241485,
        "name": "Binary_1110011_",
        "ccfLevel": 6,
        "title": "CF919D \u9898\u89e3"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF919D)\n\n\u9898\u76ee\u5927\u6982\u610f\u601d\u662f\uff1a\u7ed9\u51fa\u4e00\u4e2a $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u6709\u5411\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e00\u4e2a\u5c0f\u5199\u5b57\u6bcd\u6743\u503c\uff0c\u800c\u4e00\u6761\u8def\u5f84\u7684\u6743\u503c\u662f\u8fd9\u6761\u8def\u5f84\u51fa\u73b0\u5b57\u6bcd\u7684\u6700\u591a\u6b21\u6570\uff0c\u95ee\u6240\u6709\u8def\u5f84\u4e2d\u6700\u5927\u7684\u6743\u503c\u3002\u5982\u679c\u7ed3\u679c\u4e3a\u65e0\u9650\u5927\uff0c\u5219\u8f93\u51fa $-1$\u3002\n\n\u8fd9\u9053\u9898\u7684\u4e3b\u8981\u601d\u8def\u5c31\u662f**\u5224\u65ad\u73af**\u63a5\u7740**\u8fdb\u884c DP**\u3002\u4e0b\u9762\u5c31\u5c06\u4e24\u4e2a\u6b65\u9aa4\u5206\u5f00\u8bb2\uff1a\n\n- \u5224\u65ad\u73af\n\n\t- \u5176\u5b9e\u8fd9\u9053\u9898\u5224\u65ad\u73af\u7684\u65b9\u6cd5\u5f88\u591a\uff0c\u6bd4\u5982**\u62d3\u6251\u6392\u5e8f**\uff0c\u56e0\u4e3a\u62d3\u6251\u6392\u5e8f\u540e\u987a\u4fbf\u53ef\u4ee5\u628a DP \u987a\u5e8f\u5904\u7406\u51fa\u6765\uff0c\u5177\u4f53\u5b9e\u73b0\u5176\u4ed6\u9898\u89e3\u8bf4\u7684\u5df2\u7ecf\u5f88\u6e05\u695a\u4e86\u3002\n    - \u6211\u4eec\u4e5f\u53ef\u4ee5\u628a\u56fe**\u904d\u5386**\u4e00\u904d\uff0c\u5728\u8bbf\u95ee $u$ \u7684\u5b50\u8282\u70b9 $v$ \u7684\u8fc7\u7a0b\u4e2d\uff0c\u4fdd\u6301 $vis_u$ \u4e3a $-1$\uff0c\u5982\u679c\u4ece $v$ \u5f00\u59cb\u904d\u5386\u80fd\u904d\u5386\u5230 $u$ \u5373 $vis_u$ \u4e3a $-1$ \u65f6\uff0c\u8bf4\u660e\u6709\u73af\u3002\u5982\u679c\u904d\u5386\u5b8c\u4e86 $u$ \u7684\u6240\u6709\u5b50\u8282\u70b9\u90fd\u6ca1\u6709\u904d\u5386\u5230 $u$\uff0c\u8bf4\u660e $u$ \u53ca $v$ \u90fd\u6ca1\u6709\u73af\uff0c\u53ef\u4ee5\u8bbe\u4e3a $1$\uff0c\u4e0b\u6b21\u904d\u5386\u5230\u5c31\u4e0d\u7528\u904d\u5386\u4e86\u3002\n\n```cpp\nvoid CheckRing(int u) {\n\tint v;\n\t\n    vis[u] = -1;\n    \n    for (int i = 0; i < e[u].size(); i++) {\n    \tv = e[u][i];\n    \t\n    \tif (!vis[v]) {\n    \t\tCheckRing(v);\n\t\t}\n\t\t\n\t\telse if (vis[v] == -1) {\n\t\t\tprintf(\"-1\\n\");\n\t\t\texit(0); \n\t\t}\n\t}\n\t\n    vis[u] = 1;\n}\n```\n\n- DP\n\n\t- \u6211\u4eec\u8bbe ```f[i][26]``` \u4e3a\u4ee5 $i$ \u4e3a\u8d77\u70b9\u7684\u8def\u5f84\uff0c\u6bcf\u79cd\u5b57\u6bcd\u51fa\u73b0\u6700\u591a\u7684\u6b21\u6570\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece $u$ \u5f00\u59cb\uff0c\u5148 DP \u5b8c $u$ \u7684\u6240\u6709\u5b50\u8282\u70b9 $v$\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u5217\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u3002\n    - \u6211\u4eec\u8bbe\u5f53\u524d\u8981\u6c42 ```f[u][i]```\uff0c\u90a3\u4e48\uff1a\n    \t- \u5728\u4e0d\u65ad\u66f4\u65b0\u7684\u8fc7\u7a0b\u4e2d\uff0c```f[v][i]``` \u8bb0\u5f55\u7684\u662f\u4ece $v$ \u51fa\u53d1\u7684\u8def\u5f84\u4e2d\u7b2c $i$ \u4e2a\u5b57\u6bcd\u51fa\u73b0\u7684\u6700\u591a\u6b21\u6570\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e\u4fdd\u7559\u4e86\u7b2c $i$ \u4e2a\u5b57\u6bcd\u51fa\u73b0\u6700\u591a\u7684\u8def\u5f84\u3002\n        - \u5c06\u6bcf\u4e2a\u5b50\u8282\u70b9 $v$ \u6bd4\u8f83\uff0c\u9009\u62e9\u542b\u7b2c $i$ \u4e2a\u5b57\u6bcd\u6700\u591a\u7684\u8def\u5f84\uff0c\u90a3\u4e48\u6700\u540e\u4fdd\u5b58\u7684\u4e00\u5b9a\u662f\u542b\u7b2c $i$ \u4e2a\u5b57\u6bcd\u6700\u591a\u7684\u8def\u5f84\u3002\n        - \u6700\u540e\u5982\u679c\u7b2c $i$ \u4e2a\u5b57\u6bcd\u4e3a\u8282\u70b9\u6743\u503c\u7684\u8bdd\u522b\u5fd8\u4e86\u52a0\u4e00\u3002\n    - \u6240\u4ee5\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n    \n$$f[u][i] =\n\\begin{cases}\nmax(f[v][i]) & i+\\texttt{a} \\neq lett_u\\\\\nmax(f[v][i]) + 1 & i+\\texttt{a} = lett_u\n\\end{cases}$$\n\n```cpp\nvoid Search (int u) {\n\tint v;\n\t\n    vis[u] = true;\n    \n    for (int i = 0; i < e[u].size(); i++) {\n        v = e[u][i];\n        \n        if (!vis[v]) {\n        \tSearch(v);\n\t\t}\n    }\n    \n    for (int i = 0; i < 26; i++) {\n        for (int j = 0; j < e[u].size(); j++) {\n        \tf[u][i] = max(f[u][i], f[e[u][j]][i]);\n\t\t}\n    }\n    \n    f[u][lett[u] - 'a']++;\n}\n```\n\u5b8c\u6574\u4ee3\u7801\uff1a\n\n```cpp\n\n\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nint n, m, ans;\nbool st[300009];\nint f[300009][29];\nchar lett[300009];\nvector<int> e[300009];\nint vis[300009];\n\nvoid Search (int u) {\n\tint v;\n\t\n    vis[u] = true;\n    \n    for (int i = 0; i < e[u].size(); i++) {\n        v = e[u][i];\n        \n        if (!vis[v]) {\n        \tSearch(v);\n\t\t}\n    }\n    \n    for (int i = 0; i < 26; i++) {\n        for (int j = 0; j < e[u].size(); j++) {\n        \tf[u][i] = max(f[u][i], f[e[u][j]][i]);\n\t\t}\n    }\n    \n    f[u][lett[u] - 'a']++;\n}\n\nvoid CheckRing(int u) {\n\tint v;\n\t\n    vis[u] = -1;\n    \n    for (int i = 0; i < e[u].size(); i++) {\n    \tv = e[u][i];\n    \t\n    \tif (!vis[v]) {\n    \t\tCheckRing(v);\n\t\t}\n\t\t\n\t\telse if (vis[v] == -1) {\n\t\t\tprintf(\"-1\\n\");\n\t\t\texit(0); \n\t\t}\n\t}\n\t\n    vis[u] = 1;\n}\n\nint main () {\n\tint u, v;\n\t\n    scanf(\"%d %d\", &n, &m);\n    \n    for (int i = 1; i <= n; i++) {\n    \twhile (true) {\n    \t\tscanf(\"%c\", &lett[i]);\n    \t\t\n    \t\tif ('a' <= lett[i] && 'z' >= lett[i]) {\n    \t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t\n    memset(st, true, sizeof(st));\n    \n    for (int i = 1; i <= m; ++i) {\n        scanf(\"%d %d\", &u, &v);\n        e[u].push_back(v);\n        st[v] = false;\n    }\n\n    memset(vis, 0, sizeof(vis));\n    \n    for (int i = 1; i <= n; i++) {\n        if (!vis[i]) {\n        \tCheckRing(i);\n\t\t}\n    }\n\n    memset(vis, 0, sizeof(vis));\n    \n    for (int i = 1; i <= n; i++) {\n        if (st[i]) {\n        \tSearch(i);\n\t\t}\n    }\n    \n    for (int i = 1; i <= n; i++) {\n    \tif (st[i]) {\n    \t\tfor (int j = 0; j < 26; j++) {\n    \t\t\tans = max(ans, f[i][j]);\n\t\t\t}\n\t\t}\n\t}\n\t\n    printf(\"%d\\n\", ans);\n}\n```\n",
        "postTime": 1627453835,
        "uid": 299086,
        "name": "Mistybranch",
        "ccfLevel": 5,
        "title": "CF919D Substring"
    },
    {
        "content": "## CF919D\u2014\u2014\u62d3\u6251\u6392\u5e8f\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF919D)\n\n### \u524d\u7f6e\u77e5\u8bc6\n\n1. \u62d3\u6251\u6392\u5e8f\n2. \u7b80\u5355DP\n\n### \u6b63\u6587\n\n\u901a\u8fc7\u6807\u7b7e\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u8fd9\u662f\u62d3\u6251\u6392\u5e8f\u3002\n\nP.S.:\u8fd9\u4e0a\u9762\u4e00\u53e5\u663e\u7136\u662f\u5e9f\u8bdd\n\n\u4f46\u662f\u4e4d\u770b\u9898\u76ee\uff0c\u611f\u89c9\u6ca1\u60f3\u5230\u662f\u62d3\u6251\u6392\u5e8f\u3002\n\n\u4f46\u662f\uff0c\u8bf7\u770b\u8fd9\u53e5\n\n> Output a single line with a single integer denoting the largest value. If the value can be arbitrarily large, output -1 instead.\n\n\u6765\uff0c\u8c37\u6b4c\u751f\u8349\u4e00\u4e0b\u3002\n\n> Translate:\u8f93\u51fa\u5355\u884c\u548c\u4e00\u4e2a\u6574\u6570\uff0c\u8be5\u6574\u6570\u8868\u793a\u6700\u5927\u503c\u3002\u5982\u679c\u8be5\u503c\u53ef\u4ee5\u4efb\u610f\u5927\uff0c\u5219\u8f93\u51fa-1\u3002\n\n~~\u597d\u50cf\u6ca1\u751f\u8349\u8bf6~~\n\n\u6709\u6ca1\u6709\u6ce8\u610f\u5230\u201c\u4efb\u610f\u5927\u201d\uff1f\u8fd9\u610f\u5473\u7740\u4ec0\u4e48\uff1f\n\n**\u73af\uff01**\n\n-------\n\n\u770b\u8fd9\u79cd\u5728**\u6709\u5411\u56fe**\u56fe\u4e0a\u627e\u6743\u503c\uff08\u201c\u6743\u503c\u201d\u8be6\u89c1\u9898\u76ee\u4e2d\u5b9a\u4e49\uff09\u7684\u9898\uff0c\u603b\u4f1a\u60f3\u8d77**DP**\u3002\n\nQ: Why? What's the reason?\n\nA: \u56e0\u4e3aDAG\uff08\u6709\u73af\u53ef\u4ee5Topo\u6392\u9664\uff0c\u5177\u4f53\u63aa\u65bd\u8be6\u89c1\u540e\u6587\uff09\u6709\u5411\uff0c\u6240\u4ee5\u6ee1\u8db3DP\u3002\n\n\u8bbe\n$$\ndp[i][j] \\text{\u8868\u793a\u8d70\u5230\u7b2ci\u6b65\u65f6\uff0c\u5b57\u6bcdj\u7684\u6700\u5927\u51fa\u73b0\u6b21\u6570}\n$$\nQ: \u55ef\uff1fj\u4e0d\u662f\u5b57\u6bcd\u5417\uff1f\n\nA: \u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u3002\n\nFor example:\n\n\u5bf9\u4e8e\u5c0f\u5199\u5b57\u6bcda\uff0c\u5c06\u5176\u6620\u5c04\u4e3a1\u3002\n\nSo,\n\n```\na -> 1\n\nb -> 2\n\n...\n\nn -> n - a + 1\n```\n\n\u7ee7\u7eed\u63a8\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n\u6211\u4eec\u8bbe\u76ee\u524d\u8d70\u5230\u4e86x\uff0c\u800cx\u901a\u5411y\uff0c\u6211\u4eec\u679a\u4e3ej\u3002\n\n\u6b64\u5904\u8981\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\u3002\n\n1. \u5f53y\u7684\u5b57\u6bcd\u7b49\u4e8ej\u65f6\n\n   `dp[y][j] = max(dp[y][j], dp[x][j] + 1) `\n\n2. \u4e0d\u7b49\u4e8e\u65f6\n\n   `dp[y][j] = max(dp[y][j], dp[x][j]) //\u56e0\u4e3a\u4e0d\u7b49\u4e8e\uff0c\u6240\u4ee5\u4e0d\u52a0\u4e00`\n\n\u6b64\u8fc7\u7a0b\u8fdb\u884c\u4e8e\u62d3\u6251\u6392\u5e8f\u65f6\uff0c\u4e0b\u9762\u662f\u4ee3\u7801\u7247\u6bb5\uff1a\n\n```cpp\n\twhile(!Q.empty())\n\t{\n\t\tint x = Q.front();\n\t\tQ.pop();\n\t\tin[x] = -1; //delete this edge \n\t\tsum ++;// count\n\t\tfor(int i = 0; i < E[x].size(); i ++)\n\t\t{\n\t\t\tint y = E[x][i];\n\t\t\tfor(int j = 1; j <= 26; j ++)\n\t\t\t{\n\t\t\t\tif(val[y] == j)\n\t\t\t\t\tdp[y][j] = max(dp[y][j], dp[x][j] + 1);\n\t\t\t\telse\n\t\t\t\t\tdp[y][j] = max(dp[y][j], dp[x][j]);\n\t\t\t}\n\t\t\tin[y] --;\n\t\t\tif(!in[y])\n\t\t\t\tQ.push(y);\n\t\t}\n\t}\n/*\n\u89e3\u91ca\u4e00\u4e0b\uff1a\nin\uff1a\u5165\u5ea6\nsum\uff1a\u7edf\u8ba1\u5165\u961f\u6570\u91cf\nval[x]\uff1ax\u4ee3\u8868\u7684\u5b57\u6bcd\n*/\n```\n\n\u8ba9\u6211\u4eec\u56de\u5230\u5148\u524d\u7684\u95ee\u9898\uff1a\n\n> Q: Why? What's the reason?\n>\n> A: \u56e0\u4e3aDAG\uff08 __\u6709\u73af\u53ef\u4ee5Topo\u6392\u9664\uff0c\u5177\u4f53\u63aa\u65bd\u8be6\u89c1\u540e\u6587__\uff09\u6709\u5411\uff0c\u6240\u4ee5\u6ee1\u8db3DP\u3002\n\n\u6211\u4eec\u7edf\u8ba1\u5165\u961f\u7684\u6570\u91cf\uff0c\u5982\u679csum\u5c0f\u4e8en\uff0c\u5219\u6709\u73af\uff0c\u5373\u6743\u503c\u4efb\u610f\u5927\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/8ipsg4ik.png)\n\n\u56fe\u753b\u5f97\u4e0d\u597d\uff0c\u8bf7\u89c1\u8c05\u3002\n\n\u5f53\u70b91\u8fdb\u5165\u961f\u5217\u540e\uff0c\u5220\u6389\u70b91\uff0c\u6b64\u65f6sum=1\n\n\u4f46\u5f531\u5220\u6389\u540e\uff0c\u6ca1\u6709\u5165\u5ea6\u4e3a0\u7684\u70b9\u4e86\uff0c\u9000\u51fa\u3002\n\n\u6b64\u65f6sum < n (n = 4)\u3002\n\n\u597d\u4e86\uff0c\u6ca1\u4ec0\u4e48\u8bf4\u7684\u4e86\uff0c\u4e0b\u9762\u662f\u4ee3\u7801\u3002\n\n---\n\nCode:\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int maxn = 3e5 + 10;\n\nint n, m;\nint val[maxn];\nint in[maxn];\nint dp[maxn][30];\nint sum;\nint ans;\nvector<int> E[maxn];//save the edges\nqueue<int> Q;\n\nint main()\n{\n\tscanf(\"%d%d\", &n, &m);\n\tfor(int i = 1; i <= n; i ++)\n\t{\n\t\tchar c;\n\t\tcin >> c;\n\t\tval[i] = c - 'a' + 1;\n\t\tdp[i][val[i]] ++;//init\n\t}\n\n\tfor(int i = 1; i <= m; i ++)\n\t{\n\t\tint x, y;\n\t\tscanf(\"%d%d\", &x, &y);//notice \"x to y\"\n\t\tE[x].push_back(y);\n\t\tin[y] ++;\n\t}\n\n\tfor(int i = 1; i <= n; i ++)\n\t\tif(!in[i])Q.push(i);\n\t//Topo sort\n\twhile(!Q.empty())\n\t{\n\t\tint x = Q.front();\n\t\tQ.pop();\n\t\tin[x] = -1; //delete this edge \n\t\tsum ++;// count\n\t\tfor(int i = 0; i < E[x].size(); i ++)\n\t\t{\n\t\t\tint y = E[x][i];\n\t\t\tfor(int j = 1; j <= 26; j ++)\n\t\t\t{\n\t\t\t\tif(val[y] == j)\n\t\t\t\t\tdp[y][j] = max(dp[y][j], dp[x][j] + 1);\n\t\t\t\telse\n\t\t\t\t\tdp[y][j] = max(dp[y][j], dp[x][j]);\n\t\t\t}//solve\n\t\t\tin[y] --;\n\t\t\tif(!in[y])\n\t\t\t\tQ.push(y);\n\t\t}\n\t}\n\n\tif(sum < n)\n\t\treturn printf(\"-1\"), 0;\n\n\tfor(int i = 1; i <= n; i ++)\n\t\tfor(int j = 1; j <= 26; j ++)\n\t\t\tans = max(dp[i][j], ans);//find the biggest\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```\n\n\n\n### \u5199\u5728\u6700\u540e\n\n\u672c\u9898\u89e3\u3001\u4ee3\u7801\u5199\u4e8e`Linux Ubuntu`\u4e0b\uff0c\u5c31\u51fa\u73b0\u4e86\u4e00\u4e2a\u7384\u5b66\u95ee\u9898\n\n```cpp\n\tfor(int i = 1; i <= n; i ++)\n\t{\n\t\tchar c;\n\t\tcin >> c;//\u5982\u5c06\u8fd9\u91cc\u6539\u4e3ac = getchar(), \u672c\u5730\u8fd0\u884cRE\n\t\tval[i] = c - 'a' + 1;\n\t\tdp[i][val[i]] ++;//init\n\t}\n```\n\n\u6c42\u5927\u4f6c\u6307\u6559\uff01\n\nThe end.",
        "postTime": 1615700906,
        "uid": 338370,
        "name": "Merron",
        "ccfLevel": 0,
        "title": "CF919D\u9898\u89e3"
    },
    {
        "content": "# CF919D Substring \u9898\u89e3\n\n\u4f20\u9001\u95e8\uff1a[$\\otimes$](https://www.luogu.com.cn/problem/CF919D)[$\\oplus$](https://codeforces.com/problemset/problem/919/D)\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u70b9 $m$ \u8fb9\u7684\u6709\u5411\u56fe\uff0c\u6bcf\u4e2a\u9876\u70b9\u4ee3\u8868\u4e00\u4e2a\u5c0f\u5199\u5b57\u6bcd\u3002\u5b9a\u4e49\u4e00\u6761\u8def\u5f84\u7684\u6743\u503c\u4e3a\u51fa\u73b0\u6700\u591a\u6b21\u6570\u7684\u5b57\u6bcd\u7684\u51fa\u73b0\u6b21\u6570\u3002\u4f8b\u5982\u4e00\u6761\u8def\u5f84\u4e0a\u7684\u5b57\u6bcd\u5206\u522b\u662f `abaca`\uff0c\u90a3\u4e48\u8fd9\u6761\u8def\u5f84\u7684\u6743\u503c\u5c31\u662f $3$\u3002\u4f60\u7684\u4efb\u52a1\u662f\u627e\u5230\u8fd9\u5f20\u56fe\u4e0a\u6700\u5927\u7684\u8def\u5f84\u6743\u503c\u3002\uff08\u6709\u73af\u5219\u8f93\u51fa `-1`.\uff09\n\n## \u89e3\u6790\n\n\u9996\u5148\u8003\u8651 dfs/dp\uff0c\u5728\u5408\u5e76\u4fe1\u606f\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u201c\u6700\u591a\u51fa\u73b0\u7684\u5b57\u6bcd\u201d\u662f**\u4e0d\u53ef\u52a0**\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u80fd\u53ea\u8bb0\u5f55\u6700\u591a\u51fa\u73b0\u7684\u5b57\u6bcd\u3002\u4e8e\u662f\u4fbf\u60f3\u5230\u4e86\u7528 $f_{i,j}$ \u8bb0\u5f55\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684\u8def\u5f84\u4e2d\uff0c\u5b57\u6bcd $j$ \u6700\u591a\u51fa\u73b0\u7684\u6b21\u6570\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5c0f\u5199\u5b57\u6bcd\u91cf\u5316\uff0c\u5e38\u7528\u65b9\u6cd5\u662f `str[i] = s[i - 1] - 'a'`\uff0c\u5373 ASCII \u7801\u76f8\u51cf\u3002\n\n\u518d\u770b\u9898\u76ee\u4e2d\uff0c\u6709\u5411\u56fe+\u73af+\u8def\u5f84\uff0c\u81ea\u7136\u8ba9\u4eba\u8054\u60f3\u5230\u4e86\u62d3\u6251\u6392\u5e8f\uff0c\u6838\u5fc3\u601d\u60f3\u662f\u7528\u4e00\u4e2a\u8282\u70b9\u7684\u6240\u6709\u524d\u9a71\u66f4\u65b0\u8fd9\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\u3002\u5c06\u62d3\u6251\u6392\u5e8f\u4f5c\u4e3a\u8f6c\u79fb\u987a\u5e8f\uff0c\u4e5f\u5c31\u662f\u62d3\u6251\u6392\u5e8f\u7684\u540c\u65f6\u5b8c\u6210\u8f6c\u79fb\u3002\u5bf9\u4e8e\u4e00\u6761\u8fb9 $(u,v)$\uff0c\u5148\u5c06 $u$ \u7684\u4fe1\u606f\u5408\u5e76\u5230 $v$ \u4e0a\uff0c\u518d\u8003\u8651\u8fd9\u6761\u8fb9\u4ea7\u751f\u7684\u8d21\u732e\u3002\u5373\u5bf9\u4e8e $\\forall i,f_{v,i}=\\max(f_{v,i},f_{u,i})$\uff0c\u518d\u628a $v$ \u5bf9\u5e94\u7684\u5c0f\u5199\u5b57\u6bcd $str_v$ \u7528 $f_{u,str_v}+1$ \u66f4\u65b0\u6700\u5927\u503c\u3002\n\n\u6700\u540e\u8003\u8651\u4e00\u4e0b\u73af\u7684\u60c5\u51b5\u3002\u62d3\u6251\u6392\u5e8f\u53ef\u4ee5\u5224\u73af\uff0c\u8bb0\u5f55\u5165\u961f\u7684\u5143\u7d20\u4e2a\u6570 $cnt$\uff0c\u82e5 $cnt\\not=n$\uff08\u4e25\u683c\u6765\u8bb2\u662f $cnt<n$\uff09\u5219\u8bf4\u660e\u5b58\u5728\u73af\uff0c\u53cd\u4e4b\u4e0d\u5b58\u5728\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\ninline int read(){\n\tchar ch;\n\tint s = 0, w = 1;\n\tfor(; ch < '0' || ch > '9'; w *= ch == '-' ? -1 : 1, ch = getchar());\n\tfor(; ch >= '0' && ch <=' 9'; s = s * 10 + ch - '0', ch = getchar());\n\treturn s * w;\n}\nconst int MAXN = 300005;\nconst int MAXM = 300005;\nint N, M, f[MAXN][30], str[MAXN], indeg[MAXN];\nstruct Graph{\n\tstruct Edge{\n\t\tint to, nxt;\n\t} e[MAXM << 1];\n\tint head[MAXN], tot;\n\tvoid add(int u, int v){\n\t\te[++tot].to = v;\n\t\te[tot].nxt = head[u];\n\t\thead[u] = tot;\n\t}\n} G;\nsigned main(){\n\tcin >> N >> M;\n\tstring s;\n\tcin >> s; \n\tfor(int i = 1; i <= N; i++){\n\t\tstr[i] = s[i - 1] - 'a';\n\t\tf[i][str[i]]++;\n\t}\n\tfor(int i = 1, u, v; i <= M; i++){\n\t\tu = read(), v = read();\n\t\tindeg[v]++;\n\t\tG.add(u, v);\n\t}\n\tqueue<int> q;\n\tint cnt = 0;\n\tfor(int i = 1; i <= N; i++){\n\t\tif(indeg[i] == 0){\n\t\t\tq.push(i);\n\t\t\tcnt++;\n\t\t}\n\t}\n\twhile(!q.empty()){\n\t\tint u = q.front();\n\t\tq.pop();\n\t\tfor(int i = G.head[u], v; i; i = G.e[i].nxt){\n\t\t\tv = G.e[i].to;\n\t\t\tindeg[v]--;\n\t\t\tif(indeg[v] == 0) {\n\t\t\t\tq.push(v);\n\t\t\t\tcnt++;\n\t\t\t}\n\t\t\tfor(int j = 0; j < 26; j++){\n\t\t\t\tf[v][j] = max(f[v][j], f[u][j]);\n\t\t\t}\n\t\t\tf[v][str[v]] = max(f[v][str[v]], f[u][str[v]] + 1);\n\t\t}\n\t}\n\tif(cnt != N){\n\t\tcout << -1 << endl;\n\t\treturn 0;\n\t}\n\tint res = 0;\n\tfor(int i = 1; i <= N; i++){\n\t\tfor(int j = 0; j < 26; j++){\n\t\t\tres = max(res, f[i][j]);\n\t\t}\n\t}\n\tcout << res << endl;\n\treturn 0;\n}\n```\n",
        "postTime": 1679188649,
        "uid": 352600,
        "name": "hexu2010",
        "ccfLevel": 5,
        "title": "CF919D Substring \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651 dp\u3002\u4ee4 $f_{i,j}$ \u8868\u793a\u4ece\u4efb\u610f\u4e00\u70b9\u5230\u70b9 $i$\uff0c\u5b57\u6bcd $j$ \u7684\u6700\u591a\u51fa\u73b0\u6b21\u6570\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u662f\u4e00\u4e2a\u56fe\uff0c\u6ca1\u6709\u660e\u786e\u7684\u5148\u540e\u987a\u5e8f\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8fb9\u62d3\u6251\u6392\u5e8f\u8fb9 dp\u3002\u8f6c\u79fb\u5c31\u662f\u548c\u81ea\u5df1\u7684\u7236\u4eb2\u8282\u70b9\u6bd4 $\\max$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nvector<int> gv[300005];\nstring s;\nint n,m,ans,ind[300005],f[300005][26];\nsigned main(){\n\tcin>>n>>m>>s;\n\ts='#'+s;\n\tfor(int i=1;i<=m;i++){\n\t\tint x,y;\n\t\tcin>>x>>y;\n\t\tgv[x].push_back(y);\n\t\tind[y]++;\n\t}\n\tqueue<int> q;\n\tfor(int i=1;i<=n;i++) if(!ind[i]) q.push(i);\n\twhile(!q.empty()){\n\t\tint fr=q.front();\n\t\tq.pop();\n\t\tf[fr][s[fr]-'a']++;\n\t\tfor(int i=0;i<(int)gv[fr].size();i++){\n\t\t\tind[gv[fr][i]]--;\n\t\t\tfor(int j=0;j<26;j++) f[gv[fr][i]][j]=max(f[gv[fr][i]][j],f[fr][j]);\n\t\t\tif(!ind[gv[fr][i]]) q.push(gv[fr][i]);\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) if(ind[i]) return cout<<-1,0;\n\tfor(int i=1;i<=n;i++) for(int j=0;j<26;j++) ans=max(ans,f[i][j]);\n\tcout<<ans;\n}\n```",
        "postTime": 1679129259,
        "uid": 527598,
        "name": "FReQuenter",
        "ccfLevel": 0,
        "title": "CF919D Substring \u9898\u89e3"
    },
    {
        "content": "## \u524d\u7f6e\u77e5\u8bc6\n\n1. \u62d3\u6251\u6392\u5e8f\n\n2. \u57fa\u7840\u52a8\u6001\u89c4\u5212\n\n## \u601d\u8def\u8bb2\u89e3\uff1a\n\n\u8fd9\u4e2a\u9898\u662f dp \u4e0e\u62d3\u6251\u6392\u5e8f\u7ed3\u5408\u3002$f_{i, j}$ \u8868\u793a\u5230\u4f4d\u7f6e $i$ \u65f6\uff0c\u5b57\u6bcd $j$ \u7684\u6700\u5927\u51fa\u73b0\u6b21\u6570\u3002\n\n\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u628a $a$ $\\sim$ $z$ \u8868\u793a\u4e3a $0$ $\\sim$ $25$\u3002\n\n\u6211\u4eec\u8bbe\u76ee\u524d\u8d70\u5230\u4e86 $x$\uff0c\u800c $x$ \u901a\u5411 $y$\uff0c\u6211\u4eec\u679a\u4e3e $j$\u3002\n\n\u6b64\u5904\u8981\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\u3002\n\n1. \u5f53 $y$ \u7684\u5b57\u6bcd\u7b49\u4e8e $j$ \u65f6\uff1a\n\n   `dp[y][j] = max(dp[y][j], dp[x][j] + 1)`\n   \n2. \u4e0d\u7b49\u4e8e\u65f6\uff1a\n\n   `dp[y][j] = max(dp[y][j], dp[x][j])`\n   \n## \u4e0a\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 3e5 + 10;\nvector<int> G[N];\nchar c[N];\nint d[N], f[N][26];\n\nint main() {\n    ios::sync_with_stdio(false), cin.tie(0);\n    int n, m;\n    string s;\n    cin >> n >> m >> s;\n    while (m--) {\n        int u, v;\n        cin >> u >> v;\n        G[u].push_back(v);\n        d[v]++;\n    }\n    for (int i = 1; i <= n; i++) {\n        c[i] = s[i - 1] - 'a';\n        f[i][c[i]] = 1;\n    }\n    queue<int> que;\n    for (int i = 1; i <= n; i++) {\n        if (d[i] == 0) {\n            que.push(i);\n        }\n    }\n    int tot = 0;\n    while (!que.empty()) {\n        int p = que.front();\n        que.pop();\n        tot++;\n        for (auto v : G[p]) {\n            d[v]--;\n            for (int i = 0; i < 26; i++) {\n                if (c[v] == i) {\n                    f[v][i] = max(f[v][i], f[p][i] + 1);\n                } else {\n                    f[v][i] = max(f[v][i], f[p][i]);\n                }\n            }\n            if (d[v] == 0) {\n                que.push(v);\n            }\n        }\n    }\n    if (tot < n) {\n        cout << -1 << \"\\n\";\n    } else {\n        int ans = -1;\n        for (int i = 1; i <= n; i++) {\n            for (int j = 0; j < 26; j++) {\n                ans = max(ans, f[i][j]);\n            }\n        }\n        cout << ans << \"\\n\";\n    }\n    return 0;\n}\n```",
        "postTime": 1677416265,
        "uid": 482998,
        "name": "jeffstart",
        "ccfLevel": 0,
        "title": "Substring"
    },
    {
        "content": "## \u9898\u89e3\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF919D)\n\n[\u70b9\u6211\u83b7\u5f97\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.luogu.com.cn/blog/yousa22/solution-cf919d)\n\n\u95f2\u8bdd\uff1a\u8fd9\u9898\u5176\u5b9e~~\u6bd4\u8f83\u6c34~~\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u7684\u667a\u969c\u64cd\u4f5c\u786c\u751f\u751f\u7684 WA \u4e86 $7$ \u53d1\u3002\n\n\u672c\u9898\u89e3\u4e3b\u8981\u8bb2 Dp\uff0c\u4e0d\u61c2\u62d3\u6251\u81ea\u884c\u5b66\u4e60\u3002\n\n### \u56de\u5f52\u6b63\u9898\n\n\u8fd9\u9898\u66b4\u529b\u641c\u7d22\u4f1a TLE\uff0c~~\u4e0d\u8981\u95ee\u6211\u600e\u4e48\u77e5\u9053\u7684\u3002~~\n\n\u770b\u5230\u8fd9\u79cd\u6c42\u6700\u5927\u503c\u7684\u9898\u76ee\uff0c\u6709\u6ca1\u6709\u60f3\u5230\u4ec0\u4e48\uff1f\n\n**DP**\n\n\u6211\u4eec\u5148\u6765\u786e\u5b9a\u4e00\u4e0b Dp \u7684\u72b6\u6001\uff0c\u7528 $dp[i][j]$ \u8868\u793a\u4ece\u4efb\u610f\u4e00\u4e2a\u70b9\u8d70\u5230 $i$ \u65f6\u5b57\u6bcd $j$ \u7684\u6570\u91cf\u7684**\u6700\u5927\u503c**\u3002\n\n\u65b9\u7a0b\uff1a\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff1a\u70b9 $i$ \u53ea\u80fd\u662f\u88ab\u4ed6\u7684\u7236\u4eb2\u66f4\u65b0\uff0c\u6240\u4ee5\u65b9\u7a0b\u4e3a:\n\n$dp[v][i]=\\begin{cases}\\max(dp[u][i]+1,dp[v][i])&i = word[v]\\\\\\max(dp[u][i],dp[v][i])&i\\neq word[v]\\end{cases}<u,v> \\in G_E,i \\in [1,26]$\n\n$word[v]$ \u8868\u793a $v$ \u4ee3\u8868\u7684\u5b57\u6bcd\uff0c\u5982\u679c\u76f8\u540c\uff0c\u81ea\u7136\u8981\u52a0\u4e00\u3002\n\n\u4f46\u662f\u5982\u679c\u4f60\u4e0d\u6309\u7167\u4ece\u7236\u4eb2\u5230\u513f\u5b50\u7684\u65b9\u5411\u53bb Dp\uff0c\u5c31\u4f1a\u9020\u6210\u5148\u66f4\u65b0\u513f\u5b50\u518d\u66f4\u65b0\u7236\u4eb2\u7684\u9519\u8bef\u987a\u5e8f\uff0c\u6240\u4ee5\u8fd9\u65f6\u5019\u62d3\u6251\u6392\u5e8f\u5c31\u6392\u4e0a\u7528\u573a\u4e86\u3002\n\n```cpp\n\t#define ll long long\n\t#define reg register\n\t#define ri reg int\n\tinline void Topo() {\n\tqueue<int>q;\n\tfor(ri i(1); i<=n; ++i) {\n\t\tif(In[i]==0)q.push(i);\n\t\t//\u627e\u5165\u5ea6\u4e3a 0 \u7684\u70b9\u5165\u961f \n\t}\n\twhile(!q.empty()) {\n\t\tri u=q.front();\n\t\tq.pop();\n\t\t++cnt;\n\t\t//\u8ba1\u6570\uff0c\u5982\u679c\u5165\u961f\u6b21\u6570\u5c0f\u4e8e n \u8bf4\u660e\u6709\u73af \n\t\tfor(ri i(head[u]); i; i=kano[i].nxt) {\n\t\t\tri v=kano[i].v;\n\t\t\t--In[v];\n\t\t\t//\u5220\u8fb9\uff0c\u8fd9\u91cc\u7528\u51cf\u5c11\u5ea6\u6570\u6765\u8868\u793a \n\t\t\tfor(ri j(1); j<=26; ++j) {\n\t\t\t\tif(j==s[v]) {//\u5982\u679c\u6b64\u65f6\u5b57\u6bcd\u4e00\u6837\uff0c\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u52a0 1 \n\t\t\t\t\tdp[v][j]=max(dp[v][j],dp[u][j]+1);\n\t\t\t\t} else {//\u5426\u5219\u4e0d\u6539\u52a8 \n\t\t\t\t\tdp[v][j]=max(dp[v][j],dp[u][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t//\u5982\u679c\u5165\u961f\u4e3a 0\uff0c\u8bf4\u660e\u4ed6\u7684\u7238\u7238\u5df2\u7ecf\u88ab\u62d3\u5c55\u5b8c\u4e86\uff0c\u53ef\u4ee5\u62d3\u5c55\u4e86 \n\t\t\tif(In[v]==0)q.push(v);\n\t\t}\n\t}\n}\n```\n\n\u518d\u8bb2\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8fd9\u6837\u5224\u73af\uff0c\u56e0\u4e3a\u5728\u73af\u4e0a\u7684\u6240\u6709\u7684\u70b9\u5165\u5ea6\u80af\u5b9a\u4f1a\u5927\u4e8e $0$\uff0c\u4ed6\u4eec\u90fd\u4e0d\u4f1a\u88ab\u66f4\u65b0\uff0c\u6240\u4ee5\u6b64\u65f6\u5165\u961f\u6b21\u6570\u4e00\u5b9a\u5c0f\u4e8e $n$\u3002\n\n\u6700\u540e\uff0c\u4e0a\u4e00\u4e0b\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define reg register\n#define ri reg int\nusing namespace std;\nconst int maxn=3e5+10;\nint n,m;\nint dp[maxn][27],In[maxn],cnt;\nint head[maxn],tot,ans=0;\nint s[maxn];\nchar t;\nstruct node {\n\tint v,nxt;\n} kano[maxn<<2];\n//\u6211\u5199\u7684\u65f6\u5019\u8111\u62bd\u628a [maxn<<2] \u5199\u6210 [maxn>>2] \u7ed3\u679c\u4e00\u76f4 WA \ninline void add_kano(ri u,ri v) {\n\t++tot;\n\tkano[tot].nxt=head[u];\n\tkano[tot].v=v;\n\thead[u]=tot;\n}\n//\u5b58\u56fe \ninline void Topo() {\n\tqueue<int>q;\n\tfor(ri i(1); i<=n; ++i) {\n\t\tif(In[i]==0)q.push(i);\n\t\t//\u627e\u5165\u5ea6\u4e3a 0 \u7684\u70b9\u5165\u961f \n\t}\n\twhile(!q.empty()) {\n\t\tri u=q.front();\n\t\tq.pop();\n\t\t++cnt;\n\t\t//\u8ba1\u6570\uff0c\u5982\u679c\u5165\u961f\u6b21\u6570\u5c0f\u4e8e n \u8bf4\u660e\u6709\u73af \n\t\tfor(ri i(head[u]); i; i=kano[i].nxt) {\n\t\t\tri v=kano[i].v;\n\t\t\t--In[v];\n\t\t\t//\u5220\u8fb9\uff0c\u8fd9\u91cc\u7528\u51cf\u5c11\u5ea6\u6570\u6765\u8868\u793a \n\t\t\tfor(ri j(1); j<=26; ++j) {\n\t\t\t\t//Tips \u6211 dp \u7684\u65f6\u5019\u91cc\u9762\u7684\u5faa\u73af\u662f i,\u7adf\u7136\u4e0d\u62a5\u9519\uff0c\u8fd8\u8fc7\u4e86\u6837\u4f8b\n\t\t\t\t//\u4e00\u5b9a\u8981\u7ec6\u5fc3\uff0c\u4e0d\u8981\u50cf\u6211\u8fd9\u6837 \n\t\t\t\tif(j==s[v]) {//\u5982\u679c\u6b64\u65f6\u5b57\u6bcd\u4e00\u6837\uff0c\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u52a0 1 \n\t\t\t\t\tdp[v][j]=max(dp[v][j],dp[u][j]+1);\n\t\t\t\t} else {//\u5426\u5219\u4e0d\u6539\u52a8 \n\t\t\t\t\tdp[v][j]=max(dp[v][j],dp[u][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t//\u5982\u679c\u5165\u961f\u4e3a 0\uff0c\u8bf4\u660e\u4ed6\u7684\u7238\u7238\u5df2\u7ecf\u88ab\u62d3\u5c55\u5b8c\u4e86\uff0c\u53ef\u4ee5\u62d3\u5c55\u4e86 \n\t\t\tif(In[v]==0)q.push(v);\n\t\t}\n\t}\n}\nint main() {\n\tios::sync_with_stdio(false);\n\tcin>>n>>m;\n\tfor(ri i(1); i<=n; ++i) {\n\t\tcin>>t;\n\t\ts[i]=t-'a'+1;\n\t\t++dp[i][s[i]];\n\t\t//\u521d\u59cb dp \u503c \n\t}\n\tfor(ri i(1),u,v; i<=m; ++i) {\n\t\tcin>>u>>v;\n\t\tif(u==v)cout<<-1,exit(0);\n\t\t//\u5224\u65ad\u81ea\u73af \n\t\tadd_kano(u,v);\n\t\t++In[v];\n\t}\n\tTopo();\n\tif(cnt<n)cout<<-1,exit(0);\n\t//\u5224\u65ad\u8d1f\u73af \n\tfor(ri i(1); i<=n; ++i) {\n\t\tfor(ri j(1); j<=26; ++j) {\n\t\t\tans=max(ans,dp[i][j]);\n\t\t\t//\u66b4\u529b\u627e max \n\t\t}\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1632384522,
        "uid": 414386,
        "name": "Isshiki\u00b7Iroha",
        "ccfLevel": 6,
        "title": "CF919D"
    },
    {
        "content": "# CF919D\u9898\u89e3\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u90fd\u53ea\u6709\u4e00\u4e2a\u72b6\u6001\uff0c\u800c\u4e14\u5bf9\u4e8e\u6574\u5f20\u56fe\u6700\u591a\u53ea\u670926\u4e2a\u72b6\u6001\uff08\u5373\u6240\u6709\u5c0f\u5199\u5b57\u6bcd\u7684\u603b\u6570\uff09\u3002\n\n\u518d\u770b\u6570\u636e\u8303\u56f4\uff0c$ n $ \u7684\u8303\u56f4 $ 3e5 $\uff0c\u641c\u7d22\u80af\u5b9a\u662f\u4e0d\u884c\u7684\u3002\u5728\u72b6\u6001\u6570\u91cf\u90a3\u4e48\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u72b6\u6001\u662f\u5f88\u597d\u8868\u793a\u7684\u3002\u4e3a\u4e86\u65b9\u4fbf\u6570\u7ec4\u5b58\u50a8\uff0c\u53ef\u4ee5\u7528 $ idx_i = tmp - 'a\\ ' + 1 $ \u8868\u793a\uff08$ tmp $ \u662f $ i $ \u53f7\u8282\u70b9\u7684\u5b57\u6bcd\uff09\u3002\u8fd9\u6837\u4e00\u6765\uff0c$ a - z $ \u53ef\u4ee5\u8f6c\u5316\u4e3a $ 1 - 26 $ \u8fd926\u4e2a\u6570\u5b57\u3002\n\n\u6211\u4eec\u8003\u8651\u4f7f\u7528**DP**\uff1a\u5f00\u4e00\u4e2a\u6570\u7ec4 $ dp_{i,j} $ \u8868\u793a\u5f53\u8d70\u5230 $ i $ \u70b9\u65f6\u5b57\u6bcd $ j $ \u7684\u6700\u5927\u51fa\u73b0\u6b21\u6570\u3002\u5f53\u7136\uff0c\u7ecf\u8fc7\u4e86\u524d\u9762\u7684\u5206\u6790\uff0c$ j $ \u662f\u4f7f\u7528\u6570\u5b57\u8868\u793a\u7684\u3002\n\n\u5e94\u5f53\u5728\u8bfb\u5165\u6bcf\u4e2a\u70b9\u7684\u5b57\u6bcd\u65f6\u521d\u59cb\u5316 dp \u6570\u7ec4\uff0c\u4f7f\u5f97\u8def\u5f84 \u201c $ x -> x $ \u201d \u4e0a\u5b57\u6bcd $ idx_x $ \u7684\u51fa\u73b0\u6b21\u6570\u4e3a $ 1 $\u3002\n\n\u7531\u4e8e\u8fd9\u5f20\u56fe\u662f**\u6709\u5411\u56fe**\uff0c\u4e3a\u4e86\u6ee1\u8db3\u52a8\u6001\u89c4\u5212\u7684**\u65e0\u540e\u6548\u6027**\uff0c\u8003\u8651\u4f7f\u7528**\u62d3\u6251\u6392\u5e8f**\u8fdb\u884cdp\u3002\n\n\u8bbe\u5f53\u524d\u64cd\u4f5c\u662f\u4ece\u8282\u70b9 $ x $ \u8d70\u5411\u8282\u70b9 $ y $\uff0c\u6211\u4eec\u5206\u4e24\u79cd\u60c5\u51b5\u8003\u8651\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n-\t\u82e5 $ idx_y = j $\uff0c\u5373\u8282\u70b9 $ y $ \u7684\u5b57\u6bcd\u548c\u73b0\u5728\u626b\u63cf\u5230\u7684\u5b57\u6bcd\u76f8\u540c\uff0c\u90a3\u4e48\u8d70\u5230 $ y $ \u540e\uff0c\u8fd9\u4e2a\u5b57\u6bcd\u7684\u51fa\u73b0\u6b21\u6570\u8981\u52a0\u4e00\u3002\u5373\uff1a$ dp_{y,j} = max $ { $ dp_{y,j} , dp_{x,j} + 1 $ } \u3002\n\n-\t\u540c\u7406\uff0c\u82e5\u5b57\u6bcd\u4e0d\u540c\uff0c\u6b21\u6570\u4e0d\u5fc5\u52a0\u4e00\u3002\u5373\uff1a$ dp_{y,j} = max $ { $ dp_{y,j} , dp_{x,j} $ } \u3002\n\n\u5728\u8fdb\u884c\u62d3\u6251\u6392\u5e8f\u65f6\u8fdb\u884c\u72b6\u6001\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u5f53\u7136\uff0c\u8fd8\u8981\u8003\u8651\u8f93\u51fa $ -1 $ \u7684\u60c5\u51b5\u3002\u53ef\u5728\u62d3\u6251\u6392\u5e8f\u8fc7\u7a0b\u4e2d\u5f00\u4e00\u4e2a\u8ba1\u6570\u5668 $ sum $\uff0c\u6bcf\u6709\u4e00\u4e2a\u5143\u7d20\u51fa\u961f\u5c31\u52a0\u4e00\uff0c\u6700\u540e\u5224\u65ad\u5b83\u662f\u5426\u5c0f\u4e8e $ n $\uff0c\u5982\u679c\u5c0f\u4e8e\uff0c\u5219\u8bf4\u660e\u6709\u73af\uff0c\u8f93\u51fa $ -1 $ \u5c31\u884c\u4e86\u3002\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff08\u8be6\u60c5\u89c1\u6ce8\u91ca\uff09\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <queue>\n#include <vector>\n#define re register int\nusing namespace std;\n\nconst int MAXN=3e5+1;\nint n,m,ans,sum,idx[MAXN],in[MAXN],dp[MAXN][27];\nvector <int> E[MAXN];\nqueue <int> q;\n\ninline int read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}\n\twhile (isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n\treturn x*f;\n}\n\nint main()\n{\n\tn=read(),m=read();\n\t\n\tfor(re i=1;i<=n;i++)\n\t{\n\t\tchar tmp=getchar();  //\u8fd9\u6837\u8bfb\u5165\u901f\u5ea6\u66f4\u5feb \n\t\tidx[i]=tmp-'a'+1;  //\u4e5f\u53ef\u4ee5\u5199tmp-95 \n\t\tdp[i][idx[i]]++;  //\u521d\u59cb\u5316 \n\t}\n\t\n\tfor(re i=1;i<=m;i++)\n\t{\n\t\tre x=read(),y=read();\n\t\tE[x].push_back(y);  //\u7528vector\u5b58\u8fb9 \n\t\tin[y]++;  //\u7edf\u8ba1\u5165\u5ea6 \n\t}\n\t\n\tfor(re i=1;i<=n;i++)\n\t\tif(!in[i])\n\t\t\tq.push(i);\n\twhile(!q.empty())\n\t{\n\t\tre x=q.front();\n\t\tq.pop();\n\t\tin[x]=-1;  //\u5220\u70b9 \n\t\tsum++;\n\t\tfor(re i=0;i<E[x].size();i++)\n\t\t{\n\t\t\tre y=E[x][i];\n\t\t\tfor(re j=1;j<=26;j++)\n\t\t\t{\n\t\t\t\tif(idx[y]==j)\n\t\t\t\t\tdp[y][j]=max(dp[y][j],dp[x][j]+1);\n\t\t\t\telse\n\t\t\t\t\tdp[y][j]=max(dp[y][j],dp[x][j]);\n\t\t\t}//\u72b6\u6001\u8f6c\u79fb \n\t\t\tin[y]--;\n\t\t\tif(!in[y])\n\t\t\t\tq.push(y);\n\t\t}\n\t}//\u62d3\u6251\u57fa\u672c\u64cd\u4f5c \n\t\n\tif(sum<n)\n\t{\n\t\tprintf(\"-1\");\n\t\treturn 0;\n\t}//The value can be arbitrarily large\n\t\n\tfor(re i=1;i<=n;i++)\n\t\tfor(re j=1;j<=26;j++)\n\t\t\tans=max(ans,dp[i][j]);  //\u7531\u4e8e\u8fd9\u6761\u8def\u5f84\u53ef\u4ee5\u5728\u4efb\u610f\u70b9\u51fa\u53d1\uff0c\u4efb\u610f\u70b9\u7ed3\u675f\uff0c\u56e0\u6b64\u5728dp\u5b8c\u6bd5\u540e\u8fd8\u8981\u50cf\u8fd9\u6837\u8ba1\u7b97\u7b54\u6848 \n\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n\n\u8c22\u8c22\u89c2\u770b~",
        "postTime": 1597750859,
        "uid": 177531,
        "name": "ZolaWatle",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF919D \u3010Substring\u3011"
    },
    {
        "content": "\u770b\u5230\u8fd9\u662f\u4e00\u4e2a\u9ec4\u9898\uff0c\u6211\u4e00\u5f00\u59cb\u4ee5\u4e3a\u4e00\u904d $dfs$ \u5c31\u53ef\u4ee5\u8279\u8fc7\u53bb\u4e86\uff0c\u76f4\u5230\u6211\u53d1\u73b0\u8fde\u975e\u6781\u9650\u6570\u636e\u90fd\u80fdT\u98de...\n\n\u6211\u4eec\u53d1\u73b0\u6743\u503c\u53ea\u6709 $26$ \u4e2a\u5c0f\u5199\u5b57\u6bcd\uff0c\u90a3\u4e48\u72b6\u6001\u5f88\u597d\u8868\u793a\uff0c\u8003\u8651 $dp$\u3002\n\n\u8bb0 $f_{i,j}$ \u8868\u793a\u5728 $i$ \u8fd9\u4e2a\u70b9\uff0c\u5b57\u6bcd $j$ \u7684\u7b54\u6848\u3002\n\n\u5bb9\u6613\u60f3\u5230\u53ef\u4ee5\u7528 $0...25$ \u5206\u522b\u8868\u793a $a...z$\u3002\n\n\u8003\u8651\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n\u5bf9\u4e8e\u4e00\u6761\u8fb9 $(u,v)$\uff0c\u6709 $f_{v,j}$ $=$ $max$ $($ $f_{v,j}$ $,$ $f_{u,j}$ $+$ $(ch_v-'a'=j)$ $)$\n\n\u5176\u4e2d $ch$ \u6570\u7ec4\u4ee3\u8868\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u662f\u4ec0\u4e48\uff0c$(ch_v-'a'=j)$  \u8868\u793a\u7684\u662f\uff0c\u5982\u679c\u62ec\u53f7\u4e2d\u7684\u6761\u4ef6\u4e3a\u771f\uff0c\u503c\u4e3a $1$\uff0c\u5426\u5219\u4e3a $0$\u3002\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\u8981\u8003\u8651\u7684\u5c31\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5c06\u8981\u88ab\u66f4\u65b0\u7684 $v$\uff0c\u90fd\u8981\u4fdd\u8bc1\u80fd\u66f4\u65b0\u5b83\u7684\u70b9\u5df2\u7ecf\u88ab\u66f4\u65b0\u4e86\u3002\u8fd9\u65f6\u5019\u60f3\u5230\u62d3\u6251\u6392\u5e8f\u3002\n\n```cpp\n\u62d3\u6251\u6392\u5e8f\u4f7f\u5f97\u56fe\u4e2d\u4efb\u610f\u4e00\u5bf9\u9876\u70b9u\u548cv\uff0c\u82e5\u8fb9<u,v>\u2208E(G)\uff0c\u5219u\u5728\u7ebf\u6027\u5e8f\u5217\u4e2d\u51fa\u73b0\u5728v\u4e4b\u524d\u3002 \u2014\u2014\u767e\u5ea6\u767e\u79d1\n```\n\u60f3\u5230\u4e86\u8fd9\u4e9b\uff0c\u4ee3\u7801\u5c31\u5f88\u597d\u5199\u4e86\u3002\n\ncode\uff1a\n```cpp\ninclude\"bits/stdc++.h\"\nusing namespace std;\n#define ll long long\n#define ul unsigned long long\n#define ui unsigned int\n#define ri register int\ninline int read(){\n\tint x=0,flag=1;\n\tchar ch=getchar()\uff1b\n\twhile(ch<'0'||ch>'9'){if(ch=='-') flag=-1;ch=getchar()\uff1b}\n\twhile(ch>='0'&&ch<='9'){x=x*10+(ch^48);ch=getchar();}\n\treturn x*flag;\n}\nint n,m\uff0chead[300010],ans,wl,flag\uff0cin[300010],f[300010][26];\nchar ch[300010];\nstruct node{\n\tint nxt,to;\n}star[300010];\ninline void add(int x,int y){\n\twl++;\n\tstar[wl].to=y;\n\tstar[wl].nxt=head[x]\uff1b\n\thead[x]=wl;\n}\nint main()\n{\n\tn=read(),m=read();\n\tscanf(\"%s\",ch+1);\n\tfor(ri i=1;i<=m;++i)\n\t{\n\t\tint x,y;\n\t\tx=read(),y=read();\n\t\tif(x==y)\n\t\t{\n\t\t\tcout<<-1;\n\t\t\treturn 0;\n\t\t}\n\t\tadd(x,y);\n\t\tin[y]++;\n\t}\n\tqueue<int> q;\n\tfor(ri i=1;i<=n;++i)\n\tif(!in[i])\n\t{\n\t\tq.push(i);\n\t\tf[i][ch[i]-'a']++;\n\t}\n\tint cnt = 0 , flag = 1;\n\twhile(!q.empty())\n\t{\n\t\tint u = q.front();q.pop()\n\t\tfor(ri i=head[u];i;i=star[i].nxt)\n\t\t{\n\t\t\tint v = star[i].to;\n\t\t\tfor(ri j=0;j<26;++j)\n\t\t\tf[v][j] = max(f[v][j],f[u][j] + ((ch[v]-'a'==j)?1:0));\n\t\t\tin[v]--;\n\t\t\tif(in[v]==0) q.push(v);\n\t\t}\n\t\tcnt++;\n\t}\n\tif(cnt<n)\n\t{\n\t\tcout<<-1\uff1b\n\t\treturn 0;\n\t}\n\tfor(ri i=1;i<=n;++i)\n\tfor(ri j=0;j<26;++j)\n\tans = max(ans,f[i][j]);\n\tcout<<ans;\n   \treturn 0\uff1b\n}\n```\n",
        "postTime": 1582271232,
        "uid": 135839,
        "name": "Fairicle",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF919D \u3010Substring\u3011"
    }
]