[
    {
        "content": "\u6709\u9053\u662f \n```cpp\n\u7b97\u6cd5\u5c31\u662f\u4f18\u5316\u7684\u66b4\u529b\n``` \n\u90a3\u4e48\u6211\u4eec\u5148\u4ece\u66b4\u529b\u5f00\u59cb\u8bf4\u8d77(\u771f\u7684\u662f\u6700\u88f8\u7684\u66b4\u529bqwq).\n\n\u9996\u5148\u8fd9\u662f\u68f5\u6811,\u5f88\u663e\u7136\u91c7\u7528\u94fe\u5f0f\u524d\u5411\u661f\u5efa\u8fb9.\u7136\u540e\u6211\u4eec\u89c2\u5bdf\u9898\u9762\n![qwq](https://s2.ax1x.com/2019/02/10/kaS9xJ.png)\n\u663e\u7136,\u6211\u4eec\u9700\u8981\u77e5\u9053dis[u][v]\u7684\u503c,\u90a3\u4e48,\u600e\u4e48\u6c42\u4ed6\u4eec\u7684\u8def\u5f84\u5462?\n\n\u5b66\u4e86\u56fe\u8bba\u7684\u5e94\u8be5\u90fd\u77e5\u9053Dijkstra\u7684\u4f18\u79c0,\u90a3\u6211\u4eec\u5c31\u91c7\u7528Dijkstra\u5427!\n\n\u8dd1\u4e00\u904d\u6700\u77ed\u8def,\u7531\u4e8eDijkstra\u6c42\u7684\u662f\u5355\u6e90\u6700\u77ed\u8def,\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u4e86\u4ece\u6839\u8282\u70b91\u5230\u6bcf\u4e2a\u5b50\u8282\u70b9\u7684\u8ddd\u79bb.\u90a3\u4e48\u95ee\u9898\u6765\u4e86\n\n**tm\u6211\u4eec\u8981\u7684\u662fdis[u][v] \u4f60tm\u6c42\u4e2adis[1][k]\u6709\u4e2a\u5c41\u7528\u554a?!**\n![qwq](https://s2.ax1x.com/2019/02/10/kaSlqI.png)\n\n\u7a0d\u5b89\u52ff\u8e81,\u6211\u4eec\u5148\u770b\u4e00\u68f5\u7b80\u5355\u7684\u6811\n![qwq](https://s2.ax1x.com/2019/02/10/kaSEa6.png)\n\u5982\u679c\u6211\u4eec\u73b0\u5728\u5df2\u77e5\u6839\u8282\u70b9\u5230\u4efb\u610f\u8282\u70b9\u7684\u5355\u6e90\u6700\u77ed\u8def,\u60f3\u6c42\u4efb\u610f\u5b50\u8282\u70b9\u548c\u7236\u8282\u70b9\u7684\u8ddd\u79bb\u600e\u4e48\u529e?\n\u5c31\u8fd9\u4e48\u529e!\n![qwq](https://s2.ax1x.com/2019/02/10/kaSVIK.png)\n\n\u7ea2\u8272\u7684\u662f\u6839\u8282\u70b9,\u7eff\u8272\u662f\u7236\u8282\u70b9,\u84dd\u8272\u662f\u5b50\u8282\u70b9.\n\u4e0d\u96be\u53d1\u73b0,dis[blue][green] = dis[red][blue] - dis[red][green]!\n\u90a3\u4e48\u6211\u4eec\u7684\u5355\u6e90\u6700\u77ed\u8def\u6709\u7528\u4e86!\n---\u63a5\u4e0b\u6765\u5462?\n\u5f53\u7136\u662f\u627e\u6bcf\u4e2a\u70b9\u63a7\u5236\u7684\u70b9\u5566!\n---\u600e\u4e48\u627e\u5462?\n\u5f00\u4e2afather\u6570\u7ec4\u628a\u6bcf\u4e2a\u70b9\u7684\u76f4\u63a5\u7236\u4eb2\u8bb0\u5f55\u4e0b\u6765,\u94fe\u5f0f\u904d\u5386\u6c42\u6bcf\u4e2a\u70b9\u63a7\u5236\u7684\u4e2a\u6570\u554a!\n\u5c31\u50cf\u8fd9\u6837\n```\ninline void isFa(int now,int son)\n{\n    rg int f = fa[now];\n    if (!f) return;\n    if (dis[son] - dis[f] <= pos[son])\n    {\n        ++ans[f];\n        isFa(f,son);\n    }\n}\n\n```\n\u662f\u4e0d\u662f\u5f88\u7b80\u7565\u554aqwq\n\u90a3\u4e48\u628a\u4e0a\u8ff0\u90e8\u5206\u62fc\u51d1\u4e00\u4e0b,\u6211\u4eec\u7684\u4ee3\u7801\u5c31\u51fa\u7089\u5566\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#include <cstring>\n#include <algorithm>\n#include <queue>\nusing namespace std;\n#define rg register\n#define LL long long\nconst int maxn = 233333;\ntemplate <typename qwq> inline void read(qwq & x)\n{\n    x = 0;\n    rg int f = 1;\n    rg char c = getchar();\n    while (c < '0' || c > '9')\n    {\n        if (c == '-') f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9')\n    {\n        x = (x << 1) + (x << 3) + (c ^ 48);\n        c = getchar();\n    }\n    x *= f;\n}\ntemplate <typename qaq> inline void print(qaq x)\n{\n    if (x < 0)\n    {\n        putchar('-');\n        x = -x;\n    }\n    if (x > 9) print(x / 10);\n    putchar(x % 10 + '0');\n}\nstruct edge\n{\n    int v,w,next;\n}e[maxn];\nint tot,head[maxn];\ninline void add(int x,int y,int z)\n{\n    ++tot;\n    e[tot].v = y;\n    e[tot].w = z;\n    e[tot].next = head[x];\n    head[x] = tot;\n}\nint dis[maxn],ans[maxn],fa[maxn],pos[maxn];;\nbool vis[maxn];\npriority_queue <int,vector<int>,greater<int> > heap;\ninline void dijkstra()\n{\n    memset(dis,0x3f,sizeof dis);\n    dis[1] = 0;\n//\tvis[1] = 1;\n    heap.push(1);\n    while (!heap.empty())\n    {\n        rg int x = heap.top();\n        heap.pop();\n        if (vis[x]) continue;\n        vis[x] = true;\n        for (rg int i = head[x];i;i = e[i].next)\n        {\n            rg int v = e[i].v,w = e[i].w;\n            if (dis[x] + e[i].w < dis[v])\n            {\n                dis[v] = dis[x] + e[i].w;\n                heap.push(v);\n            }\n        }\n    }\n}\ninline void isFa(int now,int son)\n{\n    rg int f = fa[now];\n    if (!f) return;\n    if (dis[son] - dis[f] <= pos[son])\n    {\n        ++ans[f];\n        isFa(f,son);\n    }\n}\ninline void dfs(int x,int fa)\n{\n    for (rg int i = head[x];i;i = e[i].next)\n    {\n        rg int v = e[i].v;\n//\t\tprintf(\"Test x:%d,v:%d,fa:%d\\n\",x,v,fa);\n//\t\tsystem(\"pause\");\n        if (v == fa) continue;\n        dfs(v,x); \n        if (dis[v] - dis[x] <= pos[v])\n        {\n            ++ans[x];\n            isFa(x,v);\n        }\n    }\n}\nint n,m,x,y,z;\nint main()\n{\n//\tfreopen(\"tree.in\",\"r\",stdin);\n//\tfreopen(\"tree.out\",\"w\",stdout);\n    read(n);\n    for (rg int i = 1;i <= n;++i) read(pos[i]);\n    for (rg int i = 2;i <= n;++i)\n    {\n        read(x),read(y);\n        add(x,i,y);\n        fa[i] = x;\n    }\n    fa[1] = 0;\n    dijkstra();\n    dfs(1,0);\n    for (rg int i = 1;i <= n;++i)\n    {\n        print(ans[i]),putchar(' ');\n    }\n}\n```\n\u7136\u540e\u5f00\u5fc3\u7684submit\n![qwq](https://s2.ax1x.com/2019/02/10/kaSirR.png)\n![qwq](https://s2.ax1x.com/2019/02/10/kaSgWF.png)\n\n\n\u600e\u4e48\u529e\u4e00\u5b9a\u662f\u6570\u636e\u592a\u5f3a\u4e86\n\n\u6211\u4eec\u8003\u8651\u4f18\u5316\u4e00\u4e0b\u5427...\n\n\u9996\u5148!**\u6839\u672c\u4e0d\u7528Dijkstra!** \u6211\u4eec\u8fd9\u662f\u68f5\u6811,\u4e3a\u4ec0\u4e48\u4e0d\u5728dfs\u7684\u65f6\u5019\u628a\u7236\u4eb2\u8282\u70b9\u7684\u4fe1\u606f\u62ff\u8fc7\u6765\u7528\u5462?!\n\n\u76f4\u63a5\u8fb9\u8dd1dfs\u8fb9\u6c42dis\u4e0d\u5c31\u7684\u4e86\u5417qwq\n\n\u7136\u540e\u8fd9\u4e2a\u904d\u5386\u6c42\u63a7\u5236\u7684\u8282\u70b9\u6570,\u4e07\u4e00\u6211\u4e00\u68f5\u6811\u90fd\u80fd\u88ab\u6839\u8282\u70b9\u63a7\u5236\u6211\u5c82\u4e0d\u662f\u8981\u904d\u53861mol\u6b21\u8fd9\u68f5\u6811?!\n\n\u8ba9\u6211\u4eec\u601d\u8003\u4e00\u4e0b,\u4f18\u5316\u8fd9\u79cd\u904d\u5386\u6b21\u6570\u4e00\u822c\u7528\u4ec0\u4e48\u65b9\u6cd5\u5462emm..\n\n\u5bf9\u4e86!\u4e8c\u5206\u548c\u500d\u589e\u561b!\n\n\u7531\u4e8e\u6211\u4eec\u7ecf\u5e38\u7528\u4e8c\u5206,\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u4e8c\u5206\u7b97\u6cd5.\n\n\u9996\u5148\u4ece\u5b50\u8282\u70b9\u51fa\u53d1,\u6211\u4eec\u9700\u8981\u627e\u5230dis[1][son],\u7136\u540e\u9664\u4ee5\u4e8c,\u8fd9\u4e2a\u70b9\u5c31\u662fmid\u4e86,l\u662f\u5b50\u8282\u70b9,r\u662f\u6839\u8282\u70b9(1).\u597d\u7684,\u5230son\u7684\u8ddd\u79bb\u5927\u7ea6\u4e3adis[1][son] / 2\u7684\u8282\u70b9\u662f...\u4e0d\u614c\u6211\u904d\u5386\u4e00\u6b21\u4e0d\u5c31\u77e5\u9053\u4e86\u5417qwq.\n\n\u7b49\u7b49,\u904d\u5386.....\n\n~~\u597d\u7684\u6211\u4eec\u8fd8\u662f\u8003\u8651\u500d\u589e\u7b97\u6cd5\u5427~~\n\n\u500d\u589e\u5176\u5b9e\u633a\u597d\u5b9e\u73b0,\u7531\u4e8e\u6211\u4eec\u662f\u59cb\u7ec8\u53ea\u770b\u5f53\u524d\u70b9\u7684father\u8282\u70b9,\u6240\u4ee5\u627e\u5230\u6700\u540e\u80af\u5b9a\u662f\u6839\u8282\u70b9,\u90a3\u4e48\u8fd9\u6837\u904d\u5386\u51fa\u6765\u5176\u5b9e\u5c31\u662f\u4e2a\u957f\u957f\u7684\u8fb9\u800c\u5df2(\u81ea\u5df1\u753b\u56fe\u7406\u89e3\u6211\u61d2\u5f97\u753b\u4e86qwq)\n\n\u4ece\u5b50\u8282\u70b9\u51fa\u53d1,\u7531p = 1(\u500d\u589e\u500d\u6570)\u5f00\u59cb\u500d\u589e,\u627e\u5230\u4e00\u4e2a\u70b9,\u82e5\u5f53\u524d\u70b9\u53ef\u4ee5\u5b9e\u73b0,\u5219\u66f4\u65b0\u5f53\u524d\u8282\u70b9\u5e76\u7ee7\u7eed\u5411\u4e0a\u500d\u589e,\u4e0d\u884c\u7684\u8bdd\u5219\u7f29\u5c0f\u4e3ap / 2,\u7531\u66f4\u65b0\u540e\u7684\u8282\u70b9\u7ee7\u7eed\u500d\u589e.\u65f6\u95f4\u590d\u6742\u5ea6\u7c7b\u4f3c\u4e8e\u4e8c\u5206.\n\n\u597d\u4e86\u6700\u540e\u80fd\u4f18\u5316\u7684\u4e5f\u5c31\u662f\u4e00\u4e2a\u4e00\u4e2a\u52a0\u592a\u6162\u4e86.\u90a3\u4e48\u6709\u6ca1\u6709\u4e00\u6b3e\u80fd\u5b9e\u73b0\u533a\u95f4\u4fee\u6539\u7684\u6570\u636e\u7ed3\u6784\u5462?\n\n\u5bf9,\u7ebf\u6bb5\u6811!\n\n\u6211\u4eec\u8003\u8651\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u5957\u7ebf\u6bb5\u6811\u5e76\u8fdb\u884c\u533a\u95f4\u66f4\u65b0.\n\n\u7b49\u7b49,\u6211\u4eec\u8fd9\u4e2a\u6811\u4e0a\u7684\u8282\u70b9\u7f16\u53f7\u597d\u50cf\u5e76\u4e0d\u662f\u8fde\u7eed\u7684...\n\n~~\u597d\u7684\u6211\u4eec\u60f3\u4e00\u4e0b\u5176\u4ed6\u529e\u6cd5\u5427~~\n\n\u60f3\u60f3\u6211\u4eec\u662f\u4e0d\u662f\u5b66\u8fc7\u5dee\u5206\u6570\u7ec4\u4e86,\u5bf9,\u6211\u4eec\u5c31\u7528\u6811\u4e0a\u5dee\u5206\u5b9e\u73b0\u5427!\n\n\u672c\u9898\u6240\u7528\u7684\u6811\u4e0a\u5dee\u5206\u5176\u5b9e\u662f\u7b80\u5316\u7248\u7684,\u56e0\u4e3a\u6211\u4eec\u6240\u6709\u7684\u8282\u70b9\u90fd\u662f\u5728\u6839\u8282\u70b9(1)\u5230son\u8282\u70b9\u8fd9\u6761\u8fb9\u4e0a,\u4e0d\u5fc5\u518d\u8d39\u5fc3\u601d\u6c42\u4ec0\u4e48\u4e24\u70b9\u7684LCA\u518d\u8fdb\u884c\u5dee\u5206.\n\n\u4e3e\u4e2a\u6817\u5b50\n![qwq](https://s2.ax1x.com/2019/02/10/kaSFq1.png)\n\n\u6bd4\u5982\u6211\u4eec\u539f\u6765\u6240\u6709\u8282\u70b9\u90fd\u4ee3\u88680,\u6211\u4eec\u60f3\u5728\u4eceblue\u5230red\u7684\u5730\u65b9+ 1.\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u7528\u5728blue\u8fd9\u4e2a\u70b9\u4e0a+ 1,\u5728green\u8fd9\u4e2a\u70b9- 1,\u4eceblue\u5230red\u6c42\u4e00\u6b21\u524d\u7f00\u548c,\u7528\u524d\u7f00\u548c\u4ee3\u8868\u6bcf\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\u5373\u53ef.\n\n\u62ff\u51fa\u8349\u7a3f\u7b97\u4e00\u4e0b,\u662f\u4e0d\u662f\u521a\u597d+ 1\u5440qwq\n\n\u90a3\u4e48\u8fd9\u91cc\u4e5f\u89e3\u51b3\u4e86.\n\n\u597d\u4e86,\u4e0a\u6700\u7ec8\u4ee3\u7801!\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#include <cstring>\n#include <algorithm>\n#include <queue>\nusing namespace std;\n#define rg register\n#define LL long long\n#define __space putchar(' ')\n#define __endl putchar('\\n')\ntemplate <typename qwq> inline void read(qwq & x)\n{\n    x = 0;\n    rg int f = 1;\n    rg char c = getchar();\n    while (c < '0' || c > '9')\n    {\n        if (c == '-') f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9')\n    {\n        x = (x << 1) + (x << 3) + (c ^ 48);\n        c = getchar();\n    }\n    x *= f;\n}\ntemplate <typename qaq> inline void print(qaq x)\n{\n    if (x < 0)\n    {\n        putchar('-');\n        x = -x;\n    }\n    if (x > 9) print(x / 10);\n    putchar(x % 10 + '0');\n}\nstruct edge\n{\n    int v,w,next;\n}e[233333 << 1];\nint tot,head[233333 << 1],ans[233333],a[233333],bz[233333][19];\n//=================================================================\ninline void add(int x,int y,int z)\n{\n    ++tot;\n    e[tot].v = y;\n    e[tot].w = z;\n    e[tot].next = head[x];\n    head[x] = tot;\n}\nLL dep[233333];\ninline void dfs(int x,int fa,int w)\n{\n    bz[x][0] = fa;\n    dep[x] = dep[fa] + w;\n    for (rg int i = 1;i <= 18;++i)\n    {\n        bz[x][i] = bz[bz[x][i - 1]][i - 1];\n    }\n    for (rg int i = head[x];i;i = e[i].next)\n    {\n        rg int v = e[i].v,ww = e[i].w;\n        if (v == fa) continue;\n        dfs(v,x,ww);\n        rg int pp = pos[v];\n        if (ww > pp) continue;\n        //=================================================================\n        rg int p = 1;\n        while(p && v)\n        {\n            if (dep[v] - dep[bz[v][p]] <= pp)\n            {\n                pp -= dep[v] - dep[bz[v][p]];\n                v = bz[v][p];\n                p <<= 1;\n            }\n            else p >>= 1;\n        }\n        if (dep[v] - dep[bz[v][0]] <= pp) v = bz[v][0];\n        --ans[bz[v][0]],++ans[bz[e[i].v][0]];\n        //=================================================================\n    }\n    ans[fa] += ans[x];\n}\n//=================================================================\nint n,m,x,y,z;\nint main()\n{\n    read(n);\n    for (rg int i = 1;i <= n;++i)\n    {\n    \tread(a[i]);\n\t}\n    for (rg int i = 2;i <= n;++i)\n    {\n        read(x),read(y);\n        add(x,i,y);\n        add(i,x,y);\n    }\n    dfs(1,0,0);\n    for (rg int i = 1;i <= n;++i)\n    {\n        print(ans[i]),putchar(' ');\n    }\n}\n```\nSubmit...\n\n![qwq](https://s2.ax1x.com/2019/02/10/kaSAVx.png)\n\n![qwq](https://s2.ax1x.com/2019/02/10/kaS5e1.png)\nAC\u4e86qwq",
        "postTime": 1549805049,
        "uid": 118272,
        "name": "\u304f\u308d\u306d\u3053",
        "ccfLevel": 0,
        "title": "[CF739B] Alyona and a tree \u9898\u89e3\u62a5\u544a"
    },
    {
        "content": "### [CF739B](https://www.luogu.com.cn/problem/CF739B)\n\n\u7b97\u6cd5\uff1a\u6811\u4e0a\u5dee\u5206+\u500d\u589e\n\n### Meaning\n\n\u7ed9\u4f60\u4e00\u68f5\u6811\uff0c\u5373 $n-1$ \u6761\u8fb9\u548c\u8fb9\u6743\u548c\u70b9\u6743\uff0c\u95ee\u4f60\u5bf9\u4e8e\u6bcf\u4e2a $u(1 \\leq u \\leq n)$ \uff0c\u6240\u6709\u5728 $u$ \u7684**\u5b50\u6811**\u4e2d\u7684 $v$ \uff0c\u8ddd\u79bb\u5b83\u7684\u8ddd\u79bb\u4e0d\u8d85\u8fc7 $a_v$ \u7684\u8282\u70b9\u6709\u591a\u5c11\u4e2a\uff1f\n\n### Solve\n\n\u53cd\u8fc7\u6765\u601d\u8003\uff0c\u6bcf\u4e2a\u8282\u70b9 $v$ \u4f5c\u7528\u4e8e\u6240\u6709\u5b83\u7684\u7956\u5b97\u8282\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u66b4\u529b $O(N^2)$ \u505a\u8fd9\u9053\u9898\uff0c\u5373 dfs \u904d\u5386\u5230\u6bcf\u4e2a\u8282\u70b9\uff0c\u518d\u4ece\u4e00\u4e2a\u4e00\u4e2a\u7956\u5b97\u4f9d\u6b21\u5f80\u4e0a\u627e\uff0c\u8fdb\u884c\u4fee\u6539\u7b54\u6848\uff0c\u4f46\u662f\u5bf9\u4e8e $2*10^5$ \u7684\u6570\u636e\u663e\u7136\u8fc7\u4e0d\u53bb\u3002\n\n\u90a3\u5c31\u7528\u500d\u589e\uff0c\u5b58\u50a8\u6bcf\u4e2a\u8282\u70b9\u7684 $2^p(0 \\leq p \\leq log_2(N) )$ \u7684\u7956\u5b97\uff0c\u56e0\u4e3a\u9898\u76ee\u4e2d\u6709\uff1a\n\n> \u7b2c $i$ \u884c\u5305\u542b\u6574\u6570 $p_i,w_i$ $(1\\leq p_i \\leq n,1 \\leq w \\leq 10^9)$\n\n\u6211\u4eec\u6ce8\u610f\u5230\u6bcf\u6761\u8fb9\u7684\u8fb9\u6743\u662f\u6b63\u6570\uff0c\u6240\u4ee5\u5fc5\u7136\u6709\uff1a\n\n$$dist(fathers[u],v)>dist(u,v)(u \\neq root)$$\n\n\u5373\u6bcf\u6761\u4ece $v$ \u5230 $v$ \u7684\u7956\u5b97\u7684\u8def\u5f84\u7684\u8fb9\u6743\u548c\u4e00\u5b9a\u662f\u4e25\u683c\u5355\u8c03\u9012\u589e\u7684\uff0c\u8fd9\u6837\u505a\u5c31\u53ef\u4ee5\u4f18\u5316\u4e86\u5f80\u4e0a\u627e\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u56e0\u4e3a\u53ea\u8981\u627e\u5230\u7b2c\u4e00\u4e2a\u7956\u5b97\u662f\u4e0d\u6ee1\u8db3\u9898\u76ee\u7684\u6761\u4ef6\uff0c\u90a3\u4e0a\u9762\u7684\u5c31\u4e00\u5b9a\u66f4\u4e0d\u6ee1\u8db3\u4e86\uff0c\u4e0b\u9762\u7684\u80af\u5b9a\u90fd\u6ee1\u8db3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(N \\log_2 N)$ \uff0c\u53ef\u4ee5\u8fc7\u3002\n\n\u4f46\u662f\u4fee\u6539\u7b54\u6848\u5c31\u6ca1\u6cd5\u4e00\u4e2a\u4e00\u4e2a\u4fee\u6539\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u53c8\u642c\u51fa\u65b0\u7684\u5b58\u50a8\u65b9\u5f0f\u2014\u2014\u2014\u2014\u6811\u4e0a\u5dee\u5206\uff0c\u601d\u8def\u5f88\u7b80\u5355\uff0c\u548c\u666e\u901a\u5dee\u5206\u5dee\u4e0d\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u89e3\u91ca\u3002\n\n### Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long//\u53ef\u80fd\u4f1a\u70b8int\nconst int N=2e5+10;\n\nint a,s1[N],head[N],top,fa[N][20],dis[N],x,y,z,ans[N];\nstruct node {\n\tint last,to,dis;\n} s[N];\n\ninline void add(int l1,int l2,int l3) {\n\ts[++top].last=head[l1];\n\ts[top].to=l2;\n\ts[top].dis=l3;\n\thead[l1]=top;\n}\ninline void dfs(int n) {\n\tfor(int i=1; i<=19; i++) fa[n][i]=fa[fa[n][i-1]][i-1];//\u7ef4\u62a4\u500d\u589e\u6570\u7ec4\n\tint now=n;\n//\tcout<<n<<endl;\n\tfor(int i=19; i>=0; i--) {\n\t\tif(fa[now][i]&&dis[n]-dis[fa[now][i]]<=s1[n]) now=fa[now][i];//\u5bfb\u627e\u7b2c\u4e00\u4e2a\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u7956\u5b97\n//\t\tcout<<i<<' '<<now<<' '<<fa[now][i]<<' '<<dis[fa[now][i]]<<endl;\n\t}\n//\tcout<<n<<' '<<now<<endl;\n\tans[fa[now][0]]--;//\u8fdb\u884c\u5dee\u5206\n\tans[fa[n][0]]++;\n\tfor(int i=head[n]; i; i=s[i].last) {\n\t\tdis[s[i].to]=dis[n]+s[i].dis;\n\t\tdfs(s[i].to);\n\t\tans[n]+=ans[s[i].to];//\u7ef4\u62a4\u7b54\u6848\n\t}\n}\nsigned main() {\n//\tfreopen(\"in1.in\",\"r\",stdin);\n\tscanf(\"%lld\",&a);\n\tfor(int i=1; i<=a; i++) scanf(\"%lld\",&s1[i]);\n\tfor(int i=2; i<=a; i++) {\n\t\tscanf(\"%lld%lld\",&fa[i][0],&x);\n\t\tadd(fa[i][0],i,x);\n\t}\n//\tfor(int i=1;i<=a;i++) cout<<i<<' '<<fa[i][0]<<endl;\n//\tcout<<fa[2][0]<<endl;\n\tdfs(1);\n\tfor(int i=1; i<=a; i++) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n\n```\n\n### [$\\color{blue}\\text{My Blog}$](https://www.luogu.com.cn/blog/184549/)",
        "postTime": 1586408595,
        "uid": 184549,
        "name": "RedreamMer",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "\u4fd7\u8bdd\u8bf4\u89e3\u6bcf\u9053\u9898\u90fd\u662f\u4ece\u66b4\u529b\u5f00\u59cb\u7684\u561b  \n\u521a\u62ff\u5230\u8fd9\u9053\u9898\u65f6\uff0c\u6211\u7684\u7b2c\u4e00\u4e2a\u60f3\u6cd5\u662f\u679a\u4e3e\u6bcf\u4e2a\u8d77\u70b9\uff0c\u7136\u540e\u5411\u4e0a\u722c\uff0c\u722c\u5230\u591a\u9ad8\u662f\u591a\u9ad8\uff0c\u63a5\u7740\u6211\u8fc7\u4e86\u6837\u4f8b\uff0c\u6211\u672c\u6765\u4ee5\u4e3a\u53ea\u662fTLE\uff0c\u7ed3\u679c\u76f4\u63a5WA\u6389\u3002     \n\u7136\u800c\u8fd9\u9053\u9898\u7684\u6b63\u89e3\u662f\uff1a\u524d\u7f00\u548c+\u500d\u589e+dfs+\u5dee\u5206  \n\u62ff\u7740\u6bcf\u4e2a\u70b9\uff0c\u5148dfs\u8dd1\u4e00\u4e0b\u6df1\u5ea6\uff0c\u987a\u4fbf\u628aTA\u7684\u500d\u589e\u6570\u7ec4\u9884\u5904\u7406\u597d\uff0c\u7136\u540e\u518d\u500d\u589e\u8dd1\u4e00\u4e0b\u6bcf\u4e00\u4e2a\u70b9\u80fd\u88ab\u63a7\u5236\u7684\u6700\u8fdc\u7956\u5148\uff0c\u5e76\u7528\u5dee\u5206\u6570\u7ec4\u5904\u7406\u4e00\u4e0b\uff0c\u6700\u540e\u518d\u7528dfs\u8dd1\u4e00\u904d\u628a\u4e0b\u8fb9\u7684\u503c\u6536\u4e00\u4e0b\uff08\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u524d\u7f00\u548c\uff09\uff0c\u5c31bingo\u4e86\uff01\n\n~~~\n#include<iostream>\nusing namespace std;\nvoid read(int & x)\n{\n\tx=0;int f=1;char c=getchar();\n\twhile(c>'9'||c<'0') {if(c=='-') f=-1; c=getchar();}\n\twhile(c<='9'&&c>='0')\n\t{x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n\tx*=f;\n}\nvoid print(int x)\n{\n\tif(x<0) {putchar('-');x=-x;}\n\tif(x>9) print(x/10);\n\tputchar(x%10+48);\n}\nint q[200005];\nstruct edge{\n\tint w,to,nxt;\n}e[200005];\nint head[200005],cnt;\nvoid add(int x,int y,int z)\n{\n\tcnt++;\n\te[cnt].w=z;\n\te[cnt].to=y;\n\te[cnt].nxt=head[x];\n\thead[x]=cnt;\n}\nlong long dep[200005];\nint doubly[21][200005],prefix[200005];\nvoid dfs(int s)\t\t//\u9884\u5904\u7406\u4e00\u4e2a\u500d\u589e\u6570\u7ec4 \n{\n\tfor(int i=1;i<=20;i++)\n\t\tdoubly[i][s]=doubly[i-1][doubly[i-1][s]];\n\tfor(int i=head[s];i;i=e[i].nxt)\n\t{\n\t\tint to=e[i].to;\n\t\tdoubly[0][to]=s;\n\t\tdep[to]=dep[s]+e[i].w;\n\t\tdfs(to);\n\t}\n}\nvoid find(int now)\t\t//\u627e\u5230\u6700\u8fdc\u7684\u7956\u5148 \n{\n\tint x=now;\n\tfor(int i=20;i>=0;--i)\n\t\tif(doubly[i][x]&&dep[now]-dep[doubly[i][x]]<=q[now]) \n\t\t\tx=doubly[i][x];\n\tif(x!=1) prefix[doubly[0][x]]--;\n\tif(now!=1) prefix[doubly[0][now]]++;\n\t\n}\nvoid DFS(int x)\n{\n\tfor(int i=head[x];i;i=e[i].nxt)\n\t{\n\t\tint to=e[i].to;\n\t\tDFS(to);\n\t\tprefix[x]+=prefix[to];\n\t}\n}\nint main()\n{\n\tint n;\n\tread(n);\n\tfor(int i=1;i<=n;i++)\n\t\tread(q[i]);\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint k,g;\n\t\tread(k),read(g);\n\t\tadd(k,i,g);\n\t}\n\tdfs(1);\n\tfor(int i=1;i<=n;i++)\t\t//\u66f4\u6539\u5dee\u5206\u6570\u7ec4 \n\t\tfind(i);\n\tDFS(1);\t\t//dfs\u4e00\u904d\u6c42\u524d\u7f00\u548c \n\tfor(int i=1;i<=n;i++)\n\t\tprint(prefix[i]),putchar(' ');\n\treturn 0;\n}\n~~~",
        "postTime": 1546694683,
        "uid": 118707,
        "name": "mol\u8336\u86cb\u7cd5",
        "ccfLevel": 0,
        "title": "CF739B Alyona and a tree   \u9898\u89e3\u62a5\u544a\uff08\u7b2c\u4e00\u7bc7\u9898\u89e3\uff09"
    },
    {
        "content": "# Foreword\n\n\u53d1\u4e00\u7bc7\u6ca1\u4eba\u5199\u7684 cdq \u5206\u6cbb\u7684\u9898\u89e3\u3002\n\n~~\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u601d\u8def\u8fd9\u4e48\u6e05\u5947\uff0c\u603b\u4e4b\u770b\u5230\u504f\u5e8f\u5173\u7cfb\u5c31\u60f3\u5230 cdq \u5206\u6cbb\u4e86\u3002~~\n\n# Problem\n\n\u9898\u610f\u4e5f\u8bf4\u5f97\u5f88\u6e05\u695a\u3002\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u70b9\u6743\u4e3a $a_i$ \uff0c\u8fb9\u6709\u8fb9\u6743\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u70b9\u6c42\u8fd9\u4e2a\u70b9\u5b50\u6811\u4e2d\u8ddd\u79bb\u5b83\u4e0d\u8d85\u8fc7 $a_i$ \u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n# Solution\n\n\u9996\u5148\u770b\u5230\u6700\u540e\u4e00\u53e5\u8bdd\u53ef\u4ee5\u76f4\u63a5\u62bd\u8c61\u6210\u6ee1\u8db3\uff1a $dep_j-dep_i\\le a_j$ \uff0c\u5176\u4e2d $dep$ \u4ee3\u8868\u8fd9\u4e2a\u70b9\u7684\u6df1\u5ea6\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53c8\u53d1\u73b0\u5176\u5b9e\u7b2c\u4e00\u4e2a\u6761\u4ef6\u5c31\u7b49\u4ef7\u4e8e\u53e6\u5916\u4e00\u4e2a\u5e38\u89c1\u7684\u67ff\u5b50\uff0c\u5b66\u8fc7\u6811\u5256\u7684\u540c\u5b66\u5e94\u8be5\u80fd\u5f88\u5feb\u53cd\u5e94\u8fc7\u6765\uff0c\u5c31\u662f\u5982\u679c\u6211\u4eec\u7ed9\u539f\u6811\u6253\u4e0a dfs \u5e8f\uff08\u8bb0\u4e3a $dfn$\uff09\uff0c\u518d\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u8bb0\u4e3a $siz$ \u3002\n\n\u90a3\u4e48\u8fd9\u4e2a\u6761\u4ef6\u53ef\u4ee5\u8868\u793a\u6210\uff1a$dfn_i<dfn_j\\le dfn_i+siz_i$\n\n\u7a0d\u5fae\u53d8\u5f62\u4e00\u4e0b\u4e24\u4e2a\u67ff\u5b50\uff1a\n\n$dep_j-a_j\\le dep_i$ \n\n$dfn_i<dfn_j \\& dfn_j\\le dfn_i+siz_i$\n\n\u7b2c\u4e00\u4e2a\u4f5c\u4e3a\u4e8c\u7ef4\u504f\u5e8f\u7684\u7b2c\u4e00\u7ef4\uff0c\u7b2c\u4e8c\u4e2a\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5dee\u5206\u7136\u540e\u4f5c\u4e3a\u4e8c\u7ef4\u504f\u5e8f\u7684\u7b2c\u4e8c\u7ef4\uff0c\u76f4\u63a5 sort \u7136\u540e cdq\u5206\u6cbb \u5373\u53ef\u89e3\u51b3\u3002\n\n# Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntemplate <typename T>\ninline void read(T &x){\n\tx=0;char ch=getchar();bool f=false;\n\twhile(!isdigit(ch)){if(ch=='-'){f=true;}ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\tx=f?-x:x;\n\treturn ;\n}\ntemplate <typename T>\ninline void write(T x){\n\tif(x<0) putchar('-'),x=-x;\n\tif(x>9) write(x/10);\n\tputchar(x%10^48);\n\treturn ;\n}\n#define ll long long\nconst int N=2e5+5,INF=1e9+7;\nstruct Que{\n\tll d1;int d2,id;\n\tQue(ll d1=0,int d2=0,int id=0):d1(d1),d2(d2),id(id){}\n}Q[N*3],tmp[N*3];\nint head[N],to[N<<1],nex[N<<1],idx;\nint n,m,dfn[N],siz[N],cnt,DFN;\nll dep[N],Ans[N],a[N],val[N<<1];\nvoid dfs(int x,int f){\n\tsiz[x]=1;dfn[x]=++DFN;\n\tfor(int i=head[x];i;i=nex[i]){\n\t\tint y=to[i];\n\t\tif(y==f) continue;\n\t\tdep[y]=dep[x]+val[i];\n\t\tdfs(y,x); \n\t\tsiz[x]+=siz[y];\n\t}\n\tQ[++cnt]=Que(dep[x]-a[x],dfn[x],0);\n\tQ[++cnt]=Que(dep[x],dfn[x],-x);\n\tQ[++cnt]=Que(dep[x],dfn[x]+siz[x]-1,x);\n\treturn ;\n} \n\ninline void add(int u,int v,ll w){nex[++idx]=head[u];to[idx]=v;head[u]=idx;val[idx]=w;}\ninline bool cmp1(const Que &x,const Que &y){\n\tif(x.d1^y.d1) return x.d1<y.d1;\n\tif(x.d2^y.d2) return x.d2<y.d2;\n\treturn x.id<y.id;\n}\nvoid CDQ_Divide(int l,int r){\n\tif(l==r) return ;\n\tint mid=l+r>>1,posl=l,posr=mid+1,pos=l,tot=0;\n\tCDQ_Divide(l,mid),CDQ_Divide(mid+1,r);\n\twhile(posl<=mid&&posr<=r){\n\t\tif(Q[posl].d2<=Q[posr].d2){\n\t\t\tif(Q[posl].id==0) tot++;\n\t\t\ttmp[pos++]=Q[posl++];\n\t\t}\n\t\telse{\n\t\t\tif(Q[posr].id<0) Ans[-Q[posr].id]-=tot;\n\t\t\telse if(Q[posr].id>0) Ans[Q[posr].id]+=tot;\n\t\t\ttmp[pos++]=Q[posr++];\n\t\t}\n\t}\n\twhile(posl<=mid) tmp[pos++]=Q[posl++]; \n\twhile(posr<=r){\n\t\tif(Q[posr].id<0) Ans[-Q[posr].id]-=tot;\n\t\telse if(Q[posr].id>0) Ans[Q[posr].id]+=tot;\n\t\ttmp[pos++]=Q[posr++];\n\t}\n\tfor(int i=l;i<=r;i++) Q[i]=tmp[i];\n\treturn ;\n}\n\nsigned main(){\n\tread(n);\n\tfor(int i=1;i<=n;i++) read(a[i]);\n\tfor(int i=2,x,v;i<=n;i++) read(x),read(v),add(i,x,v),add(x,i,v);\n\tdfs(1,0);\n\tsort(Q+1,Q+cnt+1,cmp1);\n\tCDQ_Divide(1,cnt);\n\tfor(int i=1;i<=n;i++) write(Ans[i]),putchar(' ');\n\treturn 0;\t\n}\n```\n\n\n\n\n\n\n\n",
        "postTime": 1629595564,
        "uid": 555420,
        "name": "GuuGuu",
        "ccfLevel": 0,
        "title": "CF739B Alyona and a tree\u9898\u89e3"
    },
    {
        "content": "\u770b\u5230\u9898\u89e3\u91cc\u9762\u90fd\u662f\u500d\u589e\u7684\u505a\u6cd5\u3002\u6765\u4e00\u4e2a $\\text{dfn}$ \u5e8f + $\\text{BIT}$ \u7684\u505a\u6cd5\u3002 \n\n- \u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u68f5\u5e26\u8fb9\u6743\u7684\u6811\uff0c\u6bcf\u4e2a\u70b9 $i$ \u4e0a\u6709\u6743\u503c $\\text{a}_ i$\u3002$u$ \u80fd\u652f\u914d $v$ \u9700\u8981\u6ee1\u8db3 $u$ \u662f $v$ \u7684\u7236\u4eb2\uff0c\u4e14 $\\text{dis(u,v)} \\le \\text{a} _ v$\u3002$\\text{dis(u,v)}$ \u5b9a\u4e49\u4e3a\u6811\u4e0a\u8ddd\u79bb\u3002\n\n- \u89e3\u6cd5\uff1a\u6700\u65e9\u7684\u65f6\u5019\u770b\u9519\u9898\u4e86\uff0c\u770b\u6210 $\\text{dis(u,v)} \\le \\text{a} _ u$ \u3002\u7136\u540e\u60f3\u4e86\u4e2a\u505a\u6cd5\uff0c\u5199\u5b8c\u540e\u624d\u53d1\u73b0\u770b\u9519\u9898\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5dee\u522b\u4e0d\u5927\u3002\n\n - \u8bb0 $ \\text{dis}_ x$ \u4e3a\u70b9 $x$ \u7684\u6df1\u5ea6\uff0c\u90a3\u4e48\u5b9e\u9645\u4e0a\u5bf9\u4e8e$x$ \u6211\u4eec\u8981\u7edf\u8ba1\u7684\u7b54\u6848\u5c31\u662f\u5728 $x$ \u7684\u5b50\u6811\u4e2d\uff0c\u6ee1\u8db3 $\\text{dis} _ y-\\text{dis}_ x \\le \\text{a}_ y$ \u7684 $y$ \u7684\u6570\u91cf\uff0c\u5c06\u4e0d\u7b49\u5f0f\u76f8\u5173\u7684\u632a\u5230\u4e00\u8fb9\u5c31\u662f $\\text{dis} _ y- \\text{a}_ y \\le \\text{dis}_ x$\u3002 \u7528 $\\text{dfn}$ \u5e8f\u538b\u5230\u5e8f\u5217\u4e0a\u5c31\u662f\u6c42\u533a\u95f4 $[l,r]$ \u91cc\u503c\u5c0f\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u503c\u7684\u4e2a\u6570\uff0c\u76f4\u63a5\u5c06\u8be2\u95ee\u62c6\u5f00\uff0c\u5c31\u662f\u95ee\u524d\u7f00\u91cc\u5c0f\u4e8e\u67d0\u4e2a\u6570\u7684\u4e2a\u6570\uff0c\u76f4\u63a5\u7528 $\\text{BIT}$ \u7ef4\u62a4\u3002\n \n ```cpp\n#include<bits/stdc++.h>\n#define N 300005\n#define int long long\n#define lb(x) x&-x \nusing namespace std;\nint n,m,a[N];\nint head[N],idx;\nstruct edge{\n\tint v,w,next;\n}e[N];\nint tmp[N],Idx;\nvoid add(int u,int v,int w){\n\te[++idx].v=v;\n\te[idx].next=head[u];\n\thead[u]=idx;\n\te[idx].w=w;\n}\nint dfn[N],rev[N],size[N],num;\nint dis[N];\nint ans[N];\nvoid dfs(int x){\n\tdfn[x]=++num;\n\trev[num]=x;\n\tsize[x]=1;\n\tfor(int i=head[x];i;i=e[i].next){\n\t\tint y=e[i].v;\n\t \tdis[y]=dis[x]+e[i].w;\n\t \tdfs(y);\n\t \tsize[x]+=size[y];\n\t} \n}\nint L[N],R[N];\nstruct node{\n\tint op,x,id,l,r,type;\n}p[N<<1];\nint cnt;\nbool cmp(node x,node y){\n\tif(x.x!=y.x) return x.x<y.x;\n\treturn x.op<y.op; \n}\nint c[N<<2];\nvoid add(int x,int v){\n\tfor(;x<=m;x+=lb(x)) c[x]+=v;\n} \nint ask(int x){\n\tint res=0;\n\tfor(;x;x-=lb(x)) res+=c[x];\n\treturn res;\n}\nint getid(int x){\n\treturn lower_bound(tmp+1,tmp+m+1,x)-tmp;\n} \nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tfor(int i=2;i<=n;i++){\n\t\tint f,w;\n\t\tscanf(\"%lld%lld\",&f,&w);\n\t\tadd(f,i,w);\n\t}\n\tdfs(1);\n\tfor(int i=1;i<=n;i++){\n\t\ttmp[++Idx]=dis[i];\n\t\ttmp[++Idx]=dis[i]-a[i];\n\t}\n\tsort(tmp+1,tmp+Idx+1);\n\tm=unique(tmp+1,tmp+Idx+1)-tmp-1;\n\tfor(int i=1;i<=n;i++){\n\t\tp[++cnt]=(node){2,dfn[i]-1,i,1,getid(dis[i]),-1};\n\t\tp[++cnt]=(node){2,dfn[i]+size[i]-1,i,1,getid(dis[i]),1};\n\t\tp[++cnt]=(node){1,dfn[i],getid(dis[i]-a[i]),0,0,0};\n\t}\n\tsort(p+1,p+cnt+1,cmp);\n\tfor(int i=1;i<=cnt;i++){\n\t\tif(p[i].op==2){\n\t\t\tans[p[i].id]+=p[i].type*(ask(p[i].r)-ask(p[i].l-1));\n\t\t} \n\t\telse add(p[i].id,1); \n\t}\n\tfor(int i=1;i<=n;i++) printf(\"%lld \",ans[i]-1);\n\treturn 0;\n}\n```\n",
        "postTime": 1619173220,
        "uid": 128870,
        "name": "chen_qian",
        "ccfLevel": 7,
        "title": "CF739B"
    },
    {
        "content": "\u8fd9\u9898....\u5c31\u6ca1\u6709\u6811\u72b6\u6570\u7ec4\u89e3\u6cd5\u5417\uff1f\u8fd8\u662f\u6709\u7684\u3002\n\n\u6ce8\u610f\u5230\u56e0\u4e3a$u$\u5728$v$\u7684\u5b50\u6811\u5185\uff0c\u6240\u4ee5$dist(v,u)=dep[u]-dep[v]$,$dep$\u4e3a\u6df1\u5ea6\uff0c\n\n\u6240\u4ee5$dep[u]-dep[v]\\le a[u]$\n\n$ dep[u]-a[u] \\le dep[v]$\n\n\u5c06 $dep[u]-a[u]$ \u548c $dep[v]$ \u79bb\u6563\u5316\uff0c\u7136\u540e\u4f5c\u4e3a\u6811\u72b6\u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u8bbe\u7acb\u4e09\u5316\u7684\u7ed3\u679c\u4e3a $b[u]$ \u548c $bd[u]$\u3002\n\n\u6240\u4ee5\u7ed3\u70b9 $x$ \u7684\u7b54\u6848\u5c31\u662f\u6811\u72b6\u6570\u7ec4\u4e2d\u5728  $bd[x]$ \u4e4b\u524d\uff08\u5305\u62ec\u672c\u8eab\uff09\u7684\u6570\u7684\u4e2a\u6570\n\n\u663e\u7136\u7528 $dfs$ \u6c42\u89e3\n\n\u8fd8\u6709\u4e00\u70b9 ,\u5728\u6267\u884c $dfs(x)$ \u4e4b\u524d\uff0c\u6811\u72b6\u6570\u7ec4\u5e76\u4e0d\u662f\u7a7a\u7684\uff0c\u8fd9\u600e\u4e48\u529e\uff1f\n\n\u8fd9\u597d\u529e\uff0c\u6211\u4eec\u5728\u9012\u5f52\u4e0b\u653e\u4e4b\u524d\uff0c\u5148\u9884\u5148\u51cf\u53bb\u4e4b\u524d\u7684\u5f71\u54cd\u5373\u53ef\u3002\n\n\u4e0a\u4ee3\u7801:\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=2e5+5,Sz=N<<1,M=N<<1;\nint fir[N],nxt[M],to[M],w[M],ect=0,n;\n//dep[u]-dep[v]<=a[u]\n//dep[u]-a[u]<=dep[v]\nint a[N],dep[N],ans[N];\n\nint tr[Sz];\n#define lowbit(x) (x&(-x))\ninline void add(int pos,int x){for(int p=pos;p<Sz;p+=lowbit(p)) tr[p]+=x;}\ninline int sum(int pos){ int res=0;for(int p=pos;p;p^=lowbit(p)) res+=tr[p];return res;}  //\u56db\u884c\u6811\u72b6\u6570\u7ec4\nint bd[N],b[N];\ninline void dfs(int x,int f)   //\u6c42dep\n{\n\tfor(int i=fir[x];i;i=nxt[i])\n\tif(f!=to[i]) \n\tdep[to[i]]=dep[x]+w[i],\n\tdfs(to[i],x);\n}\ninline void solve(int x,int f)   //\u6c42\u7b54\u6848\n{\n\tans[x]-=sum(bd[x]);   //\u9884\u5148\u51cf\u53bb\u5f71\u54cd\n\tfor(int i=fir[x];i;i=nxt[i])\n\tif(to[i]!=f) solve(to[i],x);\n\tans[x]+=sum(bd[x]);   //\u52a0\u4e0a\u5f71\u54cd\n\tadd(b[x],1);  //\u52a0\u6807\u8bb0\n}\ninline void addedge(int u1,int v1,int w1)\n{\n\tnxt[++ect]=fir[u1];fir[u1]=ect;to[ect]=v1;w[ect]=w1;\n}\nint vals[Sz];\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint f,w;\n\t\tscanf(\"%lld%lld\",&f,&w);\n\t\taddedge(f,i,w);\n\t}\n\tdfs(1,0);\n    \n\tfor(int i=1;i<=n;i++) vals[i]=dep[i]-a[i],vals[i+n]=dep[i];\n\tsort(vals+1,vals+n*2+1);\n\tint tot=unique(vals+1,vals+n*2+1)-vals-1;\n\tfor(int i=1;i<=n;i++)\n\tbd[i]=lower_bound(vals+1,vals+tot+1,dep[i])-vals,\n\tb[i]=lower_bound(vals+1,vals+tot+1,dep[i]-a[i])-vals;  //\u79bb\u6563\u5316\n    \n\tsolve(1,0);\n\tfor(int i=1;i<=n;i++) cout<<ans[i]<<' ';\n}\n```",
        "postTime": 1604151679,
        "uid": 226435,
        "name": "\u5929\u547d\u4e4b\u8def",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "## \u7b80\u8ff0\u9898\u610f\n- \u4e00\u68f5\u6709 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u6839\u8282\u70b9\u4e3a $1$\u3002\n\n- \u6bcf\u4e2a\u70b9\u6709\u70b9\u6743 $a_i$ \uff0c\u6bcf\u6761\u8fb9\u4e5f\u6709\u8fb9\u6743 $x_i$\uff0c\u6743\u503c\u5747\u4e3a\u6b63\u6574\u6570 \u3002\n\n- \u5b9a\u4e49 $\\operatorname{dis}(u,v)$ \u4e3a\u4ece $u$ \u5230 $v$ \u7684\u7b80\u5355\u8def\u5f84\u4e0a\u7684\u8fb9\u6743\u548c\u3002\n\n- \u5f53\u4e14\u4ec5\u5f53 $u$ \u5728 $v$ \u7684\u5b50\u6811\u4e2d\u5e76\u4e14 $\\operatorname{dis}(u,v)\\leqslant a_u$ \uff0c**\u9876\u70b9 $v$ \u63a7\u5236\u9876\u70b9 $u$ $(v!=u)$**\u3002\n\n- \u95ee\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u80fd\u63a7\u5236\u51e0\u4e2a\u8282\u70b9\u3002\n\n## \u601d\u8def\n\n\u4ee5\u4e0b\u5185\u5bb9\u4e2d\u5747\u8bbe $u$ \u7684\u6df1\u5ea6\u5927\u4e8e $v$ \u7684\u6df1\u5ea6\u3002\n\n\u9996\u5148\u601d\u8003\u5982\u4f55\u6c42\u51fa $\\operatorname{dis}(u,v)$\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u6709\uff1a\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n$\\operatorname{dis}(u,v)=\\operatorname{dis}(1,u)+\\operatorname{dis}(1,v)-2 \\times \\operatorname{dis}(1,\\operatorname{lca}(u,v))$\n\n\u4f46\u663e\u7136\u5bf9\u4e8e\u8fd9\u9898\u662f\u6740\u9e21\u7528\u725b\u5200\u4e86\u3002\n\n\u672c\u9898\u6c42\u8ddd\u79bb\u65f6 $u$ \u5728 $v$ \u7684\u5b50\u6811\u4e2d\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u7528\u5230 $\\operatorname{lca}(u,v)$ \u3002\n\n\u53ea\u9700\u8981 $dfs$ \u4e00\u4e0b\u5c31\u53ef\u6c42\u51fa\u8ddd\u79bb\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u53d1\u73b0\u4e00\u6761\u6027\u8d28\uff1a\n\n- \u4ece $v$ \u5411\u4e0b\u5230 $u$ \u7684\u7ecf\u8fc7\u7684\u6bcf\u4e00\u6761\u8def\u5f84\u7684\u8fb9\u6743\u548c\u4e00\u5b9a**\u4e25\u683c\u5355\u8c03\u9012\u589e**\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u9898\u76ee\u4e2d\u5bf9\u201c\u63a7\u5236\u201d\u7684\u5b9a\u4e49\u4e0e $a_u$ \u6709\u5173\u3002\n\n\u4e8e\u662f**\u4ece $u$ \u5165\u624b**\uff0c\u5982\u679c\u4ece $v$ \u5165\u624b\u5c31\u4e00\u70b9\u601d\u8def\u90fd\u6ca1\u6709\u4e86~~\u5728\u66b4\u529b\u7684\u8def\u4e0a\u4e00\u53bb\u4e0d\u590d\u8fd4~~\u3002\n\n\u501f\u52a9\u521a\u624d\u7684\u6027\u8d28\u4e0d\u96be\u5f97\u51fa\uff0c\u53ea\u8981\u4ece $u$\u4e00\u76f4\u5411\u4e0a\uff0c\n\n\u6ee1\u8db3 $\\operatorname{dis}(u,v)\\leqslant a_u$ \u7684\u8282\u70b9\u90fd\u53ef\u4ee5\u63a7\u5236 $u$\u3002\n\n\u6240\u4ee5\u53ea\u9700\u8981\u627e\u51fa\u80fd\u63a7\u5236\u5230 $u$ \u7684\u6df1\u5ea6\u6700\u6d45\uff0c\u4e5f\u5c31\u662f\u8ddd\u79bb\u6700\u8fdc\u7684 $v$\u3002 \n\n\u6a21\u4eff\u500d\u589e\u6c42 $\\operatorname{lca}$ \u5373\u53ef\u3002\n\n```c++\n//\u4ee3\u7801\u91cc\u7684c[i]\u5373\u4e3a\u4e0a\u6587\u7684\u70b9\u6743a[i]\nvoid dfs1(int x,int fa)\n{\n\tf[x][0]=fa; int u=x;\n\tfor(int i=0;i<=19;i++) f[x][i+1]=f[f[x][i]][i];\n\tfor(int i=20;i>=0;i--)\n\t\tif(f[u][i]&&dis[x]-dis[f[u][i]]<=c[x])\n\t\t\tu=f[u][i];\n}\n```\n\u627e\u51fa\u76ee\u6807\u70b9 $v$ \u540e\uff0c\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u628a\u4ece $f[u][0]$ \u5230 $v$\u4e0a\u7684\u70b9\u7684\u7b54\u6848\u5168\u90e8\u52a0 $1$ \uff0c\u56e0\u4e3a\u4ed6\u4eec\u90fd\u53ef\u4ee5\u63a7\u5236 $u$ \u3002\n\n\u6ce8\u610f\u662f**\u4ece $f[u][0]$ \u5f00\u59cb**\uff0c**$u$ \u4e0d\u80fd\u63a7\u5236\u5b83\u81ea\u5df1**\u3002\n\n\u6811\u4e0a\u8fde\u7eed\u4e00\u6bb5\u589e\u52a0\u76f8\u540c\u7684\u6570\uff1f\u4e0d\u5c31\u662f\u6811\u4e0a\u5dee\u5206\u5417\uff0c\u8fd8\u6bd4\u4e00\u822c\u7684\u66f4\u7b80\u5355\u3002\n\n\u53ea\u9700\uff1a\n\n```c++\n\t//\u53ea\u9700\u8981\u4e24\u53e5\u662f\u56e0\u4e3a\u589e\u52a0\u7684\u533a\u95f4\u5e76\u6ca1\u6709\u79bb\u5f00u\u6240\u5728\u7684\u5b50\u6811\u5185\n\tdif[f[x][0]]++; dif[f[u][0]]--;\n```\n\n\u6700\u540e\u518d $dfs$ \u4e00\u6b21\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\uff0c\u6ce8\u610f $\\operatorname{dis}(u,v)$ \u53ef\u80fd\u4f1a\u7206 $int$ \u3002\n\n\u653e\u4e00\u4e0b\u5b8c\u6574 code \u3002\n\n```c++\n#include<cstdio>\n#include<iostream>\n#define N 200050\n#define ll long long \nusing namespace std;\nll n,m,a,b,c[N];\nll first[2*N],nxt[2*N],go[2*N],w[2*N],tot;\nll f[N][21],dis[N],dif[N],ans[N];\ninline ll read()\n{\n\tll num=0;\n\tchar c=getchar();\n\twhile(c>'9'||c<'0') c=getchar();\n\twhile(c>='0'&&c<='9'){num=num*10+c-'0'; c=getchar();}\n\treturn num;\n}\nvoid add(int u,int v,ll cost)\n{\n\tnxt[++tot]=first[u];first[u]=tot;go[tot]=v;w[tot]=cost;\n}\nvoid dfs1(int x,int fa)\n{\n\tf[x][0]=fa; int u=x;\n\tfor(int i=0;i<=19;i++) f[x][i+1]=f[f[x][i]][i];\n\tfor(int i=20;i>=0;i--)\n\t\tif(f[u][i]&&dis[x]-dis[f[u][i]]<=c[x])\n\t\t\tu=f[u][i];\n\tdif[f[x][0]]++; dif[f[u][0]]--;\n\tfor(int i=first[x];i;i=nxt[i])\n\t\tif(go[i]!=fa)\n\t\t\tdis[go[i]]=dis[x]+w[i],\n\t\t\tdfs1(go[i],x);\n}\nll dfs2(int x,int fa)\n{\n\tans[x]=dif[x];\n\tfor(int i=first[x];i;i=nxt[i])\n\t\tif(go[i]!=fa)\n\t\t\tans[x]+=dfs2(go[i],x);\n\treturn ans[x];\n}\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++) c[i]=read();\n\tfor(int i=1;i<=n-1;i++)\n\t{\n\t\ta=read(); b=read();\n\t\tadd(a,i+1,b); add(i+1,a,b);\n\t}\n\tdfs1(1,0); dfs2(1,0);\n\tfor(int i=1;i<=n;i++) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n```\n\n### \u5570\u55e6\u51e0\u53e5\uff1a\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\uff08\u5173\u4e8e\u4e3a\u4ec0\u4e48\u4ece $u$ \u51fa\u53d1\u8003\u8651\uff09\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5173\u952e\u539f\u56e0\uff1a\u201c\u63a7\u5236\u201d\u7684\u5b9a\u4e49\u4e0e $u$ \u7684\u76f8\u5173\u6027\u66f4\u5927\u3002\n\n- &nbsp;&nbsp;&nbsp;\u5982\u679c\u4ece $v$ \u51fa\u53d1\u8003\u8651\u7684\u8bdd\u4e00\u5b9a\u8981\u843d\u5b9e\u5230\u5176\u5b50\u6811\u5185\u6bcf\u4e00\u4e2a\u8282\u70b9\u4e0a\uff0c\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u800c\u4e14\u6bcf\u4e2a\u70b9\u7684\u70b9\u6743\u5e76\u6ca1\u6709\u89c4\u5f8b\uff0c\u590d\u6742\u5ea6\u964d\u4e0d\u4e0b\u6765\u3002\n\n- &nbsp;&nbsp;&nbsp;\u800c\u4ece $u$ \u51fa\u53d1\uff0c$a_u$\u5c31\u662f\u786e\u5b9a\u7684\uff0c\u800c\u4e14$\\operatorname{dis}(u,v)$ \u6709\u5355\u8c03\u6027\uff0c\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6b64\u65f6\u500d\u589e\u5c31\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u6700\u8fdc\u7684 $v$ \uff0c\u7136\u540e\u7528\u5dee\u5206\u5feb\u901f\u7edf\u8ba1\u7b54\u6848\u3002\n\n",
        "postTime": 1596966337,
        "uid": 269354,
        "name": "loctopus",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "## \u4e3b\u8981\u7b97\u6cd5\n\n\u524d\u7f00\u8fb9\u6743\u548c + \u6811\u4e0a\u5dee\u5206 + \u500d\u589e\n\n## \u6734\u7d20\u7b97\u6cd5\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9$P1$,\u5411\u5b83\u4e0a\u9762\u7684\u6240\u6709\u7236\u4eb2\u8282\u70b9$P_f$\u67e5\u8be2,\u770b\u8be5\u7236\u4eb2\u8282\u70b9\u662f\u5426\u6709\u80fd\u529b\u63a7\u5236\u70b9$P1$,\u5982\u679c\u80fd,\u5c31\u7ee7\u7eed\u5411\u4e0a\u627e,\u76f4\u5230\u627e\u5230\u80fd\u63a7\u5236\u8be5\u70b9\u7684\u6700\u9ad8\u7236\u8282\u70b9$P_{ff}$\uff0c\u518d\u5c06\u8fd9\u6761\u94fe\u4e0a\u7684\u6240\u6709\u8282\u70b9\u7b54\u6848+1\uff08\u6df1\u5ea6\u6700\u6d45\uff09\n\n\u5bb9\u6613\u8bc1\u660e,\u4ece$P1$\u5230$P_{ff}$\u8fd9\u6761\u94fe\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u6709\u80fd\u529b\u63a7\u5236\u70b9$P1$,\u76f8\u5f53\u4e8e$P1$\u7ed9\u8fd9\u6761\u94fe\u4e0a\u6bcf\u4e2a\u8282\u70b9\u90fd\u8d21\u732e\u4e86\u4e00\u4e2a\u5355\u4f4d\u7684\u7b54\u6848\n\n\u66b4\u529b\u505a\u6cd5\u5c31\u662f\u679a\u4e3e\u6bcf\u4e2a$P1$\uff0c$P_f$\uff0c\u7136\u540e\u5206\u522b\u627e\u5230\u6bcf\u4e2a$P1$\u7684$P_{ff}$\uff0c\u518d\u5c06\u8fd9\u6761\u94fe\u4e0a\u7684\u6240\u6709\u8282\u70b9\u7b54\u6848+1\n\n\u663e\u7136\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$ \u4f1a\u8d85\u65f6\uff0c\u8003\u8651\u4f18\u5316\n\n## \u5feb\u901f\u6c42\u4e24\u70b9\u8ddd\u79bb(\u5728\u540c\u4e00\u6761\u94fe\u4e0a)\u7684\u4f18\u5316\n\n\u5efa\u56fe\u540e\uff0cdfs\u9884\u5904\u7406\u6bcf\u4e00\u4e2a\u8282\u70b9$P_i$\u5230\u6839\u8282\u70b91\u7684\u8ddd\u79bb $dis[i]$\n\n\u5bf9\u4e8e\u5728\u540c\u4e00\u6761\u94fe\u4e0a\u7684\u4e24\u4e2a\u8282\u70b9$u,v$,\u4ed6\u4eec\u4e4b\u95f4\u7684\u8ddd\u79bb\u5c31\u662f$dis[v]-dis[u]$\n\n\u5176\u4e2dv\u4e3a\u8f83\u6df1\u7684\u4e00\u4e2a\u70b9,\u6df1\u5ea6\u53ef\u4ee5\u987a\u4fbf\u5728dfs\u9884\u5904\u7406\u65f6\u7ef4\u62a4\n\n## \u627e\u6700\u6d45\u7236\u4eb2$P_{ff}$\u7684\u4f18\u5316\n\n\u7531\u4e8e\u6211\u4eec\u80af\u5b9a\u4e0d\u80fd\u4ece$P1$\u8d77\u4e00\u4e2a\u4e00\u4e2a\u5411\u4e0a\u722c\uff0c\u56e0\u4e3a\u8fd9\u6837\u5b9e\u5728\u662f\u592a\u6162\u4e86\n\n\u6240\u4ee5\u60f3\u5230\u500d\u589e\u6c42LCA\u65f6\u7528\u5230\u7684\u601d\u60f3,\u7ef4\u62a4$Parent[i][j]$\u4e3a\u7b2ci\u4e2a\u8282\u70b9\u7684\u7b2c$2^j$\u4e2a\u7956\u5148\u7f16\u53f7\uff0c\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u6bcf\u6b21\u4e0d\u5411\u4e0a\u8df3\u4e00\u6b65,\u800c\u662f\u8df3$2^j$\u6b65\uff0c\u8fd9\u6837\u5c31\u52a0\u901f\u4e86\u6211\u4eec\u627e\u7236\u4eb2\u8282\u70b9\u7684\u901f\u5ea6\n\n\u600e\u4e48\u786e\u5b9a\u8fd9\u4e2aj\u5462,\u6211\u4eec\u53ef\u4ee5\u4ece\u9ad8\u5230\u4f4e\u679a\u4e3e\u8fd9\u4e2aj(\u6bd4\u5982\u4ece20\u5f00\u59cb),\u7136\u540e\u5224\u65ad\u8df3$2^j$\u6b65\u7684\u70b9\u80fd\u4e0d\u80fd\u628a$P1$\u63a7\u5236\u5230,\u5982\u679c\u80fd\u6211\u4eec\u5c31\u79fb\u52a8\u5230\u90a3\u4e2a\u70b9,\u7136\u540e\u7ee7\u7eed\u679a\u4e3ej\u8df3\u8dc3,\u5bb9\u6613\u53d1\u73b0,\u8d8a\u8df3\u5230\u540e\u9762,\u6bcf\u6b21\u8df3\u8dc3\u7684\u6b65\u6570\u662f\u4f1a\u8d8a\u5c0f\u7684(\u5373j\u9012\u51cf)\uff0c\u6240\u4ee5\u4e00\u4e2a\u5faa\u73af\u679a\u4e3ej\u5c31\u80fd\u5b8c\u6210\n\n\u627e\u7236\u4eb2\u8282\u70b9\u590d\u6742\u5ea6 $O(log n)$\n\n## \u7ed9\u94fe\u4e0a\u8282\u70b9\u6dfb\u52a0\u7b54\u6848\u4f18\u5316-\u6811\u4e0a\u5dee\u5206\n\n\u6211\u4eec\u73b0\u5728\u8981\u505a\u7684\u662f\u7ed9\u94fe\u4e0a\u6bcf\u4e00\u4e2a\u8282\u70b9\u7684\u7b54\u6848\u90fd\u52a0\u4e0a1,\u663e\u7136\u5982\u679c\u66b4\u529b\u6dfb\u52a0\uff0c\u524d\u9762\u7684\u4f18\u5316\u52aa\u529b\u53c8\u767d\u8d39\u4e86\n\n\u6240\u4ee5\u73b0\u5728\u8981\u627e\u5230\u4e00\u4e2a\u9ad8\u6548\u7684\u7b97\u6cd5\u6765\u7ef4\u62a4:\u7ed9\u6811\u4e0a\u4e00\u6761\u94fe\u7684\u6bcf\u4e00\u4e2a\u70b9\u6743\u503c\u52a0\u4e0a1,\u591a\u6b21\u6dfb\u52a0,\u6700\u540e\u8be2\u95ee\u6bcf\u4e2a\u8282\u70b9\u7684\u6743\u503c\n\n\u8fd0\u7528\u4e00\u7ef4\u6570\u7ec4\u5dee\u5206\u7684\u601d\u60f3,\u6211\u4eec\u53ef\u4ee5\u5728\u6811\u4e0a\u6765\u8fdb\u884c\u5dee\u5206,\u601d\u8def\u540c\u7406,\u975e\u5e38\u7b80\u5355,\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\n\n## AC\u4ee3\u7801(\u5df2\u52a0\u5165\u9632\u527d\u7a83\u7247\u6bb5)\n\n\n```\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nll n,m,s;\nconst int maxn = 200010;\nstruct edge{\n    int v,nxt;\n    ll w;\n}E[maxn*2];\nint p[maxn],eid;\nvoid init(){\n    memset(p,-1,sizeof p);\n    eid = 0;\n}\nvoid insert(int u,int v,ll w){\n    E[eid].v = v;\n    E[eid].nxt = p[u];\n    E[eid].w = w;\n    p[u] = eid++;\n}\nvoid insert2(int u,int v,ll w){\n    insert(u,v,w);\n    insert(v,u,w);\n}\nll pv[maxn],d[maxn],dis[maxn];\nint parent[maxn][25];\nvoid dfs1(int u,int fa){\n\tfor(register int i=p[u];~i;i=E[i].nxt){\n\t\tint v = E[i].v,w = E[i].w;\n\t\tif(v == fa) continue;\n\t\tdis[v] = dis[u] + w;\n\t\tparent[v][0] = u;\n\t\td[v] = d[u] + 1;\n\t\tdfs1(v,u);\n\t}\n}\nll dt[maxn];\nvoid addCtl(int u,int v){\n\tif(d[u] > d[v]) swap(u,v);\n\t//printf(\"addctl %d %d\\n\",u,v);\n\tint c = u;\n\tint fc = parent[c][0];\n\tdt[u]++;\n    dt[v]++;\n    dt[c]--;\n    dt[fc]--;\n}\nvoid dfs2(int u,int fa){\n\tfor(register int i=p[u];~i;i=E[i].nxt){\n\t\tint v = E[i].v;\n\t\tif(v == fa) continue;\n\t\tdfs2(v,u);\n\t\tdt[u] += dt[v];\n\t}\n}\nint main(){\n    init();\n    scanf(\"%lld\",&n);\n    for(register int i=1;i<=n;i++){\n\t\tscanf(\"%lld\",pv+i);\n\t}\n\tfor(register int i=1;i<=n;i++){\n\t\tll p,w;\n\t\tscanf(\"%lld%lld\",&p,&w);\n\t\tinsert2(i+1,p,w);\n\t}\n\td[1] = 1;\n\tdfs1(1,-1);\n\tfor(register int lev=1;(1<<lev)<=n;lev++){\n\t\tfor(register int i=1;i<=n;i++){\n\t\t\tparent[i][lev] = parent[parent[i][lev-1]][lev-1];\n\t\t}\n\t}\n\tfor(register int i=1;i<=n;i++){\n\t\tll aim = pv[i];\n\t\tll now = 0,nowu = i,nowv = nowu;\n\t\tfor(register int j=18;j>=0;j--){\n\t\t\tll tmpnowv = parent[nowv][j];\n\t\t\tll sumEdge = dis[nowu] - dis[tmpnowv];\n\t\t\tif(sumEdge <= aim){\n\t\t\t\tnow += sumEdge;\n\t\t\t\tnowv = tmpnowv;\n\t\t\t}\n\t\t}\n\t\tif(nowv == 0) nowv = 1;\n\t\t//printf(\"%d can be ctled by %d\\n\",i,nowv);\n\t\tif(nowu != nowv) addCtl(parent[nowu][0],nowv);\n\t}\n\t\n\tdfs2(1,-1);\n\tfor(register int i=1;i<n;i++){\n\t\tprintf(\"%lld \",dt[i]);\n\t}\n    return 0;\n}\n```\n",
        "postTime": 1550802835,
        "uid": 83266,
        "name": "aRenBigFather",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "\uff08\u524d\u7f00\u548c+\u5dee\u5206\uff09\ndfs\u904d\u5386\uff0c\u5f53\u524d\u70b9\u4e3av,\u8fc7\u7a0b\u4e2d\u7528\u4e8c\u5206\u6216\u500d\u589e\u627e\u5230\u6700\u8fdc\u7684\u4e00\u4e2a\u70b9x\u6ee1\u8db3dist(v,x)<=point[v](\u5373v\u7684\u70b9\u6743\uff09\u5c06\u8fd9\u4e24\u70b9\u4e4b\u95f4\u6240\u6709\u7684\u70b9\u90fdans++\u3002          \n\u8fd9\u91cc\u7528\u5dee\u5206\u6765\u4f18\u5316\uff1a\u5c06x\u7684\u7236\u4eb2\u8282\u70b9ans--\uff0c\u5c06v\u7684\u7236\u4eb2\u8282\u70b9ans++,\u7136\u540e\u5728dfs\u7684\u672b\u5c3e\u5f80\u56de\u4f20\u9012ans\u503c\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u5c06v\u5230x\u4e00\u6761\u94fe\u4e0a\u6240\u6709\u7684\u70b9\u90fdans++\uff1b    \n\u6700\u540e\u4f9d\u6b21\u8f93\u51fa\u7b54\u6848\u5373\u53ef\u3002\n\n\n\n~~~~#include<iostream>\n#include<cstdio>\nusing namespace std;\nconst int maxn=200008;\ntemplate<typename xxx>inline void read(xxx &x){\n\tx=0;int f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-'){f=-1;}c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n\tx*=f;\n}\ntemplate<typename xxx>inline void print(xxx x){\n\tif(x<0){x=-x;putchar('-');}\n\tif(x>9){print(x/10);}\n\tputchar(x%10+48);\n}\nstruct node{\n\tint v,w,nxt;\n}e[maxn<<1];\nint head[maxn];\nint tot;\ninline void add(int a,int b,int c){\n\t++tot;\n\te[tot].v=b;\n\te[tot].w=c;\n\te[tot].nxt=head[a];\n\thead[a]=tot;\n}\nlong long dep[maxn]; //\u6ce8\u610fdep\u6570\u7ec4\u5fc5\u987b\u7528long long\u5426\u5219\u8fc7\u4e0d\u4e86\u3002\nint point[maxn]; \nint ans[maxn]; \nint f[maxn][20];\nvoid dfs(int x,int fa,int val){\n\tf[x][0]=fa;\n\tdep[x]=dep[fa]+val;\n\tint v,w;\n\tfor(int i=1;i<=18;i++){\n\t\tf[x][i]=f[f[x][i-1]][i-1];\n\t}\n\tfor(int i=head[x];i;i=e[i].nxt){\n\t\tv=e[i].v;\n\t\tw=e[i].w;\n\t\tif(v==fa) continue;\n\t\tdfs(v,x,w);\n\t\tint vp=point[v];\n\t\tint p=1;\n\t\tint now=v;//\u500d\u589e\n\t\twhile(p&&now){\n\t\t\tif(dep[now]-dep[f[now][p]]<=vp){\n\t\t\t\tvp-=dep[now]-dep[f[now][p]];\n\t\t\t\tnow=f[now][p];\n\t\t\t\tp<<=1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tp>>=1;\n\t\t\t}\n\t\t}\n\t\tif(dep[now]-dep[f[now][0]]<=vp){\n\t\t\tnow=f[now][0];\n\t\t}\n\t\tans[f[now][0]]--;\n\t\tans[f[v][0]]++;\n\t}\n\tans[fa]+=ans[x];\n}\nint n;\nint aa,cc;\nint main(){\n\tread(n);\n\tfor(int i=1;i<=n;i++){\n\t\tread(point[i]);\n\t}\n\tfor(int i=2;i<=n;i++){\n\t\tread(aa),read(cc);\n\t\tadd(aa,i,cc);\n\t\tadd(i,aa,cc);\n\t}\n\tdfs(1,0,0);\n\tfor(int i=1;i<=n;i++){\n\t\tprint(ans[i]);\n\t\tputchar(' ');\n\t}\n}\n~~~~",
        "postTime": 1546693956,
        "uid": 124656,
        "name": "JayTwenty",
        "ccfLevel": 0,
        "title": "Alyona and a tree"
    },
    {
        "content": "\u524d\u7f00\u548c+\u500d\u589e+\u6811\u4e0a\u5dee\u5206\n\n\u5047\u8bbe$v$\u662f$u$\u5b50\u6811\u4e2d\u7684\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48$u$\u80fd\u63a7\u5236$v$\u7684\u6761\u4ef6\u662f\u53d7$v$\u7684\u6743\u503c\u7684\u9650\u5236\uff0c\u800c\u5e76\u975e$u$\u3002\u56e0\u6b64\u6211\u4eec\u5c31\u80fd\u60f3\u5230\u8ba1\u7b97\u6bcf\u4e00\u4e2a\u70b9\u7684\u8d21\u732e\uff0c\u5373$v$\u6709\u591a\u5c11\u4e2a\u7956\u5148\u80fd\u63a7\u5236\u5b83\u3002\u8fd9\u6837\u5c31\u80fd\u60f3\u5230\u66b4\u529b\u7684\u505a\u6cd5\uff1a\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9$i$\uff0c\u5411\u4e0a\u722c\u76f4\u5230\u4e24\u70b9\u95f4\u8ddd\u79bb\u5927\u4e8e$a_i$\u4e3a\u6b62\u3002\u7136\u540e\u6811\u4e0a\u5dee\u5206\uff08\u51c6\u786e\u8bf4\u662f\u94fe\u4e0a\u5dee\u5206\uff09\u5373\u53ef\u3002\u81f3\u4e8e\u4e24\u70b9\u95f4\u8ddd\u79bb\uff0c\u91c7\u7528\u524d\u7f00\u548c\u76f8\u51cf\u3002\n\n\u4f46\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u80fd\u8fbe\u5230$O(n^2)$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u500d\u589e\u4f18\u5316\u4e00\u6b65\u6b65\u5411\u4e0a\u8df3\uff0c\u8fbe\u5230$O(nlogn)$\u3002\n\n\u603b\u7ed3\u4e00\u4e0b\uff0c\u5148$dfs$\u4e00\u904d\u6c42\u51fa\u6bcf\u4e00\u4e2a\u70b9\u5230\u6839\u8282\u70b9\u7684\u8ddd\u79bb\u548c\u500d\u589e\u6570\u7ec4\uff0c\u590d\u6742\u5ea6$O(nlogn)$\uff1b\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u500d\u589e\u5411\u4e0a\u8df3\uff0c\u5e76\u4fee\u6539\u5dee\u5206\u6570\u7ec4\uff0c\u590d\u6742\u5ea6\u4e5f\u662f$O(nlogn)$\uff1b\u6700\u540e$O(n)$ $dfs$\u4e00\u904d\u6c42\u67e5\u5dee\u5206\u7ec4\u7684\u6811\u4e0a\u524d\u7f00\u548c\u3002\n  \n```c++\n#include<cstdio>\n#include<iostream>\n#include<cmath>\n#include<algorithm>\n#include<cstring>\n#include<cstdlib>\n#include<cctype>\n#include<vector>\n#include<stack>\n#include<queue>\nusing namespace std;\n#define enter puts(\"\") \n#define space putchar(' ')\n#define Mem(a, x) memset(a, x, sizeof(a))\n#define rg register\ntypedef long long ll;\ntypedef double db;\nconst int INF = 0x3f3f3f3f;\nconst db eps = 1e-8;\nconst int maxn = 2e5 + 5;\ninline ll read()\n{\n  ll ans = 0;\n  char ch = getchar(), last = ' ';\n  while(!isdigit(ch)) last = ch, ch = getchar();\n  while(isdigit(ch)) ans = (ans << 1) + (ans << 3) + ch - '0', ch = getchar();\n  if(last == '-') ans = -ans;\n  return ans;\n}\ninline void write(ll x)\n{\n  if(x < 0) x = -x, putchar('-');\n  if(x >= 10) write(x / 10);\n  putchar(x % 10 + '0');\n}\n\nint n;\nll a[maxn];\nstruct Edge\n{\n  int nxt, to, w;\n}e[maxn];\nint head[maxn], ecnt = -1;\nvoid addEdge(int x, int y, int w)\n{\n  e[++ecnt] = (Edge){head[x], y, w};\n  head[x] = ecnt;\n}\n\nint fa[21][maxn];\nll dis[maxn];\nvoid dfs(int now)\n{\n  for(int i = 1; i <= 20; ++i)\n    fa[i][now] = fa[i - 1][fa[i - 1][now]];\n  for(int i = head[now], v; i != -1; i = e[i].nxt)\n    {\n      v = e[i].to;\n      fa[0][v] = now;\n      dis[v] = dis[now] + e[i].w;\n      dfs(v);\n    }\n}\n\nint dif[maxn];\nvoid solve(int now)\n{\n  int x = now;\n  for(int i = 20; i >= 0; --i)\n      if(fa[i][x] && dis[now] - dis[fa[i][x]] <= a[now]) x = fa[i][x];\n  if(x != 1) dif[fa[0][x]]--;\n  if(now != 1) dif[fa[0][now]]++;\n}\n\nvoid dfs2(int now)\n{\n  for(int i = head[now], v; i != -1; i = e[i].nxt)\n    {\n      v = e[i].to;\n      dfs2(v);\n      dif[now] += dif[v];\n    }\n}\n\nint main()\n{\n  Mem(head, -1);\n  n = read();\n  for(int i = 1; i <= n; ++i) a[i] = read();\n  for(int i = 2; i <= n; ++i)\n    {\n      int x = read(), w = read();\n      addEdge(x, i, w);\n    }\n  dfs(1);\n  for(int i = 1; i <= n; ++i) solve(i);\n  dfs2(1);\n  for(int i = 1; i <= n; ++i) write(dif[i]), space; enter;\n  return 0;\n}\n```",
        "postTime": 1542110744,
        "uid": 55965,
        "name": "mrclr",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "**\u6811\u4e0a\u5dee\u5206 + DFS + \u4e8c\u5206 + \u6811\u4e0a\u524d\u7f00\u548c**\n\n\u641c\u7d22$O(n)$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u4e8c\u5206$O(log\\ n)$\u7956\u5148\u524d\u7f00\u548c$O(n)$\uff0c\u5dee\u5206$O(1)$\u4fee\u6539\u8def\u5f84\n\n$$O(n\\ log \\ n)$$\n\nCode\n```cpp\n#include<bits/stdc++.h>\n#define LL long long\n#define N 200010\nusing namespace std;\nLL n;\n\nstruct EDGE{\n\tLL u, v;\n\tLL Next;\n\tLL Value;\n}G[N];\n\nLL tot = 0;\nLL Head[N];\n\ninline void Add(LL u, LL v, LL Val)\n{\n\t++ tot;\n\tG[tot].u = u;\n\tG[tot].v = v;\n\tG[tot].Value = Val;\n\tG[tot].Next = Head[u];\n\tHead[u] = tot;\n}\n\nLL Ctrl[N];\n\nLL Ans[N];\nLL Stk[N], Size = 0;\nLL F[N];\ninline void DFS(LL u)\n{\n\tStk[++ Size] = u;\n\tLL Left = 1, Right = Size;\n\twhile(Left < Right)\n\t{\n\t\tLL Mid = (Left + Right) >> 1;\n\t\tif(F[Stk[Mid]] >= F[u] - Ctrl[u])\n\t\t\tRight = Mid;\n\t\telse\n\t\t\tLeft = Mid + 1;\n\t}\n\t++ Ans[Stk[Size - 1]];\n\t-- Ans[Stk[Left - 1]];\n\tfor(LL i = Head[u]; i; i = G[i].Next)\n\t{\n\t\tLL v = G[i].v;\n\t\tF[v] = G[i].Value + F[u];\n\t\tDFS(v);\n\t\tAns[u] += Ans[v];\n\t}\n\t-- Size;\n}\nint main()\n{\n\tscanf(\"%lld\", &n);\n\tfor(LL i = 1; i <= n; ++ i)\n\t\tscanf(\"%lld\", &Ctrl[i]);\n\tfor(LL i = 1; i < n; ++ i)\n\t{\n\t\tLL u, Val;\n\t\tscanf(\"%lld%lld\", &u, &Val);\n\t\tAdd(u, i + 1, Val);\n\t}\n\tDFS(1);\n\tfor(LL i = 1; i <= n; ++ i)\n\t\tprintf(\"%lld \", Ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1524142242,
        "uid": 29519,
        "name": "qianfujia",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "\u9996\u5148\u6574\u4e2a\u56fe\u641c\u4e00\u904d\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5230\u6839\u8282\u70b9\u7684\u8ddd\u79bb\u3002\n\n\u7136\u540e\u53d1\u73b0\u66b4\u529b\u53bb\u5224\u65ad\u6bcf\u4e2a\u70b9\u662f\u5426\u88ab\u63a7\u5236\u662f $O(n^2)$ \u7684\uff0c\u663e\u7136\u4e0d\u884c\u3002\n\n\u7531\u4e8e\u662f\u5728\u6811\u4e0a\u7684\u95ee\u9898\uff0c\u8003\u8651\u500d\u589e\u4f18\u5316\uff0c\u53d1\u73b0\u53ef\u884c\u3002\n\n\u500d\u589e\u9884\u5904\u7406\u51fa\u5f80\u4e0a\u8df3 $2$ \u7684\u6b21\u5e42\u4f1a\u8df3\u5230\u54ea\u4e00\u4e2a\u8282\u70b9\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u6211\u4eec\u5176\u5b9e\u5c31\u662f\u8981\u627e\u5230\u6700\u8fdc\u7684\u80fd\u88ab\u652f\u914d\u7684\u70b9 $g$\u3002\n\n\u7136\u540e\u8fd9\u4e2a\u70b9 $g$ \u5230\u5f53\u524d\u70b9\u95f4\u7684\u70b9\u5f88\u660e\u663e\u662f\u90fd\u53ef\u4ee5\u88ab\u63a7\u5236\u7684\u3002\n\n\u76f4\u63a5\u66b4\u529b\u53bb\u52a0\u8fd8\u662f\u4f1a\u8d85\u65f6\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4e0a\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u53bb\u7ef4\u62a4\u3002\n\n\u4f46\u53d1\u73b0\u5176\u5b9e\u5b8c\u5168\u6ca1\u6709\u5fc5\u8981\uff0c\u53ef\u4ee5\u7528\u6811\u4e0a\u5dee\u5206\uff0c\u6700\u540e\u6574\u4e2a\u56fe\u641c\u7d22\u4e00\u904d\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long \nusing namespace std;\ntemplate<typename T> inline void read(T &x){\n\tT f=1;x=0;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\tx*=f;\n}\nconst int N = 3e5;\nint n,a[N],nex[N],first[N],v[N],w[N],num=1;\nint dep[N],f[N][35],dis[N],ans[N];\nvoid add(int from,int to,int val){\n\tnex[++num]=first[from];first[from]=num;v[num]=to;w[num]=val;\n}\nvoid dfs(int x,int fa){\n\tfor(int i=first[x];i;i=nex[i]){\n\t\tint to=v[i];\n\t\tif(to==fa||dep[to]) continue;\n\t\tdep[to]=dep[x]+1;\n\t\tf[to][0]=x;\n\t\tdis[to]=dis[x]+w[i];\n\t\tdfs(to,x);\n\t}\n}\nvoid get(int x){\n\tint g=x;\n\tfor(int i=32;i>=0;i--){\n\t\tif(f[g][i]&&dis[x]-dis[f[g][i]]<=a[x]){\n\t\t\tg=f[g][i];\n\t\t} \n\t}\n\tans[f[g][0]]--;\n\tans[f[x][0]]++;\n}\nvoid dfs2(int x){\n\tfor(int i=first[x];i;i=nex[i]){\n\t\tint to=v[i];\n\t\tdfs2(to);\n\t\tans[x]+=ans[to];\n\t}\n}\nsigned main(){\n\tread(n);\n\tfor(int i=1;i<=n;i++) read(a[i]);\n\tfor(int i=2;i<=n;i++){\n\t\tint p,w;read(p),read(w);\n\t\tadd(p,i,w);\n\t}\n\tdfs(1,-1);\n\tfor(int j=1;j<=32;j++){\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tf[i][j]=f[f[i][j-1]][j-1];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tget(i);\n\t}\n\tdfs2(1);\n\tfor(int i=1;i<=n;i++) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1624019947,
        "uid": 206021,
        "name": "Pitiless0514",
        "ccfLevel": 7,
        "title": "CF739B Alyona and a tree \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u4e00\u4e2a\u70b9 $v$ \u5bf9\u591a\u5c11\u4e2a\u70b9 $u$\uff08$v$ \u5728 $u$ \u7684\u5b50\u6811\u4e2d\uff09 \u6709\u8d21\u732e\u3002\n\n\u56e0\u4e3a\u4e00\u4e2a\u70b9 $u$ \u80fd\u5426\u63a7\u5236\u5230\u70b9 $v$ \u53ea\u548c $a_v$ \u6709\u5173\u7cfb\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8d21\u732e\u53ef\u4ee5\u4ece\u70b9 $v$ \u7528\u500d\u589e\u6c42\u51fa\u6765\u3002\u6ce8\u610f\u8fd9\u4e2a\u8d21\u732e\u76f4\u63a5\u4e00\u4e2a\u4e00\u4e2a\u52a0\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u4f1a\u7206\u70b8\u7684\uff0c\u6211\u4eec\u6ce8\u610f\u5230\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u70b9 $v$\uff0c\u80fd\u63a7\u5236\u5b83\u7684\u8282\u70b9\u7684\u70b9\u96c6\u5728\u6811\u4e0a\u4e00\u5b9a\u662f\u4e00\u6761\u94fe\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u6811\u4e0a\u5dee\u5206\u6253\u4e00\u4e2a\u6807\u8bb0\uff0c\u6700\u540e\u524d\u7f00\u548c\u7edf\u8ba1\u4e00\u904d\u7b54\u6848\u5c31\u884c\u4e86\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\n#include <cmath>\n#include <queue>\n#include <vector>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#define ll long long\nusing namespace std;\n\ninline ll read() {\n\tll x = 0, w = 1;char ch = getchar();\n\twhile (ch > '9' || ch < '0') { if (ch == '-')w = -1;ch = getchar(); }\n\twhile (ch >= '0' && ch <= '9')x = x * 10 + ch - '0', ch = getchar();\n\treturn x * w;\n}\ninline void write(int x) {\n    if (x < 0) putchar('-'), x = -x;\n    if (x > 9) write(x / 10);\n    putchar(x % 10 + '0');\n}\n\nconst int maxn = 2e5 + 5;\nconst int mod = 1e9 + 7;\nconst int inf = 0x3f3f3f3f;\n\ninline int min(int x, int y) { return x < y ? x : y; }\ninline int max(int x, int y) { return x > y ? x : y; }\n\nstruct node {\n\tint nxt, to, val;\n}edge[maxn << 1];\nint n, m, tot;\nll a[maxn], head[maxn], sum[maxn], dis[maxn], fa[maxn][35];\n\ninline void addedge(int u, int v, int w) {\n\tedge[++tot].nxt = head[u];\n\tedge[tot].to = v;\n\tedge[tot].val = w;\n\thead[u] = tot;\n}\n\ninline void dfs(int u) {\n\tfor (int i = 1;i <= 30;i++)\n\t\tfa[u][i] = fa[fa[u][i - 1]][i - 1];\n\tint now = u;\n\tfor (int i = 30;i >= 0;i--)\n\t\tif (fa[now][i] && dis[u] - dis[fa[now][i]] <= a[u]) \n\t\t\tnow = fa[now][i];\n\tsum[fa[now][0]]--, sum[fa[u][0]]++;\n\tfor (int i = head[u];i;i = edge[i].nxt) {\n\t\tint v = edge[i].to; fa[v][0] = u;\n\t\tdis[v] = dis[u] + edge[i].val;\n\t\tdfs(v), sum[u] += sum[v];\n\t}\n}\n\nint main(void) {\n\tn = read();\n\tfor (int i = 1;i <= n;i++) a[i] = read();\n\tfor (int i = 2;i <= n;i++) {\n\t\tint u = read(), val = read();\n\t\taddedge(u, i, val);\n\t}\n\tdfs(1);\n\tfor (int i = 1;i <= n;i++) printf(\"%lld%c\", sum[i], \" \\n\"[i == n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1606139393,
        "uid": 246019,
        "name": "_came11ia_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6709\u6839\u6811\uff0c\u6c42\u51fa\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $i$ \uff0c\u5b83\u7684\u5b50\u6811\u91cc\u6709\u591a\u5c11\u4e2a\u8282\u70b9 $x$ \u6ee1\u8db3 $dis(i,x)\\leq a_x$\u3002\n\n\u9898\u89e3\uff1a\u5148\u5bf9\u8fd9\u4e2a\u6811\u8fdb\u884c\u6811\u4e0a\u5dee\u5206\u3001\u6c42dfs\u5e8f\u3001\u6c42\u6bcf\u4e2a\u70b9\u7684\u6df1\u5ea6 $d_i$\uff08\u5230\u6839\u8282\u70b9\u7684\u8ddd\u79bb\uff09\u3002\n\n\u7136\u540e\uff0c\u6709\u4e00\u4e2a\u5c0f\u7ed3\u8bba\uff1a\u8bbe\u8282\u70b9 $i$ \u7684\u5b50\u6811\u5927\u5c0f\u4e3a $s_i$\uff0c\u5219\u5b83\u7684\u5b50\u6811\u7684dfs\u5e8f\u533a\u95f4\u4e3a $[i,i+s_i-1]$\u3002\uff08\u5176\u5b9e\u5c31\u662fdfs\u5e8f\u7684\u5b9a\u4e49\uff09\n\n\u6240\u4ee5\uff0c\u8fd9\u9053\u9898\u8f6c\u5316\u6210\u4e86\uff1a\u5bf9\u4e8edfs\u5e8f\u4e3a $i$ \u7684\u8282\u70b9\uff0c\u6709\u591a\u5c11\u4e2adfs\u5e8f\u4e3a $x$\uff08$x\\in [i+1,i+s_i-1]$\uff09\u7684\u8282\u70b9\u6ee1\u8db3 $d_x-a_x\\leq d_i$\uff0c\u5176\u5b9e\u5c31\u662f\u9759\u6001\u533a\u95f4\u6c42\u6392\u540d\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u6811\u5957\u6811/\u4e3b\u5e2d\u6811/\u6574\u4f53\u4e8c\u5206\u89e3\u51b3\u8fd9\u4e2a\u9898\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log^2 n)$\u3002\n\n\u5176\u5b9e\u8fd8\u53ef\u4ee5\u5199\u5206\u5757\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\sqrt n \\log\\sqrt n)$\u3002\n\n\u7531\u4e8e $n\\leq 2\\times 10^5$\uff0c\u4e0a\u8ff0\u505a\u6cd5\u5747\u53ef\u901a\u8fc7\u6b64\u9898\u3002",
        "postTime": 1603962105,
        "uid": 104662,
        "name": "PrincessQi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "\u975e\u5e38\u88f8\u7684\u505a\u6cd5 \u63d0\u4f9b\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u5408\u5e76\n\n$dist(x,y)\\leq a[y] \\ \\  \\ y \\in subtree_x$\n\n\u5f00\u4e2a\u524d\u7f00\u548c(\u5230\u6839\u8ddd\u79bb)\u6570\u7ec4$dis[]$ \u8f6c\u5316\u6210\n\n$dis[y]-dis[x]\\leq a[y]$\n\n\u79fb\u9879\u5f97\n\n$dis[y]-a[y]\\leq dis[x]$\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u70b9p \u5148\u67e5\u5408\u5e76\u4e0a\u6765\u7684\u6570\u636e\u7ed3\u6784(\u8868\u793a\u4e86p\u4e0d\u5305\u542b\u7684\u5b50\u6811)\u91cc\u5dee\u6709\u591a\u5c11\u4e2a$\\leq dis[p]$\u7684 \u7136\u540e\u628a$dis[p]-a[p]$\u4f5c\u4e3a\u5173\u952e\u5b57\u6254\u5230\u6570\u636e\u7ed3\u6784\u91cc\n\n\u8fb9\u6743\u662f$10^9$\u7ea7\u522b\u7684 \u6700\u5927\u8ddd\u79bb\u53ef\u80fd\u8fbe\u5230$2*10^{14}$\n\n\u7528\u7ebf\u6bb5\u6811\u4e0d\u592a\u597d\u641e \u6211\u5c31\u5199\u4e86\u4e2a$splay$\u542f\u53d1\u5f0f\u5408\u5e76\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u53d6\u5b50\u6811\u6700\u5927\u7684\u513f\u5b50\u4f5c\u91cd\u513f\u5b50 \u628a\u8f7b\u513f\u5b50\u5408\u5e76\u5230\u91cd\u513f\u5b50\u4e0a\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u590d\u6742\u5ea6\n\n```cpp\n#include<cstdio>\ntemplate<class type>inline const void read(type &in)\n{\n\tin=0;char ch(getchar());\n\twhile (ch<48||ch>57)ch=getchar();\n\twhile (ch>47&&ch<58)in=(in<<3)+(in<<1)+(ch&15),ch=getchar();\n}\ntypedef long long ll;\nconst int N(2e5+5);\nstruct tree\n{\n\tll key;\n\tint cnt,size;\n\ttree *fa,*son[2];\n\tstatic tree *null;\n\tvoid *operator new(size_t size);\n\tvoid operator delete(void *ptr);\n\tinline tree():key(0),cnt(0),size(0),fa(null){son[0]=son[1]=null;}\n\tinline tree(const ll &key,const int &cnt):key(key),cnt(cnt),size(cnt),fa(null){son[0]=son[1]=null;}\n\tinline const void pushup()\n\t{\n\t\tsize=son[0]->size+cnt+son[1]->size;\n\t}\n\tinline const void set(tree *p,const bool &f)\n\t{\n\t\tif (p!=null)p->fa=this;\n\t\tif (this!=null)son[f]=p;\n\t}\n\tinline const bool id()\n\t{\n\t\treturn fa->son[1]==this;\n\t}\n\tinline const void rotate()\n\t{\n\t\ttree *fa(this->fa);\n\t\tconst bool f(id());\n\t\tfa->fa->set(this,fa->id());\n\t\tfa->set(son[!f],f);\n\t\tset(fa,!f);\n\t\tfa->pushup();pushup();\n\t}\n\tinline const void splay(tree *&root);\n}*root[N],*tree::null;\n#define null tree::null\nchar memory_pool[N*sizeof(tree)],*tail(memory_pool+sizeof(memory_pool));\nvoid *recycle[N],**top(recycle);\ninline void *tree::operator new(size_t size){return recycle!=top?*--top:tail-=size;}\ninline void tree::operator delete(void *ptr){*top++=ptr;}\ninline const void tree::splay(tree *&root)\n{\n\tfor (;fa!=null;rotate())\n\t\tif (fa->fa!=null)\n\t\t\t(fa->id()^id()?this:fa)->rotate();\n\troot=this;\n}\ninline const void insert(tree *&root,const ll &key,const int &cnt)\n{\n\tif (root==null)return root=new tree(key,cnt),void();\n\ttree *now(root);\n\twhile (1)\n\t{\n\t\tif (now->key==key)return now->cnt+=cnt,now->pushup(),now->splay(root);\n\t\ttree *fa(now);\n\t\tconst bool f(now->key<key);\n\t\tnow=fa->son[f];\n\t\tif (now==null)return fa->set(now=new tree(key,cnt),f),fa->pushup(),now->splay(root);\n\t}\n}\ninline const int query(tree *&root,const ll &key)\n{\n\tint sum(0);\n\ttree *p(root);\n\twhile (p!=null)\n\t\tif (key<p->key)p=p->son[0];\n\t\telse if (key==p->key)return sum+p->son[0]->size+p->cnt;\n\t\t\telse sum+=p->son[0]->size+p->cnt,p=p->son[1];\n\treturn sum;\n}\ninline const void merge(tree *a,tree *&b)\n{\n\tif (a==null)return;\n\tmerge(a->son[0],b);\n\tmerge(a->son[1],b);\n\tinsert(b,a->key,a->cnt);\n\tdelete a;\n}\nint head[N],a[N],edc,n,ans[N];\nstruct edge\n{\n\tint to,w,next;\n\tinline edge(){}\n\tinline edge(const int &to,const int &w,const int &next):to(to),w(w),next(next){}\n}e[N<<1];\ninline const void addedge(const int &u,const int &v,const int &w)\n{\n\te[++edc]=edge(v,w,head[u]);head[u]=edc;\n}\nll dis[N];\nvoid check(tree *p)\n{\n\tif (p==null)return;\n\tcheck(p->son[0]);\n\tprintf(\":%lld lson:%lld rson:%lld fa:%lld size:%d cnt:%d\\n\",p->key,p->son[0]->key,p->son[1]->key,p->fa->key,p->size,p->cnt);\n\tcheck(p->son[1]);\n}\ninline const void dfs(const int &p)\n{\n\troot[p]=null;\n\tint wson(0),wsiz(0);\n\tfor (int son,i(head[p]);i;i=e[i].next)\n\t\tif (dis[son=e[i].to]=dis[p]+e[i].w,dfs(son),root[son]->size>wsiz)\n\t\t\twsiz=root[son]->size,wson=son;\n\tif (!wson)return insert(root[p],dis[p]-a[p],1);\n\tfor (int i(head[p]);i;i=e[i].next)\n\t\tif (e[i].to^wson)\n\t\t\tmerge(root[e[i].to],root[wson]);\n\troot[p]=root[wson];\n\tans[p]=query(root[p],dis[p]);\n\tinsert(root[p],dis[p]-a[p],1);\n}\nint main()\n{\n\tnull=new tree;null->fa=null->son[0]=null->son[1]=null;\n\tread(n);\n\tfor (int i(1);i<=n;i++)read(a[i]);\n\tfor (int i(2),fa,w;i<=n;i++)read(fa),read(w),addedge(fa,i,w);\n\tdfs(1);\n\tfor (int i(1);i<=n;i++)printf(\"%d \",ans[i]);\n\tputchar('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1600776467,
        "uid": 14374,
        "name": "zhengrunzhe",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    },
    {
        "content": "\u505a\u6cd5\uff1a\u53d1\u73b0\u6bcf\u4e00\u4e2a\u70b9\u90fd\u662f\u8fd9\u4e2a\u70b9\u5230\u6839\u4e0a\u8fde\u7eed\u7684\u4e00\u6bb5\u4e14\u6ca1\u6709\u8d1f\u6743\u8fb9\u3002\u53ef\u4ee5\u500d\u589e\u627e\u5230\u6700\u8fdc\u7684\u70b9\u5e76\u4f7f\u7528\u5dee\u5206\u8bb0\u5f55\u7b54\u6848\uff0c\n\n\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1;\n\tchar c=getchar();\n\twhile(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n\twhile(isdigit(c)){x=(x<<3)+(x<<1)+(c^48);c=getchar();}\n\treturn x*f;\n}\nconst int N=400040;\nint head[N],cnt;\nstruct edge\n{\n\tint nxt,to,dis;\n}e[N];\nint n;\nint a[N];\nint dp[N][21],sum[N][21],ans[N];//dp[i][j]\u8868\u793ai\u53f7\u70b9\u5f80\u4e0a\u8d702^j\u6b65\u7684\u70b9\uff0csum[i][j]\u5219\u5b58\u4ece\u8fd9\u4e9b\u503c\u7684\u548c\nint Log[N];\n\ninline void init_edge()\n{\n\tcnt=0;\n\tmemset(head,-1,sizeof(head));\n}\n\ninline void add_edge(int u,int v,int d)\n{\n\te[++cnt].nxt=head[u];\n\te[cnt].to=v;\n\te[cnt].dis=d;\n\thead[u]=cnt;\n}\n\ninline void dfs1(int u,int f,int dis)\n{\n\tdp[u][0]=f;sum[u][0]=dis;//\u81ea\u5df1\u5f80\u4e0a\u8d702^0\u6b65\u5c31\u662f\u81ea\u5df1\u7684\u7236\u4eb2\uff0c\u548c\u4e3a\u8fb9\u6743\n\tfor(int i=head[u];i!=-1;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==f)continue;\n\t\tdfs1(v,u,e[i].dis);\n\t}\n}\ninline void dfs2(int u,int f)//\u91cd\u65b0\u904d\u5386\u4e00\u904d\u6811\uff0c\u6c42\u503c\n{\n\tfor(int i=head[u];i!=-1;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==f)continue;\n\t\tdfs2(v,u);\n\t\tans[u]+=ans[v];\n\t}\n}\ninline void init_st()//\u9884\u5904\u7406st\u8868\n{\n\tLog[0]=-1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tLog[i]=Log[i>>1]+1;//\u9884\u5904\u7406log\n\t}\n\tfor(int j=1;j<=Log[n];j++)\n\t{\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tdp[i][j]=dp[dp[i][j-1]][j-1];//\u5f80\u4e0a\u8d702^j\u6b65\n\t\t\tsum[i][j]=sum[i][j-1]+sum[dp[i][j-1]][j-1];\n\t\t}\n\t}\n}\n\ninline void check(int qwq)\n{\n\tint x=qwq\uff0cy=a[qwq];\n\tfor(int i=Log[n];i>=0;i--)\n\t{\n\t\tif(sum[x][i]<=y)//\u679a\u4e3e\u8fd9\u4e2a\u70b9\u6700\u8fdc\u80fd\u8d70\u5230\u54ea\u91cc\n\t\t{\n\t\t\ty-=sum[x][i];\n\t\t\tx=dp[x][i];\n\t\t}\n\t}\n\tans[dp[x][0]]--;ans[dp[qwq][0]]++;//\u6811\u4e0a\u5dee\u5206\uff0c\u663e\u7136\u8fd9\u662f\u6761\u94fe\uff08\u6811\u4e0a\u5dee\u5206\u6a21\u7248\u9898CF191C\n}\n\nsigned main()\n{\n\tinit_edge();\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\ta[i]=read();\n\t}\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint v=read(),d=read();\n\t\tadd_edge(i,v,d),add_edge(v,i,d);\n\t}\n\tdfs1(1,0,0);\n\tinit_st();\n\tfor(int i=1;i<=n;i++) check(i);\n\tdfs2(1,0);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tcout<<ans[i]<<\" \";\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1591890301,
        "uid": 115779,
        "name": "\u6781\u5bd2\u795e\u51b0",
        "ccfLevel": 0,
        "title": "CF739B"
    },
    {
        "content": "\u7ed9\u51fa\u4e00\u4e2a\u6bd4\u500d\u589e\u4f18\u96c5\u5f97\u591a\u7684Dsu on tree\u7684\u505a\u6cd5\u3002\n\n\u753b\u56fe\u540e\u6ce8\u610f\u5230\u6bcf\u4e00\u4e2a\u70b9\u5f71\u54cd\u7684\u8282\u70b9\u90fd\u662f\u81ea\u8eab\u5230\u7956\u5148\u7684\u4e00\u6761\u94fe\uff0cdeep[u]-A[u]\u5373\u786e\u5b9a\u4e86\u8fd9\u4e2a\u70b9\u6240\u80fd\u5f71\u54cd\u7684\u6700\u65e9\u7956\u5148\u6df1\u5ea6\uff0c\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\u5c31\u662f\u5f53\u524d\u8282\u70b9\u5b50\u6811\u91cc\u6700\u65e9\u7956\u5148\u6df1\u5ea6\u5c0f\u4e8e\u5f53\u524d\u8282\u70b9\u7684\u6df1\u5ea6\u7684\u8282\u70b9\u4e2a\u6570\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7528\u5927\u6839\u5806\u76f4\u63a5\u7ef4\u62a4\uff0cpb_ds\u91cc\u7684\u914d\u5bf9\u5806\u5408\u5e76\u7684\u590d\u6742\u5ea6\u4e3aO(1),\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u81ea\u5e95\u5411\u4e0a\u5408\u5e76\u6bcf\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\u7684\u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#include <ext/pb_ds/priority_queue.hpp>\n#include<ext/pb_ds/assoc_container.hpp>\n#include<ext/pb_ds/hash_policy.hpp>\nusing namespace std;\n#define int long long\nvector<pair<int, int> > edge[210000];\narray<int, 210000> arr, ans, size1, deep;\n__gnu_pbds::priority_queue<pair<int, int>, less<pair<int, int> > > *calc[210000];\nvoid dfs(int u, int fa)\n{\n\tfor (auto &k : edge[u])\n\t{\n\t\tint p = k.first;\n\t\tif (p != fa)\n\t\t{\n\t\t\tdeep[p] = deep[u] + k.second;\n\t\t\tdfs(p, u);\n\t\t\tsize1[u] += size1[p];\n\t\t\tcalc[u]->join(*calc[p]);\n\t\t}\n\t}\n\twhile (!calc[u]->empty() && (calc[u]->top()).first > deep[u])\n\t\tcalc[u]->pop();\n\tans[u] = (int)calc[u]->size();\n\tcalc[u]->push({ deep[u] - arr[u],u });\n}\nint32_t main()\n{\n\tios::sync_with_stdio(false);\n\tcin.tie(NULL);\n\tcout.tie(NULL);\n\tint n, m, u, v;\n\tsize1.fill(1);\n\tans.fill(0);\n\tdeep[1] = 0;\n\tcin >> n;\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\tcin >> arr[i];\n\t\tcalc[i] = new __gnu_pbds::priority_queue<pair<int, int>, less<pair<int, int> > >();\n\t}\n\tfor (int i = 2; i <= n; ++i)\n\t{\n\t\tcin >> u >> v;\n\t\tedge[u].push_back({ i,v });\n\t\tedge[i].push_back({ u,v });\n\t}\n\tdfs(1, 0);\n\tfor (int i = 1; i <= n; ++i)\n\t\tcout << ans[i] << ' ';\n\treturn 0;\n}\n```\n",
        "postTime": 1573034039,
        "uid": 154957,
        "name": "qiyue7",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF739B \u3010Alyona and a tree\u3011"
    }
]