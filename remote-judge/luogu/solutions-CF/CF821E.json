[
    {
        "content": "[]()\n\n\u4f60\u5728 $(0,0)$\u3002\n\n\u5728 $(x,y)$ \u65f6\uff0c\u6bcf\u6b21\u79fb\u52a8\u53ef\u4ee5\u5230\u8fbe $(x+1,y+1),(x+1,y),(x+1,y-1)$\u3002\n\n\u5e73\u9762\u4e0a\u6709 $n$ \u6761\u7ebf\u6bb5\uff0c\u5e73\u884c\u4e8e $x$ \u8f74\uff0c\u53c2\u6570\u4e3a$a_i$\uff0c$b_i$\uff0c$c_i$\uff0c\u8868\u793a\u5728 $(a_i,c_i)$ \u5230 $(b_i,c_i)$ \u7684\u4e00\u6761\u7ebf\u6bb5\uff0c\u4fdd\u8bc1 $b_i=a_{i+1}$\u3002\n\n\u8981\u6c42\u4f60\u4e00\u76f4\u5728\u7ebf\u6bb5\u7684\u4e0b\u65b9\u4e14\u5728 $x$ \u8f74\u4e0a\u65b9\uff0c\u5373 $a_i \\leq x \\leq b_i$ \u65f6\uff0c $0 \\leq y \\leq c_i$\u3002\n\n\u95ee\uff1a\u5230\u8fbe $(k,0)$ \u7684\u65b9\u6848\u6570\uff0c\u65b9\u6848\u6570\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n\u6211\u4eec\u8bbe $dp_{i,j}$ \u8868\u793a\u8d70\u5230 $(i,j)$ \u7684\u65b9\u6848\u6570\uff0c$k_i$ \u8868\u793a $x$ \u5750\u6807\u4e3a $i$ \u65f6\u884c\u52a8\u7684\u4e0a\u754c\u3002\n\n\u6309\u7167\u9898\u610f\uff0c\u9012\u63a8\u5f0f\uff1a\n$$dp_{i,j}=\\begin{cases}dp_{i-1,j-1}+dp_{i-1,j}&(j=k_i)\\\\dp_{i-1,j-1}+dp_{i-1,j}+dp_{i-1,j+1}&(0<j<k_i)\\\\dp_{i-1,j}+dp_{i-1,j+1}&(j=0)\\end{cases}$$\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u5f62\u5982 $\\begin{pmatrix}1&1&0&\\cdots&0&0&0\\\\1&1&1&\\cdots&0&0&0\\\\\\vdots&&&\\ddots&&&\\vdots\\\\0&0&0&\\cdots&1&1&1\\\\0&0&0&\\cdots&0&1&1\\end{pmatrix}$ \u7684\u77e9\u9635\u8fdb\u884c\u8f6c\u79fb\u3002\u7528\u5feb\u901f\u5e42\u4f18\u5316\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u8fd9\u662f\u4e00\u79cd\u4f18\u5316\u9012\u63a8\u7684\u7b97\u6cd5\uff0c\u53ef\u4ee5\u7528 $O(\\lg n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8fdb\u884c $n$ \u6b21\u9012\u63a8\u3002\n\n\u9996\u5148\uff0c\u5b9a\u4e49\u77e9\u9635\u4e58\u6cd5\uff1a\n\n\u5bf9\u4e8e\u4e00\u4e2a $n\\times k$ \u7684\u77e9\u9635 $A$ \u548c\u4e00\u4e2a $k\\times m$ \u7684\u77e9\u9635 $B$ \u8fd8\u6709\u4e00\u4e2a\u77e9\u9635 $C=A\\times B$\u3002\u90a3\u4e48 $C$ \u662f\u4e00\u4e2a $n\\times m$ \u7684\u77e9\u9635\uff0c\u4e14 $C_{ij}=\\sum\\limits_{p=1}^kA_{i,p}\\times B_{p,j}(i=\\overline{1,2,\\cdots,n},j=\\overline{1,2,\\cdots,m})$\u3002\n\n\u7136\u540e\uff0c\u56e0\u4e3a\u77e9\u9635\u4e58\u6cd5\u6ee1\u8db3\u7ed3\u5408\u5f8b\uff0c\u6240\u4ee5\u6211\u4eec\u6709\u4e86\u77e9\u9635\u5feb\u901f\u5e42\u3002\u77e9\u9635\u5feb\u901f\u5e42\u7684\u8bdd\u5c31\u662f\u628a\u5feb\u901f\u5e42\u7684\u677f\u5b50\u5957\u5728\u77e9\u9635\u4e0a\u800c\u5df2\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n  #include<bits/stdc++.h>\n  #define int long long \n  using namespace std;\n  const int mod=1e9+7;\n  int n,k,a,b,c;\n  struct M{\n      int a[20][20];\n      M operator*(M t){\n          M res;\n          for(int i=0;i<=15;i++)for(int j=0;j<=15;j++)res.a[i][j]=0;\n          for(int i=0;i<=15;i++){\n              for(int j=0;j<=15;j++){\n                  for(int k=0;k<=15;k++){\n                      res.a[i][j]=(res.a[i][j]+a[i][k]*t.a[k][j]%mod)%mod;\n                  }\n              }\n          }\n          return res;\n      }\n      M operator^(int k){\n          M res,_=*this;\n          for(int i=0;i<=15;i++)for(int j=0;j<=15;j++)res.a[i][j]=(i==j);\n          while(k){\n              if(k&1)res=res*_;\n              _=_*_;\n              k>>=1;\n          }\n          return res;\n      }\n  }ans,base;\n  signed main()\n  {\n      scanf(\"%lld%lld\",&n,&k);\n      for(int j=0;j<=15;j++)for(int k=0;k<=15;k++)ans.a[j][k]=0;\n      ans.a[0][0]=1;\n      for(int i=1;i<=n;i++){\n          scanf(\"%lld%lld%lld\",&a,&b,&c);\n          if(b>=k)b=k;\n          for(int j=0;j<=15;j++)for(int l=0;l<=15;l++)base.a[j][l]=0;\n          for(int j=0;j<=c;j++){\n              base.a[j][j]=1;\n              if(j<c)base.a[j][j+1]=1;\n              if(j)base.a[j][j-1]=1;\n          }\n          ans=(base^(b-a))*ans;\n          if(b>=k)break;\n      }\n      printf(\"%lld\",ans.a[0][0]);\n      return 0;\n  }\n```",
        "postTime": 1661503914,
        "uid": 428358,
        "name": "cqbztzl",
        "ccfLevel": 5,
        "title": "CF821E\u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u6211\u4eec\u4ece\u6700\u7b80\u5355\u7684dp\u5f00\u59cb\n\n$dp[i][j]=dp[i-1][j]+dp[i-1][j+1]+dp[i-1][j-1]$\n\n\u7136\u540e\u8fd9\u662f\u4e00\u4e2aO(NM)\u7684\u505a\u6cd5\uff0c\u80af\u5b9a\u884c\u4e0d\u901a\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u4f7f\u7528\u77e9\u9635\u52a0\u901f\n\n$\\begin{bmatrix} 1\\\\ 0 \\\\0\\\\0\\end{bmatrix}\\quad$\n\n\u9274\u4e8e\u7eb5\u5750\u6807\u5f88\u5c0f\uff0c\u8003\u8651\u5168\u90e8\u8bb0\u5f55\u4e0b\u6765\u3002\u5199\u6210\u4e00\u4e2a\u5411\u91cf\u7684\u5f62\u5f0f\u3002\u5982\u4e0a\uff0c\n\u7b2ci\u884c\u7684\u6570\u8868\u793a\u7eb5\u5750\u6807\u4e3ai-1\u7684\u65b9\u6848\u6570\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u8f6c\u79fb\n\n$\\begin{bmatrix} 1&1&0&0\\\\1&1&1&0 \\\\0&1&1&1\\\\0&0&1&1\\end{bmatrix}\\quad$\n\n\u6211\u4eec\u5c06\u4e0d\u8003\u8651\u7ebf\u6bb5\u7684\u8f6c\u79fb\u5199\u6210\u4ee5\u4e0a\u5f62\u5f0f\uff0c\u7136\u540e\u8003\u8651\u4e00\u4e0b\u5982\u679c\u6709\u7ebf\u6bb5\u5f71\u54cd\u5462\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u7c7b\u6bd4\u5f97\u5230\uff0c\u4e0a\u4e00\u4e2a\u77e9\u9635\u4e2d\u7684\u8fb9\u754c\u662f3\uff0c\u5982\u679c\u6211\u4eec\u4eba\u4e3a\u89c4\u5b9a\u4e0a\u8fb9\u754c\u662f2\u7684\u8bdd\u3002\u8f6c\u79fb\u5c31\u6210\u4e86\u8fd9\u4e2a\u6837\u5b50\n\n$\\begin{bmatrix} 1&1&0&0\\\\1&1&1&0 \\\\0&1&1&0\\\\0&0&0&0\\end{bmatrix}\\quad$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u662f\u4e0a\u8fb9\u754c\u548c\u4e0b\u8fb9\u754c\u65f6\uff0cmatrix[i][i].matrix[i][i-1].matrix[i][i+1]\u90fd\u662f1\uff0c\u7136\u540e\u4e0a\u4e0b\u8fb9\u754c\u81ea\u5df1\u5904\u7406\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u4e0a\u4e00\u4e2a\u77e9\u9635\u5feb\u901f\u5e42\u5c31\u53ef\u4ee5\u4e86\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<iostream>\nusing namespace std;\nconst long long mod=1e9+7;\nstruct node\n{\n\tint n,m;\n\tlong long base[20][20];\n\tnode operator * (const node &a)const \n\t{\n\t\tnode r;\n\t\tr.n=n,r.m=a.m;\n\t\tfor(int i=0;i<=n;i++)\tfor(int j=0;j<=a.m;j++)\tr.base[i][j]=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int j=1;j<=a.m;j++)\n\t\t\t\tfor(int k=1;k<=m;k++)\n\t\t\t\t\tr.base[i][j]=(r.base[i][j]+base[i][k]*a.base[k][j])%mod;\n\t\treturn r;\n\t}\n};//\u77e9\u9635\u6a21\u677f\nnode pas,ans;\nlong long a[120],b[120],c[120];\nnode kasumi(long long k)\n{\n\tnode res;\n\tres.n=res.m=pas.n;\n\tfor(int i=0;i<=res.n;i++)\tfor(int j=0;j<=res.m;j++)\tres.base[i][j]=0;\n\tfor(int i=0;i<=res.n;i++)\tres.base[i][i]=1;\n\twhile(k)\n\t{\n\t\tif(k&1)\tres=res*pas;\n\t\tpas=pas*pas;\n\t\tk>>=1;\n\t}\n\treturn res;//\u5feb\u901f\u5e42\n}\nint main()\n{\n\tlong long n,k;\n\tscanf(\"%lld%lld\",&n,&k);\n\tans.n=1;ans.m=16;\n\tfor(int i=1;i<=16;i++)\tfor(int j=1;j<=16;j++)\tans.base[i][j]=0;//\u8bfb\u5165\u6570\u636e\n\tans.base[1][1]=1;//\u5904\u7406\u521d\u59cb\u6570\u636e\n\tpas.n=16;pas.m=16;\n\tfor(int i=1;i<=n;i++)\tscanf(\"%lld%lld%lld\",&a[i],&b[i],&c[i]);//\u8f93\u5165\n\tfor(int l=1;l<=n;l++)//\u7136\u540e\u6309\u7167\u987a\u5e8f\u904d\u5386\u7ebf\u6bb5\n\t{\n\t\tfor(int i=0;i<=16;i++)\tfor(int j=0;j<=16;j++)\tpas.base[i][j]=0;//\u91cd\u65b0\u6e05\u96f6\n\t\tfor(int i=1;i<=c[l]+1;i++)\n\t\t{//\u5904\u7406\u8f6c\u79fb\u6570\u7ec4\n\t\t\tif(i!=1)\tpas.base[i][i-1]=1;\n\t\t\tpas.base[i][i]=1;\n\t\t\tif(i!=c[l]+1)\tpas.base[i][i+1]=1;\n\t\t}\n\t\tans=ans*kasumi(min(b[l],k)-a[l]);//\u5feb\u901f\u5e42\u5c31\u53ef\u4ee5\u4e86\n\t}\n\tprintf(\"%lld\",ans.base[1][1]);\n}\n```",
        "postTime": 1531832517,
        "uid": 28007,
        "name": "Lance1ot",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF821E \u3010Okabe and El Psy Kongroo\u3011"
    },
    {
        "content": "\u867d\u7136\u6709\u76f8\u540c\u7684\u9898\u89e3\u5df2\u7ecf\u6709\u4e86\uff0c\u4f46\u662f\u4f5c\u4e3a\u77f3\u5934\u95e8\u53a8\u8fd8\u662f\u60f3\u53d1\u4e00\u7bc7\u3002\n\n\u611f\u89c9\u5b8c\u5168\u6ca1\u5fc5\u8981\u8bc4\u7d2b\uff0cCF \u8bc4\u5206\u4e5f\u4e0d\u9ad8\u3002\n\n[Link](https://www.luogu.com.cn/problem/CF821E)\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\uff0c\u521d\u59cb\u5728 $(0,0)$\uff0c\u6bcf\u6b21\u53ef\u4ee5\u4ece $(x,y)$ \u8d70\u5230 $(x+1,y+1),(x+1,y),(x+1,y-1)$ \u8fd9\u51e0\u4e2a\u4f4d\u7f6e\uff0c\u5e73\u9762\u4e0a\u6709 $n$ \u6761\u7ebf\u6bb5\uff0c\u7b2c $i$ \u6761\u7ebf\u6bb5\u7684\u7aef\u70b9\u662f $(a_i,c_i),(b_i,c_i)$\uff0c\u4fdd\u8bc1\u8fd9\u51e0\u6761\u7ebf\u6bb5\u5728\u6a2a\u5750\u6807\u4e0a\u8fde\u7eed\u3002\n\n\u95ee\u4fdd\u8bc1\u5168\u7a0b\u5728\u7ebf\u6bb5\u4e0b\u65b9\uff0c\u4e14\u5728 $x$ \u8f74\u4e0a\u65b9\uff08\u53ef\u91cd\u5408\uff09\u7684\u524d\u63d0\u4e0b\uff0c\u8d70\u5230 $(k,0)$ \u7684\u65b9\u6848\u6570\uff0c\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n$1\\leq n \\leq 100,1\\leq k \\leq 10^{18},a_{n}\\leq k \\leq b_n,c_i\\leq 15$\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u6700\u6734\u7d20\u7684\u60f3\u6cd5\uff0c\u76f4\u63a5 $O(kc)$  \u66b4\u529b dp \u5373\u53ef\uff0c\u5177\u4f53\u7684\u8bbe $dp_{i,j}$ \u8868\u793a\u5230\u8fbe $(i,j)$ \u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u663e\u7136\u6709\uff1a\n\n$dp_{i,j} = dp_{i-1,j-1}+dp_{i-1,j}+dp_{i-1,j+1}$\u3002\n\n\u8fb9\u754c\u6761\u4ef6\u5f53 $j=0$ \u6216 $15$ \u65f6\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\uff0c\u4ee5\u53ca\u5bf9\u4e8e\u5f53\u524d\u533a\u95f4\u7684\u6700\u5927\u4e0a\u9650\u5904\u7406\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u4e0d\u96be\u53d1\u73b0 $k$ \u662f\u7edd\u5bf9\u4e0d\u80fd\u6cbe\u7684\uff0c\u6240\u4ee5\u8003\u8651\u66f4\u4e3a\u9ad8\u5999\u7684\u65b9\u6cd5\uff0c\u4e0d\u96be\u53d1\u73b0\u5bf9\u4e8e\u4e0a\u9650\u76f8\u540c\u7684\u533a\u95f4\u7684\u8f6c\u79fb\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5c06 $n$ \u4e2a\u533a\u95f4\u5206\u5f00\u6765\u5904\u7406\uff0c\u6240\u4ee5\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5982\u4f55\u5feb\u901f\u6c42\u51fa\u4e0a\u9650\u76f8\u540c\u7684\u4e00\u6bb5\u533a\u95f4\u7684\u8d21\u732e\u3002\n\n\u53d1\u73b0\u4e0a\u9762\u7684\u90a3\u4e2a\u8f6c\u79fb\u53ef\u4ee5\u5f88\u597d\u7684\u53d8\u6210\u77e9\u9635\u7684\u5f62\u5f0f\uff0c\u5728\u8f6c\u79fb\u77e9\u9635\u4e0a\u6bcf\u4e2a\u4f4d\u7f6e\u662f\u5426\u4e3a $1$ \u8868\u793a\u5728\u8f6c\u79fb\u540e\u80fd\u5426\u7edf\u8ba1\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u5373\u53ef\uff0c\u4f8b\u5982\u7b2c\u4e00\u7ec4\u6837\u4f8b\uff0c\u5c31\u53ef\u4ee5\u6784\u9020\u51fa\u8fd9\u6837\u7684\u8f6c\u79fb\u77e9\u9635\u3002\n\n$\\begin{bmatrix}\n 1& 1 & 0 &0\\\\\n 1& 1 & 1&0\\\\\n 0& 1 & 1&1\\\\\n 0& 0 & 1&1\n\\end{bmatrix}$\n\n\u81ea\u5df1\u624b\u6a21\u4e00\u4e0b\u4e0d\u96be\u5f97\u51fa\uff0c\u76f4\u63a5\u60f3\u4e5f\u597d\u50cf\uff0c\u8f6c\u79fb\u77e9\u9635\u5bf9\u5e94\u80fd\u591f\u8d21\u732e\u7ed9\u4e0b\u4e00\u4e2a\u77e9\u9635\u7684\u5730\u65b9\u586b $1$ \u5c31\u597d\u3002\n\n\u5982\u4f55\u5feb\u901f\u6c42\u957f\u4e3a $x$ \u7684\u533a\u95f4\u7684\u8d21\u732e\u5462\uff1f\u5bf9\u8f6c\u79fb\u77e9\u9635\u6c42\u4e00\u4e2a\u77e9\u9635\u5feb\u901f\u5e42\u5373\u53ef\u3002\n\n\u6240\u4ee5\u6700\u7ec8\u53ea\u9700\u8981\u5c06\u539f\u5e8f\u5217\u5206\u6bb5\uff0c\u6bcf\u6b21\u6c42\u51fa\u5bf9\u5e94\u7684\u8f6c\u79fb\u77e9\u9635\uff0c\u679a\u4e3e\u4e00\u904d\u6240\u6709\u6bb5\uff0c\u5229\u7528\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u8f6c\u79fb\u5373\u53ef\u3002\n\n## Code\n\n\u5c01\u88c5\u4e00\u4e0b\u77e9\u9635\u4e58\u4f1a\u7a0d\u5fae\u7f8e\u89c2\u4e00\u4e9b\u3002\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <queue>\n#define int long long\nusing namespace std;\nint read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nconst int N = 105;\nconst int S = 16;\nint Mod = 1e9+7;\nint n,k;\nint a[N],b[N],c[N];\nstruct Matrix{\n\tint val[S][S],x,y;\n\tvoid clear(){\n\t\tx = 0;y = 0;\n\t\tmemset(val,0,sizeof(val));\n\t}\n\tMatrix operator*(const Matrix &u)const{\n\t\tMatrix res;\n\t\tres.clear();\n\t\tfor(int i=0;i<=x;i++){\n\t\t\tfor(int j=0;j<=u.y;j++){\n\t\t\t\tfor(int k=0;k<=y;k++){\n\t\t\t\t\tres.val[i][j] = (res.val[i][j]+val[i][k]*u.val[k][j]%Mod)%Mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tres.x = x;res.y = u.y;\n\t\treturn res; \n\t}\n\tvoid print(){\n\t\tcout<<\"XY:\"<<x<<\" \"<<y<<'\\n';\n\t\tfor(int i=0;i<=x;i++){\n\t\t\tfor(int j=0;j<=y;j++){\n\t\t\t\tcout<<val[i][j]<<\" \";\n\t\t\t}\n\t\t\tcout<<\"\\n\"; \n\t\t}\n\t\tcout<<\"-----------------------------------\\n\";\n\t}\n\t\n}zy,dwy;\nMatrix ksm(Matrix x,int y){\n\tMatrix res = dwy;\n\twhile(y){\n\t\tif(y&1){\n\t\t\tres = res*x;\n\t\t}\n\t\ty>>=1;\n\t\tx = x*x;\n\t}\n\treturn res;\n}\nvoid init(int x){\n\tzy.clear();\n\tfor(int i=0;i<=x;i++){\n\t\tzy.val[max(0ll,i-1)][i] = 1;\n\t\tzy.val[i][i] = 1;\n\t\tzy.val[min(i+1,15ll)][i] = 1;\n\t}\n\tzy.x = 15;zy.y = 15;\n}\nint ans[S];\nsigned main(){\n\tn = read();k = read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i] = read();b[i] = read();c[i] = read();\n\t}\n\tfor(int i=0;i<=15;i++){\n\t\tzy.val[max(0ll,i-1)][i] = 1;\n\t\tzy.val[i][i] = 1;\n\t\tzy.val[min(i+1,15ll)][i] = 1;\n\t\tdwy.val[i][i] = 1;\n\t}\n\tdwy.x = 15;dwy.y = 15;\n\tans[0] = 1;\n\tfor(int i=1;i<n;i++){\n\t\tMatrix f;\n\t\tf.clear();\n\t\tf.x = 0;f.y = 15;\n\t\tfor(int j=0;j<=c[i];j++){\n\t\t\tf.val[0][j] = ans[j];\n\t\t}\n\t\tinit(c[i]);\n\t\tf = f*ksm(zy,b[i]-a[i]);\n\t\tfor(int j=0;j<=15;j++){\n\t\t\tans[j] = f.val[0][j];\n\t\t}\n\t}\n\tMatrix f;\n\tf.clear();\n\tf.x = 0;f.y = 15;\n\tinit(c[n]);\n\tfor(int j=0;j<=c[n];j++){\n\t\tf.val[0][j] = ans[j];\n\t}\n\tf = f*ksm(zy,k-a[n]);\n\tfor(int j=0;j<=15;j++){\n\t\tans[j] = f.val[0][j];\n\t}\n\tcout<<ans[0]<<\"\\n\";\n\treturn 0;\n}\n\n```\n\n\u200c\u5728\u4e00\u4e2a\u6211\u4e0d\u5b58\u5728\u7684\u4e16\u754c\u91cc\u552f\u4e00\u8bb0\u5f97\u6211\u7684\u4f60\u5f88\u75db\u82e6\u5427\uff1f",
        "postTime": 1680009933,
        "uid": 369399,
        "name": "yizhiming",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010Okabe and El Psy Kongroo\u3011"
    },
    {
        "content": "~~El Psy Kongroo\u3002~~\n\n**\u9898\u76ee\u5206\u6790**\n\n\u56e0\u4e3a\u6bcf\u6b21\u53ea\u80fd\u5411\u524d\u8d70\uff0c\u6240\u4ee5\u72b6\u6001\u7684\u8f6c\u79fb\u5c31\u5f88 simple \u4e86\u3002\u6211\u4eec\u8bbe $f_{i,j}$ \u8868\u793a okabe \u8d70\u5230 $(i,j)$ \u65f6\u7684\u603b\u65b9\u6848\u6570\uff0c\u663e\u7136\u6709\uff1a\n\n$$f_{i,j}=f_{i-1,j}+f_{i-1,j-1}\\times[j>0]+f_{i-1,j+1}\\times[j<c_i]$$\n\n\u590d\u6742\u5ea6 $O(c\\times k)$\uff0c\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\n\n$k$ \u7684\u7ea7\u522b\u662f $1e18$ \u7684\uff0c$c$ \u5374\u5f88\u5c0f\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u5bf9 $k$ \u8fd9\u4e00\u7ef4\u8fdb\u884c\u4f18\u5316\u3002\u6211\u4eec\u8fdb\u4e00\u6b65\u89c2\u5bdf\uff0c\u53d1\u73b0 **$f_{i,* }$ \u53ea\u4e0e $f_{i-1,* }$ \u6709\u5173**\uff0c\u800c\u4e14\u8f6c\u79fb\u7684\u4e5f\u5341\u5206\u6709\u89c4\u5f8b\uff0c\u6839\u636e\u5957\u8def\uff0c\u6211\u4eec\u5bb9\u6613\u5217\u51fa\u4e0b\u9762\u7684\u5e26\u72b6\u77e9\u9635\uff1a\n\n$$\n\\begin{bmatrix}\n1&1&0&0&\\cdots&0&0&0&0\\\\\n1&1&1&0&\\cdots&0&0&0&0\\\\\n0&1&1&1&\\cdots&0&0&0&0\\\\\n\\vdots&&&&\\ddots&&&&\\vdots\\\\\n0&0&0&0&\\cdots&1&1&1&0\\\\\n0&0&0&0&\\cdots&0&1&1&1\\\\\n0&0&0&0&\\cdots&0&0&1&1\n\\end{bmatrix}\n$$\n\n\u6211\u4eec\u628a $f_{i,* }$ \u538b\u8fdb\u4e00\u4e2a\u77e9\u9635\u548c\u4e0a\u9762\u7684\u77e9\u9635\u76f8\u4e58\uff0c\u5f97\u5230\u7684\u65b0\u77e9\u9635\u5c31\u662f $f_{i+1,* }$ \u538b\u6210\u7684\u77e9\u9635\u3002\u518d\u5957\u4e0a\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6 $O(c^3\\log k)$\u3002\n\n**\u4ee3\u7801**\n\n```cpp\n#include<stdio.h>\n#include<string.h>\n\ntypedef long long ll;\nconst int mod=1e9+7;\n\ninline void add(int &x,int y) {x+=y-mod,x+=(x>>31)&mod;}\n\nint n,sz;\nll k,len;\n\nstruct Matrix\n{\n    int a[20][20];\n    Matrix() {memset(a,0,sizeof a);}\n}A,Empty;\n\ninline Matrix operator * (Matrix A,Matrix B)\n{\n    Matrix C;\n\n    for(int k=1;k<=sz;k++)\n        for(int i=1;i<=sz;i++)\n            for(int j=1;j<=sz;j++)\n                add(C.a[i][j],1ll*A.a[i][k]*B.a[k][j]%mod);\n\n    return C;\n}\n\ninline Matrix operator ^ (Matrix A,ll k)\n{\n    Matrix Base;\n    for(int i=1;i<=sz;i++) Base.a[i][i]=1;\n\n    while(k)\n    {\n        if(k&1) Base=Base*A;\n        A=A*A,k>>=1;\n    }\n\n    return Base;\n}\n\nint main()\n{\n    #ifdef Mr_Avalon\n    freopen(\"input\",\"r\",stdin);\n    freopen(\"output\",\"w\",stdout);\n    #endif\n\n    scanf(\"%d%lld\",&n,&k),A.a[1][1]=1;\n    for(int i=1;i<=n;i++)\n    {\n        ll a,b;int c;\n        scanf(\"%lld%lld%d\",&a,&b,&c);\n        len=(b>k? k:b)-a,sz=c+1;\n\n        Matrix tmp;\n        for(int j=1;j<=sz;j++) tmp.a[j][j-1]=tmp.a[j][j]=tmp.a[j][j+1]=1;\n        A=A*(tmp^len);\n    }\n    printf(\"%d\",A.a[1][1]);\n\n    #ifdef Mr_Avalon\n    printf(\"\\n%dms\\n\",int(1.0*clock()/CLOCKS_PER_SEC*1000));\n    #endif\n}\n```\n",
        "postTime": 1666942664,
        "uid": 363730,
        "name": "Mr_Avalon",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF821E \u3010Okabe and El Psy Kongroo\u3011"
    }
]