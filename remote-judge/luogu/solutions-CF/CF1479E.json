[
    {
        "content": "# CF1479E \u9898\u89e3\n\n## \u524d\u7f6e\u77e5\u8bc6\uff1a\u9785\u4e0e\u505c\u65f6\u5b9a\u7406\n\n#### \u9785\n\n\u6211\u4eec\u6709\u4e00\u4e2a\u968f\u673a\u8fc7\u7a0b $X_0,X_1, ...$\u3002\u5982\u679c $\\forall n \\in \\mathbb N, \\ E(Y_n) < \\infty$ \u4e14 $\\forall n \\in \\mathbb N^+, \\ E(Y_{n + 1}|X_n,X_{n-1},...,X_0) = E(Y_n)$\uff0c\u5219\u6211\u4eec\u79f0 $Y_0, Y_1, ...$ \u4e3a\u8be5\u968f\u673a\u8fc7\u7a0b\u7684\u9785\u3002\n\n#### \u79bb\u6563\u65f6\u95f4\u9785\n\n\u5982\u679c\u968f\u673a\u8fc7\u7a0b $X_0,X_1, ...$ \u6ee1\u8db3 $\\forall n \\in \\mathbb N, \\ E(X_n) < \\infty$ \u4e14 $\\forall n \\in \\mathbb N^+, \\ E(X_{n + 1}|X_n,X_{n-1},...,X_0) = E(X_n)$\uff0c\u5219\u6211\u4eec\u79f0\u8be5\u968f\u673a\u8fc7\u7a0b\u4e3a\u79bb\u6563\u65f6\u95f4\u9785\u3002\n\n\u5373\uff1a\u5df2\u77e5\u4e4b\u524d\u6240\u6709\u7684\u8fc7\u7a0b\uff0c\u4e4b\u540e\u7684\u89c2\u5bdf\u503c\u7684\u671f\u671b\u7b49\u4e8e\u4e4b\u524d\u7684\u89c2\u5bdf\u503c\u7684\u671f\u671b\n\n#### \u505c\u65f6\u5b9a\u7406\n\n\u5bf9\u4e8e\u4e00\u4e2a\u968f\u673a\u8fc7\u7a0b\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u4e4b\u524d\u7684\u8fc7\u7a0b\u5224\u65ad\u8be5\u8fc7\u7a0b\u662f\u5426\u5df2\u7ecf\u505c\u6b62\uff08\u5373\u4e0d\u7528\u77e5\u9053\u672a\u6765\u7684\u8fc7\u7a0b\uff09\uff0c\u5219\u4ed6\u7684\u505c\u65f6\u4e3a\u4e00\u4e2a\u968f\u673a\u53d8\u91cf $\\tau$\u3002\n\n\u5982\u679c\u6ee1\u8db3\u4e0b\u5217\u51e0\u4e2a\u6761\u4ef6\u4e4b\u4e00\uff0c\u5219\u6211\u4eec\u6709 $E(X_\\tau) = X_0$\u3002\n\n1. $\\tau$ \u51e0\u4e4e\u4e00\u5b9a\u6709\u754c\n2. $|X_{t + 1} - X_t|$ \u4e00\u81f4\u6709\u754c\uff0c\u4e14 $E(\\tau)$ \u6709\u9650\n3. $X_t$ \u4e00\u81f4\u6709\u754c\uff0c\u4e14 $\\tau$ \u51e0\u4e4e\u4e00\u5b9a\u6709\u9650\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u7531\u4e8e $\\tau$ \u4e0d\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u6240\u4ee5\u548c\u524d\u9762\u8bf4\u7684\u79bb\u6563\u65f6\u95f4\u9785\u7684\u5b9a\u4e49\u4e0d\u540c\u3002\n\n\u8bfb\u8005\u81ea\u8bc1\u4e0d\u96be\n\n#### OI\u91cc\u9762\u600e\u4e48\u7528\n\n\u6709\u968f\u673a\u8fc7\u7a0b $A_0, A_1, ...$\uff0c\u8003\u8651\u6784\u9020\u52bf\u80fd\u51fd\u6570 $\\phi$\u3002\u8981\u6c42 $E(\\phi(A_{t+1}) - \\phi(A_t) | A_t, A_{t-1}, ..., A_0) = -1$\u3002\n\n\u5219\u6211\u4eec\u6784\u9020\u968f\u673a\u8fc7\u7a0b $X_t = \\phi(A_t) + t$\uff0c\u6613\u8bc1 $X_0, X_1, ...$ \u4e3a\u79bb\u6563\u65f6\u95f4\u9785\u3002\n\n\u505c\u65f6\u5b9a\u7406\uff0c$E(X_\\tau) = X_0$ \u5373 $E(\\phi(A_\\tau) + \\tau) = \\phi(A_0)$\uff0c\u5219 $E(\\tau) = \\phi(A_0) - \\phi(A_\\tau)$\u3002\n\n## CF1479E School Clubs\n\n### Statement\n\n\u6709 $n$ \u4e2a\u5b66\u751f\u548c $m$ \u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u4eba\u5728\u4e00\u4e2a\u7ec4\u91cc\u9762\uff0c\u7b2c $i$ \u4e2a\u7ec4\u7684\u4eba\u6570\u4e3a $a_i$\u3002\n\n\u73b0\u5728\uff0c\u6bcf\u5929\u6709\u4e00\u4e2a\u5b66\u751f\uff08$n$ \u4e2a\u5b66\u751f\u4e2d\u968f\u673a\u7684\u4e00\u4e2a\uff09\u4f1a\u751f\u6c14\uff0c\u4ed6\u4f1a\uff1a\n\n1. \u6709\u4e00\u534a\u7684\u6982\u7387\u4ed6\u4f1a\u8131\u79bb\u8fd9\u4e2a\u7ec4\uff0c\u5e76\u4e14\u6210\u7acb\u4e00\u4e2a\u65b0\u7684\u7ec4\u3002\n2. \u6709\u4e00\u534a\u7684\u6982\u7387\u4ed6\u4f1a\u8131\u79bb\u8fd9\u4e2a\u7ec4\uff0c\u5e76\u4e14\u8fdb\u5165\u4e00\u4e2a\u5df2\u7ecf\u6210\u7acb\u7684\u7ec4\u3002\u4ed6\u8fdb\u5165\u7b2c $i$ \u4e2a\u7ec4\u7684\u6982\u7387\u4e3a $\\frac {a_i} n$\uff0c\u4ed6\u53ef\u80fd\u4f1a\u56de\u5230\u539f\u6765\u7684\u7ec4\u3002\n\n\u6c42\u7b2c\u4e00\u6b21\u51fa\u73b0\u6240\u6709\u5b66\u751f\u5728\u540c\u4e00\u4e2a\u7ec4\u7684\u671f\u671b\u5929\u6570\u3002\n\n$m \\le 1000$\uff0c$n \\le 4 \\times 10^8$\n\n### Sol\n\n\u5728\u8fd9\u9053\u9898\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u53ef\u91cd\u96c6\u6765\u63cf\u8ff0\u72b6\u6001\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u5982\u4f55\u8bbe\u8ba1 $\\phi$\u3002\n\n\u7531\u4e8e\u4e0d\u540c\u7ec4\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5206\u5f00\u8ba1\u7b97\u5176\u52bf\u80fd\uff0c\u5373 $\\phi(A_t) = \\sum _{a \\in A_t} f(a)$\u3002\n\n\u5206\u7c7b\u8ba8\u8bba\n\n1. \u64cd\u4f5c 1\uff0c\u6709\u4e00\u4e2a\u4eba\u79bb\u5f00\u4e86\u4e00\u4e2a\u7ec4\uff0c\u8fdb\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u7ec4\u3002\u5219\n   $$\n   \\phi(A_{t + 1}) = \\phi(A_t) - f(a_x) + f(a_x - 1) + f(1)\n   $$\n\n2. \u64cd\u4f5c 2\uff0c\u56de\u5230\u539f\u6765\u7ec4\u3002\u5219\n   $$\n   \\phi(A_{t + 1}) = \\phi(A_t)\n   $$\n\n3. \u64cd\u4f5c 2\uff0c\u6ca1\u6709\u56de\u5230\u539f\u6765\u7ec4\uff0c\u5219\n   $$\n   \\phi(A_{t + 1}) = \\phi(A_t) - f(a_x) + f(a_x - 1) - f(a_y) + f(a_y + 1)\n   $$\n\n\u7efc\u4e0a\n$$\n\\begin{aligned}\nE(\\phi(A_{t + 1})|A_t) &= \\sum _{i = 1} ^m \\dfrac {a_i} n \\cdot \\dfrac 1 2 \\left( \\phi(A_t) - f(a_i) + f(a_i - 1) + f(1) + \\dfrac {a_i} n \\phi(A_t) + \\sum _{j = 1}^m [i\\neq j] \\dfrac {a_j} n \\left(\\phi(A_t) - f(a_i) + f(a_i-1) - f(a_j) + f(a_j+1)\\right)\\right) \\\\\n&= \\sum _{i = 1} ^m \\dfrac {a_i} {2n} \\left( 2\\phi(A_t) + f(1) - \\dfrac {2n - a_i} n f(a_i) + \\dfrac {2n - a_i} n f(a_i - 1) + \\sum _{j \\neq i} (f(a_j+1) - f(a_j))\\right) \\\\\n&= \\phi(A_t) + \\dfrac 1 2 f(1) - \\sum_i\\dfrac {3na_i-2a_i^2}{2n^2} f(a_i) + \\sum_i\\dfrac {2na_i-a_i^2}{2n^2} f(a_i- 1) + \\sum_i \\dfrac {na_i - a_i^2} {2n^2} f(a_i + 1)\n\\end{aligned}\n$$\n\u6839\u636e\u52bf\u80fd\u51fd\u6570\u9700\u8981\u6ee1\u8db3\u7684\u8981\u6c42\n$$\nE(\\phi(A_{t+1})-\\phi(A_t) | A_t, A_{t-1},...,A_0) = -1\n$$\n\u6240\u4ee5\n$$\nf(1) + 2 + \\sum_i \\dfrac{a_i}{n^2} (-(3n-2a_i)f(a_i)+(2n-a_i)f(a_i-1)+(n-a_i)f(a_i + 1)) = 0\n$$\n\u7531\u4e8e $a_i=0$ \u662f\u4e0d\u4f1a\u4ea7\u751f\u8d21\u732e\u7684\uff08\u56e0\u4e3a\u4f60\u6c38\u8fdc\u4e0d\u53ef\u80fd\u52a8\u4ed6\uff09\u6240\u4ee5\u76f8\u5f53\u4e8e\u6254\u6389\u4e86\uff0c\u56e0\u6b64\u52bf\u80fd\u4e3a 0\uff0c\u5373 $f(0) = 0$\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u5173\u5fc3\u7684\u662f\u52bf\u80fd\u7684\u5dee\uff0c\u6240\u4ee5\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u53d6 $f(1)=-2$\uff0c\u628a\u5e38\u6570\u9879\u6d88\u6389\u3002\u5219\n$$\n\\sum_i \\dfrac{a_i}{n^2} (-(3n-2a_i)f(a_i)+(2n-a_i)f(a_i-1)+(n-a_i)f(a_i + 1)) = 0\n$$\n\n$$\n-(3n-2a)f(a)+(2n-a)f(a-1)+(n-a)f(a + 1) = 0\n$$\n\n#### \u7b97\u6cd5\u4e00\n\n$$\nf(a+1) = \\dfrac {(3n-2a)f(a)-(2n-a)f(a-1)} {n-a}\n$$\n\n\u7531\u4e8e $E(A_\\tau) = f(n)$\uff0c\u6240\u4ee5 $E(\\tau) = E(A_0) - E(A_\\tau) = \\sum f(a_i) - f(n)$\u3002\n\n\u7ebf\u6027\u66b4\u529b\u8ba1\u7b97\u3002\n\n\u8fd9\u4e2a\u600e\u4e48\u80fd\u8fc7\uff1f\uff1f\uff1f\n\nCF \u673a\u5b50\u592a\u5feb\u4e86\uff01\uff011\n\n#### \u7b97\u6cd5\u4e8c\n\n\u521a\u624d\u90a3\u4e2a\u67ff\u5b50\u4e5f\u53ef\u4ee5\u53d8\u6210\u8fd9\u6837\n$$\n(n-a)(f(a+1)-f(a)) = (2n-a)(f(a)-f(a-1))\n$$\n\u5219\u6211\u4eec\u8bb0 $f(a)$ \u7684\u5dee\u5206 $g(a)=f(a+1)-f(a)$\uff0c\u6709\n$$\ng(a) = \\dfrac {2n-a}{n-a} g(a-1) = \\prod _{i=1} ^a \\dfrac {2n-i}{n-i} g(0)\n$$\n\u800c\u56e0\u4e3a $f(0)=0$\uff0c$f(1)=-2$\uff0c\u6240\u4ee5 $g(1)=-2$\u3002\n$$\nf(a) = \\sum_{i=0}^{a-1} g(i)\n$$\n\u7136\u540e\u5c31\u662f\u8003\u8651\u600e\u4e48\u6c42\n$$\nS(a) = \\sum _{i=1}^a \\prod_{j=1}^i \\dfrac {2n-j}{n-j}\n$$\n\u6709\u4e00\u4e2a\u5f88\u5de7\u5999\u7684 trick\u3002$N$ \u662f\u4e00\u4e2a\u6bd4 $a$ \u5927\u7684\u6570\u3002\u4ee4\n$$\ns(a) = S(a) \\cdot \\prod_{i=1}^N (n-i)\n$$\n\u8003\u8651\u5206\u5757\u6c42\u89e3\uff0c\u5757\u957f $B = \\sqrt N$\uff0c\u5219\u4ee4\n$$\nR(z) = \\sum_{i=z+1}^{z+B} \\left(\\prod_{j=z+1}^i (2n-j)\\prod_{j=i+1}^{z+B} (n-j)\\right)\n$$\n\u5219\n$$\ns(a) = \\sum _{i=0}^{a/B} \\left(\\prod _{j=1}^{Bi} (2n-j)\\cdot \\prod_{j=Bi+B+1}^N (n-j)\\cdot R(Bi)\\right) + \\sum_{i=(\\lfloor a/B\\rfloor+1)*B+1}^a \\left(\\prod _{j=1}^i (2n-j) \\cdot \\prod_{j=i+1}^N (n-j)\\right)\n$$\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u3002\n\n\u5bf9\u4e8e $R(z)$\uff0c\u9996\u5148 $R(0)$ \u662f\u53ef\u4ee5 $O(\\sqrt n)$ \u8ba1\u7b97\u7684\u3002\n\n\u8003\u8651\u9012\u63a8\n$$\nR(z) = R(z-1) \\cdot \\dfrac {n-(z+B)}{2n-z} + \\prod_{i=z+1}^{z+B} (2n - i)- \\prod_{i=z+1}^{z+B}(n - i)\n$$\n\u6c42\u51fa $R(0) .. R(B)$ \u4e4b\u540e\u6211\u4eec\u8fdb\u884c\u63d2\u503c\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u591a\u9879\u5f0f $R(z)$\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u591a\u70b9\u6c42\u503c\u6c42\u51fa\u6240\u6709 $R(Bi)$\u3002\n\n\u5bf9\u4e8e\u5269\u4f59\u7684\u90e8\u5206\uff0c\u6211\u4eec\u9700\u8981\u6c42\u7684\u5176\u5b9e\u662f\u4e00\u4e9b $2n-x$ \u6216\u8005 $n-x$ \u7684\u524d\u7f00\u6216\u8005\u540e\u7f00\u79ef\u3002\n\n\u6211\u4eec\u8003\u8651\u5982\u4f55\u6c42\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570 $F(x)$ \u7684\u524d\u7f00\u79ef\u3002\uff08\u540e\u7f00\u79ef\u4e0d\u8bf4\u4e86\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8f6c\u5316\u6210\u524d\u7f00\u79ef\uff09\n\n\u6211\u4eec\u5ef6\u7eed\u524d\u9762\u7684\u5206\u5757\u7684\u601d\u60f3\u3002\u8bb0 $D(z) = \\prod _{i=z+1}^{z+B} F(i)$\u3002\n\n\u6ce8\u610f\u5230 $D(z)$ \u662f\u4e00\u4e2a\u5173\u4e8e $x$ \u7684 $B$ \u6b21\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u5ef6\u7eed\u524d\u9762\u6c42 $R(z)$ \u7684\u60f3\u6cd5\uff0c\u5148\u6c42\u51fa $D(0) , D(1), \\cdots, D(B)$ \u7136\u540e\u63d2\u503c\u3001\u591a\u70b9\u6c42\u503c\u6c42\u51fa\u6240\u6709\u7684 $D(Bi)$\u3002\n\n\u8fd9\u4e48\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(\\sqrt n(m + \\log^2 N))$\u3002\n\n#### \u7b97\u6cd5\u4e09\n\n\u5feb\u901f\u63d2\u503c\u548c\u591a\u70b9\u6c42\u503c\u5e38\u6570\u592a\u5927\u8fa3\uff01\uff01\uff01\n\n\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u7528\u201c\u5feb\u901f\u9636\u4e58\u201d\u7684 trick \u53bb\u6389\u4e00\u4e2a log\u3002\n\n\u9996\u5148\u6211\u4eec\u6709\u591a\u9879\u5f0f $f(x)$ \u548c\u82e5\u5e72\u4e2a\u70b9\u503c $(x_i, f(x_i))$\u3002\u8003\u8651\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u516c\u5f0f\n$$\nf(x) = \\sum_{i=1} ^m f(x_i) \\prod _{j \\ne i} \\dfrac {x - x_j} {x_i - x_j}\n$$\n\u5728\u8fd9\u4e2a\u95ee\u9898\u4e2d $x_i$ \u5206\u522b\u4e3a $0$ \u5230 $d$\u3002\u6240\u4ee5\n$$\nf(x) = \\sum_{i=0} ^d f(i) \\prod _{j \\ne i} \\dfrac {x - j} {i - j}\n$$\n\u8003\u8651\u600e\u4e48\u6c42 $f(d + k)$\uff0c$1 \\le k \\le t$\n$$\n\\begin{aligned}\nf(d+k) &= \\sum_{i=0} ^t f(i) \\prod _{j \\ne i} \\dfrac {d + k - j} {i-j}\\\\\n&= \\prod _{j=0} ^t (d+k-j) \\cdot \\left(\\sum_{i=0}^t  \\dfrac {(-1)^{t-i}f(i)}{i!(t-i)!} \\cdot \\dfrac 1 {d+k-i}\\right)\n\\end{aligned}\n$$\n\u62ec\u53f7\u91cc\u9762\u53ef\u4ee5\u5377\u79ef\u8ba1\u7b97\uff1a\n$$\nF(x) = \\sum _{i=0} ^t \\dfrac {(-1)^{t-i}f(i)}{i!(t-i)!} x^i\n$$\n\n$$\nG(x) = \\sum_{i=0}^{2t} \\dfrac 1 {d-t+i} x^i\n$$\n\n\u6545\n$$\nf(d+k) = \\prod _{j=0} ^t (d+k-j) \\cdot [x^{k+t}] F(x)G(x)\n$$\n\u5982\u679c\u7ed9\u51fa $f(0), f(B), f(2B), .. f(Bk)$\uff0c\u8981\u6c42 $f(d), f(d+B), .., f(d+Bk)$\uff0c\u5219\u8bbe $g(x) = f(Bx)$ \u5c31\u53ef\u4ee5\u89e3\u51b3\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u6c42 $R(z)$\u3002\n\n$$\nR(z,B) = \\sum_{i=z+1}^{z+B} \\left(\\prod_{j=z+1}^i (2n-j)\\prod_{j=i+1}^{z+B} (n-j)\\right)\n$$\n\n$$\nP(z, B) = \\prod _{j = z + 1} ^{z + B} (2n - j)\n$$\n\n$$\nQ(z, B) = \\prod _{j = z + 1} ^{z + B} (n - j)\n$$\n\n\u90a3\u4e48\u6211\u4eec\u8981\u7b97\u7684\u5c31\u662f $P(0, B), P(s, B), ... , P(sB, B)$\uff0c$R, Q$ \u540c\u7406\u3002\n\n\u5982\u4f55\u9012\u5f52\u8ba1\u7b97\uff1f\n\n$$\nR(z, 2B) = R(z,B)\\cdot Q(z+B,B)+R(z+B,B) \\cdot P(z,B)\n$$\n\n$$\nP(z, 2B) = P(z,B) \\cdot P(z+B,B)\n$$\n\n$$\nQ(z, 2B) = Q(z, B) \\cdot Q(z + B, B)\n$$\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u7684\u5176\u5b9e\u662f\uff1a\n\n$P(0 + ks, B)$\uff0c$P(B + ks, B)$\uff0c$P(sB + ks, B)$\uff0c$P(B + sB + ks, B)$\uff0c\u5176\u4e2d $0 \\leq k \\leq B$\uff1b\n\n\u90a3\u4e48\u6211\u4eec\u4f7f\u7528\u524d\u9762\u7ed9\u51fa\u7684\u65b9\u6cd5\u5bb9\u6613\u7531\u7b2c\u4e00\u7ec4 $P$ \u7b97\u51fa\u5176\u4ed6\u4e09\u7ec4\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u500d\u589e\u6c42\u89e3\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $T(k) = T(k / 2) + O(k \\log k) = O(k \\log k)$\uff0c\u5176\u4e2d $k$ \u4e3a\u591a\u9879\u5f0f\u7684\u6b21\u6570\u3002\n\n\u8fd9\u79cd\u65b9\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(\\sqrt n(m + \\log N))$\uff0c\u6bd4\u7b97\u6cd5\u4e8c\u5c11\u4e86\u4e00\u4e2a log\uff0c\u5e38\u6570\u4e5f\u7531\u663e\u8457\u63d0\u5347\uff08\u56e0\u4e3a\u4e0d\u7528\u591a\u70b9\u6c42\u503c\uff09\n\n### \u603b\u7ed3\n\n\u8fd9\u9053\u9898\u662f\u4e00\u9053\u597d\u9898\u3002\n\n\u5bf9\u4e8e\u6c42\u505c\u65f6\u671f\u671b\u7684\u95ee\u9898\uff0c\u6784\u9020\u52bf\u80fd\u51fd\u6570\u3001\u4f7f\u7528\u505c\u65f6\u5b9a\u7406\u662f\u4e00\u79cd\u975e\u5e38\u597d\u7684\u89e3\u51b3\u95ee\u9898\u7684\u65b9\u6cd5\u3002\n\n\u7b97\u6cd5\u4e00\u8003\u5bdf\u4e86\u9009\u624b\u80c6\u5927\u5fc3\u7ec6\u7684\u80fd\u529b\u4ee5\u53ca\u5bf9CF\u8bc4\u6d4b\u673a\u7684\u4e86\u89e3\u7a0b\u5ea6\uff08bushi\uff09\u3002\n\n\u7b97\u6cd5\u4e8c\u8003\u5bdf\u4e86\u5bf9\u4e8e\u4e00\u7c7b\u591a\u9879\u5f0f\u7684\u7c7b\u4f3c\u9636\u4e58\u7684\u5f62\u5f0f\u7684\u95ee\u9898\uff0c\u4f7f\u7528\u5206\u5757\u6c42\u89e3\u7684\u65b9\u6cd5\u3002\n\n\u7b97\u6cd5\u4e09\u8003\u5bdf\u4e86\u5bf9\u4e8e\u62c9\u683c\u6717\u65e5\u63d2\u503c\u516c\u5f0f\u7684\u53d8\u5f62\uff0c\u5728\u6b64\u7c7b\u95ee\u9898\u4e2d\u628a\u591a\u70b9\u6c42\u503c\u95ee\u9898\u8f6c\u5316\u6210\u6807\u51c6\u7684\u5377\u79ef\u6027\u8d28\u7684\u65b9\u6cd5\u3002\n\n### \u4ee3\u7801\n\n\u7ffbcf\u9012\u4ea4\u8bb0\u5f55\u5427\u3002",
        "postTime": 1620392292,
        "uid": 302509,
        "name": "zghtyarecrenj",
        "ccfLevel": 7,
        "title": "CF1479E School Clubs"
    },
    {
        "content": "[\u9785\u4e0e\u505c\u65f6\u5b9a\u7406\u5b66\u4e60\u7b14\u8bb0](https://www.luogu.com.cn/blog/gxy001/yang-yu-ting-shi-ding-li-xue-xi-bi-ji)\n\n\u5957\u8def\u8bbe\u51fa\u4e00\u4e2a\u72b6\u6001\u7684\u52bf\u80fd\u51fd\u6570 $\\phi(A)$ \u4e3a\u6bcf\u7ec4\u7684\u52bf\u80fd\u76f8\u52a0 $\\sum f(a_i)$\u3002\n\n\u5bb9\u6613\u6ce8\u610f\u5230 $f(0)=0$\u3002\n\n\u4e3a\u6ee1\u8db3$E(\\Phi(A_{n+1})-\\Phi(A_n)\\mid A_0,A_1,\\cdots,A_n)=-1$\uff0c\u6709\n\n$$\n\\phi(A_t)-1=\\phi(A_{t+1})\\\\ \\sum_i\\frac {a_i}n(\\frac 12(\\phi(A_t)-f(a_i)+f(a_i-1)+f(1))+\\frac{a_i}{2n}\\phi(A_t)+\\sum_{j\\ne i}\\frac {a_j}{2n}(\\phi(A_t)-f(a_i)-f(a_j)+f(a_i-1)+f(a_j+1)))\\\\ -1=\\sum_i\\frac {a_i}{2n}(-f(a_i)+f(a_i-1)+f(1)+\\sum_{j\\ne i}\\frac {a_j}{n}(-f(a_i)-f(a_j)+f(a_i-1)+f(a_j+1)))\\\\ -1=-\\sum_i\\frac {a_i}{2n}f(a_i)+\\sum_i\\frac {a_i}{2n}f(a_i-1)+\\sum_i\\frac {a_i}{2n}f(1)-\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_i)-\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_j)+\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_i-1)+\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_j+1)\\\\\n$$\n\n\n$$\n-\\sum_i\\frac{a_i}n=\\sum_i\\frac {a_i}{2n}f(1)-\\sum_i\\frac {3na_i-2a^2_i}{2n^2}f(a_i)+\\sum_i\\frac {2na_i-a^2_i}{2n^2}f(a_i-1)+\\sum_i\\frac {na_i-a^2_i}{2n^2}f(a_i+1) \\\\ -\\frac xn=\\frac x{2n}f(1)-\\frac{3nx-2x^2}{2n^2}f(x)+\\frac{2nx-x^2}{2n^2}f(x-1)+\\frac{nx-x^2}{2n^2}f(x+1)\\\\ \n$$\n\n\u8bbe $f(1)=-2$\u3002\n\n$$\n0=-\\frac{3nx-2x^2}{2n^2}f(x)+\\frac{2nx-x^2}{2n^2}f(x-1)+\\frac{nx-x^2}{2n^2}f(x+1)\\\\ f(x+1)=\\frac {2n^2}{nx-x^2}(\\frac{3nx-2x^2}{2n^2}f(x)-\\frac{2nx-x^2}{2n^2}f(x-1))\\\\ \nf(x+1)=\\frac{3n-2x}{n-x}f(x)-\\frac{2n-x}{n-x}f(x-1)\\\\\nf(x+1)=\\frac{3n-2x}{n-x}\\frac{d_1}{d_2}-\\frac{2n-x}{n-x}\\frac{s_1}{s_2}\\\\\nf(x+1)=\\frac{(3n-2x)d_1}{(n-x)d_2}-\\frac{(2n-x)s_1}{(n-x)s_2}\\\\\nf(x+1)=\\frac{(3n-2x)d_1s_2-(2n-x)s_1d_2}{(n-x)d_2s_2}\n$$\n\n\u5bb9\u6613\u53d1\u73b0\u6b64\u65f6\u7684 $E(A_t)=f(n)$ \u4e3a\u5e38\u6570\uff0c\u7b54\u6848\u5373\u4e3a $\\sum f(a_i)-f(n)$\u3002 \n\n\u7ebf\u6027\u7b97\u5373\u53ef\uff0c\u53ef\u4ee5\u8fc7\uff0c\u8bb0\u5f97\u5f00 C++17(64)\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\nint const mod=998244353;\nint pow(int x,int y){\n\tint res=1;\n\twhile(y){\n\t\tif(y&1) res=1ll*res*x%mod;\n\t\tx=1ll*x*x%mod,y>>=1;\n\t}\n\treturn res;\n}\nint n,m,a[1010];\nint main(){\n\tscanf(\"%d\",&m);\n\tfor(int i=1;i<=m;i++)scanf(\"%d\",a+i),n+=a[i];\n\tstd::sort(a+1,a+m+1);\n\tint ans=0;\n\tint s1=0,d1=mod-2,s2=1,d2=1,p1,p2,j=1;\n\twhile(j<=m&&a[j]==1)ans=(ans+mod-2)%mod,++j;\n\tfor(int i=1;i<n;i++){\n\t\tp2=1ll*(n-i)*d2%mod*s2%mod;\n\t\tp1=((3ll*n-2*i)*d1%mod*s2+(mod-1ll)*(2*n-i)%mod*s1%mod*d2)%mod;\n\t\twhile(j<=m&&a[j]==i+1)ans=(ans+1ll*p1*pow(p2,mod-2))%mod,++j;\n\t\ts1=d1,s2=d2,d1=p1,d2=p2;\n\t}\n\tprintf(\"%lld\\n\",(ans+(mod-1ll)*d1%mod*pow(d2,mod-2))%mod);\n\treturn 0;\n} \n```\n\nCF \u9898\u89e3\u7ed9\u51fa\u7684\u505a\u6cd5\u662f\u5c06\u4e0b\u9762\u7684\u5f0f\u5b50\u7528\u591a\u9879\u5f0f\u79d1\u6280\u4f18\u5316\u3002\n\n$$\ng(x)=f(x+1)-f(x)\\\\ g(x)=\\frac{2n-x}{n-x}g(x-1)\\\\ g(x)=g(0)\\prod_{i=1}^x\\frac{2n-i}{n-i}\\\\ f(x)=-2\\sum_{i=0}^{x-1}\\prod_{j=1}^i\\frac{2n-j}{n-j}\n$$\n\n\n\n",
        "postTime": 1616542081,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1479E School Clubs"
    },
    {
        "content": "# \u9785\u7684\u505c\u65f6\u5b9a\u7406\n\n\u201c\u9785\u201d\uff0c*martingale* \u7528\u6765\u6307\u4e00\u7c7b\u968f\u673a\u8fc7\u7a0b\uff0c\u5b9a\u4e49\u5982\u4e0b\uff1a\n\n> \u9785\u662f\u4e00\u79cd\u79bb\u6563\u65f6\u95f4\u7684\u968f\u673a\u8fc7\u7a0b $X_0,X_1,\\cdots$ \u6ee1\u8db3\uff1a\n>\n> * $E(X_t)<\\infty,\\forall t\\geq0$\n> * $E(X_{t+1}\\mid X_0,\\cdots X_t)=X_t$\n\n\u6839\u636e\u5b9a\u4e49\u53ef\u4ee5\u5f97\u5230 $E(X_t)=X_0$\u3002\n\n## \u505c\u65f6\u5b9a\u7406\n\n\u8bbe $t$ \u4e3a\u9785\u8fc7\u7a0b ${X_0,X_1,\\cdots}$ \u7684\u505c\u65f6\uff0c\u5f53\u4e0b\u9762\u4e09\u4e2a\u6761\u4ef6\u4e4b\u4e00\u6210\u7acb\u65f6\uff0c\u6709 $E(X_t)=X_0$\uff1a\n\n* $t$ \u51e0\u4e4e\u5fc5\u7136\u6709\u754c\uff1b\n* $\\mid X_{i+1}-X_i\\mid$ \u4e00\u81f4\u6709\u754c\uff0c$E(t)$ \u6709\u9650\uff1b\n* $X_i$ \u4e00\u81f4\u6709\u754c\uff0c$t$ \u51e0\u4e4e\u5fc5\u7136\u6709\u9650\u3002\n\n\u540d\u8bcd\u89e3\u91ca\uff1a\n\n* $a\\in R\\cup{\\infty}$ \u6709\u9650\uff1a$\\mid a\\mid <\\infty$\uff1b\n* $a\\in R\\cup{\\infty}$ \u6709\u754c\uff1a$\\exists l,r\\in  R,a\\in[l,r]$\uff1b\n* $a_i\\in R\\cup{\\infty}$ \u4e00\u81f4\u6709\u754c\uff1a$\\forall i,\\exists l,r\\in R,a_i\\in[l,r]$\uff1b\n* \u4e8b\u4ef6 $A$ \u51e0\u4e4e\u5fc5\u7136\u53d1\u751f\uff1a$P(A)=1$\u3002\n\n## \u52bf\u80fd\u51fd\u6570\n\n\u5bf9\u4e8e\u968f\u673a\u65f6\u95f4\u5e8f\u5217 ${A_0,A_1,\\cdots}$\uff0c$t$ \u4e3a\u5176\u505c\u65f6\uff0c\u7ec8\u6b62\u72b6\u6001\u4e3a $A_t$\uff0c\u6c42 $E(t)$\u3002\n\n\u6784\u9020\u52bf\u80fd\u51fd\u6570 $\\Phi(A)$\uff0c\u6ee1\u8db3\uff1a\n\n* $E(\\Phi(A_{n+1})-\\Phi(A_n)\\mid A_0,A_1,\\cdots,A_n)=-1$\uff1b\n* $\\Phi(A_t)$ \u4e3a\u5e38\u6570\u3002\n\n\u6784\u9020\u5e8f\u5217 $X_i=\\Phi(A_i)+i$\uff0c\u5219 $E(X_{n+1}-X_n\\mid X_0,X_1,\\cdots,X_n)=0$\uff0c\u5373 ${X_0,X_1,\\cdots}$ \u662f\u9785\u3002\n\n\u6839\u636e\u505c\u65f6\u5b9a\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $E(X_t)=E(X_0)$\uff0c\u5373 $E(t)=E(\\Phi(A_0))-\\Phi(A_t)$\u3002\n\n## CF1479E School Clubs\n\n### \u9898\u610f\n\n\u6709 $n$ \u4e2a\u5b66\u751f\u548c $m$ \u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u4eba\u5728\u4e00\u4e2a\u7ec4\u91cc\u9762\uff0c\u7b2c $i$ \u4e2a\u7ec4\u7684\u4eba\u6570\u4e3a $a_i$\u3002\n\n\u73b0\u5728\uff0c\u6bcf\u5929\u6709\u4e00\u4e2a\u5b66\u751f\uff08$n$ \u4e2a\u5b66\u751f\u4e2d\u968f\u673a\u7684\u4e00\u4e2a\uff09\u4f1a\uff1a\n\n1. \u6709\u4e00\u534a\u7684\u6982\u7387\u4ed6\u4f1a\u8131\u79bb\u8fd9\u4e2a\u7ec4\uff0c\u5e76\u4e14\u6210\u7acb\u4e00\u4e2a\u65b0\u7684\u7ec4\u3002\n2. \u6709\u4e00\u534a\u7684\u6982\u7387\u4ed6\u4f1a\u8131\u79bb\u8fd9\u4e2a\u7ec4\uff0c\u5e76\u4e14\u8fdb\u5165\u4e00\u4e2a\u5df2\u7ecf\u6210\u7acb\u7684\u7ec4\u3002\u4ed6\u8fdb\u5165\u7b2c $i$ \u4e2a\u7ec4\u7684\u6982\u7387\u4e3a $\\frac {a_i} n$\uff0c\u4ed6\u53ef\u80fd\u4f1a\u56de\u5230\u539f\u6765\u7684\u7ec4\u3002\n\n\u6c42\u7b2c\u4e00\u6b21\u51fa\u73b0\u6240\u6709\u5b66\u751f\u5728\u540c\u4e00\u4e2a\u7ec4\u7684\u671f\u671b\u5929\u6570\uff0c\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n$n\\leq 4\\times10^8$\n\n### \u601d\u8def\n\n\u8bbe $\\phi(A)$ \u4e3a\u72b6\u6001 $A$ \u7684\u52bf\u80fd\uff0c\u6784\u9020\u4f7f\u5f97 $\\phi(A_t)-1=\\phi(A_{t+1})$\uff0c\u8bbe $f(x)$ \u4e3a\u5b66\u751f\u6570\u91cf\u4e3a $x$ \u7684\u7ec4\u7684\u52bf\u80fd\u51fd\u6570\uff0c\u5219\u6709\uff1a\n$$\n\\begin{aligned}\\phi(A_t)-1&=\\phi(A_{t+1})\\\\\n\\phi(A_t)-1&=\\sum_i\\frac {a_i}n(\\frac 12(\\phi(A_t)-f(a_i)+f(a_i-1)+f(1))+\\frac{a_i}{2n}\\phi(A_t)+\\sum_{j\\ne i}\\frac {a_j}{2n}(\\phi(A_t)-f(a_i)-f(a_j)+f(a_i-1)+f(a_j+1)))\\\\\n-1&=\\sum_i\\frac {a_i}{2n}(-f(a_i)+f(a_i-1)+f(1)+\\sum_{j\\ne i}\\frac {a_j}{n}(-f(a_i)-f(a_j)+f(a_i-1)+f(a_j+1)))\\\\\n-1&=-\\sum_i\\frac {a_i}{2n}f(a_i)+\\sum_i\\frac {a_i}{2n}f(a_i-1)+\\sum_i\\frac {a_i}{2n}f(1)-\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_i)-\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_j)+\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_i-1)+\\sum_i\\frac {a_i}{2n}\\sum_{j\\ne i}\\frac {a_j}{n}f(a_j+1)\\\\\n-\\sum_i\\frac{a_i}n&=\\sum_i\\frac {a_i}{2n}f(1)-\\sum_i\\frac {3na_i-2a^2_i}{2n^2}f(a_i)+\\sum_i\\frac {2na_i-a^2_i}{2n^2}f(a_i-1)+\\sum_i\\frac {na_i-a^2_i}{2n^2}f(a_i+1)\\\\\n-\\frac xn&=\\frac x{2n}f(1)-\\frac{3nx-2x^2}{2n^2}f(x)+\\frac{2nx-x^2}{2n^2}f(x-1)+\\frac{nx-x^2}{2n^2}f(x+1)\\\\\n\\end{aligned}\n$$\n\n\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7684\u53ea\u662f\u521d\u59cb\u72b6\u6001\u4e0e\u505c\u65f6\u7684\u52bf\u80fd\u5dee\uff0c\u90a3\u4e48\u5c06\u52bf\u80fd\u5177\u4f53\u8bbe\u4e3a\u4ec0\u4e48\u90fd\u65e0\u6240\u8c13\uff0c\u6240\u4ee5\u4e3a\u4e86\u6d88\u53bb\u5e38\u6570\u9879\u6211\u4eec\u53ef\u4ee5\u8bbe $f(1)=-2$\uff0c\u5219\uff1a\n$$\n\\begin{aligned}0&=-\\frac{3nx-2x^2}{2n^2}f(x)+\\frac{2nx-x^2}{2n^2}f(x-1)+\\frac{nx-x^2}{2n^2}f(x+1)\\\\\nf(x+1)&=\\frac {2n^2}{nx-x^2}(\\frac{3nx-2x^2}{2n^2}f(x)-\\frac{2nx-x^2}{2n^2}f(x-1))\\\\\nf(x+1)&=\\frac{3n-2x}{n-x}f(x)-\\frac{2n-x}{n-x}f(x-1)\\\\\n\\end{aligned}\n$$\n\n\u53d1\u73b0 $\\phi(A_t)=f(n)$ \uff08\u8868\u793a\u5c40\u9762\u4e3a\u53ea\u6709\u4e00\u4e2a\u4eba\u6570\u4e3a $n$ \u7684\u7ec4\uff09\u662f\u4e2a\u5e38\u6570\uff08\u77e5\u9053 $f(0)$ \u548c $f(1)$ \u53ef\u4ee5\u88ab\u8868\u793a\uff09\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u505c\u65f6\u5b9a\u7406\u3002\n\n\u89c2\u5bdf\u6570\u636e\u8303\u56f4\u53d1\u73b0\u6ca1\u6cd5\u5b58\u4e0b\u7ebf\u6027\u6c42\u9006\u5143\uff0c\u4e5f\u6ca1\u6cd5\u6bcf\u6b21\u5feb\u901f\u5e42\u6c42\u3002\u90a3\u600e\u4e48\u529e\u5462\uff1f\n\n\u5b98\u65b9\u9898\u89e3\u7684\u505a\u6cd5\u5c06 $f$ \u8fdb\u884c\u5dee\u5206\u7136\u540e\u5229\u7528\u5feb\u901f\u9636\u4e58\u7b97\u6cd5\u8ba1\u7b97\uff0c\u5373\uff1a\n$$\n\\begin{aligned}g(x)=f(x+1)-f(x)\\\\\ng(x)=\\frac{2n-x}{n-x}g(x-1)\\\\\ng(x)=g(0)\\prod_{i=1}^x\\frac{2n-i}{n-i}\\\\\nf(x)=-2\\sum_{i=0}^{x-1}\\prod_{j=1}^i\\frac{2n-j}{n-j}\n\\end{aligned}\n$$\n\n\u5b9e\u9645\u4e0a\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5bf9\u5bf9\u4e8e\u8fd9\u4e2a\u5f0f\u5b50 $f(x+1)=\\frac{3n-2x}{n-x}f(x)-\\frac{2n-x}{n-x}f(x-1)$ \u7ebf\u6027\u9012\u63a8\u3002\u56e0\u4e3a\u6211\u4eec\u8981\u6c42\u7684\u662f $E(\\phi(A_t))$ \u548c $\\phi(A_0)=\\sum_if(a_i)$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u5728\u7b97 $m$ \u4e2a $f(a_i)$ \u548c $f(n)$ \u7684\u65f6\u5019\u5feb\u901f\u5e42\uff0c\u9012\u63a8\u7684\u65f6\u5019\u5206\u522b\u7ef4\u62a4\u5206\u5b50\u548c\u5206\u6bcd\u5373\u53ef\u3002\u5982\u679c\u4f60\u62e5\u6709\u4f18\u79c0\u7684\u5e38\u6570\u5373\u53ef\u901a\u8fc7\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<algorithm>\ninline int read(){\n\tint x=0,w=0;char c=getchar();\n\twhile(!isdigit(c)) w|=c=='-',c=getchar();\n\twhile(isdigit(c)) x=x*10+(c^48),c=getchar();\n\treturn w?-x:x;\n}\nconst int mod=998244353;\ninline int pow(int a,int b){int ans=1;for(;b;b>>=1,a=1ll*a*a%mod) if(b&1) ans=1ll*ans*a%mod; return ans;}\nint n,m,a[1010];\nsigned main(){\n\tm=read();\n\tfor(int i=1;i<=m;i++) n+=a[i]=read();\n\tstd::sort(a+1,a+m+1);\n\tint ans=0;\n\tint s1=0,d1=mod-2,s2=1,d2=1,p1,p2,j=1;\n\twhile(j<=m&&a[j]==1)ans=(ans+mod-2)%mod,++j;\n\tfor(int i=1;i<n;i++){\n\t\tp2=1ll*(n-i)*d2%mod*s2%mod;\n\t\tp1=((3ll*n-2*i)*d1%mod*s2+(mod-1ll)*(2ll*n-i)%mod*s1%mod*d2)%mod;\n\t\twhile(j<=m&&a[j]==i+1)ans=(ans+1ll*p1*pow(p2,mod-2))%mod,++j;\n\t\ts1=d1,s2=d2,d1=p1,d2=p2;\n\t}\n\tprintf(\"%lld\\n\",(ans+(mod-1ll)*d1%mod*pow(d2,mod-2))%mod);\n\treturn 0;\n} \n```\n\n",
        "postTime": 1616513570,
        "uid": 280015,
        "name": "Star_Cried",
        "ccfLevel": 9,
        "title": "\u9785\u7684\u505c\u65f6\u5b9a\u7406"
    }
]