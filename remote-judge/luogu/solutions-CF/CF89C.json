[
    {
        "content": "\u9996\u5148 $n\\times m \\le 5000$\uff0c\u53ef\u4ee5\u77e5\u9053\u662f\u4e2a $O(n^2m^2)$ \u53ef\u8fc7\u7684\u9898\u3002\n\n\u4f30\u8ba1\u4e00\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u679a\u4e3e\u8d77\u70b9\uff0c\u7136\u540e\u518d\u5bf9\u6574\u5f20\u68cb\u76d8\u6a21\u62df\u4e00\u4e0b\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u590d\u6742\u5ea6\u4e3a $O(n^2m^2)$ \u7684\u7b97\u6cd5\u3002\n\n\u5173\u952e\u5728\u4e8e\u5982\u4f55\u5feb\u901f\u6a21\u62df\u8fd9\u4e2a\u79fb\u52a8\u548c\u5220\u9664\u7684\u8fc7\u7a0b\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u79fb\u52a8\u5c31\u662f\u6c42\u524d\u9a71\u548c\u540e\u7ee7\uff0c\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u53ef\u4ee5\u5feb\u901f\u7ef4\u62a4\u5220\u9664\uff0c\u67e5\u8be2\u548c\u6062\u590d\u64cd\u4f5c\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u7684\u6062\u590d\u64cd\u4f5c\u662f\u5728$\\rm DFS$\u56de\u6eaf\u7684\u65f6\u5019\u8fdb\u884c\uff0c\u6240\u4ee5\u8fd9\u6837\u505a\u662f\u6b63\u786e\u7684\u3002\n\n\u6ce8\u610f\u94fe\u8868\u4e0d\u4ec5\u8981\u7ef4\u62a4\u6bcf\u4e00\u884c\uff0c\u8fd8\u8981\u7ef4\u62a4\u6bcf\u4e00\u5217\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 5005\nusing namespace std;\nint n,m;\nchar s[N][N];\nvector<int>up[N],dn[N],lt[N],rt[N];\n//int up[N][N],dn[N][N],lt[N][N],rt[N][N];\nvoid del(int x,int y){\n\tdn[up[x][y]][y]=dn[x][y];\n\tup[dn[x][y]][y]=up[x][y];\n\trt[x][lt[x][y]]=rt[x][y];\n\tlt[x][rt[x][y]]=lt[x][y];\n}\nvoid ins(int x,int y){\n\tdn[up[x][y]][y]=x;\n\tup[dn[x][y]][y]=x;\n\trt[x][lt[x][y]]=y;\n\tlt[x][rt[x][y]]=y;\n}\nint dfs(int x,int y){\n\tint ans=1;\n\tif(s[x][y]=='U'){\n\t\tint cur=up[x][y];\n\t\tif(cur)del(x,y),ans+=dfs(cur,y),ins(x,y);\n\t}\n\telse if(s[x][y]=='D'){\n\t\tint cur=dn[x][y];\n\t\tif(cur!=n+1)del(x,y),ans+=dfs(cur,y),ins(x,y);\n\t}\n\telse if(s[x][y]=='L'){\n\t\tint cur=lt[x][y];\n\t\tif(cur)del(x,y),ans+=dfs(x,cur),ins(x,y);\n\t}\n\telse if(s[x][y]=='R'){\n\t\tint cur=rt[x][y];\n\t\tif(cur!=m+1)del(x,y),ans+=dfs(x,cur),ins(x,y);\n\t}\n\treturn ans;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\trep(i,1,n)scanf(\"%s\",s[i]+1);\n\trep(i,0,n+1)up[i].resize(m+3),dn[i].resize(m+3),lt[i].resize(m+3),rt[i].resize(m+3);\n\trep(i,1,n){\n\t\tint pre=0;\n\t\trep(j,1,m)if(s[i][j]!='.')rt[i][pre]=j,lt[i][j]=pre,pre=j;\n\t\trt[i][pre]=m+1;lt[i][m+1]=pre;\n\t}\n\trep(j,1,m){\n\t\tint pre=0;\n\t\trep(i,1,n)if(s[i][j]!='.')dn[pre][j]=i,up[i][j]=pre,pre=i;\n\t\tdn[pre][j]=n+1;up[n+1][j]=pre;\n\t}\n\tint ans=0,mx=0;\n\trep(i,1,n)rep(j,1,m)if(s[i][j]!='.'){\n\t\tint cur=dfs(i,j);\n\t\tif(cur>mx)mx=cur,ans=1;\n\t\telse if(cur==mx)ans++;\n\t}\n\tprintf(\"%d %d\\n\",mx,ans);\n\treturn 0;\n}\n```",
        "postTime": 1619510273,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF89C Chip Play"
    }
]