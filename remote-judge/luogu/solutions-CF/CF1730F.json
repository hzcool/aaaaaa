[
    {
        "content": "\u9996\u5148\u6211\u4eec\u8003\u8651\u9898\u76ee\u672c\u8d28\u662f\u5728\u8981\u6c42\u4ec0\u4e48\u3002\n\n\u5b9e\u9645\u4e0a\uff0c\u5b83\u662f\u60f3\u8ba9\u6211\u4eec\u628a\u539f\u5e8f\u5217\u8fdb\u884c\u4e00\u79cd\u6392\u5e8f\uff0c\u4f7f\u5f97\u5176\u6ee1\u8db3\u9898\u76ee\u7ed9\u5b9a\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u539f\u5e8f\u5217\u7684\u7f16\u53f7\u5bf9\u5e94\u6392\u5e8f\u540e\u5199\u4e0b\u6765\uff0c\u8ba9\u8fd9\u4e2a\u5e8f\u5217\u7684\u9006\u5e8f\u6570\u6700\u5c11\u3002\n\n\u90a3\u4e48\u6211\u4eec\u601d\u8003\u540e\u53d1\u73b0\uff0c\u8fd9\u4e1c\u897f\u65e0\u7591\u8981 dp \uff0c\u4f46\u662f\u5176\u5177\u6709\u4e24\u4e2a\u5173\u952e\u7ef4\u5ea6\uff1a\u5176\u4e00\u662f\u503c\u57df\uff0c\u8fd9\u662f\u9898\u76ee\u8981\u6c42\u7684\u9650\u5236\u4e4b\u4e00\uff1b\u5176\u4e8c\u662f\u5e8f\u5217\uff0c\u6211\u4eec\u8981\u6c42\u9006\u5e8f\u6570\u6700\u5c11\u3002\n\n\u8fd9\u91cc\u4e00\u5b9a\u8981\u770b\u51c6\uff0c**\u9006\u5e8f\u6570\u4e0d\u662f\u5143\u7d20\u5927\u5c0f\u7684\u9006\u5e8f\u6570\uff0c\u800c\u662f\u4e0b\u6807\u7684\u9006\u5e8f\u6570**\u3002\n\n\u6211\u4eec\u5148\u6765\u89c2\u5bdf\u4e00\u4e0b\u6027\u8d28\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e $p_i = 1,$ \u6700\u7ec8\u5728 $q$ \u4e2d $i$ \u6700\u591a\u4e5f\u5c31\u53ea\u80fd\u653e\u5230 $q_{k + 1}$ \u7684\u4f4d\u7f6e\u4e0a\u3002\u539f\u56e0\u662f\u524d\u9762\u4f1a\u51fa\u73b0\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u5b57\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u503c $v$ \u800c\u8a00\uff0c\u5176\u80fd\u591f\u586b\u5199\u7684\u4f4d\u7f6e\u662f $O(k)$ \u7ea7\u522b\u7684\uff0c\u5e76\u4e14\u7ec4\u6210\u4e00\u6bb5\u8fde\u7eed\u533a\u95f4\u3002\n\n\u7ee7\u7eed\u770b\uff0c\u6211\u4eec\u8003\u8651\u53ef\u4ee5\u5c06\u586b\u5199\u770b\u6210\u6bcf\u6b21\u9009\u4e00\u4e2a\u6570\u585e\u5230\u524d\u7f00\u7684\u672b\u5c3e\u3002\u6211\u4eec\u4e3a\u6ee1\u8db3\u9898\u76ee\u9650\u5236\uff0c\u8003\u8651\u6309\u7167\u503c\u57df\u6765\u586b\u5199\u6570\uff0c\u7136\u540e\u628a\u9006\u5e8f\u6570\u653e\u5230 $f$ \u7684\u6570\u7ec4\u91cc\u9762\uff0c\u5c06\u5176\u6700\u5c0f\u5316\u3002\n\n\u6839\u636e\u4e0a\u8ff0\u6027\u8d28\uff0c\u4e00\u4e2a**\u503c**\u7684\u51fa\u73b0\u8303\u56f4\u8fde\u7eed\u5e76\u4e14\u662f $O(k)$ \u7684\uff0c\u800c $k\\leq 8$ \u4e0d\u96be\u8003\u8651\u5230\u72b6\u538b\u884c\u4e3a\u3002\n\n\u6211\u4eec\u8003\u8651\uff0c\u5982\u679c\u6700\u957f\u7684\u8fde\u7eed\u503c\u57df\u524d\u7f00\u5df2\u7ecf\u586b\u5199\u4e86 $i,$ \u90a3\u4e48 $i + k + 2$ \u65e0\u8bba\u5982\u4f55\u4e0d\u80fd\u5199\u8fdb\u53bb\uff0c\u56e0\u4e3a $i + 1$ \u8fd8\u6ca1\u6709\u5199\u8fdb\u53bb\uff0c\u8fd9\u6837\u4e00\u5b9a\u4e0d\u5408\u6cd5\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u8bbe $f(i, S)$ \u8868\u793a\u5df2\u7ecf\u586b\u5199\u5b8c\u6bd5\u503c\u57df\u5728 $[1, i]$ \u4e2d\u7684\u6570\u5b57\uff0c$[i + 1, i + k + 1]$ \u8fd9\u90e8\u5206\u6570\u5b57\u7684\u586b\u5199\u72b6\u6001\u662f $S$ \u7684\u6700\u4f18\u89e3\u3002\u5176\u4e2d $S$ \u82e5\u4e3a $0$ \u5219\u8868\u793a\u8fd8\u6ca1\u586b\u8fdb\u53bb\u3002\n\n\u90a3\u4e48\u8003\u8651\u8f6c\u79fb\u3002\u6211\u4eec\u8003\u8651\uff0c\u5728 $i$ \u5904\u6240\u6709\u7684\u5408\u6cd5\u72b6\u6001\u5fc5\u7136\u6ee1\u8db3 $S_0 = 0$ \u4e5f\u5c31\u662f $i + 1$ \u8fd8\u6ca1\u6709\u586b\u5199\u3002\u5426\u5219\u53ef\u4ee5\u6784\u6210\u66f4\u957f\u7684\u524d\u7f00\u3002\n\n\u5f53\u7136\u4e3a\u65b9\u4fbf\u72b6\u6001\u8f6c\u79fb\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u8fd9\u4e9b\u72b6\u6001\u8f6c\u79fb\u5230 $f(i + 1, S / 2)$ \u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u6b63\u5e38\u7684\u8f6c\u79fb\uff0c\u6211\u4eec\u8003\u8651\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u6570\u4f4d\uff0c\u8f6c\u79fb\u5230 $f(i, S \\cup \\{d\\})$ \u6b64\u65f6\u6211\u4eec\u9700\u8981\u4ed4\u7ec6\u8003\u8651**\u8f6c\u79fb\u4ee3\u4ef7\u5982\u4f55\u8ba1\u7b97**\u3002\n\n\u4e0a\u8ff0\u5df2\u7ecf\u5f3a\u8c03\u9006\u5e8f\u6570\u662f\u4e0b\u6807\u7684\u9006\u5e8f\u6570\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a BIT \u652f\u6301\u67e5\u8be2\u540e\u7f00\u548c\uff0c\u5c06 $[1, i]$ \u6240\u6709\u503c\u7684\u7f16\u53f7\u63d2\u5165\u8fdb\u53bb\u3002\u90a3\u4e48\u8ba1\u7b97\u4ee3\u4ef7\u7684\u65f6\u5019\uff0c\u5148\u67e5\u8be2\u5f53\u524d\u63d2\u5165\u7684\u503c\u7684\u4e0b\u6807\u7684\u540e\u7f00\u548c\uff08\u4e5f\u5c31\u662f\u5df2\u7ecf\u63d2\u5165\u7684\u90e8\u5206\u6784\u6210\u7684\u9006\u5e8f\u6570\uff09\uff0c\u518d\u8003\u8651\u672a\u63d2\u5165 BIT \u91cc\u9762\u7684\u4e0b\u6807\uff08\u4e5f\u5c31\u662f $S$ \u4e2d\u7684\u6570\uff09\u66b4\u529b\u8ba1\u7b97\u4ee3\u4ef7\u3002\n\n\u8fd9\u6837\u4e0b\u6765\u603b\u590d\u6742\u5ea6\u662f $O(n2^kk(k + \\log n))$ \u7684\u3002\u5e38\u6570\u5f88\u5c0f\uff0c\u8dd1\u7684\u5f88\u5feb\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n//#define int long long\ninline int read()\n{\n\tint s = 0, w = 1;\n\tchar ch = getchar();\n\twhile (!isdigit(ch))\n\t{\n\t\tif (ch == '-')\n\t\t\tw = -1;\n\t\tch = getchar();\n\t}\n\twhile (isdigit(ch))\n\t{\n\t\ts = s * 10 + ch - '0';\n\t\tch = getchar();\n\t}\n\treturn s * w;\n}\nconst int N = 6000;\nint f[N][1 << 9];\nint a[N], n, K;\n// f(i, S) shows that [1, i] has been filled in a prefix, and [i + 1, i + k]'s state = S \n// 1 is equal to has been filled, 0 is not.\nint tr[N], b[N];\ninline int lowbit(int x) {return x & -x;}\ninline void change(int x, int v) {\n\twhile(x) {\n\t\ttr[x] += v;\n\t\tx -= lowbit(x);\n\t}\n}\ninline int query(int x) {\n\tint res = 0; while(x <= n) {\n\t\tres += tr[x];\n\t\tx += lowbit(x);\n\t}\n\treturn res;\n}\ninline int calc(int st, int S, int fl) {\n\tint res = query(a[st + 1 + fl]);\n\tfor(int i = 0; i < K; ++i) if(i != fl && (S >> i & 1)) {\n\t\tif(a[st + 1 + fl] < a[st + 1 + i]) res = res + 1;\n\t}\n\treturn res;\n}\nint main() {\n\tfreopen(\"in.txt\", \"r\", stdin);\n\tn = read(); K = read(); K = K + 1;\n\tfor(int i = 1; i <= n; ++i) a[i] = read(), b[a[i]] = i;\n\tfor(int i = 1; i <= n; ++i) a[i] = b[i];\n\tmemset(f, 0x3f, sizeof f);\n\tf[0][0] = 0;\n\tfor(int i = 0; i < n; ++i) {\n\t\tfor(int S = 0; S < (1 << K); ++S) {\n\t\t\tif(f[i][S] > n * n) continue;\n\t\t\tif(!(S & 1)) {\n//\t\t\t\t i + 1 has not been filled, so, i + 1 + k + 1 must be not.\n\t\t\t\tfor(int j = 0; j < K; ++j) {\n\t\t\t\t\tif(i + j + 1 > n) break;\n\t\t\t\t\tif(!(S >> j & 1)) {\n\t\t\t\t\t\tf[i][S | (1 << j)] = min(f[i][S | (1 << j)], f[i][S] + calc(i, S, j));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tf[i + 1][S >> 1] = min(f[i + 1][S >> 1], f[i][S]);\n\t\t\t}\n\t\t}\n\t\tchange(a[i + 1], 1);\n\t}\n\tcout << f[n][0] << '\\n';\n\treturn 0;\n}\n```\n",
        "postTime": 1666318534,
        "uid": 128591,
        "name": "Refined_heart",
        "ccfLevel": 9,
        "title": "CF1730F Almost Sorted \u9898\u89e3"
    },
    {
        "content": "### Preface  \n\u6211\u4e2a\u4eba\u89c9\u5f97\u8fd9\u9898\u7ec6\u8282\u5f88\u591a\u5f88\u6076\u5fc3\u3002  \n### Problem  \n\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217 $p$\uff0c\u73b0\u5728\u8981\u4f60\u6c42\u4e00\u4e2a\u9006\u5e8f\u5bf9\u6570\u6700\u5c0f\u7684\u6392\u5217 $q$ \u4f7f\u5f97\u5bf9\u4e8e\u6bcf\u4e00\u5bf9\u6ee1\u8db3 $1\\leq i<j\\leq n$ \u7684 $i,j$ \u6ee1\u8db3\uff1a    \n$$p_{q_i}\\leq p_{q_j}+k$$  \n\n$(1\\leq n \\leq 5000,1\\leq k \\leq 8)$  \n\n### Solution  \n\u53d1\u73b0\u5728\u9009\u62e9 $q$ \u7684\u5143\u7d20\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u65e6\u9009\u62e9\u4e86\u4e00\u4e2a $q_i$ \u4f1a\u4f7f\u5f97\u4ee5\u540e\u518d\u4e5f\u4e0d\u80fd\u9009\u4efb\u4f55 \u6ee1\u8db3 $p_{q_j}<p_{q_i}-k$ \u7684 $j$ \u4e86\uff0c\u90a3\u4e48\u4e8b\u5b9e\u4e0a\u5f53\u6211\u4eec\u9009\u7684\u6700\u5927\u7684\u6570\u4e3a $J$ \u7684\u65f6\u5019\uff0c$J-k-1$ \u53ca\u4ee5\u4e0b\u7684\u7684\u6570\u5b57\u90fd\u5e94\u8be5\u65e9\u5c31\u88ab\u9009\u62e9\uff0c\u53ea\u6709 $[J-k,J-1]$ \u8fd9\u4e2a\u533a\u95f4\u7684\u6570\u80fd\u5728 $J$ \u4e4b\u540e\u5b58\u5728\u3002  \n\n\u53d1\u73b0\u8fd9\u4e2a\u533a\u95f4\u5f88\u5c0f\uff0c\u53ef\u4ee5\u72b6\u538b\u3002  \n\n\u4e8e\u662f\u8bbe $dp_{i,J,g}$ \u4e3a\u9009\u62e9\u5230\u7b2c $i$ \u4e2a\u6570\uff0c\u6700\u5927\u7684\u6570\u4e3a $J$\uff0c$[J-k,J-1]$ \u533a\u95f4\u9009\u62e9\u72b6\u6001\u4e3a $g$ \u7684\u6700\u5c0f\u9006\u5e8f\u5bf9\u6570\u3002  \n\n\u8f6c\u79fb\u5927\u81f4\u4e3a\uff08\u6ce8\u610f\u5224\u8fb9\u754c\uff09\uff1a  \n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\uff1a  \n$$dp_{i+1,J+f,(g+(1<<k))>>f)}=\\min(dp_{i,J,g}+sum_{J-k-1+f,q_{J+f}}+cost_{J+f,(g+(1<<k))>>f),k})$$  \n$f$ \u4e3a\u4e00\u4e2a\u5c0f\u4e8e $g$ \u7684\u5168 1 \u6700\u5927\u540e\u7f00\u957f\u5ea6\u7684\u6570\u3002  \n$sum$ \u4e3a\u4e00\u4e2a\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u4f46\u662f\u7b2c\u4e8c\u7ef4\u7684\u8f6c\u79fb\u5411\u4e0a\u4ee3\u8868\u9006\u5e8f\u5bf9\u3002  \n$q$ \u5728\u6b64\u5904\u4e3a\u6309 $p_i$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u540e\u7ec4\u6210\u7684\u539f\u4e0b\u6807\u6570\u5217\u3002  \n$cost_{i,g,j}$ \u4e3a\u8ba1\u7b97\u5728 $i$ \u4e0a\u7684 $g$ \u72b6\u6001\u4e2d\u6bd4 $q_{i-k-1+j}$ \u66f4\u5c0f\u7684\u6570\u5b57\u7684\u6570\u91cf\uff0c\u53ef\u8fdb\u884c\u9884\u5904\u7406\u3002  \n\u6ce8\u610f\u5982\u679c\u4e00\u4e2a\u4f4d\u7f6e\u7684\u72b6\u6001\u586b\u6ee1\u4e86\u5219\u5b83\u6709\u8d44\u683c\u76f4\u63a5\u8df3\u5230 $J+k+1$ \u4e0a\u3002\n\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\uff1a  \n$$dp_{i+1,J,g|(1<<(f-1)}=\\min(dp_{i,j,g}+sum_{J-k-1,q_{J-1-k+f}}+cost_{J,g|(1<<(f-1),f}+(q_J>q_{J-1-k+f}))$$  \n$f$ \u4e3a $g$ \u6ca1\u6709\u88ab\u586b\u7684\u4e00\u4e2a\u4f4d\u7f6e\u3002  \n\u5176\u5b83\u610f\u4e49\u540c\u4e0a\u3002  \n\n\u53d1\u73b0 $J$ \u592a\u5927\u4e86\uff0c\u5b8c\u5168\u65e0\u6cd5\u8fdb\u884c\u8f6c\u79fb\u3002  \n\u4f46\u662f\u6211\u4eec\u53d1\u73b0 $J\\leq i+k$\uff0c\u4e8e\u662f\u6211\u4eec\u8bbe $j=J-i$ \u8fdb\u884c\u8f6c\u79fb\uff0c\u4ece\u4e0a\u6587\u8fdb\u884c\u610f\u4e49\u8f6c\u6362\u5373\u53ef\u3002  \n\ncode\uff1a  \n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N=5010;\nint n,k,p[N],q[N],sum[N][N];\nint dp[N][10][(1<<8)];\nint cost[N][(1<<8)][10];\nint popcnt[(1<<8)];\nbool flag1,flag2;\n//i=j-k+popcnt\n//j=i+k-popcnt\nsigned main(){\n\tios::sync_with_stdio(0);cin.tie(0);cout.tie(0);\n\tcin>>n>>k;\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>p[i],q[p[i]]=i;\n\t//for(int i=1;i<=n;i++)\n\t//\tcout<<q[i]<<\" \";\n\t//cout<<endl;\n\tfor(int i=1;i<=n;i++)\n\t\tsum[i][q[i]]++;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=n;j>=1;j--)\n\t\t\tsum[i][j]+=sum[i-1][j]+sum[i][j+1]-sum[i-1][j+1];\n\tfor(int i=0;i<(1<<k);i++)\n\t\tfor(int j=1;j<=8;j++)\n\t\t\tpopcnt[i]+=((i>>(j-1))&1);\n\tmemset(dp,0x3f,sizeof(dp));\n\tfor(int i=0;i<=k;i++)\n\t\tdp[1][i][0]=0;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int g=0;g<(1<<k);g++){\n\t\t\tint res=0;\n\t\t\tfor(int f=1;f<=k+1;f++){\n\t\t\t\tres=0;\n\t\t\t\tfor(int j=1;j<=k;j++){\n\t\t\t\t\tif(j==f)continue;\n\t\t\t\t\tif(!((g>>(j-1))&1))continue;\n\t\t\t\t\tif(i-1-k+j<1||i-1-k+f<1)continue;\n\t\t\t\t\tres+=(q[i-1-k+j]>q[i-1-k+f]);\n\t\t\t\t}\n\t\t\t\tcost[i][g][f]=res;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<n;i++){\n\t\tfor(int j=0;j<=8;j++){\n\t\t\tint J=j+i;\n\t\t\tfor(int g=0;g<(1<<k);g++){\n\t\t\t\tbool flag=0;\n\t\t\t\t//cout<<i<<\" \"<<J<<\" \"<<g<<\" \"<<dp[i][j][g]<<endl;\n\t\t\t\tfor(int f=1;f<=k;f++){\n\t\t\t\t\t//J-1 k-(J-1) k-J+1\n\t\t\t\t\tif(J-1-k+f>=1&&(!((g>>(f-1))&1))){flag=1;break;}\n\t\t\t\t\tif(J+f>n){flag=1;break;}\n\t\t\t\t\tint to=((g+(1<<k))>>f);\n\t\t\t\t\t//cout<<\"To\"<<to<<\" \"<<sum[J-k-1+f][q[J+f]]<<\" \"<<cost[J+f][to][k+1]<<endl;\n\t\t\t\t\tif(J-k-1+f>=1)\n\t\t\t\t\t\tdp[i+1][j+f-1][to]=min(dp[i+1][j+f-1][to],\n\t\t\t\t\t\t\tdp[i][j][g]+sum[J-k-1+f][q[J+f]]+cost[J+f][to][k+1]);\n\t\t\t\t\telse dp[i+1][j+f-1][to]=min(dp[i+1][j+f-1][to],\n\t\t\t\t\t\t\tdp[i][j][g]+cost[J+f][to][k+1]);\n\t\t\t\t} \n\t\t\t\tif(J+k+1<=n&&!flag){\n\t\t\t\t\tint to=0;\n\t\t\t\t\tdp[i+1][j+k][to]=min(dp[i+1][j+k][to],dp[i][j][g]+sum[J][q[J+k+1]]);\n\t\t\t\t}\n\t\t\t\tfor(int f=1;f<=k;f++){\n\t\t\t\t\tif((g>>(f-1))&1)continue;\n\t\t\t\t\tif(J-1-k+f<1)continue;\n\t\t\t\t\tif(j==0)break;\n\t\t\t\t\tint to=(g|(1<<(f-1)));\n\t\t\t\t\t//cout<<sum[J-k-1][q[J-1-k+f]]+cost[J][to][f]<<endl;\n\t\t\t\t\tif(J-k-1>0)\n\t\t\t\t\t\tdp[i+1][j-1][to]=min(dp[i+1][j-1][to],\n\t\t\t\t\t\t\tdp[i][j][g]+sum[J-k-1][q[J-1-k+f]]+cost[J][to][f]+(q[J]>q[J-1-k+f]));\n\t\t\t\t\telse dp[i+1][j-1][to]=min(dp[i+1][j-1][to],\n\t\t\t\t\t\t\tdp[i][j][g]+cost[J][to][f]+(q[J]>q[J-1-k+f]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t//for(int j=0;j<=8;j++){\n\t//\tint J=j+n;\n\t//\tfor(int g=0;g<(1<<k);g++)\n\t//\t\tcout<<n<<\" \"<<J<<\" \"<<g<<\" \"<<dp[n][j][g]<<endl;\n\t//}\n\tcout<<dp[n][0][(1<<min(n-1,k))-1];\n\treturn 0;\n}\n```\n",
        "postTime": 1664372528,
        "uid": 213173,
        "name": "\u5c0f\u6728\u866b",
        "ccfLevel": 4,
        "title": "\u3010CF\u6563\u88c5\u677f\u5237\u3011CF1730F Almost Sorted"
    },
    {
        "content": "> \u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u7f6e\u6362 $p$\uff0c\u4ee5\u53ca\u4e00\u4e2a\u6b63\u6574\u6570 $k$\uff0e\n> \n> \u5bf9\u4e8e\u4e00\u4e2a\u7f6e\u6362 $q$\uff0c\u8981\u6c42\u5bf9\u4e8e\u6240\u6709\u6ee1\u8db3 $1\\leq i<j\\leq n$ \u7684 $i,j$\uff0c\u6709\u4ee5\u4e0b\u4e0d\u7b49\u5f0f\u6210\u7acb\uff1a\n> $$\np_{q_i}\\leq p_{q_j}+k\n$$\n> \u73b0\u5728\u8bf7\u6c42\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684\u7f6e\u6362 $q$ \u4e2d\uff0c\u9006\u5e8f\u5bf9\u6570\u6700\u5c0f\u7684 $q$\uff0c\u5b83\u9006\u5e8f\u5bf9\u6570\u662f\u591a\u5c11\u3002\n> \n> $1\\leq n\\leq 5000,1\\leq k\\leq 8$\uff0e\n\n\u76f8\u5f53\u4e8e\u8981\u5bf9 $p$ \u8fdb\u884c\u91cd\u6392\uff0c\u5982\u679c\u5c06\u67d0\u4e2a\u524d\u7f00\u51fa\u73b0\u8fc7\u7684 $p$ \u770b\u4f5c\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\uff0c\u90a3\u4e48\u5373\u4e3a\u8981\u6c42\u6700\u9ad8\u7684 $1$ \u548c\u6700\u4f4e\u7684 $0$ \u4e4b\u95f4\u76f8\u5dee\u4e0d\u80fd\u8d85\u8fc7 $k$\uff0e\u6240\u4ee5\u6211\u4eec\u77e5\u9053\u5982\u679c\u586b\u4e86 $i$\uff0c\u90a3\u4e48 $<i-k$ \u7684\u90a3\u4e9b\u6570\u4e00\u5b9a\u5df2\u7ecf\u586b\u8fc7\u4e86\u3002\u6240\u4ee5\u5148 $\\mathcal{O}(n^2)$ \u628a $<i-k$ \u7684\u90a3\u4e9b\u9006\u5e8f\u5bf9\u7ed9\u7edf\u8ba1\u4e0a\u3002\n\n\u90a3\u4e48\u5c31\u597d dp \u4e86\uff0c$f_{i,S}$ \u8868\u793a\u4ece\u4f4e\u5230\u9ad8\u586b\u5230\u4e86 $i$\uff0c\u7136\u540e $i$ \u524d\u9762 $k$ \u4e2a\u6570\u586b\u7684\u72b6\u6001\u662f $S$\uff0c\u53ea\u8bb0\u524d $k$ \u4e2a\u662f\u56e0\u4e3a\u7531\u4e8e\u6761\u4ef6\u7684\u9650\u5236 $<i-k$ \u7684\u90fd\u4e00\u5b9a\u5df2\u7ecf\u586b\u8fc7\u4e86\u3002\n\n\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $\\mathcal{O}(n^2+nk^22^k)$\uff0c\u56e0\u4e3a\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u4e0b\u4e00\u4e2a\u586b\u5565\u662f $\\mathcal{O}(k)$ \u7684\uff0c\u8fd8\u6709\u4e00\u4e2a\u66b4\u529b $\\mathcal{O}(k)$ \u8ba1\u7b97\u9006\u5e8f\u5bf9\u8d21\u732e\u3002\n\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef pair<int,ll>pil;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntypedef vector<pil>vpil;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x,T2& ...y){read(x);read(y...);}\nconst int mod=998244353;\ninline void cadd(int &x,int y){x=(x+y>=mod)?(x+y-mod):(x+y);}\ninline void cdel(int &x,int y){x=(x-y<0)?(x-y+mod):(x-y);}\ninline int add(int x,int y){return (x+y>=mod)?(x+y-mod):(x+y);}\ninline int del(int x,int y){return (x-y<0)?(x-y+mod):(x-y);}\nconst int inf=0x3f3f3f3f;\ninline int bit(int x){\n\treturn 1<<(x-1);\n}\ninline int all(int x){\n\treturn (1<<x)-1;\n}\nconst int N=5010;\nint n,k,p[N],vis[N],c[N];\nint f[N][260],ans;\nint calc(int x,int s,int i){\n\tint sum=vis[x]>vis[x-i];\n\tfor(int j=1;j<=k&&x-j>=1;j++)\n\t\tif(bit(j)&s)\n\t\t\tif(vis[x-j]>vis[x-i])\n\t\t\t\t++sum;\n\tfor(int j=k+1;x-j>=1&&j<=k+i;j++)\n\t\tif(vis[x-j]>vis[x-i])\n\t\t\t++sum;\n\treturn sum;\n}\nsigned main(){\n\t#ifdef do_while_true\n//\t\tassert(freopen(\"data.in\",\"r\",stdin));\n//\t\tassert(freopen(\"data.out\",\"w\",stdout));\n\t#endif\n\tread(n,k);\n\tfor(int i=1;i<=n;i++)read(p[i]),vis[p[i]]=i;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<i-k;j++)\n\t\t\tif(vis[j]>vis[i])\n\t\t\t\t++ans;\n\tmemset(f,0x3f,sizeof(f));\n\tf[0][(1<<k)-1]=0;\n\tfor(int i=0;i<=n;i++)\n\t\tfor(int s=0;s<(1<<k);s++)if(f[i][s]!=inf){\n\t\t\tfor(int j=1;j<=k;j++)\n\t\t\t\tif(!(bit(j)&s)){\n\t\t\t\t\tcmin(f[i][s|(1<<(j-1))],f[i][s]+calc(i,s,j));\n\t\t\t\t}\n\t\t\tfor(int j=1;j<=k+1&&i+j<=n;j++){\n\t\t\t\tif(j<=k && !(bit(k-j+1)&s))break;\n\t\t\t\tint to=((s<<j)|bit(j))&all(k);\n\t\t\t\tcmin(f[i+j][to],f[i][s]+calc(i+j,to,0));\n\t\t\t}\n\t\t}\n\tcout << f[n][(1<<k)-1]+ans << '\\n';\n    #ifdef do_while_true\n//\t\tcerr<<'\\n'<<\"Time:\"<<1.0*clock()/CLOCKS_PER_SEC*1000<<\" ms\"<<'\\n';\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1666334989,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dCodeforces 1730F Almost Sorted"
    }
]