[
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1611E2)\n\n### \u601d\u8def\n\n\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6027\u8d28\uff1a\u5982\u679c\u4e00\u4e2a\u670b\u53cb\u6bd4\u6211\u65e9\uff0c\u6216\u548c\u6211\u540c\u65f6\u5230\u8fbe\u4e00\u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u5728\u4ee5\u8fd9\u4e2a\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u6240\u6709\u8282\u70b9\uff0c\u6211\u90fd\u5230\u8fbe\u4e0d\u4e86\u3002\n\n\u5bb9\u6613\u60f3\u5230\uff0c\u5982\u679c\u67d0\u4e00\u4e2a\u670b\u53cb\u60f3\u62e6\u622a\u6211\uff0c\u90a3\u4e48\u4ed6\u4e00\u5b9a\u662f\u8981\u5f80\u6839\u7684\u65b9\u5411\uff08\u4e5f\u5c31\u662f\u5411\u4e0a\uff09\u8d70\uff0c\u624d\u80fd\u4f7f\u62e6\u622a\u7684\u8282\u70b9\u66f4\u591a\u3002\n\n\u5982\u679c\u6211\u5411\u67d0\u4e00\u4e2a\u670b\u53cb\u7684\u65b9\u5411\u8d70\uff0c\u90a3\u4e48\u6211\u4eec\u4e24\u4e2a\u4f1a\u5728\u4e2d\u95f4\u76f8\u9047\u3002\u66f4\u5177\u4f53\u5730\uff0c\u5982\u679c\u5728\u6839\u5230\u90a3\u4e2a\u670b\u53cb\u6240\u5728\u7684\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u6709 $x$ \u4e2a\u8282\u70b9\uff08\u4e0d\u5305\u62ec\u8d77\u70b9\u548c\u7ec8\u70b9\uff09\uff0c\u90a3\u4e48\uff0c\u6211\u6700\u591a\u80fd\u5411\u4e0b\u8d70 $\\left\\lceil\\dfrac{x}{2}\\right\\rceil$ \u4e2a\u8282\u70b9\uff0c\u540c\u65f6\uff0c\u90a3\u4f4d\u670b\u53cb\u6700\u591a\u4e5f\u53ea\u80fd\u5411\u4e0a\u8d70 $\\left\\lceil\\dfrac{x}{2}\\right\\rceil$ \u4e2a\u8282\u70b9\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5148 dfs \u4e00\u904d\uff0c\u540c\u65f6\u7528\u4e00\u4e2a\u6808\u6765\u7ef4\u62a4\u8def\u5f84\u4e0a\u7684\u8282\u70b9\uff0c\u5904\u7406\u51fa\u6240\u6709\u670b\u53cb\u6700\u591a\u80fd\u8d70\u5230\u54ea\u4e2a\u8282\u70b9\uff08\u4ee5\u4e0b\u6240\u6709\u670b\u53cb\u5747\u6307\u79fb\u52a8\u8fc7\u540e\u7684\u670b\u53cb\uff09\u3002\n\n\u7136\u540e\u6211\u4eec\u8fdb\u884c\u7b2c\u4e8c\u6b21 dfs\uff0c\u6a21\u62df\u6211\u8d70\u8def\uff0c\u9047\u5230\u670b\u53cb\u5c31\u9000\u56de\u53bb\uff0c\u5982\u679c\u8d70\u5230\u4e86\u67d0\u4e2a\u53f6\u5b50\u8282\u70b9\u5c31\u8bf4\u660e\u6211\u5fc5\u5b9a\u4f1a\u8d62\uff0c\u5426\u5219\u8f93\u51fa\u4e00\u5171\u9047\u5230\u4e86\u51e0\u4e2a\u670b\u53cb\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a\u670b\u53cb\uff0c\u4ee5\u4ed6\u4e3a\u6839\u7684\u5b50\u6811\u5185\u6240\u6709\u5176\u4ed6\u670b\u53cb\u90fd\u53ef\u4ee5\u5220\u53bb\u3002\n\n### Code\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define forr(i, a, n) for (int i = a; i <= n; i++)\n#define rep(i, n) forr(i, 0, n - 1)\n#define repp(i, n) forr(i, 1, n)\n#define pb push_back\n#define mp make_pair\n#define init(a, i) memset(a, i, sizeof(a))\n#define fi first\n#define se second\n#define mod 1000000007\n#define MOD 998244353\n#define MAXN 0x3f3f3f3f\nint T, case_;\nint n, k, a, b, num[200005], dep[200005], ans;\nbool f[200005], del[200005]; //f\u662f\u670b\u53cb\u7684\u4f4d\u7f6e\uff0cdel\u662f\u79fb\u52a8\u540e\u670b\u53cb\u7684\u4f4d\u7f6e\nvector<vector<int>> v;\nvector<int> q; //\u5e94\u8be5\u7528\u6808\u7684\nvoid dfs(int s, int from) //\u7b2c\u4e00\u6b21dfs\n{\n    rep(i, v[s].size())\n    {\n        int x = v[s][i];\n        if (x == from)\n            continue;\n        dep[x] = dep[s] + 1;\n        q.pb(x);\n        if (f[x])\n            num[x] = q[dep[x] / 2];\n        dfs(x, s);\n        q.pop_back();\n    }\n}\nbool get_ans(int s, int from) //\u7b2c\u4e8c\u6b21dfs\n{\n    if (del[s])\n    {\n        ans++;\n        return 1;\n    }\n    if (s && v[s].size() == 1)\n        return 0;\n    rep(i, v[s].size())\n    {\n        int x = v[s][i];\n        if (x == from)\n            continue;\n        if (!get_ans(x, s))\n            return 0;\n    }\n    return 1;\n}\nvoid solve()\n{\n    cin >> n >> k;\n    v.resize(n);\n    rep(i, n) v[i].clear();\n    init(f, 0);\n    rep(i, k)\n    {\n        cin >> a;\n        a--;\n        f[a] = 1;\n    }\n    rep(i, n - 1)\n    {\n        cin >> a >> b;\n        a--, b--;\n        v[a].pb(b);\n        v[b].pb(a);\n    }\n    dep[0] = 1;\n    q.pb(0);\n    init(num, 0);\n    dfs(0, -1);\n    q.pop_back();\n    init(del, 0);\n    rep(i, n) if (f[i]) del[num[i]] = 1;\n    ans = 0;\n    if (!get_ans(0, -1))\n        cout << \"-1\\n\";\n    else\n        cout << ans << endl;\n}\nint main()\n{\n    T = 1;\n    cin >> T;\n    for (case_ = 1; case_ <= T; case_++)\n        solve();\n    return 0;\n}//by JFHT\n```\n",
        "postTime": 1638165928,
        "uid": 407564,
        "name": "Rushroom",
        "ccfLevel": 7,
        "title": "CF1611E2 Escape The Maze (hard version)"
    },
    {
        "content": "\u8fd9\u9898\u5e76\u4e0d\u96be\uff0c\u4f46\u662f\u7ec6\u8282\u4f17\u591a\uff0c\u6211\u8c03\u4e86\u4e00\u4e2a\u5c0f\u65f6\u624d\u8fc7\u7684\u3002\n\n## \u601d\u8def\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5**\u9884\u5904\u7406**\u51fa\u6bcf\u4e2a\u70b9\u4ece $1$ \u5f00\u59cb\u7684 dfs \u5e8f\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5224\u65ad\u54ea\u4e9b\u70b9\u662f\u53ef\u4ee5\u8df3\u5230\u7684\u3002\u56e0\u4e3a\u5f53\u4e00\u4e2a\u670b\u53cb\u987a\u7740\u6811\u7684\u8fb9\u5411\u7956\u5148\u8df3\u65f6\uff0c\u81ea\u5df1\u4e5f\u53ef\u4ee5**\u540c\u65f6\u5411\u7740\u8fd9\u4e2a\u670b\u53cb\u6b63\u5728\u8df3\u7684\u90a3\u6761\u6811\u94fe\u5411\u4e0b\u8df3**\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5224\u65ad\u51fa\u6211\u4eec\u8df3\u5230\u7684\u70b9\u7684 dfs \u5e8f\u4e00\u5b9a\u5c0f\u4e8e $1+$ \u51fa\u53d1\u70b9\u7684 dfs \u5e8f\u3002\n\n\u4f46\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4ecd\u7136\u662f $O(n^2)$ \u7684\uff0c\u65e0\u6cd5\u901a\u8fc7\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u4f18\u5316\u3002\u4e0d\u96be\u60f3\u5230\u6839\u636e\u6bcf\u4e2a $r_i$ \u7684 dfs \u5e8f\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\u82e5\u6211\u4eec\u5f53\u524d\u9047\u5230\u4e00\u4e2a\u70b9\u5df2\u7ecf\u88ab\u8bbf\u95ee\u8fc7\u3002\u6211\u4eec\u4e0d\u7528\u7ee7\u7eed\u8bbf\u95ee\uff0c\u56e0\u4e3a**\u6211\u4eec\u80fd\u8bbf\u95ee\u5230\u7684\u4e00\u5b9a\u88ab\u8bbf\u95ee\u8fc7\u4e86\uff0c\u6211\u4eec\u4e0d\u80fd\u8bbf\u95ee\u5230\u7684\u4e5f\u53ef\u80fd\u5df2\u7ecf\u88ab\u8bbf\u95ee\u8fc7\u4e86**\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u7ee7\u7eed\u8bbf\u95ee\u662f\u6ca1\u5fc5\u8981\u7684\u3002\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n+n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define rint register int\nint const N=2e6+10;\nint vis[N],tms[N],ts[N],b[N],vs[N],ans,r[N];\nvector<int>a[N];\ninline void make_ans(int x){\n    if (ans==-1) return;\n\tif (vis[x]){++ans;return;}\n\tif (!ts[x]) ans=-1;//\u8868\u793a\u78b0\u5230\u53f6\u5b50\u5c31\u8fd4\u56de\n\tvs[x]=1;\n\tfor (rint i=0;i<a[x].size();++i)\n\t    if (!vs[a[x][i]])\n\t\t    make_ans(a[x][i]);\n}//\u5bfb\u627e\u7b54\u6848\u7684\u8fc7\u7a0b\ninline void solve(int x,int st){\n\tif (x==0) return;\n\tif (vis[x]) return;//\u526a\u679d\n\tif (tms[x]<((tms[st]+2)/2)) return;\n    vis[x]=1;\n\tsolve(b[x],st);\n}//\u627e\u51fa\u6bcf\u4e2a\u70b9\u80fd\u8df3\u5230\u54ea\u91cc\ninline void dfs(int x,int dfn){\n\ttms[x]=dfn;vs[x]=1;\n\tint tag=0;\n\tfor (rint i=0;i<a[x].size();++i)\n\t    if (!vs[a[x][i]])\n\t\t\ttag=1,dfs(a[x][i],dfn+1),b[a[x][i]]=x;\n    ts[x]=tag;//\u6807\u8bb0\u662f\u5426\u4e3a\u53f6\u5b50\u8282\u70b9\n}//\u6c42\u51fa\u6bcf\u4e2a\u5e97\u7684 dfs \u5e8f\nstruct node{int rs,id;}as[N];\ninline bool cmp(node a,node b){return a.rs<b.rs;}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0);\n\tcout.tie(0);\n\tint t;cin>>t;\n\twhile (t--){\n\t\tint n,k;cin>>n>>k;\n\t\tans=0;\n\t\tfor (rint i=1;i<=n;++i){\n\t\t    vs[i]=0;\n\t\t    while (a[i].size()) a[i].pop_back();\n\t\t}\n\t\tfor (rint i=1;i<=k;++i) cin>>r[i];\n\t\tfor (rint i=1;i<n;++i){\n\t\t\tint u,v;cin>>u>>v;\n\t\t\ta[v].push_back(u);\n\t\t\ta[u].push_back(v);\n\t\t}\n\t\tdfs(1,1);\n\t    for (rint i=1;i<=n;++i) vis[i]=0;\n\t\tfor (rint i=1;i<=k;++i)\n\t\t    as[i].rs=tms[r[i]],as[i].id=r[i];\n\t    sort(as+1,as+k+1,cmp);//\u6309 r[i] \u6392\u5e8f\n\t\tfor (rint i=1;i<=k;++i)\n\t\t    r[i]=as[i].id,\n\t\t    solve(r[i],r[i]);\n\t\tfor (rint i=1;i<=n;++i) vs[i]=0;\n\t\tmake_ans(1);\n\t\tcout<<ans<<'\\n';\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1658219457,
        "uid": 253608,
        "name": "Tx_Lcy",
        "ccfLevel": 7,
        "title": "CF1611E2 Escape The Maze (hard version)"
    },
    {
        "content": "\u9898\u76ee\u7b80\u8ff0\uff1a\u73b0\u5728\u6709\u4e00\u68f5\u6811\uff0c\u5176\u4e2d1\u53f7\u8282\u70b9\u662f\u6811\u6839\uff0c\u6811\u4e0a\u8fb9\u90fd\u662f\u53cc\u5411\u8fb9\u3002\u6811\u4e0a\u6709 $n$ \u4e2a\u70b9\uff0c\u60a8\u6709 $k$ \u4f4d\u670b\u53cb\u3002\u6bcf\u4e2a\u65f6\u523b\uff0c\u60a8\u548c\u60a8\u7684\u670b\u53cb\u90fd\u4f1a\u987a\u7740\u6811\u4e0a\u7684\u8fb9\u8d70\u5411\u53e6\u4e00\u4e2a\u8282\u70b9\u3002\n\n\u60a8\u4f1a\u83b7\u80dc\u5f53\u4e14\u4ec5\u5f53\u4f60\u8d70\u5230\u4e86\u53f6\u5b50\u8282\u70b9\u3002\n\n\u60a8\u4f1a\u8f93\u5f53\u4e14\u4ec5\u5f53\u60a8\u88ab\u4e00\u4e2a\u670b\u53cb\u5728\u60a8\u83b7\u80dc\u4e4b\u524d\u5728\u4efb\u4f55\u623f\u95f4\u6216\u8d70\u5eca\u9047\u5230\u3002\n\n\u95ee\uff1a\u81f3\u5c11\u5728\u6811\u4e2d\u4fdd\u7559\u591a\u5c11\u4e2a\u670b\u53cb\u624d\u80fd\u4f7f\u60a8\u5728\u6e38\u620f\u4e2d\u5931\u8d25\uff1f\n\n\u548c Escape The Maze (easy version) \u4e00\u6837\u7684\u662f\uff0c\u5982\u679c\u80fd\u591f\u5224\u65ad\u60a8\u83b7\u80dc\uff0c\u4e5f\u5c31\u662f\u8bf4 $k$ \u4e2a\u670b\u53cb\u4e00\u8d77\u51fa\u52a8\u90fd\u4e0d\u80fd\u4f7f\u4f60\u5931\u8d25\uff0c\u90a3\u4e48\u76f4\u63a5\u8f93\u51fa -1\n\n\u5426\u5219\uff0c\u5f53\u60a8\u4e0d\u80fd\u524d\u5f80\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u8fd9\u4e2a\u8282\u70b9\u81f3\u5c11\u9700\u89811\u4e2a\u670b\u53cb\u6765\u5c01\u9501\u3002\n\n```\n\nvoid getime(ll now,ll fa){\t\n\tll len=s[now].size();\n\tfor(int i=0;i<len;i++){\n\t\tll y=s[now][i];\n\t\tif(y==fa) continue;\n\t\tdep[y]=dep[now]+1;\n\t\tgetime(y,now);\n\t\ttline[now]=min(tline[now],tline[y]+1);\n\t}\n}\n\nvoid cheak(ll now,ll fa){\n\tll len=s[now].size();\n\tif(len==1&&s[now][0]==fa){// had been arrived\n\t\tflag=1;\n\t\treturn;\n\t}\n\tfor(int i=0;i<len;i++){\n\t\tll y=s[now][i];\n\t\tif(y==fa) continue;\n\t\tif(tline[y]>dep[y]) cheak(y,now);\n\t\telse need++;\n\t}\n\t//if(res==0) flag=1;\n}\n\nvoid clear(ll n,ll k){\n\tfor(int i=1;i<=n;i++) s[i].clear(),tline[i]=1e9;\n\tfor(int i=1,d;i<=k;i++) d=read(),tline[d]=0;\n\tfor(int i=1,u,v;i<n;i++) u=read(),v=read(),s[u].push_back(v),s[v].push_back(u);\n}\n\nint main(){\n\tt=read();\n\twhile(t-->0){\n\t\tn=read();k=read();\n\t\tclear(n,k);\n\t\tgetime(1,0);\n\t\tflag=0;\n\t\tneed=0;\n\t\tcheak(1,0);\n\t\tif(flag) cout<<-1<<\"\\n\";\n\t\telse cout<<need<<\"\\n\";\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1638070441,
        "uid": 120438,
        "name": "Lacrymabre",
        "ccfLevel": 0,
        "title": "CF1611E2 Escape The Maze (hard version)"
    }
]