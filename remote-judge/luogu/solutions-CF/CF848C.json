[
    {
        "content": "\u795e\u4ed9CDQ\u5206\u6cbb%%%\n-\n\n~~\u521a\u542c\u795e\u4ed9\u8bb2\u5b8c\u795e\u4ed9\u7684CDQ\u5206\u6cbb\uff0c\u987a\u4fbf\u505a\u4e86\u4e00\u9053\u795e\u4ed9\u4f8b\u9898~~\n\n\u8fd9\u9898\uff0c$\\sum i-last_{A_i}$ \u663e\u7136\u4e0d\u597d\u6c42\uff0c\u8003\u8651\u8f6c\u5316\u6210\n\n$\\sum_{i=L}^{R} i-pre_{A_i}  [pre_{A_i}>=L]$\n\n\u53c8\u7531\u4e8e$pre_{A_i}<=i$\uff0c\u90a3\u4e48\u7b54\u6848\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199\u6210\n\n$\\sum_{i=1}^{R} i-pre_{A_i}  [pre_{A_i}>=L]$\n\n\u5373\n\n$\\sum i-pre_{A_i}  [i<=R][pre_{A_i}>=L]$\n\n- $i<=R$\u3000\u3000\u3000\n- $pre_{A_i}>=L$\u3000\u3000\n- \u518d\u52a0\u4e0a\u64cd\u4f5c\u7684\u65f6\u95f4\u8f74 $t$ \n\n\u6ca1\u9519\uff0c\u5c31\u662f\u4e09\u7ef4\u504f\u5e8f\uff0cCDQ\u5206\u6cbb\uff01\uff01\uff01\n\n----\n#### \u5177\u4f53\u64cd\u4f5c\n- \u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u5c31\u4e3a$(t,i,pre_{A_i})$\uff0c\u6743\u503c\u4e3a$i-pre_{A_i}$\n\n- \u4fee\u6539\u7684\u65f6\u5019\uff0c\u5220\u9664\u53ea\u8981\u628a\u4e0a\u6b21\u7684\u62b5\u6d88\u6389\u5373\u53ef\uff0c\u5373\u52a0\u5165$(t,i,pre_{A_i})$\uff0c\u6743\u503c\u4e3a$-(i-pre_{A_i})$\uff0c\u7136\u540e\u52a0\u5165\u65b0\u8282\u70b9\u5c31\u540c\u4e0a\n\n- \u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u5c31\u4e3a$(t,r,l)$\n\n\u81f3\u4e8e\u7ef4\u62a4pre\uff0c\u7528set\u5373\u53ef\uff0c\u590d\u6742\u5ea6$O(N(log_2^N)^2)$\n\nCode\n--\n```java\n#include<bits/stdc++.h>\n#define gt() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++)\n#define pt(ch) (Top<1000000?St[Top++]=ch:(Out(),St[(Top=0)++]=ch))\n#define Out() (fwrite(St,1,Top,stdout))\n#define LL unsigned int\nusing namespace std;\nint Top;static char St[1000000],buf[1000000],*p1=buf,*p2=buf;\nconst int maxn=(1e5)+5;\nint N,M,T,Q,P[maxn],cnt;LL Ans[maxn],c[maxn];\nset<int>S[maxn];\nstruct ff{\n\tint x,y,o,f;\n\tinline int val(){return (~f)?(x-y):(y-x);}\n}A[maxn<<3],C[maxn<<3];\nint Re(){\n\tint ret=0;char ch=gt();\n\twhile(ch<'0'||ch>'9') ch=gt();\n\twhile(ch>='0'&&ch<='9') ret=ret*10+(ch^'0'),ch=gt();\n\treturn ret;\n}\nvoid Wri(LL x){if(x>9) Wri(x/10);pt(x%10+'0');}\nvoid Add(int i,int x){while(i<=N) c[i]+=x,i+=i&-i;}\nint Get(int i){int Res=0;while(i) Res+=c[i],i^=i&-i;return Res;}\nvoid Merge(int L,int mid,int R){\n\tfor(int k=L,i=L,j=mid+1;k<=R;k++) C[k]=(j>R||(i<=mid&&A[i].x<=A[j].x))?A[i++]:A[j++];\n\tfor(int k=L;k<=R;k++) A[k]=C[k];\n}\nvoid Solve(int L,int R){\n\tif(L>=R) return;\n\tint mid=L+R>>1,i,j;Solve(L,mid),Solve(mid+1,R);\n\tfor(i=mid+1,j=L;i<=R;i++)if(A[i].o){\n\t\twhile(j<=mid&&A[j].x<=A[i].x){if(!A[j].o) Add(A[j].y,A[j].val());j++;}\n\t\tAns[A[i].o]+=Get(N)-Get(A[i].y-1);\n\t}\n\tfor(i=L;i<j;i++) if(!A[i].o) Add(A[i].y,-A[i].val());\n\tMerge(L,mid,R);\n}\nint main(){\n\t#ifdef hhh\n\tfreopen(\"data.in\",\"r\",stdin);\n\tfreopen(\"data.out\",\"w\",stdout);\n\t#endif\n\tN=Re(),Q=Re();\n\tfor(int i=1;i<=N;i++){\n\t\tS[P[i]=Re()].insert(i);\n\t\tif(S[P[i]].size()>1) \n\t\tA[++M]=(ff){i,*(--S[P[i]].rbegin()),0,1}; \n\t}\n\twhile(Q--){\n\t\tint opt=Re(),x=Re(),y=Re();++T;\n\t\tif(opt==2){A[++M]=(ff){y,x,++cnt,0};continue;}\n\t\t\n\t\tauto i=S[P[x]].find(x);int L=0,R=0;\n\t\tif(i!=S[P[x]].begin()) A[++M]=(ff){x,L=*--i,0,-1},i++;\n\t\tif(++i!=S[P[x]].end()) A[++M]=(ff){R=*i,x,0,-1};\n\t\tif(L&&R) A[++M]=(ff){R,L,0,1};\n\t\tS[P[x]].erase(x);//Del\n\t\t\n\t\tS[P[x]=y].insert(x),i=S[y].find(x),L=R=0;\n\t\tif(i!=S[y].begin()) A[++M]=(ff){x,L=*--i,0,1},i++;\n\t\tif(++i!=S[y].end()) A[++M]=(ff){R=*i,x,0,1};\n\t\tif(L&&R) A[++M]=(ff){R,L,0,-1};//Insert\n\t}\n\tSolve(1,M);\n\tfor(int i=1;i<=cnt;i++) Wri(Ans[i]),pt('\\n');\n    return Out(),0;\n}\n```\n",
        "postTime": 1563017416,
        "uid": 36779,
        "name": "ff_666",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF848C \u3010Goodbye Souvenir\u3011"
    },
    {
        "content": "[$$\\large \\color{purple} My\\;Blog$$](https://www.cnblogs.com/p-b-p-b/p/10360662.html)\n\n-----------\n\n\u6211\u8fd9\u9898\u5171\u5199\u4e86\u56db\u79cd\u505a\u6cd5\uff0c\u5176\u4e2d\u4e24\u79cd\u53ef\u4ee5\u901a\u8fc7\u3002\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u535a\u5ba2\u91cc\u9762\u770b\uff0c\u8fd9\u91cc\u4ec5\u7ed9\u51fa\u6b63\u89e3\u3002\n\n----------\n\n## \u601d\u8def\n\n\u8003\u8651\u6700\u540e\u7684\u51cf\u53bb\u5f00\u59cb\u7684\u7b49\u4ef7\u4e8e\u6bcf\u4e00\u4f4d\u51cf\u53bb\u524d\u9762\u7684\u3002\n\n\u5373\u4f4d\u7f6e$x$\u5bf9$[l,r]$\u7684\u8d21\u732e\u662f$x-pre_x,pre_x\\geq l$\u3002\n\n\u90a3\u4e48\u9898\u76ee\u8f6c\u5316\u4e3a\u4e8c\u7ef4\u6570\u70b9\uff1a\u4e00\u7ef4\u662f\u4f4d\u7f6e$x$\uff0c\u4e00\u7ef4\u662f\u524d\u9a71$pre_x$\uff0c\u6743\u503c\u662f$x-pre_x$\u3002\n\n\u5f53$pre_x$\u53d1\u751f\u6539\u53d8\u65f6\u6d88\u9664\u539f\u6765\u7684\u8d21\u732e\uff0c\u5e76\u52a0\u4e0a\u65b0\u7684\u3002\n\n\u8be2\u95ee\u53ef\u4ee5\u53d8\u4e3a\u67e5\u8be2\u4ee5$(l,l)$\u4e3a\u5de6\u4e0b\u89d2\uff0c$(r,n)$\u4e3a\u53f3\u4e0a\u89d2\u7684\u77e9\u5f62\u4e4b\u548c\u3002\u6309\u7167\u65f6\u95f4CDQ\u5206\u6cbb\uff0c\u6bcf\u6b21\u7b97\u5de6\u8fb9\u7684\u70b9\u5bf9\u53f3\u8fb9\u7684\u77e9\u5f62\u7684\u8d21\u732e\u3002\n\n\u7136\u800c\u8fd9\u4e2a\u77e9\u5f62\u4e0d\u597d\u770b\uff0c\u4f3c\u4e4e\u8fd8\u8981\u5dee\u5206\uff1f\n\n\u5176\u5b9e\u5e76\u4e0d\u7528\u3002\u8003\u8651$x>pre_x$\uff0c\u6240\u4ee5\u76f4\u7ebf$y=x$\u4e0a\u65b9\u662f\u6ca1\u6709\u70b9\u7684\uff0c\u53ef\u4ee5\u628a\u67e5\u8be2\u53d8\u6210\u4ee5$(1,l)$\u4e3a\u5de6\u4e0b\u89d2\uff0c$(r,n)$\u4e3a\u53f3\u4e0a\u89d2\u7684\u77e9\u5f62\u3002\u8fd9\u6837\u53ef\u4ee5\u626b\u63cf\u7ebf+\u6811\u72b6\u6570\u7ec4\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5e94\u8be5\u662f$O(n\\log^2 n)$\u3002\n\n---------\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nnamespace my_std{\n\tusing namespace std;\n\t#define pii pair<int,int>\n\t#define fir first\n\t#define sec second\n\t#define MP make_pair\n\t#define rep(i,x,y) for (int i=(x);i<=(y);i++)\n\t#define drep(i,x,y) for (int i=(x);i>=(y);i--)\n\t#define go(x) for (int i=head[x];i;i=edge[i].nxt)\n\t#define sz 101010\n\ttypedef long long ll;\n\ttemplate<typename T>\n\tinline void read(T& t)\n\t{\n\t\tt=0;char f=0,ch=getchar();\n\t\tdouble d=0.1;\n\t\twhile(ch>'9'||ch<'0') f|=(ch=='-'),ch=getchar();\n\t\twhile(ch<='9'&&ch>='0') t=t*10+ch-48,ch=getchar();\n\t\tif(ch=='.')\n\t\t{\n\t\t\tch=getchar();\n\t\t\twhile(ch<='9'&&ch>='0') t+=d*(ch^48),d*=0.1,ch=getchar();\n\t\t}\n\t\tt=(f?-t:t);\n\t}\n\ttemplate<typename T,typename... Args>\n\tinline void read(T& t,Args&... args){read(t); read(args...);}\n\tvoid file()\n\t{\n\t\t#ifndef ONLINE_JUDGE\n\t\tfreopen(\"a.txt\",\"r\",stdin);\n\t\t#endif\n\t}\n//\tinline ll mul(ll a,ll b){ll d=(ll)(a*(double)b/mod+0.5);ll ret=a*b-d*mod;if (ret<0) ret+=mod;return ret;}\n}\nusing namespace my_std;\n\nint n,m,Q;\nint a[sz];\nint pre[sz],nxt[sz];\nset<int>s[sz];\n\nint calcPre(int x,int col){set<int>::iterator it=s[col].lower_bound(x);--it;return *it;}\nint calcNxt(int x,int col){return *(s[col].upper_bound(x));}\n\nll ans[sz];\nstruct hh\n{\n\tint type; // 0:modify 1:query\n\tint x,y,val;\n\tint id;\n}q[sz*6];\ninline bool cmp(const hh &x,const hh &y)\n{\n\tif (x.type!=y.type) return x.type<y.type;\n\tif (x.type) return x.y<y.y;\n\treturn x.x<y.x;\n}\ninline void calc(int x,int v) // pre[x]->v\n{\n\tq[++m]=(hh){0,x,pre[x],pre[x]-x,0};\n\tpre[x]=v;\n\tq[++m]=(hh){0,x,v,x-v,0};\n}\n\nll sum[sz];\nvoid add(int x,ll v){ if (!x) return; while (x<=n) sum[x]+=v,x+=(x&(-x)); }\nll query(int x){ ll ret=0; while (x) ret+=sum[x],x-=(x&(-x)); return ret; }\n\nvoid solve(int l,int r)\n{\n\tif (l==r) return;\n\tint mid=(l+r)>>1;\n\tsolve(l,mid);solve(mid+1,r);\n\tint p=l-1;\n\trep(i,mid+1,r) if (q[i].type)\n\t{\n\t\twhile (p<mid&&(q[p+1].type||q[p+1].x<=q[i].y))\n\t\t{\n\t\t\t++p;\n\t\t\tif (!q[p].type) add(q[p].y,q[p].val);\n\t\t}\n\t\tans[q[i].id]+=query(n)-query(q[i].x-1);\n\t}\n\trep(i,l,p) if (!q[i].type) add(q[i].y,-q[i].val);\n\tsort(q+l,q+r+1,cmp);\n}\n\nint main()\n{\n\tfile();\n\tint x,y,z;\n\tread(n,Q);\n\trep(i,1,n) s[i].insert(0),s[i].insert(n+1);\n\trep(i,1,n) read(a[i]),s[a[i]].insert(i);\n\trep(i,1,n) pre[i]=calcPre(i,a[i]),nxt[i]=calcNxt(i,a[i]),q[++m]=(hh){0,i,pre[i],i-pre[i],0};\n\tint c=0;\n\twhile (Q--)\n\t{\n\t\tread(z,x,y);\n\t\tif (z==1)\n\t\t{\n\t\t\tif (y==a[x]) continue;\n\t\t\tint Pre=calcPre(x,y),Nxt=calcNxt(x,y);\n\t\t\ts[a[x]].erase(x);s[y].insert(x);\n\t\t\ta[x]=y;\n\t\t\tif (nxt[x]!=n+1) calc(nxt[x],pre[x]);\n\t\t\tif (pre[x]!=0) nxt[pre[x]]=nxt[x];\n\t\t\tif (Pre!=0) nxt[Pre]=x;\n\t\t\tif (Nxt!=n+1) calc(Nxt,x);\n\t\t\tcalc(x,Pre);\n\t\t\tnxt[x]=Nxt;\n\t\t}\n\t\telse ++c,q[++m]=(hh){1,x,y,0,c};\n\t}\n\tsolve(1,m);\n\trep(i,1,c) printf(\"%lld\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1549869305,
        "uid": 76481,
        "name": "p_b_p_b",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF848C \u3010Goodbye Souvenir\u3011"
    },
    {
        "content": "# \u4e8c\u7ef4\u6570\u70b9\uff08\u5e26\u4fee\uff09\n\n\u4eca\u5929\u5f88\u60f3\u5199\u4e8c\u7ef4\u6570\u70b9\uff0c\u8fd9\u91cc\u4ece\u4e8c\u7ef4\u6570\u70b9\u7684\u89d2\u5ea6\u601d\u8003\u3002\uff08\u4ec0\u4e48\u9b3c\u7406\u7531\uff09\n\n\u4e8c\u7ef4\u6570\u70b9\u5b9e\u9645\u4e0a\u5c31\u662f\u89e3\u51b3\u77e9\u5f62\u6c42\u548c\u7684\u95ee\u9898\uff0c\u53ef\u80fd\u5e26\u4fee\u6539\uff0c\u4e00\u822c\u9700\u8981\u79bb\u7ebf\u7ed9\u8be2\u95ee\u6392\u5e8f\u3002\n\n### \u524d\u7f6e\uff1a\n\n\u4e8c\u7ef4\u6570\u70b9\uff08\u9759\u6001\uff09\uff1a[\u4e8c\u7ef4\u6570\u70b9\u677f\u5b50](https://www.luogu.com.cn/problem/P2163)\n\n\u7ed9\u8be2\u95ee\u6392\u5e8f\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e00\u7ef4\uff0c\u968f\u7740\u8be2\u95ee\u63d2\u5165\u65f6\u95f4\u4e0a\u4f5c\u4e3a\u4e00\u7ef4\u3002\n\n### \u672c\u9898\u53ef\u4ee5\u8f6c\u5316\u6210\u4e8c\u7ef4\u6570\u70b9\u95ee\u9898\uff1a\uff08\u5148\u4e0d\u8003\u8651\u4fee\u6539\uff09\n\n\u9996\u5148\uff0c\u201c\u6700\u53f3\u548c\u6700\u5de6\u7684\u5dee\u503c\u201d\u53ef\u4ee5\u8f6c\u5316\u6210\u201c\u76f8\u90bb\u7684\u6bcf\u4e00\u5bf9\u540c\u8272\u7684\u8ddd\u79bb\u5dee\u7684\u548c\u201d\u3002\n\n\u628a\u548c\u7b2c $i$ \u4e2a\u989c\u8272\u76f8\u540c\u4e14\u5728\u5b83\u524d\u9762\u7684\u79bb\u5b83\u6700\u8fd1\u7684\u70b9\u7684\u4e0b\u6807\u8bb0\u4e3a $pre[i]$\u3002\n\n\u672c\u9898\u8981\u6c42\u7684\u5f0f\u5b50\u53ef\u4ee5\u5199\u6210\uff1a$ \\sum\\limits_{(l\\le pre[i],i \\le r)}{i-pre[i]}$\n\n\u7531\u4e8e $i>pre[i]$\uff0c\u8fd9\u4e2a\u9650\u5236\u53ef\u4ee5\u7b80\u5316\u6210\uff1a$(pre[i] \\ge l)$ \u4e14 $(i \\le r)$\n\n\u628a $(pre[i],i)$ \u770b\u505a\u4e00\u4e2a\u70b9\uff0c\u5728\u4e8c\u7ef4\u7684\u77e9\u9635\u4e0a\u8fd9\u4e2a\u70b9\u7684\u6743\u503c\u662f $i-pre[i]$ \u5373\u53ef\u8f6c\u5316\u6210\u4e8c\u7ef4\u6570\u70b9\u95ee\u9898\u3002\u67e5\u8be2\u5c31\u662f\u67e5\u5728\u6a2a\u5750\u6807\u533a\u95f4\u4e3a $[l,r]$\uff0c\u7eb5\u5750\u6807\u533a\u95f4\u4e3a $[l,r]$ \u7684\u77e9\u5f62\u4e2d\u7684\u6743\u503c\u548c\u3002\n\n### \u800c\u672c\u9898\u9700\u8981\u4fee\u6539\u3002\n\n\u4fee\u6539\u4f1a\u5f71\u54cd:\n\n$1$.\u88ab\u4fee\u6539\u4f4d\u7f6e\u7684\u3002\n\n$2$.\u539f\u672c\u7684\u989c\u8272\u7684\u540e\u4e00\u4e2a\u540c\u8272\u7684\u4f4d\u7f6e\u3002\n\n$3$.\u65b0\u989c\u8272\u7684\u540e\u4e00\u4e2a\u540c\u8272\u7684\u4f4d\u7f6e\u3002\n\n\u6240\u4ee5\u628a\u4fee\u6539\u62c6\u6210\u591a\u4e2a\u5728\u4e8c\u7ef4\u5e73\u9762\u4e0a\u5bf9\u70b9\u7684\u4fee\u6539\uff0c\u5e76\u91c7\u7528 cdq \u5206\u6cbb\uff0c\u6765\u628a\u52a8\u6001\u4fee\u6539\u8f6c\u5316\u6210\u9759\u6001\u95ee\u9898\u7684\u65f6\u95f4\u7ef4\u5ea6\u3002\n\n\n### \u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=800010;\nint n,m,cnt,v[N],pre[N];\nset<int> s[N];\nll ans[N];\nstruct node\n{\n    int sign;//1/-1\u8868\u793a\u52a0\u5165\u5220\u9664 0\u8868\u793a\u67e5\u8be2\n    int l,r;//\u67e5\u8be2\u7684\u4e24\u4e2a\u9650\u5236 l,r \u6216\u8005\u4fee\u6539\u7684\u70b9\u7684\u4e24\u7ef4\u5750\u6807\uff08\u6743\u503c\u662fsign*(r-l))\n    int id;//\u8be2\u95ee\u7684\u7f16\u53f7 \u4fee\u6539\u4e3a0 \n}q[N],tmp[N];//\u4e0d\u7528\u5b58\u65f6\u95f4\uff0c\u56e0\u4e3a\u65f6\u95f4\u7ef4\u5ea6\u81ea\u7136\u6709\u5e8f\uff0c\u540e\u9762\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u65f6\u95f4\u7ef4\u5ea6\u800c\u6392\u5e8f\nll tr[N];\ninline int lowbit(int x) {return x&(-x);}\ninline void add(int x,ll v)\n{\n    for(;x<=n;x+=lowbit(x)) tr[x]+=v;\n}\ninline ll ask(int x)\n{\n    ll res=0;\n    for(;x;x-=lowbit(x)) res+=tr[x];\n    return res;\n}\nvoid cdq(int l,int r)//(pre[i]>=l) && (i<=r)\n{\n    if(l>=r) return;\n    int mid=(l+r)>>1;\n    cdq(l,mid); cdq(mid+1,r);\n    int i=l,j=mid+1,k=0;\n    while(i<=mid&&j<=r)//\u5de6\u8fb9\u7684\u5929\u7136\u6ee1\u8db3t\u6bd4\u53f3\u8fb9\u5c0f\uff0c\u6240\u4ee5\u53f3\u8fb9\u5230\u5de6\u8fb9\u67e5\u8be2\n        if(q[i].l>=q[j].l) \n        {\n            if(q[i].sign) add(q[i].r,q[i].sign*(q[i].r-q[i].l));\n            tmp[++k]=q[i],i++;\n        }\n        else{\n            if(!q[j].sign) ans[q[j].id]+=ask(q[j].r);\n            tmp[++k]=q[j],j++;\n        }\n    while(i<=mid)\n    {\n        if(q[i].sign) add(q[i].r,q[i].sign*(q[i].r-q[i].l));\n        tmp[++k]=q[i],i++;\n    }\n    while(j<=r)\n    {\n        if(!q[j].sign) ans[q[j].id]+=ask(q[j].r);\n        tmp[++k]=q[j],j++;\n    }\n    for(int i=l;i<=mid;i++) if(q[i].sign) add(q[i].r,-q[i].sign*(q[i].r-q[i].l));//\u6d88\u9664\u5f71\u54cd\n    for(int i=l,j=1;i<=r;i++,j++) q[i]=tmp[j];//\u6309\u7167l\u6392\u597d\u5e8f\u4e86(\u4ece\u5927\u5230\u5c0f\u6392\u5e8f)\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;i++)\n    {\n        scanf(\"%d\",&v[i]); \n        if(s[v[i]].size())\n        {\n            auto pre=s[v[i]].end();\n            q[++cnt]={1,(*(--pre)),i,0};\n        }\n        s[v[i]].insert(i);\n    } \n    for(int i=1,a,b,c;i<=m;i++)\n    {\n        scanf(\"%d%d%d\",&a,&b,&c);\n        if(a==1)\n        {\n            auto it=s[v[b]].find(b);//\u4e00\u5b9a\u5b58\u5728\n            it++;\n            if(it!=s[v[b]].end()) \n            {\n                int u=(*it);    \n                q[++cnt]={-1,b,u,0}; //\u540e\u4e00\u4e2a\u548c\u6211\u7684\u8fde\u63a5\n                it--;\n                if(it!=s[v[b]].begin())\n                    q[++cnt]={1,(*(--it)),u,0};//\u540e\u4e00\u4e2a\u548c\u524d\u4e00\u4e2a\u7684\u8fde\u63a5\n            }//pre[*it]:\u4eceb\u53d8\u6210b\u524d\u9762\u4e00\u4e2a\n            it=s[v[b]].find(b);\n            if(it!=s[v[b]].begin())\n                q[++cnt]={-1,(*(--it)),b,0};//\u6211\u548c\u524d\u4e00\u4e2a\u7684\u8fde\u63a5\n            s[v[b]].erase(b);\n            \n            v[b]=c;\n            s[v[b]].insert(b);\n            it=s[v[b]].find(b);\n            if(it!=s[v[b]].begin())\n                q[++cnt]={1,(*(--it)),b,0};\n            it=s[v[b]].find(b); it++;\n            if(it!=s[v[b]].end()) \n            {\n                int u=(*it);\n                q[++cnt]={1,b,u,0}; \n                it--;\n                if(it!=s[v[b]].begin())\n                    q[++cnt]={-1,(*(--it)),u,0};\n            }   \n            ans[i]=-1; //\u6807\u8bb0\u8fd9\u4e2a\u95ee\u9898\u4e0d\u9700\u8981\u56de\u7b54\n        }\n        else q[++cnt]={0,b,c,i};\n    }\n    cdq(1,cnt);\n    for(int i=1;i<=m;i++)\n        if(ans[i]!=-1)\n            printf(\"%lld\\n\",ans[i]);\n    return 0;\n}\n```",
        "postTime": 1668483986,
        "uid": 546246,
        "name": "E_huan",
        "ccfLevel": 8,
        "title": "CF848C \u9898\u89e3"
    },
    {
        "content": "\u9898\u89e3\u533a\u597d\u50cf\u90fd\u662f polylog \u7684\u89e3\u6cd5\uff0c\u6211\u6765\u53d1\u4e00\u4e2a $O(n^{\\frac 5 3}\\log n)$ \u7684\u89e3\u6cd5\u3002\n\n## \u9898\u76ee\u5927\u610f\n\n\u8bbe $F(i,l,r)$ \u4e3a\u503c $i$ \u5728\u533a\u95f4 $[l,r]$ \u5185\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4e0b\u6807\u51cf\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4e0b\u6807\u3002\n\n- `1 x y`\uff1a\u5355\u70b9\u4fee\u6539 $a_x \\gets y$\u3002\n- `2 l r`\uff1a\u6c42 $\\sum_{i=1}^n F(i,l,r)$\u3002\n\n## \u505a\u6cd5 1\uff08TLE\uff09\n\n\u8003\u8651\u5e26\u4fee\u83ab\u961f\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u4e0d\u540c\u7684\u989c\u8272\uff0c\u5f00\u4e00\u4e2a `set` \u7ef4\u62a4\u8be5\u989c\u8272\u51fa\u73b0\u7684\u4e0b\u6807\u3002\u5219\u989c\u8272 $i$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u4e3a `*st[i].rbegin()-*st[i].begin()`\u3002\u6309\u7167\u4e00\u822c\u5e26\u4fee\u83ab\u961f\u7684\u5957\u8def\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u6bcf\u79fb\u52a8\u4e00\u6b21\u7aef\u70b9\u662f $O(\\log n)$ \u7684\uff0c\u6545\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^{\\frac 5 3}\\log n)$\uff0c\u5e38\u6570\u8f83\u5927\u3002\u52a0\u4e0a\u5947\u5076\u4f18\u5316\u540e\u672c\u673a $n=10^5$ \u968f\u673a\u6570\u636e\u5927\u6982 $5.8$ \u79d2\u3002\n\n```cpp\nvoid Add(int x) {\n  if (st[a[x]].size()) res -= *st[a[x]].rbegin() - *st[a[x]].begin();\n  st[a[x]].insert(x);\n  res += *st[a[x]].rbegin() - *st[a[x]].begin();\n}\nvoid Del(int x) {\n  res -= *st[a[x]].rbegin() - *st[a[x]].begin();\n  st[a[x]].erase(x);\n  if (st[a[x]].size()) res += *st[a[x]].rbegin() - *st[a[x]].begin();\n}\nvoid AddT(int x, int l, int r) {\n  if (l <= q1[x].x && q1[x].x <= r) Del(q1[x].x);\n  a[q1[x].x] = q1[x].y;\n  if (l <= q1[x].x && q1[x].x <= r) Add(q1[x].x);\n}\nvoid DelT(int x, int l, int r) {\n  if (l <= q1[x].x && q1[x].x <= r) Del(q1[x].x);\n  a[q1[x].x] = q1[x].lst;\n  if (l <= q1[x].x && q1[x].x <= r) Add(q1[x].x);\n}\n\nsigned main() {\n  in(n)(msum)(a_, n), sz = pow(n, 2.0 / 3);\n  re (i, n)\n    a[i] = a_[i];\n  int cnt1 = 0;\n  re (i, msum) {\n    int op = in(), x = in(), y = in();\n    if (op == 1) {\n      q1[++cnt1] = {x, y, a[x]};\n      a[x] = y;\n    } else {\n      ++m2;\n      q2[m2] = {x, y, cnt1, m2};\n    }\n  }\n  re (i, n)\n    a[i] = a_[i];\n  sort(q2 + 1, q2 + m2 + 1);\n  int l = 1, r = 0, t = 0;\n  re (i, m2) {\n    while (t < q2[i].t) AddT(++t, l, r);\n    while (t > q2[i].t) DelT(t--, l, r);\n    while (l > q2[i].l) Add(--l);\n    while (r < q2[i].r) Add(++r);\n    while (l < q2[i].l) Del(l++);\n    while (r > q2[i].r) Del(r--);\n    ans[q2[i].id] = res;\n  }\n  re (i, m2)\n    out(ans[i])('\\n');\n  return 0;\n}\n```\n\n## \u505a\u6cd5 2\uff08AC\uff09\n\n\u6211\u4eec\u53d1\u73b0\u505a\u6cd5 1 \u4e2d\u7684\u5e73\u8861\u6811\u5e38\u6570\u5de8\u5927\uff0c\u8003\u8651\u6362\u4e00\u79cd\u7ef4\u62a4\u65b9\u5f0f\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6bcf\u79cd\u989c\u8272\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u548c\u7b2c\u4e00\u6b21\u51fa\u73b0\u4e4b\u95f4\u7684\u5dee\u503c\u7b49\u4e8e\u76f8\u90bb\u51fa\u73b0\u6b21\u6570\u5bf9\u4e4b\u95f4\u5dee\u503c\u7684\u603b\u548c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u6bcf\u4e2a\u524d\u7f00\u5bf9\u7b54\u6848\u9020\u6210\u7684\u8d21\u732e\u3002\u6bcf\u52a0\u5165\u4e00\u4e2a\u4e0b\u6807\u4e3a $x$ \u7684\u6570\uff0c\u5219\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $x-pre(x)$\uff0c\u5176\u4e2d $pre(x)$ \u4ee3\u8868 $x$ \u7684\u76f8\u540c\u989c\u8272\u524d\u7f00\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5f88\u65b9\u4fbf\u7684\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u8fd8\u662f $O(n^{\\frac 5 3}\\log n)$\uff0c\u4f46\u662f\u8fd9\u4e2a $\\log$ \u662f\u6811\u72b6\u6570\u7ec4\u7684 $\\log$\uff0c\u5e38\u6570\u6bd4\u5e73\u8861\u6811\u5c0f\u5f97\u591a\u3002\u672c\u5730\u968f\u673a\u6570\u636e $n=10^5$ \u53ea\u7528\u4e86\u4e0d\u5230\u4e24\u79d2\u5c31\u8dd1\u5b8c\u4e86\u3002\n\n```cpp\nvoid Add(int x) {\n  if (pre[x]) bit.Add(pre[x], x - pre[x]);\n}\nvoid Del(int x) {\n  if (pre[x]) bit.Add(pre[x], pre[x] - x);\n}\nvoid AddT(int x, int l, int r) {\n  if (l <= q1[x].x && q1[x].x <= r) Del(q1[x].x);\n  pre[q1[x].x] = q1[x].y;\n  if (l <= q1[x].x && q1[x].x <= r) Add(q1[x].x);\n}\nvoid DelT(int x, int l, int r) {\n  if (l <= q1[x].x && q1[x].x <= r) Del(q1[x].x);\n  pre[q1[x].x] = q1[x].lst;\n  if (l <= q1[x].x && q1[x].x <= r) Add(q1[x].x);\n}\n\nsigned main() {\n  in(n)(msum)(a, n), sz = pow(n, 2.0 / 3);\n  int m1 = 0;\n  re (i, n)\n    st[i].insert(0), st[i].insert(n + 1), st[a[i]].insert(i);\n  re (i, n)\n    pre_[i] = pre[i] = *prev(st[a[i]].lower_bound(i)), suf[i] = *st[a[i]].upper_bound(i);\n  re (i, msum) {\n    int op = in(), x = in(), y = in();\n    if (op == 1) {\n      if (y == a[x]) continue;\n      int p = *prev(st[y].lower_bound(x)), s = *st[y].upper_bound(x);\n      st[a[x]].erase(x), a[x] = y, st[a[x]].insert(x);\n      if (suf[x] != n + 1) pre[suf[x]] = pre[x], q1[++m1] = {suf[x], pre[suf[x]], x};\n      if (pre[x]) suf[pre[x]] = suf[x];\n      if (p) suf[p] = x;\n      if (s != n + 1) q1[++m1] = {s, x, pre[s]}, pre[s] = x;\n      q1[++m1] = {x, p, pre[x]};\n      pre[x] = p, suf[x] = s;\n    } else\n      ++m2, q2[m2] = {x, y, m1, m2};\n  }\n  re (i, n)\n    pre[i] = pre_[i];\n  sort(q2 + 1, q2 + m2 + 1);\n  int l = 1, r = 0, t = 0;\n  re (i, m2) {\n    while (t < q2[i].t) AddT(++t, l, r);\n    while (t > q2[i].t) DelT(t--, l, r);\n    while (l > q2[i].l) Add(--l);\n    while (r < q2[i].r) Add(++r);\n    while (l < q2[i].l) Del(l++);\n    while (r > q2[i].r) Del(r--);\n    ll res = bit.Ask(n) - bit.Ask(l - 1);\n    ans[q2[i].id] = res;\n  }\n  re (i, m2)\n    out(ans[i])('\\n');\n  return 0;\n}\n```\n\n",
        "postTime": 1637313401,
        "uid": 207996,
        "name": "yzy1",
        "ccfLevel": 9,
        "title": "CF848C \u9898\u89e3"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\u4e24\u79cd\u64cd\u4f5c   \n$1 \\ l \\ r$\u8868\u793a\u5c06$l$\u4f4d\u7f6e\u4e0a\u7684\u989c\u8272\u53d8\u6210$r$     \n$2 \\ l \\ r$\u8868\u793a\u67e5\u8be2\u533a\u95f4$[l,r]$\u4e2d\u6743\u503c\u548c\u3002    \n**\u6743\u503c\u7684\u5b9a\u4e49\uff1a\u533a\u95f4\u5185\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u989c\u8272$x$\u7684\u4e0b\u6807\u51cf\u53bb\u7b2c\u4e00\u6b21\u51fa\u73b0\u989c\u8272$x$\u4f4d\u7f6e\u7684\u4e0b\u6807**   \n## \u9898\u89e3\n\u795e\u4ed9\u9898\u4e00\u9053\u3002    \n\u8bdd\u8bf4\u4e3a\u4ec0\u4e48\u4e00\u5927\u5806\u4eba\u90fd\u662f\u5199cdq\u5206\u6cbb\uff0c\u867d\u7136\u6211\u4e5f\u4f1a\u4e00\u70b9\u70b9\uff0c\u4f46\u662f\u5c31\u662f\u5199\u4e0d\u51fa\u6765\u3002  \n\u6211\u5199\u4e86\u6811\u72b6\u6570\u7ec4\u5957\u7ebf\u6bb5\u6811\u3002\uff08\u5176\u5b9e\u672c\u8d28\u5dee\u4e0d\u591a\uff0c\u53ea\u662f\u4ee3\u7801\u91cf\u6811\u5957\u6811\u5e38\u89c4\u6bd4cdq\u5206\u6cbb\u4ee3\u7801\u957f\uff0c\u800c\u4e14\u5bb9\u6613\u8c03qwq\uff09\u3002\n\u5148\u8bb2\u4e00\u4e0bcdq\u5206\u6cbb\u600e\u4e48\u505a\u3002\n\u8fd9\u9898\u4e00\u7ef4\u96be\u4ee5\u7ef4\u62a4\u7684\u5730\u65b9\u662f\uff0c\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u53ef\u80fd\u662f\u548c\u4e0d\u5728\u67e5\u8be2\u533a\u95f4\u7684\u70b9\u4ea7\u751f\u7684\u3002   \n\u4e8e\u662f\u6709\u628a\u4e00\u7ef4\u95ee\u9898\u8f6c\u6362\u6210\u4e8c\u7ef4\u95ee\u9898\u7684\u60f3\u6cd5\uff0c\u4e00\u4e2a\u70b9\u7684\u6a2a\u5750\u6807\u5c31\u662f\u8fd9\u4e2a\u70b9\u7684\u4f4d\u7f6e\uff0c\u7eb5\u5750\u6807\u662f\u8fd9\u4e2a\u70b9\u524d\u4e00\u4e2a\u4e0e\u5b83\u989c\u8272\u76f8\u540c\u7684\u70b9\u7684\u4f4d\u7f6e\uff0c\u6743\u503c\u662f\u6a2a\u5750\u6807\u51cf\u7eb5\u5750\u6807\u3002   \n\u8fd9\u6837\u67e5\u8be2$[l,r]$\u533a\u95f4\u7684\u7b54\u6848\uff0c\u5c31\u662f\u4e8c\u7ef4\u5e73\u9762\u4e0a\uff0c$(l,l)$\u70b9\u548c$(r,r)$\u70b9\u7ec4\u6210\u7684\u77e9\u9635\u5185\u7684\u6743\u503c\u4e4b\u548c\u3002\n\u8003\u8651\u6ca1\u6709\u4fee\u6539\u7684\u60c5\u51b5\uff0c\u77e9\u9635\u6c42\u548c\u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\uff0c\u4e00\u6b21\u626b\u63cf\u7ebf\u5c31\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848\u4e86\uff0c\u73b0\u5728\u6709\u4e86\u4fee\u6539\u64cd\u4f5c\uff0c\u6240\u4ee5\u5229\u7528cdq\u5206\u6cbb\uff0c\u628a\u52a8\u6001\u95ee\u9898\u53d8\u9759\u6001\uff0c\u800c\u540e\u518d\u7528\u626b\u63cf\u7ebf\u6c42\u7b54\u6848\u3002 \ncdq\u5206\u6cbb\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8003\u8651\u5de6\u53f3\u5b50\u95ee\u9898\u7684\u7b54\u6848\u90fd\u5df2\u7ecf\u6c42\u51fa\uff0c\u73b0\u5728\u8981\u8003\u8651\u5de6\u5b50\u95ee\u9898\u7684\u4fee\u6539\u64cd\u4f5c\u5bf9\u53f3\u5b50\u95ee\u9898\u7684\u67e5\u8be2\u64cd\u4f5c\u7684\u5f71\u54cd\u3002  \n\u628a\u5de6\u8fb9\u7684\u4fee\u6539\u64cd\u4f5c\u548c\u53f3\u8fb9\u7684\u67e5\u8be2\u64cd\u4f5c\u653e\u5728\u4e00\u8d77\uff0c\u8fdb\u884c\u626b\u63cf\u7ebf\u5373\u53ef\u3002\n\u7136\u540e\u6211\u4eec\u6765\u8bb2\u4e00\u4e0b\u5982\u4f55\u7528\u6811\u5957\u6811\u6c34\u8fc7\u8fd9\u4e00\u9898\u76ee\u3002\n\u5176\u5b9e\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5f53\u505a\u7b2c\u4e00\u7ef4\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7b2c\u4e8c\u7ef4\uff0c\u76f4\u63a5\u6a21\u62df\u5e73\u9762\u4e0a\u7684\u77e9\u9635\u3002\n\u6bcf\u6b21\u9700\u8981\u4fee\u6539\u5c31\u7528$set$\u6765\u6c34\u4e00\u4e0b\u3002\u66b4\u529b\u4e71\u641e\u5927\u6cd5\u543c\u5440\uff01\n## \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace IOstream {\n\t#define gc getchar\n\ttemplate <typename T>\n\tinline void read(T &x) {\n\t\tx = 0; T fl = 1; char c = 0;\n\t\tfor (; c < '0' || c > '9'; c = gc())\n\t\t\tif (c == '-') fl = -1;\n\t\tfor (; c >= '0' && c <= '9'; c = gc())\n\t\t\tx = (x << 1) + (x << 3) + (c ^ 48);\n\t\tx *= fl;\n\t}\n\t#undef gc\n} using namespace IOstream;\n\ntypedef long long ll;\ntypedef set<int>::iterator sit;\nconst int N = 100000 + 6;\nset<int> st[N];\nint n, m;\nint rt[N], a[N], fst[N];\n\nnamespace seg {\n\t#define ls(x) tr[x].lc\n\t#define rs(x) tr[x].rc\n\tint ntot = 0; \n\tstruct node {\n\t\tint lc, rc;\n\t\tll s; \n\t\tnode() { lc = rc = s = 0; }\n\t} tr[N * 120];\n\tvoid upd(int &nod, int l, int r, int k, ll val) {\n\t\tif (!nod) nod = ++ ntot;\n\t\ttr[nod].s += val; \n\t\tif (l == r) return; \n\t\tint mid = (l + r) >> 1;\n\t\tif (k <= mid) upd(ls(nod), l, mid, k, val);\n\t\telse upd(rs(nod), mid + 1, r, k, val);\n\t}\n\tll query(int nod, int l, int r, int k) {\n\t\tif (!nod) return 0;\n\t\tif (l == r) return tr[nod].s;\n\t\tint mid = (l + r) >> 1;\n\t\tif (k <= mid) return query(ls(nod), l, mid, k) + tr[rs(nod)].s;\n\t\telse return query(rs(nod), mid + 1, r, k);\n\t}\n\t#undef ls\n\t#undef rs\n}\n\nnamespace BIT_TREE {\n\t#define lowbit(x) (x & -x) \n\tvoid add(int k, int q, ll val, int n) {\n\t\tfor (int i = k; i <= n; i += lowbit(i)) seg::upd(rt[i], 1, n, q, val);\n\t}\n\tll sum(int k, int q, int n) {\n\t\tll res = 0ll;\n\t\tfor (int i = q; i; i -= lowbit(i)) res += seg::query(rt[i], 1, n, k);\n\t\treturn res; \n\t}\n\t#undef lowbit\n}\n\nsit lst(sit it) {\n\treturn -- it;\n}\nsit nxt(sit it) {\n\treturn ++ it;\n}\nvoid upd(int x, int y, int n){\n\tif(fst[x]) BIT_TREE::add(x, fst[x], fst[x] - x, n);\n\tif(y) BIT_TREE::add(x, y, x - y, n);\n\tfst[x] = y;\n}\nint main() {\n\tread(n); read(m);\n\tfor (int i = 1; i <= n; i ++) read(a[i]);\n\tfor (int i = 1; i <= n; i ++) {\n\t\tif (st[a[i]].size()) { // if set isn't empty\n\t\t\tfst[i] = *st[a[i]].rbegin(); \n\t\t\tBIT_TREE::add(i, fst[i], i - fst[i], n);\n\t\t}\n\t\tst[a[i]].insert(i);\n\t}\n\twhile (m --) {\n\t\tint opt, x, y;\n\t\tread(opt); read(x); read(y); \n\t\tif (opt == 1) { //  operation of upd\n\t\t\tsit it = st[a[x]].find(x);\n\t\t\tif (nxt(it) != st[a[x]].end()) \n\t\t\t\tupd(*nxt(it), (it == st[a[x]].begin() ? 0 : *lst(it)), n);\n\t\t\tst[a[x]].erase(x);\n\t\t\ta[x] = y; \n\t\t\tit=st[y].insert(x).first;\n\t\t\tupd(x, (it == st[y].begin() ? 0 : *lst(it)), n);\n\t\t\tif(nxt(it) != st[y].end())\n\t\t\t\tupd(*nxt(it), x, n);\n\t\t} else { // operation of query ans\n\t\t\tprintf(\"%lld\\n\", BIT_TREE::sum(x, y, n));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1556524527,
        "uid": 35567,
        "name": "Ayers",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF848C \u3010Goodbye Souvenir\u3011"
    },
    {
        "content": "[$\\tt Link$](/problem/CF848C)\n\n## \u524d\u8a00\n\n\u9898\u89e3\u6e05\u4e00\u8272\u7684 $\\tt CDQ$\uff0c\u6811\u5957\u6811\uff0c\u4f46\u662f\u6709\u4e2a $\\mathcal O(n^{\\frac 53}\\log n)$ \u662f\u4ec0\u4e48\u9b3c\uff1f\n\n\u8fd9\u662f\u4e00\u4e2a\u5206\u5757\u505a\u6cd5\uff0c\u590d\u6742\u5ea6 $\\mathcal O(n\\sqrt n)$\uff0c\u4f46\u662f\u975e\u5e38\u9634\u95f4\uff0c\u5efa\u8bae\u8c28\u614e\u5c1d\u8bd5\u3002\n\n\u5982\u679c\u4f60\u771f\u5fc3\u60f3\u5199\u8fd9\u4e2a\u505a\u6cd5\uff0c\u5efa\u8bae\u5199\u5b8c\u8fd9\u9898\u5c31\u53bb\u5199 [$\\tt rdiq$](/problem/P7448)\uff0c[$\\tt rcn$](/problem/P7721)\u3002\n\n## \u8f6c\u5316\n\n\u8003\u8651\u8bb0\u4e0b\u6bcf\u4e2a\u4f4d\u7f6e\u524d\u4e00\u4e2a\u4e0e\u5b83\u989c\u8272\u76f8\u540c\u7684\u4f4d\u7f6e $P_i$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u8d21\u732e\u4ece\u6bcf\u79cd\u989c\u8272\u8f6c\u5316\u5230\u6bcf\u4e2a\u4f4d\u7f6e\u3002\n\n\u65b9\u6cd5\u662f\u5b9a\u4e49\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u4e3a $i-P_i$\uff0c\u5f53\u7136\u8981 $P_i\\ge$ \u8be2\u95ee\u5de6\u7aef\u70b9\u3002\n\n\u5047\u5982\u4e00\u4e2a\u989c\u8272\u6240\u6709\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $b_1,\\cdots,b_k$\uff0c\u90a3\u4e48\u603b\u8d21\u732e\u4e3a\uff1a\n\n$$\n\\begin{aligned}\nSum&=(b_k-P_{b_k})+\\cdots+(b_2-P_{b_2})\\\\\n&=(b_k-b_{k-1})+\\cdots+(b_2-b_1)\\\\\n&=b_k-b_1\n\\end{aligned}\n$$\n\n\u53ef\u4ee5\u770b\u51fa\u6700\u540e\u5c31\u662f\u6211\u4eec\u60f3\u6c42\u7684\u3002\n\n\u8f6c\u5316\u5b8c\u540e\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u95ee\u9898\u6362\u6210\u4e00\u4e2a\u4e8c\u7ef4\u6570\u70b9\u7684\u5f62\u5f0f\uff0c\u5373\u6709 $n$ \u4e2a\u70b9 $(i,P_i)$\uff0c\u5176\u6743\u503c\u4e3a $i-P_i$\u3002\u8be2\u95ee\u5c31\u76f8\u5f53\u4e8e\u6c42 $[l,r][l,n]$ \u8fd9\u4e00\u6bb5\u7684\u548c\u3002\n\n**\u5173\u4e8e\u70b9\u7684\u6027\u8d28\uff1a\u6240\u6709\u70b9\u7684 $x$ \u5750\u6807\u4e92\u4e0d\u76f8\u540c\uff0c$y$ \u5750\u6807\u9664\u4e86\u53ef\u80fd\u6709\u591a\u4e2a $0$ \u4e4b\u5916\uff0c\u4e92\u4e0d\u76f8\u540c.**\n\n## \u4fee\u6539\u64cd\u4f5c\n\n\u5f88\u5e73\u51e1\u3002\u4f60\u7ef4\u62a4\u6bcf\u4e2a\u70b9\u51fa\u73b0\u4f4d\u7f6e\u7684 `set`\uff0c\u7136\u540e\u5c31\u53ef\u4ee5 $O(\\log n)$ \u8ba1\u7b97\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u4e0a\u4e00\u4e2a/\u4e0b\u4e00\u4e2a\u989c\u8272\u76f8\u540c\u4f4d\u7f6e\u3002\n\n## \u4e8c\u7ef4\u5206\u5757\n\n\u8fd9\u4e2a\u9898\u7528\u8fd9\u73a9\u610f\u786e\u5b9e\u5927\u6750\u5c0f\u7528\u4e86\uff0c\u4f46\u662f\u8fd8\u662f\u60f3\u8bf4\u8bf4\u3002\n\n**\u6ce8\u610f\uff1a\u4e0b\u9762\u4ecb\u7ecd\u7684\u662f\u4e00\u79cd $O(\\sqrt n)$ \u524d\u7f00\u77e9\u5f62\u52a0 $O(1)$ \u5355\u70b9\u67e5\u8be2\u7684\u6570\u636e\u7ed3\u6784\u3002\u8f6c\u5316\u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\u9002\u5408\u539f\u95ee\u9898\u7684\u5355\u70b9\u52a0\u77e9\u5f62\u67e5**\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6211\u4eec\u8981\u52a0\u7684\u662f\u8fd9\u4e48\u4e00\u4e2a\u77e9\u5f62\uff08\u5de6\u4e0b\u89d2\u662f\u539f\u70b9\uff0c\u53f3\u4e0a\u89d2\u662f\u8be2\u95ee\u70b9\uff09\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/76po4cy3.png)\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u4ee5\u4e0b\u8bb0 $\\mathbf a=n^{0.25},\\mathbf b=n^{0.5},\\mathbf c=n^{0.75}$\u3002\n\n\u9996\u5148\u56e0\u4e3a\u6574\u5757\u590d\u6742\u5ea6\u8981\u4fdd\u8bc1\uff0c\u6240\u4ee5\u5757\u6570\u662f $O(\\sqrt n)$ \u7684\uff0c\u4e8e\u662f\u4f60\u5c31\u5e94\u8be5\u7528 $\\bf c\\times c$ \u6765\u5206\u5757\uff0c\u8fd9\u6837\u603b\u5757\u6570\u5c31\u662f $O(\\mathbf{a\\times a}=\\sqrt n)$ \u7684\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/04pkufgz.png)\n\n\u4f46\u662f\u6211\u4eec\u6574\u5757\u590d\u6742\u5ea6\u4fdd\u8bc1\uff0c\u6563\u5757\u53c8\u4e0d\u884c\u4e86\u3002\u4e8e\u662f\u8003\u8651\u5728\u73b0\u5728\u7684\u7070\u8272\u90e8\u5206\u5206\u5757\u7528\u6765\u8f85\u52a9\u539f\u6765\u7684\u6563\u5757\uff0c\u5206\u51fa\n\n+ $\\bf a\\times b$ \u4e2a $\\bf c\\times b$ \u7684\u5757\n+ $\\bf b\\times a$ \u4e2a $\\bf b\\times c$ \u7684\u5757\n+ $\\bf b\\times b$ \u4e2a $\\bf b\\times b$ \u7684\u5757\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/d5tnp5jb.png)\n\n\u73b0\u5728\u603b\u5171\u5206\u4e86 $4$ \u79cd\u5757\uff0c\u5bf9\u4e8e\u6bcf\u79cd\u5757\u6211\u4eec\u90fd\u7ef4\u62a4\u5757\u548c\u3002\n\n\u73b0\u5728\u6765\u7b97\u4e00\u4e0b\u590d\u6742\u5ea6\u3002\n\n+ \u5bf9\u4e8e\u7ea2\u8272\u5757\u800c\u8a00\uff0c\u5b83\u4e00\u5b9a\u4e0d\u8d85\u8fc7 $\\sqrt n$ \u4e2a\u3002\n+ \u5bf9\u4e8e\u6a59\u8272\u5757\u800c\u8a00\uff0c\u5b83\u4e00\u884c\u6700\u591a\u53ea\u6709 $n\\div\\mathbf c=n^{0.25}$ \u4e2a\uff0c\u4e00\u5217\u6700\u591a\u53ea\u6709 $\\mathbf{c\\div b}=n^{0.25}$ \u4e2a\uff0c\u4e58\u8d77\u6765\u4e0d\u8d85\u8fc7 $\\sqrt n$ \u4e2a\u3002\n+ \u5bf9\u4e8e\u84dd\u8272\u5757\u800c\u8a00\uff0c\u5b83\u4e00\u884c\u6700\u591a\u53ea\u6709 $\\mathbf{c\\div b}=n^{0.25}$ \u4e2a\uff0c\u4e00\u5217\u6700\u591a\u53ea\u6709 $n\\div\\mathbf c=n^{0.25}$ \u4e2a\uff0c\u4e58\u8d77\u6765\u4e0d\u8d85\u8fc7 $\\sqrt n$ \u4e2a\u3002\n+ \u5bf9\u4e8e\u7eff\u8272\u5757\u800c\u8a00\uff0c\u5b83\u4e00\u884c/\u4e00\u5217\u6700\u591a\u53ea\u6709 $\\mathbf{c\\div b}=n^{0.25}$ \u4e2a\uff0c\u4e58\u8d77\u6765\u4e5f\u4e0d\u8d85\u8fc7 $\\sqrt n$ \u4e2a\u3002\n+ \u6563\u5757\u9700\u8981\u7ed3\u5408\u8fd9\u9898\u7684\u7279\u6b8a\u6027\u8d28\u624d\u53ef\u505a\uff0c\u8fd9\u91cc\u4e0d\u4f5c\u8ba8\u8bba\uff0c\u4e0b\u9762\u8bb2\u3002\n\n\u90a3\u6563\u5757\u5982\u4f55\u505a\u5462\uff1f\n\n\u9996\u5148\uff0c\u6563\u5757\u672c\u8eab\u7684\u5b9a\u4e49\u662f\uff1a**\u4e00\u4e2a\u8be2\u95ee\u8986\u76d6\u4e86\u4e00\u4e2a\u70b9\u4f46\u6ca1\u6709\u5b8c\u5168\u8986\u76d6\u8fd9\u4e2a\u70b9\u6240\u5728\u7684 $\\bf b\\times b$ \u5757**\uff0c\u5c31\u662f\u4e0a\u56fe\u4e2d\u7684\u9ec4\u8272\u90e8\u5206\u3002\n\n\u4e0a\u6587\u6240\u8bf4\u7684\u6027\u8d28\uff0c\u5c31\u662f\u8bf4 $x,y$ \u5750\u6807\u90fd\u4e92\u4e0d\u76f8\u540c\uff08\u5982\u679c $y=0$\uff0c\u8fd9\u65f6\u6211\u4eec\u518d\u5199\u4e00\u4e2a\u4e00\u7ef4\u5206\u5757\u505a\u5c31\u597d\u4e86\u3002\uff09\n\n**\u57fa\u4e8e\u6027\u8d28**\uff0c\u6211\u4eec\u628a\u6563\u5757\u62c6\u5206\u4e3a\u4e09\u90e8\u5206\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ntxsmopv.png)\n\n\u5bf9\u4e8e\u7d2b\u8272\u90e8\u5206\uff0c\u679a\u4e3e\u7d2b\u8272\u8303\u56f4\u5185 $x$ \u5750\u6807\uff0c\u7136\u540e\u67e5\u770b $y$ \u5750\u6807\u662f\u5426\u4e5f\u5728\u7d2b\u8272\u8303\u56f4\u5185\uff0c\u5982\u679c\u662f\u5c31\u52a0\u4e0a\u8d21\u732e\u3002\n\n\u5bf9\u4e8e\u7c89\u8272\u90e8\u5206\uff0c\u679a\u4e3e\u7c89\u8272\u8303\u56f4\u5185 $y$ \u5750\u6807\uff0c\u7136\u540e\u67e5\u770b $x$ \u5750\u6807\u662f\u5426\u4e5f\u5728\u7c89\u8272\u8303\u56f4\u5185\uff0c\u5982\u679c\u662f\u5c31\u52a0\u4e0a\u8d21\u732e\u3002\n\n\u4f60\u53ef\u4ee5\u5728\u7d2b\u8272\u90e8\u5206\u7684\u65f6\u5019\u7b97\u4e0a\u84dd\u8272\u90e8\u5206\uff0c\u4e5f\u53ef\u4ee5\u5728\u7c89\u8272\u90e8\u5206\u7684\u65f6\u5019\u7b97\u4e0a\u84dd\u8272\u90e8\u5206\uff0c\u4e0d\u8981\u7b97\u91cd\u5c31\u884c\u4e86\u3002\n\n## Code\n\n```cpp\n#include<stdio.h>\n#include<math.h>\n#include<string.h>\n#include<set>\n\n#define rep(i,a,b) for(int i = (a);i <= (b);++i)\n#define Rep(i,a,b) for(int i = (a);i >= (b);--i)\n#define clr(M) memset(M,0,sizeof M)\n\nconst int N = 1e5 + 5;\n\ntypedef long long ll;\n\nint n,m,a[N],p[N],q[N];\n\nnamespace blk2d{\n\tconst int B1 = 18,B2 = 324,B3 = 5832;\n\tconst int S1 = 25,S2 = 330,S3 = 5840;\n\t\n\tint st2[S2],bl2[N],st3[S1],bl3[N]; ll c0[N],s0[S2];\n\tll c1[S1][S1],c2[S2][S1],c3[S1][S2],c4[S2][S2],c5[N],c6[N];\n\t\n\t#define F1(i,z) rep(i,1,bl3[z] - 1)\n\t#define F2(i,z) rep(i,st3[bl3[z]],bl2[z] - 1)\n\t#define F3(i,z) rep(i,st2[bl2[z]],z)\n\t#define bl(i,t) (i - 1) / t + 1\n\t\n\tvoid init(){\n\t\trep(i,1,n) bl2[i] = bl(i,B2),bl3[i] = bl(i,B3);\n\t\tRep(i,n,1) st2[bl2[i]] = i,st3[bl3[i]] = bl2[i];\n\t}\n\t\n\tvoid upd(int x,int y,ll t){\n\t\tp[x] = y; q[y] = x;\n\t\tif(y == 0) return c0[x] += t,void(s0[bl2[x]] += t);\n\t\tint a = bl3[x],b = bl2[x],c = bl3[y],d = bl2[y];\n\t\tc1[a][c] += t; c2[b][c] += t; c3[a][d] += t; c4[b][d] += t;\n\t\tc5[x] += t; c6[y] += t;\n\t}\n\t\n\tll qry(int x,int y){\n\t\tll sum = 0;\n\t\tF1(i,x) F1(j,y) sum += c1[i][j];\n\t\tF2(i,x) F1(j,y) sum += c2[i][j];\n\t\tF1(i,x) F2(j,y) sum += c3[i][j];\n\t\tF2(i,x) F2(j,y) sum += c4[i][j];\n\t\tF3(i,x) if(p[i] <= y) sum += c5[i];\n\t\tF3(i,y) if(q[i] < st2[bl2[x]]) sum += c6[i];\n\t\trep(i,1,bl2[x] - 1) sum += s0[i];\n\t\trep(i,st2[bl2[x]],x) sum += c0[i];\n\t\treturn sum;\n\t}\n}\n\nusing namespace blk2d;\n\nstd::set<int> P[N];\n\nint pre(int x){\n\tauto i = P[a[x]].lower_bound(x);\n\treturn i == begin(P[a[x]]) ? 0 : *--i;\n}\n\nint nxt(int x){\n\tauto i = P[a[x]].upper_bound(x);\n\treturn i == end(P[a[x]]) ? 0 : *i;\n}\n\nvoid cpre(int u){\n\tif(!u) return;\n\tint v = pre(u);\n\tupd(u,p[u],p[u] - u);\n\tupd(u,v,u - v);\n}\n\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\trep(i,1,n) scanf(\"%d\",a + i),P[a[i]].insert(i);\n\tinit();\n\trep(u,1,n) p[u] = pre(u),upd(u,p[u],u - p[u]);\n\twhile(m--){\n\t\tint op,x,y;\n\t\tscanf(\"%d%d%d\",&op,&x,&y);\n\t\tif(op == 1){\n\t\t\tint w = nxt(x);\n\t\t\tP[a[x]].erase(x); P[a[x] = y].insert(x);\n\t\t\tcpre(x); cpre(w); int v = nxt(x); cpre(v);\n\t\t\tq[p[x]] = x; q[p[w]] = w; q[p[v]] = v;\n\t\t} else printf(\"%lld\\n\",qry(y,n) - qry(y,x - 1) - qry(x - 1,n) + qry(x - 1,x - 1));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1651641443,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "CF848C Goodbye Souvenir"
    },
    {
        "content": "\u8fd8\u6ca1\u6709 KDTree \u7684\u9898\u89e3\uff1f\n\n~~\u90a3\u8fd9\u4e00\u6ce2\u53eb\u8d81\u865a\u800c\u5165~~\u3002\n\n## \u9898\u76ee\u5b9a\u4f4d\n\nKDT\u3001CDQ\u3001\u6811\u5957\u6811\u2026\u2026\u4efb\u4f55\u53ef\u4ee5\u6570\u70b9\u7684\u505a\u6cd5\u90fd\u53ef\u4ee5\u505a\uff0c\u518d\u52a0\u4e0a\u5e73\u8861\u6811\u7ef4\u62a4\u4e00\u4e2a\u989c\u8272\u4e0a\u6b21\u548c\u4e0b\u6b21\u51fa\u73b0\u4f4d\u7f6e\u3002\n\n[\u9898\u76ee\u5730\u5740](https://codeforces.com/contest/848/problem/C)\uff0c\u5927\u610f\u5982\u4e0b\uff1a\n\n> \u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u7ec4\uff0c\u591a\u7ec4\u64cd\u4f5c\uff0c\u6bcf\u7ec4\u64cd\u4f5c\u4e3a\u4fee\u6539\u4e00\u4e2a\u6570\u7684\u503c\uff0c\u6216\u8005\u67e5\u8be2\u533a\u95f4\u5185\u6240\u6709\u6570\u7684\u6743\u503c\u548c\u3002\n>\n> \u4e00\u4e2a\u6570\u7684\u6743\u503c\uff0c\u5b9a\u4e49\u4e3a\u5176\u5728\u533a\u95f4\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u548c\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4e0b\u6807\u7684\u5dee\uff0c\u76f8\u540c\u7684\u6570\u5b57\u6743\u503c\u53ea\u8ba1\u7b97\u4e00\u6b21\u3002\n>\n> $n,q,a_i\\leqslant 10^5$\n\n## \u9898\u76ee\u5206\u6790\n\n\u8be2\u95ee\u548c\u6570\u503c\u5927\u5c0f\u65e0\u5173\uff0c\u628a\u586b\u6570\u770b\u6210\u67d3\u8272\u3002\u8bbe\u4e00\u6bb5\u67e5\u8be2\u533a\u95f4\u5185\uff0c\u67d0\u4e2a\u989c\u8272\u51fa\u73b0\u7684\u4f4d\u7f6e\u5206\u522b\u4e3a $i_1,i_2,i_3,\\cdots,i_m$\u3002\n\n\u6839\u636e\u5b9a\u4e49\uff0c\u8fd9\u4e2a\u989c\u8272\u4ea7\u751f\u7684\u8d21\u732e\u662f $i_m-i_1$\u3002\u8fd9\u5c31\u8ba9\u4e2d\u95f4\u7684\u4e00\u5806\u6570\u6ca1\u6709\u53c2\u4e0e\u8d21\u732e\u8ba1\u7b97\uff0c\u4e0d\u65b9\u4fbf\u7ef4\u62a4\uff0c\u8fd9\u4e0d\u597d\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff1a\n$$\n(i_2-i_1)+(i_3-i_2)+(i_4-i_3)+\\cdots+(i_m-i_{m-1})=i_m-i_1\n$$\n\u56e0\u6b64\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u989c\u8272\uff0c\u8bbe\u5176\u4f4d\u4e8e\u4f4d\u7f6e $i$\uff0c\u5219\u627e\u5230\u5176\u4e0a\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u4e3a $0$\uff09$pre_i$\u3002\u9898\u76ee\u8f6c\u5316\u4e3a\uff1a\u7ed9\u5b9a\u533a\u95f4 $[l,r]$\uff0c\u6c42 $\\sum i-pre_i$\uff0c\u5176\u4e2d $l\\leqslant pre_i<i\\leqslant r$\u3002\n\n\u6211\u4eec\u5c06\u4e00\u4e2a\u4f4d\u7f6e\u6269\u5c55\u6210\u4e00\u4e2a\u4e8c\u7ef4\u5e73\u9762\u4e0a\u7684\u70b9\uff0c\u8bbe\u5176\u4f4d\u7f6e\u4e3a $i$\uff0c\u5219\u4ee5 $i$ \u4e3a\u6a2a\u5750\u6807\uff0c$pre_i$ \u4e3a\u7eb5\u5750\u6807\u3002\u90a3\u4e48\u7b26\u5408\u6761\u4ef6\u7684\u70b9\u5c31\u4f4d\u4e8e\u5de6\u4e0b\u89d2\u4e3a $(l,l)$\uff0c\u53f3\u4e0a\u89d2\u4e3a $(r,r)$ \u7684\u77e9\u5f62\u5185\u3002\u4e0d\u59a8\u518d\u7ed9\u6bcf\u4e2a\u70b9\u8d4b\u4e88\u4e00\u4e2a\u6743\u503c $i-pre_i$\uff0c\u8be2\u95ee\u5c31\u8f6c\u5316\u4e3a\u67e5\u8be2\u77e9\u9635\u5185\u70b9\u6743\u548c\u3002\u5c31\u662f\u7ecf\u5178\u7684\u6570\u70b9\u95ee\u9898\u4e86\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\u5355\u70b9\u4fee\u6539\u4f1a\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\uff0c\u8bbe\u4f4d\u7f6e $i$ \u7684\u989c\u8272\u4ece $a$ \u88ab\u4fee\u6539\u4e3a $b$\u3002\u4ece $a$ \u989c\u8272\u770b\uff0c\u8fd9\u4e2a\u70b9\u88ab\u5220\u9664\u4e86\uff0c\u968f\u4e4b\u5f71\u54cd\u4e86\u5b83\u53f3\u8fb9\u7684\u7b2c\u4e00\u4e2a\u989c\u8272\u4e3a $a$ \u7684\u70b9\u7684 $pre$ \u6539\u53d8\u4e86\u3002\u4ece $b$ \u989c\u8272\u770b\uff0c\u65b0\u589e\u4e86\u4e00\u4e2a\u70b9\uff0c\u968f\u4e4b\u5f71\u54cd\u7684\u4e5f\u662f\u5b83\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u989c\u8272\u4e3a $b$ \u7684\u70b9\u7684 $pre$\u3002\n\n\u5f00 $n$ \u4e2a ```set``` \u7ef4\u62a4\u6bcf\u4e00\u4e2a\u989c\u8272\u7684\u4f4d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u67e5\u8be2\u4e0e\u4fee\u6539\u4e0b\u6807 $i$ \u7684\u524d\u9a71\u540e\u7ee7\u3002\u6570\u70b9\u7528 KDTree \u7ef4\u62a4\u5373\u53ef\u3002\n\n\u8fd8\u8865\u5145\u4e00\u4e2a\u7b80\u5355\u5c0f Trick\uff0cKDTree \u5199\u5220\u9664\u7684\u786e\u6709\u4e9b\u70e6\u4eba\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u8981\u67e5\u8be2\u7684\u662f\u70b9\u6743\u548c\uff0c\u56e0\u6b64\u4e0d\u59a8\u76f4\u63a5\u5728\u539f\u4f4d\u7f6e\u4e0a\u52a0\u4e00\u4e2a\u70b9\uff0c\u6743\u503c\u4e3a\u539f\u6765\u7684\u76f8\u53cd\u6570\u5c31\u884c\u4e86\uff1b\u4fee\u6539\u4e00\u4e2a\u70b9\u6743\u7b49\u4ef7\u4e8e\u5220\u9664\u8fd9\u4e2a\u70b9\u518d\u52a0\u4e00\u4e2a\u70b9\u3002\u5982\u679c\u6015\u52a0\u5165\u7684\u70b9\u8fc7\u591a\u5bfc\u81f4\u7206\u70b8\uff0c\u5c31\u5199\u4e00\u4e2a\u7279\u5224\uff0c\u5982\u679c\u4e24\u4e2a\u70b9\u4f4d\u7f6e\u76f8\u540c\u5c31\u5408\u5e76\u6743\u503c\u3002\n\n## \u4ee3\u7801\n\nKDT \u672c\u6765\u5c31\u591f\u5361\u4e86\uff0c```#define int long long``` \u4f1a T \u98de\uff0c\u6ce8\u610f\u4e00\u4e0b\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int max_n=600005; // \u975e\u5e38\u4fdd\u5b88\u7684\u6570\u7ec4\u5927\u5c0f\ninline int read(){\n    int x=0;bool w=0;char c=getchar();\n    while(c<'0' || c>'9') w|=c=='-',c=getchar();\n    while(c>='0' && c<='9') x=(x<<1)+(x<<3)+(c^48),c=getchar();\n    return w?-x:x;\n}\ninline void write(ll x){\n    if(x<0) putchar('-'),x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10^48);\n}\ninline bool interv(int mid,int l,int r){ // \u5224\u65ad mid \u5728\u4e0d\u5728 [l,r] \u5185\n    if(l<=mid && mid<=r) return 1;\n    return 0;\n}\n\nint n,m,a[max_n],pre[max_n],nxt[max_n];\n\n// ---------------KDT\u677f\u5b50---------------\n\nstruct point{\n    int x,y,val;\n    point(){x=y=val=0;}\n    bool operator == (const point &b) const{\n        point a=*this;\n        return (a.x==b.x && a.y==b.y);\n    }\n}pos[max_n];\ninline point makep(int a,int b,int c){ // make point\n    point res;\n    res.x=a,res.y=b,res.val=c;\n    return res;\n}\nbool cmpt=0;\ninline bool cmp(point i,point j){\n    if(cmpt) return i.x<j.x;\n    return i.y<j.y;\n}\nint fre[max_n],tp;\nstruct KD_Tree{\n    const double alpha=0.75;\n    int root,tot,tmp;\n    bool chgr;\n    KD_Tree(){root=tot=tmp=0;}\n    inline int newnode(){\n        int x;\n        if(tp) x=fre[tp--];\n        else x=++tot;\n        return x;\n    }\n    struct dot{\n        point x,l,r;\n        int tp,sz,ls,rs;ll sm;\n        dot(){tp=sz=ls=rs=sm=0;}\n    }a[max_n];\n    #define ls(x) (a[x].ls)\n    #define rs(x) (a[x].rs)\n    inline void pushup(int x){\n        a[x].l=a[x].r=a[x].x,a[x].sm=a[x].x.val;\n        a[x].sz=a[ls(x)].sz+a[rs(x)].sz+1;\n        if(ls(x)){\n            a[x].sm+=a[ls(x)].sm;\n            a[x].l.x=min(a[x].l.x,a[ls(x)].l.x),a[x].r.x=max(a[x].r.x,a[ls(x)].r.x);\n            a[x].l.y=min(a[x].l.y,a[ls(x)].l.y),a[x].r.y=max(a[x].r.y,a[ls(x)].r.y);\n        }\n        if(rs(x)){\n            a[x].sm+=a[rs(x)].sm;\n            a[x].l.x=min(a[x].l.x,a[rs(x)].l.x),a[x].r.x=max(a[x].r.x,a[rs(x)].r.x);\n            a[x].l.y=min(a[x].l.y,a[rs(x)].l.y),a[x].r.y=max(a[x].r.y,a[rs(x)].r.y);\n        }\n    }\n    inline int build(int l,int r,int t){\n        int x=newnode(),mid=(l+r)>>1;\n        cmpt=t;\n        nth_element(pos+l,pos+mid,pos+r+1,cmp);\n        a[x].tp=t,a[x].x=pos[mid],ls(x)=rs(x)=0;\n        if(l<=mid-1) ls(x)=build(l,mid-1,t^1);\n        if(r>=mid+1) rs(x)=build(mid+1,r,t^1);\n        pushup(x);\n        return x;\n    }\n    inline void get(int x){\n        if(ls(x)) get(ls(x));\n        pos[++tmp]=a[x].x,fre[++tp]=x;\n        if(x==root) chgr=1;\n        if(rs(x)) get(rs(x));\n    }\n    inline void rebuild(int &x){\n        if(alpha*a[x].sz>max(a[ls(x)].sz,a[rs(x)].sz)) return;\n        tmp=0,chgr=0;\n        get(x),x=build(1,tmp,0);\n        if(chgr) root=x;\n    }\n    inline void insert(int &x,point pt,int t){\n        if(!x){\n            x=newnode();\n            a[x].sz=1,a[x].x=pt,a[x].tp=t;\n            pushup(x);\n            return;\n        }\n        if(pt==a[x].x){ // \u5c0f Trick\n            a[x].x.val+=pt.val;\n            pushup(x);\n            return;\n        }\n        cmpt=t;\n        if(cmp(pt,a[x].x)) insert(ls(x),pt,t^1);\n        else insert(rs(x),pt,t^1);\n        pushup(x),rebuild(x);\n    }\n    inline ll ask(int x,point i,point j){\n        if(!x || a[x].l.x>j.x || a[x].r.x<i.x || a[x].l.y>j.y || a[x].r.y<i.y) return 0;\n        if(a[x].l.x>=i.x && a[x].r.x<=j.x && a[x].l.y>=i.y && a[x].r.y<=j.y)\n            return a[x].sm;\n        ll res=0;\n        if(interv(a[x].x.x,i.x,j.x) && interv(a[x].x.y,i.y,j.y)) res+=a[x].x.val;\n        res+=ask(ls(x),i,j)+ask(rs(x),i,j);\n        return res;\n    }\n}kdt;\n\n// ---------------KDT\u677f\u5b50\u7ed3\u675f---------------\n\nset<int> st[max_n];\ninline int Pre(int x,int col){ // \u67e5\u8be2\u524d\u9a71\n    auto it=st[col].lower_bound(x);\n    --it;\n    return *it;\n}\ninline int Nxt(int x,int col){ // \u67e5\u8be2\u540e\u7ee7\n    return *(st[col].upper_bound(x));\n}\n\nsigned main(){\n    n=read(),m=read();\n    for(register int i=1;i<=n;++i)\n        st[i].insert(0),st[i].insert(n+1);\n    for(register int i=1;i<=n;++i){\n        a[i]=read(),st[a[i]].insert(i);\n        pre[i]=Pre(i,a[i]);\n        kdt.insert(kdt.root,makep(i,pre[i],i-pre[i]),0);\n    }\n    for(register int i=1;i<=n;++i)\n        nxt[i]=Nxt(i,a[i]);\n    while(m--){\n        int op=read();\n        if(op==1){\n            int i=read(),val=read();\n            kdt.insert(kdt.root,makep(i,pre[i],pre[i]-i),0),\n            kdt.insert(kdt.root,makep(nxt[i],i,i-nxt[i]),0);\n            // \u5148\u628a\u539f\u989c\u8272\u7684\u7684\u70b9\u5220\u6389\n            st[a[i]].erase(i),st[val].insert(i);\n            pre[nxt[i]]=pre[i],nxt[pre[i]]=nxt[i];\n            // \u4fee\u6539\u539f\u989c\u8272\u7684\u524d\u9a71\u540e\u7ee7\u5173\u7cfb\n            kdt.insert(kdt.root,makep(nxt[i],pre[i],nxt[i]-pre[i]),0);\n            // \u4fee\u6539\u539f\u989c\u8272\u7684\u70b9\u6743\n            a[i]=val;\n            pre[i]=Pre(i,a[i]),nxt[i]=Nxt(i,a[i]);\n            // \u66f4\u65b0\u8fd9\u4e2a\u70b9\u524d\u9a71\u540e\u7ee7\u5173\u7cfb\n            kdt.insert(kdt.root,makep(nxt[i],pre[nxt[i]],pre[nxt[i]]-nxt[i]),0);\n            nxt[pre[i]]=pre[nxt[i]]=i;\n            kdt.insert(kdt.root,makep(i,pre[i],i-pre[i]),0),\n            kdt.insert(kdt.root,makep(nxt[i],i,nxt[i]-i),0);\n            // \u66f4\u65b0\u65b0\u989c\u8272\u524d\u9a71\u540e\u7ee7\u5173\u7cfb\u548c\u6743\u503c\n        }\n        if(op==2){\n            int l=read(),r=read();\n            write(kdt.ask(kdt.root,makep(l,l,0),makep(r,r,0))),putchar('\\n');\n        }\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1641287667,
        "uid": 181776,
        "name": "_Arahc_",
        "ccfLevel": 7,
        "title": "CF848C \u9898\u89e3"
    },
    {
        "content": "\u6765\u4e00\u4e2a $O(n\\sqrt{n \\log n})$ \u7684\u5728\u7ebf\u505a\u6cd5\u3002\n\n\u5982\u679c\u8981\u6c42\u7684\u5e8f\u5217\u662f $a_1,a_2,\\cdots,a_m$\uff0c\u90a3\u4e48\u7b54\u6848\u4e3a $\\sum\\limits_{i=1}^n[pre_i\\ge 1](i-pre_i)$\uff0c\u8fd9\u91cc $pre_i$ \u8868\u793a\u6700\u5927\u7684\u4e0b\u6807 $k$ \u4f7f\u5f97 $k<i$ \u4e14 $a_i=a_k$\u3002\n\n\u653e\u5230\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u4e2d\uff0c\u6c42\u548c\u5f0f\u53d8\u4e3a $\\sum\\limits_{i=l}^r[pre_i\\ge l](i-pre_i)$\u3002\n\n\u89c2\u5bdf\u5230\u6c42\u548c\u5f0f\u6709\u4e24\u4e2a\u9650\u5236\u6761\u4ef6 $pre_i\\ge l$ \u548c $i\\in [l,r]$\u3002\n\n\u8fd9\u4e0d\u5c31\u88f8\u7684\u6811\u5957\u6811\u5417\uff1f\n\n\u7136\u9e45\u4f60\u53d1\u73b0\u8fd9\u9898\u7a7a\u95f4 $\\text{256MB}$\uff0c\u6240\u6709\u6811\u5957\u6811\u90fd\u5bc4\u4e86\u3002\n\n\u6216\u8005\u53ef\u4ee5\u7528 $\\text{CDQ}$ \u5206\u6cbb\uff0c $\\text{KD-Tree}$ \uff0c\u6216\u8005\u7528\u4e00\u4e9b\u795e\u5947\u7684\u529e\u6cd5\u7a81\u7834\u7a7a\u95f4\u9650\u5236\u3002\n\n\u8fd9\u91cc\u76f4\u63a5\u65e0\u8111\u5206\u5757\uff0c\u6574\u5757\u5f00\u5bf9 $pre$ \u6570\u7ec4\u5f00\u7ebf\u6bb5\u6811\uff0c\u6563\u70b9\u76f4\u63a5\u66b4\u529b\u3002\n\n\u5982\u679c\u5757\u957f\u4e3a $B$ \uff0c\u90a3\u4e48\u5355\u6b21\u590d\u6742\u5ea6 $O(\\frac{n}{B}\\log n+B)$ , \u5f53 $B=\\sqrt{n \\log n}$ \u65f6\u590d\u6742\u5ea6\u8fbe\u5230\u6700\u4f18\u3002\n\n\u6240\u4ee5\u590d\u6742\u5ea6 $O(n \\sqrt{n \\log n})$\uff0c\u53ef\u4ee5\u5728 $\\text{1s}$ \u5185\u5b8c\u6210\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int NR=1e5+10;\nconst int MR=2e3+10;\nint n,q,a[NR],pre[NR];\nint Block,from[NR],l[MR],r[MR],rt[MR];\nset<int>s[NR];\n\nint tot,ch[NR<<5][2],sum[NR<<5];\n#define mid ((l+r)>>1)\nvoid change(int &id,int l,int r,int pos,int k){\n\tif(!id)id=++tot;\n\tsum[id]+=k;\n\tif(l==r)return;\n\tif(pos<=mid)change(ch[id][0],l,mid,pos,k);\n\telse change(ch[id][1],mid+1,r,pos,k);\n}\nint query(int id,int l,int r,int L,int R){\n\tif(!id)return 0;\n\tif(r<L||R<l)return 0;\n\tif(L<=l&&r<=R)return sum[id];\n\treturn query(ch[id][0],l,mid,L,R)+query(ch[id][1],mid+1,r,L,R);\n}\n\nvoid init(){\n\tBlock=max(1ll,(int)sqrt(n*log(n)/log(2)));\n\tfor(int i=1;i<=n;i++)from[i]=(i-1)/Block+1;\n\tfor(int i=1;i<=n;i++){\n\t\tif(from[i]!=from[i-1])l[from[i]]=i;\n\t\tif(from[i]!=from[i+1])r[from[i]]=i;\n\t\tif(pre[i])change(rt[from[i]],1,n,pre[i],i-pre[i]);\n\t}\n}\nvoid modify(int x,int y){\n\tset<int>::iterator it1=s[a[x]].upper_bound(x),it2;\n\tif(it1!=s[a[x]].end()){\n\t\tint k=*it1;\n\t\tchange(rt[from[k]],1,n,x,x-k);\n\t\tif(pre[x])change(rt[from[k]],1,n,pre[x],k-pre[x]);\n\t\tpre[k]=pre[x];\n\t}\n\ts[a[x]].erase(x);a[x]=y;\n\tif(pre[x])change(rt[from[x]],1,n,pre[x],pre[x]-x);\n\tit2=s[y].upper_bound(x);\n\tif(s[y].empty())pre[x]=0;\n\telse if(!s[y].empty()&&it2==s[y].begin()){\n\t\tint k=*it2;pre[k]=x;pre[x]=0;\n\t\tchange(rt[from[k]],1,n,x,k-x);\n\t}\n\telse{\n\t\tit1=it2;it1--;\n\t\tint k1=*it1;pre[x]=k1;\n\t\tchange(rt[from[x]],1,n,k1,x-k1);\n\t\tif(it2!=s[y].end()){\n\t\t\tint k2=*it2;pre[k2]=x;\n\t\t\tchange(rt[from[k2]],1,n,k1,k1-k2);\n\t\t\tchange(rt[from[k2]],1,n,x,k2-x);\n\t\t}\n\t}\n\ts[y].insert(x);\n}\nint calc(int L,int R){\n\tint res=0;\n\tif(from[L]==from[R]){\n\t\tfor(int i=L;i<=R;i++)\n\t\t\tif(pre[i]>=L)res+=i-pre[i];\n\t\treturn res;\n\t}\n\tfor(int i=from[L]+1;i<from[R];i++)res+=query(rt[i],1,n,L,R);\n\tfor(int i=L;i<=r[from[L]];i++)\n\t\tif(pre[i]>=L)res+=i-pre[i];\n\tfor(int i=l[from[R]];i<=R;i++)\n\t\tif(pre[i]>=L)res+=i-pre[i];\n\treturn res;\n}\n\nsigned main(){\n\tcin>>n>>q;\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld\",&a[i]);\n\t\tif(!s[a[i]].empty()){\n\t\t\tset<int>::iterator it=s[a[i]].end();\n\t\t\tpre[i]=*(--it);\n\t\t}\n\t\ts[a[i]].insert(i);\n\t}\n\tinit();\n\twhile(q--){\n\t\tint opt,x,y;scanf(\"%lld%lld%lld\",&opt,&x,&y);\n\t\tif(opt==1)modify(x,y);\n\t\telse printf(\"%lld\\n\",calc(x,y));\n\t}\n\treturn 0;\n} \n```",
        "postTime": 1656163536,
        "uid": 117771,
        "name": "intel_core",
        "ccfLevel": 7,
        "title": "CF848C \u9898\u89e3"
    },
    {
        "content": "\u4e00\u9053\u4e0d\u9519\u7684 $cdq$ \u5206\u6cbb\u7ec3\u624b\u9898\u3002\n\n\u9898\u76ee\u6c42\u7684\u662f\u5728\u7ed9\u5b9a\u533a\u95f4\u5185\uff0c\u6bcf\u79cd\u6570\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u4f4d\u7f6e\u7684\u4e0b\u6807\u51cf\u53bb\u7b2c\u4e00\u6b21\u51fa\u73b0\u4f4d\u7f6e\u7684\u4e0b\u6807\u7684\u503c\u7684\u548c\u3002\n\n\u8fd9\u91cc\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5927\u533a\u95f4\uff08\u7b2c\u4e00\u6b21\u5230\u6700\u540e\u4e00\u6b21\uff09\u8f6c\u5316\u4e3a\u4e00\u4e2a\u4e00\u4e2a\u7684\u5c0f\u533a\u95f4\uff08\u6bcf\u4e2a\u6570\u548c\u5b83\u7684\u524d\u9a71\uff09\uff0c\u5373\u4e3a $\\sum\\limits_{i=1}^Ri-pre(L\\le pre)$\u3002\n\n\u5c06\u5b83\u8f6c\u5316\u4e3a\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u5bf9\u4e8e $i$ \u548c\u5b83\u7684\u524d\u9a71 $pre_i$\uff0c\u65f6\u95f4\u6233 $t_i$ \u82e5\u6ee1\u8db3\uff1a$(L\\le pre,i\\le R,t_i<t_j)$\uff0c\u5219\u5bf9\u7b54\u6848\u8d21\u732e\u4e3a $i-pre_i$\u3002\n\n\u4ee5\u8f93\u5165\u5148\u540e\uff0c\u4e3a\u5929\u7136\u7684\u65f6\u95f4\u987a\u5e8f\uff0c\u4e0d\u7528\u518d\u6392\u5e8f\uff0c\u6c42 $cdq$ \u8fc7\u7a0b\u4e0d\u518d\u8d58\u8ff0\uff0c\u7528\u597d $set$ \u53ef\u4ee5\u65b9\u4fbf\u5730\u52a8\u6001\u66f4\u65b0\u524d\u9a71\u3002\n\n\u4fee\u6539\u9700\u8981\u683c\u5916\u7ec6\u5fc3\uff0c\u539f\u6765\u7684\u6570\uff0c\u5220\u53bb\u4e24\u5c0f\u533a\u95f4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u5927\u7684\u533a\u95f4\uff0c\u800c\u65b0\u7684\u6570\uff0c\u52a0\u4e0a\u4e24\u5c0f\u533a\u95f4\uff0c\u5220\u53bb\u4e00\u4e2a\u5927\u7684\u533a\u95f4\uff0c\u5220\u53bb\u65f6\u548c\u4e4b\u524d\u52a0\u7684\u60c5\u51b5\u4e00\u6837\uff0c\u628a\u8d21\u732e\u503c\u6539\u6210\u8d1f\u7684\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5f00longlong\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e6+5;\ntypedef long long ll;\nstruct nod{\n\tint x,y,p;\n\tll v;\n\tint id;\n}q[N],w[N];\nint n,m,pre[N],d[N];\nll tr[N];\nset<int>p[N];\nbool cmp(nod a,nod b){\n\treturn a.id<b.id;\n}\nint lowbit(int x){\n\treturn x&-x;\n}\nvoid add(int x,int v){\n\tfor(int i=x;i<N;i+=lowbit(i)){\n\t\ttr[i]+=v;\n\t}\n}\nll query(int x){\n\tll res=0;\n\tfor(int i=x;i;i-=lowbit(i)){\n\t\tres+=tr[i];\n\t}\n\treturn res;\n}\nvoid merg_sort(int l,int r){\n\tif(l>=r)return ;\n\tint mid=(l+r)/2;\n\tmerg_sort(l,mid);\n\tmerg_sort(mid+1,r);\n\tint i=l,j=mid+1,k=1;\n\twhile(i<=mid&&j<=r){\n\t\tif(q[i].y>=q[j].y){\n\t\t\tif(q[i].p==1)add(q[i].x,q[i].v);\n\t\t\tw[k++]=q[i++];\n\t\t}\n\t\telse {\n\t\t\tif(q[j].p==2)q[j].v+=query(q[j].x);\n\t\t\tw[k++]=q[j++];\n\t\t}\n\t}\n\twhile(i<=mid){\n\t\tif(q[i].p==1)add(q[i].x,q[i].v);\n\t\tw[k++]=q[i++];\t\t\n\t}\n\twhile(j<=r){\n\t\tif(q[j].p==2)q[j].v+=query(q[j].x);\n\t\tw[k++]=q[j++];\t\t\n\t}\n\tfor(i=l;i<=mid;i++){\n\t\tif(q[i].p==1)add(q[i].x,-q[i].v);\n\t}\n\tfor(i=l,j=1;j<k;i++,j++){\n\t\tq[i]=w[j];\n\t}\n}\nint main(){\n\tint l=0;\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++){\n\t\tint j;\n\t\tscanf(\"%d\",&j);\n\t\td[i]=j;\n\t\tp[j].insert(i);\n\t\tset<int>::iterator k=p[j].find(i);\n\t\tif(k!=p[j].begin()){\n\t\t\tk--;\n\t\t\tq[++l]={i,*k,1,i-*k,l};\n\t\t}\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tint a,b,c;\n\t\tscanf(\"%d%d%d\",&a,&b,&c);\n\t\tif(a==1){\n\t\t\tif(d[b]==c)continue;\n\t\t\tint pre=0,let=0;\n\t\t\tset<int>::iterator k=p[d[b]].find(b);\n\t\t\tif(k!=p[d[b]].begin())k--,pre=*k;\n\t\t\tk++;\n\t\t\tif(pre)k++;\n\t\t\tif(k!=p[d[b]].end())let=*k;\n\t\t\tif(pre)q[++l]={b,pre,1,-b+pre,l};\n\t\t\tif(let)q[++l]={let,b,1,-let+b,l};\n\t\t\tif(pre&&let)q[++l]=\t{let,pre,1,let-pre,l};\t\n\t\t\tp[d[b]].erase(b);\n\t\t\tp[c].insert(b);\n\t\t\td[b]=c;\n\t\t\tk=p[c].find(b),pre=0,let=0;\t\t\n\t\t\tif(k!=p[c].begin())k--,pre=*k;\n\t\t\tk++;\n\t\t\tif(pre)k++;\n\t\t\tif(k!=p[c].end())let=*k;\n\t\t\tif(pre)q[++l]={b,pre,1,b-pre,l};\n\t\t\tif(let)q[++l]={let,b,1,let-b,l};\n\t\t\tif(pre&&let)q[++l]={let,pre,1,-let+pre,l};\t\t\t\t\t\t\t\n\t\t}\n\t\telse q[++l]={c,b,2,0,l};\n\t}\n\tmerg_sort(1,l);\n\tsort(q+1,q+l+1,cmp);\n\tfor(int i=1;i<=l;i++){\n\t\tif(q[i].p==2)printf(\"%lld\\n\",q[i].v);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1619079237,
        "uid": 277664,
        "name": "\u968f\u4fbfAK",
        "ccfLevel": 6,
        "title": "CF848C Goodbye Souvenir \u9898\u89e3"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u6811\u5957\u6811\u5361\u7a7a\u95f4\u7684\u505a\u6cd5\u3002\n\n\u6700\u5f00\u59cb\u662f\u60f3\u7528\u7c7b\u4f3c\u5dee\u5206\u7684\u65b9\u6cd5\u505a\u4f46\u662f\u840e\u6389\u4e86\u3002           \n\n\u8003\u8651\u4e00\u79cd\u5f88\u6b63\u5e38\u7684\u60f3\u6cd5\uff0c\u8fd8\u662f\u57fa\u4e8e\u5dee\u5206\uff0c\u6211\u4eec\u5bf9\u5e8f\u5217\u4e0a\u6bcf\u4e2a\u6570\u7528 $(pre_x , x)$\uff0c\u5176\u4e2d $pre_x$ \u8868\u793a\u7684\u662f\u5bf9\u4e8e\u5728 $x$ \u4e4b\u524d\u7684\u7b2c\u4e00\u4e2a $j$ \u4f7f\u5f97\u548c $a_x = a_j$\uff0c\u5e76\u5c06\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u7f6e\u4e3a $x - pre_x$\u3002             \n\n\u663e\u7136\u5bf9\u4e8e $pre_x$ \u53ef\u4ee5\u76f4\u63a5\u7528 set \u7ef4\u62a4\u3002\n\n\u73b0\u5728\u95ee\u9898\u8f6c\u5316\u6210\u4e86\u67e5\u8be2\u5c06 $l \\leq pre_x < x \\leq r$ \u7684\u70b9\u7684\u6743\u503c\u4e4b\u548c\uff0c\u7528\u6811\u5957\u6811\uff0ccdq \u5206\u6cbb\u7b49\u90fd\u53ef\u4ee5\u89e3\u51b3\u3002              \n\n\u82e5\u76f4\u63a5\u5f00 long long\uff0c\u4f1a MLE\uff0c\u6211\u5728\u5361\u4e86\u5f88\u4e45\u7a7a\u95f4\u540e\u7ec8\u7a76\u8fd8\u662f\u653e\u5f03\u4e86\u76f4\u63a5\u5361\u7a7a\u95f4\u5927\u5c0f\uff0c\u4f46\u540e\u6765\u4e0a\u7f51\u4e00\u67e5\uff0c\u53d1\u73b0\u8fd8\u6709 unsigned int \u8fd9\u79cd\u597d\u4e1c\u897f\uff0c\u53c8\u7531\u4e8e\u539f\u9898\u7684\u8fd0\u7b97\u6570\u5927\u5c0f\u90fd\u5728 $2.5 \\times 10 ^ 9$ \u4e4b\u5185\uff0c\u6240\u4ee5\u76f4\u63a5\u5f00 unsigned int \u540e\u628a\u7a7a\u95f4\u8c03\u5927\u70b9\u5c31\u597d\u4e86\u3002         \n\n\u65f6\u7a7a\u590d\u6742\u5ea6 $O(n \\log ^ 2 n)$\u3002\n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\nconst int Len = 1e5 + 5;\nint n,q,a[Len],pre[Len],v[Len],rt[Len << 2];\nset<int> st[Len];\nset<int>::iterator it;\nstruct Seg\n{\n\tunsigned int sum[Len * 178];int tot,lc[Len * 178],rc[Len * 178];\n\tvoid push_up(int x){sum[x] = sum[lc[x]] + sum[rc[x]];}\n\tvoid del(int &p,int l,int r,int idx)\n\t{\n\t\tif(!p) p = ++ tot;\n\t\tif(l == r){sum[p] = 0;return;}\n\t\tint mid = (l + r) >> 1;\n\t\tif(idx <= mid) del(lc[p] , l , mid , idx);\n\t\telse del(rc[p] , mid + 1 , r , idx);\n\t\tpush_up(p);\n\t}\n\tvoid update(int &p,int l,int r,int idx,int w)\n\t{\n\t\tif(!p) p = ++ tot;\n\t\tif(l == r){sum[p] = w;return;}\n\t\tint mid = (l + r) >> 1;\n\t\tif(idx <= mid) update(lc[p] , l , mid , idx , w);\n\t\telse update(rc[p] , mid + 1 , r , idx , w);\n\t\tpush_up(p); \n\t}\n\tunsigned int query(int &p,int l,int r,int nl,int nr)\n\t{\n\t\tif(!p) return 0;\n\t\tif(nl <= l && nr >= r) return sum[p];\n\t\tint mid = (l + r) >> 1;unsigned int res = 0;\n\t\tif(nl <= mid) res += query(lc[p] , l , mid , nl , nr);\n\t\tif(nr > mid) res += query(rc[p] , mid + 1 , r , nl , nr);\n\t\treturn res;\n\t}\n}S1;\n#define ls(p) p << 1\n#define rs(p) p << 1 | 1\nvoid del(int p,int l,int r,int idx,int y)\n{\n\tS1.del(rt[p] , 1 , n , y);\n\tif(l == r) return;\n\tint mid = (l + r) >> 1;\n\tif(idx <= mid) del(ls(p) , l , mid , idx , y);\n\telse del(rs(p) , mid + 1 , r , idx , y);\n}\nvoid update(int p,int l,int r,int idx,int y,int w)\n{\n\tS1.update(rt[p] , 1 , n , y , w);\n\tif(l == r) return;\n\tint mid = (l + r) >> 1;\n\tif(idx <= mid) update(ls(p) , l , mid , idx , y , w);\n\telse update(rs(p) , mid + 1 , r , idx , y , w);\n}\nunsigned int query(int p,int l,int r,int nl,int nr,int L,int R)\n{\n\tif(nl <= l && nr >= r) return S1.query(rt[p] , 1 , n , L , R);\n\tint mid = (l + r) >> 1;unsigned int res = 0;\n\tif(nl <= mid) res += query(ls(p) , l , mid , nl , nr , L , R);\n\tif(nr > mid) res += query(rs(p) , mid + 1 , r  , nl , nr , L , R);\n\treturn res;\n}\ninline int read() {\n    char ch = getchar();\n    int x = 0, f = 1;\n    while (ch < '0' || ch > '9') {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while ('0' <= ch && ch <= '9') {\n        x = x * 10 + ch - '0';\n        ch = getchar();\n    }\n    return x * f;\n}\ninline void write(unsigned int x) {\n    if (x > 9)\n        write(x / 10);\n    putchar(x % 10 + '0');\n}\nint main()\n{\n\tn = read() , q = read();\n\tfor(int i = 1 ; i <= n ; i ++) a[i] = read();\n\tfor(int i = 1 ; i <= n ; i ++)\n\t{\n\t\tst[a[i]].insert(i);\n\t\tit = st[a[i]].lower_bound(i);it --;\n\t\tif(*it && *it < i) pre[i] = *it;\n\t}\n\tfor(int i = 1 ; i <= n ; i ++) if(pre[i]) update(1 , 1 , n , pre[i] , i , v[i] = i - pre[i]);\n\tfor(int i = 1 ; i <= q ; i ++) \n\t{\n\t\tint A,B,C;A = read() , B = read() , C = read();\n\t\tif(A == 1) \n\t\t{\n\t\t\tit = st[a[B]].upper_bound(B);\n\t\t\t//printf(\"!!!%d %d\\n\",a[B],*it);\n\t\t\tif(B < *it) \n\t\t\t{\n\t\t\t\tint suf = *it , prre;\n\t\t\t\tit = st[a[B]].lower_bound(B);if(it != st[a[B]].begin()) it --;\n\t\t\t\tif(*it >= B) prre = 0;\n\t\t\t\telse prre = *it;\n\t\t\t\tif(pre[suf]) del(1 , 1 , n , pre[suf] , suf);\n\t\t\t\tpre[suf] = prre;\n\t\t\t\tif(pre[suf]) update(1 , 1 , n , pre[suf] , suf , v[suf] = suf - pre[suf]);\n\t\t\t}\n\t\t\tif(pre[B]) del(1 , 1 , n , pre[B] , B);\n\t\t\tst[a[B]].erase(B);a[B] = C;st[a[B]].insert(B);\n\t\t\tit = st[a[B]].lower_bound(B);if(it != st[a[B]].begin()) it --;\n\t\t\tif(*it < B) \n\t\t\t{\n\t\t\t\t//printf(\"!!!%d %d %d\\n\",i,B,*it);\n\t\t\t\tpre[B] = *it;\n\t\t\t\tif(pre[B]) update(1 , 1 , n , pre[B] , B , v[B] = B - pre[B]);\n\t\t\t}\n\t\t\telse pre[B] = 0;\n\t\t\tit = st[a[B]].upper_bound(B);\n\t\t\tif(B < *it)\n\t\t\t{\n\t\t\t\tint suf = *it;\n\t\t\t\tif(pre[suf]) del(1 , 1 , n , pre[suf] , suf);\n\t\t\t\tpre[suf] = B;\n\t\t\t\tif(pre[suf]) update(1 , 1 , n , pre[suf] , suf , v[suf] = suf - pre[suf]);\n\t\t\t}\n \t\t}\n \t\telse \n\t\t{\n\t\t\twrite(query(1 , 1 , n , B , C , B , C));\n\t\t\tputchar('\\n');\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1644759347,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 848C - Goodbye Souvenir"
    },
    {
        "content": "\u8fd9\u91cc\u8bf4\u4e00\u4e2a\u6709\u70b9\u4e0d\u4e00\u6837\u7684\u65b9\u6cd5\u3002\n\n\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u7684\u524d\u9a71\u540e\u7ee7\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u5982\u679c\u4ed6\u7684\u524d\u9a71\u5728\u533a\u95f4\u5de6\u8fb9\u5c31\u6709\u8d1f\u7684\u8d21\u732e\uff0c\u540e\u7ee7\u5728\u53f3\u8fb9\u5c31\u6709\u6b63\u7684\u8d21\u732e\uff0c\u5426\u5219\u6ca1\u6709\u8d21\u732e\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u53ef\u4ee5\u62c6\u6210\u4e24\u4e2a\u5e26\u4fee\u4e8c\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u636e\u8bf4\u6811\u5957\u6811\u4f1a MLE\uff1f\u90a3\u5c31\u8dd1\u4e24\u904d cdq \u5c31\u884c\u4e86\u3002\n```cpp\n#include<set>\n#include<vector>\n#include<cctype>\n#include<cstdio>\nusing namespace std;\ninline int readint(){\n    int x=0;\n    bool f=0;\n    char c=getchar();\n    while(!isdigit(c)&&c!='-') c=getchar();\n    if(c=='-'){\n        f=1;\n        c=getchar();\n    }\n\twhile(isdigit(c)){\n        x=x*10+c-'0';\n        c=getchar();\n    }\n    return f?-x:x;\n}\nconst int maxn=1e5+5;\nint n,m,a[maxn];\nset<int> s[maxn];\ntypedef set<int>::iterator iter;\nint pre[maxn],suc[maxn];\nint get_pre(int x){\n\titer it=s[a[x]].lower_bound(x);\n\tif(it==s[a[x]].begin()) return 0;\n\telse return *(--it);\n}\nint get_suc(int x){\n\titer it=s[a[x]].upper_bound(x);\n\tif(it==s[a[x]].end()) return n+1;\n\telse return *it;\n}\nstruct point{\n\tint x,y,w,id;\n\tbool flag;\n\tpoint(int x,int y,int w,int id,bool flag)\n\t:x(x),y(y),w(w),id(id),flag(flag){}\n};\nvector<point> q1,q2;\nvoid modify(int x){\n\tq1.push_back(point(x,pre[x],x,-1,0));\n\tq1.push_back(point(x,pre[x]=get_pre(x),-x,-1,0));\n\tq2.push_back(point(n+1-x,n+1-suc[x],-x,-1,0));\n\tq2.push_back(point(n+1-x,n+1-(suc[x]=get_suc(x)),x,-1,0));\n}\ntypedef long long ll;\nll c[maxn];\ninline int lowbit(int x){\n\treturn x&-x;\n}\nvoid modify(int x,ll k){\n\twhile(x<=n+1){\n\t\tc[x]+=k;\n\t\tx+=lowbit(x);\n\t}\n}\nll query(int x){\n\tll s=0;\n\twhile(x>0){\n\t\ts+=c[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn s;\n}\nint ord[maxn*11];\nll ans[maxn];\nvoid solve(vector<point>& q,int l,int r){\n\tif(l==r){\n\t\tord[r]=r;\n\t\treturn;\n\t}\n\tint mid=l+(r-l)/2;\n\tsolve(q,l,mid);\n\tsolve(q,mid+1,r);\n\tint cur=l;\n\tvector<int> res;\n\tfor(int i=mid+1;i<=r;i++){\n\t\twhile(cur<=mid&&q[ord[cur]].x<=q[ord[i]].x){\n\t\t\tmodify(q[ord[cur]].y+1,q[ord[cur]].w);\n\t\t\tres.push_back(ord[cur]);\n\t\t\tcur++;\n\t\t}\n\t\tif(q[ord[i]].id>=0){\n\t\t\tll s=query(q[ord[i]].y+1);\n\t\t\tif(q[ord[i]].flag) ans[q[ord[i]].id]+=s;\n\t\t\telse ans[q[ord[i]].id]-=s;\n\t\t}\n\t\tres.push_back(ord[i]);\n\t}\n\tfor(int i=cur;i<=mid;i++) res.push_back(ord[i]);\n\tfor(int i=l;i<cur;i++) modify(q[ord[i]].y+1,-q[ord[i]].w);\n\tfor(int i=l;i<=r;i++) ord[i]=res[i-l];\n}\nint main(){\n    #ifdef LOCAL\n    freopen(\"in.txt\",\"r\",stdin);\n    freopen(\"out.txt\",\"w\",stdout);\n    #endif\n    n=readint();\n    m=readint();\n    for(int i=1;i<=n;i++) s[a[i]=readint()].insert(i);\n    for(int i=1;i<=n;i++){\n    \tq1.push_back(point(i,pre[i]=get_pre(i),-i,-1,0));\n    \tq2.push_back(point(n+1-i,n+1-(suc[i]=get_suc(i)),i,-1,0));\n\t}\n\tint cnt=0;\n\twhile(m--){\n\t\tint opt=readint();\n\t\tif(opt==1){\n\t\t\tint b,c;\n\t\t\tb=readint();\n\t\t\tc=readint();\n\t\t\ts[a[b]].erase(b);\n\t\t\ts[a[b]=c].insert(b);\n\t\t\tmodify(pre[b]);\n\t\t\tmodify(suc[b]);\n\t\t\tmodify(b);\n\t\t\tmodify(pre[b]);\n\t\t\tmodify(suc[b]);\n\t\t}\n\t\telse{\n\t\t\tint b,c;\n\t\t\tb=readint();\n\t\t\tc=readint();\n\t\t\tq1.push_back(point(c,b-1,0,cnt,1));\n\t\t\tq1.push_back(point(b-1,b-1,0,cnt,0));\n\t\t\tq2.push_back(point(n+1-b,n-c,0,cnt,1));\n\t\t\tq2.push_back(point(n-c,n-c,0,cnt,0));\n\t\t\tcnt++;\n\t\t}\n\t}\n\tsolve(q1,0,q1.size()-1);\n\tsolve(q2,0,q2.size()-1);\n\tfor(int i=0;i<cnt;i++) printf(\"%lld\\n\",ans[i]);\n    return 0;\n}\n```",
        "postTime": 1586789378,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF848C \u3010Goodbye Souvenir\u3011"
    },
    {
        "content": "\u5410\u4e86\uff0c\u6811\u5957\u6811\u4f1amle\n\n\u8fc7\u4e0d\u8fc7\u4e0d\u91cd\u8981\uff0c\u91cd\u8981\u7684\u662f\u505a\u6cd5\n\n\u9996\u5148\u8fd9\u79cd\u8ddf\u989c\u8272\u6709\u5173\u7684\u95ee\u9898\uff0c\u4f1a\u8003\u8651\u7ef4\u62a4\u4e2a\u524d\u9a71$pre_i$\u8868\u793a\u5728$i$\u524d\u9762\u7684\u4e0e$i$\u989c\u8272\u76f8\u540c\u7684\u6700\u8fd1\u7684**\u4f4d\u7f6e**\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4\u5185\u540c\u4e00\u79cd\u989c\u8272\uff0c\u6240\u6709\u5177\u6709\u8fd9\u4e2a\u989c\u8272\u7684\u4f4d\u7f6e$p_1,p_2, \\cdots,p_k$\n\n\u7b54\u6848\u662f\u6700\u540e\u4e00\u6b21\u548c\u7b2c\u4e00\u6b21\u7684\u4f4d\u7f6e\u5dee:$p_k-p_1$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0$p_k-p_1=p_2-p_1+p_3-p_2+p_4-p_3+\\cdots+p_k-p_{k-1}$\n\n\u4e5f\u662f\u8bf4\u4e00\u4e2a\u4f4d\u7f6e$i$\u7684\u8d21\u732e\u662f$i-pre_i$\n\n\u7136\u540e\u533a\u95f4\u6c42\u548c\u5373\u53ef\uff0c\u7531\u4e8e$pre_i<l$\u7684\u90e8\u5206\u662f\u67d0\u989c\u8272\u7b2c\u4e00\u6b21\u5728\u533a\u95f4\u5185\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u6ca1\u6709\u8d21\u732e\uff0c\u6240\u4ee5\u5199\u51fa\u504f\u5e8f\u7ec4\uff1a\n\n$$ans=\\sum i-pre_i\\ [pre_i\\geq l,\\ l\\leq i\\leq r]$$\n\n\u7136\u800c\u7531\u4e8e\u5982\u679c\u4e00\u4e2a$i<l$\uff0c\u7531\u4e8e$pre_i<i$\uff0c\u5b83\u4e5f\u4f1a\u6ee1\u8db3$pre_i<l$\uff0c\u4e0d\u4f1a\u88ab\u8ba1\u5165\u7b54\u6848\uff0c\u6240\u4ee5\u67e5\u8be2\u7684\u65f6\u5019\u53ea\u9700\u8981\u5dee\u4e00\u4e2a$[1,r]$\u524d\u7f00\u5c31\u597d\u4e86\n\n\u5e26\u4fee\u4e8c\u7ef4\u504f\u5e8f\u663e\u7136\u76f4\u63a5\u6811\u5957\u6811\u7ef4\u62a4\uff0c\u53ef\u60dcmle\u4e86\n\n\u5173\u4e8e\u5982\u4f55\u52a8\u6001\u7ef4\u62a4$pre$\n\n\u5bf9\u6bcf\u4e2a\u989c\u8272\u5f00\u4e00\u4e2a$set$\u8868\u793a\u5177\u6709\u8be5\u989c\u8272\u7684\u4f4d\u7f6e\n\n\u90a3\u4e48\u4e00\u4e2a$i$\u7684$pre_i$\u5c31\u662f\u5b83\u5728\u5176\u6240\u5728\u989c\u8272\u7684$set$\u7684\u524d\u4e00\u4e2a\u6570\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log^2n)$\n\n\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log n)$\n```cpp\n#include<set>\n#include<cstdio>\n#include<cstdlib>\nusing std::set;\ntypedef set<int>Set;\ntypedef long long ll;\ntemplate<class type>inline const void read(type &in)\n{\n\tin=0;char ch(getchar());\n\twhile (ch<48||ch>57)ch=getchar();\n\twhile (ch>47&&ch<58)in=(in<<3)+(in<<1)+(ch&15),ch=getchar();\n}\nconst int N(1e5+5);\nint n,m,pre[N],a[N],tmp[N];\nnamespace Treap\n{\n\tstruct tree\n\t{\n\t\tint key,val,sum,pro;\n\t\tstatic tree *null;\n\t\ttree *son[2];\n\t\tvoid *operator new(size_t size);\n\t\tvoid operator delete(void *ptr);\n\t\tinline tree(const int &key=0,const int &val=0):key(key),val(val),sum(val),pro(rand()){son[0]=son[1]=null;}\n\t\tinline const void pushup(){sum=son[0]->sum+val+son[1]->sum;}\n\t}*tree::null;\n\t#define null tree::null\n\tchar memory_pool[N*20*sizeof(tree)],*tail(memory_pool+sizeof memory_pool);\n\tvoid *recycle[N*20],**top(recycle);\n\tinline void *tree::operator new(size_t size){return top!=recycle?*--top:tail-=size;}\n\tinline void tree::operator delete(void *ptr){*top++=ptr;}\n\tinline const void init()\n\t{\n\t\tnull=new tree;\n\t\tnull->pro=0;\n\t\tnull->son[0]=null->son[1]=null;\n\t}\n\tinline const void rotate(tree *&fa,const bool &f)\n\t{\n\t\ttree *p(fa->son[f]);\n\t\tfa->son[f]=p->son[!f];\n\t\tp->son[!f]=fa;\n\t\tfa->pushup();(fa=p)->pushup();\n\t}\n\tinline const void insert(tree *&p,const int &key,const int &val)\n\t{\n\t\tif (p==null)return p=new tree(key,val),void();\n\t\tconst bool f(p->key<key);\n\t\tinsert(p->son[f],key,val);\n\t\tp->pushup();\n\t\tif (p->son[f]->pro<p->pro)rotate(p,f);\n\t}\n\tinline const void remove(tree *&p,const int &key)\n\t{\n\t\tif (p->key==key)\n\t\t{\n\t\t\tif (p->son[0]==null&&p->son[1]==null)\n\t\t\t{tree *q(p);p=null;delete q;}\n\t\t\tif (p->son[0]==null)return p=p->son[1],void();\n\t\t\tif (p->son[1]==null)return p=p->son[0],void();\n\t\t\tconst bool f(p->son[0]->pro>p->son[1]->pro);\n\t\t\trotate(p,f);remove(p,key);\n\t\t}\n\t\telse remove(p->son[p->key<key],key),p->pushup();\n\t}\n\tinline const ll query(tree *p,const int &key)\n\t{\n\t\tif (p==null)return 0;\n\t\tif (p->key==key)return p->son[1]->sum+p->val;\n\t\tif (key>p->key)return query(p->son[1],key);\n\t\treturn query(p->son[0],key)+p->son[1]->sum+p->val;\n\t}\n}\nnamespace Binary_Indexed_Tree\n{\n\tTreap::tree *root[N];\n\tinline const int lowbit(const int &x){return x&-x;}\n\tinline const void init()\n\t{\n\t\tfor (int i(1);i<=n;i++)root[i]=Treap::null;\n\t}\n\tinline const void insert(int k,const int &x,const int &y)\n\t{\n\t\tfor (;k<=n;k+=lowbit(k))Treap::insert(root[k],x,y);\n\t}\n\tinline const void remove(int k,const int &x)\n\t{\n\t\tfor (;k<=n;k+=lowbit(k))Treap::remove(root[k],x);\n\t}\n\tinline const ll query(int k,const int &x)\n\t{\n\t\tll sum(0ll);\n\t\tfor (;k;k-=lowbit(k))sum+=Treap::query(root[k],x);\n\t\treturn sum;\n\t}\n}using namespace Binary_Indexed_Tree;\nSet s[N];\ninline const void del(const int &c,const int &x)\n{\n\tSet::iterator it(s[c].find(x));\n\tconst int lst(*--it),nxt(*++++it);\n\tif (nxt<=n)\n\t{\n\t\tif (pre[nxt])remove(nxt,pre[nxt]);\n\t\tif (pre[nxt]=lst)insert(nxt,lst,nxt-lst);\n\t}\n\tif (pre[x])remove(x,pre[x]);\n\ts[c].erase(--it);\n}\ninline const void add(const int &c,const int &x)\n{\n\tSet::iterator it(s[c].insert(x).first);\n\tconst int lst(*--it),nxt(*++++it);\n\tif (nxt<=n)\n\t{\n\t\tif (pre[nxt])remove(nxt,pre[nxt]);\n\t\tpre[nxt]=x;insert(nxt,x,nxt-x);\n\t}\n\tif (lst)insert(x,lst,x-lst);\n}\nint main()\n{\n\tTreap::init();\n\tread(n);read(m);\n\tfor (int i(1);i<=n;i++)\n\t\tread(a[i]),\n\t\ts[i].insert(0),\n\t\ts[i].insert(n+1),\n\t\ts[a[i]].insert(i),\n\t\tpre[i]=tmp[a[i]],\n\t\ttmp[a[i]]=i;\n\tinit();\n\tfor (int i(1);i<=n;i++)if (pre[i])insert(i,pre[i],i-pre[i]);\n\tfor (int opt,x,y;m--;)\n\t\tif (read(opt),read(x),read(y),opt&1)del(a[x],x),add(a[x]=y,x);\n\t\telse printf(\"%lld\\n\",query(y,x));\n\treturn 0;\n}\n```",
        "postTime": 1582985796,
        "uid": 14374,
        "name": "zhengrunzhe",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF848C \u3010Goodbye Souvenir\u3011"
    }
]