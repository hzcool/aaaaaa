[
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e24\u4e2a $n\\times n$ \u7684\u77e9\u9635 $a,b$ \uff0c\u5206\u522b\u8868\u793a\u521d\u672b\u72b6\u6001\uff0c\u95ee\u662f\u5426\u80fd\u901a\u8fc7\u6709\u9650\u6b65\u6392\u5e8f\u64cd\u4f5c\uff0c\u4f7f\u5f97\u77e9\u9635\u4ece\u521d\u72b6\u6001\u53d8\u4e3a\u672b\u72b6\u6001\u3002\u5982\u679c\u6709\uff0c\u8f93\u51fa\u64cd\u4f5c\u5e8f\u5217\u3002\n\n\u4e00\u6b21\u6392\u5e8f\u64cd\u4f5c\u5b9a\u4e49\u4e3a\uff0c\u9009\u62e9\u4e00\u5217\uff0c\u5c06\u77e9\u9635\u7684\u6bcf\u4e00\u884c\u6309\u8fd9\u4e00\u5217\u7684\u503c\u4ece\u5c0f\u5230\u5927\u8fdb\u884c\u6392\u5e8f\uff0c\u5982\u679c\u4e24\u884c\u503c\u76f8\u540c\u5219\u4e0d\u6539\u53d8\u5b83\u4eec\u7684\u76f8\u5bf9\u987a\u5e8f\uff08\u5373\u7a33\u5b9a\u7684\u6392\u5e8f\uff09\u3002\n\n$1\\le a_{i,j},b_{i,j}\\le n\\le 1500$ \uff0c\u4f60\u8f93\u51fa\u7684\u64cd\u4f5c\u5e8f\u5217\u957f\u5ea6 $\\le 5000$\n\n## \u89e3\u9898\u601d\u8def\n\n\u4e00\u9053\u6709\u8da3\u7684\u601d\u7ef4\u9898\u3002\n\n\u9996\u5148\u5c06\u521d\u59cb\u72b6\u6001\u7684\u6bcf\u4e00\u884c\u4e0e\u672b\u72b6\u6001\u7684\u6bcf\u4e00\u884c\u8fdb\u884c\u5bf9\u5e94\u3002\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u7528\u54c8\u5e0c\u6765\u89e3\u51b3\u3002\u5982\u679c\u6709\u4e24\u884c\u76f8\u7b49\uff0c\u90a3\u4e48\u6309\u4ece\u5c0f\u5230\u5927\u987a\u5e8f\u5bf9\u5e94\u6bcf\u4e24\u884c\u3002\u56e0\u4e3a\u5728\u4efb\u610f\u64cd\u4f5c\u4e2d\uff0c\u8fd9\u4e24\u884c\u7684\u987a\u5e8f\u90fd\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\u3002\n\n\u5982\u679c\u8fd9\u4e00\u6b65\u4e0d\u80fd\u5bf9\u5e94\uff0c\u76f4\u63a5\u8f93\u51fa `-1` \u3002\u5982\u679c\u53ef\u4ee5\u5bf9\u5e94\uff0c\u5728\u672b\u72b6\u6001\u6dfb\u52a0\u65b0\u7684\u4e00\u5217\uff0c\u4e3a\u5bf9\u5e94\u7684\u7f16\u53f7\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u521d\u72b6\u6001\u8f6c\u5316\u4e3a\u4e00\u4e2a\u666e\u901a\u7684\u6392\u5e8f\u64cd\u4f5c\u3002\n\n\u8981\u4f7f\u5f97\u6700\u540e\u6210\u4e3a\u672b\u72b6\u6001\uff0c\u53ea\u9700\u6ee1\u8db3 **\u4efb\u610f\u76f8\u90bb\u4e24\u884c\u4fdd\u6301\u5b83\u4eec\u5728\u672b\u72b6\u6001\u7684\u524d\u540e\u987a\u5e8f** \u3002\u8003\u5bdf\u5bf9\u67d0\u4e00\u5217\u7684\u6392\u5e8f\u64cd\u4f5c\u5bf9\u672b\u72b6\u6001\u76f8\u90bb\u4e24\u884c\u7684\u5f71\u54cd\uff0c\u6709\u201c\u4e0e\u76ee\u6807\u987a\u5e8f\u76f8\u53cd\u201d\u201c\u4e0e\u76ee\u6807\u987a\u5e8f\u76f8\u540c\u201d\u548c\u201c\u6ca1\u6709\u5f71\u54cd\u201d\u4e09\u79cd\u60c5\u51b5\uff0c\u5206\u522b\u5bf9\u5e94\u7740\u4e24\u884c\u8fd9\u4e00\u5217\u4e0a\u7684\u503c\u4e4b\u95f4\u5927\u4e8e\u3001\u5c0f\u4e8e\u548c\u7b49\u4e8e\u7684\u4e09\u79cd\u5173\u7cfb\u3002\n\n\u8981\u6c42\u76f8\u90bb\u4e24\u884c\u4fdd\u6301\u5b83\u4eec\u5728\u672b\u72b6\u6001\u7684\u524d\u540e\u987a\u5e8f\uff0c\u53ea\u9700\u64cd\u4f5c\u5e8f\u5217\u4e2d **\u6700\u540e\u4e00\u4e2a\u5bf9\u5b83\u4eec\u6709\u5f71\u54cd\u7684\u64cd\u4f5c** \u5c5e\u4e8e\u201c\u4e0e\u76ee\u6807\u987a\u5e8f\u76f8\u540c\u201d\u7c7b\u578b\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5012\u7740\u8003\u8651\u64cd\u4f5c\u5e8f\u5217\u3002\u5bf9\u4e8e\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5982\u679c\u5b83\u4f1a\u5bfc\u81f4\u67d0\u4e00\u884c\u5728\u8fd9\u6b21\u64cd\u4f5c\u4e4b\u540e\u201c\u4e0e\u76ee\u6807\u987a\u5e8f\u76f8\u53cd\u201d\uff0c\u5c31\u4e0d\u80fd\u4f7f\u7528\u8be5\u64cd\u4f5c\u3002\u4f46\u5982\u679c\u64cd\u4f5c\u5e8f\u5217\u7684\u540e\u9762\u6709\u201c\u4e0e\u76ee\u6807\u987a\u5e8f\u76f8\u540c\u201d\u7684\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u89e3\u9664\u8fd9\u4e00\u5bf9\u76f8\u90bb\u884c\u5bf9\u8fd9\u4e00\u5217\u8fdb\u884c\u6392\u5e8f\u64cd\u4f5c\u7684\u9650\u5236\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u62d3\u6251\u6392\u5e8f\u7684\u4e1c\u897f\uff0c\u5c06\u76f8\u90bb\u4e24\u884c\u548c\u6bcf\u4e00\u5217\u7684\u64cd\u4f5c\u90fd\u5bf9\u5e94\u6210\u4e00\u4e2a\u70b9\uff0c\u6709\u64cd\u4f5c\u4f7f\u884c\u6ee1\u8db3\u76ee\u6807\u987a\u5e8f\uff0c\u5219\u64cd\u4f5c\u5411\u884c\u8fde\u8fb9\uff1b\u6709\u64cd\u4f5c\u4f7f\u884c\u4e0d\u6ee1\u8db3\u76ee\u6807\u987a\u5e8f\uff0c\u5219\u884c\u5411\u64cd\u4f5c\u8fde\u8fb9\u3002\u5f53\u4e00\u4e2a\u64cd\u4f5c\u6ca1\u6709\u5165\u5ea6\u65f6\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528\uff1b\u5f53\u884c\u5165\u5ea6\u51cf\u5c11 $1$ \u65f6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u3002\u6700\u540e\u770b\u80fd\u5426\u4f7f\u7528\u521d\u59cb\u72b6\u6001\u5bf9\u5e94\u5217\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$ \uff08\u54c8\u5e0c\uff09\uff0c $O(n^2\\log n)$ \uff08`map`\uff09\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n^2)$ \u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#include<vector>\n#include<map>\nusing namespace std;\nconst int maxn=1510;\nint n,m,a[maxn][maxn],b[maxn][maxn],cnt,crr[maxn],cur,h[maxn*2],nxt[maxn*maxn],p[maxn*maxn],deg[maxn*2];\nbool tf[maxn*2];\nqueue<int>q;\nvector<int>ans,g[maxn];\nstruct node{int a[maxn];bool operator<(node x)const{for(int i=1;i<=m;i++)if(a[i]!=x.a[i])return a[i]<x.a[i];return false;}};\nmap<node,int>mp;\nvoid add_edge(int x,int y)\n{\n\t//printf(\"ad %d %d\\n\",x,y);\n\tcur++;\n\tnxt[cur]=h[x];\n\th[x]=cur;\n\tp[cur]=y;\n}\nsigned main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)scanf(\"%d\",a[i]+j);\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)scanf(\"%d\",b[i]+j);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\ta[i][m+1]=i;\n\t\tnode x;\n\t\tfor(int j=1;j<=m;j++)x.a[j]=a[i][j];\n\t\tif(mp[x])g[mp[x]].push_back(i);\n\t\telse mp[x]=++cnt,g[cnt].push_back(i);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tnode x;\n\t\tfor(int j=1;j<=m;j++)x.a[j]=b[i][j];\n\t\tif(!mp[x]){printf(\"-1\\n\");return 0;}\n\t\telse\n\t\t{\n\t\t\tif(crr[mp[x]]==g[mp[x]].size()){printf(\"-1\\n\");return 0;}\n\t\t\tb[i][m+1]=g[mp[x]][crr[mp[x]]];crr[mp[x]]++;\n\t\t}\n\t}\n\tfor(int i=1;i<n;i++)//i,i+1\n\t{\n\t\tfor(int j=1;j<=m+1;j++)\n\t\t{\n\t\t\tif(b[i][j]>b[i+1][j])add_edge(m+1+i,j),deg[j]++;\n\t\t\telse if(b[i][j]<b[i+1][j])add_edge(j,m+1+i),deg[m+1+i]++;\n\t\t}\n\t}\n\tfor(int j=1;j<=m+1;j++)if(!deg[j])q.push(j),tf[j]=true;\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();q.pop();\n\t\tif(x<=m+1)\n\t\t{\n\t\t\tans.push_back(x);\n\t\t\tfor(int j=h[x];j;j=nxt[j])\n\t\t\t{\n\t\t\t\tif(!tf[p[j]])tf[p[j]]=true,q.push(p[j]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(int j=h[x];j;j=nxt[j])\n\t\t\t{\n\t\t\t\tdeg[p[j]]--;\n\t\t\t\tif(!deg[p[j]])tf[p[j]]=true,q.push(p[j]);\n\t\t\t}\n\t\t}\n\t\tif(tf[m+1])break;\n\t}\n\tif(!tf[m+1]){printf(\"-1\\n\");return 0;}\n\telse\n\t{\n\t\tprintf(\"%d\\n\",ans.size());\n\t\tfor(int i=ans.size()-1;i>=0;i--)printf(\"%d \",ans[i]);printf(\"\\n\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1615709087,
        "uid": 43486,
        "name": "hsfzLZH1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1500C \u3010Matrix Sorting\u3011"
    },
    {
        "content": "\u663e\u7136\u4e00\u5217\u81f3\u591a\u53ea\u4f1a\u88ab\u64cd\u4f5c\u4e00\u6b21\u3002\n\n\u89c2\u5bdf\u53d1\u73b0\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u5176\u5b9e\u662f\u57fa\u6570\u6392\u5e8f\u7684\u8fc7\u7a0b\u3002\u64cd\u4f5c $a_1,a_2,\\dots ,a_k$ \u5176\u5b9e\u662f\u5bf9\u6240\u6709\u884c\u6309\u7167\u5148\u6309 $a_k$ \u4ece\u5c0f\u5230\u5927\uff0c$a_k$ \u76f8\u540c\u7684\u6309 $a_{k-1}$ \u4ece\u5c0f\u5230\u5927\uff0c\u2026\u2026\uff0c\u6700\u540e\u518d\u6309\u8f93\u5165\u987a\u5e8f\u4ece\u5c0f\u5230\u5927\uff0c\u6392\u5e8f\u7684\u8fc7\u7a0b\u3002\n\n\u6709\u4e0a\u8ff0\u89c2\u5bdf\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u540e\u5f80\u524d\u786e\u5b9a\u6240\u6709\u64cd\u4f5c\u3002\u5148\u5728 $B$ \u4e2d\u4efb\u610f\u627e\u5230\u4e00\u5217\u9012\u589e\u7684\u4f5c\u4e3a $a_k$\uff0c\u518d\u4efb\u610f\u627e\u4e00\u5217\u6ee1\u8db3\u201c\u6240\u6709\u7b2c $a_k$ \u5217\u76f8\u540c\u7684\u6bb5\u201d\u5185\u90e8\u90fd\u9012\u589e\u7684\u4f5c\u4e3a $a_{k-1}$\uff0c\u518d\u4efb\u610f\u627e\u4e00\u5217\u6ee1\u8db3\u201c\u6240\u6709\u7b2c $a_k$ \u5217\u548c\u7b2c $a_{k-1}$ \u5217\u76f8\u540c\u7684\u6bb5\u201d\u5185\u90e8\u90fd\u9012\u589e\u7684\u4f5c\u4e3a $a_{k-2}$\uff0c\u2026\u2026\u5047\u5982\u627e\u4e0d\u5230\u4e0b\u4e00\u5217\u4e86\uff0c\u5c31\u8bf4\u660e\u5269\u4e0b\u7684\u201c\u7b2c $a_1,a_2,\\dots ,a_k$ \u5217\u5747\u76f8\u540c\u201d\u7684\u8fde\u7eed\u6bb5\u5185\u90fd\u6ee1\u8db3\u5728 $A$ \u4e2d\u7f16\u53f7\u9012\u589e\uff0c\u626b\u4e00\u904d\u5224\u65ad\u5373\u53ef\u3002\n\n\u76f4\u63a5\u66b4\u529b\u627e\u4e0b\u4e00\u5217\u662f $O(n^3)$ \u7684\u4e0d\u53ef\u53d6\u3002\u6ce8\u610f\u5230\u4e00\u4e2a\u76f8\u540c\u7684\u6bb5\u5185\u67d0\u4e00\u5217\u9012\u589e\uff0c\u76f8\u5f53\u4e8e\u6bb5\u5185\u9664\u4e86\u5f00\u5934\u5916\u90fd\u6ee1\u8db3 $b_{i,k}\\ge b_{i-1,k}$\u3002\u628a\u6bcf\u884c\u4e2d $b_{i,k}\\ge b_{i-1,k}$ \u7684\u5217 $k$ \u5b58\u8fdb bitset \u91cc\u9762\uff0c\u6bcf\u6b21\u53d6\u51fa\u6240\u6709\u4e0d\u5728\u6bb5\u5f00\u5934\u7684\u884c\uff0c\u5c06\u5176 bitset \u4e0e\u8d77\u6765\u5c31\u80fd\u627e\u5230\u5408\u6cd5\u4e0b\u4e00\u5217\u7684\u96c6\u5408\u3002\u8fd9\u6837\uff0c\u590d\u6742\u5ea6\u53d8\u4e3a $O(\\dfrac{n^3}{w})$\uff0c\u65e0\u538b\u529b\u901a\u8fc7\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int base1=233,base2=2011,mod1=1e9+7,mod2=1e9+9;\nvector<int> a[1505],b[1505];\nint n,m,K,id[1505],hsh1[1505],hsh2[1505],ans[1505],lst[1505][1505],cur1[1505],cur2[1505],used[1505];\nbitset<1505> can[1505];\nmap<pair<int,int>,vector<int> > mp;\nbool cmp(const vector<int> &a,const vector<int> &b) {\n\treturn a[K]<b[K];\n}\nvoid Sort(int x) {\n\tK=x,stable_sort(a+1,a+n+1,cmp);\n}\nint main() {\n\tsrand(time(0));\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1; i<=n; i++) {\n\t\ta[i].resize(m);\n\t\tfor(int j=0; j<m; j++)scanf(\"%d\",&a[i][j]),hsh1[i]=(1ll*hsh1[i]*base1+a[i][j])%mod1,hsh2[i]=(1ll*hsh2[i]*base2+a[i][j])%mod2;\n\t\tmp[make_pair(hsh1[i],hsh2[i])].push_back(i);\n\t}\n\tfor(int i=1; i<=n; i++) {\n\t\tb[i].resize(m);\n\t\tfor(int j=0; j<m; j++)scanf(\"%d\",&b[i][j]);\n\t}\n\tfor(int j=0; j<m; j++) {\n\t\tfor(int i=2; i<=n; i++)if(b[i][j]>=b[i-1][j])can[i][j]=1;\n\t}\n\tfor(int i=n; i>=1; i--) {\n\t\tint h1=0,h2=0;\n\t\tfor(int j=0; j<m; j++)h1=(1ll*h1*base1+b[i][j])%mod1,h2=(1ll*h2*base2+b[i][j])%mod2;\n\t\tif(!mp[make_pair(h1,h2)].size())return puts(\"-1\"),0;\n\t\tid[i]=mp[make_pair(h1,h2)].back();\n\t\tmp[make_pair(h1,h2)].pop_back();\n\t}\n\twhile(1) {\n\t\tbitset<1505> tmp;\n\t\tfor(int i=0; i<m; i++)if(!used[i])tmp[i]=1;\n\t\tfor(int i=1; i<=n; i++) {\n\t\t\tif(i==1||cur1[i]!=cur1[i-1]||cur2[i]!=cur2[i-1])continue;\n\t\t\ttmp&=can[i];\n\t\t}\n\t\tif(!tmp.count())break;\n\t\tint pos=0;\n\t\tfor(int i=0; i<m; i++)if(tmp[i]) {\n\t\t\t\tpos=i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tused[pos]=1,ans[++ans[0]]=pos;\n\t\tfor(int i=1; i<=n; i++)cur1[i]=(1ll*cur1[i]*base1+b[i][pos])%mod1,cur2[i]=(1ll*cur2[i]*base2+b[i][pos])%mod2; //,cout<<i<<' '<<cur1[i]<<' '<<cur2[i]<<'\\n';\n\t}\n\tfor(int i=ans[0]; i; i--)Sort(ans[i]);\n\tfor(int i=1; i<=n; i++)for(int j=0; j<m; j++)if(a[i][j]!=b[i][j])return puts(\"-1\"),0;\n\tcout<<ans[0]<<'\\n';\n\tfor(int i=ans[0]; i; i--)cout<<ans[i]+1<<' ';\n\treturn 0;\n}\n```\n",
        "postTime": 1615872912,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1500C\u3010Matrix Sorting\u3011"
    },
    {
        "content": "\u4e00\u79cd $O(\\frac{nm^2}{w})$ \u7684\u505a\u6cd5\u3002\n\n\u628a\u77e9\u9635\u770b\u6210 $n$ \u4e2a\u884c\u5411\u91cf\uff0c\u8003\u8651\u76f4\u63a5\u89c2\u5bdf\u64cd\u4f5c\u540e\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\u5168\u8fc7\u7a0b\u5176\u5b9e\u5c31\u662f\u5bf9\u884c\u5411\u91cf\u6392\u5e8f\u7684\u8fc7\u7a0b\uff0c\u8f93\u51fa\u7684\u5e8f\u5217\u5176\u5b9e\u662f\u6392\u5e8f\u5173\u952e\u5b57\u987a\u5e8f\u7684\u5012\u5e8f\uff0c\u800c\u521d\u59cb\u77e9\u9635\u5b9e\u9645\u4e0a\u662f\u6307\u5b9a\u4e86\u7b2c $m+1$ \u7ef4\u7684\u503c\u3002\u5728\u52a0\u5165\u8fd9\u4e00\u7ef4\u7684\u60c5\u51b5\u4e0b\uff0c\u6392\u5e8f\u7ed3\u679c\u662f\u552f\u4e00\u7684\u3002\n\n\u8003\u8651\u987a\u6b21\u9009\u53d6\u6392\u5e8f\u5173\u952e\u5b57\uff0c\u4e0d\u77db\u76fe\u7684\u9009\u53d6\u90fd\u662f\u53ef\u884c\u89e3\u3002\u5f53\u9009\u53d6\u7b2c $i$ \u4e2a\u5173\u952e\u5b57\u65f6\uff0c\u5982\u679c\u524d $i-1$ \u4e2a\u5173\u952e\u5b57\u4e0d\u80fd\u628a\u67d0\u4e24\u4e2a\u884c\u5411\u91cf $\\vec{m},\\vec{n}$ \u533a\u5206\u5f00\u800c\u5b9e\u9645\u4e0a $\\vec{m}$ \u5e94\u5f53\u6392\u5728 $\\vec{n}$ \u524d\u9762\uff0c\u5219\u7b2c $i$ \u4e2a\u5173\u952e\u5b57 $x$ \u5fc5\u987b\u6ee1\u8db3 $\\vec{m}_x\\le \\vec{n}_x$ \u624d\u80fd\u907f\u514d\u77db\u76fe\u3002\n\n\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u5224\u65ad\u662f\u5426\u5b58\u5728\u77db\u76fe\u4e86\u3002\u53ef\u4ee5\u7528\u4e00\u4e2a `bitset` \u8bb0\u5f55\u6709\u54ea\u4e9b\u76f8\u90bb\u4f4d\u7f6e\u4ecd\u7136\u6ca1\u6709\u88ab\u533a\u5206\uff0c\u518d\u7528 $m$ \u4e2a `bitset` \u8bb0\u5f55\u6bcf\u4e2a\u5173\u952e\u5b57\u7684\u6bcf\u4e00\u4f4d\u662f\u5426\u5b58\u5728\u548c\u4e0b\u4e00\u4f4d\u6210\u9006\u5e8f\u5bf9\uff0c\u5219\u4e0d\u77db\u76fe\u5f53\u4e14\u4ec5\u5f53\u4e24\u4e2a `bitset` \u65e0\u4ea4\u3002\u9009\u53d6\u540e\uff0c\u5c06\u65b0\u533a\u5206\u5f00\u7684\u4f4d\u7f6e\u4fee\u6539\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef unsigned int ui;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef double db;\ntypedef long double ldb;\nstd::mt19937 rnd(time(0));\ninline int sj(int n)\n{\n\tunsigned int x=rnd();\n\treturn x%n+1;\n}\n#define rand fst\ntemplate<typename typC> void read(register typC &x)\n{\n\tregister int c=getchar(),fh=1;\n\twhile ((c<48)||(c>57))\n\t{\n\t\tif (c=='-') {c=getchar();fh=-1;break;}\n\t\tc=getchar();\n\t}\n\tx=c^48;c=getchar();\n\twhile ((c>=48)&&(c<=57))\n\t{\n\t\tx=x*10+(c^48);\n\t\tc=getchar();\n\t}\n\tx*=fh;\n}\ntemplate<typename typC> void write(register typC x)\n{\n\tif (x<0) putchar('-'),x=-x;\n\tstatic int st[100];\n\tregister int tp=1;\n\tregister typC y;st[1]=x%10;x/=10;\n\twhile (x) y=x/10,st[++tp]=x-y*10,x=y;++tp;\n\twhile (--tp) putchar(st[tp]|48);\n}\ntemplate<typename typC> void write(register typC *a,register int num)\n{\n\tfor (register int i=1;i<=num;i++) write(a[i]),putchar(i==num?10:32);\n}\n#define space(x) write(x),putchar(32)\n#define enter(x) write(x),putchar(10)\nconst int N=1.5e3+20,p=383778817;\ninline void inc(register int &x,const int y)\n{\n\tif ((x+=y)>=p) x-=p;\n}\ninline void dec(register int &x,const int y)\n{\n\tif ((x-=y)<0) x+=p;\n}\ninline int ksm(register int x,register int y)\n{\n\tregister int r=1;\n\twhile (y)\n\t{\n\t\tif (y&1) r=(ll)r*x%p;\n\t\tx=(ll)x*x%p;\n\t\ty>>=1;\n\t}\n\treturn r;\n}\ntypedef pair<ull,int> pa;\null hs;\nbitset<N> nx[N],bs;\nint a[N][N],b[N][N],r[N][N],st[N];\nint T,n,m,c,i,j,k,x,y,z,ans,la,cnt,hh,tp;\nmap<pa,int> mp;\nvector<int> s[N];\nbool vis[N];\nint main()\n{\n\tread(n);read(m);++m;\n\tfor (i=1;i<=n;i++)\n\t{\n\t\tfor (j=1;j<m;j++) read(a[i][j]);a[i][m]=i;hs=hh=0;\n\t\tfor (j=1;j<m;j++) hs=hs*2357ull+a[i][j],hh=(hh*2357ll+a[i][j])%p;\n\t\tif (mp.find(pa(hs,hh))!=mp.end())\n\t\t{\n\t\t\ts[mp[pa(hs,hh)]].push_back(i);\n\t\t} else s[mp[pa(hs,hh)]=++cnt].push_back(i);\n\t}//printf(\"%d %d\\n\",cnt,s[1][0]);\n\tfor (i=1;i<=cnt;i++) reverse(s[i].begin(),s[i].end());\n\tfor (i=1;i<=n;i++)\n\t{\n\t\tfor (j=1;j<m;j++) read(b[i][j]);hs=hh=0;\n\t\tfor (j=1;j<m;j++) hs=hs*2357ull+b[i][j],hh=(hh*2357ll+b[i][j])%p;\n\t\tif (mp.find(pa(hs,hh))==mp.end())\n\t\t{\n\t\t\tputs(\"-1\");return 0;\n\t\t}\n\t\tla=mp[pa(hs,hh)];//printf(\"la=%d\\n\",la);\n\t\tif (!s[la].size()) return puts(\"-1\"),0;\n\t\tb[i][m]=s[la][s[la].size()-1];\n\t\ts[la].pop_back();\n\t}\n\t//printf(\"%d %d\\n\",b[1][m],b[2][m]);\n\tfor (j=1;j<=m;j++) for (i=n-1;i;i--) if (b[i][j]>b[i+1][j]) nx[j][i]=1;\n\t//bs.set();assert(!bs[0]);\n\tfor (i=1;i<n;i++) bs[i]=1;\n\tfor (i=1;i<=m;i++)\n\t{\n\t\tfor (j=1;j<=m;j++) if (!vis[j]&&(bs&nx[j]).count()==0)\n\t\t{\n\t\t\tst[++tp]=j;vis[j]=1;break;\n\t\t}\n\t\tif (j>m) return puts(\"-1\"),0;\n\t\tif (j==m) {--tp;break;}\n\t\tfor (k=1;k<n;k++) if (bs[k]&&b[k][j]<b[k+1][j]) bs[k]=0;\n\t\t//printf(\"%d\\n\",bs.count());\n\t\tif (bs.count()==0) break;\n\t}\n\tprintf(\"%d\\n\",tp);\n\twhile (tp) printf(\"%d \",st[tp--]);\n}\n\n```",
        "postTime": 1615642314,
        "uid": 29826,
        "name": "SSerxhs",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1500C \u3010Matrix Sorting\u3011"
    },
    {
        "content": "### \u601d\u8def\u5206\u6790 \n\n\u679a\u4e3e\u6700\u540e\u64cd\u4f5c\u7684\u90a3\u4e00\u5217 , \u8fd9\u4e00\u5217\u5fc5\u987b\u8981\u6709\u5e8f \u3002 \n\n\u8003\u8651\u8fd9\u4e00\u5217\u4e2d , \u76f8\u90bb\u5143\u7d20\u5982\u679c\u76f8\u7b49 , \u90a3\u4e48\u5728\u4e0a\u4e00\u6b21\u64cd\u4f5c\u7684\u5217\u4e2d , \u8fd9\u4e9b\u5143\u7d20\u5fc5\u987b\u540c\u6837\u8981\u662f\u4e0d\u964d\u7684 , \u4e5f\u5c31\u662f : \n\n\u82e5 $b_{p1,i}=b_{p1,i+1}=...=b_{p1,i+k}$ \u5219\u5fc5\u6709 $b_{p2,i}<=b_{p2,i+1}=...=b_{p2,i+k}$ \n\n( $p1$\u662f\u6700\u540e\u4e00\u6b21\u64cd\u4f5c\u7684\u5217 , $p2$\u662f\u524d\u4e00\u6b21\u64cd\u4f5c\u7684\u5217 \uff09\u3002 \n\n\u56e0\u4e3a\u6839\u636e\u6392\u5e8fstable\u6027\u8d28 \u8fd9\u4e9b\u5143\u7d20\u82e5\u4e0d\u6ee1\u8db3**\u5df2\u76f8\u5bf9\u6709\u5e8f** \u90a3\u4e48\u5728\u8fd9\u6b21\u64cd\u4f5c\u4e2d\u4e5f\u4e0d\u4f1a\u6ee1\u8db3\u8981\u6c42 \u3002\n\n\u7ee7\u7eed\u5012\u63a8 , \u8003\u8651\u64cd\u4f5cp2\u5e26\u6765\u7684\u5f71\u54cd \u3002 \n\n\u5982\u679c $b_{p2,i}<b_{p2,i+1}$ \u90a3\u4e48\u6211\u4eec\u5c31\u6d88\u53bbi\u548ci+1\u7684\u76f8\u5bf9\u5927\u5c0f\u8981\u6c42\u4e86 \u3002\n\n\u56e0\u4e3a\u5728\u4e4b\u524d\u7684\u82e5\u5e72\u64cd\u4f5c\u540e , \u64cd\u4f5cp2\u5373\u53ef\u6ee1\u8db3\u8981\u6c42 \u3002\n\n### \u590d\u6742\u5ea6\u4f18\u5316\n \n\u9996\u5148\u6211\u4eec\u53d1\u73b0\u4e0d\u9700\u8981\u679a\u4e3e\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u5217 , \u76f4\u63a5\u628an-1\u4e2a\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\u4e22\u8fdb\u53bb\u5c31\u597d\u4e86 \u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u5982\u679c\u6211\u4eec\u679a\u4e3e n \u8f6e \u5c31\u6709\u4e00\u4e2a\u4e09\u6b21\u65b9\u7684\u73a9\u610f \u3002\n\n\u6211\u4eec\u7ee7\u7eed\u4f18\u5316 , \u8003\u8651\u4e00\u4e2a\u5217\u4ec0\u4e48\u65f6\u5019\u80fd\u88ab\u64cd\u4f5c \u3002\n\n\u5f53\u8fd9\u4e2a\u5217\u4e2d\u6240\u6709 $b_{p,i}>b_{p,i+1}$ \u7684\u4f4d\u7f6e , \u5728\u4e4b\u524d\u7684\u64cd\u4f5c\u4e2d , \u90fd\u5df2\u7ecf\u88ab\u6d88\u53bb\u4e86 , \u90a3\u5c31\u53ef\u4ee5\u64cd\u4f5c\u4e86 \u3002\n\n\u6211\u4eec\u8bb0\u5f55\u4e00\u4e2anum : \u8868\u793a\u6bcf\u5217\u4e2d\u672a\u88ab\u6d88\u53bb\u7684\u8981\u6c42\u6570\u91cf \u3002\n\n\u8fd9\u6837\u7528\u4e00\u4e2a\u7c7bbfs\u7684\u7b97\u6cd5\u5c31\u53ef\u4ee5\u505a\u5230\u5e73\u65b9\u590d\u6742\u5ea6 \u3002\n\n### \u5177\u4f53\u5b9e\u73b0  \n\n\u6bcf\u6b21\u628a num\u4e3a\u96f6\u7684\u5217 \u53bb\u6d88\u9664\u5176\u4ed6\u5217\u7684 num \u3002 \n\n\u64cd\u4f5c\u540e\u628anum\u4e3a\u96f6\u7684\u5217\u52a0\u5165\u961f\u5217 , \u5012\u5e8f\u8f93\u51fa\u5373\u662f\u7b54\u6848 \u3002\n\n\u4f46\u662f\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u6700\u540e\u5e76\u4e0d\u9700\u8981\u628a$n-1$\u4e2a\u5927\u5c0f\u5173\u7cfb\u5168\u90e8\u6d88\u53bb \u5982\u679c$A$\u5df2\u7ecf\u6ee1\u8db3\u4e86\u8fd9\u4e9b\u6761\u4ef6\u4e5f\u662f\u53ef\u4ee5\u7684 \u3002 \n\n### \u95f2\u8bdd\n\n~~\u4e4b\u540e\u5b98\u65b9\u9898\u89e3\u5c31\u4e22\u4e00\u53e5\u6700\u540e\u68c0\u67e5\u4e00\u4e0b\u5373\u53ef~~ \n\n\u4e4b\u540e\u6211\u4e0d\u4f1a\u5e73\u65b9\u7684\u5de7\u5999\u68c0\u67e5 \u4e4b\u540e log\u6392\u5e8f ~~\u61a8\u6279\u77f3\u9524~~ ~~xmr\u7528\u7684\u57fa\u6570\u6392\u5e8f\u624d\u53bb\u6389log~~ \n\n\u6240\u4ee5\u8fd9\u4e2a\u61a8\u6279\u5199\u7684\u73a9\u610f\u5e26\u4e86\u4e00\u4e2alog \u3002 \n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h> \n#define rg register \n#define fp( i , x , y ) for( rg int i=(x); i<=(y); ++i ) \n#define fq( i , x , y ) for( rg int i=(y); i>=(x); --i )  \nusing namespace std ; \nconst int N = 1505 ; \nint a[N][N] , b[N][N] , n , m , pa[N] , pb[N] , num[N] , ida[N] , idb[N] ; bool is[N][N] , ned[N] ; \nqueue <int> q ; int ans[N] , len ; \nbool cmpa( int A , int B ) {  \n  fp( j , 1 , m ) \n    if( a[A][j] != a[B][j] ) return a[A][j] < a[B][j] ; \n  return A < B ;  \n} \nbool cmpb( int A , int B ) { \n  fp( j , 1 , m ) \n    if( b[A][j] != b[B][j] ) return b[A][j] < b[B][j] ; \n  return A < B ;  \n} \nsigned main( ) { \n  ios::sync_with_stdio(false) ; \n  cin.tie(0) ; \n  cin >> n >> m ; \n  fp( i , 1 , n ) fp( j , 1 , m ) cin >> a[i][j] ; \n  fp( i , 1 , n ) fp( j , 1 , m ) cin >> b[i][j] ; \n  fp( i , 1 , n ) pa[i] = pb[i] = i ; \n  sort( pa+1 , pa+1+n , cmpa ) ; sort( pb+1 , pb+1+n , cmpb ) ; \n  fp( i , 1 , n ) ida[pa[i]] = i , idb[pb[i]] = i ; \n  fp( i , 1 , n ) fp( j , 1 , m ) \n    if( a[pa[i]][j] != b[pb[i]][j] ) { cout << \"-1\" << '\\n' ; return 0 ; }  \n  fp( i , 2 , n ) { \n    fp( j , 1 , m ) \n      if( b[i-1][j] > b[i][j] ) num[j] ++ , is[i][j] = 1 ; \n  } \n  fp( i , 2 , n ) ned[i] = 1 ; \n  fp( i , 1 , m ) if( !num[i] ) q.push(i) ; \n  while( q.size() ) { \n    int x = q.front() ; q.pop() ; \n    ans[++len] = x ; \n    fp( i , 2 , n ) \n     if( b[i-1][x] < b[i][x] && ned[i] ) { \n       ned[i] = 0 ; \n       fp( j , 1 , m ) \n         if( is[i][j] ) { \n           is[i][j] = 0 ; num[j] -- ; \n           if( !num[j] ) q.push(j) ; \n\t\t }  \n\t } \n  } \n  bool flag = 0 ; \n  fp( i , 2 , n ) if( ned[i] && pa[idb[i-1]] > pa[idb[i]] ) flag = 1 ;    \n  if( flag ) { cout << \"-1\" << '\\n' ; return 0 ; } \n  cout << len << '\\n' ; \n  fq( i , 1 , len ) cout << ans[i] << ' ' ; cout << '\\n' ; \n  return 0 ; \n} \n```\n\n",
        "postTime": 1615862464,
        "uid": 100114,
        "name": "hater",
        "ccfLevel": 0,
        "title": "CF1500C Matrix Sorting \u9898\u89e3"
    },
    {
        "content": "# Matrix Sorting\n\n## statement\n\n\u7ed9\u4f60\u4e24\u4e2a $n\\times m$ \u7684\u77e9\u9635 $A,B$\uff08$1\\le n,m\\le 1500$\uff09\uff0c\u77e9\u9635\u7684\u5143\u7d20\u5747\u4e3a $[1,n]$ \u5185\u7684\u6574\u6570\u3002\n\n\u6bcf\u4e00\u6b21\u64cd\u4f5c\u4f60\u53ef\u4ee5\u9009\u5b9a\u4e00\u5217\u4f5c\u4e3a\u6bcf\u4e00\u884c\u7684\u5173\u952e\u5b57\uff0c\u6309\u7167\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u628a\u6240\u6709\u884c\u6392\u5e8f\u5f97\u5230\u4e00\u4e2a\u65b0\u77e9\u9635\u3002\u8fd9\u91cc\u4f7f\u7528\u7684\u6392\u5e8f\u662f\u7a33\u5b9a\u7684\uff0c\u5373\u5982\u679c\u6709\u4e24\u884c\u7684\u5173\u952e\u5b57\u76f8\u540c\uff0c\u5219\u6309\u7167\u5728\u539f\u77e9\u9635\u7684\u5148\u540e\u987a\u5e8f\u6392\u5e8f\u3002\u4f60\u53ef\u4ee5\u8fdb\u884c\u4e0d\u8d85\u8fc7 $5000$ \u6b21\u64cd\u4f5c\uff0c\u95ee\u4f60\u80fd\u5426\u5c06 $A$ \u53d8\u6210 $B$\u3002\u4e0d\u80fd\u53d8\u6210\u8f93\u51fa $-1$\uff0c\u5426\u5219\u8f93\u51fa\u4e00\u79cd\u53ef\u884c\u7684\u64cd\u4f5c\u5e8f\u5217\u3002\n\n## solution\n\n\u663e\u7136\uff0c\u6211\u53ef\u4ee5\u5c06\u4e24\u8fb9\u7684\u884c\u4e00\u4e00\u5bf9\u5e94\uff0c\u5bf9\u5e94\u4e0d\u4e0a\u5219\u65e0\u89e3\u3002\u5bf9\u4e8e\u76f8\u540c\u7684\u884c\uff0c\u6309\u7167\u539f\u987a\u5e8f\u5bf9\u5e94\u5373\u53ef\u3002\n\n\u53d1\u73b0\u53ea\u9700\u8981\u5bf9 $B$ \u77e9\u9635\u76f8\u90bb\u4e24\u884c\u52a0\u4ee5\u9650\u5236\u5c31\u53ef\u4ee5\u4e86\uff0c\u5373\u7528 $n-1$ \u5bf9\u5173\u7cfb\u9650\u5b9a\u7ed3\u679c\u77e9\u9635\u3002\n\n\u76f4\u89c2\u7684\uff0c\u5bf9\u6bcf\u5217\u4e4b\u591a\u8fdb\u884c\u4e00\u6b21\u64cd\u4f5c\u3002\u8003\u8651\u4e00\u6b21\u64cd\u4f5c\u5bf9\u4e8e\u4e00\u4e2a\u4e0a\u8ff0\u5173\u7cfb\u7684\u5f71\u54cd\uff0c\u53ea\u5206\u4e3a\u4e09\u79cd\uff1a\n\n$1.$ \u6b63 $\\to$ \u53cd \n\n$2.$ \u53cd $\\to$ \u6b63\n\n$3.$ \u4e0d\u6539\u53d8\u987a\u5e8f\n\n\u5bf9\u4e8e\u6b64\u5173\u7cfb \uff0c$2$ \u64cd\u4f5c\u540e\u4e0d\u80fd\u6709 $1$ \u64cd\u4f5c\u3002\n\n\n\u8fd9\u79cd\u4e8c\u5143\u5173\u7cfb\u662f\u5bb9\u6613\u901a\u8fc7\u56fe\u8bba\u63cf\u8ff0\u7684\uff1a$m$ \u4e2a\u70b9\u4ee3\u8868 $m$ \u79cd\u64cd\u4f5c\uff0c\u4f46\u53d1\u73b0\u5bf9\u4e8e $m$ \u79cd\u64cd\u4f5c\u76f4\u63a5\u8fde\u8fb9\u590d\u6742\u5ea6\u65e0\u6cd5\u4fdd\u8bc1\u3002\u8003\u8651\u53e6\u5916 $n-1$ \u4e2a\u70b9\u4ee3\u8868 $n-1$ \u5bf9\u5173\u7cfb\u3002\u6839\u636e\u62d3\u6251\u6392\u5e8f\u7684\u8fc7\u7a0b\uff0c\u5bf9\u4e8e\u4e00\u5bf9\u5173\u7cfb $i$\uff0c$i$ \u5411\u5b83\u7684 $1$ \u64cd\u4f5c\u8fde\u8fb9\uff0c\u5b83\u7684 $2$ \u64cd\u4f5c\u5411\u5b83\u8fde\u8fb9\u3002\u4e00\u4e2a\u64cd\u4f5c\u53ea\u6709\u5728\u6ca1\u6709\u5165\u5ea6\u65f6\u624d\u80fd\u5165\u961f\uff0c\u4e00\u4e2a\u5173\u7cfb\u88ab\u51cf\u6389\u4e00\u6b21\u5165\u5ea6\u5c31\u6d88\u9664\u9650\u5236\uff0c\u76f4\u63a5\u5165\u961f\u3002\u7531\u6b64\uff0c\u53cd\u62d3\u6251\u5e8f\u5373\u4e3a\u7b54\u6848\u3002\n\n\n## code\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define pb push_back\nusing namespace std;\nconst int maxn=2e3+10,mod=1e9+7,base=233;\nint n,m,adj[maxn<<2],indeg[maxn<<2];\nbool vis[maxn<<2];\nstruct row{int a[maxn],hsh;}r[maxn],t[maxn];\nvector<int>ans,e[maxn<<2];\nvector<pair<int,int> >hshr,hsht;\ninline int id(int flag,int num){return m*flag+num;}\ninline void add(int x,int y){e[x].pb(y),indeg[y]++;}\ninline void solve()\n{\n    cin>>n>>m;\n    for(int i=1;i<=n;i++) for(int j=1;j<=m;j++) cin>>r[i].a[j];\n    for(int i=1;i<=n;i++) for(int j=1;j<=m;j++) cin>>t[i].a[j];\n    for(int i=1;i<=n;i++){int hsh=0;for(int j=1;j<=m;j++)hsh=(hsh*base+r[i].a[j])%mod;hshr.pb({hsh,i});}\n    for(int i=1;i<=n;i++){int hsh=0;for(int j=1;j<=m;j++)hsh=(hsh*base+t[i].a[j])%mod;hsht.pb({hsh,i});}\n    sort(hshr.begin(),hshr.end()),sort(hsht.begin(),hsht.end());\n    for(int i=0;i<n;i++)\n        if(hshr[i].first!=hsht[i].first) return cout<<\"-1\\n\",void();\n        else adj[hsht[i].second]=hshr[i].second;\n    for(int j=1;j<=m;j++) for(int i=1;i<n;i++)\n        if(r[adj[i]].a[j]<r[adj[i+1]].a[j]) add(id(0,j),id(1,i));\n        else if(r[adj[i]].a[j]>r[adj[i+1]].a[j]) add(id(1,i),id(0,j));\n    queue<int>q;for(int st=1;st<=m;st++) if(!indeg[st]) q.push(st);\n    while(!q.empty())\n    {\n        int x=q.front();q.pop(),(x<=m)?ans.pb(x):void();\n        for(auto y:e[x]) if(!vis[y])\n            if(y>m || !--indeg[y]) q.push(y),vis[y]=1;\n    }\n    for(int i=1;i<n;i++) if(!vis[id(1,i)] && adj[i]>adj[i+1]) return cout<<\"-1\\n\",void();\n    reverse(ans.begin(),ans.end()),cout<<ans.size()<<'\\n';\n    for(auto x:ans) cout<<x<<\" \";cout<<'\\n';\n}\nsigned main(){ios::sync_with_stdio(false);cin.tie(NULL);return solve(),0;}\n```\n",
        "postTime": 1685151205,
        "uid": 767740,
        "name": "Maverik",
        "ccfLevel": 0,
        "title": "CF1500C Matrix Sorting"
    },
    {
        "content": "\u6458\u81ea\u6211\u7684[\u8d2a\u5fc3 & \u6784\u9020 & DP \u6742\u9898\u9009\u505a](https://www.cnblogs.com/ET2006/p/greedy-construction-dp2.html)\uff0c\u7b2c $30$ \u9053\u9898\n\n\u4e00\u9053\u975e\u5e38\u5999\u7684\u62d3\u6251\u6392\u5e8f\u597d\u9898\uff0c\u80fd\u51fa\u51fa\u8fd9\u9053\u9898\u7684\u4eba\u6015\u4e0d\u662f\u795e\u4ed9/bx\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u6c42\u51fa\u77e9\u5f62 $A$ \u4e2d\u7684\u6bcf\u4e00\u884c\u5728\u8fdb\u884c\u8fd9\u4e9b\u64cd\u4f5c\u540e\u4f1a\u5bf9\u5e94\u5230\u77e9\u5f62 $B$ \u4e2d\u7684\u54ea\u4e00\u884c\u2014\u2014\u663e\u7136\u5982\u679c\u77e9\u5f62 $A$ \u4e2d\u6bcf\u884c\u90fd\u4e0d\u76f8\u540c\uff0c\u90a3\u76f4\u63a5\u76f8\u540c\u7684\u884c\u914d\u5bf9\u5373\u53ef\uff0c\u5982\u679c\u77e9\u5f62 $A$ \u51fa\u73b0\u4e86\u76f8\u540c\u7684\u884c\uff0c\u90a3\u663e\u7136\u5b83\u4eec\u7684\u76f8\u5bf9\u4f4d\u7f6e\u987a\u5e8f\u662f\u4e0d\u4f1a\u6539\u53d8\u7684\uff0c\u76f4\u63a5\u6309\u7167\u5b83\u4eec\u5728\u539f\u77e9\u9635\u4e2d\u7684\u987a\u5e8f\u7f16\u53f7\u5373\u53ef\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u65b0\u589e\u4e00\u4e2a $m+1$ \u5217\uff0c$A$ \u77e9\u5f62\u7b2c $i$ \u884c\u7b2c $m+1$ \u5217\u7684\u5143\u7d20\u5c31\u662f $i$\uff0c\u800c $B$ \u77e9\u5f62\u7b2c $i$ \u884c\u7b2c $m+1$ \u5217\u7684\u5143\u7d20\u5219\u662f $B$ \u77e9\u5f62\u7b2c $i$ \u884c\u5728 $A$ \u77e9\u5f62\u4e2d\u5bf9\u5e94\u7684\u884c\u7684\u7f16\u53f7\u3002\u5f53\u7136\u5982\u679c\u65e0\u6cd5\u5bf9\u5e94\u6211\u4eec\u5c31\u76f4\u63a5\u8f93\u51fa `NO`\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u6c42\u51fa\u64cd\u4f5c\u5e8f\u5217\uff0c\u6211\u4eec\u5012\u7740\u8003\u8651\u64cd\u4f5c\u5e8f\u5217\uff0c\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u6700\u540e\u4e00\u6b65\u53ef\u80fd\u64cd\u4f5c\u7684\u5217\uff0c\u5728 $B$ \u77e9\u5f62\u4e2d\u90fd\u662f\u5355\u8c03\u4e0d\u964d\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e**\u4efb\u610f\u76f8\u90bb\u4e24\u884c $i,i+1$**\uff0c\u5fc5\u987b\u8981\u6709 $b_{i,j}\\le b_{i+1,j}$ \u540e\uff0c\u6700\u540e\u4e00\u6b21\u624d\u6709\u53ef\u80fd\u64cd\u4f5c\u7b2c $j$ \u5217\uff0c\u8003\u8651\u5b8c\u4e86\u6700\u540e\u4e00\u6b21\u64cd\u4f5c\uff0c\u518d\u8003\u8651\u5012\u6570\u7b2c\u4e8c\u6b21\u64cd\u4f5c\u7684\u5217\u6709\u4ec0\u4e48\u9650\u5236\uff0c\u8fd8\u662f\u5fc5\u987b\u5355\u8c03\u4e0d\u964d\u5417\uff1f\u975e\u4e5f\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u52a0\u5165\u6700\u540e\u4e00\u6b21\u64cd\u4f5c\u7684\u5217\u4e3a $x$\uff0c\u5012\u6570\u7b2c\u4e8c\u6b21\u64cd\u4f5c\u7684\u5217\u4e3a $y$\uff0c\u90a3\u4e48\u5982\u679c $b_{i,y}>b_{i+1,y}$ \u4f46 $b_{i,x}<b_{i+1,x}$\uff0c\u8fd9\u79cd\u60c5\u51b5\u8fd8\u662f\u6709\u53ef\u80fd\u5408\u6cd5\u7684\uff0c\u56e0\u4e3a\u867d\u7136\u6392 $y$ \u4e4b\u540e\u4f1a\u5bfc\u81f4 $i,i+1$ \u987a\u5e8f\u98a0\u5012\uff0c\u4f46\u662f\u4e0b\u4e00\u6b21\u6392\u5e8f\u6211\u4eec\u53c8\u628a\u5b83\u642c\u56de\u6765\u4e86\uff0c\u56e0\u6b64\u8fd9\u79cd\u60c5\u51b5\u662f\u4e0d\u5f71\u54cd\u7684\uff0c\u4f46\u662f\u5982\u679c\u51fa\u73b0 $b_{i,y}>b_{i+1,y}$ \u4e14 $b_{i,x}=b_{i+1,x}$ \u5c31 GG \u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u6392\u5e8f\u662f stable \u7684\uff0c\u4f60\u524d\u4e00\u6b21\u628a $i,i+1$ \u7684\u987a\u5e8f\u641e\u53cd\u4e86\uff0c\u540e\u4e00\u6b21\u4e24\u884c\u7684\u5173\u952e\u5b57\u76f8\u540c\uff0c\u5b83\u4eec\u7684\u987a\u5e8f\u8fd8\u662f\u53cd\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u4ece\u4ec0\u4e48\u89d2\u5ea6\u601d\u8003\u8fd9\u4e2a\u8fc7\u7a0b\u5462\uff1f\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u5012\u7740\u8003\u8651\u6bcf\u4e00\u6b21\u64cd\u4f5c $x$\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5b8c $x$ \u4e4b\u540e\uff0c\u76f8\u5f53\u4e8e\u628a\u6240\u6709 $a_{i,x}\\ne a_{i+1,x}$ \u7684 $(i,i+1)$ \u90fd\u201c\u89e3\u9501\u4e86\u201d\uff0c\u800c\u5982\u679c\u8003\u8651\u5230\u67d0\u4e00\u6b65\u64cd\u4f5c\u65f6\uff0c\u7b2c $y$ \u5217\u5b58\u5728\u4e00\u4e2a $i$ \u4f7f\u5f97 $a_{i,y}>a_{i+1,y}$\uff0c\u4e14 $(i,i+1)$ \u6ca1\u6709\u88ab\u201c\u89e3\u9501\u201d\uff0c\u90a3\u4e48\u4e0a\u4e00\u6b65\u64cd\u4f5c\u7684\u5c31\u4e0d\u53ef\u80fd\u662f $y$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u62d3\u6251\u6392\u5e8f\u7684\u8fc7\u7a0b\uff0c\u5c06\u76f8\u90bb\u4e24\u884c\u548c\u6bcf\u4e00\u5217\u770b\u4f5c\u4e00\u4e2a\u70b9\uff0c\u5bf9\u4e8e\u6bcf\u5bf9 $(a_{i,x},a_{i+1,x})$\uff0c\u5982\u679c $a_{i,x}<a_{i+1,x}$\uff0c\u90a3\u4e48\u6211\u4eec\u8fde\u4e00\u6761\u7b2c $x$ \u5217\u5411\u7b2c $i$ \u884c\u7684\u8fb9\uff0c\u8868\u793a\u64cd\u4f5c\u5b8c\u7b2c $x$ \u5217\u540e $(i,i+1)$ \u5c31\u88ab\u89e3\u9501\u4e86\uff0c\u5982\u679c $a_{i,x}>a_{i+1,x}$\uff0c\u90a3\u4e48\u6211\u4eec\u8fde\u4e00\u6761\u7b2c $i$ \u884c\u6307\u5411\u7b2c $x$ \u5217\u7684\u8fb9\uff0c\u8868\u793a\u7b2c $i$ \u884c\u88ab\u89e3\u9501\uff0c\u662f\u7b2c $x$ \u5217\u80fd\u591f\u88ab\u64cd\u4f5c\u7684\u5fc5\u8981\u6761\u4ef6\uff0c\u7136\u540e\u8dd1\u4e00\u904d\u7c7b\u4f3c\u62d3\u6251\u6392\u5e8f\u7684\u4e1c\u897f\u5373\u53ef\u3002\u53ea\u4e0d\u8fc7\u8fd9\u91cc\u4e0e\u4e00\u822c\u7684\u62d3\u6251\u6392\u5e8f\u4e0d\u540c\u7684\u4e00\u70b9\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u5bf9\u5e94\u7684\u662f\u67d0\u4e00\u884c\u8868\u793a\u7684\u70b9\uff0c\u90a3\u4e48\u53ea\u8981\u8fde\u5411\u5b83\u7684\u70b9\u4e2d\u81f3\u5c11\u4e00\u4e2a\u88ab\u9009\u62e9\uff0c\u90a3\u5b83\u5c31\u53ef\u4ee5\u8bbe\u4e3a\u88ab\u8bbf\u95ee\u3002\n\n\u90a3\u4e48\u600e\u6837\u7edf\u8ba1\u7b54\u6848\u5462\uff1f\u4e0d\u96be\u53d1\u73b0\uff0c\u521d\u59cb\u5c40\u9762\u76f8\u5f53\u4e8e\u6211\u4eec\u5f3a\u5236\u5bf9 $m+1$ \u884c\u6392\u4e86\u4e2a\u5e8f\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u68c0\u9a8c $m+1$ \u5217\u5bf9\u5e94\u7684\u70b9\u662f\u5426\u88ab\u8bbf\u95ee\u5373\u53ef\uff0c\u5982\u679c\u88ab\u8bbf\u95ee\u4e86\u5219\u5012\u7740\u8f93\u51fa\u62d3\u6251\u5e8f\u5217\uff0c\u5426\u5219\u8f93\u51fa `NO`\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(nm)$\u3002",
        "postTime": 1636254152,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1500C Matrix Sorting"
    },
    {
        "content": "\u5bf9\u4e8e\u77e9\u9635\u7684\u6bcf\u4e00\u884c\u91cd\u6807\u53f7\uff0c$c_i$ \u8868\u793a $A$ \u77e9\u9635\u7684\u7b2c $i$ \u884c\u5bf9\u5e94\u7684 $B$ \u77e9\u9635\u7684\u7b2c $c_i$ \u884c\u3002\n\n\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\rm O(n^2+nm)$ \u3002\n\n\u540c\u65f6\u5b9a\u4e49 $mat_{c_i}=i$\uff0c\u8868\u793a $B$ \u77e9\u9635\u4e2d\u5728 $A$ \u77e9\u9635\u4e2d\u5bf9\u5e94\u7684\u884c\u3002\n\n\u90a3\u4e48\u6700\u7ec8\u7684 $B$ \u77e9\u9635\uff0c\u6807\u53f7\u4e00\u5b9a\u662f $1,2,\\cdots,n$ \u3002\n\n\u60f3\u8981\u5c06 $A$ \u77e9\u9635\u6392\u5e8f\uff0c\u53ea\u9700\u8981\u6700\u7ec8\u7b2c $mat_1$ \u5728\u7b2c $mat_{2}$ \u884c\u524d\u9762\uff0c\u7b2c $mat_i$ \u5728\u7b2c $mat_{i+1}$ \u884c\u524d\u9762 \u3002\u5373\u4f7f\u6240\u6709\u76f8\u90bb\u884c\u6b63\u5e8f\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u5217 $j$ \u6392\u5e8f\uff0c\u8003\u8651\u6bcf\u4e2a $1\\le i<n$  \u3002\n\n- \u5982\u679c $a_{mat_i,j}<a_{mat_{i+1},j}$ \uff0c\u5219\u80fd\u591f\u4f7f\u8fd9\u4e2a\u76f8\u90bb\u884c\u6b63\u5e8f\u3002\n- \u5982\u679c $a_{mat_i,j}>a_{mat_{i+1},j}$ \uff0c\u5219\u80fd\u591f\u4f7f\u8fd9\u4e2a\u76f8\u90bb\u884c\u53cd\u5e8f\u3002\n- \u5982\u679c $a_{mat_i,j}=a_{mat_{i+1},j}$ \uff0c\u5219\u5bf9\u76f8\u90bb\u884c\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u6211\u4eec\u8bb0\u5f55\u4e0b\u5bf9\u7b2c $j$ \u5217\u7684\u6392\u5e8f\u4f1a\u5f71\u54cd\u54ea\u4e9b\u76f8\u90bb\u884c\u3002\u5982\u679c\u5168\u90e8\u662f\u6b63\u5e8f\u5f71\u54cd\uff0c\u5219\u8fdb\u884c\u5f53\u524d\u5217\u7684\u6392\u5e8f\u4e00\u5b9a\u4e0d\u4f1a\u4f7f\u7b54\u6848\u66f4\u52a3\u3002\n\n\u5982\u679c\u5b58\u5728\u53cd\u5e8f\u5f71\u54cd\uff0c\u610f\u5473\u7740\u8be5\u64cd\u4f5c\u540e\u4e00\u5b9a\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u64cd\u4f5c\u662f\u5bf9\u8be5\u76f8\u90bb\u884c\u7684\u6b63\u5e8f\u5f71\u54cd\u3002\n\n\u4e0d\u96be\u7528\u961f\u5217\u7ef4\u62a4\u76ee\u524d\u5df2\u7ecf\u89e3\u9501\u7684\u64cd\u4f5c\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u89e3\u9501\u7684\u64cd\u4f5c\uff0c\u9009\u62e9\u4e00\u5b9a\u4e0d\u4f1a\u4f7f\u7b54\u6848\u66f4\u52a3\u3002\n\n\u5982\u679c\u5c06\u6240\u6709\u80fd\u8fdb\u884c\u7684\u64cd\u4f5c\u4f7f\u7528\u540e\u4ecd\u4e0d\u80fd\u6392\u5e8f\u5219\u65e0\u89e3\uff0c\u4e24\u4e2a\u77e9\u9635\u7684\u884c\u4e0d\u80fd\u5bf9\u5e94\u4e5f\u65e0\u89e3\u3002\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\rm O(n^2+nm)$ \u3002\u5982\u679c\u5bf9\u54c8\u5e0c\u503c\u79bb\u6563\u5316\u53ef\u4ee5\u505a\u5230 $\\rm O(n\\log n+nm)$ \u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 3005\n#define P 10007\nusing namespace std;\nint n,m,c[N],a[N][N],b[N][N],vis[N],mat[N];unsigned long long u[N],v[N];\ntypedef pair<int,int> Pr;\nqueue<int>q;int d[N],h[N],tot,vs[N];\nvector<int>ans;\nstruct edge{int to,nxt;}e[N*N];\nvoid add(int x,int y){e[++tot].nxt=h[x];h[x]=tot;e[tot].to=y;}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\trep(i,1,n)rep(j,1,m)scanf(\"%d\",&a[i][j]);\n\trep(i,1,n)rep(j,1,m)scanf(\"%d\",&b[i][j]);\n\trep(i,1,n){\n\t\trep(j,1,m)u[i]=u[i]*P+a[i][j];\n\t\trep(j,1,m)v[i]=v[i]*P+b[i][j];\n\t}\n\trep(i,1,n){\n\t\trep(j,1,n)if(u[i]==v[j]&&!vis[j]){\n\t\t\tvis[j]=1,c[i]=j;mat[j]=i;break;\n\t\t}\n\t\tif(!c[i]){puts(\"-1\");return 0;}\n\t}\n\trep(j,1,m){\n\t\trep(i,1,n-1){\n\t\t\tint l=mat[i],r=mat[i+1];\n\t\t\tif(a[l][j]<a[r][j])add(j,i+m);\n\t\t\telse if(a[l][j]>a[r][j])d[j]++,add(i+m,j);\n\t\t}\n\t}\n\trep(i,1,m)if(!d[i])q.push(i);\n\twhile(!q.empty()){\n\t\tint x=q.front();q.pop();\n\t\tif(x<=m){\n\t\t\tans.push_back(x);\n\t\t\tfor(int i=h[x];i;i=e[i].nxt)if(!vs[e[i].to]){\n\t\t\t\tvs[e[i].to]=1;q.push(e[i].to);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tfor(int i=h[x];i;i=e[i].nxt){\n\t\t\t\td[e[i].to]--;\n\t\t\t\tif(!d[e[i].to])q.push(e[i].to);\n\t\t\t}\n\t\t}\n\t}\n\trep(i,1,n-1)if(mat[i]>mat[i+1]&&!vs[m+i]){puts(\"-1\");return 0;}\n\treverse(ans.begin(),ans.end());\n\tcout<<ans.size()<<endl;\n\tfor(int i=0;i<(int)ans.size();i++)printf(\"%d \",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1621756162,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF1500C Matrix Sorting"
    }
]