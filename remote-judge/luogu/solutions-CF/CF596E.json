[
    {
        "content": "\u8fd9\u9053\u9898\u7684\u6570\u636e\u597d\u5f31\u554a\uff0c\u597d\u591a $O(nm\\sum |T|)$ \u7684\u7b97\u6cd5\u80fd\u8fc7\uff0c\u5f53\u7136\u6211\u5728\u8fd9\u91cc\u80af\u5b9a\u662f\u8981\u8bb2\u6b63\u89e3\uff0c\u5373 $O(nmq+\\sum |T|)$ \u7684\u7b97\u6cd5\u3002  \n\u9996\u5148\u6211\u4eec\u53d1\u73b0\u6bcf\u4e2a\u7f51\u683c\u56fe\u4e0a\u7684\u70b9\u6709\u4e14\u4ec5\u6709\u4e00\u6761\u51fa\u8fb9\uff0c\u6240\u4ee5\u8fd9\u4e2a\u56fe\u662f\u4e00\u4e2a\u57fa\u73af\u68ee\u6797\u3002\u9898\u76ee\u4e2d\u7684\u95ee\u9898\u5373\u5728\u4e0a\u9762\u8fdb\u884c\u5339\u914d\u3002\u5f88\u660e\u663e\u6211\u4eec\u7684\u5339\u914d\u662f\u73b0\u5728\u6811\u8fb9\u4e0a\u8d70\u4e00\u6bb5\u8ddd\u79bb\uff0c\u7136\u540e\u4e00\u76f4\u8d70\u73af\u5c06\u5269\u4e0b\u7684\u5339\u914d\u5b8c\u3002\u5982\u679c\u6211\u4eec\u679a\u4e3e\u6811\u8fb9\u8d77\u70b9\uff0c\u5c31\u5bb9\u6613\u88ab[shangcheng\u7684Hack\u6570\u636e](https://www.luogu.com.cn/discuss/show/323587)\u53c9\u6389\u3002\u6240\u4ee5\u6211\u4eec\u8003\u8651\u679a\u4e3e\u73af\u3002  \n\u6211\u4eec\u8003\u8651\u5c06\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7ffb\u8f6c\u8fc7\u6765\uff0c\u8fd9\u6837\u5c31\u662f\u5148\u8d70\u73af\uff0c\u540e\u8d70\u6811\u8fb9\uff08\u5f53\u7136\u8fb9\u4e5f\u8981\u53cd\u8fc7\u6765\uff09\u3002\u8bb0\u5f55\u4e00\u4e2a\u73af\u91cc\u9762\u51fa\u73b0\u4e86\u54ea\u4e9b\u6570\u5b57\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u540e\u9762\u7684\u5f88\u957f\u4e00\u6bb5\u5339\u914d\u5b8c\u3002\u7136\u540e\u6211\u4eec\u4ece\u8fd9\u4e2a\u73af\u91cc\u51fa\u53bb\uff0c\u8d70\u6811\u8fb9\uff0c\u5bb9\u6613\u5f97\u77e5\u6bcf\u4e2a\u70b9\u81f3\u591a\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6 $O(nmq+\\sum |T|)$\u3002  \n```cpp\n#include<bits/stdc++.h>\n#define fi first\n#define sc second\nusing namespace std;\nconst int maxn=205,maxm=1e6+5;\ntypedef pair<int,int> pi;\nstruct edge {\n\tint next,tx,ty;\n} e[maxn*maxn];\nint dx[10],dy[10],a[maxn][maxn],n,m,q,book[maxn*maxn][10],bc,bel[maxn][maxn],h[maxn][maxn],cnt,len,f[10];\nvector<pi> b[maxn*maxn];\nbool vis[maxn][maxn],maps[maxn][maxn];\nstack<pi> t;\nchar s[maxm];\nvoid addedge(int x,int y,int tx,int ty) {\n\te[++cnt].next=h[x][y];\n\te[cnt].tx=tx,e[cnt].ty=ty;\n\th[x][y]=cnt;\n}\nvoid dfs(int x,int y) {\n\tint tx=x+dx[a[x][y]],ty=y+dy[a[x][y]];\n\tif(tx<1||tx>n||ty<1||ty>m)tx=x,ty=y;\n\tvis[x][y]=1,maps[x][y]=1,t.push(pi(x,y));\n\tif(!vis[tx][ty])dfs(tx,ty);\n\telse if(maps[tx][ty]) {\n\t\tbc++;\n\t\twhile(!t.empty()) {\n\t\t\tbook[bc][a[t.top().fi][t.top().sc]]=1;\n\t\t\tbel[t.top().fi][t.top().sc]=bc;\n\t\t\tif(t.top().fi==tx&&t.top().sc==ty) {\n\t\t\t\tt.pop();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tt.pop();\n\t\t}\n\t}\n\tif(!bel[x][y]&&bel[tx][ty])b[bel[tx][ty]].push_back(pi(x,y));\n\tmaps[x][y]=0;\n\tif(!t.empty()&&t.top().fi==x&&t.top().sc==y)t.pop();\n}\nbool find(int x,int y,int l) {\n\tif(a[x][y]==s[l]-'0')l++;\n\tif(l==len+1)return 1;\n\tbool w=0;\n\tfor(register int i=h[x][y]; i; i=e[i].next)w|=find(e[i].tx,e[i].ty,l);\n\treturn w;\n}\nint main() {\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tfor(register int i=1; i<=n; i++) {\n\t\tscanf(\"%s\",s);\n\t\tfor(register int j=1; j<=m; j++)a[i][j]=s[j-1]-'0';\n\t}\n\tfor(register int i=0; i<10; i++)scanf(\"%d%d\",&dx[i],&dy[i]);\n\tfor(register int i=1; i<=n; i++)\n\t\tfor(register int j=1; j<=m; j++) {\n\t\t\tif(!vis[i][j])dfs(i,j);\n\t\t\tint tx=i+dx[a[i][j]],ty=j+dy[a[i][j]];\n\t\t\tif(tx<1||tx>n||ty<1||ty>m)tx=i,ty=j;\n\t\t\taddedge(tx,ty,i,j);\n\t\t}\n\twhile(q--) {\n\t\tscanf(\"%s\",s+1),len=strlen(s+1);\n\t\treverse(s+1,s+len+1);\n\t\tmemset(f,0,sizeof(f));\n\t\tfor(register int i=1; i<=len; i++)if(!f[s[i]-'0'])f[s[i]-'0']=i;\n\t\tbool ans=0;\n\t\tfor(register int i=1; i<=bc; i++) {\n\t\t\tint mn=len+1;\n\t\t\tfor(register int j=0; j<10; j++)if(!book[i][j]&&f[j])mn=min(mn,f[j]);\n\t\t\tif(mn==len+1) {\n\t\t\t\tans=1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor(register int j=0; j<b[i].size(); j++) {\n\t\t\t\tif(find(b[i][j].fi,b[i][j].sc,mn)) {\n\t\t\t\t\tans=1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(ans==1)break;\n\t\t\t}\n\t\t}\n\t\tputs(ans?\"YES\":\"NO\");\n\t}\n}\n```",
        "postTime": 1624840762,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--CF596E Wilbur and Strings"
    }
]