[
    {
        "content": "**\u9898\u610f**\n\n\u6709\u957f\u5ea6$n$\u7684$1-n$\u6392\u5217$p_i$\uff0c$k$\u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u7b49\u6982\u7387\u53cd\u8f6c\u4e00\u4e2a\u533a\u95f4\uff0c\u6c42\u6700\u540e\u9006\u5e8f\u5bf9\u7684\u671f\u671b\u3002\u8bef\u5dee$<10^{-9}$\u5373\u53ef\u3002\n\n$ task 1: n \\le6 ,k\\le4$\n\n$ task 2: n \\le30 ,k\\le200$\n\n$ task 3: n \\le100 ,k\\le10^9$\n\n**\u505a\u6cd5**\n\n\u5148\u8003\u8651task 2\u505a\u6cd5\u3002\n\n\u6211\u4eec\u72b6\u538b\u6392\u5217\u505aDP\u4e0d\u592a\u53ef\u80fd\u3002\u8003\u8651\u7ef4\u62a4\u6bcf\u4e00\u5bf9\u4f4d\u7f6e\u7684\u8d21\u732e\u3002$dp_{a,b}$\u8868\u793a$P(p_a>p_b)$\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\uff0c\u6211\u4eec$O(n^2)$\u679a\u4e3e\u4e0a\u4e00\u6b21\u53cd\u8f6c\u7684\u533a\u95f4\uff0c$O(n^2)$\u679a\u4e3e\u4e24\u4e2a\u4f4d\u7f6e\uff0c\u590d\u6742\u5ea6$O(k*N^4).$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 31 , K = 202;\nint n , k , a[N];\n\ndouble dp[K][N][N];\nint trans(int l  , int r , int pos) {\n    if(pos < l || pos > r) return pos;\n    return l + r - pos;\n}\n\nvoid solve34() {\n\tdouble p = 2.00 / (n* (n + 1));\n    for(int i = 1 ; i <= n ; ++i)\n        for(int j = 1 ; j <= n ; ++j)\n            dp[0][i][j] = (a[i] > a[j]);\n\n    for(int i = 1 ; i <= k ; ++i)\n    for(int a = 1 ; a <= n ; ++a)\n    for(int b = 1 ; b <= n ; ++b)\n    for(int l = 1 ; l <= n ; ++l)\n    for(int r = l ; r <= n ; ++r)\n    {\n        int lasA = trans(l , r , a) , lasB = trans(l , r , b);\n        dp[i][a][b] += p * dp[i - 1][lasA][lasB];\n    }        \n\n   \tdouble ans = 0;\n    for(int i = 1 ; i <= n ; ++i)\n        for(int j = i ; j <= n ; ++j)\n            ans += dp[k][i][j];\n    printf(\"%.10lf\\n\" , ans);\n    exit(0);\n}\n\nint main() {\n    scanf(\"%d %d\" , &n , &k);\n    for(int i = 1 ; i <= n ; ++i) scanf(\"%d\" , a + i);\n    solve34();\n}\n```\n\n\u518d\u770b\u770btask 3\u600e\u4e48\u505a\u3002\u5f88\u663e\u7136\uff0c\u6211\u4eec\u9700\u8981\u4f18\u5316\u590d\u6742\u5ea6\u3002\n\n\u9996\u5148\u6211\u4eec\u9ed8\u8ba4$a<b$,\u56e0\u4e3a$dp_{a,a}=0,dp_{b,a}=1-dp_{a,b}$\n\n\u6211\u4eec\u628a\u8be2\u95ee\u7684\u533a\u95f4\u5206\u4e3a4\u7c7b:\n\n- \u8be5\u533a\u95f4\u4e0d\u542ba,b\u3002\u8fd9\u7c7b\u533a\u95f4\u7684\u4e2a\u6570\u662f$C_{n-b}^2 + C_{a-1}^2+C_{b-a-1}^2$\uff0c\u76f4\u63a5\u8f6c\u79fb\u3002\n\n- \u8be5\u533a\u95f4\u542ba\uff0c\u4e0d\u542bb\u3002\u8fd9\u4e00\u7c7b\u533a\u95f4\u7684\u8f6c\u79fb\uff0c\u53f3\u7aef\u70b9\u56fa\u5b9a\uff0c\u5de6\u7aef\u70b9\u8fde\u7eed\u3002\n\n- \u8be5\u533a\u95f4\u542bb\uff0c\u4e0d\u542ba\u3002\u8fd9\u4e00\u7c7b\u533a\u95f4\u7684\u8f6c\u79fb\uff0c\u5de6\u7aef\u70b9\u56fa\u5b9a\uff0c\u53f3\u7aef\u70b9\u8fde\u7eed\u3002\n\n- \u8be5\u533a\u95f4\u542ba,b\u3002\u8fd9\u4e00\u7c7b\u533a\u95f4\u7684$a-b$\u56fa\u5b9a\uff0c\u53f3\u7aef\u70b9\uff08\u6216\u8005\u8bf4\u5de6\u7aef\u70b9\uff09\u8fde\u7eed\u3002\n\n\u8003\u8651\u7ef4\u62a4\u4e09\u4e2a\u524d\u7f00\u548c$suma,sumb,sumlen$\u8868\u793a\u5de6\u7aef\u70b9\uff0c\u53f3\u7aef\u70b9\uff0c$a-b$\u4e00\u5b9a\u65f6\u7684\u524d\u7f00\u548c\u3002\u590d\u6742\u5ea6\u4f18\u5316\u5230$O(K*N^3)$\u3002\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5199\u51fa\u7a0b\u5e8f\u540e\uff0c\u53d1\u73b0\u8fd9\u4e09\u4e2a\u524d\u7f00\u548c\u7684\u8ba1\u7b97\u4e5f\u662f\u8fde\u7eed\u7684\uff0c\u56e0\u800c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u8fd9\u4e09\u4e2a\u6570\u7ec4\u7684**\u4e8c\u4f4d\u524d\u7f00\u548c**\uff0c\u4ece\u800c\u590d\u6742\u5ea6\u505a\u5230$O(K*N^2)$\u3002\n\n\u7b49\u4e00\u7b49\uff0ck\u8fd9\u4e48\u5927\uff0c~~\u83ab\u4e0d\u662f\u5e38\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\uff1f~~\n\n\u5982\u679c\u5728\u6a21\u610f\u4e49\u4e0b\u505aDP\uff0c\u5c31\u53ea\u80fd\u7528\u90a3\u5957\u6bd2\u7624\u7684\u7ebf\u6027\u4ee3\u6570\u65b9\u6cd5\u3002\n\n**\u53ef\u662f\u8fd9\u9053\u9898\u662f\u5b9e\u6570\u8fd0\u7b97\uff01**\n\n\u76f4\u89c2\u5730\u60f3\uff0c\u6211\u4eeck\u8d8a\u5927\uff0c\u4e00\u8f6e\u64cd\u4f5c\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\u5c31\u8d8a\u5c0f\u3002\u6211\u4eec\u628ak\u4e0e\u4e00\u4e2a\u5927\u6570K\u53d6\u4e2amin\uff0c\u5c31\u53ef\u4ee5\u4e86\u4fdd\u8bc1\u7cbe\u5ea6\u4e86\uff01\u8fd9\u91cc\u53d6$K=1000$.\n\u4fdd\u8bc1\u4e0d\u4f1atle\u4e5f\u4e0d\u4f1awa.\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 105;\n\nint n , k , a[N];\ndouble p;\ndouble dp[N][N] , suma[N][N] , sumb[N][N] , sumlen[N][N];\n\nvoid calc() {\n    for(int i = 1 ; i <= n ; ++i) {\n        memset(suma[i] + 1, 0 , n * sizeof(double));\n        memset(sumb[i] + 1, 0 , n * sizeof(double));\n        memset(sumlen[i] + 1, 0 , n * sizeof(double));\n    }\n    for(int a = 1 ; a <= n ; ++a)\n        for(int b = 1 ; b <= n ; ++b) {\n            suma[a][b] += dp[a][b];\n            sumb[b][a] += dp[a][b];\n            if(a > b) sumlen[a - b][b] += dp[a][b];\n        }\n    for(int k = 0 ; k < 2 ; ++k)\n        for(int i = 1 ; i <= n ; ++i) \n            for(int j = 1 ; j <= n ; ++j)\n                suma[i][j] += suma[i][j - 1],\n                sumb[i][j] += sumb[i][j - 1],\n                sumlen[i][j] += sumlen[i][j - 1];\n}\n\ninline int C2(int a) {return a * (a + 1) / 2;}\nvoid init() {\n    for(int a = 1 ; a <= n ; ++a) \n        for(int b = 1 ; b <= n ; ++b) \n            dp[a][b] = dp[a][b] * p * (C2(n - b) + C2(a - 1) + C2(b - a - 1));\n}\nvoid solve() {\n    p = 2.00 / (n * (n + 1));\n    for(int i = 1 ; i <= n ; ++i)\n        for(int j = 1 ; j <= n ; ++j)\n            dp[i][j] = (a[i] > a[j]);\n    calc();\n\n    for(int i = 1 ; i <= k ; ++i)\n    {\n        init();\n        for(int a = 1 ; a <= n ; ++a)\n        for(int b = a + 1 ; b <= n ; ++b)\n        {\n           dp[a][b] = (dp[a][b] + p * (sumb[b][b - 1] - sumb[b][b - a - 1] - sumb[b][a - 1]));\n           dp[a][b] = (dp[a][b] + p * (sumlen[b - a][a + n - b] - sumlen[b - a][n - b] - sumlen[b - a][a - 1]));\n           dp[a][b] = (dp[a][b] + p * (suma[a][n] - suma[a][a + n - b] - suma[a][b - 1] + suma[a][a - 1]));\n        }\n        for(int a = 1 ; a <= n ; ++a)\n            for(int b = 1 ; b < a ; ++b)\n                dp[a][b] = 1 - dp[b][a];\n        calc();\n    }\n\n    double ans = 0;\n    for(int i = 1 ; i <= n ; ++i)\n        for(int j = i ; j <= n ; ++j)\n            ans += dp[i][j];\n    printf(\"%.10lf\\n\" , ans);\n}\n\nint main() {\n    scanf(\"%d %d\" , &n , &k);\n    k = min(k , 1000);\n    for(int i = 1 ; i <= n ; ++i) scanf(\"%d\" , a + i);\n    solve();\n}\n```",
        "postTime": 1585798587,
        "uid": 138511,
        "name": "GreenDay",
        "ccfLevel": 8,
        "title": "CF513G3 Inversions problem \u9898\u89e3"
    },
    {
        "content": "\u4e00\u9053\u975e\u5e38\u6709\u4ef7\u503c\u7684\u597d\u9898\u3002\n\n\u9996\u5148\u770b\u5230\u671f\u671b\u9898\uff0c\u628a\u6bcf\u4e00\u5bf9\u6570\u7684\u8d21\u732e\u62c6\u5f00\u6765\u7b97\u3002\n\n\u6211\u4eec\u7528 $f[t][i][j]$ \u8868\u793a\u7ecf\u8fc7 $t$ \u6b21\u4ea4\u6362\u540e $a_i>a_j$ \u7684\u6982\u7387\u3002\n\n\u7b54\u6848\u5c31\u662f $\\sum f[k][i][j]\\times[i<j]$\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u53cd\u8f6c\u533a\u95f4\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $\\mathcal O(n^4k)$ \u7684\u8f6c\u79fb\u3002\n\n\u8f6c\u79fb\u7684\u65f6\u5019\u53cd\u8f6c\u533a\u95f4\u5206\u56db\u79cd\uff08\u4e0b\u9762\u6211\u4eec\u9ed8\u8ba4 $i<j$\uff09\n\n- \u4e0d\u5305\u62ec $i,j$\uff0c\u8fd9\u65f6\u8003\u8651\u5de6\u53f3\u7aef\u70b9\u5728 $[1,i),(i,j),(j,n]$ \u7684\u65b9\u6848\u6570\u76f4\u63a5\u7ec4\u5408\u6570\u8ba1\u7b97\u5373\u53ef\uff0c$\\mathcal O(1)$\n- \u53ea\u5305\u62ec $i$\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $i$ \u6700\u540e\u53d8\u5230\u7684\u4f4d\u7f6e $p$\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u77e5\u9053\u53cd\u8f6c\u533a\u95f4\u7684\u5bf9\u79f0\u4e2d\u5fc3\u662f\u54ea\u91cc\uff0c\u8fdb\u4e00\u6b65\u4e0d\u96be\u7b97\u51fa\u65b9\u6848\u6570\u3002\n- \u53ea\u5305\u62ec $j$\uff0c\u540c\u4e0a\u3002\n- \u540c\u65f6\u5305\u62ec $i,j$\uff0c\u8fd9\u6837\u7684\u8bdd\u7ffb\u8f6c\u5b8c\u4e4b\u540e $i^\\prime-j^\\prime=j-i$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8ba9 $i^\\prime=p,j^\\prime=p+i-j$\uff0c\u540c\u6837\u53ef\u4ee5\u7b97\u51fa\u8f6c\u79fb\u7684\u65b9\u6848\u6570\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u79cd $\\mathcal O(n^3k)$ \u7684\u505a\u6cd5\u3002\n\n\u4ece\u8ba9\u8f93\u51fa double \u53ef\u4ee5\u770b\u51fa\u5176\u5b9e $k=10^9$ \u662f\u5047\u7684\u3002\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898 $k$ \u8bbe\u6210 $\\min(k,1000)$ \u5c31\u53ef\u4ee5\u901a\u8fc7\u4e86\u3002\n\n\u4f46\u662f $\\mathcal O(n^3\\min(k,1000))$ \u4e5f\u4e0d\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\uff08\u867d\u7136\u597d\u50cf\u80fd\u8dd1\u8fc7\uff09\u3002\n\n\u6211\u4eec\u9700\u8981\u4f18\u5316\u8f6c\u79fb\u7684\u8fc7\u7a0b\uff0c\u5176\u5b9e\u540e\u4e09\u79cd\u60c5\u51b5\u672c\u8d28\u4e0a\u662f\u7c7b\u4f3c\u7684\uff0c\u4e0b\u9762\u4ee5\u7b2c\u4e8c\u7c7b\u53ea\u5305\u62ec $i$ \u7684\u8f6c\u79fb\u60c5\u51b5\u4e3a\u4f8b\uff1a\n\n\u5728 $p<j$ \u7684\u65f6\u5019\uff0c\u6709 $f[t][i][j]+=f[t-1][i][p]\\times \\min(p-i,n-j+1)$\n\n\u5728 $p\\geq j$ \u7684\u65f6\u5019\uff0c\u6709 $f[t][i][j]+=f[t-1][i][p]\\times \\min(j-i,n-p+1)$\n\n\u6211\u4eec\u89c2\u5bdf\u540e\u9762\u4e58\u7684\u90a3\u4e2a\u500d\u7387\uff0c\u6211\u4eec\u53d1\u73b0\u4e24\u4e2a min \u91cc\u9762\u7684\u65ad\u70b9\u662f\u76f8\u540c\u7684\u3002\n\n\u5728\u7eb8\u4e0a\u753b\u4e00\u753b\u4ed6\u7684\u56fe\u50cf\uff08\u5176\u5b9e\u731c\u4e5f\u80fd\u731c\u5230\uff09\uff0c\u4ed6\u7684\u70b9\u503c\u662f\u957f\u6210\u8fd9\u4e2a\u6837\u5b50\u7684\uff1a\n\n$$0,0,0,\\cdots0,1,2,\\cdots,x-1,x,x,\\cdots,x,x-1\\cdots,2,1,0,\\cdots,0,0,0$$\n\n\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\u6709\u4e24\u4e2a\u70b9\u503c\u591a\u9879\u5f0f $f(x),g(x)$\uff0c\u5176\u4e2d $g(x)$ \u5c31\u662f\u4e0a\u9762\u90a3\u5768\u4e1c\u897f\uff0c\u73b0\u5728\u8981\u5feb\u901f\u6c42 $f(x)g(x)$ \u7684\u70b9\u503c\u4e4b\u548c\u3002\n\n\u8003\u8651\u5bf9\u4e8e $g(x)$ \u4ece\u540e\u5f80\u524d**\u5dee\u5206**\uff0c\u6211\u4eec\u5f97\u5230\u7684\u5e94\u8be5\u662f\n\n$$0,0,0,\\cdots,-1,-1,-1,\\cdots,0,0,0\\cdots,1,1,1,\\cdots,0,0,0$$\n\n\u53d1\u73b0\u5982\u679c $g(x)$ \u957f\u6210\u4e0a\u9762\u8fd9\u4e2a\u6837\u5b50\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u9884\u5904\u7406 $f(x)$ \u7684\u524d\u7f00\u548c\u6765\u89e3\u51b3\u3002\n\n\u56e0\u4e3a\u5dee\u5206\u662f\u524d\u7f00\u548c\u7684\u9006\u8fd0\u7b97\uff0c\u6240\u4ee5\u5728\u539f\u95ee\u9898\u4e2d\uff0c\u6211\u4eec\u76f4\u63a5\u9884\u5904\u7406 $f(x)$ \u7684**\u4e8c\u9636\u524d\u7f00\u548c**\u5373\u53ef\u3002\n\n\u4e00\u822c\u7684\uff0c\u8bbe $s_2[i]$ \u4e3a $f(x)$ \u7684\u4e8c\u9636\u524d\u7f00\u548c\uff0c\n\n$$g(x)=0,0,0(a),\\cdots0,1,2,\\cdots,x-1,x(b),x,\\cdots,x(c),x-1\\cdots,2,1(d),0,\\cdots,0,0,0$$\n\n\u7684\u7b54\u6848\u662f $s_2[d]-s_2[c-1]-s_2[b-1]+s_2[a-1]$\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5 $\\mathcal O(1)$ \u8f6c\u79fb\u7b2c\u4e8c\u7c7b\u533a\u95f4\u4e86\u3002\n\n****\n\n\u5bf9\u4e8e\u7b2c\u4e09\u7c7b\u533a\u95f4\uff0c\u540c\u7406\u3002\n\n\u5bf9\u4e8e\u7b2c\u56db\u7c7b\u533a\u95f4\uff0c\u6211\u4eec\u9884\u5904\u7406 $i-j$ \u76f8\u540c\u7684\u70b9\u7684\u4e8c\u9636\u524d\u7f00\u548c\u3002\n\n$\\mathcal O(n^2\\min(k,1000))$\n\n~~\u4ee3\u7801\u8fd8\u662f\u975e\u5e38\u7f8e\u89c2\u7684~~\n\n```cpp\nint n,k;\nint a[N];\ndb f[2][N][N];\ndb sum1[N][N],sum2[N][N],sum3[N][N];\ndb ans;\n\nint calc(int x){\n    return x*(x+1)/2;\n}\n\nint main()\n{\n    # ifdef hibike\n    freopen(\"testdata.in\",\"r\",stdin);\n    freopen(\"test1.out\",\"w\",stdout);\n    # endif\n    read(n),read(k),k=min(k,1000);\n    Rep(i,1,n)read(a[i]);\n    int x=0;\n    Rep(i,1,n)Rep(j,i+1,n)if(a[i]>a[j])f[x][i][j]=1;\n    Rep(i,1,n)Rep(j,i+1,n)f[x][j][i]=1-f[x][i][j];\n    Rep(qwq,1,k){\n        x^=1;\n        Rep(i,0,n)Rep(j,0,n)sum1[i][j]=sum2[i][j]=sum3[i][j]=f[x][i][j]=0;\n        Rep(i,1,n)Rep(j,1,n)sum1[i][j]=f[x^1][i][j];\n        Rep(j,1,n)Rep(i,1,n)sum2[j][i]=f[x^1][i][j];\n        Rep(i,1,n)Rep(j,1,i-1)sum3[i-j][i]=f[x^1][i][j];\n        Rep(i,1,n)Rep(j,1,n)sum1[i][j]+=sum1[i][j-1];\n        Rep(j,1,n)Rep(i,1,n)sum2[j][i]+=sum2[j][i-1];\n        Rep(i,1,n)Rep(j,1,n)sum3[i][j]+=sum3[i][j-1];\n        Rep(i,1,n)Rep(j,1,n)sum1[i][j]+=sum1[i][j-1];\n        Rep(j,1,n)Rep(i,1,n)sum2[j][i]+=sum2[j][i-1];\n        Rep(i,1,n)Rep(j,1,n)sum3[i][j]+=sum3[i][j-1];\n        Rep(i,1,n)\n            Rep(j,i+1,n){\n                f[x][i][j]+=f[x^1][i][j]*(calc(i-1)+calc(j-i-1)+calc(n-j));\n                f[x][i][j]+=sum1[i][n]-sum1[i][n+i-j]-sum1[i][j-1]+sum1[i][i-1];\n                f[x][i][j]+=sum2[j][j-1]-sum2[j][j-i-1]-sum2[j][i-1];\n                f[x][i][j]+=sum3[j-i][n]-sum3[j-i][n-i]-sum3[j-i][j-1];\n                f[x][i][j]/=calc(n);\n                f[x][j][i]=1-f[x][i][j];\n            }\n    }\n    // Rep(i,1,n)Rep(j,1,n)printf(\"%.2lf%c\",f[x][i][j],j==n?'\\n':' ');\n    Rep(i,1,n)Rep(j,i+1,n)ans+=f[x][i][j];\n    printf(\"%.10lf\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1629344303,
        "uid": 97344,
        "name": "devout",
        "ccfLevel": 9,
        "title": "CF513G3 Inversions problem"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](/problem/CF513G3)\n\n**\u672c\u6587\u4e3b\u8981\u4e25\u8c28\u5730\u8bc1\u660e $k$ \u8d8a\u5927\u7b54\u6848\u7684\u53d8\u5316\u8d8a\u5c0f\u8fd9\u4e2a\u7ed3\u8bba\u3002\u5341\u5206\u611f\u8c22 @[StarLbright40](/user/128570) @[zhjxaoini](/user/120026) \u5728[\u8ba8\u8bba\u533a](/discuss/613707)\u4e0e\u6211\u7684\u8ba8\u8bba\u548c\u5bf9\u601d\u8def\u7684\u63d0\u4f9b\uff01**\n\n\u505a\u6cd5\u548c\u5176\u4ed6\u9898\u89e3\u7c7b\u4f3c\uff0c\u7528 $f_{t,i,j}$ \u8868\u793a $t$ \u6b65\u540e\u4f4d\u7f6e $(i,j)$ \u6709\u4e00\u5bf9\u8d21\u732e\u7684\u6982\u7387\u3002\u8bb0 $p_i'$ \u8868\u793a $i$ \u8fd9\u4e2a\u6570\u5728 $p$ \u4e2d\u7684\u4f4d\u7f6e\uff0cdp \u8fb9\u754c\u4e3a\u5bf9\u4e8e\u6bcf\u4e00\u5bf9\u6ee1\u8db3 $x>y$ \u7684\u6570 $(x,y)$\uff0c$f_{0,p_x',p_y'}=1$\u3002\u6700\u7ec8\u7684\u7b54\u6848\u4e3a $\\sum_{i<j}f_{k,i,j}$\u3002\u8f6c\u79fb\u65f6\u53ef\u679a\u4e3e\u533a\u95f4\uff0c\u7136\u540e\u89c2\u5bdf\u5230 $(i,j)$ \u53ef\u80fd\u5230\u8fbe\u7684\u4e0b\u4e00\u4e2a\u72b6\u6001\u53ea\u6709 $\\mathcal O(n)$ \u79cd\u53ef\u80fd\uff0c\u53ef\u4ee5\u4f18\u5316\u5230 $\\mathcal O(n^3k)$\uff0c\u5f0f\u5b50\u5199\u51fa\u6765\u518d\u7528\u524d\u7f00\u548c\u4f18\u5316\u53ef\u4ee5\u505a\u5230 $\\mathcal O(n^2k)$\u3002\n\n\u8003\u8651\u7ed3\u8bba\uff1a$k\\rightarrow+\\infty$ \u65f6\uff0c\u6240\u6709\u7684 $f_{k,i,j}$ \u8d8b\u5411\u4e8e\u76f8\u7b49\u3002\u6709\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u540e\uff0c\u53ef\u4ee5\u5199\u4e2a\u66b4\u529b\u8dd1\u8dd1\u770b\u5728 $k$ \u5927\u4e8e\u591a\u5c11\u540e $f$ \u7684\u53d8\u5316\u5c0f\u4e8e $10^{-9}$\uff0c\u53d1\u73b0\u8fd9\u4e2a\u503c\u5927\u7ea6\u5728 $1000$\uff0c\u6240\u4ee5\u53ef\u4ee5 $k\\leftarrow\\min(k,1000)$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^2\\min(k,1000))$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\u4e0b\u9762\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u3002\n\n\u8fd9\u4e2a dp \u53ef\u4ee5\u62bd\u8c61\u6210\u4e00\u4e2a\u6709 $n^2$ \u4e2a\u70b9\uff0c$\\mathcal O(n^3)$ \u6761\u8fb9\u7684\u56fe\uff0c\u6bcf\u6761\u8fb9\u4e0a\u6709\u4e00\u4e2a $[0,1]$ \u7684\u6743\u503c\u3002\u8bb0 $p_{k,x,y,i,j}$ \u8868\u793a\u4ece $(x,y)$ \u8d70 $k$ \u6b65\uff0c\u6bcf\u4e00\u6b65\u8d70\u67d0\u6761\u8fb9\u7684\u6982\u7387\u5c31\u662f\u8fd9\u6761\u8fb9\u7684\u6743\u503c\uff0c\u6700\u7ec8\u5230\u8fbe $(i,j)$ \u7684\u6982\u7387\u3002\u90a3\u4e48 $f_{k,i,j}$ \u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e00\u5bf9\u6ee1\u8db3 $f_{0,x,y}=1$ \u7684\u70b9\u5bf9 $(x,y)$\uff0c$p_{k,x,y,i,j}$ \u7684\u548c\u3002\u4e0b\u9762\u628a\u4e00\u5bf9\u6570 $(x,y)$ \u76f4\u63a5\u770b\u505a\u56fe\u4e0a\u7684\u4e00\u4e2a\u70b9 $u$\uff08\u4e8e\u662f\u4e0a\u9762 $p_{k,x,y,i,j}$ \u7684\u5b9a\u4e49\u5c31\u53d8\u4e3a\u4e86 $p_{k,u,v}$\uff09\u3002\n\n\u6211\u4eec\u53ea\u9700\u8981\u8bc1\u660e $k\\rightarrow+\\infty$ \u65f6\uff0c\u5bf9\u4e8e\u4efb\u4f55\u70b9 $u$\uff0c\u6240\u6709\u7684 $p_{k,u,v}$ \u8d8b\u5411\u4e8e\u76f8\u7b49\u3002\u4e5f\u5c31\u662f\uff0c\u5bf9\u4e8e\u56fe\u4e0a\u7684\u4efb\u610f\u4e00\u70b9\u4f5c\u4e3a\u8d77\u70b9\uff0c\u8d70\u65e0\u9650\u591a\u6b65\uff0c\u6700\u7ec8\u5230\u8fbe\u6bcf\u4e2a\u70b9\u7684\u6982\u7387\u8d8b\u5411\u4e8e\u76f8\u7b49\u3002\n\n\u7531\u4e8e\u56fe\u4e0a\u6bcf\u4e2a\u70b9\u90fd\u5b58\u5728\u81ea\u73af\uff0c\u4e14\u56fe\u8fde\u901a\uff0c\u90a3\u4e48\u5fc5\u7136\u5b58\u5728\u4e00\u4e2a\u5e38\u6570 $c$\uff0c\u6ee1\u8db3\u4ece\u4efb\u4f55\u70b9 $x$ \u51fa\u53d1\uff0c\u8d70 $c$ \u6b65\u5230\u8fbe\u7684\u70b9 $y$ \u53ef\u4ee5\u662f\u4efb\u4f55\u4e00\u4e2a\u70b9\uff0c\u5373 $\\forall x,y,p_{c,x,y}>0$\u3002\n\n\u6211\u4eec\u56fa\u5b9a\u4e00\u4e2a\u8d77\u70b9 $u$\uff0c\u8bb0 $L_k=\\min_v\\{p_{k,u,v}\\},R_k=\\max_v\\{p_{k,u,v}\\}$\u3002\u6211\u4eec\u53ea\u8981\u8bc1 $k\\rightarrow+\\infty$ \u65f6 $R_k-L_k\\rightarrow0$\u3002\n\n\u8003\u8651\u67d0\u4e2a $L_k<R_k$ \u7684\u65f6\u523b $k$\uff0c\u53d6\u4e00\u4e2a\u6ee1\u8db3 $p_{k+c,u,y}=L_{k+c}$ \u7684 $y$\uff0c\u6211\u4eec\u6709\uff1a\n$$L_{k+c}=p_{k+c,u,y}=\\sum_xp_{k,u,x}p_{c,x,y}$$\n\u4e0d\u59a8\u653e\u7f29\u4e00\u4e0b\uff0c\u6240\u6709 $<R_k$ \u7684 $p_{k,u,x}$ \u90fd\u770b\u6210 $L_k$\uff0c\u8fd9\u6837\u6211\u4eec\u6709\uff1a\n$$L_{k+c}\\ge L_k\\sum_{p_{k,u,x}<R_k}p_{c,x,y}+R_k\\sum_{p_{k,u,x}=R_k}p_{c,x,y}$$\n\u8fd9\u4e2a\u5f0f\u5b50\u5f62\u5982\n$$L_{k+c}\\ge sL_k+(1-s)R_k$$\n\u56e0\u4e3a $\\forall x,y,p_{c,x,y}>0$\uff0c\u6240\u4ee5 $0<s<1$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\n$$L_{k+c}-L_k\\ge(1-s)(R_k-L_k)$$\n\u540c\u7406\u53ef\u5f97\n$$R_k-R_{k+c}\\ge(1-t)(R_k-L_k)\\quad(0<t<1)$$\n\u4e24\u5f0f\u76f8\u52a0\uff0c\u5f97\n$$R_{k+c}-L_{k+c}\\le(s+t-1)(R_k-L_k)$$\n\u8fd9\u6837 $k$ \u6bcf\u589e\u52a0 $c$ \u65f6\uff0c\u533a\u95f4\u957f\u5ea6 $R_k-L_k$\uff08\u81f3\u5c11\uff09\u4f1a\u4e58\u4e0a\u4e00\u4e2a\u56fa\u5b9a\u7684\u6bd4\u4f8b $r=s+t-1$\u3002\u56e0\u4e3a $R_{k+c}\\ge L_{k+c}$ \u4e14 $s,t<1$\uff0c\u6240\u4ee5 $0\\le r<1$\uff0c\u6240\u4ee5 $r^N$ \u5728 $N\\rightarrow+\\infty$ \u65f6\u6536\u655b\u4e8e $0$\uff0c\u6240\u4ee5 $k\\rightarrow+\\infty$ \u65f6 $R_k-L_k\\rightarrow0$\u3002\n\n\u5f97\u8bc1\u3002",
        "postTime": 1685359521,
        "uid": 150522,
        "name": "b6e0_",
        "ccfLevel": 9,
        "title": "CF513G3 Inversions problem \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9898\u5f88\u4e71\u641e\u3002\n\n\u8bbe $f_{t,i,j}$ \u4e3a $t$ \u6b21\u64cd\u4f5c\u540e $p_i>p_j$ \u7684\u6982\u7387\u3002\n\n\u6bcf\u6b21\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u7ffb\u8f6c\u7684\u533a\u95f4\uff0c\u8fd9\u6837\u662f $O(kn^4)$ \u7684\u3002\n\n\u7136\u800c\u6253\u8868\u53d1\u73b0\u6bcf\u4e2a\u70b9\u53ea\u6709 $O(n)$ \u4e2a\u8f6c\u79fb\u70b9\uff0c\u6240\u4ee5\u521d\u59cb $O(n^4)$ \u66b4\u529b\u9884\u5904\u7406\u4e00\u4e0b\u8f6c\u79fb\u70b9\u548c\u8f6c\u79fb\u7cfb\u6570\uff0c\u5c31\u53ef\u4ee5 $O(kn^3)$\u3002\n\n\u7136\u540e\u53d1\u73b0\u6bcf\u4e2a\u4f4d\u7f6e\u5728\u8fdb\u884c\u82e5\u5e72\u8f6e dp \u540e\u5c31\u4f1a\u8d8b\u8fd1\u4e8e\u67d0\u4e2a\u503c\uff0c\u6240\u4ee5\u56fa\u5b9a\u8fed\u4ee3\u6b21\u6570\uff0c\u5373\u5c06 $k$ \u4e0e\u8fed\u4ee3\u8f6e\u6570\u53d6 $\\min$\uff0c\u7136\u540e\u82e5\u4e00\u4e2a\u4f4d\u7f6e\u5728\u8fd9\u4e00\u8f6e\u4e0e\u4e0a\u4e00\u8f6e\u7684\u5dee $<10^{-15}$ \u5c31\u505c\u6b62\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u8f6c\u79fb\u3002\n\n\u5c31\u53ef\u4ee5\u4e86\u3002\n\n[CF \u8bc4\u6d4b\u8bb0\u5f55\u3002](https://codeforces.com/contest/513/submission/180411099)",
        "postTime": 1668132255,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF513G3 Inversions problem"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u81ea[CF513G3 Inversions problem](https://www.cnblogs.com/dixiao/p/14866290.html)\u3002\n\n\u8003\u8651\u8bb0 $f_{i,j,k}$ \u4e3a $k$ \u6b21\u64cd\u4f5c\u540e\uff0c $(i,j)$ \u4f4d\u7f6e\u88ab\u8c03\u6362\u7684\u6982\u7387\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6211\u4eec\u8981\u7b97\u7684\u7b54\u6848\u5373 $(x,y)$ \u3002\n\n\u90a3\u4e48\u6709 $\\frac{n * (n + 1)}{2}$ \u79cd\u8c03\u6362\u987a\u5e8f\u3002\n\n\u4ee5\u6b64\u5206\u7c7b\u8ba8\u8bba:\n\n\u4e00\uff1a\u4e0d\u76f8\u4ea4\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/f8aw8esu.png)\n\n\u5bf9\u7b54\u6848\u4e0d\u4ea7\u751f\u5f71\u54cd\u3002\n\n\u4e8c\uff1a\u5305\u542b\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/30loapx0.png)\n\n\u56e0\u4e3a\u662f\u53cd\u8f6c\u64cd\u4f5c\uff0c\u8003\u8651\u679a\u4e3e\u679a\u4e3e\u7ffb\u8f6c\u79fb\u52a8\u7684\u8ddd\u79bb\uff0c\u4ece $f_{i + q,j + q,k - 1}$ \u8f6c\u79fb\u8fc7\u6765\u3002\n\n\u4e09\uff1a\u7aef\u70b9\u76f8\u4ea4\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dr1ohtl6.png)\n\n\u540c\u6837\u8003\u8651\u679a\u4e3e\u53cd\u8f6c\u8ddd\u79bb \uff0c\u4ece $f_{i + q,j,k - 1}$\u8fd8\u6709$f_{i,j + q,k - 1}$ \u3002\n\n\u5229\u7528\u524d\u7f00\u548c\u53ef\u4ee5\u505a\u5230 $O(k n^2)$ \u3002\n\n\u7531\u4e8e\u662f\u5b9e\u6570\u8fd0\u7b97\uff0c\u6240\u4ee5\u5728 $k$ \u589e\u5927\u7684\u8fc7\u7a0b\u4e2d\uff0c $\\Delta ans\\to 0$ ,\u6240\u4ee5\u6211\u4eec\u53d6\u4e00\u4e2a\u6570\u636e\u8303\u56f4\u80fd\u591f\u5bb9\u5fcd\u7684\u5927\u6570 $k$ \u4f5c\u4e3a\u7b54\u6848\uff0c\u5b9e\u6d4b $k = 900$ \u6548\u679c\u5f88\u4e0d\u9519\u3002\n\n\n```\n// code by fhq_treap\n#include<bits/stdc++.h>\n#define ll int\n#define N 200\n\ninline ll read(){\n    char C=getchar();\n    ll A=0 , F=1;\n    while(('0' > C || C > '9') && (C != '-')) C=getchar();\n    if(C == '-') F=-1 , C=getchar();\n    while('0' <= C && C <= '9') A=(A << 1)+(A << 3)+(C - 48) , C=getchar();\n    return A*F;\n}\n\nll n,k;\nll num[N];\ndouble dp[N][N],tmp[N][N];\n\ndouble calc(int x){return (double)(x) * (double)(x + 1) / 2;}\n\nint main(){\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i = 1;i <= n;++i)\n\tscanf(\"%d\",&num[i]);\n//\tfor(int i = 1;i <= n;++i)\n//\tfor(int j = i + 1;j <= n;++j)\n//\tdp[i][j] = 1.0;\n\tk = std::min((ll)900,k);\n\tdouble tot = (n + 1) * n / 2;\n\tfor(int m = 1;m <= k;++m){\n\tfor(int i = 1;i <= n;++i)\n\tfor(int j = 1;j <= n;++j)\n\ttmp[i][j] = 0;\n\tfor(int i = 1;i <= n;++i)\n\tfor(int j = i + 1;j <= n;++j){\n\t\ttmp[i][j] = dp[i][j] * (calc(i - 1) + calc(j - i - 1) + calc(n - j)) / tot;\n//        std::cout<<i<<\" \"<<j<<\" \"<<tmp[i][j]<<\" \"<<(calc(i - 1) + calc(j - i + 1) + calc(n - j))<<std::endl;\n\t\t//i,j\n\t\tfor(int q = 1 - i;q + j <= n;++q)\n\t\ttmp[i][j] += (1 - dp[i + q][j + q]) * std::min(std::min(i,i + q),n - std::max(j,j + q) + 1) / tot;\n//\t    std::cout<<i<<\" \"<<j<<\" \"<<tmp[i][j]<<std::endl;\n\t\t//i\n\t\tfor(int q = 1 - i;q < j - i;++q)\n\t\ttmp[i][j] += dp[i + q][j] * std::min(std::min(i,i + q),j - std::max(i,i + q)) / tot;\n//\t    std::cout<<i<<\" \"<<j<<\" \"<<tmp[i][j]<<std::endl;\n\t\t//j\n\t\tfor(int q = i - j + 1;q + j <= n;++q)\n\t\ttmp[i][j] += dp[i][j + q] * std::min(std::min(j,j + q) - i,n - std::max(j + q,j) + 1) / tot;\n//\t    std::cout<<i<<\" \"<<j<<\" \"<<tmp[i][j]<<std::endl;\n\t}\n\tstd::memcpy(dp,tmp,sizeof(tmp));\n//\tfor(int i = 1;i <= n + 1;++i,puts(\"\"))\n//\tfor(int j = i + 1;j <= n;++j)\n//\tstd::cout<<dp[i][j]<<' ';\n\t}\n \tdouble ans = 0.0;\n\tfor(int i = 1;i <= n;++i)\n\tfor(int j = i + 1;j <= n;++j){\n\t\tif(num[i] < num[j])ans += dp[i][j];\n\t\telse\n\t\tans += 1 - dp[i][j];\n\t}\n\tstd::printf(\"%.10f\",ans);\n}\n\n\n\n```",
        "postTime": 1623211170,
        "uid": 138390,
        "name": "fhq_treap",
        "ccfLevel": 7,
        "title": "CF513G3 Inversions problem"
    }
]