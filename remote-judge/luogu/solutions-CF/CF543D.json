[
    {
        "content": "\u9996\u5148\uff0c\u770b\u5230\u6bcf\u4e2a\u9996\u90fd\uff0c\u60f3\u5230\u6362\u6839 dp\u3002\n\n\u5148\u8003\u8651\u6307\u5b9a $1$ \u4e3a\u6839\u65f6\u600e\u4e48\u505a\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u5bb9\u6613\u7684\u8f6c\u5316\uff0c\u5c31\u662f\u8f6c\u5316\u4e3a\u4e00\u5f00\u59cb\u5168\u662f\u597d\u7684\uff0c\u6839\u5230 \u53f6\u8282\u70b9\u53ea\u80fd\u6709\u4e00\u4e2a\u53d8\u574f\u3002\n\n\u8bbe $f[u][0/1]$ \u8868\u793a $u$ \u5b50\u6811\uff0c$1$ \u4e3a\u5df2\u7ecf\u6709\u53d8\u574f\u7684\uff0c$0$ \u4e3a\u6ca1\u6709\u3002\u8f6c\u79fb\u4e3a\uff1a\n\n$$f[leaf][0]=1,f[leaf][1]=0$$\n\n$$f[u][0]=\\prod f[v][0]$$\n\n$$f[u][1]=\\prod (f[v][0]+f[v][1]+f[v][0])-1$$\n\n$$ans=f[root][0]+f[root][1]$$\n\n\u7b2c\u4e09\u4e2a\u65b9\u7a0b\u89e3\u91ca\u4e00\u4e0b\uff0c\u5c31\u662f\u5bf9\u4e8e\u4e00\u4e2a\u5b50\u6811\uff0c\u5982\u679c\u4e0d\u53d8\u8fde\u63a5\u8fb9\uff0c\u91cc\u9762\u968f\u4fbf\uff0c\u53d8\u4e86\u7684\u8bdd\u91cc\u9762\u53ea\u80fd\u6ca1\u53d8\u8fc7\uff0c\u6700\u540e\u5982\u679c\u90fd\u9009\u62e9\u4e0d\u53d8\u4e5f\u4f1a\u8ba1\u5165\u5176\u4e2d\uff0c\u6240\u4ee5\u8981\u51cf\u4e00\u3002\n\n\u7136\u540e\u770b\u7740\u8fd9\u4e2a\u65b9\u7a0b\u53d1\u73b0\uff0c$f[u][0]$ \u6052\u7b49\u4e8e $1$\uff0c\u6570\u5b66\u4e0a\u89e3\u91ca\u5c31\u662f $1^n=1$\uff0c\u4ece\u5b9e\u9645\u4e0a\u89e3\u91ca\u5c31\u662f\u90fd\u4e0d\u53d8\u53ea\u6709\u4e00\u79cd\u65b9\u6848\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5316\u7b80\u8fd9\u4e2a\u65b9\u7a0b\uff1a\n\n$f[u]$ \u8868\u793a $f[u][0]+f[u][1]$\u3002\n\n$$f[leaf]=1$$\n\n$$f[u]=\\prod (f[v]+1)$$\n\n\u8fd9\u4e2a\u65b9\u7a0b\u7b80\u5355\u7684\u591a\uff0c\u53ef\u4ee5\u8003\u8651\u6362\u6839\u4e86\u3002\n\n\u8bbe $g[i]$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u7b54\u6848\u3002\n\n$$g[1]=f[1]$$\n\n$$g[v]=f[v]\\times (\\frac{g[u]}{f[v]+1}+1)$$\n\n\u7136\u540e\u6ce8\u610f $f[v]+1$ \u53ef\u80fd\u6ca1\u6709\u9006\u5143\uff0c\u9700\u8981\u7279\u6b8a\u5904\u7406\u3002",
        "postTime": 1613437049,
        "uid": 196899,
        "name": "lndjy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.org/problem/CF543D)\n\n**\u9996\u5148\uff0c\u8003\u8651\u5f53\u6839\u56fa\u5b9a\u65f6\u672c\u9898\u600e\u4e48\u505a\u3002**\n\n~~\u770b\u5230\u7b54\u6848\u8fd9\u4e48\u5927\uff0c\u663e\u7136\u662fDP\u4e0d\u7528\u8bf4\u4e86\u5427~~\n\n\u8bbe$F(i)$\u8868\u793a\u4ee5$i$\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6539\u826f\u9053\u8def\u7684\u65b9\u6848\u6570\uff0c\u8003\u8651\u5982\u4f55\u8f6c\u79fb\n\n\u5f53i\u4e3a\u53f6\u5b50\u8282\u70b9\u65f6\uff0c\u6ca1\u6709\u53ef\u4ee5\u6539\u5584\u7684\u9053\u8def\uff0c\u6240\u4ee5$F(i)=1$\n\n\u679a\u4e3e$i$\u7684\u6bcf\u4e00\u4e2a\u5b50\u6811\uff0c\u8bbe\u5f53\u524di\u7684\u5b50\u6811\u4e3a$j$\n\n\u82e5$i$\u5230$j$\u8fd9\u6761\u8def\u4e0d\u6539\u5584\uff0c\u5219i\u7684\u5b50\u6811\u4e2d\u7684\u9053\u8def\u5fc5\u987b\u5168\u90e8\u7ef4\u4fee\uff0c\u65b9\u6848\u6570\u4e3a$1$\n\n\u82e5$i$\u5230$j$\u8fd9\u6761\u8def\u6539\u5584\uff0c\u5219\u663e\u7136\u65b9\u6848\u6570\u4e3a$F(j)$\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u7531\u4e58\u6cd5\u539f\u7406\u53ef\u5f97$F(i)=\\prod\\limits_{j\\in son(i)}(F(j)+1)$\n\n**\u90a3\u4e48\u5f53\u6839\u4e0d\u56fa\u5b9a\u65f6\uff0c\u7b54\u6848\u5e94\u8be5\u5982\u4f55\u8ba1\u7b97\u5462\uff1f**\n\n\u53d1\u73b0\u5f53\u6839\u4ece$i$\u53d8\u6210$i$\u7684\u67d0\u4e2a\u5b69\u5b50$j$\u65f6\uff0c\u53ea\u6709$F(i)$\u548c$F(j)$\u53d1\u751f\u4e86\u53d8\u5316\u3002\n\n\u8bbe$F'(i)$\u8868\u793a\u6839\u53d8\u5316\u540e$F(i)$\u7684\u503c\uff0c\u5219\n\n$F'(i)=\\prod\\limits_{k\\in son(i),k\\neq j}(F(k)+1)  $&#8195;$F'(j)=F(j)(F(i)+1)$\n\n\u524d\u9762\u7684\u5f0f\u5b50\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u524d\u7f00\u79ef/\u540e\u7f00\u79ef\u6c42\u51fa\u3002\n\n\uff08\u5982\u679c\u76f4\u63a5\u4e58\u9006\u5143\u53ef\u80fd\u4f1a\u78b0\u52300\u4e0d\u5b58\u5728\u9006\u5143\u7684\u60c5\u51b5\uff09\n\n**\u8fd9\u5c31\u662f\u6362\u6839DP\u7684\u601d\u60f3\u3002**\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <iostream>\n#include <algorithm>\n#include <vector>\n#define M 1000005\n#define mod 1000000007ll\nusing namespace std;\nint n,nxt[M],head[M],to[M],tot;\nlong long F[M],ans[M];\nvector <long long> F1[M],F2[M];//\u7528vector\u8bb0\uff0c\u9632\u6b62MLE\nint read(){//\u5feb\u8bfb\n\tchar c=getchar();int ans=0;\n\twhile (c<'0'||c>'9') c=getchar();\n\twhile (c>='0'&&c<='9') ans=(ans<<1)+(ans<<3)+(c^48),c=getchar();\n\treturn ans;\n}\nvoid add(int u,int v){//\u52a0\u8fb9\uff08\u53cc\u5411\u8fb9\uff09\n\tnxt[++tot]=head[u];head[u]=tot;to[tot]=v;\n\tnxt[++tot]=head[v];head[v]=tot;to[tot]=u;\n\treturn;\n}\nvoid dfs1(int x,int fa){//\u5148\u9884\u5904\u7406F\u6570\u7ec4\n\tF[x]=1;\n\tfor (register int i=head[x];i;i=nxt[i])\n\t\tif (to[i]!=fa) dfs1(to[i],x),F[x]=F[x]*(F[to[i]]+1)%mod;\n\treturn;\n}\nvoid dfs2(int x,int fa){//\u6362\u6839DP\n\tans[x]=1;\n\tfor (register int i=head[x];i;i=nxt[i]){\n\t\tans[x]=ans[x]*(F[to[i]]+1)%mod;\n\t\tif (to[i]!=fa) F1[x].push_back(F[to[i]]+1),F2[x].push_back(F[to[i]]+1);\n\t}//F1\u8868\u793a\u524d\u7f00\u79ef\uff0cF2\u8868\u793a\u540e\u7f00\u79ef\n\tfor (register int i=1;i<F1[x].size();i++) F1[x][i]=F1[x][i]*F1[x][i-1]%mod;\n\tfor (register int i=F2[x].size()-2;i>=0;i--) F2[x][i]=F2[x][i]*F2[x][i+1]%mod;\n\tint cnt=0;\n\tfor (register int i=head[x];i;i=nxt[i]){\n\t\tif (to[i]==fa) continue;F[x]=(fa?F[fa]+1:1);\n\t\tif (cnt>0) F[x]=F[x]*F1[x][cnt-1]%mod;//\u9632\u6b62\u8d8a\u754c\n\t\tif (cnt<F2[x].size()-1) F[x]=F[x]*F2[x][cnt+1]%mod;//\u9632\u6b62\u8d8a\u754c\n\t\tdfs2(to[i],x);++cnt;\n\t}\n\treturn;\n}\nint main(){\n\tn=read();\n\tfor (register int i=2;i<=n;i++) add(read(),i);\n\tdfs1(1,0);dfs2(1,0);\n\tfor (register int i=1;i<=n;i++) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n```\n\n\u5982\u679c\u6709\u5e2e\u52a9\u5c31\u70b9\u4e2a\u8d5e\u5427~ ",
        "postTime": 1570709013,
        "uid": 40985,
        "name": "Binary_Search_Tree",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u9897 $ n $ \u4e2a\u70b9\u7684\u65e0\u6839\u6811\uff0c\u5f53\u628a\u4e00\u4e2a\u70b9 $ x $ \u8bbe\u7f6e\u4e3a\u9996\u90fd\u65f6\uff0c\u8981\u6c42\u4ece $ x $ \u5230\u4efb\u610f\u522b\u7684\u70b9\u7684\u8def\u5f84\u4e0a\u6709\u4e0d\u8d85\u8fc7 $ 1 $ \u6761\u672a\u7ef4\u4fee\u7684\u8fb9\uff0c\u73b0\u5728\u95ee\u4f60\u5f53\u6bcf\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u9996\u90fd\u7684\u7ef4\u4fee\u65b9\u6848\u6570\u3002\n\n## \u601d\u8def\n\n\u5148\u8003\u8651\u8bbe\u7f6e\u4e86\u9996\u90fd\u4e3a $ x $\uff0c\u90a3\u5b83\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u6811\u5f62 dp\uff0c\u4ee4 $ dp_u $ \u8868\u793a\u4ee5 $ u $ \u4e3a\u6839\u7684\u5b50\u6811\u5185\u6ee1\u8db3\u6761\u4ef6\u7684\u7ef4\u4fee\u65b9\u6848\uff0c\u53ef\u4ee5\u53d1\u73b0\u5982\u679c $ u \\rightarrow v $ \u7684\u8fd9\u6761\u8fb9\u4e0d\u7ef4\u4fee\u7684\u8bdd\uff0c\u90a3\u4e48\u4ee5 $ v $ \u4e3a\u6839\u7684\u5b50\u6811\u5185\u7684\u6240\u6709\u8fb9\u90fd\u5fc5\u987b\u7ef4\u4fee\uff0c\u5e76\u4e14\u6240\u6709 $ u $ \u7684\u513f\u5b50 $ v $ \u662f\u4e92\u4e0d\u5f71\u54cd\u7684\u3002\u6240\u4ee5\u5f97 dp \u65b9\u7a0b\uff1a\n\n$ dp_u \\leftarrow \\prod_{ v \\in son_u} (dp_v + 1) $\n\n\u4f46\u662f\u8fd9\u53ea\u662f\u786e\u5b9a\u6839\u540e\u7684\u505a\u6cd5\uff0c\u6570\u636e\u8303\u56f4\uff1a\n\n$ n \\leq 2 \\cdot 10^5 $\n\n\u6240\u4ee5\u6211\u4eec\u663e\u7136\u4e0d\u80fd\u679a\u4e3e\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u6839\u3002\n\n\u8fd9\u65f6\u5019\u5c31\u8981\u6362\u6839 dp\u3002\u8003\u8651\u5f53\u6839\u8282\u70b9\u4ece $ u $ \u53d8\u4e3a\u513f\u5b50 $ v $ \u65f6\uff1a\n\n- \u5bf9\u4e8e $ u $ \u5c31\u662f\u5c11\u4e86\u4e00\u9897\u5b50\u6811\uff0c\u6240\u4ee5 $ dp_u \\leftarrow \\prod_{ k \\in son_u} (dp_k + 1)  (k \\neq v) $\u3002\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u80fd\u7528\u9006\u5143\uff0c\u53ea\u80fd\u7528\u524d\u540e\u7f00\u79ef\uff0c\u56e0\u4e3a $ 0 $ \u6ca1\u6709\u9006\u5143\u3002\n\n- \u5bf9\u4e8e\u513f\u5b50 $ v $\uff0c\u5c31\u662f\u591a\u4e86\u5b83\u7236\u4eb2\u8fd9\u9897\u5b50\u6811\uff0c\u6240\u4ee5 $ dp_v \\leftarrow dp_v \\cdot (dp_u+1) $\uff0c\u8fd9\u91cc\u7684 $ dp_u $ \u5f53\u7136\u5c31\u662f\u53d8\u66f4\u540e\u7684\u4e86\u3002\n\n\u5177\u4f53\u770b\u4ee3\u7801\u5b9e\u73b0\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>//\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01\n\nusing namespace std;\n\nconst int maxn=2e5+5;\nconst int mod=1e9+7;\nstruct edge{\n\tint to,nxt;\n}e[maxn<<1];\nint head[maxn],len;\nint dp[maxn],res[maxn];\nvector<int> pre[maxn],suf[maxn];\n\ninline void init(){\n\tmemset(head,-1,sizeof(head));\n\tlen=0;\n}\nvoid add(int u,int v){\n\te[++len].to=v;\n\te[len].nxt=head[u];\n\thead[u]=len;\n}\n\nvoid dfs1(int u,int fa){\n\tdp[u]=1;\n\tfor(int i=head[u];i!=-1;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==fa) continue;\n\t\tdfs1(v,u);\n\t\tdp[u]=(1ll*dp[u]*(dp[v]+1))%mod;\n\t}\n}\nvoid dfs2(int u,int fa){\n\tres[u]=dp[u];\n\tfor(int i=head[u];i!=-1;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\t// if(v==fa) continue;\n\t\t// res[u]=1ll*res[u]*(dp[v]+1)%mod;\n\t\tpre[u].push_back((dp[v]+1));\n\t\t// printf(\"jjjjjjjjjjjjjj%d %d\\n\",v,dp[v]+1);\n\t\tsuf[u].push_back((dp[v]+1));\n\t}\n\t// reverse(suf[u].begin(),suf[u].end());\n\tint lpre=pre[u].size(),lsuf=suf[u].size();\n\tfor(int i=1;i<lpre;i++) pre[u][i]=1ll*pre[u][i-1]*pre[u][i]%mod;\n\tfor(int i=lsuf-2;i>=0;i--) suf[u][i]=1ll*suf[u][i+1]*suf[u][i]%mod;\n\tint j=0;\n\tfor(int i=head[u];i!=-1;i=e[i].nxt,j++){\n\t\tint v=e[i].to;\n\t\tif(v==fa) continue;\n\t\t// if(u==2){\n\t\t\t// for(int k=0;k<(int)pre[u].size();k++) printf(\"%d \",pre[u][k]);\n\t\t\t// puts(\"\");\n\t\t\t// for(int k=0;k<(int)suf[u].size();k++) printf(\"%d \",suf[u][k]);\n\t\t\t// puts(\"\");\n\t\t// }\n\t\tdp[u]=1ll*(j>0?pre[u][j-1]:1ll)*(j<lsuf-1?suf[u][j+1]:1ll)%mod;\n\t\tdp[v]=(1ll*dp[v]*(dp[u]+1))%mod;\n\t\t// printf(\"%d -> %d : %d && %d\\n\",u,v,dp[u],dp[v]);\n\t\tdfs2(v,u);\n\t}\n}\n\nint main(){\n\t\n\tinit();\n\t\n\tint n;\n\t\n\tscanf(\"%d\",&n);\n\tfor(int i=2;i<=n;i++){\n\t\tint x;\n\t\tscanf(\"%d\",&x);\n\t\tadd(x,i);\n\t\tadd(i,x);\n\t}\n\t\n\tdfs1(1,0);\n\t\n\t// for(int i=1;i<=n;i++) printf(\"%d \",dp[i]);\n\t// puts(\"\");\n\t\n\tdfs2(1,0);\n\t\n\tfor(int i=1;i<=n;i++) printf(\"%d \",res[i]);\n\tputs(\"\");\n\t\n\treturn 0;\n}\n```\n",
        "postTime": 1681455606,
        "uid": 234469,
        "name": "hxyqwq",
        "ccfLevel": 6,
        "title": "CF543D"
    },
    {
        "content": "\u6362\u4e00\u4e2a\u59ff\u52bf\u6362\u6839dp\uff08\u597d\u50cf\u4e5f\u5dee\u4e0d\u591a\uff1f\uff09\n\n\u6309\u7167\u6362\u6839dp\u7684\u8001\u5957\u8def\uff0c\u6211\u4eec\u4ee4 $g_u$ \u4e3a\u4fee\u597d\u4ee5 $u$ \u4e3a\u6839\u7684**\u5b50\u6811**\u5f53\u4e2d\u7684\u8def\u6709\u591a\u5c11\u79cd\u65b9\u6848\uff1b$f_u$ \u4e3a\u4fee\u597d\u4ee5 $u$ \u4e3a\u6839\u7684**\u6574\u68f5\u6811**\u7684\u8def\uff0c**\u5e76\u4e14\u9664\u53bb\u539f\u6765\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811**\u6709\u591a\u5c11\u79cd\u65b9\u6848\n\n\u5148\u8003\u8651 $g$\n\n\u8003\u8651\u4e00\u6761 $u\\rightarrow v$ \u7684\u8fb9\uff0c\u5982\u679c\u8fd9\u6761\u8fb9\u4e0d\u4fee\uff0c\u5219 $v$ \u5b50\u6811\u4e2d\u7684\u6240\u6709\u8fb9\u5fc5\u987b\u8981\u4fee\uff0c\u5219\u6709 1 \u79cd\u4fee\u6cd5\uff1b\u5982\u679c\u8fd9\u6761\u8fb9\u4fee\uff0c\u5219 $v$ \u5b50\u6811\u4e2d\u7684\u8d21\u732e\u4e3a $g_v$\uff0c\u5219 $v$ \u5b50\u6811\u7684\u603b\u8d21\u732e\u4e3a $g_v+1$\n\n\u90a3\u4e48\uff0c$g_u=\\prod_{v\\in son_u}(g_v+1)$\n\n\u518d\u8003\u8651 $f$\n\n\u8bbe $v$ \u4e3a $u$ \u7684\u4e00\u4e2a\u513f\u5b50\uff0c\u5219\u6709 $f_v=f_u\\times \\frac{g_u}{g_v+1}+1=f_u\\times \\prod_{w\\in son_u,w\\not=v}(g_w+1)+1$\n\n\uff08\u5176\u4e2d\u52a0\u4e00\u7684\u539f\u56e0\u662f\u548c\u4e0a\u9762\u4e00\u6837\u7684\uff09\n\n$\\prod_{w\\in son_u,w\\not=v}(g_w+1)$ \u53ef\u4ee5\u9884\u5904\u7406\u4e00\u4e2a\u524d\u7f00\u79ef\u548c\u4e00\u4e2a\u540e\u7f00\u79ef $\\Theta(1)$ \u6c42\u51fa\n\n\u7136\u540e\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\u5373\u4e3a $f_u\\times g_u$\n\n\u611f\u89c9\u8fd9\u6837\u505a\u7684\u601d\u8def\u6bd4\u697c\u4e0a\u90a3\u4e48\u5199\u5bb9\u6613\u7406\u89e3\u4e00\u70b9\uff1f\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n)$\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 200010\n#define pb push_back\n#define int long long\n#define p 1000000007\nusing namespace std;\nint n;\nstruct Node{int to,next;}Edge[MAXN<<1];\nint Head[MAXN],cnt_Edge;\nvoid Add_Edge(int u,int v){Edge[++cnt_Edge]={v,Head[u]};Head[u]=cnt_Edge;}\nint g[MAXN],f[MAXN],son[MAXN];//g&f&\u6bcf\u4e2a\u70b9\u513f\u5b50\u6570\u91cf\nvector<int>pre[MAXN],suf[MAXN];//\u524d\u7f00\u79ef&\u540e\u7f00\u79ef\nvoid dp1(int u,int fa)\n{\n\tg[u]=1;pre[u].pb(1);suf[u].pb(1);\n\tfor(int i=Head[u];i;i=Edge[i].next)\n\t{\n\t\tint v=Edge[i].to;if(v==fa)continue;\n\t\tdp1(v,u);g[u]=g[u]*(g[v]+1)%p;son[u]++;\n\t\tpre[u].pb(g[v]+1);suf[u].pb(g[v]+1);\n\t}pre[u].pb(1);suf[u].pb(1);//\u524d\u540e\u5efa\u7acb\u54e8\u5175\u70b9\u9632\u6b62\u6ea2\u51fa\u95ee\u9898\n\tfor(int i=1;i<=son[u];i++)pre[u][i]=pre[u][i]*pre[u][i-1]%p;\n\tfor(int i=son[u];i;i--)suf[u][i]=suf[u][i]*suf[u][i+1]%p;\n}//\u5904\u7406g,\u524d\u7f00\u79ef\u548c\u540e\u7f00\u79ef\nvoid dp2(int u,int fa)\n{\n\tfor(int i=Head[u],j=1;i;j++,i=Edge[i].next)\n\t{\n\t\tint v=Edge[i].to;if(v==fa)continue;\n\t\tint now=(u==1)?1:f[u];\n\t\tf[v]=(now*pre[u][j-1]%p*suf[u][j+1]%p+1)%p;\n\t\tdp2(v,u);\n\t}\n}//\u5904\u7406f\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint u;scanf(\"%lld\",&u);\n\t\tAdd_Edge(u,i);Add_Edge(i,u);\n\t}dp1(1,0);f[1]=1;dp2(1,0);printf(\"%lld\",g[1]%p);\n\tfor(int i=2;i<=n;i++)printf(\" %lld\",f[i]*g[i]%p);//\u8f93\u51fa\u7b54\u6848\n\treturn 0;\n}\n```",
        "postTime": 1593698330,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    },
    {
        "content": "\u89e3\u9898\u601d\u8def\uff1a\n\n\u53ef\u4ee5\u5199\u51fan^2\u7684dp\n\n\u6bcf\u4e2a\u70b9\u7684\u503c=\u5b83\u5b50\u6811\u7684\u503c\u76f8\u4e58\n\n\u7ecf\u8fc7\u4e00\u5b9a\u7684\u601d\u8003\u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\n\n\u6362\u6839\u64cd\u4f5c\u662f\u53ef\u4ee5\u5728O\uff081\uff09\u65f6\u95f4\u5185\u5b8c\u6210\u7684\n\n\u6211\u4eec\u53ea\u9700\u8981\u628a\u90a3\u4e2a\u5b50\u6811\u7684\u4f20\u56de\u6765\u7684\u503c\u9664\u6389\uff08*\u9006\u5143\uff09\n\n\u4f46\u662f\uff1a\n\n\u8fd9\u9053\u9898\u597d\u50cf\u8fd8\u5361\u4e86\u6a21\u6570\uff0c\u5f53dp\u503c=1e9+6\u7684\u65f6\u5019\n\n\uff08\u4f60\u80fd\u7b97\u9006\u5143\u5417\uff1f\uff09\n\n\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u8fd9\u79cd\u70b9\u5355\u72ec\u5904\u7406\n\n\u4e0b\u9762\u6765\u770b\u4ee3\u7801\uff1a\n\n```cpp\n\n#include<bits/stdc++.h>\n#define N 200005\nusing namespace std;\nstruct Edge{\n\tlong long to,nxt;\n}E[N*2];\nlong long Head[N],x,y,n,tot,dp[N],aux[N],ans[N];\nbool vis[N];\nconst long long mod=1000000007;\nvoid addedge(long long x,long long y){\n\tE[++tot]=(Edge){y,Head[x]};\n\tHead[x]=tot;\n}\ninline long long ksm(long long b,long long p){\n    long long res=1;\n    for (p<<=1;p>>=1;b=b*b%mod)\n        if (p&1) res=res*b%mod;\n    return res;\n}//\u5feb\u901f\u5e42 \ninline long long getinv(long long x){\n\tlong long res=ksm(x,mod-2);\n\treturn res;\n}//\u9006\u5143 \nvoid dfs(long long v,long long fa){//\u7b2c\u4e00\u904ddfs\u7b97\u51fa\u6839 \u4e3a1 \n\tdp[v]=1;\n\tbool skip=false;\n\tfor (int i=Head[v];i;i=E[i].nxt){\n\t\tif (E[i].to==fa) continue;\n\t\tdfs(E[i].to,v);\n\t\tif (dp[E[i].to]+1==mod&&!skip)\n\t\t\tvis[E[i].to]=true,skip=true; else\n\t\t\tdp[v]*=(dp[E[i].to]+1),\n\t\t\tdp[v]%=mod;\n\t} \n\tif (skip)\n\t\taux[v]=dp[v],dp[v]=0;\n}\nvoid dfs_2(int v,int fa){//\u7b2c\u4e8c\u904ddfs\u6362\u6839 \n\tans[v]++;\n\tfor (int i=Head[v];i;i=E[i].nxt){\n\t\tif (E[i].to==fa) continue;\n\t\tif (!vis[E[i].to])\n\t\t\tans[E[i].to]=ans[v]*dp[v]%mod*getinv(dp[E[i].to]+1)%mod; else \n\t\t\tans[E[i].to]=ans[v]*aux[v]%mod;\n\t\tdfs_2(E[i].to,v);\n\t}\n}\nvoid read(){\n\tscanf(\"%lld\",&n);\n\tfor (int i=2;i<=n;i++){\n\t\tscanf(\"%lld\",&x);\n\t\taddedge(i,x);\n\t\taddedge(x,i);\n\t}\n} \nvoid solve(){\n\tdfs(1,0);\n\tmemset(ans,0,sizeof(ans));\n\tdfs_2(1,0); \n\tfor (int i=1;i<=n;i++)\n\t\tprintf(\"%lld \",ans[i]*dp[i]%mod);\n}\nint main(){\n\tread();\n\tsolve();\n\treturn 0;\n} \n```",
        "postTime": 1541312191,
        "uid": 21267,
        "name": "titititing",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\n[\u9898\u76ee\u4f20\u9001\u95e8\uff01](https://www.luogu.com.cn/problem/CF543D)\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1f](https://www.cnblogs.com/liangbowen/p/17398821.html)\n\n\u6bd4\u8f83\u6709\u8da3\u7684\u6362\u6839 DP\u3002\n\n## \u601d\u8def\n\n### First DFS\n\n\u6309\u7167\u6362\u6839 DP \u5957\u8def\uff0c\u5148\u94a6\u5b9a $1$ \u4e3a\u9996\u90fd\uff08\u5373\u6839\u8282\u70b9\uff09\uff0c\u5e76\u8ba1\u7b97\u3002\n\n\u663e\u7136\u662f\u6811\u5f62 DP\u3002\u8bbe $dp_{u}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u5168\u90e8\u6ee1\u8db3\u7684\u65b9\u6848\u6570\u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u6811\u8fb9 $(u, v)$\uff1a\n\n+ \u5982\u679c $(u,v)$ \u4fee\uff0c\u5c31\u610f\u5473\u7740 $v$ \u5bf9\u5e94\u5b50\u6811\u7684\u6240\u6709\u70b9\uff0c\u8fd8\u6709\u4e00\u6b21\u4e0d\u4fee\u7684\u673a\u4f1a\uff0c\u5373 $dp_v$\u3002\n+ \u5982\u679c $(u,v)$ \u4e0d\u4fee\uff0c\u6ca1\u5bb9\u9519\u4e86\uff0c\u4e0b\u9762\u7684\u5168\u5f97\u4fee\uff0c\u5c31\u662f $1$\u3002\n\n\u7efc\u4e0a\uff0c$dp_u=\\prod\\limits_{\\text{son}=v} dp_u \\times (dp_v+1)$\u3002\n\n### Second DFS\n\n\u8fdb\u884c\u6362\u6839\u3002\n\n\u5047\u8bbe\u5f53\u524d\u6839\u4e3a $u$\u3002\u5bf9\u4e8e\u4e00\u6761\u6811\u8fb9 $(u, v)$\uff0c\u6211\u4eec\u53ef\u4ee5\u6362\u6839 $\\text{root}=v$\uff0c\u90a3\u4e48\uff1a\n\n+ $u$ \u5c11\u4e86 $v$ \u539f\u672c\u7684\u90a3\u4e2a\u5b50\u6811\u3002\u76f8\u5f53\u4e8e\u539f\u672c\u7b54\u6848\u53bb\u9664 $(dp_v+1)$ \u8fd9\u4e2a\u5206\u652f\uff0c\u5373\u9664\u6cd5\uff08\u8003\u8651\u9006\u5143\uff1f\uff09\u3002\n+ $v$ \u591a\u4e86 $u$ \u8fd9\u4e2a\u5b50\u6811\u3002\u540c\u6837\u7684\uff0c\u76f8\u5f53\u4e8e\u6dfb\u52a0\u4e86 $(dp_u+1)$ \u8fd9\u4e2a\u5206\u652f\uff0c\u5373\u4e58\u6cd5\u3002\n\n\u6309\u7167\u4e0a\u8ff0\u8f6c\u79fb\u5c31\u505a\u5b8c\u4e86\u3002\u4f46\u662f\uff01\u7531\u4e8e $0$ \u6ca1\u6709\u9006\u5143\uff0c\u6240\u4ee5\u76f4\u63a5\u9664\u4e0d\u53ef\u53d6\u3002\u4f7f\u7528\u524d\u540e\u7f00\u79ef\u7684\u65b9\u5f0f\u5feb\u901f\u7ef4\u62a4\uff0c\u53c2\u8003\u4ee3\u7801\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <vector>\nusing namespace std;\nconst int N = 2e5 + 5, mod = 1e9 + 7;\nstruct Edge {int now, nxt;} e[N << 1];\nint head[N], cur;\nvoid add(int u, int v)\n{\n\te[++cur].now = v, e[cur].nxt = head[u];\n\thead[u] = cur;\n}\nint dp[N]; //dp[u] : \u4ee5u\u4e3a\u6839\u7684\u65b9\u6848\u6570 \n//\u5982\u679c(u,v)\u4fee\uff0c\u5c31\u662f dp[v]\uff1a\u5982\u679c(u,v)\u4e0d\u4fee\uff0c\u4e0b\u9762\u7684\u5168\u5f97\u4fee\uff0c\u5c31\u662f1\u3002dp[u]=prod dp[u] * (dp[v]+1)\nvoid dfs(int u, int fa)\n{\n\tdp[u] = 1;\n\tfor (int i = head[u]; i; i = e[i].nxt)\n\t{\n\t\tint v = e[i].now;\n\t\tif (v == fa) continue;\n\t\tdfs(v, u), dp[u] = 1ll * dp[u] * (dp[v] + 1) % mod;\n\t}\n}\n#define update(x) pre.push_back(x + 1), suf.push_back(x + 1)\nvoid DFS(int u, int fa, int mulfa)\n{\n\tvector <int> pre, suf;\n\tfor (int i = head[u]; i; i = e[i].nxt)\n\t{\n\t\tint v = e[i].now;\n\t\tif (v == fa) {if (mulfa != -1) update(mulfa);}\n\t\telse update(dp[v]);\n\t}\n\tint siz = pre.size();\n\t\n\t#define lst(i) (i == 0 ? 1 : pre[i - 1])\n\t#define nxt(i) (i == siz - 1 ? 1 : suf[i + 1])\n\tfor (int i = 0; i < siz; i++) pre[i] = 1ll * pre[i] * lst(i) % mod;\n\tfor (int i = siz - 1; ~i; i--) suf[i] = 1ll * suf[i] * nxt(i) % mod;\n\t\n\tfor (int i = head[u], pos = 0; i; i = e[i].nxt, pos++)\n\t{\n\t\tint v = e[i].now;\n\t\tif (v == fa) continue;\n\t\tint tmp = 1ll * lst(pos) * nxt(pos) % mod;\n\t\tdp[v] = 1ll * dp[v] * (tmp + 1) % mod, DFS(v, u, tmp);\n\t}\n}\nint main()\n{\n\tint n;\n\tscanf(\"%d\", &n);\n\tfor (int i = 2; i <= n; i++)\n\t{\n\t\tint u;\n\t\tscanf(\"%d\", &u);\n\t\tadd(i, u), add(u, i);\n\t}\n\tdfs(1, 0), DFS(1, 0, -1);\n\tfor (int i = 1; i <= n; i++) printf(\"%d \", dp[i]);\n\treturn 0;\n}\n```\n\n\u5e0c\u671b\u80fd\u5e2e\u52a9\u5230\u5927\u5bb6\uff01",
        "postTime": 1684030266,
        "uid": 367488,
        "name": "liangbowen",
        "ccfLevel": 0,
        "title": "CF543D \u9898\u89e3"
    },
    {
        "content": "\u6362\u6839 dp \u4fdd\u59c6\u7ea7\u9898\u89e3\u3002\n\n\u6309\u7167\u4e00\u822c\u6362\u6839 dp \u7684\u601d\u8def\uff0c\u53ef\u4ee5\u8003\u8651\u5728\u5b50\u6811 $u$ \u4e2d\u8fdb\u884c\u64cd\u4f5c\uff0c\u7b2c\u4e00\u7ef4\u5373\u4e3a $u$\u3002\u6b64\u9898\u4e5f\u660e\u786e\u4e86\u4e00\u4e2a\u201c\u826f\u201d\u4e0e\u201c\u4e0d\u826f\u201d\uff0c\u201c\u826f\u201d\u5360\u591a\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u7528 $0/1$ \u6765\u8bb0\u5f55\u3002\u800c\u6c42\u89e3\u7684\u662f\u65b9\u6848\u6570\uff0c\u5c06\u8fd9\u4e00\u4fe1\u606f\u8bb0\u5f55\u5728\u6570\u503c\u4e2d\u3002\n\n\u8bbe $f[u][0/1]$ \u4e3a\u5728\u5b50\u6811 $u$ \u4e2d\u662f\u5426\u6709\u4e0d\u826f\u8fb9\u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u8f6c\u79fb\uff0c\u5c06 $f[u][0/1]$ \u4e0e $f[v][0/1]$ \u8054\u7cfb\u8d77\u6765\uff0c\u5176\u4e2d $v\\in son(u)$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff1a\u82e5\u5b50\u6811 $u$ \u4e2d\u65e0\u4e0d\u826f\u8fb9\uff0c\u5219\u65b9\u6848\u6570\u4e00\u5b9a\u4e3a $1$\uff0c\u4e5f\u53ef\u4ee5\u770b\u4f5c\u8f6c\u79fb\u6210\u6240\u4ee5\u65e0\u4e0d\u826f\u8fb9\u7684\u513f\u5b50\u5b50\u6811\u65b9\u6848\u6570\u4e4b\u79ef\uff1b\u82e5\u5b50\u6811 $u$ \u4e2d\u6709\u4e0d\u826f\u8fb9\uff0c\u5c31\u7a0d\u5fae\u6709\u70b9\u96be\u8f6c\u79fb\u4e86\u3002\n\n\u96be\u5728\u54ea\u91cc\uff1f\u6211\u4eec\u53ea\u80fd\u679a\u4e3e\u5b50\u6811 $v$ \u4e2d\u662f\u5426\u6709\u4e0d\u826f\u8fb9\uff0c\u5e76\u4e0d\u80fd\u4fdd\u8bc1 $u$ \u7684\u6240\u6709\u513f\u5b50\u7684\u5b50\u6811\u4e2d\u4e00\u5171\u81f3\u5c11\u6709\u4e00\u6761\u4e0d\u826f\u8fb9\uff0c\u82e5\u679a\u4e3e\u540e\u5168\u90fd\u662f\u826f\u8fb9\uff0c\u5c31\u4e0d\u5bf9\u4e86\u3002\n\n\u4f7f\u7528\u201c\u4e00\u822c\u51cf\u7279\u6b8a\u201d\u7684\u65b9\u6cd5\uff0c\u4e00\u822c\u5373\u4e3a\u201c\u679a\u4e3e $u$ \u7684\u513f\u5b50\u5b50\u6811\uff0c\u4ece\u800c\u8ba1\u7b97\u51fa $u$ \u7684\u5b50\u6811\u4e2d\u6709\u4e0d\u826f\u8fb9\u7684\u65b9\u6848\u6570\u201d\uff0c\u7279\u6b8a\u5373\u4e3a\u201c\u679a\u4e3e\u65f6\u53ef\u80fd\u5168\u662f\u826f\u8fb9\u201d\u6709\u4e14\u4ec5\u6709\u4e00\u79cd\u60c5\u51b5\uff0c\u5927\u51cf\u5c0f\u5373\u53ef\uff0c\u4e5f\u5c31\u662f\u6700\u540e\u51cf\u53bb $1$\u3002\n\n\u95ee\u9898\u8f6c\u6362\u6210\uff1a\u5982\u4f55\u679a\u4e3e\u5b50\u6811 $u$ \u4e2d\u8fb9\u7684\u65b9\u6848\u6570\u3002\n\n\u7531\u4e8e\u53ea\u9700\u8981\u8f6c\u79fb\u5230 $v$\uff0c\u95ee\u9898\u53c8\u8f6c\u5316\u6210\uff1a\u679a\u4e3e $u,v$ \u4e4b\u95f4\u8fde\u8fb9\u662f\u5426\u4e3a\u826f\u8fb9\uff0c\u7136\u540e\u6254\u5230 $v$ \u5b50\u6811\u4e2d\u7b97\u5c31\u884c\u4e86\u3002\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u5b50\u6811\u65b9\u6848\u6570\u76f8\u4e58\u5373\u4e3a\u7b54\u6848\u3002\n\n\u5f53\u8fde\u8fb9\u4e3a\u826f\u8fb9\uff0c\u5219 $v$ \u5b50\u6811\u4e2d\u53ef\u4ee5\u5168\u4e3a\u826f\u8fb9 $f[v][0]$ \u4e5f\u53ef\u4ee5\u6709\u4e0d\u826f\u8fb9 $f[v][1]$\uff1b\u5f53\u8fde\u8fb9\u4e3a\u4e0d\u826f\u8fb9\uff0c\u5219 $v$ \u5b50\u6811\u4e2d\u53ea\u80fd\u5168\u4e3a\u826f\u8fb9\uff08\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\uff1f\uff09\n\n\u56e0\u4e3a\u82e5 $(u,v)$ \u4e3a\u4e0d\u826f\u8fb9\uff0c\u4e14 $v$ \u5b50\u6811\u4e2d\u6709\u4e0d\u826f\u8fb9\uff0c\u5219 $v$ \u5b50\u6811\u4e2d\u4e00\u5b9a\u6709\u4e00\u4e2a\u70b9\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u7ecf\u8fc7\u4e86\u4e24\u6761\u4e0d\u826f\u8fb9\uff0c\u4e0d\u7b26\u5408\u9898\u610f\u3002\n\n\u628a\u4e00\u4e2a\u5b50\u6811\u4e2d\u7684\u65b9\u6848\u6570\u5168\u90e8\u52a0\u8d77\u6765\uff0c\u518d\u628a\u6bcf\u4e2a\u5b50\u6811\u4e2d\u7684\u65b9\u6848\u6570\u4e58\u8d77\u6765\u5373\u53ef\u3002\n\n\u5217\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f[u][0]=\\prod_{v\\in son(u)}\\big(f[v][0]\\big),f[u][1]=\\prod_{v\\in son(u)}\\big((f[v][0]+f[v][1])+(f[v][0])\\big)-1$$\n\n\u5373\u4e3a\uff1a\n\n$$f[u][0]=1,f[u][1]=\\prod_{v\\in son(u)}\\big(f[v][1]+2\\big)-1$$\n\n\u800c $f[u][0]+f[u][1]$ \u5c31\u662f\u4ee5 $u$ \u4e3a\u6839\u7684\u6574\u68f5\u5b50\u6811\u7684\u65b9\u6848\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5408\u5e76\uff1a\u8bb0 $f[u]=f[u][0]+f[u][1]$\u3002\n\n\u5219\u6709\uff1a\n$$\nf[u]=\\prod_{v\\in son(u)}\\big(f[v]+1\\big)\n$$\n\u6bcf\u68f5 $v$ \u5b50\u6811\u5bf9 $u$ \u5b50\u6811\u7684\u8d21\u732e\u662f $v$ \u5b50\u6811\u672c\u8eab\u52a0\u4e0a\u4e0e $u$ \u7684\u8fde\u8fb9\uff0c\u53c8\u7531\u4e8e\u6bcf\u68f5\u5b50\u6811\u4e4b\u95f4\u8d21\u732e\u72ec\u7acb\uff0c\u6839\u636e\u4e58\u6cd5\u539f\u7406\u4e58\u8d77\u6765\u5373\u53ef\u3002\n\n\u8ba1\u7b97\u5b8c\u4e86 $f[u]$\uff0c\u8003\u8651\u5982\u4f55\u6362\u6839\uff0c\u8ba1\u7b97 $g[u]$ \u8868\u793a\u5df2 $u$ \u4e3a\u6574\u9897\u6811\u7684\u6839\u7684\u65b9\u6848\u6570\u3002\n\n\u82e5\u7b2c\u4e00\u6b21\u94a6\u5b9a\u6839\u8282\u70b9\u4e3a $1$\uff0c\u5b83\u7684\u7b54\u6848\u5728 dfs1 \u4e2d\u5c31\u5df2\u7ecf\u6c42\u51fa\uff0c\u5c31\u6709 $g[1]=f[1]$\u3002\n\n\u63a5\u4e0b\u6765\u770b\u4e00\u5f20\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/qpbl3bvr.png)\n\n\u6211\u4eec\u73b0\u5728\u77e5\u9053\u4e86 $f[1]=g[1],f[2]$\uff0c\u5982\u4f55\u6c42 $g[2]$\uff1f\n\n\u8003\u8651 $g[2]$ \u7684\u7ec4\u6210\uff0c\u5c06 $2$ \u770b\u6210\u6839\uff0c\u5219\u6709 $g[2]=(f[4]+1)(f[5]+1)(f[6]+1)(f_2[1]+1)=f[2](f_2[1]+1)$\uff0c\u5176\u4e2d $f_2[1]$ \u8868\u793a\u4ee5 $2$ \u4e3a\u6574\u9897\u6570\u7684\u6839\u65f6 $1$ \u7684 $f$ \u503c\u3002\u4f46\u662f\uff0c\u8fd9\u4e2a\u503c\u6211\u4eec\u4e0d\u77e5\u9053\uff0c\u6211\u4eec\u53ea\u77e5\u9053\u4ee5 $1$ \u4e3a\u6839\u65f6 $1$ \u7684 $f$ \u503c\u3002\u60f3\u60f3\uff0c$f_2[1]$ \u53c8\u7b49\u4e8e\u4ec0\u4e48\uff1f\u7b49\u4e8e $f[3]+1$\u3002\n\n\u7136\u540e\u6211\u4eec\u770b $2$ \u6362\u6839\u5230 $5$ \u7684\u8fc7\u7a0b\uff1a$g[5]=f[5](f_5[2]+1)$\uff0c\u90a3\u4e48\u8fd9\u4e2a $f_5[2]$ \u6709\u7b49\u4e8e\u4ec0\u4e48\u5462\uff1f$f_5[2]=(f[4]+1)(f[6]+1)(f_5[1]+1)$\u3002\u54a6\uff1f\u8fd9\u91cc\u51fa\u73b0\u4e86 $f_5[1]$\uff0c\u5b83\u662f\u4e0d\u662f\u7b49\u4e8e $f_2[1]$ \u5462\uff1f\u5728\u8fd9\u91cc\u662f\u7b49\u4e8e\u7684\uff0c\u4f46\u6211\u4eec\u518d\u6362\u4e2a\u70b9\u77a7\u77a7\u3002\u5982\u679c $f_i[u],i\\ne 1$ \u5168\u90fd\u76f8\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u3002\n\n\u770b $3$ \u6362\u6839\u5230 $7$ \u7684\u8fc7\u7a0b\uff1a$g[7]=f[7](f_7[3]+1),f_7[3]=f_7[1]+1$\uff0c\u8fd9\u91cc\u7684 $f_7[1]$ \u660e\u663e\u4e0d\u7b49\u4e8e $f_5[1],f_2[1]$\u3002\n\n\u6839\u636e\u4ee5\u4e0a\u63a2\u7a76\uff08\u624b\u73a9\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4ee5\u4e0b\u4e09\u4e2a\u7ed3\u8bba\uff1a\uff08\u8fd9\u91cc\u7684 $u,v$ \u5173\u7cfb\u59cb\u7ec8\u662f\u4ee5 $1$ \u4e3a\u6839\u65f6\u7684\u5173\u7cfb\uff09\n\n- \u4ee5 $v$ \u4e3a\u6839\u7684\u7b54\u6848\u7b49\u4e8e $u$ \u9664 $v$ \u4ee5\u5916\u7684\u90bb\u5c45\u7684 $f$ \u503c $+1$ \u7684\u6210\u7ee9\u518d $+1$ \u4e58\u4e0a $f[v]$\uff0c\u5373 $g[v]=f[v]\\big(\\prod (f[i]+1)+1\\big)$\uff0c\u5176\u4e2d $i$ \u4e3a $u$ \u7684\u90bb\u5c45\u3002\n- \u90bb\u5c45\u4e2d\u4e0d\u662f $u$ \u7684\u7236\u4eb2\u7684\u70b9\u597d\u5904\u7406\uff0c\u76f4\u63a5\u7528\u524d\u540e\u7f00\u79ef\u8ba1\u7b97\u5373\u53ef\uff0c\u4f46 $fa_u$ \u5bf9\u4e8e\u4e0d\u540c\u70b9\u7684\u8d21\u732e\u4e0d\u56fa\u5b9a\uff0c\u4e0d\u80fd\u4e0e\u9884\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u4f20\u53c2\u4e0b\u53bb\uff0c\u4f5c\u4e3a `void dfs2(int u,int fa,int faw)` \u7684\u4e00\u4e2a\u53c2\u6570\u3002\n- \u800c\u7236\u4eb2\u8282\u70b9\u7684\u8d21\u732e\u5c31\u7b49\u4e8e\u7236\u4eb2\u8282\u70b9\u5728\u8ba1\u7b97\u65f6\u7684\u524d\u540e\u7f00\u79ef\u4e58\u4e0a $fa_{fa}$ \u7684\u8d21\u732e\u3002\u521d\u59cb\u70b9 $1$ \u7684\u7236\u4eb2 $0$ \u7684\u8d21\u732e\u8bb0\u4e3a $1$\u3002\n\n\u7b2c\u4e09\u4e2a\u53ef\u4ee5\u53c2\u7167\u4ee3\u7801\u7406\u89e3\uff1a\n\n```cpp\ng[v]=f[v]*(pre[u][i]*suf[u][i+1]%mod*faw%mod+1)%mod;\ndfs2(v,u,pre[u][i]*suf[u][i+1]%mod*faw%mod+1);\n```\n\n[\u5b8c\u6574\u4ee3\u7801\u94fe\u63a5\uff08\u5f00\u5b8c\u9690\u7684\u540c\u5b66\u53ef\u80fd\u5c31\u770b\u4e0d\u5230\u4e86\u54e6\uff09](https://www.luogu.com.cn/record/82749731)\n\n\u603b\u7684\u6765\u8bf4\uff1a\u8fd9\u4e00\u9053\u9898\u4f1a\u610f\u5f88\u5bb9\u6613\uff0c\u5b8c\u5168\u7406\u89e3\u8fd8\u8981\u4e0b\u4e00\u756a\u529f\u592b\u54e6\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u9053\u6362\u6839 dp \u7684\u5165\u95e8\u9898\u3002\n\n\u6362\u6839 dp \u5e38\u89c1\u5957\u8def\uff1a\n\n- \u4e24\u6b21 dfs\u3002\u4e0d\u8981\u5199\u6df7\uff0c\u6bd4\u5982 `dfs1()` \u91cc\u5957 `dfs2()`\n- \u524d\u540e\u7f00\u79ef\u907f\u514d\u65e0\u9006\u5143\u7684\u60c5\u51b5\u3002\n\n\u5b8c\u7ed3\u6492\u82b1\uff01",
        "postTime": 1659837134,
        "uid": 271736,
        "name": "Daidly",
        "ccfLevel": 6,
        "title": "CF543D Road Improvement \u9898\u89e3"
    },
    {
        "content": "~~\u770b\u5230\u9898\u89e3\u91cc\u7528\u7684\u90fd\u662fvector\uff0c\u6211\u51b3\u5b9a\u5199\u4e00\u7bc7\u624b\u6253\u90bb\u63a5\u8868\u7684\u9898\u89e3~~\n### \u9898\u610f\n- \u7ed9\u5b9a\u4e00\u68f5\u542b $n$ \u4e2a\u70b9\uff0c $n-1$ \u6761\u8fb9\u7684\u6811\u3002\n\n- \u9009\u4e00\u4e2a\u70b9\u4e3a\u6839\uff0c\u9009\u82e5\u5e72\u6761\u8fb9\u6253\u4e0a\u6807\u8bb0\uff08\u53ef\u4ee5\u4e00\u6761\u4e5f\u4e0d\u6253\uff09\uff0c\u8981\u6c42\u4ece\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u5230\u6839\u8282\u70b9\u8def\u5f84\u4e0a\u6709\u6807\u8bb0\u7684\u8fb9\u4e0d\u8d85\u8fc7\u4e00\u6761\u3002\n\n- \u5bf9\u4e8e\u7f16\u53f7\u4e3a $1$ ~ $n$ \u7684\u6bcf\u4e2a\u70b9\uff0c\u4f60\u9700\u8981\u6c42\u51fa\u8be5\u70b9\u4f5c\u4e3a\u6839\u8282\u70b9\u4e00\u5171\u6709\u591a\u5c11\u79cd\u6253\u6807\u8bb0\u7684\u65b9\u6cd5\uff0c\u7b54\u6848\u5bf9 $1000000007$ \u53d6\u6a21\u3002\n\n### \u66b4\u529b\u505a\u6cd5\uff1a\u6811\u5f62DP\n\n\u89c4\u5b9a\u9898\u9762\u4e2d\u201c\u4e0d\u826f\u597d\u7684\u9053\u8def\u201d\u4e3a\u6253\u4e0a\u6807\u8bb0\u7684\u8fb9\u3002\n\n\u5bf9\u4e00\u9897\u6839\u8282\u70b9\u786e\u5b9a\u7684\u6811\uff0c\u6211\u4eec\u5bb9\u6613\u53d1\u73b0**\u4e00\u4e2a\u70b9**\u4e0e\u5b83\u7684**\u4e00\u4e2a\u513f\u5b50\u8282\u70b9**\u7684\u8fde\u8fb9\u6709**\u6253\u4e0a\u6807\u8bb0\u4e0e\u4e0d\u6253\u4e0a\u6807\u8bb0**\u4e24\u79cd\u53ef\u80fd\u3002\n\n\u5728**\u6839\u8282\u70b9\u786e\u5b9a\u7684\u6811**\u4e2d\uff0c\u6211\u4eec\u8bbe $f_{i}$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u7684**\u5b50\u6811**\u7684\u5408\u6cd5\u65b9\u6848\u3002\n- **\u5982\u679c\u6253\u4e0a\u6807\u8bb0\uff0c\u5c31\u8981\u6c42\u8be5\u513f\u5b50\u6240\u5728\u5b50\u6811\u4e0d\u80fd\u6709\u4e00\u4e2a\u6807\u8bb0**\uff08\u5426\u5219\u5c31\u4f1a\u5b58\u5728\u4e00\u4e2a\u70b9\u5230\u6839\u8282\u70b9\u8def\u5f84\u4e0a\u5b58\u5728\u591a\u6761\u6709\u6807\u8bb0\u7684\u8fb9\uff09\uff0c\u6b64\u65f6\u53ea\u6709\u4e00\u79cd\u65b9\u6848\uff0c\u5373\u8be5\u5b50\u6811\u7684\u8fb9\u5168\u90e8\u6ca1\u6709\u6807\u8bb0\u3002\u8fd9\u79cd\u53ef\u80fd  \u7684\u65b9\u6848\u6570\u4e3a $1$ \u3002\n- **\u5982\u679c\u8be5\u8fb9\u4e0d\u6253\u4e0a\u6807\u8bb0**\uff0c\u90a3\u4e48\u8be5\u513f\u5b50\u6240\u5728\u5b50\u6811\u53ea\u8981\u4e5f\u6ee1\u8db3\u201c\u8def\u5f84\u4e0a\u6253\u6807\u8bb0\u7684\u8fb9\u4e0d\u8d85\u8fc7\u4e00\u6761\u201d\u5373\u53ef\u3002\u8bbe $j$ \u4e3a $i$ \u7684\u4e00\u4e2a\u513f\u5b50\u7684\u7f16\u53f7\uff0c\u8fd9\u79cd\u53ef\u80fd  \u7684\u65b9\u6848\u6570\u4e3a $f_{j}$ \u3002\n\n\u56e0\u6b64\uff0c\u5bf9\u4e8e\u4e00\u9897\u5b50\u6811 $j$ \u800c\u8a00\uff0c\u53ef\u80fd\u7684\u65b9\u6848\u6570\u4e3a $f_{j}+1$ \u3002\u7531\u4e58\u6cd5\u539f\u7406\u6613\u77e5\uff1a\n\n$f_{i}=\\prod (f_{j}+1)$\n\n\u5176\u4e2d $j$ \u662f $i$ \u7684\u4e00\u9897\u5b50\u6811\u3002\u90a3\u4e48\u5bf9\u4e8e\u4e00\u9897\u6839\u5df2\u7ecf\u786e\u5b9a\u7684\u6811\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5 $O(N)$ \u6c42\u51fa\u5bf9\u4e8e\u8fd9\u4e2a\u6839\u7684\u53ef\u80fd\u7684\u65b9\u6848\u6570\u3002\u7531\u4e8e\u6211\u4eec\u8981\u6c42\u51fa\u6240\u6709\u8282\u70b9\u4e3a\u6839\u7684\u65b9\u6848\u6570\uff0c\u4e5f\u5c31\u8981\u8dd1 $n$ \u6b21\uff0c\u6240\u4ee5\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N^{2})$ \u3002\n~~\u4e8e\u662f\u6211\u4eec\u6210\u529f\u7684\u7206\u6389\u4e86~~\u3002\n\n### AC\u505a\u6cd5\uff1a\u6811\u5f62DP+\u6362\u6839\n\u5176\u5b9e\u4e0e\u4e0a\u4e00\u79cd\u505a\u6cd5\u5927\u81f4\u662f\u4e00\u6837\u7684\u3002\u6211\u4eec\u53ef\u4ee5 $O(N)$ \u8ba1\u7b97\u51fa\u4ee5**\u4e00\u4e2a\u786e\u5b9a\u7684\u70b9\u4e3a\u6839**\u7684\u6240\u6709 $f$ \u503c\u3002\u7136\u540e\u5bf9\u4e8e\u4ee5 $i$ \u4e3a\u6839\u7684\u4e00\u9897**\u6811**\uff0c\u9009\u62e9\u5176\u4e00\u4e2a\u513f\u5b50 $j$ \u4f5c\u4e3a\u65b0\u7684\u6839\uff0c\u6b64\u65f6\u53ef\u4ee5\u5c06 $f_{i}$ \u66f4\u6539\u4e3a $\\frac{f_{i}}{f_{j}+1}$ \u53bb\u9012\u5f52\u66f4\u65b0 $j$ \uff08\u53ef\u4ee5\u7406\u89e3\u4e3a $i$ \u964d\u683c\u4e3a $j$ \u7684\u5b50\u6811\uff09\uff0c\u66f4\u65b0\u5b8c\u6210\u540e\u518d\u8fd8\u539f $f_{i}$ \u3002\n\n**\u90a3\u8981\u600e\u4e48\u7b97 $\\frac{f_{i}}{f_{j}+1}$ \u5462\uff1f**\n\n~~\u9006\u5143~~\n\n\u8fd9\u9053\u9898\u5361\u4e86\u9006\u5143\uff0c\u53ef\u80fd\u51fa\u73b0\u4e0d\u5b58\u5728\u9006\u5143\u7684\u60c5\u51b5\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u9884\u5904\u7406\u524d\u7f00/\u540e\u7f00\u79ef\u4ee5\u8ba1\u7b97\u3002\u5373\uff1a\n\n $\\frac{f_{i}}{f_{j}+1}=(f_{s_{1}}+1)\\cdot (f_{s_{2}}+1) \\cdots (f_{s_{p-1}}+1) \\cdot (f_{s_{p+1}}+1) \\cdots (f_{s_{k-1}}+1) \\cdot (f_{s_{k}}+1)$\n\n\u5176\u4e2ds\u4e3a\u8282\u70b9 $i$ \u5b50\u8282\u70b9\u7f16\u53f7\u6784\u6210\u7684\u5e8f\u5217\uff0c\u4e14 $s_{p}=j$ \u3002\u6240\u4ee5\u9700\u9884\u5904\u7406\u51fa $(f_{s_{1}}+1)\\cdot (f_{s_{2}}+1) \\cdots (f_{s_{p-1}}+1)$ \u548c $(f_{s_{p+1}}+1) \\cdots (f_{s_{k-1}}+1) \\cdot (f_{s_{k}}+1)$ \u5373\u53ef\u3002(\u7b2c\u4e00\u6b21dp\u65f6\u5c31\u53ef\u4ee5\u987a\u5e26\u8fdb\u884c\u9884\u5904\u7406\uff09\n\n\u5f53\u7136\u4f60\u53ef\u4ee5\u4f7f\u7528vector\u6765\u50a8\u5b58\u524d/\u540e\u7f00\u79ef\u3002\u4f46\u662f\u6211~~\u592a\u83dc\u4e0d\u4f1a\u7528vector~~\u7528\u4e86**\u90bb\u63a5\u8868**~~\u5c45\u7136\u8fd8\u6478\u4e86\u4e2a\u6700\u4f18\u89e3~~\u3002\u7ec6\u8282\u89c1\u4ee3\u7801\u6ce8\u91ca\u3002\n\n\n------------\n\n### upd\n\u4e00\u4f4d\u5de8\u795e**\u968f\u624b**\u5e2e\u5fd9\u4f18\u5316\u4e86\u4e00\u4e0b\u7a7a\u95f4\u3002\u6211\u4eec\u4e0d\u9700\u8981\u4f7f\u7528\u90bb\u63a5\u8868\u5b58\u50a8\uff0c\u53ef\u4ee5\u5728\u9884\u5904\u7406\u65f6\u76f4\u63a5\u5c06\u524d\u7f00\u79ef\u4e0e\u540e\u7f00\u79ef\u7684\u4e58\u79ef\u8bb0\u5f55\u5728\u6bcf\u4e00\u4e2a\u5b50\u6811\u4e0a\u3002\u6838\u5fc3\u90e8\u5206\u89c1\u7b2c\u4e8c\u6bb5\u4ee3\u7801\u3002\n\n------------\n\n## code\n#### \u90bb\u63a5\u8868\u505a\u6cd5\n```cpp\n#include <iostream>\n#include <cstdio>\nusing namespace std;\n#define MAXN 200010\n#define MOD 1000000007\nint n,hed[MAXN*2],nxt[MAXN*2],edg[MAXN*2],tot;\t\t//hed,nxt,edg\u4e3a\u5b58\u50a8\u6811\u8fb9\u7684\u90bb\u63a5\u8868\nint hepr[MAXN],nxpr[MAXN],tpr,helt[MAXN],nxlt[MAXN],tlt;\n//hepr nxpr valpr (pr\u4e3apre)\u4e3a\u5b58\u50a8\u524d\u7f00\u79ef\u7684\u90bb\u63a5\u8868\uff0ctopr\u4e3a\u524d\u7f00\u79ef\u90bb\u63a5\u8868\u957f\u5ea6\n//helt nxlt vallt (lt\u4e3alast)\u4e3a\u5b58\u50a8\u540e\u7f00\u79ef\u7684\u90bb\u63a5\u8868,tolt\u4e3a\u540e\u7f00\u79ef\u90bb\u63a5\u8868\u957f\u5ea6\n//\u7ffb\u8bd1:he=head nx=next val=value\nlong long valpr[MAXN],reg[MAXN],vallt[MAXN],mult[MAXN],ans[MAXN];\nlong long f[MAXN];\ninline int getn(){\t\t\t\t\t\t\t\t\t\t\t\t\t//\u5feb\u8bfb\n\tregister int a=0;\n\tbool b=1;\n\tregister char c=getchar();\n\tfor(;!((c>='0'&&c<='9')||c=='-');) c=getchar();\n\tfor(;(c>='0'&&c<='9')||c=='-';){\n\t\tif(c=='-') b=0,c=getchar();\n\t\ta=(a<<1)+(a<<3)+int(c)-48;\n\t\tc=getchar();\n\t}\n\tif(!b) return -a;\n\treturn a;\n}\ninline void add(int x,int y){\n\tedg[++tot]=y; nxt[tot]=hed[x]; hed[x]=tot;\n\treturn;\n}\nvoid dp(int t,int fa){\n\tf[t]=1; int len=0,p=1;\n\tfor(int i=hed[t];i;i=nxt[i]){\n\t\tif(edg[i]==fa) continue;\t\t\t//\u904d\u5386\u4e0d\u7ecf\u8fc7\u7236\u8282\u70b9\n\t\tdp(edg[i],t);\n\t\tf[t]=(f[t]*(f[edg[i]]+1))%MOD;\t\t\t//\u8f6c\u79fb\u65b9\u7a0b\u8be6\u89c1\u4e0a\u9762\u7684\u89e3\u91ca\n\t}\n\tfor(int i=hed[t];i;i=nxt[i])\n\t\tif(edg[i]!=fa) reg[++len]=f[edg[i]]+1;\n//\u7531\u4e8e\u524d\u7f00\u79ef\u548c\u540e\u7f00\u79ef\uff0c\u4e24\u8005\u7684\u65b9\u5411\u76f8\u53cd\n//\u90bb\u63a5\u8868\u7684\u53cc\u5411\u67e5\u8be2\u53c8\u8f83\u4e3a\u9ebb\u70e6\uff0c\u6240\u4ee5\u50a8\u5b58\u5728\u4e00\u4e2a\u6570\u7ec4\u4e2d\u65b9\u4fbf\u5904\u7406\n\tmult[1]=1;\n\tfor(int i=1;i<=len;i++){\n\t\tmult[i+1]=(mult[i]*reg[i])%MOD;\n\t\tvallt[++tlt]=p; nxlt[tlt]=helt[t]; helt[t]=tlt;\n//\u90bb\u63a5\u8868\u7684\u63d2\u5165\u4f1a\u4f7f\u5f97\u6570\u5217\u7684\u65b9\u5411\u53cd\u4e86\u4e00\u6b21\uff0c\u6240\u4ee5\u540e\u7f00\u79ef\u53ef\u4ee5\u76f4\u63a5\u63d2\u5165\n\t\tp=(p*reg[len-i+1])%MOD;\n\t}\n\tfor(int i=len;i>=1;i--){\n\t\tvalpr[++tpr]=mult[i]; nxpr[tpr]=hepr[t]; hepr[t]=tpr;\n     //\u53cd\u5411\u63d2\u5165\u524d\u7f00\u79ef\n\t}\n\treturn;\n}\nvoid dfs(int t,int fa){\n\tint s=1,a=hepr[t],b=helt[t];\n\tfor(int i=hed[t];i;i=nxt[i]) s=(s*(f[edg[i]]+1))%MOD;   //\u66f4\u65b0\u8be5\u8282\u70b9\n\tans[t]=s;\n\tfor(int i=hed[t];i;i=nxt[i]){\n\t\tif(edg[i]==fa) continue;\n\t\tf[t]=(((valpr[a]*vallt[b])%MOD)*(f[fa]+1))%MOD;\n\t\t//\u540e\u7f00\u79ef*\u524d\u7f00\u79ef*\u7236\u8282\u70b9\u6743\u503c \u66f4\u6539\u8be5\u8282\u70b9\n\t\ta=nxpr[a]; b=nxlt[b];\n\t\tdfs(edg[i],t);\n\t}\n\treturn;\n}\nsigned main(){\n\tn=getn();\n\tfor(int i=2;i<=n;i++){\n\t\tint p=getn();\n\t\tadd(p,i); add(i,p);\n\t}\n\tdp(1,0);\t//\u7b2c\u4e00\u6b21dp\n\tdfs(1,0);\t\t//\u6362\u6839\u6cd5\n\tfor(int i=1;i<=n;i++) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n```\n#### \u65e0\u90bb\u63a5\u8868\u505a\u6cd5\uff08dp+\u6362\u6839\u90e8\u5206\uff09\n```cpp\nvoid dp(int t,int fa){\n\tf[t]=1; int len=0,p=1;\n\tfor(int i=hed[t];i;i=nxt[i]){\n\t\tif(edg[i]==fa) continue;\n\t\tdp(edg[i],t);\n\t\tf[t]=(f[t]*(f[edg[i]]+1))%MOD;\n\t}\n\tfor(int i=hed[t];i;i=nxt[i])\n\t\tif(edg[i]!=fa) reg[++len]=f[edg[i]]+1;\n\tmult[len]=1;\n\tfor(int i=len-1;i>=1;i--)\n\t\tmult[i]=(mult[i+1]*reg[i+1])%MOD;\n    //\u8ba1\u7b97\u540e\u7f00\u79ef\n\tfor(int i=hed[t],j=1;i;i=nxt[i],j++){\n\t\tif(edg[i]==fa) continue;\n\t\tv[edg[i]]=(p*mult[j])%MOD;\n        //\u5c06\u524d\u7f00\u79ef\u548c\u540e\u7f00\u79ef\u7684\u4e58\u79ef\u76f4\u63a5\u8bb0\u5f55\u5728\u5b50\u6811\u4e2d\n\t\tp=(p*reg[j])%MOD;\n        //\u8ba1\u7b97\u524d\u7f00\u79ef\n\t}\n\treturn;\n}\nvoid dfs(int t,int fa){\n\tint s=1;\n\tfor(int i=hed[t];i;i=nxt[i]) s=(s*(f[edg[i]]+1))%MOD;   //\u66f4\u65b0\u8be5\u8282\u70b9\n\tans[t]=s;\n\tfor(int i=hed[t];i;i=nxt[i]){\n\t\tif(edg[i]==fa) continue;\n\t\tf[t]=(v[edg[i]]*(f[fa]+1))%MOD;\n\t\t//\u8c03\u7528\u4e4b\u524d\u5df2\u7ecf\u8fd0\u7b97\u7684\u540e\u7f00\u79ef*\u524d\u7f00\u79ef\n\t\tdfs(edg[i],t);\n\t}\n\treturn;\n}\n```",
        "postTime": 1597214474,
        "uid": 31518,
        "name": "zhr1502",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    },
    {
        "content": "\u6362\u6839 dp\n\n\u5148\u8003\u8651\u56fa\u5b9a\u6839\u7684\u60c5\u51b5\uff1a\u8bbe $f_i$ \u8868\u793a\u5b50\u6811 $i$ \u7684\u65b9\u6848\u6570\n\n\u5bf9\u4e8e\u53f6\u5b50\u8282\u70b9\uff0c\u663e\u7136 $f_i=1$\n\n\u8bbe\u5f53\u524d\u8282\u70b9\u4e3a $u$\uff0c\u5b83\u7684\u4e00\u4e2a\u513f\u5b50\u8282\u70b9\u4e3a $v$\uff0c\u82e5\u6539\u5584 $u\\rightarrow v$ \u7684\u8fb9\uff0c\u5219\u65b9\u6848\u4e3a $f_v$\uff1b\u82e5\u4e0d\u6539\u5584\uff0c\u5219\u65b9\u6848\u4e3a $1$\n\n\u6240\u4ee5 $f_u=\\prod\\limits_{v\\in son(u)}(f_v+1)$\n\n\u8003\u8651\u5c06 $u$ \u4ece\u6839\u53d8\u4e3a $v$ \u7684\u513f\u5b50\uff0c\u5219 $f'_u=\\dfrac{f_u}{f_v+1}=\\prod\\limits_{j\\in son(u),j\\neq v}(f_j+1)$\n\n\u8fd9\u4e2a\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u79ef\u4e00\u4e2a\u540e\u7f00\u79ef\u5373\u53ef\n\n```cpp\n//timeuse:15min\nconst int N = 200010,M = N;\nint n;EE(1);\nll dp[N],ans[N];\nvoid dfs1(int u,int fa)\n{\n\tdp[u] = 1;\n\tfor(int i = head[u],v;i;i = e[i].nxt) if((v = e[i].to) != fa)\n\t\tdfs1(v,u),dp[u] = dp[u] * (dp[v] + 1) % mod;\n}\nvoid dfs2(int u,int fa)\n{\n    ans[u] = 1;vector<ll> pre,suf;\n    int tot = 0;\n    for(int i = head[u];i;i = e[i].nxt)\n\t{\n\t\tint v = e[i].to;\n\t\tans[u] = ans[u] * (dp[v] + 1) % mod;\n\t\tif(v != fa) pre.push_back(dp[v] + 1),suf.push_back(dp[v] + 1),tot++;\n\t}\n\tfor(int i = 1;i < tot;i++) pre[i] = pre[i] * pre[i - 1] % mod;\n\tfor(int i = tot - 2;i >= 0;i--) suf[i] = suf[i] * suf[i + 1] % mod;\n    int now = 0;\n    for(int i = head[u],v;i;i = e[i].nxt) if((v = e[i].to) != fa)\n\t{\n\t\tdp[u] = dp[fa] + 1;\n\t\tif(now > 0) dp[u] = dp[u] * pre[now - 1] % mod;\n        if(now < tot - 1) dp[u] = dp[u] * suf[now + 1] % mod;\n        dfs2(v,u),now++;\n    }\n}\nint main()\n{\n\tn = read();for(int i = 2;i <= n;i++) add_edge(read(),i);\n\tdfs1(1,0),dfs2(1,0);\n    for(int i = 1;i <= n;i++) pprint(ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1593144855,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    },
    {
        "content": "\u4ee5\u4e0b\u7684\u8f6c\u79fb\u65b9\u7a0b\u5747\u5728\u6a21 $10^9+7$ \u610f\u4e49\u4e0b\u8fdb\u884c\n\n\u8bbe $f_i$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u9996\u90fd\u4e3a $i$ \u65f6\u6539\u826f\u9053\u8def\u7684\u65b9\u6848\u6570\uff0c\u5219\u6709\n$$f_i=\\prod_{j \\in \\text{son}(i)} (f_j+1)$$\n$f_j$ \u4ee3\u8868\u6539\u826f $i$ \u5230 $j$ \u8fd9\u6761\u8def\uff0c$1$ \u4ee3\u8868\u4e0d\u6539\u826f $i$ \u5230 $j$ \u8fd9\u6761\u8def\uff08\u6b64\u65f6\u4ee5 $j$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u9053\u8def\u5fc5\u987b\u5168\u90e8\u88ab\u6539\u826f\uff0c\u6545\u53ea\u6709 $1$ \u79cd\uff09\n\n\u4e4b\u540e\u8003\u8651\u6362\u6839 dp\uff0c\u8bbe $g_i$ \u4e3a\u9996\u90fd\u4e3a $i$ \u65f6\u9053\u8def\u6539\u826f\u7684\u65b9\u6848\u6570\uff0c\u5219\n$$g_i=f_i\\left(\\frac{g_{\\text{father}(i)}}{f_i+1}+1\\right)$$\n\u518d\u4ee4 $f_i=g_i$\uff0c\u6c42\u89e3\u5b50\u6811\u5373\u53ef\n\n\u4f46\u8fd9\u6837\u5c31\u5b8c\u4e86\u5417\uff1f\u4e0d\u662f\u7684\uff0c\u5982\u679c $f_i+1=0$ \u4e0a\u5f0f\u5c31\u70b8\u4e86\u3002\u4e8e\u662f\u8bbe $h_i$ \u8868\u793a\u53bb\u6389\u4e00\u4e2a\u6ee1\u8db3 $f_j+1=0$ \u7684\u4ee5 $j$ \u4e3a\u6839\u7684\u5b50\u6811\u540e\u6539\u826f\u9053\u8def\u7684\u65b9\u6848\u6570\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e0d\u7ba1\u53bb\u6389\u54ea\u68f5\u5b50\u6811 $h_i$ \u90fd\u662f\u4e00\u6837\u7684\u3002\u8f6c\u79fb\u65b9\u7a0b\u4e0d\u592a\u597d\u89e3\u91ca\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\n\n```cpp\nvoid get_f(int i, int father) {\n\tbool flag = false; //\u6709\u6ca1\u6709\u53bb\u6389\u8fc7\u65b9\u6848\u6570\u4e3a0\u7684\u5b50\u6811 \n\tf[i] = h[i] = 1; //\u522b\u5fd8\u4e86\u7ed9h\u8d4b\u521d\u59cb\u503c \n\tfor(int j = 0; j < (int)G[i].size(); ++j) {\n\t\tint s = G[i][j];\n\t\tif(s != father) {\n\t\t\tget_f(s, i);\n\t\t\tf[i] = 1LL*f[i]*(f[s] + 1)%MOD; \n\t\t\tif(f[s] + 1 != MOD || flag == true) //\u5b50\u6811\u65b9\u6848\u6570\u4e0d\u4e3a0 \u6216 \u5df2\u7ecf\u53bb\u6389\u4e00\u4e2a\u65b9\u6848\u6570\u4e3a0\u7684\u5b50\u6811\u4e86 \n\t\t\t\th[i] = 1LL*h[i]*(f[s] + 1)%MOD; //\u6ce8\u610f\u662f\u4e58\uff0c\u4e0d\u662f\u76f4\u63a5\u8d4bf[i] \n\t\t\telse //\u5b50\u6811\u65b9\u6848\u6570\u4e3a0 \u4e14 \u6ca1\u6709\u53bb\u6389\u8fc7\u65b9\u6848\u6570\u4e3a0\u7684\u5b50\u6811 \n\t\t\t\tflag = true; //\u628a\u5f53\u524d\u5b50\u6811\u53bb\u6389\uff0c\u66f4\u65b0\u6807\u8bb0 \n\t\t}\n\t}\n}\n```\n\n\u7136\u540e\u5c31\u662f\u6362\u6839\uff0c\u6ce8\u610f\u53ca\u65f6\u66f4\u65b0 $f_i$ \u548c $h_i$\n\n```cpp\nvoid get_g(int i, int father) {\n\t//\u8fd9\u91cc\u662f\u7528g[i]\u8f6c\u79fb\u5230g[son(i)] \n\tfor(int j = 0; j < (int)G[i].size(); ++j) {\n\t\tint s = G[i][j];\n\t\tif(s != father) {\n\t\t\tint fs = f[s], fi = (fs + 1 == MOD ? h[i] : 1LL*f[i]*inv(fs + 1)%MOD), hs = h[s];\n\t\t\t//fs\u8868\u793a\u9898\u89e3\u4e2d\u7684f[i]\uff0cfi\u8868\u793a\u9898\u89e3\u4e2d\u7684g[father(i)]\uff0chs\u8868\u793a\u9898\u89e3\u4e2d\u7684h[i] \n\t\t\tg[s] = f[s] = 1LL*fs*(fi + 1)%MOD;\n\t\t\tif(f[s] != 0 || fs == 0) //\u6ca1\u6709\u65b9\u6848\u6570\u4e3a0\u7684\u5b50\u6811 \u6216 \u5df2\u7ecf\u53bb\u6389\u8fc7\u65b9\u6848\u6570\u4e3a0\u7684\u5b50\u6811\u4e86 \n\t\t\t\th[s] = 1LL*h[s]*(fi + 1)%MOD; //\u6ce8\u610f\u8fd9\u91cc\u4e0d\u662f\u76f4\u63a5\u8d4bf[s] \n\t\t\tget_g(s, i);\n\t\t\tf[s] = fs, h[s] = hs; //\u56de\u6eaf \n\t\t}\n\t}\n}\n```",
        "postTime": 1617373349,
        "uid": 225734,
        "name": "derta",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011\u3010CF543D Road Improvement\u3011"
    },
    {
        "content": "\u82b1\u4e86\u6572\u4ee3\u7801\u6846\u67b6\u4e00\u500d\u591a\u7684\u65f6\u95f4\u89e3\u51b3\u9006\u5143\u7684\u95ee\u9898... (\n\n## \u89e3\u6790\n\n\u9898\u76ee\u8981\u6c42\u6c42\u51fa\u4ee5\u6bcf\u4e2a\u70b9\u4e3a\u9996\u90fd\u7684\u7b54\u6848\uff0c\u5df2\u7ecf\u975e\u5e38\u660e\u663e\u5730\u63d0\u793a\u6362\u6839 dp \u4e86\n\n\u9996\u5148\u8003\u8651\u56fa\u5b9a\u9996\u90fd\u8be5\u600e\u4e48\u505a\n\n\u8fd9\u4e2a\u8fd8\u662f\u633a\u663e\u7136\u7684\u3002\u5982\u679c\u786e\u5b9a\u4e00\u4e2a\u70b9\u5230\u6839\u7684\u8def\u5f84\u4e0a\u7684\u67d0\u6761\u8fb9\u662f\u4e0d\u826f\u7684\uff0c\u663e\u7136\u518d\u5f80\u4e0a\u90fd\u4e0d\u53ef\u80fd\u518d\u653e\u7f6e\u4e0d\u826f\u7684\u8fb9\u4e86\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6\u67d0\u4e2a\u5b50\u6811\u4e2d\u5b58\u5728\u4e0d\u826f\u7684\u8fb9\uff0c\u90a3\u4e48\u8fd9\u9897\u5b50\u6811\u6839\u5230\u5b83\u7236\u4eb2\uff08\u4e43\u81f3\u5230\u6574\u68f5\u6811\u6839\uff09\u7684\u8fb9\u4e00\u5b9a\u662f\u826f\u7684\n\n\u4e8e\u662f\u72b6\u6001\u5c31\u53ef\u4ee5\u8bbe\u4e3a\uff1a$dp(u, 1/0)$\uff0c\u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u662f/\u5426\u542b\u6709\u4e0d\u826f\u7684\u9053\u8def\uff0c\u7684\u6240\u6709\u53ef\u80fd\u7684\u65b9\u6848\u6570\n\n\u63a5\u4e0b\u6765\u8003\u8651\u8f6c\u79fb\uff0c\n\n\u6ce8\u610f\u5230\uff0c\u5982\u679c\u4e00\u9897\u5b50\u6811\u53ea\u542b\u6709\u826f\u7684\u9053\u8def\uff0c\u90a3\u4e48\u5b83\u6709\u4e14\u4ec5\u6709\u4e00\u79cd\u65b9\u6848\u3002\u4e8e\u662f\u6211\u4eec\u6ca1\u5fc5\u8981\u7279\u5730\u5f00\u6570\u7ec4\u8bb0\u5f55\u8fd9\u7c7b\u72b6\u6001\n\n\u63a5\u7740\u8003\u8651\u8f6c\u79fb\u542b\u6709\u4e0d\u826f\u9053\u8def\u7684\u72b6\u6001\u3002\u5bf9\u4e8e\u6709\u4e0d\u826f\u9053\u8def\u7684\u5b50\u6811\u53ea\u80fd\u653e\u7f6e\u826f\u9053\u8def\uff1b\u5bf9\u4e8e\u6ca1\u6709\u4e0d\u826f\u9053\u8def\u7684\u5b50\u6811\u65e2\u53ef\u4ee5\u653e\u4e5f\u53ef\u4ee5\u4e0d\u653e\u826f\u9053\u8def\u2014\u2014\u56e0\u4e3a\u53ea\u8981\u6709\u4e00\u9897\u5b50\u6811\u6216\u548c\u8fd9\u9897\u5b50\u6811\u4e4b\u95f4\u7684\u9053\u8def\u662f\u4e0d\u826f\u7684\u5c31\u53ef\u4ee5\u4e86\n\n\u5728\u679a\u4e3e\u6bcf\u9897\u5b50\u6811\u65f6\u8003\u8651\u53ef\u80fd\u9519\u8bef\u7edf\u8ba1\u7684\u6ca1\u6709\u4e0d\u826f\u9053\u8def\u7684\u72b6\u6001\u4f1a\u5f88\u590d\u6742\uff1b\u5b9e\u9645\u4e0a\uff0c\u4e0d\u542b\u6709\u4e0d\u826f\u9053\u8def\u7684\u72b6\u6001\u6709\u4e14\u4ec5\u6709\u4e00\u79cd\uff0c\u6211\u4eec\u5728**\u6700\u540e\u51cf\u6389**\u5c31\u53ef\u4ee5\u4e86\n\n\u542b\u6709\u4e0d\u826f\u9053\u8def\u72b6\u6001\u7684\u8f6c\u79fb\u65b9\u7a0b\u5c31\u4e3a\uff1a$dp(u, 1) =\\prod\\limits_v(dp(v, 1)+2dp(v, 0))-1$\uff0c\u5176\u4e2d $v$ \u662f $u$ \u7684\u513f\u5b50\u3002\u8fd9\u4e2a\u65b9\u7a0b\u4e5f\u53ef\u4ee5\u5199\u4e3a $dp(u, 1) =\\prod\\limits_v(dp(v, 1)+2)-1$\n\n&nbsp;\n\n\u81f3\u4e8e\u6362\u6839\uff0c\u53ef\u4ee5\u60f3\u5230\u53ea\u8981\u9664\u6389\u5f53\u524d\u5b50\u6811\u7684\u8d21\u732e\u5373\u53ef\uff0c\u9898\u76ee\u8981\u6c42\u6a21\u6570\u90a3\u4e48\u6c42\u9006\u5143\u5373\u53ef\n\n\u4f46\u6ce8\u610f\u5230\uff0c\u5728\u4e2a\u522b\u60c5\u51b5\u4e0b\u8fde\u4e58\u4e2d**\u662f\u53ef\u80fd\u5b58\u5728 $0$ \u7684**\uff1b\u4e8e\u662f\u8003\u8651\u5904\u7406\u8fde\u4e58\u7684\u524d\u7f00/\u540e\u7f00\u79ef\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba1\u7b97\u6ca1\u6709\u67d0\u4e2a\u5b50\u6811\u7684\u8d21\u732e\u4e86\uff08\u4e14\u80fd\u907f\u514d\u4e58 $0$ \u60c5\u51b5\uff09\n\n\u53e6\u5916\u8fd8\u8981\u6ce8\u610f\u5728\u6362\u6839 dfs \u4e2d\u4e5f\u8981\u7ef4\u62a4\u524d\u7f00/\u540e\u7f00\u79ef\u3002\u53ef\u4ee5\u60f3\u5230\u7236\u4eb2\u7ed3\u70b9\uff08\u4f5c\u4e3a\u5b50\u6811\uff09\u7684\u8d21\u732e\u662f**\u4e00\u5b9a\u8ba1\u5165**\u7684\uff0c\u4e8e\u662f\u7ed9\u524d\u7f00\u79ef**\u6216**\u540e\u7f00\u79ef\u7684\u6bcf\u4e00\u9879\u90fd\u4e58\u4e0a\u8fd9\u4e2a\u8d21\u732e\u5373\u53ef\n\n## CODE\n\n\u611f\u89c9\u6362\u6839 dp \u90e8\u5206\u7684\u72b6\u6001\u8bbe\u8ba1\u8fd8\u662f\u5f88\u7b80\u5355\u7684\uff0c\u4f46\u9006\u5143\u90e8\u5206\u7740\u5b9e\u5751\u5230\u4e86\u6211\uff08\n\n```cpp\n#include <cstdio>\n#include <vector>\nusing std::vector;\nusing std::min;\n\nconst int MAXN =2e5+50;\nconst int M =1e9+7;\n\ninline int del1(int x){ return (x == 0) ? M-1 : x-1; }\n\n/*------------------------------Times------------------------------*/\n\nvector<int> pre[MAXN], post[MAXN];/*\u524d\u7f00\u540e\u7f00\u79ef*/\n\nint qPow(int x, int k){\n\tint ans =1;\n\tfor(; k; x =1ll*x*x%M, k >>=1) if(k&1) ans =1ll*ans*x%M;\n\treturn ans;\n}\n\ninline int Inv(int x){ return qPow(x, M-2); }\n\n/*------------------------------Map------------------------------*/\n\nvector<int> E[MAXN];\nint son[MAXN];\n\n/*------------------------------Dfs------------------------------*/\n\nint dp[MAXN]/*\u5b50\u6811\u5185\u6709\u81f3\u5c11\u4e00\u6761\u4e0d\u826f\u9053\u8def\u4e14\u5408\u6cd5 ( \u8be5\u70b9\u5230\u5b50\u6811\u5185\u4efb\u610f\u70b9\u8def\u5f84\u6700\u591a\u4e00\u6761\u4e0d\u826f ) \u7684\u65b9\u6848\u6570*/;\n\nvoid dfs1(int u, int fa){\n\tdp[u] =1;\n\tint k =0;\n\tpre[u].push_back(1);\n\tfor(int v:E[u])\n\t\tif(v != fa){\n\t\t\tdfs1(v, u);\n\t\t\tdp[u] =1ll*dp[u]*(dp[v]+1+1)%M;/*\u5b50\u6811\u6709\u4e0d\u826f\u8be5\u8fb9\u826f\uff0c\u6216\u5b50\u6811\u5168\u826f (1) \u8be5\u8fb9\u4e0d\u826f\uff0c\u6216\u5b50\u6811\u5168\u826f\u8be5\u8fb9\u826f*/\n\t\t\t/*\u56e0\u4e3a\u53ea\u8981\u6709\u4e00\u4e2a\u513f\u5b50\u6709\u4e0d\u826f\u5373\u53ef*/\n\t\t\tpre[u].push_back(dp[u]);\n\t\t\t++k;\n\t\t}\n\t\n\tint tmp =1;\n\tpost[u].push_back(1);\n\tfor(int vi =E[u].size()-1; vi >= 0; --vi)\n\t\tif(E[u][vi] != fa){\n\t\t\ttmp =1ll*tmp*(dp[E[u][vi]]+1+1)%M;\n\t\t\tpost[u].push_back(tmp);\n\t\t}\n\t\n\tson[u] =k;\n\tdp[u] =del1(dp[u]);/*\u5bf9\u4e8e\u65e0\u513f\u5b50\uff0c\u8fd9\u4f1a\u4f7f\u8d21\u732e\u4e3a 0\uff1b\u5bf9\u4e8e\u6709\u513f\u5b50\uff0c\u8fd9\u4f1a\u51cf\u6389\u5168\u826f\u7684\u8d21\u732e*/\n}\n\nvoid dfs2(int u, int fa){\n\tint k =0;\n\tfor(int v:E[u])\n\t\tif(v != fa){\n\t\t\t++k;\n\t\t\tint res =del1(1ll*pre[u][k-1]*post[u][son[u]-k]%M);\n\t\t\tdp[v] =1ll*(dp[v]+1)*(res+1+1)%M;\n\t\t\tdp[v] =del1(dp[v]);\n\t\t\t/*\u7ef4\u62a4\u524d\u7f00\u540e\u7f00\u548c\uff0c\u5f62\u8c61\u7406\u89e3\u4e0b\u3002\u76f8\u5f53\u4e8e\u5728\u6700\u524d\u9762 ( \u6700\u540e\u9762\u4e5f\u53ef ) \u5f3a\u5236\u4e58\u4e00\u4e2a\u6570*/\n\t\t\tfor(int i =0; i < (int)pre[v].size(); ++i)\n\t\t\t\tpre[v][i] =1ll*pre[v][i]*(res+1+1)%M;\n\t\t//\tfor(int i =0; i < (int)post[v].size(); ++i)\n\t\t//\t\tpost[v][i] =1ll*post[v][i]*(res+1+1)%M;\n\t\t\tdfs2(v, u);\n\t\t}\n}\n\n/*------------------------------Main------------------------------*/\n\ninline int read(){\n\tint x =0; char c =getchar();\n\twhile(c < '0' || c > '9') c =getchar();\n\twhile(c >= '0' && c <= '9') x = (x<<3) + (x<<1) + (48^c), c =getchar();\n\treturn x;\n}\n\nint main(){\n\tint n =read();\n\tfor(int i =2; i <= n; ++i){\n\t\tint pi =read();\n\t\tE[i].push_back(pi), E[pi].push_back(i);\n\t}\n\tdfs1(1, 0);\n\tdfs2(1, 0);\n\tfor(int i =1; i <= n; ++i)\n\t\tprintf(\"%d \", (dp[i]+1)%M);\n}\n```",
        "postTime": 1599216634,
        "uid": 105254,
        "name": "Piwry",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF543D \u3010Road Improvement\u3011"
    }
]