[
    {
        "content": "### \u9898\u610f:\n\n\u7ed9\u4f60 $n$ \u4e2a\u70b9\uff0c\u5df2\u77e5 $m$ \u5bf9\u5173\u7cfb $[u,v] (|u - v| \\leq k)$\uff0c$k$ \u7ed9\u51fa\uff0c\u8be2\u95ee $q$ \u6b21\uff0c\u6bcf\u6b21\u95ee\u4f60 $[l,r]$ \u6709\u591a\u5c11\u4e2a\u8fde\u901a\u5757\u3002\n\n### sol:\n\n\u663e\u7136\u7684\u56de\u6eda\u83ab\u961f\uff0c\u6211\u4eec\u6309\u5757\u6765\u5206\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5757 $i$\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6240\u6709 $l\\in block_i$ \u4e22\u5230 $i$ \u91cc\u9762\uff0c\u7136\u540e\u6211\u4eec\u5bf9 $r$ \u6392\u5e8f\uff0c\u53f3\u6307\u9488\u5411\u53f3\u79fb\u52a8\uff0c\u7136\u540e\u5de6\u6307\u9488\u90a3\u8fb9\u64a4\u9500\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6 $n \\sqrt n \\log n$\uff0c\u5982\u679c\u5728\u540c\u4e00\u5757\u7684\u8bdd\u76f4\u63a5\u66b4\u529b\u64a4\u9500\u5c31\u597d\u4e86\u3002\n\n```cpp\n// powered by c++11\n// by Isaunoya\n#include <bits/stdc++.h>\n\n#define rep(i, x, y) for (register int i = (x); i <= (y); ++i)\n#define Rep(i, x, y) for (register int i = (x); i >= (y); --i)\n\nusing namespace std;\nusing db = double;\nusing ll = long long;\nusing uint = unsigned int;\nusing ull = unsigned long long;\n\nusing pii = pair<int, int>;\n\n#define fir first\n#define sec second\n\ntemplate <class T>\n\nvoid cmax(T& x, const T& y) {\n  if (x < y) x = y;\n}\n\ntemplate <class T>\n\nvoid cmin(T& x, const T& y) {\n  if (x > y) x = y;\n}\n\n#define all(v) v.begin(), v.end()\n#define sz(v) ((int)v.size())\n#define pb emplace_back\n\ntemplate <class T>\n\nvoid sort(vector<T>& v) {\n  sort(all(v));\n}\n\ntemplate <class T>\n\nvoid reverse(vector<T>& v) {\n  reverse(all(v));\n}\n\ntemplate <class T>\n\nvoid unique(vector<T>& v) {\n  sort(all(v)), v.erase(unique(all(v)), v.end());\n}\n\nvoid reverse(string& s) { reverse(s.begin(), s.end()); }\n\nconst int io_size = 1 << 23 | 233;\nconst int io_limit = 1 << 22;\nstruct io_in {\n  char ch;\n#ifndef __WIN64\n  char getchar() {\n    static char buf[io_size], *p1 = buf, *p2 = buf;\n\n    return (p1 == p2) && (p2 = (p1 = buf) + fread(buf, 1, io_size, stdin), p1 == p2) ? EOF : *p1++;\n  }\n#endif\n  io_in& operator>>(char& c) {\n    for (c = getchar(); isspace(c); c = getchar())\n      ;\n\n    return *this;\n  }\n  io_in& operator>>(string& s) {\n    for (s.clear(); isspace(ch = getchar());)\n      ;\n\n    if (!~ch) return *this;\n\n    for (s = ch; !isspace(ch = getchar()) && ~ch; s += ch)\n      ;\n\n    return *this;\n  }\n\n  io_in& operator>>(char* str) {\n    char* cur = str;\n    while (*cur) *cur++ = 0;\n\n    for (cur = str; isspace(ch = getchar());)\n      ;\n    if (!~ch) return *this;\n\n    for (*cur = ch; !isspace(ch = getchar()) && ~ch; *++cur = ch)\n      ;\n\n    return *++cur = 0, *this;\n  }\n\n  template <class T>\n\n  void read(T& x) {\n    bool f = 0;\n    while ((ch = getchar()) < 48 && ~ch) f ^= (ch == 45);\n\n    x = ~ch ? (ch ^ 48) : 0;\n    while ((ch = getchar()) > 47) x = x * 10 + (ch ^ 48);\n    x = f ? -x : x;\n  }\n\n  io_in& operator>>(int& x) { return read(x), *this; }\n\n  io_in& operator>>(ll& x) { return read(x), *this; }\n\n  io_in& operator>>(uint& x) { return read(x), *this; }\n\n  io_in& operator>>(ull& x) { return read(x), *this; }\n\n  io_in& operator>>(db& x) {\n    read(x);\n    bool f = x < 0;\n    x = f ? -x : x;\n    if (ch ^ '.') return *this;\n\n    double d = 0.1;\n    while ((ch = getchar()) > 47) x += d * (ch ^ 48), d *= .1;\n    return x = f ? -x : x, *this;\n  }\n} in;\n\nstruct io_out {\n  char buf[io_size], *s = buf;\n  int pw[233], st[233];\n\n  io_out() {\n    set(7);\n    rep(i, pw[0] = 1, 9) pw[i] = pw[i - 1] * 10;\n  }\n\n  ~io_out() { flush(); }\n\n  void io_chk() {\n    if (s - buf > io_limit) flush();\n  }\n\n  void flush() { fwrite(buf, 1, s - buf, stdout), fflush(stdout), s = buf; }\n\n  io_out& operator<<(char c) { return *s++ = c, *this; }\n\n  io_out& operator<<(string str) {\n    for (char c : str) *s++ = c;\n    return io_chk(), *this;\n  }\n\n  io_out& operator<<(char* str) {\n    char* cur = str;\n    while (*cur) *s++ = *cur++;\n    return io_chk(), *this;\n  }\n\n  template <class T>\n\n  void write(T x) {\n    if (x < 0) *s++ = '-', x = -x;\n\n    do {\n      st[++st[0]] = x % 10, x /= 10;\n    } while (x);\n\n    while (st[0]) *s++ = st[st[0]--] ^ 48;\n  }\n\n  io_out& operator<<(int x) { return write(x), io_chk(), *this; }\n\n  io_out& operator<<(ll x) { return write(x), io_chk(), *this; }\n\n  io_out& operator<<(uint x) { return write(x), io_chk(), *this; }\n\n  io_out& operator<<(ull x) { return write(x), io_chk(), *this; }\n\n  int len, lft, rig;\n\n  void set(int _length) { len = _length; }\n\n  io_out& operator<<(db x) {\n    bool f = x < 0;\n    x = f ? -x : x, lft = x, rig = 1. * (x - lft) * pw[len];\n    return write(f ? -lft : lft), *s++ = '.', write(rig), io_chk(), *this;\n  }\n} out;\n#define int long long\n\ntemplate <int sz, int mod>\n\nstruct math_t {\n  math_t() {\n    fac.resize(sz + 1), ifac.resize(sz + 1);\n    rep(i, fac[0] = 1, sz) fac[i] = fac[i - 1] * i % mod;\n\n    ifac[sz] = inv(fac[sz]);\n    Rep(i, sz - 1, 0) ifac[i] = ifac[i + 1] * (i + 1) % mod;\n  }\n\n  vector<int> fac, ifac;\n\n  int qpow(int x, int y) {\n    int ans = 1;\n    for (; y; y >>= 1, x = x * x % mod)\n      if (y & 1) ans = ans * x % mod;\n    return ans;\n  }\n\n  int inv(int x) { return qpow(x, mod - 2); }\n\n  int C(int n, int m) {\n    if (n < 0 || m < 0 || n < m) return 0;\n    return fac[n] * ifac[m] % mod * ifac[n - m] % mod;\n  }\n};\n\nint gcd(int x, int y) { return !y ? x : gcd(y, x % y); }\nint lcm(int x, int y) { return x * y / gcd(x, y); }\n\nconst int maxn = 1e5 + 51;\nconst int S = 500;\n\nint n, k, _;\nstruct qry {\n  int l, r, id;\n  bool operator<(const qry& other) const { return r < other.r; }\n};\n\nvector<qry> v[S];\nbool L[maxn][6], R[maxn][6];\n\nstruct dsu {\n  int fa[maxn], sz[maxn];\n  int st[maxn], top = 0;\n\n  void init() { rep(i, 1, maxn - 1) sz[fa[i] = i] = 1; }\n\n  int find(int x) { return fa[x] == x ? x : find(fa[x]); }\n\n  void clear() {\n    while (top) {\n      int x = st[top--];\n      sz[fa[x]] -= sz[x];\n      fa[x] = x;\n    }\n  }\n\n  void merge(int x, int y, bool ins = 1) {\n    if (sz[x] < sz[y]) x ^= y ^= x ^= y;\n    sz[x] += sz[y];\n    fa[y] = x;\n    if (ins) st[++top] = y;\n  }\n} dsu;\n\nint bel(int x) { return (x - 1) / S + 1; }\n\nint ans[maxn];\nvoid solve(const qry& now) {\n  const int l = now.l;\n  const int r = now.r;\n  const int id = now.id;\n  int cnt = r - l + 1;\n  rep(i, l, r) {\n    for (int j = 1; j <= k && i + j <= r; j++) {\n      if (R[i][j]) {\n        int x = dsu.find(i);\n        int y = dsu.find(i + j);\n        if (x ^ y) {\n          cnt--;\n          dsu.merge(x, y);\n        }\n      }\n    }\n  }\n  ans[id] = cnt;\n  dsu.clear();\n}\nsigned main() {\n  // code begin.\n  in >> n >> k >> _;\n  dsu.init();\n  while (_--) {\n    int u, v;\n    in >> u >> v;\n    if (u > v) u ^= v ^= u ^= v;\n    L[v][v - u] = R[u][v - u] = 1;\n  }\n  in >> _;\n  rep(i, 1, _) {\n    qry now;\n    in >> now.l >> now.r;\n    now.id = i;\n    if (now.r - now.l <= S)\n      solve(now);\n    else\n      v[bel(now.l)].pb(now);\n  }\n  rep(i, 1, bel(n)) {\n    if (!sz(v[i])) continue;\n    sort(v[i]);\n    dsu.init();\n    int r = i * S, cnt = 0;\n    for (auto x : v[i]) {\n      const int ql = x.l;\n      const int qr = x.r;\n      const int id = x.id;\n      while (r < qr) {\n        ++r;\n        for (int j = 1; j <= k && r - j >= i * S; j++) {\n          if (L[r][j]) {\n            int x = dsu.find(r);\n            int y = dsu.find(r - j);\n            if (x ^ y) {\n              ++cnt;\n              dsu.merge(x, y, 0);\n            }\n          }\n        }\n      }\n      int now = cnt;\n      for (int l = i * S - 1; l >= ql; l--) {\n        rep(j, 1, k) {\n          if (R[l][j]) {\n            int x = dsu.find(l);\n            int y = dsu.find(l + j);\n            if (x ^ y) {\n              ++cnt;\n              dsu.merge(x, y);\n            }\n          }\n        }\n      }\n      ans[id] = qr - ql + 1;\n      ans[id] -= cnt;\n      cnt = now;\n      dsu.clear();\n    }\n  }\n  rep(i, 1, _) out << ans[i] << '\\n';\n  return 0;\n  // code end.\n}\n```",
        "postTime": 1585591791,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF763E \u3010Timofey and our friends animals\u3011"
    },
    {
        "content": "## 1.\u57fa\u672c\u601d\u8def\n\n\u89c2\u5bdf\u5230\u9898\u76ee\u53cd\u590d\u8be2\u95ee\u8fde\u7eed\u533a\u95f4\u7684\u4e00\u79cd\u96be\u4ee5\u7edf\u8ba1\u7684\u6743\u503c\uff0c\u65f6\u95f4\u4e3a $ 7s $\u3002\u4e0d\u96be\u60f3\u5230\u4f7f\u7528**\u83ab\u961f**\u3002\n\n\u540c\u65f6\uff0c\u9898\u76ee\u8be2\u95ee\u7684\u95ee\u9898\u548c\u8054\u901a\u5757\u6570\u91cf\u6709\u5173\uff0c\u8003\u8651\u4f7f\u7528**\u5e76\u67e5\u96c6**\u7ef4\u62a4\u3002\n\n\u60f3\u8981\u540c\u65f6\u5904\u7406\u70b9**\u589e\u52a0**\u548c**\u5220\u9664**\u662f\u5f88\u56f0\u96be\u7684\uff0c\u5c1d\u8bd5\u4f7f\u7528**\u56de\u6eda\u83ab\u961f**\uff0c\u5355\u72ec\u5bf9\u589e\u52a0\u64cd\u4f5c\u8fdb\u884c\u5904\u7406\u3002\n\n\u603b\u4f53\u65f6\u95f4\u590d\u6742\u5ea6 $ O(n \\sqrt{n} \\log n) $\u3002\n\n## 2.\u5177\u4f53\u7ec6\u8282\n\n\u7531\u4e8e\u6211\u4eec\u6709 $ k \\leq 5 $ \u7684\u9650\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e00\u4e2a\u70b9\u5b58\u4e24\u4e2a vector \u5206\u522b\u8868\u793a\u5f53\u524d\u70b9\u4e0e\u5de6\u8fb9\uff08\u7f16\u53f7\u66f4\u5c0f\uff09\u548c\u53f3\u8fb9\uff08\u7f16\u53f7\u66f4\u5927\uff09\u7684\u54ea\u4e9b\u70b9\u6709\u8fde\u8fb9\uff0c\u6bcf\u4e2a\u70b9\u6700\u591a\u53ea\u4f1a\u5360\u7528 $ O(k) $ \u7684\u7a7a\u95f4\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u4ed4\u7ec6\u770b\u4e00\u4e0b\u56de\u6eda\u83ab\u961f\u7684\u7ec6\u8282\u3002\n\n- $ l,r $ \u5728\u540c\u4e00\u5757\u5185\n\n\u5229\u7528**\u53ef\u64a4\u9500\u5e76\u67e5\u96c6**\u66b4\u529b\u5408\u5e76\uff0c\u7136\u540e\u66b4\u529b\u64a4\u9500\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6 $ O(\\sqrt{n}\\log n) $\u3002\n\n- $ l,r $ \u4e0d\u5728\u540c\u4e00\u5757\u5185\n\n\u5bf9\u5757\u5916\u7684\u90e8\u5206\u5148\u7528\u5e76\u67e5\u96c6\u6269\u5c55\uff0c\u7136\u540e\u5bf9\u5757\u5185\u90e8\u5206\u8fdb\u884c\u6269\u5c55\uff0c\u7edf\u8ba1\u7b54\u6848\u540e\u5bf9\u5757\u5185\u90e8\u5206\u64a4\u9500\u3002\n\n\u9664\u6b64\u4e4b\u5916\uff0c\u8981\u6ce8\u610f\u5230\u6211\u4eec\u65b0\u589e\u70b9\u65f6\u52a0\u8fb9\u4e0d\u8981\u8d85\u51fa\u8be2\u95ee $ [l,r] $ \u7684\u9650\u5236\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nconst int N=500005;\n\nint n,k,m,q,Ans[N],cnn,nowr;\nvector<int> tol[N],tor[N];\nstruct query{int l,r,id;}Q[N];\nint pos[N],_R[N],BAS;\n\nint prt[N],siz[N];\nstack< pair<int,int> > s;\nint fa(int s){return prt[s]==s?s:fa(prt[s]);}\nint merge(int x,int y)\n{\n\tx=fa(x),y=fa(y);\n\tif(x==y) return 0;\n\tif(siz[x]>siz[y]) swap(x,y);\n\tprt[x]=y,siz[y]+=siz[x];\n\ts.push({x,y});\n\treturn 1;\n}\nvoid del(int tot=s.size())\n{\n\twhile(tot--)\n\t{\n\t\tint x=s.top().first,y=s.top().second; s.pop();\n\t\tprt[x]=x,siz[y]-=siz[x];\n\t}\n}\n\nint add(int u,int lim,int tp)\n{\n\t++cnn;\n\tint rec=0;\n\tfor(auto v:tp?tor[u]:tol[u])\n\t\tif((tp?v<=lim:v>=lim)) rec+=merge(u,v);\n\tcnn-=rec;\n\treturn rec;\n}\nint main()\n{\n\tscanf(\"%d %d %d\",&n,&k,&m);\n\tBAS=(int)sqrt(n);\n\tfor(int i=1;i<=n;++i)\n\t\tprt[i]=i,siz[i]=1,pos[i]=(i-1)/BAS+1,_R[pos[i]]=i;\n\t\t\n\tfor(int i=1,x,y;i<=m;++i)\n\t{\n\t\tscanf(\"%d %d\",&x,&y);\n\t\tif(x>y) swap(x,y);\n\t\ttor[x].push_back(y),tol[y].push_back(x);\n\t}\n\tscanf(\"%d\",&q);\n\tfor(int i=1;i<=q;++i) scanf(\"%d %d\",&Q[i].l,&Q[i].r),Q[i].id=i;\n\t\n\tsort(Q+1,Q+q+1,[](query a,query b){return pos[a.l]==pos[b.l]?a.r<b.r:pos[a.l]<pos[b.l];});\n\tfor(int i=1;i<=q;++i)\n\t{\n\t\tint l=Q[i].l,r=Q[i].r;\n\t\tif(pos[l]!=pos[Q[i-1].l] || (pos[Q[i-1].l]==pos[Q[i-1].r]&&pos[l]!=pos[r]))\n\t\t\tdel(),cnn=0,nowr=_R[pos[l]];\n\t\tif(pos[l]==pos[r])\n\t\t{\n\t\t\tcnn=0;\n\t\t\tfor(int j=l,tmp;j<=r;++j) tmp=add(j,l,0);\n\t\t\tAns[Q[i].id]=cnn;\n\t\t\tdel();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint tmp=0,ctt=0;\n\t\t\twhile(nowr+1<=r) tmp=add(++nowr,_R[pos[l]]+1,0);\n\t\t\tint tmpcnn=cnn;\n\t\t\tfor(int j=_R[pos[l]];j>=l;--j) ctt+=add(j,nowr,1);\n\t\t\tAns[Q[i].id]=cnn;\n\t\t\tdel(ctt),cnn=tmpcnn;\n\t\t}\n\t}\n\tfor(int i=1;i<=q;++i) printf(\"%d\\n\",Ans[i]);\n}\n```\n",
        "postTime": 1685148916,
        "uid": 432127,
        "name": "Avocadooo",
        "ccfLevel": 0,
        "title": "CF763E-\u9898\u89e3"
    },
    {
        "content": "[$\\tt Link$](/problem/CF763E)\u3002\n\n## $\\tt Analysis$\n\n\u591a\u6b21\u3001\u533a\u95f4\u3001\u8be2\u95ee\u3001\u95ee\u9898\u4e0d\u5e38\u89c4\u2026\u2026\u8003\u8651 **\u83ab\u961f**\uff01\n\n\u5728\u83ab\u961f\u6307\u9488\u79fb\u52a8\u7684\u9014\u4e2d\uff0c$k$ \u5f88\u5c0f\uff0c\u56e0\u6b64\u8fb9\u53ef\u4ee5\u66b4\u529b\u52a0\u4e00\u4e2a\u70b9\u7684\u8fb9\u3002\n\n\u81f3\u4e8e\u8054\u901a\u5757\u4e2a\u6570\u2026\u2026\u8fd9\u4e2a\u5e76\u67e5\u96c6\u7ef4\u62a4\u5c31\u884c\u4e86\u3002\n\n\u5e76\u67e5\u96c6\u96be\u4ee5\u652f\u6301\u64a4\u9500\uff08\u4e0d\u7136\u5f88\u96be\u505a\u5230\u597d\u7684\u590d\u6742\u5ea6\uff09\u3002\u4e8e\u662f\u6211\u4eec\u628a\u83ab\u961f\u6362\u6210\u56de\u6eda\u83ab\u961f\uff0c\u7136\u540e\u5c31\u53ea\u9700\u8981\u666e\u901a\u5e76\u67e5\u96c6\u5c31\u884c\u4e86\u3002\n\n## $\\tt Details$\n\n\u83ab\u961f\u7684\u56de\u6eda\u90e8\u5206\u6700\u540e\u9700\u8981\u64a4\u9500\u6240\u6709\u5e76\u67e5\u96c6 `fa` \u7684\u6539\u53d8\u3002\n\n\u56e0\u6b64\u8fd9\u90e8\u5206\u7684\u5e76\u67e5\u96c6\u4e0d\u80fd\u8def\u5f84\u538b\u7f29\uff0c\u800c\u524d\u9762\u7684\u589e\u90e8\u5206\u53ef\u4ee5\u8def\u5f84\u538b\u7f29\u3002\n\n\u6240\u4ee5\u5982\u679c\u4e0d\u5199\u5e76\u67e5\u96c6\u6309\u79e9\u5408\u5e76\u53ef\u80fd\u4f1a\u6302\uff08\u4f46\u662f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u5199\u4e86\u6309\u79e9\u5408\u5e76\u6bd4\u4e0d\u5199\u5e38\u6570\u5927\u4e00\u70b9\uff09\u3002\n\n```cpp\n// C++20\n\nconst int N = 1e5 + 5,M = 5e5 + 5;\n\nint n,k,m,q,B,bl[N],ans[N];\nstd::vector<int> E[N],P;\nstd::vector<std::tuple<int,int,int>> clr;\nstd::tuple<int,int,int> Q[M];\nint fa[N],siz[N],cnt,p,r;\n\nint fnd(int i){ return i == fa[i] ? i : fa[i] = fnd(fa[i]); }\n\nint Fnd(int i){ return i == fa[i] ? i : Fnd(fa[i]); }\n\nint main(){\n\tscanf(\"%d%d%d\",&n,&k,&m);\n\tB = n / sqrt(m);\n\trep(i,1,n) bl[i] = (i - 1) / B + 1;\n\trep(i,1,m){\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tE[u].push_back(v);\n\t\tE[v].push_back(u);\n\t}\n\tscanf(\"%d\",&q);\n\tstd::iota(fa + 1,fa + n + 1,1);\n\trep(i,1,q){\n\t\tint l,r;\n\t\tscanf(\"%d%d\",&l,&r);\n\t\tQ[i] = std::make_tuple(l,r,i);\n\t\tif(bl[l] == bl[r]){\n\t\t\tans[i] = r - l + 1;\n\t\t\trep(u,l,r) for(int v : E[u])\n\t\t\t\tif(l <= v && v < u){\n\t\t\t\t\tint fu = fnd(u),fv = fnd(v);\n\t\t\t\t\tif(fu == fv) continue;\n\t\t\t\t\tfa[fu] = fv; --ans[i];\n\t\t\t\t}\n\t\t\tstd::iota(fa + l,fa + r + 1,l);\n\t\t}\n\t}\n\tauto cmp = [](auto a,auto b){\n\t\tauto[l1,r1,i1] = a; auto[l2,r2,i2] = b;\n\t\treturn bl[l1] == bl[l2] ? r1 < r2 : l1 < l2;\n\t};\n\tstd::sort(Q + 1,Q + q + 1,cmp);\n\trep(i,1,q){\n\t\tauto[L,R,id] = Q[i];\n\t\tauto[L_,R_,id_] = Q[i - 1];\n\t\tif(bl[L] != bl[L_]){\n\t\t\tp = r = ((bl[L] == bl[n]) ? n : bl[L] * B);\n\t\t\tcnt = 0; std::iota(fa + 1,fa + n + 1,1);\n\t\t}\n\t\tif(bl[L] == bl[R]) continue;\n\t\twhile(r < R){\n\t\t\t++cnt,++r;\n\t\t\tfor(int j : E[r])\n\t\t\tif(p < j && j < r){\n\t\t\t\tint fr = fnd(r),fj = fnd(j);\n\t\t\t\tif(fr == fj) continue;\n\t\t\t\tsiz[fr] > siz[fj] ? fa[fj] = fr : fa[fr] = fj; --cnt;\n\t\t\t}\n\t\t}\n\t\tint sum = p - L + 1;\n\t\tRep(l,p,L) for(int j : E[l])\n\t\t\tif(l < j && j <= R){\n\t\t\t\tint fl = Fnd(l),fj = Fnd(j);\n\t\t\t\tif(fl == fj) continue;\n\t\t\t\tclr.emplace_back(fj,fa[fj],siz[fj]);\n\t\t\t\tclr.emplace_back(fl,fa[fl],siz[fl]);\n\t\t\t\tsiz[fl] > siz[fj] ? fa[fj] = fl : fa[fl] = fj; --sum;\n\t\t\t}\n\t\tans[id] = sum + cnt;\n\t\tstd::ranges::reverse(clr);\n\t\tfor(auto[p,f,s] : clr) fa[p] = f,siz[p] = s;\n\t\tclr.clear(); \n\t}\n\trep(i,1,q) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1659443791,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "CF763E \u56de\u6eda\u83ab\u961f+\u5e76\u67e5\u96c6"
    },
    {
        "content": "\u589e\u52a0\u5f88\u7b80\u5355\uff0c\u5220\u9664\u5f88\u56f0\u96be\uff0c\u8003\u8651\u56de\u6eda\u83ab\u961f\u3002\u4e8e\u662f\u53ef\u64a4\u9500\u5e76\u67e5\u96c6\u6309\u79e9\u5408\u5e76\u5373\u53ef\u3002\n\n\u6ce8\u610f\u7ec6\u8282\uff0c\u53f3\u7aef\u70b9\u589e\u52a0\u65f6\u4e0d\u8981\u6dfb\u52a0\u5de6\u7aef\u70b9\u6240\u5728\u5757\u7684\u8fb9\uff0c\u8ba9\u5de6\u7aef\u70b9\u6dfb\u52a0\u65f6\u518d\u8003\u8651\uff0c\u4e0d\u7136\u662f\u9519\u7684\uff0c\u4f1a\u6dfb\u52a0\u5de6\u5757\u4e2d\u4e0d\u5728\u533a\u95f4\u5185\u7684\u70b9\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nk\\sqrt q\\log n)$\u3002",
        "postTime": 1685425654,
        "uid": 365107,
        "name": "Terac",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF763E Timofey and our friends animals"
    },
    {
        "content": "### \u601d\u8def\n\n\u4e0d\u4fee\u6539\u53ea\u67e5\u8be2\uff0c\u6570\u636e\u8303\u56f4 $10^5$\uff0c\u65f6\u9650 $7s$\uff0c\u4e8e\u662f\u60f3\u5230\u83ab\u961f\u3002\n\n\u9898\u76ee\u4fdd\u8bc1\u6bcf\u6761\u8fb9 $(u,v)$ \u6709 $\\left |u-v  \\right | \\le5$\uff0c\u6240\u4ee5\u6bcf\u4e2a\u70b9\u8fde\u7684\u8fb9\u6570\u6700\u591a $5$\uff0c\u4e8e\u662f\u83ab\u961f\u6269\u5c55\u4e00\u4e2a\u70b9\u4fbf\u53ef\u4ee5\u66b4\u529b\u8fde\u8fb9\u3002\n\n\u6c42\u8054\u901a\u5757\u7684\u6570\u91cf\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\uff0c\u590d\u6742\u5ea6\u591a\u4e2a $\\log$\uff0c\u603b\u5171 $\\operatorname{O}(n\\log (n) \\sqrt n)$\uff0c\u5728\u65f6\u9650 $7s$ \u7684\u60c5\u51b5\u4e0b\u975e\u5e38\u5408\u7406\u3002\n\n~~\u4e8e\u662f\u57fa\u672c\u4e0a\u8fd9\u9898\u5c31\u5b8c\u4e86\u3002~~\n\n### \u5b9e\u73b0\u7ec6\u8282\n\n\u8003\u8651\u5230\u83ab\u961f\u8981\u80fd\u52a0\u80fd\u5220\uff0c\u7136\u800c\u8def\u5f84\u538b\u7f29\u5e76\u67e5\u96c6\u53c8\u4e0d\u597d\u5220\uff0c\u6240\u4ee5\u5e72\u8106\u76f4\u63a5\u56de\u6eda\u83ab\u961f\uff0c\u53ea\u52a0\u4e0d\u5220\u3002\n\n\u8fd9\u91cc\u7ec6\u8bf4\u4e00\u4e0b\u56de\u6eda\u83ab\u961f\u7684\u7ec6\u8282\u5904\u7406\uff1a\n\n`fa` \u6570\u7ec4\u5c31\u662f\u5e76\u67e5\u96c6\u7528\u7684\u6570\u7ec4\u3002\n\n\u4ee4 $upd$ \u4e3a $l$ \u6240\u5728\u5757\u7684\u53f3\u7aef\u70b9\u3002\n\n- \u5bf9\u4e8e $l,r$ \u5728\u4e00\u4e2a\u5757\u4e2d\u7684\uff0c\u76f4\u63a5\u628a\u6574\u4e2a\u5757\u7684 `fa` \u6570\u7ec4\u521d\u59cb\u5316\uff0c\u7136\u540e\u66b4\u529b\u3002\n\n- \u5bf9\u4e8e $l,r$ \u4e0d\u5728\u4e00\u4e2a\u5757\u4e2d\u7684\uff0c\u660e\u663e\u4e0d\u80fd\u6bcf\u6b21\u90fd\u628a\u5f53\u524d\u5df2\u7ecf\u5904\u7406\u4e86 $upd+1 \\sim r$ \u7684 `fa` \u6570\u7ec4\u590d\u5236\u5230\u4e00\u4e2a\u65b0\u6570\u7ec4\u4e2d\u518d\u5904\u7406 $l\\sim upd$\uff0c\u4e8e\u662f\u53ea\u80fd\u7528\u53ef\u64a4\u9500\u5e76\u67e5\u96c6\uff0c\u6bcf\u6b21\u76f4\u63a5\u5728\u539f\u6570\u7ec4\u4e0a\u6539\uff0c\u8ba1\u7b97\u5b8c\u540e\u518d\u56de\u9000\u5230\u53ea\u6709 $upd+1\\sim r$ \u7684\u60c5\u51b5\u3002\n\n~~\u6240\u4ee5\u8fd8\u662f\u5f97\u53ef\u6301\u4e45\u5316\u3002~~\n\n### \u4ee3\u7801\n\n\u5177\u4f53\u5b9e\u73b0\u89c1\u6ce8\u91ca\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define endl '\\n'\nusing namespace std;\nint n,K,m,Q;\nint pos[100005],fa[100005],sz[100005];\nvector<int> el[100005],er[100005];\nstruct que{int l,r,id,ans;}q[100005];\nint find(int x){\n\twhile(fa[x]!=x) x=fa[x];\n\treturn x;\n}\nstack<pair<int,int>> ss;\nint merge(int x,int y){\n\tint fx=find(x),fy=find(y);\n\tif(fx==fy) return 0;\n\tif(sz[fx]>sz[fy]) swap(fx,fy);\n\tss.push({fx,fy});\n\tfa[fx]=fy,sz[fy]+=sz[fx];\n\treturn 1;\n}\n//\u5e76\u67e5\u96c6\u64a4\u9500\nvoid del(int lst){\n\twhile(ss.size()>lst){\n\t\tint fx=ss.top().first,fy=ss.top().second;\n\t\tfa[fx]=fx,sz[fy]-=sz[fx]; ss.pop();\n\t}\n}\nbool cmp_r(que a,que b){\n\tif(pos[a.l]==pos[b.l]) return a.r<b.r;\n\treturn pos[a.l]<pos[b.l];\n}\nbool cmp_id(que a,que b){return a.id<b.id;}\nsigned main(){\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tcin>>n>>K>>m;\n\tfor(int i=1;i<=m;i++){\n\t\tint x,y; cin>>x>>y;\n\t\tif(x>y) swap(x,y);\n\t\t//\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u5411\u5de6\u548c\u53f3\u8fde\u7684\u8fb9\uff0c\u5c11\u70b9\u679a\u4e3e\u5e38\u6570 \n\t\tel[x].push_back(y),er[y].push_back(x);\n\t}\n\tcin>>Q;\n\tfor(int i=1;i<=Q;i++){\n\t\tcin>>q[i].l>>q[i].r;\n\t\tq[i].id=i;\n\t}\n\tint len=sqrt(n);\n\tfor(int i=1;i<=n;i++) pos[i]=(i-1)/len+1;\n\tsort(q+1,q+Q+1,cmp_r);\n\t//now\u8bb0\u5f55\u7684\u662f\u5f53\u524d\u5c06r\u66f4\u65b0\u5230\u4e86\u54ea\u91cc \n\tint pk=0,now=0,nowans=0;\n\tfor(int i=1;i<=Q;i++){\n\t\t//L,R\u5c31\u662fl\u6240\u5728\u5757\u7684\u5de6\u53f3\u7aef\u70b9 \n\t\tint id=pos[q[i].l],L=(id-1)*len+1,R=id*len;\n\t\t//l\u7684\u5757\u548c\u524d\u4e00\u4e2a\u4e0d\u4e00\u6837\uff0c\u91cd\u7f6efa\u6570\u7ec4 \n\t\tif(pos[q[i].l]!=pos[q[i-1].l]) pk=0;\n\t\tif(L<=q[i].l && q[i].r<=R){ //\u540c\u5757\uff0c\u66b4\u529b \n\t\t\tint cnt=0; while(ss.size()) ss.pop();\n\t\t\tfor(int j=q[i].l;j<=q[i].r;j++) fa[j]=j,sz[j]=1;\n\t\t\tfor(int j=q[i].l;j<=q[i].r;j++){\n\t\t\t\tcnt++;\n\t\t\t\tfor(int to:er[j]){\n\t\t\t\t\tif(q[i].l<=to) cnt-=merge(to,j);\n\t\t\t\t}\n\t\t\t}\n\t\t\tq[i].ans=cnt;\n\t\t\tcontinue;\n\t\t}\n\t\tif(!pk){ //\u65b0\u5757\uff0c\u91cd\u7f6efa\uff0c\u66f4\u65b0now \n\t\t\tnowans=0; while(ss.size()) ss.pop();\n\t\t\tfor(int j=1;j<=n;j++) fa[j]=j,sz[j]=1;\n\t\t\tfor(int j=R+1;j<=q[i].r;j++){\n\t\t\t\tnowans++;\n\t\t\t\tfor(int to:er[j]){\n\t\t\t\t\tif(R<to) nowans-=merge(to,j);\n\t\t\t\t}\n\t\t\t}\n\t\t\tpk=1,now=q[i].r+1;\n\t\t}\n\t\t//\u5c06now\u66f4\u65b0\u5230\u5f53\u524d\u7684r \n\t\twhile(now<=q[i].r){\n\t\t\tnowans++;\n\t\t\tfor(int to:er[now]){\n\t\t\t\tif(R<to) nowans-=merge(to,now);\n\t\t\t}\n\t\t\tnow++;\n\t\t}\n\t\tint cnt=nowans,lst=ss.size();\n\t\t//\u52a0\u4e0al\u5230R\u7684\u8fb9 \n\t\tfor(int j=R;j>=q[i].l;j--){\n\t\t\tcnt++;\n\t\t\tfor(int to:el[j]){\n\t\t\t\tif(to<now) cnt-=merge(j,to);\n\t\t\t}\n\t\t}\n\t\tq[i].ans=cnt,del(lst); //\u56de\u9000 \n\t}\n\tsort(q+1,q+Q+1,cmp_id);\n\tfor(int i=1;i<=Q;i++) cout<<q[i].ans<<endl;\n\treturn 0;\n}\n```\n\n\u7801\u98ce\u4e0d\u597d\u89c1\u8c05 /kk",
        "postTime": 1685091669,
        "uid": 444235,
        "name": "Erinyes",
        "ccfLevel": 0,
        "title": "CF763E Timofey and our friends animals \u9898\u89e3"
    },
    {
        "content": "\u5982\u679c\u6ca1\u6709 $k$ \u7684\u9650\u5236\uff0c\u53ef\u4ee5\u901a\u8fc7\u6839\u53f7\u5206\u6cbb\u5c06\u5ea6\u6570\u5927\u4e8e $\\sqrt m$ \u7684\u8282\u70b9\u4e5f\u62ff\u51fa\u6765\u548c\u666e\u901a\u5206\u5757\u7684\u53f3\u7aef\u70b9\u53d6\u5e76\u91cd\u65b0\u5206\u5757\u3002\u8fd9\u6837\u7684\u56de\u6eda\u83ab\u961f\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u663e\u7136\u662f\u5bf9\u7684\u3002\n\n\u8003\u8651\u5ea6\u6570\u9650\u5236\u4e86\uff0c\u5c31\u76f4\u63a5\u56de\u6eda\u83ab\u961f\u7684\u65f6\u5019\u7528\u5e76\u67e5\u96c6\u66b4\u529b\u52a0\u8fb9\uff0c\u56de\u9000\u65f6\u7528\u4e00\u4e2a\u6808\u6765\u8f85\u52a9\u56de\u9000\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(2k m \\sqrt n \\log n)$ \u7684\u3002\n\n\u7ef4\u62a4\u7684\u4e1c\u897f\u5c31\u662f\u5f53\u524d\u662f\u4e0d\u662f\u5c5e\u4e8e\u4e00\u4e2a\u5e76\u67e5\u96c6\u91cc\u7684\uff0c\u5408\u5e76\u5c31\u8ba9\u8fde\u901a\u5757\u6570 $-1$ \u5426\u5219\u5c31\u4e0d\u53d8\u3002\n\n\u540c\u65f6\u9700\u8981\u6ce8\u610f\u5728\u65b0\u52a0\u5165\u4e00\u4e2a\u70b9\u65f6\u8fde\u901a\u5757\u7684\u4e2a\u6570\u4e5f\u8981 $+1$\u3002\n\n\u4e00\u4e2a\u5c0f\u4f18\u5316\u662f\u5bf9\u4e8e\u53f3\u7aef\u70b9\u7684\u5e76\u67e5\u96c6\u53ef\u4ee5\u4e0d\u8def\u5f84\u538b\u7f29\u3002\n\n\u5199\u5f00\u5934\u6240\u8ff0\u7684\u83ab\u961f\u662f $O(m \\sqrt n \\log n)$ \u7684\uff0c\u5e26\u7565\u5927\u5e38\u6570\u3002\n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\ninline int read() {\n    char ch = getchar();\n    int x = 0, f = 1;\n    while (ch < '0' || ch > '9') {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while ('0' <= ch && ch <= '9') {\n        x = x * 10 + ch - '0';\n        ch = getchar();\n    }\n    return x * f;\n}\ninline void write(int x) {\n    if (x < 0)\n        putchar('-'), x = -x;\n    if (x > 9)\n        write(x / 10);\n    putchar(x % 10 + '0');\n}\nconst int Len = 1e5 + 5;\nint n,k,m,q,t,as,block[Len],L[Len],R[Len],head[Len],cnt;\nstruct node\n{\n\tint next,to;\n}edge[Len * 10];\ninline void add(int from,int to)\n{\n\tedge[++ cnt].to = to;\n\tedge[cnt].next = head[from];\n\thead[from] = cnt;\n}\nstruct QQ\n{\n\tint l,r,id;\n\tQQ(){l = r = id = 0;}\n\tQQ(int L,int R,int ID){l = L , r = R , id = ID;}\n}sec[Len];\nstruct stkk\n{\n\tint u,v,sz;\n\tstkk(){u = v = sz = 0;}\n\tstkk(int U,int V,int SZ){u = U , v = V , sz = SZ;}\n};\nbool cmp(QQ x,QQ y)\n{\n\tif(block[x.l] == block[y.l]) return x.r < y.r;\n\treturn block[x.l] < block[y.l];\t\n}\nstruct Union\n{\n\tint fa[Len],siz[Len];\n\tstkk stk[Len];int top;\n\tinline void makeSet(int x){for(int i = 1 ; i <= x ; i ++) fa[i] = i , siz[i] = 1;}\n\tinline int findSet(int x)\n\t{\n\t\twhile(x != fa[x]) x = fa[x];\n\t\treturn x;\n\t}\n\tinline void unionSet(int x,int y,int &ass)\n\t{\n\t\tint u = findSet(x) , v = findSet(y);\n\t\tif(u == v) return;\n\t\tif(siz[u] < siz[v]) swap(u , v);\n\t\tstk[++ top] = stkk(u , v , siz[u]);\n\t\tass --;\n\t\tsiz[u] += siz[v];\n\t\tfa[v] = u;\n\t}\n\tinline void back(int tp){siz[stk[tp].u] = stk[tp].sz , fa[stk[tp].v] = stk[tp].v;}\n}T1,T2;\nint Print[Len],LL,RR;\ninline void Add(int x,int &ans)\n{\n\tans ++;\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tint to = edge[e].to;\n\t\tif(LL <= to && to <= RR){T1.unionSet(x , to , ans);}\n\t}\n}\nint main()\n{\n\tn = read() , k = read() , m = read();\n\tt = sqrt(n);\n\tfor(int i = 1 ; i <= t ; i ++) \n\t{\n\t\tL[i] = (i - 1) * t + 1;\n\t\tR[i] = i * t;\n\t}\n\tif(R[t] < n) R[t] = n;\n\tfor(int i = 1 ; i <= t ; i ++) for(int j = L[i] ; j <= R[i] ; j ++) block[j] = i;\n\tfor(int i = 1 ; i <= m ; i ++)\n\t{\n\t\tint x = read() , y = read();\n\t\tadd(x , y) , add(y , x);\n\t}\n\tq = read();\n\tfor(int i = 1 ; i <= q ; i ++) \n\t{\n\t\tsec[i].l = read();\n\t\tsec[i].r = read();\n\t\tsec[i].id = i;\n\t}\n\tsort(sec + 1 , sec + 1 + q , cmp);\n\tas = 0;int l = 1 , r = 0 , lst_blk = 0;\n\tT1.makeSet(n);\n\tT2.makeSet(n);\n\tfor(int i = 1 ; i <= q ; i ++) \n\t{\n\t\tif(block[sec[i].l] == block[sec[i].r])\n\t\t{\n\t\t\tT2.top = 0;\n\t\t\tint Ans = sec[i].r - sec[i].l + 1;\n\t\t\tfor(int j = sec[i].l ; j <= sec[i].r ; j ++) \n\t\t\t\tfor(int e = head[j] ; e ; e = edge[e].next)\n\t\t\t\t{\n\t\t\t\t\tint to = edge[e].to;\n\t\t\t\t\tif(sec[i].l <= to && to <= sec[i].r) T2.unionSet(j , to , Ans);\n\t\t\t\t}\n\t\t\tPrint[sec[i].id] = Ans;\n\t\t\tfor(int j = sec[i].l ; j <= sec[i].r ; j ++) T2.fa[j] = j , T2.siz[j] = 1;\n\t\t\tcontinue;\n\t\t}\n\t\tif(lst_blk != block[sec[i].l]) \n\t\t{\n\t\t\twhile(T1.top) T1.back(T1.top --);\n\t\t\tas = 0;\n\t\t\tlst_blk = block[sec[i].l];\n\t\t\tr = R[block[sec[i].l]] , l = R[block[sec[i].l]] + 1;\n\t\t\tLL = l , RR = r;\n\t\t}\n\t\twhile(r < sec[i].r) \n\t\t{\n\t\t\tRR = r + 1;\n\t\t\tAdd(++ r , as);\n\t\t}\n\t\tint tmpans = as , tmp = T1.top;\n\t\tint ll = l;\n\t\twhile(ll > sec[i].l) \n\t\t{\n\t\t\tLL = ll - 1;\n\t\t\tAdd(-- ll , tmpans);\n\t\t}\n\t\tPrint[sec[i].id] = tmpans;\n\t\tLL = l;\n\t\twhile(T1.top > tmp) T1.back(T1.top --);\n\t}\n\tfor(int i = 1 ; i <= q ; i ++) write(Print[i]) , putchar('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1662187401,
        "uid": 782894,
        "name": "Kuon",
        "ccfLevel": 0,
        "title": "\u6211\u613f\u6063\u610f\u98de\u4e0a\u4e07\u91cc\u65e0\u4e91\u7684\u5929\u7a7a"
    },
    {
        "content": "## \u524d\u8a00\n\u96be\u5ea6\uff1aEasy+\n\n\u5907\u6ce8\uff1a\u5199\u56de\u6eda\u83ab\u961f\u7684\u65f6\u5019\u8bb0\u5f97\u5220\u6389\u5947\u5076\u5757\u4f18\u5316\uff01\n## \u601d\u8def\n\u6211\u4eec\u53d1\u73b0\u56e0\u4e3a $|u-v|\\leq 5$\uff0c\u6240\u4ee5\u6bcf\u4e2a\u70b9\u6700\u591a\u6709 $10$ \u6761\u51fa\u8fb9\u3002\n\n\u4e8e\u662f\u6211\u4eec\u76f4\u63a5\u66b4\u529b\u4e0a\u56de\u6eda\u83ab\u961f\uff0c\u6bcf\u6b21\u65b0\u589e\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\u679a\u4e3e\u6240\u6709\u8fd9\u4e2a\u70b9\u7684\u51fa\u8fb9\uff0c\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u8fde\u901a\u5757\u5373\u53ef\u3002\n\n\u6bcf\u6b21\u52a0\u5165\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\u7b54\u6848 $+1$\uff0c\u5408\u5e76\u8fde\u901a\u5757\u7684\u65f6\u5019\u7b54\u6848 $-1$\u3002\n\n\u5728\u79fb\u52a8\u5de6\u7aef\u70b9\u7684\u65f6\u5019\u5e76\u67e5\u96c6\u66b4\u529b\u8df3 $fa$\uff0c\u79fb\u52a8\u53f3\u7aef\u70b9\u7684\u65f6\u5019\u5e76\u67e5\u96c6\u53ef\u4ee5\u8def\u5f84\u538b\u7f29\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u6211\u4e0d\u4f1a\u5206\u6790\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u63a5\u8fd1 $\\alpha(n)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nk\\sqrt m\\alpha(n))$\u3002\n## \u4ee3\u7801\nvp \u7684\u65f6\u5019\u5199\u5b8c C \u76f4\u63a5\u79d2\u6389 E\uff0c\u7ed3\u679c\u56e0\u4e3a\u4e0a\u9762\u90a3\u4e2a\u5907\u6ce8\u82e6\u75db\u4e86\u597d\u4e45\u3002\n\n```cpp\n// Problem: E. Timofey and our friends animals\n// Contest: Codeforces Round #395 (Div. 1)\n// URL: https://codeforces.com/contest/763/problem/E\n// Memory Limit: 256 MB\n// Time Limit: 7000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n//And in that light,I find deliverance.\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"unroll-loops\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nint to[100003][23],tc[100003];\nint n,m,B,res;\nstruct query\n{\n    int l,r,bl,id;\n    bool operator<(const query&t){return (bl<t.bl)||(bl==t.bl&&(r<t.r));}\n}q[100003];\nint ans[100003];\nint fa[100003],tfa[100003];\nint find_(int x)\n{\n\twhile(fa[x]!=x) x=fa[x];\n\treturn x;\n}\nint find(int x)\n{\n\treturn (fa[x]==x)?x:(fa[x]=find(fa[x]));\n}\nint tfind(int x)\n{\n\treturn (tfa[x]==x)?x:(tfa[x]=tfind(tfa[x]));\n}\nint pos[100003],pc;\nint val[100003];\nint tt[100003];\nsigned main()\n{\n\tn=read(),read();\n\tfor(int i=1; i<=n; ++i)\n\t\tfa[i]=tfa[i]=i;\n\tfor(int u,v,m=read(); m--;) \n\t\tu=read(),v=read(),to[u][++tc[u]]=v,to[v][++tc[v]]=u;\n\tm=read(),B=n/sqrt(m)+1;\n    for(int i=1; i<=m; ++i) \n    \tq[i].l=read(),q[i].r=read(),q[i].bl=q[i].l/B,q[i].id=i;\n    sort(q+1,q+m+1);\n    int C=0;\n    for(int r=0,L,i=1; i<=m; ++i)\n    {\n    \tif(i==1||q[i].bl!=q[i-1].bl)\n    \t{\n    \t\tr=(q[i].bl+1)*B-1,L=r,res=0;\n    \t\tfor(int j=1; j<=n; ++j) fa[j]=j;\n    \t}\n    \tif(q[i].l/B==q[i].r/B)\n    \t{\n    \t\tint res=q[i].r-q[i].l+1;\n    \t\tfor(int j=q[i].l; j<=q[i].r; ++j)\n    \t\t\tfor(int k=1; to[j][k]; ++k) \n    \t\t\t\tif(q[i].l<=to[j][k]&&to[j][k]<j&&tfind(to[j][k])!=tfind(j)) \n    \t\t\t\t\ttfa[tfind(j)]=tfind(to[j][k]),--res;\n    \t\tfor(int j=q[i].l; j<=q[i].r; ++j) tfa[j]=j;\n    \t\tans[q[i].id]=res;\n    \t}\n    \telse\n    \t{\n    \t\twhile(r<q[i].r)\n    \t\t{\n    \t\t\t++r,++res;\n    \t\t\tfor(int k=1; to[r][k]; ++k) \n    \t\t\t\tif(to[r][k]>L&&to[r][k]<r&&find(to[r][k])!=find(r))\n    \t\t\t\t\t fa[find(r)]=find(to[r][k]),--res;\n    \t\t}\n    \t\tassert(r==q[i].r);\n    \t\tint tr=res+L-q[i].l+1;\n    \t\tfor(int j=L; j>=q[i].l; --j)\n    \t\t\tfor(int k=1; to[j][k]; ++k) \n    \t\t\t\tif(to[j][k]>j&&to[j][k]<=r\n    \t\t\t\t&&find_(to[j][k])!=find_(j)) \n    \t\t\t\t\tval[++pc]=fa[find_(j)],\n    \t\t\t\t\tfa[pos[pc]=find_(j)]=find_(to[j][k]),\n    \t\t\t\t\t--tr;\n    \t\tfor(int j=pc; j>=1; --j) fa[pos[j]]=val[j];\n    \t\tpc=0;\n    \t\tans[q[i].id]=tr;\n    \t}\n    }\n    for(int i=1; i<=m; ++i) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1635754646,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF763E"
    },
    {
        "content": "\u9898\u610f:\n\n\u7ed9\u4f60 $n$ \u4e2a\u70b9\uff0c\u5df2\u77e5 $m$ \u5bf9\u5173\u7cfb $[u,v] \\ (|u - v| \\leq k)$ \u7ed9\u51fa\uff0c\u8be2\u95ee $q$ \u6b21\uff0c\u6bcf\u6b21\u95ee\u4f60 $[l,r]$ \u6709\u591a\u5c11\u4e2a\u8fde\u901a\u5757\u3002\n\n---\n\n\u6709\u591a\u5c11\u8054\u901a\u5757\uff1f\u8fd9\u4e0d\u662f\u53ea\u8981\u628a\u73af\u53bb\u6389\uff0c\u7136\u540e\u7b97\u4e00\u7b97 $[l,r]$ \u91cc\u9762\u7684\u8fb9\u6570\u5c31\u597d\u4e86\uff1f\uff08\u663e\u7136\u6309\u7167\u957f\u5ea6\u6392\u5e8f\uff0c\u6700\u957f\u7684\u8fb9\u82e5\u6784\u6210\u73af\u5219\u76f4\u63a5\u5ffd\u7565\uff0c\u7136\u540e\u533a\u95f4\u4e2d\u591a\u4e00\u4e2a\u8fb9\u5c31\u5c11\u4e00\u4e2a\u8054\u901a\u5757\uff09\n\n\u81f3\u4e8e\u600e\u4e48\u7b97\uff0c\u76f4\u63a5\u66b4\u529b\u524d\u7f00\u548c\u7ef4\u62a4\u7aef\u70b9\uff0c\u7136\u540e $O(k^2)$ \u679a\u4e3e\u54ea\u4e9b\u8fb9\u662f\u4e00\u4e2a\u7aef\u70b9\u5728\u533a\u95f4\u91cc\u7684\u51cf\u6389\u8d21\u732e\u5c31\u597d\u4e86\uff08\u5176\u4e2d $k \\leq 5$\uff09\u3002\u8981\u5565\u56de\u6eda\u83ab\u961f\uff0c\u8981\u5565\u7ebf\u6bb5\u6811\uff1f\n\n\u8fd9\u4e2a\u7ef4\u62a4\u7684\u529e\u6cd5\u591a\u5f97\u5f88\uff0c\u6211\u7684\u5177\u4f53\u505a\u6cd5\u662f\u5f00\u4e24\u4e2a\u524d\u7f00\u548c\u6570\u7ec4\u7eaa\u5f55\u5de6\u7aef\u70b9\u548c\u53f3\u7aef\u70b9\uff0c\u7136\u540e\u533a\u95f4 $[l,r]$ \u91cc\u8fb9\u7684\u4e2a\u6570\u5c31\u662f \n\n$$ Cnt1_{r}-Cnt2_{l-1}+Del $$\n\n\u8868\u793a\u5230 $r$ \u6240\u6709\u8fb9\u53f3\u7aef\u70b9\u7684\u548c \u51cf\u53bb \u5230 $l$ \u6240\u6709\u5de6\u7aef\u70b9\u7684\u548c \u52a0\u4e0a\u5de6\u7aef\u70b9\u5728 $[l,r]$ \u4f46\u53f3\u7aef\u70b9\u5927\u4e8e $r$ \u7684\u8fb9\u7684\u6570\u91cf\u3002\n\n---\n\n\u4ee3\u7801\uff1a\n\n```int Find(int a){return a==F[a]?a:F[a]=Find(F[a]);}\nint main(){\n    N=read();K=read();M=read();\n\tint Del=0,a,b;\n    for(int i=1;i<=M;++i){\n        a=read();b=read();\n        if(a>b)swap(a, b);\n        Ced[a][b-a]=true;\n    }\n    for(int i=1;i<=N;++i)F[i]=i;\n    for(int i=1;i<=K;++i)\n    for(int j=1, fx, fy;j<=N;++j){\n        if(!Ced[j][i])continue;\n        fx=Find(j);fy=Find(j+i);\n        if(fx!=fy){\n            Used[j][i]=true;\n            F[fx]=fy;\n        }\n    }\n    for(int i=1;i<=N;++i)for(int j=1;j<=K;++j)if(Used[i][j]){++Cnt1[i+j];++Cnt2[i];}\n    for(int i=1;i<=N;++i){Cnt1[i]+=Cnt1[i-1];Cnt2[i]+=Cnt2[i-1];}\n    Qcnt=read();\n\twhile(Qcnt--){\n\t\tDel=0;\n\t\ta=read();b=read();\n\t\tfor(int i=a-1;i+K>b;--i)\n\t\tfor(int k=K;i+k>b;--k)\n\t\tif(Used[i][k])++Del;\n\t\tprintf(\"%d\\n\", (b-a+1)-((Cnt1[b]-Cnt2[a-1])+Del));\n    }\n}\nint Find(int a){return a==F[a]?a:F[a]=Find(F[a]);}\nint main(){\n    N=read();K=read();M=read();\n\tint Del=0,a,b;\n    for(int i=1;i<=M;++i){\n        a=read();b=read();\n        if(a>b)swap(a, b);\n        Ced[a][b-a]=true;\n    }\n    for(int i=1;i<=N;++i)F[i]=i;\n    for(int i=1;i<=K;++i)\n    for(int j=1, fx, fy;j<=N;++j){\n        if(!Ced[j][i])continue;\n        fx=Find(j);fy=Find(j+i);\n        if(fx!=fy){\n            Used[j][i]=true;\n            F[fx]=fy;\n        }\n    }\n    for(int i=1;i<=N;++i)for(int j=1;j<=K;++j)if(Used[i][j]){++Cnt1[i+j];++Cnt2[i];}\n    for(int i=1;i<=N;++i){Cnt1[i]+=Cnt1[i-1];Cnt2[i]+=Cnt2[i-1];}\n    Qcnt=read();\n\twhile(Qcnt--){\n\t\tDel=0;\n\t\ta=read();b=read();\n\t\tfor(int i=a-1;i+K>b;--i)\n\t\tfor(int k=K;i+k>b;--k)\n\t\tif(Used[i][k])++Del;\n\t\tprintf(\"%d\\n\", (b-a+1)-((Cnt1[b]-Cnt2[a-1])+Del));\n    }\n}\n```\n",
        "postTime": 1604036192,
        "uid": 288460,
        "name": "xzggzh1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF763E \u3010Timofey and our friends animals\u3011"
    }
]