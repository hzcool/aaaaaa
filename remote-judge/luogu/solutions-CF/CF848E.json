[
    {
        "content": "### \u9898\u610f\n\n\u597d\u957f\u554a\uff0c\u800c\u4e14\u6211\u7684\u7ffb\u8bd1\u5e94\u8be5\u4e5f\u633a\u5bf9\u7684\uff0c\u4e8e\u662f\u5c31\u4e0d\u5199\u4e86\u3002\n\n$\\texttt{Data Range:}3\\leq n\\leq 5\\times 10^4$\n\n### \u524d\u8a00\n\n\u53d1\u73b0\u4e4b\u524d\u7684\u9898\u89e3\u5199\u7684\u949b\u5c51\u4e86\uff0c\u800c\u4e14\u8fd9\u9898\u7684\u89e3\u6cd5\u5dee\u4e0d\u591a\u8981\u5fd8\u6389\u4e86\uff0c\u4e8e\u662f\u91cd\u65b0\u5199\u4e00\u7bc7\u3002\n\n\u5f53\u65f6\u6211\u7b2c\u4e00\u6b21\u5199\u8fd9\u9898\u7684\u9898\u89e3\u7684\u65f6\u5019\u624d\u521a\u521a\u4e0a Expert\uff0c\u91cd\u65b0\u770b\u5230\u8fd9\u7bc7\u9898\u89e3\uff0c\u5c06\u73b0\u5728\u7684\u6211\u5bf9\u6bd4\u8d77\u8fc7\u53bb\u7684\u6211\uff0c\u771f\u662f\u611f\u6168\u4e07\u5343\u5462\u2026\u2026\n\n\u82f1\u6587\u9898\u9762\u5199\u7684\u4e5f\u662f\u5f88\u4f18\u96c5\uff0c\u201c\u5c3d\u7ba1\u4e0d\u80fd\u7559\u4f4f\u65f6\u95f4\uff0c\u4f46\u5b83\u63d0\u9192\u4eba\u4eec\u65f6\u95f4\u7684\u8fc7\u53bb\uff0c\u4f7f\u4eba\u4eec\u60f3\u8d77\u8fc7\u53bb\u7f8e\u597d\u7684\u65f6\u5149\u201d\uff0c\u6211\u7a76\u7adf\u80fd\u60f3\u8d77\u591a\u5c11\u8fc7\u53bb\u7f8e\u597d\u7684\u65f6\u5149\u5462\u2026\u2026\u54ce\u2026\u2026\u6211\u7684 OI \u751f\u6daf\uff0c\u5927\u6982\u4e5f\u5c31\u6ca1\u591a\u5c11\u7f8e\u597d\u7684\u65f6\u5149\u5427\u2026\u2026\n\n~~\u6700\u540e\u518d\u5410\u69fd\u4e00\u53e5\uff0c\u8fd9\u82f1\u6587\u9898\u9762\u53ef\u4ee5\u62c9\u51fa\u6765\u4f5c\u957f\u96be\u53e5\u5206\u6790\u4e86~~\n\n### \u9898\u89e3\n\n\u8fdb\u5165\u6b63\u9898\uff0c\u5982\u679c\u5927\u5bb6\u6709\u5174\u8da3\u53ef\u4ee5\u6765\u505a[\u8fd9\u9053\u9898](https://www.luogu.com.cn/problem/U124697)\u3002\u4e4b\u524d\u5728\u539f\u9898\u89e3\u4e2d\u7acb\u4e0b\u7684 flag\uff0c\u4e5f\u5e94\u8be5\u5b9e\u73b0\u4e86\u3002\n\n\u5199\u51fa $O(n\\log^2n)$ \u7684\u89e3\u6cd5\u5e94\u8be5\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u590d\u6742\u7684\uff0c\u5199\u51fa $O(n)$ \u7684\u89e3\u6cd5\u9700\u8981\u4e00\u5b9a\u7684\u751f\u6210\u51fd\u6570\u529f\u5e95\uff0c\u5199\u51fa $O(\\log n)$ \u7684\u8bdd\u5c31\u975e\u5e38\u4e0d\u5bb9\u6613\u4e86\u3002\n\n\u9996\u5148\u6211\u4eec\u4ece\u6700\u52a3\u7684\u89e3\u6cd5\u5f00\u59cb\u8c08\u8d77\u3002\n\n\u6ce8\u610f\u5230\u6392\u5217\u65b9\u5f0f\u7684\u5bf9\u79f0\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e2a\u73af\u62c6\u6210\u4e24\u4e2a\u534a\u73af\u3002\u5728\u786e\u5b9a\u4e86\u67d0\u4e00\u4e2a\u534a\u73af\u4e2d\u7ebf\u7684\u8fde\u63a5\u65b9\u5f0f\u4e4b\u540e\uff0c\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u51fa\u53e6\u4e00\u4e2a\u534a\u73af\u7684\u8fde\u63a5\u65b9\u5f0f\u3002\n\n\u63a5\u4e0b\u6765\u5b9a\u4e49\u4e00\u4e9b\u540d\u8bcd\u3002\n\n\u89c4\u5b9a $f_{0,i}$ \u8868\u793a\u67d0\u4e24\u6735\u82b1\u4e0e\u5b83\u4eec\u5bf9\u9762\u7684\u82b1\u8fde\u8d77\u6765\uff0c\u4e2d\u95f4\u5939\u7740 $i$ \u6735\u82b1\u7684\u7b54\u6848\uff0c\u8fd9\u6837\u7684\u56fe\u5f62\u6211\u4eec\u6682\u4e14\u79f0\u4f5c\u957f\u5ea6\u4e3a $i$ \u7684**\u6bb5**\u3002\u957f\u5ea6\u4e3a $7$ \u7684\u6bb5\u957f\u8fd9\u6837\uff1a\n\n![](https://codeforces.ml/predownloaded/4e/0e/4e0e0e8209dccb7251787215a5ad0e95731353ec.png)\n\n\u5f53\u7136\uff0c\u540e\u9762\u8fd8\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fde\u7eed\u6bb5\u8fd9\u4e2a\u540d\u8bcd\uff0c\u610f\u601d\u4e0e\u7ffb\u8bd1\u4e00\u6837\u3002\n\n\u5bf9\u4e8e\u957f\u5ea6\u4e3a $i$ \u7684\u6bb5\uff0c\u6211\u4eec\u5c06\u7070\u8272\u90e8\u5206\uff08~~\u7070\u8272\u7684\u82b1\u6735~~\uff09\u7f16\u53f7\u5982\u4e0b\uff1a\n\n\u4e0a\u9762\u90a3\u4e9b\u4ece\u5de6\u5230\u53f3\u7f16\u53f7\u4e3a $0,1,\\cdots i-1$\uff0c\u4e0b\u9762\u90a3\u4e9b\u4ece\u5de6\u5230\u53f3\u7f16\u53f7\u4e3a $0^\\prime,1^\\prime,\\cdots (i-1)^\\prime$\u3002\n\n\u7136\u540e\u6211\u4eec\u7528~~\u4eba\u7c7b\u667a\u6167~~\u53ef\u4ee5\u770b\u51fa\u5404\u79cd\u5404\u6837\u7684\u5408\u6cd5\u8fde\u7ebf\u65b9\u5f0f\u90fd\u662f\u7531\u56db\u79cd\u8fde\u7ebf\u65b9\u5f0f\u7ec4\u6210\u7684\uff0c\u5982\u4e0b\u56fe\uff08\u56fe\u662f\u84af\u7684\uff0c\u6211\u89c9\u5f97 $\\texttt{\\color{black}s\\color{red}hadowice1984}$ \u6bd4\u6211\u753b\u7684\u597d\u591a\u4e86\uff09\n\n![](https://cdn.luogu.com.cn/upload/pic/52929.png)\n\n\u6211\u4eec\u628a\u8fd9\u4e9b\u65b9\u5f0f\u4ece\u4e0a\u5230\u4e0b\uff0c\u4ece\u5de6\u5230\u53f3\u7f16\u53f7\u4e3a $1,2,3,4$\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u5de6\u4e0a\u89d2\u662f $1$\uff0c\u53f3\u4e0a\u89d2\u662f $2$\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff09\n\n\u51c6\u5907\u5de5\u4f5c\u505a\u597d\u4e86\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u662f\u6b63\u5f0f\u89e3\u9898\u65f6\u95f4\u5566qwq\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u67d0\u4e2a $n$ \u6765\u6c42\u51fa\u7b54\u6848\u3002\u8fd9\u91cc\u5206\u4e24\u4e2a\u5927\u7c7b\u8ba8\u8bba\u3002\n\n- \u60c5\u51b5 $1$\uff0c\u4e0d\u5b58\u5728 $p(0\\leq p\\leq n-1)$ \u4f7f\u5f97 $p$ \u4e0e $p^\\prime$ \u76f8\u8fde\u3002\n\n\t\u8fd9\u4e2a\u5927\u7c7b\u8fd8\u662f\u6bd4\u8f83\u597d\u8ba8\u8bba\u7684\u3002\n\n\t\u8bbe $g_i$ \u4e3a\u957f\u5ea6\u4e3a $i$ \u7684\u6bb5\u7070\u8272\u90e8\u5206\u7684\u4e0a\u90e8\u4f7f\u7528\u65b9\u5f0f $2,3$ \u62fc\u63a5\u8d77\u6765\uff08\u5176\u5b9e\u4e5f\u662f\u6574\u4e2a\u7070\u8272\u90e8\u5206\uff09\u7684\u65b9\u6cd5\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u662f\u4e2a\u80cc\u5305\uff08\u5b9e\u8d28\u662f\u6590\u6ce2\u90a3\u5951\uff0c$g_{2i}=Fib_i$\uff09\uff0c\u6709\u4e24\u79cd\u7269\u54c1\uff0c\u82b1\u8d39\u4e3a $2$ \u548c $4$\uff0c\u53ef\u4ee5\u7b80\u5355\u5199\u51fa\u65b9\u7a0b\uff1a\n\n\t$$g_i=g_{i-2}+g_{i-4},g_0=g_2=1,g_1=g_3=0$$\n\n\t\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u4e00\u4e2a\u5927\u7c7b\u6240\u5e26\u6765\u7684\u8d21\u732e\u4e3a $n^2g_n$\u3002\uff08\u56e0\u4e3a\u7070\u8272\u90e8\u5206\u7684\u4e0a\u90e8\u548c\u4e0b\u90e8\u5747\u4e3a\u957f\u5ea6\u4e3a $n$ \u7684\u8fde\u7eed\u6bb5\uff09\n\n- \u60c5\u51b5 $2$\uff0c\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a $p(0\\leq p\\leq n-1)$ \u4f7f\u5f97 $p$ \u4e0e $p^\\prime$ \u76f8\u8fde\u3002\n\n\t\u6211\u4eec\u94a6\u5b9a\u6700\u5c0f\u7684\u90a3\u4e2a $p$ \u4e3a $j$\uff08\u8fd9\u4e2a\u5927\u7c7b\u7684\u8ba8\u8bba\u8fc7\u7a0b\u4e2d\u6240\u6709\u7ed9\u51fa\u7684\u56fe\u4e2d $j$ \u7684\u4f4d\u7f6e\u7531\u7eff\u8272\u6807\u51fa\uff09\n\n\t\u8fd9\u91cc\u8981\u5206\u4e24\u4e2a\u5c0f\u7c7b\uff0c\u56e0\u4e3a\u65b9\u5f0f $1$ \u7684\u5de6\u8fb9\u548c\u53f3\u8fb9\u7684\u4e24\u6735\u82b1\u5c5e\u4e8e\u4e24\u4e2a\u4e0d\u540c\u7684\u8fde\u7eed\u6bb5\u3002\n\n\t- \u60c5\u51b5 $2.1$\uff0c$j$ \u8fd9\u4e2a\u4f4d\u7f6e\u7684\u8fde\u7ebf\u65b9\u5f0f\u4e3a $4$\uff08\u4e5f\u5c31\u662f\u76f4\u63a5\u8fde\u5230\u5bf9\u9762\u7684\u70b9\uff09\u3002\n    \n    \t\u8fd9\u79cd\u60c5\u51b5\u5982\u4e0b\u56fe\uff1a\n        \n        ![](https://codeforces.ml/predownloaded/d9/67/d96757b44bf71e4782cabc1d460ddaec697c7d2c.png)\n        \n        \u6211\u4eec\u4f1a\u53d1\u73b0\u7531\u4e8e $j$ \u662f\u7b2c\u4e00\u4e2a\u4e0e\u5bf9\u9762\u7684\u70b9\u8fde\u8d77\u6765\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5 $j$ \u5de6\u8fb9\u7684\u4e00\u6bb5\u53d8\u6210\u4e86\u60c5\u51b5 $1$\uff0c\u7b54\u6848\u4e3a $j^2g_j$\uff0c\u4f46\u662f\u53f3\u8fb9\u53c8\u56de\u5f52\u5230\u4e86\u539f\u95ee\u9898\uff0c\u6240\u4ee5\u53f3\u8fb9\u7684\u7b54\u6848\u4e3a $f_{0,n-j-1}$\u3002\n        \n        \u6240\u4ee5\uff0c\u7531\u4e58\u6cd5\u539f\u7406\uff0c\u53ef\u4ee5\u7b97\u51fa\u8d21\u732e\u4e3a $j^2g_jf_{0,n-j-1}$\u3002\n        \n    - \u60c5\u51b5 $2.2$\uff0c$j$ \u8fd9\u4e2a\u4f4d\u7f6e\u7684\u8fde\u7ebf\u65b9\u5f0f\u4e3a $1$\uff08\u6572\u9ed1\u677f\uff0c\u5212\u91cd\u70b9\u5566qwq\uff09\u3002\n    \t\n        \u8fd8\u662f\u5148\u7ed9\u4e2a\u56fe\u5427\uff1a\n        \n       \t![](https://codeforces.ml/predownloaded/97/27/9727064999c0333dbbdc7fc6328edbcb2ff9c7c4.png) \n        \n        $j$ \u5de6\u8fb9\u7684\u5b50\u95ee\u9898\u4e00\u5982\u65e2\u5f80\u5730\u4e3a\u60c5\u51b5 $1$\uff0c\u4f46\u662f\u89c4\u6a21\u53d8\u6210\u4e86 $j-1$\uff0c\u56e0\u4e3a $j-1$ \u5df2\u7ecf\u8fde\u4e0a\u53bb\u4e86\u3002\n        \n        \u53f3\u8fb9\u6211\u4eec\u53d8\u6210\u65b0\u7684\u4e00\u4e2a\u5b50\u95ee\u9898\u3002\u770b\u8d77\u6765\u50cf\u4e00\u4e2a\u6bb5\uff0c\u4f46\u662f\u5de6\u8fb9\u53d8\u6210\u4e86\u4e24\u4e2a\u5df2\u914d\u5bf9\u7684\u82b1\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5de6\u8fb9\u90a3\u4e2a\u5df2\u7ecf\u914d\u5bf9\u7684\u82b1\u4e0e\u7070\u8272\u90e8\u5206\u4e3a\u8fde\u7eed\u6bb5\uff0c\u8981\u8ba1\u5165\u7b54\u6848\u3002\u5982\u679c\u4e2d\u95f4\u7070\u8272\u90e8\u5206\u957f\u5ea6\u4e3a $i$\uff0c\u6211\u4eec\u628a\u5b83\u8bb0\u4e3a $f_{1,i}$\u3002\n        \n        \u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u8868\u793a\u8fd9\u4e2a\u7684\u7b54\u6848\u4e86\uff0c\u4e3a $(j+1)^2g_{j}f_{1,i-j-3}$\u3002\uff08\u4e3a\u4e86\u4e0d\u51fa\u73b0\u4e00\u4e9b\u5947\u5947\u602a\u602a\u7684\u9505\uff0c\u8fd9\u91cc\u4e0b\u6807\u505a\u4e86\u8c03\u6574\uff09\n        \n\u81f3\u6b64\uff0c\u6211\u4eec\u7684\u8ba8\u8bba\u5df2\u7ecf\u5b8c\u6bd5\u5566\uff0c\u73b0\u5728\u6211\u4eec\u6765\u5c06\u7ed3\u679c\u6574\u5408\u4e00\u4e0b\uff0c\u6709\n\n$$f_{0,n}=n^2g_n+\\sum\\limits_{j=0}^{n-1}j^2g_jf_{0,n-j-1}+\\sum\\limits_{j=0}^{n-3}(j+1)^2g_{j}f_{1,i-j-3}$$\n\n\u540c\u7406\uff0c$f_{1,n}$ \u7c7b\u63a8\uff0c\u53ea\u4e0d\u8fc7\u6709\n\n$$f_{1,n}=(n+1)^2g_n+\\sum\\limits_{j=0}^{n-1}(j+1)^2g_jf_{0,n-j-1}+\\sum\\limits_{j=0}^{n-3}(j+2)^2g_{j}f_{1,i-j-3}$$\n\n\u73b0\u5728\u6211\u4eec\u89e3\u51b3\u4e86\u6bb5\u7684\u95ee\u9898\u3002\u63a5\u4e0b\u6765\u662f\u65f6\u5019\u6765\u89e3\u51b3\u771f\u6b63\u7684\u95ee\u9898\u5566qwq\uff01\n\n\u73b0\u5728\uff0c\u7531\u4e8e\u8fd9\u662f\u4e2a\u73af\uff0c\u6240\u4ee5\u6211\u4eec\u94a6\u5b9a\u4e00\u6735\u4e0e\u5b83\u5bf9\u9762\u7684\u82b1\u8fde\u5728\u4e00\u8d77\u7684\u82b1\u3002\u8fd9\u6735\u82b1\u6211\u4eec\u7f16\u53f7\u4e3a $1$\uff0c\u7136\u540e\u987a\u65f6\u9488\u7f16\u53f7\u4e3a $2,3,\\cdots,2n$\u3002\u5bb9\u6613\u53d1\u73b0\uff0c$p(1\\leq p\\leq n)$\u5bf9\u9762\u7684\u90a3\u6735\u82b1\u662f $p+n$\u3002\n\n\u4f46\u662f\u8981\u5f62\u6210\u4e00\u4e2a\u6bb5\uff0c\u8fd8\u8981\u4e00\u6735\u4e0e\u5bf9\u9762\u7684\u82b1\u8fde\u8d77\u6765\u7684\u82b1\u3002\u8fd9\u91cc\u6211\u4eec\u94a6\u5b9a\u6700\u5c0f\u7684 $p(2\\leq p\\leq n)$ \u4f7f\u5f97 $p$ \u4e0e $p+n$ \u6709\u8fb9\u8fde\u63a5\u7684\u4e3a $i$\u3002\u5f53 $n=9$ \u4e14 $i=5$ \u65f6\uff0c\u5982\u4e0b\u56fe\uff1a\n\n![](https://codeforces.ml/predownloaded/98/2d/982d4f8ec07bdcfd468e112cd93f10978dd125ed.png)\n\n\u7136\u540e\u6211\u4eec\u53ef\u80fd\u4e0d\u6e05\u695a $1\\sim i$ \u4e4b\u95f4\u662f\u5426\u6709\u65e0\u8ddd\u79bb\u4e3a $2$ \u7684\u4e24\u6735\u82b1\u8fde\u8d77\u6765\uff08\u5982\u679c\u4e0d\u8003\u8651\u7684\u8bdd\u6211\u4eec\u4f1a\u7b97\u6f0f\uff09\uff0c\u7136\u540e\u6211\u4eec\u53c8\u5f00\u59cb\u8ba8\u8bba\u3002\n\n\u8ba8\u8bba\u6765\uff0c\u8ba8\u8bba\u53bb\uff0c\u6700\u7ec8\u53d1\u73b0\u6211\u4eec\u51fa\u73b0\u4e86\u65b0\u7684\u4e00\u4e2a\u5b50\u95ee\u9898\uff0c\u4e00\u4e2a\u957f\u5ea6\u4e3a $n+2$ \u7684\u6bb5\uff0c\u4f4d\u7f6e $0$ \u548c\u4f4d\u7f6e $n+1$ \u5df2\u7ecf\u914d\u597d\u5bf9\u4e86\uff0c\u6211\u4eec\u628a\u5b83\u8bb0\u505a $f_{2,n}$\u3002\n\n\u6709\u4e86\u4e0a\u9762\u7684\u8ba8\u8bba\u8fc7\u7a0b\uff0c\u76f8\u4fe1\u4f60\u4e5f\u5bf9\u63a8 $f_{2,n}$ \u7684\u65b9\u6cd5\u4e0d\u964c\u751f\u4e86\u5427qwq\uff0c\u8fd9\u91cc\u5c31\u76f4\u63a5\u7ed9\u51fa\u7b54\u6848\u3002\n\n$$f_{2,n}=(n+2)^2g_n+\\sum\\limits_{j=0}^{n-1}(j+1)^2g_jf_{1,n-j-1}+\\sum\\limits_{j=0}^{n-3}(j+2)^2g_{j}f_{2,i-j-3}$$\n\n\u63a5\u7740\uff0c\u6211\u4eec\u6765\u8ba1\u7b97\u7b54\u6848\u3002\u8fd9\u91cc\u53c8\u662f\u4e00\u4e2a\u5927\u7684\u5206\u7c7b\u8ba8\u8bba\u3002\n\n\u5982\u679c\u53ea\u6709\u4e00\u6735\u82b1\u8fde\u5230\u5bf9\u9762\u7684\u8bdd\uff0c\u90a3\u4e48\u662f\u4e24\u4e2a\u8fde\u7eed\u6bb5\uff0c\u957f\u5ea6\u4e3a $n-1$\u3002\n\n\u5982\u679c\u8fd9\u6735\u82b1\u7684\u8fde\u7ebf\u65b9\u5f0f\u4e3a $1$ \u7684\u8bdd\uff0c\u90a3\u4e48\u7b54\u6848\u4e3a $g_{n-3}(n-1)^2$\uff0c\u5426\u5219\u4e3a $g_{n-1}(n-1)^2$\u3002\n\n\u5426\u5219\uff0c\u90a3\u4e48\u5b58\u5728\u66f4\u591a\u7684\u82b1\u8fde\u5230\u5bf9\u9762\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u94a6\u5b9a\u4e00\u4e2a\u70b9 $1$ \u6765\u7b97\u3002\n\n\u5982\u679c $1$ \u548c $n+1$ \u8fde\u5728\u4e00\u8d77\u5c31\u662f\u76f4\u63a5\u7b97\uff0c\u5426\u5219\u5c31\u901a\u8fc7\u65cb\u8f6c\u6765\u8003\u8651\u3002\n\n\u4f7f\u7528\u8ba1\u6570\u9898\u7684\u5e38\u7528\u65b9\u6cd5\uff1a\u679a\u4e3e\u4e00\u4e2a\u6700\u5c0f\u7684\u65cb\u8f6c\u89d2\u5ea6\u6765\u7b97\uff0c\u7136\u540e\u4e58\u4e0a\u89d2\u5ea6\u7684\u8d21\u732e\uff0c\u6211\u4eec\u5f97\u5230\n\n$$\\sum\\limits_{i=2}^{n-2}i(i-1)^2(g_{i-1}f_{0,n-i-1}+2g_{i-2}f_{1,n-i-2}+g_{i-3}f_{2,n-i-3})$$\n\n\u7136\u540e\u628a\u4e24\u4e2a\u7b54\u6848\u52a0\u8d77\u6765\u5c31\u505a\u5b8c\u5566\uff01\u4f7f\u7528\u5206\u6cbb $\\texttt{FFT}$ \u5373\u53ef\u8fbe\u5230 $O(n\\log^2n)$ \u7684~~\u4f18\u79c0~~\u590d\u6742\u5ea6\u3002\n\n\u63a5\u4e0b\u6765\u6ce8\u610f\u5230\u8fd9\u4e2a\u4e1c\u897f\u80fd\u7528 GF \u4f18\u5316\u4e00\u4e0b\u505a\u5230 $O(n\\log n)$ \u7684\u590d\u6742\u5ea6\uff0c\u8fd9\u4e2a\u7528\u5fc3\u63a8\u63a8\u5e94\u8be5\u4e0d\u96be\uff0c\u7559\u7ed9\u8bfb\u8005\u505a\u4e2a\u7ec3\u4e60\u3002\n\n\u63a5\u4e0b\u6765\u6709\u4e00\u4e2a $O(n)$ \u7684\u505a\u6cd5\u5c31\u4e0d\u7ec6\u8bb2\u4e86\uff0c\u56e0\u4e3a shadowice \u5df2\u7ecf\u8bb2\u5f97\u5f88\u6e05\u695a\u4e86\u3002\n\n\u6ce8\u610f\u5230\u6211\u4eec\u7684\u5199\u51fa\u6765\u7684\u751f\u6210\u51fd\u6570\u662f\u7c7b\u4f3c\u4e8e $\\frac{P(x)}{Q(x)}$ \u7684\u5f62\u5f0f\uff0c\u6839\u636e\u795e jiangly \u795e\u7684\u6559\u80b2\u53ef\u77e5\u8fd9\u4e1c\u897f\u662f\u53ef\u4ee5\u7ebf\u6027\u9012\u63a8\u7684\u3002\n\n\u53d6\u51fa\u524d\u9762\u7684 $150$ \u9879\u5f97\u5230\u4e00\u4e2a\u7ebf\u6027\u9012\u63a8\u7684\u5f0f\u5b50\uff0c\u53d1\u73b0\u6709 $16$ \u9879\uff0c\u539f\u9898\u7684 $n\\leq 5\\times 10^4$ \u7136\u540e\u53ea\u6709\u4e00\u7ec4\u8be2\u95ee\u6240\u4ee5\u53ef\u4ee5 $O(n)$ \u9012\u63a8\u3002\u52a0\u5f3a\u7248\u7684\u8bdd\u77e9\u9635\u5feb\u901f\u5e42\u4e5f\u53ef\u4ee5 $O(Tk^3\\log n)$ \u505a\u3002\n\n\u5982\u679c\u8be2\u95ee\u518d\u591a\u4e00\u70b9\u5e76\u4e14\u9650\u5b9a $n\\leq 5\\times 10^5$ \u5462\uff1f\u8003\u8651\u6c42\u51fa\u8fd9\u4e2a\u7ebf\u6027\u9012\u63a8\u7684\u751f\u6210\u51fd\u6570\u5f97\u5230\u7b54\u6848\u5e94\u8be5\u662f\u8fd9\u4e48\u4e2a\u6bd4\u8f83\u5947\u8469\u7684\u4e1c\u897f\uff1a\n\n$$\\frac{24 x^3 + 4 x^4 + 144 x^5 - 4 x^6 + 348 x^7 - 128 x^8 + 240 x^9 + \n 28 x^{10} + 188 x^{11} - 68 x^{12} + 16 x^{13} + 4 x^{15}}{1 - 4 x^2 - 8 x^3 + x^4 - 16 x^5 + 10 x^6 - 4 x^7 + 12 x^8 + 48 x^9 - \n 26 x^{10} + 44 x^{11} - 15 x^{12} + 16 x^{13} + 4 x^{14} + 4 x^{15} + x^{16}}$$\n \n\u7136\u540e\u6c42\u4e2a\u9006\u5c31\u53ef\u4ee5 $O(T)$ \u5b8c\u4e8b\u4e86\u3002\n\n### \u4ee3\u7801\n\n\u8fd9\u91cc\u53ea\u7ed9\u4e00\u4efd\u4ee5\u524d\u5199\u7684\u5206\u6cbb FFT\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<vector>\n#pragma GCC optimize(2)\n#pragma GCC optimize(3)\n#pragma GCC optimize(\"Ofast\")\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=262151,MOD=998244353,G=3,INVG=332748118;\nll x,res,cnt=1,limit=-1;\nll g[MAXN],g0[MAXN],g1[MAXN],g2[MAXN],f0[MAXN],rev[MAXN];\nll f1[MAXN],f2[MAXN],tmp1[MAXN],tmp2[MAXN],tmp3[MAXN],tmp4[MAXN];\nll p0[MAXN],p1[MAXN],tmpg0[MAXN],tmpg1[MAXN],tmpg2[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n    li res=1;\n    while(exponent)\n    {\n        if(exponent&1)\n        {\n            res=(li)res*base%MOD;\n        }\n        base=(li)base*base%MOD,exponent>>=1;\n    }\n    return res;\n}\ninline void NTT(ll *cp,ll cnt,ll inv)\n{\n    ll cur=0,res=0,omg=0;\n    for(register int i=0;i<cnt;i++)\n    {\n        if(i<rev[i])\n        {\n            swap(cp[i],cp[rev[i]]);\n        }\n    }\n    for(register int i=2;i<=cnt;i<<=1)\n    {\n        cur=i>>1,res=qpow(inv==1?G:INVG,(MOD-1)/i);\n        for(register ll *p=cp;p!=cp+cnt;p+=i)\n        {\n            omg=1;\n            for(register int j=0;j<cur;j++)\n            {\n                ll t=(li)omg*p[j+cur]%MOD,t2=p[j];\n                p[j+cur]=(t2-t+MOD)%MOD,p[j]=(t2+t)%MOD;\n                omg=(li)omg*res%MOD;\n            }\n        }\n    }\n    if(inv==-1)\n    {\n        ll invl=qpow(cnt,MOD-2);\n        for(register int i=0;i<=cnt;i++)\n        {\n            cp[i]=(li)cp[i]*invl%MOD;\n        }\n    }\n}\ninline void calc(ll l,ll r)\n{\n\tll cnt=1,limit=-1,mid=(l+r)>>1;\n\twhile(cnt<=(r-l+1)<<1)\n\t{\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=0;i<cnt>>1;i++)\n\t{\n\t\tp0[i]=i+l<=mid?f0[i+l]:0,p1[i]=i+l<=mid?f1[i+l]:0;\n\t\ttmpg0[i]=g0[i],tmpg1[i]=g1[i],tmpg2[i]=g2[i];\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t}\n\tfor(register int i=cnt>>1;i<cnt;i++)\n\t{\n\t\ttmpg0[i]=tmpg1[i]=tmpg2[i]=p0[i]=p1[i]=0;\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t}\n\tNTT(tmpg0,cnt,1),NTT(tmpg1,cnt,1),NTT(tmpg2,cnt,1);\n\tNTT(p0,cnt,1),NTT(p1,cnt,1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\ttmp1[i]=(li)tmpg0[i]*p0[i]%MOD,tmp2[i]=(li)tmpg1[i]*p0[i]%MOD;\n\t\ttmp3[i]=(li)tmpg1[i]*p1[i]%MOD,tmp4[i]=(li)tmpg2[i]*p1[i]%MOD;\n\t\ttmpg0[i]=tmpg1[i]=tmpg2[i]=p0[i]=p1[i]=0;\n\t}\n\tNTT(tmp1,cnt,-1),NTT(tmp2,cnt,-1),NTT(tmp3,cnt,-1),NTT(tmp4,cnt,-1);\n\tfor(register int i=0;i<cnt>>1;i++)\n\t{\n\t\tif(i+l>=mid&&i+l<r)\n\t\t{\n\t\t\tf0[i+l+1]=(f0[i+l+1]+tmp1[i])%MOD;\n\t\t\tf1[i+l+1]=(f1[i+l+1]+tmp2[i])%MOD;\n\t\t}\n\t\tif(i+l>=mid-2&&i+l<r-2)\n\t\t{\n\t\t\tf0[i+l+3]=(f0[i+l+3]+tmp3[i])%MOD;\n\t\t\tf1[i+l+3]=(f1[i+l+3]+tmp4[i])%MOD;\n\t\t}\n\t}\n}\ninline void cdqFFT(ll l,ll r)\n{\n\tif(l==r)\n\t{\n\t\tf0[l]=(f0[l]+g0[l])%MOD,f1[l]=(f1[l]+g1[l])%MOD;\n\t\treturn;\n\t}\n\tll mid=(l+r)>>1;\n\tcdqFFT(l,mid),calc(l,r),cdqFFT(mid+1,r);\n}\ninline void calc2(ll l,ll r)\n{\n\tll cnt=1,limit=-1,mid=(l+r)>>1;\n\twhile(cnt<=(r-l+1)<<1)\n\t{\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=0;i<cnt>>1;i++)\n\t{\n\t\tp0[i]=i+l<=mid?f2[i+l]:0,tmpg2[i]=g2[i],tmp2[i]=0;\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t}\n\tfor(register int i=cnt>>1;i<cnt;i++)\n\t{\n\t\tp0[i]=tmpg2[i]=tmp2[i]=0;\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t}\n\tNTT(p0,cnt,1),NTT(tmpg2,cnt,1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\ttmp2[i]=(li)p0[i]*tmpg2[i]%MOD,p0[i]=tmpg2[i]=0;\n\t}\n\tNTT(tmp2,cnt,-1);\n\tfor(register int i=0;i<cnt>>1;i++)\n\t{\n\t\tif(i+l>=mid-2&&i+l<r-2)\n\t\t{\n\t\t\tf2[i+l+3]=(li)(f2[i+l+3]+tmp2[i])%MOD;\n\t\t}\n\t}\n}\ninline void cdqFFT2(ll l,ll r)\n{\n\tif(l==r)\n\t{\n\t\tf2[l]=((f2[l]+g2[l])%MOD+(l>=1?tmp1[l-1]:0))%MOD;\n\t\treturn;\n\t}\n\tll mid=(l+r)>>1;\n\tcdqFFT2(l,mid),calc2(l,r),cdqFFT2(mid+1,r);\n}\nint main()\n{\n\tx=read(),g[0]=g[2]=1;\n\tfor(register int i=4;i<=x;i+=2)\n\t{\n\t\tg[i]=(g[i-4]+g[i-2])%MOD;\n\t}\n\tfor(register int i=0;i<=x;i++)\n\t{\n\t\tg0[i]=(li)g[i]*i%MOD*i%MOD,g1[i]=(li)g[i]*(i+1)%MOD*(i+1)%MOD;\n\t\tg2[i]=(li)g[i]*(i+2)%MOD*(i+2)%MOD;\n\t}\n\tcdqFFT(0,x);\n\twhile(cnt<=(x<<1))\n\t{\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t\ttmpg0[i]=i<cnt>>1?f1[i]:0,tmpg1[i]=i<cnt>>1?g1[i]:0,tmp1[i]=0;\n\t}\n\tNTT(tmpg0,cnt,1),NTT(tmpg1,cnt,1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\ttmp1[i]=(li)tmpg0[i]*tmpg1[i]%MOD,tmpg0[i]=tmpg1[i]=0;\n\t}\n\tNTT(tmp1,cnt,-1),cdqFFT2(0,x);\n\tres=(li)(g[x-1]+g[x-3])*(x-1)%MOD*(x-1)%MOD*x%MOD;\n\tfor(register int i=2;i<x-1;i++)\n\t{\n\t\tres=(res+(li)g0[i-1]*f0[x-i-1]%MOD*i%MOD)%MOD;\n\t\tres=(res+(li)g1[i-2]*f1[x-i-2]%MOD*2%MOD*i%MOD)%MOD;\n\t\tif(i>2&&i<x-2)\n\t\t{\n\t\t\tres=(res+(li)g2[i-3]*f2[x-i-3]%MOD*i%MOD)%MOD;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",res);\n}\n```",
        "postTime": 1575985217,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF848E \u3010Days of Floral Colours\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u5047\u8bbe\u73af\u4e0a\u6709 $k$ \u5bf9\u76f8\u5bf9\u7684\u76f8\u540c\u989c\u8272\u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5 $1$ \u5230 $n$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u70b9\u8ba1\u7b97\u4e00\u6b21\u7b54\u6848\uff0c\u8fd9\u4f1a\u5c06\u4e00\u79cd\u65b9\u6848\u6070\u597d\u8ba1\u7b97 $k$ \u6b21\uff0c\u6700\u540e\u9664\u4ee5 $k$ \u5373\u53ef\u3002\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u5c06\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\u5212\u5206\u4e3a\u82e5\u5e72\u6bb5\uff0c\u6bcf\u6bb5\u7b2c\u4e00\u4e2a\u7403\u662f\u548c\u76f8\u5bf9\u7684\u7403\u989c\u8272\u76f8\u540c\u7684\uff0c\u5176\u4ed6\u76f8\u540c\u989c\u8272\u7684\u7403\u8981\u4e48\u76f8\u90bb\uff0c\u8981\u4e48\u8ddd\u79bb\u4e3a $2$\u3002\u8981\u6c42\u7684\u662f\u6240\u6709\u65b9\u6848\u6bcf\u6bb5 (\u957f\u5ea6$-1$) \u7684\u4e58\u79ef\u5e73\u65b9\u548c\u3002\n\n\u5047\u8bbe\u6ca1\u6709\u4e00\u5bf9\u7403\u8de8\u8d8a\u4e86\u4e24\u6bb5\uff0c\u4e14\u5ffd\u7565\u6bcf\u6bb5\u7684\u7b2c\u4e00\u4e2a\u7403\uff0c\u5219\u6bcf\u6bb5\u7684\u751f\u6210\u51fd\u6570\u663e\u7136\u4e3a\n$$\nF(x)=\\frac{1}{1-x^2-x^4}\n$$\n\u7531\u4e8e\u8981\u4e58\u4ee5\u957f\u5ea6\u7684\u5e73\u65b9\uff0c\u518d\u52a0\u4e0a\u7b2c\u4e00\u4e2a\u7403\uff0c\u56e0\u6b64\u4e24\u8fb9\u90fd\u6ca1\u6709\u8de8\u8d8a\u7684\u751f\u6210\u51fd\u6570\u4e3a\n$$\nF_0(x)=x^2\\cdot (x\\cdot F'(x))'\n$$\n\u8fd9\u662f\u56e0\u4e3a $x\\cdot F'(x)$ \u662f $F(x)$ \u7684\u6bcf\u9879\u7cfb\u6570\u4e58\u4ee5\u6307\u6570\u6240\u5f97\u5230\u7684\u751f\u6210\u51fd\u6570\u3002\n\n\u540c\u7406\uff0c\u6709\u4e00\u8fb9\u3001\u4e24\u8fb9\u90fd\u8de8\u8d8a\u7684\u751f\u6210\u51fd\u6570\u5206\u522b\u4e3a\n$$\nF_1(x)=x^2\\cdot (x\\cdot (x\\cdot F(x))')',F_2(x)=x^2\\cdot (x\\cdot (x^2\\cdot F(x))')'\n$$\n\u8bbe\n$$\nM(x)=\\begin{bmatrix}\nF_0(x)&F_1(x)\\\\\nF_1(x)&F_2(x)\n\\end{bmatrix}\n$$\n\u5219\u5212\u5206\u4e3a $k\\ge1$ \u6bb5\u7684\u751f\u6210\u51fd\u6570\u5373\u4e3a $M(x)^k$ \u7684\u4e3b\u5bf9\u89d2\u7ebf\u4e0a\u7684\u5143\u7d20\u4e4b\u548c\uff0c\u77e9\u9635\u7684\u4f5c\u7528\u662f\u51b3\u5b9a\u6bcf\u76f8\u90bb\u4e24\u6bb5\u662f\u5426\u6709\u4e00\u5bf9\u7403\u8de8\u8d8a\u3002\n\n\u5bf9\u6240\u6709 $k\\ge 1$ \u6c42\u548c\u5f97\u5230\n$$\nA(x)=\\sum_{k\\ge 1} \\frac{M(x)^k}{k}\n$$\n\u4e0a\u5f0f\u7684\u4e3b\u5bf9\u89d2\u7ebf\u4e0a\u7684\u5143\u7d20\u4e4b\u548c\u7684 $x^n$ \u9879\u7cfb\u6570\u4e58\u4ee5 $n$ \u5373\u4e3a\u7b54\u6848\uff0c\u5373 $B(x)=x\\cdot A'(x)$\u3002\n\n\u6ce8\u610f\u5230 $M(x)$ \u662f\u5bf9\u79f0\u77e9\u9635\uff0c\u56e0\u6b64 $M'(x)$ \u548c $M(x)$ \u662f\u4ea4\u6362\u7684\uff0c\u4ece\u800c\u53ef\u4ee5\u8bc1\u660e\n$$\nB(x)=x\\cdot A'(x)=\\frac{x\\cdot M'(x)}{I-M(x)}\n$$\n\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u8ba1\u7b97\u53ef\u4ee5\u5f97\u5230 $B(x)$ \u7684\u4e3b\u5bf9\u89d2\u7ebf\u4e0a\u7684\u5143\u7d20\u4e4b\u548c\u4e3a\n$$\n\\frac{24 x^3+4 x^4+144 x^5-4 x^6+348 x^7-128 x^8+240 x^9+28 x^{10}+188 x^{11}-68 x^{12}+16 x^{13}+4 x^{15}}{1-4 x^2-8 x^3+x^4-16 x^5+10 x^6-4 x^7+12 x^8+48 x^9-26 x^{10}+44 x^{11}-15 x^{12}+16 x^{13}+4 x^{14}+4 x^{15}+x^{16}}\n$$\n",
        "postTime": 1599645335,
        "uid": 149656,
        "name": "jiangly",
        "ccfLevel": 10,
        "title": "CF848E Days of Floral Colours \u9898\u89e3"
    },
    {
        "content": "~~\u636e\u8bf4\u9898\u76ee\u7684\u80cc\u666f\u662f\u6765\u81ea\u4e8e[\u82b1\u8272\u65e5\u548c](https://music.163.com/#/song?id=29154917),\u559c\u6b22v\u66f2\u7684\u53ef\u4ee5\u53bb\u542c\u542c\u770b\u5427\u2026\u2026~~\n\n\u751f\u6210\u51fd\u6570\u597d\u9898\u554a\u2026\u2026\u5341\u5206\u8003\u9a8c\u751f\u6210\u51fd\u6570\u7684\u57fa\u672c\u529f\u662f\u5426\u624e\u5b9e\u2026\u2026\n\n\u5907\u6ce8:\u8fd9\u91cc\u7684\u505a\u6cd5\u662f$O(40n)$\u7684(\u867d\u7136\u8fd9\u4e2a\u590d\u6742\u5ea6\u8bb0\u53f7\u5e76\u4e0d\u6807\u51c6\u5c31\u662f\u4e86)\uff0c\u5e94\u8be5\u8fdc\u8fdc\u5feb\u4e8e$O(nlogn)$\u7684\u591a\u9879\u5f0f\u6c42\u9006\u548c$O(nlog^2n)$\u7684\u5206\u6cbbfft\n\n## \u524d\u7f6e\u829d\u58eb\uff1a\u8ba1\u7b97\u80fd\u529b\n\n\u672c\u9898\u89e3\u6d89\u53ca\u7c7b\u4f3c\u4e8e\u7ed9\u4e00\u4e2a\u5206\u5f0f\u6c422\u9636\u5bfc\u4ee5\u53ca\u5bf9\u5341\u51e0\u6b21\u7684\u591a\u9879\u5f0f\u8fdb\u884c\u52a0\u51cf\u4e58\u9664\u4e4b\u7c7b\u7684dirty work\uff0c\u5982\u679c\u5bf9\u81ea\u5df1\u7684\u8ba1\u7b97\u80fd\u529b\u6ca1\u6709\u4fe1\u5fc3\u7684\u8bdd\n\n**\u8bf7\u5584\u7528[wolfram alpha](https://www.wolframalpha.com)**\n\n## \u524d\u7f6e\u829d\u58eb:\u751f\u6210\u51fd\u6570\n\n\u8bf7\u786e\u4fdd\u60a8\u7cbe\u901a\u751f\u6210\u51fd\u6570\u90a3\u4e00\u5957\u7406\u8bba\n\n------\n\n# \u672c\u9898\u9898\u89e3\n\n\u7531\u4e8e\u7ffb\u8bd1\u662f\u673a\u7ffb\u6240\u4ee5\u8fd9\u91cc\u7b80\u8981\u89e3\u91ca\u4e00\u4e0b\u9898\u610f\u2026\u2026\n\n\u7ed9\u5b9a\u4e00\u4e2a2n\u7684\u70b9\u7684\u73af\uff0c\u73af\u4e0a\u7684\u6bcf\u4e2a\u70b9\u90fd\u6709\u6807\u53f7\uff0c\u73b0\u5728\u8981\u7ed9\u8fd9\u4e2a\u73af\u8fde\u4e00\u4e9b\u8fb9\uff0c\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u9650\u5236\n\n1.\u6bcf\u4e2a\u70b9\u7684\u5ea6\u6570\u6070\u597d\u662f1\n\n2.\u6709\u8fb9\u7684\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u8981\u4e48\u5c0f\u4e8e\u7b49\u4e8e2\u8981\u4e48\u6070\u597d\u662fn\n\n3.\u5982\u679c$(i,j)$\u6709\u8fb9\uff0c\u90a3\u4e48\u5728$(i,j)$\u6b63\u5bf9\u9762\u7684\u70b9$(i',j')$\u4e5f\u5fc5\u987b\u6709\u8fb9\n\n4.\u81f3\u5c11\u6709\u4e00\u5bf9\u70b9\u8ddd\u79bb\u4e3an\u5e76\u4e14\u6709\u8fb9\u76f8\u8fde\n\n\u5b9a\u4e49\u4e00\u4e2a\u73af\u7684\u6743\u503c\u6309\u7167\u5982\u4e0b\u65b9\u6cd5\u8ba1\u7b97\n\n\u5220\u6389\u6240\u6709\u8ddd\u79bb\u4e3an\u5e76\u4e14\u6709\u8fb9\u7684\u70b9\u5bf9\uff0c\u8fd9\u6837\u73af\u4f1a\u5206\u88c2\u6210\u82e5\u5e72\u4e2a\u6bb5\uff0c\u8fd9\u4e2a\u73af\u7684\u6743\u503c\u5c31\u662f\u6240\u6709\u6bb5\u957f\u5ea6\u7684\u4e58\u79ef\n\n\u6c42\u6240\u6709\u5408\u6cd5\u7684\u73af\u7684\u6743\u503c\u4e4b\u548c\u6a21998244353\u7684\u7ed3\u679c\n\n------\n\n## \u4ece\u4e00\u4e2anaive\u7684$O(n^2)$dp\u5f00\u59cb\n\n _\u8fd9\u91cc\u5c31\u4e0d\u653e\u56fe\u4e86\uff0cdp\u6570\u7ec4\u7684\u5b9a\u4e49\u548c\u5b98\u65b9\u9898\u89e3\u7684\u5b9a\u4e49\u662f\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u53bb\u5b98\u65b9\u9898\u89e3\u770b\u56fe_ \n\n\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6027\u8d28\u662f:\u73af\u662f\u5bf9\u79f0\u7684\uff0c\u786e\u5b9a1\u5230n\u4e4b\u95f4\u7684\u8fde\u8fb9\u60c5\u51b5\u5c31\u53ef\u4ee5\u53cd\u7740\u63a8\u51fa\u6765\u540e\u4e00\u534a\u7684\u8fde\u8fb9\u60c5\u51b5\n\n\u6211\u4eec\u53d1\u73b0\u8ddd\u79bb\u4e3an\u7684\u70b9\u5bf9\u6070\u597d\u662f\u9762\u5bf9\u9762\u7684\uff0c\u56e0\u6b64\u9762\u5bf9\u9762\u7684\u70b9\u8fde\u8fb9\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u7684\u70b9\u7684\u8fde\u8fb9\u60c5\u51b5\n\n\u7531\u4e8e\u81f3\u5c11\u6709\u4e00\u5bf9\u70b9\u662f\u9762\u5bf9\u9762\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4ee5\u4e00\u4e2a\u9762\u5bf9\u9762\u7684\u70b9\u5bf9\u4e3a\u8f74\u5c06\u6574\u4e2a\u73af\u6495\u6210\u4e24\u4e2a\u957f\u5ea6\u4e3an\u7684\u5e8f\u5217\n\n\u63a5\u4e0b\u6765\u65e0\u975e\u5c31\u662f\u89c2\u5bdf\u73af\u5f53\u4e2d\u53ef\u80fd\u51fa\u73b0\u54ea\u4e9b\u56fe\u5f62\u7136\u540e\u628a\u4ed6\u4eec\u7528\u76f8\u5e94\u7684dp\u6570\u7ec4\u8868\u793a\u5c31\u53ef\u4ee5\u4e86\n\n\u7ecf\u8fc7\u89c2\u5bdf\u6211\u4eec\u53d1\u73b0\u53ef\u80fd\u51fa\u73b0\u7684\u56fe\u5f62\u6709\u4ee5\u4e0b\u51e0\u79cd\n\n![](https://cdn.luogu.com.cn/upload/pic/52929.png)\n\n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\u53f3\u4e0a\u89d2\u90a3\u79cd\u56fe\u5f62\u975e\u5e38\u8ba8\u538c\uff0c\u56e0\u4e3a\u4e24\u8fb9\u7684\u70b9\u5206\u522b\u5c5e\u4e8e\u4e24\u4e2a\u6bb5\n\n\u90a3\u4e48\u6211\u4eec\u5148\u6765\u5904\u7406\u53ea\u6709\u56fe\u5f622,3\u7684\u6bb5\u7684**\u65b9\u6848\u6570**\uff0c\u8bbe$g(n)$\u8868\u793a\u957f\u5ea6\u4e3an\u5e76\u4e14\u53ea\u542b\u56fe\u5f622,3\u7684\u6bb5\u7684\u65b9\u6848\u6570\n\n\u5f88\u5bb9\u6613\u7684\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u9012\u63a8\u5f0f\u662f\n\n$$g(n)=g(n-2)+g(n-4),g(0)=g(2)=1,g(1)=g(3)=0$$\n\n\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\u6211\u4eec\u518d\u5b9a\u4e49\u51e0\u4e2a\u6570\u7ec4\n\n$$g_{0}(n)=g(n)n^2$$\n\n$$g_{1}(n)=g(n)(n+1)^2$$\n\n$$g_{2}(n)=g(n)(n+2)^2$$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8bbe$f_{0}(n)$\u8868\u793a\u4ee5\u4e00\u4e2a\u56fe\u5f624\u5f00\u5934,\u6709\u4e00\u6bb5\u957f\u5ea6\u4e3an\u7684\u6bb5\u7684\u5e8f\u5217\u7684\u6743\u503c\u548c\n\n\u8bbe$f_{1}(n)$\u8868\u793a\u4ee5\u4e00\u4e2a\u56fe\u5f624\u5f00\u5934\uff0c\u4e2d\u95f4\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3an\u7684\u6bb5\uff0c\u4ee5$1/3$\u4e2a\u56fe\u5f621\u7ed3\u5c3e\u7684\u5e8f\u5217\u7684\u6743\u503c\u548c\n\n\u8bbe$f_{2}(n)$\u8868\u793a\u4ee5$2/3$\u4e2a\u56fe\u5f624\u5f00\u5934\uff0c\u4e2d\u95f4\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3an\u7684\u6bb5\uff0c\u4ee5$1/3$\u4e2a\u56fe\u5f621\u7ed3\u5c3e\u7684\u5e8f\u5217\u7684\u6743\u503c\u548c\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u56fe\u5f62\u62fc\u6765\u62fc\u53bb\uff0c\u6700\u540e\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u8f6c\u79fb\u5f0f\u5b50\n\n$$f_{0}(n)=g_{0}(n)+\\sum_{i+j=n-1}g_{0}(j)f_{0}(i)+\\sum_{i+j=n-2}g_{1}(j)f_{1}(i)$$\n\n$$f_{1}(n)=g_{1}(n)+\\sum_{i+j=n-1}g_{1}(j)f_{0}(i)+\\sum_{i+j=n-3}g_{2}(j)f_{1}(i)$$\n\n$$f_{2}(n)=g_{2}(n)+\\sum_{i+j=n-1}g_{1}(j)f_{1}(j)+\\sum_{i+j=n-3}g_{2}(j)f_{2}(j)$$\n\n\u5982\u679c\u53ea\u662f\u6734\u7d20\u7684\u5b9e\u73b0\u8f6c\u79fb\u7684\u8bdd\u590d\u6742\u5ea6\u662f$O(n^2)$\u7684\uff0c\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u8003\u8651\u5982\u4f55\u6839\u636e\u8fd9\u4e09\u4e2a\u6570\u7ec4\u62fc\u51d1\u51fa\u7b54\u6848\u6765\n\n\u6700\u540e\u7684\u7b54\u6848\u662f\u4e00\u4e2a\u73af\u5e76\u4e14\u81f3\u5c11\u4f1a\u6709\u4e00\u5bf9\u8ddd\u79bb\u4e3an\u7684\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u94a6\u5b9a\u70b91\u548c\u70b9n+1\u4e00\u5b9a\u662f\u4e00\u5bf9\u540c\u8272\u70b9\uff0c\u5bf9\u4e8e\u4e0d\u662f\u7684\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u628a\u5f97\u5230\u7684\u65b9\u6848\u9006\u65f6\u9488\u65cb\u8f6c\u4e00\u4e2a\u89d2\u5ea6\u4ece\u800c\u751f\u6210\u8fd9\u6837\u7684\u65b9\u6848\n\n\u9996\u5148\u662f\u53ea\u6709\u4e00\u5bf9\u8ddd\u79bb\u4e3an\u7684\u70b9\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u65b9\u6848\u7684\u8d21\u732e\u548c\u662f\n\n$$(g(n-1)+g(n-3))^(n-1)^2$$\n\n\u5176\u4e2dn-1\u7684\u4e00\u9879\u8868\u793a\u6700\u540e\u7684\u65b9\u6848\u5f53\u4e2d\u4e0d\u5b58\u5728\u56fe\u5f621\u800cn-3\u7684\u4e00\u9879\u8868\u793a\u5b58\u5728\u56fe\u5f621\n\n\u5176\u6b21\u662f\u6709\u66f4\u591a\u5bf9\u8ddd\u79bb\u4e3an\u7684\u70b9\u7684\u65b9\u6848\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u5bf9\u70b91\u548c\u70b9n+1\u662f\u5426\u662f\u4e00\u5bf9\u540c\u8272\u70b9\u8fdb\u884c\u5206\u60c5\u51b5\u8ba8\u8bba\uff0c\u5bf9\u4e8e\u662f\u540c\u8272\u70b9\u7684\u60c5\u51b5\u6211\u4eec\u76f4\u63a5\u8ba1\u6570\u800c\u5bf9\u4e8e\u4e0d\u662f\u540c\u8272\u70b9\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u5c1d\u8bd5\u7740\u7528\u4e00\u4e2a1\u548cn+1\u662f\u540c\u8272\u70b9\u7684\u65b9\u6848\u9006\u65f6\u9488\u65cb\u8f6c\u4e00\u4e2a\u89d2\u5ea6\u6765\u5f97\u5230\u8fd9\u79cd\u65b9\u6848\n\n\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u53d1\u73b0\u6b64\u65f6\u4e00\u4e2a\u65b9\u6848\u4f1a\u88ab\u8ba1\u7b97\u597d\u51e0\u6b21\uff0c\u56e0\u4e3a\u6211\u4eec\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u65cb\u8f6c\u89d2\u5ea6\u53ef\u4ee5\u5f97\u5230\u8fd9\u79cd\u65b9\u6848\uff0c\u91c7\u7528\u8ba1\u6570\u9898\u5f53\u4e2d\u7684\u5e38\u89c1\u6280\u5de7\uff0c\u6211\u4eec\u9009\u62e9\u6700\u5c0f\u7684\u65cb\u8f6c\u89d2\u5ea6\u8fdb\u884c\u8ba1\u6570\n\n\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u9700\u8981\u679a\u4e3e\u7b2c\u4e8c\u5bf9\u8ddd\u79bb\u4e3an\u7684\u540c\u8272\u70b9\u4e0e\u70b91\u7684\u8ddd\u79bb\n\n\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u67ff\u5b50\n\n$$\\sum_{i=2}^{n-2}i(i-1)^2(g(i-1)f_{0}(n-i-1)+2g(i-2)f_{1}(n-i-2)+g(i-3)f_{2}(n-i-3))$$\n\n\u5176\u4e2d\u7b2c\u4e00\u9879\u8868\u793a\u6709i\u79cd\u4e0d\u540c\u7684\u65cb\u8f6c\u89d2\u5ea6\u53ef\u4ee5\u9009\u62e9\uff0c(\u5176\u4ed6\u60c5\u51b5\u7b2c\u4e8c\u5bf9\u70b9\u5c06\u4f1a\u53d8\u6210\u7b2c\u4e00\u5bf9\u70b9\uff0c\u8fd9\u4e2a\u81ea\u5df1\u753b\u56fe\u7406\u89e3\u4e0b),\u5e73\u65b9\u9879\u8868\u793a\u8ddd\u79bb\u7684\u5bf9\u7b54\u6848\u7684\u8d21\u732e\n\n\u7b2c\u4e8c\u9879\u8868\u793a\u5269\u4e0b\u7684\u5e8f\u5217\u662ff1\u578b\u65f6\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u7b2c3\u9879\u8868\u793a\u7684\u662ff2\u578b\u5e8f\u5217\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u7b2c3\u9879\u8868\u793af3\u578b\u5e8f\u5217\u5bf9\u7b54\u6848\u7684\u8d21\u732e\n\n(\u5982\u679c\u76f4\u63a5\u5199\u201c\u81ea\u5df1\u5377\u81ea\u5df1\u201d\u5f62\u5f0f\u7684\u5206\u6cbbfft\u4f18\u5316\u4e0a\u8ff0\u7684dp\u6211\u4eec\u5c06\u4f1a\u5f97\u5230\u4e00\u4e2a\u4f18\u79c0\u7684\n$O(nlog^2n)$\u7b97\u6cd5)\n\n\u5982\u6b64\u8fd9\u822c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u7b80\u5355\u6613\u61c2(\u5e76\u4e0d\u7684)$O(N^2)/O(nlog^2n)$\u7b97\u6cd5\u4e86,\u8ba9\u6211\u4eec\u5c1d\u8bd5\u52a0\u901f\u8fd9\u4e2a\u7b97\u6cd5\n\n## \u4f7f\u7528\u751f\u6210\u51fd\u6570\u8868\u793a\u8f6c\u79fb\n\n\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u7684\u8f6c\u79fb\u65b9\u7a0b\u90fd\u662f\u4e00\u4e9b\u6570\u5217\u505a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u8fd9\u542f\u793a\u6211\u4eec\u5217\u51e0\u4e2a\u751f\u6210\u51fd\u6570\u7684\u67ff\u5b50\u51fa\u6765\n\n\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u8bbe\n\n$$G_{0}(z)=\\sum_{k}g_{0}(k)z^k$$\n\n$$G_{1}(z)=\\sum_{k}g_{1}(k)z^k$$\n\n$$G_{2}(z)=\\sum_{k}g_{2}(k)z^k$$\n\n$$F_{0}(z)=\\sum_{k}F_{0}(k)z^k$$\n\n$$F_{1}(z)=\\sum_{k}F_{1}(k)z^k$$\n\n$$F_{2}(z)=\\sum_{k}F_{2}(k)z^k$$\n\n\u90a3\u4e48\u521a\u624d\u8f6c\u79fb\u65b9\u7a0b\u5c31\u53ef\u4ee5\u91cd\u65b0\u5199\u6210\u751f\u6210\u51fd\u6570\u7684\u5f62\u5f0f\n\n$$F_{0}(z)=G_{0}(z)+G_{0}(z)F_{0}(z)z+G_{1}(z)F_{1}(z)z^3$$\n\n$$F_{1}(z)=G_{1}(z)+G_{1}(z)F_{0}(z)z+G_{2}(z)F_{1}(z)z^3$$\n\n$$F_{2}(z)=G_{2}(z)+G_{1}(z)F_{1}(z)z+G_{2}(z)F_{2}(z)z^3$$\n\n\u6211\u4eec\u5982\u679c\u628a$G_{0,1,2}(z),z,z^3$\u8fd9\u4e9b\u9879\u5f53\u6210\u5e38\u6570\uff0c\u628a$F_{0}(z),F_{1}(z)$\n\u8fd9\u4e9b\u591a\u9879\u5f0f\u5f53\u6210\u53d8\u91cf\uff0c\u90a3\u4e48\u524d\u4e24\u4e2a\u9012\u63a8\u5f0f\u5c31\u662f\u4e00\u4e2a\u4e8c\u5143\u4e00\u6b21\u65b9\u7a0b\u7ec4\uff0c\u7528\u524d\u9762\u7684\u67ff\u5b50\u89e3\u51fa$F_{1}(z)$\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u7528$F_{1}(z)$\u8868\u793a$F_{2}(z)$\u4e86\n\n\u90a3\u4e48\u7a0d\u5fae\u89e3\u4e00\u4e0b\u65b9\u7a0b\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u8868\u8fbe\u5f0f~~(dirty works\u8b66\u544a)~~\n\n$$F_{0}(z)=\\frac{G_{1}(z)z^3-G_{0}(z)(G_{2}(z)z^3-1)}{(G_{0}(z)z-1)(G_{2}(z)z^3-1)-G_{1}^{2}(z)z^4}$$\n\n$$F_{1}(z)=\\frac{G_{1}(z)}{(G_{0}(z)z-1)(G_{2}(z)z^3-1)-G_{1}^{2}(z)z^4}$$\n\n$$F_{2}(z)=\\frac{G_{2}(z)+G_{1}(z)zF_{1}(z)}{1-G_{2}(z)z^3}$$\n\n\u5982\u679c\u6211\u4eec\u4f7f\u7528\u591a\u9879\u5f0f\u6c42\u9006\u548c\u591a\u9879\u5f0f\u4e58\u6cd5\u76f4\u63a5\u6c42\u89e3\u4e0a\u9762\u7684\u751f\u6210\u51fd\u6570\uff0c\u590d\u6742\u5ea6\u662f$O(nlogn)$\u7684\uff0c\u5f53\u7136\u4ee3\u4ef7\u662fntt\u548c\u6c42\u9006\u51fa\u4e86\u540d\u7684\u5927\u5e38\u6570\n\n\u90a3\u4e48\u6709\u6ca1\u6709\u66f4\u5757\u7684\u505a\u6cd5\u5462\uff1f\u7b54\u6848\u662f\u6709\u7684\n\n## \u751f\u6210\u51fd\u6570\u7684\u6c42\u5bfc\n\n\u8ba9\u6211\u4eec\u4ece\u95ee\u9898\u7684\u5f00\u5934\u5f00\u59cb\n\n\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6570\u5217$g$\u6ee1\u8db3\u9012\u63a8\u5f0f\n\n$$g(n)=g(n-2)+g(n-4),g(0)=1,g(1)=0$$\n\n\u90a3\u4e48\u5982\u679c\u6211\u4eec\u7a0d\u5fae\u89c2\u5bdf\u4e00\u4e0b\u8fd9\u4e2a\u67ff\u5b50\u5c31\u4f1a\u7acb\u9a6c\u5f97\u77e5\u8fd9\u4e2a\u6570\u5217\u7684\u5947\u6570\u9879\u662f\u6ca1\u6709\u503c\u7684\uff0c\u800c\u5076\u6570\u9879\u548c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6570\u5217\u662f\u4e00\u6837\u7684\uff0c\u5177\u4f53\u70b9\u8bb2\u6211\u4eec\u6709$g(2n)=fib(n)$\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f88\u5feb\u7684\u6c42\u51fa\u6570\u5217$g$\u7684\u751f\u6210\u51fd\u6570\u5c31\u662f\n\n$$G(z)=\\frac{1}{1-z^{2}-z^{4}}$$\n\n\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u6211\u4eec\u77e5\u9053\u4e86$G(z)$\u7684\u751f\u6210\u51fd\u6570\u5e76\u6ca1\u6709\u4ec0\u4e48\u5375\u7528\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7684\u662f$G_{0,1,2}(z)$\u7684\u751f\u6210\u51fd\u6570\uff0c\u800c\u6570\u5217$g_{0,1,2}$\u662f$g$\u6570\u5217\u4e58\u4e86\u4e00\u4e2a\u4e0b\u6807\uff0c\u8fd9\u5c31\u8ba9\u6211\u4eec\u975e\u5e38\u5934\u75db\u4e86\u2026\u2026\n\n\u6b64\u65f6\u6211\u4eec\u60f3\u5230\u4e86\u6c42\u5bfc\u8fd9\u4e2a\u6709\u8da3\u7684\u5de5\u5177\n\n\u5982\u679c\u6211\u4eec\u5c06\u6570\u5217$g$\u7684\u751f\u6210\u51fd\u6570$G(z)$\u6c42\u5bfc\u4e4b\u540e\u518d\u4e58\u4e0az,\u90a3\u4e48\u4ea7\u751f\u7684\u65b0\u6570\u5217$g'$\u7684\u901a\u9879\u516c\u5f0f\u5c31\u662f$g'(n)=g(n)n$\n\n\u4e0d\u8fc7\u6211\u4eec\u8981\u62fc\u51d1\u7684\u6570\u5217\u662f\u5f62\u5982$g_{0}(n)=g(n)n^2$\u7684\u5f62\u5f0f\uff0c\u4e3a\u4e86\u51d1\u51fa\u4e8c\u6b21\u9879\uff0c\u6211\u4eec\u5c06\u751f\u6210\u51fd\u6570\u6c42\u4e8c\u9636\u5bfc\u4e4b\u540e\u4e58\u4e0a$z^2$\uff0c\u5f97\u5230\u7684\u6570\u5217$g''$\u7684\u901a\u9879\u516c\u5f0f\u5c31\u662f$g''(n)=g(n)n(n-1)=g(n)n^2-g(n)n$\n\n\u6b64\u65f6\u6211\u4eec\u7a0d\u5fae\u914d\u4e0a\u4e00\u4e9b\u7cfb\u6570\u5c31\u80fd\u7528$g,g',g''$\u4e09\u4e2a\u6570\u5217\u62fc\u51d1\u51fa$g_{0},g_{1},g_{2}$\u4e86\n\n\u5177\u4f53\u70b9\u6765\u8bb2\u6211\u4eec\u6709\u8fd9\u6837\u7684\u67ff\u5b50\n\n$$G_{0}(z)=z^2G''(z)+zG'(z)$$\n\n$$G_{1}(z)=z^2G''(z)+3zG'(z)+G(z)$$\n\n$$G_{2}(z)=z^2G''(z)+5zG'(z)+4G(z)$$\n\n\u7136\u540e\u73b0\u5728\u6211\u4eec\u9700\u8981\u63a5\u7740\u505a\u4e00\u4e9bdirty works,\u6bd4\u5982\u6c422\u9636\u5bfc\u4ee5\u53ca\u628a\u51e0\u4e2a\u5206\u5f0f\u52a0\u8d77\u6765\uff0c\u76f8\u4fe1\u5927\u5bb6\u53ef\u4ee5\u5f88\u5feb\u7684\u624b\u7b97\u51fa\u6765(\u7b97\u4e0d\u51fa\u6765\u7684\u53ef\u4ee5\u50cf\u6211\u4e00\u6837\u4f7f\u7528wolfram alpha)\uff0c\u603b\u4e4b\u6211\u4eec\u5f97\u5230\u4e86\u8fd9\u6837\u7684\u4e09\u4e2a\u751f\u6210\u51fd\u6570\n\n$$G_{0}(z)=\\frac{16z^8+12z^6+20z^4+4z^2}{-z^{12}-3z^{10}+5z^6-3z^2+1}$$\n\n$$G_{1}(z)=\\frac{9z^8+2z^6+23z^4+6z^2+1}{-z^{12}-3z^{10}+5z^6-3z^2+1}$$\n\n$$G_{2}(z)=\\frac{4z^8-4z^6+24z^4+4z^2+4}{-z^{12}-3z^{10}+5z^6-3z^2+1}$$\n\n(\u76f8\u5f53\u8003\u9a8c\u4eba\u7c7b\u667a\u6167\u7684\u7206\u7b97\u2026\u2026\uff0c\u5efa\u8bae\u8fd8\u662f\u7528wolfram alpha\u5e2e\u4f60\u8ba1\u7b97\u597d\u4e86)\n\n\u7136\u540e\u7ecf\u8fc7\u89c2\u5bdf\u6211\u4eec\u53d1\u73b0\u8fd9\u4e09\u4e2a\u751f\u6210\u51fd\u6570\u7684\u5206\u6bcd\u90fd\u662f\u4e00\u6837\u7684\uff0c\u6709\u6240\u4e0d\u540c\u7684\u53ea\u662f\u5206\u6bcd\u800c\u5df2\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4ee4\n\n$$Q(z)=-z^{12}-3z^{10}+5z^6-3z^2+1$$\n\n$$P_{0}(z)=16z^8+12z^6+20z^4+4z^2$$\n\n$$P_{1}(z)=9z^8+2z^6+23z^4+6z^2+1$$\n\n$$P_{2}(z)=4z^8-4z^6+24z^4+4z^2+4$$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u4f1a\u53d1\u73b0$G_{0,1,2}(z)=\\frac{P_{0,1,2}(z)}{Q(z)}$\n\n\u6b64\u65f6\u5728$F_{0}(z),F_{1}(z)$\u4e0a\u4e0b\u540c\u65f6\u4e58\u4ee5$Q^2(z)$\u6211\u4eec\u5c31\u53ef\u4ee5\u7528$P_{0,1,2}(z),Q(z)$\u6765\u8868\u793a$F_{0}(z),F_{1}(z)$\u4e86\n\n\u5177\u4f53\u6765\u8bb2\u6211\u4eec\u4f1a\u5f97\u5230\u8fd9\u6837\u7684\u67ff\u5b50\n\n$$F_{0}(z)=\\frac{P_{1}(z)Q(z)z^3-P_{0}(z)(P_{2}(z)z^3-1)}{(P_{0}(z)z-1)(P_{2}(z)z^3-1)-P_{1}^{2}(z)z^4}$$\n\n$$F_{1}(z)=\\frac{P_{1}(z)Q(z)}{(P_{0}(z)z-1)(P_{2}(z)z^3-1)-P_{1}^{2}(z)z^4}$$\n\n\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u6d88\u53bb$F_{2}$\u5f53\u4e2d\u7684$F_{1}$\u5462?\n\n\u4e00\u79cd\u53ef\u884c\u7684\u65b9\u6cd5\u5f53\u7136\u662f\u7206\u7b97\uff0c\u4e0d\u8fc7\u6211\u4eec\u4e3a\u4e86\u5728\u8fd9\u91cc\u51cf\u5c11\u4e00\u70b9\u8ba1\u7b97\u91cf\u53ef\u4ee5\u4ee4$F_{1}(z)=\\frac{M(z)}{N(z)}$\n\n\u7136\u540e\u5728$F_{2}$\u7684\u5206\u6bcd\u4e0a\u4e0b\u540c\u65f6\u4e58\u4e0a\u4e00\u4e2a$N(z)Q(z)$\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u67ff\u5b50\u4e86\n\n$$F_{2}(z)=\\frac{N(z)P_{2}(z)+P_{1}(z)M(z)z}{N(z)(Q(z)-P_{2}(z)z^3)}$$\n\n\u597d\u5566\u4f60\u4f1a\u8bf4\u6211\u4eec\u80e1\u4e71\u63a8\u4e86\u4e00\u6ce2\u67ff\u5b50\u6700\u540e\u4e0d\u8fd8\u662f\u8981\u5199\u591a\u9879\u5f0f\u6c42\u9006\u5417\uff1f\n\n\u4ed4\u7ec6\u89c2\u5bdf\u6211\u4eec\u63a8\u51fa\u6765\u7684\u67ff\u5b50\uff0c\u4f60\u4f1a\u53d1\u73b0\u548c\u4e4b\u524d\u7684\u6c42\u9006\u4e0d\u540c\u7684\u662f,\u6211\u4eec\u63a8\u51fa\u6765\u7684\u5f0f\u5b50\u7684\u5206\u5b50\u548c\u5206\u6bcd\u90fd\u662f\u4e00\u4e2a**\u4f4e\u9636\u7684\u591a\u9879\u5f0f**\uff0c\u6b21\u6570\u4e0d\u4f1a\u8d85\u8fc740\uff0c\u8fd9\u6709\u4ec0\u4e48\u7528\u5462\uff1f\n\n\u8fd9\u91cc\u79d1\u666e\u4e00\u4e2a\u66b4\u529b\u8ba1\u7b97$\\frac{P(x)}{Q(x)}$\u7684\u65b9\u6cd5\n\n\u6211\u4eec\u4ee4$F(x)=\\frac{P(x)}{Q(x)},C(x)=1-Q(x)$\n\n\u90a3\u4e48\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5f97\u5230\n\n$$F(x)=\\frac{P(x)}{1-C(x)}$$\n\n$$F(x)(1-C(x))=P(x)$$\n\n$$F(x)=F(x)C(x)+P(x)$$\n\n\u4e0a\u9762\u7684\u67ff\u5b50\u5b9e\u9645\u4e0a\u63cf\u8ff0\u4e86\u4e00\u4e2a\u5e38\u7cfb\u6570\u7ebf\u6027\u9012\u63a8\u5f0f,\u5982\u679c$C(x)$\u7684\u6b21\u6570\u4e0d\u662f\u5f88\u5927\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u66b4\u529b\u8ba1\u7b97$F(x)$\u6bd4\u5982\u5728\u8fd9\u9053\u9898\u4e2d\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2atrick\u975e\u5e38\u5757\u7684\u628a$F_{0,1,2}$\u4e09\u4e2a\u751f\u6210\u51fd\u6570\u7684\u524dn\u9879\u7b97\u51fa\u6765\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a$O(40n)/O(n)$\u7684\u7b97\u6cd5\u4e86\uff0c\u53ef\u4ee5\u8f7b\u677e\u7684\u901a\u8fc7\u672c\u9898~\n\n\u4e0a\u4ee3\u7801~\n\n```Cpp\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=1e5+10;const int S=40;\ntypedef unsigned long long ll;const ll mod=998244353;\nstruct poly\n{\n\tint a[S+10];\n\tinline int& operator [](const int & x){return a[x];}\n\tpoly(){for(int i=0;i<S;i++)a[i]=0;}\n\tfriend poly operator * (poly a,poly b)\n\t{\n\t\tpoly c;for(int i=0;i<S;i++)\n\t\t\tfor(int j=0;j<S&&i+j<S;j++)c[i+j]+=a[i]*b[j];return c;\t\n\t} \n\tfriend poly operator +(poly a,poly b){poly c;for(int i=0;i<S;i++)c[i]=a[i]+b[i];return c;}\n\tfriend poly operator -(poly a,poly b){poly c;for(int i=0;i<S;i++)c[i]=a[i]-b[i];return c;}\n\tpoly operator <<(const int& x){poly c;for(int i=S-1;i>=x;i--)c[i]=a[i-x];return c;}\n}a,b,c,q,fz,fm,fz1,fm1;int n;\nll f0[N];ll c0[N];ll f1[N];ll c1[N];ll f2[N];ll c2[N];ll g[N];ll sqr[N];\ninline void calc(poly& fz,poly& fm,ll* f,ll* c)//\u66b4\u529b\u9664\u6cd5\n{\n\tfor(int i=0;i<S;i++)f[i]=(mod+fz[i])%mod;\n\tfor(int i=0;i<S;i++)c[i]=(mod-fm[i])%mod;(c[0]+=1)%=mod;\n\tfor(int i=0;i<=n;i++)\n\t\tfor(int j=1;j<S&&j<=i;j++)(f[i]+=f[i-j]*c[j])%=mod;\n}\nint main()\n{\n\ta[8]=16;a[6]=12;a[4]=20;a[2]=4;b[8]=9;b[6]=2;b[4]=23;b[2]=6;b[0]=1;\n\tc[8]=4;c[6]=-4;c[4]=24;c[2]=4;c[0]=4;q[12]=-1;q[10]=-3;q[6]=+5;q[2]=-3;q[0]=+1;\n\tscanf(\"%d\",&n);//\u6309\u7167\u63a8\u51fa\u6765\u7684\u67ff\u5b50\u8ba1\u7b97f1,f2,f3\n\tfz=((b*b)<<3)-a*((c<<3)-q);fm=((c<<3)-q)*((a<<1)-q)-((b*b)<<4);calc(fz,fm,f0,c0);\n\tfz=b*q;fm=((c<<3)-q)*((a<<1)-q)-((b*b)<<4);calc(fz,fm,f1,c1);\n\tfz1=c*fm+((b*fz)<<1);fm1=fm*(q-(c<<3));calc(fz1,fm1,f2,c2);\n\tg[0]=1;g[2]=1;for(int i=4;i<=n;i++)g[i]=(g[i-2]+g[i-4])%mod;\n\tfor(int i=1;i<=n;i++)sqr[i]=(ll)i*i%mod;\n\tll ans=(g[n-1]+g[n-3])*sqr[n-1]%mod*n%mod;\n\tfor(int i=2;i<=n-2;i++)\n\t{\n\t\tll ret=0;(ret+=g[i-1]*f0[n-i-1])%=mod;(ret+=g[i-2]*f1[n-i-2]*2)%=mod;\n\t\tif(3<=i&&i<=n-3)(ret+=g[i-3]*f2[n-i-3])%=mod;\n\t\t(ans+=ret*sqr[i-1]%mod*i)%=mod;\n\t}printf(\"%I64d\",ans);//\u62dc\u62dc\u7a0b\u5e8f~\n}\n```\n\n",
        "postTime": 1551362557,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF848E \u3010Days of Floral Colours\u3011"
    },
    {
        "content": "\u5728\u535a\u5ba2\u56ed\u98df\u7528\u66f4\u4f73\uff1a[https://www.cnblogs.com/PinkRabbit/p/CF848E.html](https://www.cnblogs.com/PinkRabbit/p/CF848E.html)\u3002\n\n### \u9898\u89e3\n\n\u6211\u4eec\u79f0\u4e00\u5bf9\u76f8\u8ddd\u4e3a $n$ \u7684\u540c\u8272\u82b1\u4e3a\u4e00\u4e2a\u300c\u9694\u677f\u300d\u3002\n\n\u5c06\u9898\u76ee\u4e2d\u5b9a\u4e49\u7684\u8fde\u7eed\u6bb5\uff0c\u5411\u9006\u65f6\u9488\u65b9\u5411\u6269\u5c55\u4e00\u683c\uff0c\u4e5f\u5c31\u662f\u4e5f\u628a\u4f5c\u4e3a\u9694\u677f\u7684\u82b1\u5305\u542b\u8fdb\u53bb\u3002\n\n\u7531\u4e8e\u82b1\u949f\u662f\u5bf9\u79f0\u7684\uff0c\u663e\u7136\u7f8e\u4e3d\u5ea6\u662f\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u56e0\u4e3a\u4e00\u4e2a\u8fde\u7eed\u6bb5\u4e2d\u5fc3\u5bf9\u79f0\u540e\u8fd8\u662f\u4e00\u6837\u7684\u8fde\u7eed\u6bb5\u3002\n\n\u957f\u5ea6\u4e3a $m$ \u7684\u8fde\u7eed\u6bb5\u4f1a\u4e3a\u7b54\u6848\u4ea7\u751f ${(m - 1)}^2$ \u7684\u4e58\u6cd5\u8d21\u732e\uff08\u53ea\u8ba1\u7b97\u4e00\u8fb9\uff09\u3002\n\n\u73af\u4e0a\u76f8\u5bf9\u4e0d\u597d\u8003\u8651\uff0c\u6211\u4eec\u8fd8\u662f\u8003\u8651\u7834\u73af\u4e3a\u94fe\uff0c\u56e0\u4e3a\u662f\u5bf9\u79f0\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8003\u8651 $1 \\sim n$ \u4e2d\u7684\u6240\u6709\u82b1\u3002\n\n\u53ef\u662f $1$ \u6240\u5728\u7684\u8fde\u7eed\u6bb5\u53ef\u80fd\u548c $n$ \u6240\u5728\u7684\u8fde\u7eed\u6bb5\u662f\u8de8\u8fc7\u5206\u754c\u70b9\u76f8\u8fde\u7684\uff0c\u8fd9\u8be5\u600e\u4e48\u529e\uff1f\n\n\u6211\u4eec\u8fd9\u6837\u8003\u8651\uff1a\u5bf9\u4e8e $1$ \u6240\u5728\u8fde\u7eed\u6bb5\u7684\u6700\u300c\u5de6\u300d\uff08\u60f3\u8c61\u8fd9\u662f\u4e0a\u534a\u5706\u5f27\uff09\u4fa7\u70b9\uff08\u4e5f\u5c31\u662f\u90a3\u4e2a\u9694\u677f\uff09\uff0c\u5b83\u53ef\u80fd\u5728 $1$ \u672c\u8eab\u7684\u4f4d\u7f6e\uff0c\u4e5f\u6709\u53ef\u80fd\u5728 $n + 2 \\sim 2 n$ \u4e4b\u95f4\uff0c\u628a\u5b83\u7684\u4f4d\u7f6e\u5f3a\u884c\u987a\u65f6\u9488\u79fb\u52a8\u5230 $1$ \u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8de8\u8fc7\u5206\u754c\u70b9\u76f8\u8fde\u7684\u60c5\u51b5\u3002\u4f46\u662f\u4f1a\u7edf\u8ba1\u6f0f\u60c5\u51b5\uff0c\u5c31\u662f\u90a3\u4e9b\u9694\u677f\u4e0d\u5728 $1$ \u672c\u8eab\u7684\u4f4d\u7f6e\u4e0a\u7684\u60c5\u51b5\uff0c\u89e3\u51b3\u7684\u65b9\u6cd5\u662f\u679a\u4e3e\u8fd9\u4e00\u6bb5\u7684\u957f\u5ea6 $m$\uff0c\u90a3\u4e48\u5c31\u6709 $m$ \u79cd\u65cb\u8f6c\u65b9\u6848\u4e86\uff0c\u5177\u4f53\u7ec6\u8282\u4e0b\u9762\u5c55\u5f00\u8ba8\u8bba\u3002\n\n\u603b\u4e4b\u7ecf\u8fc7\u8f6c\u6362\u6211\u4eec\u53ef\u4ee5\u770b\u6210\u662f\u53ea\u9700\u7edf\u8ba1\u5e8f\u5217\u4e0a\u800c\u975e\u73af\u4e0a\u7684\u60c5\u51b5\u3002\n\n\u6211\u4eec\u662f\u4ee5\u6bcf\u4e2a\u9694\u677f\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u4e00\u8d77\u8f6c\u79fb\u7684\uff0c\u5148\u8003\u8651\u8fd9\u6837\u7684\u7b80\u5355\u60c5\u51b5\uff1a\n\n\u957f\u5ea6\u4e3a $m$ \u7684\u4e00\u6bb5\uff0c\u53ea\u5141\u8bb8\u6bb5\u5185\u8fde\u8fb9\uff0c\u4e14\u6bb5\u5185\u4e0d\u80fd\u6709\u9694\u677f\uff0c\u95ee\u65b9\u6848\u6570\uff0c\u4ee4\u5176\u4e3a $g[m]$\u3002\n\n\u6bb5\u5185\u662f\u6ca1\u6709\u9694\u677f\u7684\uff0c\u90a3\u5c31\u53ea\u6709\u4e24\u79cd\u6700\u5c0f\u5355\u5143\u7684\u8fde\u8fb9\u5f62\u5f0f\uff1a$(i) \\leftrightarrow (i + 1)$ \u548c $(i) \\leftrightarrow (i + 2), (i + 1) \\leftrightarrow (i + 3)$\u3002\n\n\u4e00\u4e2a\u5360\u7528\u8fde\u7eed\u4e24\u4e2a\u4f4d\u7f6e\uff0c\u53e6\u4e00\u4e2a\u5360\u7528\u8fde\u7eed\u56db\u4e2a\u4f4d\u7f6e\u3002\u663e\u7136\uff1a$g[0] = 1$\uff0c$g[m] = g[m - 2] + g[m - 4]$\u3002\n\n\u5982\u679c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u662f $f$\uff0c\u5176\u5b9e\u6709 $f[n + 1] = g[2 n]$\uff0c\u4e0d\u8fc7\u8fd9\u4e0d\u662f\u5173\u952e\u70b9\uff0c\u53ea\u662f\u4e3a\u4e86\u5e2e\u52a9\u7406\u89e3\u3002\n\n\u8fd9\u4e2a\u6570\u5217\u5728\u4e00\u5b9a\u610f\u4e49\u4e0b\u786e\u5b9e\u53ef\u4ee5\u8868\u793a\u4e00\u4e2a\u8fde\u7eed\u6bb5\u4e86\uff0c\u53ea\u4e0d\u8fc7\u8fd8\u6709\u70b9\u7455\u75b5\uff0c\u56e0\u4e3a\u8fde\u7eed\u6bb5\u53ef\u4e0d\u6b62\u4e00\u79cd\u3002\n\n\u5176\u5b9e\u6709 $4$ \u79cd\uff08\u6216 $3$ \u79cd\uff09\u8fde\u7eed\u6bb5\uff0c\u6839\u636e\u8be5\u8fde\u7eed\u6bb5\u5de6\u53f3\u4fa7\u7684\u9694\u677f\u7684\u60c5\u51b5\u5206\u7c7b\uff1a\n\n- \u5de6\u53f3\u4fa7\u9694\u677f\u90fd\u6ca1\u6709\u88ab\u4e00\u5bf9\u8ddd\u79bb\u4e3a $2$ \u7684\u540c\u8272\u82b1\u5bf9\u8de8\u8fc7\u3002\n- \u5de6\u4fa7\u9694\u677f\u88ab\u8de8\u8fc7\uff0c\u53f3\u4fa7\u9694\u677f\u6ca1\u88ab\u8de8\u8fc7\u3002\n- \u5de6\u4fa7\u9694\u677f\u6ca1\u88ab\u8de8\u8fc7\uff0c\u53f3\u4fa7\u9694\u677f\u88ab\u8de8\u8fc7\u3002\n- \u5de6\u53f3\u4fa7\u9694\u677f\u90fd\u88ab\u8de8\u8fc7\u3002\n\n\u4e2d\u95f4\u4e24\u7c7b\u662f\u5bf9\u79f0\u7684\u6240\u4ee5\u8ba1\u6570\u7684\u65f6\u5019\u6c42\u51fa\u6765\u7684\u503c\u80af\u5b9a\u90fd\u76f8\u540c\u3002\n\n\u7b2c $1$ \u79cd\u8fde\u7eed\u6bb5\uff0c\u957f\u5ea6\u4e3a $m$ \u65f6\u65b9\u6848\u6570\u5c31\u662f $g[m - 1]$\u3002\n\n\u7b2c $2, 3$ \u79cd\u8fde\u7eed\u6bb5\uff0c\u957f\u5ea6\u4e3a $m$ \u65f6\u65b9\u6848\u6570\u5c31\u662f $g[m - 2]$\u3002\n\n\u7b2c $4$ \u79cd\u8fde\u7eed\u6bb5\uff0c\u957f\u5ea6\u4e3a $m$ \u65f6\u65b9\u6848\u6570\u5c31\u662f $g[m - 3]$\u3002\n\n\u7136\u800c\u6bcf\u4e00\u79cd\u5bf9\u7b54\u6848\u90fd\u4ea7\u751f ${(m - 1)}^2$ \u7684\u4e58\u6cd5\u8d21\u732e\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u505a DP \u4e86\uff0c\u6bcf\u6b21\u8f6c\u79fb\u4e00\u6574\u4e2a\u8fde\u7eed\u6bb5\u3002\n\n\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u9700\u8981\u6839\u636e\u5de6\u53f3\u4fa7\u9694\u677f\u7684\u72b6\u6001\u6765\u786e\u5b9a\u65b9\u6848\uff0c\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u53f3\u4fa7\u9694\u677f\u540c\u65f6\u662f\u4e0b\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u5de6\u4fa7\u9694\u677f\u3002\n\n\u4e5f\u5c31\u662f\u8bf4 DP \u72b6\u6001\u4e2d\u8bb0\u5f55\u4e0b\u4e0a\u4e2a\u8fde\u7eed\u6bb5\u7684\u53f3\u4fa7\u9694\u677f\u7684\u72b6\u6001\u662f\u6709\u5fc5\u8981\u7684\u3002\n\n\u5b9e\u9645\u4e0a\u8bb0\u5f55\u5de6\u4fa7\u9694\u677f\u7684\u72b6\u6001\u4e5f\u662f\u6709\u5fc5\u8981\u7684\uff0c\u8fd9\u4e0e\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\u6700\u540e\u628a\u5e8f\u5217\u4e0a\u7684\u7b54\u6848\u8f6c\u6362\u56de\u73af\u4e0a\u6709\u5173\u3002\n\n\u603b\u4e4b\u6211\u4eec\u5b9a\u4e49\u4e0b\u5217\u51e0\u4e2a\u5e8f\u5217\uff1a\n\n- $f_0[m]$ \u8868\u793a\u8fde\u7eed\u6bb5\u62fc\u8d77\u6765\u603b\u957f\u4e3a $m$\uff0c\u4e14\u6700\u5de6\u4fa7\u3001\u6700\u53f3\u4fa7\u9694\u677f\u90fd\u6ca1\u88ab\u8de8\u8fc7\uff0c\u6bcf\u79cd\u65b9\u6848\u7684\u8d21\u732e\u603b\u548c\u3002\n- $f_1[m]$ \u8868\u793a\u6700\u5de6\u4fa7\u6216\u6700\u53f3\u4fa7\u6070\u6709\u4e00\u4fa7\u7684\u9694\u677f\u88ab\u8de8\u8fc7\u7684\u8d21\u732e\u603b\u548c\uff0c\u7531\u5bf9\u79f0\u6027\u5b83\u4eec\u4fe9\u7684\u503c\u76f8\u540c\u3002\n- $f_2[m]$ \u8868\u793a\u6700\u5de6\u53f3\u4e24\u4fa7\u7684\u9694\u677f\u90fd\u88ab\u8de8\u8fc7\u4e86\u7684\u8d21\u732e\u603b\u548c\u3002\n\n\u90a3\u4e48\u5b83\u4eec\u5c31\u53ef\u4ee5\u4e92\u76f8\u8f6c\u79fb\u4e86\uff1a\n\n$$ \\begin{aligned} f_0[m] &= {(m - 1)}^2 g[m - 1] + \\sum_{i = 1}^{m - 1} f_0[m - i] {(i - 1)}^2 g[i - 1] + \\sum_{i = 2}^{m - 2} f_1[m - i] {(i - 1)^2} g[i - 2] \\\\ f_1[m] &= {(m - 1)}^2 g[m - 2] + \\sum_{i = 2}^{m - 1} f_0[m - i] {(i - 1)}^2 g[i - 2] + \\sum_{i = 3}^{m - 2} f_1[m - i] {(i - 1)^2} g[i - 3] \\\\ f_2[m] &= {(m - 1)}^2 g[m - 3] + \\sum_{i = 2}^{m - 2} f_1[m - i] {(i - 1)}^2 g[i - 2] + \\sum_{i = 3}^{m - 3} f_2[m - i] {(i - 1)^2} g[i - 3] \\end{aligned} $$\n\n\u5f62\u5f0f\u5dee\u4e0d\u591a\uff0c\u5177\u4f53\u5c31\u662f\u7b2c\u4e00\u9879\u662f\u5176\u4e2d\u6ca1\u6709\u5176\u5b83\u9694\u677f\u7684\u60c5\u51b5\uff0c\u7b2c\u4e8c\u9879\u662f\u5012\u6570\u7b2c\u4e8c\u4e2a\u9694\u677f\u6ca1\u88ab\u8de8\u8fc7\u7684\u60c5\u51b5\uff0c\u7b2c\u4e09\u9879\u662f\u5012\u6570\u7b2c\u4e8c\u4e2a\u9694\u677f\u88ab\u8de8\u8fc7\u7684\u60c5\u51b5\u3002\u5176\u4e2d $f_1[m]$ \u7684\u9012\u63a8\u5f0f\u5047\u8bbe\u6700\u5de6\u4fa7\u9694\u677f\u6ca1\u88ab\u8de8\u8fc7\uff0c\u800c\u6700\u53f3\u4fa7\u9694\u677f\u88ab\u8de8\u8fc7\u4e86\u3002\n\n\u8fd9\u6837\u76f4\u63a5\u8f6c\u79fb\uff0c\u590d\u6742\u5ea6\u662f $\\mathcal O (n^2)$ \u7684\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u4e86 CDQ \u591a\u9879\u5f0f\u4e58\u6cd5\u5c31\u53ef\u4ee5\u6210\u529f\u4f18\u5316\u5230 $\\mathcal O (n \\log^2 n)$\u3002\n\n\u7b97\u51fa $f_{0, 1, 2}$ \u540e\uff0c\u6700\u540e\u4e00\u6b65\u5c31\u662f\u628a\u5e8f\u5217\u7684\u7b54\u6848\u8fd8\u539f\u6210\u73af\u4e86\u3002\u679a\u4e3e\u4f4d\u7f6e $1$ \u6240\u5728\u7684\u8fde\u7eed\u6bb5\u7684\u957f\u5ea6\u4ee5\u53ca\u5c5e\u4e8e\u54ea\u4e00\u7c7b\uff0c\u5269\u4e0b\u7684\u5c31\u53ef\u4ee5\u770b\u4f5c\u662f\u5e8f\u5217\u4e86\uff0c\u7136\u540e\u5957\u7528 $f_{0, 1, 2}$ \u5f97\u5230\u5269\u4e0b\u90e8\u5206\u7684\u7b54\u6848\u5373\u53ef\u3002\n\n\u5230\u8fd9\u91cc\u5e94\u8be5\u662f\u505a\u5b8c\u4e86\uff0c[\u8fd9\u91cc\u662f\u4ee3\u7801](https://www.luogu.com.cn/paste/rgy7f589)\u3002\u4f46\u662f\u636e\u8bf4\u6709\u4eba\u5341\u5206\u4e27\u5fc3\u75c5\u72c2\uff0c\u4ee4\n\n- $\\displaystyle G_0 = \\mathbf{OGF} \\left( { \\left\\{ {(i - 1)}^2 g[i - 1] \\right\\} }_{i = 1}^{\\infty} \\right)$\u3002\n- $\\displaystyle G_1 = \\mathbf{OGF} \\left( { \\left\\{ {(i - 1)}^2 g[i - 2] \\right\\} }_{i = 2}^{\\infty} \\right)$\u3002\n- $\\displaystyle G_2 = \\mathbf{OGF} \\left( { \\left\\{ {(i - 1)}^2 g[i - 3] \\right\\} }_{i = 3}^{\\infty} \\right)$\u3002\n\n\u4ee5\u53ca $F_0 = \\mathrm{OGF}(f_0), F_1 = \\mathrm{OGF}(f_1), F_2 = \\mathrm{OGF}(f_2)$\u3002\n\n\u7136\u540e\u628a\u5b83\u4eec\u90fd\u7b97\u51fa\u6765\uff08\u7528\u5c01\u95ed\u5f62\u5f0f\u8868\u793a\uff09\uff0c\u7ed3\u679c\u53d1\u73b0\u5b83\u4eec\u90fd\u662f\u591a\u9879\u5f0f\u9664\u4ee5\u591a\u9879\u5f0f\u7684\u5f62\u5f0f\uff0c\u5341\u5206\u4f18\u7f8e\u3002\n\n\u800c\u4e14\u5206\u6bcd\u662f\u4f4e\u9636\u591a\u9879\u5f0f\uff0c\u5c31\u53ef\u4ee5\u7ebf\u6027\u6c42\u9006\u4e86\uff0c\u7136\u540e\u5728 $\\mathcal O (n)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa $f_{0, 1, 2}$\uff0c\u518d\u89e3\u51b3\u5e8f\u5217\u53d8\u6210\u73af\u7684\u95ee\u9898\u3002\n\n\u5176\u5b9e\u53ef\u4ee5\u66f4\u8fdb\u4e00\u6b65\u63a8\u51fa\u6700\u7ec8\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570\u7136\u540e\u7ebf\u6027\u9012\u63a8\u3002\u4e0d\u8fc7\u66b4\u529b\u5199\u5b8c\uff0c\u6574\u4e00\u4e2a BM \u5b83\u4e0d\u9999\u5417\uff1f\n\n\u641e\u4e86\u524d $120$ \u9879\u6254\u8fdb BM \u53ef\u4ee5\u641e\u51fa\u4e00\u4e2a $16$ \u9879\u7ebf\u6027\u9012\u63a8\u5f0f\uff1a\n\n$$ \\{0, 4, 8, -1, 16, -10, 4, -12, -48, 26, -44, 15, -16, -4, -4, -1\\} $$\n\n\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u4ee3\u7801:\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n\ntypedef long long LL;\nconst int Mod = 998244353;\n\nint N, Ans;\n\nint main() {\n\tscanf(\"%d\", &N);\n\tstatic const int R[16] = {0, 4, 8, -1, 16, -10, 4, -12, -48, 26, -44, 15, -16, -4, -4, -1};\n\tint A[16] = {0, 0, 0, 24, 4, 240, 204, 1316, 2988, 6720, 26200, 50248, 174280, 436904, 1140888, 3436404};\n\tfor (int i = 16; i <= N; ++i) {\n\t\tint x = 0;\n\t\tfor (int j = 0; j < 16; ++j)\n\t\t\tx = (x + (LL)R[(i - j - 1) & 15] * A[j]) % Mod;\n\t\tA[i & 15] = x;\n\t}\n\tprintf(\"%d\\n\", (A[N & 15] + Mod) % Mod);\n\treturn 0;\n} // check 848E.cpp for CDQFFT\n```",
        "postTime": 1586199246,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF848E \u3010Days of Floral Colours\u3011"
    },
    {
        "content": "> \u201c\u505a\u591a\u9879\u5f0f\u9898\u5c31\u50cf\u55d1\u836f\uff0c\u51fa\u591a\u9879\u5f0f\u9898\u5c31\u50cf\u8d29\u6bd2......\u201d\n\n# $Solution$\n\n\u8fd9\u836f\u52b2\u513f\u786e\u5b9e\u5927\uff0c\u5b83\u6709\u7740\u795e\u5947\u7684\u9b54\u529b\u8ba9\u6211\u76ef\u7740\u8fd9\u6076\u5fc3\u7684\u4ee3\u7801\u770b\u4e00\u5929\u3002\n\n\u6253\u9898\u534a\u5c0f\u65f6\uff0c\u8c03\u8bd5\u4e00\u6574\u5929\u2014\u2014\u9488\u4e0d\u6233 \n\n$:($\n\n$^_$\n\n## \u51c6\u5907\u5de5\u4f5c\n\n\u8fdb\u5165\u6b63\u9898\u3002\n\n\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u5bf9\u79f0\u7684\u7ed3\u6784\uff0c\u8003\u8651\u5c06\u5176\u8f6c\u5316\u4e3a\u5e8f\u5217\u4e0a\u7684\u95ee\u9898\u3002\n\n\u89c2\u5bdf\u53d1\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u67d3\u8272\u65b9\u5f0f\u5206\u6210\u4ee5\u4e0b\u56db\u79cd\uff1a\n\n$1:\\overbrace{1,\\hat{2},1}$\n\n$2:\\overbrace{1,2,1},2$\n\n$3:\\overbrace{1,1}$\n\n$4:\\hat{1}$\n\n\u5373\uff1a\n\n1. \u9996\u5c3e\u540c\u8272\uff0c\u4e2d\u95f4\u7684\u4e0e\u5bf9\u9762\u5c0f\u7403\uff08\u7403\u5c31\u662f\u82b1\uff0c\u4e0b\u540c\uff09\u540c\u8272\n  \n2. (1,3)(2,4)\u4f4d\u5c0f\u7403\u540c\u8272\n\n3. \u76f8\u90bb\u7684\u4e24\u4e2a\u5c0f\u7403\u540c\u8272\n\n4. \u4e0e\u5bf9\u9762\u7684\u5c0f\u7403\u540c\u8272\n\n\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cbdp\u4e86\n\n## dp\u90e8\u5206\n\n\u8bbe\uff1a\n\n$g[i]$ \u8868\u793a\u957f\u5ea6\u4e3a$i$\u7684\u5e8f\u5217\uff0c\u53ea\u6709\u60c5\u51b52,3\u7684\u65b9\u6848\u6570\n\n$f_0[i]$ \u8868\u793a\u9996\u5c3e\u4e24\u7aef\u90fd\u4e3a\u60c5\u51b54\uff0c\u4e2d\u95f4\u6709i\u4e2a\u7403\u7684\u65b9\u6848\u4ea7\u751f\u7684\u8d21\u732e\n\n$f_1[i]$ \u8868\u793a\u9996\u5c3e\u4e24\u7aef\u4e2d\u4e00\u7aef\u4e3a$\\begin{aligned}\\frac 2 3\\end{aligned}$\u7684\u60c5\u51b51\uff08\u8fd9\u4e24\u79cd\u60c5\u51b5\u662f\u5bf9\u79f0\u7684\uff0c\u8d21\u732e\u76f8\u7b49\uff09\uff0c\u53e6\u4e00\u7aef\u4e3a\u60c5\u51b54\uff0c\u4e2d\u95f4\u6709i\u4e2a\u7403\u7684\u65b9\u6848\u4ea7\u751f\u7684\u8d21\u732e\n\n$f_2[i]$ \u8868\u793a\u9996\u5c3e\u4e24\u7aef\u90fd\u662f$\\begin{aligned}\\frac 2 3\\end{aligned}$\u7684\u60c5\u51b51\uff0c\u4e2d\u95f4\u6709i\u4e2a\u7403\u7684\u65b9\u6848\u4ea7\u751f\u7684\u8d21\u732e\n\n\u90a3\u4e48\u8f6c\u79fb\u5c31\u5f88\u663e\u7136\u4e86\uff1a\n\n$\\begin{aligned}\ng[i]&=g[i-2]+g[i-4]\\\\\nf_0[i]&=g[i]i^2+\\sum_{j=0}^{i-1}g[j]j^2f_0[i-j-1]+\\sum_{j=0}^{i-3}g[j](j+1)^2f_1[i-j-3]\\\\\nf_1[i]&=g[i](i+1)^2+\\sum_{j=0}^{i-1}g[j](j+1)^2f_0[i-j-1]+\\sum_{j=0}^{i-3}g[j](j+2)^2f_1[i-j-3]\\\\\nf_2[i]&=g[i](i+2)^2+\\sum_{j=0}^{i-1}g[j](j+1)^2f_1[i-j-1]+\\sum_{j=0}^{i-3}g[j](j+2)^2f_2[i-j-3]\n\\end{aligned}$\n\n\u89e3\u91ca\u4e00\u4e0b\u5f0f\u5b50\n\n- $f_0$\u5f0f\uff1a\n\n$f_0$ \u4e2d\u7684\u7b2c\u4e00\u9879\u8868\u793a\u6ca1\u6709\u5bf9\u79f0\u70b9\u7684\u65b9\u6848\u4ea7\u751f\u7684\u8d21\u732e\uff0c\u90a3\u4e48\u76f4\u63a5\u5c31\u662f\u65b9\u6848\u6570\uff08$g[i]$\uff09\u4e58\u4e0a\u6bcf\u4e2a\u65b9\u6848\u7684\u8d21\u732e\uff08$i^2$\uff09\u5c31\u5b8c\u4e8b\u513f\u4e86\uff1b\n\n\u7b2c\u4e00\u4e2a$\\sum$ \u662f\u5728\u8ba1\u7b97\u5c06\u7b2c$j+1$\u4e2a\u7403\u67d3\u6210\u60c5\u51b54\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f\u5728\u4f4d\u7f6e$j+1$\u7528\u60c5\u51b54\u5206\u6bb5\uff0c\u90a3\u4e48\u524d$j$\u4e2a\u7403\u5373\u5168\u90e8\u662f\u60c5\u51b52,3\uff0c\u8d21\u732e\u4e3a$g[j]j^2$\uff0c\u540e\u9762\u4e00\u534a\u7684\u8d21\u732e\u4e3a$f_0[i-j-1]$\uff0c\u76f8\u4e58\u5373\u53ef\uff1b\n\n\u7b2c\u4e8c\u4e2a$\\sum$ \u662f\u5728\u8ba1\u7b97\u5c06$(j,j+1,j+2)$\u8fd9\u4e09\u4e2a\u7403\u67d3\u6210\u60c5\u51b51\u7684\u8d21\u732e\uff0c\u524d\u534a\u6bb5\u7684\u8d21\u732e\u4e3a$g[j](j+1)^2$\uff08$j+1$\u662f\u56e0\u4e3a\u540e\u9762\u8fd8\u6709$\\frac 2 3$\u7684\u60c5\u51b51\u4e2d\u540a\u77401\u4e2a\u7403\uff0c\u5373\u7b2cj\u4e2a\u7403\uff0c\u6240\u4ee5\u8981+1\uff0c\uff09\uff0c\u540e\u534a\u6bb5\u7684\u8d21\u732e\u4e3a$f_1[i-j-3]$\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u540e\u534a\u6bb5\u800c\u8a00\uff0c\u5b83\u7684\u5f00\u59cb\u662f$\\frac 2 3$\u7684\u60c5\u51b51\uff0c\u6240\u4ee5\u8981\u8f6c\u5316\u6210$f_1$\u800c\u4e0d\u518d\u662f$f_0$\u3002\n\n- $f_1$\u5f0f\uff08\u8fd9\u91cc\u7b97\u9996\u7aef\u4e3a\u60c5\u51b51\uff0c\u56e0\u4e3a\u662f\u5bf9\u79f0\u7684\uff0c\u8d21\u732e\u4e00\u6837\uff0c\u53d6\u9996\u7aef\u4e3a\u60c5\u51b51\u6765\u89e3\u91ca$dp$\u5f0f\u5b50\uff09\uff1a\n\n$f_1$\u4e2d\u7684\u7b2c\u4e00\u9879\u5c31\u4e0d\u518d\u89e3\u91ca\u4e86\uff0c+1\u7684\u539f\u56e0\u4e5f\u540c\u4e0a\uff08\u597d\u5427\u7a0d\u5fae\u6709\u70b9\u4e0d\u540c\uff0c+1\u7684\u7403\u4ece\u672b\u5c3e\u53d8\u6210\u4e86\u5f00\u5934\u7f62\u4e86\uff09\uff1b\n \u7b2c\u4e00\u4e2a$\\sum$ \u4ea6\u662f\u5728\u8ba1\u7b97\u5c06$j+1$\u67d3\u6210\u60c5\u51b54\u7684\u8d21\u732e\uff0c\u524d\u534a\u6bb5\u7684\u8d21\u732e\u4e3a$g[j](j+1)^2$\uff0c\uff08+1\u7684\u539f\u56e0\u540c\u4e0a\uff09\uff0c\u540e\u534a\u6bb5\u7684\u8d21\u732e\u4e3a$f_0[i-j-1]$;\n\n\u7b2c\u4e8c\u4e2a$\\sum$ \u8ba1\u7b97\u5c06$(j,j+1,j+2)$\u4e09\u4e2a\u7403\u67d3\u6210\u60c5\u51b51\u7684\u8d21\u732e\uff0c\u524d\u534a\u6bb5\u7684\u8d21\u732e\u4e3a$g[j](j+2)^2$\uff08\u9996\u5c3e\u4e24\u7aef\u90fd\u662f\u60c5\u51b51\uff0c\u90fd\u540a\u4e86\u4e00\u4e2a\u7403(\u7b2c1\u4e2a\u7403\u548c\u7b2cj\u4e2a\u7403)\uff0c\u6240\u4ee5\u8981+2\uff09\uff0c\u540e\u534a\u6bb5\u7684\u8d21\u732e\u4e3a$f_1[i-j-3]$\uff08\u524d1\u540e4\uff09\n\n- $f_2$ \u5f0f\u4e0d\u518d\u8d58\u8ff0\uff0c\u539f\u7406\u76f8\u540c\u3002\n\n\u7136\u800c\u6211\u4eec\u4e0a\u9762\u8003\u8651\u4ec5\u662f\u5728\u5e8f\u5217\u4e0a\u7684\u60c5\u51b5\uff0c\u800c\u6211\u4eec\u8981\u5904\u7406\u7684\u662f\u4e00\u4e2a\u73af\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u4ee4\u7b2c1\u4e2a\u7403\u548c\u7b2cn+1\u4e2a\u7403\u7684\u989c\u8272\u76f8\u540c\uff08\u56e0\u4e3a\u4e00\u5b9a\u8981\u6709\u4e00\u7ec4\u76f8\u5bf9\u7684\u7403\u989c\u8272\u76f8\u540c\uff0c\u5426\u5219\u4e0d\u4ea7\u751f\u8d21\u732e\uff09\n\n\u8003\u8651\u6211\u4eec\u5904\u7406\u6362\u4e0a\u7684\u95ee\u9898\u65f6\u5e38\u7528\u7684\u65b9\u6cd5\u2014\u2014\u679a\u4e3e\u504f\u8f6c\u89d2\u5ea6\n\n\u679a\u4e3e\u8fd9\u4e2a\u73af\u5728\u4f4d\u7f6ei\u4e0a\u53c8\u6709\u4e00\u7ec4\u76f8\u5bf9\u7684\u7403\u989c\u8272\u76f8\u540c\uff08\u5373i\u548cn+i\u7684\u989c\u8272\u76f8\u540c\uff09\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8ba9\u5706\u73af\u504f\u8f6ci\u6b21\uff08\u5982\u679c\u504f\u8f6c\u8d85\u8fc7i\u6b21\u5c31\u4f1a\u4e0e\u201c\u7b2c\u4e8c\u7ec4\u76f8\u5bf9\u800c\u540c\u8272\u7684\u7403\u7684\u4f4d\u7f6e\u5c0f\u4e8ei\u201d\u7684\u60c5\u51b5\u4ea7\u751f\u91cd\u590d\uff09\u3002\n\n\u6211\u4eec\u6709\uff1a\n\n$\\begin{aligned}Ans=\\sum_{i=2}^{n-2}i(i-1)^2(g[i-1]f_0[n-i-1]+2g[i-2]f_1[n-i-2]+g[i-3]f_2[n-i-3])\\end{aligned}$\n\n\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\u5f0f\u5b50\uff1a\n\n- \u7b2c\u4e00\u4e2ai\uff0c\u662f\u4e58\u4e0a\u4e86\u504f\u8f6c\u6b21\u6570\uff0c$(i-1)^2$\u5373\u662f\u524d\u534a\u6bb5\u7684\u8d21\u732e\uff08\u603b\u5171\u6709i-1\u4e2a\u7403\uff09\n\n- \u62ec\u53f7\u4e2d\u7684\u7b2c\u4e00\u9879\u662f\u6307\u7b2c\u4e00\u7b2c\u4e8c\u5bf9\u76f8\u5bf9\u800c\u540c\u8272\u7684\u7403\uff0c\u90fd\u662f\u60c5\u51b54\u7684\u8d21\u732e\n\n- \u7b2c\u4e8c\u9879\u662f\u6307\u7b2c\u4e00\u7b2c\u4e8c\u5bf9\u76f8\u5bf9\u800c\u540c\u8272\u7684\u7403\u4e2d\uff0c\u6709\u4e00\u5bf9\u662f$\\frac 2 3$\u7684\u60c5\u51b51\uff0c\u53e6\u4e00\u4e2a\u662f\u60c5\u51b54\u7684\u8d21\u732e\uff0c\u56e0\u4e3a\u6709\"1:1,2:4\"\u548c\"1:4,2:1\"\uff08\u5982\u679c\u524d\u9762\u90fd\u8ba4\u771f\u770b\u4e0b\u6765\u7684\u8bdd\uff0c\u8fd9\u4e48\u5199\u5e94\u8be5\u770b\u5f97\u61c2\u5427......\u61d2\u5f97\u518d\u7528\u5197\u957f\u7684\u6587\u5b57\u89e3\u91ca\u4e86\uff09\u4e24\u79cd\u60c5\u51b5\uff0c\u6240\u4ee5\u8981\u4e582\n\n- \u7b2c\u4e09\u9879\u662f\u6307\u7b2c\u4e00\u7b2c\u4e8c\u5bf9\u76f8\u5bf9\u800c\u540c\u8272\u7684\u6c42\u4e2d\uff0c\u90fd\u662f$\\frac 2 3$\u7684\u60c5\u51b51\u7684\u8d21\u732e\n\n$dp$\u5b8c\u6210\u55bd\uff01\n\n\u76f4\u63a5$dp$\u6c42$f_0,f_1,f_2$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f$\\Theta(n^2)$\u7684\u3002\n\n## \u751f\u6210\u51fd\u6570\u8868\u793a\u8f6c\u79fb\n\n\u5f88\u5bb9\u6613\u770b\u51fa\u524d\u9762\u6c42$f_0,f_1,f_2$\u65f6\u7684\u5f0f\u5b50\u53ef\u4ee5\u5199\u6210\u5377\u79ef\u5f62\u5f0f\n\n\u5148\u628a\u51e0\u4e2adp\u6570\u7ec4\u5199\u6210\u751f\u6210\u51fd\u6570\u5f62\u5f0f\uff1a\n\n$\\begin{aligned}\nG_0(x)&=\\sum_{i=0}^\\infty g[i]i^2x^i\\\\\nG_1(x)&=\\sum_{i=0}^\\infty g[i](i+1)^2x^i\\\\\nG_2(x)&=\\sum_{i=0}^\\infty g[i](i+2)^2x^i\\\\\nF_0(x)&=\\sum_{i=0}^\\infty f_0[i]x^i\\\\\nF_1(x)&=\\sum_{i=0}^\\infty f_1[i]x^i\\\\\nF_2(x)&=\\sum_{i=0}^\\infty f_2[i]x^i\n\\end{aligned}$\n\n\u6539\u5199\u521a\u521a\u7684$dp$\u5f0f\uff1a\n\n$\\begin{aligned}\nF_0(x)&=G_0(x)+G_0(x)F_0(x)x+G_1(x)F_1(x)x^3\\\\\nF_1(x)&=G_1(x)+G_1(x)F_0(x)x+G_2(x)F_1(x)x^3\\\\\nF_2(x)&=G_2(x)+G_1(x)F_1(x)x+G_2(x)F_2(x)x^3\n\\end{aligned}$\n\n$G_0,G_1,G_2$\u662f\u6211\u4eec\u80fd\u591f$\\Theta(n)$\u6c42\u51fa\u6765\u7684\n\n\u800c$F_0,F_1$\u7684\u4e24\u4e2a\u5f0f\u5b50\uff0c\u53ef\u4ee5\u6784\u6210\u4e00\u4e2a\u4e8c\u5143\u4e00\u6b21\u65b9\u7a0b\u7ec4\uff08\u628a$G$\u548c$x$\u5f53\u4f5c\u5e38\u6570\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528$G,x$\u6765\u8868\u793a\u51fa$F_0,F_1$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5728$\\Theta(n\\log n)$\u7684\u65f6\u95f4\u5185\u6c42\u51fa$F_0,F_1$\n\n\u800c$F_2$\u53c8\u53ef\u4ee5\u7528$F_1$\u6765\u8868\u793a\uff0c$F_1$\u53c8\u662f\u5df2\u77e5\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4fbf\u80fd$\\Theta(n\\log n)$\u6c42\u51fa$F_2$\n\n\u6700\u540e$\\Theta(n)$\u6c42\u51fa$Ans$\n\n\u7136\u540e\u5c31\u53ea\u5269\u4e0b\u6c42\u89e3\u90a3\u4e2a\u4e00\u5143\u4e8c\u6b21\u65b9\u7a0b\u4e86(dirty works ~)\n\n\u6c42\u89e3\u8fc7\u7a0b\uff1a\n\n$\\begin{aligned}\nF_0(x)&=G_0(x)+G_0(x)F_0(x)x+G_1(x)F_1(x)x^3\\\\\n(1-G_0(x)x)F_0(x)&=G_0(x)+G_1(x)F_1(x)x^3\\\\\nF_0(x)&=\\frac{G_0(x)+G_1(x)F_1(x)x^3}{1-G_0(x)x}\n\\end{aligned}$\n\n- \u5c06\u5176\u4ee3\u5165$F_1$\u5f0f\uff1a\n\n$\\begin{aligned}\nF_1(x)&=G_1(x)+G_1(x)F_0(x)x+G_2(x)F_1(x)x^3\\\\\nF_1(x)&=G_1(x)+G_1(x)x\\frac{G_0(x)+G_1(x)F_1(x)x^3}{1-G_0(x)x}+G_2(x)F_1(x)x^3\\\\\n(1-\\frac{G_1^2(x)x}{1-G_0(x)x}-G_2(x)x^3)F_1(x)&=G_1(x)+\\frac{G_0(x)G_1(x)}{1-G_0(x)x}\\\\\nF_1(x)&=\\frac{G_1(x)+G_0(x)G_1(x)x-G_0(x)G_1(x)x}{1-G_0(x)-G_1(x)x^4-G_2(x)x^3+G_(x)G_2(x)x^4}\\\\\nF_1(x)&=\\frac{G_1(x)}{(G_0(x)x-1)(G_2(x)x^3-1)-G_1^2(x)x^4}\n\\end{aligned}$\n\n- \u5c06$F_1$\u4ee3\u5165$F_0$\u5f0f\uff1a\n\n$\\begin{aligned}\nF_0(x)&=\\frac{G_0(x)+G_1(x)F_1(x)x^3}{1-G_0(x)x}\\\\\nF_0(x)&=\\frac{G_0(x)[(G_0(x)x-1)(G_2(x)x^3-1)-G_1^2(x)x^4]+G1^2(x)x^3}{(1-G_0(x)x)[(G_0(x)x-1)(G_2(x)x^3-1)-G_1^2(x)x^4]}\\\\\nF_0(x)&=\\frac{-G_0(x)(G_2(x)x^3-1)+G_1^2(x)x^3}{(G_0(x)x-1)(G_2(x)x^3-1)-G_1^2(x)x^4}\n\\end{aligned}$\n\n- \u91cd\u5199$F_2$\u5f0f\uff1a\n\n$\\begin{aligned}\nF_2(x)&=G_2(x)+G_1(x)F_1(x)x+G_2(x)F_2(x)x^3\\\\\n(1-G_2(x)x^3)F_2(x)&=G_2(x)+G_1(x)F_1(x)x\\\\\nF_2(x)&=\\frac{G_2(x)+G_1(x)F_1(x)x}{1-G_2(x)x^3}\n\\end{aligned}$\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u6210\u529f\u5f97\u505a\u5230\u4e86$\\Theta(n\\log n)$\u6c42\u89e3\u95ee\u9898\n\n------------\n\n\n\u8fd9\u9898\u5176\u5b9e\u8fd8\u6709\u66f4\u795e\u4ed9\u7684\u505a\u6cd5\uff0c\u80fd\u591f\u505a\u5230$\\Theta(n)$\u6c42\u89e3\uff08\u751a\u81f3\u66f4\u5feb\uff1f\uff09\n\n\u4f46\u662f\uff0c\u6211\u7d2f\u4e86...\u5c31\u8fd9\u6837\u5427\n\n\u672c\u9898\u5f0f\u5b50\u5f88\u591a\u3001\u5f88\u6076\u5fc3\uff0c\u96be\u514d\u4f1a\u6709\u6211\u63a8\u9519\u7684\u5730\u65b9\uff0c\u5927\u5bb6\u76f4\u63a5\u5728\u8bc4\u8bba\u533a\u6307\u6b63\u5c31\u597d\uff0c\u4e5f\u4e0d\u7528\u79c1\u4fe1\u6211\u8ba9\u6211\u6539\u4e86\uff0c\u56e0\u4e3a...\u5927\u6982\u8fd9\u6b21$NOIP$\uff08\u660e\u5929\uff1f\uff09\u4e4b\u540e\u6211\u5c31\u9000\u5f79\u4e86\u5427\uff0c\u4e5f\u4e0d\u4f1a\u518d\u770b\u79c1\u4fe1\u4e86\n\n\u81f3\u6b64\u2014\u2014...\n\n# $Code$\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nconst int N=2e5+10,mod=998244353;\nint a[N],b[N],c[N],d[N],f0[N],f1[N],f2[N],G[N],g[5][N],rev[N],n,L,ans;\nusing namespace std;\nint power(int a,ll b){\n\tint res=1,c=a;\n\twhile (b){\n\t\tif (b&1) res=1ll*res*c%mod;\n\t\tb>>=1,c=1ll*c*c%mod;\n\t}\n\treturn res;\n}\nvoid Get(int n,int opt=1){\n\tL=opt?1:n;\n\twhile (L<n) L<<=1;\n\tfor (int i=0;i<L;i++) rev[i]=rev[i>>1]>>1|(i&1?L>>1:0);\n}\nvoid fft(int *a,int opt){\n\tfor (int i=0;i<L;i++) if (rev[i]>i) swap(a[rev[i]],a[i]);\n\tfor (int l=2;l<=L;l<<=1){\n\t\tint W=opt==1?power(3,(mod-1)/l):power(power(3,(mod-1)/l),mod-2);\n\t\tfor (int i=0;i<L;i+=l)\n\t\t\tfor (int j=0,w=1;j<l>>1;j++,w=1ll*w*W%mod){\n\t\t\t\tint x=a[i+j],y=1ll*a[i+j+l/2]*w%mod;\n\t\t\t\ta[i+j]=(x+y)%mod,a[i+j+l/2]=(x-y)%mod;\n\t\t\t}\n\t}\n\tfor (int i=0,v=power(L,mod-2);i<L;i++) if (opt==-1) a[i]=1ll*a[i]*v%mod;\n}\nvoid Inv(int *f,int *g,int n){\n\tint c[N];\n\tf[0]=power(g[0],mod-2);\n\tmemset(c,0,sizeof(c));\n\tfor (int l=2;l<n<<1;l<<=1){\n\t\tGet(l<<1,0);\n\t\tfor (int i=0;i<l;i++) c[i]=g[i];\n\t\tfor (int i=l;i<L;i++) c[i]=0;\n\t\tfft(c,1),fft(f,1);\n\t\tfor (int i=0;i<L;i++) f[i]=(2-1ll*c[i]*f[i]%mod)*f[i]%mod;\n\t\tfft(f,-1);\n\t\tfor (int i=l;i<L;i++) f[i]=0;\n\t}\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tG[0]=G[2]=1;\n\tfor (int i=4;i<=n;i+=2)\n\t\tG[i]=(G[i-2]+G[i-4])%mod,g[0][i]=1ll*G[i]*i%mod*i%mod,g[1][i]=1ll*G[i]*(i+1)%mod*(i+1)%mod,g[2][i]=1ll*G[i]*(i+2)%mod*(i+2)%mod;\n\tg[1][0]=1,g[2][0]=4,g[0][2]=4,g[1][2]=9,g[2][2]=16;\n\tGet((n+1)<<1);\n\tfor (int i=0;i<=n;i++)\n\t\ta[i]=i<1?0:g[0][i-1],b[i]=i<3?0:g[2][i-3],c[i]=g[0][i],d[i]=g[1][i],f1[i]=g[1][i];\n\ta[0]--,b[0]--;\n\tfft(a,1),fft(b,1),fft(c,1),fft(d,1);\n\tfor (int i=0;i<L;i++) a[i]=1ll*a[i]*b[i]%mod,b[i]=1ll*c[i]*b[i]%mod,d[i]=1ll*d[i]*d[i]%mod;\n\tfft(a,-1),fft(b,-1),fft(d,-1);\n\tfor (int i=n+1;i<L;i++) a[i]=0,b[i]=0,d[i]=0;\n\tfor (int i=0;i<L;i++) c[i]=(a[i]-(i<4?0:d[i-4]))%mod,f0[i]=((i<3?0:d[i-3])-b[i])%mod;\n\tfor (int i=n+1;i<L;i++) c[i]=0;\n\tmemset(d,0,sizeof(d));\n\tInv(d,c,n+1);\n\tGet((n+1)<<1);\n\tfft(d,1),fft(f0,1),fft(f1,1);\n\tfor (int i=0;i<L;i++) f0[i]=1ll*f0[i]*d[i]%mod,f1[i]=1ll*f1[i]*d[i]%mod;\n\tfft(f0,-1),fft(f1,-1);\n\tfor (int i=n+1;i<L;i++) f0[i]=f1[i]=0;\n\tfor (int i=0;i<L;i++) b[i]=g[1][i],c[i]=i<3?0:-g[2][i-3],d[i]=f1[i];\n\tc[0]++;\n\tfft(b,1),fft(d,1);\n\tfor (int i=0;i<L;i++) a[i]=1ll*b[i]*d[i]%mod;\n\tfft(a,-1);\n\tfor (int i=n+1;i<L;i++) a[i]=0;\n\tfor (int i=0;i<=n;i++) f2[i]=(g[2][i]+(i<1?0:a[i-1]))%mod;\n\tmemset(a,0,sizeof(a));\n\tmemset(a,0,sizeof(a));\n\tInv(a,c,n+1);\n\tGet((n+1)<<1);\n\tfft(f2,1),fft(a,1);\n\tfor (int i=0;i<L;i++) f2[i]=1ll*f2[i]*a[i]%mod;\n\tfft(f2,-1);\n\tfor (int i=n+1;i<L;i++) f2[i]=0;\n\tans=1ll*(G[n-1]+G[n-3])*(n-1)%mod*(n-1)%mod*n%mod;\n\tfor (int i=2;i<=n-2;i++)\n\t\tans=(ans+1ll*i*(i-1)%mod*(i-1)%mod*((1ll*G[i-1]*f0[n-i-1]%mod+(i<3||i>n-3?0:1ll*G[i-3]*f2[n-i-3]%mod))%mod+2ll*G[i-2]*f1[n-i-2]%mod)%mod)%mod;\n\tprintf(\"%d\\n\",(ans+mod)%mod);\n\treturn 0;\n}\n//\u6076\u5fc3\u4eba\u7684\u4e1c\u897f\uff0c\u722c\uff01\n```\n",
        "postTime": 1607051122,
        "uid": 111449,
        "name": "AFO_WR_Eternity",
        "ccfLevel": 0,
        "title": "[\u751f\u6210\u51fd\u6570] CF848E Days of Floral Colours"
    }
]