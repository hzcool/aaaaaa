[
    {
        "content": "\u5199\u5b8c\u4e86\u8fd9\u9053\u975e\u5e38\u5de7\u5999\u7684\u9898\u76ee\uff0c\u770b\u5230\u6ca1\u6709\u9898\u89e3\u6211\u6765\u5199\u4e00\u53d1\u3002\u3002\u3002\n\n\u9996\u5148\u6211\u4eec\u6ce8\u610f\u5230 $n$ \u662f\u5f88\u5927\u7684\uff0c\u76f4\u63a5\u505a\u80cc\u5305\u80af\u5b9a\u590d\u6742\u5ea6\u8981\u7206\u3002\n\n\u4e8e\u662f\u6211\u60f3\u5230\u4ee5\u524d\u5f88\u591a\u5927\u4f6c\u8bf4\u8fc7\u7684\u4e00\u53e5\u8bdd\uff1aDp\u6ca1\u6709\u51fa\u8def\uff0c\u8003\u8651\u751f\u6210\u51fd\u6570\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u8003\u8651\u4e00\u4e0b\u751f\u6210\u51fd\u6570\u3002\n\n$F(x)$ \u7684\u751f\u6210\u51fd\u6570\u5c31\u662f $(\\sum x^{f_i})^n$\u3002\n\n$G(x)$ \u7684\u751f\u6210\u51fd\u6570\u662f $(\\sum x^{g_i})^ {\\infty} $\u3002\n\n\u4f46\u6211\u4eec\u6362\u4e2a\u89d2\u5ea6\u770b $G(x)$ , \u8003\u8651\u5199\u51fa $G(x)$ \u7684\u9012\u63a8\u5f0f\uff08\u4e0d\u8981\u544a\u8bc9\u6211\u60a8\u4e0d\u4f1a\u5b8c\u5168\u80cc\u5305\uff09\u3002\n\n\u56e0\u4e3a $g_i$ \u6700\u5927\u503c\u53ea\u6709 $250$ \uff0c\u6211\u4eec\u6362\u4e2a\u65b9\u6cd5\u8868\u793a\uff0c\u4ee4 $t_i=\\sum g_j=i$\uff0c\u4e5f\u5c31\u662f\u5bf9\u6bcf\u4e2a $i$ \u6c42\u6709\u591a\u5c11\u4e2a $g$ \u7b49\u4e8e\u5b83\u3002\n\n\u8fd9\u6837\u9012\u63a8\u5f0f\u5c31\u662f\uff1a$F_i=\\sum F_{i-j} \\times t_j $ \u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u662f\u4e0d\u662f\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u5440\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa $C(x)$ \u4f7f\u5f97 $G(x) \\bmod C(x)$ \u4e0e $G(x)$ \u662f\u4e00\u6837\u7684\u3002\n\n\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f88\u5feb\u7684\u6c42\u51fa $F(x) \\bmod C(x)$ \uff0c\u628a\u8fd9\u4e24\u4e2a\u5bf9\u5e94\u9879\u4e58\u8d77\u6765\u518d\u76f8\u52a0\u5c31\u662f\u7b54\u6848\u3002\n\n\u5177\u4f53\u6c42 $F(x)$ \u5148\u5bf9\u4e8e\u6bcf\u4e2a $x^{f_i}$ \u6c42\u5176 $\\bmod C(x)$ \u52a0\u8d77\u6765\u518d $n$ \u6b21\u65b9\u3002\n\n\u518d\u5177\u4f53\u5c31\u770b\u4ee3\u7801\u5427\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define N 505\n#define ll long long\nusing namespace std;\nconst int mod=1e9+7;\nint F,B,a[N],c[N],r[N];\nint ans[N],tmp[N],t[N];\nint A[N],Ans[N],mx,p[N];\nll NN;\nint Mod(int x) {\n\treturn (x<mod)?x:x-mod;\n}\nvoid Add(int &x,int y) {\n\tx=Mod(x+y);\n}\nvoid Mul(int *f,int *g,int *ans) {\n\tfor(int i=0; i<2*mx; ++i)r[i]=0;\n\tfor(int i=0; i<mx; ++i)for(int j=0; j<mx; ++j)Add(r[i+j],1ll*f[i]*g[j]%mod);\n\tfor(int i=2*mx-2; i>=mx; --i)for(int j=mx-1; ~j; --j)Add(r[i+j-mx],mod-1ll*r[i]*c[j]%mod);\n\tfor(int i=0; i<mx; ++i)ans[i]=r[i];\n}\nsigned main() {\n\tcin>>F>>B>>NN;\n\tfor(int i=1; i<=F; ++i)cin>>a[i];\n\tfor(int i=1,x; i<=B; ++i)cin>>x,mx=max(mx,x),++t[x];\n\tfor(int i=0; i<mx; ++i)c[i]=mod-t[mx-i];\n\tc[mx]=1;\n\tfor(int i=1; i<=F; ++i) {\n\t\tfor(int j=0; j<mx; ++j)ans[j]=tmp[j]=0;\n\t\t(mx>1)?(tmp[1]=1):(tmp[0]=mod-c[0]);\n\t\tfor(ans[0]=1; a[i]; a[i]>>=1,Mul(tmp,tmp,tmp))if(a[i]&1)Mul(ans,tmp,ans);\n\t\tfor(int j=0; j<mx; ++j)Add(A[j],ans[j]);\n\t}\n\tfor(Ans[0]=p[0]=1; NN; NN>>=1,Mul(A,A,A))if(NN&1)Mul(Ans,A,Ans);\n\tfor(int i=0; i<mx; ++i)for(int j=0; j<=i; ++j)Add(p[i],1ll*t[j]*p[i-j]%mod);\n\tint answer=0;\n\tfor(int i=0; i<mx; ++i)Add(answer,1ll*Ans[i]*p[i]%mod);\n\tcout<<answer;\n\treturn 0;\n}\n```\n",
        "postTime": 1613808624,
        "uid": 112569,
        "name": "Time_tears",
        "ccfLevel": 9,
        "title": "CF865G Flowers and Chocolate"
    },
    {
        "content": "\u8003\u8651\u5199\u51fa\u82b1\u548c\u5de7\u514b\u529b\u7684\u751f\u6210\u51fd\u6570\uff1a\n$$\nF(x)=(\\sum x^{p_i})^n=\\sum\\limits_{i=0}^{\\infin} F_ix^i\\\\\nG(x)=\\sum\\limits_{j=0}^{\\infin}(\\sum x^{c_i})^j=\\sum\\limits_{i=0}^{\\infin}G_ix^i\n$$\n\u6211\u4eec\u6c42\u7684\u5c31\u662f $\\sum\\limits_{i=0}^{\\infin}F_iG_i$\u3002\n\n$G$ \u5176\u5b9e\u662f\u5b8c\u5168\u80cc\u5305\uff0c\u7531\u4e8e $c_i$ \u5f88\u5c0f\uff0c\u8003\u8651\u5199\u6210\u9012\u63a8\u5f0f\u3002\n$$\nG_n=\\sum\\limits_{i=1}^mG_{n-i}k_i\n$$\n\u5176\u4e2d $k_i=\\sum_j[c_j=i]$\u3002\n\n\u6839\u636e\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u7684\u7ed3\u8bba\uff0c\u6709\n$$\nP(x)=x^m-\\sum\\limits_{i=0}^{m}k_{m-i}x^i\\\\\nG_i=[x^{m-1}](x^{m+i-1}\\bmod P(x))\n$$\n\u53c8\u6709\n$$\nF_i=[x^i](\\sum_j x^{p_j})^n=[x^{m+i-1}](x^{m-1}(\\sum_j x^{p_j})^n)\n$$\n\u4e8e\u662f\u7b54\u6848\u4e3a \n$$\n[x^{m-1}](x^{m-1}(\\sum_j x^{p_j})^n\\bmod P(x))\n$$\n\n```cpp\n#include<cstdio>\n#include<algorithm>\nint const mod=1e9+7;\nint an,bn,a[20],b[510],m;\nvoid mul(int const *a,int const *b,int *ans){\n\tstatic int c[510];\n\tfor(int i=0;i<=2*m-2;i++) c[i]=0;\n\tfor(int i=0;i<m;i++)\n\t\tfor(int j=0;j<m;j++)\n\t\t\tc[i+j]=(c[i+j]+1ll*a[i]*b[j])%mod;\n\tfor(int i=2*m-2;i>=m;i--)\n\t\tfor(int j=0;j<=m;j++)\n\t\t\tc[i-(m-j)]=(c[i-(m-j)]-1ll*::b[j]*c[i]%mod+mod)%mod;\n\tfor(int i=0;i<m;i++) ans[i]=c[i];\n}\nlong long n;\nint main(){\n\tscanf(\"%d%d%lld\",&an,&bn,&n);\n\tfor(int i=1;i<=an;i++) scanf(\"%d\",a+i);\n\tfor(int i=1,x;i<=bn;i++) scanf(\"%d\",&x),++b[x],m=std::max(m,x);\n\tstd::reverse(b,b+m+1),b[m]=1;\n\tfor(int i=0;i<m;i++) b[i]=(mod-b[i])%mod;\n\tstatic int o[510],t[510];\n\tfor(int i=1;i<=an;i++){\n\t\tstatic int k[510],res[510];\n\t\tfor(int i=0;i<m;i++) res[i]=k[i]=0;\n\t\tif(m!=1) k[1]=1;\n\t\telse k[0]=mod-b[0];\n\t\tres[0]=1;\n\t\twhile(a[i]){\n\t\t\tif(a[i]&1) mul(res,k,res);\n\t\t\ta[i]>>=1,mul(k,k,k);\n\t\t}\n\t\tfor(int i=0;i<m;i++) o[i]=(o[i]+res[i])%mod;\n\t}\n\tt[0]=1;\n\twhile(n){\n\t\tif(n&1) mul(t,o,t);\n\t\tn>>=1,mul(o,o,o);\n\t}\n\tfor(int i=0;i<m;i++) o[i]=0;\n\to[m-1]=1;\n\tmul(t,o,t);\n\tprintf(\"%d\\n\",t[m-1]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1630331987,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "CF865G Flowers and Chocolate"
    },
    {
        "content": "\u5199\u51fa\u9009\u82b1\u7684\u65b9\u6848\u6570\u5173\u4e8e\u82b1\u74e3\u6570\u7684\u751f\u6210\u51fd\u6570\u548c\u9009\u5de7\u514b\u529b\u7684\u65b9\u6848\u6570\u5173\u4e8e\u5757\u6570\u7684\u751f\u6210\u51fd\u6570\uff1a\n$$P(x)=\\left(\\sum_{i=1}^Fx^{p_i}\\right)^N$$\n$$Q(x)=\\sum_{i=0}^\\infty\\left(\\sum_{j=1}^Bx^{c_j}\\right)^i=\\frac1{1-\\sum\\limits_{i=1}^Bx^{c_i}}$$\n\u7b54\u6848\u5373\u4e3a\uff1a\n$$\\sum_{i=0}^\\infty([x^i]P(x))([x^i]Q(x))$$\n\u8bbe $m$ \u4e3a $c$ \u7684\u6700\u5927\u503c\uff0c\u8003\u8651 $x^{m-1}Q(x)$ \u7684\u7cfb\u6570\uff0c\u5bf9\u4e8e $i\\ge m$ \u6709\uff1a\n$$[x^i]x^{m-1}Q(x)=\\sum_{j=1}^B[x^{i-c_j}]x^{m-1}Q(x)$$\n\u8fd9\u662f\u4e00\u4e2a\u957f\u5ea6\u4e3a $m$\uff0c\u4e14\u524d $m$ \u9879\u53ea\u6709\u4e00\u9879\u6709\u503c\u7684[\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8](https://www.luogu.com.cn/problem/P4723)\u3002\u4ee4\n$$R(x)=x^m-\\sum_{i=1}^Bx^{c_i}$$\n\u53ef\u4ee5\u5f97\u5230\uff1a\n$$[x^i]Q(x)=[x^{m+i-1}]x^{m-1}Q(x)=[x^{m-1}]x^{m+i-1}\\bmod R(x)$$\n\u90a3\u4e48\u7b54\u6848\u7b49\u4e8e\uff1a\n$$\\begin{aligned}&\\sum_{i=0}^\\infty([x^i]P(x))([x^{m-1}]x^{m+i-1}\\bmod R(x))\\\\=&\\sum_{i=0}^\\infty[x^{m-1}]([y^i]P(y))x^{m+i-1}\\bmod R(x)\\\\=&[x^{m-1}]\\left(\\sum_{i=0}^\\infty([y^i]P(y))x^{m+i-1}\\right)\\bmod R(x)\\\\=&[x^{m-1}]\\left(x^{m-1}\\sum_{i=0}^\\infty([y^i]P(y))x^i\\right)\\bmod R(x)\\\\=&[x^{m-1}]x^{m-1}P(x)\\bmod R(x)\\end{aligned}$$\n\u81f3\u6b64\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u5e42\u548c $n^2$ \u591a\u9879\u5f0f\u64cd\u4f5c\u89e3\u51b3\u95ee\u9898\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(B+Fm^2\\log N)$\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nusing ll=long long;\ninline ll read(){\n\tll x=0;\n\tbool f=0;\n\tchar c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-') f=1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst int maxf=10+5,m=250+5;\nint f,b,p[maxf];\nll n;\nconst ll mod=1e9+7;\nll ksm(ll a,ll b){\n\tll c=1;\n\twhile(b){\n\t\tif(b%2==1) c=c*a%mod;\n\t\ta=a*a%mod;\n\t\tb/=2;\n\t}\n\treturn c;\n}\nusing poly=vector<ll>;\npoly operator +(poly A,poly B){\n\tint m=B.size();\n\tA.resize(max((int)A.size(),m));\n\tfor(int i=0;i<m;i++) A[i]=(A[i]+B[i])%mod;\n\treturn A;\n}\npoly operator *(poly A,poly B){\n\tint n=A.size(),m=B.size();\n\tpoly C(n+m-1);\n\tfor(int i=0;i<n;i++)\n\t\tfor(int j=0;j<m;j++)\n\t\t\tC[i+j]=(C[i+j]+A[i]*B[j]%mod)%mod;\n\treturn C;\n}\npoly operator %(poly A,poly B){\n\tint n=A.size(),m=B.size();\n\tif(n<m) return A;\n\tll inv=ksm(B[m-1],mod-2);\n\tfor(int i=n-1;i>=m-1;i--) for(int j=0;j<m;j++)\n\t\tA[i-m+1+j]=(A[i-m+1+j]-A[i]*inv%mod*B[j]%mod+mod)%mod;\n\tA.resize(m-1);\n\treturn A;\n}\npoly ksm(poly A,ll b,poly P){\n\tpoly C={1};\n\twhile(b){\n\t\tif(b%2==1) C=C*A%P;\n\t\tA=A*A%P;\n\t\tb/=2;\n\t}\n\treturn C;\n}\nint main(){\n#ifdef LOCAL\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n#endif\n\tf=read();\n\tb=read();\n\tn=read();\n\tfor(int i=1;i<=f;i++) p[i]=read();\n\tpoly G(m+1);\n\tG[m]=1;\n\tfor(int i=1;i<=b;i++){\n\t\tint c=read();\n\t\tG[m-c]=(G[m-c]-1+mod)%mod;\n\t}\n\tpoly F;\n\tfor(int i=1;i<=f;i++) F=F+ksm({0,1},p[i],G);\n\tF=ksm(F,n,G);\n\tF.resize(F.size()+m-1);\n\tfor(int i=(int)F.size()-1;i>=m-1;i--) F[i]=F[i-m+1];\n\tfor(int i=0;i<m-1;i++) F[i]=0;\n\tprintf(\"%lld\\n\",(F%G)[m-1]);\n#ifdef LOCAL\n\tfprintf(stderr,\"%f\\n\",1.0*clock()/CLOCKS_PER_SEC);\n#endif\n\treturn 0;\n}\n```\n\u63a8\u5bfc\u8fc7\u7a0b\u53ef\u80fd\u5199\u5f97\u592a\u7ec6\u4e86\u4e00\u70b9\uff0c\u4f46\u662f\u6211\u81ea\u5df1\u771f\u7684\u8822\u5230\u4e0d\u5199\u8fd9\u4e48\u7ec6\u5c31\u7406\u89e3\u4e0d\u4e86\u2026\u2026",
        "postTime": 1675777731,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF865G Flowers and Chocolate"
    }
]