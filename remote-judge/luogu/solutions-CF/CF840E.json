[
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u9897 $n$ \u4e2a\u8282\u70b9\u7684\u6811,\u6bcf\u6b21\u67e5\u8be2 $u$ \u548c $v$,\u5176\u4e2d $u$ \u662f $v$ \u7684\u7956\u5148,\u95ee\u8def\u5f84\u4e0a\u6240\u6709\u8282\u70b9 $i$ \u7684 $\\max\\{val_i\\oplus dis(i,v)\\}$. \n\n# \u5206\u6790\n\n\u8003\u8651\u5bf9\u503c\u57df\u5206\u5757,\u6309\u6bcf $8$ \u4f4d\u4e3a\u4e00\u4e2a\u5757,\u7136\u540e\u518d\u5c06\u8def\u5f84\u5206\u6210\u6bcf $256$ \u4e2a\u8282\u70b9\u4e3a\u4e00\u6bb5,\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u6bb5\u7684 $dis$ \u7684\u4e8c\u8fdb\u5236\u4e2d\u7684\u524d $8$ \u4f4d\u662f\u76f8\u540c\u7684.\n\n\u6240\u4ee5\u8003\u8651\u9884\u5904\u7406\u6bcf\u4e2a\u8282\u70b9\u5411\u4e0a $256$ \u4e2a\u8282\u70b9\u5185\u7684\u7b54\u6848.$f_{now,i}$ \u8868\u793a $now$ \u70b9\u5411\u4e0a $256$ \u4e2a\u70b9 $j$ \u5185\u7684 $\\max\\{val_j\\oplus dis(now,j)\\oplus(i\\cdot256)\\}$.\u7b80\u5355\u6765\u8bf4 $f_{now,i}$ \u8868\u793a\u4ee5 $now$ \u4e3a\u5f00\u59cb\u7684\u5411\u4e0a $256$ \u4e2a\u8282\u70b9\u4e3a\u4e00\u5757\u65f6\u8fd9\u5757\u4e3a\u8fd9\u6b21\u67e5\u8be2\u4ece\u4e0b\u5f80\u4e0a\u6570\u7684\u7b2c $i$ \u5757\u65f6\u7684\u5f53\u524d\u5757\u5185\u7684\u6700\u5927\u503c.\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5982\u4f55\u8ba1\u7b97 $f$.\n\n\u5c06 $f_{now,i}$ \u4e5f\u5206\u6210\u4e24\u90e8\u5206\u8ba1\u7b97.(\u4e0b\u9762\u7684 $j$ \u8868\u793a $now$ \u5411\u4e0a\u7684 $256$ \u4e2a\u8282\u70b9)\n\n\u5bf9\u4e8e\u524d $8$ \u4f4d:\n\n$f_{now,i}$ \u7684\u8ba1\u7b97\u4e2d $i$ \u7684\u8d21\u732e\u4e3a $\\max\\{i\\oplus \\lfloor\\frac{val_{j}}{256}\\rfloor\\}\\cdot256$,\u90a3\u4e48\u5c31\u662f\u4e00\u4e2a\u4ece\u96c6\u5408\u4e2d\u627e\u5230\u5f02\u6216\u67d0\u6570\u7684\u6700\u5927\u503c,\u53ef\u4ee5\u7528 01trie \u8f7b\u677e\u89e3\u51b3.\n\n\u5bf9\u4e8e\u540e $8$ \u4f4d:\n\n\u8bbe $g_{now,\\lfloor\\frac{val_{j}}{256}\\rfloor}=\\max\\{(dis(now,j)\\oplus val_j)\\land255\\}$.\u5373 $g_{i,j}$ \u8868\u793a\u7b2c $i$ \u4e2a\u70b9\u5f00\u59cb\u5411\u4e0a $256$ \u70b9\u4e2d\u6743\u503c\u7684\u4e8c\u8fdb\u5236\u524d $8$ \u4f4d\u4e3a $j$ \u7684\u6743\u503c\u5f02\u6216\u8ddd\u79bb\u7684\u540e\u516b\u4f4d\u6700\u5927\u503c.\u65e2\u7136\u5df2\u7ecf\u77e5\u9053\u4e86\u524d $8$ \u4f4d\u7684\u6700\u5927\u503c\u662f $x\\cdot 256$,\u90a3\u4e48\u5bf9\u4e8e\u540e\u9762 $8$ \u4f4d\u7684\u8d21\u732e\u5c31\u662f $g_{now,x}$ \u4e86.\n\n\u4ee3\u7801\u975e\u5e38\u597d\u5199.",
        "postTime": 1596899216,
        "uid": 86625,
        "name": "Limit",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF840E \u3010In a Trap\u3011"
    },
    {
        "content": "\u8fd9\u9898\u7684\u505a\u6cd5\u975e\u5e38\u7684\u5999\u3002\n\n\u7531\u4e8e\u8fd9\u68f5\u6811\u7684\u70b9\u6570\u548c\u70b9\u6743\u90fd\u975e\u5e38\u7684\u5c0f\uff0c\u6211\u4eec\u8003\u8651\u5206\u5757\uff0c\u628a\u6bcf\u4e2a\u70b9\u5f80\u4e0a\u6570$256$\u4e2a\u70b9(\u5305\u62ec\u5b83\u81ea\u5df1)\u5206\u4e3a\u4e00\u5757\uff0c\u8fd9\u6837\u5f80\u4e0a\u8df3\u65f6\uff0c\u6bcf\u4e00\u5757\u7684\u540e\u516b\u4f4d\u4e0d\u4f1a\u4ea7\u751f\u5f71\u54cd\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u8003\u8651\u524d\u516b\u4f4d\u5373\u53ef\u3002\n\n\u6211\u4eec\u9884\u5904\u7406\u4e00\u4e2a$f[u][i]$\u8868\u793a$u$\u5411\u4e0a256\u4e2a\u70b9\u4e2d$a_j$^$dist(u,j)$^$(i<<8)$\u7684\u6700\u5927\u503c\u3002\u56e0\u4e3a\u6211\u4eec\u6bcf\u6b21\u5f80\u4e0a\u8df3\u7684\u65f6\u5019\uff0c\u90fd\u76f8\u5f53\u4e8e\u662f\u628a\u6bcf\u4e2a$dist$\u52a0\u4e0a\u4e86$256$\uff0c\u4e0e\u5904\u7406\u5b8c\u540e\u6211\u4eec\u6bcf\u6b21\u53ea\u9700\u8981\u6bcf\u6b21\u8df3\u7684\u65f6\u5019\u5c06\u7b54\u6848\u548c$f[x][i]$($i$\u8868\u793a$x$\u4e0e$v$\u76f8\u8ddd\u591a\u5c11\u4e2a\u5757)\u53d6$max$\u5373\u53ef\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define mxn 50010\nusing namespace std;\nconst int m=256;\nint n,Q,sl,fh,ans,rt_num,fa[mxn],dep[mxn],vis[mxn],lst[mxn],val[mxn],f[mxn][m],mx[mxn][m];\nint t,h[mxn];\nstruct Tre\n{\n\tint to,nxt;\n}e[mxn<<1];\nstruct Trie\n{\n\tint sn[2];\n}tre[1<<10];\nint rd()\n{\n\tsl=0;fh=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||'9'<ch) {if(ch=='-') fh=-1; ch=getchar();}\n\twhile('0'<=ch&&ch<='9') sl=sl*10+ch-'0',ch=getchar();\n\treturn sl*fh;\n}\nvoid add(int u,int v)\n{\n\te[++t]=(Tre){v,h[u]};h[u]=t;\n\te[++t]=(Tre){u,h[v]};h[v]=t;\n}\nvoid ins(int x)\n{\n\tint rt=0;\n\tfor(int i=7;~i;--i)\n\t{\n\t\tif(!tre[rt].sn[(x>>i)&1])\n\t\t{\n\t\t\ttre[rt].sn[(x>>i)&1]=++rt_num;\n\t\t\ttre[rt_num]=(Trie){{0,0}};\n\t\t}\n\t\trt=tre[rt].sn[(x>>i)&1];\n\t}\n}\nint query(int x,int u)\n{\n\tint d,v=0,rt=0,ret=0;\n\tfor(int i=7;~i;--i)\n\t{\n\t\td=((x>>i)&1)^1;\n\t\tif(tre[rt].sn[d]) rt=tre[rt].sn[d],ret|=1<<i;\n\t\telse rt=tre[rt].sn[d^=1];\n\t\tv|=d<<i;\n\t}\n\treturn ret<<8|mx[u][v];\n}\nvoid upd(int &x,int y) {if(y>x) x=y;}\nvoid dfs(int u)\n{\n\tint v,i;\n\tif(dep[u]>=m)\n\t{\n\t\trt_num=0;tre[0]=(Trie){{0,0}};\n\t\tfor(i=u;dep[u]-dep[i]<m;i=fa[i])\n\t\t{\n\t\t\tupd(mx[u][val[i]>>8],(dep[u]-dep[i]^val[i])&255);\n\t\t\tif(vis[val[i]>>8]!=u) ins(val[i]>>8),vis[val[i]>>8]=u;\n\t\t}\n\t\tlst[u]=i;\n\t\tfor(i=0;i<m;++i) f[u][i]=query(i,u);\n\t}\n\tfor(i=h[u];i;i=e[i].nxt)\n\t\tif((v=e[i].to)!=fa[u])\n\t\t{\n\t\t\tfa[v]=u;dep[v]=dep[u]+1;\n\t\t\tdfs(v);\n\t\t}\n}\nint main()\n{\n\tn=rd();Q=rd();int x,y,dis;\n\tfor(int i=1;i<=n;++i) val[i]=rd();\n\tfor(int i=1;i<n;++i) x=rd(),y=rd(),add(x,y);\n\tdep[1]=1;dfs(1);\n\twhile(Q--)\n\t{\n\t\tx=rd();y=rd();dis=ans=0;\n\t\tfor(;dep[y]-dep[x]>=m;y=lst[y],dis++) ans=max(ans,f[y][dis]);\n\t\tfor(dis<<=8;y!=fa[x];y=fa[y],dis++) ans=max(ans,val[y]^dis);\n\t\tprintf(\"%d\\n\",ans);\n\t}\n    return 0;\n}\n```",
        "postTime": 1549015408,
        "uid": 27677,
        "name": "day_dream",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF840E \u3010In a Trap\u3011"
    },
    {
        "content": "[Codeforces \u9898\u9762\u4f20\u9001\u95e8](https://codeforces.ml/contest/840/problem/E) & [\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF840E)\n\n\u4e00\u9053\u975e\u5e38\u7cbe\u5f69\uff0c\u540c\u65f6\u4e5f\u5f88\u7ecf\u5178\u7684\u9898\u76ee\u3002~~\u548c\u8fd9\u573a\u7684 C \u4e00\u6837\u7ecf\u5178~~\n\n~~\u9996\u5148\u770b\u5230\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u5148\u731c\u6b63\u89e3\u590d\u6742\u5ea6\uff1a$n$ \u7ea7\u522b\u5927\u4e8e $q$\uff0c\u6240\u4ee5\u5927\u6982\u662f $n\\sqrt{n}\\log n+q\\sqrt{n}$\uff0c\u4e8b\u5b9e\u7684\u786e\u5982\u6b64\u3002~~\n\n\u6309\u7167\u6700\u5e38\u89c4\u7684\u601d\u8def\uff0c\u770b\u5230\u6811\u4e0a\u8def\u5f84\u7edf\u8ba1\u7684\u95ee\u9898\u65e0\u975e\u4e24\u79cd\u53ef\u80fd\uff0c\u6811\u94fe\u5256\u5206\u3001\u500d\u589e\u8fd9\u4e00\u7c7b\u5728\u7ebf\u6570\u636e\u7ed3\u6784\u6216\u8005\u79bb\u7ebf\u4e0b\u6765\u4e00\u904d DFS\uff0c\u628a\u8be2\u95ee\u6302\u5728 $u$ \u6216 $v$ \u67d0\u4e00\u4e2a\u8282\u70b9\u4e0a\u7136\u540e\u6c42\u89e3\uff0c\u4f46\u4e0d\u7ba1\u4f60\u4f7f\u7528\u54ea\u4e00\u79cd\uff0c\u4ed4\u7ec6\u60f3\u60f3\u90fd\u4f1a\u53d1\u73b0\u9700\u8981\u6d89\u53ca\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff1a\u5bf9\u4e8e\u4e24\u4e2a\u5e8f\u5217 $a,b$\uff0c\u6211\u4eec\u8981\u652f\u6301\u5728\u5df2\u77e5 $a_i\\oplus b_i$ \u7684\u6700\u5c0f\u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u5feb\u901f\u5bf9\u7ed9\u5b9a\u7684 $x$ \u6c42\u51fa $(a_i+x)\\oplus b_i$ \u7684\u6700\u5c0f\u503c\u3002\u800c\u4f17\u6240\u5468\u77e5\u8fd9\u662f\u4e0d\u597d\u7ef4\u62a4\u7684\uff0c\u56e0\u6b64\u8003\u8651\u4e0d\u5e38\u89c4\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u5206\u5757\u3002\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4e8e $u\\to v$ \u8fd9\u6761\u94fe\u4e0a\u7684\u5143\u7d20\uff0c\u4ece\u4e0b\u5230\u4e0a\u6bcf $256$ \u4e2a\u5143\u7d20\u4e00\u5757\uff0c\u6700\u540e\u591a\u51fa\u6765\u7684\u90a3\u4e00\u90e8\u5206\u5143\u7d20 $(\\le 255)$ \u66b4\u529b\u7edf\u8ba1\u8d21\u732e\u5373\u53ef\uff0c\u590d\u6742\u5ea6\u663e\u7136\u4e0d\u4f1a\u51fa\u95ee\u9898\u3002\u56e0\u6b64\u63a5\u4e0b\u6765\u6211\u4eec\u7684\u4efb\u52a1\u5c31\u662f\u8003\u8651\u600e\u6837\u8ba1\u7b97\u6574\u5757\u7684\u8d21\u732e\uff0c\u6211\u4eec\u8fd9\u91cc\u5047\u8bbe\u7f16\u53f7\u4ece $0$ \u5f00\u59cb\uff0c\u7b2c $0$ \u5757\u8868\u793a $u$ \u5230 $u$ \u7684 $255$ \u7ea7\u7956\u5148\u8def\u5f84\u4e0a\u7684\u70b9\uff0c\u7b2c $1$ \u5757\u8868\u793a $u$ \u7684 $256$ \u7ea7\u7956\u5148\u5230 $511$ \u7ea7\u7956\u5148\u8def\u5f84\u4e0a\u7684\u70b9\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u90a3\u4e48\u5047\u8bbe\u7b2c $i$ \u5757\u4e2d\u8282\u70b9\u7684\u6743\u503c\u5206\u522b\u662f $b_0,b_1,\\cdots,b_{255}$\uff0c\u90a3\u4e48\u8fd9\u4e00\u6bb5\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $\\max\\limits_{j=0}^{255}b_j\\oplus(256i+j)$\uff0c\u6211\u4eec\u5047\u8bbe\u8fd9\u4e00\u5757\u4e2d\u7b2c $0$ \u4e2a\u8282\u70b9\uff08\u4e5f\u5c31\u662f $u$ \u7684 $256i$ \u7ea7\u7956\u5148\uff09\u4e3a $x$\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u8bbe $f_{x,i}=\\max\\limits_{j=0}^{255}a_{fa_{x,j}}\\oplus(256i+j)$\uff0c\u5176\u4e2d $fa_{x,j}$ \u8868\u793a $x$ \u7684 $j$ \u7ea7\u7956\u5148\uff0c\u90a3\u4e48\u663e\u7136\u8fd9\u4e00\u5757\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $f_{x,i}$\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u8981\u80fd\u9884\u5904\u7406\u51fa $f_{x,i}$ \u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u7b54\u6848\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u600e\u6837\u9884\u5904\u7406\u51fa $f_{x,i}$\u200b\uff0c\u5982\u679c\u6211\u4eec\u8bbe $b_i=\\lfloor\\dfrac{a_i}{256}\\rfloor,c_i=a_i\\ \\text{and}\\ 255$\u200b\uff0c\u90a3\u4e48\u5f0f\u5b50\u53ef\u4ee5\u5199\u4f5c $f_{x,i}=\\max\\limits_{j=0}^{255}(b_{fa_{x,j}}\\oplus i)\u00b7256+(c_{fa_{x,j}}\\oplus j)$\u200b\uff0c\u4e0d\u96be\u53d1\u73b0\u4e24\u90e8\u5206\u662f\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u8003\u8651\u8fd9\u6837\u8ba1\u7b97 $f_{x,i}$\u200b\uff1a\u5bf9\u4e8e\u6bcf\u4e2a $x$\u200b\uff0c\u8ba1\u7b97\u6240\u6709 $f_{x,i}$\u200b \u65f6\uff0c\u5148\u5c06\u5b83\u7684 $0\\sim 255$\u200b \u7ea7\u7956\u5148\u7684 $b$\u200b \u63d2\u5165 trie \u4e2d\uff0c\u8fd9\u6837\u5bf9\u4e8e\u6240\u6709 $i$\u200b \u5728 trie \u6811\u4e0a\u67e5\u8be2\u4e00\u4e0b\u5373\u53ef\u77e5\u9053 $b_{fa_{x,j}}\\oplus i$\u200b \u7684\u6700\u5927\u503c\uff0c\u800c\u540e\u9762\u90a3\u90e8\u5206\u4e0e $i$\u200b \u65e0\u5173\uff0c\u6211\u4eec\u5047\u8bbe $b_{fa_{x,j}}\\oplus i$\u200b \u53d6\u5230\u6700\u5927\u503c\u65f6\uff0c$b_{fa_{x,j}}=v$\u200b\uff0c\u90a3\u4e48\u540e\u9762\u90a3\u90e8\u5206\u7684\u6700\u5927\u503c\u5c31\u662f\uff0c\u6240\u6709 $b_{fa_{x,j}}=v$\u200b \u7684 $j$\u200b \u4e2d $(c_{fa_{x,j}}\\oplus j)$\u200b \u7684\u6700\u5927\u503c\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u518d\u5f00\u4e00\u4e2a\u6876 $mxv_v$\u200b \u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\uff0c\u800c\u8fd9\u663e\u7136\u662f\u53ef\u4ee5\u5728\u679a\u4e3e $i$\u200b \u4e4b\u524d\u5b8c\u6210\u7684\uff0c\u56e0\u6b64\u679a\u4e3e $i$\u200b \u6c42\u51fa $b_{fa_{x,j}}\\oplus i$ \u4e4b\u540e\u5c31\u53ef\u4ee5 $\\mathcal O(1)$ \u5730\u6c42\u51fa\u540e\u9762\u90a3\u90e8\u5206\u7684\u6700\u5927\u503c\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u5728 $n\\sqrt{n}\\log n$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa $f_{x,i}$\n\n\u603b\u590d\u6742\u5ea6\u786e\u5b9e\u662f $n\\sqrt{n}\\log n+q\\sqrt{n}$\n\n~~\u6240\u4ee5\u8fd9\u5927\u6982\u4e5f\u7b97\u6811\u5206\u5757\u7684\u4e00\u4e2a\u5c0f\u5e94\u7528\u4e86\u5427\uff0c\u4e4b\u524d\u53ea\u5237\u4e86\u6811\u5206\u5757\u7684\u6a21\u677f\u9898\u5374\u4e0d\u77e5\u9053\u5b83\u7684\u5e94\u7528\u3002~~\n\n```cpp\nconst int MAXN=65536;\nconst int MAXP=2048;\nint n,qu,a[MAXN+5],hd[MAXN+5],to[MAXN*2+5],nxt[MAXN*2+5],ec=0;\nvoid adde(int u,int v){to[++ec]=v;nxt[ec]=hd[u];hd[u]=ec;}\nint dep[MAXN+5],fa[MAXN+5][10];\nvoid dfs0(int x,int f){\n\tfa[x][0]=f;\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f) continue;\n\t\tdep[y]=dep[x]+1;dfs0(y,x);\n\t}\n}\nint mx[MAXN+5][258],mxv[258];\nint ch[MAXP+5][2],ncnt=0,rt=0;\nvoid insert(int &k,int d,int v){\n\tif(!k) k=++ncnt;if(!~d) return;\n\tinsert(ch[k][v>>d&1],d-1,v);\n}\nint query(int k,int d,int v){\n\tif(!~d) return 0;\n\tif(ch[k][~v>>d&1]) return query(ch[k][~v>>d&1],d-1,v)|(1<<d);\n\telse return query(ch[k][v>>d&1],d-1,v);\n}\nvoid clear(){memset(ch,0,sizeof(ch));ncnt=rt=0;}\nint main(){\n\tscanf(\"%d%d\",&n,&qu);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1,u,v;i<n;i++) scanf(\"%d%d\",&u,&v),adde(u,v),adde(v,u);dfs0(1,0);\n\tfor(int i=1;i<=8;i++) for(int j=1;j<=n;j++) fa[j][i]=fa[fa[j][i-1]][i-1];\n\tfor(int i=1;i<=n;i++){\n\t\tclear();memset(mxv,0,sizeof(mxv));\n\t\tfor(int j=i,stp=0;j&&stp<256;j=fa[j][0],stp++){\n\t\t\tchkmax(mxv[a[j]>>8],stp^(a[j]&255));\n\t\t\tinsert(rt,7,a[j]>>8);\n\t\t}\n\t\tfor(int j=0;j<256;j++){\n\t\t\tint p=query(rt,7,j);\n\t\t\tmx[i][j]=(p<<8)|mxv[p^j];\n\t\t}\n\t} while(qu--){\n\t\tint u,v,p;scanf(\"%d%d\",&u,&v);p=v;int cur=0,res=0;\n\t\twhile(dep[p]-dep[u]>255) chkmax(res,mx[p][cur]),p=fa[p][8],++cur;\n\t\twhile(p^u) chkmax(res,a[p]^(dep[v]-dep[p])),p=fa[p][0];\n\t\tchkmax(res,a[u]^(dep[v]-dep[u]));printf(\"%d\\n\",res);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1630576344,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF840E In a Trap"
    },
    {
        "content": "\u5728\u77e5\u9053\u8fd9\u9053\u9898\u662f\u9608\u503c\u5206\u6cbb\u4e4b\u540e\u8dd1\u6765\u505a\u4e86\u505a\u3002         \n\n\u9996\u5148\u5176\u5b9e\u5f88\u4f69\u670d\u8fd9\u9053\u9898\u7684 trick \uff0c\u7531\u4e8e\u67e5\u8be2\u4fdd\u8bc1\u4e86\u70b9\u5bf9\u4e4b\u95f4\u7684\u7956\u5148\u5173\u7cfb\uff0c\u5927\u6982\u60f3\u5230\u4e86\u5bf9\u6bcf\u4e2a\u70b9\u8fdb\u884c\u4e00\u4e2a\u7d2f\u4f3c\u500d\u589e\u7684\u64cd\u4f5c\uff0c\u7136\u540e\u5408\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u6109\u5feb\u5408\uff0c\u6bd5\u7adf\u6211\u4eec\u7684\u9608\u503c\u5206\u6cbb\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u4e2a\u70b9\u5c31\u662f\u4e58\u6cd5\uff0c\u5982\u679c\u8fd9\u9053\u9898\u8981\u9608\u503c\u5206\u6cbb\u51d1\u7b54\u6848\uff0c\u90a3\u4e48\u5408\u8d77\u6765\u663e\u7136\u624d\u80fd\u4f53\u73b0\u51fa\u9608\u503c\u5206\u6cbb\u7684\u4f18\u52bf\u3002        \n\n\u63a5\u7740\u6211\u5c31\u53d1\u73b0\u8fd9\u4e2a\u73a9\u610f\u513f\u597d\u50cf\u4e0d\u80fd\u5408\u554a\uff0c\u5982\u679c\u5411\u4e0a\u8df3\uff0cdis \u5c31\u6574\u4f53\u52a0\u4e0a\u4e00\u4e2a\u503c\uff0c\u53ef\u662f\u8fd9\u4e2a\u6574\u4f53\u52a0\u503c\u5bf9\u4f4d\u8fd0\u7b97\u800c\u8a00\u663e\u7136\u4e0d\u80fd\u7ef4\u62a4\u554a\uff0c\u6302\u4e86\u6302\u4e86\u3002       \n\n\u7ffb\u4e86\u9898\u89e3\uff0c\u53d1\u73b0\u8fd9\u9053\u9898\u8fd8\u9700\u8981\u518d\u5728\u503c\u57df\u4e0a\u5957\u4e00\u4e2a\u9608\u503c\u5206\u6cbb\uff0c\u6211\u4eec\u4ee5 $256$ \u4e3a\u6211\u4eec\u722c\u6811\u65f6\u5408\u5e76\u7b54\u6848\u7684\u9608\u503c\uff08\u53ef\u4ee5\u7c7b\u6bd4\u4e3a\u5bf9\u8fd9\u4e2a\u6811\u5206\u5757\uff09\u4ee5\u53ca\u6211\u4eec\u5904\u7406\u8ba1\u7b97\u65f6\u7684\u9608\u503c\u3002       \n\n\u9996\u5148\u6211\u4eec\u7528 $f_{x,i}$ \u8868\u793a\u7b2c $x$ \u4e2a\u70b9\u6b64\u65f6\u7684 dis \u90fd\u9700\u8981\u52a0\u4e0a $i \\times 256$ \u65f6\u7684\u539f\u5f0f\u6700\u5927\u503c\uff0c\u663e\u7136\uff1a       \n\n- $f_{x,i} = max(val_j \\bigoplus dis(x , j) \\bigoplus (i \\times 256))$\uff0c\u5176\u4e2d j \u4e3a\u4ee5 x \u5411\u4e0a\u6570 $256$ \u4e2a\u70b9\u8def\u5f84\u4e0a\u7684\u4efb\u610f\u70b9\u3002       \n\n\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u76f4\u63a5 $\\bigoplus (i \\times 256)$\uff0c\u5f88\u663e\u7136\u7684\u5c31\u662f\u6211\u4eec\u7684 $dis(x,j)$ \u4e0d\u4f1a\u8d85\u8fc7 $256$ \u3002         \n\n\u63a5\u7740\u6211\u4eec\u8003\u8651\u5feb\u901f\u8ba1\u7b97\u8fd9\u4e2a\u73a9\u610f\u513f\u3002       \n\n\u8fd9\u65f6\u9608\u503c\u5206\u503c\u4e00\u4e2a\u503c\u5927\u4e8e $256$ \u548c\u5c0f\u4e8e $256$ \u7684\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u6570\u4e8c\u8fdb\u5236\u5f62\u5f0f\u4e0b $8$ \u4f4d\u540e\u524d\u7684\u503c\uff1a\uff08\u8fd9\u91cc\u7684\u524d\u6307\u7684\u662f\u4ece\u7b2c $0$ \u4f4d\u5f00\u59cb\uff09       \n\n- \u5bf9\u4e8e\u540e $8$ \u4f4d\uff0c\u6211\u4eec\u7684\u8d21\u732e\u5c31\u662f ```max(i ^ (val[j] / 256)) * 256```\uff0c\u8fd9\u91cc\u4e0d\u505a\u8fc7\u591a\u89e3\u91ca\uff0c\u81ea\u5df1\u7528\u624b\u63a8\u4e00\u4e0b\u5373\u53ef\uff0c\u8fd9\u4e2a\u73a9\u610f\u513f\u6211\u4eec\u628a $i$ \u5f53\u505a\u4e00\u4e2a\u53d8\u91cf\u5c31\u53ef\u4ee5 01trie \u7ef4\u62a4\u4e86\u3002            \n\n- \u5bf9\u4e8e\u524d $8$ \u4f4d\uff0c\u6211\u4eec\u53d1\u73b0\u5982\u679c\u6211\u4eec\u628a $i$ \u5f53\u505a\u5b9a\u503c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e00\u4e2a $val_j$ \u8868\u793a\u4e00\u4e2a\u63d2\u5165\u7684\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5 $g_{x , val_j / 256} = max(dis(now , j) \\bigoplus val_j \\land 255)$ \uff0c\u8868\u793a\u5f53\u6211\u4eec\u63d2\u5165\u7684\u662f $val_j / 256$ \u8fd9\u4e2a\u6570\u65f6\u524d $8$ \u4f4d\u7684\u6700\u5927\u503c\uff0c\u5f53\u6211\u4eec\u901a\u8fc7 01trie \u5f97\u5230\u6211\u4eec\u540e $8$ \u4f4d\u7684\u6700\u5927\u503c\u65f6\uff0c\u524d $8$ \u4f4d\u7684\u6700\u5927\u503c\u76f4\u63a5\u52a0\u4e0a\u53bb\u5c31\u597d\u4e86\u3002    \n\n\u4e4b\u540e\u5f97\u5230\u4e86\u8fd9\u4e2a\u503c\uff0c\u6211\u4eec\u5c31\u5728\u67e5\u8be2\u65f6\u4e00\u6b65\u6b65\u5f80\u4e0a\u5408\u5e76\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(256n + qn / 256)$\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\nusing namespace std;\nconst int Len = 5e4 + 5,m = 256;\nint fa[Len],n,q,cnt,trie[Len][2],f[Len][261],g[Len][261],dep[Len],lst[Len],val[Len];\nint head[Len],tot;\nbool vis[Len];\ninline int read() {\n    char ch = getchar();\n    int x = 0, f = 1;\n    while (ch < '0' || ch > '9') {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while ('0' <= ch && ch <= '9') {\n        x = x * 10 + ch - '0';\n        ch = getchar();\n    }\n    return x * f;\n}\ninline void write(int x) {\n    if (x < 0)\n        putchar('-'), x = -x;\n    if (x > 9)\n        write(x / 10);\n    putchar(x % 10 + '0');\n}\nstruct node\n{\n\tint next,to;\n}edge[Len << 1];\nvoid add(int from,int to)\n{\n\tedge[++ tot].to = to;\n\tedge[tot].next = head[from];\n\thead[from] = tot; \n}\nvoid clear(){cnt = 0 ; trie[0][0] = trie[0][1] = 0;}\ninline void insert(int x)\n{\n\tint rt = 0;\n\tfor(int i = 7 ; i >= 0 ; i --)\n\t{\n\t\tint id = (x >> i) & 1;\n\t\tif(!trie[rt][id])\n\t\t{\n\t\t\ttrie[rt][id] = ++ cnt;\n\t\t\ttrie[cnt][0] = trie[cnt][1] = 0;\n\t\t}\n\t\trt = trie[rt][id];\n\t}\n}\ninline int query(int x,int u)\n{\n\tint ret = 0,rt = 0,v = 0;\n\tfor(int i = 7 ; i >= 0 ; i --)\n\t{\n\t\tint id = (x >> i) & 1;\n\t\tif(trie[rt][id ^ 1]) rt = trie[rt][id ^= 1] , ret |= (1 << i);\n\t\telse rt = trie[rt][id];\n\t\tv |= id << i;\n\t}\n\treturn ret << 8 | g[u][v];\n}\nvoid dfs(int x,int fft)\n{\n\tdep[x] = dep[fft] + 1;\n\tfa[x] = fft;\n\tif(dep[x] >= m)\n\t{\n\t\tclear();\n\t\tint i;\n\t\tfor(i = x ; dep[x] - dep[i] < m ; i = fa[i])\n\t\t{\n\t\t\tg[x][val[i] / 256] = max(g[x][val[i] / 256] , (dep[x] - dep[i]) ^ val[i] & 255);\n\t\t\tif(vis[val[i] / 256] != x) insert(val[i] / 256) , vis[val[i] / 256] = x;\n\t\t}\n\t\tlst[x] = i;//\u5206\u5757\n\t\tfor(i = 0 ; i < m ; i ++) f[x][i] = query(i , x);\n\t}\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tint to = edge[e].to;\n\t\tif(to == fft) continue;\n\t\tdfs(to , x);\n\t}\n}\nsigned main()\n{\n\tn = read() , q = read();\n\tfor(int i = 1 ; i <= n ; i ++) val[i] = read();\n\tfor(int i = 1 ; i < n ; i ++)\n\t{\n\t\tint x,y;x = read() , y = read();\n\t\tadd(x , y) , add(y , x);\n\t}\n\tdep[1] = 1;dfs(1 , 0);\n\tfor(int i = 1 ; i <= q ; i ++)\n\t{\n\t\tint x,y,dis = 0,ans = 0;x = read() , y = read();\n\t\twhile(dep[y] - dep[x] >= m) \n\t\t{\n\t\t\tans = max(ans , f[y][dis]);\n\t\t\ty = lst[y] , dis ++;\n\t\t}\n\t\tdis <<= 8;\n\t\twhile(y != fa[x])\n\t\t{\n\t\t\tans = max(ans , dis ^ val[y]);\n\t\t\ty = fa[y] , dis ++;\n\t\t}\n\t\twrite(ans) , putchar('\\n');\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1615086115,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF840E In a Trap(\u7c7b\u6811\u5206\u5757 + \u9608\u503c\u5206\u6cbb)"
    },
    {
        "content": "\u7ed9\u5b9a\u4e00\u68f5\u6709\u6839\u6811\uff0c\u5e26\u70b9\u6743 $a_i$\uff0c$q$ \u6b21\u7ed9\u5b9a $u$ \u662f $v$ \u7684\u7956\u5148\uff0c\u8be2\u95ee $\\max_{p\\in path(u,v)}\\{a_p\\oplus dis(p,v)\\}$\u3002\n\n$1\\leq n\\leq 5\\times 10^4$\uff0c$1\\leq q\\leq 1.5\\times 10^5$\uff0c$0\\leq a_i\\leq n$\u3002\n\n\u8003\u8651\u5e8f\u5217\u4e0a\u7684\u95ee\u9898\uff1a\u8be2\u95ee $i\\in [l,r]$ \u6700\u5927\u7684 $a_i\\oplus dis(i,r)$\u3002\u6734\u7d20\u5730\uff0c\u5728\u53f3\u7aef\u70b9\u4ece\u5de6\u5f80\u53f3\u79fb\u52a8\u7684\u65f6\u5019\u4ee5\u67d0\u79cd\u65b9\u5f0f\u7ef4\u62a4\u7b54\u6848\uff0c\u628a\u8be2\u95ee\u6302\u5230 $r$ \u5904\u5e76\u56de\u7b54\u3002\u5982\u679c\u6bcf\u6b65\u7684\u64cd\u4f5c\u628a\u53f3\u7aef\u70b9\u589e\u52a0 $S$\uff0c\u539f\u672c\u8d21\u732e\u4e3a $a_i\\oplus dis_i$ \u7684\u5219\u4f1a\u6539\u4e3a $a_i\\oplus (dis_i+S)$\uff0c\u8003\u8651\u5230\u5f02\u6216\u548c\u52a0\u6cd5\u4e4b\u95f4\u7684\u6027\u8d28\u975e\u5e38\u4e0d\u4f18\u7f8e\uff0c\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u5176\u80fd\u591f\u90fd\u662f\u540c\u4e00\u7c7b\u8fd0\u7b97\u3002 \u5e76\u4e14\u7531\u4e8e\u6b65\u957f\u4e3a $S$\uff0c\u53ef\u4ee5\u770b\u4f5c\u6bcf\u6b21\u90fd\u662f\u4ee5\u5f53\u524d\u7684 $r$ \u4e3a\u53f3\u7aef\u70b9\uff0c\u4ece\u53f3\u5411\u5de6\u6bcf $S$ \u4e2a\u5206\u4e00\u4e2a\u5757\u3002\n\n\u89c2\u5bdf\u5230\u5f53\u6211\u4eec\u53ef\u4ee5\u59cb\u7ec8\u628a $dis_i$ \u5199\u4e3a $d_i+D\\times S$\uff0c\u5176\u4e2d $d_i$ \u662f\u4ee5\u5f53\u524d\u7684 $r$ \u4ece\u53f3\u5f80\u5de6\u6bcf $S$ \u4e2a\u5206\u4e00\u4e2a\u5757\uff0c$i$ \u5230\u5757\u5c3e\u7684\u8ddd\u79bb\uff0c\u503c\u5728 $0$ \u5230 $S-1$ \u4e4b\u95f4\uff0c\u6bcf\u4e2a $i$ \u5bf9\u4e8e\u4e0d\u540c\u7684\u5206\u5757\u7c7b\u578b\uff0c\u6709 $S$ \u4e2a\u503c\u4e0d\u540c\u7684 $d_i$\uff0c\u5e76\u4e14\u8fd9\u4e2a\u503c\u4e0d\u4f1a\u56e0\u4e3a\u53f3\u7aef\u70b9\u7684\u79fb\u52a8\u4e3a\u6539\u53d8\uff0c\u4ec5\u4f1a\u7531\u4e8e\u5206\u5757\u7c7b\u578b\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u540e\u9762\u8003\u8651\u7684\u90fd\u662f\u5f53\u524d\u53f3\u7aef\u70b9\u4e3a\u67d0\u4e2a\u5757\u672b\u5c3e\u65f6\u5bf9\u5e94\u7684 $d_i$\u3002\u5219\u5f53 $S=2^k$ \u65f6\uff0c\u6709 $d_i+D\\times S=d_i\\oplus(D\\times S)$\u3002\n\n\u6b64\u65f6\u4e00\u4e2a\u5f88\u6e05\u6670\u7684\u601d\u8def\u662f\uff0c\u5982\u679c\u7ef4\u62a4\u4e86 $S$ \u7c7b\u5206\u5757\uff08\u4ee3\u4ef7\u662f\u7a7a\u95f4\u53d8\u4e3a $O(nS)$\uff09\uff0c\u5728\u4ece\u5de6\u5411\u53f3\u679a\u4e3e\u53f3\u7aef\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u8d21\u732e\u53ef\u4ee5\u88ab\u6539\u5199\u4e3a $a_i\\oplus d_{x_r,i}\\oplus(D\\times S)$\uff0c\u5176\u4e2d $d_{x_r}$ \u662f\u4e0a\u9762\u63d0\u5230\u7684\uff0c\u4ee5 $r$ \u4ece\u53f3\u5411\u5de6\u6bcf $S$ \u4e2a\u5206\u4e00\u4e2a\u5757\uff0c\u6bcf\u4e2a\u70b9\u5230\u53f3\u7aef\u70b9\u7684\u8ddd\u79bb\uff0c\u8868\u793a\u4e00\u7c7b $d$ \u7684\u521d\u503c\uff1b$D$ \u662f $i$ \u6240\u5728\u7684\u5757\u4e0e $r$ \u6240\u5728\u7684\u5757\u4e2d\u95f4\u6709\u591a\u5c11\u4e2a\u6574\u5757\u3002\n\n\u53d1\u73b0\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u79cd\u5206\u5757\u7c7b\u578b $x_r$\uff08\u53d6\u503c\u4ec5\u6709 $S$ \u79cd\uff09\uff0c\u7ef4\u62a4\u5757\u5185 $a_i\\oplus d_{x_r,i}$ \u7684 01Trie\uff08\u5171 $n$ \u68f5\uff0c\u6bcf\u68f5 $S$ \u4e2a\u5143\u7d20\uff09\uff0c\u679a\u4e3e $D$\uff08\u53d6\u503c\u4ec5\u6709 $\\frac{n}{S}$ \u79cd\uff09\u53bb\u5bf9\u5e94\u6574\u5757\u7684 Trie \u4e0a\u67e5\u8be2 xor \u6700\u5927\u503c\uff0c\u6563\u5757\u66b4\u529b\u8be2\u95ee\uff0c\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nS\\log V+q\\frac{n}{S}\\log V+qS)$\uff0c\u5206\u522b\u5bf9\u5e94\u6bcf\u7c7b\u5206\u5757\u7684\u63d2\u5165\u548c\u67e5\u8be2\uff0c\u89c6\u4f5c $n,q$ \u540c\u7ea7\uff0c\u5219\u53d6 $S$ \u4e3a $O(\\sqrt n)$ \u65f6\u65f6\u7a7a\u590d\u6742\u5ea6\u505a\u5230 $O(n\\sqrt n\\log V)$\uff0c\u5e76\u4e14\u8fd8\u9700\u8981 $S=2^k$\uff0c\u4e8e\u662f\u53d6 $S=256$\u3002\n\n\u6ce8\u610f\u5230 $D\\times S$ \u7684\u540e 8 \u4f4d\u90fd\u662f 0\uff0c\u4e8e\u662f\u53ea\u9700\u8981\u5411 Trie \u63d2\u5165 $a_i\\oplus d_{x_r,i}$ \u7684\u524d 8 \u4f4d\uff0c\u5e76\u5728\u53f6\u5b50\u7ed3\u70b9\u7ef4\u62a4\u5bf9\u5e94\u540e\u516b\u4f4d\u7684 $\\max$\uff0c\u5219 $\\log$ \u5c0f\u4e86\u4e00\u534a\uff0c\u4f46\u7a7a\u95f4\u4f9d\u7136\u96be\u4ee5\u63a5\u53d7\u3002\u53d1\u73b0\u6ca1\u6709\u5fc5\u8981\u771f\u7684\u628a $n$ \u4e2a\u5757\u5bf9\u5e94\u7684 Trie \u6811\u5168\u90e8\u4fdd\u7559\uff0c\u53ea\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u5206\u522b\u5efa\u4e00\u6b21 Trie\uff0c\u9884\u5904\u7406\u7b54\u6848\uff0c\u7136\u540e\u8fd9\u68f5 Trie \u5c31\u4e0d\u5fc5\u4fdd\u7559\u4e86\u3002\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt n\\log V+q\\sqrt n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt n)$\u3002\n\n\u5bf9\u4e8e\u6811\u4e0a\u95ee\u9898\uff0c\u4ece\u6bcf\u4e2a\u70b9\u7ef4\u62a4\u5411\u4e0a $S$ \u4e2a\u70b9\u6784\u6210\u7684\u5757\uff0c\u67e5\u8be2\u7b54\u6848\u65f6\u9010\u6b65\u8df3 $S$ \u7ea7\u7956\u5148\u3002[Submission](https://codeforces.com/contest/840/submission/176818628)\u3002",
        "postTime": 1666056711,
        "uid": 447750,
        "name": "luogubot",
        "ccfLevel": 0,
        "title": "CF840E"
    },
    {
        "content": "\u7528\u4e00\u4e9b\u5c0f\u6280\u5de7\u53ef\u4ee5\u505a\u5230 $O(n\\sqrt n)$\u3002\n\n\u74f6\u9888\u5728\u4e8e $O(\\sqrt n)$ \u8ba1\u7b97\u90a3\u4e2a\u8be1\u5f02\u7684\u9884\u5904\u7406\u6570\u7ec4\u3002\n\n\u6211\u4eec\u9884\u5904\u7406\u4e00\u4e2a\u4e1c\u897f\uff1a\u6bcf\u4e2a\u516b\u4f4d\u524d\u7f00\u5bf9\u5e94\u7684\u540e\u7f00\u7684 $\\max$\uff0c\u7136\u540e\u5728\u4e0a\u9762\u5efa 01trie\uff0c\u8fd9\u4e2a\u663e\u7136\u662f $O(\\sqrt n)$ \u7684\u3002\n\n\u7136\u540e\u8981\u5bf9 $x\\in [0,256)$ \u6c42\u51fa\u6bcf\u4e2a\u6570\u7684\u6700\u4f18\u5339\u914d\u3002\n\n\u6309\u4f4d\u8003\u8651\u6bcf\u4e00\u4f4d\u3002\n\n* \u5982\u679c\u8fd9\u91cc\u540c\u65f6\u6709 $0,1$\uff0c\u90a3\u4e48\u6211\u4eec\u628a\u6240\u6709 $0$ \u90fd\u53bb\u5339\u914d $1$\uff0c\u6240\u6709 $1$ \u53bb\u5339\u914d $0$ \u5373\u53ef\u3002\n* \u5982\u679c\u8fd9\u91cc\u53ea\u6709 $0/1$\u3002\u90a3\u4e48\u6240\u6709\u7684\u6570\u90fd\u53ea\u80fd\u5339\u914d\u8fd9\u4e2a $0/1$\u3002\n\n\u7528\u4e00\u4e2a dfs \u7ef4\u62a4\u4e0a\u9762\u7684\u8fc7\u7a0b\u3002\u4f1a\u53d1\u73b0\u586b\u5230\u6700\u540e\u6709\u4e00\u4e9b\u4f4d\u662f\u786e\u5b9a\u7684\uff0c\u5176\u4ed6\u7684\u4e0d\u786e\u5b9a\u3002\n\n\u5148\u628a\u786e\u5b9a\u7684\u4f4d\u538b\u8d77\u6765\uff0c\u8003\u8651\u4e0d\u786e\u5b9a\u7684\u4f4d\u3002\n\n\u4f1a\u53d1\u73b0\u5982\u679c\u6709 $x$ \u4e2a\u4e0d\u786e\u5b9a\u7684\u4f4d\uff0c\u628a\u8fd9\u4e9b\u4f4d\u7f6e\u7528\u6808\u5b58\u8d77\u6765\uff0c\u53ef\u4ee5\u76f4\u63a5 $O(2^x)$ \u518d\u7528\u4e00\u4e2a dfs \u6c42\u51fa\u5bf9\u5e94\u7684\u6bcf\u4e2a\u6570\u3002\u8fd9\u91cc\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sqrt n)$\uff0c\u56e0\u4e3a\u4fdd\u8bc1\u4e86\u6bcf\u4e2a\u6570\u53ea\u88ab\u6c42\u4e00\u6b21\u3002\n\n\u6bd4\u8f83\u62bd\u8c61\uff0c\u53ef\u4ee5\u770b[~~\u6d1b\u8c37\u8bc4\u6d4b\u8bb0\u5f55~~](https://www.luogu.com.cn/record/89262469)[CF \u8bc4\u6d4b\u8bb0\u5f55](https://codeforces.com/contest/840/submission/175229652)\u3002\n\nbtw\uff0c\u8fd9\u9898\u89e3\u6cd5\u548c\u503c\u57df\u6ca1\u5565\u5173\u7cfb\u3002\u7eaf\u7cb9\u662f\u56e0\u4e3a\u590d\u6742\u5ea6\u8981\u6c42 $O(n2^k+\\dfrac {nq} {2^k})$\uff0c\u53d6 $2^k=\\Theta(\\sqrt q)$ \u800c\u5df2\u3002",
        "postTime": 1665311728,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF840E In a Trap"
    },
    {
        "content": "\u6709\u8da3\u7684\u9898\u3002\n\n$256^2 \\geq n$\u3002\n\n\u6211\u4eec\u8003\u8651\u5206\u5757\uff0c\u53d1\u73b0\u5f02\u6216\u7684\u524d8\u4f4d\uff0c\u548c\u540e\u516b\u4f4d\u4e92\u4e0d\u5f71\u54cd\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u66b4\u529b\u540e\u516b\u4f4d\u7684\u90e8\u5206\uff08\u5728\u7b2c\u4e00\u6b21dfs\u7684\u65f6\u5019\uff0c\u663e\u7136\u53ea\u6709255\u4e2a\u7956\u5148\u4f1a\u5f71\u54cd\u540e\u516b\u4f4ddep\u5e26\u6765\u7684\u5f71\u54cd\u3002\uff09\n\n\u524d\u516b\u4f4d\u663e\u7136\u662f\u56fa\u5b9a\u7684\u3002\n\n$f_{u,i}$ \u7684\u5b9a\u4e49\u662f\u79bb $u$ \u8fd9\u4e2a\u70b9 $i\\times 256$ \u8ddd\u79bb\u7684\u6700\u5927\u503c\u3002\n\uff08\u5176\u5b9e\u5c31\u662f\u5728 $u$ \u5b50\u6811\u4e2d\u79bb $i \\times 256$ \u8ddd\u79bb\u7684\u70b9\u62ff\u6765\u66f4\u65b0\u7684\u4e1c\u897f\u3002\uff09\n\n\u5176\u5b9e\u4e5f\u5c31\u662f $f_{u,i} = \\max\\{a_j \\oplus dist(u,j) \\oplus (i \\times 256)\\}$\u3002\uff08\u5176\u4e2d $dist(u,j)\\leq 255$ \u4e14 $j$ \u662f $u$ \u7684\u7956\u5148\u3002\uff09\n\n```cpp\nint lst[N];void solve(int u){\n\tclr();for(int i=u;dep[u]-dep[i]<m;i=fa[i]){\n\t\tcmax(mx[u][val[i]>>8],(dep[u]-dep[i]^val[i])&255);ins(val[i]>>8);\n\t}int tmp=u;while(dep[u]-dep[tmp]!=m)tmp=fa[tmp];lst[u]=tmp;\n\trep(i,0,m-1)f[u][i]=query(i,u);\n}\nvoid dfs(int u){if(dep[u]>=m){solve(u);}for(auto v:g[u])if(v^fa[u])fa[v]=u,dep[v]=dep[u]+1,dfs(v);}\n```\n\n\u7136\u540e\u66b4\u529b\u679a\u4e3e\u7b54\u6848\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6 $n \\times 256 + q \\times \\frac{n}{256}$",
        "postTime": 1600694354,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF840E \u3010In a Trap\u3011"
    },
    {
        "content": "\u6b63\u5e38\u9014\u5f84\u4e0d\u597d\u7ef4\u62a4\uff0c\u8003\u8651\u6839\u53f7\u7b97\u6cd5\u3002\u6bd4\u5982\u6811\u5206\u5757\u3002\n\n\u8003\u8651\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5230\u5176 $S$ \u7ea7\u7956\u5148\u7684\u7b54\u6848\uff0c\u8be2\u95ee\u65f6\u8df3\u81f3\u591a $\\frac{n}{S}$ \u4e2a\u5757\u6574\u5408\u7b54\u6848\u3002\u4e8e\u662f\uff0c\u600e\u4e48\u9884\u5904\u7406\u5462\uff1f\n\n\u8bbe\u5757\u5185\u7b2c $j$ \u7ea7\u7956\u5148\u4e3a $x$\uff0c\u4e14\u8be5\u5757\u4e3a\u8def\u5f84\u4e0a\u7b2c $i+1$ \u4e2a\u5757\uff0c\u5219\u663e\u7136 $x$ \u7684\u8d21\u732e\u4e3a $a_x\\bigoplus (iS+j)$\u3002\u4e8e\u662f\u8fdb\u4e00\u6b65\u5730\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9 $x$\uff0c\u7ef4\u62a4 $f_{x,i}$ \u8868\u793a\u8282\u70b9 $x$ \u5411\u4e0a\u7684\u5757\u4f5c\u4e3a\u4ece\u4e0b\u81f3\u4e0a\u7b2c $i$ \u4e2a\u5757\u65f6\u8d21\u732e\u7684\u6700\u5927\u503c\u3002\n\n\u5bf9\u4e8e $f_{x,i}$ \u7684\u5904\u7406\uff0c\u66b4\u529b\u5904\u7406\u662f $O(n^2)$ \u7684\u3002\u6211\u4eec\u60f3\u5230\u5c3d\u91cf\u5c06\u8d21\u732e\u5f0f\u5b50\u62c6\u5f00\uff0c\u4f46\u5f02\u6216\u548c\u52a0\u6cd5\u6df7\u5408\u4e0d\u592a\u597d\u62c6\uff0c\u6240\u4ee5\u8003\u8651\u5c06 $S$ \u8bbe\u4e3a $2^8$\uff08$(2^8)^2>n$\uff0c\u4e14 $2^8$ \u4e3a\u4e8c\u7684\u6b63\u6574\u6570\u6b21\u5e42\uff09\uff0c\u6b64\u65f6\u6211\u4eec\u628a $a_x$ \u4e5f\u62c6\u6210\u524d $8$ \u4f4d\u548c\u540e $8$ \u4f4d\uff0c\u5206\u522b\u8bbe\u4e3a $b_x$ \u548c $c_x$\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u5c06\u8d21\u732e\u5f0f\u5b50\u53d8\u6210 $b_x\\bigoplus iS+c_x\\bigoplus j$\u3002\n\n\u8003\u8651\u7528 Trie \u6765\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5bf9\u4e8e\u8282\u70b9 $x$\uff0c\u5148\u5c06\u5176\u6240\u6709 $2^8$ \u7ea7\u7956\u5148\u7684 $b_x+c_x\\bigoplus j$ \u63d2\u5165 Trie\uff0c\u5176\u4e2d $b_x$ \u4f5c\u4e3a Trie \u5185\u8282\u70b9\uff0c\u5e76\u5c06 $c_x\\bigoplus j$ \u6302\u5728\u672b\u7aef\u8282\u70b9\u4e0a\u53d6\u6700\u5927\u503c\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u4ecd\u5728 Trie \u5185\u67e5\u8be2\u5f02\u6216 $i$ \u7684\u6700\u5927\u503c\uff0c\u67e5\u5b8c\u540e\u4e0e\u672b\u7aef\u8282\u70b9\u4fe1\u606f\u5408\u5e76\u5373\u53ef\u3002\n\n\u67e5\u8be2\u65f6\u96f6\u5757\u6563\u5757\u5206\u5f00\u5904\u7406\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt n\\log n+q\\sqrt n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=5e4+5;\nconst int V=16*300;\nconst int K=300;\nconst int Q=8;\nint n,q,a[N],sq,fa[N],f[N][K],dep[N],ffa[N];\nstruct node{\n    int to[N<<1],next[N<<1],head[N],tot;\n    void adde(int u,int v){\n        to[++tot]=v,next[tot]=head[u],head[u]=tot;\n    }\n}S;\nstruct Trie{\n    int son[V][2],val[V],cnt;\n    void add(int x){\n        int now=0;\n        for (int i=0;i<Q;i++){\n            int p=(x>>(2*Q)-i-1)&1;\n            if (!son[now][p]) son[now][p]=++cnt;\n            now=son[now][p];\n        }\n        val[now]=max(val[now],x%(1<<Q));\n    }\n    void clear(){\n        for (int i=0;i<=cnt;i++) son[i][0]=son[i][1]=val[i]=0;\n        cnt=0;\n    }\n    int query(int x){\n        int now=0,sum=0;\n        for (int i=0;i<Q;i++){\n            int p=(x>>Q-i-1)&1;\n            if (son[now][p^1]) now=son[now][p^1],sum=sum<<1|1;\n            else now=son[now][p],sum=sum<<1;\n        }\n        return sum<<Q|val[now];\n    }\n}T;\nint read(){\n\tint w=0,fh=1;\n\tchar c=getchar();\n\twhile (c>'9'||c<'0'){\n\t\tif (c=='-') fh=-1;\n\t\tc=getchar();\n\t}\n\twhile (c>='0'&&c<='9'){\n\t\tw=(w<<3)+(w<<1)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn w*fh;\n}\nvoid dfs(int u){\n    dep[u]=dep[fa[u]]+1;\n    int en=u;\n    for (int i=1;i<(1<<Q);i++) en=fa[en];\n    if (en){\n        T.clear();ffa[u]=en;\n        for (int now=u,j=0;;now=fa[now],j++){\n            T.add(a[now]^j);    \n            if (now==en) break;\n        }\n        for (int i=0;i<(1<<Q);i++){\n            f[u][i]=T.query(i);\n        }        \n    }\n    for (int i=S.head[u];i;i=S.next[i]){\n        int v=S.to[i];\n        if (v!=fa[u]){\n            fa[v]=u;\n            dfs(v);\n        }\n    }\n}\nint main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"in.in\",\"r\",stdin);\n\t// freopen(\"out.out\",\"w\",stdout);\n#endif\n\tn=read(),q=read();\n    for (int i=1;i<=n;i++) a[i]=read();\n    for (int i=1;i<n;i++){\n        int u=read(),v=read();\n        S.adde(u,v),S.adde(v,u);\n    }\n    dfs(1);\n    while (q--){\n        int u=read(),v=read();\n        int p=0,ans=0;\n        while (dep[ffa[v]]>=dep[u]){\n            ans=max(ans,f[v][p]);\n            v=fa[ffa[v]],++p;\n        }\n        if (dep[v]>=dep[u]){\n            for (int j=0;v;j++){\n                ans=max(ans,a[v]^(p<<Q|j));\n                if (v==u) break;\n                v=fa[v];\n            }            \n        }\n        cout<<ans<<'\\n';\n    }\n\treturn 0;\n}\n```",
        "postTime": 1682343056,
        "uid": 257621,
        "name": "\u7ffc\u5fb7\u5929\u5c0a",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 [CF840E] In a Trap"
    },
    {
        "content": "\u5206\u5757 + \u5bf9\u534a\u62c6\u4f4d + 01-trie\n\n> \u7ed9\u51fa\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\u548c $a_{1\\sim n}$\uff0c$q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u51fa $X,Y$\uff0c\u5176\u4e2d $X$ \u662f $Y$ \u7684\u7956\u5148\uff0c\u6c42 $\\max_{p\\in(X\\leadsto Y)}\\{a_p\\oplus dis(p,Y)\\}$\u3002\n>\n> $1\\leq n\\leq 5\\times 10^4$\uff0c$1\\leq q\\leq 1.5\\times 10^5$\uff0c$0\\leq a_i\\leq n$\u3002\n\n\u4ece $Y$ \u5411\u4e0a\uff0c\u6bcf $2^8$ \u4e2a\u70b9\u4e00\u5757\u3002\u5bf9\u4e8e\u7b2c $bl$ \u4e2a\u5757\u7684\u7b2c $i$ \u4e2a\u70b9 $p$\uff0c\u8d21\u732e $a_p\\oplus (bl\\cdot 2^8+i)$\uff08$bl,i\\in[0,2^8)$\uff09\u3002\n\n\u5bf9\u6574\u5757\u9884\u5904\u7406\uff0c\u6563\u5757\u66b4\u529b\u3002\n\n\u8003\u8651\u4ee5 $x$ \u4e3a\u6700\u5e95\u4e0b\u70b9\u7684\u67d0\u5757\uff0c\u5bf9\u6bcf\u4e2a $bl$ \u6c42\u51fa $val_{x,bl}$ \u8868\u793a\u8fd9\u5757\u4f5c\u4e3a $Y$ \u5f80\u4e0a\u7b2c $bl$ \u4e2a\u5757\u7684\u8d21\u732e\u3002\u90a3\u4e48 $val_{x,bl}=\\max\\limits_{i=0}^{2^8-1}\\{a_{fa(x,i)}\\oplus (bl\\cdot 2^8+i)\\}$\uff0c\u5176\u4e2d $fa(x,i)$ \u8868\u793a $x$ \u7684 $i$ \u7ea7\u7956\u5148\u3002\n\n\u52a0\u6cd5\u548c\u5f02\u6216\u6df7\u5408\u4e0d\u597d\u5904\u7406\uff0c\u5bf9\u534a\u62c6\u4f4d\uff1a$val_{x,bl}=\\max\\limits_{i=0}^{2^8-1}\\{(fi(a_{fa(x,i)})\\oplus bl)\\cdot 2^8+se(a_{fa(x,i)})\\oplus i\\}$\uff0c\u5176\u4e2d $fi(v),se(v)$ \u5206\u522b\u8868\u793a $v$ \u7684\u524d $8$ \u4f4d\u548c\u540e $8$ \u4f4d\u3002\u663e\u7136\u662f\u5148\u5927\u5316\u524d\u534a\u90e8\u5206\u518d\u6700\u5c0f\u5316\u540e\u534a\u90e8\u5206\u3002\u5bf9\u4e8e\u524d\u534a\u90e8\u5206\uff0c\u5148\u5c06\u6240\u6709 $fi(a_{fa(x,i)})$ \u63d2\u5165 01-trie\uff0c\u7136\u540e\u679a\u4e3e $bl$ \u67e5\u8be2 $fi(a_{fa(x,i)})\\oplus bl$ \u7684\u6700\u5927\u503c $res$\uff0c\u5219\u4f7f\u524d\u534a\u90e8\u5206\u6700\u5927\u7684 $fi(a_{fa(x,i)})$ \u5c31\u662f $res\\oplus bl$\uff0c\u8bb0\u4e3a $v$\u3002\u540e\u534a\u90e8\u5206\u5c31\u662f\u4ece $fi(a_{fa(x,i)})=v$ \u91cc\u9009 $se(a_{fa(x,i)}\\oplus i)$ \u6700\u5927\u7684\uff0c\u5f00\u4e2a\u6876 $mx_v$ \u7ef4\u62a4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n\\sqrt n+q\\sqrt n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=5e4+5,B=1<<8;\nint n,m,a[N],x,y,tot,ch[N][2],dep[N],f[N][9],val[N][B],mx[B];\nvector<int>v[N];\nvoid insert(int x){\n\tfor(int i=7,p=1,k;i>=0;i--){\n\t\tif(!ch[p][k=x>>i&1]) ch[p][k]=++tot;\n\t\tp=ch[p][k];\n\t}\n}\nint query(int x){\n\tint p=1,ans=0;\n\tfor(int i=7;i>=0;i--){\n\t\tint k=x>>i&1;\n\t\tif(ch[p][k^1]) p=ch[p][k^1],ans|=1<<i;\n\t\telse p=ch[p][k];\n\t}\n\treturn (ans<<8)|mx[ans^x];\n}\nvoid dfs(int x,int fa){\n\tfor(int i=0;i<8;i++) f[x][i+1]=f[f[x][i]][i];\n\tif(dep[x]>=B){\n\t\tfor(int i=1;i<=tot;i++) ch[i][0]=ch[i][1]=0;\n\t\ttot=1,fill(mx,mx+B,0);\n\t\tfor(int i=0,p=x;i<B;i++)\n\t\t\tinsert(a[p]>>8),mx[a[p]>>8]=max(mx[a[p]>>8],(a[p]%B)^i),p=f[p][0];\n\t\tfor(int i=0;i<B;i++) val[x][i]=query(i);\n\t}\n\tfor(int y:v[x])\n\t\tif(y!=fa) dep[y]=dep[x]+1,f[y][0]=x,dfs(y,x);\n}\nsigned main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<n;i++)\n\t\tscanf(\"%d%d\",&x,&y),v[x].push_back(y),v[y].push_back(x);\n\tdfs(1,0);\n\twhile(m--){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tint ans=0,p=y;\n\t\tfor(int i=0;dep[p]-dep[x]>=B;i++,p=f[p][8]) ans=max(ans,val[p][i]);\n\t\tfor(;p^f[x][0];p=f[p][0]) ans=max(ans,a[p]^(dep[y]-dep[p]));\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\n\u53c2\u8003\u4e86\u522b\u7684\u9898\u89e3 qwq\u3002",
        "postTime": 1668560612,
        "uid": 381985,
        "name": "lkytxdy",
        "ccfLevel": 0,
        "title": "CF840E In a Trap"
    }
]