[
    {
        "content": "# CF837G Functions On The Segments\n\n## \u9898\u76ee\u5927\u610f\n\n\u6709 $n$ \u4e2a\u5206\u6bb5\u51fd\u6570\uff0c$f_i(x)$ \u6709 $6$ \u4e2a\u53c2\u6570 $x_1,x_2,y_1,a,b,y_2$\u3002\n\n$$f(x)=\\begin{cases}y_1&x\\le x_1\\\\ax+b&x_1<x\\le x_2\\\\y_2&x_2<x\\end{cases}$$\n\n\u6709 $m$ \u4e2a\u8be2\u95ee\uff0c**\u5f3a\u5236\u5728\u7ebf**\uff0c\u8bb0\u4e0a\u4e00\u6b21\u7b54\u6848\u4e3a $last$\uff0c\u7b2c\u4e00\u4e2a\u8be2\u95ee $last=0$\uff0c\u6bcf\u6b21\u7ed9\u51fa $l,r,x$ \u4e09\u4e2a\u6574\u6570\uff0c$x_i=(last+x)\\bmod10^9$\uff0c\u6c42 $\\sum\\limits_{j=l}^rf_j(x_i)$ \u7684\u503c\u3002\n\n## \u601d\u8def\n\n\u9996\u5148\u770b\u5230\u533a\u95f4\u67e5\u8be2\uff0c\u60f3\u5230\u5148\u9884\u5904\u7406\u51fa $\\sum\\limits_{j=1}^rf_j(x_i)$ \u7684\u503c\uff0c\u518d\u524d\u7f00\u548c\u67e5\u8be2\u5373\u53ef\u3002\n\n\u7136\u540e\u6211\u4eec\u5c06\u51fd\u6570\u53d8\u5f62\uff1a\n\n$$f(x)=\\begin{cases}0x+y_1&x\\le x_1\\\\ax+b&x_1<x\\le x_2\\\\0x+y_2&x_2<x\\end{cases}$$\n\n\u5f97\u5230\uff1a\n\n$$\\sum\\limits_{j=1}^rf_j(x_i)=\\sum\\limits_{j=1}^ra_j\\times x_i+\\sum\\limits_{j=1}^rb_j$$\n\n\u4e5f\u5c31\u662f\u8981\u9884\u5904\u7406\u65f6\u533a\u95f4\u4fee\u6539 $a,b$ \u7684\u503c\uff0c\u5355\u70b9\u67e5\u8be2\uff0c\u7528\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u4e2a\u5dee\u5206\u6570\u7ec4\u5c31\u597d\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u6b21\u5dee\u5206\uff0c\u53ea\u4f1a\u6539\u53d8 $6$ \u4e2a\u70b9\u7684\u5927\u5c0f\uff0c\u7528\u4e3b\u5e2d\u6811\u778e\u641e\u4e00\u4e0b\uff0c\u7136\u540e\u5c31\u662f\u677f\u5b50\u4e86\u3002\n\n\u6ce8\u610f\uff1a\u8bb0\u5f97\u5f00long long\uff0c\u7a7a\u95f4\u5f00\u6ee1\u3002\n\nCode:\n\n```cpp\n#include<bits/stdc++.h>\n#define rg register\nusing namespace std;\nstatic char buf[1000000],*p1=buf,*p2=buf;\n#define getchar() p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++\ninline void read(int &x){\n\tint f=1;x=0;char c=getchar();\n\twhile (c<'0'||c>'9') {if (c=='-') f=-1;c=getchar();}\n\twhile (c>='0'&&c<='9') {x=x*10+c-'0';c=getchar();}\n\tx*=f;\n}\ninline void readl(long long &x){\n\tint f=1;x=0;char c=getchar();\n\twhile (c<'0'||c>'9') {if (c=='-') f=-1;c=getchar();}\n\twhile (c>='0'&&c<='9') {x=x*10+c-'0';c=getchar();}\n\tx*=f;\n}\n//------------------\u4e0a\u8fb9\u662f\u4e00\u5927\u4e32\u5feb\u8bfb------------------\nconst long long mod=1e9;\nconst int maxn=75005;\nint head,tail;\nlong long k1,k2;\nstruct node{\n\tlong long x,y;\n\tnode(long long a=0,long long b=0){\n\t\tx=a;y=b;\n\t}\n\tnode operator +(const node a) const{return node(x+a.x,y+a.y);}\n\tnode operator -(const node a) const{return node(x-a.x,y-a.y);}\n};\nstruct yyy{\n\tint ls,rs;\n\tlong long sum1,sum2;\n}f[30000005];\nint root[maxn],cnt;\ninline int Update(int l,int r,int pre){\n\tint rt=++cnt;f[rt]=f[pre];\n\tif (l==r) {f[rt].sum1+=k1;f[rt].sum2+=k2;return rt;}\n\tf[rt].sum1+=k1;f[rt].sum2+=k2;\n\tint mid=l+r>>1;\n\tif (head<=mid) f[rt].ls=Update(l,mid,f[rt].ls);\n\telse f[rt].rs=Update(mid+1,r,f[rt].rs);\n\treturn rt;\n}\ninline node Query(int l,int r,int rt){\n\tif (head<=l&&r<=tail) return node(f[rt].sum1,f[rt].sum2);\n\tint mid=l+r>>1;node ans(0,0);\n\tif (head<=mid) ans=ans+Query(l,mid,f[rt].ls);\n\tif (tail>mid) ans=ans+Query(mid+1,r,f[rt].rs);\n\treturn ans;\n}\nint main(){\n//\tfreopen(\"1.in\",\"r\",stdin);\n\trg int i,x,y,xx,yy,a,b,n,m;\n\trg long long last=0,k;\n\trg node ans;\n\tread(n);\n\tfor (i=1;i<=n;i++){\n\t\tread(x);read(xx);read(y);read(a);read(b);read(yy);\n\t\thead=0;k1=0;k2=y;root[i]=Update(0,mod,root[i-1]);\n\t\thead=x+1;k1=a;k2=b-y;root[i]=Update(0,mod,root[i]);\n\t\thead=xx+1;k1=-a;k2=yy-b;root[i]=Update(0,mod,root[i]);\n\t}\n\tread(m);\n\tfor (i=1;i<=m;i++){\n\t\tnode ans(0,0);read(x);read(y);readl(k);k=(k+last)%mod;\n\t\thead=0;tail=k;ans=ans+Query(0,mod,root[y]);\n\t\tif (x) head=0,tail=k,ans=ans-Query(0,mod,root[x-1]);\n\t\tlast=ans.x*k+ans.y;\n\t\tprintf(\"%lld\\n\",last);\n\t}\n\treturn 0;\n}\n```\n\n## \u9898\u5916\u8bdd\n\n\u6bcf\u5929\u4e00\u4e2a\u7206\u96f6\u5c0f\u6280\u5de7\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/8e7dctht.png)",
        "postTime": 1597716638,
        "uid": 51569,
        "name": "\u8fdd\u89c4\u7528\u6237\u540dFkZyA0!2",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011 CF837G Functions On The Segments"
    },
    {
        "content": "\u6211\u4eec\u8003\u8651 $\\sum_{i=l}^r{f_i(x)}$ \u662f\u4e2a\u4ec0\u4e48\u4e1c\u897f\u3002\u9996\u5148\u8fd9\u4e2a\u5947\u602a\u7684\u4e1c\u897f\u5f88\u597d\u79bb\u7ebf\u505a\uff0c\u6240\u4ee5\u5c3d\u7ba1\u9898\u76ee\u8981\u6c42\u5f3a\u5236\u5728\u7ebf\uff0c\u6211\u4eec\u8fd8\u662f\u79bb\u7ebf\u4e0b\u6765\u8bd5\u8bd5\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5 $x$ \u5750\u6807\u4ece $1$ \u5230 $200000$ \u626b\u8fc7\u53bb\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $f_i$\uff0c\u5728 $x_{i,1}+1$ \u548c $x_{i,2}+1$ \u4e24\u4e2a\u4f4d\u7f6e\u6253\u6807\u8bb0\u8fdb\u884c\u66f4\u6539\u3002\u8fd9\u6837\u6574\u4e2a\u626b\u63cf\u8fc7\u7a0b\u5c31\u662f $O(k+n)$ \u7684\u3002\u7136\u540e\u8003\u8651\u7ef4\u62a4\u7b54\u6848\uff0c\u6211\u4eec\u53d1\u73b0\uff0c$y=y_1$ \u548c $y=y_2$ \u5176\u5b9e\u53ef\u4ee5\u5199\u6210 $y=0x+y_1,y=0x+y_2$ \u7684\u5f62\u5f0f\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u7684 $f_i(x)$ \u5c31\u53ef\u4ee5\u7edf\u4e00\u5199\u6210 $ax+b$ \u7684\u5f62\u5f0f\u3002\u5219 $\\sum_{i=l}^r{f_i(x)}=(\\sum_{i=l}^r{a_i})x+\\sum_{i=l}^r{b_i}$\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ea\u9700\u8981\u7ef4\u62a4 $a$ \u548c $b$ \u7684\u533a\u95f4\u548c\u3002\u6211\u4eec\u5206\u522b\u5f00\u4e24\u4e2a\u7ebf\u6bb5\u6811\u7ef4\u62a4 $a$ \u548c $b$ \u7684\u533a\u95f4\u548c\u3002\u6bcf\u6b21\u66f4\u6539\uff0c\u5c31\u5355\u70b9\u4fee\u6539\u4f4d\u7f6e $i$ \u4e0a\u9762\u7684 $a_i$ \u548c $b_i$\u3002\u7136\u540e\u6211\u4eec\u63d0\u524d\u628a\u6240\u6709\u7684\u8be2\u95ee\u6302\u5728\u81ea\u5df1\u7684 $x_i$ \u4e0a\uff0c\u5904\u7406\u5b8c\u5f53\u524d $x$ \u4e0a\u7684\u6240\u6709\u64cd\u4f5c\u4e4b\u540e\uff0c\u5bf9\u6240\u6709\u7684 $[l,r]$ \u8be2\u95ee\u8fdb\u884c\u67e5\u8be2\u5f97\u5230 $\\sum_{i=l}^r{a_i}$ \u548c $\\sum_{i=l}^r{b_i}$\u3002\n\n\u4f46\u662f\u73b0\u5728\u5f3a\u5236\u5728\u7ebf\uff0c\u600e\u4e48\u505a\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u8981\u6211\u4eec\u5b58\u50a8\u4e0b\u6bcf\u4e2a $x$ \u6240\u5bf9\u5e94\u7684 $a$ \u548c $b$ \u5e8f\u5217\uff0c\u5c31\u53ef\u4ee5\u6bcf\u6b21\u5feb\u901f\u5f97\u5230\u7b54\u6848\u3002\u4f46\u662f\u5b58\u50a8 $a$ \u548c $b$ \u663e\u7136\u4e0d\u73b0\u5b9e\uff0c\u6211\u4eec\u5c31\u8003\u8651\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u3002\u6211\u4eec\u627e\u5230\u539f\u5148\u7684\u6240\u6709\u64cd\u4f5c\uff1a\u5355\u70b9\u4fee\u6539\u3001\u533a\u95f4\u67e5\u8be2\uff0c\u8fd9\u6070\u597d\u662f\u53ef\u4ee5\u4f7f\u7528\u4e3b\u5e2d\u6811\u5b8c\u6210\u7684\u5de5\u4f5c\u3002\u53c8\u56e0\u4e3a\u662f\u9759\u6001\u7684\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u628a\u4e3b\u5e2d\u6811\u5904\u7406\u51fa\u6765\u4e4b\u540e\uff0c\u5e26\u5230\u8be2\u95ee\u91cc\u53bb\u8ba1\u7b97\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u5c0f\u7684\u95ee\u9898\uff0c\u8be2\u95ee\u65f6\u7684 $x$ \u662f\u53ef\u80fd\u8fbe\u5230 $10^9$ \u7684\uff0c\u5982\u4f55\u505a\u5462\uff1f\u6211\u4eec\u53d1\u73b0 $2\\cdot 10^5$ \u4e4b\u540e\u7684 $x$ \u90fd\u5df2\u7ecf\u5230\u4e86\u7b2c\u4e09\u9636\u6bb5\uff0c\u4e5f\u5c31\u662f $y=y_2$\uff0c\u53ef\u4ee5\u76f4\u63a5\u5904\u7406\u5176\u524d\u7f00\u548c\uff0c\u7136\u540e $O(1)$ \u8ba1\u7b97\u7b54\u6848\u3002\n\n\u6ce8\u610f\u6211\u4eec\u540c\u4e00\u4e2a $x$ \u4e0a\u53ef\u80fd\u6709\u5f88\u591a\u7684\u64cd\u4f5c\uff0c\u4e5f\u53ef\u80fd\u6ca1\u6709\u64cd\u4f5c\uff0c\u4e0d\u80fd\u628a $x$ \u4f5c\u4e3a\u4e3b\u5e2d\u6811\u7684\u65f6\u95f4\u8f74\uff0c\u800c\u5e94\u5f53\u5bf9\u6bcf\u4e2a $x$ \u4e0a\u7684\u6240\u6709\u64cd\u4f5c\u6267\u884c\u5b8c\u4e4b\u540e\uff0c\u8bb0\u5f55\u5f53\u524d\u4e3b\u5e2d\u6811\u7684\u6700\u65b0\u7248\u672c\u3002\n\n\u5982\u679c\u6211\u4eec\u8bb0 $k$ \u4e3a __\u66f4\u6539__ \u64cd\u4f5c\u4e2d\u51fa\u73b0\u7684\u6700\u5927 $x$\uff0c\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(k+(n+m)\\log n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\n#define rd(i,n) for(ll i=0;i<n;i++)\n#define rp(i,n) for(ll i=1;i<=n;i++)\n#define rep(i,a,b) for(ll i=a;i<=b;i++)\ntypedef long long ll;\nclass pst{\nprivate:\n\tll sum[10000005];\n\tint ls[10000005],rs[10000005],cnt,Len;\n\tint root[400005],Ti;\n\tinline void Init(int &i,int l,int r,int* a){\n\t\ti=++cnt;\n\t\tif(l==r){\n\t\t\tsum[i]=a[l];\n\t\t\treturn;\n\t\t}\n\t\tint mid=l+r>>1;\n\t\tInit(ls[i],l,mid,a);\n\t\tInit(rs[i],mid+1,r,a);\n\t\tsum[i]=sum[ls[i]]+sum[rs[i]];\n\t}\n\tinline void Modify(int &i,int his,int x,int v,int l,int r){\n\t\ti=++cnt;\n\t\tif(l==r){\n\t\t\tsum[i]=v;\n\t\t\treturn;\n\t\t}\n\t\tint mid=l+r>>1;\n\t\tif(x<=mid){\n\t\t\trs[i]=rs[his];\n\t\t\tModify(ls[i],ls[his],x,v,l,mid);\n\t\t}else{\n\t\t\tls[i]=ls[his];\n\t\t\tModify(rs[i],rs[his],x,v,mid+1,r);\n\t\t}\n\t\tsum[i]=sum[ls[i]]+sum[rs[i]];\n\t}\n\tinline ll Query(int i,int L,int R,int l,int r){\n\t\tif(!i)return 0;\n\t\tif(L<=l&&r<=R)return sum[i];\n\t\tint mid=l+r>>1;\n\t\tll res=0;\n\t\tif(ls[i]&&L<=mid)res+=Query(ls[i],L,R,l,mid);\n\t\tif(rs[i]&&R>mid)res+=Query(rs[i],L,R,mid+1,r);\n\t\treturn res;\n\t}\npublic:\n\tinline void init(int len,int* a){\n\t\tLen=len;\n\t\tInit(root[0],1,len,a);\n\t}\n\tinline void modify(int x,int v){\n\t\tint cnt=++Ti;\n\t\tModify(root[cnt],root[cnt-1],x,v,1,Len);\n\t}\n\tinline ll query(int ti,int l,int r){\n\t\treturn Query(root[ti],l,r,1,Len);\n\t}\n\tinline int curver(){\n\t\treturn Ti;\n\t}\n}ta,tb;\nconst int N=75005;\nconst int M=200000;\nconst int P=1000000000;\nint n,m,q,l,r,x,xl[N],xr[N],yl[N],yr[N],a[N],b[N],Empty[N];\nll sum[N];\nint vera[M+5],verb[M+5];\nvt<int>v1[M+5],v2[M+5];\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0);\n\tn=in();\n\trp(i,n)xl[i]=in(),xr[i]=in(),yl[i]=in(),a[i]=in(),b[i]=in(),yr[i]=in();\n\trp(i,n)v1[xl[i]+1].pb(i),v2[xr[i]+1].pb(i);\n\tta.init(n,Empty);tb.init(n,yl);\n\trep(ti,1,M){\n\t\tfor(auto j:v1[ti]){\n\t\t\tta.modify(j,a[j]);\n\t\t\ttb.modify(j,b[j]);\n\t\t}\n\t\tfor(auto j:v2[ti]){\n\t\t\tta.modify(j,0);\n\t\t\ttb.modify(j,yr[j]);\n\t\t}\n\t\tvera[ti]=ta.curver();\n\t\tverb[ti]=tb.curver();\n\t}\n\trp(i,n)sum[i]=sum[i-1]+yr[i];\n\tq=in();\n\tll ans=0;\n\trd(_,q){\n\t\tl=in(),r=in(),x=in();\n\t\tx=(x+ans)%P;\n\t\tif(x<=M){\n\t\t\tans=ta.query(vera[x],l,r)*x+tb.query(verb[x],l,r);\n\t\t}else{\n\t\t\tans=sum[r]-sum[l-1];\n\t\t}\n\t\tout(ans)('\\n');\n\t}\n\treturn 0;\n}\n//Crayan_r\n```",
        "postTime": 1676894641,
        "uid": 304222,
        "name": "jucason_xu",
        "ccfLevel": 0,
        "title": "CF837G"
    },
    {
        "content": "**\u89c2\u524d\u63d0\u793a\uff1a\u672c\u9898\u89e3\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u5361\u5e38\u3002**\n\n### Statement:\n\n\u7ed9\u5b9a $n$ \u4e2a\u5206\u6bb5\u51fd\u6570 $f_i(x)$ \u4e3a\uff1a\n$$f_i(x)=\\begin{cases}y_1,&x\\le x_1\\\\ax+b,&x_1<x\\le x_2\\\\y_2,&x>x_2\\end{cases}$$\n\u5176\u4e2d $x_1,x_2,y_1,y_2,a,b$ \u4e3a\u7ed9\u5b9a\u7684\u53c2\u6570\u3002\n\n$m$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa $l,r,x$\uff0c\u6c42 $\\sum\\limits_{i=l}^{r}f_i(x)$\uff0c**\u5f3a\u5236\u5728\u7ebf**\u3002\n\n$n\\leq 7.5\\times 10^4$\uff0c$x_1,x_2\\leq 2\\times 10^5$\uff0c$x,y_1,y_2\\leq 10^9$\uff0c$a,b\\leq 10^4$\uff0c$m\\leq 5\\times 10^5$\uff0c$1\\leq l\\leq r\\leq n$\u3002 \n\n### Solution:\n\u6811\u5957\u6811\u3002\n\n\u5148\u8003\u8651\u8fd9\u4e2a\u5206\u6bb5\u51fd\u6570\uff0c\u5bb9\u6613\u53d1\u73b0\u6bcf\u4e00\u6bb5\u90fd\u80fd\u8868\u793a\u6210 $kx+b$ \u7684\u5f62\u5f0f\uff0c\u5982\u4e0b\uff1a\n$$f_i(x)=\\begin{cases}0\\times x+y_1,&x\\le x_1\\\\a\\times x+b,&x_1<x\\le x_2\\\\0\\times x+y_2,&x>x_2\\end{cases}$$\n\n\u7b54\u6848\u5177\u6709\u53ef\u5dee\u5206\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u7528\u8003\u8651 $l=1$ \u7684\u60c5\u51b5\uff0c\u5bb9\u6613\u53d1\u73b0\uff1a\n$$\\sum\\limits_{i=1}^{r}{f_i(x)}=\\sum\\limits_{i=1}^{r}{(a_ix+b_i)}=\\sum\\limits_{i=1}^{r}{a_i\\times x}+\\sum\\limits_{i=1}^{r}b_i$$\n\n\u5185\u5c42\u9884\u5904\u7406\u5206\u6bb5\u51fd\u6570\u9700\u8981\u533a\u95f4\u52a0\uff0c\u8be2\u95ee\u9700\u8981\u5355\u70b9\u67e5 $\\sum\\limits{a}$ \u548c $\\sum\\limits{b}$\uff0c\u7ebf\u6bb5\u6811\u53ef\u4ee5\u89e3\u51b3\u3002\u5916\u5c42\u8981\u7ef4\u62a4\u524d\u7f00\u7ebf\u6bb5\u6811\uff0c\u56e0\u6b64\u9700\u8981\u5957\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)\\log n\\log X)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\log n\\log X)$\uff0c\u5176\u4e2d $X$ \u4e3a $x_1,x_2$ \u503c\u57df\u3002\n\n\u559c\u63d0\u6700\u52a3\u89e3\u3002\n\n[Code](https://www.luogu.com.cn/paste/5e1krt9c)\u3002\n\n",
        "postTime": 1642166785,
        "uid": 425007,
        "name": "Kappa6174",
        "ccfLevel": 7,
        "title": "\u9898\u89e3\u3010CF837G\u3011"
    }
]