[
    {
        "content": "\u6211\u4eec\u53d1\u73b0\uff0c\u901a\u8fc7\u6bcf\u4e2a\u73af\u7684\u5408\u6cd5\u8def\u5f84\u6570\u90fd\u6709\u4e24\u79cd\u3002\u8bbe\u4ece $x$ \u5230 $y$ \u7684\u8def\u5f84\u4e0a\u6709 $d$ \u4e2a\u73af\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f $2^d$\u3002\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u4e24\u70b9\u8def\u5f84\u95f4\u6709\u591a\u5c11\u4e2a\u73af\u3002\n\n\u6211\u4eec\u8003\u8651\u7f29\u8fb9\u53cc\u3002\u7531\u4e8e\u9898\u76ee\u4fdd\u8bc1\u56fe\u662f\u4e00\u4e2a\u70b9\u4ed9\u4eba\u638c\uff0c\u56e0\u6b64\u7f29\u5b8c\u56fe\u4e4b\u540e\u4e00\u5b9a\u662f\u4e00\u68f5\u6811\u3002\u6b64\u65f6\u6211\u4eec\u53ea\u9700\u8981\u6c42\u4e24\u70b9\u7684\u6811\u4e0a\u8ddd\u79bb\u5373\u53ef\u3002\n\n\u7528 LCA \u7ef4\u62a4\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n+m+q\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int mod = 1e9 + 7;\nint n, m, q;\nint head[100005];\nint u[1000005], v[1000005], nxt[1000005];\nint low[100005], dfn[100005];\nbool cut[1000005];\nint dcc[100005], size[100005];\nint tot = 1, cnt, lza;\nvector<int> a[100005];\nint f[100005], dep[100005];\nint nmsl[100005], son[100005];\nint top[100005];\nint len[100005];\nvoid add(int x, int y) {\n\ttot++;\n\tu[tot] = x; v[tot] = y; \n\tnxt[tot] = head[x]; head[x] = tot;\n}\nvoid dfs(int ed, int x) {\n\tlow[x] = dfn[x] = ++cnt;\n\tfor (int i = head[x]; i; i = nxt[i]) {\n\t\tint y = v[i];\n    \tif (!dfn[y]) {\n    \t\tdfs(i, y); low[x] = min(low[x], low[y]);\n    \t\tif (dfn[x] < low[y]) cut[i] = cut[i ^ 1] = 1;\n    \t} else if (i != (ed ^ 1)) low[x] = min(low[x], dfn[y]);\n\t}\n} \nvoid dfs2(int x, int cnt) {\n\tdcc[x] = cnt; size[cnt]++;\n    for (int i = head[x]; i; i = nxt[i]) {\n    \tint y = v[i];\n    \tif (dcc[y] || cut[i]) continue;\n    \tdfs2(y, cnt);\n    }\n}//\u7f29\u8fb9\u53cc\nvoid dfs1(int fa, int x) {\n\tf[x] = fa; dep[x] = dep[fa] + 1; len[x] = len[fa] + (size[x] > 1); nmsl[x] = 1;\n\tfor (int i = 0; i < a[x].size(); i++) {\n\t\tint y = a[x][i];\n\t\tif (y == fa) continue;\n\t\tdfs1(x, y);\n\t\tnmsl[x] += nmsl[y];\n\t\tif (son[x] == 0 || nmsl[son[x]] < nmsl[y]) son[x] = y;\n\t}\n}\nvoid dfs3(int x, int t) {\n\ttop[x] = t;\n\tif (son[x] == 0) return;\n\tdfs3(son[x], t);\n\tfor (int i = 0; i < a[x].size(); i++) {\n\t\tint y = a[x][i];\n\t\tif (y == f[x] || y == son[x]) continue;\n\t\tdfs3(y, y);\n\t}\n}//\u9884\u5904\u7406\u6811\u5256\u6c42LCA\nint ask(int x, int y) {\n    while (top[x] != top[y]) {\n    \tif (dep[top[x]] < dep[top[y]]) swap(x, y);\n    \tx = f[top[x]];\n\t}\n\treturn dep[x] < dep[y] ? x : y;\n}\nll power(int a, int b) {\n\tll res = 1;\n\twhile (b) {\n\t\tif (b & 1) res = 1ll * res * a % mod;\n\t\ta = 1ll * a * a % mod; b >>= 1;\n\t}\n\treturn res;\n}\nint main() {\n\tcin >> n >> m;\n\tfor (int i = 1; i <= m; i++) {\n\t\tint u, v; cin >> u >> v;\n\t\tadd(u, v); add(v, u);\n\t}\n\tfor (int i = 1; i <= n; i++)\n\t    if (!dfn[i]) dfs(0, i);\n\tfor (int i = 1; i <= n; i++)\n\t    if (!dcc[i])\n\t        dfs2(i, ++lza);\n\tfor (int i = 1; i <= n; i++)\n\t    for (int j = head[i]; j; j = nxt[j]) {\n\t    \tint x = v[j];\n        \tif (dcc[i] != dcc[x]) a[dcc[i]].push_back(dcc[x]);\n    \t}\n\tdfs1(0, 1); dfs3(1, 1);\n\tcin >> q;\n\tfor (int i = 1; i <= q; i++) {\n\t\tint x, y; cin >> x >> y; x = dcc[x], y = dcc[y];\n\t\tint lca = ask(x, y);\n\t\tcout << power(2, len[x] + len[y] - len[lca] * 2 + (size[lca] > 1)) << endl;//\u7531\u4e8e\u6c42\u7684\u662f\u70b9\u6743\u548c\uff0c\u56e0\u6b64\u7279\u5224lca\u8fd9\u4e2a\u70b9\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1634538961,
        "uid": 305027,
        "name": "Tarantula",
        "ccfLevel": 6,
        "title": "CF231E Cactus \u9898\u89e3"
    },
    {
        "content": "# Codeforces 231E\n\n## Solution\n\n\u628a\u6240\u6709\u73af\u7f29\u4e00\u4e0b\uff0c\u8bb0 $u,v$ \u8def\u5f84\u4e0a\u539f\u672c\u662f\u73af\u7684\u70b9\u7684\u6570\u91cf\u4e3a $d$\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f $2^d$\u3002\n\n\u7f29\u70b9\u53ef\u4ee5\u7528\u8fb9\u53cc\uff0c\u7f29\u5b8c\u4e4b\u540e\u662f\u68f5\u6811\uff0c\u76f4\u63a5\u500d\u589e LCA \u5373\u53ef\u3002\n\n~~\u4e00\u904d\u8fc7\u5de5\u7a0b\u9898\u7684\u611f\u89c9\u771f\u723d~~\n\n## Code\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<queue>\n#include<cmath>\nusing namespace std;\nconst int N=2e5+10,M=2e5+10;\nint Head[N],Ver[M],Nxt[M],Tot=1;\nvoid Add(int x,int y)\n{\n\tVer[++Tot]=y;\n\tNxt[Tot]=Head[x];\n\tHead[x]=Tot; \n}\nbool bridge[M];\nint dfn[N],low[N],num=0;\nvoid tarjan(int x,int in)\n{\n\tdfn[x]=low[x]=++num;\n\tfor(int i=Head[x];i;i=Nxt[i])\n\t{\n\t\tint y=Ver[i];\n\t\tif(!dfn[y])\n\t\t{\n\t\t\ttarjan(y,i);\n\t\t\tlow[x]=min(low[x],low[y]);\n\t\t\tif(low[y]>dfn[x])\n\t\t\t\tbridge[i]=bridge[i^1]=1;\n\t\t}\n\t\telse if(i!=(in^1))\n\t\t\tlow[x]=min(low[x],dfn[y]);\n\t}\n}\nint col[N],cont[N],dis[N];\nvoid dfs(int x,int c)\n{\n\tcont[c]++;\n\tcol[x]=c;\n\tfor(int i=Head[x];i;i=Nxt[i])\n\t{\n\t\tint y=Ver[i];\n\t\tif(bridge[i]||col[y])continue;\n\t\tdfs(y,c);\n\t}\n}\nint head[N],ver[M],nxt[M],tot=0;\nvoid add(int x,int y)\n{\n\tver[++tot]=y;\n\tnxt[tot]=head[x];\n\thead[x]=tot;\n}\nvoid dfs1(int x,int f)\n{\n\tdis[x]+=(cont[x]>1);\n\tfor(int i=head[x];i;i=nxt[i])\n\t{\n\t\tint y=ver[i];\n\t\tif(y==f)continue;\n\t\tdis[y]=dis[x];\n\t\tdfs1(y,x);\n\t}\n}\nbool vis[N];int dep[N],fa[N][30],t;\nvoid bfs()\n{\n\tqueue<int> que;\n\tque.push(1);\n\tvis[1]=1;\n\tdep[1]=1;\n\twhile(!que.empty())\n\t{\n\t\tint x=que.front();que.pop();\n\t\tfor(int i=head[x];i;i=nxt[i])\n\t\t{\n\t\t\tint y=ver[i];\n\t\t\tif(vis[y])continue;\n\t\t\tdep[y]=dep[x]+1;\n\t\t\tfa[y][0]=x;\n\t\t\tfor(int j=1;j<=t;j++)fa[y][j]=fa[fa[y][j-1]][j-1];\n\t\t\tvis[y]=1;\n\t\t\tque.push(y);\n\t\t}\n\t}\n}\nint lca(int x,int y)\n{\n\tif(dep[x]<dep[y]) swap(x,y);\n\tfor(int i=t;i>=0;i--)\n\t\tif(dep[fa[x][i]]>=dep[y])\n\t\t\tx=fa[x][i];\n\tif(x==y) return x;\n\tfor(int i=t;i>=0;i--)\n\t\tif(fa[x][i]!=fa[y][i])\n\t\t\tx=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}\nint qpow(int a,int n)\n{\n\ta%=1000000007; int ans=1;\n\twhile(n)\n\t{\n\t\tif(n&1)ans=(long long)ans*a%1000000007;\n\t\ta=(long long)a*a%1000000007;\n\t\tn>>=1; \n\t}\n\treturn ans;\n}\nint main()\n{\n\tint n,m;scanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u,v;scanf(\"%d%d\",&u,&v);\n\t\tAdd(u,v);Add(v,u);\n\t}\n\ttarjan(1,-1);\n\tint cnt=0;\n\tfor(int i=1;i<=n;i++)\n\t\tif(!col[i])\n\t\t\tdfs(i,++cnt); \n\tt=(int)(log(n)/log(2))+1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=Head[i];j;j=Nxt[j])\n\t\t\tif(col[i]!=col[Ver[j]])\n\t\t\t\tadd(col[i],col[Ver[j]]);\n\tdfs1(1,0);\n\tbfs();\n\tint q;scanf(\"%d\",&q);\n\twhile(q--)\n\t{\n\t\tint x,y;scanf(\"%d%d\",&x,&y);\n\t\tint l=lca(col[x],col[y]);\n\t\tprintf(\"%d\\n\",\n\t\tqpow(2,dis[col[x]]+dis[col[y]]-dis[l]-dis[fa[l][0]]));\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1618225521,
        "uid": 125913,
        "name": "zztqwq",
        "ccfLevel": 8,
        "title": "Codeforces 231E"
    },
    {
        "content": "\u5148\u5c06\u4ed9\u4eba\u638c\u7528 `tarjan` \u7f29\u70b9\u4e3a\u4e00\u68f5\u6811.\n\n\u5bf9\u4e8e\u6811\u4e0a\u7684\u8282\u70b9 `u`, \u82e5\u5b83\u7531\u591a\u4e2a\u70b9\u7f29\u6210, \u90a3\u4e48, \u7ecf\u8fc7 `u` \u65f6, \u7b80\u5355\u8def\u5f84\u7684\u6761\u6570\u4f1a\u7ffb\u500d, \u5426\u5219\u6ca1\u6709\u53d8\u5316.\n\n\u7ef4\u62a4 `w[u]` \u8868\u793a \u4ece\u70b9 `u` \u5230\u6839\u5171\u6709\u591a\u5c11\u4e2a\u70b9 `v` \u7531\u591a\u4e2a\u70b9\u7f29\u6210, \u8fd9\u7528\u6811\u4e0a\u524d\u7f00\u548c\u7ef4\u62a4\u5373\u53ef.\n\n\u5bf9\u4e8e\u6811\u4e0a\u7684\u70b9 `u`, `v`, \u4ed6\u4eec\u7684\u8ddd\u79bb\u4e3a `dep[u] + dep[v] - dep[lca(u, v)] * 2`.\n\n\u540c\u7406, \u4ed6\u4eec\u4e4b\u95f4\u7b80\u5355\u8def\u5f84\u7684\u6761\u6570\u4e3a `2 ^ (w[u] + w[v] - w[lca(u, v)] * 2 + (size[lca(u, v)] > 1))`. \n\n(\u7531\u4e8e `w[u]` \u4e3a\u70b9\u6743, `- w[lca(u, v)] * 2` \u65f6\u628a `lca(u, v)` \u7684\u6743\u503c\u6361\u4e86\u4e24\u6b21, \u8981\u52a0\u4e0a `lca(u, v)` \u672c\u8eab)\n\n```cpp\n#include <bits/stdc++.h>\n\n#define null               \"\"\n#define endl               '\\n'\n#define all(dat)           dat.begin(), dat.end()\n#define over(msg)          cout << msg << endl, exit(0);\n#define loop(i, to)        for (int i = 0; i < to; ++i)\n#define cont(i, to)        for (int i = 1; i <= to; ++i)\n#define circ(i, fr, to)    for (int i = fr; i <= to; ++i)\n#define foreach(i, dat)    for (__typeof(dat.begin()) i = dat.begin(); i != dat.end(); ++i)\n\ntypedef long long          num;\n\nusing namespace std;\n\nconst int logsize = 18;\nint n, m, q, rt = 1, t, sc, vis[100005], dfn[100005], low[100005], sid[100005], sz[100005], dep[100005], pr[100005][logsize], w[100005], mod = 1e9 + 7;\nstack<int> s;\nvector<int> g[100005], ng[100005];\n\nint inline read() {\n    int res = 0;\n    char c = getchar();\n    for (; !isdigit(c); c = getchar());\n    for (; isdigit(c); res *= 10, res += c ^ 48, c = getchar());\n    return res;\n}\n\n// tarjan \u6c42\u5f3a\u8fde\u901a\u5206\u91cf, \u5c06\u4ed9\u4eba\u638c\u7684\u73af\u7f29\u4e3a\u4e00\u70b9.\nvoid tarjan(int u, int p) {\n    dfn[u] = low[u] = ++t;\n    vis[u] = 1;\n    s.push(u);\n    for (int v : g[u]) {\n        if (v == p || vis[v] == 2)  continue;\n        if (!vis[v]) {\n            tarjan(v, u);\n        }\n        low[u] = min(low[u], low[v]);\n    }\n    if (dfn[u] == low[u]) {\n        ++sc;\n        for (;;) {\n            int v = s.top();\n            s.pop();\n            vis[v] = 2;\n            sid[v] = sc;\n            ++sz[sc];\n            if (u == v)  break;\n        }\n    }\n}\n\nvoid dfs(int u, int p) {\n    dep[u] = u == rt ? 0 : dep[p] + 1;\n    w[u] = u == rt ? sz[u] > 1 : w[p] + (sz[u] > 1);\n    pr[u][0] = p;\n    for (int v : ng[u]) {\n        if (v == p)  continue;\n        dfs(v, u);\n    }\n}\n\n// \u4ee5 rt \u4e3a\u6839\u904d\u5386\u6811, \u5efa\u7acb\u500d\u589e\u8868.\nvoid inline init() {\n    dfs(rt, -1);\n    cont (i, logsize - 1) {\n        cont (u, sc) {\n            int p = pr[u][i - 1];\n            if (p == -1) {\n                pr[u][i] = -1;\n            } else {\n                pr[u][i] = pr[p][i - 1];\n            }\n        }\n    }\n}\n\n// \u500d\u589e\u6c42 u, v \u7684 lca.\nint inline lca(int u, int v) {\n    if (dep[u] > dep[v]) {\n        swap(u, v);\n    }\n    loop (i, logsize) {\n        if ((dep[v] - dep[u]) >> i & 1) {\n            v = pr[v][i];\n        }\n    }\n    if (u == v)  return u;\n    for (int i = logsize - 1; i >= 0; --i) {\n        if (pr[u][i] != pr[v][i]) {\n            u = pr[u][i];\n            v = pr[v][i];\n        }\n    }\n    return pr[u][0];\n}\n\n// \u5feb\u901f\u5e42.\nint inline qpow(num a, int p) {\n    num res = 1;\n    while (p) {\n        if (p & 1) {\n            res *= a;\n            res %= mod;\n        }\n        a *= a;\n        a %= mod;\n        p >>= 1;\n    }\n    return res % mod;\n}\n\nint main() {\n    ios_base::sync_with_stdio(0);\n    n = read();\n    m = read();\n    cont (i, m) {\n        int u = read(), v = read();\n        g[u].push_back(v);\n        g[v].push_back(u);\n    }\n    \n    // tarjan \u7f29\u70b9\u5e76\u5efa\u6811.\n    cont (u, n) {\n        if (!vis[u]) {\n            tarjan(u, -1);\n        }\n    }\n    cont (u, n) {\n        for (int v : g[u]) {\n            int su = sid[u], sv = sid[v];\n            if (su == sv)  continue;\n            ng[su].push_back(sv);\n        }\n    }\n    \n    // \u7528\u500d\u589e\u6cd5\u6c42 lca, \u5e76\u6c42\u5f97\u7b54\u6848.\n    init();\n    q = read();\n    cont (i, q) {\n        int u = read(), v = read(), su = sid[u], sv = sid[v], sp = lca(su, sv);\n        int d = w[su] + w[sv] - w[sp] * 2 + (sz[sp] > 1);\n        cout << qpow(2, d) << endl;\n    }\n}\n\n```\n",
        "postTime": 1551698957,
        "uid": 64329,
        "name": "shurongwang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF231E \u3010Cactus\u3011"
    }
]