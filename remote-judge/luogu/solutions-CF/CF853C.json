[
    {
        "content": "\u7b80\u5355\u5bb9\u65a5\u3002\n\n\u89c2\u5bdf\u4e00\u4e0b\u4e0d\u96be\u53d1\u73b0\u7b54\u6848\u4e3a\u603b\u65b9\u6848\u6570$\\dfrac{N(N+1)}{2}$\uff0c\u51cf\u53bb\u5728\u77e9\u5f62\u4e00\u8fb9\u7684\u8d21\u732e\uff0c\u518d\u52a0\u4e0a\u5728\u77e9\u5f62\u4e00\u89d2\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u53ea\u8003\u8651\u5728\u77e9\u5f62\u5de6\u8fb9\u548c\u5728\u77e9\u5f62\u5de6\u4e0b\u89d2\u7684\u8d21\u732e\u3002\n\n\u7531\u4e8e\u662f\u4e2a\u6392\u5217\uff0c\u77e9\u5f62\u5de6\u8fb9\u7684\u8d21\u732e\u5c31\u662f$\\dfrac{(l-1)(l-2)}{2}$\u3002\n\n\u77e9\u5f62\u53f3\u4e0b\u89d2\u662f\u4e2a\u6a21\u677f\u4e8c\u7ef4\u6570\u70b9\uff0c\u79bb\u7ebf\u6811\u72b6\u6570\u7ec4\u5373\u53ef\u3002\n\n\u6211\u4eec\u8981\u6c42\u56db\u8fb9\u548c\u56db\u89d2\u7684\u8d21\u732e\uff0c\u53ea\u7528\u5c06\u6574\u4e2a\u7f51\u683c\u8fdb\u884c\u56db\u6b21\u65cb\u8f6c$90$\u00b0\uff0c\u7136\u540e\u7edf\u8ba1\u8d21\u732e\u5373\u53ef\u3002\n\n$\\rm O((N+M)\\log N)$\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 200005\nusing namespace std;\nint a[N],c[N],n,m,T,b[N];long long ans[N];\nstruct node{\n\tint op,x,y,l,r;\n\tbool operator<(const node o)const{return l<o.l;}\n}u[N];\ninline void add(int x){for(;x<=n;x+=x&-x)c[x]++;}\ninline int ask(int x){int sum=0;for(;x;x-=x&-x)sum+=c[x];return sum;}\nvoid calc(){\n\tsort(u+1,u+m+1);int j=1;\n\tmemset(c,0,sizeof(c));\n\trep(i,1,n){\n\t\twhile(j<=m&&u[j].l==i){\n\t\t\tint cur=ask(u[j].x-1);\n\t\t\tans[u[j].op]+=1LL*cur*(cur-1)/2-1LL*(i-1)*(i-2)/2;\n\t\t\tj++;\n\t\t}\n\t\tadd(a[i]);\n\t}\n}\nvoid rev(){\n\trep(i,1,n)b[a[i]]=n+1-i;\n\trep(i,1,n)a[i]=b[i];\n\trep(i,1,m){\n\t\tint x=u[i].x,y=u[i].y;\n\t\tu[i].x=n+1-u[i].r,u[i].y=n+1-u[i].l;\n\t\tu[i].l=x,u[i].r=y;\n\t}\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\trep(i,1,n)scanf(\"%d\",&a[i]);\n\trep(i,1,m)scanf(\"%d%d%d%d\",&u[i].l,&u[i].x,&u[i].r,&u[i].y),u[i].op=i,ans[i]=1LL*(n-1)*n/2;\n\tcalc();rev();\n\tcalc();rev();\n\tcalc();rev();\n\tcalc();\n\trep(i,1,m)printf(\"%lld \\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1616291390,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "CF853C Boredom\u9898\u89e3"
    },
    {
        "content": "\u5148\u8003\u8651 $1$ \u7ec4\u8be2\u95ee\u7684\u60c5\u51b5\u3002\n\n\u76f4\u63a5\u7b97\u5408\u6cd5\u65b9\u6848\u4e0d\u597d\u7b97\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5bb9\u65a5\u3002\n\n\u6ce8\u610f\u5230\u9898\u9762\u4e2d $\\texttt{no two marked squares share the same row or the same column}$\uff0c\u7ffb\u8bd1\u6210\u4e2d\u6587\u5c31\u662f**\u6ca1\u6709\u4e24\u4e2a\u88ab\u6807\u8bb0\u7684\u683c\u5b50\u5728\u540c\u4e00\u884c\u6216\u540c\u4e00\u5217**\uff0c\u8fd9\u662f\u89e3\u51b3\u95ee\u9898\u7684\u5173\u952e\u3002\n\n\u7b54\u6848 $=$ \u603b\u65b9\u6848 $-$ \u4e0d\u5408\u6cd5\u65b9\u6848\u3002\n\n\u8bb0 $s(n)$ \u4e3a $n$ \u4e2a\u4e0d\u5728\u540c\u4e00\u884c\u540c\u4e00\u5217\u7684\u70b9\u6784\u6210\u7684\u77e9\u5f62\u6570\u91cf\uff0c\u663e\u7136~~\u4ece\u9898\u9762\u4e2d\u5f97\u77e5~~ $n\\times (n-1)/2$\u3002\n\n**\u603b\u65b9\u6848**\u5f88\u7b80\u5355\uff0c\u5c31\u662f $s(n)$\u3002\n\n\u4e0d\u5408\u6cd5\u65b9\u6848\u53ea\u6709**\u56db\u79cd\u60c5\u51b5**\uff0c\u5206\u522b\u662f\u77e9\u5f62\u4e24\u4e2a\u89d2\u90fd\u5728\u7ed9\u5b9a\u65b9\u4f4d\u4e0a\u9762\uff0c\u4e0b\u9762\uff0c\u5de6\u8fb9\uff0c\u53f3\u8fb9\u3002\n\n\u8bb0\u4e0a\u9762\u7684\u70b9\u6709 $n_1$ \u4e2a\uff0c\u5de6\u8fb9\u7684\u70b9\u6709 $n_2$ \u4e2a\uff0c\u53f3\u8fb9\u7684\u70b9\u6709 $n_3$ \u4e2a\uff0c\u4e0b\u9762\u7684\u70b9\u6709 $n_4$ \u4e2a\uff0c\u5219\u7b54\u6848\u4e3a $s(n_1)+s(n_2)+s(n_3)+s(n_4)$\u3002\n\n\u8003\u8651\u5230\u5982\u679c\u77e9\u5f62\u7684\u4e24\u4e2a\u89d2\u90fd\u5728\u5de6\u4e0a\u6216\u5de6\u4e0b\u6216\u53f3\u4e0a\u6216\u53f3\u4e0b\uff0c\u5219\u4f1a**\u8ba1\u7b97\u4e24\u6b21**\uff0c\u6240\u4ee5\u8bb0\u5de6\u4e0a\u7684\u70b9\u6709 $n_5$ \u4e2a\uff0c\u5de6\u4e0b\u7684\u70b9\u6709 $n_6$ \u4e2a\uff0c\u53f3\u4e0a\u7684\u70b9\u6709 $n_7$ \u4e2a\uff0c\u53f3\u4e0b\u7684\u70b9\u6709 $n_8$ \u4e2a\uff0c\u5219\u7b54\u6848\u8fd8\u9700\u8981\u51cf\u53bb $s(n_5)+s(n_6)+s(n_7)+s(n_8)$\u3002\n\n\u6240\u4ee5\u603b\u7b54\u6848\u5c31\u662f $s(n)-( s(n_1)+s(n_2)+s(n_3)+s(n_4)-(s(n_5)+s(n_6)+s(n_7)+s(n_8)))$\n\n$n,n_1,n_2,n_3,n_4$ \u90fd\u53ef\u4ee5 $O(1)$ \u8ba1\u7b97\uff0c\u53ef\u662f $n_5,n_6,n_7,n_8$ \u90fd\u9700\u8981 $O(n)$\u3002\n\n\u8003\u8651\u5c06\u8be2\u95ee\u79bb\u7ebf\uff0c\u53ef\u4ee5\u4f7f\u7528 $\\texttt{BIT}$\uff0c\u5c06\u603b\u590d\u6742\u5ea6\u4f18\u5316\u5230 $O((n+q)\\log n)$\u3002\u867d\u7136\u5e26\u6709 $4$ \u500d\u5e38\u6570\uff0c\u5373\u8981\u5206\u522b\u8ba1\u7b97 $s_5,s_6,s_7,s_8$ \u5171\u8ba1 $4$ \u6b21\uff0c\u4f46\u662f $n,q$ \u53ea\u6709 $2\\times 10^5$\uff0c\u65f6\u9650 $2s$ \u5e76\u4e14 $\\texttt{codeforces}$ \u7684\u673a\u5668\u8dd1\u5f97\u975e\u5e38\u5feb\uff0c\u4e0d\u9700\u8981\u5361\u5e38\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff0c\u5199\u5f97\u5f88\u4e11\uff0c\u6ce8\u610f\u8bfb\u5165\u683c\u5f0f\uff1a\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<utility>\n#include<algorithm> \nstruct node\n{\n\tint lft,rgt,lst,fst;\n};\nstruct bit\n{\n\tint n,s[600005];\n\tint lowbit(int x){return x&(-x);}\n\tint query(int x){int ans=0;for (;x>=1;x=x-lowbit(x)) ans=ans+s[x];return ans;}\n\tvoid add(int x,int y){for (;x<=n;x=x+lowbit(x)) s[x]=s[x]+y;}\n\tint full(int x,int y){return query(y)-query(x-1)==y-x+1;}\n\tvoid clear(){for (int i=1;i<=n;i++) s[i]=0;n=0;}\n};\nbit t;\nnode g[200005];\nint n,q,s[200005],s1[200005],s2[200005],s3[200005],s4[200005];\nlong long ans[200005];\nstd::pair<std::pair<int,int>,int> f[200005];\nint main()\n{\n\tscanf(\"%d%d\",&n,&q);\n\tfor (int i=1;i<=n;i++) scanf(\"%d\",&s[i]);\n\tfor (int i=1;i<=q;i++) scanf(\"%d%d%d%d\",&g[i].lst,&g[i].lft,&g[i].fst,&g[i].rgt);\n\tfor (int i=1;i<=q;i++) ans[i]=ans[i]+1ll*(g[i].lft-1)*(g[i].lft-2)/2+1ll*(n-g[i].rgt)*(n-g[i].rgt-1)/2;\n\tfor (int i=1;i<=q;i++) ans[i]=ans[i]+1ll*(g[i].lst-1)*(g[i].lst-2)/2+1ll*(n-g[i].fst)*(n-g[i].fst-1)/2;\n\tt.clear();t.n=n;\n\tfor (int i=1;i<=q;i++) f[i]=std::make_pair(std::make_pair(g[i].fst+1,g[i].lft-1),i);\n\tstd::stable_sort(f+1,f+q+1);std::reverse(f+1,f+q+1);\n\tint x;\n\tx=1;\n\tfor (int i=n+1;i>=0;i--)\n\t{\n\t\tif (i!=n+1&&i!=0) t.add(s[i],1);\n\t\tfor (;x<=q;x++)\n\t\t{\n\t\t\tif (f[x].first.first<i) break;\n\t\t\tint y=t.query(f[x].first.second);\n\t\t\ts1[f[x].second]=y;\n\t\t}\n\t}\n\tt.clear();t.n=n;\n\tfor (int i=1;i<=q;i++) f[i]=std::make_pair(std::make_pair(g[i].fst+1,g[i].rgt+1),i);\n\tstd::stable_sort(f+1,f+q+1);std::reverse(f+1,f+q+1);\n\tx=1;\n\tfor (int i=n+1;i>=0;i--)\n\t{\n\t\tif (i!=n+1&&i!=0) t.add(s[i],1);\n\t\tfor (;x<=q;x++)\n\t\t{\n\t\t\tif (f[x].first.first<i) break;\n\t\t\tint y=t.query(n)-t.query(f[x].first.second-1);\n\t\t\ts2[f[x].second]=y;\n\t\t}\n\t}\n//\treturn 0;\n\tt.clear();t.n=n;\n\tfor (int i=1;i<=q;i++) f[i]=std::make_pair(std::make_pair(g[i].lst-1,g[i].lft-1),i);\n\tstd::stable_sort(f+1,f+q+1);\n\tx=1;\n\tfor (int i=0;i<=n+1;i++)\n\t{\n\t\tif (i!=n+1&&i!=0) t.add(s[i],1);\n\t\tfor (;x<=q;x++)\n\t\t{\n\t\t\tif (f[x].first.first>i) break;\n\t\t\tint y=t.query(f[x].first.second);\n\t\t\ts3[f[x].second]=y;\n\t\t}\n\t}\n\tt.clear();t.n=n;\n\tfor (int i=1;i<=q;i++) f[i]=std::make_pair(std::make_pair(g[i].lst-1,g[i].rgt+1),i);\n\tstd::stable_sort(f+1,f+q+1);\n\tx=1;\n\tfor (int i=0;i<=n+1;i++)\n\t{\n\t\tif (i!=n+1&&i!=0) t.add(s[i],1);\n\t\tfor (;x<=q;x++)\n\t\t{\n\t\t\tif (f[x].first.first>i) break;\n\t\t\tint y=t.query(n)-t.query(f[x].first.second-1);\n\t\t\ts4[f[x].second]=y;\n\t\t}\n\t}\n\tfor (int i=1;i<=q;i++) ans[i]=ans[i]-1ll*s1[i]*(s1[i]-1)/2-1ll*s2[i]*(s2[i]-1)/2-1ll*s3[i]*(s3[i]-1)/2-1ll*s4[i]*(s4[i]-1)/2;\n\tfor (int i=1;i<=q;i++) printf(\"%lld\\n\",1ll*n*(n-1)/2-ans[i]);\n\treturn 0;\n}\n```\n\n\u8dd1\u4e86 $11.15s$ \u5728\u76ee\u524d\u7684 $20$ \u4efd $\\texttt{AC}$ \u8bb0\u5f55\u4e2d\u6392\u540d\u7b2c $5$\u3002",
        "postTime": 1607253846,
        "uid": 36957,
        "name": "RainFestival",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF853C \u3010Boredom\u3011"
    }
]