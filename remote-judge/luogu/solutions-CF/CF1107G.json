[
    {
        "content": "[$$\\large \\color{purple} My \\; Blog$$](https://www.cnblogs.com/p-b-p-b/p/10434287.html)\n\n--------------\n\n### \u6211\u7adf\u7136\u80fd\u5728\u6709\u751f\u4e4b\u5e74\u8e29\u6807\u7b97\uff01\uff01\uff01\n\n----------------\n\n## \u601d\u8def\n\n\u9996\u5148\u8003\u8651\u66b4\u529b\uff1a\u679a\u4e3e\u5de6\u53f3\u7aef\u70b9\u76f4\u63a5\u8ba1\u7b97\u3002\n\n\u8003\u8651\u8bb0\u5f55$sum_x=\\sum_{i=1}^x c_i$\uff0c\u8bbe\u9009$[l,r]$\u65f6\u90a3\u4e2a\u5947\u602a\u4e1c\u897f\u7684\u5e73\u65b9\u4e3a$f(l,r)$\uff0c\u4f7f\u52b2\u63a8\u5f0f\u5b50\uff1a\n\n$$ans_{l,r}=(r-l+1)\\times a-sum_r+sum_{l-1}-f(l,r)$$\n$$ans_{l,r}+l\\times a-a-sum_{l-1}=r\\times a-sum_r-f(l,r)$$\n$$ans_{l,r}+l\\times a-a-sum_{l-1}=F_r-(\\max_{i=l+1}^r\\{d_{i}-d_{i-1}\\})^2$$\n\n\u53d1\u73b0\u5de6\u8fb9\u53ea\u548c$l$\u6709\u5173\uff0c\u53f3\u8fb9\u53ea\u6709\u4e00\u4e2a$\\max$\u8f83\u4e3a\u9ebb\u70e6\u3002\n\n\u8003\u8651$\\max$\u5728\u5de6\u7aef\u70b9\u4e00\u5b9a\u65f6\u5355\u8c03\u4e0a\u5347\uff0c\u6240\u4ee5\u5de6\u7aef\u70b9\u6bcf\u6b21\u5f80\u5de6\u79fb\u4e00\u683c\uff0c\u53ea\u4f1a\u5bf9\u4e00\u5c0f\u90e8\u5206$r$\u9020\u6210\u5f71\u54cd\uff0c\u5c06\u4ed6\u4eec\u7684$\\max$\u5f04\u6210\u4e00\u6837\u7684\u3002\n\n\u65e2\u7136\u4e00\u6837\u4e86\uff0c\u90a3\u5f53\u7136\u53ef\u4ee5\u8bb0\u5f55\u4e00\u4e2a$\\max_{F_r}$\uff0c\u7136\u540e\u628a\u5b83\u4eec\u5e76\u5728\u4e00\u8d77\u554a\u3002\n\n\u7528\u4e00\u4e2a\u5355\u8c03\u6808\u8bb0\u5f55$r$\uff0c\u6bcf\u6b21$l$\u5f80\u5de6\u79fb\u4e00\u4f4d\uff0c\u5c31\u628a\u4e00\u5806$r$\u7f29\u5728\u4e00\u8d77\u3002\n\n\u6808\u91cc\u6bcf\u4e2a\u5143\u7d20\u4e5f\u8981\u5b58\u81ea\u5df1\u4e0b\u9762\u7684$F_r-(\\max_{i=l+1}^r\\{d_{i}-d_{i-1}\\})^2$\u7684\u6700\u5927\u503c\uff0c\u7528\u6765\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u590d\u6742\u5ea6\u663e\u7136\u662f$O(n)$\u7684\u3002\n\n**\u6211\u8e29\u6807\u7b97\u5566\uff01**\n\n\uff08\u521a\u5199\u5b8c\uff0c\u8fc7\u4e8e\u5174\u594b\uff0c\u8bed\u65e0\u4f26\u6b21\uff0c\u8bf7\u539f\u8c05QwQ\uff09\n\n----------------\n\n```cpp\n#include<bits/stdc++.h>\nclock_t t=clock();\nnamespace my_std{\n\tusing namespace std;\n\t#define pii pair<int,int>\n\t#define fir first\n\t#define sec second\n\t#define MP make_pair\n\t#define rep(i,x,y) for (int i=(x);i<=(y);i++)\n\t#define drep(i,x,y) for (int i=(x);i>=(y);i--)\n\t#define go(x) for (int i=head[x];i;i=edge[i].nxt)\n\t#define templ template<typename T>\n\t#define sz 303030\n\ttypedef long long ll;\n\ttypedef double db;\n\tmt19937 rng(chrono::steady_clock::now().time_since_epoch().count());\n\ttempl inline T rnd(T l,T r) {return uniform_int_distribution<T>(l,r)(rng);}\n\ttempl inline bool chkmax(T &x,T y){return x<y?x=y,1:0;}\n\ttempl inline bool chkmin(T &x,T y){return x>y?x=y,1:0;}\n\ttempl inline void read(T& t)\n\t{\n\t\tt=0;char f=0,ch=getchar();double d=0.1;\n\t\twhile(ch>'9'||ch<'0') f|=(ch=='-'),ch=getchar();\n\t\twhile(ch<='9'&&ch>='0') t=t*10+ch-48,ch=getchar();\n\t\tif(ch=='.'){ch=getchar();while(ch<='9'&&ch>='0') t+=d*(ch^48),d*=0.1,ch=getchar();}\n\t\tt=(f?-t:t);\n\t}\n\ttemplate<typename T,typename... Args>inline void read(T& t,Args&... args){read(t); read(args...);}\n\tchar sr[1<<21],z[20];int C=-1,Z=0;\n    inline void Ot(){fwrite(sr,1,C+1,stdout),C=-1;}\n    inline void print(register int x)\n    {\n    \tif(C>1<<20)Ot();if(x<0)sr[++C]='-',x=-x;\n    \twhile(z[++Z]=x%10+48,x/=10);\n    \twhile(sr[++C]=z[Z],--Z);sr[++C]='\\n';\n    }\n\tvoid file()\n\t{\n\t\t#ifndef ONLINE_JUDGE\n\t\tfreopen(\"a.in\",\"r\",stdin);\n\t\t#endif\n\t}\n\tinline void chktime()\n\t{\n\t\t#ifndef ONLINE_JUDGE\n\t\tcout<<(clock()-t)/1000.0<<'\\n';\n\t\t#endif\n\t}\n\t#ifdef mod\n\tll ksm(ll x,int y){ll ret=1;for (;y;y>>=1,x=x*x%mod) if (y&1) ret=ret*x%mod;return ret;}\n\tll inv(ll x){return ksm(x,mod-2);}\n\t#else\n\tll ksm(ll x,int y){ll ret=1;for (;y;y>>=1,x=x*x) if (y&1) ret=ret*x;return ret;}\n\t#endif\n//\tinline ll mul(ll a,ll b){ll d=(ll)(a*(double)b/mod+0.5);ll ret=a*b-d*mod;if (ret<0) ret+=mod;return ret;}\n}\nusing namespace my_std;\n\nint n;ll a;\nll sum[sz];\nll d[sz];\nll F[sz];\n\nstruct hh\n{\n\tll f;\n\tll mx;\n\tll mxr;\n}s[sz];\nint top;\ninline ll sq(ll x){return x*x;}\n\nint main()\n{\n\tfile();\n\tread(n,a);\n\tll x;\n\trep(i,1,n) read(d[i],x),sum[i]=sum[i-1]+x,F[i]=a*i-sum[i];\n\tll ans=max(a-sum[n]+sum[n-1],0ll);\n\ts[++top]=(hh){F[n],0,F[n]};\n\ts[0].mxr=-1e15;\n\tdrep(i,n-1,1)\n\t{\n\t\tll mxF=-1e15;\n\t\twhile (top&&s[top].mx<=d[i+1]-d[i]) chkmax(mxF,s[top].f),s[top]=(hh){0,0,0},--top;\n\t\tif (mxF!=-1e15) {++top;s[top]=(hh){mxF,d[i+1]-d[i],max(mxF-sq(d[i+1]-d[i]),s[top-1].mxr)};}\n\t\t++top;s[top]=(hh){F[i],0,max(F[i],s[top-1].mxr)};\n\t\tchkmax(ans,s[top].mxr-a*i+a+sum[i-1]);\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1551104558,
        "uid": 76481,
        "name": "p_b_p_b",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1107G \u3010Vasya and Maximum Profit\u3011"
    },
    {
        "content": "# \u9898\u76ee\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1107G)\n\n\u7ed9\u5b9a $n,a$ \u4ee5\u53ca\u6709 $n$ \u4e2a\u5143\u7d20\u7684\u4e00\u4e2a\u6570\u5217 $c$ \u548c\u4e00\u4e2a**\u5355\u8c03\u4e0d\u964d**\u6570\u5217 $d$\uff0c\u6c42\n$$\n\\max\\{(r-l+1)\\times a-\\sum_{i=l}^r c_i-\\text{gap}(l,r)\\}\n$$\n\u5176\u4e2d $l\\in [1,n],l\\le r\\le n$ \u4e14\n$$\n\\text{gap}(l,r)=\\max_{i=l}^{r-1}(d_{i+1}-d_i)^2\n$$\n\u7279\u522b\u5730\uff0c\u5982\u679c $l=r$\uff0c\u90a3\u4e48 $\\text{gap}(l,r)=0$.\n\n# \u9898\u89e3\n\n\u5206\u6790\u9898\u76ee\u4e2d\u7684\u67ff\u5b50\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4 $[l,r]$\uff0c\u5c06\u5176\u7684\u503c\u8bb0\u4e3a $\\text{val}(l,r)$\uff0c\u5373\u8bb0\n$$\n\\text{val}(l,r)=(r-l+1)\\times a-\\sum_{i=l}^r c_i-\\text{gap}(l,r)\n$$\n\u4e0d\u96be\u770b\u51fa\uff0c\u6211\u4eec\u8981\u5feb\u901f\u8ba1\u7b97 $\\sum_{i=l}^r c_i$\uff0c\u53ef\u4ee5\u5148\u5c06\u5176\u5904\u7406\u4e3a\u524d\u7f00\u548c\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48 $\\sum_{i=l}^r c_i$ \u5c31\u53d8\u6210 $c_r-c_{l-1}$\n\n\u5c1d\u8bd5\u5c06 $\\text{val}(l,r)$ \u8fdb\u884c\u8f6c\u5316\uff1a\n$$\n\\begin{aligned}\n\\text{val}(l,r)&=(r-l+1)\\times a-(c_r-c_{l-1})-\\text{gap}(l,r) \\\\\n&=ar-a(l-1)-c_r+c_{l-1}-\\text{gap}(l,r) \\\\\n&=(ar-c_r)-\\left [ a(l-1)-c_{l-1}\\right]-\\text{gap}(l,r)\n\\end{aligned}\n$$\n\u53d1\u73b0\u6709\u5f62\u5f0f\u76f8\u540c\u7684\u90e8\u5206 $ar-c_r$ \u4e0e $a(l-1)-c_{l-1}$\uff0c\u90a3\u4e48\u6211\u4eec\u8bb0\n$$\nf(x)=ax-c_{x}\n$$\n\u67ff\u5b50\u5c31\u53d8\u6210\n$$\n\\text{val}(l,r)=f(r)-f(l-1)-\\text{gap}(l,r)\n$$\n\u8003\u8651\u79fb\u9879\uff0c\u6709\n$$\n\\text{val}(l,r)+f(l-1)=f(r)-\\text{gap}(l,r)\n$$\n\u5bf9\u4e8e\u6bcf\u4e2a $l$\uff0c\u6211\u4eec\u6240\u9700\u8981\u505a\u7684\u5c31\u662f\u5728\u6240\u6709 $r\\in [l,n]$ \u4e2d\u627e\u5230\u6700\u5927\u7684 $f(r)-\\text{gap}(l,r)$\uff0c\u8003\u8651\u5148\u5904\u7406\u5b50\u95ee\u9898\uff0c\u5982\u679c\u6ca1\u6709 $\\text{gap}(l,r)$\uff0c\u90a3\u4e48\u6211\u4eec\u7528\u5355\u8c03\u6808\uff0c\u6216\u8005\u9000\u4e00\u6b65\u7528\u7ebf\u6bb5\u6811\u7b49\u6570\u636e\u7ed3\u6784\u90fd\u662f\u5f88\u597d\u5904\u7406\u7684\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u4e2a $\\text{gap}(l,r)$ \u6d89\u53ca $l$\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684 $l$\uff0c\u8fd9\u4e2a $\\text{gap}(l,r)$ \u7684\u503c\u90fd\u4e0d\u4e00\u5b9a\u76f8\u540c\u3002\n\n\u8003\u8651\u5206\u6790 $\\text{gap}(l,r)$ \u7684\u7ed3\u6784\uff0c\u662f\u6240\u6709\u533a\u95f4 $[l,r]$ \u4e2d $d$ \u7684\u76f8\u90bb\u4e24\u9879\u7684\u5dee\u503c\u7684\u5e73\u65b9\u7684\u6700\u5927\u503c\uff0c\u7531\u4e8e\u662f\u6700\u5927\u503c\uff0c\u90a3\u4e48 $\\text{gap}(l,r)$ \u5728 $r$ \u56fa\u5b9a\uff0c$l$ \u53d8\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u53ef\u80fd\u53d8\u5927\u800c\u6ca1\u53ef\u80fd\u53d8\u5c0f\uff0c\u5373\u5176\u5177\u5355\u8c03\u6027\u3002\n\n\u65e2\u7136\u6709\u5355\u8c03\u6027\uff0c\u8003\u8651\u540c\u6837\u7528\u5355\u8c03\u6808\u7ef4\u62a4 $\\text{gap}(l,r)$\uff0c\u56e0\u4e3a $d$ \u5355\u8c03\u4e0d\u964d\uff0c\u90a3\u4e48 $d_{l+1}-d_l\\ge 0$\uff0c\u7b26\u53f7\u5168\u4e3a\u6b63\uff0c\u90a3\u4e48\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u76f4\u63a5\u6bd4\u8f83\u5e73\u65b9\u800c\u5148\u7ef4\u62a4 $\\max \\Delta d$.\n\n\u663e\u7136\uff0c$\\max \\Delta d$ \u5728\u67d0\u4e00\u6bb5\u90fd\u662f\u8fde\u7eed\u7684\uff0c\u5bf9\u4e8e\u6709\u7740\u540c\u6837 $\\max \\Delta d$ \u7684\u533a\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5c06\u5176\u5408\u5e76\uff0c\u5bf9\u4e8e\u65b0\u7684\u4e00\u4e2a $l$\uff0c\u6211\u4eec\u8981\u653e\u5165 $d_{l+1}-d_l$ \u7684\u503c\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u7684\u533a\u95f4\u5f39\u51fa\uff0c\u5c06\u4ed6\u4eec**\u5408\u5e76\u4e4b\u540e**\uff08\u56e0\u4e3a\u4ed6\u4eec\u7684\u539f $d$ \u90fd\u6bd4 $d_{l+1}-d_l$ \u5c0f\uff0c\u53d6\u6700\u5927\u503c\u540e\u4ed6\u4eec\u7684 $d$ \u90fd\u53d8\u4e3a $d_{l+1}-d_l$\uff0c\u8fd9\u65f6\u4ed6\u4eec\u5c06\u88ab\u89c6\u4f5c $\\max \\Delta d$ \u76f8\u540c\u7684\u533a\u95f4\uff0c\u9700\u5408\u5e76\uff09\u518d\u5c06 $\\max \\Delta d$ \u66f4\u65b0\u4e3a $d_{l+1}-d_l$\uff0c\u6700\u540e\u518d\u653e\u5165\u5355\u70b9 $l$ \u5373\u53ef\u3002\n\n\u524d\u9762\u63d0\u53ca\n\n> \u5982\u679c\u6ca1\u6709 $\\text{gap}(l,r)$\uff0c\u90a3\u4e48\u6211\u4eec\u7528\u5355\u8c03\u6808\uff0c\u6216\u8005\u9000\u4e00\u6b65\u7528\u7ebf\u6bb5\u6811\u7b49\u6570\u636e\u7ed3\u6784\u90fd\u662f\u5f88\u597d\u5904\u7406\u7684\u3002\n\n\u800c $\\text{gap}(l,r)$ \u7ecf\u5206\u6790\u540e\u53d1\u73b0\u53ef\u4ee5\u7528\u5355\u8c03\u6808\u7ef4\u62a4\uff0c\u90a3\u4e48\u6211\u4eec\u5c1d\u8bd5\u540c\u65f6\u7528\u5355\u8c03\u6808\u7ef4\u62a4 $f(r)$ \u548c $\\text{gap}(l,r)$.\n\n\u5bf9\u4e8e\u6709\u7740\u540c\u6837 $\\max \\Delta d$ \u7684**\u533a\u95f4**\uff0c\u6211\u4eec\u8bb0\u5f55\u51e0\u4e2a**\u6700\u5927**\u503c\uff1a\n\n- $\\max\\Delta d$\uff0c\u8fd9\u4e2a\u8fd8\u8981\u7528\u4e8e\u7ef4\u62a4\u5355\u8c03\u6027\uff1b\n- $\\max \\{f-\\Delta d\\}$\uff0c\u8fd9\u4e2a\u7528\u4e8e\u66f4\u65b0\u7b54\u6848\uff1b\n- $\\max f$\uff0c\u8fd9\u4e2a\u9700\u8981\u7528\u4e8e\u66f4\u65b0 $\\max \\Delta d$ \u4e4b\u540e\u91cd\u65b0\u8ba1\u7b97 $\\max \\{f-\\Delta d\\}$\uff1b\n\n\u5728\u6211\u4eec\u653e\u5165\u4e00\u4e2a\u65b0\u7684 $l$ \u65f6\uff0c\u6211\u4eec\u5b9e\u9645\u8981\u653e\u5165 $d_{l+1}-d_l$\uff0c\u9996\u5148\u5c06\u90a3\u4e9b $\\max\\Delta d<d_{l+1}-d_l$ \u7684\u533a\u95f4\u5f39\u51fa\u3001\u5408\u5e76\u3001\u66f4\u65b0\u3001\u91cd\u65b0\u653e\u5165\uff0c\u518d\u8bb2\u5176\u81ea\u5df1\u2014\u2014\u5355\u70b9 $l$ \u653e\u5165\u6808\u5373\u53ef\u3002\n\n\u81f3\u4e8e\u533a\u95f4\u5f39\u51fa\u3001\u5408\u5e76\u3001\u66f4\u65b0\u3001\u91cd\u65b0\u653e\u5165\uff0c\u4ee3\u7801\u4e2d\u6709\u8be6\u7ec6\u8bf4\u660e\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n\n#define rep(i,__l,__r) for(signed i=(__l),i##_end_=(__r);i<=i##_end_;++i)\n#define fep(i,__l,__r) for(signed i=(__l),i##_end_=(__r);i>=i##_end_;--i)\n#define erep(i,u) for(signed i=tail[u],v=e[i].to;i;i=e[i].nxt,v=e[i].to)\n#define writc(a,b) fwrit(a),putchar(b)\n#define mp(a,b) make_pair(a,b)\n#define ft first\n#define sd second\ntypedef long long LL;\n// typedef pair<int,int> pii;\ntypedef unsigned long long ull;\ntypedef unsigned uint;\n#define Endl putchar('\\n')\n#define int long long\n// #define int unsigned\n// #define int unsigned long long\n\n#define cg (c=getchar())\ntemplate<class T>inline void read(T& x){\n    char c;bool f=0;\n    while(cg<'0'||'9'<c)f|=(c=='-');\n    for(x=(c^48);'0'<=cg&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    if(f)x=-x;\n}\ntemplate<class T>inline T read(const T sample){\n    T x=0;char c;bool f=0;\n    while(cg<'0'||'9'<c)f|=(c=='-');\n    for(x=(c^48);'0'<=cg&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    return f?-x:x;\n}\ntemplate<class T>void fwrit(const T x){//just short,int and long long\n    if(x<0)return (void)(putchar('-'),fwrit(-x));\n    if(x>9)fwrit(x/10);\n    putchar(x%10^48);\n}\ntemplate<class T>inline T Max(const T x,const T y){return x<y?y:x;}\ntemplate<class T>inline T Min(const T x,const T y){return x<y?x:y;}\ntemplate<class T>inline T fab(const T x){return x>0?x:-x;}\ninline int gcd(const int a,const int b){return b?gcd(b,a%b):a;}\ninline void getInv(int inv[],const int lim,const int MOD){\n    inv[0]=inv[1]=1;for(int i=2;i<=lim;++i)inv[i]=1ll*inv[MOD%i]*(MOD-MOD/i)%MOD;\n}\ninline LL mulMod(const LL a,const LL b,const LL mod){//long long multiplie_mod\n    return ((a*b-(LL)((long double)a/mod*b+1e-8)*mod)%mod+mod)%mod;\n}\n\nconst int maxn=3e5;\nconst LL inf=(1ll<<60);\n\nint n;\n\nLL a,d[maxn+5],c[maxn+5],f[maxn+5];\n\ninline void Init(){\n    n=read(1),a=read(1ll);\n    rep(i,1,n)d[i]=read(1ll),c[i]=c[i-1]+read(1ll),f[i]=a*i-c[i];\n}\n\nstruct node{LL d,maxf,maxans;}sta[maxn+5];\nint ed;\n\n//\u8fd4\u56de\u5e73\u65b9\u6570\ninline LL pow2(const LL x){return x*x;}\n\ninline void Get_ans(){\n    LL ans=Max(0ll,a-(c[n]-c[n-1]));//\u5148\u9009\u62e9\u5355\u70b9, \u4f46\u4e5f\u6709\u53ef\u80fd\u4e0d\u9009\u66f4\u597d...\n    sta[0].maxans=-inf;//\u5728\u4e0b\u9762\u7684\u540e\u7f00\u6700\u5927\u4e2d, \u4e3a\u9632\u6b62 0 \u5e72\u6270\u540e\u7f00\u6700\u5927, \u6b64\u5904\u8d4b\u503c\u4e3a\u6781\u5c0f\u503c\n    sta[++ed]=node{0,f[n],f[n]};//\u653e\u8fdb\u53bb\u5355\u70b9, \u6ca1\u6709 d, \u6545 d=0\n    LL max_pref;//\u8bb0\u5f55\u56e0\u4e3a d \u592a\u5c0f\u800c\u88ab\u5f39\u51fa\u7684\u533a\u95f4\u4e2d, maxf \u7684\u6700\u5927\u503c\n    fep(l,n-1,1){max_pref=-inf;\n        while(ed>0 && sta[ed].d<=d[l+1]-d[l]){\n            max_pref=Max(max_pref,sta[ed].maxf);//\u4e3a\u4e86\u4e4b\u540e\u518d\u628a\u8fd9\u4e9b\u533a\u95f4\u653e\u8fdb\u53bb\u65f6\u518d\u7528\n            sta[ed--]=node{0,0,0};//\u4e3a\u4e86\u9884\u9632\u5e72\u6270\u8ba1\u7b97\n        }\n        if(max_pref!=-inf)\n            //\u5b58\u5728\u67d0\u4e9b\u533a\u95f4\u7684 d \u6bd4\u653e\u8fdb\u53bb\u7684\u5c0f, \u8fd9\u4e9b\u9700\u8981\u88ab\u66f4\u65b0\n            //\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u66f4\u65b0\u4ed6\u4eec\u7684 d, \u518d\u628a\u4ed6\u4eec\u5408\u5e76\u653e\u8fdb\u53bb\n            //\u800c\u6b64\u5904\u4e0e\u524d\u4e00\u4f4d\u7f6e\u7684 maxf \u53d6\u6700\u5927\u503c\n            //\u662f\u56e0\u4e3a\u6211\u4eec\u6808\u7684\u5143\u7d20\u4e2d maxans \u5e76\u4e0d\u662f\u8fd9\u4e2a\u5143\u7d20\u5355\u72ec\u7684 maxans, \u800c\u662f\u6808\u4e2d\u7684\u6240\u6709\u5143\u7d20\u7684 maxans \u7684\u540e\u7f00\u6700\u5927\u503c\n            //\u6211\u4eec\u8981\u7528\u6700\u5927\u503c\u6765\u66f4\u65b0\u7b54\u6848, \u800c\u4e0d\u53ea\u662f\u5355\u72ec\u4e00\u4e2a\u5143\u7d20\u7684 maxans\n            sta[++ed]=node{d[l+1]-d[l],max_pref,Max(max_pref-pow2(d[l+1]-d[l]),sta[ed-1].maxans)};\n        //\u628a\u8fd9\u4e2a\u5355\u70b9 l \u653e\u8fdb\u53bb\n        sta[++ed]=node{0,f[l],Max(f[l],sta[ed-1].maxans)};\n        //\u66f4\u65b0\u7b54\u6848\n        ans=Max(ans,sta[ed].maxans-f[l-1]);\n        // rep(i,0,ed)\n        //     printf(\"sta[%d] : %lld %lld %lld\\n\",i,sta[i].d,sta[i].maxf,sta[i].maxans);\n    }writc(ans,'\\n');\n}\n\nsigned main(){\n    Init();\n    Get_ans();\n    return 0;\n}\n```\n\n",
        "postTime": 1597238582,
        "uid": 125355,
        "name": "Vladilena",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1107G \u3010Vasya and Maximum Profit\u3011"
    },
    {
        "content": "#### \u63a8\u9500 [\u819c zhouakngyang \u5b9d\u5178](https://www.cnblogs.com/George1123/p/13598475.html)\n\n$\\color{black}{\\texttt {z}}\\color{red}{\\texttt {houakngyang}}$ AK \u5b8c\u6bd4\u8d5b\u8ba9\u6211\u6765\u505a\u8fd9\u9898\u3002\n\n#### \u9898\u89e3\uff1a\n\n**\u4e3a\u4e86\u65b9\u4fbf\uff0c\u76f4\u63a5\u628a $d_i$\u3000\u8bbe\u4e3a\u8f93\u5165\u7684 $(d_{i+1}-d_i)^2$**\u3002\n\n\u76f4\u63a5\u505a\u770b\u4e0d\u51fa\u5565~~\u6211\u592a\u83dc\u4e86~~ \uff0c\u53ea\u597d\u5148\u8868\u793a\u7b54\u6848\n$$\n\nans=max\\{a\\times (r-l+1) -\\sum_{i=l}^{r}c_i-\\max_{i=l}^{r-1}\\{d_i\\} \\}\n\n$$\n\n**\u8bf7\u6ce8\u610f $\\max_{i=l}^{r-1}\\{d_i\\}$ \u7684 $r-1$**\n\n\u663e\u7136\u7684\u52a0\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u8bbe $sc_i=\\sum\\limits_{j=1}^{i}c_j$\n$$\nans=max\\{a\\times (r-l+1) -sc_{r}-sc_{l-1}-\\max_{i=l}^{r-1}\\{d_i\\} \\}\n$$\n\u7136\u540e\u5c31\u81ea\u95ed\u4e86 $5min$\n\n\u65e0\u804a\u53d8\u6362\u4e00\u4e0b\u5f0f\u5b50\uff0c\n$$\nans=max\\{(a\\times r -sc_r)-(a\\times (l-1)-sc_{l-1})-\\max_{i=l}^{r-1}\\{d_i\\} \\}\n$$\n\u53d1\u73b0\u9664\u4e86\u90a3\u4e2a $\\max_{i=l}^{r-1}\\{d_i\\}$ \u90fd\u5f88\u597d\u5904\u7406\uff0c\u5565\u90fd\u80fd\u7ef4\u62a4\u7684\u4e9a\u5b50\u3002\n\n\u4e0d\u597d\u5904\u7406\u5c31\u679a\u4e3e\u5457\u3002\n\n\u679a\u4e3e\u4ee5 $d_i$ \u4e3a\u6700\u5927\u503c\u7684\u533a\u95f4 $[lp_i,rp_i]$ \uff0c\u8fd9\u4e2a\u53ef\u4ee5\u5355\u8c03\u6808 $O(n)$ \u641e\u3002\n\n\u7531\u4e8e\u8981\u4fdd\u8bc1 $i\\in [l,r]$ \uff0c\u90a3\u4e48$l$ \u4e00\u5b9a\u5728 $[lp_i,i]$ \u5185\uff0c$r$ \u5728 $[i,rp_i]$ \u5185\u3002\u7136\u540e\u76f4\u63a5\u7528\u4e00\u4e2a\u53ef\u4ee5\u5904\u7406\u9759\u6001\u8be2\u95ee\u533a\u95f4\u6700\u5927\u503c\u7684\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e00\u4e0b $a*i-sc_i$ \u5373\u53ef\uff0c**\u6ce8\u610f\u4e0b\u6807!**\n\n\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u4e0d\u9700\u8981\u51cf $d_i$ \uff0c\u5c31\u662f $l=r$ \u7684\u65f6\u5019\uff0c\u679a\u4e3e\u7279\u5224\u4e00\u4e0b\u5373\u53ef\n\n```cpp\n#define int long long\ninline int rd() {\n    int a=0,f=1;char ch=getchar();\n    while(!isdigit(ch)) {if(ch=='-')f=-1;ch=getchar();}\n    while(isdigit(ch))a=a*10+(ch^48),ch=getchar();\n    return a*f;\n}\n#define N 300009\nint n,a,ans;\nint c[N],sc[N],d[N];\nint lg[N],pw2[25];\nint st[N],top,lp[N],rp[N];\nstruct ST_Table {\n    int st[20][N];\n    void init() {\n        for(int i=1;i<=19;++i)\n            for(int j=1;j+pw2[i]-1<=n;++j)\n                st[i][j]=max(st[i-1][j],st[i-1][j+pw2[i-1]]);\n    }\n    int ask(int l,int r) {\n\t\tif(l>r)return 0;\n        int x=lg[r-l+1];\n        return max(st[x][l],st[x][r-pw2[x]+1]);\n    }\n}s[2];\nvoid st_init() {\n    lg[0]=-1,pw2[0]=1;\n    for(int i=1;i<N;++i)lg[i]=lg[i>>1]+1;\n    for(int i=1;i<=20;++i)pw2[i]=pw2[i-1]<<1;\n}\nsigned main() {\n    n=rd(),a=rd();\n    st_init();\n    for(int i=1;i<=n;++i)d[i]=rd(),sc[i]=sc[i-1]+(c[i]=rd());\n    for(int i=1;i<n;++i)d[i]=(d[i+1]-d[i])*(d[i+1]-d[i]);\n    for(int i=1;i<n;++i) {\n        while(top&&d[st[top]]<d[i])rp[st[top--]]=i-1;\n        lp[i]=st[top]+1,st[++top]=i;\n    }\n    while(top)rp[st[top--]]=n-1;\n    for(int i=1;i<=n;++i)\n        s[0].st[0][i]=sc[i-1]-a*(i-1),\n        s[1].st[0][i]=a*(i+1)-sc[i+1];\n    s[0].init(),s[1].init();\n    for(int i=1;i<=n;++i)ans=max(ans,a-c[i]);\n    for(int i=1;i<n;++i)\n        ans=max(ans,s[0].ask(lp[i],i)+s[1].ask(i,rp[i])-d[i]);\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```\n\n\n\n\n\n",
        "postTime": 1599131066,
        "uid": 123384,
        "name": "tommy0221",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1107G \u3010Vasya and Maximum Profit\u3011"
    },
    {
        "content": "\u6bcf\u9053\u9898\u505a\u51fa\u6765\u5f97 $ a $ \u5206\uff0c\u8981\u505a\u8fd9\u9898\u8981 $ -c_{i} $ \u5206\uff0c\u76f4\u63a5\u628a $ a $ \u52a0\u8fdb\u53bb\uff0c\u6bcf\u9053\u9898\u7684\u6743\u503c $ v_{i} = a - c_{i} $\n\n\u5982\u679c\u9898\u76ee\u6ca1\u6709 $ d $ \u7684\u9650\u5236\uff0c\u5f53\u524d\u7684\u7b54\u6848\u5373\u4e3a\u6570\u5217\u4e2d\u6700\u5927\u5b50\u6bb5\u548c\n\n\u5982\u679c\u6709\u4e86 $ d $ \u7684\u9650\u5236\uff0c\u4f1a\u53d1\u73b0\u4e0d\u540c\u7684 $ d $ \u7684\u9650\u5236\u4e0d\u8d85\u8fc7 $ n - 1 $ \u4e2a\n\n\u8003\u8651\u5206\u6cbb\uff0c\u6bcf\u6b21\u9009\u51fa $ d_{i + 1} - d_{i} $ \u6700\u5927\u7684\u4e00\u7ec4\uff0c\u627e\u7ecf\u8fc7 $ i $ \u548c $ i + 1 $ \u7684\u6700\u5927\u5b57\u6bb5\u548c\uff0c\u4e14\u4e0d\u80fd\u6709 $ j $ \u4f7f\u5f97 $ j $ \u548c $ j - 1 $ \u90fd\u5728\u6700\u5927\u5b57\u6bb5\u548c\u4e2d\u4e14 $ d_{i + 1} - d{i} < d_{j + 1} - d_{j} $\n\n\u6211\u4eec\u7528 $ solve(l, r) $ \u6765\u8fdb\u884c\u5206\u6cbb\uff0c\u5982\u679c $ l == r $ \u5c31 return \u6389\n\n$ i $ \u4e3a\u4f7f\u5f97\u5f53\u524d $ d_{i + 1} - d_{i} $ \u6700\u5927\u7684\u6570\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7ecf\u8fc7 $ i $ \u548c $ i + 1 $ \u7684\u5728\u533a\u95f4 $ [l, r] $ \u5185\u7684\u6700\u5927\u5b57\u6bb5\u548c\n\n$ solve(l, i), solve(i + 1, r) $ \u9632\u6b62\u518d\u6b21\u540c\u65f6\u7ecf\u8fc7 $ i $ \u548c $ i + 1 $ \u5373\u53ef\n\n\u7279\u5224\u53ea\u53d6\u4e00\u4e2a\u6570\u7684\u60c5\u51b5\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n#define Fast_cin ios::sync_with_stdio(false), cin.tie(0);\n#define rep(i, a, b) for(register int i = a; i <= b; i++)\n#define per(i, a, b) for(register int i = a; i >= b; i--)\n#define DEBUG(x) cerr << \"DEBUG\" << x << \" >>> \" << endl;\nusing namespace std;\n\ntypedef unsigned long long ull;\ntypedef pair <int, int> pii;\ntypedef long long ll;\n\ntemplate <typename _T>\ninline void read(_T &f) {\n    f = 0; _T fu = 1; char c = getchar();\n    while(c < '0' || c > '9') { if(c == '-') fu = -1; c = getchar(); }\n    while(c >= '0' && c <= '9') { f = (f << 3) + (f << 1) + (c & 15); c = getchar(); }\n    f *= fu;\n}\n\ntemplate <typename T>\nvoid print(T x) {\n    if(x < 0) putchar('-'), x = -x;\n    if(x < 10) putchar(x + 48);\n    else print(x / 10), putchar(x % 10 + 48);\n}\n\ntemplate <typename T>\nvoid print(T x, char t) {\n    print(x); putchar(t);\n}\n\nconst int N = 3e5 + 5;\n\nstruct info {\n    int lmax, rmax, sum;\n    info () { lmax = rmax = sum = 0; }\n};\n\ninfo merge(info a, info b) {\n    info ans;\n    ans.lmax = max(a.lmax, a.sum + b.lmax);\n    ans.rmax = max(b.rmax, b.sum + a.rmax);\n    ans.sum = a.sum + b.sum;\n    return ans;\n}\n\nstruct node_t {\n    int l, r;\n    info val;\n} p[N << 2];\n\nint a[N], d[N];\nint n, k, ans;\n\nvoid build(int u, int l, int r) {\n    p[u].l = l; p[u].r = r;\n    if(l == r) {\n        p[u].val.lmax = p[u].val.rmax = max(0ll, a[l]);\n        p[u].val.sum = a[l];\n        return;\n    }\n    int mid = (l + r) >> 1;\n    build(u << 1, l, mid); build(u << 1 | 1, mid + 1, r);\n    p[u].val = merge(p[u << 1].val, p[u << 1 | 1].val);\n}\n\ninfo query(int u, int l, int r) {\n    if(l > r) return info();\n    if(l <= p[u].l && p[u].r <= r) return p[u].val;\n    int mid = (p[u].l + p[u].r) >> 1;\n    if(mid >= l && mid + 1 <= r) return merge(query(u << 1, l, r), query(u << 1 | 1, l, r));\n    if(mid >= l) { return query(u << 1, l, r); } return query(u << 1 | 1, l, r);\n}\n\nint st[N][20], wz[N][20], lg[N];\n\npii query(int l, int r) {\n    int k = lg[r - l + 1];\n    int x = st[l][k], y = st[r - (1 << k) + 1][k];\n    if(x > y) return make_pair(x, wz[l][k]);\n    return make_pair(y, wz[r - (1 << k) + 1][k]);\n}\n\nvoid solve(int l, int r) {\n    if(l == r) return;\n    pii t = query(l, r - 1);\n    int wz = t.second, now = a[wz] + a[wz + 1] - t.first;\n    now += (query(1, l, wz - 1).rmax + query(1, wz + 2, r).lmax);\n    ans = max(ans, now); solve(l, wz); solve(wz + 1, r);\n}\n\n#undef int\nint main() {\n#define int long long\n    read(n); read(k);\n    for(register int i = 1; i <= n; i++) read(d[i]), read(a[i]), a[i] = k - a[i], ans = max(ans, a[i]);\n    build(1, 1, n);\n    for(register int i = 1; i < n; i++) {\n        st[i][0] = (d[i + 1] - d[i]) * (d[i + 1] - d[i]);\n        wz[i][0] = i;\n    }\n    lg[0] = -1; for(register int i = 1; i < n; i++) lg[i] = lg[i >> 1] + 1;\n    for(register int j = 1; j <= 18; j++) {\n        for(register int i = 1; i <= n - (1 << (j - 1)) + 1; i++) {\n            int x = st[i][j - 1], y = st[i + (1 << (j - 1))][j - 1];\n            if(x > y) st[i][j] = x, wz[i][j] = wz[i][j - 1];\n            else st[i][j] = y, wz[i][j] = wz[i + (1 << (j - 1))][j - 1];\n        }\n    }\n    solve(1, n); cout << ans << endl;\n    return 0;\n}\n```",
        "postTime": 1548672859,
        "uid": 51815,
        "name": "LJC00118",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1107G \u3010Vasya and Maximum Profit\u3011"
    }
]