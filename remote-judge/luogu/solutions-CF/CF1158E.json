[
    {
        "content": "# CF1158E Strange Device\n\n### \u9898\u610f\n\n\u8fd9\u662f\u4e00\u9053\u4ea4\u4e92\u9898\uff0c\u4f60\u9700\u8981\u731c\u51fa\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u6811\u3002\n\n\u4f60\u53ef\u4ee5\u4f5c\u51fa $\\leq 80$ \u6b21\u5982\u4e0b\u8be2\u95ee\uff1a\n\n\u7ed9\u4ea4\u4e92\u5e93\u4e00\u4e2a\u5e8f\u5217 $d_1,d_2, \\ldots, d_n$\uff0c\u4ea4\u4e92\u5e93\u4f1a\u8fd4\u56de\u4e00\u4e2a 01 \u4e32\uff0c\u8868\u793a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9 $i$ \u662f\u5426\u5b58\u5728\u8282\u70b9 $j\\  (i \\neq j)$ \u4f7f\u5f97 $dis(i,j) \\leq d_j$\u3002\n\n$2 \\leq n \\leq 1000$\n\n### \u9898\u89e3\n\n\u5e76 \u884c \u8ba1 \u7b97\n\n\u770b\u5230\u9898\u201c80 \u6b21\u8be2\u95ee\u201d\u5c31\u89c9\u5f97\u4e0d\u5bf9\u52b2\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u9898\u5206\u6210\u4e24\u90e8\u5206\uff1a\u786e\u5b9a\u6df1\u5ea6 \u548c \u786e\u5b9a\u7236\u4eb2\u8282\u70b9\u3002\n\n##### \u7b2c\u4e00\u4e2a\u90e8\u5206\n\n\u89c2\u5bdf\uff1a\u5982\u679c\u628a $d_x$ \u7684\u503c\u8bbe\u4e3a $t$\uff0c\u5176\u4ed6\u7684\u662f $0$\uff0c\u90a3\u4e48\u6240\u6709\u8ddd\u79bb $x$ \u70b9\u5c0f\u4e8e\u7b49\u4e8e $t$ \u7684\u8282\u70b9\u5728 01 \u4e32\u4e2d\u662f $1$\u3002\n\n\u90a3\u4e48\u5982\u679c\u628a\u6240\u6709\u6df1\u5ea6\u4e3a $dep$ \u7684\u8282\u70b9\u7684 $d$ \u503c\u8bbe\u6210 $t$\uff0c\u5176\u4ed6\u90fd\u662f $0$\uff0c\u90a3\u4e48\u6240\u6709\u6df1\u5ea6\u5728 $[dep-t, dep+t]$ \u7684\u8282\u70b9\u5728 01 \u4e32\u4e2d\u662f $1$\uff0c\u5176\u4f59\u7684\u662f $0$\u3002\n\n\u5982\u679c\u518d\u628a\u6240\u6709\u6df1\u5ea6\u4e3a $dep$ \u7684\u8282\u70b9\u7684 $d$ \u503c\u8bbe\u4e3a $t+1$\uff0c\u522b\u7684 $d$ \u4ecd\u7136\u662f $0$\uff0c\u90a3\u4e48\u6240\u6709\u6df1\u5ea6\u5c0f\u4e8e $dep-t-1$ \u6216\u8005\u5927\u4e8e $dep+t+1$ \u7684\u8282\u70b9\u5728\u4e24\u6b21\u8be2\u95ee\u7684 01 \u4e32\u4e2d\u5747\u4e3a $0$\uff0c\u6240\u6709\u6df1\u5ea6\u4e3a $dep-t-1$ \u6216\u8005 $dep+t+1$ \u7684\u8282\u70b9\u5728\u7b2c\u4e00\u6b21\u8be2\u95ee\u4e2d\u4e3a $0$\uff0c\u7b2c\u4e8c\u6b21\u8be2\u95ee\u4e2d\u4e3a $1$\uff0c\u6240\u6709\u6df1\u5ea6\u5728 $[dep-t,dep+t]$ \u7684\u8282\u70b9\u5728\u4e24\u6b21\u8be2\u95ee\u4e2d\u90fd\u662f $1$\u3002\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u4e8c\u5206\u3002\u5177\u4f53\u7684\uff0c\u533a\u95f4\u7684\u4e24\u4e2a\u7aef\u70b9\u8868\u793a\u8282\u70b9\u5df2\u7ecf\u5168\u90e8\u786e\u5b9a\u7684\u6df1\u5ea6\uff08\u521d\u59cb\u4e3a $0$ \u548c $n$\uff0c\u56e0\u4e3a\u6df1\u5ea6\u4e3a $0$ \u7684\u662f $1$\uff0c\u6df1\u5ea6\u4e3a $n$ \u7684\u6ca1\u6709\uff09\uff0c\u6bcf\u6b21\u6311\u9009\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u53d6 $mid-l$ \u4f5c\u4e3a $t$\uff0c\u53d6 $l$ \u4f5c\u4e3a $dep$ \u5c31\u53ef\u4ee5\u786e\u5b9a\u6240\u6709\u6df1\u5ea6\u4e3a $mid$ \u7684\u8282\u70b9\uff0c\u5e76\u4e14\u628a\u4e0d\u786e\u5b9a\u7684\u8282\u70b9\u96c6\u5408\u5206\u6210\u4e24\u534a\u3002\n\n\u4f46\u662f\u8fd9\u6837\u7684\u8be2\u95ee\u6b21\u6570\u662f $\\mathcal O(n)$\uff0c\u9700\u8981\u4f18\u5316\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u6211\u4eec $d$ \u6570\u7ec4\u4e2d\u53ea\u7528\u5230\u4e86\u6df1\u5ea6\u4e3a $l$ \u7684\u70b9\uff0c\u800c\u4e14\u8be2\u95ee\u51fa\u6765\u7684\u4fe1\u606f\u4e5f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u6ca1\u6709\u88ab\u5229\u7528\u3002\u6211\u4eec\u8003\u8651\u600e\u4e48\u201c\u5e76\u884c\u201d\u8ba1\u7b97\u3002\n\n\u4e2d\u95f4\u7684\u72b6\u6001\u80af\u5b9a\u662f\u5f62\u5982\u8fd9\u6837\u7684\uff1a\n\n$$\npos_1 \\quad (pos_1, pos_2) \\quad pos_2 \\quad pos_3 \\quad pos_4 \\quad (pos_4, pos_5) \\quad pos_5 \\quad (pos_5, pos_6) \\ldots\n$$\n\n\u5176\u4e2d $pos$ \u8868\u793a\u6df1\u5ea6\u786e\u5b9a\u7684\u8282\u70b9\uff0c $(pos_1, pos_2)$ \u8868\u793a\u6df1\u5ea6\u5728 $pos_1$ \u7684\u6df1\u5ea6\u548c $pos_2$ \u7684\u6df1\u5ea6\u4e4b\u95f4\u4e0d\u786e\u5b9a\u7684\u70b9\u3002\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e8c\u5206\u7684\u5c31\u662f\u5f62\u5982 $(pos_1, pos_2)$ \u8fd9\u6837\u7684\u4e1c\u897f\u3002\n\n\u90a3\u4e48\u4e00\u4e2a\u6bd4\u8f83\u5e7c\u7a1a\u7684\u60f3\u6cd5\u5c31\u662f\u65e2\u7136\u6bcf\u4e2a\u70b9\u7684\u6df1\u5ea6\u4e0d\u4e00\u6837\uff0c\u90a3\u4e48\u76f4\u63a5\u628a\u6240\u6709\u9700\u8981\u8fdb\u884c\u7684\u4e8c\u5206\u7684\u8be2\u95ee\u90fd\u5408\u5e76\u5728\u4e00\u4e2a $d$ \u91cc\u9762\u3002\u8fd9\u4e2a\u663e\u7136\u662f\u9519\u7684\uff0c\u56e0\u4e3a\u4e24\u4e2a\u533a\u95f4\u53ef\u80fd\u4f1a\u76f8\u4e92\u5f71\u54cd\uff08$dep$ \u7684\u8be2\u95ee\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230 $[dep-t, dep]$ \u7684\u70b9\uff0c\u56e0\u6b64\u4e0d\u80fd\u4e00\u8d77\u95ee\uff09\u3002\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u56e0\u4e3a\u662f\u4e8c\u5206\uff0c\u6240\u4ee5\u4e0d\u5b58\u5728\u4e0a\u4e00\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u6bd4\u4e0b\u4e00\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u5c0f\u5f97\u591a\u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u4e00\u4e0b $mid$ \u7684\u53d6\u503c\u4f7f\u5f97\u4e0a\u4e00\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u603b\u662f\u4e0d\u5c0f\u4e8e\u4e0b\u4e00\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u533a\u95f4\u5206\u4e00\u4e0b\u5947\u5076\uff0c\u5bf9\u5947\u6570\u548c\u5076\u6570\u5206\u5f00\u8be2\u95ee\u3002\u8fd9\u6837\u7684\u5229\u7528\u7387\u5c31\u597d\u591a\u4e86\u3002\n\n\u9700\u8981 $\\mathcal O(\\log n)$ \u6b21\u8be2\u95ee\uff0c\u5e38\u6570\u7ea6\u4e3a $4$\u3002\n\n##### \u7b2c\u4e8c\u4e2a\u90e8\u5206\n\n\u8003\u8651\u62c6\u4f4d\u505a\u3002\n\n\u5982\u679c\u6211\u4eec\u628a\u6df1\u5ea6\u4e3a $dep$ \u5e76\u4e14\u7b2c $k$ \u4f4d\u4e3a $1$ \u7684\u70b9\u7684 $d$ \u90fd\u8bbe\u4e3a $1$\uff0c\u5176\u4ed6\u90fd\u662f $0$\uff0c\u90a3\u4e48\u6df1\u5ea6\u4e3a $dep + 1$ \u7684\u70b9\u7684\u7236\u4eb2\u7684\u7b2c $k$ \u4f4d\u5c31\u662f\u4ed6\u5728 01 \u4e32\u4e2d\u7684\u503c\u3002\n\n\u4f46\u662f\u5982\u679c\u5bf9\u4e8e\u6240\u6709\u7684\u6df1\u5ea6\u5206\u522b\u505a\u4e00\u904d\uff0c\u8be2\u95ee\u6b21\u6570\u662f $\\mathcal O(n \\log n)$\uff0c\u9700\u8981\u4f18\u5316\u3002\u8003\u8651\u201c\u5e76\u884c\u201d\u8ba1\u7b97\u3002\n\n\u8003\u8651\u4e00\u4e2a\u5982\u4e0a\u7684\u8be2\u95ee\u9664\u4e86\u51b3\u5b9a\u7236\u4eb2\u7684 $dep + 1$ \u6df1\u5ea6\u8fd8\u4f1a\u5f71\u54cd\u5230 $dep$ \u548c $dep - 1$ \u7684\u6df1\u5ea6\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u7528\u7c7b\u4f3c\u7b2c\u4e00\u90e8\u5206\u7684\u505a\u6cd5\uff0c\u5bf9\u4e8e\u6a21 $3$ \u5206\u7ec4\uff0c\u6b64\u65f6\u6bcf\u4e00\u7ec4\u7684\u8be2\u95ee\u90fd\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u7ec4\u5185\u7684\u8be2\u95ee\u90fd\u538b\u8d77\u6765\u3002\n\n\u9700\u8981 $\\mathcal O(\\log n)$ \u6b21\u8be2\u95ee\uff0c\u5e38\u6570\u4e3a $3$\u3002\n\n\u8fd9\u4e2a\u9898\u5b9e\u73b0\u8d77\u6765\u6709\u70b9\u7ec6\u8282\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\n//#define local_test\n\nconst int N = 1005;\n\n#ifdef local_test\nnamespace interactive_lib {\n    int n, cnt, dep[N], fa[N], son[N], sz[N], top[N], dis[N][N];\n    std::vector<int> G[N];\n\n    void dfs1(int u, int f) {\n        sz[u] = 1, fa[u] = f, dep[u] = dep[fa[u]] + 1;\n        for (int v : G[u]) if (v != f) {\n            dfs1(v, u); sz[u] += sz[v];\n            if (sz[v] > sz[son[u]]) son[u] = v;\n        }\n    }\n\n    void dfs2(int u, int fa, int tp) {\n        top[u] = tp;\n        if (son[u]) dfs2(son[u], u, tp);\n        for (int v : G[u]) if (v != son[u] && v != fa) dfs2(v, u, v);\n    }\n\n    inline int lca(int x, int y) {\n        while (top[x] != top[y]) {\n            if (dep[top[x]] < dep[top[y]]) std::swap(x, y);\n            x = fa[top[x]];\n        }\n        return dep[x] < dep[y] ? x : y;\n    }\n\n    void init(int nn) {\n        cnt = 0, n = nn;\n        for (int i = 2; i <= n; ++i) {\n            int x, y; scanf(\"%d%d\", &x, &y);\n            G[x].push_back(y), G[y].push_back(x);\n        }\n        dfs1(1, 0);\n        dfs2(1, 0, 1);\n        for (int i = 1; i < n; ++i)\n            for (int j = i + 1; j <= n; ++j) if (i != j) dis[i][j] = dis[j][i] = dep[i] + dep[j] - 2 * dep[lca(i, j)];\n    }\n\n    void check(int *f) {\n        for (int i = 2; i <= n; ++i) if (f[i] != fa[i]) puts(\"WAWAWAWAWAWAWA\");\n        else puts(\"ACACACACAC\");\n    }\n\n    void answer(int *d, char *s) {\n        ++cnt;\n        printf(\"Answering query %d...\\n\", cnt);\n        for (int i = 1; i <= n; ++i) {\n            s[i] = '0';\n            for (int j = 1; j <= n; ++j) if (i != j)\n                if (dis[i][j] <= d[j]) s[i] = '1';\n        }\n        puts(s + 1);\n    }\n} // namespace interactive_lib\n#endif\n\nint n, fa[N], d1[N], d2[N], vis[N];\nchar s1[N], s2[N];\nstd::vector<int> conf[N], v[N], pos, t2;\n\nvoid print() {\n    printf(\"!\\n\");\n    for (int i = 2; i <= n; ++i) printf(\"%d %d\\n\", i, fa[i]);\n    fflush(stdout);\n#ifdef local_test\n    interactive_lib::check(fa);\n#endif\n}\n\nint qcnt;\n\nvoid query(int *d, char *s) {\n    ++qcnt;\n    if (qcnt > 80) exit(0);\n    printf(\"?\");\n    for (int i = 1; i <= n; ++i) printf(\" %d\", d[i]);\n    printf(\"\\n\");\n    fflush(stdout);\n#ifdef local_test\n    interactive_lib::answer(d, s);\n#else\n    scanf(\"%s\", s + 1);\n#endif\n    for (int i = 1; i <= n; ++i) s[i] -= '0';\n}\n\nint main() {\n    //freopen(\"in.txt\", \"r\", stdin);\n    //freopen(\"out\", \"w\", stdout);\n    scanf(\"%d\", &n);\n#ifdef local_test\n    interactive_lib::init(n);\n#endif\n    conf[0] = {1}, vis[0] = vis[n] = 1;\n    v[0].resize(n - 1), std::iota(v[0].begin(), v[0].end(), 2);\n    while (1) {\n        pos.clear();\n        for (int i = 0; i <= n; ++i) if (vis[i]) pos.push_back(i);\n        int skip = 0;\n        for (int t = 0; t < 2; ++t) {\n            memset(d1, 0, sizeof(int) * (n + 1));\n            memset(d2, 0, sizeof(int) * (n + 1));\n            int tnp = 0;\n            for (int i = t; i < pos.size() - 1; i += 2) {\n                if (conf[pos[i]].size()) {\n                    if (pos[i + 1] == pos[i] + 2) {\n                        vis[pos[i] + 1] = 1;\n                        conf[pos[i] + 1] = v[pos[i]];\n                        v[pos[i]].clear();\n                    } else if (pos[i + 1] > pos[i] + 2) {\n                        int mid = (pos[i] + pos[i + 1] + 1) / 2;\n                        //printf(\"binary search %d %d %d %d\\n\", t, mid, pos[i], pos[i + 1]);\n                        //if (mid == 5) {\n                        //    printf(\"v[pos[i]]:\\n\");\n                        //    for (int j : v[pos[i]]) printf(\"%d \", j); printf(\"\\n\");\n                        //}\n                        vis[mid] = 1, ++tnp;\n                        for (int j : conf[pos[i]]) d1[j] = mid - pos[i] - 1, d2[j] = mid - pos[i];\n                    }\n                }\n            }\n            if (tnp) {\n                query(d1, s1), query(d2, s2);\n                for (int i = t; i < pos.size() - 1; i += 2) {\n                    if (conf[pos[i]].size() && pos[i + 1] > pos[i] + 2) {\n                        int mid = (pos[i] + pos[i + 1] + 1) / 2;\n                        //if (mid == 5) {\n                        //    printf(\"data:\\n\");\n                        //    for (int j : v[pos[i]]) printf(\"%d \", j); printf(\"\\n\");\n                        //    for (int j : v[pos[i]]) printf(\"%d \", s1[j]); printf(\"\\n\");\n                        //    for (int j : v[pos[i]]) printf(\"%d \", s2[j]); printf(\"\\n\");\n                        //}\n                        t2.clear();\n                        for (int j : v[pos[i]]) {\n                            if (s1[j]) t2.push_back(j);\n                            else if (s2[j]) conf[mid].push_back(j);\n                            else v[mid].push_back(j);\n                        }\n                        v[pos[i]] = t2;\n                    }\n                }\n            } else ++skip;\n        }\n        if (skip == 2) break;\n    }\n    //int cc = 0;\n    //for (int i = 0; i <= n; ++i)\n    //    for (int j : conf[i]) if (interactive_lib::dep[j] - 1 != i) printf(\"@@@@@@@@ %d %d %d @@@@@@@@\\n\", j, i, interactive_lib::dep[j] - 1);\n    //assert(cc == n);\n    for (int t = 1; t <= 3; ++t) {\n        for (int k = 0; (1 << k) <= n; ++k) {\n            memset(d1, 0, sizeof(int) * (n + 1));\n            int cnt = 0;\n            for (int i = t; i < n; i += 3) if (conf[i].size())\n                for (int j : conf[i - 1]) if ((j >> k) & 1) d1[j] = 1, ++cnt;\n            if (cnt) {\n                query(d1, s1);\n                for (int i = t; i < n; i += 3) if (conf[i].size())\n                    for (int j : conf[i]) if (s1[j]) fa[j] |= (1 << k);\n            }\n        }\n    }\n    print();\n    return 0;\n}\n```",
        "postTime": 1640787484,
        "uid": 302509,
        "name": "zghtyarecrenj",
        "ccfLevel": 7,
        "title": "\u9707\u60ca\uff01oi\u5c45\u7136\u6709\u5e76\u884c\u8fd0\u7b97\u9898\uff01"
    },
    {
        "content": "# CF1158E \u9898\u89e3\n\n\n\n## \u9898\u76ee\u5927\u610f\n\n> \u4ea4\u4e92\u5668\u4e2d\u6709\u4e00\u4e2a $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u6bcf\u6b21\u4f60\u53ef\u4ee5\u8be2\u95ee\u4ea4\u4e92\u5668\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u7ec4 $d_1,d_2,\\dots.d_n$\u3002\n>\n> \u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u4ea4\u4e92\u5668\u4f1a\u628a $\\mathrm{dist}(u,i)\\le l_i$ \u7684\u6240\u6709 $u$ \u67d3\u6210\u9ed1\u8272\uff0c\u6700\u7ec8\u4ea4\u4e92\u5668\u4f1a\u56de\u7b54\u4f60\u6bcf\u4e2a\u8282\u70b9\u662f\u5426\u88ab\u67d3\u6210\u8fc7\u9ed1\u8272\u3002\n>\n> \u5bf9\u4ea4\u4e92\u5668\u7684\u8be2\u95ee\u662f\u4e92\u76f8\u72ec\u7acb\u7684\u3002\n>\n> \u4f60\u9700\u8981\u5728 $80$ \u6b21\u8be2\u95ee\u4e4b\u5185\u8fd8\u539f\u8fd9\u68f5\u6811\u7684\u5f62\u6001\u3002\n>\n> \u6570\u636e\u8303\u56f4\uff1a$n\\le 1000$\u3002\n\n\n\n## \u601d\u8def\u5206\u6790\n\n\u8003\u8651\u5b9a $1$ \u4e3a\u6839\uff0c\u8bb0 $dep_i=\\mathrm{dist}(1,i)$\u3002\n\n\u8003\u8651\u6c42\u51fa\u6bcf\u4e2a $1<i\\le n$ \u7684 $i$ \u7684\u7236\u4eb2\u8282\u70b9 $f_i$\uff0c\u6700\u76f4\u63a5\u7684\u60f3\u6cd5\u662f\u6784\u9020\u5e8f\u5217 $d_x=[x=i]$\uff0c\u7136\u540e\u627e\u5230\u9ed1\u8272\u7684 $dep_j=dep_i-1$ \u7684 $j$\uff0c\u8fd9\u6837\u7684 $j$ \u53ef\u4ee5\u8bc1\u660e\u662f\u552f\u4e00\u7684\uff0c\u6b64\u65f6 $f_i=j$\u3002\n\n**\u786e\u5b9a\u6df1\u5ea6**\n\n\u56e0\u6b64\u8003\u8651\u7b2c\u4e00\u6b65\u786e\u5b9a $dep_i$\uff0c\u5bf9\u4e8e\u67d0\u4e2a $k$\uff0c\u901a\u8fc7\u6784\u9020\u4e00\u7ec4 $\\{k,0,0,\\dots,0\\}$ \u548c $\\{k-1,0,0,\\dots,0\\}$ \u5373\u53ef\u6c42\u51fa $dep_u=k$ \u7684\u6240\u6709 $u$\u3002\n\n\u4f46\u8fd9\u6837\u7684\u8be2\u95ee\u6b21\u6570\u662f $2n$ \u7684\uff0c\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\u672c\u9898\u3002\n\n\u6ce8\u610f\u5230\u5f53\u6211\u4eec\u8be2\u95ee $\\{k,0,0,\\dots,0\\}$ \u548c $\\{k-1,0,0,\\dots,0\\}$ \u4e4b\u540e\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u53ef\u4ee5\u628a\u6574\u4e2a\u70b9\u96c6 $\\mathbf V$ \u5212\u5206\u6210 $dep_u<k,dep_u=k,dep_u>k$ \u7684\u4e09\u90e8\u5206\u3002\n\n\u56e0\u6b64\u6bcf\u6b21\u8be2\u95ee\u524d\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u77e5\u9053\u5bf9\u4e8e\u82e5\u5e72\u7ec4 $(l_i,r_i)$\uff0c$dep_u\\in(l_i,r_i)$ \u7684\u6240\u6709 $u$ \u6784\u6210\u7684\u70b9\u96c6\u662f\u4ec0\u4e48\u3002\n\n\u8003\u8651\u4e8c\u5206\uff0c\u6bcf\u6b21\u53d6\u51fa $mid=\\left\\lfloor\\dfrac{l_i+r_i}2\\right\\rfloor$\uff0c\u8be2\u95ee $d_{u}=[dep_u=l_i]\\times mid$ \u548c $d_{u}=[dep_u=l_i]\\times(mid-1)$\uff0c\u7136\u540e\u628a\u5bf9\u5e94\u96c6\u5408\u5206\u6210 $(l_i,mid),[mid,mid],(mid,r_i)$ \u4e09\u4e2a\u90e8\u5206\u3002\n\n\u4f46\u662f\u8fd9\u6837\u6bcf\u6b21\u4e5f\u53ea\u80fd\u5207\u5206\u4e00\u4e2a\u533a\u95f4\uff0c\u4f9d\u7136\u4e0d\u591f\u4f18\u79c0\uff0c\u89c2\u5bdf\u5230\u6bcf\u6b21\u53ea\u5904\u7406\u4e00\u6bb5 $(l_i,r_i)$ \u6709\u70b9\u6d6a\u8d39\uff0c\u8003\u8651\u6bcf\u6b21\u64cd\u4f5c\uff0c\u6211\u4eec\u90fd\u628a\u6240\u6709\u5f85\u5212\u5206\u7684 $(l_i,r_i)$ \u63d0\u53d6\u51fa\u6765\uff0c\u7528 $2$ \u6b21\u8be2\u95ee\u786e\u5b9a\u6bcf\u4e00\u7ec4\u7684\u7b54\u6848\u3002\n\n\u4f46\u5b9e\u9645\u4e0a\u8fd9\u79cd\u505a\u6cd5\u662f\u4e0d\u884c\u7684\uff0c\u8003\u8651\u4e24\u4e2a\u76f8\u90bb\u7684\u5f85\u786e\u5b9a\u533a\u95f4 $(l_i,r_i),(r_i,l_{i+1})$\uff0c\u6b64\u65f6\u5bf9\u4e8e $u\\in r_i$\uff0c\u5728\u7b2c\u4e8c\u4e2a\u533a\u95f4\u4e2d\u8bbe $d_u=mid$\uff0c\u800c\u6b64\u65f6\u7684 $r_i$ \u81ea\u4e0b\u5f80\u4e0a\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230 $(l_i,r_i)$ \u533a\u95f4\u7684\u7b54\u6848\u3002\n\n\u8003\u8651\u5206\u7ec4\u89e3\u51b3\uff0c\u6ce8\u610f\u5230\u6240\u6709\u7684 $r_i-l_i-1$ \u76f8\u5dee\u5f88\u5c0f\uff0c\u6545\u8003\u8651\u5bf9\u533a\u95f4\u95f4\u9694\u5206\u7ec4\uff0c\u5373\u7f16\u53f7\u4e3a\u5947\u6570\u7684\u533a\u95f4\u548c\u6807\u53f7\u4e3a\u5076\u6570\u7684\u533a\u95f4\u5206\u522b\u8003\u8651\uff0c\u53ef\u4ee5\u8bc1\u660e\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u8be2\u95ee\u4e0d\u4f1a\u4ea7\u751f\u76f8\u4e92\u5f71\u54cd\u7684\u533a\u95f4\u3002\n\n\u603b\u7684\u8be2\u95ee\u6b21\u6570\u4e3a $4\\log _2n\\approx40$\u3002\n\n**\u786e\u5b9a\u7236\u4eb2**\n\n\u63a5\u4e0b\u6765\u8003\u8651\u786e\u5b9a\u6bcf\u4e2a\u70b9 $i$ \u7684\u7236\u4eb2\u3002\u8003\u8651\u538b\u7f29\u8be2\u95ee\uff0c\u6bcf\u6b21\u5bf9\u4e8e\u6df1\u5ea6\u76f8\u540c\u4e3a $k$ \u7684\u8282\u70b9\u4e00\u8d77\u5904\u7406\u3002\n\n\u5b58\u5728\u7684\u95ee\u9898\u662f\u5bf9\u4e8e\u6df1\u5ea6\u76f8\u540c\u7684\u8282\u70b9\uff0c\u6211\u4eec\u65e0\u6cd5\u5224\u65ad\u7a76\u7adf\u54ea\u4e2a\u8282\u70b9\u662f\u54ea\u4e2a\u8282\u70b9\u7684\u7236\u4eb2\uff0c\u8003\u8651\u9006\u5411\u601d\u8003\uff0c\u6211\u4eec\u901a\u8fc7\u8be2\u95ee\u7236\u4eb2\u786e\u5b9a\u4ed6\u4eec\u7684\u513f\u5b50\uff0c\u800c\u6bcf\u6b21\u64cd\u4f5c\u6211\u4eec\u628a\u8fd9\u4e9b\u53ef\u80fd\u7684\u7236\u4eb2\u5206\u6210\u4e24\u4e2a\u96c6\u5408\uff0c\u7136\u540e\u786e\u5b9a\u6bcf\u4e2a\u513f\u5b50\u5728\u54ea\u4e2a\u96c6\u5408\u91cc\u5373\u53ef\u3002\n\n\u5bb9\u6613\u60f3\u5230\u4e8c\u8fdb\u5236\u5206\u7ec4\u7684\u601d\u60f3\uff0c\u5bf9\u4e8e $2^0\\sim2^9$ \u7684\u6bcf\u4e2a\u4e8c\u8fdb\u5236\u4f4d $d$\uff0c\u8be2\u95ee $d_i=[dep_i=k-1\\text{ and }\\mathrm{digit}(i,d)=1]$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u6df1\u5ea6\u4e3a $k$ \u7684\u70b9\uff0c\u6211\u4eec\u80fd\u77e5\u9053\u4ed6\u7684\u7236\u4eb2\u5728 $d$ \u8fd9\u4e00\u4f4d\u7684\u503c\u662f $0$ \u8fd8\u662f $1$\u3002\n\n\u4f46\u662f\u8fd9\u6837\u9700\u8981\u5bf9\u6bcf\u4e2a\u53ef\u80fd\u7684\u6df1\u5ea6\u8fdb\u884c\u4e00\u6b21\u8be2\u95ee\uff0c\u6700\u574f\u60c5\u51b5\u4e0b\u8be2\u95ee\u6b21\u6570\u4e3a $n$\uff0c\u8003\u8651\u7528\u4e0a\u4e00\u90e8\u5206\u76f8\u4f3c\u7684\u505a\u6cd5\u4f18\u5316\uff0c\u6bcf\u6b21\u6c42\u51fa\u591a\u4e2a\u6df1\u5ea6\u7684\u70b9\u7684\u513f\u5b50\uff0c\u6ce8\u610f\u5230\u8be2\u95ee\u7684 $d_i\\le 1$\uff0c\u56e0\u6b64\u6bcf\u4e2a $k$ \u4f1a\u5f71\u54cd\u5230 $k-1,k-2$ \u4e24\u5c42\u7684\u8282\u70b9\uff0c\u6839\u636e $\\bmod 3$ \u7684\u4f59\u6570\u5206\u7c7b\u5c31\u4e0d\u4f1a\u6709\u76f8\u4e92\u4e4b\u95f4\u7684\u5f71\u54cd\u4e86\u3002\n\n\u8fd9\u4e00\u90e8\u5206\u7684\u8be2\u95ee\u6b21\u6570\u4e3a $3\\log_2n\\approx 30$\u3002\n\n**\u603b\u7ed3**\n\n\u6700\u7ec8\u4e24\u90e8\u5206\u8be2\u95ee\u6b21\u6570\u603b\u548c\u4e3a $4\\log_2n+3\\log_2n\\approx 70$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n\n\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nsigned main() {\n\tint n;\n\tcin>>n;\n\tauto query=[&](const vector <int> &d) -> vector <int> {\n\t\tcout<<\"? \";\n\t\tfor(int i=1;i<=n;++i) cout<<d[i]<<\" \";\n\t\tcout<<endl;\n\t\tstring str;\n\t\tcin>>str;\n\t\tvector <int> x(n+1);\n\t\tfor(int i=1;i<=n;++i) x[i]=str[i-1]-'0';\n\t\treturn x;\n\t};\n\tvector <vector<int>> chk(n+1),ver(n+1); //need to check, already check\n\tvector <int> vis(n+1,0); //whether query the depth\n\tvis[0]=1; ver[0].push_back(1);\n\tfor(int i=2;i<=n;++i) chk[0].push_back(i);\n\tvis[n]=1;\n\tfor(int k=0;k<10;++k) {\n\t\tvector <int> dep;\n\t\tfor(int i=0;i<=n;++i) if(vis[i]) dep.push_back(i);\n\t\tint len=dep.size();\n\t\tfor(int t:{0,1}) {\n\t\t\tvector <int> Q1(n+1,0),Q2(n+1,0);\n\t\t\tfor(int i=t;i+1<len;i+=2) {\n\t\t\t\tint dist=dep[i+1]-dep[i]-1;\n\t\t\t\tif(dist==0) continue;\n\t\t\t\tif(dist==1) {\n\t\t\t\t\tvis[dep[i]+1]=1;\n\t\t\t\t\tver[dep[i]+1]=chk[dep[i]];\n\t\t\t\t\tchk[dep[i]].clear();\n\t\t\t\t} else {\n\t\t\t\t\tint mid=(dep[i]+dep[i+1]+1)>>1;\n\t\t\t\t\t//mid,mid+1\n\t\t\t\t\tfor(int u:ver[dep[i]]) Q1[u]=mid-dep[i],Q2[u]=mid-dep[i]-1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvector <int> A1=query(Q1),A2=query(Q2);\n\t\t\tfor(int i=t;i+1<len;i+=2) {\n\t\t\t\tint dist=dep[i+1]-dep[i]-1;\n\t\t\t\tif(dist<=1) continue;\n\t\t\t\tint mid=(dep[i]+dep[i+1]+1)>>1;\n\t\t\t\t//mid-1,mid\n\t\t\t\tvector <int> L,R,M;\n\t\t\t\tfor(int u:chk[dep[i]]) {\n\t\t\t\t\tif(A1[u]&&A2[u]) L.push_back(u);\n\t\t\t\t\tif(A1[u]&&!A2[u]) M.push_back(u);\n\t\t\t\t\tif(!A1[u]&&!A2[u]) R.push_back(u);\n\t\t\t\t}\n\t\t\t\tvis[mid]=1;\n\t\t\t\tver[mid]=M;\n\t\t\t\tchk[mid]=R;\n\t\t\t\tchk[dep[i]]=L;\n\t\t\t}\n\t\t}\n\t}\n\tvector <int> fa(n+1,0);\n\tfor(int k=0;k<10;++k) {\n\t\tfor(int t:{0,1,2}) {\n\t\t\tvector <int> Q(n+1,0);\n\t\t\tfor(int i=t;i<=n;i+=3) {\n\t\t\t\tfor(int u:ver[i]) if(u&(1<<k)) Q[u]=1;\n\t\t\t}\n\t\t\tvector <int> A=query(Q);\n\t\t\tfor(int i=t+1;i<=n;i+=3) {\n\t\t\t\tfor(int u:ver[i]) fa[u]|=A[u]<<k;\n\t\t\t}\n\t\t}\n\t}\n\tcout<<\"! \"<<endl;\n\tfor(int i=2;i<=n;++i) cout<<i<<\" \"<<fa[i]<<\" \"<<endl;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1682488670,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "CF1158E \u9898\u89e3"
    },
    {
        "content": "\u4e00\u4e2a\u6709\u70b9\u70e6\u7684 $8\\log n$ \u7684\u505a\u6cd5\u3002\n\n\u5927\u81f4\u60f3\u6cd5\u5927\u5bb6\u90fd\u4e00\u6837\uff1a\u4ee5 $1$ \u4e3a\u6839\uff0c\u7136\u540e\u5148\u95ee\u51fa\u6bcf\u4e2a\u70b9\u6df1\u5ea6\uff0c\u518d\u95ee\u51fa\u6bcf\u4e2a\u70b9\u7684\u7236\u4eb2\u3002\n\n\u9996\u5148\u5148\u7528\u4e00\u4e2a log \u7684\u505a\u6cd5\u95ee\u51fa\u6811\u9ad8\uff0c\u5177\u4f53\u505a\u6cd5\u662f\u76f4\u63a5\u4ee4\u6839\u8282\u70b9\u7684 $f$ \u4e3a\u4e8c\u5206\u51fa\u7684 $mid$\uff0c\u770b\u80fd\u5426\u8986\u76d6\u6240\u6709\u70b9\u5373\u53ef\uff0c\u8bb0\u6700\u5927\u6df1\u5ea6\u4e3a $mxdep$\u3002\u53ef\u4ee5\u5728\u4e8c\u5206\u8fc7\u7a0b\u4e2d\u987a\u5e26\u7740\u6c42\u51fa\u6df1\u5ea6\u4e3a $mxdep$ \u7684\u70b9\u96c6\u3002\n\n\u5148\u8003\u8651\u600e\u4e48\u95ee\u6bcf\u4e2a\u70b9\u7684\u6df1\u5ea6\uff0c\u6211\u4eec\u5206\u5c42\uff0c\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u5bf9\u4e8e\u6bcf\u4e2a $i\\in[0,\\dfrac{mxdep}{2^k}]$ \u5df2\u7ecf\u77e5\u9053\u4e86\u54ea\u4e9b\u70b9\u6df1\u5ea6\u5728 $[i\u00b72^k,(i+1)\u00b72^k-1]$ \u8fd9\u6bb5\u533a\u95f4\u5185\uff0c\u4ee5\u53ca\u6df1\u5ea6\u7b49\u4e8e $i\u00b72^k,(i+1)\u00b72^k-1$ \u7684\u70b9\u6709\u54ea\u4e9b\uff08\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u8bb0\u8fd9\u4e09\u4e2a\u4fe1\u606f\u5206\u522b\u4e3a $st_i,top_i,bot_i$\uff09\u3002\u8003\u8651\u5982\u4f55\u5c06\u8fd9\u4e9b\u957f\u5ea6\u4e3a $2^k$ \u7684\u5927\u533a\u95f4\u5212\u5206\u4e3a $2^{k-1}$ \u7684\u5c0f\u533a\u95f4\uff08\u5373\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $i\\in[0,\\dfrac{mxdep}{2^{k-1}}]$ \u6c42\u51fa\u6df1\u5ea6\u5728 $[i\u00b72^{k-1},(i+1)\u00b72^{k-1}-1]$ \u7684\u70b9\u4e2d\u7684\u70b9 $st'_i$\uff0c$top'_i,bot'_i$ \u7684\u5b9a\u4e49\u7c7b\u4f3c\uff09\uff0c\u6211\u4eec\u5148\u5bf9\u4e8e\u6bcf\u4e2a $i\\in[0,\\dfrac{mxdep}{2^k}]$ \u4e14\u662f\u5076\u6570\u7684 $i$\uff0c\u4ee4 $top_i$ \u4e2d\u70b9\u7684 $f$ \u4e3a $2^{k-1}-1$\uff0c\u5176\u4ed6\u70b9\u7684 $f$ \u4e3a\u96f6\uff0c\u8fd9\u6837\uff0c\u5bf9\u4e8e\u5076\u6570 $i$\uff0c$st_i$ \u4e2d\u90a3\u4e9b\u88ab\u8986\u76d6\u7684\u70b9\u7684\u6df1\u5ea6\u5c31\u5728 $st'_{2i}$ \u4e2d\uff0c\u6ca1\u88ab\u8986\u76d6\u7684\u70b9\u7684\u6df1\u5ea6\u5c31\u5728 $st'_{2i+1}$ \u4e2d\u3002\u5bf9\u4e8e\u5947\u6570\u4e5f\u540c\u6837\u5904\u7406\u3002\u8fd9\u6837\u6211\u4eec\u6c42\u51fa\u4e86 $st'$\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u4e0d\u77e5\u9053 $top'$ \u548c $bot'$\u3002\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $i\\in\\mathbb{Z}$\uff0c\u5c06 $st'_{2i}$ \u4e2d\u7684\u70b9\u7684 $f$ \u8bbe\u4e3a $1$\uff0c\u5176\u4ed6\u70b9\u7684 $f$ \u4e3a $0$\uff0c\u8fd9\u6837\u5bf9\u4e8e $st_{2i+1}$ \u4e2d\u7684\u6240\u6709\u70b9\uff0c\u90a3\u4e9b\u88ab\u8986\u76d6\u7684\u70b9\u8981\u4e48\u5728 $top'_{2i+1}$ \u4e2d\uff0c\u8981\u4e48\u5728 $bot'_{2i+1}$ \u4e2d\uff0c\u800c\u663e\u7136 $bot'_{2i+1}=bot_i$\uff0c\u56e0\u6b64\u53ef\u4ee5\u6c42\u51fa $top'_{2i+1}$\uff0c\u540c\u65f6\u56e0\u4e3a $top'_{2i}=top_i$\uff0c\u8fd9\u6837\u53ef\u4ee5\u77e5\u9053\u6240\u6709 $top'$\u3002\u63a5\u4e0b\u6765\u8003\u8651\u600e\u4e48\u6c42 $bot'$\uff0c\u6211\u4eec\u5c06 $top'_{2i}$ \u7684\u70b9\u7684 $f$ \u90fd\u8bbe\u4e3a $2^{k-1}-2$\uff0c\u8fd9\u6837 $st'_{2i}$ \u4e2d\u6ca1\u88ab\u8986\u76d6\u7684\u70b9\u5c31\u4e00\u5b9a\u5728 $bot'_{2i}$ \u4e2d\uff0c\u518d\u6839\u636e $bot'_{2i+1}=bot_i$ \u6c42\u51fa\u6240\u6709 $bot'$\u3002\u8fd9\u6837\u6211\u4eec\u4f7f\u7528\u4e86 $4$ \u6b21\u8be2\u95ee\u4ece\u7b2c $k$ \u5c42\u63a8\u5230\u7b2c $k-1$ \u5c42\u3002\u603b\u8be2\u95ee\u6b21\u6570 $4\\log n$\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u600e\u4e48\u6c42\u6bcf\u4e2a\u70b9\u7684\u7236\u4eb2\uff0c\u8fd9\u90e8\u5206\u5176\u5b9e\u8fd8\u633a trivial\uff0c\u5bf9\u4e8e $k=0,1,2$\uff0c\u6211\u4eec\u6bcf\u6b21\u7ed9\u6df1\u5ea6 $\\bmod 3=k$ \u7684\u70b9\u786e\u5b9a\u7236\u4eb2\uff0c\u8fd9\u4e2a\u6a21\u578b\u76f8\u5f53\u4e8e\u6211\u4eec\u6709\u4e24\u7ec4\u96c6\u5408 $S_i,T_i$\uff0c\u6211\u4eec\u5df2\u7ecf\u786e\u5b9a $T_i$ \u4e2d\u6bcf\u4e2a\u70b9\u7684\u7236\u4eb2\u90fd\u5728 $S_i$ \u4e2d\u3002\u8003\u8651\u5982\u4f55\u5212\u5206\u4e3a\u66f4\u5c0f\u7684\u5b50\u95ee\u9898\uff0c\u663e\u7136 $|S_i|=1$ \u7684\u70b9\u76f4\u63a5\u5df2\u7ecf\u786e\u5b9a\u4e86\uff0c\u5426\u5219\u4ee4 $S_i$ \u4e2d\u524d\u4e00\u534a\u5143\u7d20\u7684 $f$ \u4e3a $1$\uff0c\u8fd9\u6837 $T_i$ \u4e2d\u88ab\u8986\u76d6\u7684\u70b9\u7684\u7236\u4eb2\u5c31\u5728 $S_i$ \u4e2d\uff0c\u6ca1\u88ab\u8986\u76d6\u5c31\u5728\u540e\u4e00\u534a\uff0c\u7ee7\u7eed\u9012\u5f52\u5373\u53ef\u3002\u53c8\u56e0\u4e3a\u6211\u4eec\u5bf9 $\\bmod 3$ \u8fdb\u884c\u4e86\u5206\u7ec4\uff0c\u56e0\u6b64\u4e0d\u540c\u7ec4\u7684\u8be2\u95ee\u4e0d\u4f1a\u5f71\u54cd\u3002\u8fd9\u6837\u5355\u6b21\u9700\u8981 $\\log n$ \u4e2a\u8be2\u95ee\uff0c\u800c\u6211\u4eec\u8981\u8dd1\u4e09\u6b21\uff0c\u6240\u4ee5\u662f $3\\log n$\u3002\n\n\u603b\u5171\u662f $8\\log n$\u3002\u4ee3\u7801\u5b9e\u73b0\u8d77\u6765\u6709\u70b9\u7ec6\u8282\u3002\n\n```cpp\nconst int MAXN=1000;\nint n;\nvector<bool>query(vector<int>v){\n\tprintf(\"?\");for(int x:v)printf(\" %d\",x);printf(\"\\n\");fflush(stdout);\n\tstring s;cin>>s;vector<bool>res(n);\n\tfor(int i=0;i<n;i++)res[i]=s[i]-'0';\n\tfor(int i=0;i<n;i++)if(v[i])res[i]=1;\n\treturn res;\n}\nint dep[MAXN+5],fa[MAXN+5],mxdep;vector<int>qv[MAXN+5];\nvoid calc_dep(vector<tuple<vector<int>,vector<int>,vector<int> > >v,int k){\n\t//(total,top,bottom)\n\tif(k==0){for(int i=0;i<v.size();i++)for(int x:get<0>(v[i]))dep[x]=i;return;}\n\tif(k==1){\n\t\tfor(int i=0;i<v.size();i++){\n\t\t\tfor(int x:get<1>(v[i]))dep[x]=i*2;\n\t\t\tfor(int x:get<2>(v[i]))dep[x]=i*2+1;\n\t\t}return;\n\t}\n\tvector<tuple<vector<int>,vector<int>,vector<int> > >nv;\n\tvector<int>vec(n);vector<bool>tmp,res(n); \n\tfor(int i=0;i<v.size();i+=2)for(int x:get<1>(v[i]))vec[x]=((1<<k-1)-1);\n\ttmp=query(vec);\n\tfor(int i=0;i<v.size();i+=2)for(int x:get<0>(v[i]))if(tmp[x])res[x]=1;\n\tfor(int i=0;i<n;i++)vec[i]=0;\n\tfor(int i=1;i<v.size();i+=2)for(int x:get<1>(v[i]))vec[x]=((1<<k-1)-1);\n\ttmp=query(vec);\n\tfor(int i=1;i<v.size();i+=2)for(int x:get<0>(v[i]))if(tmp[x])res[x]=1;\n\tfor(int i=0;i<v.size();i++){\n\t\tvector<int>v0,v1;\n\t\tfor(int x:get<0>(v[i])){\n\t\t\tif(res[x]==0)v0.pb(x);\n\t\t\telse v1.pb(x);\n\t\t}\n\t\tif(!v0.empty()){\n\t\t\tnv.pb(mt(v1,get<1>(v[i]),vector<int>{}));\n\t\t\tnv.pb(mt(v0,vector<int>{},get<2>(v[i])));\n\t\t}else nv.pb(mt(v1,get<1>(v[i]),get<2>(v[i])));\n\t}\n\tfor(int i=0;i<n;i++)vec[i]=0;\n\tfor(int i=0;i<nv.size();i+=2)for(int x:get<0>(nv[i]))vec[x]=1;\n\tres=query(vec);\n\tfor(int i=1;i<nv.size();i+=2){\n\t\tstatic bool vis[MAXN+5];memset(vis,0,sizeof(vis));\n\t\tvector<int>vv;\n\t\tfor(int x:get<2>(nv[i]))vis[x]=1;\n\t\tfor(int x:get<0>(nv[i]))if(res[x]&&!vis[x])vv.pb(x);\n\t\tget<1>(nv[i])=vv;\n\t}\n\tfor(int i=0;i<n;i++)vec[i]=0;\n\tfor(int i=0;i<nv.size();i+=2)for(int x:get<1>(nv[i]))vec[x]=(1<<(k-1))-2;\n\tres=query(vec);\n\tfor(int i=0;i<nv.size();i+=2){\n\t\tstatic bool vis[MAXN+5];memset(vis,0,sizeof(vis));\n\t\tvector<int>vv;\n\t\tfor(int x:get<1>(nv[i]))vis[x]=1;\n\t\tfor(int x:get<0>(nv[i]))if(!res[x]&&!vis[x])vv.pb(x);\n\t\tif(get<2>(nv[i]).empty())get<2>(nv[i])=vv;\n\t}\n\tcalc_dep(nv,k-1);\n}\nvoid calc_fa(vector<pair<vector<int>,vector<int> > >_v){\n\tvector<pair<vector<int>,vector<int> > >v,nv;\n\tfor(auto t:_v){\n\t\tif(t.fi.size()==1){for(int x:t.se)fa[x]=t.fi[0];}\n\t\telse v.pb(t);\n\t}\n\tif(v.empty())return;\n\tvector<int>vec(n);vector<bool>res;\n\tfor(int i=0;i<v.size();i++){\n\t\tint mid=v[i].fi.size()/2;\n\t\tfor(int j=0;j<mid;j++)vec[v[i].fi[j]]=1;\n\t}res=query(vec);\n\tfor(int i=0;i<v.size();i++){\n\t\tvector<int>A,B;int mid=v[i].fi.size()/2;\n\t\tfor(int j=0;j<mid;j++)A.pb(v[i].fi[j]);\n\t\tfor(int x:v[i].se)if(res[x]==1)B.pb(x);\n\t\tnv.pb(mp(A,B));A.clear();B.clear();\n\t\tfor(int j=mid;j<v[i].fi.size();j++)A.pb(v[i].fi[j]);\n\t\tfor(int x:v[i].se)if(res[x]==0)B.pb(x);\n\t\tnv.pb(mp(A,B));\n\t}calc_fa(nv);\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tint l=0,r=n-1;vector<int>bot;\n\twhile(l<=r){\n\t\tint mid=l+r>>1;vector<int>v(n);v[0]=mid;\n\t\tvector<bool>res=query(v);vector<int>v0;\n\t\tfor(int i=0;i<n;i++)if(!res[i])v0.pb(i);\n\t\tif(v0.empty())r=mid-1;\n\t\telse mxdep=mid,l=mid+1,bot=v0;\n\t}\n\tmxdep++;int K=0;while((1<<K)<=mxdep)++K;\n\tif(mxdep==1){printf(\"!\\n\");for(int i=2;i<=n;i++)printf(\"1 %d\\n\",i);fflush(stdout);return 0;}\n\tvector<int>vec;for(int i=0;i<n;i++)vec.pb(i);\n\tcalc_dep({mt(vec,vector<int>{0},bot)},K);\n\tfor(int x:bot)dep[x]=mxdep;\n\tfor(int i=0;i<n;i++)qv[dep[i]].pb(i);\n\tfor(int i=0;i<3;i++){\n\t\tvector<pair<vector<int>,vector<int> > >v;\n\t\tfor(int j=i;j<mxdep;j+=3)v.pb(mp(qv[j],qv[j+1]));\n\t\tcalc_fa(v);\n\t}\n\tprintf(\"!\\n\");\n\tfor(int i=1;i<n;i++)printf(\"%d %d\\n\",fa[i]+1,i+1);\n\tfflush(stdout);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1684221748,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1158E Strange device"
    }
]