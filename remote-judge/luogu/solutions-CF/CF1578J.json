[
    {
        "content": "\u4ece\u5e95\u5411\u4e0a\u8003\u8651\uff0c\u5982\u679c\u5f53\u524d\u8282\u70b9 $u$ \u9700\u8981 $x$ \u5757\u94b1\uff0c\u5b83\u7684\u5144\u5f1f\uff08\u62e5\u6709\u76f8\u540c\u7236\u4eb2\u7684\u5176\u4ed6\u8282\u70b9\uff09\u4e3a $v$\uff0c\u90a3\u4e48\u5b83\u7684\u7236\u4eb2\u9700\u8981 $x+\\sum \\min(size_v,x)$ \u5757\u94b1\u624d\u80fd\u4fdd\u8bc1 $u$ \u62ff\u5230 $x$ \u5757\u94b1\uff0c\u5176\u4e2d $size_v$ \u662f $v$ \u7684\u5b50\u6811\u70b9\u6743\u548c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9\uff0c\u66b4\u529b\u5f80\u4e0a\u8df3\u662f\u5f88\u5b8c\u86cb\u7684\uff0c\u6811\u5256\u6216\u8005\u500d\u589e\u8df3\u4e5f\u5f88\u96be\uff0c\u56e0\u4e3a\u8df3\u5f88\u591a\u7ea7\u7236\u4eb2\u540e $x$ \u7684\u589e\u91cf\u6839\u636e $x$ \u5927\u5c0f\u7684\u4e0d\u540c\u4e5f\u4f1a\u4e0d\u4e00\u6837\u3002\n\n\u8003\u8651\u4e00\u6b21\u8df3\u8dc3\uff0c\u5982\u679c\u6709 $\\min(size_v,x)=x$\uff0c\u90a3\u4e48 $x$ \u81f3\u5c11\u7ffb\u500d\uff0c\u79f0\u8fd9\u4e2a\u70b9\u4e3a\u500d\u589e\u70b9\u3002\u6ce8\u610f\u5230\u4e00\u4e2a\u70b9 $u$ \u8df3\u5230\u6839\u7684\u8fc7\u7a0b\u4e2d\u81f3\u591a\u6709 $\\mathcal{O}(\\log \\sum m)$ \u4e2a\u500d\u589e\u70b9\uff0c\u800c\u5728\u8df3\u5230\u500d\u589e\u70b9\u4e4b\u524d\u7684\u8def\u5f84\uff0c\u5176\u5bf9 $x$ \u7684\u589e\u91cf\u662f\u5f88\u597d\u9884\u5904\u7406\u51fa\u7136\u540e\u5feb\u901f\u6c42\u5f97\u7684\u3002\n\n\u90a3\u4e48\u8003\u8651\u4e00\u4e2a\u500d\u589e\uff0c$f_{u,i}$ \u4ee3\u8868\u4ece $u$ \u8df3\u5230 $u$ \u7684 $2^i$ \u7ea7\u7236\u4eb2\uff0c\u8981\u6c42 $x\\leq ?$ \u624d\u80fd\u4fdd\u8bc1\u4e0d\u4f1a\u9047\u5230\u500d\u589e\u70b9\uff0c\u8fd9\u4e2a\u662f\u5f88\u597d\u9884\u5904\u7406\u7684\uff0c\u90a3\u4e48\u5904\u7406\u4e00\u4e2a\u70b9\u7684\u7b54\u6848\u7684\u65f6\u5019\u500d\u589e\u627e\u500d\u589e\u70b9\uff0c\u7136\u540e\u8df3\u5230\u500d\u589e\u70b9\u4e0a\uff0c\u5728\u500d\u589e\u70b9\u4e0a $x$ \u7684\u589e\u91cf\u7edf\u8ba1\u53ef\u4ee5\u63d0\u524d\u7ed9\u8fd9\u4e2a\u8282\u70b9\u7684\u513f\u5b50\u70b9\u6743\u548c\u6392\u5e8f\u7136\u540e\u4e8c\u5206\u6765\u5feb\u901f\u6c42\u5f97\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n\\log n(\\log n+\\log m))$\uff0e\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<vector>\n#define pb emplace_back\n#define mp std::make_pair\n#define fi first\n#define se second\ntypedef long long ll;\ntypedef std::pair<int, int> pii;\ntypedef std::pair<ll, int> pli;\ntypedef std::pair<ll, ll> pll;\ntypedef std::vector<int> vi;\ntypedef std::vector<ll> vll;\nconst ll mod = 998244353;\nll Add(ll x, ll y) { return (x+y>=mod) ? (x+y-mod) : (x+y); }\nll Mul(ll x, ll y) { return x * y % mod; }\nll Mod(ll x) { return x < 0 ? (x + mod) : (x >= mod ? (x-mod) : x); }\nll cadd(ll &x, ll y) { return x = (x+y>=mod) ? (x+y-mod) : (x+y); }\ntemplate <typename T> T Max(T x, T y) { return x > y ? x : y; }\ntemplate <typename T> T Min(T x, T y) { return x < y ? x : y; }\ntemplate <typename T>\nT &read(T &r) {\n\tr = 0; bool w = 0; char ch = getchar();\n\twhile(ch < '0' || ch > '9') w = ch == '-' ? 1 : 0, ch = getchar();\n\twhile(ch >= '0' && ch <= '9') r = r * 10 + (ch ^ 48), ch = getchar();\n\treturn r = w ? -r : r;\n}\nconst int N = 300010;\nint n, fa[N][20];\nll su[N][20], val[N], f[N][20];\nvi eg[N];\nvll s[N], va[N];\nvoid dfs1(int x) {\n\tfor(auto v : eg[x]) {\n\t\tdfs1(v);\n\t\tval[x] += val[v];\n\t}\n}\nvoid dfs2(int x) {\n\tfor(int i = 1; i <= 19; ++i) fa[x][i] = fa[fa[x][i-1]][i-1];\n\tif(x) {\n\t\tif(va[fa[x][0]].size() == 1) f[x][0] = 0;\n\t\telse f[x][0] = va[fa[x][0]][(int)va[fa[x][0]].size()-1-(va[fa[x][0]][(int)va[fa[x][0]].size()-1] == val[x])];\n\t\tsu[x][0] = s[fa[x][0]][(int)s[fa[x][0]].size()-1] - val[x];\n\t\tfor(int i = 1; i <= 19; ++i)\n\t\t\tsu[x][i] = su[x][i-1] + su[fa[x][i-1]][i-1],\n\t\t\tf[x][i] = Max(f[x][i-1], f[fa[x][i-1]][i-1] - su[x][i-1]);\n\t}\n\tfor(auto v : eg[x]) dfs2(v);\n}\nsigned main() {\n//\tfreopen(\"data.in\", \"r\", stdin);\n//\tfreopen(\"1.out\", \"w\", stdout);\n\tread(n);\n\tfor(int i = 1; i <= n; ++i) {\n\t\tread(fa[i][0]); read(val[i]);\n\t\teg[fa[i][0]].pb(i);\n\t}\n\tdfs1(0);\n\tfor(int i = 1; i <= n; ++i) va[fa[i][0]].pb(val[i]), s[fa[i][0]].pb(0);\n\tfor(int i = 0; i <= n; ++i) {\n\t\tstd::sort(va[i].begin(), va[i].end());\n\t\tfor(int j = 0; j < (int)va[i].size(); ++j)\n\t\t\ts[i][j] = s[i][j-1+(j==0)] + va[i][j];\n\t}\n\tdfs2(0);\n\tfor(int i = 1; i <= n; ++i) {\n\t\tint x = i; ll t = val[x];\n\t\twhile(x) {\n\t\t\tfor(int j = 19; ~j; --j)\n\t\t\t\tif(x && t >= f[x][j]) {\n\t\t\t\t\tt += su[x][j];\n\t\t\t\t\tx = fa[x][j];\n\t\t\t\t}\n\t\t\tif(x) {\n\t\t\t\tint p = std::upper_bound(va[fa[x][0]].begin(), va[fa[x][0]].end(), t) - va[fa[x][0]].begin() - 1;\n\t\t\t\tll lt = t;\n\t\t\t\tif(p<0) {\n\t\t\t\t\tt += lt * s[fa[x][0]].size();\n\t\t\t\t\tt -= Min(val[x], lt);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tt += lt * (s[fa[x][0]].size()-p-1);\n\t\t\t\t\tt += s[fa[x][0]][p];\n\t\t\t\t\tt -= Min(val[x], lt);\n\t\t\t\t}\n\t\t\t\tx = fa[x][0];\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\", t);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1633524499,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dCodeforces 1578J Just Kingdom"
    },
    {
        "content": "\u8c03\u4e86\u4e00\u4e0b\u5348\u2026\u2026\u5199\u4e00\u7bc7\u9898\u89e3\u3002\n\n$\\text{Solution:}$\n\n\u9996\u5148\u8003\u8651\u4f20\u9001\u7684\u8fc7\u7a0b\uff0c\u5bb9\u6613\u5f97\u5230\uff0c\u4f20\u9012\u8fc7\u7a0b\u7684\u672c\u8d28\u5c31\u662f\u4ece\u5c0f\u5230\u5927\u586b\u513f\u5b50\uff0c\u5982\u679c\u8fd9\u4e2a\u586b\u4e0d\u6ee1\u4e86\uff0c\u5269\u4e0b\u7684\u5c31\u5e73\u5747\u5206\u914d\u3002\n\n\u90a3\u4e48\uff0c\u4e00\u4e2a\u5b50\u6811\u6240\u9700\u7684\u6d41\u91cf\u663e\u7136\u5c31\u662f $siz[x].$ \u5982\u679c\u4e00\u4e2a\u70b9\u4e0a\u9762\u6709 $w$ \u7684\u6d41\u91cf\uff0c\u90a3\u4e48\u5b83\u7236\u4eb2\u7684\u5176\u4ed6\u5b69\u5b50\u4e5f\u5fc5\u7136\u90fd\u6709\u4e00\u4e2a $\\min\\{siz[v],w\\}$ \u7684\u6d41\u91cf\u3002\n\n\u4ece\u4e0a\u5230\u4e0b\u4e0d\u597d\u505a\uff0c\u6211\u4eec\u8003\u8651\u80fd\u4e0d\u80fd\u81ea\u5e95\u5411\u4e0a\u53bb\u63a8\u3002\u7531\u4e0a\u8ff0\u53ef\u4ee5\u77e5\u9053\uff0c\u4e00\u4e2a\u70b9\u5411\u4e0a\u8d70\uff0c\u5176\u7236\u4eb2\u6240\u9700\u7684\u6d41\u91cf\u5bf9\u5e94\u4f1a\u53d8\u4e3a $\\sum _{v\\in fa} \\min\\{w,siz[v]\\}$\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u6a21\u62df\u8fd9\u4e2a\u5411\u4e0a\u8df3\u7684\u8fc7\u7a0b\u4e86\u3002\n\n\u66b4\u529b\uff1f\u663e\u7136\u4e0d\u592a\u884c\uff0c\u8003\u8651\u7ee7\u7eed\u53d1\u73b0\u6027\u8d28\u3002\n\n\u9996\u5148\u5bf9\u4e8e\u6240\u6709 $siz[x]>w$ \u7684\u8282\u70b9\uff0c $w$ \u5230\u5176\u7236\u4eb2\u4e0a\uff0c\u5c31\u4f1a\u81f3\u5c11\u52a0\u500d\u3002\u56e0\u4e3a $\\min\\{w,siz[x]\\}=w,$ \u5bf9\u5e94\u5230\u5176\u7236\u4eb2\u4e0a\u9762 $w'\\ge 2w.$\n\n\u6240\u4ee5\uff0c\u4e00\u4e2a\u70b9\u5411\u4e0a\u500d\u589e\u53d8\u5927\u7684\u6b21\u6570\u4e00\u5b9a\u4e0d\u8d85\u8fc7 $\\log v$ \u6b21\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u70b9\u8df3\u5230\u5176\u7236\u4eb2\uff0c\u4e0d\u662f\u5c06\u5176\u7236\u4eb2\u7684\u6240\u6709\u5b69\u5b50\u7684 $siz$ \u5168\u90e8\u52a0\u8d77\u6765\u7684\u6b21\u6570\uff0c\u4e0d\u8d85\u8fc7 $\\log v$ \u6b21\u3002\n\n\u90a3\u4e48\uff0c\u8fd9\u4e2a \u201c\u5c06\u6240\u6709\u5144\u5f1f\u7684\u503c\u5168\u90e8\u52a0\u8d77\u6765\u201d \u5c31\u53ef\u4ee5\u542f\u53d1\u6211\u4eec\u505a\u4e00\u70b9\u4ec0\u4e48\u4e86\uff0c\u6bd4\u5982\u500d\u589e\u4f18\u5316\u3002\n\n\u800c\u6211\u4eec\u73b0\u5728\u7684\u4efb\u52a1\u5c31\u662f\u5904\u7406\u54ea\u4e9b\u70b9\u662f\u9700\u8981\u505c\u4e0b\u8ba1\u7b97\u7b54\u6848\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4e00\u4e2a\u500d\u589e $dp.$\n\n\u8bbe $t[i][j]$ \u8868\u793a\u8282\u70b9 $i$ \u5411\u4e0a\u8df3 $2^j$ \u6b65\uff0c\u8282\u70b9 $i$ \u7684\u6d41\u91cf\u81f3\u5c11\u591a\u5927\uff0c\u624d**\u4e0d\u4f1a\u88ab\u500d\u589e\u3002**\n\n\u9996\u5148\u628a\u4e0a\u9762\u8bf4\u7684\u4e00\u8def\u52a0\u7684\u6570\u7ec4\u6c42\u51fa\u6765\uff0c\u8bbe\u4e3a $s[i][j],$ \u90a3\u4e48\u5bf9\u5e94 $t$ \u7684\u8f6c\u79fb\u5f0f\u5c31\u5e94\u8be5\u662f\uff1a\n\n$$t[i][j]=\\max\\{t[i][j-1],t[fa[i][j-1]][j-1]-s[i][j-1]\\}$$\n\n\u610f\u601d\u5c31\u662f\u8981\u51cf\u53bb\u8df3\u5230 $f[i][j-1]$ \u5904\u589e\u52a0\u7684\u589e\u91cf\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u7279\u6b8a\u8ba1\u7b97\u7684\u7b54\u6848\uff0c\u628a\u4e00\u4e2a\u70b9\u7684\u513f\u5b50\u6309\u7167 $siz$ \u6392\u5e8f\u5c31\u53ef\u4ee5\u4e8c\u5206\u5904\u7406\u7b54\u6848\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log v\\log n)$\n\n\u6ce8\u610f $t$ \u7684\u7ec6\u8282\uff08\u5c31\u662f\u56e0\u4e3a\u8fd9\u4e2a\u6539\u4e86\u4e00\u4e0b\u5348\uff09 $t[i][0]$ \u8d4b\u503c\u7684\u65f6\u5019\u6ce8\u610f\u770b\u770b\u662f\u4e0d\u662f\u6070\u597d\u8d4b\u503c\u6210\u4e86\u4ed6\u81ea\u5df1\uff0c\u5982\u679c\u662f\u7684\u8bdd\u9700\u8981\u6539\u4e3a\u6b21\u5927\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef double db;\n//#define int long long\n#define fi first\n#define se second\n#define mk make_pair\n#define pb emplace_back\n#define poly vector<int>\n#define Bt(a) bitset<a>\n#define bc __builtin_popcount\n#define pc putchar\n#define ci const int&\n#define DEBUG(x) printf(\"%d :\",x),puts(\"--------------------------------------\")\nconst int mod = 1e9 + 7;\nconst db eps = 1e-10;\nconst int inf = (1 << 30);\ninline int Max(ci x, ci y) {return x > y ? x : y;}\ninline int Min(ci x, ci y) {return x < y ? x : y;}\ninline db Max(db x, db y) {return x - y > eps ? x : y;}\ninline db Min(db x, db y) {return x - y < eps ? x : y;}\ninline int Add(ci x, ci y, ci M = mod) {return (x + y) % M;}\ninline int Mul(ci x, ci y, ci M = mod) {return 1ll * x * y % M;}\ninline int Dec(ci x, ci y, ci M = mod) {return (x - y + M) % M;}\ntypedef pair<int, int> pii;\ninline int Abs(int x) {return x < 0 ? -x : x;}\n//char buf[1<<22],*p1=buf,*p2=buf;\n//#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar Obuf[105000],*O=Obuf;//Siz shoule be the size of Out File\nint pst[30],ptop;\ninline void Fprint(){fwrite(Obuf,1,O-Obuf,stdout);}\ninline void Fwrite(long long x){\n  if(x==0){*O++='0';return;}\n  if(x<0)*O++='-',x=-x;ptop=0;\n  while(x)pst[++ptop]=x%10,x/=10;\n  while(ptop)*O++=pst[ptop--]+'0';\n  if(O-Obuf>100000)Fprint(),O=Obuf;\n}\ninline int read() {\n    int s = 0, w = 1;\n    char ch = getchar();\n    while (!isdigit(ch)) {if (ch == '-') w = -1;ch = getchar();}\n    while (isdigit(ch)) {s = s * 10 + ch - '0';ch = getchar();}\n    return s * w;\n}\ninline void write(long long x) {\n    if (x < 0)putchar('-'), x = -x;\n    if (x > 9)write(x / 10);\n\tpc(x % 10 + '0');\n}\ninline int qpow(int x, int y) {\n    int res = 1;\n    while (y) {if (y & 1)res = Mul(res, x);x = Mul(x, x);y >>= 1;}\n    return res;\n}\ninline void cadd(int &x, int y) {x += y;}\ninline void cmul(int &x, int y) {x *= y;}\ninline void cmax(int &x, int y) {x = Max(x, y);}\ninline void cmin(int &x, int y) {x = Min(x, y);}\nconst int N = 3e5+10;\nconst int SN = 20;\nnamespace Refined_heart{\n\tint pa[N],n,f[N][SN];\n\tlong long s[N][SN],val[N],t[N][SN],mxv[N];\n\tint head[N],tot;\n\tstruct E{int nxt,to;}e[N];\n\tinline void link(int x,int y){\n\t\te[++tot]=(E){head[x],y};\n\t\thead[x]=tot;\n\t}\n\tvector<long long>G[N],pre[N];\n\tlong long siz[N];\n\tvoid dfs1(int x){\n\t\tsiz[x]=val[x];mxv[x]=0;f[x][0]=pa[x];\n\t\tfor(int i=head[x];i;i=e[i].nxt){\n\t\t\tdfs1(e[i].to);\n\t\t\tsiz[x]+=siz[e[i].to];\n\t\t\tG[x].pb(siz[e[i].to]);\n\t\t}\n\t}\n\tvoid dfs2(int x){\n\t\tfor(int i=1;i<SN;++i)f[x][i]=f[f[x][i-1]][i-1];\n\t\tif(x){\n\t\t\tt[x][0]=mxv[pa[x]];\n\t\t\tif(siz[x]==t[x][0]&&G[pa[x]].size()>1)t[x][0]=G[pa[x]][(int)G[pa[x]].size()-2];\n\t\t\telse if(siz[x]==t[x][0])t[x][0]=0;\n//\t\t\tif(G[f[x][0]].size() == 1)t[x][0] = 0;\n//\t\t\telse t[x][0]=G[f[x][0]][(int)G[f[x][0]].size()-1-(G[f[x][0]][(int)G[f[x][0]].size()-1] == siz[x])];\n\t\t\tlong long v=siz[pa[x]]-val[pa[x]];\n\t\t\tv-=siz[x];\n\t\t\ts[x][0]=v;\n\t\t\tfor(int i=1;i<SN;++i)s[x][i]=s[x][i-1]+s[f[x][i-1]][i-1];\n\t\t\tfor(int i=1;i<SN;++i)t[x][i]=max(t[x][i-1],t[f[x][i-1]][i-1]-s[x][i-1]);\n\t\t}\n\t\tfor(int i=head[x];i;i=e[i].nxt){dfs2(e[i].to);}\n\t}\n\tvoid solve(){\n\t\tn=read();\n\t\tfor(int i=1;i<=n;++i)pa[i]=read(),val[i]=read();\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tif(pa[i]==i)pa[i]=0;\n\t\t\tlink(pa[i],i);\n\t\t}\n\t\tdfs1(0);\n\t\tfor(int i=0;i<=n;++i)sort(G[i].begin(),G[i].end());\n\t\tfor(int i=0;i<=n;++i){\n\t\t\tif(G[i].empty())continue;\n\t\t\tmxv[i]=G[i].back();\n\t\t\tpre[i].pb(G[i][0]);\n\t\t\tfor(int j=1;j<(int)G[i].size();++j){\n\t\t\t\tlong long v=pre[i].back();\n\t\t\t\tv+=G[i][j];\n\t\t\t\tpre[i].pb(v);\n\t\t\t}\n\t\t}\n\t\tdfs2(0);\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tint x=i;\n\t\t\tlong long now=siz[i];\n\t\t\twhile(x){\n\t\t\t\tfor(int ii=SN-1;~ii;--ii){\n\t\t\t\t\tif(x&&now>=t[x][ii]){\n\t\t\t\t\t\tnow+=s[x][ii];\n\t\t\t\t\t\tx=f[x][ii];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!x)break;\n\t\t\t\tx=pa[x];\n\t\t\t\tint pos=upper_bound(G[x].begin(),G[x].end(),now)-G[x].begin();\n\t\t\t\tlong long sn=now;\n\t\t\t\tif(pos>0)now+=pre[x][pos-1];\n\t\t\t\tnow+=1ll*((int)G[x].size()-pos-1)*sn;\n\t\t\t}\n\t\t\tFwrite(now);*O++='\\n';\n\t\t}\n\t\tFprint();\n\t}\n}\nsigned main(){\n// \tfreopen(\"in.txt\",\"r\",stdin);\n// \tfreopen(\"My.out\",\"w\",stdout);\n\tRefined_heart::solve();\n\treturn 0;\n}\n\n```\n",
        "postTime": 1641718929,
        "uid": 128591,
        "name": "Refined_heart",
        "ccfLevel": 9,
        "title": "CF1578J Just Kingdom \u9898\u89e3"
    }
]