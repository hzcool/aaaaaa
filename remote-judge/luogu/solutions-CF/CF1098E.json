[
    {
        "content": "\u65e2\u7136\u5df2\u7ecf\u5199\u4e86\u90a3\u5e72\u8106\u5c31\u8d21\u732e\u5230\u76f8\u5e94\u7684\u9898\u76ee\u4e0a\u4f9b\u4eca\u540e\u7684\u5de8\u4f6c\u4eec\u53c2\u8003\u5427\n\n[**\u9898\u9762**](https://www.luogu.com.cn/problem/CF1098E)\n\n\n**\u9898\u89e3**\n\n~~\u83dc\u9e21\u7684\u535a\u4e3b\u7b2c\u4e00\u6b21\u5199\u7c7b\u6b27\u5199\u4e86\u597d\u4e45~~\n\n\u5bb9\u6613\u77e5\u9053b\u7684\u957f\u5ea6\u662f$n^2$\u7ea7\u522b\u7684 \u8fd9\u5c31\u5f88\u70e6 \u4e0d\u8fc7\u597d\u5728$a_i<=10^5$,\u4e8e\u662fb\u7684\u503c\u57df\u6709\u9650 \u53ef\u4ee5\u8003\u8651\u6c42cnt[d]\u8868\u793agcd==d\u7684\u5b50\u6bb5\u6709\u591a\u5c11\u4e2a\n\n\u8fd9\u4e2a\u95ee\u9898\u8fd8\u662f\u5f88\u597d\u89e3\u51b3\u7684\u3002\u5f88\u663e\u7136\u540c\u4e00\u5de6\u7aef\u70b9\u7684\u5b50\u6bb5\u4eec\u6700\u591a\u53ea\u6709log\u4e2a\u4e0d\u540c\u7684gcd\uff0c\uff08\u56e0\u4e3a\u8fd9\u4e9bgcd\u90fd\u5fc5\u987b\u662fa[\u5de6\u7aef\u70b9]\u7684\u56e0\u6570\uff0c\u800c\u4e14\u53f3\u7aef\u70b9\u8f83\u5927\u7684\u5b50\u6bb5gcd\u4e00\u5b9a\u662f\u53f3\u7aef\u70b9\u8f83\u5c0f\u7684\u5b50\u6bb5\u7684gcd\u7684\u56e0\u6570\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u5904\u7406\u51fagcd\u7684ST\u8868 \u7136\u540e\u679a\u4e3e\u5de6\u7aef\u70b9\uff0c\u500d\u589e\u7684\u641e\u53f3\u7aef\u70b9\u3002\u679a\u4e3e\u5de6\u7aef\u70b9$O(n)$\uff0c\u6709$O(log)$\u4e2a\u4e0d\u540c\u7684gcd\uff0c\u6bcf\u4e2agcd\u82b1\u8d39$O(log)$\u7684\u65f6\u95f4\u500d\u589e\uff0c\u500d\u589e\u7684\u65f6\u5019\u8981\u7528\u4e00\u4e2a$O(log)$\u8ba1\u7b97gcd\uff0c\u6240\u4ee5\u8fd9\u4e2a\u90e8\u5206\u662f\u5c0f\u5e38\u6570$O(nlog^3)$\u7684\n\n\u73b0\u5728\u518d\u6765\u8003\u8651\u4e0b\u4e00\u4e2a\u95ee\u9898\uff1a\u600e\u4e48\u6c42\u4e2d\u4f4d\u6570\u3002\u9996\u5148\u80af\u5b9a\u5148\u4e8c\u5206\u4e00\u4e2a\u7b54\u6848mid\uff0c\u7136\u540e\u8003\u8651\u600e\u4e48\u6c42\u533a\u95f4\u548c<=mid\u7684\u533a\u95f4\u4e2a\u6570\u3002\u5148\u4e0d\u7ba1\u8fd9\u4e2a\uff0c\u5148\u8003\u8651\u4e00\u4e0b\u4ee5\u4e0b\u8fd9\u4e2a\u95ee\u9898\uff0c\u6709n\u4e2a\u6570a[1~n],\u73b0\u5728\u7ed9\u4e00\u4e2a\u503cmaxsum\uff0c\u6c42\u533a\u95f4\u548c<=maxsum \u7684\u533a\u95f4\u4e2a\u6570\u3002\u8fd9\u4e2a\u95ee\u9898\u5404\u4f4d\u5de8\u4f6c\u80af\u5b9a\u79d2\u5207\uff0c\u76f4\u63a5\u53cc\u6307\u9488\uff0c\u4e00\u4e2a\u6307\u9488\u8868\u793a\u5de6\u7aef\u70b9\uff0c\u4e00\u4e2a\u8868\u793a\u53f3\u7aef\u70b9\uff0c\u6bcf\u6b21while\u5faa\u73af\u4e00\u4e0b\u3002\u7136\u540e\u539f\u95ee\u9898\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u4e5f\u8003\u8651\u7528\u53cc\u6307\u9488\u505a\u3002\n\n\u6211\u4eec\u521a\u521a\u6c42\u51fa\u4e86cnt\u6570\u7ec4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u53cd\u5e94\u7684\u5c31\u662fb\u6570\u7ec4\uff0c\u628a\u76f8\u540c\u7684\u6570\u5408\u5e76\u540e\u4e2a\u6570\u3002\u6211\u4eec\u628acnt\u79bb\u6563\u5316\u5230\u6570\u7ec4lsh\uff0c\u5c31\u5982\u4e0b\u7b80\u5355\u5730\u79bb\u6563\u5316\u5c31\u53ef\uff1a\n\n```cpp\n\tfor(int i=1;i<maxn;i++)if(cnt[i])lsh[++lt]=i;\n```\n\n\u8003\u8651\u5728lsh\u6570\u7ec4\u4e0a\u6c42\u7b54\u6848\u3002\u5148\u628a\u6240\u6709\u6570\u90fd\u76f8\u7b49\u7684\u533a\u95f4\u7ed9\u641e\u4e86 \u3002\u8fd9\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\n\n```cpp\n\tfor(int i=1;i<=lt;i++)\n\t{\n\t\tll cur=min(cnt[lsh[i]],mid/lsh[i]);\n\t\tans+=(2*cnt[lsh[i]]-cur+1)*cur/2; \n\t}\n```\n\n\u8fd9\u4e48\u968f\u4fbf\u641e\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\u7136\u540e\u5c31\u662f\u8de8\u8fc7\u591a\u4e2a\u6570\u7684\u533a\u95f4\u548c\u3002\n\n\u5047\u8bbe\u73b0\u5728\u53cc\u6307\u9488\u5230\u7684\u5de6\u7aef\u70b9\u662fl,\u53f3\u7aef\u70b9\u662fr\uff0c\u90a3\u4e48\u5c31\u8003\u8651\u6709\u591a\u5c11\u4e2ab\u6570\u7ec4\u7684\u533a\u95f4\u6ee1\u8db3sum<=mid,\u5de6\u7aef\u70b9**\u503c**\u4e3alsh[l],\u53f3\u7aef\u70b9\u503clsh[r]\u3002\u4e0b\u9762\u7528res\u8868\u793a\u8fd9\u4e2a\u7b54\u6848\u3002\n\n\u4ee4$A=lsh[l],B=lsh[r],SA=cnt[A]=cnt[lsh[l]],SB=cnt[B]=cnt[lsh[r]]$\n\n$SUM=\\sum_{i=l+1}^{r-1}cnt[lsh[i]]\\times lsh[i]$ (SUM\u5c31\u662fb\u6570\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u5927\u4e8eA\u7684\u6570\u5230\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8eB\u7684\u6570\u4e4b\u548c)\n\n\u90a3\u4e48\u5982\u679c$A\\times SA+B\\times SB+SUM<=mid$,\u8fd9\u4e2a\u533a\u95f4\u548c\u5728B\u6570\u7ec4\u4e2d\u7684\u5de6\u53f3\u7aef\u70b9\u5c31\u5728A\u4e0eB\u968f\u4fbf\u9009\u4f4d\u7f6e\uff0c\u7b54\u6848\u5c31\u662f$res=SA*SB$\n\n\u5426\u5219\u7684\u8bdd\u5c31\u6709\u4e9b\u9ebb\u70e6\u4e86\u3002\u5f00\u59cb\u63a8\u67ff\u5b50\uff1a\uff08\u9664\u6cd5\u4e0b\u53d6\u6574\uff09\n\n$$res=\\sum_{i=1}^{SA}\\sum_{j=1}^{SB}[SUM+i\\times A+j\\times B<=mid]$$\n\n$$=\\sum_{i=1}^{SA}min(max(0,\\frac{mid-SUM-i*A}{B}),SB)$$\n\n\u4f17\u6240\u5468\u77e5min(a,b)=a-max(0,a-b),\u4e8e\u662f\n\n$$res=\\sum_{i=1}^{SA}max(0,\\frac{mid-SUM-i*A}{B})-\\sum_{i=1}^{SA}max(0,max(0,\\frac{mid-SUM-i*A}{B})-SB)$$\n\n$$=\\sum_{i=1}^{SA}max(0,\\frac{mid-SUM-i*A}{B})-\\sum_{i=1}^{SA}max(0,max(-SB,\\frac{mid-SUM-i*A-B*SB}{B}))$$\n\n$$=\\sum_{i=1}^{SA}max(0,\\frac{mid-SUM-i*A}{B})-\\sum_{i=1}^{SA}max(0,\\frac{mid-SUM-i*A-B*SB}{B})$$\n\n\u8bf6\u7ed3\u6784\u4e00\u6837\u4e86\uff01nice\u3002\u89c2\u5bdf\u53d1\u73b0\u73b0\u5728\u53ea\u9700\u8981\u77e5\u9053\u4e00\u4e2a\u957f\u6210$\\sum_{i=1}^{n}max(0,\\lfloor \\frac{a\\times i+b}{c}\\rfloor)$\u6837\u5b50\u7684\u67ff\u5b50\u600e\u4e48\u6c42\u5c31\u597d\u4e86\u3002\n\n\u611f\u89c9\u8fd9\u4e2a\u67ff\u5b50\u5f88\u50cf\u7c7b\u6b27\u3002\u60b2\u54c0\u7684\u662fa\u548cb\u6709\u53ef\u80fd\u662f\u8d1f\u6570\u3002\u60f3\u529e\u6cd5\u628a\u4ed6\u53d8\u6b63\n\n\u5148\u5982\u679ca<0,\u4ee4b+=a*n\uff0ca=-a,\u663e\u7136\u7b54\u6848\u4e0d\u53d8\u3002\n\n\u90a3\u4e48\u73b0\u5728a\u80af\u5b9a\u6b63\u4e86\uff0c\u518d\u5982\u679cb<0,\u90a3\u4e48\u4ee4$d=\\lfloor \\frac{-b}{a}\\rfloor$\uff0ci<d\u65f6$\\sum_{i=1}^{n}\\lfloor \\frac{a\\times i+b}{c}\\rfloor$\u6052\u8d1f\uff0c\u6240\u4ee5\u8ddf0\u53d6max\u4e00\u76f4\u662f0\u3002\u4ee4n-=d,b+=a*d,\u7b54\u6848\u4e0d\u53d8\u3002\n\n\u8fd9\u4e48\u6765a\uff0cb\u90fd\u6b63\u4e86\uff0c\u800c\u4e14\u628ab\u53d8\u6b63\u7684\u540c\u65f6\u987a\u4fbf\u628a\u90a3\u4e2a\u8ba8\u538c\u7684max\u4e5f\u641e\u6389\u4e86\uff0c\u8fd9\u5c31\u53d8\u6210\u4e00\u4e2a\u59a5\u59a5\u7684\u7c7b\u6b27\u677f\u5b50\u4e86\u3002\u76f4\u63a5\u5957\u677f\u5b50\u5c31\u597d\u4e86\n\n\u6ce8\u610f\u4e00\u4e0b\u7ec6\u8282\uff0c\u7c7b\u6b27\u7684sigma\u7684\u4e0b\u6807\u662fi=0\uff0c\u5b9e\u9645\u5199\u7684\u65f6\u5019\u4e3a\u4e86\u9002\u5e94\u7c7b\u6b27\u7279\u6b8a\u5730\u641e\u4e00\u4e0b\n\n\u4e8c\u5206\u6c42\u7b54\u6848\u8fd9\u90e8\u5206\uff0c\u4e8c\u5206\u4e00\u4e2alog\uff0c\u53cc\u6307\u9488\u4e00\u4e2an\uff0c\u4e0a\u9762\u7684\u7c7b\u6b27\u4e00\u4e2alog\uff0c\u603b\u5171$O(nlog^2)$\n\n\u5199\u4e86\u597d\u4e45\u603b\u611f\u89c9\u6ca1\u8bb2\u6e05\u695a\u4e0d\u8fc7\u6211\u5c3d\u529b\u4e86 \u90a3\u5c31\u653e\u4e2a\u4e8c\u5206\u7684\u6c42\u533a\u95f4\u548c<=mid\u7684\u533a\u95f4\u6570\u4ee3\u7801\u628a\n\n```cpp\n//\u6570\u7ec4\u540d\u4e0e\u9898\u89e3\u4e00\u81f4\nll solve(ll a,ll b,ll c,ll n)\n{\n\tif(a<0)b+=a*n,a=-a;\n\tif(b<0)\n\t{\n\t\tll d=(a-b-1)/a;\n\t\tn-=d;\n\t\tb+=a*d;\n\t}\n\tif(n<0)return 0;\n\treturn (n*(n+1)/2)*(a/c)+(n+1)*(b/c)+f(a%c,b%c,c,n);//f\u662f\u4e00\u4e2a\u7c7b\u6b27\u6a21\u677f\n}\nint MID; \nll get(int l,int r,ll sum)//\u5de6\u8fb9l\uff0c\u53f3\u8fb9r\uff0cl+1~r-1\u603b\u548c\u4e3asum\uff0c\u5168\u90e8\u7684\u548c\u4e0d\u8d85\u8fc7MID\n{\n\tll a=lsh[l],b=lsh[r],sa=cnt[lsh[l]],sb=cnt[lsh[r]];\n\tif((ll)a*sa+sum+(ll)b*sb<=MID)return (ll)sa*sb; \n\treturn solve(-a,MID-sum-a,b,sa-1)-solve(-a,MID-sum-a-b*sb,b,sa-1);\n} \nll check(int mid)\n{\n\tll ans=0;\n\tMID=mid;\n\t//\u5168\u90e8\u76f8\u540c\u7684sum \n\tfor(int i=1;i<=lt;i++)\n\t{\n\t\tll cur=min(cnt[lsh[i]],mid/lsh[i]);\n\t\tans+=(cnt[lsh[i]]+cnt[lsh[i]]-cur+1)*cur/2; \n\t}\n\t//\u4e0d\u540c\n    for(int lp=1,rp=2,qh,gs=qh=0;lp<lt;lp++)\n\t{\n\t\tif(lsh[lp]>mid)break;\n\t\twhile(rp<=lp)qh+=(ll)cnt[lsh[rp]]*lsh[rp],gs+=cnt[lsh[rp]],rp++;\n\t\tans+=gs*cnt[lsh[lp]];\n\t\twhile(rp<lt&&qh+(ll)cnt[lsh[rp]]*lsh[rp]<=mid)\n\t\t{\n\t\t\tif(lp<rp)ans+=get(lp,rp,qh);\n\t\t\tqh+=(ll)cnt[lsh[rp]]*lsh[rp],gs+=cnt[lsh[rp]],rp++;\n\t\t}\n\t\tans+=get(lp,rp,qh);\n\t\tqh-=(ll)cnt[lsh[lp+1]]*lsh[lp+1];\n\t\tgs-=(ll)cnt[lsh[lp+1]];\n\t }\n\treturn ans; \n}\n```\n\n\u535a\u4e3b\u5de8\u8521\u6709\u9519\u8bf7\u5927\u4f6c\u6307\u51fa",
        "postTime": 1588260558,
        "uid": 61502,
        "name": "Nerovix",
        "ccfLevel": 0,
        "title": "[CF1098E]\u516c\u7ea6\u6570\u4e0e\u6700\u5927\u6570(gcd ST+\u53cc\u6307\u9488+\u7c7b\u6b27)"
    },
    {
        "content": "### Sol  \n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/dd-d/p/15905801.html)  \n\u5148\u8003\u8651\u90a3\u4e2a $\\gcd$ \u64cd\u4f5c\u3002  \n\u663e\u7136\u53ef\u4ee5\u679a\u4e3e\u53f3\u7aef\u70b9\u7ef4\u62a4\u3002\u4e00\u4e2a\u53f3\u7aef\u70b9\u5bf9\u5e94\u7684 $\\gcd$ \u53ea\u6709 $\\log$ \u79cd\u3002  \n\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728 $n \\log^2 a_i$ \u5185\u5904\u7406\u51fa $cnt$ \u6570\u7ec4\u3002\u5176\u4e2d\uff0c$cnt_i$ \u8868\u793a $b$ \u4e2d\u6709 $cnt_i$ \u4e2a $i$\u3002  \n\u8003\u8651\u4e8c\u5206\u7b54\u6848\uff0c\u4e8c\u5206 $mid$\u3002  \n\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u6c42 $c$ \u4e2d\u6bd4 $mid$ \u5c0f\u7684\u6570\u7684\u6570\u91cf\uff0c\u4e5f\u5c31\u662f $b$ \u4e2d\u6709\u51e0\u4e2a\u533a\u95f4\u7684\u548c\u5c0f\u4e8e $mid$\u3002  \n\u663e\u7136\uff0c\u5bf9\u4e8e $b_l=b_r$ \u7684\u533a\u95f4\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u3002\u8003\u8651 $b_l \\lt b_r$\u3002  \n\u9996\u5148\u4e00\u4e2a\u533a\u95f4\u5fc5\u987b\u6ee1\u8db3 $sum(l,r)=\\sum_{b_l \\lt b_i \\lt b_r} b_i \\lt mid$ \u624d\u6709\u8d21\u732e\u3002  \n\u5982\u679c $\\sum_{l \\leq i \\leq r} cnt_i \\lt mid$ \u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u52a0\u4e0a $cnt_l \\times cnt_r$\u3002\u8fd9\u79cd\u533a\u95f4\u6570\u91cf\u6709\u5f88\u591a\uff0c\u53ef\u4ee5\u679a\u4e3e $l$ \u7136\u540e\u53cc\u6307\u9488\u6c42\u51fa $r$ \u7684\u533a\u95f4\u3002  \n\u5426\u5219\u8fd9\u4e2a\u533a\u95f4\u4e00\u5b9a\u6ee1\u8db3 $\\left[l-1,r \\right]$ \u6216 $\\left[l,r-1 \\right]$ \u6ca1\u6709\u8d21\u732e\uff0c\u56e0\u6b64\u6570\u91cf\u662f $O(n)$ \u7ea7\u522b\u7684\u3002\u53cc\u6307\u9488\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u987a\u5e26\u6c42\u51fa\u8fd9\u4e9b\u533a\u95f4\u3002  \n\u628a\u8fd9\u4e9b\u533a\u95f4\u7684\u8d21\u732e\u5199\u51fa\u6765\uff1a  \n$$\n\\sum_{i=1}^{cnt_l} \\sum_{j=1}^{cnt_r} \\left[li+sum(i,j)+rj \\lt mid \\right]\n$$  \n\u7528\u5b57\u6bcd\u4ee3\u66ff\u5e38\u91cf\u5f97  \n$$\n\\sum_{i=0}^{A} \\sum_{j=0}^{B} \\left[ai+bj \\leq c \\right]\n$$  \n\u8bb0 $s=\\min(A,\\lfloor \\frac{c}{a} \\rfloor)$\uff0c$t=\\min(B,\\lfloor \\frac{c}{b} \\rfloor)$\uff0c\u5219  \n$$\n\\begin{aligned}\n& \\sum_{i=0}^{A} \\sum_{j=0}^{B} \\left[ai+bj \\leq c \\right] \\\\\n=& \\sum_{i=0}^{s} \\sum_{j=0}^{t} \\left[a(s-i)+bj\\le c\\right]\\\\\n=& (s+1)(t+1) - \\sum_{i=0}^{s} \\sum_{j=0}^{t} \\left[ai+bj\\le as+bt-c-1\\right] \\\\\n=& (s+1)(t+1) - \\sum_{i=0}^{\\infty} \\sum_{j=0}^{\\infty} \\left[ai+bj\\le as+bt-c-1\\right]\n\\end{aligned}\n$$\n\u5bf9\u4e8e\u540e\u9762\u90a3\u4e00\u5768\uff0c\u8bb0 $n=\\lfloor \\frac{c}{a} \\rfloor$\uff0c\u5219  \n$$\n\\begin{aligned}\n& \\sum_{i=0}^{\\infty} \\sum_{j=0}^{\\infty} \\left[ai+bj \\leq c \\right] \\\\\n=& \\sum_{i=0}^{n} \\sum_{j=0}^{\\infty} \\left[a(n-i)+bj\\leq c\\right]\\\\\n=& \\sum_{i=0}^{n} \\sum_{j=0}^{\\infty} \\left[j+1 \\leq \\frac{ai+c-an+b}{b}\\right]\\\\\n=& f(n,a,c-an+b,b)\n\\end{aligned}\n$$  \n\u7c7b\u6b27\u5373\u53ef\u3002  \n### Code  \n```cpp\n//LYC_music yyds!\n#include<bits/stdc++.h>\n#define IOS ios::sync_with_stdio(0)\n#define lowbit(x) (x&(-x))\n#define int long long\nusing namespace std;\ninline char gc()\n{\n\tstatic char buf[1000000],*p1=buf,*p2=buf;\n\treturn p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++;\n}\nint read()\n{\n\tint pos=1,num=0;\n\tchar ch=getchar();\n\twhile (!isdigit(ch))\n\t{\n\t\tif (ch=='-') pos=-1;\n\t\tch=getchar();\n\t}\n\twhile (isdigit(ch))\n\t{\n\t\tnum=num*10+(int)(ch-'0');\n\t\tch=getchar();\n\t}\n\treturn pos*num;\n}\nvoid write(int x)\n{\n\tif (x<0)\n\t{\n\t\tputchar('-');\n\t\twrite(-x);\n\t\treturn;\n\t}\n\tif (x>=10) write(x/10);\n\tputchar(x%10+'0');\n}\nvoid writesp(int x)\n{\n\twrite(x);\n\tputchar(' ');\n}\nvoid writeln(int x)\n{\n\twrite(x);\n\tputchar('\\n');\n}\nconst int N=1e6+10;\nint sum[N],cnt[N],v[N],w[N],a[N],b[N],n,t,c[N],x,y,ans,now;\nint f(int a,int b,int c,int n)\n{\n\tint ac=a/c,bc=b/c,m=(a*n+b)/c,n1=n+1,n21=n*2+1,res=0;\n\tif (!a) return bc*n1;\n\telse if (a>=c||b>=c)\n\t{\n\t\tres=n*n1/2*ac+bc*n1;\n\t\tint now=f(a%c,b%c,c,n);\n\t\tres+=now;\n\t\treturn res;\n\t}\n\tint now=f(c,c-b-1,a,m-1);\n\tres=n*m-now;\n\treturn res;\n}\nint calc(int A,int B,int a,int b,int c)\n{\n//\tcout<<A<<' '<<B<<' '<<a<<' '<<b<<' '<<c<<endl;\n\tif (A<0||B<0||c<0) return 0;\n\tint s=min(A,c/a),t=min(B,c/b),p=a*s+b*t-c-1,r=(s+1)*(t+1);\n\tif (p<0) return r;\n\tint n=p/a;\n\treturn r-f(a,p-a*n+b,b,n);\n}\nint calc(int n,int m)\n{\n\treturn m*(2*n-m+1)/2;\n}\nbool check(int x)\n{\n\tint res=0,j=0;\n\tfor (int i=1;i<=100000;i++)\n\t\tif (c[i])\n\t\t{\n\t\t\tres+=calc(c[i],min(c[i],(x-1)/i));\n\t\t\tif (i<j) res+=c[i]*(cnt[j-1]-cnt[i])+calc(c[i]-1,c[j]-1,i,j,x-(sum[j-1]-sum[i])-i-j-1);\n\t\t\twhile (j<=100000&&sum[j]-sum[i]<x)\n\t\t\t\tif (i<++j) res+=calc(c[i]-1,c[j]-1,i,j,x-(sum[j-1]-sum[i])-i-j-1);\n\t\t}\n\treturn res<now;\n}\nint val(int x)\n{\n\treturn x*(x+1)/2;\n}\nsigned main()\n{\n\tn=read();\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tint g=0,top=0,last=i+1;\n\t\ta[++t]=read(); b[t]=i;\n\t\tfor (int j=t;j;j--)\n\t\t{\n\t\t\tif (!g||a[j]%g) v[++top]=g=__gcd(g,a[j]);\n\t\t\tc[g]+=last-b[j]; last=w[top]=b[j];\n\t\t}\n\t\tfor (t=0;top;) b[++t]=w[top],a[t]=v[top--];\n\t}\n\tfor (int i=1;i<=100000;i++)\n\t\tsum[i]=x+=c[i]*i,cnt[i]=y+=c[i];\n\tnow=(val(val(n))+1)/2;\n\tint l=1,r=sum[100000];\n\twhile (l<=r)\n\t{\n\t\tint mid=(l+r)>>1;\n\t\tif (check(mid)) ans=mid,l=mid+1;\n\t\telse r=mid-1;\n\t}\n\twriteln(ans);\n}\n\n\n\n\n\n```",
        "postTime": 1645091999,
        "uid": 167999,
        "name": "dd_d",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011CF1098E Fedya the Potter"
    }
]