[
    {
        "content": "$f_{l, r}$ \u8868\u793a\u70b9 $l$ \u5230\u70b9 $r$ \u7684\u8def\u5f84\u4e0a\u7684\u7b54\u6848\u3002\u4e3a\u4e86\u65b9\u4fbf\u8f6c\u79fb\uff0c\u8bb0 $pa_{r, x}$ \u8868\u793a\u4ee5 $r$ \u4e3a\u6839\u65f6\uff0c$x$ \u7684\u7236\u4eb2\uff1b$d_{r, x}$ \u8868\u793a\u4ee5 $r$ \u4e3a\u6839\u65f6\uff0c$x$ \u7684\u6df1\u5ea6\u3002\n\n\u8003\u8651\u8bb0\u641c\u3002\n\n\u663e\u7136\u6709 $f_{l, r} = \\max\\{f_{pa_{y, x}, y}, f_{x, pa_{x, y}},f_{pa_{y, x}, pa_{x, y}} + 2\\times[s_x = s_y]\\}$\u3002\n\n\u8fb9\u754c\uff1a\n- $f_{x,y} = 1(d_{x, y}=1)$\n- $f_{x,y} = 1 + [s_x=s_y](d_{x, y}=2)$\n\n\u72b6\u6001\u6570 $n^2$\uff0c\u8f6c\u79fb $\\Theta(1)$\u3002\n\n[AC code record](https://www.luogu.com.cn/record/97901434)\n\n```cpp\nint n, pa[2010][2010], f[2010][2010], d[2010][2010]; vector <int> lnk[2010];\nchar s[2010];\n\nil void add(const int &x, const int &y) {\n\tlnk[x].eb(y); lnk[y].eb(x);\n}\n\nil void dfs(int rt, int x, int p) {\n\tpa[rt][x] = p; d[rt][x] = d[rt][p] + 1;\n\tfor (auto v : lnk[x]) if (v ^ p) dfs(rt, v, x);\n}\n\nil int dp(int x, int y) {\n\tif (~f[x][y]) return f[x][y];\n\tif (d[x][y] == 1) return f[x][y] = 1;\n\tif (d[x][y] == 2) return f[x][y] = (s[x] == s[y]) + 1;\n\treturn f[x][y] = max({dp(pa[y][x], y), dp(x, pa[x][y]), dp(pa[y][x], pa[x][y]) + 2 * (s[x] == s[y])});\n}\n\nint main() {\n\tfor (int T = read(); T--; ) {\n\t\tread(n); scanf(\"%s\", s + 1);\n\t\trep1(i, 2, n) add(read(), read());\n\t\trep1(i, 1, n) rep1(j, 1, n) f[i][j] = -1;\n\t\trep1(i, 1, n) dfs(i, i, 0);\n\t\tint ans = 0;\n\t\trep1(i, 1, n) rep1(j, 1, n) ans = max(ans, dp(i, j));\n\t\tprintf(\"%d\\n\", ans);\n\t\trep1(i, 1, n) lnk[i].clear();\n\t\trep1(i, 1, n) rep1(j, 1, n) pa[i][j] = f[i][j] = 0;\n\t}\n\trout;\n}\n```\n",
        "postTime": 1671876521,
        "uid": 409236,
        "name": "StayAlone",
        "ccfLevel": 6,
        "title": "CF1771D \u9898\u89e3"
    },
    {
        "content": "\u5148\u8003\u8651\u5e8f\u5217\u4e0a\u7684\u60c5\u51b5\uff0c\u8bbe $f(l,r)$ \u8868\u793a $s_{l\\dots r}$ \u7684\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u957f\u5ea6\uff0c\u8003\u8651 $l,r$ \u4f4d\u7f6e\u4e0a\u7684\u5b57\u7b26\uff0c\u53ef\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f(l,r)=\\max\\{f(l+1,r),f(l,r-1),f(l+1,r-1)+2[s_l=s_r]\\}$$\n\n\u5c06\u8fd9\u4e2a\u4e1c\u897f\u8f6c\u79fb\u5230\u6811\u4e0a\uff0c\u5373\u8bbe $f(x,y)$ \u8868\u793a $x,y$ \u8def\u5f84\u6784\u6210\u7684\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u957f\u5ea6\uff0c$fa(x,y)$ \u8868\u793a\u4ee5 $x$ \u4e3a\u6839\u65f6 $y$ \u7684\u7236\u4eb2\uff0c\u53ef\u5f97\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f(x,y)=\\max\\{f(fa(y,x),y),f(x,fa(x,y)),f(fa(y,x),fa(x,y))+2[s_x=s_y]\\}$$\n\n\u6700\u7ec8\u7b54\u6848\u5373\u4e3a $\\max_{x,y}f(x,y)$\uff0c\u53ef\u4ee5\u5199\u8bb0\u5fc6\u5316\u641c\u7d22\uff0c\u53ef\u80fd\u9700\u8981\u6ce8\u610f\u4e00\u4e9b\u7ec6\u8282\u3002\n\n```cpp\nconst int N=2e3+10;\nint n,mx[N][N],ans,fa[N][N]; char s[N]; vector<int> E[N];\n\nvoid dfs(int x,int fa,int root){\n    ::fa[root][x]=fa;\n    for(auto y:E[x]) if(y!=fa) dfs(y,x,root);\n}\n\nint calc(int x,int y){\n    if(x==y) return 1;\n    if(x==fa[1][y]||y==fa[1][x]) return 1+(s[x]==s[y]); // \u7279\u5224\u76f8\u90bb\u7684\u70b9\u3002\n    if(mx[x][y]) return mx[x][y];\n    return mx[x][y]=max({calc(x,fa[x][y]),calc(y,fa[y][x]),calc(fa[x][y],fa[y][x])+(s[x]==s[y]?2:0)});\n}\n\nsigned main(){\n    for(int T=read();T;--T){\n        n=read(),scanf(\"%s\",s+1),ans=0;\n        for(int i=1;i<=n;++i) for(int j=1;j<=n;++j) mx[i][j]=0;\n        for(int i=1;i<=n;++i) E[i].clear();\n        for(int u,v,i=1;i<n;++i){\n            u=read(),v=read();\n            E[u].emplace_back(v),E[v].emplace_back(u);\n        }\n        for(int i=1;i<=n;++i) dfs(i,0,i);\n        for(int i=1;i<=n;++i) for(int j=1;j<=n;++j) ans=max(ans,calc(i,j));\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1670848261,
        "uid": 336653,
        "name": "include_BM",
        "ccfLevel": 0,
        "title": "CF1771D Hossam and (sub-)palindromic tree"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u4e0a\u6709\u4e00\u4e2a\u5c0f\u5199\u5b57\u6bcd\u3002\u5b9a\u4e49 $s(i,j)$ \u8868\u793a\u5c06 $i\\to j$ \u8def\u5f84\u4e0a\u7ed3\u70b9\u7684\u5b57\u7b26\u987a\u6b21\u76f8\u63a5\u5f62\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u6c42\u6240\u6709 $s(i,j)$ \u7684\u6700\u957f\u56de\u6587**\u5b50\u5e8f\u5217**\u957f\u5ea6\u7684\u6700\u5927\u503c\u3002\n\n\u5148\u8003\u8651\u94fe\u4e0a\u7684\u60c5\u51b5\u3002\u4ee4 $dp(i,j)$ \u8868\u793a $i$ \u5230 $j$ \u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u957f\u5ea6\uff0c\u5219\u663e\u7136\u6709\u8f6c\u79fb\n$$\ndp(i,j)=\\max\\{dp(i+1,j),dp(i,j-1),dp(i+1,j-1)+2[s_i=s_j]\\}\n$$\n\u76f4\u63a5\u653e\u5230\u6811\u4e0a\uff0c\u5c31\u662f $O(n^2)$ \u72b6\u6001\u3001$O(1)$ \u8f6c\u79fb\u3002\u8bb0\u641c\u5373\u53ef\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define pb push_back\nconst int maxn = 2e3 + 10;\nint n, dp[maxn][maxn], rt, f[maxn], fa[15][maxn], dep[maxn];\nchar s[maxn];\nvector<int> edge[maxn];\nint solve(int x, int y, int lca){\n    if(dp[x][y]) return dp[x][y];\n    if(lca == x || lca == y){\n        if(dep[x] < dep[y]) swap(x, y);\n        if(dp[x][y]) return dp[x][y];\n        int det = dep[x] - dep[y] - 1, qwq = x;\n        if(!det) dp[x][y] = 1 + (s[x] == s[y]);\n        else{\n            for(int i = 0; i < 12; i++) if(det & (1 << i)) qwq = fa[i][qwq];\n            dp[x][y] = max({solve(x, qwq, qwq), solve(f[x], y, y), solve(f[x], qwq, qwq) + 2 * (s[x] == s[y])});\n        }\n        // printf(\"%d %d - %d\\n\", x, y, dp[x][y]);\n        return dp[x][y];\n    }\n    if(y != lca) dp[x][y] = max(dp[x][y], solve(x, f[y], lca));\n    if(x != lca) dp[x][y] = max(dp[x][y], solve(f[x], y, lca));\n    if(x != lca && y != lca) dp[x][y] = max(solve(f[x], f[y], lca) + 2 * (s[x] == s[y]), dp[x][y]);\n    // printf(\"%d %d - %d\\n\", x, y, dp[x][y]);\n    return dp[x][y];\n}\nvoid dfs(int u){\n    fa[0][u] = f[u], dep[u] = dep[f[u]] + 1;\n    for(int i = 1; i < 12; i++) fa[i][u] = fa[i - 1][fa[i - 1][u]];\n    for(int v : edge[u]) if(v != f[u]) f[v] = u, dfs(v);\n}\nint LCA(int x, int y){\n    if(dep[x] < dep[y]) swap(x, y);\n    int det = dep[x] - dep[y];\n    for(int i = 11; i >= 0; i--) if(det & (1 << i)) x = fa[i][x];\n    if(x == y) return x;\n    for(int i = 11; i >= 0; i--) if(fa[i][x] != fa[i][y]) x = fa[i][x], y = fa[i][y];\n    return f[x];\n}\nvoid wsyakioi(){\n    scanf(\"%d%s\", &n, s + 1);\n    for(int i = 1; i <= n; i++){\n        edge[i].clear();\n        for(int j = 1; j <= n; j++) dp[i][j] = 0;\n        dp[i][i] = 1;\n    }\n    for(int i = 1, x, y; i < n; i++){\n        scanf(\"%d%d\", &x, &y);\n        edge[x].pb(y), edge[y].pb(x);\n    }\n    if(n == 2) return puts(s[1] == s[2] ? \"2\" : \"1\"), void();\n    for(int i = 1; i <= n; i++) if(edge[i].size()) rt = i;\n    f[rt] = 0, dfs(rt); int ans = 1;\n    for(int i = 1; i <= n; i++) for(int j = i + 1; j <= n; j++) ans = max(ans, solve(i, j, LCA(i, j)));\n    printf(\"%d\\n\", ans);\n}\nint main(){\n    int T; scanf(\"%d\", &T);\n    while(T--) wsyakioi();\n    return 0;\n}\n```",
        "postTime": 1670824095,
        "uid": 170890,
        "name": "Cxny",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1771D Hossam and (sub-)palindromic tree"
    },
    {
        "content": "\u5178\u5178\u53ef\u7231\u9898\uff0c\u633a\u559c\u6b22\u7684\u3002  \n\n\n------------\n\u9898\u610f\uff1a  \n\u7ed9\u51fa\u4e00\u68f5\u6811\uff0c\u6bcf\u4e2a\u70b9\u662f\u4e00\u4e2a\u5b57\u7b26\uff0c\u6c42\u6811\u4e0a\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\uff08LPS\uff09\u7684\u957f\u5ea6\u3002  \n\n\n------------\n\u9898\u89e3\uff1a  \n\u9996\u5148\u4f60\u5f97\u77e5\u9053\uff0c\u6b63\u5e38\u7684\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u548b\u7b97\uff0c\u518d\u642c\u5230\u6811\u4e0a\u3002  \n\u5176\u5b9e\u672c\u8d28\u5c31\u662f\u4e2a\u533a\u95f4 dp\uff0c\u8bbe $dp_{i,j}$ \u8868\u793a $i$ \u5230 $j$ \u7684\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u3002  \n\u90a3\u4e48\u5f53 $a_i=a_j$ \u7684\u65f6\u5019\uff0c\u76f8\u5f53\u4e8e\u52a0\u957f\u4e86\u4e24\u4e2a\uff0c\u53ef\u4ee5\u8f6c\u79fb $dp_{i,j}=dp_{i+1,j-1}+2$ \uff0c\u53cd\u4e4b\u5c31\u662f $dp_{i,j}=max(dp_{i+1,j},dp_{i,j-1})$\uff0c\u66f4\u5177\u4f53\u7684\u521d\u59cb $dp_{i,i}=1$\u3002  \n\u90a3\u4e48\u600e\u4e48\u642c\u5230\u6811\u4e0a\u5462\u3002  \n\u6211\u4eec\u4e0d\u59a8\u8bbe $i$ \u548c $j$ \u5c31\u662f\u6811\u4e0a\u7684\u67d0\u4e24\u4e2a\u8282\u70b9\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u662f\u8981\u627e $i+1$ \u548c $j-1$ \u4e86\uff0c\u968f\u4fbf\u753b\u9897\u6811\u6a21\u62df\u4e00\u4e0b\uff0c\u4f60\u5c31\u53d1\u73b0\uff0c\u8fd9\u4e0d\u5c31\u662f $i$ \u7684\u7236\u4eb2\u8282\u70b9\u561b\u3002\u90a3\u4e48\u8f6c\u79fb\u5c31\u662f\u5728 $(x,fa[y])$\uff0c$(fa[x],y)$\uff0c$(fa[x],fa[y])$ \u8f6c\u79fb\u5566\u3002  \n\u8bb0\u5fc6\u5316\u4e00\u4e0b\u5c31\u597d\u4e86\u53ef\u4ee5 $n^2$  \n\u5f53\u7136\u7279\u6b8a\u7684\u6211\u4eec\u9700\u8981\u7279\u5224\u4e00\u4e0b\u4ed6\u4eec\u7684 $lca$ \u5728\u662f\u4ed6\u4eec\u7684\u5176\u4e2d\u4e00\u4e2a\uff0c\u6bd4\u5982\u6211\u968f\u4fbf\u753b\u4e86\u4e00\u4e2a\u56fe\u554a\uff08  \n![](https://3wt.img.zlkj.icu/2022/12-12/3728183af3b149e1885ae3605f6828083wcn351256.jpeg)  \n\u5982\u679c\u6211\u4eec\u66f4\u65b0\u5230 $i = 2$ $j = 4$ \u4e86\u55f7\u3002\u8fd9\u4e2a\u65f6\u5019\u518d $fa[i]$ \u5c31\u5230 $5$ \u4e86\uff0c\u4f46\u5b9e\u9645\u8ddf $5$ \u6ca1\u6709\u534a\u6bdb\u94b1\u5173\u7cfb\u3002\u6240\u4ee5\u8981\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\uff0c\u53ef\u4ee5\u500d\u589e\u627e\u5230\u8fd8\u5dee\u4e00\u4e2a\u70b9\u5c31\u5230 $i$ \u7684\u90a3\u4e2a\u70b9\uff0c\u7136\u540e\u548c\u524d\u9762\u4e00\u6837\u7684\u66f4\u65b0\u5c31\u597d\u4e86\u3002  \n\u6700\u540e\u6ce8\u610f\u4e00\u4e0b\u591a\u6d4b\u6e05\u7a7a\u5427\uff0c\u5176\u4ed6\u7684\u5c31\u6ca1\u4e86\u3002   \n\u6700\u540e\u4ee3\u7801\uff1a  \n```\n#include<cstdio>\n#include<cstring>\n#include<stdlib.h>\n#include<algorithm>\n#include<iostream>\n#include<vector>\n#include<set>\n#include<string>\n#include<map>\n#include<queue>\n#include<stack>\n#include<math.h>\n#define ll long long\nusing namespace std;\nconst int mod=1e9+7;\nconst int INF=0x3f3f3f3f;\n\ninline int read()\n{\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+c-'0',c=getchar();}\n\treturn x*f;\n}\nconst int N=5e3+10;\nstruct qwq{\n\tint to,ne;\n}e[N];\nint elast[N],num;\nvoid add(int from,int to)\n{\n\te[++num]={to,elast[from]};\n\telast[from]=num;\n}\nint lg[N],dep[N],f[N][30];\n\nvoid dfs(int x,int fa)\n{\n\tf[x][0]=fa,dep[x]=dep[fa]+1;\n\tfor(int i=1;i<=lg[dep[x]];i++)\n\t\tf[x][i]=f[f[x][i-1]][i-1];\n\t\n\tfor(int i=elast[x];i;i=e[i].ne)\n\t{\n\t\tint to=e[i].to;\n\t\tif(to!=fa)dfs(to,x);\n\t}\n}\nint LCA(int x,int y)\n{\n\tif(dep[x]<dep[y])swap(x,y);\n\twhile(dep[x]>dep[y])\n\t\tx=f[x][lg[dep[x]-dep[y]]-1];\n\tif(x==y)return x;\n\tfor(int i=lg[dep[x]];i>=0;i--)\n\t\tif(f[x][i]!=f[y][i])x=f[x][i],y=f[y][i];\n\treturn f[x][0];\n}\n\nint n;\nint ans;\nchar a[N];\nint dp[N][N];\n\nint DP(int x,int y)\n{\n\tif(dep[x]<dep[y])swap(x,y);\n\tif(dp[x][y]!=-1)return dp[x][y];\n\t\n\tint lca=LCA(x,y),res=0;\n\tint delt=0;\n\tif(a[x]==a[y])delt=2;\n\n\tif(lca==y)\n\t{\n\t\tint now=x;\n\t\tfor(int i=11;i>=0;i--)\n\t\t\tif(dep[f[now][i]]>dep[y])now=f[now][i];\n\t\n\t\tres=max(DP(x,now),max(DP(f[x][0],y),DP(f[x][0],now)+delt));\n\t\t\n\t\tdp[x][y]=dp[y][x]=res;\n\t\treturn res;\n\t}\n\n\tres=max(DP(x,f[y][0]),max(DP(f[x][0],y),DP(f[x][0],f[y][0])+delt));\n\t\n\tdp[x][y]=dp[y][x]=res;\n\treturn res;\n}\nvoid solve()\n{\n\tnum=0;\n\tmemset(elast,0,sizeof(elast));\n\tmemset(dep,0,sizeof(dep));\n\tmemset(f,0,sizeof(f));\n\t\n\tn=read();\n\tcin>>a+1;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint x=read(),y=read();\n\t\tadd(x,y),add(y,x);\n\t}\n\t\n\t\n\tdfs(1,0);\n\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++)dp[i][j]=-1;\n\t\t\n\tfor(int i=1;i<=n;i++)dp[i][i]=1;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tif(a[i]==a[f[i][0]])dp[i][f[i][0]]=dp[f[i][0]][i]=2;\n\t\telse dp[i][f[i][0]]=dp[f[i][0]][i]=1;\n\t}\n\tans=0;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++)ans=max(ans,DP(i,j));\n\t\n\tprintf(\"%d\\n\",ans);\n}\nint main()\n{\n\tfor(int i=1;i<N;i++)\n\t\tlg[i]=lg[i-1]+(1<<lg[i-1]==i);\n\tint T=read();\n\twhile(T--)solve();\n\treturn 0;\n}\n\n```\n",
        "postTime": 1670817030,
        "uid": 247269,
        "name": "MSqwq",
        "ccfLevel": 0,
        "title": "CF1771D Hossam and (sub-)palindromic tree"
    },
    {
        "content": "\u63d0\u4ea4\u7406\u7531\uff1a\u9898\u89e3\u533a\u6682\u65e0 bitset \u9898\u89e3\uff0c\u5faa\u73af dp \u9898\u89e3\uff0e\n\n\u6807\u51c6 _\u94fe\u4e0a_ \u56de\u6587\u5b50\u5e8f\u5217 _\u4e32_ \u76f8\u540c\u539f\u7406\uff0e    \n\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a    \n$dp_{i,j}=\\max\\begin{cases}dp_{i+1,j}\\\\dp_{i,j-1}\\\\dp_{i+1,j-1}+2&&{S_{i}=S_{j}}\\end{cases}$\n    \n\u72b6\u6001\u5b9a\u4e49\uff1a\u4e24\u70b9\u786e\u5b9a\u7684\u533a\u95f4\uff08$i, j$\uff09\u5185\u56de\u6587\u5b50\u5e8f\u5217\u7684\u6700\u957f\u957f\u5ea6\u3002    \n\u521d\u59cb\u5316\uff1a\u5355\u70b9\uff08\u8d77\u7ec8\u70b9\u76f8\u540c\uff09\u5e8f\u5217\u5fc5\u56de\u6587\uff0c\u8bb0\u4e3a $1$\uff0e\n\n\u5bf9\u300c\u5750\u6807\u300d\u7684\u8865\u5145\u8bf4\u660e\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/o9jjvp0b.png)\n\n\u6bcf\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u6839\u7684\u65f6\u5019\uff0c\u552f\u4e00\u7684\u76ee\u7684\u662f\u6c42\u51fa\u4f7f\u81ea\u5df1\u5230\u6bcf\u4e00\u4e2a\u70b9\u7684\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u957f\u5ea6\u3002\u8fd9\u5c31\u591f\u4e86\u3002\u4e8e\u662f\u628a\uff1a`for (i = 1; i <= N; ++i)` \u4fee\u6539\u4e3a `for (i = e[j]._Find_first(); i <= N; i = e[j]._Find_next(i))`\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u526a\u679d\uff0c\u53ef\u4ee5 Accepted\u3002\n\n\n\u9644\u5b8c\u6574\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nbasic_string<unsigned> E[2016];\nbitset<2016> e[2016];\nunsigned G[2016], f[2016], dp[2016][2016];\nstring V;\nvoid dfs(unsigned fr, unsigned ps)\n{\n    for (const auto& to : E[ps])\n        if (fr != to)\n            dfs(ps, to);\n    f[ps] = ps, G[ps] = fr;\n    return;\n}\nint main()\n{\n    unsigned i, j, k, r, s, t, N, anw;\n    cin >> t;\n    for (i = 1; i < 2016; ++i)\n        dp[i][i] = 1, e[i].set();\n    do {\n        cin >> N >> V;\n        V = \" \" + V;\n        for (i = 1; i < N; ++i) {\n            cin >> r >> s;\n            E[r].push_back(s);\n            E[s].push_back(r);\n        }\n        for (j = 1; j <= N; ++j) {\n            dfs(0, j);\n            for (k = 1; k <= N; ++k)\n                for (i = e[j]._Find_first(); i <= N; i = e[j]._Find_next(i)) {\n                    if (!e[i][G[f[i]]] || !G[f[i]] || !G[i])\n                        f[i] = G[f[i]];\n                    else\n                        dp[f[i]][i] = dp[i][f[i] = G[f[i]]] = max({ dp[i][f[i]], dp[G[i]][G[f[i]]],\n                            (i == f[i] ? 0 : dp[G[i]][f[i]]) + 2 * (V[i] == V[G[f[i]]]) }),\n                        e[f[i]][i] = e[i][f[i]] = 0;\n                }\n        }\n        for (i = 1, anw = 0; i <= N; ++i) {\n            anw = max(anw, *max_element(dp[i] + 1, dp[i] + N + 1));\n            E[i].clear(); e[i].set();\n        }\n        cout << anw << '\\n';\n    } while (--t);\n    return 0;\n}\n```\n[\u53ef\u80fd\u8fa8\u8bc6\u5ea6\u66f4\u4f73\u7684\u7f29\u8fdb](https://www.luogu.com.cn/paste/0jk17f2z)  \n[Codeforces \u94fe\u63a5](https://codeforces.com/contest/1771/submission/192572034)\n",
        "postTime": 1675759966,
        "uid": 259253,
        "name": "\u738b\u6c5f\u777f",
        "ccfLevel": 5,
        "title": "BITSET \u4f7f\u7528\u7684\u4e30\u7891"
    },
    {
        "content": "\u5206\u4eab\u4e00\u4e0b\u6211\u7684\u777f\u667a\u505a\u6cd5\uff0c\u611f\u89c9\u86ee\u6709\u610f\u601d\u7684\u3002\n\n\u9996\u5148\u5bb9\u6613\u77e5\u9053\uff0c\u53ea\u9700\u8981\u627e\u51fa\u4e24\u4e2a\u7aef\u70b9\u90fd\u662f\u53f6\u5b50\u7684\u6240\u6709\u8def\u5f84\uff0c\u5bf9\u6bcf\u6761\u8fd9\u6837\u7684\u8def\u5f84\u90fd dp \u4e00\u904d\uff0c\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u662f\u679a\u4e3e\u6bcf\u4e2a\u53f6\u5b50\uff0c\u4ee5\u5b83\u4e3a\u6839 dfs \u4e00\u904d\uff0c\u6bcf\u627e\u5230\u53e6\u4e00\u4e2a\u53f6\u5b50\u7684\u65f6\u5019\u5c31 dp \u4e00\u6b21\u3002\n\n\u5c1d\u8bd5\u5199\u4e86\u4e0b\uff0cT \u5728\u4e86 #16\u3002\n\nvp \u7684\u65f6\u5019\u964d\u667a\u4e86\uff0c\u4e0d\u77e5\u9053\u8fd9\u73a9\u610f\u513f\u80fd\u8bb0\u5fc6\u5316\uff0c\u7136\u540e\u52a0\u4e86\u4e2a\u7384\u5b66\u4f18\u5316\uff1a\n\n\u6309\u6211\u4eec\u8fd9\u6837\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5047\u8bbe\u6709\u6839 $a$\uff0c\u53f6\u5b50 $b,c$\uff0c\u5df2\u7ecf\u7b97\u4e86 $a\\rightarrow b$ \u7684\u7b54\u6848\uff0c\u4e0b\u4e00\u4e2a\u8981\u7b97 $a\\rightarrow c$ \u7684\u7b54\u6848\u3002\u5bb9\u6613\u53d1\u73b0\u5b57\u7b26\u4e32\u7684\u524d\u534a\u90e8\u5206\uff08\u5373 $a\\rightarrow lca(b,c)$\uff09\u5b8c\u5168\u6ca1\u6709\u53d8\u5316\uff0c\u5e76\u4e14\u5176\u5185\u90e8\u7684 dp \u503c\u5df2\u7ecf\u5728\u4e4b\u524d\u7b97\u8fc7\u4e86\uff0c\u5c31\u4e0d\u7528\u91cd\u7b97\u4e86\u3002\n\n\u4e8e\u662f\u2026\u2026\u8fc7\u4e86\uff1f\uff1f\n\nCode\n\n\u5bf9\u4e86\uff0c\u6ce8\u610f\u7279\u5224 $n=1$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint t,n,ans,dp[2003][2003],L;//L\u8868\u793alca(b,c)\u5728\u5e8f\u5217\u4e2d\u7684\u4f4d\u7f6e \nchar s[2003],a[2003];\nvector<int>edge[2003];\ninline int max(int a,int b){return a>b?a:b;}\nvoid dfs(int id,int from,int depth){\n\ta[depth]=s[id];\n\tif(edge[id].size()==1){\n\t\tfor(int i=L+1;i<=depth;i++)dp[i][i]=1;\n\t\tfor(int len=2;len<=depth;len++)\n\t\tfor(int l=max(1,L-len+2);l+len-1<=depth;l++){//\u8fd9\u91ccl\u7684\u521d\u503c\u5c31\u662f\u6211\u6240\u8bf4\u7684\u4f18\u5316 \n\t\t\tint r=l+len-1;\n\t\t\tdp[l][r]=max(dp[l][r-1],dp[l+1][r]);\n\t\t\tif(a[l]==a[r])dp[l][r]=max(dp[l][r],dp[l+1][r-1]+2);\n\t\t}ans=max(ans,dp[1][depth]);\n\t}\n\tfor(int v:edge[id])if(v!=from)dfs(v,id,depth+1),L=depth;//\u66f4\u65b0lca(b,c) \n}\nint main(){\n\tscanf(\"%d\",&t);\n\twhile(t--){\n\t\tscanf(\"%d%s\",&n,s+1),ans=0;\n\t\tfor(int i=1;i<=n;i++)edge[i].clear();\n\t\tfor(int i=1,u,v;i<n;i++){\n\t\t\tscanf(\"%d%d\",&u,&v);\n\t\t\tedge[u].emplace_back(v);\n\t\t\tedge[v].emplace_back(u);\n\t\t}\n\t\tfor(int i=1;i<=n;i++)if(edge[i].size()==1)dfs(i,L=0,1);\n\t\tprintf(\"%d\\n\",n==1?1:ans);\n\t}return 0;\n}\n```\n\n\u6211\u6ca1\u6709\u7ec6\u60f3\u5b83\u590d\u6742\u5ea6\u662f\u4e0d\u662f\u5bf9\u7684\uff0c\u5982\u679c\u6709\u5927\u4f6c\u770b\u5230\u4e86\u53ef\u4ee5\u8bc4\u8bba\u554a QAQ",
        "postTime": 1671087740,
        "uid": 148226,
        "name": "Fan_sheng",
        "ccfLevel": 6,
        "title": "CF1771D Hossam and (sub-)palindromic tree"
    },
    {
        "content": "\u8003\u8651\u653e\u5728\u5e8f\u5217\u4e0a\u505a\uff1a\u8bbe $dp_{l,r}$ \u8868\u793a $[l,r]$ \u8fd9\u4e2a\u533a\u95f4\u7684\u6700\u957f\u56de\u6587\u5b50\u5e8f\u5217\u3002\n\n$$\ndp_{i,r}=\\max(dp_{l+1,r},dp_{l,r-1},dp_{l+1,r-1}+2\\times[s_l==s_r])\n$$\n\n\u653e\u5230\u6811\u4e0a\uff0c\u76f4\u63a5\u6309\u7167\u8def\u5f84\u957f\u5ea6\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u70b9\u5bf9\u8f6c\u79fb\uff0c\u9884\u5904\u7406\u6216\u500d\u589e\u627e\u5230\u8def\u5f84\u4e0a\u7684\u76f8\u90bb\u70b9\uff0c\u8f6c\u79fb\u548c\u5e8f\u5217\u4e0a\u4e00\u6837\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define pb push_back\n#define mk make_pair\nusing namespace std;\nnamespace Std{\nvoid gi(int &x){\n\tx=0;\n\tint y=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')y=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\tx=(x<<1)+(x<<3)+(c&15);\n\t\tc=getchar();\n\t}\n\tx*=y;\n}\nint T,n,f[2010][2010],dep[2010],fa[2010][12];\nvector<int>e[2010];\nvector<pair<int,int> >vec[2010];\nchar s[2010];\nvoid dfs(int x){\n\tfor(auto i:e[x]){\n\t\tif(i==fa[x][0])continue;\n\t\tfa[i][0]=x;\n\t\tdep[i]=dep[x]+1;\n\t\tdfs(i);\n\t}\n}\nint lca(int x,int y){\n\tif(dep[x]<dep[y])swap(x,y);\n\tfor(int i(11);~i;--i){\n\t\tif(dep[fa[x][i]]<dep[y])continue;\n\t\tx=fa[x][i];\n\t}\n\tif(x==y)return x;\n\tfor(int i(11);~i;--i){\n\t\tif(fa[x][i]==fa[y][i])continue;\n\t\tx=fa[x][i],y=fa[y][i];\n\t}\n\tx=fa[x][0];\n\treturn x;\n}\nint jp(int x,int y){\n\tfor(int i(11);~i;--i){\n\t\tif(dep[fa[x][i]]<y)continue;\n\t\tx=fa[x][i];\n\t}\n\treturn x;\n}\nvoid solve(){\n\tgi(n);\n\tdep[1]=1;\n\tscanf(\"%s\",s+1);\n\tint u,v;\n\tfor(int i(1);i<n;++i){\n\t\tgi(u);\n\t\tgi(v);\n\t\te[u].pb(v);\n\t\te[v].pb(u);\n\t}\n\tdfs(1);\n\tfor(int i(1);i<=11;++i){\n\t\tfor(int j(1);j<=n;++j)fa[j][i]=fa[fa[j][i-1]][i-1];\n\t}\n\tint ans(1);\n\tfor(int i(1);i<=n;++i){\n\t\tf[i][i]=1;\n\t\tfor(int j(i+1);j<=n;++j){\n\t\t\tint lc=lca(i,j);\n\t\t\tint ds=dep[i]+dep[j]-dep[lc]*2;\n\t\t\tif(ds==1){f[i][j]=1+(s[i]==s[j]);ans=max(ans,f[i][j]);}\n\t\t\telse vec[ds].pb(mk(i,j));\n\t\t}\n\t}\n\tfor(int i(2);i<n;++i){\n\t\tfor(auto j:vec[i]){\n\t\t\tint u=j.first,v=j.second;\n\t\t\tint lc=lca(u,v);\n\t\t\tif(dep[u]<dep[v])swap(u,v);\n\t\t\tint lj,rj;\n\t\t\tif(v==lc){\n\t\t\t\tlj=fa[u][0],rj=jp(u,dep[v]+1);\n\t\t\t}else{\n\t\t\t\tlj=fa[u][0],rj=fa[v][0];\n\t\t\t}\n\t\t\tf[min(u,v)][max(u,v)]=max(max(f[min(u,rj)][max(u,rj)],f[min(v,lj)][max(v,lj)]),f[min(lj,rj)][max(lj,rj)]+2*(s[u]==s[v]));\n\t\t\tans=max(ans,f[min(u,v)][max(u,v)]);\n\t\t}\n\t\tvec[i].clear();\n\t}\n\tprintf(\"%d\\n\",ans);\n\tfor(int i(1);i<=n;++i)e[i].clear();\n}\nvoid main(){\n\tgi(T);\n\twhile(T--)solve();\n}\n}  // namespace Std\n#undef int\nint main(){\n\tStd::main();\n\treturn 0;\n}\n```\n",
        "postTime": 1670818999,
        "uid": 576737,
        "name": "Wilson_Inversion",
        "ccfLevel": 7,
        "title": "CF1771D Hossam and (sub-)palindromic tree \u9898\u89e3"
    }
]