[
    {
        "content": "\u6211\u4eec\u53d1\u73b0\u4e58\u79ef\u5c0f\u4e8e\u7b49\u4e8e $\\text{123}$ \uff0c\u8bbe $mul_i=\\prod\\limits_{j=1}^{c}m_j[t_j = i]$ \uff0c\u5c31\u662f\u76f8\u5f53\u4e8e\u8fd9\u4e00\u79cd\u9650\u5236\u7684\u79ef\uff0c\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5728\u6bcf\u4e00\u79cd\u7684\u4e2a\u6570\u5bf9 $mul_i$ \u53d6\u819c\u7684\u60c5\u51b5\u4e0b\uff0c\u72b6\u6001\u6570\u6700\u591a\u53ea\u6709 $123$ \u79cd\uff0c\u5c31\u53ef\u4ee5\u8003\u8651\u628a\u72b6\u6001\u538b\u7f29\u4e3a\u4e00\u7ef4\u3002\n\n\u53d1\u73b0\u6839\u672c\u4e0d\u9700\u8981\u641c\u51fa\u6240\u6709\u72b6\u6001\u518d\u7ed9\u7f16\u53f7\uff0c\u8003\u8651\u4e00\u4e2a\u4e8c\u7ef4\u77e9\u9635\u4e2d\u7684\u5750\u6807\u6211\u4eec\u662f\u5982\u4f55\u628a\u5b83\u8f6c\u6210\u4e00\u4e2a\u6570\u7684\uff0c\u8fd9\u91cc\u5c31\u76f8\u5f53\u4e8e\u591a\u7ef4\u7684\u5750\u6807\uff0c\u7f16\u53f7\u5c31\u53ef\u4ee5\u53d8\u4e3a\uff1a\n\n$((r_1 \\times mul_2+r_2)\\times mul_3+r_3)...$ \uff08\u8fd9\u91cc $r_i$ \u4e3a\u5bf9 $mul_i$ \u53d6\u819c\u4ee5\u540e\u7684\u6570\uff09\n\n\u6240\u4ee5\u53ef\u4ee5\u8fdb\u884c $\\text{DP}$ \n\n\u7136\u800c $n \\le 10^{18}$ \uff0c\u53d1\u73b0\u5bf9\u4e8e\u4ece\u9009 $i$ \u4e2a\u5230\u9009 $i+1$ \u4e2a\uff0c\u600e\u4e48\u8f6c\u79fb\u4e0e $i$ \u65e0\u5173\uff0c\u53ef\u4ee5\u5728\u4e00\u5f00\u59cb\u5904\u7406\u51fa\u6765\uff0c\u6240\u4ee5\u6bcf\u4e00\u6b21\u8f6c\u79fb\u5176\u5b9e\u672c\u8d28\u4e0a\u90fd\u4e00\u6837\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u5957\u77e9\u9635\u5feb\u901f\u5e42\u4e86\n\n\u6ce8\u610f\u6700\u540e\u7b54\u6848\u4e0d\u662f $f_0$ \uff0c\u56e0\u4e3a\u6709\u4e9b\u79cd\u7c7b\u867d\u7136\u819c $mul_i$ \u4e0d\u4e3a $\\text{0}$ \uff0c\u4f46\u662f\u53ef\u80fd\u819c\u67d0\u4e00\u4e2a $m_j$ \u4e3a $0$ \uff0c\u9700\u8981\u679a\u4e3e\u6bcf\u79cd\u72b6\u6001\u662f\u5426\u53ef\u884c\uff0c\u7136\u540e\u53ef\u884c\u5c31\u52a0\u4e0a\u5373\u53ef\n\n$code$ :\n\n```cpp\n#include<cstdio>\n#include<cctype>\n#include<vector>\n\nusing namespace std;\n\n#define maxn 33\n#define maxs 222\n#define maxc 1111\n#define mod 12345\n\ninline long long read(){\n\tlong long r=0,f=0;\n\tchar c;\n\twhile(!isdigit(c=getchar()))f|=(c=='-');\n\twhile(isdigit(c))r=(r<<1)+(r<<3)+(c^48),c=getchar();\n\treturn f?-r:r;\n}\n\ninline char get_c(){\n\tchar c;\n\twhile(!isalpha(c=getchar()));\n\treturn c;\n}\n\nint N=1;\n\nlong long n;\n\nint cnt,mul[maxn];\n\nlong long ans,f[maxs],a[maxs][maxs],c[maxs][maxs];\n\nvector<int> m[maxn];\n\ninline void mulself(){\n\tfor(int i=0;i<N;i++)\n\t\tfor(int j=0;j<N;j++)\n\t\t\tfor(int k=0;k<N;k++)\n\t\t\t\t(c[i][j]+=a[i][k]*a[k][j]%mod)%=mod;\n\tfor(int i=0;i<N;i++)\n\t\tfor(int j=0;j<N;j++){\n\t\t\ta[i][j]=c[i][j];\n\t\t\tc[i][j]=0;\n\t\t}\n}\n\ninline void multi(){\n\tfor(int i=0;i<N;i++)\n\t\tfor(int j=0;j<N;j++)\n\t\t\t(c[0][i]+=f[j]*a[i][j]%mod)%=mod;\n\tfor(int i=0;i<N;i++){\n\t\tf[i]=c[0][i];\n\t\tc[0][i]=0;\n\t}\n}\n\nint main(){\n\tn=read(),cnt=read();\n\tfor(int i=1;i<=cnt;i++){\n\t\tint t=get_c()-'A'+1;\n\t\tint val=read();\n\t\tm[t].push_back(val);\n\t\tif(!mul[t])mul[t]=1;\n\t\tmul[t]*=val;\n\t}//\u6ca1\u6709\u9650\u5236\u7684\u79cd\u7c7b\u662f\u4e0d\u80fd\u9009\u7684\uff0c\u6240\u4ee5mul\u5f00\u59cb\u8981\u5168\u7f6e0\n\tfor(int i=1;i<=26;i++)\n\t\tif(mul[i])N*=mul[i];\n\tN++;\n\tfor(int i=0;i<N;i++){//\u679a\u4e3e\u5bf9\u4e8e\u6bcf\u79cd\u72b6\u6001\n\t\tint num=i;//\u9009\u4e00\u79cd\u4ee5\u540e\u80fd\u8f6c\u79fb\u5230\u54ea\u4e00\u4e2a\n\t\tlong long mult=1;\n\t\tfor(int j=26;j>=1;j--){\n\t\t\tif(!mul[j])continue;\n\t\t\tint tot=num%mul[j];\n\t\t\tint s=i-tot*mult;\n\t\t\ttot++;\n\t\t\ttot%=mul[j];\n\t\t\ts+=tot*mult;\n\t\t\tnum/=mul[j];\n\t\t\tmult*=mul[j];\n\t\t\ta[s][i]++;//\u5b58\u5728\u8be5\u8f6c\u79fb\n\t\t}\n\t}\n\tf[0]=1;\n\tfor(;n;n>>=1){\n\t\tif(n&1)multi();\n\t\tmulself();\n\t}\n\tfor(int i=0;i<N;i++){//\u627e\u5408\u6cd5\u72b6\u6001\n\t\tint num=i;\n\t\tbool ok=1;\n\t\tfor(int j=26;j>=1;j--){\n\t\t\tif(!mul[j])continue;\n\t\t\tint tot=num%mul[j];\n\t\t\tbool b=0;\n\t\t\tfor(int k=0;k<(int)m[j].size();k++)\n\t\t\t\tb|=((tot%m[j][k])==0);//\u53ea\u8981\u6ee1\u8db3\u4e00\u79cd\u5373\u53ef\n\t\t\tok&=b;\n\t\t\tnum/=mul[j];\n\t\t}\n\t\tif(ok)(ans+=f[i])%=mod;//\u5408\u6cd5\u5c31\u52a0\u4e0a\uff0c\u8bb0\u5f97\u53d6\u819c\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1605163297,
        "uid": 71403,
        "name": "\u4e00\u53f6\u77e5\u79cb\u3002",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF107D \u3010Crime Management\u3011"
    },
    {
        "content": "\u6211\u4eec\u53ef\u4ee5\u8003\u8651DP\u7684\u505a\u6cd5\n\n\u6211\u4eec\u8bbe `maxn[c]` \u4e3a\u7b2c $c$ \u79cd\u5b57\u7b26\u7684\u6240\u6709\u9650\u5236 $cnt$ \u7684\u4e58\u79ef\n\n`dp[i][a][b][c][d].....[z]`\uff0c\u8868\u793a\u679a\u4e3e\u5230\u5b57\u7b26\u4e32\u7684\u7b2c $i$ \u4f4d\uff0c\n\n\u6bcf\u4e2a\u5b57\u7b26\u4e3a\uff0c\u51fa\u73b0\u6b21\u6570 $\\%$  `maxn[c]` \u7684\u72b6\u6001\u4e0b\u5b57\u7b26\u4e32\u7684\u603b\u6570\u3002\n\n\u90a3\u4e48\u6700\u540e\u6c42\u7b54\u6848\u76f4\u63a5\u7edf\u8ba1\u5408\u6cd5\u7684\u65b9\u6848\u5c31\u884c\u4e86\u3002\n\n\u4f46\u662f\u8fd9\u4e48\u505a\u7a7a\u95f4\uff0c\u65f6\u95f4\u90fd\u662f\u4e0d\u5141\u8bb8\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u4f7f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u6765\u8fdb\u884c\u4f18\u5316\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 $map$ \u6765\u5bf9\u6bcf\u79cd\u72b6\u6001\u91cd\u65b0\u7f16\u53f7\uff0c\u5c06\u72b6\u6001\u5b58\u5165\u77e9\u9635\u4e2d\u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u77e9\u9635\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u5982\u679c\u6709\u503c 1\uff0c\u5219\u8bf4\u660e\u53ef\u4ee5\u8f6c\u79fb\uff0c\u6700\u540e\u77e9\u9635\u7684 $n-1$ \u6b21\u5e42\n\u5c31\u662f\u72b6\u6001\u8f6c\u79fb\u4e86 $n$ \u6b21\uff0c\u76f4\u63a5\u7edf\u8ba1\u7b2c 1 \u884c\u7684\u5408\u6cd5\u65b9\u6848\u3002\n\n\u6211\u7edf\u8ba1\u7b54\u6848\uff0c\u9884\u5904\u7406\u77e9\u9635\u7528\u7684DFS\n\n```\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<map>\n#include<vector>\nusing namespace std;\nconst int mod=12345;\nlong long n;\nint m,ans=0;\nint maxn[30];\nvector<int>ok[30];\nstruct Matrix\n{\n\tint a[125][125];\n\tMatrix()\n\t{\n\t\tmemset(a,0,sizeof(a));\n\t};\n\tMatrix operator * (const Matrix &x) const\n\t{\n\t\tMatrix ans=Matrix();\n\t\tfor(int i=1;i<=123;i++)\n\t\tfor(int j=1;j<=123;j++)\n\t\t{\n\t\t\tfor(int k=1;k<=123;k++)ans.a[i][j]+=a[i][k]*x.a[k][j]%mod,ans.a[i][j]%=mod;\n\t\t\t\n\t\t}\n\t\treturn ans;\n\t}\n\tMatrix operator ^ (const long long &x) const\n\t{\n\t\tMatrix ans=(*this),temp=(*this);\n\t\tlong long now=x;\n\t\twhile(now)\n\t\t{\n\t\t\tif(now&1)ans=ans*temp;\n\t\t\ttemp=temp*temp;\n\t\t\tnow>>=1;\n\t\t}\n\t\treturn ans;\n\t}\n}mat;\nstruct dat\n{\n\tint val[30];\n\tbool operator < (const dat& a)const \n\t{\n\t\tfor(int i=1;i<=26;i++)\n\t\t{\n\t\t\tif(val[i]==a.val[i])continue;\n\t\t\treturn val[i]<a.val[i];\n\t\t}\n\t\treturn false;\n\t}\n}chuzhi;\nmap<dat,int>mp;\nint pcnt=0;\nvoid dfs(int pos,dat now)\n{\n\tif(pos==27)\n\t{\n\t\tmp[now]=++pcnt;\n\t\treturn ;\n\t}\n\tif(maxn[pos]==0)dfs(pos+1,now);\n\tfor(int i=0;i<maxn[pos];i++)\n\t{\n\t\tnow.val[pos]=i;\n\t\tdfs(pos+1,now);\n\t}\n}\nvoid calc(int pos,dat now)\n{\n\tif(pos==27)\n\t{\n\t\tans+=mat.a[1][mp[now]];\n\t\tans%=mod;\n\t\treturn ;\n\t}\n\tif(maxn[pos]==0)calc(pos+1,now);\n\tfor(int i=0;i<maxn[pos];i++)\n\t{\n\t\tbool flag=false;\n\t\tfor(int j=0;j<ok[pos].size();j++)\n\t\tif(i%ok[pos][j]==0){\n\t\t\tflag=true;\n\t\t\tbreak;\n\t\t}\n\t\tif(flag)\n\t\t{\n\t\t\tnow.val[pos]=i;\n\t\t\tcalc(pos+1,now);\n\t\t}\n\t}\n}\nchar A;\nint x,c;\nint main()\n{\n\tscanf(\"%lld%d\",&n,&m);\n\tif(n==0)//\u7279\u5224 \n\t{\n\t\tprintf(\"1\\n\");\n\t\treturn 0;\n\t}\n\tif(m==0)//\u7279\u5224 \n\t{\n\t\tprintf(\"0\\n\");\n\t\treturn 0;\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\" %c %d\",&A,&x);\n\t\tc=A-'A'+1;\n\t\tif(maxn[c]==0)maxn[c]=x;\n\t\telse maxn[c]*=x;\n\t\tok[c].push_back(x);\n\t\t\n\t\t\n\t}\n\tdfs(1,chuzhi);\n\tfor(map<dat,int>::iterator i=mp.begin();i!=mp.end();i++)\n    {\n        int s=i->second;\n        dat now=i->first;\n        for(int j=1;j<=26;j++)\n        {\n            if(maxn[j]==0)continue;\n            dat temp=now;\n            temp.val[j]=(temp.val[j]+1)%maxn[j];\n            mat.a[s][mp[temp]]++;\n        }\n    }\n    mat=mat^((long long)n-1);\n    calc(1,chuzhi);\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1525439114,
        "uid": 19951,
        "name": "Reaepita",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF107D \u3010Crime Management\u3011"
    }
]