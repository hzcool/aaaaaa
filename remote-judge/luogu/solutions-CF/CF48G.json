[
    {
        "content": "\u57fa\u73af\u6811\u6a21\u677f\u3002\n\n\u73af\u4e0a\u7684\u70b9\u6211\u4eec\u901a\u8fc7\u53cc\u6307\u9488\u6c42\u51fa\u7b54\u6848\u3002\n\n\u5177\u4f53\u7684\u8bf4\uff0c\u5148\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u4e0a\u7684\u70b9\uff0c\u6c42\u51fa\u4ed6\u5b50\u6811\u5185\u5230\u4ed6\u7684\u8ddd\u79bb\u548c $sm_u$ \u548c \u5b50\u6811\u5927\u5c0f $siz_u$ \uff0c\u7136\u540e\u65ad\u73af\u6210\u94fe\uff0c\u8003\u8651\u53cc\u6307\u9488\uff0c\u663e\u7136\u6211\u4eec\u53d1\u73b0\u73af\u4e0a\u6bcf\u4e2a\u70b9\u8d70\u5230\u53e6\u4e00\u4e2a\u70b9\u53ea\u6709\u987a\u65f6\u9488\u548c\u9006\u65f6\u9488\u4e24\u4e2a\u8d70\u6cd5\uff0c\u800c\u4e14\u540c\u4e00\u79cd\u8d70\u6cd5\u7684\u70b9\u4f4d\u4e8e\u8fde\u7eed\u7684\u533a\u95f4\u3002\n\n\u5bf9\u4e8e\u73af\u4e0a\u7684\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u6211\u4eec\u5355\u72ec\u5904\u7406\u51fa\u4e00\u4e2a\u6307\u9488 $j$ \u8868\u793a $j \\to i$ \u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u6240\u6709\u70b9\u5e94\u8be5\u987a\u65f6\u9488\u8d70\u5230 $i$ ,\u5176\u4f59\u7684\u662f\u9006\u65f6\u9488\u3002\u7136\u540e\u679a\u4e3e\u6bcf\u4e2a\u4f4d\u7f6e\uff0c\u8ba1\u7b97 $dst$ \u8868\u793a $i \\to j$ \u7684 \u987a\u65f6\u9488\u8def\u5f84\u957f\u5ea6\uff0c\u5982\u679c\u8d85\u51fa\u73af\u4e0a\u603b\u957f\u5ea6 $Sm$ \u7684\u4e00\u534a\uff0c\u5219\u4e0d\u65ad\u79fb\u52a8\u6307\u9488\uff0c\u7edf\u8ba1\u8d21\u732e\u4e5f\u5f88\u7b80\u5355\uff0c\u8bb0\u4e00\u4e0b\u533a\u95f4\u7684 $\\sum siz_i$ \uff0c\u7136\u540e\u53ef\u4ee5\u6bcf\u79fb\u52a8\u4e00\u683c\u8ddd\u79bb\u9020\u6210\u4e86\u591a\u5c11\u8d21\u732e\u3002\n\n\u6c42\u51fa\u73af\u4e0a\u7684\u70b9\u540e\uff0c\u6211\u4eec\u53bb\u6c42\u51fa\u6bcf\u4e2a\u70b9\u5b50\u6811\u5185\u7684\u7b54\u6848\u3002\u4f46\u5728\u8fd9\u4e4b\u524d\u5f97\u5bf9\u4e8e\u5b50\u6811\u5185\u90e8\u505a\u4e00\u904d\u6362\u6839dp\uff0c\u6c42\u51fa\u5b50\u6811\u5185\u90e8\u70b9\u4e4b\u95f4\u4e92\u76f8\u7684\u8d21\u732e\u3002\n\n\u8003\u8651\u6c42\u51fa\u5b50\u6811\u5185\u7684\u70b9\u7b54\u6848\uff0c\u6211\u4eec\u53ea\u9700\u5411\u4e0b\u9012\u5f52\u7684\u65f6\u5019\u8003\u8651\u4e00\u6761\u8fb9\u7684\u8d21\u732e\u5373\u53ef\u3002\n\u5206\u522b\u662f\u5b50\u6811\u5185\u548c\u5b50\u6811\u5916\n\n\u60f3\u6e05\u695a\u540e\u8fd8\u662f\u6bd4\u8f83\u597d\u5199\u7684\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define pii pair<int,int>\nusing namespace std;\nconst int N=2e5+5;\nint n,idx,len,tot,size;\nint dfn[N],fa[N],lp[N],dis[N],sum[N],sm[N];\nint head[N],nxt[N<<1],to[N<<1],edge[N<<1];\nint dep[N],siz[N],ans[N],nt[N];\nmap<pii,int>mp;bool vis[N];\nvoid add(int x,int y,int z){\n\tnxt[++tot]=head[x];\n\thead[x]=tot;to[tot]=y;\n\tedge[tot]=z;\n}\nint find(int u){\n\tdfn[u]=++idx;\n\tfor(int i=head[u];i;i=nxt[i]){\n\t\tint v=to[i];\n\t\tif(!dfn[v])fa[v]=u,find(v);\n\t\telse if(dfn[v]>dfn[u]){\n\t\t\tlp[++len]=v;\n\t\t\tfor(;v!=u;v=fa[v])\n\t\t\t\tlp[++len]=fa[v];\n\t\t}\n\t}\n}\nvoid dfs(int u,int F,int fk){\n\tsm[u]=fk;siz[u]=1;\n\tfor(int i=head[u];i;i=nxt[i]){\n\t\tint v=to[i];\n\t\tif(v==F||vis[v])continue;\n\t\tdfs(v,u,fk+edge[i]);\n\t\tsm[u]+=sm[v];siz[u]+=siz[v];\t\t\n\t}\n}\nvoid dfs0(int u,int F,int vl,int sz,int Val){\n\tif(F!=0){\n\t\tnt[u]=nt[F]+(size-siz[u]-siz[u])*vl;\n\t\tans[u]=nt[u]+Val;\n\t}\n\tfor(int i=head[u];i;i=nxt[i]){\n\t\tint v=to[i];\n\t\tif(vis[v]||v==F)continue;\n\t\tdfs0(v,u,edge[i],sz,Val+sz*edge[i]);\n\t}\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1,x,y,z;i<=n;i++){\n\t\tscanf(\"%lld%lld%lld\",&x,&y,&z);\n\t\tadd(x,y,z);add(y,x,z);\n\t\tmp[pii(x,y)]=mp[pii(y,x)]=z;\n\t}\n\tfind(1);int Sm=0;\n\tfor(int i=1;i<=len;i++)vis[lp[i]]=1;\n\tfor(int i=1;i<=len;i++){\n\t\tlp[i+len]=lp[i];\n\t\tdfs(lp[i],0,0);\n\t\tif(i==1)Sm+=mp[pii(lp[i],lp[len])];\n\t\telse Sm+=mp[pii(lp[i],lp[i-1])]; \n\t}\n\tlen<<=1;\n\tfor(int i=2;i<=len;i++){\n\t\tdis[i]=mp[pii(lp[i],lp[i-1])];\n\t\tsum[i]=sum[i-1]+dis[i];\n\t}\n\tint dst=0,j=0,now=0,SZ=0;\n\tfor(int i=len/2+1;i>=2;i--){\n\t\tnow+=dst*siz[lp[i]]+sm[lp[i]];\n\t\tdst+=dis[i];\n\t\tSZ+=siz[lp[i]];\n\t\tif(dst>Sm/2){j=i;break;}\n\t}\n\tint gk=dst-dis[j];\n\tdst=0;\n\tfor(int i=len/2+2;i<=j+len/2-1;i++){\n\t\tdst+=dis[i];\n\t\tnow+=dst*siz[lp[i]]+sm[lp[i]];\n\t}dst=gk;\n\tans[lp[1]]=now;\n\tfor(int i=len/2+2;i<=len;i++){\n\t\tnow+=SZ*dis[i];\n\t\tnow-=(n-SZ)*dis[i];\n\t\tSZ+=siz[lp[i]];dst+=dis[i];\n\t\twhile(dst>Sm/2){\n\t\t\tSZ-=siz[lp[j]];\n\t\t\tnow-=sm[lp[j]]+siz[lp[j]]*dst;\n\t\t\tnow+=siz[lp[j]]*(Sm-dst)+sm[lp[j]];\n\t\t\tdst-=dis[j+1];\n\t\t\tj++;\n\t\t}\n\t\tans[lp[i]]=now;\n\t}\n\tfor(int i=1;i<=len/2;i++){\n\t\tint tmp0=ans[lp[i]]-sm[lp[i]];\n\t\tnt[lp[i]]=sm[lp[i]];size=siz[lp[i]];\n\t\tdfs0(lp[i],0,0,n-siz[lp[i]],tmp0);\n\t}\n\tfor(int i=1;i<=n;i++)printf(\"%lld \",ans[i]);\n\treturn puts(\"\"),0;\n}\n```",
        "postTime": 1649375086,
        "uid": 225183,
        "name": "\u5468\u5c0f\u6db5",
        "ccfLevel": 0,
        "title": "CF48G Galaxy Union"
    },
    {
        "content": "$n$\u4e2a\u70b9$n$\u6761\u8fb9\uff0c\u662f\u4e00\u68f5\u57fa\u73af\u6811\n\n**\u57fa\u73af\u6811\u7684\u64cd\u4f5c\u4e00\u822c\u628a\u6811\u548c\u73af\u5206\u5f00\u505a**\n\n\u627e\u73af\uff1a\n\n```cpp\nbool find_c(int u,int last)\n{\n\tvis[u]=1;\n\tpush(u);\n\tfor(int i=head[u]; i; i=e[i].next)\n\t\tif(e[i].to!=last)\n\t\t{\n\t\t\tif(vis[e[i].to])\n\t\t\t{\n\t\t\t\twhile(top()!=e[i].to)\n\t\t\t\t{\n\t\t\t\t\tis[top()]=1;\n\t\t\t\t\tc[++ccnt]=top();\n\t\t\t\t\tpop();\n\t\t\t\t}\n\t\t\t\tis[e[i].to]=1;\n\t\t\t\tc[++ccnt]=e[i].to;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(find_c(e[i].to,u)) return 1;\n\t\t}\n\tvis[u]=0;\n\tpop();\n\treturn 0;\n}\n```\n\n\n\u5148\u53ea\u8003\u8651\u6811\n\n\u4e0d\u96be\u60f3\u5230\u6811\u5f62dp\n\n\u8bbe$dp[i]$\u4e3a\u6811\u5185\u70b9\u7684\u7b54\u6848\n\n\u5148\u7528\u5b50\u8282\u70b9\u66f4\u65b0\u7236\u8282\u70b9\uff0c\u8fd9\u6837\u73af\u4e0a\u70b9\u5230\u5bf9\u5e94\u6811\u4e2d\u70b9\u7684$ans$\u5c31\u5904\u7406\u597d\u4e86\n\n```cpp\nll ans[MAXN*2];\n\nint size[MAXN*2];\nvoid dfs(int u,int fa)\n{\n\tsize[u]=1;\n\tfor(int i=head[u]; i; i=e[i].next)\n\t\tif(e[i].to!=fa && !is[e[i].to])\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tdfs(v,u);\n\t\t\tans[u] += ans[v] + e[i].w*size[v];\n\t\t\tsize[u]+=size[v];\n\t\t}\n}\n```\n**\u73af\u4e0a\u7684\u64cd\u4f5c\u4e00\u822c\u5148\u65ad\u73af\u4e3a\u94fe**\n\n\u5bf9\u4e8e\u73af\u4e0a\u6bcf\u4e2a\u70b9\n\n\u8003\u8651\u4f7f\u7528\u5c3a\u53d6\u6cd5\u9009\u5230\u6700\u8fdc\u7684\uff0c\u4e0d\u8d85\u8fc7\u73af\u957f\u5ea6\u4e00\u534a\u7684\u70b9\n\n\u8fd9\u4e9b\u70b9\u7684\u6700\u77ed\u8def\u8d70\u5de6\u8fb9\uff08\u5373 \u201c\u4e0d\u8d85\u8fc7\u73af\u957f\u5ea6\u4e00\u534a\u201d \u7684\u90a3\u4e00\u8fb9\uff09\n\n```cpp\nwhile(sumw[r]-sumw[l-1] <= (sumw[ccnt]>>1)) ++r;\n```\n\n\u53e6\u4e00\u534a\u7684\u70b9\u8d70\u53f3\u8fb9\n\n\u4e24\u8fb9\u7684\u64cd\u4f5c\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u53ea\u8bf4\u5de6\u8fb9\n\n\u8bbe\u8fd9\u4e2a\u70b9\u4e3a$i$,\u5de6\u8fb9\u7684\u70b9\u4e3a$i,i+1,\\cdots,j$\n\n$$ans[i] = \\sum_{k=i}^j (dp[k]+size[k] \\times dis(i,k))$$\n\n_\u8fd9\u4e2a\u5f0f\u5b50\u5f88\u91cd\u8981\uff0c\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\u662f\u5bf9\u7684_\n\n\u4f46\u662f\u8fd9\u6837\u662f$O(n^2)$\u7684\uff0c\u663e\u7136\u4f1a\u8d85\u65f6\n\n\u8003\u8651\u4f18\u5316\n\n**\u52a0\u548c\u7684\u4f18\u5316\uff08\u4e0d\u5e26\u4fee\u6539\uff09\u4e00\u822c\u4f7f\u7528\u524d\u7f00\u548c**\n\n\u4f46\u662f\u8fd9\u4e2a\u5f0f\u5b50\u5e76\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\u524d\u7f00\u548c\u4f18\u5316\n\n**\u5148\u8003\u8651\u8f83\u597d\u4f18\u5316\u7684\u90e8\u5206\uff0c\u5176\u4ed6\u90e8\u5206\u6216\u8bb8\u5c31\u4f1a\u8fce\u5203\u800c\u89e3**\n\n\u53d1\u73b0$\\sum dp[k]$\u6bd4\u8f83\u597d\u6c42\uff0c\u5148\u6c42\u4e86\uff08\u5373\u4ee3\u7801\u4e2d\u7684```tot```\uff09\n\n\u95ee\u9898\u5c31\u662f\uff0c\u600e\u4e48\u628a$size[k] \\times dis(i,k)$\u5199\u6210\u53ef\u4ee5\u4f7f\u7528\u524d\u7f00\u548c\u7684\u5f62\u5f0f\n\n\u5148\u7528\u524d\u7f00\u548c\u6c42$dis$\uff1a\n\n$$\\sum_{k=i}^j size[k] \\times (sumw[k]-sumw[i-1])$$\n\n$$= \\sum_{k=i}^j size[k] \\times sumw[k] - \\sum_{k=i}^j size[k] \\times sumw[i-1]$$\n\n$$= \\sum_{k=i}^j size[k] \\times sumw[k] - sumw[i-1] \\sum_{k=i}^j size[k]$$\n\n\u7136\u540e$\\sum_{k=i}^j size[k] \\times sumw[k]$\u548c$\\sum_{k=i}^j size[k]$\u5c31\u4e5f\u53ef\u4ee5\u524d\u7f00\u548c\u4e86\n\n\u8fd9\u662f\u5de6\u8fb9\u7684\u5f0f\u5b50\uff0c\u53f3\u8fb9\u76f8\u4f3c\uff08\u4f46\u5e76\u4e0d\u76f8\u540c\uff09\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\n\n\uff08\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u7528\u7684\u5f0f\u5b50\u548c\u4e0a\u9762\u63a8\u5bfc\u8fc7\u7a0b\u4e2d\u7528\u7684\u7684\u6709\u4e0d\u540c\uff09\n\n```cpp\nfor(int l=1,r=1; l<=ccnt; ++l)\n{\n\twhile(sumw[r]-sumw[l-1] <= (sumw[ccnt]>>1)) ++r;\n\tans[c[l]]\n\t= tot//dp\u503c\u7684\u548c\n\t+ sums[r]*(sumw[r-1]-sumw[l-1]) - (sum[r-1]-sum[l-1])\n\t+ (sum[l+ccnt-1]-sum[r]) - sums[r]*(sumw[l+ccnt-1]-sumw[r]);\n\tdfs2(c[l],0);\n}\n```\n\n\u7136\u540e\u7528\u73af\u4e0a\u70b9\u7684\u7b54\u6848\u66f4\u65b0\u6811\u4e0a\u70b9\u7684\u7b54\u6848\n\n```cpp\nvoid dfs2(int u,int fa)\n{\n\tfor(int i=head[u]; i; i=e[i].next)\n\t\tif(e[i].to!=fa && !is[e[i].to])\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tans[v] = ans[u] + e[i].w*(n-size[v]) - e[i].w*size[v];\n\t\t\tdfs2(v,u);\n\t\t}\n}\n```\n\n\u603b\u4f53\u6765\u8bf4\uff0c\u8fd9\u9053\u9898\u6bd4\u8f83\u8003\u9a8c\u4ee3\u7801\u80fd\u529b\uff0c\u6211\u4e5f\u56e0\u4e3a\u7ec6\u8282\u8c03\u4e86\u597d\u4e45\n\n\u662f\u7ec3\u4e60\u7801\u529b\u7684\u597d\u9898\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\nconst int MAXN = 2e5 + 5;\ntypedef long long ll;\n\nstruct Edge\n{\n\tint next,to,w;\n}e[MAXN<<1];\nint head[MAXN],etot=0;\ninline void add(int u,int v,int w)\n{\n\t++etot;\n\te[etot].next=head[u];\n\te[etot].to=v;\n\te[etot].w=w;\n\thead[u]=etot;\n}\n\nint n;\nbool is[MAXN];\n\nint c[MAXN*2],w[MAXN*2],ccnt=0;\nbool vis[MAXN];\nint st[MAXN],tp=0;\ninline int top(void){ return st[tp];}\ninline void push(int x){ st[++tp]=x;}\ninline void pop(void){ --tp;}\nbool find_c(int u,int last)\n{\n\tvis[u]=1;\n\tpush(u);\n\tfor(int i=head[u]; i; i=e[i].next)\n\t\tif(e[i].to!=last)\n\t\t{\n\t\t\tif(vis[e[i].to])\n\t\t\t{\n\t\t\t\twhile(top()!=e[i].to)\n\t\t\t\t{\n\t\t\t\t\tis[top()]=1;\n\t\t\t\t\tc[++ccnt]=top();\n\t\t\t\t\tpop();\n\t\t\t\t}\n\t\t\t\tis[e[i].to]=1;\n\t\t\t\tc[++ccnt]=e[i].to;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(find_c(e[i].to,u)) return 1;\n\t\t}\n\tvis[u]=0;\n\tpop();\n\treturn 0;\n}\n\nll ans[MAXN*2];\n\nint size[MAXN*2];\nvoid dfs(int u,int fa)\n{\n\tsize[u]=1;\n\tfor(int i=head[u]; i; i=e[i].next)\n\t\tif(e[i].to!=fa && !is[e[i].to])\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tdfs(v,u);\n\t\t\tans[u] += ans[v] + e[i].w*size[v];\n\t\t\tsize[u]+=size[v];\n\t\t}\n}\n\nvoid dfs2(int u,int fa)\n{\n\tfor(int i=head[u]; i; i=e[i].next)\n\t\tif(e[i].to!=fa && !is[e[i].to])\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tans[v] = ans[u] + e[i].w*(n-size[v]) - e[i].w*size[v];\n\t\t\tdfs2(v,u);\n\t\t}\n}\n\nll sums[MAXN*2],sumw[MAXN*2],sum[MAXN*2];\nint main(void)\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=0; i<n; ++i)\n\t{\n\t\tint u,v,w;\n\t\tscanf(\"%d%d%d\",&u,&v,&w);\n\t\tadd(u,v,w); add(v,u,w);\n\t}\n\t\n\tfind_c(1,0);\n\tfor(int i=1; i<=n ;++i)\n\t\tif(is[i]) dfs(i,0);\n\t\n\tll tot=0;\n\tfor(int i=1; i<=ccnt; ++i)\n\t{\n\t\tc[ccnt+i]=c[i];\n\t\ttot+=ans[c[i]];\n\t\tfor(int j=head[c[i]]; j; j=e[j].next)\n\t\t\tif(e[j].to == c[i+1])\n\t\t\t{\n\t\t\t\tw[ccnt+i]=w[i]=e[j].w;\n\t\t\t\tbreak;\n\t\t\t}\n\t}\n\tfor(int i=1; i<=ccnt*2; ++i)\n\t{\n\t\tsums[i] = sums[i-1]+size[c[i]];\n\t\tsumw[i] = sumw[i-1]+w[i];\n\t\tsum[i] = sum[i-1] + w[i]*sums[i];\n\t}\n\t\n\tfor(int l=1,r=1; l<=ccnt; ++l)\n\t{\n\t\twhile(sumw[r]-sumw[l-1] <= (sumw[ccnt]>>1)) ++r;\n\t\tans[c[l]]\n\t\t= tot\n\t\t+ sums[r]*(sumw[r-1]-sumw[l-1]) - (sum[r-1]-sum[l-1])\n\t\t+ (sum[l+ccnt-1]-sum[r]) - sums[r]*(sumw[l+ccnt-1]-sumw[r]);\n\t\tdfs2(c[l],0);\n\t}\n\tfor(int i=1; i<=n; ++i) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1565407949,
        "uid": 73687,
        "name": "He_Ren",
        "ccfLevel": 10,
        "title": "\u89e3\u9898\u62a5\u544a CF48G \u3010Galaxy Union\u3011"
    }
]