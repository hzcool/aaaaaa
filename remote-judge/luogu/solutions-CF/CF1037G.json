[
    {
        "content": "## Problem\n\n[CF1037G A Game on Strings](https://www.luogu.com.cn/problem/CF1037G)\n\n**\u9898\u76ee\u5927\u610f\uff1a**\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e24\u4e2a\u4eba\u8f6e\u6d41\u64cd\u4f5c\uff0c\u6bcf\u6b21\u53ef\u4ee5\u9009\u62e9\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u518d\u9009\u62e9\u4e00\u79cd\u5b57\u7b26\uff0c\u7136\u540e\u5220\u9664\u8be5\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u8be5\u5b57\u7b26\u5e76\u5c06\u5176\u5206\u88c2\u6210\u82e5\u5e72\u4e2a\u5b57\u7b26\u4e32\u3002\u82e5\u65e0\u6cd5\u64cd\u4f5c\u5219\u5bf9\u65b9\u80dc\u5229\u3002\n\n\u73b0\u5728\u7ed9\u4f60\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6bcf\u6b21\u8be2\u95ee\u82e5\u521d\u59cb\u5b57\u7b26\u4e32\u4e3a\u8be5\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u5b50\u4e32\uff0c\u5219\u5148\u624b\u662f\u5426\u5fc5\u80dc\u3002\n\n## Solution\n\n\u89c2\u5bdf\u53d1\u73b0\uff0c\u5982\u679c\u67d0\u6b21\u6211\u9009\u62e9\u4e86\u5b57\u7b26 $c$\uff0c\u5219\u5269\u4e0b\u7684\u5b50\u4e32\u8981\u4e48\u5de6\u8fb9\u662f $c$\uff0c\u8981\u4e48\u53f3\u8fb9\u662f $c$\u3002  \n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u7b26 $c$\uff0c\u8bbe\u5176\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $pos _ {c, 1}, pos _ {c, 2}, \\ldots, pos _ {c, k}$\uff0c\u90a3\u4e48\u6709\u7528\u7684\u4e32\u5c31\u662f\u6240\u6709 $s _ {pos _ {c, i}, pos _ {c, i + 1}}$ \u53ca\u5176\u6240\u6709\u524d\u7f00\u548c\u540e\u7f00\u3002\u8fd9\u6837\u7684\u4e32\u7684\u4e2a\u6570\u4e3a $O(n \\left|\\Sigma\\right|)$\u3002\n\n\u6211\u4eec\u8003\u8651\u9884\u5904\u7406\u51fa\u6240\u6709\u6709\u7528\u7684\u4e32\u7684 SG \u51fd\u6570\u3002  \n\u8003\u8651\u5c06\u6240\u6709\u4e32\u6309\u957f\u5ea6\u6392\u5e8f\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u4e32\u66b4\u529b\u8f6c\u79fb\u3002  \n\u5f88\u53ef\u60dc\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u662f\u4e0d\u5bf9\u7684\u3002\u6211\u4eec\u9700\u8981\u5bfb\u627e\u66f4\u4f18\u79c0\u7684\u65b9\u6cd5\u3002  \n\u6211\u4eec\u53d1\u73b0\uff0c\u5f53\u6211\u4eec\u7b2c\u4e00\u6b21\u64cd\u4f5c\u65f6\uff0c\u82e5\u9009\u62e9\u5b57\u7b26 $c$\uff0c\u5219\u5207\u5f00\u6765\u7684\u4e32\u9664\u4e86\u524d\u540e\u4e24\u4e2a\u90fd\u6ee1\u8db3\u5176\u5de6\u8fb9\u548c\u53f3\u8fb9\u90fd\u662f $c$\u3002  \n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u53ea\u5bf9\u6240\u6709\u7684 $s _ {pos _ {c, i}, pos _ {c, i + 1}}$ \u6c42 SG \u51fd\u6570\uff0c\u7136\u540e\u66b4\u529b\u9012\u5f52\u6c42\u89e3\u5de6\u53f3\u4e24\u8fb9\u7684\u4e32\u3002  \n\u7136\u800c\u8fd9\u6837\u590d\u6742\u5ea6\u4f9d\u7136\u662f\u9519\u7684\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u5de6\u53f3\u4e24\u8fb9\u7684\u4e32\u4e3a\u6211\u4eec\u4e4b\u524d\u629b\u5f03\u6389\u7684\u524d\u7f00\u548c\u540e\u7f00\u3002\u4e8e\u662f\u6211\u4eec\u518d\u8bb0\u5fc6\u5316\u4e00\u4e0b\u524d\u7f00\u548c\u540e\u7f00\u7684\u7b54\u6848\uff0c\u590d\u6742\u5ea6\u5c31\u6b63\u786e\u4e86\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee\uff0c\u6211\u4eec\u628a\u8be2\u95ee\u62c6\u6210\u82e5\u5e72\u4e2a\u8fde\u7eed\u7684\u6574\u4e32\u548c\u4e00\u4e2a\u524d\u7f00\u548c\u4e00\u4e2a\u540e\u7f00\uff0c\u6211\u4eec\u9884\u5904\u7406\u6574\u4e32\u7684 SG \u51fd\u6570\u7684\u524d\u7f00\u548c\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0 $O(1)$ \u67e5\u8be2\u8fde\u7eed\u7684\u6574\u4e32\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\left|\\Sigma\\right| ^ 2 \\left|s\\right| + \\left|\\Sigma\\right| m)$\u3002\n\n## Code\n\n```cpp\n// Think twice, code once.\n#include <vector>\n#include <cstdio>\n#include <string>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\n\nint n, m;\nstring s;\nint cnt[26], pos[26][100005], id[100005];\nint le[26][100005], ri[26][100005];\nint sg[26][100005], pre[26][100005], suf[26][100005];\nvector<pair<int, int>> v;\n\nint query1(int l, int r) {\n\tint res = 0;\n\tfor (int i = 0; i < 26; i++) {\n\t\tint ll = ri[i][l], rr = le[i][r];\n\t\tif (ll > rr) continue;\n\t\tint now = 0;\n\t\tfor (int j = id[ll] + 1; j <= id[rr]; j++) now ^= sg[i][j];\n\t\tif (l < ll) {\n\t\t\tif (suf[i][l] == -1) suf[i][l] = query1(l, ll - 1);\n\t\t\tnow ^= suf[i][l];\n\t\t}\n\t\tif (rr < r) {\n\t\t\tif (pre[i][r] == -1) pre[i][r] = query1(rr + 1, r);\n\t\t\tnow ^= pre[i][r];\n\t\t}\n\t\tif (now < 26) res |= 1 << now;\n\t}\n\tfor (int i = 0; i < 26; i++)\n\t\tif ((res >> i & 1) == 0) return i;\n\treturn 26;\n}\nint query2(int l, int r) {\n\tint res = 0;\n\tfor (int i = 0; i < 26; i++) {\n\t\tint ll = ri[i][l], rr = le[i][r];\n\t\tif (ll > rr) continue;\n\t\tint now = sg[i][id[rr]] ^ sg[i][id[ll]];\n\t\tif (l < ll) {\n\t\t\tif (suf[i][l] == -1) suf[i][l] = query2(l, ll - 1);\n\t\t\tnow ^= suf[i][l];\n\t\t}\n\t\tif (rr < r) {\n\t\t\tif (pre[i][r] == -1) pre[i][r] = query2(rr + 1, r);\n\t\t\tnow ^= pre[i][r];\n\t\t}\n\t\tif (now < 26) res |= 1 << now;\n\t}\n\tfor (int i = 0; i < 26; i++)\n\t\tif ((res >> i & 1) == 0) return i;\n\treturn 26;\n}\n\nint main() {\n\tcin >> s;\n\tn = s.length();\n\ts = \" \" + s;\n\tfor (int i = 1; i <= n; i++) pos[s[i] - 'a'][id[i] = ++cnt[s[i] - 'a']] = i;\n\tfor (int i = 0; i < 26; i++) {\n\t\tle[i][0] = 0;\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\tle[i][j] = s[j] - 'a' == i ? j : le[i][j - 1];\n\t}\n\tfor (int i = 0; i < 26; i++) {\n\t\tri[i][n + 1] = n + 1;\n\t\tfor (int j = n; j >= 1; j--)\n\t\t\tri[i][j] = s[j] - 'a' == i ? j : ri[i][j + 1];\n\t}\n\tfor (int i = 0; i < 26; i++)\n\t\tfor (int j = 2; j <= cnt[i]; j++)\n\t\t\tif (pos[i][j - 1] + 1 != pos[i][j]) v.emplace_back(pos[i][j - 1], pos[i][j]);\n\tsort(v.begin(), v.end(), [](const pair<int, int> &x, const pair<int, int> &y) {\n\t\treturn x.second - x.first < y.second - y.first;\n\t});\n\tmemset(pre, -1, sizeof(pre));\n\tmemset(suf, -1, sizeof(suf));\n\tfor (auto now : v)\n\t\tsg[s[now.second] - 'a'][id[now.second]] = query1(now.first + 1, now.second - 1);\n\tfor (int i = 0; i < 26; i++)\n\t\tfor (int j = 1; j <= cnt[i]; j++)\n\t\t\tsg[i][j] ^= sg[i][j - 1];\n\tscanf(\"%d\", &m);\n\twhile (m--) {\n\t\tint l, r;\n\t\tscanf(\"%d%d\", &l, &r);\n\t\tputs(query2(l, r) ? \"Alice\" : \"Bob\");\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1685674107,
        "uid": 195331,
        "name": "Mine_King",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1037G \u3010A Game on Strings\u3011"
    }
]