[
    {
        "content": "\u770b\u5230\u589e\u52a0\u5750\u6807\uff0c\u4ee5\u53ca\u6c42\u548c\u8fc7\u7a0b\u4e2d$l\\le x_p\\le x_q\\le r$\uff0c\u53ef\u4ee5\u60f3\u5230\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u5750\u6807\u3002\n\n\u8bbe$v_i$\u4e3a$i$\u8282\u70b9\u7684\u5750\u6807\uff0c$sz_i$\u4e3a$i$\u8282\u70b9\u7684\u5b50\u6811\u5927\u5c0f\uff0c$s_i$\u4e3a$i$\u8282\u70b9\u5b57\u6570\u7684\u5750\u6807\u548c\uff0c$w_i$\u4e3a\u5b50\u6811\u533a\u95f4\u7684\u7b54\u6848\u3002\n\n\u5219$w_i=w_{ls}+w_{rs}+$\u5de6\u53f3\u5b50\u6811\u95f4\u7684\u7b54\u6848$+$\u53f3\u5b50\u6811\u548c\u6839\u7684\u7b54\u6848$+$\u5de6\u5b50\u6811\u548c\u6839\u7684\u7b54\u6848\u3002\n\n\u5373$w_i=(w_{ls}+w_{rs})+(sz_{ls}*s_{rs}+sz_{rs}*s_{ls})+(s_{rs}-sz_{rs}*v_i)+(sz_{ls}*v_i-s_{ls})$\n\n```cpp\n#include<stdio.h>\n#include<stdlib.h>\n#include<time.h>\n#define ll long long\nint rd(){\n\tint k=0,f=1;char c=getchar();\n\twhile(c>'9'||c<'0'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9')k=k*10+c-'0',c=getchar();\n\treturn k*f;\n}\nconst int N=200001;\nint pn,n,m,o,x,y,z,b,c,rt,rnd[N],v[N],sz[N],ch[N][2],a[N];ll s[N],w[N];\n#define ls ch[t][0]\n#define rs ch[t][1]\nvoid Up(int t){\n\tsz[t]=sz[ls]+sz[rs]+1,s[t]=s[ls]+s[rs]+v[t];\n\tw[t]=w[ls]+w[rs]+sz[ls]*s[rs]-sz[rs]*s[ls]+s[rs]-sz[rs]*v[t]+sz[ls]*v[t]-s[ls];\n}\nvoid Split(int t,int&a,int&b,int w){\n\tif(!t){a=b=0;return;}\n\tif(w>=v[t])a=t,Split(rs,rs,b,w);\n\telse b=t,Split(ls,a,ls,w);\n\tUp(t);\n}\nint Merge(int a,int b){\n\tif(!a||!b)return a|b;\n\tif(rnd[a]<rnd[b]){ch[a][1]=Merge(ch[a][1],b),Up(a);return a;}\n\tch[b][0]=Merge(a,ch[b][0]),Up(b);return b;\n}\nint main(){\n\tfreopen(\"data.in\",\"r\",stdin);\n\tfreopen(\"data.out\",\"w\",stdout);\n\tpn=n=rd();\n\tfor(int i=1;i<=n;++i)Split(rt,x,y,s[i]=v[i]=a[i]=rd()),rnd[i]=rand(),sz[i]=1,rt=Merge(Merge(x,i),y);\n\tm=rd();\n\twhile(m--){\n\t\to=rd(),b=rd(),c=rd();\n\t\tif(o==1){\n\t\t\tSplit(rt,x,y,a[b]-1),Split(y,y,z,a[b]),rt=Merge(Merge(x,Merge(ch[y][0],ch[y][1])),z);\n\t\t\trnd[++pn]=rand(),v[pn]=s[pn]=c+a[b],sz[pn]=1,Split(rt,x,y,a[b]=v[pn]),rt=Merge(Merge(x,pn),y);\n\t\t}\n\t\telse Split(rt,x,y,b-1),Split(y,y,z,c),printf(\"%lld\\n\",w[y]),rt=Merge(Merge(x,y),z);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1564827715,
        "uid": 68467,
        "name": "xcxcli",
        "ccfLevel": 0,
        "title": "CF295EYaroslav and Points"
    },
    {
        "content": "\u56e0\u4e3a\u8fd9\u9053\u9898\u53ea\u6709\u5355\u70b9\u4fee\u6539\u64cd\u4f5c\uff0c\u6240\u4ee5\u5982\u679c\u533a\u95f4\u4fe1\u606f\u53ef\u4ee5\u5408\u5e76\uff0c\u90a3\u4e48\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u8003\u8651\u5df2\u77e5 $[l,mid]$ \u548c $[mid+1,r]$ \u533a\u95f4\u5404\u81ea\u7684\u7b54\u6848\uff0c\u5982\u4f55\u77e5\u9053 $[l,r]$ \u7684\u7b54\u6848\n\n\u53d1\u73b0\u53ef\u4ee5\u628a\u7b54\u6848\u5206\u4e3a\u4e09\u90e8\u5206\uff1a\n\n- \u5728 $[l,mid]$ \u5185\u7684\u70b9\u5bf9\n- \u5728 $[mid+1,r]$ \u5185\u7684\u70b9\u5bf9\n- \u4e00\u4e2a\u70b9\u5728 $[l,mid]$\uff0c\u53e6\u4e00\u4e2a\u5728 $[mid+1,r]$ \u7684\u70b9\u5bf9\n\n\u7b2c\u4e00\u79cd\u548c\u7b2c\u4e8c\u79cd\uff0c\u663e\u7136\u662f\u4e00\u4e2a\u5b50\u95ee\u9898\uff0c\u662f\u5df2\u77e5\u7684\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e09\u79cd\uff0c\u6bcf\u4e00\u4e2a $[l,mid]$ \u4e2d\u7684\u70b9\u90fd\u4f1a\u4e0e $[mid+1,r]$ \u4e2d\u7684\u70b9\u4e00\u4e00\u5339\u914d\uff0c\u4ea7\u751f\u8d21\u732e\n\n\u6613\u77e5\u6bcf\u4e2a $[l,mid]$ \u4e2d\u7684\u70b9\u90fd\u4f1a\u88ab\u8ba1\u7b97 $r-mid$ \u6b21\uff0c\n\n\u8bbe $pos_i$ \u8868\u793a\u6bcf\u4e2a\u70b9\u7684\u4f4d\u7f6e\uff0c $sz_r=r-mid,s_l=\\sum_{i=l}^{mid} pos_i$\n\n\u5219 $[l,mid]$ \u7684\u8d21\u732e\u4e3a $-sz_r\\times s_l$\uff08\u56e0\u4e3a\u662f\u88ab\u51cf\u53bb\uff09\n\n$[mid+1,r]$ \u7684\u8d21\u732e\u540c\u7406\uff0c\u4e3a $sz_l\\times s_r$\n\n\u7136\u540e\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\uff0c\u7531\u4e8e\u503c\u57df\u8f83\u5927\uff0c\u8981\u52a8\u6001\u5f00\u70b9\u3002\n\nCode:\n```cpp\n#include <bits/stdc++.h>\ninline int read( ) {\n\tint x = 0, f = 1;\n\tchar c = getchar( );\n\twhile ( !isdigit( c ) ) { if ( c == '-' ) f = -1; c = getchar( ); }\n\twhile ( isdigit( c ) ) x = ( x << 3 ) + ( x << 1 ) + c - 48, c = getchar( );\n\treturn x * f;\n}\n\nconst int N = 1e5 + 7, M = 5e6 + 7;\n\nint n, m, root, cnt, ls[ M ], rs[ M ];\nlong long pos[ N ];\nstruct node {\n\tint sz;\n\tlong long s1, s2;\n}tr[ M ];\n\nvoid pushup( int rt ) {\n\ttr[ rt ].sz = tr[ ls[ rt ] ].sz + tr[ rs[ rt ] ].sz;\n\ttr[ rt ].s1 = tr[ ls[ rt ] ].s1 + tr[ rs[ rt ] ].s1;\n\ttr[ rt ].s2 = tr[ ls[ rt ] ].s2 + tr[ rs[ rt ] ].s2 + tr[ rs[ rt ] ].s1 * tr[ ls[ rt ] ].sz - tr[ ls[ rt ] ].s1 * tr[ rs[ rt ] ].sz;\n}\n\nvoid mdf( int &rt, int l, int r, int loc, int val, bool flag ) {\n\tif ( !rt ) rt = ++ cnt;\n\tif ( l == r ) {\n\t\tif ( flag == 0 ) tr[ rt ].s1 -= val;\n\t\telse tr[ rt ].s1 += val;\n\t\tif ( flag == 0 ) tr[ rt ].sz --;\n\t\telse tr[ rt ].sz ++;\n\t\treturn;\n\t}\n\tint mid = ( 1ll * l + r ) >> 1;\n\tif ( loc <= mid ) mdf( ls[ rt ], l, mid, loc, val, flag );\n\telse mdf( rs[ rt ], mid + 1, r, loc, val, flag );\n\tpushup( rt );\n}\n\nnode qry( int rt, int l, int r, int L, int R ) {\n\tif ( !rt ) return ( node ){ 0, 0, 0 };\n\tif ( L <= l && r <= R ) return tr[ rt ];\n\tint mid = ( 1ll * l + r ) >> 1;\n\tnode lret = ( node ){ 0, 0, 0 }, rret = ( node ){ 0, 0, 0 };\n\tif ( L <= mid ) lret = qry( ls[ rt ], l, mid, L, R );\n\tif ( R > mid ) rret = qry( rs[ rt ], mid + 1, r, L, R );\n\tnode ret;\n\tret.sz = lret.sz + rret.sz;\n\tret.s1 = lret.s1 + rret.s1;\n\tret.s2 = lret.s2 + rret.s2 + rret.s1 * lret.sz - lret.s1 * rret.sz;\n\treturn ret;\n}\n\nsigned main( ) {\n\tn = read( );\n\tfor ( int i = 1; i <= n; ++ i ) pos[ i ] = read( ), mdf( root, 1, 2e9 + 1, pos[ i ] + 1e9 + 1, pos[ i ], 1 );\n\tm = read( );\n\twhile ( m --> 0 ) {\n\t\tint op = read( ), l = read( ), r = read( );\n\t\tif ( op == 2 ) printf( \"%I64d\\n\", qry( root, 1, 2e9 + 1, l + 1e9 + 1, r + 1e9 + 1 ).s2 );\n\t\telse {\n\t\t\tif ( abs( pos[ l ] ) <= 1e9 )\n\t\t\tmdf( root, 1, 2e9 + 1, pos[ l ] + 1e9 + 1, pos[ l ], 0 );\n\t\t\tpos[ l ] += r;\n\t\t\tif ( abs( pos[ l ] ) <= 1e9 )\n\t\t\tmdf( root, 1, 2e9 + 1, pos[ l ] + 1e9 + 1, pos[ l ], 1 );\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1616135436,
        "uid": 93286,
        "name": "Yuno",
        "ccfLevel": 6,
        "title": "CF295E Yaroslav and Points"
    }
]