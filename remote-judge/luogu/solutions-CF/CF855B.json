[
    {
        "content": "\u5148\u6765\u770b\u6570\u636e\u8303\u56f4\uff0c$n\u226410^5$\uff0c\u663e\u7136\u4e0d\u53ef\u80fd $O(n^2)$\u3002\n\n\u5df2\u7ecf\u6709\u4eba\u8bb2\u8fc7\u533a\u95f4\u6700\u503c\u4e86\uff0c\u6211\u6765\u4e00\u4e2a DP \u601d\u8def\u7684\uff08\u4ee5\u4e0b\u7684 $a_i$\uff0c$a_j$\uff0c$a_k$ \u5168\u90e8\u53d6\u81ea\u9898\u610f\uff09\u3002\n\n$f_{x,1}$ \u8868\u793a\u524d $x$ \u4e2a\u6570\u4e2d $p\u00d7a_i$ \u7684\u6700\u5927\u503c\uff1b\n\n$f_{x,2}$ \u8868\u793a\u524d $x$ \u4e2a\u6570\u4e2d $p\u00d7a_i+q\u00d7a_j$ \u7684\u6700\u5927\u503c\uff1b\n\n$f_{x,3}$ \u8868\u793a\u524d $x$ \u4e2a\u6570\u4e2d $p\u00d7a_i+q\u00d7a_j+r\u00d7a_k$ \u7684\u6700\u5927\u503c\u3002\n\n\u53ef\u4ee5\u63a8\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$f_{i,1}=\\max(f_{i-1,1},p\u00d7a_i)$\n\n$f_{i,2}=\\max(f_{i-1,2},f_{i,1}+q\u00d7a_i)$\n\n$f_{i,3}=\\max(f_{i-1,3},f_{i,2}+r\u00d7a_i)$\n\n\u4e3a\u4ec0\u4e48\u6210\u7acb\uff1f\n\n\u62ff $f_{x,1}->f_{x,2}$ \u4e3e\u4f8b\uff0c\u5bf9\u4e8e $a_x$\uff0c\u5982\u679c\u4e0d\u53d6\uff0c\u663e\u7136\u4ec0\u4e48\u53d8\u5316\u4e5f\u6ca1\u6709\uff1b\u5982\u679c\u53d6\uff0c\u4e5f\u5c31\u662f\u53d6 $a_j$ \u4e3a $a_x$\uff0c\u7ed3\u5408 $f_{i,1}$ \u7684\u5b9a\u4e49\u6b64\u65f6\u4e00\u5b9a\u6709 $i\u2264j=x$\uff0c\u7b26\u5408\u8981\u6c42\u3002$f_{x,2}->f_{x,3}$ \u540c\u7406\u3002\n\n\u6bcf\u6b21\u904d\u5386\u4e00\u904d\u6570\u7ec4\uff0c\u590d\u6742\u5ea6\u662f $O(n)$\u3002\n\n\u6709\u4e24\u4e2a\u70b9\u63d0\u9192\uff1a\n\n1.\u8003\u8651\u6709\u8d1f\u6570\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019\u5982\u679c\u4e0d\u7279\u5224\uff0c\u6700\u5927\u503c\u4e3a $0$\u3002\n\n2.\u4e0d\u5f00 long long \u89c1\u7956\u5b97\u3002\n\n```cpp\n#include<iostream>\nusing namespace std;\nlong long n,p,q,r,a[100001],f[100001][4];\nint main(){\n    cin>>n>>p>>q>>r;\n    for(int i=1;i<=n;i++)cin>>a[i];\n    f[1][1]=a[1]*p; //\u5982\u679c\u6709\u8d1f\u6570 \n    for(int i=2;i<=n;i++)\n\t\tf[i][1]=max(f[i-1][1],a[i]*p);\n\tf[1][2]=f[1][1]+a[1]*q; //\u5982\u679c\u6709\u8d1f\u6570 \n    for(int i=2;i<=n;i++)\n    \tf[i][2]=max(f[i-1][2],f[i][1]+a[i]*q);\n    f[1][3]=f[1][2]+a[1]*r; //\u5982\u679c\u6709\u8d1f\u6570 \n\tfor(int i=2;i<=n;i++)\n    \tf[i][3]=max(f[i-1][3],f[i][2]+a[i]*r);\n    cout<<f[n][3];\n    return 0;\n}\n```\n",
        "postTime": 1629116008,
        "uid": 218530,
        "name": "BoAn",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF855B \u3010Marvolo Gaunt's Ring\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u7a7a\u95f4\u590d\u6742\u5ea6\u5747\u4e3a $O(n)$ \u7684\u505a\u6cd5\uff0c\u4f46\u4e0d\u662f dp\u3002\n\n\u8003\u8651\u679a\u4e3e\u4e2d\u95f4\u7684\u6570\uff08\u5373\u9898\u76ee\u4e2d\u7684 $j$\uff09\uff0c$a_j \\times q$ \u5373\u4e3a\u5b9a\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u5206\u522b\u6c42 $a_i \\times p$ \u548c $a_k \\times r$ \u7684\u6700\u5927\u503c\u5373\u53ef\uff08\u6b64\u65f6 $1 \\leq i \\leq j$\uff0c$j \\leq k \\leq n$\uff09\u3002\u4e0d\u96be\u53d1\u73b0\u53ef\u4ee5\u7528\u524d\u7f00\u6700\u5927\u503c\uff08$a_i \\times p$\uff09\u4e0e\u540e\u7f00\u6700\u5927\u503c\uff08$a_k \\times r$\uff09\u4f18\u5316\uff0c\u8fd9\u6837\u53ef\u4ee5\u505a\u5230 $O(n)$\u3002\n\n## AC Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst ll N=1e5+1;\nll n,p,q,r,ans=-4e18,a[N],f[N],g[N];\nint main()\n{\n\tscanf(\"%lld%lld%lld%lld\",&n,&p,&q,&r);\n\tfor(ll i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tf[1]=a[1]*p,g[n]=a[n]*r; \n\tfor(ll i=2;i<=n;i++) f[i]=max(f[i-1],a[i]*p);\n\tfor(ll i=n-1;i>=1;i--) g[i]=max(g[i+1],a[i]*r);\n\tfor(ll i=1;i<=n;i++) ans=max(ans,f[i]+a[i]*q+g[i]);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1660220695,
        "uid": 486484,
        "name": "Gaode_Sean",
        "ccfLevel": 6,
        "title": "CF855B \u9898\u89e3"
    },
    {
        "content": "# \u9898\u610f\n\u4e00\u4e2a\u957f\u5ea6\u4e3an\u7684\u5e8f\u5217\uff0c\u7ed9\u5b9a\u4e09\u4e2a\u6570 $p,q,r$\uff0c\u6c42\u5e8f\u5217\u4e2d\u7684\u4e09\u4e2a\u6570 $a_i,a_j,a_k$ \u6ee1\u8db3 $a_i\\times p+a_j\\times q+a_k\\times r $\u7684\u503c\u6700\u5927\u3002\n# \u601d\u8def\n\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5e8f\u5217\u7684\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\uff0c\u679a\u4e3e\u4e00\u904d $a_j$ \uff0c$q$\u4e0e$a_j$\u76f8\u4e58\uff1b\u5f53 $p\\geqslant 0$ \u65f6\uff0c\u6c42\u51fa\u533a\u95f4 $[1 , j]$\u7684\u6700\u5927\u503c, \u5426\u5219\u6c42\u51fa\u6700\u5c0f\u503c\uff0c $p$\u4e0e\u4e4b\u76f8\u4e58\uff1b\u5f53 $r\\geqslant 0$ \u65f6\uff0c\u6c42\u51fa\u533a\u95f4 $[j , n]$\u7684\u6700\u5927\u503c, \u5426\u5219\u6c42\u51fa\u6700\u5c0f\u503c\uff0c $r$\u4e0e\u4e4b\u76f8\u4e58\uff0c\u6bcf\u6b21\u6c42\u51fa\u8fd9\u4e09\u4e2a\u4e58\u79ef\u4e4b\u548c\u53d6$max$\u3002\n# \u4ee3\u7801\n```\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#include<iostream>\n#include<string>\n#define int long long\n#define INF 3e18\nusing namespace std;\n\nconst int maxn = 1000005;\nint n, p, q, r, a[maxn], sum = -INF;\n\nstruct node{\n\tint l, r, minn, maxx;\n}tree[maxn << 2];\n\nvoid pushup(int rt) {\n\ttree[rt].maxx = max(tree[rt << 1].maxx, tree[rt << 1 | 1].maxx);\n\ttree[rt].minn = min(tree[rt << 1].minn, tree[rt << 1 | 1].minn);\n}\n\nvoid build(int rt, int l, int r) {\n\ttree[rt].l = l;\n\ttree[rt].r = r;\n\tif (l == r) {\n\t\ttree[rt].maxx = tree[rt].minn = a[l];\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(rt << 1, l, mid);\n\tbuild(rt << 1 | 1, mid + 1, r);\n\tpushup(rt);\n}\n\nint querymax(int rt, int L, int R) {\n\tint l = tree[rt].l;\n\tint r = tree[rt].r;\n\tif (l >= L && r <= R) return tree[rt].maxx;\n\tint mid = (l + r) >> 1, FT = -INF;\n\tif (mid >= L) FT = max(querymax(rt << 1, L, R), FT);\n\tif (mid < R) FT = max(querymax(rt << 1 | 1, L, R), FT);\n\treturn FT;\n}\n\nint querymin(int rt, int L, int R) {\n\tint l = tree[rt].l;\n\tint r = tree[rt].r;\n\tif (l >= L && r <= R) return tree[rt].minn;\n\tint mid = (l + r) >> 1, FT = INF;\n\tif (mid >= L) FT = min(querymin(rt << 1, L, R), FT);\n\tif (mid < R) FT = min(querymin(rt << 1 | 1, L, R), FT);\n\treturn FT;\n}\n\nsigned main() {\n\tscanf(\"%lld%lld%lld%lld\", &n, &p, &q, &r);\n\tfor (int i = 1; i <= n; i++) scanf(\"%lld\", &a[i]);\n\tbuild(1, 1, n);\n\tfor (int j = 1; j <= n; j++) {\n\t\tint ans1 = p < 0 ? querymin(1, 1, j) : querymax(1, 1, j);\n\t\tint ans2 = r < 0 ? querymin(1, j, n) : querymax(1, j, n);\n\t\tsum = max(sum, ans1 * p + a[j] * q + ans2 * r);\n\t}\n\tprintf(\"%lld\", sum);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1602677510,
        "uid": 371178,
        "name": "Fan_Tuan",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 CF855B \u3010Marvolo Gaunt's Ring\u3011"
    },
    {
        "content": "# \u9898\u610f\n\n------------\n\n\u7ed9 $n$ \u4e2a\u6570\uff0c\u6309\u987a\u5e8f\u53d6\u4e09\u4e2a $a_i,a_j,a_k$ \uff0c\u4f7f \n  $p\u00d7a_i+q\u00d7a_j+r\u00d7a_k$ \u6700\u5927\u3002\n\n\u6ce8\u610f $1\u2264i\u2264j\u2264k\u2264n$ \u3002\n# $O(n^3)$ \u66b4\u529b\u89e3\u6cd5\n\n\n------------\n\nfor\u5faa\u73af\u679a\u4e3e $a_i,a_j,a_k$ \uff0c\u53d6 $max$ \u3002\n\n\u6216\u8005\u662f\u679a\u4e3e $a_i,a_j$ \uff0c\u6700\u540e\u7684 $a_k$ \u53d6 $[j,n]$ \u7684\u6700\u503c\uff0c\n\n\u5982\u679c $r>0$ \uff0c $a_k$ \u53d6\u6700\u5927\u503c\uff1b\n\u53cd\u4e4b\uff0c $a_k$ \u53d6\u6700\u5c0f\u503c\u3002\n\n\u8fd9\u6837\u663e\u7136\u4f1aTLE\u7684\u3002\n\n#  $O(n\\log n)$ \u89e3\u6cd5\n\n\n------------\n\n\u5728\u770b\u770b\u4e0a\u9762\u679a\u4e3e\u4e24\u4e2a\u6570\u7684\u7b97\u6cd5\uff0c\u518d\u60f3\u60f3\u53ef\u4ee5\u53ea\u679a\u4e3e\u4e00\u4e2a\u6570\u5417\uff1f\n\n\u8bf6\uff0c\u597d\u50cf\u53ef\u4ee5\u8bf6\uff01\n\n\u6211\u4eec\u679a\u4e3e\u4e2d\u95f4\u7684 $a_j$ \uff0c\u90a3\u4e48 $a_i$ \u5c31\u662f $[1,j]$ \u7684\u6700\u503c\uff0c $a_k$ \u662f $[j,n]$ \u7684\u6700\u503c\u3002\u7136\u540e\u7528ST\u7b97\u6cd5\u6216\u7ebf\u6bb5\u6811\uff0c\u7ef4\u62a4\u533a\u95f4\u6700\u503c\u3002\uff08\u4e0d\u4f1a\uff1f\u6233\u8fd9\u513f->[ST\u7b97\u6cd5](https://www.jianshu.com/p/9a138ac52968)\uff09\n\n\u8bdd\u4e0d\u591a\u8bf4\uff0c\u4e0a\u4ee3\u7801\uff01\n\n\u8fd9\u91cc\u7528\u7684\u662fST\u7b97\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4f5c\u9884\u5904\u7406\u540e\uff0c\u5728 $O(1)$ \u7684\u590d\u6742\u5ea6\u5185\u67e5\u8be2\u533a\u95f4\u6700\u503c\u3002\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<stdio.h>\n#include<string.h>\nusing namespace std;\n\ntypedef long long ll;\n\nconst int N=100005;\nconst ll INF=9e18;\n\nint n;\nll p,q,r;\nll a[N];\nll f[N][20][2]; //f[i][j][0]\u8868\u793a\u5728\u5b50\u533a\u95f4[i,i + 2^j - 1]\u7684\u533a\u95f4\u6700\u5927\u503c\uff0cf[i][j][1]\u4f4d\u6700\u5c0f\u503c\nint Log[N];\nll ans=-9e18;\n\nvoid ST_prework()\n{\n\tfor(int i=1;(1<<i)<=n;i++) Log[1<<i]=i; //\u9884\u5904\u7406log2(x)\u7684\u503c\uff0c\u65b9\u4fbf\u67e5\u627e\n\tfor(int i=1;i<=n;i++) if(!Log[i]) Log[i]=Log[i-1];\n\tint t=Log[n]+1;\n\tfor(int i=1;i<=n;i++) //\u521d\u59cb\u5316\n\t\tfor(int j=1;j<=t;j++)\n\t\t{\n\t\t\tf[i][j][0]=-INF;\n\t\t\tf[i][j][1]=INF;\n\t\t}\n\tfor(int i=1;i<=n;i++) f[i][0][0]=f[i][0][1]=a[i]; //\u8d4b\u521d\u503c\n\tfor(int j=1;j<t;j++)\n\t\tfor(int i=1;i<=n-(1<<j)+1;i++)\n\t\t{\n\t\t\tf[i][j][0]=max(f[i][j-1][0],f[i+(1<<(j-1))][j-1][0]);\n\t\t\tf[i][j][1]=min(f[i][j-1][1],f[i+(1<<(j-1))][j-1][1]); \n\t\t}\n}\n\nlong long ST_query(int l,int r,bool flag) //flag\u7528\u4e8e\u5224\u65adp/q/r\u5927\u4e8e0\u8fd8\u662f\u5c0f\u4e8e\u7b49\u4e8e0\n{\n\tint k=Log[r-l+1];\n\tif(flag) return max(f[l][k][0],f[r-(1<<k)+1][k][0]);\n\treturn min(f[l][k][1],f[r-(1<<k)+1][k][1]);\n}\n\nint main()\n{\n\tscanf(\"%d%lld%lld%lld\",&n,&p,&q,&r);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tST_prework();\n\tfor(int i=1;i<=n;i++)\n\t\tans=max(ans,q*a[i]+p*ST_query(1,i,p>0)+r*ST_query(i,n,r>0)); //\u53d6\u6700\u5927\u503c\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n} \n```\n\n# $O(n)$ \u7b97\u6cd5\n\n\n------------\n\n\u6b64\u65f6\uff0c\u6211\u4eec\u6362\u4e00\u79cd\u679a\u4e3e\u601d\u8def\uff0c\u679a\u4e3e\u5230\u4e00\u4e2a\u6570 $a_x$ \uff0c\u5206\u522b\u8003\u8651\uff1a\n\n\u5f53\u679a\u4e3e\u5230\u7b2c $x$ \u4e2a\u6570\u65f6\uff0c\n\n1. \u5f53 $a_x$ \u4e3a $a_i$ \u65f6\uff0c $p\u00d7a_i$ \u7684\u6700\u5927\u503c\n2. \u5f53 $a_x$ \u4e3a $a_j$ \u65f6\uff0c $p\u00d7a_i+q\u00d7a_j$ \u7684\u6700\u5927\u503c\n3. \u5f53 $a_x$ \u4e3a $a_k$ \u65f6\uff0c $p\u00d7a_i+q\u00d7a_j+r\u00d7a_k$ \u7684\u6700\u5927\u503c\n\n\u8003\u8651 $dp$ \uff0c\u8bbe $dp[i][0/1/2]$ \u8868\u793a\u679a\u4e3e\u5230\u7b2c $i$ \u4e2a\u6570\u65f6\uff0c\u5bf9\u5e94\u7684\u4e09\u79cd\u60c5\u51b5\u7684\u6700\u5927\u503c\uff0c\u5219\u53d1\u73b0\uff0c\u6c42\u51fa\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684\u6700\u5927\u503c\u65f6\uff0c\u518d\u52a0\u4e0a $q\u00d7a_x$ \u53ef\u4ee5\u5f97\u5230\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u6700\u5927\u503c\uff0c\u540c\u7406\u53ef\u4ee5\u63a8\u51fa\u7b2c\u4e09\u79cd\u60c5\u51b5\u7684\u6700\u5927\u503c\uff0c\u5373\uff1a\n\n$dp[i][0]=max(dp[i-1][0],p\u00d7a_i)$\n\n$dp[i][1]=max(dp[i-1][1],dp[i][0]+q\u00d7a_i)$\n\n$dp[i][2]=max(dp[i-1][2],dp[i][1]+r\u00d7a_i)$\n\n\u7531\u4e8e$i$\u662f\u9012\u589e\u7684\uff0c\u6240\u4ee5\u5b58\u7684\u6700\u5927\u503c\u4e2d\u53d6\u7684 $i,j,k$ \u4e00\u5b9a\u6ee1\u8db3   $i\u2264j\u2264k$ \uff0c\n\n\u6240\u4ee5\u6700\u540e\u7b54\u6848\u4e3a $dp[n][2]$ \u3002\n\n\u518d\u89c2\u5bdf\uff0c\u53d1\u73b0 $dp[i]$ \u53ea\u4e0e $dp[i-1]$ \u7684\u503c\u6709\u5173\uff0c\u6240\u4ee5\u76f4\u63a5\u538b\u6389\u7b2c\u4e00\u7ef4\uff0c\u7b54\u6848\u4e3a $dp[2]$ \u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(1)$ \u3002\n\n```cpp\n#include<iostream>\n#include<stdio.h>\n#include<string.h>\n#include<algorithm>\nusing namespace std;\n\ntypedef long long ll;\n\nconst ll INF=9e18;\n\nint n;\nint p,q,r;\nll dp[3];\n\nint main()\n{\n\tscanf(\"%d%d%d%d\",&n,&p,&q,&r);\n\tdp[0]=dp[1]=dp[2]=-INF;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint x;\n\t\tscanf(\"%d\",&x);\n\t\tdp[0]=max(dp[0],(ll)x*p); //\u6309\u987a\u5e8f\u4f9d\u6b21\u72b6\u6001\u8f6c\u79fb\n\t\tdp[1]=max(dp[1],dp[0]+(ll)x*q);\n\t\tdp[2]=max(dp[2],dp[1]+(ll)x*r);\n\t}\n\tprintf(\"%lld\\n\",dp[2]);\n\treturn 0;\n}\n```\n",
        "postTime": 1627394425,
        "uid": 431106,
        "name": "JackWei",
        "ccfLevel": 0,
        "title": "CF855B\u9898\u89e3"
    },
    {
        "content": "[\u5176\u5b9e\u70b9\u8fd9\u91cc\u4e5f\u4e0d\u4f1a\u83b7\u5f97\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/yifusuyi/p/10085164.html)\n\n## Solution\n\n\u8003\u8651\u6700\u66b4\u529b\u7684\u65b9\u6cd5\uff0c\u679a\u4e3e $i~,~j~,~k$ \uff0c\u8ba1\u7b97\u7b54\u6848\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n^3)$\n\n\u7136\u540e\u8003\u8651\u5982\u679c\u679a\u4e3e\u4e86\u5176\u4e2d\u4e24\u4e2a\u503c\uff0c\u5269\u4e0b\u4e00\u4e2a\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u67e5\u8be2\u533a\u95f4\u6700\u503c\u786e\u5b9a\u3002\u4f8b\u5982\uff0c\u5982\u679c\u679a\u4e3e\u4e86 $i~,~j$\uff0c\u5219 $k$ \u5bf9\u5e94\u7684\u6700\u4f18\u89e3\u4e00\u5b9a\u662f ( $k~>~0$ \u65f6) $k~\\times~\\max_{s~=~j}^{n}~a_s$\uff0c\uff08 $k~\\leq~0$ \u65f6\uff09 $k~\\times~\\min_{s~=~j}^{n}~a_s$\u3002\u679a\u4e3e\u5176\u5b83\u4e24\u4e2a\u5143\u7d20\u540c\u7406\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528ST\u9884\u5904\u7406\u533a\u95f4\u6700\u503c\uff0c\u7136\u540e\u505a\u5230 $O(1)$ \u67e5\u8be2\uff0c\u590d\u6742\u5ea6 $O(n\\log n)-O(n^2)$ \u3002\n\n\u8003\u8651\u4e0a\u8ff0\u505a\u6cd5\u7684\u7f3a\u9677\u5728\u4e8e\u679a\u4e3e\u91cf\u8fd8\u662f\u592a\u5927\uff0c\u80fd\u5426\u53ef\u4ee5\u53ea\u679a\u4e3e\u4e00\u4e2a\u4f4d\u7f6e\u5462\uff1f\u6211\u4eec\u53d1\u73b0\u5982\u679c\u679a\u4e3e\u4e00\u4e2a\u4f4d\u7f6e\u4ee5\u540e\u53ef\u4ee5\u786e\u5b9a\u5269\u4e0b\u4e24\u4e2a\u533a\u95f4\uff0c\u5c31\u53ef\u4ee5\u53ea\u679a\u4e3e\u4e00\u4e2a\u4f4d\u7f6e\u3002\u4e8e\u662f\u53d1\u73b0\u679a\u4e3e $j$ \u7b26\u5408\u8981\u6c42\u3002\u4e8e\u662f\u53ea\u679a\u4e3e $j$ \u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u6c42 $i~,~k$ \u7684\u5bf9\u5e94\u7b54\u6848\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)~-~O(n)$\n\n## Code\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <algorithm>\n#ifdef ONLINE_JUDGE\n#define freopen(a, b, c)\n#define putchar(o) \\\nputs(\"I am a cheater!\")\n#endif\n#define rg register\n#define ci const int\n#define cl const long long\n\ntypedef long long int ll;\n\nnamespace IPT {\n\tconst int L = 1000000;\n\tchar buf[L], *front=buf, *end=buf;\n\tchar GetChar() {\n\t\tif (front == end) {\n\t\t\tend = buf + fread(front = buf, 1, L, stdin);\n\t\t\tif (front == end) return -1;\n\t\t}\n\t\treturn *(front++);\n\t}\n}\n\ntemplate <typename T>\ninline void qr(T &x) {\n\trg char ch = IPT::GetChar(), lst = ' ';\n\twhile ((ch > '9') || (ch < '0')) lst = ch, ch=IPT::GetChar();\n\twhile ((ch >= '0') && (ch <= '9')) x = (x << 1) + (x << 3) + (ch ^ 48), ch = IPT::GetChar();\n\tif (lst == '-') x = -x;\n}\n\ntemplate <typename T>\ninline void ReadDb(T &x) {\n\trg char ch = IPT::GetChar(), lst = ' ';\n\twhile ((ch > '9') || (ch < '0')) lst = ch, ch = IPT::GetChar();\n\twhile ((ch >= '0') && (ch <= '9')) x = x * 10 + (ch ^ 48), ch = IPT::GetChar();\n\tif (ch == '.') {\n\t\tch = IPT::GetChar();\n\t\tdouble base = 1;\n\t\twhile ((ch >= '0') && (ch <= '9')) x += (ch ^ 48) * ((base *= 0.1)), ch = IPT::GetChar();\n\t}\n\tif (lst == '-') x = -x;\n}\n\nnamespace OPT {\n\tchar buf[120];\n}\n\ntemplate <typename T>\ninline void qw(T x, const char aft, const bool pt) {\n\tif (x < 0) {x = -x, putchar('-');}\n\trg int top=0;\n\tdo {OPT::buf[++top] = x % 10 + '0';} while (x /= 10);\n\twhile (top) putchar(OPT::buf[top--]);\n\tif (pt) putchar(aft);\n}\n\nconst int maxn = 100010;\nconst ll INF = -1000000000ll;\n\nint n;\nint LOG[maxn];\nll p, q, r, ans = -3000000000000000010ll;\nll MU[maxn], ST[2][20][maxn];\n\nll ask(ci, ci, ci);\n\nint main() {\n\tfreopen(\"1.in\", \"r\", stdin);\n\tqr(n); qr(p); qr(q); qr(r);\n\tfor (rg int i = 1; i <= n; ++i) qr(MU[i]);\n\tfor (rg int i = 0; (1 << i)  <= n; ++i) {\n\t\tLOG[1 << i] = i;\n\t}\n\tfor (rg int i = 3; i <= n; ++i) if(!LOG[i]) LOG[i] = LOG[i - 1];\n\tfor (rg int i = 0; i < 20; ++i)\n\t\tfor (rg int j = 0; j < maxn; ++j)\n\t\t\tST[1][i][j] = INF;\n\tfor (rg int i = 0; i < 20; ++i)\n\t\tfor (rg int j = 0; j < maxn; ++j)\n\t\t\tST[0][i][j] = -INF;\n\tfor (rg int i = 1; i <= n; ++i) ST[1][0][i] = ST[0][0][i] = MU[i];\n\tfor (rg int i = 1; i < 20; ++i) {\n\t\tint len = (1 << i) - 1;\n\t\tfor (rg int l = 1; l <= n; ++l) {\n\t\t\tint r = l + len; if (r > n) break;\n\t\t\tST[0][i][l] = std::max(ST[0][i - 1][l], ST[0][i - 1][l + (1 << (i - 1))]);\n\t\t\tST[1][i][l] = std::min(ST[1][i - 1][l], ST[1][i - 1][l + (1 << (i - 1))]);\n\t\t}\n\t}\n\tfor (rg int i = 1; i <= n; ++i) {\n\t\tans = std::max(q * MU[i] + p * ask(1, i, p < 0) + r * ask(i, n, r < 0), ans);\n\t}\n\tqw(ans, '\\n', true);\n\treturn 0;\n}\n\nll ask(ci l, ci r, ci cur) {\n\tint len = r - l + 1;\n\tif (cur) return std::min(ST[1][LOG[len]][l], ST[1][LOG[len]][r - (1 << LOG[len]) + 1]);\n\telse return std::max(ST[0][LOG[len]][l], ST[0][LOG[len]][r - (1 << LOG[len]) + 1]);\n}\n```\n\n## Summary\n\n\u8fd9\u6b21\u8c8c\u4f3c\u4e5f\u6ca1\u5565\u597dsummary\u7684\u2026\u2026\u5c31\u662f\u6211\u597d\u83dc\u554aST\u90fd\u8c03\u4e86\u534a\u5929",
        "postTime": 1544186730,
        "uid": 65363,
        "name": "\u4e00\u6276\u82cf\u4e00",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF855B \u3010Marvolo Gaunt's Ring\u3011"
    },
    {
        "content": "\u6211\u4eec\u8003\u8651\u56fa\u5b9a\u4e2d\u95f4\u7aef\u70b9 $q$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u77e5\u9053 $p,r$ \u7684\u8303\u56f4\u5206\u522b\u662f $[1,q]$ \u548c $[q,n]$ \u3002\r\n\r\n\u8003\u8651\u5982\u4f55\u80fd\u53d6\u5f97\u6700\u5c0f\uff1f\u4ee5 $p$ \u4e3a\u4f8b\uff0c\u5f53 $p$ \u4e3a\u6b63\u6570\u65f6\u663e\u7136\u53d6\u6700\u5927\u7684\u6700\u597d\uff0c\u8d1f\u6570\u7684\u65f6\u5019\u82e5\u80fd\u53d6\u8d1f\u6570\u80af\u5b9a\u53d6\u6700\u5c0f\u7684\u90a3\u4e2a\uff0c\u8fd9\u6837\u8d1f\u8d1f\u5f97\u6b63\u4e58\u8d77\u6765\u6700\u5927\uff1b\u6ca1\u6709\u8d1f\u6570\u65f6\u4e5f\u5e94\u8be5\u53d6\u6700\u5c0f\u7684\u90a3\u4e2a\uff0c\u8fd9\u6837\u7ed3\u679c\u4ecd\u7136\u66f4\u5927\u3002$p=0$ \u4e0d\u5fc5\u8003\u8651\u53cd\u6b63\u600e\u4e48\u4e58\u5c31\u662f $0$\u3002\r\n\r\n\u8fd9\u6837\u6211\u4eec\u5c06\u95ee\u9898\u8f6c\u5316\u6210\uff1a\u56fa\u5b9a $p$ \uff0c\u6c42 $\\max_{i=1}^p a_ i $ \u6216 $\\min_{i=1}^p a_ i $ \u4ee5\u53ca  $\\max_{i=p}^n a_ i $ \u6216 $\\min_{i=p}^n a_ i $\u3002\r\n\r\n\u591a\u6b21\u533a\u95f4\u6700\u503c\uff0c\u9700\u8981\u4f7f\u7528\u7ebf\u6bb5\u6811\uff0cST \u8868\u5417\uff1f\u5176\u5b9e\u4e0d\u7528\u3002\u6211\u4eec\u53d1\u73b0\u7ef4\u62a4\u7684\u533a\u95f4\u8981\u4e48\u5de6\u7aef\u70b9\u4e3a $1$ \u8981\u4e48\u53f3\u7aef\u70b9\u4e3a $n$\u3002\u8bbe $f(i)$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u7684\u6700\u5c0f\u503c\uff0c\u5219\u6211\u4eec\u6709 $f(1)=a_1 $ \u5e76\u4e14 $\\forall 2 \\le i \\le n,f(i)=\\min(f(i-1),a_i)$ \uff0c\u53ef\u4ee5\u5728 $O(n)$ \u7684\u65f6\u95f4\u5185\u9012\u63a8\u7b97\u51fa\u3002\u7c7b\u4f3c\u5730\uff0c\u6211\u4eec\u8bbe $f'(i)$ \u4e3a $[i,n]$ \u7684\u6700\u5c0f\u503c\uff0c\u6709 $f(n)=a_n $ \u5e76\u4e14 $\\forall 1 \\le i < n,f(i)=\\min(f(i+1),a_i)$\u3002\u6700\u5927\u503c\u540c\u7406\u3002\u8fd9\u6837\u5c31\u5728 $O(n)$ \u7684\u65f6\u95f4\u5185\u7ef4\u62a4\u4e86\u6700\u5927\u6700\u5c0f\u503c\u3002\r\n\r\n\u7136\u540e\u7167\u7740\u65b9\u6cd5\u7b97\u5c31\u884c\u4e86\u3002\u6ce8\u610f\u4f7f\u7528 `long long`\u3002\r\n\r\n```cpp\r\n#include <bits/stdc++.h>\r\nusing namespace std;\r\n\r\n#define ll long long\r\n\r\nconst int N = 1e5 + 10;\r\n\r\nll n, p, q, r, a[N];\r\nll mx1[N], mx2[N], mi1[N], mi2[N];\r\n//[1,i]\u6700\u5927\uff0c[1,i] \u6700\u5c0f\uff0c[i,n] \u6700\u5927\uff0c[i,n] \u6700\u5c0f\u3002\r\n\r\nint main() {\r\n\tcin >> n >> p >> q >> r;\r\n\tfor (int i = 1; i <= n; i++)\t\r\n\t\tcin >> a[i];\r\n\t//\u7ef4\u62a4\u6700\u503c\r\n\tmx1[0] = mx2[n + 1] = -4e18;\r\n\tmi1[0] = mi2[n + 1] = 4e18;\r\n\tfor (int i = 1; i <= n; i++) {\r\n\t\tmx1[i] = max(mx1[i - 1], a[i]);\r\n\t\tmi1[i] = min(mi1[i - 1], a[i]);\r\n\t}\r\n\tfor (int i = n; i; i--) {\r\n\t\tmx2[i] = max(mx2[i + 1], a[i]);\r\n\t\tmi2[i] = min(mi2[i + 1], a[i]);\r\n\t}\r\n    \r\n\tll ans = -4e18; //\u6ce8\u610f\u8981\u8db3\u591f\u5c0f\u3002\r\n\t//\u679a\u4e3e q\r\n\tfor (int i = 1 ; i <= n; i++) {\r\n\t\tll x, y, z;\r\n\t\tx = p * ((p < 0) ? mi1[i] : mx1[i]); // p\r\n\t\ty = r * ((r < 0) ? mi2[i] : mx2[i]); // r\r\n\t\tz = q * a[i]; // q\r\n\t\tans = max(ans, x + y + z); // \u53d6\u6700\u5927\r\n\t}\r\n\tcout << ans << endl;\r\n \treturn 0;\r\n} \r\n\r\n\r\n``",
        "postTime": 1660228201,
        "uid": 363317,
        "name": "Nicrobot",
        "ccfLevel": 4,
        "title": "CF855B \u9898\u89e3"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF855B)\n\n---\n\n### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e09\u4e2a\u6570 $p$\uff0c$q$\uff0c$r$ $(- 10 ^ 9 \\le p,q,r \\le 10 ^ 9)$ \uff0c\u548c\u4e00\u4e2a\u5927\u5c0f\u4e3a $n(1 \\le n \\le 10 ^ 5)$ \u6570\u7ec4 $a$\u3002\n\n\u6c42\u627e\u51fa\u4e09\u4e2a\u6570 $a_i$\uff0c$a_j$\uff0c$a_k$ $(1 \\le i \\le j \\le k \\le n,- 10 ^ 9 \\le a_i \\le 10 ^ 9)$ \u4f7f\u5f97 $p \\times a_i + q \\times a_j + r \\times a_k$ \u7684\u503c\u6700\u5927\u3002\n\n---\n\n### \u5206\u6790\n\n\u8003\u8651\u5982\u4f55\u8ba9 $p \\times a_i + q \\times a_j + r \\times a_k$ \u6700\u5927\u3002\n\n\u53ef\u4ee5\u8bbe\u4e00\u4e2a\u72b6\u6001\u4e3a $dp[i][j]$ \u8868\u793a\u8003\u8651\u6570\u7ec4\u7b2c $j$ \u4e2a\u6570\uff0c\u7ed9\u5b9a\u7684\u4e09\u4e2a\u6570\u7684\u7b2c $i$ \u4e2a\u6570\u7684\u65f6\u5019\u80fd\u53d6\u5230\u7684\u6700\u5927\u503c\uff0c\u7136\u540e\u56e0\u4e3a $i,j,k$ \u6ee1\u8db3\u975e\u4e25\u683c\u9012\u589e\uff0c\u6240\u4ee5\u8f6c\u79fb\u7684\u65f6\u5019\u9700\u8981\u8003\u8651\u987a\u5e8f\uff0c\u5373\u5148\u8003\u8651\u7b2c\u4e00\u4e2a\u6570\uff0c\u7136\u540e\u518d\u8003\u8651\u7b2c\u4e8c\u4e2a\u6570\u548c\u7b2c\u4e09\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5c31\u6709\u4e86\uff1a\n\n$dp[0][i]=\\max(dp[0][i-1],p \\times a[i])$\n\n$dp[1][i]=\\max(dp[1][i-1],\\max(dp[0][i-1] + q \\times a[i],dp[0][i] + q \\times a[i]))$\n\n$dp[2][i]=\\max(dp[2][i-1],\\max(dp[1][i-1] + r \\times a[i],dp[1][i] + r \\times a[i]))$\n\n\u7136\u540e\u521d\u59cb\u5316 dp \u6570\u7ec4\u4e3a\u8d1f\u65e0\u7a77\uff0c\u987a\u5e8f\u8f6c\u79fb\u5373\u53ef\uff0c\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u8bb0\u5f97\u5f00 ```long long```\uff01\n\n---\n\n### \u4ee3\u7801\n\n```cpp\n//you have no way to return\n#include<bits/stdc++.h>\n// #include<Windows.h>\n#define ri register\n#define in inline\n#define int long long\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1;char ch=getchar();while(ch>'9'||ch<'0') {if(ch=='-') f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') {x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}return x*f;\n}\nvoid write(int x) {if(x<0) x=-x,putchar('-');if(x>9) write(x/10);putchar(x%10+'0');}\nconst int maxn=1e5+1;\nint dp[3][maxn];\nsigned main()\n{\n\tint n=read(),p=read(),q=read(),r=read();\n\tfor(ri int i=0;i<=n;i++) for(ri int j=0;j<=2;j++) dp[j][i]=-8e18;\n\tfor(ri int i=1;i<=n;i++)\n\t{\n\t\tint x=read();\n\t\tdp[0][i]=max(dp[0][i-1],p*x);\n\t\tdp[1][i]=max(dp[1][i-1],dp[0][i-1]+q*x);\n\t\tdp[1][i]=max(dp[1][i],dp[0][i]+q*x);\n\t\tdp[2][i]=max(dp[2][i-1],dp[1][i-1]+r*x);\n\t\tdp[2][i]=max(dp[2][i],dp[1][i]+r*x);\n\t\t// write(dp[0][i]),putchar(' '),write(dp[1][i]),putchar(' '),write(dp[2][i]),puts(\"\");\n\t}\n\twrite(dp[2][n]);\n\treturn 0;\n}\n```",
        "postTime": 1637146861,
        "uid": 388626,
        "name": "123hh2",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011CF855B Marvolo Gaunt's Ring"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Coros-Trusds/p/15558877.html)\n\n# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a $n,p,q,r$\uff0c\u5e76\u4e14\u7ed9\u51fa $n$ \u4e2a\u6570\u3002\n\n\u5728\u8fd9\u4e9b\u6570\u4e2d\u627e $i,j,k(1\\le i\\le j\\le k\\le n)$\uff0c\u6c42\u51fa $\\max\\{p\\times a_i+q\\times a_j+r\\times a_k\\}$\u3002\n\n# \u9898\u76ee\u5206\u6790\n\n\u4e00\u9053\u5c0f\u6e05\u65b0 $\\rm DP$ \u9898\u3002\n\n\u8bbe $dp[idx][0]$ \u8868\u793a\u524d $idx$ \u4e2a\u6570\u7684 $\\max\\{p\\times a_i\\}(1\\le i\\le idx)$\u3002\n\n$dp[idx][1]$ \u8868\u793a\u524d $idx$ \u4e2a\u6570\u7684 $\\max\\{p\\times a_i+q\\times a_j\\}(1\\le i\\le j\\le idx)$\u3002\n\n$dp[idx][2]$ \u8868\u793a\u524d $idx$ \u4e2a\u6570\u7684 $\\max\\{p\\times a_i+q\\times a_j+r\\times a_k\\}(1\\le i\\le j\\le k\\le idx)$\u3002\n\n\u4e8e\u662f\u987a\u63a8\u5373\u53ef\uff1a\n\n$dp[idx][0]=\\max\\{dp[idx-1][0],p\\times a_i\\}$\n\n$dp[idx][1]=\\max\\{dp[idx-1][1],dp[idx][0]+q\\times a_i\\}$\n\n$dp[idx][2]=\\max\\{dp[idx-1][2],dp[idx][1]+r\\times a_i\\}$\n\n\u521d\u59cb\u5316\uff1a\n\n+ $dp[idx][0]=p\\times a_1$\n\n+ $dp[idx][1]=p\\times a_1+q\\times a_1$\n\n+ $dp[idx][2]=p\\times a_1+q\\times a_1+r\\times a_1$\n\n\u6700\u540e\u7b54\u6848\u5c31\u662f $dp[n][2]$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\operatorname{O}(N)$\u3002\n\n\u6ce8\u610f\u5f00 $\\rm long~long$\u3002\n\n# \u4ee3\u7801\n\n```cpp\n//2021/11/14\n\n#define _CRT_SECURE_NO_WARNINGS\n\n#include <iostream>\n\n#include <cstdio>\n\n#include <climits>//need \"INT_MAX\",\"INT_MIN\"\n\n#define int long long\n\n#define enter() putchar(10)\n\n#define debug(c,que) cerr<<#c<<\" = \"<<c<<que\n\n#define cek(c) puts(c)\n\n#define blow(arr,st,ed,w) for(register int i=(st);i<=(ed);i++)cout<<arr[i]<<w;\n\n#define speed_up() std::ios::sync_with_stdio(false)\n\nnamespace Newstd\n{\n\tinline int read()\n\t{\n\t\tchar c;\n\t\tbool flag=false;\n\t\twhile((c=getchar())<'0' || c>'9')\n\t\t{\n\t\t    if(c=='-') flag=true;\n\t\t}\n\t\tint res=c-'0';\n\t\twhile((c=getchar())>='0' && c<='9')\n\t\t{\n\t\t    res=(res<<3)+(res<<1)+c-'0';\n\t\t}\n\t\treturn flag?-res:res;\n\t}\n\tinline void print(int x)\n\t{\n\t\tif(x<0)\n\t\t{\n\t\t\tputchar('-');x=-x;\n\t\t}\n\t\tif(x>9)\n\t\t{\n\t\t\tprint(x/10);\n\t\t}\n\t\tputchar(x%10+'0');\n\t}\n}\n\nusing namespace Newstd;\n\nusing namespace std;\n\nconst int ma=100005;\n\nint a[ma];\n\nint dp[ma][3];\n/*\ndp[i][0]:\u524d i \u4e2a\u6570\u4e2d\u53d6 p*a_i \u6700\u5927\u503c\ndp[i][1]:\u524d i \u4e2a\u6570\u4e2d\u53d6 p*a_i+q*a_j \u6700\u5927\u503c\ndp[i][2]:\u524d i \u4e2a\u6570\u4e2d\u53d6 p*a_i+q*a_j+r*a_k \u6700\u5927\u503c \n*/\n\nint n,p,q,r;\n\n#undef int\n\nint main(void)\n{\n\t#define int long long\n\t\n\tn=read(),p=read(),q=read(),r=read();\n\t\n\tfor(register int i=1;i<=n;i++)\n\t{\n\t\ta[i]=read();\n\t}\n\t\n\tdp[1][0]=p*a[1];\n\t\n\tfor(register int i=2;i<=n;i++)\n\t{\n\t\tdp[i][0]=max(dp[i-1][0],p*a[i]);\n\t}\n\t\n\tdp[1][1]=p*a[1]+q*a[1];\n\t\n\tfor(register int i=2;i<=n;i++)\n\t{\n\t\tdp[i][1]=max(dp[i-1][1],dp[i][0]+q*a[i]);\n\t}\n\t\n\tdp[1][2]=p*a[1]+q*a[1]+r*a[1];\n\t\n\tfor(register int i=2;i<=n;i++)\n\t{\n\t\tdp[i][2]=max(dp[i-1][2],dp[i][1]+r*a[i]);\n\t}\n\t\n\tprintf(\"%lld\\n\",dp[n][2]);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1636986320,
        "uid": 430409,
        "name": "Coros_Trusds",
        "ccfLevel": 6,
        "title": "CF855B Marvolo Gaunt's Ring"
    }
]