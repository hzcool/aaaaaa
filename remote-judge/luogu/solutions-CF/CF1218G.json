[
    {
        "content": "[\u5728 cnblogs \u4e2d\u9605\u8bfb](https://www.cnblogs.com/acceptedzhs/p/sol-cf1218g.html)\u3002\n\n### Part 1\n\n\u8bbe $w_x$ \u8868\u793a\u70b9 $x$ \u7684\u6743\u503c $\\bmod\\ 3$\uff0c$c_x$ \u8868\u793a $x$ \u7684\u6240\u5c5e\u96c6\u5408\u7f16\u53f7\uff08$c_x \\in \\{0,1,2\\}$\uff09\uff0c$v_i$ \u8868\u793a\u7b2c $i$ \u6761\u8fb9\u7684\u6743\u503c\u3002\n\n\u4e00\u4e2a\u76f4\u63a5\u7684\u60f3\u6cd5\u662f**\u4f7f\u6240\u6709 $w_x=c_x$**\uff0c\u5f53\u7136\u8fd9\u4e0d\u4e00\u5b9a\u80fd\u505a\u5230\uff0c\u5177\u4f53\u89c1\u4e0b\u6587\u3002\n\n\u9996\u5148\uff0c\u6839\u636e\u5957\u8def\uff0c\u968f\u4fbf\u5efa\u4e00\u9897\u751f\u6210\u6811\u51fa\u6765\u3002\u8bbe\u6839\u4e3a $rt$\u3002\n\n\u5148\u5c06\u6240\u6709\u975e\u6811\u8fb9\u6743\u503c\u8bbe\u4e3a $3$\u3002\u5bf9\u4e8e\u70b9 $u$\uff0c\u82e5\u5176\u5b50\u6811\u5185\u6240\u6709\u6811\u8fb9\u6743\u503c\u90fd\u786e\u5b9a\u4e86\uff0c\u5219 $u$ \u5230\u7236\u4eb2\u7684\u6811\u8fb9\u7684\u6743\u503c\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u3002\n\n\u7136\u800c\uff0c$rt$ \u6ca1\u6709\u5230\u7236\u4eb2\u7684\u8fb9\uff0c\u6b64\u65f6\u8981\u505a\u51fa\u8c03\u6574\uff1a\n\n1. \u5982\u679c\u6b64\u65f6 $w_{rt}=c_{rt}$\uff0c\u5219\u65b9\u6848\u5df2\u7ecf\u5408\u6cd5\u3002\n2. \u5426\u5219\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u5305\u542b $rt$ \u7684\u4e00\u4e2a\u73af\u8fdb\u884c\u8c03\u6574\u3002\n\n### Part 2\n\n\u63d0\u53d6\u51fa\u5305\u542b $rt$ \u7684\u4e00\u4e2a\u73af\uff0c\u8bbe\u73af\u4e0a**\u8fb9**\u7684\u7f16\u53f7\u4f9d\u6b21\u4e3a $e_1,e_2,\\dots,e_k$\uff0c\u5176\u4e2d $e_1,e_2$ \u4e24\u6761\u8fb9\u5747\u6709\u4e00\u4e2a\u7aef\u70b9\u662f $rt$\u3002\n\n**\u5076\u73af\u662f\u6ca1\u7528\u7684**\uff0c\u56e0\u4e3a\u5728\u5076\u73af\u4e0a\u5bf9\u6743\u503c\u8c03\u6574\u53ea\u80fd\u5f62\u5982 $v_{e_1}+1,v_{e_2}+2,v_{e_3}+1,v_{e_4}+2,\\dots$\uff0c\u65e0\u6cd5\u6539\u53d8\u4efb\u4f55\u4e00\u70b9\u7684\u6743\u503c\u3002\n\n**\u5947\u73af\u662f\u6709\u7528\u7684**\uff0c\u8003\u8651\u5982\u4e0b\u8c03\u6574\uff1a\n\n- \u5f53 $w_{rt}+1\\equiv c_{rt} \\pmod 3$\uff0c\u6267\u884c $v_{e_1}+2,v_{e_2}+2,v_{e_3}+1,v_{e_4}+2,v_{e_5}+1,\\dots$\u3002\u663e\u7136\u73af\u4e0a\u9664\u4e86 $rt$ \u5176\u4ed6\u70b9\u7684\u6743\u503c\u5747\u672a\u6539\u53d8\u3002 \n- \u5f53 $w_{rt}+2\\equiv c_{rt} \\pmod 3$\uff0c\u6267\u884c $v_{e_1}+1,v_{e_2}+1,v_{e_3}+2,v_{e_4}+1,v_{e_5}+2,\\dots$\u3002\n\n\u56e0\u6b64\uff0c\u5f53\u539f\u56fe\u4e2d\u5b58\u5728\u5947\u73af\uff0c**\u5c06 $rt$ \u53d6\u5947\u73af\u4e0a\u7684\u4efb\u610f\u4e00\u70b9**\uff0c\u4e00\u5b9a\u53ef\u4ee5\u6784\u9020\u51fa\u5408\u6cd5\u65b9\u6848\u3002\n\n### Part 3\n\n\u5982\u679c\u6ca1\u6709\u5947\u73af\u5462\uff1f\u5bb9\u6613\u60f3\u5230**\u539f\u56fe\u662f\u4e8c\u5206\u56fe**\u3002\n\n\u8003\u8651\u91cd\u65b0\u5c06\u6240\u6709\u70b9\u5212\u5206\u4e3a $2$ \u4e2a\u96c6\u5408\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u56fe\u67d3\u8272\u5b9e\u73b0\u3002\u8bbe $c_x$ \u8868\u793a $x$ \u65b0\u7684\u6240\u5c5e\u96c6\u5408\u7f16\u53f7\uff08$c_x \\in \\{1,2\\}$\uff09\u3002\n\n\u4e0d\u5931\u4e00\u822c\u6027\u5730\u8bbe $c_{rt}=1$\uff0c\u8fd8\u662f\u50cf Part 1 \u90a3\u6837\u5c06\u5904\u7406\u6811\u8fb9\uff0c\u6700\u540e\u8003\u8651 $rt$ \u7684\u60c5\u51b5\uff1a\n\n1. $w_{rt} \\ne 2$\u3002\u6b64\u65f6\u65b9\u6848\u5df2\u7ecf\u5408\u6cd5\u3002\u56e0\u4e3a\u5bf9\u4e8e\u4e0e $rt$ \u4e4b\u95f4\u6709\u8fb9\u7684\u70b9 $u$ \u5fc5\u6709 $w_u=2 \\ne w_{rt}$\u3002\n2. $rt$ \u7684\u5ea6\u6570 $=1$\u3002\u6b64\u65f6\u65b9\u6848\u5df2\u7ecf\u5408\u6cd5\u3002\u8bbe\u4e0e $rt$ \u4e4b\u95f4\u6709\u8fb9\u7684\u70b9\u4e3a $u$\uff0c\u663e\u7136 $u$ \u7684\u5ea6\u6570 $>1$\uff0c\u5219 $u$ \u7684\u6743\u503c\u5fc5\u7136 $>$ $rt$ \u7684\u6743\u503c\u3002\n3. $w_{rt}=2$ \u4e14 $rt$ \u7684\u5ea6\u6570 $>1$\u3002\u9009\u51fa\u4e0e $rt$ \u4e4b\u95f4\u6709\u8fb9\u7684\u4e24\u4e2a\u70b9 $u,v$\uff0c\u5c06 $(rt,u),(rt,v)$ \u4e24\u6761\u8fb9\u7684\u6743\u503c $+1$ \u5373\u53ef\u3002\u8c03\u6574\u540e $w_{rt}=1,w_u=w_v=0$\uff0c\u53ef\u4ee5\u8bc1\u660e\u6ee1\u8db3\u8981\u6c42\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\u4e0d\u96be\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nusing i64=long long;\nusing u64=unsigned long long;\nusing db=double;\nusing pii=pair<int,int>;\nusing vi=vector<int>;\n\ntemplate<typename T>\ninline T read(){\n    T x=0,f=0;char ch=getchar();\n    while(!isdigit(ch)) f|=(ch=='-'),ch=getchar();\n    while(isdigit(ch)) x=x*10+(ch-'0'),ch=getchar();\n    return f?-x:x;\n}\n\n#define rdi read<int>\n#define rdi64 read<i64>\n#define fi first\n#define se second\n#define pb push_back\n\nconst int N=2e5+10;\n\nint n,m,typ[N];\nchar s[N];\n\nstruct Edge{int to,nxt,fl,w;}e[N];\nint head[N],tot=1,deg[N];\n\nvoid add_e(int x,int y){\n    e[++tot]={y,head[x],0,0};\n    head[x]=tot,++deg[x];\n}\n\nbool odd_lp;\nint col[N];\nvoid dfs(int x,int c=1){\n    col[x]=c;\n    for(int i=head[x];i;i=e[i].nxt){\n        int y=e[i].to;\n        if(!col[y]) e[i].fl=e[i^1].fl=1,dfs(y,3-c);\n        else if(col[y]==col[x]) odd_lp=true;\n    }\n}\n\nnamespace S1{\n    int sum[N];\n    void dfs1(int x,int fa){\n        for(int i=head[x];i;i=e[i].nxt){\n            if(!e[i].fl) continue;\n            int y=e[i].to;\n            if(y!=fa) dfs1(y,x),sum[x]+=e[i].w;\n        }\n        for(int i=head[x];i;i=e[i].nxt){\n            if(e[i].fl&&e[i].to==fa){\n                e[i].w=e[i^1].w=(col[x]+3-sum[x]%3)%3;\n                sum[x]=col[x];break;\n            }\n        }\n    }\n    void solve(){\n        int rt=find(col+1,col+n+1,1)-col;\n        dfs1(rt,0);\n        if(deg[rt]>1&&sum[rt]%3==2){\n            int i1=head[rt],i2=e[i1].nxt;\n            e[i1].w++,e[i1^1].w++,e[i2].w++,e[i2^1].w++;\n        }\n    }\n}\n\nnamespace S2{\n    int rt,u,sum[N],tofa[N];\n    void dfs1(int x,int fa){\n        for(int i=head[x];i;i=e[i].nxt){\n            if(!e[i].fl) continue;\n            int y=e[i].to;\n            if(y!=fa) dfs1(y,x),sum[x]+=e[i].w;\n        }\n        for(int i=head[x];i;i=e[i].nxt){\n            if(e[i].fl&&e[i].to==fa){\n                e[i].w=e[i^1].w=(typ[x]+3-sum[x]%3)%3;\n                sum[x]=typ[x],tofa[x]=i;\n                break;\n            }\n        }\n    }\n\n    void adjust(){\n        if(sum[rt]%3==typ[rt]%3) return;\n        vi cyc;int x=u;\n        while(x!=rt) cyc.pb(tofa[x]),x=e[tofa[x]].to;\n        for(int i=head[rt];i;i=e[i].nxt)\n            if(!e[i].fl&&e[i].to==u) {cyc.insert(cyc.begin(),i);break;}\n        int val=(sum[rt]+1)%3==typ[rt]%3?2:1;\n        for(auto id:cyc) e[id].w+=val,e[id^1].w+=val,val=3-val;\n    }\n\n    void solve(){\n        for(int x=1;x<=n;x++){\n            bool fl=0;\n            for(int i=head[x];i;i=e[i].nxt)\n                if(col[e[i].to]==col[x]){\n                    fl=1,rt=x,u=e[i].to;\n                    break;\n                }\n            if(fl) break;\n        }\n        dfs1(rt,0),adjust();\n    }\n}\n\nvoid output(){\n    for(int i=2;i<=tot;i+=2){\n        int x=e[i^1].to,y=e[i].to,w=(e[i].w+2)%3+1;\n        cout<<x-1<<' '<<y-1<<' '<<w<<'\\n';\n    }\n}\n\nint main(){\n    n=rdi(),m=rdi();\n    scanf(\"%s\",s+1);\n    for(int i=1;i<=n;i++) typ[i]=s[i]-'X'+1;\n    for(int i=1;i<=m;i++){\n        int x=rdi()+1,y=rdi()+1;\n        add_e(x,y),add_e(y,x);\n    }\n    dfs(1);\n    if(odd_lp) S2::solve();\n    else S1::solve();\n    output();\n    return 0;\n}\n```\n",
        "postTime": 1670494835,
        "uid": 107236,
        "name": "Zesty_Fox",
        "ccfLevel": 9,
        "title": "CF1218G \u9898\u89e3"
    }
]