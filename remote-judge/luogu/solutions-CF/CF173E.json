[
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u5728\u7ebf\u505a\u6cd5\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u4eba\u5f53\u961f\u957f\u65f6\u53ef\u4ee5\u5bb9\u7eb3\u7684\u4eba\u6570\uff0c\u8fd9\u4e2a\u663e\u7136\u53ef\u4ee5\u6309 $r_i$ \u6392\u5b8c\u5e8f\u540e\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u8bbe\u8fd9\u4e2a\u4e3a $ans_i$\u3002\n\n\u63a5\u7740\u6211\u4eec\u518d\u6309 $a_i$ \u6392\u5e8f\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u4e8c\u5206\u51fa $x,y$ \u7684 \"\u961f\u957f\u53ef\u9009\u533a\u95f4\"\uff0c\u518d\u6c42\u4e2a\u5e76\u53ef\u4ee5\u6c42\u51fa $[l,r]$ \u8868\u793a\u603b\u7684\u53ef\u9009\u533a\u95f4\u3002\n\n\u6b64\u65f6\u95ee\u9898\u53d8\u6210\u4e86\u5728 $[l,r]$ \u4e2d\u8be2\u95ee\u6ee1\u8db3 $r_i \\ge max(r_x,r_y)$ \u7684\u5143\u7d20\u4e2d $ans_i$ \u7684\u6700\u5927\u503c\u3002\u79bb\u7ebf\u5f88\u597d\u89e3\u51b3\u3002\u8003\u8651\u5982\u679c\u5e26\u4fee\u4e14\u5f3a\u5236\u5728\u7ebf\uff1f\u8fd9\u4e2a\u662f\u5178\u4e2d\u5178\u6811\u5957\u6811\u4e86\u3002\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4\u6b64\u533a\u95f4\u7684\u5e73\u8861\u6811\u5373\u53ef\uff0c\u6211\u7528\u7684\u5e73\u8861\u6811\u662f\u65e0\u65cbTreap\u3002\n\n\u4e8e\u662f\u6211\u5199\u5b8c\u4ea4\u4e0a\u53bb\uff0c\u7ed3\u679c **Time limit exceeded on test 13**\u3002\n\n\u4e8b\u5b9e\u4e0a\u8fd9\u4e2a\u505a\u6cd5\u5982\u679c\u5199\u7684\u4e0d\u7cbe\u7ec6\u7684\u8bdd\uff0c\u5e38\u6570\u4f1a\u5f88\u5927\uff0c\u7ecf\u5b9e\u9645\u6d4b\u8bd5\uff0c\u6211\u7684\u4ee3\u7801\u53ea\u80fd\u901a\u8fc7 $n \\le 6 \\times 10^4$ \u7684\u6570\u636e\uff0c\u8003\u8651\u5361\u5e38\u3002\n\n$1.$ \u7ebf\u6bb5\u6811\u5148\u8bbf\u95ee\u5de6\u513f\u5b50\uff0c\u8bbe\u8fd4\u56de\u7684\u503c\u4e3a $ret$\uff0c\u5982\u679c\u53f3\u513f\u5b50\u91cc $ans_i$ \u7684\u6700\u5927\u503c\u90fd $ \\le ret$ \u90a3\u4e48\u5c31\u6ca1\u5fc5\u8981\u8bbf\u95ee\u53f3\u513f\u5b50\u3002\n \n$2.$ \u5f53\u7ebf\u6bb5\u6811\u4e0a\u4e00\u4e2a\u8282\u70b9\u5bf9\u5e94\u7684\u5e73\u8861\u6811\u4e0a\u7684\u6700\u5927\u503c\u5c0f\u4e8e\u5f53\u524d\u5df2\u77e5\u7684\u6700\u5927\u503c\uff0c\u5c31\u6ca1\u5fc5\u8981\u5230\u5e73\u8861\u6811\u91cc\u53bb\u67e5\u4e86\u3002\n\n$3.$ \u5982\u679c\u4f60\u4e5f\u662f\u7528\u7684\u65e0\u65cb Treap\uff0c\u5efa\u6811\u7684\u65f6\u5019\u4e0d\u8981\u66b4\u529b insert\uff0c\u5148\u6309\u952e\u503c\u6392\u597d\u5e8f\u540e\u518d\u4f9d\u6b21\u63d2\u5165\u3002\n\n\u8fd9\u6837\u5c31\u8dd1\u5f97\u98de\u5feb\u4e86\uff0c\u751a\u81f3\u540a\u6253\u4e00\u4e9b\u79bb\u7ebf\u505a\u6cd5\u3002\n\nTLE \u4ee3\u7801\uff1ahttps://codeforces.com/problemset/submission/173/153549924\n\nAC \u4ee3\u7801\uff1ahttps://codeforces.com/problemset/submission/173/153558571",
        "postTime": 1649855191,
        "uid": 225183,
        "name": "\u5468\u5c0f\u6db5",
        "ccfLevel": 0,
        "title": "CF173E Camping Groups"
    },
    {
        "content": "\u6570\u636e\u7ed3\u6784~~\u7801\u519c~~\u597d\u9898\u3002\n\n\u5148\u603b\u7ed3\u4e00\u4e9b\u9650\u5236\uff1a\n\n1. \u5305\u542b$x,y$\u7684\u961f\u957f\u7684\u5730\u4f4d\u8981$\\geq max(p[x],p[y])$\u3002\n\n2. \u5bf9\u4e8e$x,y$\uff0c\u8bbe$age[x]\\leq age[y]$\uff0c\u5219\u961f\u957f\u7684\u5e74\u9f84\u9650\u5236\u4e3a$[age[y]-k,age[x]+k]$\uff0c\u82e5$age[y]-k>age[x]+k$\u5219\u4e0d\u5408\u6cd5\u3002 \n\n\u9996\u5148\u6211\u4eec\u9884\u5904\u7406\u6bcf\u4e2a\u4eba\u505a\u961f\u957f\u65f6\uff0c\u8fd9\u4e2a\u961f\u7684\u6700\u5927\u4eba\u6570\u3002\u8fd9\u4e1c\u897f\u6211\u4eec\u8bbe\u4e3a$can[i]$\uff0c\u6c42\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u6309\u5730\u4f4d\u6392\u4e2a\u5e8f\uff0c\u7136\u540e\u4e3b\u5e2d\u6811\u5373\u53ef\u3002\n\n\u7136\u540e\u8003\u8651\u79bb\u7ebf\u505a\u8fd9\u9053\u9898\uff0c\u6839\u636e\u7b2c\u4e00\u4e2a\u9650\u5236\uff0c\u6211\u4eec\u5bf9\u4e8e\u6240\u6709\u8be2\u95ee\uff0c\u6309$max(p[x],p[y])$\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002\u90a3\u4e48\u505a\u8fd9\u4e2a\u8be2\u95ee\u524d\uff0c\u6211\u4eec\u9700\u8981\u628a$p[i]\\geq max(p[x],p[y])$\u7684\u6bcf\u4e2a\u4eba\u4f5c\u4e3a\u961f\u957f\u7684$can[i]$\u63d2\u5165\u5230\u7ebf\u6bb5\u6811\u4e0a\u8fd9\u4e2a\u4eba\u5e74\u9f84\u7684\u4f4d\u7f6e\u3002\u7136\u540e\u5728\u8fd9\u4e2a\u8be2\u95ee\u9700\u8981\u6ee1\u8db3\u7684\u5e74\u9f84\u9650\u5236$($\u4e5f\u5c31\u662f\u9650\u5236$2)$\u7684\u8303\u56f4\u5185\uff0c\u67e5\u8be2\u6700\u5927\u7684$can[i]$\u5373\u53ef\u3002\n\n\u6709\u4e86\u601d\u8def\uff0c\u4ee3\u7801\u5176\u5b9e\u5c31\u662f\u4e00\u5806\u6570\u636e\u7ed3\u6784\u62fc\u51d1\u8d77\u6765\uff0c\u6ce8\u610f\u5b9e\u73b0\u7ec6\u8282\u5373\u53ef\u3002\n\n$Code\\ Below:$\n```cpp\n#include<bits/stdc++.h>\n#define ts cout<<\"ok\"<<endl\n#define ll long long\n#define hh puts(\"\")\n#define pc putchar\n//#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n//char buf[1<<21],*p1=buf,*p2=buf;\nusing namespace std;\nconst int N=100005;\nint n,m,k,b[N],B,pos[N],same[N],can[N],rt[N],ans[N];\nstruct node{\n    int p,age,id;\n    friend bool operator < (node A,node B){\n        return A.p<B.p;\n    }\n}a[N];\nstruct que{\n    int x,y,v;\n}q[N];\nstruct lxy{\n    int l,r,id;\n};\nvector<lxy> g[N];\nvector<int> alb[N];\nstruct ChairMan_Tree{\n    int ls[N*40],rs[N*40],sum[N*40],cnt;\n    void build(int &now,int l,int r,int x){\n        now=++cnt;\n        if(l==r){\n            sum[now]++;\n            return;\n        }\n        int mid=(l+r)>>1;\n        if(x<=mid) build(ls[now],l,mid,x);\n        else build(rs[now],mid+1,r,x);\n        sum[now]=sum[ls[now]]+sum[rs[now]];\n    }\n    void update(int &now,int pre,int l,int r,int x){\n        now=++cnt;\n        ls[now]=ls[pre],rs[now]=rs[pre],sum[now]=sum[pre]+1;\n        if(l==r) return;\n        int mid=(l+r)>>1;\n        if(x<=mid) update(ls[now],ls[pre],l,mid,x);\n        else update(rs[now],rs[pre],mid+1,r,x);\n    }\n    int query(int now,int l,int r,int x,int y){\n        if(!now) return 0;\n        if(x<=l&&r<=y) return sum[now];\n        int mid=(l+r)>>1,res=0;\n        if(x<=mid) res+=query(ls[now],l,mid,x,y);\n        if(mid+1<=y) res+=query(rs[now],mid+1,r,x,y);\n        return res;\n    }\n}Tr;\nstruct Segment_Tree{\n    int ls[N*40],rs[N*40],mx[N*40],cnt,rt;\n    void update(int l,int r,int x,int v,int &k){\n        if(!k) k=++cnt;\n        if(l==r){\n            mx[k]=max(mx[k],v);\n            return;\n        }\n        int mid=(l+r)>>1;\n        if(x<=mid) update(l,mid,x,v,ls[k]);\n        else update(mid+1,r,x,v,rs[k]);\n        mx[k]=max(mx[ls[k]],mx[rs[k]]);\n    }\n    int query(int l,int r,int x,int y,int k){\n        if(!k) return 0;\n        if(x<=l&&r<=y) return mx[k];\n        int mid=(l+r)>>1,res=0;\n        if(x<=mid) res=max(res,query(l,mid,x,y,ls[k]));\n        if(mid+1<=y) res=max(res,query(mid+1,r,x,y,rs[k]));\n        return res;\n    }\n}T;\ninline int read(){\n    int ret=0,ff=1;char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-') ff=-1;ch=getchar();}\n    while(isdigit(ch)){ret=ret*10+(ch^48);ch=getchar();}\n    return ret*ff;\n}\nvoid write(int x){if(x<0){x=-x,pc('-');}if(x>9) write(x/10);pc(x%10+48);}\nvoid writeln(int x){write(x),hh;}\nvoid writesp(int x){write(x),pc(' ');}\nsigned main(){\n    n=read(),k=read();\n    for(int i=1;i<=n;i++){\n        a[i].p=read();\n        a[i].id=i;\n        b[i]=a[i].p;\n    }\n    for(int i=1;i<=n;i++) a[i].age=read();\n    sort(b+1,b+n+1);\n    B=unique(b+1,b+n+1)-b-1;\n    for(int i=1;i<=n;i++) a[i].p=lower_bound(b+1,b+B+1,a[i].p)-b;\n    sort(a+1,a+n+1);\n    Tr.build(rt[1],1,1e9,a[1].age);\n    for(int i=2;i<=n;i++) Tr.update(rt[i],rt[i-1],1,1e9,a[i].age);\n    int R;\n    for(int i=1;i<=n;i++){//\u76f8\u540c\u5730\u4f4d\u7684\u6211\u4eec\u5728\u67e5\u7684\u65f6\u5019\u8981\u627e\u5230\u6700\u53f3\u8fb9\u7684\u4eba\n        R=i;\n        while(R<=n&&a[R].p==a[i].p) R++;\n        R--;\n        for(int j=i;j<=R;j++) same[j]=R;\n        i=R;\n    }\n    for(int i=1;i<=n;i++){\n        pos[a[i].id]=i;\n        can[i]=Tr.query(rt[same[i]],1,1e9,max(1,a[i].age-k),min((int)1e9,a[i].age+k));\n        alb[a[i].p].push_back(i);\n    }\n    m=read();\n    for(int i=1;i<=m;i++){\n        q[i].x=read();\n        q[i].y=read();\n        q[i].x=pos[q[i].x];\n        q[i].y=pos[q[i].y];\n        q[i].v=max(a[q[i].x].p,a[q[i].y].p);\n        if(a[q[i].x].age>a[q[i].y].age) swap(q[i].x,q[i].y);\n        g[q[i].v].push_back((lxy){a[q[i].y].age-k,a[q[i].x].age+k,i});\n    }\n    for(int i=B;i>=1;i--){\n        for(int j=0;j<alb[i].size();j++){\n            int id=alb[i][j];\n            int age=a[id].age,val=can[id];//age\u8fd9\u4e2a\u70b9\u63d2\u5165val\u7684\u8d21\u732e \n            T.update(1,1e9,age,val,T.rt);\n        }\n        for(int j=0;j<g[i].size();j++){\n            int l=g[i][j].l,r=g[i][j].r,id=g[i][j].id;\n            if(l<=r) ans[id]=T.query(1,1e9,l,r,T.rt);\n            if(!ans[id]) ans[id]=-1;\n        }\n    }\n    for(int i=1;i<=m;i++) writeln(ans[i]);\n    return 0;\n}\n```\n",
        "postTime": 1572779931,
        "uid": 27858,
        "name": "ycyaw",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF173E \u3010Camping Groups\u3011"
    },
    {
        "content": " \n\n> $n$ \u4e2a\u4eba\uff0c\u6bcf\u4e2a\u4eba\u6709\u5730\u4f4d $r_i$ \u548c\u5e74\u9f84 $a_i$ \u3002\u5b9a\u4e49\u4e00\u4e2a\u5c0f\u7ec4\u7ec4\u957f\u4e3a\u5c0f\u7ec4\u4e2d\u5730\u4f4d\u4e0d\u4e25\u683c\u6700\u9ad8\uff0c\u5e74\u9f84\u4e0e\u5176\u4ed6\u6210\u5458\u5dee\u8ddd\u4e0d\u8d85\u8fc7 $k$ \u3002$m$ \u7ec4\u8be2\u95ee $(x,y)$ \u8868\u793a\u8be2\u95ee\u7b2c $x$ \u4e2a\u4eba\u4e0e\u7b2c $y$ \u4e2a\u4eba\u5206\u5230\u540c\u4e00\u7ec4\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u5c0f\u7ec4\u6700\u591a\u80fd\u5206\u5230\u591a\u5c11\u4eba\u3002\n> $$n\\le 10^5, k, r\\le 10^9$$\n\n\u67e5 FourteenObsidian \u8868\u5f97\u5230\u7684 DS \u597d\u9898\n\n\u4e00\u5f00\u59cb\u4e00\u76f4\u8003\u8651\u5728\u76f4\u63a5\u505a\uff0c\u7136\u540e\u80e1\u4e86\u4e2a\u6811\u5957\u6811\uff0c\u7136\u540e\u4e0d\u4f1a\u5199\u611f\u89c9\u7a7a\u95f4\u4e5f\u4f1a\u70b8\uff0c\u7136\u540e\u81ea\u95ed\u4e86......\n\n\u9047\u5230\u8fd9\u79cd**\u4e0d\u5f3a\u5236\u5728\u7ebf**\u7684\u9898\u7b2c\u4e00\u65f6\u95f4\u8fd8\u662f\u8981\u60f3\u79bb\u7ebf\u600e\u4e48\u505a\uff0c\u7136\u540e\u8fd9\u9898\u5982\u679c\u79bb\u7ebf\u4e0b\u6765\u5c31\u5f88\u597d\u505a\u4e86\u3002\n\n\u9996\u5148\u8003\u8651\u94a6\u5b9a\u4e00\u4e2a\u4eba\u4e3a\u7ec4\u957f\u7684\u8bdd\uff0c\u8fd9\u4e2a\u5c0f\u7ec4\u6700\u5927\u662f\u591a\u5c11?\n\n\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u8003\u8651\u628a\u4eba\u6309\u5e74\u9f84\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7136\u540e\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u4eba\u641e\u4e2a $l,r$ \u53cc\u6307\u9488\u7ef4\u62a4 $a_x \\in [a_i-k, a_i+k]$ \u7684\u6240\u6709\u4eba $x$  \uff0c\u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u4eba\u662f\u5e74\u9f84\u5408\u6cd5\u7684\uff0c\u4e8e\u662f\u53ea\u8981\u5728\u6307\u9488\u79fb\u52a8\u65f6\u628a\u6bcf\u4e2a\u4eba\u653e\u5230/\u62ff\u51fa**\u5730\u4f4d**\u6743\u503c\u6811\u72b6\u6570\u7ec4\u91cc\uff0c\u6307\u9488\u79fb\u52a8\u5b8c\u6bd5\u540e\u67e5\u6811\u72b6\u6570\u7ec4\u91cc\u5730\u4f4d\u5c0f\u4e8e\u7b49\u4e8e\u7b2c $i$ \u4eba\u7684\u4eba\u6570\u5c31\u53ef\u4ee5\u7b97\u51fa\u4ee5\u6bcf\u4e2a\u4eba\u4e3a\u7ec4\u957f\u7684\u7ec4\u5927\u5c0f\u4e86\u3002\n\n\u7136\u540e\u8003\u8651\u4e00\u4e2a $(x,y)$ \u7684\u8be2\u95ee\uff0c\u54ea\u4e9b\u4eba\u53ef\u4ee5\u6210\u4e3a\u8fd9\u4e2a\u8be2\u95ee\u7684\u7ec4\u957f\u5462?\n\n\u663e\u7136\u662f\u5730\u4f4d\u5927\u4e8e\u7b49\u4e8e $\\max \\{ r_x, r_y \\}$ \u7684\u4eba\uff0c\u4e8e\u662f\u6211\u4eec\u628a\u4e00\u4e2a\u8be2\u95ee\u6309 $\\max \\{ r_x, r_y \\}$ \u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u6bcf\u6b21\u641e\u4e2a\u6307\u9488\u79fb\u52a8\u4e0b\u7ef4\u62a4\u4e00\u4e2a\u53ef\u4ee5\u6210\u4e3a\u8be2\u95ee\u7ec4\u957f\u7684\u4eba\u7684\u96c6\u5408 $S$\u3002\n\n\u8fd9\u4e2a\u96c6\u5408\u5185\u7684\u6240\u6709\u4eba\u662f\u5730\u4f4d\u5408\u6cd5\u7684\uff0c\u8003\u8651\u5e74\u9f84\u5408\u6cd5\u7684\u4eba\u662f\u4ec0\u4e48\u6837\u7684\u3002\u4e0d\u59a8\u8bbe $a_x \\le a_y$ \uff0c\u5219\u53ef\u4ee5\u4f5c\u4e3a\u7ec4\u957f\u7684\u4eba\u5e74\u9f84\u5e94\u8be5\u5728 $[a_y - k, a_x + k]$ \u8fd9\u4e2a\u533a\u95f4\u5185\uff0c\u8fd9\u662f\u4e00\u4e2a\u8fde\u7eed\u533a\u95f4\uff0c\u6211\u4eec\u5f88\u81ea\u7136\u7684\u8003\u8651\u5230\u53ef\u4ee5\u628a $S$ \u7684\u6bcf\u4e2a\u4eba\u653e\u5230\u5e74\u9f84\u6743\u503c\u7ebf\u6bb5\u6811\u4e0a\uff0c\u6bcf\u4e2a\u8d21\u732e\u4e3a\u5176\u4f5c\u4e3a\u7ec4\u957f\u7684\u7ec4\u5927\u5c0f\uff0c\u7136\u540e\u67e5\u4e00\u4e0b\u533a\u95f4\u6700\u5927\u503c\u5373\u53ef\u89e3\u51b3\u3002\n\n\u4ee3\u7801\u7ec6\u8282\u662f\u7531\u4e8e\u5e74\u9f84\u548c\u5730\u4f4d\u90fd\u662f $\\le 10^9$ \u7684\uff0c\u6240\u4ee5\u9700\u8981\u79bb\u6563\u5316\uff0c\u800c\u5982\u679c\u4f60\u4e0d\u5c06\u8be2\u95ee\u6743\u503c\u7ebf\u6bb5\u6811\u65f6\u5f62\u6210\u7684 $[a_y-k,a_x+k]$ \u533a\u95f4\u4e5f\u653e\u5230\u79bb\u6563\u5316\u6570\u7ec4\u91cc\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u5728\u53f3\u7aef\u70b9\u8ba8\u8bba\u4e00\u4e0b~\n\n```cpp\n/* ==============================\n *  Author : Odalys \n *\n *  Mail : minyuenu@gmail.com\n * =============================== */\n#include <bits/stdc++.h>\nusing namespace std;\ntemplate <typename T> inline void read(T &a){\n\tT w=1; a=0;\n\tchar ch=getchar();\n\tfor(;ch < '0' || ch > '9';ch=getchar()) if(ch == '-') w=-1;\n\tfor(;ch>='0'&&ch<='9';ch=getchar()) a=(a<<3)+(a<<1)+(ch^48);\n\ta*=w;\n}\ntemplate <typename T> inline void ckmax(T &a, T b){a = a > b ? a : b;}\ntemplate <typename T> inline void ckmin(T &a, T b){a = a < b ? a : b;}\n#define fi first\n#define se second\n#define pb push_back\n#define mp make_pair\n#define pii pair<int, int> \n#define vi vector<int> \n#define Debug(x) cout << #x << \" = \" << x << endl\n#define For(i,l,r) for (int i = l; i <= r; ++i) \n#define foR(i,l,r) for (int i = l; i >= r; --i)\nconst int N = 1e5 + 10;\nstruct Node {\n\tint r, a, dw, id;\n} s[N]; \nbool cmp1 (Node x, Node y) { return x.dw < y.dw; }\nbool cmp2 (Node x, Node y) { return x.r > y.r; }\n\nstruct Ques {\n\tint x, y, id;\n\tbool operator < (const Ques &c) const {\n\t\treturn max(s[x].r, s[y].r) > max(s[c.x].r, s[c.y].r); \n\t}\n} q[N];\nint n, k, m;\n\nint lsh1[N], cnt1;\nint lsh2[N], cnt2; \n\nint Status[N], Age[N];\n\nint Ida (int x) { return lower_bound (lsh1 + 1, lsh1 + cnt1 + 1, x) - lsh1; }\nint Idr (int x) { return lower_bound (lsh2 + 1, lsh2 + cnt2 + 1, x) - lsh2; }\ninline void Init () {\n\tFor (i, 1, n) read(s[i].r), s[i].id = i, lsh2[++cnt2] = s[i].r;\n\tFor (i, 1, n) read(s[i].a), lsh1[++cnt1] = s[i].a;\n\tsort (lsh1 + 1, lsh1 + cnt1 + 1);\n\tcnt1 = unique(lsh1 + 1, lsh1 + cnt1 + 1) - lsh1 - 1;\n\tsort (lsh2 + 1, lsh2 + cnt2 + 1);\n\tcnt2 = unique(lsh2 + 1, lsh2 + cnt2 + 1) - lsh2 - 1;\n\tFor (i, 1, n) s[i].dw = Ida(s[i].a), s[i].r = Idr(s[i].r), Status[i] = s[i].r, Age[i] = s[i].a; \t\n\tread(m);\n\tFor (i, 1, m) \n\t\tread(q[i].x), read(q[i].y), q[i].id = i;\n\tsort (q + 1, q + m + 1); \n} // in & lsh\n\n\nstruct BIT {\n\tint sum[N];\n\tinline void upd (int x, int v) { for (int i = x; i <= cnt2; i += (i & (-i))) sum[i] += v; }\n\tinline int que (int x) { int Ans = 0; for (int i = x; i; i -= (i & (-i))) Ans += sum[i]; return Ans; }\n} tr; \n\nint val[N];\n\ninline void Captain() {\n\tstatic int L, R;\n\tL = 0, R = 0;\n\tsort (s + 1, s + n + 1, cmp1);\n\tFor (i, 1, n) {\n\t\twhile (R < n && s[R + 1].a - s[i].a <= k) R++, tr.upd (s[R].r, 1);\n\t\twhile (L < R && s[i].a - s[L + 1].a > k) L++, tr.upd (s[L].r, -1);\n\t\tval[s[i].id] = tr.que(s[i].r); \n\t}\n\tsort (s + 1, s + n + 1, cmp2);\n} // Get Every i to be Captain 's Ans \n\nint mx[N << 2];\n#define ls x << 1\n#define rs x << 1 | 1\ninline void pushup (int x) { mx[x] = max(mx[ls], mx[rs]); }\n\nvoid update (int x, int l, int r, int p, int v) {\n\tif (l == r) return ckmax(mx[x], v), void();\n\tint mid = l + r >> 1;\n\tif (p <= mid) update (ls, l, mid, p, v);\n\telse update(rs, mid + 1, r, p, v);\n\tpushup(x); \n}\n\nint query (int x, int l, int r, int ll, int rr) {\n\tif (ll > rr) return -1;\n\tif (ll <= l && r <= rr) return mx[x];\n\tint mid = l + r >> 1, Ans = -1;\n\tif (ll <= mid) ckmax(Ans, query(ls, l, mid, ll, rr));\n\tif (rr > mid) ckmax(Ans, query(rs, mid + 1, r, ll, rr));\n\treturn Ans;\n}\n#undef ls\n#undef rs\n\nint Ans[N]; \n\ninline void Solve () {\n\tint L = 0;\n\tFor (i, 1, m) {\n\t\tint tmp = max(Status[q[i].x], Status[q[i].y]);\n\t\twhile (L < n && s[L + 1].r >= tmp) L++, update(1, 1, cnt1, s[L].dw, val[s[L].id]);\n\t\tint ql = Age[q[i].x], qr = Age[q[i].y];\n\t\tif (ql > qr) swap(ql, qr);\n\t\tint l = qr - k, r = ql + k;\n\t\tif (l > r) { Ans[q[i].id] = -1; continue;}\n\t\tint xx = r;\n\t\tl = Ida(l), r = Ida(r); if (lsh1[r] > xx) r--; \n\t\tAns[q[i].id] = query (1, 1, cnt1, l, r);\n\t\tif (!Ans[q[i].id]) Ans[q[i].id] = -1;\n\t}\n} // download all the query to solve\n\nint main() {\n\tread(n); read(k);\n\tInit(); \n\tCaptain();\n\tSolve();\n\tFor (i, 1, m) printf (\"%d\\n\", Ans[i]); \n\treturn 0;\n}\n```",
        "postTime": 1632386280,
        "uid": 400028,
        "name": "Odalys",
        "ccfLevel": 0,
        "title": "CF173E Camping Groups"
    },
    {
        "content": "**[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/MnZnOIerLzy/articles/17234059.html)**\n\n# $\\texttt{Description}$\n\n**[CodeForces \u9898\u76ee\u94fe\u63a5](https://codeforces.com/problemset/problem/173/E \"CodeForces \u9898\u76ee\u94fe\u63a5\")**\n\n**[\u6d1b\u8c37\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/CF173E \"\u6d1b\u8c37\u9898\u76ee\u94fe\u63a5\")**\n\n> - $n$ \u4e2a\u4eba\uff0c\u7b2c $i$ \u4e2a\u4eba\u5730\u4f4d $r_i$\uff0c\u5e74\u9f84 $a_i$\u3002\u8981\u7ec4\u961f\uff0c\u961f\u957f\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a\n>\n>      - \u5730\u4f4d\u6700\u5927\uff08\u53ef\u4ee5\u5e76\u5217\uff09\u3002\n>\n>     - \u4e0e\u5176\u7ec4\u5458\u5e74\u9f84\u5dee\u8ddd\u4e0d\u8d85\u8fc7 $k$\u3002\n>\n>   $q$ \u4e2a\u8be2\u95ee\uff0c\u7b2c $i$ \u4e2a\u8be2\u95ee\u7ed9\u51fa $x_i,y_i$\uff0c\u6700\u5927\u5316 $x_i,y_i$ \u4e24\u4e2a\u4eba\u5728\u540c\u4e00\u7ec4\u91cc\u65f6\u7ec4\u5185\u7684\u4eba\u6570\u3002\n>\n> - $n,q\\le 10^5$\uff0c$k,a_i,r_i\\le 10^9$\uff0c$x_i,y_i\\le n$\u3002\n\n# $\\texttt{Solution}$\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u8003\u8651\u6c42\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u7ec4\u957f\uff0c\u518d\u5bf9\u7ec4\u7684\u5927\u5c0f\u53d6\u6700\u5927\u503c\u3002\n\n\u56e0\u6b64\u5148\u6c42\u51fa\u4ee5\u6bcf\u4e2a\u4eba\u4e3a\u7ec4\u957f\u65f6\uff0c\u7ec4\u7684\u6700\u5927\u4eba\u6570 $\\text{size}_i$\u3002\u5373\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u4eba\uff0c\u7edf\u8ba1\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6 $j$ \u7684\u4e2a\u6570\uff1a\n\n- $r_j\\le r_i$\u3002\n\n- $a_i-k\\le a_j\\le a_i+k$\u3002\n\n\u53ef\u4ee5\u8003\u8651\u628a\u6240\u6709\u4eba\u6309\u7167 $a$ **\u4ece\u5c0f\u5230\u5927**\u6392\u5e8f\uff0c\u8fd9\u6837 $a$ \u6ee1\u8db3**\u5355\u8c03\u6027**\uff0c\u53ef\u4ee5\u7528\u53cc\u6307\u9488\u7ef4\u62a4\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u3002\u540c\u65f6\u7528**\u6743\u503c\u6811\u72b6\u6570\u7ec4**\u7ef4\u62a4\u7b2c\u4e00\u4e2a\u6761\u4ef6\u3002\n\n\u518d\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u600e\u6837\u7684\u4eba\u53ef\u4ee5\u4f5c\u4e3a\u7ec4\u957f\u3002\u5373\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u8be2\u95ee\uff0c\u7ec4\u957f $j$ \u8981\u6ee1\u8db3 $r_j\\ge \\max\\{r_{x_i},r_{y_i}\\}$\u3002\n\n\u90a3\u4e48\u5148\u628a\u6240\u6709\u8be2\u95ee\u6309\u7167 $\\max\\{r_{x_i},r_{y_i}\\}$ **\u4ece\u5927\u5230\u5c0f**\u6392\u5e8f\uff0c\u518d\u628a\u6240\u6709\u4eba\u6309\u7167 $r$ **\u4ece\u5927\u5230\u5c0f**\u6392\u5e8f\u3002\n\n\u4e0d\u59a8\u8bbe $a_{x_i}\\le a_{y_i}$\uff08\u76f8\u53cd\u5219\u4ea4\u6362\uff09\u3002\u8981\u6c42\u7684\u5c31\u662f\uff1a\n\n$$\\max\\limits_{a_{y_i}-k\\le a_j\\le a_{x_i}+k}\\text{size}_j$$\n\n\u7528**\u6743\u503c\u7ebf\u6bb5\u6811**\u7ef4\u62a4\u5373\u53ef\u3002\u4e24\u4e2a\u6743\u503c\u6570\u636e\u7ed3\u6784\u90fd\u9700\u8981\u5148**\u79bb\u6563\u5316**\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u5c31**\u52a8\u6001\u5f00\u70b9**\u5427\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}((n+q)\\log n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n+q)$\u3002\n\n# $\\texttt{Code}$\n\n**[Submission](https://codeforces.com/contest/173/submission/198080570 \"Submission\")**\n\n\n```cpp\n#pragma GCC optimize(\"Ofast,no-stack-protector,unroll-loops,fast-math\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4.1,sse4.2,avx,avx2,popcnt,tune=native\")\n#include<bits/stdc++.h>\n#define N 300005\n#define ls x<<1\n#define rs x<<1|1\nusing namespace std;\nint n,k,Q,ta,tr,ans[N],sum[N],mx[N<<2],val[N],hs[N];\nset<int>sa,sr;\nmap<int,int>mpa,mpr; \nstruct person{\n    int r,a,id;\n}p[N];\nstruct question{\n    int x,y,id;\n}q[N];\nvoid add(int x,int v){\n    for(int i=x;i<=tr;i+=i&(-i)){\n        sum[i]+=v;\n    }\n}\nint qsum(int x){\n    int ret=0;\n    for(int i=x;i;i-=i&(-i)){\n        ret+=sum[i];\n    }\n    return ret;\n}\nvoid modify(int x,int l,int r,int u,int v){\n    if(l^r){\n        int m=(l+r)>>1;\n        if(u<=m){\n            modify(ls,l,m,u,v);\n        }else{\n            modify(rs,m+1,r,u,v);\n        }\n        mx[x]=max(mx[ls],mx[rs]);\n    }else{\n        mx[x]=max(mx[x],v);\n    }\n}\nint qmax(int x,int l,int r,int ql,int qr){\n    if(ql<=l&&r<=qr){\n        return mx[x];\n    }\n    int m=(l+r)>>1,ret=-1;\n    if(ql<=m){\n        ret=max(ret,qmax(ls,l,m,ql,qr));\n    }\n    if(qr>m){\n        ret=max(ret,qmax(rs,m+1,r,ql,qr));\n    }\n    return ret;\n}\nint main(){\n    memset(mx,-1,sizeof mx);\n    scanf(\"%d%d\",&n,&k);\n    for(int i=1;i<=n;++i){\n        scanf(\"%d\",&p[i].r);\n        sr.insert(p[i].r);\n        p[i].id=i;\n    }\n    for(int i:sr){\n        mpr[i]=++tr;\n    }\n    for(int i=1;i<=n;++i){\n        scanf(\"%d\",&p[i].a);\n        sa.insert(p[i].a);\n        sa.insert(p[i].a-k);\n        sa.insert(p[i].a+k);\n    }\n    for(int i:sa){\n        mpa[i]=++ta;\n    }\n    scanf(\"%d\",&Q);\n    for(int i=1;i<=Q;++i){\n        scanf(\"%d%d\",&q[i].x,&q[i].y);\n        q[i].id=i;\n    }\n    sort(p+1,p+1+n,[](person i,person j){return i.a<j.a;});\n    for(int i=1,l=0,r=0;i<=n;++i){\n        for(;r<n&&p[r+1].a-p[i].a<=k;++r){\n            add(mpr[p[r+1].r],1);\n        }\n        for(;l<r&&p[i].a-p[l+1].a>k;++l){\n            add(mpr[p[l+1].r],-1);\n        }\n        val[p[i].id]=qsum(mpr[p[i].r]);\n    }\n    sort(p+1,p+1+n,[](person i,person j){return i.r>j.r;});\n    for(int i=1;i<=n;++i){\n        hs[p[i].id]=i;\n    }\n    sort(q+1,q+1+Q,[](question i,question j){return max(p[hs[i.x]].r,p[hs[i.y]].r)>max(p[hs[j.x]].r,p[hs[j.y]].r);});\n    for(int i=1,j=0,x,y;i<=Q;++i){\n        for(;j<n&&p[j+1].r>=max(p[hs[q[i].x]].r,p[hs[q[i].y]].r);++j){\n            modify(1,1,ta,mpa[p[j+1].a],val[p[j+1].id]);\n        }\n        x=min(p[hs[q[i].x]].a,p[hs[q[i].y]].a);\n        y=max(p[hs[q[i].x]].a,p[hs[q[i].y]].a);\n        if(y-k>x+k){\n            ans[q[i].id]=-1;\n            continue;\n        }\n        ans[q[i].id]=qmax(1,1,ta,mpa[y-k],mpa[x+k]);\n    }\n    for(int i=1;i<=Q;++i){\n        printf(\"%d\\n\",ans[i]);\n    }\n}\n```",
        "postTime": 1679227011,
        "uid": 539211,
        "name": "\u849f\u84bb\u00b7\u5ed6\u5b50\u9633",
        "ccfLevel": 5,
        "title": "CF173E Camping Groups"
    },
    {
        "content": "**\u80fd\u79bb\u7ebf\u5c31\u4e0d\u8981\u60f3\u9a9a\u64cd\u4f5c**\n\n**\u80fd\u79bb\u7ebf\u5c31\u4e0d\u8981\u60f3\u9a9a\u64cd\u4f5c**\n\n**\u80fd\u79bb\u7ebf\u5c31\u4e0d\u8981\u60f3\u9a9a\u64cd\u4f5c**\n\n\u8003\u8651\u7ed9\u5b9a\u4e24\u4e2a\u4eba$x$,$y$\u6c42\u80fd\u5305\u542b\u4ed6\u4eec\u7684\u5c0f\u7ec4\u80fd\u5bb9\u7eb3\u7684\u6700\u5927\u4eba\u6570\n\n\u663e\u7136\u6709\u4e00\u4e2a\u524d\u63d0\uff1a\n\n**\u5c0f\u7ec4\u7684\u7ec4\u957f\u7684\u5730\u4f4d\u4e00\u5b9a\u5927\u4e8e\u7b49\u4e8e$max(R[x],R[y])$**\n\n\u8fd9\u542f\u53d1\u6211\u4eec**\u79bb\u7ebf\u6240\u6709\u8be2\u95ee\u5e76\u6309\u7167$max(R_{xi},R_{yi})$\u964d\u5e8f\u6392\u5e8f**\n\n\u7136\u540e\u6bcf\u6b21\u8be2\u95ee\u4e4b\u524d\uff0c\u628a\u5f53\u524d\u5730\u4f4d**\u5927\u4e8e\u7b49\u4e8e**$max(R_{xi},R_{yi})$\u7684\u4eba\u7ed9\u585e\u5230\u51b3\u7b56\u96c6\u5408\u91cc\uff0c\u7136\u540e\u4ece\u51b3\u7b56\u96c6\u5408\u91cc\u9762\u6311\u4e00\u4e2a\u7ec4\u957f\n\n\u51b3\u7b56\u96c6\u5408\u4e2d\u54ea\u4e00\u90e8\u5206\u4eba\u53ef\u80fd\u6210\u4e3a\u7ec4\u957f\u5462\uff1f\u663e\u800c\u6613\u89c1\uff0c\u9700\u8981\u5e74\u9f84\u5408\u9002\n\n\u8fd9\u4e2a\u5f88\u597d\u63a8\uff0c\u624b\u52a8\u4e00\u63a8\u53d1\u73b0\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u533a\u95f4\uff08\u6309\u5e74\u9f84\u6392\u5e8f\u540e\uff09\n\n\u4e8e\u662f\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u6bcf\u6b21\u7ed9\u4e00\u4e2a\u533a\u95f4\uff0c\u6c42\u533a\u95f4\u6700\u4f18\u503c\n\n\u60f3\u5230\u4e86\u5565\uff1f\u7ebf\u6bb5\u6811\u5457\n\n\u7b49\u7b49\uff0c\u6211\u4eec\u600e\u4e48\u77e5\u9053\u6bcf\u4e2a\u4eba\u6210\u4e3a\u7ec4\u957f\u6700\u591a\u80fd\u9009\u591a\u5c11\u4eba\uff1f\n\nemmm......\n\n\u79bb\u6563\u5316\u4e00\u6ce2\u7528\u6811\u72b6\u6570\u7ec4\u9884\u5904\u7406\u5c31\u597d\u4e86\u5457\n\n\u5177\u4f53\u89c1\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define ri register\n#define il inline\n#define big long long\n#define lowbit(x) x&(-x)\nusing namespace std;\nconst int maxn=1e6+5;\nint N,K,Q,n;\nint R[maxn],A[maxn],Ord[maxn],B[maxn<<2],C[maxn],cnt[maxn],MAX[maxn<<4],ans[maxn];\nstruct node{\n\tint x,y,c,id;\n\tnode(int xx=0,int yy=0,int iid=0){\n\t\tx=xx,y=yy,id=iid;\n\t\tc=max(R[xx],R[yy]);\n\t}\n\tfriend bool operator <(node a,node b){\n\t\treturn a.c>b.c;\n\t}\n}query[maxn];\nil bool cmp1(int a,int b){\n\treturn R[a]<R[b]||(R[a]==R[b]&&A[a]<A[b]);\n}\nil void Add(int x,int k){\n\twhile(x<=n){\n\t\tC[x]+=k;\n\t\tx+=lowbit(x);\n\t}\n}\nil int Sum(int x){\n\tint ans=0;\n\twhile(x){\n\t\tans+=C[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn ans;\n}\nil int Hash(int x){\n\treturn lower_bound(B+1,B+n+1,x)-B;\n}\nvoid Change(int x,int l,int r,int id,int k){\n\tif(l==r){\n\t\tMAX[id]=max(MAX[id],k);\n\t\treturn;\n\t}\n\tint m=(l+r)>>1;\n\tif(x<=m)\n\t\tChange(x,l,m,id<<1,k);\n\telse\n\t\tChange(x,m+1,r,id<<1|1,k);\n\tMAX[id]=max(MAX[id<<1],MAX[id<<1|1]); \n}\nint Query(int x,int y,int l,int r,int id){\n\tif(x<=l&&r<=y)\n\t\treturn MAX[id];\n\tint m=(l+r)>>1;\n\tif(x<=m&&y>m)\n\t\treturn max(Query(x,y,l,m,id<<1),Query(x,y,m+1,r,id<<1|1));\n\telse if(x<=m)\n\t\treturn Query(x,y,l,m,id<<1);\n\telse\n\t\treturn Query(x,y,m+1,r,id<<1|1);\n}\nint main(){\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tios::sync_with_stdio(false);\n\tcin>>N>>K;\n\tfor(ri int i=1;i<=N;++i)\n\t\tcin>>R[i];\n\tfor(ri int i=1;i<=N;++i){\n\t\tcin>>A[i];\n\t\tB[++n]=A[i];//\u8fd9\u56db\u4e2a\u4f4d\u7f6e\u90fd\u53ef\u80fd\u51fa\u73b0\n\t\tB[++n]=A[i]+K;//\u4fdd\u9669\u8d77\u89c1\u90fd\u5f97\u79bb\u6563\u5316\n\t\tB[++n]=A[i]-K-1;\n\t\tB[++n]=A[i]-K;\n\t}\n\tsort(B+1,B+n+1);\n\tn=unique(B+1,B+n+1)-B-1;\n\tfor(ri int i=1;i<=N;++i)\n\t\tOrd[i]=i;\n\tsort(Ord+1,Ord+N+1,cmp1);//\u5c06\u4eba\u6309\u5730\u4f4d\u5347\u5e8f\u6392\u5e8f\n\tfor(ri int i=1;i<=N;){\n\t\tint j=i;\n\t\twhile(R[Ord[j+1]]==R[Ord[i]])//\u5730\u4f4d\u4e00\u6837\u7684\u4eba\u90fd\u6709\u53ef\u80fd\u6210\u4e3a\u5f53\u524d\u9636\u6bb5\u7ec4\u957f\n\t\t\t++j;//\u6240\u4ee5\u90fd\u8981\u8003\u8651\n\t\tfor(ri int k=i;k<=j;++k)\n\t\t\tAdd(Hash(A[Ord[k]]),1);\n\t\tfor(ri int k=i;k<=j;++k){\n\t\t\tint l=Hash(A[Ord[k]]-K-1);\n\t\t\tint r=Hash(A[Ord[k]]+K);\n\t\t\tcnt[Ord[k]]=Sum(r)-Sum(l);//\u6c42\u51faOrd[k]\u5f53\u7ec4\u957f\u65f6\u5c0f\u7ec4\u6700\u591a\u4eba\u6570\n\t\t}\n\t\ti=j+1;\n\t}\n\tcin>>Q;\n\tfor(ri int i=1;i<=Q;++i){\n\t\tint x,y;\n\t\tcin>>x>>y;\n\t\tquery[i]=node(x,y,i);\n\t}\n\tsort(query+1,query+Q+1);//\u79bb\u7ebf\u8be2\u95ee\n\tint cur=N;//\u5012\u7740\u5f80\u51b3\u7b56\u96c6\u5408\u91cc\u585e\u4eba\n\tfor(ri int i=1;i<=Q;i++){\n\t\twhile(cur&&R[Ord[cur]]>=query[i].c){\n\t\t\tChange(Hash(A[Ord[cur]]),1,n,1,cnt[Ord[cur]]);\n\t\t\t--cur;\n\t\t}\n\t\tint x=query[i].x,y=query[i].y;\n\t\tif(A[x]>A[y])\n\t\t\tswap(x,y);\n\t\tint l=max(Hash(A[x]-K),Hash(A[y]-K));\n\t\tint r=min(Hash(A[x]+K),Hash(A[y]+K));\n\t\tif(l>r)//\u6ca1\u6709\u4eba\u5e74\u9f84\u5408\u9002\n\t\t\tans[query[i].id]=-1;\n\t\telse{\n\t\t\tint ass=Query(l,r,1,n,1);//\u6211\u4e0d\u60f3\u91cd\u540d.....\n\t\t\tif(!ass)//\u8bf7\u4e0d\u8981\u5410\u69fd\u53d8\u91cf\u540d\n\t\t\t\tans[query[i].id]=-1;//\u53cd\u6b63\u53d1\u97f3\u4e00\u6837\u7684\n\t\t\telse\n\t\t\t\tans[query[i].id]=ass;\n\t\t}\n\t}\n\tfor(ri int i=1;i<=Q;i++)\n\t\tprintf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1568194298,
        "uid": 109396,
        "name": "Uniecho1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF173E \u3010Camping Groups\u3011"
    },
    {
        "content": "\u72ec\u7acb\u60f3+\u5199\u51fa\u6765\u4e86\uff0c\u7eaa\u5ff5\u4e00\u4e0b\u3002\n\n### \u601d\u8def\uff1a\n\u79bb\u7ebf\u7ebf\u6bb5\u6811\u505a\u6cd5\u3002\n\n\u6ce8\u610f\u5230\uff0c\u5982\u679c $i$ \u6210\u4e3a\u4e86\u961f\u957f\uff0c\u4ed6\u7684\u961f\u4f0d\u91cc\u5fc5\u7136\u5305\u542b\u4e86\u6240\u6709 $r\\leq r_i$ \u4e14\u5e74\u9f84\u5dee\u5c0f\u4e8e $k$ \u7684\u4eba\uff0c\u56e0\u4e3a\u961f\u5458\u4e4b\u95f4\u662f\u6ca1\u6709\u9650\u5236\u7684\u3002\n\n\u9996\u5148\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u7ec4 $x$\uff0c$y$ \u7684\u8be2\u95ee\uff0c\u5bf9\u4e8e\u4efb\u610f $i$ \u6ee1\u8db3 $r_i\\geq\\max(r_x,r_y)$ \u4e14 $a_i$ \u5728 $[a_x-k,a_x+k]$ \u4ea4 $[a_y-k,a_y+k]$ \uff0c$i$ \u5c31\u53ef\u80fd\u6210\u4e3a\u961f\u957f\uff0c\u5f88\u663e\u7136\uff0c$i$ \u4f5c\u4e3a\u961f\u957f\u7684\u961f\u4f0d\u4e2d\u5fc5\u7136\u5305\u542b\u4e86 $x$ \u548c $y$\u3002\n\n\u53ef\u4ee5\u8003\u8651\u6c42\u5f97\u4efb\u610f $i$ \u4f5c\u4e3a\u961f\u957f\u65f6\u961f\u4f0d\u4e2d\u7684\u4eba\u6570\uff0c\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7ecf\u5178\u7684\u4e8c\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u6309 $r$ \u6392\u5e8f\u540e\uff0c\u52a8\u6001\u5f00\u70b9\u503c\u57df\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\uff0c\u8bb0\u4e3a $p_i$\u3002\n\n```cpp\nsort(a+1,a+1+n,cmp);\nfor(int i=1;i<=n;i++)\n{\n\tadd(root,1,2e9+10,a[i].age,1);\n    if(i!=1&&a[i].res!=a[i-1].res)\n    {\n    \tadd(root,1,2e9+10,a[i].age,-1);\n        while(lst<=i-1)\n        {\n        \tp[lst]=sum(root,1,2e9+10,a[lst].age-k,a[lst].age+k);\n            lst++;\n\t\t}\n        add(root,1,2e9+10,a[i].age,1);\n    }\n}\nwhile(lst<=n)\n{\n\tp[lst]=sum(root,1,2e9+10,a[lst].age-k,a[lst].age+k);\n    lst++;\n}\n```\n\n\u968f\u540e\u95ee\u9898\u8f6c\u5316\u5c31\u4e3a\u4e86\uff0c\u5c31\u662f\u7ed9\u5b9a\u4e86 $n$ \u4e2a\u4e09\u5143\u7ec4\uff0c\u5f62\u5982 $(r,a,p)$\uff0c\u6c42\u6240\u6709\u6ee1\u8db3 $r\\geq k$ \u4e14 $a$ \u5c5e\u4e8e $[l,r]$ \u7684\u4e09\u5143\u7ec4\u7684 $p$ \u7684\u6700\u5927\u503c\uff0c\u5176\u4e2d\u7684 $k$\uff0c$l$\uff0c$r$ \u90fd\u662f\u4e0e\u8be2\u95ee\u7684 $x$\uff0c$y$ \u6709\u5173\u7684\uff0c\u4e0d\u591a\u8d58\u8ff0\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u663e\u7136\u53ef\u4ee5\u6309 $k$ \u6392\u5e8f\uff0c\u7531\u4e8e\u4e09\u5143\u7ec4\u5df2\u7ecf\u6309 $r$ \u6392\u5e8f\uff0c\u90a3\u4e48\u5c31\u6d88\u9664\u4e86\u7b2c\u4e00\u4e2a\u9650\u5236\uff0c\u8003\u8651\u5728 $a$ \u5904\u63d2\u5165\u4e00\u4e2a $p$ \u7136\u540e\u53d6 $\\max$\uff0c\u52a8\u6001\u5f00\u70b9\u503c\u57df\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002\n\n```cpp\nfor(int i=1;i<=n;i++) \n{\n    now[a[i].id]=i;\n}\nint q;cin>>q;\nfor(int i=1;i<=q;i++)\n{\n    int x,y;cin>>x>>y;\n    x=now[x],y=now[y];\n    Q[i]=(node1){x,y,max(a[x].res,a[y].res),i};\n}\nsort(Q+1,Q+1+q,cmp1);\nint j=n;tot=0,root=0;\nmemset(t,0,sizeof(t));\nfor(int i=1;i<=q;i++)\n{\n    while(a[j].res>=Q[i].p&&j>0)\n    {\n        add1(root,1,2e9+10,a[j].age,p[j]);\n        j--;\n    }\n    int x=Q[i].x,y=Q[i].y;\n    int ans=-1;\n    if(abs(a[x].age-a[y].age)<=k)\n    {\n        if(a[x].res==a[y].res)\n        {\n            ans=max(p[x],p[y]);\n        }\n        else if(a[x].res>a[y].res) ans=p[x];\n        else ans=p[y];\n    }\n    int mi=min(a[x].age,a[y].age),mx=max(a[x].age,a[y].age);\n    in now=get((in){max(0ll,mi-k),mi+k},(in){max(0ll,mx-k),mx+k});\n    if(now.l!=-1)\n    {\n        ans=max(ans,query(root,1,2e9+10,now.l,now.r));\n    }\n    re[Q[i].id]=ans;\n}\n```\n\n### \u4ee3\u7801\uff1a[link](https://codeforces.com/contest/173/submission/160087894)\n\n",
        "postTime": 1654920476,
        "uid": 413777,
        "name": "npqenqpve",
        "ccfLevel": 0,
        "title": "CF173E"
    },
    {
        "content": "\u540c\u5b66\u63a8\u8350\u6765\u7684\u3002\n\n\u597d\u9898\u3002\n\n## \u601d\u8def\n\n\u5bb9\u6613\u53d1\u73b0\u8fd9\u9053\u9898\u53ef\u4ee5\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff1a\n\n1. \u7b97\u51fa\u4ee5\u6bcf\u4e2a\u4eba\u4e3a\u961f\u957f\uff0c\u6700\u591a\u6709\u591a\u5c11\u4eba\u3002\u4e0d\u59a8\u5bf9\u7b2c $i$ \u4e2a\u4eba\uff0c\u6211\u4eec\u8bb0\u4e3a $ans_i$\u3002\n\n2. \u7b97\u51fa\u5bf9\u4e8e\u6240\u6709\u7684 $x,y$\uff0c\u80fd\u591f\u5f53\u5b83\u4eec\u961f\u957f\u7684\u4eba\u4e2d\uff0c$ans_i$ \u6700\u5927\u662f\u591a\u5c11\u3002\n\n### 1.1 \u7b2c\u4e00\u6b65\n\n\u5bb9\u6613\u53d1\u73b0\u4e00\u4e2a\u4eba $x$ \u5982\u679c\u80fd\u591f\u5305\u542b\u53e6\u4e00\u4e2a\u4eba $y$\uff0c\u5219\u6709 $r_x \\geq r_y$ \u4e14 $a_x-k \\leq a_y \\leq a_x+k$\u3002\n\n\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u533a\u95f4\u4e8c\u7ef4\u504f\u5e8f\u6a21\u578b\uff0c\u6211\u4eec\u6309\u7167 $r$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u6bcf\u6b21\u628a $a_i$ \u63d2\u5165\u503c\u57df\u7ebf\u6bb5\u6811\u5373\u53ef\u3002\n\n\u7531\u4e8e\u6211\u6bd4\u8f83\u61d2\u6240\u4ee5\u6ca1\u6709\u79bb\u6563\u5316\uff0c\u56e0\u6b64\u65f6\u7a7a\u5747\u4e3a $O(n \\log n)$\u3002\n\n- \u7279\u522b\u6ce8\u610f\u4e00\u70b9\uff0c\u5982\u679c\u6709\u591a\u4e2a $r$ \u76f8\u540c\u7684\uff0c\u5e94\u8be5\u7edf\u4e00\u52a0\u5165\u518d\u7edf\u4e00\u67e5\u8be2\uff0c\u56e0\u4e3a\u76f8\u7b49\u7684\u65f6\u5019\u53ef\u4ee5\u4e92\u76f8\u5305\u542b\u3002\n\n### 1.2 \u7b2c\u4e8c\u6b65\n\n\u9996\u5148\u80fd\u5f53 $x,y$ \u7684\u961f\u957f\u7684\u4eba $i$ \u4e00\u5b9a\u6ee1\u8db3 $r$ \u7684\u6761\u4ef6\uff1a\n\n$$r_i \\geq \\max\\{r_x,r_y\\}$$\n\n\u540c\u65f6\u4e5f\u8981\u6ee1\u8db3\u5e74\u9f84\u6761\u4ef6\uff1a\n\n$$a_x-k \\leq a_i \\leq a_x+k \\land a_y-k \\leq a_i \\leq a_y+k$$\n\n\u5373\uff1a\n\n$$\\max\\{a_x-k,a_y-k\\} \\leq a_i \\leq \\min\\{a_x+k,a_y+k\\}$$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5728\u7ebf\u9700\u8981\u4e3b\u5e2d\u6811\u7ef4\u62a4\uff0c\u6bd4\u8f83\u96be\u5199\u3002\u4e8e\u662f\u8003\u8651\u79bb\u7ebf\u4e0b\u6765\uff0c\u4ee4\u6bcf\u4e2a\u8be2\u95ee $i$ \u7684 $R_i=\\max\\{r_x,r_y\\}$\uff0c$s_i=\\max\\{a_x-k,a_y-k\\}$\uff0c$t_i=\\min\\{a_x+k,a_y+k\\}$\u3002\n\n\u7136\u540e\u79bb\u7ebf\u4e0b\u6765\uff0c\u95ee\u9898\u8f6c\u5316\u6210\u5bf9\u6bcf\u4e2a\u4e09\u5143\u7ec4 $R_i,s_i,t_i$\uff0c\u6240\u6709\u4e8c\u5143\u7ec4 $(r_j,a_j)$ \u4e2d\uff0c\u6ee1\u8db3 $r_j \\leq R_i \\land s_i \\leq a_j \\leq t_i$ \u8fd9\u4e2a\u6761\u4ef6\u7684 $j$ \u91cc\uff0c\u6700\u5927\u7684 $ans_j$\u3002\n\n\u53d1\u73b0\u53c8\u662f\u4e00\u4e2a\u533a\u95f4\u4e8c\u7ef4\u504f\u5e8f\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u662f\u4e24\u4e2a\u6570\u7ec4\u4e4b\u95f4\u7684\u3002\u6211\u4eec\u628a\u8be2\u95ee\u548c $a$ \u6570\u7ec4\u90fd\u6309\u7167 $R_i$ \u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u7136\u540e\u8fd9\u6b21\u662f\u5355\u70b9\u4fee\u6539\u533a\u95f4\u6c42 $\\max$\u3002\n\n\u4e8e\u662f\u518d\u6765\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u65f6\u7a7a\u4e5f\u662f $O(n \\log n)$\u3002\n\n### 1.3 \u6ce8\u610f\u4e8b\u9879\n\n- \u6570\u7ec4\u4e0d\u8981\u5f00\u592a\u5927\uff0c\u6211\u5f00\u4e86 40 \u500d\u5df2\u7ecf\u5f88\u6781\u9650\u4e86\u3002\n\n- \u6ce8\u610f\u4e00\u4e0b\u5e38\u6570\u4f18\u5316\u3002\u5efa\u8bae\u81f3\u5c11\u5173\u540c\u6b65 `cin/cout`\uff0c\u5e76\u4e14\u624b\u5199 `min` \u548c `max` \u51fd\u6570\u3002\n\n\t\u5426\u5219\u4f60\u5355 $\\log$ \u505a\u6cd5\uff0c$10^5$ \u4e5f\u53ef\u4ee5\u88ab\u5361\u5e38\u3002\u6211\u5728\u7b2c $47$ \u4e2a\u70b9 TLE \u4e86\u4e00\u6b21\u3002\n\n- \u6ce8\u610f\u7b2c\u4e8c\u6b65\u4e2d\uff0c\u5355\u70b9\u4fee\u6539\u662f\u5355\u70b9\u53d6 $\\max$ \u800c\u4e0d\u662f\u5355\u70b9\u4fee\u6539 / \u52a0\u3002\u5426\u5219\u4f60\u53ef\u80fd\u4f1a\u5728\u7b2c $10$ \u4e2a\u70b9 WA\uff08\u5355\u70b9\u52a0\uff09\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\ninline int qmax(const int &x,const int &y){return x>y?x:y;}\ninline int qmin(const int &x,const int &y){return x<y?x:y;}\n\nconst int MAXN=4000005;\n\nstruct Node{int r,x,id;}a[100005];\ninline bool cmp(Node x,Node y){ // \u6309\u7167 r \u6392\u5e8f\n\treturn x.r<y.r;\n}\ninline bool cmp2(Node x,Node y){ // \u6309\u7167\u8f93\u5165\u987a\u5e8f\u6392\u5e8f\uff08\u65b9\u4fbf\u5904\u7406\u8be2\u95ee\uff09\n\treturn x.id<y.id;\n}\n\nint tr[MAXN],ls[MAXN],rs[MAXN],tot,rt;\nvoid upd(int &p,int l,int r,int t,int k){ // \u7b2c\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u5355\u70b9\u52a0\u3001\u533a\u95f4\u548c\u3002\n\tif(!p) p=++tot;\n\tif(l==r) return tr[p]+=k,void();\n\tint mid=(l+r)>>1;\n\tif(t<=mid) upd(ls[p],l,mid,t,k);\n\telse upd(rs[p],mid+1,r,t,k);\n\ttr[p]=tr[ls[p]]+tr[rs[p]];\n}\nint query(int p,int l,int r,int st,int en){\n\tif(!p || l>en || r<st) return 0;\n\tif(st<=l && r<=en) return tr[p];\n\tint mid=(l+r)>>1;\n\treturn query(ls[p],l,mid,st,en)+query(rs[p],mid+1,r,st,en);\n}\n\nint ans[100005],res[100005]; // ans \u8bb0\u5f55\u6bcf\u4e2a\u4eba\u505a\u961f\u957f\u6700\u591a\u591a\u5c11\u4eba\uff0cres \u8bb0\u5f55\u6bcf\u4e2a\u8be2\u95ee\u7684\u7b54\u6848\n\nstruct Query{int r,x,y,id;}b[100005]; // \u8be2\u95ee\nbool cmp1(Query x,Query y){\n\treturn x.r>y.r; // \u6309 r \u6392\u5e8f\n}\n\nint t1[MAXN],l1[MAXN],r1[MAXN],cnt,rt1;\nvoid add(int &p,int l,int r,int t,int k){ // \u7b2c\u4e8c\u4e2a\u7ebf\u6bb5\u6811\uff0c\u5355\u70b9\u53d6 max\uff0c\u533a\u95f4\u67e5\u8be2 max\n\tif(!p) p=++cnt;\n\tif(l==r) return t1[p]=qmax(t1[p],k),void();\n\tint mid=(l+r)>>1;\n\tif(t<=mid) add(l1[p],l,mid,t,k);\n\telse add(r1[p],mid+1,r,t,k);\n\tt1[p]=qmax(t1[l1[p]],t1[r1[p]]);\n}\nint qry(int p,int l,int r,int st,int en){\n\tif(!p || l>en || r<st) return -1;\n\tif(st<=l && r<=en) return t1[p];\n\tint mid=(l+r)>>1;\n\treturn qmax(qry(l1[p],l,mid,st,en),qry(r1[p],mid+1,r,st,en));\n}\n\nsigned main(){\n\tios::sync_with_stdio(0);\n\tcin.tie(0),cout.tie(0);\n\tint n,K; cin>>n>>K;\n\tfor(int i=1;i<=n;i++) cin>>a[i].r;\n\tfor(int i=1;i<=n;i++) cin>>a[i].x,a[i].id=i;\n\t\n\tsort(a+1,a+1+n,cmp); // \u5148\u6309\u7167 r \u6392\u5e8f\n\t\n\tfor(int i=1;i<=n;){\n\t\tint j=i;\n\t\tdo{\n\t\t\tupd(rt,-1e18,1e18,a[j].x,1),j++;\n\t\t}while(j<=n && a[j].r==a[j-1].r); // \u8fd9\u91cc\u8981\u628a r \u76f8\u540c\u7684\u4e00\u8d77\u63d2\u5165\n\t\tfor(int k=i;k<j;k++) ans[a[k].id]=query(rt,-1e18,1e18,a[k].x-K,a[k].x+K); // \u518d\u628a r \u76f8\u540c\u7684\u4e00\u8d77\u67e5\u8be2\n\t\ti=j;\n\t}\n\t\n\tsort(a+1,a+1+n,cmp2); // \u6392\u56de\u539f\u6765\u7684\u987a\u5e8f\u65b9\u4fbf\u5904\u7406\u8be2\u95ee\n\t\n\tint q; cin>>q;\n\tfor(int i=1;i<=q;i++){\n\t\tint x,y; cin>>x>>y;\n\t\tint L=qmax(a[x].x-K,a[y].x-K); // \u8ba1\u7b97 s\n\t\tint R=qmin(a[x].x+K,a[y].x+K); // \u8ba1\u7b97 t\n\t\tb[i]=(Query){qmax(a[x].r,a[y].r),L,R,i}; // R[i] \u76f4\u63a5\u7528 max \u6c42\u4e86\u3002\u987a\u4fbf\u8bb0\u5f55\u4e00\u4e2a id \u65b9\u4fbf\u6309\u539f\u5e8f\u8f93\u51fa\u3002\n\t}\n\t\n\tsort(b+1,b+1+q,cmp1); // \u90fd\u6309 r \u6392\u5e8f\n\tsort(a+1,a+1+n,cmp);\n\t\n\tint j=n; \n\tfor(int i=1;i<=q;i++){\n\t\twhile(j && a[j].r>=b[i].r){ // \u8fd9\u91cc a \u7531\u4e8e\u662f r \u4ece\u5c0f\u5230\u5927\uff0c\u6240\u4ee5\u8981\u5012\u8fc7\u6765\n\t\t\tadd(rt1,-1e18,1e18,a[j].x,ans[a[j].id]); // \u63d2\u5165\n\t\t\tj--;\n\t\t}\n\t\tres[b[i].id]=qry(rt1,-1e18,1e18,b[i].x,b[i].y); // \u7b97\u7b54\u6848\n\t}\n\t\n\tfor(int i=1;i<=q;i++) cout<<res[i]<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1666792787,
        "uid": 195198,
        "name": "E1_de5truct0r",
        "ccfLevel": 7,
        "title": "CF173E"
    }
]