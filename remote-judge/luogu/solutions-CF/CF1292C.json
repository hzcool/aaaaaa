[
    {
        "content": "**UPD:** \u4fee\u4e86\u9898\u89e3\u754c\u9762 $\\LaTeX$ \u4e0d\u517c\u5bb9\u7684\u9505\u3002\n\n**UPD2:** \u611f\u8c22 @[\u4e00\u6276\u82cf\u4e00](https://www.luogu.com.cn/user/65363)\uff0c\u4fee\u4e86\u4e00\u4e2a\u8868\u8ff0\u4e0d\u4e25\u8c28\u7684\u9505\u3002\n\n---\n\n\u89c2\u5bdf\u4e00\u4e0b\u7b54\u6848\u5f0f\u5b50\uff1a\n\n$$ \\large \\begin{array}{rl} S = & \\!\\! \\sum\\limits_{1\\le u<v \\le n} \\operatorname{mex}(u, v) \\\\ = & \\!\\! \\sum\\limits_{x = 1}^{n} \\left( \\sum\\limits_{\\operatorname{mex}(u, v) = x} x \\right) \\cdots\\cdots(1)\\\\ = & \\!\\! \\sum\\limits_{x = 1}^{n} \\left( \\sum\\limits_{\\operatorname{mex}(u, v) \\ge x} 1 \\right)\\cdots\\cdots(2)\\end{array}$$\n\n$(1) \\Rightarrow (2)$ \u662f\u600e\u4e48\u63a8\u7684\u5462\uff1f\n\n\u8003\u8651\u4e00\u4e2a $\\operatorname{mex}(u, v)$\uff0c\u6bd4\u5982\u5b83\u7b49\u4e8e $y$\uff0c\u539f\u672c\u5b83\u5bf9\u7b54\u6848\u53ea\u4ea7\u751f\u4e00\u6b21\u4e3a $y$ \u7684\u8d21\u732e\uff1b\u73b0\u5728\uff0c\u5b83\u5bf9\u4e8e $\\forall 1\\le x\\le y$ \u90fd\u4f1a\u4ea7\u751f $1$ \u7684\u8d21\u732e\uff0c\u6b63\u597d\u548c\u8fd8\u662f $y$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570 $\\operatorname{F}()$\uff0c$\\operatorname{F}(x) = \\sum_{1 \\le u < v \\le n}[\\operatorname{mex}(u, v)  \\ge x]$\u3002\u90a3\u4e48\u7b54\u6848\u5f0f\u5b50\u53c8\u53ef\u4ee5\u5316\u4e3a\uff1a\n\n$$ \\large \\begin{array}{rl} S = & \\!\\! \\sum\\limits_{x = 1}^{n} \\left( \\sum\\limits_{\\operatorname{mex}(u, v) \\ge x} 1 \\right)\\cdots\\cdots(2) \\\\ = & \\!\\! \\sum\\limits_{x = 1}^{n} \\operatorname{F}(x) \\end{array} $$\n\n$\\operatorname{F}(x)$ \u8bf4\u901a\u4fd7\u4e00\u70b9\uff0c\u5c31\u662f $< \\! u \\to v \\! >$ \u81f3\u5c11\u5305\u542b\u4e86 $0 \\sim x - 1$ \u7684\u6240\u6709\u6570\u7684\u8def\u5f84\u6570\u91cf\u3002\n\n\u73b0\u5728\u6211\u4eec\u4ece $0$ \u5f00\u59cb\uff0c\u4f9d\u6b21\u653e\u6bcf\u4e00\u4e2a\u6570\u3002\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u8981\u653e $x$\uff0c$0 \\sim x - 1$ \u5df2\u7ecf\u653e\u597d\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u4e00\u5b9a\u4f1a\u628a $x$ \u548c\u5b83\u4eec\u653e\u5728\u540c\u4e00\u6761\u8def\u5f84\u4e0a\uff0c\u8981\u4e0d\u7136 $x$ \u653e\u4e86\u4ee5\u540e\u5bf9\u7b54\u6848\u6ca1\u6709\u5f71\u54cd\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u653e\u5728\u540c\u4e00\u6761\u8def\u5f84\u4e0a\u7684\u8bdd\uff0c\u8fd9\u91cc\u7684 $\\operatorname{mex}$ \u5c31\u8981\u53d8\u6210 $x+ 1$ \u4e86\uff1b\u5426\u5219 $0 \\sim x - 1$ \u5df2\u7ecf\u6709\u6570\u5b57\u7f3a\u5931\uff0c\u90a3\u5c31\u4fdd\u6301\u90a3\u4e2a\u7f3a\u5931\u7684\u6700\u5c0f\u6570\u5b57\u4e0d\u53d8\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u627e\u4e00\u4e2a $<\\!u \\to v\\!>$\uff0c\u5b83\u7684\u957f\u5ea6\u4e3a $l$\uff0c\u6211\u4eec\u8981\u628a $0 \\sim l - 1$ \u90fd\u653e\u5728\u8fd9\u4e00\u6761\u8def\u4e0a\u3002$l \\sim n - 2$ \u653e\u7684\u4f4d\u7f6e\u6211\u4eec\u4e0d\u7ba1\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u4f1a\u4f7f\u5f97\u7b54\u6848\u53d8\u52a3\uff0c\u66f4\u4f18\u7684\u65b9\u6cd5\u5728\u540e\u9762\u4e5f\u4e00\u5b9a\u80fd\u679a\u4e3e\u5230\u3002\n\n\u60f3\u4e00\u60f3\uff0c\u4e00\u4e2a\u6700\u4f73\u7684\u65b9\u6848\u4e00\u5b9a\u4e0d\u4ec5\u662f\u5b8c\u6574\u7684\u4e00\u6bb5\uff0c\u800c\u4e14\u5b83\u7684\u4e00\u90e8\u5206\u4e5f\u8981\u662f\u5b8c\u6574\u7684\u3002\n\n\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u9009\u4e86 $<\\!u \\to v\\!>$\uff1a\n\n![image.png](https://i.loli.net/2020/01/21/Ygt7zOCuJNPwH1q.png)\n\n\u7136\u540e $0$ \u6211\u4eec\u968f\u4fbf\u653e\u4e00\u4e0b\uff1a\n\n![image.png](https://i.loli.net/2020/01/21/kyvAagU46938oQx.png)\n\n\u4e0b\u9762\u6211\u4eec\u8981\u653e $1$\uff0c\u4e3a\u4e86\u5229\u76ca\u6700\u5927\u5316\uff0c\u663e\u7136\uff0c$1$ \u548c $0$ \u8981\u5728\u4e00\u8d77\uff08\u8fd9\u6837\u6211\u4eec\u5728\u6784\u9020 $0 \\sim l - 1$ \u7684\u540c\u65f6\u4e5f\u987a\u4fbf\u6784\u9020\u4e86\u4e00\u4e2a $0 \\sim 1$ \u7684\u8def\u5f84\uff09\u3002\n\n\u6bd4\u5982 $1$ \u653e\u5728\u5de6\u8fb9\uff1a\n\n![image.png](https://i.loli.net/2020/01/21/4f7yTXrL2JlWgP9.png)\n\n\u7136\u540e\u6211\u4eec\u653e $2$\uff0c\u8fd9\u65f6\u6211\u4eec\u4e0d\u7ba1\u653e\u5728 $1$ \u7684\u5de6\u8fb9\u8fd8\u662f $0$ \u7684\u53f3\u8fb9\uff0c\u90fd\u53ef\u4ee5\u987a\u4fbf\u6784\u6210 $0 \\sim 2$ \u7684\u8def\u5f84\u3002\n\n\u4f9d\u6b21\u7c7b\u63a8\u653e\u5b8c\uff1a\n\n![image.png](https://i.loli.net/2020/01/21/BJ3A6wGnbI51LuV.png)\n\n\u53d1\u73b0\u4e86\u4ec0\u4e48\uff1f\u4ece $u$ \u5230 $v$ \u4f9d\u6b21\u5199\u4e0b\u6765\uff0c\u6b63\u597d\u662f\u4e00\u4e2a **\u5355\u8c37\u5e8f\u5217**\uff0c\u4e5f\u5c31\u662f\u6bd4\u5982\u628a\u8fd9\u4e2a\u5e8f\u5217\u53eb\u505a $a$\uff0c\u5219\u6709\u4e00\u4e2a\u4f4d\u7f6e $p$\uff0c\u4f7f\u5f97 $a_1 > a_2 > \\cdots > a_p < \\cdots < a_{l-1} <a_l$\u3002\n\n* \u7528 $dp(u, v)$ \u8868\u793a\u628a $0 \\sim l - 1$ \u653e\u5728 $<\\!u \\to v\\!>$ \u4e0a\uff0c$\\sum_{i =1}^{l} \\operatorname{F}(i)$ \u7684\u6700\u5927\u53ef\u80fd\u503c\uff1b\n* \u7528 $s_{root, u}$ \u8868\u793a\u4ee5 $root$ \u4e3a\u6839\u65f6\uff0c$u$ \u4e3a\u6839\u7684\u5b50\u6811\u5927\u5c0f\uff1b\n* \u7528 $p_{root, u}$ \u8868\u793a\u4ee5 $root$ \u4e3a\u6839\u65f6\uff0c$u$ \u7684\u7236\u4eb2\u3002\n\n\u73b0\u5728\u6211\u4eec\u8981\u8ba1\u7b97 $dp(u, v)$\uff0c\u6839\u636e\u5355\u8c37\u5e8f\u5217\u7684\u6027\u8d28\uff0c$l - 1$ \u8981\u4e48\u5728\u6700\u5de6\u8fb9\uff0c\u8981\u4e48\u5728\u6700\u53f3\u8fb9\uff0c\u90a3\u6211\u4eec\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\uff1a\n\n![image.png](https://i.loli.net/2020/01/21/8XOJD2TfW4zreK6.png)\n\n* \u5982\u679c $l - 1$ \u653e\u5728\u6700\u5de6\u8fb9\uff0c\u90a3\u4e48\u5269\u4e0b\u7684\u90e8\u5206\u5c31\u662f $dp(p_{v, u}, v)$ \u7684\u7b54\u6848\uff0c\u800c\u4eab\u53d7\u5230 $0 \\sim l - 1$ \u7684\u8def\u5f84\u7684\u4e2a\u6570\u5c31\u662f $\\operatorname{F}(l) = s_{u, v} \\times s_{v,u}$\uff0c\u6240\u4ee5 $dp(u, v) = dp(p_{v, u}, v) + s_{u, v} \\times s_{v,u}$\uff1b\n* \u5982\u679c $l - 1$ \u653e\u5728\u6700\u53f3\u8fb9\uff0c\u90a3\u4e48\u5269\u4e0b\u7684\u90e8\u5206\u5c31\u662f $dp(u, p_{u, v})$ \u7684\u7b54\u6848\uff0c\u800c\u4eab\u53d7\u5230 $0 \\sim l - 1$ \u7684\u8def\u5f84\u7684\u4e2a\u6570\u4f9d\u7136\u662f $\\operatorname{F}(l) = s_{u, v} \\times s_{v,u}$\uff0c\u6240\u4ee5 $dp(u, v) = dp(u, p_{u, v}) + s_{u, v} \\times s_{v,u}$\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff1a\n\n$$ \\large dp(u, v) = \\max(dp(u, p_{u, v}), dp(p_{v, u}, v)) + s_{u, v} \\times s_{v,u} $$\n\n\u6211\u4eec\u53ef\u4ee5\u8bb0\u5fc6\u5316\u641c\u7d22\uff0c$dp(u, v)$ \u5c31\u53ef\u4ee5 $\\mathcal O(1)$ \u6c42\u4e86\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f\u679a\u4e3e $u, v$ \u7684 $\\mathcal O(n^2)$\u3002\u81f3\u4e8e $p_{root, u}$ \u548c $s_{root, u}$\uff0c\u53ef\u4ee5\u5728\u4e4b\u524d\u901a\u8fc7\u679a\u4e3e $root$\uff0c\u6bcf\u6b21 $\\mathcal O(n)$ \u9884\u5904\u7406\u51fa\u6765\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^2)$\u3002\n\n\u4ee3\u7801\u8d34\u51fa\uff0c\u4ec5\u4f9b\u53c2\u8003\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst int N = 3005;\nint n, rt, p[N][N], s[N][N];\nLL f[N][N], ans;\nvector<int> G[N];\nvoid build(int u)\n{\n\ts[rt][u] = 1;\n\tfor(int v : G[u]) if(v ^ p[rt][u])\n\t{\n\t\tp[rt][v] = u;\n\t\tbuild(v);\n\t\ts[rt][u] += s[rt][v];\n\t}\n}\nLL dp(int u, int v)\n{\n\tif(u == v) return 0;\n\tif(f[u][v]) return f[u][v];\n\treturn f[u][v] = max(dp(u, p[u][v]), dp(v, p[v][u])) + s[u][v] * s[v][u];\n}\nint main()\n{\n\tios::sync_with_stdio(false);\n\tcin >> n;\n\tfor(int i = 1; i < n; i++)\n\t{\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\tG[u].push_back(v);\n\t\tG[v].push_back(u);\n\t}\n\tfor(int i = 1; i <= n; i++) { rt = i; build(i); }\n\tfor(int u = 1; u <= n; u++) \n        for(int v = 1; v <= n; v++)\n            ans = max(ans, dp(u, v));\n\tcout << ans << endl;\n\treturn 0;\n}\n```\n\n---\n\u53c2\u8003\u6587\u732e\n* [Akikaze.Codeforces Round #614 Editorial.CodeForces](https://codeforces.com/blog/entry/73051)",
        "postTime": 1579599788,
        "uid": 51971,
        "name": "syksykCCC",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1292C \u3010Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n[\u9898\u76ee\u94fe\u63a5](https://codeforces.com/contest/1293/problem/E)\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u8bd5\u5c06 $[0,n-2]$ \u5185\u7684\u6bcf\u4e2a\u6574\u6570\u4e0d\u91cd\u4e0d\u6f0f\u586b\u5230\u6bcf\u6761\u8fb9\u4e0a\uff0c\u4f7f\u5f97 $\\sum\\limits_{1\\le u<v\\le n} \\text{mex}(u,v)$ \u6700\u5c0f\uff0c\u5176\u4e2d $\\text{mex}(u,v)$ \u8868\u793a\u4ece\u8282\u70b9 $u$ \u5230\u8282\u70b9 $v$ \u7ecf\u8fc7\u7684\u8fb9\u96c6\u5408 $A_{u,v}$ \u4e2d\u6700\u5c0f\u7684\u672a\u51fa\u73b0\u7684\u975e\u8d1f\u6574\u6570\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$2\\le n\\le 3000$\n\n### \u9898\u89e3\n\n\u8003\u8651\u6211\u4eec\u9009\u5b9a\u4e86\u4e00\u6761\u8fb9 $(u,v)$ \u662f 0\uff0c\u5220\u6389\u8fd9\u6761\u8fb9\u540e\u6811\u53d8\u6210\u4e24\u90e8\u5206\uff0c\u5219\u7b54\u6848\u52a0\u4e0a\u4e24\u90e8\u5206\u7684\u5927\u5c0f\u4e58\u79ef\u5bf9\u5427\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u9009\u5b9a\u4e00\u6761\u8fb9\u662f 1\uff0c\u7406\u6027\u5206\u6790\u4e00\u4e0b\u53ef\u4ee5\u53d1\u73b0\u5e94\u8be5\u653e\u5728 $u$ \u6216 $v$ \u7684\u90bb\u8fb9\u4e0a\uff0c\u4e0d\u7136\u540c\u65f6\u7ecf\u8fc7 0,1 \u7684\u8def\u5f84\u80af\u5b9a\u4f1a\u5c11\uff0c\u5bf9\u7b54\u6848\u80fd\u8d21\u732e 2 \u7684\u8def\u5f84\u4e5f\u4f1a\u53d8\u5c11\uff0c\u5e76\u4e14\u63a5\u4e0b\u6765\u586b 2 \u80fd\u83b7\u5f97\u7684\u8d21\u732e\u4e5f\u4e0d\u4f1a\u591a ...\n\n\u5982\u56fe\uff0c\u603b\u4e4b\u6211\u4eec\u4e00\u5b9a\u4f1a\u5c06 0 \u586b\u5728 1 \u65c1\u8fb9\uff0c\u7136\u540e\u5c31\u4f1a\u5bf9\u7b54\u6848\u52a0\u4e0a $A\\times B$\uff0c\u8fd9\u6837\u7b97\u662f\u56e0\u4e3a\u7aef\u70b9\u5206\u522b\u5728 $A,B$ \u4e2d\u7684\u5df2\u7ecf\u88ab\u7b97\u8fc7\u4e00\u6b21\u8d21\u732e\u4e86\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/azfw2ee8.png)\n\n\u7136\u540e\u6211\u4eec\u4f1a\u7ee7\u7eed\u5c06 2 \u586b\u5728\u8fd9\u6761\u8def\u5f84\uff080,1\u6784\u6210\u7684\u8def\u5f84\uff09\u7684\u7aef\u70b9\uff0c\u4ee5\u6b64\u7c7b\u63a8 ... \u662f\u201c\u6cbf\u4e00\u6761\u8def\u5f84\u5411\u5916\u6269\u6563\u7684\u201d\u3002\n\n\u56e0\u6b64\u6211\u4eec\u5c31\u8f6c\u5316\u6210\u4e86\u4e2a\u8fd9\u6837\u7684\u95ee\u9898\uff1a\u9996\u5148\u5b9a\u4e49 $u$ \u5de6\u8fb9\u7684 $\\text{siz}$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\u7684\uff0c$v$ \u53f3\u8fb9\u7684 $\\text{siz}$ \u4e3a\u4ee5 $v$ \u4e3a\u6839\u7684\uff0c\u9009\u5b9a\u4e00\u6761\u8fb9 $(u,v)$\uff0c\u586b 0\uff0c\u5bf9\u7b54\u6848\u8d21\u732e $\\text{siz}_u\\times \\text{siz}_v$\uff0c\u7136\u540e\u6bcf\u6b21\u9009\u62e9 $u$ \u6216 $v$\uff0c\u6bd4\u5982 $u$\uff0c\u5c06\u5176\u8d70\u5230\u4efb\u610f\u4e00\u4e2a\u513f\u5b50\u4e0a\uff0c\u7136\u540e\u5bf9\u7b54\u6848\u8d21\u732e $\\text{siz}_u\\times \\text{siz}_v$\uff0c\u5982\u6b64\u4e00\u76f4\u64cd\u4f5c\u76f4\u5230\u4e0d\u80fd\u64cd\u4f5c\uff0c\u7b54\u6848\u7684\u6700\u5927\u503c\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6709\u4e86\u4e00\u4e2a $O(n^3)$ \u7684\u60f3\u6cd5\uff1a\u679a\u4e3e\u8fb9 $(u,v)$\uff0c\u8bbe $f_{i,j}$ \u4e3a $u$ \u64cd\u4f5c\u5230 $i$\uff0c$v$ \u64cd\u4f5c\u5230 $j$\uff0c\u7ee7\u7eed\u5411\u4e0b\u64cd\u4f5c\u80fd\u5f97\u5230\u7684\u6700\u5927\u6536\u76ca\uff0c\u53ef\u5f97\u5982\u4e0b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$ f_{i,j}=\\text{siz}_i\\times \\text{siz}_j+\\max\\{ \\max_{k\\in \\text{son}_i} f_{k,j}, \\max_{k\\in \\text{son}_j} f_{i,k} \\} $$\n\n\u90a3\u4e48\u6211\u4eec\u601d\u8003\u5982\u4f55\u5c06\u5176\u4f18\u5316\u6210 $O(n^2)$\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u679a\u4e3e 0 \u7684\u590d\u6742\u5ea6\u5e94\u8be5\u7701\u4e0d\u4e86\uff0c\u8003\u8651 dp \u7684\u590d\u6742\u5ea6\uff0c\u6bcf\u6b21 $O(n^2)$ dp \u786e\u5b9e\u5f88\u6162\uff0c\u8fd9\u662f\u56e0\u4e3a\u6362\u4e00\u6761\u8fb9\u540e\u70b9\u7684 $\\text{siz}$ \u4f1a\u53d8\u3002\n\n\u4f46\u5b9e\u9645\u4e0a\u5f88\u591a\u70b9\u7684 $\\text{siz}$ \u90fd\u6ca1\u53d8\uff01\u5982\u679c\u6211\u4eec\u4e00\u5f00\u59cb\u8ba9 $\\text{siz}$ \u5b9a\u4e49\u4e3a\u4ee5 1 \u4e3a\u6839\u7684\uff0c\u5f53\u6211\u4eec\u9009\u5b9a\u70b9 $(\\text{fa}_u,u)$ \u65f6\uff0c\u5728\u4e0b\u56fe\u4e2d\u53ea\u6709\u7ea2\u8272\u90e8\u5206\u7684 $\\text{siz}$ \u53d8\u4e86\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/17pyyuv9.png)\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u6df1\u641c\u5bfb\u627e\u7b54\u6848\uff0c\u641c\u5230 $u$ \u65f6\u5904\u7406 $(\\text{fa}_u,u)$ \u8fd9\u6761\u8fb9\u4e3a 0 \u7684\u7b54\u6848\uff0c\u6211\u4eec\u5c06 $\\text{fa}_u$ \u7684 $\\text{siz}$ \u53d8\u4e3a $N-\\text{siz}_u$\uff0c\u7136\u540e\u53ea\u66f4\u65b0 $\\forall i\\in T(u),f_{\\text{fa}_u,i}$\uff0c\u6700\u540e\u5c06 $f_{\\text{fa}_u,u}$ \u4f5c\u4e3a\u7b54\u6848\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\n\ntypedef long long ll;\nll read() {\n    ll ret = 0; char c = getchar();\n    while (c < '0' || c > '9') c = getchar();\n    while (c >= '0' && c <= '9') ret = ret * 10 + c - '0', c = getchar();\n    return ret;\n}\n\nconst int MAXN = 3005;\n\nint N;\nstruct node { int v, next; }  E[MAXN << 1]; int head[MAXN], Elen;\nvoid add(int u, int v) { ++Elen, E[Elen].v = v, E[Elen].next = head[u], head[u] = Elen; }\n\nll siz[MAXN], Siz[MAXN], Dp[MAXN][MAXN]; int fa[MAXN], dfn[MAXN], dfncnt, redfn[MAXN];\nvoid dfs(int u, int ff) {\n    siz[u] = 1, fa[u] = ff, dfn[u] = ++dfncnt, redfn[dfncnt] = u;\n    for (int i = head[u]; i; i = E[i].next) if (E[i].v != ff) dfs(E[i].v, u), siz[u] += siz[E[i].v];\n}\nll getdp(ll dp[][MAXN], int u, int v, int del = 0, int add = 0) {\n    if (dp[u][v]) return dp[u][v];\n    int i; ll ret = 0;\n    for (i = head[u]; i; i = E[i].next) if (E[i].v != fa[u] && E[i].v != del) ret = max(ret, getdp(dp, E[i].v, v, del, add));\n    if (add) ret = max(ret, getdp(dp, add, v, del, add));\n    for (i = head[v]; i; i = E[i].next) if (E[i].v != fa[v]) ret = max(ret, getdp(dp, u, E[i].v, del, add));\n    dp[u][v] = siz[u] * siz[v] + ret; return dp[u][v];\n}\n\nll f[MAXN][MAXN], ans;\nvoid dfs2(int u, int ff) {\n    int i;\n    if (u != 1) {\n        for (i = dfn[u]; i <= dfn[u] + siz[u] - 1; ++i) f[fa[u]][redfn[i]] = 0;\n        siz[fa[u]] = N - Siz[u];\n        for (i = dfn[u]; i <= dfn[u] + siz[u] - 1; ++i) getdp(f, fa[u], redfn[i], u, fa[fa[u]]);\n        ans = max(ans, f[fa[u]][u]);\n        for (i = head[u]; i; i = E[i].next) if (E[i].v != ff) dfs2(E[i].v, u);\n        for (i = dfn[u]; i <= dfn[u] + siz[u] - 1; ++i) f[fa[u]][redfn[i]] = Dp[fa[u]][redfn[i]];\n        siz[fa[u]] = Siz[fa[u]];\n    } else {\n        for (i = head[u]; i; i = E[i].next) if (E[i].v != ff) dfs2(E[i].v, u);\n    }\n}\n\nint main() {\n    scanf(\"%d\", &N); int i, j, u, v;\n    for (i = 1; i < N; ++i) scanf(\"%d%d\", &u, &v), add(u, v), add(v, u);\n    dfs(1, 0);\n    for (i = 1; i <= N; ++i) Siz[i] = siz[i];\n    for (i = 1; i <= N; ++i) for (j = 1; j <= N; ++j) f[i][j] = getdp(Dp, i, j);\n    dfs2(1, 0);\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1579494432,
        "uid": 62308,
        "name": "Mr_Wu",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1292C \u3010Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": " \u6211\u4eec\u5148\u968f\u4fbf\u627e\u4e00\u6761\u8fb9\uff0c\u5c06\u5b83\u7684\u4ef7\u503c\u8d4b\u503c\u62100\n\n\u90a3\u4e48\u53ea\u8981\u6709\u4e00\u4e2a\u8def\u5f84\u7ecf\u8fc7\u8fd9\u6761\u8fb9\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8def\u5f84\u7684\u6700\u5c0f\u4ef7\u503c\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u4e3a0\n\n\u6211\u4eec\u4e3e\u4e00\u4e2a\u4f8b\u5b50\n![](https://cdn.luogu.com.cn/upload/image_hosting/cdl1sbo4.png)\n \u6b64\u65f6u\u5230v\u7684\u4ef7\u503c\u4e3a0\uff0c\u90a3\u4e48\u8fd9\u4e00\u6761\u8def\u5f84\u4e0d\u7ecf\u8fc7\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u5c31\u662f1\n\n\u4e00\u6761\u8def\u5f84\u53ea\u8981\u7ecf\u8fc7(u,v)\u8fd9\u6761\u8fb9\uff0c\u90a3\u4e48\u5b83\u4eec\u4e0d\u7ecf\u8fc7\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u5c31\u81f3\u5c11\u4e3a1\uff08\u56e0\u4e3a\u5b83\u4eec\u5df2\u7ecf\u7ecf\u8fc7\u4e860\uff09\n\n\u6211\u4eec\u7528f[i][j]\u8868\u793a\u4ecei\u5f00\u59cb\uff0c\u4ecej\u7ed3\u675f\uff0c\u5c06i\u5230j\u4e4b\u95f4\u6240\u6709\u7684m\u6761\u8fb9\u8d4b\u503c\u62100\u5230m-1\u6240\u5f97\u5230\u7684\u6700\u5927\u4ef7\u503c\n\n\u7528g[i][j]\u8868\u793a\u5728i\u53f7\u8282\u70b9\u4f5c\u4e3a\u6839\u8282\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u4ee5j\u4e3a\u6839\u8282\u70b9\u7684\u5b50\u6811\u7684\u5927\u5c0f\n\n\u7528pa[i][j]\u8868\u793a\u5728i\u53f7\u8282\u70b9\u4f5c\u4e3a\u6839\u8282\u70b9\u7684\u60c5\u51b5\u4e0b\uff0cj\u8282\u70b9\u7684\u7236\u4eb2\u8282\u70b9\n!\n\n\u6211\u4eec\u518d\u6765\u770b\u4e0a\u9762\u8fd9\u5e45\u56fe\uff0c\u53ea\u8981\u7ecf\u8fc7\uff08u,v\uff09\u8fd9\u6761\u8fb9\uff0c\u90a3\u4e48\u5b83\u4eec\u6ca1\u6709\u7ecf\u8fc7\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u7684\u4ef7\u503c\u5c31\u81f3\u5c11\u4e3a1\n\n\u6b64\u65f6\u603b\u4ef7\u503c\u4e3ag[u][v]*g[v][u]\n\n\u90a3\u4e48\u6211\u4eec\u518d\u6dfb\u52a0\u4ef7\u503c\u4e3a1\u7684\u8fb9\uff0c\u4e3a\u4e86\u4f7f\u603b\u7684\u4ef7\u503c\u6700\u5927\uff0c\u8fd9\u6761\u8fb9\u663e\u7136\u8981\u548c\u4ef7\u503c\u4e3a0\u7684\u8fb9\u653e\u5728\u4e00\u8d77\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u5982\u679c\u653e\u5728\u522b\u7684\u5730\u65b9\uff0c\u90a3\u4e48\u4ef7\u503c\u4e3a1\u7684\u8def\u7a0b\u4f1a\u589e\u591a\uff0c\u800c\u4ef7\u503c\u4e3a2\u7684\u8def\u7a0b\u4f1a\u51cf\u5c11\n\n\u6362\u4e00\u53e5\u8bdd\u8bf4\uff0c\u4ef7\u503c\u4e3a1\u7684\u8fd9\u6761\u8fb9\u5bf9\u5176\u5b83\u8def\u7a0b\u7684\u8d21\u732e\u51cf\u5c11\u4e86\n\n\u6211\u4eec\u6765\u4e3e\u4e00\u4e2a\u4f8b\u5b50\n![](https://cdn.luogu.com.cn/upload/image_hosting/5ht56oyl.png)\n\u5728\u5de6\u8fb9\u8fd9\u5e45\u56fe\u4e2d\uff0c\u6211\u4eec\u6ca1\u6709\u628a\u4ef7\u503c\u4e3a1\u7684\u8fb9\u653e\u5728\u4ef7\u503c\u4e3a0\u7684\u8fb9\u7684\u65c1\u8fb9\uff0c\u8fd9\u65f6(u,B)\u8fd9\u6761\u8fb9\u6c38\u8fdc\u4f1a\u7f3a\u59311\uff0c\u6211\u4eec\u4ecev\u5411\u4e0b\u904d\u5386\uff0c\u540c\u65f6\u7ecf\u8fc70\u548c1\u7684\u8def\u5f84\u7684\u4e2a\u6570\u4f1a\u51cf\u5c11\uff0c\u4f1a\u6709\u5f88\u591a\u8def\u5f84\u7684\u4ef7\u503c\u4e3a1\uff0c\u4ee5\u540e\u4e5f\u4e0d\u4f1a\u518d\u6539\u53d8\n\n \u5728\u53f3\u8fb9\u8fd9\u5e45\u56fe\u4e2d\uff0c\u6211\u4eec\u6709\u628a\u4ef7\u503c\u4e3a1\u7684\u8fb9\u653e\u5728\u4ef7\u503c\u4e3a0\u7684\u8fb9\u7684\u65c1\u8fb9\uff0c\u8fd9\u65f6(u,B)\u8fd9\u6761\u8fb9\u7684\u8fb9\u67431\uff0c\u5b83\u7684\u4ef7\u503c\u4e5f\u5c31\u4e3a1\uff0c\u6211\u4eec\u4ecev\u5411\u4e0b\u904d\u5386\uff0c\u540c\u65f6\u7ecf\u8fc70\u548c1\u7684\u8def\u5f84\u7684\u4e2a\u6570\u663e\u7136\u8981\u6bd4\u4e0a\u9762\u7684\u591a\uff0c\u8def\u5f84\u7684\u4ef7\u503c\u4e00\u5b9a\u4f1a\u5927\u4e8e1\n![](https://cdn.luogu.com.cn/upload/image_hosting/bjyqp7oj.png)\nf[u][v]=max(f[u,pa[u][v]],f[v,pa[v][u]])+g[u][v]*g[v][u]\n\n\u4ec0\u4e48\u610f\u601d\u5462\uff0c\u6211\u4eec\u8fd8\u662f\u62ff\u56fe\u6765\u8bf4\n![](https://cdn.luogu.com.cn/upload/image_hosting/dab5txp8.png)\n  \u6211\u4eec\u5047\u8bbeu\u548cv\u4e4b\u95f4\u7684\u8fb9\u6743\u90fd\u5df2\u7ecf\u4ece\u5c0f\u5230\u5927\u52a0\u5b8c\uff0c\u90a3\u4e48\u5176\u4e2d\u6700\u5927\u7684\u4e00\u4e2a\u6743\u503c\u6211\u4eec\u4e0d\u662f\u52a0\u5728\uff08u,pa[v][u]\uff09\u4e0a\uff0c\u5c31\u662f\u52a0\u5728\uff08v,pa[u][v]\uff09\u4e0a\n\n \u5982\u679c\u52a0\u5728\uff08u,pa[v][u]\uff09\u4e0a\uff0c\u90a3\u4e48\u589e\u5927\u7684\u4ef7\u503c\u5c31\u662fg[u][v]*g[v][u]\uff0c\u8fd8\u8981\u52a0\u4e0a\u539f\u6765\u5c31\u6709\u7684f[u,pa[u][v]]\n\n \u5982\u679c\u52a0\u5728\uff08v,pa[u][v]\uff09\u4e0a\uff0c\u90a3\u4e48\u589e\u5927\u7684\u4ef7\u503c\u5c31\u662fg[u][v]*g[v][u]\uff0c\u8fd8\u8981\u52a0\u4e0a\u539f\u6765\u5c31\u6709\u7684f[v,pa[v][u]]\n\n\u5b9e\u9645\u4e0a\u8fd9\u4e24\u79cd\u60c5\u51b5\u589e\u5927\u7684\u4ef7\u503c\u90fd\u662f\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728f[u,pa[u][v]]\u548cf[v,pa[v][u]]\u4e2d\u53d6\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\n\n\u6700\u540e\u6211\u4eec\u518d\u770b\u4e00\u4e0b\u6700\u540e\u7684\u51b3\u7b56\u662f\u4ec0\u4e48\u60c5\u51b5\n\n\u6839\u636e\u6211\u4eec\u4e00\u5f00\u59cb\u7684\u63a8\u8bba\uff0c\u8fb9\u6743\u4ece\u5c0f\u5230\u5927\u4e00\u5b9a\u4f1a\u52a0\u5728\u540c\u4e00\u6761\u94fe\u4e0a\uff0c\u4f46\u662f\u8fd9\u4e00\u6761\u94fe\u4e0d\u4e00\u5b9a\u4f1a\u5305\u542bn-1\u6761\u8fb9\uff0c\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837![](https://cdn.luogu.com.cn/upload/image_hosting/cs415d39.png)\n \u6807\u7ea2\u8272\u7684\u662f\u6211\u4eec\u5df2\u7ecf\u9009\u597d\u8fb9\u6743\u7684\u8fb9\n\n\u8fd9\u65f6\u6211\u4eec\u4f1a\u53d1\u73b0\uff082\uff0c3\uff09\uff084\uff0c7\uff09\u8fd9\u4e24\u6761\u8fb9\u5e76\u6ca1\u6709\u88ab\u8d4b\u4e0a\u76f8\u5e94\u7684\u4ef7\u503c\uff0c\u8fd9\u65f6\u8be5\u600e\u4e48\u529e\u5462\uff0c\u6700\u540e\u7684\u4ef7\u503c\u8fd8\u662ff[8][9]\u5417\uff1f\n\n\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u6b64\u65f6\u8fb9\u6743\u53ea\u5269\u4e0b\u4e86\u6700\u5927\u7684\u4e24\u4e2a\uff0c\u65e0\u8bba\u52a0\u5230\u90a3\u4e00\u6761\u8fb9\u4e0a\u90fd\u4e0d\u4f1a\u5bf9\u7ed3\u679c\u4ea7\u751f\u5f71\u54cd\n\n\u90a3\u4e483\u30017\u8282\u70b9\u8d21\u732e\u7684\u4ef7\u503c\u5462\uff0c\u5b9e\u9645\u4e0a\uff0c\u5728\u6211\u4eec\u51b3\u7b562\u30011\u30014\u8fd9\u4e09\u4e2a\u70b9\u65f6\uff0c3\u30017\u4f5c\u4e3a\u5b50\u6811\u4ef7\u503c\u5df2\u7ecf\u88ab\u786e\u5b9a\u4e86\uff0c\u65e0\u8bba\u4f60\u52a0\u591a\u5927\u7684\u8fb9\u6743\u4e5f\u4e0d\u4f1a\u6539\u53d8\u8def\u7a0b\u6ca1\u6709\u7ecf\u8fc7\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\n\n\u4ee3\u7801\u7684\u8bdd\uff0cg\u3001pa\u6570\u7ec4\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u5f97\u5230\uff0cf\u6570\u7ec4\u6211\u4eec\u679a\u4e3e\u53d6\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\n\n\u8fd9\u9053\u9898\u4e5f\u8981\u5f00long long\u5426\u5219\u4f1a\u7206\u6389\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\nusing namespace std;\nconst int maxd=3010;\ntypedef long long ll;\nstruct asd{\n    ll from,to,next;\n}b[maxd*2];\nll head[maxd],tot=1;\nvoid ad(ll aa,ll bb){\n    b[tot].from=aa;\n    b[tot].to=bb;\n    b[tot].next=head[aa];\n    head[aa]=tot++;\n}\nll pa[maxd][maxd],f[maxd][maxd],g[maxd][maxd];\nll rt=1;\nvoid dfs(ll now,ll fa){\n    g[rt][now]=1;\n    for(ll i=head[now];i!=-1;i=b[i].next){\n        ll u=b[i].to;\n        if(u==fa) continue;\n        pa[rt][u]=now;\n        dfs(u,now);\n        g[rt][now]+=g[rt][u];\n    }\n}\nll solve(ll u,ll v){\n    if(u==v) return 0;\n    if(f[u][v]) return f[u][v];\n    return f[u][v]=max(solve(u,pa[u][v]),solve(v,pa[v][u]))+g[u][v]*g[v][u];\n}\nint main(){\n    memset(head,-1,sizeof(head));\n    ll n;\n    scanf(\"%lld\",&n);\n    for(ll i=1;i<n;i++){\n        ll aa,bb;\n        scanf(\"%lld%lld\",&aa,&bb);\n        ad(aa,bb);\n        ad(bb,aa);\n    }\n    for(ll i=1;i<=n;i++){\n        rt=i;\n        dfs(i,-1);//\u9012\u5f52\uff0c\u9884\u5904\u7406s\u6570\u7ec4\u548cpa\u6570\u7ec4\n    }\n    ll ans=-1;\n    for(ll i=1;i<=n;i++){\n        for(ll j=1;j<=n;j++){\n            ans=max(solve(i,j),ans);//\u53d6\u6700\u5927\u503c\n        }\n    }\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1586838809,
        "uid": 316322,
        "name": "hzoi_liuchang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1292C \u3010Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": "\u81ea\u4ece\u505a\u8fc7\u6811\u4e0a\u7684\u6570\u4e4b\u540e\u5fc3\u91cc\u5c31\u57cb\u4e0b\u4e86\u5bf9\u8fd9\u79cd\u6811\u4e0a\u6392\u5217\u7684\u9898\u6df1\u6df1\u7684\u6050\u60e7\u3002\n\n\u4f46\u5176\u5b9e\u8fd9\u9898\u96be\u5ea6\u5e76\u4e0d\u662f\u7279\u522b\u9ad8\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u89c2\u5bdf\u51fa\u8fd9\u662f\u4e00\u4e2a\u8ba1\u7b97\u8def\u5f84\u5c5e\u6027\u548c\u7684\u95ee\u9898\u3002\u505a\u8fd9\u7c7b\u95ee\u9898\u6709\u4e00\u4e2a\u666e\u904d\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u628a\u6240\u6709\u8def\u5f84\u7684\u548c\u8f6c\u5316\u4e3a\u6240\u6709\u8fb9\u5bf9\u7b54\u6848\u8d21\u732e\u7684\u548c\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u679a\u4e3e\u8fb9\u4e86\u3002\u4ece\u7279\u6b8a\u5230\u4e00\u822c\u6765\u8003\u8651\u3002\n\n\u5bf9\u4e8e\u8fb9\u6743\u4e3a$0$\u7684\u8fb9\uff0c\u8bbe\u5176\u4e24\u7aef\u7684\u70b9\u5206\u522b\u4e3a$u$, $v$\u3002\u90a3\u4e48\u663e\u7136\uff0c\u8fd9\u6761\u8fb9\u628a\u6574\u68f5\u6811\u5206\u6210\u4e86\u4e24\u68f5\u6811$tr_u, tr_v$\u3002\u5bf9\u4e8e\u4efb\u610f\u4e00\u5bf9$tr_u$\u4e2d\u7684\u70b9\u548c$tr_v$\u4e2d\u7684\u70b9\uff0c\u4ed6\u4eec\u4e4b\u95f4\u7684$mex$\u4ece$0$\u53d8\u4e3a\u4e86$1$\uff08\u56e0\u4e3a\u7ecf\u8fc7\u4e86\u8fb9\u6743\u4e3a$0$\u7684\u8fb9\uff09\u3002\u6240\u4ee5\u8fd9\u6761\u8fb9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f$siz_{tr_u} \\cdot siz_{tr_v}$\u3002\n\n\u90a3\u4e48\u8fb9\u6743\u4e3a$1$\u7684\u8fb9\u653e\u54ea\u513f\uff1f\n\n\u6211\u4eec\u624b\u73a9\u4e00\u4e0b\u53ef\u4ee5\u53d1\u73b0\uff0c\u653e\u5728$0$\u65c1\u8fb9\u4e00\u5b9a\u662f\u6700\u4f18\u7684\u3002\u8fd9\u5f88\u597d\u7406\u89e3\u3002\u518d\u5f80\u4e0b\uff0c\u628a\u65b0\u7684\u8fb9\u653e\u5728\u5df2\u7ecf\u9009\u62e9\u7684\u8fb9\u6784\u6210\u7684\u94fe\u4e24\u7aef\u4e00\u5b9a\u662f\u6700\u4f18\u7684\u3002\u4e00\u76f4\u5230\u6700\u540e\uff0c\u653e\u65b0\u8fb9\u5df2\u7ecf\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\u4e86\u3002\u8fd9\u65f6\u5019\u53ef\u4ee5\u968f\u4fbf\u653e\n\n\u4f46\u662f\u6211\u4eec\u4e0d\u77e5\u9053\u65b0\u8fb9\u5e94\u8be5\u653e\u54ea\u7aef\u600e\u4e48\u529e\uff1f\n\n$dp$.\n\n\u5148\u679a\u4e3e\u4e00\u624b$u$, $v$\u3002\u8bbe\u8fd9\u6761\u8fb9\u628a\u6574\u68f5\u6811\u5206\u6210\u4e86\u4e24\u68f5\u6811$tr_u, tr_v$\u3002$siz[i]$\u4e3a\u4ee5\u70b9$i$\u4e3a\u6839\u6784\u6210\u7684**\u5b50\u5b50**\u6811\u7684\u5927\u5c0f\u3002$dp[i][j]$\u8868\u793a$u$\u8fd9\u68f5\u5b50\u6811\u4e0b\u7684\u94fe\u957f\u5230\u4e86$i$\uff0c$v$\u8fd9\u68f5\u5b50\u6811\u4e0b\u7684\u94fe\u957f\u5230\u4e86$j$\u662f**\u8fd8\u80fd**\u5f97\u5230\u7684\u6700\u5927\u548c\u3002\u5219\u6709$dp[i][j] = siz[i] \\cdot siz[j] + max(dp[son[i]][j], dp[son[j]][i]) $\n\n\u518d\u4e4b\u540e\u7c7b\u4f3c\u6362\u6839DP\u5730\u505a\u5c31\u53ef\u4ee5\u5b9e\u73b0$n^2$\u7684\u590d\u6742\u5ea6\u4e86\u3002",
        "postTime": 1580036234,
        "uid": 55078,
        "name": "YLWang",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1292C \u3010Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": "\u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u4e00\u68f5$n$\u4e2a\u8282\u70b9\u7684\u6811\uff0c\u5c06$[0,n-2]$\u5206\u914d\u5230\u6bcf\u4e00\u6761\u8fb9\uff0c\u5b9a\u4e49$s(s,t)$\u4e3a$s$\u5230$t$\u8def\u5f84\u8fb9\u6743\u7684$mex$\uff0c\u6c42$s(s,t)$\u548c\u7684\u6700\u5927\u503c\n\n\u540d\u8bcd\u89e3\u91ca\uff1a$mex$\uff1a\u6ca1\u6709\u51fa\u73b0\u7684\u6700\u5c0f**\u81ea\u7136\u6570**\uff08\u5373$[0,+\\infty]$\uff09\n\n\u9898\u76ee\u601d\u8def\uff1a\n\nemm\uff0c\u611f\u89c9\u5047\u5982\u8fd9\u68f5\u6811\u53d8\u4e3a**\u4e00\u6761\u94fe**\u7684\u60c5\u51b5\u53ef\u4ee5\u8ba8\u8bba\u4e00\u4e0b\uff0c\u5bf9\u672c\u9898\u6709\u542f\u53d1\u3002\uff08\u5176\u5b9e\u5c31\u662f\u94fe\u4e0a\u65b9\u6848\u63a8\u5e7f\u5230\u6811\u4e0a\uff0c\u4e24\u8005\u662f\u76f8\u901a\u7684\u3002\u4f46\u94fe\u7684\u60c5\u51b5\u663e\u7136\u66f4\u597d\u60f3\uff09\n\n\u5148\u8003\u8651 $0$ \u7684\u653e\u7f6e\uff0c\u6839\u636e\u5b9a\u4e49\uff0c\u82e5 $0$ \u653e\u7f6e\u5728\u4e00\u6761\u5de6\u8fb9\u6709 $x$ \u8282\u70b9\uff0c\u53f3\u8fb9\u6709 $y$ \u8282\u70b9\u7684\u8fb9\uff0c\u5219\u8d21\u732e\u4e3a $x\\times y$\uff0c\u6700\u5927\u5316\u8be5\u503c\u5373\u53ef\u3002\n\n\u518d\u8003\u8651 $1$ \u7684\u653e\u7f6e\uff0c\u82e5 $1$ \u4e0d\u5728 $0$ \u8fb9\u7684\u5de6\u6216\u53f3\uff0c\u65b9\u6848\u5c06**\u4e0d\u4f1a\u66f4\u4f18**\u3002\u8bc1\u660e\u5982\u4e0b\u3002\n\n\u73b0\u6709\u4e24\u4e2a\u65b9\u6848\n```\nA:.... 2 1 0 ..... B: .... 1 2 0 ....\n```\n\u5047\u8bbe`...`\u5e76\u6ca1\u6709\u5dee\u522b\uff0c\u90a3\u4e48\n\n0. \u6309\u7167\u9898\u610f\uff0c\u4e0d\u8003\u8651 $0$ \u5de6\u53f3\u7684\u5185\u90e8\u7b54\u6848\uff0c\u56e0\u4e3a\u90fd\u662f $0$\n\n1. \u5de6\u8fb9\u7684...\u5230\u53f3\u8fb9\u7684...\u7b54\u6848\u6ca1\u6709\u5dee\u522b\n\n2. $1$ \u5230\u53f3\u8fb9\u7684...\uff0cB\u7b54\u6848>A\u7b54\u6848\uff08\u5168\u662f $2$\uff09\n\n3. $2$ \u5230\u53f3\u8fb9\u7684...\uff0cA\u7b54\u6848>B\u7b54\u6848\uff08\u5168\u662f $1$\uff09\n\n\u663e\u7136\uff0c$2$ \u4e2d\u7684B\u7b54\u6848\u7b49\u4e8e $3$ \u4e2d\u7684A\u7b54\u6848\uff0c\u5373\u4e24\u65b9\u6848\u7684\u7b54\u6848\u4e8b\u5b9e\u4e0a\u662f**\u76f8\u540c**\u7684\uff0c\u82e5\u8003\u8651\u5c06\u4e0a\u6587\u65b9\u6848\u4e2d\u7684 $2$ \u6362\u4e3a\u5927\u4e8e $2$ \u7684\u6570\uff0c\u5219B\u663e\u7136\u4f1a\u6bd4A**\u52a3**\u3002\u56e0\u6b64\uff0c$1$ \u987b\u653e\u5728 $0$ \u7684\u5de6\u53f3\u3002\u5177\u4f53\u7684\u8bf4\uff0c\u82e5 $0$ \u5de6\u8fb9\u6709 $x$ \u4e2a\u8282\u70b9\uff0c\u53f3\u8fb9\u6709 $y$ \u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u9700\u6bd4\u8f83 $(x-1)\\times y$ \u548c $x \\times (y-1)$\u3002\n\n\u63a5\u7740\u5f80\u4e0b\u8003\u8651\uff0c\u53ef\u4ee5\u8bc1\u660e\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u4f7f\u8be5\u6570\u5728\u5df2\u7f16\u53f7\u7684\u5e8f\u5217\u7684\u5de6\u3001\u53f3\u5c06\u4e0d\u4f1a\u66f4\u52a3\u3002\u65b9\u6848\u4ea6\u4e0e\u4e0a\u6587\u7c7b\u4f3c\u3002\n\n\u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e2a\u8fb9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f**\u7ecf\u8fc7\u8be5\u8fb9\u7684\u6b21\u6570 $\\times 1  /0$** \u3002\u5373\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u6309\u7167\u4e0a\u9762\u7684\u6784\u9020\u65b9\u6848\u7684\u60c5\u51b5\u4e0b\u65e0\u9700\u518d\u8003\u8651\u7f16\u53f7\u95ee\u9898\u3002\n\n\u6309\u4e0a\u9762\u7684\u65b9\u6cd5\uff0c\u4e00\u6761\u94fe\u7684\u65b9\u6848\u4fbf\u53ef\u6784\u9020\u51fa\u6765\u3002\n\n==\u5206\u5272\u7ebf==\n\n\u56de\u5230\u6b63\u6587\uff0c\u73b0\u5728\u6211\u4eec\u8003\u8651\u7684\u662f\u6811\uff0c\u4f46\u53ef\u4ee5\u89c6\u4e3a**\u82e5\u5e72\u6761\u94fe**\u3002\u5982\u4e0a\u6587\u6240\u8bf4\uff0c\u94fe\u548c\u6811\u7684\u505a\u6cd5\u91cc\u67d0\u4e9b\u4e1c\u897f\u662f\u76f8\u901a\u7684\u3002\n\n\u4eff\u7167\u94fe\u7684\u505a\u6cd5\uff0c\u6b64\u65f6\u653e\u7f6e\u65b9\u6848\u5e94\u4f7f $0$ \u5230\u4e00\u4e2a\u5c3d\u91cf\u5927\u7684\u6570\u90fd\u653e\u5728**\u4e00\u6761\u7279\u5b9a\u7684\u94fe**\u4e0a\u3002\u5176\u4ed6\u65b9\u6848\u4e0d\u4f1a\u66f4\u4f18\u3002\u81f3\u4e8e\u8bc1\u660e\uff0c\u53ef\u4eff\u7167\u94fe\u7684\u8bc1\u660e\u65b9\u5f0f\u3002\n\n\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u8981\u627e\u5230\u8fd9\u6761\u7279\u5b9a\u7684\u94fe\u3002\u901a\u8fc7\u8d2a\u5fc3\u6765\u627e\u5230\u8fd9\u6761\u7279\u5b9a\u7684\u94fe\u4e0d\u5927\u53ef\u884c\u3002\u8003\u8651\u6bcf\u4e00\u6761\u94fe\u90fd\u6c42\u51fa\u8be5\u94fe\u4e3a\u7279\u5b9a\u94fe\u65f6\uff0c\u8fd9\u68f5\u6811\u7684\u603b\u7b54\u6848\u3002\n\n\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u8bb0\u5fc6\u5316\u641c\u7d22\u6c42\u89e3\uff0c\u901a\u8fc7 $(u,v)$ \u7684\u7b54\u6848\u53ef\u6c42 $u$,$v$ \u7684\u5b50\u8282\u70b9\u7684\u7b54\u6848\u3002\n\n\u8bb0 $f(u,v)$ \u4e3a\u5c06 $u$ \u5230 $v$ \u4f5c\u4e3a\u4e0a\u6587\u7684\u7279\u5b9a\u7684\u94fe\u7684\u7b54\u6848\u3002\u5219\n$f(u,v)=max(f(fa_u,v),f(i,fa_v))+siz_u \\times siz_v$\u3002\n\n\u4f46\u662f\uff0c\u968f\u7740 $(u,v)$ \u7684\u6539\u53d8\uff0c\u6811\u7684\u5f62\u6001\u53ef\u80fd\u4f1a\u53d1\u751f\u4e00\u5b9a\u6539\u53d8\uff0c\u8fd9\u610f\u5473\u7740 $fa_x$ \u548c $siz_x$ \u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u89e3\u51b3\u65b9\u6848\u662f\u5c06\u6bcf\u4e2a\u8282\u70b9\u4f5c\u6839\u65f6\u7684$fa$\u548c$siz$\u72b6\u51b5\u90fd\u9884\u5904\u7406\u4e0b\u6765\uff0c\u5728 $(u,v)$ \u72b6\u51b5\u4e0b\uff0c$fa_u$ \u548c $siz_u$ \u5206\u522b\u662f $v$ \u4f5c\u4e3a\u6839\u65f6\u7684 $fa$ \u548c $siz$\uff0c\u8fd9\u4e2a\u753b\u56fe\u53ef\u4ee5\u7406\u89e3\u3002\n\n\u81f3\u6b64\uff0c\u672c\u9898\u57fa\u672c\u5b8c\u6210\uff0c\u4ee5\u4e0b\u662f\u672c\u9898\u4ee3\u7801\u3002\n```\n#include<bits/stdc++.h>\nusing namespace std;\nint cc,to[6000],net[6000],fr[6000];bool vis[6000];\nint rot,fa[3005][3005];\nint n,u,v;long long ans,f[3005][3005],siz[3005][3005];\nvoid addedge(int u,int v)\n{\n\tcc++;\n\tto[cc]=v;net[cc]=fr[u];fr[u]=cc;\n}\nvoid dfs(int x)\n{\n\tvis[x]=true;\n\tfor (int i=fr[x];i;i=net[i])\n\t{\n\t\tif (!vis[to[i]])\n\t\t{\n\t\t\tfa[rot][to[i]]=x;\n\t\t\tsiz[rot][to[i]]=1;\n\t\t\tdfs(to[i]);\n\t\t\tsiz[rot][x]+=siz[rot][to[i]];\n\t\t}\n\t}\n}\nlong long dp(int u,int v)\n{\n\tif (f[u][v]) return f[u][v];\n\tif (u==v) return 0;\n\tf[u][v]=max(dp(fa[v][u],v)+siz[v][u]*siz[u][v],\n\tdp(u,fa[u][v])+siz[v][u]*siz[u][v]);\n\treturn f[u][v];\n}\nint main()\n{\n\tcin>>n;\n\tfor (int i=1;i<n;i++)\n\t{\n\t\tcin>>u>>v;\n\t\taddedge(u,v);\n\t\taddedge(v,u);\n\t}\n\tfor ( rot=1;rot<=n;rot++)\n\t{\n\t\tfor (int j=1;j<=n;j++)\n\t\t  vis[j]=false;\n\t\tsiz[rot][rot]=1;fa[rot][rot]=0;dfs(rot);\n\t}//\u9884\u5904\u7406\u6bcf\u4e2a\u8282\u70b9\u4e3a\u6839\u65f6\u7684fa\u548csiz\n\tfor (int i=1;i<=n;i++)\n\t  for (int j=1;j<n;j++)\n\t  {\n\t  \tdp(i,j);ans=max(ans,f[i][j]);\n\t  }//\u8bb0\u641c\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n",
        "postTime": 1605793627,
        "uid": 73990,
        "name": "fmj_123",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1292C \u3010Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": "[\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://m-sea-blog.com/archives/4748/)\n\n\u9996\u5148\u8981\u6c42\u7684\u4e1c\u897f\u5b9e\u9645\u4e0a\u7b49\u4e8e\n$$\n\\sum_{i=1}^n\\sum_{1\\leq u<v\\leq n}[\\operatorname{mex}(u\\to v)\\geq i]\n$$\n\u540e\u9762\u7684\u4e1c\u897f\u7684\u610f\u601d\u5c31\u662f\u8def\u5f84\u4e0a\u6070\u597d\u5305\u542b $0\\cdots i-1$ \u8fd9\u4e9b\u6570\u7684\u8def\u5f84\u6570\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff0c\u5373\u6700\u4f18\u65b9\u6848\u4e2d $0\\cdots i-1$ \u4e00\u5b9a\u6784\u6210\u4e00\u6761\u8def\u5f84\uff0c\u4e14\u6210\u4e00\u4e2a\u5355\u8c37\u5e8f\u5217\u3002\n\n\u8003\u8651 DP\u3002\u8bbe $dp_{i,j}$ \u8868\u793a $i\\to j$ \u8def\u5f84\u4e0a\u653e\u4e86 $0\\cdots len-1$ \u8fd9\u4e9b\u6570\u65f6\u7b54\u6848\u7684\u6700\u5927\u503c\u3002\n\n\u8bb0 $f_{i,j}$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u65f6 $j$ \u7684\u7236\u8282\u70b9\uff0c$sz_{i,j}$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u65f6 $j$ \u7684\u5b50\u6811\u5927\u5c0f\uff0c\u4e0d\u96be\u5f97\u5230\u8f6c\u79fb\n$$\ndp_{i,j}=\\max\\left\\{dp_{f_{j,i},j},dp_{i,f_{i,j}}\\right\\}+sz_{i,j}\\times sz_{j,i}\n$$\n\u76f4\u63a5\u8bb0\u641c\u5373\u53ef\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n^2)$\u3002\n\n```cpp\n// ===================================\n//   author: M_sea\n//   website: http://m-sea-blog.com/\n// ===================================\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n\nint read() {\n    int X=0,w=1; char c=getchar();\n    while (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n    while (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n    return X*w;\n}\n\nconst int N=3000+10;\n\nint n;\n\nstruct edge { int v,nxt; } e[N<<1];\nint head[N];\nvoid addEdge(int u,int v) {\n    static int cnt=0;\n    e[++cnt]=(edge){v,head[u]},head[u]=cnt;\n}\n\nint fa[N][N],sz[N][N];\nvoid dfs(int rt,int u,int f) {\n    fa[rt][u]=f,sz[rt][u]=1;\n    for (int i=head[u];i;i=e[i].nxt) {\n        int v=e[i].v; if (v==f) continue;\n        dfs(rt,v,u); sz[rt][u]+=sz[rt][v];\n    }\n}\n\nll dp[N][N];\nll calc(int u,int v) {\n    if (u==v) return 0;\n    if (dp[u][v]) return dp[u][v];\n    return dp[u][v]=max(calc(fa[v][u],v),calc(u,fa[u][v]))+sz[u][v]*sz[v][u];\n}\n\nint main() {\n    n=read();\n    for (int i=1;i<n;++i) {\n        int u=read(),v=read();\n        addEdge(u,v),addEdge(v,u);\n    }\n    for (int i=1;i<=n;++i) dfs(i,i,0);\n    ll ans=0;\n    for (int i=1;i<=n;++i)\n        for (int j=i+1;j<=n;++j)\n            ans=max(ans,calc(i,j));\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1587438020,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1292C \u3010Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u5728\u4e00\u9897\u6709n\u4e2a\u8282\u70b9\u7684\u6811\u4e0a\uff0c\u7ed9\u6bcf\u4e2a\u8fb9\u8d4b\u503c\uff0c\u6240\u6709\u7684\u503c\u90fd\u5728$[0,n-2]$\u5185\u5e76\u4e14\u4e0d\u91cd\u590d\uff0c\u4e5f\u5c31\u662f\u4e00\u6761\u8fb9\u4e00\u4e2a\u6743\u503c\uff0c\u4ee4$mex(u,v)$\u8868\u793a\u4ece$u$\u5230$v$\u8fd9\u6761\u7b80\u5355\u8def\u5f84\u4e0a\u6ca1\u6709\u51fa\u73b0\u8fc7\u7684\u6700\u5c0f\u81ea\u7136\u6570\uff0c\u8981\u6c42\u4f7f\u6240\u6709\u8def\u5f84\u7684$mex$\u4e4b\u548c\u6700\u5927\u3002\n\n## \u5206\u6790\n\u6700\u5f00\u59cb\u6211\u4e00\u770b\u8fd9\u4e2a\u9898\uff0c\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u597d\u50cf\u5c31\u9700\u8981$O(N^2)$,\u90a3\u8fd9\u4e2a\u9898\u597d\u50cf\u7edf\u8ba1\u4e2a\u7b54\u6848\u5c31\u53ef\u80fd\u4f1aT\uff1f\u5f53\u6211\u770b\u89c1\u65f6\u9650\u662f$3s$\u7684\u65f6\u5019\u6211\u5c31\u77e5\u9053\u6211\u60f3\u591a\u4e86\uff0c\u5206\u6790\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u65f6\u5019\u63d0\u524d\u770b\u4e00\u4e0b\u65f6\u9650\uff0c\u9632\u6b62\u56e0\u770b\u9519\u65f6\u9650\u5206\u6790\u9519\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\u9996\u5148\u8fd9\u4e2a\u8fb9\u7684\u6743\u503c\u80af\u5b9a\u6709\u89c4\u5f8b\uff0c\u4e0d\u7136\u679a\u4e3e\u6743\u503c\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u5f88\u9ad8\uff0c\u6700\u5f00\u59cb\u6211\u60f3\u7684\u662f\u4ece\u6bcf\u4e2a\u8fb9\u5f00\u59cb$dfs$\u4e00\u4e0b\u628a\u7ecf\u8fc7\u6b21\u6570\u6700\u591a\u7684\u8fb9\u8bbe\u62100\uff0c\u7136\u540e\u4f9d\u6b21\u7c7b\u63a8\uff0c\u6bcf\u6b21$dfs$\u4e0d\u8bbf\u95ee\u91cd\u590d\u7ecf\u8fc7\u7684\u70b9\uff0c\u53d1\u73b0\u5b58\u5728\u4e00\u4e2a\u4ec0\u4e48\u95ee\u9898\u5462\uff0c\u5c31\u662f\u4ece\u4e0d\u540c\u7684\u70b9\u5f00\u59cb$dfs$\u9020\u6210\u7684\u7ed3\u679c\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u8fd9\u6837\u4e0d\u53ef\u884c\uff0c\u4e0d\u59a8\u5148\u753b\u4e00\u6761\u94fe\u6765\u770b\u770b\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/lmwv3zx8.png?x-oss-process=image/resize,m_lfit,h_00,w_500)\n\n\u5982\u679c\u5df2\u7ecf\u653e\u597d\u4e86$0$\u5230$x-1$\uff0c\u8003\u8651$x$\u653e\u54ea\u4e2a\u4f4d\u7f6e\uff0c\u5982\u679c\u6211\u628a$x$\u653e\u5230$5-v$\u4e0a\uff0c\u90a3\u4e48$mex(u,5)$\u5c31\u4f1a\u662f$x$\uff0c\u7136\u540e\u53ea\u6709$mex(u,v)$\u4f1a\u7b49\u4e8e$x+1$\uff0c\u4f46\u8981\u662f\u628a$x$\u653e\u5230$u-1$\u6216$4-5$\u4e0a\uff0c$mex$\u7b49\u4e8e$x+1$\u7684\u5c31\u4e0d\u4f1a\u53ea\u662f$mex(u,v)$\u4e86\u3002\u94fe\u4e0a\u662f\u8fd9\u6837\uff0c\u6811\u4e0a\u5f53\u7136\u4e5f\u662f\uff0c\u6240\u4ee5$x$\u653e\u5230\u94fe\u7684\u4e24\u7aef\u4f1a\u4f7f\u7ed3\u679c\u66f4\u4f18\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/qlrym8tk.png?x-oss-process=image/resize,m_lfit,h_00,w_500)\n\n\u4e5f\u5c31\u662f\u8fd9\u6837\uff0c\u5bf9\u4e8e$u-v$\u7684\u8def\u5f84\uff0c4\u548c5\u653e\u5728\u6700\u4e24\u7aef\u65f6\u7ed3\u679c\u4f1a\u66f4\u4f18\uff0c\u7136\u540e\u5bf9\u6700\u5927\u503c5\u7684\u4f4d\u7f6e\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff0c\u5c31\u53ef\u4ee5\u6c42\u89e3\u51fa\u7b54\u6848\u3002\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u6211\u771f\u7684\u53bb\u628a\u6bcf\u4e2a$mex$\u76f8\u52a0\uff0c\u7684\u786e\u5f88\u4e0d\u73b0\u5b9e\uff0c\u6839\u636e\u4e4b\u524d\u505a\u8fc7\u7684\u4e00\u4e9b\u7c7b\u4f3c\u7684\u9898\uff0c\u76f4\u63a5\u52a0\u4e0a$x$\u76f8\u5f53\u4e8e\u5728$0~x-1$\u5404\u52a01\uff0c\u8f6c\u5316\u6210\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f$size_u*size_v$,\u8fd9\u6837\u6c42\u89e3\u8d77\u6765\u5c31\u4f1a\u76f8\u5bf9\u7b80\u5355\u3002\n\u4e4b\u524d\u5df2\u7ecf\u8bb2\u8fc7\uff0c\u4ece\u4e0d\u540c\u7684\u70b9\u5f00\u59cb$dfs$\u7684\u7ed3\u679c\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u4e0d\u80fd\u50cf\u5e73\u5e38\u90a3\u6837\u7edf\u8ba1$size$,\u800c\u662f\u5e94\u8be5\u5728\u52a0\u4e00\u7ef4\u8868\u793a\u6839\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684$size$\uff0c\u56e0\u4e3a\u8981\u679a\u4e3e\u6700\u5927\u6743\u503c\u6240\u5728\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u8fd8\u8981\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u7684\u7236\u4eb2\uff0c\u540c\u6837\u4e5f\u8981\u8bb0\u5f55\u6839\u3002\n\u4e0d\u59a8\u7528$dp_{u,v}$\u8868\u793a\u628a$0~x-1$\u653e\u5230$u-v$\u7684\u6700\u5927\u7b54\u6848\uff0c$s_{u,v}$\u8868\u793a$v$\u4ee5$u$\u4e3a\u6839\u65f6\u7684\u5b50\u6811\u5927\u5c0f\uff0c$fa_{u,v}$\u8868\u793a$v$\u4ee5$u$\u4e3a\u6839\u65f6\u7684\u7236\u4eb2\u3002\u4e8e\u662f\u6709\n$$dp_{u,v}=max(dp_{fa_{u,v},u},dp_{fa_{v,u},v})+s_{u,v}*s_{v,u}$$\n\u7136\u540e\u6b64\u9898\u5c31\u80fd\u5f97\u89e3\uff0c\u6ce8\u610f\u5f00long long\n```\n#include<iostream>\n#define ll long long\nusing namespace std;\nconst int N=3e3+10;\nstruct Edge{\n    int to,nxt;\n}e[N<<1];\nint Head[N],len;\nvoid Ins(int a,int b){\n    e[++len].to=b;e[len].nxt=Head[a];Head[a]=len;\n}\nint rt;ll s[N][N],dp[N][N],f[N][N];\nvoid dfs(int u){\n    s[rt][u]=1;\n    for(int i=Head[u];i;i=e[i].nxt){\n        int v=e[i].to;\n        if(v==f[rt][u])continue;\n        f[rt][v]=u;\n        dfs(v);\n        s[rt][u]+=s[rt][v];\n    }\n}\nll calc(int u,int v){\n    if(u==v)return 0;\n    if(dp[u][v])return dp[u][v];\n    return (dp[u][v]=max(calc(f[u][v],u),calc(f[v][u],v))+s[u][v]*s[v][u]);\n}\nint main(){\n    int n;\n    cin>>n;\n    for(int i=1;i<n;i++){\n        int a,b;\n        cin>>a>>b;\n        Ins(a,b);Ins(b,a);\n    }\n    for(int i=1;i<=n;i++)rt=i,dfs(i);\n    ll ans=0;\n    for(int i=1;i<=n;i++)\n    for(int j=1;j<=n;j++)\n        ans=max(ans,calc(i,j));\n    cout<<ans;\n}\n```",
        "postTime": 1586820596,
        "uid": 305262,
        "name": "Su_Zipei",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1292C"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1292C)\u3002\n\n[$\\text{cnblogs}$](https://www.cnblogs.com/UperFicial/p/16657535.html)\u3002\n\n\u8003\u8651\u589e\u91cf\u6cd5\uff0c\u679a\u4e3e\u4e00\u4e2a\u7b54\u6848 $x$\uff0c\u5b83\u7684\u8d21\u732e\u4e3a\u8def\u5f84 $\\operatorname{mex}$ \u4e0d\u5c0f\u4e8e $x$ \u7684\u8def\u5f84\u6570\u91cf\u3002\n\n\u90a3\u4e48\u6211\u4eec\u987a\u6b21\u653e\u5165\u8fb9\u6743 $w=[0,1,\\cdots,n-2]$\u3002\n\n\u8003\u8651\u8fb9\u6743 $1$ \u7684\u653e\u7f6e\uff0c\u5b83\u7684\u8d21\u732e\u4e3a\u4e0e\u8fb9\u6743 $0$ \u5f62\u6210\u7684\u8def\u5f84\u5de6\u53f3\u4e24\u4fa7\u5b50\u6811\u5927\u5c0f\u7684\u4e58\u79ef\u3002\n\n\u6211\u4eec\u60f3\u8ba9\u6536\u76ca\u6700\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u628a $1$ \u653e\u5230 $0$ \u76f8\u90bb\u7684\u4f4d\u7f6e\u3002\n\n\u800c\u5bf9\u4e8e $2$ \u5462\uff1f\u8981\u60f3\u6536\u76ca\u6700\u5927\uff0c\u5fc5\u987b\u4e0e $1$ \u548c $0$ \u6784\u6210\u4e00\u6761\u8fde\u7eed\u7684\u7b80\u5355\u8def\u5f84\u3002\n\n\u8fd9\u6837\u6211\u4eec\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u8003\u8651\u4e00\u6761\u8def\u5f84 $u\\to v$\uff0c\u4e2d\u95f4\u7ecf\u8fc7\u7684\u8fb9\u6743\u5f62\u6210\u4e86\u4e00\u4e2a\u5355\u8c37\u5e8f\u5217\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u53cd\u8bc1\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u6761\u8def\u5f84 $u\\to v$\uff0c\u6211\u4eec\u5728\u8fd9\u6761\u8def\u5f84\u4e0a\u586b\u5165\u4e00\u6bb5\u5355\u8c37\u5e8f\u5217\uff0c\u6700\u5927\u503c\u4e00\u5b9a\u5904\u4e8e\u8def\u5f84\u7684\u5de6\u7aef\u70b9\u6216\u53f3\u7aef\u70b9\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u66b4\u529b DP \u4e86\uff0c\u5206\u8ba8\u4e00\u4e0b\u6700\u5927\u503c\u653e\u5728\u53f3\u7aef\u8fd8\u662f\u5de6\u7aef\uff0c\u4e4b\u540e\u5f80\u5269\u4f59\u8def\u5f84\u4e0a DP\u3002\n\n[\u4ee3\u7801](https://codeforc.es/contest/1292/submission/170907212)\u3002",
        "postTime": 1662348932,
        "uid": 360511,
        "name": "UperFicial",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010CF1292C Xenon's Attack on the Gangs\u3011"
    },
    {
        "content": "\u8003\u8651\u94fe\u7684\u60c5\u51b5\u5bf9\u6b63\u89e3\u6709\u5f88\u5927\u7684\u542f\u53d1\u6027\n\n\u4e00\u5f00\u59cb\u60f3\u7740\u76f4\u63a5\u4ece\u5c0f\u5230\u5927\u653e\u5c31\u884c\u4e86\uff0c\u8fd9\u6837\u7b54\u6848\u5c31\u662f$\\dfrac{n(n-1)}{2}$\n\n\u4f46\u53d1\u73b0\u5176\u5b9e\u8fd9\u6837\u662f\u5f88\u4e0d\u4f18\u7684\uff0c\u56e0\u4e3a\u53ea\u6709\u9009\u53d6\u7684\u533a\u95f4\u7684\u4e00\u7aef\u662f$0$\u65f6\u624d\u4f1a\u5bf9\u7b54\u6848\u6709\u8d21\u732e\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5e0c\u671b\u7b54\u6848\u5c3d\u91cf\u5927\uff0c\u5c31\u8981\u5c3d\u53ef\u80fd\u628a\u5c0f\u7684\u503c\u5c3d\u91cf\u586b\u5145\n\n\u8003\u8651\u4ece\u5c0f\u5230\u5927\u653e\u7f6e\u6570\u5b57\uff1a\n\n\u9996\u5148\u662f$0$\uff0c\u5982\u679c\u5b83\u5de6\u7aef\u70b9\u4f4d\u7f6e\u4e3a$pos$\uff0c\u90a3\u4e48\u7ecf\u8fc7\u8fd9\u6761\u8fb9\u7684\u8def\u5f84\u6709$pos\\times (n-pos)$\u6761\n\n\u7136\u540e\u53ef\u4ee5\u8bc1\u660e\uff1a$1$\u8fb9\u4e00\u5b9a\u662f\u653e\u5728$0$\u8fb9\u65c1\u8fb9\u7684\uff0c\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\u5c31\u884c\u4e86\n\n\u4e24\u79cd\u60c5\u51b5\uff1a$\\text{xxxx1xxx0xxxx}$\u548c$\\text{xxxxx10xxxxx}$\n\n\u5bf9\u4e8e\u8de8\u8d8a\u4e86$0,1$\u7684\u533a\u95f4\uff0c\u7b54\u6848\u5c31\u548c$0,1$\u7684\u4f4d\u7f6e\u201c\u65e0\u5173\u201d\uff0c\u4f46\u662f\u663e\u7136\u53f3\u8fb9\u7684\u8fd9\u6837\u7684\u533a\u95f4\u66f4\u591a\n\n\u5bf9\u4e8e\u6ca1\u6709\u8de8\u8d8a$0,1$\u7684\u533a\u95f4\uff0c\u53ea\u6709\u5de6\u8fb9\u8fd9\u79cd\u60c5\u51b5\u6709\uff0c\u7b54\u6848\u53ea\u80fd\u662f$0/1$\n\n\u8fd9\u91cc\u5e76\u6ca1\u6709\u975e\u5e38\u4e25\u8c28\u7684\u8bc1\u660e\uff0c\u53ea\u662f\u4ece\u6574\u4f53\u4e0a\u8ba4\u77e5\u3002\u540c\u7406\u53ef\u4ee5\u63a8\u51fa\uff1a**\u6bcf\u4e00\u4e2a\u6570\u5b57\u80af\u5b9a\u662f\u653e\u5728\u5df2\u77e5\u6570\u5b57\u7684\u5de6\u8fb9\u6216\u8005\u53f3\u8fb9**\n\n\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u4ece\u5c0f\u5230\u5927\u653e\u6570\u503c\uff0c\u5c31\u662f\u5e0c\u671b\u5b83\u4eec\u80fd\u8986\u76d6\u7684\u533a\u95f4\u8d8a\u591a\u8d8a\u597d\u3002\u6240\u4ee5$0$\u8fb9\u80af\u5b9a\u662f\u653e\u5728\u4e2d\u95f4\uff0c\u6bcf\u6b21\u65b0\u589e\u52a0\u4e00\u4e2a\u6570\u5b57\uff0c\u5c31\u5224\u65ad\u5de6\u8fb9\u66f4\u4f18\u8fd8\u662f\u53f3\u8fb9\u66f4\u4f18\u6765\u653e\u5c31\u597d\u4e86\n\n\u94fe\u7684\u60c5\u51b5\u89e3\u51b3\u4e86\uff0c\u60f3\u529e\u6cd5\u628a\u94fe\u7684\u60c5\u51b5\u642c\u5230\u6811\u4e0a\u5c31\u884c\u4e86\n\n\u56e0\u4e3a\u7ecf\u8fc7$0$\u8fb9\u7684\u7b54\u6848\uff0c\u81f3\u5c11\u4f1a\u662f$1$\uff0c\u4e0d\u59a8\u8003\u8651\u8d39\u7528\u63d0\u524d\u8ba1\u7b97\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u8003\u8651\u5230\u5e95\u7ecf\u8fc7\u4e86\u54ea\u4e9b\u8fb9\uff0c\u90a3\u4e48\u8d21\u732e\u5c31\u662f$size[x]\\times size[y]$\n\n\u5f53\u7ecf\u8fc7$1$\u8fb9\u65f6\uff0c\u540c\u6837\u8d21\u732e\u4e3a$size[x]\\times size[y]$\uff0c\u8fd9\u6837\u5c31\u628a$0$\u8fb9\u65f6\u5c11\u4e86\u7684$1$\u7684\u7b54\u6848\u8865\u56de\u6765\u4e86\n\n\u6240\u4ee5\u53ea\u8981\u786e\u5b9a\u4e86$0$\u8fb9\u7684\u4f4d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u8fd9\u4e2aDP\u4e0b\u53bb\u5c31\u884c\u4e86\n\n\u56e0\u4e3a$n$\u6bd4\u8f83\u5c0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e$0$\u8fb9\uff0c\u7136\u540e\u8bb0\u5fc6\u5316\u641c\u7d22\u5c31\u80fd\u505a\u5230$O(n^2)$\u4e86\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#define ll long long\nusing namespace std;\nconst int N=3010;\nint tot;\nll f[N][N];\nint fir[N],size[N][N],fa[N][N];\nstruct edge\n{\n\tint to;\n\tint nxt;\n}e[2*N];\ninline void add(int x,int y)\n{\n\te[++tot].to=y; e[tot].nxt=fir[x]; fir[x]=tot;\n\te[++tot].to=x; e[tot].nxt=fir[y]; fir[y]=tot;\n}\ninline void dfs(int rt,int p)\n{\n\tsize[rt][p]=1;\n\tfor(int i=fir[p];i;i=e[i].nxt)\n\t{\n\t\tint q=e[i].to;\n\t\tif(q==fa[rt][p]) continue;\n\t\tfa[rt][q]=p;\n\t\tdfs(rt,q),size[rt][p]+=size[rt][q];\n\t}\n}\ninline ll cal(int p,int q)\n{\n\tif(p==q) return 0;\n\tif(f[p][q]) return f[p][q];\n\treturn f[p][q]=max(cal(fa[q][p],q),cal(p,fa[p][q]))+size[q][p]*size[p][q];\n}\nint main()\n{\n\tint n,a,b; ll ans=0;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tscanf(\"%d%d\",&a,&b);\n\t\tadd(a,b);\n\t}\n\tfor(int i=1;i<=n;i++) dfs(i,i);\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=i+1;j<=n;j++)\n\t\t\tans=max(ans,cal(i,j));\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1606464513,
        "uid": 81238,
        "name": "MCAdam",
        "ccfLevel": 7,
        "title": "CF1292C Xenon's Attack on the Gangs"
    }
]