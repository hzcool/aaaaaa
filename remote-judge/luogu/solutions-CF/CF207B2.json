[
    {
        "content": "# \u601d\u8def\n\u5efa\u8bae\u5148\u9605\u8bfb[\u5f31\u5316\u7248\u9898\u89e3](https://www.luogu.com.cn/blog/xiaohao-aibiancheng/solution-cf207b1)\u3002\n\n\u7531\u4e8e\u9700\u8981\u5c06\u6700\u540e\u4e00\u4e2a\u653e\u5230\u7b2c\u4e00\u4e2a\uff0c\u4e0d\u5982\u628a $a$ \u6570\u7ec4\u9996\u5c3e\u76f8\u63a5\uff0c\u5c06\u5176\u53d8\u4e3a\u4e00\u4e2a\u957f $2n$ \u7684\u6570\u7ec4\uff1a$a_1,a_2\\dots a_n,a_1,\\dots a_n$\u3002\u95ee\u9898\u968f\u5373\u53d8\u6210\u6c42 $1$ \u4f20\u9012\u5230 $n$\u3001$2\\sim n-1\\dots n\\sim 2n-1$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $x$\uff0c\u4ece $x-a_x$ \u63a5\u6536\u6d88\u606f\u80af\u5b9a\u4e0d\u662f\u6700\u4f18\u7684\uff0c\u5f88\u5bb9\u6613\u4e3e\u51fa\u53cd\u4f8b\u3002\u4f46\u662f\u5bf9\u4e8e\u6bcf\u4e2a $x$\uff0c**\u5982\u679c\u8d77\u70b9\u4e0d\u80fd\u76f4\u63a5\u53d1\u9001\u6d88\u606f\u7ed9\u5b83**\uff0c\u4ece $y=x-a_x\\sim x-1$ \u4e2d $y-a_y$ \u6700\u5c0f\u7684 $y$ \u63a5\u6536\u6d88\u606f\u80af\u5b9a\u662f\u6700\u4f18\u7684\u3002\n\n\u4e3a\u4ec0\u4e48\uff1f\n\n\u53cd\u8bc1\u6cd5\uff1a\u5982\u679c\u6709\u4e00\u4e2a\u975e $y$ \u7684 $z$\uff0c\u6709\u4e00 $k$\uff0c\u4e14 $z-a_z\\le k<y-a_y$\uff0c\u5219 $y$ \u4e0d\u4f18\u3002\u4f46\u662f $y-a_y\\le z-a_z$\uff0c\u4e0e\u5047\u8bbe\u77db\u76fe\u3002\n\n\u6240\u4ee5\u6bcf\u6b21\u53ea\u9700\u67e5\u5230 $y$ \u5373\u53ef\u3002\u8fd0\u7528 ST \u8868\uff0c\u53ef\u4ee5\u5c06\u67e5\u8be2\u964d\u5230 $O(1)$\u3002\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n+n^2)=O(n^2)$\u3002\u5728\u672c\u9898 $n\\le 10^4$\uff0c\u65f6\u9650 $3$ \u79d2\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u901a\u8fc7\u3002\n# AC code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nint Log[1000000];\nint st[600000][30];\nint a[600000];\n\n//ST \u8868\u90e8\u5206\nvoid init(int n)\n{\n\tLog[0]=Log[1]=0;\n\tfor(int i=2;i<=n;i++)Log[i]=Log[i/2]+1;\n}\n\nvoid Build(int n)\n{\n\tfor(int i=0;i<=n;i++)st[i][0]=i;\n\tfor(int j=1;j<=Log[n]+1;j++)\n\t\tfor(int i=0;i<=n;i++) \n\t\t\tst[i][j]=((a[st[i][j-1]]<=a[st[i+(1<<(j-1))][j-1]])?st[i][j-1]:st[i+(1<<(j-1))][j-1]);\n}\n\ninline int Query(int l,int r)\n{\n\tint t=Log[r-l+1];\n\treturn (a[st[l][t]]<=a[st[r-(1<<t)+1][t]])?st[l][t]:st[r-(1<<t)+1][t];\n}\n\t\nint main()\n{\n\tint n;\n\tcin>>n;\n\tinit(2*n);\n\tfor(int i=1;i<=n;i++)cin>>a[i],a[i+n]=a[i];\n\tfor(int i=1;i<=n+n;i++)a[i]=max(i-a[i],1);//\u9884\u5904\u7406\uff0c\u51cf\u5c11\u4ee3\u7801\u957f\u5ea6\u3002\n\tBuild(2*n);\n\tint ans=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint l=a[i+n-1],r=i+n-1,cnt=1;//\u5982\u679c l<i \u76f4\u63a5\u4ece\u8d77\u70b9\u53d1\u9001\uff0c\u5148\u628a 1 \u52a0\u4e0a\n\t\twhile(i<l)\n\t\t{\n\t\t\tint t=Query(l,r-1);l=a[t],r=t;//\u67e5\u8be2\uff0c\u66f4\u65b0\n\t\t\tcnt++;\n\t\t}\n        ans+=cnt;\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1679215859,
        "uid": 718740,
        "name": "xiaohaoaibiancheng66",
        "ccfLevel": 5,
        "title": "CF207B2 Military Trainings \u9898\u89e3"
    }
]