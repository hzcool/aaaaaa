[
    {
        "content": "# \u8bf7\u5230\u535a\u5ba2\u4e2d\u67e5\u770b\n\n> [CF553E Kyoya and Train](https://codeforces.com/contest/553/problem/E)\n\n## \u9898\u610f\n\n- \u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u65e0\u91cd\u8fb9\u65e0\u81ea\u73af\u7684\u6709\u5411\u56fe\uff0c\u4f60\u8981\u4ece $1$ \u53f7\u70b9\u5230 $n$ \u53f7\u70b9\u53bb\u3002\n- \u5982\u679c\u4f60\u5728 $t$ \u65f6\u523b\u4e4b\u540e\u5230\u8fbe $n$ \u53f7\u70b9\uff0c\u4f60\u8981\u4ea4 $x$ \u5143\u7684\u7f5a\u6b3e\u3002\n- \u6bcf\u6761\u8fb9\u4ece $a_i$ \u5230 $b_i$\uff0c\u8d70\u8fc7\u5b83\u9700\u8981\u82b1\u8d39 $c_i$ \u5143\uff0c\u591a\u6b21\u8d70\u8fc7\u540c\u4e00\u6761\u8fb9\u9700\u8981\u591a\u6b21\u82b1\u8d39\u3002\n- \u8d70\u8fc7\u6bcf\u6761\u8fb9\u6240\u9700\u7684\u65f6\u95f4\u662f\u968f\u673a\u7684\uff0c\u5bf9\u4e8e $k \\in [1,t]$\uff0c$\\frac{p_{i,k}}{10^5}$ \u8868\u793a\u8d70\u8fc7\u7b2c $i$ \u6761\u8fb9\u9700\u8981\u65f6\u95f4 $k$ \u7684\u6982\u7387\u3002\u56e0\u6b64\u5982\u679c\u591a\u6b21\u8d70\u8fc7\u540c\u4e00\u6761\u8fb9\uff0c\u6240\u9700\u7684\u65f6\u95f4\u4e5f\u53ef\u80fd\u4e0d\u540c\u3002\n- \u4f60\u5e0c\u671b\u82b1\u8d39\u5c3d\u53ef\u80fd\u5c11\u7684\u94b1\uff08\u82b1\u8d39\u4e0e\u7f5a\u6b3e\u4e4b\u548c\uff09\u5230\u8fbe $n$ \u53f7\u70b9\uff0c\u56e0\u6b64\u6bcf\u5230\u8fbe\u4e00\u4e2a\u70b9\uff0c\u4f60\u53ef\u80fd\u4f1a\u66f4\u6539\u539f\u6709\u7684\u8ba1\u5212\u3002\n- \u6c42\u5728\u6700\u4f18\u51b3\u7b56\u4e0b\uff0c\u4f60\u671f\u671b\u82b1\u8d39\u7684\u94b1\u6570\u3002\n- $n \\le 50$\uff0c$m \\le 100$\uff0c$t \\le 2 \\times 10^4$\uff0c$x,c_i \\le 10^6$\uff0c$\\sum_{k=1}^t p_{i,k} = 10^5$\uff0c\u7b54\u6848\u7cbe\u5ea6\u8bef\u5dee $\\le 10^{-6}$\u3002\n\n## \u9898\u89e3\n\n\u9996\u5148\u7ed9\u51fa\u66b4\u529b dp \u7684\u5f62\u5f0f\uff1a\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u5230\u70b9 $i$ \u4e14\u5df2\u7ecf\u8fc7\u53bb $j$ \u65f6\u95f4\u540e\uff0c\u5728\u6700\u4f18\u51b3\u7b56\u4e0b\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u5219\u6211\u4eec\u7684\u76ee\u6807\u5373\u4e3a $f_{1,0}$\u3002\n\n\u8f6c\u79fb\u5982\u4e0b\uff1a\n$$\nf_{i,j} =\n\\begin{cases}0 & i = n, j \\le t \\\\\nx & i = n, j > t \\\\\n\\operatorname{dist}(i, n) + x & i \\ne n, j \\ge t \\\\\n\\min_{a_k = i} \\left(\\sum_{l=1}^t p_{k,l}f_{b_k,j+l} + c_k\\right) & i \\ne n, j < t \\\\\n\\end{cases}\n$$\n\n\u5176\u4e2d $\\operatorname{dist}(x,y)$ \u8868\u793a $x \\to y$ \u7684\u6700\u5c0f\u82b1\u8d39\u3002\n\n\u8003\u8651\u8fd9\u4e2a dp \u7684\u6b63\u786e\u6027\uff0c\u7531\u4e8e\u8f6c\u79fb\u65f6 $j$ \u4e25\u683c\u53d8\u5c0f\uff0c\u56e0\u6b64\u8fd9\u4e2a dp \u5b9e\u9645\u4e0a\u662f\u4e2a DAG\u3002\n\n\u76f4\u63a5\u505a\u7684\u8bdd\uff0c\u603b\u8f6c\u79fb\u6570\u662f $\\mathcal O(mt)$ \u7684\uff0c\u6bcf\u6b21\u8f6c\u79fb\u9700\u8981 $\\mathcal O(t)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(mt^2)$\uff0c\u663e\u7136\u4e0d\u591f\u4f18\u79c0\u3002\n\n\u6ce8\u610f\u5230 $\\sum_{l=1}^t p_{k,l}f_{b_k,j+l}$ \u662f\u4e00\u4e2a\u5377\u79ef\uff0c\u8003\u8651\u5206\u6cbb FFT \u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u4e3a $\\mathcal O(mt\\log^2 t)$\u3002\n\n\u53e6\u5916\uff0c\u5728\u7b97 $\\operatorname{dist}(x,y)$ \u7684\u65f6\u5019\u53ef\u4ee5 Floyd\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^3)$\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5177\u4f53\u6765\u5b9e\u73b0\u4e00\u4e0b\u5206\u6cbb FFT\uff0c\u9996\u5148\u5904\u7406\u51fa $f_{*,t\\dots 2t-1}$ \u548c $f_{n,*}$\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u53ef\u4ee5\u5148\u53bb\u6389 $n$ \u7684\u6240\u6709\u51fa\u8fb9\u3002\n\n\u518d\u8bbe $g_{i,j}$ \u8868\u793a\u5728\u65f6\u523b $j$ \u9009\u62e9\u8d70\u7b2c $i$ \u6761\u8fb9\u4ee5\u53ca\u4e4b\u540e\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u5219\u6709 $f_{a_i,j} \\leftarrow g_{i,j}$\u3002\n\n\u5bf9\u4e8e $g_{*,l\\dots r}$\uff0c\u6211\u4eec\u5148\u8ba1\u7b97 $g_{*,mid+1\\dots r}$ \u5e76\u6c42\u51fa $f_{*,mid+1\\dots r}$\uff0c\u518d\u8003\u8651 $f_{*,mid+1\\dots r}$ \u5bf9 $g_{*,l\\dots mid}$ \u7684\u8d21\u732e\uff0c\u6700\u540e\u8ba1\u7b97 $g_{*,l\\dots mid}$\u3002\n\n\u8003\u8651\u5bf9\u4e8e $x \\in [l,mid],i \\in [1,m]$\uff0c\u8bbe $y = b_i$\uff0c$f_{y,mid+1\\dots r}$ \u5bf9 $g_{i,x}$ \u7684\u8d21\u732e\u4e3a\uff1a\n$$\n\\sum_{j=mid+1}^{r} p_{i,j-x}f_{y,j}\n$$\n\u8bbe $a_j = p_{i,j+1},b_j=f_{y,r-j}$\uff0c\u5219\u8f6c\u5316\u4e3a\uff1a\n$$\n\\sum_{j=0}^{r-mid-1} a_{j+mid-x}b_{r-mid-1-j}\n$$\nFFT \u5373\u53ef\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u6211\u4eec CDQ \u5206\u6cbb\u7684\u65f6\u5019\u53ea\u5206\u6cbb $0\\sim t - 1$\uff0c\u56e0\u6b64 $t \\sim 2t-1$ \u7684\u8d21\u732e\u9700\u8981\u5148\u989d\u5916\u8ba1\u7b97\uff0c\u8fd9\u90e8\u5206\u5e76\u4e0d\u4f1a\u5f71\u54cd\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n\u5f53\u7136\uff0c\u8fd8\u53ef\u4ee5\u5206\u6cbb $0\\sim 2t-1$\uff0c\u4f46\u662f\u5728\u7b2c\u4e00\u5c42\u5206\u6cbb\u65f6\u8df3\u8fc7\u8ba1\u7b97 $f_{mid+1 \\dots r}$ \u5373\u53ef\u3002\n\n## \u4ee3\u7801\n\n```cpp\nnamespace FFT {\n\tconst int N = 1 << 21 | 1;\n\tconst double PI = acos(-1);\n\tstruct I {\n\t\tdouble x, y;\n\t\tinline I() {}\n\t\tinline I(double x, double y) : x(x), y(y) {}\n\t\tinline I &operator = (int o) { return x = o, y = 0, *this; }\n\t\tinline I &operator = (double o) { return x = o, y = 0, *this; }\n\t\tinline I operator + (const I o) const { return I(x + o.x, y + o.y); }\n\t\tinline I operator - (const I o) const { return I(x - o.x, y - o.y); }\n\t\tinline I operator * (const I o) const {\n\t\t\treturn I(x * o.x - y * o.y, x * o.y + y * o.x);\n\t\t}\n\t} a[N], b[N];\n\tinline void rd(I &x) { int o; ::rd(o), x = o; }\n\tinline void print(I x, char k = '\\n') { ::print((int)(x.x + 0.5), k); }\n\tint n, m, k, l, r[N];\n\tinline void fft(I *a, int n, int x) {\n\t\tfor (int i = 0; i < n; i++) if (i < r[i]) swap(a[i], a[r[i]]);\n\t\tfor (int o = 2, k = 1; o <= n; o <<= 1, k <<= 1) {\n\t\t\tI W = I(cos(PI / k), x * sin(PI / k));\n\t\t\tfor (int i = 0; i < n; i += o) {\n\t\t\t\tI w = I(1, 0);\n\t\t\t\tfor (int j = 0; j < k; j++, w = w * W) {\n\t\t\t\t\tI x = a[i+j], y = w * a[i+j+k];\n\t\t\t\t\ta[i+j] = x + y, a[i+j+k] = x - y;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tinline void solve() {\n\t\tk = 1, l = 0;\n\t\twhile (k <= n + m) k <<= 1, ++l;\n\t\tfor (int i = 0; i < k; i++)\n\t\t\tr[i] = (r[i>>1] >> 1) | ((i & 1) << (l - 1));\n\t\tfor (int i = n + 1; i < k; i++) a[i] = 0;\n\t\tfor (int i = m + 1; i < k; i++) b[i] = 0;\n\t\tfft(a, k, 1), fft(b, k, 1);\n\t\tfor (int i = 0; i < k; i++) a[i] = a[i] * b[i];\n\t\tfft(a, k, -1);\n\t\tfor (int i = 0; i <= n + m; i++) a[i].x /= k;\n\t}\n}\n\nconst int N = 53, M = 107, T = 2e4 + 7;\nconst double inf = 1e18;\nint n, m, t, x, a[M], b[M];\ndouble d[N][N], c[M], p[M][T*2], f[N][T*2], g[M][T];\n\nvoid cdq(int l, int r) {\n\tif (l == t) return;\n\tif (l == r) {\n\t\tfor (int i = 1; i < n; i++) f[i][l] = inf;\n\t\tfor (int i = 1; i <= m; i++)\n\t\t\tif (a[i] != n) f[a[i]][l] = min(f[a[i]][l], g[i][l] + c[i]);\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tcdq(mid + 1, r);\n\tFFT::n = r - l - 1, FFT::m = r - mid - 1;\n\tfor (int i = 1; i <= m; i++)\n\t\tif (a[i] != n) {\n\t\t\tfor (int j = 0; j <= FFT::n; j++) FFT::a[j] = p[i][j+1];\n\t\t\tfor (int j = 0; j <= FFT::m; j++) FFT::b[j] = f[b[i]][r-j];\n\t\t\tFFT::solve();\n\t\t\tfor (int j = l; j <= mid; j++) g[i][j] += FFT::a[r-j-1].x;\n\t\t}\n\tcdq(l, mid);\n}\n\nint main() {\n\trd(n), rd(m), rd(t), rd(x);\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\tif (i != j) d[i][j] = inf;\n\tfor (int i = 1, x; i <= m; i++) {\n\t\trd(a[i]), rd(b[i]), rd(x), c[i] = d[a[i]][b[i]] = x;\n\t\tfor (int j = 1; j <= t; j++) rd(x), p[i][j] = x / 1e5;\n\t}\n\tfor (int k = 1; k <= n; k++)\n\t\tfor (int i = 1; i <= n; i++)\n\t\t\tfor (int j = 1; j <= n; j++)\n\t\t\t\td[i][j] = min(d[i][j], d[i][k] + d[k][j]);\n\tfor (int i = 0; i < 2 * t; i++) f[n][i] = i <= t ? 0 : x;\n\tfor (int i = 1; i < n; i++)\n\t\tfor (int j = t; j < 2 * t; j++)\n\t\t\tf[i][j] = d[i][n] + x;\n\tcdq(0, 2 * t - 1);\n\tprintf(\"%.10f\\n\", f[1][0]);\n\treturn 0;\n}\n```\n\n$\\textstyle$",
        "postTime": 1581004269,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF553E \u3010Kyoya and Train\u3011"
    },
    {
        "content": "\u6807\u7b7e: \u5206\u6cbbFFT.\n\n\u534a\u5e74\u524d\u6211\u505a\u8fd9\u9053\u9898, \u6298\u622c\u6c89\u6c99. \u534a\u5e74\u540e, \u6211\u4ece\u5012\u4e0b\u7684\u5730\u65b9\u722c\u8d77.\n\n\u6211\u6210\u529f\u4e86, \u6211\u5df2\u7ecf\u4e0d\u518d\u662f\u4ee5\u524d\u7684\u90a3\u4e2a\u6211\u4e86.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/q8w84rck.png)\n\n\u597d\u5427\u4ece\u4ee3\u7801\u957f\u5ea6\u53ef\u4ee5\u770b\u51fa\u6765, \u5176\u5b9e\u6211\u53ea\u662f\u628a\u4ee5\u524d\u7684\u4ee3\u7801\u6539\u4e86\u4e00\u70b9\u5c31\u8fc7\u4e86...\n\n\u8fd9\u91cc\u987a\u4fbf\u7ed9\u8bf8\u4f4d\u63d0\u4e2a\u9192, myy\u7684\u90a3\u4e2a\u4e24\u904dfft\u5f53\u4e00\u904d\u505a\u7684\u5c0ftrick\u4f1a\u7206\u7cbe\u5ea6, \u4e24\u884c\u6cea.jpg(\u7136\u9e45\u4e5f\u6709\u53ef\u80fd\u662f\u6211\u81ea\u5df1\u5199\u9519\u4e86, \u5982\u679c\u6709\u4f7f\u7528\u4e86\u8fd9\u4e2atrick\u7684\u670b\u53cb\u5374\u6ca1\u6709\u7206\u7cbe\u5ea6, \u8bf7\u52a1\u5fc5\u8054\u7cfb\u6211).\n\n\u597d\u5427\u5f00\u59cb\u8bb2\u7b97\u6cd5.\n\n### Part 1\n\n\u8bbe $f_{u,j}$ \u8868\u793a\u73b0\u5728 $u$ \u70b9, \u5df2\u7ecf\u8017\u65f6 $j$ , \u5230\u8fbe $n$ \u70b9\u7684\u6700\u5c0f\u671f\u671b\u8d39\u7528.\n\n\u901a\u8fc7\u679a\u4e3e\u8d70 $u$ \u7684\u90a3\u4e2a\u540e\u7ee7\u8282\u70b9\u53ef\u4ee5\u8f7b\u677e\u8f6c\u79fb: $f_{u,j}=\\min_v(w_{(u,v)}+\\sum_{k=1}^t p_{(u,v),k}\\times f_{v,j+k})$, \u5176\u4e2d $w_{(u,v)}$ \u8868\u793a\u8fb9 $(u,v)$ \u7684\u8d39\u7528, $p_{(u,v),k}$ \u8868\u793a\u8fb9 $(u,v)$ \u8017\u65f6\u4e3a $k$ \u7684\u6982\u7387.\n\n\u8fb9\u754c\u6761\u4ef6\u662f $\\forall j>t, f_{u,j}=dis_u+x$, \u5373\u5982\u679c\u5230 $u$ \u70b9\u65f6\u5df2\u7ecf\u8d85\u8fc7\u9650\u5b9a\u65f6\u95f4, \u5c31\u8d70\u8d39\u7528\u6700\u4f4e($dis_u$)\u7684\u8def\u5f84\u53bb $n$ \u70b9.\n\n\u6709\u4e0e\u8f6c\u79fb\u65f6 $f$ \u7684\u7b2c\u4e8c\u7ef4\u662f\u5fc5\u7136\u589e\u52a0\u7684, \u6240\u4ee5\u8f6c\u79fb\u662f\u4e00\u4e2a DAG , \u66b4\u529b\u8f6c\u79fb\u53ef\u505a\u5230 $\\mathcal O(nmt^2)$ , \u4e0d\u591f \u4f18\u79c0, \u9700\u8981\u4f18\u5316.\n\n### Part 2\n\n\u5728\u4e0a\u4e00\u4e2a `Part` \u6211\u4eec\u6ce8\u610f\u5230 $f$ \u7684\u7b2c\u4e8c\u7ef4\u662f\u589e\u52a0\u7684, \u5e76\u4e14\u6211\u4eec\u6ce8\u610f\u5230\u8f6c\u79fb\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f, \u5bb9\u6613\u60f3\u5230\u4f7f\u7528\u5206\u6cbb FFT \u6765\u4f18\u5316\u590d\u6742\u5ea6.\n\n\u5177\u4f53\u7684, \u8bb0 $g_{(u,v),j}=\\sum_{k=1}^t p_{(u,v),k}\\times f_{v,j+k}$ , \u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u53ef\u4ee5\u5206\u6cbb FFT. \n\n\u66f4\u5177\u4f53\u7684, \u6211\u4eec\u901a\u8fc7\u5206\u6cbb FFT \u7528 $f$ \u6765\u66f4\u65b0 $g$ , \u5e76\u5728\u5206\u6cbb\u7684\u5e95\u5c42\u7528 $g$ \u6765\u8ba1\u7b97\u51fa $f$ ($f_{u,j}=\\min_v(w_{(u,v)}+g_{(u,v)})$).\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(mt\\log^2 t)$.\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst double pi = acos(-1);\nint read();\nint n, m, t, X;\nint ol, rtt[20][70004];\n\nstruct C {\n    double x, y;\n    C operator+(C a) { return (C){x + a.x, y + a.y}; }\n    C operator-(C a) { return (C){x - a.x, y - a.y}; }\n    C operator*(C a) { return (C){x * a.x - y * a.y, x * a.y + y * a.x}; }\n    C operator*(double a) { return (C){x * a, y * a}; }\n    C conj() { return (C){x, -y}; }\n};\n\ndouble f[102][70004], g[202][70004], p[202][70004];\nstruct Poly {\n    C x[70004];\n    C& operator[](int p) { return x[p]; }\n} x, y, O, P;\n\nint u[202], v[202], w[202];\nint dis[102], inq[102];\nqueue<int> q;\n\nint head[102], nxt[202], to[202], cnt;\nvoid add(int f, int t) { nxt[++cnt] = head[f], head[f] = cnt, to[cnt] = t; }\n\nvoid spfa() {\n    q.push(n), inq[n] = 1;\n    for (int i = 1; i < n; ++i) dis[i] = 100000008;\n    while (!q.empty()) {\n        int u = q.front();\n        q.pop(), inq[u] = 0;\n        for (int i = head[u]; i; i = nxt[i]) {\n            int v = to[i];\n            if (dis[v] <= dis[u] + w[i]) continue;\n            dis[v] = dis[u] + w[i];\n            if (!inq[v]) q.push(v), inq[v] = 1;\n        }\n    }\n    return;\n}\n\nvoid ckmin(double& x, double y) { x = x < y ? x : y; }\n\nvoid getrtt() {\n    ol = 2;\n    for (int w = 1; ol < 2 * t; ++w, ol <<= 1)\n        for (int i = 1; i < ol; ++i)\n            rtt[w][i] = rtt[w][i >> 1] >> 1 | ((i & 1) << (w - 1));\n    ol >>= 1;\n    for (int i = 0; i < ol; ++i)\n        O[i] = (C){cos(2 * pi / ol * i), sin(2 * pi / ol * i)};\n    return;\n}\n\nvoid dft(Poly& x, int w, int len) {\n    for (int i = 1; i < len; ++i)\n        if (rtt[w][i] > i) swap(x[i], x[rtt[w][i]]);\n    for (int l = 2; l <= len; l <<= 1) {\n        int m = l >> 1;\n        C Om = O[ol / l], tO;\n        for (int i = 0; i < len; i += l) {\n            tO = (C){1, 0};\n            for (int j = i; j < i + m; ++j, tO = tO * Om) {\n                C t = tO * x[j + m];\n                x[j + m] = x[j] - t, x[j] = x[j] + t;\n            }\n        }\n    }\n}\n\nvoid idft(Poly& x, int w, int len) {\n    dft(x, w, len), reverse(x.x + 1, x.x + len);\n}\n\nvoid work(int l, int r) {\n    if (l == r) {\n        for (int i = 1; i <= m; ++i) ckmin(f[u[i]][l], g[i][l]);\n        return;\n    }\n    int mid = l + r >> 1;\n    work(mid + 1, r);\n    int lx = r - mid, ly = r - l, len = 2, w = 1;\n    while (len < ly) len <<= 1, ++w;\n    for (int i = 1; i <= m; ++i) {\n        for (int j = 0; j < lx; ++j) x[j].x = f[v[i]][j + mid + 1], x[j].y = 0;\n        for (int j = 0; j < ly; ++j) y[j].x = p[i][j + t + l - r], y[j].y = 0;\n        for (int j = lx; j < len; ++j) x[j] = (C){0, 0};\n        for (int j = ly; j < len; ++j) y[j] = (C){0, 0};\n\n        dft(x, w, len), dft(y, w, len);\n        for (int j = 0; j < len; ++j) x[j] = x[j] * y[j];\n        idft(x, w, len);\n\n        for (int j = l; j <= mid; ++j)\n            g[i][j] += x[j + r - l - mid - 1].x / len;\n    }\n    work(l, mid);\n    return;\n}\n\nint main() {\n    n = read(), m = read(), t = read(), X = read();\n    for (int i = 1; i < n; ++i)\n        for (int j = 0; j <= t; ++j) f[i][j] = 200000000;\n\n    for (int i = 1; i <= m; ++i) {\n        u[i] = read(), v[i] = read(), w[i] = read();\n        add(v[i], u[i]);\n        for (int j = 1; j <= t; ++j) p[i][j] = 1.0 * read() / 100000;\n        reverse(p[i], p[i] + t + 1);\n        for (int j = 1; j <= t; ++j) g[i][j] = g[i][j - 1] + p[i][j - 1];\n    }\n    spfa();\n    for (int i = 1; i <= m; ++i)\n        for (int j = 0; j <= t; ++j) g[i][j] = g[i][j] * (dis[v[i]] + X) + w[i];\n\n    getrtt(), work(0, t);\n    printf(\"%.6lf\\n\", min(f[1][0], 0.0 + dis[1] + X));\n    return 0;\n}\n\nint read() {\n    int x = 0, f = 1;\n    char c = getchar();\n    while (c < '0' || c > '9') f = (c == '-') ? -1 : f, c = getchar();\n    while (c >= '0' && c <= '9') x = x * 10 + c - '0', c = getchar();\n    return x * f;\n}\n```\n\n",
        "postTime": 1579144357,
        "uid": 51237,
        "name": "Kinandra",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF553E \u3010Kyoya and Train\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u4e3a\u4e86\u8868\u8ff0\u65b9\u4fbf\uff0c\u4ee5\u4e0b\u6240\u8ff0$p_{i,k}$\u5747\u4e3a\u539f\u9898\u4e2d\u7684$\\frac{p_{i,k}}{100000}$\n\n\u7ed9\u5b9a\u4e00\u4e2a$n$\u4e2a\u70b9$m$\u6761\u8fb9\u6709\u5411\u56fe\uff0c\u7b2c$i$\u6761\u8fb9\u6709\u8fb9\u6743$c_i$\uff0c\u53ef\u80fd\u7684\u82b1\u8d39\u65f6\u95f4\u4e3a$[1,t]$\uff0c\u4e14\u82b1\u8d39$k$\u65f6\u95f4\u7684\u6982\u7387\u662f$p_{i,k}$\u3002\n\n\u4e00\u4e2a\u4eba\u4ece$1$\u5230$n$\uff0c\u5982\u679c\u5230\u8fbe\u65f6\u95f4\u8d85\u8fc7$T$\uff0c\u5219\u9700\u8981\u989d\u5916\u7f34\u7eb3$X$\u7684\u82b1\u8d39\uff0c\u6c42\u671f\u671b\u6700\u5c0f\u82b1\u8d39\u3002\n\n$\\texttt{Data Range:}2\\leq n\\leq 50,1\\leq m\\leq 100,1\\leq t\\leq 2\\times 10^4,0\\leq x,c_i\\leq 10^6$\n\n### \u9898\u89e3\n\n![](https://s2.ax1x.com/2019/12/02/QnUEgx.jpg)\n\n\u5728\u4f60\u8c37 AC \u7684\u7b2c$1111$\u9053\u9898\u76ee\uff0c\u5e76\u4e14\u5728\u51cc\u6668\u4e4b\u524d\u505a\u5b8c\u4e86\uff0c\u5199\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\u5462qwq\u3002\n\n\u795e\u4ed9\u4eec\u90fd\u662f\u4ece\u4e0a\u5f80\u4e0b\u505a\u7684\uff0c\u53ea\u6709\u6211\u4e00\u4e2a\u83dc\u9e21\u4ece\u4e0b\u5f80\u4e0a\uff0c\u800c\u4e14$\\texttt{CF1184A3}$\u8fd8\u88ab\u9898\u610f\u6740\u4e86\u3002\n\n\u7b2c\u4e00\u6b21\u505a$\\texttt{3300}$\u7684\u9898\u76ee\u5462\uff0c\u800c\u4e14\u8fd8\u662f$\\texttt{myy}$\u7684\u8bba\u6587\u9898\uff0c\u8fd8\u662f\u6bd4\u8f83\u96be\u7684\u3002\n\n~~\u8fd8\u662f\u795d\u6211\u80fd\u4e0a$\\color{blue}\\texttt{Expert}$\u5427qwq~~\n\n\u4e00\u9053\u5206\u6cbb$\\texttt{FFT}$\u597d\u9898\u3002\uff08~~\u4f46\u662f\u8fd9\u8fd8\u662f\u65e0\u6cd5\u63a9\u76d6\u81ea\u5df1\u7b2c\u4e00\u6b21\u5199\u5206\u6cbb$\\texttt{FFT}$\u7684\u73b0\u5b9e~~\uff09\n\n\u4f17\u6240\u5468\u77e5\u6211\u4eec\u53ef\u4ee5\u5148$\\texttt{dp}$\uff0c\u8bbe$dp_{i,j}$\u8868\u793a\u5230\u8fbe$i$\u7684\u65f6\u95f4\u4e3a$j$\u7684\u6700\u5c0f\u82b1\u8d39\uff0c$P_{e,t}$\u4e3a\u8d70\u8fb9$e$\u82b1\u8d39\u65f6\u95f4$t$\u7684\u6982\u7387\u3002\u5bf9\u4e8e\u67d0\u4e00\u4e2a\u70b9$x$\uff0c\u679a\u4e3e\u5b83\u7684\u51fa\u8fb9$e_i=(x,y_i)$\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\u8f6c\u79fb\u4e3a\n\n$$dp_{x,t}=\\min\\{c_i+\\sum_{j=1}^{T}P_{e_i,j}dp_{y_i,t+j}\\}$$\n\n\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u8f6c\u79fb\u6210\u7acb\u5462\uff1f\u6211\u4eec\u8003\u8651\u628a\u56fe\u770b\u6210\u4e00\u4e2a\u4ee5\u65f6\u95f4\u4e3a\u5c42\u6570\u7684\u5206\u5c42\u56fe\uff0c\u9898\u76ee\u4fdd\u8bc1\u4e86\u4e00\u4e2a\u70b9\u518d\u4e5f\u4e0d\u80fd\u56de\u5230\u5b83\u7684\u7956\u5148\uff08\u9664\u975e\u7ecf\u8fc7\u65f6\u95f4\u4e3a\u8d1f\u6570\uff09\uff0c\u6240\u4ee5\u8fd9\u5f20\u5206\u6210\u56fe\u662f\u4e2a$\\texttt{DAG}$\uff0c\u5c31\u53ef\u4ee5\u505a\u4e86\u3002\n\n\u7136\u540e\u4f60\u4f1a\u53d1\u73b0\u72b6\u6001$O(mT)$\uff0c\u8f6c\u79fb$O(T)$\uff0c\u563f\u563f\uff0c\u7ed3\u679c\u53ef\u60f3\u800c\u77e5\u3002\n\n\u6211\u4eec\u6765\u8bbe\u4e00\u4e2a$g_{e,t}=c_e+\\sum_{j=1}^{T}P_{e,j}dp_{y_e,t+j}$\uff0c\u518d\u6765\u8bbe\u4e00\u4e2a$f_{e,T+t}=g_{e,T}$\uff0c\u4e8e\u662f\u6211\u4eec\u6709\n\n$$f_{e,T+t}=c_e+\\sum_{j=1}^{T}P_{e,j}dp_{y_e,t+j}$$\n\n\u8003\u8651\u7ffb\u8f6c$P$\uff0c\u5047\u8bbe\u5f97\u5230$Q$\uff0c\u5219\n\n$$f_{e,T+t}=c_e+\\sum_{j=1}^{T}Q_{e,T-j}dp_{y_e,t+j}$$\n\n\u566b\uff0c\u6210\u4e86\uff01\u51fa\u73b0\u5377\u79ef\u5f62\u5f0f\uff0c\u4f46\u662f\u8fd9\u6837\u8fc7\u4e0d\u4e86\uff0c\u56e0\u4e3a\u53f3\u8fb9\u4e0e\u65f6\u95f4\u6709\u5173\uff0c\u600e\u4e48\u529e\u5462\uff1f\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5bf9\u65f6\u95f4\u5206\u6cbb\u3002\n\n~~\u8fd9\u91cc\u7ed9\u4e00\u4e2a\u6052\u7b49\u5f0f~~\n\n$$\\sum\\limits_{i=0}^{n}f_ig_{n-i}=\\sum\\limits_{i=0}^{p}f_ig_{n-i}+\\sum\\limits_{i=p+1}^{n}f_ig_{n-i}$$\n\n\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u62c6\u5f00\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u9ad8\u9ad8\u5174\u5174\u4e0a\u5206\u6cbb$\\texttt{FFT}$\u4e86\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<vector>\n#pragma GCC optimize(2)\n#pragma GCC optimize(3)\n#pragma GCC optimize(\"Ofast\")\nusing namespace std;\ntypedef int ll;\ntypedef double db;\nconst ll MAXN=2e5+51;\nconst db PI=acos(-1.0);\nstruct Complex{\n\tdb re,im;\n\tComplex(db x=0,db y=0)\n\t{\n\t\tthis->re=x,this->im=y;\n\t}\n};\nstruct Edge{\n\tll from,to,dist;\n};\nComplex f[MAXN],g[MAXN];\nEdge ed[MAXN];\nll nc,ec,t,x;\nll rev[MAXN];\ndb p[110][MAXN],dis[111][111],dp[111][40051],dp2[111][40051];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n} \ninline Complex operator +(Complex x,Complex y)\n{\n\treturn Complex(x.re+y.re,x.im+y.im);\n}\ninline Complex operator -(Complex x,Complex y)\n{\n\treturn Complex(x.re-y.re,x.im-y.im);\n}\ninline Complex operator *(Complex x,Complex y)\n{\n\treturn Complex(x.re*y.re-x.im*y.im,x.re*y.im+x.im*y.re);\n}\ninline Complex operator /(Complex x,db y)\n{\n\treturn Complex(x.re/y,x.im/y);\n}\ninline void FFT(Complex *cp,ll cnt,ll inv)\n{\n\tll cur=0;\n\tComplex res,omg;\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\tif(i<rev[i])\n\t\t{\n\t\t\tswap(cp[i],cp[rev[i]]);\n\t\t}\n\t}\n\tfor(register int i=2;i<=cnt;i<<=1)\n\t{\n\t\tcur=i>>1,res=Complex(cos(2*PI/i),inv*sin(2*PI/i));\n\t\tfor(register Complex *p=cp;p!=cp+cnt;p+=i)\n\t\t{\n\t\t\tomg=Complex(1,0);\n\t\t\tfor(register int j=0;j<cur;j++)\n\t\t\t{\n\t\t\t\tComplex t=omg*p[j+cur],t2=p[j];\n\t\t\t\tp[j+cur]=t2-t,p[j]=t+t2;\n\t\t\t\tomg=omg*res;\n\t\t\t}\n\t\t}\n\t}\n\tif(inv==-1)\n\t{\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\tcp[i]=cp[i]/cnt;\n\t\t}\n\t}\n}\ninline void calc(ll l,ll r)\n{\n\tll mid=(l+r)>>1,cnt,limit;\n\tfor(register int j=1;j<=ec;j++)\n\t{\n\t\tcnt=1,limit=-1;\n\t\twhile(cnt<=((r<<1)-l-mid-1))\n\t\t{\n\t\t\tcnt<<=1,limit++;\n\t\t}\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t\t\tf[i]=g[i]=Complex(0,0);\n\t\t}\n\t\tfor(register int i=mid+1;i<=r;i++)\n\t\t{\n\t\t\tf[i-mid-1].re+=dp[ed[j].to][i];\n\t\t}\n\t\tfor(register int i=1;i<=r-l;i++)\n\t\t{\n\t\t\tg[r-l-i].re+=p[j][i];\n\t\t}\n\t\tFFT(f,cnt,1),FFT(g,cnt,1);\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\tf[i]=f[i]*g[i];\n\t\t}\n\t\tFFT(f,cnt,-1);\n\t\tfor(register int i=l;i<=mid;i++)\n\t\t{\n\t\t\tdp2[j][i]+=f[i-mid-1+r-l].re;\n\t\t}\n\t}\n}\ninline void cdqFFT(ll l,ll r)\n{ \n\tif(l==r)\n\t{\n\t\tfor(register int i=1;i<=ec;i++)\n\t\t{\n\t\t\tdp[ed[i].from][l]=min(dp[ed[i].from][l],dp2[i][l]+ed[i].dist);\n\t\t}\n\t\treturn;\n\t}\n\tll mid=(l+r)>>1;\n\tcdqFFT(mid+1,r),calc(l,r),cdqFFT(l,mid);\n}\nint main()\n{\n\tnc=read(),ec=read(),t=read(),x=read();\n\tfor(register int i=1;i<=nc;i++)\n\t{\n\t\tfor(register int j=1;j<=nc;j++)\n\t\t{\n\t\t\tdis[i][j]=i^j?1061109567.0:0;\n\t\t}\n\t}\n\tfor(register int i=1;i<=ec;i++)\n\t{\n\t\ted[i].from=read(),ed[i].to=read(),ed[i].dist=read();\n\t\tdis[ed[i].from][ed[i].to]=min(dis[ed[i].from][ed[i].to],1.0*ed[i].dist);\n\t\tfor(register int j=1;j<=t;j++)\n\t\t{\n\t\t\tp[i][j]=read()/100000.0;\n\t\t}\n\t}\n\tfor(register int k=1;k<=nc;k++)\n\t{\n\t\tfor(register int i=1;i<=nc;i++)\n\t\t{\n\t\t\tfor(register int j=1;j<=nc;j++)\n\t\t\t{\n\t\t\t\tdis[i][j]=min(dis[i][j],dis[i][k]+dis[k][j]);\n\t\t\t}\n\t\t}\n\t}\n\tfor(register int i=0;i<=(t<<1);i++)\n\t{\n\t\tdp[nc][i]=i<=t?0:x;\n\t}\n\tfor(register int i=1;i<nc;i++)\n\t{\n\t\tfor(register int j=0;j<=(t<<1);j++)\n\t\t{\n\t\t\tdp[i][j]=(j<=t)?0x3f3f3f3f:dis[i][nc]+x; \n\t\t}\n\t}\n\tcalc(1,t<<1),cdqFFT(0,t);\n\tprintf(\"%.10lf\\n\",dp[1][0]);\n}\n```",
        "postTime": 1575290014,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF553E \u3010Kyoya and Train\u3011"
    },
    {
        "content": "~~\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u666e\u901aFFT\u5c31\u8fc7\u6389\uff0c\u6ca1\u5fc5\u8981\u7528\u5206\u6cbbFFT\u5440~~\n\n\u6211\u4eec\u4e00\u4e2anaive\u7684\u601d\u8def\u662f\u8bbe $f[i][j]$ \u8868\u793a\u4f60\u6700\u5c11\u8981\u82b1\u591a\u5c11\u94b1\u624d\u80fd\u5728\u65f6\u523b $j$ \u5230\u8fbe\u4f4d\u7f6e $i$\u3002\u4f46\u662f\u8fd9\u4e2a\u8fb9\u754c\u6761\u4ef6\u6ca1\u6709\u5b9a\u4e49\u2014\u2014\u4f60\u548b\u77e5\u9053 $f[1][k](k>0)$ \u8981\u82b1\u591a\u5c11\u94b1\u5462\uff1f\u6309\u7406\u8bf4\u5e94\u8be5\u662f $\\infty$\uff0c\u4f46\u662f\u597d\u50cf\u53c8\u4e0d\u592a\u5bf9\u52b2\u2026\u2026\n\n\u6240\u4ee5\u8bf4\u6211\u4eec\u4ed4\u7ec6\u4e00\u60f3\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u72b6\u6001\u662f\u4e0d\u884c\u6ef4\uff08~~\u6211\u4e00\u5f00\u59cb\u5c31\u5728\u8fd9\u79cd\u601d\u8def\u4e0a\u7ea0\u7ed3\u4e86\u4e00\u665a\u4e0a\u7136\u540e\u6210\u529f\u5d29\u6e83\u770b\u4e86\u9898\u89e3~~\uff09\u3002\u6b63\u96be\u5219\u53cd\uff0c\u6211\u4eec\u8003\u8651\u53cd\u7740\u6765\uff0c\u5373\u8bbe $f[i][j]$ \u8868\u793a\u5f53\u524d\u662f $j$ \u65f6\u523b\u5728\u4f4d\u7f6e $i$\uff0c\u6700\u5c11\u8fd8\u8981\u82b1\u591a\u5c11\u94b1\u624d\u80fd\u5230\u8fbe\u4f4d\u7f6e $n$\u3002\n\n\u6211\u4eec\u8bbe $DIS_i$ \u8868\u793a\u4f4d\u7f6e $i$ \u5230\u4f4d\u7f6e $n$ \u6700\u5c11\u8981\u82b1\u591a\u5c11\u94b1\uff08\u4e0d\u8003\u8651\u901a\u8fc7\u65f6\u95f4\uff09\uff0c\u5219\u663e\u7136\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u4e00\u904dDijkstra\u6c42\u51fa\u3002\u5219\u5bf9\u4e8e $f[i][j](j>t)$\uff0c\u6211\u4eec\u5fc5\u6709 $f[i][j]=DIS_i+x$\uff08$x$ \u662f\u7f5a\u6b3e\uff09\uff0c\u56e0\u4e3a\u53cd\u6b63\u5df2\u7ecf\u8d85\u65f6\u4e86\uff0c\u90a3\u5c31\u8d70\u6700\u5212\u7b97\u7684\u8def\u5427\u3002\n\n\u5219\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u4e00\u6761\u6709\u5411\u8fb9 $(x,y,z)$\uff0c\u5219 $x$ \u53ef\u4ee5\u4ece $y$ \u8f6c\u79fb\u8fc7\u6765\u3002\u8bbe\u5f53\u524d\u8fb9\u7684\u6982\u7387\u6570\u7ec4\u662f $prob$\uff0c\u5219\u6709\n\n$$f[x][k]\\leftarrow z+\\sum\\limits_{j=1}^tprob_j\\times f[y][j+k]$$\n\n\u5176\u4e2d $\\leftarrow$ \u8868\u793a\u53ef\u4ee5\u88ab\u8f6c\u79fb\uff0c\u4e14\u6709 $k\\in[0,t]$\u3002\n\n\u6211\u4eec\u8003\u8651\u7ffb\u8f6c $prob$ \u6570\u7ec4\u3002\u5219\u7ffb\u8f6c\u540e\uff0c\u8f6c\u79fb\u5f0f\u5c31\u53d8\u6210\u4e86\n\n$$f[x][k]\\leftarrow z+\\sum\\limits_{j=1}^tprob_{t-j+1}\\times f[y][j+k]$$\n\n\u53d1\u73b0\u540e\u9762\u662f\u4e2a\u5377\u79ef\uff0c\u4e24\u9879\u7684\u4e0b\u6807\u548c\u6052\u4e3a $t+k+1$\uff0c\u4e8e\u662f\n\n$$f[x][k]\\leftarrow z+(prob\\times f[y])_{t+k+1}$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5FFT\u8f6c\u79fb\u8fa3\u3002\n\n\u7136\u540e\u56e0\u4e3a\u662f\u5728\u56fe\u4e0a\u8f6c\u79fb\uff0c\u800c\u5982\u679c\u7528Dijkstra\u8f6c\u79fb\u7684\u8bdd $f[x]$ \u4e4b\u95f4\u53c8\u6ca1\u6709\u660e\u786e\u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u6545\u8003\u8651\u76f4\u63a5SPFA\uff08\u5f53\u7136SPFA\u5df2\u7ecf\u6b7b\u4e86\uff0c\u4f46\u5c31\u7b97\u5b83\u6b7b\u4e86\u590d\u6742\u5ea6\u4ecd\u7136\u6ca1\u95ee\u9898\uff09\u3002\u5219\u590d\u6742\u5ea6\u4e3a $O(nmt\\log t)$\uff0c\u6ca1\u6709\u5361\u5e38\u5c31\u6392\u5230\u4e86\u9996\u9875\u9760\u524d\u7684\u4f4d\u7f6e\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst double pi=acos(-1);\nconst double eps=1e-10;\nconst int N=200100;\nint n,m,t,pay,head[60],DIS[60];\nstruct edge{\n\tint to,next,val;\n}edge[110];\nvoid ae(int u,int v,int w,int p){\n\tedge[p].next=head[u],edge[p].to=v,edge[p].val=w,head[u]=p;\n}\ndouble prob[110][N],dis[60][N],now[N];\nint rev[N],lim=1,LG;\nstruct cp{\n\tdouble x,y;\n\tcp(double X=0,double Y=0){\n\t\tx=X,y=Y;\n\t}\n\tfriend cp operator +(const cp &u,const cp &v){\n\t\treturn cp(u.x+v.x,u.y+v.y);\n\t}\n\tfriend cp operator -(const cp &u,const cp &v){\n\t\treturn cp(u.x-v.x,u.y-v.y);\n\t}\n\tfriend cp operator *(const cp &u,const cp &v){\n\t\treturn cp(u.x*v.x-u.y*v.y,u.x*v.y+u.y*v.x);\n\t}\n}A[N],B[N];\nvoid FFT(cp *a,int tp){\n\tfor(int i=0;i<lim;i++)if(rev[i]>i)swap(a[rev[i]],a[i]);\n\tfor(int md=1;md<lim;md<<=1){\n\t\tcp rt=cp(cos(pi/md),tp*sin(pi/md));\n\t\tfor(int stp=md<<1,pos=0;pos<lim;pos+=stp){\n\t\t\tcp w=cp(1,0);\n\t\t\tfor(int i=0;i<md;i++,w=w*rt){\n\t\t\t\tcp x=a[pos+i],y=a[pos+md+i]*w;\n\t\t\t\ta[pos+i]=x+y;\n\t\t\t\ta[pos+md+i]=x-y;\n\t\t\t}\n\t\t}\n\t}\n\tif(tp==-1)for(int i=0;i<lim;i++)a[i].x/=lim;\n}\nvoid mul(double *a,double *b,double *c){\n\tfor(int i=0;i<lim;i++)A[i]=B[i]=cp(0,0);\n\tfor(int i=0;i<(lim>>1);i++)A[i]=cp(a[i],0),B[i]=cp(b[i],0);\n\tFFT(A,1),FFT(B,1);\n\tfor(int i=0;i<lim;i++)A[i]=A[i]*B[i];\n\tFFT(A,-1);\n\tfor(int i=0;i<lim;i++)c[i]=A[i].x;\n}\nbool vis[60];\nvoid Dijkstra(){\n\tpriority_queue<pair<int,int> >q;\n\tfor(int i=1;i<=n;i++)DIS[i]=0x3f3f3f3f;\n\tDIS[n]=0,q.push(make_pair(0,n));\n\twhile(!q.empty()){\n\t\tint x=q.top().second;q.pop();\n\t\tif(vis[x])continue;vis[x]=true;\n\t\tfor(int i=head[x],y;i!=-1;i=edge[i].next){\n\t\t\ty=edge[i].to;\n\t\t\tif(DIS[y]>DIS[x]+edge[i].val)DIS[y]=DIS[x]+edge[i].val,q.push(make_pair(-DIS[y],y));\n\t\t}\n\t} \n}\nbool in[60];\nvoid SPFA(){\n\tqueue<int>q;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=0;j<=t;j++)dis[i][j]=0x3f3f3f3f;\n\t\tfor(int j=t+1;j<=2*t;j++)dis[i][j]=DIS[i]+pay;\n\t}\n\tfor(int j=0;j<=t;j++)dis[n][j]=0;\n\tq.push(n),in[n]=true;\n\twhile(!q.empty()){\n\t\tint x=q.front();q.pop(),in[x]=false;\n\t\tfor(int i=head[x],y;i!=-1;i=edge[i].next){\n\t\t\ty=edge[i].to,mul(dis[x],prob[i],now);\n\t\t\tbool modi=false;\n\t\t\tfor(int j=0;j<=t;j++)if(dis[y][j]>now[t+1+j]+edge[i].val)modi=true,dis[y][j]=now[t+1+j]+edge[i].val;\n\t\t\tif(modi&&!in[y])in[y]=true,q.push(edge[i].to);\n\t\t}\n\t}\n}\nint main(){\n\tscanf(\"%d%d%d%d\",&n,&m,&t,&pay),memset(head,-1,sizeof(head));\n\tfor(int i=1,x,y,z;i<=m;i++){\n\t\tscanf(\"%d%d%d\",&x,&y,&z),ae(y,x,z,i);\n\t\tfor(int j=1;j<=t;j++)scanf(\"%d\",&x),prob[i][j]=1.0*x/100000;\n\t\treverse(prob[i]+1,prob[i]+t+1);\n\t}\n\twhile(lim<=(t<<2))lim<<=1,LG++;\n\tfor(int i=0;i<lim;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(LG-1));\n\tDijkstra();\n\tSPFA();\n\tprintf(\"%.10lf\\n\",dis[1][0]);\n\treturn 0;\n}\n```\n",
        "postTime": 1597570623,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF553E \u3010Kyoya and Train\u3011"
    },
    {
        "content": "# Kyoya and Train\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF553E)\n## \u601d\u8def\n\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49$f_{i,j}$\u8868\u793a\u5230\u4e86\u70b9$i$\uff0c\u5df2\u7ecf\u8017\u65f6$j$\uff0c\u5230$n$\u7684**\u8fd8\u9700\u7684**\u6700\u5c0f\u671f\u671b\u82b1\u8d39\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\u5f0f:\n\n$$f_{u,i}=\\left\\{\\begin{array}{l}\n\\min_v \\{w_{u,v}+\\sum_{k}^{t} P_{(u,v),k} f_{v,i+k}\\},1\\le i\\le t\\\\ \ndis[i \\to n]+X,t\\le t\n\\end{array}\\right.$$  \n\n\u5176\u4e2d$dis[i\\to n]$\u8868\u793a$i\\to n$\u7684\u6700\u77ed\u8def\u5f84\u957f\u5ea6\uff0c\u53ef\u4ee5\u4e00\u5f00\u59cb\u4f7f\u7528$\\text {Dijkstra}$\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u8fd9\u4e2a\u8f6c\u79fb\u5f0f\u5e94\u8be5\u662f\u5f88\u663e\u7136\u7684\uff0c\u53ea\u8981\u60a8\u4e0d\u628a\u5b9a\u4e49\u7406\u89e3\u9519\u5373\u53ef\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u663e\u7136\u662f\u8fc7\u4e0d\u4e86\u7684\u3002\u800c\u6211\u4eec\u53c8\u53d1\u73b0\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u5982\u679c\u628a$P$\u8fdb\u884c\u7ffb\u8f6c\u4fbf\u662f\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u5206\u6cbb$\\text {FFT}$\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u56e0\u4e3a\u662f\u7b2c\u4e00\u6b21\u7801\u5206\u6cbb$\\text {FFT}$\uff0c\u6240\u4ee5\u6709\u6240\u501f\u9274$\\color{red}{\\text {Kinandra}}$\u3002\n\n## $\\text {Code}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define Int register int\n#define pi acos(-1)\n#define MAXN 40005\n\ntemplate <typename T> inline void read (T &t){t = 0;char c = getchar();int f = 1;while (c < '0' || c > '9'){if (c == '-') f = -f;c = getchar();}while (c >= '0' && c <= '9'){t = (t << 3) + (t << 1) + c - '0';c = getchar();} t *= f;}\ntemplate <typename T,typename ... Args> inline void read (T &t,Args&... args){read (t);read (args...);}\ntemplate <typename T> inline void write (T x){if (x < 0){x = -x;putchar ('-');}if (x > 9) write (x / 10);putchar (x % 10 + '0');}\n\nstruct edge{\n\tint v,w,nxt;\n}e[105];\n\nint top = 1;\nint head[MAXN];\n\nvoid Add_Edge (int u,int v,int w){\n\te[++ top] = edge {v,w,head[u]};\n\thead[u] = top;\n}\n\nqueue <int> q;\nint dis[MAXN];bool vis[MAXN];\n\nint n,m,t,X;\nint u[105],v[105],w[105];\ndouble f[55][MAXN],g[105][MAXN],p[105][MAXN];\n\nvoid Spfa (){\n\tq.push (n),memset (dis,0x7f,sizeof (dis)),dis[n] = 0,vis[n] = 1;\n\twhile (!q.empty()){\n\t\tint u = q.front();q.pop ();vis[u] = 0;\n\t\tfor (Int i = head[u];i;i = e[i].nxt){\n\t\t\tint v = e[i].v,w = e[i].w;\n\t\t\tif (dis[v] > dis[u] + w){\n\t\t\t\tdis[v] = dis[u] + w;\n\t\t\t\tif (!vis[v]) q.push (v),vis[v] = 1;\n\t\t\t}\n\t\t}\n\t}\n}\n\nstruct Complex{\n\tdouble x,y;\n\tComplex operator + (const Complex &p)const{return Complex {x + p.x,y + p.y};}\n\tComplex operator - (const Complex &p)const{return Complex {x - p.x,y - p.y};}\n\tComplex operator * (const Complex &p)const{return Complex {x * p.x - y * p.y,x * p.y + y * p.x};}\n};\n\nint limit,rev[MAXN];\n\nvoid FFT (Complex *a,int type){\n\tfor (Int i = 0;i < limit;++ i) if (i < rev[i]) swap (a[i],a[rev[i]]);\n\tfor (Int mid = 1;mid < limit;mid <<= 1){\n\t\tComplex Wn = Complex {cos (pi / mid),type * sin (pi / mid)};\n\t\tfor (Int j = 0,R = mid << 1;j < limit;j += R){\n\t\t\tComplex w = {1,0};\n\t\t\tfor (Int k = 0;k < mid;++ k,w = w * Wn){\n\t\t\t\tComplex x = a[j + k],y = w * a[j + k + mid];\n\t\t\t\ta[j + k] = x + y,a[j + k + mid] = x - y;\n\t\t\t}\n\t\t}\n\t}\n\tif (type == 1) return ;\n\tfor (Int i = 0;i < limit;++ i) a[i].x /= limit; \n}\n\nvoid Init (int leng){\n\tlimit = 1;int logn = 0;\n\twhile (limit < leng) limit <<= 1,logn ++;\n\tfor (Int i = 0;i < limit;++ i) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << logn - 1);\n}\n\nComplex A[MAXN],B[MAXN];\n\nvoid Work (int l,int r){\n\tif (l == r){\n\t\tfor (Int i = 1;i <= m;++ i) f[u[i]][l] = min (f[u[i]][l],g[i][l]);\n\t\treturn ;\n\t}\n\tint mid = (l + r) >> 1;Work (mid + 1,r);\n\tint lx = r - mid,ly = r - l;Init (ly);\n\tfor (Int i = 1;i <= m;++ i){\n\t\tfor (Int j = 0;j < lx;++ j) A[j] = Complex {f[v[i]][j + mid + 1],0};\n\t\tfor (int j = 0;j < ly;++ j) B[j] = Complex {p[i][t - r + l + j],0};\n\t\tfor (Int j = lx;j < limit;++ j) A[j] = Complex {0,0};\n\t\tfor (Int j = ly;j < limit;++ j) B[j] = Complex {0,0};\n\t\tFFT (A,1),FFT (B,1);\n\t\tfor (Int j = 0;j < limit;++ j) A[j] = A[j] * B[j];\n\t\tFFT (A,-1);\n\t\tfor (Int j = l;j <= mid;++ j) g[i][j] += A[j + r - l - mid - 1].x; \n\t} \n\tWork (l,mid);\n}\n\nsigned main(){\n\tread (n,m,t,X);\n\tfor (Int i = 1;i < n;++ i) for (Int j = 0;j <= t;++ j) f[i][j] = 2e8;\n\tfor (Int i = 1;i <= m;++ i){\n\t\tread (u[i],v[i],w[i]);Add_Edge (v[i],u[i],w[i]);\n\t\tfor (Int j = 1,x;j <= t;++ j) read (x),p[i][j] = x / 100000.0;\n\t\treverse (p[i],p[i] + t + 1);\n\t\tfor (Int j = 1;j <= t;++ j) g[i][j] = g[i][j - 1] + p[i][j - 1];\n\t}\n\tSpfa ();\n\tfor (Int i = 1;i <= m;++ i) for (Int j = 0;j <= t;++ j) g[i][j] = g[i][j] * (dis[v[i]] + X) + w[i];\n\tWork (0,t);\n\tprintf (\"%.6f\\n\",min (f[1][0],0.0 + dis[1] + X));\n\treturn 0;\n}\n```",
        "postTime": 1592283847,
        "uid": 124781,
        "name": "Walking_Dead",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF553E \u3010Kyoya and Train\u3011"
    }
]