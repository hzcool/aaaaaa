[
    {
        "content": "#### C Madhouse \n\n\u9898\u89e3\uff1a\u9996\u5148\u8003\u8651\u7b80\u5355\u7248\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8be2\u95ee$[1,n]$\u4ee5\u53ca$[1,n-1]$\u3002\n\n\u53d1\u73b0\u7b2c\u4e00\u6b21\u8be2\u95ee\u6bd4\u7b2c\u4e8c\u6b21\u591a\u4e86$n$\u4e2a\u4e32\uff0c\u8fd9$n$\u4e2a\u4e32\u6070\u597d\u662f\n\u8fd9\u4e2a\u4e32\u7684$n$\u4e2a\u540e\u7f00\u7684\u4e71\u5e8f\u7248\u672c\u3002\n\n\u627e\u5230\u8fd9$n$\u4e2a\u4e32\u5373\u53ef\u8fd8\u539f\u6574\u4e2a\u4e32\u3002\n\n\u603b\u4e32\u6570\uff1aO($n^2$)\n\n\u5bf9\u4e8e\u56f0\u96be\u7248\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u5148\u6c42\u51fa$[1,n/2]$\u8fd9\u90e8\u5206\u7684\u4e32\u3002\n\u7136\u540e\u518d\u8be2\u95ee$[1,n]$\u8fd9\u90e8\u5206\u3002\n\n\u8bbe$f[i][x]$\u8868\u793a\u8fd9\u6b21\u8be2\u95ee\u6240\u6709\u957f\u5ea6\u4e3ai\u7684\u4e32\u4e2d\uff0c\u5b57\u7b26$x$\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u8003\u8651$f[i+1][x]-f[i][x]$\u7684\u610f\u4e49\uff0c\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5373\u4e3a\u539f\u4e32$[i+1,n-i]$\u8fd9\u6bb5\u533a\u95f4\u5185\u5b57\u7b26$x$\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86\u524d\u534a\u6bb5\uff0c\u540e\u534a\u6bb5\u53ef\u4ee5\u901a\u8fc7\u5012\u5e8f\u679a\u4e3e$i$\u9010\u4e2a\u6c42\u51fa\u3002\n\n\u603b\u4e32\u6570\uff1aO(0.75*$n^2$)\n\n\u4ee3\u7801\uff1a\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define re register int\n#define F(x,y,z) for(re x=y;x<=z;x++)\n#define FOR(x,y,z) for(re x=y;x>=z;x--)\ntypedef long long ll;\n#define I inline void\n#define IN inline int\n#define C(x,y) memset(x,y,sizeof(x))\n#define STS system(\"pause\")\ntemplate<class D>I read(D &res){\n\tres=0;register D g=1;register char ch=getchar();\n\twhile(!isdigit(ch)){\n\t\tif(ch=='-')g=-1;\n\t\tch=getchar();\n\t}\n\twhile(isdigit(ch)){\n\t\tres=(res<<3)+(res<<1)+(ch^48);\n\t\tch=getchar();\n\t}\n\tres*=g;\n}\nmap<string,int>mp;\nstruct P{\n\tstring a;\n\tfriend bool operator > (P x,P y){\n\t\treturn x.a.size()==y.a.size()?x.a.compare(y.a)>0:x.a.size()>y.a.size();\n\t}\n}p;\npriority_queue<P,vector<P>,greater<P> >q;\nchar c[110],ans[110];\nstring s;\nint n,m,cnt[30],now[30],f[110][30];\nnamespace solve1{\n\tI solve(int x){\n\t\tif(x==1){\n\t\t\tcout<<\"? 1 1\"<<endl;fflush(stdout);\n\t\t\tcin>>c+1;ans[1]=c[1];return;\n\t\t}\n\t\tcout<<\"? 1 \"<<x<<endl;fflush(stdout);\n\t\tF(i,1,x*(x+1)/2){\n\t\t\tcin>>c+1;m=strlen(c+1);sort(c+1,c+1+m);p.a.clear();p.a.append(c+1);q.emplace(p);\n\t\t}\n\t\tcout<<\"? 1 \"<<x-1<<endl;fflush(stdout);\n\t\tF(i,1,x*(x-1)/2){\n\t\t\tcin>>c+1;m=strlen(c+1);sort(c+1,c+1+m);s.clear();s.append(c+1);mp[s]++;\n\t\t}\n\t\tC(cnt,0);m=0;\n\t\twhile(!q.empty()){\n\t\t\ts=q.top().a;q.pop();//cout<<\"@\"<<s<<endl;\n\t\t\tif(mp.count(s)){\n\t\t\t\tif(mp[s]==1)mp.erase(s);\n\t\t\t\telse mp[s]--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tC(now,0);\n\t\t\tF(i,0,s.size()-1){\n\t\t\t\tnow[s[i]-'a'+1]++;\n\t\t\t}\n\t\t\tF(i,1,26)if(now[i]>cnt[i]){ans[++m]=i+'a'-1;cnt[i]++;break;}\n\t\t}\n\t\treverse(ans+1,ans+1+x);\n\t}\n};\nnamespace solve2{\n\tI solve(){\n\t\tcout<<\"? 1 \"<<n<<endl;fflush(stdout);\n\t\tF(i,1,n*(n+1)>>1){\n\t\t\tcin>>c+1;m=strlen(c+1);\n\t\t\tF(j,1,m)f[m][c[j]-'a'+1]++;\n\t\t}\n\t\tre l,r;\n\t\tFOR(i,(n-1)>>1,0){\n\t\t\tl=i+1;r=n-i;\n\t\t\tC(cnt,0);\n\t\t\tF(j,l,r-1)cnt[ans[j]-'a'+1]++;\n\t\t\tF(j,1,26)if(f[i+1][j]-f[i][j]>cnt[j]){ans[r]=j+'a'-1;break;}\n\t\t}\n\t\tcout<<\"! \"<<ans+1<<endl;fflush(stdout);\n\t}\t\n};\nint main(){\n\tread(n);\n\tif(n==1){\n\t\tcout<<\"? 1 1\"<<endl;fflush(stdout);\n\t\tcin>>c+1;cout<<\"! \"<<c[1]<<endl;fflush(stdout);\n\t\treturn 0;\n\t}\n\tsolve1::solve(n/2);\n\tsolve2::solve();\n\treturn 0;\n}\n```\n\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1ahttps://www.cnblogs.com/Purple-wzy/",
        "postTime": 1578376875,
        "uid": 93453,
        "name": "Purple_wzy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1286C2 \u3010Madhouse (Hard version)\u3011"
    },
    {
        "content": "[$$\\color{darkblue}\\Huge\\texttt{My blog}$$](https://dilute.xyz/2020/01/12/Solutions/Solution-CF1286C/)\n\n> \u8fd9\u4e2a $0.777$ \u8ba9\u6211\u60f3\u8d77\u4e86\u67d0\u4f4d EDG \u7684\u9000\u5f79\u6253\u91ce\u9009\u624b\n>\n> \u2014\u2014 Sooke\n\n4396\uff08\u65e0 \u7aef \u8feb \u5bb3\uff09\n\n---------\n\n\u6211\u4eec\u9996\u5148\u8003\u8651\u5982\u679c\u6211\u4eec\u8be2\u95ee\u4e86\u4e00\u6bb5\u533a\u95f4 $[1 ,n ]$ \uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4ec0\u4e48\u4fe1\u606f\u3002\n\n\u6211\u4eec\u8003\u8651\u628a $s_1 , s_{2} , s_{3} \\cdots s_n$ \u5728\u6bcf\u79cd\u957f\u5ea6\u7684\u5b50\u4e32\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u7ed9\u5199\u51fa\u6765\uff08\u4ee5 $n = 5$ \u65f6\u7684\u60c5\u51b5\u4e3a\u4f8b\uff09\u3002\n\n| $len$ | $s_1$ | $s_2$ | $s_3$ | $s_4$ | $s_5$ |\n| :---: | :---: | :---: | :---: | :---: | :---: |\n|   1   |   1   |   1   |   1   |   1   |   1   |\n|   2   |   1   |   2   |   2   |   2   |   1   |\n|   3   |   1   |   2   |   3   |   2   |   1   |\n\n\u770b\u51fa\u89c4\u5f8b\u4e86\u5417\uff1f\u5982\u679c\u770b\u4e0d\u51fa\u6765\u7684\u8bdd\uff0c\u6211\u4eec\u628a\u6bcf\u5217\u7684\u6570\u505a\u5dee\u5206\u4e4b\u540e\u7684\u7ed3\u679c\u518d\u5199\u51fa\u6765\u3002\n\n| $len$ | $s_1$ | $s_2$ | $s_3$ | $s_4$ | $s_5$ |\n| :---: | :---: | :---: | :---: | :---: | :---: |\n|   1   |   1   |   1   |   1   |   1   |   1   |\n|   2   |   0   |   1   |   1   |   1   |   0   |\n|   3   |   0   |   0   |   1   |   0   |   0   |\n\n\u8fd9\u6837\u4ee5\u6765\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u5f97\u5230 $s[\\frac{l + r}2]$ \u7684\u503c\uff08\u5f53 $len$ \u4e3a\u5947\u6570\u7684\u65f6\u5019\u624d\u53ef\u4ee5\uff09\uff0c\u5e76\u4e14\u53ef\u4ee5\u5f97\u5230 $\\lfloor \\frac {len}2 \\rfloor$ \u7ec4\u5f62\u5982 \u300c$s_x$ \u548c $s_y$ \u5206\u522b\u662f $a$ \u548c $b$ \u300d\uff08\u5176\u4e2d $a$ \u548c $b$ \u4ee3\u8868\u4e24\u4e2a\u5b57\u7b26\uff09\u7684\u9650\u5236\u3002\n\n\u6211\u4eec\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u5229\u7528\u8fd9\u4e2a\u6027\u8d28\u6765\u89e3\u51b3\u8fd9\u9053\u9898\u76ee\u3002\n\n\u8003\u8651\u5c06\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5212\u5206\u4e3a\u4e09\u6bb5\uff0c\u5206\u522b\u4e3a $[1 , s]$\uff0c$[s + 1, t]$\uff0c$[t + 1, n]$ \u4e09\u6bb5\u533a\u95f4\u3002\n\n\u8fd9\u4e2a\u5206\u6cd5\u8981\u6ee1\u8db3\u4e00\u5b9a\u7684\u8981\u6c42\uff0c\u5177\u4f53\u662f\u4ec0\u4e48\u8981\u6c42\u7a0d\u540e\u4f1a\u8bb2\u5230\u3002\n\n\u7136\u540e\u8be2\u95ee $[1 , t]$ \uff0c$[s + 1 , n]$ \uff0c$[s + 1, n - 1]$ \u4e09\u6bb5\u3002\n\n\u628a\u6bcf\u7ec4\u5f97\u5230\u7684\u7ea6\u675f\u6761\u4ef6\u90fd\u8fde\u8d77\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5dee\u4e0d\u591a\u957f\u6210\u8fd9\u6837\u7684\u56fe\u2026\u2026\n\n![](https://dilute.xyz/images/4.png)\n\n\u6ce8\u610f\u90a3\u4e2a\u753b\u7740\u4e00\u4e2a\u7eff\u8272\u5708\u5708\u7684\u4f4d\u7f6e\uff0c\u6211\u4eec\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u8fd9\u91cc\u662f\u4ec0\u4e48\u3002\n\n\u90a3\u4e48\u8003\u8651\u4ea4\u66ff\u901a\u8fc7\u7eff\u8272\u548c\u7ea2\u8272\u7684\u7ea6\u675f\u5c31\u53ef\u4ee5\u77e5\u9053\u7b2c\u4e8c\u6bb5\u548c\u7b2c\u4e09\u6bb5\uff0c\u7136\u540e\u901a\u8fc7\u84dd\u8272\u7684\u7ea6\u675f\u5c31\u53ef\u4ee5\u77e5\u9053\u7b2c\u4e00\u6bb5\u4e86\u3002 \n\n\u90a3\u4e48\u53ea\u8981\u5728\u8be2\u95ee $[s + 1 , n]$ \u7684\u65f6\u5019\u90a3\u4e2a\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u65f6\u5019\u4e2d\u95f4\u53ef\u4ee5\u76f4\u63a5\u77e5\u9053\u7684\u6570\u843d\u5728\u5b83\u8eab\u4e0a\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u8fd9\u4e2a\u5206\u6cd5\u8981\u6ee1\u8db3\u4ec0\u4e48\u8981\u6c42\u4e86\u3002\n\n\u6211\u4eec\u8bbe\u4e09\u6bb5\u7684\u957f\u5ea6\u5206\u522b\u4e3a $len1 , len2 , len3$\uff0c\u90a3\u4e48\u9700\u8981\u6ee1\u8db3\uff1a\n\n- $len2 + len3$ \u4e3a\u5947\u6570\n- $len2 > len3$\n- $len2 > len1$ \uff08\u5426\u5219\u65e0\u6cd5\u7531\u7b2c\u4e8c\u6bb5\u63a8\u51fa\u5b8c\u6574\u7684 $len1$\uff09\n\n\u53ef\u4ee5\u901a\u8fc7\u5bf9 $n \\mod 3$ \u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\u5f97\u51fa $len1 , len2 , len3$ \u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u7684\u957f\u5ea6\u90fd\u662f $\\frac 23 n$ \u7ea7\u522b\uff0c\u8be2\u95ee\u51fa\u6765\u7684\u5b57\u4e32\u6570\u91cf\u90fd\u662f $\\frac 29 n^2$ \u7ea7\u522b\uff0c\u6700\u7ec8\u4e09\u6b21\u8be2\u95ee\u52a0\u8d77\u6765\u5c31\u5927\u7ea6\u662f $\\frac 23 n^2 \\approx 0.66666 n^2 < 0.777 n^2$ \u3002\n\n````cpp\n#include<bits/stdc++.h>\n\n#define ll long long\n#define INF 2147483647\n\nint inp(){\n    char c = getchar();\n    int neg = 1;\n    while(c < '0' || c > '9'){\n        if(c == '-')\n            neg = -1;\n        c = getchar();\n    }\n    int sum = 0;\n    while(c >= '0' && c <= '9'){\n        sum = sum * 10 + c - '0';\n        c = getchar();\n    }\n    return sum * neg;\n}\n\nchar ans[110], s[110];\nchar f[110][110][2];\n\nchar _query(int x){\n    std::cout << \"? \" << x << ' ' << x << std::endl;\n    char c = getchar();\n    while(c < 'a' || c > 'z')\n        c = getchar();\n    return c;\n}\n\nstd::vector<std::string> vec[110];\nstd::string str;\n\nbool cmp(std::string a, std::string b){\n    return a.size() < b.size();\n}\n\nint cnt[30], q[110], cou[30];\nint qf = 1, qe = 0, n;\nbool used[110], have[110][110];\nint last[30], delta[30];\n\nvoid query(int l, int r){\n    for(int i = 1; i <= r - l + 1; i++)\n        vec[i].clear();\n    std::cout << \"? \" << l << ' ' << r << std::endl;\n    for(int i = 1; i <= ((r - l + 1) * (r - l + 2) >> 1); i++){\n        std::cin >> str;\n        vec[(int)(str.size())].push_back(str);\n        // printf(\"str.size() = %d\\n\", (int)(str.size()));\n    }\n    memset(delta, 0, sizeof(delta));\n    memset(last, 0, sizeof(last));\n    for(int i = 0; i < (int)(vec[1].size()); i++){\n        last[vec[1][i][0] - 'a']++;\n        delta[vec[1][i][0] - 'a']++;\n    }\n    for(int i = 2; i <= ((r - l) >> 1) + 1; i++){\n        memset(cnt, 0, sizeof(cnt));\n        for(int j = 0; j < (int)(vec[i].size()); j++)\n            for(int u = 0; u < i; u++)\n                cnt[vec[i][j][u] - 'a']++;\n        int cur = 0;\n        // printf(\"i = %d\\n\", i);\n        for(int j = 0; j < 26; j++){\n            cnt[j] -= last[j];\n            last[j] += cnt[j];\n            int last = cnt[j];\n            while(cnt[j] < delta[j]){\n                // printf(\"link %d %d\\n\", l + i - 2, r - i + 2);\n                f[l + i - 2][r - i + 2][cur] = 'a' + j;\n                f[r - i + 2][l + i - 2][cur] = 'a' + j;\n                have[l + i - 2][r - i + 2] = true;\n                have[r - i + 2][l + i - 2] = true;\n                cur++;\n                cnt[j]++;\n            }\n            delta[j] = last;\n        }\n    }\n    // printf(\"maxinum %d | %d \", ((r - l + 1) >> 1) + ((r - l) & 1), vec[2].size());\n    int mid = (l + r) >> 1;\n    if((r - l + 1) & 1){\n        for(int i = 0; i < 26; i++)\n            if(delta[i] && !used[mid]){\n                used[mid] = true;\n                ans[mid] = 'a' + i;\n                q[++qe] = mid;\n                // printf(\"ans[%d] = '%c' | %d\\n\", mid, 'a' + i, cnt[i]);\n            }\n    } else {\n        int cur = 0;\n        for(int i = 0; i < 26; i++)\n            while(delta[i]){\n                int mid = (l + r) >> 1;\n                // printf(\"| link %d %d | %d left\\n\", mid, mid + 1, delta[i]);\n                f[mid][mid + 1][cur] = 'a' + i;\n                f[mid + 1][mid][cur] = 'a' + i;\n                have[mid][mid + 1] = true;\n                have[mid + 1][mid] = true;\n                cur++;\n                delta[i]--;\n            }\n    }\n}\n\nvoid print(int len){\n    printf(\"! \");\n    for(int i = 1; i <= len; i++)\n        putchar(ans[i]);\n    std::cout << std::endl;\n}\n\nvoid bfs(){\n    while(qf <= qe){\n        int i = q[qf++];\n        for(int j = 1; j <= n; j++)\n            if(have[i][j] && !used[j]){\n                ans[j] = f[i][j][f[i][j][0] == ans[i]];\n                used[j] = true;\n                q[++qe] = j;\n            }\n    }\n}\n\nint main(){\n    n = inp();\n    if(n <= 3){\n        for(int i = 1; i <= n; i++)\n            ans[i] = _query(i);\n        print(n);\n        return 0;\n    }\n    int len1 = (n / 3);\n    int len2 = len1, len3 = len1;\n    if(n % 3 == 0){\n        len2++;\n        len3--;\n    } else if(n % 3 == 1){\n        len2++;\n    } else {\n        len2++;\n        len3++;\n    }\n    query(1, len1 + len2);\n    query(len1 + 1, n);\n    query(len1 + 1, n - 1);\n    // for(int i = 1; i <= n; i++)\n    //     for(int j = 1; j <= n; j++)\n    //         if(have[i][j])\n    //             printf(\"{%d, %d} {%c, %c}\\n\", i, j, f[i][j][0], f[i][j][1]);\n    bfs();\n    print(n);\n}\n````\n\n\n\n",
        "postTime": 1578801079,
        "uid": 36362,
        "name": "Dilute",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1286C2 \u3010Madhouse (Hard version)\u3011"
    },
    {
        "content": "[Easy version link](https://www.luogu.com.cn/blog/Rhodoks/solution-cf1286c1)\n\n\u56f0\u96be\u7248\u95ee\u9898\u5bf9\u8fd4\u56de\u5b57\u7b26\u4e32\u6570\u7684\u9650\u5236\u4e0b\u8c03\u81f3$\\lceil 0.777(n+1)^2 \\rceil$\uff0c\u4f7f\u5f97\u539f\u672c\u7684\u89e3\u6cd5\u4ec5\u5728$n$\u5f88\u5c0f\u7684\u65f6\u5019\u76f4\u63a5\u9002\u7528\u3002\n\n\u4e0d\u8fc7\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u5229\u7528\u8be2\u95ee$s[1...n_1],s[2...n_1]$\u7684\u89e3\u6cd5\uff0c\u82b1\u8d39$n_1^2$\u7684\u4ee3\u4ef7\uff0c\u6c42\u51fa$s[1..n_1]$\u3002\u53d6$n_1=(n+1)/2$\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8be2\u95ee\u4e00\u6b21$s[1..n]$\u3002\u603b\u8fd4\u56de\u5b57\u7b26\u4e32\u6570\u4e0d\u8d85\u8fc7$0.75*(n+1)^2$\uff0c\u6ee1\u8db3\u8981\u6c42\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86$s[n-k+1...n](n-k > n_1)$\u4f4d\u7f6e\u7684\u5b57\u7b26\uff0c\u63a5\u4e0b\u6765\u5c06\u8981\u6c42\u51fa$s[n-k]$\u4f4d\u7f6e\u7684\u5b57\u7b26\u3002\u8003\u8651$s$\u7684\u957f\u5ea6\u4e3a$n-k-1$\u7684\u5b50\u4e32\uff1a\n\n$$s[1...n-k-1],s[2...n-k] ~......~ s[k+1...n-1],s[k+2...n]$$\n\n\u6211\u4eec\u53d1\u73b0\uff1a\n\n$s[i](1\\leq i \\leq k+1)$\u53ea\u88ab$i$\u4e2a\u5b50\u4e32\u6240\u5305\u542b\uff1b\n\n$s[i](n-k \\leq i \\leq n)$\u53ea\u88ab$n+1-i$\u4e2a\u5b50\u4e32\u6240\u5305\u542b\uff1b\n\n$s[i](k+2 \\leq i \\leq n-k-1)$\u88ab\u6240\u6709$k+2$\u4e2a\u5b50\u4e32\u6240\u5305\u542b\uff1b\n\n\u800c$s[i] (1\\leq i \\leq k+1~or~(n-k+1 \\leq i \\leq n))$\u6211\u4eec\u662f\u5df2\u77e5\u7684\u3002\n\n\u8003\u8651\u5f00\u4e00\u4e2a\u6876\uff0c\u7edf\u8ba1\u8be2\u95ee\u6240\u5f97\u5230\u7684\u6240\u6709\u957f\u5ea6\u4e3a$n-k-1$\u7684\u5b57\u7b26\u4e32\u4e2d\uff0c\u6bcf\u4e2a\u5b57\u7b26\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u7136\u540e\u51cf\u53bb$s[i] (1\\leq i \\leq k+1~or~(n-k+1 \\leq i \\leq n))$\u8fd9\u4e9b\u5df2\u77e5\u4f4d\u7f6e\u7684\u5b57\u7b26\u6240\u5e26\u6765\u7684\u8d21\u732e\u3002\n\n\u6700\u7ec8\u6876\u91cc\u53ea\u5269\u4e0b$s[i](k+2 \\leq i \\leq n-k)$\u8fd9\u4e9b\u4f4d\u7f6e\u5e26\u6765\u7684\u8d21\u732e\u3002\n\n\u9274\u4e8e\u5bf9\u4e8e$s[k+2...n-k-1]$\u4f4d\u7f6e\u7684\u5b57\u7b26\uff0c\u6bcf\u4e2a\u5b57\u7b26\u8d21\u732e\u51fa\u73b0\u6b21\u6570\u4e3a$k+2$\uff0c\u800c\u552f\u72ec$s[n-k]$\uff0c\u51fa\u73b0\u6b21\u6570\u662f$n+1-(n-k)=k+1$\u3002\n\n\u5c06\u6876\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u5bf9$k+2$\u53d6\u6a21\uff0c\u4e0d\u4e3a$0$\u7684\u90a3\u4e2a\u5b57\u7b26\u5373\u662f$s[n-k]$\u7684\u503c\u3002\n\n\u91cd\u590d\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u540e\u5411\u524d\u4e00\u8def\u6c42\u51fa$s$\u3002\n\n\u4ee3\u7801\u5f88\u4e71\uff0c\u4f46\u8fd8\u662f\u653e\u4e00\u4e0b\u5427\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define _ 0\nusing namespace std;\n\nstring s;\nmultiset<string> st;\nstring ss[110];\n\nvector<string> v[110]; \nchar ans[1000];\nbool cmp(string s1,string s2)\n{\n\treturn s1.size()<s2.size();\n}\n\nint buc[1100];\nint n;\n\nvoid branch() \n{\n\tint n1=n;\n\tn=(n+1)/2;\n\tcout<<\"? \"<<1<<' '<<n<<'\\n';\n\tfflush(stdout);\n\tfor (int i=0;i<n*(n+1)/2;i++)\n\t{\n\t\tcin>>s;\n\t\tsort(s.begin(),s.end());\n\t\tst.insert(s);\t\n\t} \n\tcout<<\"? \"<<2<<' '<<n<<'\\n';\n\tfflush(stdout);\n\tfor (int i=0;i<n*(n-1)/2;i++)\n\t{\n\t\tcin>>s;\n\t\tsort(s.begin(),s.end());\n\t\tst.erase(st.find(s));\t\n\t} \n\tint cnt=0;\n\tfor (auto p:st)\n\t{\n\t\tss[cnt++]=p;\n\t}\n\tsort(ss,ss+cnt,cmp);\n\tans[0]=ss[0][0];\n\t\n\tfor (int i=1;i<cnt;i++)\n\t{\n\t\tfor (auto p:ss[i-1])\n\t\t\tbuc[p]--;\n\t\tfor (auto p:ss[i])\n\t\t\tbuc[p]++;\n\t\tfor (int j=0;j<255;j++)\n\t\t\tif (buc[j]>0)\n\t\t\t{\n\t\t\t\tbuc[j]=0;\n\t\t\t\tans[i]=j;\n\t\t\t}\n\t}\n\t//\u81f3\u6b64\u6c42\u51fas[1..n_1]\n\t \n\tcout<<\"? \"<<1<<' '<<n1<<'\\n';\n\tfflush(stdout);\n\tfor (int i=0;i<n1*(n1+1)/2;i++)\n\t{\n\t\tcin>>s;\n\t\tv[s.size()].push_back(s); //\u6309\u957f\u5ea6\u5206\u7c7b \n\t} \n\tfor (int i=n1-1;i>=n;i--)\n\t{\n\t\tfor (int j='a';j<='z';j++)\n\t\t\tbuc[j]=0;\n\t\tfor (auto p:v[i])\n\t\t\tfor (auto q:p)\n\t\t\t\tbuc[q]++; //\u7edf\u8ba1\u51fa\u73b0\u6b21\u6570 \n\t\tfor (int j=0;j<(n1-i);j++)\n\t\t\tbuc[ans[j]]-=(j+1);\n\t\tfor (int j=n1-1;j>i;j--)\n\t\t\tbuc[ans[j]]-=n1-j; //\u6d88\u9664\u8d21\u732e \n\t\tfor (int j='a';j<='z';j++)\n\t\t\tif (buc[j]%(n1+1-i)!=0)\n\t\t\t\tans[i]=j; \n\t}\n\tcout<<\"! \";\n\tfor (int i=0;i<n1;i++)\n\t\tcout<<ans[i];\n\tfflush(stdout);\n\texit(0);\n}\n\nint main()\n{\n\tcin>>n;\n\tif (n==1)\n\t{\n\t\tcout<<\"? \"<<1<<' '<<1<<'\\n';\n\t\tfflush(stdout);\n\t\tchar c;\n\t\tcin>>c;\n\t\tcout<<\"! \"<<c;\n\t\tfflush(stdout);\n\t\treturn 0;\n\t}\n\tif (n>=6) //n\u8f83\u5927\u7684\u65f6\u5019\u8dd1\u65b0\u7b97\u6cd5 \n\t\tbranch();\n\tcout<<\"? \"<<1<<' '<<n<<'\\n';\n\tfflush(stdout);\n\tfor (int i=0;i<n*(n+1)/2;i++)\n\t{\n\t\tcin>>s;\n\t\tsort(s.begin(),s.end());\n\t\tst.insert(s);\t\n\t} \n\tcout<<\"? \"<<2<<' '<<n<<'\\n';\n\tfflush(stdout);\n\tfor (int i=0;i<n*(n-1)/2;i++)\n\t{\n\t\tcin>>s;\n\t\tsort(s.begin(),s.end());\n\t\tst.erase(st.find(s));\t\n\t} \n\tint cnt=0;\n\tfor (auto p:st)\n\t{\n\t\tss[cnt++]=p;\n\t}\n\tsort(ss,ss+cnt,cmp);\n\tans[0]=ss[0][0];\n\t\n\tfor (int i=1;i<cnt;i++)\n\t{\n\t\tfor (auto p:ss[i-1])\n\t\t\tbuc[p]--;\n\t\tfor (auto p:ss[i])\n\t\t\tbuc[p]++;\n\t\tfor (int j=0;j<255;j++)\n\t\t\tif (buc[j]>0)\n\t\t\t{\n\t\t\t\tbuc[j]=0;\n\t\t\t\tans[i]=j;\n\t\t\t}\n\t}\n\tcout<<\"! \"<<ans;\n\tfflush(stdout);\n\treturn ~~(0^_^0);\n}\n\n\n```\n",
        "postTime": 1578291124,
        "uid": 56267,
        "name": "Rhodoks",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 CF1286C2 \u3010Madhouse (Hard version)\u3011"
    },
    {
        "content": "## [CF1286C2](https://codeforces.com/problemset/problem/1286/C2)\n\n~~\u6c34\u9ed1~~\u3002\n\n### \u89e3\u9898\u601d\u8def\uff1a\n\n\u8bbe $m=\\lceil\\frac{n}{2}\\rceil$\uff0c$s$ \u8868\u793a\u7b54\u6848\uff08\u4e0b\u6807\u4ece $0$ \u5f00\u59cb\uff09\u3002\n\n\u9996\u5148\u67e5\u8be2 $[1,m]$ \u548c $[2,m]$\uff08\u67e5\u8be2\u4e0b\u6807\u4ece $1$ \u5f00\u59cb\uff09\uff0c\u50cf\u7b80\u5355\u7248\u90a3\u6837\u7684\u5f97\u5230 $s[0,m-1]$\uff0c\u518d\u67e5\u8be2 $[1,n]$\uff0c\u8bbe $S_{i,j}$ \u8868\u793a\u67e5\u8be2\u4e2d\u957f\u5ea6\u4e3a $i$ \u7684\u5b50\u4e32\u96c6\u5408\u4e2d\u7684\u7b2c $j$ \u4e2a\u4e32\uff08\u4e0b\u6807\u4ece $0$ \u5f00\u59cb\uff0c\u5b58\u50a8\u7684\u4e32\u5b9e\u9645\u4e0a\u662f\u5b57\u7b26\u96c6\u5408\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u5230\u7684\u5b50\u4e32\u88ab\u6253\u4e71\u4e86\uff09\u3002\n\n\u53d1\u73b0 $S_{n,0}$ \u5220\u9664 $s_0$ \u540e\uff0c\u5f97\u5230\u7684\u5c31\u662f $S_{1}$ \u4e2d\u53f3\u7aef\u70b9\u7b49\u4e8e $n-1$ \u7684\u90a3\u4e00\u4e2a\uff0c\u53e6\u4e00\u4e2a\u5c31\u662f\u5de6\u7aef\u70b9\u4e3a $0$ \u7684\u90a3\u4e00\u4e2a\uff0c$S_{n,0}$ \u5220\u9664\u5de6\u7aef\u70b9\u4e3a $0$ \u4e14\u957f\u5ea6\u4e3a $n-1$ \u7684\u5b50\u4e32\u5c31\u53ef\u4ee5\u5f97\u5230 $s_{n-1}$\u3002\n\n\u53ef\u4ee5\u8fdb\u884c\u63a8\u5e7f\uff0c\u8bbe $cur$ \u8868\u793a\u6240\u6709\u957f\u5ea6\u4e3a $len+1$ \u7684\u5b50\u4e32\u6309\u5de6\u7aef\u70b9\u6392\u5e8f\u540e\u7684\u96c6\u5408\uff0c\u6bcf\u4e2a $cur$ \u4e2d\u7684\u4e32\u5220\u6389\u5b83\u7684\u9996\u5b57\u6bcd\uff08\u9996\u5b57\u6bcd\u4e00\u5b9a\u5728 $[0,m-1]$ \u5185\uff0c\u662f\u5df2\u77e5\u7684\uff09\u53ef\u4ee5\u5f97\u5230\u957f\u5ea6\u4e3a $len$ \u7684\u4e32\u6784\u6210\u7684\u96c6\u5408\uff0c\u800c\u4e14\u4e5f\u662f\u6309\u5de6\u7aef\u70b9\u6392\u597d\u5e8f\u4e86\u7684\uff0c\u4f46\u5c11\u4e86\u5de6\u7aef\u70b9\u4e3a $0$ \u4e14\u957f\u5ea6\u4e3a $len$ \u7684\u90a3\u4e00\u4e2a\uff0c\u4e0d\u8fc7\u4e5f\u5f88\u597d\u5f97\u5230\uff0c\u4ece $S_{len}$\u4e2d\u5220\u9664\u5176\u4ed6\u7684\u5c31\u53ef\u4ee5\u5f97\u5230\u5b83\uff0c\u5c06\u5b83\u63d2\u5728\u6700\u524d\u9762\u5c31\u53ef\u4ee5\u5f97\u5230 $cur'$\u3002\n\n$cur$ \u4e2d\u7684\u7b2c\u4e8c\u4e2a\u4e32\u5220\u9664\u53bb\u6389 $s_0$ \u540e\u7684\u7b2c\u4e00\u4e2a\u4e32\u5c31\u53ef\u4ee5\u5f97\u5230\u7b2c\u4e8c\u4e2a\u4e32\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u6bcd\uff0c\u6700\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u6574\u4e2a\u4e32\u3002\n\n### Code\uff1a\n```cpp\nconst int N=110;\n\nint cnt[26],cnt2[26];\nmultiset<string>is[N];\n\nmultiset<string>query(int l,int r)\n{\n\tcout<<\"? \"<<l<<' '<<r<<endl;\n\tmultiset<string>st;\n\tint n=r-l+1;\n\trep(i,1,(n+1)*n/2)\n\t{\n\t\tstring s;\n\t\tcin>>s;\n\t\tsort(s.begin(),s.end());\n\t\tst.insert(s);\n\t}\n\treturn st;\n}\n\nint main()\n{\n\tint n;\n\tcin>>n;\n\tif(n<=3)\n\t{\n\t\tstring ans;\n\t\trep(i,1,n)\n\t\t{\n\t\t\tcout<<\"? \"<<i<<' '<<i<<endl;\n\t\t\tstring s;\n\t\t\tcin>>s;\n\t\t\tans+=s;\n\t\t}\n\t\tcout<<\"! \"<<ans<<endl;\n\t\treturn 0;\n\t}\n\tint m=(n+1)/2;\n\tauto s1=query(1,m),s2=query(2,m);\n\tfor(auto &i: s2) s1.erase(s1.find(i));\n\tvector<string>vi;\n\tfor(auto &i: s1) vi.push_back(i);\n\tsort(vi.begin(),vi.end(),[](string x,string y) {return x.length()<y.length();});\n\tstring ans;\n\tans.resize(n);\n\tans[0]=vi[0][0];\n\tcnt[vi[0][0]-'a']++;\n\trep(i,1,(int) vi.size()-1)\n\t{\n\t\tfor(auto &j: vi[i])\n\t\t\tcnt2[j-'a']++;\n\t\trep(j,0,25)\n\t\t{\n\t\t\tif(cnt2[j]>cnt[j])\n\t\t\t{\n\t\t\t\tassert(cnt2[j]==cnt[j]+1);\n\t\t\t\tans[i]=j+'a';\n\t\t\t\tcnt[j]++;\n\t\t\t}\n\t\t\tcnt2[j]=0;\n\t\t}\n\t}\n\tauto s3=query(1,n);\n\tfor(auto &i: s3) is[i.length()].insert(i);\n\tvector<string>cur;\n\tcur.push_back(*is[n].begin());\n\tint len=n;\n\tper(i,m,n-1)\n\t{\n\t\tlen--;\n\t\trep(j,0,(int) cur.size()-1)\n\t\t{\n\t\t\tstring &s=cur[j];\n\t\t\tauto it=s.begin();\n\t\t\twhile(*it!=ans[j]) it++;\n\t\t\ts.erase(it);\n\t\t\tis[len].erase(is[len].find(s));\n\t\t}\n\t\treverse(cur.begin(),cur.end());\n\t\tcur.push_back(*is[len].begin());\n\t\treverse(cur.begin(),cur.end());\n\t\trep(j,0,25) cnt[j]=0;\n\t\trep(j,0,len-1) cnt[cur[0][j]-'a']--;\n\t\tcnt[ans[0]-'a']++;\n\t\trep(j,0,len-1) cnt[cur[1][j]-'a']++;\n\t\trep(j,0,25)\n\t\t\tif(cnt[j])\n\t\t\t\tans[i]=j+'a';\n\t}\n\tcout<<\"! \"<<ans<<endl;\n\treturn 0;\n}\n\n```\n",
        "postTime": 1677122400,
        "uid": 571634,
        "name": "hgzxwzf",
        "ccfLevel": 7,
        "title": "CF1286C2"
    },
    {
        "content": "\u6709\u4efb\u4f55\u5173\u4e8e\u6b64\u7bc7\u9898\u89e3\u7684\u95ee\u9898\u7686\u53ef\u79c1\u4fe1[\u6211](https://www.luogu.com.cn/user/101868)\u3002\n\n\u672c\u849f\u84bb\u4e0e Dilute \u5927\u4f6c\u7684\u60f3\u6cd5~~\u76f8\u540c~~\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u9996\u5148\u770b\u770b\u90a3\u4e00\u7bc7\u3002\n\n### \u9898\u76ee\u5206\u6790\n\n\u5f53\u6211\u4eec\u8be2\u95ee\u4e00\u6bb5\u533a\u95f4 $[l,r]$ \u65f6\uff0c\u53ef\u4ee5\u77e5\u9053\u4ee5\u533a\u95f4\u4e2d\u5fc3\u70b9\u4e3a\u5bf9\u79f0\u8f74\uff0c\u5bf9\u79f0\u4e24\u6570\u7684\u503c\uff08\u4f46\u4e0d\u77e5\u9053\u5bf9\u5e94\u5173\u7cfb\uff09\uff0c\u4e14\u5f53\u533a\u95f4\u957f\u5ea6\u4e3a\u5947\u6570\u65f6\uff0c\u53ef\u4ee5\u77e5\u9053\u4e2d\u70b9\u5143\u7d20\u7684\u503c\u3002\n\n\u63a8\u7406\uff1a\n\n\u5148\u8bbe $cnt[i][j]$ \u8868\u793a\u5b57\u7b26 $j$ \u5728\u533a\u95f4 $[l,r]$ \u5185\u6240\u6709\u957f\u5ea6\u4e3a $i$ \u7684\u5b50\u4e32\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u4f8b\u5982\uff1a\n$$str=\\texttt{aabc}$$\n\u957f\u5ea6\u4e3a2\u7684\u5b50\u4e32\uff1a\n$$\\texttt{aa,ab,bc}$$\n\u5219\uff1a\n$$cnt[2]['a'-'a']=3$$\n$$cnt[2]['b'-'a']=2$$\n$$cnt[2]['c'-'a']=1$$\n\n\u63a8\u51fa\uff1a\n\n**\u5b57\u7b26 $j$ \u5728 $l+k$ \u81f3 $r-k$ \u533a\u95f4\u5185\u51fa\u73b0\u7684\u6b21\u6570\u4e3a $cnt[k+1][j]-cnt[k][j]$**\u3002\n\n\u975e\u5e38\u597d\u8bc1\uff0c\u82e5\u5b57\u7b26 $j$ \u4e0d\u5728\u6b64\u533a\u95f4\u5185\uff0c\u5219\u5bf9 $cnt[k+1][j]$ \u548c $cnt[k][j]$ \u7684\u8d21\u732e\u76f8\u7b49\uff08\u5217\u8868\u89c2\u5bdf\u5373\u53ef\uff09\u3002\n\n**\u5b57\u7b26 $j$ \u5728\u4f4d\u7f6e $l+k$ \u548c $r-k$ \u4e0a\u51fa\u73b0\u7684\u6b21\u6570\u4e3a $2\\times cnt[k+1][j]-cnt[k][j]-cnt[k+2][j]$**\u3002\n\n\u975e\u5e38\u597d\u8bc1\uff0c\u524d\u8005\u7ed3\u8bba\u9519\u4f4d\u76f8\u51cf\u5373\u53ef\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6240\u6709 $cnt$ \u5224\u65ad\u5b57\u7b26 $j$ \u5728\u4f4d\u7f6e $l+k$ \u548c $r-k$ \u4e0a\u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u5c31\u77e5\u9053\u4ee5\u533a\u95f4\u4e2d\u5fc3\u70b9\u4e3a\u5bf9\u79f0\u8f74\uff0c\u5bf9\u79f0\u4e24\u6570\u7684\u503c\uff08\u4f46\u4e0d\u77e5\u9053\u5bf9\u5e94\u5173\u7cfb\uff09\u3002\n\n\u6211\u4eec\u56de\u5230\u539f\u9898\uff0c\u4e09\u6b21\u8be2\u95ee\uff0c\u6240\u6709\u5b50\u4e32\u7684\u957f\u5ea6\u603b\u548c\u4e0d\u80fd\u5927\u4e8e  $\\lceil0.777(n+1)^2\\rceil$\u3002\n\n\u6709\u4e00\u79cd\u53ef\u884c\u7684\u65b9\u6848\uff1a\n\n1. \u901a\u8fc7\u4e24\u6b21\u8be2\u95ee\u868a\u9999\u6cd5\uff08\u4e0b\u6587\u4f1a\u8bb2\uff09\u5904\u7406\u51fa\u524d $\\frac{2}{3}$ \u7684\u5143\u7d20\u7684\u503c\u3002\n\n2. \u518d\u4e00\u6b21\u540e $\\frac{2}{3}$ \u7684\u8be2\u95ee\u901a\u8fc7\u524d $\\frac{2}{3}$ \u7684\u5143\u7d20\u7684\u503c\u63a8\u51fa\u5269\u4e0b\u7684\u503c\u3002\n\n**\u868a\u9999\u6cd5\uff08\u81ea\u521b\u7684\uff0c\u4e0d\u559c\u8f7b\u55b7\uff09\uff1a**\n\n\u82e5\u60f3\u77e5\u9053\u4e00\u6bb5\u533a\u95f4 $[l,r]$ \uff08\u957f\u5ea6\u4e3a\u5947\u6570\uff09\u5185\u5143\u7d20\u7684\u5b9a\u503c\uff0c\u53ef\u4e24\u6b21\u8be2\u95ee\uff1a$[l,r]$ \u548c $[l+1,r]$\u3002\n\n\u5982\u4e0b\u56fe\u8be2\u95ee $[1,5]$ \u548c $[2,5]$\u3002\n\n![](https://i.loli.net/2021/07/27/XeBnwpbhJD7KuvV.png)\n\n\u5176\u4e2d\u6bcf\u6b21\u8be2\u95ee\u5f97\u5230\u7684\u503c\u53ef\u80fd\u5de6\u53f3\u5bf9\u79f0\u4f4d\u76f8\u53cd\uff0c\u5df2\u7528\u84dd\u7ea2\u7ebf\u6807\u51fa\u3002\n\n\u5f00\u59cb\u868a\u9999\u6cd5\uff08\u8ddf\u7740\u7528\u624b\u6307\u753b\u4e00\u753b\uff09\uff1a\n\n1. \u7531\u84dd\u7ebf\u53ef\u77e5\u4e0b\u6807\u4e3a 3 \u7684\u503c\u4e00\u5b9a\u662f $\\texttt{b}$\u3002\n\n2. \u7ea2\u7ebf\u4e0b\u6807\u4e3a 3 \u548c 4 \u7684\u503c\u8981\u4e92\u6362\u3002\n\n3. \u4e0b\u6807\u4e3a 4 \u7684\u503c\u4e00\u5b9a\u662f $\\texttt{c}$\u3002\n\n4. \u84dd\u7ebf\u4e0b\u6807\u4e3a 2 \u548c 4 \u7684\u503c\u4e0d\u7528\u4e92\u6362\u3002\n\n5. \u4e0b\u6807\u4e3a 2 \u7684\u503c\u4e00\u5b9a\u662f $\\texttt{a}$\u3002\n\n6. \u7ea2\u7ebf\u4e0b\u6807\u4e3a 2 \u548c 5 \u7684\u503c\u4e0d\u7528\u4e92\u6362\u3002\n\n7. \u4e0b\u6807\u4e3a 5 \u7684\u503c\u4e00\u5b9a\u662f $\\texttt{a}$\u3002\n\n8. \u84dd\u7ebf\u4e0b\u6807\u4e3a 1 \u548c 5 \u7684\u503c\u8981\u4e92\u6362\u3002\n\n9. \u4e0b\u6807\u4e3a 1 \u7684\u503c\u4e00\u5b9a\u662f $\\texttt{d}$\u3002\n\n10. \u5f97\u51fa\u539f\u5e8f\u5217\u4e3a dabca\u3002\n\n\u56de\u987e\u4e00\u4e0b\u8fc7\u7a0b\uff1a\n\n![](https://i.loli.net/2021/07/27/S6tTex1vBuUkW5M.png)\n\n\u50cf\u4e0d\u50cf\u4ece\u4e2d\u95f4\u70b9\u71c3\u7684\u868a\u9999\uff1f\n\n\u6240\u4ee5\uff0c\u5148\u5c06\u524d $k$ \uff08\u4e3a\u6700\u63a5\u8fd1 $\\frac{2n}{3}$ \u7684\u5947\u6570\uff09\u4e2a\u5b9e\u884c\u868a\u9999\u64cd\u4f5c\u3002\n\n\u540e\u9762\u5462\uff1f\n\n![](https://i.loli.net/2021/07/27/5Ro6DlaG9tqSkI3.png)\n\n\u8fd9\u6837\u5373\u53ef\u3002\n\n\u5b50\u4e32\u7684\u4e2a\u6570\u7ea6\u4e3a $0.666n^2$\u3002\n\n### Details\n\n$n\\leq3$ \u65f6\u8981\u7279\u5224\u3002\n\n\u8ba1\u7b97 $k$ \u65f6\u8bb0\u5f97\u6309 $n$ \u5bf9 $3$ \u7684\u6a21\u6570\u5206\u7c7b\u8ba8\u8bba\u3002\n\n### ACcode\n\n\u8bb0\u5f97\u9009 c++11.\n\n```cpp\n#pragma GCC optimize(2)\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define FOR(i,j,k) for(register int i=j;(j<k)?(i<=k):(i>=k);i+=(j<k)?1:(-1))\n#define IO ios::sync_with_stdio(0),cin.tie(0),cout.tie(0)\n#define N 110\n\npair<int,int> qry[3];//\u4e09\u4e2a\u8be2\u95ee\u7684\u533a\u95f4\nint n;\nchar val[N][3];//\u4e09\u6b21\u8be2\u95ee\u5f97\u5230\u7684\u7b54\u6848 \nint cnt[N][26];//cnt[i][j]\uff08\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff09\u5b57\u7b26(j+'a')\u5728\u957f\u4e3ai\u7684\u5b57\u7b26\u4e32\u4e2d\u51fa\u73b0\u4e86\u51e0\u6b21 \nstring str;\nvoid query(int x){//\u8be2\u95ee+\u5904\u7406 \n\tmemset(cnt,0,sizeof cnt); \n\tint l=qry[x].first;//\u8be2\u95ee\u533a\u95f4\u5de6\u8fb9\u754c \n\tint r=qry[x].second;//\u8be2\u95ee\u533a\u95f4\u53f3\u8fb9\u754c \n\tcout<<\"? \"<<l<<\" \"<<r<<endl;\n\tcout.flush();\n\tFOR(i,1,(r-l+1)*(r-l+2)/2){\n\t\tcin>>str;\n\t\tfor(auto j:str){//\u4e0d\u5b58str\uff0c\u76f4\u63a5\u904d\u5386\u5b58\u5165cnt \n\t\t\tcnt[str.size()][j-'a']++;\n\t\t}\n\t}\n\tFOR(i,0,(r-l)/2){//\u679a\u4e3e\u7684\u4e0a\u754c\uff1a\u957f\u5ea6\u7684\u4e00\u534a \n\t\tFOR(j,0,25){\n\t\t\tswitch(2*cnt[i+1][j]-cnt[i][j]-cnt[i+2][j]){//(char)(j+'a')\u5728\u539f\u5b57\u7b26\u4e32\u4e2d\u4e0b\u6807\u4e3al+i\u548cr-i\u4e2d\u51fa\u73b0\u4e86\u51e0\u6b21 \n\t\t\t\tcase 0:break;\n\t\t\t\t//\u8fbe\u54a9 \n\t\t\t\tcase 1:if(val[l+i][x])val[r-i][x]=j+'a';else val[l+i][x]=j+'a';break;\n\t\t\t\t//\u5b58\u5165\u5de6\u53f3\u5bf9\u79f0\u4f4d\u7f6e\u4e2d\u4efb\u610f\u7a7a\u4f4d\u7f6e\n\t\t\t\tcase 2:val[l+i][x]=val[r-i][x]=j+'a';break;\n\t\t\t\t//\u5b58\u5165\u5de6\u53f3\u5404\u4e00\u4e2a \n\t\t\t}\n\t\t} \n//\t\tFOR(j,1,n)cout<<val[j][x]<<\" \";cout<<endl;\n\t}\n}\nint mirror(int id,int layer){//id\u5728\u7b2clayer\u6b21\u8be2\u95ee\u4e2d\u7684\u5bf9\u79f0\u4f4d\u7f6e \n\treturn qry[layer].second+qry[layer].first-id;\n}\nsigned main(){\n    IO;\n    cin>>n;\n    if(n<=3){//\u5c0f\u6570\u636e\u7279\u5224 \n    \tstring ans=\"\";\n    \tFOR(i,1,n){\n\t\t\tcout<<\"? \"<<i<<\" \"<<i<<endl;//\u76f4\u63a5\u4e00\u4e2a\u4e00\u4e2a\u95ee \n\t\t\tcout.flush();\n\t\t\tcin>>str;\n\t\t\tans+=str;\n\t\t}\n\t\tcout<<\"! \"<<ans<<endl;\n    \treturn 0;\n\t}\n    if(n%3==0){//\u6309n\u5bf93\u6a21\u6570\u5206\u7c7b\u65b9\u6848 \n    \tqry[0]=make_pair(1,n/3*2-1);\n    \tqry[1]=make_pair(2,n/3*2-1);\n    \tqry[2]=make_pair(n/3,n);\n\t}else if(n%3==1){\n    \tqry[0]=make_pair(1,n-(n-1)/3);\n    \tqry[1]=make_pair(2,n-(n-1)/3);\n    \tqry[2]=make_pair(n-(n-1)/3*2+1,n);\n\t}else{\n    \tqry[0]=make_pair(1,n-(n+1)/3);\n    \tqry[1]=make_pair(2,n-(n+1)/3);\n    \tqry[2]=make_pair((n+1)/3+1,n);\n\t}\n//\tcout<<qry[0].first<<\" \"<<qry[0].second<<endl;\n//\tcout<<qry[1].first<<\" \"<<qry[1].second<<endl;\n//\tcout<<qry[2].first<<\" \"<<qry[2].second<<endl;\n\tquery(0);\n//\tFOR(i,1,n)cout<<val[i][0]<<\" \";cout<<endl;\n\tquery(1);\n//\tFOR(i,1,n)cout<<val[i][1]<<\" \";cout<<endl;\n\tquery(2);\n//\tFOR(i,1,n)cout<<val[i][2]<<\" \";cout<<endl;\n\tint x=(qry[0].second+qry[0].first)/2,layer=0;\n\twhile(x!=1){//\u868a\u9999\u5f0f\u904d\u5386\u5904\u7406 \n//\t\tcout<<x<<endl;\n\t\tlayer^=1;//\u57280\u548c1\u5c42\u4e4b\u95f4\u53cd\u590d\u6a2a\u8df3 \n\t\tif(val[x][layer]!=val[x][layer^1])swap(val[x][layer],val[mirror(x,layer)][layer]);\n\t\tx=mirror(x,layer);\n\t}\n\t//\u4e0a\u9762\u786e\u5b9a\u597d\u4e86\u524d\u4e24\u6b21\u8be2\u95ee\u7684\u533a\u95f4\u6240\u6709\u6570\u7684\u503c \n\tFOR(i,qry[2].first,qry[0].second){//\u7528 \u524d\u4e24\u6b21\u8be2\u95ee\u7684\u533a\u95f4\u6240\u6709\u6570\u7684\u503c \u786e\u5b9a\u7b2c\u4e09\u6b21\u7684 \n\t\tif(val[i][2]!=(val[i][0]|val[i][1]))swap(val[i][2],val[mirror(i,2)][2]);\n\t}\n//\tFOR(i,1,n)cout<<val[i][0]<<\" \";cout<<endl;\n//\tFOR(i,1,n)cout<<val[i][1]<<\" \";cout<<endl;\n//\tFOR(i,1,n)cout<<val[i][2]<<\" \";cout<<endl;\n\tcout<<\"! \";\n\tFOR(i,1,n)cout<<(char)(val[i][0]|val[i][1]|val[i][2]);//\u540c\u4f4d\u7f6e\u7684\u503c\u4e0d\u4e3a\u96f6\u5373\u76f8\u7b49 \n\tcout<<endl;\n\tcout.flush();\n    return 0;\n}\n/*\n\u6d4b\u8bd5\u6570\u636estring:ccba \n4\nc\nc\nb\ncc\ncb\nccb\nc\nb\ncb\nb\na\nba\n*/\n```",
        "postTime": 1627315302,
        "uid": 101868,
        "name": "I_am_Accepted",
        "ccfLevel": 0,
        "title": "CF1286C2\u9898\u89e3"
    }
]