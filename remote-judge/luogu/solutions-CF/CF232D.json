[
    {
        "content": "SA\u89e3\u6cd5\u3002\n\n------\n\n\u8003\u8651\u5bf9\u4e8e\u4e00\u6b21\u8be2\u95ee $[l,r]$\uff0c\u53e6\u4e00\u4e2a\u533a\u95f4 $[L,R]$ \u80fd\u591f\u7b26\u5408\u8be5\u8be2\u95ee\uff0c\u5176\u5fc5\u987b\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\uff1a\n\n1. $r-l=R-L$\n\n\u6709\u4e86\u8fd9\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u6839\u636e $L$ \u6765\u552f\u4e00\u786e\u5b9a\u53ef\u80fd\u5408\u6cd5\u7684 $R$ \u4e86\u3002\n\n2. $[l,r]\\cup[L,R]=\\varnothing$\n\n\u6709\u4e86\u8fd9\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5f97\u51fa\u6240\u6709\u53ef\u80fd\u5408\u6cd5\u7684 $L$ \u7684\u4f4d\u7f6e\uff1a\u5176\u5fc5\u4f4d\u4e8e\u533a\u95f4 $\\Big[1,l-(r-l+1)\\Big]\\cup[r+1,n]$ \u4e2d\u3002\n\n3. $R\\leq n$\n\n\u8fd9\u4e2a\u6761\u4ef6\u5bf9\u6211\u4eec\u6ca1\u6709\u4efb\u4f55\u5e2e\u52a9\u3002\n\n4. $\\forall i\\in[0,r-l],h_{l+i}+h_{L+i}=h_l+h_L$\n\n\u9996\u5148\uff0c\u4f9d\u7167\u8be5\u6761\u4ef6\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u6240\u6709 $l=r$ \u7684\u8be2\u95ee\uff0c\u5176\u7b54\u6848\u90fd\u53ea\u4f1a\u662f $n-1$\uff08\u56e0\u4e3a\u6240\u6709 $L\\neq l$ \u90fd\u662f\u5408\u6cd5\u7684 $L$\uff09\u3002\u6545\u6211\u4eec\u63a5\u4e0b\u6765\u53ea\u8003\u8651 $l<r$ \u7684\u60c5\u5f62\u3002\n\n\u7136\u540e\uff0c\u5982\u679c\u6211\u4eec\u628a\u539f\u5e8f\u5217\u5dee\u5206\uff0c\u5b9a\u4e49\u5dee\u5206\u540e\u7684\u6570\u7ec4 $s_i=h_{i+1}-h_i$\uff08\u660e\u663e\uff0c$s$ \u6570\u7ec4\u7684\u957f\u5ea6\u5e94\u4e3a $n-1$\uff0c\u4e0b\u6807\u662f $1\\sim n-1$\uff09\uff0c\u5219\u4e0a\u8ff0\u6761\u4ef6\uff0c\u53ef\u4ee5\u88ab\u7b49\u4ef7\u4e8e\n\n$$\\forall i\\in[0,r-l-1],s_{l+i}=-s_{L+i}$$\n\n\u5373\u5728 $s$ \u4e2d\uff0c$l$ \u5f00\u5934\u3001\u957f\u5ea6\u4e3a $r-l$ \u7684\u5b50\u4e32\uff0c\u4e0e $L$ \u5f00\u5934\u3001\u957f\u5ea6\u4e3a $r-l$ \u7684\u5b50\u4e32\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u6570\u4e92\u4e3a\u76f8\u53cd\u6570\u3002\n\n\u6211\u4eec\u8003\u8651\u5c06 $s$ \u590d\u5236\u4e00\u4efd\u6240\u6709\u6570\u90fd\u662f\u5176\u76f8\u53cd\u6570\u7684\u4e32\uff0c\u7136\u540e\u5c06\u8be5\u65b0\u4e32\u63a5\u5728\u539f\u4e32\u540e\u9762\uff0c\u4e2d\u95f4\u63d2\u4e0a\u4e00\u4e2a\u4ece\u672a\u51fa\u73b0\u8fc7\u7684\u5b57\u7b26\u8dd1SA\uff08\u660e\u663e\uff0c\u5e94\u8be5\u5148\u628a\u6570\u7ec4\u4e2d\u6240\u6709\u4e1c\u897f\u79bb\u6563\u5316\u6389\uff0c\u4e0d\u7136\u6ca1\u6cd5\u8dd1\u6876\u6392\uff09\u3002\u4e8e\u662f\uff0c\u73b0\u5728\u5f97\u5230\u7684\u5927\u4e32\uff0c\u4e0b\u6807\u662f $1\\sim2n-1$\uff0c\u5176\u4e2d $1\\sim n-1$ \u6765\u81ea\u4e8e\u539f\u4e32\uff0c$n+1\\sim 2n-1$ \u6765\u81ea\u4e8e\u65b0\u4e32\uff0c\u4f4d\u7f6e $n$ \u662f\u5206\u9694\u7b26\u3002\n\n\u540e\u7f00\u6392\u5e8f\u540e\uff0c\u6211\u4eec\u627e\u5230\u4ee5\u4f4d\u7f6e $n+l$ \u5f00\u5934\u7684\u540e\u7f00\uff0c\u5176\u5f00\u5934 $r-l$ \u4f4d\u5373\u4e3a\u6211\u4eec\u9700\u8981\u7684\u4e1c\u897f\u7684\u76f8\u53cd\u6570\u3002\u5728\u540e\u7f00\u6570\u7ec4\u91cc\u8be5\u540e\u7f00\u4e24\u8fb9\u4e8c\u5206\u51fa\u6240\u6709\u4e0e\u5176 $\\text{LCP}$ \u957f\u5ea6\u4e0d\u5c0f\u4e8e $r-l$ \u7684\u540e\u7f00\uff0c\u5373\u4e3a\u6240\u6709\u5408\u6cd5\u540e\u7f00\u7684\u5907\u9009\u3002\n\n\u63a5\u7740\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u6211\u4eec\u9700\u8981\u7684\uff0c\u5c31\u662f\u5728\u4e0a\u8ff0\u533a\u95f4\u4e2d\uff0c\u7b26\u5408\u6211\u4eec\u4e4b\u524d\u8981\u6c42\uff08\u6765\u81ea $\\Big[1,l-(r-l+1)\\Big]\\cup[r+1,n]$ \u5185\uff09\u7684\u540e\u7f00\u7684\u6570\u91cf\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u4e8c\u7ef4\u6570\u70b9\u95ee\u9898\uff0c\u76f4\u63a5\u4e0a\u4e2a\u7ebf\u6bb5\u6811\u6216\u662f\u4e3b\u5e2d\u6811\u4e4b\u7c7b\u968f\u968f\u4fbf\u4fbf\u8dd1\u4e00\u4e0b\u5c31\u51fa\u6765\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,a[100100],s[200100],m,N,sa[200100],ht[200100],rk[200100],buc[200100],st[200100][20],LG[200100];\nvector<int>v;\nvoid SA(){\n\tfor(int i=1;i<=N;i++)buc[rk[i]=s[i]]++;\n\tfor(int i=1;i<=m;i++)buc[i]+=buc[i-1];\n\tfor(int i=N;i;i--)sa[buc[rk[i]]--]=i;\n\tfor(int k=1;k<=N;k<<=1){\n\t\tint num=0;\n\t\tfor(int i=N-k+1;i<=N;i++)ht[++num]=i;\n\t\tfor(int i=1;i<=N;i++)if(sa[i]>k)ht[++num]=sa[i]-k;\n\t\tfor(int i=1;i<=m;i++)buc[i]=0;\n\t\tfor(int i=1;i<=N;i++)buc[rk[ht[i]]]++;\n\t\tfor(int i=1;i<=m;i++)buc[i]+=buc[i-1];\n\t\tfor(int i=N;i;i--)sa[buc[rk[ht[i]]]--]=ht[i],ht[i]=0;\n\t\tswap(ht,rk),rk[sa[1]]=num=1;\n\t\tfor(int i=2;i<=N;i++)rk[sa[i]]=(ht[sa[i]]==ht[sa[i-1]]&&ht[sa[i]+k]==ht[sa[i-1]+k]?num:++num);\n\t\tm=num;\n\t\tif(num==N)break;\n\t}\n\tfor(int i=1;i<=N;i++)ht[i]=0;\n\tfor(int i=1,k=0;i<=N;i++){\n\t\tif(rk[i]==1)continue;\n\t\tif(k)k--;\n\t\tint j=sa[rk[i]-1];\n\t\twhile(i+k<=N&&j+k<=N&&s[i+k]==s[j+k])k++;\n\t\tht[rk[i]]=k;\n\t}\n\tfor(int i=2;i<=N;i++)LG[i]=LG[i>>1]+1;\n\tfor(int i=1;i<=N;i++)st[i][0]=ht[i];\n\tfor(int j=1;j<=LG[N];j++)for(int i=1;i+(1<<j)-1<=N;i++)st[i][j]=min(st[i][j-1],st[i+(1<<(j-1))][j-1]);\n}\nint LCP(int x,int y){//the LCP between two suffixes, ranked x and y in the sa array.\n\tif(x>y)swap(x,y);\n\tx++;\n\tint k=LG[y-x+1];\n\treturn min(st[x][k],st[y-(1<<k)+1][k]);\n}\nvoid range(int l,int r,int &L,int &R){\n\tint x=rk[n+l],len=r-l;\n\tl=1,r=x;\n\twhile(l<r){\n\t\tint mid=(l+r)>>1;\n\t\tif(LCP(mid,x)>=len)r=mid;\n\t\telse l=mid+1;\n\t}\n\tL=r;\n\tl=x,r=N;\n\twhile(l<r){\n\t\tint mid=(l+r+1)>>1;\n\t\tif(LCP(mid,x)>=len)l=mid;\n\t\telse r=mid-1;\n\t}\n\tR=l;\n}\n\n#define lson x<<1\n#define rson x<<1|1\n#define mid ((l+r)>>1)\nint sum[400100];\nvoid modify(int x,int l,int r,int P){\n\tif(l>P||r<P)return;\n\tsum[x]++;\n\tif(l!=r)modify(lson,l,mid,P),modify(rson,mid+1,r,P);\n}\nint query(int x,int l,int r,int L,int R){\n\tif(l>R||r<L)return 0;\n\tif(L<=l&&r<=R)return sum[x];\n\treturn query(lson,l,mid,L,R)+query(rson,mid+1,r,L,R);\n}\n\nint ql[100100],qr[100100],res[100100];\nvector<int>u[200100];\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<n;i++)s[i]=a[i+1]-a[i],s[n+i]=-s[i],v.push_back(s[i]),v.push_back(s[n+i]);\n\tsort(v.begin(),v.end()),v.resize(m=unique(v.begin(),v.end())-v.begin());\n\tfor(int i=1;i<n;i++)s[i]=lower_bound(v.begin(),v.end(),s[i])-v.begin()+1,s[n+i]=lower_bound(v.begin(),v.end(),s[n+i])-v.begin()+1;\n\ts[n]=++m,N=2*n-1,SA();\n//\tfor(int i=1;i<=N;i++)printf(\"%2d \",i);puts(\"\");\n//\tfor(int i=1;i<=N;i++)printf(\"%2d \",s[i]);puts(\"\");\n//\tfor(int i=1;i<=N;i++)printf(\"%2d \",sa[i]);puts(\"\");\n//\tfor(int i=1;i<=N;i++)printf(\"%2d \",rk[i]);puts(\"\");\n\tscanf(\"%d\",&m);\n\tfor(int i=1,l,r;i<=m;i++){\n\t\tscanf(\"%d%d\",&l,&r);\n\t\tif(l==r){res[i]=n-1;continue;}\n\t\tint L,R;range(l,r,L,R);\n\t\tu[L-1].push_back(-i),u[R].push_back(i);\n\t\tql[i]=l-(r-l+1),qr[i]=r+1;\n//\t\tprintf(\"%d %d %d %d\\n\",L,R,ql[i],qr[i]);\n\t}\n\tfor(int i=1;i<=N;i++){\n\t\tif(sa[i]<n)modify(1,1,n,sa[i]);\n\t\tfor(auto x:u[i]){\n\t\t\tint now=query(1,1,n,1,ql[abs(x)])+query(1,1,n,qr[abs(x)],n);\n\t\t\tif(x>0)res[x]+=now;\n\t\t\telse res[-x]-=now;\n\t\t}\n\t}\n\tfor(int i=1;i<=m;i++)printf(\"%d\\n\",res[i]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1611725168,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF232D \u3010Fence\u3011"
    }
]