[
    {
        "content": "\u4e00\u9053\u4ee3\u7801\u91cf\u4e0d\u5927\u4f46\u662f\u6709\u70b9\u9ebb\u70e6\u7684\u9898\u3002\u3002\u3002\n\n\u9996\u5148\u8003\u8651\u4e00\u4e2a\u51f8\u591a\u8fb9\u5f62\u7684\u9762\u79ef\u600e\u4e48\u6c42\u3002\u8bbe\u70b9\u96c6\u987a\u65f6\u9488\u65b9\u5411\u5206\u522b\u4e3a$p_0,p_1...p_{n}$\uff0c\u90a3\u4e48\u9762\u79ef\u5c31\u4f1a\u662f$\\sum_{i=0}^{n}p_i\\times p_{(i-1+n)\\%n}$\u3002\uff08\u96642\u7701\u7565\uff09\n\n\u90a3\u4e48\u901a\u8fc7\u8fd9\u4e2a\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u76f8\u90bb\u4e24\u4e2a\u70b9\u7684\u524d\u7f00\u548c\u7684\u524d\u7f00\u548c\u6765\u5feb\u901f\u5f97\u5230\u4ee5\u4e00\u4e2a\u70b9\u4e3a\u56fa\u5b9a\u70b9\uff0c\u987a\u65f6\u9488\u65b9\u5411\u82e5\u5e72\u4e2a\u51f8\u591a\u8fb9\u5f62\u7684\u9762\u79ef\u548c\u3002\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u56fa\u5b9a\u5212\u5206\u7ebf\u7684\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u627e\u5230\u6700\u540e\u4e00\u4e2a\u8fd9\u4e2a\u70b9\u548c\u56fa\u5b9a\u70b9\u4e3a\u7ebf\u5212\u5206\u7684\u9006\u65f6\u9488\u65b9\u5411\u6bd4\u987a\u65f6\u9488\u65b9\u5411\u9762\u79ef\u5c0f\u7684\u70b9\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u6cd5\u6c42\u51fa\u9762\u79ef\u548c\uff0c\u7136\u540e\u53ef\u4ee5\u901a\u8fc7\u603b\u9762\u79ef\u6765\u7b97\u51fa\u8fd9\u4e2a\u72b6\u6001\u4e0b\u7684\u9762\u79ef\u5dee\u7684\u548c\u4e86\u3002\u7136\u540e\u663e\u7136\u968f\u7740\u56fa\u5b9a\u70b9\u5411\u987a\u65f6\u9488\u7684\u4e0d\u65ad\u79fb\u52a8\uff0c\u53e6\u4e00\u4e2a\u70b9\u4e5f\u662f\u4e0d\u65ad\u7684\u5411\u987a\u65f6\u9488\u65b9\u5411\u79fb\u52a8\u7684\uff0c\u4e8e\u662f\u7528\u53cc\u6307\u9488\u5373\u53ef\u3002\n\n\u8fd9\u6837\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6$O(n)$\u3002\n\n\u6700\u540e\u6ce8\u610f\u4e00\u4e0b\u8fd9\u9053\u9898\u7b54\u6848\u9700\u8981\u53d6\u6a21\u800c\u9762\u79ef\u662f\u4e0d\u80fd\u53d6\u6a21\u6bd4\u5927\u5c0f\u7684\u3002\n\ncode\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define maxn 500010\n#define mod 1000000007\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\nint read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch-'0'<0||ch-'0'>9){if(ch=='-') f=-1;ch=getchar();}\n    while(ch-'0'>=0&&ch-'0'<=9){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nint n;\nstruct P{\n    ll x,y;\n}p[maxn*2],sum[maxn*2];\nP operator + (P a,P b)\n{\n    return (P){(a.x+b.x)%mod,(a.y+b.y)%mod};\n}\nP operator - (P a,P b)\n{\n    return (P){a.x-b.x,a.y-b.y};\n}\nP operator * (P a,ll b)\n{\n    return (P){a.x*b,a.y*b};\n}\nll operator * (P a,P b)\n{\n    return a.x*b.y-a.y*b.x;\n}\null All;\nll s[maxn*2],ss[maxn*2];\nint main()\n{\n    n=read();\n    for(int i=1;i<=n;i++)  p[i].x=read(),p[i].y=read();\n    for(int i=1;i<=n;i++)  All+=(p[i%n+1]-p[0])*(p[i]-p[0]);\n    for(int i=n+1;i<=2*n;i++)  p[i]=p[i-n];\n    for(int i=1;i<=2*n;i++)  s[i]=p[i]*p[i-1]%mod;\n    for(int i=1;i<=2*n;i++)  s[i]=(s[i]+s[i-1])%mod;\n    for(int i=1;i<=2*n;i++)  ss[i]=(ss[i-1]+s[i])%mod;\n    for(int i=1;i<=2*n;i++)  sum[i]=sum[i-1]+p[i];\n    int R=1;\n    ull S=0;\n    ll ans=0;\n    for(int i=1;i<=n;i++)\n    {\n        while(S+p[R]*p[i]+p[R+1]*p[R]+p[i]*p[R+1]<=All/2)\n        {\n            S+=p[R]*p[i]+p[R+1]*p[R]+p[i]*p[R+1];\n            R++;\n        }\n        if(i!=R)\n        {\n            ll s1=((ss[R]-ss[i]-1ll*(R-i)*s[i]%mod+p[i]*(sum[R]-sum[i])%mod)%mod+mod)%mod;\n            ans=(ans+(All%mod*(R-i-1)%mod-2*s1%mod+mod)%mod)%mod;\n            S+=p[i]*p[i+1]+p[i+1]*p[R]+p[R]*p[i];            \n        }\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1582291867,
        "uid": 46396,
        "name": "justin_cao",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF611G \u3010New Year and Cake\u3011"
    },
    {
        "content": "> [CF611G New Year and Cake](https://codeforc.es/contest/611/problem/G)\n\n## \u9898\u610f\n\n- \u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u9876\u70b9\u7684\u4e25\u683c\u51f8\u591a\u8fb9\u5f62\u3002\n- \u8981\u6c42 $\\frac{n(n-3)}2$ \u4e2a**\u7531\u5bf9\u89d2\u7ebf\u5c06\u591a\u8fb9\u5f62\u5272\u6210\u4e24\u4e2a\u90e8\u5206\u7684\u9762\u79ef\u5dee $\\times 2$** \u4e4b\u548c\u3002\n- $n \\le 5 \\times 10^5$\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n## \u9898\u89e3\n\n\u53cc\u6307\u9488\u626b\u4e00\u904d\uff0c\u52a8\u6001\u7ef4\u62a4\u5bf9\u89d2\u7ebf\u9694\u5f00\u7684\u6700\u5927\u9762\u79ef\u4ee5\u53ca\u9762\u79ef\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u548c\uff0c\u5176\u4e2d\u8d21\u732e\u9700\u8981\u5229\u7528\u53c9\u79ef\u7684\u5206\u914d\u7387\u7ef4\u62a4\u6709\u8d21\u732e\u7684\u5411\u91cf\u548c\u3002\n\n\u6ce8\u610f\u672c\u9898\u6839\u636e\u5199\u6cd5\u4e0d\u540c\u53ef\u80fd\u9700\u8981\u5f00 `unsigned long long`\uff0c\u4f46\u540c\u65f6\u9700\u8981\u5bf9\u7b54\u6848\u53d6\u6a21\uff0c\u56e0\u6b64\u7ec6\u8282\u5f88\u591a\u3002\n\n## \u4ee3\u7801\n\n```cpp\nstruct Po {\n\tint x, y;\n\tinline Po &operator -= (Po o) { return x -= o.x, y -= o.y, *this; }\n\tinline friend Po operator - (Po a, Po b) { return a -= b; }\n\tinline friend ll operator % (Po a, Po b) { return 1ll * a.x * b.y - 1ll * a.y * b.x; }\n};\n\ninline pair< modint, modint > &operator += (pair< modint, modint > &a, Po b) {\n\treturn a.fi += (b.x % P + P) % P, a.se += (b.y % P + P) % P, a;\n}\n\ninline modint operator % (pair< modint, modint > a, Po b) {\n\treturn a.fi * ((b.y % P + P) % P) - a.se * ((b.x % P + P) % P);\n}\n\ninline pair< modint, modint > operator * (modint a, Po b) {\n\treturn mp(a * ((b.x % P + P) % P), a * ((b.y % P + P) % P));\n}\n\ninline pair< modint, modint > &operator -= (pair< modint, modint > &a, pair< modint, modint > b) {\n\treturn a.fi -= b.fi, a.se -= b.se, a;\n}\n\nconst int N = 5e5 + 7;\nint n, cnt;\nPo a[N];\nmodint ans, o;\npair< modint, modint > p;\nul s, m;\n\nint main() {\n\trd(n);\n\tfor (int i = 0; i < n; i++) rd(a[i].x), rd(a[i].y);\n\tfor (int i = 2; i < n; i++) s += (a[i] - a[0]) % (a[i-1] - a[0]);\n\tfor (int i = 0, j = 0; i < n; i++) {\n\t\twhile (1) {\n\t\t\tint k = (j + 1) % n;\n\t\t\tul w = (a[k] - a[i]) % (a[j] - a[i]);\n\t\t\tif (2 * (m + w) >= s) {\n\t\t\t\tif (2 * (m + w) == s) ++cnt;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\to += (m += w) % P;\n\t\t\tp += a[k] - a[i];\n\t\t\tj = k;\n\t\t}\n\t\tans -= o * 2;\n\t\tint k = (i + 1) % n;\n\t\tm -= (a[j] - a[i]) % (a[k] - a[i]);\n\t\to -= p % (a[k] - a[i]);\n\t\tp -= (modint)((j - i + n) % n) * (a[k] - a[i]);\n\t}\n\tans += (modint)((1ll * n * (n - 3) - cnt) / 2 % P) * (modint)(s % P);\n\tprint(ans);\n\treturn 0;\n}\n```",
        "postTime": 1575277028,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF611G \u3010New Year and Cake\u3011"
    },
    {
        "content": "### CF 611G\n#### Solution\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $l$ \u6211\u4eec\u6c42\u51fa\u4e00\u4e2a\u6700\u5927\u7684 $r$ \u4f7f\u5f97 $[l,r]$ \u8fd9\u4e00\u8fb9\u7684\u591a\u8fb9\u5f62\u7684\u9762\u79ef\u5c0f\u4e8e\u7b49\u4e8e\u53e6\u4e00\u8fb9\u7684\u9762\u79ef\uff08\u8fd9\u91cc\u7684\u533a\u95f4\u6307\u7684\u662f\u5faa\u73af\u4e0b\u7684\u6709\u5e8f\u533a\u95f4\uff09\uff0c\u90a3\u4e48\u4e2d\u95f4\u7684\u8d21\u732e\u662f\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u6ce8\u610f\u5230\u968f\u7740 $l$ \u9012\u589e\uff0c$r$ \u5355\u8c03\u4e0d\u964d\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u524d\u7f00\u548c\uff0c\u7136\u540e\u53cc\u6307\u9488\u626b\u4e00\u904d\u8ba1\u7b97\u7b54\u6848\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n)$ \u3002\n\n#### Code\n```cpp\nint n;\nll a[MAXN],b[MAXN];\n\nstruct Vector{\n    ll x,y;\n    Vector(ll _x = 0, ll _y = 0) : x(_x), y(_y) {}\n    ll operator * (const Vector &rhs) const {return x * rhs.y - y * rhs.x;}\n    Vector operator + (const Vector &rhs) const {return Vector(x + rhs.x,y + rhs.y);}\n    Vector operator - (const Vector &rhs) const {return Vector(x - rhs.x,y - rhs.y);}\n    Vector operator % (const int &rhs) const {return Vector(x % rhs,y % rhs);}\n} p[MAXN],pre[MAXN];\n\nint main(){\n    scanf(\"%d\",&n);\n    for(int i = 1,x,y;i <= n;i++){\n        scanf(\"%d%d\",&x,&y); p[i] = Vector(x,y);\n        pre[i] = (pre[i - 1] + p[i]) % MOD;\n    }\n    for(int i = 2;i <= n;i++){\n        b[i] = b[i - 1] + p[i - 1] * p[i];\n        a[i] = (a[i - 1] + b[i]) % MOD;\n    }\n    b[n + 1] = b[n] + p[n] * p[1]; ll tot = llabs(b[n + 1]); ll ans = 0;\n    for(int l = 1, r = 3;r <= n;r++){\n        while(l < r - 1 && tot / 2.0 < llabs(b[r] - b[l] + p[r] * p[l])) l += 1;\n        ans = (ans + b[r] % MOD * (r - l - 1) - (a[r - 2] - a[l - 1]) + p[r] * (pre[r - 2] - pre[l - 1])) % MOD;\n        ans = (ans + a[l - 1] + pre[l - 1] * p[r] + (b[n + 1] - b[r]) % MOD * (l - 1) % MOD) % MOD;\n        ans = (ans + MOD) % MOD;\n    }\n    ans = (ans + tot % MOD * inv4 % MOD * n % MOD * (n - 3) % MOD) % MOD;\n    ans = ans * 2 % MOD; printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1612712859,
        "uid": 108894,
        "name": "\u5173\u6000\u4ed6\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF611G \u3010New Year and Cake\u3011"
    }
]