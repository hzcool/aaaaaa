[
    {
        "content": "\u8003\u8651\u5bb9\u65a5\u3002\u79f0\u6ee1\u8db3 $ b_i = b_{i + 1} (1 \\leqslant i < n) $ \u7684 $ i $ \u4e3a\u5173\u952e\u70b9\u3002\u5219\u9898\u610f\u8981\u6c42\u7684\u662f\u6709 $ 0 $ \u4e2a\u5173\u952e\u70b9\u7684 $ \\{b_n\\} $ \u7684\u6570\u91cf\u3002\n\n\u5bb9\u6613\u53d1\u73b0\n\n$$ \\text{\u7b54\u6848} = \\text{\u81f3\u5c11\u6709 } 0 \\text{ \u4e2a\u5173\u952e\u70b9\u7684\u7b54\u6848} - \\text{\u81f3\u5c11\u6709 } 1 \\text{ \u4e2a\u5173\u952e\u70b9\u7684\u7b54\u6848} + ... + (-1)^{n - 1} \\text{\u81f3\u5c11\u6709 } n - 1 \\text{ \u4e2a\u5173\u952e\u70b9\u7684\u7b54\u6848} $$\n\n\u89c2\u5bdf\u53d1\u73b0\u957f\u5ea6\u4e3a $ n $\uff0c**\u81f3\u5c11**\u6709 $ k $ \u4e2a\u5173\u952e\u70b9\u7684\u4e00\u7ec4 $ \\{b_n\\} $ \u5176\u5b9e\u662f\u5c06\u6574\u4e2a\u6570\u7ec4\u5206\u6210\u4e86\u8fde\u7eed $ n - k $ \u6bb5\uff0c**\u6bcf\u6bb5\u7684 $ b_i $ \u4e00\u5b9a\u76f8\u540c**\uff0c\u4f46**\u76f8\u90bb\u7684\u4e24\u6bb5\u7684\u6570\u53ef\u76f8\u540c\u53ef\u4e0d\u540c**\uff0c\u8fd9\u662f\u5bb9\u65a5\u601d\u60f3\u7684\u6838\u5fc3\u3002\n\n\u5b9a\u4e49 $ f_{i, 0/1} $ \u4e3a $ b_1, ..., b_i $ \u8fd9\u4e00\u6bb5\u6392\u5217\uff0c\u5206\u6210\u8fde\u7eed\u7684\u5076\u6570\u6bb5 / \u5947\u6570\u6bb5\u7684\u65b9\u6848\u6570\uff0c\u5176\u4e2d\u6bcf\u6bb5 $ b_j $ \u4e00\u5b9a\u76f8\u540c\uff0c\u76f8\u90bb\u4e24\u6bb5\u65e0\u8981\u6c42\u3002\n\n\u5219\u6709\n\n$$ \\text{\u7b54\u6848} = (-1)^{n}(f_{n, 0} - f_{n, 1}) $$\n\n\u8003\u8651\u5982\u4f55\u8f6c\u79fb\u3002\u679a\u4e3e $ i $ \u6240\u5728\u7684\u4e00\u6bb5\u7684\u5de6\u7aef\u70b9 $ j $\uff0c\u53ef\u4ee5\u5f97\u5230\n\n$$ f_{i, 0/1} = \\sum_{j = 1}^i f_{j - 1, 1/0} (\\min_{k = j}^i a_k) $$\n\n$ \\min_{k= j}^i a_k $ \u7684\u542b\u4e49\u662f $ b_j, ..., b_i $ \u8fd9\u4e9b\u6570\u53ea\u80fd\u662f\u540c\u4e00\u4e2a\u6570\uff0c\u53d6\u503c\u8303\u56f4\u81ea\u7136\u662f\u8fd9\u4e2a\u533a\u95f4\u4e2d\u6700\u5c0f\u7684 $ a_i $\u3002\n\n\u53d1\u73b0\u8fd9\u6837\u8f6c\u79fb\u662f $ O(n^2) $ \u7684\u3002\u8003\u8651\u5728 $ \\min $ \u7684\u5355\u8c03\u6027\u4e0a\u505a\u4f18\u5316\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a $ a_i $ \u4e25\u683c\u9012\u589e\u7684\u5355\u8c03\u6808\u3002\u5728\u505a $ f_{i, 0/1} $ \u65f6\uff0c\u5355\u8c03\u6808\u7684\u6808\u9876\u5e94\u8be5\u662f $ i (a_i) $\uff0c\u8bbe\u6808\u9876\u7684\u4e0b\u4e00\u4f4d\u5143\u7d20\u662f $ x (a_x) $\u3002\u5219\u6709\n\n$$ f_{i, 0/1} = f_{x, 0/1} + a_i \\sum_{j = x + 1}^i f_{j - 1, 1/0} $$\n\n\u89e3\u91ca\uff1a\u56e0\u4e3a $ a_x $ \u662f $ i $ \u5f80\u5de6\u8d70\u7b2c\u4e00\u4e2a\u6bd4 $ a_i $ \u5927\u7684\u6570\uff0c\u6240\u4ee5\u8f6c\u79fb\u65b9\u7a0b\u4e2d\uff0c$ j $ \u53d6 $ 1 $ \u5230 $ x $ \u7684\u4efb\u4f55\u6570\uff0c$ \\min_{k = j}^i a_k $ \u90fd\u4e0e $ \\min_{k = j}^x a_k $ \u76f8\u7b49\u3002\u56e0\u6b64\u8fd9\u4e9b $ j $ \u5bf9 $ f_{i, 0/1} $ \u7684\u8d21\u732e\u4e4b\u548c\u5c31\u7b49\u4e8e $ f_{x, 0/1} $\u3002\n\n\u800c $ a_{x + 1} $ \u5230 $ a_{i - 1} $ \u7684\u6570\u90fd\u5c0f\u4e8e\u7b49\u4e8e $ a_i $\u3002\u56e0\u6b64 $ j $ \u53d6 $ x + 1 $ \u5230 $ i $ \u7684\u4efb\u4f55\u6570\uff0c\u90fd\u6709 $ \\min_{k = j}^i a_k = a_i $\u3002\u56e0\u6b64\u8fd9\u4e9b $ j $ \u5bf9 $ f_{i, 0/1} $ \u7684\u8d21\u732e\u4e4b\u548c\u5c31\u662f $ a_i \\sum\\limits_{j = x + 1}^i f_{j - 1, 1/0} $\u3002\u663e\u7136\u53ef\u4ee5\u901a\u8fc7\u7ef4\u62a4 $ f_{i, 0/1} $ \u7684\u524d\u7f00\u548c\u5feb\u901f\u8ba1\u7b97\u3002\n\n\u6ce8\u610f\u6808\u4e2d\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u65f6\uff0c$ f_{i, 0/1} = a_i \\sum\\limits_{j = 1}^i f_{j - 1, 1/0} $\u3002\u6b64\u65f6 $ a_i $ \u5927\u4e8e $ a_1 $ \u5230 $ a_{i - 1} $ \u7684\u6240\u6709\u6570\uff0c\u4e5f\u5c31\u4e0d\u5b58\u5728\u8fd9\u6837\u7684 $ x $\u3002\n\n\u8fb9\u754c\u6761\u4ef6\u4e3a $ f_{0, 0} = 1, f_{0, 1} = 0 $\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $ \\Theta(n) $\u3002\n\n~~\u770b\u9898\u89e3\u4e5f\u5c31\u56fe\u4e00\u4e50 \u771f\u7406\u89e3\u8fd8\u5f97\u770b\u4ee3\u7801~~\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int mod = 998244353;\ntypedef long long ll;\n#define int ll\nint a[200010], f[200010][2], s[200010][2];\nint stk[200010], cnt = 0;\ninline int p1(int x)\n{\n\treturn (x & 1) ? mod - 1 : 1;\n}\nsigned main()\n{\n\tint n;\n\tscanf(\"%lld\", &n);\n\tfor(int i = 1; i <= n; i++)\n\t\tscanf(\"%lld\", &a[i]);\n\tf[0][0] = s[0][0] = 1, f[0][1] = s[0][1] = 0;\n\tstk[0] = 0;\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\twhile(cnt && a[stk[cnt]] >= a[i])\n\t\t\tcnt--;\n\t\tstk[++cnt] = i;\n\t\tf[i][0] = ((cnt == 1 ? 0 : f[stk[cnt - 1]][0]) + (s[i - 1][1] - (cnt == 1 ? 0 : s[stk[cnt - 1] - 1][1]) + mod) * a[i]) % mod;\n\t\tf[i][1] = ((cnt == 1 ? 0 : f[stk[cnt - 1]][1]) + (s[i - 1][0] - (cnt == 1 ? 0 : s[stk[cnt - 1] - 1][0]) + mod) * a[i]) % mod;\n\t\ts[i][0] = (s[i - 1][0] + f[i][0]) % mod;\n\t\ts[i][1] = (s[i - 1][1] + f[i][1]) % mod;\n\t}\n\tprintf(\"%lld\\n\", (f[n][0] - f[n][1] + mod) * p1(n) % mod);\n\treturn 0;\n}\n\n```",
        "postTime": 1639384601,
        "uid": 73645,
        "name": "_ztyqwq",
        "ccfLevel": 0,
        "title": "CF1591F Non-equal Neighbours"
    },
    {
        "content": "\u5446\u5446\u9898\uff0c\u63d0\u4f9b\u4e00\u79cd\u5341\u5206\u5446\u5446\u7684\u505a\u6cd5\u3002\n\n\u6211\u4eec\u5148\u66b4\u529b DP\uff0c\u4ee4 $dp_{i,j}$ \u8868\u793a\u5f53\u524d\u586b\u6570\u5230\u7b2c $i$ \u4f4d\uff0c\u7b2c $i$ \u4f4d\u586b\u4e86 $j$ \u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u8f6c\u79fb\u5373\u4e3a $dp_{i,j}=\\sum\\limits_{k\\not=j}dp_{i-1,k}(1\\le j\\le a_i)$\uff0c\u8fd9\u4e2a\u8f6c\u79fb\u5c31\u76f8\u5f53\u4e8e\u662f\u4f60\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u5e8f\u5217 $b$\uff0c\u6bcf\u6b21\u5c06 $1\\le j\\le a_i$ \u7684 $b_j$ \u53d8\u4e3a $sum-b_j$\uff08$sum$ \u4e3a $b$ \u5e8f\u5217\u7684\u548c\uff09\uff0c\u5c06 $j\\ge a_i$ \u7684 $b_j$ \u53d8\u4e3a $0$\uff0c\u8fd9\u4e2a\u5c31\u76f8\u5f53\u4e8e\u7ef4\u62a4\u533a\u95f4\u4e58 $-1$ \u548c $0$\uff0c\u533a\u95f4\u52a0 $sum$\uff0c\u67e5\u8be2\u5168\u5c40\u548c\uff0c\u5c31\u662f\u7ebf\u6bb5\u68112\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log val)$\uff0c$val$ \u662f\u503c\u57df\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 2e5 + 5, mod = 998244353;\nint n, ls[N * 60], rs[N * 60], tr[N * 60], tag1[N * 60], tag2[N * 60], rt, a[N], cnt;\nint NewNode() {tag2[++cnt] = 1; return cnt;}\nvoid pd1(int p, int l, int r) {\n\tif (tag1[p]) {\n\t\tint mid = l + r >> 1;\n\t\tif (!ls[p]) ls[p] = NewNode();\n\t\tif (!rs[p]) rs[p] = NewNode();\n\t\ttr[ls[p]] = (tr[ls[p]] + 1ll * tag1[p] * (mid - l + 1)) % mod;\n\t\ttr[rs[p]] = (tr[rs[p]] + 1ll * tag1[p] * (r - mid)) % mod;\n\t\ttag1[ls[p]] = (tag1[ls[p]] + tag1[p]) % mod;\n\t\ttag1[rs[p]] = (tag1[rs[p]] + tag1[p]) % mod;\n\t\ttag1[p] = 0;\n\t}\n}\nvoid pd2(int p) {\n\tif (tag2[p] != 1) {\n\t\tif (!ls[p]) ls[p] = NewNode();\n\t\tif (!rs[p]) rs[p] = NewNode();\n\t\ttr[ls[p]] = 1ll * tr[ls[p]] * tag2[p] % mod;\n\t\ttr[rs[p]] = 1ll * tr[rs[p]] * tag2[p] % mod;\n\t\ttag2[ls[p]] = 1ll * tag2[ls[p]] * tag2[p] % mod;\n\t\ttag2[rs[p]] = 1ll * tag2[rs[p]] * tag2[p] % mod;\n\t\ttag1[ls[p]] = 1ll * tag1[ls[p]] * tag2[p] % mod;\n\t\ttag1[rs[p]] = 1ll * tag1[rs[p]] * tag2[p] % mod;\n\t\ttag2[p] = 1;\n\t}\n}\nvoid push_up(int p) {tr[p] = (tr[ls[p]] + tr[rs[p]]) % mod;}\nvoid modify(int &p, int l, int r, int x, int y, int z, int op) {\n\tif (x > y) return;\n\tif (!p) p = NewNode();\n\tif (l >= x && r <= y) {\n\t\tif (op == 1) {\n\t\t\ttr[p] = (tr[p] + 1ll * z * (r - l + 1)) % mod;\n\t\t\tif (l != r) pd2(p), pd1(p, l, r);\n\t\t\ttag1[p] = (tag1[p] + z) % mod;\n\t\t} else {\n\t\t\ttr[p] = 1ll * z * tr[p] % mod;\n\t\t\tif (l != r) pd2(p), pd1(p, l, r);\n\t\t\ttag2[p] = 1ll * tag2[p] * z % mod;\n\t\t}\n\t\treturn;\n\t}\n\tpd2(p); pd1(p, l, r); int mid = l + r >> 1;\n\tif (mid >= x) modify(ls[p], l, mid, x, y, z, op);\n\tif (mid < y) modify(rs[p], mid + 1, r, x, y, z, op);\n\tpush_up(p);\n}\n\nint main() {\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]);\n\tmodify(rt, 1, 1e9, 1, a[1], 1, 1);\n\tfor (int i = 2; i <= n; i++) {\n\t\tint sum = tr[rt];\n\t\tmodify(rt, 1, 1e9, 1, a[i], -1, 2);\n\t\tmodify(rt, 1, 1e9, 1, a[i], sum, 1);\n\t\tmodify(rt, 1, 1e9, a[i] + 1, 1e9, 0, 2);\n\t}\n\tprintf(\"%d\\n\", (tr[rt] + mod) % mod);\n\treturn 0;\n}\n```",
        "postTime": 1639374384,
        "uid": 108610,
        "name": "Dzhao",
        "ccfLevel": 7,
        "title": "CF1591F Non-equal Neighbours"
    },
    {
        "content": "[AtCoder\u76f8\u540c\u9898\u76ee\uff08\u9664\u8303\u56f4\uff09](https://atcoder.jp/contests/arc115/tasks/arc115_e)~~\u53cc\u500d\u7ecf\u9a8c~~\n\n### Analysis\n\n\u8bbe $f_n$ \u8868\u793a\u524d $n$ \u4e2a\u6570\u6ee1\u8db3\u6761\u4ef6\u7684\u65b9\u6848\u6570\u3002\n\n\u7531\u5bb9\u65a5\u539f\u7406\u5f97\uff08\u89c4\u5b9a $f_0=1$\uff09\uff1a\n\n$$f_n=\\sum\\limits_{i=0}^{n-1}(-1)^{n-i+1}f_i\\min\\limits_{j=i+1}^{n}a_j$$\n\n\u5176\u4e2d $f_i\\min\\limits_{j=i+1}^{n}a_j$ \u8868\u793a $b_y=b_{y+1}(x<y<i)$ \u4e14 $b_y\\not=b_{y+1}(y\\leqslant x)$ \u7684\u65b9\u6848\u6570\u3002\n\n\u53d1\u73b0\u8fd9\u4e0d\u662f\u4e00\u822c\u7684 DP \u4f18\u5316\u65b9\u6cd5\u2026\u2026\n\n\u627e\u5230\u6700\u5927\u7684 $k$ \u4f7f\u5f97 $0<k<n \\land a_k\\leqslant a_n$\uff0c\u7279\u5224 $k$ \u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u8f6c\u79fb\u65f6\u5f53 $i\\leqslant k-1$\uff1a\n\n$$\\min\\limits_{j=i+1}^{n}a_j=\\min\\limits_{j=i+1}^{k}a_j$$\n\n\u5373\uff1a\n\n$$\\begin{aligned}\nf_n &= a_n\\sum\\limits_{i=k}^{n-1}(-1)^{n-i+1}f_i+\\sum\\limits_{i=0}^{k-1}(-1)^{n-i+1}f_i\\min\\limits_{j=i+1}^{k}a_j\n\\\\\n&= a_n\\sum\\limits_{i=k}^{n-1}(-1)^{n-i+1}f_i+(-1)^{n-k}\\sum\\limits_{i=0}^{k-1}(-1)^{k-i+1}f_i\\min\\limits_{j=i+1}^{k}a_j\n\\\\\n&= a_n\\sum\\limits_{i=k}^{n-1}(-1)^{n-i+1}f_i+(-1)^{n-k}f_k\n\\end{aligned}$$\n\n\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u7684 $k$ \u53ef\u4ee5\u5728 $O(N)$ \u5185\u7528\u5355\u8c03\u6808\u6c42\u51fa\u3002\n\n\u8fc7\u7a0b\u4e2d\u6c42 $\\{f\\}$ \u7684\u6b63\u8d1f\u4ea4\u66ff\u7684\u524d\u7f00\u548c\uff0c\u5373\u53ef $O(1)$ \u6c42\u51fa\u6bcf\u4e00\u4e2a $\\sum\\limits_{i=k}^{n-1}(-1)^{n-i+1}f_i$\uff0c\u603b\u65f6\u95f4 $O(N)$\u3002\n\n### Code\n\n[Link](https://codeforces.com/contest/1591/submission/139476338)",
        "postTime": 1639655709,
        "uid": 101868,
        "name": "I_am_Accepted",
        "ccfLevel": 0,
        "title": "CF1591F Non-equal Neighbours"
    },
    {
        "content": "\u5bb9\u65a5\uff0c\u8bb0 $g_i$ \u8868\u793a $[1,i]$ \u7684\u7b54\u6848\u3002\n\n$$\ng_i=\\sum_{j=1}^{i-1}g_j\\times \\min_{k=j+1}^{i}a_k\\times(-1)^{i-j-1}\n$$\n\n\u8bb0 $f_i$ \u8868\u793a $g_i\\times(-1)^i$\uff0c\u8bb0 $s$ \u4e3a $f$ \u7684\u524d\u7f00\u548c\u3002\n\n\u7136\u540e\u5355\u8c03\u6808\u7ef4\u62a4\u70b9 $i$ \u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e\u5b83\u7684\u6570\u4f4d\u7f6e $k$\uff0c\u5219\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a$f_i=f_k-a_i\\times (s_{i-1}-s_{k-1})$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\n#define ha putchar(' ')\n#define he putchar('\\n')\n\ninline int read()\n{\n\tint x = 0;\n\tchar c = getchar();\n\twhile (c < '0' || c > '9')\n\t\tc = getchar();\n\twhile (c >= '0' && c <= '9')\n\t\tx = (x << 3) + (x << 1) + (c ^ 48), c = getchar();\n\treturn x;\n}\n\ninline void write(int x)\n{\n\tif(x > 9)\n\t\twrite(x / 10);\n\tputchar(x % 10 + 48);\n}\n\nconst int _ = 5e5 + 10, mod = 998244353;\n\nint n, a[_], t, sk[_];\n\nll f[_], s[_];\n\nsigned main()\n{\n\tn = read();\n\tfor(int i = 1; i <= n; ++i) a[i] = read();\n\tf[1] = s[1] = -a[1], sk[++t] = 1;\n\tfor(int i = 2; i <= n; ++i)\n\t{\n\t\twhile(t && a[sk[t]] > a[i]) t--;\n\t\tif(t == 0) f[i] = -a[i] * (s[i - 1] + 1) % mod;\n\t\telse f[i] = (f[sk[t]] - a[i] * (s[i - 1] - s[sk[t] - 1])) % mod;\n\t\ts[i] = (s[i - 1] + f[i]) % mod;\n\t\tsk[++t] = i;\n\t}\n\twrite(((n & 1 ? -1 : 1) * f[n] % mod + mod) % mod), he;\n\treturn 0;\n}\n```",
        "postTime": 1658208006,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "CF1591F Non-equal Neighbours"
    },
    {
        "content": "## \u601d\u8def\n\n\u9996\u5148\u8003\u8651\u6700\u66b4\u529b\u7684 $dp_{i,j}$\uff0c\u770b\u5230\u7b2c $i$ \u4f4d\u9009\u4e86 $b_i=j$ \uff0c\u66b4\u529b\u8f6c\u79fb $dp_{i,j}=\\sum_{k\\not=j}dp_{i-1,k}$\uff0c\u590d\u6742\u5ea6 $O(n\\times \\max\\{a_i\\})$\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u9996\u5148\u4f7f\u7528\u79bb\u6563\u5316\u5c06 $a_i$ \u5206\u6210\u82e5\u5e72\u4e2a\u533a\u95f4\uff0c\u5bb9\u6613\u53d1\u73b0\u533a\u95f4\u5185 $dp$ \u503c\u5b8c\u5168\u76f8\u7b49\uff0c\u6545\u53ef\u4ee5\u6539\u53d8\u5b9a\u4e49\u4e3a\u9009\u4e86 $a_i=l_j\\sim r_j$\uff0c\u5176\u4e2d $l_j,r_j$ \u4e3a\u533a\u95f4\u5de6\u53f3\u7aef\u70b9\uff0c\u6b64\u65f6\u590d\u6742\u5ea6\u4e3a $O(n^2)$\u3002\n\n\u7ee7\u7eed\u4f18\u5316\uff0c\u8003\u8651\u4e0a\u9762\u7684\u5f0f\u5b50\u672c\u8d28\u4e0a\u8f6c\u79fb\u53ef\u4ee5\u533a\u95f4\u7edf\u4e00\u52a0\u4e0a\u6240\u6709 $dp$ \u7684\u548c\uff0c\u533a\u95f4\u5bf9\u5f53\u524d $dp$ \u503c\u4e58\u4e0a $-1$\uff0c\u518d\u5c06\u533a\u95f4\u548c\u5168\u90e8\u52a0\u4e0a\u5373\u53ef\u3002\u9047\u5230\u5927\u4e8e $a_i$ \u7684\u533a\u95f4\u4e58 $0$\u3002\u5f88\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7ebf\u6bb5\u6811 $2$ \u7684\u677f\u5b50\u642c\u8fc7\u6765\u4f7f\u7528\u3002\u590d\u6742\u5ea6\u964d\u4f4e\u4e3a\u4e86 $O(n\\log n)$\uff0c\u5373\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint n,m;\nconst int p=998244353; \nstruct vert{\n\tint num,mul,plu,size,tg;\n};\nint a[200005],b[200005];\nstruct sgt{\n\tvert f[2000005];\n\tvoid pushup(int now){\n\t\tf[now].num=(f[now*2].num+f[now*2+1].num)%p;\n\t\tf[now].size=f[now*2].size+f[now*2+1].size; \n\t}\n\tvoid pushdown(int now){\n\t\tf[now*2].num=(f[now*2].num*f[now].mul+f[now].plu*f[now*2].size)%p;\n\t\tf[now*2+1].num=(f[now*2+1].num*f[now].mul+f[now].plu*f[now*2+1].size)%p;\n\t\tf[now*2].mul=(f[now*2].mul*f[now].mul)%p;\n\t\tf[now*2+1].mul=(f[now*2+1].mul*f[now].mul)%p;\n\t\tf[now*2].plu=(f[now*2].plu*f[now].mul+f[now].plu)%p;\n\t\tf[now*2+1].plu=(f[now*2+1].plu*f[now].mul+f[now].plu)%p;\n\t\tf[now].mul=1;\n\t\tf[now].plu=0;\n\t}\n\tvoid init(int now,int id){\n\t\tf[now].mul=1;\n\t\tf[now].plu=0;\n\t\tf[now].num=0;\n\t\tf[now].size=b[id];\n\t}\n\tvoid build(int now,int l,int r){\n\t\tif(l==r){\n\t\t\tinit(now,l);\n\t\t\treturn ; \n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tf[now].mul=1;\n\t\tbuild(now*2,l,mid);\n\t\tbuild(now*2+1,mid+1,r);\n\t\tpushup(now);\n\t}\n\tvoid modify1(int now,int l,int r,int ql,int qr,int mul1){\n\t\tif(ql<=l&&qr>=r){\n\t\t\tf[now].mul=(f[now].mul*mul1)%p;\n\t\t\tf[now].plu=(f[now].plu*mul1)%p;\n\t\t\tf[now].num=(f[now].num*mul1)%p;\n\t\t\treturn ;\n\t\t}\n\t\tif(ql>r||qr<l) return ;\n\t\tpushdown(now);\n\t\tint mid=(l+r)>>1;\n\t\tmodify1(now*2,l,mid,ql,qr,mul1);\n\t\tmodify1(now*2+1,mid+1,r,ql,qr,mul1);\n\t\tpushup(now);\n\t}\n\tvoid modify2(int now,int l,int r,int ql,int qr,int plu1){\n\t\tif(ql<=l&&qr>=r){\n\t\t\tf[now].plu=(f[now].plu+plu1)%p;\n\t\t\tf[now].num=(f[now].num+plu1*f[now].size)%p;\n\t\t\treturn ;\n\t\t}\n\t\tif(ql>r||qr<l) return ;\n\t\tpushdown(now);\n\t\tint mid=(l+r)>>1;\n\t\tmodify2(now*2,l,mid,ql,qr,plu1);\n\t\tmodify2(now*2+1,mid+1,r,ql,qr,plu1);\n\t\tpushup(now);\n\t}\n\tint qry(int now,int l,int r,int ql,int qr){\n\t\tif(ql<=l&&qr>=r) return f[now].num;\n\t\tif(ql>r||qr<l) return 0;\n\t\tpushdown(now);\n\t\tint mid=(l+r)>>1;\n\t\treturn (qry(now*2,l,mid,ql,qr)+qry(now*2+1,mid+1,r,ql,qr))%p;\n\t}\n}tree;\nint t[200005];\nsigned main(){\n\tint n;\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) cin>>a[i];\n\tfor(int i=1;i<=n;i++) t[i]=a[i];\n\tsort(t+1,t+n+1);\n\tt[0]=0;\n\tt[n+1]=t[n]+1;\n\tfor(int i=1;i<=n+1;i++) b[i]=t[i]-t[i-1];\n\tfor(int i=1;i<=n;i++) a[i]=lower_bound(t+1,t+n+1,a[i])-t;\n\tn++;\n\ttree.build(1,1,n);\n\ttree.modify2(1,1,n,n,n,1);\n\tfor(int i=1;i<n;i++){\n//\t\tcout<<tree.qry(1,1,n,1,n)<<\" \"; \n\t\tint sum=tree.qry(1,1,n,1,n);\n\t\ttree.modify1(1,1,n,1,a[i],p-1);\n\t\ttree.modify1(1,1,n,a[i]+1,n,0);\n\t\ttree.modify2(1,1,n,1,a[i],sum);\n\t}\n\tcout<<tree.qry(1,1,n,1,n);\n\treturn 0;\n}\n```",
        "postTime": 1656256010,
        "uid": 116664,
        "name": "Daniel_lele",
        "ccfLevel": 8,
        "title": "CF1591F\u9898\u89e3"
    },
    {
        "content": "\u9000\u5f79\u9009\u624b\u6253\u4e86\u6253 CF \u73a9\uff0c\u53d1\u73b0\u8111\u5b50\u4e0d\u7075\u4e86\u3002\n\n\u8003\u8651\u4e00\u4e2a\u66b4\u529b DP \uff0c\u8bbe $f_{i,j}$ \u8868\u793a\u5904\u7406\u5230\u7b2c $i$ \u4e2a\uff0c $b_i = j$ \u7684\u65b9\u6848\u6570\uff0c\u5219\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n$$\nf_{i,j}=\n\\left\\{\n    \\begin{aligned}\n    \\sum_{j'=1}^{b_{i-1}}f_{i-1,j'}-f_{i-1,j} (j \\leq b_i)  \\\\\n    0 (j > b_i)\n    \\end{aligned}\n\\right.\n$$\n\n\u9996\u5148\u6709\u4e00\u4e2a\u5173\u952e\u7ed3\u8bba\uff1a\u628a $a$ \u6570\u7ec4\u6392\u5e8f\uff0c\u5728 $(a_i,a_{i+1}]$ \u533a\u95f4\u7684\u7b54\u6848\u5168\u90e8\u662f\u76f8\u540c\u7684\u3002\u56e0\u6b64\uff0c\u6709\u7528\u7684 $j$ \u5176\u5b9e\u53ea\u6709 $O(n)$ \u4e2a\u3002\u53ef\u4ee5\u628a $j$ \u7684\u4e00\u7ef4\u642c\u5230\u7ebf\u6bb5\u6811\u4e0a\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u4ee5 $j$ \u4e3a\u4e0b\u6807 $f_{i,j}$ \u4e3a\u6743\u503c\u5f00\u4e00\u68f5\u7ebf\u6bb5\u6811\u3002\u4ece $i$ \u8f6c\u79fb\u5230 $i+1$ \u76f4\u63a5\u5728\u7ebf\u6bb5\u6811\u4e0a\u4fee\u6539\u3002\n\n\u6ce8\u610f\u5bf9\u4e8e\u540c\u4e00\u4e2a $i$ \u7684\u6240\u6709 $j$ \u6765\u8bf4\uff0c $\\sum_{j'=1}^{b_{i-1}}f_{i-1,j'}$ \u90fd\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u4e8e\u662f\u8fd9\u4e2a\u7ebf\u6bb5\u6811\u53ea\u7528\u652f\u6301\u4e09\u79cd\u64cd\u4f5c\uff1a\n- \u533a\u95f4\u53d6\u76f8\u53cd\u6570\n- \u533a\u95f4\u8d4b $0$\n- \u533a\u95f4\u52a0\n\n\u770b\u7740\u4e0d\u592a\u597d\u7ef4\u62a4\u3002\u6ce8\u610f\u5230\u533a\u95f4\u53d6\u76f8\u53cd\u6570\u672c\u8d28\u4e0a\u662f\u533a\u95f4 $\\times -1$ \uff0c\u533a\u95f4\u8d4b $0$ \u672c\u8d28\u4e0a\u662f\u533a\u95f4 $\\times 0$ \uff0c\u76f4\u63a5\u5199\u4e00\u4e2a\u7c7b\u4f3c P3373 \u7684\u533a\u95f4\u4e58\uff0c\u533a\u95f4\u52a0\u7684\u7ebf\u6bb5\u6811\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long lld;\nconst lld mdx=998244353;\nconst int maxn=2e5+900;\nconst int maxT=1e6+800;\nint n,m,a[maxn],b[maxn],ind[maxn],nx=0;\nint tl[maxT],tr[maxT];lld val[maxT],mul[maxT],add[maxT];\nint getid(int x){return lower_bound(ind+1,ind+m+1,x)-ind;}\nint ls(int x){return (tl[x]==tr[x]?0:2*x);}\nint rs(int x){return (tl[x]==tr[x]?0:2*x+1);}\nint len(int x){return tr[x]-tl[x]+1;}\nlld srl(lld x,lld y){return (ind[y]-ind[x-1])%mdx;}\nvoid pushup(int p)\n{\n\tval[p]=((ls(p)?val[ls(p)]:0)+(rs(p)?val[rs(p)]:0))%mdx;\n}\nvoid pushdown(int p)\n{\n\tlld pm=mul[p],pa=add[p];mul[p]=1,add[p]=0;\n\tif(ls(p))\n\t{\n\t\tval[ls(p)]=(val[ls(p)]*pm+1ll*pa*srl(tl[ls(p)],tr[ls(p)]))%mdx;\n\t\tadd[ls(p)]=(add[ls(p)]*pm+pa)%mdx;\n\t\tmul[ls(p)]*=pm;mul[ls(p)]%=mdx;\n\t}\n\tif(rs(p))\n\t{\n\t\tval[rs(p)]=(val[rs(p)]*pm+1ll*pa*srl(tl[rs(p)],tr[rs(p)]))%mdx;\n\t\tadd[rs(p)]=(add[rs(p)]*pm+pa)%mdx;\n\t\tmul[rs(p)]*=pm;mul[rs(p)]%=mdx;\n\t} \n}\nvoid build(int p,int l,int r)\n{\n\ttl[p]=l;tr[p]=r;mul[p]=1;add[p]=0;\n\tif(l==r){val[p]=((l<=a[1]?1ll:0ll)*srl(l,l))%mdx;return ;}\n\tint mid=(tl[p]+tr[p])/2;\n\tif(l<=mid) build(2*p,l,mid);\n\tif(mid<r) build(2*p+1,mid+1,r);\n\tpushup(p);\n}\nvoid upd1(int p,int l,int r,int k)\n{\n    if(l>r) return ;\n\tif(l<=tl[p]&&tr[p]<=r)\n\t{\n\t\tval[p]*=k;val[p]%=mdx;\n\t\tmul[p]*=k;mul[p]%=mdx;\n\t\tadd[p]*=k;add[p]%=mdx;\n\t\treturn ;\n\t}\n\tpushdown(p);int mid=(tl[p]+tr[p])/2;\n\tif(l<=mid) upd1(ls(p),l,r,k);\n\tif(mid<r) upd1(rs(p),l,r,k);\n\tpushup(p);\n}\nvoid upd2(int p,int l,int r,int k)\n{\n    if(l>r) return ;\n\tif(l<=tl[p]&&tr[p]<=r)\n\t{\n\t\tval[p]+=1ll*(k*srl(l,r))%mdx;\n\t\tval[p]%=mdx;\n\t\tadd[p]+=k;val[p]%=mdx;\n\t\treturn ;\n\t}\n\tpushdown(p);int mid=(tl[p]+tr[p])/2;\n\tif(l<=mid&&ls(p)) upd2(ls(p),l,r,k);\n\tif(mid<r&&rs(p)) upd2(rs(p),l,r,k);\n\tpushup(p);\n}\nlld query(int p,int l,int r)\n{\n\tif(l<=tl[p]&&tr[p]<=r)\n\t{\n\t\treturn val[p];\n\t}\n\tpushdown(p);lld ans=0;int mid=(tl[p]+tr[p])/2;\n\tif(l<=mid&&ls(p)) ans+=query(ls(p),l,r);\n\tif(mid<r&&rs(p)) ans+=query(rs(p),l,r);\n\treturn ans%mdx;\n}\nint main()\n{\n    freopen(\"1591F.in\",\"r\",stdin);\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n    for(int i=1;i<=n;i++) ind[i]=a[i];\n\tsort(ind+1,ind+n+1);m=unique(ind+1,ind+n+1)-ind-1;\n\tfor(int i=1;i<=n;i++) a[i]=getid(a[i]);\n    build(1,1,m);\n    for(int i=2;i<=n;i++)\n    {\n        lld dlt=query(1,1,m);\n        upd1(1,1,m,-1);upd2(1,1,m,dlt);\n        upd1(1,a[i]+1,m,0);\n    }\n    lld A=query(1,1,m);A%=mdx;A=(A+mdx)%mdx;\n    printf(\"%lld\\n\",A);\n    return 0;\n}\n```",
        "postTime": 1639756004,
        "uid": 76464,
        "name": "SS80194",
        "ccfLevel": 7,
        "title": "CF1591F \u9898\u89e3"
    }
]