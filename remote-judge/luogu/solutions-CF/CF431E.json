[
    {
        "content": "# \u9898\u76ee\n\n[CF431E Chemistry Experiment](https://www.luogu.com.cn/problem/CF431E)\n\n# \u5206\u6790\n\n\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\uff0c\u4e8c\u5206\u7b54\u6848\uff0c\u7ebf\u6bb5\u6811\u3002\n\n\u6ca1\u4eba\u5199 $1\\log$ \u7684\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u505a\u6cd5\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u7684\u76ee\u7684\u662f\u8981\u6c42\u51fa\u5c3d\u53ef\u80fd\u5c0f\u7684\u6700\u5927\u4f53\u79ef\uff0c\u8fd9\u663e\u7136\u662f\u53ef\u4ee5\u4e8c\u5206\u540e\u76f4\u63a5\u5224\u65ad\u7684\u3002\n\n\u4f46\u662f\u8fd9\u6837\u662f $2\\log$ \u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8003\u8651\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u3002\n\n\u53ef\u662f\u8fd9\u6837\u5c31\u9700\u8981\u5b9e\u6570\u7684\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u4e86\u5417\uff1f\u5e76\u4e0d\u662f\u3002\n\n\u6211\u4eec\u8003\u8651\u6c42\u7b54\u6848\u7684\u8fc7\u7a0b\uff1a\u5148\u628a\u8981\u9009\u7684\u8bd5\u7ba1\u5168\u90e8\u8c03\u6574\u5230\u540c\u4e00\u4e2a\u4f53\u79ef\uff0c\u518d\u540c\u65f6\u7ed9\u6240\u6709\u7684\u8bd5\u7ba1\u5e73\u5747\u5012\u6c34\u3002\n\n\u663e\u7136\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u4fee\u6539\u64cd\u4f5c\u53ea\u4f1a\u51fa\u73b0\u6574\u6570\u7684\u4f53\u79ef\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8c03\u6574\u5230\u7684\u4f53\u79ef\u4e00\u5b9a\u662f\u4e00\u4e2a\u6574\u6570\uff01\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5e76\u4e0d\u76f4\u63a5\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u51fa\u7b54\u6848\uff0c\u800c\u662f\u4e8c\u5206\u51fa\u8fd9\u4e2a\u8c03\u6574\u5230\u7684\u9ad8\u5ea6\uff01\n\n\u4e8c\u5206\u8fc7\u7a0b\u5982\u4e0b\uff0c\u6bcf\u6b21\u5148\u91cd\u7f6e $SIZE,SUM=0$ \uff1a\n\n> \u5176\u4e2d $sum$ \u8868\u793a**\u503c\u57df\u533a\u95f4**\u5185\u6c34\u7684\u4f53\u79ef\u548c\uff0c$siz$ \u8868\u793a**\u503c\u57df\u533a\u95f4**\u5185\u8bd5\u7ba1\u7684\u4e2a\u6570\u3002\n>\n> $SUM$ \u8868\u793a\u5de6\u4fa7\u603b\u7684\u6c34\u7684\u4f53\u79ef\u548c\uff0c$SIZE$ \u8868\u793a\u5de6\u4fa7\u603b\u7684\u8bd5\u7ba1\u4e2a\u6570\n\n```cpp\nll SIZE,SUM;\nll Query(int x,int l,int r,ll lim){\n\tif(!x) return l;\n\tif(l==r) return SIZE+=siz(x),SUM+=sum(x),l;\n\tint mid=l+r>>1,MID=mid+1;//\u6ce8\u610fMID\n\tll res=1ll*(siz(ls(x))+SIZE)*mid-(sum(ls(x))+SUM);\n\tif(res>=lim) return Query(ls(x),l,mid,lim);\n\telse return SIZE+=siz(ls(x)),SUM+=sum(ls(x)),Query(rs(x),mid+1,r,lim); \n}\n```\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u540c\u65f6\u5f80\u4e0a\u8c03\u6574\uff1a\n\n```cpp\nelse{\n\tread(l);//l\u662f\u8981\u5206\u914d\u7684\u4f53\u79ef\n    SIZE=SUM=0;\n\tint height=Query(Root,0,1e9,l);\n\tl=l-(SIZE*height-SUM);//\u73b0\u5728l\u662f\u591a\u4f59\u7684\u62ff\u6765\u5206\u914d\u7684\u4f53\u79ef\n\tdouble Ans=(double)height+1.0*(double)l/(double)(SIZE);//\u52a0\u4e0a\u591a\u589e\u52a0\u7684\u9ad8\u5ea6\n\tprintf(\"%.5lf\\n\",Ans);\n}\n```\n\n\u90a3\u4e48\u5c31\u7ed3\u675f\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u8c03\u6574\u4e8c\u5206\u7684\u5bf9\u8c61\u89c4\u907f\u4e86\u5b9e\u6570\u7684\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$ \u3002\n\n#  \u4ee3\u7801\n\n\u8dd1\u5f97\u6bd4\u8f83\u5feb\u3002\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>\ninline void read(T &x){\n\tx=0;bool f=false;char ch=getchar();\n\twhile(!isdigit(ch)){f|=ch=='-';ch=getchar();}\n\twhile(isdigit(ch)){x=x*10+(ch^48);ch=getchar();}\n\tx=f?-x:x;\n\treturn ;\n}\ntemplate<typename T>\ninline void write(T x){\n\tif(x<0) x=-x,putchar('-');\n\tif(x>9) write(x/10);\n\tputchar(x%10^48);\n\treturn ;\n}\n#define ll long long\n#define ull unsigned long long\n#define inc(x,y,mod) (((x)+(y))>=(mod)?(x)+(y)-(mod):(x)+(y))\n#define dec(x,y,mod) ((x)-(y)<0?(x)-(y)+(mod):(x)-(y))\n#define rep(i,x,y) for(register int i=(x);i<=(y);i++)\n#define dep(i,y,x) for(register int i=(y);i>=(x);i--)\nconst int N=1e5+5,M=2e5+5,MOD=1e9+7;\nint n,m,h[N],cur;\nstruct SGT{\n\tint siz,ls,rs;\n\tll sum;\n\t#define ls(x) t[x].ls\n\t#define rs(x) t[x].rs\n\t#define sum(x) t[x].sum\n\t#define siz(x) t[x].siz\n}t[N<<6];\nvoid Modify(int &x,int l,int r,int pos,int v){\n\tif(!x) x=++cur;\n\tsiz(x)+=v,sum(x)+=v*pos;\n\tif(l==r) return ;\n\tint mid=l+r>>1;\n\tif(pos<=mid) Modify(ls(x),l,mid,pos,v);\n\telse Modify(rs(x),mid+1,r,pos,v);\n\treturn ;\n}\nll SIZE,SUM;\nll Query(int x,int l,int r,ll lim){\n\tif(!x) return l;\n\tif(l==r) return SIZE+=siz(x),SUM+=sum(x),l;\n\tint mid=l+r>>1,MID=mid+1;\n\tll res=1ll*(siz(ls(x))+SIZE)*MID-(sum(ls(x))+SUM);\n\tif(res>=lim) return Query(ls(x),l,mid,lim);\n\telse return SIZE+=siz(ls(x)),SUM+=sum(ls(x)),Query(rs(x),mid+1,r,lim); \n}\nint Root;\nsigned main(){\n\tread(n);read(m);\n\trep(i,1,n) read(h[i]),Modify(Root,0,1e9,h[i],1);\n\twhile(m--){\n\t\tll op,l,r;\n\t\tread(op);\n\t\tif(op==1) read(l),read(r),Modify(Root,0,1e9,h[l],-1),Modify(Root,0,1e9,(h[l]=r),1);\n\t\telse{\n\t\t\tread(l);SIZE=SUM=0;\n\t\t\tint height=Query(Root,0,1e9,l);\n\t\t\tl=l-(SIZE*height-SUM);\n\t\t\tdouble Ans=(double)height+1.0*(double)l/(double)(SIZE);\n\t\t\tprintf(\"%.5lf\\n\",Ans);\n\t\t}\n\t}\n\t\n\treturn 0;\n}\n```\n",
        "postTime": 1631677735,
        "uid": 555420,
        "name": "GuuGuu",
        "ccfLevel": 0,
        "title": "CF431E Chemistry Experiment\u9898\u89e3"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u7b80\u5355\u800c\u53c8\u597d\u7406\u89e3\u7684\u601d\u8def\u3002\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF431E)\n\n\u64cd\u4f5c\u4e00\u76f4\u63a5\u8df3\u8fc7\uff0c\u5355\u70b9\u4fee\u6539\u592a\u900a\u4e86\u3002\n\n\u770b\u64cd\u4f5c\u4e8c\uff1a\u8fd9\u73a9\u610f\u4ec0\u4e48\u9b3c\uff1f\n\n\u4ed4\u7ec6\u5206\u6790\u4e00\u4e0b\uff0c\u4e00\u4e2a\u7ed3\u8bba\u660e\u663e\u5f97\u51fa\uff1a\n\n\n- \u6700\u540e\u6709\u6c34\u7684\u8bd5\u7ba1\u6c34\u9762\u9ad8\u5ea6\u90fd\u662f\u76f8\u540c\u7684\u3002\n\n\u8fd9\u4e2a\u663e\u7136\uff0c\u56e0\u4e3a\u9898\u76ee\u8981\u6c42\u6700\u9ad8\u7684\u6c34\u5e73\u6c34\u9762\u5c3d\u91cf\u77ee\uff0c\u6240\u4ee5\u82e5\u6709\u6c34\u9762\u9ad8\u5ea6\u5dee\uff0c\u6211\u4eec\u76f4\u63a5\u62ff\u9ad8\u7684\u5f80\u4f4e\u7684\u91cc\u9762\u704c\u5c31\u80fd\u51cf\u5c0f\u7b54\u6848\u3002\n\n\u540c\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u7b54\u6848\u5177\u6709\u5355\u8c03\u6027\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u5982\u679c\u5f3a\u5236\u6240\u6709\u6c34\u9762\u5230\u8fbe $x$ \u9ad8\u5ea6\u8fd9\u4e2a\u65b9\u6848\u53ef\u884c\uff0c\u90a3\u4e48\u6240\u6709 $\\ge x$ \u7684\u65b9\u6848\u5747\u53ef\u3002\n\n\u679c\u65ad\u4e8c\u5206\u7b54\u6848\u3002\n\n\u4e8c\u5206 $mid$ \u4e4b\u540e\uff0c\u601d\u8003\u5982\u4f55\u5224\u65ad\u8fd9\u4e2a\u7b54\u6848\u53ef\u4e0d\u53ef\u884c\u3002\n\n\u56e0\u4e3a\u53ea\u80fd\u5f80\u5c0f\u4e8e\u7b49\u4e8e $mid$ \u7684\u8bd5\u7ba1\u91cc\u9762\u704c\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u7edf\u8ba1\u51fa\u6240\u6709\u9ad8\u5ea6\u5c0f\u4e8e\u7b49\u4e8e $mid$ \u7684\u8bd5\u7ba1\u7684\u6570\u91cf $num$\uff0c\u540c\u65f6\u4e5f\u8981\u7edf\u8ba1\u8fd9\u4e9b\u8bd5\u7ba1\u91cc\u9762\u6c34\u94f6\u7684\u4f53\u79ef $sum$\u3002\u5982\u679c $num \\times mid - sum \\ge v$ \u8fd9\u4e2a $mid$ \u5c31\u662f\u53ef\u884c\u7684\uff08\u81ea\u884c\u753b\u56fe\u4f53\u4f1a\uff09\u3002\n\n\u53c8\u7531\u4e8e\u6ca1\u6709\u533a\u95f4\u9650\u5236\uff0c\u800c\u4e14 mid \u503c\u4e0d\u786e\u5b9a\uff0c\u679c\u65ad\u4e0a\u6743\u503c\u7ebf\u6bb5\u6811 + \u52a8\u6001\u5f00\u70b9\u3002\n\n\u7136\u540e\u3002\u3002\u3002\u5c31\u5199\u5b8c\u4e86\uff1f\uff1f\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(mlog^2S)$\u3002\u4e0d\u662f\u5f88\u9700\u8981\u5361\u5e38\u3002\n\n\u6ce8\u610f\u52a8\u6001\u5f00\u70b9\u4e0d\u8981\u4f7f\u7528 vector\uff0c\u5185\u5b58\u5c3d\u91cf\u5361\u5927\u4e00\u70b9\u5373\u53ef\n\n### Code\n\n```cpp\n    #include <stdio.h>\n    #include <algorithm>\n    #include <cmath>\n    #include <vector>\n    #define int long long\n    #define N 100005\n    using namespace std;\n    typedef long long ll;\n    typedef double ld;\n    const int INF=1e10;\n    const ld exep=1e-5;\n    int root, cnt;\n    struct node{int num, lc, rc;ll sum;}null;\n    node operator + (node a, node b){\n    \tnode c;c.sum=a.sum+b.sum, c.num=a.num+b.num;\n    \treturn c;\n    }\n    struct Segment_Tree{\n    \t#define mid (l+r>>1)\n    \tnode V[N*30];\n    \tvoid pre(){\n    \t\tnull.sum=0, null.num=0;\n    \t\tnull.lc=null.rc=0;\n    \t}\n    \tvoid pushup(int k){\n    \t\tV[k].sum=V[k].num=0;\n    \t\tif(V[k].lc){\n    \t\t\tV[k].sum+=V[V[k].lc].sum;\n    \t\t\tV[k].num+=V[V[k].lc].num;\n    \t\t}\n    \t\tif(V[k].rc){\n    \t\t\tV[k].sum+=V[V[k].rc].sum;\n    \t\t\tV[k].num+=V[V[k].rc].num;\n    \t\t}\n    \t}\n    \tvoid add(int &k, int l, int r, int x, int v){\n    \t\tif(!k) k=++cnt, V[k]=null;\n    //\t\tprintf(\"%d %d %d %d %d\\n\", k, l, r, mid, x);\n    //\t\tsystem(\"pause\");\n    \t\tif(l==r){\n    \t\t\tV[k].num+=v;V[k].sum=V[k].num*x;\n    \t\t\treturn ;\n    \t\t}\n    \t\tif(x<=mid) add(V[k].lc, l, mid, x, v);//printf(\"goleft\\n\"), \n    \t\telse add(V[k].rc, mid+1, r, x, v);//printf(\"goright\\n\"), \n    \t\treturn pushup(k);\n    \t}\n    \tnode query(int &k, int l, int r, int x, int y){\n    \t\tif(!k) return null;\n    \t\tif(x<=l&&r<=y) return V[k];\n    \t\tnode ret=null;\n    \t\tif(x<=mid) ret=ret+query(V[k].lc, l, mid, x, y);\n    \t\tif(mid<y) ret=ret+query(V[k].rc, mid+1, r, x, y);\n    \t\treturn ret;\n    \t}\n    \t#undef mid\n    }chtholly;\n    int n, m;\n    int turn(ld x){\n    \tll f=ceil(x);\n    \treturn f>INF?INF:f;\n    }\n    bool check(ld mid, ld sum){\n    \tnode ans=chtholly.query(root, 0, INF, 0, turn((ll)mid));\n    //\tprintf(\"%lf %d %lld\\n\", mid, ans.num, ans.sum);\n    \tld gt=(ld)1ll*ans.num*mid-(ld)ans.sum;\n    \tif(gt>=sum) return 1;\n    \treturn 0;\n    }\n    int a[N];\n    signed main(){\n    \tchtholly.pre();\n    \tscanf(\"%lld%lld\", &n, &m);\n    \tfor(int i=1; i<=n; i++){\n    \t\tscanf(\"%lld\", &a[i]);\n    \t\tchtholly.add(root, 0, INF, a[i], 1);\n    \t}\n    \tfor(int i=1; i<=m; i++){\n    \t\tint opt;scanf(\"%lld\", &opt);\n    \t\tif(opt&1){\n    \t\t\tint x, v;scanf(\"%lld%lld\", &x, &v);\n    \t\t\tchtholly.add(root, 0, INF, a[x], -1);\n    \t\t\ta[x]=v;\n    \t\t\tchtholly.add(root, 0, INF, v, 1);\n    \t\t}\n    \t\telse{\n    \t\t\tll v;scanf(\"%lld\", &v);\n    \t\t\tld l=0, r=1e15, ans;\n    \t\t\twhile(l+exep<r){\n    \t\t\t\tld mid=(l+r)/2.0;\n    \t\t\t\tif(check(mid, (ld)v)) ans=mid, r=mid;\n    \t\t\t\telse l=mid;\n    \t\t\t}\n    \t\t\tprintf(\"%.5lf\\n\", ans);\n    \t\t}\n    \t}\n    \treturn 0;\n    }\n```\n",
        "postTime": 1620450825,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "CF431E Chemistry Experiment"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.azusemisa.top/posts/128296706.html)\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\uff0c\u8981\u6c42\u652f\u6301\u4e24\u79cd\u64cd\u4f5c\uff1a1\u3001\u5355\u70b9\u4fee\u6539\u30022\u3001**\u5982\u679c**\u4ece $n$ \u4e2a\u6570\u4e2d\u9009\u51fa\u4e00\u4e9b\u6570\uff0c\u7ed9\u4ed6\u4eec\u4e00\u5171\u52a0\u4e0a $k$\uff0c\u6c42\u52a0\u5b8c\u540e\u8fd9\u4e9b\u6570\u4e2d\u6700\u5927\u503c\u7684\u6700\u5c0f\u503c\uff08\u53ea\u662f\u5047\u8bbe\uff0c\u5e76\u4e0d\u662f\u771f\u7684\u8981\u52a0\u4e0a\uff09\u3002\n\n## \u601d\u8def\n\n\u7b2c\u4e00\u79cd\u64cd\u4f5c\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u91cd\u70b9\u8003\u8651\u4e00\u4e0b\u7b2c\u4e8c\u79cd\u3002\n\n\u4ec0\u4e48\u60c5\u51b5\u4e0b\u6700\u4f18\u5462\uff1f\u663e\u7136\uff0c\u5e94\u8be5\u662f\u9009\u51fa\u6765\u7684\u8fd9\u4e9b\u6570\u5728\u52a0\u5b8c\u4e4b\u540e\u503c\u4e00\u6837\u7684\u65f6\u5019\uff0c\u800c\u4e14\u6211\u4eec\u5e94\u8be5\u5c3d\u91cf\u591a\u9009\u4e00\u4e9b\u6570\uff0c\u8fd9\u6837\u5e73\u5747\u4e0b\u6765\u624d\u4f1a\u5c3d\u91cf\u5c0f\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5047\u8bbe\u6700\u540e\u9009\u51fa\u6765\u7684\u8fd9\u4e9b\u6570\u5728\u4e00\u5171\u52a0\u4e0a $k$ \u4e4b\u540e\u7684\u503c\u90fd\u4e3a $b$\uff0c\u90a3\u6211\u4eec\u8981\u9009\u7684\u6570\u5c31\u662f\u6240\u6709\u5c0f\u4e8e\u7b49\u4e8e $b$ \u7684\uff0c\u4f46\u8fd9\u6837\u4f1a\u5f88\u9ebb\u70e6\uff0c\u56e0\u4e3a\u968f\u7740\u9009\u6570\u65b9\u6848\u7684\u6539\u53d8\uff0c$b$ \u4e5f\u4f1a\u968f\u4e4b\u800c\u53d8\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6362\u79cd\u601d\u8def\u3002\n\n\u6211\u4eec\u968f\u4fbf\u9009\u4e00\u4e2a\u6570 $t$ \u51fa\u6765\uff0c\u4ee5\u5b83\u4f5c\u4e3a\u6807\u51c6\uff0c\u628a\u6240\u6709\u5c0f\u4e8e\u7b49\u4e8e\u5b83\u7684\u6570\u90fd\u9009\u51fa\u6765\uff0c\u7136\u540e\u5148\u628a\u5c0f\u4e8e\u5b83\u7684\u6570\u7d2f\u52a0\u5230\u7b49\u4e8e\u5b83\uff0c\u7136\u540e\u518d\u4e00\u8d77\u7d2f\u52a0\u3002\n\n\u76f8\u5f53\u4e8e\u662f\u8fd9\u6837\u3002\n\n![](https://cdn.jsdelivr.net/gh/xiao-lin52/image-upload/20210119195614.png)\n\n\u4ee5\u7b2c\u56db\u4e2a\u6570\u4e3a\u6807\u51c6\uff0c\u5148\u628a\u5176\u4ed6\u5c0f\u4e8e\u5b83\u7684\u6570\u52a0\u5230\u548c\u5b83\u4e00\u6837\u3002\n\n![](https://cdn.jsdelivr.net/gh/xiao-lin52/image-upload/20210119195655.png)\n\n\u7136\u540e\u518d\u4e00\u8d77\u7d2f\u52a0\u3002\n\n![](https://cdn.jsdelivr.net/gh/xiao-lin52/image-upload/20210119195715.png)\n\n\u8fd9\u6837\uff0c\u9009\u51fa\u6765\u7684\u4f5c\u4e3a\u6807\u51c6\u7684\u8fd9\u4e2a\u6570 $t$ \u5c31\u5f88\u5173\u952e\u4e86\uff0c\u663e\u7136\u5b83\u4e0d\u80fd\u592a\u5927\uff0c\u4e0d\u7136\u5176\u4ed6\u7684\u6570\u8fd8\u6ca1\u6709\u52a0\u5230\u548c\u5b83\u4e00\u6837\u5c31\u5df2\u7ecf\u628a $k$ \u7528\u5b8c\u4e86\uff0c\u4f46\u5b83\u4e5f\u4e0d\u80fd\u592a\u5c0f\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u5b58\u5728\u4e00\u4e2a\u6570 $x$\uff0c\u4e00\u5f00\u59cb\u7684\u65f6\u5019\uff0c$x$ \u662f\u5927\u4e8e $t$ \u7684\uff0c\u4f46\u5728\u6700\u540e\u4e00\u8d77\u7d2f\u52a0\u7684\u65f6\u5019\uff0c\u5b83\u53c8\u5c0f\u4e8e\u7d2f\u52a0\u540e\u5f97\u5230\u7684\u6570\u4e86\uff0c\u8fd9\u6837\u5c31\u4f1a\u5b58\u5728\u6d6a\u8d39\uff0c\u90a3\u6211\u4eec\u8981\u600e\u4e48\u627e\u51fa\u8fd9\u4e2a\u4e0d\u5927\u4e0d\u5c0f\u521a\u521a\u597d\u7684 $t$ \u5462\uff1f\n\n\u4e0d\u96be\u53d1\u73b0\uff0c$t$ \u662f\u53ef\u4ee5\u4e8c\u5206\u7684\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u6309\u7167\u521a\u521a\u90a3\u4e2a\u529e\u6cd5\uff0c\u5148\u968f\u4fbf\u627e\u4e00\u4e2a\u6570\u4f5c\u4e3a $t$\uff0c\u5982\u679c\u5176\u4ed6\u5c0f\u4e8e\u5b83\u7684\u6570\u6ca1\u6cd5\u5168\u90e8\u7d2f\u52a0\u5230\u548c\u5b83\u4e00\u6837\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u6570\u592a\u5927\u4e86\uff0c\u53cd\u4e4b\uff0c\u5982\u679c\u53ef\u4ee5\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u6570\u4e5f\u8bb8\u662f\u6b63\u786e\u7b54\u6848\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5f80\u5927\u7684\u53bb\u627e\u3002\n\n\u90a3\u4e48\u95ee\u9898\u53c8\u6765\u4e86\uff0c\u663e\u7136\u8981\u6c42\u51fa\u6240\u6709\u5c0f\u4e8e\u7b49\u4e8e\u5b83\u7684\u6570\u80fd\u5426\u7d2f\u52a0\u5230\u548c\u5b83\u4e00\u6837\uff0c\u6211\u4eec\u5c31\u9700\u8981\u77e5\u9053\u8fd9\u4e9b\u6570\u7684\u6570\u91cf\u548c\u603b\u548c\uff0c\u663e\u7136\u5982\u679c\u66b4\u529b\u67e5\u627e\u5355\u6b21\u8be2\u95ee\u662f $O(n\\log n)$ \u7684\uff0c\u6240\u4ee5\u6709\u6ca1\u6709\u4e00\u79cd\u6570\u636e\u7ed3\u6784\u4e4b\u7c7b\u7684\u4e1c\u897f\u80fd\u5feb\u901f\u7ef4\u62a4\u8fd9\u4e24\u4e2a\u503c\u5462\uff1f\n\n\u5e73\u8861\u6811\u554a\uff01\n\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u4e8c\u5206\u7684\u8fc7\u7a0b\u653e\u5230\u5e73\u8861\u6811\u4e0a\u53bb\uff0c\u663e\u7136\u5e73\u8861\u6811\u662f\u53ef\u4ee5\u5f88\u597d\u7684\u7ef4\u62a4\u6211\u4eec\u9700\u8981\u7684\u8fd9\u4e24\u4e2a\u503c\u7684\uff0c\u8fd9\u6837\u5355\u6b21\u8be2\u95ee\u590d\u6742\u5ea6\u5c31\u964d\u5230\u4e86 $O(\\log n)$\uff0c\u8f7b\u677e\u8fc7\u6389 $10^5$\u3002\n\n\u554a\u5bf9\u4e86\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u5751\u70b9\uff0c\u7531\u4e8e\u6211\u4eec\u9700\u8981\u77e5\u9053\u7684\u662f\u6240\u6709\u5c0f\u4e8e\u7b49\u4e8e $t$ \u7684\u6570\u7684\u603b\u548c\u548c\u6570\u91cf\uff0c\u6240\u4ee5\u5149\u7edf\u8ba1\u8fd9\u4e2a\u70b9\u7684\u5de6\u513f\u5b50\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u8981\u8003\u8651\u5230\u5b83\u7956\u5148\u7684\u5de6\u513f\u5b50\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u53ef\u4ee5\u5728\u9012\u5f52\u7684\u8fc7\u7a0b\u4e2d\u7d2f\u52a0\uff0c\u5982\u679c\u662f\u5f80\u53f3\u513f\u5b50\u8d70\uff0c\u6211\u4eec\u5c31\u628a\u5f53\u524d\u8fd9\u4e2a\u70b9\u53ca\u5b83\u5de6\u513f\u5b50\u8fd9\u9897\u5b50\u6811\u4e2d\u7684\u4fe1\u606f\u7d2f\u52a0\u5230\u4e00\u4e2a\u53d8\u91cf\u91cc\uff0c\u5728\u8ba1\u7b97\u65f6\uff0c\u628a\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\u4e5f\u585e\u5230\u4e00\u5757\u8fdb\u884c\u8ba1\u7b97\u5c31\u884c\u4e86\u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i, l, r) for(int i = (l), i##end = (r); i <= i##end; i++)\n#define per(i, r, l) for(int i = (r), i##end = (l); i >= i##end; i--)\n#define debug(x) cerr<<#x<<\" = \"<<x\n#define pii pair<int, int>\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\nusing namespace std;\ntypedef long long ll;\nconst int N = 1e5+10, mod = 20060209;\nconst double inf = 1e16;\nint n, m, rt, sed, tot, son[N<<1][2], siz[N<<1], num[N<<1], rnd[N<<1];\nll a[N], val[N<<1], sum[N<<1];//\u8fd9\u91cc\u91c7\u7528\u5e38\u6570\u5c0f\u7801\u91cf\u4e5f\u5c0f\u7684 Treap\ninline int rd()\n{\n\treturn sed = 114514ll*sed%mod*1919810%mod;\n}\ninline void push_up(int p)\n{\n\tsiz[p] = siz[son[p][0]]+siz[son[p][1]]+num[p];\n\tsum[p] = sum[son[p][0]]+sum[son[p][1]]+val[p]*num[p];\n}\ninline void spin(int &p, int s)//\u677f\u5b50\n{\n\tint t = son[p][s];\n\tson[p][s] = son[t][s^1];\n\tson[t][s^1] = p;\n\tpush_up(p);\n\tpush_up(t);\n\tp = t;\n}\nvoid ins(int &p, ll k)//\u677f\u5b50\n{\n\tif(!p)\n\t{\n\t\tp = ++tot;\n\t\trnd[p] = rd();\n\t\tsiz[p] = num[p] = 1;\n\t\tval[p] = sum[p] = k;\n\t\treturn;\n\t}\n\tif(val[p] == k)\n\t{\n\t\tnum[p]++;\n\t\tsiz[p]++;\n\t\tsum[p] += k;\n\t\treturn;\n\t}\n\tint t = (val[p] < k);\n\tins(son[p][t], k);\n\tif(rnd[son[p][t]] > rnd[p])\n\t\tspin(p, t);\n\tpush_up(p);\n}\nvoid del(int &p, ll k)//\u677f\u5b50\n{\n\tif(!p)\n\t\treturn;\n\tif(val[p] == k)\n\t{\n\t\tif(num[p] > 1)\n\t\t{\n\t\t\tnum[p]--;\n\t\t\tsiz[p]--;\n\t\t\tsum[p] -= k;\n\t\t\treturn;\n\t\t}\n\t\tif(!son[p][0] && !son[p][1])\n\t\t\tp = 0;\n\t\telse if(son[p][0] && !son[p][1])\n\t\t{\n\t\t\tspin(p, 0);\n\t\t\tdel(son[p][1], k);\n\t\t}\n\t\telse if(!son[p][0] && son[p][1])\n\t\t{\n\t\t\tspin(p, 1);\n\t\t\tdel(son[p][0], k);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint t = (rnd[son[p][0]] < rnd[son[p][1]]);\n\t\t\tspin(p, t);\n\t\t\tdel(son[p][t^1], k);\n\t\t}\n\t\tpush_up(p);\n\t\treturn;\n\t}\n\tint t = (val[p] < k);\n\tdel(son[p][t], k);\n\tif(rnd[son[p][t]] > rnd[p])\n\t\tspin(p, t);\n\tpush_up(p);\n}\ndouble query(int p, ll k, ll s1, int s2)//s1 \u548c s2 \u8bb0\u5f55\u7956\u5148\u7684\u5de6\u5b50\u6811\u7684\u4fe1\u606f\n{\n\tif(!p)\n\t\treturn inf;\n\tdouble t = (s1+sum[p]-sum[son[p][1]]+k)*1.0/(s2+siz[p]-siz[son[p][1]]);//\u8ba1\u7b97\u7ed9\u6240\u6709\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u6570\u4e00\u5171\u52a0\u4e0a k \u4ee5\u540e\u6700\u5c0f\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u56fe\u4e09\u7684\u7ed3\u679c\n\tif(t > val[p])//\u5f80\u53f3\u513f\u5b50\u9012\u5f52\n\t\treturn min(query(son[p][1], k, s1+sum[p]-sum[son[p][1]], s2+siz[p]-siz[son[p][1]]), t);\n\telse\n\t\treturn query(son[p][0], k, s1, s2);\n}\nint main()\n{\n\tsed = time(0)%mod;\n\tscanf(\"%d%d\", &n, &m);\n\trep(i, 1, n)\n\t\tscanf(\"%d\", &a[i]), ins(rt, a[i]);\n\trep(i, 1, m)\n\t{\n\t\tint op, p;\n\t\tll v;\n\t\tscanf(\"%d\", &op);\n\t\tif(op == 1)\n\t\t{\n\t\t\tscanf(\"%d%lld\", &p, &v);\n\t\t\tdel(rt, a[p]);\n\t\t\tins(rt, v);\n\t\t\ta[p] = v;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tscanf(\"%lld\", &v);\n\t\t\tprintf(\"%.5lf\\n\", query(rt, v, 0, 0));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1611059355,
        "uid": 183235,
        "name": "Islauso",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF431E \u3010Chemistry Experiment\u3011"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF431E)\n\n\u9898\u89e3\u91cc\u5c45\u7136\u6ca1\u6709\u5199\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u7684\uff0c\u6765\u4ea4\u4e00\u53d1\u3002\n\n\u7ef4\u62a4\u4e00\u9897\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u4ee5$h_i$\u4e3a\u4e0b\u6807\uff0c\u4e3b\u8981\u7ef4\u62a4\u4e24\u4e2a\u503c\uff0c\u662f\u5143\u7d20\u4e2a\u6570\u548c\u5143\u7d20\u548c\u3002\n\u90a3\u4e48\u5f53\u524d\u70b9$m$\u53ef\u4ee5\u5224\u65ad\u5de6\u8fb9\u7684\u8282\u70b9\u6570$\\times m-$\u5de6\u8fb9\u7684\u5143\u7d20\u548c\u662f\u5426\u5927\u4e8e\u5f53\u524d\u7684\u6c34\u91cf\u6765\u8003\u8651\u8d70\u5de6\u8fb9\u8fd8\u662f\u53f3\u8fb9\u3002\u8d70\u5230\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u65f6\u8ba1\u7b97\u5269\u4e0b\u7684\u6c34\u91cf\uff0c\u7136\u540e\u5747\u644a\u7ed9\u6bcf\u4e00\u4e2a\u8bd5\u7ba1\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nloga)$\uff0c\u4e00\u70b9\u4e0d\u5361\u5e38\u3002\n\n\u4ee3\u7801\u5b9e\u73b0:\n```cpp\n#include<cstdio>\n#define l(x) f[x].l\n#define r(x) f[x].r\nusing namespace std;\nint n,m,k,y,x,tot,pus,root,cnt,sx,a[100039];\nlong long z;\nstruct tree{int l,r,siz;long long f;}f[10000039];\ninline void get(long long x,int y,long long l,long long r,int &now){\n\tif(!now) now=++cnt;\n\tif(l==r) {f[now].f+=x*y;f[now].siz+=y;return ;}\n\tdouble m=(l+r)/2;\n\tif(x<=m) get(x,y,l,m,l(now));\n\telse get(x,y,m+1,r,r(now));\n\tf[now].f=f[l(now)].f+f[r(now)].f;\n\tf[now].siz=f[l(now)].siz+f[r(now)].siz;\n}\ninline double find(long long x,long long l,long long r,int now){\n\tlong long siz=0;long long fs=0;\n\twhile(l!=r){\n\t\tdouble m=(l+r)/2;\n\t\tif(x>=m*(siz+f[l(now)].siz)-fs-f[l(now)].f)l=m+1,fs+=f[l(now)].f,siz+=f[l(now)].siz,now=r(now);\n\t\telse r=m,now=l(now);\n\t}\n\treturn l+(x-(l*(siz+f[l(now)].siz)-fs-f[l(now)].f))*1.0/siz;\n}\ninline void read(int &x){\n\tchar s=getchar();x=0;\n\twhile(s<'0'||s>'9') s=getchar();\n\twhile(s>='0'&&s<='9') x=(x<<3)+(x<<1)+(s^48),s=getchar();\n}\nint main(){\n//\tfreopen(\"1.in\",\"r\",stdin);\n\tregister int i;\n\tread(n);read(m);\n\tfor(i=1;i<=n;i++) read(a[i]),get(a[i],1,0,1e13,root);\n\tfor(i=1;i<=m;i++){\n\t\tread(sx);\n\t\tif(sx==1) read(x),read(y),get(a[x],-1,0,1e13,root),a[x]=y,get(a[x],1,0,1e13,root);\n\t\telse scanf(\"%lld\",&z),printf(\"%.5lf\\n\",find(z,0,1e13,root));\n\t}\n}\n```",
        "postTime": 1604405079,
        "uid": 181766,
        "name": "275307894a",
        "ccfLevel": 0,
        "title": "CF431E Chemistry Experiment"
    },
    {
        "content": "## $\\text{Description}$\n\n\u4f60\u8981\u5c06v\u5206\u7ed9\u4e00\u4e9b\u6570\u5b57\uff0c\u4f7f\u5f97\u8fd9\u4e9b\u6570\u5b57\u7684\u6700\u5927\u503c\u6700\u5c0f\u3002\n\n~~\u7136\u800c\u6211\u770b\u6210\u4e86\u4f7f\u5f97\u5168\u5c40\u6700\u5927\u503c\u6700\u5c0f\u3002~~\n\n## $\\text{Solution}$\n\n\u611f\u89c9\u8fd9\u9898\u5f88\u6c34\u554a\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u8bc4\u9ed1\u7684\u3002\n\n\u5148\u8003\u8651\u8be2\u95ee\uff0c\u53d1\u73b0\u6700\u5927\u503c\u6700\u5c0f\uff0c\u4e0d\u96be\u60f3\u5230\u4e8c\u5206\u7b54\u6848\u3002\n\n\u8003\u8651\u5176\u5355\u8c03\u6027\uff0c\u5047\u5982\u4f53\u79ef\u4e3a $ans$ \u65f6\u53ef\u4ee5\u5206\u914d\u6210\u529f\uff0c\u90a3\u4e48 $ans+1$ \u4e5f\u5fc5\u5b9a\u53ef\u4ee5\u3002\n\n\u4e4b\u540e\uff0c\u6211\u4eec\u4e0d\u96be\u60f3\u5230\uff0c\u5e94\u8be5\u662f\u6240\u6709 $\\le mid$ \u7684\u6570\u90fd\u5f97\u5206\u914d\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\n\n$$ \\sum h_i \\ (h_i \\le mid) $$\n\n\u8fd9\u4e1c\u897f\u65e0\u8111\u6743\u503c\u7ebf\u6bb5\u6811\u987a\u4fbf\u4e00\u624b\u52a8\u6001\u5f00\u70b9\uff0c\u4e8c\u5206\u7cbe\u5ea6\u5f00 $1e-4$ \u5c31\u597d\u3002\n\n## $\\text{Code}$\n```cpp\n#include <bits/stdc++.h>\n\n#define N (int)(1e5+5) \n#define db double\n#define inf (int)(1e9)\n#define int long long\n\nusing namespace std;\n\nstruct node {\n\tint ls,rs,sum,cnt;\n}t[N*50];\n\nint a[N];\nint tot,rt,n,m;\n\nvoid update(int &cur,int l,int r,int x,int v,int vc) {\n\tif(!cur) cur=++tot;\n\tif(l==r) {\n\t\tt[cur].sum+=v; t[cur].cnt+=vc;\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif(x<=mid) update(t[cur].ls,l,mid,x,v,vc);\n\telse update(t[cur].rs,mid+1,r,x,v,vc);\n\tt[cur].sum=t[t[cur].ls].sum+t[t[cur].rs].sum;\n\tt[cur].cnt=t[t[cur].ls].cnt+t[t[cur].rs].cnt;\n}\n\nint query(int cur,int l,int r,int cl,int cr,bool fl) {\n\tif(!cur) return 0;\n\tif(r==inf&&cr>r) cr=inf;\n\tif(cl<=l&&r<=cr) return fl?t[cur].sum:t[cur].cnt;\n\tint mid=(l+r)>>1,res=0;\n\tif(cl<=mid) res=query(t[cur].ls,l,mid,cl,cr,fl);\n\tif(cr>mid) res+=query(t[cur].rs,mid+1,r,cl,cr,fl);\n\treturn res;\n}\n\ndb solve(int x) {\n\tdb l=0.0,r=1e15,res=0.0;\n\twhile(l<r-(1e-4)) {\n\t\tdb mid=(l+r)/2.0;\n\t//\tcout<<(int)mid<<' '<<query(rt,0,inf,0,mid,1)+x<<\" \"<<query(rt,0,inf,0,mid,0)*mid<<endl;\n\t\tif((query(rt,0,inf,0,mid,1)+x)<=query(rt,0,inf,0,mid,0)*mid) res=r=mid;\n\t\telse l=mid;\n\t}\n\treturn res;\n}\n\nint rd() {\n\tint f=1,sum=0; char ch=getchar();\n\twhile(!isdigit(ch)) {if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)) {sum=(sum<<3)+(sum<<1)+ch-'0';ch=getchar();}\n\treturn sum*f;\n}\n\n\nsigned main() {\n\tint op,x,y;\n\tn=rd(); m=rd();\n\tfor(int i=1;i<=n;i++) a[i]=rd(),update(rt,0,inf,a[i],a[i],1);\n\twhile(m--) {\n\t\top=rd();\n\t\tif(op==1) {\n\t\t\tx=rd(); y=rd();\n\t\t\tupdate(rt,0,inf,a[x],-a[x],-1);\n\t\t\tupdate(rt,0,inf,y,a[x]=y,1);\n\t\t} else {\n\t\t\tx=rd();\n\t\t\tprintf(\"%.4lf\\n\",solve(x));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1624849649,
        "uid": 125901,
        "name": "FxorG",
        "ccfLevel": 7,
        "title": "CF431E Chemistry Experiment"
    },
    {
        "content": "\u770b\u5230\u8fd9\u9898\u6ca1\u6709\u9898\u89e3\uff0c\u6765\u5199\u4e00\u7bc7\u3002\n\n\u9898\u610f\uff1a    \n\u6709\u4e24\u79cd\u64cd\u4f5c\uff1a   \n- \u5c06 $h_{p_i}$ \u6539\u6210 $x_i$\u3002\n- \u7ed9\u51fa\u4e00\u4e2a\u6570 $v_i$\uff0c\u5c06 $v_i$ \u968f\u610f\u5206\u914d\u7ed9\u4e00\u4e9b\u6570\uff0c\u4f7f\u5f97\u5206\u914d\u7ed9\u7684\u8fd9\u4e9b\u6570\u7684\u4f53\u79ef\u6700\u5c0f\u5316\u3002\n\n\u5148\u8003\u8651\u7b2c\u4e8c\u4e2a\u95ee\u9898\u600e\u4e48\u6c42\u89e3\u3002\n\n\u4e00\u822c\u770b\u5230\u6700\u5c0f\u5316\u95ee\u9898\uff0c\u5c31\u4f1a\u60f3\u8d77\u4e8c\u5206\u7b54\u6848\uff0c\u600e\u4e48\u5224\u65ad\u4e00\u4e2a\u6570\u662f\u5426\u5408\u6cd5\u5462\uff1f\n\n\u5f53 $\\sum_{i=1}^n[h_i\\leq mid]\\times mid -\\sum_{i=1}^n[h_i\\leq mid]h_i\\geq v_i$ \u65f6\uff0c$mid$ \u5c31\u662f\u5408\u6cd5\u7684\u3002\n\n\u4f60\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\u8fd9\u4e2a\u5f0f\u5b50\uff1a\u8bd5\u7ba1\u4e2d\u7684\u6c34\u94f6\u4f53\u79ef\u5982\u679c\u6bd4 $mid$ \u5927\uff0c\u80af\u5b9a\u5c31\u4e0d\u80fd\u5728\u88c5\u6c34\u4e86\uff0c\u6240\u4ee5\u53ea\u80fd\u5728\u8bd5\u7ba1\u4e2d\u7684\u6c34\u94f6\u4f53\u79ef\u6bd4 $mid$ \u5c0f\u7684\u8bd5\u7ba1\u91cc\u88c5\u6c34\uff0c\u8bbe\u8bd5\u7ba1\u4e2d\u7684\u6c34\u94f6\u4f53\u79ef\u6bd4 $mid$ \u5c0f\u7684\u4e00\u5171\u6709 $s$ \u4e2a\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8bd5\u7ba1\u7684\u6700\u591a\u88c5 $mid$ \u4f53\u79ef\uff0c\u6240\u4ee5\u6700\u591a\u88c5 $s\\times mid$ \u4f53\u79ef\uff0c\u770b $s\\times mid$ \u662f\u5426\u6bd4\u8fd9 $s$ \u4e2a\u8bd5\u7ba1\u91cc\u7684\u6c34\u94f6\u7684\u603b\u4f53\u79ef\u52a0\u4e0a\u9700\u8981\u88c5\u7684\u6c34\u7684\u4f53\u79ef\u5927\u3002\n\n\u4e8e\u662f $\\mathcal{O(n^2\\log n)}$\u7684\u505a\u6cd5\u5c31\u51fa\u6765\u4e86\u3002\n\n\u600e\u4e48\u4f18\u5316\u5462\uff0c\u7528\u4e00\u9897\u503c\u57df\u7ebf\u6bb5\u6811\u7ef4\u62a4 $h_i$ \uff0c\u56e0\u4e3a $h_i,x_i,v_i$ \u90fd\u5f88\u5927\uff0c\u6240\u4ee5\u5c06\u8fd9\u4e9b\u6570\u79bb\u6563\u5316\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal{O(n\\log^2n)}$\uff0c\u8dd1\u7684\u662f\u771f\u7684\u6162\uff0c\u6700\u5751\u7684\u662f\u8fd9\u4e2a\u4e8c\u5206\u8fb9\u754c $r$ \u53d6\u5927\u4e86\u5c31\u4f1a T \u7206\uff0c\u9700\u8981\u4e00\u4e2a\u4e00\u4e2a\u8bd5\u3002\n\n\u732e\u4e0a\u6211\u4e11\u964b\u7684\u4ee3\u7801\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n#define LL long long\n#define lson(k) k<<1\n#define rson(k) k<<1|1\nconst int MAXN=3e5+5;\nconst double eps=1e-7;\nLL s[MAXN<<2],h[MAXN],a[MAXN],Q[MAXN][3],cnt[MAXN<<2];\nint n,q,len;\nstruct node{\n\tLL s,cnt;\n};\nint Getpos(double x){\n\treturn upper_bound(a+1,a+len+1,x)-a-1;\n}\nvoid Add(int k,int l,int r,int x,LL y,LL z){\n\tif(l==r){\n\t\tcnt[k]+=z;\n\t\ts[k]+=z*y;\n\t\treturn ; \n\t}\n\tint mid=(l+r)>>1;\n\tif(x<=mid)Add(lson(k),l,mid,x,y,z);\n\telse Add(rson(k),mid+1,r,x,y,z);\n\tcnt[k]=cnt[lson(k)]+cnt[rson(k)];\n\ts[k]=s[lson(k)]+s[rson(k)];\n}\nnode query(int k,int l,int r,int x,int y){\n\tif(x>y)return node{0,0};\n\tif(y<l||x>r)return node{0,0};\n\tif(x<=l&&r<=y)return node{s[k],cnt[k]};\n\tint mid=(l+r)>>1;\n\tnode tmpl,tmpr;\n\ttmpl.cnt=tmpl.s=tmpr.cnt=tmpr.s=0;\n\tif(x<=mid)tmpl=query(lson(k),l,mid,x,y);\n\tif(mid+1<=y)tmpr=query(rson(k),mid+1,r,x,y);\n\treturn node{tmpl.s+tmpr.s,tmpl.cnt+tmpr.cnt};\n} \nbool check(double mid,double v){\n\tnode ans=query(1,1,len,1,Getpos(mid));\n\tif(ans.cnt*mid-ans.s>=v)return 1;\n\telse return 0;\n}\nint main(){\n\tscanf(\"%d %d\",&n,&q);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lld\",&h[i]),a[++len]=h[i];\n\tfor(int i=1;i<=q;i++){\n\t\tscanf(\"%lld\",&Q[i][0]);\n\t\tif(Q[i][0]==1){\n\t\t\tscanf(\"%lld %lld\",&Q[i][1],&Q[i][2]);\n\t\t\ta[++len]=Q[i][2];\n\t\t}else scanf(\"%lld\",&Q[i][1]);\n\t}\n\tsort(a+1,a+len+1);\t\n\tlen=unique(a+1,a+len+1)-a-1;\n\tfor(int i=1;i<=n;i++)Add(1,1,len,Getpos(h[i]),h[i],1);\n\tfor(int i=1;i<=q;i++){\n\t\tif(Q[i][0]==1){\n\t\t\tAdd(1,1,len,Getpos(h[Q[i][1]]),h[Q[i][1]],-1);\n\t\t\th[Q[i][1]]=Q[i][2];\n\t\t\tAdd(1,1,len,Getpos(h[Q[i][1]]),h[Q[i][1]],1);\n\t\t}else{\n\t\t\tdouble l=0,r=Q[i][1]+1e9;\n\t\t\tfor(int k=0;k<=100;k++){\n\t\t\t\tdouble mid=(l+r)/2;\n\t\t\t\tif(check(mid,Q[i][1]))r=mid;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tprintf(\"%.8lf\\n\",(l+r)/2);\n\t\t}\n\t}\n\treturn 0;\n} \n```",
        "postTime": 1587178341,
        "uid": 154560,
        "name": "Silver187",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF431E \u3010Chemistry Experiment\u3011"
    },
    {
        "content": "\u9898\u76ee\u7ffb\u8bd1\u6709\u70b9\u96be\u7ef7\u3002\n\n\u6d6e\u70b9\u6570\u76f4\u63a5\u8ba1\u7b97\u6bd4\u8f83\u56f0\u96be\uff0c\u8003\u8651\u4e8c\u5206\u7b54\u6848\u8f6c\u5316\u4e3a\u53ef\u884c\u6027\u5224\u65ad\u3002\u5373\u6c42\u51fa\u4e0d\u5927\u4e8e\u67d0\u4e2a\u4f53\u79ef\u6700\u591a\u80fd\u653e\u591a\u5c11\u6c34\u518d\u6bd4\u8f83\u5373\u53ef\u3002\n\n\u7136\u540e\u95ee\u9898\u5c31\u662f\u5982\u4f55\u6c42\u4e0d\u5927\u4e8e\u67d0\u4e2a\u5bb9\u79ef\u6700\u591a\u80fd\u653e\u591a\u5c11\u6c34\u3002\n\n\u5df2\u77e5\u4f53\u79ef\u4e8c\u5206\u5230 $K$\uff0c\u90a3\u4e48\u6c34\u94f6\u4f53\u79ef\u6240\u6709\u4e0d\u5927\u4e8e $K$ \u7684\u90fd\u53ef\u4ee5\u4ea7\u751f\u8d21\u732e\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u603b\u4f53\u79ef\u51cf\u6c34\u94f6\u4f53\u79ef\u6765\u8ba1\u7b97\uff0c\u6240\u4ee5\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u6709\u591a\u5c11\u74f6\u6c34\u94f6\u4f53\u79ef\u4e0d\u5927\u4e8e $K$ \u548c\u8fd9\u4e9b\u6c34\u94f6\u7684\u603b\u4f53\u79ef\u3002\n\n\u8003\u8651\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\uff0c\u628a\u6240\u6709\u6c34\u94f6\u4f53\u79ef\u79bb\u6563\u5316\uff0c\u7136\u540e\u628a\u4f53\u79ef\u6620\u5c04\u5230\u503c\u57df\u4e0a\uff0c\u5f00\u503c\u57df\u7ebf\u6bb5\u6811\u5373\u53ef\u89e3\u51b3\u95ee\u9898\u3002\n\n\u5bf9\u4e8e\u6ee1\u8db3\u8981\u6c42\u7684\u74f6\u5b50\u4e2a\u6570\uff0c\u6bcf\u4e2a\u74f6\u5b50\u7684\u4f53\u79ef\u5bf9\u5e94\u7684\u4f4d\u7f6e\u52a0\u4e00\uff1b\u5bf9\u4e8e\u6ee1\u8db3\u8981\u6c42\u7684\u603b\u4f53\u79ef\uff0c\u6bcf\u4e2a\u74f6\u5b50\u7684\u4f53\u79ef\u5bf9\u5e94\u7684\u4f4d\u7f6e\u52a0\u4e0a\u4f53\u79ef\u5373\u53ef\u3002\n\n\u6700\u540e\u7684\u67e5\u8be2\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u4e8c\u5206\u4e5f\u53ef\u4ee5\u5148\u4e8c\u5206\u51fa\u4f4d\u7f6e\u518d\u67e5\u8be2\uff0c\u6574\u4e2a\u4e8c\u5206\u8fc7\u7a0b\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\uff0c\u4f46\u6211\u6ca1\u5199\u3002\n\n\u4e0b\u8ff0\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n (\\log V+\\log \\frac{1}{\\varepsilon}))$\u3002\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<string>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#include<stack>\n#include<vector>\n#include<map>\n#include<bitset>\n#include<ctime>\n#define int long long\n#define ls (p<<1)\n#define rs (p<<1|1)\n#define mid ((l+r)>>1)\nusing namespace std;\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nconst int N=2e5+10;\nconst double eps=1e-5;\nstruct Que{\n\tint opt,x,y;\n}q[N];\nint n,m,k,a[N];\nint b[N],c[N],d[N],to[N],cnt;\nmap<int,int>vis;\nstruct Tree{\n\tint sum[N<<2],id;\n\tinline void pushup(int p){\n\t\tsum[p]=sum[ls]+sum[rs];\n\t}\n\tvoid build(int p,int l,int r){\n\t\tif(l==r){\n\t\t\tif(id==1)\n\t\t\t\tsum[p]=c[l];\n\t\t\telse sum[p]=d[l];\n\t\t//\tsum[p]=id==1?c[l]:1;\n\t\t\treturn;\n\t\t}\n\t\tbuild(ls,l,mid);\n\t\tbuild(rs,mid+1,r);\n\t\tpushup(p);\n\t}\n\tvoid update(int x,int p,int l,int r,int k){\n\t\tif(l==x&&x==r){\n\t\t\tsum[p]+=k;\n\t\t\treturn;\n\t\t}\n\t\tif(x<=mid)update(x,ls,l,mid,k);\n\t\tif(x>mid) update(x,rs,mid+1,r,k);\n\t\tpushup(p);\n\t}\n\tinline int query(int L,int R,int p,int l,int r){\n\t\tif(L>R)\n\t\t\treturn 0;\n\t\tif(L<=l&&r<=R)\n\t\t\treturn sum[p];\n\t\tint res=0;\n\t\tif(L<=mid)res+=query(L,R,ls,l,mid);\n\t\tif(R>mid) res+=query(L,R,rs,mid+1,r);\n\t\treturn res;\n\t}\n}T1,T2;\nint get(double x){\n\tint l=1,r=k,ans=0;\n\twhile(l<=r){\n\t\tif(to[mid]<=x){\n\t\t\tans=mid;\n\t\t\tl=mid+1;\n\t\t}\n\t\telse r=mid-1;\n\t}\n\treturn ans;\n}\nint check(double x,int y){\n\tint p=get(x);\n\tint s1=T1.query(1,p,1,1,k),s2=T2.query(1,p,1,1,k);\n\tdouble res=s2*x-s1;\n\tif(res>=y)\n\t\treturn 1;\n\treturn 0;\n}\nsigned main()\n{\n\t//freopen(\"t1.in\",\"r\",stdin);\n\t//freopen(\"t1.out\",\"w\",stdout);\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i]=read();\n\t\tb[++cnt]=a[i];\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tq[i].opt=read();\n\t\tif(q[i].opt==1){\n\t\t\tq[i].x=read(),q[i].y=read();\n\t\t\tb[++cnt]=q[i].y;\n\t\t}\n\t\telse q[i].x=read();\n\t}\n\tsort(b+1,b+cnt+1);\n\tk=unique(b+1,b+cnt+1)-b-1;\n\tfor(int i=1;i<=k;i++){\n\t\tvis[b[i]]=i;\n\t\tto[i]=b[i];\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tc[vis[a[i]]]+=a[i];\n\t\td[vis[a[i]]]++;\n\t}\n\tT1.id=1,T2.id=2;\n\tT1.build(1,1,k);\n\tT2.build(1,1,k);\n\tfor(int i=1;i<=m;i++){\n\t\tint opt=q[i].opt,x=q[i].x,y=q[i].y;\n\t\tif(opt==1){\n\t\t\tint w=vis[y],p=vis[a[x]];\n\t\t\tT1.update(p,1,1,k,-a[x]);\n\t\t\tT2.update(p,1,1,k,-1);\n\t\t\ta[x]=y;\n\t\t\tT1.update(w,1,1,k,a[x]);\n\t\t\tT2.update(w,1,1,k,1);\n\t\t}\n\t\tif(opt==2){\n\t\t\tdouble l=0,r=1e15,ans=l;\n\t\t\twhile(r-l>eps){\n\t\t\t\tdouble midd=(l+r)/2;\n\t\t\t\tif(check(midd,q[i].x)){\n\t\t\t\t\tr=midd;\n\t\t\t\t\tans=midd;\n\t\t\t\t}\n\t\t\t\telse l=midd;\n\t\t\t}\n\t\t\tprintf(\"%.5lf\",ans);\n\t\t\tputchar('\\n');\n\t\t}\n\t}\n\treturn 0;\n}\n\n\n```",
        "postTime": 1685020952,
        "uid": 253738,
        "name": "\u542c\u53d6MLE\u58f0\u4e00\u7247",
        "ccfLevel": 7,
        "title": "CF431E"
    },
    {
        "content": "\u6743\u503c\u7ebf\u6bb5\u6811\u3002\n\n>finally let's find the minimum among counted maximums.\n\n\u6700\u5927\u503c\u6700\u5c0f\u3002\u4e8c\u5206\u3002\u8bbe\u5f53\u524d\u4e8c\u5206\u4e2d\u70b9\u4e3a $k$\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $h_i\\le k$ \u7684\u8bd5\u7ba1\u624d\u4f1a\u9020\u6210\u8d21\u732e\uff0c\u82e5 $\\sum\\limits_{h_i\\le k}k-h_i\\ge v$ \u5219 $k$ \u5408\u6cd5\u3002\n\n$\\sum\\limits_{h_i\\le k}k-h_i=\\sum\\limits_{h_i\\le k}k-\\sum\\limits_{h_i\\le k}h_i$\u3002\u5206\u522b\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\nstruct T\n{\n\tT *l = 0, *r = 0;\n\tint c = 0;long long s = 0;\n\tvoid u()\n\t{\n\t\tc = s = 0;\n\t\tif(l) c += l->c, s += l->s;\n\t\tif(r) c += r->c, s += r->s;\n\t}\n}*r;\nvoid M(int l, int x, int y, int s, int t, T *&p)\n{\n\tif(!p) p = new T;if(s == t) return (void)(p->c += x, p->s += y);int m = s + t\n\t>> 1;if(l <= m) M(l, x, y, s, m, p->l);else M(l, x, y, m + 1, t, p->r);p->u();\n}\nint X(int l, int r, int s, int t, T *p)\n{\n\tif(!p) return 0;if(l <= s && t <= r) return p->c;int m = s + t >> 1, q = 0;if(l\n\t<= m) q += X(l, r, s, m, p->l);if(r > m) q += X(l, r, m + 1, t, p->r);return q;\n}\nlong long Y(int l, int r, int s, int t, T *p)\n{\n\tif(!p) return 0;if(l <= s && t <= r) return p->s;int m = s + t >> 1;long long q = 0;\n\tif(l <= m) q += Y(l, r, s, m, p->l);if(r > m) q += Y(l, r, m + 1, t, p->r);return q;\n}\nint n, m, a[100050];long long x;double L, R, K;\nint main()\n{\n\tscanf(\"%d%d\", &n, &m);\n\tfor(int i = 1;i <= n;++i)\n\t\tscanf(\"%d\", a + i), M(a[i], 1, a[i], 0, 1e9, r);\n\tfor(int i = 0, o;i < m;++i)\n\t{\n\t\tscanf(\"%d%lld\", &o, &x);\n\t\tif(o & 1) M(a[x], -1, -a[x], 0, 1e9, r), scanf(\"%d\", a + x), M(a[x], 1, a[x], 0, 1e9, r);\n\t\telse\n\t\t{\n\t\t\tL = 0;R = 1e11;while(fabs(L - R) > 1e-5){K = (L + R) / 2;\n\t\t\tif(K * X(0, min(K, 1e9), 0, 1e9, r) - Y(0, min(K, 1e9), 0, 1e9, r) >= x)\n\t\t\tR = K;else L = K;}printf(\"%.5lf\\n\", L);\n\t\t}\n\t}\n}\n```\n",
        "postTime": 1679271792,
        "uid": 388651,
        "name": "5k_sync_closer",
        "ccfLevel": 7,
        "title": "CF431E Chemistry Experiment \u9898\u89e3"
    },
    {
        "content": "## Solution\n\n\u4e3a\u65b9\u4fbf\u7406\u89e3 , \u628a\u6c34\u94f6\u6539\u4e3a\u6c5e .\n\n\u9996\u5148 , \u6211\u4eec\u5e94\u5206\u6790\u51fa\u7ed3\u8bba : \u6c34\u4e00\u5b9a\u662f\u96c6\u4e2d\u5728\u6c5e\u6700\u5c11\u7684\u51e0\u4e2a\u8bd5\u7ba1\u91cc , \u800c\u4e14\u6c34\u9762\u4e00\u6837\u5e73 . \n\n> \u8fd9\u5f88\u597d\u7406\u89e3 , \u5982\u679c\u628a\u6c34\u653e\u5728\u6c5e\u591a\u7684\u8bd5\u7ba1\u91cc\u9762 , \u90a3\u4e48\u628a\u6c34\u8f6c\u79fb\u5230\u6c5e\u5c11\u7684\u80af\u5b9a\u4e0d\u52a3 . \n\n> \u540c\u6837 , \u5982\u679c\u6c34\u9762\u4e0d\u4e00\u6837\u5e73 , \u628a\u6c34\u9762\u9ad8\u7684\u4e2d\u591a\u4f59\u7684\u6c34\u8f6c\u5230\u6c34\u9762\u4f4e\u7684\u4e5f\u4e0d\u52a3 .\n\n\u6240\u4ee5\u6211\u4eec\u8981\u652f\u6301\u90e8\u52a8\u6001\u5220\u51cf , \u7ef4\u62a4\u6709\u5e8f\u7684\u6570\u7ec4 , \u5e73\u8861\u6811\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9 .\n\n\u6700\u540e\u7b54\u6848\u80af\u5b9a\u662f\u628a\u524d $k$ \u4e2a\u8bd5\u7ba1\u90fd\u8865\u7684\u548c\u8bd5\u7ba1 $k$ \u4e2d\u7684\u6c5e\u4e00\u6837\u9ad8 , \u8bd5\u7740\u4e8c\u5206\u51fa $k$ . \n\n\u7531\u4e8e\u5e73\u8861\u6811\u662f\u5e73\u8861\u7684 , \u6240\u4ee5\u904d\u5386\u5b83 , \u590d\u6742\u5ea6 $O(\\text{m log n})$ . \u5177\u4f53\u505a\u6cd5\u662f , \u8bb0\u5f55\u5b50\u6811\u5185\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u6743\u503c\u548c . \n\n\u4e8c\u5206\u7684\u65f6\u5019 , \u8bb0\u5f55\u5b50\u6811\u5916\u5df2\u7ecf\u6709\u591a\u5c11\u8282\u70b9\u6570\u548c\u6743\u503c\u548c , \u8ba1\u7b97\u8865\u5e73\u9700\u8981\u591a\u5c11 . \n\n\u5982\u679c\u8db3\u591f , \u5c31\u8d70\u5411\u53f3\u5b50\u6811 , \u5426\u5219\u8d70\u5411\u5de6\u5b50\u6811 . \n\n\u5b9e\u73b0\u7684\u8bdd , \u53c2\u8003\u4e8c\u5206\u7b54\u6848\u662f\u600e\u4e48\u5b9e\u73b0\u7684 .\n\n[code](https://codeforces.com/contest/431/submission/150026290) .\n\n452 ms , \u6240\u4ee5 FHQ \u7684\u5e38\u6570\u4e5f\u6ca1\u6709\u90a3\u4e48\u53ef\u6015 ?",
        "postTime": 1647609868,
        "uid": 120947,
        "name": "Purslane",
        "ccfLevel": 7,
        "title": "CF431E"
    }
]