[
    {
        "content": "## \u9898\u610f\n$n$\u76d2\u6392\u6210\u4e00\u5217\u7684\u7cd6\u679c\u76d2\uff0c\u7b2c$i$\u76d2\u6709$a_i$\u4e2a\u7cd6\u679c\n\n\u6bcf\u6b21\u53ef\u4ee5\u53d6\u51fa\u67d0\u4e00\u76d2\u4e00\u9897\u7cd6\u679c\u653e\u5230\u76f8\u90bb\u7684\u7cd6\u679c\u76d2\u91cc\n\n\u95ee\u4f7f\u5f97\u6240\u6709\u76d2\u5b50\u7684\u91cc\u7684\u7cd6\u679c\u6570\u5747\u80fd\u88ab\u67d0\u4e2a$k(k>1)$\u6574\u9664\u7684\u6700\u5c11\u79fb\u52a8\u6b21\u6570\n\n---\n\n## [\u9898\u89e3](https://mp.csdn.net/mdeditor/103181464)\n\n\u8bbe\u7cd6\u679c\u603b\u6570\u7684$Sum$\uff08\u663e\u7136$Sum=1$\u65e0\u89e3\uff09\n\n\u7b26\u5408\u6761\u4ef6\u7684$k$\u4e00\u5b9a\u6ee1\u8db3$k\\mid Sum$\n\n\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a$k$\u5982\u4f55\u6c42\u89e3\u6700\u5c11\u7684\u79fb\u52a8\u6b21\u6570\n\n\u9996\u5148\u80af\u5b9a\u8981\u5c06\u6240\u6709\u7684$a_i$\u5bf9$k$\u53d6\u4f59\n\n\u5bf9\u4e8e\u4e00\u4e2a$a_i$\u53ef\u4ee5\u5c06$a_i$\u9897\u7cd6\u679c\u5168\u90e8\u5411\u540e\u632a\uff0c\u4e8e\u662f$a_{i+1}=(a_{i+1}+a_i)\\mod k$\n\n\u4e5f\u53ef\u4ee5\u4ece\u540e\u9762\u632a$k-a_i$\u9897\u7cd6\u679c\u5230$a_i$\u4e0a\uff0c\u4e8e\u662f$a_{i+1}=a_{i+1}-(k-a_i)\\equiv a_{i+1}+a_i \\mod k$\n\n\u8bbe$S_i=\\sum_{k=1}^ia_i \\mod k$\uff0c\u90a3\u4e48$Ans=\\sum_{i=1}^n\\min(S_i,k-S_i)$\n\n\u901a\u8fc7\u4e0a\u9762\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u5982\u679c$k_1\\mid Sum,k_2\\mid Sum$\uff0c\u4e14$k=k_1k_2\\mid Sum$\n\n\u90a3\u4e48$k$\u7684\u7b54\u6848\u4e00\u5b9a\u4e0d\u4f1a\u6bd4$k_1,k_2$\u4f18\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u679a\u4e3e$Sum$\u7684\u8d28\u56e0\u5b50\u5373\u53ef\n\n\u9898\u76ee\u5f53\u4e2d$Sum\\le10^{12}$\uff0c\u800c$2\\times3\\times5\\times\\ldots\\times37>10^{12}$\uff0c\u6240\u4ee5\u8ba1\u7b97\u6b21\u6570\u4e0d\u4f1a\u592a\u591a\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\times Sum$\u8d28\u56e0\u5b50\u4e2a\u6570$+\\sqrt{Sum})$\n\n```cpp\nusing ll=long long;\ninline ll Calc(ll p){\n\tll Cnt=0,Tmp=0;\n\tfor(int i=1;i<=n;++i)\n\t\tCnt=(Cnt+a[i])%p,Tmp+=min(Cnt,p-Cnt);\n\treturn Tmp;\n}\ninline void Sol(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d\",a+i),Sum+=a[i];\n\tif(Sum<2)\n\t\treturn(void)puts(\"-1\");\n\tAns=-1ull>>1;\n\tfor(int i=2;(ll)i*i<=Sum;++i)\n\t\tif(Sum%i==0){\n\t\t\twhile(Sum%i==0)Sum/=i;\n\t\t\tAns=min(Ans,Calc(i));\n\t\t}\n\tif(Sum>1)\n\t\tAns=min(Ans,Calc(Sum));\n\tprintf(\"%d\\n\",Ans);\n}\n```",
        "postTime": 1574513842,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1254B2"
    },
    {
        "content": "reference\uff1aCodeforces Tutorial\u3002\n\n\u5148\u6765\u8003\u8651\u56fa\u5b9a $k$ \u65f6\u600e\u4e48\u505a\u3002\u8bbe $b_i = \\sum_{j = 1}^{i} a_j$\uff0c\u53d1\u73b0\uff1a\n\n$$\\forall 1 \\le i \\le n ,{k \\mid a_i} \\Longleftrightarrow \\forall 1 \\le i \\le n, k \\mid b_i$$\n\n\u540c\u65f6\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n1. \u5c06 $a_i$ \u53d6\u51fa $1$ \u5e76\u653e\u5165 $a_{i+1}$ \u8fd9\u4e2a\u64cd\u4f5c\u7b49\u4ef7\u4e8e $b_i \\gets b_i - 1$\u3002\n\n2. \u5c06 $a_{i+1}$ \u53d6\u51fa $1$ \u653e\u5165 $a_i$ \u7b49\u4ef7\u4e8e $b_i \\gets b_i + 1$\u3002\n\n\u90a3\u4e48\u5f53\u56fa\u5b9a $k$ \u65f6\uff0c\u7b54\u6848\uff1a\n\n$$ans = \\sum_{i=1}^n \\min(b_i \\bmod k, k - b_i \\bmod k)$$\n\n\u81f3\u6b64\uff0c\u672c\u9898\u5173\u952e\u5df2\u7ecf\u89e3\u51b3\u3002\n\n\u5bf9\u4e8e `Easy Version` \u6211\u4eec\u53ea\u9700 $O(\\sqrt{b_n})$ \u679a\u4e3e $k$\uff0c\u5bf9\u6240\u6709\u60c5\u51b5\u53d6 $\\min$ \u5373\u53ef\u3002\n\n\u800c\u5bf9\u4e8e `Hard Version` \u9700\u8981\u89c2\u5bdf\u5230\uff0c\u6240\u6709\u7684\u5408\u6570 $k$ \u90fd\u662f\u6ca1\u6709\u5fc5\u8981\u7684\uff0c\u5c06\u5176\u66ff\u6362\u6210\u5176\u6700\u5c0f\u8d28\u56e0\u5b50\u7b54\u6848\u4e0d\u4f1a\u53d8\u52a3\u3002\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u679a\u4e3e $b_n$ \u7684\u8d28\u56e0\u5b50\u5373\u53ef\u3002\n\n\u53c2\u8003\u5b9e\u73b0\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long \n\nusing namespace std;\n\nusing int64 = long long;\n\nconst int inf = 5e18 + 10;\n\nsigned main () {\n  ios::sync_with_stdio(false);\n  cin.tie(nullptr);\n\n  int n;\n\n  cin >> n;\n\n  vector<int> a(n + 1);\n  int sum = 0;\n\n  for (int i = 1; i <= n; ++i) {\n    cin >> a[i];\n    sum += a[i];\n  }\n\n  if (sum == 1) {\n    cout << -1 << '\\n';\n    return 0;\n  }\n\n  int res = inf;\n  vector<int> factor;\n\n  factor.emplace_back(sum);\n  for (int i = 2; i * i <= sum; ++i) {\n    if (sum % i == 0) {\n      factor.emplace_back(i);\n      while (sum % i == 0) {\n        sum /= i;\n      }\n    }\n  }\n  if (sum > 1) {\n    factor.emplace_back(sum);\n  }\n\n  auto calc = [&](int x) -> int{\n    vector<int> b(n + 1);\n    int res = 0;\n\n    for (int i = 1; i <= n; ++i) {\n      b[i] = b[i - 1] + a[i] % x;\n      b[i] %= x;\n      res += min(b[i], x - b[i]);\n    }\n\n    return res;\n  };\n\n  for (int x : factor) {\n    res = min(res, calc(x));\n  }\n\n  cout << (res == inf ? -1 : res) << '\\n';\n}\n```\n",
        "postTime": 1663818362,
        "uid": 175456,
        "name": "Licykoc",
        "ccfLevel": 0,
        "title": "CF1254B2 Send Boxes to Alice (Hard Version)"
    },
    {
        "content": "\u611f\u89c9\u633a\u7b80\u5355\u7684\u5427\uff0c\u4e5f\u5c31\u4e00\u4e2a\u7eff\u6216\u9ec4\uff1f\u84dd\u6709\u70b9\u5047\u4e86\r\n\r\n\u601d\u8def\uff1a\r\n\r\n\u679a\u4e3e $k$ \u5e76\u5224\u65ad\u6b64\u65f6\u7684\u6700\u5c0f\u7b54\u6848\u3002\u8bb0  $S= \\sum_{i=1}^na_i$\r\n\u7531\u4e8e $k$ \u53ef\u4ee5\u53d6\u5230 $n\\times a$ \uff0c\u76f4\u63a5\u679a\u4e3e\u590d\u6742\u5ea6\u7206\u70b8\u3002\u4e0d\u96be\u60f3\u5230,$k$ \u53ef\u4ee5\u53d6\u7684\u503c\u5fc5\u987b\u662f $S$ \u7684\u56e0\u6570\uff0c\u56e0\u4e3a\u6700\u540e\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u7684 $a[i]$ \u90fd\u662f $k$ \u7684\u500d\u6570\uff0c\u5b83\u4eec\u7684\u548c\u5373 $S$ \u81ea\u7136\u4e5f\u662f $k$ \u7684\u500d\u6570\u3002\u8fdb\u4e00\u6b65\u7684\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u65b9\u6848\u548c\u5bf9\u5e94\u7684 $k$\uff0c\u4ee4 $k$ \u53d6\u5176\u6bcf\u4e00\u4e2a\u975e $1$ \u7684\u56e0\u6570\u65f6\uff0c\u8fd9\u79cd\u65b9\u6848\u4ecd\u7136\u6ee1\u8db3\u9898\u610f\uff0c\u6240\u4ee5\u6700\u5c0f\u7684\u7b54\u6848\u5fc5\u5b9a\u5728 $k$ \u4e3a $S$ \u7684\u8d28\u56e0\u6570\u65f6\u53d6\u5230\u3002\r\n\r\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u5224\u65ad\u5bf9\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684 $k$ \u7684\u6700\u5c0f\u7b54\u6848\u3002\u91c7\u7528\u8d2a\u5fc3\u7684\u7b56\u7565\uff1a\u82e5 $a[i]\\bmod k\\leq k/2$\uff0c\u5219\u5c06 $a[i]\\bmod k$ \u7ed9\u5230 $a[i+1]$\uff0c\u5426\u5219\u4ece $a[i+1]$ \u53d6 $k-a[i]\\bmod k$\uff0c\u7b54\u6848\u4e3a\u6bcf\u4e00\u6b65\u6240\u79fb\u52a8\u7684\u503c\u4e4b\u548c\u3002 \r\n\r\n\u611f\u6027\u8bc1\u660e\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $a[i]$\uff0c\u663e\u7136\u5904\u7406\u5b8c\u5b83\u4e0e $a[i+1]$ \u4e4b\u95f4\u7684\u5173\u7cfb\u540e\u5b83\u5bf9\u540e\u9762\u7684\u6570\u5c31\u65e0\u6cd5\u9020\u6210\u5f71\u54cd\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u6bcf\u4e00\u4e2a $a[i]$ \u90fd\u8d2a\u5fc3\u53d6\u5230\u53ef\u4ee5\u53d6\u7684\u6700\u5c0f\u503c\u5e76\u5c06\u5f71\u54cd\u7d2f\u52a0\u7ed9 $a[i+1]$ \u7684\u7b56\u7565\u662f\u6b63\u786e\u7684\u3002\r\n\r\n\u590d\u6742\u5ea6\uff1a$O(n\\times \\log(S))$\r\n\r\n\u4ee3\u7801\uff1a\r\n```cpp\r\n#include<cstdio>\r\n#include<cstring>\r\n#include<algorithm>\r\nusing namespace std;\r\nconst int N=1001000;\r\nint a[N];\r\nlong long b[N];\r\nlong long p[20];//2*3*5......*37>10^12>=S,\u8d28\u56e0\u6570\u4e2a\u6570\u5fc5\u7136\u5c0f\u4e8e20 \r\nint tot;\r\nint main(){\r\n\tint n;\r\n\tlong long sum=0;\r\n\tscanf(\"%d\",&n);\r\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),sum+=a[i];\r\n\tfor(long long i=2;i*i<=sum;i++){\r\n\t\tif(sum%i)continue;\r\n\t\tp[++tot]=i;\r\n\t\twhile(sum%i==0)sum/=i;\r\n\t}\r\n\tif(sum>1)p[++tot]=sum;//\u5206\u89e3\u8d28\u56e0\u6570\u5e76\u5b58\u5165p\u6570\u7ec4 \r\n\tlong long ans=-1;//\u65e0\u89e3\u8f93\u51fa-1 \r\n\tfor(int i=1;i<=tot;i++){\r\n\t\tsum=0;\r\n\t\tfor(int j=1;j<=n;j++)b[j]=a[j];\r\n\t\tfor(int j=1;j<n;j++){\r\n\t\t\tif(!b[j]%p[i])continue;\r\n\t\t\t//\u5904\u7406\u6bcf\u4e00\u4f4d\u7684\u7b54\u6848\u548c\u5f71\u54cd\uff0c\u4e0d\u53d6\u6a21\u4e5f\u662f\u53ef\u4ee5\u7684 \r\n\t\t\t//\u6709a[i]\u7ed9a[i+1]\u548ca[i+1]\u7ed9a[i]\u4e24\u79cd\u53ef\u884c\u64cd\u4f5c\uff0c\u53d6\u8f83\u5c0f\u503c \r\n\t\t\tif(b[j]%p[i]<=p[i]/2)sum+=b[j]%p[i],b[j+1]+=b[j]%p[i];\r\n\t\t\telse sum+=p[i]-b[j]%p[i],b[j+1]+=b[j]%p[i];\r\n\t\t}\r\n\t\tans=ans==-1?sum:min(ans,sum);\r\n\t}\r\n\tprintf(\"%lld\",ans);\r\n}\r\n```\r\n",
        "postTime": 1629293064,
        "uid": 115159,
        "name": "laboba",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1254B2 Send Boxes to Alice (Hard Version)"
    },
    {
        "content": "[My blog](https://www.cnblogs.com/y2823774827y/p/11895446.html)\n\n## \u9898\u610f\n> n\u4e2a\u6570\u5b57\u7684\u5e8f\u5217a\uff0c\u5c06i\u4f4d\u7f6e\u5411j\u4f4d\u7f6e\u8f6c\u79fbx\u4e2a(a[i]-x,a[j]+x)\u7684\u82b1\u8d39\u4e3a$x\\times |i-j|$\uff0c\u6700\u7ec8\u72b6\u6001\u53ef\u884c\u7684\u6761\u4ef6\u4e3a\u6240\u6709a[i]\u5747\u88abK\u6574\u9664(K>1)\uff0c\u6c42\u6700\u5c0f\u82b1\u8d39\n\n## \u505a\u6cd5\n$sum=\\sum\\limits a$\uff0c\u5219$K|sum$\n\n- \u6709$K1|sum,K2|sum$\uff0c\u82e5$K1|K2$\uff0c\u5219\u8f6c\u79fb\u5230\u88abK1\u6574\u9664\u6bd4\u8f6c\u79fb\u5230K2\u66f4\u4f18\u3002\u8fd9\u4e2a\u662f\u663e\u7136\u7684\uff0c\u6240\u4ee5\u6700\u7ec8\u53ef\u80fd\u6210\u4e3a\u6700\u4f18\u89e3\u7684K\u4e2a\u6570\u4e3a$logsum\\le 40$\n\n\u5bf9\u4e8e\u4e00\u4e2a\u679a\u4e3e\u5230\u7684K\uff0c\u5c06$b[i]=a[i]\\% K$\n\n\u5bf9\u4e8eb\u4e0d\u4e3a0\u7684\u4f4d\u7f6e\uff0c\u6211\u4eec\u7c7b\u4f3c\u8d2a\u5fc3\u5f97\u8003\u8651\n\n- \u4ec5\u6709\u524d\u9762\u4e00\u4e2a\u4f4d\u7f6epre\u4e0d\u5408\u6cd5\uff1a\u56e0\u4e3a\u5982\u679c\u6709\u4e24\u4e2a\uff0c\u5728\u4e4b\u524d\u6211\u4eec\u53ef\u4ee5\u5408\u6210\u4e00\u4e2a\n\n- \u5982\u679cb[i]\u53ef\u4ee5\u4e0e\u524d\u4e00\u4e2a\u8865\u6ee1(b[i]\u53ef\u80fd\u8fd8\u4f1a\u6709\u591a\u4f59\u7684)\uff0c\u8003\u8651\u4ecei\u8f6c\u79fb\u5230pre\u4f18\u8fd8\u662fpre\u8f6c\u79fb\u5230i\u4f18\n\n- \u5982\u679cb[i]\u4e0d\u80fd\u8865\u6ee1\u524d\u4e00\u4e2a\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u8003\u8651\u5982\u679c\u80fd\u8865\u6ee1\u4f1a\u8865\u5230\u54ea\u91cc\uff0c\u7136\u540e\u66f4\u65b0\u4e00\u4e0bpre\n\n## Code\n\u6bd4\u8d5b\u65f6\u8c03\u4e86\u597d\u4e45\uff0c\u7801\u98ce\u6709\u70b9\u5947\u602a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\ntypedef long long ll;\nconst LL maxn=1e6+9;\nconst ll inf=0x3f3f3f3f3f3f3f3f;\nLL Read(){\n\tLL x(0),f(1); char c=getchar();\n\twhile(c<'0' || c>'9'){\n\t\tif(c=='-') f=-1; c=getchar();\n\t}\n\twhile(c>='0' && c<='9'){\n\t\tx=(x<<3)+(x<<1)+c-'0'; c=getchar();\n\t}return x*f;\n}\nLL n,T,tot;\nll sum;\nLL a[maxn],b[maxn];\nll bel[maxn];\nbool Check(ll x){\n\tfor(LL i=1;i<=tot;++i) if(x%bel[i]==0) return false;\n\treturn true;\n}\nint main(){\n\tn=Read();\n\tfor(LL i=1;i<=n;++i) a[i]=Read(),sum+=a[i];\n\t\n\t\n\t/*srand(time(NULL));\n\tn=1000000;\n\tfor(LL i=1;i<=n;++i) a[i]=rand()%1000001,sum+=a[i];\n\tprintf(\"%lld\\n\",sum);*/\n\n\tfor(LL i=2,up=sqrt(sum);i<=up;++i) if(sum%i==0){\n\t\n\t\tif(Check(i)) bel[++tot]=i;\n\t\tif(Check(sum/i)) bel[++tot]=sum/i;\n\t}\n\tif(Check(sum)) bel[++tot]=sum;\n//\tprintf(\"%d\\n\",tot);\n\tif(sum==0 || sum==1){\n\t\tputs(\"-1\"); return 0;\n\t}\n\tif(!tot){\n\t\tputs(\"0\"); return 0;\n\t}\n\tll ans(inf);\n\tfor(LL k=1;k<=tot;++k){\n\t\tll x(bel[k]),nw(0),ret(0);\n\t\tLL l(1),pre(0);\n\t\tfor(LL i=1;i<=n;++i){\n\t\t    b[i]=a[i]%x;\n\t\t\tif(!b[i]) continue;\n\t\t\tif(nw){\n\t\t\t\tif(x-nw>b[i]){\n\t\t\t\t\tif((x-nw)*(i-pre)>nw*(i-pre)) ret+=nw*(i-pre),pre=i;\n\t\t\t\t\telse ret+=b[i]*(i-pre);\n\t\t\t\t\tnw+=b[i];\n\t\t\t\t}else{\n\t\t\t\t\tret+=(std::min(x-nw,nw))*(i-pre);\n\t\t\t\t\tnw=b[i]-(x-nw);\n\t\t\t\t\tif(nw) pre=i;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tnw=b[i];\n\t\t\tpre=i;\n\t\t}\n\t\tans=std::min(ans,ret);\n//\t\tprintf(\"(%lld,%lld)\\n\",x,ret);\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1574208526,
        "uid": 88804,
        "name": "y2823774827y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1254B2 \u3010Send Boxes to Alice (Hard Version)\u3011"
    }
]