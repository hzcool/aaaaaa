[
    {
        "content": "\u9898\u89e3\u7684 $LaTeX$ \u597d\u50cf\u70b8\u6389\u4e86\uff0c\u53ef\u4ee5\u8003\u8651\u70b9\u53f3\u4e0a\u89d2\u6216\u8005[\u6233\u8fd9\u91cc\u67e5\u770b](https://noone40404.github.io/2021/10/08/CF933D%20A%20Creative%20Cutout/)\u3002\n\n\u4e0a\u9762\u7684 $\\text{GreenDay}$ \u5b66\u957f\u5728\u6a21\u62df\u8d5b\u4e2d\u51fa\u4e86\u8fd9\u9053\u9898\uff0c\u5e76\u628a\u6570\u636e\u8303\u56f4\u52a0\u5230\u4e86 $n\\leq 10^{14}$ \u3002\n\n\u4e0e\u5b66\u957f\u7684\u5f0f\u5b50\u76f8\u4f3c\uff0c\u4ecd\u8bb0 $a=x^2+y^2$ \uff0c\u70b9 $(x,y)$ \u6700\u65e9\u88ab\u534a\u5f84\u4e3a $\\sqrt a$ \u7684\u7b2c $a$ \u4e2a\u5706\u5305\u542b\u3002\n\n\u679a\u4e3e\u6bcf\u4e2a\u70b9\u88ab\u5305\u542b\u5706\u7684\u7f16\u53f7 $\\times$ \u5728 $n$ \u4e2a\u5706\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u5373\u80fd\u63a8\u51fa\u4e0a\u9762\u7684\u5f0f\u5b50\u3002\n\n$$\\frac{1}{2}(1+n)(n+a)(n-a+1)-\\frac{1}{6}n(n+1)(2n+1)+\\frac{1}{6}a(a-1)(2a-1)$$\n\n\u4f46\u7531\u4e8e\u63d2\u503c\u6cd5\u5e38\u6570\u8fc7\u5927\uff0c\u8003\u8651\u7ee7\u7eed\u5c06\u5f0f\u5b50\u5316\u7b80\u3002\n\n\u5c06 $a=x^2+y^2$ \u4ee3\u5165\u5e76\u4ee5 $y$ \u4e3a\u4e3b\u5143\uff0c\u80fd\u5f97\u5230\uff1a\n\n$$\\begin{aligned}\n\u539f\u5f0f\n&=\\frac{1+n}{2}(x^2+y^2+n)(n-x^2-y^2+1) \\\\\n&\\qquad+\\frac{1}{6}n(n+1)(2n+1) \\\\\n&\\qquad+(\\frac{1}{6}x^4+\\frac{1}{6}x^2y^2+\\frac{1}{6}x^2y^2+\\frac{1}{6}y^4-\\frac{1}{6}x^2-\\frac{1}{6}y^2)\\times(2x^2-2y^2-1) \\\\\n&=\\frac{1}{3} y^6 \\\\\n&\\qquad+(x^2-1-\\frac{1}{2}n) y^4 \\\\\n&\\qquad+\\left(\\frac{1}{2}(1+n)(-2x^2+1)+x^4-x^2+\\frac{1}{6} \\right) y^2 \\\\\n&\\qquad+\\left(\\frac{1}{2}(1+n)(n+x^2)(n-xx^2+1)-\\frac{1}{6}(n)(n+1)(n+2)+\\frac{1}{6}x^2(x^2-1)(2x^2-1) \\right) \\\\\n\\end{aligned}$$\n\n\u8be5\u5f0f\u7684\u7ed3\u679c\u662f\u70b9 $(x,y)$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u4f46\u8fd8\u53ef\u4ee5\u66f4\u52a0\u7b80\u5316\uff1a\u5728 $O(\\sqrt n)$ \u7684\u65f6\u95f4\u5185\u679a\u4e3e\u6b63\u534a\u8f74\u4e0a\u7684\u6bcf\u4e2a $x$ \uff0c\u6709 $max_y=\\sqrt{n-x^2}$ \u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $x$ \uff0c\u9884\u5904\u7406\u6240\u6709\u7684 $y$ \u7684\u516d\u6b21\u65b9\uff0c\u56db\u6b21\u65b9\uff0c\u4e8c\u6b21\u65b9\u4e4b\u548c\uff0c$O(1)$ \u6c42\u6ee1\u8db3 $x^2+y^2\\leq n$ \u7684\u6240\u6709 $y$ \uff0c\u5373\uff0c\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684 $(x,*)$ \u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u548c\u3002\n\n![\u770b\u4e2a\u56fe\u7406\u89e3\u4e00\u4e0b](https://cdn.luogu.com.cn/upload/image_hosting/o3sz8u0e.png)\n\n\u4ee5 $x=1$ \u4e3a\u4f8b\uff0c\u7ea2\u7ebf\u90e8\u5206\u5c31\u662f\u6240\u6c42\u7684\u548c\u3002\n\n\u4e3a\u4e86\u8fd0\u7b97\u65b9\u4fbf\uff0c\u5b9e\u9645\u4e0a\u4ee3\u7801\u4e2d\u6c42\u7684\u662f\uff1a\n\n$$\\begin{aligned}\n&2\\times \\frac{1}{3} y^6 \\\\\n&+2\\times (x^2-1-\\frac{1}{2}n) y^4 \\\\\n&+2\\times \\left(\\frac{1}{2}(1+n)(-2x^2+1)+x^4-x^2+\\frac{1}{6} \\right) y^2 \\\\\n&+(2\\times max_y+1)\\times \\left(\\frac{1}{2}(1+n)(n+x^2)(n-xx^2+1)-\\frac{1}{6}(n)(n+1)(n+2)+\\frac{1}{6}x^2(x^2-1)(2x^2-1) \\right) \\\\\n\\end{aligned}$$\n\n\u4e5f\u5c31\u662f\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/jc9rqc98.png)\n\n$y$ \u7684\u90e8\u5206 $\\times 2$ \u662f\u4e3a\u4e86\u52a0\u4e0a\u8d1f\u534a\u8f74\u7684\u8d21\u732e\uff0c\u5e38\u6570\u9879 $\\times (2\\times max_y+1)$ \u4e2d\uff0c$+1$ \u662f\u7eff\u8272\u70b9\u7684\u90e8\u5206\uff0c\u5373\u5728 $x$ \u8f74\u4e0a\u65f6\u7684\u60c5\u51b5\u3002\n\n\u6700\u7ec8\u7edf\u8ba1\u7b54\u6848\u65f6\uff0c\u518d\u7528\uff1a\n\n\n```cpp\nans+=(!x) ? added : 2*added;\n```\n\n\u6765\u5904\u7406 $x$ \u7684\u6b63\u8d1f\u534a\u8f74\u60c5\u51b5\u4ee5\u8ba1\u7b97\u6574\u4e2a\u5706\u7684\u60c5\u51b5\u3002\n\n\u4ee3\u7801\u590d\u6742\u5ea6\u4e3a $O(\\sqrt{n})$ \uff0c\u5176\u74f6\u9888\u5728\u4e8e\u53d6\u6a21(\u786e\u4fe1)\uff0c\u82e5\u53d6\u6a21\u8fc7\u4e8e\u9891\u7e41\u5c31\u4f1a\u4ece $900ms$ \u6389\u5230 $4s$ \u3002\n\n~~\u7136\u540e\u5c31\u53ef\u4ee5\u8dd1\u5230cf\u7684rk1\u60f9\u3002~~\n\n```cpp\n#include <bits/stdc++.h>\n#define rei register int\n#define ll long long\nusing namespace std;\n\nconst int mod=1e9+7;\nconst int inv2=500000004,inv3=333333336,inv6=166666668;\nll n,mod_n,ans;\n\nint main(){\n\tscanf(\"%lld\",&n);\n\tmod_n=n%mod;\n\tfor(ll x=(ll) sqrt(n+0.1),i=1,sum2=0,sum4=0,sum6=0;~x;--x) {\n\t\tll t=sqrt(n-x*x),x2=x*x%mod;\n\t\tfor(;i<=t;++i){\n\t\t\tll pow_2=i*i%mod;\n\t\t\tll pow_4=pow_2*pow_2%mod;\n\t\t\tsum2=(sum2+pow_2)%mod;\n\t\t\tsum4=(sum4+pow_4)%mod;\n\t\t\tsum6=(sum6+pow_2*pow_4)%mod;\n\t\t}\n\t\tll added=((ll)2*inv3*sum6%mod\n                    +(2*x2-2-mod_n+2*mod)%mod *sum4%mod\n                    +( (1+mod_n)*((mod-2)*x%mod*x%mod+1)%mod + 2*x2*x2%mod-2*x2+inv3+2*mod )%mod *sum2%mod\n                    +   (inv2*(1+mod_n)%mod*(mod_n+x2)%mod*(mod_n-x2+mod+1)%mod\n                        -inv6*mod_n%mod*(mod_n+1)%mod*(2*mod_n+1)%mod\n                        +inv6*(x2-1)%mod*x2%mod*(2*x2-1)%mod\n                        +mod\n                        )%mod*(2*t+1)%mod\n                )%mod;\n        ans+=(!x) ? added : 2*added;\n\t}\n\tprintf(\"%lld\\n\",ans%mod);\n    getchar(),getchar();\n    return 0;\n}\n\n```",
        "postTime": 1633694666,
        "uid": 403166,
        "name": "noone___",
        "ccfLevel": 0,
        "title": "CF933D A Creative Cutout\u9898\u89e3"
    },
    {
        "content": "**\u9898\u610f**\n\n\u5b9a\u4e49$g(x,y)$\u8868\u793a\u6240\u6709\u5305\u542b\u70b9$(x,y)$\uff08\u542b\u5728\u5706\u4e0a\uff09\u7684\u5706\u7f16\u53f7\u4e4b\u548c\uff0c\n\n\u82e5\u6709\u7f16\u53f7\u4e3a$i(i\\le n)$,\u534a\u5f84\u4e3a$\\sqrt{i}$\uff0c\u5706\u5fc3\u4e3a\u539f\u70b9\u7684\u5706$n$\u4e2a\uff0c\u5219$f(i)=\\sum_{x,y}g(x,y)$,\u6c42$\\sum_{i=1}^nf(i) \\operatorname{mod} 10^9+7.$\n\n$n \\le 10^{12}$\n\n[\u70b9\u8fd9\u91cc\u770b\u9898](https://www.luogu.com.cn/problem/CF933D)\n\n**\u505a\u6cd5**\n\n\u8003\u8651\u6bcf\u4e2a\u70b9$P(x,y)$\u7684\u8d21\u732e\uff0c\u8bb0$a=x^2+y^2$\uff0c\u679a\u4e3e\u6bcf\u4e2a\u70b9\u88ab\u5305\u542b\u5706\u7684\u7f16\u53f7\u53ca\u5176\u5728\u7b54\u6848\u4e2d\u51fa\u73b0\u6b21\u6570\uff1a\n\n$$\n\\sum\\limits_{i=a}^ni(n-i+1)\n$$\n\n$$\n= (1+n)\\sum\\limits_{i=a}^ni -\\sum\\limits_{i=a}^ni^2\n$$\n\n$$\n=\\frac 1 2(1+n)(n+a)(n-a+1)-\\frac 1 6n(n+1)(2n+1) + \\frac 1 6(a-1)a(2a-1)\n$$\n\n\u6211\u4eec\u786e\u5b9a\u4e00\u4e2a$x$\uff0c\u5219\u679a\u4e3e$y$\u662f\u4e00\u4e2a\u533a\u95f4\u548c\u3002\u628aa\u56de\u4ee3\u5165\u539f\u5f0f\u5b50\uff0c\u53ef\u4ee5\u5f97\u5230\u5173\u4e8e$y$\u76846\u6b21\u591a\u9879\u5f0f\u7684\u4e00\u4e2a\u548c\u5f0f\u3002\u5404\u4f4d\u786c\u6838\u9009\u624b\u76f4\u63a5\u63a8\u5f0f\u5b50\u3002\u6211\u6bd4\u8f83\u83dc\uff0c\u6240\u4ee5\u9009\u62e9**\u62c9\u683c\u6717\u65e5\u63d2\u503c**\u30026\u6b21\u591a\u9879\u5f0f\u5957\u4e0a\u4e00\u4e2a$\\sum$\u540e\u4e3a7\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u63d28\u4e2a\u503c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n$\\mathcal O(n^{0.5})$\n\n\n**code**\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long int64;\nint64 n , nn , inv2 , inv3 , inv6;\nint mod = 1e9 + 7, ans;\n\nint64 calc(int64 a) {\n    int64 x = (1+nn)*(nn+a)%mod*(nn-a+1)%mod*inv2%mod-nn*(nn+1)%mod*(2*nn+1)%mod*inv6%mod+(a-1)*a%mod*(2*a-1)%mod*inv6%mod;\n    return (x%mod+mod)%mod;\n}\ninline int qpow(int x , int y = mod - 2) {\n\tint res = 1;\n\tfor(; y ; y >>= 1 , x = 1ll * x * x % mod)\n\t\tif(y & 1) res = 1ll * res * x % mod;\n\treturn res; \n} \n\nint64 val[10] , mul[10] , imul[10] , pre[10] , suf[10];\nvoid init() {\n    nn = n % mod;\n    for(int i = 1 ; i <= 8 ; ++i) {\n        mul[i] = qpow(i);\n        imul[i] = qpow(mod - i);\n    }\n    inv2 = mul[2] , inv3 = mul[3] , inv6 = mul[6];\n    for(int i = 2 ; i <= 8 ; ++i) {\n        mul[i] = mul[i] * mul[i - 1] % mod;\n        imul[i] = imul[i] * imul[i - 1] % mod;\n    }\n}\n\nint64 lglr(int64 y) {\n    if(y <= 8) return val[y];\n    for(int i = 1 ; i <= 8 ; ++i) pre[i] = suf[i] = y - i;\n    for(int i = 2 ; i <= 8 ; ++i) pre[i] = pre[i - 1] * pre[i] % mod;\n    for(int i = 7 ; i >= 1 ; --i) suf[i] = suf[i + 1] * suf[i] % mod;\n\n    int64 ans = 0;\n    for(int i = 1 ; i <= 8 ; ++i) {\n        int64 b = val[i];\n        if(i != 1) b = b * mul[i - 1] % mod * pre[i - 1] % mod;\n        if(i != 8) b = b * imul[8 - i] % mod * suf[i + 1] % mod;\n        ans = (ans + b) % mod;\n    }\n    return ans;\n}\n\nint main() {\n    cin >> n;\n    init();\n\n    for(int64 x = 0 ; x*x <= n ; ++x) {\n        int64 t = sqrt(n - x*x) , add = calc(x*x%mod);\n        \n        for(int i = 1 ; i <= 8 ; ++i)\n            val[i] = (val[i - 1] + calc((x*x + i*i)%mod)) % mod;\n        add = (add + 2*lglr(t)) % mod;\n\n        if(x == 0) ans = (ans + add) % mod;\n        else ans = (ans + 2*add) % mod;\n    }\n\n    cout << ans << endl;\n}\n```",
        "postTime": 1587460156,
        "uid": 138511,
        "name": "GreenDay",
        "ccfLevel": 8,
        "title": "CF933D A Creative Cutout \u9898\u89e3"
    }
]