[
    {
        "content": "n \u65b9 \u8fc7 \u5341 \u4e07 \u66b4 \u529b \u8e29 \u6807 \u7b97\n\n\u53c8\u53cc\u53d2\u53d5\u662f $O(n^2/\\omega)$\u3002\n\n\u9898\u89e3\u6bd2\u7624\u7136\u540e\u6211\u592a\u83dc\u4e86\u4e0d\u4f1a\u3002\n\n\u524d\u7f6e\uff1a\n\n - Montgomery Reduction\n - AVX2 \u6307\u4ee4\u96c6\n\n---\n\n\u89c2\u5bdf\u5230\u5f53\u8f93\u5165\u662f $n$ \u8f93\u51fa\u7efc\u5408\u662f $n!\\cdot n$\u3002\u8003\u8651\u6784\u9020\u4e00\u4e2a\u597d\u5e8f\u5217\u548c\u6392\u5217\u7684\u5bf9\u5e94\u3002\n\n\u5bf9\u4efb\u4f55\u597d\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5b50\u8f6c\u6362\u6210\u6392\u5217\uff1a\u5148\u5012\u7740\u5217\u51fa $1$ \u7684\u51fa\u73b0\u4f4d\u7f6e\uff0c\u7136\u540e\u5012\u7740\u5217\u51fa $2$ \u7684\u51fa\u73b0\u4f4d\u7f6e\uff0c\u5982\u6b64\u7c7b\u63a8\u3002\u8fd9\u6837\u4ea7\u751f\u7684\u4e00\u4e2a\u6392\u5217\u4e5f\u4f1a\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a\u597d\u5e8f\u5217\uff1a\u5f53 $p_i<p_{i+1}$\uff0c\u597d\u5e8f\u5217\u91cc $p_{i+1}$ \u4f4d\u7f6e\u7684\u6570\u4f1a\u662f $p_i$ \u4f4d\u7f6e\u7684\u6570\u52a0 $1$\u3002\n\n\u8003\u8651\u7528\u8fd9\u4e2a\u5b9a\u4e49\u8ba1\u7b97\u7b54\u6848\u3002\u5bf9\u6392\u5217\u4e2d\u67d0\u4e00\u4e2a\u4f4d\u7f6e $i$\uff0c\u5728\u597d\u5e8f\u5217\u4e0a\u7b2c $p_i$ \u4e2a\u5143\u7d20\u5c31\u662f $p_1,p_2,p_3,\\dots,p_i$ \u91cc\u9762\u6709\u591a\u5c11\u4e2a\u76f8\u90bb\u987a\u5e8f\u5bf9\u3002\u8fd9\u91cc\u5047\u8bbe\u597d\u5e8f\u5217\u5143\u7d20\u662f\u4ece $0$ \u5f00\u59cb\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u4f4d\u7f6e $i$ \u5bf9 $j$ \u503c\u7b54\u6848\u7684\u8d21\u732e\uff1b\u6392\u5217\u7684\u524d $i$ \u4f4d\u6709 $\\left\\langle\\begin{matrix}i\\\\j\\end{matrix}\\right\\rangle$ \u4e2a\u6392\u6cd5\uff0c\u540e $n-i$ \u4f4d\u6709 $P(n,n-i)$ \u4e2a\u6392\u6cd5\uff0c\u4e8e\u662f\u5bf9 $j$ \u4f4d\u7f6e\u7684\u7b54\u6848\u5c31\u662f\n\n$$ans_j=n!\\sum_{i=1}^n\\frac{1}{i!}\\left\\langle\\begin{matrix}i\\\\j\\end{matrix}\\right\\rangle$$\n\n\u5c0f\u7684\u65f6\u5019\u66b4\u529b\u7b97\u3002\n\n\u7b80\u5316\u7248\u4ee3\u7801\uff1a\n\n```cpp\n// writer: w33z8kqrqk8zzzx33\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define iter(i, a, b) for(int i=(a); i<(b); i++)\n#define rep(i, a) iter(i, 0, a)\n#define rep1(i, a) iter(i, 1, (a)+1)\n#define log(a) cerr<<\"\\033[32m[DEBUG] \"<<#a<<'='<<(a)<<\" @ line \"<<__LINE__<<\"\\033[0m\"<<endl\n#define all(a) a.begin(), a.end()\n#define fi first\n#define se second\n#define pb push_back\n#define mp make_pair\n\nusing ll=long long;\nusing pii=pair<int, int>;\n//#define int ll\nconst int MOD = 998244353;\n\nint _dp[100005], *dp, ans[100005];\nint fac[100005], inv[100005], ifa[100005];\n__attribute__((always_inline)) inline void redc(int& x) { x += (x >> 31) & MOD; }\n\nsigned main() {\n\tios_base::sync_with_stdio(false); cin.tie(0);\n\tdp = &_dp[1];\n\tint n; cin >> n;\n\tfac[0] = fac[1] = inv[0] = inv[1] = ifa[0] = ifa[1] = 1;\n\titer(i, 2, n+1) {\n\t\tfac[i] = 1ll * fac[i-1] * i % MOD;\n\t\tinv[i]=1ll*(MOD-MOD/i)*inv[MOD%i]%MOD;\n\t\tifa[i] = 1ll * ifa[i-1] * inv[i] % MOD;\n\t}\n\tdp[0] = 1;\n\trep1(j, n) {\n\t\tif(j != 1) {\n\t\t\tint th=j/2;\n\t\t\tfor(int i=th; i>=0; i--) dp[i] = (1ll*(i+1)*dp[i]+1ll*(j-i)*dp[i-1]) % MOD;\n\t\t\tif(!(j%2)) dp[th]=dp[th-1];\n\t\t}\n\t\tint q = ifa[j];\n\t\tfor(int i=j/2-1; i>=0; i--) {\n\t\t\tint t = (1ll*dp[i]*q)%MOD-MOD;\n\t\t\tredc(ans[i] += t);\n\t\t\tredc(ans[j-1-i] += t);\n\t\t}\n\t\tif(j%2) ans[j/2] = (ans[j/2] + 1ll*dp[j/2]*q)%MOD;\n\t}\n\trep(i, n) cout << (1ll*ans[i]*fac[n])%MOD << \" \\n\"[i==n-1];\n}\n\n```\n\n---\n\n\u7136\u540e\u5c31\u6109\u5feb\u7684\u5361\u5e38\u5566\u3002\n\nMontgomery Reduction \u4ee3\u7801\u5f88\u7b80\u6d01\uff1a\n\n```cpp\ninline u32 redc(u64 a) {\n\tu32 b = (u32)a * 998244351;\n\tu64 c = a + (u64)b * 998244353;\n\treturn (u32)(c >> 32);\n}\n```\n\n\u8003\u8651\u5982\u4f55\u628a\u8fd9\u4e2a\u7ffb\u8bd1\u6210 AVX2 \u6307\u4ee4\u96c6\u6307\u4ee4\u3002\n\n\u7b2c\u4e8c\u884c\u53d6 $a$ \u7684\u5c0f\u534a\u5e76\u4e14\u4e58 $998244351$\u3002  \n\u7b2c\u4e09\u884c\u628a\u7b2c\u4e8c\u884c\u5f97\u5230\u7684\u7b54\u6848\u7684\u5c0f\u534a\u6210\u4e0a $998244353$ \u5e76\u4e14\u52a0\u4e0a $a$\u3002  \n\u7b2c\u56db\u884c\u8fd4\u56de\u7b2c\u4e09\u884c\u5f97\u5230\u7684\u5927\u534a\u3002\n\n\u201c\u5c0f\u534a\u4e58\u201d\u5176\u5b9e\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u7684\uff0c\u76f4\u63a5\u662f `_mm256_mul_epu32`\u3002  \n\u52a0\u4e5f\u5c31\u662f\u901a\u5e38\u52a0\u6cd5\u4e86\u3002  \n\u53d6\u5927\u534a\u628a\u6240\u6709\u6570\u53f3\u79fb 32 \u4f4d\u3002\n\n\u5f97\u5230\uff1a\n\n```cpp\n__attribute__((always_inline)) __m256i redc(__m256i a) {\n\t__m256i b = _mm256_mul_epu32(a, _mm256_set1_epi32(998244351));\n\t__m256i c = _mm256_add_epi64(a, _mm256_mul_epu32(b, _mm256_set1_epi32(998244353)));\n\treturn _mm256_srli_epi64(c, 32);\n}\n```\n\n\u8003\u8651\u6734\u7d20 dp \u7b2c\u4e00\u4e2a\u90e8\u5206\uff1a\n\n```cpp\n        if(j != 1) {\n            int th=j/2;\n            for(int i=th; i>=0; i--) dp[i] = (1ll*(i+1)*dp[i]+1ll*(j-i)*dp[i-1]) % MOD;\n            if(!(j%2)) dp[th]=dp[th-1];\n        }\n```\n\n\u6700\u63d0\u51fa\u6765\u7684\u90e8\u5206\u662f\u6211\u4eec\u9700\u8981\u5904\u7406 $0$ \u5230 $n+1$ \u6240\u6709\u6570\u7684 Montgomery \u5f62\u5f0f\uff0c\u7136\u540e $j-i$ \u9700\u8981\u5012\u7740\u67e5\u627e\u3002\u8fd9\u4e2a\u5f88\u7b80\u5355\u6765\u7ed5\uff1a\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u53cd\u8f6c\u8fc7\u7684\u6570\u7ec4\u3002\n\n\u6ce8\u610f\u8fd9\u91cc\u5fc5\u987b\u7528\u4ea4\u6362\u6570\u7ec4\uff0c\u5426\u5219\u4e0d\u53ef\u80fd\u591a\u7ebf\u5316\u3002\n\n\u8003\u8651\u6734\u7d20 dp \u7b2c\u4e8c\u4e2a\u90e8\u5206\uff1a\n\n```cpp\n        int q = ifa[j];\n        for(int i=j/2-1; i>=0; i--) {\n            int t = (1ll*dp[i]*q)%MOD;\n            ans[i] += t\uff1b\n            ans[j-1-i] += t;\n        }\n        if(j%2) ans[j/2] = (ans[j/2] + 1ll*dp[j/2]*q)%MOD;\n```\n\n\u552f\u4e00\u96be\u641e\u7684\u90e8\u5206\u5c31\u662f `ans[j-1-i] += t;` \u8fd9\u4e2a\u53ef\u4ee5\u6309\u7167\u4e0a\u9762\u53cd\u8f6c\u5957\u8def\u89e3\u51b3\uff0c\u6700\u7ec8\u8f93\u51fa\u65f6\u628a\u53cd\u8f6c\u548c\u6ca1\u53cd\u8f6c\u90e8\u5206\u90fd\u7b97\u4e0a\u3002\n\n\u6700\u7ec8\u4ee3\u7801\uff1a\n\n```cpp\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC target(\"avx2\")\n// writer: w33z8kqrqk8zzzx33\n#include <bits/stdc++.h>\n#include <immintrin.h>\nusing namespace std;\n\n#define iter(i, a, b) for(int i=(a); i<(b); i++)\n#define rep(i, a) iter(i, 0, a)\n#define rep1(i, a) iter(i, 1, (a)+1)\n#define log(a) cerr<<\"\\033[32m[DEBUG] \"<<#a<<'='<<(a)<<\" @ line \"<<__LINE__<<\"\\033[0m\"<<endl\n#define all(a) a.begin(), a.end()\n#define fi first\n#define se second\n#define pb push_back\n#define mp make_pair\n\nusing ll=long long;\nusing pii=pair<int, int>;\n//#define int ll\nconst int MOD = 998244353;\n\ntypedef uint32_t u32;\ntypedef uint64_t u64;\n\nu64 dp1[100005], dp2[100005], ans[100005], rans[100005];\nu64 fac[100005], inv[100005], ifa[100005], tp[100005], rtp[100005];\n\nu32 to(u32 a) {\n\treturn (u32)((((u64) a) << 32) % 998244353);\n}\n\ninline u32 redc(u64 a) {\n\tu32 b = (u32)a * 998244351;\n\tu64 c = a + (u64)b * 998244353;\n\treturn (u32)(c >> 32);\n}\n\n#define Load(ptr) (_mm256_loadu_si256((__m256i*)(ptr)))\n#define Store(ptr, __A) _mm256_storeu_si256((__m256i*)(ptr), __A)\n\n__attribute__((always_inline)) __m256i redc(__m256i a) {\n\t__m256i b = _mm256_mul_epu32(a, _mm256_set1_epi32(998244351));\n\t__m256i c = _mm256_add_epi64(a, _mm256_mul_epu32(b, _mm256_set1_epi32(998244353)));\n\treturn _mm256_srli_epi64(c, 32);\n}\n\nsigned main() {\n\tios_base::sync_with_stdio(false); cin.tie(0);\n\t\n\tint n; cin >> n;\n\tfac[0] = fac[1] = inv[0] = inv[1] = ifa[0] = ifa[1] = 1;\n\titer(i, 2, n+2) {\n\t\tfac[i] = 1ll * fac[i-1] * i % MOD;\n\t\tinv[i]=1ll*(MOD-MOD/i)*inv[MOD%i]%MOD;\n\t\tifa[i] = 1ll * ifa[i-1] * inv[i] % MOD;\n\t}\n\trep(i, n+2) {\n\t\ttp[i] = to(i);\n\t\trtp[n+2-i] = tp[i];\n\t}\n\tdp1[0] = tp[1];\n\tdp2[0] = tp[1];\n\tint cur = 1;\n\trep1(j, n) {\n\t\tif(j != 1) {\n\t\t\tint th=j/2;\n\t\t\tif(cur == 1) {\n\t\t\t\tint i=1,rv=n+2-j+1;\n\t\t\t\tfor(; i+4<=th; i+=4, rv+=4) {\n\t\t\t\t\tStore(&dp2[i], \n\t\t\t\t\t\tredc(_mm256_add_epi64(\n\t\t\t\t\t\t\t_mm256_mul_epu32(Load(&tp[i+1]),Load(&dp1[i])),\n\t\t\t\t\t\t\t_mm256_mul_epu32(Load(&rtp[rv]),Load(&dp1[i-1]))\n\t\t\t\t\t\t))\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tfor(; i<=th; i++)\n\t\t\t\t\tdp2[i] = redc(1ull*tp[i+1]*dp1[i]+1ll*tp[j-i]*dp1[i-1]);\n\t\t\t\tdp2[th]=dp2[th-1];\n\t\t\t\tcur = 2;\n\t\t\t} else {\n\t\t\t\tint i=1,rv=n+2-j+1;\n\t\t\t\tfor(; i+4<=th; i+=4, rv+=4) {\n\t\t\t\t\tStore(&dp1[i], \n\t\t\t\t\t\tredc(_mm256_add_epi64(\n\t\t\t\t\t\t\t_mm256_mul_epu32(Load(&tp[i+1]),Load(&dp2[i])),\n\t\t\t\t\t\t\t_mm256_mul_epu32(Load(&rtp[rv]),Load(&dp2[i-1]))\n\t\t\t\t\t\t))\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tfor(; i<=th; i++)\n\t\t\t\t\tdp1[i] = redc(1ull*tp[i+1]*dp2[i]+1ll*tp[j-i]*dp2[i-1]);\n\t\t\t\tcur = 1;\n\t\t\t}\n\t\t}\n\t\tu32 q = to(ifa[j]);\n\t\t__m256i Q = _mm256_set1_epi32(q);\n\t\tif(cur == 1) {\n\t\t\tint i=0, rv=n-j+1;\n\t\t\tfor(; i+4<=j/2-1; i+=4, rv+=4) {\n\t\t\t\t__m256i t = redc(_mm256_mul_epu32(Load(&dp1[i]), Q));\n\t\t\t\tStore(&ans[i], _mm256_add_epi64(Load(&ans[i]), t));\n\t\t\t\tStore(&rans[rv], _mm256_add_epi64(Load(&rans[rv]), t));\n\t\t\t}\n\t\t\tfor(; i<=j/2-1; i++) {\n\t\t\t\tu32 t = redc(1ull*dp1[i]*q);\n\t\t\t\tans[i] += t;\n\t\t\t\tans[j-1-i] += t;\n\t\t\t}\n\t\t\tans[j/2] += redc(1ull*dp1[j/2]*q);\n\t\t\tans[j/2] -= (ans[j/2] < MOD ? 0 : MOD);\n\t\t} else {\n\t\t\tint i=0, rv=n-j+1;\n\t\t\tfor(; i+4<=j/2-1; i+=4, rv+=4) {\n\t\t\t\t__m256i t = redc(_mm256_mul_epu32(Load(&dp2[i]), Q));\n\t\t\t\tStore(&ans[i], _mm256_add_epi64(Load(&ans[i]), t));\n\t\t\t\tStore(&rans[rv], _mm256_add_epi64(Load(&rans[rv]), t));\n\t\t\t}\n\t\t\tfor(; i<=j/2-1; i++) {\n\t\t\t\tu32 t = redc(1ull*dp2[i]*q);\n\t\t\t\tans[i] += t;\n\t\t\t\tans[j-1-i] += t;\n\t\t\t}\n\t\t}\n\t}\n\trep(i, n) cout << redc(redc(1ull * ((ans[i]+rans[n-i])%MOD) * to(fac[n]))) << \" \\n\"[i==n-1];\n}\n```",
        "postTime": 1601297581,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1349F2 \u3010Slime and Sequences (Hard Version)\u3011"
    },
    {
        "content": "\u5b98\u65b9\u9898\u89e3\u6bd4\u8f83\u7b80\u7565,\u8fd9\u91cc\u6211\u6765\u8865\u5145\u4e00\u4e2a\u8be6\u7ec6\u4e00\u70b9\u7684\u3002\n\n\u6b64\u9898 : \u56fd\u9645\u8ba1\u6570\u6c34\u5e73.jpg\n\n**\u9898\u610f** : \u5b9a\u4e49\u597d\u5e8f\u5217\u4e3a : \u90fd\u662f\u6b63\u6574\u6570 , \u5982\u679c\u67d0\u4e2a\u6570 $k$ \u51fa\u73b0\u8fc7 , \u90a3\u4e48\u4e00\u5b9a\u6709 $k-1$ \u51fa\u73b0\u5728\u5176\u524d\u9762\u3002\n\n\u73b0\u5728\u5bf9 $k=1...n$ ,\u5206\u522b\u7edf\u8ba1\u5176\u5728\u957f\u5ea6\u4e3a $n$ \u7684\u6240\u6709\u597d\u5e8f\u5217\u4e2d,\u51fa\u73b0\u6b21\u6570\u7684\u548c\u3002\n\n- `Easy` $\\ n\\leq 5000$ , \u65f6\u9650$\\texttt{2s}$\n\n- `Hard` $\\ n\\leq 10^5$ , \u65f6\u9650$\\texttt{3s}$\n\n------------\n\n\u4e2d \u56fd \u7279 \u8272\n\n\u8ba1\u6570\u5de5\u4e1a\u603b\u4ea7\u503c\u8dc3\u5c45\u4e16\u754c\u7b2c\u4e00!\n\n\u8fd9\u4f4d\u8001\u54e5\u60a8\u5148\u522b\u8d70,\u80fd\u4e0d\u80fd\u544a\u8bc9\u6211 GF \u662f\u4ec0\u4e48\u610f\u601d, \u62c9\u683c\u6717\u65e5\u53cd\u6f14\u53c8\u662f\u5565?\n\n## 0.\u524d\u7f6e\u829d\u58eb\n\n- \u5206\u5f0f\u57df\n\n- (\u6269\u5c55)\u62c9\u683c\u6717\u65e5\u53cd\u6f14\n\n- \u6b27\u62c9\u6570\n\n- \u4e8c\u5143 `GF`\n\n## 1.\u8f6c\u5316\n\n\u8fd9\u4e2a\u597d\u5e8f\u5217\u7684\u9650\u5236\u5341\u5206\u523b\u610f,\u9996\u5148\u8003\u8651\u8f6c\u5316\u4e00\u4e0b\u3002\n\n\u4e8b\u5b9e\u4e0a,\u53ef\u4ee5\u5efa\u7acb\u8d77\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\u548c\u957f\u5ea6\u4e3a $n$ \u7684\u597d\u5e8f\u5217\u4e4b\u95f4\u7684**\u5bf9\u5e94\u5173\u7cfb**\u3002\n\n\u5728\u6392\u5217 $p$ \u76f8\u90bb\u6570\u4e4b\u95f4\u586b\u5199\u4e0d\u7b49\u53f7,\u5e8f\u5217\u4e2d $a_{p_i}$ \u7684\u503c\u5c31\u662f $p_{1...i}$ \u4e4b\u95f4\u7684\u5c0f\u4e8e\u53f7\u4e2a\u6570$+1$\u3002\n\n- \u8bc1\u660e\u5176\u6ee1\u8db3\u597d\u5e8f\u5217\u7684\u6761\u4ef6 : \n\n  \u8003\u8651\u4e00\u4e2a $<$ ,\u4ee5\u6b64\u4e3a\u5206\u754c\u7ebf,\u524d\u9762\u4e3a $p_{i-1}$ ,\u540e\u9762\u4e3a $p_{i}$ \u3002\u6709 $a_{p_{i-1}}+1=a_{p_i}$ ,\u56e0\u4e3a\u4e2d\u95f4\u9694\u4e86\u4e00\u4e2a\u5c0f\u4e8e\u53f7\u3002\n  \n  \u540c\u65f6\u53c8\u6709 $p_{i-1}<p_i$(\u4f4d\u7f6e) ,\u4e5f\u662f\u56e0\u4e3a\u5c0f\u4e8e\u53f7\u3002\u5b9e\u9645\u4e0a\u5c0f\u4e8e\u53f7\u5c31\u662f\u628a\u4e24\u4e2a\u9650\u5236\u7ed3\u5408\u5728\u4e86\u4e00\u8d77\u3002\n  \n\u901a\u8fc7\u8fd9\u4e2a\u6784\u9020,\u4e5f\u5bb9\u6613\u4ece\u597d\u5e8f\u5217\u8fd8\u539f\u6392\u5217\u3002\u5177\u4f53\u8bc1\u660e\u7565\u3002\n\n~~\u5b66\u957f\u8bf4\u8fd9\u53ef\u4ee5\u5165\u9009\u201c\u5341\u5927\u70ab\u9177\u6620\u5c04\u201d~~\n\n\u4ee5\u672c\u4eba\u7684\u61a8\u61a8\u6c34\u5e73,\u8003\u573a\u4e0a\u6839\u672c\u60f3\u4e0d\u51fa\u6765\u8fd9\u79cd\u7cbe\u5999\u7684\u6784\u9020\u3002\u751a\u81f3\u8fd8\u6839\u672c\u6ca1\u53bb\u60f3\u7b49\u4ef7\u8f6c\u5316,\u76f4\u63a5\u5bf9\u7740\u539f\u95ee\u9898\u5206\u6790,\u8fde\u6b63\u89e3\u7684\u8fb9\u90fd\u6ca1\u6478\u7740,\u76f4\u63a5\u88ab\u62d2\u4e4b\u95e8\u5916\u3002\u8fd9\u53ef\u80fd\u4e5f\u5c31\u662f\u6211\u6b63\u5f0f\u6bd4\u8d5b\u4e2d\u6ca1\u5207\u8fc7\u4efb\u4f55\u4e00\u9053\u8ba1\u6570\u5de5\u4e1a\u7684\u539f\u56e0\u5427\u2026\u2026\n\n\u76ee\u524d\u5927\u6982\u60f3\u5230\u4e86\u51e0\u70b9\u3002\n\n\u9996\u5148\u5982\u679c\u539f\u95ee\u9898\u590d\u6742(\u6761\u4ef6\u4fe1\u606f\u91cf\u592a\u5927),\u611f\u89c9\u4e0d\u53ef\u505a,\u90a3\u4e48\u5927\u6982\u7387\u662f\u51fa\u9898\u4eba\u505a\u4e86\u795e\u4ed9\u8f6c\u5316,\u8981\u53bb\u5bfb\u627e\u6784\u9020\u6216\u8005\u5145\u8981\u6761\u4ef6\u3002\n\n\u5176\u6b21,\u53ef\u4ee5\u7edf\u8ba1\u9700\u8981\u8ba1\u6570\u7684\u4e1c\u897f\u7684\u603b\u6570,\u6bd4\u5982\u8fd9\u4e2a\u9898,\u5982\u679c\u53d1\u73b0\u603b\u6570\u662f $n!$ ,\u5c31\u66f4\u5bb9\u6613\u60f3\u5230\u6784\u9020\u6210\u6392\u5217\u3002\n\n## 2.\u521d\u6b65\u5206\u6790\n\n\u73b0\u5728\u5c31\u662f\u8981\u5bf9\u6392\u5217\u7edf\u8ba1 $<$ \u7684\u4e2a\u6570\u3002\u4e0d\u96be\u53d1\u73b0\u5176\u5b9e\u5c31\u662f [P5825 \u6392\u5217\u8ba1\u6570](https://www.luogu.com.cn/problem/P5825) \u4e2d\u7684**\u6b27\u62c9\u6570**\u3002\n\n\u8bbe $\\left\\langle\\begin{matrix}n \\\\ k\\end{matrix}\\right\\rangle$ \u4e3a : \u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217,\u5c0f\u4e8e\u53f7\u7684\u4e2a\u6570\u4e3a $k$ \u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u5206\u522b\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u3002\n\n$${\\rm Ans}[k]=\\sum\\limits_{i=\\max(k,1)}^n\\left\\langle\\begin{matrix}i \\\\ k\\end{matrix}\\right\\rangle\\dbinom{n}{i}(n-i)!$$\n\n\u610f\u601d\u662f : \u679a\u4e3e\u5728\u597d\u5e8f\u5217\u4e2d\u4ea7\u751f $k$ \u7684\u4f4d\u7f6e\u3002\u6b64\u65f6\u6574\u4e2a\u6392\u5217\u7684\u65b9\u6848\u6570,\u5c31\u662f\u5bf9\u5c40\u90e8\u6392\u5217\u8fdb\u884c\u6807\u53f7\u5206\u914d\u3002\u540e\u9762\u7684\u90e8\u5206\u6ca1\u6709\u987a\u5e8f\u9650\u5236,\u8fd8\u80fd\u968f\u610f\u6392\u5217\u3002\n\n\u5176\u5b9e\u53ea\u6709 ${\\rm Ans}[0]$ \u4f1a\u88ab $\\max(k,1)$ \u5f71\u54cd,\u6211\u4eec\u53ef\u4ee5\u7279\u5224,\u4e0b\u754c\u5c31\u4f1a\u53d8\u5f97\u66f4\u6f02\u4eae\u3002\n\n\u5b58\u5728\u4e00\u4e2a$O(n^2)$\u9012\u63a8\u6b27\u62c9\u6570\u7684\u505a\u6cd5,\u7136\u540e\u66b4\u529b\u8ba1\u7b97\u4e0a\u5f0f,\u5373\u53ef\u901a\u8fc7`Easy`\u7248\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define MaxN 5050\n#define ll long long\nusing namespace std;\nconst int mod=998244353;\nll powM(ll a,int t=mod-2){\n  ll ret=1;\n  while(t){\n    if (t&1)ret=ret*a%mod;\n    a=a*a%mod;t>>=1;\n  }return ret;\n}\nll fac[MaxN],ifac[MaxN],s[MaxN],s2[MaxN],ans[MaxN];\nint n; \nint main()\n{\n  scanf(\"%d\",&n);\n  fac[0]=1;\n  for (int i=1;i<=n;i++)\n    fac[i]=fac[i-1]*i%mod;\n  ifac[n]=powM(fac[n]);\n  for (int i=n;i;i--)\n    ifac[i-1]=ifac[i]*i%mod;\n  s2[0]=1;\n  for (int i=1;i<=n;i++){\n    s[0]=1;ans[0]=(ans[0]+ifac[i])%mod;\n    for (int j=1;j<=i;j++){\n      s[j]=(s2[j]*(j+1)+s2[j-1]*(i-j))%mod;\n      ans[j]=(ans[j]+s[j]*ifac[i])%mod;\n    }for (int j=0;j<=i;j++)s2[j]=s[j];\n  }for (int i=0;i<n;i++)\n    printf(\"%lld \",ans[i]*fac[n]%mod);\n  return 0;\n}\n```\n\n## 3.\u52a0\u901f\u8ba1\u7b97\n\n\u8fd9\u4e2a\u5f0f\u5b50\u6d89\u53ca\u5230\u4e86$O(n^2)$\u4e2a\u7684\u5927\u91cf\u6b27\u62c9\u6570,\u663e\u7136\u5206\u79bb\u8003\u8651\u662f\u4e0d\u884c\u7684\u3002\u6211\u4eec\u9700\u8981\u628a \u201c\u9ed1\u76d2\u201d \u6b27\u62c9\u6570\u6362\u6210\u66f4\u6613\u4e8e\u6279\u91cf\u5206\u6790\u7684\u5f62\u5f0f\u3002\n\n\u5148\u8bbe $\\left|\\begin{matrix}n \\\\ k\\end{matrix}\\right|$ \u4e3a : \u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217,\u94a6\u5b9a $k$ \u4e2a\u5c0f\u4e8e\u53f7,\u5176\u4f59\u968f\u610f\u7684\u65b9\u6848\u6570(\u53ef\u80fd\u91cd\u590d\u8ba1\u6570)\u3002\n\n\u90a3\u4e48,\u6839\u636e**\u4e8c\u9879\u5f0f\u53cd\u6f14**,\u975e\u5e38\u7ecf\u5178\u5730\u6709 \n\n$$\\left|\\begin{matrix}n \\\\ k\\end{matrix}\\right|=\\sum\\limits_{i=k}^n\\dbinom{i}{k}\\left\\langle\\begin{matrix}n \\\\ i\\end{matrix}\\right\\rangle\\quad\\Longrightarrow\\quad \\left\\langle\\begin{matrix}n \\\\ k\\end{matrix}\\right\\rangle=\\sum\\limits_{i=k}^n\\dbinom{i}{k}(-1)^{i-k}\\left|\\begin{matrix}n \\\\ i\\end{matrix}\\right|$$\n\n\u6211\u4eec\u8003\u8651 $\\left|\\begin{matrix}n \\\\ k\\end{matrix}\\right|$ \u5982\u4f55\u8ba1\u7b97,\u6ce8\u610f\u5230\u4e00\u4e32**\u8fde\u7eed**\u7684 $<$ \u53ef\u4ee5\u89c6\u4f5c\u4e00\u5757,\u7136\u540e\u5757\u4e2d\u653e\u7f6e\u6570\u7684\u987a\u5e8f\u5c31\u662f\u56fa\u5b9a\u7684\u3002\n\n\u8003\u8651\u5355\u4e2a\u5757\u7684`EGF`,\u4e3a $\\{0,1,1,1,\\dots\\}\\longrightarrow e^x-1$ (\u4e0d\u8003\u8651\u7a7a\u96c6)\n\n\u5982\u679c\u6070\u597d\u9700\u8981 $k$ \u4e2a $<$ ,\u5219\u6709 $n-k$ \u4e2a\u5757\u3002\n\n\u8fd9\u662f\u4e2a**\u6709\u5e8f\u7ec4\u5408\u5e76\u5206\u914d\u6807\u53f7**,\u80fd\u5f97\u5230 $\\left|\\begin{matrix}n \\\\ k\\end{matrix}\\right|=n![x^n](e^x-1)^{n-k}$\n\n\u5219 $\\left\\langle\\begin{matrix}n \\\\ k\\end{matrix}\\right\\rangle=n!\\sum\\limits_{i=k}^n\\dbinom{i}{k}(-1)^{i-k}[x^n](e^x-1)^{n-i}$\n\n\u4ee3\u5165`Easy`\u7684\u5f0f\u5b50\u4e2d,\u5f97\u5230\n\n$${\\rm Ans}[k]=\\sum\\limits_{i=k}^n\\dbinom{n}{i}(n-i)!i!\\sum\\limits_{j=k}^i\\dbinom{j}{k}(-1)^{j-k}[x^i](e^x-1)^{i-j}$$\n\n$$=n!\\sum\\limits_{i=k}^n\\sum\\limits_{j=k}^i\\dbinom{j}{k}(-1)^{j-k}[x^i](e^x-1)^{i-j}$$\n\n$$=\\dfrac{n!}{k!}\\sum\\limits_{j=k}^n\\dfrac{(-1)^{j-k}j!}{(j-k)!}\\sum\\limits_{i=j}^n[x^i](e^x-1)^{i-j}$$\n\n\u8bbe$S[k]=\\sum\\limits_{i=k}^n[x^i](e^x-1)^{i-k}$\n\n$$=\\dfrac{n!}{k!}\\sum\\limits_{j=k}^n\\dfrac{(-1)^{j-k}}{(j-k)!}S[j]j!$$\n\n\u5f97\u77e5 $S[0...k]$ \u4e4b\u540e\u663e\u7136\u53ef\u4ee5**\u5dee\u5377\u79ef**\u8ba1\u7b97\u3002\n\n- \u89c2\u5bdf $S[k]=\\sum\\limits_{i=k}^n[x^i](e^x-1)^{i-k}$\n\n  $=\\sum\\limits_{i=k}^n[x^k]\\Big(\\dfrac{e^x-1}{x}\\Big)^{i-k}$\n  \n  $=\\sum\\limits_{i=0}^{n-k}[x^k]\\Big(\\dfrac{e^x-1}{x}\\Big)^{i}$\n  \n  \u5f62\u5f0f\u7edf\u4e00\u4e86\u8bb8\u591a\u3002\n  \n\u8bbe $F(x)=\\dfrac{e^x-1}{x}$ \u3002\n\n\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u5bf9 $k=0...(n-1)$ \u6c42\u51fa $S[k]=\\sum\\limits_{i=0}^{n-k}[x^k]F(x)^{i}$\n  \n$=[x^k]\\bigg(\\dfrac{1-F(x)^{n-k+1}}{1-F(x)}\\bigg)$ \n\n$=[x^k]\\dfrac{1}{1-F(x)}-[x^k]\\dfrac{F(x)^{n-k+1}}{1-F(x)}$\n\n\u7b2c\u4e00\u90e8\u5206\u53ef\u4ee5\u591a\u9879\u5f0f\u6c42\u9006,\u4f46\u662f\u6ce8\u610f\u5230\u5206\u6bcd\u7684\u5e38\u6570\u9879\u4e3a $0$ ,\u4e0d\u80fd\u76f4\u63a5\u4e0a\u3002\n\n- \u8003\u8651\u4fee\u6539\u6c42\u9006\u7684\u5b9a\u4e49 : $G(x)=x^kF(x)$, \u4f7f\u5f97 $F(x)$ \u6709\u5e38\u6570\u9879\uff0c\u90a3\u4e48 $\\dfrac{1}{G(x)} = x^{-k}\\dfrac{1}{F(x)}$\n\n  **\u9644** : \u8fd9\u9700\u8981\u5f15\u5165**\u5206\u5f0f\u57df**(\u8d1f\u6570\u6b21\u6570),\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u5728\u8fd9\u91cc\u4ecd\u7136\u6210\u7acb,\u6240\u4ee5\u4e0d\u7528\u62c5\u5fc3\u5e72\u6270\u63a8\u5bfc\u3002\n\n  \u901a\u4fd7\u5730\u8bb2,\u5c31\u662f\u5148\u628a\u6574\u4e2a\u5f0f\u5b50\u4e58\u4ee5 $x^k$ ,\u76f8\u5f53\u4e8e\u5bf9\u5206\u6bcd\u9664 $x^k$ ,\u7136\u540e\u53ef\u4ee5\u7ecf\u5178\u6c42\u9006\u3002\u63d0\u53d6\u7cfb\u6570\u7684\u65f6\u5019\u8981\u8003\u8651\u591a\u4f59\u7684 $x^k$ ,\u63d0\u53d6\u9ad8$k$\u4f4d,\u6240\u4ee5\u591a\u9879\u5f0f\u7684\u754c\u8981\u5927\u4e00\u70b9\u3002\n  \n  \u8fd9\u91cc\u5b9e\u9645\u4e0a\u6700\u4f4e\u53ea\u6709 $[x^{-1}]$ \u9879,\u6240\u4ee5\u4e5f\u4e0d\u662f\u5f88\u9ebb\u70e6\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u7b2c\u4e8c\u90e8\u5206\u3002(\u5206\u6bcd\u7684\u9006\u540c\u6837\u62e5\u6709\u8d1f\u6307\u6570,\u4e0d\u8fc7\u6ca1\u5173\u7cfb)\n\n\u628a\u6b21\u6570\u8865\u9f50 : $[x^k]\\dfrac{F(x)^{n-k+1}}{1-F(x)}=[x^{n+1}]\\dfrac{\\big(xF(x)\\big)^{n-k+1}}{1-F(x)}$\n\n\u8003\u8651**\u52a0\u5165\u4e00\u4e2a\u5143\u4ee5\u533a\u5206\u4fe1\u606f**\u3002\n  \n$=[x^{n+1}y^{n-k+1}]\\sum\\limits_{i=0}\\dfrac{\\big(xF(x)y\\big)^i}{1-F(x)}$\n\n$=[x^{n+1}y^{n-k+1}]\\dfrac{1}{1-F(x)}\\dfrac{1}{1-xF(x)y}$\n\n\u6ce8\u610f\u5230\u53f3\u8fb9\u662f\u4e0e $k$ \u65e0\u5173\u7684,\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa $[x^{n+1}]$ \u9879\u5173\u4e8e $y$ \u7684\u591a\u9879\u5f0f\u5c31\u5f97\u5230\u4e86\u7b54\u6848\u3002\n\n\u8003\u8651\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u53cd\u6f14,\u591a\u9879\u5f0f\u590d\u5408\u7cfb\u5217\u7406\u8bba\u3002\n\n\u4f46\u6ce8\u610f\u5230 $\\dfrac{1}{1-F(x)}\\dfrac{1}{1-xF(x)y}$ \u9664\u4e86 $F(x)$ \u8fd8\u6709\u989d\u5916\u7684 $x$ ,\u4e0d\u5bb9\u6613\u7528\u7ecf\u5178\u7684\u591a\u9879\u5f0f\u590d\u5408\u76f4\u63a5\u63cf\u8ff0\u3002\n\n\u5148\u8bbe$W(x)=xF(x)$ ,  $H(x)$ \u6ee1\u8db3 $\\dfrac{W(x)}{H(W(x))}=x$, \u5373 $\\dfrac{xF(x)}{H(W(x))}=x$ , \u5219 $F(x)=H(W(x))$\n\n(\u6211\u4eec\u4f7f\u7528 $H(x)$ \u7ed9 $xF(x)$ \u6d88\u53bb\u4e86 $x$ )\n\n\u53c8\u8bbe $G(x)=\\dfrac{1}{1-H(x)}\\dfrac{1}{1-xy}$\n\n- **\u6ce8** : \u624b\u52a8\u7206\u7b97\u53ef\u6c42\u5f97 $G'(x)=\\dfrac{y+H'(x)-yH(x)-xyH'(x)}{\\big(1-H(x)\\big)^2\\big(1-xy\\big)^2}$\n\n\u90a3\u4e48\u6709 $G(W(x))=\\dfrac{1}{1-H(W(x))}\\dfrac{1}{1-W(x)y}=\\dfrac{1}{1-F(x)}\\dfrac{1}{1-xF(x)y}$ \n\n(\u73b0\u5728\u6211\u4eec\u4ee5\u7ecf\u5178\u591a\u9879\u5f0f\u590d\u5408\u63cf\u8ff0\u4e86\u95ee\u9898)\n\n\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f $[x^{n+1}]G(W(x))$\u3002\n\n\u8bbe $P(x)$ \u4e3a $W(x)$ \u7684\u590d\u5408\u9006 ,\u4e0d\u96be\u53d1\u73b0 $P(x)=\\dfrac{x}{H(x)}$ , \u5219 $\\dfrac{P(x)}{x}=\\dfrac{1}{H(x)}$\u3002\n\n\u4f7f\u7528**\u6269\u5c55\u62c9\u683c\u6717\u65e5\u53cd\u6f14**\u53ef\u5f97\n\n$$[x^{n+1}]H(W(x))=\\dfrac{1}{n+1}[x^n]\\dfrac{y+H'(x)-yH(x)-xyH'(x)}{\\big(1-H(x)\\big)^2\\big(1-xy\\big)^2}\\left(\\dfrac{P(x)}{x}\\right)^{-(n+1)}$$\n\n\u5ffd\u7565\u5e38\u6570 $\\frac{1}{n+1}$ \u5e76\u4ee3\u6362\n\n$$=[x^n]\\dfrac{y\\big(1-H(x)\\big)+\\big(1-xy\\big)H'(x)}{\\big(1-H(x)\\big)^2\\big(1-xy\\big)^2}H(x)^{n+1}$$\n\n$$=[x^n]\\left(\\dfrac{y}{\\big(1-H(x)\\big)\\big(1-xy\\big)^2}+\\dfrac{H'(x)}{\\big(1-H(x)\\big)^2\\big(1-xy\\big)}\\right)H(x)^{n+1}$$\n\n\u5c55\u5f00\u5173\u4e8e $y$ \u7684\u5c01\u95ed\u5f62\u5f0f\n\n$$=[x^n]\\left(\\dfrac{1}{\\big(1-H(x)\\big)}\\sum\\limits_{i=0}(i+1)x^iy^{i+1}+\\dfrac{H'(x)}{\\big(1-H(x)\\big)^2}\\sum\\limits_{i=0}(xy)^i\\right)H(x)^{n+1}$$\n\n\u8003\u8651\u63d0\u53d6 $[y^m]$ \u7cfb\u6570\n\n$$[x^ny^m]\\left(\\dfrac{1}{\\big(1-H(x)\\big)}\\sum\\limits_{i=0}(i+1)x^iy^{i+1}+\\dfrac{H'(x)}{\\big(1-H(x)\\big)^2}\\sum\\limits_{i=0}(xy)^i\\right)H(x)^{n+1}$$\n\n$$=[x^n]\\left(\\dfrac{mx^{m-1}}{\\big(1-H(x)\\big)}+\\dfrac{H'(x)x^m}{\\big(1-H(x)\\big)^2}\\right)H(x)^{n+1}$$\n\n$$=[x^{n-m+1}]m\\dfrac{H(x)^{n+1}}{\\big(1-H(x)\\big)}+[x^{n-m}]\\dfrac{H'(x)H(x)^{n+1}}{\\big(1-H(x)\\big)^2}$$\n\n\u5206\u522b\u6c42\u51fa $\\dfrac{H(x)^{n+1}}{\\big(1-H(x)\\big)}$ \u548c $\\dfrac{H'(x)H(x)^{n+1}}{\\big(1-H(x)\\big)^2}$ \u5373\u53ef,\u95ee\u9898\u53d8\u4e3a\u4e86\u6c42 $H(x)$\u3002\n\n\u5e38\u89c4\u7684\u591a\u9879\u5f0f\u590d\u5408\u9006\u80af\u5b9a\u662f\u4e0d\u884c\u7684,\u6ce8\u610f\u5230\u95ee\u9898\u7684\u7279\u6b8a\u6027 :  $W(x)=xF(x)=e^x-1$\n\n\u5bb9\u6613\u6784\u9020 $\\ln(e^x-1+1)=x$ , \u90a3\u4e48\u6709 $P(x)=\\ln(x+1)$ ,\u5219 $H(x)=\\dfrac{x}{\\ln(x+1)}$\u3002\n\n( \u6b64\u5904\u6709 $1-H(x)$ \u7684\u5e38\u6570\u9879\u4e3a $0$ ,\u4ecd\u9700\u8981\u5206\u5f0f\u57df,\u8bb0\u5f97\u504f\u79fb\u6b21\u6570 )\n\n\u7efc\u4e0a,\u6211\u4eec\u4ee5 $O(n\\log n)$ \u6216\u8005 $O(n\\log^2n)$ \u7684\u590d\u6742\u5ea6\u89e3\u51b3\u4e86\u672c\u9898\u3002\n\n\u5b9e\u73b0\u4e2d\u4f7f\u7528\u4e86\u5927\u529b\u500d\u589e\u5feb\u901f\u5e42,\u65f6\u9650\u6bd4\u8f83\u677e\u5c31\u5361\u8fc7\u53bb\u4e86\u3002\n\n```cpp\n#include<algorithm>\n#include<cstring>\n#include<cstdio>\n#define ll long long\n#define clr(f,n) memset(f,0,sizeof(ll)*(n))\n#define cpy(f,g,n) memcpy(f,g,sizeof(ll)*(n))\nusing namespace std;\nconst int _G=3,mod=998244353,Maxn=135000;\nll powM(ll a,ll t=mod-2){\n  ll ans=1;\n  while(t){\n    if(t&1)ans=ans*a%mod;\n    a=a*a%mod;t>>=1;\n  }return ans;\n}\nconst int invG=powM(_G);\nint tr[Maxn<<1],tf;\nvoid tpre(int n){\n  if (tf==n)return ;tf=n;\n  for(int i=0;i<n;i++)\n    tr[i]=(tr[i>>1]>>1)|((i&1)?n>>1:0);\n}\nvoid NTT(ll *g,bool op,int n)\n{\n  #define ull unsigned long long\n  tpre(n);\n  static ull f[Maxn<<1],w[Maxn]={1};\n  for (int i=0;i<n;i++)f[i]=(((ll)mod<<5)+g[tr[i]])%mod;\n  for(int l=1;l<n;l<<=1){\n    ull tG=powM(op?_G:invG,(mod-1)/(l+l));\n    for (int i=1;i<l;i++)w[i]=w[i-1]*tG%mod;\n    for(int k=0;k<n;k+=l+l)\n      for(int p=0;p<l;p++){\n        int tt=w[p]*f[k|l|p]%mod;\n        f[k|l|p]=f[k|p]+mod-tt;\n        f[k|p]+=tt;\n      }      \n    if (l==(1<<10))\n      for (int i=0;i<n;i++)f[i]%=mod;\n  }if (!op){\n    ull invn=powM(n);\n    for(int i=0;i<n;++i)\n      g[i]=f[i]%mod*invn%mod;\n  }else for(int i=0;i<n;++i)g[i]=f[i]%mod;\n}\nvoid px(ll *f,ll *g,int n)\n{for(int i=0;i<n;++i)f[i]=f[i]*g[i]%mod;}\nvoid times(ll *f,ll *g,int m)\n{\n  int n=1;while(n<m+m)n<<=1;\n  NTT(f,1,n);NTT(g,1,n);\n  px(f,g,n);NTT(f,0,n);clr(f+m,n-m);\n}\nvoid invp(ll *f,int m)\n{\n  static ll sav[Maxn<<1],w[Maxn<<1],r[Maxn<<1];\n  int n;for (n=1;n<m;n<<=1);\n  w[0]=powM(f[0]);\n  for (int len=2;len<=n;len<<=1){\n  \tfor (int i=0;i<(len>>1);i++)\n      r[i]=(w[i]<<1)%mod;\n    cpy(sav,f,len);\n    NTT(w,1,len<<1);px(w,w,len<<1);\n    NTT(sav,1,len<<1);px(w,sav,len<<1);\n  \tNTT(w,0,len<<1);clr(w+len,len);\n  \tfor (int i=0;i<len;i++)\n      w[i]=(r[i]-w[i]+mod)%mod;\n  }cpy(f,w,m);clr(sav,n+n);clr(w,n+n);clr(r,n+n);\n}\nvoid dao(ll *f,int m){\n  for (int i=1;i<m;i++)\n    f[i-1]=f[i]*i%mod;\n  f[m-1]=0;\n}\nvoid powp(ll *f,int m,int t)\n{\n  static ll g[Maxn<<1];\n  int n=1;while(n<m+m)n<<=1;g[0]=1;\n  while(t){\n    NTT(f,1,n);\n    if (t&1){\n      NTT(g,1,n);\n      px(g,f,n);NTT(g,0,n);\n      clr(g+m,n-m);\n    }px(f,f,n);NTT(f,0,n);\n    clr(f+m,n-m);t>>=1;\n  }cpy(f,g,m);clr(f+m,n-m);clr(g,n);\n}\nll fac[Maxn],ifac[Maxn];\nvoid Init(int m)\n{\n  fac[0]=1;\n  for (int i=1;i<=m;i++)\n    fac[i]=fac[i-1]*i%mod;\n  ifac[m]=powM(fac[m]);\n  for (int i=m;i;i--)\n    ifac[i-1]=ifac[i]*i%mod;\n}\nint n,m;\nll F[Maxn<<1],G[Maxn<<1],S[Maxn<<1],H[Maxn<<1],H1[Maxn<<1],H2[Maxn<<1];\nint main()\n{\n  scanf(\"%d\",&n);Init(n+6);\n  int len=1;while(len<n+n+4)len<<=1;\n  m=n+2;\n  for (int i=0;i<m+1;i++)G[i]=mod-ifac[i+2];\n  invp(G,m+1);cpy(S,G+1,m+1);\n  for (int i=0;i<m+1;i++){\n    H[i]=fac[i]*ifac[i+1]%mod;\n    if (i&1)H[i]=mod-H[i];\n  }invp(H,m+1);cpy(H1,H,m);\n  powp(H1,m,n+1);\n  cpy(G,H,m+1);dao(G,m+1);\n  cpy(H2,H1,m);times(H2,G,m);clr(G,len);\n  for (int i=0;i<m;i++)G[i]=mod-H[i+1];\n  invp(G,m);\n  NTT(G,1,len);NTT(H1,1,len);NTT(H2,1,len);\n  px(H1,G,len);NTT(H1,0,len);clr(H1+m,len-m);\n  px(H2,G,len);NTT(H2,0,len);clr(H2+m,len-m);NTT(H2,1,len);\n  px(H2,G,len);NTT(H2,0,len);clr(H2+m,len-m);\n  for (int i=1,sav=powM(n+1);i<n+2;i++){\n    int m=n-i+1;\n    S[i]=(S[i]-(H1[n-m+2]*m+H2[n-m+2])%mod*sav)%mod;\n  }S[0]=n;\n  for (int i=0;i<n;i++)S[i]=(S[i]+mod)%mod*fac[i]%mod;\n  for (int i=0;i<n;i++)F[i]=(i&1) ? mod-ifac[i] : ifac[i];\n  clr(F+n,len-n);clr(S+n,len-n);reverse(S,S+n);\n  NTT(F,1,len);NTT(S,1,len);\n  px(S,F,len);NTT(S,0,len);\n  clr(S+n,len-n);reverse(S,S+n);\n  for (int i=0;i<n;i++)\n    printf(\"%lld \",S[i]*fac[n]%mod*ifac[i]%mod);\n  return 0;\n}\n```\n\n\n\n\n\n\n",
        "postTime": 1589543117,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1349F2 \u3010Slime and Sequences (Hard Version)\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u6211\u4eec\u79f0\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $p$ \u662f\u597d\u7684\u5f53\u4e14\u4ec5\u5f53\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5728 $p$ \u4e2d\u4e14\u5927\u4e8e $1$ \u7684\u6570 $k$ \u90fd\u81f3\u5c11\u6709\u4e00\u7ec4 $1\\leq i<j\\leq n$ \u4f7f\u5f97 $p_i=k-1,p_j=k$\u3002\n\n\u4f60\u9700\u8981\u6c42\u51fa $1\\sim n$ \u4e2d\u7684\u6bcf\u4e2a\u6570\u5728\u6240\u6709\u957f\u5ea6\u4e3a $n$ \u7684\u597d\u5e8f\u5217\u4e2d\u51fa\u73b0\u6b21\u6570\u4e4b\u548c\u3002\n\n$\\texttt{Data Range:}1\\leq n\\leq 10^5$\n\n### \u9898\u89e3\n\n\u9898\u76ee\u592a\u6bd2\u7624\u4e86\uff0c\u6211\u592a\u83dc\u4e86\u3002\n\n\u56fd \u9645 \u8ba1 \u6570 \u6c34 \u5e73\n\n\u56de\u987e F1 \u7684\u5f0f\u5b50\uff1a\n\n$$r_k=\\sum\\limits_{i=\\max(k,1)}^{n}\\left\\langle\\begin{matrix}i\\\\k\\end{matrix}\\right\\rangle\\binom{n}{i}(n-i)!$$\n\n\u6ce8\u610f\u5230\u6b27\u62c9\u6570\u7684\u8ba1\u7b97\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u74f6\u9888\uff0c\u6240\u4ee5\u8003\u8651\u4f7f\u7528\u751f\u6210\u51fd\u6570\u4f18\u5316\u3002\n\n\u8bbe\u4e00\u4e2a\u5947\u5947\u602a\u602a\u7684\u4e1c\u897f\uff1a$\\left|\\begin{matrix}n\\\\k\\end{matrix}\\right|$ \u8868\u793a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\u4e2d\uff0c**\u81f3\u5c11**\u6709 $k$ \u4e2a\u4f4d\u7f6e\u586b\u5c0f\u4e8e\u53f7\u7684\u65b9\u6848\u6570\uff1a\n\n$$\\left|\\begin{matrix}n\\\\k\\end{matrix}\\right|=\\sum\\limits_{i=k}^{n}\\binom{i}{k}\\left\\langle\\begin{matrix}n\\\\i\\end{matrix}\\right\\rangle$$\n\n\u7136\u800c\u663e\u7136\u4e8c\u9879\u5f0f\u53cd\u6f14\n\n$$\\left\\langle\\begin{matrix}n\\\\k\\end{matrix}\\right\\rangle=\\sum\\limits_{i=k}^{n}(-1)^{i-k}\\binom{i}{k}\\left|\\begin{matrix}n\\\\i\\end{matrix}\\right|$$\n\n\u540c\u65f6\u53ef\u4ee5\u8003\u8651\u5c06\u5c0f\u4e8e\u53f7\u8fde\u63a5\u7684\u4f4d\u7f6e\u5408\u5e76\u6210\u4e00\u5757\uff0c\u5bb9\u6613\u770b\u51fa\u4e00\u5171\u6709 $n-k$ \u5757\u3002\u56e0\u4e3a\u8fde\u901a\u5757\u5185\u90e8\u7684\u586b\u6cd5\u53ea\u6709\u4e00\u79cd\u800c\u4e14\u5fc5\u987b\u975e\u7a7a\uff0c\u540c\u65f6\u8fde\u901a\u5757\u4e4b\u95f4\u56e0\u4e3a\u9650\u5236\u662f**\u81f3\u5c11**\u6240\u4ee5\u53ef\u4ee5\u968f\u610f\u5408\u5e76\uff0c\u4e8e\u662f\u5f97\u5230\u4e86\u4e00\u4e2a EGF\uff1a\n\n$$\\left|\\begin{matrix}n\\\\k\\end{matrix}\\right|=n![x^n](e^x-1)^{n-k}$$\n\n\u6240\u4ee5\n\n$$\\left\\langle\\begin{matrix}n\\\\k\\end{matrix}\\right\\rangle=\\sum\\limits_{i=k}^{n}(-1)^{i-k}\\binom{i}{k}n![x^n](e^x-1)^{n-i}$$\n\n\u7136\u540e\u518d\u4ee3\u5165\n\n$$r_k=\\sum\\limits_{i=k}^{n}\\sum\\limits_{j=k}^{i}(-1)^{j-k}\\binom{j}{k}i![x^i](e^x-1)^{i-j}\\binom{n}{i}(n-i)!$$\n\n\u6574\u7406\u4e00\u4e0b\n\n$$r_k=\\frac{n!}{k!}\\sum\\limits_{j=k}^{n}\\frac{(-1)^{j-k}j!}{(j-k)!}\\sum\\limits_{i=j}^{n}[x^n](e^x-1)^{i-j}$$\n\n\u6ce8\u610f\u5230\u7b2c\u4e8c\u4e2a\u548c\u5f0f\u7684\u4e1c\u897f\u5f88\u9ebb\u70e6\uff0c\u4e0d\u5982\u8bbe $f_j=\\sum\\limits_{i=j}^{n}[x^i](e^x-1)^{i-j}$\uff0c\u90a3\u4e48\u6709\n\n$$r_k=\\frac{n!}{k!}\\sum\\limits_{j=k}^{n}j!f_j\\cdot\\frac{(-1)^{j-k}}{(j-k)!}$$\n\n\u8fd9\u4e2a\u5c31\u662f\u5dee\u5377\u79ef\u7684\u5957\u8def\u4e86\uff0c\u4e8e\u662f\u74f6\u9888\u8f6c\u5316\u4e3a\u6c42 $f_j$\u3002\u6ce8\u610f\u5230\u8fd9\u91cc\u53ef\u4ee5\u5e73\u79fb\u7cfb\u6570\u7136\u540e\u4ee3\u6362\uff1a\n\n$$f_j=\\sum\\limits_{i=j}^{n}[x^i](e^x-1)^{i-j}=\\sum\\limits_{i=j}^{n}[x^j]\\left(\\frac{e^x-1}{x}\\right)^{i-j}=[x^j]\\sum\\limits_{i=0}^{n-j}\\left(\\frac{e^x-1}{x}\\right)^{i}$$\n\n\u518d\u8bbe $F(x)=\\dfrac{e^x-1}{x}$\uff0c\u90a3\u4e48\u968f\u4e4b\u6709\n\n$$f_j=[x^j]\\sum\\limits_{i=0}^{n-j}F^i(x)=[x^j]\\left(\\frac{1-F^{n-j+1}(x)}{1-F(x)}\\right)=[x^j]\\frac{1}{1-F(x)}-[x^j]\\frac{F^{n-j+1}(x)}{1-F(x)}$$\n\n~~\u7136 \u540e \u8fd9 \u5c31 \u505a \u5b8c \u4e86~~\n\n\u975e\u4e5f\u3002\u6ce8\u610f\u5230 $1-F(x)$ \u7684\u5e38\u6570\u9879\u662f $0$\uff0c\u6240\u4ee5\u4f60\u6839\u672c\u65e0\u6cd5\u7528\u5e38\u89c4\u7684\u6c42\u9006\u65b9\u6cd5\u641e\u51fa\u8fd9\u4e9b\u4e1c\u897f\u3002\n\n\u8003\u8651\u5bf9\u5e38\u89c4\u7684\u591a\u9879\u5f0f\u64cd\u4f5c\u8fdb\u884c\u6269\u57df\uff08\u5c31\u662f\u8bf4\uff0c\u53ef\u4ee5\u5141\u8bb8\u8d1f\u6307\u6570\u6b21\u6570\u5e42\u8fd9\u4e2a\u4e1c\u897f\u5b58\u5728\uff09\uff0c\u7136\u540e\u7c7b\u4f3c\u4e8e\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u7684\u65b9\u6cd5\uff0c\u4fee\u6539\u591a\u9879\u5f0f\u6c42\u9006\u7684\u5b9a\u4e49\uff1a\n\n\u8bbe $F(x)=x^kG(x)$\uff0c\u5176\u4e2d $G(x)$ \u4e3a\u5e38\u6570\u9879\u975e\u96f6\u7684\u591a\u9879\u5f0f\uff0c\u5219 $F(x)=x^{-k}\\dfrac{1}{G(x)}$\u3002\u7531\u4e8e $1-F(x)$ \u7cfb\u6570\u975e\u96f6\u7684\u6700\u4f4e\u6b21\u9879\u4e3a $x^1$ \u6240\u4ee5\u8fd9\u91cc\u4e5f\u4e0d\u662f\u5f88\u5904\u7406\u3002\n\n\u73b0\u5728\u6765\u770b\u7b2c\u4e8c\u4e2a\u4e1c\u897f\uff0c\u6765\u5e73\u79fb\u4e00\u4e0b\u7cfb\u6570\uff1a\n\n$$[x^j]\\frac{F^{n-j+1}(x)}{1-F(x)}=[x^{n+1}]\\frac{\\left(xF(x)\\right)^{n-j+1}}{1-F(x)}$$\n\n~~\u5230\u8fd9\u91cc\u53d1\u73b0\u6211\u4e0d\u4f1a\u505a\u4e86~~\uff0c\u7136\u540e\u5b66\u5230\u4e86\u4e00\u4e2a\u5f88\u795e\u5947\u7684\u4e1c\u897f\uff1a**\u52a0\u4e00\u4e2a\u5143\u6765\u533a\u5206\u4fe1\u606f**\uff0c\u597d\u6bd4\u63a8\u548c\u5f0f\u7684\u65f6\u5019\u52a0\u4e00\u4e2a\u6c42\u548c\u53f7\u6700\u7ec8\u6d88\u6389\u7684\u8fc7\u7a0b\u3002\uff08~~\u5411\u542c\u5012\u9000~~\uff09\n\n$$[x^{n+1}]\\frac{\\left(xF(x)\\right)^{n-j+1}}{1-F(x)}=[x^{n+1}y^{n-j+1}]\\sum_{i}\\frac{(xyF(x))^{i}}{1-F(x)}=[x^{n+1}y^{n-j+1}]\\left(\\frac{1}{1-F(x)}\\frac{1}{1-xyF(x)}\\right)$$\n\n\u8fd9\u4e2a\u65f6\u5019\u52a0\u4e00\u4e2a\u5143\u7684\u597d\u5904\u5c31\u51fa\u73b0\u4e86\uff1a\u9700\u8981\u6c42\u7684\u591a\u9879\u5f0f\u4e2d\u4e0e $j$ \u8fd9\u4e2a\u53d8\u91cf\u65e0\u5173\u3002\u76f8\u5f53\u4e8e\u6211\u4eec\u53ea\u9700\u8981\u6c42\u67d0\u4e00\u4e2a\u4ee5 $y$ \u4e3a\u4e3b\u5143\u7684\u591a\u9879\u5f0f\u5373\u53ef\u3002\n\n~~\u7136\u800c\u53c8\u4e0d\u4f1a\u4e86~~\uff0c\u8003\u8651\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u76f8\u5173\u8fd8\u6709\u591a\u9879\u5f0f\u590d\u5408\u9006\u7406\u8bba\u3002\u8bbe $P(x)=xF(x)$\uff0c\u518d\u8bbe $H(x)$ \u6ee1\u8db3 $P(x)=xH(P(x))$\uff0c\u90a3\u4e48\u5f88\u663e\u7136\u6709 $F(x)=H(P(x))$\u3002\u4e8e\u662f\u6211\u4eec\u5c31\u7528\u5404\u79cd\u591a\u9879\u5f0f\u590d\u5408\u7684\u65b9\u6cd5\u5c06 $F(x)$ \u524d\u9762\u7684 $x$ \u7ed9\u53bb\u6389\u4e86\u3002\n\n\u518d\u8bbe $G(x)=\\dfrac{1}{1-H(x)}\\dfrac{1}{1-xy}$\uff0c\u90a3\u4e48\u6709 $G(P(x))=\\dfrac{1}{1-F(x)}\\dfrac{1}{1-xyF(x)}$\u3002\u8fd9\u4e2a\u65f6\u5019\u8f6c\u5316\u4e3a\u4e00\u9053\u7ecf\u5178\u7684\u591a\u9879\u5f0f\u590d\u5408\u95ee\u9898\u3002\n\n\u8003\u8651 $P(x)$ \u7684\u590d\u5408\u9006 $Q(x)$\uff0c\u53ef\u4ee5\u63a8\u51fa $P(Q(x))=x$\uff0c\u7136\u540e\u66b4\u529b\u4ee3\u5165\uff1a\n\n$$P(Q(x))=Q(x)H(P(Q(x)))$$\n\n\u4e5f\u5373 $x=Q(x)H(x)$\u3002\u63a5\u4e0b\u6765\u9700\u8981\u5927\u91cf\u7684 dirty works\uff0c\u6240\u4ee5\u8bf7\u5584\u7528 Mathematica\u3002\u5bb9\u6613\u7b97\u51fa\n\n$$G^{\\prime}(x)=\\frac{y+(1-y-xy)H^\\prime(x)}{(1-H(x))^2(1-xy)^2}$$\n\n\u7136\u540e\u62d3\u5c55\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u51b2\u4e00\u4e0b\uff1a\n\n$$[x^{n+1}]H(P(x))=\\frac{1}{n+1}[x^n]H^{\\prime}(x)\\left(\\frac{x}{Q(x)}\\right)^{n+1}$$\n\n\u7136\u540e\u5f0f\u5b50\u63a8\u8d77\u6765\u6bd4\u8f83\u75db\u82e6\uff0c\u5ffd\u7565\u6389\u524d\u9762\u7684\u90a3\u4e2a\u4e1c\u897f\u4e4b\u540e\u5927\u6982\u662f\u8fd9\u6837\u7684\uff08\u7531\u4e8e\u534a\u5e74\u6ca1\u6765\u770b\u8fd9\u4e2a\u9898\u6240\u4ee5\u627e\u4e0d\u5230\u4e4b\u524d\u4e1c\u897f\u7684\u8349\u7a3f\u7eb8\u4e86\uff0c\u8fd9\u79cd\u5f0f\u5b50\u7531\u4e8e\u518d\u4e5f\u4e0d\u60f3\u63a8\u7b2c\u4e8c\u904d\u6240\u4ee5\u84af\u4e86\u4e2a\u7ed3\u8bba\uff09\n\n$$[x^{n-m+1}]m\\frac{H^{n+1}(x)}{1-H(x)}+[x^{n-m}]m\\frac{H^{\\prime}(x)H^{n+1}(x)}{(1-H(x))^2}$$\n\n\u95ee\u9898\u53d8\u6210\u4e86\u6c42 $H(x)$\u3002\n\n\u6ce8\u610f\u5230 $P(x)=xF(x)=e^x-1$\uff0c\u540c\u65f6 $e^x-1$ \u7684\u53cd\u51fd\u6570\u4e3a $\\ln(x+1)$\uff0c\u6240\u4ee5 $Q(x)=\\ln(x+1)$\u3002\u7136\u540e\u53ef\u4ee5\u6c42\u5f97 $H(x)=\\dfrac{x}{\\ln(x+1)}$\u3002\n\n\u56e0\u4e3a\u4ee3\u7801\u662f\u534a\u5e74\u4e4b\u524d\u5199\u7684\u8dd1\u5f97\u53c8\u6162\u53c8\u957f\u6240\u4ee5\u4e0d\u653e\u51fa\u6765\u4e86\u3002\u5230\u65f6\u5019\u5361\u5361\u5e38\u53ef\u80fd\u53ef\u4ee5\u653e\u51fa\u6765\u5427\u3002",
        "postTime": 1589962928,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1349F2 \u3010Slime and Sequences (Hard Version)\u3011"
    },
    {
        "content": "\u6211\u4eec\u5c06\u66b4\u529b\u8ba1\u7b97\u51fa\u4e8c\u5143\u751f\u6210\u51fd\u6570 $\\widehat F(z, t) = \\sum_{n\\ge 1}\\sum_{k=1}^n A_{n,k}\\frac{z^nt^k}{n!}$, \u5176\u4e2d $A_{n,k}$ \u662f\u6240\u6709 $n$ \u957f\u5ea6\u7684\u5e8f\u5217\u4e2d $k$ \u51fa\u73b0\u6b21\u6570\u7684\u548c. \u8003\u8651\u5bb9\u65a5\u539f\u7406. \u5bf9\u4e8e $\\max k = m$ \u7684\u5e8f\u5217, \u6211\u4eec\u6709\n$$\n\\sum_{j=1}^m \\sum_{S \\subseteq \\{1, 2, \\cdots m-1\\}} (-1)^{|S|} Q(S, z, t, j)\n$$\n\u8fd9\u4e2a\u610f\u601d\u662f\u8bf4\u5bf9\u4e8e\u6240\u6709 $i \\in S$, \u6211\u4eec\u5f3a\u5236\u8ba9\u6240\u6709 $i$ \u51fa\u73b0\u5728 $i + 1$ \u4e4b\u524d, \u7edf\u8ba1 $j$ \u7684\u51fa\u73b0\u6b21\u6570\u4e4b\u548c \n\n\u6211\u4eec\u8003\u8651\u6539\u8fdb\u679a\u4e3e\u987a\u5e8f\uff0c\u7531\u4e8e\u6bcf\u4e2a\u5f3a\u5236\u8981\u6c42\u5c31\u5c06\u8fde\u7eed\u51e0\u4e2a $k$ \u7684\u5173\u7cfb\u201c\u7ed1\u5b9a\u201d\u5728\u4e00\u8d77\uff0c\u6211\u4eec\u53cd\u8fc7\u6765\u679a\u4e3e\u8fd9\u4e2a\u5f3a\u5236\u8981\u6c42\u7684\u4ea7\u751f\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u4e00\u8fde\u4e32\u7684 $k$ \u5c31\u7ec4\u6210\u4e86\u4e00\u4e2a\u201c\u57fa\u672c\u5355\u5143\u201d\u3002\u800c\u63a5\u4e0b\u6765\u6211\u4eec\u8fd8\u8981\u679a\u4e3e\u6211\u4eec\u6240\u9700\u8981\u7edf\u8ba1\u7684\u5404\u4e2a $k$ \u51fa\u73b0\u7684\u6b21\u6570\u548c\uff0c\u8d21\u732e\u5230 $t^k$ \u4e0a\u9762\u3002\u56e0\u6b64\u8fd9\u4e2a\u7ec4\u5408\u7ed3\u6784\u7684\u7edf\u8ba1\u53ef\u4ee5\u88ab\u8ba4\u4e3a\u662f\u5bf9\u679a\u4e3e\u5982\u4e0b\u7ed3\u6784\u8ba1\u7b97\u4ee3\u6570\u548c\uff1a\n\n> $$ \\overbrace{\\left.\\bigcirc {\\color{blue}(\\cdot t)} \\frac{\\tiny \\color{red} -1}{}\\bigcirc {\\color{blue}(\\cdot t)}  \\frac{\\tiny \\color{red} -1}{} \\cdots  \\frac{\\tiny \\color{red} -1}{} \\bigcirc {\\color{blue}(\\cdot t)} \\middle\\vert  \\cdots \\middle\\vert \\bigcirc {\\color{blue}(\\cdot t)} \\frac{\\tiny \\color{red} -1}{}\\cdots  \\frac{\\tiny \\color{red} -1}{} {\\color{green}\\bigcirc} {\\color{blue}(\\cdot t)}{\\color{green}(\\cdot \\mathrm{Len})} \\right.}^{\\mathrm{with} {\\color{blue}(\\cdot t)}} \\left. \\frac{\\tiny \\color{red} -1}{} \\cdots \\frac{\\tiny \\color{red} -1}{} \\bigcirc \\middle\\vert \\cdots \\middle\\vert \\bigcirc \\frac{\\tiny \\color{red} -1}{}\\bigcirc \\frac{\\tiny \\color{red} -1}{} \\cdots  \\frac{\\tiny \\color{red} -1}{} \\bigcirc \\right. $$\n> \u5176\u4e2d $\\bigcirc$ \u662f\u4e00\u4e2a\u975e\u7a7a\u540c\u8272\u5217\uff0c\u800c $-$ \u8868\u793a\u4e24\u4e2a\u989c\u8272\u4e4b\u95f4\u7684\u51fa\u73b0\u4f4d\u7f6e\u5173\u7cfb\u88ab\u4e25\u683c\u9650\u5236\uff0c $|$ \u8868\u793a\u4e4b\u95f4\u6ca1\u6709\u9650\u5236\u3002\n\n\u5bf9\u4e8e\u9694\u677f\u4e2d\u95f4\u7684\u8fc7\u7a0b\uff0c\u6613\u4e8e\u7528 OGF \u8868\u793a\uff0c\u6700\u540e\u6df7\u5408\u989c\u8272\u7684\u8fc7\u7a0b\uff0c\u6613\u4e8e\u7528 EGF \u8868\u793a\u3002\n\n\u4e3b\u8981\u7684 OGF \u5206\u6210\u4e09\u4e2a\u90e8\u5206\uff0c\u7b2c\u4e00\u4e2a\u9636\u6bb5\u662f\u91c7\u96c6\u4e86 $t$ \u7684\u90e8\u5206\uff0c\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u662f\u91c7\u96c6\u4e86 $t$ \u7684\u4e00\u4e2a\u7ec8\u6b62\u6bb5\uff0c\u4e14\u5728\u7ec8\u6b62\u4f4d\u7f6e\u7edf\u8ba1\u4e86\u67d0\u4e2a\u989c\u8272\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u7b2c\u4e09\u4e2a\u9636\u6bb5\u662f\u4e0d\u91c7\u96c6 $t$ \u7684\u90e8\u5206\u3002\n\n\u6211\u4eec\u5206\u522b\u7b97\u51fa\u4e09\u4e2a\u9636\u6bb5\uff1a\n\u7b2c\u4e00\u9636\u6bb5\uff1a\n$$\n\\begin{aligned}\nL(z,t) &=\\frac{-1}{1+\\frac z{1-z}t} + 1 \\\\ \n&= \\frac{t z}{1-(1-t) z}\\\\ \n&= \\sum_{k\\ge 0} z^{k+1} t(1-z)^k\\\\\n\\widehat L(z,t) &= \\frac t{1-t}\\sum_{k\\ge 0} \\frac{z^{k+1}}{(k+1)!} (1-t)^{k+1}\\\\\n&= \\frac t{1-t}  (\\mathrm e^ {z(1-t)} - 1)\n\\end{aligned}\n$$\n\u7b2c\u4e8c\u9636\u6bb5\uff1a\n$$\n\\begin{aligned}\nU(z,t) &= \\frac1{1+\\frac z{1-z}t} \\frac {zt}{(1-z)^2} \\frac1{1+\\frac z{1-z}}\\\\\n&= \\frac{tz}{1-(1-t)z} = L(z,t)\\\\\n\\widehat U(z,t)&= \\widehat L(z,t)\n\\end{aligned}\n$$\n\u7b2c\u4e09\u9636\u6bb5\u76f4\u63a5\u6709 $L(z, 1) = z = \\widehat L(z, 1)$\u3002\n\u56e0\u6b64\uff0c\u7b54\u6848\u7684 EGF \u5c31\u662f\n$$\n\\frac1{1-\\widehat L(z,t)} \\widehat U(z, t) \\frac 1{1 - \\widehat L(z, 1)}\n$$\n\n\u7ecf\u8fc7\u4e00\u756a\u5316\u7b80, \u6211\u4eec\u5c31\u5f97\u5230\u4e86 $\\frac{t(\\mathrm e^{z(1-t)}-1)}{(1-z) (1-t \\mathrm e^{z(1-t)})}$.\n\n\u6211\u4eec\u73b0\u5728\u8981\u8ba1\u7b97\n$$\n[z^n]\\frac{t(\\mathrm e^{z(1-t)}-1)}{(1-z) (1-t \\mathrm e^{z(1-t)})}\n$$\n\u8003\u8651 $\\left([z^n]\\frac{t(\\mathrm e^{z(1-t)}-1)}{(1-z) (1-t \\mathrm e^{z(1-t)})}\\right) + 1 = (1-t)[z^n] \\frac 1{(1-z)(1-t\\mathrm e^{z(1-t)})}$, \u7528\u4e8e\u7b80\u5316\u8868\u8fbe\u5f0f. \u63a5\u4e0b\u6765\u6211\u4eec\u4ee4 $z = \\frac u{1-t}$, \u5c31\u6709\n$$\n[z^n]\\frac 1{(1-z)(1-t\\mathrm e^{z(1-t)})} = (1-t)^n[u^n] \\frac1{(1-\\frac u{1-t})(1-t\\mathrm{e}^u)}\n$$\n\u8fd9\u4e00\u6b65\u7684\u597d\u5904\u5728\u4e8e\u6211\u4eec\u6d88\u53bb\u4e86\u4e0a\u6307\u6807\u7684\u4e00\u4e2a\u53d8\u91cf, \u65b9\u4fbf\u6211\u4eec\u63a5\u4e0b\u6765\u505a\u5206\u5f0f\u5206\u89e3\n$$\n\\begin{aligned} (1-t)[z^n] \\frac 1{(1-z)(1-t\\mathrm e^{z(1-t)})} &= [u^n]\\frac{(1-t)^{n+2}}{(1-\\frac{t}{1-u})(1-t\\mathrm e^u)(1-u)}\\\\&= (1-t)^{n+2} [u^n] \\left(\\frac{-\\mathrm e^u}{\\left(\\mathrm e^u u-\\mathrm e^u+1\\right) \\left(1-t \\mathrm e^u\\right)}+\\frac{\\frac{1}{1-u}}{\\left(\\mathrm e^u   u-\\mathrm e^u+1\\right) (1-\\frac{t}{1-u})}\\right)\\end{aligned}\n$$\n\n\u4e3b\u8981\u662f\u524d\u9762\u7684 exp \u90e8\u5206\uff0c\u7531\u4e8e $[u^m]\\mathrm{e}^{ku} = \\frac{k^m}{m!}$, \u53ef\u4ee5\u591a\u70b9\u6c42\u503c\u505a\u5230 $\\Theta(n\\log^2 n)$. \u5982\u679c\u4f60\u5e38\u6570\u4e0d\u5927, \u53ef\u4ee5\u901a\u8fc7.\n\n\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f18\u5316\u5230 $\\Theta(n\\log n)$ \u901a\u8fc7\u62c9\u683c\u6717\u65e5\u53cd\u6f14, \u548c xtq \u7684\u505a\u6cd5\u7c7b\u4f3c, \u7559\u4f5c\u4e60\u9898.\n",
        "postTime": 1589797278,
        "uid": 21423,
        "name": "Elegia",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1349F2 \u3010Slime and Sequences (Hard Version)\u3011"
    },
    {
        "content": "### Slime and Sequences \u4e2d\u6587\u9898\u89e3\n\n**UPD:\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u770b\u5230 Elegia \u7684\u9898\u89e3\uff1ahttps://blog.csdn.net/EI_Captain/article/details/106122006**\n\n#### Easy Version\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u5c06\u957f\u5ea6\u4e3a $n$ \u7684\u597d\u5e8f\u5217\u548c\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\u4e00\u4e00\u5bf9\u5e94\u3002\u8bbe\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\u4e3a $a_1,a_2,\\cdots,a_n$ \uff0c\u5219\u5728\u6bcf\u4e2a $a_i,a_{i+1}$ \u4e4b\u95f4\u586b\u5165\u5927\u4e8e\u53f7\u6216\u5c0f\u4e8e\u53f7\uff0c\u5219 $p_{a_i}$ \u7684\u503c\u5373\u4e3a $a_1,a_2,\\cdots ,a_i$ \u4e4b\u95f4\u5c0f\u4e8e\u53f7\u7684\u6570\u91cf\u52a0 $1$ \uff0c\u4e0d\u96be\u9a8c\u8bc1\u8fd9\u662f\u4e00\u4e2a $S$ \u4e0e\u6240\u6709\u6392\u5217\u7684\u96c6\u5408\u7684\u4e00\u4e2a\u4e00\u4e00\u5bf9\u5e94\u3002\n\n\u8bbe $d_{i,j}$ \u4e3a\u5728\u957f\u5ea6\u4e3a $i+1$ \u7684\u6392\u5217\u4e2d\u5728 $a_1,a_2,\\cdots ,a_{i+1}$ \u81f3\u5c11\u6709 $j$ \u4e2a\u5c0f\u4e8e\u53f7\u7684\u65b9\u6848\u6570\uff0c\u5219\u5c06\u6bcf\u4e00\u6bb5\u8fde\u7eed\u7684\u5c0f\u4e8e\u53f7\u5f53\u6210\u4e00\u6bb5\uff0c\u5bf9\u786e\u5b9a\u7684\u6570\u7684\u96c6\u5408\u586b\u5165\u8fd9\u4e00\u6bb5\u4e2d\u53ea\u6709\u552f\u4e00\u4e00\u79cd\u586b\u6cd5\uff0c\u800c $d_{i,j}$ \u4e2d\u6709 $i-j+1$ \u6bb5\uff0c\u6240\u4ee5 $d_{i,j}$ \u7684\u503c\u5373\u4e3a\u5c06 $n$ \u4e2a\u6570\u5206\u6210\u6709\u533a\u522b\u7684 $i-j +1$ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u7531\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684 $EGF$ \u53ef\u4ee5\u77e5\u9053\uff1a $d_{i,j}=(i+1)![z^{i+1}](e^z-1)^{i-j+1}$ \u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684dp\u6c42\u51fa\u6bcf\u4e2a $d_{i,j}$ \u7684\u503c\u3002\n\n\u6c42\u7b54\u6848\u65f6\uff0c\u5bf9\u6bcf\u4e2a $1\\leq i\\leq n$ \uff0c\u6211\u4eec\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u8d21\u732e\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e2a $1$ \u5230 $n$ \u7684\u6392\u5217\uff0c\u627e\u6bcf\u4e2a\u4f4d\u7f6e\u524d\u9762\u6709 $i-1$ \u4e2a\u5c0f\u4e8e\u53f7\u7684\u65b9\u6848\u6570\uff0c\u53ef\u4ee5\u5217\u51fa\u5f0f\u5b50\uff1a\n\n$$ans_{i+1}=\\sum\\limits_{x=0}^{n-1}\\sum\\limits_{y=i}^x (-1)^{y-i} {y\\choose i}d_{x,y}\\frac{n!}{(x+1)!}$$ \n$$=\\frac {n!}{i!}\\sum\\limits_{x=0}^{n-1}\\sum\\limits_{y=i}^x (-1)^{y-i}\\frac{y!d_{x,y}}{(y-i)!(x+1)!} $$\n\n$$=\\frac{n!}{i!} \\sum\\limits_{y=i}^{n-1}\\frac{(-1)^{y-i}y!}{(y-i)!}\\sum\\limits_{x=y}^{n-1}\\frac{d_{x,y}}{(x+1)!}$$ \n\n$$=\\frac {n!}{i!}\\sum\\limits_{y=i}^{n-1} \\frac{(-1)^{y-i}y!}{(y-i)!} \\sum\\limits_{x=y}^{n-1}[z^{x+1}](e^z-1)^{x-y+1}$$\n\n\u5982\u679c\u5bf9\u6bcf\u4e2a $y$ \u6c42\u51fa\u4e86 $\\sum\\limits_{x=y}^{n-1}[z^{x+1}](e^z-1)^{x-y+1}$ \uff0c\u5373\u53ef\u4ee5\u7528\u4e00\u6b21\u5377\u79ef\u6c42\u51fa\u6240\u6709 $ans_i$ \u7684\u503c\u3002\n\n\u7531\u4e8e\u5b58\u5728\u7b80\u5355\u7684 $O(n^2)$ \u7b97\u6cd5\u6765\u5bf9\u6bcf\u4e2a $y$ \u6c42\u51fa\u4e0a\u5f0f\u7684\u503c\uff0c\u6240\u4ee5\u5982\u679c\u6211\u4eec\u7528 $O(n^2)$ \u7684dp\u6c42 $d_{x,y}$ \uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $O(n^2)$ \u7684\u505a\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u7248 \uff08\u5176\u4ed6\u5f62\u5f0f\u7684dp\u4e5f\u53ef\u4ee5\u5f97\u5230\u8fd9\u4e2a\u590d\u6742\u5ea6\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u4ec5\u7ed9\u51fa\u53ef\u4ee5\u5bfc\u5411\u6b63\u89e3\u7684\u505a\u6cd5\uff09\u3002\n\n#### Hard Version\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u5728\u4f4e\u4e8e $O(n^2)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u8fd9\u4e00\u7cfb\u5217\u7684\u503c\u3002\n\n$$\\sum\\limits_{x=y}^{n-1}[z^{x+1}](e^z-1)^{x-y+1}=\\sum\\limits_{x=y+1}^n[z^x](e^z-1)^{x-y}$$ \n\n$$=[z^y]\\sum\\limits_{x=y+1}^n(\\frac{e^z-1}z)^{x-y}=[z^y]\\sum\\limits_{x=1}^{n-y}(\\frac{e^z-1}z)^x$$ \n\n\u8bbe $F=\\frac{e^z-1}z$ \uff0c\u73b0\u5728\u6211\u4eec\u60f3\u8981\u5bf9\u6bcf\u4e2a $0\\leq i\\leq n-1$ \uff0c\u6c42\u51fa $[z^i]\\sum\\limits_{k=1}^{n-i}F^k$ \u3002\n\n$$[z^i]\\sum\\limits_{k=1}^{n-i}F^k =[z^i]\\frac 1{1-F}-[z^i]\\frac{F^{n-i+1}}{1-F}$$ \n\n\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u6b21\u591a\u9879\u5f0f\u6c42\u9006\u6c42\u51fa $[z^i]\\frac 1{1-F}$ \uff0c\u73b0\u5728\u53ea\u9700\u5904\u7406\u540e\u9762\u7684\u4e00\u9879\u3002\n\n$$[z^i]\\frac{F^{n-i+1}}{1-F}=[z^{n+1}]\\frac{(zF)^{n-i+1}}{1-F}$$ \n\n\u8bbe $w(z)=zF(z)$ \uff0c$\\phi (z)$ \u6ee1\u8db3 $\\frac{w(z)}{\\phi (w(z))}=z$ \uff0c\u5219 $\\frac{zF(z)}{\\phi (w(z))}=z$ \uff0c\u5373 $F=\\phi (w)$ \n\n\u539f\u5f0f $=[z^{n+1}u^{n-i+1}]\\sum\\limits_{k=0}^\\infty \\frac{(uzF)^k}{1-F}=[z^{n+1}u^{n-i+1}] \\frac 1{1-\\phi (w)}\\frac 1{1-uw}$ \n\n\u7531\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u53ef\u5f97\n\n$$=[u^{n-i+1}]\\frac 1{n+1} [z^n] ((\\frac 1{1-\\phi z}\\frac 1{1-uz})'\\cdot \\phi (z)^{n+1})$$ \n\n$$=\\frac 1{n+1} [z^nu^{n-i+1}] (\\phi (z)^{n+1}\\frac{u+\\phi'(z)-u\\phi(z)-uz\\phi'(z)}{(1-\\phi (z))^2(1-uz)^2})$$\n\n$$=\\frac 1{n+1} [z^nu^{n-i+1}] (\\phi(z)^{n+1}(\\frac {u}{(1-\\phi (z))(1-uz)^2}+\\frac {\\phi'(z)}{(1-\\phi (z))^2(1-uz)}))$$ \n\n$$=\\frac 1{n+1}[z^nu^{n-i+1}](\\phi (z)^{n+1}(\\frac 1{1-\\phi(z)}\\sum\\limits_{k=0}^\\infty (k+1)z^ku^{k+1}+\\frac{\\phi'(z)}{(1-\\phi (z))^2}\\sum\\limits_{k=0}^\\infty z^ku^k))$$ \n\n$$=\\frac 1{n+1}[z^n](\\phi (z)^{n+1}(\\frac{(n-i+1)z^{n-i}}{1-\\phi (z)}+\\frac{\\phi'(z)z^{n-i+1}}{(1-\\phi(z))^2}))$$\n\n$$=\\frac 1{n+1}([z^i](\\phi(z)^{n+1}\\frac{n-i+1}{1-\\phi(z)})+[z^{i-1}](\\phi(z)^{n+1}\\frac{\\phi'(z)}{(1-\\phi(z))^2}))$$\n\n\u6211\u4eec\u53ef\u4ee5\u5728 $O(n\\log n)\\ \\sim \\ O(n\\log ^2n)$ \u7684\u65f6\u95f4\u5185\uff08\u53d6\u51b3\u4e8e\u4f60\u5982\u4f55\u6c42\u591a\u9879\u5f0fexp\uff09\u6c42\u51fa $\\phi(z)^{n+1}\\frac{n-i+1}{1-\\phi(z)}$ \u548c $\\phi(z)^{n+1}\\frac{\\phi'(z)}{(1-\\phi(z))^2}$ \uff0c\u4ece\u800c\u5f97\u51fa\u7b54\u6848\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a $O(n\\log n)\\ \\sim\\ O(n\\log ^2n) $\u3002\n\nProblem and Tutorial by he_____he\n\nSolution(Hard Version) by Elegia\n\nEasy Version Code:\n\n```cpp\n#include<bits/stdc++.h>\n\n#define pb push_back\n#define mp make_pair\n#define fi first\n#define se second\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int> pii;\ntypedef pair<ll,ll> pll;\n\ntemplate <typename T> bool chkmax(T &x,T y){return x<y?x=y,true:false;}\ntemplate <typename T> bool chkmin(T &x,T y){return x>y?x=y,true:false;}\n\nint readint(){\n\tint x=0,f=1; char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\n\nconst int cys=998244353;\nint n;\nll fac[5005],inv[5005],d[5005][5005],ans[5005];\n\nll qpow(ll x,ll p){\n\tll ret=1;\n\tfor(;p;p>>=1,x=x*x%cys) if(p&1) ret=ret*x%cys;\n\treturn ret;\n}\n\nint main(){\n\tn=readint();\n\td[0][0]=fac[0]=inv[0]=1;\n\tfor(int i=1;i<=n;i++) fac[i]=fac[i-1]*i%cys;\n\tinv[n]=qpow(fac[n],cys-2);\n\tfor(int i=n-1;i>=1;i--) inv[i]=inv[i+1]*(i+1)%cys;\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=i;j++) d[i][j]=(d[i-1][j-1]*(i-j+1)+d[i-1][j]*j)%cys;\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n;j++) ans[i]=(ans[i]+d[j][i]*inv[j])%cys;\n\tfor(int i=1;i<=n;i++) printf(\"%lld \",ans[i]*fac[n]%cys);\n\tprintf(\"\\n\");\n\treturn 0;\n}\n```\nHard Version Code:\n\n```cpp\n#include<bits/stdc++.h>\n\n#define pb push_back\n#define mp make_pair\n#define fi first\n#define se second\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef vector<ll> vi;\ntypedef pair<int,int> pii;\ntypedef pair<ll,ll> pll;\n\ntemplate <typename T> bool chkmax(T &x,T y){return x<y?x=y,true:false;}\ntemplate <typename T> bool chkmin(T &x,T y){return x>y?x=y,true:false;}\n\nint readint(){\n\tint x=0,f=1; char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\n\nconst int cys=998244353,g=3,invg=(cys+1)/3;\nint n;\nll ni[200015],fac[200015],inv[200015],tw[200005];\n\nint mod(int x){return x>=cys?x-cys:x;}\n\nll qpow(ll x,ll p){\n\tll ret=1;\n\tfor(;p;p>>=1,x=x*x%cys) if(p&1) ret=ret*x%cys;\n\treturn ret;\n}\n\nvi operator+(vi a,vi b){\n\tvi ret(max(a.size(),b.size()));\n\tfor(int i=0;i<ret.size();i++) ret[i]=mod((i<a.size()?a[i]:0)+(i<b.size()?b[i]:0));\n\treturn ret;\n}\n\nvi operator-(vi a,vi b){\n\tvi ret(max(a.size(),b.size()));\n\tfor(int i=0;i<ret.size();i++) ret[i]=mod((i<a.size()?a[i]:0)+cys-(i<b.size()?b[i]:0));\n\treturn ret;\n}\n\nvi operator*(vi a,ll b){\n\tfor(int i=0;i<a.size();i++) a[i]=1ll*a[i]*b%cys;\n\treturn a;\n}\n\nvi operator>>(vi a,int b){\n\tfor(int i=0;i<a.size()-b;i++) a[i]=a[i+b];\n\ta.resize(a.size()-b);\n\treturn a;\n}\n\nnamespace poly{\n\tint N,l;\n\tint A[1100000],B[1100000],r[1100000],pre1[20][600000],pre2[20][600000];\n\tvoid pre(){\n\t\tfor(int i=1,r=0;i<(1<<19);i<<=1,r++){\n\t\t\tint w=1,wn=qpow(g,(cys-1)/(i<<1));\n\t\t\tfor(int j=0;j<i;j++,w=1ll*w*wn%cys) pre1[r][j]=w;\n\t\t}\n\t\tfor(int i=1,r=0;i<(1<<19);i<<=1,r++){\n\t\t\tint w=1,wn=qpow(invg,(cys-1)/(i<<1));\n\t\t\tfor(int j=0;j<i;j++,w=1ll*w*wn%cys) pre2[r][j]=w;\n\t\t}\n\t}\n\tvoid ntt(int *A,int N,int f){\n\t\tfor(int i=0;i<N;i++) if(i<r[i]) swap(A[i],A[r[i]]);\n\t\tfor(int i=1,r=0;i<N;i<<=1,r++){\n\t\t\tfor(int j=0;j<N;j+=(i<<1)){\n\t\t\t\tfor(int k=j;k<j+i;k++){\n\t\t\t\t\tint x=A[k],y=1ll*A[k+i]*(f>0?pre1[r][k-j]:pre2[r][k-j])%cys;\n\t\t\t\t\tA[k]=mod(x+y); A[k+i]=mod(x+cys-y);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(f<0){\n\t\t\tint invn=qpow(N,cys-2);\n\t\t\tfor(int i=0;i<N;i++) A[i]=1ll*A[i]*invn%cys;\n\t\t}\n\t}\n\tvoid init(int t){\n\t\tN=1,l=0;\n\t\tfor(;N<t;N<<=1) l++;\n\t\tfor(int i=0;i<N;i++) r[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n\t}\n\tvoid getmul(){\n\t\tntt(A,N,1); ntt(B,N,1);\n\t\tfor(int i=0;i<N;i++) A[i]=1ll*A[i]*B[i]%cys;\n\t\tntt(A,N,-1);\n\t}\n\tvi mul(vi a,vi b){\n\t\tinit(a.size()+b.size());\n\t\tfor(int i=0;i<N;i++) A[i]=i<a.size()?a[i]:0;\n\t\tfor(int i=0;i<N;i++) B[i]=i<b.size()?b[i]:0;\n\t\tgetmul();\n\t\tvi ret(a.size()+b.size()-1);\n\t\tfor(int i=0;i<ret.size();i++) ret[i]=A[i];\n\t\treturn ret;\n\t}\n\tvi polyinv(vi a,int l){\n\t\tif(l==1) return vi(1,qpow(a[0],cys-2));\n\t\ta.resize(l);\n\t\tvi b=polyinv(a,(l+1)/2);\n\t\tinit(l<<1);\n\t\tfor(int i=0;i<N;i++) A[i]=i<l?a[i]:0;\n\t\tfor(int i=0;i<N;i++) B[i]=i<(l+1)/2?b[i]:0;\n\t\tntt(A,N,1); ntt(B,N,1);\n\t\tfor(int i=0;i<N;i++) A[i]=1ll*A[i]*B[i]%cys*B[i]%cys;\n\t\tntt(A,N,-1);\n\t\tvi t=b*2;\n\t\tt.resize(l);\n\t\tfor(int i=0;i<l;i++) t[i]=mod(t[i]+cys-A[i]);\n\t\treturn t;\n\t}\n\tvi polydiff(vi a){\n\t\tfor(int i=0;i<a.size()-1;i++) a[i]=1ll*(i+1)*a[i+1]%cys;\n\t\ta.resize(a.size()-1);\n\t\treturn a;\n\t}\n\tvi polyint(vi a){\n\t\ta.resize(a.size()+1);\n\t\tfor(int i=a.size()-1;i>=1;i--) a[i]=1ll*a[i-1]*ni[i]%cys;\n\t\ta[0]=0;\n\t\treturn a;\n\t}\n\tvi polyln(vi a,int l){\n\t\treturn polyint(mul(polydiff(a),polyinv(a,l)));\n\t}\n\tvi polyexp(vi a,int l){\n\t\tif(l==1) return vi(1,1);\n\t\ta.resize(l);\n\t\tvi b=polyexp(a,(l+1)/2);\n\t\tinit(l<<1);\n\t\tvi t=mul(b,vi(1,1)-polyln(b,l)+a);\n\t\tt.resize(l);\n\t\treturn t;\n\t}\n\tvi polypow(vi a,int l,int k){\n\t\treturn polyexp(polyln(a,l)*k,l);\n\t}\n}\n\nvi getans(){\n\tvi f(0);\n\tfor(int i=0;i<=n+1;i++) f.push_back(inv[i+1]);\n\tvi tmp=poly::mul(f,poly::polyinv((vi(1,1)-f)>>1,n+1));\n\tvi tw(0); tw.resize(n);\n\tfor(int i=0;i<n;i++) tw[i]=tmp[i+1];\n\tvi h(0);\n\th.push_back(1),h.push_back(1);\n\th=poly::polyinv(poly::polyln(h,n+3)>>1,n+2);\n\tvi g=poly::polyinv((vi(1,1)-h)>>1,n+1);\n\tvi ph=poly::polypow(h,n+1,n+1);\n\tvi t1=poly::mul(g,ph);\n\tvi tmp1=poly::mul(poly::polydiff(h),ph);\n\ttmp1.resize(n+1);\n\tvi tmp2=poly::mul(g,g);\n\ttmp2.resize(n+1);\n\tvi t2=poly::mul(tmp1,tmp2);\n\tfor(int i=0;i<n;i++) tw[i]=mod(tw[i]+cys-ni[n+1]*mod(t1[i+1]*(n-i+1)%cys+t2[i+1])%cys);\n\tfor(int i=0;i<n;i++) tw[i]=tw[i]*fac[i]%cys;\n\treverse(tw.begin(),tw.end());\n\ttmp.clear();\n\tfor(int i=0;i<n;i++) tmp.push_back(i&1?cys-inv[i]:inv[i]);\n\ttw=poly::mul(tw,tmp);\n\ttw.resize(n);\n\treverse(tw.begin(),tw.end());\n\treturn tw;\n}\n\nint main(){\n\tpoly::pre();\n\tn=readint();\n\tfac[0]=inv[0]=1;\n\tfor(int i=1;i<=n+5;i++) fac[i]=fac[i-1]*i%cys;\n\tinv[n+5]=qpow(fac[n+5],cys-2);\n\tfor(int i=n+4;i>=1;i--) inv[i]=inv[i+1]*(i+1)%cys;\n\tfor(int i=1;i<=n+5;i++) ni[i]=inv[i]*fac[i-1]%cys;\n\tvi res=getans();\n\tfor(int i=0;i<n;i++) printf(\"%lld \",res[i]*fac[n]%cys*inv[i]%cys);\n\tprintf(\"\\n\");\n\treturn 0;\n}\n```\n",
        "postTime": 1588178223,
        "uid": 31098,
        "name": "Caro23333",
        "ccfLevel": 8,
        "title": "Codeforces Round #641 Div1.F Slime and Sequences \u4e2d\u6587\u9898\u89e3"
    },
    {
        "content": "# \u9898\u76ee\u63cf\u8ff0\n\u5b9a\u4e49\u4e00\u4e2a\u6b63\u6574\u6570\u5e8f\u5217\u4e3a\u597d\u5e8f\u5217\uff0c\u5f53\u4e14\u4ec5\u5f53\u5982\u679c\u67d0\u4e2a\u6570 $k$ \u51fa\u73b0\u8fc7\uff0c\u90a3\u4e48\u4e00\u5b9a\u6709 $k-1$ \u5728\u6700\u540e\u4e00\u4e2a $k$ \u7684\u524d\u9762\u51fa\u73b0\u8fc7\u3002\n\n\u5bf9\u4e8e\u6240\u6709 $i\\in[1,n]$\uff0c\u6c42\u51fa $i$ \u5728\u6240\u6709\u597d\u5e8f\u5217\u4e2d\u51fa\u73b0\u6b21\u6570\u7684\u548c\n\n`Easy Version`:$n\\leq 5000$\n\n`Hard Version`:$n\\leq 10^5$ \n  \n# \u9898\u89e3\n\n\u9886\u7565\u5230\u4e86\u56fd\u9645\u8ba1\u6570\u9876\u5c16\u6c34\u5e73\u3002\u3002\n\n## \u95ee\u9898\u8f6c\u5316\n\n\u6709\u91cd\u590d\u5143\u7d20\u7684\u6b63\u6574\u6570\u5e8f\u5217\u4e0d\u597d\u7edf\u8ba1\uff0c\u6211\u4eec\u8bd5\u56fe\u5c06\u5b83\u6620\u5c04\u5230\u6392\u5217\u4e0a\n\n\u6211\u4eec\u6784\u5efa\u4e00\u4e2a\u6392\u5217 $p$\uff0c\u5728\u76f8\u90bb\u4e24\u4e2a\u6570\u5b57\u4e4b\u95f4\u586b\u5165\u4e0d\u7b49\u53f7\uff0c\u8bbe $p_{1\\dots i}$ \u4e2d\u5171\u6709 $num_i$ \u4e2a\u5c0f\u4e8e\u53f7\uff0c\u6211\u4eec\u5c06\u5b83\u6620\u5c04\u5230 $a$ \u5e8f\u5217\uff1a$a_{p_i}=num_i+1$\uff0c\u5219 $a$ \u662f\u4e00\u4e2a\u597d\u5e8f\u5217\n\n\u8bc1\u660e\u5982\u4e0b\uff1a\u8bbe $i$ \u4e3a\u4e00\u4e2a\u5c0f\u4e8e\u53f7\u53f3\u8fb9\u7684\u4f4d\u7f6e\uff0c\u5219 $num_{i-1}+1=num_i$\uff0c\u5373 $a_{p_{i-1}}+1=a_{p_i}$\uff0c\u800c\u7531\u4e8e\u662f\u5c0f\u4e8e\u53f7\uff0c\u6240\u4ee5 $p_{i-1}<p_i$\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u6b63\u662f\u9898\u76ee\u4e2d\u8981\u6c42\u7684\u9650\u5236\n\n\u800c\u5bf9\u4e8e\u4e00\u4e2a\u597d\u5e8f\u5217\uff0c\u6211\u4eec\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u6570\u503c\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6570\u503c\uff0c\u6211\u4eec\u5c06\u5b83\u6240\u5728\u7684\u6240\u6709\u4e0b\u6807\u4ece\u5927\u5230\u5c0f\u653e\u5230\u6570\u5217\u7684\u540e\u9762\uff08\u521d\u59cb\u6570\u5217\u4e3a\u7a7a\uff09\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4ece\u597d\u5e8f\u5217\u5230\u6392\u5217\u7684\u6620\u5c04\n\n\u5219\u5bb9\u6613\u53d1\u73b0\uff0c\u8fd9\u662f\u4e00\u4e2a\u53cc\u5c04\u5173\u7cfb\n\n## \u6392\u5217\u7ec4\u5408\u63a8\u5bfc\n\n\u8fd9\u91cc\u5f15\u5165\u6b27\u62c9\u6570\uff1a$\\left<\\begin{matrix}n\\\\k\\end{matrix}\\right>$ \u8868\u793a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\u4e2d\uff0c\u76f8\u90bb\u6570\u5b57\u4e4b\u95f4\u7684\u5c0f\u4e8e\u53f7\u6570\u76ee\u4e3a $k$ \u7684\u65b9\u6848\u6570\n\n\u8bbe $ans_k$ \u4e3a\u6570\u5b57 $k+1$ \u7684\u7b54\u6848\n\n\u5219 $ans_k=\\sum\\limits_{i=\\max(k,1)}^n\\left<\\begin{matrix}i\\\\k\\end{matrix}\\right>\\dbinom ni(n-i)!$\n\n\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6211\u4eec\u679a\u4e3e\u4ea7\u751f\u597d\u5e8f\u5217\u4e2d $k+1$ \u8fd9\u4e2a\u6570\u5b57\u7684\u4f4d\u7f6e\uff0c\u5219\u524d $i$ \u4e2a\u6570\u4e2d\u9700\u8981\u6709 $k$ \u4e2a\u5c0f\u4e8e\u53f7\uff0c\u6211\u4eec\u518d\u7ed9\u524d $i$ \u4e2a\u6570\u5206\u914d\u6807\u53f7\uff0c\u5269\u4e0b\u7684 $n-i$ \u4e2a\u6570\u968f\u610f\u6392\u5217\n\n\u53ef\u662f\u8fd9\u4e2a\u7b97\u7684\u662f\u6392\u5217\u65b9\u6848\u6570\uff0c\u800c\u4e14\u8fd8\u7b97\u91cd\u4e86\n\n\u6211\u4eec\u8003\u8651\u8bc1\u660e\u7b97\u91cd\u7684\u6b21\u6570\u5c31\u7b49\u4e8e\u8be5\u65b9\u6848\u4e2d $k+1$ \u7684\u51fa\u73b0\u6b21\u6570\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u6392\u5217\uff0c\u5b83\u88ab\u8ba1\u7b97\u5f53\u4e14\u4ec5\u5f53 $i$ \u5728\u7b2c $k$ \u4e2a\u5c0f\u4e8e\u53f7\u548c\u7b2c $k+1$ \u4e2a\u5c0f\u4e8e\u53f7\u4e4b\u95f4\uff0c\u800c\u8fd9\u6070\u597d\u5c31\u662f $k+1$ \u7684\u51fa\u73b0\u6b21\u6570\n\n$O(n^2)$ \u9012\u63a8\u6b27\u62c9\u6570\u5373\u53ef\u901a\u8fc7 `Easy Version`\n\n## \u4f18\u5316\n\n\u6211\u4eec\u5047\u88c5\u4e0d\u4f1a\u6b27\u62c9\u6570\u7684\u901a\u9879\u5f0f\uff08\u5176\u5b9e\u662f\u56e0\u4e3a\u5b83\u7684\u901a\u9879\u5f0f\u4e0d\u5bb9\u6613\u7ee7\u7eed\u4f18\u5316\uff1f\uff09\uff0c\u4f7f\u7528\u5bb9\u65a5\u4ee3\u66ff\u6389\u6b27\u62c9\u6570\n\n\u8bbe $\\begin{vmatrix}n\\\\k\\end{vmatrix}$ \u8868\u793a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\uff0c\u81f3\u5c11\u6709 $k$ \u4e2a\u5c0f\u4e8e\u53f7\u7684\u65b9\u6848\u6570\n\n\u5bb9\u6613\u53d1\u73b0\uff0c$\\begin{vmatrix}n\\\\k\\end{vmatrix}=\\sum\\limits_{i=k}^n\\dbinom ik\\left<\\begin{matrix}n\\\\i\\end{matrix}\\right>$\n\n\u4e8c\u9879\u5f0f\u53cd\u6f14\u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\uff1a$\\left<\\begin{matrix}n\\\\k\\end{matrix}\\right>=\\sum\\limits_{i=k}^n(-1)^{i-k}\\dbinom ik\\begin{vmatrix}n\\\\i\\end{vmatrix}$\n\n\u8003\u8651\u8ba1\u7b97 $\\begin{vmatrix}n\\\\k\\end{vmatrix}$\uff0c\u6211\u4eec\u5c06\u5c0f\u4e8e\u53f7\u89c6\u4e3a\u4e00\u6761\u8fb9\uff0c\u5219\u81f3\u5c11\u6709 $n-k$ \u4e2a\u8fde\u901a\u5757\uff0c\u8fd9\u4e9b\u8fde\u901a\u5757\u5185\u7684\u987a\u5e8f\u662f\u786e\u5b9a\u7684\uff0c\u56e0\u4e3a\u662f\u7528\u5c0f\u4e8e\u53f7\u8fde\u63a5\u7684\n\n\u7531\u4e8e\u662f\u6392\u5217\u95ee\u9898\uff0c\u5219\u7b54\u6848\u4e3a\u6bcf\u4e2a\u5757\u7684 $\\mathbf{EGF}$ \u5377\u8d77\u6765\n\n\u6bcf\u4e2a\u5757\u7684 $\\mathbf{EGF}$ \u4e3a $\\mathbf{EGF\\{[0,1,1,\\cdots]\\}}=e^x-1$\uff0c\u4e3a\u4ec0\u4e48\u5e38\u6570\u9879\u4e3a $0$\uff1f\u4e00\u4e2a\u5757\u81f3\u5c11\u8981\u6709\u4e00\u4e2a\u6570\u5b57\u561b\n\n\u5219 $\\begin{vmatrix}n\\\\k\\end{vmatrix}=n![x^n](e^x-1)^{n-k}$\n\n\u4ee3\u5165\u53ef\u5f97\uff08$ans_0$ \u7279\u5224\u4e00\u4e0b\uff0c\u4e0b\u9762\u5c31\u6ca1\u6709 $\\max(k,1)$\u4e86\uff09\uff1a\n\n$$\\begin{aligned}\n\nans_k&=\\sum\\limits_{i=k}^n\\dbinom ni(n-i)!\\sum\\limits_{j=k}^i(-1)^{j-k}\\dbinom jki![x^i](e^x-1)^{i-j}\\\\\n\n&=\\sum\\limits_{i=k}^n\\dbinom ni(n-i)!i!\\sum\\limits_{j=k}^i(-1)^{j-k}\\dbinom jk[x^i](e^x-1)^{i-j}\\\\\n\n&=n!\\sum\\limits_{i=k}^n\\sum\\limits_{j=k}^i(-1)^{j-k}\\dbinom jk[x^i](e^x-1)^{i-j}\\\\\n\n&=n!\\sum\\limits_{j=k}^n(-1)^{j-k}\\dbinom jk\\sum\\limits_{i=j}^n[x^i](e^x-1)^{i-j}\\\\\n\n&=\\dfrac{n!}{k!}\\sum\\limits_{j=k}^n\\dfrac{(-1)^{j-k}j!}{(j-k)!}\\sum\\limits_{i=j}^n[x^i](e^x-1)^{i-j}\\\\\n\n\\end{aligned}$$\n\n\u8bbe $R_j=\\sum\\limits_{i=j}^n[x^i](e^x-1)^{i-j}$\n\n$$\\begin{aligned}\n\nans_k&=\\dfrac{n!}{k!}\\sum\\limits_{j=k}^n\\dfrac{(-1)^{j-k}j!}{(j-k)!}R_j\\\\\n\n&=\\dfrac{n!}{k!}\\sum\\limits_{j=k}^n\\dfrac{(-1)^{j-k}}{(j-k)!}\\times R_j\\cdot j!\n\n\\end{aligned}$$\n\n---\n\n\u8fd9\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5377\u79ef\uff0c\u6c42\u6cd5\u53c2\u89c1[\u5173\u4e8e\u4e00\u7c7b\u7279\u6b8a\u5377\u79ef\u7684\u6c42\u6cd5](https://www.cnblogs.com/s-z-q/p/13347914.html)\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u51fa\u5e8f\u5217 $R$\n\n\u6211\u4eec\u53d1\u73b0 $R_k$ \u7684\u5b9a\u4e49\u5f0f\u5f88\u96be\u770b\uff0c\u6bcf\u4e00\u6b21\u53d6\u7684\u7cfb\u6570\u90fd\u4e0d\u662f\u540c\u4e00\u9879\u7684\uff0c\u628a\u5b83\u6539\u5f97\u6f02\u4eae\u4e00\u70b9\uff1a\n\n$$\\begin{aligned}\n\nR_k&=\\sum\\limits_{i=k}^n[x^i](e^x-1)^{i-k}\\\\\n\n&=\\sum\\limits_{i=k}^n[x^k](\\dfrac{e^x-1}x)^{i-k}\\\\\n\n&=\\sum\\limits_{i=0}^{n-k}[x^k](\\dfrac{e^x-1}{x})^i\n\n\\end{aligned}$$\n\n\u628a\u5b83\u5316\u6210\u5c01\u95ed\u5f62\u5f0f\uff0c\u8bbe $F(x)=\\dfrac{e^x-1}{x}$\uff1a\n\n$$\\begin{aligned}\n\nR_k&=\\sum\\limits_{i=0}^{n-k}[x^k]F^i(x)\\\\\n\n&=[x^k]\\left(\\dfrac{1-F^{n-k+1}(x)}{1-F(x)}\\right)\\\\\n\n&=[x^k]\\dfrac{1}{1-F(x)}-[x^k]\\dfrac{F^{n-k+1}(x)}{1-F(x)}\n\n\\end{aligned}$$\n\n---\n\n\n\u5bf9\u4e8e\u524d\u4e00\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u591a\u9879\u5f0f\u6c42\u9006\uff0c\u4f46\u662f\u53d1\u73b0\u5206\u6bcd\u5e38\u6570\u9879\u4e3a $0$\uff0c\u4e0d\u80fd\u76f4\u63a5\u6c42\u9006\n\n\u90a3\u600e\u4e48\u505a\u5462\uff1f\u6211\u4eec\u8f6c\u4e3a\u6c42 $\\dfrac{1}{(1-F(x))\\cdot x^{-1}}\\cdot x^{-1}$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u5e38\u6570\u9879\u4e3a $0$ \u7684\u95ee\u9898\u4e86\uff08\u7531\u4e8e\u8be5\u5f0f\u4e2d\u5206\u6bcd\u4e00\u6b21\u9879\u4e0d\u4e3a $0$\uff0c\u6240\u4ee5\u4e58\u4e0a $x^{-1}$ \u8868\u793a\u5de6\u79fb\u4e00\u4f4d\uff09\n\n\u5bf9\u4e8e\u6b63\u786e\u6027\u7684\u8bf4\u660e\uff0c\u9700\u8981\u5f15\u5165\u62bd\u8c61\u4ee3\u6570\u4e2d\u7684\u5206\u5f0f\u73af\uff08\u5206\u5f0f\u57df\uff09\u6982\u5ff5\uff0c\u4e0d\u5c55\u5f00\u4e86\uff0c\u53ef\u4ee5\u767e\u5ea6\u641c\u7d22\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u5b66\u4e60\u4e00\u4e0b\n\n---\n\n\u5219\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u540e\u4e00\u9879\u5c31\u505a\u5b8c\u4e86\uff0c\u8bbe $S_k=[x^k]\\dfrac{F^{n-k+1}(x)}{1-F(x)}$\n\n\u6211\u4eec\u53d1\u73b0 $S_k$ \u5f88\u4e0d\u4f18\u7f8e\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $k$\uff0c\u5b83\u7684\u591a\u9879\u5f0f\u957f\u5f97\u90fd\u4e0d\u4e00\u6837\uff0c\u8fd9\u6837\u6211\u4eec\u4e0d\u53ef\u80fd\u5728\u4f4e\u4e8e $O(n^2)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5f15\u5165\u4e00\u4e2a\u65b0\u7684\u9650\u5236 $y$\uff0c\u5e76\u6d88\u9664 $x$ \u7684\u5f71\u54cd\uff1a\n\n$$\\begin{aligned}\n\nS_k&=[x^k]\\dfrac{F^{n-k+1}(x)}{1-F(x)}\\\\\n\n&=[x^{n+1}]\\dfrac{(xF(x))^{n-k+1}}{1-F(x)}\\\\\n\n&=[x^{n+1}y^{n-k+1}]\\sum\\limits_{i=0}^{\\infty}\\dfrac{(xF(x))^{i}}{1-F(x)}\\\\\n\n&=[x^{n+1}y^{n-k+1}]\\dfrac{1}{1-F(x)}\\cdot\\dfrac{1}{1-xF(x)y}\\\\\n\n\\end{aligned}$$\n\n---\n\n\u5373\u6c42\u51fa\u53f3\u9762\u591a\u9879\u5f0f $[x^{n+1}]$ \u9879\u5173\u4e8e $y$ \u7684\u591a\u9879\u5f0f\uff0c\u5bb9\u6613\u8054\u60f3\u5230\u591a\u9879\u5f0f\u590d\u5408\u79d1\u6280\n\n\u4f46\u662f\u4e0d\u592a\u884c\uff0c\u56e0\u4e3a $1-xF(x)y$ \u4e2d\u4e0d\u4ec5\u6709 $F(x)$ \u8fd8\u6709 $x$\n\n\u8003\u8651\u6784\u9020\u4e24\u4e2a\u51fd\u6570 $H(x),W(x)$\uff0c\u4f7f\u5f97 $H(W(x))=\\dfrac{1}{1-F(x)}\\cdot\\dfrac{1}{1-xF(x)y}$\n\n\u518d\u6784\u9020\u4e00\u4e2a\u51fd\u6570 $G(x)$\uff0c\u4f7f\u5f97 $G(W(x))=x$\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u6269\u5c55\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u6c42\u89e3\u4e86\n\n---\n\n\u6784\u9020\u5982\u4e0b\uff1a\n\n$W(x)=xF(x)$\n\n\u8bbe $M(W(x))=F(x)$\uff0c\u5373\u6211\u4eec\u4f7f\u7528 $M(x)$ \u548c $W(x)$ \u590d\u5408\u6765\u6d88\u9664 $W(x)$ \u4e2d\u7684 $x$\n\n\u5219 $\\dfrac{1}{1-F(x)}\\cdot\\dfrac{1}{1-xF(x)y}=\\dfrac{1}{1-M(W(x))}\\cdot\\dfrac{1}{1-W(x)y}$\n\n\u82e5\u8981\u4f7f\u5f97 $H(W(x))=\\dfrac{1}{1-F(x)}\\cdot\\dfrac{1}{1-xF(x)y}$\uff0c\u8054\u7cfb\u4e0a\u4e00\u4e2a\u5f0f\u5b50\uff0c\u5bb9\u6613\u6784\u9020\u51fa $H(x)=\\dfrac{1}{1-M(x)}\\cdot \\dfrac{1}{1-xy}$\n\n\u6700\u540e\u662f $G(x)$\uff0c\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c$G(x)=\\dfrac{x}{M(x)}$\uff0c\u56e0\u4e3a\u6b64\u65f6 $G(W(x))=\\dfrac{xF(x)}{F(x)}=x$\n\n---\n\n\u4ee5\u4e0a\uff0c\u6211\u4eec\u6784\u9020\u51fa\u4e86\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u6240\u9700\u7684\u6240\u6709\u51fd\u6570\uff0c\u76f4\u63a5\u5957\u7528\u6269\u5c55\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u516c\u5f0f\u53ef\u5f97\uff1a\n\n$$[x^{n+1}]H(W(x))=\\dfrac1{n+1}[x^n]H'(x)\\left(\\dfrac{x}{G(x)}\\right)^{n+1}$$\n\n\u66b4\u529b\u8ba1\u7b97 $H'(x)=\\dfrac{y(1-M(x))+(1-xy)M'(x)}{(1-M(x))^2(1-xy)^2}$\uff0c\u4ee3\u5165\uff1a\n\n$$\\begin{aligned}\n\n[x^{n+1}]H(W(x))&=\\dfrac1{n+1}[x^n]\\dfrac{y(1-M(x))+(1-xy)M'(x)}{(1-M(x))^2(1-xy)^2}\\cdot M^{n+1}(x)\\\\\n\n&=\\dfrac1{n+1}[x^n]\\left(\\dfrac{y}{(1-M(x))(1-xy)^2}+\\dfrac{M'(x)}{(1-M(x))^2(1-xy)}\\right)\\cdot M^{n+1}(x)\n\n\\end{aligned}$$\n\n\u5199\u5230\u8fd9\u91cc\uff0c\u516c\u5f0f\u5df2\u7ecf\u4e0d\u80fd\u770b\u4e86 qwq\uff0c\u6211\u4eec\u628a\u5173\u4e8e $y$\u7684\u5c01\u95ed\u5f62\u5f0f\u5c55\u5f00\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u63d0\u53d6\u51fa $y$ \u7684\u67d0\u4e00\u9879\u5566\n\n$$\\begin{aligned}\n\n[x^{n+1}]H(W(x))&=\\dfrac1{n+1}[x^n]\\left(\\dfrac1{1-M(x)}\\sum\\limits_{i=0}^{\\infty}(i+1)x^iy^{i+1}+\\dfrac{M'(x)}{(1-M(x))^2}\\sum\\limits_{i=0}^{\\infty}x^iy^i\\right)\\cdot M^{n+1}(x)\\\\\n\n\\end{aligned}$$\n\n\u6211\u4eec\u63d0\u53d6\u51fa\u7b2c $m$ \u9879\uff08$S_k$ \u9700\u8981\u7684\u5373\u7b2c $n-k+1$ \u9879\uff09\uff1a\n\n$$\\begin{aligned}\n\n&\\dfrac1{n+1}[x^ny^m]\\left(\\dfrac1{1-M(x)}\\sum\\limits_{i=0}^{\\infty}(i+1)x^iy^{i+1}+\\dfrac{M'(x)}{(1-M(x))^2}\\sum\\limits_{i=0}^{\\infty}x^iy^i\\right)\\cdot M^{n+1}(x)\\\\\n\n=&\\dfrac1{n+1}[x^n]\\left(\\dfrac{mx^{m-1}}{1-M(x)}+\\dfrac{M'(x)x^m}{(1-M(x))^2}\\right)\\cdot M^{n+1}(x)\\\\\n\n=&\\dfrac1{n+1}\\left([x^{n-m+1}]m\\dfrac{M^{n+1}(x)}{1-M(x)}+[x^{n-m}]\\dfrac{M'(x)M^{n+1}(x)}{(1-M(x))^2}\\right)\n\n\\end{aligned}$$\n\n\u53d1\u73b0\u51fa\u73b0\u4e86\u548c\u4e0a\u9762\u540c\u6837\u7684\u95ee\u9898\uff1a\u5206\u6bcd\u7684\u5e38\u6570\u9879\u4e3a $0$\uff0c\u6211\u4eec\u540c\u4e0a\u9762\u4e00\u6837\u8f6c\u5316\u4e00\u4e0b\uff1a\n\n$$=\\dfrac1{n+1}[x^{n-m+2}]\\left(m\\dfrac{M^{n+1}(x)}{(1-M(x))x^{-1}}+\\dfrac{M'(x)M^{n+1}(x)}{((1-M(x))x^{-1})^2}\\right)$$\n\n\u7a81\u7136\u53d1\u73b0\u6211\u4eec\u8fd8\u6ca1\u6709\u6c42 $M(x)=\\dfrac x{G(x)}$\n\n$G(W(x))=G(e^x-1)=x$\uff0c\u5bb9\u6613\u6784\u9020\u51fa $G(x)=\\ln(x+1)$\n\n\u5219 $M(x)=\\dfrac x{\\ln(x+1)}$\n\n\u6700\u7ec8\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\n\n\u771f\u662f\u4e00\u9053\u4f11\u95f2\u7684\u597d\u9898\u5462\n\n\u4ee3\u7801\u7684\u591a\u9879\u5f0f\u677f\u5b50\u53ef\u4ee5\u53c2\u7167\u6211\u535a\u5ba2\u7f6e\u9876\u7684[\u591a\u9879\u5f0f\u5168\u5bb6\u6876](https://www.luogu.com.cn/blog/Songziqing/duo-xiang-shi-quan-jia-tong)\n\n```cpp\nint fac[N],ifac[N];\nvoid init(int n)\n{\n\tfac[0] = 1;for(int i = 1;i <= n;i++) fac[i] = (ll)fac[i - 1] * i % mod;\n\tifac[n] = qpow(fac[n],mod - 2);for(int i = n;i;i--) ifac[i - 1] = (ll)ifac[i] * i % mod;\n}\nint n,m,t1[N],t2[N],S[N];\nint H[N],H1[N],H2[N],inv[N];\nint ans[N];\nint main()\n{\n\tn = read(),m = n + 2;init(n + 2);\n\tfor(int i = 0;i < n + 1;i++) t1[i] = mod - ifac[i + 2];\n\tInv(t1,S,n + 1);for(int i = 0;i < n;i++) S[i] = S[i + 1];\n\tmemset(t1,0,sizeof(t1));t1[0] = t1[1] = 1;Ln(t1,t2,m + 2);\n\tfor(int i = 0;i < m + 1;i++) t1[i] = t2[i + 1];\n\tInv(t1,H,m + 1);\n\tPower(H,H1,m + 1,\"\",n + 1);\n\tDer(H,t1,m + 1);Mul(t1,H1,H2,m + 1,m + 1);\n\tfor(int i = 0;i < m;i++) t1[i] = mod - H[i + 1];\n\tInv(t1,inv,m);\n\tMul(H1,inv,H1,m,m),Mul(H2,inv,H2,m,m),Mul(H2,inv,H2,m + 1,m);\n\tint invn = qpow(n + 1,mod - 2);\n\tfor(int k = 0;k < n;k++)\n\t{\n\t\tint m = n - k + 1;\n\t\treduce(S[k] -= ((ll)H1[n - m + 2] * m + H2[n - m + 2]) % mod * invn % mod);\n\t}S[0]--;\n\tmemset(t1,0,sizeof(t1)),memset(t2,0,sizeof(t2));\n\tfor(int i = 0;i < n;i++)\n\t\tif(i & 1) t1[n - i - 1] = mod - ifac[i];\n\t\telse t1[n - i - 1] = ifac[i];\n\tfor(int i = 0;i < n;i++)\n\t\tt2[i] = (ll)S[i] * fac[i] % mod;\n\tMul(t1,t2,ans,n,n);\n\tfor(int i = 0;i < n;i++) pprint((ll)ans[i + n - 1] * ifac[i] % mod * fac[n] % mod);\n\treturn 0;\n}\n```\n",
        "postTime": 1595150778,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1349F2 \u3010Slime and Sequences (Hard Version)\u3011"
    },
    {
        "content": "\u5199\u5728\u524d\u9762\uff1a\n\n- \u4f5c\u8005\u8bda\u631a\u611f\u8c22\u4f20\u5947\u7279\u7ea7\u5927\u5e08 yqiangt \u7684\u503e\u56ca\u76f8\u6388\u3002\n\n- \u672c\u505a\u6cd5\u6bd4\u6240\u6709\u73b0\u6709\u505a\u6cd5\u90fd\u8981 **\u7b80\u5355\u7684\u591a**\u3002\n    - \u524d\u534a\u90e8\u5206\u4e0e\u5176\u4ed6\u9898\u89e3\u76f8\u540c\u3002\u89c9\u5f97\u8bb2\u7684\u70c2\u53ef\u4ee5\u770b\u5176\u4ed6\u7684\u3002\n- \u5f88\u591a\u5730\u65b9\u9700\u8981\u5e7f\u4e49\u6c42\u9006\u504f\u79fb\u7cfb\u6570\u3002\u6ce8\u610f\u3002\n\n___\n\nF1 \u505a\u6cd5\u5de6\u8f6c F1 \u9898\u89e3\u533a\u3002\u6211\u4eec\u76f4\u63a5\u5f00\u59cb\u5904\u7406\u5f0f\u5b50\u3002\n\n$$\n\\text{ans}_i = \\sum_{j=1}^n\\left<\\begin{matrix}j\\\\i-1\\end{matrix}\\right>\\dfrac{n!}{j!}\n$$\n\u201c\u9ed1\u76d2\u201d\u6b27\u62c9\u6570\u662f\u5fc5\u987b\u88ab\u6253\u5f00\u7684\u3002\u8003\u8651\u65b9\u6cd5\u3002\n\n[\u6b27\u62c9\u6570\u677f\u9898](https://www.luogu.com.cn/problem/P5825)\u4e2d\u6211\u4eec\u62e5\u6709\u4e00\u4e2a\u5dee\u5377\u79ef\u7684\u5f0f\u5b50\u3002\u4f46\u76f4\u63a5\u5c06\u5176\u4ee3\u5165\u96be\u4ee5\u5316\u7b80\u3002\n\n\u8003\u8651\u8be5\u5dee\u5377\u79ef\u7684\u63a8\u5bfc\u8fc7\u7a0b\u2014\u2014\u6211\u4eec\u5e0c\u671b\u80fd\u5728\u4e2d\u95f4\u67d0\u4e00\u6b65\u7a81\u7136\u8981\u7d20\u5bdf\u89c9\u3002\n\n\u5f53\u65f6\u7684\u505a\u6cd5\u662f\uff1a\u8bbe\u51fa\u81f3\u5c11 $k$ \u4e2a\u4e0a\u5347\u4ee5\u5bb9\u65a5\u3002\u5bb9\u6613\u77e5\u9053\u8fd9\u4e2a \u81f3\u5c11/\u6070\u597d \u662f **\u4e8c\u9879\u5f0f**\u6f14\u7ece/\u53cd\u6f14 \u7684\u5173\u7cfb\u3002\n\n\u8003\u8651\u7edf\u8ba1\u81f3\u5c11 $k$ \u4e2a\u4e0a\u5347\u7684\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\u4e2a\u6570\uff1a\u6839\u636e\u5957\u8def\uff0c\u6211\u4eec\u8003\u8651 **\u201c\u5757\u201d** \u7684\u7ed3\u6784\u2014\u2014\u201c\u5757\u201d\u662f\u5355\u8c03\u4e0a\u5347\u7684\u5b50\u6bb5\u3002\u5219\u6b64\u65f6\u81f3\u5c11 $k$ \u4e2a\u4e0a\u5347\u7b49\u4ef7\u4e8e\u6709 $n-k$ \u4e2a\u5757\u3002\u4f7f\u7528 EGF \u7ec4\u5408\uff0c\u4e2a\u6570\u5373\u4e3a $[\\dfrac{x^n}{n!}](e^x-1)^{n-k}$\u3002\n\n\u4ee3\u5165\u4e8c\u9879\u5f0f\u53cd\u6f14\u5373\u53ef\u5f97\u5230\u4e00\u4e2a\u6b27\u62c9\u6570\u7684\u901a\u9879\uff0c\u867d\u7136\u5305\u542b\u53d6\u7cfb\u6570\u3002\uff08\u5bfc\u51fa\u5dee\u5377\u79ef\u53ea\u9700\u5c06 $(e^x-1)^{n-k}$ \u5c55\u5f00\u5316\u7b80\u4e8c\u91cd\u548c\u5f0f\uff09\u4f46\u662f\u4e0d\u59a8\u4ee3\u5165\u7b54\u6848\u4e00\u8bd5\u3002\n\n$$\n\\begin{aligned}\n\\text{ans}_i  &= \\sum_{j=1}^n\\dfrac{n!}{j!}\\sum_{k=i-1}^{j-1}(-1)^{k-(i-1)}\\binom{k}{i-1}[\\dfrac{x^j}{j!}](e^x-1)^{j-k}\\\\\n          &= n!\\sum_{k=0}^{n-1}(-1)^{k-i+1}\\binom{k}{i-1}\\sum_{j=k+1}^{n}[x^j](e^x-1)^{j-k}\\\\\n          &= n!\\sum_{k=0}^{n-1}(-1)^{k-i+1}\\binom{k}{i-1}\\sum_{j=1}^{n-k}[x^k]\\left(\\dfrac{e^x-1}{x}\\right)^j\n\\end{aligned}\n$$\n\u9a7b\u8db3\u89c2\u5bdf\u3002\u6b64\u65f6\u524d\u540e\u4e24\u4e2a $\\sum$ \u51e0\u4e4e\u5b8c\u5168\u5272\u88c2\u2014\u2014\u540e\u4e00\u4e2a\u4e2d\u751a\u81f3\u6ca1\u6709\u6307\u6807 $i$ \u7684\u51fa\u73b0\u3002\n\n\u540c\u65f6\uff0c\u82e5\u6211\u4eec\u6c42\u51fa\u4e86 $t_k = \\sum_{j=1}^{n-k}[x^k](\\dfrac{e^x-1}{x})^j$\uff0c$\\text{ans}$ \u53ef\u4ee5\u4e00\u6b21\u5dee\u5377\u79ef\u5b8c\u6210\u3002\u6240\u4ee5\u95ee\u9898\u53d8\u6210\u6c42 $t_k$\u3002\n\n\u8bbe $F = \\dfrac{e^x-1}{x}$\uff0c\u5219 $t_k = [x^k]F\\dfrac{1-F^{n-k}}{1-F} = [x^k](\\dfrac{F}{1-F}-\\dfrac{F^{n-k+1}}{1-F})$\u3002$\\dfrac{F}{1-F}$ \u76f4\u63a5\u7b97\u51fa\u5373\u53ef\u3002\u8003\u8651\u540e\u9762\u90a3\u4e00\u5768\uff0c\u8bbe\u5176\u4e3a $r_k$\u3002\n\n\u56e0\u4e3a $[x^0]F = 1$\uff0c\u56e0\u800c\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u62c9\u53cd Tish\u3002\u4eff\u4f5b\u505a\u4e0d\u592a\u52a8\u4e86\u3002\n\n\n\n\u6b63 \u7247 \u5f00 \u59cb\u3002\n\n**\u76f4\u63a5\u5c06 $F$ \u4ee3\u5165**\uff0c\u6211\u4eec\u5f97\u5230 $r_k = [x^k]\\dfrac{F^{n-k+1}}{1-F} = [x^n]\\dfrac{(e^x-1)^{n-k+1}}{x-e^x+1}$\u3002\n\n\u91cd\u65b0\u6784\u9020\u590d\u5408\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u73b0\u5728\u4ee4 $G = e^x-1$\uff0c\u4e0d\u96be\u6784\u9020\u5916\u5c42\u51fd\u6570 $H_k = \\dfrac{x^{n-k+1}}{G^{(-1)}-x}$\uff0c\u4f7f\u5f97 $r_k = [x^n]H_k(G)$\u3002\n\n- \u586b\u5751\uff1a\u4e0d\u96be\u89e3\u65b9\u7a0b\u5f97\u5230 $G^{(-1)} = \\ln (1+x)$\u3002\n\n\u8fd9\u4e2a $H$ \u5f88\u70e6\uff01\u6211\u4e0d\u60f3\u5bfc\u5b83\uff01\u90a3\u5c31\u4e0a\u6269\u5c55\u53e6\u7c7b\u62c9\u683c\u6717\u65e5\u53cd\u6f14\uff1a\n$$\n\\begin{aligned}\nr_k = [x^n]H_k(G) &= [x^n]H_kG^{(-1)}{'}\\left(\\dfrac{x}{G^{(-1)}}\\right)^{n+1}\\\\\n                  &= [x^{k-1}]\\dfrac{1}{G^{(-1)}-x}G^{(-1)}{'}\\left(\\dfrac{x}{G^{(-1)}}\\right)^{n+1}\\\\\n\\end{aligned}\n$$\n\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u3002\u6211\u4eec\u505a\u5b8c\u4e86\u3002$O(n\\log n)$\u3002\n\n- \u91cd\u65b0\u5ba1\u89c6\u6211\u4eec\u7684\u63a8\u5bfc\u8fc7\u7a0b\uff1a\u91c7\u7528\u6269\u5c55\u53e6\u7c7b\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u9664\u4e86\u65b9\u4fbf\u4e86\u6211\u4eec\u7684\u8ba1\u7b97\u4e4b\u5916\uff0c**\u4e5f\u4fdd\u6301\u4e86 $H_k$ \u7684\u5f62\u5f0f**\u4f9d\u7136\u597d\u770b\uff0c\u4f7f\u5f97\u6700\u540e\u7b54\u6848\u5168\u90e8\u89c4\u7ea6\u5230\u4e00\u4e2a\u591a\u9879\u5f0f\u4e0a\u3002\n\n\n\n\u4ee3\u7801\uff1a\u8fd9\u8fd8\u5199\u4e0d\u51fa\u6765\uff1f\u5b9e\u5728\u9700\u8981\u79c1\u4fe1\u627e \u6211/@\u6ed1\u5927\u7a3d \u8981\u3002\n\n ",
        "postTime": 1658820297,
        "uid": 114153,
        "name": "Sali\u0435ri",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1349F2"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u53d1\u8868\u4e8e\u6211\u7684\u535a\u5ba2\uff1a<https://www.alpha1022.me/articles/cf-1349f2-another.htm>\u3002\n\n\u4e3a\u4e86\u819c\u62dc EI\uff0c~~\u53e3\u80e1~~\u7ffb\u8bd1\u4e00\u4e0b\u53e6\u4e00\u4e2a\u51fa\u9898\u4eba\u7684\u505a\u6cd5\u3002  \n\u4e0a\u6b21\u770b\u7684\u65f6\u5019\u6ca1\u52a8\u8111\u5bfc\u81f4\u5b8c\u5168\u65e0\u6cd5\u7406\u89e3\uff0c\u95ee EI \u4ed6\u8bf4\u4e00\u5e74\u524d\u5199\u7684\u5168\u5fd8\u4e86\uff08\n\n\u770b\u4e86\u8fd9\u4e2a\u66b4\u529b\u63a8 GF \u505a\u6cd5\u4e4b\u540e\u611f\u89c9\u8fd9\u4e2a\u53cc\u5c04\u662f\u4ece GF \u9006\u63a8\u51fa\u6765\u7684\uff1f\n\n\u6211\u4eec\u7528 $z$ \u5143\u8ba1\u91cf\u5e8f\u5217\u957f\u5ea6\uff0c$t$ \u5143 $t^k$ \u7684\u7cfb\u6570\u8868\u793a $k$ \u7684\u51fa\u73b0\u6b21\u6570\u548c\u3002\n\n\u9996\u5148\u4e3a\u4e86\u663e\u5f97\u81ea\u7136\uff0c\u628a\u5e8f\u5217\u53cd\u8fc7\u6765\uff0c\u4e5f\u5c31\u662f\u9650\u5236\u6539\u4e3a $k$ \u7684\u7b2c\u4e00\u6b21\u51fa\u73b0\u4e4b\u540e\u6709 $k-1$ \u51fa\u73b0\u8fc7\u3002  \n\u76f8\u5f53\u6709\u542f\u53d1\u610f\u4e49\u5730\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u9650\u5236\u7684\u53e6\u4e00\u9762\u5c31\u662f\u6240\u6709 $k-1$ \u90fd\u5728\u6240\u6709 $k$ \u7684\u524d\u9762\u3002  \n\u8fd9\u63d0\u793a\u6211\u4eec\u5bb9\u65a5\u3002\u4ee4\u5e8f\u5217\u4e2d\u6700\u5927\u503c\u4e3a $m$\uff0c\u679a\u4e3e $S \\subseteq \\{1,2,\\dots,m-1\\}$ \u8868\u793a\u5bf9\u4e8e $i \\in S$ \u5f3a\u5236\u6240\u6709 $i$ \u5728 $i+1$ \u4e4b\u524d\u51fa\u73b0\uff0c\u7136\u540e\u9644\u6709\u5bb9\u65a5\u7cfb\u6570 $(-1)^{|S|}$\u3002\n\n\u6839\u636e\u7ecf\u9a8c\uff0c\u8fd9\u6837\u7684\u94a6\u5b9a\u5c31\u76f8\u5f53\u4e8e\u628a $[1,m]$ \u7684\u6574\u6570\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a $[l,r]$\uff0c\u5bf9\u6240\u6709 $i \\in [l,r-1]$ \u94a6\u5b9a\u6240\u6709 $i$ \u51fa\u73b0\u5728 $i+1$ \u4e4b\u524d\uff0c\u4e5f\u5c31\u662f $[l,r]$ \u5185\u7684\u6570\u8981\u300c\u8fde\u7eed\u300d\u5730\u51fa\u73b0\u3002  \n\u7136\u540e\u6bb5\u6570\u5176\u5b9e\u5c31\u662f $m-|S|$\uff0c\u5bb9\u65a5\u7cfb\u6570\u4e5f\u5c31\u53ef\u4ee5\u770b\u505a\u6bcf\u4e2a\u6bb5\u5c3e\u4ee5\u5916\u7684\u6240\u6709\u5143\u7d20\u90fd\u9644\u6709\u4e00\u4e2a $-1$ \u7684\u56e0\u5b50\u3002  \n\u6211\u4eec\u53c8\u8981\u540c\u65f6\u8ba1\u6570\u6bcf\u79cd\u5143\u7d20\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u90a3\u4e48\u82e5\u7edf\u8ba1 $k$\uff0c\u76f8\u5f53\u4e8e\u7ed9 $[1,k]$ \u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u9644\u6709\u4e00\u4e2a\u56e0\u5b50 $t$ \u7528\u6765\u523b\u753b\u5143\u7d20\u5927\u5c0f\u3002  \n\u800c\u4e0d\u540c\u6bb5\u4e4b\u95f4\u6211\u4eec\u53ef\u4ee5\u7528 EGF \u5c06\u5176\u4f4d\u7f6e\u6df7\u5408\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u7edf\u8ba1\u4e09\u4e2a\u9636\u6bb5\uff1a\u5b8c\u6574\u5730\u5168\u90e8\u5143\u7d20\u90fd\u9644\u6709 $t$\uff08\u5b8c\u5168\u5728\u9700\u8981\u7edf\u8ba1\u51fa\u73b0\u6b21\u6570\u7684 $k$ \u4e4b\u524d\uff09\u7684\u6bb5\uff1b\u5305\u542b\u6700\u540e\u4e00\u4e2a $t$ \u7684\u7ec8\u6b62\u6bb5\uff1b\u4e0d\u5305\u542b $t$ \u7684\u6bb5\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u9636\u6bb5\uff0c\u4e00\u79cd\u5143\u7d20\u7684\u8d21\u732e\u6709\u81f3\u5c11\u4e00\u4e2a $z$ \u548c\u6070\u597d\u4e00\u4e2a $t$\uff0c\u5373\n$$\n\\frac{tz}{1-z}\n$$\n\n\u7136\u540e\u5c06\u6b64\u6bb5\u5185\u7684\u6240\u6709\u5143\u7d20\u6df7\u5408\uff0c\u9664\u53bb\u6700\u540e\u4e00\u4e2a\u6bcf\u4e00\u4e2a\u90fd\u9644\u6709 $-1$\uff0c\u4e14\u6bb5\u5185\u975e\u7a7a\u3002\u90a3\u4e48\u4e00\u6bb5\u7684 OGF \u5c31\u662f\n$$\n\\begin{aligned}\nL(z,t)\n&= 1-\\frac 1{ 1+\\frac{tz}{1-z} } \\\\\n&= \\frac{tz}{1-(1-t)z} \\\\\n&= t\\sum\\limits_{i\\ge 0} (1-t)^i z^{i+1}\n\\end{aligned}\n$$\n\n\u7531\u4e8e\u4e0d\u540c\u6bb5\u4e4b\u95f4\u7684\u4f4d\u7f6e\u6df7\u5408\u662f EGF\uff0c\u6211\u4eec\u8003\u8651\u5176 EGF\n$$\n\\begin{aligned}\n\\widehat L(z,t)\n&= t\\sum\\limits_{i\\ge 0} (1-t)^i \\frac{ z^{i+1} }{(i+1)!} \\\\\n&= \\frac t{1-t} \\sum\\limits_{i\\ge 0} \\frac{ (z(1-t))^{i+1} }{(i+1)!} \\\\\n&= \\frac t{1-t} ( {\\rm e} ^{z(1-t)}-1)\n\\end{aligned}\n$$\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u9636\u6bb5\uff0c\u4e00\u4e2a\u7ec8\u6b62\u6bb5\u5e94\u5f53\u4ee5\u82e5\u5e72\u4e2a\u9644\u6709 $-t$ \u7684\u5143\u7d20\u3001\u4e00\u4e2a\u9644\u6709 $t$ \u4e14\u9644\u6709\u957f\u5ea6\u7684\u5143\u7d20\u3001\u82e5\u5e72\u4e2a\u53ea\u9644\u6709 $-1$ \u7684\u5143\u7d20\u7ec4\u6210\u3002  \n\u4e5f\u5373\n$$\n\\begin{aligned}\nU(z,t)\n&= \\frac1{ 1+\\frac{tz}{1-z} } \\left(\\left(z\\frac{ {\\rm d} }{ {\\rm d}  z}\\right)\\frac{tz}{1-z}\\right) \\frac 1{ 1+\\frac z{1-z} } \\\\\n&= \\frac1{ 1+\\frac{tz}{1-z} } \\frac{tz}{(1-z)^2} \\frac 1{ 1+\\frac z{1-z} } \\\\\n&= \\frac{tz}{1-(1-t)z} \\\\\n&= L(z,t) \\\\\n\\widehat U(z,t) &= \\widehat L(z,t)\n\\end{aligned}\n$$\n\n\u5bf9\u4e8e\u7b2c\u4e09\u9636\u6bb5\uff0c\u6ce8\u610f\u5230\u76f4\u63a5\u5c06 $t=1$ \u4ee3\u5165\u5148\u524d\u5f97\u51fa\u7684 $\\widehat L(z,t)$ \u662f\u65e0\u610f\u4e49\u7684\u3002\u4f46\u662f\u6ce8\u610f\u5230 $L(z,1)=z$ \u6240\u4ee5 $\\widehat L(z,1)=z$\u3002\n\n\u63a5\u4e0b\u6765\u7ec4\u5408\u4e09\u8005\uff0c\u5219\u7b54\u6848\u7684 EGF \u5c31\u662f\n$$\n\\frac1{1-\\widehat L(z,t)} \\widehat U(z,t) \\frac1{1-\\widehat L(z,1)} = \\frac{t( {\\rm e} ^{z(1-t)}-1)}{(1-z)(1-t {\\rm e} ^{z(1-t)})}\n$$\n\n\u6ce8\u610f\u5230\n$$\n\\begin{aligned}\n& \\quad \\; \\left([z^n] \\frac{t( {\\rm e} ^{z(1-t)}-1)}{(1-z)(1-t {\\rm e} ^{z(1-t)})}\\right) + 1 \\\\\n&= [z^n] \\left(\\frac{t( {\\rm e} ^{z(1-t)}-1)}{(1-z)(1-t {\\rm e} ^{z(1-t)})} + \\frac 1{1-z}\\right) \\\\\n&= (1-t) [z^n] \\frac1{(1-z)(1-t {\\rm e} ^{z(1-t)})}\n\\end{aligned}\n$$\n\n\u63a5\u4e0b\u6765\u4f5c\u6362\u5143\u4ee4 $z = \\frac u{1-t}$\uff0c\u5219\n$$\n\\begin{aligned}\n[z^n] \\frac1{(1-z)(1-t {\\rm e} ^{z(1-t)})} = (1-t)^n [u^n] \\frac1{\\left(1-\\frac u{1-t}\\right)(1-t {\\rm e} ^u)}\n\\end{aligned}\n$$\n\n\u4f5c\u5206\u5f0f\u5206\u89e3\uff0c\u8bbe\n$$\n\\begin{aligned}\n\\frac1{\\left(1-\\frac u{1-t}\\right)(1-t {\\rm e} ^u)}\n&= (1-t)\\frac1{(1-t-u)(1-t {\\rm e} ^u)} \\\\\n&= (1-t)\\left(\\frac A{1-t-u} + \\frac B{1-t {\\rm e} ^u}\\right)\n\\end{aligned}\n$$\n\n\u5219 $A(1-t {\\rm e} ^u) + B(1-t-u) = 1$\u3002  \n\u4ee4 $t =  {\\rm e} ^{-u}$ \u53ef\u5f97 $B = \\frac1{1- {\\rm e} ^{-u}-u}$\u3002  \n\u4ee4 $t = 1-u$ \u53ef\u5f97 $A = \\frac1{1- {\\rm e} ^u+u {\\rm e} ^u}$\u3002  \n\u6240\u4ee5\u5206\u89e3\u4e3a\n$$\n\\frac{  {\\rm e} ^{-u} }{(1- {\\rm e} ^u+u {\\rm e} ^u)(1-t {\\rm e} ^u)} + \\frac1{(1- {\\rm e} ^u+u {\\rm e} ^u)(1-t-u)}\n$$\n\n\u5148\u8003\u8651 $[u^n]\\frac1{(1- {\\rm e} ^u+u {\\rm e} ^u)(1-t-u)}$\uff0c\u5bb9\u6613\u5c06\u5176\u5199\u4f5c $[u^{n+1}] \\frac{P(u)}{1-t-u}$\uff0c\u6c42\u5176 $t$ \u7684\u524d $n$ \u9879\u53ea\u9700\u6ce8\u610f\u5230\n$$\n\\begin{aligned}\n[u^{n+1}] \\frac{P(u)}{1-t-u}\n&= [u^{n+1}] P(u) \\sum\\limits_{i\\ge 0} (t+u)^i \\\\\n&= [u^{n+1}] P(u) \\sum\\limits_{j\\ge 0} u^j \\sum\\limits_{i\\ge j} \\binom ij t^{i-j} \\\\\n&\\equiv \\sum\\limits_{k=0}^{n+1} p_k \\sum\\limits_{i=0}^n \\binom{n-k+1+i}i t^i \\pmod { t^{n+1} } \\\\\n&= \\sum\\limits_{i=0}^n t^i \\sum\\limits_{k=0}^{n+1} p_k \\binom{n-k+1+i}i\n\\end{aligned}\n$$\n\n\u53ef\u4ee5\u5377\u79ef\u3002\n\n\u518d\u6765\u8003\u8651 $[u^n] \\frac{  {\\rm e} ^{-u} }{(1- {\\rm e} ^u+u {\\rm e} ^u)(1-t {\\rm e} ^u)}$\u3002  \n\u4e3a\u4e86\u5bb9\u6613\u7528\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u7684\u5f62\u5f0f\u523b\u753b\u7b54\u6848\uff0c\u6211\u4eec\u8bbe $F(u) =  {\\rm e} ^u - 1$\uff0c\u5219\u7b54\u6848\u53ef\u5199\u4e3a $[u^{n+1}] \\frac{Q(F)}{1-t(1+F)}$\u3002  \n\u7531\u590d\u5408\u9006 $G = F^{<-1>} = \\ln(1+u)$ \u6709\n$$\n\\begin{aligned}\n[u^{n+1}] \\frac{Q(F)}{1-t(1+F)}\n&= \\frac1{n+1} [u^n] \\left(\\frac{Q(u)}{1-t(1+u)}\\right)' \\left(\\frac u{G(u)}\\right)^{n+1} \\\\\n&= \\frac1{n+1} [u^n] \\left(\\frac{tQ(u)}{(1-t(1+u))^2}+\\frac{Q'(u)}{1-t(1+u)}\\right) \\left(\\frac uG\\right)^{n+1}\n\\end{aligned}\n$$\n\n\u8bbe $H = \\left(\\frac uG\\right)^{n+1}$\uff0c\u6709\n$$\n\\begin{aligned}\n& \\quad \\; [u^n] \\left(\\frac{tQ(u)}{(1-t(1+u))^2}+\\frac{Q'(u)}{1-t(1+u)}\\right) H \\\\\n&= [u^n] \\left(Q\\sum\\limits_{i\\ge 0}(i+1) t^{i} (1+u)^i+Q'\\sum\\limits_{i\\ge 0} t^i (1+u)^i\\right) H\n\\end{aligned}\n$$\n\n\u7136\u540e\n$$\n\\begin{aligned}\n& \\quad \\; [u^n t^k] \\left(\\frac{tQ(u)}{(1-t(1+u))^2}+\\frac{Q'(u)}{1-t(1+u)}\\right) H \\\\\n&= [u^n] \\left(Q\\cdot k(1+u)^{k-1}+Q'\\cdot (1+u)^k\\right) H \\\\\n&= k[u^n] (1+u)^{k-1} QH + [u^n] (1+u)^k Q'H \\\\\n&= k\\sum\\limits_{i=0}^n \\binom{k-1}i [x^{n-i}] QH + \\sum\\limits_{i=0}^n \\binom ki [x^{n-i}] Q'H\n\\end{aligned}\n$$\n\n\u4f9d\u7136\u53ef\u4ee5\u5377\u79ef\u3002",
        "postTime": 1620133641,
        "uid": 75840,
        "name": "deserter",
        "ccfLevel": 0,
        "title": "Slime and Sequences - EI's Solution \u7ffb\u8bd1"
    }
]