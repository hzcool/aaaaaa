[
    {
        "content": "\u96c6\u8bad\u961f\u4f5c\u4e1a\u54e6\u3002\n\n\u7c89\u5154\uff1a\u201c\u77e9\u9635\u5feb\u901f\u5e42 sb \u9898\u3002\u201d\n\n> ### [\u6d1b\u8c37\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF575A) & [CF \u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://codeforces.com/contest/575/problem/A)\n\n> \u9898\u610f\u89c1\u6d1b\u8c37\u3002\n\n\u4e00\u8138\u7684\u77e9\u9635\uff0c\u7528\u77e9\u9635\u628a\u9012\u63a8\u5f0f\u8868\u793a\u51fa\u6765\uff1a\n\n$$\\begin{bmatrix}f_i&f_{i+1}\\end{bmatrix}\\Delta_i=\\begin{bmatrix}f_{i+1}&f_{i+2}\\end{bmatrix}$$\n\n\u5176\u4e2d\n\n$$\\Delta_i=\\begin{bmatrix}0&s_i\\\\1&s_{i+1}\\end{bmatrix}$$\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f\n\n$$\\left(\\begin{bmatrix}f_0 & f_1\\end{bmatrix}\\prod_{i=0}^{k-1}\\Delta_i\\right)_{1,1}=\\left(\\prod_{i=0}^{k-1}\\Delta_i\\right)_{2,1}$$\n\n\u53ea\u9700\u8981\u6c42\u90a3\u4e2a $\\prod$ \u5373\u53ef\u3002\n\n\u6ce8\u610f\u5230 $s$ \u662f\u6709\u5468\u671f\u6027\u7684\uff0c$n$ \u4e2a\u4e00\u5468\u671f\u3002\u5148\u4e0d\u8003\u8651\u6709 $m$ \u4e2a\u7279\u6b8a\u70b9\uff0c\u8fd9\u6837\u663e\u7136\u53ef\u4ee5\u7b97\u51fa $n$ \u4e2a\u7684\u79ef\uff0c\u7136\u540e\u5feb\u901f\u5e42\u3002\n\n\u5982\u679c\u6709 $m$ \u4e2a\u7279\u6b8a\u70b9\u5462\uff1f\u8003\u8651\u5728\u6709\u7279\u6b8a\u70b9\u5904\u5206\u6bb5\uff0c\u6709\u7279\u6b8a\u70b9\u7684\u5468\u671f\u4eec\u7279\u6b8a\u7b97\uff0c\u65e0\u7279\u6b8a\u70b9\u7684\u5468\u671f\u6bb5\u4eec\u5feb\u901f\u5e42\u3002\u5468\u671f\u6bb5\u6570\u663e\u7136\u662f $\\mathrm O(m)$ \u7684\uff0c\u90a3\u4e48\u5feb\u901f\u5e42\u90e8\u5206\u5c31\u662f $\\mathrm O(m\\log)$\u3002\n\n\u5982\u4f55\u5feb\u901f\u7ef4\u62a4\u7279\u6b8a\u7b97\u90e8\u5206\u5462\uff1f\u8003\u8651\u5728\u539f $n$ \u4e2a\u77e9\u9635\u7684\u4e58\u79ef\u4e0a\u4fee\u6539\uff0c\u6ce8\u610f\u5230\u4e00\u4e2a\u7279\u6b8a\u7684 $s_i$ \u53ea\u4f1a\u5f71\u54cd $\\Delta_i$ \u548c $\\Delta_{i-1}$\u3002\u4f46\u662f\u77e9\u9635\u4e58\u6cd5\u6ca1\u6709\u9006\u8fd0\u7b97\uff0c\u4e0d\u80fd\u76f4\u63a5\u9664\u6216 BIT\uff1b\u9700\u8981\u4fee\u6539\uff0c\u4e5f\u4e0d\u80fd\u500d\u589e\u3002\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5355\u70b9\u4fee\u6539\uff0c\u6574\u4f53\u67e5\u79ef\uff0c\u6bcf\u4e2a\u6709\u7279\u6b8a\u70b9\u7684\u5468\u671f\u7b97\u5b8c\u5c31\u6539\u56de\u53bb\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathrm O(n+m\\log)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define mp make_pair\n#define X first\n#define Y second\n#define pb push_back\n#define int long long\nconst int inf=0x3f3f3f3f3f3f3f3f;\nconst int N=50000,M=50000;\nint k,mod;\nint n;\nint s[N];\nint m;\npair<int,int> v[M+1];\nvector<pair<int,pair<bool,int> > > v0;\nstruct matrix{//\u77e9\u9635 \n\tint a[2][2];\n\tint *operator[](int x){return a[x];}\n\tmatrix(int x=0,int y=0,int z=0,int xx=0){\n\t\ta[0][0]=x,a[0][1]=y,a[1][0]=z,a[1][1]=xx;\n\t}\n\tfriend matrix operator*(matrix x,matrix y){\n\t\treturn matrix((x[0][0]*y[0][0]+x[0][1]*y[1][0])%mod,\n\t\t              (x[0][0]*y[0][1]+x[0][1]*y[1][1])%mod,\n\t\t              (x[1][0]*y[0][0]+x[1][1]*y[1][0])%mod,\n\t\t              (x[1][0]*y[0][1]+x[1][1]*y[1][1])%mod);\n\t}\n\tvoid prt(){printf(\"%lld %lld\\n%lld %lld\\n\",a[0][0],a[0][1],a[1][0],a[1][1]);}\n};\nmatrix qpow(matrix x,int y){//\u5feb\u901f\u5e42 \n\tmatrix res(1,0,0,1);\n\twhile(y){\n\t\tif(y&1)res=res*x;\n\t\tx=x*x;\n\t\ty>>=1;\n\t}\n\treturn res;\n}\nstruct segtree{//\u7ebf\u6bb5\u6811 \n\tstruct node{int l,r;matrix v;}nd[N<<2];\n\t#define l(p) nd[p].l\n\t#define r(p) nd[p].r\n\t#define v(p) nd[p].v\n\tvoid sprup(int p){v(p)=v(p<<1)*v(p<<1|1);}\n\tvoid bld(int l=0,int r=n-1,int p=1){\n\t\tl(p)=l;r(p)=r;\n\t\tif(l==r)return v(p)=matrix(0,s[l],1,s[(l+1)%n]),void();\n\t\tint mid=l+r>>1;\n\t\tbld(l,mid,p<<1);bld(mid+1,r,p<<1|1);\n\t\tsprup(p);\n\t}\n\tvoid init(){bld();}\n\tvoid chg(int x,bool y,int v,int p=1){\n\t\tif(l(p)==r(p))return v(p)[y][1]=v,void();\n\t\tint mid=l(p)+r(p)>>1;\n\t\tchg(x,y,v,p<<1|(x>mid));\n\t\tsprup(p);\n\t}\n\tmatrix prod(int l=0,int r=n-1,int p=1){\n\t\tif(l>r)return matrix(1,0,0,1);\n\t\tif(l<=l(p)&&r>=r(p))return v(p);\n\t\tint mid=l(p)+r(p)>>1;\n\t\tmatrix res(1,0,0,1);\n\t\tif(l<=mid)res=res*prod(l,r,p<<1);\n\t\tif(r>mid)res=res*prod(l,r,p<<1|1);\n\t\treturn res;\n\t}\n}segt;\nsigned main(){\n\tcin>>k>>mod;\n\tcin>>n;\n\tfor(int i=0;i<n;i++)cin>>s[i];\n\tcin>>m;\n\tfor(int i=1;i<=m;i++)cin>>v[i].X>>v[i].Y;\n\tv0.pb(mp(-n,mp(0,0)));v0.pb(mp(inf,mp(0,0)));\n\tfor(int i=1;i<=m;i++){\n\t\tv0.pb(mp(v[i].X,mp(0,v[i].Y)));\n\t\tif(v[i].X)v0.pb(mp(v[i].X-1,mp(1,v[i].Y)));\n\t}\n\tsort(v0.begin(),v0.end());\n\tsegt.init();\n\tmatrix res(1,0,0,1);\n\tint las=0;\n\tfor(int i=1,ie;i<v0.size();i=ie+1){\n\t\tie=i;while(ie+1<v0.size()&&v0[ie+1].X/n==v0[i].X/n)ie++;\n\t\tif(v0[i].X/n>=k/n){las=v0[i-1].X/n;break;}\n\t\tres=res*qpow(segt.prod(),v0[i].X/n-1-v0[i-1].X/n);\n\t\tfor(int j=i;j<=ie;j++)segt.chg(v0[j].X%n,v0[j].Y.X,v0[j].Y.Y);//\u4fee\u6539 \n\t\tres=res*segt.prod();\n\t\tfor(int j=i;j<=ie;j++)segt.chg(v0[j].X%n,v0[j].Y.X,v0[j].Y.X?s[(v0[j].X+1)%n]:s[v0[j].X%n]);//\u6539\u56de\u53bb \n\t}\n\tres=res*qpow(segt.prod(),k/n-1-las);\n\tfor(int i=0;i<v0.size();i++)if(v0[i].X/n==k/n)segt.chg(v0[i].X%n,v0[i].Y.X,v0[i].Y.Y);\n\tres=res*segt.prod(0,k%n-1);\n\tcout<<res[1][0];\n\treturn 0;\n}\n```",
        "postTime": 1598083812,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "CodeForces 575A - Fibonotci"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://codeforces.ml/contest/575/problem/A)\n\n\u9898\u610f\uff1a\n\n\u7ed9\u51fa $s_0,s_1,s_2,\\dots,s_{n-1}$\uff0c\u5bf9\u4e8e $i\\geq n$\uff0c\u6709 $m$ \u4e2a $s_i$ \u6ee1\u8db3 $s_i\\neq s_{i\\bmod n}$\uff0c\u8fd9 $m$ \u4e2a $s_i$ \u7279\u6b8a\u7ed9\u5b9a\uff0c\u5176\u5b83\u7684 $s_i=s_{i\\bmod n}$\u3002\n\n\u53e6\u6709\u5e8f\u5217 $f_i$ \u6ee1\u8db3 $f_0=0,f_1=1$\uff0c$f_i=f_{i-1}s_{i-1}+f_{i-2}s_{i-2}$\u3002\n\n\u6c42 $f_x\\bmod P$\u3002\n\n $1\\leq n,m\\leq 5\\times 10^4,0\\leq x\\leq 10^{18}$\n\n\u7c89\u5154\uff1a\u77e9\u9635\u5feb\u901f\u5e42 sb \u9898\u3002\n\n\u6211\uff1a\u77e9\u9635\u5feb\u901f\u5e42\u795e\u4ed9\u9898\u3002\n\n\u8fd9\u597d\u50cf\u662f\u4e0a\u8d5b\u5b63\u7684\u4e00\u4e2a jxd \u4f5c\u4e1a\u3002\n\n\u9996\u5148\u5199\u51fa\u77e9\u9635\u9012\u63a8\u5f0f\uff1a\n\n$[f_{i-2},f_{i-1}]\\times\\begin{bmatrix}0&s_{i-2}\\\\1&s_{i-1}\\end{bmatrix}=[f_{i-1},f_i]$\n\n\u4e8e\u662f $[f_{x-1},f_x]=[0,1]\\times\\prod\\limits_{i=1}^{x-1}\\begin{bmatrix}0&s_{i-1}\\\\1&s_{i}\\end{bmatrix}$\n\n\u9996\u5148\u8003\u8651 $m=0$ \u7684\u60c5\u51b5\u3002\u540e\u9762 $\\prod$ \u7684\u77e9\u9635\u6210\u5468\u671f\u6027\u5206\u90e8\u3002\u6240\u4ee5\u53ef\u4ee5\u6c42\u51fa\u6bcf\u4e2a\u5468\u671f\u5185\u6240\u6709\u77e9\u9635\u7684\u4e58\u79ef\uff0c\u8dd1\u4e2a\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u6700\u540e\u7684\u96f6\u5934\u66b4\u529b\u7b97\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651 $m\\neq 0$ \u7684\u60c5\u51b5\u3002\u8bb0 $P=\\prod\\limits_{i=0}^{n-1}\\begin{bmatrix}0&s_i\\\\1&s_{(i+1)\\bmod n}\\end{bmatrix}$\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e\u5927\u591a\u6570\u5468\u671f\uff0c\u5176\u4e2d\u6240\u6709\u77e9\u9635\u7684\u4e58\u79ef\u90fd\u4e3a $P$\uff0c\u6700\u591a\u53ea\u6709 $2m$ \u4e2a\u5468\u671f\u7684\u4e58\u79ef $\\neq P$\u3002\n\n\u6545\u53ef\u4ee5\u5bf9\u8fd9\u4e9b\u7279\u6b8a\u7684\u5468\u671f\u7279\u6b8a\u8ba1\u7b97\uff0c\u5176\u5b83\u5468\u671f\u8dd1\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u8003\u8651\u4e00\u4e2a\u7279\u6b8a\u70b9 $x_i$ \u4f1a\u9020\u6210\u4ec0\u4e48\u5f71\u54cd\uff0c\u4f1a\u4f7f $x_i$ \u548c $x_i-1$ \u7684\u8f6c\u79fb\u77e9\u9635\u53d1\u751f\u53d8\u5316\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6240\u6709 $x_i$ \u548c $x_i-1$ \u6240\u5728\u7684\u5468\u671f\u5355\u72ec\u8ba1\u7b97\u5b83\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u5efa\u7acb $n$ \u4e2a\u77e9\u9635 $A_0,A_1,A_2,\\dots,A_{n-1}$\uff0c\u521d\u59cb $A_i=\\begin{bmatrix}0&s_i\\\\1&s_{(i+1)\\bmod n}\\end{bmatrix}$\n\n\u5bf9\u4e8e\u67d0\u4e2a\u5468\u671f\u4e2d\u7279\u6b8a\u5904\u7406\u7684\u70b9 $p$\uff0c\u6211\u4eec\u4fee\u6539 $p\\bmod n$ \u8f6c\u79fb\u77e9\u9635\u7684\u503c\uff0c\u7136\u540e\u6c42\u4e00\u904d\u6240\u6709 $A_i$ \u7684\u4e58\u79ef\u3002\u5904\u7406\u5b8c\u8fd9\u4e2a\u5468\u671f\u540e\u518d\u6539\u56de\u53bb\u3002\n\n\u4e8e\u662f\u6b64\u9898\u53d8\u4e3a\uff1a\u4fee\u6539\u67d0\u4e2a\u77e9\u9635\u7684\u503c\uff0c\u6c42\u6240\u6709\u77e9\u9635\u7684\u4e58\u79ef\u3002\n\n\u6ce8\u610f\u5230\u77e9\u9635\u662f\u4e0d\u652f\u6301\u9664\u6cd5\u64cd\u4f5c\u7684\uff0c\u6240\u4ee5\u8fd9\u73a9\u610f\u513f\u53ea\u80fd\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $2^3n\\log n$\u3002\n\n\u7ec6\u8282\u6076\u5fc3\u5f97\u8981\u6b7b\u3002\u3002\u3002\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntemplate<typename T> void read(T &x){\n\tchar c=getchar();T neg=1;\n\twhile(!isdigit(c)){if(c=='-') neg=-1;c=getchar();}\n\twhile(isdigit(c)) x=x*10+c-'0',c=getchar();\n\tx*=neg;\n}\nconst int MAXN=5e4;\nconst int SIZE=2;\nll x;int mod,n,m,k,b[MAXN+5];\npair<ll,int> p[MAXN+5];\nll tk[MAXN*2+5];\nstruct mat{\n\tint a[SIZE][SIZE];\n\tmat(){memset(a,0,sizeof(a));}\n\tfriend mat operator *(mat x,mat y){\n\t\tmat ret;\n\t\tfor(int i=0;i<2;i++) for(int j=0;j<2;j++) for(int k=0;k<2;k++)\n\t\t\tret.a[i][j]=(ret.a[i][j]+1ll*x.a[i][k]*y.a[k][j]%mod)%mod;\n\t\treturn ret;\n\t}\n};\nstruct node{int l,r;mat val;} s[MAXN*4+5];\nvoid build(int k,int l,int r){\n\ts[k].l=l;s[k].r=r;if(l==r) return;\n\tint mid=(l+r)>>1;build(k<<1,l,mid);build(k<<1|1,mid+1,r);\n}\nvoid modify(int k,int p,mat x){\n\tif(s[k].l==s[k].r){s[k].val=x;return;}\n\tint mid=(s[k].l+s[k].r)>>1;\n\tif(p<=mid) modify(k<<1,p,x);else modify(k<<1|1,p,x);\n\ts[k].val=s[k<<1].val*s[k<<1|1].val;\n}\nmat query(int k,int l,int r){\n\tif(l<=s[k].l&&s[k].r<=r) return s[k].val;\n\tint mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) return query(k<<1,l,r);\n\telse if(l>mid) return query(k<<1|1,l,r);\n\telse return query(k<<1,l,mid)*query(k<<1|1,mid+1,r);\n}\nmat qpow(mat x,ll e){\n\tmat ret;ret.a[0][0]=ret.a[1][1]=1;\n\twhile(e){if(e&1) ret=ret*x;x=x*x;e>>=1;}\n\treturn ret;\n}\nmap<ll,int> mmp;\nsigned main(){\n//\tfreopen(\"in.txt\",\"r\",stdin);\n\tscanf(\"%lld%d%d\",&x,&mod,&n);x--;\n\tif(x==-1) return printf(\"0\\n\"),0;\n\tfor(int i=0;i<n;i++) scanf(\"%d\",&b[i]);scanf(\"%d\",&m);\n\tfor(int i=1;i<=m;i++) scanf(\"%lld%d\",&p[i].fi,&p[i].se);\n\tfor(int i=1;i<=m;i++) mmp[p[i].fi]=p[i].se;\n\tfor(int i=1;i<=m;i++){\n\t\ttk[++k]=p[i].fi;\n\t\tif(p[i].fi!=n) tk[++k]=p[i].fi-1;\n\t}\n\tsort(tk+1,tk+k+1);k=unique(tk+1,tk+k+1)-tk-1;build(1,0,n-1);\n\tfor(int i=0;i<n;i++){\n\t\tmat t;t.a[0][0]=0;t.a[1][0]=1;t.a[0][1]=b[i];\n\t\tif(!mmp[i+1]) t.a[1][1]=b[(i+1)%n];else t.a[1][1]=mmp[i+1];\n\t\tmodify(1,i,t);\n\t}\n\tmat ret;\n\tif(x<n) ret=query(1,0,x);\n\telse{\n\t\tret=query(1,0,n-1);\n\t\tif(mmp[n]){\n\t\t\tmat t;t.a[0][0]=0;t.a[1][0]=1;t.a[0][1]=b[n-1];t.a[1][1]=b[0];\n\t\t\tmodify(1,n-1,t);\n\t\t}\n\t\tint cur=1,pre=0;ll pn=0;bool flg=0;\n\t\twhile(cur<=k){\n//\t\t\tputs(\"-1\");\n//\t\t\tprintf(\"%d %d %d\\n\",cur,pn,pre);\n\t\t\tif(x/n<tk[pre+1]/n){\n\t\t\t\tret=ret*qpow(query(1,0,n-1),(x/n)-pn-1);\n\t\t\t\tret=ret*query(1,0,x%n);flg=1;break;\n\t\t\t}\n\t\t\tret=ret*qpow(query(1,0,n-1),(tk[pre+1]/n)-pn-1);\n\t\t\twhile(cur<=k&&tk[cur]/n==tk[pre+1]/n){\n\t\t\t\tll id=tk[cur];int v1,v2;\n\t\t\t\tif(!mmp[id]) v1=b[id%n];else v1=mmp[id];\n\t\t\t\tif(!mmp[id+1]) v2=b[(id+1)%n];else v2=mmp[id+1];\n//\t\t\t\tprintf(\"%lld %d %d %d\\n\",id,id%n,v1,v2);\n\t\t\t\tmat t;t.a[0][0]=0;t.a[1][0]=1;t.a[0][1]=v1;t.a[1][1]=v2;\n\t\t\t\tmodify(1,id%n,t);cur++;\n\t\t\t}\n\t\t\tif((x/n)==(tk[pre+1]/n)){\n\t\t\t\tret=ret*query(1,0,x%n);flg=1;break;\n\t\t\t} else ret=ret*query(1,0,n-1);\n\t\t\tfor(int i=pre+1;i<cur;i++){\n\t\t\t\tmat t;t.a[0][0]=0;t.a[1][0]=1;\n\t\t\t\tt.a[0][1]=b[tk[i]%n];t.a[1][1]=b[(tk[i]+1)%n];\n\t\t\t\tmodify(1,tk[i]%n,t);\n\t\t\t}\n\t\t\tpn=tk[pre+1]/n;pre=cur-1;\n\t\t}\n\t\tif(!flg){\n//\t\t\tputs(\"-1\");\n\t\t\tret=ret*qpow(query(1,0,n-1),(x/n)-pn-1);\n\t\t\tret=ret*query(1,0,x%n);\n\t\t}\n\t}\n\tmat f;f.a[0][1]=1;f=f*ret;\n\tprintf(\"%d\\n\",f.a[0][0]);\n\treturn 0;\n}\n/*\n3 998244353\n3\n1 2 1\n3\n3 3\n4 6\n10 8\n\n20 998244353\n3\n100 370 250\n5\n7 230\n23 500\n5 480\n15 530\n19 570\n\n100 998244353\n3\n1 2 1\n2\n3 2\n5 1\n\n1000000 998244353\n3\n100 370 250\n5\n7 230\n23 500\n5 480\n15 530\n19 570\n*/\n```\n\n",
        "postTime": 1608637947,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF575A \u3010Fibonotci\u3011"
    },
    {
        "content": "\u53d1\u73b0\u5982\u679c $n=1,m=0$ \u5c31\u662f [P1349 \u5e7f\u4e49\u6590\u6ce2\u90a3\u5951\u6570\u5217](https://www.luogu.com.cn/problem/P1349)\u3002  \n\n\u5982\u679c\u653e\u5f00 $n=1$ \u7684\u9650\u5236\u5176\u5b9e\u5c31\u662f\u6bcf $n$ \u4e2a\u77e9\u9635\u4f5c\u4e00\u4e2a\u5faa\u73af\u8282\uff0c\u5c06\u8fd9 $n$ \u4e2a\u77e9\u9635\u7684\u4e58\u79ef\u4e58 $\\lfloor\\frac k n\\rfloor$ \u6b21\uff0c\u6700\u540e\u7684\u8fb9\u89d2\u6599\u66b4\u7b97\u5c31\u597d\u3002   \n\n\u800c $m$ \u7684\u9650\u5236\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u6bcf\u6b21\u5feb\u901f\u5e42\u5230 $m$ \u524d\u4e00\u4e2a\u5faa\u73af\u540e\u5c06 $m\\%n$ \u9644\u8fd1\u7684\u51e0\u4e2a\u77e9\u9635\u4fee\u6539\u6389\u518d\u5feb\u901f\u5e42\u3002  \n\n\u7531\u4e8e\u77e9\u9635\u5177\u6709\u7ed3\u5408\u5f8b\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4fee\u6539\u3002  \n\n\u7136\u540e\u4f60\u4e00\u5f00\u59cb\u5199\u5c31\u4f1a\u53d1\u73b0\u4e00\u5806\u7ec6\u8282\u3002\u3002\u3002   \n\n\u9996\u5148\u8bfb\u5165\u7684 $k$ \u548c $j$ \u8981\u5f00 `long long`\uff0c\u4ee5\u53ca\u4f5c\u4e58\u6cd5\u65f6\u4e5f\u8981\u5f00 `long long`\u3002   \n\n\u7136\u540e\u4f60\u53d1\u73b0\u8bfb\u5165\u7684\u662f $s_{0..n}$ \u800c\u4f60\u7684\u7ebf\u6bb5\u6811\u4e0b\u6807\u662f $1..n$ \u3002  \n\u800c\u6211\u4eec\u7684\u8f6c\u79fb\u77e9\u9635\u5e94\u8be5\u662f $f=\\begin{bmatrix}0&1\\end{bmatrix},mul=\\begin{bmatrix}0&x\\\\1&y\\end{bmatrix}(f_i=xf_{i-2}+yf_{i-1})$\uff0c\u8003\u8651\u6211\u4eec\u4f7f $s_n=s_0$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u7684\u4e0b\u6807 $i$ \u4f7f $x=s_{i-1},y=s_{i}$ \u3002\u90a3\u4e48\u6211\u4eec\u7684\u7ebf\u6bb5\u6811\u6839\u8282\u70b9\u77e9\u9635\u5373\u4e3a **\u4ece\u8fd9\u4e2a\u5faa\u73af\u5f00\u5934\u5230\u4e0b\u4e2a\u5faa\u73af\u5f00\u5934** \u7684\u8f6c\u79fb\u77e9\u9635\u3002  \n\n\u7136\u540e\u6211\u4eec\u53c8\u53d1\u73b0\uff0c\u4fee\u6539\u4e00\u4e2a $pos$ \uff0c\u4f1a\u5bf9\u7ebf\u6bb5\u6811\u4e0a $pos\\%n,pos\\%n+1$ **\u4e24\u4e2a\u4f4d\u7f6e** \u9020\u6210\u5f71\u54cd\uff0c\u800c\u4e14**\u6539\u5b8c\u672c\u5faa\u73af\u6240\u6709\u4fee\u6539\u8fd8\u8981\u518d\u6539\u56de\u6765** \u3002\u3002\u3002\n\n\u53e6\u5916\u8fd8\u8981\u4e00\u4e2a\u7279\u4f8b\uff0c\u5373\u82e5 $pos\\%n=0$\uff0c\u5219\u5f71\u54cd\u7684\u662f **\u672c\u5faa\u73af\u7684 $s_n$ \u548c\u4e0b\u5faa\u73af\u7684 $s_0$** \u3002\u3002\u3002  \n\n\u8fd9\u597d\u50cf\u6781\u5176\u96be\u5904\u7406\uff0c\u9700\u8981\u4e00\u5927\u5806\u7279\u5224\u3002\u4e8e\u662f\u6211\u4eec **\u8003\u8651\u5c06\u4fee\u6539\u4e00\u62c6\u56db\u4ee5\u907f\u514d\u7279\u5224**\u3002  \n\n\u5b9a\u4e49\u4e00\u4e2a\u8be2\u95ee\u7ed3\u6784\u4f53 `{x,y,a,id}` \u8868\u793a\u5c06\u7b2c $x$ \u4e2a\u5faa\u73af $s_y$ \u4fee\u6539\u4e3a $a$ \uff0c\u672c\u6b21\u662f\u7b2c $id$ \u4e2a\u4fee\u6539\u3002  \n\u4e00\u4e2a\u539f\u4fee\u6539\u53ef\u4ee5\u88ab\u62c6\u4e3a\u4e00\u4e0b\u56db\u4e2a\u65b0\u4fee\u6539\uff1a  \n1. \u4fee\u6539\u672c\u6b21\u8be2\u95ee\u7684 $j\\%n$\u3002   \n2. \u4fee\u6539\u672c\u6b21\u8be2\u95ee\u7684 $j\\%n+1$\u3002   \n3. \u4e0b\u6b21\u8be2\u95ee\u6539\u56de\u503c $j\\%n$\u3002   \n4. \u4e0b\u6b21\u8be2\u95ee\u6539\u56de\u503c $j\\%n+1$\u3002     \n\n\u5bf9\u4e8e $pos\\%n==0$ \u7684\u60c5\u51b5\u8fdb\u884c\u7279\u5224\u3002\u53d1\u73b0\u5728\u7ebf\u6bb5\u6811\u4e0a\u627e\u4e0b\u6807\u4e3a $0$ \u7684\u70b9\u5b9e\u9645\u4f1a\u66f4\u65b0\u4e0b\u6807\u4e3a $1$ \u7684\u70b9\u7684\u503c\uff0c\u521a\u597d\u4e0d\u7528\u7279\u5224\u3002      \n\u6bcf\u6b21\u65b0\u4fee\u6539\u4ec5\u9700\u8981\u5c06 $s_y$ \u6539\u4e3a $n$\uff0c\u5e76\u5728\u7ebf\u6bb5\u6811\u4e0a\u66f4\u65b0 $s_y$ \u7684\u7b54\u6848\u5c31\u597d\u3002    \n\n\u4ee5\u4e0b\u662f\u90e8\u5206\u6838\u5fc3\u4ee3\u7801\uff1a   \n\n\u8be2\u95ee\u7ed3\u6784\u4f53\uff1a\n```cpp\n\nstruct quest\n{\n\tlong long x;int y,a,id;\n\tbool operator< (const quest &c)const{return x!=c.x?x<c.x:(y!=c.y?y<c.y:id<c.id);}//\u6309\u987a\u5e8f\u4fee\u6539\n}d[N<<2];\n```\n\u62c6\u8be2\u95ee\uff1a\n```cpp\nfor(i=1;i<=m;i++)\nif(a[i].first%n)\n\td[++cnt]=(quest){a[i].first/n,a[i].first%n,a[i].second,i},\n\td[++cnt]=(quest){a[i].first/n,a[i].first%n+1,s[a[i].first%n+1],i},\n\td[++cnt]=(quest){a[i].first/n+1,a[i].first%n,s[a[i].first%n],i},\n\td[++cnt]=(quest){a[i].first/n+1,a[i].first%n+1,s[a[i].first%n+1],i};\nelse\n\td[++cnt]=(quest){a[i].first/n-1,n,a[i].second,i},\n\td[++cnt]=(quest){a[i].first/n,0,a[i].second,i},\n\td[++cnt]=(quest){a[i].first/n,n,s[n],i},\n\td[++cnt]=(quest){a[i].first/n+1,0,s[0],i};\n```\n\u4fee\u6539\u8ba1\u7b97\u7b54\u6848\uff1a\n```cpp\nmat f;f[0][1]=1;long long las=0;\nfor(i=1;i<=cnt&&d[i].x<kk/n;i++)\n{\n\tf=f*(t[1]^(d[i].x-las));\n\tlas=d[i].x;\n\ts[d[i].y]=d[i].a;\n\tupdate(1,1,n,d[i].y);\n}\nf=f*(t[1]^(kk/n-las));\nfor(i=1;i<=kk%n;i++)f=f*mat(s[i-1],s[i]);\nprintf(\"%d\\n\",f[0][0]);\n```\n\u7ebf\u6bb5\u6811 `update`\uff1a\n```cpp\nvoid update(int rt,int l,int r,int p)\n{\n\tif(l==r){t[rt]=mat(s[l-1],s[l]);return;}\n\tint mid=(l+r)>>1;\n\tif(p<=mid)update(rt<<1,l,mid,p);\n\telse update(rt<<1|1,mid+1,r,p);\n\tt[rt]=t[rt<<1]*t[rt<<1|1];\n}\n```",
        "postTime": 1603880418,
        "uid": 35137,
        "name": "a___",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF575A \u3010Fibonotci\u3011"
    },
    {
        "content": "\u6807\u7b7e: \u77e9\u9635\u5feb\u901f\u5e42, \u7ebf\u6bb5\u6811.\n\n#### Part 1\n\n\u9996\u5148\u53d1\u73b0\u5982\u679c\u6ca1\u6709 $m$ \u4e2a\u7279\u6b8a\u4f4d\u7f6e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u77e9\u9635\u5feb\u901f\u5e42.\n\n\u7531\u4e8e\u8f6c\u79fb\u7684\u77e9\u9635\u5177\u6709\u5468\u671f\u6027, \u6211\u4eec\u53ef\u4ee5\u7279\u6b8a\u5904\u7406 $m$ \u4e2a\u7279\u6b8a\u4f4d\u7f6e\u5f71\u54cd\u5230\u7684 $\\mathcal O(m)$ \u4e2a\u5468\u671f, \u672a\u88ab\u5f71\u54cd\u7684\u5468\u671f\u77e9\u9635\u5feb\u901f\u5e42\u5373\u53ef.\n\n\u8fd9\u6837\u5f88\u5bb9\u6613\u5f97\u5230\u4e00\u4e2a $\\mathcal O(m(n+\\log k))$ \u7684\u66b4\u529b\u505a\u6cd5\u4e86.\n\n#### Part 2\n\n\u663e\u7136 $\\mathcal O(nm)$ \u4e0d\u591f\u4f18\u79c0, \u9700\u8981\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u8f6c\u79fb\u77e9\u9635.\n\n\u6ce8\u610f\u8fd9\u91cc\u7684\u6bcf\u4e2a\u7279\u6b8a\u7684 $s$ \u90fd\u4f1a\u5f71\u54cd\u5230\u4e24\u4e2a\u77e9\u9635, \u5e76\u4e14\u7531\u4e8e\u4e24\u4e2a\u77e9\u9635\u53ef\u80fd\u8de8\u8d8a\u4e24\u4e2a\u4e0d\u540c\u5468\u671f, \u6545\u6211\u4eec\u5b58\u50a8\u662f\u6700\u597d\u5206\u6210\u4e24\u4e2a\u6765\u5b58.\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(m(\\log n+\\log k))$.\n\n```cpp\n#include <bits/stdc++.h>\n#define root 1, n, 1\n#define ls l, mid, k << 1\n#define rs mid + 1, r, k << 1 | 1\nusing namespace std;\nlong long read();\nlong long K;\nint P, n, m;\nint s[50004];\nstruct T {\n    long long p;\n    int s, type;\n} t[100005];\n\nbool cmp(T x, T y) { return x.p < y.p; }\n\nstruct Mat {\n    int a[2][2];\n    int *operator[](int p) { return a[p]; }\n    Mat operator*(Mat b) {  // lmul\n        Mat rt;\n        for (int i = 0; i < 2; ++i)\n            for (int j = 0; j < 2; ++j)\n                rt[i][j] = (1ll * b[i][0] * a[0][j] % P +\n                            1ll * b[i][1] * a[1][j] % P) %\n                           P;\n        return rt;\n    }\n    void prt() {\n        for (int i = 0; i < 2; ++i, cout << endl)\n            for (int j = 0; j < 2; ++j) cout << a[i][j] << ' ';\n    }\n} a[50004], ta[50004], res;\n\nstruct Seg {\n    Mat t[200005];\n\n    void update(int k) { t[k] = t[k << 1] * t[k << 1 | 1]; }\n\n    void build(int l, int r, int k) {\n        if (l == r) return t[k] = a[l], void();\n        int mid = l + r >> 1;\n        build(ls), build(rs), update(k);\n    }\n\n    void set(int l, int r, int k, int pos) {\n        if (l == r) return t[k] = ta[l], void();\n        int mid = l + r >> 1;\n        pos <= mid ? set(ls, pos) : set(rs, pos), update(k);\n    }\n} seg;\n\nvoid fsp(Mat bs, long long p) {\n    while (p) {\n        if (p & 1) res = res * bs;\n        bs = bs * bs, p >>= 1;\n    }\n}\n\nint main() {\n    K = read(), P = read(), n = read();\n    for (int i = 0; i < n; ++i) s[i] = read() % P;\n    for (int i = 1; i <= n; ++i)\n        a[i][0][1] = 1, a[i][1][0] = s[i - 1], a[i][1][1] = s[i % n],\n        ta[i] = a[i];\n    m = read();\n    for (int i = 1; i <= m; ++i)\n        t[i + m].p = (t[i].p = read()) + 1, t[i].s = t[i + m].s = read() % P,\n              t[i].type = 1;\n\n    m <<= 1, seg.build(root), sort(t + 1, t + 1 + m, cmp);\n    while (m && t[m].p > K) --m;\n    res[1][1] = 1;\n    long long np = 0, tp;\n    for (int i = 1, j = 1; i <= m; i = j + 1) {\n        tp = (t[j = i].p - 1) / n;\n        while (j < m && tp == (t[j + 1].p - 1) / n) ++j;\n        fsp(seg.t[1], tp - np), np = tp;\n        for (int k = i, pos; k <= j; ++k)\n            ta[pos = (t[k].p - 1) % n + 1][1][t[k].type] = t[k].s,\n                                        seg.set(root, pos);\n\n        if (tp == K / n) break;\n        res = res * seg.t[1], ++np;\n        for (int k = i; k <= j; ++k) {\n            int pos = (t[k].p - 1) % n + 1;\n            ta[pos] = a[pos], seg.set(root, pos);\n        }\n    }\n    tp = K / n, fsp(seg.t[1], tp - np);\n\n    for (int i = 1; i <= K % n; ++i) res = res * ta[i];\n    printf(\"%d\\n\", res[0][1]);\n    return 0;\n}\nconst int _SIZE = 1 << 22;\nchar ibuf[_SIZE], *iS = ibuf, *iT = ibuf;\n#define gc                                                         \\\n    (iS == iT ? iT = ((iS = ibuf) + fread(ibuf, 1, _SIZE, stdin)), \\\n     (iS == iT ? EOF : *iS++) : *iS++)\nlong long read() {\n    long long x = 0;\n    char c = gc;\n    while (!isdigit(c)) c = gc;\n    while (isdigit(c)) x = x * 10 + c - '0', c = gc;\n    return x;\n}\n```",
        "postTime": 1580566177,
        "uid": 51237,
        "name": "Kinandra",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF575A \u3010Fibonotci\u3011"
    },
    {
        "content": "> [CF575A Fibonotci](https://codeforc.es/contest/575/problem/A)\n\n## \u9898\u610f\n\n- $s_{0\\dots +\\infty}$ \u662f\u4e00\u4e2a\u6b63\u6574\u6570\u5e8f\u5217\u3002\n- \u7ed9\u5b9a $s_{0 \\dots n - 1}$\uff0c\u5bf9\u4e8e $i \\ge n$\uff0c\u6709 $m$ \u4e2a $i$ \u7ed9\u5b9a $s_i$\uff0c\u5269\u4e0b\u7684 $i$ \u6ee1\u8db3 $s_i = s_{i \\bmod n}$\u3002\n- $f_{0 \\dots +\\infty}$ \u540c\u6837\u662f\u4e00\u4e2a\u6b63\u6574\u6570\u5e8f\u5217\u3002\n- \u7ed9\u5b9a $f_0,f_1$\uff0c\u5bf9\u4e8e $i \\ge 2$\uff0c$f_i = s_{i-1}f_{i-1} + s_{i-2}f_{i-2}$\u3002\n- \u6c42 $f_k \\bmod p$\u3002\n- $n,m \\le 5 \\times 10^4$\uff0c$k \\le 10^{18}$\uff0c$s_i,p \\le 10^9$\u3002\n\n## \u9898\u89e3\n\n\u9996\u5148\u8003\u8651 $m = 0$ \u7684\u60c5\u51b5\u3002\n\n\u7531\u4e8e $f_i = s_{i-1}f_{i-1} + s_{i-2}f_{i-2}$\uff0c\u6709 $\\begin{bmatrix} f_{i-2} & f_{i-1} \\end{bmatrix} \\times \\begin{bmatrix} 0 & s_{i-2} \\\\\\\\ 1 & s_{i-1} \\end{bmatrix} = \\begin{bmatrix} f_{i-1} & f_i \\end{bmatrix}$\u3002\n\n\u56e0\u6b64 $\\begin{bmatrix} f_{0} & f_{1} \\end{bmatrix} \\times \\prod_{i=1}^{n} \\begin{bmatrix} 0 & s_{i-1} \\\\\\\\ 1 & s_{i \\bmod n} \\end{bmatrix} = \\begin{bmatrix} f_{n} & f_{n+1} \\end{bmatrix}$\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u6700\u540e\u4e00\u6bb5\u53ef\u4ee5\u66b4\u529b\u8f6c\u79fb\u3002\n\n\u8003\u8651 $m \\ne 0$ \u65f6\uff0c**\u7ebf\u6bb5\u6811**\u7ef4\u62a4\u77e9\u9635\u4e58\u79ef\u3002\n\n\u6bcf\u6b21\u53ea\u4f1a\u4fee\u6539\u4e24\u4e2a\u77e9\u9635\uff0c\u56e0\u6b64\u4e00\u5171\u53ea\u6709 $\\mathcal O(m)$ \u4e2a\u5355\u70b9\u4fee\u6539\u3002\n\n\u56e0\u6b64\u53ef\u4ee5\u5728\u6ca1\u6709\u7279\u6b8a\u503c\u7684\u5468\u671f\u5185\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8f6c\u79fb\uff0c\u6709\u7279\u6b8a\u503c\u7684\u5468\u671f\u5185\u5355\u70b9\u4fee\u6539\u4e4b\u540e\u518d\u8f6c\u79fb\u518d\u4fee\u6539\u56de\u53bb\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n + m (\\log k + \\log n))$\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst int N = 5e4 + 7;\nll k, o;\nint n, m, x;\nmodint s[N];\n\nstruct mt {\n\tint n, m; modint a[2][2];\n\tinline mt() {}\n\tinline mt(int n, int m) : n(n), m(m) { memset(a, 0, sizeof(a)); }\n\tinline friend mt operator * (mt x, mt y) {\n\t\tmt z(x.n, y.m);\n\t\tfor (int i = 0; i < z.n; i++)\n\t\t\tfor (int k = 0; k < x.m; k++)\n\t\t\t\tfor (int j = 0; j < z.m; j++)\n\t\t\t\t\tz.a[i][j] += x.a[i][k] * y.a[k][j];\n\t\treturn z;\n\t}\n} a[N], b[N], f;\n\ninline void ksm(mt x, ll y, mt &z) {\n\twhile (y) {\n\t\tif (y & 1) z = z * x;\n\t\tx = x * x, y >>= 1;\n\t}\n}\n\nstruct Q {\n\tll x, k; modint y;\n\tinline bool operator < (Q o) { return x < o.x; }\n} q[N<<1];\n\nstruct T {\n\tint l, r; mt x;\n} t[N<<2];\n\ninline void build(int p, int l, int r) {\n\tt[p].l = l, t[p].r = r;\n\tif (l == r) return t[p].x = a[l], void();\n\tbuild(ls, l, md), build(rs, md + 1, r);\n\tt[p].x = t[ls].x * t[rs].x;\n}\n\ninline void chg(int p, int x, mt y) {\n\tif (t[p].l == t[p].r) return t[p].x = y, void();\n\tchg(x <= md ? ls : rs, x, y), t[p].x = t[ls].x * t[rs].x;\n}\n\nint main() {\n\trd(k), rd(P), rd(n);\n\tfor (int i = 0; i < n; i++) rd(x), s[i] = x % P;\n\tfor (int i = 1; i <= n; i++) a[i] = mt(2, 2), a[i].a[0][1] = s[i-1], a[i].a[1][1] = s[i%n], a[i].a[1][0] = 1, b[i] = a[i];\n\tbuild(1, 1, n), rd(m);\n\tfor (int i = 1; i <= m; i++) rd(q[i].x), q[m+i].x = q[i].x + 1, q[i].k = 1, rd(x), q[m+i].y = q[i].y = x % P;\n\tsort(q + 1, q + (m <<= 1) + 1);\n\twhile (m && q[m].x > k) --m;\n\tf = mt(1, 2), f.a[0][1] = 1;\n\tfor (int i = 1, j = 1; i <= m; i = ++j) {\n\t\tll w = (q[i].x - 1) / n;\n\t\twhile (j < m && w == (q[j+1].x - 1) / n) ++j;\n\t\tksm(t[1].x, w - o, f), o = w;\n\t\tfor (int k = i; k <= j; k++) {\n\t\t\tint d = (q[k].x - 1) % n + 1;\n\t\t\tb[d].a[q[k].k][1] = q[k].y, chg(1, d, b[d]);\n\t\t}\n\t\tif (w == k / n) break;\n\t\tf = f * t[1].x, o = w + 1;\n\t\tfor (int k = i; k <= j; k++) {\n\t\t\tint d = (q[k].x - 1) % n + 1;\n\t\t\tchg(1, d, b[d] = a[d]);\n\t\t}\n\t}\n\tll w = k / n;\n\tksm(t[1].x, w - o, f);\n\tfor (int i = 1, d = k % n; i <= d; i++) f = f * b[i];\n\tprint(f.a[0][0]);\n\treturn 0;\n}\n```",
        "postTime": 1575729470,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF575A \u3010Fibonotci\u3011"
    },
    {
        "content": "\u6709\u9012\u63a8\u5f0f\uff1a\n\n$$\n\\begin{aligned}\n\n\\begin{bmatrix} f_{i}&f_{i-1} \\end{bmatrix}\n\n=\n\n\\begin{bmatrix} f_{i-1}&f_{i-2} \\end{bmatrix}\n\\times\n\n\\begin{bmatrix} s_{i-1}&1\\\\s_{i-2}&0 \\end{bmatrix}\n\n\\end{aligned}\n$$\n\n\u7531\u4e0a\u6211\u4eec\u53ea\u9700\u8981\u7b97\u51fa\uff1a\n\n$$\n\n\\prod_{i=1}^{k-1}\\begin{bmatrix} s_{i}&1\\\\s_{i-1} &0 \\end{bmatrix}\n\n$$\n\n\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u77e9\u9635\u4e58\u79ef\uff0c\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u89e3\u51b3\u65e0\u7279\u6b8a\u503c\u7684\u60c5\u51b5\u3002\n\n\u79f0 $\\begin{bmatrix} s_{i}&1\\\\s_{i-1}&0 \\end{bmatrix}$ \u4e3a\u77e9\u9635 $T_i$\uff0c\u53d1\u73b0 $s_j=v$ \u53ea\u4f1a\u5f71\u54cd\u5230 $T_j$ \u548c $T_{j+1}$\uff0c\u603b\u5f71\u54cd\u4e2a\u6570\u5728 $O(m)$ \u7ea7\u522b\u3002\n\n\u8fd9\u9898\u7ec6\u8282\u6bd4\u8f83\u591a\uff0c\u8003\u8651\u6309\u4e0b\u6807\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u6bcf\u4e00\u4e2a\u7279\u6b8a\u503c\uff0c\u82e5\u591a\u4e2a\u7279\u6b8a\u503c\u4f4d\u7f6e\u76f8\u90bb\uff08\u6bd4\u5982\u4e24\u4e2a\u7279\u6b8a\u503c\u53ea\u4f1a\u5f71\u54cd\u4e09\u4e2a\u77e9\u9635\uff09\u628a\u5b83\u4eec\u4e00\u8d77\u5904\u7406\uff0c\u66b4\u529b\u8ba1\u7b97\u8fd9\u4e00\u5757\uff0c\u800c\u5757\u95f4\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u548c\u77e9\u9635\u5feb\u901f\u5e42\u7ef4\u62a4\u3002\u5177\u4f53\u7684\uff0c\u53ef\u4ee5\u5199\u4e00\u4e2a\u51fd\u6570 `calc(l,r)` \u8868\u793a\u8ba1\u7b97\u4e0b\u6807\u5728 $[l,r]$ \u5185\u7684\u77e9\u9635\u4e58\u79ef\u3002\n\n\u8fd8\u9700\u8981\u65f6\u523b\u6ce8\u610f\u679a\u4e3e\u503c\u548c $k-1$ \u7684\u5173\u7cfb\uff0c\u82e5\u8d85\u8fc7\u53ca\u65f6 `break`\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff08\u8c03\u4e86\u4e00\u4e0b\u5348\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\ninline int read(){\n\tint x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c<='9'&&c>='0'){\n\t\tx=(x<<1)+(x<<3)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\n\nvoid print(int x){\n\tif(x<0)putchar('-'),x=-x;\n\tif(x>9)print(x/10);\n\tputchar(x%10^48);\n}\n\nconst int N=5e4+5;\nint n,m,k,mod,s[N];\nstruct modify_node{\n    int j,v;\n    bool operator<(const modify_node &P)const{return j<P.j;}\n}p[N];\n\nstruct Matrix{\n    int f[2][2];\n    Matrix(int a=1,int b=0,int c=0,int d=1){f[0][0]=a,f[0][1]=b,f[1][0]=c,f[1][1]=d;}\n    Matrix operator*(Matrix b){\n        return (Matrix){\n            (f[0][0]*b.f[0][0]+f[0][1]*b.f[1][0])%mod,\n            (f[0][0]*b.f[0][1]+f[0][1]*b.f[1][1])%mod,\n            (f[1][0]*b.f[0][0]+f[1][1]*b.f[1][0])%mod,\n            (f[1][0]*b.f[0][1]+f[1][1]*b.f[1][1])%mod\n        };\n    }\n};\n\nMatrix qpow(Matrix a,int b){\n    Matrix ans;\n    while(b){\n        if(b&1)ans=ans*a;\n        a=a*a,b>>=1;\n    }return ans;\n}\n\nstruct SGT{\n    Matrix t[N<<2];\n    void build(int l,int r,int p){\n        if(l==r){t[p]=(Matrix){s[l%n],1,s[l-1],0};return;}\n        int mid=(l+r)>>1;\n        build(l,mid,p<<1),build(mid+1,r,p<<1|1);\n        t[p]=t[p<<1]*t[p<<1|1];\n    }\n\n    void modify0(int l,int r,int pos,int x,int p){\n        if(l==r){t[p]=(Matrix){x,1,s[l-1],0};return;}\n        int mid=(l+r)>>1;\n        if(pos<=mid)modify0(l,mid,pos,x,p<<1);\n        else modify0(mid+1,r,pos,x,p<<1|1);\n        t[p]=t[p<<1]*t[p<<1|1];\n    }\n\n    void modify1(int l,int r,int pos,int x,int p){\n        if(l==r){t[p]=(Matrix){s[l%n],1,x,0};return;}\n        int mid=(l+r)>>1;\n        if(pos<=mid)modify1(l,mid,pos,x,p<<1);\n        else modify1(mid+1,r,pos,x,p<<1|1);\n        t[p]=t[p<<1]*t[p<<1|1];\n    }\n\n    Matrix qry(int l,int r,int lq,int rq,int p){\n        if(lq<=l&&r<=rq)return t[p];\n        int mid=(l+r)>>1;Matrix ans;\n        if(lq>rq)return ans;\n        if(lq<=mid)ans=ans*qry(l,mid,lq,rq,p<<1);\n        if(mid<rq)ans=ans*qry(mid+1,r,lq,rq,p<<1|1);\n        return ans;\n    }\n}T;\n\nMatrix calc(int l,int r){\n    Matrix ans,tmp;\n    if(l>r)return ans;\n    if((l+n-1)/n==(r+n-1)/n){\n        l=l%n;if(!l)l=n;r=r%n;if(!r)r=n;\n        return T.qry(1,n,l,r,1);\n    }\n    if(l%n!=1)ans=ans*T.qry(1,n,(l%n==0?n:l%n),n,1),l+=(n-(l%n==0?n:l%n)+1);\n    if(r%n!=0)tmp=tmp*T.qry(1,n,1,r%n,1),r-=(r%n);\n    ans=ans*qpow(T.t[1],(r+n-1)/n-(l+n-1)/n+1)*tmp;\n    return ans;\n}\n\nsigned main(){\n    k=read(),mod=read(),n=read();\n    for(int i=0;i<n;++i)s[i]=read();\n    T.build(1,n,1),m=read();\n    for(int i=1;i<=m;++i)p[i].j=read(),p[i].v=read();\n    sort(p+1,p+m+1);\n    if(k==0){puts(\"0\");return 0;}\n    if(k==1){print(1%mod);return 0;}\n    Matrix ans;\n    int lst=0;\n    for(int i=1;i<=m;++i){\n        int L=i,R=i;\n        ans=ans*calc(lst+1,min(p[i].j-1,k-1));\n        lst=max(p[R].j-1,min(p[i].j-1,k-1));\n        if(p[R].j>k-1)break;\n        while(p[R+1].j==p[R].j+1&&p[R+1].j<=k-1)R++;\n        if(L==R){\n            int tmp=(p[L].j%n==0?n:p[L].j%n);\n            ans=ans*(Matrix){p[L].v,1,s[tmp-1],0};\n        }else for(int t=L;t<=R;++t){\n            if(t==L)ans=ans*(Matrix){p[L].v,1,s[(p[L].j-1)%n],0};\n            else if(t==R)ans=ans*(Matrix){p[R].v,1,p[R-1].v,0};\n            else ans=ans*(Matrix){p[t].v,1,p[t-1].v,0};\n        }\n        lst=p[R].j+1;\n        if(p[R].j<k-1)ans=ans*(Matrix){s[(p[R].j+1)%n],1,p[R].v,0};\n        else break;\n        i=R;\n    }\n    if(lst<k-1)ans=ans*calc(lst+1,k-1);\n    print(ans.f[0][0]);\n    return 0;\n}\n```",
        "postTime": 1678796096,
        "uid": 271736,
        "name": "Daidly",
        "ccfLevel": 6,
        "title": "CF575A Fibonotci \u9898\u89e3"
    },
    {
        "content": "## \u9898\u89e3\n\n\u770b\u5230\u7ebf\u6027\u9012\u63a8\uff0c\u679c\u65ad\u4e0a**\u77e9\u9635**\uff1a\n\n$$\n\\begin{bmatrix}\nF_{n-2} & F_{n-1}\n\\end{bmatrix}\n*\n\\begin{bmatrix}\n0 & s_{n-2}\\\\\n1 & s_{n-1}\n\\end{bmatrix}\n\n=\n\\begin{bmatrix}\nF_{n-1} & F_{n}\n\\end{bmatrix}\n$$\n\n\u8fdb\u4e00\u6b65\u6709\uff1a\n\n$$\n\\begin{bmatrix}\nF_{0} & F_{1}\n\\end{bmatrix}\n*\n\\prod_{i=0}^{k-2}\n\\begin{bmatrix}\n0 & s_{i}\\\\\n1 & s_{i+1}\n\\end{bmatrix}\n\n=\n\\begin{bmatrix}\nF_{k-1} & F_{k}\n\\end{bmatrix}\n$$\n\n\u7531\u4e8e $s_i \\neq s_{i \\bmod n}$ \u7684\u90e8\u5206\u53ef\u5355\u72ec\u8ba1\u7b97\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u77e9\u9635\u7684\u533a\u95f4\u4e58\u79ef\uff1a\n\n$$\\prod_{i=l}^{r}\n\\begin{bmatrix}\n0 & s_{i}\\\\\n1 & s_{i+1}\n\\end{bmatrix}$$\n\n\u4ece $0$ \u5f00\u59cb\u5c06\u503c\u57df\u5206\u6210 $[0,n-1],[n,2n-1]$ \u7b49\u82e5\u5e72\u4e2a\u5927\u5c0f\u4e3a $n$ \u7684\u5757\uff0c\u5e76\u6309\u7167\u7aef\u70b9 $l,r$ \u6240\u5728\u5757\u7684\u60c5\u51b5\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $l$ \u548c $r$ \u5728\u540c\u4e00\u5757\u3002\uff08\u5373 $\\lfloor \\dfrac{l}{n} \\rfloor=\\lfloor \\dfrac{r}{n} \\rfloor$ \u65f6\uff09\n\n\t- \u6b64\u65f6\u8981\u6c42\u7684\u5f0f\u5b50\u5373\u4e3a\uff1a\n    \n\t\t$$\\prod_{i=l \\bmod n}^{r \\bmod n}\n      \\begin{bmatrix}\n      0 & s_{i}\\\\\n      1 & s_{i+1}\n      \\end{bmatrix}$$\n\n\t- \u7531\u4e8e\u77e9\u9635\u4e0d\u4e00\u5b9a\u53ef\u4ee5\u6c42\u9006\uff0c\u6240\u4ee5\u65e0\u6cd5\u4f7f\u7528\u524d\u7f00\u548c\u7684\u601d\u60f3\u3002\n\n   - \u4e8e\u662f\u4f7f\u7528**\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u4e58\u79ef**\u3002\n\n1. $l$ \u548c $r$ \u4e0d\u5728\u540c\u4e00\u5757\u3002\n\n\t- \u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u5206\u6210\u4e09\u6bb5\uff1a$[l,\\lceil \\dfrac{l}{n} \\rceil \\cdot n-1]$\uff0c$[\\lceil \\dfrac{l}{n} \\rceil \\cdot n,\\lfloor \\dfrac{r}{n} \\rfloor \\cdot n-1]$\uff0c$[\\lfloor \\dfrac{r}{n} \\rfloor \\cdot n,r]$\uff0c\u5373\u524d\u7f00\u3001\u6574\u5757\u548c\u540e\u7f00\u3002\n   - \u5bf9\u4e8e\u524d\u540e\u7f00\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5148\u5904\u7406\u597d\u3002\uff08\u5f53\u7136\u4f60\u8981\u7528\u7ebf\u6bb5\u6811\u76f4\u63a5\u67e5\u4e5f\u53ef\u4ee5\uff09\n   - \u5bf9\u4e8e\u6574\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528**\u77e9\u9635\u5feb\u901f\u5e42**\u6c42\u4ee5\n      $\\prod_{i=0}^{n-1}\n      \\begin{bmatrix}\n      0 & s_{i}\\\\\n      1 & s_{i+1}\n      \\end{bmatrix}$\n      \u4e3a\u5e95\u7684\u5e42\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(M\\log{N} \\cdot 2^3)$\u3002\uff08$2^3$ \u662f\u77e9\u9635\u4e58\u6cd5\u590d\u6742\u5ea6\uff0c\u4e5f\u53ef\u4ee5\u770b\u4f5c\u5e38\u6570\uff09\n\n\u6ce8\u610f\u4e00\u4e9b\u5b9e\u73b0\u4e0a\u7684\u7ec6\u8282\uff1a\n\n1. $P=1$ \u7684\u5904\u7406\u3002\n1. $K<2$ \u7684\u5904\u7406\u3002\n1. $j \\ge K$ \u7684\u5904\u7406\u3002\n1. $s_i \\neq s_{i \\bmod n}$ \u4e14 $s_{i+1} \\neq s_{(i+1) \\bmod n}$ \u7684\u5904\u7406\u3002\n1. \u2026\u2026\uff08\u8bf7\u53c2\u8003\u4ee3\u7801\u7684\u5b9e\u73b0\uff09\n\n## \u4ee3\u7801\n\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long K;\nint P,N,M;\nconst int max_N=5e4+5;\nint s[max_N];\nstruct Matrix\n{\n\tint a,b,c,d;\n\tinline Matrix(int x=0,int y=0,int z=0,int w=0)\n\t{\n\t\ta=x,b=y,c=z,d=w;\n\t}\n}pref[max_N],suff[max_N],ans(0,1,0,0),A;\ninline Matrix operator * (const Matrix &p,const Matrix &q)\n{\n\treturn Matrix((1ll*p.a*q.a+1ll*p.b*q.c)%P,\n\t(1ll*p.a*q.b+1ll*p.b*q.d)%P,\n\t(1ll*p.c*q.a+1ll*p.d*q.c)%P,\n\t(1ll*p.c*q.b+1ll*p.d*q.d)%P);\n}\nnamespace SegTree\n{\n\tMatrix val[max_N<<2];\n\t#define ls(p) ((p)<<1)\n\t#define rs(p) ((p)<<1|1)\n\tvoid build(int p,int l,int r)\n\t{\n\t\tif(l==r)\n\t\t{\n\t\t\tval[p]=Matrix(0,s[l],1,s[l+1]);\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tbuild(ls(p),l,mid);\n\t\tbuild(rs(p),mid+1,r);\n\t\tval[p]=val[ls(p)]*val[rs(p)];\n\t}\n\tvoid query(int p,int l,int r,int a,int b)\n\t{\n\t\tif(a<=l&&r<=b)\n\t\t{\n\t\t\tans=ans*val[p];\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tif(a<=mid)\n\t\t\tquery(ls(p),l,mid,a,b);\n\t\tif(b>mid)\n\t\t\tquery(rs(p),mid+1,r,a,b);\n\t}\n}\ninline void solve(long long l,long long r) // (s[l],s[l+1])...(s[r-1],s[r])\n{\n\t--r;\n\tif(l>r)\n\t\treturn;\n\tif(l/N==r/N)\n\t{\n\t\tSegTree::query(1,0,N-1,l%N,r%N);\n\t\treturn;\n\t}\n\tans=ans*suff[l%N];\n\tlong long t=r/N-l/N-1;\n\tA=pref[N-1];\n\twhile(t)\n\t{\n\t\tif(t&1)\n\t\t\tans=ans*A;\n\t\tA=A*A;\n\t\tt>>=1;\n\t}\n\tans=ans*pref[r%N];\n}\ntypedef pair<long long,int> plli;\nconst int max_M=5e4+5;\nplli extra[max_M];\nint main()\n{\n\tscanf(\"%lld%d%d\",&K,&P,&N);\n\tif(P==1)\n\t{\n\t\tputs(\"0\");\n\t\treturn 0;\n\t}\n\tif(K<2)\n\t{\n\t\tprintf(\"%lld\\n\",K);\n\t\treturn 0;\n\t}\n\tfor(int i=0;i<N;++i)\n\t\tscanf(\"%d\",s+i);\n\ts[N]=s[0];\n\tpref[0]=Matrix(0,s[0],1,s[1]);\n\tfor(int i=1;i<N;++i)\n\t\tpref[i]=pref[i-1]*Matrix(0,s[i],1,s[i+1]);\n\tsuff[N-1]=Matrix(0,s[N-1],1,s[0]);\n\tfor(int i=N-2;i>=0;--i)\n\t\tsuff[i]=Matrix(0,s[i],1,s[i+1])*suff[i+1];\n\tSegTree::build(1,0,N-1);\n\tscanf(\"%d\",&M);\n\tfor(int i=1;i<=M;++i)\n\t\tscanf(\"%lld%d\",&extra[i].first,&extra[i].second);\n\tsort(extra+1,extra+M+1);\n\twhile(M>=1&&extra[M].first>=K)\n\t\t--M;\n\tif(!M)\n\t{\n\t\tsolve(0,K-1);\n\t\tprintf(\"%d\\n\",ans.b);\n\t\treturn 0;\n\t}\n\tsolve(0,extra[1].first-1);\n\tfor(int i=1;i<=M;++i)\n\t{\n\t\tif(i==1||extra[i-1].first!=extra[i].first-1)\n\t\t\tans=ans*Matrix(0,s[(extra[i].first-1)%N],1,extra[i].second);\n\t\telse\n\t\t\tans=ans*Matrix(0,extra[i-1].second,1,extra[i].second);\n\t\tif(extra[i].first+1<=K-1&&(i==M||extra[i+1].first!=extra[i].first+1))\n\t\t\tans=ans*Matrix(0,extra[i].second,1,s[(extra[i].first+1)%N]);\n\t\tif(i<M)\n\t\t\tsolve(extra[i].first+1,extra[i+1].first-1);\n\t}\n\tsolve(extra[M].first+1,K-1);\n\tprintf(\"%d\\n\",ans.b);\n\treturn 0;\n}\n```",
        "postTime": 1631868144,
        "uid": 145355,
        "name": "wsyhb",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF575A Fibonotci"
    },
    {
        "content": "\u8003\u8bd5\u7684\u65f6\u5019\u5199\u4e863.5h , \u8003\u540e\u53c8\u5199\u4e862h \u624d\u8fc7\u6389\u3002\n\n\u6bcf\u6b21\u4fee\u6539\u53ea\u4f1a\u5f71\u54cd\u4e24\u4e2a\u77e9\u9635\uff0c\u53ef\u4ee5\u66b4\u529b\u8ba1\u7b97\u3002\n\n\u6211\u4eec\u77e5\u9053\u77e9\u9635\u4e58\u6cd5\u6709\u7ed3\u5408\u5f8b\uff0c\u90a3\u4e48\u4e24\u6b21\u4fee\u6539\u4e4b\u95f4\u7684\u77e9\u9635\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u4e58\u79ef\u3002\n\n\u56e0\u4e3a\u6709\u6563\u6bb5\u6240\u4ee5\u8003\u8651\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u77e9\u9635\u7684\u4e58\u6cd5\uff0c\u6574\u6bb5\u76f4\u63a5\u77e9\u9635\u5feb\u901f\u5e42\n\n\u4f46\u8981\u6ce8\u610f\u4fee\u6539\u64cd\u4f5c\u76f8\u90bb\u65f6\u5f71\u54cd\u7684\u77e9\u9635\u4f1a\u91cd\u590d\uff0c\u53ef\u4ee5\u5b58\u8fdb vector \u91cc\u66b4\u529b\u4fee\u6539\u540e\u4e00\u8d77\u4e58\u3002\n\n\u4ee3\u7801\u5927\u90e8\u5206\u662f\u8003\u573a\u5199\u7684\uff0c\u592a\u4e11\u5c31\u4e0d\u653e\u4e86\u3002~~\u867d\u7136\u53e3\u80e1\u5f88\u7b80\u5355\u4f46\u662f\u5199\u8d77\u6765\u662f\u771f\u7684\u6076\u5fc3\u3002~~",
        "postTime": 1606297384,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF575A \u3010Fibonotci\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\uff1a\n$s$\u662f\u4e00\u4e2a\u5faa\u73af\u6570\u5217\uff0c\u73b0\u5728\u5c06$s$\u4e2d\u7684$m$\u9879\u8fdb\u884c\u6539\u53d8\u3002\n\n$f$\u662f\u4e00\u4e2a\u6570\u5217\uff0c\u6ee1\u8db3$f_0=0,f_1=1$,\u4e14\u5bf9\u4e8e$i>=2,f_i=f_{i-1}*s_{i-1}+f_{i-2}*s_{i-2}$;\n\n\u6c42$f_k$\u5728\u6a21$p$\u610f\u4e49\u4e0b\u7684\u503c\u3002\n## \u89e3\u9898\u601d\u8def\uff1a\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u7528\u77e9\u9635\u4f18\u5316\u6570\u5217\u9012\u63a8\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u53bb\u505a\u4e86\uff1a\n\n\u9996\u5148\u5c06\u4e00\u4e2a\u5faa\u73af\u8282\u7684\u77e9\u9635\u653e\u5728\u7ebf\u6bb5\u6811\u5185\u3002\u7136\u540e\u6bcf\u6b21\u4e00\u4e2a\u5faa\u73af\u8282\u4e00\u4e2a\u5faa\u73af\u8282\u53bb\u64cd\u4f5c\u3002\n\n\u5982\u679c\u9047\u5230\u9700\u8981\u4fee\u6539\u7684\uff0c\u5c31\u53ef\u4ee5\u5c06\u5faa\u73af\u8282\u5185\u4e0d\u9700\u8981\u4fee\u6539\u7684\u4ece\u7ebf\u6bb5\u6811\u5185\u67e5\u8be2\u51fa\u6765\uff0c\u5176\u4ed6\u66b4\u529b\u641e\u3002\n\n\u5982\u679c\u4e0d\u9700\u8981\u4fee\u6539\u7684\uff0c\u8fde\u7eed\u7684\u4e00\u7247\u5c31\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u3002\n# Code\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int N=50005;\nint kkk,M,n,s[N],m;\nstruct Ask{\n\tint x,y;\n}A[N];\nint cmp(Ask x,Ask y){\n\treturn x.x<y.x;\n}\nstruct zz{\n\tint a[2][2];\n}I;\nzz cf(zz x,zz y){\n\tzz z;memset(z.a,0,sizeof z.a);\n\tfor (int i=0;i<2;i++)\n\t\tfor (int j=0;j<2;j++)\n\t\t\tfor (int k=0;k<2;k++)\n\t\t\t\t(z.a[i][j]+=x.a[i][k]*y.a[k][j])%=M;\n\treturn z;\t\t\t\n}\nzz ksm(zz x,int y){\n\tzz ans;memset(ans.a,0,sizeof ans.a);\n\tfor (int i=0;i<2;i++)ans.a[i][i]=1;\n\tfor (;y;y>>=1,x=cf(x,x))\n\t\tif (y&1)ans=cf(ans,x);\n\treturn ans;\t\n}\nstruct Tree{\n\tint l,r;\n\tzz num;\n}T[N*4];\nvoid build(int x,int l,int r){\n\tT[x].l=l;T[x].r=r;\n\tif (l==r){\n\t\tT[x].num.a[1][0]=1;\n\t\tT[x].num.a[0][0]=s[(l+1)%n];\n\t\tT[x].num.a[0][1]=s[l%n];\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tbuild(x*2,l,mid);\n\tbuild(x*2+1,mid+1,r);\n\tT[x].num=cf(T[x*2+1].num,T[x*2].num);\n}\nzz findz(int x,int l,int r){\n\tif (T[x].l>r||l>T[x].r)return I;\n\tif (T[x].l>=l&&T[x].r<=r)return T[x].num;\n\treturn cf(findz(x*2+1,l,r),findz(x*2,l,r));\n}\nsigned main(){\n\tscanf(\"%lld%lld\",&kkk,&M);\n\tif (kkk==0){\n\t\tputs(\"0\");\n\t\treturn 0;\n\t}\n\tif (kkk==1){\n\t\tprintf(\"%lld\\n\",kkk%M);\n\t\treturn 0;\n\t}\n\tscanf(\"%lld\",&n);\n\tfor (int i=0;i<n;i++)scanf(\"%lld\",&s[i]),s[i]%=M;\n\tscanf(\"%lld\",&m);\n\tfor (int i=1;i<=m;i++)scanf(\"%lld%lld\",&A[i].x,&A[i].y),A[i].x--,A[i].y%=M;\n\tsort(A+1,A+m+1,cmp);\n\tI.a[0][0]=I.a[1][1]=1;\n\tbuild(1,0,n-1);\n\tkkk--;zz now=I;int ti=0;\n\tfor (int i=1;i<=m;i++){\n\t\tif (A[i].x>kkk)break;\n\t\tnow=cf(findz(1,ti%n,ti%n==0?-1:min(n-1,ti%n+A[i].x-ti-1)),now);\n\t\tti=ti%n==0?ti:min(A[i].x,(ti/n+1)*n);\n\t\tint k=A[i].x/n-ti/n;zz p=findz(1,0,n-1);\n\t\tnow=cf(ksm(p,k),now);\n\t\tti+=k*n;\n\t\tnow=cf(findz(1,ti%n,ti%n+A[i].x-ti-1),now);\n\t\tti=A[i].x;\n\t\tif (ti>=kkk)break;\n\t\tzz z;\n\t\tz.a[0][1]=s[A[i].x%n];\n\t\tz.a[0][0]=A[i].y;\n\t\tz.a[1][0]=1;\n\t\tz.a[1][1]=0;\n\t\tnow=cf(z,now);\n\t\tti++;\t\n\t\tint j=i+1;\n\t\twhile (j<=m&&A[j].x==A[i].x+1){\n\t\t\tzz z;\n\t\t\tz.a[0][0]=A[j].y;\n\t\t\tz.a[0][1]=A[i].y;\n\t\t\tz.a[1][0]=1;\n\t\t\tz.a[1][1]=0;\n\t\t\tnow=cf(z,now);\n\t\t\ti++;j++;\n\t\t\tti++;\n\t\t\tif (ti>=kkk)break;\n\t\t}\n\t\tif (ti>=kkk)break;\n\t\tz.a[0][1]=A[i].y;\n\t\tz.a[0][0]=s[(A[i].x+2)%n];\n\t\tz.a[1][0]=1;\n\t\tz.a[1][1]=0;\n\t\tnow=cf(z,now);\n\t\tti++;\n\t}\n\tif (ti<kkk){\n\t\tnow=cf(findz(1,ti%n,ti%n==0?-1:min(n-1,ti%n+kkk-ti-1)),now);\n\t\tti=ti%n==0?ti:min((ti/n+1)*n,kkk);\n\t\tint k=kkk/n-ti/n;\n\t\tnow=cf(ksm(findz(1,0,n-1),k),now);\n\t\tti+=k*n;\n\t\tnow=cf(findz(1,ti%n,ti%n+kkk-ti-1),now);\n\t\tti=kkk;\n\t}\n\tprintf(\"%lld\\n\",now.a[0][0]%M);\n}\n```",
        "postTime": 1571722890,
        "uid": 13237,
        "name": "\u60c5\u975e\u6614\u6bd4",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF575A \u3010Fibonotci\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u590d\u6742\u5ea6\u53ef\u80fd\u66f4\u4f18\u79c0\u7684\u505a\u6cd5\u3002\n\n\u4e0d\u4fdd\u8bc1\u6b63\u786e\u6027\uff0c\u5199\u4e86\u4f9d\u6258\u7b54\u8fa9\uff0c\u4e0d\u60f3\u5199\u4e86\uff0c\u7ec6\u8282\u5de8\u5927\u591a\uff0c\u76f4\u63a5\u53e3\u80e1\u4e86\u3002\n\n\u672c\u8d28\u4e0a\u8fd9\u9053\u9898\u76ee\u53ef\u4ee5\u8f6c\u5316\u4e3a\u7ed9\u4f60\u65e0\u7a77\u591a\u4e2a\u77e9\u9635 $a_i$\uff0c\u7ed9\u5b9a\u524d $n$ \u9879\uff0c$\\prod_{i=2}^{k}a_{i }$\uff0c\u5176\u4e2d\u5bf9\u4e8e\u5927\u591a\u6570\u7684 $a_i = a_{i \\bmod n}$\uff0c\u4f46\u662f\u6709\u4e00\u4e9b $a_i$ \u662f\u7ed9\u5b9a\u7684\u3002\n\n\u6211\u4eec\u53d1\u73b0\u9664\u4e86\u8fd9\u4e9b\u7ed9\u5b9a\u7684\u77e9\u9635\uff0c\u5176\u4ed6\u7684\u77e9\u9635\u4e58\u8d77\u6765\u90fd\u662f\u5468\u800c\u590d\u59cb\u7684\u3002\u8003\u8651\u5728\u6709\u7279\u6b8a\u70b9\u5904\u5206\u6bb5\uff0c\u7279\u6b8a\u70b9\u95f4\u7684\u6bb5\u53ef\u4ee5\u5212\u4e3a\u8bb8\u591a\u4e2a\u5b8c\u6574\u7684\u5468\u671f\u548c $1$ \u6216 $2$ \u4e2a\u533a\u95f4\u3002\n\n\u5bf9\u4e8e\u5b8c\u6574\u7684\u5468\u671f\uff0c\u53ef\u4ee5 $O(V^\\epsilon)-O(1)$ \u77e9\u9635\u5149\u901f\u5e42\uff0c\u5bf9\u4e8e\u533a\u95f4\uff0c\u6211\u4eec\u53d1\u73b0\u77e9\u9635\u4e58\u6cd5\u4e0d\u53ef\u51cf\uff0c\u4e8e\u662f\u53ea\u80fd\u7ebf\u6bb5\u6811\uff0c\u4f46\u8fd9\u6837\u53ea\u80fd\u505a\u5230 $O(n + m\\log n)$\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u7ebf\u6bb5\u6811 $\\text{build}$ \u662f $O(n)$ \u7684\uff0c$\\text{query}$ \u5374\u662f $O(\\log n)$\uff0c\u4e8e\u662f\u8003\u8651\u591a\u9884\u5904\u7406\u4e00\u4e9b\u4e1c\u897f\u3002\u8003\u8651\u6784\u9020\u4e00\u4e2a $B$ \u53c9\u7684\u7ebf\u6bb5\u6811\uff0c\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u7684\u8282\u70b9\u7ef4\u62a4\u4e00\u4e2a\u5c0f\u7684\u5927\u5c0f\u4e3a $B$ \u7684\u800c\u53c9\u7ebf\u6bb5\u6811 \u548c \u5b83\u5b69\u5b50\u7684\u524d\u540e\u7f00\u79ef\u3002\n\n\u6211\u4eec\u53d1\u73b0\u7ebf\u6bb5\u6811\u4e0a\u7684\u67e5\u8be2\u5206\u4e3a $4$ \u79cd\uff1a\n\n1. \u67e5\u8be2\u7684\u533a\u95f4\u5168\u5728\u67d0\u4e2a\u5b69\u5b50\u4e2d\uff0c\u9012\u5f52\u5373\u53ef;\n2. \u67e5\u8be2\u7684\u533a\u95f4\u6700\u5de6\u7aef\u4e0e\u8be5\u8282\u70b9\u7684\u533a\u95f4\u6240\u5bf9\u5e94\u7684\u6700\u5de6\u7aef\u76f8\u540c\uff0c\u6b64\u65f6\u53ef\u4ee5\u62c6\u6210\u4e00\u4e2a\u8be5\u8282\u70b9\u524d\u51e0\u4e2a\u88ab\u5b8c\u5168\u8986\u76d6\u5b69\u5b50\u7684\u79ef\uff08\u5df2\u9884\u5904\u7406\uff09 \u4e58\u4e0a \u9012\u5f52\u8fdb\u90a3\u4e2a\u6ca1\u6709\u88ab\u5b8c\u5168\u8986\u76d6\u7684\u5b69\u5b50\uff1b\n3. \u67e5\u8be2\u7684\u533a\u95f4\u6700\u53f3\u7aef\u4e0e\u8be5\u8282\u70b9\u7684\u533a\u95f4\u6240\u5bf9\u5e94\u7684\u6700\u53f3\u7aef\u76f8\u540c\uff0c\u4e0e $2$ \u540c\u7406\uff1b\n4. \u5426\u5219\u5c31\u5728\u8be5\u8282\u70b9\u7684\u7ebf\u6bb5\u6811\u4e0a\u67e5\u8be2\u90a3\u4e9b\u88ab\u5b8c\u5168\u8986\u76d6\u7684\u5b69\u5b50\u7684\u79ef\uff0c\u7136\u540e\u9012\u5f52\u5230\u4e24\u4e2a\u672a\u88ab\u5b8c\u5168\u8986\u76d6\u7684\u5b69\u5b50\u4e2d\uff0c\u6ce8\u610f\u5230\u8be5\u60c5\u51b5\u53ea\u4f1a\u51fa\u73b0\u4e00\u6b21\u3002\n\n\u7531\u4e8e\u9884\u5904\u7406\u4e0d\u7528\u5904\u7406\u53f6\u5b50\u8282\u70b9\uff0c\u6240\u4ee5\u8fd9\u6837\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u9884\u5904\u7406 $O(n)$\uff08\u4e0d\u5bf9\u5440\uff0c\u6211\u4e0d\u662f\u5728\u5e73\u8861\u65f6\u95f4\u590d\u6742\u5ea6\u5417\uff08\uff08\uff09\uff0c\u5355\u6b21\u67e5\u8be2\u590d\u6742\u5ea6 $O(\\frac{\\log n} {\\log B} + \\log B)$\uff0c\u6240\u4ee5\u53d6 $B = 2 ^ {\\sqrt {\\log n}}$ \u6700\u4f18\u79c0\u3002\n\n\u6700\u540e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(V^\\epsilon + n + m \\sqrt{\\log n})$\u3002\n\n\u4e5f\u8bb8\u4e0d\u65ad\u8fed\u4ee3\u8fd9\u4e2a\u7ed3\u6784\u53ef\u80fd\u964d\u5230\u66f4\u4f4e\u590d\u6742\u5ea6\uff0c\u4f46\u662f\u5e38\u6570\u80af\u5b9a\u5347\u5929\u4e86\u3002",
        "postTime": 1681631456,
        "uid": 615348,
        "name": "zhouershan",
        "ccfLevel": 7,
        "title": "\u53e3\u80e1 CF575A"
    }
]