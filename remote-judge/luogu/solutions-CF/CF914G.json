[
    {
        "content": "~~\u7ecf\u5178\u677f\u5b50\u9898\uff1f~~\n\n\u4ee4 $i = s_a\\&s_b, j = s_c, k = s_d \\oplus s_e$\n\n$\\sum_{p}\\sum_{i\\&j\\&k = 2^p} f_i \\times f_j \\times f_k \\times (\\sum_{s_a|s_b = i, s_a \\&s_b = 0}1) \\times (\\sum_{s_c = j}1)\\times (\\sum_{s_d \\oplus s_e = k}1)$\n\n\u4ee4 $A_i = (\\sum_{s_a|s_b = i, s_a \\&s_b = 0}1)$\u3002\n\n$B_j = (\\sum_{s_c = j}1)$\u3002\n\n$C_k = (\\sum_{s_d \\oplus s_e = k}1)$\u3002\n\n$A_i$ \u53ef\u4ee5\u901a\u8fc7\u5b50\u96c6\u5377\u79ef\u6765\u505a\uff0c\u590d\u6742\u5ea6 $N \\log^2 N$\u3002\n\n$B_j$ \u663e\u7136\u3002\n\n$C_k$ \u53ef\u4ee5\u76f4\u63a5 FWTXOR \u6765\u505a\uff0c\u590d\u6742\u5ea6 $N \\log N$\u3002\n\n\u6700\u540e FWTAND \u5377\u4e00\u4e0b\u4e09\u4e2a\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nconst int BL = 2 << 20;\nstruct streambufcin {\n\tstd::streambuf *in;\n\tstreambufcin() {\n\t\tstd::ios::sync_with_stdio(false);\n\t\tstd::cin.tie(NULL);\n\t\tin = std::cin.rdbuf();\n\t\tbg = ed = NULL;\n#ifdef LOCAL\n\t\tfreopen(\"in.in\", \"r\", stdin);\n#endif\n\t}\n\tchar buf[BL], *bg, *ed, ch;\n\tchar gc() { return bg == ed ? ed = buf + in -> sgetn(bg = buf, BL), (bg == ed ? -1 : *bg++) : *bg++; }\n\ttemplate<class T>\n\tstreambufcin &operator >> (T &x) {\n\t\tbool neg = false;\n\t\tfor (ch = gc(); !isdigit(ch); ch = gc());\n\t\tif (ch == '-')\n\t\t\tneg = true;\n\t\tfor (x = 0; isdigit(ch); ch = gc())\n\t\t\tx = x * 10 + ch - 48;\n\t\tif (neg)\n\t\t\tx = -x;\n\t\treturn *this;\n\t}\n\tstreambufcin &operator >> (char &c) {\n\t\tfor (c = gc(); isspace(c); c = gc());\n\t\treturn *this;\n\t}\n} cin;\n\nstruct streambufcout {\n\tstd::streambuf *out = std::cout.rdbuf();\n\tchar buf[BL], *optr = buf;\n\tstreambufcout() { out = std::cout.rdbuf(); }\n\t~streambufcout() { flush(); }\n\tvoid flush() { out -> sputn(buf, optr - buf); optr = buf; }\n\tvoid pc(char c) {\n\t\tif (optr == buf + BL)\n\t\t\tflush();\n\t\t*optr++ = c;\n\t}\n\ttemplate<class T>\n\tstreambufcout &operator << (T x) {\n\t\tstatic int st[233], top;\n\t\tif (x < 0) {\n\t\t\tx = -x;\n\t\t\tpc('-');\n\t\t}\n\t\tdo {\n\t\t\tst[++top] = x % 10;\n\t\t\tx /= 10;\n\t\t} while (x);\n\t\twhile (top)\n\t\t\tpc(st[top--] ^ 48);\n\t\treturn *this;\n\t}\n\tstreambufcout &operator << (char c) { pc(c); return *this; }\n} cout;\n\nint n;\nconst int N = 262144;\nconst int mod = 1e9 + 7;\nconst int inv2 = mod + 1 >> 1;\nint s[N], fib[N], cnt[N];\nint A[N], B[N], C[N], F[19][N], h[N], answer[N];\n\nint add(int x, int y) {\n\tif (x + y >= mod)\n\t\treturn x + y - mod;\n\telse\n\t\treturn x + y;\n}\nint dec(int x, int y) {\n\tif (x - y < 0)\n\t\treturn x - y + mod;\n\telse\n\t\treturn x - y;\n}\n\nvoid mul(int &x, int y) { x = 1ll * x * y % mod; }\nvoid _ad(int &x, int y) { x += y; if (x >= mod) x -= mod; }\nvoid _de(int &x, int y) { x -= y; if (x < 0) x += mod; }\n\nvoid FWTOR(int *f, int inv) {\n\tfor (int len = 1; len < N; len <<= 1) {\n\t\tfor (int i = 0; i < N; i += len << 1) {\n\t\t\tfor (int j = 0; j < len; j++) {\n\t\t\t\tif (inv > 0)\n\t\t\t\t\t_ad(f[i + j + len], f[i + j]);\n\t\t\t\telse\n\t\t\t\t\t_de(f[i + j + len], f[i + j]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid FWTAND(int *f, int inv) {\n\tfor (int len = 1; len < N; len <<= 1) {\n\t\tfor (int i = 0; i < N; i += len << 1) {\n\t\t\tfor (int j = 0; j < len; j++) {\n\t\t\t\tif (inv > 0)\n\t\t\t\t\t_ad(f[i + j], f[i + j + len]);\n\t\t\t\telse\n\t\t\t\t\t_de(f[i + j], f[i + j + len]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid FWTXOR(int *f, int inv) {\n\tfor (int len = 1; len < N; len <<= 1) {\n\t\tfor (int i = 0; i < N; i += len << 1) {\n\t\t\tfor (int j = 0; j < len; j++) {\n\t\t\t\tint x = f[i + j], y = f[i + j + len];\n\t\t\t\tf[i + j] = add(x, y), f[i + j + len] = dec(x, y);\n\t\t\t\tif (inv < 0) \n\t\t\t\t\tmul(f[i + j], inv2), mul(f[i + j + len], inv2);\n\t\t\t}\n\t\t}\n\t}\n}\n\nint main() {\n\tfor (int i = 1; i < 262144; i++)\n\t\tcnt[i] = cnt[i >> 1] + (i & 1);\n\tfib[0] = 0; fib[1] = 1;\n\tfor (int i = 2; i < 262144; i++)\n\t\tfib[i] = add(fib[i - 1], fib[i - 2]);\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++) { int x; cin >> x; A[x]++; B[x]++; C[x]++; }\n\tfor (int i = 0; i < 262144; i++) \n\t\tF[cnt[i]][i] = A[i], A[i] = 0;\n\tfor (int i = 0; i < 19; i++)\n\t\tFWTOR(F[i], 1);\n\tfor (int i = 0; i < 19; i++) {\n\t\tfor (int j = 0; j < 262144; j++)\n\t\t\th[j] = 0;\n\t\tfor (int j = 0; j <= i; j++)\n\t\t\tfor (int k = 0; k < 262144; k++)\n\t\t\t\t_ad(h[k], 1ll * F[j][k] * F[i - j][k] % mod);\n\t\tFWTOR(h, -1);\n\t\tfor (int j = 0; j < 262144; j++)\n\t\t\tif (cnt[j] == i)\n\t\t\t\t_ad(A[j], h[j]);\n\t}\n\tFWTXOR(C, 1);\n\tfor (int i = 0; i < 262144; i++)\n\t\tmul(C[i], C[i]);\n\tFWTXOR(C, -1);\n\tfor (int i = 0; i < 262144; i++)\n\t\tmul(A[i], fib[i]), mul(B[i], fib[i]), mul(C[i], fib[i]);\n\tFWTAND(A, 1), FWTAND(B, 1), FWTAND(C, 1);\n\tfor (int i = 0; i < 262144; i++)\n\t\tanswer[i] = 1ll * A[i] * B[i] % mod * C[i] % mod;\n\tFWTAND(answer, -1);\n\tint Answer = 0;\n\tfor (int i = 1; i < 262144; i <<= 1)\n\t\t_ad(Answer, answer[i]);\n\tcout << Answer << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1597221114,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF914G \u3010Sum the Fibonacci\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](http://codeforces.com/problemset/problem/914/G)\u770b\u9898\u76ee\u3002    \n# \u5206\u6790\n&emsp;&emsp;\u6211\u4eec\u5148\u653e\u5bbd\u6761\u4ef6\uff0c\u91cd\u65b0\u5b9a\u4e49\u4e94\u5143\u7ec4$(a,b,c,d,e)$\u5982\u4e0b\uff1a  \n&emsp;&emsp;1.$1\\le a,b,c,d,e\\le n$\u3002  \n&emsp;&emsp;2.$s_a\\&s_b=0$\u3002  \n&emsp;&emsp;\u5e76\u4e14\u8bbe$v(a,b,c,d,e)=(s_a|s_b)\\&s_c\\&(s_d\\oplus s_e)$\u3002\uff08\u8fd9\u91cc\u7684$\\oplus$\u6307\u4ee3\u5f02\u6216\uff0c\u4e0b\u540c\uff09  \n&emsp;&emsp;\u4e8e\u662f\u4e4e\u7b54\u6848\u53ef\u4ee5\u53d8\u6210\uff1a  \n$$\n\\begin{aligned}\n    &\\sum_{p}\\ \\sum_{v(a,b,c,d,e)=2^p}\\ f(s_a|s_b)\\times f(s_c)\\times f(s_d\\oplus s_e)\\\\\n   =&\\sum_{p}\\ \\sum_{i\\& j\\& k=2^p} f(i)\\times \\left(\\sum_{s_a|s_b=i,s_a\\& s_b=0}1\\right)\\times f(j)\\times \\left(\\sum_{s_c=j}1\\right)\\times f(k)\\times \\left(\\sum_{s_d\\oplus s_e=k}1\\right)\n\\end{aligned}\n$$   \n&emsp;&emsp;\u4e2d\u95f4\u4e00\u5c42\u6c42\u548c\u5b9e\u9645\u4e0a\u662f\u4e0e\u5377\u79ef\uff0c\u5185\u90e8\u7684\u7b2c\u4e00\u4e2a\u6c42\u548c\u662f\u4e00\u4e2a\u5b50\u96c6\u5377\u79ef\uff0c\u5185\u90e8\u7b2c\u4e09\u4e2a\u6c42\u548c\u662f\u4e00\u4e2a\u5f02\u6216\u5377\u79ef\u3002\u4e0e\u5377\u79ef\u53ef\u4ee5 FWT \uff08\u6216\u8005\u53eb FMT \uff09\uff0c \u5b50\u96c6\u5377\u79ef\u53ef\u4ee5 FST \uff0c\u5f02\u6216\u5377\u79ef\u53ef\u4ee5 FWT \u3002\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\log_2^2n)$\uff08 FST \u6700\u82b1\u65f6\u95f4 \uff09\u3002  \n&emsp;&emsp; FST \u5b9e\u9645\u4e0a\u662f ~~\u9b54\u6539~~ FWT \u7684\u601d\u60f3\uff0c\u53ea\u4e0d\u8fc7\u4e3a\u4e86\u907f\u514d\u5206\u51fa\u6765\u7684\u5b50\u96c6\u8fd8\u6709\u4ea4\uff0c\u5c31\u52a0\u4e86\u4e00\u4f4d\u8868\u793a\u96c6\u5408\u7684\u5927\u5c0f\uff08\u5b50\u96c6\u5377\u79ef\u6ee1\u8db3$A,B\\subseteq S, A\\cup B=S, A\\cap B=\\varnothing$\uff0c$A\\cap B=\\varnothing$\u7684\u9650\u5236\u7b49\u4ef7\u4e8e$|A|+|B|=|S|$\uff09\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n\ntypedef long long LL;\n\nconst int mod = 1e9 + 7, inv2 = 5e8 + 4;\nconst int MAXN = 1e6 + 5, MAXL = ( 1 << 17 ) + 5, MAXLOG = 20;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n\treturn a > b ? a : b;\n}\n\nint f[MAXLOG][MAXL], h[MAXL];\nint A[MAXL], B[MAXL], C[MAXL], fibo[MAXL];\nint cnt[MAXL];\nint N, len, lg2;\n\nint lowbit( const int x ) { return x & ( -x ); }\nint fix( const int a ) { return ( a % mod + mod ) % mod; }\nint count( int x ) { int ret = 0; while( x ) ret ++, x -= lowbit( x ); return ret; }\n\nnamespace OR\n{\n\tvoid FWT( int *F, const int mode )\n\t{\n\t\tfor( int s = 2 ; s <= len ; s <<= 1 )\n\t\t\tfor( int i = 0, t = s >> 1 ; i < len ; i += s )\n\t\t\t\tfor( int j = i ; j < i + t ; j ++ )\n\t\t\t\t\tF[j + t] = fix( F[j + t] + mode * F[j] );\n\t}\n}\n\nnamespace AND\n{\n\tvoid FWT( int *F, const int mode )\n\t{\n\t\tfor( int s = 2 ; s <= len ; s <<= 1 )\n\t\t\tfor( int i = 0, t = s >> 1 ; i < len ; i += s )\n\t\t\t\tfor( int j = i ; j < i + t ; j ++ )\n\t\t\t\t\tF[j] = fix( F[j] + mode * F[j + t] );\n\t}\n}\n\nnamespace XOR\n{\n\tvoid FWT( int *F, const int mode )\n\t{\n\t\tint t1, t2;\n\t\tfor( int s = 2 ; s <= len ; s <<= 1 )\n\t\t\tfor( int i = 0, t = s >> 1 ; i < len ; i += s )\n\t\t\t\tfor( int j = i ; j < i + t ; j ++ )\n\t\t\t\t{\n\t\t\t\t\tt1 = F[j], t2 = F[j + t];\n\t\t\t\t\tif( mode > 0 ) F[j] = ( t1 + t2 ) % mod, F[j + t] = fix( t1 - t2 );\n\t\t\t\t\telse F[j] = 1ll * ( t1 + t2 ) * inv2 % mod, F[j + t] = 1ll * fix( t1 - t2 ) * inv2 % mod;\n\t\t\t\t}\n\t}\n}\n\nvoid FST()\n{\n\tfor( int i = 0 ; i <= lg2 ; i ++ ) OR :: FWT( f[i], 1 );\n\tfor( int i = 0 ; i <= lg2 ; i ++ )\n\t{\n\t\tfor( int S = 0 ; S < len ; S ++ ) h[S] = 0;\n\t\tfor( int j = 0 ; j <= i ; j ++ )\n\t\t\tfor( int S = 0 ; S < len ; S ++ )\n\t\t\t\th[S] = ( h[S] + 1ll * f[j][S] * f[i - j][S] % mod ) % mod;\n\t\tOR :: FWT( h, -1 );\n\t\tfor( int S = 0 ; S < len ; S ++ ) if( cnt[S] == i ) A[S] = ( A[S] + h[S] ) % mod;\t\n\t}\n}\n\nvoid init()\n{\n\tfibo[0] = 0, fibo[1] = 1;\n\tfor( int i = 2 ; i < ( 1 << 17 ) ; i ++ ) fibo[i] = ( fibo[i - 1] + fibo[i - 2] ) % mod;\n\tfor( int i = 0 ; i < ( 1 << 17 ) ; i ++ ) cnt[i] = count( i );\n}\n\nsigned main()\n{\n\tint mx = 0;\n\tread( N );\n\tinit();\n\tfor( int i = 1, v ; i <= N ; i ++ ) \n\t{\n\t\tread( v ), mx = MAX( v, mx );\n\t\tf[cnt[v]][v] ++, C[v] ++, B[v] = ( B[v] + fibo[v] ) % mod;\n\t}\n\tfor( lg2 = 0, len = 1 ; len <= mx ; len <<= 1, lg2 ++ );\n\tFST();\n\tXOR :: FWT( C, 1 );\n\tfor( int i = 0 ; i < len ; i ++ ) C[i] = 1ll * C[i] * C[i] % mod;\n\tXOR :: FWT( C, -1 );\n\tfor( int i = 0 ; i < len ; i ++ ) A[i] = 1ll * A[i] * fibo[i] % mod, C[i] = 1ll * C[i] * fibo[i] % mod;\n\tAND :: FWT( A, 1 ), AND :: FWT( B, 1 ), AND :: FWT( C, 1 );\n\tfor( int i = 0 ; i < len ; i ++ ) A[i] = 1ll * A[i] * B[i] % mod * C[i] % mod;\n\tAND :: FWT( A, -1 );\n\tint ans = 0;\n\tfor( int i = 1 ; i <= len ; i <<= 1 ) ( ans += A[i] ) %= mod;\n\twrite( ans ), putchar( '\\n' );\n\treturn 0;\n}\n```\n&emsp;&emsp;\u8f6c\u8f7d\u81ea\u6211\u7684[\u535a\u5ba2\u56ed](https://www.cnblogs.com/crashed/p/12582699.html)\u3002  ",
        "postTime": 1585306625,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[CF914G]Sum the Fibonacci"
    },
    {
        "content": "## Sum the Fibonacci\n\n\u672c\u9898\u5176\u5b9e\u5f88\u9002\u5408\u7528\u6765\u505a$FWT$\u7684\u6a21\u677f\u9898\n\n\n\n\u505a\u6cd5\u5176\u5b9e\u5f88\u597d\u60f3\uff1a\n\n$set \\space\\text{g(x)=}$\n$\\sum_{s_a\\And s_b=0, s_a|s_b=x}1$\n\n$\\text{g}$\u53ef\u4ee5\u7528\u5b50\u96c6\u5377\u79ef\u89e3\u51b3\n\n\u7136\u540e\u540c\u7406\u89e3\u51fa$\\color{red}{\\text{h(x)=}\\sum_{s_d\\oplus s_e}1}(By\\space FWT)$\n\n$\\sum_{a,b,c,d,e}$\n$[(s_a | s_b) \\& s_c \\& $\n$(s_d \\oplus s_e)$\n$2^i$\n$[s_a\\&s_b=0]f (s_a | s_b)$\n$f(s_c)  f(s_d \\oplus s_e)$\n\n$=\\sum_{x,y,z}[x\\&y\\&z=2^i]g(x)f(x)*f(y)*h(z)f(z)$\n\n\u8fd9\u91cc\u76f4\u63a5\u7528$\\color{blue}{FWT}$\u5373\u53ef\n\n\n\n$\\color{pink}\\mathfrak{Talk\\ is\\ cheap,show\\ you\\ the\\ code.}$\n\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n# define ll long long\n# define read read1<ll>()\n# define Type template<typename T>\nType T read1(){\n\tT t=0;\n\tchar k;\n\tbool vis=0;\n\tdo (k=getchar())=='-'&&(vis=1);while('0'>k||k>'9');\n\twhile('0'<=k&&k<='9')t=(t<<3)+(t<<1)+(k^'0'),k=getchar();\n\treturn vis?-t:t;\n}\n# define mod 1000000007\n# define inv2 500000004\nvoid FWT_or(int *a,int s,int T){\n\tfor(int i=1,j=2;j<=s;i<<=1,j<<=1)\n\t\tfor(int x=0;x<s;x+=j)\n\t\t\tfor(int y=0;y<i;++y)\n\t\t\t\ta[i+x+y]=(a[i+x+y]+T*a[x+y])%mod;\n}\nvoid FWT_and(int *a,int s,int T){\n\tfor(int i=1,j=2;j<=s;i<<=1,j<<=1)\n\t\tfor(int x=0;x<s;x+=j)\n\t\t\tfor(int y=0;y<i;++y)\n\t\t\t\ta[x+y]=(a[x+y]+T*a[i+x+y])%mod;\n}\nvoid FWT_xor(int *a,int s,int T){\n\tfor(int i=1,j=2;j<=s;i<<=1,j<<=1)\n\t\tfor(int x=0;x<s;x+=j)\n\t\t\tfor(int y=0;y<i;++y){\n\t\t\t\ta[i+x+y]=(a[x+y]-a[i+x+y])%mod;\n\t\t\t\ta[x+y]=(a[x+y]+a[x+y]-a[i+x+y])%mod;\n\t\t\t\tif(T!=1)a[i+x+y]=1ll*a[i+x+y]*T%mod,a[x+y]=1ll*a[x+y]*T%mod;\n\t\t\t}\n}\nint qkpow(int x,ll m){\n\tif(!m)return 1;\n\tll t=qkpow(x,m>>1);\n\tt=t*t%mod;\n\tif(m&1)t=t*x%mod;\n\treturn t;\n}\nconst int s=1<<17;\nint n,a[18][s],b[s],c[s],w[s],tn[18][s];\nint main(){\n\tn=read;\n\tfor(int i=1;i<s;++i)w[i]=w[i&i-1]+1;\n\tfor(int i=1;i<=n;++i)++b[read];\n\tmemcpy(c,b,s<<2);\n\tfor(int i=0;i<s;++i)a[w[i]][i]=b[i];\n\tfor(int i=0;i<=17;++i){FWT_or(a[i],s,1);\n\t\tfor(int j=0;j<s;++j){\n\t\t\ttn[i][j]=0;\n\t\t\tfor(int k=0;k<=i;++k)\n\t\t\t\ttn[i][j]=(tn[i][j]+1ll*a[k][j]*a[i-k][j])%mod;\n\t\t}\n\t}\n\tfor(int i=0;i<=17;++i)memcpy(a[i],tn[i],s<<2);\n\tfor(int i=0;i<=17;++i)FWT_or(a[i],s,-1);\n\tfor(int i=0;i<s;++i)a[0][i]=a[w[i]][i];\n\tFWT_xor(b,s,1);\n\tfor(int i=0;i<s;++i)b[i]=1ll*b[i]*b[i]%mod;\n\tFWT_xor(b,s,inv2);\n\ta[0][0]=b[0]=c[0]=0;ll x=0,y=1;\n\tfor(int i=2;i<s;++i){\n\t\ty+=x;x=y-x;y%=mod;\n\t\ta[0][i]=a[0][i]*y%mod;\n\t\tb[i]=b[i]*y%mod;\n\t\tc[i]=c[i]*y%mod;\n\t}\n\tFWT_and(a[0],s,1);FWT_and(b,s,1);FWT_and(c,s,1);\n\tfor(int i=0;i<s;++i)c[i]=1ll*c[i]*b[i]%mod*a[0][i]%mod;\n\tFWT_and(c,s,-1);\n\tint t=0;\n\tfor(int i=0;i<17;++i)t=(t+c[1<<i])%mod;\n\tcout<<(t+mod)%mod;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1612359531,
        "uid": 108067,
        "name": "\u4e1b\u96e8",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF914G \u3010Sum the Fibonacci\u3011"
    },
    {
        "content": "\u9898\u610f:\u7ffb\u8bd1\u5df2\u7ecf\u591f\u76f4\u767d\u4e86\u5427\n\n\u8003\u8651\u5230$s_i$\u7684\u8303\u56f4\u5f88\u5c0f,\u6240\u4ee5\u6211\u4eec\u8003\u8651\u8bb0\u4e0b$cnt[s_i]$\u8868\u793a$s_i$\u51fa\u73b0\u7684\u4e2a\u6570\n\n\u56e0\u4e3a\u9898\u76ee\u8981\u6c42\u7684\u662f\u901a\u8fc7$(s_a|s_b)$&$s_c$&$(s_d$ ^$s_e)$\u5f97\u5230\u7684\u6570\n\n\u90a3\u4e48$\\sum f(s_a|s_b)*f(s_c)*f(s_d$ ^$s_e)$\n\n$=cnt[s_a|s_b]*f(s_a|s_b)$&$cnt[s_c]*f(s_c)$&$cnt[s_d$^$s_e]*f(s_d$^$s_e)$\n\n\u8fd9\u91cc\u7684&\u8868\u793a\u4e0e\u5377\u79ef\n\n\u8003\u8651$cnt[s_a|s_b]=\\sum[s_a$&$s_b=0]cnt[s_a]*cnt[s_b]$\n\n\u5176\u5b9e\u8fd9\u5c31\u662f\u5b50\u96c6\u5377\u79ef\u7684\u53e6\u5916\u4e00\u79cd\u8868\u8fbe\u65b9\u5f0f\n\n\u4e0d\u4f1a\u7684\u770b$vfk2015$\u7684\u96c6\u8bad\u961f\u8bba\u6587\u6216\u8005\u53f3\u8f6c[\u8fd9\u91cc](https://kelin.blog.luogu.org/solution-p4221)\n\n$cnt[s_d$^$s_e]$\u8fd9\u4e2a\u5c31\u662f$cnt[s]$\u4e0e\u81ea\u5df1\u7684\u5f02\u6216\u5377\u79ef\n\n\u6700\u540e\u628a\u6240\u6709\u7684$cnt$\u90fd\u6c42\u51fa\u6765\u4e4b\u540e\u518d\u4e58\u4e0a\u76f8\u5e94\u4f4d\u7f6e\u7684$f$\n\n\u7136\u540e\u6c42\u4e00\u904d\u4e0e\u5377\u79ef,\u628a$2^i$\u6b21\u65b9\u9879\u7684\u7b54\u6848\u52a0\u8d77\u6765\u5c31\u597d\u4e86\n\n\u4ee5\u4e0a\u7684\u4e0e\u5377\u79ef,\u5f02\u6216\u5377\u79ef(\u8fd8\u6709\u6216\u5377\u79ef)\u90fd\u53ef\u4ee5\u7528$FWT$(\u5feb\u901f\u6c83\u5c14\u4ec0\u53d8\u6362)\u6c42\u51fa\n\n\u8fd9\u4e2a$FWT$\u7684\u8bdd\u6211\u4eec\u53ef\u4ee5\u5f88\u597d\u7684~~\u901a\u8fc7\u80cc\u4ee3\u7801~~\u7406\u89e3[\u4ed6](http://blog.csdn.net/zhshrs/article/details/54838466)\n\n```\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(i,u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nchar ss[1<<17],*A=ss,*B=ss;\ninline char gc(){return A==B&&(B=(A=ss)+fread(ss,1,1<<17,stdin),A==B)?-1:*A++;}\ntemplate<class T>inline void sd(T&x){\n    char c;T y=1;while(c=gc(),(c<48||57<c)&&c!=-1)if(c==45)y=-1;x=c-48;\n    while(c=gc(),47<c&&c<58)x=x*10+c-48;x*=y;\n}\nchar sr[1<<21],z[20];int C=-1,Z;\ninline void Ot(){fwrite(sr,1,C+1,stdout),C=-1;}\ntemplate<class T>inline void we(T x){\n    if(C>1<<20)Ot();if(x<0)sr[++C]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++C]=z[Z],--Z);sr[++C]='\\n';\n}\nconst int N=19,M=1<<17|1,P=1e9+7,inv=5e8+4;\ntypedef int arr[M];\nint n,S,ans,Mi[N];arr a[N],b[N],c,d,e,f,p[N],t,pos,cnt;\ninline int add(int a,int b){return a+=b,a>=P?a-P:a;}\ninline int sub(int a,int b){return a-=b,a<0?a+P:a;}\ninline void fmt(int*a,int op(int,int)){\n\tfp(i,1,n)fp(s,1,S)if(s&Mi[i])\n\t\ta[s]=op(a[s],a[s^Mi[i]]);\n}\ninline void fwt(int*a,int op){\n\tfp(i,1,n)fp(s,1,S)\n\t\tif(s&Mi[i]){\n\t\tint o=a[s],t=Mi[i];\n\t\tif(op==1)a[s-t]=add(a[s-t],o);\n\t\telse if(op==2)a[s]=sub(a[s-t],o),a[s-t]=add(a[s-t],o);\n\t\telse a[s]=add(a[s-t],o);\n\t}\n}\ninline void ifwt(int*a,int op){\n\tfp(i,1,n)fp(s,1,S)if(s&Mi[i]){\n\t\tint o=a[s],t=Mi[i];\n\t\tif(op==1)a[s-t]=sub(a[s-t],o);\n\t\telse if(op==2)a[s]=1ll*sub(a[s-t],o)*inv%P,a[s-t]=1ll*add(a[s-t],o)*inv%P;\n\t\telse a[s]=sub(o,a[s-t]);\n\t}\n}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n\tpos[1]=Mi[1]=1;fp(i,2,18)pos[Mi[i]=Mi[i-1]<<1]=i;\n\tsd(n);int x,y=0;fp(i,1,n)sd(x),++t[x],cmax(y,x);\n\tS=1;while(S<=y)S<<=1;n=pos[S--];\n\tfp(i,1,S)cnt[i]=cnt[i>>1]+(i&1);\n\tf[1]=1;fp(i,2,S)f[i]=add(f[i-1],f[i-2]);\n\tfp(s,0,S)a[cnt[s]][s]=b[cnt[s]][s]=d[s]=t[s],c[s]=1ll*t[s]*f[s]%P;;\n\tfwt(d,2);fp(s,0,S)d[s]=1ll*d[s]*d[s]%P;\n\tifwt(d,2);fp(s,0,S)d[s]=1ll*d[s]*f[s]%P;\n\tfp(i,0,n)fmt(a[i],add),fmt(b[i],add);\n\tfp(i,0,n)fp(j,0,n-i)fp(s,0,S)p[i+j][s]=add(p[i+j][s],1ll*a[i][s]*b[j][s]%P);\n\tfp(i,0,n)fmt(p[i],sub);fp(s,0,S)e[s]=1ll*p[cnt[s]][s]*f[s]%P;\n\tfwt(c,1),fwt(d,1),fwt(e,1);\n\tfp(s,0,S)c[s]=1ll*c[s]*d[s]%P*e[s]%P;\n\tifwt(c,1);fp(i,1,n)ans=add(ans,c[Mi[i]]);\n\tprintf(\"%d\",ans);\nreturn Ot(),0;\n}\n```",
        "postTime": 1520259008,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF914G \u3010Sum the Fibonacci\u3011"
    },
    {
        "content": ">[\u4e5f\u8bb8\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Fy5-FyFive/articles/17106283.html)\n\n---\n>\u524d\u7f6e\u829d\u58eb\uff1a[FWT](https://www.luogu.com.cn/problem/P4717)\uff0c[FMT](https://www.luogu.com.cn/problem/P4717)\uff0c[\u5b50\u96c6\u5377\u79ef](https://www.luogu.com.cn/problem/P6097)\u3002\n\n---\n\n>\u9898\u610f\u5df2\u7ecf\u8bf4\u5f97\u76f8\u5f53\u6e05\u695a\u4e86\uff0c\u8fd9\u91cc\u5c31\u4e0d\u590d\u8ff0\u4e86\u3002\n\n---\n\n#### \u6b63\u7247\n\n\u60f3\u5230\u8fd9\u4e2a $\\sum f(s_a|s_b)*f(s_c)*f(s_d \\wedge s_e)$ \u5e76\u4e0d\u662f\u5f88\u597d\u641e\uff0c\u8003\u8651\u8f6c\u6362\uff0c\u53bb\u6389 $\\sum$\u3002\n\n\u5f00\u4e2a\u6876 $\\displaystyle cnt[i]=\\sum_{i=0}^n [s_j=i]$\uff0c\u90a3\u4e48\u539f\u5f0f\u5c31\u53d8\u6210\u4e86\uff1a\n$$cnt[s_a|s_b]*f(s_a|s_b)*cnt[s_c]*f(s_c)*cnt[s_d \\wedge s_e]*f(s_d \\wedge s_e)$$\n\n\u663e\u7136\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u7528\u4e0a\u524d\u7f6e\u829d\u58eb\u7684\u90e8\u5206\u4e86\u3002\n\n\u8003\u8651 $cnt[s_a|s_b]$ \u90e8\u5206\u7684\u5377\u79ef\uff0c\u5728\u5377\u8fd9\u4e00\u90e8\u5206\u7684\u65f6\u5019\u8fd8\u6709\u4e00\u4e2a\u9650\u5236\u662f $s_a\\&s_b=0$\uff0c\u8fd9\u6837\u5c31\u4e0d\u80fd\u76f4\u63a5\u4e0a FMT \u4e86\uff0c\u9700\u8981\u8dd1\u5b50\u96c6\u5377\u79ef\uff0c~~\u81ea\u5df1\u5377\u81ea\u5df1~~\u3002\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\n\n\u5177\u4f53\u7684\u5377\u6cd5\u53ef\u4ee5\u770b\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u53bb\u770b\u6a21\u677f\u9898\uff0c\u53cd\u6b63\u8fd9\u9053\u9898\u91cc\u7684\u5b50\u96c6\u5377\u79ef\u8fd8\u662f\u633a\u677f\u7684\u3002\n\n\u518d\u8003\u8651 $cnt[s_c]$\uff0c\u6ca1\u5f97\u5377\u3002\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u518d\u8003\u8651 $cnt[s_d \\wedge s_e]$ \u90e8\u5206\u7684\u5377\u79ef\uff0c\u5f88\u663e\u7136\u76f4\u63a5\u8dd1 FWT \u5c31\u884c\u4e86\uff0c~~\u8111\u5b50\u90fd\u4e0d\u7528\u7684~~\u3002\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u5377\u5b8c\u4e4b\u540e\u6bcf\u4e2a\u4f4d\u7f6e\u4e58\u4e0a\u76f8\u5e94\u7684\u6590\u6ce2\u90a3\u5951\u6570\u5c31\u884c\u4e86\u3002\n\n\u6700\u540e\u628a\u8fd9\u4e9b\u4e1c\u897f\u5377\u5230\u4e00\u8d77\u53bb\u3002\u9898\u76ee\u4e2d\u7684\u9650\u5236\u662f &\uff0c\u90a3\u4e48\u6700\u540e\u8dd1\u4e00\u904d FMT \u628a\u4e09\u4e2a\u90e8\u5206\u5377\u5728\u4e00\u8d77\u3002\n\n\u7531\u4e8e\u8fd8\u8981\u6c42\u4e86\u662f $2^i$ \u7684\u9879\uff0c\u90a3\u4e48\u8f93\u51fa\u6240\u6709 $2^i$ \u9879\u7684\u548c\u5c31\u597d\u4e86\u3002\n\n\u603b\u590d\u6742\u5ea6\u662f $O(n\\log^2 n)$ \u7ea7\u522b\u7684\u3002\n\n#### \u5199\u5728\u6700\u540e\u4f46\u662f\u5728\u4ee3\u7801\u524d\n\nFWT \u548c FMT \u53ef\u4ee5\u76f4\u63a5\u4f5c\u4e3a\u51fd\u6570\u5c01\u88c5\u8d77\u6765\u4e0d\u53bb\u7ba1\u4ed6\u3002\u5176\u5b9e\u5b50\u96c6\u5377\u79ef\u4e5f\u53ef\uff0c\u5c31\u662f\u6211\u6709\u70b9\u61d2 qwq\u3002\n\n\u5982\u679c\u4f60\u8ba4\u4e3a\u81ea\u5df1\u7684\u4ee3\u7801\u5e94\u8be5\u516b\u4e5d\u4e0d\u79bb\u5341\u4e86\uff0c\u4f46\u5c31\u662f\u6b7b\u6d3b\u8fc7\u4e0d\u53bb\uff0c\u8bf7\u68c0\u67e5\u4ee5\u4e0b\u4e09\u70b9\uff1a\n\n- \u8f93\u5165\u3001\u8f93\u51fa\u6709\u6ca1\u6709\u9519\uff1b\n- \u6267\u884c\u5377\u79ef\u7684\u6570\u7ec4\u6253\u6ca1\u6253\u9519\uff1b\n- \u5199\u597d\u7684\u9884\u5904\u7406\uff08\u7b49\uff09\u51fd\u6570\u52a0\u6ca1\u52a0\u8fdb\u4e3b\u51fd\u6570\u3002\n\n\u5982\u679c\u67e5\u4e0d\u51fa\u6765\uff0c\u90a3\u5c31\u91cd\u6784\u5427\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u5c01\u88c5\u597d\u7684\u51fd\u6570\uff0c\u5c3d\u91cf\u76f8\u4fe1\u81ea\u5df1\u3002\n\n#### Code\n\u653e\u4e00\u4efd\u65b9\u4fbf\u8c03\u8bd5\u7684\u4ee3\u7801\u3002 owo\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define mo 1000000007ll\n#define m2 (mo+1)/2\n#define sc(i) scanf(\"%lld\",&i);\n\ninline void fmta(int *a,int n,int x) {for(int s=2,t=1;s<=n;s<<=1,t<<=1) for(int i=0;i<n;i+=s) for(int j=0;j<t;++j) a[i+j]=(a[i+j+t]*x+a[i+j]+mo)%mo;}\ninline void fmto(int *a,int n,int x) {for(int s=2,t=1;s<=n;s<<=1,t<<=1) for(int i=0;i<n;i+=s) for(int j=0;j<t;++j) a[i+j+t]=(a[i+j+t]+a[i+j]*x+mo)%mo;}\ninline void fwt(int *a,int n,int x) {for(int s=2,t=1;s<=n;s<<=1,t<<=1) for(int i=0;i<n;i+=s) for(int j=0;j<t;++j) {a[i+j]=(a[i+j+t]+a[i+j])%mo; a[i+j+t]=(a[i+j]-a[i+j+t]-a[i+j+t]+mo*2)%mo*x%mo; a[i+j]=a[i+j]*x%mo;}}\n#define ctt(i) __builtin_popcount(i)\n\n#define N 1<<18|1\nint a[20][N],b[20][N],c[N],d[N],s[N];\nint cnt[N],f[N],n;\ninline void gf() {f[0]=0; f[1]=1; f[2]=1; for(int i=3;i<(1<<17);++i) f[i]=(f[i-1]+f[i-2])%mo;}\n\nsigned main()\n{\n    sc(n);\n    gf();\n    int mx=-1;\n    for(int i=1;i<=n;++i) {int x; sc(x); ++cnt[x]; mx=max(mx,x);}\n\n    int ctn=0,lcn=1;\n    while(lcn<=mx) {ctn++; lcn<<=1;}\n    \n\n    for(int i=0;i<=mx;++i) a[ctt(i)][i]=c[i]=cnt[i];\n    for(int i=0;i<=ctn;++i) fmto(a[i],lcn,1);\n    for(int i=0;i<=ctn;++i) for(int j=0;j<=i;++j) for(int k=0;k<lcn;++k) b[i][k]=(b[i][k]+a[j][k]*a[i-j][k]%mo)%mo;\n    for(int i=0;i<=ctn;++i) fmto(b[i],lcn,-1);\n    \n\n    for(int i=0;i<lcn;++i) d[i]=b[ctt(i)][i]*f[i]%mo;\n\n\n    fwt(c,lcn,1);\n    for(int i=0;i<lcn;++i) c[i]=c[i]*c[i]%mo;\n    fwt(c,lcn,m2);\n    for(int i=0;i<lcn;++i) c[i]=c[i]*f[i]%mo;\n    \n    for(int i=0;i<lcn;++i) s[i]=cnt[i]*f[i]%mo;\n\n    \n    fmta(s,lcn,1);\n    fmta(d,lcn,1);\n    fmta(c,lcn,1);\n    for(int i=0;i<lcn;++i) s[i]=s[i]*d[i]%mo*c[i]%mo;\n    fmta(s,lcn,-1);\n\n\n    int ans=0;\n    for(int i=1;i<=lcn;i<<=1) ans=(ans+s[i])%mo;\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1675940407,
        "uid": 532102,
        "name": "_FyFive_",
        "ccfLevel": 6,
        "title": "CF914G-\u9898\u89e3"
    }
]