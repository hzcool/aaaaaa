[
    {
        "content": "# CF1386B Mixture\n\n> \u9898\u610f:\u521d\u59cb\u7ed9\u51fa\u4e00\u4e2a\u76ee\u6807\u7a7a\u95f4\u5411\u91cf$N=(S_f,P_f,G_f)$\u548c\u521d\u59cb\u4e3a\u7a7a\u7684\u7a7a\u95f4\u5411\u91cf\u7684**\u53ef\u91cd**\u96c6$I$\uff0c\u6bcf\u6b21\u9009\u62e9\u589e\u52a0\u6216\u5220\u53bb\u4e00\u4e2a\u7a7a\u95f4\u5411\u91cf$(S_i,P_i,G_i)$\uff0c\u6c42\u6700\u5c0f\u96c6\u5408$U$\u4f7f\u5f97$U\\subseteq I$\u4e14\u5b58\u5728\u957f\u5ea6\u4e3a$|U|$\u7684\u5e8f\u5217$\\lambda$,\u4f7f\u5f97$\\forall i,\\lambda_i>0$\u4e14$\\sum_{i=1}^{|U|}\\lambda_iU_i=N$($U_i$\u8868\u793a$U$\u4e2d\u7b2c$i$\u4e2a\u5411\u91cf\uff0c\u987a\u5e8f\u65e0\u5b9e\u610f)\n\n\u5c06\u9898\u610f\u8f6c\u6362\u6210\u4e0a\u9762\u7684\u6837\u5b50\u540e\uff0c\u6211\u4eec\u5c31\u5df2\u7ecf\u53ef\u4ee5\u5f97\u5230$n^2$\u7684\u5224\u65ad\u7ebf\u6027\u65e0\u5173\u95ee\u9898(\u56e0\u4e3a$\\lambda >0$)\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u5148\u8fdb\u884c\u4e00\u4e9b\u6052\u7b49\u53d8\u6362\uff1a\n\n$$\n\\begin{cases}\n\\sum_{i=1}^n\\lambda_i S_i=S_f\\\\\n\\sum_{i=1}^n\\lambda_i P_i=P_f\\\\\n\\sum_{i=1}^n\\lambda_i G_i=G_f\\\\\n\\end{cases}\n\\Rightarrow\\sum_{i=1}^n\\lambda_iS_iP_fG_f=\\sum_{i=1}^n\\lambda_iS_fP_iG_f=\\sum_{i=1}^n\\lambda_iS_fP_fG_i=S_fP_fG_f\n$$\n\n\n\u8fd9\u65f6\u6211\u4eec\u5c31\u53d1\u73b0\u53ef\u4ee5\u5c06$(S_iP_fG_f,S_fP_iG_f,S_fP_fG_i)$\u770b\u6210\u4e00\u4e2a\u5411\u91cf\uff0c\u95ee\u9898\u5219\u8f6c\u6362\u6210\u4e86\u4e0e$(S_fP_fG_f,S_fP_fG_f,S_fP_fG_f)$\u7ebf\u6027\u76f8\u5173\u7684\u6700\u5c0f\u5411\u91cf\u7ec4\u5927\u5c0f\n\n\u4e0b\u9762\u6211\u4eec\u5c31\u6682\u65f6\u5148\u5ffd\u7565$\\lambda>0$\u7684\u8981\u6c42\uff0c\u53ea\u8981\u6c42$\\lambda\\not= 0$\n\n\u6211\u4eec\u4e0d\u96be\u53d1\u73b0$(S_fP_fG_f,S_fP_fG_f,S_fP_fG_f)$\u5728\u76f4\u7ebf$x=y=z$\u4e0a.\u4e3a\u4e86\u964d\u7ef4\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5c06\u5411\u91cf\u7ec4\u65cb\u8f6c\u4e00\u5b9a\u7a7a\u95f4\u89d2\u5ea6\uff0c\u4f7f\u4e4b\u8f6c\u5230$z$\u8f74\uff0c\u5373\u4e58\u4e0a$\\left(\\begin{matrix}\\cos\\frac{\\pi}{4}&\\sin\\frac{\\pi}{4}&0\\\\-\\sin\\frac{\\pi}{4}&\\cos\\frac{\\pi}{4}&0\\\\0&0&1\\end{matrix}\\right)\\left(\\begin{matrix}\\frac{\\sqrt 3}{3}&0&-\\frac{\\sqrt 6}{3}\\\\0&1&0\\\\\\frac{\\sqrt 6}{3}&0&\\frac{\\sqrt 3}{3}\\end{matrix}\\right)$\n\n~~\uff08\u6211\u61d2\u5f97\u7b97\u4e86~~\n\n\u6b64\u65f6\u53ea\u9700\u8981\u4f7f\u7a7a\u95f4\u5411\u91cf\u7684\u548c\u5728$z$\u8f74\u4e0a\u5373\u53ef\uff0c\u5373$\\sum_{i=1}^n\\lambda_i x_i=\\sum_{i=1}^n\\lambda_i y_i=0$\uff0c\u800c$z$\u5750\u6807\u65e0\u9650\u5236\n\n\u6b64\u65f6\u6211\u4eec\u4fbf\u53ef\u4ee5\u5c06\u539f\u5148\u7684\u4e09\u7ef4\u5411\u91cf\u8f6c\u6362\u4e3a\u4e8c\u7ef4\u5411\u91cf\u4e86\uff0c\u8981\u6c42\u5219\u53d8\u4e3a\u4e86\u6c42\u51fa\u6700\u5c11\u7684\u5411\u91cf\u4f7f\u5f97\u53ef\u4ee5\u4ece\u539f\u70b9\u5230\u8fbe\u539f\u70b9\n\n\u5982\u679c\u6ca1\u6709$\\lambda>0$\u7684\u9650\u5236\uff0c\u5219~~\u663e\u7136\u7b54\u6848\u4e3a1~~\n\n\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b54\u6848\u4e0d\u4f1a\u5927\u4e8e$3$\n\n\u5f53\u5b58\u5728**\u65b0**\u5411\u91cf\u4e3a0\u5411\u91cf\u65f6\uff0c\u7b54\u6848\u4e3a$1$\n\n\u5f53\u5b58\u5728**\u65b0**\u5411\u91cf\u4e2d\u6709\u76f8\u53cd\u5411\u91cf\u65f6\uff0c\u7b54\u6848\u4e3a$2$\n\n\u5f53\u5b58\u5728**\u65b0**\u5411\u91cf\u5728\u53e6\u5916\u4e24\u5411\u91cf\u7684\u76f8\u53cd\u5411\u91cf\u4e4b\u95f4\u65f6\uff0c\u7b54\u6848\u4e3a$3$\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n)$\uff0c\u4f46\u662f\u56e0\u4e3a\u4e0d\u80fd\u7528$\\tt \\_\\_int128$,\u6240\u4ee5\u5728\u53c9\u4e58\u65f6\u4ee3\u7801\u6709\u70b9\u590d\u6742.\n\n\u8fd8\u6709\u4e0d\u80fd\u7528$\\tt (long )double$\uff0c\u4f1a\u7206\u7cbe\u5ea6\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n# define ll long long\n# define read read1<ll>()\n# define Type template<typename T>\nType T read1(){\n\tT t=0;\n\tchar k;\n\tbool vis=0;\n\tdo (k=getchar())=='-'&&(vis=1);while('0'>k||k>'9');\n\twhile('0'<=k&&k<='9')t=(t<<3)+(t<<1)+(k^'0'),k=getchar();\n\treturn vis?-t:t;\n}\n# define fre(k) freopen(k\".in\",\"r\",stdin);freopen(k\".out\",\"w\",stdout)\n# define ld long double\n# define eps 1e-9\nll Abs(ll x){return x<0?-x:x;}\nchar str[3];\nint t;ll tot;\nconst ll V=1ll<<31;\nconst double Pi=acos(-1);\nmap<pair<ll,ll>,int>ma;\npair<ll,ll>A[100005];\nbool judge(ll x,ll y,ll z,ll w){\n\tif((x==0||y==0)&&(z==0||w==0))return 0;\n\tif(x==0||y==0)return (z<0)^(w<0);\n\tif(z==0||w==0)return (x<0)==(y<0);\n\tif((x>0)*(y>0)!=(z>0)*(w>0))return (x>0)*(y>0)>(z>0)*(w>0);\n\tll l1=(x/V)*(y/V)+((x%V)*(y/V)+(x/V)*(y%V))/V,l2=((x%V)*(y/V)+(x/V)*(y%V))%V+(x%V)*(y%V)/V,l3=(x%V)*(y%V)%V;\n\tll r1=(z/V)*(w/V)+((z%V)*(w/V)+(z/V)*(w%V))/V,r2=((z%V)*(w/V)+(z/V)*(w%V))%V+(z%V)*(w%V)/V,r3=(z%V)*(w%V)%V;\n\tif(l3>=V)l2+=l3/V,l3%=V;if(l2>=V)l1+=l2/V,l2%=V;\n\tif(r3>=V)r2+=r3/V,r3%=V;if(r2>=V)r1+=r2/V,r2%=V;\n\treturn l1==r1?l2==r2?l3>r3:l2>r2:l1>r1;\n}\nconst int E[3][3]={{6,7,8},{5,9,1},{4,3,2}};\nstruct X{\n\tll x,y;\n\tX(ll _x=0,ll _y=0){x=_x;y=_y;}\n\tX(pair<ll,ll>z):x(z.first),y(z.second){}\n\tint Wh()const{return E[(y>0)+(y>=0)][(x>0)+(x>=0)];}\n\tX operator -()const{return X(-x,-y);}\n\tbool operator <(const X &w)const{return judge(x,w.y,y,w.x);}\n\tbool operator >(const X &w)const{return w<*this;}\n\tbool operator <=(const X &w)const{return !(*this>w);}\n\tbool operator >=(const X &w)const{return w<=*this;}\n\tbool operator ==(const X &w)const{return !(*this<w||*this>w);}\n};\nmultiset<X>se[2];\nX va[100005];\nll Gcd(ll x,ll y){if(y<0||x<0)return Gcd(Abs(x),Abs(y));if(!x)return y;while(y)swap(y,x%=y);return x;}\nbool judge(){\n\tif(se[0].size()>1){\n\t\tauto l=se[0].begin(),r=se[0].end(),x=se[1].lower_bound(-*l);--r;\n\t\tif(x!=se[1].end()&&*x<=-*r)return 1;\n\t}if(se[1].size()>1){\n\t\tauto l=se[1].begin(),r=se[1].end(),x=se[0].lower_bound(-*l);--r;\n\t\tif(x!=se[0].end()&&*x<=-*r)return 1;\n\t}return 0;\n}\nint main(){\n\tll a=read,b=read,c=read;\n\tint w=0;\n\tif(a==0)swap(a,b),w|=1;\n\tif(a==0)swap(a,c),w|=2;\n\tint cnt=0;\n\tfor(int T=read;T--;){\n\t\tscanf(\"%s\",str);\n\t\tif(*str=='A'){\n\t\t\tll x=read,y=read,z=read;\n\t\t\tif(w&1)swap(x,y);\n\t\t\tif(w&2)swap(x,z);\n\t\t\tif(b==0&&y!=0){A[++cnt]=make_pair(2,4);goto OP;}\n\t\t\tif(c==0&&z!=0){A[++cnt]=make_pair(2,4);goto OP;}\n\t\t\ty=b*x-a*y;z=c*x-a*z;\n\t\t\tif(c)y*=c;if(b)z*=b;\n\t\t\tx=Gcd(y,z);if(x)y/=x,z/=x;\n\t\t\ttot+=ma[make_pair(-y,-z)];\n\t\t\tif(!ma[A[++cnt]=make_pair(y,z)]++)++t;\n\t\t\tva[cnt]=X(y,z);\n\t\t\tif(y||z)\n\t\t\t\tif(va[cnt].Wh()<=4)se[0].insert(va[cnt]);\n\t\t\t\telse se[1].insert(va[cnt]);\n\t\t}else{\n\t\t\tint v=read;\n\t\t\tif(A[v].first==2&&A[v].second==4)goto OP;\n\t\t\tif(!--ma[A[v]])--t;\n\t\t\ttot-=ma[make_pair(-A[v].first,-A[v].second)];\n\t\t\tif(va[v].x||va[v].y)\n\t\t\t\tif(va[v].Wh()<=4)se[0].erase(se[0].lower_bound(va[v]));\n\t\t\t\telse se[1].erase(se[1].lower_bound(va[v]));\n\t\t}OP:;\n\t\tif(ma[make_pair(0,0)])puts(\"1\");\n\t\telse if(tot)puts(\"2\");\n\t\telse if(t>2&&judge())puts(\"3\");\n\t\telse puts(\"0\");\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1621435012,
        "uid": 108067,
        "name": "\u4e1b\u96e8",
        "ccfLevel": 0,
        "title": "CF1386B Mixture"
    }
]