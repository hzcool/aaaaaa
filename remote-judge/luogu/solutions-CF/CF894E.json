[
    {
        "content": "\u8fd9\u4e2a\u9898\u601d\u8def\u4e0d\u96be\u60f3\uff0c\u4f46\u4ee3\u7801\u5b9e\u73b0\u4e0d\u662f\u5f88\u5bb9\u6613\u3002\u6211\u7684\u4ee3\u7801\u5b9e\u73b0\u5b8c\u5168\u53d6\u81ea[elijahqi](https://www.luogu.org/space/show?uid=5037)\u5927\u4f6c\u3002\u6211\u53ea\u662f\u60f3\u5c06\u5927\u4f6c\u7684\u601d\u8def\u548c\u4ee3\u7801\u7406\u7684\u66f4\u6e05\u695a\u4e00\u4e9b\u3002\n\n\u601d\u8def\u5f88\u5bb9\u6613\u60f3\u6e05\u6670\u7684\u3002\u7f29\u70b9\uff0c\u4e00\u4e2a\u5f3a\u8054\u901a\u5206\u91cf\u91cc\u6240\u6709\u8fb9\u7684\u8611\u83c7\u90fd\u80fd\u53d6\u5e72\u51c0\uff0c\u6240\u4ee5\u5c06\u8fd9\u4e9b\u8611\u83c7\u4f5c\u4e3a\u65b0\u70b9\u7684\u70b9\u6743\uff0c\u5728\u517c\u987e\u70b9\u6743\u548c\u8fb9\u6743\u7684\u540c\u65f6\u83b7\u5f97\u6700\u5927\u503c\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a\n\n1.\u7f29\u70b9\uff0c\u8fd9\u91cc\u5148\u4e0d\u8981\u8fdb\u884c\u4efb\u4f55\u5904\u7406\uff0c\u5355\u7eaf\u7684tarjan\u7f29\u70b9\uff0c\u56e0\u4e3atarjan\u7f29\u70b9\u4e0d\u5bb9\u6613\u5904\u7406\u8fb9\u6743\u3002\n\n2.\u5904\u7406\u6761\u8fb9\u7684\u8fb9\u6743\uff0c\u65b9\u6cd5\u662f\u679a\u4e3e\u6bcf\u6761\u8fb9\uff0c\u5982\u679c\u8fb9\u7684\u4e24\u7aef\u70b9\u5728\u4e00\u4e2a\u5f3a\u8054\u901a\u5206\u91cf\u4e2d\uff0c\u8be5\u5f3a\u8054\u901a\u5206\u91cf\u52a0\u4e0a\u8fd9\u6761\u8fb9\u6240\u80fd\u4ea7\u751f\u7684\u5168\u90e8\u8611\u83c7\u3002\u8fd9\u9700\u8981\u63a8\u4e00\u4e0b\uff0c\u4e5f\u4e0d\u96be\u3002\n\n3.\u5efa\u65b0\u56fe\u3002\n\n4.\u5728\u65b0\u56fe\u4e0a\u8fdb\u884c\u62d3\u6251\u6392\u5e8f+DP\u3002\u7528f[u]\u8bb0\u5f55\u4ee5u\u4e3a\u8d77\u70b9\u6240\u80fd\u83b7\u5f97\u7684\u6700\u5927\u6743\u503c\u3002\u5148\u628a\u6240\u6709\u65b0\u70b9f[i]\u66f4\u65b0\u4e3a-inf\uff0c\u5e76\u7edf\u8ba1\u5165\u5ea6\u4e3a0\u7684\u70b9\u3002\u7136\u540e\u5c06\u6e90\u70b9\u6240\u5728\u7684\u65b0\u70b9f[s]\u66f4\u65b0\u4e3a\u65b0\u70b9\u7684\u6743\u503c\u3002\u7136\u540e\u5728\u62d3\u6251\u6392\u5e8f\u7684\u8fc7\u7a0b\u4e2dDP\u5c31\u884c\u4e86\u3002\u5728DP\u8fc7\u7a0b\u4e2d\uff0cf[v]\u4e3a\u6700\u5927\u7684f[u]+w(u,v)\u3002\uff08u\u8fde\u5411v\uff09\n\n5.\u627e\u6700\u4f18\u89e3\uff0c\u5728\u6240\u6709\u65b0\u70b9\u4e2d\u627e\u6700\u5927\u7684f[i]\u5c31\u53ef\u4ee5\u4e86\u3002\n\n~~\u6284\u6765\u7684~~\u4ee3\u7801\uff1a\n\n```\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<cmath>\nusing namespace std;\n#define ll long long\n#define inf 1LL<<60\ninline ll read(){\n    ll x=0,f=1;char c=getchar();\n    while(c>'9'||c<'0'){if(c=='-')f=-f;c=getchar();\n    }\n    while(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();\n    }\n    return x*f;\n}\nconst int mx=1e6+1000;\nint dfn[mx],h[mx],low[mx],st[mx],co[mx],de[mx];ll ww[mx],f[mx];\nint p,num,top,col,n,m,s;\nll ans;\nint h1[mx],p1;\nstruct edge{\n    int next,v,x;ll w;\n}e[mx],e1[mx];\ninline void add(int a,int b,ll c){\n    p++;e[p].next=h[a]; h[a]=p; e[p].v=b; e[p].w=c; e[p].x=a;\n}\ninline void add1(int a,int b, ll c){\n    p1++;e1[p1].next=h1[a];h1[a]=p1;e1[p1].v=b;e1[p1].w=c;e1[p1].x=a;\n}\n//-------\ninline void tarjan(int u){\n    dfn[u]=low[u]=++num;\n    st[++top]=u;\n    for(int i=h[u];i;i=e[i].next){\n        int v=e[i].v;\n        if(!dfn[v]){\n            tarjan(v);\n            low[u]=min(low[u],low[v]);\n        }\n        else if(!co[v]){\n            low[u]=min(low[u],dfn[v]);\n        }\n    }\n    if(dfn[u]==low[u]){\n        ++col;\n        while(st[top+1]!=u){\n            co[st[top]]=col;\n            top--;\n        }\n    }\n}\ninline ll calc(ll x){//\u6284\u6765\u7684\u51fd\u6570\n    ll tt=sqrt(2*x+0.25)-0.5;\n    return x+tt*x-(tt+1)*(tt+2)*tt/6;\n}\nint main(){\n    n=read();m=read();\n    for(int i=1,u,v,w;i<=m;i++){\n        u=read();v=read();w=read();\n        add(u,v,w);\n        \n    }//duru\n    s=read();\n    for(int i=1;i<=n;i++)if(!dfn[i])tarjan(i);//suodian\n    \n    for(int i=1;i<=m;i++){\n        int u=e[i].x,v=e[i].v;\n        if(co[u]==co[v]){\n            ww[co[u]]+=calc(e[i].w);\n        }\n    }//quanzhi\n    \n    for(int i=1;i<=n;i++){\n        for(int j=h[i];j;j=e[j].next){\n            int v=e[j].v;\n            if(co[i]!=co[v]){\n                add1(co[i],co[v],e[j].w+ww[co[v]]);de[co[v]]++;\n            }\n        }\n    }//rebuild\n    top=0;num=0;\n    for(int i=1;i<=col;i++){\n        if(!de[i])st[++top]=i;\n        f[i]=-inf;\n    }\n    f[co[s]]=ww[co[s]];\n    \n    while(top){\n        int u=st[top--];\n        for(int i=h1[u];i;i=e1[i].next){\n            int v=e1[i].v;ll w=e1[i].w;\n            de[v]--;\n            if(!de[v]){\n                st[++top]=v;\n            }\n            f[v]=max(f[v],f[u]+w);\n        }\n    }//topo order\n    for(int i=1;i<=col;i++)ans=max(ans,f[i]);\n    printf(\"%lld\",ans);return 0;\n\n    \n}\n```\n\u611f\u8c22 elijahqi \u5927\u4f6c\u8ba9\u6211\u5b66\u5230\u5f88\u591a\u3002",
        "postTime": 1542541125,
        "uid": 72111,
        "name": "Maktub",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "[\u5e7f\u544a](http://m-sea-blog.com/)\n\n\u7ed9\u4e00\u4e2a\u5199\u5f97\u6bd4\u8f83\u6e05\u695a\u7684\u9898\u89e3 QAQ\n\n\u663e\u7136\u4e00\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u5185\u7684\u6240\u6709\u8fb9\u90fd\u53ef\u4ee5\u65e0\u9650\u8d70\uff0c\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u7f29\u70b9\u3002\n\n\u7f29\u70b9\u540e\uff0c\u6bcf\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u7684\u6743\u503c\u8bbe\u4e3a\u5185\u90e8\u6240\u6709\u8fb9\u80fd\u5f97\u5230\u7684\u8611\u83c7\u4e2a\u6570\u4e4b\u548c\uff0c\u8fde\u63a5\u5f3a\u8fde\u901a\u5206\u91cf\u7684\u8fb9\u7684\u6743\u503c\u8bbe\u4e3a\u8fb9\u4e0a\u7684\u8611\u83c7\u6570\uff0c\u7136\u540e DP \u6c42\u6700\u957f\u8def\u5373\u53ef\u3002\n\n\u8003\u8651\u600e\u4e48\u6c42\u8fb9\u6743\u4e3a $w$ \u7684\u8fb9\u65e0\u9650\u8d70\u80fd\u5f97\u5230\u7684\u8611\u83c7\u6570\u3002\u8bbe\u8fd9\u6761\u8fb9\u8d70\u4e86 $t$ \u6b21\u540e\u8611\u83c7\u53d8\u4e3a $0$\uff0c\u90a3\u4e48\n\n$$\\frac{t(t+1)}{2}<w$$\n\n\u89e3\u5f97 \n\n$$t=\\left\\lfloor\\sqrt{2x+\\frac{1}{4}}-\\frac{1}{2}\\right\\rfloor$$\n\n\u90a3\u4e48\u80fd\u5f97\u5230\u7684\u8611\u83c7\u6570\u662f\n\n$$\\begin{aligned}&\\sum_{i=0}^t\\left(w-\\sum_{j=0}^ij\\right)\\\\=&(t+1)w-\\sum_{i=0}^t\\frac{i(i+1)}{2}\\\\=&(t+1)w-\\left(\\frac{t(t+1)(2t+1)}{12}+\\frac{t(t+1)}{4}\\right)\\\\=&(t+1)w-\\frac{t(t+1)(t+2)}{6}\\end{aligned}$$\n\n```cpp\n// ===================================\n//   author: M_sea\n//   website: http://m-sea-blog.com/\n// ===================================\n#include <algorithm>\n#include <iostream>\n#include <cstdlib>\n#include <cstring>\n#include <cstdio>\n#include <cmath>\n#define re register\n#define int long long\nusing namespace std;\n\ninline int read() {\n    int X=0,w=1; char c=getchar();\n    while (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n    while (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n    return X*w;\n}\n\nconst int N=1000000+10;\n\nint n,m;\n\nstruct sedge { int u,v,w; } se[N];\n\nstruct edge { int v,w,nxt; } e[N];\nint head[N],ecnt=0;\ninline void addEdge(int u,int v,int w) {\n    e[++ecnt]=(edge){v,w,head[u]},head[u]=ecnt;\n}\n\nint dfn[N],low[N],tim=0,sta[N],in[N],top=0,bl[N],tot=0;\ninline void tarjan(int u) {\n    dfn[u]=low[u]=++tim,sta[++top]=u,in[u]=1;\n    for (re int i=head[u];i;i=e[i].nxt) {\n        int v=e[i].v;\n        if (!dfn[v]) tarjan(v),low[u]=min(low[u],low[v]);\n        else if (in[v]) low[u]=min(low[u],dfn[v]);\n    }\n    if (low[u]==dfn[u]) { ++tot;\n        while (233) {\n            int t=sta[top--]; in[t]=0,bl[t]=tot;\n            if (u==t) break;\n        }\n    }\n}\n\nint w[N],dp[N];\ninline int dfs(int u) {\n    if (dp[u]) return dp[u];\n    for (re int i=head[u];i;i=e[i].nxt)\n        dp[u]=max(dp[u],e[i].w+dfs(e[i].v));\n    return dp[u]+=w[u];\n}\n\ninline int calc(int w) {\n    int t=sqrt(2*w+0.25)-0.5;\n    return w*(t+1)-(t+1)*(t+2)*t/6;\n}\n\nsigned main() {\n    n=read(),m=read();\n    for (re int i=1;i<=m;++i) {\n        se[i]=(sedge){read(),read(),read()};\n        addEdge(se[i].u,se[i].v,se[i].w);\n    }\n    for (re int i=1;i<=n;++i) if (!dfn[i]) tarjan(i);\n    memset(head,0,sizeof(head)),ecnt=0;\n    for (re int i=1;i<=m;++i) {\n        int u=se[i].u,v=se[i].v;\n        if (bl[u]==bl[v]) w[bl[u]]+=calc(e[i].w);\n        else addEdge(bl[u],bl[v],e[i].w);\n    }\n    printf(\"%lld\\n\",dfs(bl[read()]));\n    return 0;\n}\n```",
        "postTime": 1571022128,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": " http://www.elijahqi.win/archives/1627\n https://blog.csdn.net/elijahqi/article/details/80686912\n \n\u9898\u76ee\u9898\u610f \u7ed9\u5b9a\u8fb9\u6743 \u6bcf\u6b21\u53ef\u4ee5\u53d6\u8fb9\u4e0ax x-1 x-1-2 x-1-2-3 \u76f4\u5230\u51cf\u52300\u4e3a\u6b62\n\n\u90a3\u4e48\u9996\u5148\u53ef\u4ee5tarjan\u7f29\u70b9 \u5c31\u662f\u6240\u6709\u5f3a\u8fde\u901a\u7684\u70b9\u4e0a\u53ef\u4ee5\u90fd\u53d6\u5230  \u90a3\u4e48 \u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u6570\u5b66\u65b9\u6cd5\u8ba1\u7b97\u5f3a\u8fde\u901a\n\n\u70b9\u7684\u6743\u503c \u8fd9\u4e2a\u5047\u8bbe\u6211\u4eec \u6700\u5927\u503c\u662fx  \u7136\u540e \u6c42\u51fa1+2+3+..x<=n \u8fd9\u4e2a\u6700\u5927\u7684x\u7684\u6574\u6570\u89e3\u51fa\u73b0\u5728\u54ea\u91cc\n\n\u90a3\u4e48\u6574\u4e2a\u73af\u7684\u7b54\u6848\u5c31\u662f\uff1a\u9996\u5148\u6c42\u51fan\u2217(n+1)<=w\u7684\u6700\u5927\u7684n\uff0c\u7136\u540e\u4ef7\u503c\u5c31\u662fn\u2217w\u2212\u2211i\u2217(i+1)/2+w(1<=i&i<=n)\uff0c\u4e5f\u5c31\u662fn\u2217w\u2212n\u2217(n+1)\u2217(n+2)/6+w\n\n\u7136\u540e\u6839\u636e\u62d3\u6251\u5e8f\u6c42\u51fa\u6211\u7684\u6700\u957f\u8def\u5373\u53ef \u7136\u540e\u6211\u5c31\u628a\u70b9\u6743\u76f4\u63a5\u8bb0\u5728\u8fb9\u4e0a \u8dd1\u62d3\u6251\u5e8fdp\n\n\u6700\u540e\u8f93\u51fa\u7b54\u6848\u5373\u53ef \u6ce8\u610f\u6709\u4e9b\u5730\u65b9\u9700\u8981\u4f7f\u7528Long long\n```\n#include<cstdio>\n#include<stack>\n#include<cmath>\n#include<queue>\n#include<algorithm>\n#define ll long long\n#define inf 1LL<<60\n#define N 1100000\nusing namespace std;\ninline char gc(){\n\tstatic char now[1<<16],*S,*T;\n\tif (T==S){T=(S=now)+fread(now,1,1<<16,stdin);if (T==S) return EOF;}\n\treturn *S++;\n}\ninline int read(){\n\tint x=0;char ch=gc();\n\twhile (ch<'0'||ch>'9') ch=gc();\n\twhile (ch<='9'&&ch>='0'){x=x*10+ch-'0';ch=gc();}\n\treturn x;\n}\nstack<int>q;\nstruct node{\n\tint x,y,next;ll z;\n}data[N<<1],data1[N<<1];\nll ans=-1,f[N],w[N];\nint b[N],stackf[N],dfn[N],low[N],h1[N],h[N],num,s,n,m,in[N];\nvoid tarjan(int x){\n\tdfn[x]=low[x]=++num;stackf[x]=1;q.push(x);\n\tfor (int i=h[x];i;i=data[i].next){\n\t\tint y=data[i].y;\n\t\tif (!dfn[y]) tarjan(y),low[x]=min(low[x],low[y]);else if (stackf[y]) low[x]=min(low[x],dfn[y]);\n\t}\n\tif (dfn[x]==low[x]){\n\t\tint y;++s;\n\t\tdo{\n\t\t\ty=q.top();q.pop();\n\t\t\tb[y]=s;stackf[y]=0;\n\t\t}while (y!=x);\n\t}\n}\ninline ll calc(ll x){\n\tll tt=sqrt(2*x+0.25)-0.5;\n\treturn x+tt*x-(tt+1)*(tt+2)*tt/6;\n}\ninline void insert1(int x,int y,ll z){\n\tdata1[++num].y=y;data1[num].z=z;data1[num].next=h1[x];h1[x]=num;data1[num].x=x;\n}\nint main(){\n\tfreopen(\"cf.in\",\"r\",stdin);\n\tn=read();m=read();\n\tfor (int i=1;i<=m;++i){\n\t\tint x=read(),y=read(),z=read();\n\t\tdata[++num].y=y;data[num].z=z;data[num].next=h[x];h[x]=num;data[num].x=x;\n\t}\n\tint st=read();num=0;\n\tfor (int i=1;i<=n;++i) if (!dfn[i]) tarjan(i);\n\tfor (int i=1;i<=m;++i){\n\t\tint x=data[i].x,y=data[i].y;\n\t\tif (b[x]==b[y]) w[b[x]]+=calc(data[i].z);\n\t}num=0;\n\tfor (int i=1;i<=n;++i){\n\t\tfor (int j=h[i];j;j=data[j].next){\n\t\t\tint y=data[j].y;if (b[y]==b[i]) continue;\n\t\t\tinsert1(b[i],b[y],data[j].z+w[b[y]]);\n\t\t}\n\t}queue<int>q;\n\tfor (int i=1;i<=s;++i) f[i]=-inf;f[b[st]]=w[b[st]];\n\tfor (int i=1;i<=num;++i) in[data1[i].y]++;\n\tfor (int i=1;i<=s;++i)  if (!in[i]) q.push(i);\n\twhile(!q.empty()){\n\t\tint x=q.front();q.pop();\n\t\tfor (int i=h1[x];i;i=data1[i].next){\n\t\t\tint y=data1[i].y;ll z=data1[i].z;if (--in[y]==0) q.push(y);f[y]=max(f[y],f[x]+z);\n\t\t}\n\t}\n\tfor (int i=1;i<=s;++i) ans=max(ans,f[i]);\n\tprintf(\"%I64d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1528905646,
        "uid": 5037,
        "name": "elijahqi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "# \u601d\u8def\n\n\u8fd9\u9053\u9898\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u91cd\u590d\u7684\u8d70\u4e00\u4e9b\u8def\u5f84\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u53ef\u4ee5\u5148\u7f29\u70b9\uff0c\u628a\u8fd9\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u91cc\u7684\u8fb9\u8d70\u65e0\u6570\u6b21\uff0c\u628a\u8611\u83c7~~\u91c7\u5230\u4e0d\u80fd\u518d\u91c7~~\uff0c\u7136\u540e\u5176\u4f59\u7684\u8fb9\u5728\u65b0\u56fe\u4e0a\u8dd1 \u62d3\u6251\u6392\u5e8f \u5e76\u8ba1\u7b97\u6700\u5927\u503c\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8981\u5904\u7406\u4e00\u4e2a\u8fb9\u591a\u6b21\u884c\u8d70\u6240\u80fd\u5e26\u6765\u7684\u4ef7\u503c\u3002\n\n\u6211\u770b\u5230\u522b\u7684\u9898\u89e3\u91cc\u597d\u50cf\u6709\u76f4\u63a5\u8ba1\u7b97\u7684\u516c\u5f0f\uff0c\u4f60\u4eec\u53ef\u4ee5\u53c2\u8003\u4e00\u4e0b\uff0c\u81f3\u4e8e\u6211~~\u6bd4\u8f83\u5f31~~\uff0c\u6240\u4ee5\u6211\u7528\u4e86\u53e6\u4e00\u79cd\u65b9\u6cd5\u3002\n\n\n### \u8fd9\u91cc\u6211\u7528 EXCEL \u8868\u793a\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/6olna4li.png)\n\n- \u5de6\u4fa7\u7684\u56fe\u4e3a\u6211\u4eec\u8981\u8ba1\u7b97\u7684\u56fe\uff0c\u53f3\u8fb9\u7684\u56fe\u4e3a\u8f85\u52a9\u56fe\u3002\n\n- \u9ed1\u8272\u533a\u57df\u4e3a\u6211\u4eec\u8981\u8ba1\u7b97\u7684\u9762\u79ef\u533a\u57df\uff0c\u4e5f\u5c31\u662f\u603b\u5171\u53ef\u4ee5\u91c7\u5230\u7684\u8611\u83c7\u6570\u91cf\u3002\u6574\u4e2a\u56fe\u5f62\u7684\u9ad8\u5ea6\u5c31\u662f\u6211\u4eec\u9996\u6b21\u5230\u8fbe\u65f6\u7684\u8611\u83c7\u6570\u91cf\u3002\n\n- \u8fd9\u4e24\u5e45\u56fe\u8bf7\u5206\u522b\u4ece\u4ece\u53f3\u5411\u5de6\u770b\u3002\n\n- \u4e2d\u95f4\u7684\u6570\u5b57\u8868\u793a\u5728\u5404\u4e2a\u9ad8\u5ea6\u4e0b\u53ef\u4ee5\u56fe\u5f62\u7684\u5bbd\u5ea6\uff0c\u4e5f\u5c31\u662f\u5f53\u8611\u83c7\u4e3a $i$ \u9700\u8981\u91c7\u96c6\u591a\u5c11\u6b21\u624d\u53d8\u4e3a $0$\u3002\n\n- \u6bcf\u5217\u7ea2\u8272\u533a\u57df\u7684\u5927\u5c0f\u4f9d\u6b21\u9012\u52a0 $k$ \u3002\n\n### \u5982\u4f55\u8ba1\u7b97\uff1a\n\n1. \u9996\u5148\u9884\u5904\u7406\u51fa\u6765\u6570\u7ec4 $cou$ \uff0c\u8868\u793a \u5f53\u6211\u91c7\u96c6 $i$ \u6b21\u624d\u91c7\u96c6\u5b8c\u65f6\uff0c\u8611\u83c7\u6570\u91cf\u6700\u591a\u4e3a\u591a\u5c11\u3002\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u56fe\u5f62\u7684\u5bbd\u5ea6\u4e86\u3002\u53ef\u4ee5\u7528\u4e8e\u540e\u9762\u7684\u4e8c\u5206\u3002\u7136\u540e\u6211\u4eec\u8981\u8ba1\u7b97\u6570\u7ec4 $ina$\uff0c\u8868\u793a \u5f53\u5bbd\u5ea6\u4e3a $i$ \u65f6\u7ea2\u8272\u533a\u57df\u7684\u9762\u79ef\uff0c\u8fd9\u4e2a\u76f4\u63a5\u7d2f\u52a0\u5c31\u597d\u4e86\u3002\uff08\u4e0d\u8981\u95ee\u6211\u4e3a\u4ec0\u4e48\u6570\u7ec4\u540d\u8fd9\u4e48\u5947\u602a\uff09\n\n2. \u6211\u4eec\u770b\u5230\u53f3\u9762\u7684\u56fe\u4e3a \u91c7\u96c6 $i$ \u6b21\u7684\u6700\u591a\u7684\u8611\u83c7\u6570\u91cf\uff0c\u663e\u7136\u9ed1\u8272\u533a\u57df\u9762\u79ef\u4e3a \u8611\u83c7\u6570\u91cf \u00d7 \u5bbd\u5ea6 - \u7ea2\u8272\u533a\u57df\u9762\u79ef \uff0c\u7528\u6211\u4eec\u7684\u6570\u7ec4\u8868\u793a\u4e3a $cou[i]*i-ina[i-1]$, \u5176\u4e2d $i$\u8868\u793a\u5bbd\u5ea6\u3002\n\n3. \u5f97\u5230\u53f3\u8fb9\u56fe\u5f62\u9ed1\u8272\u7684\u9762\u79ef\u540e\uff0c\u663e\u7136\u5de6\u8fb9\u7684\u4e5f\u5f88\u597d\u6c42\u4e86\uff0c\u5c31\u662f\u6bcf\u5217\u9ad8\u5ea6\u90fd\u964d\u4f4e\u76f8\u540c\u7684\u6570\u5b57\u3002\u7528\u6570\u7ec4\u8868\u793a $cou[i]*i-ina[i-1]+(now-cou[i])*i$ \u3002\u5176\u4e2d   $now$ \u8868\u793a\u4e3a\u5f53\u524d\u8611\u83c7\u7684\u6570\u91cf\u3002\n\n4. \u5177\u4f53\u64cd\u4f5c\u4e3a\uff1a\u5148\u4e8c\u5206\u627e\u5230\u6211\u4eec\u5f53\u524d\u8611\u83c7\u7684\u91c7\u96c6\u6b21\u6570 $pos$ ,\u7136\u540e\u5c31\u4ee3\u5165\u4e0a\u65b9\u7684\u516c\u5f0f\u8ba1\u7b97\u5373\u53ef\u3002\uff08\u4e0d\u8981\u55b7\u6211\u4e3a\u4ec0\u4e48\u53d8\u91cf\u540d\u8fd9\u4e48\u5947\u602a\uff09\n\n## \u4ee3\u7801\u987a\u5e8f\uff1a\n\n- \u9884\u5904\u7406\u51fa\u6570\u7ec4\u3002\n\n- $tarjan$ \u7f29\u70b9\u3002\n\n- \u5efa\u65b0\u56fe\uff0c\u8ba1\u7b97\u4e00\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u5185\u603b\u8ba1\u53ef\u4ee5\u91c7\u96c6\u7684\u8611\u83c7\u6570\u91cf\u3002\n\n- $dfs$ \u5904\u7406\u8d77\u70b9\u53ef\u8fbe\u7684\u5f3a\u8054\u901a\u5206\u91cf\u4ee5\u53ca\u5b83\u7684\u5165\u5ea6\u3002\n\n- $Topo$ \u8ba1\u7b97\u6bcf\u4e2a\u5f3a\u8054\u901a\u5206\u91cf\u4f5c\u4e3a\u7ec8\u70b9\u7684\u6700\u5927\u7b54\u6848\uff0c\u7136\u540e\u66f4\u65b0\u6700\u7ec8\u7b54\u6848\u3002\n\n## \u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<vector>\n#include<cmath>\n#include<stack>\n#include<queue>\n#include<iomanip>\nusing namespace std;\nint dfn[1000010],low[1000010],bel[1000010],ru[1000010];\nlong long ina[20000],cou[20000],sum[1000010],maxx[1000010];\nstack<int>sta;\nbool ins[1000010];\nint cnt,ti;\nstruct road\n{\n\tint to;\n\tlong long val;\n};\nvector<road>side[1000010],newside[1000010];\nvoid tarjan(int x)\n{\n\tdfn[x]=low[x]=++ti;\n\tins[x]=1;sta.push(x);\n\tfor(int i=0;i<side[x].size();i++)\n\t{\n\t\tint to=side[x][i].to;\n\t\tif(!dfn[to])\n\t\t{\n\t\t\ttarjan(to);\n\t\t\tlow[x]=min(low[x],low[to]);\n\t\t}\n\t\telse if(ins[to])low[x]=min(low[x],dfn[to]);\n\t}\n\tif(dfn[x]==low[x])\n\t{\n\t\tbel[x]=++cnt;\n\t\tins[x]=0;\n\t\twhile(sta.top()!=x)\n\t\t{\n\t\t\tbel[sta.top()]=cnt;\n\t\t\tins[sta.top()]=0;\n\t\t\tsta.pop();\n\t\t}\n\t\tsta.pop();\n\t}\n}\nvoid dfs(int x)\n{\n\tins[x]=1;\n\tfor(int i=0;i<newside[x].size();i++)\n\t{\n\t\tint to=newside[x][i].to;\n\t\t++ru[to];\n\t\tif(!ins[to])dfs(to);\n\t}\n}\nqueue<int>que;\nint main()\n{\n\tios::sync_with_stdio(0);\n\tint now=0,sx;long long tot=0;\n\tfor(int i=1;i<=20000;i++)\n\t{\n\t\tnow+=i;tot+=now;\n\t\tcou[i]=now;ina[i]=tot;\n\t\tif(now>110000000)\n\t\t{\n\t\t\tsx=i;\n\t\t\tbreak;\n\t\t}\n\t}\n\tint n,m,a,b;long long c;cin>>n>>m;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tcin>>a>>b>>c;\n\t\tside[a].push_back((road){b,c});\n\t}\n\tfor(int i=1;i<=n;i++)\n\tif(!dfn[i])tarjan(i);\n\tfor(int x=1;x<=n;x++)\n\tfor(int i=0;i<side[x].size();i++)\n\t{\n\t\tint to=side[x][i].to;\n\t\tlong long val=side[x][i].val;\n\t\tif(bel[x]!=bel[to])newside[bel[x]].push_back((road){bel[to],val});\n\t\telse \n\t\t{\n\t\t\tint pos=lower_bound(cou+1,cou+sx+1,val)-cou;\n\t\t\tlong long nu=cou[pos]*pos-ina[pos-1]+(val-cou[pos])*pos;\n\t\t\tsum[bel[x]]+=nu;\n\t\t}\n\t}\n\tlong long ans=0;\n\tcin>>a;\n\tdfs(bel[a]);\n\tque.push(bel[a]);\n\twhile(!que.empty())\n\t{\n\t\tint x=que.front();que.pop();\n\t\tmaxx[x]+=sum[x];ans=max(ans,maxx[x]);\n\t\tfor(int i=0;i<newside[x].size();i++)\n\t\t{\n\t\t\tint to=newside[x][i].to;\n\t\t\tlong long val=newside[x][i].val;\n\t\t\t--ru[to];if(!ru[to])que.push(to);\n\t\t\tmaxx[to]=max(maxx[to],maxx[x]+val);\n\t\t}\n\t}\n\tcout<<ans;\n}\n```",
        "postTime": 1572234796,
        "uid": 89785,
        "name": "\u7a7a\u306e\u8ecc\u8de1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u770b\u4e86\u4e0d\u4e45\u5c31\u60f3\u5230\u4e86\u601d\u8def\uff0c\u4f46\u662f\u4ee3\u7801\u5374\u8c03\u4e86\u4e00\u4e2a\u4e0a\u5348\u3002\u3002\u3002~~\uff08\u592a\u6bd2\u7624\u4e86\uff09~~\n\n\u5982\u679c\u67d0\u4e00\u6761\u9053\u8def\u4f1a\u8d70\u4e0d\u6b62\u4e00\u6b21\uff0c\u90a3\u4e48\u663e\u7136\u8fd9\u6761\u8def\u662f\u4f4d\u4e8e\u4e00\u4e2a\u73af\u4e2d\uff0c\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u73af\u8d70\u5f88\u591a\u6b21\u53ea\u5230\u80fd\u91c7\u7684\u8611\u83c7\u6570\u91cf\u7b49\u4e8e\uff10\uff0c\u5f3a\u8fde\u901a\u5206\u91cf\u7f29\u70b9\uff0b\u91cd\u65b0\u5efa\u56fe\u5373\u53ef\n\n\u90a3\u4e48\u600e\u4e48\u7b97\u53d6\u5b8c\u8611\u83c7\u7684\u6570\u91cf\u5462\uff1f\u9898\u89e3\u91cc\u90fd\u63a8\u51fa\u4e86\u5f0f\u5b50\uff0c~~\u90a3\u4e48\u6211\u5c31\u6765\u4e2a\u66b4\u529b\u4e00\u70b9\u7684~~\uff0c\u5148\u9884\u5904\u7406\u51fa\u8611\u83c7\u6570\u91cf\u4e3a\uff11\uff0c\uff13\uff0c\uff16\uff0c\uff11\uff10.....\u53d6\u5b8c\u8611\u83c7\u7684\u6570\u91cf\uff0c\u7136\u540e\u6bcf\u6b21\u4e8c\u5206\u67e5\u627e\u4e00\u4e0b\u5373\u53ef\n\n\u8fd9\u662f\u9884\u5904\u7406\n\n$w$\u6570\u7ec4\u662f$\\displaystyle \\sum^{i}_{1}{i}$\uff0c$sum$\u6570\u7ec4\u662f$\\displaystyle \\sum^{i}_{1}{w[i]}$\n\n```\n    for(long long i=1;i<=100000;i++)\n   \t{\n\t\tif(w[i-1]+i>100000000)\n\t\t{\n\t    \t\twsum=i-1;\n\t    \t\tbreak;\n\t\t}\n\t\tw[i]=w[i-1]+i,sum[i]=sum[i-1]+w[i];\n   \t}\n```\n\n\u4e8c\u5206\u67e5\u627e\n```\nlong long check(long long x)\n{\n    long long le=1,ri=wsum,mid;\n    while(le<=ri)\n    {\n\tmid=(le+ri)/2;\n\tif(x>w[mid])\n\t    le=mid+1;\n\telse\n\t    ri=mid-1;\n    }\n    return (ri+1)*x-sum[ri];\n}\n```\n\n\u505a\u5b8c\u8fd9\u4e9b\u518d\u6765\u4e00\u4e2a\u62d3\u6251\uff0bDP\u5373\u53ef\n\n\u5b8c\u6574\u4ee3\u7801\n```\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,x,y,v,df[1000003],low[1000003],dfn,col,co[1000003],ru[1000003],zhan[1000003],hd,p,s;\nvector<int>l[1000003],l1[1000003],g[1000003],g1[1000003];\nlong long w[1000003],sum[1000003],dis[1000003],quan[1000003],ans,wsum;\nqueue<int>q;\nlong long check(long long x)\n{\n    long long le=1,ri=wsum,mid;\n    while(le<=ri)\n    {\n\tmid=(le+ri)/2;\n\tif(x>w[mid])\n\t    le=mid+1;\n\telse\n\t    ri=mid-1;\n    }\n    return (ri+1)*x-sum[ri];\n}\nvoid dfs(int x)\n{\n    dfn++,df[x]=low[x]=dfn,hd++,zhan[hd]=x;\n    for(int j=0;j<l[x].size();j++)\n    {\n\tif(df[l[x][j]]==0)\n\t{\n\t    dfs(l[x][j]);\n\t    low[x]=min(low[x],low[l[x][j]]);\n\t}\n\telse\n\t    if(co[l[x][j]]==0)\t\t\n\t\tlow[x]=min(low[x],df[l[x][j]]);\n    }\n    if(df[x]==low[x])\n    {\n\tcol++,co[x]=col;\n\twhile(zhan[hd]!=x)\n\t    co[zhan[hd]]=col,hd--;\n\thd--;\t     \n    }\n}\nint main()\n{\n    cin>>n>>m;\n    for(int i=1;i<=m;i++)\n    {\n\tscanf(\"%d%d%d\",&x,&y,&v);\n\tl[x].push_back(y),l1[x].push_back(v);\n    }\n    cin>>s;\n    for(long long i=1;i<=100000;i++)\n    {\n\tif(w[i-1]+i>100000000)\n\t{\n\t    wsum=i-1;\n\t    break;\n\t}\n\tw[i]=w[i-1]+i,sum[i]=sum[i-1]+w[i];\n    }\n    dfs(s);\n    for(int i=1;i<=n;i++)\n\tfor(int j=0;j<l[i].size();j++)\n\t    if(co[i]==co[l[i][j]]&&co[i]!=0)\n\t\tquan[co[i]]+=check((long long)l1[i][j]);\n\t    else\n\t\tif(co[i]!=0&&co[l[i][j]]!=0)\n\t\t    g[co[i]].push_back(co[l[i][j]]),g1[co[i]].push_back(l1[i][j]),ru[co[l[i][j]]]++;\n    q.push(co[s]);\n    dis[co[s]]=quan[co[s]],ans=dis[co[s]];\n    while(!q.empty())\n    {\n\tp=q.front();q.pop();\n\tfor(int j=0;j<g[p].size();j++)\n\t{\n\t    dis[g[p][j]]=max(dis[g[p][j]],dis[p]+(long long)g1[p][j]+quan[g[p][j]]),ans=max(ans,dis[g[p][j]]),ru[g[p][j]]--;\n\t    if(ru[g[p][j]]==0)\n\t\tq.push(g[p][j]);\n\t}\n    }\n    cout<<ans;\n    return 0;\n}\n\n```\n\n[\u798f\u5229\uff08\u53cc\u500d\u7ecf\u9a8c\uff09](https://www.luogu.org/problem/P2656)\u7a0d\u5fae\u4fee\u6539\u4e00\u70b9\u5373\u53ef",
        "postTime": 1571023508,
        "uid": 78001,
        "name": "dz_ice",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/CF894E)\n\n\u53c8\u662f\u4e00\u9053\u597d\u60f3\u4e0d\u597d\u505a\u7684\u9898\u3002\n\n\u505a\u8fc7[\u91c7\u8611\u83c7](https://www.luogu.com.cn/problem/P2656)\u7684\u7ae5\u978b\u5e94\u8be5\u77e5\u9053\u8fd9\u9898\u7684\u601d\u8def\uff08\u51e0\u4e4e\u4e00\u6a21\u4e00\u6837\uff09\u3002\u4e0d\u8fc7\u4e3a\u4e86~~\u8fc7\u5ba1~~\u7167\u987e\u5176\u5b83\u4eba\uff0c\u6211\u8fd8\u662f\u8bb2\u4e00\u4e0b\u3002\n\n\u663e\u7136\uff0c\u5f3a\u8054\u901a\u5206\u91cf\u91cc\u53ef\u4ee5\u968f\u4fbf\u8d70\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u8d70\u6bcf\u6761\u8fb9\u65e0\u6570\u6b21\uff0c\u90a3\u80af\u5b9a\u53ef\u4ee5\u5c06**\u5305\u62ec\u65b0\u957f\u51fa\u5728\u5185\u7684**\u6240\u6709\u8611\u83c7\u53d6\u5b8c\u3002\u90a3\u5c31\u5148\u7f29\u70b9\uff0c\u7136\u540e\u6bcf\u4e2a\u70b9\u7684\u70b9\u6743\u4ee3\u8868\u4e86\u8fd9\u4e2a\u5f3a\u8054\u901a\u5206\u91cf\u91cc\u6240\u6709\u8611\u83c7\u6570\u91cf\u3002\u7136\u540e\u8dd1\u4e00\u8d9f\u6700\u957f\u8def\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7f29\u5b8c\u70b9\u540e\u7684 DAG \u65e2\u6709\u70b9\u6743\u53c8\u6709\u8fb9\u6743\uff0c\u53ef\u4ee5\u628a\u70b9\u6743\u52a0\u5230\u8fb9\u6743\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u8dd1\u6700\u957f\u8def\u7684\u65f6\u5019\u52a0\u4e0a\u3002\n\n\u7ed3\u679c\u4ea4\u4e0a\u53bb\u540e\u53d1\u73b0\u8d85\u65f6\u4e86\u3002\n\n\u4e3a\u4ec0\u4e48\uff1f\u56e0\u4e3a\u8ba1\u7b97\u5f3a\u8054\u901a\u5206\u91cf\u91cc\u8fb9\u7684\u8611\u83c7\u6570\u91cf\u8981 $\\sqrt{n}$ \u7684\u590d\u6742\u5ea6\uff0c\u52a0\u4e0a\u679a\u4e3e\u8fb9\uff0c$m\\sqrt{n}$ \u7684\u65f6\u95f4\u8fd9\u9898\u80af\u5b9a\u63a5\u53d7\u4e0d\u4e86\u3002\n\n\u600e\u4e48\u529e\uff1f\n\n\u9488\u5bf9\u6bcf\u4e00\u6761\u8fb9\uff0c\u8bbe\u8fd9\u6761\u8fb9\u521d\u59cb\u8611\u83c7\u6570\u4e3a $s$\uff0c\u53ef\u4ee5\u8d70\u7684\u6b21\u6570\u4e3a $x$\uff08\u5373\u8d70\u4e86 $x$ \u6b21\u4e4b\u540e\u5c31\u6ca1\u6709\u8611\u83c7\u4e86\uff09\u3002\n\n\u663e\u7136\u6709\uff1a\n\n$$\n\\frac{x(x+1)}{2}\\leq s<\\frac{(x+1)(x+2)}{2}\n$$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c$x$ \u4e3a\u65b9\u7a0b $\\frac{x(x+1)}{2}=s$ \u7684\u975e\u8d1f\u6570\u89e3\u5411\u4e0b\u53d6\u6574\u3002\n\n\u6613\u5f97 $x=\\frac{\\sqrt{8s+1}-1}{2}$\uff0c\u5373 $x=\\sqrt{2s+0.25}-0.5$\uff0c\u6c42\u51fa\u8fd9\u4e2a\u503c\u7136\u540e\u5411\u4e0b\u53d6\u6b63\u5c31\u884c\u3002\n\n\u4f46\u600e\u4e48\u7b97\u8611\u83c7\u603b\u6570\u5462\uff1f\n\n\u660e\u663e\uff0c\u8611\u83c7\u603b\u6570\u7b49\u4e8e\u521d\u59cb\u8611\u83c7\u6570\u91cf\u4e58\u8d70\u7684\u6b21\u6570\u52a0\u4e00\u7684\u548c\uff0c\u518d\u51cf\u53bb\u6bcf\u6b21\u4f1a\u51cf\u5c11\u7684\u8611\u83c7\u6570\u91cf\u7684\u548c\u3002\n\n\u52a0\u4e00\u662f\u56e0\u4e3a\u8981\u52a0\u4e0a\u7b2c\u4e00\u6b21\u8d70\uff0c\u8fd8\u672a\u51cf\u5c11\u8611\u83c7\u3002\n\n\u8bbe\u8611\u83c7\u603b\u6570\u4e3a $v$\uff0c\u6bcf\u6b21\u4f1a\u51cf\u5c11\u7684\u8611\u83c7\u6570\u91cf\u7684\u548c\u4e3a $y$\u3002\n\n\u6240\u4ee5 $v=s(x+1)-y$\u3002\n\n\u56e0\u4e3a $s$ \u548c $x$ \u90fd\u77e5\u9053\u4e86\uff0c\u53ea\u9700\u8981\u6c42 $y$\u3002\n\n\u600e\u4e48\u6c42\uff1f\u522b\u6025\uff0c\u5c06\u6240\u6709 $x$ \u6240\u4ee3\u8868\u7684 $y$ \u6253\u4e2a\u8868\uff1a\n\n```\n1 4 10 20 35...\n```\n\n\u662f\u4e0d\u662f\u5f88\u719f\u6089\uff1f\u7ec4\u5408\u6570\uff01\uff01\n\n\u53d1\u73b0 $y=C^3_{x+2}=\\frac{x(x+1)(x+2)}{6}$\u3002\n\n\u90a3\u5c31\u53ef\u4ee5\u5b8c\u7f8e\u6c42\u89e3\u4e86\u3002\n\n\u4f60\u53ef\u80fd\u4f1a\u95ee\u4e3a\u4ec0\u4e48\uff1f\u4e0b\u9762\u662f\u6211\u5bf9\u4e8e\u4e0a\u9762\u6c42 $y$ \u65f6\u7684\u516c\u5f0f\u7684\u8bc1\u660e\uff0c\u5927\u4f6c\u53ef\u8df3\u8fc7\u3002\n\n$$\n\\begin{aligned}\ny\n&=\\frac{\\underset{i=1}{\\overset{x}{\\sum}}i(i+1)}{2}\\\\\n&=\\frac{\\underset{i=1}{\\overset{x}{\\sum}}i^2+\\underset{i=1}{\\overset{x}{\\sum}}i}{2}\\\\\n&=\\frac{\\frac{x(x+1)(2x+1)}{6}+\\frac{x(x+1)}{2}}{2}\\\\\n&=\\frac{x(x+1)(2x+1)+3x(x+1)}{12}\\\\\n&=\\frac{x(x+1)(x+2)}{6}\\\\\n&=C^3_{x+2}\n\\end{aligned}\n$$\n\n\u597d\u7684\uff0c\u6700\u540e\u4e0a\u5177\u4f53\u4ee3\u7801\uff1a\n\n```cpp#include<bits/stdc++.h>\n#define ll long long\n#define N 1000005\nusing namespace std;\nint n,m,start;\nstruct Edge{int v;ll w;};\nvector <Edge> g[N],G[N];\nint dfn[N],low[N],cnt,S[N],tot;\nstack <int> st;\nll val[N],dis[N];\nbool vis[N];\nvoid Tarjan(int k){\n\tdfn[k]=low[k]=++cnt;st.push(k);vis[k]=1;\n\tfor(int i(0);i<g[k].size();++i){\n\t\tint s(g[k][i].v);\n\t\tif(!dfn[s]){\n\t\t\tTarjan(s);\n\t\t\tlow[k]=min(low[k],low[s]);\n\t\t}\n\t\telse if(vis[s]) low[k]=min(low[k],dfn[s]);\n\t}\n\tif(low[k]==dfn[k]){\n\t\tint x(-1);++tot;\n\t\twhile(x^k){\n\t\t\tx=st.top();st.pop();\n\t\t\tS[x]=tot;vis[x]=0;\n\t\t}\n\t}\n}\ninline ll dfs(int k){\n\tif(dis[k]) return dis[k];\n\tfor(int i(0);i<G[k].size();++i)\n\t\tdis[k]=max(dis[k],dfs(G[k][i].v)+G[k][i].w);\n\treturn dis[k]+=val[k];\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i(1);i<=m;++i){\n\t\tint u,v;ll w;\n\t\tscanf(\"%d%d%lld\",&u,&v,&w);\n\t\tg[u].push_back((Edge){v,w});\n\t}\n\tfor(int i(1);i<=n;++i) if(!dfn[i]){cnt=0;Tarjan(i);}\n\tfor(int u(1);u<=n;++u)\n\t\tfor(int i(0);i<g[u].size();++i){\n\t\t\tint v(g[u][i].v);\n\t\t\tif(S[u]==S[v]){\n\t\t\t\tll t(sqrt(2*g[u][i].w+0.25)-0.5);\n\t\t\t\tval[S[u]]+=(t+1)*g[u][i].w-t*(t+1)*(t+2)/6;\n\t\t\t}\n\t\t\telse G[S[u]].push_back((Edge){S[v],g[u][i].w});\n\t\t}\n\tscanf(\"%d\",&start);\n\tprintf(\"%lld\\n\",dfs(S[start]));\n\treturn 0;\n}\n```",
        "postTime": 1658233043,
        "uid": 554574,
        "name": "gyyyyx",
        "ccfLevel": 0,
        "title": "Ralph and Mushrooms"
    },
    {
        "content": "### Preface\n\n\u8fdc\u53e4 CF \u56fe\u8bba\u677f\u5b50\u9898\uff0c\u5957\u4e86\u4e2a\u6570\u5b66\u3002\n\n### Solution\n\n\u4e0d\u96be\u60f3\u5230\uff0c\u5728\u6709\u5411\u56fe\u4e2d\uff0c\u73af\u4e0a\u7684\u8fb9\u53ef\u4ee5\u4e00\u76f4\u904d\u5386\u76f4\u5230\u53d6\u5b8c\u3002\u5176\u4f59\u7684\u8fb9\u53ea\u80fd\u8d70\u4e00\u6b21\u3002\n\n\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u7f29\u70b9\uff0c\u5728 DAG \u4e0a\u62d3\u6251\u6c42\u51fa\u7b54\u6848\u3002\n\n\u5173\u952e\u5728\u4e8e\u5982\u4f55\u8ba1\u7b97\u73af\u4e0a\u7684\u70b9\u53ef\u4ee5\u5f97\u5230\u591a\u5c11\u8d21\u732e\u3002\n\n\u8003\u8651\u4e00\u6761\u8fb9\uff0c\u6743\u503c\u4e3a $w$\uff0c\u6709\u6548\u7ecf\u8fc7\u6b21\u6570\u4e3a $t$\uff0c\u90a3\u4e48\u6ee1\u8db3\uff1a\n\n$$\\frac{t(t+1)}{2}\\le w$$\n\n\u89e3\u4e00\u4e0b\u4e8c\u6b21\u4e0d\u7b49\u5f0f\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$t=\\lceil\\dfrac{\\sqrt{1+8w}-1}{2} \\rceil$$\n\n\u7136\u540e\u5c31\u662f\u8ba1\u7b97\u8fd9 $t$ \u6b21\u7ecf\u8fc7\u80fd\u4ea7\u751f\u7684\u603b\u8d21\u732e\uff1a\n\n$$w+(w-1)+(w-1-2)+\\cdots +(w-1-2-\\cdots -(t-1))$$\n\n\u5199\u6210\u548c\u5f0f\u5c31\u662f\uff08**\u8003\u8651\u6bcf\u4e2a\u6570\u5b57\u51cf\u53bb\u7684\u6b21\u6570**\uff09\uff1a\n\n$$tw-\\sum_{i=0}^{t-1} (t-i)i$$\n\n\u628a $\\sum$ \u91cc\u7684\u62c6\u5f00\uff0c\u6700\u540e\u5f97\u5230\uff1a\n\n$$tw-\\left(\\frac{t^2(t-1)}{2}-\\frac{t(t-1)(2t-1)}{6}\\right)$$\n\n----------\n\n\u63a5\u4e0b\u6765\u662f\u56fe\u8bba\u90e8\u5206\u3002\n\n\u7f29\u70b9\u4e4b\u540e\u8fd9\u4e2a\u73af\u4e0a\u7684\u6743\u503c\u52a0\u5728\u8fd9\u4e2a\u7f29\u6210\u70b9\u4e0a\uff0c\u7136\u540e\u62d3\u6251\u6392\u5e8f +dp \u5c31\u884c\u4e86\uff0c\u5f88\u5957\u8def\u3002dp \u5199\u51fa\u6765\u5c31\u662f\uff1a\n\n$$f_v=\\max\\{f_{u}+w_v+val(u,v)\\}$$\n\n\u5176\u4e2d $w_v$ \u662f $v$ \u8fd9\u4e2a\u70b9\u7f29\u70b9\u540e\u7684\u70b9\u6743\uff0c$val(u,v)$ \u662f $u\\to v$ \u7684\u8fb9\u6743\u3002\n\n### Code\n\n\u7b14\u8005\u7684\u7f29\u70b9\u662f\u5e76\u67e5\u96c6\u5b9e\u73b0\u7684\uff0c\u6709\u5f88\u591a\u7ec6\u8282\u3002\u8fd9\u91cc\u4e0d\u4fbf\u6089\u6570\u6307\u51fa\u3002\n\n```cpp\nint find(cint& a)\n{\n\treturn f[a]==a?a:f[a]=find(f[a]);\n}\n\ninline ll calc(const ll n)\n{\n\tconst ll t=ceil((sqrt(1+8ll*n)-1.0)/2.0);\n\tconst ll p=(t-1)*t*t/2-(t-1)*t*(2*t-1)/6;\n\treturn t*n-p;\n}\n\nvoid dfs(cint& u)\n{\n\tfor(const auto& it:edge[u])\n\t{\n\t\tcint& v=it.to;\n\t\tif(!visit[v])\n\t\t{\n\t\t\tvisit[v]=visit[u]+1;\n\t\t\tdfs(v);\n\t\t}\n\t\tcint fu=find(u),fv=find(v);\n\t\tif(visit[fv]>0)\n\t\t{\n\t\t\tif(visit[fu]<visit[fv])\tf[fv]=fu;\n\t\t\telse\tf[fu]=fv;\n\t\t}\n\t}\n\tvisit[u]=-1;\n}\n\nvoid topo_sort(void)\n{\n\tfor(int i=1;i<=n;i++)\n\t\tdis[find(i)]=w[find(i)];\n\tqueue <int> q;\n\tfor(int i=1;i<=n;i++)\n\t\tif(!indeg[i])\n\t\t\tq.emplace(i);\n\tmemset(visit,0,sizeof(visit));\n\twhile(!q.empty())\n\t{\n\t\tcint u=q.front();q.pop();\n\t\tif(visit[u])\tcontinue;\n\t\tvisit[u]=true;\n\t\tfor(const auto& it:edge[u])\n\t\t{\n\t\t\tcint v=it.to;\n\t\t\tdis[v]=max(dis[v],dis[u]+it.val+w[v]);\n\t\t\tindeg[v]--;\n\t\t\tif(!indeg[v])\tq.emplace(v);\n\t\t}\n\t}\n}\n\nint main()\n{\n\tread(n,m);\n\tfor(int i=1;i<=n;i++)\tf[i]=i;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u,v,val;read(u,v,val);\n\t\te[i]=Edge{u,v,val};\n\t\tedge[u].emplace_back(node{v,val});\n\t}\n\tread(st);\n\tfor(int i=1;i<=n;i++)\n\t\tif(!visit[i])\n\t\t{\n\t\t\tvisit[i]=1;\n\t\t\tdfs(i);\n\t\t}\n\tfor(int i=1;i<=n;i++)\tedge[i].clear();\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tcint x=find(e[i].u),y=find(e[i].v);\n\t\tif(x==y)\tw[x]+=calc(e[i].w);\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tcint x=find(e[i].u),y=find(e[i].v);\n\t\tif(x==y)\tcontinue;\n\t\tedge[find(e[i].v)].emplace_back(node{find(e[i].u),e[i].w});\n\t\tindeg[find(e[i].u)]++;\n\t}\n\ttopo_sort();\n\tcout<<dis[find(st)]<<endl; \n\treturn 0;\n}\n```",
        "postTime": 1610115129,
        "uid": 80049,
        "name": "Hexarhy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "[\u95e8](https://codeforces.ml/contest/894/problem/E)\n\n\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u4e2a$n$\u4e2a\u70b9$m$\u6761\u8fb9\u7684\u56fe\uff0c\u6bcf\u6761\u8fb9\u6709\u8fb9\u6743\uff0c\u7b2c\u4e00\u6b21\u7ecf\u8fc7\u65f6\uff0c\u8fb9\u6743\u662f$k_i$\uff0c\u7b2c\u4e8c\u6b21\u662f$k_i-1$\uff0c\u7b2c\u4e09\u6b21\u662f$k_i-1-2$\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u8fb9\u6743\u4e0d\u4f1a\u4f4e\u4e8e$0$\u3002\u95ee\u4ece$S$\u70b9\u51fa\u53d1\uff0c\u6700\u591a\u7684\u8fb9\u6743\u548c\u4e3a\u591a\u5c11\u3002\n\n\u9898\u89e3\uff1a\u5bf9\u4e8e$scc$\u4e2d\u7684\u70b9\uff0c\u5e94\u8be5\u628a\u5176\u4e2d\u7684\u8fb9\u6743\u8dd1\u6ee1\uff0c\u5982\u4f55\u8ba1\u7b97\u4e00\u6761\u8fb9\u8dd1\u6ee1\u7684\u4ee3\u4ef7\u5462\uff1f\n\n\u5148\u4e8c\u5206\u51fa\u7b2c\u51e0\u6b21\u65f6\u8fd9\u6761\u8fb9\u4f1a$<0$\uff0c\u4e3a$x$\uff0c\u5219\u8fd9\u6761\u8fb9\u7684\u8d21\u732e\u662f$x*k_i-he(x)$\uff0c$he(i)$\u662f$1\\sim i$\u7684\u548c\u7684\u548c\u3002\n\n\u628a\u6240\u6709\u8fb9\u7684\u8d21\u732e\u52a0\u5230$scc$\u4e2d\u4f5c\u4e3a\u70b9\u6743\u3002\n\n\u7136\u540e\u9006\u7740\u62d3\u6251\u5e8f\u8dd1$DP$,\u56e0\u4e3a\u9898\u76ee\u8981\u7b97$S$\u51fa\u53d1\u7684\u6700\u5927\u503c\u3002\n\n\u56e0\u4e3a\u5df2\u7ecf\u8dd1\u8fc7$tarjan$\uff0c\u6240\u4ee5\u4e0d\u7528\u62d3\u6251\u6392\u5e8f\uff0c\u76f4\u63a5\u5faa\u73af\u5373\u53ef\u3002\n```cpp\n\tfor(i=1;i<=tot;i++)\n\t{\n\t\tfor(j=0;j<v[i].size();j++)\n\t\t{\n\t\t\tint u=v[i][j].fi;ll nu=v[i][j].se;\n\t\t\tans[u]=max(ans[u],ans[i]+nu+a[u]);\n\t\t}\t\n\t}\n```\n\n#### Tips\n\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u62d3\u6251\u6392\u5e8f\u4f1aT\u3002\n\n**code(AC)**\n```cpp\n//love yjl forever\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long \n#define pii pair<int,int>\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\nconst int INF=0x3f3f3f3f,N=1e6+5,M=1e6+5;\nint n,m,S;\nint head[N],to[M],Next[M],cnt;\nll num[M];\nvoid add(int x,int y,ll z)\n{\n\tNext[++cnt]=head[x];head[x]=cnt;to[cnt]=y;num[cnt]=z;\n}\nint dfn[N],low[N],belong[N],sta[N],top,tot,bh;\nbool vis[N];\nvoid tarjan(int x)\n{\n\tdfn[x]=low[x]=++bh;\n\tsta[++top]=x;vis[x]=1;\n\tfor(int i=head[x];i;i=Next[i])\n\t{\n\t\tint u=to[i];\n\t\tif(!dfn[u])\n\t\t{\n\t\t\ttarjan(u);\n\t\t\tlow[x]=min(low[x],low[u]);\n\t\t}\n\t\telse if(vis[u])\n\t\t{\n\t\t\tlow[x]=min(low[x],dfn[u]);\n\t\t}\n\t}\n\tif(low[x]==dfn[x])\n\t{\n\t\tint y;tot++;\n\t\tdo\n\t\t{\n\t\t\ty=sta[top--];\n\t\t\tbelong[y]=tot;\n\t\t\tvis[y]=0;\n\t\t}while(y!=x);\n\t}\n}\nll hehe[15005],he[15005],a[N],ans[N];\nll calc(ll x)\n{\n\tll k=lower_bound(he+1,he+15001,x)-he;\n\treturn k*x-hehe[k-1];\n}\nvector<pair<int,ll> > v[N];\nint main()\n{\n/*\tfreopen(\"\",\"r\",stdin);\n\tfreopen(\"\",\"w\",stdout);*/\n\tint i,j;\n\tfor(i=1;i<=15000;i++)\n\t\the[i]=(i*(i+1)/2),hehe[i]=hehe[i-1]+he[i];\n\t\t\n\tcin>>n>>m;\n\tfor(i=1;i<=m;i++)\n\t{\n\t\tint x,y,z;\n\t\tscanf(\"%d%d%d\",&x,&y,&z);\n\t\tadd(x,y,z);\n\t}\n\tfor(i=1;i<=n;i++)\n\t\tif(!dfn[i]) tarjan(i);\n\tcin>>S;\n//\tfor(i=1;i<=tot;i++)\n//\t\tcout<<a[i]<<\" \";\n\t\t\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=head[i];j;j=Next[j])\n\t\t{\n\t\t\tint u=to[j];ll nu=num[j];\n\t\t\tif(belong[i]==belong[u])\n\t\t\t{\n\t\t\t\ta[belong[i]]+=calc(nu);\n\t\t\t}\n\t\t\telse \n\t\t\t{\n\t\t\t\tv[belong[u]].pb(mp(belong[i],nu));\n\t\t\t}\n\t\t}\n\tfor(i=1;i<=tot;i++)\n\t\tans[i]=a[i];\n\tfor(i=1;i<=tot;i++)\n\t{\n\t\tfor(j=0;j<v[i].size();j++)\n\t\t{\n\t\t\tint u=v[i][j].fi;ll nu=v[i][j].se;\n\t\t\tans[u]=max(ans[u],ans[i]+nu+a[u]);\n\t\t}\t\n\t}\n\tcout<<ans[belong[S]]<<endl;\n}\n```\n\n**code(T)**\n```cpp\n//love yjl forever\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long \n#define pii pair<int,int>\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\nconst int INF=0x3f3f3f3f,N=1e6+5,M=1e6+5;\nint n,m,S;\nint head[N],to[M],Next[M],cnt;\nll num[M];\nvoid add(int x,int y,int z)\n{\n\tNext[++cnt]=head[x];head[x]=cnt;to[cnt]=y;num[cnt]=z;\n}\nint dfn[N],low[N],belong[N],sta[N],top,tot,bh;\nbool vis[N];\nvoid tarjan(int x)\n{\n\tdfn[x]=low[x]=++bh;\n\tsta[++top]=x;vis[x]=1;\n\tfor(int i=head[x];i;i=Next[i])\n\t{\n\t\tint u=to[i];\n\t\tif(!dfn[u])\n\t\t{\n\t\t\ttarjan(u);\n\t\t\tlow[x]=min(low[x],low[u]);\n\t\t}\n\t\telse if(vis[u])\n\t\t{\n\t\t\tlow[x]=min(low[x],dfn[u]);\n\t\t}\n\t}\n\tif(low[x]==dfn[x])\n\t{\n\t\tint y;tot++;\n\t\tdo\n\t\t{\n\t\t\ty=sta[top--];\n\t\t\tbelong[y]=tot;\n\t\t\tvis[y]=0;\n\t\t}while(y!=x);\n\t}\n}\nll hehe[15005],he[15005],a[N],ans[N],bi[N];\nint de[N];\nll calc(ll x)\n{\n\tll k=lower_bound(he+1,he+15001,x)-he;\n\treturn k*x-hehe[k-1];\n}\nint live[N];\nvector<pair<int,ll> > v[N];\nvoid dfs(int x)\n{\n\tlive[x]=1;\n\tfor(int i=0;i<v[x].size();i++)\n\t{\n\t\tint u=v[x][i].fi;\n\t\tdfs(u);\n\t}\n}\nvoid topsort()\n{\n\tint i,j;\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=head[i];j;j=Next[j])\n\t\t{\n\t\t\tint u=to[j],nu=num[j];\n\t\t\tif(belong[i]!=belong[u]&&live[belong[i]]&&live[belong[u]])\n\t\t\t{\n\t\t\t\tde[belong[u]]++;\n\t\t\t}\n\t\t}\t\n\tqueue<int> q;\n\tq.push(belong[S]);\n\tans[belong[S]]=a[belong[S]];\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();q.pop();\n\t\tfor(i=0;i<v[x].size();i++)\n\t\t{\n\t\t\tint u=v[x][i].fi;ll nu=v[x][i].se;\n\t\t\tif(!live[u]) continue;\n\t\t//\tcout<<x<<\" \"<<u<<\" \"<<nu<<endl;\n\t\t\tans[u]=max(ans[u],ans[x]+nu);\n\t\t\tde[u]--;\n\t\t\tif(!de[u])\n\t\t\t{\n\t\t\t\tans[u]+=a[u];\n\t\t\t\tq.push(u);\n\t\t\t}\n\t\t\t\t\n\t\t}\n\t}\n}\nint main()\n{\n/*\tfreopen(\"\",\"r\",stdin);\n\tfreopen(\"\",\"w\",stdout);*/\n\tint i,j;\n\tfor(i=1;i<=15000;i++)\n\t\the[i]=(i*(i+1)/2),hehe[i]=hehe[i-1]+he[i];\n\t\t\n\tcin>>n>>m;\n\tfor(i=1;i<=m;i++)\n\t{\n\t\tint x,y,z;\n\t\tscanf(\"%d%d%d\",&x,&y,&z);\n\t\tadd(x,y,z);\n\t}\n\tfor(i=1;i<=n;i++)\n\t\tif(!dfn[i]) tarjan(i);\n\tcin>>S;\n//\tfor(i=1;i<=tot;i++)\n//\t\tcout<<a[i]<<\" \";\n\t\t\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=head[i];j;j=Next[j])\n\t\t{\n\t\t\tint u=to[j];ll nu=num[j];\n\t\t\tif(belong[i]==belong[u])\n\t\t\t{\n\t\t\t\ta[belong[i]]+=calc(nu);\n\t\t\t}\n\t\t\telse \n\t\t\t{\n\t\t\t\tv[belong[i]].pb(mp(belong[u],nu));\n\t\t\t}\n\t\t}\n//\tfor(i=1;i<=tot;i++)\n//\t\tcout<<a[i]<<endl;\n//\t\t\n\tdfs(belong[S]);\n\t\n\t\n\ttopsort();\n\tcout<<*max_element(ans+1,ans+1+tot)<<endl;\n//\tfor(i=1;i<=tot;i++)\n//\t\tcout<<ans[i]<<\" \";\n}\n```",
        "postTime": 1584440270,
        "uid": 20338,
        "name": "zhmshitiancai",
        "ccfLevel": 7,
        "title": "CF 894 E"
    },
    {
        "content": "## \u3010\u9898\u89e3\u3011CF894E Ralph and Mushrooms (\u7f29\u70b9)\n\n\u8fd9\u662f\u7d2b\uff1f\u7ed9\u4e2a\u89e3\u65b9\u7a0b\u7b97\u6cd5\n\n\u8003\u8651\u4e00\u6761\u8fb9\u82e5\u53ef\u4ee5\u91cd\u590d\u904d\u5386\u8bf4\u660e\u4e00\u5b9a\u6709\u73af\uff0c\u6709\u73af\u7684\u8bdd\u4e00\u5b9a\u4f1a\u628a\u73af\u4e0a\u7684\u8611\u83c7\u69a8\u5e72\uff0c\u8003\u8651\u4e00\u6761\u8fb9\u4ece\u5168\u90e8\u5230\u69a8\u5e72\u7684\u8d21\u732e\u662f\u591a\u5c11\n\n$\\sum_{i=0}^x (w-\\sum_{j=0}^i j)=\\sum_{i=0}^x (w-{i(i+1)\\over 2})$\n\n\n\u90a3\u4e48\u8003\u8651\u89e3\u51fa$x$\u7684\u503c\uff0c\u89e3\u51fa\u6765$x=\\lfloor{-1+\\sqrt{1+8w}\\over 2}\\rfloor$\uff0c\u9884\u5904\u7406$\\sum {i(i+1)\\over 2}$\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u8d21\u732e(\u5176\u5b9e\u4e5f\u53ef\u4ee5\u89e3\u901a\u9879\u516c\u5f0f)\n\n\u7136\u540eTarjan\u7f29\u70b9\u4e4b\u540e\u53d8\u6210DAG\u4e0a\u7684DP\uff0c\u540c\u65f6\u6709\u70b9\u6743\u548c\u8fb9\u6743\u7684DAG DP\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n)$\n\n```cpp\n//@winlere\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<vector>\n#include<cmath>\n\nusing namespace std;  typedef long long ll;   char __buf[1<<18],*__c=__buf,*__ed=__buf;\ninline int qr(){\n\tregister int ret=0,f=0;\n\tregister char c=getchar();\n\twhile(!isdigit(c))f|=c==45,c=getchar();\n\twhile(isdigit(c)) ret=ret*10+c-48,c=getchar();\n\treturn f?-ret:ret;\n}\n\nconst int maxn=1e6+5;\nstruct E{int to,w;};\nvector<E> e[maxn],e2[maxn];\ninline void add(const int&fr,const int&to,const int&w){e[fr].push_back({to,w});}\ninline void add2(const int&fr,const int&to,const int&w){\n\te2[fr].push_back({to,w});\n}\nint n,m;\nint qaq[maxn],cnt;\nll w[maxn],dp[maxn];\nbool usd[maxn];\nint low[maxn],dfn[maxn],in[maxn],stk[maxn],top,siz[maxn];\nll s[maxn];\n \nvoid dfs(const int&now){\n\tstk[++top]=now; in[now]=1;\n\tlow[now]=dfn[now]=++*dfn;\n\tfor(auto t:e[now]){\n\t\tif(!dfn[t.to]) dfs(t.to),low[now]=min(low[now],low[t.to]);\n\t\telse if(in[t.to]) low[now]=min(dfn[t.to],low[now]);\n\t}\n\tif(low[now]==dfn[now]){\n\t\t++cnt;\n\t\tint temp;\n\t\tdo temp=stk[top--],in[temp]=0,qaq[temp]=cnt,++siz[cnt];\n\t\twhile(temp!=now);\n\t}\n}\n\nll Dp(const int&now){\n\tif(usd[now]) return dp[now];\n\tdp[now]=0;\n\tfor(auto t:e2[now]) dp[now]=max(dp[now],Dp(t.to)+t.w);\n\tusd[now]=1;\n\treturn dp[now]=w[now]+dp[now];\n}\n\nint main(){\n\tn=qr(); m=qr();\n\tfor(int t=1,t1,t2,t3;t<=m;++t) t1=qr(),t2=qr(),t3=qr(),add(t1,t2,t3);\n\tfor(int t=1;t<maxn;++t) s[t]=s[t-1]+(1ll*t*(t+1)>>1);\n\tint S=qr();\n\tdfs(S);\n\tfor(int t=1;t<=n;++t)\n\t\tfor(auto i:e[t]){\n\t\t\tif(qaq[t]==qaq[i.to]) {\n\t\t\t\tint k=(sqrt((long double)1+8ll*i.w)-1)/2.0;\n\t\t\t\tw[qaq[t]]=w[qaq[t]]+(k+1ll)*i.w-s[k];\n\t\t\t}\n\t\t\telse add2(qaq[t],qaq[i.to],i.w);\n\t\t}\n\tll ans=Dp(qaq[S]);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n\n\n```\n\n\n\n",
        "postTime": 1573039058,
        "uid": 113460,
        "name": "\u8c01\u662f\u9e3d\u738b",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[$luogu$](https://www.luogu.org/problem/CF894E).\n# \u9898\u89e3\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5e94\u8be5\u7b97\u662f\u4e00\u9053\u6bd4\u8f83\u677f\u7684\u7f29\u70b9\u4e86.\n## $Part_1$ \u601d\u8def\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9996\u5148\u6211\u4eec\u8003\u8651\u4e00\u6761\u8fb9, \u5982\u679c\u5b83\u662f\u73af\u4e0a\u7684\u8fb9, $Ralph$\u5f53\u7136\u5e94\u8be5\u4e00\u76f4\u8f6c\u5708\u5708\u76f4\u5230\u73af\u4e0a\u6ca1\u6709\u4e00\u70b9\u8611\u83c7. \u6240\u4ee5\u60f3\u5230\u5229\u7528$Tarjan$\u7f29\u70b9, \u5728\u7b97\u51fa\u6bcf\u4e2a\u70b9\u7684\u6536\u76ca, \u6700\u540e$DAG$\u4e0a$DP$\u6c42\u6700\u957f\u94fe\u5373\u53ef.\n## $Part_2$ \u70b9\u6743\u8ba1\u7b97\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bf4\u662f\u70b9\u6743, \u5176\u5b9e\u5b83\u662f\u539f\u56fe\u4e0a\u82e5\u5e72\u8fb9\u7684\u6536\u76ca\u4e4b\u548c.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9996\u5148, \u6211\u4eec\u8003\u8651\u4e00\u6761\u6743\u4e3a$w$\u7684\u8fb9\u63d0\u4f9b\u7684\u6536\u76ca. \u5047\u8bbe\u8fd9\u6761\u8fb9\u6700\u591a\u63d0\u4f9b$n+1$\u6b21\u6536\u76ca, \u90a3\u4e48:\n$$\n\\sum_{i=0}^ni\\le w\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5373:\n$$\n\\frac{n(n+1)}2\\le w\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8003\u8651\u901a\u8fc7\u4e00\u5143\u4e8c\u6b21\u65b9\u7a0b\u7684\u6839\u6c42\u51fa$n$\u7684\u6700\u5927\u503c, \u90a3\u4e48:\n$$\n\\frac{1}2n^2+\\frac{1}2n-w\\le0\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7531\u4e8e$n\\ge0$, \u8be5\u65b9\u7a0b\u7684\u6b63\u6839\u5c31\u662f$n$\u7684\u6700\u5927\u503c, \u4e0b\u53bb\u6574\u4fbf\u662f\u6240\u6c42\u7684$n$. \u5373:\n$$\nn=\\lfloor-\\frac{1}2+\\sqrt{\\frac{1}4+2w}\\rfloor\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e8e\u662f\u8f7b\u6613\u5730\u6c42\u51fa\u8fd9\u6761\u8fb9\u7684\u8d21\u732e\u4e3a:\n$$\nw(n+1)-\\frac{1}2\\sum_{i=0}^ni(i+1)\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5bf9\u4e8e\u540e\u4e00\u9879, \u53ef\u4ee5\u88c2\u9879\u5c55\u5f00, \u5316\u4e3a:\n$$\nw(n+1)-\\frac{n(n+1)(n+2)}6\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$O(1)$\u8ba1\u7b97\u5b8c\u6210.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6b64\u540e, \u6211\u4eec\u5728\u5efa\u65b0\u56fe\u65f6, \u8003\u8651\u5982\u679c\u4e00\u6761\u8fb9\u8fde\u63a5\u4e24\u4e2a$SCC$, \u5c31\u628a\u5176\u52a0\u5165\u65b0\u56fe, \u5426\u5219\u52a0\u5165\u8fd9\u4e2a$SCC$\u7684\u6743. \u7136\u540e\u8dd1\u4e00\u8fb9\u6700\u957f\u94fe\u5373\u53ef.\n## $Part_3$ \u4ee3\u7801\n```cpp\n#include <cmath>\n#include <stack>\n#include <cstdio>\n\n#define Int register int\n\nusing namespace std;\n\ntypedef long long int LL;\n\nconst int MAXN = 1e6, MAXM = 1e6;\nint n, m, s, Cnte, CprC, Head[MAXN + 5] = {}, CprH[MAXN + 5] = {};\nint Indx, Cnts, DFN[MAXN + 5] = {}, Low[MAXN + 5] = {}, SCC[MAXN + 5] = {};\nLL Val[MAXN + 5] = {}, F[MAXN + 5] = {};\nbool Instk[MAXN + 5] = {};\nstack<int> S;\n\nstruct Edge { int To, Cost, _nxt; } Graph[MAXM + 5] = {}, CprG[MAXM + 5] = {};\n\ntemplate<typename _T>\ninline _T Min ( const _T a, const _T b ) { return a < b ? a : b; }\n\ntemplate<typename _T>\ninline _T Max ( const _T a, const _T b ) { return a > b ? a : b; }\n\ninline void Link ( const int From, const int To, const int Cost ) {\n\tGraph[++ Cnte] = { To, Cost, Head[From] };\n\tHead[From] = Cnte;\n}\n\ninline void CprLink ( const int From, const int To, const int Cost ) {\n\tCprG[++ CprC] = { To, Cost, CprH[From] };\n\tCprH[From] = CprC;\n}\n\ninline LL Calc ( const int w ) {\n\tLL n = sqrt ( 2.0 * w + 0.25 ) - 0.5;\n\treturn w * ( n + 1 ) - n * ( n + 1 ) / 2 * ( n + 2 ) / 3;\n}\n\ninline void Tarjan ( const int u ) {\n\tint v;\n\tDFN[u] = Low[u] = ++ Indx, Instk[u] = true, S.push ( u );\n\tfor ( Int i = Head[u], v; i; i = Graph[i]._nxt ) {\n\t\tif ( ! DFN[v = Graph[i].To] ) {\n\t\t\tTarjan ( v ), Low[u] = Min ( Low[u], Low[v] );\n\t\t} else if ( Instk[v] ) {\n\t\t\tLow[u] = Min ( Low[u], DFN[v] );\n\t\t}\n\t}\n\tif ( DFN[u] == Low[u] ) {\n\t\t++ Cnts;\n\t\tdo {\n\t\t\tInstk[v = S.top ()] = false, S.pop ();\n\t\t\tSCC[v] = Cnts;\n\t\t} while ( u ^ v );\n\t}\n}\n\ninline void MakeGraph () {\n\tfor ( Int i = 1; i <= n; ++ i ) {\n\t\tif ( ! DFN[i] ) continue;\n\t\tint u = SCC[i], v;\n\t\tfor ( Int j = Head[i]; j; j = Graph[j]._nxt ) {\n\t\t\tif ( u ^ ( v = SCC[Graph[j].To] ) ) {\n\t\t\t\tCprLink ( u, v, Graph[j].Cost );\n\t\t\t} else {\n\t\t\t\tVal[u] += Calc ( Graph[j].Cost );\n\t\t\t}\n\t\t}\n\t}\n}\n\ninline void DFS ( const int u ) {\n\tif ( F[u] ) return ;\n\tfor ( Int i = CprH[u], v; i; i = CprG[i]._nxt ) {\n\t\tDFS ( v = CprG[i].To ), F[u] = Max ( F[u], F[v] + CprG[i].Cost );\n\t}\n\tF[u] += Val[u];\n}\n\ninline void Work () {\n\tscanf ( \"%d %d\", &n, &m );\n\tfor ( Int i = 1, u, v, w; i <= m; ++ i ) {\n\t\tscanf ( \"%d %d %d\", &u, &v, &w );\n\t\tLink ( u, v, w );\n\t}\n\tscanf ( \"%d\", &s );\n\tTarjan ( s );\n\tMakeGraph ();\n\tDFS ( SCC[s] );\n\tprintf ( \"%lld\\n\", F[SCC[s]] );\n}\n\nint main () {\n\tWork ();\n\treturn 0;\n}\n```",
        "postTime": 1572328539,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    },
    {
        "content": "\u9898\u76ee\u94fe\u63a5:[https://www.luogu.org/problem/CF894E](https://www.luogu.org/problem/CF894E)\n\n\u9898\u76ee\u5927\u610f\nRalph\u6253\u7b97\u53bb\u8611\u83c7\u68ee\u6797\u91c7\u8611\u83c7\u3002\n\n\u8611\u83c7\u68ee\u6797\u91cc\u6709n\u4e2a\u8611\u83c7\u4e1b\uff0c\u6709m\u6761\u6709\u5411\u7684\u8def\u8fde\u63a5\u8fd9\u4e9b\u4e1b\u6797\uff08\u53ef\u80fd\u8fde\u5411\u81ea\u5df1\uff0c\u4e5f\u53ef\u80fd\u4e24\u4e2a\u4e1b\u6797\u4e4b\u95f4\u6709\u591a\u6761\u8def\uff09\u3002\u7ecf\u8fc7\u67d0\u6761\u8def\u65f6\uff0cRalph\u53ef\u4ee5\u91c7\u8d70\u8fd9\u6761\u8def\u4e0a\u7684\u5168\u90e8\u8611\u83c7\u3002\u7136\u800c\uff0c\u8fd9\u662f\u4e00\u7247\u795e\u5947\u7684\u8611\u83c7\u68ee\u6797\uff0c\u8611\u83c7\u88ab\u91c7\u8d70\u540e\u4f1a\u91cd\u65b0\u957f\u51fa\u6765\u4e00\u4e9b\u3002\u4f46\u662f\uff0c\u7b2ck\u6b21\u8d70\u8fc7\u8fd9\u6761\u8def\u540e\uff0c\u8fd9\u6761\u8def\u4e0a\u91cd\u65b0\u957f\u51fa\u7684\u8611\u83c7\u4f1a\u6bd4\u4e0a\u6b21\u5c11k\u3002\uff08\u4e3e\u4e2a\u6817\u5b50\uff0c\u7b2c\u4e00\u6b21\u6709w\u4e2a\u8611\u83c7\uff0c\u7b2c\u4e8c\u6b21\u6709w-1\u4e2a\u8611\u83c7\uff0c\u7b2c\u4e09\u6b21\u6709w-1-2\u4e2a\u8611\u83c7\uff0c\u4ee5\u6b64\u7c7b\u63a8\u2026\u2026\uff09\uff08\u8fd8\u6709\uff0c\u8611\u83c7\u7684\u6570\u91cf\u5927\u4e8e0\uff09\u3002\n\n\u90a3\u4e48\uff0cRalph\u6700\u591a\u53ef\u4ee5\u91c7\u5230\u591a\u5c11\u8611\u83c7\u5462\uff1f\n\n\u8f93\u5165\u8f93\u51fa\u6837\u4f8b\n\n\u8f93\u5165 #1\n\n2 2\n1 2 4\n2 1 4\n1\n\n\u8f93\u51fa #1\n\n16\n\n\u8f93\u5165 #2\n\n3 3\n1 2 4\n2 3 3\n1 3 8\n1\n\n\u8f93\u51fa #2\n\n8\n\n\u8fd9\u4e2a\u9898\u76ee\u5e94\u8be5\u4e0d\u96be\u60f3\u5230,\u4e00\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u5185\u7684\u6240\u6709\u8611\u83c7\u90fd\u53ef\u4ee5\u91c7\u5149(\u91cd\u590d\u8d70,\u4e00\u76f4\u7ed5\u5708\u628a\u8def\u4e0a\u7684\u6240\u6709\u8611\u83c7\u91c7\u6389)\n\n\u90a3\u4e48\u4e00\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u5185\u7684\u6240\u6709\u8611\u83c7\u6570\u91cf\u662f\u591a\u5c11\u5462?\n\n${n(n+1)<=w}$ \u7684\u6700\u5927\u7684 ${n}$ \uff0c\u89e3\u4e8c\u6b21\u4e0d\u7b49\u5f0f,$n$ \u5c31\u662f $1.0*\\sqrt{0.25+2a}-0.5$\n\n\u7136\u540e\u4ef7\u503c\u5c31\u662f$nw-\\sum^{n}_{i=1}i(i+1)/2+w$\uff0c\u4e5f\u5c31\u662f $nw-n(n+1)(n+2)/6+w$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u7528Tarjan\u7f29\u70b9\u6c42\u51fa\u5f3a\u8fde\u901a\u5206\u91cf,\u628a\u8fb9\u6743\u5408\u5e76\u5230\u70b9\u4e0a,\u91cd\u65b0\u5efa\u56fe,\u518d\u6765\u641c\u7d22\u4e00\u4e0b\u5c31OK\u4e86;\n\n\u90a3\u4e48\u6ce8\u610f\u51e0\u4e2a\u5730\u65b9:1.\u8981\u5f00long long;\n\n2.\u70b9\u6743\u4e0e\u8fb9\u6743\u6df7\u5408\u52a0\u65f6\u4e0d\u8981\u6f0f\u52a0\u4e86\u7ec8\u70b9\u7684\u70b9\u6743;\n\n3.\u4ee3\u7801\u53ef\u80fd\u6709\u70b9\u96be\u8c03,\u8010\u5fc3\u4e00\u70b9,\u4e00\u5b9a\u53ef\u4ee5\u8c03\u51fa\u6765\u7684(\u796d\u672c\u9898\u63d0\u4ea49\u6b21);\n\n\u9644\u4e0a\u53cc\u500d\u7ecf\u9a8c:[P2656 \u91c7\u8611\u83c7](https://www.luogu.org/problem/P2656),\u7a0d\u5fae\u4fee\u6539\u4e00\u4e0b\u5c31\u80fd\u8fc7\u4e86!\n\n```cpp\n#include <bits/stdc++.h>\n#define N (2000000+5)\n#define int long long\nusing namespace std;\nint n,m,s;\nint top,sum,deep;\nint dfn[N],low[N],color[N],vis[N],st[N];\nint cnt[N],in[N],wp[N],f[N];\nint u[N],v[N],wei[N];\nvector <int> edge[N],w[N];\nvoid Tarjan(int u)\n{\n\tvis[u]=1;\n\tdfn[u]=low[u]=++deep;\n\tst[++top]=u;\n\tfor(int i=0;i<edge[u].size();i++)\n\t{\n\t\tint now=edge[u][i];\n\t\tif(!dfn[now])\n\t\t{\n\t\t\tTarjan(now);\n\t\t\tlow[u]=min(low[u],low[now]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(vis[now]) low[u]=min(low[u],low[now]);\n\t\t}\n\t}\n\tif(dfn[u]==low[u])\n\t{\n\t\tcolor[u]=++sum;\n\t\tvis[u]=0;\n\t\twhile(st[top]!=u)\n\t\t{\n\t\t\tcolor[st[top]]=sum;\n\t\t\tvis[st[top--]]=0;\n\t\t}\n\t\ttop--;\n\t}\n}\nint dfs(int u)\n{\n    if(vis[u]) return f[u];\n    int res=0;\n\tvis[u]=1;\n    for (int i=0;i<edge[u].size();i++)\n\t{\n        int now=edge[u][i];\n        res=max(res,dfs(now)+w[u][i]);\n    }\n    return f[u]=res+wp[u];\n}\nint cont(int a)\n{\n\tint k=1.0*sqrt(0.25+2*a)-0.5;\n\treturn a*k-k*(k+1)*(k+2)/6+a;\n}\nsigned main()\n{\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%lld%lld%lld\",&u[i],&v[i],&wei[i]);\n\t\tedge[u[i]].push_back(v[i]);\n\t}\n\tfor(int i=1;i<=n;i++) if(!dfn[i]) Tarjan(i);\n\tfor(int i=1;i<=n;i++) vector<int>().swap(edge[i]);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tif(color[u[i]]==color[v[i]])\n\t\t{\n\t\t\twp[color[u[i]]]+=cont(wei[i]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//printf(\"u=%lld v=%lld\\n\",color[u[i]],color[v[i]]);\n\t\t\tedge[color[u[i]]].push_back(color[v[i]]);\n\t\t\tw[color[u[i]]].push_back(wei[i]);\n\t\t\tin[color[v[i]]]++;\n\t\t}\n\t}\n\tscanf(\"%lld\",&s);\n\tmemset(vis,0,sizeof(vis));\n\tprintf(\"%lld\\n\",dfs(color[s]));\n\treturn 0;\n```",
        "postTime": 1571620022,
        "uid": 218449,
        "name": "Xx_queue",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 CF894E \u3010Ralph and Mushrooms\u3011"
    }
]