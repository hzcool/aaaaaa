[
    {
        "content": "[\u535a\u5ba2\u6b22\u8fce\u6765\u8e29QAQ](https://www.cnblogs.com/blog-Dr-J/p/10389476.html)\n\n## \u89e3\u9898\u601d\u8def\uff1a\n\n\u8981\u6c42\u4e00\u6761\u76f4\u7ebf\u5206\u5272\u77e9\u9635\u65f6\u5de6\u53f3\u989c\u8272\u6570\u4e00\u6837\uff0c\u90a3\u4e48\u5c31\u8bf4\u660e\u4e00\u4e2a\u95ee\u9898\uff1a\n\u76f4\u7ebf\u5de6\u53f3\u79fb\u52a8\u65f6\u662f\u4e0d\u4f1a\u6539\u53d8\u5de6\u53f3\u77e9\u9635\u7684\u989c\u8272\u96c6\u5408\u7684\u3002\n\n\u6240\u4ee5\u8bf4\u660e\uff1a2~m-1\u5217\u7684\u989c\u8272\u96c6\u4e00\u5b9a\u5c5e\u4e8e\u7b2c\u4e00\u5217\u4e0e\u7b2cm\u5217\u989c\u8272\u96c6\u7684\u4ea4\u96c6\uff0c\u800c\u4e14\u7b2c\u4e00\u5217\u4e0e\u7b2cm\u5217\u989c\u8272\u96c6\u5927\u5c0f\u76f8\u7b49\u3002\n\n\u663e\u7136\u9700\u8981\u9884\u5904\u7406\u524dn\u4e2a\u70b9\u524dm\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\uff0c\u8bbe\u4e3a$g(i,j)$\n\n\u8fd9\u6837\uff0c\u53ea\u9700\u8981\u786e\u5b9a\u7b2c\u4e00\u5217\u548c\u6700\u540e\u4e00\u5217\u989c\u8272\u96c6\uff0c\u5047\u8bbe\u4ea4\u96c6\u662f$i$\u79cd\u989c\u8272\uff0c\u5c31\u53ef\u4ee5\u7b97\u51fa\u4e2d\u95f4\u7684\u989c\u8272\u65b9\u6848\u6570\uff1a$i^{n*(m-2)}$\n\n\u5047\u8bbe\u4e24\u8fb9\u989c\u8272\u4e2a\u6570\u90fd\u662f$j$\uff08$j\\ge i$\uff09\u90a3\u4e48\u4e24\u8fb9\u989c\u8272\u7684\u7b54\u6848\u4e3a$(g(n,j)j!)^2$\n\n\u8fd9$i$\u79cd\u989c\u8272\u5171\u6709$C_k^i$\u79cd\u9009\u6cd5\uff0c\u4e24\u8fb9\u5404$j$\u79cd\u989c\u8272\uff0c\u4e14\u53ea\u6709$i$\u79cd\u989c\u8272\u76f8\u540c\u7684\u65b9\u6848\u5c31\u662f\uff1a\n\n$\\Large C_k^iC_{k-i}^{2(j-i)}C_{2(j-i)}^{j-i}$\n\n\u90a3\u4e48\u6700\u540e\u7b54\u6848\u5c31\u662f\n\n$\\Large\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=i}^{n}C_k^iC_{k-i}^{2(j-i)}C_{2(j-i)}^{j-i}{(g(n,j)j!)^2}{i^{n(m-2)}}$\n\n\u4ee3\u7801\uff1a\n\n```c++\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\ntypedef long long lnt;\nconst lnt mod=1000000007;\nlnt g[1010][1010];\nlnt fac[1000010];\nlnt inv[1000010];\nint n,m,k;\nlnt ans;\nlnt ksm(lnt a,lnt b)\n{\n    lnt ans=1;\n    while(b)\n    {\n        if(b&1)ans=ans*a%mod;\n        a=a*a%mod;\n        b=b/2;\n    }\n    return ans;\n}\nlnt C(int x,int y)\n{\n    if(y>x)return 0;\n    return fac[x]*inv[y]%mod*inv[x-y]%mod; \n}\nlnt squ(lnt x)\n{\n    return x*x%mod;\n}\nint main()\n{\n    g[0][0]=1;\n    fac[0]=inv[0]=fac[1]=inv[1]=1;\n    for(int i=2;i<=1000000;i++)\n    {\n        fac[i]=(fac[i-1]*i)%mod;\n        inv[i]=(mod-mod/i)*inv[mod%i]%mod;\n    }\n    for(int i=1;i<=1000000;i++)inv[i]=inv[i]*inv[i-1]%mod;\n    scanf(\"%d%d%d\",&n,&m,&k);\n    if(m==1)\n    {\n        printf(\"%I64d\\n\",ksm(k,n));\n        return 0;\n    }\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=1;j<=i&&j<=k;j++)\n        {\n            g[i][j]=(g[i-1][j-1]+g[i-1][j]*j)%mod;\n        }\n    }\n    for(int i=0;i<=n;i++)\n    {\n        lnt tmp=ksm(i,n*(m-2))*C(k,i)%mod;\n        for(int j=i;j<=n;j++)\n        {\n            ans=(ans+tmp*C(k-i,(j-i)*2)%mod*C((j-i)*2,j-i)%mod*squ(g[n][j]*fac[j]%mod)%mod)%mod;\n        }\n    }\n    printf(\"%I64d\\n\",(ans%mod+mod)%mod);\n    return 0;\n}\n```",
        "postTime": 1550326229,
        "uid": 66914,
        "name": "Unstoppable728",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF111D \u3010Petya and Coloring\u3011"
    },
    {
        "content": "# CF111D \u9898\u89e3\n\n[$\\text{Link}$](http://codeforces.com/problemset/problem/111/D)\n\n## \u601d\u8def\u5206\u6790\n\n\u72ec\u7acb\u5207\u7684\u7b2c\u4e00\u9053 CF2300 \u7684\u9898\uff0c\u597d\u8036\n\n\u8bbe $\\mathbf S_i$ \u8868\u793a\u7b2c $i$ \u5217\u4f7f\u7528\u7684\u989c\u8272\u96c6\u5408\uff0c$\\mathbf L_i$ \u8868\u793a\u7b2c $1$ \u5217\u5230\u7b2c $i$ \u5217\u7528\u7684\u989c\u8272\u96c6\u5408\uff0c$\\mathbf R_i$ \u8868\u793a\u7b2c $i$ \u5217\u5230\u7b2c $n$ \u5217\u7528\u7684\u989c\u8272\u96c6\u5408\n\n\u8003\u8651\u4ece $\\mathbf L_i$ \u8f6c\u79fb\u5230 $\\mathbf L_{i+1}$ \u7684\u8fc7\u7a0b\uff0c\u7531\u5b9a\u4e49\u6211\u4eec\u77e5\u9053 $\\mathbf L_{i+1}=\\mathbf L_{i}\\cup\\mathbf S_{i+1}$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $\\mathbf L_i\\subseteq \\mathbf L_{i+1}$\uff0c\u56e0\u6b64\u5f97\u5230 $|\\mathbf L_i|\\le |\\mathbf L_{i+1}|$\uff0c\u56e0\u6b64\uff0c$|\\mathbf L_{1}|\\sim|\\mathbf L_m|$ \u5355\u8c03\u4e0d\u964d\n\n\u540c\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $|\\mathbf R_1|\\sim|\\mathbf R_m|$ \u5355\u8c03\u4e0d\u5347\n\n\u4f46\u662f\uff0c\u6211\u4eec\u6709 $|\\mathbf L_1|=|\\mathbf R_2|,|\\mathbf L_2|=|\\mathbf R_3|,\\cdots,|\\mathbf L_{m-1}|=|\\mathbf R_m|$\n\n\u6240\u4ee5 $|\\mathbf R_2|=|\\mathbf L_1|\\leq |\\mathbf L_2|=|\\mathbf R_{3}|$\uff0c\u53c8 $|\\mathbf R_3|\\le|\\mathbf R_2|$\uff0c\u6240\u4ee5\u5f97\u5230 $|\\mathbf R_2|=|\\mathbf R_3|$\n\n\u7c7b\u63a8\u53ef\u77e5\uff0c$|\\mathbf L_1|=|\\mathbf L_2|=\\cdots=|\\mathbf L_{m-1}|=|\\mathbf R_2|=|\\mathbf R_3|=\\cdots=|\\mathbf R_m|$\n\n\n\n\u8003\u8651 $\\mathbf S_1$ \u548c $\\mathbf S_2$ \u7684\u5173\u7cfb\uff0c\u7531\u5b9a\u4e49\u53ef\u5f97 $\\mathbf S_1=\\mathbf L_1,\\mathbf S_1\\cup\\mathbf S_2=\\mathbf L_2$\uff0c\u6240\u4ee5\u6709 $\\mathbf L_1\\subseteq\\mathbf L_{2}$\uff0c\u53c8\u56e0\u4e3a $|\\mathbf L_1|=|\\mathbf L_2|$\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u5230\uff1a$\\mathbf L_1=\\mathbf L_2$\n\n\u6240\u4ee5\u6709 $\\mathbf S_1=\\mathbf S_1\\cup\\mathbf S_2$ \u56e0\u6b64 $\\mathbf S_2\\subseteq \\mathbf S_1$\n\n\u540c\u7406\u7ee7\u7eed\u5206\u6790\uff0c\u8003\u8651 $\\mathbf L_2$ \u548c $\\mathbf L_3$ \u7684\u5173\u7cfb\uff0c\u6ce8\u610f\u5230 $\\mathbf L_2=\\mathbf L_1=\\mathbf S_1$\uff0c\u6240\u4ee5\u7c7b\u4f3c\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u4e5f\u80fd\u5f97\u5230 $\\mathbf S_3\\subseteq\\mathbf S_1$\n\n\u7c7b\u63a8\u5230 $\\mathbf S_4\\sim\\mathbf S_{m-1}$\uff0c\u90fd\u6709\u8fd9\u4e2a\u6027\u8d28\uff0c\u6700\u7ec8\u6211\u4eec\u5f97\u5230 $\\mathbf S_2\\sim\\mathbf S_{m-1}\\subseteq \\mathbf S_1$\n\n\u7136\u540e\u518d\u770b $\\mathbf R _m$ \u548c $\\mathbf R_{m-1}$ \u7684\u5173\u7cfb\uff0c\u89c2\u5bdf\u5230 $\\mathbf R_m=\\mathbf S_m$\uff0c\u7136\u540e\u7528\u4e0a\u9762\u7c7b\u4f3c\u7684\u65b9\u6cd5\u540c\u7406\u53ef\u5f97\uff1a$\\mathbf S_{2}\\sim\\mathbf S_{m-1}\\subseteq \\mathbf S_{m}$\n\n\u8054\u7acb\u4e0a\u4e0b\uff0c\u53ef\u77e5 $\\mathbf S_2\\sim\\mathbf S_{m-1}\\subseteq \\mathbf S_1\\cap\\mathbf S_m$\n\n\u53c8\u56e0\u4e3a $|\\mathbf L_1|=|\\mathbf R_m|$ \u4e14 $\\mathbf L_1=\\mathbf S_1,\\mathbf R_m=\\mathbf S_m$\uff0c\u6240\u4ee5\u6709 $|\\mathbf S_1|=|\\mathbf S_m|$\n\n\n\n\u6b64\u65f6\u6574\u7406\u4e00\u4e0b\u6211\u4eec\u7684\u5f97\u5230\u7684\u6761\u4ef6\uff1a\n\n1. $|\\mathbf S_1|=|\\mathbf S_m|$\n2. $\\forall i\\in(1,m),\\mathbf S_i\\in \\mathbf S_1\\cap\\mathbf S_m$\n\n \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u8fdb\u884c\u8ba1\u6570\uff0c\u9996\u5148\u679a\u4e3e $|\\mathbf S_1|,|\\mathbf S_m|$\uff0c\u8bbe\u4e3a $p$\uff0c\u7136\u540e\u679a\u4e3e $|\\mathbf S_1\\cap\\mathbf S_m|$\uff0c\u8bbe\u4e3a $i$\uff0c\u7136\u540e\u8003\u8651\u5206\u6b65\u8ba1\u6570\uff1a\n\n1. \u786e\u5b9a $\\mathbf S_1,\\mathbf S_m$\uff0c\u9996\u5148\u6c42\u51fa $\\mathbf S_1\\cap\\mathbf S_m$\uff0c\u5171\u6709 $\\dbinom ki$ \u79cd\u60c5\u51b5\uff0c\u7136\u540e\u6c42\u51fa $\\mathbf S_1$ \u7684\u5269\u4e0b\u90e8\u5206\uff0c\u5171\u6709 $\\dbinom{k-i}{p-i}$ \u79cd\u60c5\u51b5\uff0c\u6700\u540e\u6c42\u51fa $\\mathbf S_m$ \u7684\u5269\u4e0b\u90e8\u5206\uff0c\u5171\u6709 $\\dbinom {k-p}{p-i}$ \u79cd\u60c5\u51b5\uff0c\u603b\u6570\u5373\u4e09\u6b65\u60c5\u51b5\u6570\u76f8\u4e58\uff0c\u5171\u6709 $\\dbinom ki\\dbinom{k-i}{p-i}\\dbinom{k-p}{p-i}$ \u79cd\n\n2. \u6c42\u51fa\u4e2d\u95f4 $m-2$ \u5217\u7684**\u5177\u4f53**\u6d82\u8272\u60c5\u51b5\uff0c\u6bcf\u4e2a\u683c\u5b50\u90fd\u6709 $i$ \u79cd\u6d82\u8272\u65b9\u5f0f\uff0c\u6ca1\u6709\u5176\u5b83\u7684\u9650\u5236\uff0c\u6545\u60c5\u51b5\u6570\u4e3a $i^{n(m-2)}$\n\n3. \u6c42\u51fa\u7b2c $1$ \u5217\u548c\u7b2c $m$ \u5217\u7684\u67d3\u8272\u60c5\u51b5\uff0c\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e24\u5217\u7684\u67d3\u8272\u60c5\u51b5\u6570\u662f\u76f8\u540c\u7684\uff0c\u4e14\u53ea\u4e0e $p$ \u6709\u5173\uff0c\u5373**\u6070\u597d**\u4f7f\u7528 $p$ \u79cd\u989c\u8272\u67d3 $n$ \u4e2a\u683c\u5b50\u7684\u65b9\u6848\u6570\uff0c\u4e0d\u59a8\u8bb0\u4e3a $f_n(p)$\uff0c\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5bb9\u65a5\u539f\u7406\u8ba1\u7b97 $f_n(p)$ \u7684\u503c\uff0c\u8003\u8651\u679a\u4e3e\u5f3a\u5236\u8ba9 $x$ \u4e2a\u683c\u5b50\u4e0d\u9009\uff0c\u5176\u4f59\u5217\u65e0\u9650\u5236\u7684\u65b9\u6848\u6570\uff0c\u663e\u7136\u5c31\u662f $(n-x)^p$ \u79cd\uff0c\u7136\u540e\u505a\u4e00\u6b21\u7b80\u5355\u5bb9\u65a5\u53ef\u5f97\uff1a\n\n$$\nf_n(p)=\\sum_{x=0}^n (-1)^x\\dbinom p x(n-x)^p\n$$\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u5f97\u5230\uff1a\n$$\n\\text{Answer}=\\sum_{p=1}^{\\min(k,n)}\\left[\\sum_{x=0}^n (-1)^x\\dbinom px(n-x)^p\\right]^2\\left[\\sum_{i=0}^p \\dbinom ki\\dbinom{k-i}{p-i}\\dbinom{k-p}{p-i}i^{n(m-2)}\\right]\n$$\n\u76f4\u63a5\u8ba1\u7b97\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n^2)$\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int MAXN=1e6+1,MOD=1e9+7;\nint inv[MAXN],fac[MAXN];\ninline int ksm(int a,int b=MOD-2,int m=MOD) {\n\tint res=1;\n\twhile(b) {\n\t\tif(b&1) res=res*a%m;\n\t\ta=a*a%m;\n\t\tb=b>>1;\n\t}\n\treturn res;\n}\ninline void init() {\n\tfac[0]=inv[0]=1;\n\tfor(int i=1;i<MAXN;++i) fac[i]=fac[i-1]*i%MOD;\n\tinv[MAXN-1]=ksm(fac[MAXN-1]);\n\tfor(int i=MAXN-2;i>0;--i) inv[i]=inv[i+1]*(i+1)%MOD;\n}\ninline int C(int m,int n) {\n\tif(n<0||n>m) return 0;\n\treturn fac[m]*inv[n]%MOD*inv[m-n]%MOD;\n}\nsigned main() {\n\tinit();\n\tint n,m,k,res=0;\n\tscanf(\"%lld%lld%lld\",&n,&m,&k);\n\tif(m==1) {\n\t\tprintf(\"%lld\\n\",ksm(k,n));\n\t\treturn 0;\n\t}\n\tfor(int p=1;p<=k&&p<=n;++p) {\n\t\tint f=0;\n\t\tfor(int i=0,op=1;i<=p;++i,op*=-1) {\n\t\t\tf+=op*C(p,i)*ksm(p-i,n)%MOD;\n\t\t\tf=(f%MOD+MOD)%MOD;\n\t\t}\n\t\tfor(int i=0;i<=p;++i) {\n\t\t\tint t=f*f%MOD;\n\t\t\tt=t*C(k,i)%MOD;\n\t\t\tt=t*C(k-i,p-i)%MOD;\n\t\t\tt=t*C(k-p,p-i)%MOD;\n\t\t\tt=t*ksm(i,n*(m-2))%MOD;\n\t\t\tres=(res+t)%MOD;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",res);\n\treturn 0;\n}\n```",
        "postTime": 1659843366,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "CF111D \u9898\u89e3"
    },
    {
        "content": "\u5f88\u660e\u663e\u8fd9\u662f\u4e00\u9053\u7ec4\u5408\u9898\u3002\n\n\u9996\u5148\u7279\u5224\u4e00\u4e0b\uff0c\u5f53 $m=1$ \u65f6\uff0c\u7b54\u6848\u5c31\u662f $k^n$\u3002\n\n\u5bf9\u4e8e $m>1$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4e00\u4e2a\u7ed3\u8bba\uff1a\n\n\u5bf9\u4e8e\u6cbf\u683c\u5b50\u7684\u7ebf\u7a7f\u8fc7\u7684\u4efb\u4f55\u5782\u76f4\u7ebf\uff0c\u4f1a\u5c06\u68cb\u76d8\u5206\u6210\u4e24\u4e2a\u975e\u7a7a\u7684\u90e8\u5206\uff0c\u8fd9\u4e24\u4e2a\u90e8\u5206\u4e2d\u7684\u4e0d\u540c\u989c\u8272\u7684\u6570\u91cf\u76f8\u540c**\u4e14\u603b\u662f\u4e0d\u53d8**\u3002\u8bbe\u8fd9\u4e2a\u4e0d\u540c\u989c\u8272\u7684\u6570\u91cf\u4e3a $i$\uff0c\u90a3\u4e48\u5de6\u8fb9\u8fd9\u90e8\u5206\u7684\u989c\u8272\u4e00\u5b9a\u662f\u56fa\u5b9a\u7684 $i$ \u79cd\u989c\u8272\uff0c\u53f3\u8fb9\u90a3\u90e8\u5206\u4e5f\u4e00\u5b9a\u662f\u56fa\u5b9a\u7684 $i$ \u79cd\u989c\u8272\u3002\n\n\u7531\u4e8e\u5206\u5f00\u524d\u4e24\u5217\u7684\u5782\u7ebf\u7684\u5de6\u8fb9\u90e8\u5206\u53ea\u6709\u7b2c\u4e00\u5217\u7684\u683c\u5b50\uff0c\u6240\u4ee5\u5de6\u8fb9\u7684 $i$ \u79cd\u989c\u8272\u4e2d\u7684\u6bcf\u4e00\u79cd\u90fd\u4e00\u5b9a\u81f3\u5c11\u4f1a\u5728\u7b2c\u4e00\u5217\u4e2d\u51fa\u73b0\u4e00\u6b21\uff0c\u6700\u540e\u4e00\u5217\u540c\u7406\u3002\n\n\u6211\u4eec\u8bbe\u5de6\u8fb9\u7684\u989c\u8272\u4e3a\u96c6\u5408 $S1$\uff0c\u53f3\u8fb9\u7684\u989c\u8272\u4e3a\u96c6\u5408 $S2$\uff0c$|S1|=|S2|=i$\uff0c\u90a3\u4e48\u4e2d\u95f4\u7684 $m-2$ \u5217\u80fd\u67d3\u7684\u989c\u8272\u7684\u79cd\u6570\u4e3a $|S1\\cap S2|$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u679a\u4e3e $i$\uff0c\u518d\u679a\u4e3e $|S1\\cap S2|$ \uff08\u8bbe\u5176\u4e3a $j$\uff09\uff0c\u90a3\u4e48 $S1$ \u548c $S2$ \u5c31\u603b\u5171\u6709 ${k \\choose j}{k-j \\choose i-j}{k-i \\choose i-j}$ \u79cd\u53d6\u6cd5\uff0c\u7ed9\u4e2d\u95f4 $m-2$ \u5217\u67d3\u8272\u7684\u65b9\u6848\u6570\u4e3a $j^{(m-2)n}$\uff0c\u7ed9\u524d\u540e\u4e24\u5217\u67d3\u8272\u7684\u65b9\u6848\u6570\u53ef\u4ee5\u7528\u5bb9\u65a5\u5f97\u51fa\u3002\n\n\u6211\u4eec\u8bbe $f(m)$ \u8868\u793a\u7ed9 $n$ \u4e2a\u683c\u5b50\u67d3 $m$ \u79cd\u989c\u8272\u6bcf\u4e00\u79cd\u989c\u8272\u90fd\u81f3\u5c11\u51fa\u73b0\u4e00\u6b21\u7684\u65b9\u6848\u6570\uff0c\u6211\u4eec\u7528\u5bb9\u65a5\u5f97\u51fa $f(m)$\uff1a\n\n$$f(m)=\\sum_{i=0}^{m} (-1)^i\\times {m\\choose i}(m-i)^n$$\n\n\u6574\u7406\u5f97\u5230\u6700\u7ec8\u7684\u7b54\u6848\uff1a\n\n$$\\sum_{i=1}^{min(k,n)} f(i)^2\\times \\sum_{j=0}^{i} {k \\choose j}{k-j \\choose i-j}{k-i \\choose i-j}\\times j^{(m-2)n}$$\n\n\u8fd9\u4e2a\u503c\u53ef\u4ee5\u5728 $O(n^2(\\log n+\\log m))$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5f97\u5230\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define mxn 1000003\n#define md 1000000007\n#define rep(i,a,b) for(int i=a;i<=b;++i)\nusing namespace std;\nint n,m,k,xi,inv[mxn],fac[mxn],ifac[mxn];\nll ans;\ninline ll C(int n,int m){\n\tif(m>n)return 0;\n\treturn (ll)fac[n]*ifac[n-m]%md*ifac[m]%md;\n}\ninline ll power(ll x,int y){\n\tll ans=1;\n\tfor(;y;y>>=1){\n\t\tif(y&1)ans=ans*x%md;\n\t\tx=x*x%md;\n\t}\n\treturn ans;\n}\ninline ll p2(ll x){\n\treturn x*x%md;\n}\nll color(int n,int m){\n\tll ans=0;\n\txi=1;\n\trep(i,0,m){\n\t\tans=(ans+C(m,i)*power(m-i,n)%md*xi)%md;\n\t\txi*=-1;\n\t}\n\treturn ans;\n}\nsigned main(){\n\tcin>>n>>m>>k;\n\tif(m==1){\n\t\tcout<<power(k,n);\n\t\treturn 0;\n\t}\n\tinv[1]=fac[1]=ifac[1]=1;\n\tfac[0]=ifac[0]=1;\n\trep(i,2,1000000){\n\t\tinv[i]=(ll)inv[md%i]*(md-md/i)%md;\n\t\tfac[i]=(ll)fac[i-1]*i%md;\n\t\tifac[i]=(ll)ifac[i-1]*inv[i]%md;\n\t}\n\trep(i,1,min(n,k)){\n\t\txi=p2(color(n,i));\n\t\trep(j,0,i)ans=(ans+C(k,j)*C(k-j,i-j)%md*C(k-i,i-j)%md*xi%md*power(j,(m-2)*n))%md;\n\t}\n\tcout<<(ans+md)%md;\n\treturn 0;\n}\n```",
        "postTime": 1659702584,
        "uid": 329857,
        "name": "zifanwang",
        "ccfLevel": 7,
        "title": "CF111D Petya and Coloring \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.com.cn/problem/CF111D)\n\n\u6709\u4e00\u4e2a\u5f88\u660e\u663e\u7684\u6027\u8d28\uff1a\n\n\u5047\u8bbe\u5de6\u8fb9$a$\u5217\u548c\u53f3\u8fb9\u7684$m-a$\u5217\u989c\u8272\u79cd\u7c7b\u662f\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u5f53$a$\u5f80\u53f3\u79fb\u52a8\u4e00\u4f4d\u65f6\uff1a\u5de6\u8fb9\u7684\u989c\u8272\u96c6\u5408\u4e0d\u4f1a\u51cf\uff0c\u53f3\u8fb9\u7684\u989c\u8272\u96c6\u5408\u4e0d\u4f1a\u52a0\n\n\u5982\u679c\u5de6\u534a\u90e8\u5206\u7684\u989c\u8272\u96c6\u5408\u6709\u589e\u52a0\uff0c\u90a3\u4e48\u8bf4\u660e$a+1$\u4e2d\u5b58\u5728\u524d$a$\u5217\u90fd\u6ca1\u6709\u7684\u989c\u8272\uff0c\u90a3\u4e48\u663e\u7136\u4e0d\u7b26\u5408\u4e00\u5f00\u59cb\u7684\u5047\u8bbe\u3002\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\uff0c\u8fd9\u4e2a\u8fb9\u754c\u7ebf\u6bcf\u6b21\u5f80\u53f3\u79fb\u52a8\u65f6\uff0c\u5de6\u8fb9\u548c\u53f3\u8fb9\u7684\u989c\u8272\u96c6\u5408\u90fd\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\n\n\u6362\u53e5\u8bdd\u8bf4\uff1a\u7b2c$2$\u5230\u7b2c$m-1$\u5217\u90fd\u5e94\u8be5\u662f\u7b2c$1$\u5217\u548c\u7b2c$m$\u5217\u989c\u8272\u96c6\u5408\u7684\u5b50\u96c6\uff0c\u4e14\u4e2d\u95f4\u8fd9\u4e9b\u96c6\u5408\u90fd\u8981\u76f8\u7b49\uff1b\u7b2c$1$\u5217\u548c\u6700\u540e\u4e00\u5217\u7684\u989c\u8272\u96c6\u5408\u5927\u5c0f\u76f8\u7b49\n\n\u90a3\u4e48\u5c31\u53ea\u9700\u8981\u8ba1\u7b97\u7b2c$1$\u5217\u548c\u7b2c$m$\u5217\u7684\u65b9\u6848\u6570\uff0c\u4e2d\u95f4\u7684\u7528\u7ec4\u5408\u6570\u8ba1\u7b97\u4e00\u4e0b\u5c31\u884c\u4e86\n\n\u8bbe$f[i][j]$\u8868\u793a\u524d$i$\u4e2a\u4f4d\u7f6e\uff0c\u6709$j$\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\n\n$f[i][j]=f[i-1][j]\\times j+f[i-1][j-1]$\n\n\u73b0\u5728\u679a\u4e3e\u7b2c$1$\u5217\u548c\u6700\u540e\u4e00\u5217\u7684\u989c\u8272\u6570\u4e3a$i$\uff0c\u4e2d\u95f4\u5217\u7684\u989c\u8272\u6570\u4e3a$j$\uff0c\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u4e3a\uff1a\n\n$\\displaystyle (f[n][i]\\times i!)^2\\times \\binom{k}{i} \\times \\binom{k-j}{i-j}\\times\\binom{i}{j}\\times j^{n(m-2)}$\n\n\u9996\u5148\u9009\u51fa$i$\u4e2a\u989c\u8272\uff0c\u7136\u540e\u8981\u4e58\u4e0a$i!$\u662f\u56e0\u4e3a\u4e0a\u9762\u7684DP\u6240\u6709\u7684\u989c\u8272\u90fd\u662f\u7b49\u4ef7\u7684\n\n\u7136\u540e$k$\u4e2a\u989c\u8272\u91cc\u9009\u51fa$i$\u4e2a\u4f5c\u4e3a\u7b2c\u4e00\u5217\uff0c$k-i$\u4e2a\u4e2d\u8fd8\u8981\u9009\u53d6$i-j$\u4e2a\u653e\u5230\u6700\u540e\u4e00\u5217\uff0c\u4e2d\u95f4\u653e$j$\u4e2a\u989c\u8272\n\n\u6ce8\u610f\u679a\u4e3e$j$\u7684\u4e0b\u754c\u4e3a$0$\uff0c$j=0$\u53ea\u6709\u5728$m=2$\u65f6\u624d\u662f\u6709\u610f\u4e49\u7684\uff0c\u8fd9\u65f6\u5019\u5feb\u901f\u5e42\u8c03\u7528\u8fdb\u53bb\u662f\u6c42$0^0=1$\uff1b\u5f53$m\\neq 2$\u65f6\uff0c\u5feb\u901f\u5e42\u4f1a\u8fd4\u56de$0$\u3002\u6240\u4ee5\u53ef\u4ee5\u4e0d\u7528\u7279\u5224$m=2$\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u9700\u8981\u7279\u5224$m=1$\u7684\u60c5\u51b5\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#define ll long long\nusing namespace std;\nconst int N=1e3+10,M=1e6;\nconst ll mod=1e9+7;\nll f[N][N],fac[M+10],inv[M+10];\ninline ll power(ll a,ll b)\n{\n\tll res=1;\n\tfor(;b;b>>=1,a=a*a%mod)\n\t\tif(b&1) res=res*a%mod;\n\treturn res;\n}\ninline ll C(int x,int y)\n{\n\tif(x<y) return 0;\n\treturn fac[x]%mod*inv[y]%mod*inv[x-y]%mod;\n}\nint main()\n{\n\tfac[0]=1; for(int i=1;i<=M;i++) fac[i]=fac[i-1]*i%mod;\n\tinv[M]=power(fac[M],mod-2); for(int i=M-1;i>=0;i--) inv[i]=inv[i+1]*(i+1)%mod;\n\tint n,m,k; ll ans=0;\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tif(m==1)\n\t{\n\t\tprintf(\"%lld\\n\",power(k,n));\n\t\treturn 0;\n\t}\n\tf[0][0]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=i;j++)\n\t\t\tf[i][j]=(j*f[i-1][j]+f[i-1][j-1])%mod;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=0;j<=i;j++)\n\t\t{\n\t\t\tll col=f[n][i]*fac[i]%mod*f[n][i]%mod*fac[i]%mod;\n\t\t\tll t=C(k,i)*C(k-i,i-j)%mod*C(i,j)%mod*power(j,n*(m-2))%mod;\n\t\t\tans=(ans+col*t%mod)%mod;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1600432068,
        "uid": 81238,
        "name": "MCAdam",
        "ccfLevel": 7,
        "title": "CF111D Petya and Coloring"
    }
]