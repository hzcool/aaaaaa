[
    {
        "content": "\u8fd9\u9898\u4f60\u8c37\u548b\u6ca1\u9898\u89e3\u554a\n\n---\n\n\u9898\u610f\uff1a\n\n\u7ed9\u4f60\u4e00\u68f5\u6811\u8fb9\u6743\u5168\u4e3a 1 \uff0c\u8be2\u95ee\u82e5\u628a\u6240\u6709\u53f6\u5b50\u4e24\u4e24\u8fde\u4e00\u6761\u8fb9\u957f\u4e3a $d$ \u7684\u8fb9\u540e\u7684\u76f4\u5f84\u3002\n\n$n \\leq 10^6 , q\\leq 10$\n\n---\n\n\u4ee4 $f_x$ \u8868\u793a\u79bb $x$ \u6700\u8fd1\u7684\u53f6\u5b50\u79bb\u5b83\u7684\u8ddd\u79bb\uff0c $f$ \u53ef\u4ee5\u901a\u8fc7bfs~~\u6362\u6839~~\u6c42\u51fa\u3002\n \n\u9996\u5148\uff0c\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u663e\u7136\u4e3a $\\min\\{d + f_u + f_v , dis(u,v)\\}$\n\n\u7c7b\u4f3c\u7edf\u8ba1\u76f4\u5f84\u7684\u529e\u6cd5\uff0c\u5728\u5408\u5e76\u5b50\u6811\u4fe1\u606f\u65f6\u7edf\u8ba1\u7b54\u6848\uff0c\u6709\u4e24\u79cd\u66b4\u529b\u7684\u529e\u6cd5\uff1a\n\n\u8bb0\u5f55 $u$ \u5b50\u6811\u5185\u6bcf\u79cd $dep$ \u4e2d $f$ \u6700\u5c0f\u7684\u70b9\u3002\n\n\u8bb0\u5f55 $u$ \u5b50\u6811\u5185\u6bcf\u79cd $f$ \u4e2d $dep$ \u6700\u5927\u7684\u70b9\n\n\u8003\u8651\u628a\u7b2c\u4e8c\u79cd\u62ce\u51fa\u6765\u4f18\u5316\uff0c\u539f\u56e0\u7a0d\u540e\u8bf4\u660e\u3002\n\n\u4ee4 $mx(u,i)$ \u8868\u793a $u$ \u5b50\u6811\u5185 $f_v= i$ \u7684\u6700\u5927 $dep_v$\u3002\n\n\u9996\u5148\u5408\u5e76\u662f\u5bb9\u6613\u4f18\u5316\u7684\uff0c\u542f\u53d1\u5f0f\u5730\u5c06\u5b50\u6811\u5185\u6700\u6df1\u70b9\u6d45\u7684\u4fe1\u606f\u5e76\u5230\u6d45\u7684\u513f\u5b50\u4e0a\uff0c\u5373\u53ef\u5feb\u901f\u5730\u5408\u5e76\u4fe1\u606f\uff0c\u590d\u6742\u5ea6\u6700\u540e\u8bf4\u660e\u3002\n\n\u7edf\u8ba1\u7b54\u6848\uff1a\n\n\u6211\u4eec\u9700\u8981\u5224\u65ad $\\min\\{d + f_u + f_v , dis(u,v)\\}$ \u80fd\u5426\u5927\u4e8e $ans$ \u3002\n\n\u5047\u8bbe $siz_u \\leq siz_v$\n\n\u5728\u5c0f\u7684\u90a3\u8fb9\u679a\u4e3e\u4e00\u4e0b $f_u$ \u7684\u503c\uff0c \u6211\u4eec\u671f\u671b $u,v$ \u7684\u8ddd\u79bb\u5927\u4e8e $ans$ \uff0c\u90a3\u4e48\u6709 $f_v \\geq ans - f_u - d - 1$ \u8fd9\u6837 ans \u624d\u53ef\u80fd\u53d8\u5927 1 \u3002\n\n\u4e4b\u6240\u4ee5\u9009\u62e9\u7b2c\u4e8c\u79cd\uff0c\u56e0\u4e3a $mx(u,i)$ \u662f\u968f\u7740 $i$ \u800c\u4e0d\u4e0b\u964d\u7684\\*\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ea\u7528\u5224\u65ad $mx(v,ans - f_u - d - 1)$ \u548c\u70b9 $u$ \u7684\u8ddd\u79bb\u80fd\u5426\u5927\u4e8e $ans$ \u5373\u53ef\u3002 \u5982\u679c\u53ef\u4ee5\uff0c $ans\\gets ans+1$ \uff0c \u7ee7\u7eed\u5224\u65ad\u3002\n\n\\*\uff1a\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u5b50\u6811\u91cc\u7684\u70b9\u4e0d\u53ef\u80fd $f$ \u5168\u6bd4\u5b83\u5927\uff0c\u5e76\u4e14\u76f8\u90bb\u4e24\u4e2a\u70b9\u7684 $f$ \u6700\u591a\u76f8\u5dee 1 \uff0c\u4e14\u53f6\u5b50\u8282\u70b9\u7684 $f$ \u503c\u4e3a 0 \uff0c \u6240\u4ee5\u8fd9\u4e4b\u95f4\u7684 $f$ \u503c\u90fd\u5b58\u5728\u4e14\u6df1\u5ea6\u5927\u4e8e\u5b83\u3002\n\n\u5408\u5e76\u90e8\u5206\u4ee3\u7801\n\n```cpp\nvoid Merge(int u,int v) {\n    if(dp[u].size( ) > dp[v].size( ))  dp[u].swap(dp[v]); \n    for(int i = 0 ; i < dp[u].size( ) ; ++ i)  {\n        /*I want the answer to be more than ans , so dp[u][i] , dp[v][j] , that i + j + x > ans */\n        /*  j >= ans - i - t - 1  */\n        while(1) {\n            int lower = max(0 , ans - i - t + 1) ;\n            if(lower >= dp[v].size( )) break; \n            if(dp[v][lower] + dp[u][i] - 2 * dep[v] > ans) ans ++ ;\n            else break;   \n        }\n    }\n    for(int i = 0 ; i < dp[u].size( ) ; ++ i) {\n        upmax(dp[v][i] , dp[u][i]) ; \n    }\n}\n \nvoid dfs(int x) {\n    for(int p:son[x]) dfs(p) , Merge(p , x);\n    while(1) {\n        int lower = max(0 , ans - f[x] - t + 1);\n        if(lower >= dp[x].size( )) break;\n        if(dp[x][lower] - dep[x] > ans) ans ++ ;\n        else break; \n    }\n    if(f[x] == dp[x].size( )) dp[x].emplace_back(dep[x]) ;\n}\n\n``` \n[\u5b8c\u6574\u4ee3\u7801](https://codeforces.com/problemset/submission/1712/175115147)\n\n\n\u8fd9\u7c7b\u5e26\u6709 \u6700\u5927\u5316 $\\min(x,y)$ \u7684\u9898\u76ee\uff0c\u76ee\u524d\u5df2\u7ecf\u786e\u5b9a\u4e86\u90e8\u5206\u7b54\u6848\uff0c\u671f\u671b\u6709\u66f4\u4f18\u7b54\u6848\uff0c\u5c31\u53ea\u9700\u8981\u679a\u4e3e $y \\geq now$ \u7684 $x$ \u4e86\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u53ef\u4ee5\u964d\u4f4e\u590d\u6742\u5ea6\u3002\n\n\u590d\u6742\u5ea6\u76f8\u5173\uff1a\n\n\u7531\u4e8e $ans$ \u603b\u5171\u53ea\u4f1a\u6269\u5c55 $n$ \u6b21\uff0c\u8fd9\u90e8\u5206\u662f $O(n)$ \u7684\u3002 \n\n\u5408\u5e76\u7684\u65f6\u5019\u679a\u4e3e\u4e86\u6700\u6df1\u70b9\u6d45\u7684\u90a3\u8fb9\u7684 $f$ \u503c\u8fdb\u884c\u66f4\u65b0\u7b54\u6848\u4e0e\u5408\u5e76 $f_x\\leq dep_x$\uff0c\u5355\u6b21\u5408\u5e76\u4e3a $O(\\min\\{maxdep_u,maxdep_v\\})$ \u3002 \u56e0\u4e3a\u6bcf\u4e2a\u8282\u70b9\u90fd\u53ea\u4f1a\u5728\u5b83\u6240\u5728\u7684\u957f\u94fe\u9876\u7aef\u88ab\u7edf\u8ba1\u4e00\u6b21\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n)$ \u7684 \u3002\n\n\n---\n\n\u53c2\u8003\u4e86 cf \u539f\u9898\u9898\u89e3\u3002\n\n\u6211\uff1a\u795e\u4ed9\u9898\uff0c\u795e\u4ed9\u505a\u6cd5\uff0c\u6269\u5c55\u7b54\u6848\u771f\u7684\u5999\u3002\n\n\u540c\u5b66\uff1a\u677f\n\ncf \u9898\u89e3\uff1a\u5178\n\n\u6211\uff1a\uff1f",
        "postTime": 1665574347,
        "uid": 161697,
        "name": "\u10e6\ua9bf\u0fd0",
        "ccfLevel": 7,
        "title": "\u3010CF1712F\u9898\u89e3\u3011 \u601d\u7ef4\u3001\u542f\u53d1\u5f0f\u5408\u5e76"
    },
    {
        "content": "\u975e\u72ec\u7acb\u505a\u51fa\uff0c\u81ea\u5df1\u5927\u6982\u5c31\u628a\u524d\u9762\u7684\u5f0f\u5b50\u5565\u7684\u641e\u4e86\u51fa\u6765\uff1f\u7136\u540e\u540e\u9762\u5173\u4e8e\u957f\u5256\u4ee5\u53ca\u590d\u6742\u5ea6\u8bc1\u660e\u627e @LJC00118 \u95ee\u4e86\u5341\u51e0\u5206\u949f\u624d\u641e\u660e\u767d\u3002\n\n\u5148\u8003\u8651\u5bf9\u4e8e\u4e24\u4e2a\u70b9 $u$ \u548c $v$\uff0c\u4ed6\u4eec\u5728\u65b0\u56fe\u4e0a\u7684\u8ddd\u79bb\u53ef\u4ee5\u8868\u793a\u6210\u4ec0\u4e48\u3002\n\n\u9996\u5148\u4e00\u4e2a\u80af\u5b9a\u5c31\u662f\u539f\u672c\u6811\u4e0a\u7684\u7684\u8ddd\u79bb\uff0c\u4e5f\u5c31\u662f $dep_u+dep_v-2dep_{lca}$\u3002\n\n\u7136\u540e\u8003\u8651\u8d70\u65b0\u52a0\u7684\u8def\u7ebf\u3002\u56e0\u4e3a\u53f6\u5b50\u7ed3\u70b9\u4e24\u4e24\u90fd\u6709\u8fde\u8fb9\uff0c\u6240\u4ee5\u8fb9\u6743\u4e3a $x$ \u7684\u8fb9\u53ea\u4f1a\u8d70\u4e00\u6b21\uff0c\u4e0d\u7136\u4e00\u5b9a\u4e0d\u4f18\u3002\u90a3\u4e48\u76f8\u5f53\u4e8e\u4ece $u$ \u8d70\u5230\u4e00\u4e2a\u53f6\u5b50\u7ed3\u70b9\uff0c\u7136\u540e\u8d70\u4e00\u6761 $x$ \u7684\u8fb9\u5230\u53e6\u4e00\u4e2a\u53f6\u5b50\u7ed3\u70b9\uff0c\u518d\u6cbf\u7740\u6811\u8fb9\u8d70\u5230 $v$\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u4e00\u4e2a $g_u$ \u8868\u793a $u$ \u548c\u5b83\u6700\u8fd1\u7684\u53f6\u5b50\u7ed3\u70b9\u7684\u8ddd\u79bb\u662f\u591a\u5c11\u3002\u90a3\u4e48\u8fd9\u4e00\u6761\u8def\u5f84\u5c31\u662f $g_u+g_v+x$\u3002\n\n\u503c\u5f97\u6ce8\u610f\u7684\u662f $g_u$ \u5bf9\u5e94\u7684\u53f6\u5b50\u7ed3\u70b9\u4e0d\u4e00\u5b9a\u5728 $u$ \u7684\u5b50\u6811\u5185\uff0c\u907f\u514d\u4f4e\u7ea7\u9519\u8bef\u3002\n\n\u7136\u540e\u6574\u4e2a\u5f0f\u5b50\u5c31\u662f $ans=\\max\\{\\min(dep_u+dep_v-2dep_{lca},g_u+g_v+x)\\}$\u3002\n\n\u53d1\u73b0 $q$ \u975e\u5e38\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u5927\u80c6\u731c\u6d4b\u6bcf\u6b21\u8be2\u95ee\u7684\u590d\u6742\u5ea6\u662f $O(n)$ \u6216 $O(n\\log n)$ \u7684\u3002\n\n\u663e\u7136\u52a0\u5165\u65b0\u8fb9\u540e\uff0c\u76f4\u5f84\u53ea\u5c0f\u4e0d\u5927\uff0c\u6240\u4ee5\u6709 $ans\\le n$\u3002\u8fd9\u542f\u53d1\u6211\u4eec\u53bb\u8003\u8651\u7b54\u6848\u589e\u957f\u7684\u8fc7\u7a0b\u3002\n\n\u56e0\u4e3a\u6bcf\u6b21\u8be2\u95ee\u6211\u4eec\u90fd\u6709\u770b\u4e0a\u53bb\u6bd4\u8f83\u5145\u88d5\u7684\u590d\u6742\u5ea6\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u6811\u4e0a DFS \u4e00\u904d\uff0c\u7136\u540e\u53bb\u505a\u6811\u5f62 dp\u3002\n\n\u5728\u540c\u4e00\u5b50\u6811\u5185\uff0c\u5bf9\u4e8e $g_u$ \u76f8\u540c\u7684\u4e24\u4e2a\u70b9\uff0c\u663e\u7136\u6211\u4eec\u53ea\u9700\u8981 $dep_u$ \u8f83\u5927\u7684\u4e00\u4e2a\u70b9\u3002\u8fd9\u5bf9\u6211\u4eec\u72b6\u6001\u7684\u8bbe\u8ba1\u6709\u6240\u542f\u53d1\u3002\u8bbe $f_{u,i}$ \u8868\u793a $u$ \u7684\u5b50\u6811\u5185\uff0c\u5bf9\u4e8e $g_v=i$ \u7684\u6240\u6709 $v$\uff0c$dep_v$ \u7684\u6700\u5927\u503c\u3002\n\n\u7136\u540e\uff0c\u5bf9\u4e8e\u4efb\u610f\u7684 $i$ \u90fd\u4e00\u5b9a\u6ee1\u8db3 $f_{u,i}>f_{u,i+1}$\u3002\u8fd9\u4e2a\u662f\u56e0\u4e3a $f_{u,i}$ \u81f3\u5c11\u53ef\u4ee5\u9009 $f_{u,i+1}$ \u5bf9\u5e94\u7684\u70b9\u7684\u513f\u5b50\u3002\u8fd9\u4e2a\u53ef\u4ee5\u6269\u5c55\u5230 $i<j$\uff0c\u6709 $f_{u,i}>f_{u,j}$\uff0c\u4e5f\u5c31\u662f\u8bf4 $f_u$ \u662f\u5355\u8c03\u4e0b\u964d\u7684\u3002\n\n\u6211\u4eec\u8003\u8651\u628a $f_{v,i}$ \u9010\u4e2a\u63d2\u5165 $f_u$ \u5185\uff0c\u540c\u65f6\u6211\u4eec\u6765\u8003\u8651 $f_{v,i}$ \u5bf9\u7b54\u6848\u589e\u957f\u7684\u5f71\u54cd\u3002\n\n\u76f8\u5f53\u4e8e\u6211\u4eec\u8981\u5224\u65ad\u5bf9\u4e8e $f_{v,i}$ \u5bf9\u5e94\u7684\u70b9\u4ee5\u53ca $f_u$ \u91cc\u7684\u67d0\u4e2a\u70b9\uff0c\u662f\u5426\u5b83\u4eec\u7684\u8ddd\u79bb\u80fd $>ans$\uff0c\u5982\u679c\u80fd\uff0c\u90a3\u4e48\u5c31 $ans+1$\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a $f_{v,i}$ \u5982\u4f55\u5224\u65ad\u5b83\u7684\u8ddd\u79bb $>ans$\u3002\u9996\u5148\u8981\u6c42 $g_u+g_v+x>ans$\uff0c\u90a3\u4e48 $g_v\\ge ans-x-g_u+1$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5224\u65ad $\\max_{j\\ge ans-x-g_u+1}\\{f_{u,j}+f_{v,i}\\}>ans$ \u5373\u53ef\u3002\u53c8\u56e0\u4e3a $f_u$ \u5355\u8c03\u4e0b\u964d\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651 $j=\\max(0,ans-x-g_u+1)$\u3002\n\n\u6700\u540e\u8bb0\u5f97\u8fd8\u8981\u628a $u$ \u81ea\u5df1\u5408\u5e76\u5230 $f_u$ \u91cc\u9762\u3002\n\n\u8fd9\u4e2a\u590d\u6742\u5ea6\u4f3c\u4e4e\u4e0d\u592a\u5bf9\uff0c\u8003\u8651\u600e\u4e48\u4f18\u5316\uff1f\n\n\u91c7\u7528\u6811\u94fe\u5256\u5206\u7684\u601d\u60f3\uff0c\u8fd9\u91cc\u91c7\u7528\u957f\u94fe\u5256\u5206\u3002\n\n\u5177\u4f53\u5730\uff0c\u6bcf\u4e2a\u70b9 $u$\uff0c\u5148\u641c\u5b83\u7684\u957f\u513f\u5b50\uff0c\u7136\u540e\u76f4\u63a5\u5c06\u957f\u513f\u5b50\u7684 $f_{son}$ \u6574\u4e2a\u5f04\u5230 $f_u$\u3002\u7136\u540e\u5176\u4ed6\u513f\u5b50\u7684 $f_v$ \u66b4\u529b\u5408\u5e76\u5230 $f_u$ \u5373\u53ef\u3002\n\n\u5b9e\u73b0\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a $f_u$ \u5f00\u4e00\u4e2a vector\uff0c\u7136\u540e\u7528 algorithm \u5e93\u7684 swap \u51fd\u6570\uff0c\u56e0\u4e3a swap \u4e24\u4e2a STL \u5bb9\u5668\u662f $O(1)$ \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5 $swap(f_u,f_{son})$\u3002\n\n\u8003\u8651\u8fd9\u4e2a\u590d\u6742\u5ea6\u600e\u4e48\u8bc1\u660e\u3002\n\n\u9996\u5148 $ans\\le n$\uff0c\u4e14\u6bcf\u6b21\u5224\u65ad $ans$ \u589e\u957f\u7684\u5f0f\u5b50\u90fd\u662f $O(1)$ \u7684\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206\u7684\u590d\u6742\u5ea6\u662f $O(n)$ \u7684\u3002\n\n\u95ee\u9898\u5728\u4e8e\u5408\u5e76\u7684\u590d\u6742\u5ea6\uff0c\u5bb9\u6613\u5206\u73b0\u590d\u6742\u5ea6\u662f\u6bcf\u4e2a\u8f7b\u5b50\u6811\u91cc\u6240\u6709\u70b9\u76f8\u5bf9\u4e8e\u5b50\u6811\u7684\u6839\u7684\u6700\u6df1\u6df1\u5ea6\u7684\u548c\u3002\u5b9e\u9645\u4e0a\u6bcf\u4e2a\u70b9\u53ea\u4f1a\u5728\u5b83\u7b2c\u4e00\u4e2a\u8f7b\u5b50\u6811\u7684\u7956\u5148\u88ab\u5408\u5e76\u4e00\u6b21\u3002\u56e0\u4e3a\u518d\u5f80\u4e0a\u7684\u8f7b\u5b50\u6811\uff0c\u5b83\u8fd9\u4e2a\u6df1\u5ea6\u53ef\u4ee5\u7b97\u5230\u7b2c\u4e00\u4e2a\u7956\u5148\u7684\u957f\u513f\u5b50\u7684\u5b50\u6811\u5185\u76f8\u540c\u6df1\u5ea6\u7684\u67d0\u4e2a\u70b9\u3002\n\n\u6240\u4ee5\u6bcf\u4e2a\u70b9\u5b9e\u8d28\u4e0a\u53ea\u4f1a\u88ab\u7b97\u4e00\u6b21\uff0c\u603b\u7684\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u7efc\u4e0a\u603b\u7684\u590d\u6742\u5ea6\u4e3a $O(nq)$\uff0c\u4f46\u662f\u6211\u8dd1\u5f97\u975e\u5e38\u6162\uff0c\u8dd1\u4e86 3.6s\uff0c\u5927\u6982\u8fd9\u5c31\u662f\u4eba\u50bb\u5e38\u6570\u5927\u5427\u3002\n\nhttps://codeforces.com/contest/1712/submission/181306731",
        "postTime": 1668689873,
        "uid": 115936,
        "name": "\u6cf7\u6cfd\u4e09\u6708",
        "ccfLevel": 0,
        "title": "CF1712F"
    },
    {
        "content": "[CF1712F](https://www.luogu.com.cn/problem/CF1712F)\n\n\u611f\u8c22\u5b66\u957f wcj \u5e26\u6765\u7684\u9898\u76ee\uff08~~\u633a\u597d\u73a9\u7684~~\uff09\u3002\n\n---\n\n\u4ece\u70b9 $u$ \u8d70\u5230\u70b9 $v$ \u5728\u52a0\u8fb9\u4e4b\u540e\u6709\u4e24\u79cd\u6700\u77ed\u7684\u8d70\u6cd5\uff0c\u7b2c\u4e00\u79cd\u662f\u6cbf\u7740\u6811\u8fb9\u8d70\uff0c\u7b2c\u4e8c\u79cd\u662f\u4ece $u$ \u8d70\u5230\u4e00\u4e2a\u53f6\u5b50 $p_1$\uff0c\u7136\u540e\u82b1\u8d39 $x$ \u7684\u4ee3\u4ef7\u539f\u5730 tp \u5230\u53e6\u4e00\u4e2a\u53f6\u5b50\uff0c\u518d\u8d70\u5230 $v$\uff0c\u5bb9\u6613\u53d1\u73b0 $p_1$ \u548c $p_2$ \u5206\u522b\u662f\u8ddd\u79bb $u$ \u548c $v$ \u6700\u8fd1\u7684\u53f6\u5b50\uff0c\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5230\u6700\u8fd1\u7684\u53f6\u5b50\u7684\u8ddd\u79bb\u3002\n\n\u8bbe $dep_u$ \u8868\u793a $u$ \u5230\u6839\u7684\u6df1\u5ea6\uff0c\u76f4\u5f84\u7b49\u4e8e $\\max\\limits_{u,v\\in T}\\{\\min\\{g_u+g_v+x,dep_u+dep_v-2\\times dep_{lca}\\}\\}$\u3002\u53d1\u73b0\u76f4\u5f84\u4e0d\u597d\u76f4\u63a5\u7b97\uff0c\u8981\u6c42 $u$ \u548c $v$ \u7684 LCA\uff0c\u5c1d\u8bd5\u5728\u5408\u5e76\u5b50\u6811\u7684\u65f6\u5019\u7edf\u8ba1\u76f4\u5f84\u3002\n\n---\n\n\u600e\u4e48\u529e\u5462\uff1f\u56fa\u5b9a\u5f53\u524d\u5b50\u6811\u91cc\u7684 $g_u$ \u5219\u5728 $g_u + g_v$ \u786e\u5b9a\u7684\u65f6\u5019\u80af\u5b9a\u5e0c\u671b $dep_u + dep_v$ \u5c3d\u53ef\u80fd\u5927\uff08$dep_{lca}$ \u6b64\u65f6\u5df2\u77e5\uff09\uff1b\u53cd\u4e4b\uff0c\u56fa\u5b9a $dep_u$ \u5219\u5728 $dep_u + dep_v$ \u5df2\u77e5\u7684\u65f6\u5019\u4e5f\u5e0c\u671b $g_u + g_v$ \u6700\u5927\u3002\u6240\u4ee5**\u53ea\u7528\u5b58\u6700\u5927\u503c**\u3002\u8bbe $f_{u, i}$\uff0c\u5b83\u7684\u610f\u4e49\u662f $u$ \u5b50\u6811\u4e2d $g_v = i$ \u7684 $dep_v$ \u6700\u5927\u7684 $v$\uff0c\u6216\u8005\u662f $u$ \u5b50\u6811\u4e2d $dep_v = i$ \u7684 $g_v$ \u6700\u5927\u7684 $v$\uff0c\u4e24\u79cd\u5e94\u8be5\u90fd\u53ef\u4ee5\uff0c\u6211\u53ea\u5199\u4e86\u7b2c\u4e00\u79cd\u3002\n\n\u8bbe\u5f53\u524d\u66f4\u65b0\u5230 $u$\uff0c\u6b63\u5728\u5408\u5e76 $v$ \u7684\u5b50\u6811\u3002\u5148\u7edf\u8ba1\u76f4\u5f84\uff0c\u5f53\u524d\u6700\u5927\u7684\u76f4\u5f84\u8bbe\u4e3a $ans$\u3002\u904d\u5386 $f_{v,i}$\uff0c\u627e\u5230\u53ef\u4ee5\u66f4\u65b0\u7b54\u6848\u7684 $f_{u,j}$\u3002\u6839\u636e\u5b9a\u4e49\uff0c$i$ \u548c $j$ \u81f3\u5c11\u8981\u6ee1\u8db3 $i + j +x > ans$\uff0c$j>ans-i-x$\u3002\u53c8\u53d1\u73b0 $f_u$ \u4e00\u5b9a\u5355\u8c03\u51cf\uff08\u5426\u5219 $a$ \u53ef\u4ee5\u53bb\u5230\u66f4\u6df1\u7684\u70b9\uff0c\u90a3\u5c31\u4e0d\u7b26\u5408\u5b9a\u4e49\u4e86\uff09$f_{v,i}+f_{u,j} - 2\\times dep_u > ans$\uff0c\u6240\u4ee5\u53ef\u80fd\u66f4\u65b0 $ans$ \u7684 $j$ \u4e00\u5b9a\u662f\u8fde\u7eed\u7684\uff0c\u904d\u5386 $j$ \u5e76\u66f4\u65b0\u7b54\u6848\u3002\u66f4\u65b0 $ans$ \u4e4b\u540e\u5408\u5e76\uff0c$f_{u,i}\\leftarrow \\max\\{f_{u,i},f_{v_i}\\}$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u6700\u574f $O(n^2)$ \u7684\u7b97\u6cd5\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u8d21\u732e\u5728\u6240\u6709\u7684\u7956\u5148\u4e0a\u90fd\u4f1a\u88ab\u7b97\u4e00\u904d\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u6ce8\u610f\u5230\u5b50\u6811\u91cc\u6240\u6709\u8282\u70b9\u7684 $g$ \u90fd\u4e0d\u4f1a\u8d85\u8fc7 $u$ \u5230\u5b50\u6811\u5185\u7684\u6700\u957f\u94fe\uff0c\u800c\u66f4\u65b0\u7684\u6b21\u6570\u548c $g$ \u7684\u6700\u5927\u503c\u6709\u5173\u3002\u957f\u94fe\u5256\u5206\uff0c$u$ \u6bcf\u6b21\u7ee7\u627f\u957f\u513f\u5b50\u7684\u7b54\u6848\uff0c\u5176\u4ed6\u513f\u5b50\u66b4\u529b\u5408\u5e76\u3002\n\n---\n\n\u6bcf\u6761\u94fe\u53ea\u6709\u5728\u94fe\u9876\u5408\u5e76\u7684\u65f6\u5019\u4f1a\u6709 $O(len)$ \u7684\u590d\u6742\u5ea6\uff0c\u5176\u4ed6\u65f6\u5019\u76f4\u63a5\u7ee7\u627f\u4e4b\u524d\u7684\u7b54\u6848\uff0c\u65f6\u95f4\u51e0\u4e4e\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\uff0c\u4e00\u5171\u662f $O(n)$\uff1b$ans$ \u6700\u5927\u4e0d\u4f1a\u8d85\u8fc7 $n - 1$\uff0c\u66f4\u65b0 $ans$ \u4e5f\u662f $O(n)$ \u7684\uff0c\u603b\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u7efc\u4e0a\u603b\u7684\u590d\u6742\u5ea6\u4e3a $O(nq)$\uff0c\u4f46\u662f\u6211\u8dd1\u5f97\u8d85\u7ea7\u6162\uff0c\u8dd1\u4e86 $4.3s$\uff0c\u5927\u6982\u8fd9\u5c31\u662f\u4eba\u50bb x \u5e38\u6570\u5927\u5427\u3002\n\ncode\uff08$4258ms$\uff0c$296300KB$\uff09\n\n```cpp\n// Problem: Triameter\n// Contest: Luogu\n// URL: https://www.luogu.com.cn/problem/CF1712F\n// Memory Limit: 750 MB\n// Time Limit: 4500 ms\n//\n// Powered by CP Editor (https://cpeditor.org)\n\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace _0x0620AF {\n    //io\n}\nusing namespace _0x0620AF;\nconst int maxn = 1e6 + 10;\nint dep[maxn], mxlen[maxn], fa[maxn], top[maxn], son[maxn];\nvector<int> G[maxn];\nvoid dfs(int u, int f) {\n    fa[u] = f;\n    dep[u] = dep[f] + 1;\n    for (int v : G[u]) {\n        if (v == f)\n            continue;\n        dfs(v, u);\n        mxlen[u] = Max(mxlen[u], mxlen[v] + 1);\n        if (!son[u] || mxlen[v] > mxlen[son[u]])\n            son[u] = v;\n    }\n}\nvector<int> f[maxn];\nint g[maxn];\nqueue<int> q;\nint ans;\nint x;\nint n;\nvoid dfs1(int u) {\n    if (son[u]) {\n        dfs1(son[u]);\n        swap(f[u], f[son[u]]);\n    }\n    for (int i = Max(0, ans - x - g[u] + 1); i < f[u].size() && f[u][i] - dep[u] > ans; i++)\n        ans = Max(ans, Min(i + g[u] + x, f[u][i] - dep[u]));\n    f[u].resize(Max(g[u] + 1, (int)f[u].size()));\n    f[u][g[u]] = Max(f[u][g[u]], dep[u]);\n    for (int v : G[u]) {\n        if (v == fa[u] || v == son[u])\n            continue;\n        dfs1(v);\n        for (int i = 0; i < f[v].size(); i++) {\n            for (int j = Max(0, ans - x - i + 1); j < f[u].size() && f[u][j] + f[v][i] - 2 * dep[u] > ans; j++)\n                ans = Max(ans, Min(i + j + x, f[u][j] + f[v][i] - 2 * dep[u]));\n        }\n        f[u].resize(Max(f[v].size(), f[u].size()));\n        for (int i = 0; i < f[v].size(); i++) {\n            f[u][i] = Max(f[u][i], f[v][i]);\n        }\n        f[v].clear();\n    }\n}\nint rt;\nvoid solve() {\n    ans = 0;\n    x = read();\n    for (int i = 1; i <= n; i++) f[i].clear();\n    dfs1(rt);\n    write(ans, ' ');\n}\nint t;\nint main() {\n    memset(g, -1, sizeof(g));\n    n = read();\n    for (int u = 2; u <= n; u++) {\n        int v = read();\n        G[u].epb(v);\n        G[v].epb(u);\n    }\n    for (int i = 1; i <= n; i++) {\n        if (G[i].size() > 1)\n            continue;\n        q.ep(i);\n        g[i] = 0;\n    }\n    while (!q.empty()) {\n        int u = q.front();\n        q.pop();\n        for (int v : G[u]) {\n            if (g[v] == -1) {\n                g[v] = g[u] + 1;\n                q.ep(v);\n            }\n        }\n    }\n    rt = 1;\n    dfs(rt, rt);\n    t = read();\n    while (t--) solve();\n}\n```\n",
        "postTime": 1678695040,
        "uid": 401583,
        "name": "a_z_c",
        "ccfLevel": 6,
        "title": "CF1712F\uff08dp\u4f18\u5316\uff0c\u6811\u94fe\u5256\u5206\uff09"
    }
]