[
    {
        "content": "\u53d1\u73b0\u8def\u5f84\u957f\u6bd4\u8f83\u96be\u7edf\u8ba1\uff0c\u6240\u4ee5\u60f3\u5230\u7edf\u8ba1\u6bcf\u6761\u8fb9\u7684\u671f\u671b\u7ecf\u8fc7\u6b21\u6570\u3002\n\n\u6700\u540e\u8981\u8d70\u5230\u76ee\u6807\u70b9$T$\uff0c\u53ea\u6709\u8d77\u70b9\u5230\u76ee\u6807\u70b9\u4e0a\u7684\u8def\u5f84\u662f\u6b63\u786e\u7684\u3002\u6240\u4ee5\u8fd9\u6761\u8def\u5f84\u4e0a\u7684\u8fb9\u671f\u671b\u7ecf\u8fc7\u4e00\u6b21\u3002\n\n\u8003\u8651\u5176\u5b83\u9519\u8bef\u7684\u8fb9\u7684\u671f\u671b\u7ecf\u8fc7\u6b21\u6570\u3002\u8bbe\u8fd9\u6761\u8fb9\u8fde\u63a5\u7684\u5b50\u8282\u70b9\u662f$x$\u3002\n\n(1)$x$\u5728$T$\u7684\u5b50\u6811\u5185\u4e14\u4e0d\u4e3a$T$\u3002\u663e\u7136\u4e0d\u4f1a\u7ecf\u8fc7\u3002\n\n(2)$x$\u4e0d\u5728$T$\u7684\u5b50\u6811\u5185\u6216$x$\u4e3a$T$\u3002\u8bbe$l=LCA(x,T)$\uff0c\u5219\u7ecf\u8fc7\u8fd9\u6761\u8fb9\u5f53\u4e14\u4ec5\u5f53\u4ece$l$\u5411\u4e0b\u904d\u5386\u65f6\uff0c$x$\u6240\u5728\u7684\u5b50\u6811\u5728$T$\u6240\u5728\u7684\u5b50\u6811\u524d\u88ab\u8d70\u5230\u3002\u4e0d\u96be\u7b97\u51fa\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u53d1\u751f\u7684\u6982\u7387\u662f$\\frac{1}{2}$\u3002\u800c\u4e14\u4e00\u65e6\u7ecf\u8fc7\u8fd9\u6761\u8fb9\uff0c\u6700\u540e\u4e00\u5b9a\u4f1a\u9000\u56de\u53bb\u3002\u6240\u4ee5\u8fd9\u6761\u8fb9\u4e00\u65e6\u7ecf\u8fc7\uff0c\u5c31\u4f1a\u7ecf\u8fc7\u4e24\u6b21\u3002\u8fd9\u6837\u8fd9\u6761\u8fb9\u7684\u671f\u671b\u7ecf\u8fc7\u6b21\u6570\u662f\uff1a\n\n$E=\\frac{1}{2}*2+\\frac{1}{2}*0=1$.\n\n\u6240\u4ee5\u4efb\u4f55\u4e0d\u5728$T$\u5b50\u6811\u5185\u7684\u8fb9\u671f\u671b\u7ecf\u8fc7\u6b21\u6570\u90fd\u662f$1$\u3002\n\n\u6240\u4ee5\u9898\u76ee\u5316\u4e3a\uff1a\n\n\u7ed9\u5b9a\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u8d77\u70b9$S$\u548c\u7ec8\u70b9$T$\u7684\u6982\u7387\uff0c\u95ee\u4ee5$S$\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u53bb\u6389\u4ee5$T$\u4e3a\u6839\u7684\u5b50\u6811\u540e\u6811\u5927\u5c0f\u7684\u671f\u671b\u3002\n\n\u4f7f\u7528\u6362\u6839$DP$\u3002\u4ee5\u4efb\u610f\u70b9\u4e3a\u6839\u904d\u5386\u6574\u68f5\u6811\uff0c\u82e5$S$\u5728$T$\u7684\u5b50\u6811\u5185\uff0c\u4e14$S$\u4e0d\u4e3a$T$\uff0c\u5219\u7b54\u6848\u4e3a$n-siz[a]$\uff0c\u5176\u4e2d$a$\u662f$T$\u7684\u513f\u5b50\u4e14\u662f$S$\u7684\u7956\u5148\uff1b\u82e5$S$\u5728$T$\u7684\u5b50\u6811\u5916\uff0c\u5219\u7b54\u6848\u4e3a$siz[T]$\uff1b\u82e5$S=T$\uff0c\u5219\u7b54\u6848\u4e3a0.\n\n\u679a\u4e3e$T$\uff0c\u8ba8\u8bba$S$\u5728\u4ee5$T$\u7684\u54ea\u4e2a\u513f\u5b50\u4e3a\u6839\u7684\u5b50\u6811\u5185\u6216\u5728\u4ee5$T$\u4e3a\u6839\u7684\u5b50\u6811\u5916\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<math.h>\nusing namespace std;\n\nconst int N=1e5+5;\nconst int M=3e5+5;\nint n,u,v;\nint E,ot[M],ne[M],g[N];\nint siz[N];\ndouble sum[N],ans;\npair<double,double> P[N];\n\nvoid add(int u,int v)\n{\n    ot[++E]=v;\n    ne[E]=g[u];\n    g[u]=E;\n}\n\nvoid init()\n{\n    int i;\n    scanf(\"%d\",&n);\n    for(i=1;i<n;++i)\n    {\n        scanf(\"%d%d\",&u,&v);\n        add(u,v),add(v,u);\n    }\n    \n    pair<double,double> tot=make_pair(0,0);\n    for(i=1;i<=n;++i)\n    {\n        scanf(\"%lf%lf\",&P[i].first,&P[i].second);\n        tot.first+=P[i].first,tot.second+=P[i].second;\n    }\n    for(i=1;i<=n;++i)\n        P[i].first/=tot.first,P[i].second/=tot.second;\n}\n\nvoid dfs(int x,int fath)\n{\n    int p,to;\n    siz[x]=1,sum[x]=P[x].first;\n    double ins=0;\n    for(p=g[x];p;p=ne[p])\n    {\n        to=ot[p];\n        if(to==fath) continue;\n        dfs(to,x);\n        siz[x]+=siz[to];\n        sum[x]+=sum[to];\n        ins+=sum[to]*siz[to];\n    }\n    ins+=(1-sum[x])*(n-siz[x]);\n    ans+=ins*P[x].second;\n}\n\nint main()\n{\n    init();dfs(1,0);printf(\"%.12lf\\n\",ans);\n    return 0;\n}\n\n```",
        "postTime": 1545143796,
        "uid": 31435,
        "name": "hwk0518",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF123E \u3010Maze\u3011"
    },
    {
        "content": "### \u524d\u8a00\n\u81ea\u5df1\u505a\u51fa\u6765\u6ef4\u7d2b\u8272\u671f\u671b\uff01\uff01\uff01\u597d\u5f00\u5fc3\uff01\uff01\uff01\n\n## \u7b80\u5316\u9898\u610f\n\u4e00\u9897\u65e0\u6839\u6811\uff0c\u6bcf\u4e2a\u70b9\u6709\u4f5c\u4e3a\u8d77\u70b9\u7684\u6743\u503c $x[i]$ \u548c\u4f5c\u4e3a\u7ec8\u70b9\u7684\u6743\u503c $y[i]$\uff0c\u8fd9\u4e2a\u70b9\u4f5c\u4e3a\u8d77\u70b9\u7684\u6982\u7387\u662f $\\frac {x[i]}{\\sum x} $(\u8bdd\u8bf4\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7528 ``\\cfrac`` \u554a)\uff0c\u4f5c\u4e3a\u7ec8\u70b9\u7684\u6982\u7387\u540c\u7406\u4e3a $\\frac {y[i]}{\\sum y}$\uff0c\u4ece\u8d77\u70b9\u51fa\u53d1\u6df1\u641c\uff0c\u5230\u7ec8\u70b9\u505c\u6b62\uff08\u4f46\u4e5f\u53ef\u4ee5\u8d70\u5230\u4e0d\u4e86\u7ec8\u70b9\u7684\u8def\u76f4\u81f3\u8d70\u4e0d\u4e86\u4e86\uff09\uff0c\u6c42\u5230\u8fbe\u70b9\u6570\u7684\u671f\u671b\u4e2a\u6570\u3002\n\n~~\u597d\u50cf\u5e76\u6ca1\u6709\u7279\u522b\u7b80\u5316~~\u3002\n\n## Solution\n\n\u9996\u5148\u6211\u4eec\u8fdb\u884c\u4e00\u6b65\u8f6c\u5316\uff1a\n\t\n   - \u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\u8d28\uff0c\u7b54\u6848\u5c31\u662f\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u7ec8\u70b9\uff0c\u80fd\u5230\u8fbe\u7684\u70b9\u6570\u671f\u671b\u4e4b\u548c\u3002\n \n\u63a5\u4e0b\u6765\u8003\u8651\u70b9 $u$ \u7684\u7b54\u6848\u5982\u4f55\u7edf\u8ba1\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u6765\u53d1\u73b0\u4e00\u4e9b\u6027\u8d28\uff1a\n\n- \u70b9 $u$ \u4f5c\u4e3a\u7ec8\u70b9\uff0c\u4ed6\u7684\u6240\u6709\u5b50\u6811\u4e92\u76f8\u4e0d\u80fd\u5230\u8fbe\u3002\n   \n - \u5bf9\u4e8e\u70b9 $u$ \u7684\u6bcf\u4e00\u4e2a\u5b50\u6811\uff0c\u4ece\u5185\u90e8\u7684\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u51fa\u53d1\uff0c\u90fd\u53ef\u4ee5\u5230\u8fbe\u8be5\u5b50\u6811\u5185\u6240\u6709\u7684\u70b9\u3002\n   \n\u8fd9\u4e9b\u6027\u8d28\u90fd\u6bd4\u8f83\u663e\u7136\uff0c\u4f46\u662f\u5408\u5e76\u8d77\u6765\u5374\u5f88\u6709\u7528\uff01\n\n\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n$$ans[u] = \\sum_{v \\in son(u)} {\\sum_{k \\in tree(v)} x[k] \\times y[u] \\times siz[v]}$$\n\n\u8bf4\u767d\u4e86\u5c31\u662f\u6240\u6709\u8d77\u70b9\u548c\u4ed6\u914d\u5bf9\u7684\u6982\u7387\u4e58\u4e0a\u5230\u8fbe\u7684\u70b9\u6570\u3002\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u662f\u975e\u5e38\u597d\u7ef4\u62a4\u7684\uff0c$siz[v]$ \u548c $y[u]$ \u90fd\u662f\u53ef\u4ee5\u63d0\u51fa\u6765\u7684\uff0c\u90a3\u4e48 $\\sum x[k]$ \u8fd9\u4e2a\u4e1c\u897f\u5c31\u7ef4\u62a4\u4e00\u4e0b\u5168\u5c40\u7684\u548c\u4ee5\u53ca\u5b50\u6811\u7684\u548c\uff0c\u5206\u522b\u641e\u4e00\u641e\u5c31\u505a\u5b8c\u4e86qaq\u3002\n\n~~\u8bb2\u5b8c\u4e86\u5ffd\u7136\u89c9\u5f97\u8fd9\u9898\u597d\u6c34\uff0c\u6211\u679c\u7136\u8fd8\u662f\u4e2asb~~\u3002\n\n``` cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define Rep(i,a,b) for(int i=(a);i<(b);++i)\n#define rrep(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\ntemplate <typename T>\ninline void read(T &x){\n    x=0;char ch=getchar();bool f=0;\n    while(ch<'0'||ch>'9'){if(ch=='-')f=1;ch=getchar();}\n    while(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n    if(f)x=-x;\n}\ntemplate <typename T,typename ...Args>\ninline void read(T &tmp,Args &...tmps){read(tmp);read(tmps...);}\nconst int N = 1e5 + 5;\nint n;\nvector<int>g[N];\ndouble x[N],y[N];\ndouble ans;\ndouble sx = 0,sy = 0;\nint siz[N];\nvoid dfs(int u,int fa){\n    siz[u] = 1;\n    for(int v : g[u]){\n        if(v == fa)continue;\n        dfs(v,u);\n        siz[u] += siz[v];\n        x[u] += x[v];\n        ans += x[v] * siz[v] * y[u];\n    }\n    ans += (sx - x[u]) * (n - siz[u]) * y[u];\n}\nsigned main(){\n    read(n);\n    rep(i,2,n){\n        int u,v;\n        read(u,v);\n        g[u].push_back(v);\n        g[v].push_back(u);\n    }\n    rep(i,1,n){\n        scanf(\"%lf%lf\",x + i,y + i);\n        sx += x[i];\n        sy += y[i];\n    }\n    rep(i,1,n)x[i] /= sx;\n    rep(i,1,n)y[i] /= sy;\n    sx = sy = 0;\n    rep(i,1,n)sx += x[i];\n    rep(i,1,n)sy += y[i];\n    dfs(1,0);\n    printf(\"%.10lf\",ans);\n}\n```\n\u90fd\u770b\u5230\u8fd9\u91cc\u4e86\uff0c\u7559\u4e2a\u8d5e\u5457QAQ\u3002",
        "postTime": 1668440156,
        "uid": 141058,
        "name": "Xu_brezza",
        "ccfLevel": 0,
        "title": "CF123E Maze \u9898\u89e3"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u4e0d\u592a\u4e00\u6837\u7684\u6362\u6839 dp \u7684\u505a\u6cd5\u3002\n\n\u8bb0 $u$ \u4f5c\u4e3a\u8d77\u70b9\u7684\u6982\u7387\u4e3a $q_u$ \uff0c\u4f5c\u4e3a\u7ec8\u70b9\u7684\u6982\u7387\u4e3a $p_u$\u3002\n\n\u9898\u76ee\u7ed9\u7684\u4ee3\u7801\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u4ece\u67d0\u4e2a\u70b9\u5f00\u59cb\uff0c\u4ee5\u5b83\u4e3a\u6839 dfs \u5230\u7ec8\u70b9\u7684\u6b65\u6570\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u76f4\u63a5\u8003\u8651\u4ee5\u6bcf\u4e2a\u70b9\u4e3a\u6839\uff0c\u5230\u8fbe\u6240\u6709\u53ef\u80fd\u7ec8\u70b9\u7684\u671f\u671b\u6b65\u6570\u4e4b\u548c\u3002\n\n\u9996\u5148\u53ef\u4ee5\u89c2\u5bdf\u51fa\u51e0\u4e2a\u6027\u8d28\uff1a\n\n\u5047\u8bbe\u5f53\u524d\u7684\u6839\u4e3a $x$\uff0c\u7ec8\u70b9\u662f $y$\uff0c\u90a3\u4e48\u4ece $x$ \u5f00\u59cb\u8d70\uff0c\u8003\u8651\u5176\u4e2d\u7684\u4e00\u6b65\u3002\n\n* \u5982\u679c\u8fd9\u4e00\u6b65\u8fdb\u5165\u4e86\u4e0e $y$ \u6240\u5728\u5b50\u6811\u4e0d\u540c\u7684\u4e00\u4e2a\u5b50\u6811\uff0c\u4e00\u5b9a\u4f1a\u628a\u8fd9\u4e2a\u5b50\u6811\u5185\u7684\u6240\u6709\u70b9\u904d\u5386\u5b8c\u624d\u51fa\u6765\u3002\u5047\u8bbe\u8fdb\u5165\u4e86\u4e00\u4e2a\u4ee5 $z$ \u4e3a\u6839\u7684\u5b50\u6811\uff0c\u5927\u5c0f\u4e3a $sz_z$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5b50\u6811\u5185\u7684\u8fb9\u6570\u5c31\u662f $sz_z-1$\uff0c\u6240\u9700\u6b65\u6570\u5373\u4e3a $2(sz_z-1)+2=2sz_z$\u3002\n* \u5982\u679c\u8d70\u8fdb\u4e86\u4e86 $y$ \u6240\u5728\u7684\u5b50\u6811\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u518d\u51fa\u6765\u3002\n\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9\uff0c\u8bb0 $y$ \u6240\u5728\u7684\u5b50\u6811\u7684\u6839\u4e3a $u$\u3002\n\n\u7531\u4e0a\u9762\u7684\u6027\u8d28\u53ef\u4ee5\u77e5\u9053\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u70b9\uff0c\u5982\u679c\u4e00\u4e2a\u5b83\u7684\u4e00\u4e2a\u513f\u5b50 $v \\not=u$ \u5728 $u$ \u4e4b\u524d\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u4f1a\u52a0\u4e0a $2sz_v$\u3002\u800c $v$ \u5728 $u$ \u4e4b\u524d\u88ab\u8bbf\u95ee\u7684\u6982\u7387\u76f8\u5f53\u4e8e\u7ed9\u8fd9\u4e2a\u70b9\u7684\u513f\u5b50\u968f\u673a\u4e00\u4e2a\u6392\u5217\uff0c\u5176\u4e2d $v$ \u5728 $u$ \u4e4b\u524d\u7684\u6982\u7387\u3002\u8003\u8651\u5bf9\u4e8e\u6bcf\u79cd $v$ \u5728 $u$ \u4e4b\u524d\u7684\u6392\u5217\uff0c`swap(u,v)` \u4e4b\u540e\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a $u$ \u5728 $v$ \u4e4b\u524d\u7684\u6392\u5217\uff0c\u6240\u4ee5\u6982\u7387\u662f $\\dfrac 12$\u3002\n\n\u63a5\u4e0b\u6765\u8bbe $S$ \u4e3a $(x,fa_y)$ \u8fd9\u6761\u8def\u5f84\u4e0a\u7684\u70b9\u5206\u53c9\u51fa\u53bb\u7684\u70b9\u96c6\u7684\u5e76\uff0c\u90a3\u4e48 $x$ \u8d70\u5230 $y$ \u7684\u671f\u671b\u5c31\u662f $\\sum\\limits_{u \\in S} \\dfrac{2sz_u}{2}$\uff0c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $q_xp_y\\sum\\limits_{u \\in S}sz_u$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u6839 $x$ \u6c42\u51fa $p_y\\sum\\limits_{u \\in S}sz_u$\uff0c\u5148\u8003\u8651\u4ee5 $1$ \u4e3a\u6839\u3002\n\n\u8bbe $f_u$ \u8868\u793a\u4ee5 $u$ \u4e3a\u8d77\u70b9\uff0c\u5230\u8fbe $u$ \u5b50\u6811\u7684\u7684\u6240\u6709\u53ef\u80fd\u7ec8\u70b9\u7684\u671f\u671b\u6b65\u6570\u4e4b\u548c\uff0c\u8bbe $s=\\sum\\limits_{v \\in son_u} sz_v=sz_u-1$\uff0c$t_u=\\sum\\limits_{v\\in Subtree_u} p_u$\u3002\n\n\u90a3\u4e48\u8f6c\u79fb\u5c31\u662f $f_u=\\sum\\limits_{v \\in son_u} (s-sz_v+1)t_v+f_v$\u3002\n\n\u6362\u6839\u4e5f\u975e\u5e38\u5bb9\u6613\uff0c\u9996\u5148\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u7684 $\\sum t_v$ \u53ef\u4ee5\u63d0\u524d\u7ef4\u62a4\u51fa\u6765\uff0c\u8fd9\u6837\u5b50 $s$ \u7684\u53d8\u5316\u5bfc\u81f4\u7684\u7b54\u6848\u589e\u91cf\u4e5f\u5f88\u5bb9\u6613\u7b97\u51fa\uff0c\u5177\u4f53\u7684\u8f6c\u79fb\u53ef\u4ee5\u89c1\u4ee3\u7801\u3002\n\n\u590d\u6742\u5ea6 $O(n)$\u3002\n\n**\u4ee3\u7801\uff1a**\n\n```cpp\nconst int N=2e5+50;\nint n,x[N],y[N],head[N],cnt;\nld sum[N],sumt[N],sz[N],t[N],p[N],q[N],f[N],g[N],ans;\nstruct edge{int to,nxt;}e[N<<1];\ninline void addedge(int u,int v){e[++cnt]=(edge){v,head[u]},head[u]=cnt;}\nvoid dfs1(int u,int fa)\n{\n\tsz[u]=1,t[u]=p[u];\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==fa) continue;\n\t\tdfs1(v,u),sz[u]+=sz[v],t[u]+=t[v];\n\t\tsum[u]+=sz[v],sumt[u]+=t[v];\n\t}\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==fa) continue;\n\t\tf[u]+=f[v]+(sum[u]-sz[v]+1)*t[v];\n\t}\n}\nvoid dfs2(int u,int fa)\n{\n\tans+=g[u]*q[u];\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==fa) continue;\n\t\tld fu=g[u]-sz[v]*(1-p[u])-(n-1-2*sz[v]+1)*t[v]-f[v];\n\t\tg[v]=f[v]+(n-sz[v])*sumt[v]+(n-1-(n-sz[v])+1)*(1-t[v])+fu,dfs2(v,u);\n\t}\n}\nint main(void)\n{\n\tn=read();int u,v,sumx=0,sumy=0;\n\tfr(i,2,n) u=read(),v=read(),addedge(u,v),addedge(v,u);\n\tfr(i,1,n) x[i]=read(),y[i]=read(),sumx+=x[i],sumy+=y[i];\n\tfr(i,1,n) q[i]=(ld)x[i]/(ld)sumx,p[i]=(ld)y[i]/(ld)sumy;\n\tdfs1(1,0),g[1]=f[1],dfs2(1,0);\n\tprintf(\"%.10Lf\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1661596012,
        "uid": 104413,
        "name": "L_G_J",
        "ccfLevel": 7,
        "title": "CF123E Maze \u9898\u89e3"
    },
    {
        "content": "\n\u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a\u8ff7\u5bab\uff0c\u8fd9\u4e2a\u8ff7\u5bab\u56fe\u662f\u4e00\u4e2a\u6811\uff0c\u6bcf\u4e2a\u70b9\u90fd\u6709\u53ef\u80fd\u4f5c\u4e3a\u8fdb\u5165\u70b9\u548c\u79bb\u5f00\u70b9\u3002\u8981\u6c42\u6c42\u51fa\uff1a\u4ece\u6bcf\u4e2a\u70b9\u51fa\u53d1\u5230\u8fbe\u522b\u7684\u70b9\u7684\u671f\u671b\u3002\n\n\u8f93\u5165\u683c\u5f0f\uff1a\n\u7b2c\u4e00\u884c\u4e00\u4e2a\u6570 n\uff0c\u8868\u793a\u4e2a\u8282\u70b9\u3002\n\u63a5\u4e0b\u6765 n-1 \u884c\uff0c\u6bcf\u884c\u4e24\u4e2a\u6570(u,v),\u8868\u793a\u6709\u4e00\u6761\u4ece u\uff0c\u5230v\u7684\u65e0\u5411\u8fb9\u3002\n\u7136\u540e\u662fn\u884c\uff0c\u6bcf\u884c\u63cf\u8ff0\u4e00\u4e2a\u8282\u70b9\u8868\u793a\u8be5\u8282\u70b9\u88ab\u9009\u4e3a\u8fdb\u5165\u70b9\u7684 x \u548c\u8be5\u8282\u70b9\u88ab\u9009\u4e3a\u79bb\u5f00\u7684 y \u3002\n\n\u6b64\u5904\u7684x\u548cy\u7528\u4e8e\u6c42\u6bcf\u4e2a\u70b9\u88ab\u9009\u4e3a\u8fdb\u5165\u70b9\u7684\u6982\u7387\u548c\u88ab\u9009\u4e3a\u79bb\u5f00\u70b9\u7684\u6982\u7387\uff0c\u5373\uff1a\np[x]=x/sum(x),\np[y]=y/sum(y).\n\n\u8f93\u51fa\u683c\u5f0f\uff1a\u4e00\u4e2a\u5b9e\u6570\u8868\u793a\u671f\u671b\u3002\n\n\u89e3\u6cd5\uff1a\n\u8fd9\u662f\u4e00\u9053\u6c42\u671f\u671b\u7684\u9898\u3002\n\n\u671f\u671b\u8868\u793a\u67d0\u4e2a\u4e8b\u4ef6\u7684\u7ed3\u679c\u7684\u5e73\u5747\u5927\u5c0f\u3002\n\u7b49\u4e8e\u6bcf\u79cd\u7ed3\u679c\u7684\u5927\u5c0f\u4e0e\u5176\u6982\u7387\u4e58\u79ef\u7684\u548c\u3002\n\n\u56e0\u6b64\uff0c\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u8981\u6c42\u51fa**\u6bcf\u4e2a\u5b50\u6811\u7684\u5927\u5c0f**\uff0c\n\u548c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff1a**\u5176\u88ab\u9009\u4e3a\u79bb\u5f00\u70b9\u65f6\uff0c\u4ece\u522b\u7684\u5b50\u6811\u51fa\u53d1\u5230\u8fbe\u5b83\u7684\u6982\u7387**\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5148\u7edf\u8ba1\u8fdb\u5165\u7684\u6982\u7387\uff0c\u7136\u540e\u7528dfs\u6c42\u51fa\u6bcf\u68f5\u5b50\u6811\u7684\u5927\u5c0f\uff0c\u548c\u8fd9\u4e2a\u5b50\u6811\u4e2d\uff0c\u6bcf\u4e2a\u70b9\u88ab\u9009\u4e3a\u8fdb\u5165\u70b9\u7684\u6982\u7387\u4e4b\u548c\u3002\u7136\u540e\u679a\u4e3e\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u79bb\u5f00\u70b9\uff0c\u7136\u540e\u6c42\u51fa\uff1a\n1.\u4ece\u4ee5\u8be5\u8282\u70b9\u4e3a\u6839\u8282\u70b9\u7684\u5b50\u6811\u51fa\u53d1\u5230\u8be5\u8282\u70b9\u7684\u671f\u671b\u3002\n2.\u4ece\u522b\u7684\u5b50\u6811\u51fa\u53d1\u5230\u8be5\u8282\u70b9\u7684\u671f\u671b\u3002\n\n\u8bbe\u8be5\u8282\u70b9\u7f16\u53f7\u4e3a u\uff0c\n\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a\u201c\u522b\u7684\u5b50\u6811\u201d\uff0c\u6211\u4eec\u53ef\u4ee5**\u5c06\u5b83\u4eec\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\uff0c\u770b\u6210u\u8282\u70b9\u7684\u53e6\u4e00\u4e2a\u5b50\u6811**\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528 (1-ru[u])\u8868\u793a\u5c06\u5b83\u4eec\u9009\u4e3a\u51fa\u53d1\u70b9\u7684\u6982\u7387\u3002\u7528\uff08n-size[u]\uff09\u8868\u793a\u5b83\u4eec\u7684\u5927\u5c0f\u3002\n\n\u6700\u540e\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\n\n\u8d34\u4ee3\u7801\uff1a\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<queue>\n#include<stack>\n#include<algorithm>\n#include<cstring>\n#include<vector>\n#include<ctime>\n#include<map>\n#include<cstdlib>\n#include<cmath>\n#define p puts(\"-1\");\n#define r(i,a,b) for(int i=a;i<=b;i++)\n#define rr(i,a,b) for(int i=a;i>=b;i--)\n#define inf 0x3f3f3f3f\n#define mem(a) memset(a,0x3f,sizeof(a))\n#define re(a) a=read()\n#define pr(a) printf(\"%d\\n\",a)\n#define me(a) memset(a,0,sizeof(a))\n#define in inline\n#define db double\n#define red(a) a=readd()\nusing namespace std;\nconst int N=100007;\ninline int read(){\n\tchar ch=getchar();\n\tint w=1,x=0;\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+ch-'0',ch=getchar();}\n\treturn x*w;\n}//\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u7684\u5feb\u8bfb\ninline db readd(){\n\tchar ch=getchar();\n\tdb w=1,x=0;\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0',ch=getchar();}\n\treturn x*w;\n}\nint n,cnt=0,head[N],size[N],fa[N];\ndouble ru[N],chu[N],ans=0,sumru,sumchu;\nstruct edge{\n\tint v,next;\n}e[(N<<1)];\nin void add(int u,int v){\n\te[++cnt]=(edge){v,head[u]};//\u6570\u7ec4\u6a21\u62df\u5efa\u8fb9 \n\thead[u]=cnt;\n}\nin void dfs(int u){\n\tsize[u]=1;//size[]\u7684\u521d\u59cb\u5316 \n\tfor(int i=head[u];i;i=e[i].next){\n\t\tint v=e[i].v;\n\t\tif(v!=fa[u]){//\u4e0d\u7528vis[],\u4e5f\u53ef\u4ee5\u505a\u5230\u6bcf\u4e2a\u70b9\u53ea\u4fbf\u5229\u4e00\u904d \n\t\t\tfa[v]=u;\n\t\t\tdfs(v);\n\t\t\tsize[u]+=size[v];//\u7edf\u8ba1\u6bcf\u68f5\u5b50\u6811\u7684\u5927\u5c0f \n\t\t\tru[u]+=ru[v];//\u7edf\u8ba1\u6bcf\u68f5\u5b50\u6811\u88ab\u9009\u4e3a\u8fdb\u5165\u70b9\u7684\u6982\u7387\u4e4b\u548c \n\t\t}\n\t}\n}\nint main(){\n\tre(n);\n\tme(head),me(size);//\u521d\u59cb\u5316 \n\tr(i,1,n-1){\n\t\tint u,v;\n\t\tre(u);re(v);\n\t\tadd(u,v);add(v,u);//\u5efa\u8fb9\u3002\u6ce8\u610f\u8fd9\u662f\u65e0\u5411\u56fe \n\t}\n\tr(i,1,n){\n\t\tred(ru[i]);red(chu[i]);\n\t\tsumru+=ru[i];sumchu+=chu[i];\n\t}\n\tr(i,1,n)ru[i]/=sumru;//\u6c42\u51fa\u6bcf\u4e2a\u70b9\u88ab\u9009\u4e3a\u8fdb\u5165\u70b9\u7684\u6982\u7387:ru[i]=ru[i]/sumru \n\tdfs(1);\n\tr(u,1,n){//\u904d\u5386\u6bcf\u4e2a\u70b9\uff0c\u4f5c\u4e3a\u79bb\u5f00\u70b9 \n\t\tfor(int j=head[u];j;j=e[j].next){\n\t\t\tint v=e[j].v;\n\t\t\t//\u7edf\u8ba1\u671f\u671b\n\t\t\tif(fa[u]==v)ans+=(1-ru[u])*(n-size[u])*chu[u]/sumchu; \n\t\t\t//\u5f53\u524d\u7684 v \u4e0d\u662fu\u7684\u5b50\u8282\u70b9\uff0c\u6b64\u65f6\u7edf\u8ba1\u4e0a\u8ff0\u7684\"\u522b\u7684\u5b50\u6811\"\u7684\u671f\u671b \u3002\n\t\t\t//\u6b64\u65f6\u6982\u7387\u7b49\u4e8e\u603b\u6982\u7387\u51cf\u53bb\u8fd9\u68f5\u6811\u7684\u6982\u7387\u3002 \n\t\t\telse ans+=ru[v]*size[v]*chu[u]/sumchu;\n\t\t\t//\u7edf\u8ba1\u4ee5u\u4f5c\u4e3a\u6839\u8282\u70b9\u7684\u5b50\u6811\u7684\u671f\u671b \n\t\t}\n\t}\n\tprintf(\"%.11lf\\n\",ans);\n\treturn 0;\n}\n```\n\u672c\u849f\u84bb\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\uff0c\u5982\u6709\u505a\u7684\u4e0d\u597d\u7684\u5730\u65b9\uff0c\u8fd8\u8bf7\u5404\u4f4d\u89c1\u8c05\u3002\n\u6700\u540e\u795d\u5927\u5bb6NOIP2018 RP+=inf!!!",
        "postTime": 1541303767,
        "uid": 112856,
        "name": "yangshurong",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF123E \u3010Maze\u3011"
    },
    {
        "content": "\u7b80\u8ff0\u9898\u610f\uff1a\u7ed9\u4f60\u4e00\u68f5\u6811\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e00\u4e2a\u88ab\u9009\u4e3a\u8d77\u70b9\u7684\u6982\u7387\u548c\u4e00\u4e2a\u88ab\u9009\u4e3a\u7ec8\u70b9\u7684\u6982\u7387\uff0c\u4ece\u8d77\u70b9\u5f00\u59cb\u968f\u673a\u904d\u5386\u5b50\u6811\uff0c\u95ee\u5230\u8fbe\u7ec8\u70b9\u7684\u671f\u671b\u6b65\u6570\u3002\n\n\u76f4\u63a5\u8ba1\u7b97\u7b54\u6848\u5f88\u96be\uff0c\u8003\u8651\u5bf9\u4e00\u5bf9 $(S,T)$ \u6765\u8bf4\uff0c\u4ee5 $S$ \u4e3a\u6839\uff0c\u90a3\u4e48\u6709\uff1a\n\n- \u5bf9 $T$ \u7684\u5b50\u6811\u91cc\u7684\u70b9\uff1a\u663e\u7136\u4e0d\u4f1a\u88ab\u904d\u5386\u5230\uff0c\u8d21\u732e\u4e3a $0$\u3002\n- \u5bf9 $S\\to T$ \u8def\u5f84\u4e0a\u7684\u70b9\uff1a\u663e\u7136\u4f1a\u88ab\u521a\u597d\u904d\u5386 $1$ \u6b21\uff0c\u8d21\u732e\u4e3a $1$\u3002\n- \u5bf9\u4e0d\u5728\u4e0a\u8ff0\u4e24\u79cd\u60c5\u51b5\u4e2d\u7684\u70b9\uff1a\u8bbe\u5176\u4e3a $x$\uff0c\u5f53\u6211\u4eec\u904d\u5386\u5230 $x$ \u548c $T$ \u7684\u5206\u754c\u70b9\u65f6\uff0c\u6211\u4eec\u6709 $\\dfrac{1}{2}$ \u7684\u6982\u7387\u5f80 $x$ \u7684\u65b9\u5411\u8d70\uff0c\u6b64\u65f6\u8d21\u732e\u4e3a $2$\uff08\u5f80\u8fd4\uff09\uff1b\u540c\u65f6\u4e5f\u6709 $\\dfrac{1}{2}$ \u7684\u6982\u7387\u5f80 $T$ \u7684\u65b9\u5411\u8d70\uff0c\u6b64\u65f6\u8d21\u732e\u4e3a $0$\u3002\u6545\u603b\u8d21\u732e\u4e3a $\\dfrac{1}{2}\\times 2+\\dfrac{1}{2}\\times 0=1$\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u6c42\u5bf9\u6bcf\u4e00\u5bf9 $(S,T)$\uff0c\u4ee5 $S$ \u4e3a\u6839\uff0c$n-s'_T$ \u7684\u671f\u671b\uff08$s'_T$ \u8868\u793a $T$ \u5728\u4ee5 $S$ \u4e3a\u6839\u7684\u60c5\u51b5\u4e0b\u7684\u5b50\u6811\u5927\u5c0f\uff09\u3002\n\n\u9996\u5148\u4efb\u9009\u4e00\u4e2a\u6839\uff0c\u8003\u8651\u679a\u4e3e $T$\uff0c\u90a3\u4e48\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a\n\n- $S=T$\uff1a\u90a3\u4e48 $s'_T$ \u663e\u7136\u4e3a $n$\u3002\n- $S$ \u5728 $T$ \u7684\u5b50\u6811\u91cc\uff1a\u90a3\u4e48 $s'_T$ \u5373\u4e3a\u6240\u6709\u70b9\u53bb\u6389 $S$ \u6240\u5728\u7684\u90a3\u68f5\u5b50\u6811\uff0c\u8bbe $S$ \u6240\u5728\u7684\u90a3\u68f5\u5b50\u6811\u7684\u6839\u4e3a $p$\uff0c\u90a3\u4e48 $s'_T=n-s_p$\u3002\n- $S$ \u4e0d\u5728 $T$ \u7684\u5b50\u6811\u91cc\uff1a\u90a3\u4e48 $s'_T$ \u5373\u4e3a $s_T$\u3002\n\n\u6211\u4eec\u53ef\u4ee5 $O(n)$ \u904d\u5386\u6574\u68f5\u6811\u6765\u8ba1\u7b97 $s_T$ \u4ee5\u53ca $S$ \u5728 $T$ \u7684\u5b50\u6811\u4e2d\u7684\u6982\u7387\uff0c\u76f4\u63a5\u8ba1\u7b97\u5373\u53ef\u3002\n\n```cpp\n#include <iomanip>\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nconst int kN = 1e5 + 1;\n\nint n, vs[kN], vt[kN], s[kN], svs, svt;\ndouble ps[kN], pt[kN], p[kN], ans;\nvector<int> e[kN];\n\nvoid D(int x, int f) {\n  s[x] = 1, p[x] = ps[x];\n  double v = 0;\n  for (int i : e[x]) {\n    if (i != f) {\n      D(i, x);\n      s[x] += s[i], p[x] += p[i];\n      v += p[i] * s[i];  // S \u5728 T \u7684\u5b50\u6811\u91cc\uff1a(S \u5728 T \u7684\u5b50\u6811 i \u7684\u6982\u7387) * (n - (n - s_i))\n    }\n  }\n  v += (1 - p[x]) * (n - s[x]);  // S \u4e0d\u5728 T \u7684\u5b50\u6811\u91cc\uff1a\uff08S \u4e0d\u5728 T \u7684\u5b50\u6811\u91cc\u7684\u6982\u7387\uff09*\uff08n - s_T)\n  ans += v * pt[x];\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0);\n  cin >> n;\n  for (int i = 1, x, y; i < n; ++i) {\n    cin >> x >> y;\n    e[x].push_back(y), e[y].push_back(x);\n  }\n  for (int i = 1; i <= n; ++i) {\n    cin >> vs[i] >> vt[i];\n    svs += vs[i], svt += vt[i];\n  }\n  for (int i = 1; i <= n; ++i) {\n    ps[i] = 1.0 * vs[i] / svs;\n    pt[i] = 1.0 * vt[i] / svt;\n  }\n  D(1, 0);\n  cout << fixed << setprecision(12) << ans;\n  return 0;\n}\n```\n",
        "postTime": 1679896566,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "CF123E \u9898\u89e3"
    },
    {
        "content": "\n\u601d\u8003\u66b4\u529b\uff1a\u679a\u4e3e\u8d77\u70b9\u548c\u7ec8\u70b9\uff0c\u518d\u679a\u4e3e\u6bcf\u4e00\u79cd\u904d\u5386\u5e8f\u5217\u5f97\u5230\u7b54\u6848\u3002\u590d\u6742\u5ea6\u8d77\u98de\u3002\n\n\u6839\u636e\u671f\u671b\u7684\u53ef\u52a0\u6027\uff0c\u6211\u4eec\u65e0\u9700\u786c\u7740\u5934\u76ae\u7edf\u8ba1\u6bcf\u4e00\u6761\u5e8f\u5217\u7684\u8d21\u732e\uff0c\u800c\u662f\u628a\u5e8f\u5217\u7684\u8d21\u732e\u62c6\u6210\u904d\u5386\u5e8f\u5217\u5305\u542b\u7684\u8fb9\u7684\u8d21\u732e\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5047\u5982 $Edge$ \u4e3a\u904d\u5386\u65f6\u7ecf\u8fc7\u7684\u8fb9\u96c6\uff0c$e$ \u4e3a\u8fb9\uff0c\u5219\uff1a\n\n$$E[Edge] = \\sum_{e\\in Edge} E[e]$$\n\n\u4ee5\u4e0a\u4e3a\u7b2c\u4e00\u90e8\u5206\uff0c\u6211\u4eec\u5c06\u8def\u5f84\u8d21\u732e\u901a\u8fc7\u671f\u671b\u7684\u6027\u8d28\u62c6\u6210\u4e86\u66f4\u597d\u8ba1\u7b97\u7684\u8fb9\u7684\u8d21\u732e\u3002\n\n---------\n\n\u8003\u8651\u8fb9\u7684\u8d21\u732e\uff1a\u5728\u56fa\u5b9a\u8d77\u70b9\u4e0e\u7ec8\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u628a\u8fb9\u5206\u4e3a\u4e09\u79cd\uff1a\u5728\u8d77\u70b9\u5230\u7ec8\u70b9\u5fc5\u7ecf\u4e4b\u8def\uff08\u6700\u77ed\u8def\u5f84\uff09\u4e0a\u7684\uff0c\u4e0d\u5728\u5fc5\u7ecf\u4e4b\u8def\u4e0a\u7684\uff0c\u4e0e\u4e0d\u53ef\u80fd\u8d70\u5230\u7684\uff08\u8fd9\u4e9b\u8fb9\u5728\u4ee5\u8d77\u70b9\u4e3a\u6839\u65f6\u7ec8\u70b9\u7684\u5b50\u6811\u5185\uff09\u3002\n\n\u7b2c\u4e00\u79cd\u8fb9\u8d21\u732e\u4e3a $1$\u3002\u56e0\u4e3a\u6211\u4eec\u5fc5\u987b\u7ecf\u8fc7\u8fd9\u6761\u8fb9\uff0c\u4e14\u56e0\u4e3a\u904d\u5386\u65b9\u5f0f\u4e3a\u6df1\u5ea6\u4f18\u5148\u641c\u7d22\uff0c\u4e00\u5b9a\u4f1a\u5728\u7ecf\u8fc7\u8fd9\u6761\u8fb9\u540e\u641c\u5230\u7ec8\u70b9\u7ed3\u675f\uff0c\u4e0d\u53ef\u80fd\u518d\u8d70\u7b2c\u4e8c\u6b21\u3002\n\n\u73b0\u5728\u6211\u4eec\u601d\u8003\u7b2c\u4e8c\u79cd\u8fb9\u7684\u8d21\u732e\u3002\u6211\u4eec\u8bbe\u8d77\u70b9\u4e3a\u6839\u8282\u70b9\uff0c\u5e76\u8bbe\u8fd9\u6761\u8fb9\u6df1\u5ea6\u8f83\u6d45\u7684\u70b9\u4e3a $u$\u3002\u6211\u4eec\u8ba9 $u$ \u5f80\u4e0a\u8df3\uff0c\u76f4\u5230\u9047\u5230\u4e00\u4e2a\u5fc5\u7ecf\u4e4b\u8def\u4e0a\u7684\u70b9 $fa$\u3002\u6211\u4eec\u4ee4\u8fd9\u6761\u5fc5\u7ecf\u4e4b\u8def\u4e0a\u8fb9\u7684\u4e0b\u4e00\u4e2a\u70b9\u4e3a $w$\u3002\n\n\u663e\u7136\uff0c$u$ \u4e0e $w$ \u5206\u5c5e $fa$ \u7684\u4e0d\u540c\u5b50\u6811\u3002\u5047\u5982\u6211\u4eec\u5148\u8fdb\u5165\u4e86 $u$ \u7684\u5b50\u6811\uff0c\u7531\u4e8e\u7ec8\u70b9\u4e0d\u5728\u5176\u4e2d\uff0c\u6240\u4ee5\u4f1a\u5168\u904d\u5386\u4e00\u904d\u540e\u56de\u6eaf\uff0c\u6b64\u65f6\u8fd9\u6761\u8fb9\u8d21\u732e\u4e3a $2$\uff0c\u56e0\u4e3a\u8fdb\u53bb\u548c\u51fa\u6765\u6309\u7167\u9898\u76ee\u8981\u6c42\u8981\u7b97\u4e24\u6b21\u3002\n\n\u5047\u5982\u6211\u4eec\u5148\u8fdb\u5165\u4e86 $w$\uff0c\u5c31\u4e0d\u4f1a\u518d\u51fa\u6765\uff0c\u800c\u662f\u904d\u5386\u5230\u7ec8\u70b9\u540e\u7ed3\u675f\u7b54\u6848\u3002\u6b64\u65f6\u8fd9\u6761\u8fb9\u4e0d\u4f1a\u88ab\u8ba1\u7b97\u5230\uff0c\u8d21\u732e\u4e3a $0$\u3002\n\n\u800c $u$ \u548c $w$ \u5148\u8fdb\u54ea\u68f5\u5b50\u6811\u5b8c\u5168\u53d6\u51b3\u4e8e\u5b83\u4eec\u5728\u904d\u5386\u5e8f\u5217\u4e2d\u7684\u5148\u540e\u3002\u7531\u4e8e\u5e8f\u5217\u968f\u673a\uff0c\u6240\u4ee5\u6982\u7387\u5404\u4e3a $50\\%$\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b2c\u4e8c\u79cd\u8fb9\u5bf9\u671f\u671b\u7684\u8d21\u732e\u540c\u6837\u4e3a $1$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u56fa\u5b9a\u8d77\u70b9\u7ec8\u70b9\uff0c\u5047\u5982\u7b2c\u4e09\u79cd\u8fb9\u6709 $m$ \u6761\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u671f\u671b\u5c31\u662f $n - 1 - m$\u3002\n\n\u4ee5\u4e0a\u4e3a\u7b2c\u4e8c\u90e8\u5206\uff0c\u6211\u4eec\u5c06\u8fb9\u7684\u8d21\u732e\u5206\u7c7b\u8ba8\u8bba\uff0c\u6700\u7ec8\u7b80\u5316\u4e86\u8981\u6c42\u7684\u95ee\u9898\u3002\n\n--------\n\n\u90a3\u4e48\u6211\u4eec\u6765\u601d\u8003\u600e\u4e48\u5feb\u901f\u6c42\u51fa\u6700\u7ec8\u7b54\u6848\u3002\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $u$\uff0c\u6211\u4eec\u601d\u8003\u4ed6\u4f5c\u4e3a\u7ec8\u70b9\u7684\u60c5\u51b5\uff08\u6b64\u65f6\u6211\u4eec\u8bbe $1$ \u4e3a\u6839\uff09\u3002\u5bf9\u4e8e\u4ed6\u7684\u6bcf\u68f5\u5b50\u6811\uff0c\u6211\u4eec\u6c42\u51fa\u5176\u5185\u6240\u6709\u8282\u70b9\u4f5c\u4e3a\u8d77\u70b9\u7684\u6982\u7387\u548c $f_v$\uff0c\u90a3\u4e48\u4ee5\u8fd9\u4e9b\u70b9\u4f5c\u4e3a\u8d77\u70b9\u80fd\u591f\u8d70\u5230\u7684\u8fb9\u6570\u5c31\u662f\u5b50\u6811\u5927\u5c0f\uff08\u56e0\u4e3a\u5305\u62ec\u4e86\u8fde\u5411 $u$ \u7684\u8fb9\uff09\u3002\u6240\u4ee5\u8d21\u732e\u4e3a $u\\times f_v\\times si_v$\u3002\n\n\u5f53\u7136\u8fd8\u6709\u4e0d\u662f\u4ed6\u5b50\u6811\u4f5c\u4e3a\u8d77\u70b9\u7684\u8def\u5f84\uff0c\u8fd9\u4e9b\u8def\u5f84\u7684\u6982\u7387\u548c\u4e3a $1-f_u$\uff0c\u8fb9\u96c6\u5927\u5c0f\u4e3a $1-si_u$\uff0c\u6309\u7167\u4e0a\u9762\u7684\u65b9\u5f0f\u4e5f\u80fd\u7b80\u5355\u8ba1\u7b97\u3002\n\n\u5f53\u7136\uff0c\u94a6\u5b9a $u$ \u4f5c\u4e3a\u8d77\u70b9\u8fd0\u7b97\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u4ee5\u4e0a\u4e3a\u7b2c\u4e09\u90e8\u5206\u3002\n\n---------\n\n\u987a\u4fbf\u4e00\u63d0\u8fd9\u9053\u9898\u662f\u6211\u89c1\u8fc7\u7684\u5c11\u6709\u7684\u5361\u5173\u95ed\u540c\u6b65\u6d41 `cin` \u7684\u9898\u3002\u8bf7\u6ce8\u610f\u4f7f\u7528\u66f4\u5feb\u7684\u8f93\u5165\u65b9\u5f0f\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 1e5 + 5;\n\nint n;\nvector<int> e[N];\ndouble x[N], y[N], sumX, sumY;\nint si[N];\ndouble f[N];\ndouble ans;\ndouble now;\n\nvoid dfs(int u, int fa) {\n\tsi[u] = 1;\n\tfor (auto v : e[u]) {\n\t\tif (v == fa) continue;\n\t\tdfs(v, u);\n\t\tf[u] += f[v];\n\t\tsi[u] += si[v];\n\t}\n\tf[u] += x[u];\n}\nsigned main() {\n  // freopen(\"text.in\", \"r\", stdin);\n\tscanf(\"%d\", &n);\n\tint u, v;\n\tfor (int i = 1; i < n; ++i) {\n\t\tscanf(\"%d%d\", &u, &v);\n\t\te[u].push_back(v);\n\t\te[v].push_back(u);\n\t}\n\tfor (int i = 1; i <= n; ++i) {\n\t\tscanf(\"%d%d\", &x[i], &y[i]);\n\t\tsumX += x[i], sumY += y[i];\n\t}\n\n\tfor (int i = 1; i <= n; ++i) x[i] /= sumX;\n\tfor (int i = 1; i <= n; ++i) y[i] /= sumY;\n\n\tdfs(1, -1);\n\n\tdouble ans=0;\n\tfor (int now = 1; now <= n; ++now) {\n\t\tfor (auto v : e[now]) {\n\t\t\tif (si[v] > si[now]) continue;\n\t\t\tans += f[v] * y[now] * si[v];\n\t\t}\n\t\tans += (1 - f[now]) * y[now] * (n - si[now]);\n\t}\n\n\tprintf(\"%.10lf\\n\", ans);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1679383999,
        "uid": 149219,
        "name": "_maze",
        "ccfLevel": 6,
        "title": "CF123E \u9898\u89e3"
    },
    {
        "content": "~~\u611f\u89c9\u7206\u6740\u4e86\u9898\u89e3\u533a\u7684\u4e00\u4e9b\u505a\u6cd5~~\n\n[LINK](https://www.luogu.com.cn/problem/CF123E)\n\n\u8003\u8651\u8ba1\u7b97\u8d21\u732e\uff0c\u4e00\u4e2a\u70b9\u80fd\u505a\u51fa\u4ec0\u4e48\u8d21\u732e\uff1f\n\n\u628a\u70b9 $i$ \u63d0\u8d77\u6765\u7136\u540e\u8003\u8651\u5982\u679c\u8d77\u70b9\u548c\u7ec8\u70b9\u4ee5 $i$ \u4e3a\u754c\u5728\u4e0d\u540c\u7684\u5b50\u6811\u4e4b\u4e2d\u5c31\u4e00\u5b9a\u8981\u7ecf\u8fc7 $i$ \u800c\u4e14\u53ea\u8fc7\u4e00\u904d\uff0c\u90a3\u5c31\u53ea\u8ba1\u7b97\u4e00\u70b9\u8d21\u732e\u3002\n\n\u5982\u679c\u5728\u540c\u4e00\u68f5\u5b50\u6811\u4e4b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u56e0\u4e3a\u662f dfs \u6240\u4ee5\u5982\u679c\u641c\u8fc7\u53bb\u4e86\u5c31\u4e00\u5b9a\u8981\u641c\u5b8c\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e\u662f\u5728 dfs \u7684\u65f6\u5019\uff0c\u5982\u679c\u5728\u62d0\u89d2\u5904\u641c\u8fc7\u53bb\u4e86\u5c31\u4e00\u5b9a\u80fd\u641c\u5230\u6211\u8fd9\u4e2a\u70b9\u800c\u4e14\u8ba1\u7b97\u4e24\u6b21\u8d21\u732e\uff0c\u6211\u4eec\u628a\u70b9\u7684\u90bb\u63a5\u8868\u5168\u6392\u5217\u4e00\u4e0b\u53d1\u73b0\u62d0\u70b9\u8981\u4e48\u5728\u4ed6\u524d\u9762\u8981\u4e48\u5728\u4ed6\u540e\u9762\uff0c\u5c31\u662f $\\frac{1}{2}$ \u7684\u6982\u7387\u80fd\u641c\u8fc7\u53bb\uff0c\u56e0\u4e3a\u548c\u7ec8\u70b9\u4e0d\u5728\u4e00\u4e2a\u65b9\u5411\u6240\u4ee5\u80af\u5b9a\u4f1a\u56de\u6eaf\uff0c\u662f\u4e24\u70b9\u8d21\u732e\uff0c\u4e58\u8d77\u6765\u521a\u597d\u662f $1$ \u70b9\u8d21\u732e\u3002\n\n\u4f46\u662f\u6709\u4e00\u79cd\u60c5\u51b5\u662f\u641c\u4e0d\u8fc7\u53bb\u7684\uff0c\u5c31\u662f\u628a\u8d77\u70b9\u63d0\u8d77\u6765\u505a\u6839\u65f6\uff0c\u70b9 $i$ \u5728\u7ec8\u70b9\u7684\u5b50\u6811\u4e2d\u3002\n\n\u4f60\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u70b9\u8fd9\u4e2a\u5f88\u597d\u8ba1\u7b97\uff0c\u5927\u6982\u5c31\u662f\u5148\u6c42\u51fa\u5b50\u6811\u7684\u7136\u540e\u7edf\u8d77\u6765\u518d\u7b97\u4e0a\u81ea\u5df1\u4f5c\u4e3a\u7ec8\u70b9\u65f6\u7684\u8d21\u732e\uff0c\u591a\u4e2a\u70b9\u5462\uff1f\u8003\u8651\u6362\u6839 DP\uff0c\u6362\u6839\u4e0b\u53bb\u7684\u65f6\u5019\uff0c\u9996\u5148\u628a\u6362\u4e0a\u6765\u7684\u6839\u5bf9\u4ed6\u7684\u8d21\u732e\u53bb\u6389\u7136\u540e\u518d\u628a\u4ed6\u4f5c\u4e3a\u7ec8\u70b9\u7684\u8d21\u732e\u4e2d\u8d77\u70b9\u5728\u539f\u6765\u6362\u4e0a\u6765\u7684\u6839\u7684\u5b50\u6811\u4e2d\u7684\u4e5f\u53bb\u6389\uff0c\u6362\u6839\u4e0a\u6765\u5c31\u628a\u539f\u6765\u7684\u6839\u7684\u8d21\u732e\u52a0\u4e0a\u3002\n\n\u7136\u540e\u56e0\u4e3a\u5bf9\u671f\u671b\u8d21\u732e\u90fd\u662f $1$\uff0c\u6240\u4ee5\u6c42\u603b\u671f\u671b\u53ef\u4ee5\u76f4\u63a5\u6c42\u548c\u3002\n\n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n;\nvector<int> ljb[100005];\ndouble down[100005];\nint allx,ally;\nint X[100005];\nint Y[100005];\nint sizX[100005];\nint sizY[100005];\ndouble ans;\nvoid dfs(int cur,int fa){\n    sizX[cur]=X[cur];\n    sizY[cur]=Y[cur];\n    for(int i=0;i<ljb[cur].size();i++){\n        int v=ljb[cur][i];\n        if(v==fa)continue;\n        dfs(v,cur);\n        sizX[cur]+=sizX[v];\n        sizY[cur]+=sizY[v];\n    }\n    return;\n}\nvoid getdown(int cur,int fa){\n    down[cur]=0;\n    for(int i=0;i<ljb[cur].size();i++){\n        int v=ljb[cur][i];\n        if(v==fa)continue;\n        getdown(v,cur);\n        down[cur]+=down[v];\n    }\n    down[cur]+=1.*Y[cur]/ally*sizX[cur]/allx;\n    return;\n}\nvoid calc(int cur,int fa){\n    ans+=1-down[cur];\n    double tmp=down[cur];\n    for(int i=0;i<ljb[cur].size();i++){\n        int v=ljb[cur][i];\n        if(v==fa)continue;\n        down[cur]-=down[v];\n        down[cur]-=(1.*Y[cur]/ally);\n        down[cur]+=(1.*Y[cur]/ally*(allx-sizX[v])/allx);\n        double T=down[v];\n        down[v]+=down[cur];\n        down[v]-=(1.*Y[v]/ally*(sizX[v])/allx);\n        down[v]+=1.*Y[v]/ally;\n        calc(v,cur);\n        down[cur]=tmp;\n        down[v]=T;\n    }\n    return;\n}\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++){\n        int u,v;\n        scanf(\"%d%d\",&u,&v);\n        ljb[u].push_back(v);\n        ljb[v].push_back(u);\n    }\n    for(int i=1;i<=n;i++){\n        scanf(\"%d%d\",&X[i],&Y[i]);\n        allx+=X[i];\n        ally+=Y[i];\n    }\n    dfs(1,0);\n    getdown(1,0);\n    calc(1,0);\n    printf(\"%.11lf\",ans);\n    return 0;\n}\n```",
        "postTime": 1678677658,
        "uid": 679749,
        "name": "EastSnowLotus",
        "ccfLevel": 0,
        "title": "\u90a3\u53c8\u600e\u4e48\u6837\uff1f"
    },
    {
        "content": "## Description\n\n[link](https://www.luogu.com.cn/problem/CF123E)\n\n## Solution\n\n\u4f2a\u4ee3\u7801\u5c31\u662f\u6c42\u4ece\u8d77\u70b9\u6df1\u641c\u5230\u7ec8\u70b9\u7684\u6b65\u6570\u3002\n\n\u8003\u8651\u5df2\u7ecf\u786e\u5b9a\u4e86\u8d77\u70b9\u548c\u7ec8\u70b9\u540e\u5982\u4f55\u6c42\u671f\u671b\u3002\n\n\u8bbe $p_i$ \u8868\u793a $i$ \u4f5c\u4e3a\u8d77\u70b9\u7684\u6982\u7387\uff0c$q_i$ \u8868\u793a $i$ \u4f5c\u4e3a\u7ec8\u70b9\u7684\u6982\u7387\uff0c$t_i$ \u8868\u793a $i$ \u7684\u5b50\u6811\u91cc\u7684 $q$ \u4e4b\u548c\u3002$f_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u8d77\u70b9\uff0c\u5f80\u5b50\u6811\u91cc\u8d70\u7684\u671f\u671b\u503c\u3002\n\n\u9996\u5148\u5982\u679c\u8d70\u5230\u4e86\u4e00\u4e2a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e14\u8fd9\u4e2a\u6811\u91cc\u9762\u6ca1\u6709\u7ec8\u70b9\uff0c\u90a3\u4e48\u5c31\u8981\u8d70 $2\\cdot (sz_i-1)$ \u6b65\u3002\n\n\u4e0d\u59a8\u8bbe\u8d77\u70b9\u662f $u$\uff0c\u7ec8\u70b9\u6240\u5728\u7684\u5b50\u6811\u4e3a $v$\uff0c\u90a3\u4e48\u5bf9\u4e8e $u$ \u6240\u6709\u4e0d\u7b49\u4e8e $v$ \u7684\u513f\u5b50 $w$\uff0c\u90a3\u4e48\u4ed6\u6709 $\\dfrac{1}{2}$ \u6982\u7387\u5728 $v$ \u4e4b\u524d\u88ab\u904d\u5386\uff0c\u6240\u4ee5 $w$ \u8fd9\u4e2a\u5b50\u6811\u7684\u8d21\u732e\u5c31\u662f $\\big[2\\cdot(sz_w-1)+2\\big]\\times\\dfrac{1}{2}$\uff0c\u5373 $sz_w$\u3002\n\n\u6240\u4ee5 $v$ \u5bf9\u671f\u671b\u548c\u7684\u8d21\u732e\u5c31\u662f $f_v+(sz_u-1-sz_v+1)\\cdot t_v$\uff0c\u4e5f\u5c31\u662f $f_v+(sz_u-sz_v)\\cdot t_v$\u3002\n\n\u90a3\u4e48 $f_u=\\sum{\\big[f_v+(sz_u-sz_v)\\cdot t_v\\big]}$\u3002\n\n---\n\n\u7136\u540e\u8003\u8651\u5982\u4f55\u6362\u6839\u3002\n\n\u8bbe $g_v$ \u8868\u793a\u4ee5 $v$ \u4e3a\u6839\u7684\u671f\u671b\u7b54\u6848\u3002\n\n\u90a3\u4e48\u8003\u8651 $\\sum{\\big[f_v+(sz_u-sz_v)\\cdot t_v\\big]}$ \u8fd9\u4e2a\u5f0f\u5b50\u91cc $f_v$ \u5c31\u662f\u591a\u4e86\u4e00\u4e2a $g_u$ \u53bb\u6389 $v$ \u8fd9\u4e2a\u5b50\u6811\u7684\u7b54\u6848\uff0c\u8bbe\u5176\u4e3a $k$\u3002\n\n\u90a3\u4e48 $k=g_u-(n-sz_v)\\cdot t_v-f_v-sz_v\\cdot (1-t_v-q_u)$\uff0c$g_v=f_v+k+sz_v\\cdot(1-t_v)+(n-sz_v)\\cdot (1-q_v)$\u3002\n\n\u6700\u7ec8\u7b54\u6848\u5c31\u662f $\\sum g_ip_i$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n)$\u3002\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\n\n// #define int long long\n\nusing namespace std;\nusing f64 = long double;\n\nconst int kMaxN = 1e5 + 5;\n\nint n, sumx, sumy;\nint x[kMaxN], y[kMaxN], sz[kMaxN];\nf64 ans, p[kMaxN], q[kMaxN], f[kMaxN], g[kMaxN], t[kMaxN];\nvector<int> G[kMaxN];\n\nvoid dfs1(int u, int fa) {\n  sz[u] = 1, t[u] = q[u];\n  for (auto v : G[u]) {\n    if (v == fa) continue;\n    dfs1(v, u);\n    sz[u] += sz[v];\n    t[u] += t[v];\n  }\n  for (auto v : G[u]) {\n    if (v == fa) continue;\n    f[u] += f[v] + (sz[u] - sz[v]) * t[v];\n  }\n}\n\nvoid dfs2(int u, int fa) {\n  ans += p[u] * g[u];\n  for (auto v : G[u]) {\n    if (v == fa) continue;\n    f64 f_u = g[u] - (n - sz[v]) * t[v] - f[v] - sz[v] * (t[1] - t[v] - q[u]);\n    g[v] = f[v] + f_u + sz[v] * (t[1] - t[v]) + (n - sz[v]) * (t[v] - q[v]);\n    dfs2(v, u);\n  }\n}\n\nvoid dickdreamer() {\n  cin >> n;\n  for (int i = 1; i < n; ++i) {\n    int u, v;\n    cin >> u >> v;\n    G[u].emplace_back(v);\n    G[v].emplace_back(u);\n  }\n  for (int i = 1; i <= n; ++i) {\n    cin >> x[i] >> y[i];\n    sumx += x[i];\n    sumy += y[i];\n  }\n  for (int i = 1; i <= n; ++i) {\n    p[i] = x[i] * 1.0 / sumx;\n    q[i] = y[i] * 1.0 / sumy;\n  }\n  dfs1(1, 0);\n  g[1] = f[1];\n  dfs2(1, 0);\n  cout << fixed << setprecision(10) << ans << '\\n';\n}\n\nint32_t main() {\n#ifdef ORZXKR\n  freopen(\"in.txt\", \"r\", stdin);\n  freopen(\"out.txt\", \"w\", stdout);\n#endif\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  int T = 1;\n  // cin >> T;\n  while (T--) dickdreamer();\n  // cerr << 1.0 * clock() / CLOCKS_PER_SEC << 's';\n  return 0;\n}\n```\n\n",
        "postTime": 1678086655,
        "uid": 176843,
        "name": "Scarab",
        "ccfLevel": 0,
        "title": "CF123E Maze \u9898\u89e3"
    }
]