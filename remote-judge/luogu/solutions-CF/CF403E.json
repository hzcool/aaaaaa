[
    {
        "content": "\u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e2a\u4e0d\u9700\u8981\u6811\u5256\u7684\u505a\u6cd5\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u68f5\u6811\u4e2d\u7684\u4e00\u6761\u8fb9 $(u,v)$ \u8bbe $v$ \u662f $u$ \u7684\u513f\u5b50\u3002\u6211\u4eec\u8bbe\u6bcf\u4e2a\u70b9\u5728\u7b2c\u4e00\u68f5\u6811\u4e0a\u7684 dfs \u5e8f\u4e3a $a_i$\uff0c\u7b2c\u4e8c\u68f5\u6811\u4e2d\u4e3a $b_i$\u3002\u663e\u7136\u5728\u7b2c\u4e8c\u68f5\u6811\u4e2d\u9700\u8981\u5220\u6389\u7684\u8fb9 $(x,y)$ \u6ee1\u8db3 $x,y$ \u5176\u4e2d\u4e00\u4e2a\u7684 dfs \u5e8f\u5728 $v$ \u5b50\u6811\u4e2d\u53e6\u4e00\u4e2a\u4e0d\u5728\u3002\u90a3\u4e48\u76f8\u5f53\u4e8e\u5e73\u9762\u4e0a\u7684\u4e24\u4e2a\u77e9\u5f62\uff0c\u76f4\u63a5\u5f00\u4e24\u4e2a\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u5177\u4f53\u7ef4\u62a4\u65b9\u6cd5\u6709\u5f88\u591a\u79cd\uff0c\u6211\u7684\u65b9\u6cd5\u662f\u628a\u8fd9\u4e2a\u70b9\u5728\u6bcf\u4e2a\u8986\u76d6\u5b83\u7684\u533a\u95f4\u90fd\u63d2\u5165\u4e00\u904d\uff0c\u7136\u540e\u533a\u95f4\u67e5\u8be2\u53d6\u51fa\u7684\u65f6\u5019\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u5df2\u7ecf\u53d6\u51fa\u8fc7\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n\u8fd8\u6709\u4e00\u79cd\u505a\u6cd5\u662f\u76f4\u63a5\u628a\u6240\u6709\u70b9\u63d2\u5165\u5230\u53f6\u5b50\u4e0a\uff0c\u7136\u540e\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u662f\u5426\u5b50\u6811\u5185\u5143\u7d20\u90fd\u88ab\u53d6\u5b8c\u7684\u6807\u8bb0\uff0c\u6bcf\u6b21\u67e5\u8be2\u5982\u679c\u6ca1\u53d6\u5b8c\u5c31\u66b4\u529b\u9012\u5f52\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$ \u7a7a\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n```c++\n#include<bits/stdc++.h>\n#define ll long long\n#define fi first\n#define se second\n#define N 200005\n#define pa pair<int,int>\nusing namespace std;\nll read()\n{\n\tll x=0,fh=1;\n\tchar ch=getchar();\n\twhile (!isdigit(ch))\n\t{\n\t\tif (ch=='-') fh=-1;\n\t\tch=getchar();\n\t}\n\twhile (isdigit(ch))\n\t{\n\t\tx=x*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn fh*x;\n}\nvoid write(ll x)\n{\n\tif (x<0)\n\t{\n\t\tputchar('-');\n\t\twrite(-x);\n\t\treturn;\n\t}\n\tif (x>=10) write(x/10);\n\tputchar('0'+x%10);\n}\nvoid writeln(ll x)\n{\n\twrite(x);\n\tputchar('\\n');\n}\nvoid writesp(ll x)\n{\n\twrite(x);\n\tputchar(' ');\n}\nint st;\nint n;\nvector<int>S;\nint sm;\nvector<pair<int,pa>>Wt[2];\nint vis[2][N];\nstruct CWT_Mei_Ma\n{\n\tint num,cnt;\n\tvector<int>G[N];\n\tint Dfn;\n\tint ldfn[N],rdfn[N],dfn[N];\n\tvector<pa>tr[N<<2];\n\tint Ltr[N<<2],Rtr[N<<2];\n\tpa E[N];\n\tinline init()\n\t{\n\t\tmemset(Rtr,-1,sizeof(Rtr));\n\t}\n\tinline void ad(int x,int y)\n\t{\n\t\t++cnt;\n\t\tE[cnt].fi=x,E[cnt].se=y;\n\t\tG[x].push_back(y);\n\t}\n\tvoid dfs(int k,int fa)\n\t{\n\t\t++Dfn;\n\t\tldfn[k]=dfn[k]=Dfn;\n\t\tfor (auto u:G[k])\n\t\t{\n\t\t\tdfs(u,k);\n\t\t}\n\t\trdfn[k]=Dfn;\n\t}\n\tvoid update(int k,int l,int r,int x,int y,int i)\n\t{\n\t\tif (l==r)\n\t\t{\n\t\t\ttr[k].push_back({y,i});\n\t\t\tRtr[k]=tr[k].size()-1;\n\t\t\tcnt=max(cnt,k);\n\t\t\treturn;\n\t\t}\n\t\ttr[k].push_back({y,i});\n\t\tRtr[k]=tr[k].size()-1;\n\t\tint mid=l+(r-l)/2;\n\t\tif (x<=mid) update(k<<1,l,mid,x,y,i);\n\t\telse update(k<<1|1,mid+1,r,x,y,i);\n\t}\n\tvector<int>query(int k,int l,int r,int L,int R,int val,int fh)\n\t{\n\t\tif (tr[k].empty()) return vector<int>();\n\t\tif (L<=l&&r<=R)\n\t\t{\n\t\t\tvector<int>g;\n\t\t\tif (fh==0)\n\t\t\t{\n\t\t\t\twhile (Ltr[k]<=Rtr[k])\n\t\t\t\t{\n\t\t\t\t\tif (tr[k][Rtr[k]].fi<val) break;\n\t\t\t\t\tif (!vis[num^1][tr[k][Rtr[k]].se])\n\t\t\t\t\t{\n\t\t\t\t\t\tvis[num^1][tr[k][Rtr[k]].se]=1;\n\t\t\t\t\t\tg.push_back(tr[k][Rtr[k]].se);\n\t\t\t\t\t}\n\t\t\t\t\tRtr[k]--;\n\t\t\t\t}\n\t\t\t} else\n\t\t\t{\n\t\t\t\twhile (Ltr[k]<=Rtr[k])\n\t\t\t\t{\n\t\t\t\t\tif (tr[k][Ltr[k]].fi>val) break;\n\t\t\t\t\tif (!vis[num^1][tr[k][Ltr[k]].se])\n\t\t\t\t\t{\n\t\t\t\t\t\tvis[num^1][tr[k][Ltr[k]].se]=1;\n\t\t\t\t\t\tg.push_back(tr[k][Ltr[k]].se);\n\t\t\t\t\t}\n\t\t\t\t\tLtr[k]++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn g;\n\t\t}\n\t\tint mid=l+(r-l)/2;\n\t\tif (R<=mid) return query(k<<1,l,mid,L,R,val,fh);\n\t\tif (L>mid) return query(k<<1|1,mid+1,r,L,R,val,fh);\n\t\tauto X=query(k<<1,l,mid,L,R,val,fh);\n\t\tauto Y=query(k<<1|1,mid+1,r,L,R,val,fh);\n\t\tfor (auto u:Y) X.push_back(u);\n\t\treturn X;\n\t}\n}T[2];\nsigned main()\n{\n\tn=read();\n\tfor (int i=2;i<=n;i++)\n\t{\n\t\tint x=read();\n\t\tT[0].ad(x,i);\n\t}\n\tfor (int i=2;i<=n;i++)\n\t{\n\t\tint x=read();\n\t\tT[1].ad(x,i);\n\t}\n\tT[0].dfs(1,0);\n\tT[1].dfs(1,0);\n\tT[0].init();\n\tT[1].init();\n\tT[0].num=0;\n\tT[1].num=1;\n\tst=read();\n\tS.push_back(st);\n\tfor (int now=0;now<=1;now++)\n\t{\n\t\tfor (int i=1;i<n;i++)\n\t\t{\n\t\t\tif (now==0&&i==st) continue;\n\t\t\tint x=T[now^1].dfn[T[now].E[i].fi],y=T[now^1].dfn[T[now].E[i].se];\n\t\t\tWt[now^1].push_back({y,{x,i}});\n\t\t\tWt[now^1].push_back({x,{y,i}});\n\t\t}\n\t}\n\tfor (int now=0;now<=1;now++) \n\t\tsort(Wt[now].begin(),Wt[now].end());\n\tfor (auto u:Wt[0])\n\t{\n\t\tT[0].update(1,1,n,u.se.fi,u.fi,u.se.se);\n\t}\n\tfor (auto u:Wt[1])\n\t{\n\t\tT[1].update(1,1,n,u.se.fi,u.fi,u.se.se);\n\t}\t\n\tputs(\"Blue\");\n\twriteln(st);\n\tint now=0;\n\twhile (!S.empty())\n\t{\n\t\tvector<int>G;\n\t\tfor (auto u:S)\n\t\t{\n\t\t\tvector<int>g=T[now].query(1,1,n,T[now].ldfn[T[now].E[u].se],T[now].rdfn[T[now].E[u].se],T[now].rdfn[T[now].E[u].se]+1,0);\n\t\t\tfor (auto i:g)\n\t\t\t{\n\t\t\t\tG.push_back(i);\n\t\t\t}\n\t\t\tg=T[now].query(1,1,n,T[now].ldfn[T[now].E[u].se],T[now].rdfn[T[now].E[u].se],T[now].ldfn[T[now].E[u].se]-1,1);\n\t\t\tfor (auto i:g)\n\t\t\t{\n\t\t\t\tG.push_back(i);\n\t\t\t}\n\t\t}\n\t\tS.swap(G);\n\t\tif (S.empty()) break;\n\t\tif (now==0) puts(\"Red\");\n\t\telse puts(\"Blue\"); \n\t\tsort(S.begin(),S.end());\n\t\tfor (auto u:S) writesp(u);\n\t\tputs(\"\");\n\t\tnow^=1;\n\t}\n}\n```\n",
        "postTime": 1636006490,
        "uid": 120911,
        "name": "Lynkcat",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF403E Two Rooted Trees"
    }
]