[
    {
        "content": "\u9996\u5148\u6211\u4eec\u7528 Floyd \u6c42\u51fa\u4efb\u610f\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u8bb0\u4e3a dis(i,j)\u3002\n\n\u8003\u8651 DP \u72b6\u6001\uff1a\u8bbe f(i,j) \u8868\u793a\u5728\u7b2c i \u4e2a\u70b9\u5efa\u7acb\u4fe1\u53f7\u7ad9\u4f7f\u5f97 j \u5b50\u6811\u5185\u83b7\u5f97\u4fe1\u53f7\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u5982\u679c\u6211\u4eec\u53ea\u8003\u8651 u \u70b9\u672c\u8eab\uff0c\u90a3\u4e48\u6709 f(i,u)=dis(i,u)+k\u3002\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86\u5b50\u6811 v \u7684 DP \u503c\uff1a\n\n\u5047\u8bbe v \u70b9\u4e5f\u4ece i \u7684\u4f4d\u7f6e\u83b7\u5f97\u4fe1\u53f7\uff0c\u7531\u4e8e u,v \u4e24\u70b9\u91cd\u590d\u8003\u8651\u4e86 k \u7684\u4ee3\u4ef7\uff0c\u90a3\u4e48\u5b50\u6811 v \u5bf9\u5b50\u6811 u \u7684\u8d21\u732e\u4e3a f(i,v)\u2212k\u3002\n\u5047\u8bbe v \u70b9\u4e0d\u5efa\u9020\u5728 i \u70b9\uff0c\u90a3\u4e48\u5bf9 u \u5b50\u6811\u7684\u8d21\u732e\u4e3a min1\u2264j\u2264n{f(j,v)}\u3002\u6211\u4eec\u8bb0\u4f7f\u5f97 f(i,u) \u6700\u5c0f\u7684 i \u4e3a p(u)\u3002\u90a3\u4e48\u53ef\u4ee5 O(1) \u5f97\u5230\u8d21\u732e\u503c\u3002\n\u6700\u540e\u5982\u4f55\u8ba1\u7b97\u7b54\u6848\uff1f\u6211\u4eec\u8bb0\u70b9 i \u4ece\u70b9 ans(i) \u83b7\u5f97\u4fe1\u53f7\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u6bd4\u8f83 f(p(v),v) \u548c f(ans(u),v)\u2212k \u7684\u503c\u5c31\u53ef\u4ee5\u5f97\u5230 ans(v) \u7684\u503c\u3002\u9012\u5f52\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n^3)\u3002\n```cpp\n#include <cstdio>\n#include <algorithm>\n\nconst int N = 205, M = 405;\n\nint n, k, tot, d[N], e[N][N], lnk[N], ter[M], nxt[M];\nint dis[N][N], f[N][N], p[N], ans[N];\n\nvoid add(int u, int v) {\n    ter[++tot] = v, nxt[tot] = lnk[u], lnk[u] = tot;\n}\nvoid Floyd() {\n    for (int k = 1; k <= n; ++k) {\n        for (int i = 1; i <= n; i++) {\n            for (int j = 1; j <= n; j++) {\n                dis[i][j] = std::min(dis[i][j], dis[i][k] + dis[k][j]);\n            }\n        }\n    }\n}\nvoid dfs(int u, int fa) {\n    for (int i = 1; i <= n; i++) {\n        f[i][u] = d[dis[i][u]] + k;\n    }\n    for (int i = lnk[u]; i; i = nxt[i]) {\n        int v = ter[i];\n        if (v == fa) continue;\n        dfs(v, u);\n        for (int i = 1; i <= n; i++) {\n            f[i][u] += std::min(f[p[v]][v], f[i][v] - k);\n        }\n    }\n    p[u] = 1;\n    for (int i = 1; i <= n; i++) {\n        if (f[i][u] < f[p[u]][u]) p[u] = i;\n    }\n}\nvoid getPath(int u, int fa, int pos) {\n    for (int i = lnk[u]; i; i = nxt[i]) {\n        int v = ter[i];\n        if (v == fa) continue;\n        ans[v] = (f[p[v]][v] > f[pos][v] - k ? pos : p[v]);\n        getPath(v, u, ans[v]);\n    }\n}\nint main() {\n    scanf(\"%d%d\", &n, &k);\n    for (int i = 1; i < n; i++) {\n        scanf(\"%d\", &d[i]);\n    }\n    for (int i = 1; i <= n; i++) {\n        for (int j = 1; j <= n; j++) {\n            dis[i][j] = (i == j ? 0 : 0x3f3f3f3f);\n        }\n    }\n    for (int i = 1; i < n; i++) {\n        int u, v;\n        scanf(\"%d%d\", &u, &v);\n        dis[u][v] = dis[v][u] = 1;\n        add(u, v), add(v, u);\n    }\n    Floyd();\n    dfs(1, 0);\n    printf(\"%d\\n\", f[p[1]][1]);\n    ans[1] = p[1];\n    getPath(1, 0, ans[1]);\n    for (int i = 1; i <= n; i++) {\n        printf(\"%d%c\", ans[i], \" \\n\"[i == n]);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1568534924,
        "uid": 26937,
        "name": "_soul_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF70E \u3010Information Reform\u3011"
    },
    {
        "content": "\u5e38\u89c1\u5957\u8def\uff0cfloyd+\u6811\u5f62dp\n\n\u89e3\u6cd5\uff1a\n\n1.\u5148\u8dd1\u4e00\u904dfloyd\u6c42\u51fa\u591a\u6e90\u6700\u77ed\u8def\uff08\u5176\u5b9e\u8fd9\u91cc\u662f\u6811\u4e0a\u591a\u6e90\u6700\u77ed\u8def,\u53ef\u4ee5\u7528LCA\u628a\u65f6\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u5230n^2\uff0c\u4f46\u6570\u636e\u8303\u56f4\u5c0f\uff0c\u6240\u4ee5\u6ca1\u6709\u5fc5\u8981\uff09\n\n2.\u8fdb\u884c\u6811\u5f62dp,\u4ee5f[m][i]\u8868\u793a\u5728i\u70b9\u5efa\u7acb\u4e00\u4e2a\u4e2d\u8f6c\u7ad9\u4e4b\u540em\u70b9\u4ee5\u53ca\u5b50\u6811\u5f97\u5230\u4fe1\u606f\u7684\u4ee3\u4ef7\u6700\u5c0f\u503c,ans[m]\u8868\u793a\u4f7f\u5f97f[m][i]\u6700\u5c0f\u7684i,d[i][j]\u8868\u793ai\u5230j\u7684\u8ddd\u79bb\u3002\u6240\u4ee5\u5148\u8ba9f[m][i]=a[d[m][i]]+k,\u968f\u540edp[m][i]+=min(dp[Next][ans[Next]],dp[Next][i]-k),\u5176\u4e2di\u5c5e\u4e8e[1,n]\u3002\u6700\u540e\u66f4\u65b0ans\n\n3.\u8f93\u51fa\u6700\u5c0f\u503c\u548c\u65b9\u6848\uff0c\u5982\u679c\u65b9\u6848\u6709\u591a\u79cd\uff0c\u8f93\u51fa\u4efb\u610f\u4e00\u79cd\uff0c\u5176\u4e2d\u6709spj\n\n\u6700\u540e\u8bf4\u4e00\u4e0b\u5751\u70b9\uff08\u8fd9\u4e9b\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u4f46\u662f\u6839\u636e\u7b14\u8005\u5728\u5b66\u6821\u91cc\u7ed9\u5b66\u5f1f\u4e0a\u8bfe\u7684\u5f71\u54cd\uff0c\u4e00\u8003\u6b7b\u4e00\u7247\uff09:\n\n1.\u6839\u636e\u533a\u95f4dp\u7684\u601d\u60f3\uff08\u6700\u5916\u5c42\u5faa\u73af\u662f\u533a\u95f4\u957f\u5ea6\uff09\uff0cFloyd\u7684\u6700\u5916\u5c42\u5e94\u8be5\u662f\u8f6c\u79fb\u7684\u4e2d\u95f4\u70b9\n\n2.\u5b58\u8fb9\u53ef\u4ee5\u7528\u90bb\u63a5\u77e9\u9635\uff0c\u4f46\u8bf7\u6807\u8bb0\u4e00\u4e0b\u4ece\u90a3\u4e2a\u70b9\u8f6c\u79fb\u8fc7\u6765\uff0c\u4e0d\u8981\u8d70\u56de\u5934\u8def\u5bfc\u81f4\u6b7b\u9012\u5f52\u7206\u6808\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#include<iostream>\n#include<cstdio>\n#define ll long long\nusing namespace std;\n\nll n,k,f[190][190],a[190],d[190][190],ans[190],pre[190];\nvector<ll> edge[190];\n\ninline void floyd(){\n    for(ll k=1; k<=n; k++){\n        for(ll i=1; i<=n; i++){\n            for(ll j=1; j<=n; j++){\n                d[i][j]=d[j][i]=min(d[i][j],d[i][k]+d[k][j]);\n            }\n        }\n    }\n}\n\nvoid dfs(ll m,ll before){\n    for(ll i=1; i<=n; i++) f[m][i]=a[d[m][i]]+k;//\u65b9\u7a0b1\n    for(ll i=0; i<edge[m].size(); i++){\n        ll Next=edge[m][i];\n        if(Next!=before){\n            dfs(Next,m);\n            for(ll j=1; j<=n; j++) f[m][j]+=min(f[Next][ans[Next]],f[Next][j]-k);//\u65b9\u7a0b2\n        }\n    }\n    ans[m]=1;\n    for(ll i=2; i<=n; i++){\n        if(f[m][i]<f[m][ans[m]]) ans[m]=i;//\u8bb0\u4e0b\u7ed3\u679c\n    }\n}\n\nvoid print(ll m,ll before,ll x){\n    pre[m]=x;//\u8f93\u51fa\u7684\n    for(ll i=0; i<edge[m].size(); i++){\n        ll Next=edge[m][i];\n        if(Next!=before){\n            if(f[Next][ans[Next]]<f[Next][x]-k) print(Next,m,ans[Next]);\n            else print(Next,m,x);\n        }\n    }\n}\n\nint main(){\n    cin>>n>>k;\n    for(ll i=1; i<n; i++) scanf(\"%lld\",&a[i]);\n    memset(d,0x3f,sizeof(d));\n    for(ll i=1; i<=n; i++) d[i][i]=0;\n    for(ll i=1; i<n; i++){\n        ll x,y;\n        scanf(\"%lld %lld\",&x,&y);\n        d[x][y]=d[y][x]=1;\n        edge[x].push_back(y);\n        edge[y].push_back(x);\n    }\n    floyd();//\u89e3\u6cd5\u4e00\n\n    dfs(1,0);//\u89e3\u6cd52\n    printf(\"%lld\\n\",f[1][ans[1]]);\n    print(1,0,ans[1]);//\u89e3\u6cd53\n    for(ll i=1; i<=n; i++) printf(\"%lld \",pre[i]);\n    return 0;\n}\n```",
        "postTime": 1552360907,
        "uid": 27924,
        "name": "xukuan",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF70E \u3010Information Reform\u3011"
    },
    {
        "content": "\u7528\u4e86\u4e24\u79cd\u65b9\u6cd5\uff0c\u90fdAC\u4e86\u3002\u6bd4\u8f83\u63a8\u8350\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u3002\n\n\u7b2c\u4e00\u79cd\u89e3\u6cd5\uff1a\n \n$f_{v,s}$ \u8868\u793a\u5185\u90e8\u8ddd\u79bb $v$ \u4e3a $s+$ \u5916\u90e8\u8ddd\u79bb $v \\geq x$\uff08\u82e5\u6709\uff09 \u6761\u4ef6\u4e0b\u7684\u6700\u4f18\u89e3 (\u53ef\u80fd\u4e3a\u65e0\u7a77\u5927\uff09\n \n$h_{v,s}$ \u8868\u793a\u5916\u90e8\u8ddd\u79bb $v$ \u4e3a $s+$ \u5185\u90e8\u8ddd\u79bb $v \\geq x$\uff08\u82e5\u6709\uff09 \u6761\u4ef6\u4e0b\u7684\u6700\u4f18\u89e3 (\u53ef\u80fd\u4e3a\u65e0\u7a77\u5927\uff09\n\n\u8f6c\u79fb\u65b9\u7a0b:\n1. $h_{v,s} = d_s + \\sum w_c$\n2. $f_{v,0} = k + \\sum \\min\\left (f_{c,0},h_{c,1}\\right)$\n3. $f_{v,s} = \\min\\left\\{f_{v,s},d_s + f_{c,s-1} + \\left(\\sum w_c\\right) - w_{c'}\\right\\}$\n\n\u4e0b\u6807 $c$ \u8868\u793a $v$ \u7684\u513f\u5b50\u3002 $w_c = \\min\\left\\{\\min\\left\\{f_{c,s-1}, f_{c,s}\\right\\},h_{c,s+1}\\right\\}$\n\n\u590d\u6742\u5ea6\u4e3a\uff1a $\\Theta\\left(sum_v \\times sum_s \\times sum_c\\right) = \\Theta\\left(sum_s \\times sum_v \\times sum_c\\right) = \\Theta\\left(sum_s \\times n \\right) = \\Theta(n^2)$\n\n## Code\n```cpp\n#include <iostream>\n#include <vector>\nusing namespace std;\n\nconst int maxint = 100000000;\nint n, k, d[200];\nvector<int> neighbors[200];\nint f[200][200], arg[200][200], h[200][200];\nint w[200], ans[200];\n\nvoid DFS(int v, int father){\n\tf[v][0] = k;\n\tfor (int c : neighbors[v])\n\t\tif (c != father){\n\t\t\tDFS(c, v);\n\t\t\tf[v][0] += min(f[c][0], h[c][1]);\n\t\t}\n\tfor (int s = 1; s < n; s++){\n\t\tf[v][s] = h[v][s] = maxint;\n\t\tint W = 0, bc = 0;\n\t\tfor (int c : neighbors[v])\n\t\t\tif (c != father){\n\t\t\t\tw[c] = min(min(f[c][s], f[c][s-1]), h[c][s+1]);\n\t\t\t\tif (w[c] == maxint) bc ++;\u00a0\n\t\t\t\tW += w[c];\n\t\t\t}\n\t\tif (bc == 0) h[v][s] = d[s] + W;\n\t\tif (bc <= 1)\n\t\t\tfor (int c : neighbors[v])\n\t\t\t\tif (c != father && (bc == 0 || w[c] == maxint))\n\t\t\t\t\tif (d[s] + f[c][s-1] + W - w[c] < f[v][s]){\n\t\t\t\t\t\tf[v][s] = d[s] + f[c][s-1] + W - w[c];\n\t\t\t\t\t\targ[v][s] = c;\n\t\t\t\t\t}\n\t}\n}\n\nvoid getAnsh(int v, int father, int s, int center);\n\nvoid getAnsf(int v, int father, int s){\u00a0\n\tif (s == 0){\n\t\tans[v] = v;\n\t\tfor (int c : neighbors[v])\n\t\t\tif (c != father){\n\t\t\t\tif (f[c][0] < h[c][1]) getAnsf(c, v, 0);\n\t\t\t\telse getAnsh(c, v, 1, v);\n\t\t\t}\n\t\treturn;\n\t}\n\tgetAnsf(arg[v][s], v, s-1);\n\tans[v] = ans[arg[v][s]];\n\tfor (int c : neighbors[v])\n\t\tif (c != father && c != arg[v][s])\n\t\t\tif (h[c][s+1] < min(f[c][s], f[c][s-1]))\n\t\t\t\tgetAnsh(c, v, s+1, ans[v]);\n\t\t\telse if (f[c][s-1] < f[c][s])\n\t\t\t\tgetAnsf(c, v, s-1);\n\t\t\telse getAnsf(c, v, s);\n}\n\nvoid getAnsh(int v, int father, int s, int center){\n\tans[v] = center;\n\tfor (int c : neighbors[v])\n\t\tif (c != father)\n\t\t\tif (h[c][s+1] < min(f[c][s], f[c][s-1]))\n\t\t\t\tgetAnsh(c, v, s+1, center);\n\t\t\telse if (f[c][s-1] < f[c][s])\n\t\t\t\tgetAnsf(c, v, s-1);\n\t\t\telse getAnsf(c, v, s);\n}\n\nint main(){\n\tcin >> n >> k;\n\tfor (int i = 1; i < n; i++) cin >> d[i];\n\tfor (int i = 1; i < n; i++){\n\t\tint a, b;\n\t\tcin >> a >> b;\n\t\tneighbors[a].push_back(b);\n\t\tneighbors[b].push_back(a);\n\t}\n\tDFS(1, 0);\n\tint ss = 0;\n\tfor (int s = 1; s < n; s++)\u00a0\n\t\tif (f[1][s] < f[1][ss]) ss = s;\n\tcout << f[1][ss] << endl;\n\tgetAnsf(1, 0, ss);\t\n\tfor (int i = 1; i <= n; i++) cout << ans[i] << ' ';\n\treturn 0;\n}\n```\n\n\u7b2c\u4e8c\u79cd\u89e3\u6cd5\uff08\u6bd4\u7b2c\u4e00\u79cd\u7b80\u5355\u70b9\uff09\uff1a\n\n$f_{v,s}$ \u8868\u793a\u4fdd\u8bc1\u5185\u90e8\u8ddd\u79bb $v \\leq s$ \u6761\u4ef6\u4e0b\u7684\u6700\u4f18\u89e3 (\u53ef\u80fd\u4e3a\u65e0\u7a77\u5927\uff09\n\n$g_{v,s}$ \u8868\u793a\u5df2\u77e5\u5916\u90e8\u8ddd\u79bb $v$ \u4e3a $s$ \uff0c\u6761\u4ef6\u4e0b\u7684\u6700\u4f18\u89e3 (\u5185\u90e8\u53ef\u4ee5\u968f\u610f\uff09\n\n\u8f6c\u79fb\u65b9\u7a0b:\n\n1. $f_{v,0} = k + \\sum g_{c,1}$\n2. $g_{v,s} = \\min\\left\\{f_{v,s}, d_s + \\sum g_{c,s+1}\\right\\}$\n3. $f_{v,s} = \\min\\left\\{f_{v,s-1}, \\min\\left\\{f_{v,s},d_s + f_{c,s-1} + \\sum g_{c,s+1} - g_{c',s+1}\\right\\}\\right\\}$\n\n## Code\n```cpp\n#include <iostream>\n#include <vector>\nusing namespace std;\n\nconst int maxint = 100000000;\nint n, k, d[200];\nvector<int> neighbors[200];\nint F[200][200], arg[200][200], g[200][200];\nint ans[200];\n\nvoid DFS(int v, int father){\n\tF[v][0] = k;\n\tfor (int c : neighbors[v])\n\t\tif (c != father){\n\t\t\tDFS(c, v);\n\t\t\tF[v][0] += g[c][1];\n\t\t}\n\tint ss = 0;\n\tfor (int s = 1; s < n; s++){\n\t\tF[v][s] = g[v][s] = maxint;\n\t\tint W = 0, bc = 0;\n\t\tfor (int c : neighbors[v])\n\t\t\tif (c != father){\n\t\t\t\tif (g[c][s+1] == maxint) bc++;\u00a0\n\t\t\t\tW += g[c][s+1];\n\t\t\t}\n\t\tif (bc == 0) g[v][s] = d[s] + W;\n\t\tif (bc <= 1)\n\t\t\tfor (int c : neighbors[v])\n\t\t\t\tif (c != father && (bc == 0 || g[c][s+1] == maxint))\n\t\t\t\t\tif (d[s] + F[c][s-1] + W - g[c][s+1] < F[v][s]){\n\t\t\t\t\t\tF[v][s] = d[s] + F[c][s-1] + W - g[c][s+1];\n\t\t\t\t\t\targ[v][s] = c;\n\t\t\t\t\t}\n\t\tif (F[v][ss] <= F[v][s]){\n\t\t\tF[v][s] = F[v][ss];\n\t\t\targ[v][s] = ss;\n\t\t}\n\t\telse ss = s;\n\t\tif (F[v][s]<g[v][s]) g[v][s] = F[v][s];\n\t}\n\tg[v][n] = maxint;\n}\n\nvoid getAnsg(int v, int father, int s, int center);\n\nvoid getAnsF(int v, int father, int s){\n\tif (s > 0 && F[v][s] == F[v][s-1]) s = arg[v][s];\n\tif (s == 0){\n\t\tans[v] = v;\n\t\tfor (int c : neighbors[v])\n\t\t\tif (c != father) getAnsg(c, v, 1, v);\n\t\treturn;\n\t}\n\tgetAnsF(arg[v][s], v, s-1);\n\tans[v] = ans[arg[v][s]];\n\tfor (int c : neighbors[v])\n\t\tif (c != father && c != arg[v][s])\n\t\t\tgetAnsg(c, v, s+1, ans[v]);\n}\n\nvoid getAnsg(int v, int father, int s, int center){\n\tif (g[v][s] == F[v][s]) getAnsF(v, father, s);\n\telse{\n\t\tans[v] = center;\n\t\tfor (int c : neighbors[v])\n\t\t\tif (c != father)\n\t\t\t\tgetAnsg(c, v, s+1, ans[v]);\t\t\t\n\t}\n}\n\nint main(){\n\tcin >> n >> k;\n\tfor (int i = 1; i < n; i++) cin >> d[i];\n\tfor (int i = 1; i < n; i++){\n\t\tint a, b;\n\t\tcin >> a >> b;\n\t\tneighbors[a].push_back(b);\n\t\tneighbors[b].push_back(a);\n\t}\n\tDFS(1, 0);\n\tcout << F[1][n-1] << endl;\n\tgetAnsF(1, 0, n-1);\t\n\tfor (int i = 1; i <= n; i++) cout << ans[i] << ' ';\n\treturn 0;\n}\n```",
        "postTime": 1644339222,
        "uid": 384366,
        "name": "Gin101",
        "ccfLevel": 5,
        "title": "CF70E \u9898\u89e3"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://codeforces.com/contest/70/problem/E)\n\n\u611f\u89c9 CF \u548c\u6d1b\u8c37\u4e0a\u7684\u8bc4\u5206\u90fd\u865a\u9ad8\uff0c\u5b9e\u9645\u5e94\u8be5 2500* \u7d2b\u5de6\u53f3\uff1f\n\nETHANK\uff1a\u201c\u8fd9\u4e5f\u592a\u6c34\u4e86\u5427\u201d\n\n\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u68f5 $n$ \u70b9\u6811\uff0c\u53ef\u4ee5\u4ee4\u4efb\u610f\u8282\u70b9\uff08\u81f3\u5c11\u4e00\u4e2a\uff09\u4e3a\u5173\u952e\u8282\u70b9\uff0c\u6bcf\u591a\u4e00\u4e2a\u5173\u952e\u8282\u70b9\u5c31\u8981\u4ed8\u51fa $k$ \u7684\u4ee3\u4ef7\u3002\u975e\u5173\u952e\u8282\u70b9\u7684\u4ee3\u4ef7\u662f $d_{dis}$. \u5176\u4e2d $dis$ \u662f\u8be5\u8282\u70b9\u79bb\u6700\u8fd1\u5173\u952e\u8282\u70b9\u7684\u8ddd\u79bb\u3002\u6700\u5c0f\u5316\u603b\u4ee3\u4ef7\u3002$n \\le 180$. **\u4fdd\u8bc1 $d$ \u5355\u8c03\u4e0d\u964d**\n\n\u770b\u5230\u9898\u9762\u5bb9\u6613\u60f3\u5230\u6811\u5f62 dp\uff0c\u4f46\u662f\u6211\u4eec\u4e0d\u4f1a\u8bbe\u8ba1\u72b6\u6001\u3002\n\n\u6ce8\u610f\u5230 $d$ \u662f\u5355\u8c03\u4e0d\u964d\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u4e00\u4e2a\u70b9\u4e00\u5b9a\u4f1a\u53bb\u627e\u79bb\u4ed6\u6700\u8fd1\u7684\u5173\u952e\u8282\u70b9\u3002\u56e0\u6b64\u6211\u4eec\u5f97\u5230\u4e00\u4e2a\u6781\u5176\u91cd\u8981\u7684\u5f15\u7406\uff1a\n\n\u8bbe $t_i$ \u662f\u8ddd\u79bb\u8282\u70b9 $i$  \u6700\u8fd1\u7684\u5173\u952e\u8282\u70b9\u3002\u7279\u6b8a\u5730\uff0c$i$ \u4e3a\u5173\u952e\u8282\u70b9\u65f6 $t_i=i$. \u5219\u5bf9\u4e8e\u6811\u4e0a\u4e24\u70b9 $(u,v)$\uff0c\u82e5 $t_u=t_v=k$\uff0c\u90a3\u4e48\u6240\u6709\u5728 $(u,v)$ \u8def\u5f84\u4e0a\u7684\u70b9 $w$ \u90fd\u6ee1\u8db3 $t_w=k$.\n\n\u8bc1\u660e\uff1a\n\n\u5047\u8bbe $t_w=k'\\neq k$\n\n\u6ce8\u610f\u5230\u4e0d\u7ba1 $k$ \u53d6\u54ea\u4e2a\u70b9\uff0c$u,v$ \u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u70b9\u5230 $k$ \u7684\u8def\u5f84\u662f\u8981\u7ecf\u8fc7 $w$ \u7684\u3002\n\n\u4e0d\u59a8\u8bbe $u$ \u5230 $k$ \u7ecf\u8fc7 $w$. \u65e2\u7136\u4ece $w$ \u51fa\u53d1\u6700\u8fd1\u7684\u5173\u952e\u8282\u70b9\u662f $k'$\uff0c\u90a3\u4e48 $u\\rightarrow w \\rightarrow k'$ \u663e\u7136\u6bd4 $u \\rightarrow w \\rightarrow k$ \u6765\u7684\u8fd1\uff0c\u4e0e $t_u=k$ \u77db\u76fe\u3002\u56e0\u6b64\u5047\u8bbe\u4e0d\u6210\u7acb\u3002\n\n\u597d\uff0c\u90a3\u4e48\u65e2\u7136\u5bf9\u5e94\u5173\u952e\u8282\u70b9\u4e5f\u5f62\u6210\u4e00\u4e2a\u8fde\u901a\u5757\u7684\u5f62\u5f0f\uff0c\u5c31\u5f88\u5bb9\u6613\u60f3\u5230\u8bbe $f(u,j)$ \u4e3a $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c$t_u=j$ \u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u6ce8\u610f\u8fd9\u91cc $j$ \u4e0d\u4e00\u5b9a\u8981\u5728 $u$ \u5b50\u6811\u4e2d\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e $v \\in son(u)$ \u6211\u4eec\u8003\u8651\u8f6c\u79fb\uff0c\u663e\u7136\uff0c\u5982\u679c $t_v \\neq j$ \u5219\u6574\u9897\u5b50\u6811\u4e0d\u9700\u8981\u518d\u8003\u8651\u5173\u952e\u8282\u70b9 $j$ \u4e86\uff0c\u5982\u679c $t_v=j$\uff0c\u5219\u6211\u4eec\u5728\u5b50\u6811\u4e2d\u591a\u5efa\u7acb\u4e86\u4e00\u6b21 $j$\uff0c\u5e94\u8be5\u51cf\u53bb $k$. \u5373\uff1a\n$$\nf(u,j)=\\min\\{f(u,j)+f(v,k)\\} | k \\neq j\n$$\n\u8fd8\u8981\u8003\u8651\n$$\nf(u,j)=\\min\\{f(u,j)+f(v,j)-k\\}\n$$\n\u8003\u8651\u8fd9\u4e2a\u590d\u6742\u5ea6\u662f $O(n^4)$ \u7684\u3002\u4f46\u662f\u5176\u5b9e\u6ca1\u5fc5\u8981\u533a\u5206 $k$ \u662f\u5426\u7b49\u4e8e $j$\uff0c\u76f4\u63a5\u8bb0\u5f55\u4ee4 $f(v)$ \u53d6\u5230\u6700\u5c0f\u503c\u7684 $k$ \u8bb0\u4f5c $g(v)$ \u7136\u540e\u628a $f(v,g(v))$ \u548c $f(v,j)-k$ \u6bd4\u8f83\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\uff0c\u590d\u6742\u5ea6\u5c31\u53d8\u6210\u4e86 $O(n^3)$.\n\n\u7136\u540e\u8003\u8651\u8f93\u51fa\u65b9\u6848\u3002\n\n\u663e\u7136\u6211\u4eec\u5f97\u5230\u4e86 $g(u)$ \u5373\u6839\u7684\u51b3\u7b56\u70b9\uff0c\u90a3\u5c31\u9006\u8fc7\u6765\u8003\u8651\uff0c\u5bf9\u4e8e $v \\in son(u)$\uff0c\u6bd4\u8f83 $f(v,g(u))-k$ \u548c $f(v,g(v))$ \u5f97\u5230 $v$ \u7684\u51b3\u7b56\u70b9\u7136\u540e\u9012\u5f52\u8fd9\u4e2a\u8fc7\u7a0b\u5373\u53ef\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^3)$.\n\n```C++\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(ll i=(a);i<=(b);i++)\n#define per(i,a,b) for(ll i=(a);i>=(b);i--)\n#define op(x) ((x&1)?x+1:x-1)\n#define odd(x) (x&1)\n#define even(x) (!odd(x))\n#define lc(x) (x<<1)\n#define rc(x) (lc(x)|1)\n#define lowbit(x) (x&-x)\n#define Max(a,b) (a>b?a:b)\n#define Min(a,b) (a<b?a:b)\n#define next Cry_For_theMoon\n#define il inline\n#define pb(x) push_back(x)\n#define is(x) insert(x)\n#define sit set<int>::iterator\n#define mapit map<int,int>::iterator\n#define pi pair<int,int>\n#define ppi pair<int,pi>\n#define pp pair<pi,pi>\n#define fr first\n#define se second\n#define vit vector<int>::iterator\n#define mp(x,y) make_pair(x,y)\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef unsigned int uint;\ntypedef double db;\nusing namespace std;\nconst int MAXN=185;\nconst ll INF=1e16; \nvector<int>e[MAXN];\nint n,k,d[MAXN],u,v;\nll f[MAXN][MAXN],g[MAXN],fa[MAXN]; //g(i)\u4ee3\u8868\u4ee4f(i,j)\u53d6\u5f97\u6700\u5c0f\u503c\u7684j\nll dis[MAXN][MAXN];\nll sol[MAXN];\nvoid dp(int u){\n\tfor(vit it=e[u].begin();it!=e[u].end();it++){\n\t\tint v=*it;\n\t\tif(v==fa[u])continue;\n\t\tfa[v]=u;dp(v);\n\t}\n\trep(j,0,n)f[u][j]=INF;g[u]=0;\n\trep(j,1,n){f[u][j]=k+d[dis[u][j]];}\n\tfor(vit it=e[u].begin();it!=e[u].end();it++){\n\t\tint v=*it;\n\t\tif(v==fa[u])continue;\n\t\trep(j,1,n){\n\t\t\tint K=g[v]; //v\u7684\u51b3\u7b56\u70b9\n\t\t\tf[u][j]+=Min(f[v][j]-k,f[v][K]);\n\t\t}\n\t}\n\trep(j,1,n){\n\t\tif(f[u][j]<f[u][g[u]])g[u]=j;\n\t}\n}\nvoid solve(ll u){\n\t//\u77e5\u9053\u4e86fa[u]\u7684\u51b3\u7b56\uff0c\u627e\u5230u\u7684\u51b3\u7b56\n\tint K=g[u];\n\tif(f[u][sol[fa[u]]]-k < f[u][K]){\n\t\tsol[u]=sol[fa[u]];\n\t}else sol[u]=K;\n\tfor(vit it=e[u].begin();it!=e[u].end();it++){\n\t\tint v=*it;if(v==fa[u])continue;\n\t\tsolve(v);\n\t}\n}\nint main(){\n\tscanf(\"%d%d\",&n,&k);\n\trep(i,1,n)rep(j,1,n)if(i!=j)dis[i][j]=INF;\n\trep(i,1,n-1)scanf(\"%d\",&d[i]);\n\trep(i,1,n-1){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\te[u].pb(v);e[v].pb(u);\n\t\tdis[u][v]=dis[v][u]=1;\n\t}\n\trep(k,1,n)rep(i,1,n)rep(j,1,n)dis[i][j]=Min(dis[i][j],dis[i][k]+dis[k][j]);\n\tdp(1);\n\tll k=g[1];\n\tprintf(\"%lld\\n\",f[1][k]);\n\tsol[1]=k;\n\tfor(vit it=e[1].begin();it!=e[1].end();it++){\n\t\tint v=*it;\n\t\tsolve(v);\n\t} \n\trep(i,1,n){\n\t\tprintf(\"%lld \",sol[i]);\n\t}\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1625749522,
        "uid": 340632,
        "name": "Cry_For_theMoon",
        "ccfLevel": 8,
        "title": "\u3010CF70E\u3011Information Reform"
    }
]