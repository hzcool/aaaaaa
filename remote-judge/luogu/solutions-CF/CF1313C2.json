[
    {
        "content": "\u6709C1\u548cC2\u3002\n\n\u552f\u4e00\u7684\u5dee\u522b\u662f $n$ \u7684\u53d6\u503c\u3002\n\n\u89c2\u5bdf\u6027\u8d28\u53ef\u4ee5\u53d1\u73b0\u8981\u6ee1\u8db3\u6761\u4ef6\u5fc5\u5b9a\u6709\u4e00\u4e2a\u6700\u9ad8\u70b9\uff0c\u4f7f\u5f97\u4ece\u5de6\u8fb9\u5230\u6700\u9ad8\u70b9\u9ad8\u5ea6\u5355\u8c03\u4e0d\u9012\u51cf\uff0c\u4ece\u53f3\u8fb9\u5230\u6700\u9ad8\u70b9\u9ad8\u5ea6\u5355\u8c03\u4e0d\u9012\u51cf\u3002\n\nC1\u7684\u505a\u6cd5\u53ef\u4ee5\u662f\u679a\u4e3e\u6700\u9ad8\u70b9\uff0c\u8ba1\u7b97\u6700\u4f18\u7b54\u6848\u3002\n\n\u505a\u6cd5\u662f $O(n^2)$ \u7684\u3002\n\n\u8003\u8651\u4f18\u5316\u627e\u6700\u9ad8\u70b9\u8fd9\u4e00\u4e2a\u8fc7\u7a0b\u3002\n\n\u7528\u6570\u7ec4 $l_i,r_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6700\u9ad8\u70b9\u65f6\uff0c\u5411\u5de6\u548c\u5411\u53f3\u7684\u9ad8\u5ea6\u548c\u3002\n\n\u90a3\u4e48\u6c42\u51fa\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $l_i,r_i$ \u603b\u9ad8\u5ea6\u5c31\u662f $(l_i+r_i-a_i)$\uff0c\u6c42 $max (l_i+r_i-a_i)$ \u5c31\u53ef\u4ee5\u8ba1\u7b97\u7b54\u6848\u4e86\u3002\n\n\u800c\u6c42\u51fa $l_i,r_i$ \u8fc7\u7a0b\u7528\u5355\u8c03\u6808\u5b9e\u73b0\u53ef\u4ee5\u505a\u5230 $O(n)$\u3002\n\n\u5faa\u73af\u4e00\u6b21 $1->n$ \uff0c \u6bd4 $a_i$ \u5c0f\u7684\u6700\u53f3\u7684\u70b9\u8bb0\u505a $j$\uff0c\u90a3\u4e48 $l_i$ $=$ $l_j$ $+$ $a_i*(i-j)$\u3002\n\n\u540c\u7406\u53ef\u5012\u5e8f\u6c42 $r_i$\u3002\n\n\u90e8\u5206\u4ee3\u7801\uff1a\n```cpp\n\tfor(ri i=1;i<=n;++i)\n\t{\n\t\twhile(top&&a[s[top]]>a[i]) top--;\n\t\tint now=s[top];\n\t\tl[i]=l[now]+a[i]*(i-now);\n\t\ts[++top]=i;\n\t}\n\twhile(top) top--;\n\ts[++top]=n+1;\n\tfor(ri i=n;i>=1;--i)\n\t{\n\t\twhile(top&&a[s[top]]>a[i]) top--;\n\t\tint now=s[top];\n\t\tr[i]=r[now]+a[i]*(now-i);\n\t\ts[++top]=i;\n\t}\n```\n\u6c42\u51fa\u4e86\u5cf0\u503c\u6240\u5728\uff0c\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u6c42\u51fa\u7b54\u6848\u6570\u7ec4\u4e86\u3002\n\n\u522b\u5fd8\u4e86\u5f00 long long\uff01\n\ncode\uff1a\n```cpp\n#include\u201cbits/stdc++.h\u201d\nusing namespace std\uff1b\n#define ll long long\n#define ul unsigned long long\n#define ui unsigned int\ndefine ri register int\ninline ll read(){\n\tll x=0,flag=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-') flag=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+(ch^48);ch=getchar();}\n\treturn x*flag;\n}\nll a[500010],l[500010],r[500010],s[500010],top;\nint main()\n{\n\tint n=read();\n\tfor(ri i=1;i<=n;++i)\n\ta[i]=read()\uff1b\n\tfor(ri i=1\uff1bi<=n;++i)\n\t{\n\t\twhile(top&&a[s[top]]>a[i]) top--;\n\t\tint now=s[top];\n\t\tl[i]=l[now]+a[i]*(i-now);\n\t\ts[++top]=i;\n\t}\n\twhile(top) top--;\n\ts[++top]=n+1\uff1b\n\tfor(ri i=n;i>=1;--i)\n\t{\n\t\twhile(top&&a[s[top]]>a[i]) top--;\n\t\tint now=s[top];\n\t\tr[i]=r[now]+a[i]*(now-i);\n\t\ts[++top]=i;\n\t}\n\tll maxn=0,pos=0;\n\tfor(ri i=1;i<=n;++i)\n\t{\n\t\tif(l[i]+r[i]-a[i]>maxn)\n\t\t{\n\t\t\tpos=i;\n\t\t\tmaxn=l[i]+r[i]-a[i];\n\t\t}\n\t}\n\tint pre=a[pos];\n\tfor(ri i=pos;i;--i)\n\t{\n\t\tif(a[i]>pre) a[i]=pre;\n\t\tpre=a[i];\n\t}\n\tpre=a[pos];\n\tfor(ri i=pos;i<=n;++i)\n\t{\n\t\tif(a[i]>pre) a[i]=pre;\n\t\tpre=a[i];\n\t}\n\tfor(ri i=1;i<=n;++i)\n\tprintf(\"%lld \",a[i]);\n    return0;\n}\n```\n",
        "postTime": 1582735167,
        "uid": 135839,
        "name": "Fairicle",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u5e8f\u5217 $a$ \u9700\u8981\u6784\u9020\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u5e8f\u5217 $h$ \u4f7f\u5f97 $\\forall i \\in \\{1,2,\\ldots ,N\\} h_i \\leq a_i$ \u4e14 $\\forall i \\in \\{2,3,\\ldots ,N-1\\}$,$\\nexists  \\forall j \\in \\{1,2,\\ldots ,i-1\\},k \\in \\{i+1,i+2 \\ldots N\\},h_j > h_i < h_k$,\u6c42\u51fa\u5e76\u8f93\u51fa $\\sum_{i=1}^{N}h_i$ \u8fbe\u5230\u6700\u5927\u503c\u65f6\u7684 $h$ \u5e8f\u5217.\n\n\u518d\u7b80\u5316\u4e00\u4e0b\u9898\u610f,\u5c31\u662f\u9700\u8981\u627e\u51fa\u4e00\u4e2a\u5e8f\u5217 $h$,$h_i\\leq a_i$,\u4e14\u4ee5 $h$ \u4e2d\u7684\u67d0\u4e00\u4e2a\u5143\u7d20\u770b\u6765,\u524d\u9762\u548c\u540e\u9762\u7684\u5143\u7d20\u90fd\u662f\u5355\u8c03\u7684.\n\n\u672c\u9898\u5728\u6570\u636e\u8303\u56f4\u4e0a\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206,\u6240\u4ee5\u5c31\u5199\u4e00\u4e0b\u4e24\u79cd\u4e0d\u540c\u7684\u505a\u6cd5.\n\n# Part 1\n\n## \u5206\u6790\n\n$N$ \u7684\u8303\u56f4\u4e0d\u5927,\u53ea\u6709 $1000$ \u4e8e\u662f\u5f88\u5bb9\u6613\u60f3\u5230\u65f6\u95f4\u590d\u6742\u5ea6\u5e94\u8be5\u662f $O(N^2)$ \u7684,\u53ef\u4ee5\u60f3\u5230\u5148\u679a\u4e3e\u6700\u9ad8\u7684\u4f4d\u7f6e\u7684\u70b9,\u5728\u5411\u4e24\u8fb9\u8ba1\u7b97,\u53ef\u4ee5\u5f88\u5bb9\u6613\u60f3\u5230\u6700\u9ad8\u4f4d\u7f6e\u7684 $h_i=a_i$ \u800c\u4e14\u5f53\u6700\u9ad8\u4f4d\u7f6e\u786e\u5b9a\u4ee5\u540e,\u4e3a\u4e86\u4f7f\u5f97\u548c\u6700\u5927,\u6240\u4ee5\u6574\u4e00\u4e2a\u5e8f\u5217\u4e5f\u662f\u786e\u5b9a\u7684,\u90a3\u4e48\u5c31\u53ef\u4ee5\u60f3\u51fa\u6700\u5f00\u59cb\u7684 $O(N^2)$ \u7684\u505a\u6cd5\u4e86\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REP(i,first,last) for(int i=first;i<=last;++i)\n#define DOW(i,first,last) for(int i=first;i>=last;--i)\nusing namespace std;\nint N,h[114514];\nint top;\nlong long ans[114514];\nint main()\n{\n\tscanf(\"%d\",&N);\n\tREP(i,1,N)\n\t{\n\t\tscanf(\"%d\",&h[i]);\n\t}\n\tint now;\n\tlong long answer=0;\n\tlong long sum;\n\tREP(i,1,N)//\u679a\u4e3e\u6700\u9ad8\u7684\u4f4d\u7f6e\n\t{\n\t\tnow=h[i];//\u8bb0\u5f55\u5f53\u524d\u7684\u4f4d\u7f6e\n\t\tsum=h[i];\n\t\tDOW(j,i-1,1)//\u5411\u524d\u626b\n\t\t{\n\t\t\tsum+=min(h[j],now);\n\t\t\tnow=min(h[j],now);//\u8fd9\u91cc\u7684now\u56e0\u4e3a\u8981\u4fdd\u8bc1\u5355\u8c03\u4e0d\u4e0b\u964d,\u6240\u4ee5\u9700\u8981\u4e00\u76f4\u53d6min\n\t\t}\n\t\tnow=h[i];//\u5411\u540e\u626b\u540c\u7406\n\t\tREP(j,i+1,N)\n\t\t{\n\t\t\tsum+=min(h[j],now);\n\t\t\tnow=min(h[j],now);\n\t\t}\n\t\tif(sum>answer)//\u8bb0\u5f55\u4e0b\u6700\u5927\u503c,\u4ee5\u53ca\u6700\u5927\u503c\u65f6\u65f6\u54ea\u4e00\u4e2a\u4f4d\u7f6e\u8fbe\u5230\u6700\u5927\u503c\u4e86\n\t\t{\n\t\t\tanswer=sum;\n\t\t\ttop=i;\n\t\t}\n\t}\n\t//\u6700\u540e\u53ea\u9700\u8981\u5c06\u8fbe\u5230\u6700\u5927\u503c\u65f6\u7684\u5e8f\u5217\u8f93\u51fa\u5c31\u597d\u4e86\n\tans[top]=h[top];\n\tnow=h[top];\n\tDOW(i,top-1,1)\n\t{\n\t\tans[i]=min(h[i],now);\n\t\tnow=min(h[i],now);\n\t}\n\tnow=h[top];\n\tREP(i,top+1,N)\n\t{\n\t\tans[i]=min(h[i],now);\n\t\tnow=min(h[i],now);\n\t}\n\tREP(i,1,N)\n\t{\n\t\tprintf(\"%d \",ans[i]);\n\t}\n\treturn 0;\n}\n```\n\n# Part 2\n\n## \u5206\u6790\n\n$N$ \u7684\u8303\u56f4\u53d8\u5927\u4e86\u5f88\u591a\u8fbe\u5230\u4e86 $500000$ \u4e3a\u4e86\u9632\u6b62\u9898\u89e3\u6e05\u4e00\u8272\u7684\u90fd\u662f\u5355\u8c03\u6808,\u8fd9\u91cc\u662f\u4e00\u79cd\u4e0d\u662f\u5f88\u5e38\u89c1\u7684\u505a\u6cd5.\n\n\u53ef\u4ee5\u53d1\u73b0\u5728\u7b2c\u4e00\u79cd\u65b9\u6cd5\u4e2d\u5982\u679c $j \\leq i,h_j \\leq h_i$ \u65f6 $1$ \u5230 $j$ \u7684\u6700\u5927\u503c\u80af\u5b9a\u662f\u88ab\u8ba1\u7b97\u8fc7\u7684,\u4e8e\u662f\u5c31\u53ef\u4ee5\u60f3\u5230\u7528\u4e00\u4e2a\u6570\u7ec4 $L$ \u7ef4\u62a4\u4ece $1$ \u5f00\u59cb\u5e26\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u65f6\u6700\u9ad8\u5904\u4e3a $i$ \u5207 $h_1$ \u5230 $h_i$ \u4e3a\u5355\u8c03\u4e0d\u4e0b\u964d\u65f6 $h_1$ \u5230 $h_i$ \u548c\u7684\u6700\u5927\u503c,\u8ba1\u7b97\u8fd9\u4e2a\u6570\u7ec4\u9700\u8981\u5206\u4e24\u79cd\u60c5\u51b5.\n\n1. \u7b2c\u4e00\u79cd\u60c5\u51b5\u65f6 $a_{i-1} \\leq a_i$,\u8fd9\u6837 $L_i=L_{i-1}+a_i$.\n2. \u7b2c\u4e8c\u79cd\u60c5\u51b5\u5c31\u6bd4\u8f83\u7279\u6b8a\u4e86,\u6ca1\u6cd5\u76f4\u63a5\u4ece $L_{i-1}$ \u8ba1\u7b97\u51fa\u6765,\u9700\u8981\u627e\u5230\u4e0a\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e $a_i$ \u7684\u4f4d\u7f6e $j$,\u90a3\u4e48 $L_i=(j-i)*a_i+L_j$,\u5373\u5728\u8fd9\u4e4b\u95f4\u7684\u5927\u4e8e $a_i$ \u7684\u4f4d\u7f6e\u7684\u9ad8\u5ea6\u90fd\u662f $a_i$ \u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u662f\u5355\u8c03\u4e0d\u4e0b\u964d.\n\n\u4e8e\u662f\u5c31\u8981\u60f3\u529e\u6cd5\u627e\u5230\u4e0a\u4e00\u4e2a\u5c0f\u4e8e $a_i$ \u7684\u4f4d\u7f6e,\u663e\u7136\u4e0d\u53ef\u4ee5\u7528 $O(N)$ \u7684\u505a\u6cd5,\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6700\u5c0f\u503c,\u5728\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u627e\u5230\u4e0a\u4e00\u4e2a\u4f4d\u7f6e.\n\n\u7528\u540c\u6837\u7684\u65b9\u6cd5\u8ba1\u7b97\u51fa\u4e00\u4e2a\u6570\u7ec4 $R$(\u5373\u4ece $h_i$ \u5f00\u59cb\u5230 $h_N$ \u4e2d\u5355\u8c03\u4e0d\u4e0a\u5347\u7684\u548c\u7684\u6700\u5927\u503c)\u4e0e $L$ \u540c\u7406,\u8fd9\u6837\u4ee5\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u4e3a\u6700\u9ad8\u503c\u65f6\u603b\u548c\u5c31\u53d8\u6210\u4e86 $L_i+R_i-a_i$ \u53d6\u51fa\u6700\u5927\u503c\u4ee5\u540e\u53ea\u8981\u50cf\u65b9\u6cd5\u4e00\u4e00\u6837\u8f93\u51fa\u5c31\u597d\u4e86.\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REP(i,first,last) for(int i=first;i<=last;++i)\n#define DOW(i,first,last) for(int i=first;i>=last;--i)\nusing namespace std;\nconst int MAXN=6e5+7;\nint N,M;\nint arr[MAXN];\nlong long L[MAXN],R[MAXN];\nint ans[MAXN];\n//\u7ebf\u6bb5\u6811\u90e8\u5206,\u4e0d\u591a\u8bb2\nstruct SegmentTree\n{\n\tint min;\n}sgt[MAXN*4];\n#define LSON (now<<1)\n#define RSON (now<<1|1)\n#define MIDDLE ((left+right)>>1)\n#define LEFT LSON,left,MIDDLE\n#define RIGHT RSON,MIDDLE+1,right\nvoid PushUp(int now)\n{\n\tsgt[now].min=min(sgt[LSON].min,sgt[RSON].min);\n}\nvoid Build(int now=1,int left=1,int right=N)\n{\n\tif(left==right)\n\t{\n\t\tsgt[now].min=arr[left];\n\t\treturn;\n\t}\n\tBuild(LEFT);\n\tBuild(RIGHT);\n\tPushUp(now);\n}\nint QueryL(int l,int r,int num,int now=1,int left=1,int right=N)//\u67e5\u8be2\u4e0b\u4e00\u4e2a\u5c0f\u4e8enum\u7684\u503c\u7684\u4f4d\u7f6e\n{\n\tif(r<left||right<l)return -1;\n\tif(sgt[now].min>num)\n\t{\n\t\treturn -1;\n\t}\n\tif(left==right)\n\t{\n\t\treturn left;\n\t}\n\tint result=QueryL(l,r,num,LEFT);//\u56e0\u4e3a\u662f\u4e0b\u4e00\u4e2a,\u6240\u4ee5\u4f18\u5148\u67e5\u8be2\u5de6\u8fb9\n\tif(result!=-1)\n\t{\n\t\treturn result;\n\t}\n\treturn QueryL(l,r,num,RIGHT);\n}\nint QueryR(int l,int r,int num,int now=1,int left=1,int right=N)//\u67e5\u8be2\u4e0a\u4e00\u4e2a\u5c0f\u4e8enum\u7684\u503c\u7684\u4f4d\u7f6e\n{\n\tif(r<left||right<l)return -1;\n\tif(sgt[now].min>num)\n\t{\n\t\treturn -1;\n\t}\n\tif(left==right)\n\t{\n\t\treturn left;\n\t}\n\tint result=QueryR(l,r,num,RIGHT);\n\tif(result!=-1)\n\t{\n\t\treturn result;\n\t}\n\treturn QueryR(l,r,num,LEFT);\n}\n#undef LSON\n#undef RSON\n#undef MIDDLE\n#undef LEFT\n#undef RIGHT\nint main()\n{\n\tscanf(\"%d\",&N);\n\tREP(i,1,N)\n\t{\n\t\tscanf(\"%d\",&arr[i]);\n\t}\n\tBuild();\n\tREP(i,1,N)\n\t{\n\t\tif(arr[i]>=arr[i-1])//\u8ba1\u7b97L\u65f6\u7684\u7b2c\u4e00\u79cd\u60c5\u51b5\n\t\t{\n\t\t\tL[i]=L[i-1]+1ll*arr[i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint top=QueryR(1,i-1,arr[i]);//\u627e\u5230\u4e0a\u4e00\u4e2a\u5c0f\u4e8e\u7684\u4f4d\u7f6e\n\t\t\tif(top==-1)L[i]=1ll*i*arr[i];//\u4e0d\u5b58\u5728\u5c31\u76f4\u63a5\u8ba1\u7b97\n\t\t\telse\n\t\t\tL[i]=1ll*(i-top)*arr[i]+L[top];//\u5b58\u5728\u6309\u7b2c\u4e8c\u79cd\u60c5\u51b5\u8ba1\u7b97\n\t\t}\n\t}\n\tDOW(i,N,1)//\u8ba1\u7b97R\u540c\u7406\n\t{\n\t\tif(arr[i]>=arr[i+1])\n\t\t{\n\t\t\tR[i]=R[i+1]+1ll*arr[i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint top=QueryL(i+1,N,arr[i]);\n\t\t\tif(top==-1)R[i]=1ll*(N-i+1)*arr[i];\n\t\t\telse\n\t\t\tR[i]=1ll*(top-i)*arr[i]+R[top];\n\t\t}\n\t}\n\tint top=1;\n\tlong long answer=0;\n\tlong long sum;\n\tREP(i,1,N)\n\t{\n\t\tsum=L[i]+R[i]-arr[i];\n\t\tif(sum>answer)//\u627e\u5230\u6700\u5927\u4f4d\u7f6e\n\t\t{\n\t\t\tanswer=sum;\n\t\t\ttop=i;\n\t\t}\n\t}\n\t//\u540c\u6837\u65b9\u6cd5\u8f93\u51fa\n\tans[top]=arr[top];\n\tint now=arr[top];\n\tDOW(i,top-1,1)\n\t{\n\t\tans[i]=min(arr[i],now);\n\t\tnow=min(arr[i],now);\n\t}\n\tnow=arr[top];\n\tREP(i,top+1,N)\n\t{\n\t\tans[i]=min(arr[i],now);\n\t\tnow=min(arr[i],now);\n\t}\n\tREP(i,1,N)\n\t{\n\t\tprintf(\"%d \",ans[i]);\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1582666016,
        "uid": 86625,
        "name": "Limit",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "\u53ef\u4ee5\u53d1\u73b0\u7b54\u6848\u4e00\u5b9a\u7531\u4e00\u4e2a\u4e0d\u4e0b\u964d\u5b50\u5e8f\u5217\u548c\u4e00\u4e2a\u4e0d\u4e0a\u5347\u5b50\u5e8f\u5217\u6784\u6210\u3002\u90a3\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5c06\u539f\u6570\u5217\u5206\u6210\u4e24\u4e2a\u6570\u5217\uff0c\u901a\u8fc7\u679a\u4e3e\u5cf0\u503c\u4f4d\u7f6e\u5c06\u5de6\u53f3\u4e24\u8fb9\u7684\u8d21\u732e\u52a0\u8d77\u6765\u5373\u53ef\u3002\n\n\u5de6\u8fb9\u8d21\u732e$L_i$\u5373\u4ece\u4e0a\u4e00\u4e2a$a_{last}<=a_i$\u63a8\u8fc7\u6765\n\n$$L_i=L_{last}+a_i*(i-last)$$\n\n\u53f3\u8fb9\u8d21\u732e\u540c\u7406\n\n\u53ef\u4ee5\u53d1\u73b0\u6734\u7d20\u679a\u4e3e$last$\u7684\u590d\u6742\u5ea6$O(n^2)$\u3002\n\n\u4f46\u662f\u6bcf\u6b21\u90fd\u8981\u679a\u4e3e$last$\u592a\u9ebb\u70e6\u4e86\uff0c\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u6808\u6216\u8005\u7b1b\u5361\u5c14\u6811\u8fdb\u884c\u4f18\u5316,\u590d\u6742\u5ea6\u5373\u4e3a$O(n)$\n\n```\n#include<bits/stdc++.h>\n#define ld long double\n#define tset puts(\"qwq\");\n#define test puts(\"QAQ\");\n#define pb push_back\n#define pii pair<int,int> \n#define mkp make_pair\n#define Max(a,b) ((a>b)?a:b)\n#define us unsigned \n#define int long long\nusing namespace std;\nconst int inf=1e18;\n//#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n//char buf[1<<21], *p1 = buf, *p2 = buf;\nint read()\n{\n    int x=0,f=1;\n    char c=getchar();\n    while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n    while(isdigit(c)){x=(x<<3)+(x<<1)+(c^48);c=getchar();}\n    return x*f;\n}\nconst int N=5e5+10;\nint n,a[N];\nint L[N],R[N];\nint stk[N],top;\nsigned main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(top&&a[stk[top]]>a[i]) top--;\n\t\tL[i]=L[stk[top]]+a[i]*(i-stk[top]);\n\t\tstk[++top]=i;\n\t}\n\tstk[top=1]=n+1;\n\tfor(int i=n;i>=1;i--)\n\t{\n\t\twhile(top&&a[stk[top]]>a[i]) top--;\n\t\tR[i]=R[stk[top]]+a[i]*(stk[top]-i);\n\t\tstk[++top]=i;\n\t}\n\tint res=-1,pos;\n\tfor(int i=1;i<=n;i++) if(L[i]+R[i]-a[i]>res) pos=i,res=L[i]+R[i]-a[i];\n\tint tmp=a[pos];\n\tfor(int i=pos;i>=1;i--) if(a[i]>tmp) a[i]=tmp;else tmp=a[i];\n\ttmp=a[pos];\n\tfor(int i=pos;i<=n;i++) if(a[i]>tmp) a[i]=tmp;else tmp=a[i];\n\tfor(int i=1;i<=n;i++) printf(\"%lld \",a[i]);\n}\n```\n\n",
        "postTime": 1608523170,
        "uid": 115779,
        "name": "\u6781\u5bd2\u795e\u51b0",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "\u6700\u76f4\u89c2\u7c97\u66b4\uff0c\u4e5f\u5bb9\u6613\u60f3\u5230\u7684\u5e94\u8be5\u662f\u5206\u6cbb\u5427\u3002\n\n\u627e\u5230\u5e8f\u5217\u6700\u5c0f\u503c\u7684\u4f4d\u7f6e\uff0c\u5219\u5728\u8fd9\u4e2a\u6700\u5c0f\u503c\u5206\u4e3a\u4e24\u4fa7\uff0c\u5fc5\u6709\u4e00\u4fa7\u7684\u6240\u6709\u503c\u8981\u53d8\u4e3a\u6700\u5c0f\u503c\u3002\n\n\u5bf9\u4e8e\u4e00\u6bb5\u5e8f\u5217 $solve(L,R)$\uff0c\u6700\u5c0f\u503c $min$ \u7684\u4f4d\u7f6e $p$\uff0c \u5206\u6cbb $solve(L,p-1)$, $solve(p+1,R)$\uff0c\u6709\n\n\u5de6\u8fb9\u8986\u76d6\u4e3a\u6700\u5c0f\u503c\u7684\u603b\u4ef7\u503c\u4e3a $solve(p+1,R)+(p-L+1)*min$\n\n\u53f3\u8fb9\u8986\u76d6\u4e3a\u6700\u5c0f\u503c\u7684\u603b\u4ef7\u503c\u4e3a $solve(L,p-1)+(R-p+1)*min$\n\n\u6bd4\u8f83\u8fd9\u4e24\u4e2a\u503c\uff0c\u5c0f\u7684\u90a3\u4e00\u4fa7\u8986\u76d6\u4e3a\u6700\u5c0f\u503c\u5373\u53ef\uff0c\u7ef4\u62a4\u6700\u5c0f\u503c\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u3002\u590d\u6742\u5ea6$O(nlogn)$\u3002\n\n  \n```cpp\nconstexpr auto Inf = 0X3F3F3F3F;\n#ifndef LOCAL\n\t#include <bits/stdc++.h>\n#endif\ntypedef long long LL;\nusing namespace std;\n\nnamespace IO {\n\tinline LL read() {\n\t\tLL o = 0, f = 1; char c = getchar();\n\t\twhile (c < '0' || c > '9') { if (c == '-') f = -1; c = getchar(); }\n\t\twhile (c > '/' && c < ':') { o = o * 10 + c - '0'; c = getchar(); }\n\t\treturn o * f;\n\t}\n\tinline char recd() {\n\t\tchar o; while ((o = getchar()) < '0' || o > '9'); return o;\n\t}\n\tinline double reod() {\n\t\tdouble o = read(), f = 1; char c;\n\t\twhile ((c = getchar()) > '/' && c < ':') o += (c - '0') / (f *= 10);\n\t\treturn o;\n\t}\n}\nusing namespace IO;\n\nconst int SIZE = 5E5 + 7, Mod = 1E9 + 7;\n\nstruct Node {\n\tint L, R, w, Ind;\n} Node[SIZE << 2]; int w[SIZE], ans[SIZE];\n\nvoid BUILD(int now, int L, int R) {\n\tNode[now].L = L, Node[now].R = R;\n\tif (L == R) { Node[now].w = w[L], Node[now].Ind = L; return; }\n\tint M = (L + R) >> 1;\n\tBUILD(now << 1, L, M), BUILD(now << 1 | 1, M + 1, R);\n\tif (Node[now << 1].w < Node[now << 1 | 1].w) \n\t\tNode[now].w = Node[now << 1].w, Node[now].Ind = Node[now << 1].Ind;\n\telse \n\t\tNode[now].w = Node[now << 1 | 1].w, Node[now].Ind = Node[now << 1 | 1].Ind;\n}\n\npair<int, int> Ask(int now, int L, int R) {\n\tif (Node[now].L == L && Node[now].R == R)\n\t\treturn make_pair(Node[now].w, Node[now].Ind);\n\tint M = (Node[now].L + Node[now].R) >> 1;\n\tif (L > M) return Ask(now << 1 | 1, L, R);\n\tif (R <= M) return Ask(now << 1, L, R);\n\tpair<int, int> Lm = Ask(now << 1, L, M), Rm = Ask(now << 1 | 1, M + 1, R);\n\treturn Lm.first < Rm.first ? Lm : Rm;\n}\n\nLL F(int L, int R) {\n\tif (L >= R) return L == R ? w[L] : 0;\n\t\n\tpair<int, int> M = Ask(1, L, R);\n\tLL Lsub = F(L, M.second - 1), Rsub = F(M.second + 1, R);\n\tLL Lw = Lsub + LL(R - M.second + 1) * M.first;\n\tLL Rw = Rsub + LL(M.second - L + 1) * M.first;\n\n\tif (Lw < Rw) \n\t\tfor (int pos = L; pos < M.second; pos++) ans[pos] = M.first;\n\telse\n\t\tfor (int pos = M.second + 1; pos <= R; pos++) ans[pos] = M.first;\n\treturn Lw > Rw ? Lw : Rw;\n}\n\nint main() {\n\tint N = read(); \n\tfor (int pos = 1; pos <= N; pos++) ans[pos] = w[pos] = read(); BUILD(1, 1, N);\n\tF(1, N);\n\tfor (int pos = 1; pos <= N; pos++) printf(\"%d \", ans[pos]); puts(\"\");\n}\n```\n\n",
        "postTime": 1584108447,
        "uid": 110572,
        "name": "\u7720\u3164\u3164\u3164",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "\u9996\u5148\u6211\u4eec\u53d1\u73b0\uff0c\u6700\u540e\u7684\u7b54\u6848\u4e00\u5b9a\u662f\u4e00\u4e2a\u4e0d\u964d\u5e8f\u5217\u52a0\u4e0a\u4e00\u4e2a\u4e0d\u5347\u5e8f\u5217\u3002\n\n\u4ee4 $dp_i$ \u8868\u793a\u4ece $1\\sim i$ \u7684\u4e0d\u964d\u5e8f\u5217\u503c\u548c\u7684\u6700\u5927\u503c\uff0c $dp1_i$ \u8868\u793a\u4ece $i\\sim n$ \u7684\u4e0d\u5347\u5e8f\u5217\u503c\u548c\u7684\u6700\u5927\u503c\u3002\n\n\u5f97\u51fa $dp_i=dp_k+(i-k)\\times a_i$\uff0c\u5176\u4e2d $k$ \u4e3a $i$ \u4e4b\u524d\u7b2c\u4e00\u4e2a $a_k<a_i$ \u7684\u503c\u3002\n\n\u540c\u7406\u53ef\u4ee5\u5f97\u5230 $dp1_i$ \u7684\u503c\u3002\n\n\u548c C1 \u4e0d\u540c\uff0c\u6b64\u9898\u8fbe\u5230\u4e86 $n \\leq 500000$ \uff0c\u4e0a\u8ff0\u7b97\u6cd5\u7684\u74f6\u9888\u5728\u4e8e\u627e\u7b2c\u4e00\u4e2a $a_k<a_i$ \u7684\u503c\uff0c\u800c\u8fd9\u4e2a\u5176\u5b9e\u53ef\u4ee5\u7528\u5355\u8c03\u6808\u6765\u7ef4\u62a4\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<map>\n#include<set>\n#include<iostream>\n#define re register\n#define int long long\nusing namespace std;\ninline int read(){\n\tre int t=0;\n\tre char v=getchar();\n\twhile(v<'0')v=getchar();\n\twhile(v>='0'){\n\t\tt=(t<<3)+(t<<1)+v-48;\n\t\tv=getchar();\n\t}\n\treturn t;\n}\ninline int max(re int x,re int y){\n\treturn x>y?x:y;\n}\ninline int min(re int x,re int y){\n\treturn x<y?x:y;\n}\nint t,a[500002],dp[500002],dp1[500002],n,lst[500005],p,mx,ans[500005],s[500005],tp;\nsigned main(){\nn=read();\nfor(re int i=1;i<=n;++i)a[i]=read();\nfor(re int i=1;i<=n;++i){\n\tlst[i]=0;\n\twhile(a[s[tp]]>a[i]&&tp)--tp;\n\tlst[i]=s[tp];\n\ts[++tp]=i;\n}\nfor(re int i=1;i<=n;++i){\n\tdp[i]=dp[lst[i]]+(i-lst[i])*a[i];\n}\nreverse(a+1,a+n+1);\ntp=0;\nfor(re int i=1;i<=n;++i){\n\tlst[i]=0;\n\twhile(a[s[tp]]>a[i]&&tp)--tp;\n\tlst[i]=s[tp];\n\ts[++tp]=i;\n}\nfor(re int i=1;i<=n;++i){\n\tdp1[i]=dp1[lst[i]]+(i-lst[i])*a[i];\n}\nreverse(dp1+1,dp1+n+1);\nfor(re int i=1;i<=n;++i){\n\tif(dp[i]+dp1[i+1]>mx){\n\t\tmx=dp[i]+dp1[i+1];\n\t\tp=i;\n\t}\n}\nreverse(a+1,a+n+1);\nmx=a[p];\nfor(re int i=p;i>=1;--i){\t\nmx=min(mx,a[i]);\n\tans[i]=mx;\n\n}\nmx=a[p+1];\nfor(re int i=p+1;i<=n;++i){\t\nmx=min(mx,a[i]);\n\tans[i]=mx;\n\n}\nfor(re int i=1;i<=n;++i)printf(\"%lld \",ans[i]);\n}\n```\n",
        "postTime": 1582704688,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "\u5c45\u7136\u6ca1\u6709\u5355\u8c03\u6808\uff1f\n\n\u9996\u5148\u663e\u7136\u7b54\u6848\u662f\u4e00\u4e2a\u4e0d\u4e0b\u964d\u5e8f\u5217+\u4e00\u4e2a\u4e0d\u4e0a\u5347\u5e8f\u5217\uff0c\u56e0\u6b64\u8003\u8651\u4e00\u4e0b\u4e0d\u4e0b\u964d\u5e8f\u5217\u600e\u4e48\u641e\uff1a\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$a_i$\uff0c\u627e\u5230\u5b83\u524d\u9762\u6700\u5927\u7684$j$\u4f7f$a_j<a_i$\uff08\u5982\u679c\u4e0d\u5b58\u5728\u5219$j=0$\uff09\uff0c\u7136\u540e\u628a$(j,i]$\u5185\u7684\u697c\u5168\u90e8\u6539\u6210$a_i$\u9ad8\u5ea6\u3002\u76f4\u63a5\u505a$O(n^2)$\uff0c\u5355\u8c03\u6808\u4f18\u5316\u540e$O(n)$\u3002\n\ncode\uff1a\n\n```cpp\n#include<cstdio>\n#define For(i,A,B) for(i=(A);i<=(B);++i)\ntypedef long long ll;\nconst int N=500050;\nint a[N],st[N],sl;\nll res[N],now;\ninline int len(int x,int y){return x<=y?y-x:x-y;}\ninline void push(int p){\n    for(;sl&&a[st[sl]]>=a[p];--sl)now-=(ll)a[st[sl]]*len(st[sl],st[sl-1]);\n    now+=(ll)a[p]*len(p,st[sl]);\n    st[++sl]=p;\n}\nint main(){\n    int n,i,j=1,p;\n    ll ans;\n    scanf(\"%d\",&n);p=n;\n    For(i,1,n)scanf(\"%d\",a+i);\n    For(i,1,n){\n        push(i);\n        res[i]=now;\n    }\n    ans=now;\n    st[sl=now=0]=n+1;\n    for(i=n;i;--i){\n        push(i);\n        if(res[i-1]+now>ans){\n            ans=res[i-1]+now;\n            p=i-1;\n        }\n    }\n    sl=0;\n    For(i,1,p)push(i);\n    For(i,1,sl)\n        for(;j<=st[i];++j)printf(\"%d \",a[st[i]]);\n    sl=0;\n    for(i=n;i>p;--i)push(i);\n    for(i=sl;i;--i)\n        For(j,st[i],st[i-1]-1)printf(\"%d \",a[st[i]]);\n    return 0;\n}\n```\n",
        "postTime": 1582695311,
        "uid": 57926,
        "name": "Thinking",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "- \u524d\u7f6e\u77e5\u8bc6\uff1a\u7b1b\u5361\u5c14\u6811\n\n### \u9898\u610f\uff1a\n\n\u628a\u76f4\u65b9\u56fe\u5207\u5272\u6210\u4e00\u4e2a\u5355\u5cf0\u7684\uff0c\u4f7f\u9762\u79ef\u6700\u5927\n\n### \u89e3\u6790\uff1a\n\n- $1\\le n\\le 1000$ \uff1a\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u5cf0\u70b9\uff0c\u7136\u540e\u76f4\u63a5\u6a21\u62df\n\n- $1\\le n\\le 500000$ \uff1a\n\n\u770b\u5230\u76f4\u65b9\u56fe\u4e0a\u641e\u4e8b\uff0c\u663e\u7136\u53ef\u4ee5\u5f04\u6210\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u505a\u6811\u5f62 DP\n\n1. \u5efa\u51fa\u7b1b\u5361\u5c14\u6811\n\n2. \u505a\u6811\u5f62 DP \uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u8bb0\u5f55\u8fd9\u4e2a\u5b50\u76f4\u65b9\u56fe\u7684\u7b54\u6848\uff0c\u6bd4\u8f83\u5de6\u513f\u5b50\u548c\u53f3\u513f\u5b50\u7b54\u6848\u5927\u5c0f\uff0c\u9009\u53d6\u6253\u5012\uff0c\u5e76\u628a\u53e6\u4e00\u8fb9\u7684\u5b50\u76f4\u65b9\u56fe\u9ad8\u5ea6\u5168\u90e8\u8d4b\u503c\u4e3a\u4e0e\u81ea\u5df1\u9ad8\u5ea6\u76f8\u540c\u7684\n\n\u4e0d\u8fc7\u76f4\u63a5 DFS \u8d4b\u503c\u53ef\u80fd\u4f1a\u88ab\u5361\uff0c\u53ef\u4ee5\u6253\u4e2a\u6807\u8bb0\u6700\u540e\u4e00\u8d77\u641e~~\u6211\u624d\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u5c31\u662f\u76f4\u63a5 DFS \u8d4b\u503c\u6ca1\u88ab\u5361~~\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#define int long long\nint n,top,s[500001],sz[500001],a[500001],f[500001],c[500001][2];\ninline int read(){\n\tchar ch=getchar();int res=0,w=1;\n\twhile(ch<'0'||ch>'9') {if(ch=='-') w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') {res=res*10+ch-'0';ch=getchar();}\n\treturn res*w;\n}\nvoid gg(int x,int v){\n\tif(!x) return;\n\ta[x]=v;gg(c[x][0],v);gg(c[x][1],v);\n}\nvoid dfs(int x,int t){\n\tif(!x) return;\n\tdfs(c[x][0],a[x]);dfs(c[x][1],a[x]);sz[x]=sz[c[x][0]]+sz[c[x][1]]+1;f[x]=sz[x]*(a[x]-t);\n\tif(f[c[x][0]]>f[c[x][1]]) {gg(c[x][1],a[x]);f[x]+=f[c[x][0]];}\n\telse {gg(c[x][0],a[x]);f[x]+=f[c[x][1]];}\n}\nsigned main(){\n\tn=read();\n\tfor(register int i=1,j;i<=n;i++)\n\t{\n\t\ta[i]=read();j=top;\n\t\twhile(j&&a[s[j]]>a[i]) j--;\n\t\tif(j) c[s[j]][1]=i;\n\t\tif(j<top) c[i][0]=s[j+1];\n\t\ttop=j;s[++top]=i;\n\t}\n\tdfs(s[1],0);\n\tfor(register int i=1;i<=n;i++) printf(\"%d \",a[i]);\n\treturn 0;\n}\n```",
        "postTime": 1582685343,
        "uid": 80679,
        "name": "Register",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a  \n\u7ed9\u4f60\u4e00\u4e2a\u6570\u5217 $m$\uff0c\u4f60\u8981\u628a\u5176\u4e2d\u7684\u4e00\u90e8\u5206\u6570\u51cf\u5c11\u4e00\u4e9b\uff0c\u4f7f\u5f97\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a $k$ \u4f7f\u5f97 $m_1\\le m_2\\le\u2026\\le m_k\\ge m_{k+1}\\ge\u2026\\ge m_n$\u3002\u8f93\u51fa\u64cd\u4f5c\u540e\u7684\u6570\u5217\u3002\uff08$1\\le n\\le5\\times10^5$\uff09\u3002\n___\n\u8003\u8651\u4f18\u5316 $O(n^2)$ \u7684\u66b4\u529b\u3002\u66b4\u529b\u4e3b\u8981\u662f\u8981\u6bcf\u6b21\u4e00\u4e2a\u4e00\u4e2a\u7b97\u8d21\u732e\uff0c\u56e0\u4e3a\u6570\u5217\u7684\u5355\u8c03\u6027\uff0c\u53ef\u4ee5\u60f3\u5230\u7528\u5355\u8c03\u6808\u6765\u4f18\u5316\u66b4\u529b\uff0c\u90a3\u6837\u6bcf\u6b21\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230\u5747\u644a $O(1)$ \u7136\u540e\u627e\u5230\u7b54\u6848\u6700\u5927\u7684\u90a3\u4e2a\u5206\u754c\u70b9\uff0c\u518d\u8dd1\u4e00\u904d\u66b4\u529b\u6c42\u51fa\u7b54\u6848\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\uff08O(n)\uff09\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint n,m[500001],la[500001],ra[500001],l[500001],r[500001],ln[500001],rn[500001],l1,r1,ansl[500001],ansr[500001],ans,ansi,ans_[500001];\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&m[i]);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(m[i]<l[l1])--l1;\n\t\tl[++l1]=m[i];\n\t\tln[l1]=i;\n\t\tansl[i]=la[l1]=la[l1-1]+m[i]*(i-ln[l1-1]);\n\t}\n\trn[0]=n+1;\n\tfor(int i=n;i>=1;i--)\n\t{\n\t\twhile(m[i]<r[r1])--r1;\n\t\tr[++r1]=m[i];\n\t\trn[r1]=i;\n\t\tansr[i]=ra[r1]=ra[r1-1]+m[i]*(rn[r1-1]-i);\n\t}\n\tfor(int i=1;i<=n;i++)if(ansl[i]+ansr[i]-m[i]>ans)\n\t{\n\t\tans=ansl[i]+ansr[i]-m[i];\n\t\tansi=i;\n\t}\n\tint k=m[ansi];\n\tfor(int j=ansi-1;j>0;j--)ans_[j]=(k=min(m[j],k));\n\tk=m[ansi];\n\tfor(int j=ansi+1;j<=n;j++)ans_[j]=(k=min(m[j],k));\n\tans_[ansi]=m[ansi];\n\tfor(int i=1;i<=n;i++)printf(\"%lld \",ans_[i]);\n\treturn 0;\n}\n```",
        "postTime": 1582463373,
        "uid": 44840,
        "name": "123456zmy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1313C2 \u3010Skyscrapers (hard version)\u3011"
    }
]