[
    {
        "content": "\u548c\u670b\u53cb\u4e00\u8d77\u6253 VP\uff0c\u7ed3\u679c\u6253\u5230\u8fd9\u9053\u9898\uff0c\u6b63\u597d\u5b66\u4e86\u659c\u7387\u4f18\u5316\uff0c\u5c31\u505a\u4e86\u4e00\u4e0b\u3002\n\n### Problem\n\n\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u5b9a\u4e00\u5f20\u56fe\uff0c\u5176\u4e2d\u4f60\u53ef\u4ee5\u5750 $k$ \u6b21\u98de\u673a\uff0c\u53ef\u4ee5\u4ece\u4efb\u610f\u4e00\u70b9 $u$ \u98de\u5230\u4efb\u610f\u4e00\u70b9 $v$\uff0c\u4ee3\u4ef7\u4e3a $(u-v)^2$\uff0c\u6c42\u8d77\u59cb\u70b9 $1$ \u5230\u6240\u6709\u70b9\u7684\u6700\u77ed\u8def\u5f84\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a $n \\leq 10^5,m \\leq 10^5,k \\leq 20$\u3002\n\n### Solution\n\n\u770b\u5230\u8fd9\u4e2a\u9898\uff0c\u4e00\u5f00\u59cb\u6211\u60f3\u7684\u662f\u5206\u5c42\u56fe\uff0c\u4f46\u662f\u56e0\u4e3a\u4efb\u610f\u4e00\u70b9\u5230\u4efb\u610f\u4e00\u70b9\u90fd\u53ef\u4ee5\u8fde\u4e00\u6761\u8def\u5f84\uff0c\u6240\u4ee5\u7a7a\u95f4\u4f1a\u70b8\u6389\uff08\u5f53\u7136\u8bf4\u4e0d\u5b9a\u4e00\u4e9b\u5927\u4f6c\u53ef\u4ee5\u7528\u5206\u5c42\u56fe\u505a\uff0c\u53cd\u6b63\u6211\u8fd9\u4e2a\u849f\u84bb\u4e0d\u4f1a\uff09\u3002\n\n\u6ce8\u610f $(u-v)^2$\uff0c\u5e73\u767d\u65e0\u6545\u4ed6\u4e3a\u4ec0\u4e48\u8981\u52a0\u4e2a\u5e73\u65b9\u5462\uff1f\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u60f3\u5230\u8fd0\u7528\u659c\u7387\u4f18\u5316\uff0c\u6bd5\u7adf\u51fa\u73b0\u4e86\u5e73\u65b9\uff0c\u800c\u4e14\u6700\u77ed\u8def\u7684 dp \u5f0f\u5b50\u4e5f\u5f88\u7b80\u5355\uff0c\u8fd9\u4e2a\u9898\u60f3\u5230\u659c\u7387\u4f18\u5316\u4e4b\u540e\u5c31\u662f\u677f\u5b50\u4e86\u3002\n\n\u7b80\u5355\u63a8\u4e00\u4e0b\uff1a\n\n$$dp_i=\\min\\limits_{j=1}^n dp_j+(i-j)^2$$\n\n\u5957\u8def\uff1a\n\n$$dp_i=dp_j+i^2-2ij+j^2$$\n\n$$dp_j+j^2=2i \\times j +dp_i-i^2$$\n\n\u7ee7\u7eed\u5957\u8def\uff1a\n\n$$y=kx+b,y=dp_j+j^2,k=2i,x=j,b=dp_i-i^2$$\n\n\u597d\u4e86\u659c\u7387\u4f18\u5316\u63a8\u51fa\u6765\u4e86\uff0c\u7d27\u63a5\u7740\u5c31\u662f\u4e00\u4e9b\u5c0f\u95ee\u9898\uff1a\n\n1. \u9996\u5148\u663e\u7136\u6211\u4eec\u8981\u505a $k$ \u904d\u659c\u7387\u4f18\u5316\uff0c\u53ef\u4ee5\u53d1\u73b0 $k \\leq 20$ \u6240\u4ee5\u6211\u4eec\u8fd9\u4e2a\u60f3\u6cd5\u884c\u7684\u901a\u3002\n\n2. \u505a\u7b2c $i$ \u904d\u659c\u7387\u4f18\u5316\u7684\u65f6\u5019\uff0c\u5f88\u660e\u663e\uff0c\u6211\u4eec\u7528\u7684\u662f\u7b2c $i-1$ \u904d\u659c\u7387\u4f18\u5316\u540e\u5904\u7406\u51fa\u6765\u7684\u6700\u77ed\u8def\u6765\u8fdb\u884c\u66f4\u65b0\uff0c\u800c\u505a\u7b2c $i$ \u904d\u7684\u65f6\u5019\u4f1a\u5f71\u54cd\u539f\u6765\u7684\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u628a\u7b2c $i-1$ \u904d\u4e4b\u540e\u7684\u6700\u77ed\u8def\u5b58\u4e0b\u6765\u66f4\u65b0\u7b2c $i$ \u904d\u7684\u3002\n\n3. \u663e\u7136\uff0c\u505a\u5b8c\u659c\u7387\u4f18\u5316\u4e4b\u540e\uff0c\u67d0\u4e9b\u70b9\u7684\u6700\u77ed\u8def\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u7d27\u8ddf\u7740\uff0c\u4ece\u8fd9\u4e2a\u70b9\u8d70\u539f\u56fe\uff08\u4e0d\u662f\u5750\u98de\u673a\uff09\u7684\u4e00\u4e9b\u70b9\u4e5f\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u628a\u66f4\u65b0\u4e4b\u540e\u7684\u70b9\u6254\u5230 Dijkstra \u91cc\u9762\u66f4\u65b0\u4e00\u6b21\u3002\n\n### Code\n\n\u5177\u4f53\u7ec6\u8282\u770b\u5982\u4e0b\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+7232;\nint n,m,k;\nint x,y;\nlong long dis[N],sum[N],z;\nshort vis[N];\nint h[N],cnt;\nstruct hl{\n    int v,nxt;\n    long long w;\n}e[N<<1];\nvoid add(int u,int v,long long w)\n{\n    e[++cnt].v=v;e[cnt].nxt=h[u];h[u]=cnt;e[cnt].w=w;\n}\nstruct llt{\n    int id;\n    long long d;\n    bool operator < (const llt&x ) const{\n        return d>x.d;\n    }\n}tmp;\npriority_queue<llt> p;\nvoid dij()\n{\n    memset(vis,0,sizeof(vis));\n    while(!p.empty())\n    {\n        tmp=p.top();p.pop();\n        if(vis[tmp.id]) continue;\n        vis[tmp.id]=1;\n        for(int i=h[tmp.id];i;i=e[i].nxt)\n        {\n            if(dis[e[i].v]>dis[tmp.id]+e[i].w)\n            {\n                dis[e[i].v]=dis[tmp.id]+e[i].w;\n                p.push((llt){e[i].v,dis[e[i].v]});\n            }\n        }\n    }\n}\nint q[N<<4],head=1,tail=1;\ndouble slope(int i,int j)//\u659c\u4f18\u677f\u5b50\n{\n    if(i==j) return 1000000732.0;\n    return (sum[i]+(1ll)*i*i-sum[j]-(1ll)*j*j)*1.0/(i-j);\n}\nlong long mi(long long x,long long y)\n{\n    return x<y?x:y;\n}\nint main()\n{\n    scanf(\"%d%d%d\",&n,&m,&k);\n    for(int i=1;i<=m;i++) scanf(\"%d%d%lld\",&x,&y,&z),add(x,y,z),add(y,x,z);\n    memset(dis,0x3f,sizeof(dis));\n    p.push((llt){1,0});\n    dis[1]=0;\n    dij();\n    while(k--)//\u7b2c\u4e00\u70b9\n    {\n        head=tail=1;q[1]=0;//\u6e05\u7a7a\n        for(int i=1;i<=n;i++) sum[i]=dis[i];//\u7b2c\u4e8c\u70b9\n        for(int i=1;i<=n;i++)\n        {\n            while(head<tail&&slope(q[tail-1],q[tail])>slope(q[tail-1],i)) --tail;//\u659c\u4f18\u677f\u5b50\n            q[++tail]=i;\n        }\n        for(int i=1;i<=n;i++)\n        {\n            while(head<tail&&slope(q[head],q[head+1])<2.0*i) ++head;//\u659c\u4f18\u677f\u5b50\n            int j=q[head];\n            if(dis[i]>sum[j]+(i-j)*(i-j))\n            {\n                dis[i]=sum[j]+(1ll)*(i-j)*(i-j);\n                p.push((llt){i,dis[i]});//\u9047\u5230\u66f4\u65b0\u4e86\u6700\u77ed\u8def\u7684\u70b9\uff0c\u653e\u5230\u961f\u5217\u4e2d\u53bb\n            }\n        }\n        dij();\n    }\n    for(int i=1;i<=n;i++) printf(\"%lld \",dis[i]);\n}\n/*\n10 0 10\n\n*/\n```\n\u5bf9\u4e86\uff0c\u6709\u53e5\u4fd7\u8bdd\u8bf4\u5f97\u597d\uff0c\u4e0d\u5f00 long long \u89c1\u7956\u5b97\u3002\n",
        "postTime": 1667464454,
        "uid": 478885,
        "name": "lenlen",
        "ccfLevel": 6,
        "title": "CF1715E Long Way Home \u9898\u89e3"
    },
    {
        "content": "\u770b\u5230\u822a\u73ed\u53ea\u80fd $k$ \u6b21\uff0c\u4ee3\u4ef7\u8fd8\u5e26\u5e73\u65b9\uff0c\u5f88\u5feb\u554a\uff0c\u5c31\u53ef\u4ee5\u60f3\u5230\u662f\u4e2a\u659c\u7387 dp\u3002  \n\u5148\u8003\u8651\u53ea\u80fd\u98de\u4e00\u6b21\u600e\u4e48\u529e\u3002\u8bbe\u4ece\u8d77\u70b9\u5230\u70b9 $i$ \u7684\u6700\u77ed\u8ddd\u79bb\u4e3a $dis_i$\uff0c\u98de\u5b8c\u7684\u6700\u77ed\u8ddd\u79bb\u4e3a $dp_i$\uff0c\u90a3\u4e48\u53ef\u4ee5\u5f97\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$dp_i=\\min^n_{i=1}(dis_j+(i-j)^2)$$\n\u628a $\\min$ \u53bb\u6389\uff0c\u7136\u540e\u5957\u8def\u6027\u5730\u63a8\u4e0b\u67ff\u5b50\uff1a\n$$\n\\begin{aligned}\ndp_i&=dis_j+(i-j)^2\\\\\ndp_i&=dis_j+i^2-2ij+j^2\\\\\n2ij+dp_i-i^2&=dis_j+j^2\\\\\nK_iX_j+B_i&=Y_j\\\\\nK_i=2i,X_j=j&,B_i=dp_i-i^2,Y_j=dp_j+j^2\\\\\n\\end{aligned}\n$$\n\u8fd9\u4e2a\u659c\u7387\u4f18\u5316\u548c\u666e\u901a\u7684\u4e0d\u592a\u4e00\u6837\uff0c$j$ \u5e76\u6ca1\u6709 $\\le i$ \u7684\u8303\u56f4\u9650\u5236\u3002\u6240\u4ee5\u9700\u8981\u5148\u628a\u6240\u6709\u51b3\u7b56\u70b9\u52a0\u8fdb\u53bb\uff0c\u518d\u8fdb\u884c\u8f6c\u79fb\u3002  \n\u98de\u4e00\u6b21\u5c31\u8f6c\u79fb\u4e00\u6b21\uff0c\u90a3\u98de $k$ \u6b21\u5c31\u8f6c\u79fb $k$ \u6b21\u3002\u6bcf\u6b21\u8dd1\u6700\u77ed\u8def\u65f6\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u7684\u8ddd\u79bb\u88ab\u66f4\u65b0\uff0c\u90a3\u5c31\u628a\u8fd9\u4e00\u8ddd\u79bb\u52a0\u5165 $\\text{Dijkstra}$ \u7b97\u6cd5\u7684\u4f18\u5148\u961f\u5217\u91cc\uff0c\u5c31\u53ef\u4ee5\u66f4\u65b0\u98de\u5b8c\u540e\u7684\u6700\u77ed\u8ddd\u79bb\u4e86\u3002  \n# AC \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef double db;\n\nconst int MAXN = 1e5 + 10;\n\nstruct edge {\n\tint v, w, nxt;\n} e[MAXN << 1];\n\nint head[MAXN], tot;\n\ninline \nvoid add(int u, int v, int w) {\n\te[++tot] = { v, w, head[u] }, head[u] = tot;\n}\n\nstruct node {\n\tint u; ll dis;\n\tbool operator < (const node &rhs) const { return dis > rhs.dis; }\n};\n\nbool vis[MAXN];\n\nll dis[MAXN];\n\npriority_queue<node> qn;\n\nvoid dijkstra() {\n\tmemset(vis, 0, sizeof vis);\n\tqn.push({ 1, 0 });\n\twhile (!qn.empty()) {\n\t\tint u = qn.top().u; qn.pop();\n\t\tvis[u] = 1;\n\t\tfor (int i = head[u], v; i; i = e[i].nxt) {\n\t\t\tv = e[i].v;\n\t\t\tif (dis[v] > dis[u] + e[i].w) {\n\t\t\t\tdis[v] = dis[u] + e[i].w;\n\t\t\t\tif (!vis[v]) qn.push({ v, dis[v] });\n\t\t\t}\n\t\t}\n\t}\n}\n\nll dp[MAXN];\n\ninline ll k(ll p) { return p << 1; }\ninline ll x(ll p) { return p; }\ninline ll b(ll p) { return dp[p] - p * p; }\ninline ll y(ll p) { return dp[p] + p * p; }\ninline db slope(ll p, ll q) { return (db)(y(p) - y(q)) / (x(p) - x(q)); }\n\ndeque<int> q;\n\nint n, m, t;\n\nint main() {\n\tscanf(\"%d%d%d\", &n, &m, &t);\n\tfor (int i = 1, u, v, w; i <= m; i++) scanf(\"%d%d%d\", &u, &v, &w), add(u, v, w), add(v, u, w);\n\tmemset(dis, 0x3f, sizeof dis);\n\tdis[1] = 0;\n\tdijkstra();\n\tfor (int i = 1; i <= t; i++) {\n\t\tfor (int j = 1; j <= n; j++) dp[j] = dis[j];\n\t\tq.clear(), q.push_back(0);\n\t\tfor (int j = 1; j <= n; j++) {\n\t\t\tif (x(j) == x(q.back())) {\n            \tif (y(j) < y(q.back())) q.pop_back();\n            \telse continue;\n        \t}\n\t\t\twhile (q.size() > 1 && slope(q[q.size() - 2], q.back()) >= slope(q[q.size() - 2], j)) q.pop_back();\n\t\t\tq.push_back(j);\n\t\t}\n\t\tfor (int j = 1, v; j <= n; j++) {\n\t\t\twhile (q.size() > 1 && slope(q.front(), q[1]) <= k(j)) q.pop_front();\n\t\t\tv = q.front();\n\t\t\tif (!v) continue;\n\t\t\tif (dis[j] > dp[v] + (ll)(j - v) * (j - v)) {\n\t\t\t\tdis[j] = dp[v] + (ll)(j - v) * (j - v);\n\t\t\t\tqn.push({ j, dis[j] });\n\t\t\t}\n\t\t}\n\t\tdijkstra();\n\t}\n\tfor (int i = 1; i <= n; i++) printf(\"%lld \", dis[i]);\n}\n```",
        "postTime": 1661315315,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "CF1715E \u9898\u89e3"
    },
    {
        "content": "**[\u3010\u539f\u9898\u94fe\u63a5\u3011](https://www.luogu.com.cn/problem/CF1715E)**\n\n## \u9898\u76ee\u5206\u6790\n\n\u5148\u8003\u8651 $k=1$ \u600e\u4e48\u505a\u3002\n\n\u663e\u7136\u8d70\u8fc7\u7684\u8def\u4e00\u5b9a\u662f\u201c\u8d70\u8def $\\to$ \u98de $\\to$ \u8d70\u8def\u201d\u3002\u4e0d\u98de\u6216\u8005\u4e0d\u8d70\u53ef\u4ee5\u8ba4\u4e3a\u662f\u539f\u5730\u8e0f\u6b65\u3002\n\n\u7b2c\u4e00\u6b65\uff0c\u6211\u4eec\u53ef\u4ee5\u8dd1\u4e00\u904d dijkstra\uff0c\u5f97\u5230\u4e86\u53ea\u8d70\u8def\u7684\u6700\u77ed\u8def\u3002\n\n\u7b2c\u4e8c\u6b65\uff0c\u8981\u5904\u7406\u8fd9\u4e00\u6b21\u98de\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u5904\u7406\u6700\u540e\u4e00\u6b21\u662f\u98de\u7684\u6700\u77ed\u8def\u3002\u4e0d\u96be\u60f3\u5230\u8fd9\u6837\u66f4\u65b0\uff1a$dis_u'\\gets \\min\\limits_v\\{dis_v+(u-v)^2\\}$\u3002\u628a\u540e\u9762\u7684 $(u-v)^2$ \u62c6\u5f00\u540e\uff0c\u6574\u7406\u6210 $\\min\\limits_v\\{-2uv+v^2+dis_v\\}+u^2$\u3002\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u6216\u8005\u7ef4\u62a4\u51f8\u5305\u89e3\u51b3\u3002\u6211\u4f7f\u7528\u4e86\u674e\u8d85\u7ebf\u6bb5\u6811\uff0c\u5c31\u662f\u628a $\\min$ \u91cc\u9762\u7684\u4e1c\u897f\u770b\u6210\u76f4\u7ebf $y=-2vx+(v^2+dis_v)$\uff0c\u7136\u540e\u6c42 $x=u$ \u65f6\u7684\u6700\u5c0f\u503c\u3002\n\n\u7b2c\u4e09\u6b65\uff0c\u6700\u540e\u8fd8\u8981\u5728\u5730\u4e0a\u8d70\u4e00\u6bb5\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u5df2\u7ecf\u5f97\u5230\u7684 $dis$ \u518d\u6254\u8fdb\u5806\u91cc\u9762\u8dd1 dijkstra\uff0c\u5c31\u77e5\u9053\u6700\u7ec8\u7b54\u6848\u4e86\u3002\n\n$k=1$ \u505a\u5b8c\u4e86\u3002$k>1$ \u7684\u8bdd\uff0c\u89e6\u7c7b\u65c1\u901a\u5730\uff0c\u505a\u5b8c\u7b2c\u4e00\u6b65\u540e\uff0c\u518d\u628a\u7b2c\u4e8c\u3001\u4e09\u6b65\u505a $k$ \u6b21\u5373\u53ef\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n/* \u7701\u7565\u5feb\u8bfb\u5feb\u5199\uff0c\u5373\u4e0b\u9762\u7684 qin\u3001qout */\n\nint n,m,k;\nvector<pair<int,int>> g[100005];\n\nLL dis[100005];\nbool vis[100005];\nvoid dijkstra()\n{\n\tpriority_queue<pair<LL,int>,vector<pair<LL,int>>,greater<pair<LL,int>>> q;\n\tfor(int i=1;i<=n;i++)\n\t\tvis[i]=false,q.emplace(dis[i],i);\n\twhile(!q.empty())\n\t{\n\t\tint u=q.top().second;\n\t\tq.pop();\n\t\tif(vis[u]) continue;\n\t\tvis[u]=true;\n\t\tfor(auto &[v,w]: g[u])\n\t\t\tif(dis[u]+w<dis[v])\n\t\t\t\tq.emplace(dis[v]=dis[u]+w,v);\n\t}\n}\n\nstruct Line\n{\n\tLL k,b;\n\tLine()=default;\n\tLine(LL _k,LL _b): k(_k),b(_b){}\n\tinline LL operator ()(const LL x)const\n\t\t{ return k*x+b; }\n}t[400005];\n#define LC (i<<1)\n#define RC (i<<1|1)\nvoid build(int l,int r,int i=1)\n{\n\tt[i]=Line(0,INF);\n\tif(l!=r)\n\t{\n\t\tint mid=(l+r)>>1;\n\t\tbuild(l,mid,LC);\n\t\tbuild(mid+1,r,RC);\n\t}\n}\nvoid modify(const Line &f,int i=1,int l=1,int r=n)\n{\n\tint mid=(l+r)>>1;\n\tif(f(l)>=t[i](l) && f(r)>=t[i](r)) return;\n\telse if(f(l)<=t[i](l) && f(r)<=t[i](r)) t[i]=f;\n\telse modify(f,LC,l,mid),modify(f,RC,mid+1,r);\n}\nLL query(int p,int i=1,int l=1,int r=n)\n{\n\tif(l==r) return t[i](p);\n\tLL mid=(l+r)>>1,res=t[i](p);\n\tif(mid>=p) res=min(res,query(p,LC,l,mid));\n\telse res=min(res,query(p,RC,mid+1,r));\n\treturn res;\n}\n\nint main()\n{\n\tqin>>n>>m>>k;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u,v,w;\n\t\tqin>>u>>v>>w;\n\t\tg[u].emplace_back(v,w);\n\t\tg[v].emplace_back(u,w);\n\t}\n\tfor(int i=2;i<=n;i++) dis[i]=INF;\n\tdijkstra();\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tbuild(1,n);\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tmodify(Line(-2*j,(LL)j*j+dis[j]));\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tdis[j]=min(dis[j],query(j)+(LL)j*j);\n\t\tdijkstra();\n\t}\n\tfor(int i=1;i<=n;i++) qout<<dis[i]<<' ';\n\treturn 0;\n}\n```\n",
        "postTime": 1661330308,
        "uid": 279800,
        "name": "ExplodingKonjac",
        "ccfLevel": 7,
        "title": "CF1715E Long Way Home"
    },
    {
        "content": "\u5957\u8def\u9898\u3002\n\n\u5148\u4e0d\u8003\u8651\u989d\u5916\u7684\u8fb9\u8dd1\u4e00\u6b21\u6700\u77ed\u8def\u3002\n\n\u7136\u540e\u8003\u8651\u4e00\u4e0b\u989d\u5916\u7684\u8fb9\uff0c\u5355\u72ec\u62ff\u51fa\u6765\u8f6c\u79fb\u4e00\u6b21\u3002\n\n\u5f0f\u5b50\u4e3a $dis_u=\\min\\{olddis_v+(u-v)^2,1\\leq v \\leq n\\}$\u3002\n\n\u7b80\u5355\u7684\uff0c\u628a\u51f8\u5305\u5efa\u51fa\u6765\uff0c\u4e8c\u5206\u6700\u4f18\u70b9\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u4e5f\u5c31\u662f\u505a\u4e00\u6b21\u659c\u7387\u4f18\u5316 $dp$\u3002\n\n\u7136\u540e\u7ee7\u7eed\u8dd1\u6700\u77ed\u8def\uff0c\u6700\u77ed\u8def\u53ef\u4ee5\u540c\u65f6 $n$ \u4e2a\u8282\u70b9\u4e00\u8d77\u8dd1\u3002\n\n\u91cd\u590d $k$ \u6b21\u3002\n\n\u590d\u6742\u5ea6 $O(k(n\\log m+n\\log n))$\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\nconst int N=100010;\n#define ll long long\nstruct node{\n\tint id;\n\tll val;\n\tbool operator<(const node &A)const {\n\t\treturn val>A.val;\n\t}\n};\nstruct heap{\n\tnode st[N<<1];\n\tint tp;\n\tvoid push(node x){\n\t\tst[++tp]=x,std::push_heap(st+1,st+tp+1);\n\t}\n\tvoid pop(){\n\t\tstd::pop_heap(st+1,st+tp+1),tp--;\n\t}\n\tnode top(){\n\t\treturn st[1];\n\t}\n}q;\nstruct edge{\n\tedge*net;int to,c;\n}e[N<<1],*tot=e,*head[N];\nint n,m,k;\nll dis[N];\nint vis[N];\nvoid dij(){\n\tmemset(vis,0,sizeof vis);\n\tfor(int i=1;i<=n;i++)q.push(node{i,dis[i]});\n\twhile(q.tp){\n\t\tint u=q.top().id;q.pop();\n\t\tif(vis[u])continue;\n\t\tvis[u]=1;\n\t\tfor(edge*i=head[u];i;i=i->net)if(dis[u]+i->c<dis[i->to]){\n\t\t\tdis[i->to]=dis[u]+i->c;\n\t\t\tq.push(node{i->to,dis[i->to]});\n\t\t}\n\t}\n}\nlong long qx[N],qy[N];\nint tp;\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tfor(int i=1,u,v,w;i<=m;i++)scanf(\"%d%d%d\",&u,&v,&w),*++tot={head[u],v,w},head[u]=tot,*++tot={head[v],u,w},head[v]=tot;\n\tmemset(dis,63,sizeof dis),dis[1]=0;\n\tdij();\n\tfor(int i=1;i<=k;i++){\n\t\ttp=0;\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tlong long ox=2*j,oy=dis[j]+1ll*j*j;\n\t\t\twhile(tp>1&&(__int128)(oy-qy[tp])*(qx[tp]-qx[tp-1])<=(__int128)(qy[tp]-qy[tp-1])*(ox-qx[tp]))tp--;\n\t\t\tqx[++tp]=ox,qy[tp]=oy;\n\t\t}\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tint l=1,r=tp;\n\t\t\twhile(l<r){\n\t\t\t\tint mid=l+r>>1;\n\t\t\t\tif(qy[mid+1]-qy[mid]<1ll*j*(qx[mid+1]-qx[mid]))l=mid+1;\n\t\t\t\telse r=mid;\n\t\t\t}\n\t\t\tdis[j]=1ll*j*j+qy[l]-1ll*j*qx[l];\n\t\t}\n\t\tdij();\n\t}\n\tfor(int i=1;i<=n;i++)printf(\"%lld \",dis[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1661139917,
        "uid": 135425,
        "name": "Qzong",
        "ccfLevel": 6,
        "title": "CF1715E Long Way Home \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u4e2a $k$ \u975e\u5e38\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5168\u90e8\u4f9d\u6b21\u98de\u8fd9 $k$ \u6b21\u884c\u7a0b\u3002\n\n\u8fd9\u4e2a\u98de\u6765\u98de\u53bb\u662f\u4e00\u4e2a\u5e73\u65b9\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u8003\u8651\u4f18\u5316\u8fd9\u4e00\u5f62\u5f0f\u3002\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\u4ece $u$ \u98de\u5230 $v$ \u540e\u5c31\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a\n\n$$dis_u + (u -v)^2 \\to dis_v$$\n\n$$dis_u + u^2 + v^2 - 2uv \\to dis_v$$\n\n\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u94a6\u5b9a $u < v$\uff0c\u7136\u540e\u659c\u7387\u4f18\u5316\u505a\u4e24\u904d\uff0c\u4f46\u662f\u611f\u89c9\u4e0d\u5982\u76f4\u63a5\u5199\u674e\u8d85\u6811\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u4f46\u662f\u66f4\u65b0\u540e\u7684\u70b9\u53ef\u4ee5\u5728\u8d70\u4e00\u4e9b\u8def\uff0c\u7136\u540e\u5c31\u4f1a\u66f4\u65b0\u5230\u4e00\u4e9b\u57ce\u5e02\u7684\u7b54\u6848\uff0c\u6240\u4ee5\u8003\u8651\u5148\u8fdb\u884c\u7b97\u5b8c\u659c\u7387\u4f18\u5316\uff0c\u518d\u8dd1\u4e00\u904d dijkstra \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $kn\\log (n+ m)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define int long long\n#define ls u << 1\n#define rs u << 1 | 1\n\nconst int N = 1e5 + 5, MOD = 998244353;\n\nstruct NODE {\n\tint u, w;\n\tbool operator < (const NODE & x) const {\n\t\treturn w > x.w;\n\t} \n};\n\npriority_queue <NODE> q;\nvector <pair<int, int>> e[N];\n\nstruct line {\n\tint k, b;\n\tline (int k = 0, int b = 1e16) : k(k), b(b) {}\t\n\tinline int val (int x) { return k * x + b; }\n} ;\n\nstruct lichaotree {\n\tline t[N << 2];\n\tinline void clear (int u, int l, int r) {\n\t\tif (l == r || t[u].k == 0) return ;\n\t\tt[u].k = 0, t[u].b = 1e18; \n\t\tint mid = (l + r) >> 1;\n\t\tclear(ls, l, mid), clear(rs, mid + 1, r);\n\t}\n\tinline void modify (int u, int l, int r, line x) {\n\t\tif (l == r) {\n\t\t\tif (x.val(l) < t[u].val(l)) t[u] = x; \n\t\t\treturn ;\n\t\t} int mid = (l + r) >> 1;\n\t\tif (x.val(mid) < t[u].val(mid)) swap(x, t[u]);\n\t\tif (x.val(l) < t[u].val(l)) modify(ls, l, mid, x);\n\t\tif (x.val(r) < t[u].val(r)) modify(rs, mid + 1, r, x);\n\t}\n\tinline int query (int u, int l, int r, int pos) {\n\t\tint res = t[u].val(pos), mid = (l + r) >> 1;\n\t\tif (l == r) return res;\n\t\tif (pos <= mid) return min(res, query(ls, l, mid, pos));\n\t\telse return min(res, query(rs, mid + 1, r, pos));\n\t}\n} lct;\n\nint n, m, k;\nint dist[N];\n\ninline void dijkstra () {\n\tfor (int i = 1; i <= n; i ++) q.push({i, dist[i]});\n\twhile (! q.empty()) {\n\t\tNODE t = q.top(); q.pop();\n\t\tint u = t.u, d = t.w;\n\t\tif (d != dist[u]) continue ;\n\t\tfor (auto & [v, w] : e[u])\n\t\t\tif (dist[v] > d + w) dist[v] = d + w, q.push({v, dist[v]});\n\t}\n}\n\nsigned main () {\n\tios :: sync_with_stdio(0);\n\tcin >> n >> m >> k;\n\tfor (int i = 1, u, v, w; i <= m; i ++) {\n\t\tcin >> u >> v >> w;\n\t\te[u].emplace_back(v, w), e[v].emplace_back(u, w);\n\t}\n\tfor (int i = 2; i <= n; i ++) dist[i] = 1e16;\n\tdijkstra();\n\tfor (int i = 1; i <= k; i ++) {\n\t\tlct.clear(1, 1, n);\n\t\tfor (int j = 1; j <= n; j ++)\n\t\t\tlct.modify(1, 1, n, line(-2 * j, j * j + dist[j]));\n\t\tfor (int j = 1; j <= n; j ++)\n\t\t\tdist[j] = min(dist[j], lct.query(1, 1, n, j) + j * j);\n\t\tdijkstra();\n\t}\n\tfor (int i = 1; i <= n; i ++) cout << dist[i] << \" \";\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1684147499,
        "uid": 307535,
        "name": "Cust10",
        "ccfLevel": 6,
        "title": "\u3010CF1715E\u3011Long Way Home"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1715E)\n\n\u5c5e\u4e8e\u662f $\\rm Div2\\ E$ \u91cc\u8f83\u6c34\u7684\u3002\n\n## \u601d\u8def\n\n\u53d1\u73b0\u8fd9\u4e2a $k$ \u975e\u5e38\u5c0f\uff0c\u8003\u8651\u8ddf $k$ \u6709\u5173\u7684\u590d\u6742\u5ea6\u3002\n\n\u4e00\u4e2a\u60f3\u6cd5\u662f\u679a\u4e3e $k$ \u6b21\uff0c\u6bcf\u6b21\u90fd\u628a $dis_i$ \u4e0e $dis_j+(i-j)^2$ \u53d6\u4e2a $\\min$\uff0c\u7136\u540e\u91cd\u65b0\u8dd1\u4e00\u904d $\\rm dij$\uff0c\u91cd\u65b0\u8dd1\u4e00\u904d $\\rm dij$ \u7684\u590d\u6742\u5ea6\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a $\\mathcal O(n^2)$ \u679a\u4e3e\u590d\u6742\u5ea6\u70b8\u4e86\u3002\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u806a\u660e\u7684\u4f60\u80af\u5b9a\u4e00\u773c\u770b\u51fa\u8fd9\u4e2a\u67ff\u5b50\u53ef\u4ee5\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u8bbe $dis_i$ \u662f\u7531 $j$ \u8f6c\u79fb\u8fc7\u6765\u7684\uff0c\u6211\u4eec\u9700\u8981\u8bc1\u660e $dis_{i+1}$ \u7684\u8f6c\u79fb\u70b9 $\\ge j$\u3002\n\n\u5047\u8bbe $dis_{i+1}$ \u7684\u8f6c\u79fb\u70b9\u4e3a $k$ \u4e14 $k<j$\uff0c\u5219 $dis_k+(k-(i+1))^2 < dis_j+(j-(i+1))^2$\n\n$dis_k+(k-i)^2-2 \\times (k-i)+1^2<dis_j+(j-i)^2-2 \\times (j-i)+1^2$\n\n$dis_k+(k-i)^2-2 \\times k<dis_j+(j-i)^2-2 \\times j$\n\n\u8bbe $A=dis_k+(k-i)^2,B=-2 \\times k,C=dis_j+(j-i)^2,D=-2 \\times j$\n\n\u663e\u7136 $A \\ge C,B \\ge D$\n\n\u6240\u4ee5 $A+B \\ge C+D$\uff0c\u4e0e $A+B<C+D$ \u77db\u76fe\uff0c\u6545 $k \\ge j$\u3002\n\n\u77e5\u9053\u4e86\u8fd9\u4e2a\u5c31\u53ef\u4ee5\u659c\u4f18\u4e86\uff0c\u4e0d\u8fc7\u5206\u6cbb\u597d\u5199\uff0c\u90a3\u5c31\u5199\u5206\u6cbb\u5427\u3002\n\n## \u4ee3\u7801\n\n```cpp\n//A tree without skin will surely die.\n//A man without face is invincible.\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define sqr(x) ((x)*(x))\n#define all(x) (x).begin(),(x).end()\n#define Tim ((double)clock()/CLOCKS_PER_SEC)\n#define mid ((l+r)>>1)\n#define lowbit(x) (x&-x)\nint const N=1e5+10;\nint dis[N],s[N],has[N],n;\nvector< pair<int,int> >a[N];\ninline void solve(){\n\tpriority_queue< pair<int,int>,deque< pair<int,int> >,greater< pair<int,int> > >q;\n\tmemset(has,0,sizeof(has));\n\tfor (int i=1;i<=n;++i) q.push({dis[i],i});\n\twhile (!q.empty()){\n\t\tint x=q.top().second;\n\t\tq.pop();\n\t\tif (has[x]) continue;\n\t\thas[x]=1;\n\t\tfor (auto [v,w]:a[x])\n\t\t\tif (dis[v]>dis[x]+w){\n\t\t\t\tdis[v]=dis[x]+w;\n\t\t\t\tq.push({dis[v],v});\n\t\t\t}\n\t}\n}\ninline void work(int l,int r,int L,int R){\n\t// [l,r] [L,R]\n\tif (l>r) return;\n\tint res=9e18,resw=0;\n\tfor (int i=L;i<=R;++i){\n\t\tint now=dis[i]+sqr(i-mid);\n\t\tif (now<res) res=now,resw=i;\n\t}\n\ts[mid]=res;\n\twork(l,mid-1,L,resw);\n\twork(mid+1,r,resw,R);\n}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0),cout.tie(0);\n\tint m,k;cin>>n>>m>>k;\n\twhile (m--){int u,v,w;cin>>u>>v>>w;a[u].push_back({v,w}),a[v].push_back({u,w});}\n\tmemset(dis,0x3f,sizeof(dis));dis[1]=0;\n\tsolve();\n\twhile (k--){\n\t\twork(1,n,1,n);\n\t\tfor (int i=1;i<=n;++i) dis[i]=s[i];\n\t\tsolve();\n\t}\n\tfor (int i=1;i<=n;++i) cout<<dis[i]<<' ';\n\tcout<<'\\n';\n\treturn 0;\n}\n```",
        "postTime": 1672646315,
        "uid": 253608,
        "name": "Tx_Lcy",
        "ccfLevel": 7,
        "title": "CF1715E Long Way Home"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u975e\u5e38\u663e\u7136\u7684\u60f3\u6cd5\uff1a\n\n- \u5efa\u7acb $k+1$ \u5c42\u7684\u5206\u5c42\u56fe\uff0c\u7b2c $i$ \u5c42\u8868\u793a\u4e58\u5750\u4e86 $i$ \u6b21\u822a\u73ed\u3002\u5bf9\u4e8e\u6bcf\u4e00\u5c42\u6309\u7167\u539f\u56fe\u5efa\u8fb9\uff0c\u7136\u540e\u8ba9\u7b2c $i$ \u5c42\u7684\u70b9 $u$ \u5411\u7b2c $i+1$ \u5c42\u7684\u70b9 $v$ \u5efa\u4e00\u6761 $(u_i,v_{i+1},(u-v)^2)$ \u7684\u6709\u5411\u8fb9\u3002\n\n\u8fd9\u6837\u663e\u7136\u662f $O(k(n^2+m)\\log m)$ \u7684\u3002\u5b83\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e\u4e0d\u540c\u5c42\u4e4b\u95f4\u8fde\u7684\u90a3\u4e00\u6761 $(u-v)^2$ \u7684\u8fb9\uff0c\u8db3\u8db3\u6709 $n^2$ \u6761\u3002\n\n\u4f46\u8fd9\u4e2a\u8fb9\u6743 $(u-v)^2$ \u5341\u5206\u7279\u6b8a\uff0c\u867d\u7136\u4e0d\u80fd\u591f\u901a\u8fc7\u56fe\u8bba\u6a21\u578b\u6765\u8868\u793a\uff0c\u4f46\u5728 DP \u4e2d\u5f88\u597d\u7ef4\u62a4\u3002\n\n$$\n\\begin{aligned}\ndis_i&=\\min_{j=1}^n dis_j+(i-j)^2\\\\\\\\\n&=dis_j+i^2-2ij+j^2\\\\\ndis_i-i^2&=dis_j+j^2-2ij\n\\end{aligned}\n$$\n\n\u4e0d\u59a8\u4ee4 $b=dis_i-i^2,y=dis_j+j^2,k=2i,x=j$\uff0c\u90a3\u4e48\u5c31\u662f $b=y-kx$ \u7684\u659c\u7387\u4f18\u5316\u5f62\u5f0f\u3002\n\n\u901a\u8fc7\u8fd9\u79cd\u659c\u7387\u4f18\u5316 DP\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u4ece\u7b2c $i$ \u5c42\u7684 $dis$ \u5e8f\u5217\u63a8\u51fa\u6765\u7b2c $i+1$ \u5c42 $dis$ \u5e8f\u5217\u7684\u521d\u59cb\u72b6\u6001\u3002\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u5c31\u662f\u5728\u4f18\u5316\u4e0d\u540c\u5c42\u4e4b\u95f4\u7684\u677e\u5f1b\u8fc7\u7a0b\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u5c42\uff0c\u5148\u505a\u4e00\u6b21\u6700\u77ed\u8def\u7b97\u6cd5\uff0c\u518d\u505a\u4e00\u6b21 DP\uff0c\u6700\u540e\u518d\u7edf\u4e00\u8dd1\u4e00\u6b21\u6700\u77ed\u8def\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(k(n+m\\log m))$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define For(i,a,b) for(int i=(a);i<=(b);++i)\n#define Rof(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\nconst int Maxn=1e5;\nconst ll inf=1e18;\n\ninline int read()\n{\n    char ch=getchar();\n    int f=1,x=0;\n    while(ch>'9' || ch<'0')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9')\n    {\n        x=x*10+ch-'0';\n        ch=getchar();\n    }\n    return x*f;\n}\n\nstruct Node{int frm,to,nxt,w;} Edge[Maxn*2+5];\nint tot,Head[Maxn+5];\ninline void Addedge(int x,int y,int z)\n{\n    Edge[++tot]=(Node){x,y,Head[x],z};\n    Head[x]=tot;\n}\nint n,m,K,Q[Maxn+5],head,tail;\nll dis[Maxn+5],vis[Maxn+5],Y[Maxn+5];\nstruct Group\n{\n    int x; ll y;\n    inline Group() {}\n    inline Group(int _x,ll _y): x(_x),y(_y) {}\n};\ninline bool operator<(Group a,Group b) {return a.y>b.y;}\npriority_queue<Group> q;\n\ninline void Dijkstra()\n{\n    For(i,1,n) q.push(Group(i,dis[i])),vis[i]=0;\n    while(!q.empty())\n    {\n        int x=q.top().x; q.pop();\n        if(vis[x]) continue;\n        vis[x]=1;\n        for(int i=Head[x];i;i=Edge[i].nxt)\n        {\n            int y=Edge[i].to;\n            if(!vis[y] && dis[x]+Edge[i].w<dis[y])\n            {\n                dis[y]=dis[x]+Edge[i].w;\n                q.push(Group(y,dis[y]));\n            }\n        }\n    }\n}\ninline double Slope(int a,int b) {return 1.0*(Y[a]-Y[b])/(a-b);}\ninline void DP()\n{\n    head=1,tail=0;\n    For(i,1,n) Y[i]=dis[i]+1ll*i*i;\n    For(i,1,n)\n    {\n        while(head<tail && Slope(Q[tail],Q[tail-1])>=Slope(i,Q[tail-1])) tail--;\n        Q[++tail]=i;\n    }\n    For(i,1,n)\n    {\n        while(head<tail && Slope(Q[head],Q[head+1])<=i*2) head++;\n        int j=Q[head];\n        dis[i]=Y[j]-2ll*i*j+1ll*i*i;\n    }\n}\n\nint main()\n{\n    n=read(),m=read(),K=read();\n    For(i,1,n) dis[i]=inf;\n    dis[1]=0;\n    For(i,1,m)\n    {\n        int a=read(),b=read(),c=read();\n        Addedge(a,b,c),Addedge(b,a,c);\n    }\n    Dijkstra();\n    For(i,1,K) DP(),Dijkstra();\n    For(i,1,n) printf(\"%lld \",dis[i]);\n    printf(\"\\n\");\n    return 0;\n}\n```",
        "postTime": 1668494499,
        "uid": 148913,
        "name": "Graphcity",
        "ccfLevel": 8,
        "title": "\u9898\u89e3  CF1715E\u3010Long Way Home\u3011"
    },
    {
        "content": "### CF1715E \u9898\u89e3\n\n[\u535a\u5ba2\u98df\u7528\u6548\u679c\u66f4\u4f73](https://www.cnblogs.com/lxy-2022/p/CF1715E-Solution.html)\n\n#### \u9898\u610f\n\n\u4e00\u4e2a\u5e26\u8fb9\u6743\u65e0\u5411\u56fe\uff0c\u53ef\u4ee5\u6cbf\u7740\u8fb9\u8d70\uff0c\u9700\u8981\u8fb9\u6743\u7684\u82b1\u8d39\u6216\u4ece\u4efb\u610f\u70b9 $u$ \u98de\u5230 $v$\uff0c\u9700\u8981 $(u-v)^2$ \u7684\u82b1\u8d39\u3002\u6c42\u4ece\u70b9 $1$ \u5230\u6240\u6709 $i$ \u7684\u6700\u5c11\u82b1\u8d39\u3002\u6700\u591a\u98de $k$ \u6b21\u3002\n\n#### \u5206\u6790\n\n\u4e00\u773c\u6700\u77ed\u8def + dp\u3002\n\n\u53d1\u73b0 $k$ \u5f88\u5c0f\uff0c\u53ef\u4ee5\u679a\u4e3e\u98de\u7684\u6b21\u6570\uff0c\u5bf9\u4e8e\u70b9 $u$\uff0c\u53ef\u4ee5\u662f\u8d70\u5230 $u$\uff0c\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u7528\u6700\u77ed\u8def\u66f4\u65b0\u7b54\u6848\uff1b\u4e5f\u53ef\u4ee5\u662f\u98de\u5230 $u$\uff0c\u6b64\u65f6\u53ef\u4ee5 dp\uff0c$dp_i$ \u8868\u793a\u4ece $1$ \u5230 $i$ \u6700\u5c0f\u82b1\u8d39\uff0c\u8f6c\u79fb\u65b9\u7a0b\u5f88\u663e\u7136\uff1a\n$$\ndp_i=\\min\\limits_{t=1}^n(dis_t+(i-t)^2)\n$$\n\uff0c\u5176\u4e2d $dis_i$ \u8868\u793a\u4e0a\u4e2a $k$ \u7b97\u51fa\u7684 $1$ \u5230 $i$ \u6700\u5c11\u82b1\u8d39\u3002\u6b64\u65f6\u6700\u5916\u5c42\u5faa\u73af $k$\uff0c\u4e2d\u5c42\u5faa\u73af $i$\uff0c\u5185\u5c42\u5faa\u73af $t$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(kn^2)$\uff0c\u53d1\u73b0\u4f1a T\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u662f\u4e2a\u5178\u578b\u7684\u659c\u7387\u4f18\u5316\u5f62\u5f0f\uff0c\u53ef\u4ee5\u53d8\u5f62\u6210\uff1a\n$$\ndp_i=\\min\\limits_{t=1}^n(dis_t+(i-t)^2) \n=\\min\\limits_{t=1}^n(dis_t+t^2-2it)+i^2\n$$\n\u4e5f\u5c31\u8f6c\u5316\u6210\u4e86\u6c42 $x=i$ \u65f6\u6240\u6709\u76f4\u7ebf $y=-2tx+(dis_t+t^2)$ \u7684\u6700\u5c0f\u503c\u52a0\u4e0a $i^2$ \u7684\u503c\u3002\u53ef\u4ee5\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u65b9\u4fbf\u5730\u6c42\u51fa\u3002\n\n[code](https://codeforc.es/problemset/submission/1715/171185147)\n\n",
        "postTime": 1662518384,
        "uid": 225991,
        "name": "_lxy_",
        "ccfLevel": 6,
        "title": "CF1715E Long Way Home \u9898\u89e3"
    },
    {
        "content": "**\u6d1b\u8c37\u4f20\u9001\u95e8\uff1a** [CF1715E Long Way Home](https://www.luogu.com.cn/problem/CF1715E)\n\n-------------------------------\n\n\u4e2a\u4eba\u611f\u89c9\u4e0d\u9519\u7684\u4e00\u9053\u56fe\u8bba+dp\u7684\u9898\u76ee\n\n-------------------------------\n\n\u9996\u5148\u5e94\u5f53\u60f3\u5230\u4ece\u57ce\u5e02 $1$ \u5230 $i$ \u7684\u8def\u7a0b\u5fc5\u7136\u53ef\u4ee5\u770b\u4f5c\u662f\u5148\u8d70\u82e5\u5e72\u6761\uff08\u53ef\u80fd\u662f\u96f6\u6761\uff09\u9053\u8def\uff0c\u7136\u540e\u4e58\u5750\u4e00\u6b21\u822a\u73ed\uff0c\u518d\u8d70\u82e5\u5e72\u6761\u9053\u8def\uff0c\u7136\u540e\u518d\u6b21\u4e58\u5750\u4e00\u6b21\u822a\u73ed\u2026\u2026\u5982\u6b64\u5faa\u73af\u4e0d\u8d85\u8fc7 $k$ \u6b21\u5f97\u5230\u3002\u5176\u6b21\u6ce8\u610f\u5230 $k \\le 20$ \u7684\u6570\u636e\u8303\u56f4\uff0c\u4e0d\u96be\u8003\u8651\u5230\u53ef\u4ee5\u901a\u8fc7\u67d0\u4e9b\u7b97\u6cd5\u7ef4\u62a4\u4e00\u8f6e\u884c\u52a8\uff0c\u7136\u540e\u76f4\u63a5\u66b4\u529b\u7ef4\u62a4 $k$ \u8f6e\u5373\u53ef\u3002\n\n\u8bb0 $\\{dis_i\\}$ \u4e3a\u4e0a\u4e00\u8f6e\u7ed3\u675f\u540e\u4ece $1$ \u5230 $i$ \u70b9\u7684\u6700\u77ed\u8def\uff0c\u521d\u59cb $dis_1=0$\uff0c\u5176\u4f59\u5168\u4e3a $+\\infty$\u3002\n\n\u9996\u5148\u8003\u8651\u8d70\u82e5\u5e72\u6761\u9053\u8def\u7684\u90e8\u5206\uff0c\u5efa\u7acb\u8d85\u7ea7\u6e90\u70b9 $S$\uff0c\u4ece $S$ \u5411\u70b9 $i$ \u8fde\u8fb9\u6743\u4e3a $dis_i$ \u7684\u6709\u5411\u8fb9\uff0c\u7136\u540e\u8dd1\u4e00\u904d $\\text{Dijkstra}$ \u5373\u53ef\uff0c\u8fd9\u662f\u56fe\u8bba\u4e2d\u7684\u5e38\u89c1\u5957\u8def\uff0c\u6bd4\u8f83\u663e\u7136\u3002\n\n\u7136\u540e\u8003\u8651 $\\text{dp}$ \u4ee5\u7ef4\u62a4\u4e58\u5750\u822a\u73ed\u7684\u90e8\u5206\uff0c\u6211\u4eec\u6709\uff1a\n\n$$\ndis'_i = \\min_{1 \\le j \\le n} \\{dis_j+(i-j)^2\\}\n$$\n\n\u4e0d\u59a8\u4ee4 $j \\le i$ \uff0c\u5bf9\u4e8e $j > i$ \u90e8\u5206\u7684\u8d21\u732e\u53ef\u4ee5\u5012\u7740\u518d\u505a\u4e00\u904d $\\text{dp}$\uff0c\u53d1\u73b0\u8fd9\u5c31\u662f\u7ecf\u5178\u659c\u7387\u4f18\u5316\u7684\u5f0f\u5b50\uff1a\n\n$$\n2ij+dis'_i-i^2=dis_j+j^2\n$$\n\n\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e0b\u51f8\u5305\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n//CF1715E Long Way Home\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\nconst int MAXN = 1e5+5;\nconst ll INF = 0x3fffffffffffffff;\n\nint n, m, k;\nll dis[MAXN], f[MAXN];\nbool flag[MAXN];\n\nvector<pair<int, ll> > G[MAXN];\npriority_queue<pair<ll, int> > Q;\n\nvoid dijkstra() {\n    memset(dis, 0x3f, sizeof(dis));\n    memset(flag, 0, sizeof(flag));\n    dis[0] = 0;\n    Q.push(make_pair(0, 0));\n    while (!Q.empty()) {\n        int top = Q.top().second;\n        Q.pop();\n        if (flag[top]) continue;\n        flag[top] = 1;\n        for (auto to : G[top])\n            if (dis[to.first] > dis[top] + to.second) {\n                dis[to.first] = dis[top] + to.second;\n                Q.push(make_pair(-dis[to.first], to.first));\n            }\n    }\n}\n\nint Q1[MAXN];\nint head, tail;\n\ninline ll X(int x) { return x; }\ninline ll Y(int x) { return dis[x] + (ll) x * x; }\ninline long double slope(int a, int b) { return (long double) (Y(b) - Y(a)) / (X(b) - X(a)); }\n\ninline void dp() {\n    head = 1, tail = 0;\n    Q1[++tail] = 1;\n    for (int i = 2; i <= n; i++) {\n        while (head < tail && slope(Q1[head], Q1[head + 1]) < 2 * i) head++;\n        f[i] = min(dis[i], dis[Q1[head]] + (ll) (i - Q1[head]) * (i - Q1[head]));\n        while (head < tail && slope(i, Q1[tail]) < slope(i, Q1[tail - 1])) tail--;\n        Q1[++tail] = i;\n    }\n\n    head = 1, tail = 0;\n    Q1[++tail] = n;\n    for (int i = n - 1; i; i--) {\n        while (head < tail && slope(Q1[head], Q1[head + 1]) > 2 * i) head++;\n        f[i] = min(f[i], dis[Q1[head]] + (ll) (i - Q1[head]) * (i - Q1[head]));\n        while (head < tail && slope(i, Q1[tail]) > slope(i, Q1[tail - 1])) tail--;\n        Q1[++tail] = i;\n    }\n\n    for (auto &to : G[0]) to.second = f[to.first];\n}\n\nvoid solve() {\n    scanf(\"%d%d%d\", &n, &m, &k);\n    for (int i = 1; i <= m; i++) {\n        int u, v, x;\n        scanf(\"%d%d%d\", &u, &v, &x);\n        G[u].emplace_back(v, x);\n        G[v].emplace_back(u, x);\n    }\n\n    G[0].emplace_back(1, 0);\n    for (int i = 2; i <= n; i++) G[0].emplace_back(i, INF);\n    \n    for (int i = 1; i <= k; i++) {\n        dijkstra();\n        dp();\n    }\n\n    dijkstra();\n\n    for (int i = 1; i <= n; i++) printf(\"%lld \", dis[i]);\n}\n\nint main() {\n    solve();\n    return 0;\n}\n```",
        "postTime": 1661182911,
        "uid": 261935,
        "name": "Unique_Hanpi",
        "ccfLevel": 0,
        "title": "CF1715E Long Way Home \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u70b9\uff0c$m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe\uff0c\u8fb9\u6709\u8fb9\u6743\uff0c\u53ef\u4ee5\u987a\u7740\u8fb9\u8d70\u4ea7\u751f\u5927\u5c0f\u4e3a\u8fb9\u6743\u7684\u4ee3\u4ef7\uff0c\u4e5f\u53ef\u4ee5\u4ece $u$ \u70b9\u4f20\u9001\u5230 $v$ \u70b9\u5e76\u4ea7\u751f $(u-v)^2$ \u7684\u4ee3\u4ef7\uff0c\u81f3\u591a\u4f20\u9001 $k$ \u6b21\uff0c\u6c42\u4ece $1$ \u53f7\u70b9\u51fa\u53d1\u5230 $n$ \u4e2a\u70b9\u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n## \u601d\u8def\n\n\u6700\u77ed\u8def\u548c\u659c\u7387\u4f18\u5316 $dp$\u3002\n\n\u8003\u8651\u8bbe\u8ba1\u72b6\u6001\uff0c$f[i][u]$ \u8868\u793a\u5df2\u7ecf\u4f20\u9001\u4e86 $i$ \u6b21\uff0c\u6b64\u65f6\u5728 $u$ \u53f7\u70b9\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u663e\u7136\u5f53 $i=0$ \u65f6\uff0c\u76f4\u63a5\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8003\u8651\u5982\u4f55\u8f6c\u79fb $i-1\\to i$\uff0c\u5148\u8ba8\u8bba\u6700\u540e\u4e00\u6b21\u884c\u52a8\u662f\u4f20\u9001\u7684\u60c5\u51b5\uff0c\u8f6c\u79fb\u4e3a\uff1a\n\n$\n\\begin{aligned}\nf[i][u]=\\min_{v}\\{f[i-1][v]+(u-v)^2\\}\n\\end{aligned}\n$\n\n\u7b2c\u4e00\u7ef4\u5b8c\u5168\u53ef\u4ee5\u4e0d\u8981\uff0c\u4f18\u5316\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a\n\n$\n\\begin{aligned}\nf[u]=\\min_{v}\\{f[v]+(u-v)^2\\}\n\\end{aligned}\n$\n\n\u7136\u540e\u8ba8\u8bba\u6700\u540e\u4e00\u6b21\u884c\u52a8\u662f\u5728\u8fb9\u4e0a\u8d70\u7684\u60c5\u51b5\uff0c\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u4f46\u662f\u8fd9\u6837\u8f6c\u79fb\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\uff0c\u65e0\u6cd5\u63a5\u53d7\u3002\n\n\u8003\u8651\u7528\u659c\u7387\u4f18\u5316\u7684\u65b9\u5f0f\u5feb\u901f\u6c42\u51fa\u51b3\u7b56\u70b9 $v$\uff0c\u5c06\u539f\u5f0f\u7684 $\\min$ \u53bb\u6389\uff0c\u5c55\u5f00\u79fb\u9879\u5f97\u5230\uff1a\n\n$\n\\begin{aligned}\nf[v]+v^2=2u\\times v+f[u]-u^2\n\\end{aligned}\n$\n\n\u8f6c\u5316\u4e3a\u4e00\u6b21\u51fd\u6570 $y=kx+b$ \u7684\u5f62\u5f0f\u5f97\u5230\uff1a\n\n$\\left\\{\n\\begin{array}{l}\ny=f[v]+v^2 \\\\\nk=2u \\\\\nx=v \\\\\nb=f[u]-u^2\n\\end{array}\n\\right.$\n\n\u5bf9\u5e94\u5f62\u6210\u7684\u70b9\u7684\u5750\u6807\u5c31\u662f $(v,f[v]+v^2)$\uff0c\u6700\u5c0f\u5316 $f[u]$ \u5c31\u662f\u6700\u5c0f\u5316\u622a\u8ddd $b$\uff0c\u53c8\u56e0\u4e3a\u4ece $1$ \u5230 $n$\uff0c\u659c\u7387 $k$ \u5355\u8c03\u9012\u589e\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u5373\u53ef\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define int long long\nconst int N = 1E5 + 10;\nint n, m, k;\nint f[N], g[N], ans[N];\nbool vis[N];\n\nstruct Edge\n{\n\tint nxt, to, val;\n}G[N * 4];\nint head[N], cnt;\n\nvoid add(int u, int v, int w)\n{\n\tG[++cnt].nxt = head[u];\n\tG[cnt].to = v;\n\tG[cnt].val = w;\n\thead[u] = cnt;\n}\n\nvoid spfa()\n{\n\tqueue<int> Q;\n\tmemset(vis, 0, sizeof(vis));\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\tQ.push(i);\n\t\tvis[i] = 1;\n\t}\n\twhile(!Q.empty())\n\t{\n\t\tint u = Q.front();\n\t\tQ.pop();\n\t\tvis[u] = 0;\n\t\tfor(int i = head[u]; i; i = G[i].nxt)\n\t\t{\n\t\t\tint v = G[i].to;\n\t\t\tif(f[v] > f[u] + G[i].val)\n\t\t\t{\n\t\t\t\tf[v] = f[u] + G[i].val;\n\t\t\t\tif(!vis[v])\n\t\t\t\t{\n\t\t\t\t\tQ.push(v);\n\t\t\t\t\tvis[v] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nint X(int j){return j;}\nint Y(int j){return g[j] + j * j;}\ndouble slope(int i, int j){return (X(i) - X(j)) ? (double)(Y(i) - Y(j)) / (double)(X(i) - X(j)) : 2100000000;}\n\nsigned main()\n{\n\tmemset(ans, 0x3f, sizeof(ans));\n\tcin >> n >> m >> k;\n\tfor(int i = 1; i <= m; i++)\n\t{\n\t\tint u, v, w;\n\t\tcin >> u >> v >> w;\n\t\tadd(u, v, w);\n\t\tadd(v, u, w);\n\t}\n\tmemset(f, 0x3f, sizeof(f));\n\tf[1] = 0;\n\tspfa();\n\twhile(k--)\n\t{\n\t\tint Q[N];\n\t\tint h = 1, t = 0;\n\t\tmemset(Q, 0, sizeof(Q));\n\t\tmemcpy(g, f, sizeof(g));\n\t\tfor(int i = 1; i <= n; i++)\n\t\t{\n\t\t\twhile(h < t && slope(Q[t - 1], Q[t]) >= slope(Q[t], i))\n\t\t\t\tt--;\n\t\t\tQ[++t] = i;\n\t\t}\n\t\tfor(int i = 1; i <= n; i++)\n\t\t{\n\t\t\twhile(h < t && slope(Q[h], Q[h + 1]) <= (double)i * 2.0)\n\t\t\t\th++;\n\t\t\tf[i] = g[Q[h]] + (i - Q[h]) * (i - Q[h]);\n\t\t}\n\t\tspfa();\n\t\tfor(int i = 1; i <= n; i++)\n\t\t\tans[i] = min(ans[i], f[i]);\n\t}\n\tfor(int i = 1; i <= n; i++)\n\t\tcout << ans[i] << \" \";\n\treturn 0;\n}\n```\n",
        "postTime": 1661074185,
        "uid": 302573,
        "name": "tangtangpeng",
        "ccfLevel": 6,
        "title": "CF1715E Long Way Home"
    }
]