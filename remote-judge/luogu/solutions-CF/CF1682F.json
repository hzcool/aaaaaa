[
    {
        "content": "~~\u5b8c\u5168\u4e0d\u77e5\u9053\u8fd9\u9898\u7684\u9898\u89e3\u5728\u8bf4\u4ec0\u4e48\uff1f\uff1f\uff1f\uff1f\u628a\u975e\u5e38\u7b80\u5355\u7684\u4e1c\u897f\u641e\u5f97\u770b\u4e0a\u53bb\u5f88\u590d\u6742\u3002~~\n\n\u6ce8\u610f\u5230 $a$ \u662f\u9012\u589e\u7684\u3002\u53ef\u4ee5\u628a\u56fe\u60f3\u8c61\u6210\u8fd9\u6837\uff1a\u4e2d\u95f4\u7684\u8fb9\u4e0d\u662f\u76f4\u63a5\u8fde $O(n^2)$ \u6761\uff0c\u800c\u662f\u5728\u76f8\u90bb\u4e4b\u95f4\u8fde\u53cc\u5411\u8fb9\uff0c\u8d39\u7528\u4e3a $(a_i-a_{i-1})$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u95ee\u9898\u4e0e [LNOI2022] \u76d2 \u5b8c\u5168\u7b49\u4ef7\u3002\u8003\u8651\u6bcf\u6761\u8fb9\u88ab\u7ecf\u8fc7\u7684\u6b21\u6570\uff0c\u7acb\u5f97\u7b54\u6848\u4e3a\n\n$$\n\\sum_{l\\le i<r}(a_{i+1}-a_i)|s_i-s_{l-1}|\n$$\n\n$s$ \u662f $b$ \u7684\u524d\u7f00\u548c\u3002\u7528\u4efb\u4f55\u65b9\u5f0f\u8ba1\u7b97\u90fd\u662f $O(n\\log n)$\u3002",
        "postTime": 1654438523,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "[shitpost] CF1682F"
    },
    {
        "content": "# CF1682F [MCMF?](https://codeforces.com/problemset/problem/1682/F)\n\n~~\u9ad8\u96be\u5ea6\u7d2b\u5c5e\u4e8e\u662f~~\n\n~~\u53cd\u6b63\u9898\u89e3\u5199\u8d77\u6765\u8fd8\u633a\u590d\u6742\u5ea6\uff0c\u4ee3\u7801\u5c31\u8fd8\u884c~~\n\n## \u7b2c\u4e00\u6b65\n\n**\u62c6\u70b9**\u3002\u628a $i$ \u62c6\u6210 $|b_i|$ \u4e2a\u70b9\uff0c\u7136\u540e\u8fd9 $|b_i|$ \u4e2a\u70b9\u548c\u4e4b\u524d\u4e00\u6837\u8fde\u8fb9\u3002\n\n\u6b64\u65f6\u5c31\u662f\u5de6\u53f3\u6709\u76f8\u540c\u6570\u91cf\u7684\u70b9\uff0c\u7136\u540e\u4e24\u4e2a\u70b9 $(u, v)$ \u76f8\u8fde\u7684\u82b1\u8d39\u662f $|a_u-a_v|$\uff0c\u8981\u628a\u5de6\u53f3\u90fd\u5339\u914d\u7684\u6700\u5c0f\u82b1\u8d39\u3002\n\n\u6b64\u65f6\u6700\u4f18\u89e3\u663e\u7136\u662f\u5de6\u53f3\u5206\u522b\u6309 $a_i$ \u6392\u5e8f\uff0c\u7136\u540e\u5de6\u8fb9 $i$ \u8fde\u53f3\u8fb9 $i$\u3002\n\n\u53ef\u4ee5\u53cd\u8bc1\uff0c\u8bbe\u6709\u4e00\u4e2a\u522b\u7684\u6784\u9020\uff0c\u8fde\u4e86 $(u_i,v_i),(u_j,v_j),u_i\\neq v_i, u_j\\neq v_j$\uff0c\u8bfb\u8005\u81ea\u8bc1\u4e0d\u96be\u3002\n\n## \u7b2c\u4e8c\u6b65\n\n\u6b64\u65f6\u5df2\u7ecf\u6709 $\\Theta(\\sum b_i)$ \u56de\u7b54\u8be2\u95ee\u7684\u505a\u6cd5\u4e86\uff0c\u663e\u7136\u5bc4\u3002\u74f6\u9888\u5728\u4e8e\u7edd\u5bf9\u503c\uff0c\u8003\u8651\u62c6\u7edd\u5bf9\u503c\u3002\n\n\u4e00\u4e2a $(a_i,b_i), (b_i>0)$\uff0c\u5373\u4e00\u4e2a\u53f3\u534a\u90e8\u5206\u7684\u70b9\u7684\u8d21\u732e\u662f\u6b63\u8fd8\u662f\u8d1f\u53d6\u51b3\u4e8e\u524d\u9762\u8fd8\u5269\u4e0b\u591a\u5c11\u4e2a\u5de6\u534a\u90e8\u5206\u7684\u70b9\uff1b\u8bb0\u524d\u7f00\u548c $s_i=\\sum\\limits_{k=1}^i b_i$\u3002\n\n\uff08\u4e3a\u65b9\u4fbf\uff0c\u4e0b\u6587\u4e2d $s$ \u51fa\u73b0\u65f6\uff0c\u5b9e\u9645\u610f\u4e49\u4e0a\u4e0b\u6807\u5747\u542b $-1$\uff0c\u4e8e\u662f\u5c06 $s$ \u53f3\u79fb\uff0c\u4e0b\u6587\u7684 $s_p$ \u8868\u793a\u5b9e\u9645\u7684 $s_p-1$\uff09\n\n\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee $[l,r]$\uff0c\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e2a $b_i$\uff0c\u5728 $O(r-l)$ \u5185\u505a\u5b8c\uff1a\n\n1. $b_i > 0, \\Delta =s_{i} - s_{l} < 0$\uff0c\u5de6\u8fb9\u90e8\u5206\u7684\u70b9\u8fd8\u6709\u5269\u4e0b\u7684\u3002\n   1. $|b_i| \\le |\\Delta|$\uff1a\u8d21\u732e\u662f $a_i|b_i|$\uff1b\n   2. $|b_i| > |\\Delta|$\uff1a\u8d21\u732e\u662f $2a_i|\\Delta|-a_i|b_i|$\u3002\n2. $b_i>0, \\Delta \\ge 0$\uff0c\u6ca1\u6709\u5de6\u534a\u90e8\u5206\u70b9\uff0c\u8d21\u732e\u662f $-a_i|b_i|$\u3002\n\n$b_i<0$ \u540c\u7406\u3002\n\n## \u7b2c\u4e09\u6b65\n\n\u73b0\u5728\u590d\u6742\u5ea6\u662f $O(nq)$ \u7684\uff0c\u663e\u7136\u5bc4\u3002\u8003\u8651\u80fd\u5426\u5feb\u901f\u56de\u7b54\u8be2\u95ee\u3002\n\n\u8bb0\u540e\u7f00 $i$ \u7684\u7b54\u6848\u4e3a $\\mathrm{ans}_i$\uff0c\u4f1a\u53d1\u73b0\u8be2\u95ee $[l,r]$ \u7684\u7b54\u6848\u4e3a $\\mathrm{ans}_l - \\mathrm{ans}_{r+1}$\u3002~~\uff08\u524d\u7f00\u4e5f\u5c31\u7b97\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u6709\u4eba\u89c2\u5bdf\u540e\u7f00\u6027\u8d28\u554a\u5582~~\n\n\u539f\u56e0\u5728\u4e8e\uff0c$\\sum\\limits_{i=l}^rb_i=0$\uff0c\u5bf9\u4e8e\u540e\u7f00 $l$ \u7684\u7b54\u6848\uff0c$[l,r]$ \u548c $(r, n]$ \u662f\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\u7684\uff0c\u8ba1\u7b97 $(r, n]$ \u65f6\u7684\u8d77\u59cb\u72b6\u6001\uff0c\u548c\u8ba1\u7b97\u540e\u7f00 $r+1$ \u7684\u8d77\u59cb\u72b6\u6001\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002\n\n## \u7b2c\u56db\u6b65\n\n\u73b0\u5728\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\uff08\u6bcf\u6b21\u91cd\u65b0\u7b97\u540e\u7f00\u7b54\u6848\uff09\uff0c\u8003\u8651\u600e\u4e48\u5feb\u901f\u8ba1\u7b97 $\\mathrm{ans}_i$\u3002\n\n\u7ecf\u5178\u8003\u8651 $(a_i, b_i)$ \u5bf9\u6240\u6709\u540e\u7f00 $1,2,\\dots,i$ \u7684\u8d21\u732e\u3002\u53d1\u73b0\u8d21\u732e\u548c\u4e00\u4e2a\u540e\u7f00 $k$ \u6ca1\u4ec0\u4e48\u5c41\u5173\u7cfb\uff0c\u53ea\u548c $s_{k}$ \u6709\u5173\u7cfb\u3002\n\n\u4e8e\u662f\u5f00\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u4ece $1\\sim n$ \u904d\u5386\u540e\u7f00 $k$\uff1a\n\n1. \u5148\u7ed9 $\\mathrm{ans}_k$ \u8d4b\u503c\u4e3a $-\\mathrm{val}_{s_k}$\uff0c\u8fd9\u91cc\u7684 $\\mathrm{val}_p$ \u6307\u7684\u662f\u7ebf\u6bb5\u6811\u4e0a\u4f4d\u7f6e $p$ \u7684\u503c\u3002\n2. \u518d\u6839\u636e\u7b2c\u4e8c\u6b65\u6dfb\u52a0\u8d21\u732e\u3002\n3. \u904d\u5386\u5b8c\u6240\u6709\u540e\u7f00\u540e\uff0c\u67e5\u8be2 $1\\sim n$\uff0c\u4ee4 $\\mathrm{ans}_k \\gets \\mathrm{ans}_k + \\mathrm{val}_{s_k}$\u3002\n\n\u5173\u4e8e\u6dfb\u52a0\u8d21\u732e\uff0c\u4f1a\u53d1\u73b0\u6709\u4e2a\u8d21\u732e\u548c $|\\Delta|$ \u6709\u5173\uff0c\u53ef\u4ee5\u62c6\u7edd\u5bf9\u503c\uff0c\u6b64\u65f6\u5bf9\u4e8e\u4fee\u6539\u4f4d\u7f6e $i$\uff0c\u6539\u53d8\u7684\u91cf\u548c $s_i$ \u6709\u5173\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bb0\u8be5\u4f4d\u7f6e $s_i$ \u7684\u7cfb\u6570\uff0c\u8be6\u89c1\u4ee3\u7801\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n + q)$\u3002\n\n\u4ec0\u4e48\uff1f\u4f60\u8bf4 $O(n\\log 4\\cdot10^{14}+q)$\uff1f\u4e0d\u4f1a\u79bb\u6563\u5316\u5417\u3002\n\n## \u6211\u7684\u7801\u5440\n\n```cpp\n// Problem: F. MCMF?\n// From: Codeforces - Codeforces Round #793 (Div. 2)\n// URL: https://codeforces.com/contest/1682/problem/F\n// Time: 2022-05-22 22:36\n// Author: lingfunny\n\n#include <bits/stdc++.h>\n#define LL long long\nusing namespace std;\n#define int LL\t// \u8fd9\u662f\u4e00\u4e2a\u8fdd\u80cc\u7956\u5b97\u7684\u51b3\u5b9a\uff08\u4f46\u6211\u771f\u627e\u4e0d\u51fa\u6765\u54ea\u6ca1\u5f00 long long :(\nconst int mxn = 2e5+10, mod = 1e9+7;\n\nint n, q, a[mxn], b[mxn], tot, rk[mxn], ans[mxn];\nLL sa[mxn], s[mxn];\n\nint mul() { return 1; }\ntemplate <typename... A>\nint mul(int x, A... a) { return (LL)(x < 0 ? x + mod : x)*mul(a...)%mod; }\nstruct segtr {\n#define mid ((L+R)>>1)\n#define lc (o<<1)\n#define rc (lc|1)\n\tint tag[mxn<<2], pre[mxn<<2];\n    // pre: \u7cfb\u6570 tag: \u663e\u5f0f\u503c\n\tinline void add(int o, int t) { (tag[o] += t) %= mod; }\n\tinline void adp(int o, int t) { (pre[o] += t) %= mod; }\n\tint ask(int p, int k, int o = 1, int L = 1, int R = tot) {\n\t\tif(L == R) return (tag[o] + mul(pre[o], s[k])) % mod;\n\t\treturn ((LL)tag[o] + mul(pre[o], s[k]) + (p <= mid ? ask(p, k, lc, L, mid) : ask(p, k, rc, mid+1, R)))%mod;\n\t}\n\tvoid mdf(int cl, int cr, int k, int p, int o = 1, int L = 1, int R = tot) {\n\t\tif(cl <= L && R <= cr) return p ? add(o, k) : adp(o, k);\n\t\tif(cl <= mid) mdf(cl, cr, k, p, lc, L, mid);\n\t\tif(cr > mid) mdf(cl, cr, k, p, rc, mid+1, R);\n\t}\n} T;\n\nsigned main() {\n\tscanf(\"%lld%lld\", &n, &q);\n\tfor(int i = 1; i <= n; ++i) scanf(\"%lld\", a+i);\n\tfor(int i = 1; i <= n; ++i) scanf(\"%lld\", b+i);\n\tfor(int i = 1; i <= n; ++i) sa[i] = s[i] = s[i-1] + b[i-1];\n\tsort(sa+1, sa+n+1); tot = unique(sa+1, sa+n+1) - sa - 1;\n\tfor(int i = 1; i <= n; ++i) rk[i] = lower_bound(sa+1, sa+tot+1, s[i]) - sa;\n\tfor(int i = 1, L, R; i <= n; ++i) {\n\t\tans[i] = (mod - T.ask(rk[i], i)) % mod;\n\t\tL = R = -1;\n\t\tif(b[i] > 0) {\n\t\t\tL = rk[i], R = lower_bound(sa+1, sa+tot+1, b[i]+s[i]) - sa;\n\t\t\t// [1, L] -ab\n\t\t\t// (L, R) 2as[l] - 2as[i] - ab\n\t\t\t// [R, tot] ab\n\t\t\tT.mdf(1, R - 1, mod - mul(a[i], b[i]), 1);\n\t\t\tif(R <= tot) T.mdf(R, tot, mul(a[i], b[i]), 1);\n\t\t\tif(R - L > 1) T.mdf(L+1, R-1, mod - mul(2, a[i], s[i]), 1), T.mdf(L+1, R-1, mul(2, a[i]), 0);\n\t\t} else if(b[i] < 0) {\n\t\t\tb[i] = -b[i];\n\t\t\tL = upper_bound(sa+1, sa+tot+1, s[i]-b[i]) - sa - 1, R = rk[i];\n\t\t\t// [R, tot] -ab\n\t\t\t// (L, R) 2as[i] - 2as[l] - ab\n\t\t\t// [1, L] ab\n\t\t\tT.mdf(L+1, tot, mod - mul(a[i], b[i]), 1);\n\t\t\tif(L >= 1) T.mdf(1, L, mul(a[i], b[i]), 1);\n\t\t\tif(R - L > 1) T.mdf(L+1, R-1, mul(2, a[i], s[i]), 1), T.mdf(L+1, R-1, mod - mul(2, a[i]), 0);\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; ++i) (ans[i] += T.ask(rk[i], i)) %= mod;\n\twhile(q--) {\n\t\tint l, r; scanf(\"%lld%lld\", &l, &r);\n\t\tprintf(\"%lld\\n\", (ans[l] - ans[r+1] + mod) % mod);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1654361495,
        "uid": 280800,
        "name": "lingfunny",
        "ccfLevel": 7,
        "title": "CF1682F MCMF? \u9898\u89e3"
    }
]