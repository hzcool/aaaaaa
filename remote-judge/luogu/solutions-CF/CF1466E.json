[
    {
        "content": "# $\\mathcal{Translate}$\n\n[\u9898\u76ee\u94fe\u63a5](https://codeforces.com/contest/1466/problem/E)\n\n\u7ed9\u5b9a $n$ \u548c\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $x$\uff0c\u6c42\u4e0b\u9762\u7684\u5f0f\u5b50\u3002\n\n$$\n\\sum_{i=1}^n \\sum_{j=1}^n \\sum_{k=1}^n (x_i \\, \\& \\, x_j) \\cdot (x_j \\, | \\, x_k)\n$$\n\n$1 \\leq n \\leq 5 \\cdot 10^5,0 \\leq x_i < 2^{60}$\n\n# $\\mathcal{Solution}$\n\n\u5148\u4ea4\u6362\u6c42\u548c\u53f7\u4e4b\u540e\u5c31\u53ef\u4ee5\u62c6\u4f4d\u6c42\u4e86\u3002\n\n$$\n\\sum_{i=1}^n \\sum_{j=1}^n \\sum_{k=1}^n (x_i \\, \\& \\, x_j) \\cdot (x_j \\, | \\, x_k)\n$$\n\n$$\n\\sum_{j=1}^n \\sum_{i=1}^n \\sum_{k=1}^n (x_i \\, \\& \\, x_j) \\cdot (x_j \\, | \\, x_k)\n$$\n\n$$\n\\sum_{j=1}^n \\sum_{i=1}^n \\left((x_i \\, \\& \\, x_j) \\cdot \\sum_{k=1}^n  (x_j \\, | \\, x_k)\\right)\n$$\n\n$$\n\\sum_{j=1}^n \\left(\\sum_{i=1}^n (x_i \\, \\& \\, x_j)\\right) \\cdot \\left(\\sum_{k=1}^n  (x_j \\, | \\, x_k)\\right)\n$$\n\n\u5148\u62c6\u4f4d\u9884\u5904\u7406\u540e\u5c31\u80fd\u5feb\u901f\u8ba1\u7b97\u91cc\u9762\u4e24\u4e2a\u5f0f\u5b50\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(n\\log x_i)}$\n\n# $\\mathcal{Code}$\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<string>\n#define ll long long\n#define re register\n#define int long long\ninline int Max(int x, int y) { return x > y ? x : y; }\ninline int Min(int x, int y) { return x < y ? x : y; }\ninline int Abs(int x) { return x < 0 ? ~x + 1 : x; }\ninline int read() {\n\tint r = 0; bool w = 0; char ch = getchar();\n\twhile(ch < '0' || ch > '9') {\n\t\tif(ch == '-') w = 1;\n\t\tch = getchar();\n\t}\n\twhile(ch >= '0' && ch <= '9') {\n\t\tr = (r << 3) + (r << 1) + (ch ^ 48);\n\t\tch = getchar();\n\t}\n\treturn w ? ~r + 1 : r;\n}\n#undef int\nconst int N = 5e5 + 10; \nconst ll mod = 1e9 + 7;\n\nint T, n;\nll a[N], sum[N], ans;\n\nsigned main() { T = read(); while(T--) {\n\tn = read();\n\tfor(int i = 1; i <= n; ++i) a[i] = read();\n\tfor(int i = 0; i <= 60; ++i) sum[i] = 0; ans = 0;\n\tfor(int i = 1; i <= n; ++i) {\n\t\tfor(int j = 0; j <= 60; ++j)\n\t\t\tif((1ll << j) & a[i])\n\t\t\t\t++sum[j];\n\t}\n\tfor(int i = 1; i <= n; ++i) {\n\t\tll sum1 = 0, sum2 = 0;\n\t\tfor(int j = 0; j <= 60; ++j) {\n\t\t\tll ss = (1ll << j) % mod;\n\t\t\tif((1ll << j) & a[i]) sum1 += sum[j] * ss % mod,  sum2 += n * ss % mod;\n\t\t\telse sum2 += sum[j] * ss % mod;\n\t\t\tsum1 %= mod, sum2 %= mod;\n\t\t}\n\t\tans = (ans + sum1 * sum2 % mod) % mod;\n\t}\n\tprintf(\"%lld\\n\", ans);\n}\n\treturn 0;\n}\n```",
        "postTime": 1609485972,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1466E \u3010Apollo versus Pan\u3011"
    },
    {
        "content": "## Description\n\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217 $x_{1},x_{2},\\dots,x_{n}$\uff0c\u6c42 \n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n\\sum\\limits_{k=1}^n(x_{i}\\ \\mathsf{and}\\ x_{j})\\times(x_{j}\\ \\mathsf{or}\\ x_{k})$$\n## Solution\n\u89c2\u5bdf\u4e0a\u5f0f\uff0c\u8003\u8651\u5230\u4e24\u4e2a\u62ec\u53f7\u5185\u90fd\u542b $x_{j}$\uff0c\u53ef\u4ee5\u5c06\u4e4b\u63d0\u51fa\uff0c\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n$$\\sum\\limits_{j=1}^n(\\sum\\limits_{i=1}^n(x_{i}\\ \\mathsf{and}\\ x_{j}))\\times(\\sum\\limits_{k=1}^n(x_{k}\\ \\mathsf{or}\\ x_{j}))$$\n\u7a77\u4e3e\u6bcf\u4e2a $j$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $j$ \u5feb\u901f\u6c42\u51fa $x_{i}\\ \\mathsf{and}\\ x_{j}$ \u548c $x_{k}\\ \\mathsf{or}\\ x_{j}$\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u53ea\u9700\u8981\u9884\u5904\u7406\u4e00\u4e0b $\\sum\\limits_{i=1}^na_{i}$\uff0c\u5bf9\u4e8e\u6bcf\u79cd\u60c5\u51b5\u5206\u522b\u8003\u8651\uff0c\u7528\u6876\u7edf\u8ba1\u4e00\u4e0b\u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n## Code\n```\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int maxn=5e5+5;\nconst int mod=1e9+7;\nint T,n;\nll a[maxn],x[maxn],y[maxn],ans;\nint main()\n{\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tscanf(\"%d\",&n);ans=0;\n\t\tfor(int i=1;i<=n;++i)\n\t\t{\n\t\t\tscanf(\"%lld\",&a[i]);\n\t\t\tx[i]=y[i]=0;\n\t\t}\n\t\tfor(int i=0;i<=60;++i)\n\t\t{\n\t\t\tint now=0;\n\t\t\tfor(int j=1;j<=n;++j) \n\t\t\t\tif((a[j]&(1ll<<i)))\n\t\t\t\t\tnow++;\n\t\t\tfor(int j=1;j<=n;++j) \n\t\t\t{\n\t\t\t\tif((a[j]&(1ll<<i))) \n\t\t\t\t{\n\t\t\t\t\tx[j]+=(1ll<<i)%mod*now%mod;\n\t\t\t\t\tx[j]%=mod;\n\t\t\t\t\ty[j]+=(1ll<<i)%mod*n%mod;\n\t\t\t\t\ty[j]%=mod;\n\t\t\t\t}\n\t\t\t\telse \n\t\t\t\t{\n\t\t\t\t\ty[j]+=(1ll<<i)%mod*now%mod;\n\t\t\t\t\ty[j]%=mod;\n\t\t\t\t}\n\t\t\t}\n\t\t} \n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tans+=x[i]*y[i]%mod;\n\t\t\tans%=mod;\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1652792998,
        "uid": 451328,
        "name": "lnwhl",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011CF1466E Apollo versus Pan"
    },
    {
        "content": "## CF1466E \u3010Apollo versus Pan\u3011\n\n### \u9898\u610f\n\n+ \u7ed9\u51fa\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $x$\uff1b\n+ \u6c42 $\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\sum\\limits_{k=1}^{n}(x_i\\&x_j)\\times(x_j|x_k)\\mod(10^9+5)$\uff1b\n+ \u591a\u7ec4\u6570\u636e\uff0c$n\\le5\\times10^5,0\\le x_i\\le2\\times10^{18}$\u3002\n\n### \u505a\u6cd5\n\n$\\begin{aligned}\n&\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\sum\\limits_{k=1}^{n}(x_i\\&x_j)\\times(x_j|x_k)\\\\\n=&\\sum\\limits_{j=1}^{n}[\\sum\\limits_{i=1}^{n}(x_i\\&x_j)]\\times[\\sum\\limits_{k=1}^{n}(x_j|x_k)]\n\\end{aligned}$\n\n\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u5bf9\u4e8e\u4efb\u610f $j$\uff0c\u6c42 $\\sum\\limits_{i=1}^{n}(x_i\\&x_j)$ \u548c $\\sum\\limits_{k=1}^{n}(x_j|x_k)$\u3002\n\n\u4e8c\u8fdb\u5236\u4e0b\u6bcf\u4e00\u4f4d\u663e\u7136\u53ef\u4ee5\u72ec\u7acb\u8ba1\u7b97\uff0c\u73b0\u5728\u5bf9\u4efb\u610f $i$\uff0c$x_i\\in\\{0,1\\}$\u3002\n\n\u5f53 $x_j=1$ \u65f6\uff0c$\\sum\\limits_{i=1}^{n}(x_i\\&x_j)=\\sum\\limits_{i=1}^{n}x_i$\uff0c$\\sum\\limits_{k=1}^{n}(x_j|x_k)=n$\u3002\n\n\u5f53 $x_j=0$ \u65f6\uff0c$\\sum\\limits_{i=1}^{n}(x_i\\&x_j)=0$\uff0c$\\sum\\limits_{k=1}^{n}(x_j|x_k)=\\sum\\limits_{i=1}^{n}x_i$\u3002\n\n\u9884\u5904\u7406\u6bcf\u4e00\u4f4d\u7684 $\\sum\\limits_{i=1}^{n}x_i$\u3002",
        "postTime": 1633950138,
        "uid": 246014,
        "name": "Cutest_Junior",
        "ccfLevel": 6,
        "title": "CF1466E \u3010Apollo versus Pan\u3011"
    },
    {
        "content": "\u5ba3\u4f20\u535a\u5ba2->[link](https://blog.csdn.net/BWzhuzehao/article/details/113766515)\n\n\u672c\u9898\u662f\u4e00\u9053\u6570\u5b66\u9898\u3002\n\n\u6211\u4eec\u9996\u5148\u9700\u8981\u4ea4\u6362\u4e00\u4e0b\u6c42\u548c\u7b26\u53f7\uff0c\u7136\u540e\u5229\u7528\u4e8c\u8fdb\u5236\u7684\u6027\u8d28\u62c6\u5f0f\u5b50\u5373\u53ef\u3002\n\n\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a\n\n$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\sum\\limits_{k=1}^{n}(x_i \\text{ and }x_j) \\times (x_j \\text{ or } x_k)$\n\n$=\\sum\\limits_{j=1}^{n}\\sum\\limits_{i=1}^{n}\\sum\\limits_{k=1}^{n}(x_i \\text{ and }x_j) \\times (x_j \\text{ or } x_k)$\n\n$=\\sum\\limits_{j=1}^{n}\\sum\\limits_{i=1}^{n}(x_i \\text{ and } x_j) \\times \\sum\\limits_{k=1}^{n}(x_j \\text{ or } x_k)$\n\n$=\\sum\\limits_{j=1}^{n}(\\sum\\limits_{i=1}^{n}(x_i \\text{ and } x_j) \\times \\sum\\limits_{k=1}^{n}(x_j \\text{ or } x_k))$\n\n\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u6309\u4e8c\u8fdb\u5236\u4f4d\u62c6\u5206\uff0c\u7136\u540e\u5904\u7406\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long LL;\nconst int MAXN = 5e5 + 10, P = 1e9 + 7;\nint t, n;\nLL x[MAXN], ans, sum[MAXN];\n\nLL read()\n{\n\tLL sum = 0, fh = 1; char ch = getchar();\n\twhile (ch < '0' || ch > '9')  {if (ch == '-') fh = -1; ch = getchar();}\n\twhile (ch >= '0' && ch <= '9') {sum = (sum << 3) + (sum << 1) + (ch ^ 48); ch = getchar();}\n\treturn sum * fh;\n}\n\nint main()\n{\n\tt = read();\n\twhile (t--)\n\t{\n\t\tn = read(); ans = 0;\n\t\tfor (int i = 1; i <= n; ++i) x[i] = read();\n\t\tmemset(sum, 0, sizeof(sum));\n\t\tfor (int i = 1; i <= n; ++i)\n\t\t\tfor (int j = 0; j < 60; ++j)\n\t\t\t\tif (1ll << j & x[i]) sum[j]++;\n\t\tfor (int i = 1; i <= n; ++i)\n\t\t{\n\t\t\tLL sum1 = 0, sum2 = 0;\n\t\t\tfor (int j = 0; j < 60; ++j)\n\t\t\t{\n\t\t\t\tLL tmp = (1ll << j) % P;\n\t\t\t\tif (1ll << j & x[i]) sum1 = (sum1 + sum[j] * tmp % P) % P, sum2 = (sum2 + n * tmp) % P;\n\t\t\t\telse sum2 = (sum2 + sum[j] * tmp) % P;\n\t\t\t}\n\t\t\tans = (ans + sum1 * sum2 % P) % P;\n\t\t}\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1613968573,
        "uid": 134000,
        "name": "Plozia",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1466E \u3010Apollo versus Pan\u3011"
    },
    {
        "content": "# CF1466E \u9898\u89e3\n\u6309\u4f4d\u8003\u8651\u7ecf\u5178\u9898\u578b\n\n## Description\n\u7ed9\u5b9a $n$ \u548c $x_1,x_2,...,x_n$\uff0c\u6c42\uff1a\n\n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n\\sum\\limits_{k=1}^n(x_i \\text{ and }x_j) \\times (x_j \\text{ or }x_k)$$\n\n\u5176\u4e2d $\\text{and}$ \u4e3a\u6309\u4f4d\u4e0e\uff0c$\\text{or}$ \u4e3a\u6309\u4f4d\u6216\u3002\n\n## Solution\n\u8bf4\u660e\uff1a\u4e0b\u6587\u5c06\u628a $\\text{and}$ \u5199\u4f5c $\\&$\uff0c$\\text{or}$ \u5199\u4f5c $|$\u3002\n\n##\n\n\u6211\u4eec\u5148\u628a\u8fd9\u4e2a\u5f0f\u5b50\u8f6c\u5316\u4e00\u4e0b\uff1a\n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n\\sum\\limits_{k=1}^n(x_i \\text{ and }x_j) \\times (x_j \\text{ or }x_k)$$\n\n$$=\\sum\\limits_{j=1}^n(\\sum\\limits_{i=1}^n(x_i \\text{ and }x_j)) \\times (\\sum\\limits_{k=1}^n(x_j \\text{ or }x_k))$$\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u5feb\u901f\u6c42\u51fa\u62ec\u53f7\u91cc\u7684\u4e24\u4e2a\u4e1c\u897f\u5373\u53ef\u3002\n\n\u7136\u540e\u6309\u4f4d\u8003\u8651\uff0c\u8bbe\u5f53\u524d\u4f4d\u4e3a\u7b2c $i$ \u4f4d\uff0c$x_j$ \u7684\u7b2c $i$ \u4f4d\u4e3a $y_j$\uff1a\n1. \u5982\u679c $y_j=1$\uff0c\u90a3\u4e48\u8fd9\u4f4d\u5bf9\u6240\u6709\u7684 $\\&$ \u90fd\u4e0d\u4f1a\u6539\u53d8\u5176\u7ed3\u679c\uff0c\u5bf9\u6240\u6709\u7684 $|$ \u90fd\u4f7f\u7ed3\u679c\u53d8\u4e3a $1$\uff0c\u5373\uff1a  \n$$\\sum\\limits_{i=1}^ny_i\\&y_j=\\sum\\limits_{i=1}^ny_i,\\sum\\limits_{i=1}^ny_j|y_k=\\sum\\limits_{i=1}^n1=n$$\n\n2. \u5982\u679c $y_j=0$\uff0c\u90a3\u4e48\u8fd9\u4f4d\u5bf9\u6240\u6709\u7684 $\\&$ \u90fd\u4f7f\u7ed3\u679c\u53d8\u4e3a $0$\uff0c\u5bf9\u6240\u6709\u7684 $|$ \u90fd\u4e0d\u4f1a\u6539\u53d8\u5176\u7ed3\u679c\uff0c\u5373\uff1a\n$$\\sum\\limits_{i=1}^ny_i\\&y_j=0,\\sum\\limits_{i=1}^ny_i|y_j=\\sum\\limits_{i=1}^ny_i$$\n\n\u6240\u4ee5\u9884\u5904\u7406 $\\sum\\limits_{i=1}^ny_i$ \u5373\u53ef\u3002\n\n\u5355\u6b21\u590d\u6742\u5ea6 $\\mathcal O(n \\log n)$\u3002\n\n## Code\n```cpp\ninline ll calc1(ll a,ll b){return a&(1ll<<b);}\ninline ll calc2(ll pos,ll q){return (1ll<<pos)%P*q%P;}\n...\nll ans=0;\nfor(ll i=0;i<=60;i++){//\u679a\u4e3e\u5f53\u524d\u4f4d\n\tll cnt=0;\n\tfor(ll j=1;j<=n;j++)cnt+=(calc1(x[j],i)>0);\n\tfor(ll j=1;j<=n;j++){\n\t\tif(calc1(x[j],i))c1[j]=(c1[j]+calc2(i,cnt))%P,c2[j]=(c2[j]+calc2(i,n))%P;\n\t\telse c2[j]=(c2[j]+calc2(i,cnt))%P;\n\t}\n}\n```\n\n\u5feb\u6765\u548c\u6211\u4e00\u8d77\u819c\u62dc [$\\mathsf{\\color{black}Y\\color{red}outhjoy\\_Creator}$](https://www.luogu.com.cn/user/278629) \u5427\uff01\u867d\u7136\u8fd9\u7bc7\u9898\u89e3\u9664\u4e86\u540d\u5b57\u548c T\u2642A\u2640 \u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u3002",
        "postTime": 1612601004,
        "uid": 291706,
        "name": "GspTools",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1466E \u3010Apollo versus Pan\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\u770b\u5230\u6ca1\u4eba\u5199\u9898\u89e3\u6c34\u4e00\u70b9\u7ecf\u9a8c\u3002\n\n\u8fd9\u4e2a E \u600e\u4e48\u6bd4 C \u8fd8\u7b80\u5355\u554a QAQ\n## \u601d\u8def\n\u770b\u5230\u4f4d\u8fd0\u7b97\u9898\uff0c\u5148\u60f3\u5230\u62c6\u4f4d\uff0c\u73b0\u5728\u5047\u8bbe\u6bcf\u4e2a\u6570\u90fd\u662f $0$ \u6216 $1$\u3002\n\n\u53d1\u73b0\u4e24\u4e2a\u5f0f\u5b50\u90fd\u548c $j$ \u76f8\u5173\uff0c\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $j$ \u7b97\u51fa $\\sum\\limits_{i=1}^n a_i\\&a_j$ \u548c $\\sum\\limits_{k=1}^n a_k|a_j$ \u7684\u4e58\u79ef\uff0c\u6700\u540e\u52a0\u8d77\u6765\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u663e\u7136\u975e\u5e38\u597d\u6c42\u3002\n\n$a_j=1$ \u7684\u65f6\u5019 $\\sum\\limits_{i=1}^n a_i\\&a_j=\\sum\\limits_{i=1}^na_i,\\sum\\limits_{i=1}^n a_i|a_j=n$\u3002\n\n$a_j=0$ \u7684\u65f6\u5019 $\\sum\\limits_{i=1}^n a_i\\&a_j=0,\\sum\\limits_{i=1}^n a_i|a_j=\\sum\\limits_{i=1}^na_i$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u9884\u5904\u7406 $\\sum\\limits_{i=1}^na_i$ \u540e\u8ba1\u7b97\u4e0a\u65b9\u7684\u5f0f\u5b50\u5373\u53ef\u3002\n## \u4ee3\u7801\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nint a[1000003];\nint x[1000003],y[1000003];\nconst int p=1000000007;\nsigned main()\n{\n\tint T=read();\n\twhile(T--)\n\t{\n\t\tint n=read();\n\t\tfor(int i=1; i<=n; i++) a[i]=read(),x[i]=y[i]=0;\n\t\tlong long ans=0;\n\t\tfor(int i=0; i<=60; ++i)\n\t\t{\n\t\t\tint X=0;\n\t\t\tfor(int j=1; j<=n; j++) X+=((a[j]&(1ll<<i))>0);\n\t\t\tfor(int j=1; j<=n; j++) \n\t\t\t{\n\t\t\t\tif((a[j]&(1ll<<i))>0) x[j]+=(1ll<<i)%p*X%p,x[j]%=p,y[j]+=(1ll<<i)%p*n%p,y[j]%=p;\n\t\t\t\telse y[j]+=(1ll<<i)%p*X%p,y[j]%=p;\n\t\t\t}\n\t\t} \n\t\tfor(int i=1; i<=n; i++) ans+=x[i]*y[i]%p,ans%=p;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1609735818,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1466E \u3010Apollo versus Pan\u3011"
    }
]