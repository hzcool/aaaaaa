[
    {
        "content": "\n\u8fd9\u9898\u53ef\u4ee5\u51fa\u4e2a\u52a0\u5f3a\u7248\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$ \u7684\u505a\u6cd5\uff0c\u57fa\u4e8e[comment-719265](https://codeforces.com/blog/entry/9070?#comment-719265)\u3002\n\n\u8bbe $($ \u4e3a $+1$, $)$ \u4e3a $-1$ \uff0c\u5bf9\u6bcf\u4e2a $\\mod n = i$ \u7684\u4f4d\u7f6e\u4e0a\u7684\u62ec\u53f7\u62ff\u51fa\u6765\u8003\u8651,\u53d1\u73b0\u8981\u4f7f\u5f97\u5b83\u5c3d\u53ef\u80fd\u5408\u6cd5,\u90a3\u4e48\u4e00\u5b9a\u662f\u5148\u5de6\u62ec\u53f7\u518d\u53f3\u62ec\u53f7,\u5c31\u662f\u5f62\u5982 $\\texttt{(((((....)))))}$\u3002\n\n\u90a3\u4e48\u8fd8\u662f\u8d2a\u5fc3\u3002\n\n\u6211\u4eec\u5047\u8bbe\u4e00\u5f00\u59cb\u5168\u90e8\u90fd\u662f\u5de6\u62ec\u53f7\uff0c\u7136\u540e\u80af\u5b9a\u662f\u8d2a\u5fc3\u5148\u6362\u66f4\u6362\u4ee3\u4ef7\u66f4\u5c0f\u7684\u53f3\u62ec\u53f7\u3002\u90a3\u4e48\u5c31\u5148\u6309\u66f4\u6362\u4ee3\u4ef7\u6392\u4e2a\u5e8f,\u7136\u540e\u4ece\u540e\u5f80\u524d\u80fd\u586b\u5c31\u586b\u3002\u80fd\u5426\u586b\u7684\u5224\u5b9a\u6761\u4ef6\u5c31\u662f\u524d\u7f00\u548c $\\min < 0$\u3002\n\n\u6211\u4eec\u9700\u8981\u4e00\u4e9b\u5feb\u901f\u7684\u65b9\u6cd5\u6765\u7ef4\u62a4\uff0c\u6709\u70b9\u5c0f\u9ebb\u70e6\uff0c\u6211\u4eec\u5148\u6765\u6316\u6398\u4e00\u4e9b\u6027\u8d28\u3002\n\n\u9996\u5148\u662f\u6bcf\u4e2a $\\mod n = i$ \u7684\u4f4d\u7f6e\u5f62\u5982 $\\texttt{(((((....)))))}$ \uff0c\u7136\u540e\u6211\u4eec\u628a\u539f\u5e8f\u5217\u79f0\u4e3a $m$ \u6bb5\uff0c\u8bbe $G_i$ \u8868\u793a\u7b2c $i$ \u6bb5\u7684\u548c\uff0c\u90a3\u4e48 $G$ \u7684\u524d\u7f00\u548c\u4e00\u5b9a\u662f\u5148\u589e\u540e\u51cf\u7684\uff0c\u53ef\u4ee5\u7c7b\u6bd4\u51f8\u51fd\u6570\u52a0\u8d77\u6765\u4e00\u5b9a\u662f\u4e2a\u51f8\u51fd\u6570\u3002\u90a3\u4e48\u7531\u6b64\u6211\u4eec\u8bbe $S_i$ \u8868\u793a\u62ec\u53f7\u5e8f\u5217\u524d $i$ \u4e2a\u7684\u548c\uff0c\u90a3\u4e48 $S_{x},S_{n+x},S_{2n+x},\\cdots $ \u4e5f\u662f\u4e2a\u5148\u589e\u540e\u51cf\u7684\u3002\u6240\u4ee5\u8bf4\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u6bcf\u4e2a $x$ \u7684\u4e24\u4e2a\u6700\u4f4e\u70b9\u5c31\u597d\u4e86\u3002\u8bbe\u53f3\u62ec\u53f7\u586b\u7684\u4e2a\u6570\u662f $v$ \uff0c\u90a3\u4e48\u53ef\u4ee5\u5217\u51fa\u6765 $n$ \u4e2a\u4e0d\u7b49\u5f0f\u6c42 $v$ \u7684\u4e0a\u754c\u3002\u6ce8\u610f\u4e0a\u754c\u53d6\u5230 $m$ \u7684\u65f6\u5019\u8981\u7279\u5224\u7b2c\u4e00\u5757\uff0c\u56e0\u4e3a $S_{0\\sim n-1}$ \u53ef\u80fd\u4f1a\u5c0f\u4e8e 0\uff0c\u6216\u8005\u8bf4\u5c31\u662f\u8fd9\u4e9b\u51f8\u51fd\u6570\u90fd\u6709\u4e24\u4e2a\u6700\u4f4e\u70b9\uff0c\u6700\u524d\u9762\u7684\u5757\u5c31\u662f\u6700\u524d\u9762\u7684\u6700\u4f4e\u70b9\u3002\n\n\u54e6\uff0c\u8fd8\u6709\uff0c\u5bf9\u4e8e $0\\le i < n$ \u8d2a\u5fc3\u52a0\u53f3\u62ec\u53f7\u65f6\uff0c$v$ \u5bf9 $0\\sim i-1$ \u548c $i\\sim n-1$ \u7684\u6700\u540e\u4e00\u6bb5\u7684\u524d\u7f00\u548c\u6709\u4e2a $O(1)$ \u7684\u5dee\u8ddd\uff0c\u5206\u522b\u5904\u7406\u4e00\u4e0b\u5c31\u597d\u4e86\u3002 \n\n\u6240\u4ee5\u8bf4\uff0c\u5f00\u4e24\u68f5\u7ebf\u6bb5\u6811\u7ef4\u62a4 $S_{0\\sim n-1}$ \u548c $S_{(m-1)n\\sim mn-1}$ \uff0c\u7136\u540e\u652f\u6301\u533a\u95f4 $\\min$ \u548c\u533a\u95f4\u52a0\u5c31\u597d\u4e86\u3002\n\n\u4e8c\u6b21\u5143 @\u52a0\u85e4\u60e0 \u5148\u751f\u6709\u4e00\u4e2a nb \u7684\u7ed3\u8bba\uff1a\u5728 $n$ \u4e3a\u5076\u6570\u7684\u65f6\u5019\uff0c\u7b2c $i(0\\le i < n)$ \u7684\u4f4d\u7f6e\u586b\u7684\u53f3\u62ec\u53f7\u4e2a\u6570\u4e00\u5b9a\u662f\u4e0b\u9762\u4e4b\u4e00\uff1a$0,m-1,m$ \uff0c\u6211\u4e0d\u4f1a\u8bc1\u3002\n\n```cpp\n// This code wrote by chtholly_micromaker(Myukiyomekya)\n#include <bits/stdc++.h>\n#define reg\n#define int long long\n#define ALL(x) (x).begin(),(x).end()\n#define mem(x,y) memset(x,y,sizeof x)\n#define sz(x) (int)(x).size()\n#define ln putchar('\\n')\n#define lsp putchar(32)\n#define pb push_back\n#define MP std::make_pair\n#define MT std::make_tuple\n#ifdef _LOCAL_\n#define dbg(x) std::cerr<<__func__<<\"\\tLine:\"<<__LINE__<<' '<<#x<<\": \"<<x<<\"\\n\"\n#define dprintf(x...) std::fprintf(stderr,x)\n#else\n#define dbg(x) 42\n#define dprintf(x...) 42\n#endif\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define per(i,b,a) for(int i=(b);i>=(a);--i)\ntypedef std::pair<int,int> pii;\ntypedef std::vector<int> poly;\ntemplate <class t> inline void read(t &s){s=0;\nsigned f=1;char c=getchar();while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\nwhile(isdigit(c))s=(s<<3)+(s<<1)+(c^48),c=getchar();;s*=f;}\ntemplate<class t,class ...A> inline void read(t &x,A &...a){read(x);read(a...);}\ntemplate <class t> inline void write(t x){if(x<0)putchar('-'),x=-x;\nstatic int buf[50],top=0;while(x)buf[++top]=x%10,x/=10;if(!top)buf[++top]=0;\nwhile(top)putchar(buf[top--]^'0');}\ninline void setIn(std::string s){freopen(s.c_str(),\"r\",stdin);return;}\ninline void setOut(std::string s){freopen(s.c_str(),\"w\",stdout);return;}\ninline void setIO(std::string s=\"\"){setIn(s+\".in\");setOut(s+\".out\");return;}\ntemplate <class t>inline bool ckmin(t&x,t y){if(x>y){x=y;return 1;}return 0;}\ntemplate <class t>inline bool ckmax(t&x,t y){if(x<y){x=y;return 1;}return 0;}\ninline int lowbit(int x){return x&(-x);}\nconst int MaxN=1e6+50;\nconst int inf=1e18;\nint a[MaxN],p[MaxN],n,m;\nstruct SegTR\n{\n#define lson (u<<1)\n#define rson (u<<1|1)\n\tint a[MaxN<<2],lazy[MaxN<<2];\n\tinline void pushup(int u){a[u]=std::min(a[lson],a[rson]);}\n\tinline void buildtr(int u,int l,int r,int base=0)\n\t{\n\t\tif(l==r)return a[u]=l+base,void();\n\t\tint mid=(l+r)>>1;\n\t\tbuildtr(lson,l,mid,base),buildtr(rson,mid+1,r,base),pushup(u);\n\t}\n\tinline void Add(int u,int k){a[u]+=k,lazy[u]+=k;}\n\tinline void pushdown(int u){\n\t\tif(lazy[u])Add(lson,lazy[u]),Add(rson,lazy[u]),lazy[u]=0;}\n\tinline void modify(int u,int l,int r,int ql,int qr,int k)\n\t{\n\t\tif(ql>qr)return;\n\t\tif(ql<=l&&r<=qr)return Add(u,k);\n\t\tpushdown(u);\n\t\tint mid=(l+r)>>1;\n\t\tif(ql<=mid)modify(lson,l,mid,ql,qr,k);\n\t\tif(mid<qr)modify(rson,mid+1,r,ql,qr,k);\n\t\tpushup(u);\n\t}\n\tinline int ask(int u,int l,int r,int ql,int qr)\n\t{\n\t\tif(ql>qr)return inf;\n\t\tif(ql<=l&&r<=qr)return a[u];\n\t\tpushdown(u);\n\t\tint mid=(l+r)>>1;\n\t\tif(ql>mid)return ask(rson,mid+1,r,ql,qr);\n\t\tif(mid>=qr)return ask(lson,l,mid,ql,qr);\n\t\treturn std::min(ask(lson,l,mid,ql,qr),ask(rson,mid+1,r,ql,qr));\n\t}\n}pre,suf;\nsigned main(void)\n{\n\tread(n,m);\n\tint x,ans=0;\n\trep(i,1,n)read(a[i]),ans+=a[i]*m;\n\trep(i,1,n)read(x),a[i]=x-a[i],p[i]=i;\n\tstd::sort(p+1,p+n+1,[&](int x,int y){return a[x]<a[y];});\n\tpre.buildtr(1,1,n),suf.buildtr(1,1,n,n*(m-1));\n\trep(i,1,n)\n\t{\n\t\tint pos=p[i];\n\t\tint ret=std::min(suf.ask(1,1,n,1,pos-1)/2+1,suf.ask(1,1,n,pos,n)/2);\n\t\tckmin(ret,m);\n\t\tif(pre.ask(1,1,n,pos,n)<=1)ckmin(ret,m-1);\n\t\tif(ret)\n\t\t{\n\t\t\tans+=ret*a[pos];\n\t\t\tsuf.modify(1,1,n,1,pos-1,-(ret-1)*2),\n\t\t\tsuf.modify(1,1,n,pos,n,-ret*2);\n\t\t\tif(ret==m)pre.modify(1,1,n,pos,n,-2);\n\t\t}\n\t}\n\twrite(ans),ln;\n\treturn 0;\n}\n\n```",
        "postTime": 1634805723,
        "uid": 51376,
        "name": "MyukiyoMekya",
        "ccfLevel": 9,
        "title": "CF351C Jeff and Brackets \u9898\u89e3"
    },
    {
        "content": "[orz](https://www.luogu.com.cn/problem/CF351C)\n\n\u5bb9\u6613\u60f3\u5230\u4e00\u79cd\u975e\u5e38\u66b4\u529b\u7684DP\uff1a$f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u4f4d\u7f6e\u4e2d\u8fd8\u6709 $j$ \u4e2a\u672a\u5339\u914d\u7684\u5de6\u62ec\u53f7\uff0c\u6b64\u65f6\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u5f88\u660e\u663e\u8fd9\u6837\u7684 DP \u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2m^2)$ \u7ea7\u522b\u3002\n\n\u53d1\u73b0\u5bf9\u4e8e\u6bcf $n$ \u4e2a\u4f4d\u7f6e\uff0c\u4ee3\u4ef7\u56fa\u5b9a\uff0c\u4e0d\u59a8\u628a $n\\times m$ \u4e2a\u4f4d\u7f6e\u5206\u6210 $m$ \u4e2a\u5757\uff0c\u6bcf\u4e2a\u5757\u6709 $n$ \u4e2a\u4f4d\u7f6e\u3002\n\n\u6bcf\u6b21\u8f6c\u79fb\u4e0d\u59a8\u601d\u8003\u6700\u540e\u4e00\u4e2a\u5757\u7684\u72b6\u6001\u3002\u8bbe $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u5757\u4e2d\u8fd8\u6709 $j$ \u4e2a\u5de6\u62ec\u53f7\uff0c\u6b64\u65f6\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u679a\u4e3e\u7b2c $i$ \u4e2a\u5757\u7684\u72b6\u6001\uff0c\u8bbe $g_{i,j,k}$ \u8868\u793a\u4e00\u4e2a\u5757\u4e2d\u524d $i$ \u4e2a\u4f4d\u7f6e\u4e2d\uff0c\u6709 $j$ \u4e2a\u672a\u5339\u914d\u7684\u53f3\u62ec\u53f7\uff08\u5141\u8bb8\u6709\u672a\u5339\u914d\u7684\u53f3\u62ec\u53f7\uff09,\u5de6\u62ec\u53f7\u6570\u91cf\u4e0e\u53f3\u62ec\u53f7\u6570\u91cf\u7684\u5dee\u4e3a $k$\uff0c\u6b64\u65f6\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u53ef\u4ee5\u91c7\u7528\u66f4\u65b0\u5730\u63a8\u7684\u65b9\u5f0f\u8ba1\u7b97 $g$ \u6570\u7ec4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\u3002\n\n\u663e\u7136 $f_{i,j}+\\min_{q=0}^{j}\\{g_{n,q,k}\\}\\rightarrow f_{i+1,j+k}$\n\n$q$ \u548c $k$ \u53ef\u4ee5\u5206\u5f00\u679a\u4e3e\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4ecd\u7136\u662f $O(m^2n^2)$\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9 $n$ \u4e2a\u5757\u987a\u5e8f\u6ca1\u6709\u5173\u7cfb\uff0c\u6bcf\u4e2a\u5757 **\u5de6\u62ec\u53f7\u4e0e\u53f3\u62ec\u53f7\u7684\u5dee** \u7684\u987a\u5e8f\u6ca1\u6709\u5173\u7cfb\u3002\n\n\u6bd4\u5982 $t_1,t_2,t_3,t_4,t_5$ \u4e3a\u4e94\u4e2a\u5757\u5de6\u62ec\u53f7\u4e0e\u53f3\u62ec\u53f7\u4e4b\u5dee\u3002\n\n\u5982\u679c\u8bf4 $t_1=7,t_2=5,t_3=9,t_4=-9,t_5=-12$\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u5148\u628a $t_5$ \u6392\u5728 $t_2,t_3$ \u4e4b\u95f4\u5462\uff1f\u8fd9\u6837\u4e00\u6765\uff0c\u603b\u4f53\u6240\u9700\u7684\u72b6\u6001\u6700\u591a\u4e3a $12$\u3002\n\n\u666e\u904d\u5730\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u72b6\u6001 $f_{i,j}$\uff0c\u5982\u679c $j>n$\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u8f6c\u79fb\u7684\u5757 **\u5de6\u62ec\u53f7\u4e0e\u53f3\u62ec\u53f7\u7684\u5dee** \u5c31\u5e94\u8be5\u4e3a\u8d1f\u6570\uff08\u5982\u679c\u4e0d\u662f\uff0c\u8fdf\u65e9\u90fd\u8981\u51fa\u73b0\u4e00\u4e2a\u8d1f\u6570\uff0c\u56e0\u4e3a\u6700\u7ec8\u7b54\u6848\u662f $f_{m,0}$\uff09\uff0c\u53d1\u73b0\u8fd9\u6837\u505a\u5e76\u4e0d\u5f71\u54cd\u7b54\u6848\uff0c\u800c\u7b2c\u4e8c\u7ef4\u7684\u72b6\u6001\u6570\u53ea\u6709 $2n$\u3002\n\n\u65f6\u95f4\u76f4\u63a5\u53d8\u6210 $O(mn^3)$\u3002\n\n\u76f4\u63a5\u77e9\u9635\u4e58\u6cd5\u52a0\u901f\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3\\log m)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst ll maxn=50;\nll n,m,x[maxn],y[maxn],g[maxn][maxn][maxn];\nstruct mat\n{\n\tll dat[maxn][maxn];\n\tconst mat operator*(const mat tmp) const\n\t{\n\t\tmat ans;\n\t\tmemset(ans.dat,0x3f,sizeof ans.dat);\n\t\tfor(ll i=0;i<=2*n;i++)\n\t\t\tfor(ll j=0;j<=2*n;j++)\n\t\t\t\tfor(ll k=0;k<=2*n;k++)\n\t\t\t\t\tans.dat[i][j]=min(ans.dat[i][j],dat[i][k]+tmp.dat[k][j]);\n\t\treturn ans;\n\t}\n}a,ans;\nint main()\n{\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(ll i=1;i<=n;i++) scanf(\"%lld\",&x[i]);\n\tfor(ll i=1;i<=n;i++) scanf(\"%lld\",&y[i]);\n\tmemset(g,0x3f,sizeof g);\n\tg[0][0][n]=0;\n\tfor(ll i=0;i<n;i++)\n\t\tfor(ll j=0;j<=i;j++)\n\t\t\tfor(ll k=n-i;k<=n+i;k++)\n\t\t\t{\n\t\t\t\tg[i+1][j][k+1]=min(g[i+1][j][k+1],g[i][j][k]+x[i+1]);\n\t\t\t\tg[i+1][max(j,n-k+1)][k-1]=min(g[i+1][max(j,n-k+1)][k-1],g[i][j][k]+y[i+1]);\n\t\t\t}\n\tmemset(ans.dat,0x3f,sizeof ans.dat);\n\tmemset(a.dat,0x3f,sizeof a.dat);\n\tfor(ll i=0;i<=2*n;i++)\n\t{\n\t\tfor(ll j=max(0ll,i-n);j<=min(2*n,i+n);j++)\n\t\t{\n\t\t\tfor(ll k=0;k<=i;k++)\n\t\t\t{\n\t\t\t\ta.dat[i][j]=min(a.dat[i][j],g[n][k][j-i+n]);\n\t\t\t}\n\t\t}\n\t\tans.dat[i][i]=0;\n\t}\n\twhile(m)\n\t{\n\t\tif(m&1) ans=ans*a;\n\t\ta=a*a;\n\t\tm>>=1;\n\t}\n\tprintf(\"%lld\",ans.dat[0][0]);\n\treturn 0;\n}//\n```",
        "postTime": 1674441588,
        "uid": 375953,
        "name": "Sktn0089",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3CF351C\u3011Jeff and Brackets"
    },
    {
        "content": "[\u94fe\u63a5](https://www.luogu.com.cn/problem/CF351C)\n\n\u5bb9\u6613\u5f97\u5230 $O(nm)$ \u7684 dp \u65b9\u7a0b $f_{j,i}=\\begin{cases}\\min(f_{j-1,i+1}+L_j,f_{j-1,i-1}+R_j)&i>0\\\\f_{j-1,1}+R_j&i=0\\end{cases}$\uff0c\u5176\u4e2d $f_{j,i}$ \u8868\u793a\u5230\u7b2c $j$ \u4e2a\u4f4d\u7f6e\u3001\u6709 $i$ \u4e2a\u5de6\u62ec\u53f7\u672a\u88ab\u5339\u914d\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c$L_j,R_j$ \u5206\u522b\u8868\u793a\u6b64\u65f6\u52a0\u4e0a\u5de6\u53f3\u62ec\u53f7\u7684\u4ee3\u4ef7\u3002$f_{0,0}=0,f_{0,i}=+\\infty(i>0)$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u7c7b\u4f3c\u77e9\u9635\u4e58\u6cd5\u4e00\u6837\u5b9a\u4e49\u5411\u91cf $B_n$ \u4e0e\u77e9\u9635 $S_{n,n}$ \u7684\u4e58\u6cd5 $*$\uff1a\n\n> \u5411\u91cf $A=S*B$\uff0c\u5176\u4e2d $A_i=\\min\\limits_{j=0}^wS_{i,j}+B_j$\u3002\n\n\u6211\u4eec\u5e0c\u671b\u5b9a\u4e49 $S*T$ \u4f7f\u5f97 $A=S*(T*B)=(S*T)*B$\u3002\u7531\u4e8e $A_i=\\min\\limits_{j=0}^w(S_{i,j}+\\min\\limits_{k=0}^w(T_{j,k}+B_k))=\\min\\limits_{k=0}^w(\\min\\limits_{j=0}^w(S_{i,j}+T_{j,k})+B_k)$\uff0c\u90a3\u4e48\u6211\u4eec\u5982\u4e0b\u5b9a\u4e49\u5373\u53ef\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\uff1a\n\n> $(S*T)_{i,k}=\\min\\limits_{j=0}^w(S_{i,j}+T_{j,k})$ \n\n\u56e0\u4e3a $\\forall B$\uff0c\u4e00\u65b9\u9762 $R*(S*(T*B))=R*((S*T)*B)=(R*(S*T))*B$\uff0c\u53e6\u4e00\u65b9\u9762 $R*(S*(T*B))=(R*S)*(T*B)=((R*S)*T)*B$\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n> $R*(S*T)=(R*S)*T$\n\n\u5373 $*$ \u6ee1\u8db3\u7ed3\u5408\u5f8b\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u5e42\u6765\u8ba1\u7b97\u5b83\u3002\n\n\u5bf9\u4e8e\u672c\u9898\uff0c\u663e\u7136 $A=\\begin{bmatrix}f_{j,0}\\\\f_{j,1}\\\\\\vdots\\\\f_{j,w}\\end{bmatrix},S_j=\\begin{bmatrix}+\\infty&R_j&+\\infty&\\cdots&+\\infty\\\\L_j&+\\infty&R_j&&\\vdots\\\\+\\infty&L_j&+\\infty\\\\\\vdots\\\\+\\infty&\\cdots\\end{bmatrix},B=\\begin{bmatrix}f_{j-1,0}\\\\f_{j-1,1}\\\\\\vdots\\\\f_{j-1,w}\\end{bmatrix}$\u3002\n\n\u6700\u7ec8\u7b54\u6848 $ans=((S_{n-1}*\\cdots*S_0)^m*\\begin{bmatrix}0\\\\+\\infty\\\\\\vdots\\\\+\\infty\\end{bmatrix})_{0}=(S_{n-1}*\\cdots*S_0)^m_{0,0}$\u3002\n\n---\n\n\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f $w$ \u9700\u8981\u53d6\u591a\u5c11\uff0c\u6839\u636e\u539f CF Tutorial \u7684\u8bf4\u6cd5\uff0c$w$ \u53d6 $2n$\uff0c\u4f46 $w$ \u53ea\u7528\u53d6\u5230 $n$ \u5c31\u80fd\u8fc7\uff0c\u4f46\u6211\u4e0d\u4f1a\u8bc1/kel\uff0c\u5927\u5bb6\u53ef\u4ee5\u770b\u770b[\u8fd9\u91cc](https://codeforces.com/blog/entry/9070)\u4e0b\u9762\u7684\u4e00\u4e2a\u8bc4\u8bba comment-147879\uff0c\u4e0d\u77e5\u9053\u5bf9\u4e0d\u5bf9\u3002\n\n\u7ec6\u8282\uff1a$ans$ \u6700\u5927\u80fd\u5230 $10*20*10^7=2*10^9$\uff0c\u5982\u679c\u4e0d\u4f7f\u7528 unsigned int \u6216 long long\uff0c\u9700\u4f7f\u7528 $-1$ \u4f5c\u4e3a $+\\infty$\u3002\n\n```cpp\n#include<stdio.h>\n#define int unsigned int\nint rd(){\n\tint k=0;char c=getchar();\n\twhile(c>'9'||c<'0')c=getchar();\n\twhile(c>='0'&&c<='9')k=k*10+c-48,c=getchar();\n\treturn k;\n}\nvoid Min(int&x,int y){x=x<y?x:y;}\nint n,m,w,a[21],b[21],f[21][21];\nstruct Mat{\n\tint x[21][21];\n\tMat operator*(const Mat&b)const{\n\t\tMat a;\n\t\tfor(int i=0;i<=n;++i)for(int j=0;j<=n;++j){\n\t\t\ta.x[i][j]=2e9;\n\t\t\tfor(int k=0;k<=n;++k)Min(a.x[i][j],x[i][k]+b.x[k][j]);\n\t\t}\n\t\treturn a;\n\t}\n}A,B;\nMat Pow(Mat x,int a){\n\tMat s(x);--a;\n\twhile(a){\n\t\tif(a&1)s=s*x;\n\t\tx=x*x,a>>=1;\n\t}\n\treturn s;\n}\nvoid Get(int a,int b){for(int i=0;i<=n;++i)A.x[i+1][i]=a,A.x[i][i+1]=b;}\nsigned main(){\n\tfreopen(\"data.in\",\"r\",stdin);\n\tfreopen(\"data.out\",\"w\",stdout);\n\tn=rd(),m=rd();\n\tfor(int i=0;i<n;++i)a[i]=rd();\n\tfor(int i=0;i<n;++i)b[i]=rd();\n\tfor(int i=0;i<=n;++i)for(int j=0;j<=n;++j)A.x[i][j]=2e9;\n\tGet(a[0],b[0]),B=A;\n\tfor(int i=1;i<n;++i)Get(a[i],b[i]),B=A*B;\n\tB=Pow(B,m),printf(\"%u\\n\",B.x[0][0]);\n\treturn 0;\n}\n```\n\n\u53e6\u5916\uff0c\u672c\u9898\u6570\u636e\u53ef\u52a0\u5f3a\u5230 $n\\le100,m\\le1*10^{18},0\\le a_i,b_i<10^9+7$\uff0c\u7b54\u6848\u819c $10^9+7$\u3002\n",
        "postTime": 1603764753,
        "uid": 68467,
        "name": "xcxcli",
        "ccfLevel": 0,
        "title": "CF351C Jeff and Brackets"
    }
]