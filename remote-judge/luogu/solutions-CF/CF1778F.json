[
    {
        "content": "## [CF1778F](https://codeforces.com/contest/1778/problem/F)\n\n### Tutorial\uff1a\n\n\u8bbe $dp_{i,j}$ \u8868\u793a\u5728\u4e0d\u64cd\u4f5c $i$ \u597d\u70b9\u7684\u524d\u63d0\u4e0b\uff0c\u4f7f\u5f97 $a_i$ \u7684 $j$ \u5c0f\u56e0\u5b50\uff08\u4ece $0$ \u5f00\u59cb\u7f16\u53f7\uff09\u662f $i$ \u5b50\u6811\u5185\u6240\u6709\u8282\u70b9\u7684\u6743\u503c\u7684\u516c\u7ea6\u6570\u7684\u6700\u5c0f\u64cd\u4f5c\u6b21\u6570\u3002\n\n\u5047\u8bbe $v$ \u662f $i$ \u7684\u513f\u5b50\uff0c$a_k$ \u7684\u56e0\u5b50\u4e2a\u6570\u4e3a $c_k$\uff0c$div_{i,j}$ \u4e3a $a_i$ \u7684 $j$ \u5c0f\u56e0\u5b50\u3002\n\n$$dp_{i,j}=\\sum_{v}\\min_{k=0}^{C_v}w(div_{v,k},div_{i,j})$$\n\n\u5f53 $x\\bmod y=0$\uff0c$w(x,y)=dp_{v,k}$\uff1b\u5f53 $x\\bmod y\\ne0\\land x^2\\bmod y=0$\uff0c$w(x,y)=dp_{v,k}+1$\uff1b\u5f53 $x\\bmod y\\ne0\\land x^2\\bmod y\\ne0$\uff0c$w(x,y)=+\\infty$\u3002\n\n\u5982\u679c $x\\bmod y=0$\uff0c\u5c31\u8bf4\u660e\u5df2\u7ecf\u6ee1\u8db3 $v$ \u7684\u5b50\u6811\u5185\u6240\u6709\u8282\u70b9\u7684\u516c\u7ea6\u6570\u662f $y$ \u7684\u500d\u6570\uff0c\u4e0d\u9700\u8981\u64cd\u4f5c\uff1b\n\n\u5982\u679c $x\\bmod y\\ne 0\\land x^2\\bmod y=0$\uff0c\u5c31\u8bf4\u660e\u8fd8\u6ca1\u6709\u6ee1\u8db3 $v$ \u7684\u5b50\u6811\u5185\u6240\u6709\u8282\u70b9\u7684\u516c\u7ea6\u6570\u662f $y$ \u7684\u500d\u6570\uff0c\u4f46\u901a\u8fc7\u4e00\u6b21\u64cd\u4f5c\u5c31\u53ef\u4ee5\u6ee1\u8db3\uff1b\n\n\u5426\u5219\uff0c\u5c31\u8bf4\u660e\u4e0d\u7ba1\u600e\u6837\u90fd\u65e0\u6cd5\u6ee1\u8db3\u3002\n\n\u56e0\u4e3a\u503c\u57df\u5f88\u5c0f\uff0c\u6240\u4ee5\u8fd9\u6837\u8f6c\u79fb\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u5bf9\u7684\u3002\n\n$ans=\\max_{j,dp_{1,j}<k}a_1\\times div_{1,j}$\u3002\n\n### Code\uff1a\n```cpp\nconst int N=1e5+10,M=1e3+10;\n \nvector<int>e[N],dp[N],divd[N];\nint k,a[N];\n \nvoid dfs(int cur,int fa)\n{\n\tdp[cur].clear();\n\tdp[cur].resize(divd[a[cur]].size());\n\tfor(auto &nt: e[cur])\n\t{\n\t\tif(nt==fa) continue;\n\t\tdfs(nt,cur);\n\t\trep(i,0,(int) dp[cur].size()-1)\n\t\t{\n\t\t\tint mi=k+1;\n\t\t\trep(j,0,(int) dp[nt].size()-1)\n\t\t\t{\n\t\t\t\tif(divd[a[nt]][j]%divd[a[cur]][i]==0) mi=min(mi,dp[nt][j]);\n\t\t\t\telse if(divd[a[nt]][j]*divd[a[nt]][j]%divd[a[cur]][i]==0) mi=min(mi,dp[nt][j]+1);\n\t\t\t}\n\t\t\tdp[cur][i]=min(dp[cur][i]+mi,k+1);\n\t\t}\n\t}\n\tdp[cur][0]=0;\n}\n \nint main()\n{\n//\tfreopen(\"in\",\"r\",stdin);\n//\tfreopen(\"out\",\"w\",stdout);\n\trep(i,1,M-1)\n\t\tfor(int j=i;j<M;j+=i)\n\t\t\tdivd[j].push_back(i);\n\tint T;\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tint n;\n\t\tcin>>n>>k;\n\t\trep(i,1,n) e[i].clear();\n\t\trep(i,1,n) cin>>a[i];\n\t\trep(i,1,n-1)\n\t\t{\n\t\t\tint u,v;\n\t\t\tcin>>u>>v;\n\t\t\te[u].push_back(v);\n\t\t\te[v].push_back(u);\n\t\t}\n\t\tdfs(1,1);\n\t\tint ans=a[1];\n\t\tper(i,0,(int) dp[1].size()-1) if(dp[1][i]<k) {ans=divd[a[1]][i]*a[1];break;}\n\t\tcout<<ans<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1675347447,
        "uid": 571634,
        "name": "hgzxwzf",
        "ccfLevel": 7,
        "title": "CF1778F"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1778F)\n\n## \u601d\u8def\n\n\u6bd4\u8f83\u50bb\u903c\u7684 $\\rm Div2\\ F$\u3002\n\n\u9996\u5148\u6bcf\u4e2a\u6570\u90fd\u53ef\u4ee5\u8ddf $a_1$ \u6c42\u4e00\u904d $\\gcd$\uff0c\u8fd9\u6837\u663e\u7136\u7b54\u6848\u4e0d\u53d8\u3002\n\n\u7531\u4e8e\u9898\u76ee\u7684\u9650\u5236\uff0c$a_1$ \u81f3\u591a\u4e58\u4e00\u6b21\uff0c\u8003\u8651\u679a\u4e3e\u5b83\u4e58\u4e86\u54ea\u4e2a\u6570\uff0c\u663e\u7136\u662f $a_1$ \u7684\u67d0\u4e2a\u56e0\u5b50\uff0c\u7531\u4e8e $a_i \\le 1000$\uff0c\u6240\u4ee5 $a_i$ \u7684\u56e0\u5b50\u975e\u5e38\u5c11\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u56e0\u5b50\u8bb0\u5f55\u5230 $\\rm DP$ \u72b6\u6001\u91cc\u3002\n\n\u8bbe $f_{x,i}$ \u8868\u793a\u70b9 $x$ \u7684\u5b50\u6811\u5185\u90fd\u662f\u56e0\u5b50 $i$ \u7684\u500d\u6570\u7684\u6700\u5c0f\u64cd\u4f5c\u6b21\u6570\u3002\n\n\u8f6c\u79fb\u5c31\u66b4\u529b\u8f6c\u79fb\uff0c\u4ee5 $\\mathcal O(s^2)$ \u7684\u590d\u6742\u5ea6\u5408\u5e76\u4e24\u4e2a\u8fde\u901a\u5757\uff0c\u5176\u4e2d $s$ \u8868\u793a $a_1$ \u7684\u56e0\u5b50\u4e2a\u6570\u3002\n\n\u6211\u4eec\u628a\u4e00\u4e2a\u6570 $i$ \u8868\u793a\u6210\u4ee5\u4e0b\u7684\u5f62\u5f0f\uff1a$\\prod_{k=1}^{s_i} p_{i,k}^{a_{i,k}}$\uff0c\u5176\u4e2d $p_{i,k}$ \u662f\u8d28\u6570\u3002\n\n\u7136\u540e\u8003\u8651\u5728\u81ea\u8eab\u64cd\u4f5c\u7684\u60c5\u51b5\uff0c\u4e00\u4e2a\u72b6\u6001 $f_{x,i}$ \u80fd\u8f6c\u79fb\u5230 $f_{x,j}$ \u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7684 $p_{i,k}=p_{j,k},2 \\times a_{i,k} \\le a_{j,k}$\uff0c\u4e14 $s_i=s_j$\u3002\n\n\u6ce8\u610f\u7279\u5224\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff0c\u6211 $\\rm WA$ \u4e86 $11$ \u53d1\u624d\u8fc7\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(ns^2)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n//A tree without skin will surely die.\n//A man without face will be alive\n#include<bits/stdc++.h>\nusing namespace std;\n#define all(x) (x).begin(),(x).end()\nint const N=1e5+10;\nint const M=1e3+10;\nint f1[M],a[N],n,k,cnt,f[N][M],g[M][M],cet[M][M];\nvector<int>b[N],vec,d[M],p[M];\ninline void dfs(int x,int fa){\n    for (auto v:b[x]){\n        if (v==fa) continue;\n        dfs(v,x);\n        memset(f1,0x3f,sizeof(int)*(vec.size()));\n        for (int i=0;i<vec.size();++i)\n            for (int j=0;j<vec.size();++j)\n                f1[g[i][j]]=min(f1[g[i][j]],f[x][i]+f[v][j]);\n        for (int i=0;i<vec.size();++i) f[x][i]=f1[i];\n    }\n    if (x!=1){\n        for (int i=vec.size()-1;~i;--i)\n            for (int j=i+1;j<vec.size();++j)\n                if (cet[i][j]) f[x][j]=min(f[x][j],f[x][i]+cet[i][j]);\n    }\n}\ninline void solve(){\n    cin>>n>>k;--k;int u,v;vec.clear();\n    for (int i=1;i<=n;++i) cin>>a[i],a[i]=__gcd(a[i],a[1]),b[i].clear();\n    for (int i=1;i<n;++i) cin>>u>>v,b[u].push_back(v),b[v].push_back(u);\n    if (k<0) return cout<<a[1]<<'\\n',void();\n    for (int i=1;i<=a[1];++i) if (a[1]%i==0) vec.push_back(i);\n    for (int i=0;i<vec.size();++i)\n        for (int j=0;j<vec.size();++j)\n            g[i][j]=lower_bound(all(vec),__gcd(vec[i],vec[j]))-vec.begin();\n    for (int i=0;i<vec.size();++i){\n        d[i].clear();p[i].clear();\n        int y=vec[i];for (int j=2;j*j<=y;++j){\n            if (y%j==0) d[i].push_back(j),p[i].push_back(0);\n            while (y%j==0) y/=j,++p[i][d[i].size()-1];\n        }\n        if (y^1) d[i].push_back(y),p[i].push_back(0),++p[i][d[i].size()-1];\n    }\n    for (int i=0;i<vec.size();++i)\n        for (int j=i+1;j<vec.size();++j) if (d[i]==d[j]){\n            int Max=1;\n            for (int k=0;k<d[i].size();++k)\n                Max=max(Max,(p[j][k]-p[i][k]+p[i][k]-1)/p[i][k]);\n            if (Max>1) cet[i][j]=0;else cet[i][j]=Max;\n        }else cet[i][j]=0;\n    for (int i=1;i<=n;++i){\n        memset(f[i],0x3f,sizeof(int)*(vec.size()));\n        a[i]=lower_bound(all(vec),a[i])-vec.begin();\n        f[i][a[i]]=0;\n    }\n    dfs(1,0);\n    for (int i=a[1];i;--i) if (f[1][i]<=k) return cout<<vec[a[1]]*vec[i]<<'\\n',void();\n    return cout<<vec[a[1]]<<'\\n',void();\n}\nsigned main(){\n    ios::sync_with_stdio(false);\n    cin.tie(0),cout.tie(0);\n    int t;cin>>t;while (t--) solve();\n    return 0;\n}\n```",
        "postTime": 1675326163,
        "uid": 253608,
        "name": "Tx_Lcy",
        "ccfLevel": 7,
        "title": "CF1778F Maximizing Root"
    }
]