[
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/zkyJuruo/p/15509016.html)\n\n## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n \\times n$ \u7684\u77e9\u9635\uff0c\u5176\u4e2d\u4ec5\u6709 $k$ \u4e2a\u4f4d\u7f6e\u7684\u503c\u53ef\u80fd\u4e0d\u662f $1$\u3002\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u4f4d\u7f6e $(x_i,y_i)$\uff0c\u5176\u503c\u4e3a $w_i$\u3002\u8981\u6c42\u8fd9\u4e2a\u77e9\u9635\u7684\u79ef\u548c\u5f0f\uff0c\u5bf9 $10^9 + 7$ \u53d6\u6a21\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$1 \\le n \\le 10^5$\uff0c$1 \\le k \\le 50$\uff0c$1 \\le x_i,y_i \\le n$\uff0c$0 \\le w_i < 998244353$\u3002\n\n## \u9898\u89e3\n\n\u9996\u5148\u628a\u6bcf\u4e2a $w_i$ \u62c6\u6210 $1$ \u548c $w_i-1$\uff0c\u4e5f\u5c31\u662f\u628a\u6bcf\u4e2a\u7279\u6b8a\u4f4d\u7f6e\u770b\u505a\u662f\u5728 $1$ \u7684\u57fa\u7840\u4e0b\u989d\u5916\u589e\u52a0\u4e86 $w_i-1$\u3002\n\n\u7136\u540e\u679a\u4e3e\u6211\u4eec\u7b97\u79ef\u548c\u5f0f\u7684\u65f6\u5019\u7528\u4e86\u54ea\u4e9b\u989d\u5916\u589e\u52a0\u7684\u5143\u7d20\uff0c\u8981\u6c42\u8fd9\u4e9b\u5143\u7d20\u7684 $x_i$ \u4e92\u4e0d\u76f8\u540c\uff0c$y_i$ \u4e5f\u4e92\u4e0d\u76f8\u540c\u3002\n\n\u5bb9\u6613\u60f3\u5230\u4e00\u4e2a\u66b4\u529b\uff1a\n\n\u5bf9\u4e8e\u6bcf\u4e00\u5217\uff0c\u679a\u4e3e\u989d\u5916\u589e\u52a0\u7684\u662f\u54ea\u4e00\u884c\uff0c\u6216\u662f\u4e0d\u9009\u62e9\u989d\u5916\u589e\u52a0\u7684\uff0c\u7136\u540e\u72b6\u538b\u54ea\u4e9b\u884c\u5df2\u7ecf\u88ab\u5360\u7528\u4e86\u3002\n\n\u8003\u8651\u4f18\u5316\u3002\u6ce8\u610f\u5230\u5982\u679c\u4e00\u884c\u5728\u4e4b\u540e\u7684\u5217\u90fd\u4e0d\u4f1a\u7528\u5230\u4e86\uff0c\u90a3\u5c31\u53ef\u4ee5\u4e0d\u72b6\u538b\u8fd9\u884c\u3002\n\n\u8fd9\u6837\u4e8b\u5b9e\u4e0a\u5c31\u53ef\u4ee5\u8fc7\u4e86\uff0c\u4f46\u662f\u8fd9\u6837\u53ef\u80fd\u4f1a\u88ab\u5361\u5230 $\\Theta(k^22^{\\frac{k}{2}})$\u3002\n\n\u6ce8\u610f\u5230\u5982\u679c\u4e00\u884c\u7684\u5143\u7d20\u5f88\u5c11\uff0c\u90a3\u6211\u4eec\u53bb\u6389\u8fd9\u4e00\u884c\u5c31\u4f1a\u5f88\u5bb9\u6613\u3002\n\n\u4e8e\u662f\u6bcf\u6b21\u627e\u5230\u5143\u7d20\u6570\u6700\u5c11\u7684\u884c\uff0c\u5e76\u627e\u5230\u7528\u5230\u8fd9\u884c\u7684\u5217\uff0c\u5148\u679a\u4e3e\u8fd9\u4e9b\u88ab\u7528\u5230\u7684\u5217\u3002\n\n\u8fd9\u6837\u8dd1\u5f97\u98de\u5feb\uff0c\u5728 CF \u4e0a\u662f\u6700\u4f18\u89e3\uff08\u622a\u81f3 2021.11.4\uff09\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define L(i, j, k) for (int i = (j); i <= (k); i++)\n#define R(i, j, k) for (int i = (j); i >= (k); i--) \n#define sz(a) ((int) (a).size())\n#define ll long long \n#define vi vector < int > \nusing namespace std;\nconst int N = 1 << 6, M = 1e5 + 7, mod = 1e9 + 7;\nint n, m, a[N][N], fac[M], ns;\nint x[N], y[N], w[N];\nint arra[N], atot, arrb[N], btot;\nint cnta[N], cntb[N];\nunordered_map < ll, int > mp[N], cp[N];\nint main () {\n\tios :: sync_with_stdio(false);\n\tcin.tie(0); cout.tie(0);\n\tcin >> n >> m;\n\tmemset(a, -1, sizeof(a));\n\tfac[0] = 1;\n\tL(i, 1, n) fac[i] = (ll) fac[i - 1] * i % mod;\n\tL(i, 1, m) {\n\t\tcin >> x[i] >> y[i] >> w[i], (w[i] += mod - 1) %= mod;\n\t\tarra[++atot] = x[i];\n\t\tarrb[++btot] = y[i];\n\t}\n\tsort(arra + 1, arra + atot + 1), atot = unique(arra + 1, arra + atot + 1) - arra - 1;\n\tsort(arrb + 1, arrb + btot + 1), btot = unique(arrb + 1, arrb + btot + 1) - arrb - 1;\n\tL(i, 1, m) \n\t\tx[i] = lower_bound (arra + 1, arra + atot + 1, x[i]) - arra, y[i] = lower_bound(arrb + 1, arrb + btot + 1, y[i]) - arrb, \n\t\ta[x[i]][y[i]] = w[i], ++cnta[x[i]], ++cntb[y[i]];\n\tmp[0][0] += 1;\n\twhile (1) {\n\t\tint o = -1;\n\t\tL(i, 1, btot) if(cntb[i] && (o == -1 || cntb[o] > cntb[i])) o = i;\n\t\tif(o == -1) \n\t\t\tbreak ;\n\t\tL(i, 1, atot) if(a[i][o] != -1 && cnta[i]) {\n\t\t\tcnta[i] = 0;\n\t\t\tll cle = ((1LL << btot) - 1) << 1, msk = 0;\n\t\t\tvi S;\n\t\t\tL(j, 1, btot) if(a[i][j] != -1) {\n\t\t\t\tS.push_back(j);\n\t\t\t\tcntb[j] -= 1, msk |= 1LL << j;\n\t\t\t\tif(!cntb[j]) cle ^= 1LL << j;\n\t\t\t}\n\t\t\tL(z, 0, m) \n\t\t\t\tfor (auto u : mp[z]) {\n\t\t\t\t\t(cp[z][u.first & cle] += u.second) %= mod;\n\t\t\t\t\tfor (const int &t : S) if(!(u.first >> t & 1)) \n\t\t\t\t\t\t(cp[z + 1][(u.first | (1LL << t)) & cle] += (ll) u.second * a[i][t] % mod) %= mod; \n\t\t\t\t}\n\t\t\tL(z, 0, m) swap (mp[z], cp[z]), cp[z].clear ();\n\t\t}\n\t}\n\tL(z, 0, m) for (auto u : mp[z]) (ns += (ll) u.second * fac[n - z] % mod) %= mod; \n\tcout << ns << '\\n';\n\treturn 0;\n} \n```\n\n\n------\n\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1636017296,
        "uid": 173660,
        "name": "zhoukangyang",
        "ccfLevel": 0,
        "title": "CF468E Permanent"
    },
    {
        "content": "\u5f88\u4e45\u6ca1\u5728 luogu \u53d1\u8fc7\u9898\u89e3\u4e86\u3002\u3002\n\n\u4efb\u610f\u6a21\u6570\u4e0b\u7684\u79ef\u548c\u5f0f\u5e76\u6ca1\u6709\u591a\u9879\u5f0f\u89e3\u6cd5\u3002\u8003\u8651\u79ef\u548c\u5f0f\u7684\u7ec4\u5408\u610f\u4e49\uff0c$i,A_i$ \u90fd\u662f\u4e92\u4e0d\u76f8\u540c\u7684\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u4e8c\u5206\u56fe\u7684\u4e00\u4e2a\u5b8c\u7f8e\u5339\u914d\u3002\u56e0\u6b64\u4efb\u610f\u77e9\u9635\u7684\u79ef\u548c\u5f0f\u5c31\u662f $A_{x,y}$ \u770b\u4f5c\u5de6\u4fa7 $x$ \u53f3\u4fa7 $y$ \u4e4b\u95f4\u7684\u8fb9\u6743\u540e\u6240\u6709\u5b8c\u7f8e\u5339\u914d\u8fb9\u6743\u7684\u79ef\u7684\u548c\u3002\n\n\u5982\u679c\u6211\u4eec\u7ed9\u6240\u6709 $A_{x,y} \\neq 1$ \u62c6\u6210 $1,A_{x,y} - 1$ \u8fd9\u4e24\u4e2a\u4e1c\u897f\uff0c\u7136\u540e\u6240\u6709\u8fb9\u4e0a\u90fd\u6709\u4e86\u4e00\u4e2a\u957f\u5ea6\u4e3a $1$ \u7684\u8fb9\u3002\u4e8e\u662f\u73b0\u5728\u5c31\u53ef\u4ee5\u4e0d\u8003\u8651\u6240\u6709\u957f\u5ea6\u4e3a $1$ \u7684\u8fb9\u4e86\u3002\u6211\u4eec\u6c42\u51fa\u9664\u5f00\u8fb9\u6743\u4e3a $1$ \u7684\u8fb9\u540e\u7684\u4efb\u610f\u4e00\u4e2a\u4e8c\u5206\u56fe\u5339\u914d\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5339\u914d\u7684\u8d21\u732e\u76f4\u63a5\u4e58\u4e0a\u672a\u5339\u914d\u70b9\u7684\u4e2a\u6570\u7684\u9636\u4e58\u5373\u53ef\u3002\u56e0\u4e3a\u5269\u4e0b\u7684\u70b9\u90fd\u53ef\u4ee5\u4efb\u610f\u5339\u914d\uff0c\u800c\u4e14\u4e00\u5b9a\u53ef\u4ee5\u901a\u8fc7 $1$ \u8fb9\u5339\u914d\u4e0a\u3002\n\n\u4f46\u662f\u8fd9\u6837\u70b9\u7684\u6570\u91cf\u8fd8\u662f $O(2k)$ \u7684\u3002\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5bf9\u6bcf\u4e2a\u8fde\u901a\u5757\u5206\u522b\u8ba1\u7b97\uff0c\u7136\u540e\u4e58\u6cd5\u539f\u7406\u4e58\u8d77\u6765\u5373\u53ef\u3002\u8fd9\u6837\u6bcf\u4e2a\u8fde\u901a\u5757\u5185\u7684\u70b9\u6570\u5c31\u4e00\u5b9a\u4e0d\u8d85\u8fc7 $k$ \u4e86\u3002\u4e00\u79cd\u5f88\u5bb9\u6613\u60f3\u5230\u7684\u505a\u6cd5\u662f\u5bf9\u6bcf\u4e2a\u8fde\u901a\u5757\u505a\u72b6\u538b $dp$ \uff0c\u8003\u8651\u628a\u70b9\u6570\u8f83\u5c0f\u7684\u4e00\u8fb9\u538b\u6210\u72b6\u6001\uff0c\u7136\u540e\u679a\u4e3e\u70b9\u6570\u8f83\u591a\u7684\u4e00\u8fb9\u6765\u505a $dp$ \uff0c\u8fd9\u6837\u505a\u4e00\u4e2a\u70b9\u6570\u4e3a $n$ \u8fb9\u6570\u4e3a $m$ \u7684\u8fde\u901a\u5757\u7684\u590d\u6742\u5ea6\u662f $O((\\frac n 2+m)2^{\\frac n 2}) $ \u3002\u8fd9\u6837\u662f\u8fc7\u4e0d\u53bb\u7684\uff0c\u5982\u679c\u5361\u6ee1\u5c31\u662f $50 \\times 2^{25}$ \u3002\n\n\u8003\u8651\u53e6\u5916\u4e00\u79cd\u505a\u6cd5\uff0c\u6c42\u51fa\u8fd9\u4e2a\u4e8c\u5206\u56fe\u7684\u4e00\u68f5\u751f\u6210\u6811\uff0c\u7136\u540e\u5bf9\u4e8e\u6240\u6709\u73af\u8fb9\u679a\u4e3e\u73af\u8fb9\u7684\u9009\u53d6\u60c5\u51b5\uff0c\u7136\u540e\u5728\u6811\u4e0a\u505a\u4e00\u6b21\u80cc\u5305\u6765\u89e3\u51b3\u3002\u8fd9\u6837\u505a\u7684\u590d\u6742\u5ea6\u662f $O(2^{m-n} n^2)$ \u3002\n\n\u6211\u4eec\u9009\u53d6\u5176\u4e2d\u8f83\u5c0f\u7684\u4e00\u79cd\u6765\u505a\uff0c\u590d\u6742\u5ea6\u662f $O(\\min\\{m 2^{\\frac n 2},n^22^{m-n}\\})$ \u3002\u5728 $n < \\frac 2 3 m$ \u7684\u65f6\u5019\u7528\u7b2c\u4e00\u4e2a\u505a\u6cd5\uff0c\u590d\u6742\u5ea6\u5c31\u662f $O(n^2 2^{\\frac 1 3 m})$ \u3002\n\n\u4e8e\u662f\u6700\u7ec8\u590d\u6742\u5ea6\u5c31\u662f $O(k^22^{\\frac 1 3 k})$ \uff0c\u800c\u4e14\u975e\u5e38\u4e0d\u6ee1\u3002\n\n```cpp\n#include \"iostream\"\n#include \"algorithm\"\n#include \"cstring\"\n#include \"cstdio\"\n#include \"cmath\"\n#include \"vector\"\n#include \"map\"\n#include \"set\"\n#include \"queue\"\nusing namespace std;\n#define MAXN 200006\n//#define int long long\n#define rep(i, a, b) for (int i = (a), i##end = (b); i <= i##end; ++i)\n#define per(i, a, b) for (int i = (a), i##end = (b); i >= i##end; --i)\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define eb emplace_back\n#define vi vector<int>\n#define all(x) (x).begin() , (x).end()\n#define mem( a ) memset( a , 0 , sizeof a )\ntypedef long long ll;\nconst int P = 1e9 + 7;\nint n , k;\nint A[MAXN];\nint x[MAXN] , y[MAXN] , w[MAXN];\nvi X , Y;\nint fa[MAXN] , se[MAXN] , sz[MAXN];\nint find( int x ) {\n\treturn x == fa[x] ? x : fa[x] = find( fa[x] );\n}\n\ninline void Inc( int& x , int y ) {\n\tx = ( x + y > P ? x + y - P : x + y );\n}\n\nvector<pii> G[MAXN];\n\nvi nl , nr;\nint bc[MAXN];\nint as[106];\nnamespace lsjtxdy{\n\tint dp[106][1 << 16 | 66];\n\tvoid wkr( ) {\n\t\tint sl = nl.size() , sr = nr.size();\n\t\trep( i , 0 , sl + sr ) rep( j , 0 , ( 1 << sl ) - 1 ) dp[i][j] = 0;\n\t\trep( i , 0 , sl + sr ) as[i] = 0;\n\t\tdp[0][0] = 1;\n\t\trep( i , 1 , sr ) rep( s , 0 , ( 1 << sl ) - 1 ) {\n\t\t\tInc( dp[i][s] , dp[i - 1][s] );\n\t\t\tint u = nr[i - 1];\n\t\t\tfor( auto t : G[u] ) if( ~s & ( 1 << bc[t.fi] ) ) {\n\t\t\t\tint v = t.fi , w = t.se;\n\t\t\t\tint ts = s | ( 1 << bc[v] );\n\t\t\t\tInc( dp[i][ts] , dp[i - 1][s] * 1ll * w % P );\n\t\t\t}\n\t\t}\n\t\trep( i , 0 , ( 1 << sl ) - 1 ) Inc( as[__builtin_popcount( i )] , dp[sr][i] );\n\t}\n}\nnamespace zjktsdy {\n\tvector<pair<int,pii>> fe;\n\tint dep[MAXN];\n\tvector<pii> g[MAXN];\n\tvi nd;\n\tvoid dfs( int u , int f ) {\n\t\tnd.pb( u );\n\t\tdep[u] = dep[f] + 1;\n\t\tfor( auto t : G[u] ) if( t.fi != f ) {\n\t\t\tif( !dep[t.fi] ) dfs( t.fi , u ) , g[u].pb( t );\n\t\t\telse if( dep[t.fi] > dep[u] ) fe.eb( mp( u , t ) );\n\t\t}\n\t}\n\tint fk[MAXN];\n\tint dp[106][2][52] , pd[2][52] , siz[106];\n\tvoid afs( int u ) {\n\t\tint sz = 1;\n\t\tmem( dp[u] );\n\t\tdp[u][0][0] = 1;\n\t\tfor( auto t : g[u] ) {\n\t\t\tint v = t.fi;\n\t\t\tafs( v );\n\t\t\tmemcpy( pd , dp[u] , sizeof dp[u] );\n\t\t\tmem( dp[u] );\n\t\t\trep( i , 0 , sz ) rep( j , 0 , siz[v] ) {\n\t\t\t\tInc( dp[u][0][i + j] , pd[0][i] * 1ll * ( dp[v][0][j] + dp[v][1][j] ) % P );\n\t\t\t\tif( !fk[u] ) {\n\t\t\t\t\tInc( dp[u][1][i + j] , pd[1][i] * 1ll * ( dp[v][0][j] + dp[v][1][j] ) % P );\n\t\t\t\t\tif( !fk[v] ) Inc( dp[u][1][i + j + 1] , pd[0][i] * 1ll * dp[v][0][j] % P * t.se % P );\n\t\t\t\t}\n\t\t\t}\n\t\t\tsz += siz[v];\n\t\t}\n\t\tsiz[u] = sz;\n\t}\n\t\n\tvoid wkr( int r ) {\n\t\tnd.clear();\n\t\trep( i , 0 , k * 2 ) as[i] = dep[i] = 0 , g[i].clear();\n\t\tfe.clear();\n\t\tdfs( r , r );\n\t\tint ta = 0 , ts = 1;\n\t\tfor( int s = 0 ; s < ( 1 << fe.size() ) ; ++ s ) {\n\t\t\tfor( int x : nd ) fk[x] = 0;\n\t\t\tta = __builtin_popcount( s ) , ts = 1;\n\t\t\trep( i , 0 , fe.size() - 1 ) if( s & ( 1 << i ) ) {\n\t\t\t\tint u = fe[i].fi , v = fe[i].se.fi;\n\t\t\t\tif( fk[u] || fk[v] ) { ts = 0; break; }\n\t\t\t\tts = ts * 1ll * fe[i].se.se % P , fk[u] = fk[v] = 1;\n\t\t\t}\n\t\t\tif( !ts ) continue;\n\t\t\tafs( r );\n\t\t\trep( i , 0 , k ) Inc( as[i + ta] , ( dp[r][0][i] + dp[r][1][i] ) * 1ll * ts % P );\n\t\t}\n\t}\n}\n\nint ans[105] , pas[105];\nint J[100006];\nvoid solve() {\n\tcin >> n >> k;\n\tJ[0] = 1;\n\trep( i , 1 , n ) J[i] = J[i - 1] * 1ll * i % P;\n\trep( i , 1 , k ) {\n\t\tscanf(\"%d%d%d\",x + i,y + i,w + i);\n\t\t-- w[i];\n\t\tX.pb( x[i] ) , Y.pb( y[i] );\n\t}\n\tsort( all( X ) ) , sort( all( Y ) );\n\tX.erase( unique( all( X ) ) , X.end() ) , Y.erase( unique( all( Y ) ) , Y.end() );\n\trep( i , 1 , k ) \n\t\tx[i] = lower_bound( all( X ) , x[i] ) - X.begin() + 1 , y[i] = lower_bound( all( Y ) , y[i] ) - Y.begin() + 1;\n\tint sx = X.size() , sy = Y.size();\n\trep( i , 1 , k ) {\n\t\tG[x[i]].eb( mp( y[i] + sx , w[i] ) );\n\t\tG[y[i] + sx].eb( mp( x[i] , w[i] ) );\n//\t\tcout << x[i] << ' ' << y[i] + sx << endl;\n\t}\n\trep( i , 1 , sx + sy ) sz[i] = 1 , fa[i] = i;\n\trep( i , 1 , k ) {\n\t\tint u = find( x[i] ) , v = find( y[i] + sx );\n\t\t++ se[v];\n\t\tif( u == v ) continue;\n\t\tfa[u] = v , sz[v] += sz[u] , se[v] += se[u];\n\t}\n\tans[0] = 1;\n\trep( i , 1 , sx + sy ) if( fa[i] == i && sz[i] > 1 ) {\n\t\tif( sz[i] <= 2 * se[i] / 3 ) {\n\t\t\tnl.clear() , nr.clear();\n\t\t\trep( j , 1 , sx ) if( find( j ) == i ) nl.pb( j ) , bc[j] = nl.size() - 1;\n\t\t\trep( j , sx + 1 , sx + sy ) if( find( j ) == i ) nr.pb( j ) , bc[j] = nr.size() - 1;\n\t\t\tif( nl.size() > nr.size() ) swap( nl , nr );\n\t\t\tlsjtxdy::wkr( );\n\t\t} else {\n\t\t\tzjktsdy::wkr( i );\n\t\t}\n\t\tmemcpy( pas , ans , sizeof ans );\n\t\tmem( ans );\n\t\trep( i , 0 , k ) if( as[i] ) \n\t\t\trep( j , i , k )\n\t\t\t\tInc( ans[j] , as[i] * 1ll * pas[j - i] % P );\n\t}\n\tint res = 0;\n\trep( i , 0 , k ) Inc( res , ans[i] * 1ll * J[n - i] % P );\n\tcout << res << endl;\n}\n\nsigned main() {\n//    int T;cin >> T;while( T-- ) solve();\n    solve();\n}\n\n```\n\n\n\n",
        "postTime": 1611290905,
        "uid": 63398,
        "name": "yijan",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF468E \u3010Permanent\u3011"
    }
]