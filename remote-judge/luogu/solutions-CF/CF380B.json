[
    {
        "content": "## \u9898\u76ee\u601d\u8def\uff1a\n\u7531\u4e8e\u9898\u610f\u6709\u4eba\u89e3\u91ca\u4e86\uff0c\u6240\u4ee5\u6211\u76f4\u63a5\u8bb2\u601d\u8def\u3002\n\n\u601d\u8def\uff1a$\\boxed{\\color{red}\\textbf{\u66b4\u529b}}$\n\n\u5bf9\u4e8e\u6dfb\u52a0\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e00\u5c42\u7528\u4e00\u4e2a\u52a8\u6001\u6570\u7ec4\u8bb0\u5f55\u4e0b\u6240\u6709\u7684\u6dfb\u52a0\u64cd\u4f5c\uff0c\u53ea\u9700\u8bb0\u5f55 l\uff0cr \u548c x\u3002\u6bcf\u5f53\u51fa\u73b0\u9700\u8981\u67e5\u8be2\u65f6\uff0c\u53ea\u9700\u7531\u6839\u8282\u70b9\u5411\u4e0b\uff0c\u904d\u5386\u6bcf\u5c42\u7684 1 \u64cd\u4f5c\uff0c\u5224\u65ad\u662f\u5426\u5bf9\u5176\u9020\u6210\u5f71\u54cd\u3002 \u7136\u540e\u6bd4\u5982\u5728 i \u5c42\u7684\u533a\u95f4\u662f $[x,y]$ \uff0c\u5230 $i+1$ \u5c42\u65f6\u53ef\u4ee5\u8ba1\u7b97\u7684\u51fa $[xx,yy]$ \uff0c\u6ca1\u6709\u5fc5\u8981\u4e00\u4e2a\u4e00\u4e2a\u53bb\u5224\u65ad\uff0c\u90a3\u6837\u5fc5\u8d85\u65f6\u3002\n\n$xx=x+\\log_2(x)$\uff0c$yy=y+\\log_2(y)$ +(\u662f\u5426\u4e3a $2^k$ ? 1 : 0)\u3002\n\n\u4f46\u662f\u5982\u679c\u4e00\u6b21\u4e00\u6b21\u53bb\u8ba1\u7b97\u7684\u8bdd\u65f6\u95f4\u5f00\u9500\u5f88\u5927\uff0c\u4f1a\u8d85\u65f6\uff0c\u5fc5\u987b\u5728\u63d0\u524d\u8bb0\u5f55\u4e0b\u6240\u6709\u4e0b\u6807\u7684\u5173\u7cfb\u3002\n\n\u90a3\u4e48\u8fd9\u9898\u5c31\u8fce\u5203\u800c\u89e3\u4e86\u3002\n\n## \u4ee3\u7801\uff1a\n```c\n#include <bits/stdc++.h>\n//#include<set>\n//#include<vector>\nusing namespace std;\nconst int N = 7005;\nconst int M = 200000;\nstruct state{\n\tint l, r, val;\n\tstate(){}\n\tstate(int l, int r, int val) {\n\t\tthis->l = l; this->r = r; this->val = val;\n\t}\n};\nint n, m, dl[M], dr[M];\nvector<state> v[N];//\u52a8\u6001\u6570\u7ec4\nint solve (int d, int x, int y) {\n\tset<int> ans;\n\tfor (int i = d; i <= n; i++){\n\t\tfor (int j=0;j<v[i].size();j++){\n\t\t\tstate& c = v[i][j];\n\t\t\tif (c.l <= y && c.r >= x) ans.insert(c.val);\n\t\t}\n\t\tx = (dl[x] == -1 ? dr[x] : dl[x]);\n\t\ty = dr[y];\n\t}\n\treturn ans.size();\t\n}\nvoid init () {\n\tint cnt = 1, p = 3;\n\tmemset(dl, -1, sizeof(dl));\n\tmemset(dr, -1, sizeof(dr));\n\tdl[1] = 1; dr[1] = 2;\n\tfor (int i = 2; i < M; i++) {\n\t\tif ((1<<cnt) == i) {\n\t\t\tcnt++;\n\t\t\tdl[i] = p++;\n\t\t}\n\t\tdr[i] = p++;\n\t}\n}\nint main () {\n\tinit ();\n\tint order, d, x, y, val;\n\tscanf(\"%d%d\", &n, &m);\n\tfor (int i = 0; i < m; i++) {\n\t\tscanf(\"%d\", &order);\n\t\tif (order == 1) {\n\t\t\tscanf(\"%d%d%d%d\", &d, &x, &y, &val);\n\t\t\tv[d].push_back(state(x, y, val));\n\t\t} else {\n\t\t\tscanf(\"%d%d\", &d, &x);\n\t\t\tprintf(\"%d\\n\", solve(d, x, x));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1640617326,
        "uid": 481718,
        "name": "qjxqjx",
        "ccfLevel": 3,
        "title": "CF380B Sereja and Tree \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u5148\u5b89\u5229\u4e00\u53d1**[\u7ffb\u8bd1](https://www.luogu.org/discuss/show/33341?page=1)**.\n\n\u9762\u5bf9\u6570\u636e\u8303\u56f4\u6211\u4eec\u53d1\u73b0$m^2$\u7684\u590d\u6742\u5ea6\u662f\u80fd\u8fc7\u7684,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u6bcf\u4e00\u6b21\u8be2\u95ee\u66b4\u529b\u626b\u4e4b\u524d\u7684\u4fee\u6539,\u7136\u540e\u7edf\u8ba1\u7b54\u6848.\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee,\u8be2\u95ee\u7684\u662f\u5b50\u6811,\u800c\u4fee\u6539\u7684\u662f\u540c\u4e00\u6df1\u5ea6\u7684\u6807\u53f7\u533a\u95f4,\u6240\u4ee5\u6211\u4eec\u9700\u8981\u77e5\u9053\u8be2\u95ee\u7684\u5b50\u6811\u5728\u8fd9\u4e00\u6df1\u5ea6\u6240\u8986\u76d6\u7684\u6807\u53f7\u533a\u95f4,\u800c\u8fd9\u624d\u662f\u8fd9\u4e00\u9898\u7684\u91cd\u70b9.\n\n----------------\n\n\u8bbe\u5b50\u6811\u7684```root```\u4e3a```(t,id)```,\u5219```root```\u7684\u53f3\u5b69\u5b50(\u5355\u4e00\u5b69\u5b50)\u7684\u6807\u53f7\u4e3a```(t,[1,id])```\u4e2d```$2^k$```\u7684\u4e2a\u6570\u52a0\u4e0aid,\u5f53```id=$2^k$```\u65f6\u5de6\u5b69\u5b50\u4e3a\u53f3\u5b69\u5b50\u7684\u6807\u53f7```-1```.\n\n\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u4e2a\u6df1\u5ea6\u7684\u8986\u76d6\u533a\u95f4,\u7136\u540e\u5224\u533a\u95f4\u91cd\u53e0\u5c31\u597d\u4e86.\n\n\u5177\u4f53\u89c1\u4ee3\u7801\uff1a\n\n-------------------------\n```\n#include<set>\n#include<cstdio>\n#define N 7005\n//\u5feb\u8bfb;\ninline int read(){\n\tint x=0,f=0;\n\tregister char ch=getchar();\n\tfor(;ch<48||ch>57;ch=getchar())f|=ch=='-';\n\tfor(;ch>47&&ch<58;ch=getchar())\n\tx=(x<<1)+(x<<3)+(ch^48);\n\treturn f?~x+1:x;\n}\nusing namespace std;set<int>s;\nint t[N],l[N],r[N],x[N],pos[N][2],cnt;\nint main()\n{\n\tint n=read(),m=read();\n\tfor(int i=0;i<m;++i)\n\tif(read()==1)t[++cnt]=read(),l[cnt]=read(),r[cnt]=read(),x[cnt]=read();//\u8bb0\u5f55\u4fee\u6539;\n\telse\n\t{\n\t\tint lvl=read();pos[lvl][1]=pos[lvl][0]=read();s.clear();\n        //\u5904\u7406\u8986\u76d6\u533a\u95f4;\n\t\tfor(int i=lvl;i<n;++i)\n\t\t{\n\t\t\tint k=pos[i][0],j=0,c=0;\n\t\t\tfor(;k;k>>=1,++j)c+=k&1;\n\t\t\tpos[i+1][0]=pos[i][0]+j-(c==1);\n\t\t\tk=pos[i][1],j=0;\n\t\t\tfor(;k;k>>=1,++j);\n\t\t\tpos[i+1][1]=pos[i][1]+j;\n\t\t}\n        //\u7ebf\u6bb5\u8986\u76d6;\n        for(int i=1;i<=cnt;++i)\n\t\tif(t[i]>=lvl&&(l[i]<=pos[t[i]][0]&&pos[t[i]][0]<=r[i]||l[i]<=pos[t[i]][1]&&pos[t[i]][1]<=r[i]||pos[t[i]][0]<=l[i]&&r[i]<=pos[t[i]][1]))\n\t\ts.insert(x[i]);printf(\"%d\\n\",s.size());\n\t}\n}\n```",
        "postTime": 1517996134,
        "uid": 27029,
        "name": "Hades18",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF380B \u3010Sereja and Tree\u3011"
    }
]