[
    {
        "content": "[$$\\Large\\texttt{My Blog}$$](https://hydingsy.github.io/articles/problem-Codeforces-594D-REQ/)\n\n---\n\n## Description\n\n> \u9898\u76ee\u94fe\u63a5\uff1a[Codeforces 594D](https://codeforces.com/contest/594/problem/D/)\n\n\u4eca\u5929\u7684\u6570\u5b66\u8bfe\u4e0a\uff0c\u8001\u5e08\u544a\u8bc9 Vovochka \u6b63\u6574\u6570\u7684\u6b27\u62c9\u51fd\u6570 $\\varphi(n)$ \u662f\u8ba1\u7b97\u5c0f\u4e8e\u7b49\u4e8e $n$ \u4e14\u4e0e $n$ \u4e92\u8d28\u7684\u6b63\u6574\u6570\u7684\u51fd\u6570\uff0c$1$ \u548c\u4efb\u610f\u6b63\u6574\u6570\u4e92\u8d28\u6240\u4ee5 $\\varphi(1)=1$\u3002\n\n\u73b0\u5728\u8001\u5e08\u7ed9\u4e86 Vovochka \u4e00\u4e2a\u6570\u5217 $a_1,a_2,\\dots,a_n$\uff0c\u8981\u6c42\u56de\u7b54 $q$ \u4e2a\u8be2\u95ee $l_i,r_i$\uff0c\u8ba1\u7b97 $\\varphi\\left(\\prod_{i=l}^r a_i\\right)$ \u7684\u503c\uff0c\u7b54\u6848\u5bf9 $10^9\u2009+\u20097$ \u53d6\u6a21\u3002\u8fd9\u4e2a\u95ee\u9898\u5bf9\u4e8c\u5e74\u7ea7\u5b66\u751f\u6765\u8bf4\u592a\u96be\u4e86\uff0c\u6240\u4ee5\u4f60\u51b3\u5b9a\u5e2e\u52a9 Vovochka\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$1\\le n,q\\le 2\\times 10^5$\uff0c$1\\le a_i\\le 10^6$\n\n------\n\n## Solution\n\n\u7531\u4e8e\u53ea\u6709\u8be2\u95ee\u64cd\u4f5c\uff0c\u56e0\u6b64\u6211\u4eec\u9996\u5148\u60f3\u5230**\u79bb\u7ebf**\u540e\u7528\u83ab\u961f\u89e3\u51b3\u3002\u4f46\u662f\u83ab\u961f\u7684\u590d\u6742\u5ea6\u4e3a $O(q\\sqrt n\\log a_i)$\uff08\u5176\u4e2d $\\log a_i$ \u6307\u6bcf\u4e2a\u6570\u7684\u672c\u8d28\u4e0d\u540c\u7684\u8d28\u56e0\u5b50\u4e2a\u6570\uff09\uff0c\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\u672c\u9898\uff08\u6211\u5361\u4e86\u534a\u4e2a\u5c0f\u65f6\u5e38\u6570\u8fd8\u662f $\\text{TLE}$ ~~\u51fa\u9898\u4eba\u6bd2\u7624~~\uff09\u3002\n\n\u8fd8\u662f\u8003\u8651\u79bb\u7ebf\uff0c\u6211\u4eec\u5c06\u8be2\u95ee**\u6309\u7167\u53f3\u7aef\u70b9\u6392\u5e8f**\uff0c\u7ef4\u62a4\u4e00\u4e2a\u53f3\u6307\u9488\uff0c\u5c06\u6bcf\u4e2a $a_i$ \u9010\u4e2a\u52a0\u5165\u3002\u7528**\u6811\u72b6\u6570\u7ec4**\u7ef4\u62a4\u6bcf\u4e2a\u4f4d\u7f6e\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u8003\u8651 $a_i$ \u7684\u5176\u4e2d\u4e00\u4e2a\u8d28\u56e0\u5b50 $p$\uff08\u5176\u4ed6\u7684\u8d28\u56e0\u5b50\u540c\u7406\uff09\u3002\u7531\u4e8e\u6211\u4eec\u628a\u8be2\u95ee\u6309\u7167\u53f3\u7aef\u70b9\u6392\u5e8f\u4e86\uff0c\u800c\u6bcf\u4e2a\u8d28\u56e0\u5b50\u53ea\u80fd\u5bf9\u7b54\u6848\u6709**\u4e00\u6b21\u8d21\u732e**\uff0c\u90a3\u4e48\u6211\u4eec\u628a $p$ \u7684\u8d21\u732e\u653e\u5230\u533a\u95f4 $[1,i]$ \u7684**\u6700\u53f3\u8fb9**\uff0c\u5373\u8fdb\u884c\u64cd\u4f5c $add(i,p-1)$ \u548c $add(i,p^{-1})$\u3002\u5982\u679c $p$ \u5df2\u7ecf\u51fa\u73b0\u8fc7\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981**\u9632\u6b62\u533a\u95f4\u5de6\u7aef\u70b9\u5de6\u4fa7\u4ea7\u751f\u8d21\u732e**\uff0c\u7ef4\u62a4\u4e00\u4e2a $lst[i]$ \u8868\u793a $i$ \u8fd9\u4e2a\u8d28\u56e0\u5b50**\u4e0a\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e**\uff0c\u5c06 $lst[p]$ \u4f4d\u7f6e\u7684\u8d21\u732e\u6d88\u53bb\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u5982\u4f55\u5feb\u901f\u5206\u89e3\u6bcf\u4e2a\u6570\u7684\u8d28\u56e0\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u7ebf\u6027\u7b5b\u7684\u672c\u8d28\uff1a\u6bcf\u4e2a\u6570\u53ea\u4f1a\u88ab\u5176**\u6700\u5c0f\u8d28\u56e0\u5b50**\u7b5b\u53bb\uff0c\u5728\u7b5b\u7684\u8fc7\u7a0b\u4e2d\u76f4\u63a5\u8bb0\u5f55\u6bcf\u4e2a\u6570\u7684\u6700\u5c0f\u8d28\u56e0\u5b50\u5373\u53ef\uff01\n\n**\u65f6\u95f4\u590d\u6742\u5ea6**\uff1a$O((n+q)\\log n\\log a_i)$\n\n------\n\n## Code\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n\nconst int N=2e5+5,M=1e6+5;\nconst int mod=1e9+7;\nint n,m,tot,a[N],b[N],p[M/10],f[M],pre[N],lst[M],ans[N];\nbool flg[M];\n\nstruct Data {\n\tint l,r,id;\n\tbool operator < (const Data &rhs) const {\n\t\treturn r<rhs.r;\n\t}\n} q[N];\n\nvoid sieve(int n) {\n\tfor(int i=2;i<=n;++i) {\n\t\tif(!flg[i]) p[++tot]=i,f[i]=i;\n\t\tfor(int j=1;j<=tot&&i*p[j]<=n;++j) {\n\t\t\tflg[i*p[j]]=1,f[i*p[j]]=p[j];\n\t\t\tif(i%p[j]==0) break;\n\t\t}\n\t}\n}\nint pow(int x,int p) {\n\tint ret=1;\n\tfor(;p;p>>=1,x=1LL*x*x%mod) if(p&1) ret=1LL*ret*x%mod;\n\treturn ret;\n}\nint inv(int x) {\n\treturn pow(x,mod-2);\n}\nvoid add(int x,int val) {\n\tfor(;x<=n;x+=x&-x) b[x]=1LL*b[x]*val%mod;\n}\nint query(int x) {\n\tint ret=1;\n\tfor(;x;x^=x&-x) ret=1LL*ret*b[x]%mod;\n\treturn ret;\n}\nvoid update(int i) {\n\tfor(int x=a[i],p=f[x];x>1;p=f[x]) {\n\t\tadd(i,p-1),add(i,inv(p));\n\t\tif(lst[p]) add(lst[p],inv(p-1)),add(lst[p],p);\n\t\tlst[p]=i;\n\t\twhile(x%p==0) x/=p;\n\t}\n}\nint main() {\n\tsieve(M-5);\n\tscanf(\"%d\",&n);\n\tpre[0]=1;\n\tfor(int i=1;i<=n;++i) scanf(\"%d\",&a[i]),pre[i]=1LL*pre[i-1]*a[i]%mod;\n\tscanf(\"%d\",&m);\n\tfor(int i=1;i<=m;++i) scanf(\"%d%d\",&q[i].l,&q[i].r),q[i].id=i;\n\tstd::sort(q+1,q+m+1);\n\tfor(int i=0;i<=n;++i) b[i]=1;\n\tfor(int i=1,j=0;i<=m;++i) {\n\t\tint x=q[i].l,y=q[i].r;\n\t\twhile(j<y) update(++j);\n\t\tans[q[i].id]=1LL*pre[y]*inv(pre[x-1])%mod*query(y)%mod*inv(query(x-1))%mod;\n\t}\n\tfor(int i=1;i<=m;++i) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1549593657,
        "uid": 49725,
        "name": "Siyuan",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF594D \u3010REQ\u3011"
    },
    {
        "content": "\u8003\u5b8c\u671f\u672b\u590d\u6d3b\u4e00\u4e0b\uff0c \u611f\u8c22 Acc_Robin \u7ed9\u6211\u8bb2\u4e86\u8fd9\u9053\u9898\u3002\n\n## Description\n\n\u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$\uff0c $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u5305\u542b\u4e24\u4e2a\u53c2\u6570 $l,r$\uff0c\u6c42\n  $$\n  \\varphi\\left(\\prod_{i=l}^r a_i\\right)  \n  $$\n  \u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n  \n**\u9650\u5236**\uff1a$1\\le n\\le 2\\times 10^5$\uff0c$1\\le a_i\\le 10^6$\u3002\n\n## Solution\n\n\u9996\u5148\u9700\u8981\u77e5\u9053 $\\varphi(p^k)=(p-1)p^{k-1}$\uff0c\u8bbe\n  $$\n  a_i=\\prod_{j}p_j^{m_{i,j}}  \n  $$\n\n  \u5219\u6709 \n  $$\n  \\varphi\\left(\\prod_{i=l}^r a_i\\right)=\\varphi\\left(\\prod_{i=l}^r \\prod_{j}p_j^{m_{i,j}}\\right)=\\varphi\\left(\\prod_{j}p_j^{\\sum\\limits_{l\\le i\\le r}m_{i,j}}\\right)  \n  =\\prod_j(p_j-1)p_j^{\\sum\\limits_{l\\le i\\le r}m_{i,j}-1}\n  $$\n  \u4e8e\u662f\u8003\u8651\u5bf9 $a_i$ \u8fdb\u884c\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u5bf9\u6bcf\u4e2a $p_j$ \u8003\u8651\u5176\u8d21\u732e\uff1a \u82e5 $p_j$ \u7b2c\u4e00\u6b21\u51fa\u73b0\uff0c\u5219\u5176\u8d21\u732e\u4e3a $(p_j-1)p_j^{m_{i,j}-1}$\u3002\n  \n  \u53cd\u4e4b\uff0c\u9700\u8981\u627e\u5230 $p_j$ \u7684\u524d\u9a71\uff0c\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u4e58\u4e0a $\\dfrac{p_j}{p_j-1}$ \u4ee5\u6d88\u9664\u5176\u8d21\u732e\uff0c\u518d\u5728 $i$ \u7684\u4f4d\u7f6e\u4e58\u4e0a $(p_j-1)p_j^{m_{i,j}-1}$\u3002\n  \n\u53d1\u73b0\u662f\u4e00\u4e2a\u5355\u70b9\u4fee\u6539\u533a\u95f4\u6c42\u4e58\u79ef\u7684\u95ee\u9898\uff0c\u7ebf\u6bb5\u6811\u89e3\u51b3\u5373\u53ef\u3002\n\n  \u65f6\u95f4\u590d\u6742\u5ea6:$\\mathcal O(n\\log\\log a_i\\log n+q\\log n)$\u3002",
        "postTime": 1656592697,
        "uid": 413147,
        "name": "_Alejandro_",
        "ccfLevel": 0,
        "title": "CF594D Solution"
    },
    {
        "content": "\u8fd9\u9898\u5176\u5b9e\u62ff\u83ab\u961f\u662f\u80fd\u8fc7\u7684\u2026\u2026\u5c31\u662f\u8fd9\u76f8\u5f53\u4e8e\u662f\u8981\u8be2\u95ee\u533a\u95f4\u5185\u6bcf\u79cd\u8d28\u56e0\u5b50\u7684\u4e58\u79ef\u4e0e$p-1$\u7684\u4e58\u79ef\uff0c\u7136\u540e\u8fd9\u548c\u533a\u95f4\u6570\u989c\u8272\u5dee\u4e0d\u591a\u5c31\u76f4\u63a5\u62ff\u83ab\u961f\u505a\u5c31\u884c\u4e86\u2026\u2026\n\n\u5f53\u7136\u8981\u8fc7\u6389\u8fd9\u9898\u4f60\u8fd8\u9700\u8981\u4e00\u4e9b\u6280\u5de7\uff0c\u9996\u5148\u4f60\u8981\u7528$a^{-1}=-\\frac p a(p\\%a)^{-1}\\space O(n)$\u6c42\u9006\u5143\uff0c\u7136\u540e\u4f60\u8981\u628a\u6240\u6709\u7528\u5230log\u6c42\u9006\u5143\u7684\u5730\u65b9\u90fd\u6539\u6210\u7528\u8fd9\u4e2a\u6216\u8005\u9006\u5143\u7684\u4e58\u79ef\uff0c\u8fd9\u6837\u867d\u7136\u4e0d\u662f\u590d\u6742\u5ea6\u74f6\u9888\uff0c\u4f46\u662f\u6bd5\u7adf\u662f$O(\\log P)$\u7684\uff0c\u52a0\u4e86\u8fd9\u4e2a\u4e4b\u540e\u8dd1\u7684\u8fd8\u633a\u5feb\uff0c\u7136\u540e\u56e0\u4e3a\u6211\u4eec\u5728\u83ab\u961f\u7684\u65f6\u5019\u8981$O(\\log a_i)$\u679a\u4e3e\u8d28\u56e0\u5b50\uff0c\u8fd9\u4e2alog\u867d\u7136\u6bd4\u8f83\u865a\u4f46\u662f\u8fd8\u662f\u4f1a\u5bf9\u65f6\u95f4\u5e26\u6765\u4e0d\u5c0f\u7684\u5f71\u54cd\uff0c\u83ab\u961f\u7684\u65f6\u5019\u8981\u628a\u5757\u5927\u5c0f\u5f00\u7684\u5927\u4e00\u70b9\uff0c\u8fd9\u4e2a\u6211\u5728\u672c\u5730\u4e0a~~\u624b\u52a8\u4e09\u5206~~\u53d1\u73b01220\u5de6\u53f3\u6700\u5feb\u3002\u52a0\u4e86\u4e0a\u9762\u4e24\u4e2a\u4f18\u5316\u6700\u6162\u7684\u4e00\u4e2a\u70b9\u624d2s\u5de6\u53f3\u2026\u2026\n\n\u4e0a\u4ee3\u7801~\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <vector>\n#define ll long long\n#define p 1000000007\n#define blo 1220\nusing namespace std;\nnamespace ywy {\n\tinline int get() {\n\t    int n = 0;\n\t    char c;\n\t    while ((c = getchar()) || 23333) {\n\t        if (c >= '0' && c <= '9')\n\t            break;\n\t        if (c == '-')\n\t            goto s;\n\t    }\n\t    n = c - '0';\n\t    while ((c = getchar()) || 23333) {\n\t        if (c >= '0' && c <= '9')\n\t            n = n * 10 + c - '0';\n\t        else\n\t            return (n);\n\t    }\n\ts:\n\t    while ((c = getchar()) || 23333) {\n\t        if (c >= '0' && c <= '9')\n\t            n = n * 10 - c + '0';\n\t        else\n\t            return (n);\n\t    }\n\t}\n\tll inv[1000001];\n\tvoid print(int num) {\n\t    if (num >= 10)\n\t        print(num / 10);\n\t    putchar(num % 10 + '0');\n\t}\n\tll qzj[200001];\n\tint ints[200001], mindiv[1000001], prime[1000001];\n\tunsigned char bv[1000001];\n\tinline void prim(int n) {\n\t    int ptr = 0;\n\t    for (register int i = 2; i <= n; i++) {\n\t        if (!bv[i]) {\n\t            prime[ptr] = i;\n\t            ptr++;\n\t            mindiv[i] = i;\n\t        }\n\t        for (register int j = 0; j < ptr; j++) {\n\t            int cjr = prime[j] * i;\n\t            if (cjr > n)\n\t                break;\n\t            bv[cjr] = 1;\n\t            mindiv[cjr] = prime[j];\n\t            if (i % prime[j] == 0)\n\t                break;\n\t        }\n\t    }\n\t    inv[0] = inv[1] = 1;\n\t    for (register int i = 2; i <= n; i++) {\n\t        inv[i] = (inv[p % i] * (p - (p / i))) % p;\n\t    }\n\t}\n\tvector<int> vec[200001];\n\tinline ll mi(int a, int b) {\n\t    ll ans = 1, tmp = a;\n\t    while (b) {\n\t        if (b & 1)\n\t            ans = (ans * tmp) % p;\n\t        tmp = (tmp * tmp) % p;\n\t        b >>= 1;\n\t    }\n\t    return (ans);\n\t}\n\tint cnt[1000001];\n\ttypedef struct _n {\n\t    int l;\n\t    int r;\n\t    int id;\n\t    friend bool operator<(const _n &a, const _n &b) {\n\t        if (a.l / blo == b.l / blo)\n\t            return (a.r < b.r);\n\t        return (a.l / blo < b.l / blo);\n\t    }\n\t} node;\n\tnode memchi[200001];\n\tll ans1[200001], ans2[200001], ji[200001], jiny[200001];\n\tvoid ywymain() {\n\t    int n = get();\n\t    int mx = 0;\n\t    for (register int i = 1; i <= n; i++) mx = max(mx, ints[i] = get());\n\t    prim(mx);\n\t    qzj[0] = jiny[0] = 1;\n\t    for (register int i = 1; i <= n; i++) {\n\t        int tmp = ints[i];\n\t        while (tmp != 1) {\n\t            int d = mindiv[tmp];\n\t            vec[i].push_back(d);\n\t            while (mindiv[tmp] == d) tmp /= d;\n\t        }\n\t        qzj[i] = (qzj[i - 1] * ints[i]) % p;\n\t        jiny[i] = (jiny[i - 1] * inv[ints[i]]) % p;\n\t    }\n\t    int m = get();\n\t    for (register int i = 1; i <= m; i++) {\n\t        int l = get(), r = get();\n\t        ji[i] = (qzj[r] * jiny[l - 1]) % p;\n\t        memchi[i].l = l;\n\t        memchi[i].r = r;\n\t        memchi[i].id = i;\n\t    }\n\t    sort(memchi + 1, memchi + 1 + m);\n\t    ll jp = 1, jp1 = 1;\n\t    int l = memchi[1].l, r = memchi[1].r;\n\t    for (register int i = l; i <= r; i++) {\n\t        for (register int j = 0; j < vec[i].size(); j++) {\n\t            if (!cnt[vec[i][j]])\n\t                jp = (jp * inv[vec[i][j]]) % p, jp1 = (jp1 * (vec[i][j] - 1)) % p;\n\t            cnt[vec[i][j]]++;\n\t        }\n\t    }\n\t    ans1[memchi[1].id] = jp;\n\t    ans2[memchi[1].id] = jp1;\n\t    for (register int i = 2; i <= m; i++) {\n\t        while (l > memchi[i].l) {\n\t            l--;\n\t            for (register int j = 0; j < vec[l].size(); j++) {\n\t                if (!cnt[vec[l][j]])\n\t                    jp = (jp * inv[vec[l][j]]) % p, jp1 = (jp1 * (vec[l][j] - 1)) % p;\n\t                cnt[vec[l][j]]++;\n\t            }\n\t        }\n\t        while (r < memchi[i].r) {\n\t            r++;\n\t            for (register int j = 0; j < vec[r].size(); j++) {\n\t                if (!cnt[vec[r][j]])\n\t                    jp = (jp * inv[vec[r][j]]) % p, jp1 = (jp1 * (vec[r][j] - 1)) % p;\n\t                cnt[vec[r][j]]++;\n\t            }\n\t        }\n\t        while (l < memchi[i].l) {\n\t            for (register int j = 0; j < vec[l].size(); j++) {\n\t                cnt[vec[l][j]]--;\n\t                if (!cnt[vec[l][j]])\n\t                    jp = (jp * vec[l][j]) % p, jp1 = (jp1 * inv[vec[l][j] - 1]) % p;\n\t            }\n\t            l++;\n\t        }\n\t        while (r > memchi[i].r) {\n\t            for (register int j = 0; j < vec[r].size(); j++) {\n\t                cnt[vec[r][j]]--;\n\t                if (!cnt[vec[r][j]])\n\t                    jp = (jp * vec[r][j]) % p, jp1 = (jp1 * inv[vec[r][j] - 1]) % p;\n\t            }\n\t            r--;\n\t        }\n\t        ans1[memchi[i].id] = jp;\n\t        ans2[memchi[i].id] = jp1;\n\t    }\n\t    for (register int i = 1; i <= m; i++) {\n\t        ll cjr = ji[i];\n\t        cjr *= ans1[i];\n\t        cjr %= p;\n\t        cjr *= ans2[i];\n\t        cjr %= p;\n\t        print(cjr);\n\t        putchar('\\n');\n\t    }\n\t}\n}\nint main() {\n    ywy::ywymain();\n    return (0);\n}\n```",
        "postTime": 1551698316,
        "uid": 125124,
        "name": "ywy_c_asm",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF594D \u3010REQ\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/dd-d/p/16504705.html)  \n### Sol  \n\u633a\u5957\u8def\u7684\u4e00\u4e2a\u9898\u3002  \n\u9996\u5148 $\\phi(n) = n \\times \\prod (1-\\frac{1}{p_i})$\u3002  \n\u90a3\u4e48\u4e00\u6b21\u8be2\u95ee\u5c31\u53d8\u6210\u4e86\u533a\u95f4\u79ef\u4e58\u4e0a\u533a\u95f4\u8d28\u56e0\u6570\u5e76\u96c6\u7684\u8d21\u732e\u3002  \n\u524d\u8005\u76f4\u63a5\u524d\u7f00\u79ef\u7ef4\u62a4\u5373\u53ef\u3002\u8003\u8651\u540e\u8005\u600e\u4e48\u7ef4\u62a4\u3002  \n\u79bb\u7ebf\uff0c\u628a\u8be2\u95ee\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\u3002\u4f9d\u6b21\u52a0\u5165 $a_i$\u3002  \n\u8bb0 $p$ \u8868\u793a $a_i$ \u7684\u8d28\u56e0\u6570\u3002\u5c06 $p$ \u7684\u8d21\u732e\u653e\u5728 $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u4e0a\uff0c\u82e5\u4e4b\u524d\u51fa\u73b0\u8fc7 $p$ \u90a3\u4e48\u8bb0\u4e2a $last_p$ \u8868\u793a\u4e0a\u4e00\u6b21 $p$ \u51fa\u73b0\u7684\u4f4d\u7f6e\u5e76\u5220\u6389\u8d21\u732e\u3002\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n \\log a_i)$\u3002\n### Code\n```cpp\n//LYC_music yyds!\n#include<bits/stdc++.h>\n#define IOS ios::sync_with_stdio(0)\n#define lowbit(x) (x&(-x))\n#define int long long\nusing namespace std;\ninline char gc()\n{\n\tstatic char buf[1000000],*p1=buf,*p2=buf;\n\treturn p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++;\n}\nint read()\n{\n\tint pos=1,num=0;\n\tchar ch=getchar();\n\twhile (!isdigit(ch))\n\t{\n\t\tif (ch=='-') pos=-1;\n\t\tch=getchar();\n\t}\n\twhile (isdigit(ch))\n\t{\n\t\tnum=num*10+(int)(ch-'0');\n\t\tch=getchar();\n\t}\n\treturn pos*num;\n}\nvoid write(int x)\n{\n\tif (x<0)\n\t{\n\t\tputchar('-');\n\t\twrite(-x);\n\t\treturn;\n\t}\n\tif (x>=10) write(x/10);\n\tputchar(x%10+'0');\n}\nvoid writesp(int x)\n{\n\twrite(x);\n\tputchar(' ');\n}\nvoid writeln(int x)\n{\n\twrite(x);\n\tputchar('\\n');\n}\nconst int N=1e6+10,mod=1e9+7;\nstruct node\n{\n\tint l,r,id;\n}q[N];\nint n,s[N],a[N],c[N],last[N],p[N],ans[N],tot,vis[N],m;\ninline int quickpower(int a,int b)\n{\n\tint res=1;\n\twhile (b)\n\t{\n\t\tif (b&1) (res*=a)%=mod;\n\t\tb>>=1; (a*=a)%=mod;\n\t}\n\treturn res;\n}\nvoid init()\n{\n\tfor (int i=0;i<N;i++)\n\t\tc[i]=1;\n\tfor (int i=2;i<N;i++)\n\t{\n\t\tif (!vis[i]) p[++tot]=i;\n\t\tfor (int j=1;j<=tot&&i*p[j]<N;j++)\n\t\t{\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif (i%p[j]==0) break;\n\t\t}\n\t}\n}\ninline void add(int x,int y)\n{\n\tfor (;x<N;x+=lowbit(x))\n\t\tc[x]=c[x]*y%mod;\n}\ninline int query(int x)\n{\n\tint res=1;\n\tfor (;x;x-=lowbit(x))\n\t\tres=res*c[x]%mod;\n\treturn res;\n}\nvoid update(int x)\n{\n\tint now=a[x];\n\tfor (int i=1;p[i]*p[i]<=now;i++)\n\t\tif (now%p[i]==0)\n\t\t{\n\t\t\tassert(now%p[i]==0);\n\t\t\tadd(x,(p[i]-1)*quickpower(p[i],mod-2)%mod);\n\t\t\tif (last[p[i]]) add(last[p[i]],p[i]*quickpower(p[i]-1,mod-2)%mod);\n\t\t\tlast[p[i]]=x;\n\t\t\twhile (now%p[i]==0) now/=p[i];\n\t\t}\n\tif (now!=1)\n\t{\n\t\tadd(x,(now-1)*quickpower(now,mod-2)%mod);\n\t\tif (last[now]) add(last[now],now*quickpower(now-1,mod-2)%mod);\n\t\tlast[now]=x;\n\t}\n}\nsigned main()\n{\n\tn=read(); s[0]=1; init();\n\tfor (int i=1;i<=n;i++)\n\t\ta[i]=read(),s[i]=s[i-1]*a[i]%mod;\n\tm=read();\n\tfor (int i=1;i<=m;i++)\n\t\tq[i]={read(),read(),i};\n\tsort(q+1,q+m+1,[](node x,node y)\n\t{\n\t\treturn x.r<y.r;\n\t});\n\tint now=0;\n\tfor (int i=1;i<=m;i++)\n\t{\n\t\twhile (now<q[i].r) update(++now);\n\t\t// cout<<q[i].id<<' '<<s[q[i].r]*quickpower(s[q[i].l-1],mod-2)%mod<<' '<<query(q[i].r)*quickpower(query(q[i].l-1),mod-2)%mod<<'\\n';\n\t\tans[q[i].id]=s[q[i].r]*quickpower(s[q[i].l-1],mod-2)%mod*query(q[i].r)%mod*quickpower(query(q[i].l-1),mod-2)%mod;\n\t}\n\tfor (int i=1;i<=m;i++)\n\t\twriteln(ans[i]);\n}\n\n\n\n\n\n```",
        "postTime": 1658455271,
        "uid": 167999,
        "name": "dd_d",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011CF594D REQ"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u5728\u7ebf\u505a\u6cd5\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u7684\u672c\u8d28\u662f\u4e8c\u7ef4\u6570\u70b9\uff0c\u6240\u4ee5\u5bf9\u4e8e\u79bb\u7ebf\u505a\u6cd5\u4e5f\u5b58\u5728\u4e00\u4e2a\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u7684\u505a\u6cd5\u3002\n\n\u8003\u8651\u4f7f\u7528\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5185\u5c42\u7684\u533a\u95f4\u4e58\u79ef\u5c31\u662f\u8be5\u70b9\u7684\u7b54\u6848 $\\varphi$\u3002\n\n\u4ee4\u6307\u9488 $i$ \u4ece $1$ \u5411 $n$ \u626b\uff0c\u6bcf\u6b21\u5bf9\u4e8e\u4e00\u4e2a $a_i$\uff0c\u8003\u8651\u5b83\u4f1a\u54ea\u4e9b\u533a\u95f4\u7684 $\\varphi$ \u503c\u9020\u6210\u4ec0\u4e48\u6837\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u5c06 $a_i$ \u5206\u89e3\u8d28\u56e0\u6570\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u8d28\u56e0\u6570 $p$\uff0c\u4ee4 $las_p$ \u8868\u793a\u4e0a\u4e00\u6b21\u51fa\u73b0 $p$ \u7684\u4f4d\u7f6e\u3002\n\n- \u82e5 $las_p$ \u4e0d\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u5728\u5f53\u524d\u8fd9\u9897\u7ebf\u6bb5\u6811\u7684\u4f4d\u7f6e $i$ \u4e58\u4e0a $(p-1)p^{v_p(a_i)-1}$\u3002\n\n- \u82e5 $las_p$ \u5b58\u5728\uff0c\u90a3\u4e48\u8981\u6d88\u9664\u6389 $las_p$ \u5904\u7684\u8d21\u732e\uff0c\u5c31\u7ed9\u8fd9\u9897\u7ebf\u6bb5\u6811\u7684 $las_p$ \u5904\u4e58\u4e0a $\\frac{p}{p-1}$\uff0c\u7136\u540e\u518d\u7ed9 $i$ \u63a5\u7740\u4e58\u4e0a $(p-1)p^{v_p(a_i)-1}$\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee $[l,r]$\uff0c\u6211\u4eec\u53ea\u8981\u5728\u7b2c $r$ \u68f5\u7ebf\u6bb5\u6811\u4e0a\u8be2\u95ee $[l,r]$ \u8fd9\u4e2a\u533a\u95f4\u7684\u4e58\u79ef\u5373\u53ef\u3002\n\n\u9884\u5904\u7406\u590d\u6742\u5ea6 $O(n\\log a_i\\log n)$\uff0c\u8be2\u95ee\u590d\u6742\u5ea6 $O(\\log n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\log a_i\\log n)$\u3002\n\n\u76f8\u8f83\u4e8e\u79bb\u7ebf\u505a\u6cd5\uff0c\u662f\u7528\u7a7a\u95f4\u6362\u7684\u5728\u7ebf\u3002",
        "postTime": 1632664631,
        "uid": 383079,
        "name": "Acc_Robin",
        "ccfLevel": 6,
        "title": "CF594D REQ \u9898\u89e3"
    },
    {
        "content": "\u53d1\u4e00\u4e2a\u83ab\u961f\u7a33\u5b9a $O(n\\sqrt{n})$ \u7684\u9898\u89e3\n\n\u53ef\u80fd\u6211\u4eba\u50bb\u5e38\u6570\u5927\u6240\u4ee5\u8dd1\u5f97\u7279\u522b\u6162\u3002\u3002\u3002\n\n\u4e00\u9053\u76f8\u4f3c\u7684\u9898\u76ee\uff1a[[Ynoi2015]\u6b64\u65f6\u6b64\u523b\u7684\u5149\u8f89](https://www.luogu.org/problemnew/show/P5071)\n\n\u9996\u5148\u60f3\u5230\u8ba1\u7b97\u6bcf\u4e00\u4e2a\u8d28\u56e0\u5b50\u7684\u8d21\u732e\uff0c$\\varphi(p^k)=(p-1)\\times p^{k-1}$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u6bcf\u4e00\u4e2a\u6570 $a_i$\uff0c\u5927\u4e8e $\\sqrt{a_i}$ \u7684\u8d28\u56e0\u5b50\u53ea\u6709\u4e00\u4e2a\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u5c0f\u4e8e $\\sqrt{a_i}$ \u7684\u8d28\u56e0\u5b50\u5f04\u51fa\u6765\u3002\u56e0\u4e3a $a_i\\leq 10^6$\uff0c\u6211\u4eec\u53ea\u7528\u5f04\u5c0f\u4e8e $1000$ \u7684\u8d28\u6570\uff0c\u6570\u4e00\u6570\u4e00\u5171\u53ea\u6709 $168$ \u4e2a\u3002\u6211\u4eec\u7ef4\u62a4 $168$ \u4e2a\u5173\u4e8e\u8d28\u56e0\u5b50\u7684\u524d\u7f00\u79ef\uff0c\u7136\u540e\u5728\u83ab\u961f\u540e\u67e5\u8be2\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt{n}+n\\times \\frac {\\sqrt{a_i}}{\\log \\sqrt{a_i}})$\n\n\u8fd8\u6709\u4e00\u4e9b\u6280\u5de7\uff0c\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u5206\u5b50\u548c\u5206\u6bcd\uff0c\u7136\u540e\u6700\u540e\u518d\u5feb\u901f\u5e42\uff0c\u8fd9\u6837\u9006\u5143\u7684 $\\log$ \u5c31\u7701\u6389\u4e86\u3002\n\n\u5f53\u7136\uff0c\u83ab\u961f\u600e\u4e48\u6253\u5f97\u8fc7 $O(n\\log^2 n)$ \u89e3\u6cd5\u5462\u3002\u3002\u3002\n\n$Code\\ Below:$\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int maxn=200000+10;\nconst int mod=1e9+7;\nint n,m,lim,blo,a[maxn],b[maxn],cnt[maxn*5],sum[maxn][200],ans1[maxn],ans2[maxn],now1=1,now2=1,pri[1010],tot;bool vis[1010];\n\nstruct Query{\n    int l,r,id;\n}q[maxn];\n\ninline bool cmp(const Query &a,const Query &b){\n    if((a.l-1)/blo!=(b.l-1)/blo) return (a.l-1)/blo<(b.l-1)/blo;\n    return a.r<b.r;\n}\n\ninline int read(){\n    register int x=0,f=1;char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();}\n    while(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n    return (f==1)?x:-x;\n}\n\ninline int fpow(int a,int b){\n    int ret=1;\n    for(;b;b>>=1,a=1ll*a*a%mod)\n        if(b&1) ret=1ll*ret*a%mod;\n    return ret;\n}\n\ninline void sieve(int n){\n    for(int i=2;i<=n;i++){\n        if(!vis[i]) pri[++tot]=i;\n        for(int j=1;j<=tot&&i*pri[j]<=n;j++){\n            vis[i*pri[j]]=1;\n            if(i%pri[j]==0) break;\n        }\n    }\n}\n\ninline void solve(int x,int n){\n    int val;\n    for(int i=1;i<=tot&&pri[i]<=n;i++)\n        if(n%pri[i]==0){\n            val=1;\n            while(n%pri[i]==0) n/=pri[i],val*=pri[i];\n            sum[x][i]=val;\n        }\n    if(n>1) b[x]=n;\n}\n\ninline void add(int x){\n    if(!b[x]) return ;\n    if(++cnt[b[x]]==1) now1=1ll*now1*(b[x]-1)%mod;\n    else now1=1ll*now1*b[x]%mod;\n}\n\ninline void del(int x){\n    if(!b[x]) return ;\n    if(--cnt[b[x]]==0) now2=1ll*now2*(b[x]-1)%mod;\n    else now2=1ll*now2*b[x]%mod;\n}\n\nint main()\n{\n    n=read();blo=sqrt(n)+1;\n    for(int i=1;i<=n;i++) a[i]=read(),lim=max(lim,a[i]);\n    sieve((int)sqrt(lim));\n    for(int i=1;i<=n;i++) solve(i,a[i]);\n    for(int j=1;j<=tot;j++){\n        sum[0][j]=1;\n        for(int i=1;i<=n;i++){\n            if(!sum[i][j]) sum[i][j]=sum[i-1][j];\n            else sum[i][j]=1ll*sum[i][j]*sum[i-1][j]%mod;\n        }\n    }\n    m=read();\n    for(int i=1;i<=m;i++) q[i].l=read(),q[i].r=read(),q[i].id=i;\n    sort(q+1,q+m+1,cmp);\n    int L=1,R=0;\n    for(int i=1;i<=m;i++){\n        while(R<q[i].r) add(++R);\n        while(R>q[i].r) del(R--);\n        while(L<q[i].l) del(L++);\n        while(L>q[i].l) add(--L);\n        ans1[q[i].id]=now1;ans2[q[i].id]=now2;\n        for(int j=1;j<=tot;j++){\n            if(sum[q[i].r][j]==sum[q[i].l-1][j]) continue;\n            ans1[q[i].id]=1ll*ans1[q[i].id]*sum[q[i].r][j]%mod*(pri[j]-1)%mod;\n            ans2[q[i].id]=1ll*ans2[q[i].id]*sum[q[i].l-1][j]%mod*pri[j]%mod;\n        }\n    }\n    for(int i=1;i<=m;i++) printf(\"%d\\n\",1ll*ans1[i]*fpow(ans2[i],mod-2)%mod);\n    return 0;\n}\n```",
        "postTime": 1551965067,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF594D \u3010REQ\u3011"
    },
    {
        "content": "\u6211\u4e0d\u4f1a\u6570\u636e\u7ed3\u6784/kk\n\n\u6211\u60f3\u9898\u610f\u5e94\u8be5\u5341\u5206\u6e05\u695a\u4e86\u3002\n\n\u6211\u4eec\u77e5\u9053 $ \\varphi(p^k)=p^{k-1}(p-1) $\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5c06\u4e00\u4e2a\u8be2\u95ee\u4e0b\u653e\u5230\u53f3\u7aef\u70b9\uff0c\u7136\u540e\u5f80\u53f3\u79fb\u52a8\u53f3\u7aef\u70b9\u5e76\u66f4\u65b0\u6bcf\u4e2a\u5de6\u7aef\u70b9\u5230\u53f3\u7aef\u70b9\u7684\u7b54\u6848\u3002\n\n\u8fd9\u5c31\u53d8\u5f97\u5f88\u5bb9\u6613\u4e86\u3002\u6700\u5f00\u59cb\u6240\u6709\u4f4d\u7f6e\u7684\u7b54\u6848\u90fd\u662f $ 1 $\u3002\n\n\u52a0\u5165\u4e00\u4e2a\u6570 $ a $ \u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u79ef\u6027\u51fd\u6570\u53ef\u4ee5\u62c6\u6210\u8d28\u6570\u5e42\u5904\u7684\u79ef\u6027\u51fd\u6570\u4e4b\u79ef\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u4e5f\u8003\u8651\u62c6\u6210\u8d28\u6570\u5e42\u3002\n\n\u7136\u540e\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u8d28\u56e0\u5b50\u4e0a\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5047\u8bbe\u4e3a $ x $\uff0c\u73b0\u5728\u7684\u53f3\u7aef\u70b9\u4e3a $ i $\uff0c\u90a3\u4e48\u6211\u4eec\u4ee4 $ (x,i] $ \u4e58\u4e0a $ p-1 $\uff0c$ [1,x] $ \u4e58\u4e0a $ p $\uff0c\u5269\u4e0b\u7684\u4f4d\u7f6e\u4e58\u4e0a $ p^{k-1} $\u3002\n\n\u53ef\u4ee5\u77e5\u9053\u590d\u6742\u5ea6\u662f $ O(n\\log n\\frac {\\log V}{\\log\\log V}) $ \u7684\u3002~~\u8fd9\u4e2a\u590d\u6742\u5ea6\u4e0d\u77e5\u9053\u662f\u5728\u54ea\u513f\u770b\u5230\u7684\uff0c\u53cd\u6b63 1e6 \u4ee5\u5185\u7edd\u5bf9\u4e0d\u4f1a\u8d85\u8fc7 7\u3002~~\n\n\u8fd9\u4e2a\u62ff\u7ebf\u6bb5\u6811\u505a\u5c31\u597d\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u662f\u5355\u70b9\u67e5\u8be2\uff0c\u6240\u4ee5\u5bf9\u6807\u8bb0\u53ef\u6301\u4e45\u5316\u3002\u7136\u540e\u4f7f\u7528 zkw \u7ebf\u6bb5\u6811\u52a0\u4e0a\u5feb\u8bfb\u4f60\u5c31\u53ef\u4ee5\u62ff\u5230 lg \u6700\u4f18\u89e3\u3002\n\n\u751a\u81f3\u80fd\u5728 CF \u4e0a\u9762\u5361\u8fdb\u7b2c\u4e00\u9875\u3002\u3002\u3002\n\n\u5b9e\u9645\u4e0a\u8fd8\u6709\u66f4\u4e3a\u5389\u5bb3\u7684\u65b9\u6cd5\u3002\u3002\u3002\n\n\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u521d\u59cb\u503c\u90fd\u662f $ a_i $\uff0c\u6bcf\u6b21\u5f80\u53f3\u626b\u65f6\u5c06 $ p $ \u53d8\u4e3a $ p-1 $\uff0c\u7ebf\u6bb5\u6811\u7684\u64cd\u4f5c\u6b21\u6570\u662f\u6211\u7684\u4e09\u5206\u4e4b\u4e00\u3002\u3002\u3002\n\n\u800c\u4e14\u8fd9\u4e2a\u73a9\u610f\u513f\u662f\u53ef\u4ee5\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7684\u3002\u3002\u3002\n\n\u4e0d\u7ba1\u600e\u6837\u5148\u628a\u6211\u7684\u4ee3\u7801\u6302\u5728\u8fd9\u91cc\u4e86\uff1a\n```cpp\n#include<iostream>\n#include<cctype>\n#include<vector>\ntypedef unsigned ui;\nconst ui M=2e5+5,mod=1e9+7;\nui n,m,G,a[M],l[M],r[M],ans[M],prod[M<<2];ui top,pri[M*5],pos[M*5],lst[M*5];std::vector<ui>id[M];\nchar _input[1<<25|1],_output[1<<25|1],*_p1=_input,*_p2=_output;\ninline ui read(){\n\tui n(0);char s;while(!isdigit(s=*_p1++));while(n=n*10+(s&15),isdigit(s=*_p1++));return n;\n}\ninline void write(ui&n){\n\tstatic char s[10];ui top(0);while(s[++top]=n%10^48,n/=10);while(*_p2++=s[top],--top);\n}\ninline void sieve(const ui&M){\n\tui i,j,x;\n\tfor(i=2;i<=M;++i){\n\t\tif(!pos[i])pri[pos[i]=++top]=i;\n\t\tfor(j=1;j<=pos[i]&&(x=i*pri[j])<=M;++j)pos[x]=j;\n\t}\n}\nvoid Modify(ui l,ui r,const ui&V){\n\tfor(l+=G-1,r+=G+1;l^r^1;l>>=1,r>>=1){\n\t\tif(~l&1)prod[l^1]=1ull*prod[l^1]*V%mod;\n\t\tif(r&1)prod[r^1]=1ull*prod[r^1]*V%mod;\n\t}\n}\ninline ui Query(ui x){\n\tui ans(1);x+=G;while(x)ans=1ull*ans*prod[x]%mod,x>>=1;return ans;\n}\nsigned main(){\n\tstd::cin.read(_input,sizeof _input);\n\tui i,x(0),y,t;n=read();for(G=1;G<=n+1;G<<=1);for(i=1;i<=n+G;++i)prod[i]=1;\n\tfor(i=1;i<=n;++i)(a[i]=read())>x&&(x=a[i]);Build(1);sieve(x);m=read();\n\tfor(i=1;i<=m;++i)l[i]=read(),r[i]=read(),id[r[i]].push_back(i);\n\tfor(i=1;i<=n;++i){\n\t\tfor(x=a[i];x^1;){\n\t\t\tif(pos[x]^1)Modify(lst[pos[x]]+1,i,pri[pos[x]]-1);if(lst[pos[x]])Modify(1,lst[pos[x]],pri[pos[x]]);\n\t\t\tlst[y=pos[x]]=i;t=1;while(pos[x/pri[y]]==pos[x])t*=pri[y],x/=pri[y];x/=pri[y];if(t^1)Modify(1,i,t);\n\t\t}\n\t\tfor(ui&ID:id[i])ans[ID]=Query(l[ID]);\n\t}\n\tfor(i=1;i<=m;++i)write(ans[i]),*_p2++=10;std::cout.write(_output,_p2-_output);\n}\n```",
        "postTime": 1640771990,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u636e\u7ed3\u6784 \u7ebf\u6bb5\u6811 CF594D\u9898\u89e3"
    },
    {
        "content": "\u8bbe \n$$x = \\prod_{i=1}^{cnt} p_i^{k_i} [p_i\\in prime]$$\n\n\u90a3\u4e48\u663e\u7136\n$$\\varphi(x) = x*\\frac{1}\n{\\prod_{i=1}^{cnt}p_i}$$\n\n\n\u56e0\u4e3a\u6bcf\u4e2a\u8d28\u6570\u53ea\u4f1a\u51fa\u73b0\u4e00\u6b21\uff0c\u6240\u4ee5\u5f53\u6210\u6570\u989c\u8272\uff0c\u540c [HH\u7684\u9879\u94fe]\uff0c\u8fd9\u9898\u5c31\u6ca1\u4e86\n\n\n```cpp\n// powered by c++11\n// by Isaunoya\n#include <bits/stdc++.h>\n#define rep(i, x, y) for (register int i = (x); i <= (y); ++i)\n#define Rep(i, x, y) for (register int i = (x); i >= (y); --i)\nusing namespace std;\nusing db = double;\nusing ll = long long;\nusing uint = unsigned int;\n#define int long long\nusing pii = pair<int, int>;\n#define ve vector\n#define Tp template\n#define all(v) v.begin(), v.end()\n#define sz(v) ((int)v.size())\n#define pb emplace_back\n#define fir first\n#define sec second\n// the cmin && cmax\nTp<class T> void cmax(T& x, const T& y) {\n  if (x < y) x = y;\n}\nTp<class T> void cmin(T& x, const T& y) {\n  if (x > y) x = y;\n}\n// sort , unique , reverse\nTp<class T> void sort(ve<T>& v) { sort(all(v)); }\nTp<class T> void unique(ve<T>& v) {\n  sort(all(v));\n  v.erase(unique(all(v)), v.end());\n}\nTp<class T> void reverse(ve<T>& v) { reverse(all(v)); }\nconst int SZ = 0x191981;\nstruct FILEIN {\n  ~FILEIN() {}\n  char qwq[SZ], *S = qwq, *T = qwq, ch;\n  char GETC() { return (S == T) && (T = (S = qwq) + fread(qwq, 1, SZ, stdin), S == T) ? EOF : *S++; }\n  FILEIN& operator>>(char& c) {\n    while (isspace(c = GETC()))\n      ;\n    return *this;\n  }\n  FILEIN& operator>>(string& s) {\n    while (isspace(ch = GETC()))\n      ;\n    s = ch;\n    while (!isspace(ch = GETC())) s += ch;\n    return *this;\n  }\n  Tp<class T> void read(T& x) {\n    bool sign = 1;\n    while ((ch = GETC()) < 0x30)\n      if (ch == 0x2d) sign = 0;\n    x = (ch ^ 0x30);\n    while ((ch = GETC()) > 0x2f) x = x * 0xa + (ch ^ 0x30);\n    x = sign ? x : -x;\n  }\n  FILEIN& operator>>(int& x) { return read(x), *this; }\n  FILEIN& operator>>(signed& x) { return read(x), *this; }\n  FILEIN& operator>>(unsigned& x) { return read(x), *this; }\n} in;\nstruct FILEOUT {\n  const static int LIMIT = 0x114514;\n  char quq[SZ], ST[0x114];\n  signed sz, O;\n  ~FILEOUT() { flush(); }\n  void flush() {\n    fwrite(quq, 1, O, stdout);\n    fflush(stdout);\n    O = 0;\n  }\n  FILEOUT& operator<<(char c) { return quq[O++] = c, *this; }\n  FILEOUT& operator<<(string str) {\n    if (O > LIMIT) flush();\n    for (char c : str) quq[O++] = c;\n    return *this;\n  }\n  Tp<class T> void write(T x) {\n    if (O > LIMIT) flush();\n    if (x < 0) {\n      quq[O++] = 0x2d;\n      x = -x;\n    }\n    do {\n      ST[++sz] = x % 0xa ^ 0x30;\n      x /= 0xa;\n    } while (x);\n    while (sz) quq[O++] = ST[sz--];\n    return;\n  }\n  FILEOUT& operator<<(int x) { return write(x), *this; }\n  FILEOUT& operator<<(signed x) { return write(x), *this; }\n  FILEOUT& operator<<(unsigned x) { return write(x), *this; }\n} out;\n\nint n, q;\nconst int maxn = 2e5 + 52;\nconst int maxp = 1e6 + 61;\nconst int mod = 1e9 + 7;\nint a[maxn], las[maxp];\ninline int qpow(int x, int y) {\n  int res = 1;\n  for (; y; y >>= 1, x = x * x % mod)\n    if (y & 1) res = res * x % mod;\n  return res;\n}\ninline int inv(int x) { return qpow(x, mod - 2); }\nstruct BIT {\n  int c[maxn];\n  inline int low(int x) { return x & -x; }\n  inline void upd(int x, int y) {\n    for (; x <= n; x += low(x)) c[x] = c[x] * y % mod;\n  }\n  inline int qry(int x) {\n    int ans = 1;\n    for (; x; x ^= low(x)) ans = ans * c[x] % mod;\n    return ans;\n  }\n} bit;\nvector<int> prime[maxp];\nvector<pii> v[maxn];\nvoid add(int pos) {\n  for (auto x : prime[a[pos]]) {\n    if (las[x]) bit.upd(las[x], x), bit.upd(las[x], inv(x - 1));\n    bit.upd(pos, inv(x)), bit.upd(pos, x - 1);\n    las[x] = pos;\n  }\n}\nint pre[maxn];\nint ans[maxn];\nsigned main() {\n#ifdef _WIN64\n  freopen(\"testdata.in\", \"r\", stdin);\n#else\n  ios_base ::sync_with_stdio(false);\n  cin.tie(nullptr), cout.tie(nullptr);\n#endif\n  // code begin.\n  in >> n;\n  int mx = 0;\n  rep(i, 1, n) in >> a[i], cmax(mx, a[i]);\n  pre[0] = 1;\n  rep(i, 1, n) pre[i] = pre[i - 1] * a[i] % mod;\n  vector<bool> vis(mx + 1, 0);\n  rep(i, 2, mx) if (!vis[i]) {\n    prime[i].push_back(i);\n    for (int j = (i << 1); j <= mx; j += i) prime[j].push_back(i), vis[j] = 1;\n  }\n  in >> q;\n  rep(i, 1, q) {\n    int l, r;\n    in >> l >> r;\n    v[r].push_back({ l, i });\n  }\n  rep(i, 0, n) bit.c[i] = 1;\n  rep(i, 1, n) {\n    add(i);\n    for (auto x : v[i])\n      ans[x.second] =\n          pre[i] * inv(pre[x.first - 1]) % mod * bit.qry(i) % mod * inv(bit.qry(x.first - 1)) % mod;\n  }\n  rep(i, 1, q) out << ans[i] << '\\n';\n  return 0;\n  // code end.\n}\n```",
        "postTime": 1581679599,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF594D \u3010REQ\u3011"
    },
    {
        "content": "\u9996\u5148\u8003\u8651\u6b27\u62c9\u51fd\u6570\u7684\u8ba1\u7b97\u5f0f $\\varphi(n) = n\\prod_{p | n} \\dfrac{p - 1}{p}$\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5bf9\u6bcf\u4e00\u4e2a $a_i$ \u8fdb\u884c\u56e0\u5f0f\u5206\u89e3\uff0c\u7136\u540e\u8ba1\u7b97\u6bcf\u4e2a\u8d28\u56e0\u5b50\u7684\u8d21\u732e\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u91cd\u590d\u8d28\u56e0\u5b50\u7684\u8d21\u732e\u5c31\u505a\u5b8c\u4e86\uff0c\u8fd9\u73a9\u610f\u5728\u7ebf\u4e0d\u592a\u597d\u505a\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u79bb\u7ebf\u3002\u5c06\u8be2\u95ee\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\uff0c\u7136\u540e\u8003\u8651\u4e00\u4e2a\u4e00\u4e2a\u52a0\u5165\uff0c\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u8981\u5728\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u52a0\u5165\u4e00\u4e2a\u8d28\u56e0\u5b50 $p$\uff0c\u6211\u4eec\u7528 $last_p$ \u8868\u793a $p$ \u4e0a\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u6211\u4eec\u5728 $last_p$ \u4e0a\u4e58\u4e00\u4e2a $\\dfrac{p}{p - 1}$\uff0c\u518d\u5728 $i$ \u4e0a\u4e58\u4e00\u4e2a $\\dfrac{p - 1}{p}$ \u5373\u53ef\uff0c\u6ce8\u610f\u66f4\u65b0 $last_p$ \u7684\u503c\u3002\n\n\u5f00\u4e2a\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u533a\u95f4\u4e58\u79ef\u5c31\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n\\log V)$\u3002[Code](https://codeforces.com/contest/594/submission/207056887)",
        "postTime": 1684940516,
        "uid": 587248,
        "name": "wcywcywcywcy",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF594D"
    },
    {
        "content": "## Solution\n\u633a\u597d\u4e00\u9053\u6570\u8bba\u9898\u3002\n\n\u8003\u8651\u5230\u6b27\u62c9\u51fd\u6570\u7684\u4e00\u4e2a\u8ba1\u7b97\u65b9\u6cd5\uff1a\n\n$$\n\\varphi(n)=n\\prod_{i=1}^s\\frac {p_i-1}{p_i}\n$$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7b54\u6848\u5199\u6210\uff1a\n\n$$\n\\varphi(\\prod_{i=l}^ra_i)=\\prod_{i=l}^ra_i\\times \\prod_i(\\frac{p_i-1}{p_i})\n$$\n\n\u5176\u4e2d $p_i$ \u4ee3\u8868 $[l,r]$ \u4e2d\u6240\u6709\u6570\u8d28\u56e0\u5b50\u7684\u5e76\u96c6\u3002\u7b80\u5355\u70b9\u6765\u8bf4\uff0c\u5c31\u662f\u533a\u95f4\u4e58\u79ef\u4e58\u4e0a\u6240\u6709 $\\Large\\frac {p_i-1}{p_i}$\u3002\n\n\u6ce8\u610f\u5230 $p_i$ \u662f\u4e0d\u80fd\u91cd\u590d\u8d21\u732e\u7684\uff0c\u8fd9\u5c31\u597d\u6bd4\u79cd\u7c7b\uff0c\u4e8e\u662f\u6211\u4eec\u60f3\u5230\u4e86 [P1972](https://www.luogu.com.cn/problem/P1972)\uff0c\u8fd9\u9898\u5c31\u662f\u6c42\u533a\u95f4\u79cd\u7c7b\u6570\u3002\u6240\u4ee5\u6309\u7167\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u628a\u8be2\u95ee\u79bb\u7ebf\u5e76\u6309\u7167\u53f3\u7aef\u70b9\u6392\u5e8f\uff0c\u4f9d\u6b21\u52a0\u5165 $a_i$\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u5177\u4f53\u5730\uff0c\u5bf9\u4e8e $a_i$ \u7684\u4e00\u4e2a\u8d28\u56e0\u5b50 $p_i$\uff0c\u5148\u5728 $i$ \u4f4d\u7f6e\u4e0a\u4e58 $\\Large\\frac {p_i-1}{p_i}$\uff0c\u518d\u8bb0\u5f55 $p_i$ \u51fa\u73b0\u7684\u524d\u4e00\u4e2a\u4f4d\u7f6e\uff08\u82e5\u6ca1\u6709\u5219\u4e0d\u9700\u64cd\u4f5c\uff09\uff0c\u5c06\u5176\u9664\u4ee5 $\\Large\\frac {p_i-1}{p_i}$\uff0c\u4fdd\u8bc1\u4e0d\u91cd\u590d\u3002\n\n\u5176\u5b9e\u4f1a P1972 \u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u505a\u6cd5\u5341\u5206\u76f8\u4f3c\u3002\n\n\u6700\u540e\u5173\u4e8e\u5e38\u6570\u7684\u95ee\u9898\uff0c\u4e0d\u80fd\u76f4\u63a5 $O(\\sqrt{n})$ \u6c42\u8d28\u56e0\u6570\uff0c\u53ef\u4ee5\u5148\u505a\u4e00\u904d\u7ebf\u7b5b\uff0c\u628a\u6bcf\u4e2a\u6570\u7684\u6700\u5c0f\u8d28\u56e0\u5b50\u8bb0\u4e3a $f_i$\uff0c\u7136\u540e\u4e00\u76f4 $p=f_{p}$ \u5373\u53ef\u3002\u8fd8\u53ef\u4ee5\u628a\u5feb\u901f\u5e42\u6362\u6210\u7ebf\u6027\u6c42\u9006\u5143\u3002",
        "postTime": 1673169153,
        "uid": 415256,
        "name": "Epoch_L",
        "ccfLevel": 5,
        "title": "CF594D"
    },
    {
        "content": "\u6839\u636e $\\varphi$ \u7684\u89c4\u5f8b\uff0c\u8bbe $n=\\prod\\limits_{i}{p_i^{a_i}}$\uff0c\u5219\u6709 $\\varphi(n)=n\\times\\prod\\limits_{i}{\\frac{p_i-1}{p_i}}$\u3002\n\n\u6545\u533a\u95f4 $\\varphi$ \u53ef\u5148\u524d\u7f00\u79ef\u7b97\u524d\u9762\u90a3\u4e2a\uff0c\u540e\u9762\u90a3\u4e48\u76f4\u63a5\u770b\u533a\u95f4\u51fa\u73b0\u54ea\u4e9b\u8d28\u6570\u5373\u53ef\u3002\n\n\u8003\u8651\u79bb\u7ebf\uff0c\u6211\u4eec\u5c06\u8be2\u95ee\u6309\u7167\u53f3\u7aef\u70b9\u6392\u5e8f\uff0c\u7ef4\u62a4\u4e00\u4e2a\u53f3\u6307\u9488\uff0c\u5c06 $a_i$ \u9010\u4e2a\u52a0\u5165\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u6bcf\u4e2a\u4f4d\u7f6e\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u9884\u5904\u7406\u6240\u6709\u8d28\u6570\uff0c$\\log V$ \u679a\u4e3e\u627e\u8d28\u56e0\u5b50\uff0c\u5bf9\u4e8e\u91cd\u590d\u51fa\u73b0\u7684\u8d28\u56e0\u5b50\uff0c\u7ef4\u62a4 $lst_i$ \u8868\u793a\u8d28\u56e0\u5b50 $i$ \u4e0a\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5c06\u4e0a\u6b21\u7684\u8d21\u732e\u6d88\u53bb\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O((n+q)\\log n\\log V)$\uff08\u5176\u4e2d $V$ \u8868\u793a\u503c\u57df $[1,n]$\uff09\u3002",
        "postTime": 1669856325,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "CF594D REQ"
    },
    {
        "content": "\u5bb9\u6613\u53d1\u73b0\uff0c$\\phi(\\prod_{i=l \\to r}a_i)$\n\n$=\\prod_{i=l \\to r}a_i*\\prod_{i=1 \\to 10^6}f(i)*[i|\\prod_{j=l \\to r}a_j]$\n\n\u5176\u4e2d$f(i)=\\frac{i-1}{i}$.\n\n\u524d\u534a\u90e8\u5206\u53ef\u4ee5\u9884\u5904\u7406\u524d\u7f00\u548c\u540e\u67e5\u8be2\u3002\n\n\u5982\u679c\u5c06\u6bcf\u4e2a\u6570\u5206\u89e3\u8d28\u56e0\u6570\uff0c\u5f00$n$\u4e2a$vector$\uff0c\u5c06$a_i$\u6240\u6709\u8d28\u56e0\u6570\u63d2\u5165$i$\u53f7$vector$\uff0c\u540e\u534a\u90e8\u5206\u5373\u8be2\u95ee\u4e00\u4e2a\u533a\u95f4\u5185\u4e0d\u540c\u6570\u7684\u4e58\u79ef\u3002\u53d1\u73b0\u9898\u76ee\u5141\u8bb8\u79bb\u7ebf\u3002\u6240\u4ee5\u5c06\u6240\u6709\u8be2\u95ee\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\uff0c\u7528\u4e00\u4e2a\u6307\u9488\u4ece\u5934\u626b\u5230\u5c3e\uff0c\u626b\u5230$i$\u65f6\u56de\u7b54\u53f3\u7aef\u70b9\u4e3a$i$\u7684\u6240\u6709\u8be2\u95ee\u3002\u5c06\u8d28\u56e0\u6570\u63d2\u5165\u6811\u72b6\u6570\u7ec4\u4e0a\u5b83\u6700\u540e\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u8be2\u95ee\u5373\u4e3a\u67e5\u8be2$l$\u5230$r$\u6240\u6709\u6570\u7684\u4e58\u79ef\u3002\u4f8b\u5982\uff1a\n\n$5,35,216,4$\n\n$5,7$\u5e94\u63d2\u5728$2$\u53f7\u4f4d\uff0c$3$\u5e94\u63d2\u5728$3$\u53f7\u4f4d\uff0c$2$\u5e94\u63d2\u5728$4$\u53f7\u4f4d\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n*\\sqrt{\\max_{i=1 \\to n}a_i}+n*10*log \\max_{i=1 \\to n}a_i)$.\n\n\u4ee3\u7801\uff1a\n\n```\n\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<math.h>\n#include<vector>\nusing namespace std;\n\nconst int N=2e5+5;\nconst int M=1e6+5;\nconst int mod=1e9+7;\nint n,q,a[N],s[N],lat[M];\nvector<int> v[N];\nstruct node\n{\n\tint l,r,id,ans;\n};\nnode que[N];\n\nint F_p(int x,int y)\n{\n\tint bas=x,ret=1;\n\twhile(y)\n\t{\n\t\tif(y&1) ret=1LL*ret*bas%mod;\n\t\tbas=1LL*bas*bas%mod;\n\t\ty>>=1;\n\t}\n\treturn ret;\n}\n\nstruct Tree_Array\n{\n\tint c[M];\n\tint lowbit(int x)\n\t{\n\t\treturn x&(-x);\n\t}\n\t\n\tvoid build()\n\t{\n\t\tint i;\n\t\tfor(i=1;i<=n;++i) c[i]=1;\n\t}\n\t\n\tvoid update(int pos,int x)\n\t{\n\t\twhile(pos<=M)\n\t\t{\n\t\t\tc[pos]=1LL*c[pos]*x%mod;\n\t\t\tpos+=lowbit(pos);\n\t\t}\n\t}\n\t\n\tint query(int pos)\n\t{\n\t\tint ret=1;\n\t\twhile(pos)\n\t\t{\n\t\t\tret=1LL*ret*c[pos]%mod;\n\t\t\tpos-=lowbit(pos);\n\t\t}\n\t\treturn ret;\n\t}\n\tint query(int l,int r)\n\t{\n\t\treturn 1LL*query(r)*F_p(query(l-1),mod-2)%mod;\n\t}\n};\nTree_Array SS;\n\nbool cmp(node x,node y)\n{\n\treturn x.r<y.r;\n}\nbool id_cmp(node x,node y)\n{\n\treturn x.id<y.id;\n}\n\nvoid init()\n{\n\tint i;\n\tscanf(\"%d\",&n);\n\tfor(i=1;i<=n;++i) scanf(\"%d\",&a[i]);\n\ts[0]=1;for(i=1;i<=n;++i) s[i]=1LL*s[i-1]*a[i]%mod;\n\tSS.build();\n}\n\nvoid prework()\n{\n\tint i,j;\n\tfor(i=1;i<=n;++i)\n\t{\n\t\tfor(j=2;j*j<=a[i];++j)\n\t\t\tif(a[i]%j==0)\n\t\t\t{\n\t\t\t\twhile(a[i]%j==0) a[i]/=j;\n\t\t\t\tv[i].push_back(j);\n\t\t\t}\n\t\tif(a[i]>1) v[i].push_back(a[i]);\n\t}\n}\n\nint cal(int x)\n{\n\treturn 1LL*(x-1)*F_p(x,mod-2)%mod;\n}\nvoid calc(int x)\n{\n\tint i,sz=v[x].size();\n\tfor(i=0;i<sz;++i)\n\t{\n\t\tif(lat[v[x][i]])\n\t\t\tSS.update(lat[v[x][i]],F_p(cal(v[x][i]),mod-2));\n\t\tSS.update(x,cal(v[x][i]));\n\t\tlat[v[x][i]]=x;\n\t}\n}\n\nvoid work()\n{\n\tint i,j;\n\tscanf(\"%d\",&q);\n\tfor(i=1;i<=q;++i)\n\t{\n\t\tscanf(\"%d%d\",&que[i].l,&que[i].r);\n\t\tque[i].id=i;\n\t}\n\t\n\tsort(que+1,que+q+1,cmp);\n\tint las=0;\n\tfor(i=1;i<=q;++i)\n\t{\n\t\tfor(j=las+1;j<=que[i].r;++j) calc(j);\n\t\tlas=que[i].r;\n\t\tque[i].ans=SS.query(que[i].l,que[i].r);\n\t}\n\tsort(que+1,que+q+1,id_cmp);\n\t\n\tfor(i=1;i<=q;++i)\n\t\tprintf(\"%d\\n\",1LL*que[i].ans*s[que[i].r]%mod*F_p(s[que[i].l-1],mod-2)%mod);\n}\n\nint main()\n{\n\tinit();prework();work();\n\treturn 0;\n}\n\n```",
        "postTime": 1549116897,
        "uid": 31435,
        "name": "hwk0518",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF594D \u3010REQ\u3011"
    }
]