[
    {
        "content": "\u663e\u7136\u6bcf\u4e2a\u4e8c\u64cd\u4f5c\u662f\u628a $[l,mid]$ \u6570\u6539\u4e3a $l-1$\uff0c\u628a $(mid,r]$ \u7684\u6570\u6539\u4e3a $r+1$\u3002\u5176\u4e2d $mid=\\lfloor\\frac{(l+r)}{2}\\rfloor$\u3002\n\n\u5148\u8003\u8651\u6ca1\u6709\u4e00\u64cd\u4f5c\u600e\u4e48\u505a\u3002\n\n\u6240\u6709\u4fee\u6539\u90fd\u662f\u5bf9\u6574\u4e2a\u5e8f\u5217\u7684\u4fee\u6539\uff0c\u6240\u4ee5\u628a\u6574\u4e2a\u5e8f\u5217\u7cca\u5230\u4e00\u5757\u4e5f\u6ca1\u95ee\u9898\u5450\u3002\u518d\u6ce8\u610f\u5230\u64cd\u4f5c\u662f\u503c\u57df\u4e0a\u7684\uff0c\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u627e\u4e2a\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\n\n\u6211\u4e00\u5f00\u59cb\u60f3\u76f4\u63a5\u83bd\u5e73\u8861\u6811\u4e86\uff0c\u4f46\u662f CF \u4e0a\u6709\u4e2a\u6807\u7b7e\u53eb `dsu`\u3002\n\n\u7136\u540e\u6b63\u89e3\u7684\u505a\u6cd5\u662f\u628a\u6743\u503c\u76f8\u540c\u7684\u6570\u653e\u5230\u4e00\u4e2a\u5e76\u67e5\u96c6\u91cc\uff0c\u518d\u628a\u6bcf\u4e2a\u5e76\u67e5\u96c6\u6309\u6743\u503c\u585e\u8fdb\u4e00\u4e2a `set` \u91cc\uff0c\u4fee\u6539\u7684\u65f6\u5019\u4e8c\u5206\u627e\u5230\u9700\u8981\u4fee\u6539\u7684\u4e1c\u897f\uff0c\u7136\u540e\u66b4\u529b\u6539\u5373\u53ef\u3002\n\n\u7531\u4e8e\u6bcf\u6b21\u4fee\u6539\u90fd\u4f1a\u6709\u4e0e\u4fee\u6539\u6b21\u6570\u540c\u9636\u7684\u5220\u9664\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u662f\u4f18\u79c0\u7684 $n\\log n$\u3002\n\n\u518d\u8003\u8651\u6709\u4e00\u64cd\u4f5c\u7684\u8bdd\uff0c\u5e76\u67e5\u96c6\u7684\u7ed3\u6784\u5c31\u4f1a\u6539\u53d8\uff0c\u90a3\u4e48\u5982\u4f55\u907f\u514d\uff1f\u4e0d\u80fd\u5220\u9664\u5c31\u65b0\u5efa\u597d\u4e86\u3002\u5355\u70b9\u4fee\u6539\u76f4\u63a5\u5f00\u4e2a\u65b0\u70b9\u9644\u4e0a\u76f8\u5e94\u6743\u503c\uff0c\u518d\u628a\u70b9\u7684\u7f16\u53f7\u6620\u5c04\u8fc7\u53bb\u5373\u53ef\u3002\u590d\u6742\u5ea6\u4ecd\u662f $n \\log n$ \u7ea7\u522b\u7684\u3002\u8bb0\u5f97\u6570\u7ec4\u7a0d\u5fae\u5f00\u5927\u4e00\u70b9\u3002\n\n\u7801\u55b5\uff1a\n\n```cpp\nconst int maxn=1e6+3,INF=0x3f3f3f3f;\nstruct dsu{\n\tint fa[maxn],rk[maxn];\n\tinline void init(int n){for(reg i=1;i<=n;++i)fa[i]=i;}\n\tinline int find(int x){return fa[x]^x?fa[x]=find(fa[x]):x;}\n\tinline void merge(int x,int y){\n\t\tx=find(x),y=find(y);\n\t\tif(rk[x]<rk[y])fa[x]=y,rk[y]=max(rk[y],rk[x]+1);\n\t\telse fa[y]=x,rk[x]=max(rk[x],rk[y]+1);\n\t}\n}V;\nint n,m,a[maxn],b[maxn];\nset<pair<int,int> > S;\ninline void MyDearMoments(){\n\tn=read(),V.init(n);\n\tfor(reg i=1;i<=n;++i)a[b[i]=i]=read();\n\tsort(b+1,b+n+1,[](const int x,const int y){return a[x]<a[y];});\n\tfor(reg i=1;i<=n;++i)if(a[b[i]]==a[b[i-1]])V.merge(b[i],b[i-1]);\n\tfor(reg i=1;i<=n;++i)if(V.find(b[i]=i)==i)S.insert(make_pair(a[i],i));\n\tm=read();\n\twhile(m--){\n\t\tswitch(read()){\n\t\t\tcase 1:{\n\t\t\t\tint k=read(),w=read();\n\t\t\t\ta[b[k]=++n]=w,V.fa[n]=n;\n\t\t\t\tauto it=S.lower_bound(make_pair(w,0));\n\t\t\t\tif(it!=S.end()&&(*it).first==w)V.merge((*it).second,n);\n\t\t\t\telse S.insert(make_pair(w,n));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 2:printf(\"%d\\n\",a[V.find(b[read()])]);break;\n\t\t\tcase 3:{\n\t\t\t\tint l=read(),r=read(),mid=(l+r)>>1,tmp;\n\t\t\t\tauto it1=S.lower_bound(make_pair(l,0));\n\t\t\t\tauto it2=S.upper_bound(make_pair(mid,INF));\n\t\t\t\tauto it3=S.upper_bound(make_pair(r,INF));\n\t\t\t\tif(it3==S.begin())break;\n\t\t\t\tif(it1!=it2){\n\t\t\t\t\ta[V.find(tmp=(*it1).second)]=l-1,it1=S.erase(it1);\n\t\t\t\t\tfor(reg u;it1!=it2;it1=S.erase(it1))\n\t\t\t\t\t\ta[u=V.find((*it1).second)]=l-1,V.merge(tmp,u);\n\t\t\t\t\tif(it1!=S.end()&&(*(it1=S.lower_bound(make_pair(l-1,0)))).first==l-1)\n\t\t\t\t\t\tV.merge(tmp,(*it1).second);\n\t\t\t\t\telse S.insert(make_pair(l-1,tmp));\n\t\t\t\t}\n\t\t\t\tif(it2!=it3){\n\t\t\t\t\ta[V.find(tmp=(*it2).second)]=r+1,it2=S.erase(it2);\n\t\t\t\t\tfor(reg u;it2!=it3;it2=S.erase(it2))\n\t\t\t\t\t\ta[u=V.find((*it2).second)]=r+1,V.merge(tmp,u);\n\t\t\t\t\tif(it2!=S.end()&&(*(it2=S.lower_bound(make_pair(r+1,0)))).first==r+1)\n\t\t\t\t\t\tV.merge(tmp,(*it2).second);\n\t\t\t\t\telse S.insert(make_pair(r+1,tmp));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){return MyDearMoments(),0;}\n```",
        "postTime": 1664318823,
        "uid": 280633,
        "name": "Muel_imj",
        "ccfLevel": 7,
        "title": "CF1725K Kingdom of Criticism"
    }
]