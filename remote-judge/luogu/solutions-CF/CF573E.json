[
    {
        "content": "\u6709\u4e00\u79cd\u795e\u5947\u7684$O(n)$\u8d2a\u5fc3\u505a\u6cd5\uff0c\u5728CF\u4e0a\u80fd\u8fc7\uff0c\u7136\u9e45\u662f\u9519\u7684\uff0c\u968f\u4fbf\u5361\u5361\u5c31WA\u4e86\u3002\n\n---\n\n\u4ee5\u4e0b\u7b97\u6cd5\u6bd4\u6807\u7b97\u7684$O(n\\sqrt n\\log n)$\u8981\u4f18\uff0c\u8bc1\u660e\u6765\u81eaYuHaoxiang\u3002\n\n\u6709\u4e00\u4e2a$O(n^2)$\u7684dp\uff1a\u8bbe$f_{i,j}$\u8868\u793a\u524d$i$\u4e2a\u6570\u9009$j$\u4e2a\u6570\u7684\u6700\u5927\u503c\u3002\n\n$f_{i,j}=\\max(f_{i-1,j},f_{i-1,j-1}+j\\times a_i)$\n\n\n\u6709\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5bf9\u4e8e$a_i$\uff0c\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a$1\\leqslant k\\leqslant i$\u4f7f\u5f97\u4efb\u610f$0\\leqslant j < k$\uff0c\u6709$f_{i,j}=f_{i-1,j}$\uff1b\u4efb\u610f$k\\leqslant j\\leqslant i$\uff0c\u6709$f_{i,j}=f_{i-1,j-1}+j\\times a_i$\u3002\n\n\u5373\u5b58\u5728\u4e00\u4e2a\u5206\u754c\u70b9\uff0c\u4f7f\u5f97\u5de6\u8fb9\u7684\u90fd\u4e0d\u53d6$a_i$\uff0c\u53f3\u8fb9\u7684\u90fd\u53d6\u4e86$a_i$\u3002\n\n\u4e0b\u9762\u6765\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u3002\n\n\u5f53$i=0,1$\u65f6\u663e\u7136\u6210\u7acb\u3002\n\n\u8bbe$F_{i,j}$\u8868\u793a\u524d$i$\u4e2a\u6570\u9009$j$\u4e2a\u6570\uff0c\u6700\u5927\u65b9\u6848\u9009\u7684\u4e0b\u6807\u96c6\u5408\uff0c$V(F_{i,j})$\u8868\u793a\u53d6\u8fd9\u4e2a\u4e0b\u6807\u96c6\u5408\u7684\u503c\u3002\n\n\u5047\u8bbe\u5b58\u5728\u4e00\u4e2a$j$\uff0c\u4f7f\u5f97$i\\in F_{i,j}$\u4e14$i\\notin F_{i,j+1}$\u3002\n\n\u8bbe$F_{i-1,j}=F_{i-1,j-1}\\cup\\{x\\}$\uff0c$F_{i-1,j+1}=F_{i-1,j}\\cup\\{z\\}=F_{i-1,j-1}\\cup\\{x,z\\}$\uff0c$F_{i,j}=F_{i-1,j-1}\\cup\\{i\\}$\u3002\n\n\u7531\u5047\u8bbe\u5f97$F_{i,j+1}=F_{i-1,j+1}=F_{i-1,j}\\cup\\{z\\}$\u3002\n\n\u4ee4\u6bcf\u79cd\u65b9\u6848\u7684\u503c\u5404\u4e0d\u76f8\u540c\uff08\u76f8\u540c\u53ef\u4ee5\u901a\u8fc7\u6270\u52a8\u6765\u907f\u514d\uff09\uff0c\u5219$f_{i-1,j}< f_{i,j}$\u3002\n\n\u7531\u6b64\u53ef\u5f97$V(F_{i-1,j-1}\\cup\\{z\\})< V(F_{i-1,j-1}\\cup\\{x\\})$\u3002\n\n1. \u82e5$x<z$\uff0c\u5219$V(F_{i-1,j-1}\\cup\\{z\\})< V(F_{i-1,j-1}\\cup\\{x\\})< V(F_{i-1,j-1}\\cup\\{i\\})$\u3002\u7531\u4e8e$x<z$\u4e14$x<i$\uff0c\u6240\u4ee5$V(F_{i-1,j-1}\\cup\\{x,z\\})<V(F_{i-1,j-1}\\cup\\{x,i\\})$\u3002\n2. \u82e5$x>z$\uff0c\u5219$V(F_{i-1,j-1}\\cup\\{x\\}))< V(F_{i-1,j-1}\\cup\\{i\\})$\u3002\u7531\u4e8e$z<x$\u4e14$z<i$\uff0c\u6240\u4ee5$V(F_{i-1,j-1}\\cup\\{z,x\\})< V(F_{i-1,j-1}\\cup\\{z,i\\})$\u3002\u53c8\u6709$V(F_{i-1,j-1}\\cup\\{z\\})< V(F_{i-1,j-1}\\cup\\{x\\})$\uff0c\u7531\u4e8e$z< i$\u4e14$x< i$\uff0c\u6240\u4ee5$V(F_{i-1,j-1}\\cup\\{z,i\\})< V(F_{i-1,j-1}\\cup\\{x,i\\})$\u3002\u6240\u4ee5$V(F_{i-1,j-1}\\cup\\{z,x\\})< V(F_{i-1,j-1}\\cup\\{x,i\\})$\u3002\n\n\u7efc\u4e0a\uff0c$V(F_{i-1,j-1}\\cup\\{z,x\\})< V(F_{i-1,j-1}\\cup\\{x,i\\})$\u3002\n\n\u6240\u4ee5$f_{i-1,j+1}< f_{i-1,j}+(j+1)\\times a_i$\uff0c\u5373$i\\in F_{i,j+1}$\uff0c\u4e0e\u5047\u8bbe\u77db\u76fe\u3002\n\n\u7531\u6570\u5b66\u5f52\u7eb3\u6cd5\u53ef\u77e5\u7ed3\u8bba\u6210\u7acb\u3002\n\n---\n\n$f$\u7684\u7b2c\u4e00\u7ef4\u53ef\u4ee5\u53bb\u6389\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u4e8c\u5206\u51fa\u5f00\u59cb\u8f6c\u79fb\u7684\u4f4d\u7f6e\uff0c\u66f4\u65b0\u540e\u9762\u7684\u503c\u5373\u53ef\u3002\n\n\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8fd8\u662f$O(n^2)$\u7684\u3002\n\n\u89c2\u5bdf\u5230\u6bcf\u6b21\u8f6c\u79fb\uff0c\u76f8\u5f53\u4e8e\u5728\u67d0\u5904\u63d2\u5165\u4e00\u4e2a\u65b0\u503c\uff0c\u7136\u540e\u7ed9\u540e\u9762\u4e00\u90e8\u5206\u52a0\u4e0a\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u6240\u4ee5\u7528\u5e73\u8861\u6811\u6765\u5b9e\u73b0\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log^2 n)$\u3002\n\n## Code\uff1a\n```cpp\n#include<cstdio>\n#include<algorithm>\ntypedef long long LL;\nconst int N=1e5+5;\nint fa[N],ch[N][2],sz[N];LL A[N],B[N],val[N];\nint n,a,rt,cnt;\ninline int ckr(int x,const int p=1){return ch[fa[x]][p]==x;}\ninline void update(int x){const int L=ch[x][0],R=ch[x][1];sz[x]=sz[L]+sz[R]+1;}\ninline void modify(int x,LL a,LL b){val[x]+=a*(sz[ch[x][0]]+1)+b,A[x]+=a,B[x]+=b;}\ninline void pushdown(int x){\n\tif(A[x]||B[x]){\n\t\tif(ch[x][0])modify(ch[x][0],A[x],B[x]);\n\t\tif(ch[x][1])modify(ch[x][1],A[x],B[x]+A[x]*(sz[ch[x][0]]+1));\n\t\tA[x]=B[x]=0;\n\t}\n}\ninline void rotate(int x){\n\tint y=fa[x],z=fa[y],k=ckr(x);\n\tif(z)ch[z][ckr(y)]=x;\n\tfa[x]=z,fa[y]=x,fa[ch[x][!k]]=y,ch[y][k]=ch[x][!k],ch[x][!k]=y,update(y);\n}\ninline void splay(int x){\n\tstatic int sta[N],top;sta[top=1]=x;\n\tfor(int y=x;fa[y];sta[++top]=y=fa[y]);\n\twhile(top)pushdown(sta[top--]);\n\tfor(;fa[x];rotate(x))if(fa[fa[x]])rotate((ckr(x)^ckr(fa[x]))?x:fa[x]);update(rt=x);\n}\ninline LL getv(int k){\n\tint x=rt;\n\twhile(1){\n\t\tif(sz[ch[x][0]]+1==k){\n\t\t\tsplay(x);return val[x];\n\t\t}\n\t\tif(sz[ch[x][0]]>=k)x=ch[x][0];else k-=sz[ch[x][0]]+1,x=ch[x][1];\n\t}\n}\nLL chkmax(int x){\n\tif(!x)return -1e18;\n\tpushdown(x);\n\treturn std::max(val[x],std::max(chkmax(ch[x][0]),chkmax(ch[x][1])));\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tsz[1]=rt=cnt=1;\n\tfor(int i=1,a;i<=n;++i){\n\t\tscanf(\"%d\",&a);\n\t\tint l=0,r=i-2,ans=i-1;\n\t\twhile(l<=r){\n\t\t\tconst int mid=l+r>>1;\n\t\t\tif(getv(mid+1)+(mid+1LL)*a>getv(mid+2))r=(ans=mid)-1;else l=mid+1;\n\t\t}\n\t\tgetv(ans+1);\n\t\tfa[++cnt]=rt,fa[ch[rt][1]]=cnt,ch[cnt][1]=ch[rt][1],ch[rt][1]=cnt,val[cnt]=val[rt];\n\t\tmodify(cnt,a,(LL)a*ans);\n\t}\n\tprintf(\"%lld\\n\",chkmax(rt));\n\treturn 0;\n}\n```",
        "postTime": 1552375732,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF573E \u3010Bear and Bowling\u3011"
    },
    {
        "content": "\u8003\u8651\u4e00\u4e2a\u8d2a\u5fc3\u7b56\u7565\uff1a\u4e00\u5f00\u59cb\u9009\u7a7a\u96c6\uff0c\u7136\u540e\u6bcf\u6b21\u9009\u4e00\u4e2a\u4e0d\u5728\u96c6\u5408\u4e2d\u7684\u6570\u52a0\u5165\u96c6\u5408\uff0c\u5177\u4f53\u9009\u54ea\u4e2a\u6570\u5462\uff1f\u9009\u62e9\u8ba9\u65b0\u7684\u7b54\u6848\u6700\u5927\u7684\u6570\u5373\u53ef\u3002\n\n\u7136\u540e\u96c6\u5408\u5927\u5c0f\u4ece $0$ \u9010\u6e10\u589e\u5927\u5230\u4e86 $n$\uff0c\u5f97\u5230\u4e86 $n + 1$ \u4e2a\u7b54\u6848\uff0c\u6211\u4eec\u9009\u53d6\u5176\u4e2d\u6700\u5927\u7684\u4e00\u4e2a\u8f93\u51fa\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u505a\u6210\u529f TLE \u4e86\uff08\u60b2\uff09\uff0c\u4f46\u662f\u5e76\u6ca1\u6709 WA\uff0c\u8bf4\u660e\u8d2a\u5fc3\u662f\u5bf9\u7684\uff08\u786e\u4fe1\uff09\u3002\n\n\u5177\u4f53\u8bc1\u660e\u8bf7\u4e0b\u8f7d [\u5f90\u7fca\u8f69\u7684\u9898\u89e3](https://files.cnblogs.com/files/PinkRabbit/Solution_to_CF573E_by_cz_xuyixuan.zip) \u67e5\u770b\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u5feb\u901f\u7ef4\u62a4\u8fd9\u4e2a\u8d2a\u5fc3\uff0c\u5177\u4f53\u5730\u8bf4\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u6709\u4e00\u4e2a\u6743\u503c $b_i$ \u548c\u4e00\u4e2a\u56fa\u5b9a\u7684\u503c $a_i$\uff0c\u9700\u8981\u652f\u6301\u56db\u79cd\u64cd\u4f5c\uff1a\n\n1. \u524d\u7f00 $b_i$ \u52a0\u76f8\u540c\u503c\u3002\n2. \u540e\u7f00 $b_i$ \u52a0 $a_i$\u3002\n3. \u67e5\u8be2 $b_i$ \u7684\u5168\u5c40\u6700\u5927\u503c\u3002\n4. \u5220\u9664\u4e00\u4e2a\u4f4d\u7f6e\u3002\n\n\u4e00\u822c\u7ebf\u6bb5\u6811\u6ca1\u6cd5\u505a\uff0c\u6211\u4eec\u8003\u8651\u5206\u5757\u3002\uff08\u5176\u5b9e\u8fd9\u662f\u4e00\u79cd\u7ecf\u5178\u5206\u5757\u7c7b\u578b\uff09\n\n\u6bcf $\\sqrt{n}$ \u4e2a\u5143\u7d20\u5206\u4e00\u5757\uff0c\u90a3\u5bf9\u4e8e\u6bcf\u4e00\u5757\u5c31\u8981\u5b9e\u73b0\uff1a\n\n1. \u6574\u4f53\u52a0\u3002\n2. \u6574\u4f53\u52a0 $a_i$\u3002\n3. \u67e5\u8be2\u6574\u4f53\u6700\u5927\u503c\u3002\n4. \u91cd\u6784\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u5927\u6982\u662f\u7c7b\u4f3c\u659c\u7387\u4f18\u5316\u90a3\u5957\u5f0f\u5b50\uff0c\u7ef4\u62a4\u4e0a\u51f8\u58f3\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5230 $a_i$ \u59cb\u7ec8\u4e0d\u53d8\uff0c\u800c\u8981\u6c42\u7684\u659c\u7387\u4e0d\u65ad\u9012\u51cf\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\uff0c\u91cd\u6784\u7684\u65f6\u5019\u4e5f\u4e0d\u7528\u91cd\u65b0\u6392\u5e8f\u4e86\u3002\n\n\u672c\u9898\u8fd8\u6709 $\\mathcal O (n \\log n)$ \u7684\u505a\u6cd5\uff0c\u5728\u9898\u89e3\u4e2d\u540c\u6837\u53ef\u4ee5\u770b\u5230\u3002\u4e0d\u8fc7\u56e0\u4e3a\u8981\u624b\u5199\u5e73\u8861\u6811\uff0c\u6211\u6bd4\u8f83\u61d2\u5c31\u4e0d\u5199\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O (n \\sqrt{n})$\uff0c[\u8bc4\u6d4b\u94fe\u63a5](https://codeforces.com/contest/573/submission/70984127)\u3002",
        "postTime": 1583442701,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF573E \u3010Bear and Bowling\u3011"
    },
    {
        "content": "> [CF573E Bear and Bowling](https://codeforces.com/contest/573/problem/E)\n\n## \u9898\u610f\n\n- \u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a_{1\\dots n}$\u3002\n- \u4f60\u8981\u6c42\u4e00\u4e2a $a$ \u7684\u5b50\u5e8f\u5217 $b_{1\\dots m}$\uff08\u53ef\u4ee5\u4e3a\u7a7a\uff09\uff0c\u4f7f\u5f97 $\\sum_{i=1}^m ib_i$ \u7684\u503c\u6700\u5927\u3002\n- $n \\le 10^5$\uff0c$|a_i| \\le 10^7$\u3002\n\n## \u9898\u89e3\n\n\u9996\u5148\u6709\u4e2a\u663e\u7136\u7684\u8d2a\u5fc3\uff1a\u6bcf\u6b21\u9009\u62e9\u8d21\u732e\u6700\u5927\u7684\u4f4d\u7f6e\uff0c\u76f4\u5230\u8d21\u732e\u975e\u6b63\uff0c\u6b64\u65f6\u8d21\u732e\u548c\u5373\u4e3a\u7b54\u6848\u3002\n\n\u8fd9\u91cc\u7684\u8d21\u732e\u53ef\u4ee5\u7b80\u5355\u7684\u5199\u6210 $k_ia_i+b_i$\uff0c\u5176\u4e2d $k_i$ \u4e3a $i$ \u4e4b\u524d\u88ab\u9009\u62e9\u7684\u4f4d\u7f6e\u6570 $+1$\uff0c$b_i$ \u8868\u793a $i$ \u4e4b\u540e\u88ab\u9009\u62e9\u7684\u4f4d\u7f6e\u7684 $a$ \u4e4b\u548c\u3002\n\n\u76f8\u5f53\u4e8e\u6211\u4eec\u8981\u7ef4\u62a4 $n$ \u4e2a\u4e00\u6b21\u51fd\u6570 $k_ia_i + b_i$\uff0c\u652f\u6301\u533a\u95f4 $k_i,b_i$ \u52a0\u548c\u5168\u5c40\u6700\u5927\u503c\u3002\n\n\u8fd9\u73a9\u610f\u513f\u662f\u6709\u529e\u6cd5 $\\text{polylog}$ \u7ef4\u62a4\u7684\uff08\u8be6\u89c1 [EI \u7684\u63d0\u4ea4](https://codeforces.com/contest/573/submission/68101378)\uff09\uff0c\u4f46\u975e\u5e38\u590d\u6742\u3002\n\n\u8003\u8651\u5206\u5757\uff0c\u5757\u5185\u4f7f\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u6700\u5927\u7684\u4f4d\u7f6e $p$\uff0c\u5148\u5c06 $p$ \u7684\u8d21\u732e\u8ba1\u5165\u7b54\u6848\uff0c\u7136\u540e\u5220\u9664 $p$\uff08\u5c06 $p$ \u7684\u8d21\u732e\u8bbe\u4e3a $-\\infty$\uff09\u3002\n\n\u5bf9\u4e8e $p$ \u4e4b\u524d\u7684\u4f4d\u7f6e $i$\uff0c\u76f8\u5f53\u4e8e $b_i$ \u52a0\u4e0a $a_p$\uff1b\u5bf9\u4e8e $p$ \u4e4b\u540e\u7684\u4f4d\u7f6e $i$\uff0c\u76f8\u5f53\u4e8e $k_i$ \u52a0\u4e0a $1$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u6574\u5757\uff0c\u6253\u4e0a\u4e24\u4e2a\u5206\u522b\u5173\u4e8e $k,b$ \u7684\u6807\u8bb0\u5373\u53ef\uff1b\u800c\u5bf9\u4e8e $p$ \u6240\u5728\u7684\u5757\uff0c\u66b4\u529b\u91cd\u6784\u5373\u53ef\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\sqrt n)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst int N = 1e5 + 7, M = 370;\nconst ld inf = 1e18L;\nint n, m, k, a[N], b[N], p[N], l[M], r[M];\nll f[N], ans;\n\nstruct T {\n\tint l, r, q[M];\n\tll k, b;\n\tinline ll c(int i) {\n\t\treturn f[i] + k * a[i] + b;\n\t}\n\tinline ld s(int i, int j) {\n\t\tif (a[i] == a[j]) return f[i] > f[j] ? -inf : inf;\n\t\treturn 1.0L * (f[i] - f[j]) / (a[i] - a[j]);\n\t}\n\tinline void build(int x) {\n\t\tfor (int i = ::l[x]; i <= ::r[x]; i++) f[i] += k * a[i] + b;\n\t\tk = b = l = r = 0;\n\t\tfor (int i = ::l[x]; i <= ::r[x]; i++) {\n\t\t\twhile (r - l > 1 && s(q[r-2], q[r-1]) < s(q[r-1], p[i])) --r;\n\t\t\tq[r++] = p[i];\n\t\t}\n\t}\n\tinline pair<ll, int> ask() {\n\t\twhile (r - l > 1 && c(q[l]) <= c(q[l+1])) ++l;\n\t\treturn mp(c(q[l]), q[l]);\n\t}\n} t[M];\n\nint main() {\n\trd(n), m = sqrt(n);\n\tfor (int i = k = 1; i <= n; k += !(i % m), i++)\n\t\trd(a[i]), f[i] = a[i], p[i] = i, b[i] = k;\n\tif (!(n % m)) --k;\n\tfor (int i = 1; i <= k; i++) {\n\t\tl[i] = r[i-1] + 1, r[i] = min(i * m, n);\n\t\tsort(p + l[i], p + r[i] + 1, [&](int i, int j) { return a[i] < a[j]; });\n\t\tt[i].build(i);\n\t}\n\twhile (1) {\n\t\tpair<ll, int> o = mp(0ll, 0);\n\t\tfor (int i = 1; i <= k; i++) o = max(o, t[i].ask());\n\t\tif (!o.fi) return print(ans), 0;\n\t\tans += o.fi, f[o.se] = -inf;\n\t\tfor (int i = 1; i < b[o.se]; i++) t[i].b += a[o.se];\n\t\tfor (int i = l[b[o.se]]; i < o.se; i++) f[i] += a[o.se];\n\t\tfor (int i = o.se + 1; i <= r[b[o.se]]; i++) f[i] += a[i];\n\t\tfor (int i = b[o.se] + 1; i <= k; i++) ++t[i].k;\n\t\tt[b[o.se]].build(b[o.se]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1581618746,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF573E \u3010Bear and Bowling\u3011"
    },
    {
        "content": "### P.S.\n\u66b4\u529b\u53ef\u8fc7\u662f\u795e\u9a6c\u4e1c\u4e1c\u554a\uff01\uff01\uff01![](https://xn--9zr.tk/fn)![](https://xn--9zr.tk/fn)![](https://xn--9zr.tk/fn)  \n\u4e0d\u8fc7\u4f60\u770b\u90a3\u4e9b\u66b4\u529b\u9898\u89e3\uff0c\u76f4\u63a5 1.28min\u3002![](https://xn--9zr.tk/no)  \n\u6211\u7684\u4ee3\u7801\u662f 13.58s\uff0c\u4e0d\u8fc7\u6211\u4e5f\u4e0d\u77e5\u9053\u90a3\u4e9b 10s- \u662f\u600e\u4e48\u505a\u7684\u3002![](https://xn--9zr.tk/kk)  \n\u8fd8\u6709\u5c31\u662f\u4e3a\u4ec0\u4e48 $\\text h\\color{red}\\text{ehezhou}$ \u795e\u4ed9\u6559\u6211\u7684\u5e73\u8861\u6811\u5e38\u6570\u5f88\u5927\u554a\uff0c\u5c31\u662f\u5408\u5e76\u65f6\u6309\u7167\u5b50\u6811 $siz$ \u6982\u7387\u542f\u53d1\u5f0f\u3002  \n\u672c\u5730 $n=100000,|a_i|\\le10$ \u7684\u6570\u636e\u8dd1\u4e86 `11s+`\u3002  \n\u800c\u6362\u6210\u6bcf\u4e2a\u70b9\u6709\u70b9\u6743\uff0c\u6bcf\u6b21\u76f4\u63a5\u6309\u7167\u70b9\u6743\u5408\u5e76\u7684\u5199\u6cd5\u76f4\u63a5 `2s-`\u3002  \n\uff08\u4e0d\u8fc7\u5f53 $|a_i|\\le 10^7$ \u65f6\u901f\u5ea6\u6b63\u5e38\u4e86\u8fd8\u6bd4 splay \u5feb\uff09\u3002  \n\u6709\u65e0\u8001\u5927\u54e5\u8fc7\u6765\u6307\u5bfc\u4e00\u4e0b\u8fd9\u662f\u4e3a\u4ec0\u4e48 ![](https://xn--9zr.tk/kk)\n### Description.\n\u7ed9\u5b9a\u5e8f\u5217 $\\{a_i\\}$\uff0c\u6c42\u5b83\u7684\u5b50\u5e8f\u5217 $\\{b_i\\}$\uff0c\u4f7f $\\sum_{i=1}^mb_i\\times i$ \u6700\u5927\uff0c\u8f93\u51fa\u6700\u5927\u503c\u3002  \n### Solution.\n\u9996\u5148\u6709\u4e00\u4e2a\u5f88\u663e\u7136\u7684 $O(n^2)$ `dp`\u3002  \n$$dp_{i,j}=\\max\\{dp_{i-1,j},dp_{i-1,j-1}+j\\times a_i\\}$$\n\n\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u89c2\u5bdf $j$\u3002  \n\u76f8\u5f53\u4e8e\u662f\u6211\u4eec\u6bcf\u6b21\u591a\u9009\u62e9\u4e00\u4e2a $j$\uff0c\u8981\u8ba9\u548c\u6700\u5927\u3002  \n\u6839\u636e `wqs\u4e8c\u5206` \u90a3\u5957\u7406\u8bba\uff0c\u8fd9\u4e2a\u9009\u62e9\u65b9\u5f0f\u662f\u5177\u6709\u5355\u8c03\u6027\u7684\u3002  \n\u6240\u4ee5 $dp_{i,j}$ \u7684\u8f6c\u79fb\u80af\u5b9a\u662f\u524d\u9762\u4e00\u6bb5\u4e0d\u9009\uff0c\u540e\u9762\u4e00\u6bb5\u9009\u3002  \n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4e8c\u5206\u5f97\u5230\u9009\u548c\u4e0d\u9009\u7684\u8f6c\u6298\u70b9\u3002  \n\u76f8\u5f53\u4e8e\u662f\u627e\u5230\u4e00\u4e2a\u4f4d\u7f6e\u4f7f\u5f97 $dp_{i,j}\\le dp_{i,j-1}+j\\times a_i$\u3002  \n\n\u6211\u4eec\u89c2\u5bdf\u6bcf\u6b21\u8f6c\u79fb\uff0c\u76f8\u5f53\u4e8e\u662f\u5bf9\u5f53\u524d\u5b58\u5728\u7684\u70b9\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217\u3002  \n\u56e0\u4e3a\u521a\u5f00\u59cb\u5f88\u591a\u70b9\u4e0d\u5b58\u5728\u6ca1\u6709\u6743\u503c\uff0c\u6240\u4ee5\u7528\u7ebf\u6bb5\u6811\u7b49\u7ef4\u62a4\u8d77\u6765\u5f88\u590d\u6742\u3002  \n\u4e8e\u662f\u5e73\u8861\u6811\u88ab\u5f15\u5165\u4e86\uff0c\u6211\u4eec\u8003\u8651\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\u3002  \n\u7136\u540e\u6bcf\u6b21\u8f6c\u79fb\u76f8\u5f53\u4e8e\u591a\u4e86\u4e00\u4e2a\u5b58\u5728\u7684\u70b9\uff0c\u5e76\u5bf9\u5b83\u4e4b\u540e\u7684\u533a\u95f4\u52a0\u4e0a\u7b49\u5dee\u6570\u5217\u3002  \n\u76f4\u63a5\u5e73\u8861\u6811\u7ef4\u62a4\u5373\u53ef\u3002  \n\n\u590d\u6742\u5ea6\u4e3a $O(\\sum_{i=1}^n\\log^2i)=O(n\\log^2i)$  \n### Coding.\n```cpp\n//\u613f\u4f60\u548c\u4f60\u91cd\u8981\u7684\u4eba\u80fd\u591f\u91cd\u9022\uff01\n#pragma GCC optimize(\"Ofast,no-stack-protector,unroll-loops,fast-math\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4.1,sse4.2,avx,avx2,popcnt,tune=native\")\n#include<bits/stdc++.h>\n//#define int ll\nusing namespace std;typedef long long ll;\ntemplate<typename T>inline void read(T &x)\n{\n\tx=0;char c=getchar(),f=0;\n\tfor(;c<'0'||c>'9';c=getchar()) if(c=='-') f=1;\n\tfor(;c>='0'&&c<='9';c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\tif(f) x=-x;\n}\nstruct node{int sz,ls,rs;ll vl,lk,lb;unsigned key;}t[500005];int rt,tt,n,a[500005];\ninline void pushup(int x) {t[x].sz=t[t[x].ls].sz+t[t[x].rs].sz+1;}\ninline void allc(int x,ll k,ll b) {if(x) t[x].lk+=k,t[x].lb+=b,t[x].vl+=k*(1+t[t[x].ls].sz)+b;}\ninline void pushdw(int x) {if(t[x].lk||t[x].lb) allc(t[x].ls,t[x].lk,t[x].lb),allc(t[x].rs,t[x].lk,t[x].lb+t[x].lk*(t[t[x].ls].sz+1)),t[x].lk=t[x].lb=0;}\nmt19937 getrnd(time(0));inline unsigned rnd() {return getrnd();}\ninline void split(int x,int k,int &a,int &b)\n{\n\tif(!x) return a=b=0,void();else pushdw(x);\n\tif(k<=t[t[x].ls].sz) b=x,split(t[x].ls,k,a,t[b].ls),pushup(b);\n\telse a=x,split(t[x].rs,k-t[t[x].ls].sz-1,t[a].rs,b),pushup(a);\n}\ninline int mrg(int x,int y)\n{\n\tif(!x||!y||!(x^y)) return x|y;else pushdw(x),pushdw(y);\n\tif(t[x].key<t[y].key) return t[x].rs=mrg(t[x].rs,y),pushup(x),x;//\u5c31\u662f\u8fd9\u91cc\n\t//hehezhou \u5199\u6cd5\uff1aif(rnd()%(t[x].sz+t[y].sz)<t[x].sz)\n\telse return t[y].ls=mrg(x,t[y].ls),pushup(y),y;\n}\ninline void paint(int x) {if(x) pushdw(x),paint(t[x].ls),printf(\"%lld \",t[x].vl),paint(t[x].rs);}\ninline ll getK(int x,int k) {return pushdw(x),k<=t[t[x].ls].sz?getK(t[x].ls,k):(k>t[t[x].ls].sz+1?getK(t[x].rs,k-t[t[x].ls].sz-1):t[x].vl);}\ninline void ins(int k,ll w) {int a,b;split(rt,k,a,b),rt=mrg(a,mrg((t[++tt]=(node){1,0,0,w,0,0,rnd()},tt),b));}//k+1\ninline void mdf(int k,ll p,ll q) {int a,b;split(rt,k,a,b),allc(b,p,q),rt=mrg(a,b);}//(k,n]\ninline ll getm(int x) {return x?(pushdw(x),max(max(getm(t[x].ls),getm(t[x].rs)),t[x].vl)):0;}\n//\u4e0a\u9762\u90fd\u662f\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217\u5355\u70b9\u67e5\u8be2\u5355\u70b9\u63d2\u5165\u7684\u5e73\u8861\u6811\u677f\u5b50 qaq\nsigned main()\n{\n\tread(n),rt=tt=1,t[1]=(node){1,0,0,0,0,0,rnd()};for(int i=1;i<=n;i++) read(a[i]);\n\tfor(int i=1;i<=n;i++)\n\t{//\u76f4\u63a5\u4e8c\u5206\n\t\tint le=0,ri=i-2,rs=i-1;\n\t\twhile(le<=ri) {int md=(le+ri)>>1;if(getK(rt,md+1)+1ll*(md+1)*a[i]>getK(rt,md+2)) rs=md,ri=md-1;else le=md+1;}\n\t\tll qwq=getK(rt,rs+1);ins(rs+1,qwq),mdf(rs+1,a[i],1ll*a[i]*rs);\n\t}//\u63d2\u5165\u5e76\u540e\u7f00\u52a0\u7b49\u5dee\u6570\u5217\n\treturn printf(\"%lld\\n\",getm(rt)),0;\n}\n```\n\u5982\u679c\u6709\u4eba\u80fd\u544a\u8bc9\u7b14\u8005\u4e3a\u4ec0\u4e48 hehezhou \u90a3\u79cd\u5199\u6cd5\u4f1a\u51fa\u95ee\u9898\u3002  \n\u7b14\u8005\u611f\u6fc0\u4e0d\u5c3d![](https://xn--9zr.tk/dk)![](https://xn--9zr.tk/dk)![](https://xn--9zr.tk/dk)\u3002  ",
        "postTime": 1614998406,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "CF573E Bear and Bowling\uff08\u9898\u89e3\uff09"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u4e0d\u5f00 O2 \u4e0d\u4f7f\u7528\u5feb\u8bfb\u5feb\u5199\u603b\u7528\u65f6 1.47s \u7684\u4ee3\u7801\u7684\u601d\u8def\u3002\n\n\u6734\u7d20\u7b56\u7565\n---\n\n\u6709\u4e00\u4e2a $O(n^2)$ \u7684\u8f83\u4e3a\u7b80\u5355\u7684 dp \u3002\n\n\u8bbe $dp_{i,j}$ \u8868\u793a**\u524d $i$ \u4e2a\u6570\u9009 $j$ \u4e2a\u6570\u7ec4\u6210\u5b50\u5e8f\u5217\u7684\u6700\u5927\u7b54\u6848**\uff0c\u6b64\u65f6\u6709\n\n$$dp_{i,j}=\\max(dp_{i-1,j},dp_{i-1,j-1}+a_i\\times j)$$\n\n\u4f18\u5316\u731c\u60f3\n---\n\n$\\forall i$\uff0c $\\exists k_i\\in[0,i]$\uff0c\u6ee1\u8db3 \n\n$$\\forall j< k_i,\\ dp_{i,j}=dp_{i-1,j}$$\n\n$$\\forall j\\ge k_i,\\ dp_{i,j}=dp_{i-1,j-1}+j\\times  a_i$$\n\n\u8bc1\u660e\n---\n\n\u8003\u8651\u5bf9\u4e8e $dp_i$ \u6784\u9020\u4e00\u4e2a**\u5dee\u5206\u5e8f\u5217** $f_i$\u3002\u82e5\u731c\u60f3\u6210\u7acb\uff0c\u7531\u4e0a\u8ff0 $k_i$ \u7684\u5b9a\u4e49\uff0c\u6709 $dp_{i-1,k_i-1}\\ge dp_{i-1,k_i-2}+a_i\\times (k_i-1)$ \u4e14 $dp_{i-1,k_i}< dp_{i-1,k_i-1}+a_i\\times (k_i-1)$\uff0c\u5bf9\u5e94 $\\frac{f_{i-1,k_i-1}}{k_i-1}\\ge a_i$ \u4e14 $\\frac{f_{i-1,k_i}}{k_i}<a_i$\u3002\n\n**\u6ce8\u610f $a_i$ \u53d6\u503c\u4e0e $f_{i-1}$ \u65e0\u5173\uff0c\u6240\u4ee5 $\\frac{f_{i-1,j}}{j}$ \u5173\u4e8e $j$ \u5355\u8c03\u4e0d\u589e**\u3002\n\n\u8ba1\u7b97 $dp_i$ \u503c\u540e\uff0c\u53ef\u77e5\n\n$$\\forall j<k_i,f_{i,j}=f_{i-1,j}$$ \n\n$$\\forall j>k_i,f_{i,j}=f_{i-1,j-1}+a_i$$ \n\n$$f_{i,k_i}=a_i\\times k_i$$\n\n\u7b80\u5355\u6765\u8bb2\uff0c\u8ba1\u7b97 $dp_i$ \u540e\uff0c$f_i$ \u7b49\u6548\u4e8e\u5728 $f_{i-1}$ \u4e2d\uff0c\u5bf9 $f_{i-1,k_i-1}$ \u540e\u6574\u4f53\u52a0\u4e0a $a_i$\uff0c\u7136\u540e\u5728 $f_{i-1,k_i-1}$ \u540e\u63d2\u5165 $a_i\\times k_i$\u3002\n\n\u8003\u8651\u8bc1\u660e**\u82e5\u731c\u60f3\u6210\u7acb\uff0c\u5219 $\\frac{f_{i,j}}{j}$ \u5173\u4e8e $j$ \u4ecd\u5355\u8c03\u4e0d\u589e**\u3002\n\n\u5bf9\u4e8e $\\forall j<k_i$\uff0c\u663e\u7136 $f_{i,j}$ \u4e0d\u53d1\u751f\u53d8\u5316\u3002\n\n\u5bf9\u4e8e $k_i$\uff0c\u7531\u4e8e $\\forall j<k_i,\\frac{f_{i-1,j}}{j}<a_i$ \u4e14 $\\frac{f_{i-1,k_i}}{k_i}=\\frac{k_i\\times a_i}{k_i}=a_i$\uff0c\u5355\u8c03\u6027\u663e\u7136\u4e5f\u6ca1\u6709\u6539\u53d8\u3002\n\n\u5bf9\u4e8e $\\forall j>k_i$\uff0c\u6709 $\\frac{f_{i-1,j}}{j}\\ge \\frac{f_{i-1,j+1}}{j+1}$\uff0c\u6545\u800c ${f_{i-1,j}}\\ge \\frac{j}{j+1}\\times f_{i-1,j+1}$\u3002\n\n\u540c\u65f6 $f_{i,j+1}=f_{i-1,j}+a_i,f_{i,j+2}=f_{i-1,j+1}+a_i$\uff0c\u8003\u8651\u4ece\u7ed3\u8bba**\u5012\u63a8**\uff0c\u53ef\u5f97 \n\n$$\\begin{aligned}\\frac{f_{i,j+1}}{j+1}&>\\frac{f_{i,j+2}}{j+2}\\\\\n\\frac{f_{i-1,j}+a_i}{j+1}&>\\frac{f_{i-1,j+1}+a_i}{j+2}\\\\\nf_{i-1,j}+a_i&>\\frac{j+1}{j+2}\\times (f_{i-1,j+1}+a_i)\\\\\nf_{i-1,j}+a_i&>\\frac{j+1}{j+2}\\times f_{i-1,j+1}+\\frac{j+1}{j+2}\\times a_i\\\\\nf_{i-1,j}&>\\frac{j+1}{j+2}\\times f_{i-1,j+1}-\\frac1{j+2}\\times a_i\\end{aligned}$$\n\n\u800c\n$$\\begin{aligned}&\\phantom{\\,=\\,}\\left(\\frac{j}{j+1}\\times f_{i-1,j+1}\\right)-\\left(\\frac{j+1}{j+2}\\times f_{i-1,j+1}-\\frac{1}{j+2}\\times a_i\\right)\\\\&=\\frac{((j+2)\\times j-(j+1)\\times (j+1))\\times f_{i-1,j+1}+(j+1)\\times a_i}{(j+1)(j+2)}\\\\&=\\frac{(j+1)\\times a_i-f_{i-1,j+1}}{(j+1)(j+2)}\\ge 0\\end{aligned}$$\n\n\u6700\u540e\u7531 $f_{i-1}$ \u5355\u8c03\u4e0d\u589e\u4e00\u5b9a\u6709 $f_i$ \u5355\u8c03\u4e0d\u589e\u3002\u800c $f_1$ \u53ea\u6709\u4e00\u4e2a\u6570\uff08\u5355\u8c03\u4e0d\u589e\uff09\uff0c**\u901a\u8fc7\u6570\u5b66\u5f52\u7eb3\u6cd5\u53ef\u5f97\u6240\u6709 $f_i$ \u5747\u662f\u5355\u8c03\u4e0d\u589e\uff0c\u4ece\u800c\u8bc1\u660e\u731c\u60f3\u6210\u7acb\u3002**\n\n\u5b9e\u73b0\n---\n\n\u8fd9\u91cc\u6211\u4f7f\u7528\u7684\u662f FHQ Treap \u5b9e\u73b0\u4e8c\u5206\u6c42 $k_i$\uff0c\u5355\u70b9\u63d2\u5165\uff0c\u533a\u95f4\u52a0\u3002\u5177\u4f53\u6765\u8bb2\uff0c**\u53ea\u7ef4\u62a4 $f$ \u6570\u7ec4**\uff0c\u5728 FHQ Treap \u7684\u6309\u6743\u503c\u5206\u88c2\u65f6\uff0c\u6309 $f_{i,j}$ \u4e0e $a_i\\times j$ \u7684\u5927\u5c0f\u5173\u7cfb\u4e3a\u4e8c\u5206\u4f9d\u636e\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\n\u6838\u5fc3\u4ee3\u7801\n---\n\n```cpp\nvoid vSplit(int p,int rnk,int &x,int &y){\n\tif(!p){\n\t\tx=y=0;\n\t\treturn;\n\t}\n\tPushdown(p);\n\tif(a*(rnk+siz(ls(p))+1)>val(p)){\n\t\ty=p;//y\u6811\u5185\u4f1a\u662f f[i-1][k[i]]~f[i-1][i-1]\n\t\tvSplit(ls(p),rnk,x,ls(p));\n\t}\n\telse{\n\t\tx=p;//x\u6811\u5185\u4f1a\u662f f[i-1][1]~f[i-1][k[i]-1]\n\t\tvSplit(rs(p),rnk+siz(ls(p))+1,rs(p),y);\n\t}\n\tPushup(p);\n}\n```\n\np.s. \u611f\u8c22 [plate_let](https://www.luogu.com.cn/user/177524) \u5de8\u4f6c\u63d0\u4f9b\u7684\u601d\u8def\uff01",
        "postTime": 1649995263,
        "uid": 546086,
        "name": "Francais_Drake",
        "ccfLevel": 7,
        "title": "CF573E \u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\n\u4e0b\u6587\u4e2d\u79f0 $\\sum\\limits_{i=1}^k i \\cdot b_i$ \u53d6\u5230\u6700\u5927\u503c\u7684\u5b50\u5e8f\u5217 $b$ \u7684\u4f4d\u7f6e\u96c6\u5408\u4e3a\u6700\u4f18\u96c6\u5408\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u663e\u7136\u7684 dp\uff1a\u8bbe $dp_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u4e2d\u9009\u4e86 $j$ \u4e2a\u4f5c\u4e3a\u5b50\u5e8f\u5217\u7684\u6700\u5927\u503c\u3002\u8f6c\u79fb\u4e3a\uff1a$dp_{i,j}=\\max(dp_{i-1,j},dp_{i-1,j-1}+a_i \\cdot j)$\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u8d2a\u5fc3\uff1a\u6bcf\u4e00\u6b21\u9009\u62e9\u5bf9\u5f53\u524d\u5e8f\u5217\u8d21\u732e\u6700\u5927\u7684\u70b9 $i$ \u52a0\u5165\u5b50\u5e8f\u5217\u3002\u663e\u7136\uff0c\u8fd9\u4e2a\u70b9\u7684\u8d21\u732e\u4e3a\uff1a$V_i=a_i \\cdot (x+1) + y$\u3002\u5176\u4e2d $x$ \u8868\u793a $i$ \u4e4b\u524d\u5df2\u7ecf\u9009\u4e86\u7684\u4f4d\u7f6e\u4e2a\u6570\uff0c$y$ \u8868\u793a $i$ \u4e4b\u540e\u5df2\u7ecf\u9009\u4e86\u7684\u6570\u4e4b\u548c\u3002\n\n\u5f15\u7406\uff1a\u5728\u8fd9\u4e2a\u8d2a\u5fc3\u7b56\u7565\u4e0b\uff0c\u82e5 $i<j,a_i>a_j$\uff0c\u5219 $i$ \u4e00\u5b9a\u6bd4 $j$ \u5148\u9009\u3002\n\n\u8bc1\u660e\uff1a\u5047\u8bbe\u5f15\u7406\u4e0d\u6210\u7acb\uff0c\u5f53\u524d\u662f\u7b2c\u4e00\u6b21\u8fdd\u80cc\u5f15\u7406\u7684\u65f6\u5019\uff0c\u5f53\u524d\u9009\u4e86 $j$\u3002\u5148\u8003\u8651\u5728 $i$ \u5de6\u8fb9\u7684\u5df2\u7ecf\u9009\u4e86\u7684\u4f4d\u7f6e\u548c\u5728 $j$ \u53f3\u8fb9\u7684\u5df2\u7ecf\u9009\u4e86\u7684\u4f4d\u7f6e\u5bf9 $V_i,V_j$ \u7684\u8d21\u732e\u3002\u6b64\u65f6 $i$ \u548c $j$ \u7684 $x,y$ \u5747\u76f8\u7b49\uff0c\u53c8\u56e0\u4e3a $a_i>a_j$\uff0c\u6240\u4ee5 $V_i>V_j$\u3002\u518d\u8003\u8651\u5728 $i,j$ \u4e4b\u95f4\u7684\u4f4d\u7f6e\u3002\u8bbe\u8fd9\u4e2a\u4f4d\u7f6e\u4e3a $wz$\uff0c\u8003\u8651\u5b83\u5bf9 $V_i,V_j$ \u7684\u8d21\u732e\u3002\u5b83\u5bf9 $V_i$ \u7684\u8d21\u732e\u4e3a $a_{wz}$\uff0c\u5bf9 $V_j$ \u7684\u8d21\u732e\u4e3a $a_j$\u3002\u56e0\u4e3a $wz$ \u6bd4 $i$ \u5148\u9009\uff0c\u4e14\u4e4b\u524d\u7684\u65f6\u5019\u5f15\u7406\u6210\u7acb\uff0c\u6240\u4ee5 $a_{wz} \\ge a_i >a_j$\uff0c\u56e0\u6b64\u5b83\u5bf9 $V_i$ \u7684\u8d21\u732e\u6bd4\u5bf9 $V_j$ \u7684\u8d21\u732e\u8981\u5927\u3002\u56e0\u6b64\u4e00\u5b9a\u6709 $V_i>V_j$\uff0c\u5047\u8bbe\u4e0d\u6210\u7acb\uff0c\u6545\u5f15\u7406\u5f97\u8bc1\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u8bc1\u660e\u8d2a\u5fc3\u7684\u6b63\u786e\u6027\u3002\u5047\u8bbe\u8d2a\u5fc3\u4e0d\u6210\u7acb\uff0c\u4e4b\u524d\u9009\u7684\u4f4d\u7f6e\u96c6\u5408 $A$ \u662f\u67d0\u4e00\u4e2a\u6700\u4f18\u96c6\u5408\u7684\u5b50\u96c6\uff0c\u8bbe $A$ \u7684\u8865\u96c6\u4e3a $B$\uff08$A\\bigcup B$ \u662f\u4e00\u4e2a\u6700\u4f18\u96c6\u5408\uff09\u3002\u5f53\u524d\u9009\u4e86\u8d21\u732e\u6700\u5927\u7684\u4f4d\u7f6e $x$\uff0c\u4e14 $A\\bigcup \\{x\\}$ \u4e0d\u662f\u4efb\u610f\u4e00\u4e2a\u6700\u4f18\u5b50\u5e8f\u5217\u4f4d\u7f6e\u7684\u5b50\u96c6\u3002\u663e\u7136 $x \\notin B$\u3002\u63a5\u4e0b\u6765\u4f7f\u7528\u8c03\u6574\u6cd5\u8bc1\u660e\uff0c\u5373\u5c06 $B$ \u4e2d\u7684\u4e00\u4e2a\u5143\u7d20 $y$ \u5220\u6389\u6362\u6210 $x$\uff0c\u8bc1\u660e\u8c03\u6574\u540e\u4e0d\u52a3\u4e8e\u4e4b\u524d\u3002\u8003\u8651\u5220\u6389 $y$ \u540e\u518d\u5206\u522b\u5c1d\u8bd5\u6dfb\u52a0 $y$ \u548c $x$\uff0c\u770b\u65b0\u589e\u7684\u8d21\u732e\u662f\u591a\u5c11\u3002\u65b0\u589e\u7684\u8d21\u732e\u53ef\u4ee5\u62c6\u6210\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u662f\u539f\u6709 $A$ \u96c6\u5408\u7684\u8d21\u732e\uff0c\u53e6\u4e00\u90e8\u5206\u662f $B$ \u96c6\u5408\u7684\u8d21\u732e\uff08\u6bd4\u5982\uff0c\u8bbe $A$ \u96c6\u5408\u4e2d\u5728 $x$ \u524d\u9762\u7684\u5143\u7d20\u6709 $cnt_A$ \u4e2a\uff0c\u5728 $x$ \u540e\u9762\u7684\u6570\u4e4b\u548c\u4e3a $sum_A$\uff0c$cnt_B,sum_B$ \u540c\u7406\uff0c\u5219 $x$ \u7684\u8d21\u732e\u4e3a $a_x \\cdot (cnt_A+cnt_B+1) + sum_A+sum_B=(a_x \\cdot (cnt_A+1)+sum_A)+a_x \\cdot cnt_B+sum_B$\uff09\u3002\u56e0\u4e3a $x$ \u662f\u5bf9\u4e8e $A$ \u96c6\u5408\u8d21\u732e\u6700\u5927\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5 $x$ \u5bf9\u4e8e $A$ \u96c6\u5408\u7684\u8d21\u732e\u6bd4 $y$ \u5927\uff0c\u5373\u4e0a\u9762\u5f0f\u5b50\u4e2d\u7684\u524d\u534a\u90e8\u5206 $x$ \u6bd4 $y$ \u5927\u3002\u73b0\u5728\u53ea\u9700\u8981\u8003\u8651\u540e\u534a\u90e8\u5206\u7684\u5927\u5c0f\u5173\u7cfb\u3002\n\n\u8003\u8651\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- \u82e5 $B$ \u4e2d\u6709\u5728 $x$ \u524d\u9762\u7684\u5143\u7d20\uff0c\u8bbe\u5728 $x$ \u524d\u9762\u4e14\u6700\u9760\u540e\u7684\u5143\u7d20\u4e3a $y$\u3002\u6839\u636e\u5f15\u7406\uff0c$a_y \\le a_x$\u3002\u800c\u4e14\uff0c\u56e0\u4e3a $x$ \u4e0e $y$ \u5728 $B\\bigcup{x}$ \u96c6\u5408\u4e2d\u662f\u76f8\u90bb\u7684\uff0c\u6240\u4ee5\u4e24\u8005\u7684 $cnt_B,sum_B$ \u5747\u76f8\u7b49\u3002\u6240\u4ee5 $a_x \\cdot cnt_B + sum_B \\ge a_y \\cdot cnt_B+sum_B$\uff0c\u56e0\u6b64 $x$ \u5bf9 $B$ \u96c6\u5408\u7684\u8d21\u732e\u6bd4 $y$ \u5bf9 $B$ \u96c6\u5408\u7684\u8d21\u732e\u5927\u3002\n- \u82e5 $B$ \u4e2d\u6ca1\u6709\u5728 $x$ \u524d\u9762\u7684\u5143\u7d20\uff0c\u5219\u6b64\u65f6 $cnt_B=0$\u3002\u8bbe\u5728 $x$ \u540e\u9762\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e3a $y$\uff0c\u90a3\u4e48\u540c\u7406\uff0c\u4e24\u8005\u7684 $cnt_B,sum_B$ \u5747\u76f8\u7b49\u4e14 $cnt_B=0$\u3002\u56e0\u6b64 $x$ \u5bf9 $B$ \u96c6\u5408\u7684\u8d21\u732e\u4e0e $y$ \u5bf9 $B$ \u96c6\u5408\u7684\u8d21\u732e\u76f8\u7b49\u3002\n\n\u7efc\u4e0a\uff0c$x$ \u5bf9\u4e24\u4e2a\u96c6\u5408\u7684\u8d21\u732e\u5747\u6bd4 $y$ \u5927\uff0c\u56e0\u6b64\u8c03\u6574\u540e\u4e0d\u52a3\u4e8e\u4e4b\u524d\uff0c\u5047\u8bbe\u4e0d\u6210\u7acb\uff0c\u6545\u8d2a\u5fc3\u662f\u6b63\u786e\u7684\u3002\n\n\u8003\u8651\u56de\u5230 dp \u4e0a\u6765\u3002\u6709\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5bf9\u4e8e $\\forall 1 \\le i \\le n,\\exists 1 \\le k \\le i$ \u6ee1\u8db3\uff1a\n\n$$dp_{i,j} = \\begin{cases}dp_{i-1,j} \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ j <k \\\\ dp_{i-1,j-1}+a_i \\cdot j \\ \\ \\ \\ \\ \\ \\ \\ \\ \\!j \\ge k\\end{cases}$$\n\n\u8fd9\u4e2a\u7ed3\u8bba\u53ef\u4ee5\u7528\u8d2a\u5fc3\u7684\u6b63\u786e\u6027\u6765\u8bc1\u660e\u3002\u8003\u8651\u7528\u8d2a\u5fc3\u9009\u62e9\u524d $i$ \u4e2a\u6570\u3002$k$ \u5b9e\u9645\u4e0a\u5c31\u662f $i$ \u5728\u8d2a\u5fc3\u4e2d\u88ab\u9009\u62e9\u7684\u65f6\u523b\uff0c\u6839\u636e\u8d2a\u5fc3\u7684\u6b63\u786e\u6027\uff0c\u5f53\u524d\u88ab\u9009\u4e86\uff0c\u4ee5\u540e\u5c31\u4e00\u76f4\u4f1a\u88ab\u9009\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u7ef4\u62a4 $dp$ \u6570\u7ec4\u3002\u9996\u5148 $i$ \u8fd9\u4e00\u7ef4\u6ca1\u6709\u7528\u4e86\u3002\u53ef\u4ee5\u4e8c\u5206\u627e\u5230 $k$\uff0c\u4e4b\u540e\u5c31\u76f8\u5f53\u4e8e\u5728 $k$ \u8fd9\u4e2a\u4f4d\u7f6e\u63d2\u5165\u4e00\u4e2a $dp_{k-1}+a_i \\cdot k$\uff0c\u5e76\u5728\u540e\u9762\u52a0\u4e0a\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\u53ef\u4ee5\u4f7f\u7528\u5e73\u8861\u6811\u6765\u7ef4\u62a4\u3002\n\n\u4f46\u662f\u66f4\u597d\u7684\u65b9\u6cd5\u662f\u7ef4\u62a4\u5dee\u5206\u6570\u7ec4\u3002\u8fd9\u6837\u53ea\u9700\u8981\u7ef4\u62a4\u533a\u95f4\u52a0\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u7ec6\u8282\u7279\u522b\u5c11\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nmt19937 rnd(time(0));\nint n; int a[500010];\nint tot=0,root=0;\nstruct Fhq_tree\n{\n\tint x,pri,siz;\n\tint lson,rson;\n\tint tag;\n} tree[500010];\nint get_new(int x)\n{\n\ttree[++tot]={x,(int)rnd(),1,0,0,0};\n\treturn tot;\n}\nvoid push_up(int now)\n{\n\ttree[now].siz=tree[tree[now].lson].siz+tree[tree[now].rson].siz+1;\n}\nvoid push_down(int now)\n{\n\ttree[tree[now].lson].x+=tree[now].tag,tree[tree[now].lson].tag+=tree[now].tag;\n\ttree[tree[now].rson].x+=tree[now].tag,tree[tree[now].rson].tag+=tree[now].tag;\n\ttree[now].tag=0;\n}\nvoid split(int now,int x,int siz,int &l,int &r)\n{\n\tif(now==0) return l=r=0,void();\n\tpush_down(now);\n\tint gtsiz=siz+tree[tree[now].lson].siz+1;\n\tif(tree[now].x>x*gtsiz) l=now,split(tree[now].rson,x,gtsiz,tree[now].rson,r);\n\telse r=now,split(tree[now].lson,x,siz,l,tree[now].lson);\n\tpush_up(now);\n}\nint merge(int l,int r)\n{\n\tif(l==0 || r==0) return l+r;\n\tpush_down(l),push_down(r);\n\tif(tree[l].pri<tree[r].pri)\n\t{\n\t\ttree[l].rson=merge(tree[l].rson,r);\n\t\treturn push_up(l),l;\n\t}\n\telse\n\t{\n\t\ttree[r].lson=merge(l,tree[r].lson);\n\t\treturn push_up(r),r;\n\t}\n}\nint sum=0,ans=0;\nvoid get_ans(int now)\n{\n\tpush_down(now);\n\tif(tree[now].lson!=0) get_ans(tree[now].lson);\n\tsum+=tree[now].x,ans=max(ans,sum);\n\tif(tree[now].rson!=0) get_ans(tree[now].rson);\n}\nsigned main()\n{\n\tios::sync_with_stdio(false),cin.tie(0);\n\tcin>>n;\n\tfor(int i=1; i<=n; ++i)\n\t{\n\t\tcin>>a[i];\n\t\tint l,r; split(root,a[i],0,l,r);\n\t\ttree[r].x+=a[i],tree[r].tag+=a[i];\n\t\tint k=tree[l].siz+1;\n\t\troot=merge(merge(l,get_new(a[i]*k)),r);\n\t}\n\tget_ans(root); cout<<ans;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1683035840,
        "uid": 353688,
        "name": "\u738b\u7199\u6587",
        "ccfLevel": 0,
        "title": "CF573E \u9898\u89e3"
    },
    {
        "content": "### $\\mathcal O(n^2)$ \u505a\u6cd5\n\u8bbe $ f(i, j)$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u9009\u4e86 $j$ \u4e2a\u6570\u6240\u80fd\u7ec4\u6210\u7684\u5e8f\u5217\u7684\u6700\u5927\u4ef7\u503c\u3002\n\n\u663e\u7136\u6709\u8f6c\u79fb\uff1a\n$$\nf(i, j) = \\max(f(i - 1, j), f(i  -1, j - 1) + a_i \\times j)\n$$\n\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O (n^2)$\u3002\n### $\\mathcal O(n\\sqrt{n})$ \u505a\u6cd5\n\u6709\u4e00\u4e2a\u8d2a\u5fc3\u7684\u7ed3\u8bba\uff1a\n\n\u6211\u4eec\u4f9d\u6b21\u52a0\u5165\u6bcf\u4e2a\u6570\uff0c\u5bf9\u4e8e $\\forall \\text{ }i$\uff0c\u4f4d\u7f6e $i$ \u7684\u8d21\u732e\u4e3a $V_i=k_i \\times a_i+b_i$\uff0c\u5176\u4e2d $k_i$ \u4e3a\u4f4d\u7f6e $i$ \u4e4b\u524d\u88ab\u9009\u7684\u6570\u7684\u4e2a\u6570\u52a0\u4e00\uff0c$b_i$ \u4e3a $i$ \u4e4b\u540e\u88ab\u9009\u7684\u6570\u7684\u548c\u3002\u90a3\u4e48\u6211\u4eec\u6bcf\u6b21\u9009\u8d21\u732e\u6700\u5927\u7684\u4f4d\u7f6e\u5f97\u5230\u7684\u5e8f\u5217\u5747\u4e3a\u8be5\u5e8f\u5217\u5927\u5c0f\u4e0b\u7684\u6700\u4f18\u89e3\u3002\n\n\u5f15\u7406 1. \u5728\u4e0a\u8ff0\u8d2a\u5fc3\u7b56\u7565\u4e0b\uff0c\u5982\u679c $a_i>a_j$ \u4e14 $i<j$\uff0c\u5219\u9009 $i$ \u4e4b\u524d\u4e0d\u53ef\u80fd\u9009 $j$\u3002\n\n \u8003\u8651\u5f52\u7eb3\u8bc1\u660e\uff1a\u5047\u8bbe\u5f15\u7406 1 \u4e0d\u6210\u7acb\uff0c\u8003\u8651\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u6211\u4eec\u7b2c\u4e00\u6b21\u8fdd\u53cd\u8fd9\u4e2a\u5f15\u7406\u7684\u64cd\u4f5c\u3002\u5982\u679c $i$ \u548c $j$ \u4e4b\u95f4\u4e0d\u5b58\u5728\u5df2\u7ecf\u53d6\u4e86\u7684\u5143\u7d20\uff0c\u90a3\u4e48\u7531\u4e8e $a_i > a_j$\uff0c$i$ \u7684\u8d21\u732e\u5fc5\u7136\u6bd4 $j$ \u5927\uff08$k$ \u548c $b$ \u90fd\u76f8\u7b49\uff09\uff1b\u5426\u5219\uff0c\u5bf9\u4e8e $i$ \u548c $j$ \u4e4b\u95f4\u5b58\u5728\u5df2\u7ecf\u53d6\u4e86\u7684\u5143\u7d20 $x$\uff0c\u7531\u4e8e $i, j$ \u662f\u7b2c\u4e00\u6b21\u8fdd\u53cd\u5f15\u7406\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5 $a_x \\geq a_i$\uff0c\u6240\u4ee5 $a_x \\geq a_i > a_j$\uff0c\u53c8\u8003\u8651\u5230  $x$ \u5bf9 $V_i$ \u7684\u8d21\u732e\u662f $a_x$\uff0c$x$ \u5bf9 $V_j$ \u7684\u8d21\u732e\u662f $a_j$\uff0c\u6545 $V_i > V_j$\uff0c\u4e0d\u53ef\u80fd\u5148\u9009\u62e9 $j$\uff0c\u7531\u6b64\u53ef\u77e5\uff0c$i, j$ \u4e0d\u662f\u7b2c\u4e00\u6b21\u8fdd\u53cd\u8fd9\u4e2a\u5f15\u7406\u7684\u64cd\u4f5c\uff0c\u5047\u8bbe\u4e0d\u6210\u7acb\uff0c\u6545\u5f15\u7406 1 \u5f97\u8bc1\u3002\n\n\u4e0b\u9762\u8bc1\u660e\u4e0a\u9762\u7684\u8d2a\u5fc3\u3002\n\n\u5047\u8bbe\u4e0d\u6210\u7acb\uff0c\u6211\u4eec\u8003\u8651\u7b2c\u4e00\u4e2a\u4e0d\u6ee1\u8db3\u8fd9\u4e2a\u8d2a\u5fc3\u7684\u65f6\u523b\uff0c\u5bf9\u4e8e\u67d0\u4e2a\u5927\u5c0f $s$\uff0c\u4ee4\u96c6\u5408 $A$ \u8868\u793a\u8be5\u65f6\u523b\u4e4b\u524d\u5df2\u7ecf\u9009\u53d6\u7684\u5143\u7d20\u96c6\u5408\uff0c\u5b58\u5728 $B(A \\bigcap B = \\varnothing)$ \u548c\u5f53\u524d\u4ef7\u503c\u6700\u5927\u7684 $V_x(x \\notin A, x \\notin B)$\uff0c\u4f7f\u5f97 $A \\bigcup x$ \u4e0d\u662f\u4efb\u4f55\u4e00\u4e2a\u5927\u5c0f\u4e3a $s$ \u7684\u6700\u4f18\u89e3\u7684\u5b50\u96c6\uff0c\u4e14 $A \\bigcup B$ \u662f\u4e00\u4e2a\u5927\u5c0f\u4e3a $s$ \u7684\u6700\u4f18\u89e3\u3002\u8003\u8651\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. \u5982\u679c $B$ \u4e2d\u5b58\u5728\u4f4d\u7f6e\u5728 $x$ \u7684\u5de6\u8fb9\uff0c\u8003\u8651\u5728 $x$ \u7684\u5de6\u8fb9\u7684\u6700\u53f3\u4f4d\u7f6e $y$\uff0c\u6839\u636e\u5f15\u7406 1\uff0c\u6b64\u65f6\u6709 $a_y \\leq a_x$\uff0c$V_x \\geq V_y$\u3002\u6b64\u65f6\u52a0\u5165\u96c6\u5408 $B$ \u4e2d\u7684\u5176\u4ed6\u5143\u7d20\uff0c\u6211\u4eec\u8003\u8651 $V_x,V_y$ \u7684\u53d8\u5316\uff0c\u90a3\u4e48\u5728 $x$ \u53f3\u8fb9\u7684\u5143\u7d20\u5bf9 $V_x,V_y$ \u7684\u8d21\u732e\u4e00\u6837\uff0c\u5728 $y$ \u5de6\u8fb9\u7684\u5143\u7d20\u5bf9 $V_x,V_y$ \u7684\u8d21\u732e\u662f $a_x,a_y$\uff0c\u800c $x,y$ \u4e2d\u95f4\u6ca1\u6709\u5728 $B$ \u4e2d\u7684\u5143\u7d20\uff0c\u6240\u4ee5\u53ef\u4ee5\u53d1\u73b0\u5728\u5176\u4ed6\u5143\u7d20\u52a0\u5165\u4e4b\u540e $V_x \\geq V_y$\uff0c\u6240\u4ee5\u5c06 $B$ \u4e2d $y$ \u6362\u6210 $x$ \u7ed3\u679c\u4e0d\u52a3\u3002\n2. \u5982\u679c $B$ \u4e2d\u53ea\u6709\u5728 $x$ \u53f3\u8fb9\u7684\u5143\u7d20\uff0c\u8003\u8651\u5728 $x$ \u53f3\u8fb9\u7684\u6700\u5de6\u4f4d\u7f6e $y$\uff0c\u90a3\u4e48 $B$ \u96c6\u5408\u5176\u4ed6\u7684\u5143\u7d20\u5bf9 $V_x,V_y$ \u7684\u8d21\u732e\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u628a $y$ \u6362\u6210 $x$ \u4e5f\u4e0d\u4f1a\u66f4\u52a3\u3002\n\n\u6545\u4e0a\u8ff0\u5047\u8bbe\u4e0d\u6210\u7acb\uff0c\u8d2a\u5fc3\u6b63\u786e\u6027\u8bc1\u6bd5\u3002\n\n\u8003\u8651\u5206\u5757\u7ef4\u62a4\u51f8\u5305\u4ece\u800c\u7ef4\u62a4\u6700\u5927\u503c\u3002\n\u6bcf\u6b21\u9009\u5b8c\u6700\u5927\u503c\uff0c\u5c31\u76f8\u5f53\u4e8e\u5bf9\u4e8e\u9009\u5b9a\u7684 $pos$\uff0c$pos$ \u524d\u7684\u4f4d\u7f6e $i$ \u4e2d $b_i$ \u5747\u52a0\u4e0a $a_{pos}$\uff0c$pos$ \u540e\u7684\u4f4d\u7f6e $i$ \u4e2d $k_i$ \u5747\u52a0\u4e0a\u4e00\u3002\u56e0\u4e3a\u5bf9\u4e8e\u540c\u4e00\u5757\u6211\u4eec\u52a0\u4e0a\u7684 $k,b$ \u662f\u4e00\u6837\u7684\uff0c\u800c $pos$ \u6240\u5728\u7684\u5757\u53ef\u4ee5 $\\sqrt{n}$ \u66b4\u529b\u91cd\u6784\u51f8\u5305\uff0c\u5e76\u5c06 $pos$ \u8d4b\u4e3a\u8d1f\u65e0\u7a77\u3002\u6211\u4eec\u9700\u8981\u5728\u6539\u53d8 $k$ \u7684\u60c5\u51b5\u4e0b\u7ef4\u62a4\u82e5\u5e72\u4e00\u6b21\u51fd\u6570 $k \\times a_i + b_i$ \u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728\u51f8\u5305\u4e0a\u4e09\u5206\u5f97\u5230\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\sqrt{n}\\log n)$\u3002\n\n\u7531\u4e8e $k \\times a_i + b_i$ \u4e2d\u7684 $k$ \u662f\u5355\u8c03\u4e0d\u964d\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u6307\u9488\u4ee3\u66ff\u4e09\u5206\uff0c\u5176\u6b21\uff0c\u91cd\u6784\u51f8\u5305\u65f6\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u5bf9\u70b9\u96c6\u8fdb\u884c\u6392\u5e8f\uff0c\u6ce8\u610f\u5230 $a_i$ \u662f\u4e0d\u53d8\u7684\uff0c\u521d\u59cb\u65f6\u6392\u5e8f\u4e00\u6b21\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log n + n \\sqrt{n})$\u3002\n\n### $\\mathcal O(n \\log n)$ \u505a\u6cd5\n\u6709\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5bf9\u4e8e $\\forall \\text{ }i \\in [1, n], \\exists \\text{ }k\\in[1, i]$ \u6ee1\u8db3\uff1a\n$$\nf(i, j)=\n\\begin{cases}\n\nf(i - 1, j) & j \\in [0, k - 1] \\\\\n\nf(i - 1, j - 1) + a_i \\times j & j \\in [k, i]\n\n\\end{cases}\n$$\n\u8bbe $F(i, j)$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u9009\u4e86 $j$ \u4e2a\u6570\uff0c\u7ec4\u6210\u7684\u5e8f\u5217\u4e2d**\u6700\u5927\u4ef7\u503c**\u7684\u67d0\u79cd\u65b9\u6848\u7684**\u4e0b\u6807\u96c6\u5408**\u3002\n\n\u6839\u636e\u524d\u9762\u7684\u8d2a\u5fc3\u7ed3\u8bba\uff0c\u82e5 $i \\in F(i, j)$ \u5219\u4e00\u5b9a\u5b58\u5728\u4e00\u79cd\u65b9\u6848\u4f7f\u5f97 $i \\in F(i, j + 1)$\uff0c\u8fd9\u4e5f\u5c31\u8bc1\u660e\u4e86\u4e0a\u8ff0\u7ed3\u8bba\u3002\n\n\u9996\u5148\u53ef\u4ee5\u53bb\u6389\u7b2c\u4e00\u7ef4\uff0c\u8003\u8651\u4e8c\u5206\u51fa $k$\uff0c\u89c2\u5bdf\u8f6c\u79fb\u5f0f\u5b50\uff0c\u76f8\u5f53\u4e8e\u5728\u67d0\u5904\u63d2\u5165\u4e00\u4e2a\u65b0\u503c\uff0c\u7136\u540e\u7ed9\u540e\u9762\u4e00\u90e8\u5206\u52a0\u4e0a\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u6240\u4ee5\u7528\u5e73\u8861\u6811\u6765\u5b9e\u73b0\u5373\u53ef\u3002\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u5728\u5e73\u8861\u6811\u4e0a\u4e8c\u5206\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nconst int N = 1e6 + 10;\ntemplate < typename T >\ninline void read(T &cnt)\n{\n    cnt = 0; char ch = getchar(); bool op = 1;\n    for (; ! isdigit(ch); ch = getchar())\n        if (ch == '-') op = 0;\n    for (; isdigit(ch); ch = getchar())\n        cnt = cnt * 10 + ch - 48;\n    cnt = op ? cnt : - cnt;\n}\n\nint n, a[N];\nlong long D, P, ans;\n\nnamespace FHQ\n{ \n    // fhq treap \u7ef4\u62a4\u9996\u9879 a0 \u516c\u5dee d\n    // \u4ee5\u53ca\u5f53\u524d\u503c val \u548c\u5f53\u524d\u533a\u95f4\u6700\u53f3\u8fb9\u7684\u503c rval\n    struct treap\n    {\n        int lc, rc, siz; int rnd;\n        long long val, rval, a0, d;\n    } t[N];\n\n    int root, tot;\n\n    inline int New(long long x)\n    {\n        ++ tot; t[tot].siz = 1; \n        t[tot].rnd = rand();\n        t[tot].val = t[tot].rval = x;\n        t[tot].a0 = t[tot].d = 0;\n        t[tot].lc = t[tot].rc = 0;\n        return tot;\n    }\n\n    inline void upd(int p)\n    {\n        t[p].siz = t[t[p].lc].siz + t[t[p].rc].siz + 1;\n        t[p].rval = t[p].rc ? t[t[p].rc].rval : t[p].val;\n    }\n\n    inline void addAll(int p, long long a0, long long d)\n    {\n        // a0 \u8868\u793a\u524d\u4e00\u4e2a \u5373 p \u5b50\u6811\u52a0\u7684\u503c\u5206\u522b\u4e3a a0 + d, a0 + 2d ...\n        t[p].val += a0 + (t[t[p].lc].siz + 1) * d;\n        t[p].rval += a0 + (t[p].siz) * d;\n        t[p].a0 += a0; t[p].d += d;\n    }\n    inline void psd(int p)\n    {\n        addAll(t[p].lc, t[p].a0, t[p].d);\n        addAll(t[p].rc, t[p].a0 + 1ll * (t[t[p].lc].siz + 1) * t[p].d, t[p].d);\n        t[p].a0 = t[p].d = 0;\n    }\n    inline void split(int p, int k, int &x, int &y)\n    {\n        if (! p) \n        {\n            x = y = 0;\n            return;\n        }\n        psd(p);\n        if (t[t[p].lc].siz >= k)\n        {\n            y = p;\n            split(t[p].lc, k, x, t[p].lc);\n        }\n        else\n        {\n            x = p;\n            split(t[p].rc, k - t[t[p].lc].siz - 1, t[p].rc, y);\n        } \n        upd(p);\n    }\n\n    inline int merge(int x, int y)\n    {\n        if (! x || ! y) return x + y;\n        if (t[x].rnd > t[y].rnd)\n        {\n            psd(x);\n            t[x].rc = merge(t[x].rc, y);\n            upd(x);\n            return x;\n        }\n        else\n        {\n            psd(y);\n            t[y].lc = merge(x, t[y].lc);\n            upd(y);\n            return y;\n        }\n    }\n\n    inline void search(int id, int p, int k, long long v)\n    {\n        if (! p) return;\n        psd(p);\n        int rk = k + t[t[p].lc].siz + 1;\n        if (t[p].val >= (t[p].lc ? t[t[p].lc].rval : v) + 1ll * rk * a[id])\n        {\n            P = rk, D = t[p].val;\n            search(id, t[p].rc, rk, t[p].val);\n        }\n        else search(id, t[p].lc, k, v);\n    }\n\n    inline void insert(int pos, long long val)\n    {\n        int x = 0;\n        split(root, pos, root, x);\n        root = merge(root, New(val));\n        root = merge(root, x);\n    }\n\n    inline void modify(int pos, long long a0, int d)\n    {\n        int x = 0;\n        split(root, pos, root, x);\n        addAll(x, a0, d);\n        root = merge(root, x);\n    }\n\n    inline void dfs(int p)\n    {\n        ans = std::max(ans, t[p].val);\n        psd(p);\n        if (t[p].lc) dfs(t[p].lc);\n        if (t[p].rc) dfs(t[p].rc);\n    }\n}\n\nint main()\n{\n\n    read(n); srand(time(0));\n\n    for (int i = 1; i <= n; ++ i)\n    {\n        read(a[i]); D = P = 0; FHQ::search(i, FHQ::root, 0, 0);\n        FHQ::insert(P, D); FHQ::modify(P, P * a[i], a[i]);\n        // \u63d2\u5165\u4e00\u4e2a\u6570 \u4ee5\u53ca \u5c06\u4e00\u4e2a\u533a\u95f4\u52a0\u4e0a\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\n    }\n\n    FHQ::dfs(FHQ::root);\n\n    std::cout << ans << std::endl;\n    return 0;\n}\n```",
        "postTime": 1649254135,
        "uid": 128195,
        "name": "chzhc",
        "ccfLevel": 7,
        "title": "CF573E Bear and Bowling"
    },
    {
        "content": "~~\u545c\uff0c\u672c\u4eba\u9996\u7bc7\u9ed1\u9898\u9898\u89e3\u3002~~\n\n\u9898\u89e3\u9635\u5bb9\u771f\u5413\u4eba\uff0c\u56db\u7bc7\u6709\u4e09\u7bc7\u662f\u7ba1\u7406\u5199\u7684\uff08\n\n\u9898\u610f\uff1a\u5373\u6c42 $\\max\\{\\sum\\limits_{i=1}^{m}ib_i\\}$\uff0c $b$ \u4e3a $a$ \u7684\u5b50\u5e8f\u5217\u3002\n\n\u4e00\u4e2a\u6bd4\u8f83\u663e\u7136\u7684 dp \u601d\u8def\uff08\u653e\u5728\u666e\u53ca\u4e5f\u5c31T1/T2\u7684\u6837\u5b50\uff09\uff1a\u6211\u4eec\u8bbe $dp_{i,j}$ \u8868\u793a**\u524d $i$ \u4e2a\u6570\u5df2\u7ecf\u9009\u4e86 $j$ \u4e2a\u6570\u7684\u6700\u5927\u7b54\u6848**\uff0c\u5bb9\u6613\u63a8\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$dp_{i,j}=\\max\\{dp_{i-1,j},dp_{i-1,j-1}+s_i\\times j\\}$$\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a dp \u662f $O(n^2)$ \u7684\uff0c\u8003\u8651\u5404\u79cd~~\u5947\u6280\u6deb\u5de7~~\u4f18\u5316\u3002\n\n\u6211\u4eec\u8003\u8651 $\\max$ \u5f0f\u5b50\u91cc\u9762\u7684\u4e24\u4e2a\u5143\u7d20 $dp_{i-1,j}$ \u548c $dp_{i-1.j-1}+s_i\\times j$ \n\n\u5173\u952e\u6765\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e24\u4e2a\u5404\u4e3a\u4e00\u4e2a**\u51f8\u51fd\u6570**\uff08\u5982\u679c\u628a\u4ed6\u4eec\u5728 $i$ \u4e0a\u7684\u53d6\u503c\u63cf\u6210\u70b9\u8fde\u8d77\u6765\u7684\u8bdd\uff09\uff0c\u5e76\u4e14\u8fd9\u4e24\u4e2a\u56fe\u50cf**\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u4ea4\u70b9**\uff0c\u56e0\u4e3a\u53f3\u5f0f\u76f8\u5f53\u4e8e\u5728\u5de6\u5f0f\u7684\u57fa\u7840\u4e0a\u5411\u53f3\u5e73\u79fb\u5e76\u589e\u52a0\u4e00\u4e2a\u53d8\u5316\u7684\u7387\uff08\u6709\u70b9\u7c7b\u4f3c\u4e8e\u52a0\u901f\u5ea6\uff09\u3002\n\n\u5f62\u8c61\u6765\u8bf4\uff0c\u8fd9\u4e24\u4e2a\u7684\u56fe\u50cf\u5927\u81f4\u662f\u8fd9\u6837\u7684\uff1a\n\n![\u622a\u5c4f2021-07-25 \u4e0b\u53483.39.55.png](https://i.loli.net/2021/07/25/wKm34IRa2D5Oigl.png)\n\n\uff08\u8bf7\u539f\u8c05\u4f5c\u8005\u7684\u50bb\u903c\u753b\u56fe\u6280\u672f\uff09\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u6765\u4e8c\u5206\u8fd9\u4e2a\u5177\u6709\u53ef\u4e8c\u5206\u6027\u7684\u4ea4\u70b9\u3002\u5728\u8fd9\u4e2a\u4ea4\u70b9\u4e4b\u524d\uff0c\u6211\u4eec\u53d6 $dp_{i,j}=dp_{i-1,j}$ \uff1b\u4e4b\u540e\uff0c\u6211\u4eec\u53d6 $dp_{i,j}=dp{i-1,j-1} + s_i \\times j$ \u3002\n\n\u7136\u540e\u5462\uff1f\u7531\u4e8e\u5f0f\u5b50\u7684\u8f6c\u79fb\u5b9e\u9645\u4e0a\u662f\u7ed9\u5f53\u524d\u7684\u533a\u95f4\u52a0\u4e0a\u4e86\u4e00\u4e2a\u7b49\u5dee\u5e8f\u5217\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u7528**\u5e73\u8861\u6811**\u6765\u7ef4\u62a4\u4e86\uff0c\u968f\u4fbf\u5565\u90fd\u884c\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nnamespace mystd {// \u5feb\u8bfb & \u5feb\u8f93\n    inline int read() {\n        int w = 1, q = 0;\n        char ch = ' ';\n        while (ch != '-' && (ch < '0' || ch > '9')) ch = getchar();\n        if (ch == '-') w = -1, ch = getchar();\n        while (ch >= '0' && ch <= '9') q = q * 10 + ch - '0', ch = getchar();\n        return w * q;\n    }\n    inline void write(int x) {\n        if (x < 0) {\n            x = ~(x - 1);\n            putchar('-');\n        }\n        if (x > 9) write(x / 10);\n        putchar(x % 10 + '0');\n    }\n}\nusing namespace std;\nusing namespace mystd;\n\nconst int maxn = 1e5 + 100;\nint n, s[maxn];\nstruct fhq_treap {// \u7528 fhq-treap \u6765\u7ef4\u62a4\u533a\u95f4\u64cd\u4f5c\n    int rt, tot;\n    fhq_treap() { rt = 1; }\n    int sz[maxn], ch[maxn][2], rd[maxn], lz1[maxn], lz2[maxn], val[maxn];\n    #define ls(x) ch[x][0]\n    #define rs(x) ch[x][1]\n    void pushup(int x) { sz[x] = sz[ls(x)] + sz[rs(x)] + 1; }\n    void down(int x, int l1, int l2) { if (x) lz1[x] += l1, lz2[x] += l2, val[x] += l1 * (sz[ls(x)] + 1) + l2; }\n    void pushdown(int x) { if (lz1[x] || lz2[x]) down(ls(x), lz1[x], lz2[x]), down(rs(x), lz1[x], lz2[x] + lz1[x] * (sz[ls(x)] + 1)), lz1[x] = lz2[x] = 0; }\n    void make(int v) {\n        sz[++tot] = 1;\n        val[tot] = v;\n        rd[tot] = rand();\n    }\n    int merge(int x, int y) {// \u5408\u5e76\n        if (!x || !y) return x + y;\n        else {\n            pushdown(x);\n            pushdown(y);\n            if (rd[x] >= rd[y]) {\n                ls(y) = merge(x, ls(y));\n                pushup(y);\n                return y;\n            } else {\n                rs(x) = merge(rs(x), y);\n                pushup(x);\n                return x;\n            }\n        }\n    }\n    void split(int p, int k, int &x, int &y) {// \u5206\u88c2\n        if (!p) x = y = 0;\n        else {\n            pushdown(p);\n            if (k > sz[ls(p)]) x = p, split(rs(p), k - sz[ls(p)] - 1, rs(x), y), pushup(x);\n            else y = p, split(ls(p), k, x, ls(y)), pushup(y);\n        }\n    }\n    int get_val(int p, int k) {\n        pushdown(p);\n        if (k <= sz[ls(p)]) return get_val(ls(p), k);\n        else {\n            if (k > sz[ls(p)] + 1) return get_val(rs(p), k - sz[ls(p)] - 1);\n            else return val[p];\n        }\n    }\n    int get_ans(int x) {\n        if (!x) return 0;\n        else {\n            pushdown(x);\n            return max(max(get_ans(ls(x)), get_ans(rs(x))), val[x]);\n        }\n    }\n    void ins(int k, int c) {\n        int s, t;\n        split(rt, k, s, t);\n        make(c);\n        rt = merge(s, merge(tot, t));\n    }\n    void upd(int p, int x, int y) {\n        int s, t;\n        split(rt, p, s, t);\n        down(t, x, y);\n        rt = merge(s, t);\n    }\n} tr;\n\nsigned main() {\n    srand((unsigned)time(0));;\n    n = read();\n    tr.make(0);\n    for (int i = 1; i <= n; i++) {\n        s[i] = read();\n    }\n    for (int i = 1, l, r, res; i <= n; i++) {\n        l = 0, r = i - 1, res = i - 1;\n        while (l <= r) {// \u4e8c\u5206\u8fd9\u4e2a\u4e34\u754c\u7684\u70b9\n            int mid = (l + r) >> 1;\n            if (tr.get_val(tr.rt, mid + 1) + s[i] * (mid + 1) > tr.get_val(tr.rt, mid + 2)) {\n                res = mid;\n                r = mid - 1;\n            } else l = mid + 1;\n        }\n        int t = tr.get_val(tr.rt, res + 1);\n        tr.ins(res + 1, t);\n        tr.upd(res + 1, s[i], s[i] * res);\n    }\n    write(tr.get_ans(tr.rt));// \u8f93\u51fa\u7b54\u6848\n    return 0;\n}\n```",
        "postTime": 1627199340,
        "uid": 306573,
        "name": "Ender32k",
        "ccfLevel": 0,
        "title": "CF573E \u9898\u89e3"
    },
    {
        "content": "# \u601d\u8def\n\u6839\u636e\u9898\u610f\uff0c\u6211\u4eec\u53ef\u4ee5\u5217\u51fa\u52a8\u6001\u8f6c\u79fb\u65b9\u7a0b $dp_{i}=\\max(dp_{i-1}+i \\times a_{j})$\uff0c$dp_{x}$ \u8868\u793a\u73b0\u5728\u5b50\u5e8f\u5217\u6709 $x$ \u4e2a\u5143\u7d20\u3002\u5f88\u660e\u663e $O(n^2)$ \u8fbe\u5230  $10^{10}$\uff0c\u6b63\u5e38\u662f\u901a\u4e0d\u8fc7\u7684\uff0c\u4f46\u662f\u5b83\u8fc7\u4e86...\n\n# \u7a0b\u5e8f\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long i,j,n,x,Max,dp[100010];\nsigned main(){\n    scanf(\"%lld\",&n);\n    for (i=1;i<=n;i++) dp[i]=-1e18;\n    for (i=1;i<=n;i++){\n    \tscanf(\"%lld\",&x);\n    \tfor (j=i;j>0;j--) dp[j]=max(dp[j],dp[j-1]+j*x); \n    \t}\n    for (i=1;i<=n;i++) Max=max(Max,dp[i]);\n    printf(\"%lld\\n\",Max);\n\treturn 0;\n}\n```\n# \u540e\u8bb0\n\u4f7f\u7528\u8bed\u8a00 C++20\uff0c\u6700\u6162\u7684\u70b9\u8dd1\u4e86 3.59s\uff0c\u5bf9\u4e8e 6.00s \u7684\u65f6\u95f4\u9650\u5236\u7ef0\u7ef0\u6709\u4f59\u3002\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5feb\uff0c\u5c0f\u849f\u84bb\u4e5f\u4e0d\u77e5\u9053\uff08~~\u672c\u6765\u60f3\u5199\u66b4\u529b\u518d\u7528\u706b\u8f66\u5934\u7b49\u7b49\u4f18\u5316\u5c1d\u8bd5\u8279\u8fc7\u53bb\u4f46\u662f\u4e00\u904d\u5c31\u8fc7\u4e86\u90a3\u6863\u4e8b~~\uff09\u3002",
        "postTime": 1644576973,
        "uid": 523525,
        "name": "\u5f90\u5929\u4e7e",
        "ccfLevel": 0,
        "title": "CF573E \u9898\u89e3"
    },
    {
        "content": "## \u5206\u6790\n\n\u8bbe $f(i,j)$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u4e2d\u9009 $j$ \u4e2a\uff0c\u6700\u5927\u7684 $\\sum i\\times b_i$ \u7684\u503c\u3002\n\n\u5219 $f(i,j)=\\max\\{f(i-1,j),f(i-1,j-1)+j\\times a_i\\}$\u3002\n\n\u8fd9\u6837\u8f6c\u79fb\u662f $O(n^2)$ \u7684\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u5bf9\u4e8e\u56fa\u5b9a\u7684 $i$\uff0c\u8bbe $g(x)=f(i-1,x),h(x)=f(i-1,x-1)+x\\times a_i$\u3002\n\n\u89c2\u5bdf\u53d1\u73b0\u5b58\u5728 $k$\uff0c\u6ee1\u8db3\uff1a\n\n$\\forall j\\le k$\uff0c\u6709 $f(i,j)=g(j)$\uff1b$\\forall j>k$\uff0c\u6709 $f(i,j)=h(j)$\u3002\n\n\u53ef\u4ee5\u4e8c\u5206\u51fa\u6700\u5927\u7684\u6ee1\u8db3 $g(j)\\ge h(j)$ \u7684 $j$\uff0c\u5219 $k=j$ \u7b26\u5408\u8981\u6c42\u3002\n\n\u6240\u4ee5\u4f18\u5316\u540e\u7684\u505a\u6cd5\u662f\u8fd9\u6837\u7684\uff1a\n\n$i$ \u4ece $1$ \u5faa\u73af\u5230 $n$\uff0c\u7ef4\u62a4\u4e00\u4e2a\u5e8f\u5217 $s$\uff0c\u5176\u4e2d $s_j=f(i,j)$ \u3002\n\n\u4e8c\u5206\u51fa $k$\uff0c\u5728 $s_k$ \u540e\u9762\u63d2\u5165\u4e00\u4e2a\u503c\u4e3a $s_k$ \u7684\u5143\u7d20\uff0c\n\n\u518d\u628a\u6240\u6709 $s_t$ \u52a0\u4e0a $t\\times a$\uff0c\u5176\u4e2d $t>k$\u3002\n\n\u53ef\u4ee5\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4 $s$\uff0c\u652f\u6301\u5355\u70b9\u67e5\u8be2\u3001\u4efb\u610f\u4f4d\u7f6e\u63d2\u5165\u3001\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217\u3002\n\n\u53ef\u4ee5\u7528 FHQ-Treap \u6216 Splay\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\n\n\u8fd9\u6837\u5c31\u80fd\u8fc7\u4e86\uff0c\u4f46\u662f\u8fd8\u53ef\u4ee5\u518d\u4f18\u5316\uff01\n\n\u4e0a\u9762\u505a\u6cd5\u7684\u74f6\u9888\u5728\u4e8e\u4e8c\u5206\uff0c\u53ef\u4ee5\u7528\u7c7b\u4f3c\u4e8e\u7ebf\u6bb5\u6811\u4e8c\u5206\u7684\u65b9\u6cd5\u53bb\u6389\u4e00\u4e2a $\\log$\u3002\n\n\uff08\u611f\u8c22 @FZzzz \u5927\u4f6c\u7ed9\u4e88\u7684\u5e2e\u52a9\uff09\n\n\u5982\u679c\u8bf4\u73b0\u5728\u5728\u68c0\u67e5\u7684 $mid$ \u5728\u5e73\u8861\u6811\u4e0a\u662f $p$\uff0c\n\n\u53ea\u8981\u80fd\u627e\u5230 $mid-1$ \u5728\u5e73\u8861\u6811\u4e0a\u7684\u4f4d\u7f6e $q$\uff0c\n\n\u5c31\u80fd\u5224\u65ad\u5411\u5de6\u513f\u5b50\u8fd8\u662f\u53f3\u513f\u5b50\u9012\u5f52\u3002\n\n$q$ \u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n\u82e5 $p$ \u6709\u5de6\u513f\u5b50\uff0c\u4ece $p$ \u7684\u5de6\u513f\u5b50\u5f00\u59cb\u4e00\u76f4\u5411\u53f3\u8d70\uff0c\n\n\u76f4\u5230\u8d70\u5230\u7684\u70b9\u6ca1\u6709\u53f3\u513f\u5b50\uff0c\u8fd9\u4e2a\u70b9\u5c31\u662f $q$\u3002\n\n\u82e5 $p$ \u6ca1\u6709\u5de6\u513f\u5b50\uff0c\u8df3 $p$ \u7684\u7956\u5148\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u70b9 $sq$\uff0c\n\n\u6ee1\u8db3 $sq$ \u662f $fa(sq)$ \u7684\u53f3\u513f\u5b50\uff0c\u5219 $q=fa(sq)$\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u7ef4\u62a4\u6bcf\u4e2a\u70b9\u5f00\u59cb\u8df3\u53f3\u513f\u5b50\uff0c\u8df3\u5230\u7684\u70b9\u7684\u6743\u503c\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u9012\u5f52\u6c42\u89e3\u7684\u65f6\u5019\u5982\u679c\u8d70\u7684\u662f\u53f3\u513f\u5b50\u5c31\u8bb0\u5f55\u5f53\u524d\u70b9\u7684\u6743\u503c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u4e3a $O(n\\log n)$\u3002\n\n## \u5b9e\u73b0\n\n```cpp\n#include <bits/extc++.h>\n#include <bits/stdc++.h>\n#define LL long long\n#define TO(T, x) static_cast<T>(x)\n\nconst int N = 1e5 + 5;\nint n, root, x, y, key[N], size[N], lchild[N], rchild[N], tot, a, maxJ;\nLL val[N], rval[N], a0[N], d[N], ans, valJ;\nstd::mt19937 rng(20090212);\n\nint newNode(LL val) {\n  return key[++tot] = rng(), size[tot] = 1, ::val[tot] = rval[tot] = val, tot;\n}\n\nvoid pushUp(int p) {\n  size[p] = size[lchild[p]] + size[rchild[p]] + 1;\n  rval[p] = rchild[p] ? rval[rchild[p]] : val[p];\n}\n\nvoid addAll(int p, LL a0, LL d) {\n  val[p] += a0 + TO(LL, size[lchild[p]] + 1) * d;\n  rval[p] += a0 + TO(LL, size[p]) * d;\n  ::a0[p] += a0, ::d[p] += d;\n}\n\nvoid pushDown(int p) {\n  addAll(lchild[p], a0[p], d[p]);\n  addAll(rchild[p], a0[p] + TO(LL, size[lchild[p]] + 1) * d[p], d[p]);\n  a0[p] = d[p] = 0;\n}\n\nvoid split(int p, int k, int &x, int &y) {\n  if (!p) return x = y = 0, void();\n  pushDown(p);\n  if (size[lchild[p]] >= k)\n    split(lchild[y = p], k, x, lchild[p]);\n  else\n    split(rchild[x = p], k - size[lchild[p]] - 1, rchild[p], y);\n  pushUp(p);\n}\n\nint merge(int x, int y) {\n  if (!x || !y) return x + y;\n  if (key[x] > key[y])\n    return pushDown(x), rchild[x] = merge(rchild[x], y), pushUp(x), x;\n  return pushDown(y), lchild[y] = merge(x, lchild[y]), pushUp(y), y;\n}\n\nvoid search(int p, int k, LL v) {\n  if (!p) return;\n  pushDown(p);\n  int rk = k + size[lchild[p]] + 1;\n  if (val[p] >= (lchild[p] ? rval[lchild[p]] : v) + TO(LL, rk) * a)\n    maxJ = rk, valJ = val[p], search(rchild[p], rk, val[p]);\n  else\n    search(lchild[p], k, v);\n}\n\nvoid insert(int pos, LL val) {\n  split(root, pos, root, x), root = merge(merge(root, newNode(val)), x);\n}\n\nvoid modify(int pos, LL a0, int d) {\n  split(root, pos, root, x), addAll(x, a0, d), root = merge(root, x);\n}\n\nvoid dfs(int p) {\n  ans = std::max(ans, val[p]), pushDown(p);\n  if (lchild[p]) dfs(lchild[p]);\n  if (rchild[p]) dfs(rchild[p]);\n}\n\nint main() {\n  std::ios::sync_with_stdio(false), std::cin.tie(0), std::cout.tie(0);\n  std::cin >> n;\n  for (int i = 1; i <= n; i++) {\n    std::cin >> a, maxJ = valJ = 0, search(root, 0, 0);\n    insert(maxJ, valJ), modify(maxJ, TO(LL, maxJ) * a, a);\n  }\n  dfs(root), std::cout << ans << std::endl;\n  return 0;\n}\n```",
        "postTime": 1644919865,
        "uid": 253946,
        "name": "ClHg2",
        "ccfLevel": 7,
        "title": "\u300e\u9898\u89e3\u300fCF573E Bear and Bowling"
    }
]