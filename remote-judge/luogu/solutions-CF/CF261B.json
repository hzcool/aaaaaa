[
    {
        "content": "[\u6211\u7684blog](https://www.cnblogs.com/wangjunrui/p/12512412.html)\n> > \u9898\u76ee\u94fe\u63a5\uff1a[CF261B Maxim and Restaurant](https://www.luogu.com.cn/problem/CF261B)\n\n$$preface$$\n\n\u80cc\u5305DP+\u671f\u671b\u7684\u4e00\u9053\u9898\n\n$$description$$\n\n\u9898\u76ee\u7ffb\u8bd1\u6709QwQ\n\n$$solution$$\n\n\n\u6211\u4eec\u8981\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n- $$\\sum_{i=1}^{n}a[i]\\leq p$$\n- $$\\sum_{i=1}^{n}a[i]> p$$\n\n\u5bf9\u4e8e\u60c5\u51b5$1$\uff0c\u663e\u7136\u5c31\u662fn\u4e2a\u4eba\u90fd\u53ef\u4ee5\u5750\uff0c\u90a3\u4e48\u76f4\u63a5\u8f93\u51fa$n$\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u8bf7\u6b3e$2$\uff0c\n\n\u8bbe$f(i,j,k)$\u8868\u793a\u8868\u793a\u5df2\u7ecf\u5904\u7406\u5b8c\u524di\u4e2a\u4eba\u9009\u4e86j\u4e2a\u4eba\u5360\u4e86k\u8fd9\u4e48\u957f\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u7b54\u6848\u663e\u7136\u662f\uff1a\n$$ans=\\dfrac{\\sum f(n,i,j)\\times i!\\times (n-i)!}{n!}$$\n\n\u5bf9\u4e8e$f(i,j,k)$\u6211\u4eec\u6709\u4e24\u4e2a\u7b56\u7565\uff0c\u4e00\u4e2a\u662f\u9009\uff0c\u4e00\u4e2a\u662f\u4e0d\u9009\uff0c\u5f97\u51fa\uff1a\n$$f(i,j,k)=f(i-1,j-1,k-a[i])+f(i-1,j,k)$$\n\u6211\u4eec\u53d1\u73b0DP\u53ef\u4ee5\u7701\u6389\u4e00\u7ef4\n\n$$code$$\n```\n#include <cstdio>\n#include <algorithm>\n#define ll long long\n#define re register\nusing namespace std;\ntemplate<typename T>\ninline void read(T&x)\n{\n\tx=0;\n\tchar s=(char)getchar();\n\tbool f=false;\n\twhile(!(s>='0'&&s<='9'))\n\t{\n\t\tif(s=='-')\n\t\t\tf=true;\n\t\ts=(char)getchar();\n\t}\n\twhile(s>='0'&&s<='9')\n\t{\n\t\tx=(x<<1)+(x<<3)+s-'0';\n\t\ts=(char)getchar();\n\t}\n\tif(f)\n\t\tx=(~x)+1;\n}\nconst int N=55;\nint n,p,a[N],sum;\nlong long dp[N][N];\ndouble fac[N]= {1.0},ans;\nint main()\n{\n\tread(n);\n\tfor(re int i=1; i<=n; ++i)\n\t{\n\t\tread(a[i]);\n\t\tsum+=a[i];\n\t\tfac[i]=fac[i-1]*i;\n\t}\n\tread(p);\n\tif(sum<=p)\n\t{\n\t\tprintf(\"%lf\\n\",(double)n);\n\t\treturn 0;\n\t}\n\tdp[0][0]=1;\n\tfor(re int i=1; i<=n; ++i)\n\t\tfor(re int j=i; j>=1; --j)\n\t\t\tfor(re int k=p; k>=a[i]; --k)\n\t\t\t\tdp[j][k]+=dp[j-1][k-a[i]];\n\tfor(re int i=1; i<=n; ++i)\n\t{\n\t\tfor(re int j=0; j<=p; ++j)\n\t\t\tprintf(\"%lld \",dp[i][j]);\n\t\tputchar('\\n');\n\t}\n\tfor(re int i=1; i<=n; ++i)\n\t\tfor(re int j=0; j<=p; ++j)\n\t\t\tans+=(double)dp[i][j]*fac[i]*fac[n-i];\n\tprintf(\"%lf\\n\",ans/fac[n]);\n\treturn 0;\n}\n```",
        "postTime": 1584439627,
        "uid": 133322,
        "name": "QwQ\u849f\u84bbwjr",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF261B \u3010Maxim and Restaurant\u3011"
    },
    {
        "content": "\u8003\u8651\u7b54\u6848\u4e2d\u6bcf\u4e2a\u524d\u7f00\u957f\u5ea6\u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u8bbe\u524d\u7f00\u957f\u5ea6$i$\u5728\u7b54\u6848\u4e2d\u51fa\u73b0$g[i]$\u6b21\uff0c\u663e\u7136\u6709\uff1a\n$$\n\\sum_{i=0}^ng[i]=n!\n$$\n\u5373\u6bcf\u4e2a\u524d\u7f00$i$\u6240\u5bf9\u7684\u6392\u5217\u96c6\u4e24\u4e24\u4e0d\u76f8\u4ea4\u3002\n\u90a3\u4e48\u7b54\u6848\u5373\uff1a\n$$\n\\sum_{i=1}^ng[i]\\times i\n$$\n\u8003\u8651\u8ba1\u7b97\u51fa$g[i]$\uff1a\n\n\u6309\u7b2c$i+1$\u4e2a\u5143\u7d20\u662f\u4ec0\u4e48\u5206\u7c7b\uff1a\n\n\u7b2c$i+1$\u4e2a\u5143\u7d20\u4e0d\u540c\u7684\u4e24\u4e2a\u6392\u5217\uff0c\u663e\u7136\u4e0d\u540c\uff0c\u56e0\u6b64\u8fd9\u6837\u7684\u5212\u5206\u662f\u6ee1\u8db3\u4e0d\u91cd\u4e0d\u6f0f\u7684\u3002\n\n\u800c\u5bf9\u4e8e\u6240\u6709\u786e\u5b9a\u7b2c$i+1$\u4e2a\u5143\u7d20\u7684\u6392\u5217\u800c\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u5206\u4e3a\u4e24\u6bb5\uff1a\u5373$1\\sim i$\u4e0e$i+2 \\sim n$\u3002\n\n\u800c\u524d\u9762\u4e00\u6bb5\u663e\u7136\u8981\u6ee1\u8db3\uff1a\n$$\np-a[i+1]<\\sum_{j=1}^ia[j]\\le p\n$$\n\n\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u5728\u53bb\u9664\u6389$a[i+1]$\u7684\u5e8f\u5217\u4e2d\u505a\u4e00\u6b21\u80cc\u5305\u6c42\u51fa\u5176\u65b9\u6848\u6570\u3002\n\n\u5177\u4f53\u5730\uff1a\n\u4ee4$f[i][j][k_1][k_2]$\u4e3a\u9664\u4e86$a[i]$\u7684\u5e8f\u5217\u4e2d\u53ea\u8003\u8651\u524d$j$\u4e2a\u5143\u7d20\uff0c\u957f\u5ea6\u6070\u597d\u4e3a$k_1$\u548c\u5c0f\u4e8e\u7b49\u4e8e$k_2$\u7684\u65b9\u6848\u6570\u3002\n\u6709\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\nf[i][j][k_1][k_2]=f[i][j-1][k_1][k_2]+f[i][j-1][k_1-1][k_2-a[j]]\n$$\n\u90a3\u4e48\u6709\uff1a\n$$\ng[i]=i!(n-i-1)!\\sum_{1\\le j\\le n}f[j][n][i][p]-f[j][n][i][p-a[j]]\n$$\n\u5bf9\u4e8e\n$$\n\\sum_{i=1}^na[i]\\le p\n$$\n\u7279\u5224\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n^4)$\n\n```cpp\n#include <iostream>\n\nnamespace wxy{\n    const int N = 55;\n    double fac[N],g[N],f[N][N][N][N];\n    int n,p,a[N];\n    void main(){\n        fac[0] = 1;for (int i = 1; i <= 50; i++) fac[i] = fac[i - 1] * i;\n        std::cin >> n;\n        for (int i = 1; i <= n; i++) std::cin >> a[i];\n        std::cin >> p;\n        int sum = 0;\n        for (int i = 1; i <= n; i++) sum += a[i];\n        if (sum <= p){std::cout << n;return;}\n        for (int i = 1; i <= n; i++){\n            f[i][0][0][0] = 1;\n            for (int j = 1; j <= n; j++){\n                f[i][j][0][0] = 1;\n                for (int k1 = 1; k1 <= j; k1++){\n                    for (int k2 = 1; k2 <= 50; k2++){\n                        f[i][j][k1][k2] = f[i][j - 1][k1][k2];\n                        if (j == i) continue;\n                        if (k2 >= a[j]) f[i][j][k1][k2] += f[i][j - 1][k1 - 1][k2 - a[j]];\n                    }\n                }\n            }\n        }\n        for (int i = 1;i <= n; i++)\n            for (int j = 1; j <= n; j++)\n                for (int k1 = 1; k1 <= j; k1++)\n                    for (int k2 = 1; k2 <= 50; k2++)\n                        f[i][j][k1][k2] += f[i][j][k1][k2 - 1];\n        for (int i = 1; i <= n; i++){\n            for (int j = 1; j <= n; j++){\n                g[i] += f[j][n][i][p];\n                if (a[j] > p) continue;\n                g[i] -= f[j][n][i][p - a[j]];\n            }\n            g[i] = 1ull * g[i] * fac[n - i - 1] * fac[i];\n        }\n        long double ans = 0;\n        for (int i = 1; i <= n; i++) ans += g[i] * i;\n        ans /= fac[n];\n        std::cout << ans;\n    }\n}signed main(){wxy::main();return 0;}\n```\n",
        "postTime": 1608473953,
        "uid": 317459,
        "name": "RyexAwl",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF261B \u3010Maxim and Restaurant\u3011"
    },
    {
        "content": "**\u80cc\u5305+\u671f\u671b+\u7ec4\u5408\u6570**\n\n\u9996\u5148\u89c2\u5bdf\u6570\u636e\u8303\u56f4$n \\leq 50,$ \u786e\u5b9a\u8fd9\u662f\u4e00\u9053 $O(n^4)$\u7684\u9898\u3002\n\n\u5176\u6b21\uff0c\u8fd9\u9898\u5177\u6709\u975e\u5e38\u660e\u663e\u7684\u80cc\u5305\u6a21\u578b\uff0c\u4e0d\u96be\u60f3\u5230\u72b6\u6001\u8868\u793a$f[i][j][k]$ \u524d$i$\u4e2a\u4eba\u9009$j$ \u4e2a\u4eba\u8fdb\u53bb\u4f53\u79ef\u4e3a$k$\u7684\u65b9\u6848\u6570\uff0c\u81f3\u6b64\u80cc\u5305\u590d\u6742\u5ea6$O(n^3)$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5f53\u4e00\u4e2a\u4eba\u8fdb\u4e0d\u53bb\u7684\u65f6\u5019\u548c\u524d\u9762\u8fdb\u4e86\u54ea\u4e9b\u4eba\u548c\u8fdb\u53bb\u7684\u4eba\u7684\u987a\u5e8f\u662f\u6ca1\u6709\u5173\u7cfb\u7684\uff0c\u6545\u8003\u8651\u679a\u4e3e\u7b2c\u4e00\u4e2a\u4e0d\u80fd\u8fdb\u53bb\u7684\u4eba\uff0c\u7136\u540e\u7edf\u8ba1\u65b9\u6848\u6570\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n ^ 4)$\n\n\u65b9\u6848\u6570\u7edf\u8ba1\n$$\n\t\\sum_{x = 1}^{n}\\sum_{j=1}^{n -1}\\sum_{k = max(0,p - a[x] +1)}^{p} j * j ! * (n - j - 1)!*f[n][j][k]\n$$\n\n\u679a\u4e3e\u4e0d\u80fd\u8fdb\u53bb\u7684\u4eba$x$,\u4ed6\u8fdb\u4e0d\u53bb\u7684\u6761\u4ef6\u662f\u6b64\u65f6\u9009\u4e2d\u7684$j$\u4e2a\u4eba\u7684\u4f53\u79ef$k$\u6ee1\u8db3 $p - k < a[x]$,\u5728$x$\u4e4b\u524d\u8fdb\u53bb\u7684\u4eba\u53ef\u4ee5\u4efb\u610f\u6392\u5217\uff0c\u5728$x$\u4e4b\u540e\u8fdb\u53bb\u7684\u4eba\u4ea6\u53ef\u4ee5\u4efb\u610f\u6392\u5217,\u6240\u4ee5\u4e58\u4e0a\u6392\u5217\u6570\u4e0e\u65b9\u6848\u6570\uff0c\u5728\u4e58\u4e0a\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff08\u5373\u8fdb\u53bb\u7684\u4eba\u6570$j$\uff09\n\n\u6700\u540e\u9664\u4ee5\u603b\u65b9\u6848\u6570$n!$\uff0c\u5f97\u5230\u671f\u671b\n\n\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u770b\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\ntypedef long long ll;\n\nusing namespace std;\n#define $(i,a,n) for(int i = a; i <= n; ++i)\n\ninline ll read() {\n\t   ll ans = 0;\n\t   char last = ' ',ch = getchar();\n\t   while(ch < '0' || ch > '9') last = ch, ch = getchar();\n\t   while(ch >= '0' && ch <= '9') ans = (ans << 3) + (ans << 1) + ch - '0', ch = getchar();\n\t   if(last == '-') ans = -ans;\n\t   return ans;\n}\n\nconst int INF = 0x3f3f3f3f;\n\nconst int N = 60;\n\ndouble fac[N];\nint a[N];\nll f[N][N][N];\nint n, p;\nvoid pre() {\t//\u8ba1\u7b97\u9636\u4e58\n\tfac[0] = 1;\n\tfor(int i = 1; i <= n; ++i) {\n\t\tfac[i] = 1.0 * i * fac[i - 1];\n\t}\n}\ndouble ans =0;\nint sum = 0;\nint main(){\n\t//freopen(\"testdata.in\", \"r\", stdin);\n\t//freopen(\"ans.out\", \"w\", stdout);\n\tn = read();\n\t$(i, 1, n) a[i] = read(), sum += a[i];\n\tp = read();\n\tif(sum <= p) {\t//\u8fd9\u79cd\u60c5\u51b5\u9700\u8981\u7279\u5224\u4e00\u4e0b\uff0c\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u8fdb\u53bb\n\t\tprintf(\"%.6lf\\n\", 1.0 * n);\n\t\treturn 0;\n\t} \n\tpre();\n\tfor(int x = 1; x <= n; ++x) {\n\t\tmemset(f, 0, sizeof f);\n\t\tf[0][0][0] = 1;\n\t\tfor(int i = 1; i <= n; ++i) {\n\t\t\tfor(int j = 0; j <= i; ++j) {\n\t\t\t\tfor(int k = 0; k <= p; ++k) {\n\t\t\t\t\tif(i == x) {\t//\u5f53\u524d\u7b2cx\u4e2a\u4eba\u65e0\u6cd5\u8fdb\u5165\uff0c\u6240\u4ee5\u76f4\u63a5\u8df3\u8fc7x\n\t\t\t\t\t\tf[i][j][k] = f[i - 1][j][k]; continue;\n\t\t\t\t\t}\n\t\t\t\t\tf[i][j][k] = f[i - 1][j][k];\n\t\t\t\t\tif(k >= a[i] && j > 0) f[i][j][k] += f[i - 1][j - 1][k - a[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(int j = 1; j < n; ++j) {\n\t\t\tfor(int k = max(0, p - a[x] + 1); k <= p; ++k) {\n\t\t\t\tans += j * fac[j] * fac[n - j - 1] * f[n][j][k];\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%.6lf\\n\", ans/fac[n]);\n\treturn 0;\n}\n\n\n```\n\u795d\u5927\u5bb6CSP 2019 rp++",
        "postTime": 1573282449,
        "uid": 156945,
        "name": "Stream\u6708",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF261B \u3010Maxim and Restaurant\u3011"
    },
    {
        "content": "\u8003\u8651\u6bcf\u4e2ai\u5bf9\u7b54\u6848\u7684\u8d21\u732e\n\n\u200b\t\u8bbe$f[i][j][k]$\u8868\u793a\u524di\u4e2a\u6570\uff0c\u9009\u51faj\u4e2a\uff0cS=k\u7684\u65b9\u6848\u6570\uff0c\u6309\u7167\u80cc\u5305\u8f6c\u79fb\n$$f[i][j][k]+=f[i-1][j][k]+[k\\geq a[i]]\\cdot f[i-1][j-1][k-a[i]]$$\n\u200b\t\u7136\u540e\u9700\u8981\u4e58\u4e00\u4e2a\u6392\u5217\u6570\uff0c\u5373\u524dj\u4e2a\u6570\u7684\u5168\u6392\u5217\u548c\u540en-j\u4e2a\u6570\u7684\u5168\u6392\u5217\n\n\u200b\t\u6700\u540e\u9664\u4ee5$n!$\n\n\u200b\t\u6ce8\u610f\u6c42$f$\u7684\u65f6\u5019,$f[0 \\cdots n][0][0]=1$",
        "postTime": 1519303901,
        "uid": 35763,
        "name": "spli",
        "ccfLevel": 0,
        "title": "CF261B Maxim and Restaurant"
    }
]