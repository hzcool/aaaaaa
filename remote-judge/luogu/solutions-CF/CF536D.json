[
    {
        "content": "\u8fd9\u9053\u9898\u5c31\u662f\u4e00\u9053\u535a\u5f08\u9898\u3002\n\n\u9996\u5148\u4ece $s$ \u548c $t$ \u5f00\u59cb\u8dd1 dijkstra\uff0c\u672c\u6765\u4e0d\u5e94\u8be5\u5199\u5806\u4f18\u5316($O(n^2)$)\uff0c\u4f46\u662f\u6211\u6bd4\u8f83\u61d2\uff0c\u6240\u4ee5\u5c31\u5806\u4f18\u5316\u7b97\u4e86\u3002\n\n\u7136\u540e\u56e0\u4e3a\u8fb9\u6743\u8fd9\u4e48\u5927\u5e76\u6ca1\u6709\u4ec0\u4e48\u7528\uff0c\u6240\u4ee5\u628a\u6bcf\u4e2a\u70b9\u5230 $s$ \u548c $t$ \u7684\u8ddd\u79bb\u79bb\u6563\u5316\u3002\n\n\u62bd\u8c61\u6210\u4e00\u4e2a\u8868\u683c\uff0c$i$ \u53f7\u70b9\u5728 $(dis_{s,i},dis_{t,i})$ \u4e0a\uff0c\u6743\u503c\u4e3a $p_i$\uff0c\u4e24\u4e2a\u4eba\u8f6e\u6d41\u53d6\u6ca1\u6709\u88ab\u53d6\u8fc7\u7684\u6700\u4e0a\uff08\u5de6\uff09\u7684\u4e00\u884c\uff08\u5217\uff09\u3002\n\n\u56e0\u4e3a\u6ca1\u4ec0\u4e48\u597d\u7684\u8d2a\u5fc3\u6027\u8d28\uff0c\u53c8\u770b\u5230 $n\\le 2000$\uff0c\u6240\u4ee5\u8003\u8651 dp\u3002\n\n\u8bbe $f_{0/1,i,j}$ \u8868\u793a\u5f53\u524d\u8c01\u5148\u624b\uff0c\u5269\u4e0b $(i,j)$ \u53ca\u53f3\u4e0b\u65b9\u7684\u4e00\u90e8\u5206\uff0c\u6700\u5927\uff08\u5c0f\uff09\u7684\u7b2c\u4e00\u4e2a\u4eba\u53d6\u6570\u4e4b\u548c\u51cf\u53bb\u7b2c\u4e8c\u4e2a\u4eba\u53d6\u6570\u4e4b\u548c\u3002\n\n\u5f88\u81ea\u7136\u7684\u60f3\u5230\u679a\u4e3e\u53d6\u54ea\u4e9b\u884c\uff08\u5217\uff09\uff0c\u518d\u9884\u5904\u7406\u4e2a\u4e8c\u7ef4\u524d\u7f00\u548c\u8fd8\u6709\u4e00\u4e9b\u533a\u95f4\u6700\u503c\uff0c\u697c\u4e0a\u4e00\u7bc7\u9898\u89e3\u8fd8\u7528\u4e86\u53cc\u6307\u9488\uff0c\u53cd\u6b63\u53ef\u4ee5\u4f18\u5316\u5230 $O(n^2)$\uff0c\u4f46\u662f\u7a0d\u5fae\u9ebb\u70e6\u4e86\u4e00\u70b9\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u4e00\u6b65\u4e00\u6b65\u53d6\uff0c\u6bcf\u6b21\u53ea\u53d6\u4e00\u884c\uff08\u5217\uff09\uff0c\u7136\u540e\u770b\u770b\u662f\u4ea4\u7ed9\u5bf9\u65b9\u8fd8\u662f\u7ee7\u7eed\u53d6\u5373\u53ef\u3002\u9884\u5904\u7406\u524d\u7f00\u548c\uff0c\u76f4\u63a5\u505a\u5c31\u662f $O(n^2)$\u3002\n\n\u524d\u9762\u6700\u77ed\u8def\u548c\u79bb\u6563\u5316\u7684\u90e8\u5206\u5c31\u4e0d\u653e\u4e86\u3002\n\n```cpp\ninline LL calc(int x1, int y1, int x2, int y2){\n\treturn sum[x2][y2] + sum[x1 - 1][y1 - 1] - sum[x1 - 1][y2] - sum[x2][y1 - 1];\n}\ninline int sz(int x1, int y1, int x2, int y2){\n\treturn siz[x2][y2] + siz[x1 - 1][y1 - 1] - siz[x1 - 1][y2] - siz[x2][y1 - 1];\n}\n```\n```cpp\nfor(Rint i = 1;i <= cnt1;++ i)\n\tfor(Rint j = 1;j <= cnt2;++ j){\n\t\tsum[i][j] += sum[i - 1][j] + sum[i][j - 1] - sum[i - 1][j - 1];\n\t\tsiz[i][j] += siz[i - 1][j] + siz[i][j - 1] - siz[i - 1][j - 1];\n\t}\nfor(Rint i = cnt1;i;-- i)\n\tfor(Rint j = cnt2;j;-- j){\n\t\tif(sz(i, j, i, cnt2) > 0) f[0][i][j] = max(f[0][i + 1][j], f[1][i + 1][j]) + calc(i, j, i, cnt2);\n\t\telse f[0][i][j] = f[0][i + 1][j];\n\t\tif(sz(i, j, cnt1, j) > 0) f[1][i][j] = min(f[1][i][j + 1], f[0][i][j + 1]) - calc(i, j, cnt1, j);\n\t\telse f[1][i][j] = f[1][i][j + 1];\n\t}\nputs(f[0][1][1] > 0 ? \"Break a heart\" : (f[0][1][1] < 0 ? \"Cry\" : \"Flowers\"));\n```",
        "postTime": 1581160298,
        "uid": 68148,
        "name": "watermoon",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF536D \u3010Tavas in Kansas\u3011"
    },
    {
        "content": "# \u8bf7\u5230\u535a\u5ba2\u4e2d\u67e5\u770b\n\n> [CF536D Tavas in Kansas](https://codeforces.com/contest/536/problem/D)\n\n## \u9898\u610f\n\n- \u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u53ef\u80fd\u6709\u81ea\u73af\u548c\u91cd\u8fb9\u7684\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u6bcf\u6761\u8fb9\u90fd\u6709\u4e00\u4e2a\u975e\u8d1f\u8fb9\u6743\u3002\n- \u5c0f X \u548c\u5c0f Y \u5728\u8fd9\u5f20\u56fe\u4e0a\u73a9\u4e00\u4e2a\u6e38\u620f\uff0c\u5728\u6e38\u620f\u4e2d\uff0c\u7b2c $i$ \u4e2a\u57ce\u5e02\u6709\u4e00\u4e2a\u6743\u503c $p_i$\u3002\n- \u4e00\u5f00\u59cb\uff0c\u5c0f X \u5728\u57ce\u5e02 $s$ \u4e2d\uff0c\u5c0f Y \u5728\u57ce\u5e02 $t$ \u4e2d\uff0c\u4e24\u4eba\u5404\u6709\u4e00\u4e2a\u5f97\u5206\uff0c\u521d\u59cb\u4e3a $0$\uff0c\u5c0f X \u4e3a\u5148\u624b\uff0c\u7136\u540e\u8f6e\u6d41\u8fdb\u884c\u64cd\u4f5c\u3002\n- \u5f53\u8f6e\u5230\u67d0\u4e00\u4e2a\u4eba\u65f6\uff0c\u4ed6\u5fc5\u987b\u9009\u62e9\u4e00\u4e2a\u975e\u8d1f\u6574\u6570 $x$\uff0c\u4ee5\u9009\u5b9a\u6240\u6709\u4e0e\u4ed6\u6240\u5728\u7684\u57ce\u5e02\u7684\u6700\u77ed\u8ddd\u79bb\u4e0d\u8d85\u8fc7 $x$ \u7684\u8fd8\u672a\u88ab\u9009\u5b9a\u8fc7\u7684\u57ce\u5e02\uff0c\u4ed6\u7684\u5f97\u5206\u5c06\u4f1a\u52a0\u4e0a\u8fd9\u4e9b\u57ce\u5e02\u7684\u6743\u503c\u3002\n- \u53e6\u5916\uff0c\u6bcf\u4e2a\u4eba\u6bcf\u6b21\u5fc5\u987b\u80fd\u591f\u81f3\u5c11\u9009\u5b9a\u4e00\u4e2a\u57ce\u5e02\u3002\n- \u5f53\u6ca1\u6709\u4eba\u53ef\u4ee5\u9009\u62e9\u65f6\uff0c\u6e38\u620f\u7ed3\u675f\uff0c\u5f97\u5206\u9ad8\u8005\u83b7\u80dc\u3002\n- \u73b0\u5728\u8bf7\u4f60\u8ba1\u7b97\u51fa\uff0c\u5728\u4e24\u4eba\u90fd\u4f7f\u7528\u6700\u4f73\u7b56\u7565\u7684\u60c5\u51b5\u4e0b\uff0c\u8c01\u4f1a\u83b7\u80dc\uff08\u6216\u8005\u5224\u65ad\u4e3a\u5e73\u5c40\uff09\u3002\n- $n \\le 2 \\times 10^3$\uff0c$m \\le 10^5$\uff0c$|p_i| \\le 10^9$\u3002\n\n## \u9898\u89e3\n\n\u9996\u5148\u505a\u4e24\u6b21 dijkstra \u6c42\u51fa $\\operatorname{dist}(s/t, 1\\dots n)$ \u5e76\u79bb\u6563\u5316\uff0c\u503c\u57df\u964d\u4e3a $\\mathcal O(n)$\u3002\n\n\u7531\u4e8e $\\mathcal O(n^2)$ \u53ef\u4ee5\u63a5\u53d7\uff0c\u56e0\u6b64\u76f4\u63a5 dp \u5373\u53ef\u3002\n\n\u8bbe $f(P, S, T)$ \u8868\u793a\u6b64\u65f6\u5148\u624b\u4e3a $P$\uff0c\u8fd8\u5269\u4e0b $\\operatorname{dist}(s, i) \\ge S$ \u4e14 $\\operatorname{dist}(t, i) \\ge T$ \u7684\u70b9 $i$ \u65f6\uff0c\u5148\u624b\u7684\u6700\u5927\u5f97\u5206\u3002\n\n\u5219\u6709\n$$\nf(P, S, T) =  \\begin{cases}  0 & c(S, T) = 0 \\\\ \\max_{c(A,T) < c(S,T)} s(S,T) - f(1,A,T) & P = 0 \\\\ \\max_{c(S,B) < c(S,T)} s(S,T) - f(0,S,B) & P = 1 \\end{cases}\n$$\n\u8981\u540e\u7f00 $\\min$ \u4f18\u5316\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log m + n^2)$\u3002\n\n\u5b9e\u73b0\u4e0a\uff0c\u53ef\u4ee5\u9012\u63a8\u51fa\u5bf9\u4e8e\u6bcf\u4e2a $(S,T)$\uff0c$\\min_{i\\ge S, j \\ge T, c(i,j) < c(S,T)} i/j$ \u7684\u503c\uff0c\u7136\u540e $f$ \u503c\u76f4\u63a5\u8bbe\u4e3a\u540e\u7f00 $\\min$\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst int N = 2e3 + 7;\nconst ll inf = 1e18;\nint n, m, S, T, a[N], v[N], cs, ct, c[N][N], ns[N][N], nt[N][N];\nll ds[N], dt[N], num[N], f[2][N][N], s[N][N];\nvector<pi> e[N];\n\ninline void dij(int s, ll *d, int &c) {\n\tfor (int i = 1; i <= n; i++) d[i] = inf, v[i] = 0;\n\tpq<pair<ll, int>> q;\n\td[s] = 0, q.push(mp(0, s));\n\twhile (q.size()) {\n\t\tint x = q.top().se;\n\t\tq.pop();\n\t\tif (v[x]) continue;\n\t\tv[x] = 1;\n\t\tfor (pi o : e[x]) {\n\t\t\tint y = o.fi, z = o.se;\n\t\t\tif (d[y] > d[x] + z) d[y] = d[x] + z, q.push(mp(-d[y], y));\n\t\t}\n\t}\n\tfor (int i = 1; i <= n; i++) num[i] = d[i];\n\tsort(num + 1, num + n + 1);\n\tc = unique(num + 1, num + n + 1) - (num + 1);\n\tfor (int i = 1; i <= n; i++)\n\t\td[i] = lower_bound(num + 1, num + c + 1, d[i]) - num;\n}\n\nint main() {\n\trd(n), rd(m), rd(S), rd(T);\n\tfor (int i = 1; i <= n; i++) rd(a[i]);\n\tfor (int i = 1, x, y, z; i <= m; i++)\n\t\trd(x), rd(y), rd(z), e[x].pb(mp(y, z)), e[y].pb(mp(x, z));\n\tdij(S, ds, cs), dij(T, dt, ct);\n\tfor (int i = 1; i <= n; i++)\n\t\t++c[ds[i]][dt[i]], s[ds[i]][dt[i]] += a[i];\n\tfor (int i = cs; i; i--)\n\t\tfor (int j = ct; j; j--) {\n\t\t\ts[i][j] += s[i+1][j] + s[i][j+1] - s[i+1][j+1];\n\t\t\tns[i][j] = min(i == cs ? cs : ns[i+1][j], j == ct ? cs : ns[i][j+1]);\n\t\t\tnt[i][j] = min(i == cs ? ct : nt[i+1][j], j == ct ? ct : nt[i][j+1]);\n\t\t\tif (c[i][j]) ns[i][j] = i, nt[i][j] = j;\n\t\t\tf[0][i][j] = s[i][j] - f[1][ns[i][j]+1][j];\n\t\t\tf[1][i][j] = s[i][j] - f[0][i][nt[i][j]+1];\n\t\t\tif (i == 1 && j == 1) continue;\n\t\t\tf[0][i][j] = min(f[0][i][j], f[0][i][j+1]);\n\t\t\tf[1][i][j] = min(f[1][i][j], f[1][i+1][j]);\n\t\t}\n\tll ans = s[1][1] - 2 * f[0][1][1];\n\tprints(ans < 0 ? \"Break a heart\" : (ans > 0 ? \"Cry\" : \"Flowers\"));\n\treturn 0;\n}\n```\n\n$\\textstyle$",
        "postTime": 1581180803,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF536D \u3010Tavas in Kansas\u3011"
    },
    {
        "content": "#### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u5f20 $n$ ($2\\le n\\le 2000$) \u4e2a\u70b9 $m$ ($n-1\\le m\\le 10^5$) \u6761\u8fb9\u7684\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6709\u6743\u503c $p_i$ ($|p_i|\\le 10^9$)\u3002A \u548c B \u5728\u73a9\u4e00\u4e2a\u6e38\u620f\uff0c\u6bcf\u4e2a\u4eba\u5206\u522b\u62e5\u6709\u4e00\u4e2a\u70b9 $s$, $t$\u3002A \u5148\u884c\u52a8\uff0c\u7136\u540e\u4e24\u4eba\u8f6e\u6d41\u884c\u52a8\uff0c\u6bcf\u6b21\u884c\u52a8\u9009\u62e9\u4e00\u4e2a\u975e\u8d1f\u6574\u6570 $x$\uff0c\u7136\u540e\u83b7\u53d6\u4e0e\u4ed6\u7684\u70b9\u8ddd\u79bb\u4e0d\u8d85\u8fc7 $x$ \u7684\u6240\u6709\u70b9\u7684\u6743\u503c\u3002\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u53ea\u80fd\u88ab\u83b7\u53d6\u4e00\u6b21\uff0c\u6bcf\u6b21\u884c\u52a8\u5fc5\u987b\u83b7\u53d6\u81f3\u5c11\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u3002\u5f53\u6240\u6709\u70b9\u7684\u6743\u503c\u90fd\u88ab\u83b7\u53d6\u540e\uff0c\u6e38\u620f\u7ed3\u675f\uff0c\u5f97\u5206\u9ad8\u8005\u83b7\u80dc\u3002A, B \u5747\u91c7\u53d6\u6700\u4f18\u7b56\u7565\uff0c\u6c42\u80dc\u8d1f\u60c5\u51b5\u3002\n\n#### \u9898\u89e3\n\n\u9884\u5904\u7406 $s$, $t$ \u5230\u6bcf\u4e2a\u70b9\u7684\u6700\u77ed\u8def\u5e76\u79bb\u6563\u5316\u3002\u8bbe $f(X,Y,p)$ \u8868\u793a\u5f53\u524d\u5269\u4e0b\u6240\u6709\u5230 $s$ \u7684\u8ddd\u79bb\u4e0d\u5c0f\u4e8e $X$ \u4e14\u5230 $t$ \u7684\u8ddd\u79bb\u4e0d\u5c0f\u4e8e $Y$ \u7684\u70b9\uff0c\u5f53\u524d\u5148\u624b\u7684\u4eba\u662f $p$\uff0c\u6240\u80fd\u83b7\u5f97\u7684\u6700\u5927\u5206\u6570\u3002\u8bbe $\\mathrm{cnt}(X,Y)$ \u4e3a\u5230 $s$ \u7684\u8ddd\u79bb\u4e0d\u5c0f\u4e8e $X$ \u4e14\u5230 $t$ \u7684\u8ddd\u79bb\u4e0d\u5c0f\u4e8e $Y$ \u7684\u70b9\u6570\uff0c$\\mathrm{sum}(X,Y)$ \u4e3a\u5b83\u4eec\u7684\u6743\u503c\u548c\uff0c\u5219\u6709\n\n$$f(X,Y,p)=\\begin{cases}0&\\text{if }\\mathrm{cnt}(X,Y)=0,\\\\\\max_{\\mathrm{cnt}(X',Y)<\\mathrm{cnt}(X,Y)}\\{\\mathrm{sum}(X,Y)-f(X',Y,1)\\}&\\text {if }p=0,\\\\\\max_{\\mathrm{cnt}(X,Y')<\\mathrm{cnt}(X,Y)}\\{\\mathrm{sum}(X,Y)-f(X,Y',0)\\}&\\text{otherwise.} \\end{cases}$$\n\n\u8bb0\u5f55\u90e8\u5206\u6700\u5c0f\u503c\u5373\u53ef\u505a\u5230 $O(N^2)$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconstexpr long long INF = 1E18;\nint main() {\n    ios::sync_with_stdio(false);\n    cin.tie(nullptr);\n    int n, m;\n    cin >> n >> m;\n    int s, t;\n    cin >> s >> t;\n    --s;\n    --t;\n    vector<int> p(n);\n    for (int i = 0; i < n; ++i)\n        cin >> p[i];\n    vector<vector<pair<int, int>>> e(n);\n    for (int i = 0; i < m; ++i) {\n        int u, v, w;\n        cin >> u >> v >> w;\n        --u;\n        --v;\n        e[u].emplace_back(v, w);\n        e[v].emplace_back(u, w);\n    }\n    auto dijkstra = [&](int s) {\n        vector<long long> dis(n, 1E18);\n        priority_queue<pair<long long, int>> q;\n        dis[s] = 0;\n        q.emplace(0, s);\n        while (!q.empty()) {\n            long long d;\n            int u;\n            tie(d, u) = q.top();\n            q.pop();\n            d = -d;\n            if (d != dis[u])\n                continue;\n            for (auto ed : e[u]) {\n                int v, w;\n                tie(v, w) = ed;\n                if (dis[v] > d + w) {\n                    dis[v] = d + w;\n                    q.emplace(-dis[v], v);\n                }\n            }\n        }\n        auto values = dis;\n        sort(values.begin(), values.end());\n        for (int i = 0; i < n; ++i)\n            dis[i] = lower_bound(values.begin(), values.end(), dis[i]) - values.begin();\n        return vector<int>(dis.begin(), dis.end());\n    };\n    auto ds = dijkstra(s), dt = dijkstra(t);\n    vector<vector<int>> cnt(n + 1, vector<int>(n + 1));\n    vector<vector<long long>> sum(n + 1, vector<long long>(n + 1));\n    for (int i = 0; i < n; ++i) {\n        ++cnt[ds[i]][dt[i]];\n        sum[ds[i]][dt[i]] += p[i];\n    }\n    for (int i = n - 1; i >= 0; --i) {\n        for (int j = n - 1; j >= 0; --j) {\n            cnt[i][j] += cnt[i + 1][j] + cnt[i][j + 1] - cnt[i + 1][j + 1];\n            sum[i][j] += sum[i + 1][j] + sum[i][j + 1] - sum[i + 1][j + 1];\n        }\n    }\n    vector<vector<long long>> dpa(n + 1, vector<long long>(n + 1)), dpb(n + 1, vector<long long>(n + 1));\n    vector<vector<pair<long long, int>>> qa(n + 1, {{}, {}}), qb(n + 1, {{}, {}});\n    auto update = [&](auto x, auto &f) {\n        if (x < f[0])\n            swap(x, f[0]);\n        if (x.second == f[0].second)\n            return;\n        f[1] = min(f[1], x);\n    };\n    for (int i = n; i >= 0; --i) {\n        for (int j = n; j >= 0; --j) {\n            if (cnt[i][j] == 0)\n                continue;\n            dpa[i][j] = sum[i][j] - (cnt[i][j] == qa[j][0].second ? qa[j][1] : qa[j][0]).first;\n            dpb[i][j] = sum[i][j] - (cnt[i][j] == qb[i][0].second ? qb[i][1] : qb[i][0]).first;\n            update(make_pair(dpa[i][j], cnt[i][j]), qb[i]);\n            update(make_pair(dpb[i][j], cnt[i][j]), qa[j]);\n        }\n    }\n    long long x = dpa[0][0], y = sum[0][0] - x;\n    if (x < y)\n        cout << \"Cry\\n\";\n    else if (x > y)\n        cout << \"Break a heart\\n\";\n    else\n        cout << \"Flowers\\n\";\n    return 0;\n}\n```\n\n",
        "postTime": 1575362068,
        "uid": 149656,
        "name": "jiangly",
        "ccfLevel": 10,
        "title": "CF536D Tavas in Kansas \u9898\u89e3"
    },
    {
        "content": "**CF536D**\n\n\u611f\u89c9\u6709\u70b9\u5957\u8def\u4e86\u3002\u867d\u7136\u6211\u88ab\u4e00\u4e2a\u795e\u7b14 corner \u5361\u4e86\u4e0b\u3002\n\n\u4e00\u4e2a\u60f3\u6cd5\u662f\u8fd9\u5e76\u4e0d\u662f\u4e2a\u516c\u5e73\u6e38\u620f\uff0c\u6211\u4eec\u53ea\u80fd\u538b\u7f29\u72b6\u6001\u8fdb\u884c\u52a8\u6001\u89c4\u5212\u6765\u8fbe\u5230\u6700\u4f18\u5316\u8f6c\u79fb\u3002\n\n\u518d\u89c2\u5bdf\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u56fe\u662f\u5e73\u51e1\u7684\uff0c\u56e0\u4e3a\u5728\u6c42\u51fa\u6240\u6709\u70b9\u5230\u7aef\u70b9\u7684\u6700\u77ed\u8def\u540e\uff0c\u5c06\u6240\u6709\u70b9\u7528\u5750\u6807\u8868\u793a\u6210\u4e8c\u7ef4\u5e73\u9762\u4e0a\u7684\u70b9\u5373\u53ef\u3002\n\n\u53d1\u73b0 $n \\leq 2 \\times 10 ^ 3$\uff0c\u731c\u662f $O(n ^ 2)$ \u7684\uff0c\u521a\u597d\u5bf9\u4e8e\u8fd9\u7c7b\u535a\u5f08\u95ee\u9898\u4e2d\u5e26\u5148\u540e\u624b\u4e14\u6700\u4f18\u5316\u5206\u5dee\u7684\u9898\u6709\u4e00\u4e2a\u5f88\u5957\u8def\u7684\u72b6\u6001\u8bbe\u8ba1\uff1a\u8bbe $dp_{0/1,l,r}$ \u8868\u793a\u6ee1\u8db3 $x \\leq l,y \\leq r$ \u6761\u4ef6\u4e4b\u4e00\u7684\u8282\u70b9\u5df2\u88ab\u51b3\u7b56\uff0c\u8be5\u72b6\u6001\u7531\u5148\u624b/\u540e\u624b\u610f\u4e49\u4e0b\u6267\u884c\u540e\u7684\u6700\u4f18\u5316\u5dee\u503c\u3002\u5728\u6b64\u9898\u4e2d\u5148\u624b\u662f\u6700\u5927\u5316\u5dee\u503c\uff0c\u540e\u624b\u662f\u6700\u5c0f\u5316\u5dee\u503c\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u672a\u88ab\u8003\u8651\u7684\u8303\u56f4\u88ab\u4e24\u6761\u626b\u63cf\u7ebf\u5939\u7740\u5f62\u6210\u4e00\u4e2a\u77e9\u5f62\uff0c\u4f46\u662f\u8be5\u6027\u8d28\u6ca1\u6709\u592a\u5927\u7684\u7528\u5904\u3002\n\n\u521a\u5f00\u59cb\u6211\u7ef4\u62a4\u4e86\u5355\u7ef4\u5ea6\u7684\u533a\u95f4\u6570\u70b9\uff0c\u4f46\u662f\u540e\u6765\u53d1\u73b0\u600e\u4e48\u8f6c\u79fb\u90fd\u662f $O(n ^ 3)$ \u7684\uff0c\u89c2\u5bdf\u5230\u626b\u63cf\u7ebf\u7684\u5927\u5e45\u632a\u52a8\u4e5f\u53ef\u4ee5\u88ab\u5316\u4e3a\u4e00\u6b21\u6b21\u5355\u72ec\u632a\u52a8\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u6bcf\u6b21\u53ea\u6269\u5c55\u4e00\u884c/\u4e00\u5217\u3002\n\n\u53d1\u73b0\u51b3\u7b56\u7684\u56e0\u7d20\u4e4b\u548c\u76f8\u90bb\u72b6\u6001\u6709\u5173\u3002\u9006\u5411\u64cd\u4f5c\uff0c\u8fd9\u6837\u6211\u4eec\u6700\u540e\u4e00\u6b65\u7684\u51b3\u7b56\u8005\u662f\u8c01\u5c31\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u88ab\u51b3\u7b56\u6389\u3002\uff08\u867d\u7136\u6211\u89c9\u5f97\u6b63\u5411\u597d\u50cf\u5bf9\u4e8e\u6b64\u9898\u6ca1\u95ee\u9898\uff09\n\n\u7ef4\u62a4\u4e00\u4e0b $x/y$ \u7ef4\u56fa\u5b9a\u65f6\u7684\u4e00\u4e2a\u540e\u7f00\u5185\u70b9\u7684\u6570\u91cf\u53ca\u548c\uff0c\u8bbe\u4e3a $num_{0/1,x,y},sum_{0/1,x,y}$\uff0c\u8bbe\u4e24\u7ef4\u7684\u8fb9\u754c\u4e3a $X,Y$\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n- $dp_{0,l,r} = \\max(dp_{0,l + 1,r},dp_{1,l + 1,r}) + sum_{0,l+1,Y} - sum_{0,l+1,r}$\n\n- $dp_{1,l,r} = \\max(dp_{0,l,r + 1},dp_{1,l,r+1}) - sum_{1,X,r + 1}-  sum_{1,l,r + 1}$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n ^ 2)$\u3002",
        "postTime": 1674010203,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u65e0\u9650\u7684\u53e5\u53f7\u63a8\u6f14\u4e00\u4e2a\u98d8\u6e3a\u7684\u68a6\u60f3"
    },
    {
        "content": ">### [\u6d1b\u8c37\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://www.luogu.org/problem/CF536D) & [CodeForces\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://codeforces.com/contest/536/problem/D)\n\n>A\u548cB\u5728\u4e00\u5f20\u65e0\u5411\u8fde\u901a\u56fe$G=(V,E),|V|=n,|E|=m$\u4e0a\u73a9\u4e00\u4e2a\u6e38\u620f\uff0c\u8282\u70b9$i$\u6709\u4e00\u4e2a\u6743\u503c$v_i$\u3002A\u3001B\u5206\u522b\u7ad9\u5728\u8282\u70b9$a,b$\uff0c\u8f6e\u6d41\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u9009\u62e9\u4e00\u4e2a\u6570$x$\uff0c\u7136\u540e\u9009\u6240\u6709\u5230\u81ea\u5df1\u6240\u5728\u5730\u6700\u77ed\u8ddd\u79bb$\\le x$\u4e14\u6ca1\u6709\u88ab\u9009\u8fc7\u7684\u70b9\uff0c\u5e76\u628a\u5b83\u4eec\u7684\u6743\u503c\u7d2f\u52a0\u5230\u81ea\u5df1\u7684\u5206\u6570\u4e2d\uff0c\u4e14\u8981\u6ee1\u8db3\u81f3\u5c11\u9009\u4e86$1$\u4e2a\u70b9\u3002\u76f4\u5230\u5f53\u524d\u73a9\u5bb6\u65e0\u6cd5\u64cd\u4f5c\uff0c\u6e38\u620f\u7ed3\u675f\u3002A\u4e3a\u5148\u624b\uff0cA\u3001B\u5747\u5e0c\u671b\u81ea\u5df1\u7684\u5f97\u5206\u66f4\u9ad8\u4e14\u6309\u6700\u4f18\u7b56\u7565\u64cd\u4f5c\u3002\u8bbeA\u3001B\u7684\u6700\u7ec8\u5f97\u5206\u5206\u522b\u4e3a$sco_a,sco_b$\uff0c\u5219\u8f93\u51fa$\\begin{cases}\\texttt{Cry}&sco_a<sco_b\\\\\\texttt{Flowers}&sco_a=sco_b\\\\\\texttt{Break a heart}&sco_a>sco_b\\end{cases}$\u3002\n\n>$n\\in\\left[2,2\\times10^3\\right],m\\in\\left[n-1,10^5\\right],a\\ne b,v_i\\in\\left[-10^9,10^9\\right]$\u3002\n\n\u9996\u5148\uff0c\u8dd1$2$\u904dDijkstra\uff08\u7531\u4e8e$\\mathrm O\\left(n^2\\right)$\u53ef\u8fc7\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5806\u4f18\u5316\uff09\u662f\u80af\u5b9a\u7684\uff0c\u7b97\u51fa\u6bcf\u4e2a\u8282\u70b9$i$\u5230$a,b$\u5206\u522b\u7684\u6700\u77ed\u8def\u5f84\uff0c\u8bb0\u4e3a$dis1_i,dis2_i$\u3002\n\n\u7136\u540e\u4e0d\u96be\u53d1\u73b0\uff0c\u4ee5\u5230$a$\u7684\u6700\u77ed\u8ddd\u79bb\u6765\u8bf4\uff0c\u4e0d\u53ef\u80fd\u5b58\u5728$dis1_i<dis1_j$\u4f7f\u5f97$j$\u88abA\u9009\u4e86\u800c$i$\u6ca1\u88ab\u9009\uff08\u9053\u7406\u5f88\u7b80\u5355\uff09\uff0c\u5230$b$\u4ea6\u7136\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u63cf\u8ff0\u51fa\u6e38\u620f\u4e2d\u4efb\u610f\u4e00\u4e2a\u53ef\u80fd\u7684\u5c40\u9762\uff1a\u6709\u4e14\u4ec5\u6709\u6240\u6709\u6ee1\u8db3$dis1_x\\le i$\u6216$dis2_x\\le j$\u7684$x$\u88ab\u9009\uff0c\u8bb0\u4e3a$S(i,j)$\u3002\u8003\u8651\u5c06$dis1,dis2$\u79bb\u6563\u5316\uff08\u56e0\u4e3a\u6211\u4eec\u53ea\u9700\u8981\u6bd4\u8f83\u76f8\u5bf9\u5927\u5c0f\uff0c\u4e14$dis1,dis2$\u7684\u6bd4\u8f83\u662f\u4e92\u76f8\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u4e0d\u7528\u4fdd\u7559\u539f\u6570\u503c\uff09\uff0c\u8fd9\u6837\u663e\u7136$\\forall S(i,j),i,j\\le n$\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u6bcf\u4e2a\u5c40\u9762\u88c5\u5230DP\u6570\u7ec4\u91cc\uff0c\u4f7f\u5f97\u72b6\u6001\u6570\u5728$\\mathrm O(n^2)$\u7ea7\u3002\n\n\u8bbe$dp1_{i,j},dp2_{i,j}$\u5206\u522b\u8868\u793a\u82e5\u521d\u59cb\u5c40\u9762\u4e3a\u5c40\u9762$S_{i,j}$\uff0c\u7b2c\u4e00\u6b65\u8be5A\u3001B\u64cd\u4f5c\uff0cA\u5f97\u7684\u5206\u6570\u3002\u8003\u8651\u679a\u4e3e\u7b2c\u4e00\u6b65\u8be5\u64cd\u4f5c\u7684\u73a9\u5bb6\u65b0\u9009\u4e86\u90a3\u4e9b\u8282\u70b9\uff08\u8fd9\u4e9b\u8282\u70b9\u4e0d\u80fd\u5df2\u7ecf\u88ab\u53e6\u4e00\u4e2a\u73a9\u5bb6\u9009\u8fc7\uff09\uff0c\u5373\u5c06$i/j$\u589e\u52a0\u5230\u4e86\u591a\u5c11\uff0c\u7136\u540e\u8f6c\u79fb\u5230\u4e0b\u4e00\u4e2a\u5c40\u9762\u3002\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$\\begin{cases}dp1_{i,j}=\\max\\limits_{\\sum\\limits_{o=i+1}^k\\sum\\limits_{dis1_p=o}[dis2_p>j]>0}\\left\\{dp2_{k,j}+\\sum\\limits_{o=i+1}^k\\sum\\limits_{dis1_p=o}[dis2_p>j]v_p\\right\\}\\\\dp2_{i,j}=\\min\\limits_{\\sum\\limits_{o=j+1}^k\\sum\\limits_{dis2_p=o}[dis1_p>i]>0}\\left\\{dp1_{i,k}\\right\\}\\end{cases}$$\n\n\u8fd9\u6837$1$\u6b21\u8f6c\u79fb\u663e\u7136\u662f$\\mathrm O(n)$\u7684\uff0c\u603b\u590d\u6742\u5ea6$\\mathrm O\\left(n^3\\right)$\uff0c\u4f1a\u70b8\u3002\u6ce8\u610f\u5230\u65b9\u7a0b\u91cc\u9762\u6709\u533a\u95f4\u548c\uff0c\u4e8e\u662f\u9884\u5904\u7406\u524d\u7f00\u548c$Cnt1_{i,j}=\\sum\\limits_{k=1}^i\\sum\\limits_{dis1_o=k}[dis2_o>j],Sum1_{i,j}=\\sum\\limits_{k=1}^i\\sum\\limits_{dis1_o=k}[dis2_o>j]v_o,Cnt2_{i,j}=\\sum\\limits_{k=1}^i\\sum\\limits_{dis2_o=k}[dis1_o>j]$\uff0c\u65b9\u7a0b\u53d8\u4e3a\u4e86\uff1a\n\n$$\\begin{cases}dp1_{i,j}=\\max\\limits_{Cnt1_{k,j}>Cnt1_{i,j}}\\left\\{dp2_{k,j}+Sum1_{k,j}-Sum1_{i,j}\\right\\}=\\max\\limits_{Cnt1_{k,j}>Cnt1_{i,j}}\\left\\{dp2_{k,j}+Sum1_{k,j}\\right\\}-Sum1_{i,j}\\\\dp2_{i,j}=\\min\\limits_{Cnt2_{i,k}>Cnt2_{i,j}}\\left\\{dp1_{i,k}\\right\\}\\end{cases}$$\n\n\u9996\u5148\u660e\u786e\u4e00\u70b9\uff0cDP\u65f6\u662f\u6309$i,j$\u7684\u5012\u5e8f\u9012\u63a8\u7684\uff08\u56e0\u4e3a\u53ea\u6709$i'\\ge i,j'\\ge j$\uff0c$S(i,j)$\u624d\u53ef\u80fd\u8f6c\u79fb\u5230$S(i',j')$\uff09\u3002\u4e0d\u96be\u53d1\u73b0\uff0c$dp1$\u7684\u8f6c\u79fb\u65b9\u7a0b\u4e2d\uff0c\u51b3\u7b56\u53d8\u91cf$k$\u7684\u53d6\u503c\u8303\u56f4\u4e00\u5b9a\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u8bbe\u5b83\u4e3a$[k_{\\min},k_{\\max}]$\uff0c\u5219\u82e5$j$\u56fa\u5b9a\uff0c\u968f\u7740$i$\u7684\u4e0b\u964d\uff0c$k_{\\max}=|dis1|$\u6052\u6210\u7acb\uff0c$k_{\\min}$\u5355\u8c03\u4e0d\u5347\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u53ef\u4ee5two-pointers\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4$now1,mx1$\u6570\u7ec4\uff0c$now1_o,mx1_o$\u8868\u793a\u5f53$j=o$\u65f6\u5f53\u524d\u7684$k_{\\min}$\u3001\u6240\u6709\u51b3\u7b56\u4e2d\u6700\u5927\u7684$dp2_{k,j}+Sum1_{k,j}$\uff0c$i$\u6bcf\u51cf\u5c11$1$\u65f6\uff0c\u5c31\u5c06$now1_j$\u51cf\u5c11\u82e5\u5e72\u5e76\u66f4\u65b0$mx1_j$\u3002\u5bf9$dp2$\u7684\u5904\u7406\u7c7b\u4f3c\uff0c\u7ef4\u62a4$now2,mn2$\u3002\n\n\u6700\u7ec8\u6bd4\u8f83$dp1_{0,0}$\u4e0e$\\sum\\limits_{i=1}^nv_i-dp1_{0,0}$\u7684\u5927\u5c0f\u5373\u53ef\u3002\u5bf9\u4e86\u8fd8\u6709\u8fb9\u754c\uff0c\u5c31\u662f\u65e0\u6cd5\u8f6c\u79fb\u5230\u4efb\u4f55\u5c40\u9762\u7684DP\u503c\u4e3a$0$\u3002\n\n\u7528\u4e86two-pointers\uff0c\u8ba1\u7b97\u6bcf\u4e2aDP\u503c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5747\u644a$\\mathrm O(1)$\uff0c\u518d\u52a0\u4e0a\u6700\u5148\u7684Dijkstra\uff0c\u603b\u590d\u6742\u5ea6\u5c31\u662f$\\mathrm O\\left(n^2\\right)$\u4e86\u3002\n\n\u4e0b\u9762\u8d34\u4ee3\u7801\uff1a\n\n```cpp \n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long//\u9632\u7206int \n#define mp make_pair\n#define X first\n#define Y second\n#define pb push_back\nconst int inf=0x3f3f3f3f3f3f3f3f; \nconst int N=2000;\nint n/*\u70b9\u6570*/,m/*\u8fb9\u6570*/,a/*A\u6240\u5728\u8282\u70b9*/,b/*B\u6240\u5728\u8282\u70b9*/;\nint v[N+1];//\u70b9\u6743 \nvector<pair<int,int> > nei[N+1];//\u90bb\u63a5\u8868 \nint dis1[N+1],dis2[N+1];//\u5230a\u3001b\u7684\u6700\u77ed\u8ddd\u79bb \nbool vis[N+1]; \nvoid dijkstra(int x,int dis[]){//Dijkstra\u6c42dis1,dis2 \n\tfor(int i=1;i<=n;i++)dis[i]=inf;\n\tdis[x]=0;\n\tmemset(vis,0,sizeof(vis));\n\twhile(true){\n\t\tpair<int,int> mn(inf,0);\n\t\tfor(int j=1;j<=n;j++)if(!vis[j])mn=min(mn,mp(dis[j],j));\n\t\tint y=mn.Y;\n\t\tif(!y)break;\n\t\tvis[y]=true;\n\t\tfor(int j=0;j<nei[y].size();j++){\n\t\t\tint z=nei[y][j].X,len=nei[y][j].Y;\n\t\t\tdis[z]=min(dis[z],dis[y]+len);\n\t\t}\n\t}\n//\tprintf(\"dis=\");for(int i=1;i<=n;i++)cout<<dis[i]<<\" \";puts(\"\");\n}\nvector<int> nums1,nums2;//\u79bb\u6563\u5316\u8f85\u52a9\u6570\u7ec4 \nvector<int> hav1[N+1],hav2[N+1];//hav1[i]\u4e2d\u5b58\u50a8\u6240\u6709\u6ee1\u8db3dis1[x]=i\uff08\u79bb\u6563\u5316\u4e4b\u540e\uff09\u7684\u8282\u70b9x\uff0chav2\u7c7b\u4f3c \nvoid discrete(vector<int> &nums,int dis[],vector<int> hav[]){//\u79bb\u6563\u5316 \n\tnums.pb(-1);//\u6bd4\u4efb\u4f55\u8ddd\u79bb\u90fd\u5c0f \n\tfor(int i=1;i<=n;i++)nums.pb(dis[i]);\n\tsort(nums.begin(),nums.end());\n\tnums.resize(unique(nums.begin(),nums.end())-nums.begin());\n\tfor(int i=1;i<=n;i++)hav[dis[i]=lower_bound(nums.begin(),nums.end(),dis[i])-nums.begin()].pb(i);\n}\nint Cnt1[N+1][N+1],Sum1[N+1][N+1],Cnt2[N+1][N+1];//\u524d\u7f00\u548c \nint now1[N+1],now2[N+1],mx1[N+1],mn2[N+1];//\u4f18\u5316DP\u7684two-pointers\u6570\u7ec4 \nint dp1[N+1][N+1],dp2[N+1][N+1];//DP\u6570\u7ec4 \nsigned main(){\n\tcin>>n>>m>>a>>b;\n\tint sum=0;//\u6240\u6709\u70b9\u6743\u548c \n\tfor(int i=1;i<=n;i++)cin>>v[i],sum+=v[i];\n\twhile(m--){\n\t\tint x,y,z;\n\t\tcin>>x>>y>>z;\n\t\tnei[x].pb(mp(y,z));nei[y].pb(mp(x,z));\n\t}\n\tdijkstra(a,dis1);dijkstra(b,dis2);//\u6c42\u51fa\u8ddd\u79bb\u6570\u7ec4 \n\tdiscrete(nums1,dis1,hav1);discrete(nums2,dis2,hav2);//\u79bb\u6563\u5316\u8ddd\u79bb\u6570\u7ec4 \n\tfor(int i=1;i<nums1.size();i++)for(int j=0;j<nums2.size();j++){//\u9884\u5904\u7406Cnt1,Sum1 \n\t\tCnt1[i][j]=Cnt1[i-1][j];Sum1[i][j]=Sum1[i-1][j];\n\t\tfor(int k=0;k<hav1[i].size();k++){\n\t\t\tbool ok=dis2[hav1[i][k]]>j;\n\t\t\tCnt1[i][j]+=ok;Sum1[i][j]+=ok*v[hav1[i][k]];\n\t\t}\n\t}\n\tfor(int i=1;i<nums2.size();i++)for(int j=0;j<nums1.size();j++){//\u9884\u5904\u7406Cnt2 \n\t\tCnt2[i][j]=Cnt2[i-1][j];\n\t\tfor(int k=0;k<hav2[i].size();k++)Cnt2[i][j]+=dis1[hav2[i][k]]>j;\n\t}\n\tfor(int i=0;i<=n;i++)now1[i]=nums1.size(),now2[i]=nums2.size(),mx1[i]=-inf,mn2[i]=inf;//\u8d4b\u521d\u59cb\u503c \n\tfor(int i=nums1.size()-1;~i;i--)for(int j=nums2.size()-1;~j;j--){//\u6309i,j\u5012\u5e8fDP \n\t\twhile(now1[j]&&Cnt1[now1[j]-1][j]>Cnt1[i][j])now1[j]--,mx1[j]=max(mx1[j],dp2[now1[j]][j]+Sum1[now1[j]][j]);//two-pointers \n\t\tdp1[i][j]=mx1[j]>-inf?/*\u80fd\u8f6c\u79fb\uff1f*/mx1[j]-Sum1[i][j]/*\u6309\u65b9\u7a0b\u6765*/:0/*\u4e3a0*/;\n\t\twhile(now2[i]&&Cnt2[now2[i]-1][i]>Cnt2[j][i])now2[i]--,mn2[i]=min(mn2[i],dp1[i][now2[i]]);//\u540c\u4e0a2\u884c \n\t\tdp2[i][j]=mn2[i]<inf?mn2[i]:0;//\u540c\u4e0a2\u884c \n//\t\tprintf(\"dp1[%lld][%lld]=%lld dp2[%lld][%lld]=%lld\\n\",i,j,dp1[i][j],i,j,dp2[i][j]);\n\t}\n\tint ans=dp1[0][0];//A\u7684\u6700\u4f18\u5f97\u5206 \n\tputs(ans<sum-ans?\"Cry\":ans==sum-ans?\"Flowers\":\"Break a heart\");\n\treturn 0;\n}\n```",
        "postTime": 1575827682,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "CodeForces 536D - Tavas in Kansas"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\u7ed9\u4f60\u4e00\u5f20\u56fe\uff0c\u70b9\u6709\u70b9\u6743\uff0c\u4ee5\u53ca A \u548c B \u7684\u6240\u5728\u70b9 $s$ \u548c $t$\uff0cA \u4e3a\u5148\u624b\u548c B \u8f6e\u6d41\u64cd\u4f5c\uff0c\u6bcf\u6b21\u9009\u5b9a\u4e00\u4e2a\u6570 $x$ \u5e76\u53d6\u8d70\u8ddd\u6240\u5728\u70b9\u6700\u77ed\u8ddd\u79bb\u4e0d\u8d85\u8fc7 $x$ \u7684\u53ef\u53d6\u70b9\u7684\u70b9\u6743\uff0c\u5c06\u8fd9\u4e9b\u70b9\u6807\u8bb0\u4e3a\u4e0d\u53ef\u53d6\u3002\u6bcf\u6b21\u81f3\u5c11\u53d6\u8d70\u4e00\u4e2a\u70b9\uff0c\u6ca1\u6709\u70b9\u53ef\u53d6\u5219\u6e38\u620f\u7ed3\u675f\uff0c\u6c42\u5728\u6700\u4f18\u9009\u62e9\u4e0b\u7684\u7ed3\u679c\u3002\n# \u9898\u76ee\u5206\u6790\n\u5927\u4f6c\u4eec\u90fd\u592a\u5f3a\u4e86\uff0c\u8fd9\u7bc7\u9898\u89e3\u5c06\u4f1a\u7740\u91cd\u7ed9\u51fa\u8be6\u7ec6\u7684\u601d\u8003\u8fc7\u7a0b\u3002\n\n\u8fd9\u662f\u4e00\u9053\u535a\u5f08\u8bba\uff0c\u90a3\u4e48\u6211\u4eec\u57fa\u672c\u786e\u5b9a\u601d\u8003\u65b9\u5411\uff1a\u6570\u8bba\u6216 dp\u3002\u663e\u7136\u8fd9\u4e0d\u662f\u6570\u8bba\uff0c\u90a3\u5b83\u5c31\u6781\u53ef\u80fd\u662f\u4e00\u4e2a dp \u4e86\u3002\n\n\u5206\u522b\u9884\u5904\u7406\u51fa\u4ee5 $s$ \u548c $t$ \u4e3a\u6e90\u70b9\u7684\u6700\u77ed\u8def\uff08dijkstra \u5373\u53ef\uff0c\u4e0d\u8fc7\u7c98\u4e86\u5806\u4f18\u5316\u7684\u677f\u5b50\uff09\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a\u73a9\u5bb6\uff0c\u4efb\u610f $x,y$ \u6ee1\u8db3 $dis_x\\le dis_y$\uff0c\u70b9 $x$ \u4e00\u5b9a\u4e0d\u4f1a\u6bd4 $y$ \u5728\u5f53\u524d\u73a9\u5bb6\u8fd9\u91cc\u88ab\u540e\u53d6\uff0c\u4e8e\u662f\u8dd1\u5b8c\u6700\u77ed\u8def\u8fc7\u540e\u8fd9\u9898\u5c31\u548c\u56fe\u6ca1\u5565\u5173\u7cfb\u4e86\uff0c\u76f4\u63a5\u5c06 $dis$ \u79bb\u6563\u5316\u6389\uff0c\u6743\u503c\u7684\u8303\u56f4\u53d8\u4e3a\u4e0e $n$ \u540c\u9636\u3002\n\n$n\\le2000$\uff0c\u8fd9\u66f4\u6697\u793a\u4e86\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $O(n^2)$ \u7684 dp \u89e3\u51b3\u3002\u7b2c\u4e00\u7ef4\u4e00\u5b9a\u7528\u6765\u8868\u793a\u5f53\u524d\u8f6e\u5230\u54ea\u4f4d\u73a9\u5bb6\uff0c\u800c\u6ca1\u6709\u5176\u5b83\u53ef\u4ee5\u7528\u5e38\u6570\u8868\u793a\u7684\u72b6\u6001\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f00\u5230 $f[2][n][n]$\u3002\u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u5c06\u95ee\u9898\u62cd\u5230\u4e86\u5e8f\u5217\u4e0a\uff0c\u6240\u4ee5\u76f4\u63a5\u8bbe $f[op][i][j]$ \u4e3a\u5f53\u524d\u5230\u54ea\u4e2a\u73a9\u5bb6\uff0c\u5269\u4e0b\u7684\u70b9\u5230 $s$ \u7684\u8ddd\u79bb\u5927\u4e8e $i$\uff0c\u5230 $t$ \u7684\u8ddd\u79bb\u5927\u4e8e $j$\uff08\u79bb\u6563\u5316\u540e\u7684\uff09\u3002\u53d1\u73b0\u66b4\u529b\u8f6c\u79fb\u65e0\u6cd5\u8fbe\u5230\u6211\u4eec\u60f3\u8981\u7684 $O(n^2)$\uff0c\u6ce8\u610f\u5230\u6211\u4eec\u53ef\u4ee5\u628a\u533a\u95f4\u5305\u542b\u70b9\u6570\u4ee5\u53ca\u70b9\u6743\u548c\u5728\u79bb\u6563\u5316\u65f6\u7ed9\u9884\u5904\u7406\u51fa\u6765\uff0c\u8fd9\u6837\u8f6c\u79fb\u5c31\u662f $O(n^2)$ \u7684\u4e86\u3002\n# \u4ee3\u7801\n\u8bb0\u5f97\u5f00 `long long` \u54e6\uff0c~~\u6211\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u4e00\u5f00\u59cb\u524d\u7f00\u548c\u5199\u9519\u4e86\u8fd8\u8c03\u4e86\u534a\u5929\u3002~~\n```cpp\n#include<bits/stdc++.h>\n#define R register\n#define I inline\n#define ll long long\n#define ull unsigned long long\n#define db double\nusing namespace std;\n#define pii pair<int,int>\n#define mp(x,y) make_pair(x,y)\n#define fi first\n#define se second\n#define putint(x) printf(\"%d\\n\",x)\n#define putll(x) printf(\"%lld\\n\",x)\n#define putull(x) printf(\"%llu\\n\",x)\n#define lowbit(x) ((x)&(-(x)))\n#define inf (1e9)\n#define INF (1e18)\n#define eps (1e-8)\nI int read()\n{\n\tchar ch=getchar();\n\tint res=0,flag=1;\n\twhile(ch<'0'||ch>'9')\n\t{\n\t\tif(ch=='-')\n\t\t\tflag=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9')\n\t{\n\t\tres=res*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn res*flag;\n}\nint n,m,s,t,p[2001],head[2001],to[200001],nxt[200001],w[200001],tot,x,y,z,n0,n1,cnt[2001][2001];\nll dis[2][2001],tmp[2][2001],sum[2001][2001],f[2][2001][2001];\nbool vis[2001];\npriority_queue< pair<ll,int> >q;\nI void add(int x,int y,int z)\n{\n\tto[++tot]=y;\n\tw[tot]=z;\n\tnxt[tot]=head[x];\n\thead[x]=tot;\n}\nvoid dijkstra(int op,int start)\n{\n\tmemset(dis[op],127/3,sizeof(dis[op]));\n\tmemset(vis,0,sizeof(vis));\n\tdis[op][start]=0;\n\tq.push(make_pair(0,start));\n\twhile(!q.empty())\n\t{\n\t\tint x=q.top().second;\n\t\tq.pop();\n\t\tif(vis[x]) \n\t\t\tcontinue;\n\t\tvis[x]=1;\n\t\tfor(R int i=head[x];i;i=nxt[i])\n\t\t{\n\t\t\tint y=to[i],z=w[i];\n\t\t\tif(dis[op][y]>dis[op][x]+z)\n\t\t\t{\n\t\t\t\tdis[op][y]=dis[op][x]+z;\n\t\t\t\tq.push(make_pair(-dis[op][y],y));\n\t\t\t}\n\t\t}\n\t}\n}\nI int getcnt(int lx,int ly,int rx,int ry)\n{\n\treturn cnt[rx][ry]-cnt[rx][ly-1]-cnt[lx-1][ry]+cnt[lx-1][ly-1];\n}\nI ll getsum(int lx,int ly,int rx,int ry)\n{\n\treturn sum[rx][ry]-sum[rx][ly-1]-sum[lx-1][ry]+sum[lx-1][ly-1];\n}\nint main()\n{\n\tn=read();\n\tm=read();\n\ts=read();\n\tt=read();\n\tfor(R int i=1;i<=n;++i)\t\n\t\tp[i]=read();\n\twhile(m--)\n\t{\n\t\tx=read();\n\t\ty=read();\n\t\tz=read();\n\t\tadd(x,y,z);\n\t\tadd(y,x,z);\n\t}\n\tdijkstra(0,s);\n\tdijkstra(1,t);\n\tmemcpy(tmp,dis,sizeof(tmp));\n\tsort(tmp[0]+1,tmp[0]+n+1);\n\tsort(tmp[1]+1,tmp[1]+n+1);\n\tn0=unique(tmp[0]+1,tmp[0]+n+1)-tmp[0]-1;\n\tn1=unique(tmp[1]+1,tmp[1]+n+1)-tmp[1]-1;\n\tfor(R int i=1;i<=n;++i)\n\t{\n\t\tdis[0][i]=lower_bound(tmp[0]+1,tmp[0]+n0+1,dis[0][i])-tmp[0];\n\t\tdis[1][i]=lower_bound(tmp[1]+1,tmp[1]+n1+1,dis[1][i])-tmp[1];\n\t\t++cnt[dis[0][i]][dis[1][i]];\n\t\tsum[dis[0][i]][dis[1][i]]+=p[i];\n\t}\n\tfor(R int i=1;i<=n0;++i)\n\t\tfor(R int j=1;j<=n1;++j)\n\t\t{\n\t\t\tcnt[i][j]+=cnt[i-1][j]+cnt[i][j-1]-cnt[i-1][j-1];\n\t\t\tsum[i][j]+=sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1];\n\t\t}\n\tfor(R int i=n0;i;--i)\n\t\tfor(R int j=n1;j;--j)\n\t\t{\n\t\t\tif(getcnt(i,j,i,n1))\n\t\t\t\tf[0][i][j]=max(f[0][i+1][j],f[1][i+1][j])+getsum(i,j,i,n1);\n\t\t\telse\n\t\t\t\tf[0][i][j]=f[0][i+1][j];\n\t\t\tif(getcnt(i,j,n0,j))\n\t\t\t\tf[1][i][j]=min(f[0][i][j+1],f[1][i][j+1])-getsum(i,j,n0,j);\n\t\t\telse\n\t\t\t\tf[1][i][j]=f[1][i][j+1];\n\t\t}\n\tif(f[0][1][1]>0)\n\t\tputs(\"Break a heart\");\n\telse if(f[0][1][1]<0)\n\t\tputs(\"Cry\");\n\telse\n\t\tputs(\"Flowers\");\n\treturn 0;\n}\n```",
        "postTime": 1622196493,
        "uid": 68011,
        "name": "\u53e4\u660e\u5730_ypc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3CF536D"
    },
    {
        "content": "[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/536/problem/D) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF536D)\n\n~~\u5176\u5b9e\u8fd9\u9898\u672c\u8be5 2019 \u5e74 12 \u6708\u5c31 AC \u7684\uff08\u8be6\u60c5\u8bf7\u89c1 ycx \u53d1\u6b64\u9898\u9898\u89e3\u7684\u65f6\u95f4\uff09\uff0c\u7136\u9e45\u9e3d\u5230\u4e86\u73b0\u5728\u2026\u2026~~\n\n\u9996\u5148\u4ee5 $s,t$ \u5206\u522b\u4e3a\u6e90\u70b9\u8dd1\u4e24\u904d dijkstra \u662f\u4e0d\u53ef\u907f\u514d\u7684\uff0c\u6c42\u51fa $s,t$ \u5230\u6bcf\u4e2a\u70b9\u7684\u6700\u77ed\u8ddd\u79bb $d1_i,d2_i$\n\n\u5176\u6b21\u8fd8\u53ef\u4ee5\u53d1\u73b0\u4e00\u4ef6\u4e8b\u60c5\uff0c\u90a3\u5c31\u662f\u5bf9\u4e8e $\\forall i,j$\uff0c\u82e5 $d1_i<d1_j$ \u5e76\u4e14 $j$ \u88ab\u9009\u62e9\u4e86\uff0c\u90a3\u4e48 $i$ \u4e00\u5b9a\u88ab\u9009\u62e9\u4e86\uff0c\u5bf9\u4e8e $d2_i$ \u4e5f\u53ef\u5f97\u5230\u7c7b\u4f3c\u7684\u6027\u8d28\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5bf9\u4e8e\u6e38\u620f\u4efb\u610f\u4e00\u79cd\u5c40\u9762\uff0c$\\exist x,y$ \u4f7f\u5f97\u6070\u597d\u53ea\u5269\u4e0b $d1_i\\geq x$ \u4e14 $d2_i\\geq y$ \u7684 $i$ \u6ca1\u6709\u88ab\u9009\u62e9\u3002\u6545\u8003\u8651\u4ee5\u6b64\u4e3a\u72b6\u6001\u8bbe\u8ba1 dp\n\n\u5c06 $d1,d2$ \u79bb\u6563\u5316\u3002\u8bbe $dp_{p,x,y}$ \u8868\u793a\u6b64\u65f6\u8f6e\u5230 $p$\uff08$0$ \u8868\u793a\u5148\u624b\uff0c$1$ \u8868\u793a\u540e\u624b\uff09\uff0c\u8fd8\u5269\u4e0b $d1_i\\geq x$ \u4e14 $d2_i\\geq y$ \u7684\u70b9\u6ca1\u6709\u88ab\u9009\u62e9\uff0c\u6240\u80fd\u5f97\u5230\u7684\u6700\u5927\u5f97\u5206\u3002\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5f88\u5bb9\u6613\u5f97\u5230\uff0c\u4ee5 $p=0$ \u4e3a\u4f8b\uff0c\u663e\u7136\u8fd9\u4e00\u6b65\u64cd\u4f5c\u4e4b\u540e\u7559\u4e0b\u6765\u7684\u5e94\u5f53\u662f $d1_i\\geq z$ \u4e14 $d2_i\\geq y$ \u7684\u57ce\u5e02\uff0c\u5176\u4e2d $z$ \u4e3a\u67d0\u4e2a\u5927\u4e8e $x$ \u7684\u6570\uff0c\u6211\u4eec\u4e0d\u59a8\u679a\u4e3e $z$\uff0c\u8bb0 $c_{x,y}$ \u4e3a $d1_i\\geq x$ \u4e14 $d2_i\\ge y$ \u7684\u57ce\u5e02\u4e2a\u6570\uff0c$s_{x,y}$ \u4e3a $d1_i\\geq x$ \u4e14 $d2_i\\ge y$ \u7684\u57ce\u5e02\u7684\u6743\u503c\u4e4b\u548c\uff0c\u7531\u4e8e\u5148\u624b\u8981\u591a\u5360\u9886\u4e00\u4e9b\u57ce\u5e02\uff0c\u6545 $c_{z,y}>c_{x,y}$\uff0c\u6545\u6211\u4eec\u6709\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b $dp_{0,x,y}=s_{x,y}-\\min\\limits_{c_{z,y}>c_{x,y}}dp_{1,z,y}$\uff0c$dp_{1,x,y}$ \u4e5f\u540c\u7406\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u5bf9\u4e8e\u67d0\u4e2a $dp_{p,x,y}$\uff0c\u5176\u51b3\u7b56\u7684\u96c6\u5408\u662f\u4e00\u6bb5\u540e\u7f00\uff0c\u6545\u53ef\u4ee5\u9884\u5904\u7406 $nt1_{i,j}$ \u8868\u793a\u7b2c\u4e00\u4e2a\u6ee1\u8db3 $c_{k,j}>c_{i,j}$ \u7684 $k$\uff0c$nt2_{i,j}$ \u8868\u793a $c_{i,l}>c_{i,j}$ \u7684 $l$\uff0c\u8fd9\u4e2a\u9884\u5904\u7406\u590d\u6742\u5ea6\u663e\u7136\u662f $n^2$ \u7684\uff0c\u5904\u7406\u5b8c\u4e4b\u540e\u5c31\u53ef\u4ee5\u5229\u7528\u540e\u7f00 $\\min$ \u8fdb\u884c $\\mathcal O(1)$ \u8f6c\u79fb\u4e86\u3002\n\n\u6700\u7ec8\u5148\u624b\u5f97\u5206\u7684\u6700\u5927\u503c\u5373\u4e3a $dp_{0,0,0}$\uff0c\u540e\u624b\u5f97\u5206\u5373\u4e3a $s_{0,0}-dp_{0,0,0}$\uff0c\u6bd4\u8f83\u4e8c\u8005\u5927\u5c0f\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $n^2$\u3002\u603b\u4e4b\u6b64\u9898\u7b97 D1D \u4e2d\u8f83\u7b80\u5355\u7684\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\nnamespace fastio{\n\t#define FILE_SIZE 1<<23\n\tchar rbuf[FILE_SIZE],*p1=rbuf,*p2=rbuf,wbuf[FILE_SIZE],*p3=wbuf;\n\tinline char getc(){return p1==p2&&(p2=(p1=rbuf)+fread(rbuf,1,FILE_SIZE,stdin),p1==p2)?-1:*p1++;}\n\tinline void putc(char x){(*p3++=x);}\n\ttemplate<typename T> void read(T &x){\n\t\tx=0;char c=getchar();T neg=0;\n\t\twhile(!isdigit(c)) neg|=!(c^'-'),c=getchar();\n\t\twhile(isdigit(c)) x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\t\tif(neg) x=(~x)+1;\n\t}\n\ttemplate<typename T> void recursive_print(T x){if(!x) return;recursive_print(x/10);putc(x%10^48);}\n\ttemplate<typename T> void print(T x){if(!x) putc('0');if(x<0) putc('-'),x=~x+1;recursive_print(x);}\n\tvoid print_final(){fwrite(wbuf,1,p3-wbuf,stdout);}\n}\nconst int MAXN=2e3;\nconst int MAXM=1e5;\nint n,m,s,t,p[MAXN+5],to[MAXM*2+5],nxt[MAXM*2+5],cst[MAXM*2+5],hd[MAXN+5],ec=0;\nvoid adde(int u,int v,int w){to[++ec]=v;cst[ec]=w;nxt[ec]=hd[u];hd[u]=ec;}\nll d1[MAXN+5],d2[MAXN+5],key1[MAXN+5],key2[MAXN+5],uni1[MAXN+5],uni2[MAXN+5];\nint c1[MAXN+5],c2[MAXN+5],num1=0,num2=0,cnt[MAXN+5][MAXN+5];ll sum[MAXN+5][MAXN+5];\nll dp[2][MAXN+5][MAXN+5],mn[2][MAXN+5][MAXN+5];\nint nt1[MAXN+5][MAXN+5],nt2[MAXN+5][MAXN+5];\nint main(){\n\tscanf(\"%d%d%d%d\",&n,&m,&s,&t);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&p[i]);\n\tfor(int i=1,u,v,w;i<=m;i++){scanf(\"%d%d%d\",&u,&v,&w);adde(u,v,w);adde(v,u,w);}\n\tpriority_queue<pair<ll,int>,vector<pair<ll,int> >,greater<pair<ll,int> > > q;\n\tmemset(d1,63,sizeof(d1));d1[s]=0;q.push(mp(0,s));\n\twhile(!q.empty()){\n\t\tpii pr=q.top();q.pop();int x=pr.se;\n\t\tfor(int e=hd[x];e;e=nxt[e]){\n\t\t\tint y=to[e],z=cst[e];\n\t\t\tif(d1[y]>d1[x]+z){\n\t\t\t\td1[y]=d1[x]+z;\n\t\t\t\tq.push(mp(d1[y],y));\n\t\t\t}\n\t\t}\n\t}\n\tmemset(d2,63,sizeof(d2));d2[t]=0;q.push(mp(0,t));\n\twhile(!q.empty()){\n\t\tpii pr=q.top();q.pop();int x=pr.se;\n\t\tfor(int e=hd[x];e;e=nxt[e]){\n\t\t\tint y=to[e],z=cst[e];\n\t\t\tif(d2[y]>d2[x]+z){\n\t\t\t\td2[y]=d2[x]+z;\n\t\t\t\tq.push(mp(d2[y],y));\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) key1[i]=d1[i],key2[i]=d2[i];\n\tsort(key1+1,key1+n+1);sort(key2+1,key2+n+1);key1[0]=key2[0]=-1;\n\tfor(int i=1;i<=n;i++){\n\t\tif(key1[i]!=key1[i-1]) uni1[++num1]=key1[i];\n\t\tif(key2[i]!=key2[i-1]) uni2[++num2]=key2[i];\n\t}\n\tfor(int i=1;i<=n;i++) c1[i]=lower_bound(uni1+1,uni1+num1+1,d1[i])-uni1;\n\tfor(int i=1;i<=n;i++) c2[i]=lower_bound(uni2+1,uni2+num2+1,d2[i])-uni2;\n//\tfor(int i=1;i<=n;i++) printf(\"%d %d\\n\",c1[i],c2[i]);\n\tfor(int i=1;i<=n;i++) cnt[c1[i]][c2[i]]++,sum[c1[i]][c2[i]]+=p[i];\n\tfor(int i=num1;i;i--) for(int j=num2;j;j--){\n\t\tcnt[i][j]+=cnt[i+1][j]+cnt[i][j+1]-cnt[i+1][j+1];\n\t\tsum[i][j]+=sum[i+1][j]+sum[i][j+1]-sum[i+1][j+1];\n\t}\n//\tfor(int i=1;i<=num1;i++) for(int j=1;j<=num2;j++)\n//\t\tprintf(\"%d %d %lld %lld\\n\",i,j,cnt[i][j],sum[i][j]);\n\tfor(int i=num1;i;i--) for(int j=num2;j;j--){\n\t\tnt1[i][j]=(cnt[i][j]==cnt[i+1][j])?nt1[i+1][j]:(i+1);\n\t\tnt2[i][j]=(cnt[i][j]==cnt[i][j+1])?nt2[i][j+1]:(j+1);\n\t}\n\tfor(int i=num1;i;i--) for(int j=num2;j;j--){\n\t\tif(!cnt[i][j]) continue;\n\t\tdp[0][i][j]=sum[i][j]-mn[1][nt1[i][j]][j];\n\t\tdp[1][i][j]=sum[i][j]-mn[0][i][nt2[i][j]];\n//\t\tprintf(\"%d %d %d %d\\n\",i,j,dp[0][i][j],dp[1][i][j]);\n\t\tmn[0][i][j]=min(mn[0][i][j+1],dp[0][i][j]);\n\t\tmn[1][i][j]=min(mn[1][i+1][j],dp[1][i][j]);\n\t} ll sgn=sum[1][1]-(dp[0][1][1]<<1);\n//\tprintf(\"%d\\n\",dp[0][1][1]);\n\tprintf(\"%s\\n\",(sgn>0)?\"Cry\":((!sgn)?\"Flowers\":\"Break a heart\"));\n\treturn 0;\n}\n```\n\n",
        "postTime": 1614352225,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF536D\u3010Tavas in Kansas\u3011"
    },
    {
        "content": "### \u9898\u610f\n- \u7ed9\u5b9a$n$\u4e2a\u70b9$m$\u6761\u8fb9\u5e26\u70b9\u6743\u7684\u65e0\u5411\u8054\u901a\u56fe\n- A\u5728$s$\u70b9\uff0cB\u5728$t$\u70b9\uff0c\u6bcf\u4eba\u6700\u521d\u7684\u503c\u4e3a0\uff0c\u6bcf\u4eba\u6bcf\u6b21\u53ef\u4ee5\u9009\u62e9\u4e00\u4e2a\u8ddd\u79bb$d$\uff0c\u5c06\u6240\u6709\u4e0e\u4ed6\u81ea\u5df1\u8ddd\u79bb\u4e0d\u8d85\u8fc7$d$\u7684\u70b9\u6807\u8bb0\n- \u7136\u540e\u5c06\u81ea\u5df1\u7684\u503c\u52a0\u4e0a\u672c\u6b21\u6240\u6709\u6807\u8bb0\u4e86\u7684\u70b9\u7684\u6743\u503c\uff0c\u6bcf\u6b21\u81f3\u5c11\u6807\u8bb0\u4e00\u4e2a\u70b9\uff0c\u76f4\u5230\u6240\u6709\u70b9\u90fd\u6807\u8bb0\u4e3a\u6b62\uff0c\u6700\u540e\u503c\u5927\u7684\u4eba\u83b7\u80dc\n\n\u535a\u5f08\u8bba\uff0c\u5c06\u6bcf\u4e2a\u70b9\u5230\u53e6\u5916\u4e24\u70b9\u7684\u8ddd\u79bb\u8dd1\u51fa\u6765\uff0c\u7136\u540e\u6254\u5230\u5750\u6807\u7cfb\u91cc\uff0c\u53d1\u73b0\u6bcf\u6b21\u9009\u62e9\u76f8\u5f53\u4e8e\u5c06\u6bcf\u4e2a\u4eba\u7684\u76f4\u7ebf\u5411\u4e0b/\u53f3\u5e73\u79fb\uff0c\u6807\u8bb0\u6240\u6709\u672a\u6807\u8bb0\u7684\u70b9\n\u8003\u8651\u8bb0$f_{n, m, 0/1}$\u8868\u793a\u5f53\u524d\u53ef\u4ee5\u9009$n~N,m~M$\u70b9\uff0c\u5148\u624b/\u540e\u624b\u80fd\u5f97\u5230\u7684\u6700\u5927\u6743\u503c\uff0c\u7136\u540e\u4ece\u540e\u5f80\u524d\u4ee5\u53ca\u4ece\u4e0b\u5f80\u4e0a\u8f6c\u79fb\u5c31\u597d\u4e86\n\n```cpp\n#include<bits/stdc++.h>\n#define For(i, a, b) for(int i = (a), en = (b); i <= en; ++i)\n#define Rof(i, a, b) for(int i = (a), en = (b); i >= en; --i)\n#define Tra(u, i) for(int i = hd[u]; ~i; i = e[i].net)\n#define LL long long\n#define DD double\n#define LD long double\n#define pb push_back\n#define mp make_pair\n#define fir first\n#define sec second\n#define inf 0x3f3f3f3f\n#define Inf 0x3f3f3f3f3f3f3f3f\n#define eps 1e-12\n#define maxn 2000\n#define maxm 100000\nusing namespace std;\n\nint n, m, s, t, hd[maxn + 5], len = 0, a[maxn + 5], cnt[2];\nLL sum[maxn + 5][maxn  + 5], b[2][maxn + 5], ma[maxn + 5][maxn + 5], f[2][maxn + 5][maxn + 5], mx[maxn + 5], now[maxn + 5];\nstruct Edge{int v, w, net;} e[2 * maxn + 5];\nvoid add(int u, int v, int w){e[len] = (Edge){v, w, hd[u]}; hd[u] = len++;}\n\nLL dis[2][maxn + 5];\nvoid dij(int x, int ty){\n\tmemset(dis[ty], inf, sizeof dis[ty]); dis[ty][x] = 0;\n\tpriority_queue<pair<LL, int> > q;\n\tq.push(mp(0, x));\n\twhile(q.size()){\n\t\tint u = q.top().sec; q.pop();\n\t\tTra(u, i){\n\t\t\tint v = e[i].v, w = e[i].w;\n\t\t\tif(dis[ty][v] <= dis[ty][u] + w) continue;\n\t\t\tdis[ty][v] = dis[ty][u] + w;\n\t\t\tq.push(mp(-dis[ty][v], v));\n\t\t}\n\t}\n}\n\nint main(){\n\t//freopen(\"in\", \"r\", stdin);\n\tmemset(hd, -1, sizeof hd);\n\tscanf(\"%d %d %d %d\", &n, &m, &s, &t);\n\tFor(i, 1, n) scanf(\"%d\", &a[i]);\n\tFor(i, 1, m){\n\t\tint u, v, w; scanf(\"%d %d %d\", &u, &v, &w);\n\t\tadd(u, v, w); add(v, u, w);\n\t}\n\t\n\tdij(s, 0);\n\tFor(i, 1, n) b[0][++cnt[0]] = dis[0][i];\n\tsort(b[0] + 1, b[0] + cnt[0] + 1);\n\tcnt[0] = unique(b[0] + 1, b[0] + cnt[0] + 1) - b[0] - 1;\n\tFor(i, 1, n) dis[0][i] = lower_bound(b[0] + 1, b[0] + cnt[0] + 1, dis[0][i]) - b[0];\n\n\tdij(t, 1);\n\tFor(i, 1, n) b[1][++cnt[1]] = dis[1][i];\n\tsort(b[1] + 1, b[1] + cnt[1] + 1);\n\tcnt[1] = unique(b[1] + 1, b[1] + cnt[1] + 1) - b[1] - 1;\n\tFor(i, 1, n) dis[1][i] = lower_bound(b[1] + 1, b[1] + cnt[1] + 1, dis[1][i]) - b[1];\n\n\tFor(i, 1, n) sum[dis[0][i]][dis[1][i]] += a[i], ma[dis[0][i]][dis[1][i]] = 1;\n\n\t/*cout << cnt[0] << \" \" << cnt[1] << endl;\n\tFor(i, 1, cnt[0]){\n\t\tFor(j, 1, cnt[1]) cout << sum[i][j] << \" \";\n\t\tcout << endl;\n\t}\n\tcout << endl;*/\n\t\n\tRof(i, cnt[0], 1) Rof(j, cnt[1], 1){\n\t\tsum[i][j] += sum[i + 1][j] + sum[i][j + 1] - sum[i + 1][j + 1];\n\t\tma[i][j] += ma[i + 1][j] + ma[i][j + 1] - ma[i + 1][j + 1];\n\t}\n\n\tFor(i, 1, cnt[1]) now[i] = cnt[0], mx[i] = cnt[0] + 1;\n\tRof(i, cnt[0], 1){\n\t\tint nowi = cnt[1], mxi = cnt[1] + 1;\n\t\tRof(j, cnt[1], 1){\n\t\t\twhile(now[j] > i && ma[i][j] - ma[now[j]][j]){\n\t\t\t\tif(sum[now[j]][j] - f[1][now[j]][j] + sum[i][j] - sum[now[j]][j] > sum[mx[j]][j] - f[1][mx[j]][j] + sum[i][j] - sum[mx[j]][j]) mx[j] = now[j];\n\t\t\t\tnow[j]--;\n\t\t\t}\n\t\t\tf[0][i][j] = sum[mx[j]][j] - f[1][mx[j]][j] + sum[i][j] - sum[mx[j]][j];\n\t\t\t\n\t\t\twhile(nowi > j && ma[i][j] - ma[i][nowi]){\n\t\t\t\tif(sum[i][nowi] - f[0][i][nowi] + sum[i][j] - sum[i][nowi] >= sum[i][mxi] - f[0][i][mxi] + sum[i][j] - sum[i][mxi]) mxi = nowi;\n\t\t\t\tnowi--;\n\t\t\t}\n\t\t\tf[1][i][j] = sum[i][mxi] - f[0][i][mxi] + sum[i][j] - sum[i][mxi];\n\t\t}\n\t}\n\t\n\tLL tem = f[0][1][1] - (sum[1][1] - f[0][1][1]);\n\tif(tem > 0) puts(\"Break a heart\");\n\telse if(tem < 0) puts(\"Cry\");\n\telse puts(\"Flowers\");\n\treturn 0;\n}\n```",
        "postTime": 1601864651,
        "uid": 114164,
        "name": "lprdsb",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF536D \u3010Tavas in Kansas\u3011"
    },
    {
        "content": "#### CF536D Tavas in Kansas\n\n\u795e\u5947\u7684$dp$\u9898\n\n\u9996\u5148\u7531\u4e8e\u503c\u57df\u5f88\u5927\uff0c\u4f46\u53ef\u4ee5\u53d1\u73b0\u53ef\u4ee5\u8f6c\u5316\u4e3a\u53ea\u53d6\u6ee1\u8db3$dis(i,t)=x$\u6216$dis(s,i)=x$\u7684$x$\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5148\u8dd1\u4e24\u904d\u6700\u77ed\u8def\u4e4b\u540e\u79bb\u6563\u5316\u3002\n\n\u8bbe$f(0/1,x,y)$\u8868\u793a\u7b2c\u4e00\u4e2a\u4eba\u53d6\u4e86$dis(s,i)\\leq x$\u7684\u70b9\uff0c\u7b2c\u4e8c\u4e2a\u4eba\u53d6\u4e86$dis(i,t)\\leq y$\u7684\u70b9\u65f6\uff0c\u5bf9\u5148\u624b/\u540e\u624b\u6700\u6709\u5229\u7684\u65f6\u5019\u7684\u5dee\u503c\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u7b49\u4ef7\u4e8e\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e00\u4e2a\u5750\u6807$(dis(s,i),dis(i,t))$\uff0c\u4e4b\u540e\u7b2c\u4e00\u4e2a\u4eba\u6bcf\u6b21\u53ef\u4ee5\u53d6\u524d\u82e5\u5e72\u884c\uff0c\u7b2c\u4e8c\u4e2a\u4eba\u53ef\u4ee5\u53d6\u524d\u82e5\u5e72\u5217\u3002\n\n\u90a3\u4e48$f(0/1,x,y)$\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5728\u8fd9\u4e2a\u5750\u6807\u7cfb\u4e2d\uff0c\u4ee5$(x+1,y+1)$\u548c$(n,m)$\u4e3a\u9876\u70b9\u7684\u77e9\u5f62\u8fd8\u672a\u88ab\u53d6\u7684\uff0c\u5bf9\u5148\u624b/\u540e\u624b\u6700\u6709\u5229\u7684\u65f6\u5019\u7684\u5dee\u503c\u3002\n\n\u8f6c\u79fb\u7684\u8bdd\u5c31\u679a\u4e3e\u4e0a\u4e00\u884c/\u5217\u662f\u4e0d\u662f\u8fd9\u4e2a\u4eba\u53d6\u7684\u5373\u53ef\uff0c\u6ce8\u610f\u5982\u679c\u8fd9\u4e00\u884c/\u5217\u6ca1\u6709\u6570\u7684\u8bdd\u90a3\u4e48\u5fc5\u987b\u662f\u8fde\u7740\u4e0a\u6b21\u7684\u4e00\u8d77\u53d6\uff0c\u56e0\u4e3a\u4e0d\u80fd\u53d6\u7a7a\u3002\n\n\u7136\u800c\u4f60\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u867d\u7136\u597d\u8f6c\u79fb\u4f46\u662f\u4e0d\u597d\u8ba1\u7b97\u7ed3\u679c\uff0c\u539f\u56e0\u662f\u56e0\u4e3a\u6211\u4eec\u53ea\u77e5\u9053\u7b2c\u4e00\u4e2a\u4eba\u5148\u624b\u4f46\u662f\u4e0d\u77e5\u9053\u6700\u540e\u4e00\u4e2a\u53d6\u5f97\u4eba\u662f\u8c01\uff0c\u90a3\u4e48\u8003\u8651\u5012\u8fc7\u6765$dp$\uff0c\u6700\u7ec8\u7b54\u6848\u5373\u4e3a$f(0,0,0)$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#include<vector>\n#define int long long\n#define pb push_back\n#define mp make_pair\n#define N 200005\n#define M 2005\nusing namespace std;\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nint n,m,s,t,v[N],w[N],head[N],nxt[N],cnt,dist[N],ds[N],dt[N],a[N],f[2][M][M],num[M][M],sum[M][M],vis[N];\nint sumx[M][M],sumy[M][M],numx[M][M],numy[M][M]; \nvector<int>dds,ddt;\nvoid add(int a,int b,int c)\n{\n\tv[++cnt]=b;\n\tw[cnt]=c;\n\tnxt[cnt]=head[a];\n\thead[a]=cnt;\n}\nvoid dij(int S)\n{\n\tmemset(dist,0x3f,sizeof(dist));\n\tmemset(vis,0,sizeof(vis));\n\tdist[S]=0;\n\tpriority_queue<pair<int,int>,vector<pair<int,int> >,greater<pair<int,int> > >q;\n\tq.push(mp(0,S));\n\twhile(!q.empty())\n\t{\n\t\tint c=q.top().second;\n\t\tq.pop();if(vis[c])continue;vis[c]=1;\n\t\tfor(int i=head[c];i;i=nxt[i])\n\t\t{\n\t\t\tif(dist[v[i]]>dist[c]+w[i])\n\t\t\t{\n\t\t\t\tdist[v[i]]=dist[c]+w[i];\n\t\t\t\tq.push(mp(dist[v[i]],v[i]));\n\t\t\t}\n\t\t}\n\t}\n}\nint getsumx(int x,int l,int r){return sumx[x][r]-sumx[x][l-1];}\nint getsumy(int y,int l,int r){return sumy[r][y]-sumy[l-1][y];}\nint getnumx(int x,int l,int r){return sumx[x][r]-sumx[x][l-1];}\nint getnumy(int y,int l,int r){return sumy[r][y]-sumy[l-1][y];}\nsigned main()\n{\n\tn=read();m=read();s=read();t=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint x=read(),y=read(),z=read();\n\t\tadd(x,y,z);add(y,x,z);\n\t}\n\tdij(s);for(int i=1;i<=n;i++)ds[i]=dist[i],dds.pb(ds[i]);\n\tdij(t);for(int i=1;i<=n;i++)dt[i]=dist[i],ddt.pb(dt[i]);\n\tsort(dds.begin(),dds.end());sort(ddt.begin(),ddt.end());\n\tint mm=unique(dds.begin(),dds.end())-dds.begin();\n\tint nn=unique(ddt.begin(),ddt.end())-ddt.begin();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint xx=lower_bound(dds.begin(),dds.end(),ds[i])-dds.begin()+1;\n\t\tint yy=lower_bound(ddt.begin(),ddt.end(),dt[i])-ddt.begin()+1;\n\t\tnum[xx][yy]++;sum[xx][yy]+=a[i];\n\t\t//cout<<xx<<\" \"<<yy<<\" \"<<ds[i]<<\" \"<<dt[i]<<endl;\n\t}\n\tfor(int i=1;i<=nn+1;i++)\n\t{\n\t\tfor(int j=1;j<=mm+1;j++)\n\t\t{\n\t\t\tsumx[i][j]=sumx[i][j-1]+sum[i][j];\n\t\t\tsumy[i][j]=sumy[i-1][j]+sum[i][j];\n\t\t\tnumx[i][j]=numx[i][j-1]+num[i][j];\n\t\t\tnumy[i][j]=numy[i-1][j]+num[i][j];\n\t\t}\n\t}\n\tfor(int i=nn;i>=0;i--)\n\t{\n\t\tfor(int j=mm;j>=0;j--)\n\t\t{\n\t\t\tif(i!=nn)\n\t\t\t{\n\t\t\t\tint now=getnumx(i+1,j+1,mm);\n\t\t\t    int sc=getsumx(i+1,j+1,mm);\n\t\t\t    if(!now)f[0][i][j]=f[0][i+1][j];\n\t\t\t    else f[0][i][j]=max(f[0][i+1][j],f[1][i+1][j])+sc;\n\t\t\t}\n\t\t\tif(j!=mm)\n\t\t\t{\n\t\t\t\tint now=getnumy(j+1,i+1,nn);\n\t\t\t\tint sc=getsumy(j+1,i+1,nn);\n\t\t\t    if(!now)f[1][i][j]=f[1][i][j+1];\n\t\t\t    else f[1][i][j]=min(f[0][i][j+1],f[1][i][j+1])-sc;\n\t\t\t}\n\t\t}\n\t}\n\tif(f[0][0][0]>0)puts(\"Break a heart\");\n\telse if(f[0][0][0]==0)puts(\"Flowers\");\n\telse puts(\"Cry\");\n}\n\n```\n\n",
        "postTime": 1611497028,
        "uid": 179600,
        "name": "shao0320",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF536D \u3010Tavas in Kansas\u3011"
    }
]