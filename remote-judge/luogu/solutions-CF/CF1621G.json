[
    {
        "content": "\u7b97\u6bcf\u4e2a\u5e8f\u5217\u7684\u8d21\u732e\u548c\u662f\u4e0d\u597d\u7b97\u7684\uff0c\u53ef\u4ee5\u7b97\u6bcf\u4e2a\u4f4d\u7f6e\u6709\u8d21\u732e\u7684\u6b21\u6570\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u4e2a $x$\uff0c\u4ee4 $y$ \u4e3a\u6700\u5927\u7684\u6ee1\u8db3 $a_y>a_x$ \u7684\u4f4d\u7f6e\uff0c\u5bb9\u6613\u53d1\u73b0\uff0c$x$ \u6709\u8d21\u732e\u5f53\u4e14\u4ec5\u5f53 $x$ \u6240\u5728\u7684\u8fd9\u4e2a\u5b50\u5e8f\u5217\u7684\u53f3\u7aef\u70b9 $<y$\u3002\n\n\u6211\u4eec\u540c\u65f6\u53ef\u4ee5\u8f7b\u6613\u7684\u53d1\u73b0\uff0c$a_y$ \u662f\u4e00\u4e2a\u4e25\u683c\u540e\u7f00\u6700\u5927\u503c\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5f97\u51fa\u4e00\u4e2a $O(n^2\\log n)$ \u7684\u505a\u6cd5\uff0c\u679a\u4e3e\u4e00\u4e2a $x$\uff0c\u518d\u6c42\u51fa $x\\sim y-1$ \u4e2d\u5305\u542b $x$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u4e2a\u6570\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u4f18\u5316\u5373\u53ef\u3002\n\n\u7ee7\u7eed\u4ee4 $y$ \u4e3a\u6700\u5927\u7684\u6ee1\u8db3 $a_y>a_x$ \u7684\u4f4d\u7f6e\u3002\n\n\u8fdb\u4e00\u6b65\u4f18\u5316\u9700\u8981\u8003\u8651\u9898\u76ee\u6027\u8d28\uff0c\u6211\u4eec\u5148\u5047\u8bbe\u6240\u6709\u5305\u542b $x$ \u7684\u5b50\u5e8f\u5217\u90fd\u6709\u8d21\u732e\uff0c\u518d\u51cf\u53bb\u6ca1\u6709\u8d21\u732e\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u6ca1\u6709\u8d21\u732e\u5f53\u4e14\u4ec5\u5f53\u5b50\u5e8f\u5217\u4ee5 $y$ \u7ed3\u5c3e\uff0c\u56e0\u4e3a\u7ed3\u5c3e $<y$ \u4e00\u5b9a\u6709\u8d21\u732e\uff0c\u800c\u7ed3\u5c3e\u5927\u4e8e $y$ \u7684\u8bdd\u5c31\u4e0d\u6ee1\u8db3 $y$ \u4e3a\u6700\u5927\u7684\u6ee1\u8db3 $a_y>a_x$ \u7684\u4f4d\u7f6e\u3002\n\n\u4e8e\u662f\u6211\u4eec\u628a\u95ee\u9898\u8f6c\u4e3a\u4e86\u8ba1\u6570\u6240\u6709\u4ee5 $x$ \u5f00\u5934\u4ee5 $y$ \u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\uff0c\u4e0b\u6587\u79f0\u4e4b\u4e3a\u201c\u8be2\u95ee\u201d\u3002\n\n\u8fdb\u4e00\u6b65\u53d1\u73b0\uff0c\u4ee4 $z$ \u4e3a\u6ee1\u8db3 $z>y$\uff0c\u4e14 $a_z$ \u6700\u5927\u7684\u4f4d\u7f6e\uff0c\u5bf9\u4e8e $y$ \u540c\u4e00\u4e2a $y$ \u5bf9\u5e94\u7684\u6240\u6709 $x$\uff0c\u90fd\u6ee1\u8db3 $a_z\\leq a_x<a_y$\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u540c\u4e00\u4e2a $y$\uff0c\u5bf9\u5e94\u7684 $x$ \u7684\u503c\u57df\u662f\u5728\u4e00\u4e2a\u533a\u95f4\u7684\uff0c\u7531\u4e8e\u662f\u4e0a\u5347\u5b50\u5e8f\u5217\u8ba1\u6570\uff0c\u4e0d\u5728\u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u6570\u662f\u4e00\u5b9a\u6ca1\u7528\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u679a\u4e3e\u4e00\u4e2a $y$\uff0c\u5c06\u6240\u6709\u6ee1\u8db3 $a_z\\leq a_x<a_y$ \u7684 $x$ \u4fdd\u7559\uff0c\u8ba1\u7b97\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\uff0c\u7531\u4e8e\u6bcf\u4e2a $x$ \u53ea\u4f1a\u6ee1\u8db3\u4e00\u4e2a\u533a\u95f4\u7684\u9650\u5236\uff0c\u603b\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read(){\n\tre int t=0;re char v=getchar();\n\twhile(v<'0')v=getchar();\n\twhile(v>='0')t=(t<<3)+(t<<1)+v-48,v=getchar();\n\treturn t;\n}\nconst int M=1e9+7;\ninline void add(re int &x,re int y){(x+=y)>=M?x-=M:x;}\ninline int Mod(re int x){return x>=M?x-M:x;}\ninline int ksm(re int x,re int y){\n\tre int s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%M;\n\t\tx=1ll*x*x%M,y>>=1;\n\t}\n\treturn s;\n}\nint c[200002],b[200002],N,f[200002],ans,g[200002],O[200002];\ninline void addd(re int x,re int y){\n\tfor(;x<=N;x+=x&(-x))add(c[x],y);\n}\ninline int ask(re int x,re int s=0){\n\tfor(;x;x^=x&(-x))add(s,c[x]);\n\treturn s;\n}\ninline void Get(vector<int>&a,re int x){\n\tint n=a.size()-1;N=n;\n\tfor(re int i=1;i<=n;++i)b[i]=a[i];\n\tsort(b+1,b+n+1);\n\tfor(re int i=1;i<=n;++i)a[i]=lower_bound(b+1,b+n+1,a[i])-b;\n\tfor(re int i=n;i;--i){\n\t\tf[i]=Mod(ask(n)-ask(a[i])+M);\n\t\tif(x==1||i==n)add(f[i],1);\n\t\taddd(a[i],f[i]),add(ans,1ll*x*f[i]%M*g[O[i]]%M);\n\t}\n\tfor(re int i=1;i<=n;++i)addd(a[i],M-f[i]);\n}\nint t,n,m,a[200002],A,B,stk[200002],tp,v[200002],p[200002];\nchar s[1000002];\ninline bool cmp(re int x,re int y){\n\treturn a[x]==a[y]?x>y:a[x]<a[y];\n}\nint main(){\n\tt=read();\n\twhile(t--){\n\t\tn=read();\n\t\tvector<int>tmp;ans=0;\n\t\tfor(re int i=1;i<=n;++i)a[i]=read(),p[i]=i,v[i]=0,b[i]=a[i],O[i]=i;\n\t\tsort(b+1,b+n+1);\n\t\tfor(re int i=1;i<=n;++i)a[i]=lower_bound(b+1,b+n+1,a[i])-b;\n\t\tN=n;\n\t\tfor(re int i=1;i<=n;++i){\n\t\t\tg[i]=ask(a[i]-1),add(g[i],1);\n\t\t\taddd(a[i],g[i]);\n\t\t}\n\t\tfor(re int i=1;i<=n;++i)addd(a[i],M-g[i]);\n\t\tfor(re int i=0;i<=n;++i)tmp.push_back(a[i]);\n\t\tre int mx=0;\n\t\tfor(re int i=n;i;--i){\n\t\t\tif(a[i]==mx)add(ans,M-g[i]);\n\t\t\tmx=max(mx,a[i]);\n\t\t}\n\t\tGet(tmp,1);\n\t\ttp=0;\n\t\tstk[tp=1]=n;\n\t\tfor(re int i=n-1;i;--i)if(a[i]>a[stk[tp]])stk[++tp]=i;\n\t\tsort(p+1,p+n+1,cmp);\n\t\tfor(re int i=1;i<=tp;++i)v[stk[i]]=1;\n\t\tfor(re int i=1,j;i<=n;i=j+1){\n\t\t\tint tot=0;j=i;\n\t\t\twhile(1){\n\t\t\t\tO[++tot]=p[j];\n\t\t\t\tif(v[p[j]])break;\n\t\t\t\t++j;\n\t\t\t\tif(j>n){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(j>n)break;\n\t\t\ttmp.clear();tmp.push_back(0);\n\t\t\tsort(O+1,O+tot+1);\n\t\t\twhile(!v[O[tot]])--tot;\n\t\t\tfor(re int k=1;k<=tot;++k)tmp.push_back(a[O[k]]);\n\t\t\tGet(tmp,M-1);\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n}\n\u00a0\n```\n",
        "postTime": 1641293609,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1621G"
    },
    {
        "content": "~~\u8fd9\u4e2a\u6807\u9898\u53d6\u5f97\u597d\u4e2d\u4e8c\u554a\u3002~~\n\n\u770b\u5230\u8fd9\u79cd\u9650\u5236\u5f88\u5947\u602a\u800c\u4e14\u8ddf\u5927\u5c0f\u76f8\u5173\u7684\u9898\uff0c\u5c31\u60f3\u8bd5\u8bd5\u5728\u9006\u6392\u5217\u91cc\u8003\u8651\u3002\n\n\u9996\u5148\u628a\u8f93\u5165\u8f6c\u5316\u4e3a\u6392\u5217\uff0c\u79bb\u6563\u5316\uff0c\u5982\u679c\u6709\u76f8\u540c\u7684\uff0c\u8ba4\u4e3a\u540e\u9762\u7684\u66f4\u5c0f\uff08\u56e0\u4e3a\u8981\u6c42\u4e25\u683c\u4e0a\u5347\uff09\u3002\n\n**\u5173\u952e\u6b65\u9aa4**\uff1a\u5bf9\u4e8e\u8fd9\u4e2a\u6392\u5217 $p$\uff0c\u8bbe\u5176\u9006\u6392\u5217\u4e3a $q$\u3002\n\n\u7136\u540e\u628a\u8d21\u732e\u7684\u6761\u4ef6\u91cd\u65b0\u8bf4\u4e00\u904d\u3002\n\n- \u201c$p$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u201d\uff0c\u4e00\u4e00\u5bf9\u5e94 $q$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u3002\n- \u201c\u5b58\u5728 $j$ \u5728\u8fd9\u4e2a\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20 $k$ \u4e4b\u540e\uff0c$a_j>a_i$\u201d\uff0c\u5bf9\u5e94\uff0c\u5b58\u5728 $q_{a_j}>q_{a_k}$\uff0c$a_j>a_i$\u3002\u76f4\u63a5\u5728 $q$ \u91cc\u8003\u8651\uff0c\u5c31\u662f\u5b58\u5728 $q_{j}>q_{k}$\uff0c$j>i$\u3002\u663e\u7136\uff0c\u8fd9\u7b49\u4ef7\u4e8e $k$ \u4e0d\u662f $q$ \u7684\u540e\u7f00\u6700\u5927\u503c\u3002\n\n\u6211\u4eec\u518d\u628a\u9898\u76ee\u8bf4\u4e00\u904d\uff1a\n\n- \u5bf9\u4e8e $q$ \u4e2d\u7684\u7b2c $i$ \u4e2a\u503c\uff0c\u4ed6\u5728\u67d0\u4e2a\u4e0a\u5347\u5b50\u5e8f\u5217\u91cc\u9762\u6709\u8d21\u732e\uff0c\u5f53\u4e14\u4ec5\u5f53\u8fd9\u4e2a\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u7ed3\u5c3e $k$ \u4e0d\u662f $q$ \u7684\u540e\u7f00\u6700\u5927\u503c\u3002\n\n\u505a\u6cd5\u5c31\u5f88\u663e\u7136\u4e86\uff0c\u679a\u4e3e\u6bcf\u4e2a\u540e\u7f00\u6700\u5927\u503c\u628a\u5b83\u7ba1\u8f96\u7684\u4e1c\u897f\u51cf\u6389\u5373\u53ef\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u505a\u6cd5\u5b8c\u5168\u6ca1\u6709\u89c2\u5bdf\u4efb\u4f55\u6027\u8d28\uff0c\u4ec5\u4ec5\u51ed\u7740\u201c\u5728\u9006\u6392\u5217\u4e0a\u8003\u8651\u201d\uff0c\u7136\u540e\u590d\u8ff0\u4e00\u904d\u95ee\u9898\u5c31\u628a\u95ee\u9898\u8f6c\u5316\u5f97\u5f88\u53ef\u505a\u3002",
        "postTime": 1641550855,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "CF1621G - \u9006\u6392\u5217\u7684\u5e94\u7528\u4e00\u4f8b"
    },
    {
        "content": "\u9996\u5148\u79bb\u6563\u5316\uff0c\u5bf9\u4e8e\u76f8\u7b49\u7684\u4f4d\u7f6e\u8981\u4fdd\u8bc1\u540e\u9762\u6bd4\u524d\u9762\u5c0f\uff0c\u8fd9\u6837\u5c06\u5e8f\u5217\u8f6c\u5316\u4e3a\u6392\u5217\u3002\n\n\u663e\u7136\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u6b21\u6570\uff0c\u5373\u5728\u591a\u5c11\u4e2a\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2d\u53ef\u4ee5\u4f5c\u4e3a\u9898\u9762\u4e2d\u7684 $i_j$\u3002\u8bbe\u5f53\u524d\u4f4d\u7f6e\u4e3a $x$\uff0c\u6700\u540e\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u4f4d\u7f6e\u4e3a $y$\uff0c\u90a3\u4e48 $x$ \u80fd\u8d21\u732e\u5230\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u8981\u5305\u542b $x$\uff0c\u4e14\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u5728 $y$ \u4e4b\u524d\u3002\n\n\u8fd9\u5373\u662f\u4ee5 $x$ \u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u4e58\u4e0a\u4ee5 $x$ \u5f00\u5934\u4e14\u7ed3\u5c3e\u5728 $y$ \u4e4b\u524d\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\u524d\u8005\u76f4\u63a5 dp \u6c42\u51fa\uff0c\u540e\u8005\u8003\u8651\u5230 $y$ \u4e4b\u540e\u7684\u6240\u6709\u4f4d\u7f6e\u90fd\u6bd4 $x$ \u5c0f\uff0c\u5219\u7b49\u4e8e\u4ee5 $x$ \u5f00\u5934\u4e0d\u4ee5 $y$ \u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\u6b63\u96be\u5219\u53cd\uff0c\u8003\u8651\u6c42\u4ee5 $x$ \u5f00\u5934\u4ee5 $y$ \u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\n\n\u53d1\u73b0 $y$ \u5fc5\u5b9a\u662f\u540e\u7f00\u6700\u5927\u503c\u3002\u8bbe\u540e\u7f00\u6700\u5927\u503c\u6709 $k$ \u4e2a\uff0c\u4ece\u540e\u5f80\u524d\u662f $s_1$ \u5230 $s_k$\uff0c\u4e14 $y=s_i$\uff0c\u90a3\u4e48 $y$ \u53ef\u4ee5\u5728 $s$ \u4e2d\u4e8c\u5206\u6c42\u51fa\u3002\u5e76\u4e14\u6211\u4eec\u77e5\u9053\uff0c$a_{s_{i-1}}<a_x<a_{s_i}$\uff0c\u90a3\u4e48\u4e0a\u8ff0\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2d\u7684\u6240\u6709\u6570\u4e00\u5b9a\u90fd\u5728 $(a_{s_{i-1}},a_{s_i})$\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u5c06\u8fd9\u4e9b\u6570\u62ff\u51fa\u6765\u5355\u72ec dp\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5373\u4e3a $O(n\\log n)$\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ninline ll readint(){\n\tll x=0;\n\tbool f=0;\n\tchar c=getchar();\n\twhile(!isdigit(c)&&c!='-') c=getchar();\n\tif(c=='-'){\n\t\tf=1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst int maxn=2e5+5;\nint n,a[maxn],ord[maxn],s[maxn],tp;\nconst ll mod=1e9+7;\nll c[maxn];\ninline int lowbit(int x){\n\treturn x&-x;\n}\nvoid modify(int x,ll k){\n\twhile(x<=n){\n\t\tc[x]=(c[x]+k)%mod;\n\t\tx+=lowbit(x);\n\t}\n}\nll query(int x){\n\tll s=0;\n\twhile(x){\n\t\ts=(s+c[x])%mod;\n\t\tx-=lowbit(x);\n\t}\n\treturn s;\n}\nll f[maxn],g[maxn],h[maxn];\nvector<int> vec[maxn];\nint main(){\n\t#ifdef LOCAL\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n\t#endif\n\tint T=readint();\n\twhile(T--){\n\t\tn=readint();\n\t\tfor(int i=1;i<=n;i++) a[i]=readint();\n\t\tfor(int i=1;i<=n;i++) ord[i]=i;\n\t\tsort(ord+1,ord+n+1,[](int x,int y){\n\t\t\tif(a[x]!=a[y]) return a[x]<a[y];\n\t\t\treturn x>y;\n\t\t});\n\t\tfor(int i=1;i<=n;i++) a[ord[i]]=i;\n\t\ttp=0;\n\t\tfor(int i=n;i>0;i--)\n\t\t\tif(a[i]>a[s[tp]]) s[++tp]=i;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tf[i]=(query(a[i])+1)%mod;\n\t\t\tmodify(a[i],f[i]);\n\t\t}\n\t\tfor(int i=1;i<=n;i++) c[i]=0;\n\t\tfor(int i=n;i>0;i--){\n\t\t\tg[i]=(query(n-a[i]+1)+1)%mod;\n\t\t\tmodify(n-a[i]+1,g[i]);\n\t\t}\n\t\tfor(int i=1;i<=n;i++) c[i]=0;\n\t\tfor(int i=1;i<=tp;i++)\n\t\t\tvector<int>().swap(vec[i]);\n\t\tfor(int i=n;i>0;i--){\n\t\t\tint l=1,r=tp;\n\t\t\twhile(l<r){\n\t\t\t\tint mid=l+(r-l)/2;\n\t\t\t\tif(a[i]<=a[s[mid]]) r=mid;\n\t\t\t\telse l=mid+1;\n\t\t\t}\n\t\t\tif(s[r]!=i) vec[r].push_back(i);\n\t\t}\n\t\tfor(int i=1;i<=tp;i++){\n\t\t\tmodify(n-a[s[i]]+1,h[s[i]]=1);\n\t\t\tfor(int j:vec[i]){\n\t\t\t\th[j]=query(n-a[j]+1);\n\t\t\t\tmodify(n-a[j]+1,h[j]);\n\t\t\t}\n\t\t\tfor(int j:vec[i])\n\t\t\t\tmodify(n-a[j]+1,(mod-h[j])%mod);\n\t\t\tmodify(n-a[s[i]]+1,mod-1);\n\t\t}\n\t\tll ans=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans=(ans+(g[i]-h[i]+mod)%mod*f[i]%mod)%mod;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\t#ifdef LOCAL\n\tfprintf(stderr,\"%f\\n\",1.0*clock()/CLOCKS_PER_SEC);\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1641370560,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1621G \u3010Weighted Increasing Subsequences\u3011"
    },
    {
        "content": "## Solution\uff1a\n\u8003\u8651\u6709\u54ea\u4e9b\u70b9\u80fd\u6210\u4e3a\u9898\u610f\u4e2d\u7684 $x$\uff0c\u4e14\u65e0\u6cd5\u88ab\u66f4\u4f18\u7684\u66ff\u4ee3\u3002\u6613\u77e5\u4e00\u5b9a\u662f\u90a3\u4e9b\u53d6\u5230\u540e\u7f00 $\\max$ \u7684\u4f4d\u7f6e\uff0c\u5c06\u8fd9\u4e9b\u70b9\u79f0\u4e3a\u5173\u952e\u70b9\uff0c\u53ef\u7528\u8fd9\u4e9b\u70b9\u5c06\u539f\u5e8f\u5217\u6309\u6743\u503c\u5206\u5c42\u8f6c\u79fb\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/xa1458rr.png)\n(\u56fe\u4e2d\u6a2a\u5750\u6807\u4e3a\u70b9\u7684\u7f16\u53f7\uff0c\u7eb5\u5750\u6807\u4e3a\u6743\u503c\uff09\n\n\u5bf9\u4e8e\u4e00\u4e2a\u5173\u952e\u70b9 $x$ \u4e0e\u5173\u952e\u70b9 $y$ \u4e4b\u95f4\u7684\u975e\u5173\u952e\u70b9 $u$\uff0c$u$ \u80fd\u5bf9\u5305\u542b\u5b83\u7684\u4e00\u6761 \u4e0a\u5347\u5b50\u5e8f\u5217 \u4ea7\u751f 1 \u7684\u6743\u503c\u5f53\u4e14\u4ec5\u5f53 \u4e0a\u5347\u5b50\u5e8f\u5217 \u4e0d\u4ee5 $x$ \u7ed3\u5c3e\u3002\n\n\u8bbe $f_u$ \u8868\u793a\u4ee5 $u$ \u4e3a\u5f00\u5934\u7684 \u4e0a\u5347\u5b50\u5e8f\u5217 \u7684\u4e2a\u6570\uff0c$g_u$ \u8868\u793a\u4ee5 $u$ \u4e3a\u5f00\u5934\u7684 \u4e0a\u5347\u5b50\u5e8f\u5217 \u7684\u603b\u6743\u503c\u3002$f$ \u7684\u8f6c\u79fb\u662f\u7b80\u5355\u7684\uff1a\n$$\nf_u=1+\\sum_{i>u,a_i>a_u}f_i\n$$\n\u6309\u6743\u503c\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u540e\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u6a2a\u5750\u6807\u4e3a\u4e0b\u6807\u7684\u540e\u7f00\u548c\u5373\u53ef\u3002\n\n\u8003\u8651 $g$ \u7684\u8f6c\u79fb\uff0c\u82e5\u6ca1\u6709\u4e0d\u80fd\u4ee5 $x$ \u7ed3\u5c3e\u7684\u9650\u5236\uff0c\u5219\u76f4\u63a5\u662f\uff1a\n$$\ng_u=f_u+\\sum_{i>u,a_i>a_u}g_i\n$$\n\u628a $x$ \u7684\u9650\u5236\u8003\u8651\u8fdb\u6765\uff0c\u53ea\u9700\u8981\u4e0d\u628a $f_x$ \u4e0e $g_x$ \u52a0\u5165\u6811\u72b6\u6570\u7ec4\uff0c\u5c31\u4e0d\u4f1a\u7edf\u8ba1\u4ee5 $x$ \u7ed3\u5c3e\u7684\u5b50\u5e8f\u5217\u4e86\u3002\n\n\u603b\u7ed3\u4e00\u4e0b\uff0c\u5bf9\u4e8e $x$ \u4e0e $y$ \u4e4b\u95f4\u7684\u6240\u6709\u70b9\uff0c\u8fdb\u884c\u4e24\u6b21\u4ece\u4e0a\u5230\u4e0b\u7684\u8f6c\u79fb\uff0c\u7b2c\u4e00\u6b21\u4e0d\u52a0\u5165 $x$\uff0c\u7b97\u51fa\u6b63\u786e\u7684 $g$\uff0c\u7b2c\u4e8c\u6b21\u52a0\u5165 $x$\uff0c\u7b97\u51fa\u6b63\u786e\u7684 $f$\uff0c$x$ \u4e0a\u9762\u7684\u70b9\u5219\u4e00\u76f4\u5728\u6811\u72b6\u6570\u7ec4\u5f53\u4e2d\uff0c\u603b\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\n*p.s. \u6ce8\u610f\u5404\u79cd\u6743\u503c\u76f8\u7b49\u65f6\u7684\u7ec6\u8282\u5904\u7406\u3002*\n\n## Code\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define inl inline\nusing namespace std;\nconst int N=2e5+5,P=1e9+7;\ninl int Ad(int x,int y) {return x+y>=P?x+y-P:x+y; }\nstruct A\n{\n\tint x,y;\n\tinl A operator +(A t) {return {Ad(x,t.x),Ad(y,t.y)}; }\n}a[N],b[N],f[N],sz[N];\nint n,m;\ninl int Read()\n{\n\tint s=0; char c; while(!isdigit(c=getchar()));\n\tfor(;isdigit(c);c=getchar()) s=s*10+c-'0'; return s;\n}\ninl A Ask(int p) {A t={0,0}; for(;p<=n;p+=p&-p) t=t+sz[p]; return t; }\ninl void Add(int p,A t) {for(;p;p-=p&-p) sz[p]=sz[p]+t; }\nint main()\n{\n\tfor(int T=Read();T--;)\n\t{\n\t\tn=Read(); m=0;\n\t\tfor(int i=1;i<=n;++i) a[i]={i,Read()}, sz[i]={0,0};\n\t\tfor(int i=n;i>=1;--i) if(a[i].y>=b[m].y) b[++m]=a[i];\t// \u5173\u952e\u70b9 \n\t\tsort(a+1,a+n+1,[](A x,A y)->bool{return x.y==y.y?x.x<y.x:x.y>y.y; });\n\t\tfor(int i=m,l=2,r=1;i;--i,l=r+2)\n\t\t{\n\t\t\twhile(r<n&&a[r+1].x!=b[i-1].x) ++r;\t\t// \u5206\u5c42\uff0cl ~ r \u5747\u4e3a\u975e\u5173\u952e\u70b9 \n\t\t\tfor(int j=l;j<=r;++j)\n\t\t\t{\n\t\t\t\tf[j]=Ask(a[j].x+1);\n\t\t\t\t++f[j].x;\n\t\t\t\tf[j].y=Ad(f[j].y,f[j].x);\t\t// \u7b2c\u4e00\u6b21\u8f6c\u79fb\u51fa g \n\t\t\t\tAdd(a[j].x,f[j]);\n\t\t\t}\n\t\t\tfor(int j=l;j<=r;++j) Add(a[j].x,{P-f[j].x,0});\t// \u64a4\u9500 \n\t\t\tAdd(b[i].x,{1,0});\t\t// \u52a0\u5165 x \n\t\t\tfor(int j=l;j<=r;++j)\n\t\t\t{\n\t\t\t\tf[j].x=Ask(a[j].x+1).x+1;\t\t// \u7b2c\u4e8c\u6b21\u8f6c\u79fb\u51fa f \n\t\t\t\tAdd(a[j].x,{f[j].x,0});\n\t\t\t}\n\t\t}\n\t\tprintf(\"%d\\n\",Ask(1).y);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1683887431,
        "uid": 224693,
        "name": "D_F_S",
        "ccfLevel": 7,
        "title": "CF1621G Weighted Increasing Subsequences \u9898\u89e3"
    },
    {
        "content": "> \u9898\u76ee\u94fe\u63a5\uff1a[CF1621G Weighted Increasing Subsequences](https://www.luogu.com.cn/problem/CF1621G)\n\n> **\u672c\u9898\u89e3\u540c\u6b65\u53d1\u5e03\u4e8e [My Blog](http://www.cxy07.blog/index.php/archives/443/)**\n\n\u9898\u610f\uff1a\n\n> \u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $\\{a_n\\}$\uff0c\u5bf9\u4e8e\u5176\u4e00\u4e2a\u957f\u5ea6\u4e3a $k$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217 $a_{i_1},a_{i_2}\\cdots a_{i_k}$ \u5b9a\u4e49\u5176\u6743\u503c\u4e3a\u6ee1\u8db3 $j\\in[1,k]$\uff0c\u5b58\u5728\u4e00\u4e2a $x\\in(i_k,n]$ \u4f7f\u5f97 $a_x>a_{i_j}$ \u7684 $j$ \u7684\u4e2a\u6570\u3002\n\n> \u8ba1\u7b97\u6240\u6709\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u6743\u503c\u548c\u3002\n\n> $1\\le n\\le 2\\times 10^5, 1\\le a_i\\le 10^9$\u3002\n\n\u9996\u5148\u5c06\u5e8f\u5217\u79bb\u6563\u5316\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u6743\u503c\u662f\u56f0\u96be\u7684\uff0c\u6211\u4eec\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e $a_p$ \u7684\u8d21\u732e\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a $a_p$\uff0c$i_k$ \u6700\u8fdc\u53ef\u4ee5\u5230\u54ea\u91cc\uff0c\u4f7f\u5f97\u5b58\u5728\u4e00\u4e2a $x\\in(i_k,n]$ \u6ee1\u8db3 $a_x>a_i$\uff1f\u5bb9\u6613\u53d1\u73b0\uff0c\u82e5\u8bbe $r_p$ \u8868\u793a\u6700\u9760\u53f3\u7684\u6ee1\u8db3 $a_{r_p}>a_p$ \u7684\u4e0b\u6807\uff0c\u5219 $i_k<r_p$\u3002\u6ce8\u610f\u5230 $a_{r_p}$ \u5fc5\u7136\u5728\u540e\u7f00\u5355\u8c03\u6808\u4e0a\u3002\n\n\u4e8e\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $p$\uff0c\u6211\u4eec\u9700\u8981\u8ba1\u7b97 \u201c\u7ecf\u8fc7 $p$\uff0c\u4e14\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u5728 $r_p$ \u4e4b\u524d\u201d \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\u5bb9\u65a5\u6210 \u201c\u7ecf\u8fc7 $p$\uff0c\u4e14\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e0b\u6807 $\\in[r_p,n]$\u201d \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\n\n\u672c\u4eba\u505a\u5230\u8fd9\u91cc\u7684\u65f6\u5019\u88ab\u5361\u4f4f\u4e86\uff0c\u201c\u7ecf\u8fc7\u5b9a\u70b9\uff0c\u7ed3\u5c3e\u5728\u4e00\u6bb5\u540e\u7f00\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u201d \u770b\u8d77\u6765\u4e0d\u662f\u5f88\u53ef\u505a\u3002\n\n\u7ee7\u7eed\u89c2\u5bdf\u6027\u8d28\uff0c\u6ce8\u610f\u5230\u6211\u4eec\u8bbe $r_p$ \u662f**\u6700\u9760\u53f3**\u7684\u6ee1\u8db3 $a_{r_p}>a_p$ \u7684\u4f4d\u7f6e\uff0c\u8fd9\u610f\u5473\u7740 $\\forall i\\in(r_p, n],\\ a_i\\le a_p$\u3002\u8bf4\u660e\uff0c\u4efb\u610f\u7ecf\u8fc7 $p$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\uff0c\u90fd\u4e0d\u53ef\u80fd\u5728 $(r_p, n]$ \u7ed3\u675f\u3002\n\n\u4e8e\u662f \u201c\u7ecf\u8fc7 $p$\uff0c\u4e14\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e0b\u6807 $\\in[r_p,n]$\u201d \u7684\u9650\u5236\u5c31\u8f6c\u53d8\u6210\u4e86 \u201c\u7ecf\u8fc7 $p$\uff0c\u4e14\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e0b\u6807 $=r_p$\u201d\uff0c\u76f8\u5f53\u4e8e\u94a6\u5b9a\u4e86\u4e00\u4e2a\u5b9a\u70b9\uff0c\u94a6\u5b9a\u4e86\u7ed3\u5c3e\u5143\u7d20\u3002\n\n\u5982\u4f55\u8ba1\u7b97\u8fd9\u6837\u7684\u5b50\u5e8f\u5217\u4e2a\u6570\uff1f\u9996\u5148\u80af\u5b9a\u8981\u628a\u5b50\u5e8f\u5217\u62c6\u6210 $p$ \u4e4b\u524d\u3001\u4e4b\u540e\u3002\u524d\u9762\u662f\u597d\u7b97\u7684\uff0c$p$ \u4e4b\u540e\u7684\u90e8\u5206\uff0c\u5c31\u76f8\u5f53\u4e8e\uff1a\n\n\u201c\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e0b\u6807\u662f $p$\uff0c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e0b\u6807\u662f $r_p$\u201d \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\n\n\u63a5\u4e0b\u6765\u6211\u7684\u5904\u7406\u548c\u5b98\u65b9\u7684\u9898\u89e3\u6709\u4e00\u4e9b\u533a\u522b\uff1a\u7531\u4e8e $r_p$ \u662f\u6700\u9760\u53f3\u7684\u6ee1\u8db3\u6761\u4ef6\u7684\u4e0b\u6807\uff0c\u6240\u4ee5\u4efb\u610f\u4ece $p$ \u5f00\u59cb\u5ef6\u7533\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\uff0c\u5176\u7ed3\u5c3e\u4e0b\u6807\u5fc5\u7136 $\\le r_p$\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4 \u201c\u4ece $p$ \u5f00\u59cb\uff0c\u4ee5\u6700\u8fdc\u7684\u53ef\u884c\u4f4d\u7f6e\u7ed3\u5c3e\u201d \u7684\u65b9\u6848\u6570\u5373\u53ef\uff0c\u5bb9\u6613\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n```cpp\n//Code By CXY07 - It's My Fiesta.\n#include<bits/stdc++.h>\nusing namespace std;\n\n//#define FILE\n//#define int long long\n#define randint(l, r) (rand() % ((r) - (l) + 1) + (l))\n#define abs(x) ((x) < 0 ? (-(x)) : (x))\n#define popc(x) __builtin_popcount(x)\n#define inv(x) qpow((x), mod - 2)\n#define lowbit(x) ((x) & (-(x)))\n#define ull unsigned long long\n#define pii pair<int, int>\n#define LL long long\n#define mp make_pair\n#define pb push_back\n#define scd second\n#define vec vector\n#define fst first\n#define endl '\\n'\n#define y1 _y1\n\nconst int MAXN = 2e5 + 10;\nconst int INF = 2e9;\nconst double eps = 1e-6;\nconst double PI = acos(-1);\nconst int mod = 1e9 + 7;\n//const int mod = 998244353;\n//const int G = 3;\n//const int base = 131;\n\nint T, n, m;\nint a[MAXN], FT[MAXN], pre[MAXN], suf[MAXN];\nint mx[MAXN], mxv[MAXN];\nLL Ans;\nvec<int> v;\n\ntemplate<typename T> inline bool read(T &a) {\n\ta = 0; char c = getchar(); int f = 1;\n\twhile(c < '0' || c > '9') { if(c == '-') f = -1; c = getchar(); }\n\twhile(c >= '0' && c <= '9') { a = a * 10 + (c ^ 48); c = getchar(); }\n\treturn a *= f, true;\n}\n\ntemplate<typename A, typename ...B>\ninline bool read(A &x, B &...y) { return read(x) && read(y...); }\n\nvoid add1(int x, int v) { for(; x <= n; x += lowbit(x)) (FT[x] += v) %= mod; }\nint ask1(int x) { int res = 0; { for(; x; x -= lowbit(x)) (res += FT[x]) %= mod; } return res; }\n\nvoid add2(int x, pii v) {\n\tfor(; x; x -= lowbit(x)) {\n\t\tif(mx[x] < v.fst) mx[x] = v.fst, mxv[x] = 0;\n\t\tif(mx[x] == v.fst) (mxv[x] += v.scd) %= mod;\n\t}\n}\n\npii ask2(int x) {\n\tint _mx = 0, _mxv = 0;\n\tfor(; x <= n; x += lowbit(x)) {\n\t\tif(_mx < mx[x]) _mx = mx[x], _mxv = 0;\n\t\tif(_mx == mx[x]) (_mxv += mxv[x]) %= mod;\n\t}\n\treturn mp(_mx, _mxv);\n}\n\nvoid solve() {\n\tread(n); v.clear(); Ans = 0;\n\tfor(int i = 1; i <= n; ++i) read(a[i]), v.pb(a[i]);\n\tfor(int i = 1; i <= n; ++i) FT[i] = mx[i] = mxv[i] = 0;\n\tsort(v.begin(), v.end()); v.erase(unique(v.begin(), v.end()), v.end());\n\tfor(int i = 1; i <= n; ++i) a[i] = lower_bound(v.begin(), v.end(), a[i]) - v.begin() + 1;\n\tfor(int i = 1; i <= n; ++i) add1(a[i], pre[i] = ask1(a[i] - 1) + 1);\n\tfor(int i = 1; i <= n; ++i) FT[i] = 0;\n\tfor(int i = n; i >= 1; --i) {\n\t\tadd1(n - a[i] + 1, suf[i] = ask1(n - a[i]) + 1);\n\t\tpii cur = ask2(a[i] + 1);\n\t\tif(!cur.scd) cur = mp(i, 1);\n\t\t(suf[i] -= cur.scd) %= mod; add2(a[i], cur);\n\t}\n\tfor(int i = 1; i <= n; ++i) (Ans += 1ll * pre[i] * suf[i]) %= mod;\n\tAns = (Ans + mod) % mod;\n\tprintf(\"%lld\\n\", Ans);\n}\n\nsigned main () {\n#ifdef FILE\n\tfreopen(\".in\", \"r\", stdin);\n\tfreopen(\".out\", \"w\", stdout);\n#endif\n\tread(T);\n\twhile(T--) solve();\n\treturn 0;\n}\n```",
        "postTime": 1641562570,
        "uid": 53489,
        "name": "CXY07",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011CF1621G Weighted Increasing Subsequences"
    },
    {
        "content": "\u4e00\u4e2a dp\uff08\u62dc\u8c22 ly\uff09\u548c\u5207\u5165\u70b9\u90fd\u7565\u6709\u4e0d\u540c\u7684\u505a\u6cd5\uff0c\u5e76\u4e0d\u9700\u8981\u89c2\u5bdf\u5565\u6027\u8d28\u3002\n\n\u539f\u95ee\u9898\u9488\u5bf9\u5b50\u5e8f\u5217\u8fdb\u884c\u89c4\u5212\uff0c\u81ea\u7136\u5730\u60f3\u5230\u8f6c\u800c\u5bf9\u524d\u7f00\u8fdb\u884c\u89c4\u5212\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u524d\u7f00 $[1, i]$ \u4ee5\u53ca\u4e00\u4e2a $j \\in [1, i]$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u53ef\u4ee5\u5199\u51fa $\\displaystyle \\textit{cont}(j \\text{ to } [1, i]) = [\\max_{i < k} a_k > a_j] \\times \\text{the number of LISs containing } j \\text{ indexed in } [1, i]$\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u505a\u4e24\u4e2a dp \u89e3\u51b3\uff0c\u7b2c\u4e00\u4e2a\u597d\u89e3\u51b3\u7684\u9759\u6001 dp\uff0c\u5373\u7ed3\u675f\u5728 $j$ \u7684 LIS \u65b9\u6848\u6570\uff1b\u7b2c\u4e8c\u4e2a dp \u6709\u4e9b\u70e6\uff1a$j$ \u5728\u52a8\uff0c\u6211\u4eec\u8003\u8651\u7684\u524d\u7f00 $[1, i]$ \u4e5f\u5728\u79fb\u52a8\u3002\n\n\u5230\u8fd9\u91cc\u5176\u5b9e\u6362\u4e00\u4e0b\u7740\u624b\u70b9\u7b2c\u4e8c\u4e2a dp \u5c31\u53d8\u6210\u9759\u6001\u7684\u4e86\uff0c\u5373\u8003\u8651\u4f4d\u7f6e $j$\uff0c\u76f4\u63a5\u7b97 $(j, i)$ \u7684\u8d21\u732e\u5373\u53ef\uff0c\u5176\u4e2d $i$ \u662f\u300c\u6ee1\u8db3 $a_i > a_j$ \u7684\u6700\u5927\u7684 $i$\u300d\u3002\u4e8e\u662f\u6211\u4eec\u7684\u7b2c\u4e8c\u4e2a dp \u5c31\u53ef\u4ee5\u88ab\u63cf\u8ff0\u4e3a\u4ece $j$ \u5f00\u59cb\uff0c\u7ed3\u675f\u5728 $i$ \u4e4b\u524d\uff08\u4e0d\u5305\u62ec\uff0c\u56e0\u4e3a\u8981\u4fdd\u8bc1 $\\max_{i < k} a_k > a_j$\uff09\u7684 LIS \u65b9\u6848\u6570\u3002\u7b54\u6848\u5373 $\\displaystyle \\sum_{i=1}^n dp_i \\times dp'_i$\u3002\n\n\u7b2c\u4e8c\u4e2a dp \u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u8f85\u52a9\u7684 dp\uff0c\u5176\u5b9a\u4e49\u662f\u7b2c\u4e8c\u4e2a dp \u7684\u5b9a\u4e49\u4e2d\u53bb\u6389\u8d21\u732e\u8303\u56f4\u4e0a\u754c\uff08\u5373 $i$\uff09\uff0c\u8f6c\u79fb\u753b\u753b\u56fe\u5c31\u80fd\u7406\u89e3\u4e86\u3002\n\n\u7528\u4e0b Fenwick Tree \u5565\u7684\u5c31\u80fd $O(n \\log_2 n)$ \u4e86\u3002\n\n```cpp\nusing modint = modint1000000007;\nint n, a[200100], pos[200100], id[200100];\nmodint dp[200100], dp2[200100], dp3[200100], bit[200100], bit2[200100];\nvoid cng(int x, modint w) {\n    for (; x<=n; x+=x&-x) {\n        bit[x] += w;\n    }\n}\nmodint qry(int x) {\n    modint res = 0;\n    for (; x; x-=x&-x) {\n        res += bit[x];\n    }\n    return res;\n}\nvoid cng2(int x, modint w) {\n    for (; x<=n; x+=x&-x) {\n        bit2[x] += w;\n    }\n}\nmodint qry2(int x) {\n    modint res = 0;\n    for (; x; x-=x&-x) {\n        res += bit2[x];\n    }\n    return res;\n}\nvoid solve() {\n    cin >> n;\n    bastr<int> dsc;\n    for (int i=1; i<=n; ++i) {\n        cin >> a[i];\n        dsc += a[i];\n    }\n    sort(dsc.begin(), dsc.end());\n    dsc.erase(unique(dsc.begin(), dsc.end()), dsc.end());\n    for (int i=1; i<=n; ++i) {\n        a[i] = lower_bound(dsc.begin(), dsc.end(), a[i])-dsc.begin()+1;\n    }\n    iota(id+1, id+n+1, 1);\n    sort(id+1, id+n+1, [&](int x, int y) {\n        return a[x] < a[y];\n    });\n    for (int i=1,now=n; i<=n; ++i) {\n        while (now >= 1 && a[now] <= a[id[i]]) {\n            now--;\n        }\n        pos[id[i]] = now;\n    }\n    for (int i=1; i<=n; ++i) {\n        bit[i] = 0;\n    }\n    for (int i=1; i<=n; ++i) {\n        dp[i] = qry(a[i]-1)+1;\n        cng(a[i], dp[i]);\n    }\n    for (int i=1; i<=n; ++i) {\n        bit[i] = bit2[i] = 0;\n    }\n    modint ans = 0;\n    for (int i=n; i>=1; --i) {\n        dp2[i] = qry(cs(dsc)-a[i])+1;\n        cng(cs(dsc)-a[i]+1, dp2[i]);\n        if (pos[i] > i) {\n            dp3[i] = qry(cs(dsc)-a[pos[i]]+1)+qry2(a[pos[i]]-1)-qry2(a[i]);\n            cng2(a[i], dp3[i]);\n        }\n        else {\n            dp3[i] = 0;\n        }\n        ans += dp[i]*dp3[i];\n    }\n    cout << ans.val() << \"\\n\";\n}\n```",
        "postTime": 1658492762,
        "uid": 161849,
        "name": "cirnovsky",
        "ccfLevel": 6,
        "title": "cqbzly \u4f60\u540d\u5b57\u8fd9\u4e48\u5199\u554a"
    },
    {
        "content": "## [CF1621G](https://www.luogu.com.cn/problem/CF1621G)   \n\u9996\u5148\u8f6c\u5316\u6210\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u3002    \n\n\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6e $x$\uff0c\u4e0d\u59a8\u627e\u5230\u6700\u540e\u4e00\u4e2a\u5927\u4e8e $a_x$ \u7684 $a_y$\uff08\u6ca1\u6709\u76f4\u63a5\u4e0d\u7edf\u8ba1\uff09\uff0c\u5219\u6240\u6709\u5305\u542b $x$ \u7684\uff0c\u4e14 $end<y$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u90fd\u4f1a\u4e3a\u7b54\u6848\u505a\u8d21\u732e\u3002\u53d1\u73b0\uff0c\u5982\u679c\u4e00\u4e2a\u5305\u542b $x$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\uff0c\u5176\u7ed3\u5c3e\u6bd4 $y$ \u5927\uff0c\u5219\u4e0d\u7b26\u5408 $a_y$ \u662f\u6700\u540e\u4e00\u4e2a\u6bd4 $a_x$ \u5927\u7684\u6570\u7684\u6027\u8d28\uff0c\u6240\u4ee5\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e00\u5b9a\u662f\u7ed3\u5c3e\u4e3a $y$ \u7684\u5b50\u5e8f\u5217\u3002    \n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5148\u7b97\u51fa\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $x$\uff0c\u6240\u6709\u5305\u542b\u5b83\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\uff0c\u518d\u51cf\u53bb\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u4ee5 $y_i$ \u4e3a\u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\u3002    \n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u8f6c\u5316\uff0c\u4ee4 $pre_i$ \u8868\u793a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\uff0c\u5219\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u4ee5 $i$ \u4e3a\u5f00\u5934\uff0c$y_i$ \u4e3a\u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u4e2a\u6570\uff0c\u518d\u4e58\u4e0a $pre_i$ \u5e76\u51cf\u6389\u5373\u53ef\u3002    \n\n\u628a\u6bcf\u4e00\u4e2a $i$ \u6302\u5230\u5176\u6240\u5bf9\u5e94\u7684 $y_i$ \u4e2d\uff0c\u904d\u5386 $y_i$\uff0c\u628a\u5b83\u672c\u8eab\u548c\u6302\u5728\u5b83\u4e0b\u9762\u7684\u8be2\u95ee\u53d6\u51fa\u6765\u53d8\u6210\u5e8f\u5217\uff0c\u8dd1\u4e00\u8fb9\u4e0a\u5347\u5b50\u5e8f\u5217\u8ba1\u6570\u5373\u53ef\u3002    \n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8fd9\u6837\u662f\u6210\u7acb\u7684\uff0c\u539f\u56e0\u5c31\u5728\u4e8e\u5982\u679c $i$ \u4e0e $j$ \u7684 $y$ \u503c\u4e0d\u540c\uff0c\u4e8c\u8005\u662f\u4e0d\u4f1a\u4e92\u76f8\u505a\u8d21\u732e\u7684\uff0c\u5177\u4f53\u8bc1\u660e\u53ef\u4ee5\u6839\u636e $y$ \u7684\u5b9a\u4e49\u8bc1\u5f97\uff0c\u6bd4\u8f83\u7b80\u5355\u4f46\u6709\u70b9\u957f\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199\u4e86\u3002    \n\u4ee3\u7801\uff1a   \n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define MOD 1000000007\nusing namespace std;\nint t,n,a[500003],suf[500003],ans,CrsSeq[500003],TreeAr[500003],stSeq[500003];\nint l,r,mid;\nmap<int,int>mp;\nint lowbit(int X){return (X&(-X));}\nint getval(int wz){register int ret=0;for(int i=wz;i;i-=lowbit(i))ret=(ret+TreeAr[i])%MOD;return ret;}\nvoid add(int wz,int val){for(int i=wz;i<=n+2;i+=lowbit(i))TreeAr[i]=(TreeAr[i]+val)%MOD;return;}\nstruct Que{\n\tint X;\n\tint Y;\n\tint val;\n}Q[500003];\nint totQ;\nbool comp(Que X,Que Y){if(X.Y!=Y.Y)return X.Y<Y.Y;return X.X<Y.X;}\nint k1,k2,k3,k4,k5,k6,k7,k8,k9;\nint dp[500003];\nint stk[500003],tot;\nsigned main(){\n\tscanf(\"%lld\",&t);\n\twhile(t--){\n\t\tans=0;\n\t\tscanf(\"%lld\",&n);\n\t\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&a[i]);\n\t\tmp.clear();\n\t\ttot=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tif(mp[a[i]]==0){\n\t\t\t\tmp[a[i]]=1;\n\t\t\t\tstk[++tot]=a[i];\n\t\t\t}\n\t\t}\n\t\tsort(stk+1,stk+tot+1);\n\t\tfor(int i=1;i<=tot;i++)mp[stk[i]]=i;\n\t\tfor(int i=1;i<=n;i++)a[i]=mp[a[i]];\n\t\tsuf[n+1]=0;\n\t\tfor(int i=n;i>0;i--)suf[i]=max(a[i],suf[i+1]);\n\t\tfor(int i=1;i<=n+2;i++)TreeAr[i]=0;\n\t\tfor(int i=1;i<=n;i++)add(a[i],CrsSeq[i]=1+getval(a[i]-1));\n\t\tfor(int i=1;i<=n+2;i++)TreeAr[i]=0;\n\t\tfor(int i=n;i>0;i--)add(n+2-a[i],stSeq[i]=1+getval(n+1-a[i]));\n\t\ttotQ=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tif(suf[i+1]<=a[i])continue;\n\t\t\tans=(ans+CrsSeq[i]*stSeq[i])%MOD;\n\t\t\tl=i+1;\n\t\t\tr=n;\n\t\t\twhile(l<r){\n\t\t\t\tmid=((l+r)>>1)+1;\n\t\t\t\tif(suf[mid]<=a[i])r=mid-1;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tQ[++totQ].X=i;\n\t\t\tQ[totQ].Y=l;\n\t\t\tQ[totQ].val=-CrsSeq[i];\n\t\t}\n\t\tsort(Q+1,Q+totQ+1,comp);\n\t\tfor(int i=1;i<=n+2;i++)TreeAr[i]=0;\n\t\tfor(int i=1;i<=totQ;i++){\n\t\t\tk1=i;\n\t\t\twhile(k1<totQ&&Q[k1+1].Y==Q[i].Y)k1++;\n\t\t\ttot=0;\n\t\t\tfor(int j=i;j<=k1;j++)stk[++tot]=Q[j].X;\n\t\t\tstk[++tot]=Q[i].Y;\n\t\t\tadd(n+2-a[stk[tot]],dp[tot]=1);\n\t\t\tfor(int j=tot-1;j>0;j--)add(n+2-a[stk[j]],dp[j]=getval(n+1-a[stk[j]]));\n\t\t\tfor(int j=1;j<tot;j++)ans=(ans+dp[j]*Q[j+i-1].val)%MOD;\n\t\t\tfor(int j=tot;j>0;j--)add(n+2-a[stk[j]],-dp[j]);\n\t\t\ti=k1;\n\t\t}\n\t\tans+=MOD;\n\t\tans%=MOD;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1684672146,
        "uid": 340819,
        "name": "cwfxlh",
        "ccfLevel": 5,
        "title": "CF1621G"
    },
    {
        "content": "# CF1621G\n\n### \u9898\u76ee\u5206\u6790\n\u8003\u8651\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u5206\u522b\u7b97\u5b83\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u5373\u5b83\u8ba1\u5165\u7b54\u6848\u7684\u6b21\u6570\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684 $i$\uff0c\u8bbe $j$ \u662f\u6ee1\u8db3 $a_i<a_j$ \u7684\u6700\u5927\u7684 $j$\uff0c\u5219 $i$ \u6709\u8d21\u732e\uff0c\u5f53\u4e14\u4ec5\u5f53\u5176\u6240\u5728\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u5c0f\u4e8e $j$\u3002\u56e0\u4e3a\u5982\u679c\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u5927\u4e8e\u6216\u7b49\u4e8e $j$\uff0c\u540e\u9762\u5c31\u6ca1\u6709\u6570\u6bd4 $a_i$ \u5927\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u7ef4\u62a4\u540e\u7f00\u6700\u5927\u503c\uff0c\u679a\u4e3e $i,j$\uff0c\u5373\u53ef $O(n^2)$ \u6c42\u89e3\u3002\n\n\u8981\u8fdb\u4e00\u6b65\u4f18\u5316\uff0c\u4e0d\u59a8\u7528\u6240\u6709\u60c5\u51b5\u51cf\u53bb\u4e0d\u5408\u6cd5\u7684\u60c5\u51b5\u3002\u663e\u7136\uff0c\u6ca1\u6709\u8d21\u732e\u5f53\u4e14\u4ec5\u5f53\u8fd9\u4e2a\u5b50\u5e8f\u5217\u6070\u597d\u7ed3\u675f\u4e8e $a_j$\u3002\u56e0\u4e3a\u5982\u679c\u7ed3\u5c3e\u5927\u4e8e $j$\uff0c\u5219\u4e0d\u6ee1\u8db3\u4e0a\u9762\u7684\u5047\u8bbe\uff1b\u5982\u679c\u7ed3\u5c3e\u5c0f\u4e8e $j$\uff0c\u5219\u4e00\u5b9a\u6709\u8d21\u732e\uff08\u81f3\u5c11\u6709\u4e00\u4e2a $a_i<a_j$\uff09\u3002\n\n\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u53ea\u9700\u8981\u89e3\u51b3\u8fd9\u4e2a\u7b80\u5316\u540e\u7684\u95ee\u9898\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217\uff0c\u6c42\u5f00\u59cb\u4f4d\u7f6e\u548c\u7ed3\u675f\u4f4d\u7f6e\u4e00\u5b9a\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u4e2a\u6570\u3002\n\n\u8003\u8651\u8bbe\u4e00\u4e2a $k$ \u4e3a $j+1$ \u4f4d\u7f6e\u7684\u540e\u7f00\u6700\u5927\u503c\uff0c\u5f53 $j$ \u56fa\u5b9a\u65f6\uff0c\u663e\u7136\u5bf9\u4e8e\u6240\u6709\u7684 $i$ \u90fd\u6ee1\u8db3 $a_k\\leq a_i<a_j$\u3002\u6240\u4ee5\u5bf9\u4e8e\u4e00\u4e2a $j$\uff0c\u6709\u6548\u7684 $a_i$ \u5c5e\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684\u533a\u95f4 $[a_k,a_j)$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u679a\u4e3e $j$\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u8bb0\u5f55 $a_i$ \u7684\u6570\u91cf\uff0c\u5373\u53ef\u505a\u5230 $O(n\\log n)$\u3002\u56e0\u4e3a\u6bcf\u4e2a $i$ \u53ea\u4f1a\u5728\u4e00\u4e2a\u533a\u95f4\u91cc\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u662f\u5bf9\u7684\u3002\n\nCode\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5+10,mod=1e9+7;\nint t,n,a[N],v[N],dp_ed[N],dp_st[N];\nstruct BIT\n{\n\tint c[N];\n\tvoid add(int x,int y){for(;x<=n;x+=x&(-x))c[x]=(c[x]+y)%mod;}\n\tvoid clear(int x){for(;x<=n;x+=x&(-x))c[x]=0;}\n\tint ask(int x)\n\t{\n\t\tint res=0;\n\t\tfor(;x;x-=x&(-x))res=(res+c[x])%mod;\n\t\treturn res;\n\t}\n}tr;\nstruct node\n{\n\tint val,id;\n\tbool operator < (node d) const\n\t{\n\t\tif(val!=d.val)return val>d.val;\n\t\treturn id<d.id;\n\t}\n}b[N];\nbool bigger[N];\nint suf[N];\nint main()\n{\n\tscanf(\"%d\",&t);\n\twhile(t--)\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),v[i]=a[i];\n\t\tsort(v+1,v+n+1);\n\t\tint tot=unique(v+1,v+n+1)-(v+1);\n\t\tfor(int i=1;i<=n;i++)a[i]=lower_bound(v+1,v+tot+1,a[i])-v;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tdp_ed[i]=(tr.ask(a[i]-1)+1)%mod;\n\t\t\ttr.add(a[i],dp_ed[i]);\n\t\t}\n\t\tfor(int i=1;i<=n;i++)tr.c[i]=0;\n\t\tfor(int i=n;i>=1;i--)\n\t\t\tdp_st[i]=(tr.ask(n)-tr.ask(a[i])+1+mod)%mod,tr.add(a[i],dp_st[i]);\n\t\tfor(int i=1;i<=n;i++)tr.c[i]=0;\n\t\tint mx=0;\n\t\tfor(int i=n;i>=1;i--)\n\t\t{\n\t\t\tif(a[i]>mx)bigger[i]=1,mx=a[i];\n\t\t\tb[i]=(node){a[i],i};\n\t\t\tsuf[i]=mx;\n\t\t}\n\t\tsort(b+1,b+n+1);\n\t\tqueue<int>q;\n\t\tfor(int i=1;i<=n;i++)tr.c[i]=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(bigger[b[i].id])\n\t\t\t{\n\t\t\t\twhile(!q.empty())tr.clear(q.front()),q.pop();\n\t\t\t\tq.push(b[i].id);\n\t\t\t\ttr.add(b[i].id,1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tq.push(b[i].id);\n\t\t\t\tint tmp=(tr.ask(n)-tr.ask(b[i].id)+mod)%mod;\n\t\t\t\tdp_st[b[i].id]=(dp_st[b[i].id]-tmp+mod)%mod;\n\t\t\t\ttr.add(b[i].id,tmp);\n\t\t\t}\n\t\t}\n\t\tint ans=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tif(a[i]<suf[i])ans=(ans+1ll*dp_ed[i]*dp_st[i]%mod)%mod;\n\t\tprintf(\"%d\\n\",ans);\n\t\tfor(int i=1;i<=n;i++)tr.c[i]=0,bigger[i]=0;\n\t}\n\treturn 0;\n}\n",
        "postTime": 1641386969,
        "uid": 333574,
        "name": "Tyyyyyy",
        "ccfLevel": 7,
        "title": "CF1621G\u9898\u89e3"
    },
    {
        "content": "\n\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e $i$ \u88ab\u8bb0\u5165\u8d21\u732e\u7684\u6b21\u6570\uff0c\u5373 $i$ \u6240\u5728\u4e0a\u5347\u5b50\u5e8f\u5217\u672b\u5c3e\u4f4d\u7f6e $+1$ \u7684\u540e\u7f00\u6700\u5927\u503c\u5927\u4e8e $a_i$ \u7684\u65b9\u6848\u6570\u600e\u4e48\u8ba1\u7b97\u3002\u8bb0\u6ee1\u8db3 $a_j>a_i$ \u7684\u6700\u5927 $j$ \u6240\u5728\u4f4d\u7f6e\u4e3a $p$\uff0c\u8fd9\u4e2a $p$ \u4e00\u5b9a\u4e0d\u80fd\u5728\u4e0a\u5347\u5b50\u5e8f\u5217\u91cc\uff0c\u90a3\u4e48\u8d21\u732e\u5c31\u662f\u542b\u6709 $i$ \u4e14\u4e0d\u542b\u6709 $p$ \u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u6570\u3002\n\n\u542b\u6709 $i$ \u7684\u9650\u5236\u5f88\u597d\u8ba1\u7b97\uff0c\u8bbe $f[i]$ \u4e3a\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u6570\uff0c$g[i]$ \u4e3a\u4ee5 $i$ \u4e3a\u5f00\u5934\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u6570\uff0c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4 dp \u4e00\u4e0b\u5c31\u884c\u3002\n\n\u5bf9\u4e8e\u4e0d\u542b $p$ \u7684\u9650\u5236\u8003\u8651\u6b63\u96be\u5219\u53cd\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u8ba1\u7b97\u4ee5 $i$ \u5f00\u5934\u4ee5 $p$ \u7ed3\u5c3e\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u6570\u3002\n\n\u663e\u7136\u6240\u6709 $p$ \u90fd\u662f\u4e25\u683c\u540e\u7f00\u6700\u5927\u503c\uff0c\u628a\u5b83\u4eec\u63d0\u51fa\u6765\u79f0\u4e3a\u5e8f\u5217 $b$\uff0c\u90a3\u4e48 $b_i$ \u7ba1\u8f96\u7684\u5c31\u662f $a_j\\in(b_{i+1},b_i]$ \u7684\u6240\u6709 $j$\u3002\u90a3\u4e48\u628a $a$ \u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u6bcf\u627e\u5230\u4e00\u4e2a $b$ \u4e2d\u7684\u5143\u7d20\u5c31\u628a\u6811\u72b6\u6570\u7ec4\u6e05\u7a7a\u91cd\u65b0\u505a\u5373\u53ef\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define pb push_back\n#define rep(i,s,e) for(int i=(s);i<=(e);++i)\n#define Rep(i,s,e) for(int i=(e);i>=(s);--i)\nusing namespace std;\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch>'9'||ch<'0'){if(ch=='-') f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n    return x*f;\n}\nconst int N=2e5+5,mod=1e9+7;\nint n,a[N],b[N],m,suf[N],tag[N];\nint f[N],g[N];\ninline void add(int &x,int y){x+=y;if(x>=mod) x-=mod;}\nstruct BIT{\n    int t[N];\n    inline void clear(){rep(i,1,n) t[i]=0;}\n    inline int lowbit(int x){return x&(-x);}\n    inline void del(int x){\n        for(int i=x;i<=n;i+=lowbit(i)) t[i]=0;\n    }\n    inline void upd(int x,int v){\n        for(int i=x;i<=n;i+=lowbit(i)) add(t[i],v);\n    }\n    inline int query(int x){\n        int res=0;\n        for(int i=x;i;i-=lowbit(i)) add(res,t[i]);\n        return res;\n    }\n}t;\nstruct qwq{\n    int v,p;\n    bool operator < (const qwq &a) const{\n        if(v!=a.v) return v>a.v;\n        return p<a.p;\n    }\n}q[N];\ninline void solve(){\n    n=read();\n    rep(i,1,n) a[i]=b[i]=read();\n    sort(b+1,b+n+1),m=unique(b+1,b+n+1)-b-1;\n    rep(i,1,n) a[i]=lower_bound(b+1,b+m+1,a[i])-b,q[i]={a[i],i};\n    suf[n+1]=0;\n    Rep(i,1,n) suf[i]=max(suf[i+1],a[i]),tag[i]=suf[i]>suf[i+1];\n    t.clear();\n    rep(i,1,n) f[i]=t.query(a[i]-1)+1,t.upd(a[i],f[i]);\n    // cerr<<\"f\";rep(i,1,n) cerr<<f[i]<<' ';cerr<<endl;\n    t.clear();\n    Rep(i,1,n) g[i]=(t.query(n)-t.query(a[i])+1+mod)%mod,t.upd(a[i],g[i]);\n    // cerr<<\"g\";rep(i,1,n) cerr<<g[i]<<' ';cerr<<endl;\n    t.clear();\n    sort(q+1,q+n+1);\n    vector<int> ve;\n    rep(i,1,n){\n        if(tag[q[i].p]){\n            for(int tmp:ve) t.del(tmp);\n            ve.clear(),ve.pb(q[i].p),t.upd(q[i].p,1);\n        }\n        else{\n            ve.pb(q[i].p);\n            int cnt=(t.query(n)-t.query(q[i].p)+mod)%mod;\n            g[q[i].p]=(g[q[i].p]-cnt+mod)%mod,t.upd(q[i].p,cnt);\n        }\n    }\n    int ans=0;\n    rep(i,1,n) if(a[i]<suf[i]) add(ans,1ll*f[i]*g[i]%mod);\n    printf(\"%d\\n\",ans);\n}\nsigned main(){\n    int T=read();\n    while(T--) solve();\n}\n```",
        "postTime": 1684816733,
        "uid": 613616,
        "name": "zcxxn",
        "ccfLevel": 7,
        "title": "CF1621G Weighted Increasing Subsequences \u9898\u89e3"
    }
]