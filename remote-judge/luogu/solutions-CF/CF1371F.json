[
    {
        "content": "# \u8fdb\u53bb\u770b\u770b\u5427\u2193\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/dysyn1314/p/13224383.html)\n\n[\u9898\u76ee\u94fe\u63a5](https://codeforces.com/contest/1371/problem/F)\n\n\u9996\u5148\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5f62\u5982``>>>...>><<...<<<``\u7684\u7ed3\u6784\uff0c\u7403\u4f1a\u6389\u5230\u4e2d\u95f4\u7684\u90a3\u4e2a\u6d1e\u91cc\u3002\u6211\u4eec\u53ef\u4ee5\u5f62\u8c61\u5730\u628a``>``\u770b\u505a\u5411\u4e0b\u7684\u5761\uff0c``<``\u770b\u505a\u5411\u4e0a\u7684\u5761\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7403\u8fd0\u52a8\u7684\u60c5\u51b5\uff0c\u5c31\u662f\u987a\u7740\u5761\u5411\u4e0b\u6eda\uff0c\u5f88\u597d\u7406\u89e3\u3002\u6211\u4eec\u628a\u6bcf\u4e2a\u8fd9\u6837\u7684\uff08\u4e0b\u5761\u518d\u4e0a\u5761\u7684\uff09\u7ed3\u6784\uff0c\u79f0\u4f5c\u4e00\u4e2a\u201c\u5751\u201d\uff0c\u90a3\u4e48\u9898\u76ee\u5c31\u662f\u8981\u8be2\u95ee\u4e00\u6bb5\u533a\u95f4\u91cc\uff0c\u201c\u6700\u5927\u7684\u5751\u201d\u7684\u5927\u5c0f\u3002\n\n\u56e0\u4e3a\u662f\u533a\u95f4\u64cd\u4f5c\uff0c\u533a\u95f4\u67e5\u8be2\uff0c\u6211\u4eec\u8003\u8651\u7528**\u7ebf\u6bb5\u6811**\u7ef4\u62a4\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u5bf9\u7ebf\u6bb5\u6811\u4e0a\u4e00\u4e2a\u533a\u95f4\uff0c\u6211\u4eec\u7ef4\u62a4\u4e09\u4e2a\u4e1c\u897f\uff1a\n\n- \u8fd9\u6bb5\u533a\u95f4**\u6700\u524d\u9762**\u7684\u4e00\u4e2a\u5751\uff08\u4e5f\u53ef\u80fd\u662f\u534a\u4e2a\u5751\uff0c\u4e5f\u5c31\u662f\u53ea\u6709\u4e0b\u5761\u6216\u53ea\u6709\u4e0a\u5761\uff09\u3002\n- \u8fd9\u6bb5\u533a\u95f4**\u6700\u540e\u9762**\u7684\u4e00\u4e2a\u5751\uff08\u4e5f\u53ef\u80fd\u662f\u534a\u4e2a\u5751\uff1b\u4e5f\u53ef\u80fd\u6839\u672c\u4e0d\u5b58\u5728\uff0c\u56e0\u4e3a\u6574\u6bb5\u533a\u95f4\u5c31\u53ea\u6709\u4e00\u4e2a\u5751\uff0c\u5df2\u7ecf\u8bb0\u5f55\u5728\u4e0a\u4e00\u6761\u91cc\u4e86\uff09\u3002\n- \u8fd9\u6bb5\u533a\u95f4\uff0c\u4e2d\u95f4\uff08\u4e0d\u7b97\u6700\u524d\u9762\u3001\u6700\u540e\u9762\u7684\u5751\uff09\uff0c\u6700\u5927\u7684\u5751\u7684\u5927\u5c0f\u3002\n\n\u4f8b\u5982\uff1a``><<>><>><<>>>>``\u8fd9\u6bb5\u533a\u95f4\u3002\n\n- \u6700\u524d\u9762\u7684\u5751\uff0c\u5c31\u662f``><<``\u3002\u6211\u4eec\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u8bb0\u5f55\u5b83\u7684\u4e0b\u5761\u957f\u5ea6\uff1a$1$\uff0c\u4e0a\u5761\u957f\u5ea6\uff1a$2$\u3002\n- \u6700\u540e\u9762\u7684\u5751\uff0c\u5c31\u662f``>>>>``\u3002\u6211\u4eec\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u8bb0\u5f55\u5b83\u7684\u4e0b\u5761\u957f\u5ea6\uff1a$4$\uff0c\u4e0a\u5761\u957f\u5ea6\uff1a$0$\u3002\n- \u4e2d\u95f4\u7684\uff0c\u5c31\u662f\u6307``>><>><<``\u8fd9\u6bb5\uff0c\u6709\uff1a``>><``\u548c``>><<``\u4e24\u4e2a\u5751\u3002\u5176\u4e2d\u6700\u5927\u7684\u662f\u7b2c\u4e8c\u4e2a\uff0c\u5927\u5c0f\u4e3a$4$\u3002\u6211\u4eec\u5c31\u8bb0\u5f55\u8fd9\u4e2a\u5927\u5c0f\uff1a$4$\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u91cd\u70b9\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\u3002\n\n\u95ee\u9898\u4e00\uff0c\u662f\u533a\u95f4\u600e\u4e48\u5408\u5e76\uff1f\u4e5f\u5c31\u662f\u5728\u7ebf\u6bb5\u6811\u4e0a\uff0c\u5f53\u524d\u533a\u95f4\u6709\u4e00\u5de6\u4e00\u53f3\u4e24\u4e2a\u513f\u5b50\uff0c\u600e\u4e48\u628a\u5b83\u4eec\u7684\u4fe1\u606f\u5408\u5e76\u8d77\u6765\uff08$\\texttt{push_up}$\uff09\u5462\uff1f\u53d1\u73b0\u91cd\u70b9\uff0c\u5728\u4e8e\u5904\u7406\u4e2d\u95f4\u7684\u62fc\u63a5\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u5de6\u513f\u5b50\u7684\u201c\u540e\u9762\u7684\u5751\u201d\uff0c\u548c\u53f3\u513f\u5b50\u7684\u201c\u524d\u9762\u7684\u5751\u201d\uff0c\u5982\u4f55\u7ed3\u5408\u3002\u7ed3\u5408\u540e\uff0c\u53ef\u80fd\u65b0\u4ea7\u751f$0$, $1$\u6216$2$\u4e2a\u201c\u4e2d\u95f4\u7684\u5751\u201d\uff0c\u4e5f\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230\u5408\u5e76\u540e\u7684\u533a\u95f4\u7684\u201c\u524d\u9762\u7684\u5751\u201d\u6216\u201c\u540e\u9762\u7684\u5751\u201d\u7684\u5f62\u6001\u3002\u5927\u529b\u5206\u7c7b\u8ba8\u8bba\u5373\u53ef\u3002\n\n\u95ee\u9898\u4e8c\uff0c\u662f\u5982\u4f55\u5b9e\u73b0\u533a\u95f4\u53cd\u8f6c\uff1f\u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u5f00\u59cb\u5efa\u7ebf\u6bb5\u6811\u7684\u65f6\u5019\uff0c\u5c31\u5904\u7406\u597d\u201c\u53cd\u8f6c\u524d\u201d\u548c\u201c\u53cd\u8f6c\u540e\u201d\u4e24\u5957\u4fe1\u606f\u3002\u5f53\u9700\u8981\u628a\u4e00\u4e2a\u533a\u95f4\u53cd\u8f6c\u65f6\uff0c\u5c31\u628a\u8fd9\u4e24\u5957\u4fe1\u606f\u4ea4\u6362\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n+q\\log n)$\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff08\u5206\u7c7b\u8ba8\u8bba\u5199\u7684\u6bd4\u8f83\u9ebb\u70e6\uff0c\u5efa\u8bae\u8bfb\u8005\u81ea\u5df1\u5b9e\u73b0\uff09\uff1a\n\n```cpp\n//\u97e9\u4fe1\u5e26\u51c0\u5316\uff0c\u53ea\u6709\u4f60\u4eec\u60f3\u4e0d\u5230\u7684\uff0c\u6ca1\u6709\u6bdb\u961f\u505a\u4e0d\u5230\u7684\n//\u5927\u529b\u8ba8\u8bba\u5c31\u5b8c\u4e8b\u4e86\uff0c\u5965\u5229\u7ed9\uff01\uff01\uff01\n//problem:CF1371F\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define pb push_back\n#define mk make_pair\n#define lob lower_bound\n#define upb upper_bound\n#define fi first\n#define se second\n#define SZ(x) ((int)(x).size())\n\ntypedef unsigned int uint;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int> pii;\n\nconst int MAXN=5e5;\nint n,q;\nchar s[MAXN+5];\n\nstruct RangeInfo{\n\tint left_down,left_up;\n\tint right_down,right_up;\n\tint ans;//\u9664\u53bb\u5934\u5c3e\u540e\u7684\u6700\u5927\u7b54\u6848\n\tRangeInfo(){\n\t\tleft_down=left_up=right_down=right_up=ans=0;\n\t}\n};\nRangeInfo merge(const RangeInfo& a,const RangeInfo& b){\n\tRangeInfo res;\n\tres.left_down=a.left_down;\n\tres.left_up=a.left_up;\n\tres.right_down=b.right_down;\n\tres.right_up=b.right_up;\n\tres.ans=max(a.ans,b.ans);\n\t\n\tif(a.right_up){\n\t\tassert(a.right_down!=0);\n\t\tif(b.left_down){\n\t\t\tres.ans=max(res.ans,a.right_down+a.right_up);\n\t\t\tif(b.left_up){\n\t\t\t\tif(b.right_down)res.ans=max(res.ans,b.left_down+b.left_up);\n\t\t\t\telse{\n\t\t\t\t\tres.right_down=b.left_down;\n\t\t\t\t\tres.right_up=b.left_up;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tres.right_down=b.left_down;\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tassert(b.left_up!=0);\n\t\t\tif(b.right_down){\n\t\t\t\tres.ans=max(res.ans,a.right_down+a.right_up+b.left_up);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tres.right_down=a.right_down;\n\t\t\t\tres.right_up=a.right_up+b.left_up;\n\t\t\t}\n\t\t}\n\t}\n\telse{\n\t\tif(a.right_down){\n\t\t\tif(b.left_down){\n\t\t\t\tif(b.left_up){\n\t\t\t\t\tif(b.right_down)res.ans=max(res.ans,a.right_down+b.left_down+b.left_up);\n\t\t\t\t\telse{\n\t\t\t\t\t\tres.right_down=a.right_down+b.left_down;\n\t\t\t\t\t\tres.right_up=b.left_up;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tres.right_down=a.right_down+b.left_down;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tassert(b.left_up!=0);\n\t\t\t\tif(b.right_down)res.ans=max(res.ans,a.right_down+b.left_up);\n\t\t\t\telse{\n\t\t\t\t\tres.right_down=a.right_down;\n\t\t\t\t\tres.right_up=b.left_up;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tif(a.left_down){\n\t\t\t\tif(a.left_up){\n\t\t\t\t\tif(b.left_down){\n\t\t\t\t\t\tif(b.left_up){\n\t\t\t\t\t\t\tif(b.right_down)res.ans=max(res.ans,b.left_down+b.left_up);\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tres.right_down=b.left_down;\n\t\t\t\t\t\t\t\tres.right_up=b.left_up;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tres.right_down=b.left_down;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tassert(b.left_up!=0);\n\t\t\t\t\t\tres.left_up=a.left_up+b.left_up;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tres.left_down=a.left_down+b.left_down;\n\t\t\t\t\tres.left_up=b.left_up;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tassert(a.left_up!=0);\n\t\t\t\tif(b.left_down){\n\t\t\t\t\tif(b.left_up){\n\t\t\t\t\t\tif(b.right_down)res.ans=max(res.ans,b.left_down+b.left_up);\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tres.right_down=b.left_down;\n\t\t\t\t\t\t\tres.right_up=b.left_up;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tres.right_down=b.left_down;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tassert(b.left_up!=0);\n\t\t\t\t\tres.left_up=a.left_up+b.left_up;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n}\nint getans(const RangeInfo& a){\n\tint ans=a.ans;\n\tans=max(ans,a.left_down+a.left_up);\n\tans=max(ans,a.right_down+a.right_up);\n\treturn ans;\n}\nstruct SegmentTree{\n\tRangeInfo cur[MAXN*4+5],rev[MAXN*4+5];\n\tbool tag[MAXN*4+5];\n\tvoid push_up(int p){\n\t\tcur[p]=merge(cur[p<<1],cur[p<<1|1]);\n\t\trev[p]=merge(rev[p<<1],rev[p<<1|1]);\n\t}\n\tvoid build(int p,int l,int r){\n\t\tif(l==r){\n\t\t\tif(s[l]=='>'){\n\t\t\t\tcur[p].left_down=1;\n\t\t\t\trev[p].left_up=1;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tcur[p].left_up=1;\n\t\t\t\trev[p].left_down=1;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tbuild(p<<1,l,mid);\n\t\tbuild(p<<1|1,mid+1,r);\n\t\tpush_up(p);\n\t}\n\tvoid upd(int p){\n\t\ttag[p]^=1;\n\t\tswap(cur[p],rev[p]);\n\t}\n\tvoid push_down(int p){\n\t\tif(tag[p]){\n\t\t\tupd(p<<1);\n\t\t\tupd(p<<1|1);\n\t\t\ttag[p]=0;\n\t\t}\n\t}\n\tvoid modify(int p,int l,int r,int ql,int qr){\n\t\t//\u533a\u95f4\u53cd\u8f6c\n\t\tif(ql<=l && qr>=r){\n\t\t\tupd(p);\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tpush_down(p);\n\t\tif(ql<=mid)modify(p<<1,l,mid,ql,qr);\n\t\tif(qr>mid)modify(p<<1|1,mid+1,r,ql,qr);\n\t\tpush_up(p);\n\t}\n\tRangeInfo Q_res;\n\tbool flag;\n\tvoid query(int p,int l,int r,int ql,int qr){\n\t\tif(ql<=l && qr>=r){\n\t\t\tif(!flag){\n\t\t\t\tQ_res=cur[p];\n\t\t\t\tflag=1;\n\t\t\t}\n\t\t\telse Q_res=merge(Q_res,cur[p]);\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tpush_down(p);\n\t\tif(ql<=mid)query(p<<1,l,mid,ql,qr);\n\t\tif(qr>mid)query(p<<1|1,mid+1,r,ql,qr);\n\t\tpush_up(p);\n\t}\n\tRangeInfo query(int l,int r){\n\t\tQ_res=RangeInfo();\n\t\tflag=0;\n\t\tquery(1,1,n,l,r);\n\t\treturn Q_res;\n\t}\n}T;\n\nint main() {\n\tcin>>n>>q;\n\tcin>>(s+1);\n\tT.build(1,1,n);\n\twhile(q--){\n\t\tint l,r;cin>>l>>r;\n\t\tT.modify(1,1,n,l,r);\n\t\tRangeInfo res=T.query(l,r);\n\t\tcout<<getans(res)<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1593909814,
        "uid": 100674,
        "name": "duyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1371F \u3010Raging Thunder\u3011"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\u8bf4\uff1a\u7ed9\u5b9a\u957f\u5ea6\u4e3a $n\\le 5\\times 10^5$ \u7684\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u662f $<$ \u6216\u8005 $>$\uff0c$q\\le 10^5$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u5b9a\u533a\u95f4 $[l,r]$ \u95ee\uff1a\u5148\u7ffb\u8f6c\u8fd9\u4e2a\u533a\u95f4\u7684\u5143\u7d20\uff0c\u518d\u8be2\u95ee**\u5982\u679c**\u5c06\u6bcf\u4e2a\u4f4d\u7f6e\u653e\u4e00\u4e2a\u7403\uff0c\u7403\u7684\u79fb\u52a8\u6cbf\u7740\u7bad\u5934\u65b9\u5411\uff0c\u76f4\u5230\u4e0d\u80fd\u79fb\u52a8\uff0c\u4e2a\u6570\u6700\u591a\u7684\u7a7a\u6709\u591a\u5c11\u4e2a\u7403\u3002\n\n## \u9898\u89e3\n\u4ecb\u7ecd\u597d\u5199\u7684\u5206\u5757\u505a\u6cd5\uff0c\u6ce8\u610f\u5230\u65f6\u9650 $3s$ \u4e14\u8be2\u95ee\u53ea\u6709 $10^5$ \u6b21\u3002\n\n\u8003\u8651\u4e00\u4e2a\u8be2\u95ee\uff0c\u53ef\u4ee5\u89c6\u4e3a\u5728 $<>$ \u4e4b\u95f4\u653e\u4e00\u5757\u677f\u5b50\uff0c\u5219\u7b54\u6848\u5c31\u662f\u6700\u5927\u76f8\u90bb\u677f\u5b50\u7684\u8ddd\u79bb\uff0c\u9ed8\u8ba4\u533a\u95f4\u5f00\u5934\u7ed3\u5c3e\u6709\u4e00\u5757\u677f\u5b50\u3002\n\n\u76f4\u63a5\u8003\u8651\u5206\u5757\uff0c\u7ef4\u62a4\u5f53\u524d\u5757\u5185\u90e8\u7b54\u6848\uff0c\u5757\u5185\u6700\u9760\u5de6\u677f\u5b50\u4f4d\u7f6e\uff0c\u5757\u5185\u6700\u9760\u53f3\u677f\u5b50\u4f4d\u7f6e\uff0c\u5408\u5e76\u662f\u7b80\u5355\u7684\uff0c\u6ce8\u610f\u5230\u4f1a\u6709\u7ffb\u8f6c\u4fee\u6539\uff0c\u540c\u65f6\u7ef4\u62a4\u5f53\u524d\u5757\u7ffb\u8f6c\u540e\u7684\u4fe1\u606f\u3002\n\n\u590d\u6742\u5ea6 $O(q\\sqrt n)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nnamespace ifzw{\n//~ #define int LL\n#define ll long long\n#define dd double\n#define ull unsigned ll \n#define LL __int128\n#define siz(A) ((int)A.size())\nusing namespace std;\nchar gc(){static char buf[1<<16],*s,*t;if(s==t){t=(s=buf)+fread(buf,1,1<<16,stdin);if(s==t)return EOF;}return *s++;}\n#define getchar gc\nll read()\n{\n\tchar c;\n\tll w=1;\n\twhile((c=getchar())>'9'||c<'0')if(c=='-')w=-1;\n\tll ans=c-'0';\n\twhile((c=getchar())>='0'&&c<='9')ans=(ans<<1)+(ans<<3)+c-'0';\n\treturn ans*w;\n}\nvoid pc(char c,int op)\n{\n\tstatic char buf[1<<16],*s=buf,*t=buf+(1<<16);\n\t(op||((*s++=c)&&(s==t)))&&(fwrite(buf,1,s-buf,stdout),s=buf);\n}\nvoid wt(int x)\n{\n\tif(x>9)wt(x/10);\n\tpc('0'+x%10,0);\n}\nvoid wts(int x,char op)\n{\n\tif(x<0)pc('-',0),x=-x;\n\twt(x),pc(op,0);\n}\nchar ST;\nconst int xx=5e5+5;\nconst int B=700;\nint n,q;\nint a[xx],tag[xx],mn[xx][2],mx[xx][2],ans[xx][2],L[xx],R[xx],bel[xx];\nchar s[xx];\nvoid pre(int x)\n{\n\tint l=L[x],r=R[x];\n\tif(tag[x])\n\t{\n\t\tfor(int i=l;i<=r;i++)s[i]^=tag[x];\n\t\ttag[x]=0;\n\t}\n\tmn[x][0]=-1,mx[x][0]=-1;\n\tmn[x][1]=-1,mx[x][1]=-1;\n\tint ct=0;ans[x][0]=ans[x][1]=0;\n\tfor(int i=l;i<r;i++)\n\t{\n\t\t++ct,ans[x][0]=max(ans[x][0],ct);\n\t\tif(s[i]==0&&s[i+1]==1)\n\t\t{\n\t\t\tct=0;\n\t\t\tmx[x][0]=i;\n\t\t\tif(mn[x][0]==-1)mn[x][0]=i;\n\t\t}\n\t}\n\t++ct,ans[x][0]=max(ans[x][0],ct);\n\tct=0;\n\tfor(int i=l;i<r;i++)\n\t{\n\t\t++ct,ans[x][1]=max(ans[x][1],ct);\n\t\tif(s[i]==1&&s[i+1]==0)\n\t\t{\n\t\t\tct=0;\n\t\t\tmx[x][1]=i;\n\t\t\tif(mn[x][1]==-1)mn[x][1]=i;\n\t\t}\n\t}\n\t++ct,ans[x][1]=max(ans[x][1],ct);\n}\nint get(int x){return tag[bel[x]]^s[x];}\nchar ED;\nint main(){\n\tcerr<<abs(&ST-&ED)/1024.0/1024<<\"\\n\";\n\t#ifdef AAA\n\tsystem(\"ulimit -s 524288\");\n\tcerr<<\" stack is on \\n\";\n\t#endif \n\t//~ freopen(\"a.in\",\"r\",stdin);\n\t//~ freopen(\"a.out\",\"w\",stdout);\n\tn=read(),q=read();\n\t//0: < 1\uff1a>\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tchar c;\n\t\twhile((c=getchar())!='<'&&c!='>');\n\t\tif(c=='<')s[i]=0;\n\t\tif(c=='>')s[i]=1;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tbel[i]=(i-1)/B+1;\n\t\tR[bel[i]]=i;\n\t\tif(!L[bel[i]])L[bel[i]]=i;\n\t}\n\tfor(int i=1;i<=bel[n];i++)pre(i);\n\twhile(q--)\n\t{\n\t\tint l=read(),r=read();\n\t\tif(bel[l]==bel[r])\n\t\t{\n\t\t\tfor(int i=l;i<=r;i++)s[i]^=1;\n\t\t\tpre(bel[l]);\n\t\t\tint ct=0,an=0;\n\t\t\tfor(int i=l;i<=r;i++)\n\t\t\t{\n\t\t\t\t++ct,an=max(an,ct);\n\t\t\t\tif(s[i]==0&&s[i+1]==1)ct=0;\n\t\t\t}\n\t\t\tcout<<an<<\"\\n\";\n\t\t\tcontinue;\n\t\t}\n\t\tfor(int i=l;i<=R[bel[l]];i++)s[i]^=1;\n\t\tfor(int i=L[bel[r]];i<=r;i++)s[i]^=1;\n\t\tfor(int i=bel[l]+1;i<=bel[r]-1;i++)tag[i]^=1;//\u63d0\u524d\u7ffb\u8f6c\u3002\n\t\tpre(bel[l]),pre(bel[r]);\n\t\tint ct=0,an=0;\n\t\tfor(int i=l;i<=R[bel[l]];i++)\n\t\t{\n\t\t\t++ct,an=max(an,ct);\n\t\t\tif(get(i)==0&&get(i+1)==1)ct=0;\n\t\t}\n\t\t//~ for(int i=1;i<=n;i++)cout<<get(i);\n\t\t//~ puts(\"\");\n\t\t//~ cerr<<ct<<\" \"<<an<<\"@#@#\\n\";\n\t\tfor(int i=bel[l]+1;i<=bel[r]-1;i++)\n\t\t{\n\t\t\tif(mn[i][tag[i]]==-1)ct+=R[i]-L[i]+1,an=max(an,ct);\n\t\t\telse ct+=mn[i][tag[i]]-L[i]+1,an=max(an,ct),ct=R[i]-mx[i][tag[i]];\n\t\t\tan=max(an,ans[i][tag[i]]);\n\t\t\tif(get(R[i])==0&&get(R[i]+1)==1)ct=0;\n\t\t}\n\t\tfor(int i=L[bel[r]];i<=r;i++)\n\t\t{\n\t\t\t++ct,an=max(an,ct);\n\t\t\tif(get(i)==0&&get(i+1)==1)ct=0;\n\t\t}\n\t\tcout<<an<<\"\\n\";\n\t}\n\tpc('1',1);\n\treturn 0;\n}\n\n}signed main(){return ifzw::main();}\n\n```",
        "postTime": 1683799095,
        "uid": 371852,
        "name": "\u4e00\u5ff5\u4e4b\u95f4\u3001\u3001",
        "ccfLevel": 0,
        "title": "CF1371F"
    },
    {
        "content": "**~~\u601d\u8def10min\uff0c\u7a0b\u5e8f2h\uff0c\u8c03\u8bd57h\u3002~~**\n\n\u770b\u5230\u4e0a\u9762\u7684\u5b57\uff0c\u6ca1\u6709\u6df1\u539a\u4ee3\u7801\u529f\u5e95\u548c\u5f3a\u5927\u6bc5\u529b\u7684\u540c\u5b66\u5efa\u8bae\u4e0d\u8981\u5c1d\u8bd5\u5207\u8fd9\u9053\u9898\u3002\n\n**\u5fe0\u544a\uff1a\u5efa\u8bae\u5927\u5bb6\u522b\u770b\u4ee3\u7801\uff0c\u56e0\u4e3a\u592a\u4e71\uff0c\u57fa\u672c\u4e0a\u770b\u4e0d\u61c2\uff0c\u770b\u770b\u601d\u8def\u548c\u4e0b\u9762\u7684\u7ec6\u8282\u63d0\u9192\u5373\u53ef\uff0c\u4ee3\u7801\u5f53\u4e14\u4ec5\u5f53\u662f\u5728\u4e0d\u77e5\u9053\u54ea\u91cc\u9519\u662f\uff0c\u5bf9\u62cd\u4e00\u4e0b\uff0c\u5bf9\u62cd\u7a0b\u5e8f\u4e0b\u9762\u4f1a\u7ed9**\n\n\u6211\u4eec\u56de\u5230\u6b63\u9898\uff0c\u770b\u5230\u8fd9\u4e2a\u9898\u3002\u6211\u4eec\u53d1\u73b0\u6240\u6709\u6ee1\u8db3 ```>>><<<```,```>>>>```,```<<<<```\u5f62\u5f0f\u7684\u533a\u95f4\u4f1a\u8c03\u5230\u4e00\u4e2a\u5730\u65b9\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u91cd\u70b9\u5173\u6ce8\u8fd9\u4e2a\u7ed3\u6784\uff0c\u4e0b\u9762\u6211\u4eec\u79f0\u4e4b\u4e3a \u201c\u5c0f\u53ef\u7231\u201d\uff08\u56e0\u4e3a\u5b83\u50cf>_<\u8fd9\u4e2a\u8868\u60c5\uff09:D\u3002\u6211\u4eec\u7ed9\u4e09\u79cd\u201c\u5c0f\u53ef\u7231\u201d\u8d77\u4e2a\u4ee3\u53f7\u5427\uff08\u4e5f\u5c31\u662f\u4ed6\u4eec\u7684\u7c7b\u578b\uff09\uff1a\n\n|\u201c\u5c0f\u53ef\u7231\u201d\u5f62\u72b6|\u7f16\u53f7|\n|:--:|:--:|:---:|:--:|\n|>>>|$1$|\n|<<<|$2$|\n|><<|$3$|\n\n\u770b\u5230\u533a\u95f4\u7684\u7ef4\u62a4\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u7ebf\u6bb5\u6811\uff0c\u4f46\u662f\u600e\u4e48\u7ef4\u62a4\uff1f\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4 $l,r,ln,rn,lt,rt,lazy$ ~~\u5373\u53ef~~\uff0c\u89c1\u4e0b\u8868\uff1a\n\n||\u5168\u79f0|\u610f\u4e49|\n|:--:|:--:|:---:|\n|$l$|$l$|\u5de6\u8282\u70b9\u7f16\u53f7|\n|$r$|$r$|\u53f3\u8282\u70b9\u7f16\u53f7|\n|$ln$|$rnum$|\u4ece\u5de6\u8d77\u6700\u957f\u7684\u201c\u5c0f\u53ef\u7231\u201d\u7684\u957f\u5ea6|\n|$rn$|$lnum$|\u4ece\u53f3\u8d77\u6700\u957f\u7684\u201c\u5c0f\u53ef\u7231\u201d\u7684\u957f\u5ea6|\n|$lt$|$l type$|\u4ece\u5de6\u8d77\u6700\u957f\u7684\u201c\u5c0f\u53ef\u7231\u201d\u7684\u7f16\u53f7|\n|$rt$|$r type$|\u4ece\u53f3\u8d77\u6700\u957f\u7684\u201c\u5c0f\u53ef\u7231\u201d\u7684\u7f16\u53f7|\n|$lazy$|$lazy$|\u61d2\u6807\u8bb0|\n\n**\u7ebf\u6bb5\u6811\u7684\u5b9a\u4e49**\n\n```cpp\nstruct seg_tree {\n\tint ln,rn,mn,l,r;\n\tshort lt,rt;\n\tint lazy;\n\t\n\tint ans() {\n\t\treturn max(max(ln,rn),mn);\n\t}\n\tint len() {\n\t\treturn r-l+1;\n\t}\n\tvoid make() {\n\t\tln=rn=mn=lt=rt=l=r=lazy=0;\n\t}\n\tbool operator == (const seg_tree x) {\n\t\treturn ln==x.ln&&rn==x.rn&&mn==x.mn&&lt==x.lt&&rt==x.rt&&l==x.l&&r==x.r;\n\t}\n}s[2][maxn*20],ret[maxn*20];\n```\n\n\u77e5\u9053\u4e24\u4e2a\u533a\u95f4\u7684\u8fd9\u4e9b\u4fe1\u606f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5408\u5e76\u51fa\u4e00\u4e2a\u65b0\u7684\u533a\u95f4\uff0c\u6211\u4eec\u4e5f\u5c31\u53ef\u4ee5\u53ef\u4ee5\u89e3\u51b3\u7ebf\u6bb5\u6811\u7684 ```build```\u3002\u8fd9\u4e2a\u8ba8\u8bba\u592a\u590d\u6742\u4e86\uff0c\u8bb2\u4e0d\u592a\u6e05\u695a\uff0c\u53ef\u4ee5\u81ea\u5df1\u601d\u8003\u4e00\u4e0b :)\u3002\n\n**\u5408\u5e76\uff1a**\n\n```cpp\nseg_tree pushup(seg_tree a,seg_tree b) {\n\tcalcnum++;\n\tseg_tree ret;\n\tret.make();\n\tif(a==ret) {\n\t\treturn b;\n\t}\n\tif(b==ret) {\n\t\treturn a;\n\t}\n\t//l:\n\t//1:>>>>\n\t//2:<<<<\n\t//3:>><<\n\tif(a.len()==a.ln) {\n\t\tif(a.lt==1) {\n\t\t\tret.ln=a.ln+b.ln;\n\t\t\tif(b.lt==1) {\n\t\t\t\tret.lt=1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret.lt=3;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif(b.lt==2) {\n\t\t\t\tret.lt=a.lt;\n\t\t\t\tret.ln=b.ln+a.ln;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret.ln=a.ln;\n\t\t\t\tret.lt=a.lt;\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\tret.ln=a.ln;\n\t\tret.lt=a.lt;\n\t} \n\t//r:\n\t//1:>>>>\n\t//2:<<<<\n\t//3:>><<\n\tif(b.len()==b.rn) {\n\t\tif(b.rt==2) {\n\t\t\tret.rn=a.rn+b.rn;\n\t\t\tif(a.rt==2) {\n\t\t\t\tret.rt=2;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret.rt=3;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif(a.rt==1) {\n\t\t\t\tret.rt=b.rt;\n\t\t\t\tret.rn=b.rn+a.rn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret.rn=b.rn;\n\t\t\t\tret.rt=b.rt;\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\tret.rn=b.rn;\n\t\tret.rt=b.rt;\n\t}\n\t//m:\n\t//1:>>>>\n\t//2:<<<<\n\t//3:>><<\n\tif(a.rt==1) {\n\t\tret.mn=a.rn+b.ln;\n\t}\n\telse if(a.rt==2) {\n\t\tif(b.lt==2) {\n\t\t\tret.mn=a.rn+b.ln;\n\t\t}\n\t}\n\telse {\n\t\tif(b.lt==2) {\n\t\t\tret.mn=a.rn+b.ln;\n\t\t}\n\t}\n\t//\n\tif(ret.mn<a.mn) {\n\t\tret.mn=a.mn;\n\t}\n\tif(ret.mn<b.mn) {\n\t\tret.mn=b.mn;\n\t}\n\t\n\tret.l=a.l;ret.r=b.r;\n\t\n\treturn ret;\n}\n```\n\n**build**\n\n```cpp\nvoid build(int l,int r,int p) {\n\tcalcnum++;\n\tif(l==r) {\n\t\ts[0][p].ln=s[0][p].rn=s[0][p].mn=1;\n\t\ts[0][p].l=s[0][p].r=l;\n\t\ts[0][p].lazy=0;\n\t\tif(a[0][l]==0) {//'>' \u5bf9\u5e94 0\n\t\t\ts[0][p].lt=s[0][p].rt=1;\n\t\t}\n\t\telse {//'<' \u5bf9\u5e94 1\n\t\t\ts[0][p].lt=s[0][p].rt=2;\n\t\t}//\u521d\u59cb\u5316\uff0c\u4e5f\u8981\u8ba8\u8bbaqwq\n\t\t\n\t\ts[1][p].ln=s[1][p].rn=s[1][p].mn=1;\n\t\ts[1][p].l=s[1][p].r=l;\n\t\ts[1][p].lazy=1;\n\t\tif(a[1][l]==0) {\n\t\t\ts[1][p].lt=s[1][p].rt=1;\n\t\t}\n\t\telse {\n\t\t\ts[1][p].lt=s[1][p].rt=2;\n\t\t}\n\t\treturn ;\n\t}\n\t\n\tint mid=(l+r)>>1;\n\t\n\tbuild(l,mid,p<<1);\n\tbuild(mid+1,r,p<<1|1);\n\t\n\ts[0][p]=pushup(s[0][p<<1],s[0][p<<1|1]);\n\ts[1][p]=pushup(s[1][p<<1],s[1][p<<1|1]);\n}\n```\n\n\u90a3\u4e48\u6709\u7684\u5c0f\u4f19\u4f34\u4f1a\u53d1\u73b0\u6211\u7684\u7ebf\u6bb5\u6811\u5b9a\u4e49\u4e86```s[2][maxn]```\u3002\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u7684\u7279\u6b8a\u4fee\u6539\u64cd\u4f5c\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u6211\u4eec\u8981\u5904\u7406\u8fd9\u4e2a\u4fee\u6539\u64cd\u4f5c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u8981\u5efa\u4e24\u9897\u6811\uff0c\u4e00\u9897\u662f\u539f\u6765\u7684\uff0c\u4e00\u9897\u662f\u5012\u8fc7\u6765\u7684\u3002\u53ea\u8981\u6d89\u53ca\u5230\u7ffb\u8f6c????\uff0c\u5c31\u4ea4\u6362\u4e00\u4e0b\u4fe1\u606f\u3002\u6240\u4ee5\u6211\u4eec\u8981\u7ef4\u62a4\u4e24\u9897\u6811\u3002\u6ce8\u610f\u61d2\u6807\u8bb0\u3002\n\n**modify**\n\n```cpp\nvoid modify(int l,int r,int p,int x,int y) {\n\tcalcnum++;\n\tpushdown(p);\n\tif(y<l||r<x) {\n\t\treturn ;\n\t}\n\tif(x<=l&&r<=y) {\n\t\tswap(s[0][p],s[1][p]);\n\t\ts[0][p].lazy^=1;\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tmodify(l,mid,p<<1,x,y);\n\tmodify(mid+1,r,p<<1|1,x,y);\n\ts[0][p]=pushup(s[0][p<<1],s[0][p<<1|1]);\n\ts[1][p]=pushup(s[1][p<<1],s[1][p<<1|1]);\n}\n```\n\n\u6700\u540e\u662f```query```\u3002\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5199\u4e00\u4e2a\u8fd4\u56de\u7c7b\u578b\u4e3a seg_tree \u7684\u51fd\u6570\uff0c\u5f53\u7136\u8fd9\u91cc\u63d0\u4e00\u4e0b void\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u5f00\u4e00\u4e2a\u6570\u7ec4\u653e \u7b54\u6848\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u4e00\u4e2a\u5b8c\u6574\u533a\u95f4\u91cc\u6570\u90fd\u662f\u7b54\u6848\u9700\u8981\u7684\u3002\u6bd4\u5982\u8bf4\u5bf9\u4e8e $n=5$ \u4e00\u6b21\u8be2\u95ee\u4e3a $[2,4]$\uff0c\u90a3\u4e48\u5728\u6211\u4eec\u5df2\u7ecf\u7ef4\u62a4\u597d\u7684 $[1,3]$ \u4e2d\uff0c\u53ea\u6709 $[2,3]$ \u8fd9\u4e2a\u533a\u95f4\u5728\u5185\uff0c\u6211\u4eec\u7684 ```ret```\u6570\u7ec4\u7ef4\u62a4\u7684\u5c31\u662f $[2,3]$ \u4e2d\u7684\u4fe1\u606f\u3002\u8fd9\u6837\u4e00\u8def\u5408\u5e76\u4e0a\u53bb\uff0c\u6211\u4eec\u5f97\u5230\u7684```ret[1]```\u5c31\u662f\u6700\u540e\u7b54\u6848\u533a\u95f4\u5566\u3002\n\n**query**\n\n```cpp\nvoid query(int l,int r,int p,int x,int y) {\n\tpushdown(p);\n\tif(y<l||r<x) {\n\t\tseg_tree qwq;\n\t\tqwq.make();\n\t\tret[p]=qwq;\n\t\treturn ;\n\t}\n\tif(x<=l&&r<=y) {\n\t\tret[p]=s[0][p];\n\t\treturn ;\n\t}\n\t\n\tint mid=(l+r)>>1;\n\t\n\tquery(l,mid,p<<1,x,y);\n\tquery(mid+1,r,p<<1|1,x,y); \n\t\n\tret[p]=pushup(ret[p<<1],ret[p<<1|1]);\n\treturn ;\n}\n```\n\n\u6700\u540e\u8bf4\u4e00\u4e0b\u7ec6\u8282\u95ee\u9898\uff0c\u8fd9\u4e2a\u9898\u8c03\u8bd57h\u5c31\u662f\u56e0\u4e3a\u7ec6\u8282\u592a\u591a :(\n\n1.\u61d2\u6807\u8bb0\u6211\u4eec\u4e00\u5b9a\u8981\u5c0f\u5fc3\uff0c\u56e0\u4e3a\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u7684\u61d2\u6807\u8bb0\u4e3a $1$\uff0c\u4ed6\u7684\u7236\u533a\u95f4\u8981\u4e0b\u4f20\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u8981\u628a\u8fd9\u4e2a\u533a\u95f4\u5148\u6362\u8fc7\u6765\uff0c\u4f46\u662f\u61d2\u6807\u8bb0\u6539\u4e3a $1$\u3002  \n2.\u6ce8\u610f $s_1$ \u8fd9\u9897\u6811\u4e0a\u7684\u61d2\u6807\u8bb0\u5fc5\u987b\u65f6\u65f6\u523b\u523b\u5168\u90e8\u4e3a $0$\uff01\u8fd9\u6837\u6362\u8fc7\u6765\u7684\u65f6\u5019\u4e0d\u4f1a\u51fa\u95ee\u9898\u3002  \n3.\u5728 ```pushup```\u91cc\u9762\u4e00\u5b9a\u8981\u5c0f\u5fc3\u5c0f\u5fc3\u518d\u5c0f\u5fc3\uff0c\u4e00\u4e0d\u7559\u795e\u5c31\u4f1a\u5199\u9519\u3002  \n4.\u5efa\u8bae\u591a\u5bf9\u62cd  \n5.\u5bf9\u4e8e\u8c03\u8bd5\uff0c\u6709\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u65b9\u6cd5\uff0c\u7279\u522b\u662f\u590d\u6742\u5ea6\u4e0d\u5bf9\u65f6\uff08\u56e0\u4e3a\u6211\u9047\u5230\u4e86\uff09\uff0c\u53ef\u4ee5\u5c4f\u853d\u4e00\u4e2a\u51fd\u6570\uff0c\u770b\u770b\u8017\u65f6\u662f\u5426\u51cf\u5c0f\u5f88\u591a\uff0c\u5982\u679c\u662f\u7684\uff0c\u90a3\u4e48\u8fd9\u4e2a\u51fd\u6570\u4e00\u5b9a\u51fa\u5927\u95ee\u9898\u4e86\n\n**\u5bf9\u62cd\u7a0b\u5e8f\u89c1\u4e0b**\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nint read() {\n\tchar ch=getchar();\n\tint f=1,x=0;\n\twhile(ch<'0'||ch>'9') {\n\t\tif(ch=='-')\n\t\t\tf=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9') {\n\t\tx=x*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn f*x;\n}\nint n,q;\n\nsigned main() {\n\tfreopen(\"F.in\",\"w\",stdout);\n\t\n\tsrand(time(NULL));\n\t\n\tn=400000+rand()+rand()+rand();\n\tq=90000+rand();\n\tcout<<n<<\" \"<<q<<endl;\n\t\n\tfor(int i=1;i<=n;i++) {\n\t\tprintf(\"%c\",rand()%2==0? '>':'<');\n\t}\n\tcout<<endl;\n\tfor(int i=1;i<=q;i++) {\n\t\tint x,y;\n\t\tx=35000+rand();\n\t\ty=rand()+x+rand();\n\t\tprintf(\"%lld %lld\\n\",x,y);\n\t}\n\treturn 0;\n}\n//\u9020\u6570\u636e\n```\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nint read() {\n\tchar ch=getchar();\n\tint f=1,x=0;\n\twhile(ch<'0'||ch>'9') {\n\t\tif(ch=='-')\n\t\t\tf=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9') {\n\t\tx=x*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn f*x;\n}\n\nsigned main() {\n\t\n\tint t=read();\n\tsystem(\"cls\");\n\tfor(int i=1;i<=t;i++) {\n\t\tdouble a,b;\n\t\tprintf(\"Test Case %d\\n\",i);\n\t\t\n\t\tprintf(\"I'm makeing datum :D\\n\");\n\t\tsystem(\"duipai.exe\");\n\t\t\n\t\tprintf(\"I'm working on the answer ^_^\\n\");\n\t\ta=time(NULL);\n\t\tsystem(\"F_std.exe\");\n\t\tb=time(NULL);\n\t\tprintf(\"Done in %lf s\\n\",b-a);\n\t\t\n\t\tprintf(\"Running.......\\n\");\n\t\ta=time(NULL);\n\t\tsystem(\"F.exe\");\n\t\tb=time(NULL);\n\t\tprintf(\"Done in %lf s\\n\",b-a);\n\t\t\n\t\t\n\t\tif(!system(\"fc my.out std.out\")) {\n\t\t\tcout<<\"Accepted !!!\\n\\n\";\n\t\t}\n\t\telse {\n\t\t\tcout<<\"Wrong answer>_<\\n\\n\";\n\t\t}\n\t}\n\n\t//fclose(stdin);\n\t//fclose(stdout);\n\treturn 0;\n}\n//\u6d4b\u8bd5\n```\n\n\u5b8c\u6574\u7a0b\u5e8f\u5728[\u8fd9\u91cc](https://www.luogu.com.cn/paste/do8i69x5)\n\n~~\u4e0d\u8981\u5728\u610f\u706b\u8f66\u5934 :D~~",
        "postTime": 1594286768,
        "uid": 132976,
        "name": "huayucaiji",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF1371F \u3010Raging Thunder\u3011"
    },
    {
        "content": "$\\operatorname{Update\\ on\\ 2020.07.13:}$ \u4fee\u6539\u4e86\u4e00\u4e9b\u8868\u8ff0\u9519\u8bef\u3002\n\n\u9996\u5148\u53ef\u4ee5\u628a\u82e5\u5e72\u4e2a `>>><<` \u770b\u505a\u4e00\u4e2a\u5757\uff0c\u4e5f\u5c31\u662f\u6c42\u4f1a\u843d\u5230\u540c\u4e00\u4e2a\u6d1e\u91cc\u7684\u533a\u95f4\u770b\u505a\u4e00\u4e2a\u5757\u3002\n\n\u8fd9\u9053\u9898\u4e00\u773c\u770b\u8fc7\u53bb\u5c31\u5f88\u7ebf\u6bb5\u6811\u3002\u6211\u4eec\u8003\u8651\u5c06 $[l,mid]$ \u548c $(mid,r]$ \u5408\u5e76\u65f6\uff0c\u533a\u95f4 $[l,r]$ \u7684\u7b54\u6848 $ans$ \u5c31\u7b49\u4e8e\u5de6\u53f3\u533a\u95f4\u5404\u81ea\u7684 $ans$ \u4ee5\u53ca $[l,mid]$ \u7684\u6700\u53f3\u4e00\u4e2a\u5757\u548c $(mid,r]$ \u6700\u5de6\u4e00\u4e2a\u5757\u4ea7\u751f\u7684\u8d21\u732e\u7684\u6700\u5927\u503c\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5728\u7ebf\u6bb5\u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u4e0a\u7ef4\u62a4 $llen,lpos,rlen,rpos$ \u5206\u522b\u8868\u793a\u6700\u5de6/\u53f3\u7684\u5757\u7684\u957f\u5ea6\u4ee5\u53ca\u6c42\u4f1a\u843d\u5230\u54ea\u4e00\u4e2a\u6d1e\u5185\u3002\n\n\u90a3\u4e48\u5408\u5e76\u65f6\uff0c\u5206\u522b\u8ba8\u8bba\u56db\u79cd\u60c5\u51b5\uff0c\u4ee5\u5408\u5e76\u6700\u5de6\u7684\u5757\u4e3a\u4f8b\uff1a\uff08`|` \u8868\u793a $mid$ \u7684\u4f4d\u7f6e\uff09\n\n- \u5982\u679c $[l,mid].llen$ \u7b49\u4e8e\u5176\u533a\u95f4\u957f\u5ea6\uff0c\u90a3\u4e48\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\uff1a`>>>|<<<`\uff0c`>>>|><<`\uff0c`><<|<<<`\u3002\n- \u5426\u5219 $[l,r]$ \u6700\u5de6\u7684\u5757\u5c31\u548c $[l,mid]$ \u4e00\u6837\u3002\n\n\u5177\u4f53\u7ec6\u8282\u8bf7\u81ea\u884c\u601d\u8003\uff0c\u6ce8\u610f\u6bcf\u79cd\u60c5\u51b5 $lpos$ \u7684\u4f4d\u7f6e\u3002\u5408\u5e76\u6700\u53f3\u533a\u95f4\u540c\u7406\u3002\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u662f\u533a\u95f4\u4fee\u6539\u64cd\u4f5c\u4e86\u3002\u6211\u4eec\u53d1\u73b0\u76f4\u63a5\u4fee\u6539\u4e0d\u597d\u5728\u8f83\u4f18\u590d\u6742\u5ea6\u5185\u91cd\u65b0\u7ef4\u62a4\u90a3\u56db\u4e2a\u4fe1\u606f\u3002\u4f46\u662f\u5728\u4e0d\u4fee\u6539\u5176\u5b50\u533a\u95f4\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u533a\u95f4\u5c31\u53ea\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5\uff08\u6b63\u7740\u548c\u53cd\u7740\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728\u7ef4\u62a4\u6b63\u7740\u7684\u56db\u4e2a\u4fe1\u606f\u65f6\uff0c\u540c\u65f6\u7ef4\u62a4\u5982\u679c\u628a\u8fd9\u4e2a\u533a\u95f4\u53cd\u8fc7\u6765\u7684\u8bdd\u7684\u56db\u4e2a\u4fe1\u606f\u3002\u7ef4\u62a4\u5176\u5b9e\u662f\u540c\u7406\u7684\uff0c\u90fd\u662f\u4ece\u5b50\u533a\u95f4\u5411\u4e0a\u5408\u5e76\u3002\n\n\u90a3\u5982\u679c\u4fee\u6539\u533a\u95f4 $[l,r]$\uff0c\u90a3\u4e48\u5c31\u628a\u8be5\u533a\u95f4\u7684\u6b63\u53cd\u7684\u56db\u4e2a\u6807\u8bb0\u4e92\u6362\u3002\u7136\u540e\u7ed9\u8fd9\u4e2a\u533a\u95f4\u6253\u4e0a\u61d2\u6807\u8bb0\u3002\u56de\u6eaf\u65f6\u518d\u91cd\u65b0\u7ef4\u62a4\u5176\u7956\u5148\u533a\u95f4\u7684\u503c\u3002\n\n\u5bf9\u4e8e\u533a\u95f4\u8be2\u95ee\uff0c\u5176\u5b9e\u548c\u5408\u5e76\u662f\u4e00\u4e2a\u9053\u7406\u7684\u3002\u6211\u76f4\u63a5\u66b4\u529b\u7ef4\u62a4\u4e00\u4e2a\u516b\u5143\u7ec4 $(l,r,llen,lpos,rlen,rpos,ans,len)$\uff0c\u7136\u540e\u5c06\u6bcf\u4e00\u4e2a\u5b50\u533a\u95f4\u5408\u5e76\u3002\u5e94\u8be5\u6709\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\u3002\u6b22\u8fce\u795e\u4ed9 D \u7206\u6211 Orz\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n\nconst int N=500010;\nint n,Q,ql,qr;\nchar ch[N];\n\nstruct Treenode  //\u8be2\u95ee\u65f6\u7684\u516b\u5143\u7ec4\n{\n\tint l,r,lpos,rpos,llen,rlen,ans,len;\n\t\n\tfriend Treenode operator +(Treenode p,Treenode q)  //\u5176\u5b9e\u548c pushup \u662f\u5b8c\u5168\u4e00\u6837\u7684\n\t{\n\t\tTreenode x;\n\t\tint mid=p.r;\n\t\tx.l=p.l; x.r=q.r;\n\t\tif (p.llen==p.len && p.lpos>=mid && q.lpos<=mid)\n\t\t\tx.lpos=mid,x.llen=p.llen+q.llen;\n\t\telse if (p.llen==p.len && p.lpos>=mid && q.lpos>mid)\n\t\t\tx.lpos=q.lpos,x.llen=p.llen+q.llen; \n\t\telse if (p.llen==p.len && p.lpos<mid && q.lpos<=mid)\n\t\t\tx.lpos=p.lpos,x.llen=p.llen+q.llen;\n\t\telse \n\t\t\tx.lpos=p.lpos,x.llen=p.llen;\n\t\t\t\n\t\tif (q.rlen==q.len && p.rpos>=mid && q.rpos<=mid)\n\t\t\tx.rpos=mid,x.rlen=p.rlen+q.rlen;\n\t\telse if (q.rlen==q.len && p.rpos>=mid && q.rpos>mid)\n\t\t\tx.rpos=q.rpos,x.rlen=p.rlen+q.rlen;\n\t\telse if (q.rlen==q.len && p.rpos<mid && q.rpos<=mid)\n\t\t\tx.rpos=p.rpos,x.rlen=p.rlen+q.rlen;\n\t\telse\n\t\t\tx.rpos=q.rpos,x.rlen=q.rlen;\n\t\t\t\n\t\tx.ans=max(p.ans,q.ans);\n\t\tif (p.rpos>=mid || q.lpos<=mid) x.ans=max(x.ans,p.rlen+q.llen);\n\t\treturn x;\n\t}\n};\n\nstruct SegTree\n{\n\tint l[N*4],r[N*4],lpos[2][N*4],rpos[2][N*4],llen[2][N*4],rlen[2][N*4],ans[2][N*4],len[N*4],lazy[N*4];\n\t\n\tvoid rev(int x)  //\u533a\u95f4\u7ffb\u8f6c\uff0c\u76f4\u63a5\u5c06\u6b63\u53cd\u4e24\u79cd\u60c5\u51b5\u7684\u503c\u4ea4\u6362\n\t{\n\t\tlazy[x]^=1;\n\t\tswap(llen[0][x],llen[1][x]); swap(lpos[0][x],lpos[1][x]);\n\t\tswap(rlen[0][x],rlen[1][x]); swap(rpos[0][x],rpos[1][x]);\n\t\tswap(ans[0][x],ans[1][x]);\n\t}\n\t\n\tvoid pushup(int x)  //\u5408\u5e76\n\t{\n\t\tint mid=(l[x]+r[x])>>1;\n\t\tfor (int id=0;id<=1;id++)  //\u4e24\u79cd\u60c5\u51b5\u90fd\u8981\u5408\u5e76\n\t\t{\n        //\u6bcf\u4e00\u7ec4\u6709\u56db\u4e2a if \u5206\u522b\u5bf9\u5e94\u4e0a\u8ff0\u56db\u79cd\u60c5\u51b5\n        //\u8bf7\u6ce8\u610f\u5f53\u5de6\u5b50\u533a\u95f4\u7684 llen \u7b49\u4e8e\u5176\u957f\u5ea6\u65f6\uff0c\u53f3\u5b50\u533a\u95f4\u7684 llen \u4e5f\u53ef\u80fd\u4f1a\u4ea7\u751f\u8d21\u732e\n\t\t\tif (llen[id][x*2]==len[x*2] && lpos[id][x*2]>=mid && lpos[id][x*2+1]<=mid)\n\t\t\t\tlpos[id][x]=mid,llen[id][x]=llen[id][x*2]+llen[id][x*2+1];\n\t\t\telse if (llen[id][x*2]==len[x*2] && lpos[id][x*2]>=mid && lpos[id][x*2+1]>mid)\n\t\t\t\tlpos[id][x]=lpos[id][x*2+1],llen[id][x]=llen[id][x*2]+llen[id][x*2+1]; \n\t\t\telse if (llen[id][x*2]==len[x*2] && lpos[id][x*2]<mid && lpos[id][x*2+1]<=mid)\n\t\t\t\tlpos[id][x]=lpos[id][x*2],llen[id][x]=llen[id][x*2]+llen[id][x*2+1];\n\t\t\telse\n\t\t\t\tlpos[id][x]=lpos[id][x*2],llen[id][x]=llen[id][x*2];\n\t\t\t\t\n\t\t\tif (rlen[id][x*2+1]==len[x*2+1] && rpos[id][x*2]>=mid && rpos[id][x*2+1]<=mid)\n\t\t\t\trpos[id][x]=mid,rlen[id][x]=rlen[id][x*2]+rlen[id][x*2+1];\n\t\t\telse if (rlen[id][x*2+1]==len[x*2+1] && rpos[id][x*2]>=mid && rpos[id][x*2+1]>mid)\n\t\t\t\trpos[id][x]=rpos[id][x*2+1],rlen[id][x]=rlen[id][x*2]+rlen[id][x*2+1];\n\t\t\telse if (rlen[id][x*2+1]==len[x*2+1] && rpos[id][x*2]<mid && rpos[id][x*2+1]<=mid)\n\t\t\t\trpos[id][x]=rpos[id][x*2],rlen[id][x]=rlen[id][x*2]+rlen[id][x*2+1];\n\t\t\telse\n\t\t\t\trpos[id][x]=rpos[id][x*2+1],rlen[id][x]=rlen[id][x*2+1];\n\t\t\n\t\t\tans[id][x]=max(ans[id][x*2],ans[id][x*2+1]);\n\t\t\tif (rpos[id][x*2]>=mid) ans[id][x]=max(ans[id][x],rlen[id][x*2]+llen[id][x*2+1]);\n\t\t\tif (lpos[id][x*2+1]<=mid) ans[id][x]=max(ans[id][x],rlen[id][x*2]+llen[id][x*2+1]);\n        //\u540e\u9762\u4e24\u4e2a if \u662f\u8ba1\u7b97\u5de6\u5b50\u6811\u7684\u6700\u53f3\u4e00\u4e2a\u5757\u548c\u53f3\u5b50\u6811\u7684\u6700\u5de6\u4e00\u4e2a\u5757\u5408\u5e76\u4ea7\u751f\u7684\u8d21\u732e\n\t\t}\n\t}\n\t\n\tvoid pushdown(int x)\n\t{\n\t\tif (lazy[x])\n\t\t{\n\t\t\tlazy[x]=0;\n\t\t\trev(x*2); rev(x*2+1);\n\t\t}\n\t}\n\t\n\tvoid build(int x,int ql,int qr)\n\t{\n\t\tl[x]=ql; r[x]=qr; len[x]=qr-ql+1;\n\t\tif (ql==qr)\n\t\t{\n\t\t\tans[0][x]=llen[0][x]=rlen[0][x]=ans[1][x]=llen[1][x]=rlen[1][x]=1;\n\t\t\tif (ch[ql]=='<') lpos[0][x]=rpos[0][x]=ql-1,lpos[1][x]=rpos[1][x]=qr;\n\t\t\tif (ch[ql]=='>') lpos[0][x]=rpos[0][x]=qr,lpos[1][x]=rpos[1][x]=ql-1;\n\t\t\treturn;\n\t\t}\n\t\tint mid=(ql+qr)>>1;\n\t\tbuild(x*2,ql,mid); build(x*2+1,mid+1,qr);\n\t\tpushup(x);\n\t}\n\t\t\n\tvoid update(int x,int ql,int qr)\n\t{\n\t\tif (l[x]==ql && r[x]==qr)\n\t\t{\n\t\t\trev(x);\n\t\t\treturn;\n\t\t}\n\t\tpushdown(x);\n\t\tint mid=(l[x]+r[x])>>1;\n\t\tif (qr<=mid) update(x*2,ql,qr);\n\t\telse if (ql>mid) update(x*2+1,ql,qr);\n\t\telse update(x*2,ql,mid),update(x*2+1,mid+1,qr);\n\t\tpushup(x);\n\t}\n\t\n\tTreenode query(int x,int ql,int qr)\n\t{\n\t\tif (l[x]==ql && r[x]==qr)\n\t\t\treturn (Treenode){l[x],r[x],lpos[0][x],rpos[0][x],llen[0][x],rlen[0][x],ans[0][x],len[x]};\n\t\tpushdown(x);\n\t\tint mid=(l[x]+r[x])>>1;\n\t\tif (qr<=mid) return query(x*2,ql,qr);\n\t\tif (ql>mid) return query(x*2+1,ql,qr);\n\t\treturn query(x*2,ql,mid)+query(x*2+1,mid+1,qr);\n\t}\n}seg;\n\nint main()\n{\n\tscanf(\"%d%d\",&n,&Q);\n\tscanf(\"%s\",ch+1);\n\tseg.build(1,1,n);\n\twhile (Q--)\n\t{\n\t\tscanf(\"%d%d\",&ql,&qr);\n\t\tseg.update(1,ql,qr);\n\t\tprintf(\"%d\\n\",seg.query(1,ql,qr).ans);\n\t}\n\treturn 0;\n} \n```",
        "postTime": 1593826397,
        "uid": 53962,
        "name": "stoorz",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1371F \u3010Raging Thunder\u3011"
    }
]