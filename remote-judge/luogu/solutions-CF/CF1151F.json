[
    {
        "content": "## \u9898\u610f\n\n\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684 $01$ \u4e32\uff0c\u5bf9\u5176\u8fdb\u884c $k$ \u6b64\u5982\u4e0b\u64cd\u4f5c\uff1a\u9009\u62e9\u4e24\u4e2a\u4f4d\u7f6e $i,j(1\\le i<j\\le n)$\uff0c\u4ea4\u6362\u4e24\u4e2a\u4f4d\u7f6e\u7684\u6570\u3002\u95ee\u64cd\u4f5c\u540e\u8be5\u4e32\u53d8\u6210\u975e\u964d\u5e8f $01$ \u4e32\u7684\u6982\u7387\uff0c\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\u6570\u636e\u8303\u56f4 $2\\le n\\le 100,1\\le k\\le 10^9$\u3002\n\n## \u601d\u8def\n\n\u8981\u8ba9\u8fd9\u4e2a\u4e32\u53d8\u6210\u975e\u9012\u51cf\uff0c\u5373\u8981\u8ba9\u4e32\u4e2d\u7684\u6240\u6709 $0$ \u5728\u524d\uff0c\u6240\u6709 $1$ \u5728\u540e\u3002\u6211\u4eec\u5047\u8bbe $0$ \u7684\u6570\u91cf\u4e3a $m$\uff0c\u5373\u6700\u7ec8 $a_1,a_2,\\dots,a_m$ \u5747\u4e3a $0$\uff0c$a_{m+1},a_{m+2},\\dots,a_n$ \u5747\u4e3a $1$\u3002\n\n\u4ee4 $dp_{i,j}$ \u8868\u793a\u7ecf\u8fc7 $i$ \u6b21\u968f\u673a\u64cd\u4f5c\u540e\uff0c\u524d $m$ \u4e2a\u6570\u4e2d\u6070\u597d\u6709 $j$ \u4e2a $0$ \u7684\u65b9\u6848\u6570\u3002\u521d\u59cb\u5316 $dp_{0,x}=1$\uff0c\u5176\u4e2d $x$ \u662f\u539f\u5e8f\u5217\u4e2d\u524d $m$ \u4e2a\u6570\u91cc $0$ \u7684\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e $dp_{i,j}$\uff1a\n- \u6709 $(m-j)^2$ \u7684\u90e8\u5206\u8f6c\u79fb\u5230\u4e86 $dp_{i+1,j+1}$\u3002\n\n  \u56e0\u4e3a $1$ \u5230 $m$ \u4e2d\u7684 $1$ \u6709 $m-j$ \u4e2a\uff0c$m+1$ \u5230 $n$ \u4e2d\u7684 $0$ \u6709 $m-j$ \u4e2a\u3002\n\n- \u6709 $j\\times (n-2\\times m+j)$ \u7684\u90e8\u5206\u8f6c\u79fb\u5230\u4e86 $dp_{i+1,j-1}$\u3002\n\n  \u56e0\u4e3a $1$ \u5230 $m$ \u4e2d\u7684 $0$ \u6709 $j$ \u4e2a\uff0c$m+1$ \u5230 $n$ \u4e2d\u7684 $1$ \u6709 $n-2\\times m+j$ \u4e2a\u3002\n\n- \u5176\u4f59\u90e8\u5206\u5168\u90e8\u8f6c\u79fb\u5230\u4e86 $dp_{i+1,j}$\u3002\n\n\u7136\u800c $k$ \u6709 $10^9$\uff0c\u6240\u4ee5\u80af\u5b9a\u662f\u4e0d\u80fd\u76f4\u63a5\u8f6c\u79fb\u7684\u3002\u4f46\u53ef\u4ee5\u5c06\u8f6c\u79fb\u5199\u6210\u77e9\u9635\u7684\u5f62\u5f0f\uff1a\n\n$$\n\\begin{bmatrix}\nC_0&B_1&0&0&\\dots&0\\\\\nA_0&C_1&B_2&0&\\dots&0\\\\\n0&A_1&C_2&B_3&\\dots&0\\\\\n0&0&A_2&C_3&\\dots&0\\\\\n0&0&0&A_3&\\dots&0\\\\\n\\dots&\\dots&\\dots&\\dots&\\dots&\\dots\\\\\n0&0&0&0&\\dots&C_m\n\\end{bmatrix}\n\\times\n\\begin{bmatrix}\ndp_{i,0}\\\\\ndp_{i,1}\\\\\ndp_{i,2}\\\\\ndp_{i,3}\\\\\ndp_{i,4}\\\\\n\\dots\\\\\ndp_{i,m}\n\\end{bmatrix}\n\n=\n\\begin{bmatrix}\ndp_{i+1,0}\\\\\ndp_{i+1,1}\\\\\ndp_{i+1,2}\\\\\ndp_{i+1,3}\\\\\ndp_{i+1,4}\\\\\n\\dots\\\\\ndp_{i+1,m}\n\\end{bmatrix}\n$$\n\n\u5176\u4e2d $A_i=(m-i)^2,B_i=i\\times (n-2\\times m+i),C_i=\\frac{n\\times (n-1)}{2}-(m-i)^2-i\\times (n-2\\times m+i)$\u3002\u5404\u5f0f\u5b50\u7684\u7406\u7531\u5747\u5df2\u89e3\u91ca\u3002\n\n\u800c\u4e14\u4ee5\u4e0a $A,B,C$ \u4e09\u4e2a\u51fd\u6570\u7684\u5b9a\u4e49\u57df\u5747\u4e3a $[0,n]$\uff0c\u53ef\u4ee5\u76f4\u63a5\u9884\u5904\u7406\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u77e9\u9635\u5feb\u901f\u5e42\u6a21\u677f\u4e86\u3002\n\n\u590d\u6742\u5ea6\uff1a\u77e9\u9635\u5927\u5c0f $m\\times m$\uff0c\u77e9\u9635\u4e58\u6cd5\u590d\u6742\u5ea6 $m^3$\uff0c\u5feb\u901f\u5e42 $\\log k$\uff0c\u6700\u7ec8\u590d\u6742\u5ea6 $O(m^3\\times \\log k)$\u3002\n\n## \u4ee3\u7801\n\n**Talk is cheap, show me the code.**\n\n[Codeforces Status](https://codeforces.com/contest/1151/submission/145208714)\n\n```cpp\n#define int long long\nint a[110],n,k,m=0;\nint A[110],B[110],C[110];//A,B,C\u51fd\u6570\nstruct matrix{\n\tint a[110][110];\n\tvoid init(){memset(a,0,sizeof(a));}//\u6e05\u7a7a\u77e9\u9635\n\tmatrix mul(matrix x){\n\t\tmatrix res;res.init();\n\t\tFor(i,0,m) For(j,0,m) For(k,0,m) (res.a[i][j]+=a[i][k]*x.a[k][j]%mod)%=mod;\n\t\treturn res;\n\t}//\u77e9\u9635\u4e58\u6cd5\n}base,E;\nvoid qpow(int k){\n\twhile(k){\n\t\tif(k%2==1) base=base.mul(E);\n\t\tk/=2;\n\t\tE=E.mul(E);\n\t}\n}//\u77e9\u9635\u5feb\u901f\u5e42\nsigned main(){\n\tread(n,k);\n\tFor(i,1,n) read(a[i]);\n\tFor(i,1,n) if(a[i]==0) m++;\n\tFor(i,0,m){\n\t\tA[i]=(m-i)*(m-i);ckmax(A[i],0ll);A[i]%=mod;\n\t\tB[i]=i*(n-2*m+i);ckmax(B[i],0ll);B[i]%=mod;\n\t\tC[i]=n*(n-1)/2-A[i]-B[i];ckmax(C[i],0ll);C[i]%=mod;\n\t}//\u9884\u5904\u7406A,B,C\n\tbase.init();\n\tFor(i,0,m) base.a[i][i]=1;\n\tE.init();\n\tE.a[0][0]=C[0],E.a[0][1]=B[1];\n\tFor(i,1,m-1) E.a[i][i-1]=A[i-1],E.a[i][i]=C[i],E.a[i][i+1]=B[i+1];\n\tE.a[m][m-1]=A[m-1],E.a[m][m]=C[m];//\u5904\u7406\u7528\u4e8e\u5feb\u901f\u5e42\u7684\u77e9\u9635\n\tqpow(k);\n\tint sum=0,t=0;\n\tFor(i,1,m) if(a[i]==0) t++;\n\tFor(i,0,m) (sum+=base.a[i][t])%=mod;//\u7edf\u8ba1\u5408\u6cd5\u7684\u65b9\u6848\u6570\n\twrite(base.a[m][t]*minv(sum)%mod);\n}\n```",
        "postTime": 1644050820,
        "uid": 169574,
        "name": "Enucai",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1151F \u3010Sonya and Informatics\u3011"
    },
    {
        "content": " \u7ed9\u4e00\u4e2a\u957f\u5ea6\u4e3a $n (n\\leq 100)$ \u7684 $0/1$ \u4e32\uff0c\u8fdb\u884c $k (k \\leq 10^9)$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u9009\u62e9\u4e24\u4e2a\u4f4d\u7f6e $i,j (1 \\leq i < j \\leq n)$\uff0c\u4ea4\u6362 $i,j$ \u4e0a\u7684\u6570\uff0c\u6c42 $k$ \u6b21\u64cd\u4f5c\u540e\uff0c\u8be5 $0/1$ \u4e32\u53d8\u6210\u975e\u964d\u5e8f\u5217\u7684\u6982\u7387\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n### sol\n\n\u597d\u9898\uff0c\u6982\u7387 `dp`\u3002\n\n\u8bbe\u6709 $m$ \u4e2a $0$\uff0c\u90a3\u4e48\u9898\u610f\u5c31\u662f\u8ba9 $a[1,m]$ \u5747\u4e3a $0$\uff0c$a[m+1,n]$ \u5747\u4e3a $1$\u3002\n\n\u4ee4 $f_{i,j}$ \u8868\u793a $i$ \u4e2a\u64cd\u4f5c\u540e\uff0c\u524d $m$ \u4e2a\u6570\u4e2d\u6709 $j$ \u4e2a $0$ \u7684\u65b9\u6848\u6570\uff0c\u7b54\u6848\u5373\u4e3a $\\frac{f_{k,m}}{\\sum\\limits_{i=0}^{m}f_{k,i}}$\uff0c\u8fb9\u754c\uff1a$f_{0,p}=1$\uff0c$p$ \u4e3a\u539f\u5e8f\u5217\u524d $m$ \u4e2a\u6570\u4e2d $0$ \u7684\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e $f_{i,j}$\uff0c\u8003\u8651\u5b83\u662f\u5982\u4f55\u8f6c\u79fb\u6765\u7684\uff1a\n\n* \u4e4b\u524d\u6709 $j-1$ \u4e2a $0$\uff0c\u7b2c $i$ \u6b21\u4ea4\u6362\u6362\u6765\u4e00\u4e2a $0$\uff0c\u7531\u4e8e\u524d\u9762 $1$ \u7684\u4e2a\u6570\u4e0e\u540e\u9762 $0$ \u7684\u4e2a\u6570\u5747\u4e3a $m-j+1$\uff0c\u987e\u65b9\u6848\u6570\u4e3a $f_{i-1,j-1}\\times (m-j+1)^2$\u3002\n* \u4e4b\u524d\u6709 $j + 1$ \u4e2a $0$\uff0c\u7b2c $i$ \u6b21\u4ea4\u6362\u6362\u8d70\u4e00\u4e2a $0$\uff0c\u7531\u4e8e\u524d\u9762\u6709 $j+1$ \u4e2a $0$\uff0c\u540e\u9762\u6709 $n-m-(m-j-1)=n-2m+j+1$ \u4e2a $1$\uff0c\u987e\u65b9\u6848\u6570\u4e3a $f_{i-1,j+1}\\times (j+1)(n-2m+j+1)$\u3002\n* \u4e4b\u524d\u672c\u6765\u5c31\u6709 $j$ \u4e2a $0$\uff0c\u7b2c $i$ \u6b21\u64cd\u4f5c\u6ca1\u6362\u8d70\u4e5f\u6ca1\u6362\u6765\uff0c\u56db\u79cd\u60c5\u51b5\uff1a\u524d\u9762\u4ea4\u6362\uff0c\u540e\u9762\u4ea4\u6362\uff0c\u524d\u540e\u4ea4\u6362 $0$\uff0c\u524d\u540e\u4ea4\u6362 $1$\uff0c\u5219\u65b9\u6848\u6570\u4e3a $C_{m}^{2}+C_{n-m}^{2}+j(m-j)+(m-j)(n-2m+j)$\u3002\n\n\u5230\u8fd9\u91cc\u5dee\u70b9\u7ed3\u675f\u4e86\uff0c\u603b\u7ed3\uff1a$f_{i,j}=f_{i-1,j-1}\\times (m-j+1)^2+f_{i-1,j+1}\\times (j+1)(n-2m+j+1)+C_{m}^{2}+C_{n-m}^{2}+j(m-j)+(m-j)(n-2m+j)$\u3002\n\n\u8003\u8651\u5230 $k\\leq 10^9$\uff0c\u7ecf\u9a8c\u544a\u8bc9\u6211\u4eec\u76f4\u63a5\u4e0a\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u6bd5\u7adf\u8fd9\u8f6c\u79fb\u65e0\u9700\u5224\u65ad\u3002\n$$\n\\begin{bmatrix}c_0& b_1& 0 & 0&\\cdots & 0\\\\\na_0 & c_1 & b_2 & 0&\\cdots & 0\\\\\n0 & a_1 & c_2 & b_3 & \\cdots & 0\\\\\n0&0&a_2&c_3&\\cdots&0\\\\\n0&0&0&a_3&\\cdots&0\\\\\n\\cdots&\\cdots&\\cdots&\\cdots&\\cdots&\\cdots\\\\\n0&0&0&0&\\cdots&c_m\\end{bmatrix} \\times \\begin{bmatrix}f_{i-1,0}\\\\f_{i-1,1}\\\\f_{i-1,2}\\\\f_{i-1,3}\\\\f_{i-1,4}\\\\ \\cdots \\\\f_{i-1,m}\\end{bmatrix}=\\begin{bmatrix}f_{i,0}\\\\f_{i,1}\\\\f_{i,2}\\\\f_{i,3}\\\\f_{i,4}\\\\ \\cdots \\\\f_{i,m}\\end{bmatrix}\n$$\n\u5176\u4e2d $a_i=(m-i)^2$\uff0c$b_i=i(n-2m+i)$\uff0c$c_i=C_{m}^{2}+C_{n-m}^{2}+i(m-i)+(m-i)(n-2m+i)$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^3\\log k)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define int long long\n\ninline int read() {\n\tint x = 0, f = 1;\n\tchar c = getchar();\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9') {\n\t\tx = (x << 3) + (x << 1) + (c ^ 48);\n\t\tc = getchar();\n\t}\n\treturn x * f;\n}\n\nconst int _ = 107, p = 1e9 + 7;\n\nint n, k, m, t, Ans, A[_], a[_], b[_], c[_];\n\nstruct matrix {\n\tint a[_][_];\n\tvoid init() {\n\t\tmemset(a, 0, sizeof a);\n\t}\n\tmatrix mul(matrix x) {\n\t\tmatrix res;\n\t\tres.init();\n\t\tfor (int i = 0; i <= m; ++i)\n\t\t\tfor (int j = 0; j <= m; ++j)\n\t\t\t\tfor (int k = 0; k <= m; ++k)\n\t\t\t\t\tres.a[i][j] = (res.a[i][j] + a[i][k] * x.a[k][j] % p) % p;\n\t\treturn res;\n\t}\n} ans, base;\n\nvoid Qpow(int k) {\n\twhile (k) {\n\t\tif (k & 1)\n\t\t\tans = ans.mul(base);\n\t\tk >>= 1, base = base.mul(base);\n\t}\n}\n\ninline int qpow(int x, int y) {\n\tint res = 1;\n\twhile (y) {\n\t\tif (y & 1)\n\t\t\tres = res * x % p;\n\t\ty >>= 1, x = x * x % p;\n\t}\n\treturn res;\n}\n\nsigned main() {\n\tn = read(), k = read();\n\tfor (int i = 1; i <= n; ++i) A[i] = read();\n\tfor (int i = 1; i <= n; ++i) m += (A[i] == 0);\n\tfor (int i = 1; i <= m; ++i) t += (A[i] == 0);\n\tfor (int i = 0; i <= m; ++i) {\n\t\ta[i] = (m - i) * (m - i) % p;\n\t\tb[i] = i * (n - 2 * m + i) % p;\n\t\tc[i] = (m * (m - 1) * qpow(2, p - 2) % p + (n - m) * (n - m - 1) * qpow(2, p - 2) % p + (m - i) * (n - 2 * m + 2 * i) % p) % p;\n\t}\n\tans.init();\n\tfor (int i = 0; i <= m; ++i) ans.a[i][i] = 1;\n\tbase.init();\n\tbase.a[0][0] = c[0], base.a[0][1] = b[1];\n\tbase.a[m][m - 1] = a[m - 1], base.a[m][m] = c[m];\n\tfor (int i = 1; i <= m - 1; ++i) {\n\t\tbase.a[i][i - 1] = a[i - 1];\n\t\tbase.a[i][i] = c[i];\n\t\tbase.a[i][i + 1] = b[i + 1];\n\t}\n\tQpow(k);\n\tbase.init();\n\tbase.a[t][0] = 1;\n\tans = ans.mul(base);\n\tfor (int i = 0; i <= m; ++i)\n\t\tAns = (Ans + ans.a[i][0]) % p;\n\tprintf(\"%lld\", ans.a[m][0] * qpow(Ans, p - 2) % p);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1651547903,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "CF1151F Sonya and Informatics"
    },
    {
        "content": "\n\u975e\u964d\u5e8f\u5217\u5c31\u662f\u8ba9 $0$ \u90fd\u5728\u524d\u9762\uff0c$1$ \u90fd\u5728\u540e\u9762\u3002\u8bbe $0$ \u7684\u6570\u91cf\u4e3a $m$\u3002\n\n\u8003\u8651\u8bbe $F(i,j)$ \u4e3a\u524d $i$ \u6b21\u4ea4\u6362\u540e\uff0c\u524d $m$ \u4e2a\u6570\u4e2d\u6709 $j$ \u4e2a $0$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u8fd9 $j$ \u4e2a $0$ \u662f\u600e\u4e48\u6765\u7684\uff1a\n\n- \u6709\u53ef\u80fd\u4e4b\u524d\u53ea\u6709 $j-1$ \u4e2a $0$\uff0c\u7b2c $i$ \u6b21\u4ea4\u6362\u5c06\u540e\u9762\u7684\u4e00\u4e2a $0$ \u548c\u524d\u9762\u7684\u4e00\u4e2a $1$ \u4ea4\u6362\u4e86\u3002\u6ce8\u610f\u5230\u524d\u9762 $1$ \u7684\u4e2a\u6570\u548c\u540e\u9762 $0$ \u7684\u4e2a\u6570\u90fd\u662f $m-j+1$\uff0c\u56e0\u6b64\u65b9\u6848\u6570\u4e3a $F(i-1,j-1)\\cdot (m-j+1)^2$\u3002\n- \u6709\u53ef\u80fd\u672c\u6765\u6709 $j+1$ \u4e2a $0$\uff0c\u7b2c $i$ \u6b21\u6362\u8d70\u4e86\u4e00\u4e2a\u3002\u524d\u9762\u6709 $j+1$ \u4e2a $0$\uff0c\u540e\u9762\u6709 $n-2m-(m-j-1)=n-2m+j+1$ \u4e2a $1$\uff0c\u56e0\u6b64\u65b9\u6848\u6570\u4e3a $F(i-1,j+1)\\cdot(j+1)(n-2m+j+1)$\u3002\n- \u6709\u53ef\u80fd\u672c\u6765\u5c31\u6709 $j$ \u4e2a $0$\uff0c\u7b2c $i$ \u6b21\u4ea4\u6362\u5e76\u6ca1\u6709\u4ec0\u4e48\u7528\u3002\u5206\u56db\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\u4ea4\u6362\u4e86\u4e24\u4e2a\u524d\u9762\u7684\uff0c\u4ea4\u6362\u4e86\u4e24\u4e2a\u540e\u9762\u7684\uff0c\u4ea4\u6362\u4e86\u524d\u540e\u7684\u4e24\u4e2a $1$\uff0c\u4ea4\u6362\u4e86\u524d\u540e\u7684\u4e24\u4e2a $0$\u3002\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u662f $C_m^2+C_{n-m}^2+j(m-j)+(m-j)(n-2m+j)$\n\n\u7136\u800c $k\\le 10^9$\uff0c\u5e76\u4e0d\u80fd\u76f4\u63a5\u8fd9\u4e48\u8f6c\u79fb\u3002\n\n\u89c1\u8fc7\u4e86\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316 dp \u7684\u5957\u8def\u4e4b\u540e\uff0c\u518d\u770b\u5230 $10^9$ \u7684\u8303\u56f4\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u628a\u8fd9\u4e2a\u8f6c\u79fb\u5199\u6210\u77e9\u9635\u3002\n\n$F(i,j)$ \u548c $F(i-1,j-1/j/j+1)$ \u6709\u5173\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5728\u77e9\u9635\u7684\u8fd9\u4e09\u9879\u4e2d\u586b\u4e0a\u5bf9\u5e94\u7684\u7cfb\u6570\uff0c\u5176\u4f59\u90fd\u586b $0$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3\\log k)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n\n#define int long long\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\tfor(;(c<'0'||c>'9');c=getchar()){if(c=='-')f=-1;}\n\tfor(;(c>='0'&&c<='9');c=getchar())x=x*10+(c&15);\n\treturn x*f;\n}\n\nconst int MN=105;\nconst int mod=1e9+7;\nint n,m,k;\nint p[MN];\n\nstruct Mat{\n\tint a[MN][MN];\n\n\tMat(){\n\t\tmemset(a,0,sizeof(a));\n\t}\n\n\tinline Mat operator*(const Mat &rhs)const{\n\t\tMat res;\n\t\tfor(int i=0;i<=m;i++){\n\t\t\tfor(int j=0;j<=m;j++){\n\t\t\t\tfor(int k=0;k<=m;k++)res.a[i][j]=(res.a[i][j]+a[i][k]*rhs.a[k][j]%mod)%mod;\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n}f,z;\n\nint ksm(int x,int y,int p=mod){\n\tint res=1;\n\tfor(int i=y;i;i>>=1,x=x*x%p)if(i&1)res=res*x%p;\n\treturn res;\n}\n\nint inv(int x,int p=mod){return ksm(x,p-2,p)%p;}\n\nsigned main(void){\n\n\tn=read(),k=read();int cnt=0;\n\tfor(int i=1;i<=n;i++)p[i]=read(),m+=(p[i]==0);\n\tfor(int i=1;i<=m;i++)cnt+=(p[i]==0);\n\tf.a[cnt][0]=1;\n\n\tfor(int i=0;i<=m;i++){\n\t\tif(i-1>=0)z.a[i][i-1]=(m-i+1)*(m-i+1)%mod;\n\t\tif(i+1<=m)z.a[i][i+1]=(i+1)*(n-2*m+i+1+mod)%mod;\n\t\tz.a[i][i]=max(0ll,n*(n-1)%mod*inv(2)%mod-(m-i)*(m-i)%mod-i*(n-2*m+i+mod)%mod+mod)%mod;\n\t}\n\n\tfor(int i=k;i;i>>=1,z=z*z)if(i&1)f=z*f;\n\tcout<<f.a[m][0]*inv(ksm(n*(n-1)%mod*inv(2)%mod,k))%mod<<endl;\n\n\treturn 0;\n}\n```",
        "postTime": 1644670095,
        "uid": 307453,
        "name": "\u4e91\u6d45\u77e5\u5904",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF1151F Sonya and Informatics"
    },
    {
        "content": "\u6211\u4eec\u79f0$a_1-a_m$\u8fd9\u4e00\u533a\u95f4\u4e3a\u524d\u534a\u533a\uff0c$a_{m+1}-a_{n}$\u4e3a\u540e\u534a\u533a\u3002\n\n$DP_i[x]$\u4ee3\u8868\u968f\u673a\u4ea4\u6362i\u6b21\u540e\uff0c\u6570\u5217\u4e2d\u524d\u534a\u533a\u4e2d\u6709$x$\u4e2a$0$\u7684\u65b9\u6848\u6570\u3002\n\n\u521d\u59cb$DP_0[t]=1$\uff0c\u5176\u4f59\u4e3a$0$\u3002$t$\u662f\u521d\u59cb\u72b6\u6001\u524d\u534a\u533a\u7684$0$\u4e2a\u6570\u3002\n\n\u8f6c\u79fb\uff1a\n\n\n\u5bf9$DP_i[x]$\u72b6\u6001\uff0c\u6b64\u65f6\u524d$m$\u4e2a\u6570\u4e2d\u6709$x$\u4e2a$0$\u548c$(m-x)$\u4e2a$1$\uff0c\u540e$(n-m)$\u4e2a\u6570\u4e2d\u6709$(m-x)$\u4e2a$0$\u548c$(n-2m+x)$\u4e2a$1$\n\n\n\u4ece$n$\u4e2a\u6570\u4e2d\u4efb\u9009\u4e24\u4e2a\u8fdb\u884c\u4ea4\u6362\uff0c\u90a3\u4e48\n\n\u6709$f_{+1}[x]=C_{m-x}^1*C_{m-x}^1=(m-x)^2$\u79cd\u65b9\u6848\uff0c\u9009\u5230\u4e86\u524d\u534a\u533a\u7684$1$\u548c\u540e\u534a\u533a\u7684$0$\uff0c$x$\u53d8\u6210\u4e86$x+1$\u3002\n\n\n\u540c\u65f6\uff0c\u6709$f_{-1}[x]=C_x^1*C_{n-2m+x}^1=x*(n-2m+x)$\u79cd\u65b9\u6848\uff0c\u9009\u5230\u4e86\u524d\u534a\u533a\u7684$0$\u548c\u540e\u534a\u533a\u7684$1$\uff0c$x$\u53d8\u6210\u4e86$x-1$\u3002\n\n\u5bf9\u4e8e\u5176\u4ed6$f_{0}[x]=C_n^2-(m-x)^2-x*(n-2m+x)$\u79cd\u60c5\u51b5\uff0c\u4e0d\u4f1a\u6539\u53d8$dp$\u7684\u72b6\u6001\u3002\n\n\u5199\u6210\u77e9\u9635\u5f62\u5f0f\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff08$latex$\u77e9\u9635\u70b8\u6389\u4e86\uff0c\u6362\u6210\u77e9\u9635\u518d\u4e0a\u4f20\u4e00\u6ce2\uff09\n\n\n![](https://cdn.luogu.com.cn/upload/pic/57624.png)\n$$M \\times DP_i=DP_{i+1} (0<=i<n)$$\n\n\u6700\u7ec8\u7ed3\u679c$ans=DP_k[m]/\\sum_{i=0}^n DP_k[i]=M^k[m][t]/\\sum_{i=0}^{m}m^k[i][t]$\n\n$k$\u5f88\u5927\uff0c\u6240\u4ee5\u8981\u7528\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u590d\u6742\u5ea6$\\mathcal{O}(n^3logk)$\n\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\n#define INL inline\n#define REG register\n#define DB double\n#define LDB long double\n#define ULL unsigned long long\n#define LL long long\n\n#define RPT(i,x,y) for (REG int i=x;i<y;i++)\n#define DRPT(i,x,y) for (REG int i=x;i>y;i--)\n#define MST(a,b) memset(a,b,sizeof(a))\n#define MRK() cout<<\"Mark\"<<endl;\n#define WRT(x) cout<<#x<<\" = \"<<x<<endl;\n\n#define MAXN 10000\n#define MAXM 10000\n#define MOD 1000000007\n#define INF 0x3f3f3f3f\n#define LLINF 0x3f3f3f3f3f3f3f3f\n#define EPS 1e-5\n\n#define _ 0\nusing namespace std;\n\n//\u81ea\u5df1\u778e\u5199\u7684\u77e9\u9635\u677f\u5b50\nstruct MATRIX\n{\n\tLL row,col;\n\tLL data[101][101];\n\t\n\tMATRIX(int n,int m)\n\t{\n\t\trow=n;\n\t\tcol=m;\n\t\tRPT(i,0,n)\n\t\t\tRPT(j,0,n)\n\t\t\t\tdata[i][j]=0;\n\t}\n\t\n\tMATRIX(const MATRIX &m)\n\t{\n\t\t*this=m; \n\t}\n\t\n\t~MATRIX()\n\t{\n\t}\n\t\n\tvoid input()\n\t{\n\t\tRPT(i,0,row)\n\t\t\tRPT(j,0,col)\n\t\t\t\tscanf(\"%d\",&data[i][j]);\n\t}\n\t\n\tvoid output()\n\t{\n\t\tif (!islegal())\n\t\t{\n\t\t\tcout<<\"illegal matrix!\"<<endl;\n\t\t\treturn;\n\t\t}\n\t\tRPT(i,0,row)\n\t\t{\n\t\t\tRPT(j,0,col)\n\t\t\t\tprintf(\"%d \",data[i][j]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\t}\n\t\n\tbool islegal()\n\t{\n\t\tif (col<=0 || row<=0)\n\t\t\treturn false;\n\t\treturn true;\n\t}\n\t\n\tMATRIX operator - ()\n\t{\n\t\tif (!this->islegal())\n\t\t{\n\t\t\tMATRIX fault(-1,-1);\n\t\t\treturn fault;\n\t\t}\n\t\tMATRIX ans(row,col);\n\t\tRPT(i,0,row)\n\t\t\tRPT(j,0,col)\n\t\t\t\tans.data[i][j]=((-this->data[i][j])%MOD+MOD)%MOD;\n\t\treturn ans;\n\t}\n\t\n\tMATRIX operator + (MATRIX m)\n\t{\n\t\tif (this->col!=m.col || this->row!=m.col || !this->islegal() || !m.islegal())\n\t\t{\n\t\t\tMATRIX fault(-1,-1);\n\t\t\treturn fault;\n\t\t}\n\t\tMATRIX ans(*this);\n\t\tRPT(i,0,row)\n\t\t\tRPT(j,0,col)\n\t\t\t\tans.data[i][j]=(ans.data[i][j]+m.data[i][j])%MOD;\n\t\treturn ans;\n\t}\n\t\n\tMATRIX operator - (MATRIX m)\n\t{\n\t\tif (this->col!=m.col || this->row!=m.col || !this->islegal() || !m.islegal())\n\t\t{\n\t\t\tMATRIX fault(-1,-1);\n\t\t\treturn fault;\n\t\t}\n\t\tMATRIX ans(*this);\n\t\tRPT(i,0,row)\n\t\t\tRPT(j,0,col)\n\t\t\t\tans.data[i][j]=((ans.data[i][j]-m.data[i][j])%MOD+MOD)%MOD;\n\t\treturn ans;\n\t}\n\t\n\t\n\tMATRIX operator * (MATRIX m)\n\t{\n\t\tif (this->col!=m.row || !this->islegal() || !m.islegal())\n\t\t{\n\t\t\tMATRIX fault(-1,-1);\n\t\t\treturn fault;\n\t\t}\n\t\tMATRIX ans(this->row,m.col);\n\t\tRPT(i,0,ans.row)\n\t\t\tRPT(j,0,ans.col)\n\t\t\t\tRPT(k,0,this->col)\n\t\t\t\t\tans.data[i][j]=(ans.data[i][j]+this->data[i][k]*m.data[k][j])%MOD;\n\t\treturn ans;\n\t}\n};\n\nLL n,m,k,t;\n\nLL f1(LL x)\n{\n\treturn (x*(n-2*m+x)%MOD+MOD)%MOD;\n}\n\nLL f3(LL x)\n{\n\treturn ((m-x)*(m-x)%MOD+MOD)%MOD;\n}\n\nLL f2(LL x)\n{\n\treturn ((n*(n-1)/2-f1(x)-f3(x))%MOD+MOD)%MOD;\n}\n\n\nLL fastpow(LL x,LL n)\n{\n\tLL ans=1;\n\twhile (n)\n\t{\n\t\tif (n&1)\n\t\t\tans=ans*x%MOD;\n\t\tx=x*x%MOD;\n\t\tn/=2;\n\t}\n\treturn ans;\n}\n\nint main()\n{\n\tLL x;\n\tLL a[MAXN];\n\tcin>>n>>k;\n\tRPT(i,1,n+1)\n\t{\n\t\tcin>>a[i];\n\t\tif (a[i]==0)\n\t\t\tm++;\n\t}\n\tRPT(i,1,m+1)\n\t\tif (a[i]==0)\n\t\t\tt++;\n\tstatic MATRIX ma(m+1,m+1);\n\tRPT(i,0,m+1)\n\t{\n\t\tif (i!=0)\n\t\t\tma.data[i-1][i]=f1(i);\n\t\tma.data[i][i]=f2(i);\n\t\tif (i!=m)\n\t\t\tma.data[i+1][i]=f3(i);\n\t}\n\tMATRIX ans(m+1,m+1);\n\tRPT(i,0,m+1)\n\t\tans.data[i][i]=1;\n\twhile (k)\n\t{\n\t\tif (k&1)\n\t\t\tans=ans*ma;\n\t\tma=ma*ma;\n\t\tk/=2;\n\t}\n\tLL tem=0;\n\tRPT(i,0,m+1)\n\t\ttem=(tem+ans.data[i][t])%MOD;\n\tcout<<ans.data[m][t]*fastpow(tem,MOD-2)%MOD;\n\treturn ~~(0^_^0);\n}\n\n```\n",
        "postTime": 1556112408,
        "uid": 56267,
        "name": "Rhodoks",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 CF1151F \u3010Sonya and Informatics\u3011"
    },
    {
        "content": "# CF1151F #\n\n\u56e0\u4e3a\u8fd9\u4e2a\u4e32\u91cc\u53ea\u6709 $ 0 $ \u548c $ 1 $\uff0c\u6240\u4ee5\u5fc5\u987b\u8981\u5c06 $ 0 $ \u5168\u90e8\u653e\u524d\u9762\uff0c$ 1 $ \u5168\u90e8\u653e\u540e\u9762\u3002\u5047\u8bbe\u6709 $ m $ \u4e2a $ 0 $\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8bbe $ f_{i,j} $ \u8868\u793a\u73b0\u5728\u5728\u7b2c $ i $ \u6b65\u64cd\u4f5c\uff0c\u6570\u7ec4\u91cc\u5df2\u7ecf\u6709\u4e86 $ j $ \u4e2a $ 0 $ \u5728\u7b2c $ m $ \u4e2a\u4f4d\u7f6e\u53ca\u4e4b\u524d\u7684\u65b9\u6848\u6570\u3002\u6709\u8f6c\u79fb\uff1a\n\n1. $ f_{i,j} \\times (m-j)^2 \\rightarrow f_{i+1,j+1} $\n2. $ f_{i,j} \\times (n-m-m+j) \\times j \\rightarrow f_{i+1,j-1}$\n\n\u5269\u4f59\u60c5\u51b5\u5747\u8f6c\u79fb\u5230 $ f_{i+1,j} $ \u4e2d\u3002\n\n\u7136\u540e\u5c31\u53d1\u73b0 $n$ \u5f88\u5c0f\uff0c$ k $ \u5f88\u5927\uff0c\u5e76\u4e14\u53ef\u4ee5\u77e9\u9635\u4f18\u5316\uff0c\u6784\u9020\u8f6c\u79fb\u77e9\u9635\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int maxn=105,mod=1e9+7;\nint ksm(int b,int p){int ret=1;while(p){if(p&1)ret=1ll*ret*b%mod;b=1ll*b*b%mod;p>>=1;}return ret;}\nint n,m,k;\nstruct matrix\n{\n\tint a[maxn][maxn];\n\tmatrix(int x=0){memset(a,0,sizeof a);for(int i=0;i<=m;i++)a[i][i]=x;}\n}t,f;\nmatrix mul(matrix a,matrix b)\n{\n\tmatrix ret;\n\tfor(int i=0;i<=m;i++)\n\t\tfor(int j=0;j<=m;j++)\n\t\t\tfor(int k=0;k<=m;k++)\n\t\t\t\tret.a[i][j]=(ret.a[i][j]+1ll*a.a[i][k]*b.a[k][j]%mod)%mod;\n\treturn ret;\n}\nint a[maxn],b[maxn],c[maxn],inv,r;\nchar s[maxn];\nint main()\n{\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>s[i];\n\tfor(int i=1;i<=n;i++)\n\t\tif(s[i]=='0')m++;\n\tfor(int i=1;i<=m;i++)\n\t\tif(s[i]=='0')r++;\n\t//printf(\"%d\\n\",m);\n\tinv=n*(n-1)/2;\n\t//printf(\"%d\\n\",inv);\n\tfor(int i=0;i<=m;i++)\n\t\ta[i]=1ll*(m-i)*(m-i),a[i]%=mod;\n\tfor(int i=1;i<=m;i++)\n\t\tb[i]=1ll*i*(n-2*m+i),b[i]%=mod;\n\tfor(int i=0;i<=m;i++)\n\t\tc[i]=1ll*(inv-a[i]-b[i]),c[i]%=mod;\n\tfor(int i=0;i<=m;i++)\n\t{\n\t\tif(i>0)f.a[i-1][i]=a[i-1];\n\t\tif(i<m)f.a[i+1][i]=b[i+1];\n\t\tf.a[i][i]=c[i];\n\t}\n\tmatrix ans(1);\n\twhile(k){if(k&1)ans=mul(ans,f);f=mul(f,f);k>>=1;}\n\tint sum=0;\n\tfor(int i=0;i<=m;i++)\n\t\tsum=(sum+ans.a[r][i])%mod;\n\tsum=1ll*ans.a[r][m]*ksm(sum,mod-2)%mod;\n\tprintf(\"%d\\n\",sum);\n}\n```\n",
        "postTime": 1665664139,
        "uid": 343060,
        "name": "kkio",
        "ccfLevel": 7,
        "title": "CF1551F\u9898\u89e3"
    }
]