[
    {
        "content": "## \u9898\u89e3\n\n\u9898\u76ee\u6c42\u7684\u4e1c\u897f\uff1a\n\n$$\\sum_{i=l}^{r}a_i \\cdot (i-l+1)^k$$\n\n\u4f7f\u7528**\u4e8c\u9879\u5f0f\u5b9a\u7406**\uff0c\u628a\u4e0e $i$ \u6709\u5173\u7684\u90e8\u5206\u548c\u4e0e $l$ \u6709\u5173\u7684\u90e8\u5206\u5206\u79bb\uff0c\u5e76\u4ea4\u6362 $\\sum$ \u987a\u5e8f\uff1a\n\n$$\n\\begin{aligned}\n&\\sum_{i=l}^{r}a_i[\\sum_{j=0}^{k}\\binom{k}{j}(i+1)^j(-l)^{k-l}]\\\\\n=&\\sum_{j=0}^k\\binom{k}{j}(-l)^{k-j}[\\sum_{i=l}^{r}a_i \\cdot (i+1)^j]\n\\end{aligned}\n$$\n\n\u7531\u4e8e $k \\le 5$\uff0c\u53ef\u4ee5\u4f7f\u7528**\u7ebf\u6bb5\u6811**\u5bf9 $0 \\le j \\le 5$ \u6bcf\u4e2a $j$ \u76f4\u63a5\u7ef4\u62a4 $\\sum_{i=l}^{r}a_i \\cdot (i+1)^j$\u3002\n\n\u53ea\u9700\u652f\u6301**\u533a\u95f4\u8d4b\u503c**\u548c**\u533a\u95f4\u67e5\u8be2**\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(mk\\log{n})$\u3002\n\n## \u4ee3\u7801\n\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m;\nconst int max_n=1e5+5;\nint a[max_n],Pow[max_n][6],C[6][6];\nconst int mod=1e9+7;\ninline int get_sum(int a,int b)\n{\n\treturn a+b-(a+b>=mod?mod:0);\n}\nnamespace SegmentTree\n{\n\tstruct Node\n\t{\n\t\tint sum[6],val[6],lazy;\n\t}node[max_n<<2];\n\t#define sum(p,x) node[p].sum[x]\n\t#define val(p,x) node[p].val[x]\n\t#define lazy(p) node[p].lazy\n\t#define ls(p) ((p)<<1)\n\t#define rs(p) ((p)<<1|1)\n\tvoid build(int p,int l,int r)\n\t{\n\t\tlazy(p)=-1;\n\t\tif(l==r)\n\t\t{\n\t\t\tfor(int i=0;i<=5;++i)\n\t\t\t{\n\t\t\t\tsum(p,i)=Pow[l+1][i];\n\t\t\t\tval(p,i)=1ll*sum(p,i)*a[l]%mod;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tbuild(ls(p),l,mid);\n\t\tbuild(rs(p),mid+1,r);\n\t\tfor(int i=0;i<=5;++i)\n\t\t{\n\t\t\tsum(p,i)=get_sum(sum(ls(p),i),sum(rs(p),i));\n\t\t\tval(p,i)=get_sum(val(ls(p),i),val(rs(p),i));\n\t\t}\n\t}\n\tinline void assign(int p,int v)\n\t{\n\t\tfor(int i=0;i<=5;++i)\n\t\t\tval(p,i)=1ll*sum(p,i)*v%mod;\n\t\tlazy(p)=v;\n\t}\n\tinline void push_down(int p)\n\t{\n\t\tassign(ls(p),lazy(p));\n\t\tassign(rs(p),lazy(p));\n\t\tlazy(p)=-1;\n\t}\n\tvoid assign(int p,int l,int r,int a,int b,int v)\n\t{\n\t\tif(a<=l&&r<=b)\n\t\t{\n\t\t\tassign(p,v);\n\t\t\treturn;\n\t\t}\n\t\tif(~lazy(p))\n\t\t\tpush_down(p);\n\t\tint mid=(l+r)>>1;\n\t\tif(a<=mid)\n\t\t\tassign(ls(p),l,mid,a,b,v);\n\t\tif(b>mid)\n\t\t\tassign(rs(p),mid+1,r,a,b,v);\n\t\tfor(int i=0;i<=5;++i)\n\t\t\tval(p,i)=get_sum(val(ls(p),i),val(rs(p),i));\n\t}\n\tint res[6];\n\tvoid query(int p,int l,int r,int a,int b,int k)\n\t{\n\t\tif(a<=l&&r<=b)\n\t\t{\n\t\t\tfor(int i=0;i<=k;++i)\n\t\t\t\tres[i]=get_sum(res[i],val(p,i));\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tif(~lazy(p))\n\t\t\tpush_down(p);\n\t\tif(a<=mid)\n\t\t\tquery(ls(p),l,mid,a,b,k);\n\t\tif(b>mid)\n\t\t\tquery(rs(p),mid+1,r,a,b,k);\n\t}\n\tinline void query(int l,int r,int k)\n\t{\n\t\tfor(int i=0;i<=k;++i)\n\t\t\tres[i]=0;\n\t\tquery(1,1,n,l,r,k);\n\t\tint p=1,ans=0;\n\t\tfor(int i=k;i>=0;--i)\n\t\t{\n\t\t\tans=(ans+1ll*C[k][i]*p%mod*res[i])%mod;\n\t\t\tp=1ll*p*(mod-l)%mod;\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d\",a+i);\n\tfor(int i=2;i<=n+1;++i)\n\t{\n\t\tPow[i][0]=1;\n\t\tfor(int j=1;j<=5;++j)\n\t\t\tPow[i][j]=1ll*Pow[i][j-1]*i%mod;\n\t}\n\tfor(int i=0;i<=5;++i)\t\n\t\tfor(int j=0;j<=i;++j)\n\t\t\tC[i][j]=j==0||j==i?1:C[i-1][j-1]+C[i-1][j];\n\tSegmentTree::build(1,1,n);\n\twhile(m--)\n\t{\n\t\tchar opt[4];\n\t\tint l,r,x;\n\t\tscanf(\"%s%d%d%d\",opt,&l,&r,&x);\n\t\tif(opt[0]=='=')\n\t\t\tSegmentTree::assign(1,1,n,l,r,x);\n\t\telse\n\t\t{\n\t\t\tassert(opt[0]=='?');\n\t\t\tSegmentTree::query(l,r,x);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1629360680,
        "uid": 145355,
        "name": "wsyhb",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF266E More Queries to Array..."
    },
    {
        "content": "$(i - l + 1) = (i + (1 - l))$\n\n$(i + (1 - l))^k = \\sum_{j = 0}^{k} \\binom{j}{k} i^j (1-l)^{k-j}$\n\n\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\u6210\u8fd9\u6837\uff0c\u7136\u540e\u5728\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4 $a_i \\times i^{j}$ \u5c31\u597d\u4e86\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a $k$ \u53ea\u6709 $5$ \u6240\u4ee5\u76f4\u63a5\u641e\u5c31\u597d\u4e86.jpg\u3002\n",
        "postTime": 1606702311,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF266E \u3010More Queries to Array...\u3011"
    },
    {
        "content": "$k$ \u53ea\u6709 $5$\uff0c\u76f4\u63a5\u4e8c\u9879\u5f0f\u5c55\u5f00\u3002\n\n\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u7ef4\u62a4 $\\sum\\limits_{i=1}^{m}a_i\\times i^k$ \u7684\u503c\uff0c\u8fd8\u6709\u533a\u95f4\u8d4b\u503c\uff0c\u90a3\u4e48\u9884\u5904\u7406 $\\sum\\limits_{i=1}^{m}i^k$ \u7684\u503c\uff0c\u5206\u522b\u5f00 $5+1$ \u68f5\u7ebf\u6bb5\u6811+\u61d2\u6807\u8bb0\u7ef4\u62a4\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define mod 1000000007\nusing namespace std;\nchar cc[105];\nint a[100005],d[10][100005],c[105][105];\nlong long sm[6][400005],lz[6][400005];\nint powdv(int x,int y)\n{\n\tint ans=1;\n\twhile(y)\n\t{\n\t\tif(y&1)ans=1ll*ans*x%mod;\n\t\ty>>=1;\n\t\tx=1ll*x*x%mod;\n\t}\n\treturn ans;\n}\nvoid build(int K,int l,int r,int o)\n{\n\tif(l==r)\n\t{\n\t\tsm[K][o]=1ll*a[l]*powdv(l,K)%mod;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tbuild(K,l,mid,o<<1);\n\tbuild(K,mid+1,r,o<<1|1);\n\tsm[K][o]=(sm[K][o<<1]+sm[K][o<<1|1])%mod;\n}\nvoid pushdown(int K,int l,int r,int o)\n{\n\tif(lz[K][o]==-1)return;\n\tint mid=l+r>>1;\n\tsm[K][o<<1]=1ll*lz[K][o]*(d[K][mid]-d[K][l-1])%mod;\n\tsm[K][o<<1|1]=1ll*lz[K][o]*(d[K][r]-d[K][mid])%mod;\n\tlz[K][o<<1]=lz[K][o<<1|1]=lz[K][o],lz[K][o]=-1;\n}\nvoid add(int K,int l,int r,int o,int ll,int rr,int v)\n{\n\tif(l>=ll&&r<=rr)\n\t{\n\t\tlz[K][o]=v;\n\t\tsm[K][o]=1ll*lz[K][o]*(d[K][r]-d[K][l-1])%mod;\n\t\treturn;\n\t}\n\tpushdown(K,l,r,o);\n\tint mid=l+r>>1;\n\tif(mid>=ll)add(K,l,mid,o<<1,ll,rr,v);\n\tif(mid<rr)add(K,mid+1,r,o<<1|1,ll,rr,v);\n\tsm[K][o]=(sm[K][o<<1]+sm[K][o<<1|1])%mod;\n}\nint query(int K,int l,int r,int o,int ll,int rr)\n{\n\tif(l>=ll&&r<=rr)return sm[K][o];\n\tpushdown(K,l,r,o);\n\tint mid=l+r>>1,ans=0;\n\tif(mid>=ll)ans+=query(K,l,mid,o<<1,ll,rr);\n\tif(mid<rr)ans+=query(K,mid+1,r,o<<1|1,ll,rr);\n\treturn ans%mod;\n}\nint main()\n{\n\tfor(int i=0;i<=100;i++)c[i][0]=1;\n\tfor(int i=1;i<=100;i++)for(int j=1;j<=i;j++)\n\t\tc[i][j]=(c[i-1][j]+c[i-1][j-1])%mod;\n\tint n,m;\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tmemset(lz,-1,sizeof(lz));\n\tfor(int K=0;K<=5;K++)\n\t{\n\t\tfor(int i=1;i<=n;i++)d[K][i]=(d[K][i-1]+powdv(i,K))%mod;\n\t\tbuild(K,1,n,1);\n\t}\n\twhile(m--)\n\t{\n\t\tscanf(\"%s\",cc+1);\n\t\tif(cc[1]=='=')\n\t\t{\n\t\t\tint l,r,x;\n\t\t\tscanf(\"%d%d%d\",&l,&r,&x);\n\t\t\tfor(int K=0;K<=5;K++)add(K,1,n,1,l,r,x);\n\t\t}else\n\t\t{\n\t\t\tint l,r,k,dd=0;\n\t\t\tscanf(\"%d%d%d\",&l,&r,&k);\n\t\t\tfor(int K=0;K<=k;K++)\n\t\t\t{\n\t\t\t\tint cs=1ll*powdv(1-l,k-K)*c[k][K]%mod;\n\t\t\t\tdd=(dd+1ll*cs*query(K,1,n,1,l,r))%mod;\n\t\t\t}\n\t\t\tprintf(\"%d\\n\",(dd+mod)%mod);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1623564503,
        "uid": 107484,
        "name": "wmy_goes_to_thu",
        "ccfLevel": 8,
        "title": "CF266E \u9898\u89e3"
    },
    {
        "content": "[\u6d1b\u8c37\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF266E)\n\n[CF266E\u4f20\u9001\u95e8](http://codeforces.com/problemset/problem/266/E)\n\n---\n# \u5206\u6790\n\u9996\u5148\u533a\u95f4\u4fee\u6539\u533a\u95f4\u67e5\u8be2\u9996\u9009\u7ebf\u6bb5\u6811\n\n\u8981\u627e\u7a81\u7834\u53e3\uff0c$(i-l+1)^k$\u4e2d$i$\u4e0d\u662f\u5b9a\u503c\uff0c\n\n\u663e\u7136\u5f97\u62c6\u5f00\uff0c\u800c\u4e14$k$\u5f88\u5c0f\uff0c\u6839\u636e\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\n$$\\sum_{i=l}^ra_i(i-l+1)^k=\\sum_{i=l}^ra_i\\sum_{j=0}^kC(k,j)\\times i^j\\times (l-1)^{k-j}\\times (-1)^{k-j}$$\n\n$$=\\sum_{j=0}^kC(k,j)\\times (\\sum_{i=l}^ra_i\\times i^j)\\times (l-1)^{k-j}\\times (-1)^{k-j}$$\n\n\u90a3\u4e48\u7ebf\u6bb5\u6811\u53f6\u5b50\u8282\u70b9\u7ef4\u62a4$a_i\\times i^j$\uff0c\n\n\u5bf9\u4e8e\u533a\u95f4\u4fee\u6539\u5728\u9884\u5904\u7406\u65f6\u505a\u524d\u7f00\u548c\uff0c\u76f4\u63a5\u8d4b\u503c\n\n\u663e\u7136\u6b63\u6574\u6570\u5e42\u548c\u7ec4\u5408\u6570\u90fd\u80fd\u9884\u5904\u7406\uff0c\n\n\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6$O((n+m)klogn)$\n\n\u5361\u5e38\uff1a\n1. \u4e0d\u7528\u5feb\u901f\u5e42\uff0c\u9884\u5904\u7406\u7684\u65f6\u5019\u901a\u8fc7$i^{j-1}$\u63a8\u51fa$i^j$\n2. \u6ce8\u610f0^0=1\uff0c\u867d\u7136\u5728\u521d\u4e2d\u65e0\u610f\u4e49\n3. \u7ebf\u6bb5\u6811\u6bcf\u6b21\u53ea\u9012\u5f521\u6b21\uff0c$j=0\\sim 5$\u540c\u65f6\u4fee\u6539\u67e5\u8be2\uff0c\u67e5\u8be2\u6700\u540e\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u8bb0\u5f55\u7b54\u6848\uff0c\u61d2\u6807\u8bb0\u53ea\u9700\u89811\u4e2a\n4. \u7ec4\u5408\u6570\u53ef\u4ee5\u4e0d\u7528\u9636\u4e58\uff0c\u5b9e\u6d4b\u5feb30ms\n\n---\n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cctype>\n#define rr register\nusing namespace std;\nconst int N=100011,mod=1000000007;\nint si[6][N],a[N],n,m,c[6][6];\ninline signed iut(){\n\trr int ans=0; rr char c=getchar();\n\twhile (!isdigit(c)) c=getchar();\n\twhile (isdigit(c)) ans=(ans<<3)+(ans<<1)+(c^48),c=getchar();\n\treturn ans;\n}\ninline void print(int ans){\n\tif (ans>9) print(ans/10);\n\tputchar(ans%10+48);\n}\ninline signed mo(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline void Pro(int n){\n\tc[0][0]=1;\n\tfor (rr int i=1;i<6;++i){\n\t\tc[i][0]=c[i][i]=1;\n\t\tfor (rr int j=1;j<i;++j)\n\t\t    c[i][j]=c[i-1][j-1]+c[i-1][j];\n\t}\n\tfor (rr int i=0;i<=n;++i) si[0][i]=1;\n\tfor (rr int j=1;j<6;++j)\n\tfor (rr int i=1;i<=n;++i) si[j][i]=1ll*si[j-1][i]*i%mod;\n\tfor (rr int j=0;j<6;++j)\n\tfor (rr int i=1;i<=n;++i) si[j][i]=mo(si[j][i],si[j][i-1]);\n}\ninline signed Get(int k,int l,int r){return mo(si[k][r],mod-si[k][l-1]);}\nstruct Array_Six{int Q[6];};\nstruct Segment_Tree{\n\tint w[N<<2][6],lazy[N<<2];\n\tinline void pup(int k){\n\t\tfor (rr int j=0;j<6;++j)\n\t\t    w[k][j]=mo(w[k<<1][j],w[k<<1|1][j]);\n\t}\n\tinline void build(int k,int l,int r){\n\t\tlazy[k]=-1;\n\t\tif (l==r){\n\t\t\tfor (rr int j=0;j<6;++j)\n\t\t\t    w[k][j]=1ll*a[l]*Get(j,l,l)%mod;\n\t\t    return;\n\t\t}\n\t\trr int mid=(l+r)>>1;\n\t\tbuild(k<<1,l,mid);\n\t\tbuild(k<<1|1,mid+1,r);\n\t\tpup(k);\n\t}\n\tinline void pdown(int k,int l,int mid,int r){\n\t\tif (~lazy[k]){\n\t\t\tlazy[k<<1]=lazy[k<<1|1]=lazy[k];\n\t\t\tfor (rr int j=0;j<6;++j)\n\t\t\t    w[k<<1][j]=1ll*lazy[k]*Get(j,l,mid)%mod,\n\t\t\t    w[k<<1|1][j]=1ll*lazy[k]*Get(j,mid+1,r)%mod;\n\t\t\tlazy[k]=-1;\n\t\t}\n\t}\n\tinline void update(int k,int l,int r,int x,int y,int z){\n\t\tif (l==x&&r==y){\n\t\t\tlazy[k]=z;\n\t\t\tfor (rr int j=0;j<6;++j)\n\t\t\t    w[k][j]=1ll*z*Get(j,l,r)%mod;\n\t\t\treturn;\n\t\t}\n\t\trr int mid=(l+r)>>1; pdown(k,l,mid,r);\n\t\tif (y<=mid) update(k<<1,l,mid,x,y,z);\n\t\telse if (x>mid) update(k<<1|1,mid+1,r,x,y,z);\n\t\telse update(k<<1,l,mid,x,mid,z),update(k<<1|1,mid+1,r,mid+1,y,z);\n\t\tpup(k);\n\t}\n\tinline Array_Six query(int k,int l,int r,int x,int y){\n\t\trr Array_Six t1,t2;\n\t\tif (l==x&&r==y){\n\t\t\tfor (rr int j=0;j<6;++j)\n\t\t\t    t1.Q[j]=w[k][j];\n\t\t\treturn t1;\n\t\t}\n\t\trr int mid=(l+r)>>1; pdown(k,l,mid,r);\n\t\tfor (rr int j=0;j<6;++j) t1.Q[j]=t2.Q[j]=0;\n\t\tif (y<=mid) t1=query(k<<1,l,mid,x,y);\n\t\telse if (x>mid) t2=query(k<<1|1,mid+1,r,x,y);\n\t\telse t1=query(k<<1,l,mid,x,mid),\n\t\t    t2=query(k<<1|1,mid+1,r,mid+1,y);\n\t\tfor (rr int j=0;j<6;++j) t1.Q[j]=mo(t1.Q[j],t2.Q[j]);\n\t\treturn t1;\n\t}\n}Tre;\nsigned main(){\n\tn=iut(); m=iut(); Pro(N-11);\n\tfor (rr int i=1;i<=n;++i) a[i]=iut();\n\tTre.build(1,1,n);\n\tfor (;m;--m){\n\t\trr char C=getchar();\n\t\twhile (C!='?'&&C!='=') C=getchar();\n\t\tif (C=='='){\n\t\t\trr int l=iut(),r=iut(),x=iut();\n\t\t\tTre.update(1,1,n,l,r,x);\n\t\t}else{\n\t\t\trr int l=iut(),r=iut(),k=iut(),ans=0;\n\t\t\trr Array_Six t=Tre.query(1,1,n,l,r);\n\t\t\tfor (rr int j=0,W;j<=k;++j){\n\t\t\t\tif (l>1) W=Get(k-j,l-1,l-1);\n\t\t\t\t    else W=si[k-j][l-1];\n\t\t\t\tif (((k^j)&1)&&W) W=mod-W;\n\t\t\t\tans=mo(ans,1ll*W*c[k][j]%mod*t.Q[j]%mod);\n\t\t\t}\n\t\t\tprint(ans),putchar(10);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1582638817,
        "uid": 37782,
        "name": "lemondinosaur",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF266E \u3010More Queries to Array...\u3011"
    },
    {
        "content": "# Preface\n\n[\u9898\u76ee\u94fe\u63a5](http://codeforces.com/problemset/problem/266/E)\n\n\u5f88\u5178\u578b\u7684\u4e00\u9053\u7ebf\u6bb5\u6811\u9898\uff0c\u62ff\u6765\u5f53\u6a21\u677f\u7ec3\u7ec3\u3002\n\n# Statement\n\n\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $[a_1,a_2,\\cdots,a_n]$\uff0c\u6709\u4e24\u79cd\u64cd\u4f5c:\n+ `= l r x` \u8868\u793a\u5c06 $a_l,a_{l+1},\\cdots,a_r$ \u5168\u90e8\u8d4b\u6210 $x$\n+ `? l r k` \u8868\u793a\u8be2\u95ee $\\sum_{i=l}^ra_i\\cdot(i-l+1)^k$ \u6a21 $10^9+7$ \u7684\u503c\u3002\n\n# Solution\n\n\u770b\u8fd9\u4e2a\u5f0f\u5b50\u6ee1\u8138\u7684\u4e0d\u53ef\u505a\uff0c\u6240\u4ee5\u8981\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u628a\u5b83\u62c6\u5f00\u3002\n\n> **\u4e8c\u9879\u5f0f\u5b9a\u7406**\uff1a\n$$\n\\begin{aligned}\n(x+y)^n&=x^n+\\binom{n}{1}x^{n-1}y+\\binom{n}{2}x^{n-2}y^2+\\cdots+\\binom{n}{n-1}xy^{n-1}+y^n\\\\\n\\\\&=\\sum_{k=0}^n\\binom{n}{k}x^{n-k}y^k\n\\end{aligned}\n$$\n\n\u62c6\u5f00\u8fc7\u7a0b\u5982\u4e0b\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{i=l}^ra_i\\cdot(i-l+1)^k&=\\sum_{i=l}^ra_i\\cdot(i+(1-l))^k\\\\&=\\sum_{i=l}^ra_i\\cdot\\sum_{j=0}^k\\binom{k}{j}(1-l)^{k-j}\\cdot i^j\\\\&=\\sum_{j=0}^k\\binom{k}{j}(1-l)^{k-j}\\cdot\\sum_{i=l}^ra_i\\cdot i^j\n\\end{aligned}\n$$\n\n\u53ea\u8981\u7ef4\u62a4 $\\sum_{i=l}^ra_i\\cdot i^j$ \u5373\u53ef\uff0c\u8fd9\u4e2a\u76f4\u63a5\u641e 6 \u68f5\u7ebf\u6bb5\u6811\u5e26\u61d2\u6807\u8bb0\u5c31\u884c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\uff0c\u4f46\u662f\u81ea\u5e26\u5de8\u5927\u591a\u5e38\u6570\u3002\n\n# Summary\n\n\u65e0\u8111\u62c6\u5f0f\u5b50\u9898\u2026\u2026\n\n# Code\n\n```cpp\n//AC!\n#include<bits/stdc++.h>\n#define int long long\n#define repe(i,l,r) for(int (i)=l;(i)<=r;(i)++)\n#define rep(i,n) for(int (i)=1;(i)<=n;(i)++)\n#define FOR(i,r,l) for(int (i)=r;(i)>=l;(i)--)\n#define INF 0x3f3f3f\n#define pii pair<int,int>\n#define ll long long\n#define mpr make_pair\n#define pb push_back\n#define F first\n#define S second\n#define sz(v) (int)((v).size())\n#define ALL(v) (v).begin(),(v).end()\n#define rALL(v) (v).rbegin(),(v).rend()\n#define srt(v) sort(ALL(v))\n#define rsrt(v) sort(rALL(v))\n#define rev(v) reverse(ALL(v))\n#define lb(v,x) (int)(lower_bound(ALL(v),x)-v.begin())\n#define ub(v,x) (int)(upper_bound(ALL(v),x)-v.begin())\n#define uni(v) v.resize(unique(ALL(v))-v.begin())\nusing namespace std;\nint read(){int sum=0,f=1;char c;c=getchar();while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}while(c>='0'&&c<='9'){sum=(sum<<1)+(sum<<3)+(c-'0');c=getchar();}return sum*f;}\nvoid out(int x){if(x<0){x=-x;putchar('-');}if(x>=10)out(x/10);putchar(x%10+'0');}\nvoid die(string s){puts(s.c_str());exit(0);}\nint fast(int a,int b,int P){int res=1;if(P<=0){while(b){if(b&1)res=res*a;a=a*a;b>>=1;}}else{while(b){if(b&1)res=res*a%P;a=a*a%P;b>>=1;}}return res;}\nconst int N=1e5+10,P=1e9+7;\nint n,m,a[N],sum[6][N];\nstruct node{\n\tint l,r;\n\tint val,tag;\n};\nstruct segTree{\n\tnode tree[6][N<<2];\n\tvoid pushup(int k,int x){\n\t\ttree[k][x].val=(tree[k][x<<1].val+tree[k][x<<1|1].val)%P;\n\t}\n\tvoid pushdown(int k,int x){\n\t\tif(tree[k][x].tag==-1)return;\n\t\ttree[k][x<<1].val=1LL*tree[k][x].tag*((sum[k][tree[k][x<<1].r]-sum[k][tree[k][x<<1].l-1]+P)%P)%P;\n\t\ttree[k][x<<1|1].val=1LL*tree[k][x].tag*((sum[k][tree[k][x<<1|1].r]-sum[k][tree[k][x<<1|1].l-1]+P)%P)%P;\n\t\ttree[k][x<<1].tag=tree[k][x<<1|1].tag=tree[k][x].tag;\n\t\ttree[k][x].tag=-1;\n\t}\n\tvoid build(int k,int x,int l,int r){\n\t\ttree[k][x].l=l,tree[k][x].r=r;\n\t\ttree[k][x].tag=-1;\n\t\tif(l==r){\n\t\t\ttree[k][x].val=1LL*a[l]*fast(l,k,P)%P;\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tbuild(k,x<<1,l,mid);\n\t\tbuild(k,x<<1|1,mid+1,r);\n\t\tpushup(k,x);\n\t}\n\tvoid update(int k,int x,int l,int r,int v){\n\t\tif(tree[k][x].l>=l&&tree[k][x].r<=r){\n\t\t\ttree[k][x].val=1LL*v*((sum[k][tree[k][x].r]-sum[k][tree[k][x].l-1]+P)%P)%P;\n\t\t\ttree[k][x].tag=v;\n\t\t\treturn;\n\t\t}\n\t\tpushdown(k,x);\n\t\tint mid=(tree[k][x].l+tree[k][x].r)>>1;\n\t\tif(l<=mid)update(k,x<<1,l,r,v);\n\t\tif(r>mid)update(k,x<<1|1,l,r,v);\n\t\tpushup(k,x);\n\t}\n\tint query(int k,int x,int l,int r){\n\t\tif(tree[k][x].l>=l&&tree[k][x].r<=r){\n\t\t\treturn tree[k][x].val;\n\t\t}\n\t\tpushdown(k,x);\n\t\tint mid=(tree[k][x].l+tree[k][x].r)>>1,ans=0;\n\t\tif(l<=mid)ans=query(k,x<<1,l,r);\n\t\tif(r>mid)ans=(ans+query(k,x<<1|1,l,r))%P;\n\t\treturn ans;\n\t}\n}T;\nint binom(int x,int y){\n\tint ans=1;\n\tfor(int i=x;i>x-y;i--)ans*=i;\n\tfor(int i=y;i>1;i--)ans/=i;\n\treturn ans;\n}\nsigned main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=0;i<=5;i++){\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tsum[i][j]=(sum[i][j-1]+fast(j,i,P))%P;\n\t\t}\n\t}\n\tfor(int i=0;i<=5;i++)T.build(i,1,1,n);\n\tchar ch,tmp;\n\tint l,r,x;\n\tfor(int i=1;i<=m;i++){\n\t\tch=getchar(),tmp=getchar();\n\t\tl=read(),r=read(),x=read();\n\t\tif(ch=='='){\n\t\t\tfor(int j=0;j<=5;j++){\n\t\t\t\tT.update(j,1,l,r,x);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tint ans=0;\n\t\t\tfor(int j=0;j<=x;j++){\n\t\t\t\tint mul;\n\t\t\t\tif((x-j)&1)mul=(P-fast(l-1,x-j,P))%P;\n\t\t\t\telse mul=fast(l-1,x-j,P);\n\t\t\t\tans=(ans+1LL*binom(x,j)*mul%P*T.query(j,1,l,r)%P)%P;\n\t\t\t}\n\t\t\tout(ans),putchar('\\n');\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1668312357,
        "uid": 229669,
        "name": "Jerry__Jiang",
        "ccfLevel": 7,
        "title": "CF266E More Queries to Array..."
    },
    {
        "content": "\u770b\u5230\u533a\u95f4\u8d4b\u503c\uff0c\u4e0d\u96be\u60f3\u5230 $ODT$ \u3002\n\n\u7136\u540e $T$ \u5149\u4e86\u3002\n\n\u89c2\u5bdf\u5f0f\u5b50\uff0c\u4e0d\u96be\u53d1\u73b0\u4e00\u6bb5\u8fde\u7eed\u7684 $ai$ \u7684 $ai*(i-l+1)^k$ \u662f\u4e0d\u540c\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e0d\u7528 $ODT$ \u53bb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u6ce8\u610f\u5230 $K$ \u5f88\u5c0f\uff0c\u628a\u5f0f\u5b50\u53d8\u6362\u4e00\u4e0b\u3002\u663e\u7136\u6709 $(i-l+1)^k=(i+(1-l))^k$ \u3002 $ai*i$ \u53ef\u4ee5\u9884\u5904\u7406\uff0c$1-l$ \u7684\u6b21\u5e42\u4e5f\u53ef\u4ee5\u9884\u5904\u7406\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u6211\u4eec\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u53bb\u5c55\u5f00\u5b83\uff0c\u7528\u6211\u4eec\u7ef4\u62a4\u597d\u7684\u4fe1\u606f\u53bb\u7b97\u5c31\u53ef\u4ee5\u4e86\uff08markdown\u6253\u4e0d\u6765sigma..\uff09\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\n\ntemplate <class T>\ninline bool read(T &ret)\n{\n    char c;\n    int sgn;\n    if (c = getchar(), c == EOF)\n    {\n        return 0;\n    }\n    while (c != '-' && (c < '0' || c > '9'))\n    {\n        c = getchar();\n    }\n    sgn = (c == '-') ? -1 : 1;\n    ret = (c == '-') ? 0 : (c - '0');\n    while (c = getchar(), c >= '0' && c <= '9')\n    {\n        ret = ret * 10 + (c - '0');\n    }\n    ret *= sgn;\n    return 1;\n}\n\ntemplate <class T>\ninline void write(T x)\n{\n    if (x > 9)\n    {\n        write(x / 10);\n    }\n    putchar(x % 10 + '0');\n}\n\nconst int MAXN=1e6+10;\nconst long long MOD=1e9+7;\nlong long cc[MAXN][6],sum[MAXN][6],lazy[MAXN],ans[6];\nint n,m;\n\ninline long long calc(int l,int r,int k)\n{\n    return ((cc[r][k]-cc[l-1][k])%MOD+MOD)%MOD;\n}\n\ninline void pushup(int x)\n{\n    for(int i=0;i<=5;i++)\n    {\n        sum[x][i]=(sum[x<<1][i]+sum[x<<1|1][i])%MOD;\n    }\n}\n\ninline void pushdown(int l,int r,int x)\n{\n    if(lazy[x]!=-1)\n    {\n        int mid=(l+r)>>1;\n        lazy[x<<1]=lazy[x];\n        lazy[x<<1|1]=lazy[x];\n        for(int i=0;i<=5;i++)\n        {\n            sum[x<<1][i]=(lazy[x]*calc(l,mid,i))%MOD;\n            sum[x<<1|1][i]=(lazy[x]*calc(mid+1,r,i))%MOD;\n        }\n        lazy[x]=-1;\n    }\n}\n\nvoid build(int l,int r,int x)\n{\n    lazy[x]=-1;\n    if(l==r)\n    {\n        int sr;\n        read(sr);\n        for(int i=0;i<=5;i++)\n        {\n            sum[x][i]=sr*calc(l,l,i)%MOD;\n        }\n        return;\n    }\n    int mid=(l+r)>>1;\n    build(l,mid,x<<1);\n    build(mid+1,r,x<<1|1);\n    pushup(x);\n}\n\nvoid change(int L,int R,int C,int l,int r,int x)\n{\n    if(L<=l&&r<=R)\n    {\n        lazy[x]=C;\n        for(int i=0;i<=5;i++)\n        {\n            sum[x][i]=C*calc(l,r,i)%MOD;\n        }\n        return;\n    }\n    pushdown(l,r,x);\n    int mid=(l+r)>>1;\n    if(L<=mid)\n        change(L,R,C,l,mid,x<<1);\n    if(R>mid)\n        change(L,R,C,mid+1,r,x<<1|1);\n    pushup(x);\n}\n\nvoid query(int L,int R,int l,int r,int x)\n{\n    if(L<=l&&r<=R)\n    {\n        for(int i=0;i<=5;i++)\n        {\n            ans[i]=(ans[i]+sum[x][i])%MOD;\n        }\n        return;\n    }\n    pushdown(l,r,x);\n    int mid=(l+r)>>1;\n    if(L<=mid)\n        query(L,R,l,mid,x<<1);\n    if(R>mid)\n        query(L,R,mid+1,r,x<<1|1);\n}\n\nsigned main()\n{\n    read(n),read(m);\n    for(int i=1;i<=n;i++)\n    {\n        cc[i][0]=1;\n        for(int j=1;j<=5;j++)\n        {\n            cc[i][j]=(cc[i][j-1]*i)%MOD;\n        }\n    }\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=0;j<=5;j++)\n        {\n            cc[i][j]=(cc[i][j]+cc[i-1][j])%MOD;\n        }\n    }\n    build(1,n,1);\n    while(m--)\n    {\n        char op;\n        cin>>op;\n        int l,r,k;\n        read(l),read(r),read(k);\n        if(op=='=')\n        {\n            change(l,r,k,1,n,1);\n        }\n        else\n        {\n            memset(ans,0,sizeof(ans));\n            query(l,r,1,n,1);\n            long long ret=0;\n            if(k==0)\n            {\n                ret+=ans[0];\n                ret%=MOD;\n            }\n            else if(k==1)\n            {\n                ret+=ans[1];\n                ret%=MOD;\n                ret-=((l-1)*ans[0])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n            }\n            else if(k==2)\n            {\n                ret+=ans[2];\n                ret%=MOD;\n                ret-=(2*(l-1)*ans[1])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n                ret+=((l-1)*(l-1)%MOD*ans[0])%MOD;\n                ret%=MOD;\n            }\n            else if(k==3)\n            {\n                ret+=ans[3];\n                ret%=MOD;\n                ret-=(3*(l-1)*ans[2])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n                ret+=(3*(l-1)*(l-1)%MOD*ans[1])%MOD;\n                ret%=MOD;\n                ret-=((((l-1)*(l-1))%MOD*(l-1))%MOD*ans[0])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n            }\n            else if(k==4)\n            {\n                ret+=ans[4];\n                ret%=MOD;\n                ret-=(4*(l-1)*ans[3])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n                ret+=(6*(l-1)*(l-1)%MOD*ans[2])%MOD;\n                ret%=MOD;\n                ret-=(((4*(l-1)*(l-1))%MOD*(l-1))%MOD*ans[1])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n                ret+=(((((l-1)*(l-1)%MOD)*(l-1))%MOD*(l-1))%MOD*ans[0])%MOD;\n                ret%=MOD;\n            }\n            else if(k==5)\n            {\n                ret+=ans[5];\n                ret%=MOD;\n                ret-=(5*(l-1)*ans[4])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n                ret+=(10*(l-1)*(l-1)%MOD*ans[3])%MOD;\n                ret%=MOD;\n                ret-=(((10*(l-1)*(l-1))%MOD*(l-1))%MOD*ans[2])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n                ret+=((((5*(l-1)*(l-1)%MOD)*(l-1))%MOD*(l-1))%MOD*ans[1])%MOD;\n                ret%=MOD;\n                ret-=(((((l-1)*(l-1)%MOD*(l-1))%MOD*(l-1))%MOD*(l-1))%MOD*ans[0])%MOD;\n                ret+=MOD;\n                ret%=MOD;\n            }\n            ret=(ret%MOD+MOD)%MOD;\n            write(ret);\n            putchar('\\n');\n        }\n    }\n    return 0;\n}\n```\n",
        "postTime": 1570094270,
        "uid": 102473,
        "name": "Setsugesuka",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF266E \u3010More Queries to Array...\u3011"
    },
    {
        "content": "\u770b\u5230 $k\\le 5$\uff0c\u76f4\u63a5\u5408\u7406\u63a8\u6d4b\u62c6\u5f00\u5f0f\u5b50\uff0c\u5efa $k$ \u68f5\u7ebf\u6bb5\u6811\u3002\n\n$(i-l+1)^k$ \u662f\u4e00\u4e2a\u5947\u602a\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u4e0d\u59a8\u8003\u8651\u5c06\u5176\u5229\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u62c6\u5f00\u3002\n\n\u6709\uff1a\n\n$$(i-l+1)^k= [(i+1)-l]^k= \\sum_{j=0}^k{\\binom{k}{j}\\times (i+1)^j\\times (-l)^{k-j}}$$\n\n\u5c06 $a_i$ \u5e26\u5165\uff0c\u6709\uff1a\n\n$$\\sum_{i=1}^na_i \\sum_{j=0}^k{\\binom{k}{j}\\times (i+1)^j\\times (-l)^{k-j}}$$\n\n\u770b\u5230\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u6211\u4eec\u5148\u8003\u8651\u5c06 $a_i$ \u548c\u540e\u9762\u7684\u4e00\u5806\u4e1c\u897f\u6254\u5728\u4e00\u8d77\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\n\n\u7ed3\u679c\u5c31\u53d8\u6210\u4e86\uff1a\n\n$$\\sum_{j=0}^k{{\\binom{k}{j}\\times (-l)^{k-j}}\\times [\\sum_{i=1}^n a_i(i+1)^j]}$$\n\n\u540e\u9762\u7684\u4e2d\u62ec\u53f7\u91cc\u7684\u90a3\u4e00\u64ae\u4e1c\u897f\u7528\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4",
        "postTime": 1682776366,
        "uid": 358739,
        "name": "BFSDFS123",
        "ccfLevel": 0,
        "title": "CF266E More Queries to Array... \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u7ef4\u62a4\u7684\u4e1c\u897f\u53ef\u4ee5\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u62c6\u5f00\u90a3\u5c31\u5148\u62c6\u5f00\uff1a              \n\n$a_i(i - l + 1) ^ k$         \n\n$= a_i(i - (l - 1)) ^ k$\n\n$= \\sum_{s = 0} ^ k (a_i \\times i ^ s) \\times (l - 1) ^ {k - s} \\times (-1) ^ {k - s}$            \n\n\u8003\u8651\u4e2d\u95f4\u7684\u4e1c\u897f\u4e4b\u548c $i$ \u6709\u5173\u6240\u4ee5\u5fc5\u5b9a\u53ef\u4ee5\u7ef4\u62a4\uff0c\u800c\u540e\u9762\u7684\u4e1c\u897f\u5728 $s$ \u548c $k$ \u56fa\u5b9a\u7684\u60c5\u51b5\u4e0b\u6bcf\u6b21\u67e5\u8be2\u56fa\u5b9a\u3002\u89c2\u5bdf\u5230 $k$ \u5f88\u5c0f\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $s$ \u8fdb\u884c\u8ba1\u7b97\u3002            \n\n$\\sum_{i = l} ^ r a_i(i - l + 1)$        \n\n$= \\sum_{s = 0} ^ k (l - 1) ^ {k - s} \\times (-1) ^ {k - s} \\times (\\sum_{i = l} ^ r a_i \\times i ^ s)$          \n\n\u524d\u9762\u7684\u4e1c\u897f\u53ef\u4ee5\u5728\u6bcf\u6b21\u679a\u4e3e $k$ \u65f6\u8ba1\u7b97\uff0c\u540e\u9762\u7684\u4e1c\u897f\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002       \n\u65f6\u95f4\u590d\u6742\u5ea6 $O(6 n\\log n)$\u3002\n\n\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5206\u5757\u7ef4\u62a4\uff0c\u8fd9\u4e2a\u5c31\u66f4\u7b80\u5355\u4e86\uff0c\u7ef4\u62a4\u4e00\u4e0b\u6240\u6709\u7684\u5757\u5185 $0 ^ k + 1 ^ k + 2 ^ k + 3 ^ k ....$ \u4e4b\u548c\u4ee5\u53ca\u5757\u5185\u7684 $a_{L_i} \\times 0 ^ k + a_{L_i + 1} \\times 1 ^ k ....$ \u4e4b\u548c\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(6 n \\sqrt n)$\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u8111\u762b\u9898\u4e0d\u653e\u8fc7\u3002               \n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\n#define int long long\nconst int Len = 1e5 + 5 , mod = 1e9 + 7;\nint n,m,tag[Len << 2],C[7][7],a[Len];\nlong long sumB[Len << 2][7],sum[Len << 2][7],qpow[Len][7];\nint ls(int x){return x << 1;}\nint rs(int x){return x << 1 | 1;}\nvoid push_up(int x){for(int i = 0 ; i <= 5 ; i ++) sumB[x][i] = sumB[ls(x)][i] + sumB[rs(x)][i] , sumB[x][i] %= mod;}\nvoid push_down(int p,int l,int r)\n{\n\tif(~tag[p])\n\t{\n\t\ttag[ls(p)] = tag[rs(p)] = tag[p];\n\t\tfor(int i = 0 ; i <= 5 ; i ++)\n\t\t{\n\t\t\tsumB[ls(p)][i] = sum[ls(p)][i] * tag[ls(p)] % mod;\n\t\t\tsumB[rs(p)][i] = sum[rs(p)][i] * tag[rs(p)] % mod;\n\t\t}\n\t}\n\ttag[p] = -1;\n}\nvoid build(int p,int l,int r)\n{\n\ttag[p] = -1;\n\tif(l == r)\n\t{\n\t\tfor(int i = 0 ; i <= 5 ; i ++) \n\t\t{\n\t\t\tsum[p][i] = qpow[l][i];\n\t\t\tsumB[p][i] = sum[p][i] * a[l] % mod;\n\t\t}\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(ls(p) , l , mid);\n\tbuild(rs(p) , mid + 1 , r);\n\tpush_up(p);\n\tfor(int i = 0 ; i <= 5 ; i ++) sum[p][i] = sum[ls(p)][i] + sum[rs(p)][i] , sum[p][i] %= mod;\n}\nvoid update(int p,int l,int r,int nl,int nr,int k)\n{\n\tif(nl <= l && nr >= r)\n\t{\n\t\ttag[p] = k;\n\t\tfor(int i = 0 ; i <= 5 ; i ++) sumB[p][i] = sum[p][i] * tag[p] % mod;\n\t\treturn;\n\t}\n\tpush_down(p , l , r);\n\tint mid = (l + r) >> 1;\n\tif(nl <= mid) update(ls(p) , l , mid , nl , nr , k);\n\tif(nr > mid) update(rs(p) , mid + 1 , r , nl , nr , k);\n\tpush_up(p);\n}\nlong long query(int p,int l,int r,int nl,int nr,int k)\n{\n\tif(nl <= l && nr >= r) return sumB[p][k];\n\tpush_down(p , l , r);\n\tint mid = (l + r) >> 1;long long res = 0;\n\tif(nl <= mid) res += query(ls(p) , l , mid , nl , nr , k);\n\tif(nr > mid) res += query(rs(p) , mid + 1 , r , nl , nr , k);\n\tres %= mod;\n\treturn res; \n}\nchar s[3];\nlong long Qpow(int x)\n{\n\tif(x % 2 == 1) return -1;\n\treturn 1;\n}\nsigned main()\n{\n\tC[0][0] = C[1][0] = C[1][1] = 1;\n\tfor(int i = 2 ; i <= 5 ; i ++)\n\t\tfor(int j = 0 ; j <= i ; j ++)\n\t\t{\n\t\t\tif(j == 0 || j == i) C[i][j] = 1;\n\t\t\telse C[i][j] = C[i - 1][j] + C[i - 1][j - 1];\n\t\t}\n\tscanf(\"%lld %lld\",&n,&m);\n\tfor(int i = 0 ; i <= n ; i ++) \n\t{\n\t\tqpow[i][0] = 1;\n\t\tfor(int j = 1 ; j <= 5 ; j ++) qpow[i][j] = qpow[i][j - 1] * i % mod;\n\t}\n\tfor(int i = 1 ; i <= n ; i ++) scanf(\"%lld\",&a[i]);\n\tbuild(1 , 1 , n);\n\tfor(int i = 1 ; i <= m ; i ++)\n\t{\n\t\tscanf(\"%s\",s);int l,r,k;scanf(\"%lld %lld %lld\",&l,&r,&k);\n\t\tif(s[0] == '?') \n\t\t{\n\t\t\tlong long YYSWYS = 0;\n\t\t\tfor(int s = 0 ; s <= k ; s ++)\n\t\t\t{\n\t\t\t\tYYSWYS += C[k][s] * query(1 , 1 , n , l , r , s)  \n\t\t\t\t% mod * qpow[l - 1][k - s] * Qpow(k - s) % mod;\n\t\t\t\tYYSWYS = (YYSWYS + mod) % mod;\n\t\t\t} \n\t\t\tprintf(\"%lld\\n\",YYSWYS);\n\t\t}\n\t\telse update(1 , 1 , n , l , r,  k);\n\t\t\n\t} \n\treturn 0;\n}\n```",
        "postTime": 1629252422,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 More Queries to Array..."
    }
]