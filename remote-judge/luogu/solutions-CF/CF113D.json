[
    {
        "content": "# [\u300cCodeforces113D\u300dMuseum-\u9ad8\u65af\u6d88\u5143](http://codeforces.com/contest/113/problem/D)\n\n## Description\n\n\u6709\u4e00\u4e2a$n$\u4e2a\u70b9$m$\u6761\u8fb9\u7684\u65e0\u5411\u56fe\uff0c\u4e24\u4e2a\u4eba\u5206\u522b\u4ece$x,y$\u51fa\u53d1\uff0c\u6bcf\u4e2a\u4eba\u6bcf\u5206\u949f\u6709$p_i$\u7684\u6982\u7387\u4e0d\u52a8, \u6709$1\u2212p_i$\u7684\u6982\u7387\u8d70\u5230\u968f\u673a\u4e00\u4e2a\u76f8\u90bb\u7684\u70b9\u3002\n\n\u5f53\u4ed6\u4eec\u5728\u540c\u4e00\u65f6\u523b\u9009\u62e9\u524d\u5f80\u540c\u4e00\u4e2a\u623f\u95f4, \u4ed6\u4eec\u5c31\u4f1a\u5728\u90a3\u4e2a\u623f\u95f4\u76f8\u9047\u5e76\u505c\u6b62\u3002\n\n\u6c42\u5728\u6bcf\u4e2a\u70b9\u76f8\u9047\u7684\u6982\u7387\u3002\n\n$n \\leq 22$\n\n## Solution\n\n\u8fd9\u9053\u9898\u6709\u4e24\u79cd\u505a\u6cd5\u3002\n\n\u7b2c\u4e00\u79cd\u505a\u6cd5\uff0c\u679a\u4e3e\u7ec8\u70b9\uff0c\u7136\u540e\u9ad8\u65af\u6d88\u5143\u5373\u53ef\u3002\u76f4\u63a5\u8fd9\u6837\u505a\u662f$O(n^7)$\u7684\uff0c\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\u3002\u8003\u8651\u6bcf\u6b21\u4fee\u6539\u7ec8\u70b9\u53ea\u4f1a\u4fee\u6539$f(i,i)$\u7684\u503c\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a$f(i,i)$\u89c6\u4e3a\u5e38\u6570\uff0c\u90a3\u4e48\u5217\u51fa\u65b9\u7a0b\u7ec4\u540e\u9ad8\u65af\u6d88\u5143\u53ef\u4ee5\u5f97\u51fa$f(i,j)=\\sum_{k=1}^n A_{i,j,k} f(k,k)$\u3002\u6bcf\u6b21\u679a\u4e3e\u7ec8\u70b9\u66b4\u529b\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u7b2c\u4e8c\u79cd\u505a\u6cd5\uff0c\u8bbe$f(i,j)$\u8868\u793a\u7b2c\u4e00\u4e2a\u4eba\u5728$i$\u7b2c\u4e8c\u4e2a\u4eba\u5728$j$\u7684\u671f\u671b\u51fa\u73b0\u6b21\u6570\uff0c\u7531\u4e8e\u7ec8\u6b62\u72b6\u6001$(i,i)$\u7684\u51fa\u73b0\u6b21\u6570\u53ea\u53ef\u80fd\u4e3a$0/1$\uff0c\u6240\u4ee5\u6982\u7387\u5373\u671f\u671b\u3002\u76f4\u63a5\u89e3\u65b9\u7a0b\u5373\u53ef\u3002\n\n\u6ce8\u610f\u521d\u59cb\u70b9\u7684\u65b9\u7a0b\u4e3a\n\n$$f(a,b)-1=\\sum_{i=1}^n\\sum_{j=1}^n A(i,j)f(i,j)$$\n\n\u5176\u4f59\u70b9\u7684\u65b9\u7a0b\u4e3a\n\n$$f(a,b)=\\sum_{i=1}^n\\sum_{j=1}^n A(i,j)f(i,j)$$\n\n\u5176\u4e2d$A(i,j)$\u8868\u793a\u4ece$(a,b)$\u8f6c\u79fb\u5230$(i,j)$\u7684\u6982\u7387\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ninline int gi()\n{\n    char c = getchar();\n    while(c < '0' || c > '9') c = getchar();\n    int sum = 0;\n    while('0' <= c && c <= '9') sum = sum * 10 + c - 48, c = getchar();\n    return sum;\n}\n\nconst double eps = 1e-7;\nconst int maxn = 25, maxm = maxn * maxn;\n\nint n, m, a, b, deg[maxn], Id[maxn][maxn];\nvector<int> to[maxn];\ndouble p[maxn], mat[maxm][maxm], ans[maxm], f[maxn][maxn];\n\nvoid pre()\n{\n    m = 0;\n    for (int i = 1; i <= n; ++i)\n        for (int j = 1; j <= n; ++j)\n            Id[i][j] = ++m;\n    mat[Id[a][b]][m + 1] = -1;\n    for (int i = 1; i <= n; ++i)\n        for (int j = 1; j <= n; ++j) {\n            int x = Id[i][j];\n            --mat[x][x];\n            if (i != j) mat[x][x] += p[i] * p[j];\n            for (int u : to[i])\n                for (int v : to[j]) {\n                    if (u == v) continue;\n                    mat[x][Id[u][v]] = (1 - p[u]) * (1 - p[v]) / deg[u]  / deg[v];\n                }\n            for (int u : to[i]) {\n                if (u == j) continue;\n                mat[x][Id[u][j]] = (1 - p[u]) * p[j]/ deg[u];\n            }\n            for (int v : to[j]) {\n                if (v == i) continue;\n                mat[x][Id[i][v]] = p[i] * (1 - p[v]) / deg[v];\n            }\n        }\n}\n\nint dcmp(double a)\n{\n    if (-eps < a && a < eps) return 0;\n    else if (a > 0) return 1;\n    else return -1;\n}\n\n/*int gauss()\n{\n    for (int i = 1; i < m; ++i) {\n        int p = i;\n        for (int j = i + 1; j <= m; ++j)\n            if (abs(mat[j][i]) > abs(mat[p][i])) p = j;\n        if (p != i)\n            for (int j = i; j <= m + 1; ++j) swap(mat[i][j], mat[p][j]);\n        for (int j = i + 1; j <= m; ++j) {\n            if (!dcmp(mat[j][i])) continue;\n            double t1 = mat[j][i], t2 = mat[i][i];\n            for (int k = i; k <= m + 1; ++k) mat[j][k] -= mat[i][k] * t1 / t2;\n        }\n    }\n    for (int i = m; i >= 1; --i) {\n        if (!dcmp(mat[i][i])) return 0;\n        for (int j = i + 1; j <= m; ++j)\n            mat[i][m + 1] -= ans[j] * mat[i][j];\n        ans[i] = mat[i][m + 1] / mat[i][i];\n    }\n    return 1;\n}*/\n\nvoid gauss()\n{\n    for (int i = 1; i <= m; ++i) {\n        int p = i;\n        for (int j = i; j <= m; ++j)\n            if (abs(mat[j][i]) > abs(mat[p][i])) p = j;\n        if (p != i) \n            for (int j = i; j <= m; ++j) swap(mat[p][j], mat[i][j]);\n        for (int j = 1; j <= m; ++j) {\n            if (p == j) continue;\n            double t = mat[j][i] / mat[i][i];\n            for (int k = i; k <= m + 1; ++k) mat[j][k] -= mat[i][k] * t;\n        }\n    }\n    for (int i = 1; i <= n; ++i)\n        for (int j = 1; j <= n; ++j)\n            f[i][j] = mat[Id[i][j]][m + 1] / mat[Id[i][j]][Id[i][j]];\n}\n\nint main()\n{\n    n = gi(); m = gi(); a = gi(); b = gi();\n    for (int u, v, i = 1; i <= m; ++i) {\n        u = gi(); v = gi();\n        to[u].push_back(v); ++deg[u];\n        to[v].push_back(u); ++deg[v];\n    }\n    for (int i = 1; i <= n; ++i) scanf(\"%lf\", &p[i]);\n\n    pre();\n    gauss();\n\n    for (int i = 1; i <= n; ++i) printf(\"%.10lf \", f[i][i]);\n    \n    return 0;\n}\n```",
        "postTime": 1557564284,
        "uid": 119899,
        "name": "dsidsi",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    },
    {
        "content": "# CF113D \u9898\u89e3\n\n## \u9898\u76ee\u5927\u610f\n\n\u6709\u4e00\u4e2a\u65e0\u5411\u56fe\uff0c\u6709\u4e24\u4e2a\u4eba\u5728\u56fe\u4e0a\u4e92\u76f8\u5bfb\u627e\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u4eba\u5728\u7b2c $i$ \u4e2a\u70b9\uff0c\u90a3\u4e48\u4ed6\u6709 $p_i$ \u7684\u6982\u7387\u8fd9\u4e00\u5206\u949f\u505c\u7559\u5728\u8fd9\u4e2a\u70b9\uff0c\u6709 $1-p_i$ \u7684\u6982\u7387\u968f\u673a\u9009\u62e9\u4e00\u6761\u8fb9\u82b1\u8d39\u4e00\u5206\u949f\u8d70\u5230\u53e6\u4e00\u4e2a\u70b9\u3002\u5982\u679c\u4e24\u4e2a\u4eba**\u540c\u65f6\u4f4d\u4e8e\u540c\u4e00\u4e2a\u70b9**\uff0c\u90a3\u4e48\u5bfb\u627e\u7ed3\u675f\uff0c\u6c42\u5728\u6bcf\u4e2a\u70b9\u7ed3\u675f\u7684\u6982\u7387\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u4e24\u4e2a\u4eba\u5206\u522b\u5728\u70b9 $i$ \u548c\u70b9 $j$ \u8fd9\u79cd\u60c5\u51b5\u7684\u671f\u671b\u51fa\u73b0\u6b21\u6570\uff0c\u90a3\u4e48\u6613\u5f97\uff1a\n\n$$\\begin{cases}\n{f_{i,j}=\n\\sum\\limits_{(i,u)\\in G}\\!\n\\sum\\limits_{(j,v)\\in G}\\!\n\\frac{1-p_u}{deg_u}\\!\\frac{1-p_v}{deg_v}\\!f_{u,v}+\n\\sum\\limits_{(i,u)\\in G}\\!\n\\frac{1-p_u}{deg_u}\\!p_j\\!f_{u,j}+\n\\sum\\limits_{(j,v)\\in G}\\!\n\\frac{1-p_v}{deg_v}\\!p_i\\!f_{i,v}+\np_ip_jf_{i,j}+1}\n&i=a,j=b\\\\\n{f_{i,j}=\n\\sum\\limits_{(i,u)\\in G}\\!\n\\sum\\limits_{(j,v)\\in G}\\!\n\\frac{1-p_u}{deg_u}\\!\\frac{1-p_v}{deg_v}\\!f_{u,v}+\n\\sum\\limits_{(i,u)\\in G}\\!\n\\frac{1-p_u}{deg_u}\\!p_j\\!f_{u,j}+\n\\sum\\limits_{(j,v)\\in G}\\!\n\\frac{1-p_v}{deg_v}\\!p_i\\!f_{i,v}+\np_ip_jf_{i,j}}\n&otherwise\n\\end{cases}$$\n\n\uff08\u6ce8\u610f\u4efb\u4f55\u4e00\u4e2a $f_{i,i}$ \u90fd\u4e0d\u4f1a\u4ea7\u751f\u8d21\u732e\uff0c\u56e0\u4e3a\u5230\u4e86 $f_{i,i}$ \u5bfb\u627e\u5c31\u622a\u6b62\u4e86\u3002\uff09\n\n\u6bcf\u6b21\u90fd\u662f\u5bf9\u4e00\u7ec4\u70b9\u5bf9\u8fdb\u884c\u5904\u7406\u4f1a\u4e0d\u592a\u65b9\u4fbf\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a $(i,j)$ \u6362\u6210 $(i-1)\\times n+j$\u3002\n\n\u8fd9\u6837\u5c31\u5217\u51fa\u4e86 $n\\times n$ \u4e2a\u65b9\u7a0b\uff0c\u76f4\u63a5\u9ad8\u65af\u6d88\u5143\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^6)$\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\nusing namespace std;\nstruct edge\n{\n\tint to,next;\n}g[500];\nint n,m,x,y,num;\nint cnt,head[30],deg[30];\ndouble p[30],f[500][500];\nvoid add(int u,int v)\n{\n\tg[++cnt]=(edge){v,head[u]};\n\thead[u]=cnt;\n}\nint fun(int a,int b)\n{\n\treturn (a-1)*n+b;\n}\nvoid build()\n{\n\tfor(int a=1;a<=n;a++)\n\tfor(int b=1;b<=n;b++)\n\t{\n\t\tint u=fun(a,b);\n\t\tf[u][u]=-1;\n\t\tif(a!=b)f[u][u]+=p[a]*p[b];\n\t\tfor(int i=head[a];i;i=g[i].next)\n\t\tfor(int j=head[b];j;j=g[j].next)\n\t\t{\n\t\t\tint c=g[i].to,d=g[j].to;\n\t\t\tif(c==d)continue;\n\t\t\tint v=fun(c,d);\n\t\t\tf[u][v]=(1-p[c])/deg[c]*(1-p[d])/deg[d];\n\t\t}\n\t\tfor(int i=head[a];i;i=g[i].next)\n\t\t{\n\t\t\tint c=g[i].to;\n\t\t\tif(c==b)continue;\n\t\t\tint v=fun(c,b);\n\t\t\tf[u][v]=(1-p[c])/deg[c]*p[b];\n\t\t}\n\t\tfor(int j=head[b];j;j=g[j].next)\n\t\t{\n\t\t\tint d=g[j].to;\n\t\t\tif(a==d)continue;\n\t\t\tint v=fun(a,d);\n\t\t\tf[u][v]=p[a]*(1-p[d])/deg[d];\n\t\t}\n\t}\n\tf[fun(x,y)][num+1]=-1;\n}\nvoid gauss()\n{\n\tfor(int i=1;i<=num;i++)\n\t{\n\t\tint pos=i;\n\t\tfor(int j=i+1;j<=num;j++)\n\t\t\tif(fabs(f[j][i])>fabs(f[pos][i]))\n\t\t\t\tpos=j;\n\t\tswap(f[i],f[pos]);\n\t\tfor(int j=1;j<=num;j++)\n\t\t{\n\t\t\tif(i==j)continue;\n\t\t\tdouble div=f[j][i]/f[i][i];\n\t\t\tfor(int k=i;k<=num+1;k++)\n\t\t\t\tf[j][k]-=f[i][k]*div;\n\t\t}\n\t}\n\tfor(int i=1;i<=num;i++)\n\t\tf[i][num+1]/=f[i][i];\n}\nint main()\n{\n\tscanf(\"%d%d%d%d\",&n,&m,&x,&y);\n\tnum=n*n;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v),add(v,u);\n\t\tdeg[u]++,deg[v]++;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lf\",&p[i]);\n\tbuild();\n\tgauss();\n\tfor(int i=1;i<=n;i++)\n\t\tprintf(\"%.10lf \",f[fun(i,i)][num+1]);\n\treturn 0;\n}\n```\n\n\u8c22\u8c22\u89c2\u770b\uff01",
        "postTime": 1614316287,
        "uid": 241520,
        "name": "fanglong",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    },
    {
        "content": "N <= 22\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u641e\u4e00\u4e9b\u590d\u6742\u5ea6\u60ca\u4eba\u7684\u7b97\u6cd5\n\n\u8bbe$f_{i,j}$\u8868\u793a\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0cA\u5728i\uff0cB\u5728j\u7684\u671f\u671b\u6b21\u6570\n\n\u4e8e\u662f\u8f6c\u79fb\u65b9\u7a0b\u662f\u5341\u5206\u597d\u5217\u7684\uff1a\n\n\u8bbe$p_{a,b}$\u8868\u793a\u4ecea\u8d70\u5230b\u7684\u6982\u7387\n\n\u5219\u6709\uff1a\n\n$$\nf_{i,j}=\\sum_{a=1}^{N}\\sum_{b=1}^{N}p_{a,i}\\times p_{b,j}\\times f_{i,j}\n$$\n\n\u5f53\u7136\u6700\u521d\u72b6\u6001\u4e5f\u8981\u7b97\u4e0a\uff0c\u6240\u4ee5\u521d\u59cb\u4f4d\u7f6e\u671f\u671b\u6b21\u6570\u8981+1\n\n\u7136\u540e\u60a8\u6536\u83b7\u4e86\u4e00\u4e2a\u65e0\u9650\u9012\u5f52\u7684\u65b9\u7a0b\uff0c~~\u5927\u6982~~\u89e3\u4e0d\u51fa\u6765\n\n\u4e8e\u662f\u5c31\u4e0d\u53bb\u89e3\uff0c\u8003\u8651\u9ad8\u65af\u6d88\u5143\uff0c\u4e00\u5171$N^2$\u9879\uff0c\u603b\u590d\u6742\u5ea6$N^6$\n\n**\u7136\u800c\u80fd\u8fc7\u2026\u2026**\n\n--------\n\n## \u4f46\u662f\uff01\n\n> \u9ad8\u65af\u6d88\u5143\u592a\u96be\u4e86\uff0c\u4e0d\u4f1a\uff01\n\n\u600e\u4e48\u529e\n\n\u53ef\u4ee5\u7528\u76f4\u89c9\u770b\u51fa\u6765\uff0c\u8fd9\u4e2a\u65e0\u9650\u8fed\u4ee3\u7684\u5f0f\u5b50\u4f1a\u4e00\u70b9\u4e00\u70b9\u6536\u655b\uff0c\u800c\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u8ba9\u8fd9\u4e2a\u6536\u655b\u5230\u8bef\u5dee\u63a5\u8fd1\u4e8e0\n\n\u5148\u8003\u8651\u628a\u72b6\u6001\u90fd\u5b58\u8d77\u6765\uff1a$N^2$\u679a\u4e3e\u4e24\u4eba\u7684\u7f16\u53f7\u5e76\u8fdb\u884c\u6807\u53f7\uff0c\u8bbe\u72b6\u6001\u603b\u6570\u4e3a$M$\u3002\n\n\u8003\u8651\u8bbe$p_{i,a,b}$\u8868\u793a\u5728\u7b2c$i$\u6b65\u7531\u72b6\u6001$a$\u8f6c\u79fb\u81f3\u72b6\u6001$b$\u7684\u6982\u7387\n\n\u8f6c\u79fb\u65b9\u7a0b\u5f88\u663e\u7136\uff1a\n\n$$\np_{i,a,b}=\\sum_{k=1}^{M}p_{i-1,a,k}\\times p_{i-1,k,b}\n$$\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u5c31\u662f\u4e2a\u77e9\u9635\u81ea\u5df1\u4e58\u4ee5\u81ea\u5df1\n\n\u8003\u8651\u8ba9\u5b83\u81ea\u5df1\u4e58\u4e2a$2^{30}$\u904d\uff0c\u8bef\u5dee\u5c31\u4f1a\u5f88\u5c0f\u5f88\u5c0f\uff0c\u628a\u6700\u7ec8\u7b54\u6848\u8f93\u51fa\u5c31\u884c\uff08\n\n\u590d\u6742\u5ea6$N^6\\times30$\uff0c\u7b97\u4e86\u4e00\u4e0b\u6709\u4e9b\u60ac\n\n\u4f46\u662fCF\u8bc4\u6d4b\u673a\u5341\u5206\u5f3a\u5927\uff0c\u62ffC++17(64\u4f4d)\u5c45\u7136\u8fc7\u4e86\u2026\u2026\n\n~~\u4f46\u662fRemoteJudge\u5e76\u4e0d\u652f\u6301C++17(64\u4f4d)~~\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ndouble ls[700][700];\nint head[50], nxt[700], to[700], tot;\nint qwq;\nint du[1000];\nint id[1000][1000];\nstruct hehe{\n    double p[700][700];\n}a[51];\ndouble p[50];\nvoid jc(int x, int y)\n{\n    for(int i = 1; i <= qwq; i++)\n    {\n        for(int j = 1; j <= qwq; j++)\n        {\n            for(int k = 1; k <= qwq; k++)\n            {\n                ls[i][k] += a[y].p[i][j] * a[y].p[j][k];\n            }\n        }\n    }\n    for(int i = 1; i <= qwq; i++)for(int j = 1; j <= qwq; j++) a[x].p[i][j] = ls[i][j], ls[i][j] = 0;\n}\nvoid add(int x, int y)\n{\n    nxt[++tot] = head[x];\n    head[x] = tot;\n    to[tot] = y;\n}\nint main()\n{\n    int n, m;\n    cin >> n >> m;\n    int fr, frr;\n    cin >> fr >> frr;\n    for(int i = 1; i <= m; i++)\n    {\n        int x, y;\n        cin >> x >> y;\n        add(x, y);\n        add(y, x);\n        du[x]++;\n        du[y]++;\n    }\n    for(int i = 1; i <= n; i++)\n    {\n        for(int j = i; j <= n; j++)\n        {\n            id[j][i] = id[i][j] = ++qwq;//\u56e0\u4e3a\u4e24\u4e2a\u4eba\u662f\u76f8\u540c\u7684\u6240\u4ee5\u987a\u5e8f\u65e0\u6240\u8c13\n        }\n    }\n    for(int i = 1; i <= n; i++) cin >> p[i], a[0].p[id[i][i]][id[i][i]] = 1;\n    for(int i = 1; i <= n; i++)\n    {\n        for(int j = i + 1; j <= n; j++)\n        {\n            double p1 = p[i], p2 = p[i] * p[j];\n            a[0].p[id[i][j]][id[i][j]] += p2;\n            for(int k = head[i]; k; k = nxt[k])\n            {\n                int y = to[k];\n                a[0].p[id[i][j]][id[y][j]] += (1 - p[i]) / du[i] * p[j];\n                for(int l = head[j]; l; l = nxt[l])\n                {\n                    int yy = to[l];\n                    a[0].p[id[i][j]][id[y][yy]] += (1 - p[i]) / du[i] * (1 - p[j]) / du[j];\n                }\n            }\n            for(int k = head[j]; k; k = nxt[k])\n            {\n                int y = to[k];\n                a[0].p[id[i][j]][id[i][y]] += p[i] * (1 - p[j]) / du[j];\n            }\n        }\n    }\n    for(int i = 1; i <= 30; i++) jc(i, i - 1);\n    // for(int c = 1; c <= 50; c++)for(int i = 1; i <= n; i++) for(int ii = 1; ii <= n; ii++) for(int iii = 1; iii <= n; iii++) for(int iiii = 1;  iiii <= n; iiii++) cout << i << ' ' << ii << ' ' << iii << ' ' << iiii << ' ' << a[c].p[id[i][ii]][id[iii][iiii]] << endl;\n    for(int i = 1; i <= n; i++) printf(\"%.10f \", a[30].p[id[fr][frr]][id[i][i]]);\n}\n\n```",
        "postTime": 1609757840,
        "uid": 75954,
        "name": "AuCloud",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    },
    {
        "content": "#### \u9898\u610f\u7b80\u8ff0\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a\u65e0\u5411\u56fe\uff0c\u4ece$a$\u8282\u70b9\u548c$b$\u8282\u70b9\u5f00\u59cb\u968f\u673a\u6e38\u8d70\uff0c\u8d70\u5230\u6bcf\u4e2a\u70b9\u65f6\u6709\u4e24\u79cd\u53ef\u80fd\uff0c\u5728\u7b2c$i$\u4e2a\u70b9\u6709$p_i$\u7684\u53ef\u80fd\u505c\u4e0b\uff0c\u6216\u8005\u968f\u673a\u627e\u4e00\u6761\u51fa\u8fb9\u51fa\u53bb\uff0c\u4e24\u4e2a\u70b9\u8d70\u5230\u540c\u4e00\u4e2a\u70b9\u65f6\u505c\u6b62\u3002\n\n\u5206\u6790\uff1a\n\n\u542c\u8bf4\u6b63\u89e3\u662f\u9ad8\u65af\u6d88\u5143\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u7384\u5b66\u505a\u6cd5\u3002\n\n\u7531\u4e8e\u65f6\u95f4\u6ee1\u8db3\u5355\u8c03\u6027\uff0c\u56e0\u6b64\u5bb9\u6613\u60f3\u5230\u4e00\u79cd$dp$\u3002\n\n\u8bbe$f(i,x,y)$\u8868\u793a\uff0c\u7b2c$i$\u8f6e\u6e38\u8d70\uff0c\u7b2c$1$\u4e2a\u4eba\u505c\u5728\u4e86$x$\u53f7\u8282\u70b9\uff0c\u7b2c$2$\u4e2a\u4eba\u505c\u5728\u4e86$y$\u53f7\u8282\u70b9\u7684\u6982\u7387\u3002\n\n\u8f6c\u79fb\u5f88\u7b80\u5355\uff0c\u6709\u56db\u79cd\u60c5\u51b5\uff0c\u7b2c\u4e00\u4e2a\u4eba\u8d70/\u4e0d\u8d70\u3001\u7b2c\u4e8c\u4e2a\u4eba\u8d70/\u4e0d\u8d70\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(TN^4)$\uff0c\u5176\u4e2d$T$\u8868\u793a\u6e38\u8d70\u6b21\u6570\u3002\n\n\u95ee\u9898\u5c31\u662f\u8fd9\u4e2a$T$\u8be5\u53d6\u591a\u5c11\u3002\n\n\u9996\u5148\uff0c\u80af\u5b9a\u662f$T$\u53d6\u7684\u8d8a\u5927\uff0c\u7ed3\u679c\u8d8a\u7cbe\u786e\uff0c\u6ce8\u610f\u5230\u6709$10^{-6}$\u7684\u53ef\u63a5\u53d7\u8bef\u5dee\uff0c\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u53d6\u4e00\u4e2a\u5e38\u6570\u3002\n\n\u4f46\u5e38\u6570\u8fc7\u5927\u8fd9\u6837\u4f1a$TLE$\uff0c\u6ce8\u610f\u5230\u5982\u679c\u5f53\u524d\u72b6\u6001\u7684\u6982\u7387\u8fc7\u5c0f\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u5bf9\u540e\u7eed\u72b6\u6001\u4ea7\u751f\u975e\u5e38\u5927\u7684\u5f71\u54cd\u4e86\uff0c\u56e0\u6b64\u53ef\u4ee5\u8bbe\u4e00\u4e2a$eps$\u503c\uff0c\u5f53\u5f53\u524d\u72b6\u6001\u6982\u7387$\\leq eps$\u65f6\u5c31\u4e0d\u8ba1\u7b97\u8fd9\u4e2a\u72b6\u6001\u7684\u8d21\u732e\u4e86\u3002\n\n\u7ecf\u8fc7\u4f5c\u8005\u591a\u6b21\u8c03\u53c2\uff0c\u53d1\u73b0$T=150000,eps=1e^{-30}$\u65f6\u53ef\u4ee5\u901a\u8fc7\u3002\n",
        "postTime": 1609752577,
        "uid": 179600,
        "name": "shao0320",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    },
    {
        "content": "\u8bb0 $S(u)$ \u8868\u793a $u$ \u7ed3\u70b9\u7684\u76f8\u90bb\u7ed3\u70b9\u7684\u96c6\u5408\u3002\n\n\u53c8\u8bb0 $p(u)$ \u8868\u793a\u8d70\u5230\u4e86 $u$ \u4e14\u4e0b\u4e00\u6b65\u7ee7\u7eed\u7559\u5728 $u$ \u7ed3\u70b9\u7684\u6982\u7387\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b65\u79bb\u5f00 $u$ \u7ed3\u70b9\u7684\u6982\u7387\u5373\u4e3a $1 - p(u)$\u3002\n\n\u8bbe $f(i, j)$ \u8868\u793a Petya \u5728 $i$ \u4e14 Vasya \u5728 $j$ \u7684\u6982\u7387\u3002\n\n\u53ef\u77e5\u6240\u6709\u7684\u5f62\u5982 $f(i, i)$ \u7684\u72b6\u6001\u90fd\u662f\u4e0d\u80fd\u7528\u4e8e\u8f6c\u79fb\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u5df2\u7ecf\u662f\u672b\u72b6\u6001\u4e86\u3002\n\n\u6545\u6709\n\n$$f(i, j) = \\sum_{k \\in S(i), k \\neq j} f(k, j) \\times \\frac{1 - p(k)} {|S(k)|} \\times p(j) + \\sum_{k \\in S(j), k \\neq i} f(i, k) \\times \\frac{1 - p(k)} {|S(k)|} \\times p(i) + \\sum_{u \\in S(i), v \\in S(j), u \\neq v} f(u, v) \\times \\frac{1 - p(u)} {|S(u)|} \\times \\frac{1 - p(v)} {|S(v)|}$$\n\n\u663e\u7136\u8fd9\u4e2a\u8f6c\u79fb\u662f\u6709\u540e\u6548\u6027\u7684\uff0c\u65e0\u6cd5\u7528\u7b80\u5355\u7684\u9012\u63a8\u505a\u3002\n\n\u6545\u8003\u8651\u9ad8\u65af\u6d88\u5143\uff0c\u5c06\u8be5\u5f0f\u8f6c\u6362\u4e3a\u6211\u4eec\u719f\u6089\u7684\u65b9\u7a0b\u5f62\u5f0f\u8fdb\u884c\u6c42\u89e3\u5373\u53ef\u3002\n\n\u5171\u6709 $n ^ 2$ \u53ea\u65b9\u7a0b\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n ^ 6)$\u3002\n\n\u6ce8\u610f\u8fb9\u754c\u6761\u4ef6\uff0c\u5373\u521d\u59cb\u72b6\u6001\u65f6\uff0c\u8f6c\u79fb\u5f0f\u9700\u8981\u52a0 $1$\uff0c\u611f\u6027\u7406\u89e3\u4e00\u4e0b\u3002\n\n```cpp\n#include <cstdio>\n#include <vector>\nusing namespace std;\n\nint Abs(int x) { return x < 0 ? -x : x; }\nint Max(int x, int y) { return x > y ? x : y; }\nint Min(int x, int y) { return x < y ? x : y; }\n\nint read() {\n    int x = 0, k = 1;\n    char s = getchar();\n    while (s < '0' || s > '9') {\n        if (s == '-')\n            k = -1;\n        s = getchar();\n    }\n    while ('0' <= s && s <= '9') {\n        x = (x << 3) + (x << 1) + (s ^ 48);\n        s = getchar();\n    }\n    return x * k;\n}\n\nvoid write(int x) {\n    if (x < 0) {\n        putchar('-');\n        x = -x;\n    }\n    if (x > 9)\n        write(x / 10);\n    putchar(x % 10 + '0');\n}\n\nvoid print(int x, char c) {\n    write(x);\n    putchar(c);\n}\n\nconst int MAXN = 23 * 23 + 5;\n\nstruct Elimination {\n    bool free[MAXN];\n    int n, m, rk, opt;\n    double a[MAXN][MAXN], eps;\n    Elimination() { eps = 1e-15; }\n    Elimination(int N, int M) {\n        n = N;\n        m = M;\n    }\n    double Abs(double x) { return x < eps ? -x : x; }\n    void Swap(double &x, double &y) {\n        double t = x;\n        x = y;\n        y = t;\n    }\n\n    void clear() {\n        for (int i = 1; i <= n; i++)\n            for (int j = 1; j <= m; j++) a[i][j] = 0;\n    }\n\n    void calc() {\n        int r = 1, c = 1;\n        for (; r <= n && c <= m; r++, c++) {\n            int pos = r;\n            for (int i = r + 1; i <= n; i++)\n                if (Abs(a[i][c]) > Abs(a[pos][c]))\n                    pos = i;\n            if (Abs(a[pos][c]) < eps) {\n                r--;\n                continue;\n            }\n            if (pos != r)\n                for (int i = c; i <= m; i++) Swap(a[r][i], a[pos][i]);\n            double t;\n            for (int i = 1; i <= n; i++)\n                if (i != r && Abs(a[i][c]) > eps) {\n                    t = a[i][c] / a[r][c];\n                    for (int j = m; j >= c; j--) a[i][j] -= t * a[r][j];\n                }\n        }\n        rk = r;\n    }\n};\n\nint deg[MAXN];\ndouble p[MAXN];\nvector<int> mp[MAXN];\n\nvoid Add_Edge(int u, int v) {\n    mp[u].push_back(v);\n    mp[v].push_back(u);\n}\n\nstruct node {\n    int x, y;\n    node() {}\n    node(int X, int Y) {\n        x = X;\n        y = Y;\n    }\n    int Get(int n) { return (x - 1) * n + y; }\n};\n\nint main() {\n    int n = read(), m = read(), x = read(), y = read();\n    for (int i = 1, u, v; i <= m; i++) {\n        u = read(), v = read();\n        Add_Edge(u, v);\n        deg[u]++, deg[v]++;\n    }\n    for (int i = 1; i <= n; i++) scanf(\"%lf\", &p[i]);\n    Elimination q;\n    q.n = n * n;\n    q.m = q.n + 1;\n    q.clear();\n    q.a[node(x, y).Get(n)][q.m] = -1;\n    for (int i = 1; i <= n; i++)\n        for (int j = 1; j <= n; j++) {\n            int pos = node(i, j).Get(n);\n            q.a[pos][pos]--;\n            if (i != j)\n                q.a[pos][pos] += p[i] * p[j];\n            for (size_t k1 = 0; k1 < mp[i].size(); k1++)\n                for (size_t k2 = 0; k2 < mp[j].size(); k2++) {\n                    int u = mp[i][k1], v = mp[j][k2];\n                    if (u == v)\n                        continue;\n                    q.a[pos][node(u, v).Get(n)] += (1 - p[u]) * (1 - p[v]) / deg[u] / deg[v];\n                }\n            for (size_t k = 0; k < mp[i].size(); k++)\n                if (mp[i][k] != j)\n                    q.a[pos][node(mp[i][k], j).Get(n)] += (1 - p[mp[i][k]]) / deg[mp[i][k]] * p[j];\n            for (size_t k = 0; k < mp[j].size(); k++)\n                if (mp[j][k] != i)\n                    q.a[pos][node(i, mp[j][k]).Get(n)] += (1 - p[mp[j][k]]) / deg[mp[j][k]] * p[i];\n        }\n    q.calc();\n    for (int i = 1; i <= n; i++)\n        printf(\"%.9f\\n\", q.a[node(i, i).Get(n)][q.m] / q.a[node(i, i).Get(n)][node(i, i).Get(n)]);\n    return 0;\n}\n```",
        "postTime": 1634353219,
        "uid": 266779,
        "name": "STrAduts",
        "ccfLevel": 6,
        "title": "CF113D"
    },
    {
        "content": "![](https://cdn.luogu.com.cn/upload/pic/40872.png)\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <vector>\n#include <inttypes.h>\n#include <iomanip>\n#define debug(x) std::cout << #x << \" = \" << x << std::endl;\n\ntypedef int int_t;\ntypedef long double real_t;\nconst int_t LARGE = 22;\n\nconst real_t EPS = 1e-6;\n\nusing std::cin;\nusing std::endl;\nusing std::cout;\n\nreal_t mat[501][501];\n\nbool graph[23][23];\nint_t degree[LARGE + 1];\nreal_t prob[LARGE + 1];\nint_t n,m,a,b;\ntemplate<class T>\nT xabs(T x) {\n\tif(x<0) return -x;\n\treturn x;\n}\nint_t encode(int_t a,int_t b) {\n//\tcout<<\"encode \"<<a<<\" \"<<b<<\" to \"<< n * (a - 1) + b - ((a>b)?(a-1):a)<<endl;\n\treturn n * (a - 1) + b - ((a>b)?(a-1):a);\n}\nreal_t cost(int_t i,int_t j ,int_t x,int_t y) {\n\treal_t result = 0;\n\tif(i == x && j == y) result = prob[i] * prob[j];\n\tif(i == x && j != y) {\n\t\tresult = prob[i] * (1 - prob[j]) * (1.0 / degree[j]) * graph[j][y];\n\t}\n\tif(i != x && j == y) result = (1 - prob[i]) * (1.0 / degree[i]) * graph[i][x] * prob[j];\n\tif(i != x && j != y) result = (1 - prob[i]) * (1.0 / degree[i]) * graph[i][x] * (1 - prob[j]) * (1.0 / degree[j]) * graph[j][y];\n\treturn result;\n}\nint main() {\n\tcin >> n >> m >> a >> b;\n\tif(a == b) {\n\t\tfor(int_t i=1; i<=n; i++) {\n\t\t\tif(i==a) cout<<1<<\" \";\n\t\t\telse cout<<0<<\" \";\n\t\t}\n\t\treturn 0;\n\t}\n\tfor(int_t i = 1; i <= m; i++) {\n\t\tint_t from,to;\n\t\tcin >> from >> to;\n\t\tgraph[from][to] = graph[to][from] = 1;\n\t\tdegree[from] += 1;\n\t\tdegree[to] += 1;\n\t}\n\tfor(int_t i = 1 ; i <= n; i++) {\n\t\tcin >> prob[i];\n\t}\n\tint_t len = n * n - n;\n\tfor(int_t i = 1 ; i <= n; i++) {\n\t\tfor(int_t j = 1; j<= n ; j++) {\n\t\t\tif(i == j) continue;\n\t\t\tint_t curr = encode(i,j);\n\t\t\tmat[curr][curr] = -1;\n\t\t\tfor(int_t x = 1 ; x <= n; x++) {\n\t\t\t\tfor(int_t y = 1; y <= n ; y++) {\n\t\t\t\t\tif(x == y) {\n\t\t\t\t\t\tmat[curr][len + x] -= cost(i,j,x,y);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmat[curr][encode(x,y)] += cost(i,j,x,y);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int_t i = 1; i <= len; i++) {\n\t\tif(xabs(mat[i][i]) < EPS) {\n\t\t\tint_t pos = -1;\n\t\t\tfor(int_t j = i + 1; j <= len ; j++) {\n\t\t\t\tif(xabs(mat[j][i]) >= EPS) {\n\t\t\t\t\tpos = j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(pos != -1) {\n\t\t\t\tstd::swap(mat[i],mat[pos]);\n\t\t\t} else {\n\t\t\t\tcout <<\" exm ?? \"<< endl;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tfor(int_t j = i + 1; j <= len ; j++) {\n\t\t\treal_t f = mat[j][i] / mat[i][i];\n\t\t\tfor(int_t k = i ; k <= n * n; k++) {\n\t\t\t\tmat[j][k] -= f* mat[i][k];\n\t\t\t}\n\t\t}\n\t}\n\tfor(int_t i = len ; i >=1 ; i--) {\n\t\treal_t f = mat[i][i];\n\t\tfor(int_t j = len + 1; j <= n * n ; j++) {\n\t\t\tmat[i][j] /= f;\n\t\t}\n\t\tmat[i][i] /= f;\n\t\tfor(int_t j = i - 1; j >= 1; j--) {\n\t\t\treal_t f2 =  mat[j][i];\n\t\t\tmat[j][i] = 0;\n\t\t\tfor(int_t k = len + 1; k<= n * n; k++) {\n\t\t\t\tmat[j][k] -= f2 * mat[i][k];\n\t\t\t}\n\t\t}\n\t}\n//\tprint();\n\tfor(int_t i = 1; i <= n; i++) {\n\t\tcout.setf(std::ios::fixed);\n\t\tcout << std::setprecision(10) << mat[encode(a,b)][len + i] << \" \";\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1540900812,
        "uid": 56891,
        "name": "officeyutong",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    },
    {
        "content": "# CF113D Museum \u9898\u89e3\n\n\u9996\u9ed1\u796d\u3002\n\n---\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u9ad8\u65af\u6d88\u5143\u3002\n\n---\n## \u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u5f00\u59cb\u65f6\u4e24\u4e2a\u4eba\u5728\u5176\u4e2d\u4e24\u4e2a\u7ed3\u70b9\u4e0a\uff0c\u4eba\u5728\u6bcf\u4e2a\u70b9\u4e0a\u5206\u522b\u6709\u4e00\u5b9a\u7684\u6982\u7387\u7559\u5728\u539f\u5730\uff0c\u6216\u8005\u7b49\u6982\u7387\u5f97\u968f\u673a\u901a\u8fc7\u7ed3\u70b9\u8fde\u63a5\u7684\u4e00\u6761\u8fb9\u8d70\u5411\u53e6\u4e00\u4e2a\u7ed3\u70b9\u3002\u6c42\u4e24\u4eba\u5728\u6bcf\u4e00\u4e2a\u7ed3\u70b9\u76f8\u9047\u7684\u6982\u7387\u3002\n\n## \u5206\u6790\n\n\u8bbe $g[i][j][k]$ \u8868\u793a\u8d70 $i$ \u6b65\u540e\u4e24\u4eba\u5206\u522b\u5728 $j,k$ \u65f6\u7684\u6982\u7387, $deg_x$ \u8868\u793a\u7ed3\u70b9 $x$ \u7684\u5ea6\u6570\u3002\n\n\u5bb9\u6613\u5217\u51fa\u5982\u4e0b dp \u65b9\u7a0b:\n\n$$\n\\begin{gathered}\ng[i][j][k]=g[i-1][j][k]\n\\cdot p_j \\cdot p_k\n\\\\\n+\\sum_{x\\rightarrow j}g[i-1][x][k]\\cdot (1-p_x)\\cdot p_k\\cdot \\dfrac 1{deg_x}\n\\\\\n+\\sum_{y\\rightarrow k}g[i-1][j][y]\\cdot p_j\\cdot (1-p_y)\\cdot\\dfrac1{deg_y}\n\\\\\n+\\sum_{x\\rightarrow j,y\\rightarrow k}\ng[i-1][x][y]\\cdot(1-p_x)\\cdot(1-p_y)\\cdot\\dfrac1{deg_x\\cdot deg_y}\n\\end{gathered}\n$$\n\n\u8bbe $f[i][j]$ \u8868\u793a\u4e24\u4e2a\u4eba\u5206\u522b\u5728 $i,j$ \u7684\u603b\u7684\u6982\u7387\u3002\n$$\nf[j][k]=\\sum_{i=1}^{\\infty}g[i][j][k]\n$$\n\u8fd9\u5e76\u4e0d\u597d\u6c42\uff0c\u4f46\u6211\u4eec\u6ce8\u610f\u5230\u5bf9\u4e8e\u76f8\u540c\u7684 $j,k$ \uff0c $g[i][j][k]$ \u7684\u503c\u53ea\u4e0e $i$ \u6709\u5173\uff0c\u5219\u5f53\u6211\u4eec\u6c42\u548c\u81f3\u65e0\u7a77\u65f6\uff0c\u53ef\u4ee5\u628a\u6240\u6709\u7684 $g$ \u4e5f\u540c\u65f6\u7d2f\u52a0\u81f3\u65e0\u7a77\uff0c\u8fd9\u6837\u5173\u4e8e $g$ \u7684\u5f0f\u5b50\u5c31\u8f6c\u5316\u4e3a\uff1a\n$$\n\\begin{gathered}\nf[j][k]=f[j][k]\\cdot p_j\\cdot p_k\n\\\\\n+\\sum_{x\\rightarrow j}f[x][k]\\cdot (1-p_x)\\cdot p_k\\cdot \\dfrac 1{deg_x}\n\\\\\n+\\sum_{y\\rightarrow k}f[j][y]\\cdot p_j\\cdot (1-p_y)\\cdot\\dfrac1{deg_y}\n\\\\\n+\\sum_{x\\rightarrow j,y\\rightarrow k}\nf[x][y]\\cdot(1-p_x)\\cdot(1-p_y)\\cdot\\dfrac1{deg_x\\cdot deg_y}\n\\\\\n+[j=s\\land k=t]\n\\end{gathered}\n$$\n\n\u5176\u4e2d\u6700\u540e\u4e00\u9879\u7684 $[j=s\\land k=t]$ \u4e2d $s,t$ \u5206\u522b\u8868\u793a\u4e24\u4e2a\u8d77\u70b9\u3002\u56e0\u4e3a  $g[0][s][t]=1$ , $g[0][j][k]=0\\ ,\\  (j,k)\\neq (s,t)$ \u3002 \u6211\u4eec\u7684 $f[s][t]$ \u9700\u989d\u5916\u52a0\u4e0a\u5b83\uff0c\u6545\u4ea7\u751f\u4e86\u6700\u540e\u4e00\u9879\u3002\n\n\u7136\u540e\u7531\u4e8e\u8fd9\u9898 $n$ \u5de8\u5c0f $(n\\leq 22)$ \uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8dd1\u4e00\u904d $O((n^2)^3)$ \u7684\u9ad8\u65af\u6d88\u5143\u5bf9\u6240\u6709\u7684 $f$ \u8fdb\u884c\u6c42\u89e3\u3002\n\n**\u6ce8\u610f\u5b9e\u73b0\u65f6\u5f53 $i=j$ \u65f6\uff0c\u8868\u8fbe\u5f0f\u7b2c\u4e00\u9879\u5e94\u5199\u4f5c $f[j][k]$ \u800c\u4e0d\u5e94\u4e58\u4e0a\u4e24\u4e2a\u6982\u7387\uff0c\u56e0\u4e3a\u76f8\u9047\u65f6\u4e0d\u4f1a\u7ee7\u7eed\u8f6c\u79fb\u800c\u662f\u7559\u5728\u539f\u5730\u3002**\n\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include <bits/stdc++.h>\n#define rint register int\n#define fu(i, a, b, d, c) for (rint i = a; i <= (b) && c; i += d)\n#define fd(i, a, b, d, c) for (rint i = a; i >= (b) && c; i -= d)\nusing namespace std;\ninline int read()\n{\n    char c = 0, f = 1;\n    int num = 0;\n    while (c < '0' || c > '9' && c != '-')\n        ((c = getchar()) == '-') && (f = -f);\n    while (c >= '0' && c <= '9')\n        num = (num << 1) + (num << 3) + (c ^ 48), c = getchar();\n    return num * f;\n}\nint n, m, s, t;\nconst int MAXN = 30, MAXM = 900;\nint head[MAXN], nxt[MAXM * 2], to[MAXM * 2], cnt;\nvoid add(int u, int v) { nxt[++cnt] = head[u], head[u] = cnt, to[cnt] = v; }\ndouble p[MAXN], a[MAXN * MAXN][MAXN * MAXN], b[MAXN * MAXN];\nint getid(int x, int y) { return (x - 1) * n + y; } //\u83b7\u5f97\u6bcf\u4e2a\u72b6\u6001\u7684\u7f16\u53f7\nint deg[MAXN];\nsigned main()\n{\n    n = read(), m = read(), s = read(), t = read();\n    fu(i, 1, m, 1, 1)\n    {\n        int u = read(), v = read();\n        add(u, v), add(v, u);\n        deg[u]++, deg[v]++;     //\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u5ea6\u6570\n    }\n    fu(i, 1, n, 1, 1) scanf(\"%lf\", &p[i]);\n    fu(i, 1, n, 1, 1)\n    {\n        fu(j, 1, n, 1, 1)\n        {\n            int idnow = getid(i, j);\n            if (i == j)     //\u6ce8\u610f : \u5f53 i == j \u65f6\u4e0d\u5e94\u4e58\u4ee5\u505c\u7559\u7684\u6982\u7387\uff0c\u56e0\u4e3a\u6b64\u65f6\u4e0d\u4f1a\u7ee7\u7eed\u79fb\u52a8\u8fdb\u884c\u8f6c\u79fb\n                a[idnow][idnow] = 1.0f;\n            else\n                a[idnow][idnow] = 1.0f - p[i] * p[j];\n            // \u5982\u9898\u89e3\u5f0f\u5b50\u6240\u793a\n            for (int k = head[i]; k; k = nxt[k])    \n                if (to[k] != j)\n                    a[idnow][getid(to[k], j)] += -(1.0f - p[to[k]]) * p[j] / double(deg[to[k]]);\n            \n            for (int k = head[j]; k; k = nxt[k])\n                if (to[k] != i)\n                    a[idnow][getid(i, to[k])] += -(1.0f - p[to[k]]) * p[i] / double(deg[to[k]]);\n            \n            for (int x = head[i]; x; x = nxt[x])\n                for (int y = head[j]; y; y = nxt[y])\n                {\n                    if (to[x] != to[y])\n                        a[idnow][getid(to[x], to[y])] += -(1.0f - p[to[x]]) * (1.0f - p[to[y]]) / double(deg[to[x]]) / double(deg[to[y]]);\n                }\n        }\n    }\n    b[getid(s, t)] = 1;  //\u72b6\u6001 f[s][t] \u9700\u989d\u5916\u52a0\u4e0a 1\n    int n1 = n * n;     //\u679a\u4e3e n*n \u4e2a\u72b6\u6001\n\n    //\u9ad8\u65af\u6d88\u5143\u677f\u5b50\n    fu(i, 1, n1, 1, 1)\n    {\n        fu(j, i, n1, 1, 1)\n        {\n            if (a[j][i] > 1e-8)\n            {\n                fu(t, 1, n1, 1, 1) swap(a[i][i], a[j][i]);\n                swap(b[i], b[j]);\n                break;\n            }\n        }\n        fu(j, 1, n1, 1, 1)\n        {\n            if (j == i)\n                continue;\n            double rate = -a[j][i] / a[i][i];\n            fu(t, 1, n1, 1, 1) a[j][t] += rate * a[i][t];\n            b[j] += rate * b[i];\n        }\n    }\n    fu(i, 1, n, 1, 1) printf(\"%lf \", b[getid(i, i)] / a[getid(i, i)][getid(i, i)]);\n}\n\n```",
        "postTime": 1629112443,
        "uid": 218517,
        "name": "Mr_H2T",
        "ccfLevel": 0,
        "title": "CF113D Museum \u9898\u89e3"
    },
    {
        "content": "$f_{i,j}$\uff1a\u4e24\u4eba\u5206\u522b\u5728\u623f\u95f4 $i,j$ \u7684\u6982\u7387\u3002\u521d\u59cb\u72b6\u6001 $f_{a,b}=1$\n\n$$f_{i,j}=p_ip_jf_{i,j}+\\sum_{(i,u) \\in E}\\sum_{(j,v) \\in E} \\frac{1-p_u}{\\deg_u} \\frac{1-p_v}{\\deg_v}f_{u,v}$$\n\n$$+\\sum_{(i,u) \\in E} \\frac{1-p_u}{\\deg_u} p_jf_{u,j}+\\sum_{(j,v) \\in E} p_i\\frac{1-p_v}{\\deg_v} f_{i,v}$$\n\n\u6ce8\u610f\u5f53\u540e\u7ee7\u72b6\u6001\u7684 $u=v$ \u76f8\u7b49\u65f6\u4e0d\u80fd\u8f6c\u79fb\u3002\u623f\u95f4 $i$ \u76f8\u9047\u7684\u6982\u7387\u5373\u4e3a $f_{i,i}$\u3002\n\n\u76f4\u63a5\u9ad8\u65af\u6d88\u5143\u5373\u53ef,\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^6)$ \u3002\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <iostream>\nusing namespace std;\n#define eps 1e-8\n\ntemplate<typename _T>\nvoid Read( _T &x ) {\n\tx = 0; char s = getchar();\n\tfor( ; s < '0' || s > '9' ; s = getchar() );\n\tfor( ; s >= '0' && s <= '9' ; s = getchar() ) x = x * 10 + s - '0';\n}\ntemplate<typename _T>\nvoid Write( _T x ) {\n\tif( x >= 10 ) Write( x / 10 );\n\tputchar( x % 10 + '0' ); \n}\n\nconst int MAXN = 22;\nint n , m , w , deg[ MAXN + 5 ]; double p[ MAXN + 5 ];\nbool Graph[ MAXN + 5 ][ MAXN + 5 ];\n\ndouble a[ MAXN * MAXN + 5 ][ MAXN * MAXN + 5 ];\n\nint hs( int x , int y ) { return ( x - 1 ) * n + y; }\nvoid print( ) {\n\tprintf(\"------\");\n\tfor( int i = 1 ; i <= w ; i ++ )\n\t\tfor( int j = 1 ; j <= w + 1 ; j ++ )\n\t\t\tprintf(\"%.2f%c\", a[ i ][ j ] , j == w + 1 ? '\\n' : ' ' );\n\tprintf(\"--------\");\n}\n\nvoid Gauss( ) {\n\tfor( int i = 1 ; i <= w ; i ++ ) {\n\t\tint pos = i;\n\t\tfor( int j = i + 1 ; j <= w ; j ++ )\n\t\t\tif( fabs( a[ j ][ i ] ) > fabs( a[ pos ][ i ] ) ) pos = j;\n\t\tswap( a[ pos ] , a[ i ] );\n\t\tif( fabs( a[ i ][ i ] ) < eps ) continue;\n\t\tfor( int j = 1 ; j <= w ; j ++ )\n\t\t\tif( i != j ) {\n\t\t\t\tdouble d = a[ j ][ i ] / a[ i ][ i ];\n\t\t\t\tfor( int k = i ; k <= w + 1 ; k ++ )\n\t\t\t\t\ta[ j ][ k ] -= a[ i ][ k ] * d;\n\t\t\t}\n\t}\n\tfor( int i = 1 ; i <= w ; i ++ ) a[ i ][ m + 1 ] /= a[ i ][ i ];\n}\n\nint x , y;\nint main( ) {\n\tscanf(\"%d %d %d %d\",&n,&m,&x,&y);\n\tfor( int i = 1 , u , v ; i <= m ; i ++ ) {\n\t\tscanf(\"%d %d\",&u,&v); deg[ u ] ++ , deg[ v ] ++;\n\t\tGraph[ u ][ v ] = Graph[ v ][ u ] = 1;\n\t}\n\tfor( int i = 1 ; i <= n ; i ++ ) scanf(\"%lf\",&p[ i ]);\n\t\n\tw = n * n;\n\ta[ hs( x , y ) ][ w + 1 ] = 1;\n\tfor( int i = 1 ; i <= n ; i ++ )\n\t\tfor( int j = 1 ; j <= n ; j ++ ) {\n\t\t\ta[ hs( i , j ) ][ hs( i , j ) ] = 1 - ( i == j ? 0 : p[ i ] * p[ j ] ); \n\t\t\tfor( int u = 1 ; u <= n ; u ++ )\n\t\t\t\tfor( int v = 1 ; v <= n ; v ++ )\n\t\t\t\t\tif( u != v && Graph[ i ][ u ] && Graph[ j ][ v ] )\n\t\t\t\t\t\ta[ hs( i , j ) ][ hs( u , v ) ] = - ( 1 - p[ u ] ) / deg[ u ] * ( 1 - p[ v ] ) / deg[ v ]; \n\t\t\tfor( int u = 1 ; u <= n ; u ++ )\n\t\t\t\tif( u != j && Graph[ i ][ u ] )\n\t\t\t\t\ta[ hs( i , j ) ][ hs( u , j ) ] = - ( 1 - p[ u ] ) / deg[ u ] * p[ j ]; \n\t\t\tfor( int v = 1 ; v <= n ; v ++ )\n\t\t\t\tif( i != v && Graph[ j ][ v ] )\n\t\t\t\t\ta[ hs( i , j ) ][ hs( i , v ) ] = - p[ i ] * ( 1 - p[ v ] ) / deg[ v ]; \n\t\t}\n\t\n\tGauss();\n\tfor( int i = 1 ; i <= n ; i ++ ) printf(\"%.9f\\n\", a[ hs( i , i ) ][ w + 1 ] );\n\treturn 0;\n}\n```\n",
        "postTime": 1606381454,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    },
    {
        "content": "## [CF113D](https://www.luogu.com.cn/problem/CF113D)\n\n### \u89e3\u9898\u601d\u8def\uff1a\n\n\u679a\u4e3e\u7ec8\u70b9 $en$\uff0c\u8bbe $dp_{i,j}$ \u8868\u793a\u76ee\u524d\u7b2c\u4e00\u4e2a\u4eba\u5728 $i$\uff0c\u7b2c\u4e8c\u4e2a\u4eba\u5728 $j$ \uff0c\u6700\u540e\u4e24\u4e2a\u4eba\u5728 $en$ \u76f8\u9047\u7684\u6982\u7387\u3002\n\n$dp_{i,j}=\\sum_{i',j'}P(i,i')\\times P(j,j')\\times dp_{i',j'}$\u3002\n\n\u5176\u4e2d\uff0c$P(x,y)$ \u8868\u793a\u4ece $x$ \u4e0b\u4e00\u6b65\u8d70\u5230 $y$ \u7684\u6982\u7387\u3002\n\n\u663e\u7136\u6709 $n\\times n$ \u4e2a\u53d8\u91cf\uff0c$n\\times n$ \u4e2a\u4e00\u6b21\u65b9\u7a0b\uff0c\u9ad8\u65af\u6d88\u5143\u6c42\u51fa $dp_{a,b}$ \u5c31\u662f\u6700\u540e\u5728 $en$ \u76f8\u9047\u7684\u6982\u7387\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^7)$\uff0c\u7406\u8bba\u4e0a\u65e0\u6cd5\u901a\u8fc7\uff0c\u4f46 codeforces \u795e\u673a\u540d\u4e0d\u865a\u4f20\uff0c\u53ef\u4ee5 AC\u3002\n\n\u6ce8\u610f\u7279\u5224 $a=b$ \u548c $i'=j'$ \u7684\u60c5\u51b5\u3002\n\n### Code\uff1a\n\n```cpp\nconst int N=25;\n\nvector<int>e[N];\nint deg[N],n;\ndouble k[N*N][N*N],p[N];\nconst double eqs=1e-7;\n\nvoid guass()\n{\n\tint r=1;\n\trep(c,1,n*n)\n\t{\n\t\tint mx=r;\n\t\trep(i,r,n*n) if(fabs(k[i][c])>fabs(k[mx][c])) mx=i;\n\t\tif(fabs(k[mx][c])<=eqs) continue;\n\t\trep(i,c,n*n+1) swap(k[r][i],k[mx][i]);\n\t\tper(i,c,n*n+1) k[r][i]/=k[r][c];\n\t\trep(i,r+1,n*n)\n\t\t\tper(j,c,n*n+1)\n\t\t\t\tk[i][j]-=k[i][c]*k[r][j];\n\t\tr++;\n\t}\n\tper(i,1,n*n)\n\t\trep(j,i+1,n*n)\n\t\t\tk[i][n*n+1]-=k[i][j]*k[j][n*n+1];\n}\n\nint main()\n{\n\tint m,a,b;\n\tscanf(\"%d%d%d%d\",&n,&m,&a,&b);\n\tif(a==b)\n\t{\n\t\trep(i,1,n) \n\t\t{\n\t\t\tif(i==a) printf(\"1 \");\n\t\t\telse printf(\"0 \");\n\t\t}\n\t\treturn 0;\n\t}\n\trep(i,1,m)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\te[u].push_back(v);\n\t\te[v].push_back(u);\n\t\tdeg[u]++;\n\t\tdeg[v]++;\n\t}\n\trep(i,1,n) scanf(\"%lf\",&p[i]);\n\trep(en,1,n)\n\t{\n\t\tmemset(k,0,sizeof(k));\n\t\trep(i,1,n)\n\t\t\trep(j,1,n)\n\t\t\t{\n\t\t\t\tint x=(i-1)*n+j;\n\t\t\t\tfor(auto &vi: e[i])\n\t\t\t\t\tfor(auto &ui: e[j])\n\t\t\t\t\t{\n\t\t\t\t\t\tif(vi==ui&&vi!=en) continue;\n\t\t\t\t\t\tint y=(vi-1)*n+ui;\n\t\t\t\t\t\tk[x][y]+=((1-p[i])/deg[i])*((1-p[j])/deg[j]);\n\t\t\t\t\t}\n\t\t\t\tfor(auto &vi: e[i])\n\t\t\t\t{\n\t\t\t\t\tif(vi==j&&vi!=en) continue;\n\t\t\t\t\tint y=(vi-1)*n+j;\n\t\t\t\t\tk[x][y]+=((1-p[i])/deg[i])*p[j];\n\t\t\t\t}\n\t\t\t\tfor(auto &vi: e[j])\n\t\t\t\t{\n\t\t\t\t\tif(vi==i&&vi!=en) continue;\n\t\t\t\t\tint y=(i-1)*n+vi;\n\t\t\t\t\tk[x][y]+=((1-p[j])/deg[j])*p[i];\n\t\t\t\t}\n\t\t\t\tk[x][x]=-1;\n\t\t\t\tif(i!=j) k[x][x]+=p[i]*p[j];\n\t\t\t}\n\t\trep(i,1,n*n) k[(en-1)*n+en][i]=0;\n\t\tk[(en-1)*n+en][n*n+1]=k[(en-1)*n+en][(en-1)*n+en]=1;\n\t\tguass();\n\t\tprintf(\"%.15lf \",k[(a-1)*n+b][n*n+1]);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1670135417,
        "uid": 571634,
        "name": "hgzxwzf",
        "ccfLevel": 7,
        "title": "CF113D"
    },
    {
        "content": "## \u9898\u610f\n\n\u4e24\u4e2a\u4eba\u5206\u522b\u4ece $a,b$ \u5f00\u59cb\u968f\u673a\u6e38\u8d70\uff0c\u5728\u6bcf\u4e2a\u70b9\u6bcf\u4e2a\u4eba\u6709 $p_i$ \u7684\u6982\u7387\u4e0d\u52a8\uff0c$1-p_i$ \u7684\u6982\u7387\u968f\u673a\u5411\u5f53\u524d\u70b9\u7684\u51fa\u8fb9\u79fb\u52a8\uff0c\u4e24\u4e2a\u4eba\u76f8\u9047\u65f6\u7acb\u5373\u505c\u6b62\u79fb\u52a8\uff0c\u95ee\u5728\u65f6\u95f4\u65e0\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u505c\u5728\u6bcf\u4e2a\u70b9\u7684\u6982\u7387\u3002\n\n## \u601d\u8def\n\u5176\u5b9e\u8fd9\u9053\u9898\u662f\u9ad8\u65af\u6d88\u5143\u7684\u6a21\u677f\u9898\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u8bbe\u7acb\u72b6\u6001 $F_{i,j}$ \u8868\u793a\u7b2c\u4e00\u4e2a\u4eba\u5728 $i$\uff0c\u7b2c\u4e8c\u4e2a\u4eba\u5728 $j$ \u7684\u6982\u7387\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n$$\n\nF_{i,j}=\\sum_{v\\in edge(i)}F_{v,j} \\cdot (1-p_v)p_j/deg(v)+\\sum_{v\\in edge(j)} F_{i,v} \\cdot(1-p_v)p_i/seg(v)+ \n\n\\sum_{u\\in edge(i)} \\sum_{v\\in edge(j)}F_{u,v} \\cdot(1-p_u)(1-p_v)/deg(u)\n/deg(v)\n+p_i p_j[i\\neq j]\n$$\n\n\u8fd9\u91cc\u4e00\u6b65\u4e00\u6b65\u89e3\u91ca\u4e00\u4e0b\u3002\n\n\u524d\u4e24\u4e2a $\\sum$ \u8868\u793a\u4e00\u4e2a\u4eba\u4e0d\u52a8\u7684\u65b9\u6848\u6570\uff0c\u6b64\u65f6\u53e6\u4e00\u4e2a\u4eba\u79fb\u52a8\uff0c\u53ef\u4ee5\u4ece\u6240\u6709\u51fa\u8fb9\u4e2d\u79fb\u52a8\u8fc7\u6765\uff0c\u7136\u540e\u4ece\u5bf9\u5e94\u70b9\u79fb\u52a8\u8fc7\u6765\u7684\u6982\u7387\u5c31\u662f $(1-p_v)/deg(v)$ \u539f\u56e0\u7b80\u5355\uff0c\u9996\u5148\u8981\u79fb\u52a8\uff0c\u7136\u540e\u8fd8\u8981\u6b63\u597d\u79fb\u52a8\u5230\u5f53\u524d\u70b9\uff0c\u6240\u4ee5\u5c31\u662f $\\frac{1}{deg(v)}$ \u7684\u6982\u7387\uff0c\u5f53\u7136\u8fd8\u8981\u7b97\u4e0a\u53e6\u4e00\u4eba\u4e0d\u52a8\u7684\u6982\u7387\u3002\n\n\u540e\u8fb9 $\\sum\\sum$ \u5c31\u662f\u4e24\u4e2a\u4eba\u4e00\u8d77\u52a8\u7684\u65b9\u6848\u6570\uff0c\u540c\u7406\uff0c\u4e00\u4e2a\u4eba\u79fb\u52a8\u5230\u5f53\u524d\u70b9\u5c31\u662f $(1-p_v)/deg(v),v\\in edge(i)$\uff0c\u4e58\u8d77\u6765\u5373\u53ef\u3002\n\n\u6700\u540e\u4e00\u4e2a\u5c31\u662f\u4e0d\u52a8\u7684\u6982\u7387\uff0c\u8fd9\u91cc\u6ce8\u610f\u56e0\u4e3a\u76f8\u9047\u5373\u505c\u6b62\uff0c\u6240\u4ee5 $i=j$ \u7684\u65f6\u5019\u4e0d\u80fd\u4e0d\u52a8\uff08\u4f1a\u8fc7\u4e0d\u4e86\u6837\u4f8b\uff09\u3002\n\n\u5f53\u7136 $F_{a,b}$ \u8fd8\u8981\u52a0\u4e0a $1$\u3002\n\n\u4f46\u662f\u5199\u5b8c\u4e86\u4f1a\u53d1\u73b0\u65e0\u6cd5 dp\uff0c\u8fd9\u73a9\u610f\u662f\u6709\u73af\u7684\uff0c\u4f46\u662f\u6570\u636e\u8303\u56f4\u975e\u5e38\u5c0f\uff0c\u4ec5\u6709 $n\\le 22$ \uff0c\u72b6\u6001\u6570\u4e5f\u53ea\u6709 $n^2=484$ \uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u9ad8\u65af\u6d88\u5143\u6765\u505a\u3002\n\n\u5c06 $F_{i,j}$ \u79fb\u52a8\u5230\u53f3\u8fb9\uff0c\u5c31\u662f\u4e00\u4e2a\u7ebf\u6027\u65b9\u7a0b\u7ec4\u3002\n\n\u76f4\u63a5\u9ad8\u65af\u6d88\u5143\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n^6)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u6ce8\u610f\u6709\u70b9\u5361\u7cbe\u5ea6\uff0c\u7a0d\u5fae\u5f00\u5c0f\u4e00\u70b9\u5373\u53ef\u3002\n\n## code\n\n```cpp\nint mod;\nconst int MAXN=23;\nvi e[MAXN];\nlong double p[MAXN];\nlong double a[MAXN*MAXN][MAXN*MAXN+1];\nconst long double eps=1e-10;\nvoid work(int n)\n{\n\tint r=1;\n\tfor(int c=1;c<=n;c++)\n\t{\n\t\tint id=r;\n\t\tfor(int i=r+1;i<=n;i++)if(fabs(a[i][c])>fabs(a[id][c]))id=i;\n\t\tif(fabs(a[id][c])<=eps)continue;\n\t\tfor(int i=c;i<=n+1;i++)swap(a[r][i],a[id][i]);\n\t\tfor(int i=1+n;i>c;i--)a[r][i]/=a[r][c];\n\t\ta[r][c]=1;\n\t\tfor(int i=r+1;i<=n;i++)if(fabs(a[i][c])>eps)\n\t\t\tfor(int j=n+1;j>c;j--)\n\t\t\t{\n\t\t\t\ta[i][j]-=a[i][c]*a[r][j];\n\t\t\t}\n\t\tr++;\n\t}\n\tfor(int i=n-1;i>=1;i--)\n\t{\n\t\tfor(int j=i+1;j<=n;j++)\n\t\t{\n\t\t\ta[i][n+1]-=a[i][j]*a[j][n+1];\n\t\t}\n\t}\n}\nint main()\n{\t\t\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tint n,m,s,t;\n\tcin>>n>>m>>s>>t;\n\tint u,v;\n\tfor(int i=1;i<=m;i++)cin>>u>>v,e[u].push_back(v),e[v].push_back(u);\n\tfor(int i=1;i<=n;i++)cin>>p[i];\n\tint N=n*n;\n\tauto getid=[&](int x,int y)\n\t{\n\t\treturn (x-1)*n+y;\t\n\t};\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tfor(auto&v:e[i])a[getid(i,j)][getid(v,j)]=(1.0-p[v])*p[j]/e[v].size();\n\t\t\tfor(auto&v:e[j])a[getid(i,j)][getid(i,v)]=(1.0-p[v])*p[i]/e[v].size();\n\t\t\tfor(auto&u:e[i])\n\t\t\t\tfor(auto&v:e[j])\n\t\t\t\t\ta[getid(i,j)][getid(u,v)]=(1.0-p[u])*(1.0-p[v])/(e[u].size()*e[v].size());\n\t\t\tfor(int k=1;k<=n;k++)a[getid(i,j)][getid(k,k)]=0;\n\t\t\ta[getid(i,j)][getid(i,j)]=-1;\n\t\t\tif(i!=j)a[getid(i,j)][getid(i,j)]+=p[i]*p[j];//\u5224\u65ad i!=j\n\t\t}\n\t}\n\ta[getid(s,t)][N+1]=-1;// \u8bb0\u5f97\u52a0\u4e0a\u521d\u59cb\u503c 1\n\twork(N);\n\tcout<<fixed<<setprecision(12);\n\tfor(int i=1;i<=n;i++)cout<<a[getid(i,i)][N+1]<<' ';\n\treturn 0;\n} \n```\n\n\n",
        "postTime": 1669886932,
        "uid": 571229,
        "name": "__stick",
        "ccfLevel": 7,
        "title": "CF113D"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n[\u8fd9\u9898\u6539\u6210\u53cc\u4eba\u7248](https://www.luogu.com.cn/problem/P2973)\n\n## \u9898\u89e3\n\n\u53cc\u4eba\u770b\u8d77\u6765\u633a\u5413\u4eba\u7684\u3002\n\n\u4f46\u662f\u56e0\u4e3a\u6570\u636e\u8303\u56f4\u6bd4 [\u8fd9\u9898](https://www.luogu.com.cn/problem/P2973) \u5c0f\u4e86\u4e00\u5708\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u4e24\u4e2a\u4eba\u7684\u4f4d\u7f6e\u8bb0\u5f55\u5165\u72b6\u6001\u3002\n\n\u8bbe $f_{u,v}$ \u8868\u793a\u540c\u4e00\u65f6\u523b Petya \u5728\u70b9 $u$\uff0cVasya \u5728\u70b9 $v$ \u7684\u6982\u7387\u3002\n\n\u90a3\u4e48\u65b9\u7a0b\u4e3a\uff1a\n$$\nf_{u,v}=p_{u}p_{v}f_{u,v}+\\sum_{(u,u')\\in E}\\sum_{(v,v')\\in E}\\frac{1-p_{u'}}{d_{u'}}\\frac{1-p_{v'}}{d_{v'}}f_{u',v'}+\\sum_{(u,u')\\in E}p_{v}\\frac{1-p_{u'}}{d_{v'}}f_{u',v}+\\sum_{(v,v')\\in E}p_{u}\\frac{1-p_{v'}}{d_{v'}}f_{u,v'}\n$$\n\u65e0\u5411\u56fe\u4f1a\u51fa\u73b0\u73af\uff0c\u6240\u4ee5\u9700\u8981\u9ad8\u65af\u6d88\u5143\u4e00\u4e0b\u3002\n\n```cpp\n#include <cstdio>\n\nconst double EPS = 1e-8;\nconst int MAXN = 500 + 5, MAXM = MAXN * MAXN;\n\ntemplate<typename _T> _T ABS ( const _T x ) { return x > 0 ? x : -x; }\ntemplate<typename _T> void swapp ( _T &x, _T &y ) { _T w = x; x = y; y = w; }\n\nstruct GraphSet {\n\tint to, nx;\n\tGraphSet ( int T = 0, int N = 0 ) { to = T, nx = N; }\n} as[MAXM];\n\nint n, m, s, t, cnt, upper, d[MAXN], begin[MAXN];\ndouble mat[MAXN][MAXN], p[MAXN];\n\nint has ( const int x, const int y ) { return ( x - 1 ) * n + y; }\nvoid makeEdge ( const int u, const int v ) { as[++ cnt] = GraphSet ( v, begin[u] ), begin[u] = cnt; }\n\nvoid Eradicate () {\n\tfor ( int i = 1; i <= upper; ++ i ) {\n\t\tint p = i;\n\t\tfor ( int j = i + 1; j <= upper; ++ j ) {\n\t\t\tif ( ABS ( mat[p][i] ) < ABS ( mat[j][i] ) )\tp = i;\n\t\t}\n\t\tfor ( int j = i + 1; j <= upper + 1; ++ j )\tswapp ( mat[p][j], mat[i][j] );\n\t\tif ( ABS ( mat[i][i] ) < EPS )\tcontinue;\n\t\tfor ( int j = 1; j <= upper; ++ j ) {\n\t\t\tif ( i == j )\tcontinue;\n\t\t\tdouble d = mat[j][i] / mat[i][i];\n\t\t\tfor ( int k = 1; k <= upper + 1; ++ k )\tmat[j][k] -= mat[i][k] * d;\n\t\t}\n\t}\n\tfor ( int i = 1; i <= upper; ++ i )\tmat[i][upper + 1] /= mat[i][i];\n}\n\nint main () {\n\tscanf ( \"%d%d%d%d\", &n, &m, &s, &t ), upper = n * n;\n\tfor ( int i = 1, u, v; i <= m; ++ i ) {\n\t\tscanf ( \"%d%d\", &u, &v );\n\t\tmakeEdge ( u, v ), makeEdge ( v, u );\n\t\td[u] ++, d[v] ++;\n\t}\n\tfor ( int i = 1; i <= n; ++ i )\tscanf ( \"%lf\", &p[i] );\n\tfor ( int i = 1; i <= n; ++ i ) {\n\t\tfor ( int j = 1; j <= n; ++ j ) {\n\t\t\tif ( i == j )\tmat[has ( i, j )][has ( i, j )] = 1;\n\t\t\telse\tmat[has ( i, j )][has ( i, j )] = 1 - p[i] * p[j];\n\t\t\tfor ( int ii = begin[i]; ii; ii = as[ii].nx ) {\n\t\t\t\tint u = as[ii].to;\n\t\t\t\tfor ( int iii = begin[j]; iii; iii = as[iii].nx ) {\n\t\t\t\t\tint v = as[iii].to;\n\t\t\t\t\tif ( u == v )\tcontinue;\n\t\t\t\t\tmat[has ( i, j )][has ( u, v )] = -( 1 - p[u] ) / d[u] * ( 1 - p[v] ) / d[v];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor ( int ii = begin[i]; ii; ii = as[ii].nx ) {\n\t\t\t\tint u = as[ii].to;\n\t\t\t\tif ( u == j )\tcontinue;\n\t\t\t\tmat[has ( i, j )][has ( u, j )] = -p[j] * ( 1 - p[u] ) / d[u];\n\t\t\t}\n\t\t\tfor ( int ii = begin[j]; ii; ii = as[ii].nx ) {\n\t\t\t\tint v = as[ii].to;\n\t\t\t\tif ( i == v )\tcontinue;\n\t\t\t\tmat[has ( i, j )][has ( i, v )] = -p[i] * ( 1 - p[v] ) / d[v];\n\t\t\t}\n\t\t}\n\t}\n\tmat[has ( s, t )][upper + 1] = 1;\n\tEradicate ();\n\tfor ( int i = 1; i <= n; ++ i )\tprintf ( \"%.9lf \", mat[has ( i, i )][upper + 1] );\n\treturn 0;\n}\n```",
        "postTime": 1606451260,
        "uid": 161849,
        "name": "cirnovsky",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF113D \u3010Museum\u3011"
    }
]