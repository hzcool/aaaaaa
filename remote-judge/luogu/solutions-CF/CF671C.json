[
    {
        "content": "\u9996\u5148\u6211\u4eec\u7528$nxt_l$\u8868\u793a\u5f53$f(l,r)\\le i$\u65f6\uff0c$l$\u5bf9\u5e94\u7684\u53f3\u7aef\u70b9$r$\u6700\u5f80\u5de6\u80fd\u53d6\u5230\u54ea\u91cc\uff0c\u521d\u59cb\u65f6$nxt_l=l$\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5408\u6cd5\u53f3\u7aef\u70b9\u5c31\u8bb0$nxt_l=n+1$\u3002\n\n\u7136\u540e\u8003\u8651\u4ece\u5927\u5230\u5c0f\u679a\u4e3e$i$\uff0c\u5f53\u4ece$f(l,r)\\le i$\u53d8\u4e3a$f(l,r)\\le i-1$\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5220\u9664$gcd=i$\u7684\u8d21\u732e\uff0c\u627e\u51fa$i$\u7684\u500d\u6570\u5728\u539f\u5e8f\u5217\u4e2d\u7684\u4e0b\u6807\u8bb0\u4e3a$x_1,x_2......x_m$\uff0c\u800c\u6211\u4eec\u65b0\u5f97\u5230\u7684\u533a\u95f4$[l,nxt_l']$\u80af\u5b9a\u662f\u8981\u6ee1\u8db3\u5305\u542b$m-1$\u4e2a$x_i$\u7684\uff0c\u4e0d\u7136\u7b54\u6848\u5c31\u81f3\u5c11\u662f$i$\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8fdb\u884c\u5982\u4e0b\u4fee\u6539\u64cd\u4f5c\uff1a\n\n- $l\\in(x_2,n]$\uff0c$nxt_l=n+1$\n\n- $l\\in(x_1,x_2]$\uff0c$nxt_l=max(nxt_l,x_m)$\n\n- $l\\in[1,x_1]$\uff0c$nxt_l=max(nxt_l,x_{m-1})$\n\n2,3\u64cd\u4f5c\u770b\u4f3c\u9700\u8981\u5409\u53f8\u673a\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\uff0c\u4f46\u662f\u6211\u4eec\u51b7\u9759\u4e0b\u6765\u5206\u6790\u4e00\u6ce2\uff0c$nxt$\u6570\u7ec4\u4e00\u5b9a\u662f\u5355\u8c03\u4e0d\u964d\uff0c\u6240\u4ee5\u4e00\u5b9a\u662f\u8fdb\u884c\u533a\u95f4\u7684\u4e00\u6bb5\u524d\u7f00\u8986\u76d6\uff0c\u76f4\u63a5\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u4fee\u6539\u590d\u6742\u5ea6\u5c31\u662f$O(nlogn)$\u3002\n\n\u5176\u5b9e\u5f00\u59cb\u65f6$O(n\\sqrt n)$\u5904\u7406\u6bcf\u4e2a\u6570\u500d\u6570\u7684\u4f4d\u7f6e\u5c31\u5df2\u7ecf\u8db3\u591f\u4e86\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u4f18\u5316\uff0c\u56e0\u4e3a\u6211\u4eec\u6700\u591a\u53ea\u9700\u89812\u4e2a\u5f00\u5934\u7684\u548c2\u4e2a\u7ed3\u5c3e\u7684\uff0c\u90a3\u4e48\u76f4\u63a5\u5408\u5e76$i$\u7684\u500d\u6570\u7684\u96c6\u5408\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6\u662f$O(nlogn)$\uff0c\u6211\u6bd4\u8f83\u61d2\u5c31\u76f4\u63a5\u5199\u7684\u7b2c\u4e00\u79cdQAQ\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#include <vector>\n#define zrt k << 1\n#define yrt k << 1 | 1\nconst int N = 2e5;\nusing namespace std;\nint n,a[N + 5],Mx;\nlong long ans,las;\nvector <int> d[N + 5];\nstruct Seg\n{\n    long long sm[N * 5 + 5],tag[N * 4 + 5];\n    int mi[N * 4 + 5],mx[N * 4 + 5];\n    void pushup(int k)\n    {\n        sm[k] = sm[zrt] + sm[yrt];\n        mi[k] = min(mi[zrt],mi[yrt]);\n        mx[k] = max(mx[zrt],mx[yrt]);\n    }\n    void build(int k,int l,int r)\n    {\n        if (l == r)\n        {\n            mx[k] = mi[k] = sm[k] = l;\n            return;\n        }\n        int mid = l + r >> 1;\n        build(zrt,l,mid);\n        build(yrt,mid + 1,r);\n        pushup(k);\n    }\n    void cha(int k,int l,int r,int z)\n    {\n        sm[k] = 1ll * (r - l + 1) * z;\n        mi[k] = mx[k] = z;\n        tag[k] = z;\n    }\n    void pushdown(int k,int l,int r,int mid)\n    {\n        if (tag[k])\n        {\n            cha(zrt,l,mid,tag[k]);\n            cha(yrt,mid + 1,r,tag[k]);\n            tag[k] = 0;\n        }\n    }\n    void modify(int k,int l,int r,int x,int y,int z)\n    {\n        if (x > y)\n            return;\n        if (r < x || l > y || mi[k] >= z)\n            return;\n        if (l >= x && r <= y && mx[k] <= z)\n        {\n            cha(k,l,r,z);\n            return;\n        }\n        if (l == r)\n        {\n            sm[k] = mi[k] = mx[k] = z;\n            return;\n        }\n        int mid = l + r >> 1;\n        pushdown(k,l,r,mid);\n        modify(zrt,l,mid,x,y,z);\n        modify(yrt,mid + 1,r,x,y,z);\n        pushup(k);\n    }\n}tree;\nint main()\n{\n    scanf(\"%d\",&n);\n    for (int i = 1;i <= n;i++)\n        scanf(\"%d\",&a[i]),Mx = max(Mx,a[i]);\n    for (int i = 1;i <= n;i++)\n        for (int j = 1;j * j <= a[i];j++)\n            if (a[i] % j == 0)\n            {\n                d[j].push_back(i);\n                if (j * j != a[i])\n                    d[a[i] / j].push_back(i);\n            }\n    tree.build(1,1,n);\n    las = 1ll * n * (n + 1) - tree.sm[1];\n    int x1,x2,x3,x4;\n    for (int i = Mx;i >= 1;i--)\n    {\n        if (d[i].size() < 2)\n            continue;\n        x1 = *d[i].begin();\n        x2 = *(d[i].begin() + 1);\n        x3 = *(d[i].end() - 2);\n        x4 = *(d[i].end() - 1);\n        tree.modify(1,1,n,x2 + 1,n,n + 1);\n        tree.modify(1,1,n,x1 + 1,x2,x4);\n        tree.modify(1,1,n,1,x1,x3);\n        ans += (las - (1ll * n * (n + 1) - tree.sm[1])) * i;\n        las = 1ll * n * (n + 1) - tree.sm[1];\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1596537221,
        "uid": 73231,
        "name": "eee_hoho",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF671C \u3010Ultimate Weirdness of an Array\u3011"
    },
    {
        "content": "[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/671/problem/C) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF671C)\n\n\u5b89\u5229\u4e2a\u4eba blog\uff1ahttps://www.cnblogs.com/ET2006/\n\n~~*2800 \u7684 DS\uff0c\u4e0d\u8fc7\u8fd8\u662f\u88ab\u6211\u81ea\u5df1\u60f3\u51fa\u6765\u4e86~~\n\n~~u1s1 \u8fd9\u4e2a D1C \u6bd4\u67d0\u4e9b D1D \u4e0d\u77e5\u9053\u96be\u5230\u4ec0\u4e48\u5730\u65b9\u53bb\u4e86~~\n\n\u9996\u5148\u78b0\u5230\u8fd9\u7c7b\u95ee\u9898\u6211\u4eec\u80af\u5b9a\u8003\u8651\u679a\u4e3e\u4ec0\u4e48\u4e1c\u897f\uff0c\u7136\u540e\u5728\u679a\u4e3e\u8fc7\u7a0b\u4e2d\u7528\u4e2a\u4ec0\u4e48\u4e1c\u897f\u7ef4\u62a4\u7b54\u6848\uff0c\u6c42\u51fa\u5176\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\u6b64\u9898\u4e00\u4e2a\u5f88\u76f4\u89c2\u7684\u60f3\u6cd5\u662f\u679a\u4e3e\u5de6\u7aef\u70b9\uff0c\u4f46\u5f88\u9057\u61be\u6b64\u9898\u6d89\u53ca gcd\uff0c\u4e0d\u592a\u597d\u76f4\u63a5\u7ef4\u62a4\u3002\u6545\u6211\u4eec\u6362\u4e2a\u60f3\u6cd5\uff0c\u679a\u4e3e\u7b54\u6848\u3002\n\n\u6211\u4eec\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u6570\u7684\u6240\u6709\u56e0\u5b50\u2014\u2014\u8fd9\u4e2a\u663e\u7136\u53ef\u4ee5\u5728 $n\\ln n$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u3002\u7136\u540e\u4ece\u5927\u5230\u5c0f\u52a8\u6001\u5730\u679a\u4e3e\u4e00\u4e2a\u6307\u9488 $i$\u3002\u5bb9\u6613\u6ce8\u610f\u5230\u7684\u4e00\u4ef6\u4e8b\u60c5\u662f\u5982\u679c $f(l,r)\\geq i$\uff0c\u90a3\u4e48 $f(l,r-1)\\geq i$\u3002\u6545\u8003\u8651\u8bbe $t_l$ \u4e3a\u4ee5 $l$ \u4e3a\u5de6\u7aef\u70b9\u7684\u533a\u95f4\u4e2d\uff0c\u6700\u5c0f\u7684\u6ee1\u8db3 $f(l,r)<i$ \u7684 $r$\u3002\u90a3\u4e48\u663e\u7136\u6ee1\u8db3 $f(l,r)\\geq i$ \u7684\u533a\u95f4 $[l,r]$ \u7684\u4e2a\u6570\u4e3a $\\sum\\limits_{i=1}^n(t_i-i)=\\sum\\limits_{i=1}^nt_i-\\dfrac{n(n-1)}{2}$\uff0c\u800c\u7b54\u6848\u53c8\u663e\u7136\u53ef\u4ee5\u7528\u5dee\u5206\u7684\u601d\u60f3\u8f6c\u5316\u4e3a\u5bf9\u4e8e\u6240\u6709 $i$\uff0c\u6ee1\u8db3 $f(l,r)\\geq i$ \u7684\u533a\u95f4 $[l,r]$ \u7684\u4e2a\u6570\u4e4b\u548c\u3002\n\n\u8003\u8651\u5f53\u6307\u9488 $i$ \u4ece $i+1$ \u53d8\u4e3a $i$ \u7684\u65f6\u5019\u4f1a\u5bf9 $t_l$ \u9020\u6210\u4ec0\u4e48\u5f71\u54cd\u3002\u663e\u7136\u53ea\u6709\u6ee1\u8db3 $a_j$ \u4e3a $i$ \u7684\u500d\u6570\u7684\u4f4d\u7f6e $j$ \u624d\u6709\u53ef\u80fd\u5bf9 $t_l$ \u9020\u6210\u5f71\u54cd\uff0c\u6545\u8003\u8651\u5c06\u6ee1\u8db3 $a_j$ \u662f $i$ \u7684\u500d\u6570\u7684\u4f4d\u7f6e $j$ \u6309\u7167\u4e0b\u6807\u4ece\u5c0f\u5230\u5927\u6392\u597d\uff0c\u5047\u8bbe\u4e3a $p_1,p_2,\\dots,p_k$\uff0c\u90a3\u4e48\u6709\uff1a\n\n- \u82e5 $k=1$\uff0c\u4e00\u4e2a\u6570\u663e\u7136\u4e0d\u4f1a\u5bf9 $t_l$ \u4ea7\u751f\u4efb\u4f55\u5f71\u54cd\uff0c\u6545\u4e0d\u8003\u8651 $k=1$ \u7684\u60c5\u51b5\u3002\n- \u82e5 $k>2$\uff0c\u90a3\u4e48\uff1a\n  - \u5bf9\u4e8e $l\\in [1,x_1]$\uff0c$\\forall r\\in[l,x_{m-1}-1]$\uff0c\u533a\u95f4 $[l,r]$ \u4e4b\u5916\u90fd\u6709\u4e24\u4e2a $i$ \u7684\u500d\u6570\uff08$a_{x_{m-1}},a_{x_m}$\uff09\uff0c\u6545 $t_l\\leftarrow\\max(t_l,x_{m-1})$\n  - \u5bf9\u4e8e $l\\in [x_1+1,x_2]$\uff0c$\\forall r\\in[l,x_{m}-1]$\uff0c\u533a\u95f4 $[l,r]$ \u4e4b\u5916\u90fd\u6709\u4e24\u4e2a $i$ \u7684\u500d\u6570\uff08$a_1,a_{x_m}$\uff09\uff0c\u6545 $t_l\\leftarrow\\max(t_l,x_{m})$\n  - \u5bf9\u4e8e $l\\in [x_2+1,n]$\uff0c$\\forall r\\in[l,n]$\uff0c\u533a\u95f4 $[l,r]$ \u4e4b\u5916\u90fd\u6709\u4e24\u4e2a $i$ \u7684\u500d\u6570\uff08$a_1,a_2$\uff09\uff0c\u6545 $t_l\\leftarrow\\max(t_l,n+1)$\n\n\u4e8e\u662f\u73b0\u5728\u6211\u4eec\u8981\u5b9e\u73b0\u652f\u6301\u533a\u95f4\u53d6 $\\max$\uff0c\u5168\u5c40\u6c42\u548c\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e2a\u663e\u7136\u662f\u6570\u636e\u7ed3\u6784\u4e0d\u592a\u597d\u76f4\u63a5\u7ef4\u62a4\u7684\uff0c\u7b2c\u4e00\u7bc7\u9898\u89e3\u8bf4\u8981\u8fd9\u4e1c\u897f\u8981\u7528\u5230\u4ec0\u4e48\u5409\u53f8\u673a\u7ebf\u6bb5\u6811\uff08~~\u53cd\u6b63\u6211\u4e0d\u4f1a\u5c31\u5bf9\u4e86~~\uff09\u3002\u4e0d\u8fc7\u6211\u4eec\u9759\u4e0b\u5fc3\u6765\u597d\u597d\u60f3\u60f3\uff0c\u771f\u7684\u8981\u8fd9\u4e48\u9ebb\u70e6\u5417\uff1f\u8fd9\u4e2a $t$ \u6570\u7ec4\u5c31\u6ca1\u6709\u4ec0\u4e48\u6027\u8d28\u5417\uff1f\u4e0d\u96be\u53d1\u73b0\uff0c\u5982\u679c $f(l,r)\\geq i$\uff0c\u90a3\u4e48 $f(l+1,r)\\geq i$\u3002\u6545\u6211\u4eec\u6709 $t_l\\leq t_{l+1}$\u3002\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u4e00\u6b21\u5c06 $t_l,t_{l+1},t_{l+2},\\dots,t_r$ \u4e0e $x$ \u53d6 $\\max$ \u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u663e\u7136\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u65ad\u70b9 $k$ \u4f7f\u5f97 $t_l,t_{l+1},\\dots,t_k$ \u5747\u5c0f\u4e8e $x$\uff0c$t_{k+1},t_{k+2},\\dots,t_r$ \u5747 $\\ge x$\uff0c\u6545\u6211\u4eec\u53ea\u9700\u5bf9 $[l,k]$ \u8fdb\u884c**\u533a\u95f4\u8d4b\u503c**\u64cd\u4f5c\uff0c\u8fd9\u663e\u7136\u662f\u666e\u901a\u7ebf\u6bb5\u6811\u53ef\u4ee5\u7ef4\u62a4\u7684\u3002\u8fd9\u4e2a $k$ \u53ef\u4ee5\u901a\u8fc7**\u7ebf\u6bb5\u6811\u4e8c\u5206**\u6c42\u51fa\uff0c\u4e8c\u5206\u51fa\u7b2c\u4e00\u4e2a $\\geq x$ \u7684\u4f4d\u7f6e $p$ \u5e76\u4e0e $r+1$ \u53d6 $\\min$\uff0c\u7136\u540e\u5c06\u533a\u95f4 $[l,p-1]$ \u8d4b\u4e0a $x$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $nd(a_i)+n\\log n$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntypedef unsigned int u32;\ntypedef unsigned long long u64;\nnamespace fastio{\n\t#define FILE_SIZE 1<<23\n\tchar rbuf[FILE_SIZE],*p1=rbuf,*p2=rbuf,wbuf[FILE_SIZE],*p3=wbuf;\n\tinline char getc(){return p1==p2&&(p2=(p1=rbuf)+fread(rbuf,1,FILE_SIZE,stdin),p1==p2)?-1:*p1++;}\n\tinline void putc(char x){(*p3++=x);}\n\ttemplate<typename T> void read(T &x){\n\t\tx=0;char c=getchar();T neg=0;\n\t\twhile(!isdigit(c)) neg|=!(c^'-'),c=getchar();\n\t\twhile(isdigit(c)) x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\t\tif(neg) x=(~x)+1;\n\t}\n\ttemplate<typename T> void recursive_print(T x){if(!x) return;recursive_print(x/10);putc(x%10^48);}\n\ttemplate<typename T> void print(T x){if(!x) putc('0');if(x<0) putc('-'),x=~x+1;recursive_print(x);}\n\tvoid print_final(){fwrite(wbuf,1,p3-wbuf,stdout);}\n}\nconst int MAXN=2e5;\nconst int MAX_ITEM=3e6;\nint n,a[MAXN+5];vector<int> pos[MAXN+5];\nstruct chain_list{\n\tint hd[MAXN+5],v[MAX_ITEM+5],nxt[MAX_ITEM+5],item_n=0;\n\tvoid ins(int p,int q){v[++item_n]=q;nxt[item_n]=hd[p];hd[p]=item_n;}\n} fac;\nvoid prework(int n){\n\tfor(int i=1;i<=n;i++) for(int j=i;j<=n;j+=i) fac.ins(j,i);\n}\nstruct node{int l,r,tag,mx;ll sum;} s[MAXN*4+5];\nvoid pushup(int k){\n\ts[k].sum=s[k<<1].sum+s[k<<1|1].sum;\n\ts[k].mx=max(s[k<<1].mx,s[k<<1|1].mx);\n}\nvoid pushdown(int k){\n\tif(s[k].tag!=0){\n\t\ts[k<<1].mx=s[k].tag;s[k<<1].tag=s[k].tag;\n\t\ts[k<<1].sum=1ll*(s[k<<1].r-s[k<<1].l+1)*s[k].tag;\n\t\ts[k<<1|1].mx=s[k].tag;s[k<<1|1].tag=s[k].tag;\n\t\ts[k<<1|1].sum=1ll*(s[k<<1|1].r-s[k<<1|1].l+1)*s[k].tag;\n\t\ts[k].tag=0;\n\t}\n}\nvoid build(int k,int l,int r){\n\ts[k].l=l;s[k].r=r;if(l==r){s[k].sum=l;s[k].mx=l;return;}\n\tint mid=l+r>>1;build(k<<1,l,mid);build(k<<1|1,mid+1,r);\n\tpushup(k);\n}\nvoid modify(int k,int l,int r,int x){\n\tif(l<=s[k].l&&s[k].r<=r){\n\t\ts[k].tag=x;s[k].mx=x;\n\t\ts[k].sum=1ll*(s[k].r-s[k].l+1)*x;return;\n\t} pushdown(k);int mid=s[k].l+s[k].r>>1;\n\tif(r<=mid) modify(k<<1,l,r,x);\n\telse if(l>mid) modify(k<<1|1,l,r,x);\n\telse modify(k<<1,l,mid,x),modify(k<<1|1,mid+1,r,x);\n\tpushup(k);\n}\nint get_first_le(int k,int x){//find the first element >= x\n\tif(s[k].l==s[k].r) return s[k].l;\n\tpushdown(k);\n\tif(s[k<<1|1].mx<x) return s[k].r+1;\n\telse if(s[k<<1].mx<x) return get_first_le(k<<1|1,x);\n\telse return get_first_le(k<<1,x);\n}\nvoid deal_max(int l,int r,int x){\n\tif(l>r) return;\n\tint pos=get_first_le(1,x)-1;\n//\tprintf(\"%d %d %d %d\\n\",l,r,x,pos);\n\tif(pos>r) pos=r;if(pos<l) return;\n\tmodify(1,l,pos,x);\n}\nint main(){\n\tscanf(\"%d\",&n);prework(MAXN);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<=n;i++) for(int e=fac.hd[a[i]];e;e=fac.nxt[e])\n\t\tpos[fac.v[e]].pb(i);\n\tbuild(1,1,n);ll ans=0;\n\tfor(int i=MAXN;i;i--){\n\t\tif(pos[i].size()>=2){\n\t\t\tint fst=pos[i][0],fst_se=pos[i][1];\n\t\t\tint lst=pos[i][pos[i].size()-1],lst_se=pos[i][pos[i].size()-2];\n\t\t\tdeal_max(1,fst,lst_se);\n\t\t\tdeal_max(fst+1,fst_se,lst);\n\t\t\tdeal_max(fst_se+1,n,n+1);\n\t\t} ans+=s[1].sum-1ll*n*(n+1)/2;\n//\t\tprintf(\"%d %lld\\n\",i,s[1].sum);\n\t} printf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1614535371,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF671C\u3010Ultimate Weirdness of an Array\u3011"
    },
    {
        "content": "# CF671C Ultimate Weirdness of an Array\n\n## \u672c\u9898\u9898\u89e3\n\n\u5148\u9884\u5904\u7406\u51fa\uff0c\u6bcf\u4e2a\u6570\u503c\u5728\u5e8f\u5217\u91cc\u7b2c\u4e00\u6b21\u548c\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\u518d\u679a\u4e3e\u6bcf\u4e2a\u6570\u503c\u7684\u500d\u6570\uff08\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u8c03\u548c\u7ea7\u6570\uff09\uff0c\u6c42\u51fa**\u6bcf\u4e2a\u503c\u7684\u500d\u6570**\u5728\u5e8f\u5217\u91cc\u7b2c\u4e00\u6b21\u548c\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\n\n\u8003\u8651\u6c42 $f(i,j)$\u3002\u8bbe $\\gcd$ \u53d6\u5230\u6700\u5927\u503c\u7684\u4e24\u4e2a\u4f4d\u7f6e\u4e3a $x,y$ ($x,y\\in\\{[1, i - 1] \\cup[j + 1,n]\\}$)\uff0c\u4e0d\u5931\u4e00\u822c\u6027\u5730\u8bbe $x < y$\u3002\u53ef\u4ee5\u5206\u4e09\u79cd\u60c5\u51b5\uff1a\n\n- $x,y$ \u5168\u90fd\u5728 $[1, i - 1]$ \u5185\u90e8\u3002\n- $x,y$ \u5168\u90e8\u5728 $[j + 1, n]$ \u5185\u90e8\u3002\n- $x$ \u5728 $[1, i - 1]$\uff0c$y$ \u5728 $[j + 1, n]$\u3002\n\n\u524d\u4e24\u79cd\u60c5\u51b5\u662f\u7c7b\u4f3c\u7684\u3002\u4ee5\u7b2c\u4e00\u79cd\u4e3a\u4f8b\u3002\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $i$\u3002\u663e\u7136\u7b54\u6848\u662f\u5355\u8c03\u4e0d\u964d\u7684\u3002$i$ \u7684\u7b54\u6848\u76f8\u6bd4\u4e8e $i - 1$ \u7684\u7b54\u6848\uff0c\u5176\u5b9e\u5c31\u662f\u591a\u51fa\u4e86 $x < i - 1, y = i - 1$ \u7684\u60c5\u51b5\u3002\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\u7684 $\\gcd$ \u662f\u591a\u5c11\u3002\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e $a_{i- 1}$ \u7684\u6240\u6709\u7ea6\u6570\uff0c\u770b\u8fd9\u4e2a\u7ea6\u6570\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u524d\u9762\u5df2\u7ecf\u9884\u5904\u7406\u51fa\u6765\uff09\u662f\u5426\u5c0f\u4e8e $i - 1$\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u7ea6\u6570\u66f4\u65b0\u7b54\u6848\u3002\n\n\u56e0\u4e3a\u6bcf\u4e2a\u6570\u81f3\u591a\u53ea\u6709 $\\mathcal{O}(\\sqrt{n})$ \u4e2a\u7ea6\u6570\uff0c\u6240\u4ee5\u66b4\u529b\u5b9e\u73b0\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n\\sqrt{n})$\u3002\u4f46\u662f\u53d1\u73b0\uff0c\u5982\u679c\u5f53\u524d $a_{i - 1}$ \u8fd9\u4e2a\u503c\u5728\u524d\u9762\u5df2\u7ecf\u51fa\u73b0\u8fc7\uff0c\u90a3 $a_{i - 1}$ \u8fd9\u4e2a\u6570\u76f4\u63a5\u53ef\u4ee5\u66f4\u65b0\u7b54\u6848\uff0c\u8fd9\u4e00\u5b9a\u6bd4\u5b83\u7684\u4efb\u4f55\u7ea6\u6570\u90fd\u4f18\uff0c\u56e0\u6b64\u6b64\u65f6\u5c31\u4e0d\u5fc5\u679a\u4e3e\u7ea6\u6570\u4e86\u3002\u4e8e\u662f\uff0c\u5bf9\u6bcf\u4e2a\u6570\u503c\uff0c\u6211\u4eec\u53ea\u679a\u4e3e\u4e00\u6b21\u7ea6\u6570\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $1\\dots 2\\times 10^5$ \u91cc\u6240\u6709\u6570\u7684\u7ea6\u6570\u4e2a\u6570\u548c\uff0c\u662f $\\mathcal{O}(n\\log n)$ \u7684\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e09\u79cd\u60c5\u51b5\u3002\u8003\u8651\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $i$\uff0c\u5728\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u6240\u6709 $j$ \u7684\u7b54\u6848\u3002\u4ecd\u7136\u8003\u8651\u4ece $i - 1$ \u53d8\u5230 $i$ \u5bf9\u7b54\u6848\u7684\u5f71\u54cd\u3002\u53d1\u73b0\u53ea\u591a\u51fa\u4e86 $x = i - 1, y \\in[j + 1, n]$ \u7684\u60c5\u51b5\u3002\u679a\u4e3e $a_{i - 1}$ \u7684\u6240\u6709\u7ea6\u6570\uff0c\u8bbe\u5b83\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $p$\uff0c\u5219 $j\\in[i, p - 1]$ \u7684\u7b54\u6848\u53ef\u4ee5\u88ab\u66f4\u65b0\uff08\u4e5f\u5c31\u662f\u5bf9\u8fd9\u4e2a\u7ea6\u6570\u53d6 $\\max$\uff09\u3002\u53e6\u5916\uff0c$j = i - 1$ \u8fd9\u4e2a\u4f4d\u7f6e\u7684\u7b54\u6848\u9700\u8981\u88ab\u6e05\u7a7a\u3002\u7efc\u4e0a\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\uff1a\n\n- \u8ba9\u4e00\u6bb5\u533a\u95f4\u5bf9\u4e00\u4e2a\u6570\u53d6 $\\max$\u3002\n- \u66f4\u6539\u4e00\u4e2a\u5355\u70b9\u7684\u6570\u503c\uff08\u8bbe\u4e3a $0$\uff09\u3002\n- \u6c42\u5168\u5c40\u548c\u3002\n\n\u53ef\u4ee5\u7528\u5409\u8001\u5e08\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5355\u6b21\u64cd\u4f5c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(\\log n)$ \u7684\u3002\u56e0\u4e3a\u8981\u679a\u4e3e\u7ea6\u6570\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\sqrt{n}\\log n)$\u3002\u548c\u524d\u9762\u7c7b\u4f3c\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u540c\u4e00\u4e2a $a_{i - 1}$ \u7684\u503c\uff0c\u5982\u679c\u5728\u4e4b\u524d\u51fa\u73b0\u8fc7\uff0c\u5219\u73b0\u5728\u5e76\u4e0d\u4f1a\u6709\u65b0\u7684\u4ef7\u503c\u3002\u4e8e\u662f\u6bcf\u4e2a\u6570\u503c\u53ea\u679a\u4e3e\u4e00\u6b21\u7ea6\u6570\uff08\u5e76\u505a\u7ebf\u6bb5\u6811\u64cd\u4f5c\uff09\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log^2 n)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log^2 n)$\u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n```cpp\n// problem:\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define mk make_pair\n#define fi first\n#define se second\n#define SZ(x) ((int)(x).size())\n\ntypedef unsigned int uint;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int, int> pii;\n\ntemplate<typename T> inline void ckmax(T& x, T y) { x = (y > x ? y : x); }\ntemplate<typename T> inline void ckmin(T& x, T y) { x = (y < x ? y : x); }\n\n/* --------------- fast io --------------- */ // begin\nnamespace Fread {\nconst int SIZE = 1 << 21;\nchar buf[SIZE], *S, *T;\ninline char getchar() {\n\tif (S == T) {\n\t\tT = (S = buf) + fread(buf, 1, SIZE, stdin);\n\t\tif (S == T) return '\\n';\n\t}\n\treturn *S++;\n}\n} // namespace Fread\nnamespace Fwrite {\nconst int SIZE = 1 << 21;\nchar buf[SIZE], *S = buf, *T = buf + SIZE;\ninline void flush() {\n\tfwrite(buf, 1, S - buf, stdout);\n\tS = buf;\n}\ninline void putchar(char c) {\n\t*S++ = c;\n\tif (S == T) flush();\n}\nstruct NTR {\n\t~ NTR() { flush(); }\n} ztr;\n} // namespace Fwrite\n#ifdef ONLINE_JUDGE\n\t#define getchar Fread :: getchar\n\t#define putchar Fwrite :: putchar\n#endif\nnamespace Fastio {\nstruct Reader {\n\ttemplate<typename T>\n\tReader& operator >> (T& x) {\n\t\tchar c = getchar();\n\t\tT f = 1;\n\t\twhile (c < '0' || c > '9') {\n\t\t\tif (c == '-') f = -1;\n\t\t\tc = getchar();\n\t\t}\n\t\tx = 0;\n\t\twhile (c >= '0' && c <= '9') {\n\t\t\tx = x * 10 + (c - '0');\n\t\t\tc = getchar();\n\t\t}\n\t\tx *= f;\n\t\treturn *this;\n\t}\n\tReader& operator >> (char& c) {\n\t\tc = getchar();\n\t\twhile (c == '\\n' || c == ' ') c = getchar();\n\t\treturn *this;\n\t}\n\tReader& operator >> (char* str) {\n\t\tint len = 0;\n\t\tchar c = getchar();\n\t\twhile (c == '\\n' || c == ' ') c = getchar();\n\t\twhile (c != '\\n' && c != ' ') {\n\t\t\tstr[len++] = c;\n\t\t\tc = getchar();\n\t\t}\n\t\tstr[len] = '\\0';\n\t\treturn *this;\n\t}\n\tReader(){}\n} cin;\nconst char endl = '\\n';\nstruct Writer {\n\ttemplate<typename T>\n\tWriter& operator << (T x) {\n\t\tif (x == 0) { putchar('0'); return *this; }\n\t\tif (x < 0) { putchar('-'); x = -x; }\n\t\tstatic int sta[45];\n\t\tint top = 0;\n\t\twhile (x) { sta[++top] = x % 10; x /= 10; }\n\t\twhile (top) { putchar(sta[top] + '0'); --top; }\n\t\treturn *this;\n\t}\n\tWriter& operator << (char c) {\n\t\tputchar(c);\n\t\treturn *this;\n\t}\n\tWriter& operator << (char* str) {\n\t\tint cur = 0;\n\t\twhile (str[cur]) putchar(str[cur++]);\n\t\treturn *this;\n\t}\n\tWriter& operator << (const char* str) {\n\t\tint cur = 0;\n\t\twhile (str[cur]) putchar(str[cur++]);\n\t\treturn *this;\n\t}\n\tWriter(){}\n} cout;\n} // namespace Fastio\n#define cin Fastio :: cin\n#define cout Fastio :: cout\n#define endl Fastio :: endl\n/* --------------- fast io --------------- */ // end\n\nconst int MAXN = 2e5;\nconst int INF = 1e9;\n\nint n, a[MAXN + 5];\nint fstpos[MAXN + 5], lstpos[MAXN + 5];\nvector<int> d[MAXN + 5];\nbool vis[MAXN + 5];\n\nint f[MAXN + 5];\nstruct SegmentTree {\n\t\n\tll sum[MAXN * 4 + 5];\n\tll mn[MAXN * 4 + 5], semn[MAXN * 4 + 5];\n\tint mncnt[MAXN * 4 + 5];\n\t\n\tvoid push_up(int p) {\n\t\tint ls = (p << 1), rs = (p << 1 | 1);\n\t\tsum[p] = sum[ls] + sum[rs];\n\t\tif (mn[ls] < mn[rs]) {\n\t\t\tmn[p] = mn[ls];\n\t\t\tmncnt[p] = mncnt[ls];\n\t\t\tsemn[p] = min(semn[ls], mn[rs]);\n\t\t} else if (mn[ls] > mn[rs]) {\n\t\t\tmn[p] = mn[rs];\n\t\t\tmncnt[p] = mncnt[rs];\n\t\t\tsemn[p] = min(semn[rs], mn[ls]);\n\t\t} else {\n\t\t\tmn[p] = mn[ls];\n\t\t\tmncnt[p] = mncnt[ls] + mncnt[rs];\n\t\t\tsemn[p] = min(semn[ls], semn[rs]);\n\t\t}\n\t}\n\tvoid push_down(int p) {\n\t\tint ls = (p << 1), rs = (p << 1 | 1);\n\t\tif (mn[p] > mn[ls]) {\n\t\t\tassert(mn[p] < semn[ls]);\n\t\t\tsum[ls] += (ll)mncnt[ls] * (mn[p] - mn[ls]);\n\t\t\tmn[ls] = mn[p];\n\t\t}\n\t\tif (mn[p] > mn[rs]) {\n\t\t\tassert(mn[p] < semn[rs]);\n\t\t\tsum[rs] += (ll)mncnt[rs] * (mn[p] - mn[rs]);\n\t\t\tmn[rs] = mn[p];\n\t\t}\n\t}\n\t\n\ttemplate<typename Tp>\n\tvoid build(int p, int l, int r, const Tp* arr) {\n\t\tif (l == r) {\n\t\t\tsum[p] = arr[l];\n\t\t\tmn[p] = arr[l];\n\t\t\tsemn[p] = INF;\n\t\t\tmncnt[p] = 1;\n\t\t\treturn;\n\t\t}\n\t\tint mid = (l + r) >> 1;\n\t\tbuild(p << 1, l, mid, arr);\n\t\tbuild(p << 1 | 1, mid + 1, r, arr);\n\t\t\n\t\tpush_up(p);\n\t}\n\t\n\tvoid range_ckmax(int p, int l, int r, int ql, int qr, ll v) {\n\t\tif (v <= mn[p]) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (ql <= l && qr >= r) {\n\t\t\tif (v < semn[p]) {\n\t\t\t\tsum[p] += (ll)mncnt[p] * (v - mn[p]);\n\t\t\t\tmn[p] = v;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t\n\t\tint mid = (l + r) >> 1;\n\t\tpush_down(p);\n\t\tif (ql <= mid) {\n\t\t\trange_ckmax(p << 1, l, mid, ql, qr, v);\n\t\t}\n\t\tif (qr > mid) {\n\t\t\trange_ckmax(p << 1 | 1, mid + 1, r, ql, qr, v);\n\t\t}\n\t\t\n\t\tpush_up(p);\n\t}\n\t\n\tvoid point_clear(int p, int l, int r, int pos) {\n\t\tif (l == r) {\n\t\t\tsum[p] = 0;\n\t\t\tmn[p] = 0;\n\t\t\tsemn[p] = INF;\n\t\t\tmncnt[p] = 1;\n\t\t\treturn;\n\t\t}\n\t\tint mid = (l + r) >> 1;\n\t\tpush_down(p);\n\t\tif (pos <= mid) {\n\t\t\tpoint_clear(p << 1, l, mid, pos);\n\t\t} else {\n\t\t\tpoint_clear(p << 1 | 1, mid + 1, r, pos);\n\t\t}\n\t\t\n\t\tpush_up(p);\n\t}\n\t\n\tSegmentTree() {}\n};\n\nSegmentTree T;\n\nint main() {\n\tcin >> n;\n\tfor (int i = 1; i <= MAXN; ++i) {\n\t\tfstpos[i] = n + 1;\n\t\tlstpos[i] = 0;\n\t}\n\tfor (int i = 1; i <= n; ++i) {\n\t\tcin >> a[i];\n\t\tlstpos[a[i]] = i;\n\t}\n\tfor (int i = n; i >= 1; --i) {\n\t\tfstpos[a[i]] = i;\n\t}\n\t\n\tfor (int i = 1; i <= MAXN; ++i) {\n\t\tfor (int j = i; j <= MAXN; j += i) {\n\t\t\tckmax(lstpos[i], lstpos[j]);\n\t\t\tckmin(fstpos[i], fstpos[j]);\n\t\t\td[j].push_back(i);\n\t\t}\n\t} // lstpos[i]: i \u7684\u500d\u6570\u7684\u6700\u5927\u51fa\u73b0\u4f4d\u7f6e\n\t\n\t\n\tfor (int i = n - 1; i >= 1; --i) {\n\t\tf[i] = f[i + 1];\n\t\tif (!vis[a[i + 1]]) {\n\t\t\tvis[a[i + 1]] = 1;\n\t\t\tfor (int j = 0; j < SZ(d[a[i + 1]]); ++j) {\n\t\t\t\tint x = d[a[i + 1]][j];\n\t\t\t\tif (lstpos[x] > i + 1) {\n\t\t\t\t\tckmax(f[i], x);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tckmax(f[i], a[i + 1]);\n\t\t}\n\t}\n\t\n\tfor (int i = 1; i <= MAXN; ++i) vis[i] = 0;\n\t\n\tT.build(1, 1, n, f);\n\tll ans = T.sum[1];\n\tf[1] = 0;\n\tfor (int i = 2; i <= n; ++i) {\n\t\tT.point_clear(1, 1, n, i - 1);\n\t\t\n\t\tf[i] = f[i - 1];\n\t\tif (!vis[a[i - 1]]) {\n\t\t\tvis[a[i - 1]] = 1;\n\t\t\tfor (int j = 0; j < SZ(d[a[i - 1]]); ++j) {\n\t\t\t\tint x = d[a[i - 1]][j];\n\t\t\t\tif (lstpos[x] >= i + 1) {\n\t\t\t\t\tT.range_ckmax(1, 1, n, i, lstpos[x] - 1, x);\n\t\t\t\t}\n\t\t\t\tif (fstpos[x] < i - 1) {\n\t\t\t\t\tckmax(f[i], x);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tckmax(f[i], a[i - 1]);\n\t\t}\n\t\tT.range_ckmax(1, 1, n, i, n, f[i]);\n\t\t\n\t\tans += T.sum[1];\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1609577019,
        "uid": 100674,
        "name": "duyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF671C \u3010Ultimate Weirdness of an Array\u3011"
    }
]