[
    {
        "content": "\u8bf6\uff0c\u8fd9\u9898\u867d\u7136\u662f\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u4f46\u662f\u6ca1\u4eba\u8bc1\u554a(\u867d\u7136\u6bd4\u8f83\u663e\u7136)\u3002\n\n\u90a3\u6211\u5c31\u6765\u7b80\u5355\u8bc1\u4e00\u4e0b\u53ed\uff1a\n\n\u8003\u8651\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff0c\u5982\u679c\u662f\u6700\u5c0f\u503c\u95ee\u9898\uff0c\u90a3\u5927\u6982\u957f\u8fd9\u6837\uff1a\n\n$$a\\leq b<c\\leq d$$\n\n$$w(a,c)+w(b,d)\\le w(a,d)+w(b,c)$$\n\n\u90a3\u4e48\u5982\u679c\u6ee1\u8db3\u8fd9\u4e2a\uff0c\u5c31\u8bf4\u660e\u5176\u6ee1\u8db3\u6700\u5c0f\u503c\u65f6\u7684\u51b3\u7b56\u5355\u8c03\u6027\u3002\u8bc1\u660e\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a $a\\to d,b\\to c$ \u7684\u8f6c\u79fb\u7684\u503c\u8981\u66f4\u5927\u4e9b\uff0c\u6240\u4ee5 $a\\to c,b\\to d$ \u7684\u8f6c\u79fb\u4f1a\u66f4\u4f18\uff0c\u636e\u6b64\u53ef\u5f97 $f$ \u6709\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u8003\u8651\u62ff\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u6765\u8bc1\u660e\u3002\u5bf9\u4e8e $a\\leq b<c\\leq d$ \u800c\u8a00\uff0c\u8bb0 $s(a,c)$ \u8868\u793a\u77e9\u9635\u4e2d\u5de6\u4e0a\u89d2\u4e3a $(a,a)$ \u53f3\u4e0b\u89d2\u4e3a $(c,c)$ \u7684\u8fd9\u4e48\u4e00\u4e2a\u77e9\u9635\u4e2d\u5143\u7d20\u7684\u548c\uff0c\u90a3\u4e48 \n$$w(a,c)+w(b,d)=\\frac{s(a,c)+s(b,d)}{2}$$\n\n$$w(a,d)+w(b,c)=\\frac{s(a,d)+s(b,c)}{2}$$\n\u6ce8\u610f\u5230\n$$s(a,d) = s(a,c)+s(b,d)-s(b,c)+s(a,b)+s(c,d)$$\n\u90a3\u4e48\u5c31\u663e\u7136\n$$w(a,c)+w(b,d)\\le w(a,d)+w(b,c)$$\n\u5341\u5206\u6ee1\u8db3\u51b3\u7b56\u5355\u8c03\u6027\uff08\u5176\u5b9e\u753b\u51fa\u56fe\u6765\u66f4\u663e\u7136\uff0c\u5c31\u662f\u591a\u4e86\u4e24\u5757\u77e9\u9635\uff09\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u7528\u5206\u6cbb\u6765\u505a\u3002\u56e0\u4e3a\u6bcf\u4e00\u5c42\u51b3\u7b56\u4e0e\u672c\u5c42\u65e0\u5173\uff0c\u5373 $k-1\\to k$ \u3002\u4e8e\u662f\u5c31\u53ef\u4ee5 `solve(l,r,ql,qr)` \u8868\u793a $l\\sim r$ \u662f\u4ece\u533a\u95f4 $(ql\\sim qr)$ \u8f6c\u79fb\u8fc7\u6765\u7684\u3002\u90a3\u4e48\u6bcf\u6b21\u53d6 $mid=\\frac{l+r}{2}$\uff0c\u7136\u540e\u627e\u51fa $f_{mid}$ \u5bf9\u5e94\u7684\u6700\u4f18\u51b3\u7b56\u6240\u5728\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5206\u6cbb\u4e86\u3002\u590d\u6742\u5ea6 $O(nk\\log n)$ \u3002",
        "postTime": 1585122524,
        "uid": 28313,
        "name": "\u768e\u6708\u534a\u6d12\u82b1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF321E \u3010Ciel and Gondolas\u3011"
    },
    {
        "content": "\u5404\u4f4d\u5927\u4f6c\u90fd\u7528\u7684 $wqs$ \u4e8c\u5206\uff0c\u849f\u84bb\u4ecb\u7ecd\u4e00\u79cd\u7b80\u5355\u65b9\u6cd5\u3002\n\n$dp$ \u5f0f\u5f88\u597d\u5217:\n\n$$\ndp[i][j]=min( dp[i-1][k-1] + calc( k , j ) )\n$$\n\n$calc(k,j)$\u8868\u793a\u5c06 $k$ \u5230 $j$ \u7684\u8d1e\u9c7c\u5728\u540c\u4e00\u8f66\u7684\u6028\u6c14\u503c \uff0c \u51b3\u7b56\u5177\u6709\u5355\u8c03\u6027\u3002\n\n\u4e0d\u5982\u5c06\u5f53\u524d\u7684\u51b3\u7b56\u70b9\u533a\u95f4\u8bb0\u4e3a $ [optl,optr] $  , \u5904\u7406 $dp$ \u7684\u533a\u95f4\u4e3a $ [L,R] $\n\n\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u8ba1\u7b97 $dp[s][mid]$ \u7684\u503c $(mid=\\frac{L+R}{2})$ \uff0c \u5e76\u8bb0\u5f55\u5f53\u524d\u7684\u51b3\u7b56\u70b9$opt$\u3002\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u8ba1\u7b97 $dp[s][l...(mid-1)]$ \u4e0e $dp[s][(mid+1)...r]$\n\n\u56e0\u4e3a\u51b3\u7b56\u5177\u6709\u5355\u8c03\u6027 \uff0c \u6240\u4ee5\u8ba1\u7b97 $dp[s][l...(mid-1)]$\u65f6\u53ea\u9700\u7528$[optl,opt]$ , \u8ba1\u7b97 $dp[s][(mid+1)...r]$\u65f6\u53ea\u9700\u7528$[opt,optr]$\u3002\n\n\u8fd9\u79cd\u65b9\u6cd5\u4ec5\u9002\u7528\u4e8e\u6709**\u51b3\u7b56\u5355\u8c03\u6027**\u7684\u9898\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$\\Theta(k*n*log_2n)$\n\n```cpp\n#include <cstdio>\n#include <iostream>\nusing namespace std;\n#define INF 0x3f3f3f3f\n\nvoid Read( int &x ) {\n\tx = 0; int f = 1;\n\tchar s = getchar( );\n\tfor( ; s < '0' || s > '9' ; s = getchar( ) ) f = s == '-' ? -f : f;\n\tfor( ; s >= '0' && s <= '9' ; s = getchar( ) ) x = x * 10 + s - '0';\n\tx *= f;\n}\nvoid Write( int x ) {\n\tif( x < 0 )\n\t\tputchar('-') , x = -x;\n\tif( x >= 10 ) Write( x / 10 );\n\tputchar( x % 10 + '0' );\n}\n\nconst int MAXK = 800 , MAXN = 4000;\nint n , k , x , sum[ MAXN + 5 ][ MAXN + 5 ];\nint dp[ MAXK + 5 ][ MAXN + 5 ];\n\nint Calc( int u , int v ) {\n\treturn sum[ v ][ v ] - sum[ v ][ u - 1 ] - sum[ u - 1 ][ v ] + sum[ u - 1 ][ u - 1 ];\n}\nvoid dfs( int s , int L , int R , int optl , int optr ) {\n\tif( L > R ) return;\n\t\n\tint Mid = ( L + R ) / 2 , opt;\n\tdp[ s ][ Mid ] = INF;\n\tfor( int i = optl ; i <= min( optr , Mid ) ; i ++ ) {\n\t\tif( dp[ s ][ Mid ] > dp[ s - 1 ][ i - 1 ] + Calc( i , Mid ) ) {\n\t\t\tdp[ s ][ Mid ] = dp[ s - 1 ][ i - 1 ] + Calc( i , Mid );\n\t\t\topt = i;\n\t\t}\n\t}\n\tdfs( s , L , Mid - 1 , optl , opt );\n\tdfs( s , Mid + 1 , R , opt , optr );\n}\n\nint main( ) {\n\tRead( n ) , Read( k );\n\tfor( int i = 1 ; i <= n ; i ++ )\n\t\tfor( int j = 1 ; j <= n ; j ++ )\n\t\t\tRead( x ) , sum[ i ][ j ] = sum[ i - 1 ][ j ] + sum[ i ][ j - 1 ] - sum[ i - 1 ][ j - 1 ] + x;\n\tfor( int i = 1 ; i <= n ; i ++ )\n\t\tdp[ 0 ][ i ] = INF;\n\tfor( int i = 1 ; i <= k ; i ++ )\n\t\tdfs( i , 1 , n , 1 , n );\n\tWrite( dp[ k ][ n ] / 2 );\n\treturn 0;\n}\n```\n",
        "postTime": 1575262958,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF321E \u3010Ciel and Gondolas\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u518d\u8bb2\u4e00\u79cd\u6bd4\u9664\u4e86 $wqs$ \u4e8c\u5206\u4e4b\u5916\u90fd\u8981\u4f18\u7684 $O(n^2)$ \u505a\u6cd5\uff08\u795e\u5947\u7684\u4e0e $k$ \u65e0\u5173\uff09\u3002\r\n\r\n\u9996\u5148\u51b3\u7b56\u5355\u8c03\u6027\u4e0d\u518d\u8bc1\u660e\u4e86\uff0c\u76f4\u63a5\u8003\u8651\u600e\u4e48\u5b9e\u73b0\u3002\r\n\r\n\u8003\u8651\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u70b9\u7684\u51b3\u7b56\u8303\u56f4\u3002\u53d1\u73b0\u8bbe\u72b6\u6001 $(n,k)$ \u6700\u4f18\u51b3\u7b56\u4f4d\u7f6e\u8bb0\u4f5c $opt(n,k)$ \u7684\u8bdd\uff0c\u4e00\u5b9a\u6709\r\n$$\r\nopt(n,k-1)\\leq opt(n,k)\\leq opt(n+1,k)\r\n$$\r\n\u90a3\u4e48\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a\r\n\r\n```cpp\r\nfor j : 1 to k\r\n  for i : n to 1\r\n    for p : opt(i, j - 1) to opt(i + 1, j)\r\n      if [f(p, j - 1) < f(i, j)] opt(i, j) = p, f(i, j) := f(p, j - 1) ; \r\n```\r\n\r\n\u8fd9\u6837\u505a\u663e\u7136\u662f\u5bf9\u7684\u3002\u4e8e\u662f\u6765\u8003\u8651\u8fd9\u4e48\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\r\n\r\n\u53d1\u73b0\u5bf9\u4e8e\u8fd9\u4e2a\u51b3\u7b56\u77e9\u9635\u7684\u6bcf\u4e00\u6761\u7a7f\u8fc7 $opt(i,j)$  \u548c $opt(i+1,j+1)$ \u7684\u659c\u7ebf\uff0c\u6bcf\u6761\u659c\u7ebf\u7684\u4ee3\u4ef7\u662f $O(n)$ \u7684\uff0c\u539f\u56e0\u662f\u8003\u8651\u659c\u7ebf $opt(i,j),opt(i+1,j+1)$ \u8fd9\u6761\u659c\u7ebf\u7684\u51b3\u7b56\u6765\u81ea\u4e8e $opt(i,j-1),opt(i+1,j)$ \u8fd9\u6761\u659c\u7ebf\u3002\u90a3\u4e48\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a\u659c\u7ebf\u7684\u8f6c\u79fb\u90fd\u662f $O(n)$ \u7684\uff0c\u5171\u6709 $O(n+k)$ \u6761\u659c\u7ebf\uff0c\u6240\u4ee5\u590d\u6742\u5ea6 $O(n^2)$ \u3002\r\n\r\n\r\n\u4ee3\u7801\u5c31\u4e0d\u7ed9\u4e86\uff0c\u8fd9\u4e2a\u4f2a\u4ee3\u7801\u5199\u7684\u8fd8\u662f\u5f88\u89c4\u6574\u7684\u5427\uff1f",
        "postTime": 1585198202,
        "uid": 28313,
        "name": "\u768e\u6708\u534a\u6d12\u82b1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF321E \u3010Ciel and Gondolas\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.lydsy.com/JudgeOnline/problem.php?id=5311)\n\nDP\u51f8\u4f18\u5316\u3002\n\n\u8fd9\u5c45\u7136\u90fd\u80fd\u53d8\u6210\u4e00\u79cd\u5957\u8def\u9898\uff0c\u90a3\u53ef\u771f\u662f\u8ba9\u6211\u5927\u5403\u4e00\u60ca\u5462\u3002\u9996\u5148DP\u5f0f\u5e94\u8be5\u53ef\u4ee5\u8fc5\u901f\u5f97\u51fa\u3002\u8bb0$dp[i][j]$\u8868\u793a\u524d$i$\u4e2a\u5206\u6210$j$\u6bb5\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c$sum[i][j]$\u8868\u793a\u524d$i$\u4e2a\u8d1e\u9c7c\u4e0e\u524d$j$\u4e2a\u8d1e\u9c7c\u7684\u603b\u4ee3\u4ef7\u3002\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u5c31\u5f88\u597d\u5199\u4e86\uff1a$dp[i][j]=min(dp[p][j-1]+(sum[i][i]+sum[p][p]-2*sum[i][p])/2)$\u3002\n\n\u8fd9\u663e\u7136\u662f$O(n^2*k)$\u7684\u590d\u6742\u5ea6\uff0c\u8003\u8651\u5982\u4f55\u4f18\u5316\u3002\n\n\u9996\u5148\u53d1\u73b0\u597d\u50cf\u4e0d\u80fd\u659c\u7387\u4f18\u5316\u54ce\uff0c\u4f46\u662f\u6709\u51b3\u7b56\u5355\u8c03\u6027\u53ef\u4ee5\u641e\u3002\u6240\u4ee5\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217\uff0c\u7136\u540e\u8ba9\u590d\u6742\u5ea6\u53d8\u6210$O(n*k*logn)$\u3002\u4f46\u8fd9\u4e2a\u590d\u6742\u5ea6\u8fd8\u662f\u592a\u5927\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e00\u79cd\u53eb\u505a$wqs$\u4e8c\u5206\u7684\u795e\u5947\u505a\u6cd5\uff0c\u53bb\u67e5\u627e$p$\u7684\u4f4d\u7f6e\uff08\u65ad\u5f00\u7684\u4f4d\u7f6e\uff09\uff0c\u7136\u540e\u4f7f\u590d\u6742\u5ea6\u53d8\u6210$O(n*logn*logk)$\u3002\n\n\u4e8b\u5b9e\u4e0a\u5462\uff0c\u8fd9\u79cd\u51b3\u7b56\u5355\u8c03\u6027+$wqs$\u4e8c\u5206\u7684\u5408\u4f53\u662f\u4e00\u79cd\u57fa\u672c\u5957\u8def\u4e86\uff0c\u6211\u4eec\u628a\u5b83\u79f0\u4f5c\u51f8\u4f18\u5316\u3002\u4e3a\u4ec0\u4e48\u8981\u53eb\u51f8\u4f18\u5316\u5462\uff1f\u8fd9\u91cc\u6211\u627e\u5230\u8fd9\u6837\u4e00\u6bb5\u8bdd\uff1a\n\n _\u51f8\u4f18\u5316\u89e3\u51b3\u7684\u662f\u4e00\u7c7b\u9009\u62e9\u6070\u597d k \u4e2a\u67d0\u79cd\u7269\u54c1\u7684\u6700\u4f18\u5316\u95ee\u9898\u3002\u4e00\u822c\u6765\u8bf4\u8fd9\u6837\u7684\u9898\u76ee\u5728\u4e0d\u8003\u8651\u7269\u54c1\u6570\u91cf\u9650\u5236\u7684\u6761\u4ef6\u4e0b\u4f1a\u6709\u4e00\u4e2a\u56fe\u50cf\uff0c\u8868\u793a\u9009\u62e9\u7684\u7269\u54c1\u6570\u91cf\u4e0e\u95ee\u9898\u6700\u4f18\u89e3\u4e4b\u95f4\u7684\u5173\u7cfb\u3002_ \n\n _\u95ee\u9898\u80fd\u591f\u7528\u51f8\u4f18\u5316\u89e3\u51b3\u8fd8\u9700\u8981\u6ee1\u8db3\u56fe\u50cf\u662f\u51f8\u7684\uff0c\u76f4\u89c2\u5730\u7406\u89e3\u5c31\u662f\u9009\u7684\u7269\u54c1\u8d8a\u591a\u7684\u60c5\u51b5\u4e0b\u591a\u9009\u4e00\u4e2a\u7269\u54c1\uff0c\u6700\u4f18\u89e3\u7684\u589e\u957f\u901f\u5ea6\u4f1a\u53d8\u6162\u3002_ \n\n _\u89e3\u51b3\u51f8\u4f18\u5316\u7c7b\u578b\u7684\u9898\u76ee\u53ef\u4ee5\u91c7\u7528\u4e8c\u5206\u7684\u65b9\u6cd5\uff0c\u5373\u4e8c\u5206\u51f8\u58f3\u4e0a\u6700\u4f18\u503c\u6240\u5728\u70b9\u7684\u659c\u7387\uff0c\u7136\u540e\u5ffd\u7565\u6070\u597d k \u4e2a\u7684\u9650\u5236\u505a\u4e00\u6b21\u539f\u95ee\u9898\u3002_ \n\n _\u8fd9\u6837\u6bcf\u6b21\u9009\u62e9\u4e00\u4e2a\u7269\u54c1\u7684\u65f6\u5019\u8981\u591a\u4ed8\u51fa\u659c\u7387\u5927\u5c0f\u7684\u4ee3\u4ef7\uff0c\u5c31\u80fd\u591f\u6839\u636e\u6700\u4f18\u60c5\u51b5\u4e0b\u9009\u62e9\u7684\u7269\u54c1\u6570\u91cf\u6765\u5224\u65ad\u4e8c\u5206\u7684\u659c\u7387\u4e0e\u5b9e\u9645\u6700\u4f18\u503c\u7684\u659c\u7387\u7684\u5927\u5c0f\u5173\u7cfb\u3002_ \n\n _\u7406\u8bba\u4e0a\u8fd9\u4e2a\u659c\u7387\u4e00\u5b9a\u662f\u6574\u6570\uff0c\u7531\u4e8e\u9898\u76ee\u6027\u8d28\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e8c\u5206\u4e0d\u51fa\u8fd9\u4e2a\u6570\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4e00\u4e9b\u5b9e\u73b0\u4e0a\u7684\u6280\u5de7\u4fdd\u8bc1\u80fd\u591f\u627e\u5230\u8fd9\u4e2a\u6700\u4f18\u89e3\u3002_ \n \n\u8bf4\u660e\u767d\u4e00\u70b9\uff0c\u5c31\u662f\u56e0\u4e3a$dp$\u6570\u7ec4\u662f\u4e00\u4e2a\u51f8\u51fd\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u9650\u5236\u53d6$k$\u6bb5\u7684\u6761\u4ef6\u53d8\u6210\u659c\u7387\uff0c\u76f4\u63a5\u53bb\u8fd9\u4e2a\u51f8\u51fd\u6570\u7684\u6781\u503c\u70b9\uff0c\u8fd9\u6837\u7b54\u6848\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u51fd\u6570\u503c\u6765\u8868\u793a\u6389\u3002\n \n\u4e8e\u662f\u8fd9\u79cd\u7c7b\u578b\u7684\u9898\u76ee\u6211\u4eec\u90fd\u53ef\u4ee5\u7528\u8fd9\u4e48\u4e00\u79cd\u53eb\u505a\u51f8\u4f18\u5316\u7684\u505a\u6cd5\u4e8c\u5206\u67e5\u627e\u5230\u7b54\u6848\uff0c\u7136\u540e\u8fc7\u4e86\u8fd9\u79cd\u7c7b\u578b\u7684\u9898\u3002\n\ncode:\n```\n//2018.9.7 by ljz\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register int\n#define LL long long\n#define inf 0x3f3f3f3f\n#define eps 1e-15\n#define RG register\nnamespace io{\n    const int MAXBUF=1<<15;\n    const int OUTPUT=1<<24;\n    char b[MAXBUF],*S=b,*T=b;\n#define getc() (S==T&&(T=(S=b)+fread(b,1,MAXBUF,stdin),S==T)?0:*S++)\n#define O(x) __attribute__((optimize(\"-O\"#x)))\n#define inline __inline__ __attribute__((always_inline))\n    template<class Type> inline Type read(){\n        RG Type aa=0;\n        RG bool bb=0;\n        RG char ch,*S=io::S,*T=io::T;\n        for(ch=getc();(ch<'0'||ch>'9')&&ch!='-';ch=getc());\n        for(ch=='-'?bb=1:aa=ch-'0',ch=getc();'0'<=ch&&ch<='9';ch=getc())aa=aa*10+ch-'0';\n        io::S=S,io::T=T;\n        return bb?-aa:aa;\n    }\n    inline int gets(RG char *s){\n        RG char *iter=s,*S=io::S,*T=io::T;\n        while(*iter=getc(),*iter==' '||*iter=='\\n'||*iter=='\\r');\n        while(*++iter=getc(),*iter&&*iter!=' '&&*iter!='\\n'&&*iter!='\\r');\n        *iter=0;\n        io::S=S,io::T=T;\n        return iter-s;\n    }\n    char buff[OUTPUT],*iter=buff;\n    template<class T> inline void P(RG T x, RG char ch = '\\n'){\n        static int ST[110];\n        res O=0;\n        RG char *iter=io::iter;\n        if(!x)*iter++='0';\n        else{\n            (x<0)?x=-x,*iter++='-':1;\n            for(;x;x/=10)ST[++O]=x%10;\n            for(;O;*iter++='0'+ST[O--]);\n        }\n        *iter++=ch,io::iter=iter;\n    }\n    inline void output(){fwrite(buff, 1, iter - buff, stdout),iter=buff;}\n}\ninline void _swap(res &x,res &y){\n    x^=y^=x^=y;\n}\ninline int _abs(const res &x){\n    return x>0?x:-x;\n}\ninline int _max(const res &x,const res &y){\n    return x>y?x:y;\n}\ninline int _min(const res &x,const res &y) {\n    return x<y?x:y;\n}\nconst int N=4e3+10;\nnamespace MAIN{\n    int n,k;\n    int sum[N][N];\n    int dp[N],siz[N];\n    struct Queue{\n        int x,l,r;\n        Queue() {}\n        Queue(res x,res l,res r):x(x),l(l),r(r) {}\n    }Q[N];\n    int he,ta;\n    inline void init(){\n        dp[0]=siz[0]=ta=0;\n        he=1;\n    }\n    inline int func(res i,res j,res lim){\n        return (sum[i][i]+sum[j][j]-sum[i][j]*2)/2+lim+dp[j];\n    }\n    inline void calc(res lim){\n        init();\n        Q[++ta]=Queue(0,1,n);\n        for(res i=1;i<=n;i++) {\n            while(he<ta&&Q[he].r<i)he++;\n            dp[i]=func(i,Q[he].x,lim),siz[i]=siz[Q[he].x]+1;\n            if(func(n,i,lim)>=func(n,Q[ta].x,lim))continue;\n            while(he<ta&&func(Q[ta].l,Q[ta].x,lim)>func(Q[ta].l,i,lim))ta--;\n            res l=Q[ta].l,r=Q[ta].r+1;\n            while(l<r){\n                res mid=(l+r)>>1;\n                if(func(mid,i,lim)<func(mid,Q[ta].x,lim))r=mid;\n                else l=mid+1;\n            }\n            Q[ta].r=r-1;\n            Q[++ta]=Queue(i,r,n);\n        }\n    }\n    inline void MAIN(){\n        res (*F)()=io::read<int>;\n        n=F(),k=F();\n        for(res i=1;i<=n;i++)\n            for(res j=1;j<=n;j++)\n                sum[i][j]=sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1]+F();\n        res l=0,r=sum[n][n];\n        while(l<r){\n            res mid=(l+r)>>1;\n            calc(mid);\n            if(siz[n]>k)l=mid+1;\n            else r=mid;\n        }\n        calc(r);\n        io::P(dp[n]-r*k);\n    }\n}\nint main(){\n    MAIN::MAIN();\n    io::output();\n    return 0;\n}\n```",
        "postTime": 1536325534,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010bzoj5311/CF321E\u3011\u8d1e\u9c7c/Ciel and Gondolas"
    },
    {
        "content": "\u5355\u8c03\u961f\u5217\u4f18\u5316 $dp$\n\n## \u9898\u76ee\u601d\u8def\n~~\u5f88\u5bb9\u6613\u5c31\u53ef\u4ee5\u770b\u51fa\u6765\u8fd9\u9053\u9898\u662f $dp$~~\uff0c\u5982\u679c\u8bbe $dp[i][j]$ \u8868\u793a $i$ \u4e2a\u4eba\u4f7f\u7528 $j$ \u6761\u8239\u7684\u6700\u4f18\u89e3\uff0c$sum[i][j]$ \u8868\u793a\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u5f88\u5bb9\u6613\u5c31\u53ef\u4ee5\u5f97\u51fa\u5f0f\u5b50\uff1a\n$$\ndp[i][j]=min(dp[k-1][j-1]+sum[k][i]/2),k\\in[j-1,i-1]\n$$\n$k$ \u7684\u53d6\u503c\u8303\u56f4\u662f\u8003\u8651\u4f18\u5316\u4e0d\u80fd\u8ba9\u524d\u9762\u7684\u8239\u7a7a\u4e86\uff0c\u4e5f\u4e0d\u80fd\u8ba9\u65b0\u6765\u7684\u8239\u6ca1\u4eba\u3002\n\n\u51b3\u7b56\u662f\u5177\u6709\u5355\u8c03\u6027\u7684\uff0c\u56e0\u6b64\u60f3\u5230\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316dp\u3002\n\n\u5982\u679c $dp[i][k]>dp[j][k]$ \u4e14 $i<j$ \u5219\u51b3\u7b56 $j$ \u6bd4 $i$ \u4f18\uff0c\u53ef\u4ee5\u786e\u5b9a\u51b3\u7b56 $i$\u4e0d\u4f1a\u88ab\u7528\u5230\u4e86\u5c31\u76f4\u63a5\u51fa\u961f\uff0c\u5916\u5c42\u679a\u4e3e\u8239\uff0c\u5185\u5c42\u679a\u4e3e\u4eba\uff0c\u53ef\u4ee5\u5bb9\u6613\u8bc1\u660e\u51b3\u7b56\u662f\u65e0\u540e\u6548\u6027\u7684\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u4eba\u4e8c\u5206\u67e5\u627e\u6700\u4f18\u89e3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nk\\log n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## $Code$\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nint n, dp[4005][4005], k, a[4005][4005], sum[4005][4005], head, tail;\t\t//dp[i][j]\u8868\u793a\u524di\u4e2a\u4eba\u7528j\u6761\u8239\u7684\u6700\u4f18\u89e3 \nstruct node{\n\tint num, l, r;\n}t;\ndeque<node> q;\n\ntemplate<typename T>\ninline void read(T&x){\n\tx = 0; char q; bool f = 1;\n\twhile(!isdigit(q = getchar()))\tif(q == '-')\tf = 0;\n\twhile(isdigit(q)){\n\t\tx = (x<<1) + (x<<3) + (q^48);\n\t\tq = getchar();\n\t}\n\tx = f?x:-x;\n}\n\ntemplate<typename T>\ninline void write(T x){\n\tif(x < 0){\n\t\tputchar('-');\n\t\tx = -x;\n\t}\n\tif(x > 9)\twrite(x/10);\n\tputchar(x%10^48);\n}\n\nint val(int k, int u, int v){\n\treturn dp[u][k-1]+(sum[u][u]+sum[v][v]-sum[u][v]-sum[v][u])/2;\n}\n\nint main(){\n\tread(n), read(k);\n\tfor(register int i = 1; i <= n; ++i)\n\t\tfor(register int j = 1; j <= n; ++j)\n\t\t\tread(a[i][j]);\n\tfor(register int i = 1; i <= n; ++i)\n\t\tfor(register int j = 1; j <= n; ++j)\n\t\t\tsum[i][j] = sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1]+a[i][j];\t\t//\u9884\u5904\u7406\u524d\u7f00\u548c \n\tmemset(dp, 0x3f, sizeof(dp));\n\tfor(register int i = 1; i <= n; ++i)\tdp[i][1] = sum[i][i]/2;\t\t\t//dp[i][1]\u8868\u793a\u524di\u4e2a\u5168\u57281\u6761\u8239\u4e0a\u7684\u60c5\u51b5 \n\tfor(register int j = 2; j <= k; ++j){\t\t\t\t\t\t\t\t\t//\u679a\u4e3e\u6bcf\u4e00\u6761\u8239 \n\t\tq.clear();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\u5355\u8c03\u961f\u5217\u521d\u59cb\u5316 \n\t\tt.num = 0, t.l = 1, t.r = n;\t\t\t\t\t\t\t\t\t\t//l,r\u8bb0\u5f55\u4eba\u5728\u8239\u7684\u533a\u95f4,num\u8bb0\u5f55\u6700\u4f18\u4eba\u6570 \n\t\tq.push_back(t);\n\t\tfor(register int i = 1; i <= n; ++i){\t\t\t\t\t\t\t\t//\u679a\u4e3e\u4eba\u6570 \n\t\t\twhile(q.size() > 1 && q.front().r < i)\tq.pop_front();\t\t\t//\u5f53\u8fd8\u5b58\u5728\u4e0d\u6b62\u4e00\u4e2a\u89e3\u4e14\u6700\u4f18\u4eba\u6570\u533a\u95f4\u5c0f\u4e8e\u9700\u6c42\u4eba\u6570i\u65f6\u76f4\u63a5\u51fa\u961f \n\t\t\tq.front().l = i;\t\t\t\t\t\t\t\t\t\t\t\t//\u6700\u5c0f\u4eba\u6570\u4e3ai \n\t\t\tdp[i][j] = val(j, q.front().num, i);\t\t\t\t\t\t\t//k\u6761\u8239i\u4e2a\u4eba\u6700\u4f18\u89e3\u7b49\u4e8ek-1\u6761\u8239\u9884\u5904\u7406\u6700\u4f18\u4eba\u6570+\u5269\u4f59\u4eba\u6570\u5728\u4e00\u6761\u8239\u4e0a\u7684\u503c \n\t\t\twhile(q.size() > 1 && val(j, i, q.back().l) <= val(j, q.back().num, q.back().l))\tq.pop_back();\n\t\t\tint l = q.back().l, r = q.back().r;\n\t\t\twhile(l < r){\t\t\t\t\t\t\t\t\t\t\t\t\t//\u4e8c\u5206\u67e5\u627e\u6700\u4f18\u957f\u5ea6 \n\t\t\t\tint mid = (l+r) >> 1;\n\t\t\t\tif(val(j, q.back().num, mid) >= val(j, i, mid))\tr = mid;\t//\u961f\u5c3e\u7684\u503c\u957f\u5ea6\u4e0e\u4e8c\u5206\u957f\u5ea6\u5224\u65ad \n\t\t\t\telse l = mid+1;\n\t\t\t}\n\t\t\tif(val(j, q.back().num, q.back().r) <= val(j, i, q.back().r))\tl++;\n\t\t\tif(l != q.back().l)\tq.back().r = l-1;\t\t\t\t\t\t\t//\u82e5\u8fb9\u754c\u4e0d\u5728\u961f\u4e2d\uff0c\u5219\u4fee\u6539\u961f\u5c3e \n\t\t\telse\tq.pop_back();\t\t\t\t\t\t\t\t\t\t\t//\u5426\u5219\u5c06\u961f\u5c3e\u5f39\u51fa \n\t\t\tif(l <= n){\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\u5c06\u7b2cp\u6761\u8239\u7684\u4fe1\u606f\u52a0\u5165\u961f\u4e2d \n\t\t\t\tt.num = i, t.l = l, t.r = n;\n\t\t\t\tq.push_back(t);\n\t\t\t}\n\t\t}\n\t}\n\twrite(dp[n][k]);\n\treturn 0;\n}\n```\n",
        "postTime": 1627606190,
        "uid": 128817,
        "name": "Zzzzzzzm",
        "ccfLevel": 6,
        "title": "CF321E Ciel and Gondolas\u9898\u89e3"
    },
    {
        "content": " http://www.elijahqi.win/archives/3794\n https://blog.csdn.net/elijahqi/article/details/80759000\n\n\u8bbedp[i][j]\u8868\u793a\u524di\u4e2a\u5206\u6210j\u6bb5\u7684\u4ee3\u4ef7\n\u4e8e\u662f\u6709\u6734\u7d20\u65b9\u7a0b\n\u7136\u540e\u5229\u7528\u51b3\u7b56\u5355\u8c03\u6027\u53ef\u4ee5\u4f18\u5316\u4e3an*k*log\n\u5373\u6211\u4eec\u8003\u8651\u5176\u4e2d\u4e24\u4e2a\u51b3\u7b56\u70b9j1,j2\u5bf9\u4e8e\u540e\u9762\u7684\u5f71\u54cd \u56e0\u4e3a\u8fd9\u4e2as\u662f\u5355\u589e\u7684 \u6240\u4ee5\u5982\u679cdp[j1]>dp[j2]\u4e14j1< j2\u90a3\u4e48 j1\u5c06\u4f1a\u6c38\u8fdc\u4e0d\u4f18  \u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u6bcf\u6b21\u589e\u52a0\u7684\u8fd9\u4e2a\u4e1c\u897f\u5e76\u4e0d\u662f\u5355\u8c03\u7684\n\u5373\u6211\u4eec\u8003\u8651\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u53bb\u659c\u7387\u4f18\u5316\u53ef\u4ee5\u53d1\u73b0 \u5c0f\u4e8e\u53f7\u53f3\u8fb9\u7684\u4e1c\u897f\u5e76\u4e0d\u5355\u8c03\u548c\u6240\u5728\u51b3\u7b56\u70b9\u6709\u5173\u6240\u4ee5\u65e0\u6cd5\u659c\u7387\u4f18\u5316 \u4f46\u662f\u5229\u7528\u6211\u4eec\u521a\u521a\u6240\u8bf4\u7684\u51b3\u7b56\u5355\u8c03\u6027\u6211\u4eec\u53ef\u4ee5\u505a\u5230\u4e00\u4e2alog \u5373\u6bcf\u6b21\u5165\u961f\u7684i\u65f6\u5019\u6bd4\u8f83\u4e00\u4e0b\u961f\u5c3e\u7684\u5143\u7d20\u76f8\u6bd4\u8d77\u6765\u8c01\u4e0d\u4f18\u7684\u65f6\u95f4\u65e9\u5982\u679c\u540e\u9762\u7684\u6bd4\u524d\u9762\u7684\u65e9\u8bf4\u660e\u961f\u5c3e\u4e00\u5b9a\u5f39\u51fa\n```\n#include<bits/stdc++.h>\nusing namespace std;\ninline char gc(){\n\tstatic char now[1<<16],*S,*T;\n\tif (T==S){T=(S=now)+fread(now,1,1<<16,stdin);if (T==S) return EOF;}\n\treturn *S++;\n}\ninline int read(){\n\tint x=0,f=1;char ch=gc();\n\twhile(!isdigit(ch)) {if (ch=='-') f=-1;ch=gc();}\n\twhile(isdigit(ch)) x=x*10+ch-'0',ch=gc();\n\treturn x*f;\n}\nconst int N=4040;\nconst int inf=0x3f3f3f3f;\nint n,k,sum,s[N][N],K,dp[N][1000],q[N];\ninline int gao(int x,int y){\n\treturn s[y][y]-s[y][x];\n}\ninline int calc(int x,int y){\n\tint l=y+1,r=n,res=n+1;\n\twhile(l<=r){\n\t\tint mid=l+r>>1;\n\t\tif (dp[x][k-1]+gao(x,mid)>=dp[y][k-1]+gao(y,mid)) res=mid,r=mid-1;else l=mid+1;\n\t}return res;\n}\nint main(){\n\tfreopen(\"bzoj5311.in\",\"r\",stdin);\n\tn=read();K=read();sum=0;\n\tfor (int i=1;i<=n;++i)\n\t\tfor (int j=1;j<=n;++j) if(j<=i) s[i][j]=read(),sum+=s[i][j];else read();\n\tfor (int i=1;i<=n;++i) for (int j=1;j<=i;++j) s[i][j]+=s[i-1][j];\n\tfor (int i=1;i<=n;++i) for (int j=1;j<=i;++j) s[i][j]+=s[i][j-1];\n\tfor (int i=0;i<=n;++i) dp[i][0]=inf;dp[0][0]=0;\n\tfor (k=1;k<=K;++k){\n\t\tint op=1,cl=1;q[op]=0;\n\t\tfor (int i=1,j;i<=n;++i){\n\t\t\twhile(op<cl&&calc(q[op],q[op+1])<=i)++op;\n\t\t\tj=q[op];dp[i][k]=dp[j][k-1]+gao(j,i);\n\t\t\twhile(op<cl&&calc(q[cl-1],q[cl])>=calc(q[cl],i)) --cl;\n\t\t\tq[++cl]=i;\n\t\t}\n\t\t//for (int i=1;i<=n;++i) printf(\"%d \",dp[i][k]);puts(\"\");\n\t}printf(\"%d\\n\",dp[n][K]);\n\treturn 0;\n}\n```\n\u5bf9\u4e8ek\u7684\u9650\u5236\u56e0\u4e3abzoj\u4e0a\u4ecd\u7136\u8fc7\u4e0d\u53bb\u6211\u4eec\u8003\u8651wqs\u4e8c\u5206\n\n\u5728wqs\u4e8c\u5206\u7684\u65f6\u5019\u6211\u9650\u5236\u4e86\u5982\u679c\u76f8\u540c\u53d6\u8d8a\u5c0f\u8d8a\u597d  \u56e0\u4e3a\u4f1a\u5b58\u5728\u4f8b\u59823\u7684\u65f6\u5019\u6bd4\u7b54\u6848\u59274\u7684\u65f6\u5019\u6bd4k\u5c0f \u56e0\u4e3a\u679a\u4e3e\u7684\u6574\u6570\u6240\u4ee5\u624d\u5bfc\u81f4\u6ca1\u6709\u5207\u4e0a\u5176\u5b9e\u662f\u4e24\u4e2a\u70b9\u90fd\u76f8\u5207\u9020\u6210\u7684\u5f71\u54cd\u90a3\u4e48\u6211\u4eec\u7b97\u7b54\u6848\u7684\u65f6\u5019\u5c31\u5fc5\u987b\u77e5\u9053\u7b54\u6848\u70b9\u88ab\u5c5e\u4e8e\u4e86\u54ea\u4e00\u4e2a\u5207\u70b9\n\n\u6ce8\u610f\u7ec6\u8282\uff01\uff01\uff01 \u53ef\u4ee5\u770b\u4ee3\u7801..\n```\n#include<bits/stdc++.h>\nusing namespace std;\ninline char gc(){\n\tstatic char now[1<<16],*S,*T;\n\tif (T==S){T=(S=now)+fread(now,1,1<<16,stdin);if (T==S) return EOF;}\n\treturn *S++;\n}\ninline int read(){\n\tint x=0,f=1;char ch=gc();\n\twhile(!isdigit(ch)) {if (ch=='-') f=-1;ch=gc();}\n\twhile(isdigit(ch)) x=x*10+ch-'0',ch=gc();\n\treturn x*f;\n}\nconst int N=4040;\nconst int inf=0x3f3f3f3f;\nint n,k,sum,s[N][N],K,dp[N],q[N],cnt[N];\ninline int gao(int x,int y){\n\treturn s[y][y]-s[y][x];\n}\ninline int calc(int x,int y){\n\tint l=y+1,r=n,res=n+1;\n\twhile(l<=r){\n\t\tint mid=l+r>>1;\n\t\tint t1=dp[x]+gao(x,mid),t2=dp[y]+gao(y,mid);\n\t\tif (t1>t2||(t1==t2&&cnt[x]>cnt[y])) res=mid,r=mid-1;else l=mid+1;\n\t}return res;\n}\ninline bool check(int mid){\n\tint op=1,cl=1;q[op]=0;\n\tfor (int i=1,j;i<=n;++i){\n\t\twhile(op<cl&&calc(q[op],q[op+1])<=i) ++op;\n\t\tj=q[op];dp[i]=dp[j]+gao(j,i)+mid;cnt[i]=cnt[j]+1;\n\t\twhile(op<cl&&calc(q[cl-1],q[cl])>calc(q[cl],i)) --cl;\n\t\tq[++cl]=i;\n\t}return cnt[n]<=K;\n}\nint main(){\n\tfreopen(\"bzoj5311.in\",\"r\",stdin);\n\tn=read();K=read();sum=0;\n\tfor (int i=1;i<=n;++i)\n\t\tfor (int j=1;j<=n;++j) if(j<=i) s[i][j]=read(),sum+=s[i][j];else read();\n\tfor (int i=1;i<=n;++i) for (int j=1;j<=i;++j) s[i][j]+=s[i-1][j];\n\tfor (int i=1;i<=n;++i) for (int j=1;j<=i;++j) s[i][j]+=s[i][j-1];\n\tint l=0,r=sum,ans=0,nm,v;\n\twhile(l<=r){\n\t\tint mid=l+r>>1;\n\t\tif(check(mid)) ans=dp[n]-mid*K,r=mid-1;else l=mid+1;\n\t}\n\t printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1529558512,
        "uid": 5037,
        "name": "elijahqi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF321E \u3010Ciel and Gondolas\u3011"
    }
]