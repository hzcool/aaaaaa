[
    {
        "content": "# CF1015F Bracket Substring\n\n[\u535a\u5ba2\u5185\u67e5\u770b](https://www.cnblogs.com/Hs-black/p/12295083.html)\n\n\u8fd9\u9898\u4e00\u773c[GT\u8003\u8bd5](https://www.luogu.com.cn/problem/P3193)\n\n\u9898\u610f: \u6c42\u6709\u591a\u5c11\u79cd\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\u8981\u6c42\u5b57\u7b26\u4e32S\u662f\u5176\u5b57\u4e32\n\n\u6570\u636e\u8303\u56f4\u5927\u6982\u662f\u4e00\u4e2a$\\Theta(n^3)$\u7684\u7b97\u6cd5\n\n\u4ece\u524d\u5f80\u540e\u586b\u62ec\u53f7, \u8bbe$F[i][j][k]$\u8868\u793a\u586b\u5230\u7b2c$i$\u4f4d, \"\u548c\"\u4e3a$j$, \u5339\u914d\u4e86$S k$\u4f4d, \u5176\u4e2d\u548c\u7684\u5b9a\u4e49\u4e3a\u5c06\u5de6\u62ec\u53f7\u770b\u505a1, \u53f3\u62ec\u53f7\u770b\u4f5c-1, \u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\u7684\u524d\u7f00\u548c\u603b\u5927\u4e8e\u7b49\u4e8e\u96f6\u4e14\u672c\u8eab\u7684\u548c\u4e3a\u96f6(\u4e00\u4e2a\u5de6\u62ec\u53f7\u4e00\u5b9a\u5339\u914d\u4e00\u4e2a\u53f3\u62ec\u53f7)\n\n$dp$\u65f6\u53ea\u9700\u679a\u4e3e\u4e0b\u4e00\u4f4d\u586b$'('$\u6216$')'$\u5373\u53ef, \u4f46\u8981\u6ce8\u610f\u7684\u662f\u5339\u914d$S$\u4e32\u65f6\u4ece\u7b2c$k$\u4f4d\u4e0d\u5339\u914d\u4e0d\u662f\u76f4\u63a5\u91cd\u65b0\u4ece0\u5f00\u59cb\u5339\u914d\u800c\u662f\u6c42\u51fa\u5b83\u7684$kmp$\u6570\u7ec4, \u627e\u5230\u4e0a\u4e00\u4e2a$border$, \u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\n\n```cpp\n#pragma GCC optimize(2)\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#define ll long long\nusing namespace std;\n\ntemplate <typename T>\nvoid read(T &x) {\n    x = 0; bool f = 0;\n    char c = getchar();\n    for (;!isdigit(c);c=getchar()) if (c=='-') f=1;\n    for (;isdigit(c);c=getchar()) x=x*10+(c^48);\n    if (f) x=-x;\n}\n\ntemplate <typename T>\nvoid write(T x) {\n    if (x < 0) putchar('-'), x = -x;\n    if (x >= 10) write(x / 10);\n    putchar('0' + x % 10);\n}\n\nconst int N = 305;\nchar s[N];\nll n, m;\nint g[N][2], nxt[N];\n\nvoid KMP(void) {\n\tint j = nxt[1] = 0;\n\tfor (int i = 2;i <= m; i++) {\n\t\twhile (j && s[i] != s[j+1]) j = nxt[j];\n\t\tif (s[i] == s[j+1]) j++;\n\t\tnxt[i] = j;\n\t}\n\tfor (int i = 0;i < m; i++) {\n\t\tint k = i, p = i;\n\t\twhile (k && s[k+1] != '(') k = nxt[k];\n\t\twhile (p && s[p+1] != ')') p = nxt[p];\n\t\tif (s[k+1] == '(') k++;\n\t\tif (s[p+1] == ')') p++;\n\t\tg[i][1] = k, g[i][0] = p;\n\t}\n\tg[m][0] = g[m][1] = m;\n}\n\nconst int P = 1e9+7;\nll f[N][N][N];\n\ninline void add(ll &x, ll y) {\n\tx += y; if (x >= P) x -= P;\n}\n\nint main() {\n\tread(n); int al = n << 1;\n\tscanf (\"%s\", s + 1);\n\tm = strlen(s + 1);\n\tKMP();\n\tf[0][0][0] = 1;\n\tfor (int i = 0; i < al; i++) {\n\t\tfor (int j = 0; j <= n; j++) {\n\t\t\tfor (int k = 0; k <= m; k++) {\n\t\t\t\tll t = f[i][j][k];\n\t\t\t\tif (j) add(f[i+1][j-1][g[k][0]], t);\n\t\t\t\tadd(f[i+1][j+1][g[k][1]], t);\n\t\t\t}\n\t\t}\n\t}\n\tcout << f[al][0][m] << endl;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1581404002,
        "uid": 122144,
        "name": "hs_black",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1015F \u3010Bracket Substring\u3011"
    },
    {
        "content": "\u4ece\u5de6\u5f80\u53f3\u52a0\u5b57\u7b26\uff0c\u5f04\u4e2a\u9884\u5904\u7406\u641e\u4e00\u4e0b\u3002\n\n\u8fd9\u9898\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u9996\u5148\u6211\u4eec\u9884\u5904\u7406\u51fa\u6765\u4e00\u4e2a\u4e8c\u7ef4\u6570\u7ec4 $len$.\n\n```\n\tpublic static int[,] len = new int[s.Length + 1, 2];\n```\n\n$len$ \u7684\u7b2c\u4e8c\u7ef4\u53ea\u53ef\u80fd\u662f0\u6216\u80051. $len_i,_j$ \u4ee3\u8868 $s$ \u53d6\u524di\u4e2a\u5b57\u7b26\uff0c\u540e\u9762\u52a0\u4e0a\u4e00\u4e2a'('\u6216\u8005')'\u4e4b\u540e\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32 $t$ , $t$ \u7684\u540e\u7f00\u6700\u591a\u80fd\u4e0e $s$ \u7684\u524d\u7f00\u5339\u914d\u591a\u5c11\u4f4d\u3002\n\n\u5047\u8bbe s = '())()', \u90a3\u4e48 $len_5,_1$ \u5c31\u662f $s$ \u53d6\u524d5\u4f4d\u518d\u52a0\u4e0a\u4e00\u4e2a')' \uff0c\u8fd9\u65f6 $t$ = '())()), $t$ \u7684\u540e\u7f00\u6700\u591a\u80fd\u4e0e $s$ \u7684\u524d\u7f00\u5339\u914d3\u4f4d\uff0c\u6240\u4ee5 $len_5,_1 = 3$. \u8fd9\u4e00\u6b65\u53ef\u4ee5\u66b4\u529b\u5b8c\u6210\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u7b97\u592a\u9ad8\u3002\u8fd9\u662f\u968f\u540eDp\u7684\u6839\u636e\u3002\n\n\u6b63\u5f0f\u7684Dp\u9700\u8981\u4e00\u4e2a\u56db\u7ef4\u6570\u7ec4\u3002\n\n```\n\tpublic static int[,,,] Dp = new int[(len << 1) + 5, (len << 1) + 5, s.Length + 5, 2];\n\n```\n\n\u4fdd\u9669\u8d77\u89c1\u8fd9\u91cc\u5f00\u7684\u5927\u4e86\u4e00\u70b9\u3002\u5177\u4f53\u542b\u4e49\u662f $Dp_i,_j,_k,_p$ \u4ee3\u8868\u641e\u4e00\u4e2a\u957f\u5ea6\u4e3a $i$ \u7684\u4e32\uff0c\u8fd9\u4e2a\u4e32\u4e2d\u5de6\u62ec\u53f7\u6570\u91cf\u51cf\u53bb\u53f3\u62ec\u53f7\u6570\u91cf\u4e3a $j$, \u8fd9\u4e2a\u4e32\u7684\u540e\u7f00\u4e0e $s$ \u7684\u524d\u7f00\u6700\u957f\u80fd\u591f\u5339\u914d $k$ \u4f4d\uff0c\u8fd9\u4e2a\u4e32\u4e2d\u662f\u5426\u5df2\u7ecf\u51fa\u73b0\u8fc7\u81f3\u5c11\u4e00\u6b21\u4e32 $s$\uff08$p=0$\u4ee3\u8868\u6ca1\u6709\uff0c$p=1$\u53cd\u4e4b\uff09\u3002\u6570\u503c\u4e3a\u6784\u6210\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\u7684\u4e32\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\u663e\u800c\u6613\u89c1 $Dp_0,_0,_0,_0 = 1$, \u9664\u6b64\u4e4b\u5916 $Dp$ \u6570\u7ec4\u4e2d\u6240\u6709\u7684\u503c\u90fd\u662f0.\n\n\u8fd9\u91cc\u7684\u8f6c\u79fb\u975e\u5e38\u7684\u66b4\u529b\uff0c\u51c6\u786e\u5730\u8bf4\u8fd9\u5e94\u8be5\u662f\u9012\u63a8\u800c\u975e\u52a8\u6001\u89c4\u5212\u3002\n\n```\n\tif(Global.Dp[i, j, k, fin] == 0) continue;\n\tif(j < len) {\n\t\tGlobal.Dp[i + 1, j + 1, Global.len[k, 0], fin | (Global.len[k, 0] == s.Length ? 1 : 0)] += Global.Dp[i, j, k, fin];\n\t\tGlobal.Dp[i + 1, j + 1, Global.len[k, 0], fin | (Global.len[k, 0] == s.Length ? 1 : 0)] %= mod;\n\t}\n\tif(j > 0) {\n\t\tGlobal.Dp[i + 1, j - 1, Global.len[k, 1], fin | (Global.len[k, 1] == s.Length ? 1 : 0)] += Global.Dp[i, j, k, fin];\n\t\tGlobal.Dp[i + 1, j - 1, Global.len[k, 1], fin | (Global.len[k, 1] == s.Length ? 1 : 0)] %= mod;\n\t}\n```\n\n\u867d\u7136\u5199\u7684\u590d\u6742\uff0c\u4f46\u662f\u5176\u601d\u8def\u662f\u975e\u5e38\u76f4\u89c2\u7684\uff0c\u679a\u4e3e\u4e00\u4e0b\u5f53\u524d\u7684\u72b6\u6001\uff0c\u8bd5\u7740\u5f80\u540e\u9762\u52a0\u4e00\u4e2a'(',\u8bd5\u7740\u5f80\u540e\u9762\u52a0\u4e00\u4e2a')',\u66f4\u65b0\u4e00\u4e0b\u3002\n\n\u524d\u9762 $i$ \u548c $j$ \u7684\u53d8\u5316\u5f88\u597d\u60f3\uff0c\u7b2c\u4e09\u7ef4\u6211\u4eec\u4fdd\u5b58\u7684\u662f\u8fd9\u4e2a\u4e32\u7684\u540e\u7f00\u4e0e $s$ \u7684\u524d\u7f00\u80fd\u591f\u5339\u914d\u7684\u6700\u5927\u957f\u5ea6\uff0c\u52a0\u4e0a\u4e86\u4e00\u4e2a\u5b57\u7b26\u5e94\u8be5\u5982\u4f55\u66f4\u65b0\uff1f\u8fd9\u5c31\u662f\u524d\u9762\u7b97\u7684 $len$ \u7684\u4f5c\u7528\u3002\u56e0\u4e3a\u6211\u4eec\u77e5\u9053\u5f53\u524d\u4e32\u540e $k$ \u4f4d\u548c $s$ \u7684\u524d $k$ \u4f4d\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u5982\u679c\u52a0\u4e0a\u4e00\u4e2a '(' \u540e\u65b0\u7684 $k$ \u4e0d\u5c31\u5e94\u8be5\u662f $len_k,_0$ \u5417\uff0c\u52a0\u4e0a ')' \u5219\u662f $len_k,_1$ \u56de\u987e $len$ \u7684\u5b9a\u4e49\uff0c\u4f1a\u53d1\u73b0\u6b64\u5904\u6b63\u597d\u662f\u8fd9\u79cd\u60c5\u51b5\u3002\n\nDp\u5b8c\u4e86\u4ee5\u540e\uff0c\u8fd8\u9700\u8981\u7d2f\u52a0\u4e00\u4e0b\u7b54\u6848\u3002\u6240\u6709 $Dp_2*_n,_0,_i,_1$ \u90fd\u662f\u7b26\u5408\u9898\u610f\u7684\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217\u751f\u6210\u65b9\u6848\u6570\uff0c\u52a0\u8d77\u6765\u5c31\u662f\u7b54\u6848\u3002\n\n\u5b8c\u6574\u7684\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\nusing System;\n\nnamespace CF1015F\n{\n    class Program\n    {\n\t\tpublic class Global \n\t\t{\n\t\t\tpublic static int[,] len;\n\t\t\tpublic static int[,,,] Dp;\n\t\t}\n\n\t\tstatic void Main(string[] args)\n        {\n\t\t\tconst int mod = 1000000007;\n\n\t\t\tint len = Convert.ToInt32(Console.ReadLine());\n\t\t\tstring s = Console.ReadLine(), t = \"\";\n\n\t\t\tGlobal.len = new int[s.Length + 1, 2];\n\t\t\tGlobal.Dp = new int[(len << 1) + 5, (len << 1) + 5, s.Length + 5, 2];\n\t\t\tGlobal.Dp[0, 0, 0, 0] = 1;\n\n\t\t\tif(s[0] == '(') Global.len[0, 0] = 1;\n\t\t\telse Global.len[0, 1] = 1;\n\t\t\tfor(int i = 0; i < s.Length; i++) {\n\t\t\t\tt += s[i];t += '(';\n\t\t\t\tGlobal.len[i + 1, 0] = Match(s, t);\n\t\t\t\tt = t.Remove(t.Length - 1, 1); t += ')';\n\t\t\t\tGlobal.len[i + 1, 1] = Match(s, t);\n\t\t\t\tt = t.Remove(t.Length - 1, 1);\n\t\t\t}\n\n\t\t\tfor(int i = 0; i < (len << 1); i++)\n\t\t\t\tfor(int j = 0; j <= len; j++)\n\t\t\t\t\tfor(int k = 0; k <= s.Length; k++) \n\t\t\t\t\t\tfor(int fin = 0; fin <= 1; fin++) {\n\t\t\t\t\t\t\tif(Global.Dp[i, j, k, fin] == 0) continue;\n\t\t\t\t\t\t\tif(j < len) {\n\t\t\t\t\t\t\t\tGlobal.Dp[i + 1, j + 1, Global.len[k, 0], fin | (Global.len[k, 0] == s.Length ? 1 : 0)] += Global.Dp[i, j, k, fin];\n\t\t\t\t\t\t\t\tGlobal.Dp[i + 1, j + 1, Global.len[k, 0], fin | (Global.len[k, 0] == s.Length ? 1 : 0)] %= mod;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(j > 0) {\n\t\t\t\t\t\t\t\tGlobal.Dp[i + 1, j - 1, Global.len[k, 1], fin | (Global.len[k, 1] == s.Length ? 1 : 0)] += Global.Dp[i, j, k, fin];\n\t\t\t\t\t\t\t\tGlobal.Dp[i + 1, j - 1, Global.len[k, 1], fin | (Global.len[k, 1] == s.Length ? 1 : 0)] %= mod;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\tint _count = 0, final_Len = len << 1;\n\t\t\tfor(int i = 0; i <= s.Length; i++) {\n\t\t\t\t_count += Global.Dp[final_Len, 0, i, 1];\n\t\t\t\t_count %= mod;\n\t\t\t}\n\n\t\t\tConsole.WriteLine(_count.ToString());\n\t\t}\n\n\t\tstatic int Match(string a,string t) {\n\t\t\tfor(int i = Math.Min(t.Length, a.Length); i > 0; i--)\n\t\t\t\tif(a.Substring(0, i) == t.Substring(t.Length - i, i))\n\t\t\t\t\treturn i;\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n```",
        "postTime": 1534257779,
        "uid": 78371,
        "name": "Mickey_snow",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1015F \u3010Bracket Substring\u3011"
    },
    {
        "content": "~~\u4e00\u9053\u826f\u5fc3\u7684 DP \u9898\u3002~~\n\n------------\n\n\u8003\u8651\u8bb0 $ dp_{i,j,k} $ \u8868\u793a\u524d $ i $ \u4e2a\u5b57\u7b26\uff0c\u548c\u7ed9\u5b9a\u4e32\u5339\u914d $ j $ \u4e2a\uff0c\u6709 $ k $ \u4e2a\u5f85\u5339\u914d\u5de6\u62ec\u53f7\u7684\u65b9\u6848\u6570\u3002\n\n\u8ba9 $ i $ \u4ece $ i - 1 $ \u8f6c\u79fb\u6765\u6bd4\u8f83\u56f0\u96be\uff0c\u53ef\u4ee5\u8ba9\u5176\u8f6c\u79fb\u5230 $ i + 1 $ \u3002\n\n\u679a\u4e3e\u9009\u7684\u662f\u5de6\u62ec\u53f7\u8fd8\u662f\u53f3\u62ec\u53f7\uff0c\u518d\u5957 KMP \u5373\u53ef\u3002\n\n------------\n\n\u4ee3\u7801\u5982\u4e0b \uff08~~\u975e\u5e38\u7b80\u5355~~)\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,s,l;\nconst int mo=1e9+7;\nint dp[202][202][202];\nint kmp[202];\nstring st;\nint main(){\n    cin>>n;\n    n=n*2;\n    cin>>st;\n    m=st.length();\n    st=\"@\"+st;\n    l=0;\n    for(register int i=2;i<=m;++i){\n        while(l && st[l+1]!=st[i])l=kmp[l];\n        if(st[l+1]==st[i])++l;\n        kmp[i]=l;\n    }\n    dp[0][0][0]=1;\n    for(register int i=0;i<n;++i){\n        for(register int j=0;j<=m;++j){\n            for(register int k=0;k<=i;++k){\n                l=j;\n                if(j<m){\n                    while(l && st[l+1]!='(')l=kmp[l];\n                    if(st[l+1]=='(')++l;\n                }\n                dp[i+1][l][k+1]=(dp[i+1][l][k+1]+dp[i][j][k])%mo;\n                if(!k)continue;\n                l=j;\n                if(j<m){\n                    while(l && st[l+1]!=')')l=kmp[l];\n                    if(st[l+1]==')')++l;\n                }\n                dp[i+1][l][k-1]=(dp[i+1][l][k-1]+dp[i][j][k])%mo;\n            }\n        }\n    }\n    cout<<dp[n][m][0]<<endl;\n    return 0;\n}\n```",
        "postTime": 1637300454,
        "uid": 218376,
        "name": "IloveSurtr",
        "ccfLevel": 7,
        "title": "CF1015F"
    },
    {
        "content": "# CF1015F - Bracket Substring\n>- \u94fe\u63a5\uff1ahttps://codeforces.com/problemset/problem/1015/F\n>- \u77e5\u8bc6\u70b9\uff1aDP\u3001KMP\u3001\u7ec4\u5408\u6570\u5b66\n>- \u96be\u5ea6\uff1a\u84dd\uff08*2300\uff09\n\n## \u9898\u610f\n- \u7ed9\u51fa\u4e00\u4e2a\u62ec\u53f7\u5e8f\u5217 $S(|S|\\leq 200)$\uff08\u53ef\u80fd\u4e0d\u5408\u6cd5\uff09\uff0c\u548c\u4e00\u4e2a\u6b63\u6574\u6570 $n(1\\leq n\\leq100)$\u3002\n- \u6c42\u51fa\u4ee5 $S$ \u4e3a**\u5b50\u4e32**\u7684\u3001\u957f\u5ea6\u4e3a $2n$\u7684\u3001\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\u6570\u91cf\u3002\n- \u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n## \u601d\u8def\n- \u5148\u8003\u8651\u53bb\u91cd\u95ee\u9898\u3002\n- \u5047\u5982 $S$ \u662f `()`\uff0c\u6211\u73b0\u5728\u9700\u8981\u5408\u6210 `()()`\uff0c\u53ef\u80fd\u5bfc\u81f4\u91cd\u590d\u3002\n- \u8003\u8651 KMP + DP\u3002\n- \u8bbe $dp[i][j][k]$ \u4e3a\u76ee\u524d\u4e3a\u65b0\u4e32\u7684\u7b2c $i$ \u4f4d\uff0c\u76ee\u524d\u5df2\u7ecf\u548c\u539f\u4e32\u7684\u7b2c $j$ \u4f4d\u5b8c\u6210\u914d\u5bf9\uff0c\u76ee\u524d `(` \u6bd4 `)` \u591a\u7684\u6570\u91cf\u4e3a $k$\u3002\n- \u8bbe $nxt2[i][0/1]$ \u4ee3\u8868\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u5df2\u7ecf\u548c $S$ \u7684\u7b2c $i$ \u4f4d\u4ea7\u751f\u4e86\u914d\u5bf9\uff0c\u5982\u679c\u63a5\u4e0b\u6765\u653e\u7684\u662f `(` \u6216 `)`\uff0c\u90a3\u4e48\u5c06\u4e0e $S$ \u7684\u54ea\u4e00\u4f4d\u4ea7\u751f\u914d\u5bf9\u3002\n- \u8f6c\u79fb\uff1a\n    - \u653e `(` $dp[i+1][pos][k+1]+=dp[i][j][k]$\uff0c\u5176\u4e2d \u5f53 $j=m$\u65f6\uff0c$pos=m$\uff0c\u5426\u5219$pos=nxt2[j][0]$\n    - \u653e `)` $dp[i+1][pos][k-1]+=dp[i][j][k]$\uff0c\u5176\u4e2d \u5f53 $j=m$\u65f6\uff0c$pos=m$\uff0c\u5426\u5219$pos=nxt2[j][1]$\n- \u6211\u4eec\u80fd\u53d1\u73b0\uff0c\u8fd9\u4e48\u8f6c\u79fb\u80fd\u6709\u6548\u907f\u514d\u91cd\u590d\u3002\n- \u91cd\u590d\u4ea7\u751f\u7684\u6839\u6e90\uff1a\u540c\u4e00\u4e2a\u4e32\u4e2d\u5305\u542b\u591a\u4e2a $S$\u3002\n- \u539f\u56e0\uff1a\u6ce8\u610f\u770b DP \u7684\u72b6\u6001 $dp[i][j][k]$ \u4e2d\u7684 $j$ \u4ee3\u8868\u76ee\u524d**\u5df2\u7ecf\u548c**\u539f\u4e32\u7684\u7b2c $j$ \u4f4d\u5b8c\u6210\u914d\u5bf9\u3002\n- \u5bf9\u4e8e\u67d0\u4e00\u79cd\u7b26\u5408\u9898\u610f\u7684\u65b9\u6848\uff0c\u4e00\u65e6\u5230\u4e86\u67d0\u4e00\u4f4d\uff0c\u4e0e $S$ \u6070\u597d\u4ea7\u751f\u4e86\u5b8c\u5168\u5339\u914d\uff0c\u90a3\u4e48\u5728\u8fd9\u4e4b\u540e\uff0c$j$ \u4e00\u76f4 $=|S|$\u3002\n- \u8fd9\u6837\u80fd\u4fdd\u8bc1\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u65b0\u4e32\uff0c\u6211\u5728\u72b6\u6001\u4e0a\u786e\u5b9a\u4e86\u5b83\u662f\u5426\u5df2\u7ecf\u4e0e $S$ \u4ea7\u751f\u4e86\u5339\u914d\uff0c\u6709\u6548\u907f\u514d\u91cd\u590d\u3002\n## \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#define int long long\nconst int N\t\t= 210;\nconst int MOD\t= 1e9+7;\nusing namespace std;\n\nint nxt[N],nxt2[N][2];\nint dp[N][N][N];\nchar T[N];\nint n,m;\n\nvoid GetNxt()\n{\n\tnxt[1]=0;\n\t\n\tint l=0;\n\tfor(int r=2; r<=m; r++)\n\t{\n\t\twhile(l>0 && T[r]!=T[l+1]) \n\t\t{\n\t\t\tl = nxt[l];\n\t\t}\n\t\tif(T[r] == T[l+1]) \n\t\t{\n\t\t\tl ++;\n\t\t}\n\t\tnxt[r] = l;\n\t}\n\t\n\tfor (int i=0; i<=m; i++)\n\t{\n\t\tif(T[i+1]=='(')\tnxt2[i][0] = i+1;\n\t\telse nxt2[i][0] = nxt2[ nxt[i] ][0];\n\t\t\n\t\tif(T[i+1]==')')\tnxt2[i][1] = i+1;\n\t\telse nxt2[i][1] = nxt2[ nxt[i] ][1];\n\t}\n}\n\nvoid Sol()\n{\n\tGetNxt();\n\t\n\tdp[0][0][0] = 1;\n\tfor (int i=0; i<=n; i++)\n\t{\n\t\tfor (int j=0; j<=m; j++)\n\t\t{\n\t\t\tfor (int k=0; k<=i; k++)\n\t\t\t{\n\t\t\t\tint tmp = nxt2[j][0];\n\t\t\t\tif(j==m)tmp = m;\n\t\t\t\tif(k+1<=i+1)dp[i+1][tmp][k+1] += dp[i][j][k], dp[i+1][tmp][k+1]%=MOD;\n\t\t\t\t\n\t\t\t\ttmp = nxt2[j][1];\n\t\t\t\tif(j==m)tmp = m;\n\t\t\t\tif(k-1>=0)dp[i+1][tmp][k-1] += dp[i][j][k], dp[i+1][tmp][k-1]%=MOD;\n\t\t\t}\n\t\t}\n\t}\n\tint ans = dp[n][m][0];\n\tprintf(\"%lld\\n\",ans);\n}\n\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tn*=2;\n\tscanf(\"%s\",T+1);\n\tm=strlen(T+1);\n\tSol();\n\t\n\treturn 0;\n}\n```",
        "postTime": 1659667742,
        "uid": 36285,
        "name": "\u6c27\u5c11Kevin",
        "ccfLevel": 4,
        "title": "CF1015F - Bracket Substring"
    },
    {
        "content": "\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u81ea\u52a8\u673a\u6765\u7406\u89e3\u3002\n\n\u5efa\u51fa\u62ec\u53f7\u5e8f\u5217\u7684$AC$\u81ea\u52a8\u673a\uff0c\u5904\u7406\u51fa\u4e0a\u9762\u6bcf\u4e00\u4e2a\u70b9\u52a0\u4e0a'('\u6216')'\u4e4b\u540e\u80fd\u5230\u8fbe\u7684\u8282\u70b9\u3002\n\n\u8bb0$dp[i][j][k]$\u8868\u793a\u6709\u51e0\u4e2a\u957f\u5ea6\u4e3a$i$\u7684\u4e32\uff0c\u5f53\u524d\u5728\u81ea\u52a8\u673a\u7684\u7b2c$j$\u4e2a\u8282\u70b9\uff0c\u62ec\u53f7\u5e8f\u5217\u4e2d'('\u6bd4')'\u591a$k$\u4e2a\uff08\u5fc5\u987b\u4fdd\u8bc1$k>0$\uff09\u3002\n\n\u6700\u540e\u7b54\u6848\u5373\u4e3a$dp[2*n][len][0]$\u3002\n\n\u4e3a\u4e86\u9632\u6b62\u5728\u586b\u7684\u8fc7\u7a0b\u4e2d\u5df2\u7ecf\u5230\u8fbe\u7ec8\u70b9\u5374\u53c8\u56de\u5230\u4e4b\u524d\u7684\u70b9\uff0c\u5f3a\u5236\u4ee4\u7ec8\u70b9\u52a0'('\u548c')'\u4e4b\u540e\u5230\u8fbe\u7684\u70b9\u90fd\u662f\u7ec8\u70b9\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n^3)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<math.h>\nusing namespace std;\n\nconst int N=205;\nconst int mod=1e9+7;\nint n,len,ot[2][N];\nint a[N],fail[N],dp[N][N][N];\nchar s[N];\n\nvoid inc(int &x,int y)\n{\n\tx+=y;\n\tif(x>=mod) x-=mod;\n}\n\nvoid init()\n{\n\tscanf(\"%d\",&n);int i;\n\tscanf(\"%s\",s+1);\n\tlen=strlen(s+1);\n\tfor(i=1;i<=len;++i) a[i]=(s[i]==')');\n}\n\nvoid prework()\n{\n\tint las=0,i;\n\tfor(i=2;i<=len;++i)\n\t{\n\t\twhile(las&&a[las+1]!=a[i]) las=fail[las];\n\t\tif(a[las+1]==a[i]) fail[i]=++las; \n\t}\n\t\n\tot[a[1]][0]=1;\n\tfor(i=1;i<len;++i)\n\t{\n\t\tot[a[i+1]][i]=i+1;\n\t\tint nw=fail[i];\n\t\twhile(nw&&a[nw+1]==a[i+1]) nw=fail[nw];\n\t\tif(a[nw+1]!=a[i+1]) ot[a[nw+1]][i]=nw+1;\n\t}\n\tot[0][len]=ot[1][len]=len;\n}\n\nvoid DP()\n{\n\tint i,j,k;dp[0][0][0]=1;\n\tfor(i=0;i<2*n;++i)\n\t\tfor(j=0;j<=len;++j)\n\t\t\tfor(k=0;k<=n;++k)\n\t\t\t{\n\t\t\t\tint gg=dp[i][j][k];\n\t\t\t\tif(!gg) continue;\n\t\t\t\tif(k+1<=n) inc(dp[i+1][ot[0][j]][k+1],gg);\n\t\t\t\tif(k) inc(dp[i+1][ot[1][j]][k-1],gg);\n\t\t\t}\n\t\n\tprintf(\"%d\\n\",dp[2*n][len][0]);\n}\n\nint main()\n{\n\tinit();prework();DP();\n\treturn 0;\n}\n\n```",
        "postTime": 1558621427,
        "uid": 31435,
        "name": "hwk0518",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1015F \u3010Bracket Substring\u3011"
    },
    {
        "content": "\u4ece\u5de6\u5f80\u53f3\u52a0\u5b57\u7b26\u3002\u6ce8\u610f\u91cd\u590d\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#define int long long\nusing namespace std;\nconst int mod=1e9+7,N=205;\nint n,Nxt[N],len;\nchar s[N];\ninline void init(){\n\tscanf(\"%lld\",&n);\n\tscanf(\"%s\",s+1); len=strlen(s+1);\n}\ninline void Fail(){\n\tNxt[1]=0;\n\tfor (int i=2,j=0;i<=len;i++){\n\t\twhile (j&&s[j+1]!=s[i]) j=Nxt[j];\n\t\tif (s[j+1]==s[i]) j++;\n\t\tNxt[i]=j;\n\t}\n}\nint dp[N][N][N][2];\nint dfs(int now,int pos,int ds,bool ok){\n\tif (ds<0||ds>n) return 0;\n\tif (!now) return !ds&&ok;\n\tif (~dp[now][pos][ds][ok]) return dp[now][pos][ds][ok];\n\tint &ans=dp[now][pos][ds][ok],t; ans=0;\n\tfor (t=pos;t&&s[t+1]!=')';t=Nxt[t]); t+=(s[t+1]==')'); ans+=dfs(now-1,t,ds-1,ok|(t==len));\n\tfor (t=pos;t&&s[t+1]!='(';t=Nxt[t]); t+=(s[t+1]=='('); ans+=dfs(now-1,t,ds+1,ok|(t==len));\n\treturn ans%mod;\n}\ninline void solve(){\n\tFail();\n\tmemset(dp,-1,sizeof(dp));\n\tprintf(\"%lld\\n\",dfs(n*2,0,0,0));\n}\nsigned main(){\n\tinit();\n\tsolve();\n\treturn 0;\n} \n```",
        "postTime": 1533285559,
        "uid": 34444,
        "name": "\u5927\u83dc\u9e21fks",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1015F \u3010Bracket Substring\u3011"
    }
]