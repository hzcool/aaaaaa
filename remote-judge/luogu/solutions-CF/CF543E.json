[
    {
        "content": "\u611f\u89c9\u5b98\u65b9\u9898\u89e3\u548c @x\u4e49x \u7684\u9898\u89e3\u5199\u7684\u90fd\u4e0d\u662f\u5f88\u6e05\u695a\uff08\u4e5f\u53ef\u80fd\u662f\u6211\u592a\u83dc\u4e86\uff09\uff0c\u6240\u4ee5\u7a0d\u5fae\u8865\u5145\u4e00\u4e0b\u3002\n\n\u6211\u4eec\u8981\u8ba9\u5c0f\u4e8e $x$ \u7684\u6570\u6700\u5c11\uff0c\u5373\u8ba9\u5927\u4e8e\u7b49\u4e8e $x$ \u7684\u6570\u6700\u591a\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u5927\u4e8e\u7b49\u4e8e $x$ \u7684 $a_i$\uff0c\u5c06\u80fd\u8986\u76d6\u5230\u5b83\u7684\u5de6\u7aef\u70b9\u7684\u533a\u95f4\u52a0\u4e0a $1$\uff0c\u8fd9\u6837\u5b50\u67e5\u8be2 $[l,r]$ \u4e2d\u7684\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u4e86\u3002\n\n\u4ecd\u7136\u7528\u4e0a\u9762\u7684\u601d\u8def\uff0c\u4f46\u662f\u6211\u4eec\u8003\u8651\u7528\u5206\u5757\u7ef4\u62a4\u8fd9\u4e2a\u533a\u95f4\u52a0 $1$ \u533a\u95f4\u6c42\u6700\u5927\u503c\u3002\n\n\u8fd9\u4e2a\u5f88\u597d\u5206\u5757\u7ef4\u62a4\uff1a\u5bf9\u4e8e\u6574\u5757\uff0c\u6211\u4eec\u76f4\u63a5\u6253\u6807\u8bb0\u5373\u53ef\uff1b\u5bf9\u4e8e\u6563\u5757\uff0c\u6211\u4eec\u66b4\u529b\u52a0\u5e76\u66f4\u65b0\u5757\u5185\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u7136\u800c\u6211\u4eec\u4e0d\u53ef\u80fd\u628a\u6bcf\u6b21\u533a\u95f4\u52a0\u5b8c\u540e\u7684\u5e8f\u5217\u90fd\u5b58\u4e0b\u6765\uff0c\u6240\u4ee5\u8003\u8651\u5bf9\u4fee\u6539\u5206\u5757\uff0c\u53ea\u5b58\u4e0b\u6bcf\u5757\u5185\u7b2c\u4e00\u6b21\u4fee\u6539\u524d\u7684\u5e8f\u5217\u3002\u8fd9\u6837\u5b50\u6211\u4eec\u5c31\u8fd8\u9700\u8981\u8fdb\u884c $\\mathcal{O}(\\sqrt{n})$ \u6b21\u533a\u95f4\u52a0 $1$\uff0c\u6bcf\u6b21\u8981\u6c42 $\\mathcal{O}(1)$\u3002\u7136\u800c\u5b58 $\\sqrt{n}$ \u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\u8fd8\u662f\u5b58\u4e0d\u4e0b\u3002\n\n\u5047\u8bbe\u5df2\u7ecf\u6267\u884c\u4e86\u6240\u6709 $\\geq x$ \u7684\u4fee\u6539\uff0c\u90a3\u4e48\u8003\u8651\u4fee\u6539\u540e\u7684\u5dee\u5206\u6570\u7ec4\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u4f1a\u5728 $a_{i+m}\\geq x\\land a_i<x$ \u7684\u4f4d\u7f6e\u52a0\u4e0a $1$\uff0c\u5728 $a_{i+m}<x\\land a_i\\geq x$ \u7684\u4f4d\u7f6e\u51cf\u53bb $1$\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5b58\u4e0b\u6bcf\u5757\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u5c31\u53ef\u4ee5\u8fd8\u539f\u51fa\u6574\u4e2a\u5e8f\u5217\u4e86\u3002\n\n\u7136\u540e\u8003\u8651\u600e\u4e48 $\\mathcal{O}(1)$ \u5b9e\u73b0\u4fee\u6539\u3002\u5bf9\u4e8e\u6574\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6807\u8bb0\u5dee\u5206\uff1b\u5bf9\u4e8e\u6563\u5757\uff0c\u5728\u9884\u5904\u7406\u65f6\u8bb0\u4e0b\u6bcf\u4e2a\u4fee\u6539\u6267\u884c\u5b8c\u540e\u5b83\u5de6\u53f3\u7aef\u70b9\u6240\u5728\u5757\u7684\u6700\u5927\u503c\uff0c\u7136\u540e\u8986\u76d6\u6389\u5f53\u524d\u7684\u5373\u53ef\u3002\n\n\u4ee3\u7801\u548c @x\u4e49x \u7684\u5dee\u4e0d\u591a\uff0c\u5c31\u4e0d\u8d34\u4e86\u3002",
        "postTime": 1595944460,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF543E \u3010Listening to Music\u3011"
    },
    {
        "content": "\u5e7f\u544a\uff1a\u98df\u7528[$blog$](https://www.cnblogs.com/heyujun/p/10208715.html)\u4f53\u9a8c\u66f4\u4f73\n\n\u5148\u8f6c\u5316\u4e00\u4e2a\u6761\u4ef6\uff1a\n\n\u5c0f\u4e8e$x$\u7684\u6700\u5c0f$=$\u5927\u4e8e\u7b49\u4e8e$x$\u7684\u6700\u591a\n\n\u5219\u6211\u4eec\u5c31\u662f\u8981\u67e5\u8be2\u5927\u4e8e\u7b49\u4e8e$x$\u7684\u6700\u591a\n\u7136\u540e\u518d\u7528$m$\u51cf\u53bb\u5373\u53ef\u3002\n\n\u90a3\u4e48\u600e\u4e48\u505a\u5462\uff1f\n\n\u6211\u4eec\u6309\u7167\u6743\u503c\u4ece\u5927\u5230\u5c0f\u5c06\u6240\u6709\u4f4d\u7f6e\u6392\u5e8f\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u6211\u4eec\u8bbe\u5b83\u539f\u4f4d\u7f6e\u5728$i$\uff0c\n\n\u5c06\u5de6\u7aef\u70b9\u5728\u539f\u4f4d\u7f6e$x$\u65f6\u80fd\u8986\u76d6\u5230$i$\u7684\u4f4d\u7f6e\u6253\u4e0a\u6807\u8bb0\n\n\u4f9d\u6b21\u6309\u7167\u503c\u57df\u5efa\u6811\uff0c\u6bcf\u6b21\u4e8c\u5206\u67e5\u627e\u5230\u6700\u540e\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u67e5\u8be2\u6570\u7684\n\n\u8be2\u95ee\u533a\u95f4\u6700\u5927\u503c\u5373\u53ef\u3002\n\n$tips:$\u8fd9\u9898\u5361\u7a7a\u95f4\uff0c\u8981\u7528\u5230\u4e00\u4e9b\u7a7a\u95f4\u4f18\u5316\u3002\n\n\u4ee3\u7801\n```cpp\n#include <iostream> \n#include <cstdio> \n#include <cstdlib> \n#include <cstring> \n#include <cmath> \n#include <algorithm> \nusing namespace std; \ninline int gi() { \n    register int data = 0, w = 1; \n    register char ch = 0; \n    while (!isdigit(ch) && ch != '-') ch = getchar(); \n    if (ch == '-') w = -1, ch = getchar(); \n    while (isdigit(ch)) data = 10 * data + ch - '0', ch = getchar(); \n    return w * data; \n}\ntypedef unsigned long long ull; \n#define lson t[o].ls\n#define rson t[o].rs\n#define lmax (l == mid ? int(lson) : int(t[lson].mx))\n#define rmax (mid + 1 == r ? int(rson) : int(t[rson].mx))\nconst int INF = 1e9;\nconst int MAX_N = 2e5 + 5; \nstruct Node {\n    ull mx : 18, ls : 23, rs : 23; \n} t[MAX_N * 40]; \nint tot = 0, rt[MAX_N];\nint modify(int p, int l, int r, int ql, int qr) {\n    if (l == r) { return p + 1; } \n    int o = ++tot; t[o] = t[p];\n    if (ql <= l && r <= qr) return ++t[o].mx, o;\n    int mid = (l + r) >> 1, tag = t[o].mx - max(lmax, rmax); \n    if (ql <= mid) lson = modify(t[p].ls, l, mid, ql, qr);\n    if (qr > mid) rson = modify(t[p].rs, mid + 1, r, ql, qr);\n    t[o].mx = max(lmax, rmax);\n    t[o].mx += tag;\n    return o; \n}\nint query(int o, int l, int r, int ql, int qr) {\n    if (l == r) return o; \n    if (ql <= l && r <= qr) return t[o].mx;\n    int mid = (l + r) >> 1, res = 0, tag = t[o].mx - max(lmax, rmax);\n    if (ql <= mid) res = max(res, query(lson, l, mid, ql, qr));\n    if (qr > mid) res = max(res, query(rson, mid + 1, r, ql, qr));\n    return res + tag; \n}\nint N, M;\npair<int, int> a[MAX_N]; \nint main () {\n    N = gi(), M = gi();\n    for (int i = 1; i <= N; i++) a[i].first = 0 - gi(), a[i].second = i;\n    sort(&a[1], &a[N + 1]);\n    for (int i = 1; i <= N; i++) {\n        int ql = max(1, a[i].second - M + 1);\n        int qr = min(a[i].second, N - M + 1);\n        rt[i] = modify(rt[i - 1], 1, N - M + 1, ql, qr); \n    }\n    int Q = gi(), ans = 0;\n    while (Q--) {\n        int l = gi(), r = gi(), x = gi();\n        x ^= ans;\n        int id = upper_bound(&a[1], &a[N + 1], make_pair(-x, INF)) - a - 1;\n        printf(\"%d\\n\", ans = M - query(rt[id], 1, N - M + 1, l, r)); \n    } \n    return 0; \n} \n```",
        "postTime": 1546413780,
        "uid": 42506,
        "name": "\u4f55\u4fde\u5747",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF543E \u3010Listening to Music\u3011"
    },
    {
        "content": "\u600e\u4e48\u90fd\u662f\u4e3b\u5e2d\u6811\u5361\u7a7a\u95f4\u505a\u6cd5\u2026\u2026\u6765\u4e2a\u5b98\u65b9\u7684\u5206\u5757\u89e3\u6cd5\u5427\u3002\n\n\u4e00\u5f00\u59cb\u7684\u601d\u8def\u5f88\u7b80\u5355\uff0c\u9996\u5148\u8f6c\u5316\u6210\u6c42\u5927\u4e8e\u7b49\u4e8e $q$ \u7684\u5143\u7d20\u6570\u76ee\uff08\u4e2a\u4eba\u611f\u89c9\u66f4\u597d\u7406\u89e3\uff1f\uff09\uff0c\u90a3\u4e48\u5c31\u662f\u4ece\u5927\u5230\u5c0f\u679a\u4e3e $a_i$\uff0c\u7136\u540e\u5bf9 $[i-m+1,i]$ \u533a\u95f4\u52a0\u4e00\uff0c\u8be2\u95ee\u5c31\u662f\u533a\u95f4\u6c42 max\u3002\u4f46\u662f\u8fd9\u9898\u5f3a\u5236\u5728\u7ebf+\u5361\u7a7a\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5206\u5757\u3002\n\n\u8003\u8651\u5bf9\u5e8f\u5217\u5206\u5757\u518d\u5bf9\u4fee\u6539\u5206\u5757\uff0c\u5bf9\u4fee\u6539\u5206\u5757\u7684\u610f\u601d\u5c31\u662f\u6211\u4eec\u53ea\u5b58 $\\sqrt n$ \u4e2a\u7248\u672c\u3002\u6574\u5757\u7684\u4fee\u6539\u5f88\u597d\u641e\uff0c\u548c\u666e\u901a\u5e8f\u5217\u5206\u5757\u4e00\u6837\uff0c\u6574\u5757\u6253tag\u8fb9\u89d2\u66b4\u529b\u4fee\u6539\u3002\n\n\u8003\u8651\u5269\u4e0b\u7684 $\\sqrt n$ \u4e2a\u8fb9\u89d2\u4fee\u6539\u3002\u5982\u679c\u6309\u4e0a\u9762\u7684\u65b9\u6cd5 $O(\\sqrt n)$ \u4fee\u6539\u90a3\u5fc5\u7136\u65e0\u6cd5\u63a5\u53d7\u3002\u6574\u5757\u4f9d\u7136\u53ef\u4ee5\u5dee\u5206\u6253tag\uff0c\u5bf9\u4e8e\u4e24\u4e2a\u8fb9\u89d2\u5757\u6211\u4eec\u76f4\u63a5\u9884\u5904\u7406\u5b83\u7684 max \u8986\u76d6\u6389\u539f\u6765\u7684\u7b54\u6848\u3002\uff08\u6b64\u5904 max \u4e0d\u8003\u8651\u8fb9\u89d2\u4fee\u6539\u7684\u6574\u5757 tag \u7684\u8d21\u732e\uff0c\u4f46\u662f\u8003\u8651\u6574\u5757\u4fee\u6539\u7684\u6574\u5757 tag \u7684\u8d21\u732e\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u65f6\u5019\u6211\u4eec\u4f1a\u628a\u5b83\u548c\u8fb9\u89d2\u4fee\u6539\u7684\u6574\u5757 tag \u52a0\u4e00\u8d77\uff0c\u6211\u88ab\u8fd9\u4e2a\u8ff7\u60d1\u4e86\u5f88\u4e45\uff09\n\n\u8be2\u95ee\u5c31\u5f88\u597d\u641e\u4e86\uff0c\u8fd8\u662f\u8fb9\u89d2\u66b4\u529b\u6574\u5757\u67e5tag\u3002\n\n\u4ee3\u7801\u91cc\u6bcf\u4e2a\u7248\u672c\u9664\u4e86\u6574\u5757 max \u53ea\u5b58\u4e86\u6bcf\u4e00\u5757\u5f00\u5934\u7684\u5143\u7d20\uff0c\u5176\u5b9e\u663e\u7136\u662f\u548c\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u5b58\u7b49\u4ef7\u7684\u3002\n\n\u6709\u4e9b\u7ec6\u8282\u8fd8\u662f\u9700\u8981\u6ce8\u610f\u7684\uff0c\u6709\u9700\u8981\u7684\u8bdd\u5efa\u8bae\u591a\u8bfb\u51e0\u904d\u4ee3\u7801\u3002\uff08\u8fd9\u4e2a\u9b3c\u4e1c\u897f\u771f\u7684\u80fd\u8bfb\u5417\uff1f\uff09\n\n\u4e0d\u51fa\u610f\u5916\u559c\u63d0\u6700\u52a3\u89e3\u3002\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int maxN=200005,LEN=450;\nint N,M,Q,len,cntb; //len \u5757\u957f\uff0ccntb \u5757\u6570 \nint bg[LEN],ed[LEN]; //bg \u5757\u5f00\u5934\u7f16\u53f7\uff0ced \u5757\u7ed3\u5c3e\u7f16\u53f7 \nint inb[maxN]; //inb \u5143\u7d20\u5904\u5728\u7684\u5757\u7684\u7f16\u53f7 \nint A[maxN],id[maxN];\nbool cmp(int a,int b){\n\treturn A[a]>A[b];\n}\nint Lpos[maxN],Rpos[maxN]; //\u4fee\u6539\u64cd\u4f5c\u7684\u5de6\u53f3\u7aef\u70b9\u7f16\u53f7 \nint Linb[maxN],Rinb[maxN]; //\u4fee\u6539\u64cd\u4f5c\u7684\u5de6\u53f3\u7aef\u70b9\u6240\u5728\u5757\u7f16\u53f7 \nint Lans[maxN],Rans[maxN]; //\u4fee\u6539\u64cd\u4f5c\u7684\u5de6\u53f3\u7aef\u70b9\u6240\u5728\u5757\u7684\u7b54\u6848 \n\nint ans[LEN],val[maxN],lzy[LEN];\nint ANS[LEN][LEN],bgval[LEN][LEN];\n\nvoid init(){\n\tscanf(\"%d%d\",&N,&M);\n\tlen=sqrt(N);\n\tfor(int i=1;i<=N;i++) inb[i]=(i-1)/len+1,bg[inb[i]]=(bg[inb[i]]?bg[inb[i]]:i),ed[inb[i]]=i;cntb=inb[N];\n\t\n\tfor(int i=1;i<=N;i++) scanf(\"%d\",&A[i]),id[i]=i;\n\tsort(id+1,id+N+1,cmp);\n\t\n\tfor(int i=1;i<=N;i++){\n\t\tLpos[i]=max(1,id[i]-M+1),Rpos[i]=id[i];\n\t\tLinb[i]=inb[Lpos[i]],Rinb[i]=inb[Rpos[i]];\n\t\tif(inb[i]!=inb[i-1]){ //\u5b58\u50a8\u7248\u672c\uff0cpushdown tag\uff0c\u4fdd\u8bc1 LansRans \u6709\u5b8c\u6574\u4fee\u6539\u7684 tag \u800c\u6ca1\u6709\u8fb9\u89d2\u4fee\u6539\u7684 tag \n\t\t\tfor(int j=1;j<=N;j++) val[j]+=lzy[inb[j]];\n\t\t\tfor(int j=1;j<=cntb;j++)\n\t\t\t\tANS[inb[i]][j]=ans[j],bgval[inb[i]][j]=val[bg[j]],lzy[j]=0;\n\t\t}\n\t\t//\u4fee\u6539 \n\t\tif(Linb[i]==Rinb[i]){\n\t\t\tfor(int j=Lpos[i];j<=Rpos[i];j++) val[j]++,ans[inb[j]]=max(ans[inb[j]],val[j]+lzy[inb[j]]);\n\t\t\tfor(int j=bg[Linb[i]];j<=ed[Linb[i]];j++) Lans[i]=max(Lans[i],val[j]);\n\t\t}\n\t\telse{\n\t\t\tfor(int j=Lpos[i];j<=ed[Linb[i]];j++) val[j]++,ans[inb[j]]=max(ans[inb[j]],val[j]+lzy[inb[j]]);\n\t\t\tfor(int j=Linb[i]+1;j<=Rinb[i]-1;j++) lzy[j]++,ans[j]++;\n\t\t\tfor(int j=bg[Rinb[i]];j<=Rpos[i];j++) val[j]++,ans[inb[j]]=max(ans[inb[j]],val[j]+lzy[inb[j]]);\n\t\t\tfor(int j=bg[Linb[i]];j<=ed[Linb[i]];j++) Lans[i]=max(Lans[i],val[j]);\n\t\t\tfor(int j=bg[Rinb[i]];j<=ed[Rinb[i]];j++) Rans[i]=max(Rans[i],val[j]);\n\t\t}\n\t}\n}\n\nint lstans;\nint brute_query(int L,int R,int bid,int tmp,int q){\n\tint ANS=0;\n\tfor(int i=bg[bid];i<L;i++) tmp+=(A[i+M]>=q)-(A[i]>=q);\n\tfor(int i=L;i<=R;i++) ANS=max(ANS,tmp),tmp+=(A[i+M]>=q)-(A[i]>=q);\n\treturn ANS;\n}\n\nint main(){\n\tinit();\n\tscanf(\"%d\",&Q);\n\twhile(Q--){\n\t\tint QL,QR,QQ,QX;scanf(\"%d%d%d\",&QL,&QR,&QQ);QQ^=lstans;\n\t\tA[N+1]=QQ;QX=upper_bound(id+1,id+N+1,N+1,cmp)-id-1;\n\t\tmemset(lzy,0,sizeof(lzy));\n\t\tfor(int i=1;i<=cntb;i++) ans[i]=ANS[inb[QX]][i];\n\t\tint bgvalL=bgval[inb[QX]][inb[QL]],bgvalR=bgval[inb[QX]][inb[QR]];\n\t\tfor(int i=bg[inb[QX]];i<=QX;i++){\n\t\t\tans[Linb[i]]=Lans[i];\n\t\t\tif(Linb[i]!=Rinb[i]) ans[Rinb[i]]=Rans[i],lzy[Linb[i]+1]++,lzy[Rinb[i]]--; \n\t\t\tif(Lpos[i]<=bg[inb[QL]]&&bg[inb[QL]]<=Rpos[i]) bgvalL++;\n\t\t\tif(Lpos[i]<=bg[inb[QR]]&&bg[inb[QR]]<=Rpos[i]) bgvalR++;\n\t\t}\n\t\tfor(int i=1;i<=cntb;i++) lzy[i]+=lzy[i-1];\n\t\tint ANS=0;\n\t\tif(inb[QL]==inb[QR]) ANS=brute_query(QL,QR,inb[QL],bgvalL,QQ);\n\t\telse{\n\t\t\tANS=max(ANS,brute_query(QL,ed[inb[QL]],inb[QL],bgvalL,QQ));\n\t\t\tANS=max(ANS,brute_query(bg[inb[QR]],QR,inb[QR],bgvalR,QQ));\n\t\t\tfor(int i=inb[QL]+1;i<=inb[QR]-1;i++)\n\t\t\t\tANS=max(ANS,ans[i]+lzy[i]);\n\t\t}\n\t\tprintf(\"%d\\n\",lstans=M-ANS);\n\t}\n\n\treturn 0;\n}\n\n```",
        "postTime": 1593908085,
        "uid": 58567,
        "name": "x\u4e49x",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF543E \u3010Listening to Music\u3011"
    },
    {
        "content": "### [\u9898\u9762](https://www.luogu.org/problemnew/show/CF543E)\n\n**\u7a7a\u95f4\u53ea\u6709$64\\text{MB}$\uff01\uff01\uff01**\n\n### \u9898\u89e3\n\n~~\uff08\u636e\u8bf4\u6b63\u89e3\u662f\u6bd2\u7624\u5206\u5757\u5957\u5206\u5757\uff09~~\n\n\u6309\u7167\u6743\u503c\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u5bf9\u6240\u6709\u80fd\u591f\u8986\u76d6\u5230\u5b83\u7684\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u6253\u4e2a\u6807\u8bb0\n\n\u6309\u7167\u503c\u57df\u5efa\u4e00\u68f5\u4e3b\u5e2d\u6811\u5c31\u53ef\u4ee5\u4e86\n\n\u533a\u95f4\u67e5\u8be2\u6700\u5927\u503c\uff0c\u7528$m$\u51cf\u53bb\u5b83\u5373\u53ef\n\n**\u5982\u4f55\u5361\u7a7a\u95f4\uff1f\uff1f\uff1f**\n\n1. \u7528\u4f4d\u57df\u5c06\u4e3b\u5e2d\u6811\u7684\u8282\u70b9\u4fe1\u606f\u538b\u5230\u4e00\u4e2a`unsigned long long`\u4e2d\n2. \u5c06\u53f6\u8282\u70b9\u6539\u6210\u4e00\u4e2a\u503c\uff0c\u8282\u7701\u7a7a\u95f4\u3002~~\uff08\u4f46\u662f\u8fd8\u662f\u8981\u5f0040\u500d\uff09~~\n3. \u6c38\u4e45\u5316\u7684\u6807\u8bb0\u548c\u503c\u538b\u5728\u4e00\u8d77\u3002\n\n\u6700\u540e\u4ee5\u5927\u7ea6$63\\text{MB}$\u7684\u7a7a\u95f4\u5361\u4e86\u8fc7\u53bb\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cctype>\n#include<algorithm>\n#define RG register\n#define file(x) freopen(#x\".in\", \"r\", stdin);freopen(#x\".out\", \"w\", stdout);\n#define clear(x, y) memset(x, y, sizeof(x))\n\ninline int read()\n{\n\tint data = 0, w = 1; char ch = getchar();\n\twhile(ch != '-' && (!isdigit(ch))) ch = getchar();\n\tif(ch == '-') w = -1, ch = getchar();\n\twhile(isdigit(ch)) data = data * 10 + (ch ^ 48), ch = getchar();\n\treturn data * w;\n}\n\nconst int maxn(2e5 + 10), INT_MAX(1e9);\n#define lmax (l == mid ? int(t[rt].lson) : int(t[t[rt].lson].max))\n#define rmax (mid + 1 == r ? int(t[rt].rson) : int(t[t[rt].rson].max))\n\nstruct node { unsigned long long max : 18, lson : 23, rson : 23; } t[maxn * 40];\nint cur, root[maxn], n, m, Q;\nstd::pair<int, int> a[maxn];\n\nint Insert(int p, int l, int r, int ql, int qr)\n{\n\tif(l == r) return p + 1;\n\tint rt = ++cur; t[rt] = t[p];\n\tif(ql <= l && r <= qr) return ++t[rt].max, rt;\n\tint mid = (l + r) >> 1, tag = t[rt].max - std::max(lmax, rmax);\n\tif(ql <= mid) t[rt].lson = Insert(t[p].lson, l, mid, ql, qr);\n\tif(qr  > mid) t[rt].rson = Insert(t[p].rson, mid + 1, r, ql, qr);\n\tt[rt].max = std::max(lmax, rmax) + tag; return rt;\n}\n\nint query(int rt, int l, int r, int ql, int qr)\n{\n\tif(l == r) return rt;\n\tif(ql <= l && r <= qr) return t[rt].max;\n\tint mid = (l + r) >> 1, ans = 0, tag = t[rt].max - std::max(lmax, rmax);\n\tif(ql <= mid) ans = std::max(ans, query(t[rt].lson, l, mid, ql, qr));\n\tif(qr  > mid) ans = std::max(ans, query(t[rt].rson, mid + 1, r, ql, qr));\n\treturn ans + tag;\n}\n\nint main()\n{\n#ifndef ONLINE_JUDGE\n\tfile(cpp);\n#endif\n\tn = read(), m = read();\n\tfor(RG int i = 1; i <= n; i++) a[i] = std::make_pair(-read(), i);\n\tstd::sort(a + 1, a + n + 1);\n\tfor(RG int i = 1; i <= n; i++)\n\t{\n\t\tint ql = std::max(1, a[i].second - m + 1);\n\t\tint qr = std::min(a[i].second, n - m + 1);\n\t\troot[i] = Insert(root[i - 1], 1, n - m + 1, ql, qr);\n\t}\n\tQ = read(); int ans = 0;\n\twhile(Q--)\n\t{\n\t\tint l = read(), r = read(), x = read() ^ ans;\n\t\tint id = std::upper_bound(a + 1, a + n + 1,\n\t\t\t\tstd::make_pair(-x, INT_MAX)) - a - 1;\n\t\tprintf(\"%d\\n\", ans = m - query(root[id], 1, n - m + 1, l, r));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1546427511,
        "uid": 46800,
        "name": "xgzc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF543E \u3010Listening to Music\u3011"
    },
    {
        "content": "\u597d\u50cf\u6ca1\u6709\u4eba\u5199\u6211\u8fd9\u4e2a\u65e0\u8111\u505a\u6cd5\u3002\n\n\u6ce8\u610f\u5230 $f(i + 1) = f(i) - [a_i < x] + [a_{i + m} < x]$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u7528\u6c42\u51fa $f(l)$\uff0c\u518d\u6c42\u5dee\u5206\u6570\u7ec4\u7684\u524d\u7f00\u548c\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n\u8003\u8651\u5206\u5757\uff0c\u8bbe\u6211\u4eec\u628a\u539f\u5e8f\u5217\u5206\u4e3a\u4e86\u957f\u5ea6\u4e3a $B$ \u7684\u5757\u3002\n\n\u8003\u8651\u5982\u4f55\u6c42 $f(l)$\u3002\u6211\u4eec\u8981\u6c42\u5f62\u5982 $\\sum_{L \\le i \\le R} [a_i < x]$ \u7684\u4e1c\u897f\u3002\u5bf9\u4e8e\u4e00\u4e2a\u6574\u5757 $[l, r]$\uff0c$\\sum_{l \\le i \\le r} [a_i < v]$ \u7684\u503c\u53ea\u6709 $\\mathcal{O}(B)$ \u79cd\uff0c\u66b4\u529b\u9884\u5904\u7406\u5373\u53ef\u3002\u63a5\u4e0b\u6765\u6bcf\u6b21\u67e5\u8be2\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053\u8fd9\u4e2a\u5757\u4e2d $\\ge x$ \u7684\u6700\u5c0f\u7684\u6570\u5373\u53ef\u5f97\u5230\u8fd9\u4e2a\u5757\u5bf9 $f(l)$ \u548c\u7684\u8d21\u732e\u4e86\u3002\u4f7f\u7528\u5206\u6563\u5c42\u53e0\u7b97\u6cd5\uff0c\u53ef\u4ee5\u505a\u5230 $\\mathcal{O}(n)$ \u9884\u5904\u7406\uff0c$\\mathcal{O}(\\frac{n}{B})$ \u6c42\u51fa\u6bcf\u4e2a\u5757\u4e2d $\\ge x$ \u7684\u6700\u5c0f\u7684\u6570\uff0c\u4e8e\u662f\u53ef\u4ee5 $\\mathcal{O}(B + \\frac{n}{B})$ \u5730\u6c42\u51fa $f(l)$\u3002\n\n\u5bf9\u4e8e\u5dee\u5206\u6570\u7ec4\uff0c\u6ce8\u610f\u5230\u524d\u7f00\u548c\u6700\u5c0f\u503c\u662f\u53ef\u4ee5\u5408\u5e76\u7684\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u62c6\u6210\u5757\u5904\u7406\u3002\u5e76\u4e14 $\\sum_{l \\le i \\le r} [a_{i + m} < x] - [a_i < x]$ \u540c\u6837\u53ea\u6709 $\\mathcal{O}(B)$ \u79cd\uff0c\u6240\u4ee5\u548c\u4e0a\u9762\u7684\u5904\u7406\u65b9\u6cd5\u5e76\u65e0\u4e8c\u81f4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(B + \\frac{n}{B})$\uff0c\u53d6 $B = \\mathcal{O}(\\sqrt n)$ \u53ef\u4ee5\u8fbe\u5230 $\\mathcal{O}(n \\sqrt n)$\uff1b\u7a7a\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n)$\u3002\n\n\u9644\uff1a\u5206\u6563\u5c42\u53e0\u67e5\u8be2\u7684\u5e38\u6570\u771f\u7684**\u5f88\u5927**\uff0c\u8981\u628a\u5757\u957f\u5f00\u5f97\u5927\u4e00\u70b9\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define rep(i, s, e) for (int i = s; i <= e; ++i)\n#define drep(i, s, e) for (int i = s; i >= e; --i)\n#define file(a) freopen(#a\".in\", \"r\", stdin), freopen(#a\".out\", \"w\", stdout)\n#define pv(a) cout << #a << \" = \" << a << endl\n#define pa(a, l, r) cout << #a \" : \"; rep(_, l, r) cout << a[_] << ' '; cout << endl\n\nconst int inf = 1 << 30;\n\nconst int N = 4e5 + 10;\nconst int M = 8e2 + 10;\n\nint read() {\n  int x = 0, f = 1; char c = getchar();\n  for (; c < '0' || c > '9'; c = getchar()) if (c == '-') f = -1;\n  for (; c >= '0' && c <= '9'; c = getchar()) x = x * 10 + c - 48;\n  return x * f;\n}\n\nint sgn(int x) { return x ? 1 : -1; }\n\nint n, m, coef, a[N], B, bel[N], cnt, le[M], ri[M], lstans;\n\nstruct node {\n  int sum, mn;\n  node(int x = 0) { sum = mn = x; }\n  node(int _s, int _m) : sum(_s), mn(_m) {}\n  friend node operator + (node x, node y) {\n    return node(x.sum + y.sum, min(x.mn, x.sum + y.mn));\n  }\n} ;\n\nnamespace FC {\n\nint b[N], val[M][M << 1], sz[M], f[M][M << 2], len[M], pos[M][M << 2], nxt[M][M << 2], pre[M][M << 1];\nnode dat[M][M << 1];\n\nvoid init() {\n  rep(i, 1, cnt) {\n    rep(j, le[i], ri[i]) {\n      val[i][++ sz[i]] = a[j];\n      if (j + m <= n) val[i][++ sz[i]] = a[j + m];\n    }\n    sort(val[i] + 1, val[i] + sz[i] + 1);\n    val[i][sz[i] + 1] = inf;\n    rep(j, 1, sz[i] + 1) rep(k, le[i], ri[i]) {\n      if (a[k] < val[i][j]) ++ pre[i][j];\n      int t = (a[k + m] < val[i][j]) - (a[k] < val[i][j]);\n      dat[i][j] = dat[i][j] + node(t);\n    }\n  }\n  len[cnt] = sz[cnt];\n  rep(i, 1, sz[cnt]) pos[cnt][i] = i, nxt[cnt][i] = 1;\n  drep(i, cnt - 1, 1) {\n    for (int u = 1, v = 2; u <= sz[i] || v <= len[i + 1]; ) {\n      if (len[i] && u <= sz[i] && val[i][u] == f[i][len[i]]) ++ u;\n      else if (len[i] && v <= len[i + 1] && f[i + 1][v] == f[i][len[i]]) v += 2;\n      else {\n        ++ len[i], pos[i][len[i]] = u, nxt[i][len[i]] = v;\n        if (v > len[i + 1] || (u <= sz[i] && val[i][u] < f[i + 1][v])) f[i][len[i]] = val[i][u], ++ u;\n        else f[i][len[i]] = f[i + 1][v], v = min(v + 2, len[i + 1] + 1);\n      }\n    }\n  }\n  rep(i, 1, cnt) pos[i][len[i] + 1] = sz[i] + 1, nxt[i][len[i] + 1] = len[i + 1] + 1;\n}\n\nvoid qpre(int l, int r, int x, int &ans) {\n  int p = lower_bound(f[l] + 1, f[l] + len[l] + 1, x) - f[l];\n  rep(i, l, r) {\n    while (p > 1 && f[i][p - 1] >= x) -- p;\n    ans += pre[i][pos[i][p]];\n    p = nxt[i][p];\n  }\n}\n\nvoid qdat(int l, int r, int x, node &ans) {\n  int p = lower_bound(f[l] + 1, f[l] + len[l] + 1, x) - f[l];\n  rep(i, l, r) {\n    while (p > 1 && f[i][p - 1] >= x) -- p;\n    ans = ans + dat[i][pos[i][p]];\n    p = nxt[i][p];\n  }\n}\n\n}\n\nnamespace Solve {\n\nint calc(int l, int r, int x) {\n  int res = 0;\n  if (bel[l] == bel[r]) {\n    rep(i, l, r) res += a[i] < x;\n    return res;\n  }\n  rep(i, l, ri[bel[l]]) res += a[i] < x;\n  FC::qpre(bel[l] + 1, bel[r] - 1, x, res);\n  rep(i, le[bel[r]], r) res += a[i] < x;\n  return res;\n}\n\nint solve(int l, int r, int x) {\n  -- r;\n  int res = calc(l, l + m - 1, x);\n  node ans(res);\n  auto delta = [&](int i) {\n    return node((a[i + m] < x) - (a[i] < x));\n  } ;\n  if (l > r || bel[l] == bel[r]) {\n    rep(i, l, r) {\n      ans = ans + delta(i);\n    }\n    return ans.mn;\n  }\n  rep(i, l, ri[bel[l]]) ans = ans + delta(i);\n  FC::qdat(bel[l] + 1, bel[r] - 1, x, ans);\n  rep(i, le[bel[r]], r) ans = ans + delta(i);\n  return ans.mn;\n}\n\n}\n\nint main() {\n  n = read(), m = read(), coef = 1, B = sqrt(3 * n);\n  rep(i, 1, n) a[i] = read(), bel[i] = (i - 1) / B + 1;\n  cnt = bel[n];\n  rep(i, 1, cnt) le[i] = ri[i - 1] + 1, ri[i] = min(ri[i - 1] + B, n);\n  FC::init();\n  for (int q = read(); q; -- q) {\n    int l = read(), r = read(), x = read() ^ (coef * lstans);\n    printf(\"%d\\n\", lstans = Solve::solve(l, r, x));\n  }\n  return 0;\n}\n```\n\n\u600e\u4e48\u4f1a\u6709\u4eba\u628a `inf` \u8bbe\u6210 `0x3f3f3f3f`\uff0c\u62cd\u7684\u65f6\u5019\u628a\u503c\u57df\u8bbe\u4e3a $10^9$\uff0c\u7136\u540e\u6b7b\u6d3b\u62cd\u4e0d\u51fa\u6765\uff0c\u8c03 1.5h \u554a /cf/cf",
        "postTime": 1683861972,
        "uid": 126582,
        "name": "Scintilla",
        "ccfLevel": 9,
        "title": "CF543E Listening to Music"
    },
    {
        "content": "\u6839\u53f7 log \u505a\u6cd5\u3002\u80fd\u8fc7 CF \u7684\u6570\u636e\uff0c\u4f46\u8fc7\u4e0d\u4e86\u6821\u5185\u6a21\u62df\u8d5b\u7684\u6570\u636e/tuu\n\n\u8003\u8651\u4ece $f(i,x)$ \u5230 $f(i+1,x)$ \u7684\u53d8\u5316\u5728\u54ea\u91cc\uff1a\u5c11\u4e86\u4e2a $a_i$ \u591a\u4e86\u4e2a $a_{i+m}$\uff0c\u56e0\u6b64\u663e\u7136\u53ea\u6709 $x$ \u5728\u5b83\u4fe9\u4e2d\u95f4\u624d\u6709 $f(i,x)\\ne f(i+1,x)$\uff0c\u5373\uff1a\n$$\nf(i+1,x)-f(i,x)=\\begin{cases}-1&(a_i<x\\le a_{i+m})\\\\1&(a_{i+m}<x\\le a_i)\\\\0&\\text{otherwise}\\end{cases}\n$$\n\u6211\u4eec\u4e0d\u59a8\u8bb0\u5176\u4e3a $g(i,x)$\u3002\u6362\u53e5\u8bdd\u8bf4\u8fd9\u4e2a $g(i,x)$ \u7684\u8d21\u732e\u5f62\u5f0f\u662f\u4e00\u6bb5\u533a\u95f4\u3002\n\n\u800c\u663e\u7136 $f(j,x)=f(i,x)+\\sum\\limits_{k=i}^{j-1}g(k,x)$\uff0c\u56e0\u6b64\u8be2\u95ee\u7b49\u4ef7\u4e8e\u67e5\u8be2 $f(l,x)$ \u548c $g(l,x),g(l+1,x),\\cdots,g(r-1,x)$ \u7684\u6700\u5c0f\u524d\u7f00\u548c\u3002\u7531\u4e8e\u7a7a\u95f4 64MB~~\uff08\u4e00\u773c\u6c99\u4e1c OI problemprovidercreep\uff09~~\uff0c\u8003\u8651\u5206\u5757\uff0c\u5bf9\u4e8e\u524d\u8005\u76f4\u63a5\u5c06\u533a\u95f4\u4e2d\u7684\u6570\u6392\u4e2a\u5e8f lower_bound \u5373\u53ef\uff0c\u5bf9\u4e8e\u540e\u8005\u5c06\u8fd9\u4e2a\u5757\u5185\u6240\u6709\u533a\u95f4\u5de6\u53f3\u7aef\u70b9\u5f53\u4f5c\u5173\u952e\u70b9\u79bb\u6563\u5316\uff0c\u7136\u540e\u5bf9\u6bcf\u4e00\u6bb5\u5206\u522b\u6c42\u51fa $x$ \u5728\u8fd9\u4e00\u6bb5\u5185\u7684\u6700\u5c0f\u524d\u7f00\u548c\u548c\u603b\u548c\u5373\u53ef\u3002\u5757\u957f\u53d6 $\\sqrt{n\\log n}$ \u65f6\u6700\u4f18\u3002\n\n```cpp\nconst int MAXN=2e5;\nconst int BLK_SZ=900;\nconst int BLK_CNT=MAXN/BLK_SZ;\nint n,m,typ,a[MAXN+5],b[MAXN+5],L[MAXN+5],R[MAXN+5],blk_sz,blk_cnt,bel[MAXN+5];\nint calc_less(int l,int r,int x){\n\tif(bel[l]==bel[r]){\n\t\tint sum=0;\n\t\tfor(int i=l;i<=r;i++)sum+=(a[i]<x);\n\t\treturn sum;\n\t}else{\n\t\tint sum=0;\n\t\tfor(int i=l;i<=R[bel[l]];i++)sum+=(a[i]<x);\n\t\tfor(int i=L[bel[r]];i<=r;i++)sum+=(a[i]<x);\n\t\tfor(int i=bel[l]+1;i<bel[r];i++){\n\t\t\tint pos=lower_bound(b+L[i],b+R[i]+1,x)-b;\n\t\t\tsum+=pos-L[i];\n\t\t}return sum;\n\t}\n}\ntuple<int,int,int>c[MAXN+5];\nint key[BLK_CNT+5][BLK_SZ*2+5],uni[BLK_CNT+5][BLK_SZ*2+5];\nint cnt[BLK_SZ+5],num[BLK_SZ+5];\nint sum[BLK_CNT+5][BLK_SZ*2+5],mn[BLK_CNT+5][BLK_SZ*2+5];\nint calc_mn(int l,int r,int x){\n\tif(bel[l]==bel[r]){\n\t\tint _sum=0,_mn=0;\n\t\tfor(int i=l;i<=r;i++){\n\t\t\tif(get<0>(c[i])<=x&&x<=get<1>(c[i]))_sum+=get<2>(c[i]);\n\t\t\tchkmin(_mn,_sum);\n\t\t}return _mn;\n\t}else{\n\t\tint _sum=0,_mn=0;\n\t\tfor(int i=l;i<=R[bel[l]];i++){\n\t\t\tif(get<0>(c[i])<=x&&x<=get<1>(c[i]))_sum+=get<2>(c[i]);\n\t\t\tchkmin(_mn,_sum);\n\t\t}\n\t\tfor(int i=bel[l]+1;i<bel[r];i++){\n\t\t\tint pos=upper_bound(uni[i]+1,uni[i]+num[i]+1,x)-uni[i]-1;\n\t\t\tchkmin(_mn,_sum+mn[i][pos]);_sum+=sum[i][pos];\n\t\t}\n\t\tfor(int i=L[bel[r]];i<=r;i++){\n\t\t\tif(get<0>(c[i])<=x&&x<=get<1>(c[i]))_sum+=get<2>(c[i]);\n\t\t\tchkmin(_mn,_sum);\n\t\t}\n\t\treturn _mn;\n\t}\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),b[i]=a[i];\n\tblk_sz=BLK_SZ;blk_cnt=(n-1)/blk_sz+1;\n\tfor(int i=1;i<=blk_cnt;i++){\n\t\tL[i]=(i-1)*blk_sz+1;R[i]=min(i*blk_sz,n);\n\t\tfor(int j=L[i];j<=R[i];j++)bel[j]=i;\n\t}\n\tfor(int i=1;i<=blk_cnt;i++)sort(b+L[i],b+R[i]+1);\n\tfor(int i=1;i<=n-m;i++){\n\t\tif(a[i]<a[i+m])c[i]=mt(a[i]+1,a[i+m],-1);\n\t\telse if(a[i]>a[i+m])c[i]=mt(a[i+m]+1,a[i],1);\n\t}\n\tfor(int i=1;i<=blk_cnt;i++){\n\t\tfor(int j=L[i];j<=R[i];j++)if(get<2>(c[j]))\n\t\t\tkey[i][++cnt[i]]=get<0>(c[j]),key[i][++cnt[i]]=get<1>(c[j])+1;\n\t\tkey[i][++cnt[i]]=0;\n\t\tsort(key[i]+1,key[i]+cnt[i]+1);key[i][0]=-1;\n\t\tfor(int j=1;j<=cnt[i];j++)if(key[i][j]!=key[i][j-1])uni[i][++num[i]]=key[i][j];\n\t\tfor(int j=1;j<=num[i];j++){\n\t\t\tint SUM=0,MN=0;\n\t\t\tfor(int k=L[i];k<=R[i];k++){\n\t\t\t\tif(get<0>(c[k])<=uni[i][j]&&uni[i][j]<=get<1>(c[k]))\n\t\t\t\t\tSUM+=get<2>(c[k]);\n\t\t\t\tchkmin(MN,SUM);\n\t\t\t}mn[i][j]=MN;sum[i][j]=SUM;\n\t\t}\n\t}\n\tint qu,lstans=0;scanf(\"%d\",&qu);\n\twhile(qu--){\n\t\tint l,r,x;scanf(\"%d%d%d\",&l,&r,&x);x^=lstans;\n\t\tif(l==r)printf(\"%d\\n\",lstans=calc_less(l,l+m-1,x));\n\t\telse printf(\"%d\\n\",lstans=calc_less(l,l+m-1,x)+calc_mn(l,r-1,x));\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1683795168,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF543E Listening to Music"
    }
]