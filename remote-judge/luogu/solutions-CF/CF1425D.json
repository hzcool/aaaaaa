[
    {
        "content": "\u89c2\u5bdf\u5230\u6570\u636e\u8303\u56f4\uff0c\u53ef\u4ee5\u53d1\u73b0\u505a\u6cd5\u5e94\u8be5\u662f\u4e2a $N^2$ \u7684\u3002\u8003\u8651\u8ba1\u7b97\u6bcf\u5bf9\u86c7 $(i,j)$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u5fc5\u5b9a\u6709 $(...+B_i+B_j+...)^2$ \u8fd9\u6837\u7684\u5f62\u5f0f\u3002\n\n\u63d0\u51fa\u4e0e\u8fd9\u4e24\u9879\u90fd\u6709\u5173\u7684\u5f0f\u5b50\uff0c\u90a3\u4e48\u53ea\u6709 $2B_iB_j$\u3002\u8003\u8651\u8ba1\u7b97\u540c\u65f6\u5305\u542b $i,j$\u3001\u53ea\u5305\u542b $i$\u3001\u53ea\u5305\u542b $j$ \u7684\u653b\u51fb\u5708\u4e2a\u6570\uff0c\u8bb0\u4e3a $X,Y,Z$\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u8ba1\u7b97 $i,j$ \u540c\u65f6\u51fa\u73b0\u7684\u65b9\u6848\u4e2a\u6570\uff0c\u4e5f\u5c31\u80fd\u8ba1\u7b97\u8d21\u732e\u3002\n\n\u6709\u540c\u65f6\u5305\u542b $i,j$ \u7684\u653b\u51fb\u5708\uff1a$\\dbinom{n}{m}-\\dbinom{n-X}{m}$\n\n\u6ca1\u6709\u540c\u65f6\u5305\u542b $i,j$ \u7684\u653b\u51fb\u5708\uff0c\u7b80\u5355\u5bb9\u65a5\u5f97\u5230\uff1a$\\dbinom{n-X}{m}-\\dbinom{n-X-Y}{m}-\\dbinom{n-X-Z}{m}+\\dbinom{n-X-Y-Z}{m}$\n\n\u5f97\u5230\u65b9\u6848\u6570\u7ed9\u5b83\u4e58\u4e2a $2B_iB_j$ \u5c31\u884c\u5566\u3002\n\n\u5f53\u7136\u5982\u679c $i=j$ \u7684\u8bdd\u7ed9\u5b83\u4e58\u4e2a ${B_i}^2$\uff0c\u6240\u4ee5\u9700\u8981\u5224\u4e00\u4e0b\u3002\n\n\u5de8\u4e11\u65e0\u6bd4\u7684code\uff1a\n```cpp\n#include\"bits/stdc++.h\"\nusing namespace std;\n#define ri register int\n#define ll long long\n#define N 2010\n#define mod 1000000007\nll n,m,r,x[N],y[N],a[N],s[N][N],ans;\nll fac[N],inv[N];\ninline ll ksm(ll x,int y){\n\tll res=1;\n\twhile(y){\n\t\tif(y&1) res*=x,res%=mod;\n\t\tx*=x,x%=mod;\n\t\ty>>=1;\n\t}\n\treturn res;\n}\ninline void calc(){\n\tinv[0]=inv[1]=fac[0]=fac[1]=1;\n\tfor(ri i=2;i<=n;++i) fac[i]=1ll*i*fac[i-1]%mod,inv[i]=ksm(fac[i],mod-2);\n\tfor(ri i=1;i<=1010;++i) for(ri j=1;j<=1010;++j){\n\t\ts[i][j]+=s[i][j-1]+s[i-1][j]-s[i-1][j-1];\n\t}\n}\ninline ll C(int m,int n){\n\tif(n<0||m<0||m>n) return 0;\n\treturn fac[n]*inv[m]%mod*inv[n-m]%mod;\n}\ninline int calc_pre(int x,int y,int _x,int _y){\n\tx=max(1,x),_x=min(1000,_x),y=max(1,y),_y=min(1000,_y);\n\tif(x>_x||y>_y) return 0;\n\treturn s[_x][_y]-s[x-1][_y]-s[_x][y-1]+s[x-1][y-1];\n}\nint main(){\n\tios::sync_with_stdio(false);\n\tcin>>n>>m>>r;\n\tfor(ri i=1;i<=n;++i) cin>>x[i]>>y[i]>>a[i],s[x[i]][y[i]]++;\n\tcalc();\n\tfor(ri i=1;i<=n;++i)\n\tfor(ri j=i;j<=n;++j){\n\t\t//calc the squares containing both snakes\n\t\tint minx=max(x[i],x[j])-r,miny=max(y[i],y[j])-r,maxx=min(x[i],x[j])+r,maxy=min(y[i],y[j])+r;\n\t\tll num=calc_pre(minx,miny,maxx,maxy);\n\t\tll cnt1=(C(m,n)-C(m,n-num)+mod)%mod;\n\t\t//calc separately\n\t\tll calc1=calc_pre(x[i]-r,y[i]-r,x[i]+r,y[i]+r)-num,calc2=calc_pre(x[j]-r,y[j]-r,x[j]+r,y[j]+r)-num;\n\t\tll tot=n-num;\n\t\tll cnt2=(C(m,tot)-C(m,tot-calc1)-C(m,tot-calc2)+C(m,tot-calc1-calc2))%mod;\n\t\tif(cnt2<0) cnt2+=mod;\n\t\tif(i==j) ans=(ans+a[i]*a[i]%mod*cnt1%mod)%mod;\n\t\telse ans=(ans+2ll*a[i]*a[j]%mod*(cnt1+cnt2)%mod)%mod;\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1601799901,
        "uid": 135839,
        "name": "Fairicle",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF1425D \u3010Danger of Mad Snakes\u3011"
    },
    {
        "content": "\u89c2\u5bdf\u9898\u610f\uff0c\u95ee\u7684\u65e2\u7136\u662f\u201c\u6bcf\u4e00\u79cd\u8d21\u732e\u4e4b\u548c\u201d\uff0c\u90a3\u5c31\u8003\u8651\u6bcf\u4e00\u79cd\u8d21\u732e\u672c\u8eab\u7684\u6837\u5b50\u548c\u4ed6\u51fa\u73b0\u4e86\u51e0\u6b21\u3002\r\n\r\n\u5bf9\u4e8e\u4e00\u79cd\u65b9\u6848\uff0c\u5982\u679c\u4ed6\u662f $(\\sum_{i=1}^k a_i)^2$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u5f0f\u5b50\u62c6\u5f00\u53d8\u6210 $\\sum_{i=1}^k a_i^2+\\sum_{i=1}^k\\sum_{j=1}^k[i\\neq j]\\times 2\\times  a_i\\times a_j$\u3002\r\n\r\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6700\u7ec8\u7b54\u6848\u53ef\u4ee5\u88ab\u62c6\u5206\u6210\u4e24\u4e2a\u90e8\u5206\uff1a\r\n\r\n- \u76f8\u540c\u7684 $a_i$ \u7684\u5e73\u65b9\u3002\r\n- \u4e0d\u540c\u7684\u4e24\u4e2a $a_i$ \u7684\u4e58\u79ef\u3002\r\n\r\n\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u8fd9\u4e24\u79cd\u7b54\u6848\u7684\u51fa\u73b0\u6b21\u6570\u3002\r\n\r\n\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u7b54\u6848\uff0c\u6211\u4eec\u8003\u8651\u80fd\u78b0\u5230\u4ed6\u7684\u6240\u6709\u7684\u7b3c\u5b50\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u4e8c\u7ef4\u524d\u7f00\u548c\u6c42\u51fa\uff0c\u8bb0\u4e3a $q$\u3002\r\n\r\n\u4ece\u90a3\u4e9b\u86c7\u8eab\u4e0a\u6254\u4e00\u4e2a\u7b3c\u5b50\u90fd\u80fd\u78b0\u5230\u8fd9\u6761\u86c7\u3002\u76f8\u5e94\u5730\uff0c\u4ece\u5269\u4f59 $n-q$ \u6761\u86c7\u4e0a\u6254\u4e00\u4e2a\u7b3c\u5b50\u5c31\u78b0\u4e0d\u5230\u4e86\u3002\r\n\r\n\u90a3\u4e48 $a_i$ \u7684\u5e73\u65b9\u51fa\u73b0\u7684\u65b9\u6848\u6570\u5c31\u662f\u603b\u7684\u65b9\u6848\u6570\u51cf\u53bb\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\u6570\uff0c\u4e3a $C_n^m-C_{n-q}^m$\u3002\r\n\r\n\u90a3\u4e3a\u4ec0\u4e48\u4e0d\u662f $C_q^m$ \u5462\uff1f\r\n\r\n\u56e0\u4e3a\u5bf9\u4e8e\u4e00\u79cd\u65b9\u6848\uff0c\u6211\u4eec\u53ea\u8981\u8ba9 $q$ \u4e2a\u5f53\u4e2d**\u81f3\u5c11\u4e00\u4e2a**\u78b0\u5230\u8fd9\u6761\u86c7\u5373\u53ef\uff0c\u800c $C_q^m$ \u662f\u8bb0\u5f55\u8fd9 $q$ \u4e2a\u5f53\u4e2d\u9009\u51fa $m$ \u4e2a\u7684\u65b9\u6848\u6570\uff0c\u6ee1\u8db3\u7684\u662f\u8fd9 $m$ \u4e2a\u7b3c\u5b50\u5168\u90e8\u90fd\u6293\u5230\u4e86\u8fd9\u6761\u86c7\u3002\r\n\r\n\u90a3\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u7b54\u6848\uff0c\u6211\u4eec\u8bb0\u80fd**\u540c\u65f6\u78b0\u5230\u8fd9\u4e24\u6761\u86c7**\u7684\u7b3c\u5b50\u7684\u6570\u91cf\u4e3a $q$\uff0c\u53ea\u80fd\u78b0\u5230 $i$ \u7684\u6570\u91cf\u4e3a $x$\uff0c\u53ea\u80fd\u78b0\u5230 $j$ \u7684\u6570\u91cf\u4e3a $y$\u3002\r\n\r\n\u90a3\u4e48\u80fd\u540c\u65f6\u78b0\u5230\u4e24\u6761\u86c7\u7684\u65b9\u6848\u6570\u5c31\u662f $C_n^m-C_{n-q}^m$\u3002\r\n\r\n\u90a3\u4e48\u80fd\u5728**\u4e0d\u540c\u7684\u4e24\u4e2a\u7b3c\u5b50\u91cc**\u78b0\u5230\u4e24\u6761\u86c7\u7684\u65b9\u6848\u6570\u5462\uff1f\r\n\r\n\u9996\u5148\u6211\u4eec\u80af\u5b9a\u6709**\u4e0d\u540c\u65f6\u78b0\u5230**\u4e24\u6761\u86c7\u7684\uff0c\u6240\u4ee5\u65b9\u6848\u91cc\u8fb9\u52a0\u4e86\u4e00\u4e2a $C_{n-q}^m$\u3002\r\n\r\n\u7136\u540e\u5728\u8fd9\u4e2a\u6761\u4ef6\u4e0b\uff0c\u90a3\u4e9b\u6ca1\u6cd5\u78b0\u5230 $i$ \u7684\u6709 $n-x-q$ \u4e2a\uff0c\u6240\u4ee5\u7b54\u6848\u8981\u51cf\u53bb\u4e00\u4e2a $C_{n-x-q}^m$\u3002\r\n\r\n\u540c\u7406\u53ef\u77e5\u7b54\u6848\u8981\u51cf\u53bb\u4e00\u4e2a $C_{n-y-q}^m$\u3002\r\n\r\n\u4f46\u662f\u6211\u4eec\u628a\u6ca1\u6cd5\u78b0\u5230 $i$ \u4e5f\u6ca1\u6cd5\u78b0\u5230 $j$ \u7684\u8ba1\u7b97\u4e86\u4e24\u6b21\uff0c\u6240\u4ee5\u8981\u52a0\u4e0a $C_{n-x-y-q}^m$\u3002\r\n\r\n\u6700\u7ec8 $2\\times a_i\\times a_j$ \u51fa\u73b0\u7684\u65b9\u6848\u6570\u662f $C_{n-q}^m-C_{n-x-q}^m-C_{n-y-q}^m+C_{n-x-y-q}^m$\u3002\r\n\r\n\u6ce8\u610f\u53d6\u6a21\u7ec6\u8282\u3002\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define fs(i,x,y,z) for(int i=x;i<=y;i+=z)\r\n#define ft(i,x,y,z) for(int i=x;i>=y;i+=z)\r\n#define int long long\r\n#define ull unsigned long long\r\n#define db double\r\n#define ms(a,b) memset(a,b,sizeof(a))\r\n#define sz(a) sizeof(a)\r\nusing namespace std;\r\nconst int rw[]={-1,0,1,0,-1,1,-1,1},cl[]={0,1,0,-1,-1,1,1,-1};\r\nconst int N=2001,inf=1e9+7;\r\ninline int read(){\r\n\tint date=0,w=1;char c=0;\r\n\twhile(c<'0'||c>'9'){if(c=='-')w=-1;c=getchar();}\r\n\twhile(c>='0'&&c<='9'){date=date*10+c-'0';c=getchar();}\r\n\treturn date*w;\r\n}\r\nint n,m,a[N],pos[N][N],r,qpos[N][N],res;\r\nint ksm(int a,int b){\r\n    int ans=1;while(b){if(b&1) ans=ans*a%inf;a=a*a%inf;b=b>>1;}\r\n    return ans;\r\n}\r\nint fac[N+1],inv[N+1],x[N],y[N];\r\nint c(int d,int u){if(u>d||d<0||u<0) return 0;return fac[d]%inf*inv[u]%inf*inv[d-u]%inf;}\r\nint qsum(int x1,int y1,int x2,int y2){\r\n\tx1=max(x1,1ll),y1=max(y1,1ll);\r\n\tx2=min(x2,N-1),y2=min(y2,N-1);\r\n\tif(x1>x2||y1>y2) return 0;\r\n\treturn qpos[x2][y2]-qpos[x2][y1-1]-qpos[x1-1][y2]+qpos[x1-1][y1-1];\r\n}\r\nint trans(int i){\r\n\tint quans=qsum(x[i]-r,y[i]-r,x[i]+r,y[i]+r);//\u5305\u62eci\u7684\u5708\u6570\r\n\tint fastot=c(n,m),nothing=c(n-quans,m);\r\n\tint cnt=(fastot-nothing+inf)%inf;//\u81f3\u5c11\u6709\u4e00\u4e2a\u6709i\u7684\u65b9\u6848\u6570\r\n\tint cnt2=0;//(nothing-c(n-quans*2,m)-c(n-quans*2,m)+c(n-quans*3,m)+inf*2)%inf;\r\n\treturn (cnt+cnt2)%inf;\r\n}\r\nsigned main(){\r\n\tfac[0]=inv[0]=1;fs(i,1,N,1)fac[i]=fac[i-1]*i%inf;\r\n    inv[N]=ksm(fac[N],inf-2);ft(i,N-1,1,-1)inv[i]=inv[i+1]*(i+1)%inf;\r\n\tn=read(),m=read(),r=read();//m\u662fm\u4e2a\u6478\u866b\u673a \r\n\tfs(i,1,n,1){\r\n\t\tx[i]=read(),y[i]=read();a[i]=read(); \r\n\t\tpos[x[i]][y[i]]++;\r\n\t}\r\n\tfs(i,1,N-1,1) fs(j,1,N-1,1) qpos[i][j]=qpos[i-1][j]+qpos[i][j-1]-qpos[i-1][j-1]+pos[i][j];\r\n\tfs(i,1,n,1){\r\n\t\t(res+=(a[i]*a[i]%inf*trans(i)%inf))%=inf;\r\n\t\tfs(j,i+1,n,1){\r\n\t\t\tint quaninij=qsum(max(x[i],x[j])-r,max(y[i],y[j])-r,min(x[i],x[j])+r,min(y[i],y[j])+r);\r\n\t\t\tint quanini=qsum(x[i]-r,y[i]-r,x[i]+r,y[i]+r)-quaninij;//i nomi\r\n\t\t\tint quaninj=qsum(x[j]-r,y[j]-r,x[j]+r,y[j]+r)-quaninij;//j nomi\r\n\t\t\tint fastot=c(n,m),nothing=c(n-quaninij,m);\r\n\t\t\tint cnt=(fastot-nothing+inf)%inf;\r\n\t\t\t(cnt+=(((nothing-c(n-quaninij-quanini,m)+inf)%inf-(c(n-quaninij-quaninj,m)-c(n-quaninij-quanini-quaninj,m)+inf*2)%inf+inf)%inf))%=inf;\r\n\t\t\t(res+=(2*a[i]%inf*a[j]%inf*cnt%inf))%=inf; \r\n\t\t}\r\n\t}\r\n\tcout<<res;\r\n\treturn 0;\r\n}\r\n//\u8003\u8651\u6bcf\u4e2a\u5708\u5b50\u6240\u5e26\u6765\u7684\u8d21\u732e\u603b\u548c \r\n//\u8003\u8651\u5bf9\u4e8e\u5355\u70b9\u7684\u8d21\u732e \r\n//\u8981\u4e48\u5728\u4e00\u4e2a\u65b9\u6848\u91cc\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u5708\uff0c\u8981\u4e48\u662f\u4e00\u4e2a\u76f8\u540c\u7684\u5708\r\n//\u6ce8\u610f\u5230\u4ed6\u53ea\u80fd\u4e22\u5230\u86c7\u7684\u8eab\u4e0a\u53bb\r\n//\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6da6\u51fa\u6765\uff0c\u8fd9\u79cd\u5708\u5708\u7684\u65b9\u6848\u6570\u662fS\r\n//\u90a3\u4e48\u6709\u51e0\u79cd\u60c5\u51b5\u5462\uff1f \r\n//\u90a3\u4e48\u6211\u4eec\u6709\u51e0\u79cd\u65b9\u6848\u6570\u53ef\u4ee5\u53d6\u5230S\u4e2d\u7684\u4e00\u4e2a\u5462\uff1f\r\n//\u603b\u6570-\u5b8c\u5168\u6ca1\u53d6\u5230\u7684\r\n//\u4e0b\u4e00\u79cd\u60c5\u51b5\uff1a\u540c\u65f6\u53d6\u5230\u5305\u542bi\u4e0ej\u7684\u5e76\u4e14\u6ca1\u6709\u53d6\u5230S\r\n//\u5b8c\u5168\u6ca1\u53d6\u5230\u7684-(\u5b8c\u5168\u6ca1\u53d6\u5230\u5305\u542bj\u7684+\u5b8c\u5168\u6ca1\u53d6\u5230\u5305\u542bi\u7684-\u5b8c\u5168\u6ca1\u53d6\u5230\u5305\u542bi\u548cj\u7684) \r\n```",
        "postTime": 1665154454,
        "uid": 336603,
        "name": "\u51fa\u8a00\u4e0d\u900a\u738b\u5b50",
        "ccfLevel": 0,
        "title": "CF1425D"
    },
    {
        "content": "\u6211\u4eec\u77e5\u9053\u6240\u6709\u65b9\u6848\u7684\u8d21\u732e\u4e00\u5b9a\u90fd\u662f\u5f62\u5982 $(B_{i_1}+B_{i_2}+\\cdots +B_{i_k})^2$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6700\u540e\u7b97\u5230\u603b\u8d21\u732e\u91cc\u8981\u4e48\u662f $xB_i^2$ \uff0c\u8981\u4e48\u662f $xB_iB_j$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6240\u6709 $B_i^2$ \u548c $B_iB_j$ \u5bf9\u603b\u8d21\u732e\u7684\u7cfb\u6570\u5373\u53ef\u3002\n\n\u6211\u4eec\u73b0\u5728\u94a6\u5b9a $B_i ,B_j$ \uff0c\u8003\u8651\u6709\u591a\u5c11\u79cd\u65b9\u6848\u6709\u4e00\u4e2a\u653b\u51fb\u5708\u540c\u65f6\u5305\u542b $i$ \u548c $j$\u3002\n\n\u8003\u5bdf\u8fd9\u4e2a\u653b\u51fb\u5708\u76ee\u6807\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u53d1\u73b0\u76ee\u6807\u4e00\u5b9a\u5728\u4ee5 $i$ \u86c7\u548c $j$ \u86c7\u4e3a\u4e2d\u5fc3\uff0c$R$ \u4e3a\u534a\u5f84\u7684\u6b63\u65b9\u5f62 \u7684\u4ea4\u96c6\u4e2d\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u524d\u7f00\u548c\u6574\u4e2a\u68cb\u76d8\u5185\u86c7\u7684\u6570\u91cf\uff0c$O(1)$ \u6c42\u51fa\u53ef\u80fd\u7684\u653b\u51fb\u5708\u7684\u76ee\u6807\u3002\n\n\u8bb0\u5305\u542b $i$ \u7684\u653b\u51fb\u5708\u6570\u91cf\u4e3a $x$\uff0c\u5305\u542b $j$ \u7684\u653b\u51fb\u5708\u6570\u91cf\u4e3a $y$\uff0c\u5305\u542b $i,j$ \u4e4b\u4e00\u7684\u653b\u51fb\u5708\u6570\u91cf\u4e3a $z$\uff0c\u8003\u8651\u6b63\u96be\u5219\u53cd\uff0c\u628a $m$ \u4e2a\u5708\u4e0d\u540c\u65f6\u5305\u542b\u6392\u9664\uff0c\u53ef\u4ee5\u5f97\u5230\u5408\u6cd5\u7684\u65b9\u6848\u6570\u662f $C_n^m-C_{n-x}^m-C_{n-y}^m+C_{n-z}^m$\uff0c\u603b\u8d21\u732e\u5c31\u662f $(C_n^m-C_{n-x}^m-C_{n-y}^m+C_{n-z}^m)\\times 2B_iB_j$\u3002\n\n\u518d\u8003\u8651 $B_i^2$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u7c7b\u4f3c\u7684\uff0c\u6c42\u51fa\u53ef\u80fd\u7684\u653b\u51fb\u5708\u76ee\u6807\u6570 $cnt$\uff0c\u8d21\u732e\u5c31\u662f $B_i^2 \\times (C_n^m-C_{n-cnt}^m)$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n^2)$\uff0c\u8bb0\u5f97\u5f00 `long long` \u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int NR=2e3+10;\nconst int MOD=1e9+7;\nint n,m,r,a[NR],x[NR],y[NR],cnt[NR][NR],c[NR][NR],ans; \nint calc(int x1,int y1,int x2,int y2){\n\tx1=max(x1,1ll);y1=max(y1,1ll);\n\tx2=min(x2,1000ll);y2=min(y2,1000ll);\n\tif(x1>x2||y1>y2)return 0;\n\treturn cnt[x2][y2]+cnt[x1-1][y1-1]-cnt[x1-1][y2]-cnt[x2][y1-1];\n}\nvoid upd(int &x,int y){(x+=y%MOD)%=MOD;}\nint cal(int k){return calc(x[k]-r,y[k]-r,x[k]+r,y[k]+r);}\nint sum(int i,int j){\n\treturn cal(i)+cal(j)-calc(max(x[i],x[j])-r,max(y[i],y[j])-r,min(x[i],x[j])+r,min(y[i],y[j])+r);\n}\n\nsigned main(){\n\tcin>>n>>m>>r;\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>x[i]>>y[i]>>a[i],cnt[x[i]][y[i]]++;\n\tfor(int i=1;i<=1000;i++)\n\t\tfor(int j=1;j<=1000;j++)cnt[i][j]+=cnt[i-1][j]+cnt[i][j-1]-cnt[i-1][j-1];\n\tc[0][0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tc[i][0]=1;\n\t\tfor(int j=1;j<=i;j++)c[i][j]=(c[i-1][j]+c[i-1][j-1])%MOD;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=i+1;j<=n;j++){\n\t\t\tint x=cal(i),y=cal(j),z=sum(i,j);\n\t\t\tupd(ans,2*a[i]*a[j]%MOD*(c[n][m]-c[n-x][m]-c[n-y][m]+c[n-z][m]));\n\t\t}\n\tfor(int i=1;i<=n;i++)\n\t\tupd(ans,a[i]*a[i]*(c[n][m]-c[n-cal(i)][m]));\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1672754792,
        "uid": 117771,
        "name": "intel_core",
        "ccfLevel": 7,
        "title": "CF1425D \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n\n\u9009\u4e2d\u4e00\u6761\u86c7\uff0c\u5219\u5468\u8fb9\u4e0e\u5176\u5207\u6bd4\u96ea\u592b\u8ddd\u79bb\u4e0d\u8d85\u8fc7 $R$ \u7684\u86c7\u90fd\u4f1a\u88ab\u9009\u4e2d\u3002\u6bcf\u79cd\u9009\u6cd5\u7684\u8d21\u732e\u4e3a**\u6bcf\u6761\u88ab\u9009\u7684\u86c7\u7684\u6743\u503c\u548c**\u7684\u5e73\u65b9\u3002\n\n## \u9898\u89e3\n\n\u628a\u5e73\u65b9\u5c55\u5f00\uff0c\u4e00\u5b9a\u5b58\u5728\u5f62\u5982 $B_iB_j$ \u7684\u9879\u3002\n\n\u679a\u4e3e $(i,j)$\uff0c\u8ba1\u7b97\u6709\u591a\u5c11\u79cd\u9009\u6cd5\u5b58\u5728 $(i,j)$\u3002\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. \u9009\u4e2d\u4e00\u6761\u86c7\uff0c\u5219\u53ef\u4ee5\u540c\u65f6\u5957\u4f4f\u4e24\u6761\u86c7\uff1b\n2. \u9009\u4e2d\u4e24\u6761\u86c7\uff0c\u5206\u522b\u5957\u4f4f\u3002\n\n\u5148\u4e8c\u7ef4\u524d\u7f00\u548c\u7b97\u51fa\u7b2c\u4e00\u79cd\u7684\u86c7\u6570\u8bb0\u4e3a $Z$\u3002\u5219\u5b58\u5728\u5176\u4e2d\u4e00\u6761\u7684\u60c5\u51b5\u53ef\u4ee5\u5bb9\u65a5\uff0c\u5373 $\\displaystyle \\binom{n}{m}-\\binom{n-Z}{m}$\u3002\n\n\u7b2c\u4e8c\u79cd\u86c7\u6570\u540c\u7406\u53ef\u4ee5\u4e8c\u7ef4\u524d\u7f00\u548c\u8ba1\u7b97\uff0c\u8bb0\u4e3a $X$\u3001$Y$\u3002\u9700\u8981\u6ce8\u610f\uff1a\u7b2c\u4e8c\u79cd\u65b9\u6848\u9009\u51fa\u7684\u86c7\u4e0d\u80fd\u540c\u65f6\u5957\u4f4f $(i,j)$\u3002\u65b9\u6848\u6570\u4e3a $\\displaystyle \\binom {n-Z} m - \\binom{n-Z-X} m - \\binom{n-Z-Y} m + \\binom{n-Z-X-Y}{m}$\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst ll P = 1000000007;\nconst int N = 2003;\nll fac[N], ifac[N];\nll qpow(ll x, ll t) { ll v = 1; while (t) { if (t & 1) (v *= x) %= P; (x *= x) %= P; t >>= 1;} return v; }\nvoid genFac() {\n    fac[0] = ifac[0] = 1;\n    U (i, 1, N - 1) fac[i] = fac[i - 1] * i % P;\n    ifac[N - 1] = qpow(fac[N - 1], P - 2);\n    D (i, N - 2, 1) ifac[i] = ifac[i + 1] * (i + 1) % P;\n}\nll C(ll n, ll m) {\n    if (m > n || m < 0 || n < 0) return 0;\n    return fac[n] * ifac[m] % P * ifac[n - m] % P;\n}\n\nll n, m, r, x[N], y[N], a[N];\nint g[N][N];\n\nint sum(int xp, int yp, int xq, int yq) {\n\txp = max(xp, 1); yp = max(yp, 1);\n\txq = min(xq, N - 1); yq = min(yq, N - 1);\n\tif (xp > xq || yp > yq) return 0;\n\treturn g[xq][yq] - g[xp - 1][yq] - g[xq][yp - 1] + g[xp - 1][yp - 1];\n}\n\nint main() {\n    // \u8ba1\u7b97\u7684\u662f\u603b\u548c\u3002\n\t// (\\sum a_i)^2:: \\sum a_i^2 + \\sum a_ia_j\n\tgenFac();\n\t// \u9009\u4e2d a_ia_j \u7684\u65b9\u6848\u6570\uff1a|i|+|j|-|i||j|\n\trd(n, m, r);\n\tU (i, 1, n) {\n\t\trd(x[i], y[i], a[i]);\n\t\t++g[x[i]][y[i]];\n\t}\n\tU (i, 1, N - 1) U (j, 1, N - 1)\n\t\tg[i][j] += g[i - 1][j] + g[i][j - 1] - g[i - 1][j - 1];\n\n\tll ans = 0;\n\tU (i, 1, n) U (j, 1, n) {\n\t\tint cIJ = sum(max(x[i], x[j]) - r, max(y[i], y[j]) - r, min(x[i], x[j]) + r, min(y[i], y[j]) + r),\n\t\t\tcI = sum(x[i] - r, y[i] - r, x[i] + r, y[i] + r) - cIJ,\n\t\t\tcJ = sum(x[j] - r, y[j] - r, x[j] + r, y[j] + r) - cIJ;\n\t\tll fA = (C(n, m) - C(n - cIJ, m) + P) % P;\n\t\tll fB = (C(n - cIJ, m) - C(n - cIJ - cI, m) - C(n - cIJ - cJ, m) + C(n - cIJ - cI - cJ, m) + P * 2) % P; // \u9009\u51fa\u5355\u72ec ci \u548c cj\n\t\t(ans += a[i] * a[j] % P * (fA + fB)) %= P;\n\t}\n\tprintf(\"%lld\", ans);\n}\n```",
        "postTime": 1662724578,
        "uid": 120324,
        "name": "Yansuan_HCl",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] CF1425D Danger of Mad Snakes"
    }
]