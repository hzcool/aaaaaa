[
    {
        "content": "\u5f88\u660e\u663e\u662f\u4e00\u4e2a\u6811\u5f62 DP\uff0c\u4e14\u4e00\u4e2a\u70b9\u7684\u8d21\u732e\u53ea\u548c\u9009\u51fa\u6765\u7684\u6570\u7684\u4e2a\u6570\u7684\u5947\u5076\u6027\u6709\u5173\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u4e00\u4e2a $f_{x,0/1}$ \u8868\u793a\u5947/\u5076\u3002\n\n\u63a5\u4e0b\u6765\u8ba8\u8bba\u8f6c\u79fb\uff1a\n\n\u5047\u5982\u8bf4\u53ea\u6709\u4e0a\u5347\u4e00\u79cd\u6392\u6cd5\uff0c\u90a3\u4e48\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\uff1a\n\n$f_{x,0}=f_{x,1}\\times f_{y,1}+f_{x,0}\\times{(f_{y,0}+1)}$ \uff08$+1$ \u8868\u793a\u4ec0\u4e48\u90fd\u4e0d\u9009\u7684\u65b9\u6848\uff09\n\n$f_{x,1}$ \u8f6c\u79fb\u7c7b\u4f3c\u3002\n\n\u4f46\u73b0\u5728\u8fd8\u6709\u4e0b\u964d\u6392\u6cd5\uff0c\u8003\u8651\u5bb9\u65a5\uff0c\u6c42\u51fa\u4e0a\u5347\u6392\u6cd5\u540e $\\times 2$ \u51cf\u53bb\u53ea\u80fd\u7b97\u4e00\u6b21\u7684\u6392\u6cd5\u3002\n\n\u4ee4\u9009\u51fa\u7684\u513f\u5b50\u975e\u96f6\u5b50\u6811\u5927\u5c0f\u4e3a $a_i$\u3002\n\n\u5219\u4e00\u4e2a\u72b6\u6001\u4e0d\u80fd\u7b97\u4e24\u6b21\u5f53\u4e14\u4ec5\u5f53\u4e0d\u5b58\u5728\u4e00\u4e2a $i$ \u4f7f\u5f97 $i$ \u7684\u524d\u7f00\u548c\u4e0e\u540e\u7f00\u548c\u5728\u6a21 $2$ \u610f\u4e49\u4e0b\u4e0d\u7b49\u3002\n\n\u8fdb\u884c\u4e00\u4e9b\u5206\u6790\uff1a\n\n\u82e5\u5b58\u5728 $i,a_i\\bmod 2\\neq a_{i+1}\\bmod 2$\uff0c\u90a3\u4e48 $i$ \u6216 $i+1$ \u4e00\u5b9a\u6ee1\u8db3\u524d\u7f00\u548c\u4e0e\u540e\u7f00\u548c\u5728\u6a21 $2$ \u610f\u4e49\u4e0b\u4e0d\u7b49\u3002\n\n\u6240\u4ee5\u8bf4\u4e0d\u80fd\u91cd\u590d\u8ba1\u7b97\u7684\u72b6\u6001\u7684\u5947\u5076\u6027\u76f8\u540c\u3002\n\n\u82e5\u5168\u4e3a\u5076\u6570\uff0c\u53ea\u80fd\u7b97\u4e00\u6b21\u3002\n\n\u82e5\u5168\u4e3a\u5947\u6570\uff0c\u82e5\u4e2a\u6570\u4e3a\u5947\u6570\u5219\u53ea\u80fd\u7b97\u4e00\u6b21\uff0c\u5426\u5219\u5012\u8fc7\u6765\u4e5f\u662f\u5bf9\u7684\uff0c\u518d\u6765\u4e00\u4e2a DP \u8f6c\u79fb\u4e00\u4e0b\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read(){\n\tre int t=0;re char v=getchar();\n\twhile(v<'0')v=getchar();\n\twhile(v>='0')t=(t<<3)+(t<<1)+v-48,v=getchar();\n\treturn t;\n}\nconst int M=1e9+7;\nint n,f[100002][2],m,t,g[100002][4];\ninline void add(re int &x,re int y){(x+=y)>=M?x-=M:x;}\ninline int Mod(re int x,re int y){return (x+=y)>=M?x-=M:x;}\nvector<int>v[100002];\ninline void dfs(re int x){\n\tsort(v[x].begin(),v[x].end());\n\tf[x][1]=1,f[x][0]=0;\n\tfor(re int i=0,z;i<(int)v[x].size();++i){\n\t\tdfs(z=v[x][i]);\n\t\tre int tmp0=f[x][0],tmp1=f[x][1];\n\t\tadd(f[x][0],1ll*tmp0*f[z][0]%M);\n\t\tadd(f[x][0],1ll*tmp1*f[z][1]%M);\n\t\tadd(f[x][1],1ll*tmp0*f[z][1]%M);\n\t\tadd(f[x][1],1ll*tmp1*f[z][0]%M);\n\t}\n\tre int aaa=1;\n\treverse(v[x].begin(),v[x].end());\n\tadd(f[x][0],f[x][0]),add(f[x][1],f[x][1]);\n\tg[x][0]=1,g[x][1]=0;\n\tfor(re int i=0,z;i<(int)v[x].size();++i){\n\t\tz=v[x][i];\n\t\tre int tmp=g[x][1];\n\t\tadd(g[x][1],1ll*g[x][0]*f[z][1]%M);\n\t\tadd(g[x][0],1ll*tmp*f[z][1]%M);\n\t\taaa=1ll*aaa*(f[z][0]+1)%M;\n\t}\n\tadd(f[x][0],M-g[x][1]);\n\tadd(f[x][1],M-aaa);\n}\nint main(){\n//\tfreopen(\"randomdfs.in\",\"r\",stdin);\n//\tfreopen(\"randomdfs.out\",\"w\",stdout);\n\tt=1;\n\twhile(t--){\n\t\tn=read();\n\t\tfor(re int i=1;i<=n;++i)v[i].clear();\n\t\tfor(re int i=2;i<=n;++i)v[read()].push_back(i);\n\t\tdfs(1);\n\t\tprintf(\"%d\\n\",(f[1][0]+f[1][1])%M);\n\t}\n}\n\n```\n",
        "postTime": 1606801718,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF482D \u3010Random Function and Tree\u3011"
    },
    {
        "content": "\u4ec0\u4e48\u65f6\u5019\u5012\u5e8f\u8bbf\u95ee\u513f\u5b50\u548c\u6b63\u5e8f\u8bbf\u95ee\u513f\u5b50\u6ca1\u6709\u533a\u522b\uff1f\u5f53\u4e14\u4ec5\u5f53 $\\forall y\\in son_x$\uff0c$pre_{y}+1\\equiv suf_{y}+1\\pmod 2$\uff08$pre_y$ \u4e3a $y$ \u4e4b\u524d\u8bbf\u95ee\u7684\u513f\u5b50 size \u603b\u548c\uff0c$suf_y$ \u4e3a $y$ \u4e4b\u540e\u8bbf\u95ee\u7684\u513f\u5b50 size \u603b\u548c\uff09\u3002\u8be5\u5f0f\u4ec5\u5728 $\\forall$ \u9009\u62e9\u7684 $y$\uff0c\u90fd\u6709 $size_y$ \u4e3a [\u5076\u6570]/[\u5947\u6570\u4e14\u9009\u51fa\u7684 $y$ \u603b\u4e2a\u6570\u4e3a\u5947\u6570] \u65f6\uff0c\u624d\u4f1a\u6210\u7acb\u3002\n\n\u8bbe $f_{x,0/1}$ \u4e3a $x$ \u7684\u5b50\u6811\u5185\u9009\u51fa\u5947\u6570/\u5076\u6570\u4e2a\u8282\u70b9\uff0ccol \u6570\u7ec4\u65b9\u6848\u6570\uff0c$g_{x,0/1,x/0}$ \u4e3a $x$ \u7684\u5b50\u6811\u5185\u9009\u51fa\u5947\u6570/\u5076\u6570\u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u5b50\u6811\u5185\u8bbf\u95ee\u7684\u8282\u70b9\u6570\uff08\u5373 size\uff09\u5168\u90e8\u662f\u5947\u6570/\u5076\u6570\uff0c\u7684 col \u6570\u7ec4\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u663e\u7136\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nvector<int> gr[100005];\nint f[100005][2],g[100005][2][2],n;\n//g[i][0/1][0/1]: i\u7684\u5b50\u6811\uff08\u6682\u4e0d\u8003\u8651i\uff09\uff0c\u548c\u4e3a\u5076/\u5947\uff0c\u5168\u662f\u5076/\u5168\u662f\u5947\nvoid dfs(int x){\n\tfor(int y:gr[x])dfs(y);\n\tg[x][0][0]=g[x][0][1]=f[x][1]=1;\n\tfor(int y:gr[x]){\n\t\tint t1=(1ll*f[x][0]*f[y][1]+1ll*f[y][0]*f[x][1])%mod;\n\t\tint t0=(1ll*f[x][0]*f[y][0]+1ll*f[y][1]*f[x][1])%mod;\n\t\tf[x][0]=(f[x][0]+t0)%mod,f[x][1]=(f[x][1]+t1)%mod;\n\t\tint t00=1ll*g[x][0][0]*f[y][0]%mod;\n\t\tint t01=1ll*g[x][1][1]*f[y][1]%mod;\n\t\tint t11=1ll*g[x][0][1]*f[y][1]%mod;\n\t\tg[x][0][0]=(g[x][0][0]+t00)%mod;\n\t\tg[x][0][1]=(g[x][0][1]+t01)%mod;\n\t\tg[x][1][1]=(g[x][1][1]+t11)%mod;\n\t}\n\tf[x][0]=(2ll*f[x][0]-g[x][1][1]+mod)%mod;\n\tf[x][1]=(2ll*f[x][1]-g[x][0][0]+mod)%mod;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=2,x;i<=n;i++)scanf(\"%d\",&x),gr[x].push_back(i);\n\tdfs(1),printf(\"%d\\n\",(f[1][0]+f[1][1])%mod);\n    return 0;\n}\n```",
        "postTime": 1606803527,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF482D \u3010Random Function and Tree\u3011"
    },
    {
        "content": "## \u9898\u76ee\u7b80\u8ff0\n\n\u6709\u4e00\u68f5\u6709\u6839\u6811\uff0c\u6839\u4e3a $1$\uff0c\u6bcf\u4e2a\u8282\u70b9\u6709\u70b9\u6743\uff0c\u521d\u59cb\u5168\u4e3a $-1$\uff0c\u6709\u4ee5\u4e0b\u4f2a\u4ee3\u7801\uff1a\n\n```cpp\ncur = 0\ncol[] = {-1, -1, ...}\n\nrand():\n\t\u968f\u673a\u8fd4\u56de 0 \u6216 1\n\npaint(\u5f53\u524d\u8282\u70b9 u):\n\tcol[u] = cur\n\t\u5f53 cur == 1 \u65f6: cur = 0\n\t\u5426\u5219: cur = 1\n\t\u5f53 rand() == 1 \u65f6: \u5c06 u \u7684\u6240\u6709\u513f\u5b50\u6309\u7167\u8282\u70b9\u7f16\u53f7\u5347\u5e8f\u6392\u5e8f\n\t\u5426\u5219: \u5c06 u \u7684\u6240\u6709\u513f\u5b50\u6309\u7167\u8282\u70b9\u7f16\u53f7\u964d\u5e8f\u6392\u5e8f\n\t\u904d\u5386\u6bcf\u4e00\u4e2a u \u7684\u513f\u5b50 v:\n\t\t\u5f53 rand() == 1 \u65f6: paint(v)\n\t\u65e0\u8fd4\u56de\n```\n\n\u6c42\u8fd0\u884c\u4e00\u904d `paint(1)` \u540e\u8282\u70b9\u70b9\u6743\u7684\u65b9\u6848\u6570 mod $10^9+7$\u3002\n\n## \u9898\u89e3\n\n\u5047\u5982\u53bb\u6389 `paint` \u5f00\u5934\u7684\u968f\u673a\u6392\u5e8f\u8fd9\u4e2a\u95ee\u9898\u8be5\u600e\u4e48\u505a\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u8bbe $dp_u$ \u4e3a\u8fd0\u884c\u4e00\u904d `paint(u)` \u540e $u$ \u7684\u5b50\u6811\u7684\u70b9\u6743\u65b9\u6848\u6570\uff0c\u5219\u7531\u4e8e\u4e00\u513f\u5b50\u7684\u70b9\u6743\u53d6\u51b3\u4e8e\u81ea\u5df1\u662f\u5426\u9700\u8981 `paint` \u4ee5\u53ca\u524d\u9762\u7684\u513f\u5b50\uff0c\u800c\u6bcf\u4e00\u4e2a\u513f\u5b50\u5904\u53d7\u540e\u6548\u6027\u5f71\u54cd\u7684\u53ea\u6709 `cur` \u503c\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u4e58\u6cd5\u539f\u7406\u8ba1\u7b97\uff1a\n\n$$\ndp_u\\gets\\prod_{v\\in u\\text{' son}} (1+dp_v)\n$$\n\n\u4f46\u662f\u52a0\u4e0a\u4e86\u968f\u673a\u6392\u5e8f\uff0c\u6211\u4eec\u4e0d\u80fd\u53ea\u5c06\u8d21\u732e\u4e58\u4ee5 $2$\uff0c\u56e0\u4e3a\u6709\u4e9b\u65b9\u6848\u5b83\u662f\u201c\u5bf9\u79f0\u7684\u201d\uff0c\u5373\u65e0\u8bba\u5c06\u513f\u5b50\u5347\u5e8f\u8fd8\u662f\u964d\u5e8f\u6392\u5e8f\uff0c\u6700\u7ec8\u67d3\u8272\u65b9\u6848\u59cb\u7ec8\u4e0d\u53d8\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u5c06\u8fd9\u4e9b\u60c5\u51b5\u53bb\u6389\u3002\n\n\u8fdb\u4e00\u6b65\uff0c\u6211\u4eec\u53d1\u73b0\u60c5\u51b5\u51fa\u73b0\u5f53\u4e14\u4ec5\u5f53 \u5347\u5e8f\u65f6\u4efb\u610f\u513f\u5b50\u524d\u9700\u8981\u6539\u70b9\u6743\u7684\u8282\u70b9\u4e2a\u6570 \u4e0e \u5347\u5e8f\u65f6\u4efb\u610f\u513f\u5b50\u540e\u9700\u8981\u6539\u70b9\u6743\u7684\u8282\u70b9\u4e2a\u6570 \u5173\u4e8e $2$ \u540c\u4f59\u3002\n\n\u901a\u8fc7\u679a\u4e3e\uff0c\u53ea\u6709\u4ee5\u4e0b\u60c5\u51b5\u7b26\u5408\u8981\u6c42\uff1a\n\n- \u6240\u6709\u7684\u9700\u8981\u67d3\u8272\u7684\u5b50\u6811\u90fd\u662f\u5076\u6570\u8282\u70b9\u9700\u8981\u67d3\u8272\u3002\n- \u6240\u6709\u7684\u9700\u8981\u67d3\u8272\u7684\u5b50\u6811\u90fd\u662f\u5947\u6570\u8282\u70b9\u9700\u8981\u67d3\u8272\uff0c\u4e14\u9700\u8981\u67d3\u8272\u7684\u5b50\u6811\u6709\u5947\u6570\u4e2a\u3002\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u57fa\u4e8e\u8fd9\u4e2a\u8fdb\u884c dp \u4e86\u3002\n\n\u5b9a\u4e49 $dp_{u,0/1}$ \u4e3a $u$ \u53f7\u8282\u70b9\u5b50\u6811\u603b\u67d3\u8272\u8282\u70b9\u4e3a\u5076 / \u5947\u6570\u4e2a\u7684\u65b9\u6848\u6570\u3002\n\n\u5b9a\u4e49 $f_{u,0/1}$ \u4e3a $u$ \u53f7\u8282\u70b9\u7684\u513f\u5b50\u8282\u70b9\u6709\u5076 / \u5947\u6570\u4e2a\u8981\u67d3\u5947\u6570\u8282\u70b9\u7684\u65b9\u6848\u6570\u3002\n\n\u8fd9\u4e24\u4e2a dp \u72b6\u6001\u662f\u52a8\u6001\u66f4\u65b0\u7684\u3002\n\n\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n1. \u8ba1\u7b97\u603b\u8d21\u732e\uff1a\n   \n   $$\n   \\begin{aligned}\n   dp_{u,0}&\\gets dp'_{u,0}\\times(1+dp_{v,0})+dp'_{u,1}\\times dp_{v,1}\\\\\n   dp_{u,1}&\\gets dp'_{u,0}\\times dp_{v,1}+dp'_{u,0}\\times(1+dp_{v,0})\n   \\end{aligned}\n   $$\n   \n   \u6700\u540e\u5c06 $dp_{u,0}$ \u548c $dp_{u,1}$ \u5404\u81ea\u4e58\u4ee5 $2$\u3002\n   \n2. \u4efb\u610f\u5076\u6570\u5b50\u6811\uff1a\n   \n   $$\n   \\text{cost}_u\\gets\\prod_{v}dp_{v,1}\n   $$\n   \n   \u6700\u540e $dp_{u,1}$ \u51cf\u53bb $\\text{cost}_u$\u3002\n   \n3. \u5947\u6570\u4e2a\u5947\u6570\u5b50\u6811\uff1a\n   \n   $$\n   \\begin{aligned}\n   f_{u,0}&\\gets f'_{u,0}+f'_{u,1}\\times dp_{v,1}\\\\\n   f_{u,1}&\\gets f'_{u,1}+f'_{u,0}\\times dp_{v,1}\n   \\end{aligned}\n   $$\n   \n   \u6700\u540e\u5c06 $dp_{u,0}$ \u51cf\u53bb $f_{u,1}$\u3002\n   \n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\nconst int MAXN = 100005;\nconst int mod = 1000000007;\nstruct edge {\n\tint to, nxt;\n} edges[MAXN]; int head[MAXN], tot;\nvoid add(int u, int v) {\n\tedges[++tot].to = v; edges[tot].nxt = head[u]; head[u] = tot;\n}\nint dp[MAXN][2], f[MAXN][2];\n// dp[u][0/1]: u \u8282\u70b9\uff0c\u603b\u67d3\u8272\u4e2a\u6570\u4e3a\u5076 / \u5bc4\u6570\u4e2a\u7684\u65b9\u6848\u6570\n// f[u][0/1]: u \u8282\u70b9\uff0c\u513f\u5b50\u8282\u70b9\u6709\u5076 / \u5bc4\u6570\u4e2a\u67d3\u4e86\u5bc4\u6570\u4e2a\u8282\u70b9\u7684\u65b9\u6848\u6570 \n// \u4e24\u8005\u7686\u52a8\u6001\u66f4\u65b0 \nvoid dfs(int u) {\n\tfor (int i = head[u]; i; i = edges[i].nxt) dfs(edges[i].to);\n\t// \u8ba1\u7b97\u6b63\u53cd\u8d21\u732e \n\tdp[u][0] = 0; dp[u][1] = 1;\n\tfor (int i = head[u]; i; i = edges[i].nxt) {\n\t\tint dpu0 = dp[u][0], dpu1 = dp[u][1];\n\t\tdp[u][0] = (dpu0 * (1ll + dp[edges[i].to][0]) + 1ll * dpu1 * dp[edges[i].to][1]) % mod;\n\t\tdp[u][1] = (1ll * dpu0 * dp[edges[i].to][1] + dpu1 * (1ll + dp[edges[i].to][0])) % mod;\n\t}\n\tdp[u][0] = dp[u][0] * 2 % mod; dp[u][1] = dp[u][1] * 2 % mod;\n\t// \u79fb\u9664\u591a\u4f59\u8d21\u732e\n\t// 1. \u4efb\u610f\u4e2a \u5076\u6811\n\tint cst = 1;\n\tfor (int i = head[u]; i; i = edges[i].nxt) {\n\t\tcst = cst * (1ll + dp[edges[i].to][0]) % mod;\n\t}\n\tdp[u][1] = (dp[u][1] + mod - cst) % mod;\n\t// 2. \u5bc4\u6570\u4e2a \u5bc4\u6811\n\tf[u][0] = 1; f[u][1] = 0;\n\tfor (int i = head[u]; i; i = edges[i].nxt) {\n\t\tint tmp = f[u][0];\n\t\tf[u][0] = (f[u][0] + 1ll * f[u][1] * dp[edges[i].to][1]) % mod;\n\t\tf[u][1] = (f[u][1] + 1ll * tmp * dp[edges[i].to][1]) % mod;\n\t}\n\tdp[u][0] = (dp[u][0] + mod - f[u][1]) % mod;\n}\nint main() {\n\tint n; scanf(\"%d\", &n);\n\tfor (int i = 2; i <= n; i++) {\n\t\tint fa; scanf(\"%d\", &fa); add(fa, i);\n\t}\n\tdfs(1);\n\tprintf(\"%d\", (dp[1][0] + dp[1][1]) % mod);\n\treturn 0;\n}\n```",
        "postTime": 1664804099,
        "uid": 109114,
        "name": "_l_l_",
        "ccfLevel": 8,
        "title": "\u3010\u9898\u89e3\u3011CF482D"
    }
]