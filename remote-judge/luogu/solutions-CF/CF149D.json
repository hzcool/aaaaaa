[
    {
        "content": "\u5237\u533a\u95f4dp\u7684\u65f6\u5019\u5237\u5230\u7684\u597d\u9898\uff0c\u5b89\u5229\u4e00\u6ce2\u8fd9\u4e2a\u7cfb\u5217\uff1ahttps://www.luogu.org/blog/hhz6830975/kuangbin-dai-ni-fei-zhuan-ti-er-shi-er-ou-jian-dp\n\n\u8bbe$dp[l][r][x][y]$\u4e3a\u533a\u95f4$[l,r]$\u4e24\u7aef\u989c\u8272\u5206\u522b\u4e3a$x$\u3001$y$\u7684\u65b9\u6848\u6570\uff080\u4e3a\u4e0d\u67d3\u8272\uff0c1\u4e3a\u7ea2\u8272\uff0c2\u4e3a\u84dd\u8272\uff09\n\n\u5bf9\u4e8e$dp[l][r][x][y]$\uff0c<font color=#A52A2A>\u82e5\u4fdd\u8bc1$[l,r]$\u4e3a\u4e00\u4e2a\u5408\u6cd5\u7684\u5e8f\u5217</font>\uff0c\u5219\uff1a\n\n1.\u82e5$l+1=r$\uff0c\u663e\u7136\u5e8f\u5217\u4e3a\n\n$$()$$\n\n\u5219\u6709\n\n```cpp\ndp[l][r][0][1]=dp[l][r][0][2]=dp[l][r][1][0]=dp[l][r][2][0]=1;\n```\n\n2.\u82e5\u62ec\u53f7$l$\u4e0e$r$\u914d\u5bf9\uff0c\u5219\u5bf9\u5e94\u7684\u5e8f\u5217\u4e3a\n\n$$(...)$$\n\n\u90a3\u4e48\u6709\n\n```cpp\nfor(int i=0;i<=2;i++)\n    for(int j=0;j<=2;j++){\n        if(j!=1) dp[l][r][0][1]=(dp[l][r][0][1]+dp[l+1][r-1][i][j])%mod;\n        if(j!=2) dp[l][r][0][2]=(dp[l][r][0][2]+dp[l+1][r-1][i][j])%mod;\n        if(i!=1) dp[l][r][1][0]=(dp[l][r][1][0]+dp[l+1][r-1][i][j])%mod;\n        if(i!=2) dp[l][r][2][0]=(dp[l][r][2][0]+dp[l+1][r-1][i][j])%mod;\n    }\n```\n\n3.\u82e5\u62ec\u53f7$l$\u4e0e$r$\u4e0d\u914d\u5bf9\uff0c\u5219\u5bf9\u5e94\u7684\u5e8f\u5217\u4e3a\n\n$$(...)...(...)$$\n\n\u8bbe\u4e0e\u62ec\u53f7$l$\u914d\u5bf9\u7684\u62ec\u53f7\u4e3a$match[l]$\uff0c\u5219\u6709\n\n```cpp\nfor(int i=0;i<=2;i++)\n    for(int j=0;j<=2;j++)\n        for(int p=0;p<=2;p++)\n            for(int q=0;q<=2;q++){\n                if((j==1&&p==1)||(j==2&&p==2)) continue;\n                dp[l][r][i][q]=(dp[l][r][i][q]+dp[l][match[l]][i][j]*dp[match[l]+1][r][p][q]%mod)%mod;\n            }\n```\n\n\u4ee5\u4e0a\u4e3a\u72b6\u6001\u8f6c\u79fb\u65b9\u5f0f\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u672c\u9898\u4e0d\u91c7\u7528\u4e00\u822c\u7684dp\u987a\u5e8f\uff0c\u800c\u662f\u4f7f\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\n\n\u539f\u56e0\u5728\u4e8e\u672c\u9898\u8981\u6c42\u914d\u5bf9\u7684\u62ec\u53f7\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u67d3\u8272\uff0c\u4f46\u6309\u4e00\u822c\u7684\u65b9\u5f0f\u96be\u4ee5\u4fdd\u8bc1\u914d\u5bf9\u7684\u62ec\u53f7\u5728\u540c\u4e00\u533a\u95f4\u5185\uff0c\u5373\u4e0d\u80fd\u4fdd\u8bc1\u8f6c\u79fb\u4e2d\u7528\u5230\u7684\u5e8f\u5217\u90fd\u662f\u5408\u6cd5\u7684\uff0c\u5904\u7406\u6bd4\u8f83\u9ebb\u70e6\n\n\u800c\u91c7\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\u7684\u65b9\u5f0f\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u5728\u539f\u6765\u7684\u5408\u6cd5\u5e8f\u5217\u4e0a\u589e\u52a0/\u5220\u9664\u4e00\u5bf9\u62ec\u53f7\uff0c\u6216\u662f\u5c06\u5408\u6cd5\u5e8f\u5217\u5206\u5272\u6210\u4e24\u4e2a\u5408\u6cd5\u5e8f\u5217/\u5c06\u4e24\u4e2a\u5408\u6cd5\u5e8f\u5217\u5408\u5e76\uff0c\u5f97\u5230\u7684\u4ecd\u7136\u662f\u5408\u6cd5\u5e8f\u5217\uff0c\u5904\u7406\u8d77\u6765\u5c31\u65b9\u4fbf\u5f97\u591a\uff1b\u800c\u4e14\u8fd8\u4e0d\u9700\u8981\u8003\u8651\u4e0d\u5408\u6cd5\u7684\u72b6\u6001\uff0c\u65f6\u95f4\u4e0a\u4e5f\u5f97\u5230\u4f18\u5316\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <stack>\nusing namespace std;\nconst int maxn=710;\nconst int mod=1e9+7;\nint n,match[maxn];\nlong long dp[maxn][maxn][3][3];\nchar s[maxn];\nstack <int> St;\n\nvoid dfs(int l,int r){\n\tif(l+1==r) dp[l][r][0][1]=dp[l][r][0][2]=dp[l][r][1][0]=dp[l][r][2][0]=1;\n\telse if(match[l]==r){\n\t\tdfs(l+1,r-1);\n\t\tfor(int i=0;i<=2;i++)\n\t\t\tfor(int j=0;j<=2;j++){\n\t\t        if(j!=1) dp[l][r][0][1]=(dp[l][r][0][1]+dp[l+1][r-1][i][j])%mod;\n\t\t        if(j!=2) dp[l][r][0][2]=(dp[l][r][0][2]+dp[l+1][r-1][i][j])%mod;\n\t\t        if(i!=1) dp[l][r][1][0]=(dp[l][r][1][0]+dp[l+1][r-1][i][j])%mod;\n\t\t        if(i!=2) dp[l][r][2][0]=(dp[l][r][2][0]+dp[l+1][r-1][i][j])%mod;\n\t\t\t}\n\t}\n\telse{\n\t\tdfs(l,match[l]),dfs(match[l]+1,r);\n\t\tfor(int i=0;i<=2;i++)\n\t\t\tfor(int j=0;j<=2;j++)\n\t\t\t\tfor(int p=0;p<=2;p++)\n\t\t\t\t\tfor(int q=0;q<=2;q++){\n\t\t\t\t\t\tif((j==1&&p==1)||(j==2&&p==2)) continue;\n\t\t\t\t\t\tdp[l][r][i][q]=(dp[l][r][i][q]+dp[l][match[l]][i][j]*dp[match[l]+1][r][p][q]%mod)%mod;\n\t\t\t\t\t}\n\t}\n}\n\nint main(){\n\tscanf(\"%s\",s);\n\tn=strlen(s);\n\tfor(int i=0;i<n;i++){\n\t\tif(s[i]=='(') St.push(i);\n\t\telse match[St.top()]=i,match[i]=St.top(),St.pop();\n\t}\n\tdfs(0,n-1);\n\tlong long ans=0;\n\tfor(int i=0;i<=2;i++)\n\t\tfor(int j=0;j<=2;j++)\n\t\t\tans=(ans+dp[0][n-1][i][j])%mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1517898383,
        "uid": 32837,
        "name": "hhz6830975",
        "ccfLevel": 0,
        "title": "CF149D Coloring Brackets\uff08\u533a\u95f4dp\uff0c\u8bb0\u5fc6\u5316\u641c\u7d22\uff09"
    },
    {
        "content": "\u4e00\u9053\u533a\u95f4 dp \u7684\u597d\u9898\u3002\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1f](http://yunqian-qwq.github.io/post/ti-jie-cf149d-coloring-brackets/)\n\n------------\n\n## \u62ec\u53f7\u914d\u5bf9\n\n\u8fd9\u4e2a\uff0c\u4e0d\u7528\u591a\u8bf4\u4e86\u5427\u3002\n\n\u4ee4 `right[i]` \u4e3a\u7b2c $i$ \u4e2a\u62ec\u53f7\u7684\u914d\u5bf9\u62ec\u53f7\u3002\n\n\u4ee3\u7801\u5f88\u597d\u5199\uff1a\n\n```cpp\nscanf(\"%s\",s+1);\nint n=strlen(s+1);\nfor(int i=1;i<=n;i++){\n    if(s[i]=='(')stk.push(i);\n    else{\n        right[stk.top()]=i;\n        right[i]=stk.top();\n        stk.pop();\n    }\n}\n```\n\n\u5177\u4f53\u539f\u7406\u5f88\u7b80\u5355\uff0c\u53ef\u4ee5\u770b [UVA673 \u5e73\u8861\u7684\u62ec\u53f7 Parentheses Balance](https://www.luogu.com.cn/problem/UVA673)\u3002\n\n------------\n\n\n## \u8bbe\u8ba1\u72b6\u6001\n\n\u770b\u5230\u9898\u540e\u7b2c\u4e00\u53cd\u5e94\u5f53\u7136\u662f\u4ee4 `dp[l][r]` \u4e3a\u5c06\u533a\u95f4 $[l,r]$ \u5185\u67d3\u8272\u7684\u603b\u65b9\u6848\u6570\u3002\n\n\u4f46\u662f\u9898\u76ee\u4e0a\u8bf4\uff1a\n\n>1. \u4e00\u4e2a\u62ec\u53f7\u53ef\u4ee5\u67d3\u7ea2\u8272\u3001\u84dd\u8272\u6216\u4e0d\u67d3\u8272\n>2. \u4e00\u5bf9\u5339\u914d\u7684\u62ec\u53f7\u9700\u8981\u4e14\u53ea\u80fd\u5c06\u5176\u4e2d\u4e00\u4e2a\u67d3\u8272\n>3. \u76f8\u90bb\u4e24\u4e2a\u62ec\u53f7\u989c\u8272\u4e0d\u80fd\u76f8\u540c\uff08\u4f46\u53ef\u4ee5\u90fd\u4e0d\u67d3\u8272\uff09\n\n\u6709\u4e86\u8fd9\u4e9b\u9650\u5236\u4e4b\u540e\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u5355\u7eaf\u5730\u5b9a\u4e49 `dp[l][r]` \u4e3a\u5c06\u533a\u95f4 $[l,r]$ \u5185\u67d3\u8272\u7684\u603b\u65b9\u6848\u6570\uff0c\u5f88\u96be\u8f6c\u79fb\u3002\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u66f4\u591a\u7684\u4fe1\u606f\u6765\u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u5176\u5b9e\u53ea\u9700\u8981\u589e\u52a0\u8fd9\u4e2a\u533a\u95f4\u4e24\u7aef\u7684\u62ec\u53f7\u989c\u8272\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u8f6c\u79fb\u4e86\u3002\n\n\u90a3\u4e48\u5c31\u8bbe\u8ba1 `dp[l][r][p][q]` \u4e3a\u5c06\u533a\u95f4 $[l,r]$ \u5185\u67d3\u8272\u7684\u603b\u65b9\u6848\u6570\uff0c\u4e14\u6700\u5de6\u8fb9\u7684\u62ec\u53f7\u989c\u8272\u4e3a $p$\uff0c\u6700\u53f3\u8fb9\u7684\u62ec\u53f7\u989c\u8272\u4e3a $q$\u3002\n\n\u5176\u4e2d $p,q$ \u7684\u503c\u4e3a $0$ \u65f6\u4ee3\u8868\u4e0d\u67d3\u8272\uff0c\u4e3a $1$ \u65f6\u4ee3\u8868\u84dd\u8272\uff0c\u4e3a $2$ \u65f6\u4ee3\u8868\u7ea2\u8272\u3002\n\n------------\n\n## \u8f6c\u79fb\u65b9\u7a0b\n\n\u9996\u5148\u662f\u521d\u59cb\u6761\u4ef6\uff1a\u5982\u679c $r=l+1$\uff0c\u90a3\u4e48 $[l,r]$ \u4e00\u5b9a\u662f\u4e00\u5bf9\u5339\u914d\u7684\u62ec\u53f7\u3002\n\n\u6240\u4ee5\u6709 `dp[l][r][0][1]=dp[l][r][0][2]=dp[l][r][1][0]=dp[l][r][2][0]=1;`\u3002\n\n\u6bd5\u7adf\u6574\u4e2a\u533a\u95f4\u957f\u5ea6\u5c31\u662f $2$\uff0c\u90a3\u4e48\u4e00\u65e6\u5de6\u3001\u53f3\u7aef\u70b9\u7684\u989c\u8272\u786e\u5b9a\u4e86\uff0c\u6574\u4e2a\u533a\u95f4\u7684\u67d3\u8272\u65b9\u6848\u81ea\u7136\u4e5f\u5c31\u786e\u5b9a\u4e86\uff0c\u6240\u4ee5\u53ea\u6709\u4e00\u79cd\u3002\n\n\u7531\u4e8e\u300c\u4e00\u5bf9\u5339\u914d\u7684\u62ec\u53f7\u9700\u8981\u4e14\u53ea\u80fd\u5c06\u5176\u4e2d\u4e00\u4e2a\u67d3\u8272\u300d\uff0c\u6240\u4ee5 `dp[l][r][0][0]=dp[l][r][1][2]=dp[l][r][2][1]=dp[l][r][1][1]=dp[l][r][2][2]=0`\uff0c\u4e0d\u5fc5\u518d\u4e13\u95e8\u8fd9\u4e94\u79cd\u4e13\u95e8\u8d4b\u503c\u4e86\u3002\n\n\u7136\u540e\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\uff0c\u9700\u8981\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- \u5982\u679c\u7b2c $l$ \u4e2a\u62ec\u53f7\u521a\u597d\u548c\u7b2c $r$ \u4e2a\u62ec\u53f7\u914d\u5bf9\uff1a\n\n\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a`(......)`\u3002\n\n\u6240\u4ee5\u6613\u77e5 `dp[l][r][0][0]=dp[l][r][1][2]=dp[l][r][2][1]=dp[l][r][1][1]=dp[l][r][2][2]=0`\u3002\u539f\u56e0\u548c\u4e0a\u9762\u4e00\u6837\u3002\n\n\u6240\u4ee5\u8fd9\u4e94\u4e2a\u5c31\u4e0d\u9700\u8981\u518d\u8f6c\u79fb\u4e86\u3002\n\n\u81f3\u4e8e\u5269\u4e0b\u7684\u56db\u79cd\u60c5\u51b5\uff0c\u4ee5 `dp[l][r][0][1]` \u4e3a\u4f8b\uff1a\n\n\u7531\u4e8e\u5de6\u7aef\u70b9\u4e0d\u67d3\u8272\uff0c\u53f3\u7aef\u70b9\u662f $1$                  \n\u6240\u4ee5\u5b83\u4e0d\u80fd `dp[l+1][r-1][\u00b7][1]` \u8f6c\u79fb\u8fc7\u6765\u3002     \n\u5426\u5219\u76f8\u90bb\u4e24\u4e2a\u62ec\u53f7\u7684\u989c\u8272\u76f8\u540c\uff0c\u5c31\u4e0d\u7b26\u5408\u6761\u4ef6\u4e86\u3002         \n\n\u90a3\u4e48\u6211\u4eec\u4ece $0$ \u5230 $2$ \u679a\u4e3e $i,j$\uff0c\u7136\u540e\u770b $i,j$ \u7684\u503c\u6765\u4e00\u4e2a\u4e00\u4e2a\u8f6c\u79fb\u5373\u53ef\u3002\n\n```cpp\nfor(int i=0;i<=2;i++){\n    for(int j=0;j<=2;j++){\n        if(j!=1)dp[l][r][0][1]+=dp[l+1][r-1][i][j],dp[l][r][0][1]%=mod;\n        if(j!=2)dp[l][r][0][2]+=dp[l+1][r-1][i][j],dp[l][r][0][2]%=mod;\n        if(i!=1)dp[l][r][1][0]+=dp[l+1][r-1][i][j],dp[l][r][1][0]%=mod;\n        if(i!=2)dp[l][r][2][0]+=dp[l+1][r-1][i][j],dp[l][r][2][0]%=mod;\n    }\n}\n```\n\n- \u5982\u679c\u7b2c $l$ \u4e2a\u62ec\u53f7\u521a\u597d\u548c\u7b2c $r$ \u4e2a\u62ec\u53f7\u4e0d\u914d\u5bf9\uff1a\n\n\u90a3\u4e48\u6211\u4eec\u627e\u51fa\u4e0e\u7b2c $l$ \u4e2a\u62ec\u53f7\u914d\u5bf9\u7684\u62ec\u53f7\u3002\n\n\u533a\u95f4\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a`(......)...(`\n\n\u90a3\u4e48\u6211\u4eec\u5206\u522b\u5904\u7406\u51fa\u533a\u95f4 $[l,\\texttt{right[l]}]$ \u7684\u65b9\u6848\u6570\u548c\u533a\u95f4 $[\\texttt{right[l]}+1,r]$ \u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u76f8\u4e58\u5373\u53ef\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c$\\texttt{right[l]}$ \u4e0e $\\texttt{right[l]}+1$ \u5904\u7684\u62ec\u53f7\u989c\u8272\u4e0d\u80fd\u76f8\u540c\u3002\u8fd9\u79cd\u60c5\u51b5\u9700\u8981\u7279\u5224\u3002\n\n```cpp\nfor(int i=0;i<=2;i++){\n    for(int j=0;j<=2;j++){\n        for(int p=0;p<=2;p++){\n            for(int q=0;q<=2;q++){\n                if((j==1&&p==1)||(j==2&&p==2))continue;//right[l] \u4e0e right[l]+1 \u5904\u7684\u62ec\u53f7\u989c\u8272\u76f8\u540c\n                dp[l][r][i][q]+=(dp[l][right[l]][i][j]*dp[right[l]+1][r][p][q]%mod);\n                dp[l][r][i][q]%=mod;\n            }\n        }\n    }\n}\n```\n\n\u90a3\u4e48\uff0c\u8f6c\u79fb\u65b9\u5f0f\u5c31\u5f04\u597d\u5566\uff01\n\n\u6709\u4e00\u4e2a\u9700\u8981\u6ce8\u610f\u7684\u70b9\u5c31\u662f\uff1a\u8f6c\u79fb\u987a\u5e8f\u6700\u597d\u662f\u4ee5\u8bb0\u5fc6\u5316\u641c\u7d22\u7684\u987a\u5e8f\u6765\uff0c\u4e0d\u7136\u7684\u8bdd\u4f1a\u5f88\u9ebb\u70e6\u3002\n\n------------\n\n\u6700\u540e\uff0c\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cstdlib>\n#include<stack>\n\n#define MAXN 800\n#define int long long\n\nusing namespace std;\n\nchar s[MAXN];\nint dp[MAXN][MAXN][5][5],right[MAXN];\nstack<int>stk;\n\nconst int mod=1000000007;\n\nvoid DFS(int l,int r){\n    if(r==l+1){\n        dp[l][r][0][1]=dp[l][r][0][2]=dp[l][r][1][0]=dp[l][r][2][0]=1;\n    }\n    else if(right[l]==r){//l,r \u914d\u5bf9\n        DFS(l+1,r-1);//\u5148\u5904\u7406\u51fa\u6765 [l+1,r-1] \u7684\u65b9\u6848\u6570\n        for(int i=0;i<=2;i++){\n            for(int j=0;j<=2;j++){\n                if(j!=1)dp[l][r][0][1]+=dp[l+1][r-1][i][j],dp[l][r][0][1]%=mod;\n                if(j!=2)dp[l][r][0][2]+=dp[l+1][r-1][i][j],dp[l][r][0][2]%=mod;\n                if(i!=1)dp[l][r][1][0]+=dp[l+1][r-1][i][j],dp[l][r][1][0]%=mod;\n                if(i!=2)dp[l][r][2][0]+=dp[l+1][r-1][i][j],dp[l][r][2][0]%=mod;\n            }\n        }\n        //\u521a\u624d\u8bf4\u8fc7\u7684\u8f6c\u79fb\u65b9\u7a0b\n    }\n    else{\n        DFS(l,right[l]);\n        DFS(right[l]+1,r);\n        //\u5148\u5904\u7406\u533a\u95f4 [l,right[l]] \u548c\u533a\u95f4 [right[l]+1,r]\u3002\n        for(int i=0;i<=2;i++){\n            for(int j=0;j<=2;j++){\n                for(int p=0;p<=2;p++){\n                    for(int q=0;q<=2;q++){\n                        if((j==1&&p==1)||(j==2&&p==2))continue;\n                        dp[l][r][i][q]+=(dp[l][right[l]][i][j]*dp[right[l]+1][r][p][q]%mod);\n                        dp[l][r][i][q]%=mod;\n                    }\n                }\n            }\n        }\n    }\n}\n\nsigned main(void){\n\n    scanf(\"%s\",s+1);\n    int n=strlen(s+1);\n    for(int i=1;i<=n;i++){\n        if(s[i]=='(')stk.push(i);\n        else{\n            right[stk.top()]=i;\n            right[i]=stk.top();\n            stk.pop();\n        }\n    }\n    //\u5904\u7406\u51fa\u914d\u5bf9\u7684\u62ec\u53f7\n\n    DFS(1,n);\n\n    int ans=0;\n    for(int i=0;i<=2;i++){\n        for(int j=0;j<=2;j++){\n            ans+=dp[1][n][i][j];\n            ans%=mod;\n        }\n    }\n\n    printf(\"%lld\\n\",ans);\n\n    return 0;\n}\n```",
        "postTime": 1601106555,
        "uid": 307453,
        "name": "\u4e91\u6d45\u77e5\u5904",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF149D \u3010Coloring Brackets\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u672c\u8d28\u4e0a\u4e0d\u96be\uff0c\u4f46\u662f\u5f88\u9ebb\u70e6\uff0c\u5f88\u6076\u5fc3\u3002\n\n\u6211\u770b\u4e86\u4e00\u4e0b\uff0c\u5e02\u9762\u4e0a\u7684\u9898\u89e3\u57fa\u672c\u90fd\u662f\u7528$dfs$\u7684\u65b9\u5f0f\u6765\u6f14\u7ece\u8fd9\u4e2a$dp$,\u800c\u4e14\u6709\u4e00\u4e9b\u96f7\u540c\u4e8e\u5355\u8c03\uff0c\u4e0b\u9762\uff0c\u6211\u7528\u533a\u95f4$dp$\u7684\u89d2\u5ea6\u6765\u6f14\u7ece\u8fd9\u9053\u9898\u3002\n\n\u6211\u4eec\u59d1\u4e14\u5148\u5b9a\u4e49$dp_{i,j,0}$\u4e3a\u5bf9\u533a\u95f4$[i,j]$\u67d3\u8272\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u8f6c\u79fb\uff0c\u7136\u540e\u6839\u636e\u8f6c\u79fb\u518d\u5b8c\u5584\u6211\u4eec\u7684\u5b9a\u4e49\u3002\n\n\u8003\u8651\u4e24\u79cd\u60c5\u51b5\n\n1\u3001\u5bf9\u4e8e\u4e00\u4e2a\u62ec\u53f7\u4e32\uff0c\u4ed6\u7531\u4e00\u5bf9\u5355\u8c03\u7684\u62ec\u53f7\u91cc\u9762\u52a0\u4e0a\u4e00\u4e9b\u4e32\u7ec4\u6210\n\n2\u3001\u5bf9\u4e8e\u4e00\u4e2a\u62ec\u53f7\u4e32\uff0c\u4ed6\u7531\u6570\u5bf9\u5355\u8c03\u7684\u62ec\u53f7\u91cc\u9762\u52a0\u4e0a\u4e00\u4e9b\u4e32\u7ec4\u6210\n\n\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff1a\n\n\u5728\u5916\u9762\u7684\u4e00\u5bf9\u62ec\u53f7\u4e32\u53ef\u4ee5\u6709\u56db\u79cd\u65b9\u5f0f\u8fdb\u884c\u67d3\u8272\uff0c\u4f46\u662f\u5374\u5b58\u5728\u51b2\u7a81\u3002\u56e0\u4e3a\u76f8\u90bb\u7684\u4e24\u4e2a\u62ec\u53f7\u989c\u8272\u4e0d\u80fd\u76f8\u540c\uff0c\u90a3\u4e48\u6839\u636e\u878d\u65a5\u7684\u601d\u60f3\uff0c\u6211\u4eec\u60f3\u8981\u7b97\u51fa\u51b2\u7a81\u7684\u60c5\u51b5\u3002\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u5916\u5c42\u67d3\u8272\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u628a\u4e0e\u4ed6\u76f8\u90bb\u7684\u4e00\u4e2a\u62ec\u53f7\u67d3\u6210\u56fa\u5b9a\u7684\u989c\u8272\uff0c\u4ece\u800c\u8fbe\u5230\u51b2\u7a81\u7684\u76ee\u7684\u3002\n\n\u7531\u6b64\uff0c\u4e3a\u4e86\u907f\u514d\u8ba1\u7b97\u9006\u5143\u6211\u4eec\u5b9a\u4e49$dp_{i,j,1}$\u4e3a\u533a\u95f4$[i,j]$\u4e2d\u4e32\u9996\u67d3\u4e00\u79cd\u56fa\u5b9a\u989c\u8272\u7684\u65b9\u6848\u603b\u6570\u3002\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b:\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ $ $dp_{i,j,0}$ = $4 * (dp_{i+1,j-1,0} - dp_{i+1,j-1,1})$\n\n\u4f46\u662f$dp_{i,j,1}$\u600e\u4e48\u8f6c\u79fb\u5462\uff1f\u6211\u4eec\u7ed9\u4e32\u9996\u56fa\u5b9a\u4e00\u79cd\u989c\u8272\uff0c\u90a3\u4e48\u5305\u542b\u5728\u91cc\u9762\u7684\u4e32\u5f53\u4e14\u4ec5\u5f53\u5728\u91cc\u9762\u7684\u4e32\u7684\u4e32\u9996\u4e0e\u4ed6\u989c\u8272\u4e00\u81f4\uff0c\u51cf\u53bb\u5373\u53ef\u3002\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ $ $dp_{i,j,1}$ = $dp_{i+1,j-1,0} - dp_{i+1,j-1,1}$\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff1a\n\n\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u5148\u627e\u5230\u7b2c\u4e00\u4e2a\u5355\u8c03\u62ec\u53f7\u7684\u7ed3\u5c3e\uff0c\u7136\u540e\u5c06\u4e24\u6bb5\u76f8\u4e58\uff0c\u518d\u51cf\u53bb\u51b2\u7a81\u90e8\u5206\uff0c\u5373\u4e24\u6bb5\u76f8\u63a5\u7684\u5730\u65b9\u4e00\u6837\u7684\u65f6\u5019\uff0c\u5373\u4e3a\u4e24\u6bb5\u9996\u989c\u8272\u786e\u5b9a\u4e14\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u6709\u4e24\u79cd\u989c\u8272\uff0c\u6240\u4ee5$*2$\n\n\u4ee4$f$\u4e3a\u4ea4\u754c\u5904\uff0c\u5219\u6709$dp$\u5f0f\u4e3a\uff1a\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ $ $dp_{i,j,0}$ = $dp_{i,f,0} * dp_{f+1,j,0} - dp_{i,f,1} * dp_{f+1,j,1} * 2$\n\n\n\u5bf9\u4e8e$dp_{i,j,1}$\u5f88\u7b80\u5355\uff0c\u9996\u4f4d\u786e\u5b9a\u5c31\u4e0e\u540e\u9762\u6ca1\u4ec0\u4e48\u5173\u7cfb\u4e86\uff0c\u76f4\u63a5\u4e58\u4e0a\u5373\u53ef\u3002\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ $ $dp_{i,j,1}$ = $dp_{i,f,1} * dp_{f,j,0}$\n\n\u4ee5\u4e0a\u662f\u6211\u6839\u636e\u6392\u5217\u7ec4\u5408\u7684\u601d\u60f3\u63a8\u51fa\u7684$dp$\u5f0f,\u5e0c\u671b\u80fd\u5bf9\u5927\u5bb6\u7684\u5bf9$dp$\u7684\u63a8\u5bfc\u4e0e\u7406\u89e3\u6709\u5e2e\u52a9\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\nint mod = 1000000007;\nchar s[705];\nint dp[705][705][2] , n;\nint pd(int x , int y) { // \u7528\u6808\u7684\u65b9\u5f0f\u5224\u65ad\u3002\n\tint f = 1 , top = 0;\n\tfor (int i = x; i <= y; ++i) {\n\t\tif(s[i] == '(') top ++;\n\t\telse top --;\n\t\tif(top < 0) return 0;\n\t\tif(!top && i != y && f == 1) f = i;\n\t}\n\tif(top != 0) return 0;\n\treturn f;\n}\nint main() {\n\tscanf(\"%s\" , s + 1);\n\tn = strlen(s + 1);\n\tfor (int len = 2; len <= n; len += 2) {\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\tint j = i + len - 1;\n\t\t\tif(len == 2) {\n\t\t\t\tif(s[i] == '(' && s[j] == ')') {\n\t\t\t\t\tdp[i][j][0] = 4;\n\t\t\t\t\tdp[i][j][1] = 1;//\u7279\u5224\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tint f = pd(i , j);//\u8fd9\u4e2a\u5730\u65b9\u7684\u5224\u65ad\u53ef\u4ee5\u5728\u4e4b\u524d\u9884\u5904\u7406\u51fa\u6765\uff0c\u4f46\u6211\u770b\u89c1\u4e0d\u9884\u5904\u7406\u4e5f\u80fd\u8fc7\u5c31\u4e0d\u7ba1\u4e86\u3002\n\t\t\tif(!f) continue;\n\t\t\telse if(f == 1) {\n\t\t\t\tdp[i][j][0] = (4ll * (long long)(dp[i + 1][j - 1][0] - dp[i + 1][j - 1][1]) % mod + mod) % mod;\n\t\t\t\tdp[i][j][1] = ((dp[i + 1][j - 1][0] - dp[i + 1][j - 1][1]) % mod + mod) % mod;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdp[i][j][0] = (long long)dp[i][f][0] * (long long)dp[f + 1][j][0] % mod - (long long) dp[i][f][1] * (long long)dp[f + 1][j][1] * 2ll % mod;\n\t\t\t\tdp[i][j][0] = (dp[i][j][0] % mod + mod) % mod;\n\t\t\t\tdp[i][j][1] = (long long)dp[i][f][1] * (long long)dp[f + 1][j][0] % mod; \n\t\t\t}//dp\u8f6c\u79fb\n\t\t}\n\t}\n\tprintf(\"%d\" , dp[1][n][0]);\n\treturn 0;\n}\n\n```",
        "postTime": 1581929909,
        "uid": 171554,
        "name": "Reanap",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF149D \u3010Coloring Brackets\u3011"
    },
    {
        "content": "$\\ \\ \\ \\ \\ \\ \\ $[luogu](https://www.luogu.com.cn/problem/CF149D)\n\n$\\ \\ \\ \\ \\ \\ \\ $\u5176\u5b9e\u4e5f\u662f\u88f8\u9898\uff0c\u53ea\u4e0d\u8fc7\u52a0\u4e0a\u4e86\u4e00\u4e9b\u9884\u5904\u7406\u548c\u989c\u8272\u9650\u5236\u3002\u6211\u4eec\u9996\u5148\u8003\u8651\u8ba1\u7b97\u62ec\u53f7\u5bf9\u5e94\uff0c\u5f88\u5bb9\u6613\u6253\u51fa\u8fd9\u6837\u7684\u4ee3\u7801\u3002\n\n```cpp\n\tfor(long long i=1;i<=n;++i)\n\t{\n\t\tif(bracket[i]=='(')\tS.push(i);\n\t\telse\tdy[S.top()]=i,S.pop();\n\t}\n```\n\n$\\ \\ \\ \\ \\ \\ \\ $\u52a0\u4e0a\u989c\u8272\u9650\u5236\uff0c\u5b9a\u4e49 $dp_{i,j,0 \\ or \\ 1 or \\ 2,0 \\ or \\ 1 or \\ 2}$ \u4e3a\u533a\u95f4 $[i,j]$\uff0c$i$ \u4e0d\u67d3/\u67d3\u6210\u7ea2\u8272/\u67d3\u6210\u84dd\u8272\uff0c$j$ \u540c\u7406\u7684\u65b9\u6848\u6570\uff0c\u9012\u5f52\u957f\u5e8f\u5217\uff0cdp \u5408\u5e76\u5c0f\u5e8f\u5217\uff1a\n\n- \u5982\u679c $l+1=r$ \uff0c\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\uff0c\u5305\u542b\u4e0b\u9762\u7684\u64cd\u4f5c\u8bdd\u8fd9\u4e00\u5b9a\u662f\u4e00\u5bf9\u62ec\u53f7\uff1b\n\n- \u5982\u679c $dy_l=r$\uff0c\u9012\u5f52\u5904\u7406 $l+1,r-1$\uff0c\u5408\u5e76\u7ec4\u6210 dp\uff1b\n\n- \u5176\u4ed6\u60c5\u51b5\u662f\u6700\u9ebb\u70e6\u7684\uff0c\u8fd9\u662f\u4e24\u4e2a\u6216\u4ee5\u4e0a\u7684\u62ec\u53f7\u5e8f\u5217\u7ec4\u6210\u7684\uff0c\u5206\u522b\u5212\u5206\uff0c\u4f9d\u6b21 dp\uff0c\u5408\u5e76\u5373\u53ef\u3002\n\n$\\ \\ \\ \\ \\ \\ \\ $\u8be6\u89c1\u4ee3\u7801\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<queue>\n#include<iostream>\n#include<cstring>\n#include<stack>\n#define MOD 1000000007ll\nusing namespace std;\nstack<long long> S;\nlong long dp[705][705][3][3],dy[705],n;\nchar bracket[705];\n/*\ndp[l][r][0/1/2][0/1/2];\n[l,r] l=0/1/2 r=0/1/2\n\u8fd8\u662f\u5199\u8bb0\u5fc6\u5316\u597d\u7406\u89e3\u3002xd\n*/\nvoid dfs(long long l,long long r)\n{\n\tif(l+1==r)\n\t{\n\t\tdp[l][r][0][1]=dp[l][r][0][2]=dp[l][r][1][0]=dp[l][r][2][0]=1;\n\t\treturn ;\n\t}\n\tif(dy[l]==r)\n\t{\n\t\tdfs(l+1,r-1);\n\t\tfor(long long i=0;i<=2;++i)\n\t\t{\n\t\t\tfor(long long j=0;j<=2;++j)\n\t\t\t{\n\t\t\t\tif(i!=1)\tdp[l][r][1][0]+=dp[l+1][r-1][i][j],dp[l][r][1][0]%=MOD;\n\t\t\t\tif(i!=2)\tdp[l][r][2][0]+=dp[l+1][r-1][i][j],dp[l][r][2][0]%=MOD;\n\t\t\t\tif(j!=1)\tdp[l][r][0][1]+=dp[l+1][r-1][i][j],dp[l][r][0][1]%=MOD;\n\t\t\t\tif(j!=2)\tdp[l][r][0][2]+=dp[l+1][r-1][i][j],dp[l][r][0][2]%=MOD;\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tdfs(l,dy[l]);\n\t\tdfs(dy[l]+1,r);\n\t\tfor(long long i=0;i<=2;++i)\tfor(long long j=0;j<=2;++j)\tfor(long long k=0;k<=2;++k)\tfor(long long m=0;m<=2;++m)\tif(!(j && j==k))\tdp[l][r][i][m]+=dp[l][dy[l]][i][j]*dp[dy[l]+1][r][k][m]%MOD,dp[l][r][i][m]%=MOD;\n\t}\n}\nint main(){\n\t// freopen(\"coloring.in\",\"r\",stdin);\n\t// freopen(\"coloring.out\",\"w\",stdout);\n\tscanf(\"%s\",bracket+1);\n\tn=strlen(bracket+1);\n\tfor(long long i=1;i<=n;++i)\n\t{\n\t\tif(bracket[i]=='(')\tS.push(i);\n\t\telse\tdy[S.top()]=i,S.pop();\n\t}\n\tdfs(1,n);\n\tlong long ans=0;\n\tfor(long long i=0;i<=2;++i)\tfor(long long j=0;j<=2;++j)\tans+=dp[1][n][i][j],ans%=MOD;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1579936599,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF149D \u3010Coloring Brackets\u3011"
    },
    {
        "content": "\u5927\u5bb6\u597d\uff0c\u6211\u975e\u5e38\u559c\u6b22\u5206\u7c7b\u8ba8\u8bba\u52a0\u66b4\u529b\uff0c\u4e8e\u662f\u6211\u5c31\u7528\u4e00\u79cd\u66b4\u529b\u7684\u5206\u7c7b\u8ba8\u8bba\u8fc7\u4e86\u8fd9\u9053\u9898\u3002\n\n\u9898\u76ee\u4e2d\u6709\u4e00\u5bf9\u5339\u914d\u62ec\u53f7\u53ea\u80fd\u6709\u4e00\u4e2a\u62ec\u53f7\u67d3\u8272\u7684\u9650\u5236\uff0c\u8003\u8651\u901a\u8fc7\u4e00\u5bf9\u62ec\u53f7\u4e3a\u9636\u6bb5\u8fdb\u884c\u8f6c\u79fb\u3002\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4 $(l,r)$ , \u8bbe\u5b83\u5de6\u8fb9 $(l-1)$ \u989c\u8272\u4e3acl\uff0c\u53f3\u8fb9 $(r-1)$ \u989c\u8272\u4e3acr\uff0c\u8bbe\u8ba1dp\u72b6\u6001 $ f(l,r,cl,cr) $ \u4e3a\u8be5\u533a\u95f4\u65b9\u6848\u5728cl\uff0ccr\u9650\u5236\u4e0b\u7684\u65b9\u6848\u6570 \u3002\u663e\u7136\u4e00\u4e2a\u62ec\u53f7\u5339\u914d\u7684\u533a\u95f4 $l$ \u4e3a\u5de6\u62ec\u53f7\uff0c\u8bbe\u4e0e $l$ \u5339\u914d\u7684\u53f3\u62ec\u53f7\u4f4d\u7f6e\u4e3a $p$\u3002\n\n1. $ p=l+1 $ \u8ba8\u8bba $(l,l+1)$ \u8fd9\u5bf9\u62ec\u53f7\u7684\u67d3\u8272\u60c5\u51b5\uff0c\u628a\u8fb9\u754c\u989c\u8272\u7684\u66f4\u6539\u4f20\u9012\u7ed9$(l+2,r)$ \u5373\u53ef\u3002\n\n2. $ p=r $ \u8ba8\u8bba $(l,r) $ \u8fd9\u5bf9\u62ec\u53f7\u7684\u67d3\u8272\u60c5\u51b5\uff0c\u628a\u8fb9\u754c\u989c\u8272\u7684\u66f4\u6539\u4f20\u9012\u7ed9$(l+1,r-1)$ \u5373\u53ef\u3002\n\n3. \u628a\u533a\u95f4\u5206\u4e3a $(l,p) (p+1,r)$ \u4e24\u90e8\u5206 \u8ba8\u8bba $(l,r) $ \u8fd9\u5bf9\u62ec\u53f7\u7684\u67d3\u8272\u60c5\u51b5 ,\u5206\u522b\u8ba1\u7b97\u533a\u95f4 $(l+1,p-1) (p+1,r)$\u7684\u7b54\u6848\u518d\u76f8\u4e58\u3002\n\n\u4f7f\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\uff0c\u590d\u6742\u5ea6\u6b63\u786e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int N=705,mod=1e9+7;\nint n;\nint f[N][N][3][3],pos[N];\nchar ch[N];\nint dp(int l,int r,int cl,int cr)\n{\n\tif(l>r)return cl!=cr||(cl==0&&cr==0);\n\tif(f[l][r][cl][cr]!=0)return f[l][r][cl][cr];\n\tint res=0;\n\tif(pos[l]==-1)\n\t{\n\t\tint sum=1;\n\t\tfor(int i=l+1;i<=n;i++)\n\t\t\tif(ch[i]=='(')sum++;\n\t\t\telse \n\t\t\t{\n\t\t\t\tsum--;\n\t\t\t\tif(!sum){pos[l]=i;break;}\n\t\t\t}\n\t}\n\tif(pos[l]==l+1)\n\t{\n\t\tif(cl!=1)res=(res+dp(l+2,r,0,cr))%mod;\n\t\tif(cl!=2)res=(res+dp(l+2,r,0,cr))%mod;\n\t\tres=(res+dp(l+2,r,1,cr))%mod;\n\t\tres=(res+dp(l+2,r,2,cr))%mod;\n\t\treturn f[l][r][cl][cr]=res;\n\t}\n\tif(pos[l]==r)\n\t{\n\t\tif(cl!=1)res=(res+dp(l+1,r-1,1,0))%mod;\n\t\tif(cl!=2)res=(res+dp(l+1,r-1,2,0))%mod;\n\t\tif(cr!=1)res=(res+dp(l+1,r-1,0,1))%mod;\n\t\tif(cr!=2)res=(res+dp(l+1,r-1,0,2))%mod;\n\t\treturn f[l][r][cl][cr]=res;\n\t}\n\tif(cl!=1)res=(res+1ll*dp(l+1,pos[l]-1,1,0)*dp(pos[l]+1,r,0,cr)%mod)%mod;\n\tif(cl!=2)res=(res+1ll*dp(l+1,pos[l]-1,2,0)*dp(pos[l]+1,r,0,cr)%mod)%mod;\n\tres=(res+1ll*dp(l+1,pos[l]-1,0,1)*dp(pos[l]+1,r,1,cr)%mod)%mod;\n\tres=(res+1ll*dp(l+1,pos[l]-1,0,2)*dp(pos[l]+1,r,2,cr)%mod)%mod;\n\treturn f[l][r][cl][cr]=res;\n}\nint main()\n{\n\tscanf(\"%s\",ch+1);\n\tn=strlen(ch+1);\n\tmemset(pos,-1,sizeof(pos));\n\tprintf(\"%d\",dp(1,n,0,0));\n\treturn 0;\n}\n```\n",
        "postTime": 1594355315,
        "uid": 68865,
        "name": "slgdsxw",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF149D Coloring Brackets"
    },
    {
        "content": "\u8bbe\u8ba1\u666e\u901a\u72b6\u6001 $f(l,r)$ \u4ee3\u8868\u533a\u95f4 l \u5230 r \u7684\u62ec\u53f7\u5e8f\u5217\u7684\u60c5\u51b5\u6570\u3002\u4f46\u662f\u8fd9\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u4e00\u4e2a\u70b9\u7684\u67d3\u8272\u4f1a\u5f71\u54cd\u81ea\u5df1\u6240\u5339\u914d\u7684\u53f3\u62ec\u53f7\u7684\u67d3\u8272\u548c\u81ea\u5df1\u76f8\u90bb\u62ec\u53f7\u7684\u67d3\u8272\uff0c\u6240\u4ee5\u8fd9\u4e2a\u81ea\u7136\u72b6\u6001\u663e\u7136\u6709\u95ee\u9898\u3002\n\n\u6211\u4eec\u628a\u72b6\u6001\u5177\u4f53\u5316\uff0c$f(l,r,0/1/2,0/1/2)$ \u4ee3\u8868 l \u67d3\u9ed1/\u84dd/\u7ea2\uff0cr\u67d3\u9ed1/\u84dd/\u7ea2\u7684\u60c5\u51b5\u6570\u3002\n\n\u5206\u4e09\u79cd\u8ba8\u8bba\u3002\u7b2c\u4e00\u79cd\u5c31\u662f\u8fb9\u754c\u60c5\u51b5 \uff08$r-l=1$\uff09\uff0c\u6bd4\u8f83\u7b80\u5355\u3002\n\n\u7b2c\u4e8c\u79cd\u662f $l,r$ \u662f\u5339\u914d\u7684\u62ec\u53f7\uff0c\u90a3\u4e48\u6211\u4eec\u9012\u5f52\u5904\u7406\u5373\u53ef\uff0c\u5373\n\n$$\nf(l,r,0,0)=f(l,r,1/2,1/2)=0\n$$\n$$\nf(l,r,0,1/2)=f(l+1,r-1,1,0)+f(l+1,r-1,2,0)+f(l+1,r-1,0,2/1)\n$$\n$f(l,r,1/2,0)$ \u4e5f\u4e00\u6837\u3002\n\n\u7b2c\u4e09\u79cd\u662f $l,r$ \u4e0d\u5339\u914d\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5212\u5206\u6210\u4e00\u7ec4\u5339\u914d\u7684\u62ec\u53f7\u5e8f\u5217\u548c\u5269\u4e0b\u7684\u90e8\u5206\u3002\u6211\u4eec\u5047\u8bbe\u628a\u5b83\u5206\u5272\u6210 $(l,l$\u5bf9\u5e94\u7684\u53f3\u62ec\u53f7$)$ \u548c\u5269\u4e0b\u7684\u90e8\u5206\u3002\u5408\u5e76\u7684\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u5173\u7cfb\u4e24\u4e2a\u76f8\u90bb\u7684\u662f\u5426\u989c\u8272\u4e00\u6837\u5373\u53ef\u3002\u7531\u4e8e\u6211\u61d2\u5f97\u5c55\u5f00\u6240\u4ee5\u6211\u76f4\u63a5\u4e00\u4e0b\u5b50\u628a $f(l,r,*,*)$ \u5168\u90e8\u7b97\u51fa\u6765\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define rev(a) (cr==1?2:1)\n#define int long long\n#define rep2(i) for(int i=0;i<=2;i++)\n\nusing namespace std;\nconst int N=709,mod=1000000007;\n\nint n,match[N],f[N][N][3][3];\nint dfs(int l,int r,int cl,int cr) {\n\tif(f[l][r][cl][cr]!=-1) return f[l][r][cl][cr]; \n\telse if(r-l==1) return f[l][r][cl][cr]=(cl>0)!=(cr>0);\n\t\n\tf[l][r][cl][cr]=0;\n\tif(match[l]==r) {\n\t\tif(!cl&&!cr||cl&&cr) return f[l][r][cl][cr]=0;\n\t\telse if(cl==0)\n\t\t\treturn f[l][r][cl][cr]=(dfs(l+1,r-1,1,0)+dfs(l+1,r-1,2,0)\n\t\t\t\t\t\t\t+dfs(l+1,r-1,0,rev(cr))\n\t\t\t\t\t\t\t+dfs(l+1,r-1,1,rev(cr))\n\t\t\t\t\t\t\t+dfs(l+1,r-1,2,rev(cr))\n\t\t\t\t\t\t\t+dfs(l+1,r-1,0,0))%mod;\n\t\telse if(cr==0)\n\t\t\treturn f[l][r][cl][cr]=(dfs(l+1,r-1,0,1)+dfs(l+1,r-1,0,2)\n\t\t\t\t\t\t\t+dfs(l+1,r-1,rev(cl),0)\n\t\t\t\t\t\t\t+dfs(l+1,r-1,rev(cl),1)\n\t\t\t\t\t\t\t+dfs(l+1,r-1,rev(cl),2)\n\t\t\t\t\t\t\t+dfs(l+1,r-1,0,0))%mod;\n\t} else {\n\t\trep2(i) rep2(j) f[l][r][i][j]=0;\n\t\trep2(i) rep2(j) rep2(k) rep2(p)\n\t\t\tif(j&&k&&(j==k)) continue;\n\t\t\telse (f[l][r][i][p]+=dfs(l,match[l],i,j)*dfs(match[l]+1,r,k,p))%=mod;\n\t\treturn f[l][r][cl][cr];\n\t}\n}\n\nchar s[N];\nsigned main() {\n\tmemset(f,-1,sizeof(f));\n\tscanf(\"%s\",s+1); int n=strlen(s+1);\n\tstack<int>st;\n\tfor(int i=1;i<=n;i++) {\n\t\tif(s[i]=='(') st.push(i);\n\t\telse match[st.top()]=i,st.pop();\n\t}\n\tint ans=0;\n\trep2(i) rep2(j) (ans+=dfs(1,n,i,j))%=mod;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n\nCF\u8bc4\u6d4b\u8bb0\u5f55\uff1ahttps://codeforc.es/problemset/submission/149/85169174  \n\u6d1b\u8c37\u8bc4\u6d4b\u8bb0\u5f55\uff1ahttps://www.luogu.com.cn/record/34682304\n",
        "postTime": 1593219449,
        "uid": 180652,
        "name": "_lgswdn",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF149D \u3010Coloring Brackets\u3011"
    },
    {
        "content": "### \u8bb0\u5fc6\u5316\u641c\u7d22+\u533a\u95f4DP\n\n#### \u9996\u5148\u660e\u786e\u4e00\u4e0b\u4e8b\u5b9e:\n1.\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217,**\u5176\u5fc5\u4ee5'('\u5f00\u59cb,\u4ee5')'\u7ed3\u675f**\n\n2.\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217$[l,r]$,\u5b58\u5728\u4ee5\u4e0b\u4e09\u79cd\u62c6\u5206\u60c5\u51b5(\u8fd9\u91cc\u6211\u4eec\u89c4\u5b9a\u4ee5\u6210\u5bf9\u51fa\u73b0\u7684\u62ec\u53f7\u4f5c\u4e3a\u4e92\u76f8\u5339\u914d\u7684\u62ec\u53f7\u5bf9,\u4ee5\u5927\u5199\u5b57\u6bcd\u8868\u793a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217):\n\n(1).\u82e5$l+1=r$,\u5219\u8be5\u62ec\u53f7\u5e8f\u5217\u4e00\u5b9a\u4e3a$$()$$\n(2).\u82e5$l$\u4f4d\u7f6e\u7684\u62ec\u53f7\u4e0e$r$\u4f4d\u7f6e\u7684\u62ec\u53f7\u6070\u597d\u6210\u5bf9\u5219\u8be5\u5e8f\u5217\u5f62\u5982$$(\\underbrace{\\ldots}_{\\rm A})$$\n(\u82e5$A$\u4e0d\u4e3a\u5408\u6cd5\u5e8f\u5217,\u5219\u5176\u4e2d\u672a\u5339\u914d\u7684\u5de6\u62ec\u53f7\u6216\u53f3\u62ec\u53f7\u4f1a\u4e0e$r$\u4f4d\u7f6e\u6216$l$\u4f4d\u7f6e\u7684\u62ec\u53f7\u53d1\u751f\u914d\u5bf9\u4e0d\u6ee1\u8db3\u5047\u8bbe), \u53d1\u73b0\u53ef\u4ee5\u5c06\u8be5\u5e8f\u5217\u7f29\u5c0f\u4e3a\u66f4\u5c0f\u7684\u5408\u6cd5\u5e8f\u5217A\n\n(3).\u82e5$l$\u4f4d\u7f6e\u7684\u5de6\u62ec\u53f7\u4e0e$r$\u4f4d\u7f6e\u7684\u62ec\u53f7\u5206\u5c5e\u4e8e\u4e24\u5bf9\u4e0d\u540c\u7684\u5339\u914d\u62ec\u53f7,\u5219\u8be5\u5e8f\u5217\u5f62\u5982$$\\underbrace{(\\ldots)}_{\\rm A}\\underbrace{\\ldots(\\ldots)}_{\\rm B}$$\n\u53d1\u73b0\u53ef\u4ee5\u5c06\u8be5\u5e8f\u5217\u62c6\u6210\u505a\u5408\u6cd5\u5e8f\u5217$A$\u4e0e\u53f3\u5408\u6cd5\u5e8f\u5217$B$(\u4e24\u62ec\u53f7\u4e2d\u95f4\u90e8\u5206\u53ef\u4ee5\u4e3a\u7a7a)\n\n\u81f3\u6b64\u6211\u4eec\u53d1\u73b0,\u6bcf\u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\u90fd\u53ef\u4ee5\u62c6\u5206\u4e3a\u66f4\u5c0f\u7684\u5408\u6cd5\u5e8f\u5217,\u6700\u7ec8\u62c6\u5206\u51fa\u6700\u5c0f\u7684\u5408\u6cd5\u5e8f\u5217\u5355\u5143$\"()\"$,\u800c\u8f83\u5927\u7684\u5408\u6cd5\u5e8f\u5217\u7684\u65b9\u6848\u6570\u5747\u9700\u8981\u7531\u8f83\u5c0f\u7684\u5408\u6cd5\u5e8f\u5217\u63a8\u51fa,\u81f3\u6b64\u8fd9\u9898\u7684\u65b9\u6cd5\u5c31\u975e\u5e38\u660e\u786e\u4e86:\u7528\u9012\u5f52\u62c6\u5206\u8f83\u5927\u7684\u5408\u6cd5\u5e8f\u5217,\u7528\u533a\u95f4DP\u8f6c\u79fb\u8f83\u5c0f\u7684\u5e8f\u5217\u4e0e\u8f83\u5927\u5e8f\u5217\u7684\u65b9\u6848\u6570.\n\n#### \u63a5\u4e0b\u6765\u7684\u4efb\u52a1\u5c31\u662f\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e86\n\u6211\u4eec\u7528$dp[l][r][x][y]$\u8868\u793a$l$\u5230$r$\u7684\u5e8f\u5217\u5de6\u7aef\u67d3\u8272\u4e3a$x$,\u53f3\u7aef\u67d3\u8272\u4e3a$y$\u7684\u65b9\u6848\u6570(0\u8868\u793a\u4e0d\u67d3\u8272, 1\u8868\u793a\u67d3\u84dd\u8272, 2\u8868\u793a\u67d3\u7ea2\u8272)\n\n(1).\u5bf9\u4e8e\u60c5\u51b51(\u8fb9\u754c\u6761\u4ef6),\u663e\u7136\u6709\n```cpp\ndp[l][r][1][0]=dp[l][r][2][0]=dp[l][r][0][1]=dp[l][r][0][2]=1;\n```\n(2).\u5bf9\u4e8e\u60c5\u51b52,\u679a\u4e3e\u5185\u5c42\u5de6\u53f3\u7aef\u67d3\u8272\u5e76\u6839\u636e\u9898\u76ee\u8981\u6c42(\u76f8\u540c\u67d3\u8272\u4e0d\u80fd\u76f8\u90bb)\u8f6c\u79fb\u65b9\u6848\n```cpp\nfor (int i=0; i<=2; i++)\n\tfor (int j=0; j<=2; j++) {\n\t\tif (i!=1) dp[l][r][1][0]=(dp[l][r][1][0]+dp[l+1][r-1][i][j])%MOD;\n\t\tif (i!=2) dp[l][r][2][0]=(dp[l][r][2][0]+dp[l+1][r-1][i][j])%MOD;\n\t\tif (j!=1) dp[l][r][0][1]=(dp[l][r][0][1]+dp[l+1][r-1][i][j])%MOD;\n\t\tif (j!=2) dp[l][r][0][2]=(dp[l][r][0][2]+dp[l+1][r-1][i][j])%MOD;//\u9632\u6b62\u88ab\u67d3\u6210\u76f8\u540c\u989c\u8272\u7684\u4e24\u4e2a\u62ec\u53f7\u8fde\u5728\u4e00\u8d77\n\t}\n```\n(3).\u5bf9\u4e8e\u6700\u540e\u4e00\u79cd\u60c5\u51b5,\u5373\u5c06\u67d0\u5408\u6cd5\u5e8f\u5217\u62c6\u6210\u5de6\u53f3\u4e24\u4e2a\u5408\u6cd5\u5e8f\u5217\u7684\u60c5\u51b5.\u6211\u4eec\u7528$match[l]$\u8868\u793a\u4f4d\u7f6e$l$\u4e0a\u7684\u5de6\u62ec\u53f7\u5339\u914d\u7684\u53f3\u62ec\u53f7\u7684\u4f4d\u7f6e,\u5219\u8f6c\u79fb\u5982\u4e0b\n```cpp\nfor (int i=0; i<=2; i++) \n\tfor (int j=0; j<=2; j++)\n\t\tfor (int p=0; p<=2; p++)\n\t\t\tfor (int q=0; q<=2; q++) {\n\t\t\t\tif ((j==1 && p==1) || (j==2 && p==2)) continue;\n\t\t\t\tdp[l][r][i][q]=(dp[l][r][i][q]+dp[l][match[l]][i][j]*dp[match[l]+1][r][p][q])%MOD;\n\t\t\t}\n```",
        "postTime": 1534572440,
        "uid": 26242,
        "name": "AuSquare",
        "ccfLevel": 0,
        "title": "CF149D Coloring Brackets\u7ed3\u9898\u62a5\u544a"
    },
    {
        "content": "# \u601d\u8def\n## \u9898\u76ee\u7c7b\u578b\n\u8fd9\u662f\u4e00\u4e2a\u533a\u95f4\u52a8\u6001\u89c4\u5212\uff0c\u4f46\u662f\u4e0e\u4ee5\u5f80\u7684\u6709\u6240\u4e0d\u540c\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\n\n## \u9898\u76ee\u6c42\u89e3\n\u8bbe\u9898\u76ee\u91cc\u7684\u5b57\u7b26\u4e32\u4e3a $s$ \u4e00\u770b\u5230\u62ec\u53f7\u5339\u914d\uff0c\u6211\u4eec\u5c31\u8981\u60f3\u5230\u7528\u6808\u6765\u83b7\u53d6\u4e00\u4e0b\u5339\u914d\u7684\u4fe1\u606f \n\n\u6211\u4eec\u5728\u8fd9\u91cc\u5b9a\u4e49 $match[i]$ \u4e3a \u62ec\u53f7 $s[i]$ \u7684 \u5339\u914d\u4f4d\u7f6e\u4e0b\u6807\n\n(\u4f8b\u5982\" ( ( ) ( ) ) \" ,$match = [6,3,2,5,4,1]$)\n\n\u6b64\u65f6\u6211\u4eec\u8bbe\u7ea2\u8272\u4e3a $1$ ,\u84dd\u8272\u4e3a $2$ \uff0c\u65e0\u8272\u4e3a $0$ \uff0c\n\n\u4e8e\u662f\u6211\u4eec\u8bbe $dp[l][r][i][j]$ \u4e3a \u533a\u95f4 $[l - r]$ \u5de6\u7aef($l$)\u989c\u8272\u4e3a $i$ \uff0c\u53f3\u7aef($r$)\u989c\u8272\u4e3a $j$ \u7684\u65b9\u6848\u6570\n\n\u53d1\u73b0\u8fd9\u9053\u9898\u53ef\u80fd\u65e0\u6cd5\u50cf\u4ee5\u5f80\u7684\u533a\u95f4\u4e00\u6837\u8f6c\u79fb\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u628a\u9012\u63a8\u6539\u6210\u641c\u7d22\n\n\u5bb9\u6613\u53d1\u73b0\u521d\u59cb\u5316 $dp[i][i + 1][0][1] = dp[i][i + 1][1][0] = dp[i][i + 1][0][2] = dp[i][i + 1][2][0] = 1~~ (i + 1 = match[i])$\n\n\u6b64\u65f6\u5206\u7c7b\u8ba8\u8bba\uff0c\u5982\u679c\u533a\u95f4 $[l - r]$ \u6ee1\u8db3 $r = match[l]$ \u90a3\u4e48\u7531\u4e8e\u76f8\u90bb\u989c\u8272\u4e0d\u540c\u7684\u539f\u5219\uff0c\u53ef\u5f97\n\n\u5f53 $i~ != 1$ \u65f6, $dp[l][r][1][0] = dp[l][r][1][0] + dp[l][r][i][j]$\n\n\u2026\u2026\u2026\u2026\n(\u56db\u79cd\u60c5\u51b5\u5206\u522b\u4e3a\u5de6\u7aef\u7ea2\u8272 $i$ \u4e0d\u4e3a 1,\u5de6\u7aef\u84dd\u8272 $i$ \u4e0d\u4e3a 2,\u53f3\u7aef\u7ea2\u8272 $j$ \u4e0d\u4e3a 1,\u53f3\u7aef\u84dd\u8272 $j$ \u4e0d\u4e3a 2)\n\n\u5982\u679c\u533a\u95f4 $[l - r]$ \u4e0d\u6ee1\u8db3 $r = match[l]$ \u90a3\u4e48\u6839\u636e\u4e58\u6cd5\u539f\u7406\n\n$dp[l][r][i][j] = dp[l][r][i][j] + dp[l][match[l]][i][k] * dp[match[l] + 1][j][p]$ $k$ \u548c $j$ \u4e0d\u80fd\u540c\u65f6\u7b49\u4e8e $1$ \u6216 $2$ (\u76f8\u90bb\u7684\u989c\u8272\u4e0d\u80fd\u76f8\u540c,\u4f46\u662f\u53ef\u4ee5\u540c\u65f6\u4e0d\u67d3\u8272)\n\n\u4e4b\u540e\u6c42\u6700\u7ec8\u89e3\u7684\u65f6\u5019\u662f\u56db\u79cd\u60c5\u51b5\n\n# \u4ee3\u7801\n## \u6838\u5fc3\u4ee3\u7801\n```cpp\nvoid dfs (int l ,int r) {\n\tif (l + 1 == r) dp[l][r][0][1] = dp[l][r][1][0] = dp[l][r][0][2] = dp[l][r][2][0] = 1;//\u5f53\u4ed6\u4eec\u76f8\u90bb\u7684\u65f6\u5019\uff08\u5339\u914d\uff09\uff0c\u6b64\u65f6 4\u79cd\u60c5\u51b5\u90fd\u662f 1 \n\telse if (match[l] == r) {//\u5982\u679c l \u548c r \u5339\u914d \n\t\tdfs (l + 1 ,r - 1);//\u9012\u5f52\u5148\u53bb\u5bfb\u627e\u91cc\u9762\u7684 \n\t\tfor (int q = 0;q <= 2;++ q) {\n\t\t\tfor (int w = 0;w <= 2;++ w) {\n\t\t\t\tif (q != 1) dp[l][r][1][0] = (dp[l][r][1][0] + dp[l + 1][r - 1][q][w]) % mod;//\u8f6c\u79fb\u72b6\u6001 \n\t\t\t\tif (q != 2) dp[l][r][2][0] = (dp[l][r][2][0] + dp[l + 1][r - 1][q][w]) % mod;\n\t\t\t\tif (w != 1) dp[l][r][0][1] = (dp[l][r][0][1] + dp[l + 1][r - 1][q][w]) % mod;\n\t\t\t\tif (w != 2) dp[l][r][0][2] = (dp[l][r][0][2] + dp[l + 1][r - 1][q][w]) % mod;\n\t\t\t}\n\t\t}\n\t}\n\telse {//l \u548c r \u4e0d\u5339\u914d \n\t\tdfs (l ,match[l]) ;dfs (match[l] + 1, r);//\u9012\u5f52\u5206\u6bb5\uff0c\u4e00\u6bb5\u662f\u5339\u914d\u6bb5 l - match[l] \uff0c\u5269\u4e0b\u7684\u4e00\u6bb5 \n\t\tfor (int q = 0;q <= 2;++ q) {\n\t\t\tfor (int w = 0;w <= 2;++ w) {\n\t\t\t\tfor (int e = 0;e <= 2;++ e) {\n\t\t\t\t\tfor (int t = 0;t <= 2;++ t) {\n\t\t\t\t\t\tif ((w == 1 && e == 1) || (w == 2 && e == 2)) continue ;//\u76f8\u90bb\u7684\u989c\u8272\u4e0d\u80fd\u76f8\u540c\uff0c\u4f46\u662f\u53ef\u4ee5\u540c\u65f6\u4e0d\u67d3\u8272\n\t\t\t\t\t\tdp[l][r][q][t] = (dp[l][r][q][t] + dp[l][match[l]][q][w] * dp[match[l] + 1][r][e][t] % mod) % mod; \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n```\n## \u5168\u90e8\u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <stack>\nusing namespace std;\ntypedef long long ll;\nconst ll mod = 1e9 + 7;\nconst int MAXN = 1e2 * 7 + 10;\nstack <int > p;\nint n ,match[MAXN];\nll ans = 0 ,dp[MAXN][MAXN][3][3];\nchar s[MAXN];\nvoid dfs (int l ,int r) {\n\tif (l + 1 == r) dp[l][r][0][1] = dp[l][r][1][0] = dp[l][r][0][2] = dp[l][r][2][0] = 1;//\u5f53\u4ed6\u4eec\u76f8\u90bb\u7684\u65f6\u5019\uff08\u5339\u914d\uff09\uff0c\u6b64\u65f6 4\u79cd\u60c5\u51b5\u90fd\u662f 1 \n\telse if (match[l] == r) {//\u5982\u679c l \u548c r \u5339\u914d \n\t\tdfs (l + 1 ,r - 1);//\u9012\u5f52\u5148\u53bb\u5bfb\u627e\u91cc\u9762\u7684 \n\t\tfor (int q = 0;q <= 2;++ q) {\n\t\t\tfor (int w = 0;w <= 2;++ w) {\n\t\t\t\tif (q != 1) dp[l][r][1][0] = (dp[l][r][1][0] + dp[l + 1][r - 1][q][w]) % mod;//\u8f6c\u79fb\u72b6\u6001 \n\t\t\t\tif (q != 2) dp[l][r][2][0] = (dp[l][r][2][0] + dp[l + 1][r - 1][q][w]) % mod;\n\t\t\t\tif (w != 1) dp[l][r][0][1] = (dp[l][r][0][1] + dp[l + 1][r - 1][q][w]) % mod;\n\t\t\t\tif (w != 2) dp[l][r][0][2] = (dp[l][r][0][2] + dp[l + 1][r - 1][q][w]) % mod;\n\t\t\t}\n\t\t}\n\t}\n\telse {//l \u548c r \u4e0d\u5339\u914d \n\t\tdfs (l ,match[l]) ;dfs (match[l] + 1, r);//\u9012\u5f52\u5206\u6bb5\uff0c\u4e00\u6bb5\u662f\u5339\u914d\u6bb5 l - match[l] \uff0c\u5269\u4e0b\u7684\u4e00\u6bb5 \n\t\tfor (int q = 0;q <= 2;++ q) {\n\t\t\tfor (int w = 0;w <= 2;++ w) {\n\t\t\t\tfor (int e = 0;e <= 2;++ e) {\n\t\t\t\t\tfor (int t = 0;t <= 2;++ t) {\n\t\t\t\t\t\tif ((w == 1 && e == 1) || (w == 2 && e == 2)) continue ;//\u76f8\u90bb\u7684\u989c\u8272\u4e0d\u80fd\u76f8\u540c\uff0c\u4f46\u662f\u53ef\u4ee5\u540c\u65f6\u4e0d\u67d3\u8272\n\t\t\t\t\t\tdp[l][r][q][t] = (dp[l][r][q][t] + dp[l][match[l]][q][w] * dp[match[l] + 1][r][e][t] % mod) % mod; \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nint main () {\n\tscanf (\"%s\",s + 1);\n\tn = strlen(s + 1);\n\tfor (int q = 1;q <= n;++ q) {\n\t\tif (s[q] == '(') p.push(q);\n\t\telse {\n\t\t\tmatch[p.top()] = q ,match[q] = p.top();//\u5904\u7406\u5339\u914d\u7684\u62ec\u53f7 \n\t\t\tp.pop();\n\t\t}\n\t}\n//\tfor (int q = 1;q <= n;++ q) {\n//\t\tprintf (\"%d \",match[q]);\n//\t}printf (\"\\n\");\n\tdfs (1 ,n);\n\tfor (int q = 0;q <= 2;++ q) {\n\t\tfor (int w = 0;w <= 2;++ w) {\n\t\t\tans += dp[1][n][q][w];//\u7edf\u8ba1\u56db\u79cd\u60c5\u51b5\u7684\u548c \n\t\t\tans %= mod;\n\t\t}\n\t}\n\tprintf (\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1601117946,
        "uid": 345793,
        "name": "\u9648\u5f6c",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF149D Coloring Brackets"
    },
    {
        "content": "### \u9898\u76ee\n[\u6821\u5185OJ](http://222.180.160.110:1024/problem/10907)\n[\u6d1b\u8c37](https://www.luogu.com.cn/problem/CF149D)\n\n### \u5206\u6790\n##### 1.\u8003\u70b9\n\u533a\u95f4dp\n##### 2.\u601d\u8def\u60c5\u51b5\n1. \u5b9a\u4e49\u72b6\u6001:$dp[l][r][u][v]$\u8868\u793a\u4ece$l$\u5230$r$\u7684\u4e00\u4e2a\u5408\u6cd5\u62ec\u53f7\u5e8f\u5217,\u5de6\u7aef\u989c\u8272\u4e3a$u$\uff0c\u53f3\u7aef\u989c\u8272\u4e3a$v$\u7684\u67d3\u8272\u65b9\u6848\u6570\u3010$u$\uff0c$v$\u5f71\u54cd\u4e24\u4e2a\u5e8f\u5217\u5408\u5e76\u3011\u3010$s[l]$\u5fc5\u7136\u4e3a\u2018(\u2019\uff0c$s[r]$\u5fc5\u7136\u4e3a\u2018\uff09\u2019\uff0c\u5426\u5219\u4e0d\u5408\u6cd5\u3011\u3002\u90a3\u4e48\uff0c\u8ba9\u6211\u4eec\u5148\u5c06 ~~\u5783\u573e~~ \u60c5\u51b5\u5206\u7c7b\uff1a(\u5927\u5199\u5b57\u6bcd\u8868\u793a\u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217)\n\n> - \u60c5\u51b51. $l + 1 = r$, \u5219\u8be5\u5e8f\u5217\u4e3a\uff1a ```()```\n\n> - \u60c5\u51b52. $l$\u4e0e$r$\u7ec4\u6210\u4e00\u5bf9\u62ec\u53f7\uff0c\u5219\u8be5\u5e8f\u5217\u4e3a\uff1a $(A)$\n\n> - \u60c5\u51b53. $l$\u4e0e$r$\u5c5e\u4e8e\u4e24\u4e2a\u4e0d\u540c\u7684\u5408\u6cd5\u5e8f\u5217\u3002\u5219\u8be5\u5e8f\u5217\u4e3a\uff1a ```(A)(B)```\n\n2. \u987a\u5e8f\uff1a\u4e00\u4e2a\u5408\u6cd5\u7684\u62ec\u53f7\u5e8f\u5217\u9700\u8981\u62c6\u5206\u6210\u66f4\u77ed\u7684\u62ec\u53f7\u5e8f\u5217\uff0c\u800c\u5e8f\u5217\u65e0\u6cd5\u76f4\u63a5\u679a\u4e3e\u957f\u5ea6\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u641c\u7d22\u9012\u5f52\u3002\n\n3. \u65b9\u7a0b\n\n> - \u60c5\u51b51. \u8fb9\u754c\uff1a(~~_\u663e\u7136_~~)\n```\ndp[l][r][1][0] = dp[l][r][2][0] = dp[l][r][0][1] = dp[l][r][0][2] = 1;\n``` \n\n> - \u60c5\u51b52. \u679a\u4e3e\u6700\u5916\u5c42\u62ec\u53f7\u5185\u4e24\u7aef\u989c\u8272\uff0c\u53ef\u5f97\uff1a\n```cpp\nif(i != 1) dp[l][r][1][0] = (dp[l][r][1][0] + dp[l + 1][r - 1][i][j]) % mod;\nif(j != 1) dp[l][r][0][1] = (dp[l][r][0][1] + dp[l + 1][r - 1][i][j]) % mod;\nif(i != 2) dp[l][r][2][0] = (dp[l][r][2][0] + dp[l + 1][r - 1][i][j]) % mod;\nif(j != 2) dp[l][r][0][2] = (dp[l][r][0][2] + dp[l + 1][r - 1][i][j]) % mod;\n```\n\n> - \u60c5\u51b53.\u5373\u5c06$[l,r]$\u62c6\u6210\u5de6\u53f3\u4e24\u4e2a\u5408\u6cd5\u5e8f\u5217\u3002\u6839\u636e\u5176\u5339\u914d\u7684\u62ec\u53f7\u5c06\u5e8f\u5217\u62c6\u5206\n```cpp\ndp[l][r][i][j] = (dp[l][r][i][j] + (dp[l][x][i][u] * dp[x + 1][r][v][j]) % mod) % mod;\n```\n\n### \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <algorithm>\n#include <cstring>\nusing namespace std;\nconst long long mod = 1e9 + 7, MAXN = 705;\nchar s[MAXN];\nint len, p[MAXN], t[MAXN];\nlong long dp[MAXN][MAXN][4][4], ans;\nvoid dfs(int l, int r) {\n    if(l + 1 == r) {\n        dp[l][r][0][1] = 1;\n        dp[l][r][1][0] = 1;\n        dp[l][r][2][0] = 1;\n        dp[l][r][0][2] = 1;\n        return ;\n    }\n    if(p[r] == l) {\n        dfs(l + 1, r - 1);\n        for(int i = 0; i < 3; i++) {\n            for(int j = 0; j < 3; j++) {\n                if(i != 1) dp[l][r][1][0] = (dp[l][r][1][0] + dp[l+1][r-1][i][j]) % mod;\n                if(j != 1) dp[l][r][0][1] = (dp[l][r][0][1] + dp[l+1][r-1][i][j]) % mod;\n                if(i != 2) dp[l][r][2][0] = (dp[l][r][2][0] + dp[l+1][r-1][i][j]) % mod;\n                if(j != 2) dp[l][r][0][2] = (dp[l][r][0][2] + dp[l+1][r-1][i][j]) % mod;\n            }\n        }\n    }\n    else {\n        int x = p[l];\n        dfs(l, x);\n        dfs(x + 1, r);\n        for(int i = 0; i < 3; i++) \n            for(int j = 0; j < 3; j++) \n                for(int u = 0; u < 3; u++) \n                    for(int v = 0; v < 3; v++) \n                        if(!(u == 1 && v == 1 || u == 2 && v == 2))\n\t\t\t\t\t\t \tdp[l][r][i][j] = (dp[l][r][i][j] + (dp[l][x][i][u] * dp[x + 1][r][v][j]) % mod) % mod;\n    }\n}\nint main() {\n    scanf(\"%s\", s + 1);\n    len = strlen(s + 1);\n\tfor(int i = 1, k = 0; i <= len; i++) {\n        if(s[i] == '(') t[k++] = i;\n        else {\n            p[i] = t[k - 1];\n            p[t[--k]] = i;\n        }\n    }\n    dfs(1, len);\n\tfor(int i = 0; i < 3; i++) \n        for(int j = 0; j < 3; j++) \n            ans = (ans + dp[1][len][i][j]) % mod;\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1578375724,
        "uid": 106459,
        "name": "lztmdrclht",
        "ccfLevel": 0,
        "title": "\u300cCF149D\u300dColoring Brackets"
    },
    {
        "content": "\u6027\u8d28\uff1a\u5bf9\u4e8e\u4efb\u610f\u4e00\u79cd\u94a6\u5b9a\u4e86 $k$ \u4e2a\u8fde\u7eed\u6bb5\u67d3\u8272\u7684\u65b9\u6848\uff0c\u8be5\u60c5\u51b5\u4e0b\u7684\u65b9\u6848\u6570\u4e3a $2^k$ \uff0c\u4ee4 $cnt[k]$ \u4e3a\u94a6\u5b9a $k$ \u4e2a\u8fde\u7eed\u6bb5\u67d3\u8272\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u603b\u7684\u65b9\u6848\u6570\u5373 $\\sum_k cnt[k]\\times 2^k$ \u3002\r\n\r\n\uff08\u56e0\u4e3a\u6211\u4eec\u53ea\u8981\u786e\u5b9a\u6bcf\u4e00\u6bb5\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u7684\u989c\u8272\uff0c\u5176\u4ed6\u4f4d\u7f6e\u7684\u989c\u8272\u4e00\u5b9a\u662f\u552f\u4e00\u786e\u5b9a\u7684\uff0c\u6bcf\u6bb5\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u989c\u8272\u6709\u4e24\u79cd\u586b\u6cd5\uff0c\u56e0\u6b64\u65b9\u6848\u6570\u4e3a $2^k$ \u3002\uff09\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/32emh259.png)\r\n\r\n\u4f8b\u5982\u5bf9\u4e8e\u4e0a\u56fe\u6765\u8bf4\uff0c\u6211\u4eec\u94a6\u5b9a\u4e86\u4e09\u6bb5\u67d3\u8272\uff0c\u65b9\u6848\u6570\u5373 $2^3$ \u3002\r\n\r\n\u82e5\u533a\u95f4 $[l,r]$ \u662f\u5408\u6cd5\u62ec\u53f7\u6bb5\uff0c\u4ee4 $f[l,r,0/1,0/1]$ \u4e3a\u8003\u8651\u5b50\u6bb5 $[l,r]$ \u4e14\u5de6\u7aef\u70b9\u4e0d\u67d3\u8272 / \u67d3\u8272\uff0c\u53f3\u7aef\u70b9\u4e0d\u67d3\u8272/\u67d3\u8272\u7684\u65b9\u6848\u6570\u3002\r\n\r\n\u82e5 $r$ \u5339\u914d\u7684\u4f4d\u7f6e $pr\\not= l$ \uff0c\u5176\u5bf9\u5e94\u7740\u4e00\u4e2a\u4e8c\u533a\u95f4\u5408\u5e76\u3002\r\n\r\n\u4ee4\u533a\u95f4 $S_1$ \u4e3a\u533a\u95f4 $[l,pr-1]$ \uff0c\u533a\u95f4 $S_2$ \u4e3a\u533a\u95f4 $[pr,r]$ \u3002\r\n\r\n\u4ee4 $cnt_1[k,0/1,0/1]$ \u4e3a\u533a\u95f4 $S_1$ \u4e2d\u94a6\u5b9a $k$ \u6bb5\u67d3\u8272\u4e14\u5de6\u7aef\u70b9\u4e0d\u67d3\u8272 / \u67d3\u8272\uff0c\u53f3\u7aef\u70b9\u4e0d\u67d3\u8272/\u67d3\u8272\u7684\u65b9\u6848\u6570\uff0c $cnt_2[k,0/1,0/1]$ \u4e3a\u533a\u95f4 $S_2$ \u4e2d\u94a6\u5b9a $k$ \u6bb5\u67d3\u8272\u4e14\u5de6\u7aef\u70b9\u4e0d\u67d3\u8272 / \u67d3\u8272\uff0c\u53f3\u7aef\u70b9\u4e0d\u67d3\u8272/\u67d3\u8272\u7684\u65b9\u6848\u6570\u3002\r\n\r\n\u4ee4\uff1a$cnt_i[k,..,t] = cnt_i[k,0,t] + cnt_i[k,1,t]$\r\n\r\n\u90a3\u4e48\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u6709 \uff1a\r\n\r\n$$\r\nf[l,r,t1,t2] = \\sum_{k_1,k_2} (cnt_1[k_1,t1,0] \\times cnt_2[k_2,..,t_2] + cnt_1[k_1,t1,1] \\times cnt_2[k_2,0,t_2]) * 2^{k_1+k_2} + \\sum_{k_1,k_2} cnt_1[k_1,t1,1] \\times cnt_2[k_2,1,t_2] * 2^{k_1+k_2-1}\r\n$$\r\n\r\n\u53d1\u73b0\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\u3002\r\n\r\n\u5e76\u4e14\u72b6\u6001\u95f4\u7684\u4e58\u6cd5\u663e\u7136\u53ef\u4ee5\u770b\u6210\u5377\u79ef\uff1a\r\n\r\n$$\r\nf[l,pr-1,t_1,op_1] \\times f[pr,r,op_2,t_2] = \\sum_{k_,k_2} cnt_1[k_1,t_1,op_1] \\times cnt_2[k_2,op_2,t_2] \\times 2^{k_1+k_2}\r\n$$\r\n\r\n\u90a3\u4e48\u5bf9\u4e8e\u524d\u9762 $\\sum_{k_1,k_2} (cnt_1[k_1,t1,0] \\times cnt_2[k_2,..,t_2] + cnt_1[k_1,t1,1] \\times cnt_2[k_2,0,t_2]) * 2^{k_1+k_2}$ \u7684\u5904\u7406\u662f\u5e73\u51e1\u7684\u3002\r\n\r\n\u8003\u8651\u4ece\u540e\u9762\u63d0\u53d6\u4e00\u4e2a\u7cfb\u6570\r\n\r\n$$\r\n\\sum_{k_1,k_2} cnt_1[k_1,t1,1] \\times cnt_2[k_2,1,t_2] * 2^{k_1+k_2-1} = \\dfrac{1}{2}\\sum_{k_1,k_2} cnt_1[k_1,t1,1] \\times cnt_2[k_2,1,t_2] * 2^{k_1+k_2}\r\n$$\r\n\r\n\u90a3\u4e48\u5bf9\u5e94\u7684\u8f6c\u79fb\u5373 $\\dfrac{1}{2}\\times f[l,pr-1,t_1,1] \\times f[pr,r,1,t_2]$ \u3002\r\n\r\n\u5bf9\u4e8e $l$ \u548c $r$ \u5339\u914d\u7684\u60c5\u51b5\u53ef\u4ee5\u770b\u6210\u5355\u70b9\u548c\u533a\u95f4\u7684\u62fc\u63a5\uff0c\u601d\u8003\u65b9\u5f0f\u4e5f\u7c7b\u4f3c\uff0c\u603b\u7684\u590d\u6742\u5ea6\u4e3a $O(n^3)$ \u3002\r\n\r\n```cpp\r\n#include <bits/stdc++.h>\r\n\r\n#define rep(i,l,r) for (int i = l; i <= r; i++)\r\n#define per(i,r,l) for (int i = r; i >= l; i--)\r\n#define fi first\r\n#define se second\r\n#define prt std::cout\r\n#define gin std::cin\r\n#define edl std::endl\r\n#define int long long\r\n\r\nnamespace wxy{\r\n\r\nconst int N = 705,mod = 1e9 + 7;\r\n\r\nint n,f[N][N][2][2],s[N][N],pos[N];\r\n\r\nchar str[N];\r\n\r\ninline bool check(int l,int r){\r\n\tstd::stack<int> tt; memset(pos,0,sizeof pos);\r\n\trep(i,l,r){\r\n\t\tif (str[i] == '(') tt.push(i);\r\n\t\telse if (tt.size() == 0) return false;\r\n\t\telse {pos[i] = tt.top(); tt.pop();}\r\n\t}\r\n\treturn tt.size() == 0 ? true : false;\r\n}\r\n\r\ninline void add(int &x,int v){x = (x + v) % mod;}\r\n\r\ninline int fpow(int a,int b){\r\n\tint res = 1;\r\n\tfor (;b;b>>=1){\r\n\t\tif (b & 1) res = res * a % mod;\r\n\t\ta = a * a % mod;\r\n\t}\r\n\treturn res;\r\n}\r\n\r\ninline void update(int l,int r,int k,int ls,int rs){\r\n\tadd(f[l][r][ls][rs],f[l][k][ls][0] * ((f[k+1][r][1][rs] + f[k+1][r][0][rs]) % mod) % mod);\r\n\tadd(f[l][r][ls][rs],f[l][k][ls][1] * f[k+1][r][0][rs] % mod);\r\n\tadd(f[l][r][ls][rs],fpow(2,mod-2) * f[l][k][ls][1] %mod * f[k+1][r][1][rs] %mod);\r\n}\r\n\r\ninline void main(){\r\n    #ifndef ONLINE_JUDGE\r\n        freopen(\"in.in\",\"r\",stdin);\r\n        freopen(\"out.out\",\"w\",stdout);\r\n    #endif\r\n    gin >> str; n = strlen(str);\r\n    per(i,n,1) str[i] = str[i - 1];\r\n    for (int len = 2; len <= n; len++){\r\n\t\tfor (int l = 1; l <= n - len + 1; l++){\r\n\t\t\tint r = l + len - 1;\r\n\t\t\tif (!check(l,r)) continue;\r\n\t\t\tif (len == 2){ \r\n\t\t\t\tf[l][r][1][0] = f[l][r][0][1] = 2;\r\n\t\t\t\tadd(s[l][r],f[l][r][0][0]); add(s[l][r],f[l][r][0][1]);\r\n\t\t\t\tadd(s[l][r],f[l][r][1][0]); add(s[l][r],f[l][r][1][1]);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (pos[r] == l){\r\n\t\t\t\t\r\n\t\t\t\tadd(f[l][r][1][0],2 * ((f[l+1][r-1][0][1] + f[l+1][r-1][0][0]) % mod) % mod);\r\n\t\t\t\tadd(f[l][r][1][0],(f[l+1][r-1][1][1] + f[l+1][r-1][1][0]) % mod);\r\n\t\t\t\t\r\n\t\t\t\tadd(f[l][r][0][1],2 * ((f[l+1][r-1][1][0] + f[l+1][r-1][0][0]) % mod) % mod);\r\n\t\t\t\tadd(f[l][r][0][1],(f[l+1][r-1][1][1] + f[l+1][r-1][0][1]) % mod);\r\n\t\t\t\t\r\n\t\t\t\tadd(s[l][r],f[l][r][0][0]); add(s[l][r],f[l][r][0][1]);\r\n\t\t\t\tadd(s[l][r],f[l][r][1][0]); add(s[l][r],f[l][r][1][1]);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tint k = pos[r] - 1;\r\n\t\t\tif (!check(l,k) || !check(k+1,r)) continue;\r\n\t\t\tupdate(l,r,k,0,0); update(l,r,k,0,1);\r\n\t\t\tupdate(l,r,k,1,0); update(l,r,k,1,1);\r\n\t\t\tadd(s[l][r],f[l][r][0][0]); add(s[l][r],f[l][r][0][1]);\r\n\t\t\tadd(s[l][r],f[l][r][1][0]); add(s[l][r],f[l][r][1][1]);\r\n\t\t}\r\n\t}\r\n\tprt << s[1][n];\r\n}\r\n\r\n}signed main(){wxy::main(); return 0;}\r\n```\r\n",
        "postTime": 1630405411,
        "uid": 317459,
        "name": "RyexAwl",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011 CF149D \u533a\u95f4DP"
    },
    {
        "content": "~~\u55ef\uff0c\u8bfb\u5b8c\u4e00\u904d\u9898\u53d1\u73b0\u5f88\u50cfCSPd1t2\u6709\u6728\u6709\uff0c\u83ab\u975e\uff1f~~\n\u597d\u4e86\u56de\u5f52\u6b63\u9898qwq\n\n\u6240\u6709\u7684\u62ec\u53f7\u5e8f\u5217\uff0c\u90fd\u662f\u5f62\u5982(()()()(()()))(())(()())\n\u5f88\u7b80\u5355\uff0c\u53ea\u6709\u4e24\u79cd\u5f62\u6001\uff0c**\u4e00\u662f\u5957\u4e0a\u4e00\u4e2a\u62ec\u53f7\u5e8f\u5217\uff0c\u4e8c\u662f\u4e0e\u524d\u9762\u7684\u62ec\u53f7\u5e8f\u5217\u76f8\u63a5**\u3002dp\u72b6\u6001\u9700\u8981\u5408\u5e76\u54e6\uff0c\u8fd9\u8ba9\u6211\u4eec\u60f3\u5230\u4e86\u5c18\u5c01\u5df2\u4e45\u7684\u533a\u95f4dp\uff01\n\n\u72b6\u6001\u8f6c\u79fb\u5c31\u53ef\u4ee5\u63a8\u51fa\u6765\u4e86\u54e6\uff0c\u8bbef[l][r]\u8868\u793al-r\u533a\u95f4\u5408\u6cd5\u67d3\u8272\u7684\u79cd\u6570\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u60c5\u51b5\uff08l-r\u9ed8\u8ba4\u662f\u5408\u6cd5\u5e8f\u5217\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u8bb0\u5fc6\u5316\u641c\u7d22\u6765\u4fdd\u8bc1\uff09\n\n1.l\u4e0er\u662f\u4e00\u5bf9\u5339\u914d\u7684\u62ec\u53f7\uff0c\u6b64\u65f6**f[l][r]=(f[l+1][r-1])+\u9650\u5236**\n\n2.l\u4e0er\u4e0d\u5339\u914d\uff0c\u6b64\u65f6**f[l][r]=f[l][p[l]]\u00d7f[p[l]+1][r]+\u9650\u5236**\uff08p[l]\u8868\u793a\u4e0el\u5339\u914d\u7684\u62ec\u53f7\u4f4d\u7f6e\uff09\n\n\u5982\u679c\u8981\u6bd4\u8f83\u65b9\u4fbf\u5730\u5b9e\u73b0\uff0c\u5efa\u8bae\u518d\u5f00\u4e24\u7ef4\u5206\u522b\u8868\u793al\uff0cr\u7684\u989c\u8272\u3002\n\n\u6ce8\u610f\u53d6\u6a21\u548c\u8bb0\u641c\uff0c\u5b8c\u7ed3\u6492\u82b1(*^\u25bd^*)\uff01\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=705;\nchar s[N];\ntypedef long long ll;\nconst ll mod=1e9+7;\nint n;\nll f[N][N][3][3],fl[N][N];\nint tot,st[N],q[N];\nvoid dfs(int l,int r){\n\tint i,j,k,m;\n\tif(l>r){\n\t\tfl[l][r]=1;\n\t\treturn ;\t\n\t}\n\tif(l==r){\n\t\tfor(i=0;i<3;i++)f[l][r][i][i]=1;\n\t\tfl[l][r]=1;\n\t\treturn ;\n\t}\n\tif(fl[l][r]){\n\t\treturn ;\t\n\t}\t\n\tif(q[l]==r){\n\t\tif(l==r-1){\n\t\t\tf[l][r][0][1]=1;f[l][r][1][0]=1;\n\t\t\tf[l][r][0][2]=1;f[l][r][2][0]=1;\n\t\t\tfl[l][r]=1;\n\t\t\treturn ;\n\t\t}\n\t\tdfs(l+1,r-1);\n\t\tf[l][r][0][1]=(f[l+1][r-1][0][0]+f[l+1][r-1][0][2]+f[l+1][r-1][1][0]\n\t\t+f[l+1][r-1][1][2]+f[l+1][r-1][2][0]+f[l+1][r-1][2][2])%mod;\n\t\tf[l][r][0][2]=(f[l+1][r-1][0][0]+f[l+1][r-1][0][1]+f[l+1][r-1][1][0]\n\t\t+f[l+1][r-1][1][1]+f[l+1][r-1][2][0]+f[l+1][r-1][2][1])%mod;\n\t\tf[l][r][1][0]=(f[l+1][r-1][0][0]+f[l+1][r-1][0][1]+f[l+1][r-1][0][2]\n\t\t+f[l+1][r-1][2][0]+f[l+1][r-1][2][1]+f[l+1][r-1][2][2])%mod; \n\t\tf[l][r][2][0]=(f[l+1][r-1][0][0]+f[l+1][r-1][0][1]+f[l+1][r-1][0][2]\n\t\t+f[l+1][r-1][1][0]+f[l+1][r-1][1][1]+f[l+1][r-1][1][2])%mod; \n\t\tfl[l][r]=1;\n\t\treturn ;\n\t}else{\n\t\tdfs(l,q[l]),dfs(q[l]+1,r);\n\t\tfor(i=0;i<3;i++){\n\t\t\tfor(j=0;j<3;j++){\n\t\t\t\tfor(k=0;k<3;k++){\n\t\t\t\t\tfor(m=0;m<3;m++){\n\t\t\t\t\t\tif(k!=m||(k==0&&m==0)){\n\t\t\t\t\t\t\tf[l][r][i][j]=(f[l][r][i][j]+(f[l][q[l]][i][k]*f[q[l]+1][r][m][j])%mod)%mod;\n\t\t\t\t\t\t}\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfl[l][r]=1;\n\t\treturn ;\n\t}\n}\nint main(){\n\tint i,j;\n\tscanf(\"%s\",s+1);\n\tn=strlen(s+1);\n\tfor(i=1;i<=n;i++){\n\t\tif(s[i]=='(')st[++tot]=i;\n\t\telse {\n\t\t\tint t=st[tot];tot--;\n\t\t\tq[i]=t,q[t]=i;\n\t\t} \n\t}\n\tfor(i=1;i<=n;i++)\n\tdfs(1,n);\n\tll ans=0;\n\tfor(i=0;i<3;i++)for(j=0;j<3;j++)ans=(ans+f[1][n][i][j])%mod;\n\tcout<<ans<<endl;\n\treturn 0;\n} \n```\n",
        "postTime": 1595170388,
        "uid": 127915,
        "name": "Bosun",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF149D \u3010Coloring Brackets\u3011"
    },
    {
        "content": "# [\u5efa\u8bae\u5230\u535a\u5ba2\u4e2d\u53bb\u89c2\u770b\uff01](https://blog.csdn.net/huang_ke_hai/article/details/108586894)\n## [\u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/problemset/problem/149/D)\n## \u9898\u76ee\u63cf\u8ff0\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914200757963.png#pic_center)\n***\n## Solution\n\u6211\u4eec\u8003\u8651\u4e00\u5bf9\u62ec\u53f7\u80fd\u591f\u4ea7\u751f\u7684\u8d21\u732e\u3002\n\u8bbe$dp[l][r][i][j]$\u8868\u793a\u5f53\u524d\u533a\u95f4\u4e3a$[l,r]$\uff0c\u7b2c$l$\u4e2a\u62ec\u53f7\u7684\u989c\u8272\u4e3a$i$\uff0c\u7b2c$r$\u4e2a\u62ec\u53f7\u7684\u989c\u8272\u4e3a$j$\u7684\u65b9\u6848\u6570\u3002($i,j\\in [0,1,2]$)\n\n\u6211\u4eec\u8bbe$mat[i]$\u8868\u793a\u7b2c$i$\u4e2a\u62ec\u53f7\u5339\u914d\u5230\u7684\u53f3\u62ec\u53f7\u7684\u4f4d\u7f6e(\u5176\u4e2d\u7b2c$i$\u4e2a\u62ec\u53f7\u4e3a\u5de6\u62ec\u53f7)\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u7528\u4e00\u4e2a\u6808\u53bb\u64cd\u4f5c\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914201540914.png#pic_center)\n\n\n\u63a5\u7740\u5bf9\u4e8e\u95ee\u9898\u5728$[l,r]$\u7684\u533a\u95f4\uff0c\u6211\u4eec\u9700\u8981\u5206\u7c7b\u8ba8\u8bba:\n1\u3001$l+1==r$\uff0c\u6b64\u65f6\u5bf9\u5e94\u8fd9\u79cd\u60c5\u51b5\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914201815622.png#pic_center)\n\n\u5373\u53ea\u6709\u4e00\u4e2a\u5408\u6cd5\u62ec\u53f7\u5bf9\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u76f4\u63a5\u8d4b\u503c\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914201850226.png#pic_center)\n\n\u6ce8\u610f\uff0c\u540c\u4e00\u5bf9\u62ec\u53f7\u6709\u4e14\u53ea\u80fd\u6709\u4e00\u79cd\u989c\u8272\uff0c\u6240\u4ee5\u4e24\u79cd\u989c\u8272\u90fd\u6709\u7684\u662f\u65e0\u6cd5\u66f4\u65b0\u7684\u3002\n\n2\u3001$mat[l]==r$\uff0c\u6b64\u65f6\u5bf9\u5e94\u8fd9\u79cd\u60c5\u51b5\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914202011496.png#pic_center)\n\n\uff08\u54b3\u54b3\uff0c\u4e2d\u95f4\u7684\u5b57\u7b26\u5c31\u4e0d\u7528\u7ba1\u4e86\uff09\n\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u7684\u7b54\u6848\u662f\u80fd\u591f\u76f4\u63a5\u4ece$[l+1,r-1]$\u8fd9\u6bb5\u533a\u95f4\u8f6c\u79fb\u8fc7\u6765\u7684\uff0c\u76f4\u63a5\u7c7b\u52a0\u4e0a\u7b54\u6848\u5373\u53ef\u3002\u9700\u8981\u6ce8\u610f\u7684\u7ec6\u8282\u5c31\u662f\u76f8\u90bb\u7684\u4e0d\u80fd\u91cd\u590d\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914202139405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1YW5nX2tlX2hhaQ==,size_16,color_FFFFFF,t_70#pic_center)\n\n3\u3001$mat[l]!=r$\uff0c\u5373\u8fd9\u79cd\u60c5\u51b5\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914202734319.png#pic_center)\n\n\n\u8fd9\u79cd\u60c5\u51b5\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u5148\u628a\u4e24\u8fb9\u7684\u533a\u95f4\u9012\u5f52\u6c42\u89e3\uff0c\u7136\u540e\u518d\u6765\u5408\u5e76\u7b54\u6848\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u6709\u70b9\u9ebb\u70e6\uff0c\u56e0\u4e3a\u6709\u56db\u4e2a\u62ec\u53f7\uff0c\u6211\u4eec\u9700\u8981\u7528\u56db\u91cd\u5faa\u73af\u5206\u522b\u53d6\u679a\u4e3e\u6bcf\u4e2a\u62ec\u53f7\u7684\u989c\u8272\uff0c\u540c\u65f6\u9700\u8981\u6ce8\u610f\u5c06\u91cd\u590d\u7684\u7ed9\u5224\u6389\u3002\n\u7531\u4e8e\u4e24\u4e2a\u62ec\u53f7\u5e8f\u5217\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u662f\u76f8\u4e58\u3002\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914202911825.png#pic_center)\n\n\u5206\u7c7b\u8ba8\u8bba\u7684\u60c5\u51b5\u6211\u4eec\u7ed3\u675f\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u7d2f\u52a0\u7b54\u6848\u3002\n\n\u5206\u522b\u679a\u4e3e$1\u53f7\u548cn\u53f7\u62ec\u53f7\u7684\u989c\u8272$\u7136\u540e\u7d2f\u52a0\u5373\u53ef\u3002\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200914203051806.png#pic_center)\n\n\u6b64\u65f6\u4e0d\u5224\u989c\u8272\u4e5f\u6ca1\u5173\u7cfb\uff0c\u56e0\u4e3a\u8d21\u732e\u5c31\u4f4d0\uff0c\u5f53\u7136\u5224\u4e86\u4e5f\u6ca1\u5173\u7cfb\u3002\n***\n## Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\nconst int N = 1e3+10,P = 1e9+7;\nint n;\nchar s[N];\nint dp[N][N][3][3];\nint mat[N];\n\nvoid Find(){\n\tstack < int > q;\n\tfor (int i = 1; i <= n; i++)\n\t  if (s[i] == '(') q.push(i);\n\t  else mat[q.top()] = i,q.pop();\n}\n#define f dp[l][r]\n#define f1 dp[l][mat[l]]\n#define f2 dp[mat[l]+1][r]\n#define f3 dp[l+1][r-1]\nvoid dfs(int l,int r){\n\tif (l + 1 == r){\n\t\tf[0][1] = f[0][2] = f[1][0] = f[2][0] = 1;\n\t\treturn;\n\t}\n\tif (mat[l] == r){\n\t\tdfs(l+1,r-1);\n\t\tfor (int i = 0; i <= 2; i++)\n\t\t  for (int j = 0; j <= 2; j++){\n\t\t  \t  if (i!=1) f[1][0] = (f[1][0] + f3[i][j])%P;\n\t\t  \t  if (i!=2) f[2][0] = (f[2][0] + f3[i][j])%P;\n\t\t  \t  if (j!=1) f[0][1] = (f[0][1] + f3[i][j])%P;\n\t\t  \t  if (j!=2) f[0][2] = (f[0][2] + f3[i][j])%P;\n\t\t  }\n\t\t  return;\n\t}\n\tdfs(l,mat[l]); dfs(mat[l]+1,r);\n\tfor (int il = 0; il <= 2; il++)\n\t  for (int jl = 0; jl <= 2; jl++)\n\t    for (int jr = 0; jr <= 2; jr++)\n\t      for (int ir = 0; ir <= 2; ir++){\n\t      \tif ((jl == jr) && jl != 0) continue;\n\t      \t  f[il][ir] = (f[il][ir] + f1[il][jl] * f2[jr][ir])%P;\n\t      }\n\treturn;\n\t  \n}\n\nsigned main(){\n\tscanf(\"%s\",s+1);\n\tn = strlen(s+1);\n\tFind();\n\tdfs(1,n);\n\tint ans = 0;\n\tfor (int i = 0; i <= 2; i++)\n\t  for (int j = 0; j <= 2; j++) ans = (ans + dp[1][n][i][j])%P;\n\tcout<<ans;\n}\n```\n\n",
        "postTime": 1600087045,
        "uid": 34301,
        "name": "\u9e6d\u5929",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF149D \u3010Coloring Brackets\u3011"
    }
]