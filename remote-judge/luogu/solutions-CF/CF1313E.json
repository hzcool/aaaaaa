[
    {
        "content": "> \u9898\u610f\uff1a\u7ed9\u5b9a\u4e09\u4e2a\u4e32 $a,b,s$\uff0c\u5176\u4e2d $a,b$ \u957f\u5ea6\u4e3a $n$\uff0c$s$ \u957f\u5ea6\u4e3a $m$\uff0c\u6c42\u51fa\u56db\u5143\u7ec4 $(l1,r1,l2,r2)$ \u7684\u4e2a\u6570\uff0c\u6ee1\u8db3\uff1a\n\n> 1. $[l1,r1]$ \u548c $[l2,r2]$ \u7684\u4ea4\u96c6\u975e\u7a7a\u3002\n\n> 2. $a$ \u4e2d\u4f4d\u7f6e $l1$ \u5230 $r1$ \u7ec4\u6210\u7684\u5b50\u4e32\u4e0e $b$ \u4e2d\u4f4d\u7f6e $l2$ \u5230 $r2$ \u7ec4\u6210\u7684\u5b50\u4e32\u62fc\u8d77\u6765\u6070\u597d\u662f $s$\u3002\n\n\u4e00\u9053\u5b57\u7b26\u4e32+\u6570\u636e\u7ed3\u6784\u7684\u795e\u9898\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e24\u4e2a\u4e32\u62fc\u6210 $s$ \u8f6c\u5316\u4e3a $a$ \u4e2d\u5339\u914d\u4e00\u4e2a $s$ \u7684\u975e\u7a7a\u524d\u7f00\uff0c$b$ \u4e2d\u5339\u914d\u4e00\u4e2a $s$ \u7684\u975e\u7a7a\u540e\u7f00\u3002\n\n\u6211\u4eec\u5b9a\u4e49 $za_i$ \u4e3a $s_1s_2 \\dots s_{m-1}$ \u4e0e $a_i,a_{i+1} \\dots a_n$ \u7684\u6700\u957f\u516c\u5171\u524d\u7f00\uff0c$zb_i$ \u4e3a $s_2s_3 \\dots s_{m}$ \u4e0e $b_1 b_2 \\dots b_i$ \u7684\u6700\u957f\u516c\u5171\u540e\u7f00\u3002\u8fd9\u4e2a\u53ef\u4ee5\u7528 Z \u7b97\u6cd5\u6c42\u51fa\u3002\u8be6\u60c5\u89c1\u6211\u7684 blog \uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u7531\u4e8e\u62fc\u6210\u7684\u5b57\u7b26\u4e32\u6070\u597d\u4e3a $s$\uff0c\u56e0\u6b64 \n\n$$r1-l1+1+r2-l2+1=m$$\n\n\u4e00\u5b9a\u6210\u7acb\u3002\u79fb\u4e00\u4e0b\u9879\uff0c\u5373\n\n$$r2=l1-r1+l2-2+m$$\n\n\u7531\u4e8e\u4e24\u533a\u95f4\u6709\u4ea4\u70b9\uff0c\u6240\u4ee5 $l1 \\leq r2$\uff0c$l2 \\leq r1$ \u6210\u7acb\uff0c\u6240\u4ee5 $-r1+l2$ \u4e00\u5b9a\u5c0f\u4e8e\u7b49\u4e8e $0$\uff0c\u5f0f\u5b50\u53c8\u53ef\u4ee5\u53d8\u4e3a\n\n$$r2=l1-r1+l2-2+m \\leq l1-2+m$$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $r2 \\leq l1+m-2$\u3002\n\n\u53c8\u6839\u636e $l1 \\leq r2$\uff0c\u6240\u4ee5\u4e24\u4e2a\u533a\u95f4\u6ee1\u8db3\u6761\u4ef6\u4e00\u5f53\u4e14\u4ec5\u5f53 $l1 \\leq r2 \\leq l1+m-2$\uff0c$l2$ \u548c $r1$ \u5c31\u53ef\u4ee5\u88ab\u6211\u4eec\u5ffd\u7565\u4e86\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u4e24\u4e2a\u6570 $l1,r2$ \u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u6ee1\u8db3\u6761\u4ef6\u7684\u65b9\u6848\u6570\u4e3a $\\max(za_{l1}+zb_{r2}-m+1,0)$\u3002\n\n\u8fd9\u5e94\u8be5\u4e0d\u662f\u592a\u96be\u7406\u89e3\uff0c\u4e3e\u4e2a\u6817\u5b50\uff1a\n\n$m=5$\uff0c$s=\\texttt{aabab}$\uff0c$za_{l1}=4$\uff0c$l1$ \u5f00\u59cb\u7684\u56db\u4e2a\u5b57\u7b26\u4e3a $\\texttt{aaba}$\uff0c$zb_{l2}=3$\uff0c$l2$ \u7ed3\u5c3e\u7684\u4e09\u4e2a\u5b57\u7b26\u4e3a $\\texttt{bab}$\uff0c\u90a3\u4e48\u6709\u4e09\u79cd\u65b9\u6cd5\uff0c\u5206\u522b\u662f\n\n- $\\texttt{aa}+\\texttt{bab}=\\texttt{aabab}$\n\n- $\\texttt{aab}+\\texttt{ab}=\\texttt{aabab}$\n\n- $\\texttt{aaba}+\\texttt{b}=\\texttt{aabab}$\n\n\u521a\u597d\u5c31\u662f $4+3-5+1$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u539f\u672c $n^5$ \u7684\u4e8b\u60c5\u964d\u5230\u4e86 $n^2$\uff0c\u4f46\u662f\u8fd8\u662f\u8fc7\u4e0d\u53bb\u554a\u3002\u522b\u6025\u6211\u4eec\u7ee7\u7eed\u63a8\u5f0f\u5b50\u3002\n\n\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum\\limits_{l1=1}^n\\ \\sum\\limits_{r2=l1}^{\\min(l1+m-2,n)} \\max(za_{l1}+zb_{r2}-m+1,0)$$\n\n\u4e0d\u96be\u53d1\u73b0\u968f\u7740 $l1$ \u7684\u589e\u957f\uff0c$r2$ \u4e5f\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u7c7b\u4f3c two pointers \u7684\u65b9\u5f0f\u7ef4\u62a4\uff0c\u4f46\u662f\u8fd9\u4e2a $\\max$ \u6709\u70b9\u8ba8\u538c\uff0c\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u60f3\u529e\u6cd5\u628a\u8fd9\u4e2a $\\max$ \u53bb\u6389\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c $za_{l1}+zb_{r2}-m+1<0$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u60c5\u51b5\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u7528\u8003\u8651 $za_{l1}+zb_{r2}-m+1 \\geq 0$\uff0c\u5373 $m-1-zb_{r2} \\leq za_{l1}$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u6761\u4ef6\u52a0\u5230\u6211\u4eec\u7684\u5f0f\u5b50\u4e2d\uff0c\u5373\n\n$$\\sum\\limits_{l1=1}^n\\ \\sum\\limits_{r2=l1}^{\\min(l1+m-2,n)} za_{l1}+zb_{r2}-m+1\\ [m-1-zb_{r2} \\leq za_{l1}]$$\n\n\u5047\u8bbe\u5728\u533a\u95f4 $[l1,\\min(l1+m-2,n)]$ \u4e2d\u6ee1\u8db3 $m-1-zb_{r2} \\leq za_{l1}$ \u7684 $r1$ \u7684\u4e2a\u6570\u4e3a $cnt$\uff0c\u53c8\u53ef\u4ee5\u53d8\u4e3a\n\n$$\\sum\\limits_{l1=1}^n\\ cnt \\times (za_{l1}-m+1)+\\sum\\limits_{r2=l1}^{\\min(l1+m-2,n)} zb_{r2}\\ [m-1-zb_{r2} \\leq za_{l1}]$$\n\n\u53d1\u73b0 $m-1-zb_{r2}$ \u4e0d\u542b $l1$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5efa\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $l1$\uff0c\u7136\u540e\u5355\u8c03\u5730\u589e\u52a0 $r2$\uff0c\u6bcf\u589e\u52a0\u4e00\u4e2a $l2$\uff0c\u5c31\u5728\u7b2c\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4 $m-1-zb_{r2}$ \u589e\u52a0 $zb_{r2}$\uff0c\u7b2c\u4e8c\u4e2a\u6811\u72b6\u6570\u7ec4 $m-1-zb_{r2}$ \u589e\u52a0 $1$\uff0c\u7136\u540e\u7b2c\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4 $\\leq za_{l1}$ \u4f4d\u7f6e\u4e0a\u7684\u548c\u5c31\u662f\u5bf9\u5e94\u7684 $\\sum\\limits_{r2=l1}^{\\min(l1+m-2,n)} zb_{r2}$\uff0c\u7b2c\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4 $\\leq za_{l1}$ \u4f4d\u7f6e\u4e0a\u7684\u548c\u5c31\u662f\u5bf9\u5e94\u7684 $cnt$\u3002\u7136\u540e\u52a0\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n```cpp\n//Coded by tzc_wk\n/*\n\u6570\u636e\u4e0d\u6e05\u7a7a\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u591a\u6d4b\u4e0d\u8bfb\u5b8c\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8fb9\u754c\u4e0d\u7279\u5224\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d2a\u5fc3\u4e0d\u8bc1\u660e\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\nD P \u987a\u5e8f\u9519\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u5927\u5c0f\u5c11\u7b49\u53f7\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u53d8\u91cf\u4e0d\u7edf\u4e00\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d8a\u754c\u4e0d\u5224\u65ad\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8c03\u8bd5\u4e0d\u6ce8\u91ca\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u6ea2\u51fa\u4e0d l l\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n*/\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi\t\t\tfirst\n#define se\t\t\tsecond\n#define fz(i,a,b)\tfor(int i=a;i<=b;i++)\n#define fd(i,a,b)\tfor(int i=a;i>=b;i--)\n#define foreach(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define all(a)\t\ta.begin(),a.end()\n#define giveup(...) return printf(__VA_ARGS__),0;\n#define fill0(a)\tmemset(a,0,sizeof(a))\n#define fill1(a)\tmemset(a,-1,sizeof(a))\n#define fillbig(a)\tmemset(a,0x3f,sizeof(a))\n#define fillsmall(a) memset(a,0xcf,sizeof(a))\n#define mask(a)\t\t(1ll<<(a))\n#define maskx(a,x)\t((a)<<(x))\n#define _bit(a,x)\t(((a)>>(x))&1)\n#define _sz(a)\t\t((int)(a).size())\n#define filei(a)\tfreopen(a,\"r\",stdin);\n#define fileo(a)\tfreopen(a,\"w\",stdout);\n#define fileio(a) \tfreopen(a\".in\",\"r\",stdin);freopen(a\".out\",\"w\",stdout)\n#define eprintf(...) fprintf(stderr,__VA_ARGS__)\n#define put(x)\t\tputchar(x)\n#define eoln        put('\\n')\n#define space\t\tput(' ')\n#define y1\t\t\ty_chenxiaoyan_1\n#define y0\t\t\ty_chenxiaoyan_0\n#define int long long\ntypedef pair<int,int> pii;\ninline int read(){\n\tint x=0,neg=1;char c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-')\tneg=-1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c))\tx=x*10+c-'0',c=getchar();\n\treturn x*neg;\n}\ninline void print(int x){\n\tif(x<0){\n\t\tputchar('-');\n\t\tprint(abs(x));\n\t\treturn;\n\t}\n\tif(x<=9)\tputchar(x+'0');\n\telse{\n\t\tprint(x/10);\n\t\tputchar(x%10+'0');\n\t}\n}\ninline int qpow(int x,int e,int _MOD){\n\tint ans=1;\n\twhile(e){\n\t\tif(e&1)\tans=ans*x%_MOD;\n\t\tx=x*x%_MOD;\n\t\te>>=1;\n\t}\n\treturn ans;\n}\nint n=read(),m=read();\nchar a[500005],b[500005],s[1000005];\nchar buf[1500005];\nint cnt=0,za[1500005],zb[1500005],z1[500005],z2[500005];\nstruct Fenwick_Tree{\n\tint bit[1500005];\n\tinline int lowbit(int x){\n\t\treturn x&(-x);\n\t}\n\tinline void add(int x,int val){\n\t\tx=max(x,1ll);\n\t\tfor(int i=x;i<=1000000;i+=lowbit(i))\tbit[i]+=val;\n\t}\n\tinline int query(int x){\n\t\tint ans=0;\n\t\tfor(int i=x;i;i-=lowbit(i))\tans+=bit[i];\n\t\treturn ans;\n\t}\n} t1,t2;\nsigned main(){\n\tscanf(\"%s%s%s\",a+1,b+1,s+1);\n\tfz(i,1,m-1)\tbuf[cnt++]=s[i];\n\tbuf[cnt++]='#';\n\tfz(i,1,n)\tbuf[cnt++]=a[i];\n\tint l=0,r=0;\n\tfor(int i=1;i<cnt;i++){\n\t\tif(i<=r)\tza[i]=min(za[i-l],r-i);\n\t\twhile(i+za[i]<cnt&&buf[za[i]]==buf[i+za[i]])\tza[i]++;\n\t\tif(i+za[i]>r){\n\t\t\tl=i;\n\t\t\tr=i+za[i];\n\t\t}\n\t}\n\tfill0(buf);cnt=0;\n\tfd(i,m,2)\tbuf[cnt++]=s[i];\n\tbuf[cnt++]='#';\n\tfd(i,n,1)\tbuf[cnt++]=b[i];\n\tl=0,r=0;\n\tfor(int i=1;i<cnt;i++){\n\t\tif(i<=r)\tzb[i]=min(zb[i-l],r-i);\n\t\twhile(i+zb[i]<cnt&&buf[zb[i]]==buf[i+zb[i]])\tzb[i]++;\n\t\tif(i+zb[i]>r){\n\t\t\tl=i;\n\t\t\tr=i+zb[i];\n\t\t}\n\t}\n\tfz(i,1,n)\tz1[i]=za[i+m-1];\n\tfz(i,1,n)\tz2[i]=zb[i+m-1];\n\treverse(z2+1,z2+n+1); \n\tint r2=1,ans=0;\n\tfz(l1,1,n){\n\t\twhile(r2<=min(l1+m-2,n)){\n\t\t\tt1.add(m-1-z2[r2],z2[r2]);\n\t\t\tt2.add(m-1-z2[r2],1);\n\t\t\tr2++;\n\t\t}\n\t\tans+=(z1[l1]-m+1)*t2.query(z1[l1])+t1.query(z1[l1]);\n\t\tt1.add(m-1-z2[l1],-z2[l1]);\n\t\tt2.add(m-1-z2[l1],-1);\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n\nUPD\uff1a2020.2.26\uff1a\u516c\u5f0f\u4e2d\u6709\u4e2a\u5730\u65b9\u5199\u9519\u4e86\uff0c\u5e94\u8be5\u662f $za_{l1}+zb_{r2}-m+1$",
        "postTime": 1582610458,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3CF1313E \u3010Concatenation with intersection\u3011"
    },
    {
        "content": "\u6211\u4eec\u53ef\u4ee5\u7528 Z \u7b97\u6cd5\u6c42\u51fa\u6765 A[]  \u548c S[] \u7684 LCP\uff0cB[] \u548c S[] \u7684 LCS\u3002\u590d\u6742\u5ea6  $O(N)$\u3002\n\n\u6216\u8005\u4f60\u559c\u6b22 SA/SAM  \u4e5f\u6ca1\u5173\u7cfb\uff0c\u968f\u4fbf\u641e\u641e\u5c31\u597d\u4e86\uff0c\u5e38\u6570\u5c0f\u70b9\u4e5f\u80fd\u8fc7\uff08\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u8981 $LCP + LCS \\geq M$ \u90a3\u4e48\u5c31\u662f\u4e00\u7ec4\u89e3\uff0c\u6240\u4ee5\u5047\u8bbe $LCP + LCS \\geq M$\u3002\n\n\u90a3\u4e48\u65b9\u6848\u6570\u662f $LCP  + LCS - M + 1$\u3002\n\n\u7136\u540e\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u4e24\u4e2a\u6709\u4ea4\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u626b\u63cf\u7ebf\u7ef4\u62a4\u4e00\u4e0b\u3002\n\n\u4f46\u662f\u6709\u4e00\u70b9\uff0c\u4e24\u4e2a\u4ea4\u96c6\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u4e48\u4e24\u4e2a\u5b57\u7b26\u4e32\u90fd\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u5982\u679c\u5168\u8986\u76d6\uff0c\u90a3\u4e48\u8981\u9884\u5148\u51cf\u63891\u3002\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <cstring>\n#include <algorithm>\n#define int long long\nconst int maxn = 1e6 + 61;\n\nstruct BIT {\n\tstd::vector <int> c, cnt;\n\tint n;\n\tBIT(int _n) { n = _n + 1; c.resize(n + 1), cnt.resize(n + 1); }\n\t\n\tint l(int x) { return x & -x; }\n\tvoid u(int x, int y) { for(; x <= n; x += l(x)) c[x] += y, cnt[x] += (y > 0) ? 1 : -1; }\n\tstd::pair <int, int> q(int x) { std::pair <int, int> a = {0, 0}; for(; x; x ^= l(x)) a.first += c[x], a.second += cnt[x]; return a; }\n};\n\nsigned main() {\n\tauto getZ = [&](char*s, int len) {\n\t\tstd::vector <int> Z(len + 1, 0);\n\t\tZ[1] = len;\n\t\tfor(int i = 2, l = 0, r = 0; i <= len; i++) {\n\t\t\tif(i < r)\n\t\t\t\tZ[i] = std::min(Z[i - l + 1], r - i + 1);\n\t\t\twhile(i + Z[i] <= len && s[i+ Z[i]] == s[1 + Z[i]])\n\t\t\t\t++Z[i];\n\t\t\tif(i + Z[i] - 1 > r)\n\t\t\t\tl = i, r = i + Z[i] - 1;\n\t\t}\n\t\treturn Z;\n\t};\n\t\n\tauto getP = [&](char*s, char*t, int n, int m) {\n\t\tstd::vector <int> Z = getZ(t, m), P(n + 1, 0);\n\t\tfor(int i = 1, l = 0, r = 0; i <= n; i++) {\n\t\t\tif(i < r)\n\t\t\t\tP[i] = std::min(Z[i - l + 1],  r - i + 1);\n\t\t\twhile(i + P[i] <= n && s[i + P[i]] == t[1 + P[i]])\n\t\t\t\t++P[i];\n\t\t\tif(i + P[i] - 1 > r)\n\t\t\t\tl = i, r = i + P[i] - 1;\n\t\t}\n\t\treturn P;\n\t};\n\t\n\tint n, m;\n\tstatic char a[maxn], b[maxn], s[maxn];\n\tscanf(\"%lld %lld\", &n, &m);\n\tscanf(\"%s\", a + 1), scanf(\"%s\", b + 1), scanf(\"%s\", s + 1);\n\tstd::vector <int> P = getP(a, s, n, m);\n\tstd::reverse(b + 1, b + n + 1);\n\tstd::reverse(s + 1, s + m + 1);\n\tstd::vector <int> Q = getP(b, s, n, m);\n\treverse(Q.begin() + 1, Q.end());\n\tBIT bit(m + 1);\n\tfor(int i = 1; i <= n; i++) {\n\t\tif(P[i] == m) --P[i];\n\t\tif(Q[i] == m) --Q[i];\n\t}\n\tlong long ans = 0;\n\tfor(int i = 1, j = 0; i <= n; i++)  {\n\t\twhile(j < n && j + 1 < i + m - 1) { ++j; if(Q[j]) bit.u(Q[j], Q[j]); }\n\t\tstd::pair <int, int> x = bit.q(m), y = bit.q(m - P[i] - 1);\n\t\tans += x.first - y.first - 1ll * (x.second - y.second) * (m - P[i] - 1);\n\t\tif(Q[i]) bit.u(Q[i], -Q[i]);\n\t}\n\tprintf(\"%lld\\n\", ans);\n}\n```",
        "postTime": 1588948058,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1313E \u3010Concatenation with intersection\u3011"
    },
    {
        "content": "exkmp \u6c42\u51fa $a$ \u7684\u6bcf\u4e2a\u540e\u7f00\u548c $s$ \u7684 LCP\uff0c\u4ee5\u53ca $b$ \u7684\u6bcf\u4e2a\u540e\u7f00\u548c $s^r$ \u7684 LCP\u3002\n\n\u7edf\u8ba1\u6bcf\u4e2a $a_i$ \u5f00\u5934\u7684\u65b9\u6848\u6570\uff0ctwo pointers \u5728 $b$ \u4e0a\u626b\u5230\u5bf9\u5e94\u7684\u533a\u95f4\uff0c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u8bbe $n,m$ \u540c\u9636\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log n)$\uff0c$\\log$ \u5728\u6811\u72b6\u6570\u7ec4\u4e0a\u800c\u4e0d\u5728\u6c42 LCP \u4e0a\uff0c\u5e38\u6570\u8f83\u5c0f\u3002\n\n```cpp\nconst int N = 1e6 + 7;\nint n, m, p[N], q[N], d[N], z[N];\nll c[N], ans;\nchar a[N], b[N], s[N];\n\ninline void Z(char *s, int n) {\n\tfor (int i = 1; i <= n; i++) z[i] = 0;\n\tz[1] = n;\n\tfor (int i = 2, l = 0, r = 0; i <= n; i++) {\n\t\tif (i <= r) z[i] = min(z[i-l+1], r - i + 1);\n\t\twhile (i + z[i] <= n && s[i+z[i]] == s[z[i]+1]) ++z[i];\n\t\tif (i + z[i] - 1 > r) l = i, r = i + z[i] - 1;\n\t}\n}\n\ninline void exkmp(char *s, int n, char *t, int m, int *p) {\n\tZ(t, m);\n\tfor (int i = 1; i <= n; i++) p[i] = 0;\n\tfor (int i = 1, l = 0, r = 0; i <= n; i++) {\n\t\tif (i <= r) p[i] = min(z[i-l+1], r - i + 1);\n\t\twhile (i + p[i] <= n && s[i+p[i]] == t[p[i]+1]) ++p[i];\n\t\tif (i + p[i] - 1 > r) l = i, r = i + p[i] - 1;\n\t}\n}\n\ninline void add(int x, int k) {\n\tif (!x) return;\n\twhile (x <= m) c[x] += k, d[x] += k > 0 ? 1 : -1, x += x & -x;\n}\n\ninline pair<ll, int> ask(int x) {\n\tll k = 0;\n\tint p = 0;\n\twhile (x) k += c[x], p += d[x], x -= x & -x;\n\treturn mp(k, p);\n}\n\nint main() {\n\trd(n), rd(m);\n\trds(a, n), rds(b, n), rds(s, m);\n\texkmp(a, n, s, m, p);\n\treverse(b + 1, b + n + 1);\n\treverse(s + 1, s + m + 1);\n\texkmp(b, n, s, m, q);\n\treverse(q + 1, q + n + 1);\n\tfor (int i = 1, j = 0; i <= n; i++) {\n\t\twhile (j + 1 <= n && j + 1 < i + m - 1) {\n\t\t\tif (q[++j] == m) --q[j];\n\t\t\tadd(q[j], q[j]);\n\t\t}\n\t\tif (p[i] == m) --p[i];\n\t\tpair<ll, int> x = ask(m), y = ask(m - p[i] - 1);\n\t\tans += x.fi - y.fi - 1ll * (x.se - y.se) * (m - p[i] - 1);\n\t\tadd(q[i], -q[i]);\n\t}\n\tprint(ans);\n\treturn 0;\n}\n```",
        "postTime": 1582695772,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1313E \u3010Concatenation with intersection\u3011"
    },
    {
        "content": "D \u9898 fst\uff0c\u81ea\u95ed\u4e86\u3002\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u4f60\u4e24\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u7b26\u4e32 $a,b$ \u548c\u4e00\u4e2a\u957f\u5ea6\u4e3a $m$ \u7684\u5b57\u7b26\u4e32 $s$\uff0c\u4f60\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u9009\u62e9\u4e00\u4e2a $a[l_1,r_1]$\uff0c\u5728\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4e32\u4e2d\u9009\u62e9\u4e00\u4e2a $b[l_2,r_2]$\uff0c\u4f7f\u5f97 $a[l_1,r_1]+b[l_2,r_2]=s$\uff0c\u5e76\u4e14\u533a\u95f4 $[l_1,r_1]$ \u548c $[l_2,r_2]$ \u6709\u4ea4\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n## \u6570\u636e\u8303\u56f4\n\n$1\\le n\\le 500000,1\\le m\\le 2n$\n\n## \u89e3\u9898\u8fc7\u7a0b\n\n\u6211\u4eec\u8bbe $s[i:]$ \u8868\u793a $s$ \u8fd9\u4e2a\u5b57\u7b26\u4e32\u4ece $s[i]$ \u5f00\u59cb\u7684\u540e\u7f00\uff0c$s[:i]$ \u8868\u793a\u5230 $s[i]$ \u4e3a\u6b62\u7684\u524d\u7f00\u3002 \n\n\u9996\u5148\u8003\u8651\u679a\u4e3e $l_1$ \u548c $r_2$\uff0c\u5219\u5982\u679c $l_1+m-1<=r_2$ \u5c31\u4e0d\u53ef\u80fd\uff08\u56e0\u4e3a\u6ca1\u6cd5\u51fa\u73b0\u4ea4\u70b9\uff09\uff0c\u5426\u5219\u8003\u8651\u6c42\u51fa\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u65b9\u6848\u6570\u662f\u591a\u5c11\u3002\n\n\u6c42\u51fa $a[l_1:]$ \u548c $s$ \u7684\u6700\u957f\u516c\u5171\u524d\u7f00\u7684\u957f\u5ea6 $f(l_1)$ \u4ee5\u53ca $b[:r_2]$ \u548c $s$ \u7684\u6700\u957f\u516c\u5171\u540e\u7f00\u957f\u5ea6 $g(r_2)$\uff0c\u5219\u65b9\u6848\u6570\u5373\u4e3a $\\max(0,f(l_1)+g(r_2)-m+1)$\uff08\u53ef\u4ee5\u679a\u4e3e\u7b2c\u4e00\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\uff09\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u7b54\u6848\u5373\u4e3a\u6240\u6709\u6ee1\u8db3\u4e0b\u5217\u6761\u4ef6\u7684 $f(i)+g(j)-m+1$ \u4e4b\u548c\uff1a\n\n- $i\\le j$\n- $i+m-1>j$\n- $f(i)>0,g(j)>0$\n- $f(i)+g(j)\\ge m$\n\n\u5bf9\u7b2c\u4e8c\u4e2a\u9650\u5236\u6761\u4ef6\u8fdb\u884c\u5bb9\u65a5\uff0c\u5148\u52a0\u4e0a\u6240\u6709\u6ee1\u8db3\u4e00\u4e09\u56db\u7684\uff0c\u518d\u51cf\u53bb\u6ee1\u8db3\u4e00\u4e09\u56db\u4e14 $j\\ge i+m-1$ \u7684\u3002\n\n\u6211\u4eec\u4ece\u540e\u5230\u524d\u679a\u4e3e $i$\uff0c\u5219\u65e0\u8bba\u662f\u5bb9\u65a5\u7684\u7b2c\u4e00\u6b65\u8fd8\u662f\u7b2c\u4e8c\u6b65\uff0c$j$ \u7684\u53d6\u503c\u8303\u56f4\u90fd\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u540e\u7f00\uff0c\u53ef\u4ee5\u987a\u6b21\u52a0\u5165\u3002\n\n\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\u7ef4\u62a4\u4e00\u4e2a $j$ \u7684\u96c6\u5408\uff0c\u652f\u6301\u52a8\u6001\u63d2\u5165 $j$ \u4ee5\u53ca\u5bf9\u4e8e\u4e00\u4e2a $i$\uff0c\u67e5\u8be2\u6240\u6709\u6ee1\u8db3 $g(j)\\ge \\max(1,m-f(i))$ \u7684 $f(i)+g(j)-m+1$ \u4e4b\u548c\u3002\n\n\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5b9e\u73b0\u3002\u6211\u4eec\u5f00\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u5206\u522b\u7ef4\u62a4 $j$ \u7684\u6570\u91cf $A$ \u4ee5\u53ca\u6ee1\u8db3\u6761\u4ef6\u7684 $g(j)$ \u4e4b\u548c $B$\uff0c\u5219\u7b54\u6848\u5373\u4e3a $(f(i)-m+1)*A-B$\u3002\n\n\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u4f55\u5feb\u901f\u6c42\u51fa\u6240\u6709\u7684 $f(i)$ \u548c $g(j)$\u3002\n\n\u4e00\u4e2a\u601d\u8def\u662f\u8dd1\u4e24\u904d SA\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\uff0c\u4f46\u662f\u7531\u4e8e\u6bcf\u4e00\u6b21\u5b57\u7b26\u4e32\u957f\u5ea6\u53ef\u4ee5\u8fbe\u5230 $1.5\\times 10^6$\uff0c\u6709\u53ef\u80fd\u4f1a TLE\u3002\n\n\u66f4\u52a0\u4f18\u79c0\u7684\u89e3\u6cd5\u662f\u8dd1\u4e24\u904d\u6269\u5c55 KMP\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log n)$\uff0c\u7531\u4e8e $\\log$ \u662f\u6811\u72b6\u6570\u7ec4\u6240\u4ee5\u5e38\u6570\u591f\u5c0f\uff0c\u53ef\u4ee5 AC\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#define ll long long\nusing namespace std;\nchar a[500005],b[500005],s[1000005],ss[1500005];\nint n,m,z[1500005],pre[500005],suf[500005],c2[1500005];\nll c[1500005],ans;//c\u8bb0\u5f55\u7684\u662fg(j)\u4e4b\u548c\uff0cc2\u8bb0\u5f55\u7684\u662f\u53ef\u884cj\u7684\u6570\u91cf\u3002\nvoid add(int p,ll v)\n{\n\tp++;\n\twhile(p<=m+1)\n\t{\n\t\tc[p]+=v;\n\t\tc2[p]++;\n\t\tp+=p^(p&(p-1));\n\t}\n}\npair<ll,int>sum(int p)//pair\u4e2d\u7684\u7b2c\u4e00\u4e2a\u662fg(j)\u4e4b\u548c\uff0c\u7b2c\u4e8c\u4e2a\u662fj\u7684\u6570\u91cf\n{\n\tp++;\n\tll ans1=0;\n\tint ans2=0;\n\twhile(p)\n\t{\n\t\tans1+=c[p];\n\t\tans2+=c2[p];\n\t\tp&=p-1;\n\t}\n\treturn make_pair(ans1,ans2);\n}\npair<ll,int>sum(int l,int r)\n{\n\tl=max(1,l);\n\tr=min(m,r);\n\tif(l>r)return make_pair(0,0);\n\tpair<ll,int>s1=sum(r);\n\tpair<ll,int>s2=sum(l-1);\n\treturn make_pair(s1.first-s2.first,s1.second-s2.second);\n}\nvoid Z(char*s,int n)//\u6269\u5c55KMP\n{\n\tz[1]=n;\n\tint l=1,r=1;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tif(r<i)\n\t\t{\n\t\t\tl=r=i;\n\t\t\twhile(r<=n&&s[r]==s[r-l+1])r++;\n\t\t\tz[i]=r-l;\n\t\t\tr--;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(z[i-l+1]<r-i+1)z[i]=z[i-l+1];\n\t\t\telse\n\t\t\t{\n\t\t\t\tl=i;\n\t\t\t\twhile(r<=n&&s[r]==s[r-l+1])r++;\n\t\t\t\tz[i]=r-l;\n\t\t\t\tr--;\n\t\t\t}\n\t\t}\n\t}\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tscanf(\"%s%s%s\",a+1,b+1,s+1);\n\tfor(int i=1;i<=m;i++)ss[i]=s[i];\n\tfor(int i=1;i<=n;i++)ss[i+m]=a[i];\n\tZ(ss,n+m);//\u7b2c\u4e00\u6b21\u6269\u5c55KMP\u6c42\u51fa\u6240\u6709\u7684f\uff08\u4e5f\u5c31\u662fpre\uff09\n\tfor(int i=1;i<=n;i++)pre[i]=min(m-1,z[i+m]);\n\tfor(int i=1;i<=m;i++)ss[i]=s[m-i+1];\n\tfor(int i=1;i<=n;i++)ss[i+m]=b[n-i+1];\n\tZ(ss,n+m);//\u7b2c\u4e8c\u6b21\u6269\u5c55KMP\u6c42\u51fa\u6240\u6709\u7684g\uff08\u4e5f\u5c31\u662fsuf\uff09\n\tfor(int i=1;i<=n;i++)suf[n-i+1]=min(m-1,z[i+m]);\n\tfor(int i=n;i>=1;i--)//\u5bb9\u65a5\u7b2c\u4e00\u6b65\n\t{\n\t\tadd(suf[i],suf[i]);\n\t\tif(pre[i]==0)continue;\n\t\tpair<ll,int>res=sum(m-pre[i],m);\n\t\tans+=res.first+(pre[i]-m+1ll)*res.second;\n\t}\n\tmemset(c,0,sizeof(c));\n\tmemset(c2,0,sizeof(c2));\n\tfor(int i=n;i>=1;i--)//\u5bb9\u65a5\u7b2c\u4e8c\u6b65\n\t{\n\t\tif(i+m-2<=n)add(suf[i+m-1],suf[i+m-1]);\n\t\tif(pre[i]==0)continue;\n\t\tpair<ll,int>res=sum(m-pre[i],m);\n\t\tans-=res.first+(pre[i]-m+1ll)*res.second;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1582678044,
        "uid": 54214,
        "name": "wucstdio",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1313E \u3010Concatenation with intersection\u3011"
    },
    {
        "content": "\u8003\u8651\u8fd9\u4e2a $l_1$ \u4e00\u5b9a\u662f $s$ \u7684\u5f00\u5934\uff0c$r_2$ \u4e00\u5b9a\u662f $t$ \u7684\u7ed3\u5c3e\uff0c\u90a3\u4e48\u5c31\u8003\u8651\u5047\u5982\u56fa\u5b9a\u4e86 $l_1,r_2$ \u4e4b\u540e\u600e\u4e48\u8ba1\u7b97\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u4e00\u4e2a\u6cb3\u72f8\u7684\u60f3\u6cd5\u662f\uff0c\u56fa\u5b9a $l_1$ \u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 exkmp \u6c42\u51fa $\\operatorname{LCP}(a[l_1:],s)$\uff0c\u5c31\u77e5\u9053 $r_1$ \u80fd\u843d\u5728 $l_1$ \u7684 Z-box \u91cc\u3002\u540c\u7406\u4e5f\u77e5\u9053 $l_2$ \u80fd\u843d\u5728 $r_2$ \u7684 Z-box \u91cc\u3002\n\n\u5047\u8bbe $\\operatorname{LCP}(a[l_1:],s)=p,\\operatorname{LCS}(b[:r_2],s)=q$\uff0c$a$ \u9009\u4e86 $x$ \u4e2a\uff0c\u90a3\u4e48 $b$ \u9009 $m-x$ \u4e2a\uff0c\u5219 $[l_1,r_1]=[l_1,l_1+x-1],[l_2,r_2]=[r_2-(m-x)+1,r_2]$\uff0e\n\n\u5b83\u4fe9\u6709\u4ea4\u5f53\u4e14\u4ec5\u5f53 $r_1\\geq l_2$ \u4e14 $r_2\\geq l_1$\uff0c\u5316\u7b80\u540e\u53ef\u5f97 $l_1\\leq r_2\\leq l_1+m-2$\uff0c\u8fd9\u662f\u7b2c\u4e00\u7ef4\u9650\u5236\u3002\n\n\u7136\u540e\u518d\u8003\u8651\u6ee1\u8db3\u6761\u4ef6\u7684 $x$ \u6570\u91cf\uff0c$1\\leq x\\leq p,1\\leq m-x\\leq q$\uff0c\u4e5f\u5c31\u662f $\\max(1,m-q)\\leq x\\leq \\min(p,m-1)$\uff0e\n\n\u7136\u540e\u6240\u6709\u7684 $p,q$ \u90fd\u548c $m-1$ \u53d6\u4e2a $\\min$\uff0c\u8fd9\u6837\u7b26\u5408\u6761\u4ef6\u7684 $x$ \u7684\u6570\u91cf\u5c31\u662f $p-(m-q)+1$\uff0c\u800c\u4e14\u8981\u6ee1\u8db3 $p\\geq m-q$\uff0c\u8fd9\u662f\u7b2c\u4e8c\u7ef4\u9650\u5236\u3002\n\n\u4e8e\u662f\u53d8\u6210\u4e00\u4e2a\u4e8c\u7ef4\u6570\u70b9\u95ee\u9898\u3002\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef pair<int,ll>pil;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntypedef vector<pil>vpil;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x,T2& ...y){read(x);read(y...);}\nconst int mod=998244353;\ninline void cadd(int &x,int y){x=(x+y>=mod)?(x+y-mod):(x+y);}\ninline void cdel(int &x,int y){x=(x-y<0)?(x-y+mod):(x-y);}\ninline int add(int x,int y){return (x+y>=mod)?(x+y-mod):(x+y);}\ninline int del(int x,int y){return (x-y<0)?(x-y+mod):(x-y);}\ninline int lowbit(int x){\n\treturn x&(-x);\n}\nconst int N=1000100;\nint n,m,z[N],p[N],q[N];\nchar a[N],b[N],s[N];\nll ans;\nstruct Tree{\n\tll tree[N];\n\tvoid modify(int x,ll v){++x;for(;x<=n+1;x+=lowbit(x))tree[x]+=v;}\n\tll query(int x){++x;ll s=0;for(;x;x-=lowbit(x))s+=tree[x];return s;}\n\tll query(int l,int r){return query(r)-query(l-1);}\n}tr1,tr2;\nsigned main(){\n\t#ifdef do_while_true\n//\t\tassert(freopen(\"data.in\",\"r\",stdin));\n//\t\tassert(freopen(\"data.out\",\"w\",stdout));\n\t#endif\n\tread(n,m);\n\tscanf(\"%s%s%s\",a+1,b+1,s+1);\n\tfor(int i=2,l=0,r=0;i<=m;i++){\n\t\tif(i<=r)z[i]=min(z[i-l+1],r-i+1);\n\t\telse z[i]=0;\n\t\twhile(i+z[i]<=m && s[z[i]+1]==s[i+z[i]])++z[i];\n\t\tif(i+z[i]-1>r)r=i+z[i]-1,l=i;\n\t}\n\tfor(int i=1,l=0,r=0;i<=n;i++){\n\t\tif(i<=r)p[i]=min(z[i-l+1],r-i+1);\n\t\telse p[i]=0;\n\t\twhile(p[i]<m && i+p[i]<=n && s[p[i]+1]==a[i+p[i]])++p[i];\n\t\tif(i+p[i]-1>r)r=i+p[i]-1,l=i;\n\t}\n\treverse(b+1,b+n+1);\n\treverse(s+1,s+m+1);\n\tfor(int i=2,l=0,r=0;i<=m;i++){\n\t\tif(i<=r)z[i]=min(z[i-l+1],r-i+1);\n\t\telse z[i]=0;\n\t\twhile(i+z[i]<=m && s[z[i]+1]==s[i+z[i]])++z[i];\n\t\tif(i+z[i]-1>r)r=i+z[i]-1,l=i;\n\t}\n\tfor(int i=1,l=0,r=0;i<=n;i++){\n\t\tif(i<=r)q[i]=min(z[i-l+1],r-i+1);\n\t\telse q[i]=0;\n\t\twhile(q[i]<m && i+q[i]<=n && s[q[i]+1]==b[i+q[i]])++q[i];\n\t\tif(i+q[i]-1>r)r=i+q[i]-1,l=i;\n\t}\t\n\treverse(q+1,q+n+1);\n\tfor(int i=1;i<=n;i++)cmin(p[i],m-1),cmin(q[i],m-1);\n\tfor(int i=n;i;i--){\n\t\ttr1.modify(m-q[i],1);\n\t\ttr2.modify(m-q[i],-m+q[i]+1);\n\t\tans+=tr1.query(p[i])*p[i];\n\t\tans+=tr2.query(p[i]);\n\t\tif(i-m+1>=1){\n\t\t\tint l=i-m+1;\n\t\t\tans-=tr1.query(p[l])*p[l];\n\t\t\tans-=tr2.query(p[l]);\n\t\t}\n\t}\n\tcout << ans << '\\n';\n    #ifdef do_while_true\n\t\tcerr<<'\\n'<<\"Time:\"<<1.0*clock()/CLOCKS_PER_SEC*1000<<\" ms\"<<'\\n';\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1665104169,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dCodeforces 1313E Concatenation with intersection"
    },
    {
        "content": ">### [\u6d1b\u8c37\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://www.luogu.org/problem/CF1313E) & [CodeForces\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://codeforces.com/contest/1313/problem/E)\n\n>\u7ed9\u5b9a$3$\u4e2a\u5b57\u7b26\u4e32$a,b,c,|a|=|b|=n,|c|=m$\uff0c\u6c42\u6ee1\u8db3\u4ee5\u4e0b\u5168\u90e8\u6761\u4ef6\u7684\u6709\u5e8f\u533a\u95f4\u5bf9$([l1,r1],[l2,r2])$\u7684\u4e2a\u6570\uff1a\n\n>1. $[l1,r1]\\cap[l2,r2]\\neq\\varnothing$\uff1b\n>1. $a_{l1\\sim r1}+b_{l2\\sim r2}=c$\u3002\n\n>$n\\in\\left[1,5\\times10^5\\right],m\\in[2,2n]$\u3002\n\n$c$\u7531$a,b$\u5404\u4e00\u4e2a\u5b50\u4e32\u62fc\u63a5\u800c\u6210\uff0c\u4e0d\u96be\u60f3\u5230\u4e24\u9762\u5939\u51fb\u2014\u2014\u4ece$a_{l1}$\u5f80\u540e\u4e0e$c$\u7684\u524d\u7f00\u5339\u914d\u3001\u4ece$b_{r2}$\u5f80\u524d\u4e0e$c$\u7684\u540e\u7f00\u5339\u914d\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa$2$\u4e2a\u6570\u7ec4$lcP:lcP_i=\\max\\limits_{a_{i\\sim i+j-1}=c_{1\\sim j}}\\{j\\},Lcs:Lcs_i=\\max\\limits_{b_{i-j+1\\sim i}=c_{m-j+1\\sim m}}\\{j\\}$\uff0c\u5bf9$c+\\texttt!+a,c^\\mathrm r+\\texttt!+b^\\mathrm r$\u8fd9$2$\u4e2a\u5b57\u7b26\u4e32\u5404\u8dd1\u4e00\u904dZ\u7b97\u6cd5\u5373\u53ef\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u56fa\u5b9a\u4f4f\u4e86$l1,r2$\u3002\u8bbe\u4ece$l1$\u5f80\u540e\u5ef6\u4f38\u4e86$x$\u4f4d\uff0c\u4ece$r2$\u5f80\u524d\u81ea\u7136\u5c31\u5ef6\u4f38\u4e86$m-x$\u4f4d\uff0c\u4e8e\u662f$r1=l1+x-1,l2=r2-m+x+1$\u3002\n\n\u8003\u8651\u6ee1\u8db3\u9898\u76ee\u4e2d\u7684\u6761\u4ef6$1$\u7684\u5145\u8981\u6761\u4ef6\u3002\u6ee1\u8db3\u6761\u4ef6$1$\u5f53\u4e14\u4ec5\u5f53$[l1,r1]\\cap[l2,r2]=[l1,l1+x-1]\\cap[r2-m+x+1,r2]=[\\max(l1,r2-m+x+1),\\min(l1+x-1,r2)]\\neq\\varnothing$\uff0c\u5373$\\max(l1,r2-m+x+1)\\leq\\min(l1+x-1,r2)$\uff0c\u5373$\\begin{cases}l1\\leq l1+x-1\\\\l1\\leq r2\\\\r2-m+x+1\\leq l1+x-1\\\\r2-m+x+1\\leq r2\\end{cases}$\uff0c\u5373$\\begin{cases}x\\in[1,m-1]\\\\r2\\in[l1,l1+m-2]\\end{cases}$\u3002\n\n\u518d\u8003\u8651\u6ee1\u8db3\u6761\u4ef6$2$\u7684\u5145\u8981\u6761\u4ef6\u3002\u6ee1\u8db3\u6761\u4ef6$2$\u5f53\u4e14\u4ec5\u5f53$\\begin{cases}x\\leq lcP_{l1}\\\\m-x\\leq Lcs_{r2}\\end{cases}$\uff0c\u5373$x\\in[m-Lcs_{r2},lcP_{l1}]$\u3002\n\n\u7efc\u4e0a\uff0c\u82e5\u5df2\u77e5$l1,r2,x$\uff0c\u90a3\u4e48\u6ee1\u8db3\u9898\u76ee\u4e2d\u7684\u6240\u6709\u6761\u4ef6\u5f53\u4e14\u4ec5\u5f53$\\begin{cases}r2\\in[l1,l1+m-2]\\\\x\\in[\\max(1,m-Lcs_{r2}),\\min(m-1,lcP_{l1})]\\end{cases}$\u3002\u663e\u7136$\\forall l1\\in[1,n],\\forall r2\\in[l1,\\min(n,l1+m-2)]$\uff0c$r2$\u5bf9\u7b54\u6848\u8d21\u732e\u4e3a$\\max(1,\\min(m-1,lcP_{l1})-\\max(1,m-Lcs_{r2})+1)$\u3002\u8fd9\u91cc\u9762\u6709\u4e2a$\\max$\uff0c\u6bd4\u8f83\u8ba8\u538c\uff0c\u6211\u4eec\u628a\u5b83\u5206\u6210$\\min(m-1,lcP_{l1})-\\max(1,m-Lcs_{r2})+1\\geq1$\u548c$\\min(m-1,lcP_{l1})-\\max(1,m-Lcs_{r2})+1<1$\u8fd9$2$\u79cd\u60c5\u51b5\u3002\u5bf9\u4e8e\u540e\u8005\uff0c\u663e\u7136\u8d21\u732e\u4e3a$0$\uff0c\u65e0\u9700\u8003\u8651\uff1b\u5bf9\u4e8e\u524d\u8005\uff0c\u5373$\\max(1,m-Lcs_{r2})\\leq \\min(m-1,lcP_{l1})$\uff0c\u8d21\u732e\u4e3a$\\min(m-1,lcP_{l1})-\\max(1,m-Lcs_{r2})+1$\u3002\n\n\u6240\u4ee5\u7b54\u6848\u663e\u7136\u4e3a$\\sum\\limits_{l1=1}^n\\sum\\limits_{r2\\in[l1,\\min(n,l1+m-2)],\\max(1,m-Lcs_{r2})\\leq\\min(m-1,lcP_{l1})}(\\min(m-1,lcP_{l1})-\\max(1,m-Lcs_{r2})+1)$\u3002\u7531\u4e8e\u5f53$l1$\u5355\u8c03\u9012\u589e\u65f6\uff0c$r2$\u6240\u5728\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u548c\u53f3\u7aef\u70b9\u4e5f\u540c\u65f6\u5355\u8c03\u9012\u589e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528two-pointers\u7ef4\u62a4\u3002\u4e0d\u59a8\u5728\u503c\u57df\u4e0a\u5efa\u4e00\u4e2aBIT\uff0c\u7136\u540e\u4ece\u5de6\u5f80\u53f3\u679a\u4e3e$l1$\uff0c\u6bcf\u6b21\u6dfb\u52a0\u3001\u5220\u9664\u5404$0\\sim1$\u4e2a$\\max(1,m-Lcs_{r2})$\u3002\u7b54\u6848\u4e2d\u7684\u6c42\u548c\u5f0f\u53ef\u4ee5\u5206\u6210\u5206\u522b\u5173\u4e8e$l1,r2$\u7684$2$\u90e8\u5206$\\min(m-1,lcP_{l1})+1,-\\max(1,m-Lcs_{r2})$\uff0c\u5bf9$2$\u90e8\u5206\u5206\u522b\u6c42\u548c\uff0c\u663e\u7136BIT\u4e0d\u4ec5\u8981\u5b9e\u73b0\u503c\u57df\u4e0a\u7684\u533a\u95f4\u6c42\u548c\uff0c\u8fd8\u8981\u5b9e\u73b0\u503c\u57df\u4e0a\u7684\u533a\u95f4\u8ba1\u6570\u3002\u679a\u4e3e\u5230\u6bcf\u4e2a$l1$\uff0c\u8bbe\u6dfb\u52a0\u3001\u5220\u9664\u5b8c$\\max(1,m-Lcs_{r2})$\u540e\uff0c\u503c\u57df\u4e0a\u7684\u533a\u95f4$[1,\\min(m-1,lcP_{l1})]$\u5185\u6c42\u548c\u7684\u7ed3\u679c\u4e3a$sum$\uff0c\u8ba1\u6570\u7684\u7ed3\u679c\u4e3a$cnt$\uff0c\u5219\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f$cnt\\cdot(\\min(m-1,lcP_{l1})+1)+sum$\u3002\u54e6\u5bf9\u4e86\uff0c\u522b\u5fd8\u4e86\u5728$l1=1$\u7684\u65f6\u5019\u628a$\\forall r2\\in[1,\\min(n,m-1)],\\max(1,m-Lcs_{r2})$\u5168\u90e8\u6dfb\u52a0\u5230BIT\u91cc\u54e6\uff01\n\n$\\forall r2\\in[1,n]$\uff0c$\\max(1,m-Lcs_{r2})$\u6700\u591a\u4f1a\u88ab\u6dfb\u52a0\u3001\u5220\u9664\u5404$1$\u6b21\uff0c\u6bcf\u6b21$\\mathrm O(\\log_2m)$\uff0c\u6240\u4ee5\u590d\u6742\u5ea6$\\mathrm O(n\\log_2m)$\u3002\u518d\u52a0\u4e0a\u4e4b\u524d$\\mathrm O(n+m)$\u7684Z\u7b97\u6cd5\uff0c\u603b\u590d\u6742\u5ea6$\\mathrm O(m+n\\log_2m)$\u3002\n\n\u4e0a\u4ee3\u7801\uff01\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long//\u7b54\u6848\u4f1a\u7206int \nint lowbit(int x){return x&-x;} \nconst int N=500000,M=1000000;\nint n/*|a|=|b|*/,m/*|c|*/; \nchar a[N+5],b[N+5],c[M+5];//3\u4e2a\u5b57\u7b26\u4e32 \nint lcP[N+1],Lcs[N+1];//lcP[i],Lcs[i]\u5404\u8868\u793a\u4ecea,b\u7684\u7b2ci\u4f4d\u5f00\u59cb\u5411\u540e\u3001\u5411\u524d\u6700\u591a\u80fd\u4e0ec\u7684\u524d\u7f00\u3001\u540e\u7f00\u5339\u914d\u7684\u4f4d\u6570 \nint s;/*|d|*/ \nchar d[N+M+5];//\u4e34\u65f6\u5b57\u7b26\u4e32 \nvoid con(char x[],char y[]){//\u4ee4d=x+'!'+y \n\ts=0;\n\tfor(int i=1;i<=m;i++)d[++s]=x[i];\n\td[++s]='!';\n\tfor(int i=1;i<=n;i++)d[++s]=y[i];\n}\nint z[N+M+1];//z\u6570\u7ec4 \nvoid z_init(){//Z\u7b97\u6cd5 \n\tz[1]=s;\n\tint zl=0,zr=0;\n\tfor(int i=2;i<=s;i++)\n\t\tif(zr<i){\n\t\t\tz[i]=0;\n\t\t\twhile(i+z[i]<=s&&d[i+z[i]]==d[1+z[i]])z[i]++;\n\t\t\tif(z[i])zl=i,zr=i+z[i]-1;\n\t\t}\n\t\telse if(i+z[i-zl+1]<=zr)z[i]=z[i-zl+1];\n\t\telse{\n\t\t\tz[i]=zr-i+1;\n\t\t\twhile(i+z[i]<=s&&d[i+z[i]]==d[1+z[i]])z[i]++;\n\t\t\tzl=i;zr=i+z[i]-1;\n\t\t}\n}\nstruct bitree{//BIT \n\tint sum[M+1]/*\u548c*/,cnt[M+1]/*\u8ba1\u6570*/;\n\tvoid init(){\n\t\tmemset(sum,0,sizeof(sum));\n\t\tmemset(cnt,0,sizeof(cnt));\n\t}\n\tvoid add(int v){//\u6dfb\u52a0 \n\t\tint x=v;\n\t    while(x<=n)sum[x]-=v,cnt[x]++,x+=lowbit(x);\n\t}\n\tvoid del(int v){//\u5220\u9664 \n\t\tint x=v;\n\t\twhile(x<=n)sum[x]+=v,cnt[x]--,x+=lowbit(x);\n\t}\n\tint Sum(int x){//\u6c42\u524d\u7f00\u548c \n\t\tint res=0;\n\t\twhile(x)res+=sum[x],x-=lowbit(x);\n\t\treturn res;\n\t}\n\tint Cnt(int x){//\u6c42\u524d\u7f00\u8ba1\u6570 \n\t\tint res=0;\n\t\twhile(x)res+=cnt[x],x-=lowbit(x);\n\t\treturn res;\n\t}\n}bit;\nsigned main(){\n\tscanf(\"%lld%lld%s%s%s\",&n,&m,a+1,b+1,c+1);\n\tcon(c,a);\n\tz_init();\n\tfor(int i=1;i<=n;i++)lcP[i]=z[m+1+i];//\u6c42lcP \n\treverse(b+1,b+n+1);reverse(c+1,c+m+1);con(c,b);\n\tz_init();\n\tfor(int i=1;i<=n;i++)Lcs[i]=z[m+1+(n-i+1)];//\u6c42Lcs \n//\tfor(int i=1;i<=n;i++)printf(\"%lld %lld\\n\",lcP[i],Lcs[i]);\n\tint ans=0;\n\tbit.init();\n\tfor(int i=1;i<=min(n,m-1);i++)bit.add(max(1ll,m-Lcs[i]));//\u5728l1=1\u65f6\u9884\u5148\u6dfb\u52a0r2 in [1,min(n,m-1)]\n\tfor(int i=1;i<=n;i++){\n\t\tif(i>1)bit.del(max(1ll,m-Lcs[i-1]))/*\u5220\u9664r2=i-1*/,i+m-2<=n&&(bit.add(max(1ll,m-Lcs[i+m-2])),0)/*\u6dfb\u52a0r2=i+m-2*/;\n\t\tans+=(min(m-1,lcP[i])+1)*bit.Cnt(min(m-1,lcP[i]))+bit.Sum(min(m-1,lcP[i]));//\u8d21\u732e\u7b54\u6848 \n//\t\tcout<<ans<<\"\\n\";\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n\n\u6700\u540e\u8bf4\u53e5\u95f2\u8bdd\uff0c\u4f60\u4eec\u77e5\u9053\u4e3a\u4ec0\u4e48\u8fd9\u9898\u96be\u5ea6\u8fd9\u4e48\u9ad8\u5417\uff1f\n\n~~\u56e0\u4e3a\u8fd9\u573a\u6bd4\u8d5b\u7684D\u975e\u5e38\u96be~~",
        "postTime": 1583129726,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "CodeForces 1313E - Concatenation with intersection"
    }
]