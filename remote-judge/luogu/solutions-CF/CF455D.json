[
    {
        "content": "\u770b\u5230\u697c\u4e0a\u6709\u5e73\u8861\u6811\u505a\u6cd5\uff0c\u53ef\u60dc\u6211\u5e73\u8861\u6811\u4e0d\u4f1a\u51e0\u4e2a\uff0c\u7528\u5f97\u4e5f\u4e0d\u719f ![](https://cdn.luogu.com.cn/upload/pic/62227.png)\n\n\u5176\u5b9e\u7528\u5206\u5757\u5957\u4e00\u4e0b\u8fd8\u662f\u6bd4\u8f83\u597d\u5199\u7684\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u5757\u7ef4\u62a4\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u7528\u6765\u8fdb\u884c\u652f\u6301\u53f3\u79fb\u64cd\u4f5c\n\n\u540c\u65f6\u7ef4\u62a4\u4e00\u4e2a\u6876\uff0c\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u5757\u5185\u4e0d\u540c\u503c\u7684\u4e2a\u6570\uff0c\u4fbf\u4e8e\u67e5\u8be2\n\n\u7136\u540e\u76f4\u63a5\u64cd\u4f5c\u5c31\u884c\u4e86\uff0c\u7ec6\u8282\u4e5f\u4e0d\u7b97\u5f88\u591a\uff0c\u6ce8\u610f\u7279\u6b8a\u5904\u7406 $l$ \u548c $r$ \u90fd\u5728\u540c\u4e00\u4e2a\u5757\u5185\u65f6\u7684\u60c5\u51b5\uff0c\u800c\u4e14\u53cc\u7aef\u961f\u5217\u53ef\u4ee5\u50cf $vector$ \u4e00\u6837\u8fdb\u884c\u4e0b\u6807\u67e5\u8be2\uff0c\u66f4\u52a0\u65b9\u4fbf\u4e86\u6211\u4eec\u7684\u64cd\u4f5c\n\n```c++\n#include <cstdio>\n#include <algorithm>\n#include <deque>\n#include <cmath>\n\n#define rint register int \n\nusing namespace std;\n\nconst int maxn = 1e5 + 50;\n\ninline int read () {\n\trint x = 0, w = 1;\n\tchar ch = getchar ();\n\tfor (; ch < '0' || ch > '9'; ch = getchar ()) if (ch == '-') w = -1;\n\tfor (; ch >= '0' && ch <= '9'; ch = getchar ()) x = x * 10 + ch - '0';\n\treturn x * w;\n}\n\nint n, m, S, a[maxn], st[maxn];\nint bel[maxn], L[maxn], R[maxn], buc[320][maxn];\ndeque <int> q[320];\n\ninline void Init () {\n\tS = sqrt (n);\n\tfor (rint i = 1; i <= n; i ++) a[i] = read();\n\tfor (rint i = 1; i <= n; i ++) {\n\t\tbel[i] = (i - 1) / S + 1, R[bel[i]] = i;\n\t\tbuc[bel[i]][a[i]] ++, q[bel[i]].push_back (a[i]);\n\t\tif (! L[bel[i]]) L[bel[i]] = i;\n\t}\n}\n\ninline void Modify (rint l, rint r, rint top = 0) {\n\tif (bel[l] == bel[r]) {\n\t\trint now = bel[l];\n\t\tl -= L[now], r -= L[now], st[++ top] = q[now][r];\n\t\tfor (rint i = l; i < r; i ++) st[++ top] = q[now][i];\n\t\tfor (rint i = r; i >= l; i --) q[now][i] = st[top --];\n\t\treturn;\n\t}\n\trint cnt1 = R[bel[l]] - l + 1, cnt2 = r - L[bel[r]] + 1;\n\twhile (cnt1 --) {\n\t\trint x = q[bel[l]].back ();\n\t\tst[++ top] = x, buc[bel[l]][x] --, q[bel[l]].pop_back (); \n\t}\n\tst[++ top] = q[bel[r]][cnt2 - 1];\n\twhile (top > 1) {\n\t\trint x = st[top];\n\t\tq[bel[l]].push_back (x), buc[bel[l]][x] ++, top --; \n\t}\n\tfor (rint i = bel[l] + 1; i <= bel[r] - 1; i ++) {\n\t\trint x = st[top];\n\t\tq[i].push_front (x), buc[i][x] ++, top --;\n\t\trint y = q[i].back ();\n\t\tst[++ top] = y, buc[i][y] --, q[i].pop_back();\n\t}\n\twhile (cnt2 --) {\n\t\trint x = q[bel[r]].front ();\n\t\tst[++ top] = x, buc[bel[r]][x] --, q[bel[r]].pop_front ();\n\t}\n\ttop --;\n\twhile (top > 0) {\n\t\trint x = st[top];\n\t\tq[bel[r]].push_front (x), buc[bel[r]][x] ++, top --;\n\t}\n}\n\ninline int Query (rint l, rint r, rint k, rint ans = 0) {\n\tif (bel[l] == bel[r]) {\n\t\trint now = bel[l];\n\t\tl -= L[now], r -= L[now];\n\t\tfor (rint i = l; i <= r; i ++) ans += q[now][i] == k;\t\n\t\treturn ans;\n\t}\n\trint cnt1 = R[bel[l]] - l + 1, cnt2 = r - L[bel[r]] + 1;\n\tfor (rint i = q[bel[l]].size () - cnt1; i <= q[bel[l]].size () - 1; i ++) ans += q[bel[l]][i] == k;\n\tfor (rint i = 0; i <= cnt2 - 1; i ++) ans += q[bel[r]][i] == k;\t\n\tfor (rint i = bel[l] + 1; i <= bel[r] - 1; i ++) ans += buc[i][k];\n\treturn ans;\n}\n\nint main () {\n\tn = read(), Init (), m = read();\n\trint last = 0;\n\twhile (m --) {\n\t\trint opt = read(), l = (read() + last - 1) % n + 1, r = (read() + last - 1) % n + 1, k;\n\t\tif (l > r) swap (l, r);\n\t\tif (opt == 1) Modify (l, r);\n\t\telse k = (read() + last - 1) % n + 1, printf (\"%d\\n\", last = Query (l, r, k));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1615899393,
        "uid": 335193,
        "name": "Rubyonly",
        "ccfLevel": 8,
        "title": "CF455D \u9898\u89e3"
    },
    {
        "content": "\u542c\u540c\u673a\u623f\u5927\u4f6c[sky](https://www.luogu.com.cn/user/262212)\u8bf4\u8fd9\u662f\u5e73\u8861\u6811\u597d\u9898\uff0c\u518d\u52a0\u4e0a\u672c\u849f\u84bb\u521a\u521a\u5b66\u4e60\u5e73\u8861\u6811\uff0c\u6240\u4ee5\u5199\u4e2a\u9898\u89e3\u52a0\u6df1\u8bb0\u5fc6\u3002\n\n### Solution\n\n\u6211\u4eec\u770b\u89c1\u4e00\u64cd\u4f5c\u662f\u79fb\u52a8\u64cd\u4f5c(~~\u8fde\u4e2a\u4fee\u6539\u90fd\u6ca1\u6709~~)\uff0c\u53ef\u4ee5\u60f3\u5230\u62ff\u5e73\u8861\u6811\u8fdb\u884c\u7ef4\u62a4\u6574\u4e2a\u5e8f\u5217\uff0c\u8fd9\u662f\u5f88\u663e\u7136\u7684\u3002\n\n\u7136\u540e\u770b\u4e8c\u64cd\u4f5c\uff0c\u8be2\u95ee\u533a\u95f4\u67d0\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u597d\u50cf\u6211\u6240\u5b66\u8fc7\u7684\u5e73\u8861\u6811\u662f\u6ca1\u6709\u8fd9\u79cd\u6280\u80fd\u7684\uff08\u53ef\u80fd\u662f\u6211\u592a\u83dc\u6ca1\u542c\u8bf4\uff09\uff0c\u672c\u60f3\u53bb\u770b\u770b\u6570\u636e\u8303\u56f4\u662f\u4e0d\u662f\u9664\u4e86\u5e73\u8861\u6811\u8fd8\u6709\u522b\u7684\u5565\uff0c\u53d1\u73b0 $k_i\\leq n$ \uff0c\u90a3\u4e48\u53ef\u4ee5\u62ff $n$ \u68f5\u5e73\u8861\u6811\u53bb\u7ef4\u62a4\u76f8\u540c\u503c\u7684\u5143\u7d20\u7684**\u76f8\u5bf9**\u4f4d\u7f6e\u3002\n\n\u73b0\u5728\u5c31\u53ef\u4ee5\u8bf4\u70b9\u5173\u4e8e\u8fd9 $n+1$ \u68f5\u5e73\u8861\u6811\u7684\u4e8b\u4e86\u3002\n\n\u6211\u4eec\u8bbe $t_0$ \u4e3a\u7ef4\u62a4\u6574\u4e2a\u5e8f\u5217\u7684\u5e73\u8861\u6811\uff0c $t_i$ \u662f\u503c\u4e3a $i$ \u7684\u5143\u7d20\u6240\u5728\u7684\u5e73\u8861\u6811\uff0c\u4ed6\u4eec\u7684 $key$ \u662f\u8fd9\u4e2a\u5143\u7d20\u5728\u5e8f\u5217\u4e2d\u7684\u4f4d\u7f6e\u3002\n\n\u7ef4\u62a4 $t_0$ \u5c31\u7528\u6b63\u5e38\u7684\u64cd\u4f5c\uff0c\u4f46\u7ef4\u62a4 $t_i$ \u662f\u9700\u8981\u627e\u5230\u4f4d\u7f6e\u4e0d\u8d85\u8fc7/\u4e0d\u5c0f\u4e8e\u7ed9\u5b9a\u503c\u7684\u6700\u9760\u53f3/\u6700\u9760\u5de6\u5143\u7d20\uff0c\u8fd9\u4e2a\u662f\u9700\u8981\u7ed9\u5b9a\u503c\u5728\u539f\u5e8f\u5217\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5373 $t_0$ \u4e2d\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u8bb0\u5f55 $t_i$ \u7684\u70b9\u5728 $t_0$ \u4e2d\u7684\u5bf9\u5e94\u70b9\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a $O(n+m\\log^2 n)$ \n\n\u6ce8\uff1a\u4f5c\u8005\u4f7f\u7528 $splay$ \uff0c\u5e76\u4e14\u4e0d\u4f1a\u4f7f\u7528\u6307\u9488\uff0c\u6240\u4ee5\u62ff\u7684\u7ed3\u6784\u4f53\u3002\u7801\u98ce\u4e11\u964b\u89c1\u8c05\u3002\n\n### \u4ee3\u7801\n\n```c++\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n\nusing namespace std;\nconst int N=3e5+10;\nint rt[N],cnt,b[N],bel[N],lans,n,m;\nstruct node{\n    int fa,siz,val;\n    int son[2];\n}tr[N];\n\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n    while(isdigit(ch)){x=x*10+(ch^48);ch=getchar();}\n    return x*f;\n}\n\ninline bool which_son(int x){\n    return x==tr[tr[x].fa].son[1];\n}\n\ninline void pushup(int x){\n    tr[x].siz=tr[tr[x].son[0]].siz+tr[tr[x].son[1]].siz+1;\n}\n\nint newnode(int f,int x){\n    tr[x].siz=1;\n    tr[x].son[0]=tr[x].son[1]=0;\n    tr[x].fa=f;\n    return x;\n}\n\ninline void rotate(int x){\n    int f=tr[x].fa,ff=tr[f].fa;\n    bool w=which_son(x);\n    tr[f].son[w]=tr[x].son[w^1];\n    tr[tr[x].son[w^1]].fa=f;\n    tr[x].fa=ff;\n    tr[x].son[w^1]=f;\n    tr[f].fa=x;\n    if(ff){\n        tr[ff].son[tr[ff].son[1]==f]=x;\n    }\n    pushup(f);pushup(x);\n}\n\ninline void splay(int x,int goal){\n    for(int f;(f=tr[x].fa)!=goal;){\n        if(tr[f].fa!=goal){\n            rotate(which_son(x)==which_son(f)?f:x);\n        }\n        rotate(x);\n    }\n    if(goal==0){\n        rt[bel[x]]=x;\n    }\n}\n\ninline void insert(int f,int p,int x){\n    if(!f) rt[bel[x]]=newnode(0,x);\n    else{\n        tr[f].son[p]=newnode(f,x);\n        splay(x,0);\n    }\n}\n\nint find(int x,int k){  //\u6392\u540d\u4e3ak\u7684\u7f16\u53f7\n\tif(!x||tr[x].siz<k) return 0;\n\twhile(x){\n\t\tif(k==tr[tr[x].son[0]].siz+1) break;\n\t\tif(k>tr[tr[x].son[0]].siz+1) k-=tr[tr[x].son[0]].siz+1,x=tr[x].son[1];\n\t\telse x=tr[x].son[0];\n\t}\n\treturn x;\n}\n\ninline int pre(int x){\n    int now=tr[x].son[0];\n    while(tr[now].son[1]) now=tr[now].son[1];\n    return now;\n}\n\ninline int nxt(int x){\n    int now=tr[x].son[1];\n    while(tr[now].son[0]) now=tr[now].son[0];\n    return now;\n}\n\ninline void del(int &r,int x){\n    int q=pre(r),p=nxt(r);\n    if(!q&&!p){\n        r=0;return ;\n    }\n    if(!q){\n        splay(p,0);\n        tr[p].son[0]=0;\n        pushup(p);\n        return ;\n    }\n    if(!p){\n        splay(q,0);\n        tr[q].son[1]=0;\n        pushup(q);\n        return ;\n    }\n    splay(q,0);splay(p,q);\n    tr[p].son[0]=0;\n    pushup(p);pushup(q);\n}\n\nint ans;\ninline int s_ize(int x){\n    x-=n;\n    splay(x,0);\n    return tr[tr[x].son[0]].siz+1;\n}\n\ninline void _pre(int x,int lim){    //\u4e0d\u5c0f\u4e8e\u6700\u9760\u5de6\n    if(!x) return ;\n    while(x){\n        if(s_ize(x)>=lim) ans=x,x=tr[x].son[0];\n        else x=tr[x].son[1];\n    }\n}\n\ninline void _nxt(int x,int lim){    //\u4e0d\u5927\u4e8e\u6700\u9760\u53f3\n    if(!x) return ;\n    while(x){\n        if(s_ize(x)<=lim) ans=x,x=tr[x].son[1];\n        else x=tr[x].son[0];\n    }\n}\n\ninline void change(int k,int k1){\n    splay(k,0);\n    del(rt[bel[k]],k);\n    splay(k1,0);\n    if(tr[tr[k1].son[0]].siz==0) insert(k1,0,k);\n    else{\n       int q=pre(rt[bel[k1]]);\n        splay(q,k1);insert(q,1,k);\n    }\n}\n\ninline void moving(int l,int r){\n    if(l==r) return ;\n    int k=find(rt[0],r),k1=find(rt[0],l);\n    change(k,k1);\n    ans=0;\n    _pre(rt[tr[k].val],l);\n    if(ans==k+n) return ;\n    change(k+n,ans);\n}\n\ninline void query(int l,int r,int k){\n    int t=lower_bound(b+1,b+n+1,k)-b;\n    if(!rt[t]||b[t]!=k){\n        printf(\"%d\\n\",lans=0);\n        return ;\n    }\n    k=t;\n    int k1,k2;ans=0;\n    _pre(rt[k],l),k1=ans,ans=0;\n    _nxt(rt[k],r),k2=ans,ans=0;\n    if(k1==k2&&k1){\n        puts(\"1\");lans=1;\n    }\n    else if(!k1||!k2||s_ize(k1)>s_ize(k2)){\n        puts(\"0\");lans=0;\n    }\n    else{\n        splay(k1,0);splay(k2,k1);\n        printf(\"%d\\n\",lans=tr[tr[k2].son[0]].siz+2);\n    }\n}\n\nint main(){\n    n=read();\n    for(int i=1;i<=n;i++)\n        tr[i].val=read(),b[i]=tr[i].val;\n     sort(b+1,b+n+1);\n    // cnt=unique(b+1,b+n+1)-b-1;\n    for(int i=1;i<=n;i++)\n        tr[i].val=lower_bound(b+1,b+n+1,tr[i].val)-b;\n    for(int i=1;i<=n;i++)\n        bel[i]=0,insert(rt[0],1,i);\n    for(int i=1;i<=n;i++)\n        bel[i+n]=tr[i].val,insert(rt[tr[i].val],1,i+n);\n    m=read();\n    for(int i=1,op,l,r,k;i<=m;i++){\n        op=read(),l=read(),r=read();\n        l=(l+lans-1)%n+1,r=(r+lans-1)%n+1;\n        if(l>r) swap(l,r);\n        if(op==1) moving(l,r);\n        else k=(read()+lans-1)%n+1,query(l,r,k);\n    }\n    return 0;\n}\n```\n\n\u672c\u9898\u5206\u5757\u505a\u6cd5\u4e0d\u518d\u8bf4\u660e(\uffe3\u25bd\uffe3)\"",
        "postTime": 1602648420,
        "uid": 272143,
        "name": "\u662f\u4e2a\u6c49\u5b50",
        "ccfLevel": 4,
        "title": "CF455D Serega and Fun"
    },
    {
        "content": "\u53ef\u4ee5\u7528\u5206\u5757\u505a\uff0c\u5757\u7684\u5927\u5c0f\u76f4\u63a5\u53d6sqrt(n)\u5c31\u884c\u4e86\uff0cc(i,j)\u8868\u793a\u5728\u7b2ci\u4e2a\u5757\u91ccj\u7684\u4e2a\u6570\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5757\uff0c\u5f00\u4e00\u4e2adeque\u8bb0\u5f55\u5757\u91cc\u7684\u5143\u7d20\uff0c\u6bcf\u6b21\u4fee\u6539\u65f6\uff0c\u628a\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u653e\u5230\u8d77\u59cb\u4f4d\u7f6e\uff0c\u5bf9\u4e8e\u5305\u542b\u7684\u5757\uff0c\u628a\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u653e\u5230\u4e0b\u4e00\u4e2a\u5757\u7684\u5f00\u5934\uff0c\u67e5\u8be2\u5c31\u628a\u5b8c\u5168\u5305\u542b\u7684\u5757\u52a0\u4e0a\uff0c\u5bf9\u4e8e\u4e24\u8fb9\u66b4\u529b\u8dd1\u4e00\u4e0b\u5373\u53ef\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=100005,M=355;\ndeque<int>a[N];\nint n,m,s,q,z,L,R,k,l,r,x,ans,c[M][N];\nvoid deal(int &x){x=(x+ans-1)%n+1;} \nint main()\n{\n\tscanf(\"%d\",&n);\n\ts=int(sqrt(n)),m=n/s+1;\n\tfor(int i=0;i<n;i++)\n\t{\n\t\tscanf(\"%d\",&x);\n\t\ta[i/s].push_back(x);\n\t\tc[i/s][x]++;\n\t}\n\tscanf(\"%d\",&q);\n\twhile(q--)\n\t{\n\t\tscanf(\"%d%d%d\",&z,&L,&R);\n\t\tdeal(L),deal(R);\n\t\tif(L>R) swap(L,R);\n\t\tL--,l=L/s,r=R/s;\n\t\tif(z==2)\n\t\t{\n\t\t\tscanf(\"%d\",&k);\n\t\t\tdeal(k);\n\t\t\tans=0;\n\t\t\tif(l==r)\n\t\t\t\tfor(int i=L%s;i<R%s;i++)\n\t\t\t\t\tans+=a[l][i]==k;\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor(int i=l+1;i<r;i++)\n\t\t\t\t\tans+=c[i][k];\n\t\t\t\tfor(int i=L%s;i<a[i].size();i++)\n\t\t\t\t\tans+=a[l][i]==k;\n\t\t\t\tfor(int i=0;i<R%s;i++)\n\t\t\t\t\tans+=a[r][i]==k;\n\t\t\t}\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(l==r)\n\t\t\t{\n\t\t\t\tR=R%s-1,x=a[r][R];\n\t\t\t\ta[r].erase(a[r].begin()+R);\n\t\t\t\ta[l].insert(a[l].begin()+L%s,x);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor(int i=l;i<r;)\n\t\t\t\t{\n\t\t\t\t\tx=a[i].back(),a[i].pop_back(),c[i][x]--,i++;\n\t\t\t\t\ta[i].push_front(x),c[i][x]++;\t\n\t\t\t\t} \n\t\t\t\tR%=s,x=a[r][R];\n\t\t\t\ta[r].erase(a[r].begin()+R),c[r][x]--;\n\t\t\t\ta[l].insert(a[l].begin()+L%s,x),c[l][x]++;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1563761062,
        "uid": 183821,
        "name": "Vn_nV",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF455D \u3010Serega and Fun\u3011"
    },
    {
        "content": "\u8003\u8651\u5206\u5757\uff0c\u6bcf $\\sqrt n$ \u4e2a\u5143\u7d20\u5206\u6210\u4e00\u5757\uff0c\u6bcf\u4e2a\u5757\u5185\u7ef4\u62a4 $cnt(b,i)$ \u8868\u793a $i$ \u8fd9\u4e2a\u6570\u5728 $b$ \u53f7\u5757\u4e2d\u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u7ef4\u62a4 $dq(b)$ \u7528\u4e00\u4e2a `deque` \u8868\u793a\u51fa $b$ \u53f7\u5757\u5185\u7684\u6240\u6709\u5143\u7d20\u3002\n\n\u5bf9\u4e8e $1$ \u64cd\u4f5c\uff0c\u5982\u679c $l$ \u4e0e $r$ \u5728\u540c\u4e00\u4e2a\u5757\u91cc\uff0c\u76f4\u63a5\u66b4\u529b\u53bb\u505a\u5373\u53ef\u3002\u5982\u679c\u4e0d\u5728\uff0c\u5219\u5c06\u6700\u540e\u4e00\u4e2a\u5143\u7d20 insert \u8fdb\u7b2c\u4e00\u4e2a\u5143\u7d20\u6240\u5728\u7684\u5757\u4e2d\uff0c\u63a5\u7740 $(bl_l,bl_r]$ \u4e4b\u95f4\u7684\u6240\u6709\u5757\uff0c\u628a\u4e0a\u4e00\u4e2a\u5757\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u79fb\u5230\u5f53\u524d\u5757\u4e2d\uff0c\u5e76\u66f4\u65b0 $cnt$ \u503c\u3002\u4ee5\u4fdd\u8bc1\u5757\u5185\u5143\u7d20\u6570\u4ecd\u4e3a $\\sqrt n$\u3002\n\n\u5bf9\u4e8e $2$ \u64cd\u4f5c\uff0c\u96f6\u6563\u5757\u66b4\u529b\u67e5\u8be2\uff0c\u6574\u5757\u76f4\u63a5\u8bfb $cnt$ \u503c\u76f8\u52a0\u5373\u53ef\u3002\n\n**\u53e6\u5916\u9700\u8981\u7279\u6b8a\u6ce8\u610f\u7684\u662f\uff1a** \u5982\u679c\u4f60 RE on test 9\uff0c\u5982\u679c\u4f60\u5199\u4e86\u7c7b\u4f3c\n\n```cpp\ndq[bl[r]].erase(dq[bl[r]].begin() + r - lbl[r]);\n```\n\n\u8fd9\u79cd\u7684\u8bed\u6cd5\uff0c\u5b83\u4f1a\u56e0\u4e3a `dq[bl[r]].begin() + r` \u8dd1\u5230\u4e86 deque \u5916\u9762\u800c RE\u3002\n\n\u6539\u6210\u8fd9\u6837\u5373\u53ef AC\uff1a\n\n```cpp\ndq[bl[r]].erase(dq[bl[r]].begin() + (r - lbl[r]));\n```\n\n### Code\n\n```cpp\nconstexpr int N = 1e5 + 9;\nconstexpr int B = 333;\n\nint n, a[N], cnt[B][N], bl[N], lbl[N], rbl[N], sz;\ndeque<int> dq[B];\n\nvoid Init() {\n  sz = max(3, (int)sqrt(n));\n  re (i, n)\n    bl[i] = (i - 1) / sz + 1, lbl[i] = (bl[i] - 1) * sz + 1, rbl[i] = min(n, bl[i] * sz);\n  ste(x, 1, n, sz) {\n    rep (i, lbl[x], rbl[x])\n      dq[bl[x]].push_back(a[i]), ++cnt[bl[x]][a[i]];\n  }\n}\n\nvoid Mov(int l, int r) {\n  if (bl[l] == bl[r]) {\n    int b = bl[l];\n    int x = dq[b][r - lbl[l]];\n    dq[b].erase(dq[b].begin() + (r - lbl[l]));\n    dq[b].insert(dq[b].begin() + (l - lbl[l]), x);\n    return;\n  }\n  dq[bl[l]].insert(dq[bl[l]].begin() + (l - lbl[l]), dq[bl[r]][r - lbl[r]]);\n  ++cnt[bl[l]][dq[bl[r]][r - lbl[r]]];\n  --cnt[bl[r]][dq[bl[r]][r - lbl[r]]];\n  dq[bl[r]].erase(dq[bl[r]].begin() + (r - lbl[r]));\n  rep (b, bl[l] + 1, bl[r]) {\n    int t = dq[b - 1].back();\n    dq[b].push_front(t);\n    ++cnt[b][t];\n    dq[b - 1].pop_back();\n    --cnt[b - 1][t];\n  }\n}\n\nint Ask(int l, int r, int k) {\n  int res = 0;\n  if (bl[l] == bl[r]) {\n    int b = bl[l];\n    rep (i, l, r) {\n      if (dq[b][i - lbl[l]] == k) ++res;\n    }\n    return res;\n  }\n  res += Ask(l, rbl[l], k);\n  rep (b, bl[l] + 1, bl[r] - 1)\n    res += cnt[b][k];\n  res += Ask(lbl[r], r, k);\n  return res;\n}\n\nsigned main() {\n  in(n)(a, n);\n  Init();\n  int lastans = 0;\n  re (_, in()) {\n    int op = in(), l = (in() + lastans - 1) % n + 1, r = (in() + lastans - 1) % n + 1;\n    if (l > r) swap(l, r);\n    if (op == 1)\n      Mov(l, r);\n    else {\n      int k = (in() + lastans - 1) % n + 1;\n      lastans = Ask(l, r, k);\n      out(lastans)('\\n');\n    }\n  }\n  return 0;\n}\n```\n\n",
        "postTime": 1634719334,
        "uid": 207996,
        "name": "yzy1",
        "ccfLevel": 9,
        "title": "CF455D \u9898\u89e3"
    },
    {
        "content": "# [CF455D  Serega and Fun](https://www.luogu.com.cn/problem/CF455D)  \n\u63d0\u4f9b\u4e00\u79cd\u6bd4\u8f83\u53e6\u7c7b\u7684\u5206\u5757\u505a\u6cd5\uff0c\u6ca1\u6709\u4f7f\u7528\u53cc\u7aef\u961f\u5217\u5b9e\u73b0\u3002\n## \u9898\u76ee\u63cf\u8ff0\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$\uff0c\u4f60\u9700\u8981\u652f\u6301 $m$ \u6b21\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\n1. \u5c06\u533a\u95f4 $[l, r]$ \u6574\u4f53\u53f3\u79fb\u4e00\u4f4d\u3002\u7279\u522b\u5730\uff0c$r$ \u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\u9700\u8981\u79fb\u5230 $l$ \u4f4d\u7f6e\u4e0a\u3002  \n2. \u67e5\u8be2\u533a\u95f4 $[l, r]$ \u4e2d $x$ \u51fa\u73b0\u7684\u6b21\u6570\u3002  \n  \n\u6570\u636e\u8303\u56f4\uff1a$n, m \\leq 10^5,1 \\leq a_i \\leq n$\u3002\n\n## \u9898\u76ee\u5206\u6790\n\u770b\u5230\u503c\u57df\u4e0e $n$ \u540c\u9636\u5e76\u4e14\u67e5\u8be2\u64cd\u4f5c\u7528\u4e00\u822c\u6570\u636e\u7ed3\u6784\u4e0d\u597d\u5b9e\u73b0\uff0c\u5f88\u5bb9\u6613\u4f1a\u60f3\u5230\u5206\u5757\u3002  \n\u5bf9\u4e8e\u67e5\u8be2\u64cd\u4f5c\uff0c\u6cbf\u7528\u6b63\u5e38\u7684\u5206\u5757\u64cd\u4f5c\uff0c\u4ee5 `cnt` \u6570\u7ec4\u8bb0\u5f55\u6bcf\u5757\u4e2d\u6bcf\u4e2a\u6570\u51fa\u73b0\u7684\u6b21\u6570\uff08\u7a7a\u95f4\u8db3\u591f\uff09\uff0c\u904d\u5386\u5404\u5757\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\u8fd9\u4e2a\u6570\u7ec4\u7684\u7edf\u8ba1\u72ec\u7acb\u4e8e\u4e0b\u9762\u6240\u8ff0\u7684\u64cd\u4f5c\u3002\n\n\u6211\u4eec\u91cd\u70b9\u8003\u8651\u4e00\u4e0b\u8fd9\u4e2a\u4fee\u6539\u64cd\u4f5c\u5982\u4f55\u5b9e\u73b0\u3002  \n~~\u7531\u4e8e\u672c\u4eba\u8111\u5b50\u4e0d\u5927\u7075\u5149~~\uff0c \u6211\u5e76\u6ca1\u6709\u8003\u8651\u4f7f\u7528\u53cc\u7aef\u961f\u5217\u66b4\u529b\u6539\u53d8\u6574\u4e2a\u5757\u7684\u5f62\u6001\uff0c\u800c\u662f\u60f3\u4e86\u60f3\u80fd\u4e0d\u80fd\u7ed9\u4fee\u6539\u7684\u6574\u5757\u6253\u4e0a\u6807\u8bb0\u3002  \n\u7ed3\u8bba\u662f\u53ef\u884c\u3002\u4e0d\u8fc7\u4ee3\u7801\u590d\u6742\u5ea6\u53ef\u80fd\u8f83\u9ad8\u3002\n\n\u6211\u4eec\u4f7f\u7528 `vector` \u6765\u5b58\u50a8\u8fd9\u4e9b\u6807\u8bb0\uff0c\u610f\u4e3a\u201c\u5728\u5f53\u524d\u5757\u4e4b\u524d\u63d2\u5165\u8fd9\u4e2a\u6570\u201d\u3002\u8fd9\u4e2a `vector` \u5e76\u4e0d\u8d1f\u8d23\u5220\u9664\u5143\u7d20\uff0c\u53ea\u8d1f\u8d23\u5904\u7406\u5411\u5757\u4e2d\u589e\u52a0\u5143\u7d20\u7684\u8fc7\u7a0b\u3002  \n\u4e0d\u8fc7\u8fd9\u6837\u505a\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u65e2\u7136\u6ca1\u6709\u6539\u53d8\u5757\u7684\u5f62\u6001\uff0c\u90a3\u6211\u4eec\u5728\u64cd\u4f5c\u65f6\u65e0\u6cd5\u9a6c\u4e0a\u627e\u5230\u5904\u4e8e\u4e0a\u4e00\u5757\u672b\u5c3e\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u8fd9\u4f7f\u5f97\u6253\u6807\u8bb0\u5b58\u5728\u969c\u788d\u3002\u6211\u7684\u5904\u7406\u65b9\u6cd5\u662f\u53e6\u5f00\u4e00\u4e2a\u540d\u4e3a `pos` \u7684\u6570\u7ec4\uff0c\u8bb0\u5f55\u5f53\u524d\u5757\u672b\u5c3e\u5143\u7d20\u7684\u4f4d\u7f6e\uff0c\u6bcf\u6253\u4e00\u4e2a\u6807\u8bb0\u5c31\u628a\u8fd9\u4e2a\u4f4d\u7f6e\u5411\u524d\u632a\u4e00\u4f4d\uff08\u56e0\u4e3a\u5f53\u524d\u8fd9\u4f4d\u5df2\u7ecf\u79fb\u5230\u4e0b\u4e00\u5757\u4e2d\u4e86\uff09\u3002  \n\u4e8e\u662f\u4e4e\u53c8\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff1a\u5f53\u67d0\u4e2a\u5757\u88ab\u6253\u4e0a\u7684\u6807\u8bb0\u6570\u8d85\u51fa\u5757\u957f\u65f6 `pos` \u4f1a\u8d8a\u51fa\u5757\u672c\u8eab\u7684\u5de6\u53f3\u754c\u9650\u3002\u4e3a\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6807\u8bb0\u6570\u91cf\u903c\u8fd1\u5757\u957f\u65f6\u5fc5\u987b\u9a6c\u4e0a\u4e0b\u653e\u3002\n\n\u5f53\u4fee\u6539\u6563\u5757\u65f6\uff0c`vector` \u4e2d\u7684\u6807\u8bb0\u9700\u8981\u5168\u90e8\u4e0b\u653e\u5e76\u6e05\u7a7a\u3002\u5bf9\u4e8e\u6e05\u7a7a\uff0c\u8bbe\u5757\u8fb9\u754c\u4e3a $st$ \u548c $ed$\uff0c\u6807\u8bb0\u6570\u4e3a $tagnum$\uff0c\u5219\uff1a\n\n1. \u5bf9\u4e8e\u5757\u5185 $[st + tagnum, ed]$ \u533a\u95f4\u7684\u6240\u6709\u5143\u7d20 $a_i$\uff0c\u5c06\u5176\u8d4b\u4e3a $a_{i-tagnum}$\u3002\n2. \u5bf9\u4e8e\u5757\u5185 $[st, st + tagnum - 1]$ \u533a\u95f4\u5185\u7684\u6240\u6709\u5143\u7d20 $a_i$\uff0c\u5c06\u5176\u5012\u5e8f\u8d4b\u4e3a `vector` \u4e2d\u5b58\u50a8\u7684\u5404\u4e2a\u5143\u7d20\u3002\n\n\u4e4b\u540e\u66b4\u529b\u6a21\u62df\u5373\u53ef\u3002  \n\u4fee\u6539\u6574\u5757\u65f6\uff0c\u501f\u52a9 `pos` \u6570\u7ec4\u627e\u5230\u4e0a\u4e00\u4e2a\u5757\u672b\u5c3e\u5143\u7d20\u7684\u4f4d\u7f6e\u5e76\u4f5c\u4e3a\u6807\u8bb0\u63d2\u5165 `vector` \u5373\u53ef\u3002  \n\u6ce8\u610f\u5de6\u53f3\u8fb9\u754c\u7684\u5904\u7406\u3002\u53e6\u5916\uff0c  \n**\u6ce8\u610f\uff1a\u4e0a\u8ff0\u4fee\u6539\u3001\u4e0b\u653e\u64cd\u4f5c\u5fc5\u987b\u4ece\u53f3\u5411\u5de6\u5012\u5e8f\u5904\u7406\u3002**\n\n\u7801\u91cf\u548c\u5e38\u6570\u90fd\u8f83\u5927\uff0c\u5982\u613f\u5c1d\u8bd5\u6b64\u65b9\u6cd5\u8bf7\u4fdd\u6301\u7ec6\u5fc3\u548c\u8010\u5fc3\u3002\n\n## Code\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <cmath>\n#include <vector>\n#include <algorithm>\nusing namespace std;\n\ninline void qswap(int &a, int &b)\n{\n\tint t = a; a = b;\n\tb = t; return ;\n}\n\ninline int read()\n{\n\tint x = 0; char c;\n\twhile(!isdigit(c = getchar()));\n\tdo{\n\t\tx = (x << 1) + (x << 3) + (c ^ 48);\n\t}while(isdigit(c = getchar()));\n\treturn x;\n}\n\nint top = 0, stk[20];\ninline void write(int x)\n{\n\tdo{\n\t\tstk[++top] = x % 10;\n\t\tx /= 10;\n\t}while(x);\n\tfor(register int i = top; i; --i)\n\t\tputchar(stk[i] | 48);\n\tputchar('\\n'); top = 0;\n\treturn ;\n}\n\nint n, m, ope, l, r, x;\nint sq, siz, bl, br, ans = 0;\nint sz[100010], bel[100010];\nint st[345], ed[345], tagnum[345], posed[345];\nint cnt[345][100010];\nvector<int> tag[345];\n\ninline void preblocks()\n{\n\tsq = sqrt(n); siz = n / sq;\n\tfor(register int i = 1; i < sq; ++i)\n\t{\n\t\tst[i] = ed[i - 1] + 1;\n\t\tposed[i] = ed[i] = st[i] + siz - 1;\n\t\tfor(register int j = st[i]; j <= ed[i]; ++j)\n\t\t{\n\t\t\tsz[j] = read();\n\t\t\tbel[j] = i;\n\t\t\t++cnt[i][sz[j]];\n\t\t}\n\t}\n\tst[sq] = ed[sq - 1] + 1;\n\tposed[sq] = ed[sq] = n;\n\tfor(register int i = st[sq]; i <= n; ++i)\n\t{\n\t\tsz[i] = read();\n\t\tbel[i] = sq;\n\t\t++cnt[sq][sz[i]];\n\t}\n\treturn ;\n}\n\ninline void rebuild(int b)\n{\n\tif(tag[b].empty()) return ;\n\tint rb = st[b] + tagnum[b] - 1;\n\tfor(register int i = ed[b]; i > rb; --i)\n\t\tsz[i] = sz[i - tagnum[b]];\n\tfor(register int i = st[b]; i <= rb; ++i)\n\t\tsz[i] = tag[b][tagnum[b] - i + st[b] - 1];\n\ttag[b].clear(); tagnum[b] = 0;\n\tposed[b] = ed[b]; return ;\n}\n\ninline void modify(int l, int r)\n{\n\tbl = bel[l]; br = bel[r];\n\tif(bl == br)\n\t{\n\t\trebuild(bl); int rec = sz[r];\n\t\tfor(register int i = r; i > l; --i)\n\t\t\tsz[i] = sz[i - 1];\n\t\tsz[l] = rec; return ;\n\t}\n\telse\n\t{\n\t\trebuild(bl); rebuild(br); int rec = sz[r];\n\t\t--cnt[bl][sz[ed[bl]]]; ++cnt[bl][rec];\n\t\t--cnt[br][rec]; ++cnt[br][sz[posed[br - 1]]];\n\t\tif(r == ed[br])\n\t\t{\n\t\t\tif(tagnum[br] >= siz - 1) rebuild(br);\n\t\t\ttag[br].push_back(sz[posed[br - 1]]);\n\t\t\t++tagnum[br]; --posed[br];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(register int i = r; i > st[br]; --i)\n\t\t\t\tsz[i] = sz[i - 1];\n\t\t\tsz[st[br]] = sz[posed[br - 1]];\n\t\t}\n\t\tfor(register int i = br - 1; i > bl; --i)\n\t\t{\n\t\t\tif(tagnum[i] >= siz - 1) rebuild(i);\n\t\t\t--cnt[i][sz[posed[i]]];\n\t\t\t++cnt[i][sz[posed[i - 1]]];\n\t\t\ttag[i].push_back(sz[posed[i - 1]]);\n\t\t\t++tagnum[i]; --posed[i];\n\t\t}\n\t\tif(l == st[bl])\n\t\t{\n\t\t\tif(tagnum[bl] >= siz - 1) rebuild(bl);\n\t\t\ttag[bl].push_back(rec);\n\t\t\t++tagnum[bl]; --posed[bl];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(register int i = ed[bl]; i > l; --i)\n\t\t\t\tsz[i] = sz[i - 1];\n\t\t\tsz[l] = rec;\n\t\t}\n\t}\n\treturn ;\n}\n\ninline int query(int l, int r, int x)\n{\n\tbl = bel[l]; br = bel[r]; ans = 0;\n\tif(bl == br)\n\t{\n\t\trebuild(bl);\n\t\tfor(register int i = l; i <= r; ++i)\n\t\t\tans += sz[i] == x;\n\t}\n\telse\n\t{\n\t\tif(l == st[bl]) --bl;\n\t\telse\n\t\t{\n\t\t\trebuild(bl);\n\t\t\tfor(register int i = l; i <= ed[bl]; ++i)\n\t\t\t\tans += sz[i] == x;\n\t\t}\n\t\tif(r == ed[br]) ++br;\n\t\telse\n\t\t{\n\t\t\trebuild(br);\n\t\t\tfor(register int i = st[br]; i <= r; ++i)\n\t\t\t\tans += sz[i] == x;\n\t\t}\n\t\tfor(register int i = bl + 1; i < br; ++i)\n\t\t\tans += cnt[i][x];\n\t}\n\treturn ans;\n}\n\nint main()\n{\n\tn = read(); preblocks(); m = read();\n\tfor(register int i = 1; i <= m; ++i)\n\t{\n\t\tope = read();\n\t\tl = (read() + ans - 1) % n + 1;\n\t\tr = (read() + ans - 1) % n + 1;\n\t\tif(l > r) qswap(l, r);\n\t\tif(ope == 1) modify(l, r);\n\t\telse\n\t\t{\n\t\t\tx = (read() + ans - 1) % n + 1;\n\t\t\twrite(query(l, r, x));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1667706615,
        "uid": 632868,
        "name": "Clover_BY",
        "ccfLevel": 0,
        "title": "CF455D  Serega and Fun"
    },
    {
        "content": "## [Link](https://www.luogu.com.cn/problem/CF455D)\n\n\u4e00\u9053\u6bd4\u8f83\u677f\u7684\u5206\u5757\uff0c\u6211\u5c45\u7136\u4e00\u773c\u5c31\u77e5\u9053\u600e\u4e48\u505a\u4e86\uff0c\u611f\u89c9\u6700\u591a\u8bc4\u84dd\u3002\n\n\u8003\u8651\u7528\u5206\u5757\u7ef4\u62a4\u3002\u5206\u5757\u540e\u7ef4\u62a4\u6bcf\u4e2a\u533a\u95f4\u5185 $k$ \u7684\u4e2a\u6570\u3002\n\n\u81f3\u4e8e\u5982\u4f55\u7ef4\u62a4\uff0c\u6bcf\u5757\u5f00\u4e00\u4e2a\u53cc\u5411\u961f\u5217\u7ef4\u62a4\u533a\u95f4\u5185\u6570\u7684\u987a\u5e8f\u5373\u53ef\u3002\u56e0\u4e3a\u533a\u95f4\u662f\u5f80\u53f3\u5e73\u79fb\u4e00\u6b21\uff0c\u53ef\u4ee5\u53d1\u73b0\u6bcf\u5757\u4e2d\u67d0\u4e2a\u6570\u5b57\u4e2a\u6570\u6700\u591a\u52a0\u6216\u51cf $1$\u3002\u7ef4\u62a4\u4e00\u4e0b\u8fd9\u4e2a\u961f\u5217\u5c31\u5bb9\u6613\u77e5\u9053\u54ea\u4e2a\u6570\u8981\u52a0\uff0c\u54ea\u4e2a\u6570\u8981\u51cf\u3002\n\n\u7ef4\u62a4\u961f\u5217\u7684\u65f6\u5019\u8981\u6ce8\u610f\u961f\u9996\u7684\u4e0b\u6807\u4e3a $0$\uff0c\u800c\u975e $1$\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\u4e0d\u7b97\u5f88\u96be\u3002\n\n\u6ce8\u610f\u4e8b\u9879\uff0c\u82e5\u4f60 RE on test 9\uff0c\u662f\u5220\u9664\u6216\u63d2\u5165\u961f\u5217\u7684\u65f6\u5019\u8d8a\u754c\u4e86\uff0c\u4f8b\u5982\u4ee5\u4e0b\u4ee3\u7801\uff1a\n\n```cpp\nque[q].erase(que[q].begin()+r-L[q]+1);\n```\n\n\u8fd9\u4e32\u4ee3\u7801\u5728 ```que[q].begin()+r``` \u7684\u65f6\u5019\u8d8a\u754c\u4e86\uff0c\u8bbf\u95ee\u5230\u4e86\u5947\u602a\u7684\u5730\u65b9\uff0c\u7136\u540e\u5c31 RE \u4e86\u3002\n\n\u89e3\u51b3\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u52a0\u4e2a\u62ec\u53f7\u5c31\u597d\u4e86\u3002\u5982\u4e0b\uff1a\n\n```cpp\nque[q].erase(que[q].begin()+(r-L[q])+1);\n```\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read()\n{\n\tint s=0;char c=getchar();\n\tfor(;!isdigit(c);c=getchar());\n\tfor(;isdigit(c);c=getchar())\n\t\ts=s*10+c-'0';\n\treturn s;\n}\nint n,m,a[100005],ans;\nint block,L[320],R[320],pos[100005];\nint cnt[320][100005];\ndeque<int>que[320];\nvoid input()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read();\n\tblock=sqrt(n);\n\tfor(int i=1;i<=block;i++)\n\t\tL[i]=R[i-1]+1,R[i]=i*block;\n\tif(R[block]<n)\n\t{\n\t\tblock++;\n\t\tL[block]=R[block-1]+1;\n\t\tR[block]=n;\n\t}\n\tfor(int i=1;i<=block;i++)\n\t\tfor(int j=L[i];j<=R[i];j++)\n\t\t{\n\t\t\tpos[j]=i,cnt[i][a[j]]++;\n\t\t\tque[i].push_back(a[j]);\n\t\t}\n}\nvoid update(int l,int r)\n{\n\tint p=pos[l],q=pos[r];\n\tif(p==q)\n\t{\n\t\tint temp=que[p][r-L[p]];\n\t\tfor(int i=r;i>l;i--)\n\t\t\tque[p][i-L[p]]=que[p][i-1-L[p]];\n\t\tque[p][l-L[p]]=temp;\n\t\treturn;\n\t}\n\tfor(int i=p+1;i<=q;i++)\n\t{\n\t\tint temp=que[i-1].back();\n\t\tque[i].push_front(temp);\n\t\tcnt[i][temp]++;\n\t\tque[i-1].pop_back();\n\t\tcnt[i-1][temp]--;\n\t}\n\tint temp=que[q][r-L[q]+1];\n\tque[q].erase(que[q].begin()+(r-L[q])+1);\n\tcnt[q][temp]--;\n\tque[p].insert(que[p].begin()+(l-L[p]),temp);\n\tcnt[p][temp]++;\n}\nint query(int l,int r,int val)\n{\n\tint p=pos[l],q=pos[r],res=0;\n\tif(p==q)\n\t{\n\t\tfor(int i=l;i<=r;i++)\n\t\t\tres+=que[p][i-L[p]]==val;\n\t\treturn res;\n\t}\n\tfor(int i=p+1;i<=q-1;i++)\n\t\tres+=cnt[i][val];\n\tfor(int i=l;i<=R[p];i++)\n\t\tres+=que[p][i-L[p]]==val;\n\tfor(int i=L[q];i<=r;i++)\n\t\tres+=que[q][i-L[q]]==val;\n\treturn res;\n}\nvoid solve()\n{\n\tm=read();\n\twhile(m--)\n\t{\n\t\tint op=read(),l=(read()+ans-1)%n+1,r=(read()+ans-1)%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tif(op==1)update(l,r);\n\t\telse\n\t\t{\n\t\t\tint k=(read()+ans-1)%n+1;\n\t\t\tans=query(l,r,k);\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t}\n\t}\n}\nint main()\n{\n\tinput();\n\tsolve();\n\treturn 0;\n}\n```\n\nNOIP \u524d\u591c\u7684\u524d\u591c\u5199\u7684\u9898\u89e3\uff0c\u5e0c\u671b RP++\uff0c\u4e5f\u795d\u5404\u4f4d\u5927\u4f6c RP++\uff0c\u4e71\u6740 NOIP\u3002\n\n\u8c22\u8c22\u89c2\u8d4f\u3002",
        "postTime": 1637237891,
        "uid": 306049,
        "name": "Utilokasteinn",
        "ccfLevel": 0,
        "title": "CF455D Serega and Fun"
    },
    {
        "content": "\u6b64\u9898\u66b4\u529b\u53ef\u8fc7\u3002  \n\u6309\u7167\u9898\u610f\u6a21\u62df\u5373\u53ef\u3002  \n\u6ce8\u610f\u8981\u7528 C++20\u3002  \n\n```cpp\n#pragma GCC optimize(\"O2,unroll-loops\")\n#pragma GCC target(\"avx,avx2\")\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+100;\nint n,a[N],lst,q;\nsigned main(){\n  std::ios::sync_with_stdio(false);cin.tie(nullptr);\n  cin>>n;for(int i=1;i<=n;i++) cin>>a[i];cin>>q;\n  for(int i=1;i<=q;i++){\n    int o,l,r;cin>>o>>l>>r;\n    l=(l+lst-1)%n+1;r=(r+lst-1)%n+1;\n    if(l>r) swap(l,r);\n    if(o==1){\n      int x=a[r];\n      for(int i=r;i^l;--i) a[i]=a[i-1];\n      a[l]=x;\n    }else{\n      int k;cin>>k;k=(k+lst-1)%n+1;int cnt=0;\n      for(int i=l;i<=r;i++) cnt+=(a[i]==k);\n      cout<<(lst=cnt)<<'\\n';\n    }\n  }\n}\n```\n\n-----\n\n\u4e0a\u9762\u7eaf\u5c5e\u5a31\u4e50\u3002 \n\n[\u535a\u5ba2\u56ed\u67e5\u770b](https://www.cnblogs.com/AIskeleton/p/16904913.html)  \n\n\u9898\u89e3\u533a\u91cc\u597d\u50cf\u53ea\u6709\u4e00\u7bc7\u5e73\u8861\u6811\u7684\u9898\u89e3\uff0c\u5269\u4e0b\u7684\u5305\u62ec CF \u5b98\u65b9\u9898\u89e3\u90fd\u662f\u5206\u5757\uff0c\u90a3\u849f\u84bb\u5c31\u8d21\u732e\u4e00\u53d1 FHQ-Treap \u7684\u9898\u89e3\u5427\u3002  \n\u663e\u7136\uff0c\u5982\u679c\u4e0d\u5f3a\u5236\u5728\u7ebf\uff0c\u6bcf\u4e2a\u989c\u8272\u7ef4\u62a4\u4e2a `vector` \u7136\u540e\u4e8c\u5206\u5373\u53ef\u3002  \n\u4e0d\u96be\u53d1\u73b0\uff0c\u6bcf\u6b21\u64cd\u4f5c 1 \u90fd\u53ea\u5f71\u54cd\u5230\u4e86 $a_r$ \u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002  \n\u8003\u8651\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u3002  \n\u7528 $n+1$ \u68f5\u5e73\u8861\u6811\uff0c\u5176\u4e2d\u4e00\u68f5\u5e73\u8861\u6811\u7ef4\u62a4\u76f8\u5bf9\u987a\u5e8f\u7f16\u53f7\uff0c$n$ \u4e2a\u5e73\u8861\u6811\u7ef4\u62a4\u6bcf\u79cd\u989c\u8272\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n + q \\log_2 n)$\u3002  \n\u601d\u8def\u4e0d\u96be\u60f3\uff0c\u4ee3\u7801\u6bd4\u8f83\u590d\u6742\uff0c\u5177\u4f53\u53ef\u53c2\u8003\u4e0b\u9762\u7684\u4ee3\u7801\u3002  \n\n```cpp\n// I forgot all the tragedies and all I saw were miracles.\n\n/************************************\n|* Author:  A.I.skeleton\n|* Problem: D. Serega and Fun\n|* Contest: Codeforces Round #260 (Div. 1)\n|* URL:     https://codeforces.com/contest/455/problem/D\n|* When:    2022-11-18 18:10:31\n|* \n|* Memory:  256 MB\n|* Time:    4000 ms\n************************************/\n#include <bits/stdc++.h>\nusing namespace std;\n#define me(t,x) memset(t,x,sizeof(t))\n#define L(i,j,k) for(int (i)=(j);i<=(k);(i)++)\n#define R(i,j,k) for(int (i)=(j);i>=(k);(i)--)\n#define FST ios::sync_with_stdio(false);cin.tie(nullptr);\n\nnamespace IO{\ntemplate<class A,class B>ostream&operator<<(ostream&X,const pair<A,B>&p)\n{return X<<\"{\"<<F(p)<<\",\"<<S(p)<<\"}\";}\ntemplate<class A>ostream&operator<<(ostream&X,const set<A>&v)\n{X<<\"{\";for(auto i:v){if(i!=*v.begin()) X<<\",\";X<<i;}return X<<\"}\";}\ntemplate<class A,class B>ostream&operator<<(ostream&X,const map<A,B>&v)\n{X<<\"{\";for(auto i:v){if(i!=*v.begin()) X<<\",\";X<<i;}return X<<\"}\";}\ntemplate<class A>ostream&operator<<(ostream&X,const vector<A>&v)\n{X<<\"{\";L(i,0,si(v)-1){if(i)X<<\",\";X<<v[i];}return X<<\"}\";}\ntemplate<typename T>void rd(T &x){cin>>x;}template<typename T>void wr(T x){cout<<x;}\ntemplate<typename T,typename ...Args>void rd(T &x,Args&...g){rd(x),rd(g...);}\ntemplate<typename T,typename ...Args>void wr(T x,Args...g){wr(x),wr(g...);}\n}using namespace IO;char x_x;clock_t S;\n\nconst int N=1e6,INF=1e9;\nint n,q,cnt,lst,rt[N],a[N],id[N];\nint pr[N],fa[N],val[N],ls[N],rs[N],si[N];\nvoid pp(int p){si[p]=si[ls[p]]+si[rs[p]]+1;}\nint nd(int v,int p=++cnt){val[p]=v;pr[p]=rand();si[p]=1;return p;}\nint rk(int p){\n  int s=si[ls[p]]+1;for(;p^rt[0];p=fa[p]) \n    s+=(rs[fa[p]]==p)*(si[ls[fa[p]]]+1);return s;\n}void sps(int p,int v,int &x,int &y,int a,int b){\n  if(!p) return x=y=0,void();\n  if(si[ls[p]]+1<=v) fa[p]=a,sps(rs[x=p],v-si[ls[p]]-1,rs[p],y,p,b);\n  else fa[p]=b,sps(ls[y=p],v,x,ls[p],a,p);pp(p);\n}void spv(int p,int v,int &x,int &y,int a,int b){\n  if(!p) return x=y=0,void();\n  if(rk(val[p])<=v) fa[p]=a,spv(rs[x=p],v,rs[p],y,p,b);\n  else fa[p]=b,spv(ls[y=p],v,x,ls[p],a,p);pp(p);\n}int mer(int x,int y){\n  if(!x||!y) return x|y;if(pr[x]>pr[y]) return fa[rs[x]=mer(rs[x],y)]=x,pp(x),x;\n  else return fa[ls[y]=mer(x,ls[y])]=y,pp(y),y;\n}void bud(int &p,int f,int l,int r){\n  if(l>r) return p=0,void();int m=(l+r)>>1;fa[id[m]=p=nd(a[m])]=f;\n  bud(ls[p],p,l,m-1);bud(rs[p],p,m+1,r);pp(p);\n}void ins(int r,int v){int x,y;spv(rt[r],rk(v)-1,x,y,0,0);rt[r]=mer(mer(x,nd(v)),y);}\nvoid del(int r,int v){int x,y,z;spv(rt[r],v-1,x,y,0,0);spv(y,v,y,z,0,0);rt[r]=mer(x,z);}\nvoid spl(int l,int r){\n  int w,x,y,z,pre;sps(rt[0],r-1,x,y,0,0);sps(y,1,y,z,0,0);\n  pre=y;rt[0]=mer(mer(x,y),z);del(val[pre],r);\n  sps(rt[0],l-1,w,x,0,0);sps(x,r-l,x,y,0,0);sps(y,1,y,z,0,0);\n  rt[0]=mer(mer(mer(w,y),x),z);ins(val[pre],pre);\n}int ask(int p,int l,int r){\n  int x,y,z,s;spv(rt[p],l-1,x,y,0,0);spv(y,r,y,z,0,0);\n    s=si[y];rt[p]=mer(mer(x,y),z);return s;\n}char y_y;signed main(){\n  rd(n);L(i,1,n) rd(a[i]);\n  bud(rt[0],0,1,n);L(i,1,n) ins(a[i],id[i]);\n  rd(q);L(i,1,q){\n    int o,l,r,k;rd(o,l,r);l=(l+lst-1)%n+1;r=(r+lst-1)%n+1;if(l>r) swap(l,r);\n    if(o==1&&l<r) spl(l,r);if(o==2) rd(k),k=(k+lst-1)%n+1,wr(lst=ask(k,l,r),'\\n');\n  }return 0;\n}\n```\n\u5361\u5e38\u540e\u6392\u5230\u4e86\u6b21\u4f18\u89e3\uff0c\u6700\u4f18\u89e3\u662f\u66ff\u7f6a\u7f8a\u6811\u3002",
        "postTime": 1668776982,
        "uid": 540715,
        "name": "A_I_Skeleton",
        "ccfLevel": 0,
        "title": "CF455D"
    },
    {
        "content": "# CF455D Serega and Fun \u9898\u89e3\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF455D)\n\n\u4e00\u4e2a\u6bd4\u8f83\u53e6\u7c7b\u7684\u5206\u5757\u505a\u6cd5\u3002\n\n\u5b9e\u9645\u4e0a\u4f60\u64cd\u4f5c $1$ \u4e0d\u5c31\u662f\u628a\u5143\u7d20 $r$ \u6254\u5230\u4e0b\u6807\u4e3a $l$ \u7684\u4f4d\u7f6e\u5bf9\u5427\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u4e00\u4e2a\u5e8f\u5217\u62c6\u6210 $\\sqrt n$ \u4e2a\u5757\uff0c\u5c31\u53ef\u4ee5\u5e94\u4ed8\u64cd\u4f5c $1$ \u4e86\uff0c\u4e5f\u5c31\u662f\u63d2\u5165\u7684\u65f6\u5019\u66b4\u529b\u627e\u5757\u66b4\u529b\u63d2\u5165\uff0c\u5220\u9664\u4e5f\u662f\u4e00\u6837\uff0c\u7136\u540e\u8bbe\u7f6e\u4e00\u4e2a\u9608\u503c\uff0c\u5f53\u5757\u5927\u5c0f\u5927\u4e8e\u8fd9\u4e2a\u9608\u503c\u7684\u65f6\u5019\u66b4\u529b\u91cd\u6784\u5c31\u884c\u4e86\u3002\n\n\u89e3\u51b3\u4e86\u64cd\u4f5c $1$\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u64cd\u4f5c $2$\uff0c\u6839\u636e\u5957\u8def\uff0c\u6563\u5757\u66b4\u529b\u5904\u7406\u884c\u3002\u5bf9\u4e8e\u6574\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u6876\u6765\u8bb0\u5f55\u5757\u5185\u6bcf\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\u5373\u53ef\u3002\n\n$\\text{Code:}$\n\n```cpp\n#include <bits/stdc++.h>\n#pragma GCC optimize(\"Ofast\")\nusing namespace std;\nconst int N = 1e5 + 10, M = 600, LIMIT = 500, S = 300;\nstruct Block {\n    int cnt, a[M];\n    int v[N];\n    inline int &operator[](int x) { return a[x]; }\n} f[M];\nint tot, siz, g[N], n, m;\nvoid print() {\n    for (int i = 1; i <= tot; i++)\n        for (int j = 1; j <= f[i].cnt; j++) g[++siz] = f[i][j];\n}\nvoid build() {\n    for (int i = 1; i <= tot; i++) {\n        for (int j = 1; j <= f[i].cnt; j++) --f[i].v[f[i][j]], f[i][j] = 0;\n        f[i].cnt = 0;\n    }\n    int pos;\n    for (int i = 1; i <= siz; i++) {\n        pos = (i - 1) / S + 1;\n        f[pos][++f[pos].cnt] = g[i], ++f[pos].v[g[i]];\n    }\n    tot = pos;\n}\ninline int find(int &x) {\n    int nowpos = 1;\n    while (f[nowpos].cnt < x && nowpos < tot) x -= f[nowpos].cnt, ++nowpos;\n    return nowpos;\n}\ninline int del(int x) {\n    int p = find(x), ans = f[p][x];\n    --f[p].v[ans];\n    for (int i = x; i < f[p].cnt; i++) f[p][i] = f[p][i + 1];\n    f[p][f[p].cnt--] = 0;\n    return ans;\n}\nvoid rebuild() {\n    siz = 0, print();\n    build();\n}\nvoid fins(int x, int v) {\n    int p = find(x);\n    ++f[p].cnt;\n    for (int i = f[p].cnt; i > x; i--) f[p][i] = f[p][i - 1];\n    f[p][x] = v, ++f[p].v[v];\n    if (f[p].cnt >= LIMIT) rebuild();\n}\nint query(int l, int r, int k) {\n    int pl = find(l), pr = find(r), ans = 0;\n    if (pl == pr) {\n        for (int i = l; i <= r; i++)\n            if (f[pl][i] == k) ++ans;\n        return ans;\n    }\n    for (int i = l; i <= f[pl].cnt; i++) ans += (f[pl][i] == k);\n    for (int i = 1; i <= r; i++) ans += (f[pr][i] == k);\n    for (int i = pl + 1; i < pr; i++) ans += f[i].v[k];\n    return ans;\n}\nint main() {\n    // freopen(\"out\", \"w\", stdout);\n    cin >> n, siz = n;\n    for (int i = 1; i <= n; i++) scanf(\"%d\", &g[i]);\n    build();\n    int op, l, r, k;\n    int lstans = 0;\n    cin >> m;\n    for (int i = 1; i <= m; i++) {\n        scanf(\"%d %d %d\", &op, &l, &r);\n        l = (l + lstans - 1) % n + 1, r = (r + lstans - 1) % n + 1;\n        if (l > r) swap(l, r);\n        if (op == 1) {\n            int v = del(r);\n            fins(l, v);\n        } else\n            scanf(\"%d\", &k), k = (k + lstans - 1) % n + 1, printf(\"%d\\n\", lstans = query(l, r, k));\n    }\n    return 0;\n}\n```",
        "postTime": 1665718087,
        "uid": 615348,
        "name": "zhouershan",
        "ccfLevel": 7,
        "title": "CF455D Serega and Fun \u9898\u89e3"
    }
]