[
    {
        "content": "> [CF601E A Museum Robbery](http://codeforces.com/problemset/problem/601/E)\n>\n> \u6700\u521d\u7ed9\u5b9a $n$ \u4e2a\u7269\u54c1\u4ee5\u53ca\u80cc\u5305\u5bb9\u91cf $k$\uff0c\u6709 $q$ \u6b21\u64cd\u4f5c\uff0c\u64cd\u4f5c\u6709\u4e09\u79cd\uff1a\n>\n> - `1 v w` \u5728\u80cc\u5305\u91cc\u6dfb\u52a0\u4e00\u4e2a\u4f53\u79ef\u4e3a $v$ \u4ef7\u503c\u4e3a $w$ \u7684\u7269\u54c1\n> - `2 x` \u5220\u9664\u7f16\u53f7\u4e3a $x$ \u7684\u7269\u54c1\n> - `3` \u67e5\u8be2\u80cc\u5305\u603b\u548c\uff0c\u4ee5 $\\sum\\limits_{m=1}^{k}{s(m)*p^{m-1}\\ \\bmod\\ q}$ \u7684\u5f62\u5f0f\u8f93\u51fa\n>\n> $n \\leq 5000,k \\leq 1000,q \\leq 30000$ \uff0c\u4fdd\u8bc1\u64cd\u4f5c $1$ \u7684\u4e2a\u6570\u4e0d\u8d85\u8fc7 $10000$\uff0c\u4e14\u81f3\u5c11\u6709\u4e00\u4e2a\u64cd\u4f5c $3$\u3002\n\n<!--more-->\n\n## \u89e3\u9898\u601d\u8def\uff1a\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\uff0c\u5728\u80cc\u5305\u91cc\u52a0\u5165\u4e00\u4e2a\u7269\u54c1\u662f $\\mathcal{O}(n)$ \u7684\uff0c\u4f46\u662f\u5220\u9664\u4e00\u4e2a\u7269\u54c1\u5e76\u4e0d\u597d\u5904\u7406\uff0c\u53ea\u60f3\u5230\u4e86\u91cd\u505a\u4e00\u904d\u80cc\u5305\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u8fd9\u6837\u662f $\\mathcal{O}(n^2)$ \u7684\uff0c\u663e\u7136\u4f1a\u5bc4\u3002\n\n\u63a5\u4e0b\u6765\u89c2\u5bdf\u9898\u76ee\u7684\u524d\u4e24\u4e2a\u64cd\u4f5c\uff0c\u53d1\u73b0\u5982\u679c\u6211\u4eec\u628a\u6700\u5f00\u59cb\u7684\u7269\u54c1\u770b\u4f5c\u5728\u65f6\u95f4\u70b9 $0$\uff0c\u90a3\u4e48\u5b9e\u9645\u4e0a\u6240\u6709\u7269\u54c1\u53ef\u4ee5\u8003\u8651\u6210\u5728\u4e00\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u51fa\u73b0\uff0c\u8fd9\u4e2a\u5c31\u5f88\u7b26\u5408**\u7ebf\u6bb5\u6811\u5206\u6cbb**\u7684\u5957\u8def\u4e86\u3002\n\n\u786e\u5b9a\u4e86\u7b97\u6cd5\u4e4b\u540e\uff0c\u5c31\u5f00\u59cb\u8003\u8651\u600e\u4e48\u5199\u3002\u9996\u5148\u6211\u4eec\u8bb0\u64cd\u4f5c $3$ \u7684\u4e2a\u6570\u6709 $cnt$ \u4e2a\uff0c\u9996\u5148\u7ebf\u6bb5\u6811\u5efa\u5728 $[1,cnt]$ \u4e0a\uff0c\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u8282\u70b9\u4e0a\u8003\u8651\u5f00\u4e00\u4e2a `vector` \u6765\u4fdd\u5b58\u8fd9\u4e2a\u8282\u70b9\u4ee3\u8868\u7684\u533a\u95f4\u5b58\u5728\u7684\u7269\u54c1\u3002\u6211\u4eec\u53d1\u73b0\u8fd9\u91cc\u5b9e\u9645\u4e0a\u4e0d\u597d\u5408\u5e76\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u7528**\u6807\u8bb0\u6c38\u4e45\u5316**\u7684\u65b9\u6cd5\u3002\n\n\u5728\u5206\u6cbb\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u6bcf\u8bbf\u95ee\u5230\u4e00\u4e2a\u8282\u70b9\u8003\u8651\u4e00\u4e2a\u989d\u5916\u7684 $g$ \u6570\u7ec4\u4f5c\u80cc\u5305\u7528\uff0c\u5c06 $f$ \u62f7\u8d1d\u5230 $g$ \u540e\u5bf9\u4e8e $g$ \u8fdb\u884c\u65b0\u589e\u7269\u54c1\u7684\u80cc\u5305\u64cd\u4f5c\u3002\u800c\u5728\u5206\u6cbb\u4e4b\u540e\u76f4\u63a5\u4e0b\u4f20 $g$ \u6570\u7ec4\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\u4e00\u4e2a\u4f2a\u4ee3\u7801\u6846\u67b6\u4e86\uff1a\n\n```cpp\nvoid solve(int p,ll *f) {\n    ll g[N];\n    for (int i = 0;i <= sto;++i) g[i] = f[i];\n    for (auto now : tree[p].vec) {\n        Add(g,now);//\u5c06\u7269\u54c1 now \u6dfb\u52a0\u5230 g \u4e2d\u3002\n    }\n    if (tree[p].l == tree[p].r) {\n        Output();\n        return ;\n    } else {\n        //\u6ce8\u610f\u6b64\u5904\u4e0b\u4f20\u662f g \u6570\u7ec4\uff0c\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u7269\u54c1\u4e86\u3002\n        solve(p << 1,g);\n        solve(p << 1 | 1,g);\n    }\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}((n+q)\\log (n+q) + q)$\u3002\u6ce8\u610f\u6570\u7ec4\u5982\u679c\u5f00\u7684\u8f83\u5927\u4e0d\u8981\u4f7f\u7528 `memset`\u3002\n\n## \u4ee3\u7801\uff1a\n\n```cpp\nconst int N = 1e5 + 10;\nconst ll base = 1e7 + 19;\nconst ll mod = 1e9 + 7;\n\nstruct item {\n    int x,y,v,w;\n}E[N];\n\nstruct node {\n    int l,r;\n    vector <item> vec;\n}tree[N<<2];\n\nll qwq[N];\nint tot,n,q,sto;\n\nvoid build(int p,int l,int r) {\n    tree[p].l = l,tree[p].r = r;\n    if (l == r) {\n        return ;\n    }\n    int mid = (l + r) >> 1;\n    build(p << 1,l,mid);\n    build(p << 1 | 1,mid + 1,r);\n}\n\nvoid change(int p,int x,int y,int num) {\n    if (tree[p].l >= x && tree[p].r <= y) {\n        tree[p].vec.push_back(E[num]);\n        return ;\n    }\n    int mid = (tree[p].l + tree[p].r) >> 1;\n    if (x <= mid) change(p << 1,x,y,num);\n    if (y > mid) change(p << 1 | 1,x,y,num);\n}\n\nvoid solve(int p,ll *f) {\n    ll g[N];\n    for (int i = 0;i <= sto;++i) g[i] = f[i];\n    for (auto now : tree[p].vec) {\n        for (int j = sto;j >= now.v;--j) {\n            g[j] = max(g[j],g[j - now.v] + now.w); \n        }\n    }\n    if (tree[p].l == tree[p].r) {\n        ll ans = 0;\n        for (int i = sto;i >= 1;--i) ans = (ans * base + g[i]) % mod;\n        printf(\"%lld\\n\",ans);\n    } else {\n        solve(p << 1,g);\n        solve(p << 1 | 1,g);\n    }\n}\n\n\nsigned main() {\n    read(n,sto);\n    for (int i = 1;i <= n;++i) {\n        int v,w;read(w,v);\n        E[++tot] = {1,-1,v,w};\n    }\n    int tt = 1;\n    read(q);\n    for (int i = 1;i <= q;++i) {\n        int opt;read(opt);\n        if (opt == 1) {\n            int v,w;read(w,v);\n            E[++tot] = {tt,-1,v,w};\n        }\n        if (opt == 2) {\n            int x;read(x);\n            E[x].y = tt - 1;\n        }\n        if (opt == 3) {\n            ++tt;\n        }\n    }\n    --tt;\n    build(1,1,tt);\n    for (int i = 1;i <= tot;++i) {\n        if (E[i].y == -1) E[i].y = tt;\n        if (E[i].x <= E[i].y) {\n            change(1,E[i].x,E[i].y,i);\n        }\n    }\n    solve(1,qwq);\n\treturn 0;\n}\n```\n\nAD\uff1a![](https://cdn.luogu.com.cn/upload/image_hosting/cns1ec5k.png)",
        "postTime": 1646210883,
        "uid": 105230,
        "name": "Retired_Doubeecat",
        "ccfLevel": 6,
        "title": "CF601E"
    },
    {
        "content": "## \u5206\u6790\n\n\u7b2c\u4e00\u9053\u7ebf\u6bb5\u6811\u5206\u6cbb\u9898\u796d\u3002\n\n\u7ebf\u6bb5\u6811\u5206\u6cbb\u5462\uff0c\u5904\u7406\u7684\u597d\u50cf\u5c31\u662f\u8fd9\u4e9b\u57fa\u4e8e\u65f6\u95f4\u4e0a\u7684\u7269\u54c1\u52a0\u5165\u5220\u9664\u95ee\u9898\uff0c\u6211\u4eec\u5c06\u6240\u6709\u4e8b\u4ef6\u79bb\u7ebf\u5904\u7406\uff0c\u6bcf\u4e00\u4e2a\u8be2\u95ee\u4ee3\u8868\u4e00\u4e2a\u65f6\u523b\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7269\u54c1\uff0c\u5904\u7406\u5b83\u6240\u5b58\u5728\u7684\u65f6\u6bb5\uff0c\u6982\u62ec\u4e00\u4e0b\u5c31\u662f\u7528\u7ebf\u6bb5\u6811\u6765\u5904\u7406\u6bcf\u4e00\u4e2a\u7269\u54c1\u80fd\u5bf9\u54ea\u4e9b\u8be2\u95ee\u8d77\u4f5c\u7528\u3002\n\n\u6240\u4ee5\u7ebf\u6bb5\u6811\u6bcf\u4e00\u4e2a\u8282\u70b9\u5c31\u4ee3\u8868\u4e86\u4e00\u4e2a\u65f6\u6bb5\uff0c\u800c\u5728\u8be2\u95ee\u4e2d\u6211\u4eec\u901a\u5e38\u662f\u627e\u67d0\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c\u6240\u4ee5\u7c7b\u4f3c\u4e8e\u6807\u8bb0\u6c38\u4e45\u5316\u7684\u601d\u60f3\uff0c\u5728\u4ece\u4e0a\u5230\u4e0b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u80fd\u8986\u76d6\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u533a\u95f4\u5185\u7684\u70b9\u4e5f\u80fd\u540c\u6837\u9020\u6210\u5f71\u54cd\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u5c06\u6bcf\u4e00\u4e2a\u7269\u54c1\u52a0\u5230\u5b83\u5bf9\u5e94\u7684\u533a\u95f4\uff0c\u7528 vector \u5b58\u50a8\u5b8c\u5168\u8986\u76d6\u67d0\u4e00\u533a\u95f4\u7684\u7269\u54c1\u6709\u54ea\u4e9b\u3002\n\n\u7136\u540e\u4ee5\u6b64\u9898\u4e3a\u4f8b\uff0c\u5728\u4ece\u4e0a\u5230\u4e0b\u7684\u8fc7\u7a0b\u4e2d\u5c06\u5305\u542b\u6574\u4e2a\u533a\u95f4\u7684\u7269\u54c1\u4ece\u7ebf\u6bb5\u6811\u4e2d\u63d0\u51fa\uff0c\u518d\u8fdb\u884c\u80cc\u5305\u95ee\u9898\u7684\u5904\u7406\uff0c\u518d\u5c06\u80cc\u5305\u6570\u7ec4\u4f20\u7ed9\u5de6\u53f3\u4e24\u533a\u95f4\uff0c\u7ee7\u7eed\u5206\u6cbb\u4e0b\u53bb\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define ls rt<<1\n#define rs rt<<1|1\ninline void read(int &res){\n\tres=0;\n\tint f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9')res=(res<<1)+(res<<3)+c-48,c=getchar();\n\tres*=f;\n}\nconst int base=1e7+19,mod=1e9+7;\nint n,k,q,ti;\nint csf[1005];\nint l[15005],r[15005],v[15005],w[15005],cnt;\nvector<int>V[120005];\nvoid modify(int rt,int l,int r,int L,int R,int k){\n\tif(L>R)return;\n\tif(l>=L&&R>=r){\n\t\tV[rt].push_back(k);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif(mid>=L)modify(ls,l,mid,L,R,k);\n\tif(mid<R)modify(rs,mid+1,r,L,R,k);\n}\nvoid solve(int rt,int l,int r,int f[]){\n\tfor(int i=0;i<V[rt].size();i++){\n\t\tint x=V[rt][i];//\u63d0\u53d6\u7269\u54c1 \n\t\tfor(int j=k;j>=w[x];j--){//01\u80cc\u5305 \n\t\t\tf[j]=max(f[j],f[j-w[x]]+v[x]);\n\t\t}\n\t}\n\tif(l==r){\n\t\tif(l==1)return;//\u8d77\u59cb\u70b9\uff0c\u56e0\u4e3ati\u521d\u59cb\u4e3a1\u7ebf\u6bb5\u6811\u4f1a\u65b9\u4fbf\u4e00\u70b9\uff0c\u6240\u4ee5\u5728\u8fd9\u91cc\u591a\u4e86\u4e00\u4e2a\u7279\u5224 \n\t\tint b=1,sum=0;\n\t\tfor(int i=1;i<=k;i++){\n\t\t\tsum=(sum+f[i]*b)%mod;\n\t\t\tb=b*base%mod;\n\t\t}\n\t\tprintf(\"%lld\\n\",sum);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tint g[k+1];\n\tfor(int i=0;i<=k;i++)g[i]=f[i];\n\t//\u8fd9\u91cc\u4e0b\u53bb\u4f1a\u76f4\u63a5\u5728\u5b50\u4efb\u52a1\u4e2d\u4fee\u6539f\u6570\u7ec4\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u5c06f\u4f20\u7ed9\u53f3\u5206\u6cbb\u4efb\u52a1\uff0c\u6240\u4ee5\u65b0\u5efag\u4ee5\u5b58\u50a8 \n\tsolve(ls,l,mid,f);\n\tsolve(rs,mid+1,r,g);\n}\nsigned main()\n{\n\tread(n);read(k);\n\tcnt=n;\n\tti=1;\n\tfor(int i=1;i<=n;i++){\n\t\tread(v[i]);read(w[i]);\n\t\tl[i]=ti;//\u8d77\u59cb\u65f6\u95f4 \n\t}\n\tread(q);\n\twhile(q--){\n\t\tint op,x,y,z;\n\t\tread(op);\n\t\tif(op==1){\n\t\t\tread(x);read(y);\n\t\t\tv[++cnt]=x;w[cnt]=y;\n\t\t\tl[cnt]=ti+1;//\u524d\u9762\u90a3\u4e2a\u8be2\u95ee\u5b83\u7ba1\u4e0d\u5230\uff0c\u6240\u4ee5+1 \n\t\t}\n\t\telse if(op==2){\n\t\t\tread(x);\n\t\t\tr[x]=ti;\n\t\t}\n\t\telse ti++;//\u591a\u4e00\u8be2\u95ee\uff0c\u65f6\u95f4\u70b9++ \n\t}\n\tfor(int i=1;i<=cnt;i++){\n\t\tif(r[i])modify(1,1,ti,l[i],r[i],i);\n\t\telse modify(1,1,ti,l[i],ti,i);//\u5bfb\u627e\u8be5\u7269\u54c1\u6240\u80fd\u5b8c\u5168\u8986\u76d6\u7684\u6bcf\u4e00\u4e2a\u6700\u5927\u533a\u95f4\uff0c\u52a0\u5165\u5bf9\u5e94vector \n\t}\n\tsolve(1,1,ti,csf);//\u5f00\u59cb\u5206\u6cbb \n}\n\n```\n",
        "postTime": 1639450861,
        "uid": 166410,
        "name": "\u6f20\u5bd2",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF601E A Museum Robbery"
    },
    {
        "content": "\u8003\u8651\u7ebf\u6bb5\u6811\u5206\u6cbb\u3002\n\n\u7ebf\u6bb5\u6811\u5206\u6cbb\u5b9e\u9645\u4e0a\u5c31\u662f\u5c06\u628a\u65f6\u95f4\u6309\u7167\u7ebf\u6bb5\u6811\u7684\u65b9\u6cd5\u5206\u6cbb\u4e0b\u53bb\u3002\u7ebf\u6bb5\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u65f6\u95f4\u533a\u95f4\uff0c\u9884\u5904\u7406\u7684\u65f6\u5019\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u7684\u201c\u5b58\u6d3b\u65f6\u95f4\u201d\u5b8c\u5168\u8986\u76d6\u8fd9\u4e2a\u65f6\u95f4\u533a\u95f4\uff0c\u5c31\u7ed9\u8fd9\u4e2a\u65f6\u95f4\u533a\u95f4\u6253\u4e0a\u6807\u8bb0\u5e76\u8fd4\u56de\u3002\u7136\u540e\u5728\u7ebf\u6bb5\u6811\u4e0aDFS\uff0c\u6bcf\u6b21\u5411\u4e0b\u8d70\u5230\u4e00\u4e2a\u8282\u70b9\u5c06\u8fd9\u4e2a\u8282\u70b9\u7684\u64cd\u4f5c\u52a0\u5165\uff0c\u79bb\u5f00\u65f6\u5220\u9664\u5373\u53ef\u3002\n\n\u7ebf\u6bb5\u6811\u5206\u6cbb\u5927\u591a\u6570\u60c5\u51b5\u5c31\u662f\u7528\u6765\u89e3\u51b3\uff1a\u52a0\u5165\u67d0\u4e2a\u5143\u7d20\u4e4b\u540e\u5220\u9664\u8fd9\u4e2a\u5143\u7d20\u5f88\u9ebb\u70e6\uff0c\u4f46\u662f\u6309\u7167\u63d2\u5165\u7684\u987a\u5e8f\u4ece\u540e\u5230\u524d\u201c\u64a4\u9500\u201d\u5f88\u65b9\u4fbf\u3002\uff08\u7c7b\u4f3c\u6808\u7684\u7ed3\u6784\uff1a\u53ea\u80fd\u5f39\u51fa\u9876\u90e8\uff0c\u4e0d\u80fd\u5220\u9664\u4e2d\u95f4\u7684\u3002\uff09\n\n\u800c\u8fd9\u9053\u9898 \u662f\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\u7684\u3002\u6bcf\u6b21\u9012\u5f52\u4e4b\u524d\u53ea\u9700\u8981\u628a\u9012\u5f52\u4e4b\u524d\u7684\u72b6\u6001\u590d\u5236\u4e00\u4e2a\u201c\u5907\u4efd\u201d\u3002\u7136\u540e\u66b4\u529b\u7684\u628a\u201c\u5907\u4efd\u201d\u8fd8\u539f\u5373\u53ef\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\n#include<cstring>\n#include<vector>\n#include<queue>\n#define vi vector<int>\n#define pb push_back\n#define mk make_pair\n#define pii pair<int,int>\n#define rep(i,a,b) for(int i=(a),i##end=(b);i<=i##end;i++)\n#define fi first\n#define se second\ntypedef long long ll;\nusing namespace std;\nconst int maxn=41000;\nconst int p=1e7+19;\nconst int q=1e9+7;\nint ed[maxn],st[maxn];\npii item[maxn];\nbool query[maxn];\nint pro[maxn];\nint k;\nvi add[maxn*4];\nvoid update(int l,int r,int rt,int tl,int tr,int node){\n    if(tl<=l&&r<=tr){\n        add[rt].pb(node);return;\n    }\n    int mid=(l+r)>>1;\n    if(tl<=mid)update(l,mid,rt<<1,tl,tr,node);\n    if(tr>=mid+1)update(mid+1,r,rt<<1|1,tl,tr,node);\n}\nll ksm(ll num,ll t){\n    ll res=1;num%=q;\n    for(;t;t>>=1,num=num*num%q){\n        if(t&1)res=res*num%q;\n    }\n    return res;\n}\nint tmp[1005];\nvoid solve(int l,int r,int rt){\n    int buc[1005]={0};\n    rep(i,0,(int)add[rt].size()-1){\n        int id=add[rt][i];\n        for(int j=k;j>=0;j--){\n            if(j+item[id].se<=k)tmp[j+item[id].se]=max(tmp[j+item[id].se],tmp[j]+item[id].fi);\n        }\n    }\n    if(l==r){\n        if(query[l]){\n            ll ans=0;\n            rep(m,1,k){\n                ans+=1ll*tmp[m]*pro[m-1]%q;ans%=q;\n            }\n            printf(\"%lld\\n\",ans);\n        }\n        return;\n    }\n    int mid=(l+r)>>1;\n    memcpy(buc,tmp,sizeof(tmp));\n    solve(l,mid,rt<<1);\n    memcpy(tmp,buc,sizeof(tmp));\n    solve(mid+1,r,rt<<1|1);\n}\nint main(){\n    rep(i,0,1005)pro[i]=ksm(p,i);\n    int n;scanf(\"%d%d\",&n,&k);\n    rep(i,1,n)\n    {scanf(\"%d%d\",&item[i].fi,&item[i].se);st[i]=1;}\n    int q;scanf(\"%d\",&q);int item_cnt=n;\n    rep(i,1,q){\n        int ty;scanf(\"%d\",&ty);\n        if(ty==1){\n            ++item_cnt;scanf(\"%d%d\",&item[item_cnt].fi,&item[item_cnt].se);st[item_cnt]=i;\n        }\n        else if(ty==2){\n            int x;scanf(\"%d\",&x);ed[x]=i;\n        }\n        else query[i]=1;\n    }\n    rep(i,1,item_cnt)if(!ed[i])ed[i]=q;\n    rep(i,1,item_cnt)\n    update(1,q,1,st[i],ed[i],i);\n    solve(1,q,1);\n    return 0;\n}\n```\n\n",
        "postTime": 1587347254,
        "uid": 43420,
        "name": "GavinZheng",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF601E \u3010A Museum Robbery\u3011"
    },
    {
        "content": "\u7535\u4fe1\u8bc8\u9a97\u9898\u3002\n\n\u8003\u8651\u6bcf\u6b21\u64cd\u4f5c\u66b4\u529b\u600e\u4e48\u505a\uff0c\u8003\u8651\u66b4\u529b\u80cc\u5305\uff0c\u4ee5\u6df7\u4e71\u5ea6\u4e3a\u91cd\u91cf\uff0c\u4ef7\u503c\u4e3a\u4ef7\u503c\u3002\n\n\u5982\u679c\u4f60\u4e0d\u4ed4\u7ec6\u770b\u82f1\u6587\u9898\u9762\uff0c\u4f60\u4f1a\u53d1\u73b0\u80cc\u5305\u5bb9\u91cf $\\le 10^6$\u3002\u7ed3\u679c\u4f60\u53d1\u73b0\u6709\u4e00\u4e2a $k\\le 1000$\uff0c\u8fd9\u662f\u9898\u76ee\u67e5\u8be2\u7684\u80cc\u5305\u6700\u5927\u5bb9\u91cf\u3002\u3002\u3002\u6240\u4ee5\u80cc\u5305\u5bb9\u91cf\u6700\u5927\u53ea\u6709 $1000$\u3002\n\n\u53c8\u52a0\u5165\u53c8\u64a4\u9500\uff0c\u5e76\u4e14\u52a0\u5165\u4e00\u4e2a\u7269\u54c1\u590d\u6742\u5ea6\u4ec5\u4e3a $O(k)$\uff0c\u7ebf\u6bb5\u6811\u5206\u6cbb\u79bb\u7ebf\u5904\u7406\u3002\n\n\u590d\u6742\u5ea6 $O((n+q)k\\log n)$\u3002\n\n~~\u81ea\u5df1\u90fd\u88ab\u81ea\u5df1\u4ee3\u7801\u4e11\u5230\u4e86\uff08\u5410~~\n\n\n```cpp\n#include <bits/stdc++.h>\n#define ve vector\n#define eb emplace_back\n#define LL long long\nusing namespace std;\nconst int P(1e7+19),Q(1e9+7);\nint n,k,q;\n#define pii pair<int,int>\n#define fi first\n#define se second\nstruct SGT\n{\n\t#define Ts int rt=1,int L=0,int R=q\n\t#define mid (L+R>>1)\n\t#define Ls rt<<1,L,mid\n\t#define Rs rt<<1|1,mid+1,R\n\tve<ve<int>> tr;\n\tvoid push(int l,int r,int id,Ts)\n\t{\n\t\tif (l<=L&&R<=r) return tr[rt].eb(id),void();\n\t\tif (l<=mid) push(l,r,id,Ls);\n\t\tif (r>mid) push(l,r,id,Rs);\n\t}\n\tvoid solve(ve<LL>dp,ve<pii>&ths,ve<int>&pw,ve<bool>&ask,Ts)\n\t{\n\t\tfor (int i:tr[rt]) \n\t\t\tfor (int j(k);j>=ths[i].se;--j) \n\t\t\t\tdp[j]=max(dp[j],dp[j-ths[i].se]+ths[i].fi);\n\t\tif (L==R)\n\t\t{\n\t\t\tif (ask[L])\n\t\t\t{\n\t\t\t\tint ans(0);\n\t\t\t\tfor (int i(1);i<=k;++i) (ans+=1ll*dp[i]*pw[i-1]%Q)%=Q;\n\t\t\t\tcout<<ans<<'\\n';\n\t\t\t}\n\t\t\treturn ;\n\t\t}\n\t\tsolve(dp,ths,pw,ask,Ls),solve(dp,ths,pw,ask,Rs);\n\t}\n\t#undef Ts\n\t#undef mid\n\t#undef Ls\n\t#undef Rs\n\tSGT(int q):tr(q+5<<2) {}\n};\nint main()\n{\n\tcin.tie(0)->sync_with_stdio(0);\n\tcin>>n>>k;\n\tve<pii> ths(n);\n\tve<int> ti(n),pw(k);\n\tpw[0]=1;\n\tfor (int i(1);i<k;++i) pw[i]=1ll*pw[i-1]*P%Q;\n\tfor (pii &i:ths) cin>>i.fi>>i.se;\n\tcin>>q;\n\tSGT sgt(q);\n\tve<bool> ask(q+1);\n\tfor (int i(1),op,x,y;i<=q;++i)\n\t{\n\t\tcin>>op;\n\t\tif (op==1) \n\t\t{\n\t\t\tcin>>x>>y,ths.eb(x,y),ti.eb(i);\n\t\t}else if (op==2)\n\t\t{\n\t\t\tcin>>x,--x,sgt.push(ti[x],i-1,x),ti[x]=-1;\n\t\t}else ask[i]=1;\n\t}\n\tfor (int i(0),l(ths.size());i<l;++i)\n\t\tif (~ti[i]) sgt.push(ti[i],q,i);\n\tsgt.solve(ve<LL>(k+1),ths,pw,ask);\n\treturn 0;\n}\n```",
        "postTime": 1670847646,
        "uid": 312306,
        "name": "LJ07",
        "ccfLevel": 0,
        "title": "[Solution]CF601E"
    },
    {
        "content": "**\u9898\u610f**\n\n\u7ef4\u62a4\u4e00\u4e2a\u7269\u54c1\u7684\u96c6\u5408\uff0c\u7269\u54c1\u6709\u91cd\u91cf\u548c\u4ef7\u503c\uff0c\u521a\u5f00\u59cb\u6709 $n$ \u4e2a\u7269\u54c1\uff0c\u6709 $q$ \u4e2a\u8be2\u95ee\uff1a\n\n1. \u63d2\u5165\u4e00\u4e2a\u65b0\u7269\u54c1\n2. \u5220\u9664\u4e00\u4e2a\u7269\u54c1\n3. \u8be2\u95ee $\\sum_{1 \\le x \\le k} s(x) a^{x - 1} \\bmod b$\uff0c\u5176\u4e2d $s(x)$ \u4e3a\u91cd\u91cf\u4e0d\u8d85\u8fc7 $x$ \u7684\u7269\u54c1\u7684\u6700\u5927\u4ef7\u503c\uff0c$a = 10^7 + 19, b = 10^9 + 7$\uff0c$k$ \u7531\u8be2\u95ee\u7ed9\u51fa\u3002\n\n$n \\le 5 \\times 10^3, 1 \\le k \\le 10^3, 1 \\le v \\le 10^6, q \\le 3 \\times 10^4$\uff0c\u81f3\u591a\u63d2\u5165 $C = 10^4$ \u4ef6\u7269\u54c1\u3002\n\n**\u9898\u89e3**\n\n\u5b9e\u9645\u4e0a\u5c31\u662f\u52a8\u6001\u7ef4\u62a4\u96c6\u5408\u7684\u80cc\u5305\uff0c\u652f\u6301\u63d2\u5165\u548c\u5220\u9664\u3002\n\n\u80cc\u5305\u7684\u63d2\u5165\u548c\u590d\u5236\u662f $\\mathcal{O}(k)$ \u7684\uff0c\u5408\u5e76\u662f $\\mathcal{O}(k^2)$ \u7684\uff0c\u7269\u54c1\u5728\u65f6\u95f4\u533a\u95f4\u4e0a\u6709\u8d21\u732e\uff0c\u6240\u4ee5\u7528\u7ebf\u6bb5\u6811\u5206\u6cbb\u6765\u907f\u514d\u5408\u5e76\uff0c\u5c06\u67d0\u65f6\u523b\u7684\u8d21\u732e\u548c\u8f6c\u5316\u4e3a\u5206\u6cbb\u7ed3\u6784\u8def\u5f84\u4e0a\u5143\u7d20\u7684\u8d21\u732e\u548c\u3002  \n\n\u6bcf\u4e2a\u8d21\u732e\u88ab\u5207\u5206\u6210 $\\log$ \u4e2a\u7ed3\u70b9\uff0c\u91c7\u7528\u7c7b\u4f3c\u6807\u8bb0\u6c38\u4e45\u5316\u7684\u601d\u60f3\u628a\u8d21\u732e\u5143\u7d20\u90fd\u5b58\u5728\u7ebf\u6bb5\u6811\u7684\u7ed3\u70b9\u4e0a\u3002\u6bcf\u4e2a\u7ed3\u70b9\u7684\u6240\u6709\u5143\u7d20\u8fdb\u884c\u4e86\u4e00\u6b21\u63d2\u5165\uff0c\u6240\u6709\u5de6\u4fa7\u7ed3\u70b9\u7684\u80cc\u5305\u8fd8\u8fdb\u884c\u4e86\u4e00\u6b21\u590d\u5236\u3002\u5143\u7d20\u5171\u8fdb\u884c\u4e86 $\\log$ \u6b21\u63d2\u5165\uff08\u5728\u6bcf\u4e2a\u7ed3\u70b9\uff09\u3002\u603b\u7684\u590d\u5236\u6b21\u6570\u4e0d\u591a\u4e8e\u603b\u7684\u63d2\u5165\u6b21\u6570\u3002\n\n\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}((n + C)k \\log (n + C) + q)$\u3002\n\n```cpp\nint pp[maxk];\nstruct obj { int v, w; };\nstruct segTDiv {\n    vector< vector<obj> > v;\n    vector<int> ans;\n    int k, mt;\n    void init(int mxtim, int kk) {\n        v.resize(mxtim << 2 | 1);\n        ans.resize(mxtim << 2 | 1);\n        k = kk, mt = mxtim;\n    }\n    void insert(int p, int lp, int rp, int l, int r, obj &ob) {\n        if(l <= lp && rp <= r) { \n            v[p].push_back(ob);\n            return ; \n        }\n        register int mid = (lp + rp) >> 1;\n        if(l <= mid) insert(p << 1, lp, mid, l, r, ob);\n        if(r > mid) insert(p << 1 | 1, mid + 1, rp, l, r, ob);\n    }\n    void qry() {\n        vector<int> f(k + 1);\n        dfs(1, 1, mt, f);\n    }\n    void dfs(int p, int lp, int rp, vector<int> &f) {\n        for(auto ob : v[p])\t\n            for(int i = k; i - ob.w >= 0; -- i)\n                f[i] = max(f[i], f[i - ob.w] + ob.v);\n        if(lp == rp) {\n            int tmp = 0, tf = 0;\n            rep(i,1,k) { tf = max(tf, f[i]); tmp = (tmp + 1ll * tf * pp[i - 1] % q) % q;  }\n            ans[lp] = tmp;\n            return ;\n        }\n        register int mid = (lp + rp) >> 1;\n        vector<int> g = f;\n        dfs(p << 1, lp, mid, g);\n        dfs(p << 1 | 1, mid + 1, rp, f);\n    }\n} tree;\n\nobj ob[maxn + maxq], tms[maxn + maxq];\nint main() {\n    // ... \u7701\u7565\u8f93\u5165\u548c\u9884\u5904\u7406\uff0c\u7ed3\u679c\u662f\u7269\u54c1\u4fe1\u606f\u653e\u5165 ob \uff0c\u4f5c\u7528\u65f6\u95f4\u653e\u5165 tms\uff0c\u8be2\u95ee\u65f6\u95f4\u70b9\u653e\u5165 qtm\uff0ctimer\u5b58\u50a8\u6700\u5927\u65f6\u95f4\u3002\n    tree.init(timer, k);\n    rep(i,1,pob)\n        tree.insert(1, 1, timer, tms[i].v, tms[i].w == 0 ? timer : tms[i].w, ob[i]);\ttree.qry();\n    for(int tm : qtm) printf(\"%d\\n\", tree.ans[tm]);\n    return 0;\n}\n```\n\n",
        "postTime": 1645131929,
        "uid": 88735,
        "name": "\u5bd2\u9e3d\u513f",
        "ccfLevel": 0,
        "title": "\u7ebf\u6bb5\u6811\u5206\u6cbb\u677f\u5b50"
    },
    {
        "content": "\u9898\u610f\uff1a\u52a8\u6001\u52a0/\u5220\u9664\u7269\u54c1\u3001\u52a8\u6001\u8fdb\u884c\u80cc\u5305DP\n\n\u8003\u8651\u79bb\u7ebf\u505a\u6cd5\uff0c\u7ebf\u6bb5\u6811\u5206\u6cbb\uff08\u7c7b\u4f3c\u4e8eCDQ\u5206\u6cbb\uff09\n\n\u5bf9 **\u7269\u54c1\u5b58\u5728\u7684\u65f6\u95f4** \u5efa\u7ebf\u6bb5\u6811\uff0c **\u52a0/\u5220\u9664\u7269\u54c1** \u7684\u64cd\u4f5c\u4f1a\u4f7f\u8be5\u7269\u54c1\u5b58\u5728\u4e8e\u4e00\u6bb5\u65f6\u95f4\uff08\u533a\u95f4\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2a\u7269\u54c1\u6700\u591a\u4f1a\u88ab\u5b58\u8fdb\u7ec4\u6210\u65f6\u95f4\u533a\u95f4\u7684**\u6bcf\u4e2a\u8282\u70b9\u7684vector\u4e0a\u8bb0\u5f55\u4e86\u8be5\u7269\u54c1**\n\n\u5efa\u597d\u6811\u4e4b\u540e\u9012\u5f52\u6bcf\u4e00\u4e2a\u53f6\u8282\u70b9\uff0c\u6bcf\u5230\u5f53\u524d\u8282\u70b9\u5c31\u7528**vector\u91cc\u5b58\u7684\u7269\u54c1**\u66f4\u65b0\u80cc\u5305\u7684DP\u6570\u7ec4\uff0c\u5e76\u628a\u8fd9\u4e2aDP\u6570\u7ec4\u4f20\u7ed9\u5b83\u7684\u513f\u5b50\n\n\u6bcf\u4e2a\u53f6\u8282\u70b9\u7684\u65b9\u6848\u5c31\u662f\u5bf9\u4e8e\u5f53\u524d\u8be2\u95ee\u7684\u80cc\u5305\u7684\u7ed3\u679c\n\n```cpp\n#include<cstdio>\n#include<cctype>\n#include<cstring>\n#include<vector>\n#include<algorithm>\nusing namespace std;\n\nconst int maxn = 4e4 + 7;\nconst int maxk = 1e3 + 7;\nconst int base = 1e7 + 19;\nconst int MOD = 1e9 + 7;\ntypedef pair<int, int> pii;\ntypedef vector<pii>::iterator vit;\n\nstruct exhibits {\n\tint v, w, l, r;\n} exb[maxn];\nint k;\nvector<pii> seg[maxn<<2];\nlong long DP[maxk];\n\nint qr();\n\nvoid add (int p, int l, int r, int ql, int qr, int v, int w)  // \u79bb\u7ebf\u5904\u7406\u52a0/\u5220\u9664\u7269\u54c1\u64cd\u4f5c\n{\n\tif(ql <= l && r <= qr)\n\t{\n\t\tseg[p].push_back(make_pair(v, w));\n\t\treturn ;\n\t}\n\tint mid = (l+r)>>1;\n\tif(ql <= mid) add(p<<1, l, mid, ql, qr, v, w);\n\tif(mid < qr) add(p<<1|1, mid+1, r, ql, qr, v, w);\n}\n\nvoid solve (int p, int l, int r, long long * dp)  // \u7ebf\u6bb5\u6811\u5206\u6cbb+DP\n{\n\tfor(vit pp = seg[p].begin(); pp != seg[p].end(); pp++)\n\t\tfor(int j = k; j >= pp->second; j--) dp[j] = max(dp[j], dp[j-pp->second]+pp->first);\n\tif(l == r)\n\t{\n\t\tlong long ans = 0;\n\t\tfor(int i = k; i; i--) ans = (ans * base + dp[i]) % MOD;\n\t\tprintf(\"%lld\\n\",ans);\n\t\treturn ;\n\t}\n\tint mid = (l+r)>>1;\n\tlong long f[maxk];\n\tmemcpy(f, dp, sizeof(f));\n\tsolve(p<<1, l, mid, f);\n\tmemcpy(f, dp, sizeof(f));\n\tsolve(p<<1|1, mid+1, r, f);\n}\n\nint main ()\n{\n\tint n, q, opt, u, v, t = 1;\n\tn = qr(); k = qr();\n\tfor(int i = 1; i <= n; i++)  // \u539f\u7269\u54c1\u5b58\u5728\u7684\u65f6\u95f4\u662f[1, m],\u5176\u4e2dm\u4ee3\u8868\u8be2\u95ee\u7684\u6570\u91cf\uff08\u6682\u65f6\u672a\u77e5\uff0c\u8ba1\u4f5c-1\uff09\n\t{\n\t\tu = qr(); v = qr();\n\t\texb[i] = (exhibits){u, v, t, -1};\n\t}\n\tscanf(\"%d\",&q);\n\twhile(q--)\n\t{\n\t\topt = qr();\n\t\tif(opt == 1) {  u = qr(); v = qr(); exb[++n] = (exhibits){u, v, t, -1};  }  // \u6dfb\u52a0\u7269\u54c1\uff0c\u7269\u54c1\u6d88\u5931\u65f6\u95f4\u672a\u77e5\n\t\telse if(opt == 2) exb[qr()].r = t-1;  // \u5220\u9664\u7269\u54c1\uff0c\u7269\u54c1\u4e0d\u590d\u5b58\u5728\n\t\telse t++;  // \u8be2\u95ee\u64cd\u4f5c\n\t}\n\tt--;\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\texb[i].r = exb[i].r == -1 ? t : exb[i].r;\n\t\tif(exb[i].l <= exb[i].r) add(1, 1, t, exb[i].l, exb[i].r, exb[i].v, exb[i].w);\n\t}\n\tsolve(1, 1, t, DP);\n\treturn 0;\n}\n\ninline int qr ()\n{\n\tint num = 0;\n\tchar ch = getchar();\n\twhile(!isdigit(ch)) ch = getchar();\n\twhile(isdigit(ch)) num = (num<<1) + (num<<3) + ch - 48, ch = getchar();\n\treturn num;\n}\n```\n\n\n\u8fd8\u6709\u4e00\u9053\u7c7b\u4f3c\u7684\u9898\u76ee[P5416 \\[CTSC2016\\]\u65f6\u7a7a\u65c5\u884c](https://www.luogu.org/problem/P5416)\uff0c\u4e5f\u662f\u7ebf\u6bb5\u6811\u5206\u6cbb",
        "postTime": 1571921634,
        "uid": 76182,
        "name": "\u91d1\u6625\u6765",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF601E \u3010A Museum Robbery\u3011"
    }
]