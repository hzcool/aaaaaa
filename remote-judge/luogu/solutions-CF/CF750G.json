[
    {
        "content": "## \u9898\u610f\n\n\u4e00\u9897\u65e0\u7a77\u4e2a\u8282\u70b9\u7684\u5b8c\u5168\u4e8c\u53c9\u6811 \uff0c\u7f16\u53f7\u6ee1\u8db3\u7ebf\u6bb5\u6811\u5206\u914d\u3002\n\n\u6c42\u6709\u591a\u5c11\u6761\u6811\u4e0a\u7684\u7b80\u5355\u8def\u5f84\u7f16\u53f7\u548c\u4e3a $s$ \u3002\n\n$1\\le s\\le10^{15}$\n\n---\n\n## \u9898\u89e3\n\n### $1.$\u8003\u8651\u4e00\u6761\u94fe\n\n\u8003\u8651\u4ece\u8282\u70b9 $x$ \u5f00\u59cb\u8d70\u7684\u4e00\u6761\u8282\u70b9\u4e2a\u6570\u662f $h$ \u7684\u94fe\u3002\n\n\u5047\u8bbe\u4e00\u76f4\u5f80\u5de6\u5b50\u6811\u91cc\u8d70 \uff0c\u90a3\u4e48\u4ed6\u7684\u8d21\u732e\u662f\uff1a\n\n$$x\\sum_{i=0}^{h-1}2^i=(2^h-1)x$$\n\n\u82e5\u94fe\u4ece\u4e0b\u5f80\u4e0a\u7684\u7b2c $i\\in[1,h)$ \u4e2a\u70b9\u662f\u53f3\u513f\u5b50\u5219\u4f1a\u7ed9\u6807\u53f7\u548c\u5e26\u6765**\u72ec\u7acb\u7684** $\\displaystyle\\sum_{j=0}^{i-1}2^j=2^{i}-1$ \u7684\u8d21\u732e\u3002\n\n\u6ce8\u610f\u5230 $x$ \u7684\u53d6\u503c\u53ea\u80fd\u662f $\\displaystyle\\lfloor\\frac{s}{2^h-1}\\rfloor$ \u3002\n\n\u8bc1\u660e:\u5047\u8bbe\u53d6 $x-1$  \uff0c\u8fd9\u6761\u957f $h$ \u7684\u94fe\u5168\u90e8\u5f80\u53f3\u5b50\u6811\u91cc\u8d70\u7684\u8d21\u732e\u662f\uff1a\n\n$$(2^h-1)(x-1)+\\sum_{i=1}^{h-1}2^i-1=2^h-h\\le 2^h-1$$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $h\\in[1,\\log_2s]$ \uff0c\u5e76\u7b97\u51fa $x$ \uff0c\u4ee4 $ret=s-$ \u4e0a\u9762\u7684\u8d21\u732e\u3002\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u770b\u770b\u80fd\u4e0d\u80fd\u628a\u67d0\u4e9b\u70b9\u6362\u6210\u53f3\u513f\u5b50\u3002\n\n\u5373\u4ece\u5927\u5230\u5c0f\u8d2a\u5fc3\u7528 $2^{h-1}-1,\\ldots,3,1$ \u51d1\u51fa $ret$ \u3002\n\n### $2.$\u8003\u8651\u6709\u5206\u53c9\u7684\u60c5\u51b5\n\n\u5047\u8bbe\u8def\u5f84\u7684 $lca$ \u662f $x$ \uff0c\u8bbe\u4ece $x$ \u5de6\u513f\u5b50\u5f00\u59cb\u5411\u4e0b\u7684\u94fe\u957f\u5ea6\u4e3a $h_1$  \uff0c\u4ece $x$ \u53f3\u513f\u5b50\u5f00\u59cb\u5411\u4e0b\u7684\u94fe\u957f\u5ea6\u4e3a $h_2$  \uff0c\u679a\u4e3e $h_1,h_2\\in[1,\\log_2s]$ \u3002\n\n\u5047\u8bbe\u8fd9\u4e24\u6761\u94fe\u90fd\u5f80\u5de6\u8fb9\u8d70\u7684\u8d21\u732e\u662f\uff1a\n\n$$\nx+2x(2^{h_1}-1)+(2x+1)(2^{h_2}-1)+2^{h_2}-1\n=(2^{h_1+1}+2^{h_2+1}-3)x+2^{h_2}-1\n$$\n\n\u540c\u7406 $x$ \u7684\u4f4d\u7f6e\u4e5f\u662f\u552f\u4e00\u786e\u5b9a\u7684 \uff0c\u4ee4 $ret=s-$ \u4e0a\u9762\u7684\u8d21\u732e\u3002\n\n\u540c\u6837\u7684\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u600e\u4e48\u7528 $1,3,\\ldots,2^{h_1}-1,1,3,\\ldots,2^{h_2}-1$ \u51d1\u51fa $ret$ \u3002\n\n\u8fd9\u6837\u663e\u7136\u5f88\u96be\u505a \uff0c\u6211\u4eec\u8003\u8651\u7528 $2,2^2,\\ldots,2^{h_1},2,2^2,\\ldots,2^{h_2}$ \u6765\u51d1\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u9009\u4e86 $n$ \u4e2a\u6570 \uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u7528\u4e0a\u9762\u7684\u6570\u51d1\u51fa $ret+n$ \u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u7528 $O(h_1h_2)$ \u7684\u65f6\u95f4\u7528\u6570\u4f4d $DP$ \u6765\u6c42\u51fa\u3002\n\n### $3.$\u6570\u4f4d $DP$\n\n\u8bbe $f[i][j][k]$ \u8868\u793a\u524d $i+1$ \u4f4d\uff08\u56e0\u4e3a\u5f85\u9009\u6570\u91cc\u6ca1\u6709 $1$ \uff09\u9009\u4e86 $j$ \u4e2a\u6570 \uff0c\u8fd9\u4e00\u4f4d\u662f\u5426\u8fdb\u4f4d\uff08 $k=1/0$ \uff09\u7684\u65b9\u6848\u6570\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4f4d\u679a\u4e3e $2,2^2,\\ldots,2^{h_1}$ \u548c $2,2^2,\\ldots,2^{h_2}$ \u4e2d\u7684\u8fd9\u4e00\u4f4d\u586b\u4e0d\u586b\u3002\n\n\u6ce8\u610f\u5230\u56e0\u4e3a\u662f\u7b2c $i+1$ \u4f4d\u5982\u679c $i>h_1$ \u90a3\u4e48\u8fd9\u4e00\u4f4d\u662f\u4e0d\u80fd\u9009 $1$ \u7684 \uff0c\u53e6\u4e00\u8fb9\u540c\u7406\u3002\n\n\u5047\u8bbe $2,2^2,\\ldots,2^{h_1}$ \u4e2d\u8fd9\u4e00\u4f4d\u9009\u4e86 $a\\in[0,1]$  \uff0c\u53e6\u5916\u4e00\u4e2a\u9009\u4e86 $b\\in[0,1]$ \uff0c\u53ef\u5f97\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$\nf[i+1][j+a+b][\\frac{a+b+k}2]=\\sum f[i][j][k]\n$$\n\n\u6ce8\u610f\u8f6c\u79fb\u662f\u8981\u6ee1\u8db3 $\\displaystyle a+b+k\\equiv\\lfloor\\frac{ret+n}{2^i}\\rfloor\\pmod{2}$ \u7684\u3002\n\n\u5177\u4f53\u5b9e\u73b0~~\u4ee5\u53ca\u5361\u5e38~~\u53ef\u4ee5\u518d\u770b\u770b\u4ee3\u7801\u601d\u8003\u4e00\u4e0b\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log^5s)$\n\n```cpp\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(int i=a,i##end=(b)+1;i<i##end;++i)\n#define fd(i,a,b) for(int i=a,i##end=(b)-1;i>i##end;--i)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\nusing namespace std;\nconst int N=52;\ntypedef long long ll;\n/*-------------------------------------------------------------------------------------*/\nint m,p;ll n,ans,mi[N],f[N][2*N][2];\ninline ll sub(ll a,ll b){return a>=b?a-b:a;}\ninline ll calc(ll s,ll q,int a,int b,int t){\n    memset(f[p],0,sizeof f[p]);f[p][0][0]=1;\n    fp(i,1,log2(s)+1){\n        int d=(s>>i)&1;p^=1;memset(f[p],0,sizeof f[p]);\n        fp(j,0,2*i-2)fp(k,0,1)if(f[p^1][j][k])\n            fp(x,0,1)if(!x||i<a)fp(y,0,1)if(!y||i<b)\n                if((k+x+y)%2==d)f[p][j+x+y][(k+x+y)/2]+=f[p^1][j][k];\n    }\n    return f[p][t][0];\n}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    scanf(\"%lld\",&n);mi[0]=1;ll x,ret;\n    while(mi[m-1]<=n){mi[m+1]=mi[m]<<1,++m;}--m;\n    fp(i,1,m)if((x=n/(mi[i]-1))>0){\n        ret=n-x*(mi[i]-1);\n        fd(j,i-1,0)ret=sub(ret,mi[j]-1);\n        if(!ret)++ans;\n    }\n    fp(i,1,m)for(int j=1;mi[j]-1<=n;++j)\n        if((x=(n-mi[j]+1)/(mi[i+1]+mi[j+1]-3))>0){\n            ret=(n-mi[j]+1)-x*(mi[i+1]+mi[j+1]-3);\n            if(!ret){++ans;continue;}\n            if(i==1&&j==1){ans+=ret==5*x+1;continue;}\n            fp(k,1,i+j)if(~(ret+k)&1)\n                ans+=calc(ret+k,x,i,j,k);\n        }\n    printf(\"%lld\",ans);\nreturn 0;\n}\n```\n---\n${\\rm upd}:2020.08.10$\n\n\u4fee\u6b63\u4e86\u4e00\u4e9b $\\LaTeX$ \u6392\u7248\u9519\u8bef\u548c\u9898\u89e3\u9519\u8bef\u3002",
        "postTime": 1521025355,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "CF750G"
    },
    {
        "content": "[My Blog](https://www.cnblogs.com/feyn)\n\n\u7b54\u6848\u8def\u5f84\u6709\u4e09\u79cd\u5f62\u5f0f\u3002\u4e00\u79cd\u662f\u5355\u70b9\uff0c\u663e\u7136\u662f\u5b58\u5728\u7684\u3002\u4e00\u79cd\u662f\u4e00\u4e2a\u70b9\u662f\u53e6\u4e00\u4e2a\u70b9\u7684\u7956\u5148\uff0c\u5047\u8bbe\u8fd9\u4e2a\u7956\u5148\u662f $t$\uff0c\u5e76\u4e14\u679a\u4e3e\u4e8c\u8005\u7684\u6df1\u5ea6\u5dee $h$\uff08\u8ba4\u4e3a $h\\ge 1$\uff0c\u4e0b\u540c\uff09\uff0c\u4f1a\u53d1\u73b0\u4e00\u4ef6\u975e\u5e38\u6709\u8da3\u7684\u4e8b\u60c5\u3002\u9996\u5148\u8def\u5f84\u4e0a\u6bcf\u4e2a\u70b9\u5728\u4e8c\u8fdb\u5236\u4e0b\u90fd\u4f1a\u6709\u524d\u7f00 $t$\uff0c\u6240\u4ee5\u9996\u5148\u5c31\u6709\u4e00\u4e2a\u8d21\u732e\u503c\u4e3a $t(2^{h+1}-1)$\u3002\u7136\u540e\u601d\u8003\u9664\u6b64\u4e4b\u5916\u7684\u540e\u7f00 $1$ \u7684\u5f71\u54cd\uff0c\u53d1\u73b0\u4ece\u4f4e\u5230\u9ad8\u7684\u7b2c $i$ \u4f4d\u7684 $1$ \u4f1a\u5728\u540e $i$ \u4e2a\u6570\u4e2d\u51fa\u73b0\uff0c\u6240\u4ee5\u4f1a\u6709 $2^i-1$ \u7684\u8d21\u732e\uff0c\u6240\u4ee5\u5462\u6211\u4eec\u5e0c\u671b\u7684\u5c31\u662f $t(2^{h+1}-1)+\\sum\\limits_{i=1}^hp_i(2^i-1)=w$\uff0c\u5176\u4e2d $p$ \u662f\u67d0\u4e00\u4f4d\u662f\u5426\u662f $1$ \u7684\u51b3\u7b56\u3002\u53d1\u73b0\u540e\u9762\u90a3\u4e00\u5806\u5373\u4f7f\u53d6\u6ee1\u4e5f\u4e0d\u4f1a\u8fbe\u5230 $2^h-1$ \u7684\u5927\u5c0f\uff0c\u6240\u4ee5\u662f $t$ \u7684\u503c\u5df2\u7ecf\u56fa\u5b9a\u4e0b\u6765\u4e86\uff0c\u53ea\u9700\u8981\u601d\u8003\u662f\u5426\u5b58\u5728\u5408\u6cd5\u7684 $p$\uff0c\u8d2a\u5fc3\u5373\u53ef\u3002\n\n\u6700\u540e\u5c31\u662f\u5b58\u5728\u5206\u53c9\u7684\u60c5\u51b5\uff0c\u5047\u8bbe LCA \u662f $t$\uff0c\u90a3\u4e48\u4e24\u4e2a\u5b69\u5b50\u5e94\u8be5\u5206\u522b\u662f $2t,2t+1$ \u7684\u5b69\u5b50\u3002\u8fd8\u662f\u6309\u7167\u524d\u9762\u7684\u65b9\u6cd5\uff0c\u679a\u4e3e\u4e24\u4e2a\u5b69\u5b50\u548c LCA \u5de6\u53f3\u5b69\u5b50\u7684\u6df1\u5ea6\u5dee $h,s$\uff0c\u90a3\u4e48\u603b\u7684\u8d21\u732e\u5e94\u8be5\u662f $2t(2^{h+1}-1)+(2t+1)(2^{s+1}-1)+t$\uff0c\u540e\u7eed\u76f8\u5e94\u5730\u4e5f\u6709 $\\sum\\limits_{i=1}^hp_i(2^i-1)+\\sum\\limits_{i=1}^sq_i(2^i-1)$ \u7684\u8d21\u732e\uff0c\u8fd8\u662f\u5f71\u54cd\u4e0d\u5230\u524d\u9762\u7684\uff0c\u6240\u4ee5 $t$ \u7684\u503c\u8fd8\u662f\u56fa\u5b9a\u7684\u3002\u4f46\u662f\u5462\u540e\u8005\u65e0\u6cd5\u7528\u8d2a\u5fc3\u6765\u89e3\u51b3\uff0c\u6240\u4ee5\u53ea\u80fd\u4f7f\u7528\u6570\u4f4d DP \u4e86\uff0c\u5957\u7528\u7ecf\u5178\u7684\u505a\u6cd5\u3002\u7531\u4e8e\u90a3\u4e2a $-1$ \u5f88\u70e6\uff0c\u4e8e\u662f\u679a\u4e3e\u9009\u62e9\u7684\u6570\u7684\u4e2a\u6570\uff0c\u7136\u540e\u7528 $f_{x,y,0/1}$ \u8868\u793a\u5df2\u7ecf\u9009\u4e86\u6700\u4f4e\u7684 $x$ \u4f4d\uff0c\u5e76\u4e14\u5df2\u7ecf\u7528\u4e86 $y$ \u4e2a\u6570\uff0c\u8fd9 $x$ \u4f4d\u6709\u6ca1\u6709\u5411\u4e0a\u8fdb\u4f4d\u7684\u65b9\u6848\uff0c\u968f\u4fbf\u505a\u5c31\u53ef\u4ee5\u4e86\u3002\u603b\u590d\u6742\u5ea6\u53d1\u73b0\u662f $O(n^5)$\uff0c\u5e38\u6570\u5927\u6982\u6bd4\u8f83\u5c0f\u3002\n\n```cpp\n#include<bits/stdc++.h>\n//#define feyn\n#define int long long\nusing namespace std;\nconst int N=55;\ninline void read(int &wh){\n\twh=0;char w=getchar();int f=1;\n\twhile(w<'0'||w>'9'){if(w=='-')f=-1;w=getchar();}\n\twhile(w<='9'&&w>='0'){wh=wh*10+w-'0';w=getchar();}\n\twh*=f;return;\n}\n\nint lim=50;\n\ninline int dep(int wh){\n\tint an=0;\n\twhile(wh)++an,wh>>=1;\n\treturn an;\n}\nint solve1(int h,int w){\n\tint t=w/((1ll<<(h+1))-1);\n\tif(dep(t)+h>lim||t==0)return 0;\n\tint left=w-t*((1ll<<(h+1))-1);\n\tfor(int i=h;i;i--){\n\t\tint now=(1ll<<i)-1;\n\t\tif(left>=now)left-=now;\n\t}\n\treturn left==0;\n}\nint f[N][N<<1][2];\nint work(int h,int s,int want,int num){\n\tif(want&1)return 0;\n\tmemset(f,0,sizeof(f));\n\tf[0][0][0]=1;\n\tint Dep=dep(want);\n\tfor(int x=0;x<=Dep;x++)for(int y=0;y<=num;y++){\n\t\tint wt=(want&(1ll<<(x+1)))>0;\n\t\tfor(int in=0;in<2;in++){\n\t\t\tif(f[x][y][in]==0)continue;\n\t\t\tfor(int a=0;a<=(x<h);a++)for(int b=0;b<=(x<s);b++){\n\t\t\t\tint now=(a+b+in)&1,nxt=(a+b+in)>>1;\n\t\t\t\tif(now!=wt)continue;\n\t\t\t\tf[x+1][y+a+b][nxt]+=f[x][y][in];\n\t\t\t}\n\t\t}\n\t}\n\treturn f[Dep+1][num][0];\n}\nint solve2(int h,int s,int w){\n\tint an=0,t=(w+1-(1ll<<(s+1)))/((1ll<<(s+2))+(1ll<<(h+2))-3);\n\tif(dep(t)+1+max(h,s)>lim||t==0)return 0;\n\tint left=w+1-(1ll<<(s+1))-t*((1ll<<(s+2))+(1ll<<(h+2))-3);\n\tfor(int num=0;num<=h+s;num++){\n\t\tan+=work(h,s,left+num,num);\n\t}\n\treturn an;\n}\n\nvoid solve(){\n\tint val,ans=0;read(val);\n\tif(val<(1ll<<lim))ans++;\n\tfor(int i=1;i<lim;i++)ans+=solve1(i,val);\n\tfor(int i=0;i<lim;i++){\n\t\tfor(int j=0;j<lim;j++){\n\t\t\tans+=solve2(i,j,val);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n\nsigned main(){\n\t\n\t#ifdef feyn\n\tfreopen(\"in.txt\",\"r\",stdin);\n\t#endif\n\t\n\tint test=1;\n\twhile(test--)solve(); \n\t\n\treturn 0;\n}\n```",
        "postTime": 1679280929,
        "uid": 302383,
        "name": "Feyn",
        "ccfLevel": 0,
        "title": "CF750G"
    }
]