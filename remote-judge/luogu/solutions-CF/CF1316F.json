[
    {
        "content": "\u9996\u5148\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u201c\u5e8f\u5217\u201d\u662f\u5047\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u6392\u5e8f\u3002\n\n\u7136\u540e\u8fd9\u4e00\u7c7b\u95ee\u9898\u6709\u4e00\u4e2a\u6bd4\u8f83\u901a\u7528\u7684\u601d\u8def\u5c31\u662f\u53bb\u8003\u8651\u8d21\u732e\u3002\n\n\u56e0\u4e3a\u4e24\u4e2a\u6570\u8981\u4ea7\u751f\u8d21\u732e\uff0c\u4e00\u5b9a\u8981\u8ba9\u5b83\u4eec\u4e4b\u95f4\u6ca1\u6709\u4efb\u4f55\u5176\u4ed6\u7684\u6570\uff0c\u5373 $p_i$ \u548c $p_j$ \u4ea7\u751f\u8d21\u732e\u7684\u6982\u7387\u662f $\\dfrac{1}{2^{j-i+1}}$\u3002\n\n\u4e8e\u662f\u5c31\u6709\u4e86\u7b2c\u4e00\u4e2a\u7b54\u6848\u5f0f\uff1a\n\n$$\\text{Ans}=\\sum_{i=1}^n\\sum_{j=i+1}^n\\dfrac{p_ip_j}{2^{j-i+1}}$$\n\n\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(qn^2)$ \u7684\u4f18\u79c0\u505a\u6cd5\u3002\n\n\u8fd9\u4e2a\u201c\u5355\u70b9\u4fee\u6539\u201d\u63d0\u793a\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u53bb\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\uff0c\u6240\u4ee5\u8003\u8651\u5728\u6392\u597d\u5e8f\u7684\u5e8f\u5217\u4e0a\u5206\u6cbb\u3002\n\n\u5bf9\u4e8e $[l,r]$\uff0c\u5982\u679c\u62c6\u5206\u4e3a $[l,m]$ \u548c $[m+1,r]$\uff0c\u90a3\u4e48\u7b54\u6848\u5206\u4e3a $3$ \u90e8\u5206\uff1a\n\n1. \u843d\u5728\u5de6\u8fb9\u7684\u5b50\u5e8f\u5217\uff0c\u8d21\u732e\u4e3a $\\text{Ans}_{[l,m]}$\u3002\n2. \u843d\u5728\u53f3\u8fb9\u7684\u5b50\u5e8f\u5217\uff0c\u8d21\u732e\u4e3a $\\text{Ans}_{[m+1,r]}$\u3002\n3. \u4e24\u8fb9\u4ea7\u751f\u7684\u8d21\u732e\uff0c\u8d21\u732e\u4e3a\uff1a\n\n$$\\sum_{i=l}^{m}\\sum_{j=m+1}^r\\dfrac{p_ip_j}{2^{j-i+1}}$$\n\n\u7531\u4e8e $[l,m]\\cap[m+1,r]=\\varnothing$\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c1d\u8bd5\u62c6\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n$$\\begin{aligned}&\\sum_{i=l}^{m}\\sum_{j=m+1}^r\\dfrac{p_ip_j}{2^{j-i+1}}\\\\=\\ \\ &\\sum_{i=l}^m\\sum_{j=m+1}^r\\dfrac{p_i}{2^{m-i+1}}\\cdot\\dfrac{p_j}{2^{j-m}}\\\\=\\ \\ &\\left(\\sum_{i=l}^m\\dfrac{p_i}{2^{m-i+1}}\\right)\\cdot\\left(\\sum_{j=m+1}^r\\dfrac{p_j}{2^{j-m}}\\right)\\end{aligned}$$\n\n\u4e8e\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u533a\u95f4\uff0c\u518d\u7ef4\u62a4 $g(l,r)$ \u548c $h(l,r)$\uff1a\n\n$$g(l,r)=\\sum_{i=l}^r\\dfrac{p_i}{2^{i-l+1}} ,\\ h(l,r)=\\sum_{i=l}^r\\dfrac{p_i}{2^{r-i+1}}$$\n\n\u5c31\u53ef\u4ee5 $O(1)$ \u5408\u5e76\u4e86\u3002\n\n\u5f97\u5230\u7b2c\u4e8c\u4e2a\u7b54\u6848\u5f0f\uff1a\n\n$$\\begin{cases}f(i,i)=0\\\\g(i,i)=h(i,i)=\\dfrac{p_i}{2}\\\\f(l,r)=f(l,m)+f(m+1,r)+h(l,m)g(m+1,r)\\\\g(l,r)=g(l,m)+\\dfrac{g(m+1,r)}{2^{m-l+1}}\\\\h(l,r)=\\dfrac{h(l,m)}{2^{r-m}}+h(m+1,r)\\\\\\text{Ans}=f(1,n)\\end{cases}$$\n\n\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(qn)$ \u7684\u4f18\u79c0\u505a\u6cd5\u3002\n\n\u5982\u679c\u91c7\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u5e76\u4e14\u5728\u79bb\u6563\u5316\u7684\u65f6\u5019\u628a\u76f8\u540c\u503c\u7684\u5143\u7d20\u79bb\u6563\u5316\u5230\u4e0d\u540c\u7684\u4f4d\u7f6e\uff08\u4f46\u662f\u4fdd\u6301\u503c\u76f8\u540c\uff09\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u65f6\u95f4 $O(n+q\\log n)$\uff0c\u7a7a\u95f4 $O(n+q)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n```cpp\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <cstdio>\n#include <map>\n#include <algorithm>\nusing namespace std;\n\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1 << 21], *p1 = buf, *p2 = buf;\n\ninline int qread() {\n\tregister char c = getchar();\n\tregister int x = 0, f = 1;\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9') {\n\t\tx = (x << 3) + (x << 1) + c - 48;\n\t\tc = getchar();\n\t}\n\treturn x * f;\n}\n\ninline int Abs(const int& x) {return (x > 0 ? x : -x);}\ninline int Max(const int& x, const int& y) {return (x > y ? x : y);}\ninline int Min(const int& x, const int& y) {return (x < y ? x : y);}\n\nconst long long mod = 1000000007;\nlong long inv2[300005];\n\n#define GetAns(p) (p ? p->ans : 0)\n#define GetLsum(p) (p ? p->lsum : 0)\n#define GetRsum(p) (p ? p->rsum : 0)\n#define GetLen(p) (p ? p->len : 0)\nstruct Node {\n\tlong long ans, lsum, rsum;\n\tint len;\n\tNode *l, *r;\n};\nNode nd[2400005];\nint top;\nstruct Segtree {\n\tNode *_root;\n\tinline void Modify(Node *&p, int pl, int pr, int idx, int v) {\n\t\tif (!p) p = &nd[++top];\n\t\tif (pl == pr) {\n\t\t\tp->ans = 0;\n\t\t\tif (v > 0) p->len++;\n\t\t\telse p->len--;\n\t\t\tp->lsum = (p->lsum + inv2[1] * v % mod) % mod;\n\t\t\tp->rsum = (p->rsum + inv2[1] * v % mod) % mod;\n\t\t\treturn;\n\t\t}\n\t\tint mid = pl + pr >> 1;\n\t\tif (idx <= mid) Modify(p->l, pl, mid, idx, v);\n\t\telse Modify(p->r, mid + 1, pr, idx, v);\n\t\t//printf(\"%d %d %d %d\\n\", pl, pr, idx, mid);\n\t\tp->len = GetLen(p->l) + GetLen(p->r);\n\t\tp->lsum = (GetLsum(p->l) + GetLsum(p->r) * inv2[GetLen(p->l)] % mod) % mod;\n\t\tp->rsum = (GetRsum(p->l) * inv2[GetLen(p->r)] % mod + GetRsum(p->r)) % mod;\n\t\tp->ans = ((GetAns(p->l) + GetAns(p->r)) % mod + GetRsum(p->l) * GetLsum(p->r) % mod) % mod;\n\t\t//printf(\"%d %d %lld %lld %lld\\n\", pl, pr, p->lsum, p->rsum, p->ans);\n\t}\n};\nSegtree sgt;\nint n, q, a[300005], idx[300005], val[300005], b[600005];\nmap <int, int> cnt;\n\ninline void Read() {\n\tn = qread();\n\tinv2[0] = 1; inv2[1] = (mod + 1) / 2;\n\tfor (int i = 2;i <= n;i++) inv2[i] = inv2[i - 1] * inv2[1] % mod;\n\tfor (int i = 1;i <= n;i++) b[i] = a[i] = qread();\n\tq = qread();\n\tfor (int i = 1;i <= q;i++) {\n\t\tidx[i] = qread(); val[i] = b[n + i] = qread();\n\t}\n}\n\ninline void Prefix() {\n\tsort(b + 1, b + n + q + 1);\n\t//for (int i = 1;i <= n + q;i++) printf(\"%d \", b[i]);\n\t//puts(\"\");\n\tfor (int i = 1;i <= n;i++) {\n\t\tcnt[a[i]]++;\n\t\ta[i] = lower_bound(b + 1, b + n + q + 1, a[i]) - b + cnt[a[i]] - 1;\n\t}\n\tfor (int i = 1;i <= q;i++) {\n\t\tcnt[val[i]]++;\n\t\tval[i] = lower_bound(b + 1, b + n + q + 1, val[i]) - b + cnt[val[i]] - 1;\n\t}\n}\n\ninline void Solve() {\n\tfor (int i = 1;i <= n;i++) {\n\t\tsgt.Modify(sgt._root, 1, n + q, a[i], b[a[i]]);\n\t}\n\tprintf(\"%lld\\n\", sgt._root->ans);\n\tfor (int i = 1;i <= q;i++) {\n\t\t//printf(\"%d %d\\n\", a[idx[i]], val[i]);\n\t\tsgt.Modify(sgt._root, 1, n + q, a[idx[i]], -b[a[idx[i]]]);\n\t\tsgt.Modify(sgt._root, 1, n + q, a[idx[i]] = val[i], b[val[i]]);\n\t\tprintf(\"%lld\\n\", sgt._root->ans);\n\t}\n}\n\nint main() {\n\tRead();\n\tPrefix();\n\tSolve();\n\t#ifndef ONLINE_JUDGE\n\twhile (1);\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1606985685,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1316F \u3010Battalion Strength\u3011"
    },
    {
        "content": "\u5c06\u5e8f\u5217\u6392\u5e8f\uff0c\u6211\u4eec\u5bf9\u4e8e\u4efb\u610f\u4e00\u5bf9\u6570\u5b57 $p_i,p_j(p_i<p_j)$ \u7b97\u51fa\u5b83\u7684\u671f\u671b\u8d21\u732e\uff0c\u5f53\u5b83\u4eec\u5bf9\u7b54\u6848\u6709\u8d21\u732e\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u4eec\u4e4b\u95f4\u7684\u6240\u6709\u7684\u6570\u5b57\u90fd\u6ca1\u6709\u88ab\u9009\uff0c\u6240\u4ee5\u671f\u671b\u8d21\u732e\u4e3a $p_i\\times p_j\\times \\dfrac 1{2^{j-i+1}}$\n\n\u6240\u4ee5\u7b54\u6848\u4e3a\uff1a$\\sum\\limits_{i=1}^n\\sum\\limits_{j=i+1}^np_i\\times p_j\\times \\dfrac 1{2^{j-i+1}}$\n\n\u8fd9\u662f $O(n^2)$ \u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5206\u6cbb\uff0c\u6bcf\u6b21\u5c06\u5e8f\u5217\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u8bb0\u4e3a $[l,mid]$ \u548c $[mid+1,r]$\n\n\u5408\u5e76\u4e24\u90e8\u5206\u7684\u7b54\u6848\uff1a\n\n$$ans_{l,r}=ans_{l,mid}+ans_{mid+1,r}+\\sum\\limits_{i=l}^{mid}\\sum\\limits_{mid+1}^rp_i\\times p_j\\times\\dfrac1{2^{j-i+1}}$$\n\n$$\\sum\\limits_{i=l}^{mid}\\sum\\limits_{mid+1}^rp_i\\times p_j\\times\\dfrac1{2^{j-i+1}}=\\sum\\limits_{i=l}^{mid}\\sum\\limits_{mid+1}^r(p_i\\times2^{i-l})\\times(p_j\\times\\dfrac1{2^{j-l+1}})$$\n\n$$\\sum\\limits_{i=l}^{mid}\\sum\\limits_{mid+1}^rp_i\\times p_j\\times\\dfrac1{2^{j-i+1}}=\\sum\\limits_{i=l}^{mid}\\sum\\limits_{mid+1}^r(p_i\\times2^{i-l})\\times(p_j\\times\\dfrac1{2^{j-(mid+1)+1}})\\times\\dfrac1{2^{mid-l+1}}$$\n\n\u90a3\u4e48\u5408\u5e76\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u7ef4\u62a4\u6bcf\u4e2a\u533a\u95f4\u4e2d\u4e24\u4e2a\u62ec\u53f7\u4e2d\u7684\u503c\uff0c\u7136\u540e $O(1)$ \u5408\u5e76\u5566\n\n\u5e26\u4e0a\u4e86\u4fee\u6539\u64cd\u4f5c\uff0c\u6211\u4eec\u663e\u7136\u8981\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u56e0\u4e3a\u662f\u6392\u5e8f\u540e\u7684\u5e8f\u5217\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u6743\u503c\u7ebf\u6bb5\u6811\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u91cd\u590d\u5143\u7d20\u975e\u5e38\u4e0d\u597d\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u7ebf\u6bb5\u6811\u4e0a\u8fdb\u884c\u4fee\u6539\u548c\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u5c06\u91cd\u590d\u7684\u6570\u5b57\u7f16\u4e0a\u4e0d\u540c\u7684\u53f7\uff0c\u4f46\u662f\u4f7f\u5b83\u4eec\u5728\u79bb\u6563\u5316\u6570\u7ec4\u4e2d\u7684\u503c\u662f\u76f8\u540c\u7684\u5373\u53ef\n\n\u611f\u89c9\u8bf4\u7684\u4e0d\u662f\u5f88\u660e\u767d\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\u5427\n\n```cpp\nconst int N = 600010;\nstruct item { int val,*s; }b[N];int cnt,tot;\nint pw[N],ip[N];\nint n,q,a[N],p[N],x[N];\nstruct tree { int l,r,tot,val,val1,val2; }t[N << 2];\n#define ls now << 1\n#define rs now << 1 | 1\nvoid build(int now,int l,int r)\n{\n\tt[now].l = l,t[now].r = r;\n\tt[now].tot = t[now].val = t[now].val1 = t[now].val2 = 0;\n\tif(l == r) return;\n\tint mid = l + r >> 1;build(ls,l,mid),build(rs,mid + 1,r);\n}\nvoid pushup(int now)\n{\n\tt[now].tot = t[ls].tot + t[rs].tot;\n\tt[now].val1 = (t[ls].val1 + (ll)t[rs].val1 * pw[t[ls].tot]) % mod;\n\tt[now].val2 = (t[ls].val2 + (ll)t[rs].val2 * ip[t[ls].tot]) % mod;\n\tt[now].val = (Mod(t[ls].val + t[rs].val) + (ll)t[ls].val1 * t[rs].val2 % mod * ip[t[ls].tot]) % mod;\n}\nvoid update(int now,int pos,int ty)\n{\n\tif(t[now].l == t[now].r)\n\t{\n\t\tif(~ty)\n\t\t{\n\t\t\tt[now].tot = 1;\n\t\t\tt[now].val1 = b[pos].val;\n\t\t\tt[now].val2 = (ll)b[pos].val * ip[1] % mod;\n\t\t\tt[now].val = 0;\n\t\t}else t[now].tot = t[now].val1 = t[now].val2 = t[now].val = 0;\n\t\treturn;\n\t}int mid = t[now].l + t[now].r >> 1;\n\tif(pos <= mid) update(ls,pos,ty);else update(rs,pos,ty);\n\tpushup(now);\n}\nint main()\n{\n\tn = read();for(int i = 1;i <= n;i++)\n\t\tb[++cnt].val = a[i] = read(),b[cnt].s = a + i;\n\tq = read();for(int i = 1;i <= q;i++)\n\t\tp[i] = read(),b[++cnt].val = x[i] = read(),b[cnt].s = x + i;\n\tsort(b + 1,b + 1 + cnt,[&](item u,item v) { return u.val < v.val; });\n\tfor(int i = 1;i <= cnt;i++) *(b[i].s) = ++tot;\n\n\tpw[0] = 1;for(int i = 1;i <= n;i++) reduce(pw[i] = pw[i - 1] * 2 - mod);\n\tip[0] = 1,ip[1] = (mod + 1) >> 1;\n\tfor(int i = 2;i <= n;i++) ip[i] = (ll)ip[i - 1] * ip[1] % mod;\n\n\tbuild(1,1,tot);\n\tfor(int i = 1;i <= n;i++) update(1,a[i],1);\n\tfprint(t[1].val);\n\tfor(int i = 1;i <= q;i++)\n\t{\n\t\tupdate(1,a[p[i]],-1);\n\t\ta[p[i]] = x[i];\n\t\tupdate(1,a[p[i]],1);\n\t\tfprint(t[1].val);\n\t}\n}\n```",
        "postTime": 1594371650,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1316F \u3010Battalion Strength\u3011"
    },
    {
        "content": "\u5148\u8003\u8651\u9759\u6001\u7684\u60c5\u51b5\uff0c\u5047\u8bbe\u6ca1\u6709\u4fee\u6539\u64cd\u4f5c\uff0c\u8be5\u600e\u4e48\u5904\u7406\u8fd9\u4e00\u9053\u9898\u3002\u5047\u8bbe\u6570\u7ec4\u5df2\u7ecf\u6709\u5e8f\uff0c\u6211\u4eec\u8003\u8651\u4e24\u4e2a\u6570$p_i,p_j$\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f\u4ec0\u4e48\uff0c\u5f53$p_i,p_j$\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\u65f6\uff0c\u4e00\u5b9a\u65f6\u5b83\u4eec\u5168\u90e8\u88ab\u9009\u4e0a\u4e14\u5b83\u4eec\u4e2d\u95f4\u7684\u6570\u5168\u90e8\u6ca1\u6709\u88ab\u9009\u4e0a\u65f6\u7684\u60c5\u51b5\uff0c\u6982\u7387\u4e3a$\\frac{1}{2^{j-i+1}}$\uff0c\u6240\u4ee5\u5e8f\u5217\u7684\u671f\u671b\u6743\u503c\u53ef\u4ee5\u5199\u6210$\\sum_{i=1}^{n} \\sum_{j=i+1}^{n} p_i \\cdot p_j \\cdot \\frac{1}{2^{j-i+1}}$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2)$\uff0c\u522b\u8bf4\u5e26\u8be2\u95ee\u4e86\uff0c\u4e0d\u5e26\u8be2\u95ee\u90fd\u8fc7\u4e0d\u4e86\uff0c\u8003\u8651\u5bf9\u8fd9\u4e2a\u5f0f\u5b50\u8fdb\u884c\u4f18\u5316\uff0c\u4ee4$f_i=\\sum_{j=1}^{i} p_j \\cdot 2^{i-1}$\uff0c\u90a3\u4e48\u7b54\u6848\u53ef\u4ee5\u5199\u6210$\\sum_{i=1}^{n} p_i \\cdot \\frac{1}{2^j} \\cdot f_{i-1}$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n)$\u3002\n\n\u4e0d\u5e26\u4fee\u6539\u7684\u5904\u7406\u5b8c\u4e86\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u5e26\u4fee\u6539\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u9700\u8981\u6392\u5e8f\u540e\u518d\u5904\u7406\uff0c\u6240\u4ee5\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u8fd9\u4e2a\u5e8f\u5217\uff08~~\u5f53\u7136\uff0c\u4f60\u8981\u7528\u5e73\u8861\u6811\u6211\u4e5f\u62e6\u4e0d\u4e86\u4f60~~\uff09\uff0c\u8003\u8651\u7ebf\u6bb5\u6811\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u5e94\u5f53\u7ef4\u62a4\u4ec0\u4e48\u4fe1\u606f\uff0c\u719f\u6089CDQ\u5206\u6cbb\u7684\u540c\u5b66\u4eec\u5e94\u8be5\u90fd\u4f1a\u505a\uff0c\u4ee4\u5f53\u524d\u533a\u95f4\u4e3a$(l,r)$\uff08\u5047\u8bbe$(l,r)$\u5185\u7684\u6bcf\u4e00\u4e2a\u6570\u90fd\u5b58\u5728\u5728\u539f\u5e8f\u5217\u4e2d\uff09\uff0c\u7ef4\u62a4$val$\u4e3a\u5f53\u524d\u533a\u95f4\u7684\u6743\u503c\uff0c$sz$\u4e3a\u5f53\u524d\u533a\u95f4\u5185\u6570\u7684\u4e2a\u6570\uff0c$Lval=\\sum_{i=l}^{r} p_i \\cdot 2^{i-l}$\uff0c$Rval=\\sum_{i=l}^{r} p_i \\cdot \\frac{1}{2^{i-l+1}}$\u3002\u6240\u4ee5\u5355\u70b9$a$\u52a0\u5165\u65f6\uff0c\u8fd9\u4e2a\u70b9\u7684\u503c\u662f\u8fd9\u4e48\u8d4b\u7684\uff1a$val=0,sz=1,Lval=a,Rval=\\frac{a}{2}$\uff0c\u7136\u540e\u4fe1\u606f\u5408\u5e76\u65f6\u8fd9\u4e48\u5408\u5e76\u7684\uff08\u4ee4$lc$\u548c$rc$\u4e3a\u5176\u5728\u7ebf\u6bb5\u6811\u4e0a\u7684\u5de6\u53f3\u5b69\u5b50\uff09\uff1a\n$$val=val_{lc}+val_{rc}+\\frac{Lval_{lc}\\cdot Rval_{rc}}{2^{sz_{lc}}}$$\n\n$$sz=sz_{lc}+sz_{rc}$$\n$$Lval=Lval_{lc}+ Lval_{rc}\\cdot 2^{sz_{lc}}$$\n$$Rval=Rval_{lc}+ Rval_{rc}\\cdot \\frac{1}{2^{sz_{lc}}}$$\n\n\u4ee3\u7801\u53ef\u4ee5\u53bb\u6211\u7684\u535a\u5ba2\u5185\u67e5\u770b\uff1a[Codeforces 1316F. Battalion Strength \u9898\u89e3](https://www.cnblogs.com/withhope/p/12426661.html)",
        "postTime": 1583487962,
        "uid": 33362,
        "name": "Suiseiseki",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1316F \u3010Battalion Strength\u3011"
    },
    {
        "content": "$\\ast$2800\n\n\u5728\uff1f\u4e3a\u4ec0\u4e48\u90fd\u7528\u503c\u57df\u7ebf\u6bb5\u6811\uff1f\u8fd9\u91cc\u662f Splay \u7684\u9898\u89e3\u3002\n\n\u8001\u89c4\u77e9\u5148\u4e0d\u7ba1\u4fee\u6539\uff0c\u5148\u8bd5\u7740\u505a\u8be2\u95ee\u672c\u8eab\uff0c\u53d1\u73b0\u5148\u9009\u5b50\u5e8f\u5217\u518d\u6392\u5e8f\u518d\u7b97\u5b50\u5e8f\u5217\u7684\u987a\u5e8f\u5341\u5206\u4e0d\u7b26\u5408\u6211\u4eec\u7684\u80c3\u53e3\uff0c\u6211\u4eec\u5e0c\u671b\u9009\u4e00\u4e2a\u5b50\u5e8f\u5217\u76f4\u63a5\u53ef\u4ee5\u5f97\u5230\u8d21\u732e\u3002\n\n\u6211\u4eec\u5bf9\u5e8f\u5217\u76f4\u63a5\u6392\u4e2a\u5e8f\uff0c\u90a3\u4e48\u9009\u51fa\u6765\u7684\u5b50\u5e8f\u5217\u7684\u8d21\u732e\u76f4\u63a5\u5c31\u662f\u5b50\u5e8f\u5217\u4e2d\u76f8\u90bb\u4e24\u6570\u7684\u79ef\u7684\u548c\uff0c\u4e0d\u7528\u8003\u8651\u6392\u5e8f\u7684\u95ee\u9898\u4e86\u3002\n\n\u518d\u770b\u5b50\u5e8f\u5217\uff0c\u6709\u81ea\u7136\u7684\u611f\u89c9\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u6bcf\u4e2a\u6570\u90fd\u662f $\\frac 12$ \u7684\u6982\u7387\u88ab\u9009\u4e2d\uff0c\u6c42\u8fd9\u6837\u7684\u5e8f\u5217\u7684\u671f\u671b\u3002\n\n\u7531\u4e8e\u662f\u4e00\u5bf9\u6570\u5148\u79ef\u518d\u628a\u5b83\u4eec\u6c42\u548c\uff0c\u6709\u4e86 $\\frac 12$ \u6211\u4eec\u5c31\u53ef\u4ee5\u5927\u80c6\u7684\u5bf9\u6bcf\u4e00\u5bf9\u6570\u8003\u8651\u8d21\u732e\u4e86\u3002\n\n\u5bf9\u4e00\u4e2a\u6570 $p_i$ \u6211\u4eec\u8003\u8651\u5b83\u548c\u5de6\u8fb9\u4e00\u4e2a\u7684\u8d21\u732e\uff0c\u9996\u5148\u5b83\u81ea\u8eab\u5f97\u662f $\\frac 12$ \u4e2d\u9009\u5230\u7684\u90a3\u79cd\u60c5\u51b5\u3002\n\n\u7136\u540e\u8003\u8651\u5b83\u5de6\u8fb9\u7684\u7b2c\u4e00\u4e2a\u6570 $p_{i-1}$\uff0c\u8981\u8d21\u732e\u5c31\u88ab\u9009\u4e2d\uff0c\u5373 $\\frac 12p_i\\times\\frac 12p_{i-1}$\u3002\n\n\u8003\u8651\u5b83\u5de6\u8fb9\u7684\u7b2c\u4e8c\u4e2a\u6570 $p_{i-2}$\uff0c\u8981\u8d21\u732e\u5f97 $p_{i-1}$ \u672a\u88ab\u9009\u4e2d\u4e14 $p_{i-2}$ \u88ab\u9009\u4e2d\uff0c\u5373 $\\frac 12p_i\\times\\frac 14p_{i-2}$\u3002\n\n\u7b80\u5355\u7c7b\u63a8\u4e00\u4e0b\u5f97\u5230\u5b83\u7684\u8d21\u732e\uff1a$\\frac 12p_i\\times\\sum_{j=1}^{i-1}(\\frac 12)^jp_{i-j}$\n\n\u53f3\u8fb9\u7684\u8d21\u732e\u540c\u7406\uff1a$\\frac 12p_i\\times\\sum_{j=1}^{i-1}(\\frac 12)^jp_{i+j}$\n\n\u73b0\u5728\u8003\u8651\u5e26\u4e0a\u4fee\u6539\uff0c\u4e0d\u8981\u5fd8\u4e86\u6211\u4eec\u8981\u5148\u6392\u5e8f\uff0c\u4e8e\u662f\u4e0a\u5e73\u8861\u6811\u4ee5\u5e8f\u5217 $p_i$ \u4e3a\u5173\u952e\u5b57\u505a\u4e0a\u8ff0\u8d21\u732e\u5373\u53ef\u3002\uff08\u5982\u679c\u50cf\u6211\u4e00\u6837\u5fd8\u4e86\u5bf9\u4f4d\u7f6e\u5efa\u7ebf\u6bb5\u6811\u518d\u91cd\u6784\u662f\u5f88\u4e8f\u7684\n\n\u4fee\u6539\u548c\u4fe1\u606f\u7ef4\u62a4\u90fd\u662f\u7b80\u5355\u7684\uff0c\u4e0d\u77e5\u9053\u5176\u4ed6\u9898\u89e3\u5728\u8bf4\u4ec0\u4e48\uff1f\n\n\u663e\u7136\u6bcf\u4e2a\u6570\u5bf9\u4f1a\u88ab\u7b97\u5230\u4e24\u6b21\uff0c\u4e8e\u662f\u8bb0\u5f97 $\\div2$\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/la1k8f64)\uff0c\u770b\u4e0a\u53bb\u8dd1\u7684\u6bd4\u503c\u57df\u7ebf\u6bb5\u6811\u6162\u597d\u591a\u3002",
        "postTime": 1648027336,
        "uid": 158948,
        "name": "\u7ea6\u745f\u592b\u7528\u8111\u73a9",
        "ccfLevel": 0,
        "title": "CF1316F Battalion Strength"
    }
]