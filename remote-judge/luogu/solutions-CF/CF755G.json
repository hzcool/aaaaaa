[
    {
        "content": "update\uff1a\u4e4b\u524d\u5c45\u7136\u628a\u9012\u63a8\u5f0f\u90fd\u5199\u9519\u4e86\uff0c\u73b0\u5df2\u6539\u6b63  \nupdate2\uff1a\u653e\u4e0a\u4e86\u4ee3\u7801\n\n\u597d\u50cf\u5927\u5bb6\u7684\u505a\u6cd5\u90fd\u662f $\\Theta(k \\log k \\log n)$\uff0c\u6ca1\u6709\u7528\u9012\u63a8\u901a\u9879\u505a\u7684\uff0c\u6765\u6c34\u4e00\u53d1\u548c $n$ \u65e0\u5173\u7684 $\\Theta(k \\log k)$ \u505a\u6cd5\uff08  \n\u4e0d\u8fc7\u4e5f\u662f\u8001\u5957\u8def\u4e86\n****\n\u8bbe $F_n(x)$ \u4e3a $n$ \u4e2a\u7403\u5206\u7ec4\u6570\u7684\u751f\u6210\u51fd\u6570\uff0c\u6839\u636e dp \u65b9\u7a0b\u53ef\u4ee5\u5f97\u5230\u9012\u63a8\u5f0f\n$$F_n(x)=(1+x)F_{n-1}(x)+xF_{n-2}(x)$$\n\u9012\u63a8\u5f0f\u7684\u7279\u5f81\u65b9\u7a0b\u4e3a\n$$z^2-(1+x)z-x=0$$\n\u89e3\u5f97\n$$z=\\frac{1+x \\pm \\sqrt{1+6x+x^2}}{2}$$\n\u7136\u540e\u5c31\u80fd\u8bbe\u901a\u9879\u4e3a\uff08$z_1$ \u53d6\u6b63\uff09\n$$F_n(x)=c_1z_1^n+c_2z_2^n$$\n\u518d\u6839\u636e $F_0(x)=1$\uff0c$F_1(x)=1+x$\uff0c\u7ecf\u8fc7\u4e00\u4e9b ~~SB~~ \u8ba1\u7b97\u89e3\u51fa $c_1,c_2$\n$$\\begin{cases} c_1=z_1(1+6x+x^2)^{-1/2} \\\\ c_2=-z_2(1+6x+x^2)^{-1/2} \\end{cases}$$\n\u76f4\u63a5\u5e26\u5165\u539f\u5f0f\u5c31\u6709\n$$F_n(x)=\\frac{(z_1^{n+1}-z_2^{n+1})}{\\sqrt{1+6x+x^2}}$$\n\u7136\u800c $z_2^{n+1} \\equiv 0 \\pmod{x^{n+1}}$\uff0c\u8fd9\u4e00\u9879\u5c31\u4e0d\u7528\u7ba1\u5b83\uff0c\u5f0f\u5b50\u5316\u4e3a\n$$F_n(x)=\\frac{1}{\\sqrt{1+6x+x^2}}\\left( \\frac{1+x+\\sqrt{1+6x+x^2}}{2}\\right)^{n+1}$$\n\u81f3\u6b64\u5c31\u80fd\u4ee5 $\\Theta(k \\log k)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u89e3\u51b3\u3002  \nps\uff1a$(1+6x+x^2)$ \u7684\u5f00\u6839\u3001\u6c42\u9006\u90fd\u53ef\u4ee5\u7ebf\u6027\uff0c\u6210\u529f\u62a2\u5230\u6700\u4f18\u89e3\u7b2c\u4e00\uff08  \n```cpp\n#pragma GCC optimize (2)\n#pragma GCC optimize (\"unroll-loops\")\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n#include<cmath>\n#define N 65540\n#define ll long long\n#define reg register\n#define p 998244353\nusing namespace std;\n\nstruct Z{\n    int v;\n    inline Z(const int _v=0):v(_v){}\n};\n\ninline Z operator + (const Z& lhs,const Z& rhs){ return lhs.v+rhs.v<p ? lhs.v+rhs.v : lhs.v+rhs.v-p; }\ninline Z operator - (const Z& lhs,const Z& rhs){ return lhs.v<rhs.v ? lhs.v-rhs.v+p : lhs.v-rhs.v; }\ninline Z operator - (const Z& x){ return x.v?p-x:0; }\ninline Z operator * (const Z& lhs,const Z& rhs){ return (ll)lhs.v*rhs.v%p; }\ninline Z& operator += (Z& lhs,const Z& rhs){ lhs.v = lhs.v+rhs.v<p ? lhs.v+rhs.v : lhs.v+rhs.v-p; return lhs; }\ninline Z& operator -= (Z& lhs,const Z& rhs){ lhs.v = lhs.v<rhs.v ? lhs.v-rhs.v+p : lhs.v-rhs.v; return lhs; }\ninline Z& operator *= (Z& lhs,const Z& rhs){ lhs.v = (ll)lhs.v*rhs.v%p; return lhs; }\n\ninline Z power(Z a,int t){\n    Z res = 1;\n    while(t){\n        if(t&1) res *= a;\n        a *= a;\n        t >>= 1;\n    }\n    return res;\n}\n\nZ rt[N],inv[N];\nint rev[N];\nint siz;\n\ninline int getlen(int n){ return 1<<(32-__builtin_clz(n)); }\n\nvoid init(int n){\n    int lim = 1;\n    while(lim<=n) lim <<= 1,++siz;\n    for(reg int i=1;i!=lim;++i) rev[i] = (rev[i>>1]>>1)|((i&1)<<(siz-1));\n    Z w = power(3,(p-1)>>siz);\n    rt[lim>>1] = inv[1] = 1;\n    for(reg int i=lim>>1|1;i!=lim;++i) rt[i] = rt[i-1]*w;\n    for(reg int i=(lim>>1)-1;i;--i) rt[i] = rt[i<<1];\n    for(reg int i=2;i<=n;++i) inv[i] = (p-p/i)*inv[p%i];\n}\n\ninline void dft(Z *f,int lim){\n    static unsigned long long a[N];\n    reg int x,shift = siz-__builtin_ctz(lim);\n    for(reg int i=0;i!=lim;++i) a[rev[i]>>shift] = f[i].v;\n    for(reg int mid=1;mid!=lim;mid<<=1)\n    for(reg int j=0;j!=lim;j+=(mid<<1))\n    for(reg int k=0;k!=mid;++k){\n        x = a[j|k|mid]*rt[mid|k].v%p;\n        a[j|k|mid] = a[j|k]+p-x;\n        a[j|k] += x;\n    }\n    for(reg int i=0;i!=lim;++i) f[i] = a[i]%p;\n}\n\ninline void idft(Z *f,int lim){\n    reverse(f+1,f+lim);\n    dft(f,lim);\n    reg int x = p-((p-1)>>__builtin_ctz(lim));\n    for(reg int i=0;i!=lim;++i) f[i] *= x;\n}\n\ninline void inverse(const Z *f,int n,Z *R){\n    static Z g[N],h[N];\n    int st[30],lim = getlen(n<<1),top = 0;\n    for(reg int i=0;i!=lim;++i) g[i] = 0;\n    while(n){\n        st[++top] = n;\n        n >>= 1;\n    }\n    g[0] = power(f[0],p-2),lim = 1;\n    while(top--){\n        n = st[top+1];\n        while(lim<=(n<<1)) lim <<= 1;\n        for(reg int i=0;i<=n;++i) h[i] = f[i];\n        for(reg int i=n+1;i!=lim;++i) h[i] = 0;\n        dft(g,lim),dft(h,lim);\n        for(reg int i=0;i!=lim;++i) g[i] *= 2-g[i]*h[i];\n        idft(g,lim);\n        for(reg int i=n+1;i!=lim;++i) g[i] = 0;\n    }\n    for(reg int i=0;i<=n;++i) R[i] = g[i];\n}\n\ninline void log(Z *f,int n){\n    static Z g[N];\n    int lim = getlen(n<<1);\n    inverse(f,n,g);\n    for(reg int i=0;i<=n;++i) f[i] = f[i+1]*(i+1);\n    for(reg int i=n+1;i!=lim;++i) g[i] = 0;\n    dft(f,lim),dft(g,lim);\n    for(reg int i=0;i!=lim;++i) f[i] *= g[i];\n    idft(f,lim);\n    for(reg int i=n;i;--i) f[i] = f[i-1]*inv[i];\n    for(reg int i=n+1;i!=lim;++i) f[i] = 0;\n    f[0] = 0;\n}\n\nvoid exp(const Z *f,int n,Z *R){\n    static Z g[N],h[N];\n    int st[30],lim = getlen(n<<1),top = 0;\n    for(reg int i=0;i!=lim;++i) g[i] = 0;\n    while(n){\n        st[++top] = n;\n        n >>= 1;\n    }\n    g[0] = lim = 1;\n    while(top--){\n        n = st[top+1];\n        while(lim<=(n<<1)) lim <<= 1;\n        for(reg int i=0;i<=n;++i) h[i] = g[i];\n        log(g,n);\n        for(reg int i=0;i<=n;++i) g[i] = f[i]-g[i];\n        g[0] += 1;\n        for(reg int i=n+1;i!=lim;++i) h[i] = 0;\n        dft(g,lim),dft(h,lim);\n        for(reg int i=0;i!=lim;++i) g[i] *= h[i];\n        idft(g,lim);\n        for(reg int i=n+1;i!=lim;++i) g[i] = 0;\n    }\n    for(reg int i=0;i<=n;++i) R[i] = g[i];\n}\n\nvoid power(const Z *f,int n,int k,Z *R){\n    static Z g[N];\n    for(reg int i=0;i<=n;++i) g[i] = f[i];\n    log(g,n);\n    for(reg int i=1;i<=n;++i) g[i] *= k;\n    exp(g,n,R);\n}\n\ninline void getpow(const Z *f,int n,int k,Z *g){\n    g[0] = 1;\n    for(reg int i=0;i!=n;++i){\n        Z tmp = 0;\n        for(reg int j=0;j<=min(i,1);++j) tmp += f[j+1]*g[i-j]*(j+1);\n        tmp *= k;\n        for(reg int j=max(0,i-2);j!=i;++j) tmp -= g[j+1]*f[i-j]*(j+1);\n        g[i+1] = tmp*inv[i+1];\n    }\n}\n\nint n,k,t;\nZ a[N],z1[N],c[N];\n\nint main(){\n    scanf(\"%d%d\",&n,&t);\n    k = min(n,t);\n    init(k<<1);\n    a[0] = a[2] = 1,a[1] = 6;\n    getpow(a,k,499122177,z1);\n    getpow(a,k,499122176,c);\n    z1[0] += 1,z1[1] += 1;\n    for(reg int i=0;i<=k;++i) z1[i] *= 499122177;\n    power(z1,k,n+1,z1);\n    int lim = getlen(k<<1);\n    dft(z1,lim),dft(c,lim);\n    for(reg int i=0;i!=lim;++i) z1[i] *= c[i];\n    idft(z1,lim);\n    for(reg int i=1;i<=k;++i) printf(\"%d \",z1[i].v);\n    for(reg int i=k+1;i<=t;++i) printf(\"0 \");\n    return 0;   \n}\n```",
        "postTime": 1582815942,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u6392\u6210\u4e00\u884c\u7684 $n$ \u4e2a\u7403\u5206\u6210 $k$ \u4e2a\u7ec4\uff0c\u4e00\u7ec4\u53ef\u4ee5\u662f\u4e00\u4e2a\u7403\u6216\u8005\u662f\u4e24\u4e2a\u76f8\u90bb\u7684\u7403\uff0c\u5141\u8bb8\u6709\u4e9b\u7403\u4e0d\u5728\u4efb\u4f55\u4e00\u7ec4\u91cc\u9762\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n\u4f60\u9700\u8981\u5bf9 $1\\sim k$ \u90fd\u6c42\u51fa\u7b54\u6848\u3002\n\n$\\texttt{Data Range:}1\\leq n\\leq 10^9,1\\leq k\\leq 2^{15}$\n\n### \u9898\u89e3\n\n\u500d\u589e FFT \u57fa\u7840\u9898\u3002\uff08\u5176\u5b9e\u771f\u7684\u4e0d\u96be\uff09\n\n\u8bbe $f_{n,k}$ \u4e3a $n$ \u4e2a\u7403\u5206\u6210 $k$ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u663e\u7136\u7684 $\\texttt{dp}$\n\n$$f_{n,k}=f_{n-1,k}+f_{n-1,k-1}+f_{n-2,k-1}$$\n\n\u4e5f\u5c31\u662f\u679a\u4e3e\u6700\u540e\u4e00\u4e2a\u7403\u7684\u5206\u7ec4\u60c5\u51b5\u3002\n\n\u7136\u800c\u8fd9\u6837\u5b50\u505a\u662f $O(nk)$ \u8f6c\u79fb\u7684\uff0c\u660e\u663e\u65e0\u6cd5\u901a\u8fc7\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u53e6\u5916\u4e00\u79cd\u8111\u6d1e\u5927\u5f00\u7684\u8f6c\u79fb\u65b9\u5f0f\uff1a\n\n\u5c06\u4e24\u6bb5\u957f\u5ea6\u4e3a $a$ \u548c $b$ \u7684\u7403\u62fc\u6210\u957f\u5ea6\u4e3a $a+b$ \u7684\u7403\uff0c\u5982\u679c\u4e2d\u95f4\u4e00\u6bb5\u4e0d\u5408\u5e76\u7684\u8bdd\u5c31\u662f\n\n$$f_{a+b,k}=\\sum\\limits_{i=0}^{k}f_{a,i}f_{b,k-i}$$\n\n\u5982\u679c\u4e2d\u95f4\u5408\u5e76\u7684\u8bdd\u5c31\u662f\n\n$$f_{a+b,k}=\\sum\\limits_{i=0}^{k-1}f_{a-1,i}f_{b-1,k-i-1}$$\n\n\u6c47\u603b\u4e00\u4e0b\n\n$$f_{a+b,k}=\\sum\\limits_{i=0}^{k}f_{a,i}f_{b,k-i}+\\sum\\limits_{i=0}^{k-1}f_{a-1,i}f_{b-1,k-i-1}$$\n\n\u5957\u8def\u5730\u8bbe $F_n(x)=\\sum\\limits_{k=0}^{\\infty}f_{n,k}x^k$\uff0c\u90a3\u4e48\u53ef\u4ee5\u91cd\u5199\u4e4b\u524d\u7684\u5f0f\u5b50\uff1a\n\n$$F_{a+b}(x)=F_a(x)F_b(x)+xF_{a-1}(x)F_{b-1}(x)$$\n\n\u548c\n\n$$F_n(x)=F_{n-1}(x)+xF_{n-1}(x)+xF_{n-2}(x)$$\n\n\u7136\u540e\u662f\u4e2a\u5c0f $\\texttt{trick}$\uff1a\n\n$$\\begin{cases}F_{2n}(x)=F^2_n(x)+xF^2_{n-1}(x)\\\\F_{2n-1}(x)=F_n(x)F_{n-1}(x)+xF_{n-1}(x)F_{n-2}(x)\\\\F_{n-2}(x)=F_{n-1}^2(x)+xF_{n-2}^2(x)\\end{cases}$$\n\n\u7136\u540e\u6ce8\u610f\u5230\u6211\u4eec\u53ef\u4ee5\u4ece $(F_{n-2}(x),F_{n-1}(x),F_{n}(x))$ \u8f6c\u79fb\u5230 $(F_{2n-2}(x),F_{2n-1}(x),F_{2n}(x))$\uff0c\u518d\u52a0\u4e0a\u7ebf\u6027\u8f6c\u79fb\uff0c\u5c31\u5f88\u7b26\u5408\u500d\u589e FFT \u7684\u57fa\u672c\u6761\u4ef6\u4e86\u3002\n\n\u4e8e\u662f\u9ad8\u9ad8\u5174\u5174\u8f6c\u79fb\u5c31\u5f97\u4e86\u3002\n\n\u4ee3\u7801\u4e2d $\\texttt{setBit}$ \u662f $f_n\\to f_{n+1}$\uff0c\u7136\u540e $\\texttt{shift}$ \u662f $f_n\\to f_{2n}$\uff0c\u5c31\u8ddf\u4f4d\u8fd0\u7b97\u7684\u8bbe\u7f6e\u6700\u540e\u4e00\u4f4d\u548c\u5de6\u79fb\u4e00\u6837\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\uff08\u500d\u589e\u4e00\u4e2a $\\log$\uff0cFFT \u4e00\u4e2a $\\log$\uff09\n\n\u5230\u65f6\u5019\u6765\u5199\u5feb\u4e00\u70b9\u7684\u505a\u6cd5\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=262151,MOD=998244353,G=3,INVG=332748118;\nll cnt,kk,limit;\nll f[3][MAXN],g[5][MAXN],rev[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n    li res=1;\n    while(exponent)\n    {\n        if(exponent&1)\n        {\n            res=1ll*res*base%MOD;\n        }\n        base=1ll*base*base%MOD,exponent>>=1;\n    }\n    return res;\n}\ninline void NTT(ll *cp,ll cnt,ll inv)\n{\n    ll cur=0,res=0,omg=0;\n    for(register int i=0;i<cnt;i++)\n    {\n        if(i<rev[i])\n        {\n            swap(cp[i],cp[rev[i]]);\n        }\n    }\n    for(register int i=2;i<=cnt;i<<=1)\n    {\n        cur=i>>1,res=qpow(inv==1?G:INVG,(MOD-1)/i);\n        for(register ll *p=cp;p!=cp+cnt;p+=i)\n        {\n            omg=1;\n            for(register int j=0;j<cur;j++)\n            {\n                ll t=1ll*omg*p[j+cur]%MOD,t2=p[j];\n                p[j+cur]=(t2-t+MOD)%MOD,p[j]=(t2+t)%MOD;\n                omg=1ll*omg*res%MOD;\n            }\n        }\n    }\n    if(inv==-1)\n    {\n        ll invl=qpow(cnt,MOD-2);\n        for(register int i=0;i<cnt;i++)\n        {\n            cp[i]=1ll*cp[i]*invl%MOD;\n        }\n    }\n}\ninline void shift(ll fd)\n{\n\tll cnt=1,limit=-1;\n\twhile(cnt<=(fd<<1))\n\t{\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t\tg[0][i]=g[1][i]=g[2][i]=g[3][i]=g[4][i]=0;\n\t}\n\tNTT(f[0],cnt,1),NTT(f[1],cnt,1),NTT(f[2],cnt,1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\tg[0][i]=(li)f[0][i]*f[0][i]%MOD,g[1][i]=(li)f[1][i]*f[1][i]%MOD;\n\t\tg[2][i]=(li)f[2][i]*f[2][i]%MOD,g[3][i]=(li)f[0][i]*f[1][i]%MOD;\n\t\tg[4][i]=(li)f[1][i]*f[2][i]%MOD,f[0][i]=f[1][i]=f[2][i]=0;\n\t}\n\tNTT(g[0],cnt,-1),NTT(g[1],cnt,-1),NTT(g[2],cnt,-1);\n\tNTT(g[3],cnt,-1),NTT(g[4],cnt,-1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\tf[0][i]=(g[0][i]+(i?g[1][i-1]:0))%MOD;\n\t\tf[1][i]=(g[3][i]+(i?g[4][i-1]:0))%MOD;\n\t\tf[2][i]=(g[1][i]+(i?g[2][i-1]:0))%MOD;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\tg[0][i]=g[1][i]=g[2][i]=g[3][i]=g[4][i]=0;\n\t}\n\tfor(register int i=fd;i<cnt;i++)\n\t{\n\t\tf[0][i]=f[1][i]=f[2][i]=0;\n\t}\n}\ninline void setBit(ll fd)\n{\n\tfor(register int i=0;i<fd;i++)\n\t{\n\t\tf[2][i]=f[1][i],f[1][i]=f[0][i],f[0][i]=0;\n\t}\n\tf[0][0]=1;\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tf[0][i]=((f[1][i-1]+f[2][i-1])%MOD+f[1][i])%MOD;\n\t}\n}\nint main()\n{\n\tcnt=read(),kk=read(),f[0][0]=f[1][0]=f[0][1]=1,limit=log2(cnt);\n\tfor(register int i=limit-1;i>=0;i--)\n\t{\n\t\tshift(kk+10);\n\t\tif(cnt&(1<<i))\n\t\t{\n\t\t\tsetBit(kk+10);\n\t\t}\n\t}\n\tfor(register int i=1;i<=kk;i++)\n\t{\n\t\tprintf(\"%d \",f[0][i]);\n\t}\n}\n```",
        "postTime": 1589941103,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u6392\u6210\u4e00\u884c\u7684 $n$ \u4e2a\u7403\u5206\u6210 $k$ \u4e2a\u7ec4\uff0c\u4e00\u7ec4\u53ef\u4ee5\u662f\u4e00\u4e2a\u7403\u6216\u8005\u662f\u4e24\u4e2a\u76f8\u90bb\u7684\u7403\uff0c\u5141\u8bb8\u6709\u4e9b\u7403\u4e0d\u5728\u4efb\u4f55\u4e00\u7ec4\u91cc\u9762\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n\u4f60\u9700\u8981\u5bf9 $1\\sim k$ \u90fd\u6c42\u51fa\u7b54\u6848\u3002\n\n$\\texttt{Data Range:}1\\leq n\\leq 10^9,1\\leq k\\leq 2^{15}$\n\n### \u9898\u89e3\n\n\u770b\u4e86\u770b\u4e00\u5e74\u524d\u7684\u500d\u589e FFT \u53d1\u73b0\u90a3\u662f\u5783\u573e\u89e3\u6cd5\uff0c\u73b0\u5728\u968f\u4fbf\u5199\u4e86\u4e00\u4e2a\u7279\u5f81\u65b9\u7a0b\u6548\u7387\u662f\u539f\u6765\u7684 $15$ \u500d~~\u7136\u800c\u8fd8\u662f\u6bd4\u4e0d\u8fc7\u7ec4\u5408\u5bb9\u65a5~~\u3002\n\n\u9996\u5148\u6ce8\u610f\u5230\u679a\u4e3e\u7403\u7684\u5206\u7ec4\u60c5\u51b5\u6709\n\n$$f_{n,k}=f_{n-1,k}+f_{n-1,k-1}+f_{n-2,k-1}$$\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u53ef\u4ee5\u5c06\u4e00\u884c\u6253\u5305\uff1a\n\n$$\\sum\\limits_{k=0}^{\\infty}f_{n,k}x^{k}=\\sum\\limits_{k=0}^{n}f_{n-1,k}x^k+x\\sum\\limits_{k=0}^{n}f_{n-1,k-1}x^{k-1}+x\\sum\\limits_{k=0}^{n}f_{n-2,k-1}x^{k-1}$$\n\n\u7136\u540e\u5c06 $\\sum\\limits_{k=0}^{\\infty}f_{n,k}x^{k}$ \u5199\u6210\u6bd4\u8f83\u7f8e\u89c2\u7684 $F_n(x)$\uff1a\n\n$$F_n(x)=(1+x)F_{n-1}(x)+F_{n-2}(x)$$\n\n\u63a5\u4e0b\u6765\u53ef\u4ee5\u89e3\u7279\u5f81\u65b9\u7a0b\uff0c\u7528\u4e00\u4e2a\u65b0\u7684\u5143 $z$ \u6765\u8868\u793a\uff1a\n\n$$z^2-(1+x)z-1=0$$\n\n\u89e3\u5f97\n\n$$z_1=\\frac{(1+x)+\\sqrt{x^2+6x+1}}{2},z_2=\\frac{(1+x)-\\sqrt{x^2+6x+1}}{2}$$\n\n\u7136\u540e\u540c\u65f6\u6709 $F_0(x)=1,F_1(x)=1+x$\uff0c\u4f7f\u7528  Mathematica \u8ba1\u7b97\u53ef\u5f97\n\n$$F_n(x)=\\frac{(z_1^{n+1}-z_2^{n+1})}{\\sqrt{x^2+6x+1}}$$\n\n\u6ce8\u610f\u5230 $\\sqrt{x^2+6x+1}$ \u7684\u5e38\u6570\u9879\u4e3a $1$\uff0c\u6240\u4ee5 $z_2$ \u5e38\u6570\u9879\u4e3a $0$\uff0c\u4e8e\u662f\u53ef\u4ee5\u5c06 $F_n(x)$ \u5199\u6210\u8fd9\u6837\uff1a\n\n$$F_n(x)=\\frac{1}{\\sqrt{1+6x+x^2}}\\left(\\frac{1+x+\\sqrt{x^2+6x+1}}{2}\\right)^{n+1}$$\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u597d\u4e1c\u897f\u4e86\uff1a\u8fd9\u4e2a $\\sqrt{x^2+6x+1}$ \u7684\u7cfb\u6570\u548c\u5b83\u7684\u9006\u7684\u7cfb\u6570\u53ef\u4ee5 $O(n)$ \u9012\u63a8\u6c42\u3002\u8bbe $\\sqrt{x^2+6x+1}$ \u7684 $i$ \u6b21\u9879\u7cfb\u6570\u4e3a $f_i$\uff0c\u5176\u9006\u7684 $i$ \u6b21\u9879\u7cfb\u6570\u4e3a $g_i$ \u5219\u6709\u5982\u4e0b\u6574\u5f0f\u9012\u63a8\u5f0f\uff1a\n\n$$f_0=1,f_1=3,nf_n+(6n-9)f_{n-1}+(n-3)f_{n-2}=0$$\n\n\u4ee5\u53ca\n\n$$g_0=1,g_1=-3,ng_n+(6n-3)g_{n-1}+(n-1)g_{n-2}=0$$\n\n\u7136\u540e\u9012\u63a8\u51fa\u7cfb\u6570\u4e4b\u540e\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(k\\log k)$ \u800c\u4e14\u6ca1\u6709\u500d\u589e\u8d3c\u5927\u7684\u5e38\u6570\u3002\n\n\u8fd9\u4e2a\u9012\u63a8\u5f0f\u7684\u8bc1\u660e\u53ef\u4ee5\u53c2\u7167 Central Delannoy \u7684\u8bc1\u660e\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u548c Central Delannoy \u7684 GF \u662f\u5171\u8f6d\u7684\u3002\n\n\u5b9e\u73b0\u7684\u65f6\u5019\u8fd0\u7528\u4e86\u6570\u636e\u5206\u6cbb\u51cf\u5c0f\u5e38\u6570\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cctype>\n#include<cmath>\n#include<iostream>\n#include<algorithm>\n#pragma GCC optimize(\"Ofast,unroll-loops\")\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\ntypedef unsigned long long int ull;\nconst ll MAXN=65541,MOD=998244353,G=3,INVG=332748118;\nll n,kk,fd,c,invl;\nll rev[MAXN],omgs[MAXN],invo[MAXN],f[MAXN],g[MAXN],h[MAXN];\nll invx[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n    ll res=1;\n    while(exponent)\n    {\n        if(exponent&1)\n        {\n            res=(li)res*base%MOD;\n        }\n        base=(li)base*base%MOD,exponent>>=1;\n    }\n    return res;\n}\ninline void setupOmg(ll cnt)\n{\n    ll limit=log2(cnt)-1,omg;\n    omg=qpow(G,(MOD-1)>>(limit+1)),omgs[cnt>>1]=1;\n    for(register int i=(cnt>>1|1);i!=cnt;i++)\n    {\n\t\tomgs[i]=(li)omgs[i-1]*omg%MOD;\n    }\n    for(register int i=(cnt>>1)-1;i;i--)\n    {\n\t\tomgs[i]=omgs[i<<1]; \n    }\n}\ninline void NTT(ll *cp,ll cnt,ll inv)\n{\n    static ull tcp[MAXN];\n    register ll cur=0,x,shift=log2(cnt)-__builtin_ctz(cnt);\n    if(inv==-1)\n    {\n    \treverse(cp+1,cp+cnt);\n    }\n    for(register int i=0;i<cnt;i++)\n    {\n\t\ttcp[rev[i]>>shift]=cp[i];\n    }\n    for(register int i=2;i<=cnt;i<<=1)\n    {\n        cur=i>>1;\n        for(register int j=0;j<cnt;j+=i)\n        {\n            for(register int k=0;k<cur;k++)\n            {\n                x=tcp[j|k|cur]*omgs[k|cur]%MOD;\n                tcp[j|k|cur]=tcp[j|k]+MOD-x,tcp[j|k]+=x;\n            }\n        }\n    }\n    for(register int i=0;i<cnt;i++)\n    {\n    \tcp[i]=tcp[i]%MOD;\n    }\n    if(inv==1)\n    {\n\t\treturn;\n    }\n    x=MOD-(MOD-1)/cnt;\n    for(register int i=0;i<cnt;i++)\n    {\n\t\tcp[i]=(li)cp[i]*x%MOD;\n    }\n}\ninline void deriv(ll fd,ll *f,ll *res)\n{\n    for(register int i=1;i<fd;i++)\n    {\n        res[i-1]=1ll*f[i]*i%MOD;\n    }\n    res[fd-1]=0;\n}\ninline void integ(ll fd,ll *f,ll *res)\n{\n    for(register int i=1;i<fd;i++)\n    {\n        res[i]=1ll*f[i-1]*invx[i]%MOD;\n    }\n    res[0]=0;\n}\ninline void conv(ll fd,ll *f,ll *g,ll *res)\n{\n    static ll tmpf[MAXN],tmpg[MAXN];\n    ll cnt=1,limit=-1;\n    while(cnt<(fd<<1))\n    {\n        cnt<<=1,limit++;\n    }\n    for(register int i=0;i<cnt;i++)\n    {\n\t\ttmpf[i]=i<fd?f[i]:0,tmpg[i]=i<fd?g[i]:0;\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n    }\n    NTT(tmpf,cnt,1),NTT(tmpg,cnt,1);\n    for(register int i=0;i<cnt;i++)\n    {\n\t\ttmpf[i]=(li)tmpf[i]*tmpg[i]%MOD;\n    }\n    NTT(tmpf,cnt,-1);\n    for(register int i=0;i<fd;i++)\n    {\n\t\tres[i]=tmpf[i];\n    }\n}\ninline void invBF(ll fd,ll *f,ll *res)\n{\n\tli r,invl=qpow(f[0],MOD-2);\n\tres[0]=invl;\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tr=0;\n\t\tfor(register int j=0;j<i;j++)\n\t\t{\n\t\t\tr+=(li)res[j]*f[i-j]%MOD;\n\t\t}\n\t\tres[i]=(li)(MOD-r%MOD)*invl%MOD;\n\t}\n}\ninline void inv(ll fd,ll *f,ll *res)\n{\n    static ll tmp[MAXN];\n    if(fd<=1024)\n    {\n        return invBF(fd,f,res);\n    }\n    inv((fd+1)>>1,f,res);\n    ll cnt=1,limit=-1;\n    while(cnt<(fd<<1))\n    {\n        cnt<<=1,limit++;\n    }\n    for(register int i=0;i<cnt;i++)\n    {\n        tmp[i]=i<fd?f[i]:0;\n        rev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n    }\n    NTT(tmp,cnt,1),NTT(res,cnt,1);\n    for(register int i=0;i<cnt;i++)\n    {\n        res[i]=(li)(2-(li)tmp[i]*res[i]%MOD+MOD)%MOD*res[i]%MOD;\n    }\n    NTT(res,cnt,-1);\n    for(register int i=fd;i<cnt;i++)\n    {\n        res[i]=0;\n    }\n}\ninline void lnBF(ll fd,ll *f,ll *res)\n{\n\tli r;\n\tres[0]=0;\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tr=0;\n\t\tfor(register int j=1;j<i;j++)\n\t\t{\n\t\t\tr+=(li)f[j]*res[i-j]%MOD;\n\t\t}\n\t\tres[i]=((li)i*f[i]%MOD-r%MOD+MOD)%MOD;\n\t}\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tres[i]=(li)res[i]*invx[i]%MOD;\n\t}\n}\ninline void ln(ll fd,ll *f,ll *res)\n{\n    static ll pinv[MAXN],der[MAXN];\n    if(fd<=1024)\n    {\n    \treturn lnBF(fd,f,res);\n\t}\n    inv(fd,f,pinv),deriv(fd,f,der),conv(fd,pinv,der,der),integ(fd,der,res);\n    for(register int i=0;i<fd;i++)\n    {\n        der[i]=pinv[i]=0;\n    }\n}\ninline void expBF(ll fd,ll *f,ll *res)\n{\n\tli r;\n\tres[0]=1;\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tr=0,f[i]=(li)f[i]*i%MOD;\n\t\tfor(register int j=0;j<i;j++)\n\t\t{\n\t\t\tr+=(li)f[j+1]*res[i-j-1]%MOD;\n\t\t}\n\t\tres[i]=r%MOD*invx[i]%MOD;\n\t}\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tf[i]=(li)f[i]*invx[i]%MOD;\n\t}\n}\ninline void exp(ll fd,ll *f,ll *res)\n{\n    static ll texp[MAXN];\n\tif(fd<=1024)\n    {\n    \treturn expBF(fd,f,res);\n\t}\n\tif(fd==1)\n    {\n        return (void)(res[0]=1);\n    }\n    exp((fd+1)>>1,f,res),ln(fd,res,texp),texp[0]=(f[0]+1-texp[0]+MOD)%MOD;\n    for(register int i=1;i<fd;i++)\n    {\n        texp[i]=(f[i]-texp[i]+MOD)%MOD;\n    }\n    conv(fd,texp,res,res);\n}\nint main()\n{\n\tn=read(),kk=read(),fd=min(n,kk)+1;\n\tf[0]=g[0]=1,f[1]=3,g[1]=MOD-3,setupOmg(65536);\n\tfor(register int i=2;i<fd;i++)\n\t{\n\t\tc=((li)(6*i-9)*f[i-1]+(li)(i-3)*f[i-2])%MOD;\n\t\tf[i]=(li)(MOD-c)*(invl=qpow(i,MOD-2))%MOD;\n\t\tc=((li)(6*i-3)*g[i-1]+(li)(i-1)*g[i-2])%MOD;\n\t\tg[i]=(li)(MOD-c)*invl%MOD;\n\t}\n\tf[0]++,f[1]++,f[0]>>=1,f[1]>>=1,invx[1]=1;\n\tfor(register int i=2;i<fd;i++)\n\t{\n\t\tf[i]=f[i]&1?(f[i]+MOD)>>1:f[i]>>1;\n\t\tinvx[i]=(li)(MOD-MOD/i)*invx[MOD%i]%MOD;\n\t}\n\tln(fd,f,h);\n\tfor(register int i=0;i<fd;i++)\n\t{\n\t\th[i]=(li)h[i]*(n+1)%MOD,f[i]=0;\n\t}\n\texp(fd,h,f),conv(fd,f,g,h);\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tprintf(\"%d \",h[i]);\n\t}\n\tfor(register int i=fd;i<=kk;i++)\n\t{\n\t\tprintf(\"%d \",0);\n\t}\n}\n````",
        "postTime": 1606901590,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "\n[\u66f4\u597d\u7684\u4f53\u9a8c\uff1f](https://lb2003.top/archives/829.html)\n\n\u65b9\u7a0b\u4e3a: $f_{i,j}=f_{i-1,j-1}+f_{i-2,j-1}+f_{i-1,j}$ \uff0c\u5176\u4e2d $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u7403\u5206\u6210 $j$ \u7ec4\u7684\u65b9\u6848\u6570\u3002\n\n\u5177\u4f53\u5c31\u4e0d\u89e3\u91ca\u4e86\uff0c\u8fc7\u4e8e\u7b80\u5355\u3002\n\n\u7136\u540e\u53d1\u73b0\u53ef\u4ee5NTT\uff0c \u4ee4 $F(x)$ \u4e3a\u5176OGF\uff0c\u5373 $F_a(x)=\\sum\\limits_{j=0}^n f_{a,j} x^j$\n\n\u5c31\u53ef\u4ee5\u8fdb\u884c~~\u591a\u9879\u5f0f\u52a0\u6cd5~~\u4e86\uff0c$F_n(x)=(1+x)F_{n-1}(x)+xF_{n-2}(x)$\n\n\u73b0\u5728\u6709\u4e09\u79cd\u65b9\u6cd5:\n\n1. \u500d\u589eNTT\n2. \u5bb9\u65a5\u5377\u79ef\n3. \u6c42\u7279\u5f81\u65b9\u7a0b\u7684\u89e3\n\n#### solution 1\n\n\u89c2\u5bdf\u4e00\u4e0b\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u8981\u5408\u6210 $f_{a+b,j}$\n\n\u9664\u4e86\u4e0a\u8ff0\u8f6c\u79fb\u65b9\u7a0b\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5 $f_{a+b,j}=\\sum_{i=1}^jf_{a,i}f_{b,j-i}+\\sum_{i=1}^jf_{a-1,i}f_{b-1,j-i-1}$\n\n\u610f\u4e49\u63cf\u8ff0\u4e3a\u4e24\u6bb5\u5408\u5e76\u65f6\uff0c\u4e2d\u95f4\u90a3\u4e24\u4e2a\u5408\u4e0d\u5408\u4e3a\u4e00\u7ec4\uff0c\u72b6\u6001\u662f\u7b49\u4ef7\u7684\u3002\n\n\u8f6c\u5316\u6210\u5377\u79ef\u5f62\u5f0f\u5c31\u662f\n\n $F_{a+b}(x)=F_{a}(x)F_b(x)+xF_{a-1}F_{b-1}$\n\n\u7136\u540e\u8f6c\u5316\u6210\n\n$F_{2n}(x)=F^2_{n}(x)+xF^2_{n-1}(x)$\n\n$2n-1,2n-2$ \u7c7b\u4f3c\u3002\n\n\u4e4b\u540e\u5957\u500d\u589e\u6a21\u677f\u3002\n\n\u500d\u589e\u6a21\u677f\u5b9e\u9645\u4e0a\u5c31\u662f\u4ece\u9ad8\u4f4d\u5f80\u4f4e\u4f4d\u627e'1'\uff0c\u82e5\u6709\uff0c\u5219 $F(n)$ \u53d8\u6210 $F(n+1)$ \u3002\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<ctime>\n#include<map>\n#include<cstdlib>\n#include<vector> \n#define gc getchar()\n#define ll long long\n#define ull unsigned long long\n#define file(s) freopen(s\".in\",\"r\",stdin);freopen(s\".out\",\"w\",stdout)\n#define I inline \n#define clr(f,n) memset(f,0,sizeof(int)*(n))\n#define cpy(f,g,n) memcpy(f,g,sizeof(int)*(n)) \nusing namespace std;\nconst int N=2e5+5,mod=998244353,W=mod-1;\nconst ull G=3;\ntemplate<class o>I void qr(o &x)\n{\n\tchar c=gc;int f=1;x=0;\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n\tx*=f;\n}\ntemplate<class o>I void qw(o x)\n{\n\tif(x<0)x=-x,putchar('-');\n\tif(x/10)qw(x/10);\n\tputchar(x%10+48);\n}\nI int pls(int x,int y){return x+=y,x>=mod?x-mod:x;}\nI int ksm(int a,int b=mod-2){int ans=1;for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;return ans;}\nint tr[N<<1],cnt;\nI void rev(int n)\n{\n\tif(cnt==n)return ;cnt=n;\n\tfor(int i=0;i<n;i++)tr[i]=(tr[i>>1]>>1|((i&1)?n>>1:0));\n}\nvoid dft(int *g,bool op,int n)\n{\n\trev(n);\n\tstatic ull f[N<<1],w[N<<1]={1};\n\tfor(int i=0;i<n;i++)f[i]=((1ll*mod<<5)+g[tr[i]])%mod;\n\tfor(int p=2,l=1;p<=n;l=p,p<<=1)\n\t{\n\t\tw[1]=ksm(G,op?W-W/p:W/p);\n\t\tfor(int i=2;i<l;i++)w[i]=w[i-1]*w[1]%mod;\n\t\tfor(int i=0;i<n;i+=p)for(int j=0,t;j<l;j++)\n\t\t\tt=w[j]*f[i|j|l]%mod,f[i|j|l]=f[i|j]+mod-t,f[i|j]=f[i|j]+t;\n\t\tif(l==(1<<10))for(int i=0;i<n;i++)f[i]%=mod;\n\t}\n\tif(op)for(int i=0,t=ksm(n);i<n;i++)g[i]=f[i]%mod*t%mod;\n\telse for(int i=0;i<n;i++)g[i]=f[i]%mod;\n}\nI void px(int *f,int *g,int n){for(int i=0;i<n;i++)f[i]=1ll*f[i]*g[i]%mod;}\nint f[3][N<<1],g[5][N<<1];//f[0->n],f[1->n-1],f[1->n-2]\ninline void mul(int m)\n{\n\tint n=1;for(;n<(m<<1);n<<=1);\n\tdft(f[0],0,n);dft(f[1],0,n);dft(f[2],0,n);\n\tfor(int i=0;i<n;i++)\n\t\tg[0][i]=1ll*f[0][i]*f[0][i]%mod,g[1][i]=1ll*f[1][i]*f[1][i]%mod,\n\t\tg[2][i]=1ll*f[0][i]*f[1][i]%mod,g[3][i]=1ll*f[1][i]*f[2][i]%mod,\n\t\tg[4][i]=1ll*f[2][i]*f[2][i]%mod;\n\tdft(g[0],1,n),dft(g[1],1,n),dft(g[2],1,n),dft(g[3],1,n),dft(g[4],1,n);\n\tf[0][0]=g[0][0];f[1][0]=g[2][0],f[2][0]=g[1][0];\n\tfor(int i=1;i<n;i++)\n\t\tf[0][i]=pls(g[0][i],g[1][i-1]),\n\t\tf[1][i]=pls(g[2][i],g[3][i-1]),\n\t\tf[2][i]=pls(g[1][i],g[4][i-1]);\n\tclr(g[0],n),clr(g[1],n);clr(g[2],n),clr(g[3],n),clr(g[4],n);\n\tclr(f[0]+m,n);clr(f[1]+m,n);clr(f[2]+m,n);\n}\nvoid add(int n)\n{\n\tcpy(f[2],f[1],n);cpy(f[1],f[0],n);clr(f[0],n);f[0][0]=1;\n\tfor(int i=1;i<n;i++)f[0][i]=(1ll*f[1][i-1]+1ll*f[2][i-1]+1ll*f[1][i])%mod;\n}\nint main()\n{\n\tint n,m;qr(n),qr(m);f[0][0]=f[1][0]=f[0][1]=1;int lg=log2(n);\n\tfor(int i=lg-1;~i;i--)\n\t{\n\t\tmul(m+5);\n\t\tif(n&(1<<i))add(m+5);\n\t}\n\tfor(int i=1;i<=m;i++)\n\t\tqw(f[0][i]),putchar(' ');\n\tputs(\"\");\n\treturn 0;\n}\n```\n\n#### solution 2\n\n\u8003\u8651\u679a\u4e3e\u6709\u591a\u5c11\u4e2a\u4e8c\uff0c\n\n\u6709\u4e24\u79cd\u5f62\u5f0f: \n\n$$\\begin{aligned}ans_{i}=\\sum_{j=1}^i\\dbinom{n-j}{j}\\dbinom{n-2j}{i-j}=\\sum_{j=1}^i\\dbinom{n-j}{i}\\dbinom{i}{j}\\end{aligned}$$\n\n\u7b2c\u4e00\u79cd\u5c31\u662f\u628a $j$ \u4e2a\u7403\u5148\u62ff\u51fa\u6765\uff0c\u7136\u540e\u63d2\u8fdb $n-j$ \u4e2a\u7a7a( $n-j+1$ \u7684\u540c\u5b66\uff0c\u6700\u540e\u4e00\u4e2a\u7a7a\u4e0d\u8981)\u7684\u65b9\u6848\u6570,\u8fd9 $j$ \u4e2a\u7403\u81ea\u52a8\u4e0e\u5176\u540e\u9762\u76f8\u90bb\u7684\u7403\u5408\u5e76\u5728\u4e00\u8d77\u5f62\u6210 $j$ \u5806\u3002\n\n\u4e4b\u540e\u4ece\u5269\u4e0b\u7684 $n-2j$ \u4e2a\u7403\u4e2d\u9009 $i-j$ \u4e2a\u7403\u51d1\u6210 $i-j$ \u5806\u3002\n\n\u7b2c\u4e8c\u79cd\u5176\u5b9e\u662f\u4e0e\u7b2c\u4e00\u79cd\u7b49\u4ef7\u7684\u3002\n\n\u76f8\u5f53\u4e8e\u6709\u4e00\u4e2a\u6e38\u620f $n-j$ \u4e2a\u7403\uff0c\u5176\u4e2d\u6709 $i$ \u4e2a\u8981\u62ff\u51fa\u6765\uff0c$i$ \u4e2a\u4e2d\u6709 $j$ \u4e2a\u6bd4\u8f83\u7279\u6b8a(\u4ee3\u8868\u7740\u539f\u6765\u6e38\u620f\u4e2d\u7684\u4e24\u4e2a\u7403)\uff0c\u7b97\u51fa\u6765\u7684\u65b9\u6848\u6570\u5c31\u662f\u4e0a\u7b2c\u4e8c\u5f0f\u3002\n\n\u5982\u679c\u4e0d\u60f3\u8fd9\u6837\u7406\u89e3\u4e5f\u662f\u53ef\u4ee5\u901a\u8fc7\u4e00\u5f0f\u8f6c\u5316\u7684\u3002\n\n---\n\n\u89c2\u5bdf\u4e8c\u5f0f\uff0c$\\sum\\limits_{j=0}^i \\dbinom{n-j}{i}\\dbinom{i}{j}$\n\n\u5b83\u8fd8\u6709\u53e6\u5916\u4e00\u91cd\u610f\u4e49\u5c31\u662f\u524d $i$ \u4e2a\u9009 $[0,i]$ \u4e2a\uff0c\u4e4b\u540e\u4efb\u610f\u518d\u9009 $i$ \u4e2a\uff0c**\u7403**\u4e0d\u91cd\u590d\u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u5bb9\u65a5\u679a\u4e3e\u524d\u540e\u4e24\u6b21\u9009\u62e9\u81f3\u5c11\u6709 $j$ \u4e2a\u91cd\u590d\u7684\u7403\uff0c\u4e5f\u5c31\u662f\u524d $i$ \u4e2a\u81f3\u5c11\u9009 $j$ \u4e2a\uff0c\u4e4b\u540e\u5728 $n$ \u4e2a\u4e2d\u9009  $i$ \u4e2a\uff0c\n\n\u4e14\u5df2\u77e5\u6700\u5c11\u91cd\u590d $j$ \u4e2a\u7403\u7684\u65b9\u6848\u6570\u3002\n\n\u5f88\u663e\u7136\uff0c\u65b9\u6848\u6570\u65e0\u5173\u4e8e\u9009\u53d6\u54ea\u4e9b\u91cd\u590d\u7403\uff0c\u4ec5\u6709\u5173\u4e8e\u91cd\u590d\u7403\u7684\u6570\u91cf\u3002\n\n(\u8be6\u60c5\u53ef\u4ee5\u53c2\u8003\u300a\u7ec4\u5408\u6570\u5b66\u300b\u4e2d\u7684\u5bb9\u65a5\u539f\u7406)\n\n\u5373:\n\n$$\\sum\\limits_{j=0}^i (-1)^j\\dbinom{i}{j}\\dbinom{n-j}{i-j}2^{i-j}$$\n\n\u5176\u4e2d $2^{i-j}$ \u8868\u793a\u524d $i$ \u4e2a\u4f4d\u7f6e\u4e2d\u5269\u4e0b\u672a\u94a6\u5b9a\u7684 $i-j$ \u4e2a\u7403\u7684\u65b9\u6848\u6570\u3002\n\n\u5176\u5b9e\u628a $\\dbinom{n-j}{i-j}2^{i-j}$ \u5355\u72ec\u9694\u79bb\u5f00\uff0c\u7136\u540e\u5728\u524d $i$ \u4f4d\u7f6e\u679a\u4e3e $j$ \u4e2a\u4f4d\u7f6e$a_1,a_2,a_3,a_4,\\ldots,a_j$ \uff0c\u7136\u540e\u8fd9\u4e2a\u7279\u5b9a\u7684\u5e8f\u5217\u7684\u65b9\u6848\u6570\u5176\u5b9e\u5c31\u4e3a$\\dbinom{n-j}{i-j}2^{i-j}$\uff0c\u7531\u4e8e\u65e0\u5173\u4e8e\u5177\u4f53\u4f4d\u7f6e\uff0c\u800c\u8fd9\u6837\u7684\u5e8f\u5217\u5171\u6709 $\\dbinom{i}{j}$ \u4e2a\uff0c\u4e8e\u662f\u81f3\u5c11\u4e3a $j$ \u4e2a\u91cd\u590d\u7684\u7403 \u7684\u65b9\u6848\u6570\u5c31\u4e3a $\\dbinom{i}{j}\\dbinom{n-j}{i-j}2^{i-j}$ \u3002\n\n\u7136\u540e\u8f6c\u6362\u6210\u4e0b\u964d\u5e42\u5c31\u53ef\u4ee5NTT\u4e86:\n\n$$\\sum\\limits_{j=0}^i(-1)^j\\frac{i!n^{\\underline{i}}}{j!(i-j)!n^{\\underline{j}}(i-j)!}2^{i-j}$$\n\n\u76ee\u524d\u6700\u4f18\u89e3\u5c31\u62ff\u5230\u4e86\u3002\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<ctime>\n#include<map>\n#include<cstdlib>\n#include<vector> \n#define gc getchar()\n#define ll long long\n#define ull unsigned long long\n#define file(s) freopen(s\".in\",\"r\",stdin);freopen(s\".out\",\"w\",stdout)\n#define I inline \n#define clr(f,n) memset(f,0,sizeof(int)*(n))\n#define cpy(f,g,n) memcpy(f,g,sizeof(int)*(n)) \nusing namespace std;\nconst int N=2e5+5,mod=998244353,W=mod-1;\nconst ull G=3;\ntemplate<class o>I void qr(o &x)\n{\n\tchar c=gc;int f=1;x=0;\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n\tx*=f;\n}\ntemplate<class o>I void qw(o x)\n{\n\tif(x<0)x=-x,putchar('-');\n\tif(x/10)qw(x/10);\n\tputchar(x%10+48);\n}\n\nI int ksm(int a,int b=mod-2){int ans=1;for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;return ans;}\nint tr[N<<1],cnt;\nI void rev(int n)\n{\n\tif(cnt==n)return ;cnt=n;\n\tfor(int i=0;i<n;i++)tr[i]=(tr[i>>1]>>1|((i&1)?n>>1:0));\n} \nvoid dft(int *g,bool op,int n)\n{\n\trev(n);\n\tstatic ull f[N<<1],w[N<<1]={1};\n\tfor(int i=0;i<n;i++)f[i]=((1ll*mod<<5)+g[tr[i]])%mod;\n\tfor(int p=2,l=1;p<=n;l=p,p<<=1)\n\t{\n\t\tw[1]=ksm(G,op?W-W/p:W/p);\n\t\tfor(int i=2;i<l;i++)w[i]=w[i-1]*w[1]%mod;\n\t\tfor(int i=0;i<n;i+=p)for(int j=0,t;j<l;j++)\n\t\t\tt=w[j]*f[i|j|l]%mod,f[i|j|l]=f[i|j]+mod-t,f[i|j]=f[i|j]+t;\n\t\tif(l==(1<<10))for(int i=0;i<n;i++)f[i]%=mod;\n\t}\n\tif(op)for(int i=0,t=ksm(n);i<n;i++)g[i]=f[i]%mod*t%mod;\n\telse for(int i=0;i<n;i++)g[i]=f[i]%mod;\n}\nI void px(int *f,int *g,int n){for(int i=0;i<n;i++)f[i]=1ll*f[i]*g[i]%mod;}\nint dfac[N],fac[N],ifac[N],pw[N],n,k,f[N],g[N];\nvoid init(int m)\n{\n\tifac[0]=fac[0]=dfac[0]=pw[0]=1;\n\tfor(int i=1;i<=m;i++)fac[i]=1ll*fac[i-1]*i%mod,dfac[i]=1ll*dfac[i-1]*(n-i+1)%mod,pw[i]=pw[i-1]*2%mod;\n\tifac[m]=ksm(fac[m]);for(int i=m-1;i;i--)ifac[i]=1ll*ifac[i+1]*(i+1)%mod;\n}\nint main()\n{\n\tqr(n),qr(k);int m;init(m=min(n,k));\n\tfor(int i=0;i<=m;i++)f[i]=(1ll*ifac[i]*ksm(dfac[i])*((i&1)?-1:1)%mod+mod)%mod,g[i]=1ll*ifac[i]*ifac[i]%mod*pw[i]%mod;\n\tfor(n=1;n<=(m<<1);n<<=1);\n\tdft(f,0,n);dft(g,0,n);\n\tpx(f,g,n);\n\tdft(f,1,n);\n\tfor(int i=1;i<=m;i++)qw(1ll*dfac[i]*fac[i]%mod*f[i]%mod),putchar(' ');\n\tfor(int i=m+1;i<=k;i++)putchar('0'),putchar(' ');\n\tputs(\"\"); \n\treturn 0;\n}\n```\n\n### solution3 \n\n\u9c30\u5199\u7684\u5f88\u6e05\u695a\u3002",
        "postTime": 1591169269,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "\u539f\u6765\u7684\u9898\u89e3\u53ea\u8bb2\u4e86\u57fa\u672c\u601d\u8def\uff0c\u5e76\u6ca1\u6709\u8bb2\u592a\u591a\uff0c~~\u867d\u7136\u6211\u8fd8\u662f\u79d2\u61c2\u4e86\uff08\u9003\uff09~~\n\n\u56e0\u6b64\u6211\u5c31\u6765\u8bb2\u4e00\u4e0b\u8fd9\u4e2a\u9898\u600e\u4e48\u505a\u5427~\n\n\n------------\n\n\u9996\u5148\u4f60\u5f97\u770b\u51fa\u8fd9\u662f\u4e2aDP\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8bbe\u4e00\u4e2a\u72b6\u6001\uff1a$dp(i,j)$ \u8868\u793a\u524d $i$ \u4e2a\u7403\uff0c\u5206\u51fa $j$ \u7ec4\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4e24\u79cd\u8f6c\u79fb\u65b9\u5f0f\uff1a\n\n\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff1a\u6211\u4eec\u8003\u8651\u7b2c $i$ \u4e2a\u7403\u5982\u4f55\u5206\u7ec4\uff0c\u90a3\u4e48\u6709\u4e09\u79cd\u65b9\u6cd5\uff0c\u5206\u522b\u662f 1\u3001\u5355\u72ec\u4e00\u7ec4 2\u3001\u548c\u524d\u4e00\u4e2a\u5206\u5230\u4e00\u7ec4 3\u3001\u6254\u6389\u4e0d\u7ba1\u3002\n\n\u90a3\u4e48\u6709\u5982\u4e0b\u9012\u63a8\u5f0f\uff1a\n\n$dp(i,j)=dp(i-1,j-1)+dp(i-2,j-1)+dp(i-1,j)$\n\n\u5176\u4e2d\uff0c $dp(i-1,j)$ \u8868\u793a\u4e0d\u9009\uff0c\u5269\u4e0b\u4e24\u4e2a\u8868\u793a\u9009\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece $dp(i-1),dp(i-2)$ \u63a8\u51fa $dp(i)$\u3002\n\n\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff1a\u6211\u4eec\u8003\u8651\u5c06\u4e24\u6bb5\u7403\u201c\u62fc\u8d77\u6765\u201d\u3002\n\n\u5047\u5982\u8bf4\u6211\u4eec\u5df2\u7ecf\u7b97\u51fa\u4e86 $dp(a),dp(b)$\uff0c\u6211\u4eec\u5c06 $a$ \u4e2a\u7403\u653e\u5728\u524d\u9762\uff0c$b$ \u4e2a\u7403\u653e\u5728\u540e\u9762\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4e24\u79cd\u60c5\u5f62\uff1a\n\n1\u3001\u4ece\u524d $a$ \u4e2a\u7403\u4e2d\u5206\u82e5\u5e72\u7ec4\uff0c\u4ece\u540e $b$ \u4e2a\u7403\u4e2d\u5206\u82e5\u5e72\u7ec4\uff0c\u4e24\u8005\u4e92\u4e0d\u5e72\u6270\uff0c\u90a3\u4e48\u8f6c\u79fb\u5230 $dp(a+b,j)$ \u7684\u6709\uff1a\n\n$\\sum_{k=0}^{j} dp(a,k) * dp(b,j-k)$\n\n2\u3001\u7b2c $a,a+1$ \u4e2a\u5206\u5230\u4e00\u7ec4\uff0c\u524d $a-1$ \u4e0e\u540e $b-1$ \u4e2a\u5206\u82e5\u5e72\u7ec4\uff0c\u90a3\u4e48\u8f6c\u79fb\u5230 $dp(a+b,j)$ \u7684\u6709\uff1a\n\n$\\sum_{k=0}^{j-1} dp(a-1,k) * dp(b-1,j-k-1)$\n\n\u89c2\u5bdf\u8fd9\u4e24\u4e2a\u5f0f\u5b50\uff0c\u6211\u4eec\u53d1\u73b0\u5982\u679c\u6211\u4eec\u5c06 $dp(i)$ \u770b\u505a\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u5176\u4e2d $dp(i,j)$ \u662f\u5b83\u7684 $j$ \u6b21\u9879\u7cfb\u6570\uff0c\u90a3\u4e48\u521a\u521a\u4e24\u4e2a\u5f0f\u5b50\u662f\u4e0d\u662f\u5c31\u662f\u591a\u9879\u5f0f\u7684\u4e58\u6cd5\uff1f\n\n\u90a3\u4e48\u601d\u8def\u5c31\u6765\u4e86~\n\n\u5047\u5982\u8bf4\u6211\u4eec\u77e5\u9053\u4e86 $dp(x),dp(x-1),dp(x-2)$\uff08\u8fd9\u91cc\u7684 $dp(x)$ \u6307\u7684\u662f\u591a\u9879\u5f0f\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0a\u9762\u7684\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u63a8\u51fa\n\n$dp(x*2)=dp(x+x)$,\n\n$dp(x*2-1)=dp(x+(x-1))$,\n\n$dp(x*2-2)=dp((x-1)+(x-1))$\u3002\n\n\u5176\u4e2d\u591a\u9879\u5f0f\u4e58\u6cd5\u6211\u4eec\u53ef\u4ee5\u7528NTT\u5728 $O(k \\log_2 k)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\uff0c\u5176\u4e2d $k$ \u5c31\u662f\u9898\u76ee\u4e2d\u7684 $k$\u3002\n\n\u6211\u4eec\u8003\u8651\u5c06 $n$ \u4e8c\u8fdb\u5236\u62c6\u5206\uff0c\u5e76\u4e14\u4ece\u9ad8\u4f4d\u5411\u4f4e\u4f4d\u679a\u4e3e\u6bcf\u4e00\u4f4d\u3002\u6bcf\u4e00\u6b21\u90fd\u5148\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u7528\u5df2\u7ecf\u6c42\u51fa\u7684 $dp(x)$ \u6c42\u51fa $dp(2*x)$\uff0c\u7136\u540e\u5982\u679c\u8be5\u4f4d\u4e3a $1$ ,\u90a3\u4e48\u5c31\u7528\u6700\u5f00\u59cb\u8bb2\u7684\u7b2c\u4e00\u79cd\u65b9\u5f0f\u5728 $O(k)$ \u7684\u65f6\u95f4\u5185\u7528 $x,x-1$ \u63a8\u51fa $x+1$\u3002 \n\n\u601d\u8def\u8bb2\u7684\u5dee\u4e0d\u591a\u4e86\uff0c\u90a3\u4e48\u5c31\u4e0a\u4ee3\u7801\u5427\uff1a\n\n~~\u5728\u6b64\u732e\u4e0a\u672c\u849f\u84bb\u53c8\u4e11\u53c8\u6162\u7684\u4ee3\u7801\u2026\u2026~~\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\n#include<cstring>\n#define Mod 998244353\nusing namespace std;\nlong long fpow(long long a,long long b)\n{\n\tlong long ans=1,t=a;\n\twhile(b)\n\t{\n\t\tif(b&1)ans=ans*t%Mod;\n\t\tt=t*t%Mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nlong long inv(long long a)\n{\n\treturn fpow(a,Mod-2);\n}\nint rev[150010];\nvoid getrev(int bit)\n{\n\tfor(register int i=1;i<(1<<bit);i++)\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<(bit-1));\n\treturn ;\n}\nvoid ntt(long long* a,int n,int dft)//\u5c31\u662f\u4e00\u4e2antt\n{\n\tfor(register int i=0;i<n;i++)\n\t\tif(i<rev[i])swap(a[i],a[rev[i]]);\n\tfor(register int step=1;step<n;step<<=1)\n\t{\n\t\tlong long wn=fpow(3,(Mod-1)/(step<<1));\n\t\tif(dft==-1)wn=inv(wn);\n\t\tfor(register int i=0;i<n;i+=(step<<1))\n\t\t{\n\t\t\tlong long wnk=1;\n\t\t\tfor(register int j=i;j<i+step;j++)\n\t\t\t{\n\t\t\t\tlong long x=a[j];\n\t\t\t\tlong long y=wnk*a[j+step]%Mod;\n\t\t\t\ta[j]=(x+y)%Mod;\n\t\t\t\ta[j+step]=(x-y+Mod)%Mod;\n\t\t\t\twnk=wnk*wn%Mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(dft==-1)\n\t{\n\t\tlong long invn=inv(n);\n\t\tfor(int i=0;i<n;i++)\n\t\t\ta[i]=a[i]*invn%Mod;\n\t}\n\treturn ;\n}\nvoid cpy(long long* b,long long* a,int n)//\u590d\u5236\u591a\u9879\u5f0f\u2026\u2026\n{\n\tfor(int i=0;i<n;i++)\n\t\tb[i]=a[i];\n\treturn ;\n}\n//ans\u8868\u793a\u5f53\u524d\u7684\u7b54\u6848\uff0cans(i)\u5373dp(x-i)\nlong long ans[3][150010];\nlong long t[3][150010];\nlong long tmp[3][150010];\nint n,k;\n//I wanna \u6700\u597d\u73a9\u4e86\nvoid IwannaMUL()//\u7528x\u63a8\u51fa2*x\n{\n\tint s=1,bit=0;\n\twhile(s<(k<<1))s<<=1,bit++;\n\tgetrev(bit);\n\tfor(int i=0;i<=2;i++)\n\t\tntt(ans[i],s,1);\n\tfor(int i=0;i<=2;i++)\n\t{\n    \t//\u8fd9\u91cc\u5c31\u662f\u8ba1\u7b97\u4e58\u79ef\u7684\u5730\u65b9\uff0ctmp\u5373a*b\uff0ct\u5373(a-1)*(b-1)\n\t\tfor(int j=0;j<s;j++)\n\t\t\ttmp[i][j]=ans[i/2][j]*ans[i-i/2][j]%Mod;\n\t\tfor(int j=0;j<s;j++)\n\t\t\tt[i][j]=ans[i/2+1][j]*ans[i-i/2+1][j]%Mod;\n\t}\n\tfor(int i=0;i<=2;i++)\n\t{\n\t\tntt(tmp[i],s,-1);\n\t\tntt(t[i],s,-1);\n\t\tfor(int j=1;j<s;j++)\n\t\t\ttmp[i][j]=(tmp[i][j]+t[i][j-1])%Mod;\n\t}\n\tfor(int i=0;i<=2;i++)\n\t{\n\t\tcpy(ans[i],tmp[i],k);\n\t\tfor(int j=k;j<s;j++)\n\t\t\tans[i][j]=0;\n\t}\n\treturn ;\n}\nvoid IwannaADD()//\u7528x\u63a8\u51fax+1\n{\n\tcpy(ans[2],ans[1],k);\n\tcpy(ans[1],ans[0],k);\n\tfor(int i=0;i<k;i++)\n\t{\n    \t//\u90a3\u4e2a\u9012\u63a8\u5f0f\n\t\tans[0][i]=ans[1][i];\n\t\tif(i>0)ans[0][i]=(ans[0][i]+ans[1][i-1]+ans[2][i-1])%Mod;\n\t}\n\treturn ;\n}\nint main()\n{\n\tscanf(\"%d %d\",&n,&k);\n\tk++;\n\tans[0][0]=1;\n\tint s=0;\n\tfor(int i=1<<30;i;i>>=1)\n\t{\n\t\tif(s)IwannaMUL(),s<<=1;\n\t\tif(n&i)IwannaADD(),s++;\n\t}\n\tfor(int i=1;i<k;i++)\n\t\tprintf(\"%d \",ans[0][i]);\n\treturn ~~(0-0);//\u70b9\u4e2a\u8d5e\u5457~\\(\u2267\u25bd\u2266)/~\n}\n```",
        "postTime": 1544779006,
        "uid": 54475,
        "name": "\u732a\u8111\u5b50",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "*3200\uff1f\n\n*2300\uff01\n\n\u9996\u5148\u8003\u8651 dp\uff0c\u6709\u663e\u7136\u7684\u72b6\u6001 $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u4e2d\u9009\u4e86 $j$ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u5c31\u679a\u4e3e\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\u662f\u5426\u9009\uff0c\u5982\u679c\u9009\u4e86\u662f\u5426\u548c\u4e0a\u4e0a\u4e2a\u4f4d\u7f6e\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u5f97\u5230 $f_{i,j}=f_{i-1,j}+f_{i-1,j-1}+f_{i-2,j-1}$\uff0c\u76f4\u63a5\u505a\u662f $O(nk)$ \u7684\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u8bb0 $F_i(x)=\\sum\\limits_{j=0}^kf_jx^j$\uff0c\u90a3\u4e48\u8f6c\u79fb\u53ef\u4ee5\u5199\u6210 $F_i(x)=F_{i-1}(x)+xF_{i-1}(x)+xF_{i-2}(x)=(x+1)F_{i-1}(x)+xF_{i-2}(x)$\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u9012\u63a8\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\uff0c\u5177\u4f53\u6765\u8bf4\u76f4\u63a5\u628a\u77e9\u9635\u7684\u5143\u7d20\u6362\u6210\u591a\u9879\u5f0f\uff0c\u4e58\u6cd5\u7528 NTT \u5408\u5e76\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(k\\log k\\log n)$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\nusing namespace std;\nconst int mod=998244353,g=3;\nint n,m,lim,tr[1<<16],A[1<<16],B[1<<16];\ninline int pw(int a,int b)\n{\n    int res=1;\n    while(b)\n    {\n        if(b&1)\n            res=1ll*res*a%mod;\n        b>>=1;\n        a=1ll*a*a%mod;\n    }\n    return res;\n}\ninline int Mod(int x)\n{\n    return x>=mod? x-mod:x;\n}\nconst int invg=pw(g,mod-2);\ninline void init(int n)\n{\n    for(int i=0;i<n;++i)\n        tr[i]=(tr[i>>1]>>1)|(i&1? n>>1:0);\n}\ninline void NTT(int *f,int n,bool flag)\n{\n    for(int i=0;i<n;++i)\n        if(i<tr[i])\n            swap(f[i],f[tr[i]]);\n    for(int p=2;p<=n;p<<=1)\n    {\n        int len=p>>1,tg=pw(flag? g:invg,(mod-1)/p);\n        for(int k=0;k<n;k+=p)\n        {\n            int buf=1;\n            for(int l=k;l<k+len;++l)\n            {\n                int tt=1ll*buf*f[l+len]%mod;\n                f[l+len]=Mod(f[l]-tt+mod);\n                f[l]=Mod(f[l]+tt);\n                buf=1ll*buf*tg%mod;\n            }\n        }\n    }\n    if(!flag)\n    {\n        int inv=pw(n,mod-2);\n        for(int i=0;i<n;++i)\n            f[i]=1ll*f[i]*inv%mod;\n    }\n}\ninline vector<int> mul(vector<int> a,vector<int> b)\n{\n    int lena=a.size(),lenb=b.size(),lim=1;\n    for(;lim<lena+lenb;lim<<=1);\n    for(int i=0;i<lim;++i)\n    \tA[i]=B[i]=0;\n    for(int i=0;i<lena;++i)\n        A[i]=a[i];\n    for(int i=0;i<lenb;++i)\n        B[i]=b[i];\n    init(lim);\n    NTT(A,lim,1);\n    NTT(B,lim,1);\n    for(int i=0;i<lim;++i)\n        A[i]=1ll*A[i]*B[i]%mod;\n    NTT(A,lim,0);\n    vector<int> res;\n    for(int i=0;i<m+1;++i)\n        res.emplace_back(A[i]);\n    return res;\n}\ninline vector<int> add(vector<int> a,vector<int> b)\n{\n    vector<int> res(m+1);\n    for(int i=0;i<m+1;++i)\n        res[i]=Mod(a[i]+b[i]);\n    return res;\n}\nstruct matrix\n{\n    vector<int> a[2][2];\n    matrix()\n    {\n        a[0][0].clear();\n        a[0][1].clear();\n        a[1][0].clear();\n        a[1][1].clear();\n        a[0][0].resize(m+1);\n        a[0][1].resize(m+1);\n        a[1][0].resize(m+1);\n        a[1][1].resize(m+1);\n    }\n    inline void init()\n    {\n        a[0][0][0]=a[1][1][0]=1;\n    }\n};\ninline matrix operator *(matrix x,matrix y)\n{\n    matrix res;\n    for(int i=0;i<2;++i)\n        for(int j=0;j<2;++j)\n            for(int k=0;k<2;++k)\n                res.a[i][k]=add(res.a[i][k],mul(x.a[i][j],y.a[j][k]));\n    return res;\n}\ninline matrix pw(matrix a,int b)\n{\n    matrix res;\n    res.init();\n    while(b)\n    {\n        if(b&1)\n            res=res*a;\n        b>>=1;\n        a=a*a;\n    }\n    return res;\n}\nint main()\n{\n    cin>>n>>m;\n    matrix o,w;\n    w.a[0][0][1]=w.a[0][0][0]=w.a[0][1][0]=1;\n    o.a[0][0][1]=o.a[0][0][0]=o.a[0][1][0]=o.a[1][0][1]=1;\n    o=pw(o,n-1);\n    w=w*o;\n    for(int i=1;i<=m;++i)\n        cout<<w.a[0][0][i]<<\" \";\n    cout<<'\\n';\n    return 0;\n}\n```",
        "postTime": 1675052073,
        "uid": 85682,
        "name": "\u7edd\u9876\u6211\u4e3a\u5cf0",
        "ccfLevel": 8,
        "title": "CF755G PolandBall and Many Other Balls \u9898\u89e3"
    },
    {
        "content": "\u66f4\u68d2\u68d2\u68d2\u68d2\u7684\u4f53\u9a8c $\\to$ [`George1123`](https://www.cnblogs.com/George1123/p/14073540.html)\n\n---\n\n## \u9898\u9762\n\n> [CF755G PolandBall and Many Other Balls](https://www.luogu.com.cn/problem/CF755G)\n\n> \u7ed9\u5b9a $n$ \u548c $m$\u3002\u6709\u4e00\u6392 $n$ \u4e2a\u7403\uff0c\u6c42\u5bf9\u4e8e\u6bcf\u4e2a $1\\le k\\le m$\uff0c\u9009\u51fa $k$ \u4e2a\u7403\u6216\u76f8\u90bb\u7684\u7403\u4e0d\u80fd\u91cd\u590d\u7684\u65b9\u6848\u6570\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$1\\le n\\le 10^9$\uff0c$1\\le m<2^{15}$\u3002\n\n---\n\n## \u8def\u6807\n\n\u8fd9\u9898\u662f\u8001\u7ecf\u5178\u9898\u4e86\uff0c\u524d\u4eba\u7684\u63cf\u8ff0\u4e5f\u8db3\u591f\u5145\u5206\u4e86\u3002\n\n\u4f46\u662f\u849f\u84bb\u5c1d\u8bd5\u4e86\u8fd9\u9898\u7684 $3$ \u79cd\u505a\u6cd5\u5e76\u8bb0\u5728\u7b14\u8bb0\u4e2d\u540e\u8fd8\u662f\u5fcd\u4e0d\u4f4f~~\u53bb\u6323\u5495\u503c~~\u5206\u4eab\u7ed9\u5927\u5bb6\u3002\n\n\n\u8fd9\u662f\u7684\u4e09\u79cd\u505a\u6cd5\u5bf9\u6bd4\u56fe\uff08\u4ece\u4e0b\u5230\u4e0a\u4f9d\u6b21\u662f\u500d\u589e\uff08$\\Theta(n\\log^2 n)$\uff09\u3001\u7ec4\u5408\u5bb9\u65a5\uff08$\\Theta(n\\log n)$\uff09\u548c\u7279\u5f81\u65b9\u7a0b\uff08$\\Theta(n\\log n)$\uff09\uff09\uff1a\n\n\n![\u56fe\u7247\u53ef\u80fd\u6302\u4e86](https://i.loli.net/2020/12/02/WIYQNlv97Sdc1ZL.jpg)\n\n\n\u4ee3\u7801\u4e2d\u7684 $n$ \u548c $m$ \u53ef\u80fd\u548c\u9898\u9762\u4e2d\u4e0d\u662f\u540c\u4e2a\u4e1c\u897f `/wul`\u3002\n\n---\n\n## \u7ec4\u5408\u5bb9\u65a5\n\n\u8003\u8651\u679a\u4e3e\u4e24\u4e2a\u7403\u7684\u7ec4\u7684\u6570\u91cf\uff0c\u8fd9\u5e94\u8be5\u662f\u6700\u5bb9\u6613\u60f3\u5230\u7684\u5f0f\u5b50\u4e86\uff1a\n\n$$\n\\begin{aligned}\nf(k)&=\\sum_{i=0}^k {n-i \\choose k}{k\\choose i}\\\\\n\\end{aligned}\n$$\n\n\u53ef\u662f\u8fd9\u4e2a\u4e1c\u897f\u5f88\u96be\u63a8\uff0c\u4e8e\u662f\u91cd\u5b9a\u4e49\u5b83\u7684\u7ec4\u5408\u610f\u4e49\uff1a\n\n\u5148\u4ece\u524d $k$ \u4e2a\u9009\u4efb\u610f\u4e2a\uff0c\u7136\u540e\u518d\u4ece\u5269\u4e0b\u7684\uff08\u4e5f\u53ef\u4ee5\u662f\u524d $k$ \u4e2a\uff01\uff09\u5f53\u4e2d\u9009 $k$ \u4e2a\u7684\u65b9\u6848\u6570\u3002\n\n\u6293\u4f4f\u5bb9\u65a5\u5207\u53e3\uff1a\u524d\u540e\u6ca1\u6709\u91cd\u590d\u3002\n\n\u8bbe $p(i)$ \u4e3a\u91cd\u590d $i$ \u4e2a\u5269\u4e0b\u4e0d\u91cd\u590d\u7684\u65b9\u6848\u6570\u3002\n\n\u8bbe $q(i)$ \u4e3a\u94a6\u5b9a\u91cd\u590d $i$ \u4e2a\u5269\u4e0b\u968f\u610f\u7684\u65b9\u6848\u6570\u3002\n\n$$q(i)=\\sum_{x=i}^k {x\\choose i} p(x)\\Longleftrightarrow p(i)=\\sum_{x=i}^k (-1)^{x-i} {x\\choose i} q(x)$$\n\n\u8fd8\u53ef\u4ee5\u7528\u201c\u4ece\u524d $k$ \u4e2a\u4e2d\u5148\u628a\u4e24\u6b21\u91cd\u590d\u7684 $i$ \u4e2a\u9009\u4e86\uff0c\u7136\u540e\u5bf9\u4e8e\u524d\u9762\u5269\u4e0b\u7684\u6bcf\u4e2a\u968f\u4fbf\u9009\u4e0d\u9009\uff0c\u540e\u9762\u7684\u9009 $k-i$ \u4e2a\u201d\u5f97\u51fa $q(i)$\u3002\n\n$$q(i)={k\\choose i}{n-i\\choose k-i}2^{k-i}$$\n\n\u6240\u4ee5\u4e0a\u5f0f\u7b49\u4e8e\n\n$$\n\\begin{aligned}\nf(k)=p(0)&=\\sum_{i=0}^k(-1)^i q(i)\\\\\n&=\\sum_{i=0}^k(-1)^i {k\\choose i}{n-i\\choose k-i}2^{k-i}\\\\\n&=\\sum_{i=0}^k(-1)^i \\frac{k!}{i!(k-i)!}\\cdot \\frac{(n-i)!}{(k-i)!(n-k)!}2^{k-i}\\\\\n&=\\frac{k!}{(n-k)!}\\sum_{i=0}^k \\frac{(-1)^i(n-i)!}{i!}\\cdot \\frac{2^{k-i}}{((k-i)!^2)}\\\\\n\\end{aligned}\n$$\n\n$n$ \u592a\u5927\u4e86\uff0c\u4e0d\u80fd\u76f4\u63a5\u5377\uff0c\u5f97\u5316\u4e0b\u964d\u5e42\uff1a\n\n$$\n\\begin{aligned}\nf(k)&=\\frac{k!}{(n-k)!}\\sum_{i=0}^k \\frac{(-1)^i(n-i)!}{i!}\\cdot \\frac{2^{k-i}}{((k-i)!^2)}\\\\\n&=\\frac{k!n!}{(n-k)!}\\sum_{i=0}^k \\frac{(-1)^i(n-i)!}{i!n!}\\cdot \\frac{2^{k-i}}{((k-i)!^2)}\\\\\n&=k!n^{\\underline k}\\sum_{i=0}^k \\frac{(-1)^i}{i!n^{\\underline i}}\\cdot \\frac{2^{k-i}}{((k-i)!^2)}\\\\\n\\end{aligned}\n$$\n\n---\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\n#define x first\n#define y second\n#define bg begin()\n#define ed end()\n#define pb push_back\n#define mp make_pair\n#define sz(a) int((a).size())\n#define R(i,n) for(int i(0);i<(n);++i)\n#define L(i,n) for(int i((n)-1);i>=0;--i)\nconst int iinf=0x3f3f3f3f;\nconst ll linf=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=1<<15,pN=1<<16,mN=N;\nint n,m,a[pN],b[pN];\n\n//Math\nconst int mod=998244353;\nvoid fmod(int &x){x+=x>>31&mod;}\nint Pow(int a,int x,int res=1){\n    for(;x;x>>=1,a=1ll*a*a%mod) (x&1)&&(res=1ll*res*a%mod);\n    return res;\n}\nint fac[mN],ifac[mN],dfac[mN],idfac[mN],pw=1;\n\n//Poly\nconst int G=3,iG=Pow(3,mod-2);\nint pn,rev[pN];\n#define cle(p) fill((p)+n,(p)+pn,0)\nint up2(int n){return 1<<int(ceil(log2(n)));}\nvoid revn(){R(i,pn) rev[i]=(rev[i>>1]>>1)|((i&1)*(pn>>1));}\nvoid ntt(int* p,bool t){\n    R(i,pn)if(i<rev[i]) swap(p[i],p[rev[i]]);\n    for(int mid=1;mid<pn;mid<<=1)\n        for(int wn=Pow(t?iG:G,(mod-1)/(mid<<1)),i=0;i<pn;i+=mid<<1)\n            for(int j=i,w=1,x,y;j<(mid|i);j++,w=1ll*w*wn%mod)\n                x=p[j],y=1ll*p[mid|j]*w%mod,fmod(p[j]+=y-mod),fmod(p[mid|j]=x-y);\n    if(t){int in=Pow(pn,mod-2); R(i,pn) p[i]=1ll*in*p[i]%mod;}\n}\n\n//Main\nint main(){\n    ios::sync_with_stdio(0);\n    cin.tie(0),cout.tie(0);\n    cin>>m>>n,++n,pn=up2(n<<1),revn();\n    fac[0]=dfac[0]=1;\n    R(i,n-1) fac[i+1]=(1ll+i)*fac[i]%mod;\n    R(i,min(n-1,m))dfac[i+1]=1ll*(m-i)*dfac[i]%mod;\n    ifac[n-1]=Pow(fac[n-1],mod-2);\n    idfac[min(n-1,m)]=Pow(dfac[min(n-1,m)],mod-2);\n    L(i,n-1) ifac[i]=(1ll+i)*ifac[i+1]%mod;\n    L(i,min(n-1,m)) idfac[i]=1ll*(m-i)*idfac[i+1]%mod;\n    R(i,n) b[i]=1ll*ifac[i]*ifac[i]%mod*pw%mod,fmod(pw=(pw<<1)-mod),\n        a[i]=1ll*ifac[i]*idfac[i]%mod,(i&1)&&(fmod(a[i]=-a[i]),true);\n    ntt(a,false),ntt(b,false);\n    R(i,pn) a[i]=1ll*a[i]*b[i]%mod; ntt(a,true),cle(a);\n    R(i,n) a[i]=1ll*a[i]*fac[i]%mod*dfac[i]%mod;\n    R(i,n)if(i) cout<<a[i]<<' '; cout<<'\\n'; \n    return 0;\n}\n```\n\n---\n\n## \u500d\u589e\n\n\u8bbe $f_{n,k}$ \u8868\u793a\u524d $n$ \u4e2a\u7403\u5206\u6210 $k$ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u7b80\u5355\u7684 `dp` \u5f0f\uff1a\n\n$$f_{n,k}=f_{n-1,k-1}+f_{n-2,k-1}+f_{n-1,k}$$\n\n\u8bbe $F_n(x)=\\sum_{k=0}^n f_{n,k}x^k$\uff0c\u53ef\u901a\u8fc7\u4e0a\u5f0f\u63a8\u51fa\uff1a\n\n$$F_n(x)=(1+x)F_{n-1}(x)+xF_{n-2}(x)$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u5728\u8fd9\u91cc\u8fd8\u6ca1\u7528\uff0c\u4f46\u662f\u540e\u9762\u7279\u5f81\u65b9\u7a0b\u505a\u6cd5\u7684\u65f6\u5019\u4f1a\u7528\u5230\u3002\n\n\u8003\u8651\u5c06\u4e24\u6392\u7403\u5408\u5e76\uff0c\u5206\u7c7b\u8ba8\u8bba\u4e2d\u95f4\u7684\u65ad\u53e3\u662f\u5426\u5207\u5f00\u4e86\u4e00\u7ec4\u76f8\u90bb\u7684\u7403\uff1a\n\n$$F_{n+m}(x)=F_n(x)F_m(x)+xF_{n-1}(x)F_{m-1}(x)$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u500d\u589e\u5377\u79ef\u4e86\uff0c\u8981\u7ef4\u62a4 $F_{2^k},F_{2^k-1},F_{2^k-2}$\uff1a\n\n$$\\begin{cases}F_{2n}=F_{n}^2+xF_{n-1}^2\\\\F_{2n-1}=F_{n}F_{n-1}+xF_{n-1}F_{n-2}\\\\F_{2n-2}=F_{n-1}^2+xF_{n-2}^2\\\\\\end{cases}$$\n\n\u7136\u540e\u8bbe\u5f53\u524d\u7684 $F_{m}$ \u8981\u4e0e\u500d\u589e\u6570\u7ec4\u5408\u5e76\uff0c\u5176\u5b9e\u53ea\u9700\u8981\u7ef4\u62a4 $F_{m}$ \u548c $F_{m-1}$ \u5373\u53ef\u3002\n\n$$\\begin{cases}F_{2^k+m}=F_{2^k}F_{m}+xF_{2^k-1}F_{m-1}\\\\F_{2^k+m-1}=F_{2^k-1}F_{m}+xF_{2^k-2}F_{m-1}\\\\\\end{cases}$$\n\n---\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\n#define x first\n#define y second\n#define bg begin()\n#define ed end()\n#define pb push_back\n#define mp make_pair\n#define sz(a) int((a).size())\n#define R(i,n) for(int i(0);i<(n);++i)\n#define L(i,n) for(int i((n)-1);i>=0;--i)\nconst int iinf=0x3f3f3f3f;\nconst ll linf=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=1<<15,pN=1<<16,D=31;\nint m,n,f[3][pN],ns[2][pN],tmp[3][pN];\n\n//Math\nconst int mod=998244353;\nvoid fmod(int &x){x+=x>>31&mod;}\nint Pow(int a,int x,int res=1){\n    for(;x;x>>=1,a=1ll*a*a%mod) (x&1)&&(res=1ll*res*a%mod);\n    return res;\n}\n\n//Poly\nconst int G=3,iG=Pow(G,mod-2);\nint pn,rev[pN];\nvoid revn(){R(i,pn) rev[i]=(rev[i>>1]>>1)|((i&1)*(pn>>1));}\nvoid ntt(int* p,bool t){\n    R(i,pn)if(i<rev[i]) swap(p[i],p[rev[i]]);\n    for(int mid=1;mid<pn;mid<<=1)\n        for(int wn=Pow(t?iG:G,(mod-1)/(mid<<1)),i=0;i<pn;i+=mid<<1)\n            for(int j=i,w=1,x,y;j<(mid|i);j++,w=1ll*w*wn%mod)\n                x=p[j],y=1ll*w*p[mid|j]%mod,fmod(p[j]=x+y-mod),fmod(p[mid|j]=x-y);\n    if(t){int in=Pow(pn,mod-2); R(i,pn) p[i]=1ll*p[i]*in%mod;}\n}\n\n//Main\nint main(){\n    ios::sync_with_stdio(0);\n    cin.tie(0),cout.tie(0);\n    cin>>m>>n,++n,pn=1;\n    while(pn<(n<<1)) pn<<=1; revn();\n    R(d,D){\n        if(d==0) f[0][0]=f[0][1]=f[1][0]=1,ns[0][0]=1;\n        else {\n            R(t,3)R(i,pn) tmp[t][i]=(i<n?f[t][i]:0);\n            R(t,3) ntt(tmp[t],false);\n            R(i,pn){\n                f[0][i]=1ll*tmp[0][i]*tmp[0][i]%mod;\n                f[1][i]=1ll*tmp[1][i]*tmp[0][i]%mod;\n                f[2][i]=1ll*tmp[1][i]*tmp[1][i]%mod;\n                tmp[0][i]=1ll*tmp[1][i]*tmp[1][i]%mod;\n                tmp[1][i]=1ll*tmp[1][i]*tmp[2][i]%mod;\n                tmp[2][i]=1ll*tmp[2][i]*tmp[2][i]%mod;\n            }\n            R(t,3) ntt(tmp[t],true),ntt(f[t],true);\n            R(t,3)R(i,n-1) fmod(f[t][i+1]+=tmp[t][i]-mod);\n            R(t,3) fill(f[t]+n,f[t]+pn,0);\n        }\n        if(m>>d&1^1) continue;\n        // cout<<\"@DEBUG d=\"<<d<<'\\n';\n        // R(i,pn) cout<<f[0][i]<<' ';cout<<'\\n';\n        R(t,3)R(i,pn) tmp[t][i]=(i<n?f[t][i]:0);\n        R(t,3) ntt(tmp[t],false);\n        R(t,2) ntt(ns[t],false);\n        R(i,pn){\n            int t[2]={ns[0][i],ns[1][i]};\n            ns[0][i]=1ll*t[0]*tmp[0][i]%mod;\n            ns[1][i]=1ll*t[0]*tmp[1][i]%mod;\n            tmp[0][i]=1ll*tmp[1][i]*t[1]%mod;\n            tmp[1][i]=1ll*tmp[2][i]*t[1]%mod;\n        }\n        R(t,2) ntt(ns[t],true),ntt(tmp[t],true);\n        R(t,2)R(i,n-1) fmod(ns[t][i+1]+=tmp[t][i]-mod);\n        R(t,2) fill(ns[t]+n,ns[t]+pn,0);\n    }\n    R(i,n)if(i) cout<<ns[0][i]<<' '; cout<<'\\n';\n    return 0;\n}\n```\n\n---\n\n## \u7279\u5f81\u65b9\u7a0b\n\n\u53c2\u8003\u500d\u589e\u5377\u79ef\u505a\u6cd5\u7684\u524d\u534a\u90e8\u5206\uff1a\n\n$$F_n(x)-(1+x)F_{n-1}(x)-xF_{n-2}(x)=0$$\n\n\u8fd9\u4e1c\u897f\u53ef\u4ee5\u591a\u9879\u5f0f\u7279\u5f81\u65b9\u7a0b\uff1a\u8bbe\u6709\u591a\u9879\u5f0f $a,b$ \u6ee1\u8db3\uff1a\n\n$$\nF_n(x)-bF_{n-1}(x)=a(F_{n-1}(x)-bF_{n-2}(x))\\\\\n\\therefore F_n(x)-(a+b)F_{n-1}(x)+abF_{n-2}(x)=0\\\\\n$$\n\n\u5df2\u77e5 $(a+b)=(x+1),ab=-x$\uff0c\u6240\u4ee5 $a,b$ \u662f\u7279\u5f81\u65b9\u7a0b\u7684\u4e24\u6839\uff1a\n\n$$\nA^2-(x+1)A-x=0\\\\\nA=\\frac{x+1\\pm \\sqrt{(x+1)^2+4x}}{2}\\\\\nA=\\frac{x+1\\pm \\sqrt{x^2+6x+1}}{2}\\\\\n$$\n\n\u8bbe $a=\\frac{x+1+\\sqrt{x^2+6x+1}}{2}$\uff0c$b=\\frac{x+1-\\sqrt{x^2+6x+1}}{2}$\u3002\n\n$$\nF_n(x)-bF_{n-1}(x)=a(F_{n-1}(x)-bF_{n-2}(x))\\\\\nF_n(x)-bF_{n-1}(x)=a^{n-1}(F_1(x)-bF_0(x))\\\\\n$$\n\n\u7531\u4e8e $\\Delta>0$\uff0c\u90a3\u4e2a\u6839\u53f7\u80af\u5b9a $>0$\uff0c$a\\neq b$\u3002\n\n$$\n\\begin{cases}\nF_n(x)-bF_{n-1}(x)=a^{n-1}(F_1(x)-bF_0(x))\\\\\nF_n(x)-aF_{n-1}(x)=b^{n-1}(F_1(x)-aF_0(x))\\\\\n\\end{cases}\\\\\na(F_n(x)-bF_{n-1}(x))-b(F_n(x)-aF_{n-1}(x))\\\\\n=a^{n}(F_1(x)-bF_0(x))-b^{n}(F_1(x)-aF_0(x))\\\\\n(a-b)F_n(x)=a^{n}(F_1(x)-bF_0(x))-b^{n}(F_1(x)-aF_0(x))\\\\\n$$\n\n\u52a0\u70b9\u6587\u5b57\u9632\u6b62\u770b\u5f97\u773c\u82b1 `/qq`\u3002\n\n$$\n\\begin{aligned}\nF_n&=\\frac{1}{a-b}(a^{n}(F_1(x)-bF_0(x))-b^{n}(F_1(x)-aF_0(x)))\\\\\n&=\\frac{1}{a-b}(a^n(x+1-b)-b^n(x+1-a))\\\\\n&=\\frac{a^{n+1}-b^{n+1}}{a-b}\\\\\n&=\\frac{\\left(\\frac{x+1+\\sqrt{x^2+6x+1}}{2}\\right)^{n+1}-\\left(\\frac{x+1-\\sqrt{x^2+6x+1}}{2}\\right)^{n+1}}{\\sqrt{x^2+6x+1}}^{\\color{orange}{(1)}}\\\\\n&\\equiv \\frac{\\left(\\frac{x+1+\\sqrt{x^2+6x+1}}{2}\\right)^{n+1}}{\\sqrt{x^2+6x+1}}\\pmod{x^{n+1}}\\\\\n\\end{aligned}\n$$\n\n\u7136\u540e\u5e26\u4e0a\u591a\u9879\u5f0f\u5168\u5bb6\u6876\u5c31\u53ef\u4ee5\u505a\u4e86\u3002\n\n---\n\n\u5f53\u65f6\u63a8\u5230 $\\color{orange}{(1)}$ \u90a3\u91cc\u7684\u65f6\u5019\u5176\u5b9e\u5df2\u7ecf\u53ef\u4ee5\u505a\u4e86\uff0c\u7136\u540e\u849f\u84bb\u70b9\u5f00\u9898\u89e3\u53d1\u73b0\u548c\u9c30\u7684\u4e0d\u4e00\u6837\uff0c\u849f\u84bb\u4e0d\u662f\u5f88\u61c2\u4e3a\u4ec0\u4e48\n\n$$\\left(\\frac{x+1-\\sqrt{x^2+6x+1}}{2}\\right)^{n+1}\\equiv 0\\pmod {x^{n+1}}$$\n\n\u7136\u540e `qq` \u7fa4\u4e2d\u7684 `Elegia` \u961f\u957f\u8fd8\u6709\u9c30\u73b0\u573a\u56de\u590d\uff1a\u56e0\u4e3a\u8fd9\u4e2a\u5f0f\u5b50\u5e38\u6570\u9879\u4e3a $0$\uff01\n\n\u5b66\u6570\u5b66\u5b66\u50bb\u4e86\uff0c\u90a3\u4e2a\u591a\u9879\u5f0f $x^2+6x+1$ \u5f00\u6839\u540e\u5e38\u6570\u9879\u80af\u5b9a\u662f $1$\uff0c\u5176\u5b9e\u662f\u53ef\u4ee5\u548c\u524d\u9762\u7684 $1$ \u62b5\u6d88\u7684\u3002\n\n---\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\n#define x first\n#define y second\n#define bg begin()\n#define ed end()\n#define pb push_back\n#define mp make_pair\n#define sz(a) int((a).size())\n#define R(i,n) for(int i(0);i<(n);++i)\n#define L(i,n) for(int i((n)-1);i>=0;--i)\nconst int iinf=0x3f3f3f3f;\nconst ll linf=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=1<<15,pN=1<<16,mN=pN;\nint n,m,pm,a[pN],b[pN],c[pN];\n\n//Math\nconst int mod=998244353;\nvoid fmod(int &x){x+=x>>31&mod;}\nint Pow(int a,int x,int res=1){\n    for(;x;x>>=1,a=1ll*a*a%mod) (x&1)&&(res=1ll*res*a%mod);\n    return res;\n}\nint miv[mN];\nvoid math_init(){\n    miv[1]=1;\n    R(i,mN)if(i>=2) fmod(miv[i]=-1ll*mod/i*miv[mod%i]%mod);\n}\n\n//Poly\nconst int G=3,iG=Pow(G,mod-2);\nint pn,rev[pN],red[pN],blue[pN],yel[pN];\n#define cle(p) fill((p)+n,(p)+pn,0)\nint up2(int n){return 1<<int(ceil(log2(n)));}\nvoid revn(){R(i,pn) rev[i]=(rev[i>>1]>>1)|((i&1)*(pn>>1));}\nvoid ntt(int* p,bool t){\n    R(i,pn)if(i<rev[i]) swap(p[i],p[rev[i]]);\n    for(int mid=1;mid<pn;mid<<=1)\n        for(int wn=Pow(t?iG:G,(mod-1)/(mid<<1)),i=0;i<pn;i+=mid<<1)\n            for(int j=i,w=1,x,y;j<(mid|i);j++,w=1ll*w*wn%mod)\n                x=p[j],y=1ll*w*p[mid|j]%mod,fmod(p[j]=x+y-mod),fmod(p[mid|j]=x-y);\n    if(t){int in=Pow(pn,mod-2); R(i,pn) p[i]=1ll*p[i]*in%mod;}\n}\nvoid deint(int* p,bool t){\n    if(t){L(i,pn)if(i) p[i]=1ll*p[i-1]*miv[i]%mod; p[0]=0;}\n    else {R(i,pn-1) p[i]=1ll*p[i+1]*(i+1)%mod; p[pn-1]=0;}\n}\nvoid mul(int* p,int* q,int n){\n    pn=n<<1,revn(),cle(p),cle(q),ntt(p,false),ntt(q,false);\n    R(i,pn) p[i]=1ll*p[i]*q[i]%mod; ntt(p,true),cle(q);\n}\nvoid inv(int* p,int* q,int n){\n    if(n==1) return void(q[0]=Pow(p[0],mod-2));\n    inv(p,q,n>>1),pn=n<<1,revn(),copy(p,p+n,red);cle(red),cle(q),ntt(q,false),ntt(red,false);\n    R(i,pn) fmod(q[i]=(-1ll*red[i]*q[i]%mod+2)*q[i]%mod); ntt(q,true),cle(q);\n}\nvoid ln(int* p,int* q,int n){\n    inv(p,q,n),pn=n<<1,revn(),copy(p,p+n,red),cle(red),cle(q);\n    deint(red,false),ntt(q,false),ntt(red,false);\n    R(i,pn) q[i]=1ll*q[i]*red[i]%mod; ntt(q,true),deint(q,true),cle(q);\n}\nvoid exp(int* p,int* q,int n){\n    if(n==1) return void(q[0]=1);\n    exp(p,q,n>>1),ln(q,blue,n),pn=n<<1,revn(),fmod(blue[0]-=1);\n    R(i,n) fmod(blue[i]=p[i]-blue[i]); ntt(q,false),ntt(blue,false);\n    R(i,pn) q[i]=1ll*q[i]*blue[i]%mod; ntt(q,true),cle(q),cle(blue);\n}\nvoid sqrt(int* p,int* q,int n){\n    if(n==1) return void(q[0]=1);\n    sqrt(p,q,n>>1),inv(q,blue,n),pn=n<<1,revn(),copy(p,p+n,yel);\n    cle(yel),cle(blue),ntt(blue,false),ntt(yel,false);\n    R(i,pn) blue[i]=1ll*blue[i]*yel[i]%mod; ntt(blue,true),cle(blue);\n    R(i,n) fmod(q[i]+=blue[i]-mod),q[i]=1ll*(mod+1)/2*q[i]%mod; cle(q);\n}\nvoid pow(int* p,int* q,int x,int n){\n    ln(p,yel,n); R(i,n) yel[i]=1ll*yel[i]*x%mod; exp(yel,q,n);\n}\n\n//Main\nint main(){\n    ios::sync_with_stdio(0);\n    cin.tie(0),cout.tie(0);\n    cin>>m>>n,++n,math_init(),pm=up2(n);\n    a[0]=1,a[1]=6,a[2]=1,sqrt(a,b,pm),inv(b,a,pm);\n    fmod(b[0]+=1-mod),fmod(b[1]+=1-mod);\n    R(i,pm) b[i]=499122177ll*b[i]%mod;\n    pow(b,c,(m+1)%mod,pm),mul(a,c,pm);\n    R(i,n)if(i) cout<<(i<=m?a[i]:0)<<' '; cout<<'\\n';\n    return 0;\n}\n```\n\n---\n\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1606891406,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "\u4f9d\u7167\u9898\u610f\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5217\u51fa\u751f\u6210\u51fd\u6570\n\n$$\n[x^n]\\frac{1}{1-(x+xt+x^2t)}\n$$\n\n\u5bf9\u6b64\u8fdb\u884c\u5404\u79cd\u4ee3\u6570\u53d8\u5f62\u5c31\u53ef\u4ee5\u5f97\u5230\u4e0d\u540c\u7684\u505a\u6cd5. \u8fd9\u91cc\u7ed9\u51fa\u6700\u4f4e\u590d\u6742\u5ea6\u7684\u505a\u6cd5\uff0c\u8003\u8651\u5c06\u4e0a\u5f0f\u770b\u505a\u5173\u4e8e $x$ \u7684\u7ebf\u6027\u9012\u63a8\uff0c\u5373\u5f97\n\n$$\n\\frac{r_1^{n+1}-r_2^{n+1}}{r_1-r_2}\n$$\n\n\u5176\u4e2d $r_1,r_2$ \u662f\u4ee3\u6570\u65b9\u7a0b $r^2-(1+t)r-t=0$ \u7684\u4e24\u4e2a\u6839. \u5982\u679c\u5c55\u5f00\u6765\u5199\u5c31\u662f\n\n$$\n\\frac{(1+t+\\sqrt{1+6t+t^2})^{n+1}-(1+t-\\sqrt{1+6t+t^2})^{n+1}}{2^{n+1}\\sqrt{1+6t+t^2}}\n$$\n\n\u7531\u4e8e $(1+t-\\sqrt{1+6t+t^2})$ \u7684\u5e38\u6570\u9879\u4e3a $0$ \uff0c\u6240\u4ee5\u505a $n+1$ \u6b21\u5e42\u540e\u4ece $n+1$ \u6b21\u9879\u624d\u5f00\u59cb\u6709\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u8ba1\u7b97\n\n$$\n\\frac{(1+t+\\sqrt{1+6t+t^2})^{n+1}}{2^{n+1}\\sqrt{1+6t+t^2}}\n$$\n\n\u6211\u4eec\u77e5\u9053\u8fd9\u662f\u4e00\u4e2a\u6574\u5f0f\u9012\u63a8. \u5177\u4f53\u5730\uff0c\u8bbe $k=n+1$\uff0c\u90a3\u4e48\u6574\u5f0f\u9012\u63a8\u5f0f\u4e3a\n\n$$\n\\begin{aligned}\nn(k-n)f_n=&\\left[(k-1)(2k-3)-5(k-3)(n-1)+5(n-1)(n-2)\\right]f_{n-1}\\\\\n&\\ +\\left[-2(k+1)(k-1)+5(k-1)(n-2)f_{n-2}-5(n-2)(n-3)\\right]f_{n-2}\\\\\n&\\ +\\left[(k-1)+(k-3)(n-3)-(n-3)(n-4)\\right]f_{n-3}\n\\end{aligned}\n$$\n\n\u521d\u503c\u4e3a\n\n$$\n\\begin{aligned}\nf_0&=1\\\\\nf_1&=2k-3\\\\\nf_2&=2k^2-10k+13\\\\\nf_3&=\\frac{4}{3}k^3-14k^2+\\frac{152}{3}k-63\n\\end{aligned}\n$$\n\n\u63a8\u5bfc\u6211\u4e5f\u4e0d\u4f1a\uff0c\u6211[\u62ff\u7535\u8111\u7b97\u7684](https://www.luogu.com.cn/blog/qwaszx/zheng-shi-di-tui-ji-xie-hua)\uff08\u96fe\uff09\n\n\u4e8e\u662f\u672c\u9898\u53ef\u4ee5\u5728 $O(n)$ \u751a\u81f3 $O(\\sqrt{n}\\log n)$ \u65f6\u95f4\u5185\u5b8c\u6210.",
        "postTime": 1611536702,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "\u8bbe $ f_{n, k} $ \u8868\u793a $ n $ \u4e2a\u7403\u53d6\u51fa $ k $ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u663e\u7136\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$ f_{n, k} = f_{n - 1, k} + f_{n - 1, k - 1} + f_{n - 2, k - 1} $$\n\n\u8fb9\u754c\u4e3a $ f_{0, 0} = 1 $\u3002\n\n\u76f4\u63a5\u8f6c\u79fb\u662f $ O(nk) $ \u7684\uff0c\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\uff1b\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u6539\u5199\u8f6c\u79fb\u65b9\u7a0b\uff0c\u7528\u500d\u589e\u7684\u601d\u60f3\u505a FFT\u3002\n\n~~\u4f46\u662f\u6211\u4e0d\u4f1a~~\n\n\u8003\u8651\u4ee4 $ F_n(x) = \\sum_k f_{n, k} x^k $\uff0c\u5373\u4ee4\u4e8c\u7ef4\u6570\u7ec4 $ f $ \u7684**\u6bcf\u4e00\u884c\u4f5c\u4e3a\u4e00\u4e2a\u591a\u9879\u5f0f**\u3002\u5219\u7531\u8f6c\u79fb\u65b9\u7a0b\u53ef\u5f97\uff1a\n\n$$ F_n(x) = (x + 1)F_{n - 1}(x) + xF_{n - 2}(x) $$\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u89e3\u7279\u5f81\u65b9\u7a0b\u63a8\u5f0f\u5b50\u505a\u3002\n\n~~\u4f46\u662f\u6211\u4e5f\u4e0d\u4f1a~~\n\n\u8003\u8651\u5982\u4f55\u4e0d\u8ba9 $ F_{n - 2}(x) $ \u51fa\u73b0\u5728\u5f0f\u5b50\u4e2d\u3002\u89c2\u5bdf $ f $ \u7684\u8f6c\u79fb\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/il79dh8o.png)\n\n~~\u753b\u56fe yyds~~\n\n\u6df1\u84dd\u8272\u7684\u4ee3\u8868\u8868\u683c\u7684\u8f6c\u79fb\u65b9\u5f0f\uff0c\u663e\u7136\u5982\u679c\u6309\u884c\u5b9a\u4e49\u591a\u9879\u5f0f\uff0c\u4e00\u5b9a\u4f1a\u51fa\u73b0 $ F_{n - 2}(x) $\uff08\u56e0\u4e3a\u9700\u8981\u4e24\u884c\u524d\u7684 $ f_{n - 2, k - 1} $ \u8f6c\u79fb\uff09\u3002\n\n\u8003\u8651\u6362\u4e00\u79cd\u591a\u9879\u5f0f\u5b9a\u4e49\u65b9\u5f0f\uff0c\u4ee4 $ F_n(x) = \\sum_k f_{n + k, k} x^k $\uff0c\u5373\u4ee4\u4e8c\u7ef4\u6570\u7ec4 $ f $ \u7684**\u6bcf\u6761\u5bf9\u89d2\u7ebf\u4f5c\u4e3a\u4e00\u4e2a\u591a\u9879\u5f0f**\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ojusmvwd.png)\n\n\u4f60\u60ca\u5947\u5730\u53d1\u73b0\u73b0\u5728 $ F_n(x) $ \u7684\u8f6c\u79fb\u53ea\u9700\u8981\u7528\u5230 $ F_n(x) $ \u548c $ F_{n - 1}(x) $ \u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u7528\u5230 $ F_{n - 2}(x) $\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff1a\n\n$$ \\therefore F_n(x) [x^k]  = F_{n - 1}(x) [x^k] + F_n(x) [x^{k - 1}] + F_{n - 1}(x) [x^{k - 1}] $$\n\n\u56e0\u6b64\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$ F_n(x) = xF_n(x) + (x + 1)F_{n - 1}(x) $$\n\n$$ F_n(x) = \\frac{1 + x}{1 - x} F_{n - 1}(x) = (\\frac{1 + x}{1 - x})^n F_0(x) $$\n\n\u8fb9\u754c\u60c5\u51b5\u662f $ F_0(x) = \\dfrac{1}{1 - x} $\uff0c\u5373\n\n$$ F_n(x) = \\frac{1}{1 - x}(\\frac{1 + x}{1 - x}) ^ n $$\n\n\u5f00\u59cb\u63a8\u67ff\u5b50 QAQ\n\n$$ F_n(x) [x^k] = \\sum_{i = 0}^k (\\frac{2}{1 - x} - 1)^n [x^i] $$\n\n$$ = \\sum_{i = 0}^k \\sum_{j = 0}^n \\binom{n}{j} (\\frac{2}{1 - x})^j (-1)^{n - j} [x^i] $$\n\n$$ = \\sum_{i = 0}^k \\sum_{j = 0}^n \\binom{n}{j} 2^j \\binom{i + j - 1}{j - 1} (-1)^{n - j} $$\n\n$$ = \\sum_{j = 0}^n \\binom{n}{j} 2^j (-1)^{n - j} \\sum_{i = 0}^k \\binom{i + j - 1}{j - 1} $$\n\n$$ = \\sum_{j = 0}^n \\binom{n}{j} 2^j (-1)^{n - j} \\sum_{i = 0}^k \\frac{(i + j - 1)!}{(j - 1)! i!} $$\n\n$$ = \\sum_{j = 0}^n \\binom{n}{j} 2^j (-1)^{n - j} \\frac{1}{(j - 1)!} \\sum_{i = 0}^k \\frac{1}{j} \\left( \\frac{(i + j)!}{i!} - \\frac{(i + j - 1)}{(i - 1)!} \\right) $$\n\n$$ = \\sum_{j = 0}^n \\binom{n}{j} 2^j (-1)^{n - j} \\frac{1}{j!} \\frac{(k + j)!}{k!} $$\n\n\uff08\u6574\u6570\u88c2\u9879\uff09\n\n$$ = \\sum_{i = 0}^n \\frac{n! 2^i (-1)^{n - i} (k + i)!}{(i!)^2 (n - i)! k!} $$\n\n\u7136\u540e\u4f60\u53d1\u73b0\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u5e76\u4e0d\u662f\u4e00\u4e2a\u591a\u9879\u5f0f\u4e2d\u7684\u6240\u6709\u9879\uff0c\u800c\u662f\u4e00\u7cfb\u5217\u6ee1\u8db3 $ n + k = N, 1 \\leqslant n \\leqslant K $ \u7684 $ F_n(x) [x^k] $\u3002\u5176\u4e2d $ N, K $ \u5373\u9898\u76ee\u8f93\u5165\u3002\n\n\u5982\u679c\u4f60\u4e0d\u660e\u767d\uff0c\u53ef\u4ee5\u628a\u8868\u683c\u659c\u8fc7\u6765\u770b\uff08$ f_{n, k} = f_{n, n - k} $\uff09\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/q3phqz0l.png)\n\n\u4e8e\u662f $ F_n(x) [x^k] = F_n(x) [x^{N - n}] $\n\n$$ = \\sum_{i = 0}^n \\frac{n! 2^i (-1)^{n - i} (N - n + i)!}{(i!)^2 (n - i)! (N - n)!} $$\n\n\u53d1\u73b0\u5f0f\u5b50\u4e2d\u7684\u9879\u53ef\u4ee5\u5206\u6210\u4e0e $ i $ \u6709\u5173\u7684\u548c\u4e0e $ n - i $ \u6709\u5173\u7684\uff0c\u800c\u4e24\u8005\u76f8\u52a0\u4e3a $ n $\u3002\u8fd9\u542f\u793a\u6211\u4eec\u505a\u5377\u79ef\uff1a\n\n$$ = \\frac{n!}{(N - n)!}\\sum_{i + j = n} \\frac{2^i}{(i!)^2} \\cdot \\frac{(-1)^j (N - j)!}{j!} $$\n\n\u8981\u6c42\u5bf9\u4e8e\u6240\u6709 $ 1 \\leqslant n \\leqslant K $ \u6c42\u51fa\u8be5\u5f0f\u3002\u663e\u7136\u5c06 $ \\dfrac{2^i}{(i!)^2} $ \u4e0e $ \\dfrac{(-1)^j (N - j)!}{j!} $ \u5206\u522b\u5217\u6210\u4e24\u4e2a\u591a\u9879\u5f0f\uff0c\u5377\u8d77\u6765\u518d\u5bf9\u4e8e\u6bcf\u4e00\u9879\u4e58\u4e0a $ \\dfrac{n!}{(N - n)!} $ \u5373\u53ef\n\n\u7136\u540e\u4f60\u53d1\u73b0 $ N \\leqslant 10^9, \\mod = 998244353 $\uff0c\u4e5f\u5c31\u662f\u8bf4\u2014\u2014\n\n$ (N - n)! \\equiv 0 \\pmod {998244353} $ \u53ef\u80fd\u6210\u7acb\n\n\u5654  \u5654  \u549a\n\n\u7ee7\u7eed\u89c2\u5bdf\u5377\u79ef\u5f0f\uff0c\u53d1\u73b0\u56e0\u4e3a $ j \\leqslant n, N - n \\leqslant N - j, (N - n)! | (N - j)! $\n\n\u56e0\u6b64 $ \\mod | (N - n)! \\Rightarrow \\mod | (N - j)! $\n\n\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n1. $ N - n \\geqslant \\mod = 998244353 $\u3002\u6b64\u65f6\u56e0\u4e3a $ \\forall j \\mod | (N - j)! $\uff0c\u53ef\u4ee5\u76f4\u63a5\u5c06\u6240\u6709\u7684 $ \\operatorname{mod} $ \u56e0\u5b50\u9664\u53bb\uff1a\u5728\u5904\u7406\u9636\u4e58\u65f6\u4e0d\u4e58\u4e0a\u5373\u53ef\u3002\n\n2. $ N - n < \\mod = 998244353 $\u3002\u6b64\u65f6\u5206\u6bcd\u6ca1\u6709 $ \\operatorname{mod} $ \u56e0\u5b50\uff0c\u5bf9\u4e8e\u90e8\u5206 $ j $ \u53ef\u80fd\u5b58\u5728 $ \\mod | (N - j)! $\uff0c\u800c\u8fd9\u4e9b\u9879\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5747\u4e3a $ 0 $\uff0c\u56e0\u6b64\u6b63\u5e38\u64cd\u4f5c\u5373\u53ef\u3002\n\n\u5b9e\u73b0\u65b9\u9762\uff0c\u5c06 $ \\dfrac{(-1)^j (N - j)!}{j!} $ \u5199\u6210\u4e24\u4e2a\u591a\u9879\u5f0f\uff08\u5206\u522b\u8bb0\u4e3a $ B, D $\uff09\uff0c$ B $ \u53ea\u5728 $ N - j < \\operatorname{mod} $ \u65f6\u6709\u503c\uff08$ \\geqslant \\operatorname{mod} $ \u65f6\u503c\u4e3a $ 0 $\uff09\uff1b\n\n$ D $ \u5728 $ N - j < \\operatorname{mod} $ \u65f6\u503c\u4e3a $ 0 $ \uff08\u5176\u5b9e $ N - n \\leqslant N - j $\uff0c\u8fd9\u90e8\u5206\u4e0d\u4f1a\u8d21\u732e\u5230\u5206\u6bcd\u6709 $ \\operatorname{mod} $ \u7684\u9879\u4e2d\uff09\uff0c$ N - j \\geqslant \\operatorname{mod} $ \u65f6\u5c06 $ (N - j)! $ \u4e2d\u7684 $ \\operatorname{mod} $ \u56e0\u5b50\u76f4\u63a5\u9664\u53bb\u3002\n\n\u7136\u540e\u5206\u522b\u4e0e $ \\dfrac{2^i}{(i!)^2} $\uff08\u8bb0\u4e3a $ A, C $\uff09\u505a\u5377\u79ef\u3002\u7edf\u8ba1\u7b54\u6848\u65f6\uff0c\u82e5 $ N - n < \\operatorname{mod} $ \u5219\u53d6 $ AC [x^n] $\uff0c\u82e5 $ N - n \\geqslant \\operatorname{mod} $ \u5219\u53d6 $ BD [x^n] $\uff0c\u5e76\u5c06 $ (N - n)! $ \u4e2d\u7684 $ \\operatorname{mod} $ \u56e0\u5b50\u9664\u53bb\u5373\u53ef\u3002\n\n\u4e8e\u662f\u4f60\u53d1\u73b0\u9700\u8981\u9884\u5904\u7406 $ (N - K)! \\sim N! $\uff0c\u800c $ N \\leqslant 10^9 $\u3002\n\n\u5206\u6bb5\u6253\u8868\u5373\u53ef\uff08\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $ O(K \\log K + \\sqrt{N}) $\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define int ll\nconst int mod = 998244353;\ninline int fastpow(int a, int n)\n{\n\tint ans = 1;\n\twhile(n)\n\t{\n\t\tif(n & 1)\n\t\t\tans = ans * a % mod;\n\t\ta = a * a % mod;\n\t\tn >>= 1;\n\t}\n\treturn ans;\n}\ninline int inv(int x)\n{\n\treturn fastpow(x, mod - 2);\n}\nconst int g = 3, ig = inv(g);\nconst int facs[] = {1, 295201906, 160030060, 957629942, 545208507, 213689172, 760025067, 939830261, 506268060, 39806322, 808258749, 440133909, 686156489, 741797144, 390377694, 12629586, 544711799, 104121967, 495867250, 421290700, 117153405, 57084755, 202713771, 675932866, 79781699, 956276337, 652678397, 35212756, 655645460, 468129309, 761699708, 533047427, 287671032, 206068022, 50865043, 144980423, 111276893, 259415897, 444094191, 593907889, 573994984, 892454686, 566073550, 128761001, 888483202, 251718753, 548033568, 428105027, 742756734, 546182474, 62402409, 102052166, 826426395, 159186619, 926316039, 176055335, 51568171, 414163604, 604947226, 681666415, 511621808, 924112080, 265769800, 955559118, 763148293, 472709375, 19536133, 860830935, 290471030, 851685235, 242726978, 169855231, 612759169, 599797734, 961628039, 953297493, 62806842, 37844313, 909741023, 689361523, 887890124, 380694152, 669317759, 367270918, 806951470, 843736533, 377403437, 945260111, 786127243, 80918046, 875880304, 364983542, 623250998, 598764068, 804930040, 24257676, 214821357, 791011898, 954947696, 183092975};\nint fac[100001], p2[100001];\nint rfac[100001][2];\ninline void Init(int n)\n{\n\tfac[0] = 1;\n\tfor(int i = 1; i <= n; i++)\n\t\tfac[i] = fac[i - 1] * i % mod;\n\tp2[0] = 1;\n\tfor(int i = 1; i <= n; i++)\n\t\tp2[i] = p2[i - 1] * 2 % mod;\n}\ninline void InitRFac(int n, int k)\n{\n\tk = min(n, k);\n\tint m = n - k, mm = m / 10000000, f = facs[mm];\n\tfor(int i = mm * 10000000 + 1; i <= m - 1; i++)\n\t\tf = f * (i == mod ? 1 : i) % mod;\n\tfor(int i = m; i <= n; i++)\n\t{\n\t\tf = f * (i == mod || i == 0 ? 1 : i) % mod;\n\t\trfac[n - i][0] = (i < mod ? f : 0);\n\t\trfac[n - i][1] = (i >= mod ? f : 0);\n\t}\n}\nint A[100001], B[100001], C[100001], D[100001];\nint r[100001];\ninline void getr(int n, int cnt)\n{\n\tfor(int i = 0; i < n; i++)\n\t\tr[i] = (r[i >> 1] >> 1) | ((i & 1) << (cnt - 1));\n}\ninline void NTT(int *a, int n, int op)\n{\n\tfor(int i = 0; i < n; i++)\n\t\tif(i < r[i])\n\t\t\tswap(a[i], a[r[i]]);\n\tfor(int i = 1; i < n; i <<= 1)\n\t{\n\t\tint wn = fastpow(op == 1 ? g : ig, (mod - 1) / (i << 1));\n\t\tfor(int j = 0; j < n; j += (i << 1))\n\t\t{\n\t\t\tint w = 1;\n\t\t\tfor(int k = 0; k < i; k++, w = w * wn % mod)\n\t\t\t{\n\t\t\t\tint x = a[j + k], y = w * a[i + j + k] % mod;\n\t\t\t\ta[j + k] = (x + y) % mod;\n\t\t\t\ta[i + j + k] = (x - y + mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(op == -1)\n\t{\n\t\tint in = inv(n);\n\t\tfor(int i = 0; i < n; i++)\n\t\t\ta[i] = a[i] * in % mod;\n\t}\n}\ninline void mul(int *a, int *b, int n)\n{\n\tint m = 1, c = 0;\n\twhile(m <= 2 * n)\n\t\tm <<= 1, c++;\n\tgetr(m, c);\n\tNTT(a, m, 1);\n\tNTT(b, m, 1);\n\tfor(int i = 0; i < m; i++)\n\t\ta[i] = a[i] * b[i] % mod;\n\tNTT(a, m, -1);\n}\nsigned main()\n{\n\tint n, k;\n\tscanf(\"%lld %lld\", &n, &k);\n\tInit(k);\n\tInitRFac(n, k);\n\tfor(int i = 0; i <= k; i++)\n\t{\n\t\tC[i] = A[i] = p2[i] * inv(fac[i] * fac[i] % mod) % mod;\n\t\tB[i] = (rfac[i][0] * inv(fac[i]) % mod * (i & 1 ? -1 : 1) + mod) % mod;\n\t\tD[i] = (rfac[i][1] * inv(fac[i]) % mod * (i & 1 ? -1 : 1) + mod) % mod;\n\t}\n\tfor(int i = 0; i <= k; i++)\n\t\tcout << A[i] << ' ' << B[i] << ' ' << C[i] << ' ' << D[i] << endl;\n\tmul(A, B, k);\n\tmul(C, D, k);\n\tfor(int i = 0; i <= k; i++)\n\t\tcout << A[i] << ' ' << C[i] << endl;\n\tfor(int i = 1; i <= k; i++)\n\t\tprintf(\"%lld \", n - i < mod ? fac[i] * inv(rfac[i][0]) % mod * A[i] % mod : fac[i] * inv(rfac[i][1]) % mod * C[i] % mod);\n\tputchar('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1616910323,
        "uid": 73645,
        "name": "_ztyqwq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "> \u6c42\u5728$n$\u4e2a\u7403\u4e2d\u53d6\u51fa$k$\u7ec4\u7403\u7684\u65b9\u6848\u6570($1$\u7ec4\u7684\u610f\u601d\u662f\u4e00\u4e2a\u7403\u6216\u4e24\u4e2a\u539f\u4f4d\u7f6e\u76f8\u90bb\u7684\u7403)\n\n\u4e3b\u8981\u63d0\u4f9b\u4e86\u4e00\u79cd(\u522b\u4eba\u6559\u6211\u7684)\u51cf\u5c11\u500d\u589e$FFT\\frac{1}{4}$\u5e38\u6570\u7684\u65b9\u6cd5\n\n\u9996\u5148\u601d\u8003\u6734\u7d20$dp$,\u8bbe$f_{i,j}$\u8868\u793a\u524d$i$\u4e2a\u7403\u4e2d\u53d6\u51fa$k$\u7ec4\u7403\u7684\u65b9\u6848\u6570\n\n\u5219$f_{i,j}=f_{i-1,j}+f_{i-1,j-1}+f_{i-2,j-1}$\n\n\u8868\u793a\u5bf9\u65b0\u52a0\u5165\u8fd9\u4e00\u4f4d\u7684\u4e09\u79cd\u9009\u62e9:\u4e0d\u8981/\u65b0\u5f00/\u5408\u5e76\n\n\u6784\u9020$f_{i,?}$\u7684\u751f\u6210\u51fd\u6570$F$\n\n\u5219$F_n=(x+1)F_{n-1}+xF_{n-2}$\n\n\u8003\u8651\u500d\u589e\u5f97\u5230$F_{n}$\uff0c\u500d\u589e\u5c31\u662f\u4e8c\u8fdb\u5236\u62fc\u51d1\uff0c\u4e5f\u5c31\u662f\u652f\u6301\u4e0b\u6807\u7684$*2/+1$\u64cd\u4f5c\n\n### +1\n\n----\n\n$$\n\\Huge F_{n+1}=(x+1)F_{n}+xF_{n-1}\n$$\n\n\u5b9e\u73b0\u4e0a\u662f\u76f4\u63a5\u7528$f$\u6765\u7b97\n\n### *2\n\n----\n\n\u8003\u8651\u505a\u4e00\u4e2a\u66f4\u6734\u5b9e\u7684\u95ee\u9898\n\n\u5bf9$f_{a+b,k}$\u53ef\u4ee5\u7531\u4e24\u4e2a\u5185\u90e8\u5212\u5206\u597d\u7ec4\u522b\u7684\u5e8f\u5217\u62fc\u63a5$\\displaystyle \\sum_i f_{a,i}f_{b,k-i}$\n\n\u4e5f\u53ef\u4ee5\u7531\u4e24\u4e2a**\u6709\u4e14\u4ec5\u6709\u4e00\u7ec4\u516c\u7528**\u7684\u5e8f\u5217\u62fc\u63a5$\\displaystyle \\sum_i f_{a-1,i}f_{b-1,k-i-1}$\n\n\u76f4\u63a5\u5c31\u662f$F_{a+b}=F_{a}F_{b}+xF_{a-1}F_{b-1}$\n\n\u6240\u4ee5\n$$\n\\large \\begin{cases}F_{2n-2}=F^2_{n-1}+xF^2_{n-2}\\\\F_{2n-1}=F_{n}F_{n-1}+xF_{n-1}F_{n-2}\\\\F_{2n}=F^2_{n}+xF^2_{n-1}\\end{cases}\n$$\n\n```cpp\ninline void Add(void){//(n-2,n-1,n)->(n-1,n,n+1)\n\tint i;for(i=0;i<=K;++i)f[i]=g[i],g[i]=h[i];\n\tfor(h[0]=g[0],i=1;i<=K;++i)h[i]=Mod(Mod(g[i]+g[i-1])+f[i-1]);\n}\ninline void Dou(void){//(n-2,n-1,n)->(2n-2,2n-1,2n)\n\tmemcpy(A,f,(Len)<<2),memcpy(B,g,(Len)<<2),memcpy(C,h,(Len)<<2);\n\tNTT(A,Len,1),NTT(B,Len,1),NTT(C,Len,1);\n\tint i,a,b,c,w,wn=qpow(3,(mod-1)/Len);\n\tfor(i=0,w=1;i<Len;++i,w=1ll*w*wn%mod){\n\t\ta=A[i],b=B[i],c=C[i];\n\t\tA[i]=(1ll*b*b+1ll*a*a%mod*w)%mod;\n\t\tB[i]=(1ll*b*c+1ll*a*b%mod*w)%mod;\n\t\tC[i]=(1ll*c*c+1ll*b*b%mod*w)%mod;//\u8fd9\u91cc\u5c11\u4e86\u4e24\u6b21NTT\n\t}\n\tNTT(A,Len,-1),NTT(B,Len,-1),NTT(C,Len,-1);\n\tmemcpy(f,A,(K+1)<<2),memcpy(g,B,(K+1)<<2),memcpy(h,C,(K+1)<<2);\n}\n```\n\n\u5b9e\u73b0\u4e0a\u795e\u5947\u7684$\\mathtt{Trick}$\u662f\u4e3a\u4e00\u4e2a\u591a\u9879\u5f0f\u4e58$x$\u5728\u70b9\u503c\u4e0b\u76f8\u5f53\u4e8e\u5bf9\u7b2c$i$\u4f4d\u4e58$\\omega_{n}^i$,```\u76f4\u63a5\u5c31\u662f\u5b9a\u4e49```",
        "postTime": 1596164881,
        "uid": 40629,
        "name": "zzw4257",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "> *A. [CF755G PolandBall and Many Other Balls](https://www.luogu.com.cn/problem/CF755G)*\n\n\u663e\u7136\u95ee\u9898\u5f62\u5982 $f_{i, j} = f_{i - 1, j} + f_{i - 1, j - 1} + f_{i - 2, j - 1}$ \u7684\u9012\u63a8\u3002\n\n\u53d1\u73b0 $n$ \u975e\u5e38\u5927\uff0c\u8003\u8651\u6839\u636e\u5b9e\u9645\u610f\u4e49\u5206\u6cbb\u3002\n\n\u5bf9\u4e8e\u4efb\u610f\u4e00\u79cd $L + R = n$\uff0c\u4ece $n$ \u4e2a\u7403\u91cc\u9762\u5206\u51fa $j$ \u7ec4\u7684\u65b9\u6848\u6570\u5c31\u662f\u5206\u522b\u4ece $L$ \u548c $R$ \u4e2a\u7403\u91cc\u9762\u5206\u51fa\u603b\u5171 $j$ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u7531\u4e8e\u8fd8\u6709 $i - 2$ \u9879\uff0c\u5373\u7b2c $L$ \u548c $L + 1$ \u4e2a\u7403\u53ef\u80fd\u88ab\u5206\u8fdb\u4e00\u7ec4\uff0c\u6240\u4ee5\u8fd8\u8981\u52a0\u4e0a\u5206\u522b\u4ece $L - 1$ \u548c $R - 1$ \u4e2a\u7403\u91cc\u9762\u5206\u51fa\u603b\u5171 $j - 1$ \u7ec4\u7684\u65b9\u6848\u6570\u3002\u7531\u4e8e\u4efb\u4f55\u4e00\u79cd\u5206\u7ec4\u65b9\u5f0f\u8981\u4e48\u4e0d\u5305\u542b $\\{L, L + 1\\}$\uff0c\u8981\u4e48\u5305\u542b\uff0c\u6240\u4ee5\u8fd9\u6837\u6570\u662f\u4e0d\u91cd\u4e0d\u6f0f\u7684\u3002\n\n\u6839\u636e\u4e0a\u8ff0\u5206\u6790\uff0c$f_{n, j} = \\left(\\sum\\limits_{x + y = j} f_{L, x} f_{R, y}\\right) + \\left(\\sum\\limits_{x + y = j - 1} f_{L - 1, x} f_{R - 1, y}\\right)$\uff0c\u5373 $f_n = f_L * f_R + x * f_{L - 1} * f_{R - 1}$\uff0c\u5176\u4e2d $*$ \u8868\u793a\u52a0\u6cd5\u5377\u79ef\u3002\n\n\u4ee4 $L = \\left\\lfloor\\dfrac n 2\\right\\rfloor$\uff0c$R = n - L$ \u9012\u5f52\uff0c\u518d\u4f7f\u7528 NTT \u4f18\u5316\u5377\u79ef\u5373\u53ef\u3002\n\n\u7b49\u7b49\uff1f\u590d\u6742\u5ea6\u662f\u4e0d\u662f\u6709\u4e9b\u95ee\u9898\uff1f\u5f53 $n$ \u662f\u5076\u6570\u65f6\u6211\u4eec\u4f1a\u9012\u5f52\u8fdb\u4e24\u4e2a\u89c4\u6a21\u4e3a $\\dfrac n 2$ \u7684\u5b50\u95ee\u9898\uff0c\u5f53 $n$ \u662f\u5947\u6570\u65f6\u5219\u4f1a\u9012\u5f52\u8fdb\u4e09\u4e2a\uff08\u5176\u5b9e\u4e24\u4e2a\u5c31\u591f\u4e86\uff0c\u56e0\u4e3a\u53ef\u4ee5\u9012\u63a8\uff09\u3002\n\n\u4e3b\u5b9a\u7406\u5206\u6790\u590d\u6742\u5ea6\uff0c$T(n) = 2T\\left(\\dfrac n 2\\right) + \\mathcal{O}(1)$\uff0c\u53d1\u73b0\u6211\u4eec\u8981\u505a $T(n) = \\mathcal{O}(n)$ \u6b21 NTT\uff01\u5927\u5bc4\u7279\u5bc4\uff01\n\n\u6b64\u65f6\u7b14\u8005\u6000\u7740\u7edd\u671b\u7684\u5fc3\u60c5\u7ed9\u8fd9\u73a9\u610f\u52a0\u4e86\u4e00\u4e2a\u8bb0\u5fc6\u5316\uff08\u731c\u6d4b\u5f88\u591a\u9012\u5f52\u90fd\u662f\u91cd\u590d\u7684\uff09\uff0c\u53d1\u73b0\u5b83\u8fc7\u4e86\uff1f\u8fd8\u8dd1\u7684\u98de\u5feb\uff1f\u51b7\u9759\u5206\u6790\u4e00\u4e0b\uff0c\u6211\u4eec\u4f3c\u4e4e\u786e\u5b9e\u4e0d\u4f1a\u8bbf\u95ee\u5230\u592a\u591a\u79cd\u7c7b\u7684\u4e0b\u6807 $i$\uff0c\u56e0\u4e3a\u53ea\u6709\u80fd\u88ab\u8868\u793a\u4e3a $\\dfrac {n - r}{2 ^ k}$ \u7684\u6570\u624d\u4f1a\u88ab\u9012\u5f52\u5230\uff0c\u800c $r$ \u53c8\u662f $\\mathcal{O}(1)$ \u7684\uff08\u56e0\u4e3a\u6bcf\u4e00\u5c42\u81f3\u591a\u51cf\u53bb $2$\uff0c\u800c\u4e0a\u4e00\u5c42\u9012\u5f52\u4e0b\u6765\u65f6\u51cf\u6389\u7684\u503c\u5728\u672c\u5c42\u9664\u4ee5 $2$ \u4e4b\u540e\u6298\u534a\u4e86\uff0c\u6240\u4ee5 $\\mathcal {O}(1 + \\frac 1 2 + \\frac 1 4 + \\cdots) = \\mathcal{O}(1)$\uff09\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $\\mathcal{O}(k\\log k\\log n)$\u3002\n\n\u770b\u4e86\u522b\u7684\u540c\u5b66\u7684\u9898\u89e3\u540e\u7b14\u8005\u53d1\u73b0\u76f4\u63a5\u5206\u6cbb\u5b9e\u9645\u4e0a\u548c\u500d\u589e NTT \u662f\u7b49\u4ef7\u7684\u3002\n\n\u6ce8\u610f\u591a\u9879\u5f0f $> 32767$ \u7684\u4f4d\u7f6e\u8981\u6e05\u7a7a\uff0c\u5426\u5219\u8fd9\u4e9b\u4f4d\u7f6e\u5faa\u73af\u5377\u79ef\u540e\u4f1a\u8d21\u732e\u81f3\u4f4e\u4f4d\u4f7f\u5f97\u7b54\u6848\u9519\u8bef\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ull unsigned long long\nconst int N = 1 << 16;\nconst int mod = 998244353;\nvoid add(int &x, int y) {x += y, x >= mod && (x -= mod);}\nint ksm(int a, int b) {\n\tint s = 1;\n\twhile(b) {\n\t\tif(b & 1) s = 1ll * s * a % mod;\n\t\ta = 1ll * a * a % mod, b >>= 1;\n\t}\n\treturn s;\n}\nvector <int> ans;\nint n, k, rev[N];\nvoid NTT(vector <int> &a, int op) {\n\tassert(a.size() == N);\n\tstatic ull f[N], w[N];\n\tfor(int i = 0; i < N; i++) f[i] = a[rev[i]];\n\tfor(int k = 1; k < N; k <<= 1) {\n\t\tint wn = ksm(op ? 3 : (mod + 1) / 3, (mod - 1) / k / 2);\n\t\tfor(int i = w[0] = 1; i < k; i++) w[i] = w[i - 1] * wn % mod;\n\t\tfor(int i = 0; i < N; i += k << 1)\n\t\t\tfor(int j = 0; j < k; j++) {\n\t\t\t\tint y = w[j] * f[i | j | k] % mod;\n\t\t\t\tf[i | j | k] = f[i | j] + mod - y, f[i | j] += y;\n\t\t\t}\n\t}\n\tint coef = op ? 1 : ksm(N, mod - 2);\n\tfor(int i = 0; i < N; i++) a[i] = f[i] % mod * coef % mod;\n}\nvector <int> operator * (vector <int> a, vector <int> b) {\n\t// cerr << \"chk \";\n\t// for(int i = 0; i < 4; i++) cout << a[i] << \" \"; cout << \"mult \";\n\t// for(int i = 0; i < 4; i++) cout << b[i] << \" \"; cout << \"is \";\n\tfor(int i = N >> 1; i < N; i++) a[i] = b[i] = 0; // WATCH OUT!\n\tNTT(a, 1), NTT(b, 1);\n\tfor(int i = 0; i < N; i++) a[i] = 1ll * a[i] * b[i] % mod;\n\tNTT(a, 0);\n\t// for(int i = 0; i < 4; i++) cout << a[i] << \" \"; cout << \"\\n\";\n\treturn a;\n\t// return NTT(a, 0), a;\n}\nmap <int, vector <int>> mp;\nvector <int> solve(int n) {\n\tvector <int> ans(N, 0);\n\tif(n == 0) return ans[0] = 1, ans;\n\tif(n == 1) return ans[0] = ans[1] = 1, ans;\n\tif(n == 2) return ans[0] = ans[2] = 1, ans[1] = 3, ans;\n\tif(mp.find(n) != mp.end()) return mp[n];\n\tint p = n - 2 >> 1;\n\tvector <int> f = solve(p), g = solve(p + 1), h = g;\n\t// cerr << \"see \" << p << endl;\n\t// for(int i = 0; i < 4; i++) cout << f[i] << \" \" << g[i] << endl;\n\tfor(int i = 1; i < N; i++) add(h[i], g[i - 1]), add(h[i], f[i - 1]);\n\tvector <int> r1 = f * (n & 1 ? g : f), r2 = g * (n & 1 ? h : g);\n\tfor(int i = 0; i < N; i++) ans[i] = r2[i], add(ans[i], i ? r1[i - 1] : 0);\n\treturn mp[n] = ans;\n}\nint main() {\n\t// freopen(\"1.in\", \"r\", stdin);\n\tfor(int i = 0; i < N; i++) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << 15);\n\tcin >> n >> k, ans = solve(n);\n\tfor(int i = 1; i <= k; i++) cout << ans[i] << \" \";\n\tcout << endl;\n\treturn cerr << clock() << endl, 0;\n}\n\n/*\n2022/4/28\nstart thinking at ??:??\n\n\u8bbe f_{i, j} \u8868\u793a n = i \u65f6\u5206\u6210 j \u6bb5\u7684\u65b9\u6848\u6570.\n\u4e00\u8f6e\u8f6c\u79fb i \u4e0b\u6807\u504f\u79fb\u91cf\u5f88\u5c0f, \u8003\u8651\u5206\u6cbb.\n\n\u8bbe n \u662f 2 \u7684\u500d\u6570, m = n / 2.\n\u663e\u7136, f_n = f_m * f_m, \u5377\u79ef.\n\u4ee5\u53ca\u9700\u8981\u989d\u5916\u8003\u8651\u9009\u62e9 {m, m + 1} \u7684\u552f\u4e00\u4e00\u79cd\u60c5\u51b5, \u5373 f_{m - 1} * f_{m - 1} * x ^ 1\n\u76f4\u63a5\u9012\u5f52\u5230 f_{m - 1} \u5373\u53ef.\n\u65f6\u95f4\u590d\u6742\u5ea6 k log k log n.\n\n\u8349, \u597d\u50cf\u5047\u4e86. f_{m - 1} \u6ca1\u6cd5\u63a8\u5230 f_m, \u5fc5\u987b\u5f97\u8981\u81f3\u5c11\u4e24\u4e2a.\n\u8fd9\u6837\u4e00\u6765 T(n) = 2T(n / 2) + O(1).\n\u89e3\u51fa\u6765 T(n) = O(n).\n\u5bc4.\n\n\u6211\u8d85, \u52a0\u4e2a\u8bb0\u5fc6\u5316\u5c31\u6ca1\u95ee\u9898\u4e86. \u54c8\u54c8\u54c8\u54c8\u54c8.\nsb \u9519\u8bef: NTT a, f \u641e\u53cd\u4e86.\n\u6ce8\u610f\u5927\u4e8e 32767 \u7684\u90e8\u5206\u8981\u6e05\u7a7a, \u5426\u5219\u5faa\u73af\u5377\u79ef\u5c31\u5bc4\u6389\u4e86.\n\nfinish debugging at 16:10\n*/\n```",
        "postTime": 1651418593,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "CF755G PolandBall and Many Other Balls"
    },
    {
        "content": "\u8bbe $dp_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u7403\u5206\u6210 $j$ \u7ec4\u7684\u65b9\u6848\u6570\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u5f88 naive \u7684 $dp$ \u8f6c\u79fb\uff0c$dp_{i,j}=dp_{i-1,j}+dp_{i-1,j-1}+dp_{i-2,j-1}$\uff0c\u4f46\u5f88\u663e\u7136\u6ca1\u5565\u529e\u6cd5\u4f18\u5316\u3002\n\n\u8003\u8651\u501f\u9274\u4e0a\u4e00\u9898\u7684\u529e\u6cd5\uff0c\u4ece $dp_{x}$ \u548c $dp_{y}$ \u8f6c\u79fb\u5230 $dp_{x+y,k}$\u3002\n\n\u5206\u63a5\u7f1d\u5904\u7ec4\u6210\u4e00\u7ec4\u548c\u63a5\u7f1d\u5904\u4e0d\u7ec4\u6210\u4e00\u7ec4\u7684\u60c5\u51b5\uff0c\u5373 $dp_{x+y,i}=\\sum\\limits_{k=0}^idp_{x,k}\\times dp_{y,i-k}+\\sum\\limits_{k=0}^{i-1}dp_{x-1,k}\\times dp_{y-1,i-k-1}$\n\n\u8bb0 $F_i$ \u4e3a $dp_i$ \u7684\u751f\u6210\u51fd\u6570\uff0c\u90a3\u4e48\u6709 $F_{x+y}=F_xF_y+xF_{x-1}F_{y-1}$\n\n\u4f46\u8fd9\u6837\u4e00\u6765\u5c31\u6709\u4e00\u4e2a\u95ee\u9898\u4e86\uff0c$F_{x+y}$ \u7684\u8f6c\u79fb\u5f0f\u4e2d\u4e0d\u4ec5\u6709 $F_x,F_y$\uff0c\u8fd8\u6709 $F_{x-1}$ \u548c $F_{y-1}$\uff0c\u8fd9\u53ef\u600e\u4e48\u529e\u5462\uff1f\n\n\u7136\u540e\u6211\u5c31\u5b8c\u7f8e\u5730\u6b7b\u5728\u4e86\u8fd9\u4e2a\u5730\u65b9\u3002\n\n\u5176\u5b9e\u662f\u4e00\u4e2a\u975e\u5e38 sb \u7684\u95ee\u9898\uff0c\u4f60\u5728\u6c42 $F_x$ \u7684\u65f6\u5019\u540c\u65f6\u628a $F_{x-1}$ \u7684\u503c\u6c42\u51fa\u6765\u5c31\u884c\u4e86\u3002\n\n\u90a3\u8fd9\u6837\u4e00\u6765\u53c8\u6709\u95ee\u9898\u4e86\uff0c\u4f60\u6c42 $F_{x+y}$ \u7684\u65f6\u5019\u540c\u65f6\u4e5f\u8981\u628a $F_{x+y-1}$ \u7684\u503c\u6c42\u51fa\u6765\uff0c\u90a3 $F_{x+y-1}$ \u7684\u503c\u600e\u4e48\u6c42\u5462\uff1f\n\n\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5f02\u5e38\u5bb9\u6613\uff0c$F_{x+y-1}=F_xF_{y-1}+xF_{x-1}F_{y-2}$\uff0c\u6240\u4ee5\u4f60\u518d\u8bb0\u5f55\u4e2a $F_{x-2}$ \u5373\u53ef\u3002\u800c $F_{x+y-2}=F_{x-1}F_{y-1}+xF_{x-2}F_{y-2}$\uff0c\u4e8e\u662f\u4f60\u53ef\u4ee5 $\\mathcal O(n\\log n)$ \u5730\u7528 $(F_x,F_{x-1},F_{x-2})$ \u548c $(F_{y},F_{y-1},F_{y-2})$ \u6c42\u51fa $(F_{x+y},F_{x+y-1},F_{x+y-2})$ \u4e86\u3002\u518d\u5957\u4e2a\u500d\u589e\u5373\u53ef\u901a\u8fc7\u6b64\u9898\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log^2n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntemplate<typename T> void read(T &x){\n\tx=0;char c=getchar();T neg=1;\n\twhile(!isdigit(c)){if(c=='-') neg=-1;c=getchar();}\n\twhile(isdigit(c)) x=x*10+c-'0',c=getchar();\n\tx*=neg;\n}\nconst int pr=3;\nconst int MAXP=1<<16;\nconst int MOD=998244353;\nint qpow(int x,int e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint n,k,A[MAXP+5],B[MAXP+5];\nint LEN=1,LOG=0,inv[MAXP+5],rev[MAXP+5],prs[MAXP+5][2],ipr;\nvoid NTT(int *a,int len,int type){\n\tint lg=log2(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=prs[i][type<0];\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*w*a[(i>>1)+j+k]%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1) for(int i=0;i<len;i++) a[i]=1ll*a[i]*inv[len]%MOD;\n}\nstruct data{int a[3][MAXP+5];data(){memset(a,0,sizeof(a));}};\nint tmp[6][MAXP+5];\nvoid merge(data &a,data &b){\n//\tputs(\"-1\");\n\tfor(int i=0;i<LEN;i++) tmp[0][i]=a.a[0][i],tmp[1][i]=a.a[1][i],tmp[2][i]=a.a[2][i];\n\tfor(int i=0;i<LEN;i++) tmp[3][i]=b.a[0][i],tmp[4][i]=b.a[1][i],tmp[5][i]=b.a[2][i];\n\tfor(int i=0;i<6;i++) NTT(tmp[i],LEN,1);\n\tfor(int i=0;i<LEN;i++){\n\t\tint t1=1ll*tmp[0][i]*tmp[3][i]%MOD;\n\t\tint t2=1ll*tmp[0][i]*tmp[4][i]%MOD;\n\t\tint t3=1ll*tmp[1][i]*tmp[4][i]%MOD;\n\t\tint t4=1ll*tmp[1][i]*tmp[5][i]%MOD;\n\t\tint t5=1ll*tmp[2][i]*tmp[5][i]%MOD;\n\t\ttmp[0][i]=t1;tmp[1][i]=t2;tmp[2][i]=t3;tmp[3][i]=t4;tmp[4][i]=t5;\n\t}\n\tfor(int i=0;i<5;i++) NTT(tmp[i],LEN,-1);\n//\tpolymul(a.a[0],b.a[0],tmp[0],LEN);polymul(a.a[0],b.a[1],tmp[1],LEN);\n//\tpolymul(a.a[1],b.a[1],tmp[2],LEN);polymul(a.a[1],b.a[2],tmp[3],LEN);\n//\tpolymul(a.a[2],b.a[2],tmp[4],LEN);\n\tfor(int i=0;i<=k;i++){\n\t\ta.a[0][i]=(tmp[0][i]+tmp[2][i-1])%MOD;\n\t\ta.a[1][i]=(tmp[1][i]+tmp[3][i-1])%MOD;\n\t\ta.a[2][i]=(tmp[2][i]+tmp[4][i-1])%MOD;\n\t}\n}\nint main(){\n//\tfreopen(\"out.txt\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&k);ipr=qpow(pr,MOD-2);\n\twhile(LEN<=k+k) LEN<<=1,LOG++;\n\tfor(int i=1;i<=LEN;i<<=1){\n\t\tinv[i]=qpow(i,MOD-2);\n\t\tprs[i][0]=qpow(pr,(MOD-1)/i);\n\t\tprs[i][1]=qpow(ipr,(MOD-1)/i);\n\t}\n\tdata x,y;x.a[0][0]=1;y.a[0][0]=y.a[0][1]=y.a[1][0]=1;\n\tfor(;n;n>>=1,merge(y,y)) if(n&1) merge(x,y);\n\tfor(int i=1;i<=k;i++) printf(\"%d%c\",x.a[0][i],(i==k)?'\\n':' ');\n\treturn 0;\n}\n```",
        "postTime": 1611460193,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "~~\u7f57\u9a6c\u7403\u4e07\u5c81\uff01\u7cbe\u7f57\u72c2\u559c\uff01~~\n\n\u8fd9\u4e48\u7f8e\u5999\u7684\u9898\uff0c\u81ea\u7136\u975e\u5e38\u6076\u5fc3\u3002\n\n\u8fd9\u9053\u9898\u6211\u4eec\u53ef\u4ee5\u975e\u5e38\u8f7b\u677e\u5730\u60f3\u51faDP\uff1a\n\n\u8bbe$f(i,j)$\u8868\u793a\uff1a\u524d$i$\u4e2a\u7403\u4e2d\uff0c\u88ab\u5206\u6210$j$\u7ec4\u7684\u65b9\u6848\u6570\u3002\u660e\u663e\uff0c\u6709\u9012\u63a8\u5f0f$f(i,j)=f(i-1,j)+f(i-1,j-1)+f(i-2,j-1)$\u3002\n\n\u5982\u679c\u6211\u4eec\u628a\u5b83\u5199\u6210\u591a\u9879\u5f0f\u5f62\u5f0f\uff0c\u5373$f_i(j)=f_{i-1}(j)+f_{i-1}(j-1)+f_{i-2}(j-1)$\uff0c\u5219\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u7531$f_{x-1},f_x$\u5728$O(k)$\u5185\u63a8\u51fa$f_{x+1}$\u3002\u6211\u4eec\u4ee4\u4e00\u4e2a\u8fd0\u7b97$f_x\\rightarrow f_{x+1}$\u8868\u793a\u8fd9\u79cd\u64cd\u4f5c\uff08\u9ed8\u8ba4$f_{x-1}$\u5df2\u7ecf\u6c42\u51fa\uff09\u3002\u5728\u4ee3\u7801\u4e2d\u4e3a$\\operatorname{forward}$\u51fd\u6570\u3002\n\n\u6211\u4eec\u8fd8\u53ef\u4ee5\u8003\u8651\u7531\u4e24\u6bb5\u62fc\u63a5\u800c\u6210$f_a,f_b$\u63a8\u51fa$f_{a+b}$\u3002\n\n1.\u76f4\u63a5\u62fc\u63a5\uff0c\u539f\u672c\u4e24\u6bb5\u4e2d\u8be5\u600e\u4e48\u62fc\u7684\u8fd8\u600e\u4e48\u62fc\u3002\n\n\u6211\u4eec\u6709$f_{a+b}(i)=\\sum\\limits_{j+k=i}f_a(j)*f_b(k)$\uff0c\u5373\u679a\u4e3e$f_a$\u4e2d\u8d21\u732e\u591a\u5c11\u6bb5\u3002\u8fd9\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5c31\u662f\u8bf4\uff0c$f_{a+b}=f_a*f_b$\uff01\n\n\u8fd8\u6ca1\u5b8c\u3002\n\n2.\u5c06\u4e24\u6bb5\u7d27\u8d34\u7684\u4f4d\u7f6e\uff0c\u5373$(a,a+1)$\u4e24\u4e2a\u7403\u5355\u72ec\u62bd\u51fa\u6765\u62fc\u4e00\u7ec4\u3002\u5219\u6709\n\n$f_{a+b}(i)=\\sum\\limits_{j+k=i-1}f_{a-1}(j)*f_{b-1}(k)$\n\n\u4ee4\u4e00\u4e2a$g(i)=f_{a-1}*f_{b-1}$\uff0c\u5219$f_{a+b}(i)=g(i-1)$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u7531$f_a,f_b$\u5728$O(k\\log k)$\u5185\u62fc\u51fa$f_{a+b}$\uff08\u9ed8\u8ba4$f_{a-1},f_{b-1}$\u5df2\u7ecf\u6c42\u51fa\uff09\u3002\u6211\u4eec\u4ee4\u4e00\u4e2a\u8fd0\u7b97$f_a\\oplus f_b$\u8868\u793a\u8fd9\u79cd\u64cd\u4f5c\u3002\u5728\u4ee3\u7801\u4e2d\u4e3a$\\operatorname{combine}$\u51fd\u6570\u3002\n\n\u5219\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u500d\u589e\u7684\u5f62\u5f0f\u8fdb\u884cDP\u3002\n\n\u6211\u4eec\u6709\n\n$f_{2x}=f_x\\oplus f_x$\n\n$f_{2x-1}=f_x\\oplus f_{x-1}$\n\n$f_{2x-2}=f_{x-1}\\oplus f_{x-1}$\u3002\n\n\u5219\u6211\u4eec\u53ea\u9700\u8981\u4fdd\u7559$f_x,f_{x-1},f_{x-2}$\uff0c\u5c31\u53ef\u4ee5\u63a8\u51fa$f_{2x},f_{2x-1},f_{2x-2}$\u3002\n\n\u8003\u8651\u4ece\u9ad8\u4f4d\u5411\u4f4e\u4f4d\u5904\u7406\u3002\u6211\u4eec\u521d\u59cb\u76f4\u63a5\u624b\u52a8\u7b97\u51fa$f_0,f_1,f_2$\u7684\u503c\u3002\n\n\u8bbe\u6211\u4eec\u73b0\u5728\u62e5\u6709$f_x,f_{x-1},f_{x-2}$\u3002\n\n\u9996\u5148\uff0c\u65e0\u8bba\u5982\u4f55\uff0c\u5148\u641e\u51fa$f_{2x},f_{2x-1},f_{2x-2}$\u6765\u3002\n\n\u7136\u540e\uff0c\u5982\u679c$n$\u5f53\u524d\u4f4d\u4e0a\u4e3a$1$\uff0c\u4eff\u7167\u5feb\u901f\u5e42\u7684\u5f62\u5f0f\uff0c\u76f4\u63a5\u7531$f_{2x-2},f_{2x-1},f_{2x}\\rightarrow f_{2x-1},f_{2x},f_{2x+1}$\u3002\n\n\u5219\u6700\u7ec8\u7b54\u6848\u4e3a$f_n$\u3002\n\n\u7ec6\u8282\u8f83\u591a\uff0c\u8be6\u60c5\u53ef\u4ee5\u89c1\u4ee3\u7801\u3002\u4f46\u662f\u7801\u91cf\u4e0d\u5927\uff0c$70$\u884c\u4e0d\u5230\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=998244353;\nconst int G=3;\nint n,m,lim=1,invlim,lg,rev[1<<16],f[3][1<<16],g[3][1<<16],a[1<<16],b[1<<16],cnt;\nint ksm(int x,int y){\n\tint rt=1;\n\tfor(;y;x=(1ll*x*x)%mod,y>>=1)if(y&1)rt=(1ll*rt*x)%mod;\n\treturn rt;\n}\nvoid NTT(int *a,int tp){\n\tfor(int i=0;i<lim;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\tfor(int md=1;md<lim;md<<=1){\n\t\tint rt=ksm(G,(mod-1)/(md<<1));\n\t\tif(tp==-1)rt=ksm(rt,mod-2);\n\t\tfor(int stp=md<<1,pos=0;pos<lim;pos+=stp){\n\t\t\tint w=1;\n\t\t\tfor(int i=0;i<md;i++,w=(1ll*w*rt)%mod){\n\t\t\t\tint x=a[pos+i],y=(1ll*w*a[pos+md+i])%mod;\n\t\t\t\ta[pos+i]=(x+y)%mod;\n\t\t\t\ta[pos+md+i]=(x-y+mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(tp==-1)for(int i=0;i<lim;i++)a[i]=(1ll*a[i]*invlim)%mod;\n}\nvoid mul(int *u,int *v,int *w){\n\tfor(int i=0;i<lim;i++)a[i]=b[i]=0;\n\tfor(int i=0;i<=m;i++)a[i]=u[i],b[i]=v[i];\n\tNTT(a,1),NTT(b,1);\n\tfor(int i=0;i<lim;i++)a[i]=(1ll*a[i]*b[i])%mod;\n\tNTT(a,-1);\n\tfor(int i=0;i<=m;i++)w[i]=(a[i]+w[i])%mod;\n}\nvoid combine(int x,int y,int z){\n\tfor(int i=0;i<=m;i++)g[z][i]=0;\n\tmul(f[x],f[y],g[z]);\n\tmul(f[x-1],f[y-1],g[z]+1);\n\tg[z][m+1]=0;\n}\nvoid forward(int *x,int *y,int *z){\n\tz[0]=y[0];\n\tfor(int i=1;i<=m;i++)z[i]=(0ll+x[i-1]+y[i-1]+y[i])%mod;\n}\nvoid work(){\n\tif(n==1){f[2][0]=f[2][1]=1;return;}\n\tf[0][0]=f[1][0]=f[1][1]=f[2][0]=f[2][2]=1,f[2][1]=3;\n\tint bd=30;\n\twhile(!(n&(1<<bd)))bd--;\n\tfor(int i=bd-1;i>=0;i--){\n\t\tif(n&(1<<i)){\n\t\t\tforward(f[1],f[2],f[0]);\n\t\t\tfor(int j=0,tt;j<=m;j++)tt=f[0][j],f[0][j]=f[1][j],f[1][j]=f[2][j],f[2][j]=tt;\n\t\t}\n\t\tif(i){\n\t\t\tcombine(2,2,2),combine(2,1,1),combine(1,1,0);\n\t\t\tfor(int j=0;j<=m;j++)f[0][j]=g[0][j],f[1][j]=g[1][j],f[2][j]=g[2][j];\n\t\t}\n\t}\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\twhile(lim<=2*m)lim<<=1,lg++;\n\tinvlim=ksm(lim,mod-2);\n\tfor(int i=0;i<lim;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\twork();\n\tfor(int i=1;i<=m;i++)printf(\"%d \",f[2][i]);puts(\"\");\n\treturn 0;\n}\n```\n",
        "postTime": 1582086231,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "[\u6d1b\u8c37\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF755G)\n\n[CF\u4f20\u9001\u95e8](http://codeforces.com/problemset/problem/755/G)\n\n\u6765\u4e00\u6ce2\u9012\u63a8\u65b9\u7a0b+\u751f\u6210\u51fd\u6570\u7684\u9898\u89e3\n\n---\n\n**\u3010\u5206\u6790\u3011**\n---\n\n\u8bbe $f_{n,k}$ \u8868\u793a $n$ \u4e2a\u5c0f\u7403\u4e2d\uff0c\u9009\u51fa $k$ \u7ec4\u7684\u65b9\u6848\u6570\n\n\u975e\u5e38\u663e\u7136\u7684\u53ef\u4ee5\u5217\u51fa\u9012\u63a8\u65b9\u7a0b\uff0c\u9009\u53d6\u5c0f\u7403\u53ea\u6709\u5982\u4e0b\u4e09\u79cd\u60c5\u51b5\uff1a\n\n1. \u4e0d\u9009\u7b2c\u4e00\u4e2a\u5c0f\u7403\uff0c\u5219\u65b9\u6848\u6570\u4e3a $f_{n-1,k}$\n2. \u4ec5\u9009\u7b2c\u4e00\u4e2a\u5c0f\u7403\uff0c\u5219\u65b9\u6848\u6570\u4e3a $f_{n-1,k-1}$\n3. \u9009\u62e9\u7b2c\u4e00\u4e2a\u3001\u7b2c\u4e8c\u4e2a\u5c0f\u7403\uff0c\u5219\u65b9\u6848\u6570\u4e3a $f_{n-2,k-1}$\n\n\u56e0\u6b64 $f_{n,k}=f_{n-1,k}+f_{n-1,k-1}+f_{n-2,k-1}$\n\n\u5bf9\u4e8e\u8be5\u4e8c\u7ef4\u9012\u63a8\u5f0f\uff0c\u663e\u7136\u6211\u4eec\u9700\u8981\u6c42\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u5176\u7b2c $k$ \u9879\u8868\u793a $n$ \u4e2a\u5c0f\u7403\u9009\u51fa $k$ \u7ec4\u7684\u65b9\u6848\u6570\n\n\u6240\u4ee5\u6211\u4eec\u4ee4\u591a\u9879\u5f0f $F_n(x)$ \u6ee1\u8db3 $F_n[k]=f_{n,k}$\n\n\u6839\u636e\u4e0a\u9762\u9012\u63a8\u5f0f\uff0c\u5f88\u5bb9\u6613\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$F_n(x)=F_{n-1}(x)+xF_{n-1}(x)+xF_{n-2}(x)=(1+x)F_{n-1}(x)+xF_{n-2}(x)$\n\n$F_0(x)=1+0\\cdot x+0\\cdot x^2+\\cdots =1$\n\n$F_1(x)=1+1\\cdot x+0\\cdot x^2+\\cdots =1+x$\n\n---\n\n\u5c06\u8be5\u9012\u63a8\u5f0f\u6574\u7406\u5f97\u5230\uff1a\n\n$\\begin{cases}\nF_n-(1+x)F_{n-1}-xF_{n-2}=0\n\\\\F_0=1,F_1=1+x\n\\end{cases}$\n\n\u4e3a\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u65b9\u7a0b\uff0c\u7279\u5f81\u65b9\u7a0b\u4e3a\uff1a\n\n$f^2-(1+x)f-x=0$\n\n\u89e3\u5f97 $\\displaystyle f={(1+x)\\pm\\sqrt{(1+x)^2+4x}\\over 2}$\n\n\u8bb0 $g(x)=\\sqrt{(1+x)^2+4x}=\\sqrt{1+6x+x^2}$\n\n\u5373 $\\displaystyle f_1={1+x+g(x)\\over 2},f_2={1+x-g(x)\\over 2}$\n\n\u56e0\u6b64\u9012\u63a8\u65b9\u7a0b\u901a\u89e3\u4e3a $F_n=c_1f_1^n+c_2f_2^n$\n\n\u4ee3\u5165\u521d\u59cb\u6761\u4ef6\u5f97\u5230\uff1a\n\n$\\begin{cases}\n1=F_0=c_1+c_2\n\\\\1+x=F_1=c_1f_1+c_2f_2\n\\end{cases}$\n\n\u89e3\u5f97 $\\displaystyle c_1={1\\over 2}(1+{1+x\\over g(x)}),c_2={1\\over 2}(1-{1+x\\over g(x)})$\n\n\u4ee3\u56de $F_n$ \u901a\u89e3\u5f0f\uff0c\u5316\u7b80\u53ef\u5f97\uff1a\n\n$\\displaystyle F_n={f_1^{n+1}(x)+f_2^{n+1}(x)\\over g(x)}$\n\n\u6c42\u89e3 $g(x)$ \u7528\u591a\u9879\u5f0f\u5f00\u65b9\uff0c\u518d\u5957\u4e0a\u591a\u9879\u5f0f\u53d6\u9006\u548c\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u5373\u53ef\u6c42\u89e3\u3002\n\n\u590d\u6742\u5ea6\u4e3a $O(n\\log^2 n)$\n\n---\n\n**\u3010\u4ee3\u7801\u3011**\n--\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int M=1<<17<<1;\nint a[M],b[M];\n\nstruct NTT{\n    static const int G=3,P=998244353;\n    int N,na,nb,w[2][M],rev[M];\n\n    inline int add(int a,int b) { return (a+b>=P)?(a+b-P):(a+b); }\n    inline int dis(int a,int b) { return (a-b<0)?(a-b+P):(a-b); }\n    ll kpow(ll a,int b){\n        ll c=1;\n        for(;b;b>>=1,a=a*a%P) if(b&1) c=c*a%P;\n        return c;\n    }\n    //\u6a21\u610f\u4e49\u4e0b\u7684\u52a0\u3001\u51cf\u3001\u5feb\u901f\u5e42\n    void FFT(int *a,int f){\n        for(int i=0;i<N;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n        for(int i=1;i<N;i<<=1)\n            for(int j=0,t=N/(i<<1);j<N;j+=i<<1)\n                for(int k=0,l=0,x,y;k<i;k++,l+=t)\n                    x=(ll)w[f][l]*a[j+k+i]%P,y=a[j+k],a[j+k]=add(y,x),a[j+k+i]=dis(y,x);\n        if(f) for(int i=0,x=kpow(N,P-2);i<N;i++) a[i]=(ll)a[i]*x%P;\n    }\n    void work(){//FFT\u7684\u9884\u5904\u7406\n        int d=__builtin_ctz(N);\n        w[0][0]=w[1][0]=1;\n        for(int i=1,x=kpow(G,(P-1)/N),y=kpow(x,P-2);i<N;i++){\n            rev[i]=(rev[i>>1]>>1)|((i&1)<<d-1);\n            w[0][i]=(ll)x*w[0][i-1]%P,w[1][i]=(ll)y*w[1][i-1]%P;\n        }\n    }\n    void doit(int *f,int *g,int nf,int ng){//\u591a\u9879\u5f0f\u4e58\u6cd5\n        for(N=1;N<nf+ng-1;N<<=1);\n        for(int i=nf;i<N;i++) f[i]=0;\n        for(int i=ng;i<N;i++) g[i]=0;\n        work(); FFT(f,0); FFT(g,0);\n        for(int i=0;i<N;i++) f[i]=(ll)f[i]*g[i]%P;\n        FFT(f,1);\n    }\n    void get_inv(int *f,int *g,int n){//\u591a\u9879\u5f0f\u53d6\u9006\uff0cg=f^-1 mod x^n\n        for(int i=0;i<n;i++) g[i]=0;\n        g[0]=kpow(f[0],P-2);\n        int l;\n        for(l=1;l<n;l<<=1){\n            for(int i=0;i<(l<<1);i++) a[i]=f[i];\n            for(N=1;N<l*3;N<<=1);\n            for(int i=(l<<1);i<N;i++) a[i]=g[i]=0;\n            work(); FFT(a,0); FFT(g,0);\n            for(int i=0;i<N;i++) g[i]=(ll)g[i]*dis(2,(ll)a[i]*g[i]%P)%P;\n            FFT(g,1);\n            for(int i=(l<<1);i<N;i++) g[i]=0;\n        }\n        for(int i=n;i<l;i++) g[i]=0;\n    }\n    void get_sqrt(int *f,int *g,int n){//\u591a\u9879\u5f0f\u5f00\u65b9\uff0cg=sqrt(f) mod x^n\n        g[0]=1;\n        int l;\n        for(l=1;l<n;l<<=1){\n            get_inv(g,b,l<<1);\n            for(int i=0;i<(l<<1);i++) a[i]=f[i];\n            for(N=1;N<(l<<2);N<<=1);\n            for(int i=(l<<1);i<N;i++) a[i]=b[i]=0;\n            work(); FFT(a,0); FFT(b,0);\n            for(int i=0;i<N;i++) a[i]=(ll)a[i]*b[i]%P;\n            FFT(a,1);\n            for(int i=0;i<(l<<1);i++) g[i]=add(g[i],a[i])*(P+1ll>>1)%P;\n        }\n        for(int i=n;i<l;i++) g[i]=0;\n    }\n    void get_pow(int *f,int *g,int k,int n){//\u591a\u9879\u5f0f\u5feb\u901f\u5e42\uff0cg=f^k mod x^n\n        for(int i=0;i<n;i++) a[i]=f[i],g[i]=0;\n        g[0]=1;\n        for(;k;k>>=1){\n            if(k&1){\n                for(int i=0;i<n;i++) b[i]=a[i];\n                doit(g,b,n,n);\n                for(int i=n;i<N;i++) g[i]=0;\n            }\n            for(int i=0;i<n;i++) b[i]=a[i];\n            doit(a,b,n,n);\n            for(int i=n;i<N;i++) a[i]=0;\n        }\n    }\n}ntt;\nint f1[M],f2[M],g[M],n,k,F[M];\ninline void work(){\n    F[0]=F[2]=1; F[1]=6;\n    ++k;\n    ntt.get_sqrt(F,g,k);\n    for(int i=0;i<k;i++)\n        F[i]=0,\n        f1[i]=ntt.add(i<=1,g[i])*(ntt.P+1ll>>1)%ntt.P,\n        f2[i]=ntt.dis(i<=1,g[i])*(ntt.P+1ll>>1)%ntt.P;\n    ntt.get_pow(f1,F,n+1,k);\n    for(int i=0;i<k;i++) f1[i]=F[i],F[i]=0;\n    ntt.get_pow(f2,F,n+1,k);\n    for(int i=0;i<k;i++) f2[i]=F[i],F[i]=0;\n    ntt.get_inv(g,F,k);\n    for(int i=0;i<k;i++) g[i]=F[i],F[i]=ntt.dis(f1[i],f2[i]);\n}\nint main(){\n    ios::sync_with_stdio(0);\n    cin.tie(0); cout.tie(0);\n    cin>>n>>k;\n    work();\n    ntt.doit(F,g,k,k);\n    for(int i=1;i<k;i++) cout<<F[i]<<\" \";\n    cout.flush();\n    return 0;\n}\n```",
        "postTime": 1612508916,
        "uid": 36031,
        "name": "JustinRochester",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "\u4ece\u795e Karry \u7684\u9898\u5355\u8fc7\u6765\u7684\uff0c\u7136\u540e\u81ea\u5df1\u778e yy \u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u770b\u9898\u89e3\u533a\u91cc\u6ca1\u6709\uff0c\u4fbf\u6765\u5199\u4e00\u4e2a\u9898\u89e3   \n\n#### \u4e00\u4e2a\u5e38\u6570\u548c\u590d\u6742\u5ea6\u90fd\u5f88\u5927\u7684\u9898\u89e3   \n\n\n----------------------------------------------------\n\n\u4ee4 $dp_{i,j}$ \u4e3a \u5728 $i$ \u4e2a\u7403\u4e2d\u9009 $j$ \u7ec4\u7684\u65b9\u6848\u6570\uff0c\u5219\u663e\u7136\u6709\u8f6c\u79fb $dp_{i,j}=dp_{i-1,j}+dp_{i-1,j-1}+dp_{i-2,j-1}$   \n   \n\u7136\u540e\u8003\u8651\u5bf9\u5176\u4f18\u5316\uff1a   \n\u4ee4 $f_i$ \u4e3a $dp_i$ \u7684\u751f\u6210\u51fd\u6570\uff0c\u5219 $f_i$ \u53ea\u4e0e $f_{i-1}$ \u548c $f_{i-2}$ \u6709\u5173\uff0c\u4e14\u5173\u7cfb\u4e3a $f_i=f_{i-2}\\cdot x + f_{i-1}\\cdot (x+1)$ .   \n\u7136\u540e\u8003\u8651\u5bf9\u4e0a\u5f0f\u8fdb\u884c\u77e9\u9635\u52a0\u901f\u9012\u63a8\uff0c\u590d\u6742\u5ea6 $O(k \\log k \\log n)$\uff0c\u518d\u52a0\u4e00\u4e2a\u5de8\u5927\u7684\u5e38\u6570\uff0c\u4f46\u6b64\u9898 $k$ \u7684\u8303\u56f4\u5f88\u5c0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002   \n   \n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define pb push_back\n#define mp make_pair\n#define Fast_IO ios::sync_with_stdio(false);\n#define fir first\n#define sec second\n#define mod 998244353\n#define ll long long\ninline int read()\n{\n\tchar ch=getchar(); int nega=1; while(!isdigit(ch)) {if(ch=='-') nega=-1; ch=getchar();}\n\tint ans=0; while(isdigit(ch)) {ans=ans*10+ch-48;ch=getchar();}\n\tif(nega==-1) return -ans;\n\treturn ans;\n}\ntypedef pair<int,int> pii;\nint add(int x,int y){return x+y>=mod?x+y-mod:x+y;}\nint sub(int x,int y){return x-y<0?x-y+mod:x-y;}\nint mul(int x,int y){return 1LL*x*y%mod;}\nint qpow(int x,int y)\n{\n\tint ans=1;\n\twhile(y)\n\t{\n\t\tif(y&1) ans=mul(ans,x);\n\t\tx=mul(x,x);\n\t\ty>>=1;\n\t}\n\treturn ans;\n}\nint getInv(int x)\n{\n\treturn qpow(x,mod-2);\n}\n// \u7565\u53bb\u591a\u9879\u5f0f\u7684\u677f\u5b50\uff0c\u4ee5\u4e0b vector \u5373\u662f\u5b58\u50a8\u591a\u9879\u5f0f\u7684\u5bb9\u5668\nusing namespace Poly;\nint n,k;\nstruct Mat\n{\n\tvector<int> a[3][3];\n\tvoid clear()\n\t{\n\t\tfor(int i=0;i<3;i++)\n\t\t{\n\t\t\tfor(int j=0;j<3;j++)\n\t\t\t{\n\t\t\t\ta[i][j].resize(1);\n\t\t\t\ta[i][j][0]=0;\n\t\t\t}\n\t\t}\n\t}\n};\nMat mul(Mat x,Mat y)\n{\n\tMat ans; ans.clear();\n\tfor(int i=1;i<=2;i++)\n\t{\n\t\tfor(int j=1;j<=2;j++)\n\t\t{\n\t\t\tfor(int k=1;k<=2;k++)\n\t\t\t{\n\t\t\t\tans.a[i][j]=ans.a[i][j]+x.a[i][k]*y.a[k][j];\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=2;i++)\n\t{\n\t\tfor(int j=1;j<=2;j++)\n\t\t{\n\t\t\tif((int)ans.a[i][j].size()>k+1) ans.a[i][j].resize(k+1);\n\t\t}\n\t}\n\treturn ans;\n}\nMat qpow(Mat x,int y)\n{\n\tMat ans; ans.clear();\n\tans.a[1][1]=one,ans.a[2][2]=one;\n\twhile(y)\n\t{\n\t\tif(y&1)\n\t\t{\n\t\t\tans=mul(ans,x);\n\t\t}\n\t\tx=mul(x,x);\n\t\ty>>=1;\n\t}\n\treturn ans;\n}\nsigned main()\n{\n\tInit_Inv();\n\tcin>>n>>k;\n\tMat a; a.clear();\n\ta.a[1][2].resize(2); a.a[1][2][1]=1;\n\ta.a[2][1]=one;\n\ta.a[2][2].resize(2); a.a[2][2][1]=a.a[2][2][0]=1;\n\ta=qpow(a,n-1);\n\tMat R; R.clear();\n\tR.a[1][1]=one;\n\tR.a[1][2].resize(2); R.a[1][2][0]=1,R.a[1][2][1]=1;\n\tR=mul(R,a);\n\tvector<int> ans=R.a[1][2];\n\tans.resize(k+1);\n\tfor(int i=1;i<=k;i++) printf(\"%d \",ans[i]); cout<<\"\\n\";\n\treturn 0;\n}\n\n\n```",
        "postTime": 1582866535,
        "uid": 70780,
        "name": "wasa855",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    },
    {
        "content": "# Idea\n\u7531\u4e8e$n$\u5f88\u5927,\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u500d\u589eDP.\n\u8bbe$dp(x)[i]$\u8868\u793a\u4ece$x$\u4e2a\u7403\u4e2d\u53d6\u51fa$i$\u4e2a\u7ec4\u7684\u65b9\u6848\u6570,$dp(x)$\u4e3a\u4e00\u4e2a\u591a\u9879\u5f0f,\u90a3\u4e48\u663e\u7136\n$dp(2x)[i]=\\sum_{j=0}^idp(x)[j]*dp(x)[i-j]+\\sum_{j=0}^{i-1}dp(x-1)[j]*dp(x-1)[i-j-1]$\n$dp(2x-1)[i]=\\sum_{j=0}^idp(x)[j]*dp(x-1)[i-j]+\\sum_{j=0}^{i-1}dp(x-1)[j]*dp(x-2)[i-j-1]$\n$dp(2x-2)[i]=\\sum_{j=0}^idp(x-1)[j]*dp(x-1)[i-j]+\\sum_{j=0}^{i-1}dp(x-2)[j]*dp(x-2)[i-j-1]$\n\u8fd9\u6837\u5c31\u53ef\u4ee5$dp(a),dp(a-1),dp(a-2),dp(b),dp(b-1),dp(b-2)\\Rightarrow dp(a+b),dp(a+b-1),dp(a+b-2)$.\u5b9e\u73b0dp\u6570\u7ec4\u7684\u62fc\u63a5.",
        "postTime": 1524035357,
        "uid": 20952,
        "name": "Simphoni",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF755G \u3010PolandBall and Many Other Balls\u3011"
    }
]