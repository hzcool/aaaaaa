[
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217\uff0c\u9700\u8981\u6c42\u51fa\u5e8f\u5217\u4e2d\u6bcf\u4e2a\u5143\u7d20\u7684\u5947\u602a\u503c\u3002$a_i$ \u7684\u5947\u602a\u503c\u5b9a\u4e49\u4e3a\u9009\u53d6\u4efb\u610f\u4e00\u4e2a\u533a\u95f4\uff0c\u5c06\u533a\u95f4\u91cc\u7684\u6570\u5347\u5e8f\u6392\u5e8f\u540e $a_i$ \u7684\u65b0\u4f4d\u7f6e\u548c\u8be5\u533a\u95f4\u4e2d\u4f4d\u6570\u4e0b\u6807\u8ddd\u79bb\u7684\u6700\u5927\u503c\u3002(\u82e5\u533a\u95f4\u957f\u5ea6\u4e3a\u5076\u6570\uff0c\u4e2d\u4f4d\u6570\u7684\u4e0b\u6807\u4e3a $\\frac{l+r+1}{2}$ )\u3002\n\n\u9996\u5148\u8003\u8651\u5982\u679c\u533a\u95f4\u5df2\u7ecf\u786e\u5b9a\uff0c\u4e14\u5df2\u7ecf\u5347\u5e8f\u6392\u5e8f\u540e\u5982\u4f55\u6c42\u8ddd\u79bb\u3002\n\n\u4ee4 $a_{mid}$ \u8868\u793a\u4e2d\u4f4d\u6570\uff0c $a_x$ \u8868\u793a\u6392\u5e8f\u540e\u7684\u65b0\u4e0b\u6807\uff0c$a_l,a_m,a_r$ \u8868\u793a  $\\le a_x,=a_x,>a_x$ \u7684\u6570\u7684\u4e2a\u6570\u3002\u4e0b\u56fe\u662f $a_x > a_{mid}$ \u7684\u60c5\u51b5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/jkdebim9.png)\n\n\u663e\u7136 $dis=\\frac{a_l+a_m+a_r}{2}-a_r=\\lfloor\\frac{a_l+a_m-a_r}{2}\\rfloor$ .\n\n\u540c\u7406\u82e5 $a_x<a_{mid}$ \uff0c\u5219\u6709 $dis=\\lfloor \\frac{a_r+a_m-a_l+1}{2} \\rfloor$ .\n\n\u4e5f\u5c31\u662f\u8bf4\u53ea\u8981\u77e5\u9053 $a_l,a_m,a_r$ \uff0c\u65e0\u9700\u6392\u5e8f\u4e5f\u80fd\u786e\u5b9a\u8ddd\u79bb\u3002\u63a5\u4e0b\u6765\u5c31\u662f\u4e2d\u4f4d\u6570\u7684\u8001\u5957\u8def\u4e86\uff1a\n\n\u65b0\u5f00\u4e00\u4e2a\u6570\u7ec4 $b$ ,\u5c06 $\\le a_x$ \u7684\u6570\u7684\u4f4d\u7f6e\u8d4b\u503c\u4e3a$1$ \uff0c$>a_x$ \u7684\u6570\u7684\u4f4d\u7f6e\u8d4b\u503c\u4e3a $-1$ \u3002\u90a3\u4e48 $\\sum^{r} _ {i=l} b_i-1=(a_l+a_m)\\times 1 + (a_r)\\times (-1)=dis\\times2 $ \uff0c\u524d\u9762\u51cf$1$\u662f\u8981\u9664\u53bb $a_x$ \u672c\u8eab\u3002\u5373 $dis=\\frac{\\sum^{r} _ {i=l} b_i-1}{2}$ \u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u6c42 $\\sum^{r} _ {i=l} b_i$ \uff0c\u62c6\u6210\u4e24\u4efd\u4e5f\u5c31\u662f  $\\sum_{i=l}^{x}b_i+\\sum_{i=x}^{r}b_i-1$ \uff0c\u7136\u540e\u53d1\u73b0 $\\sum_{i=l}^{x}b_i$  \u5c31\u662f\u7ef4\u62a4\u6574\u4e2a $1\\sim x$ \u7684\u6700\u5927\u540e\u7f00\uff0c$\\sum_{i=x}^{r}b_i$ \u5c31\u662f\u7ef4\u62a4\u6574\u4e2a    $x\\sim n$ \u7684\u6700\u5927\u524d\u7f00\u3002\n\n\u6240\u4ee5\u53ea\u7528\u5957\u533a\u95f4\u5408\u5e76\u7ebf\u6bb5\u6811\u7684\u6a21\u677f\u5c31\u597d\u3002\n\n\u53e6\u5916\uff0c\u5bf9\u4e8e\u53e6\u4e00\u79cd $a_x<a_{mid}$ \u7684\u60c5\u51b5\u8fd8\u6709\u4e00\u79cd\u53d6\u5de7\u7684\u65b9\u6cd5\uff1a\u53ea\u7528\u628a $a$ \u6570\u7ec4\u6574\u4e2a\u7ffb\u8f6c\u518d\u628a\u6bcf\u4e2a\u5143\u7d20\u53d8\u4e3a\u76f8\u53cd\u6570\u5c31\u53d8\u6210 $a_x<a_{mid}$ \u7684\u60c5\u51b5\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define fre(x) freopen(#x\".in\",\"r\",stdin);freopen(#x\".out\",\"w\",stdout)\n#define int long long\n#define re register int\n#define inf 0x7fffffffffffffff\n#define Pair pair<int,int>\ninline int read()\n{\n    int x=0,f=1;char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();}\n    while(isdigit(ch)){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n    return f==1?x:-x;\n}\nconst int N=2e5+10;\nstruct Seg{\n    int l,r,lm,rm,sum;\n    #define l(x) tree[x].l\n    #define r(x) tree[x].r\n    #define lm(x) tree[x].lm\n    #define rm(x) tree[x].rm\n    #define sum(x) tree[x].sum\n}tree[N<<2];\ninline void pushup(int p)\n{\n    sum(p)=sum(p<<1)+sum(p<<1|1);\n    lm(p)=max(lm(p<<1),sum(p<<1)+lm(p<<1|1));\n    rm(p)=max(rm(p<<1|1),sum(p<<1|1)+rm(p<<1));\n}\nvoid build(int p,int l,int r)\n{\n    l(p)=l;r(p)=r;\n    if(l==r)return sum(p)=lm(p)=rm(p)=-1,void();\n    int mid=(l+r)>>1;\n    build(p<<1,l,mid);\n    build(p<<1|1,mid+1,r);\n    pushup(p);\n}\nvoid change(int p,int pos,int x)\n{\n    if(l(p)==r(p))return sum(p)=lm(p)=rm(p)=x,void();\n    int mid=(l(p)+r(p))>>1;\n    if(pos<=mid)change(p<<1,pos,x);\n    else change(p<<1|1,pos,x);\n    pushup(p);\n}\nSeg query(int p,int l,int r)\n{\n    if(r(p)<l || r<l(p))return {0,0,0,0,0};\n    if(l<=l(p) && r>=r(p))return tree[p];\n    Seg a=query(p<<1,l,r),b=query(p<<1|1,l,r);\n    return {min(a.l,b.l),max(a.r,b.r),max(a.lm,a.sum+b.lm),max(b.rm,b.sum+a.rm),a.sum+b.sum};\n}\nint n,ans[N];\nstruct node{int x,id;}a[N];\nbool cmp(node a,node b){return a.x<b.x;}\nvoid calc(int flag)\n{\n    build(1,1,n);\n    for(re i=1;i<=n;++i)\n    {\n        int j=i;\n        while(j<n && a[j+1].x==a[i].x)++j;\n        for(re k=i;k<=j;++k) change(1,a[k].id,1);\n        for(re k=i;k<=j;++k)\n        {\n            Seg p=query(1,1,a[k].id),q=query(1,a[k].id,n);\n            ans[a[k].id]=max(ans[a[k].id],p.rm+q.lm-1-!flag);\n        }\n        i=j;\n    }\n}\nsigned main()\n{\n    n=read();\n    for(re i=1;i<=n;++i)\n        a[i].x=read(),a[i].id=i;\n    sort(a+1,a+n+1,cmp);\n    calc(0);\n    for(re i=1;i<=n/2;++i) swap(a[i],a[n-i+1]);\n    for(re i=1;i<=n;++i) a[i].x=-a[i].x;\n    calc(1);\n    for(re i=1;i<=n;++i) \n        printf(\"%lld \",ans[i]/2);\n    return 0;\n}\n```\n\n\n\n\n",
        "postTime": 1629525168,
        "uid": 158000,
        "name": "\u6ed1\u4e0d\u62c9\u7a3d",
        "ccfLevel": 0,
        "title": "CF1539F Strange Array"
    },
    {
        "content": "### CF1539F Strange Array\u9898\u89e3\n\n\u4e00\u9053\u6bd4\u8f83\u5957\u8def\u7684\u6570\u636e\u7ed3\u6784\u9898\u3002\n\n\u4e0e\u4e2d\u4f4d\u6570\u76f8\u5173\u4e0d\u96be\u60f3\u5230\u9009\u62e9\u4e00\u4e2a\u6570 $x$ \uff0c\u5c06\u5927\u4e8e $x$ \u7684\u6570\u8bbe\u4e3a $1$ \uff0c\u5c0f\u4e8e\u7b49\u4e8e $x$ \u7684\u6570\u8bbe\u4e3a $0$ \u6216 $-1$ \u3002\n\n\u4e3a\u4e86\u7b80\u5316\u95ee\u9898\u7684\u8ba8\u8bba\uff0c\u6211\u4eec\u5728\u4e0b\u8ff0\u5206\u6790\u4e2d\u5047\u8bbe\u6240\u6709\u5143\u7d20\u7684\u503c\u4e92\u4e0d\u76f8\u540c\u3002\n\n\u5bf9\u4e8e\u503c\u4ece\u5c0f\u5230\u5927\u8003\u8651\uff0c\u5f53\u8003\u8651\u5230\u5143\u7d20 $a_i$ \u65f6\u5c06 $\\ge a_i$ \u7684\u6570\u7684\u4f4d\u7f6e\u6807\u4e3a $1$ \uff0c$<a_i$ \u7684\u4f4d\u7f6e\u6807\u4e3a $-1$ \uff0c\u4e3a\u4e86\u4f7f\u5f97 $a_i$ \u79bb\u4e2d\u4f4d\u6570\u7684\u4f4d\u7f6e\u5c3d\u53ef\u80fd\u8fdc\uff0c\u5206\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\u3002\n\n- $a_i$ \u6bd4\u4e2d\u4f4d\u6570\u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u5e0c\u671b $>a_i$ \u7684\u6570 $-$ $\\leq a_i$ \u7684\u6570\u5c3d\u91cf\u591a\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u627e\u51fa\u4e00\u6bb5**\u5305\u542b $i$ \u7684\u6743\u503c\u5c3d\u91cf\u5927\u7684\u533a\u95f4\u3002**\n- \u540c\u7406\uff0c\u4f46$a_i$ \u6bd4\u4e2d\u4f4d\u6570\u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u5e0c\u671b $>a_i$ \u7684\u6570 $-$ $\\leq a_i$ \u7684\u6570\u5c3d\u91cf\u5c11\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u627e\u51fa\u4e00\u6bb5**\u5305\u542b $i$ \u7684\u6743\u503c\u5c3d\u91cf\u5c0f\u7684\u533a\u95f4\u3002**\n\n\u4e0a\u8ff0\u8fc7\u7a0b\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u524d\u7f00\u548c\u5e76\u5728\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u5b9e\u73b0\u3002\n\n\u5bf9\u4e8e $a_i$ \u503c\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u53ea\u662f\u5bf9\u4e8e\u8bbe $1$ \u548c $-1$ \u7684\u7ec6\u8282\u9700\u8981\u6ce8\u610f\uff0c\u8981\u8ba9 $1$ \u5c3d\u91cf\u591a\u65f6\uff0c\u5c06\u76f8\u540c\u7684\u5143\u7d20\u8c01\u4e3a $1$ \uff0c\u5426\u5219\u8c01\u4e3a $-1$ \u3002\n\n\u5982\u679c\u5bf9\u7ec6\u8282\u4e0d\u6e05\u695a\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define FOR(i,a,b) for(int i=a;i<=b;++i)\n#define PII pair<int,int>\n#define ll long long\n#define pb push_back\n#define sz(x) (int)(x.size())\n#define gc getchar()\nusing namespace std;\ninline int gi()\n{\n\tint x=0,f=1;\n\tchar ch=gc;\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=gc;}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+(ch^48);ch=gc;}\n\treturn (f==1)?x:-x;\n}\ninline int max(int a,int b){return a>b?a:b;}\ninline int min(int a,int b){return a<b?a:b;}\nconst int maxn=2e5+5;\nint n,a[maxn];\nvector<int>v[maxn];\nstruct segmentree\n{\n\t#define ls u<<1\n\t#define rs u<<1|1\n\tstatic const int maxn=8e5+105;\n\tint minv[maxn],maxv[maxn],tag[maxn],pos1[maxn],pos2[maxn];///prefix_sum\n\tinline void build(int u,int l,int r)\n\t{\n\t\ttag[u]=0,pos1[u]=0,pos2[u]=0;\n\t\tif(l==r)return pos1[u]=l,pos2[u]=l,maxv[u]=minv[u]=l,void();\n\t\tint mid=(l+r)>>1;\n\t\tbuild(ls,l,mid),build(rs,mid+1,r);\n\t\tpushup(u);\n\t}\n\tinline void pushdown(int u,int l,int r)\n\t{\n\t\tif(tag[u])\n\t\t{\n\t\t\ttag[ls]+=tag[u];tag[rs]+=tag[u];\n\t\t\tmaxv[ls]+=tag[u];maxv[rs]+=tag[u];\n\t\t\tminv[ls]+=tag[u];minv[rs]+=tag[u];\n\t\t\ttag[u]=0;\n\t\t}\n\t}\n\tinline void pushup(int u)\n\t{\n\t\tif(minv[ls]<minv[rs])minv[u]=minv[ls],pos1[u]=pos1[ls];\n\t\telse minv[u]=minv[rs],pos1[u]=pos1[rs];\n\t\tif(maxv[ls]>maxv[rs])maxv[u]=maxv[ls],pos2[u]=pos2[ls];\n\t\telse maxv[u]=maxv[rs],pos2[u]=pos2[rs];\n\t}\n\tinline void update(int u,int l,int r,int x,int y,int v)\n\t{\n\t\tif(x<=l&&y>=r)return maxv[u]+=v,minv[u]+=v,tag[u]+=v,void();\n\t\tint mid=(l+r)>>1;\n\t\tpushdown(u,l,r);\n\t\tif(x<=mid)update(ls,l,mid,x,y,v);\n\t\tif(y>mid)update(rs,mid+1,r,x,y,v);\n\t\tpushup(u);\n\t}\n\tinline pair<int,int> query1(int u,int l,int r,int x,int y)\n\t{\n\t\tif(x<=l&&y>=r)return pair<int,int>(minv[u],pos1[u]);\n\t\tpushdown(u,l,r);\n\t\tint mid=(l+r)>>1;\n\t\tif(y<=mid)return query1(ls,l,mid,x,y);\n\t\tif(x>mid)return query1(rs,mid+1,r,x,y);\n\t\treturn min(query1(ls,l,mid,x,y),query1(rs,mid+1,r,x,y));\n\t}\n\tinline pair<int,int> query2(int u,int l,int r,int x,int y)\n\t{\n\t\tif(x<=l&&y>=r)return pair<int,int>(maxv[u],pos2[u]);\n\t\tpushdown(u,l,r);\n\t\tint mid=(l+r)>>1;\n\t\tif(y<=mid)return query2(ls,l,mid,x,y);\n\t\tif(x>mid)return query2(rs,mid+1,r,x,y);\n\t\treturn max(query2(ls,l,mid,x,y),query2(rs,mid+1,r,x,y));\n\t}\n\t#undef ls\n\t#undef rs\n}tree;\ninline void input()\n{\n\tn=gi();\n\tFOR(i,1,n)a[i]=gi(),v[a[i]].pb(i);\n}\nint ans[maxn],id[maxn];\ninline void solve()\n{\n\tFOR(i,1,n)id[i]=i;\n\tsort(id+1,id+n+1,[](int x,int y){return a[x]<a[y];});\n\ttree.build(1,0,n);\n\tFOR(i,1,n)///-1\n\t{\n\t\tint x=id[i];\n\t\tif(a[id[i]]!=a[id[i-1]])for(int x:v[a[id[i]]])tree.update(1,0,n,x,n,-2);\n\t\ttree.update(1,0,n,x,n,2);\n\t\tauto lp=tree.query2(1,0,n,0,x-1),rp=tree.query1(1,0,n,x,n);\n\t\t//int len=rp.second-lp.second+1;\n\t\tint val=rp.first-lp.first;\n\t\tassert(val<=1);\n\t\tans[x]=max(ans[x],(-val+1)/2);\n\t\ttree.update(1,0,n,x,n,-2);\n\t}\n\ttree.build(1,0,n);\n\tFOR(i,1,n)///1\n\t{\n\t\tint x=id[i];\n\t\tif(a[id[i]]!=a[id[i-1]]&&i!=1)for(int x:v[a[id[i-1]]])tree.update(1,0,n,x,n,-2);\n\t\ttree.update(1,0,n,x,n,-2);\n\t\tauto lp=tree.query1(1,0,n,0,x-1),rp=tree.query2(1,0,n,x,n);\n\t\t//int len=rp.second-lp.second+1;\n\t\tint val=rp.first-lp.first;\n\t\tassert(val>=-1);\n\t\tans[x]=max(ans[x],(val+2)/2);\n\t\ttree.update(1,0,n,x,n,2);\n\t}\n\tFOR(i,1,n)printf(\"%d \",ans[i]);\n\tputs(\"\");\n}\nint main()\n{\n    input();\n    solve();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1624510180,
        "uid": 333789,
        "name": "lory1608",
        "ccfLevel": 9,
        "title": "CF1539F Strange Array\u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1539F)\n\n## \u601d\u8def\n\n\u5e94\u8be5\u7b97\u662f\u6bd4\u8f83\u7b80\u5355\u7684 $\\verb!2600!$\uff0c\u601d\u8def\u5f88\u4e00\u773c\u3002\u4e0d\u8fc7\u4ee3\u7801\u5199\u7684\u5f88\u9634\u95f4\u3002\n\n\u5047\u5982\u6211\u4eec\u5f53\u524d\u679a\u4e3e\u7684\u6570\u662f $a_i$\uff0c\u6211\u4eec\u628a\u5927\u4e8e $a_i$ \u7684\u6570\u89c6\u4e3a $1$\uff0c\u5c0f\u4e8e $a_i$ \u7684\u6570\u89c6\u4e3a $-1$\uff0c\u7b49\u4e8e $a_i$ \u7684\u6570\u53ef\u4ee5\u89c6\u60c5\u51b5\u800c\u5b9a\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u9898\u76ee\u5c31\u662f\u8981\u6c42\u67d0\u4e00\u6bb5\u5305\u542b $a_i$ \u7684\u533a\u95f4 $(l,r)$ \u4f7f\u5f97\u533a\u95f4\u548c\u7684\u7edd\u5bf9\u503c\u6700\u5927\u3002\n\n\u770b\u5230\u7edd\u5bf9\u503c\u6211\u4eec\u5c31\u8981\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n+ \u533a\u95f4 $(l,r)$ \u7684\u548c\u662f\u6b63\u6570\n\n  \u90a3\u4e48\u548c\u8d8a\u5927\u8d8a\u597d\uff0c\u4e8e\u662f\u6211\u4eec\u628a\u7b49\u4e8e $a_i$ \u7684\u6570\u89c6\u4e3a $1$\uff0c\u5f53\u7136\u5b83\u81ea\u5df1\u53ea\u80fd\u662f $0$\uff0c\u7136\u540e\u518d\u4ece $i$ \u5f00\u59cb\u5f80\u5de6\u5f80\u53f3\u5206\u522b\u627e\u4e00\u6bb5\u533a\u95f4\u548c\u6700\u5927\u7684\u8fde\u7eed\u533a\u95f4\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u52a8\u6001\u7ef4\u62a4\u524d\u7f00\u548c\u5b9e\u73b0\u3002\n  \n+ \u533a\u95f4 $(l,r)$ \u7684\u548c\u662f\u8d1f\u6570\n\n  \u540c\u7406\uff0c\u548c\u8d8a\u5c0f\u8d8a\u597d\uff0c\u4e8e\u662f\u6211\u4eec\u628a\u7b49\u4e8e $a_i$ \u7684\u6570\u89c6\u4e3a $-1$\uff0c\u7136\u540e\u4e0e\u4e0a\u9762\u7684\u505a\u6cd5\u76f8\u540c\u3002\n  \n\u8fd9\u6837\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u4e0d\u8fc7\u6709\u5f88\u591a\u5c0f\u7ec6\u8282\uff0c\u8fd8\u9700\u8981\u7ef4\u62a4\u4e24\u9897\u7ebf\u6bb5\u6811\uff08\u4e00\u9897\u6b63\u6570\uff0c\u4e00\u9897\u8d1f\u6570\uff09\uff0c\u6bcf\u4e00\u9897\u7ebf\u6bb5\u6811\u8fd8\u9700\u8981\u7ef4\u62a4\u4e24\u4e2a\u503c\uff08\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u4e00\u4e2a\u540e\u7f00\u548c\uff0c\u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u53ea\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c\uff09\uff0c\u6211\u7684\u5199\u6cd5\u6bd4\u8f83\u65e0\u8111\uff0c\u4f46\u662f\u9700\u8981 $\\rm 3.9k$\uff0c\u4e0d\u8fc7\u6709\u5f88\u591a\u90fd\u662f\u590d\u5236\u7c98\u8d34\u7684\u3002\n\n## \u7801\n\n```cpp\n//A tree without skin will surely die.\n//A man without face will be alive\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define mid ((l+r)>>1)\n#define sqr(x) ((x)*(x))\n#define all(x) (x).begin(),(x).end()\n#define Tim ((double)clock()/CLOCKS_PER_SEC)\n#define lowbit(x) (x&-x)\nint const N=2e5+10;\nint a[N],b[N],ans[N];\nvector<int>c[N];\nstruct Segment_Tree{\n\t#define ls (x<<1)\n\t#define rs (x<<1|1)\n\tint c1[N<<2],c2[N<<2];\n\tint lazy1[N<<2],lazy2[N<<2];\n\tinline void pushdown(int x){\n\t\tc1[ls]+=lazy1[x];\n\t\tc1[rs]+=lazy1[x];\n\t\tlazy1[ls]+=lazy1[x];\n\t\tlazy1[rs]+=lazy1[x];\n\t\tlazy1[x]=0;\n\t\tc2[ls]+=lazy2[x];\n\t\tc2[rs]+=lazy2[x];\n\t\tlazy2[ls]+=lazy2[x];\n\t\tlazy2[rs]+=lazy2[x];\n\t\tlazy2[x]=0;\n\t}\n\tinline void update(int x,int l,int r,int ll,int rr,int v1,int v2){\n\t\tif (ll<=l && r<=rr){\n\t\t\tc1[x]+=v1,c2[x]+=v2;\n\t\t\tlazy1[x]+=v1,lazy2[x]+=v2;\n\t\t\treturn;\n\t\t}\n\t\tpushdown(x);\n\t\tif (ll<=mid) update(ls,l,mid,ll,rr,v1,v2);\n\t\tif (mid<rr) update(rs,mid+1,r,ll,rr,v1,v2);\n\t\tc1[x]=max(c1[ls],c1[rs]);\n\t\tc2[x]=max(c2[ls],c2[rs]);\n\t}\n\tinline pair<int,int> query(int x,int l,int r,int ll,int rr){\n\t\tif (ll<=l && r<=rr) return {c1[x],c2[x]};\n\t\tpushdown(x);\n\t\tint res1=-LLONG_MAX,res2=-LLONG_MAX;\n\t\tif (ll<=mid){\n\t\t\tauto val=query(ls,l,mid,ll,rr);\n\t\t\tres1=max(res1,val.first);\n\t\t\tres2=max(res2,val.second);\n\t\t}\n\t\tif (mid<rr){\n\t\t\tauto val=query(rs,mid+1,r,ll,rr);\n\t\t\tres1=max(res1,val.first);\n\t\t\tres2=max(res2,val.second);\n\t\t}\n\t\treturn {res1,res2};\n\t}\n}T1;\nstruct Sublime_Tree{\n\t#define ls (x<<1)\n\t#define rs (x<<1|1)\n\tint c1[N<<2],c2[N<<2];\n\tint lazy1[N<<2],lazy2[N<<2];\n\tinline void pushdown(int x){\n\t\tc1[ls]+=lazy1[x];\n\t\tc1[rs]+=lazy1[x];\n\t\tlazy1[ls]+=lazy1[x];\n\t\tlazy1[rs]+=lazy1[x];\n\t\tlazy1[x]=0;\n\t\tc2[ls]+=lazy2[x];\n\t\tc2[rs]+=lazy2[x];\n\t\tlazy2[ls]+=lazy2[x];\n\t\tlazy2[rs]+=lazy2[x];\n\t\tlazy2[x]=0;\n\t}\n\tinline void update(int x,int l,int r,int ll,int rr,int v1,int v2){\n\t\tif (ll<=l && r<=rr){\n\t\t\tc1[x]+=v1,c2[x]+=v2;\n\t\t\tlazy1[x]+=v1,lazy2[x]+=v2;\n\t\t\treturn;\n\t\t}\n\t\tpushdown(x);\n\t\tif (ll<=mid) update(ls,l,mid,ll,rr,v1,v2);\n\t\tif (mid<rr) update(rs,mid+1,r,ll,rr,v1,v2);\n\t\tc1[x]=min(c1[ls],c1[rs]);\n\t\tc2[x]=min(c2[ls],c2[rs]);\n\t}\n\tinline pair<int,int> query(int x,int l,int r,int ll,int rr){\n\t\tif (ll<=l && r<=rr) return {c1[x],c2[x]};\n\t\tpushdown(x);\n\t\tint res1=LLONG_MAX,res2=LLONG_MAX;\n\t\tif (ll<=mid){\n\t\t\tauto val=query(ls,l,mid,ll,rr);\n\t\t\tres1=min(res1,val.first);\n\t\t\tres2=min(res2,val.second);\n\t\t}\n\t\tif (mid<rr){\n\t\t\tauto val=query(rs,mid+1,r,ll,rr);\n\t\t\tres1=min(res1,val.first);\n\t\t\tres2=min(res2,val.second);\n\t\t}\n\t\treturn {res1,res2};\n\t}\n}T2;\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0),cout.tie(0);\n\tint n;cin>>n;\n\tfor (int i=1;i<=n;++i) cin>>a[i],b[i]=a[i],c[a[i]].push_back(i);\n\tsort(b+1,b+n+1);int l=unique(b+1,b+n+1)-b-1;\n\tfor (int i=1;i<=n;++i)\n\t\tT1.update(1,1,n,i,n,1,0),T1.update(1,1,n,1,i,0,1);\n\tfor (int i=1;i<=n;++i)\n\t\tT2.update(1,1,n,i,n,1,0),T2.update(1,1,n,1,i,0,1);\n\tfor (int i=1;i<=l;++i){\n\t\tint res=0;\n\t\tfor (auto j:c[b[i]]){\n\t\t\tint maxr=T1.query(1,1,n,j,n).first-T1.query(1,1,n,j,j).first;\n\t\t\tint minl=T1.query(1,1,n,1,j).second-T1.query(1,1,n,j,j).second;\n\t\t\tans[j]=max(ans[j],(abs(maxr+minl)+1)/2);\n\t\t}\n\t\tfor (auto j:c[b[i]])\n\t\t\tT1.update(1,1,n,j,n,-2,0),\n\t\t\tT1.update(1,1,n,1,j,0,-2),\n\t\t\tT2.update(1,1,n,j,n,-2,0),\n\t\t\tT2.update(1,1,n,1,j,0,-2);\n\t\tfor (auto j:c[b[i]]){\n\t\t\tint maxr=T2.query(1,1,n,j,n).first-T2.query(1,1,n,j,j).first;\n\t\t\tint minl=T2.query(1,1,n,1,j).second-T2.query(1,1,n,j,j).second;\n\t\t\tans[j]=max(ans[j],abs(maxr+minl)/2);\n\t\t}\n\t}\n\tfor (int i=1;i<=n;++i) cout<<ans[i]<<' ';\n\tcout<<'\\n';\n\treturn 0;\n}\n```",
        "postTime": 1670299831,
        "uid": 253608,
        "name": "Tx_Lcy",
        "ccfLevel": 7,
        "title": "CF1539F Strange Array"
    },
    {
        "content": "[link](https://www.luogu.com.cn/problem/C1539F)   \n\u53c8\u4e00\u9053\u8ddf\u4e2d\u4f4d\u6570\u6709\u5173\u7684\u9898\u3002   \n\u8001\u5957\u8def\u4f9d\u6b21\u8003\u8651\u6bcf\u4e00\u4f4d\uff0c\u5bf9\u5f53\u524d\u4f4d\u8003\u8651\uff0c\u82e5\u6bd4\u5f53\u524d\u4f4d\u5927\u5219\u5b9a\u4e3a $1$\uff0c\u82e5\u6bd4\u5f53\u524d\u4f4d\u5c0f\u5219\u5b9a\u4e3a $-1$ \u3002   \n\u76ee\u6807\u662f\u4f7f\u8fd9\u4e2a\u6570\u79bb\u533a\u95f4\u5185\u7684\u4e2d\u4f4d\u6570\u6bd4\u8f83\u8fdc\u3002   \n\u53ef\u4ee5\u5206\u60c5\u51b5\u8ba8\u8bba\n- \u5982\u679c $a_i \\ge M_e$\uff0c\u5219\u8981\u8ba9 \u5927\u4e8e $a_i$ \u7684\u6570\u7684\u4e2a\u6570 \u51cf \u5c0f\u4e8e $a_i$ \u7684\u6570\u7684\u4e2a\u6570 \u6700\u5927\u3002\n- \u5982\u679c $a_i \\le M_e$\uff0c\u5219\u8981\u8ba9 \u5c0f\u4e8e $a_i$ \u7684\u6570\u7684\u4e2a\u6570 \u51cf \u5927\u4e8e $a_i$ \u7684\u6570\u7684\u4e2a\u6570 \u6700\u5927\u3002   \n\u56e0\u4e3a\u5df2\u7ecf\u628a\u6743\u503c\u8f6c\u5316\u6210\u4e86 $1/-1$ \u3002\u6240\u4ee5\u4e0a\u9762\u7684\u505a\u5dee\u53ef\u4ee5\u53d8\u6210\u6c42\u548c\u3002   \n\u8fd9\u5c31\u53ef\u4ee5\u505a\u4e86\u3002",
        "postTime": 1666877378,
        "uid": 324362,
        "name": "Iridescent41",
        "ccfLevel": 7,
        "title": "CF1539F"
    },
    {
        "content": "\u5bf9\u4e8e\u7ebf\u6bb5 $[l, r]$ \uff0c\u6309\u7167\u9898\u76ee\u5b9a\u4e49\uff0c\u5176\u4e2d\u5fc3\u5728\u8be5\u7ebf\u6bb5\u4e2d\u7684\u6392\u540d\u4e3a $\\left\\lceil\\dfrac{r - l + 2}{2}\\right\\rceil$ \u3002\n\n\u73b0\u5728\u4ece\u6bcf\u4e00\u4e2a\u5143\u7d20\u4e3a\u51fa\u53d1\u70b9\u8003\u8651\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u9700\u8981\u4e00\u4e2a\u53ef\u4ee5\u5feb\u901f\u83b7\u5f97\u7684\u5de6\u65b9\u6216\u53f3\u65b9\u7684\u4fe1\u606f\u3002\n\n\u9996\u5148\uff0c\u4e00\u4e2a\u4efb\u610f\u5143\u7d20\u7684\u6392\u540d\u81ea\u7136\u8f6c\u5316\u4e3a\u4e00\u4e2a\u533a\u95f4\u5185\u6bd4\u8fd9\u4e2a\u5143\u7d20\u5185\u6bd4\u5b83\u5c0f\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e\u5f53\u524d\u5143\u7d20 $a_i$ \uff0c\u8bbe $l_l$ \u8868\u793a\u5728\u533a\u95f4 $[l, i]$ \u4e2d**\u4e25\u683c**\u5c0f\u4e8e $a_i$ \u7684\u5143\u7d20\u4e2a\u6570\uff0c$l_r$ \u8868\u793a\u5728\u533a\u95f4 $[i, r]$ \u4e2d**\u4e25\u683c**\u5c0f\u4e8e $a_i$ \u7684\u5143\u7d20\u4e2a\u6570\uff0c$L_l$ \u8868\u793a\u5728\u533a\u95f4 $[l, i]$ \u4e2d\u5c0f\u4e8e\u7b49\u4e8e $a_i$ \u7684\u5143\u7d20\u4e2a\u6570\uff0c$L_r$ \u8868\u793a\u5728\u533a\u95f4 $[i + 1, r]$ \u4e2d\u5c0f\u4e8e\u7b49\u4e8e $a_i$ \u7684\u5143\u7d20\u4e2a\u6570\u3002\n\n\u7531\u4e8e\u76f8\u7b49\u7684\u503c\u53ef\u4ee5\u4efb\u610f\u6446\u653e\uff0c\u6240\u4ee5\u7b54\u6848\u5fc5\u5b9a\u662f $\\max\\{L_l + L_r - \\left\\lceil\\dfrac{r - l + 2}{2}\\right\\rceil, \\left\\lceil\\dfrac{r - l + 2}{2}\\right\\rceil -l_l - l_r - 1\\}$ \u3002\n\n\u7531\u4e8e $- \\lceil r\\rceil = \\lfloor -r \\rfloor (r > 0)$ \uff0c\u6240\u4ee5\u4e0a\u5f0f\u53ef\u4ee5\u62c6\u6210\uff1a\n$$\n\\max\\left\\{\\left\\lfloor\\dfrac{2L_l + l + 2L_r - r - 2}{2}\\right\\rfloor, \\left\\lceil\\dfrac{-2l_l - l - 2l_r + r}{2}\\right\\rceil\\right\\}\n$$\n\u7136\u540e\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u6700\u5927\u5316 $2L_l + l$ \uff0c$2L_r - r$ \uff0c$-2l_l - l$ \uff0c$-2l_r + r$ \u3002\n\n\u5148\u5bf9\u539f\u6570\u7ec4\u6392\u5e8f\uff0c\u8fd9\u6837\u4fdd\u8bc1\u4e86\u5c0f\u7684 $a_i$ \u5bf9\u5927\u7684 $a_i$ \u505a\u8d21\u732e\u3002\n\n\u4ee5\u5904\u7406 $2L_l + l$ \u65f6\u4e3a\u4f8b\uff0c\u5148\u8003\u8651\u5efa\u7acb\u4e00\u9897\u7ebf\u6bb5\u6811\uff0c\u7ebf\u6bb5\u6811\u4e2d\u4e0b\u6807\u4e3a $i$ \u7684\u5730\u65b9\u521d\u59cb\u503c\u4e3a $i$ \u3002\n\n\u56e0\u4e3a\u76f8\u7b49\u7684\u5143\u7d20\u4e92\u76f8\u5f71\u54cd\uff0c\u6240\u4ee5\u5bf9\u4e8e\u76f8\u7b49\u7684\u5143\u7d20\u6574\u4f53\u5904\u7406\uff0c\u5148\u6574\u4f53\u4fee\u6539\uff0c\u518d\u6574\u4f53\u67e5\u8be2\u3002\uff08\u6ce8\u610f\u5728\u5904\u7406 $l_l$ \u6216 $l_r$ \u65f6\uff0c\u8981\u5148\u67e5\u8be2\uff0c\u518d\u4fee\u6539\u3002\uff09\n\n\u9996\u5148\uff0c\u82e5\u5f53\u524d\u5143\u7d20\u4e3a $j$ \uff0c\u4e14\u6709 $k \\ge j\\ (a_k \\ge a_j)$ \uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a $k$ \u7684 $L_l(1 \\le l \\le j)$ \u8d21\u732e\u4e3a $2$ \uff0c\u7ebf\u6bb5\u6811\u4e0a\u533a\u95f4\u52a0\u3002\n\n\u4f46\u662f\u5f53 $k < j$ \u65f6\uff0c\u8fd9\u6837\u4fee\u6539\u5c31\u4e0d\u5bf9\u4e86\u3002\n\n\u4f46\u662f\u6362\u4e00\u4e2a\u89d2\u5ea6\uff0c\u5f53 $k < j$ \u65f6\uff0c\u8fd9\u6837\u4fee\u6539\u65f6\uff0c$j$ \u5bf9\u4e8e\u6240\u6709 $L_l(1 \\le l\\le k)$ \u7684\u8d21\u732e\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5dee\u5206\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u7b54\u6848\u5c31\u662f\uff08\uff08\u7ebf\u6bb5\u6811\u4e0a $[1, k]$ \u4e2d\u7684\u6700\u5927\u503c\uff09\u51cf\u53bb\uff08\uff08\u7ebf\u6bb5\u6811\u4e0a\u4e0b\u6807\u4e3a $k + 1$ \u7684\u503c\uff09 \u51cf\u53bb \uff08 $k + 1$ \uff09\uff09\uff09\u3002\n\n\u5176\u4ed6\u60c5\u51b5\u90fd\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O (n\\log n)$ \u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define forn(i,s,t) for(register int i=(s); i<=(t); ++i)\n#define form(i,s,t) for(register int i=(s); i>=(t); --i)\n#define rep(i,s,t) for(register int i=(s); i<(t); ++i)\nusing namespace std;\ntypedef long long i64;\nconst int N = 2e5 + 3;\ntemplate<typename T>\ninline T Max(T A, T B) {return A > B ? A : B;}\nint zz[N], rt, n;\nclass SegTree {\npublic:\n\tint val[N << 1], L[N << 1], R[N << 1], tag[N << 1], sl;\n\tinline void push_up(int p) {\n\t\tval[p] = Max(val[L[p]], val[R[p]]);\n\t}\n\tinline void Opt(int p, int k) {\n\t\tval[p] += k, tag[p] += k;\n\t}\n\tinline void push_down(int p) {\n\t\tOpt(L[p], tag[p]), Opt(R[p], tag[p]), tag[p] = 0;\n\t}\n\tvoid Bld(int& p, int l, int r) {\n\t\tp = ++sl, tag[p] = 0;\n\t\tif(l == r) return val[p] = zz[l], void();\n\t\tint mid = l + r >> 1;\n\t\tBld(L[p], l, mid), Bld(R[p], mid + 1, r);\n\t\tpush_up(p);\n\t}\n\tvoid Upd(int p, int l, int r, int nl, int nr, int k) {\n\t\tif(l == nl && nr == r) return Opt(p, k);\n\t\tint mid = nl + nr >> 1;\n\t\t(tag[p]) && (push_down(p), 0);\n\t\tif(r <= mid) Upd(L[p], l, r, nl, mid, k);\n\t\telse if(l > mid) Upd(R[p], l, r, mid + 1, nr, k);\n\t\telse Upd(L[p], l, mid, nl, mid, k), Upd(R[p], mid + 1, r, mid + 1, nr, k);\n\t\tpush_up(p);\n\t}\n\tint Qry(int p, int l, int r, int nl, int nr) {\n\t\tif(l == nl && nr == r) return val[p];\n\t\tint mid = nl + nr >> 1;\n\t\t(tag[p]) && (push_down(p), 0);\n\t\tif(r <= mid) return Qry(L[p], l, r, nl, mid);\n\t\telse if(l > mid) return Qry(R[p], l, r, mid + 1, nr);\n\t\telse return Max(Qry(L[p], l, mid, nl, mid), Qry(R[p], mid + 1, r, mid + 1, nr));\n\t}\n}T; // \u533a\u95f4\u52a0, \u533a\u95f4 max \nint a[N], Ll[N], Lr[N], Rl[N], Rr[N], id[N];\n// Ll \u8868\u793a 2L_l + l, Lr \u8868\u793a 2Lr - r, Rl \u8868\u793a -2l_l - l, Rr \u8868\u793a -2l_r + r\ninline bool cmp(int A, int B) {return a[A] < a[B];}\nint main() {\n\tscanf(\"%d\", &n);\n\tforn(i,1,n) scanf(\"%d\", a + i), zz[i] = id[i] = i;\n\tsort(id + 1, id + n + 1, cmp);\n\tT.sl = 0, T.Bld(rt, 1, n);\n\tforn(i,1,n) {\n\t\tint j = i;\n\t\tdo T.Upd(rt, 1, id[j], 1, n, 2), ++j;\n\t\twhile(a[id[j]] == a[id[i]]);\n\t\trep(k,i,j) Ll[id[k]] = T.Qry(rt, 1, id[k], 1, n) - \n\t\t\t\t\t((id[k] < n) ? (T.Qry(rt, id[k] + 1, id[k] + 1, 1, n) - id[k] - 1) : 0);\n\t\ti = j - 1;\n\t}\n\tT.sl = 0, T.Bld(rt, 1, n);\n\tforn(i,1,n) {\n\t\tint j = i;\n\t\tdo Rr[id[j]] = T.Qry(rt, id[j], n, 1, n) -\n\t\t\t\t\t\t(T.Qry(rt, id[j], id[j], 1, n) - id[j]), ++j;\n\t\twhile(a[id[j]] == a[id[i]]);\n\t\trep(k,i,j) T.Upd(rt, id[k], n, 1, n, -2);\n\t\ti = j - 1;\n\t}\n\tforn(i,1,n) zz[i] = -i;\n\tT.sl = 0, T.Bld(rt, 1, n);\n\tforn(i,1,n) {\n\t\tint j = i;\n\t\tdo T.Upd(rt, id[j], n, 1, n, 2), ++j;\n\t\twhile(a[id[j]] == a[id[i]]);\n\t\trep(k,i,j) Lr[id[k]] = T.Qry(rt, id[k], n, 1, n) - (T.Qry(rt, id[k], id[k], 1, n) + id[k]);\n\t\ti = j - 1;\n\t}\n\tT.sl = 0, T.Bld(rt, 1, n);\n\tforn(i,1,n) {\n\t\tint j = i;\n\t\tdo Rl[id[j]] = T.Qry(rt, 1, id[j], 1, n) - \n\t\t\t\t\t\t(T.Qry(rt, id[j], id[j], 1, n) + id[j]), ++j;\n\t\twhile(a[id[j]] == a[id[i]]);\n\t\trep(k,i,j) T.Upd(rt, 1, id[k], 1, n, -2);\n\t\ti = j - 1;\n\t}\n\tforn(i,1,n) printf(\"%d%c\", Max(Ll[i] + Lr[i] - 2, Rl[i] + Rr[i] + 1) >> 1, \" \\n\"[i == n]);\n\treturn 0;\n}\n```\n\n~~\u6807\u7b97\u6bd4\u8fd9\u4e2a\u4e0d\u77e5\u9053\u9ad8\u5230\u54ea\u91cc\u53bb\u4e86~~",
        "postTime": 1624527213,
        "uid": 223884,
        "name": "AxDea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3\uff1a\u300cCF1539\u300d F. Strange Array"
    }
]