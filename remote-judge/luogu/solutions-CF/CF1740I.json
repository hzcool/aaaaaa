[
    {
        "content": "\u8fd9\u662f\u4e00\u4e2a\u6211\u82b1\u4e86 1.5h \u601d\u8003\u51fa\u7684\u6bd4\u6807\u7b97\u66f4\u4f18\u7684\u505a\u6cd5\uff0c\u76ee\u524d\u672a\u7ecf\u8fc7\u5361\u5e38\u7684\u4ee3\u7801\u83b7\u5f97\u4e86 CF \u6700\u4f18\u89e3\u3002\r\n\r\n\u8bbe $b_i=(a_i-a_{(i+n-1)\\bmod n})\\bmod m$\u3002\r\n\r\n$a$ \u5168 $0$ \u7b49\u4ef7\u4e8e $b$ \u5168 $0$ \u4e14 $a_0=0$\u3002\r\n\r\n\u6bcf\u6b21\u64cd\u4f5c\u5bf9 $b$ \u7684\u5f71\u54cd\u4e3a $b_i\\rightarrow (b_i+1)\\bmod m,b_{(i+k)\\bmod n}\\leftarrow (b_{(i+k)\\bmod n}-1)\\bmod m$ \u6216 $b_i\\rightarrow (b_i-1)\\bmod m,b_{(i+k)\\bmod n}\\leftarrow (b_{(i+k)\\bmod n}+1)\\bmod m$\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u4ece $i$ \u5411 $(i+k)\\bmod n$ \u8fde\u8fb9\uff0c\u8fd9\u6837\u6211\u4eec\u4f1a\u5f97\u5230 $d=\\gcd(n,k)$ \u4e2a\u957f\u5ea6\u4e3a $l=\\dfrac{n}{d}$ \u7684\u73af\u3002\r\n\r\n\u90a3\u4e48\u6bcf\u6b21\u64cd\u4f5c\u5373\u4e3a\u5728\u67d0\u4e2a\u73af\u4e0a\u9009\u62e9\u76f8\u90bb\u4e24\u4e2a\u6570\u5206\u522b $+1,-1$\uff0c\u5176\u4e2d\u67d0\u4e9b\u64cd\u4f5c\u4f1a\u5bf9 $a_0$ \u6709\u5f71\u54cd\u3002\u4e00\u4e2a\u73af\u4e0a\u5bf9 $a_0$ \u6709\u5f71\u54cd\u7684\u64cd\u4f5c\u4f4d\u7f6e\u6570\u91cf\u6070\u597d\u4e3a $\\dfrac{k}{d}$\u3002\r\n\r\n\u5bf9\u4e8e\u4e00\u4e2a\u73af\uff0c\u8bbe\u5b83\u4e0a\u9762\u7684\u6570\u4f9d\u6b21\u4e3a $c_{0\\dots l-1}$\uff0c\u8bbe $s$ \u4e3a $c$ \u7684\u524d\u7f00\u548c\u3002\r\n\r\n\u4e0d\u59a8\u8bbe $c_0$ \u548c $c_{l-1}$ \u4e4b\u95f4\u7684\u64cd\u4f5c\u4e0d\u4f1a\u5bf9 $a_0$ \u4ea7\u751f\u5f71\u54cd\u3002\r\n\r\n\u8bbe $c_0$ \u548c $c_{l-1}$ \u4e4b\u95f4\u7684\u64cd\u4f5c\u6700\u7ec8\u4f7f\u5f97 $c_0\\leftarrow (c_0+t)\\bmod m,c_{l-1}\\leftarrow (c_{l-1}-t)\\bmod m$\u3002\r\n\r\n\u679a\u4e3e $t$ \u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u65ad\u73af\u4e3a\u94fe\u3002\u8bbe $s'_i=(s_i+t)\\bmod m$\u3002\r\n\r\n\u4e4b\u540e\u6bcf\u6b21\u64cd\u4f5c\u5bf9 $s'$ \u7684\u5f71\u54cd\u4e3a $s'_i\\leftarrow s'_i+1$ \u6216 $s'_i\\leftarrow s'_i-1$\uff0c\u5176\u4e2d $i\\in [0,l-2]$\u3002\u800c\u5982\u679c $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u7684\u64cd\u4f5c\u4f1a\u5bf9 $a_0$ \u4ea7\u751f\u5f71\u54cd\uff0c\u90a3\u4e48 $a_0$ \u7684\u53d8\u5316\u91cf\u4e0e $s'_i$ \u7684\u53d8\u5316\u91cf\u662f\u4e00\u81f4\u7684\u3002\r\n\r\n\u6700\u5c11\u7684\u64cd\u4f5c\u6b21\u6570\u5373\u4e3a $\\sum\\limits_{i=0}^{l-2}\\min\\{s'_i\\bmod m,m-s'_i\\bmod m\\}$\u3002\r\n\r\n\u8bbe\u8fd9\u4e2a\u73af\u5728 $t=0$ \u65f6\u7684\u64cd\u4f5c\u4f1a\u4f7f\u5f97 $a_0\\leftarrow (a_0+\\Delta)\\bmod m$\u3002\r\n\r\n\u53ef\u4ee5\u5f97\u5230\uff0c\u5bf9\u4e8e\u4efb\u610f $t$\uff0c\u5b83\u4f1a\u4f7f\u5f97 $a_0\\leftarrow (a_0+\\Delta-\\dfrac{kt}{d})\\bmod m$\u3002\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u73af\u4e8b\u5148\u8ba1\u7b97\u51fa $\\Delta$\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u5f71\u54cd\u7edf\u8ba1\u5230 $a_0$ \u4e0a\u3002\u8bbe\u6b64\u65f6 $a_0$ \u53d8\u4e3a $a'_0$\u3002\u8bbe\u6240\u6709\u73af\u7684 $t$ \u4e4b\u548c\u4e3a $t_0$\uff0c\u6211\u4eec\u8981\u6c42 $a'_0=\\left(\\dfrac{kt_0}{d}\\right)\\bmod m$\uff0c\u53ea\u9700\u8981\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\u5c31\u53ef\u4ee5\u4f7f\u5f97\u6700\u7ec8 $a'_0=0$\u3002\r\n\r\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4f9d\u6b21\u8003\u8651\u6bcf\u4e2a\u73af\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $t$ \u6c42\u51fa $w_t=\\min\\{t,m-t\\}+\\sum\\limits_{i=0}^{l-2}\\min\\{(s_i+t)\\bmod m,m-(s_i+t)\\bmod m\\}$\u3002\r\n\r\n\u8bbe $dp_i$ \u8868\u793a\u5f53\u524d $t_0\\bmod m=i$ \u7684\u6700\u5c0f\u603b\u4ee3\u4ef7\uff0c\u6bcf\u6b21\u8ba1\u7b97\u51fa\u4e00\u4e2a\u73af\u7684 $w$ \u4e4b\u540e\u6211\u4eec\u5c06\u8fd9\u4e2a\u73af\u7684\u8d21\u732e\u901a\u8fc7\u80cc\u5305\u8ba1\u5165 $dp$ \u4e2d\u5373\u53ef\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(dm^2)$\u3002\u4f46\u8fd9\u4e0d\u591f\u4f18\u79c0\u3002\r\n\r\n\u8003\u8651\u4e00\u4e2a\u73af\u7684 $w$ \u6709\u4ec0\u4e48\u6027\u8d28\u3002\u53ef\u4ee5\u53d1\u73b0 $\\min\\{t,m-t\\}$ \u548c $\\min\\{(s_i+t)\\bmod m,m-(s_i+t)\\bmod m\\}$ \u90fd\u662f\u53ea\u6709 $O(1)$ \u6bb5\u7684\u5206\u6bb5\u4e00\u6b21\u51fd\u6570\uff0c\u56e0\u6b64 $w$ \u53ef\u4ee5\u88ab\u5206\u4e3a $O(l)$ \u6bb5\u7b49\u5dee\u6570\u5217\u3002\r\n\r\n\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u5728 $O(m)$ \u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u4e00\u6bb5\u7b49\u5dee\u6570\u5217\u5bf9 $dp$ \u7684\u8d21\u732e\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u88ab\u4f18\u5316\u4e3a $O(dlm)=O(nm)$\u3002\r\n\r\n\u53c2\u8003\u4ee3\u7801\uff1a\r\n\r\n```cpp\r\n#include <bits/stdc++.h>\r\nusing namespace std;\r\n#define N 1000005\r\n#define LIM 10000005\r\n#define ll long long\r\n#define gc() (P1==P2 && (P2=(P1=buf)+fread(buf,1,LIM,stdin),P1==P2)?EOF:*P1++)\r\nconst ll INF=1e18;char buf[LIM],*P1=buf,*P2=buf;\r\nint n,n1,m,c,d,tp,gl,a[N],a1[N],b[N],q[N];\r\nll ans,w[N],dp[N],tmp[N*2];struct Node {int l,r;ll w;}z[N];\r\nint rd()\r\n{\r\n\tint res=0;char c=0;while(!isdigit(c)) c=gc();\r\n\twhile(isdigit(c)) res=res*10+(c-48),c=gc();return res;\r\n}\r\nint gcd(int x,int y) {return y?gcd(y,x%y):x;}\r\nint main()\r\n{\r\n\tn=rd();m=rd();c=rd();d=gcd(n,c);n1=n/d;\r\n\tfor(int i=0;i<n;++i) a1[i]=rd();gl=a1[n-1];\r\n\tfor(int i=0;i<n;++i) a[(i+1)%n]=(a1[(i+1)%n]-a1[i]+m)%m;\r\n\tans=INF;for(int i=1;i<m;++i) dp[i]=INF;\r\n\tfor(int i=0,t;i<d;++i)\r\n\t{\r\n\t\tfor(int j=0;j<n1;++j)\r\n\t\t{\r\n\t\t\tt=(i+1ll*j*c)%n;b[j]=a[t];if(j) b[j]=(b[j]+b[j-1])%m;\r\n\t\t\tif(t+c>=n) gl=(gl-b[j]+m)%m;\r\n\t\t}if(b[n1-1]) {printf(\"-1\\n\");return 0;}for(int j=0;j<m;++j) w[j]=min(j,m-j);\r\n\t\tfor(int j=0;j<n1-1;++j) for(int k=0;k<m;++k) t=(b[j]+k)%m,w[k]+=min(t,m-t);\r\n\t\ttp=0;z[++tp]=(Node) {0,0,w[1]-w[0]};\r\n\t\tfor(int j=2;j<m;++j) if(w[j]-w[j-1]!=z[tp].w)\r\n\t\t\tz[tp].r=j-1,z[++tp]=(Node) {j,0,w[j]-w[j-1]};z[tp].r=m-1;\r\n\t\tfor(int j=0;j<m*2;++j) tmp[j]=INF;\r\n\t\tfor(int j=1,l,r;j<=tp;++j)\r\n\t\t{\r\n\t\t\tq[0]=2;q[1]=1;l=z[j].l;r=z[j].r;\r\n\t\t\tfor(int k=l;k<m+r;++k)\r\n\t\t\t{\r\n\t\t\t\twhile(q[0]<=q[1] && q[q[0]]<k-r) ++q[0];\r\n\t\t\t\tif(k-l<m)\r\n\t\t\t\t{\r\n\t\t\t\t\twhile(q[0]<=q[1] && dp[k-l]<=dp[q[q[1]]]+z[j].w*(k-l-q[q[1]]))\r\n\t\t\t\t\t\t--q[1];q[++q[1]]=k-l;\r\n\t\t\t\t}if(q[0]<=q[1]) tmp[k]=min(tmp[k],dp[q[q[0]]]+w[k-q[q[0]]]);\r\n\t\t\t}\r\n\t\t}for(int j=0;j<m;++j) dp[j]=min(tmp[j],tmp[m+j]);\r\n\t}for(int i=0;i<m;++i) if(gl==1ll*c/d*i%m) ans=min(ans,dp[i]);\r\n\tif(ans<INF) printf(\"%lld\\n\",ans);else printf(\"-1\\n\");return 0;\r\n}\r\n```",
        "postTime": 1667207283,
        "uid": 119621,
        "name": "Kubic",
        "ccfLevel": 10,
        "title": "CF1740I Arranging Crystal Balls"
    },
    {
        "content": "\uff08\u6ce8\uff1a\u9ed8\u8ba4\u4e0b\u6807 1-indexed\uff09\n\n\u8003\u8651\u4e00\u4e2a\u6570\u7ec4\u88ab\u6e05\u96f6\u7684\u5145\u8981\u6761\u4ef6\uff1a\u8bb0 $b_i=a_{i}-a_{(i+n-2)\\bmod n+1}$\uff0c\u90a3\u4e48\u6700\u7ec8 $a_i=0$ \u5f53\u4e14\u4ec5\u5f53 $b_i=0$ \u4e14 $a_1=0$\u3002\n\n\u601d\u8003\u4e00\u6b21\u64cd\u4f5c\u7684\u5f71\u54cd\uff1a\u5047\u8bbe\u6211\u4eec\u5bf9 $[x,x+k-1]$ \u8fd9\u6bb5\u73af\u4e0a\u7684\u533a\u95f4\u8fdb\u884c\u4e86 $+v$\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u662f\u4ee4 $b_x$ \u52a0 $v$\uff0c$b_{x+k}$ \u51cf $v$\u3002\u540c\u65f6\u5982\u679c\u8fd9\u6bb5\u533a\u95f4\u7ecf\u8fc7\u4e86 $1$\uff0c\u90a3\u4e48\u4ee4 $a_1$ \u52a0 $v$\u3002\u8003\u8651\u5728 $i$ \u4e0e $(i+k-1)\\bmod n+1$ \u4e4b\u95f4\u8fde\u4e00\u6761\u8fb9\uff0c\u8fd9\u6837\u663e\u7136\u56fe\u4f1a\u5f62\u6210\u82e5\u5e72\u4e2a\u73af\u3002\u6bcf\u4e2a\u73af\u662f\u72ec\u7acb\u7684\uff0c\u5e76\u4e14\u7531\u4e8e\u6211\u4eec\u8981\u8ba9 $b_i$ \u6e05\u96f6\uff0c\u6240\u4ee5\u94a6\u5b9a\u4e86\u73af\u4e0a\u4e00\u6761\u8fb9\u8fdb\u884c $+1$ \u7684\u6b21\u6570\u4e4b\u540e\uff0c\u6bcf\u6761\u8fb9\u8fdb\u884c $+1$ \u7684\u6b21\u6570\u5c31\u786e\u5b9a\u4e86\uff0c\u8fd9\u6837\u603b\u4ee3\u4ef7\u53ef\u4ee5\u7528 $\\sum \\min(c_i,m-c_i)$ \u6765\u8ba1\u7b97\u603b\u4ee3\u4ef7\uff0c\u540c\u65f6\u6b64\u6b21\u64cd\u4f5c\u5bf9 $a_1$ \u7684\u5f71\u54cd\u4e5f\u662f\u53ef\u4ee5\u8ba1\u7b97\u7684\u3002\n\n\u8fd9\u6837\u5c31\u6709\u4e00\u4e2a\u5f88\u663e\u7136\u7684 DP \u6a21\u578b\uff1a$dp_{i,j}$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u4e2a\u73af\uff0c\u76ee\u524d $a_1=j$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u7531\u4e8e\u4ee3\u4ef7\u5173\u4e8e\u6211\u4eec\u94a6\u5b9a\u7684\u90a3\u6761\u8fb9\u7684\u51fd\u6570\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u5206\u6bb5\u51fd\u6570\uff0c\u4e14\u6bcf\u4e00\u6bb5\u90fd\u662f\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570\uff0c\u56e0\u6b64\u53ef\u4ee5\u5355\u8c03\u961f\u5217\u4f18\u5316\u3002\u603b\u590d\u6742\u5ea6 $\\dfrac{n}{len}\u00b7m\u00b7len=nm$\uff0c\u5176\u4e2d $len$ \u662f\u73af\u957f\u3002\n\n\u4ee3\u7801\u5495\u4e86\uff0c\u660e\u5929\u518d\u5199\u3002\n\nupd\uff1a\u5495\u5b8c\u4e86\u3002\n\n```cpp\nconst int MAXN=1e6;\nconst ll INF=0x3f3f3f3f3f3f3f3fll;\nint n,m,k,a[MAXN+5],b[MAXN+5],vis[MAXN+5];ll dp[MAXN+5];\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tfor(int i=0;i<n;i++)scanf(\"%d\",&a[i]);\n\tfor(int i=0;i<n;i++)b[i]=(a[i]-a[(i+n-1)%n]+m)%m;\n//\tfor(int i=0;i<n;i++)printf(\"%d%c\",b[i],\" \\n\"[i==n-1]);\n\tmemset(dp,63,sizeof(dp));dp[a[0]]=0;\n\tfor(int i=0;i<n;i++)if(!vis[i]){\n\t\tvector<int>seq,val;\n\t\tfor(int j=i;!vis[j];j=(j+k)%n)seq.pb(j),vis[j]=1;\n\t\tseq.pb(seq[0]);val.resize(seq.size(),0);\n\t\tint sd=0;for(int j=1;j<seq.size();j++)sd=(sd+b[seq[j]])%m;\n\t\tif(sd)return puts(\"-1\"),0;\n\t\tfor(int j=2;j<seq.size();j++)val[j]=(val[j-1]-b[seq[j-1]]+m)%m;\n\t\tstatic ll ndp[MAXN+5];\n\t\tfor(int j=0;j<m;j++)ndp[j]=INF;\n\t\tint A=0,B=0;\n\t\tfor(int j=1;j<seq.size();j++)\n\t\t\tif(seq[j-1]==0||(seq[j-1]>seq[j]&&seq[j]!=0))\n\t\t\t\tA++,B=(B+val[j])%m;\n\t\tstatic ll difa[MAXN+5],difb[MAXN+5];\n\t\tauto add=[&](int l,int r,int a,int b){\n//\t\t\tprintf(\"[%d,%d] %dx+%d\\n\",l,r,a,b);\n\t\t\tdifa[l]+=a;difa[r+1]-=a;difb[l]+=b;difb[r+1]-=b;\n\t\t};\n\t\tfor(int j=0;j<=m;j++)difa[j]=difb[j]=0;\n\t\tfor(int j=1;j<seq.size();j++){\n\t\t\tint l=(m-val[j])%m,r=(m+(m>>1)-val[j])%m;\n\t\t\tif(l<=r)add(l,r,1,-l);\n\t\t\telse add(l,m-1,1,-l),add(0,r,1,m-l);\n\t\t\tif(m!=2){\n\t\t\t\tl=(m+(m>>1)+1-val[j])%m;r=(m-1-val[j])%m;\n\t\t\t\tif(l<=r)add(l,r,-1,r+1);\n\t\t\t\telse add(l,m-1,-1,r+1+m),add(0,r,-1,r+1);\n\t\t\t}\n\t\t}\n\t\tfor(int j=1;j<=m;j++)difa[j]+=difa[j-1],difb[j]+=difb[j-1];\n\t\tfor(int l=0,r;l<m;l=r){\n\t\t\tr=l;while(r<m&&mp(difa[r],difb[r])==mp(difa[l],difb[l]))++r;\n\t\t\tstatic bool vis[MAXN+5];for(int j=0;j<m;j++)vis[j]=0;\n\t\t\tfor(int j=0;j<m;j++)if(!vis[j]){\n\t\t\t\tvector<int>vec;\n\t\t\t\tfor(int k=j;!vis[k];k=(k+A)%m)vis[k]=1,vec.pb(k);\n\t\t\t\tint tmp=vec.size();\n\t\t\t\tfor(int k=0;k<tmp;k++)vec.pb(vec[k]);\n\t\t\t\tstatic pair<ll,int> q[MAXN*2+5];int fr=1,tl=0;\n\t\t\t\tfor(int k=0;k<vec.size();k++){\n\t\t\t\t\twhile(fr<=tl&&q[fr].se<=k-(r-l))++fr;\n\t\t\t\t\tll val=dp[(vec[k]-1ll*A*l%m-B+m+m)%m]-1ll*difa[l]*k;\n\t\t\t\t\twhile(fr<=tl&&q[tl].fi>val)--tl;\n\t\t\t\t\tq[++tl]=mp(val,k);\n\t\t\t\t\tif(fr<=tl)chkmin(ndp[vec[k]],q[fr].fi+1ll*difa[l]*(l+k)+difb[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(int j=0;j<m;j++)dp[j]=ndp[j];\n\t}\n\tprintf(\"%lld\\n\",(dp[0]==INF)?-1:dp[0]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1685194822,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1740I Arranging Crystal Balls"
    }
]