[
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1220E)\n\n$\\text{vp}$ \u8d5b\u9898\uff0c\u795e [$\\text{zltqwq}$](https://www.luogu.com.cn/user/275273) \u5199\u4e86\u4e00\u4e2a\u4ee4\u4eba\u77a0\u76ee\u7ed3\u820c\u7684\u8fb9\u53cc\u7f29\u70b9 $\\text{dp}$\uff0c\u4f46\u662f\u4f3c\u4e4e\u88ab\u6211\u62d3\u6251\u6c34\u8fc7\u53bb\u4e86...\n\n## \u9898\u76ee\u5206\u6790\n\n\u8003\u8651\u5230\u4e00\u4e2a\u73af\u53ef\u4ee5\u968f\u4fbf\u8d70\uff0c\u7136\u540e\u770b\u8d77\u70b9\u5728\u4e0d\u5728\u4e0a\u9762\u3002\u5982\u679c\u4e0d\u5728\u4e0a\u9762\uff0c\u90a3\u4e48\u8d77\u70b9\u8fde\u63a5\u5230\u5176\u4ed6\u73af\u7684\u70b9\u4e0d\u80fd\u904d\u5386\uff0c\u5426\u5219\u53ef\u4ee5\u3002\n\n\u7136\u540e\u8003\u8651\u5269\u4e0b\u7684\u8def\u5f84\uff0c\u6c42\u6700\u4f18\u6240\u4ee5\u9009\u6743\u503c\u6700\u5927\u7684\u3002\u8dd1\u4e00\u904d\u62d3\u6251\uff0c\u7136\u540e\u8003\u8651\u62d3\u6251\u5e8f\u4e0a $\\text{dp}$\u3002\n\n\u4ee4 $dp_i$ \u8868\u793a $i$ \u70b9\u8dd1\u5230\u6700\u540e\u6743\u503c\u6700\u5927\u503c\uff0c\u5219\u6709\uff1a\n\n$$dp_v=\\max(dp_v,dp_u+a_u)$$\n\n\u7136\u540e\u6700\u4f18\u7684\u8def\u5f84\u663e\u7136\u4e3a\u6240\u6709 $dp_i$ \u4e2d\u7684\u6700\u5927\u503c\uff0c\u627e\u51fa\u6765\u540e\u52a0\u4e0a\u6ca1\u6709\u88ab\u62d3\u6251\u7684\u70b9\u6743\u548c\u5373\u4e3a\u7b54\u6848\u3002\n\n## \u8d34\u4e0a\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-') f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\tx=x*10+c-48;\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\nconst int maxn=2e5+5;\nint n,m;\nint sum,ans;\nint a[maxn],dp[maxn];\nint cnt_edge,head[maxn],in[maxn];\nstruct edge{\n\tint to,nxt;\n}e[maxn<<1];\nvoid add(int u,int v){\n\te[++cnt_edge].nxt=head[u];\n\te[cnt_edge].to=v;\n\thead[u]=cnt_edge;\n}\nvoid topsort(int x){\n\tqueue<int> q;\n\tfor(register int i=1;i<=n;++i){\n\t\tif(in[i]!=1||i==x) continue;\n\t\tq.push(i);\n\t}\n\twhile(!q.empty()){\n\t\tint u=q.front();q.pop();in[u]=0;\n\t\tfor(register int i=head[u];i;i=e[i].nxt){\n\t\t\tint v=e[i].to;\n\t\t\tif(in[v]==0) continue;\n\t\t\tdp[v]=max(dp[v],dp[u]+a[u]);\n\t\t\tif(v==x) continue;\n\t\t\tin[v]--;\n\t\t\tif(in[v]==1) q.push(v);\n\t\t}\n\t}\n}\ninline void init(){\n\tn=read();m=read();\n\tfor(register int i=1;i<=n;++i) a[i]=read();\n\tif(n==1) cout<<a[1],exit(0);\n\tfor(register int i=1;i<=m;++i){\n\t\tint u=read(),v=read();\n\t\tadd(u,v);add(v,u);\n\t\tin[u]++;in[v]++;\n\t}\n\ttopsort(read());\n}\nsigned main(){\n\tinit();\n\tfor(register int i=1;i<=n;++i){\n\t\tif(in[i]==0) continue;\n\t\tsum+=a[i];ans=max(ans,dp[i]);\n\t}\n\tans+=sum;\n\tprintf(\"%lld\",ans);\n}\n```",
        "postTime": 1670060276,
        "uid": 590864,
        "name": "Yizhixiaoyun",
        "ccfLevel": 5,
        "title": "CF1220E \u9898\u89e3"
    },
    {
        "content": "\u7f29\u70b9\u3001\u62d3\u6251\u6392\u5e8f\u90fd\u4e0d\u9700\u8981\uff0cdfs \u4e00\u904d\u5c31\u884c\u4e86\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u8d70\u5230 $i$ \u70b9\uff0c\u5e76\u4e14\u53ef\u4ee5\u5f80\u56de\u8d70\uff0c\u6700\u5927\u7684\u6743\u503c\u3002\n\n$g_i$ \u8868\u793a\u8d70\u5230 $i$ \u70b9\uff0c\u4e0d\u80fd\u5f80\u56de\u8d70\uff0c\u6700\u5927\u7684\u6743\u503c\u3002\n\n\u8bbe\u5f53\u524d dfs \u5230\u70b9 $x$\uff0c$j$ \u4e0e $x$ \u76f4\u63a5\u76f8\u8fde\u3002\n\n\u7528\u4e00\u4e2a bool \u53d8\u91cf $z_x$ \u8868\u793a $x$ \u7684 dfs \u6811\u5b50\u6811\u5185\u662f\u5426\u5b58\u5728\u70b9\u5728\u73af\u4e0a\u3002\n\n\u82e5 $j$ \u5df2\u7ecf\u88ab\u8bbf\u95ee\u8fc7\uff0c\u4e14 $j$ \u4e0d\u4e3a $x$ \u7684\u7236\u4eb2\uff0c\u5219 $z_x=1$ \u3002\n\n\u82e5 $j$ \u672a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u4e14 $z_j=1$\uff0c\u5219 $z_x=1$\u3002\n\n\u82e5 $j$ \u672a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u53ef\u4ee5\u7528 $j$ \u7684 dp \u503c\u66f4\u65b0 $x$ \u7684 dp \u503c\uff0c\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b\uff1a\n\n$g_x=w_x+\\max(g_j-f_j)+\\sum f_j$\u3002\uff08\u5148\u8d70\u6240\u6709\u7684\u73af\uff0c\u518d\u8d70\u4e00\u6761\u94fe\uff09\n\n\u5f53 $z_x=1$ \u65f6\uff0c$f_x=w_x+\\sum f_j$\u3002\uff08\u8d70\u5b8c\u6240\u6709\u7684\u73af\u4e4b\u540e\u56de\u5230\u7236\u4eb2\u7ed3\u70b9\uff09\n\n\u7b54\u6848\u5373\u4e3a $g_s$\u3002\n\n\u4ee3\u7801\u5f88\u77ed\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int N=2e5+3,M=4e5+3;\nint he[N],to[M],ne[M];\nll w[N],f[N],g[N];\nbool b[N];\nvoid dfs(int x,int y){\n\tint i=he[x],j;\n\tll o=0,u=0;\n\tbool z=0;\n\tfor(b[x]=1;i;i=ne[i])if(i!=y){\n\t\tj=to[i];\n\t\tif(b[j])z=1;\n\t\telse{\n\t\t\tdfs(j,i^1);\n\t\t\tif(f[j]>=0)o+=f[j],z=1,u=max(u,g[j]-f[j]);\n\t\t\telse u=max(u,g[j]);\n\t\t}\n\t}\n\tf[x]=z?o+w[x]:-1,g[x]=o+u+w[x];\n}\nint main(){\n\tint n,m,i,j,t=1;\n\tscanf(\"%d%d\",&n,&m);\n\tfor(i=1;i<=n;++i)scanf(\"%lld\",w+i);\n\twhile(m--){\n\t\tscanf(\"%d%d\",&i,&j);\n\t\tne[++t]=he[i],to[t]=j,he[i]=t;\n\t\tne[++t]=he[j],to[t]=i,he[j]=t;\n\t}\n\tscanf(\"%d\",&i),dfs(i,0),printf(\"%lld\\n\",g[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1601610088,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1220E \u3010Tourism\u3011"
    },
    {
        "content": "\u4ecb\u7ecd\u4e00\u79cd\u6700\u6bd2\u7624\u7684\u89e3\u6cd5\u3002\r\n\r\n\u601d\u7ef4\u96be\u5ea6\u7279\u522b\u4f4e\uff1a\u5148\u7b2c\u4e00\u6b21\u7f29\u70b9\uff0c\u6839\u636e\u9898\u610f\uff0c\u6240\u6709\u96c6\u5408\u6570\u91cf\u5927\u4e8e $1$ \u7684 bcc \uff08\u8fb9\u53cc\u8fde\u901a\u5206\u91cf\uff09\u53ca\u5176\u4e24\u4e24\u4e4b\u95f4\u8def\u5f84\u4e0a\u7684\u70b9\u662f\u53ef\u4ee5\u76f8\u4e92\u5230\u8fbe\u7684\uff0c\u8fd9\u4f55\u5c1d\u4e0d\u662f\u53e6\u4e00\u4e2a\u610f\u4e49\u4e0a\u7684\u8fb9\u53cc\u8fde\u901a\u5206\u91cf\uff1f\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u628a\u8fd9\u4e9b bcc \u7f29\u6210\u4e00\u4e2a\u201c\u8d85\u7ea7 bcc \u201d\uff0c\u53ea\u9700\u7ed9\u6570\u91cf\u5927\u4e8e1\u7684bcc\u7528\u81f3\u591a $n$ \u6761\u8fb9\u987a\u6b21\u8fde\u5728\u4e00\u8d77\uff0c\u7136\u540e\u518d\u8dd1\u4e00\u6b21 tarjan \u5e76\u4e14\u7f29\u70b9\u5efa\u56fe\uff0c\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u6839\u4e3a\u4e00\u4e2a\u5f88\u5927\u7684 bcc \u4e14\u5176\u5b83 bcc \u7684\u5927\u5c0f\u90fd\u662f1\u7684\u6811\uff0cdfs\u53ef\u6c42\u5f97\u7b54\u6848\u3002\r\n\r\n\r\n\u601d\u60f3\u8d8a\u7b80\u5355\uff0c\u4ee3\u7801\u5f80\u5f80\u5b9e\u73b0\u8d8a\u590d\u6742\uff1a  \r\n1.\u6bcf\u6b21 tarjan \u7f29\u70b9\u524d\u90fd\u8981\u8003\u8651\u521d\u59cb\u5316\u7b49\u7ec6\u8282\u3002  \r\n2.\u4e00\u5171\u8981\u5efa\u7acb\u4e09\u4e2a\u56fe(\u6700\u521d\u7684\u3001\u7b2c\u4e00\u6b21\u7f29\u70b9\u540e\u7684\u3001\u7b2c\u4e8c\u6b21\u7f29\u5b8c\u70b9\u7528\u6765\u8dd1\u7b54\u6848)\u3002  \r\n3.\u5982\u679c\u7b2c\u4e00\u6b21\u7f29\u4e86\u70b9\u540e\uff0c $S$ \u6240\u5728 bcc \u7684\u6570\u91cf\u7b49\u4e8e $1$\uff08\u8fd9\u6837\u7684\u8bdd\u7b2c\u4e8c\u6b21\u7f29\u70b9\u540e\uff0c $S$ \u5fc5\u4e0d\u53ef\u80fd\u5728\u201c\u8d85\u7ea7 bcc \u201d\u5185\uff09\uff0c\u8003\u8651\u628a S \u548c\u4efb\u610f\u4e00\u4e2a\u6570\u91cf\u5927\u4e8e $1$ \u7684 bcc \u8fde\u8fb9\u3002  \r\n4.\u5982\u679c\u4e8c\u6b21\u7f29\u70b9\u540e\u6ca1\u6709\u4efb\u610f\u4e00\u4e2a bcc \u7684\u5927\u5c0f\u662f\u5927\u4e8e $1$ \u7684\uff0c\u8bf4\u660e\u8fd9\u4e2a\u56fe\u662f\u4e00\u68f5\u6811\uff0c\u4ee5 $S$ \u4e3a\u6839\uff08\u5c06 $S$ \u89c6\u4e3a\u8d85\u7ea7 bcc\uff09\u641c\u7d22\u5373\u53ef\r\n\r\n### Don't talk much:\r\n```cpp\r\n#include <iostream>\r\n#include <cstdio>\r\n#include <cstring>\r\nusing namespace std;\r\ntypedef long long ll;\r\nconst int N=2e5+10,M=N<<1;\r\nstruct path{\r\n\tint sta,en,nex;\r\n};\r\nstruct Gragh{\r\n\tint ela[N],idx;\r\n\tpath edge[M];\r\n\tvoid clear(){\r\n\t\tmemset(ela,-1,sizeof ela);\r\n\t\tidx=0;\r\n\t}\r\n\tvoid add(int x,int y){\r\n\t\tedge[idx]=(path){x,y,ela[x]};\r\n\t\tela[x]=idx++;\r\n\t}\r\n\tint nex(int i){\r\n\t\treturn edge[i].nex;\r\n\t}\r\n\tint en(int i){\r\n\t\treturn edge[i].en;\r\n\t}\r\n}G1,G2,G3;//\u5efa\u4e09\u4e2a\u56fe\r\nbool is_bridge[M];\r\nll a[N],w[N];\r\nint dfn[N],low[N],ts;\r\nint id[N],bcc;\r\nint Sz[N];\r\nint stk[N],tt;\r\nvoid tarjan(int u,int v,Gragh &G){\r\n\tdfn[u]=low[u]=++ts;\r\n\tstk[++tt]=u;\r\n\tfor(int i=G.ela[u];~i;i=G.nex(i)){\r\n\t\tint j=G.en(i);\r\n\t\tif(!dfn[j]){\r\n\t\t\ttarjan(j,i,G);\r\n\t\t\tlow[u]=min(low[u],low[j]);\r\n\t\t\tif(low[j]>dfn[u]){\r\n\t\t\t\tis_bridge[i]=is_bridge[i^1]=1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(i!=(v^1))\r\n\t\t\tlow[u]=min(low[u],low[j]);\r\n\t}\r\n\tif(dfn[u]==low[u]){\r\n\t\tSz[++bcc]=0;\r\n\t\tint j;\r\n\t\tdo{\r\n\t\t\tj=stk[tt--],id[j]=bcc;\r\n\t\t\tw[bcc]+=a[j],Sz[bcc]++;\r\n\t\t}while(j!=u);\r\n\t}\r\n}\r\nint circle[N];\r\nint n,m;\r\nll ans;\r\nvoid dfs_ans(int u,int fa,ll res){//dfs\u5f97\u7b54\u6848\r\n\tres+=w[u];\r\n\tans=max(ans,res);\r\n\tfor(int i=G3.ela[u];~i;i=G3.nex(i)){\r\n\t\tint j=G3.en(i);\r\n\t\tif(j==fa)continue;\r\n\t\tdfs_ans(j,u,res);\r\n\t}\r\n}\r\nint main(){\r\n\tscanf(\"%d%d\",&n,&m);\r\n\tfor(int i=1;i<=n;i++)\r\n\t\tscanf(\"%d\",a+i);\r\n\tG1.clear();\r\n\tfor(int i=1,x,y;i<=m;i++){\r\n\t\tscanf(\"%d%d\",&x,&y);\r\n\t\tG1.add(x,y),G1.add(y,x);//\u8bfb\u5165\u8fb9\r\n\t}\r\n\tint S;\r\n\tscanf(\"%d\",&S);\r\n\tfor(int i=1;i<=n;i++)\r\n\t\tif(!dfn[i])\r\n\t\t\ttarjan(i,-1,G1);//tarjan\u627e\u8fb9\u53cc\u3001\u6865\r\n\tint k=0;\r\n\tfor(int i=1;i<=bcc;i++){\r\n\t\tif(Sz[i]>1)\r\n\t\t\tcircle[++k]=i;\r\n\t}\r\n\tG2.clear();\r\n\tfor(int i=1;i<k;i++){\r\n\t\tG2.add(circle[i],circle[i+1]);\r\n\t\tG2.add(circle[i+1],circle[i]);\r\n\t}\r\n\tfor(int i=0;i<G1.idx;i++){\r\n\t\tif(is_bridge[i]){\r\n\t\t\tG2.add(id[G1.edge[i].sta],id[G1.edge[i].en]);\r\n\t\t\tis_bridge[i]=0;\r\n\t\t}\r\n\t}//\u7b2c\u4e00\u6b21\u7f29\u70b9\u5efa\u56fe\r\n\tif(Sz[id[S]]==1)\r\n\t\tG2.add(id[S],circle[k]),G2.add(circle[k],id[S]);//\u4e0a\u6587\u4e2d\u76842\u60c5\u51b5\r\n\tmemset(dfn,0,sizeof dfn);\r\n\tmemcpy(a,w,sizeof w);\r\n\tmemset(w,0,sizeof w);\r\n\tn=bcc;\r\n\tbcc=ts=0;\r\n\tS=id[S];\r\n\tfor(int i=1;i<=n;i++)\r\n\t\tif(!dfn[i])\r\n\t\t\ttarjan(i,-1,G2);\r\n\tint root=0;\r\n\tfor(int i=1;i<=bcc;i++)\r\n\t\tif(Sz[i]>1){\r\n\t\t\troot=i;\r\n\t\t\tbreak;\r\n\t\t}\r\n\tif(!root)\r\n\t\troot=id[S];//\u8fd9\u662f\u4e00\u68f5\u6811\r\n\tG3.clear();\r\n\tfor(int i=0;i<G2.idx;i++)\r\n\t\tif(is_bridge[i])\r\n\t\t\tG3.add(id[G2.edge[i].sta],id[G2.edge[i].en]);//\u4e8c\u6b21\u7f29\u70b9\u540e\u5efa\u56fe\r\n\tdfs_ans(root,-1,0);//\u6df1\u641c\u7b54\u6848\r\n\tprintf(\"%lld\\n\",ans);\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1675240640,
        "uid": 338880,
        "name": "Aaron_wch",
        "ccfLevel": 7,
        "title": "[CF1220E]Tourism \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u5904\u5728\u540c\u4e00\u4e2a\u8fb9\u53cc\u8fde\u901a\u5206\u91cf\u91cc\u7684\u70b9\uff0c\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u5c06\u4ed6\u4eec\u90fd\u7ecf\u8fc7\uff08\u4efb\u610f\u4e24\u70b9\u95f4\u6709\u4e24\u6761\u8def\u5f84\uff09\u3002\u6240\u4ee5\u7f29\u70b9\u540e\u53d8\u6210\u4e00\u68f5\u6811\uff0c\u53ef\u4ee5 dp\u3002\n\n\u8bbe $f_u$ \u8868\u793a\u8d70\u7b2c u \u4e2a\u8282\u70b9\u8fd8\u80fd\u56de\u5934\u7684\u6700\u5927\u7b54\u6848\uff0c$g_u$ \u4e3a\u4e0d\u518d\u56de\u5934\u7684\u6700\u5927\u7b54\u6848\u3002  \n\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u8981\u5b50\u6811\u4e2d\u6709\u4e00\u4e2a\u5927\u5c0f\u5927\u4e8e\u7b49\u4e8e 3 \u7684\u8fb9\u53cc\u8fde\u901a\u5206\u91cf\uff0c\u90a3\u4e48\u8fdb\u5165\u4e86\u8fd9\u9897\u5b50\u6811\u540e\u5c31\u8fd8\u80fd\u56de\u6765\uff0c\u5426\u5219\u65e0\u8bba\u5982\u4f55\u4e5f\u56de\u4e0d\u6765\u4e86\u3002\u56e0\u4e3a\u8981\u4fdd\u8bc1\u4e0d\u8d70\u8fdb\u6b7b\u80e1\u540c\uff0c\u6240\u4ee5 $f_u=\\sum f_v$\uff0c\u5176\u4e2d $v$ \u8981\u80fd\u8d70\u56de\u5934\u8def\uff08\u5b50\u6811\u4e2d\u6709\u4e00\u4e2a\u5927\u5c0f\u5927\u4e8e\u7b49\u4e8e 3 \u7684\u8fb9\u53cc\u8fde\u901a\u5206\u91cf\uff09\u3002\n\n\u7136\u540e\u8003\u8651 $g_u$\u3002\u9996\u5148\u6211\u4eec\u80af\u5b9a\u5148\u5c06\u6240\u6709\u56de\u5934\u8def\u8d70\u5b8c\uff0c\u5728 $f_u$ \u7684\u57fa\u7840\u4e0a\u66f4\u65b0 $g_u$\uff0c\u7136\u540e\u6211\u4eec\u9009\u62e9\u4e00\u4e2a $v$\uff0c\u5982\u679c\u8bf4 $v$ \u6709\u8d70\u56de\u5934\u8def\u7684\u80fd\u529b\uff0c\u90a3 $g_u=\\max(g_u,g_v-f_v+f_u)$\uff0c\u56e0\u4e3a $f_u$ \u4e2d\u5df2\u7ecf\u5c06 $f_v$ \u7edf\u8ba1\u8fc7\uff0c\u8981\u51cf\u53bb\u3002\u5426\u5219 $g_u=\\max(g_u,f_u+g_v)$\u3002\n\n\u663e\u7136 $g_u$ \u4e0d\u52a3\u4e8e $f_u$\uff0c\u7b54\u6848\u53d6 $g$ \u5373\u53ef\u3002\n\n```\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e6 + 100;\ntypedef long long ll;\nint head[N] , nex[N] , edge[N] , cnt = 1;\nvoid add(int x , int y) {\n\tnex[++cnt] = head[x];\n\thead[x] = cnt;\n\tedge[cnt] = y;\n}\nbool vis[N] , bian[N];\nint low[N] , dfn[N] , now = 0;\nll sum[N] , scc[N] , ee;\nvoid tarjan(int u , int fa) {\n\tlow[u] = dfn[u] = ++now;\n\tfor(int i = head[u]; i ; i = nex[i]) {\n\t\tint v = edge[i];\n\t\tif(v == fa)continue;\n\t\tif(!dfn[v]) {\n\t\t\ttarjan(v , u);\n\t\t\tlow[u] = min(low[u] , low[v]);\n\t\t\tif(low[v] > dfn[u])bian[i] = bian[i ^ 1] = true;\n\t\t}else {\n\t\t\tlow[u] = min(low[u] , dfn[v]);\n\t\t}\n\t}\n}\nmap<pair<int , int> , bool>t;\nint n , m , w[N] , siz[N];\nvoid dfs(int u) {\n\tscc[u] = ee;siz[ee]++;\n\tsum[ee] += w[u];\n\tfor(int i = head[u]; i ; i = nex[i]) {\n\t\tint v = edge[i];\n\t\tif(bian[i] || scc[v])continue;\n\t\tdfs(v);\n\t}\n}\nvector<int>a[N];\nll f[N] , g[N];\nbool can[N];//\u8d70\u4e86\u8fd9\u6761\u8def\u662f\u5426\u80fd\u56de\u6765 \nint u[N] , v[N];\nvoid dfs2(int fa , int u) {\n\tf[u] = sum[u];\n\tif(siz[u] >= 3)can[u] = true;\n\t\n\tll maxx = 0;\n\tfor(auto v : a[u]) {\n\t\tif(v == fa)continue;\n\t\tdfs2(u , v);\n\t\tif(can[v])f[u] += f[v] , can[u] = true , maxx = max(maxx , g[v] - f[v]);\n\t\telse maxx = max(maxx , g[v]);\n\t}\n\tg[u] = max(maxx + f[u] , f[u]);\n//\tcout << u << ' ' << can[u]<< ' ' << f[u] << ' ' << g[u]<< endl;\n} \nint main() {\n\tscanf(\"%d%d\" , &n , &m);\n\tfor(int i = 1; i <= n; i++)\n\t\tscanf(\"%d\" , &w[i]);\n\tfor(int i = 1; i <= m; i++) {\n\t\tscanf(\"%d%d\" , &u[i] , &v[i]);\n\t\tadd(u[i] , v[i]);add(v[i] , u[i]);\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tif(!dfn[i])tarjan(i , 0);\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tif(!scc[i]) {\n\t\t\t++ee;\n\t\t\tdfs(i);\n\t\t}\n\t}\n\tfor(int i = 1; i <= m; i++) {\n\t\tif(scc[u[i]] != scc[v[i]] && t.find(make_pair(scc[u[i]] , scc[v[i]])) == t.end()) {\n\t\t\tt[make_pair(scc[u[i]] , scc[v[i]])] = true;\n\t\t\tt[make_pair(scc[v[i]] , scc[u[i]])] = true;\n\t\t\ta[scc[u[i]]].push_back(scc[v[i]]);\n\t\t\ta[scc[v[i]]].push_back(scc[u[i]]);\n\t\t}\n\t}\n\tint s;scanf(\"%d\" , &s);\n\tdfs2(0 , scc[s]);\n\tcout << g[scc[s]]  << endl;\n\treturn 0;\n}\n```\n",
        "postTime": 1665303918,
        "uid": 226148,
        "name": "Suuon_Kanderu",
        "ccfLevel": 5,
        "title": "\u8fb9\u53cc\u8fde\u901a\u5206\u91cf"
    },
    {
        "content": "\u6bd4\u8f83\u597d\u7684\u9898\u76ee\u3002\n\n\u9996\u5148\u770b\u5230\u9898\u76ee\uff0c\u5c31\u662f\u8bf4\u5982\u679c\u6709\u4e00\u4e2a\u73af\u5b58\u5728\uff0c\u90a3\u4e48\u80af\u5b9a\u662f\u80fd\u8d70\u7684\uff0c\u800c\u4e14\u6b21\u6570\u6ca1\u6709\u4ec0\u4e48\u9650\u5236\uff0c\u552f\u4e00\u9700\u8981\u533a\u522b\u7684\u5c31\u662f\u8d70\u5230\u4e00\u4e2a\u6b7b\u80e1\u540c\u91cc\u9762\u53bb\u3002\n\n\u6211\u4eec\u9700\u8981\u7684\u5c31\u662f\u53bb\u5bfb\u627e\u8fd9\u6837\u4e00\u4e2a\u6700\u4f18\u79c0\u7684\u6b7b\u80e1\u540c\uff0c\u8fd9\u6837\u6211\u4eec\u7684\u7b56\u7565\u5c31\u662f\u628a\u5176\u4ed6\u7684\u70b9\u90fd\u8d70\u4e00\u904d\uff0c\u7136\u540e\u76f4\u63a5\u649e\u8fdb\u6b7b\u80e1\u540c\u91cc\u9762\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u8fd9\u662f\u6700\u4f18\u7684\uff0c\u56e0\u4e3a\u8d70\u5176\u4ed6\u6b7b\u80e1\u540c\u6ca1\u6709\u5b83\u4f18\u79c0\u3002\n\n\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\uff0c\u7ed9\u5b9a\u4e00\u5f20\u56fe\uff0c\u7136\u540e\u600e\u4e48\u6c42\u6700\u957f\u7684\u6b7b\u80e1\u540c\uff0c\u4ee5\u53ca\u600e\u4e48\u5224\u65ad\u4e00\u4e2a\u70b9\u662f\u5426\u4e0d\u5728\u6b7b\u80e1\u540c\u91cc\u9762\u3002\n\n\u6b7b\u80e1\u540c\u6240\u957f\u7684\u6837\u5b50\u5e94\u8be5\u662f\u4e00\u4e2a\u7aef\u70b9\u5ef6\u4f38\u4e0a\u53bb\u7684\u4e00\u6761\u94fe\u3002\n\n\u56e0\u6b64\u6211\u4eec\u5148\u628a\u5165\u5ea6\u4e3a $1$ \u7684\u70b9\u6254\u8fdb\u53bb\uff0c\u7136\u540e\u518d\u628a\u5176\u4ed6\u5165\u5ea6\u4e3a $1$ \u7684\u6254\u8fdb\u53bb\uff0c\u5982\u679c\u51fa\u73b0\u4e00\u4e2a\u70b9\u7684\u5ea6\u4e0d\u4e3a $1$\uff0c\u5219\u5b83\u4e00\u5b9a\u662f\u6709\u4e00\u4e2a\u53e6\u5916\u7684\u73af\u5305\u542b\u7684\uff0c\u56e0\u4e3a\u9898\u76ee\u4e2d\u5df2\u7ecf\u4fdd\u8bc1\u8fde\u901a\u3002\n\n\u6240\u4ee5\u6240\u8981\u5bfb\u627e\u7684\u5373\u4e3a\u4e00\u4e2a\u7aef\u70b9\u548c\u4e00\u4e2a\u4e00\u4e2a\u70b9\u62fc\u51fa\u6765\u7684\u6700\u957f\u94fe\uff0c\u53ef\u4ee5\u62d3\u6251\u6392\u5e8f\u53bb\u5bfb\u627e\u3002\n\n\u540c\u65f6\u8fd9\u91cc\u6ce8\u610f\u4e0d\u80fd\u6765\u56de\u62d3\u6251\u6392\u5e8f\uff0c\u6240\u4ee5\u5728\u4e00\u4e2a\u70b9\u88ab\u66f4\u65b0\u4e4b\u540e\u5c31\u6807\u8bb0\u6389\u5b83\u5373\u53ef\u3002\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u8d77\u70b9\u662f\u4e0d\u80fd\u4f5c\u4e3a\u6b7b\u80e1\u540c\u7684\u4e00\u90e8\u5206\uff0c\u5982\u679c\u4f5c\u4e3a\u4e00\u90e8\u5206\u7684\u8bdd\u5c31\u8d70\u4e0d\u4e86\u4e86\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <queue> \n#define int long long \nusing namespace std;\nconst int INF=2e5+5;\nstruct _node_edge{\n\tint to_,next_;\n}edge[INF<<1];\nint n,m,tot,head[INF],in[INF],a[INF],vis[INF],F[INF],f[INF];\nvoid add_edge(int x,int y) {\n\tedge[++tot]=(_node_edge){y,head[x]};\n\thead[x]=tot;return ;\n}\nqueue <int> q;\nsigned main()\n{\n\tios::sync_with_stdio(false);\n\tcin>>n>>m;tot=1;\n\tfor (int i=1;i<=n;i++) cin>>a[i];\n\tfor (int i=1;i<=m;i++) {\n\t\tint x=0,y=0;cin>>x>>y;\n\t\tadd_edge(x,y);add_edge(y,x);\n\t\tin[y]++;in[x]++;\n\t}\n\tif (n==1) {\n\t\tcout<<a[1]<<\"\\n\";\n\t\treturn 0;\n\t}\n\tint s=0;\n\tcin>>s;\n\tfor (int i=1;i<=n;i++) {\n\t\tif (i!=s && in[i]==1) {\n\t\t\tq.push(i);f[i]=a[i];\n\t\t}\n\t}\n\t// \u76f8\u5f53\u4e8e\u4f60\u8981\u6c42\u4e00\u6761\u6bd4\u8f83\u957f\u7684\u94fe \n\twhile (q.size()) {\n\t\tint x=q.front();q.pop();in[x]=0;\n\t\tfor (int i=head[x];i;i=edge[i].next_) {\n\t\t\tint v=edge[i].to_;\n\t\t\tif (v==s) continue;\n\t\t\tif (!in[v]) continue;\n\t\t\tf[v]=max(f[v],f[x]+a[v]);\n\t\t\tif (--in[v]==1) q.push(v);\n\t\t}\n\t}\n\tint res=0,sum=0;\n\tfor (int i=1;i<=n;i++) {\n\t\tif (in[i]>0) res+=a[i];\n\t\telse sum=max(sum,f[i]);\n//\t\tcout<<in[i]<<\" \"<<f[i]<<\" ???\\n\";\n\t}\n\tcout<<res+sum<<\"\\n\";\n\treturn 0;\n}\n```\n",
        "postTime": 1662028289,
        "uid": 208653,
        "name": "_edge_",
        "ccfLevel": 0,
        "title": "CF1220E"
    },
    {
        "content": "## CF1220E 2200\r\n\r\n### \u9898\u76ee\u63cf\u8ff0\r\n\r\n\u6709 $n$ \u4e2a\u70b9\uff0c $m$ \u6761\u8fb9\u7684\u7b80\u5355\u65e0\u5411\u56fe\u3002\u6bcf\u4e2a\u70b9\u6709\u4e00\u4e2a\u6743\u503c $w_i$\u3002\u4e00\u4e2a\u4eba\u4ece $s$ \u51fa\u53d1\uff0c\u53ef\u4ee5\u8d70\u4e00\u6761\u4e0d\u8d70\u56de\u5934\u8def\u7684\u8def\u5f84\u3002\uff08\u4e5f\u5c31\u662f\u4e0d\u80fd\u7ecf\u8fc7\u4e00\u6761\u8fb9\u7acb\u523b\u53cd\u7740\u8d70\uff0c\u4f46\u662f\u5141\u8bb8\u91cd\u590d\u7ecf\u8fc7\u8fb9\uff09\u3002\u6c42\u6700\u5927\u7684\u6743\u503c\u548c\u3002\r\n\r\n$ 1 \\le n \\le 2 \\cdot 10^5 $ , $ 0 \\le m \\le 2 \\cdot 10^5 $\r\n\r\n\r\n\r\n### \u601d\u8def\r\n\r\n\u663e\u7136\u53ef\u4ee5\u628a\u56fe\u4e2d\u95f4\u5f88\u591a\u8fde\u8d77\u6765\u7684\u73af\u770b\u505a\u662f\u4e00\u4e2a\u70b9\uff08\u5982\u679c\u8d70\u5230\u4e86\u8fd9\u4e2a\u70b9\u90a3\u4e48\u4e00\u5b9a\u4f1a\u4e5f\u4e00\u5b9a\u80fd\u628a\u8fd9\u4e2a\u70b9\u4ee3\u8868\u7684\u70b9\u90fd\u8d70\u4e00\u904d\uff09\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a\u70b9\u8fde\u51fa\u53bb\u4e86\u4e00\u4e9b\u6811\u3002\r\n\r\n1. \u5982\u679c $s$ \u5728\u4e2d\u95f4\u7684\u8fd9\u4e2a\u70b9\u4e0a\uff0c\u90a3\u4e48\u6700\u4f18\u7684\u4e00\u5b9a\u662f\u4ece\u8fd9\u4e2a\u70b9\u8d70\u5230\u4e00\u68f5\u6811\u4e0a\uff0c\u7136\u540e\u4e00\u76f4\u8d70\u5230\u4e00\u4e2a\u53f6\u5b50\u7ed3\u70b9\u4e0d\u56de\u5934\u3002\r\n\r\n2. \u5982\u679c $s$ \u4e0d\u5728\u4e2d\u95f4\u7684\u8fd9\u4e2a\u70b9\u4e0a\uff0c\u90a3\u4e48\u6700\u4f18\u7684\u4e00\u5b9a\u662f\u4ece $s$ \u8d70\u5230\u4e2d\u95f4\u7684\u90a3\u4e2a\u70b9\u4e0a\uff0c\u7136\u540e\u8d70\u5230\u53e6\u4e00\u68f5\u6811\u4e0a\u4e0d\u56de\u5934 \u6216\u8005 \u518d\u8d70\u56de\u8fd9\u68f5\u6811\u4e0a\u4e0d\u56de\u5934\uff08\u5982\u679c\u9009\u62e9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6ce8\u610f\u4e0d\u8981\u91cd\u590d\u8ba1\u7b97\u4ece $s$ \u8d70\u5230\u4e2d\u95f4\u7684\u90a3\u4e2a\u70b9\u4e0a\u7684\u8fd9\u6761\u8def\u5f84\uff09\u3002\r\n\r\n3. \u6ce8\u610f\u7279\u5224\u4e00\u4e0b\u4e00\u4e2a\u73af\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u3002\r\n\r\n\r\n\r\n### \u4ee3\u7801\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define int long long\r\nusing namespace std;\r\nconst int MAXN=2e5+10;\r\nint n,m,val[MAXN],cnt[MAXN],u,v,ans,s,maxa,flags,tmp,fa[MAXN];\r\nbool book[MAXN],flag,vis[MAXN],tflag,pa[MAXN];\r\nvector<int> a[MAXN],b[MAXN];\r\nqueue<int> q;\r\nint dfs1(int x,int f,int tt)\r\n{\r\n\tif(x==s)  flags=v;\r\n\tif(tt&&x==s)  return val[x];\r\n\tint maxx=val[x];\r\n\tfor(int i=0;i<a[x].size();i++)\r\n\t{\r\n\t\tif(a[x][i]==f||!book[a[x][i]])  continue;\r\n\t\tfa[a[x][i]]=x;\r\n\t\tmaxx=max(maxx,dfs1(a[x][i],x,tt)+val[x]);\r\n\t}\r\n\treturn maxx;\r\n}\r\nvoid dfs2(int x)\r\n{\r\n\tpa[x]=1;\r\n\tif(x==flags)  return;\r\n\tdfs2(fa[x]);\r\n}\r\nint dfs3(int x,int f)\r\n{\r\n\tint maxx=0;\r\n\tif(!pa[x])  maxx=val[x];\r\n\tfor(int i=0;i<a[x].size();i++)\r\n\t{\r\n\t\tif(a[x][i]==f||!book[a[x][i]])  continue;\r\n\t\tfa[a[x][i]]=x;\r\n\t\tif(!pa[x])  maxx=max(maxx,dfs3(a[x][i],x)+val[x]);\r\n\t\telse  maxx=max(maxx,dfs3(a[x][i],x));\r\n\t}\r\n\treturn maxx;\r\n}\r\nint dfs4(int x,int f)\r\n{\r\n\tif(pa[x])  return 0;\r\n\tint maxx=val[x];\r\n\tfor(int i=0;i<a[x].size();i++)\r\n\t{\r\n\t\tif(a[x][i]==f||!book[a[x][i]])  continue;\r\n\t\tfa[a[x][i]]=x;\r\n\t\tmaxx=max(maxx,dfs4(a[x][i],x)+val[x]);\r\n\t}\r\n\treturn maxx;\r\n}\r\nsigned main()\r\n{\r\n\tscanf(\"%lld%lld\",&n,&m);\r\n\tfor(int i=1;i<=n;i++)  scanf(\"%lld\",&val[i]);\r\n\tfor(int i=1;i<=m;i++)\r\n\t{\r\n\t\tscanf(\"%lld%lld\",&u,&v);\r\n\t\ta[u].push_back(v);\r\n\t\ta[v].push_back(u);\r\n\t\tcnt[u]++;\r\n\t\tcnt[v]++;\r\n\t}\r\n\tscanf(\"%lld\",&s);\r\n\tfor(int i=1;i<=n;i++)\r\n\t{\r\n\t\tif(cnt[i]==1)  q.push(i);\r\n\t}\r\n\twhile(q.size())\r\n\t{\r\n\t\tv=q.front();\r\n\t\tq.pop();\r\n\t\tif(book[v])  continue;\r\n\t\tbook[v]=1;\r\n\t\tflag=0;\r\n\t\tfor(int i=0;i<a[v].size();i++)\r\n\t\t{\r\n\t\t\tcnt[a[v][i]]--;\r\n\t\t\tif(cnt[a[v][i]]==1)\r\n\t\t\t{\r\n\t\t\t\tflag=1;\r\n\t\t\t\tq.push(a[v][i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!flag)\r\n\t\t{\r\n\t\t\ttmp=dfs1(v,0,0);\r\n\t\t\tif(flags!=v)  maxa=max(maxa,tmp);\r\n\t\t}\r\n\t}\r\n\tfor(int i=1;i<=n;i++)\r\n\t{\r\n\t\tif(!book[i])\r\n\t\t{\r\n\t\t\ttflag=1;\r\n\t\t\tans+=val[i];\r\n\t\t}\r\n\t}\r\n\tdfs2(s);\r\n\tint tmps=s;\r\n\tint sum=val[s];\r\n\twhile(tmps!=flags)\r\n\t{\r\n\t\ttmps=fa[tmps];\r\n\t\tsum+=val[tmps];\r\n\t}\r\n\tif(!tflag)\r\n\t{\r\n\t\tint tmpp=dfs4(flags,0);\r\n\t\tans=max(sum+tmpp,dfs1(s,0,0));\r\n\t\tprintf(\"%lld\\n\",ans);\r\n\t\treturn 0;\r\n\t}\r\n\tif(book[s])  ans+=sum+max(maxa,dfs3(flags,0));\r\n\telse  ans+=maxa;\r\n\tprintf(\"%lld\",ans);\r\n\treturn 0;\r\n}\r\n```\r\n",
        "postTime": 1663911229,
        "uid": 457247,
        "name": "zsyyyy",
        "ccfLevel": 6,
        "title": "CF1220E\u9898\u89e3"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u6709\u4e00\u5f20 $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe ($m, n\\le 2\\times 10^5$) \uff0c\u4ece\u4e00\u4e2a\u8d77\u70b9\u51fa\u53d1\uff0c\u4e0d\u80fd\u8fde\u7eed\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\uff0c\u95ee\u6700\u5927\u7684\u70b9\u6743\u548c\u662f\u591a\u5c11\u3002\n\n## \u9898\u89e3\n\n\u73af\u4e0a\u6bcf\u4e00\u4e2a\u70b9\u90fd\u53ef\u4ee5\u904d\u5386\u4e00\u904d\uff0c\u8fde\u63a5\u73af\u4e4b\u95f4\u7684\u70b9\u4e5f\u662f\uff1b\u5982\u679c\u8d77\u70b9\u4e0d\u5728\u8fd9\u4e9b\u70b9\u4e0a\uff0c\u90a3\u4e48\u4ece\u8d77\u70b9\u5230\u73af\u4e0a\u7684\u6240\u6709\u70b9\u4e5f\u80fd\u88ab\u904d\u5386\uff0c\u4f46\u8d77\u70b9\u5230\u5176\u4ed6\u8fde\u63a5\u73af\u4e0a\u5219\u4e0d\u80fd\uff08\u5982\u679c\u53bb\u4e86\u56de\u6765\u5fc5\u987b\u8fde\u7eed\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\uff09\u3002\n\n\u5269\u4e0b\u7684\u4e0e\u73af\u76f8\u8fde\u7684\u8def\u5f84\u53ea\u80fd\u9009\u62e9\u4e00\u6761\u70b9\u6743\u603b\u548c\u6700\u5927\u7684\uff0c\u8003\u8651\u62d3\u6251\u5e8f\u4e0aDP\uff0c\u7528  $f[i]$ \u8868\u793a\u672b\u68a2\u5230 $i$ \u70b9\u6743\u503c\u548c\u7684\u6700\u5927\u503c\uff0c\u6240\u6709\u73af\u4e0a\u7684\u70b9\u4e2d\u53d6 $f[i]$ \u7684\u6700\u5927\u503c\u5373\u662f\u6700\u4f18\u7684\u8def\u5f84\u3002\u81f3\u4e8e\u62d3\u6251\u5e8f\uff0c\u8dd1\u4e00\u8fb9\u62d3\u6251\u6392\u5e8f\u5373\u53ef\u3002\n\n\u7b54\u6848\u5373\u4e3a\u8d77\u70b9\u5230\u73af\u7ecf\u8fc7\u7684\u70b9+\u73af\u4e0a\u7684\u70b9\u7684\u70b9\u6743\u548c + $\\max(f[i])$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n\nusing namespace std;\n\nconst int N = 2e5 + 10;\n\nstruct S{\n\tint to, nxt;\n}a[N];\nint head[N], tot;\n\nvoid add(int u, int v){\n\ta[++tot].nxt = head[u];\n\ta[tot].to = v;\n\thead[u] = tot;\n}\n\nint n, m, in[N];\nint s[N], f[N];\n\nvoid topo(){\n\tqueue<int> q;\n\tint qd;\n\tcin >> qd;\n\tif(n == 1){\n\t\tcout << s[1];\n\t\treturn ;\n\t}\n\tfor(int i = 1; i <= n; i++){\n\t\tif(i == qd || in[i] != 1) continue;\n\t\tq.push(i);\n\t}\n\twhile(!q.empty()){\n\t\tint x = q.front();\n\t\tq.pop();\n\t\tin[x] = 0;\n\t\tfor(int i = head[x]; i; i = a[i].nxt){\n\t\t\tint v = a[i].to;\n\t\t\tif(!in[v]) continue;\n\t\t\tf[v] = max(f[x] + s[x], f[v]);\n\t\t\tif(v == qd) continue;\n\t\t\tin[v]--;\n\t\t\tif(in[v] == 1){\n\t\t\t\tq.push(v);\n\t\t\t}\n\t\t}\n\t}\n\tint ans = 0, num = 0;\n\tfor(int i = 1; i <= n; i++){\n\t\tif(!in[i]) continue;\n\t\tnum += s[i];\n\t\tans = max(ans, f[i]);\n\t}\n\tcout << ans + num;\n}\n\nsigned main(){\n\tcin >> n >> m;\n\tfor(int i = 1; i <= n; i++){\n\t\tcin >> s[i];\n\t}\n\tfor(int i = 1; i <= m; i++){\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\tadd(u, v);\n\t\tadd(v, u);\n\t\tin[u]++;\n\t\tin[v]++;\n\t}\n\ttopo();\n\treturn 0;\n}\n```",
        "postTime": 1648371022,
        "uid": 408759,
        "name": "ollo",
        "ccfLevel": 6,
        "title": "CF1220E"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://llf0703.com/p/cf-1220.html#etourism)\n\n## \u9898\u610f\n\n\u6709\u4e00\u4e2a $n(n\\le 2\\times 10^5)$ \u70b9 $m(m\\le 2\\times 10^5)$ \u8fb9\u7684\u65e0\u91cd\u8fb9\u65e0\u81ea\u73af\u7684\u65e0\u5411\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e2a\u70b9\u6743\u3002\u4ece $1$ \u51fa\u53d1\uff0c\u4e0d\u80fd\u8fde\u7eed\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\uff0c\u95ee\u8def\u5f84\u4e0a\u70b9\u6743\u548c\u7684\u6700\u5927\u503c\u662f\u591a\u5c11\u3002\n\n## \u9898\u89e3\n\n\u73af\u4e0a\u6bcf\u4e00\u4e2a\u70b9\u90fd\u53ef\u4ee5\u904d\u5386\u4e00\u904d\uff0c\u8fde\u63a5\u73af\u4e4b\u95f4\u7684\u70b9\u4e5f\u662f\uff1b\u5982\u679c\u8d77\u70b9\u4e0d\u5728\u8fd9\u4e9b\u70b9\u4e0a\uff0c\u90a3\u4e48\u8fd9\u6761\u8fb9\u5230\u73af\u4e0a\u7684\u6240\u6709\u70b9\u4e5f\u80fd\u88ab\u904d\u5386\uff0c\u4f46\u8d77\u70b9\u5230\u672b\u68a2\u7684\u8def\u5f84\u4e0a\u5219\u4e0d\u80fd\uff08\u5230\u672b\u68a2\u518d\u56de\u6765\u5c31\u4f1a\u8fde\u7eed\u7ecf\u8fc7\u672b\u7aef\u7684\u8fb9\uff09\u3002\n\n\u5269\u4e0b\u7684\u4e0e\u73af\u76f8\u8fde\u7684\u8def\u5f84\u53ea\u80fd\u9009\u62e9\u4e00\u6761\uff0c\u53ef\u4ee5\u62d3\u6251\u6392\u5e8fDP\uff0c\u7528 $f[i]$ \u8868\u793a\u672b\u68a2\u5230 $i$ \u70b9\u6743\u503c\u548c\u7684\u6700\u5927\u503c\uff0c\u6240\u6709\u73af\u4e0a\u7684\u70b9\u4e2d\u53d6 $f[i]$ \u7684\u6700\u5927\u503c\u5373\u662f\u6700\u4f18\u7684\u8def\u5f84\u3002\n\n\u7b54\u6848\u5373\u4e3a\u6240\u6709\u6ca1\u88ab\u62d3\u6251\u7684\u70b9\u7684\u70b9\u6743\u548c $+ \\max(f[i])$ \u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n\nusing namespace std;\n\ninline ll read()\n{\n    char ch=getchar(); ll f=1,x=0;\n    while (ch<'0' || ch>'9') { if (ch=='-') f=-1; ch=getchar(); }\n    while (ch>='0' && ch<='9') { x=x*10+ch-'0'; ch=getchar(); }\n    return f*x;\n}\n\nconst ll N=200005;\nstruct Edge {\n    ll next,to;\n} edge[N<<1];\nqueue <ll> q;\nll cnt,head[N],n,m,a,b,st,s[N],deg[N],f[N];\n\ninline void add(ll u,ll v)\n{\n    edge[++cnt].to=v;\n    edge[cnt].next=head[u];\n    head[u]=cnt;\n}\n\nsigned main()\n{\n    n=read(); m=read();\n    for (ll i=1;i<=n;i++) s[i]=read();\n    for (ll i=1;i<=m;i++)\n    {\n        a=read(); b=read();\n        add(a,b); add(b,a);\n        deg[a]++; deg[b]++;\n    }\n    st=read();\n    if (n==1) return !printf(\"%lld\",s[1]);\n    for (ll i=1;i<=n;i++)\n    {\n        if (i==st || deg[i]!=1) continue;\n        q.emplace(i);\n    }\n    while (!q.empty()) //\u62d3\u6251\u6392\u5e8f\n    {\n        ll x=q.front(); q.pop();\n        deg[x]=0;\n        for (ll i=head[x];i;i=edge[i].next)\n        {\n            ll y=edge[i].to;\n            if (!deg[y]) continue;\n            f[y]=max(f[y],f[x]+s[x]);\n            if (y==st) continue; //\u9047\u5230\u8d77\u70b9\u5219\u4e0d\u7ee7\u7eed\n            deg[y]--;\n            if (deg[y]==1) q.emplace(y);\n        }\n    }\n    ll ans=0,maxf=0;\n    for (ll i=1;i<=n;i++)\n    {\n        if (!deg[i]) continue;\n        ans+=s[i];\n        maxf=max(maxf,f[i]);\n    }\n    return !printf(\"%lld\",ans+maxf);\n}\n```",
        "postTime": 1569322391,
        "uid": 29696,
        "name": "Llf0703",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1220E \u3010Tourism\u3011"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](http://codeforces.com/contest/1220/problem/E)\n\n\u53ef\u80fd\u662f\u4e2a\u597d\u9898\uff0c\u4f46\u66f4\u591a\u7684\uff0c\u662f\u4e2a\u5199\u8d77\u6765\u8d39\u52b2\u7684\u9898\u3002\n\n## \u9898\u76ee\u53d9\u8ff0\n\n\u6709\u4e00\u4e2a \u65e0\u91cd\u8fb9\u65e0\u81ea\u73af\u7684\u65e0\u5411\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e2a\u70b9\u6743\u3002\u4ece\u4e00\u4e2a\u6307\u5b9a\u70b9\u51fa\u53d1\uff0c\u4e0d\u80fd\u8fde\u7eed\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\uff0c\u95ee\u8def\u5f84\u4e0a\u70b9\u6743\u548c\u7684\u6700\u5927\u503c\u662f\u591a\u5c11\u3002\n\n## \u9898\u89e3\n\n### Solution 1\n\n\u5f00\u59cb\u6211\u7406\u89e3\u9898\u7684\u610f\u601d\u662f\u4e00\u6761\u8fb9\u53ea\u80fd\u8d70\u4e00\u904d\u3002\u5982\u679c\u8fd9\u6837\u7406\u89e3\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7f29\u70b9\u53cc\uff0c\u4e00\u4e2a\u5272\u8fb9\u8d70\u8fdb\u53bb\u5c31\u8d70\u4e0d\u51fa\u6765\u4e86\uff0c\u6240\u4ee5\u5c31\u662f\u4ece\u8d77\u70b9\u8d70\u4e00\u6761\u6700\u957f\u94fe\u3002\n\n\u4f46\u662f\u6309\u7167\u6b63\u786e\u7684\u7406\u89e3\uff0c\u5e94\u8be5\u662f\u4e0d\u80fd\u7acb\u523b\u91cd\u590d\u8d70\u540c\u4e00\u6761\u8fb9\u3002\u90a3\u4e48\u8d70\u5230\u4e00\u4e2a\u70b9\u53cc\uff08\u5927\u5c0f\u5927\u4e8e1\u7684\uff09\u90a3\u4e48\u5c31\u53ef\u4ee5\u8d70\u56de\u90a3\u4e00\u6761\u5272\u8fb9\u3002\u6240\u4ee5\u5c31\u6811\u578b```dp```\uff0c\u8bbe$f_{i}$\u8868\u793a\u4ece$i$\u5f00\u59cb\u8d70\u4e0d\u56de\u6765\u7684\u6700\u5927\u4ef7\u503c\uff0c$g_i$\u8868\u793a\u4ece$i$\u5f00\u59cb\u8d70\u56de\u6765\u7684\u6700\u5927\u4ef7\u503c\uff0c\u8f6c\u79fb\u5373\u53ef\u3002\n\n### Solution 2\n\n\u8003\u8651\u5230\u6700\u4f73\u8d70\u6cd5\u662f\u4ece\u8d77\u70b9\u7ed5\u5b8c\u6240\u6709\u7684\u73af\u56de\u6765\u7136\u540e\u518d\u8d70\u4e00\u4e2a\u6700\u957f\u94fe\u3002\u6240\u4ee5\u8003\u8651\u627e\u51fa\u6240\u6709\u4e0d\u662f\u53f6\u5b50\u8282\u70b9\u7684\u7136\u540e\u628a\u6240\u6709\u5728\u73af\u4e0a\u7684\u6743\u503c\u52a0\u8d77\u6765\uff0c\u518d\u627e\u8ddd\u79bb\u53f6\u5b50\u8282\u70b9\u5230\u73af\u7684\u6700\u957f\u94fe\u3002\u6574\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u901a\u8fc7\u62d3\u6251\u6392\u5e8f\u5b9e\u73b0\u3002\n\n## \u77e5\u8bc6\u70b9\n\n+ \u770b\u8fd9\u79cd\u4e0d\u80fd\u91cd\u590d\u8d70\u4e00\u6761\u8fb9\u7c7b\u4f3c\u7684\u4e1c\u897f\u53ef\u4ee5\u8003\u8651\u7f29\u8fb9\u53cc\uff08\u56e0\u4e3a\u5272\u8fb9\u4e00\u53bb\u4e0d\u590d\u8fd4\n\n## \u4ee3\u7801\n\u6ce8\u610f\uff1a\n+ \u8fd9\u91cc\u653e\u7f6e\u4e00\u4e2a\u6211\u5e76\u6ca1\u6709\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u5c31\u662f[\u8fd9\u4efd\u63d0\u4ea4\u8bb0\u5f55](http://codeforces.com/contest/1220/submission/71074113)\u4e3a\u5565\u8fc7\u4e0d\u4e86qwq\u3002\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\nusing namespace std;\ntypedef long long ll;\ntemplate <const int maxNode, const int maxEdge> struct Graph {\n\tint head[maxNode], to[maxEdge], nxt[maxEdge], Elen;\n\tGraph() : Elen(0) { memset(head, -1, sizeof(head)); }\n\tvoid AddEdge(int from, int _to) {\n\t\tto[++Elen] = _to;\n\t\tnxt[Elen] = head[from];\n\t\thead[from] = Elen;\n\t}\n};\ntemplate <const int maxNode> struct dsu {\n\tint fa[maxNode];\n\tvoid Init(int nbNode) {\n\t\tfor (int node = 1; node <= nbNode; ++node) fa[node] = node;\n\t}\n\tint Get(int now) { return (fa[now] == now) ? now : (fa[now] = Get(fa[now])); }\n\tvoid Merge(int un, int vn) {\n\t\tun = Get(un), vn = Get(vn);\n\t\tif (un == vn) return ;\n\t\tfa[un] = vn;\n\t}\n};\nconst int maxNode = 2e5 + 5, maxEdge = 2e5 + 5;\ndsu<maxNode> set;\nGraph<maxNode, maxEdge << 1> graph;\nGraph<maxNode, maxNode << 1> tree;\nint nbNode, nbEdge, startNode, dfstime, val[maxNode], dfn[maxNode], low[maxNode], size[maxNode];\nll go[maxNode], back[maxNode], sum[maxNode];\nbool cut[maxEdge << 1], canBack[maxNode];\nvoid Dfs(int now, int from) {\n\tlow[now] = dfn[now] = ++dfstime;\n\tfor (int pt = graph.head[now]; ~pt; pt = graph.nxt[pt]) {\n\t\tint to = graph.to[pt];\n\t\tif (to == from) continue ;\n\t\t\n\t\tif (dfn[to])\n\t\t\tlow[now] = min(low[now], dfn[to]);\n\t\telse {\n\t\t\tDfs(to, now);\n\t\t\tlow[now] = min(low[now], low[to]);\n\t\t}\n\t\tif (low[to] > dfn[now]) cut[pt] = 1;\n\t\telse set.Merge(to, now);\n\t}\n}\nvoid Dp(int now, int from) {\n\tif (size[now] >= 2)\n\t\tcanBack[now] = 1;\n\tfor (int pt = tree.head[now]; ~pt; pt = tree.nxt[pt]) {\n\t\tint to = tree.to[pt];\n\t\tif (to != from) {\n\t\t\tDp(to, now);\n\t\t\tcanBack[now] |= canBack[to];\n\t\t\tback[now] += back[to];\n\t\t}\n\t}\n\tfor (int pt = tree.head[now]; ~pt; pt = tree.nxt[pt]) {\n\t\tint to = tree.to[pt];\n\t\tif (to != from)\n\t\t\tgo[now] = max(go[now], back[now] - back[to] + go[to]);\n\t}\n\tgo[now] += sum[now];\n\tif (canBack[now])\n\t\tback[now] += sum[now];\n}\nint main() {\n\tscanf(\"%d%d\", &nbNode, &nbEdge);\n\tfor (int node = 1; node <= nbNode; ++node)\n\t\tscanf(\"%d\", &val[node]);\n\tset.Init(nbNode);\n\tfor (int edge = 1; edge <= nbEdge; ++edge) {\n\t\tint node1, node2;\n\t\tscanf(\"%d%d\", &node1, &node2);\n\t\tgraph.AddEdge(node1, node2);\n\t\tgraph.AddEdge(node2, node1);\n\t}\n\tscanf(\"%d\", &startNode);\n\tDfs(1, 0);\n\tfor (int node = 1; node <= nbNode; ++node) {\n\t\tsum[set.Get(node)] += val[node];\n\t\tsize[set.Get(node)] += 1; \n\t\tfor (int pt = graph.head[node]; ~pt; pt = graph.nxt[pt]) {\n\t\t\tif (!cut[pt]) continue ;\n\t\t\ttree.AddEdge(set.Get(node), set.Get(graph.to[pt]));\n\t\t\ttree.AddEdge(set.Get(graph.to[pt]), set.Get(node));\n\t\t}\n\t}\n\tint root = set.Get(startNode);\n\tDp(root, 0);\n\tprintf(\"%lld\\n\", max(go[root], back[root]));\n\treturn 0;\n}\n```",
        "postTime": 1581749534,
        "uid": 75715,
        "name": "KokiNiwa",
        "ccfLevel": 0,
        "title": "E - Tourism \uff08\u5272\u8fb9\uff09"
    },
    {
        "content": "# \u7f29\u70b9 + \u6811DP\n\n## \u9898\u610f: \n- \u6709\u4e00\u4e2a$n(n\\le 2\\times 10^5)$\u70b9$m(m\\le 2\\times 10^5)$ \u8fb9\u7684\u65e0\u91cd\u8fb9\u65e0\u81ea\u73af\u7684\u65e0\u5411\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e2a\u70b9\u6743\u3002\u4ece 1 \u51fa\u53d1\uff0c\u4e0d\u80fd\u8fde\u7eed\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\uff0c\u95ee\u8def\u5f84\u4e0a\u70b9\u6743\u548c\u7684\u6700\u5927\u503c\u662f\u591a\u5c11\u3002(\u6284\u697c\u4e0a)\n\n### \u6570\u636e\u8303\u56f4: rt\n\n### **Tutorial:**\n \u5982\u679c\u9047\u5230\u4e86\u73af, \u6211\u4eec\u4e00\u5b9a\u53ef\u4ee5\u628a\u5b83\u7b97\u5230\u8d21\u732e\u91cc\u9762(\u8d70\u4e00\u5708\u518d\u51fa\u6765), \u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u7f29\u70b9....\n \u7f29\u70b9\u4ee5\u540e\u5f97\u5230\u82e5\u5e72\u6811, \u6211\u4eec\u53ea\u5173\u5fc3\u5305\u542b\u8d77\u70b9\u7684\u90a3\u9897, \u7136\u540e\u5c31\u662f\u6109\u5feb\u7684\u6811\u5f62dp\u4e86\n $f[cur]$\u4ee3\u8868\u8d70\u5230cur\u5b50\u6811\u8fd8\u80fd\u56de\u7684\u8d21\u732e\n $g[cur]$\u4ee3\u8868\u8d70\u5230cur\u5b50\u6811\u56de\u4e0d\u6765\u7684\u8d21\u732e\n\u76ee\u6807:$g[s]$\n\u5148\u8003\u8651$f$\u7684\u8f6c\u79fb, \u5982\u679c\u5b50\u8282\u70b9\u80fd\u56de\u6765:$f[cur]+=f[to]$\n\u7136\u540e$g[cur] = max(g[to]) + f[cur]$\u8d70\u5b8c\u6240\u6709\u53ef\u4ee5\u8fd4\u56de\u7684\u513f\u5b50\u518d\u627e\u4e2a\u6700\u5927\u7684\u4e0d\u80fd\u8fd4\u56de\u7684\n...\n\n\u4f60\u4ee5\u4e3a\u5b8c\u4e86\u5417,\n\n\u8fd9\u6837\u6709\u4e00\u4e2a\u95ee\u9898, \u5982\u679c$f[cur] < g[cur]$ - \u7ed3\u70b9cur\u662f\u5426\u8981\u8fd4\u56de\n\n\n\u4e8e\u662f\u518d :\n$g[cur] = max(g[cur], f[cur] - f[to] + g[to]);$\n\n\n```cpp\n#include <bits/stdc++.h>\n#include <bits/extc++.h>\n\nusing namespace std;\n#define _rep(n, a, b) for (ll n = (a); n <= (b); ++n)\n#define _rev(n, a, b) for (ll n = (a); n >= (b); --n)\n#define _for(n, a, b) for (ll n = (a); n < (b); ++n)\n#define _rof(n, a, b) for (ll n = (a); n > (b); --n)\n#define oo 0x3f3f3f3f3f3f\n#define ll long long\n#define db double\n#define eps 1e-8\n#define bin(x) cout << bitset<10>(x) << endl;\n#define what_is(x) cerr << #x << \" is \" << x << endl\n#define met(a, b) memset(a, b, sizeof(a))\n#define all(x) x.begin(), x.end()\n#define pii pair<ll, ll>\nconst ll mod = 1e9 + 7;\nconst ll maxn = 4e5 + 5;\nstruct node\n{\n\tll nxt, to;\n} way[maxn];\nll cnt, head[maxn], dfn[maxn], tim, low[maxn], val[maxn], st[maxn], top, node_num, bel[maxn], w[maxn], sz[maxn];\nvoid addedge(ll from, ll to)\n{\n\tway[++cnt].to = to;\n\tway[cnt].nxt = head[from];\n\thead[from] = cnt;\n}\nll n, m;\nstruct edge {\n\tll from, to;\n\tedge(ll _from = 0, ll _to = 0):from(_from), to(_to){}\n\tbool operator <(const edge& a) {\n\t\treturn from == a.from ? to < a.to : from < a.from;\n\t}\n\tbool operator ==(const edge& a) {\n\t\treturn from == a.from && to == a.to;\n\t}\n};\nvector<ll> G[maxn];\nvector<edge> tmp;\nvoid tarjan(ll cur, ll fa)\n{ \n\tdfn[cur] = low[cur] = ++tim;\n\tst[++top] = cur;\n\tfor (ll i = head[cur]; i; i = way[i].nxt)\n\t{\n\t\tll to = way[i].to;\n\t\tif (to == fa)\n\t\t\tcontinue;\n\t\tif (!dfn[to])\n\t\t{\n\t\t\ttarjan(to, cur);\n\t\t\tlow[cur] = min(low[cur], low[to]);\n\t\t}\n\t\telse if (!bel[to])\n\t\t\tlow[cur] = min(low[cur], dfn[to]);\n\t}\n\tif (dfn[cur] != low[cur])return;\n\tnode_num++;\n\twhile (st[top] != cur) bel[st[top--]] = node_num;\n\tbel[st[top--]] = node_num;\n}\nvoid build() {\n\t_rep(i, 1, n) {\n\t\tval[bel[i]] += w[i];\n\t\tsz[bel[i]]++;\n\t}\n\n\t_rep(i, 1, n) {\n\t\tfor (ll j = head[i]; j; j = way[j].nxt) {\n\t\t\tll to = way[j].to;\n\t\t\tif (bel[i] == bel[to])continue;\n\t\t\ttmp.push_back(edge(bel[i], bel[to]));\n\t\t}\n\t}\n\tsort(all(tmp));\n\ttmp.erase(unique(tmp.begin(), tmp.end()), tmp.end());\n\tfor (auto i : tmp) {\n\t\tG[i.from].push_back(i.to);\n\t}\n}\nll f[maxn], g[maxn];\nbool ret[maxn];\nvoid dfs(ll cur, ll fa) {\n\tf[cur] = val[cur];\n\tif (sz[cur] > 1)ret[cur] = 1;\n\tll mx = 0;\n\tfor (auto to : G[cur]) {\n\t\tif (to == fa)continue;\n\t\tdfs(to, cur);\n\t\tif (ret[to])f[cur] += f[to], ret[cur] = 1;\n\t\telse mx = max(mx, g[to]);\n\t}\n\tg[cur] = f[cur] + mx;\n\tfor (auto to : G[cur]) {\n\t\tif (to != fa && ret[to])\n\t\t\tg[cur] = max(g[cur], f[cur] - f[to] + g[to]);\n\t}\n}\nsigned main()\n{\n\n\tcin >> n >> m;\n\t_rep(i, 1, n)cin >> w[i];\n\t_rep(i, 1, m)\n\t{\n\t\tll u, v;\n\t\tcin >> u >> v;\n\t\taddedge(u, v);\n\t\taddedge(v, u);\n\t}\n\tll s;\n\tcin >> s;\n\t_rep(i, 1, n) if (!dfn[i]) tarjan(i, 0);\n\tbuild();//\u7f29\u70b9\u7cfb\u5217\n\tdfs(bel[s], 0);\n\tcout << g[bel[s]] << endl;\n\n\t\n\t\n}\n\n```",
        "postTime": 1580750926,
        "uid": 159809,
        "name": "jasonleft",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1220E \u3010Tourism\u3011"
    }
]