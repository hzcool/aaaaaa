[
    {
        "content": "## \u9898\u610f\n\n\u8bb0 $c(l,r)=\\sum\\limits_{i=l}^r\\sum\\limits_{j=i}^r[\\gcd(i,j)\\ge l]$\u3002\u4f60\u53ef\u4ee5\u5c06$1\\sim n$ \u7684$n$ \u4e2a\u6570\u5206\u6210 $k$ \u6bb5 $0=x_1<x_2<x_3<\\cdots<x_k<x_{k+1}=n$\uff0c\u6700\u5c0f\u5316 \n$$\n\\sum_{i=1}^{k}c(x_i+1,x_{i+1})\n$$\n**\u6570\u636e\u8303\u56f4**\uff1a$n,k\\le 10^5,T$ \u7ec4\u8be2\u95ee\uff0c $T\\le 3\\times 10^5$\u3002\n\n## solution\n\n\u4e00\u4e2a\u66b4\u529b\u7684 DP \u505a\u6cd5\u662f\uff1a\u8bbe $f_{i,k}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u5206\u6210 $k$ \u6bb5\u7684\u6700\u5c0f\u503c\u3002\u8f6c\u79fb\u662f\n$$\nf_{i,k}=\\min_{j=1}^i\\{f_{j-1,k-1}+c(l,r)\\}\n$$\n\u8fb9\u754c\uff1a$f_{i,0}=+\\infin$\uff0c$f_{0,k}=0$\u3002\n\n\u8be2\u95ee\u6570\u5f88\u591a\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa DP \u6570\u7ec4 $O(1)$ \u67e5\u8be2\u3002\n\nDP\u72b6\u6001\u6570\u662f $O(n^2)$ \u7684\uff0c\u65e0\u6cd5\u627f\u53d7\u3002\u89c2\u5bdf $c(l,r)$ \u7684\u6027\u8d28\uff0c\u53d1\u73b0 $c(l,r)\\ge r-l+1$\uff0c\u4e5f\u5c31\u662f\u8bf4 $f_{n,k}\\ge n$\u3002\u5176\u6b21\uff0c$c(l,2l-1)=(2l-1)-l+1=l$\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u82e5 $n<2^k$\uff0c\u4e00\u5b9a\u53ef\u4ee5\u628a $n$ \u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6ee1\u8db3 $c(l,r)=r-l+1$\uff0c\u5373$f_{n,k}=n(2^k>n)$\u3002\u5269\u4e0b\u7684\u9700\u8981\u8003\u8651\u7684 $k$ \u5c31\u662f $O(\\log n)$ \u7ea7\u522b\u7684\u4e86\u3002\n\n\u72b6\u6001\u6570\u6ca1\u6709\u592a\u5927\u7684\u4f18\u5316\u7a7a\u95f4\u4e86\uff0c\u8003\u8651\u4f18\u5316 $c(l,r)$ \u7684\u8ba1\u7b97\u3002\u5927\u529b\u63a8\u5f0f\u5b50\uff1a\n$$\n\\begin{aligned}\nc(l,r)&=\\sum_{i=l}^r\\sum_{j=i}^r[\\gcd(i,j)\\ge l]\\\\\n&=\\sum_{k=l}^r\\sum_{i=l}^r\\sum_{j=i}^r[\\gcd(i,j)= k]\\\\\n&=\\sum_{k=l}^r\\sum_{i=\\lceil\\frac{l}{k}\\rceil}^{\\lfloor\\frac{r}{k}\\rfloor}\\sum_{j=i}^{\\lfloor\\frac{r}{k}\\rfloor}[\\gcd(i,j)=1]\\\\\n&=\\sum_{k=l}^r\\sum_{j=1}^{\\lfloor\\frac{r}{k}\\rfloor}\\sum_{i=1}^j[\\gcd(i,j)=1]\\\\\n&=\\sum_{k=l}^r\\sum_{i=1}^{\\lfloor\\frac{r}{k}\\rfloor}\\varphi(i)\n\\end{aligned}\n$$\n\n\u8bb0 $s(n)=\\sum_{i=1}^n\\varphi(i)$\uff0c\u5373 $\\varphi$ \u7684\u524d\u7f00\u548c\u3002\u5219\n$$\nc(l,r)=\\sum_{k=l}^rs(\\lfloor\\frac{r}{k}\\rfloor)\n$$\n\u9884\u5904\u7406\u51fa $s(n)$ \u4e4b\u540e\u5373\u53ef $O(\\sqrt{r})$ \u67e5\u8be2\u3002\u5b9e\u9645\u4e0a\uff0c$c(l,r)$ \u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u5927\u6982\u662f $O(\\sqrt{r-l})$ \u7684\u3002\u6216\u8005\u53ef\u4ee5 $O(n\\sqrt{n})$ \u9884\u5904\u7406 $O(1)$ \u67e5\u8be2\u3002\n\n\u8003\u8651\u4f18\u5316 DP \u8f6c\u79fb\u3002\u6839\u636e\u8fd9\u4e2aDP\u5206\u6bb5\u7684\u5f62\u5f0f\uff0c~~\u5927\u80c6\u731c\u6d4b~~ $c(l,r)$ \u6ee1\u8db3\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff0c\u90a3\u4e48\u8fd9\u6837DP\u8f6c\u79fb\u5c31\u53ef\u4ee5\u4f7f\u7528\u51b3\u7b56\u5355\u8c03\u6027\u4f18\u5316\u8f6c\u79fb\u4e86\u3002$c(l,r)$ \u6ee1\u8db3\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u7684\u8bc1\u660e\u5982\u4e0b\uff1a\n\n\u8bbe $l_1<l_2<r_1<r_2$\uff0c\u6211\u4eec\u9700\u8981\u8bc1\u660e $c(l_1,r_1)+c(l_2,r_2)\\le c(l_1,r_2)+c(l_2,r_1)$\u3002\n\n\u8bbe $f(l,r,p)=\\sum_{k=l}^p(\\lfloor\\frac{r}{k}\\rfloor)$\uff0c\u90a3\u4e48\n$$\n\\begin{aligned}\nc(l_1,r_2)+c(l_2,r_1)&=f(l_1,r_2,r_2)+f(l_2,r_1,r_1)\\\\\n&=(f(l_1,r_2,l_2-1)+f(l_2,r_2,r_2))+(f(l_1,r_1,r_1)-f(l_1,r_1,l_2-1))\\\\\n&=f(l_1,r_2,l_2-1)-f(l_1,r_1,l_2-1)+c(l_1,r_1)+c(l_2,r_2)\\\\\n\\end{aligned}\n$$\n\u663e\u7136 $f(l_1,r_2,l_2-1)\\ge f(l_1,r_1,l_2-1)$\uff0c\u5f97\u8bc1\u3002\n\n\u5269\u4e0b\u7684\u90e8\u5206\u53ef\u4ee5\u4f7f\u75281D1D\u51b3\u7b56\u5355\u8c03\u6027\u4f18\u5316DP\u7684\u5e38\u89c1\u5957\u8def\uff08\u5206\u6cbb/\u5355\u8c03\u961f\u5217\uff09\u8fdb\u884c\uff0c\u53ef\u4ee5\u53c2\u8003[\u672c\u849f\u84bb\u7684\u535a\u5ba2](https://www.cnblogs.com/harryzhr/p/14695633.html)\u3002\u56e0\u4e3a\u6709 $O(\\log n)$ \u5c42\uff0c\u6bcf\u5c42\u7684\u590d\u6742\u5ea6\u662f $O(n\\log n)$ \u7684\uff0c\u8f6c\u79fb\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log^2n)$ \u7684\uff0c\u52a0\u4e0a\u9884\u5904\u7406\u7684\u590d\u6742\u5ea6\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n+n\\sqrt{n})$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt{n})$\u3002\n\n\u5b9e\u9645\u4e0a\uff0c\u91c7\u7528\u5206\u6cbb\u505a\u6cd5\uff0c\u5047\u8bbe\u5f53\u524d\u7684\u8f6c\u79fb\u533a\u95f4\u662f $[L,R]$\uff0c\u5f53\u524d\u9700\u8981\u5bfb\u627e\u8f6c\u79fb\u70b9\u7684\u662f $mid$\u3002\u9996\u5148$O(\\sqrt{r-l})$ \u6c42\u51fa $c(R+1,mid)$\uff0c\u7136\u540e\u4ece $\\min(mid,R)$ \u5230 $L$ \u679a\u4e3e\u8f6c\u79fb\u70b9 $i$\uff0c$c(i,mid)=c(i+1,mid)+s(\\lfloor\\frac{mid}{i}\\rfloor)$\u3002\u8fd9\u4e2a\u505a\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u592a\u597d\u8bc1\uff0c\u4e0d\u8fc7\u9884\u5904\u7406\u8dd1\u7684\u5f88\u5feb\uff0c\u800c\u4e14\u4ee3\u7801\u590d\u6742\u5ea6\u5f88\u4f4e\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u6b63\u662f\u8fd9\u4e2a\u5199\u6cd5\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5,LOG=18;\ninline int read(){\n\tint s=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')s=(s<<3)+(s<<1)+ch-'0',ch=getchar();\n\treturn s*f;\n}\n#define ll long long\nconst ll inf=1e18;\nint prime[N],pcnt;\nll phi[N];\nbool vis[N];\nvoid init(int n){\n\tphi[1]=1;\n\tfor(int i=2;i<=n;++i){\n\t\tif(!vis[i]){\n\t\t\tprime[++pcnt]=i;\n\t\t\tphi[i]=i-1;\n\t\t}\n\t\tfor(int j=1;j<=pcnt&&prime[j]*i<=n;++j){\n\t\t\tvis[prime[j]*i]=1;\n\t\t\tif(i%prime[j]==0){\n\t\t\t\tphi[i*prime[j]]=phi[i]*prime[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*prime[j]]=phi[i]*(prime[j]-1);\n\t\t}\n\t}\n\tfor(int i=1;i<=n;++i)phi[i]+=phi[i-1];\n}\ninline ll calc(int l,int r){\n\tll ret=0;\n\tfor(int i;l<=r;l=i+1){\n\t\ti=min(r/(r/l),r);\n\t\tret+=1ll*phi[r/l]*(i-l+1);\n\t}\n\treturn ret;\n}\ninline ll c(int l,int r){return phi[r/l];}\nint T,n,k;\nll f[N][LOG];\nvoid solve(int l,int r,int L,int R){\n\tif(l>r)return;\n\tint mid=(l+r)>>1;ll sum=calc(R+1,mid);\n\tint pos=0;ll mn=inf; \n\tfor(int i=min(mid,R);i>=L;--i){\n\t\tsum+=phi[mid/i];\n\t\tif(sum+f[i-1][k-1]<=mn){\n\t\t\tmn=sum+f[i-1][k-1];\n\t\t\tpos=i;\n\t\t}\n\t}\n\tf[mid][k]=mn;\n\tsolve(l,mid-1,L,pos);\n\tsolve(mid+1,r,pos,R); \n}\nint main(){\n\tn=100000;init(n);\n\tfor(int i=1;i<=n;++i)f[i][1]=(1ll*i*(i+1))>>1;\n\tfor(k=2;k<=17;++k)\n\t\tsolve(1,n,1,n);\n\tT=read();\n\twhile(T--){\n\t\tn=read();k=read();\n\t\tif(k>=20||n<(1<<k)){\n\t\t\tprintf(\"%d\\n\",n);\n\t\t\tcontinue;\n\t\t}\n\t\tprintf(\"%lld\\n\",f[n][k]);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1635831230,
        "uid": 152128,
        "name": "harryzhr",
        "ccfLevel": 9,
        "title": "CF1603D\u9898\u89e3"
    },
    {
        "content": "[Codeforces \u9898\u9762\u4f20\u9001\u95e8](https://codeforces.ml/contest/1603/problem/D) & [\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1603D)\n\n~~\u5b66 whk \u65f6\u6bd4\u8f83\u65e0\u804a\u5f00\u4e86\u9053\u9898\u505a\u505a\u53d1\u73b0\u662f\u9053\u795e\u9898\uff08~~\n\n\u4ecb\u7ecd\u4e00\u79cd\u4e0d\u592a\u4e00\u6837\u7684\u505a\u6cd5\uff0c\u4e0d\u89c2\u5bdf\u51fa\u51b3\u7b56\u5355\u8c03\u6027\u4e5f\u53ef\u4ee5\u505a\u3002\n\n\u9996\u5148\u4e00\u4e2a\u5f88 trivial \u7684 observation \u662f\uff0c\u5982\u679c $2^{k-1}>n$\u200b \u90a3\u4e48\u7b54\u6848\u5c31\u662f $n$\u200b\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u7b2c $i$ \u6bb5\u653e $2^{i-1}$ \u4e2a\u6570\uff08\u6700\u540e\u4e00\u6bb5\u9664\u5916\uff09\uff0c\u8fd9\u6837\u6bcf\u4e00\u6bb5\u4e2d\uff0c\u80af\u5b9a\u53ea\u6709\u5f62\u5982 $(x,x)$ \u7684\u6574\u6570\u5bf9\u4f1a\u4ea7\u751f\u8d21\u732e\uff0c\u8fd9\u6837\u7b54\u6848\u521a\u597d\u53d6\u5230\u4e0b\u754c $n$\u3002\n\n\u6211\u4eec\u8bbe $dp_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u5206\u6210 $j$ \u6bb5\uff0c\u5b83\u4eec\u7684 $f$ \u503c\u4e4b\u548c\u7684\u6700\u5c0f\u503c\uff0c\u663e\u7136 $j$ \u7684\u4e0a\u754c\u53ea\u7528\u53d6\u5230 $18$\uff0c\u56e0\u6b64\u6211\u4eec\u8ba1\u7b97\u51fa $dp_{i,j}$ \u4e4b\u540e\u5373\u53ef $\\Theta(1)$ \u5730\u6c42\u51fa\u7b54\u6848\u3002\u81f3\u6b64\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u5982\u4f55\u6c42 $dp_{i,j}$\u3002\n\n\u8003\u8651\u5316\u7b80 $c(l,r)$ \u7684\u8868\u8fbe\u5f0f\uff0c\u4e00\u4e2a\u975e\u5e38\u6d45\u663e\u7684\u6027\u8d28\u662f\u5bf9\u4e8e $\\min(i,j)<l$ \u7684\u6570\u5bf9 $(i,j)$\uff0c\u5fc5\u7136\u6709 $\\gcd(i,j)<l$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u90a3\u62ff\u603b\u6570 $\\dfrac{r(r+1)}{2}$ \u51cf\u53bb $\\gcd(i,j)$ \u5c0f\u4e8e $l$ \u7684\u6570\u5bf9 $(i,j)$ \u7684\u4e2a\u6570\uff0c\u5373\u5982\u679c\u6211\u4eec\u8bbe $g(n,k)=\\sum\\limits_{i=1}^n\\sum\\limits_{j=i}^n[\\gcd(i,j)\\le k]$\uff0c\u90a3\u4e48\u6709 $dp_{i,j}=\\min\\limits_{k}dp_{k,j-1}+\\dfrac{i(i+1)}{2}-g(i,k)$\u3002\u800c\u6839\u636e\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u77e5\u8bc6\uff0c\u6709\n$$\n\\begin{aligned}\ng(n,k)&=\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n[\\gcd(i,j)\\le k]\\\\\n&=\\sum\\limits_{d=1}^k\\sum\\limits_{i=1}^n\\sum\\limits_{j=i}^n[\\gcd(i,j)=d]\\\\\n&=\\sum\\limits_{d=1}^k\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=i}^{n/d}[\\gcd(i,j)=1]\\\\\n&=\\sum\\limits_{d=1}^k\\dfrac{1+\\sum\\limits_{p=1}^{n/d}\\mu(p)\\lfloor\\dfrac{n}{dp}\\rfloor^2}{2}\n\\end{aligned}\n$$\n\u8003\u8651\u600e\u6837\u7ef4\u62a4\u4e4b\uff0c\u4e5f\u5c31\u662f\u8bf4\u600e\u6837\u52a8\u6001\u5730\u5bf9\u4e8e\u4e00\u4e2a\u51b3\u7b56\u70b9 $k$\uff0c\u7528\u4e2a\u4ec0\u4e48\u4e1c\u897f\u7ef4\u62a4 $dp_{k,j-1}-g(i,k)$ \u7684\u503c\uff0c\u8fdb\u800c\u6c42\u51fa\u5168\u5c40\u6700\u5c0f\u503c\u3002\u8003\u8651\u7ebf\u6bb5\u6811\u4f18\u5316 dp\u3002\u6211\u4eec\u5efa\u7acb\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u5e76\u4e14\u5e0c\u671b\uff0c\u5f53\u6211\u4eec\u52a8\u6001\u5730\u679a\u4e3e\u5230 $i$ \u65f6\uff0c\u7ebf\u6bb5\u6811\u4e0a\u4e0b\u6807\u4e3a $k$ \u7684\u4f4d\u7f6e\u4e0a\u7684\u503c\u5c31\u7b49\u4e8e $dp_{k,j-1}-g(i,k)$\uff0c\u90a3\u4e48\u5c31\u6709 $dp_{i,j}=\\dfrac{i(i+1)}{2}+\\text{\u6b64\u65f6\u7ebf\u6bb5\u6811\u4e0a\u5168\u5c40\u6700\u5c0f\u503c}$\u3002\n\n\u8fd9\u53c8\u8be5\u600e\u6837\u7ef4\u62a4\u5462\uff1f\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u4e00\u4e2a\u6027\u8d28\uff1a\u5f53 $n$ \u7531 $n-1$ \u53d8\u5230 $n$ \u65f6\uff0c\u53ea\u6709\u90a3\u4e9b $d\\mid n$ \u7684 $\\sum\\limits_{p=1}^{n/d}\\mu(p)\\lfloor\\dfrac{n}{dp}\\rfloor^2$ \u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684 $k$\uff0c\u5982\u679c\u6211\u4eec\u9884\u5904\u7406\u51fa\u4e86 $sum_i=\\sum\\limits_{i=1}^n\\mu(i)\\lfloor\\dfrac{n}{i}\\rfloor$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728 $\\Theta(d(n))$ \u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u51fa $g(n,k)-g(n-1,k)$\u3002\u5177\u4f53\u65b9\u6cd5\u5c31\u662f\uff0c\u904d\u5386\u6240\u6709 $d\\mid n$\uff0c\u5982\u679c $d\\le k$\uff0c\u90a3\u4e48\u5c31\u4f1a $g(n,k)$ \u5c31\u4f1a\u76f8\u8f83\u4e8e $g(n-1,k)$ \u4ea7\u751f $\\dfrac{1+\\sum\\limits_{p=1}^{n/d}\\mu(p)\\lfloor\\dfrac{n}{dp}\\rfloor^2}{2}-\\dfrac{1+\\sum\\limits_{p=1}^{(n-1)/d}\\mu(p)\\lfloor\\dfrac{n-1}{dp}\\rfloor^2}{2}$ \u7684\u589e\u91cf\u3002\u53d1\u73b0\u4e86\u8fd9\u4e2a\u6027\u8d28\u4ee5\u540e\u5c31\u5f88\u597d\u7ef4\u62a4\u4e86\uff0c\u5f53\u6211\u4eec\u626b\u63cf\u5230 $i$ \u65f6\u904d\u5386\u4e00\u904d\u6240\u6709 $i$ \u7684\u56e0\u5b50 $d$\uff0c\u8ba1\u7b97\u51fa $\\dfrac{1+\\sum\\limits_{p=1}^{i/d}\\mu(p)\\lfloor\\dfrac{i}{dp}\\rfloor^2}{2}-\\dfrac{1+\\sum\\limits_{p=1}^{(i-1)/d}\\mu(p)\\lfloor\\dfrac{i-1}{dp}\\rfloor^2}{2}$\uff0c\u7136\u540e\u5728\u7ebf\u6bb5\u6811\u4e0a\u6267\u884c\u4e00\u904d\u540e\u7f00\u51cf\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $n\\ln n\\log^2n$\uff0c\u8f83\u4e3a\u5361\u5e38\u3002\n\n```cpp\nusing namespace fastio;\nconst int MAXV = 1e5;\nconst int LOG_N = 18;\nconst int MAXC = MAXV << 4;\nint pr[MAXV / 6 + 5], mu[MAXV + 5], prcnt = 0;\nint smu[MAXV + 5]; ll sm[MAXV + 5];\nbool vis[MAXV + 5];\nint hd[MAXV + 5], val[MAXC + 5], nxt[MAXC + 5], item_n = 0;\nvoid ins(int x, int y) {val[++item_n] = y; nxt[item_n] = hd[x]; hd[x] = item_n;}\nvoid sieve(int n) {\n\tmu[1] = 1;\n\tfor (int i = 2; i <= n; i++) {\n\t\tif (!vis[i]) mu[i] = -1, pr[++prcnt] = i;\n\t\tfor (int j = 1; j <= prcnt && pr[j] * i <= n; j++) {\n\t\t\tvis[pr[j] * i] = 1; if (i % pr[j] == 0) break;\n\t\t\tmu[pr[j] * i] = -mu[i];\n\t\t}\n\t}\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = i; j <= n; j += i)\n\t\t\tins(j, i);\n\tfor (int i = 1; i <= n; i++) smu[i] = smu[i - 1] + mu[i];\n\tfor (int i = 1; i <= n; i++) {\n\t\tsm[i] = sm[i - 1];\n\t\tfor (int e = hd[i]; e; e = nxt[e]) {\n\t\t\tint f = val[e];\n\t\t\tsm[i] -= 1ll * mu[f] * (i / f - 1) * (i / f - 1);\n\t\t\tsm[i] += 1ll * mu[f] * (i / f) * (i / f);\n\t\t}\n\t}\n}\nll dp[LOG_N + 2][MAXV + 5];\nstruct node {ll mn, lz;} s[MAXV * 4 + 5];\nvoid pushup(int k) {s[k].mn = min(s[k << 1].mn, s[k << 1 | 1].mn) + s[k].lz;}\nvoid build(int k, int l, int r, int lv) {\n\ts[k].lz = 0; if (l == r) return s[k].mn = 2 * dp[lv][l], void();\n\tint mid = l + r >> 1; build(k << 1, l, mid, lv); build(k << 1 | 1, mid + 1, r, lv);\n\tpushup(k);\n}\nvoid tag(int k, ll v) {s[k].lz += v; s[k].mn += v;}\nvoid modify(int k, int l, int r, int p, ll v) {\n\tif (l >= p) return tag(k, v), void();\n\tint mid = l + r >> 1;\n\tif (p <= mid) modify(k << 1, l, mid, p, v), tag(k << 1 | 1, v);\n\telse modify(k << 1 | 1, mid + 1, r, p, v);\n\tpushup(k);\n}\nint main() {\n\tsieve(MAXV); memset(dp, 0x1f, sizeof(dp)); dp[0][0] = 0;\n\tfor (int i = 1; i <= MAXV; i++) dp[1][i] = 1ll * i * (i + 1) / 2;\n\tfor (int i = 2; i <= LOG_N; i++) {\n\t\tbuild(1, 0, MAXV, i - 1);\n\t\tfor (int j = 1; j <= MAXV; j++) {\n\t\t\tfor (int e = hd[j]; e; e = nxt[e]) {\n\t\t\t\tint f = val[e];\n\t\t\t\tll ori = ((j / f == 1) ? 0 : 1) + sm[j / f - 1];\n\t\t\t\tll cur = 1 + sm[j / f];\n\t\t\t\tmodify(1, 0, MAXV, f, ori - cur);\n\t\t\t}\n\t\t\tdp[i][j] = ((s[1].mn + s[1].lz) / 2) + 1ll * j * (j + 1) / 2;\n//\t\t\tprintf(\"%d %d %lld\\n\", i, j, dp[i][j]);\n\t\t}\n\t}\n\tint qu; read(qu);\n\twhile (qu--) {\n\t\tint n, k; read(n); read(k);\n\t\tif (k > LOG_N) print(n, '\\n');\n\t\telse print(dp[k][n], '\\n');\n\t}\n\tprint_final();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1637837186,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1603D Artistic Partition"
    },
    {
        "content": "Update on 2022.10.11\uff1a\u4fee\u6539\u8868\u8ff0\u3002\n\n> [CF1603D Artistic Partition](https://codeforces.com/problemset/problem/1603/D)\n\n\u5f53 $n < 2 ^ k$ \u65f6\uff0c\u7b54\u6848\u4e3a $n$\uff0c\u56e0\u4e3a\u4ee4 $x_i\\gets 2 ^ {i - 1} - 1$\uff0c\u5219\u5bf9\u4e8e\u4efb\u610f\u533a\u95f4 $[x_i + 1, x_{i + 1}]$\uff0c\u56e0\u4e3a $x_{i + 1} < 2(x_i + 1)$\uff0c\u6240\u4ee5 $c(x_i + 1, x_{i + 1}) = x_{i + 1} - x_i$\uff0c\u8fd9\u663e\u7136\u8fbe\u5230\u4e86\u6700\u4f18\uff0c\u56e0\u4e3a\u5f53 $i = j$ \u65f6\u603b\u662f\u8d21\u732e $1$\u3002\n\n\u8bbe $f_{k, n}$ \u8868\u793a\u7b54\u6848\uff0c\u6709\n\n$$\nf_{j, i} = \\min_{p = 0} ^ {i - 1} f_{j - 1, p} + c(p + 1, j)\n$$\n\u6211\u4eec\u731c\u6d4b $c$ \u5177\u6709\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff08\u611f\u6027\u7406\u89e3\uff0c\u4e0d\u505a\u8bc1\u660e\uff09\uff0c\u90a3\u4e48\u53ea\u9700\u8003\u8651 $c(l, r)$ \u5728\u5de6\u53f3\u7aef\u70b9\u79fb\u52a8\u65f6\u65b0\u589e\u7684\u8d21\u732e\uff0c\u7528\u6307\u9488\u7ef4\u62a4\u8d21\u732e\u533a\u95f4\u3002\n\n\u5f53 $l + 1\\to l$ \u65f6\uff0c\u56e0\u4e3a $\\gcd(l, i) < l + 1$\uff0c\u6240\u4ee5\u65b0\u589e\u8d21\u732e\u4e3a $\\sum\\limits_{i = l} ^ r\\sum\\limits_{j = i} ^ r [\\gcd(i, j) = l]$\u3002\u5316\u7b80\u5f97\u5230 $\\sum\\limits_{i = 1} ^ {\\frac r l} \\varphi(i)$\u3002\n\n\u5f53 $r - 1\\to r$ \u65f6\uff0c\u65b0\u589e\u8d21\u732e\u4e3a $\\sum\\limits_{i = l} ^ r [\\gcd(i, r) \\geq l]$\u3002\u679a\u4e3e $r$ \u7684\u56e0\u6570 $d$\uff0c\u82e5 $d\\geq l$\uff0c\u5219\u4ea7\u751f\u8d21\u732e $\\varphi\\left(\\dfrac r d\\right)$\u3002\n\n\u56e0\u4e3a\u5de6\u53f3\u7aef\u70b9\u5404\u81ea\u79fb\u52a8 $\\mathcal{O}(\\log n)$ \u5c42\u4e14 $\\sum\\limits_{i = 1} ^ n d(i) = \\mathcal{O}(n\\ln n)$\uff0c\u6240\u4ee5\u4e00\u5c42\u8f6c\u79fb\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n\\log ^ 2 n)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log ^ 3 n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define TIME 1e3 * clock() / CLOCKS_PER_SEC\nusing ll = long long;\nusing uint = unsigned int;\nusing ld = long double;\n// using lll = __int128;\nusing pii = pair<int, int>;\nusing pll = pair<ll, ll>;\nusing ull = unsigned long long;\ninline ll read() {\n  ll x = 0, sgn = 0;\n  char s = getchar();\n  while(!isdigit(s)) sgn |= s == '-', s = getchar();\n  while(isdigit(s)) x = x * 10 + s - '0', s = getchar();\n  return sgn ? -x : x;\n}\ninline void print(ll x) {\n  if(x < 0) return putchar('-'), print(-x);\n  if(x >= 10) print(x / 10);\n  putchar(x % 10 + '0');\n}\nbool Mbe;\nconstexpr int N = 1e5 + 5;\nbool vis[N];\nint cnt, pr[N], phi[N], l = 1, r;\nll S[N], f[18][N], res;\nvector<int> d[N];\nll coef(int pl, int pr) {\n  while(r < pr) {\n    r++;\n    for(int it : d[r])\n      if(it >= l) res += phi[r / it];\n      else break;\n  }\n  while(l > pl) res += S[r / (--l)];\n  while(r > pr) {\n    for(int it : d[r])\n      if(it >= l) res -= phi[r / it];\n      else break;\n    r--;\n  }\n  while(l < pl) res -= S[r / (l++)];\n  return res;\n}\nvoid solve(int l, int r, int pl, int pr, ll *f, ll *g) {\n  int m = l + r >> 1, c = pl;\n  for(int i = pl; i <= pr && i < m; i++) {\n    ll val = f[i] + coef(i + 1, m);\n    if(val < g[m]) g[m] = val, c = i;\n  }\n  if(l < m) solve(l, m, pl, c, f, g);\n  if(m < r) solve(m + 1, r, c, pr, f, g);\n}\nbool Med;\nint main() {\n  fprintf(stderr, \"%.3lf MB\\n\", (&Mbe - &Med) / 1048576.0);\n  #ifdef ALEX_WEI\n    FILE* IN = freopen(\"1.in\", \"r\", stdin);\n    FILE* OUT = freopen(\"1.out\", \"w\", stdout);\n  #endif\n  for(int i = 1; i < N; i++)\n    for(int j = i; j < N; j += i)\n      d[j].push_back(i);\n  for(int i = 1; i < N; i++) reverse(d[i].begin(), d[i].end());\n  phi[1] = 1;\n  for(int i = 2; i < N; i++) {\n    if(!vis[i]) vis[i] = 1, phi[i] = i - 1, pr[++cnt] = i;\n    for(int j = 1; j <= cnt && i * pr[j] < N; j++) {\n      vis[i * pr[j]] = 1;\n      if(i % pr[j] == 0) {\n        phi[i * pr[j]] = phi[i] * pr[j];\n        break;\n      }\n      phi[i * pr[j]] = phi[i] * (pr[j] - 1);\n    }\n  }\n  for(int i = 1; i < N; i++) S[i] = S[i - 1] + phi[i];\n  memset(f, 0x3f, sizeof(f)), f[0][0] = 0;\n  for(int i = 1; i < 18; i++) solve(1, N - 1, 0, N - 2, f[i - 1], f[i]);\n  int T = read();\n  while(T--) {\n    int n = read(), k = read();\n    if(k > 31 - __builtin_clz(n)) print(n);\n    else print(f[k][n]);\n    putchar('\\n');\n  }\n  cerr << TIME << \" ms\\n\";\n  return 0;\n}\n/*\n2022/10/11\nauthor: Alex_Wei\nstart coding at 15:01\nfinish debugging at 15:22\n*/\n```",
        "postTime": 1636111816,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "CF1603D Artistic Partition"
    },
    {
        "content": "\n\n\u8bbe $f_{i,k}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u5206\u6210 $k$ \u6bb5\u7684\u6700\u5c0f\u503c\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\nf_{i,k}=\\min_{j=1}^{i}\\{f_{j-1,k-1}+c(j,i)\\}\n$$\n\u89c2\u5bdf\u5f97\uff1a\u5982\u679c $2^{k-1}>n$\uff0c\u8003\u8651\u5728\u7b2c $i$ \u6bb5\u653e $2^{i-1}$ \u4e2a\u6570\uff0c\u53ea\u6709 $(x,x)$ \u7684\u6574\u6570\u5bf9\u4f1a\u4ea7\u751f\u8d21\u732e\uff0c\u90a3\u4e48\u7b54\u6848\u5373\u4e3a $n$\uff0c\u6545 $k$ \u4e0a\u754c\u4e3a $18$\u3002\u53ef\u4ee5\u9884\u5904\u7406 $f$ \u6570\u7ec4\uff0c\u540e $\\mathcal O(1)$ \u56de\u7b54\u8be2\u95ee\u3002\n\n\u8003\u8651\u5230 $\\ge$ \u6709\u70b9\u96be\u5904\u7406\uff0c\u6545\u8bbe $g(n,k)=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}[\\gcd(i,j)\\leq k]$\uff0c\u5219 $c(n,k)=\\frac{n(n+1)}{2}-g(n,k)$\uff0c$f_{i,k}=\\min\\limits_{j=1}^{i}(f_{j-1,k-1}+\\frac{i(i+1)}{2}-g(j,i))$\u3002\n\n\u8003\u8651\u4f7f\u7528\u7ebf\u6bb5\u6811\u4f18\u5316 $\\min$\uff0c\u5728 $\\mathcal O(\\log n)$ \u7684\u65f6\u95f4\u5185\u627e\u5230\u6700\u5c0f\u7684 $f_{j-1}{k-1}+g(j,i)$\u3002\n\n\u518d\u6839\u636e\u83ab\u53cd\u77e5\u8bc6\uff0c\u6709\uff1a\n$$\n\\begin{aligned}\ng(n,k)&=\\sum_{i=1}^{n}\\sum_{j=1}^{n}[\\gcd(i,j)\\leq k]\\\\\n&=\\sum_{d=1}^{k}\\sum_{i=1}^{n}\\sum_{j=i}^{n}[\\gcd(i,j)=d]\\\\\n&=\\sum_{d=1}^{k}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=i}^{\\lfloor\\frac{n}{d}\\rfloor}[\\gcd(i,j)=1]\\\\\n&=\\sum_{d=1}^{k}\\frac{1+\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\lfloor\\frac{n}{dp}\\rfloor^2}{2}\n\\end{aligned}\n$$\n\u8003\u8651\u600e\u6837\u7ef4\u62a4\uff0c\u6211\u4eec\u53d1\u73b0\u5f53 $n$ \u7531 $n-1$ \u53d8\u5230 $n$ \u65f6\uff0c\u53ea\u6709\u90a3\u4e9b $d|n$ \u7684 $\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}$ \u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u6545\u9884\u5904\u7406\u56e0\u5b50\u7ef4\u62a4\u589e\u91cf\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\ln n \\log^2 n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int _ = 1e5 + 5;\n\nint pr[_ / 6], mu[_], cnt, smu[_];\n\nll sm[_];\n\nbool vis[_];\n\nvector<int> d[_ << 1];\n\ninline void solve(int n)\n{\n\tmu[1] = 1;\n\tfor(int i = 2; i <= n; ++i)\n\t{\n\t\tif(!vis[i]) mu[i] = -1, pr[++cnt] = i;\n\t\tfor(int j = 1; j <= cnt && pr[j] * i <= n; ++j)\n\t\t{\n\t\t\tvis[pr[j] * i] = 1;\n\t\t\tif(i % pr[j] == 0) break;\n\t\t\tmu[pr[j] * i] = -mu[i];\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; ++i)\n\t\tfor(int j = i; j <= n; j += i) d[j].push_back(i);\n\tfor(int i = 1; i <= n; ++i) smu[i] = smu[i - 1] + mu[i];\n\tfor(int i = 1; i <= n; ++i)\n\t{\n\t\tsm[i] = sm[i - 1];\n\t\tfor(int f : d[i])\n\t\t{\n\t\t\tsm[i] -= 1ll * mu[f] * (i / f - 1) * (i / f - 1);\n\t\t\tsm[i] += 1ll * mu[f] * (i / f) * (i / f);\n\t\t}\n\t}\n}\n\nll f[20][_];\n\nstruct Node\n{\n\tll mn, lz;\n} s[_ << 2];\n\nvoid build(int o, int l, int r, int lv)\n{\n\ts[o].lz = 0;\n\tif(l == r)\n\t{\n\t\ts[o].mn = 2 * f[lv][l];\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(o << 1, l, mid, lv);\n\tbuild(o << 1 | 1, mid + 1, r, lv);\n\ts[o].mn = min(s[o << 1].mn, s[o << 1 | 1].mn);\n}\n\ninline void tag(int o, ll v)\n{\n\ts[o].lz += v, s[o].mn += v;\n}\n\nvoid update(int o, int l, int r, int p, ll v)\n{\n\tif(p <= l)\n\t{\n\t\ttag(o, v);\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tif(p <= mid)\n\t\tupdate(o << 1, l, mid, p, v), tag(o << 1 | 1, v);\n\telse\n\t\tupdate(o << 1 | 1, mid + 1, r, p, v);\n\ts[o].mn = min(s[o << 1].mn, s[o << 1 | 1].mn) + s[o].lz;\n}\n\nsigned main()\n{\n\tsolve(_ - 5);\n\tmemset(f, 0x1f, sizeof f);\n\tf[0][0] = 0;\n\tfor(int i = 1; i <= _ - 5; ++i) f[1][i] = 1ll * i * (i + 1) / 2;\n\tfor(int i = 2; i <= 18; ++i)\n\t{\n\t\tbuild(1, 0, _ - 5, i - 1);\n\t\tfor(int j = 1; j <= _ - 5; ++j)\n\t\t{\n\t\t\tfor(int f : d[j])\n\t\t\t{\n\t\t\t\tll a = ((j / f == 1) ? 0 : 1) + sm[j / f - 1];\n\t\t\t\tll b = 1 + sm[j / f];\n\t\t\t\tupdate(1, 0, _ - 5, f, a - b);\n\t\t\t}\n\t\t\tf[i][j] = ((s[1].mn + s[1].lz) / 2) + 1ll * j * (j + 1) / 2;\n\t\t}\n\t}\n\tint q, n, k;\n\tscanf(\"%d\", &q);\n\twhile(q--)\n\t{\n\t\tscanf(\"%d%d\", &n, &k);\n\t\tif(k > 18) printf(\"%d\\n\", n);\n\t\telse printf(\"%lld\\n\", f[k][n]);\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1669014603,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "CF1603D Artistic Partition"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u6b27\u62c9\u51fd\u6570](https://oi-wiki.org/math/number-theory/euler/)\u3001[\u6574\u4f53\u4e8c\u5206](https://oi-wiki.org/misc/parallel-binsearch/)\n\n\u8003\u8651 dp\uff0c\u8bbe $dp_{i, j}$ \u8868\u793a $x_{i + 1} = j$ \u65f6 $x_0 \\sim x_{i + 1}$ \u8d21\u732e\u4e4b\u548c\u7684\u6700\u5c0f\u503c\u3002\n\n\u521d\u503c\uff1a$dp_{0, i} = [i \\neq 0] \\infty$\u3002\n\n\u8f6c\u79fb\uff1a$dp_{i, j} = \\displaystyle\\max_{k = 1}^i (dp_{i - 1, k - 1} + c(k, i))$\u3002\n\n\u7b54\u6848\uff1a$dp_{k, n}$\u3002\n\n\u76f4\u63a5\u66b4\u529b\u662f $O(N^5 \\log N + T)$ \u7684\uff0c\u96be\u4ee5\u63a5\u53d7\u3002\n\n\u8fd9\u4e2a $c(l, r)$ \u4e00\u773c\u9274\u5b9a\u4e3a\u679a\u4e3e gcd \u540e\u76f4\u63a5\u4e0a\u6b27\u62c9\u51fd\u6570\uff1a$c(l, r) = \\displaystyle\\sum_{d = l}^r \\sum_{i = l}^r \\sum_{j = l}^r [\\gcd(i, j) = d] = \\sum_{d = l}^r \\sum_{i = 1}^r \\sum_{j = 1}^r [\\gcd(i, j) = d] = \\sum_{d = l}^r \\sum_{i = 1}^{\\lfloor \\frac{r}{d} \\rfloor} \\varphi(i) = \\sum_{d = l}^r S_{\\varphi}(\\lfloor \\frac{r}{d} \\rfloor)$\u3002\u8fd9\u91cc\u5f88\u5957\u8def\uff0c\u5c31\u4e0d\u591a\u8bb2\u4e86\u3002\n\n\u9884\u5904\u7406\u6b27\u62c9\u51fd\u6570\u7684\u524d\u7f00\u548c\u5e76\u6570\u8bba\u5206\u5757\u5373\u53ef\u505a\u5230 $O(N^3 \\sqrt{N} + T)$\uff0c\u4f46\u4ecd\u96be\u4ee5\u63a5\u53d7\u3002\n\n\u73b0\u5728\u8003\u8651\u89c2\u5bdf dp \u8f6c\u79fb\u7684\u6027\u8d28\uff0c\u6ce8\u610f\u5230\u8fd9\u4e2a\u8f6c\u79fb\u5f0f\u5728 $c(l, r)$ \u6ee1\u8db3\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u65f6\u53ef\u4ee5\u6574\u4f53\u4e8c\u5206\u4f18\u5316\uff0c\u4e14\u6253\u8868\u53ef\u77e5\u8be5 dp \u786e\u5b9e\u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\u3002\u73b0\u5728\u6211\u4eec\u8003\u8651\u8bc1\u660e\u8be5\u6027\u8d28\uff0c\u5373\u8bc1\u660e $\\forall i \\leq j \\leq k \\leq l, c(i, k) + c(j, l) \\leq c(i, l) + c(j, k)$\u3002\n\n\u8bc1\u660e\uff1a\u8bbe $f(l, r, k) = \\displaystyle\\sum_{i = l}^r S_{\\varphi}(\\lfloor \\frac{k}{i} \\rfloor)$\uff0c\u5219\u53f3\u5f0f\u51cf\u5de6\u5f0f\u7684\u503c\u4e3a $f(k + 1, l, i) - f(k + 1, l, j) \\geq 0$\u3002\u5f97\u8bc1\u3002\n\n\u4e8e\u662f\u76f4\u63a5\u6574\u4f53\u4e8c\u5206\u4f18\u5316\u6709\u51b3\u7b56\u5355\u8c03\u6027\u7684 dp \u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N^2 \\sqrt{N} \\log N + T)$\uff0c\u4f46\u4f9d\u7136\u96be\u4ee5\u63a5\u53d7\u3002\n\n\u5982\u679c\u4f60\u8f93\u51fa\u4e00\u4e0b $dp_{i, j}$ \u7684\u503c\u4f1a\u53d1\u73b0\uff1a\u5f53 $i > \\lfloor \\log_2 j \\rfloor$ \u65f6\uff0c$dp_{i, j}$ \u4e0d\u53d8\u6052\u4e3a $j$\u3002\u539f\u56e0\u663e\u7136\uff0c\u5373\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u4e00\u79cd $x$ \u7684\u9009\u53d6\u65b9\u5f0f $0, 1, 3, 7, 15, \\cdots$\uff0c\u4f7f\u5f97\u6240\u6709\u7528\u5230\u7684 $c(l, r) = r - l + 1$\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u6240\u6709 $i \\leq \\lfloor \\log_2 N \\rfloor$ \u7684\u60c5\u51b5\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N \\sqrt{N} \\log^2 N + T)$\u3002\n\n\u770b\u4e0a\u53bb\u4e0d\u592a\u80fd\u51b2\uff0c\u4f46\u7531\u4e8e\u533a\u95f4\u53d8\u5c0f\u540e\u6570\u8bba\u5206\u5757\u4e25\u91cd\u8dd1\u4e0d\u6ee1\uff0c\u5b9e\u9645\u4e0a\u8dd1\u5f97\u98de\u5feb\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n#include <math.h>\n\ntypedef long long ll;\n\nconst int N = 1e5, M = 16;\nint prime[N + 7], phi[N + 7];\nll sum[N + 7], dp[M + 7][N + 7];\nbool p[N + 7];\n\ninline void init(){\n\tint cnt = 0;\n\tp[0] = p[1] = true;\n\tphi[1] = 1;\n\tfor (register int i = 2; i <= N; i++){\n\t\tif (!p[i]){\n\t\t\tprime[++cnt] = i;\n\t\t\tphi[i] = i - 1;\n\t\t}\n\t\tfor (register int j = 1; j <= cnt && i * prime[j] <= N; j++){\n\t\t\tint t = i * prime[j];\n\t\t\tp[t] = true;\n\t\t\tif (i % prime[j] == 0){\n\t\t\t\tphi[t] = phi[i] * prime[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[t] = phi[i] * (prime[j] - 1);\n\t\t}\n\t}\n\tfor (register int i = 1; i <= N; i++){\n\t\tsum[i] = sum[i - 1] + phi[i];\n\t}\n}\n\ninline ll f(int n, int m){\n\tll ans = 0;\n\tfor (register int i = n, j; i <= m; i = j + 1){\n\t\tint t = m / i;\n\t\tj = m / t;\n\t\tans += sum[t] * (j - i + 1);\n\t}\n\treturn ans;\n}\n\ninline int min(int a, int b){\n\treturn a < b ? a : b;\n}\n\ninline ll min(ll a, ll b){\n\treturn a < b ? a : b;\n}\n\nvoid solve(int l1, int r1, int l2, int r2, int k){\n\tif (l2 == r2){\n\t\tfor (register int i = l1; i <= r1; i++){\n\t\t\tdp[k][i] = dp[k - 1][l2 - 1] + f(l2, i);\n\t\t}\n\t\treturn;\n\t}\n\tint mid = (l1 + r1) >> 1, pos = -1, t = min(r2, mid);\n\tdp[k][mid] = 9e18;\n\tfor (register int i = l2; i <= t; i++){\n\t\tll val = dp[k - 1][i - 1] + f(i, mid);\n\t\tif (dp[k][mid] > val){\n\t\t\tdp[k][mid] = val;\n\t\t\tpos = i;\n\t\t}\n\t}\n\tif (l1 < mid) solve(l1, mid - 1, l2, pos, k);\n\tif (r1 > mid) solve(mid + 1, r1, pos, r2, k);\n}\n\nint main(){\n\tint t;\n\tscanf(\"%d\", &t);\n\tinit();\n\tfor (register int i = 1; i <= N; i++){\n\t\tdp[0][i] = 9e18;\n\t}\n\tfor (register int i = 1; i <= M; i++){\n\t\tdp[i][0] = 9e18;\n\t\tsolve(i, N, 1, N, i);\n\t}\n\tfor (register int i = 1; i <= t; i++){\n\t\tint n, k;\n\t\tscanf(\"%d %d\", &n, &k);\n\t\tif (k > log2(n)){\n\t\t\tprintf(\"%d\\n\", n);\n\t\t} else {\n\t\t\tprintf(\"%lld\\n\", dp[k][n]);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1661860765,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1603D \u3010Artistic Partition\u3011"
    },
    {
        "content": "\u611f\u89c9\u4e0a\u6b21\u5361\u5e38\u662f\u5f88\u4e45\u5f88\u4e45\u4ee5\u524d\u7684\u4e8b\u4e86\u3002\u3002\u3002\n\n\u6570\u8bba DP \u6bd4\u8f83\u65b0\u9c9c\u3002\n\n# Solution\n\n\u660e\u6446\u7740\u5206 k \u6bb5\u95ee\u9898\u3002\n\n**Oberservation**: $f(n,k)=n$\uff0c\u5f53 $k>\\log n$\u3002\n\n\u901a\u8fc7 $c(x,y)=y-x+1,y<2\\cdot x$ \u53ef\u4ee5\u7b80\u5355\u6784\u9020\u3002\n\n\u63a8\u4e0b\u5f0f\u5b50\u3002\n\n$$\n\\begin{array}{l}\nc(l,r)\\\\\n=\\sum_{i=l}^{r}\\sum_{j=i}^{r}[gcd(i,j)\\geq l]\\\\\n=\\sum_{i=l}^{r}\\sum_{j=i+1}^{r}[gcd(i,j)\\geq l]+(r-l+1)\\\\\n=\\sum_{k=l}^{r}\\sum_{i=1}^{\\lfloor\\frac{r}{k}\\rfloor}\\sum_{j=i+1}^{\\lfloor\\frac{r}{k}\\rfloor}[gcd(i,j)==1]+(r-l+1)\\\\\n=\\sum_{k=1}^{r}\\sum_{i=1}^{\\lfloor\\frac{r}{k}\\rfloor}\\phi(i)+(r-l+1)\\\\\n=\\sum_{k=1}^{r}S(\\lfloor\\frac{r}{k}\\rfloor)+(r-l+1)\n\\end{array}\n$$\n\n\u5176\u4e2d $S(n)=\\sum_{i=1}^{n}\\phi(i)$\n\n\u5927\u6982\u8bb2\u4e00\u4e0b $c(l,r)$ \u548b $O(1)$\u3002\n\n\u5148\u5927\u529b\u6839\u53f7\u5206\u6cbb\uff0c\u6309\u7167\u5927\u5c0f\u4e8e $\\sqrt{n}$ \u5206\u7c7b\uff0c\u5206\u522b\u9884\u5904\u7406\u4e24\u7c7b\u7684\u540e\u3001\u524d\u7f00\u548c\uff08\u65b9\u5411\u624b\u6478\u663e\u7136\uff09\u3002\n\n1. \u5c0f\u4e8e $\\sqrt{n}$ \u7684\u76f4\u63a5\u5b58\u3002\n\n2. \u5927\u4e8e $\\sqrt{n}$ \u7684\u503c\u57df\u4e00\u5b9a\u5728 $[1,\\sqrt{n}]$ \u4e2d\uff0c\u90a3\u4e48\u76f4\u63a5\u679a\u4e3e\u503c\u6216\u8005\u6574\u9664\u5206\u5757\u641e\uff0c\u7b54\u6848\u6309\u503c\u57df\u5b58\u50a8\u3002\n\n\u7136\u540e\u53ef\u4ee5\u5927\u529b\u624b\u6478\u8fb9\u754c\u6761\u4ef6\u7b97\uff0c\u8bf7\u8bfb\u8005\u81ea\u884c\u601d\u8003\u3002\n\n\u7136\u540e\u662f\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u663e\u7136\u53ef\u4ee5 dp $f(n,k)=\\min(f(m,k-1)+c(m+1,n)),m<n$\u3002\n\n\u5373\u8bc1 $c(a,b+1)+c(b,c)\\leq c(a,c)+c(b,b+1)$\n\n**proof:**\n\n$\\sum_{k=a}^{b+1}S(\\lfloor\\frac{b+1}{k}\\rfloor)+\\sum_{k=b}^{c}S(\\lfloor\\frac{c}{k}\\rfloor)\\leq \\sum_{k=a}^{c}S(\\lfloor\\frac{c}{k}\\rfloor)+\\sum_{k=b}^{b+1}S(\\lfloor\\frac{b+1}{k}\\rfloor)$\n\n\u79fb\u9879\u5f97 $\\sum_{k=a}^{b-1}S(\\lfloor\\frac{b+1}{k}\\rfloor)\\leq \\sum_{k=a}^{b-1}S(\\lfloor\\frac{c}{k}\\rfloor)$\n\n\u663e\u7136\u6210\u7acb\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u4e8c\u5206\u51b3\u7b56\u70b9\u6216\u8005\u5206\u6cbb DP\u3002\u672c\u5904\u91c7\u7528\u7b2c\u4e00\u79cd\uff0c\u4f7f\u7528\u4e8c\u5206\u961f\u5217\u5b9e\u73b0\u3002\n\n\u611f\u89c9\u6bd4\u5206\u6cbb DP \u6162\u4e0d\u5c11\uff08\uff09\n\n\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt{n}+n\\log^2n)$\uff0c\u4f46\u662f\u8dd1\u5f97\u6bd4 $O(n\\sqrt{n}\\log n)$ \u8fd8\u6162\uff0c\u5927\u6982\u662f\u4eba\u50bb\u5e38\u6570\u5927\u3002\n\n![\u201c3s\u201d](https://cdn.luogu.com.cn/upload/image_hosting/oytm3hap.png)\n\n---\n# Code\n\u8fd9\u73a9\u610f\u5f00 $O2$ \u53cd\u800c\u66f4\u6162\u3002\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=1e5+1;\nint p[100010],cnt;\nbool vis[100010];\nint phi[100010];\nll sp[100010];\nll dp[20][100010];\nll sum1[100010][320];\nll sum2[100010][320];\nint s[100010][320];\nint lim[100010];\nstruct data{\n\tint x,r;\n\tdata(int u=0,int v=0){\n\t\tx=u,r=v;\n\t}\n}q[100010];\nint tl;\nint mmax(int x,int y){\n\treturn x>y?x:y;\n}\nint mmin(int x,int y){\n\treturn x<y?x:y;\n}\nvoid init(){\n\tfor(int i=2;i<=N;++i){\n\t\tif(!vis[i]){\n\t\t\tp[++cnt]=i;\n\t\t\tphi[i]=i-1;\n\t\t}\n\t\tfor(int j=1;j<=cnt&&p[j]*i<=N;++j){\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif(i%p[j]==0){\n\t\t\t\tphi[i*p[j]]=phi[i]*p[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*p[j]]=phi[i]*phi[p[j]];\n\t\t}\n\t}\n\tfor(int i=1;i<=N;++i)\n\tsp[i]=sp[i-1]+phi[i];\n\tfor(int i=1;i<=N;++i){\n\t\tlim[i]=sqrt(i);\n\t\tfor(int j=lim[i];j;--j)\n\t\tsum1[i][j]=sum1[i][j+1]+sp[s[i][j]=i/j];\n\t\tfor(int j=1;j<lim[i];++j)\n\t\tsum2[i][j]=sum2[i][j-1]+sp[j]*(s[i][j]-s[i][j+1]);\n\t\tsum2[i][lim[i]]=sum2[i][lim[i]-1]+sp[lim[i]]*(s[i][lim[i]]-mmax(lim[i],i/(lim[i]+1)));\n\t}\n}\nll c(int l,int r){\n\tint len=lim[r],x=r/l;\n\tll sum=sum2[r][min(x,len)]-(l>len?sp[x]*(l-mmax(len,r/(x+1))-1):0)+(r-l+1);\n\tif(l>len) return sum;\n\treturn sum+sum1[r][l];\n}\nint find(int i,int j,int k){\n\tint l=j,r=N+1;\n\twhile(l<r-1){\n\t\tint mid=(l+r)>>1;\n\t\tif(dp[k][i]+c(i+1,mid)<dp[k][j]+c(j+1,mid)) l=mid;\n\t\telse r=mid;\n\t}\n\treturn r;\n}\nvoid work(){\n\tfor(int i=1;i<=N;++i)\n\tdp[1][i]=c(1,i);\n\tfor(int i=1;i<=16;++i){\n\t\ttl=0;\n\t\tq[0].r=i+1;\n\t\tq[++tl]=data(i,N+1);\n\t\tfor(int j=i+1;j<=N;++j){\n\t\t\twhile(tl>1&&find(q[tl].x,j,i)<=q[tl-1].r) --tl;\n\t\t\tq[tl].r=find(q[tl].x,j,i);\n\t\t\tq[++tl]=data(j,N+1);\n\t\t}\n\t\tfor(int j=1,k=i+1;k<=N;++k){\n\t\t\tif(k==q[j].r) ++j;\n\t\t\tdp[i+1][k]=dp[i][q[j].x]+c(q[j].x+1,k);\n\t\t}\n\t}\n}\nint main(){\n\tinit();\n\twork();\n\tint t,n,k;\n\tscanf(\"%d\",&t);\n\twhile(t--){\n\t\tscanf(\"%d%d\",&n,&k);\n\t\tif(k>16||(1<<k)>n) printf(\"%d\\n\",n);\n\t\telse printf(\"%lld\\n\",dp[k][n]);\n\t}\n}\n```",
        "postTime": 1639659640,
        "uid": 90869,
        "name": "tylon2006",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1603D Artistic Partition"
    },
    {
        "content": "## Tag\n\n\u52a8\u6001\u89c4\u5212\uff0c\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u3002\n\n## Description\n\n\u5b9a\u4e49 $c(l,r)$ \u4e3a $l\\leq i\\leq j\\leq r$ \u4e2d $(i,j) \\ge l$ \u7684\u6570\u91cf\u3002\n\n\u5b9a\u4e49 $f(n,k)$ \u4e3a $\\sum\\limits_{i=1}^kc(x_i+1,x_{i+1})$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u5176\u4e2d $0=x_1 < x_2<x_3<\\cdots<x_{k+1}=n$\u3002\n\n\u4e00\u5171 $T$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u6c42\u51fa $f(n,k)$ \u7684\u503c\u3002\n\n$\\texttt{data range: } n,k \\leq 10^5, T\\leq 3\\times 10^5$\u3002\n\n## Solution\n\n\u597d\u9898\u3002\n\n\u5982\u679c\u5c06\u9898\u9762\u4e2d $c(l,r)$ \u7684\u5b9a\u4e49\u7a0d\u4f5c\u6539\u53d8\uff0c\u8bbe $c(l,r)$ \u4e3a $l\\leq i < j \\leq r$ \u4e2d $(i,j) \\ge l$ \u7684\u6570\u91cf\u7684\u8bdd\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5f88\u5bb9\u6613\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\u5c31\u662f $c(x,2x-1) = 0$\u3002\n\n\u6240\u4ee5\u5982\u679c $k$ \u503c\u5927\u4e8e $\\lg n$ \u7684\u8bdd\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u5f97\u51fa\u4e00\u79cd\u6784\u9020 $[1,1],[2,3],[4,7],\\cdots$\u3002\n\n\u8fd9\u6837\u53ef\u4ee5\u5728 $\\lg n$ \u7684\u5e8f\u5217\u6570\u91cf\u4e2d\u5c31\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u4e86\u3002\n\n\u6240\u4ee5 $k > \\lg n$ \u7684\u65f6\u5019\u76f4\u63a5\u8f93\u51fa $n$ \u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u90a3\u4e48 $k$ \u7684\u6700\u5927\u503c\u5c31\u88ab\u9650\u5b9a\u5230\u4e86 $\\lg n$ \u4ee5\u5185\u4e86\uff0c\u4e4b\u540e\u590d\u6742\u5ea6\u5206\u6790\u7684\u65f6\u5019\u5c06\u4f1a\u628a $k$ \u7684\u590d\u6742\u5ea6\u5f53\u505a $\\lg n$ \u6765\u5206\u6790\u3002\n\n\u5bf9\u4e8e $f(n,k)$\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u4e00\u4e2a dp \u5f0f\u5b50\u3002\n$$\nf(n,k)=\\min_{i=1}^n\\{f(i-1,k-1)+c(i,n) \\}\n$$\n\u90a3\u4e48\u76f4\u63a5\u6c42\u89e3\u5c31\u662f $O(n^4\\lg n)$ \u7684\uff0c\u8fc7\u4e0d\u53bb\u3002\n\n\u53d1\u73b0 $c(l,r)$ \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u74f6\u9888\uff0c\u8bd5\u7740\u5feb\u901f\u6c42\u51fa $c(l,r)$\u3002\n$$\n\\begin{aligned}\nc(l,r) &= \\sum_{i=l}^r\\sum_{j=i+1}^r[(i,j)\\ge l]\\\\\n&= \\sum_{k=l}^r\\sum_{i=l}^r\\sum_{j=i+1}^r [(i,j)=k]\\\\\n&= \\sum_{k=l}^r\\sum_{i=1}^{\\left\\lfloor\\frac rk\\right\\rfloor}\\sum_{j=i+1}^{\\left\\lfloor\\frac rk\\right\\rfloor}[(i,j)=1]\\\\\n&=\\sum_{k=l}^r\\sum_{i=1}^{\\left\\lfloor\\frac rk\\right\\rfloor}\\varphi(i)\n\\end{aligned}\n$$\n\u8fd9\u91cc\u8bbe $p(x)=\\sum\\limits_{i=1}^x\\varphi(i)$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728 $O(n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa $[1,n]$ \u6240\u6709\u7684 $p(x)$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u7684 $c(l,r)$ \u5c31\u53d8\u6210\u4e86\n$$\n\\sum_{i=l}^rp(\\left\\lfloor\\frac ri\\right\\rfloor)\n$$\n\u901a\u8fc7\u6574\u9664\u5206\u5757\u4f18\u5316\u53ef\u4ee5\u505a\u5230 $O(\\sqrt n)$ \u7684\u67e5\u8be2\u4e00\u4e2a $c(l,r)$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u5230\u4e86 $O(n^2\\sqrt n\\lg n)$\u3002\n\n\u53d1\u73b0\u8fd9\u73a9\u610f\u2026\u2026\u957f\u5f97\u597d\u50cf\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u7684\u4f18\u5316\u5f62\u5f0f\u554a\u3002\n\n\u5982\u679c\u8bc1\u660e\u4e86 $c(i,k)+c(j,l)\\leq c(i,l)+c(j,k),i\\leq j\\leq k\\leq l$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53ef\u4ee5\u901a\u8fc7\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u4f18\u5316\u4e86\u3002\n\n\u4ee4 $f(k,l,r)= \\sum\\limits_{i=l}^rp(\\left\\lfloor\\frac ki\\right\\rfloor)$\u3002\n\n\u90a3\u4e48\u6709\n$$\n\\begin{aligned}\nc(i,k)+c(j,l) &= f(k,i,k)+f(l,j,l)\\\\\n&=(f(k,j,k)+f(k,i,j-1))+(f(l,i,l)-f(l,i,j-1))\\\\\n&= c(i,l)+c(j,k)+(f(k,i,j-1)-f(l,i,j-1))\n\\end{aligned}\n$$\n\u6613\u8bc1 $f(l,i,j-1)\\ge f(k,i,j-1)$\u3002\n\n\u6240\u4ee5 $c(i,k)+c(j,l)\\leq c(i,l)+c(j,k)$\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u7684\u5206\u6cbb\u505a\u6cd5\u76f4\u63a5\u505a\u4e86\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u505a\u5230 $O(n^{\\frac 32}\\lg n)$ \u4e86\u3002\n\n## Code\n\n```cpp\nusing ll = long long;\n\nconst int N = 1e5 + 10;\nconst ll INF = 1e18;\n\nint n, t, k;\nll dp[N][20], p[N];\n\nint cnt;\nll phi[N], prm[N];\nbitset<N> vis;\ninline void prep(const int lim) {\n    phi[1] = 1;\n    for(int i = 2; i <= lim; i++) {\n        if(!vis[i]) prm[++cnt] = i, phi[i] = i - 1;\n        for(int j = 1; j <= cnt && i * prm[j] <= lim; j++) {\n            vis[i * prm[j]] = true;\n            if(i % prm[j] == 0) {\n                phi[i * prm[j]] = phi[i] * prm[j];\n                break;\n            }\n            phi[i * prm[j]] = phi[i] * (prm[j] - 1);\n        }\n    }\n    for(int i = 1; i <= lim; i++) p[i] = p[i - 1] + phi[i];\n    return ;\n}\n\ninline ll C(const int lef, const int rig) {\n    if(lef > rig) return INF;\n    ll ret = 0;\n    for(int l = lef, r; l <= rig; l = r + 1) {\n        r = (rig / (rig / l));\n        ret += (r - l + 1) * p[rig / l];\n    }\n    return ret;\n}\n\nvoid cdq(int o, int lef, int rig, int oplef, int oprig) {\n    if(lef > rig) return ;\n    int mid = (lef + rig) >> 1;\n    dp[mid][o] = INF;\n    ll va = C(min(mid, oprig) + 1, mid);\n    int op = oplef;\n    for(int k = min(mid, oprig); k >= oplef; k--) {\n        ll tem = dp[k][o - 1] + va;\n        if(tem <= dp[mid][o]) dp[mid][o] = tem, op = k;\n        if(k <= mid) {\n            if(va == INF) va = p[mid / k];\n            else va += p[mid / k];\n        }\n    }\n    cdq(o, lef, mid - 1, oplef, op);\n    cdq(o, mid + 1, rig, op, oprig);\n    return ;\n}\n\ninline void init() {\n    prep(N - 1);\n    n = 100000;\n    for(int i = 1; i <= n; i++) dp[i][0] = INF;\n    for(int i = 1; i <= n; i++) dp[i][1] = (ll) i * (i + 1) / 2;\n    for(int i = 2; i <= 17; i++) cdq(i, 1, n, 1, n);\n    return ;\n}\n\ninline void input() {\n    n = rd, k = rd;\n    return ;\n}\n\ninline void work() {\n    if(k >= 18 || (1 << k) > n) return cout << n << '\\n', void();\n    cout << dp[n][k] << '\\n';\n    return ;\n}\n\ninline void solve() {\n    init();\n    int t = rd;\n    while(t--) {\n        input();\n        work();\n    }\n    return ;\n}\n```\n\n## Final\n\n\u5199\u6210 `(1 << k) >= n` \u4f1a $\\text{Wrong answer on test 2}$\uff0c\u539f\u56e0\u662f $n=2,k=1$ \u7684\u65f6\u5019\u5e94\u8be5\u8f93\u51fa $3$\uff0c\u4f46\u662f\u8fd9\u6837\u5224\u65ad\u4e4b\u540e\u5c31\u4f1a\u8f93\u51fa $2$\u3002\n\n\u6ce8\u610f\u5f00 `long long`\u3002",
        "postTime": 1635937219,
        "uid": 366935,
        "name": "KAMIYA_KINA",
        "ccfLevel": 7,
        "title": "CF1603D Artistic Partition \u9898\u89e3"
    },
    {
        "content": "\u5bb9\u6613\u53d1\u73b0\uff0c\u82e5 $k>\\log n$ \u65f6 $f(n,k)=n$\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u5212\u5206\u51fa $[1,1],[2,3],[4,7],\\cdots,[2^{\\lfloor\\log n\\rfloor},n]$ \u4e2a\u533a\u95f4\uff0c\u4f7f\u5f97\u7b54\u6848\u4e3a $n$\u3002\n\n\u66b4\u529b DP\uff1a$f_{n,k}=\\max\\limits_{i=0}^{n-1} f_{i,k-1}+c(i+1,n)$\u3002\n\n\u5148\u8003\u8651\u4f18\u5316\u8ba1\u7b97 $c(l,r)$ \u7684\u590d\u6742\u5ea6\uff1a\n$$\n\\begin{aligned}\nc(l,r)=&\\sum\\limits_{i=l}^r\\sum\\limits_{j=i}^r[\\gcd(i,j)\\ge l]\\\\\n=&\\sum\\limits_{k=l}^r\\sum\\limits_{i=l}^r\\sum\\limits_{j=i}^r[\\gcd(i,j)=k]\\\\\n=&\\sum\\limits_{k=l}^r\\sum\\limits_{i=1}^{\\lfloor\\frac rk\\rfloor}\\sum\\limits_{j=i}^{\\lfloor\\frac rk\\rfloor}[\\gcd(i,j)=1]\\\\\n=&\\sum\\limits_{k=l}^r\\sum\\limits_{j=2}^{\\lfloor\\frac rk\\rfloor}\\sum\\limits_{i=1}^{j}[\\gcd(i,j)=1]\\\\\n=&\\sum\\limits_{k=l}^r\\sum\\limits_{j=1}^{\\lfloor\\frac rk\\rfloor}\\varphi(j)\\\\\n=&\\sum\\limits_{k=l}^rs(\\lfloor\\frac rk\\rfloor)\n\\end{aligned}\n$$\n\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u6570\u8bba\u5206\u5757 $O(\\sqrt n)$ \u6c42\u503c $c(l,r)$ \u4e86\u3002\n\n\u6211\u4eec\u9884\u5904\u7406\u51fa\u5bf9\u6bcf\u4e2a $r$ \u505a\u540e\u7f00\u548c\uff0c\u5c31\u53ef\u4ee5 $O(1)$ \u6c42\u503c $c(l,r)$ \u4e86\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt n)$\u3002\n\n\u6211\u4eec\u5b9a\u4e49 $f(i,j,r)=\\sum\\limits_{k=i}^js(\\lfloor\\frac rk\\rfloor)$\u3002\u5bf9\u4e8e $i\\le j\\le k\\le l$\uff0c\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e $c(i,k)+c(j,l)\\le c(i,l)+c(j,k)$\u3002\n$$\n\\begin{aligned}\nc(i,l)+c(j,k)=&f(i,l,l)+f(j,k,k)\\\\\n=&f(i,j-1,l)+f(j,l,l)+f(i,k,k)-f(i,j-1,k)\\\\\n=&f(i,j-1,l)-f(i,j-1,k)+c(j,l)+c(i,k)\\\\\n\\ge &c(j,l)+c(i,k)\n\\end{aligned}\n$$\n\u6211\u4eec\u73b0\u5728\u8bc1\u660e\u4e86 $c$ \u6ee1\u8db3\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff0c\u90a3\u4e48\u8be5 DP \u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u76f4\u63a5\u5206\u6cbb\u4f18\u5316\u5c31\u884c\u4e86\uff0c\u590d\u6742\u5ea6 $O(nk\\log n)$\u3002\n\n```cpp\n#include<iostream>\nint n=1e5,k,cnt,p[100010],np[100010],sq[100010];\nlong long phi[100010],f[20][100010],s1[100010][320],s2[100010][320];\nlong long c(int l,int r){\n\tif(l>r) return 1e16;\n\tif(r/l<=sq[r]) return s1[r][r/l]-phi[r/l]*(l-1-r/(r/l+1));\n\telse return s2[r][l];\n}\nvoid solve(long long *g,long long *f,int l,int r,int pl,int pr){\n\tif(l>r) return;\n\tint p=0,mid=(l+r)>>1;\n\tf[mid]=1e16;\n\tfor(int i=pl;i<=pr;i++) if(g[i]+c(i+1,mid)<f[mid]) p=i,f[mid]=g[i]+c(i+1,mid);\n\tsolve(g,f,l,mid-1,pl,p),solve(g,f,mid+1,r,p,pr);\n}\nint main(){\n\tstd::ios::sync_with_stdio(false),std::cin.tie(nullptr);\n\tphi[1]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tif(!np[i]) p[++cnt]=i,phi[i]=i-1;\n\t\tfor(int j=1;j<=cnt&&i*p[j]<=n;j++){\n\t\t\tnp[i*p[j]]=1;\n\t\t\tif(i%p[j]==0){\n\t\t\t\tphi[i*p[j]]=phi[i]*p[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*p[j]]=phi[i]*phi[p[j]];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) phi[i]+=phi[i-1];\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j*j<=i;j++){\n\t\t\ts1[i][j]=s1[i][j-1]+phi[j]*(i/j-i/(j+1));\n\t\t\tsq[i]=j;\n\t\t}\n\t\ts2[i][i/(sq[i]+1)+1]=s1[i][sq[i]];\n\t\tfor(int j=i/(sq[i]+1);j;j--){\n\t\t\ts2[i][j]=s2[i][j+1]+phi[i/j];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) f[1][i]=c(1,i);\n\tfor(int i=2;i<=17;i++) solve(f[i-1],f[i],1,n,1,n);\n\tint T;\n\tstd::cin>>T;\n\twhile(T--){\n\t\tstd::cin>>n>>k;\n\t\tif(k>17) std::cout<<n<<'\\n';\n\t\telse std::cout<<f[k][n]<<'\\n';\n\t}\n\treturn 0;\t\n}\n```\n\n",
        "postTime": 1635852578,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "CF1603D Artistic Partition"
    }
]