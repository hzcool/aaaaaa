[
    {
        "content": "\n\u4e3a\u4e86\u8868\u793a\u65b9\u4fbf\uff0c\u4e0b\u6587\u5047\u8bbe $n$ \u4e3a $S$ \u7684\u5927\u5c0f\uff0c$L_i=S$ \u4e2d**\u6700\u5c0f**\u7684 $i$ \u4e2a\u6570\u4e4b\u548c\uff0c$R_i=S$ \u4e2d**\u6700\u5927**\u7684 $i$ \u4e2a\u6570\u4e4b\u548c\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e00\u4e2a $x$ \u88ab\u7edf\u8ba1\u8fdb\u5165\u7b54\u6848\uff0c\u5f53\u524d\u4ec5\u5f53\uff1a\n\n$$\n \\exists \\ i,L_i\\le x <R_i\n$$\n\n\u6211\u4eec\u8981\u7edf\u8ba1\u8fd9\u6837\u7684 $x$ \u7684\u4e2a\u6570\uff0c\u6240\u4ee5\u5176\u5b9e\u6211\u4eec\u76f8\u5f53\u4e8e\u5728\u8be2\u95ee $n$ \u4e2a $[L_i,R_i)$ \u533a\u95f4\u7684\u533a\u95f4\u5e76\u5927\u5c0f\u3002\n\n\u76f4\u63a5\u7ef4\u62a4\u663e\u7136\u4e0d\u5927\u597d\u7ef4\u62a4\uff0c\u8003\u8651\u7ee7\u7eed\u6316\u6398 $L_i$ \u548c $R_i$ \u7684\u6027\u8d28\uff0c\u53ef\u4ee5\u53d1\u73b0\u6709\uff1a\n$$\n\\begin{aligned}\n\n&L_i-L_{i-1}\\ge L_{i-1}-L_{i-2}\\\\\n&R_i-R_{i-1}\\le R_{i-1}-R_{i-2}\n\n\\end{aligned}\n$$\n\n\u5373 $L$ \u7684\u5dee\u9012\u589e\uff0c $R$ \u7684\u5dee\u9012\u51cf\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u6027\u8d28\u4e4b\u540e\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e9b\u533a\u95f4\u53ef\u4ee5\u5206\u4e3a $3$ \u6bb5\uff08\u6211\u5f00\u59cb\u4ee5\u4e3a\u662f $2$ \u6bb5\u505a\u9519\u534a\u5929\uff09\uff0c\u5176\u4e2d\u7b2c $1$ \u6bb5\u548c\u7b2c $3$ \u6bb5\u6ee1\u8db3 $R_i <L_{i+1}$\uff0c\u7b2c $2$ \u6bb5\u6ee1\u8db3 $R_i \\ge L_{i+1}$\u3002\n\n\u8bbe\u7b2c $2$ \u6bb5\u7684\u7aef\u70b9\u5206\u522b\u662f $pl,pr$\uff0c\u90a3\u4e48\u6709\uff1a\n$$\n ans=\\sum_{i=1}^{pl-1}(R_i-L_i)+\\sum_{i=pr+1}^{n}(R_i-L_i)+(R_{pr}-L_{pl})\n$$\n\n\n\u53ef\u4ee5\u5206\u4e3a $3$ \u6bb5\u7684\u5927\u6982\u539f\u56e0\u662f\uff0c\u53ef\u80fd\u4e00\u5f00\u59cb $L_{i+1}>R_i$\uff0c\u4f46\u56e0\u4e3a $R_i$ \u7684\u589e\u957f\u53ef\u80fd\u6bd4 $L_{i+1}$ \u5feb\uff0c\u56e0\u6b64\u540e\u6765\u4f1a\u8fdb\u5165\u7b2c $2$ \u6bb5\u3002\n\n\u8fdb\u5165\u7b2c $2$ \u6bb5\u4e4b\u540e $R_i$ \u7684\u589e\u957f\u8d8a\u6765\u8d8a\u6162\uff0c\u800c $L_{i+1}$ \u7684\u589e\u957f\u8d8a\u6765\u8d8a\u5feb\uff0c\u6240\u4ee5\u4e00\u65e6\u518d\u6b21\u6ee1\u8db3 $L_{i+1}>R_i$\uff0c\u90a3\u4e48\u8fd9\u4e00\u70b9\u5230\u6700\u540e\u90fd\u4e0d\u4f1a\u6539\u53d8\u3002\n\n\u8003\u8651\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\u3002\u7528\u4e8c\u5206\u627e\u51fa $pl$ \u548c $pr$\uff0c\u7136\u540e\u8be2\u95ee\u4e00\u4e2a\u533a\u95f4\u524d\u7f00\u548c/\u533a\u95f4\u540e\u7f00\u548c\uff0c\u663e\u7136\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u5f88\u7b80\u5355\u7684\u7ef4\u62a4\u3002\n\n\u56e0\u4e3a\u4e8c\u5206\u65f6\u8fd8\u9700\u8981\u7528\u7ebf\u6bb5\u6811\u8fdb\u884c\u8be2\u95ee\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$ \u3002\uff08\u5047\u8bbe $n,q$ \u540c\u9636\uff09\n\n\u6ce8\u610f\u8981\u79bb\u6563\u5316\uff0c\u4e0d\u7136\u4f1a\u88ab\u5361\u5e38 ~~\uff08\u522b\u95ee\u6211\u662f\u600e\u4e48\u77e5\u9053\u7684\uff09~~\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define inf 1e13\n#define eps 1e-6\n#define mp make_pair\n#define pb push_back\n#define re register ll\n#define fr first\n#define sd second\n#define pa pair<ll,ll>\n#define FOR(i,a,b) for(re i=a;i<=b;i++)\n#define REP(i,a,b) for(re i=a;i>=b;i--)\n#define MEM(a) memset(a,0,sizeof(a))\n#define N 200010\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef double db;\ninline ll read()\n{\n\tchar ch=getchar();\n\tll s=0,w=1;\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){s=s*10+ch-'0';ch=getchar();}\n\treturn s*w;\n}\ninline ll lowbit(ll x){return x&(-x);}\nstruct node\n{\n\tll sum,LS,RS,num;// LS \u662f\u524d\u7f00\u548c\uff0c RS \u662f\u540e\u7f00\u548c \n}t[N*60];\nnode st[N];ll top=0;\nint ls[N*60],rs[N*60];\nll n,q,tot;int rt;\nll a[N],x[N],op[N],p[N<<1],tmp;\n#define mid ((l+r)>>1)\ninline void pushup(ll x)\n{\n\tt[x].num=t[ls[x]].num+t[rs[x]].num;\n\tt[x].sum=t[ls[x]].sum+t[rs[x]].sum;\n\tt[x].LS=t[ls[x]].LS+t[rs[x]].LS+t[rs[x]].num*t[ls[x]].sum;\n\tt[x].RS=t[ls[x]].RS+t[rs[x]].RS+t[ls[x]].num*t[rs[x]].sum; \n}\nvoid add(ll l,ll r,int &x,ll pos,ll opt)\n{\n\tif(!x)x=++tot;\n\tif(l==r)\n\t{\n\t\tif(opt>0){t[x].num=1;t[x].sum=t[x].LS=t[x].RS=p[l];}\n\t\telse {t[x].num=0;t[x].sum=t[x].LS=t[x].RS=0;}\n\t\treturn ;\n\t}\n\tif(pos<=mid)add(l,mid,ls[x],pos,opt);\n\telse add(mid+1,r,rs[x],pos,opt);\n\tpushup(x);\n}\nll qk(ll l,ll r,ll x,ll k,ll op,ll &s)// \u8be2\u95ee\u7b2c k \u5c0f\u4e0e\u524d k \u5c0f\u7684\u548c/\u524d k \u5927\u4e0e\u524d k \u5927\u7684\u548c\n{\n\tif(l==r){s+=p[l];return l;}\n\tif(!op)\n\t{\n\t\tif(t[ls[x]].num>=k)return qk(l,mid,ls[x],k,op,s);\n\t\telse {s+=t[ls[x]].sum;return qk(mid+1,r,rs[x],k-t[ls[x]].num,op,s);}\n\t}\n\telse\n\t{\n\t\tif(t[rs[x]].num>=k)return qk(mid+1,r,rs[x],k,op,s);\n\t\telse {s+=t[rs[x]].sum;return qk(l,mid,ls[x],k-t[rs[x]].num,op,s);}\n\t}\n}\nvoid qry(ll l,ll r,ll x,ll ql,ll qr)//\u5c06\u4e00\u4e2a\u533a\u95f4\u7684\u7ebf\u6bb5\u6811\u8282\u70b9\u53d6\u51fa\n{\n\tif(ql>qr||!x)return ;\n\tif(l==ql&&r==qr){st[++top]=t[x];return ;}\n\tif(qr<=mid)qry(l,mid,ls[x],ql,qr);\n\telse if(ql>mid)qry(mid+1,r,rs[x],ql,qr);\n\telse {qry(l,mid,ls[x],ql,mid);qry(mid+1,r,rs[x],mid+1,qr);}\n}\ninline ll QS(ll l,ll r)//\u8be2\u95ee\u533a\u95f4\u548c\n{\n\ttop=0;qry(1,tmp,rt,l,r);\n\tll s=0;FOR(i,1,top)s+=st[i].sum;\n\treturn s;\n}\ninline ll qsum(ll l,ll r,ll op)//\u8be2\u95ee\u533a\u95f4\u524d\u7f00\u548c/\u540e\u7f00\u548c\n{\n\ttop=0;qry(1,tmp,rt,l,r);\n\tll s=0,ans=0;\n\tif(op==0){FOR(i,1,top){ans+=st[i].LS+s*st[i].num;s+=st[i].sum;}}\n\tif(op==1){REP(i,top,1){ans+=st[i].RS+s*st[i].num;s+=st[i].sum;}}\n\treturn ans;\n}\ninline ll qans()\n{\n\tif(n==0){return 0;}\n\tll l=1,r=n-1,pl=0,pr=0;\n\tll ans=0;\n\twhile(l<=r)\n\t{\n\t\tll s1=0,s2=0;\n\t\tll R=qk(1,tmp,rt,mid+1,0,s1),L=qk(1,tmp,rt,mid,1,s2);\n\t\tif(s1<=s2)pl=mid,r=mid-1;\n\t\telse l=mid+1;\n\t}\n\tl=1,r=n-1;\n\twhile(l<=r)\n\t{\n\t\tll s1=0,s2=0;\n\t\tll R=qk(1,tmp,rt,mid+1,0,s1),L=qk(1,tmp,rt,mid,1,s2);\n\t\tif(s1<=s2)pr=mid+1,l=mid+1;\n\t\telse r=mid-1;\n\t}\n\tif(pl==0){return qsum(1,tmp,1)-qsum(1,tmp,0);}\n\tif(pr<n)\n\t{\n\t\tll s=0;\n\t\tll L=qk(1,tmp,rt,pr+1,0,s),R=qk(1,tmp,rt,pr+1,1,s);\n\t\tans+=qsum(1,R-1,1)+QS(R,tmp)*(n-pr);\n\t\tans-=qsum(L+1,tmp,0)+QS(1,L)*(n-pr);\n\t}\n\tif(pl>1)\n\t{\n\t\tll s=0;\n\t\tll L=qk(1,tmp,rt,pl-1,0,s),R=qk(1,tmp,rt,pl-1,1,s);\n\t\tans+=qsum(R,tmp,1);ans-=qsum(1,L,0);\n\t}\n\tll s=0;\n\tans-=QS(1,qk(1,tmp,rt,pl,0,s));ans+=QS(qk(1,tmp,rt,pr,1,s),tmp);\n\treturn ans;\n}\nint main()\n{\n\t//ios::sync_with_stdio(false);\n\t//freopen(\"CF1500E.in\",\"r\",stdin);\n\t//freopen(\"CF1500E.out\",\"w\",stdout);\n\tn=read(),q=read();\n\tFOR(i,1,n)a[i]=read(),p[++tmp]=a[i];\n\tFOR(i,1,q)op[i]=read(),x[i]=read(),p[++tmp]=x[i];\n\tsort(p+1,p+tmp+1);tmp=unique(p+1,p+tmp+1)-p-1;\n\tFOR(i,1,n)a[i]=lower_bound(p+1,p+tmp+1,a[i])-p;\n\tFOR(i,1,q)x[i]=lower_bound(p+1,p+tmp+1,x[i])-p;\n\tFOR(i,1,n)add(1,tmp,rt,a[i],1);\n\tcout<<qans()<<'\\n';\n\tFOR(i,1,q)\n\t{\n\t\tll opt=op[i],X=x[i];\n\t\tif(opt==1){add(1,tmp,rt,X,1);n++;}\n\t\tif(opt==2){add(1,tmp,rt,X,-1);n--;}\n\t\tcout<<qans()<<'\\n';\n\t}\n\treturn 0;\n}\n```\n**\u5982\u679c\u4f60\u89c9\u5f97\u8fd9\u7bc7\u9898\u89e3\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u90a3\u4f60\u53ef\u4ee5\u70b9\u4e2a\u8d5e\u652f\u6301\u6211\u4e00\u4e0bqwq\u3002\u5982\u679c\u4f60\u5bf9\u9898\u89e3\u6709\u4efb\u4f55\u95ee\u9898/\u8ba4\u4e3a\u6211\u7684\u9898\u89e3\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u53ef\u4ee5\u79c1\u4fe1/\u5728\u8bc4\u8bba\u533a\u53d1\u51fa\u6765\uff0c\u5f53\u7136\u5982\u679c\u4f60\u5bf9\u6211\u7684\u9898\u89e3\u6709\u4efb\u4f55\u610f\u89c1/\u5efa\u8bae\u4e5f\u6b22\u8fce\u6307\u51fa\u3002\u6211\u4f1a\u5c3d\u6211\u5168\u529b\u628a\u6211\u9898\u89e3\u5199\u5230\u6700\u597d\u7684qwq**\n",
        "postTime": 1615983693,
        "uid": 72419,
        "name": "WAPER4EVER",
        "ccfLevel": 7,
        "title": "CF1500E Subset Trick"
    },
    {
        "content": "*3300 \u7684\u795e\u4ed9\u9898\u2026\u2026\u601d\u8def\u662f\u81ea\u5df1\u60f3\u51fa\u6765\u4e86\uff0c\u4f46\u662f\u6f0f\u6d1e\u767e\u51fa\uff0c\u4e0d\u5f97\u4e0d\u501f\u52a9\u9898\u89e3\u2026\u2026\n\n---\n\n\u9996\u5148\u4f60\u8003\u8651\u679a\u4e3e\u53d6\u51fa\u7684\u5b50\u96c6\u5927\u5c0f $s$\u3002\u90a3\u4e48\u663e\u7136\uff0c\u82e5 $S$ \u4e2d\u524d $s$ \u5c0f\u7684\u6570\u7684\u548c\u4e3a $l$\uff0c\u524d $s$ \u5927\u7684\u6570\u7684\u548c\u4e3a $r$\uff0c\u90a3\u4e48 $x\\in[l,r)$ \u90fd\u53ef\u4ee5\u7b97\u3002\u6240\u4ee5\u8981\u6c42\u7684\u5c31\u662f\u5bf9\u6240\u6709\u7684 $s$\uff0c$[l,r)$ \u7684\u5e76\u7684\u5927\u5c0f\u3002\n\n\u5982\u4f55\u6c42\u5e76\u7684\u5927\u5c0f\uff1f\u8003\u8651\u50cf SA \u6c42\u672c\u8d28\u4e0d\u540c\u5b50\u4e32\u4e2a\u6570\u90a3\u6837\uff0c$s\\uparrow$ \u5730\u679a\u4e3e\u533a\u95f4 $[l,r)$\uff0c\u6bcf\u6b21\u7b97\u5f53\u524d $[l,r)$ \u4e2d\u4ee5\u524d\u6ca1\u88ab\u7b97\u8fc7\u7684\u3002\u4e0d\u96be\u53d1\u73b0\u5f53 $s\\uparrow$ \u65f6 $l\\uparrow,r\\uparrow$\uff0c\u4e8e\u662f\u4e0d\u96be\u5f97\u51fa\uff0c\u8981\u6709\u91cd\u590d\u7684\u8bdd\uff0c\u5168\u90e8\u88ab\u4e0a\u4e00\u4e2a $s$ \u7ed9\u5305\u4e86\u3002\u4e8e\u662f\u6211\u4eec\u53ea\u8981\u6c42 $\\sum(r_i-l_i)-\\sum\\max(0,r_i-l_{i+1})$\u3002\n\n\u6c42\u524d\u9762\u90a3\u4e2a\u548c\u5f0f\u7684\u8bdd\uff0c\u9700\u8981\u652f\u6301\u63d2\u5165\u5220\u9664\u5730\u7ef4\u62a4\u6709\u5e8f\u5e8f\u5217\u7684\u524d\u540e\u7f00\u548c\u7684\u533a\u95f4\u548c\u3002\u63d2\u5165\u5220\u9664\u4e0d\u96be\u60f3\u5230\u5e73\u8861\u6811\uff0c\u90a3\u4e48\u8111\u5b50\u4e2d\u4e0d\u96be\u8111\u8865\u51fa\uff0c\u7ef4\u62a4\u524d\u540e\u7f00\u548c\u5e8f\u5217\u7684\u5e73\u8861\u6811\u5728\u63d2\u5165\u5220\u9664\u7684\u65f6\u5019\uff0c\u5c31\u662f\u63d2\u5165 / \u5220\u9664\u4e00\u4e2a\u65b0\u5143\u7d20\uff0c\u7136\u540e\u628a\u67d0\u6bb5\u540e\u7f00\u6574\u4f53\u52a0\u4e0a\u67d0\u4e2a\u503c\u3002\u7136\u540e\u8981\u6c42\u533a\u95f4\u548c\u7684\u8bdd\u5e73\u8861\u6811\u663e\u7136\u662f\u53ef\u4ee5\u505a\u5230\u7684\u3002\n\n\u5bf9\u540e\u8005\u600e\u4e48\u641e\u5462\uff1f\u4f60\u8003\u8651\u90a3\u4e9b $r_i-l_{i+1}\\geq 0$ \u7684\u505a\u8d21\u732e\uff0c\u5728\u8fd9\u4e00\u9898\u4e2d\u6709\u5947\u5999\u7684\u6027\u8d28\uff1a\u5bb9\u6613\u53d1\u73b0\u5f53 $s\\uparrow$ \u65f6\uff0c$l_i$ \u589e\u957f\u7684\u8d8a\u6765\u8d8a\u5feb\uff0c$r_i$ \u589e\u957f\u7684\u8d8a\u6765\u8d8a\u6162\uff0c\u6240\u4ee5 $r_i-l_{i+1}$ \u662f\u589e\u957f\u7684\u8d8a\u6765\u8d8a\u6162\u7684\uff0c\u6240\u4ee5\u662f\u4e00\u4e2a\u5355\u5cf0\u51fd\u6570\uff0c\u6d6e\u5728 $x$-axis \u4e0a\u7684\u6070\u597d\u662f\u4e00\u6bb5\u533a\u95f4\u3002\u600e\u4e48\u6c42\u8fd9\u6bb5\u533a\u95f4\u5462\uff1f\u5148\u4e09\u5206\uff08\u5373\u5bf9\u5dee\u5206 / \u5bfc\u6570\u4e8c\u5206\uff09\u51fa\u6781\u503c\u70b9\uff0c\u7136\u540e\u5f80\u4e24\u8fb9\u4e8c\u5206\u51fa\u5de6\u53f3\u7aef\u70b9\u3002\u7136\u540e\u5c31\u662f\u4e2a\u524d\u540e\u7f00\u548c\u7684\u533a\u95f4\u548c\u7684\u4e8b\u60c5\u4e86\uff0c\u7528\u4e4b\u524d\u7684\u5e73\u8861\u6811\u6070\u597d\u53ef\u4ee5\u505a\u5230\u3002\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u2026\u2026\uff1f\n\n\u65f6\u95f4\u590d\u6742\u5ea6 2log\uff08\u4e09\u5206\u3001\u4e8c\u5206 + \u5e73\u8861\u6811\uff09\u3002\u4e0d\u8fc7\u5e38\u6570\u51fa\u5947\u7684\u5927\uff0c\u4e00\u662f\u5e73\u8861\u6811\uff0c\u4e8c\u662f\u6bcf\u6b21\u4e00\u6b21\u4e09\u5206\u4e24\u6b21\u4e8c\u5206\uff0c\u4e09\u662f\u4e2d\u95f4\u7ed3\u679c\u53ef\u80fd\u7206 ll\uff08\u5373\u4f7f\u6700\u7ec8\u7ed3\u679c\u4e0d\u4f1a\uff09\u8981\u5f00 i128\u3002\u6240\u4ee5\u5c31\u7b97\u662f 3s TL \u52a0\u4e0a CF \u673a\u5b50\u4e5f\u8dd1\u4e0d\u8fc7\u53bb\u3002\u8fd9\u65f6\u5019\u5c31\u4e0d\u5f97\u4e0d\u501f\u52a9\u9898\u89e3\u4e86/kel\uff0c\u7136\u540e\u53d1\u73b0\u6211\u7684\u601d\u8def\u5168\u662f\u4e0d\u5b8c\u5584\u7684\u5730\u65b9\u3002\n\n1. \u5e73\u8861\u6811\u3002\u4f60\u7ef4\u62a4\u7684\u662f\u4e00\u4e2a\u6709\u5e8f\u6570\u5217\uff0c\u800c\u4e0d\u662f\u666e\u901a\u6570\u5217\uff0c\u666e\u901a\u6570\u5217\u4e0d\u6ee1\u8db3\u5355\u8c03\u6027\u7528\u5e73\u8861\u6811\u7ef4\u62a4\uff0c\u4f60\u8fd9\u539f\u5e8f\u5217\u3001\u524d\u540e\u7f00\u548c\u5e8f\u5217\u90fd\u6ee1\u8db3\u5355\u8c03\u6027\uff0c\u5176\u5b9e\u5b8c\u5168\u53ef\u4ee5\u5f53\u6210\u4e00\u4e2a\u96c6\u5408\u7ef4\u62a4\uff0c\u4e00\u4e2a\u503c\u57df\u7ebf\u6bb5\u6811\u5c31\u591f\u4e86\u3002\u524d\u540e\u7f00\u548c\u5e8f\u5217\u4e5f\u4e0d\u7528\u5355\u72ec\u5f00\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u8fd9\u4e2a\u662f\u7ebf\u6bb5\u6811\u8282\u70b9\u5185\u5bb9\u6613\u50a8\u5b58\u3001\u66f4\u65b0\u7684\u3002\u5e76\u4e14\u79bb\u6563\u5316\u4e00\u4e0b\u66f4\u597d\uff0c\u8fd9\u6837\u5e38\u6570\u4f1a\u66f4\u5c0f\uff1b\n2. \u4e09\u5206\u3002\u8fd9\u4e2a\u5355\u5cf0\u51fd\u6570\u4e0d\u4ec5\u662f\u5355\u5cf0\u51fd\u6570\uff0c\u7a0d\u5fae\u60f3\u4e00\u4e0b\u53d1\u73b0\u5b83\u8fd8\u662f\u955c\u50cf\u7684\u2026\u2026\u2026\u2026\u4e8e\u662f\u6781\u503c\u70b9\u80af\u5b9a\u5728\u6700\u4e2d\u95f4\uff0c\u7136\u540e\u53ea\u5f80\u4e00\u8fb9\u4e8c\u5206\uff0c\u53e6\u4e00\u8fb9\u955c\u50cf\u8fc7\u53bb\u5e76\u5fae\u8c03\u3002\u8fd9\u6837\u5c31\u628a \u4e09\u5206 * 1 + \u4e8c\u5206 * 2 \u53d8\u6210\u4e86 \u4e8c\u5206 * 1\uff1b\n3. i128\u3002\u5982\u679c\u662f ull\uff0c\u90a3\u4f60\u4f1a\u77e5\u9053\u4e0d\u7528\u62c5\u5fc3\u7206\u70b8\uff0c\u6700\u7ec8\u7ed3\u679c\u4e0d\u7206\u7684\u8bdd\uff0c\u4e2d\u95f4\u8fd0\u7b97\u7684\u65f6\u5019\u4f1a\u5728\u6a21\u610f\u4e49\u4e0b\u515c\u4e2a\u5708\u5b50\u6700\u7ec8\u56de\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002\u6ca1\u60f3\u5230 ll \u4e5f\u4e00\u6837\u2026\u2026\u90a3\u5c31\u53ea\u7528 ll \u5b58\u50a8\u4e86\u5427\uff01\n\n\u4e0d\u6127\u662f *3300 \u7684\u9898\u554a\u2026\u2026**_[code](https://www.luogu.com.cn/paste/csjbu4z3)_**",
        "postTime": 1617547939,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "CF1500E"
    },
    {
        "content": "[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/1500/problem/E) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1500E)\n\n\u4e00\u9053\u7ebf\u6bb5\u6811\u7684\u5957\u8def\u9898\uff08\u4f3c\u4e4e ycx \u4f1a\u505a\u8fd9\u9053\u9898\uff1forzorz\uff01\uff0111\uff09\n\n\u9996\u5148\u8003\u8651\u4ec0\u4e48\u6837\u7684 $x$ \u662f\u201c\u4e0d\u5408\u9002\u201d\u7684\uff0c\u6211\u4eec\u5047\u8bbe $a_1<a_2<a_3<\\cdots<a_{n-1}<a_n$\uff0c\u663e\u7136\u5982\u679c $\\exist k$ \u4f7f\u5f97 $a_1+a_2+\\cdots+a_k\\le x<a_{n-k+1}+a_{n-k+2}+\\cdots+a_{n}$\uff0c\u90a3\u4e48 $x$ \u5c31\u662f\u4e0d\u5408\u6cd5\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u6240\u6709 $x$ \u53ef\u53d6\u7684\u6570\u7ec4\u6210\u7684\u96c6\u5408\u4e3a $n$ \u4e2a\u5f62\u5982 $[a_1+a_2+\\cdots+a_k,a_{n-k+1}+a_{n-k+2}+\\cdots+a_{n})$ \u7684\u533a\u95f4\u7684\u5e76\uff0c\u800c\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u8fd9\u4e2a\u5e76\u96c6\u7684\u5927\u5c0f\u3002\n\n\u76f4\u63a5\u6c42\u5e76\u96c6\u4f3c\u4e4e\u4e0d\u662f\u7279\u522b\u5bb9\u6613\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u5b58\u5728\u533a\u95f4\u6709\u4ea4\uff0c\u8d21\u732e\u4e0d\u592a\u5bb9\u6613\u76f4\u63a5\u8ba1\u7b97\uff08\u5f53\u7136\u5982\u679c\u786c\u8981\u7b97\u4e5f\u662f\u53ef\u4ee5\u7b97\u7684\uff0c\u4e0d\u8fc7\u5206\u7c7b\u8ba8\u8bba\u5e94\u8be5\u4f1a\u4e0b\u9762\u7684\u89e3\u6cd5\u7a0d\u5fae\u590d\u6742\u4e9b\uff09\u3002\u6211\u4eec\u4e0d\u59a8\u8003\u8651\u6b63\u96be\u5219\u53cd\uff0c\u62ff\u603b\u4e2a\u6570\u51cf\u53bb\u201c\u5408\u9002\u201d\u7684 $x$ \u7684\u4e2a\u6570\uff0c\u8bb0 $A=\\sum\\limits_{i=1}^na_i$\uff0c\u90a3\u4e48\u5728\u533a\u95f4 $[0,A)$ \u4e2d\uff0c$x$ \u4e3a\u201c\u5408\u9002\u201d\u7684\u503c\u5f53\u4e14\u4ec5\u5f53 $\\exist k\\in[0,n-1]$ \u6ee1\u8db3 $a_{n-k+1}+a_{n-k+2}+\\cdots+a_n\\le x<a_1+a_2+\\cdots+a_k+a_{k+1}$\uff0c\u800c\u663e\u7136\u8fd9\u6837\u7684 $n$ \u4e2a\u533a\u95f4\u662f\u4e0d\u5b58\u5728\u4ea4\u96c6\u7684\uff0c\u56e0\u6b64\u201c\u5408\u9002\u7684\u201d $x$ \u7684\u4e2a\u6570\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5c06\u8fd9 $n$ \u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u76f8\u52a0\u6c42\u51fa\uff0c\u5373 $\\sum\\limits_{k=0}^{n-1}\\max((a_1+a_2+\\cdots+a_k+a_{k+1})-(a_{n-k+1}+a_{n-k+2}+\\cdots+a_n),0)$\uff08\u56e0\u4e3a\u53ef\u80fd\u5b58\u5728\u533a\u95f4\u4e3a\u7a7a\uff0c\u56e0\u6b64\u8981\u5bf9 $0$ \u53d6 $\\max$\uff09\u3002\u6211\u4eec\u8bb0 $f(k)=(a_1+a_2+\\cdots+a_k+a_{k+1})-(a_{n-k+1}+a_{n-k+2}+\\cdots+a_n)$\uff0c\u90a3\u4e48 $ans=\\sum\\limits_{k=0}^{n-1}\\max(f(k),0)$\uff0c\u8fd9\u8fb9\u5e26\u4e2a $\\max$\uff0c\u4e0d\u597d\u76f4\u63a5\u7b97\u51fa\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u59a8\u6765\u63a2\u7a76\u4e0b $f$ \u51fd\u6570\u6709\u4ec0\u4e48\u6027\u8d28\uff0c\u5f88\u5bb9\u6613\u53d1\u73b0 $f(k)$ \u6ee1\u8db3\u4ee5\u4e0b\u4e24\u4e2a\u6027\u8d28\uff1a\n\n- $f(k)=f(n-1-k)$\uff08\u63d0\u793a\uff1a\u5728\u5de6\u53f3\u4e24\u4e2a\u62ec\u53f7\u540c\u65f6\u52a0\u4e0a $a_{k+2}+a_{k+3}+\\cdots+a_{n-k}$\uff09\n- $\\forall x<y\\le\\dfrac{n-1}{2}$\uff0c$f(x)>f(y)$\uff08\u63d0\u793a\uff1a\u5bf9\u4e8e $k<\\dfrac{n-1}{2}$\uff0c$f(k)-f(k-1)=a_{k+1}-a_{n-k+1}<0$\uff09\n\n\u7b2c\u4e00\u4e2a\u6027\u8d28\u544a\u8bc9\u6211\u4eec\u53ef\u4ee5\u8ba1\u7b97\u524d\u4e00\u534a\uff08$k\\le\\dfrac{n-1}{2}$\uff09\u7684\u7b54\u6848\uff0c\u7136\u540e\u4e58\u4e2a $2$\uff0c\u5982\u679c $n$ \u662f\u5947\u6570\u518d\u51cf\u53bb $\\max(f(\\dfrac{n-1}{2}),0)$ \u5373\u53ef\u8ba1\u7b97\u6c42\u5f97\u6700\u7ec8\u7b54\u6848\u3002\u7b2c\u4e8c\u4e2a\u6027\u8d28\u544a\u8bc9\u6211\u4eec\u6ee1\u8db3 $f(k)>0,k<\\dfrac{n-1}{2}$ \u7684 $k$ \u662f\u4e00\u6bb5\u524d\u7f00\uff0c\u53ef\u4e8c\u5206\u627e\u5230\u6700\u5927\u7684\u6ee1\u8db3 $f(l)>0$ \u7684 $l$\uff0c\u8ba1\u7b97 $\\sum\\limits_{i=0}^lf(i)$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e0d\u5e26 $\\max$\uff0c\u76f4\u63a5\u8ba1\u7b97\u4e86\u3002\n\n \u6700\u540e\u662f\u5c31\u662f\u600e\u6837\u8ba1\u7b97 $f(l)$ \u548c\u4e00\u6bb5\u524d\u7f00\u7684 $f(l)$ \u7684\u95ee\u9898\u3002\u8003\u8651\u5c06 $a$ \u79bb\u6563\u5316\u5e76\u5efa\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u7136\u540e\u53ef\u5728\u6743\u503c\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u5728\u5bf9\u6570\u65f6\u95f4\u5185\u627e\u5230\u5168\u5c40\u7b2c $k$ \u5927\u7684\u503c\u4ee5\u53ca\u524d $k$ \u5927\u7684\u548c\u3002\u800c $\\sum\\limits_{i=0}^lf(i)=\\sum\\limits_{i=0}^l(\\sum\\limits_{j=1}^{i+1}a_j-\\sum\\limits_{j=n-i+1}^na_j)=\\sum\\limits_{j=1}^{l+1}a_j(l+1-j)-\\sum\\limits_{n-l+1}a_j(j-n+l)$\uff0c\u5728\u7ebf\u6bb5\u6811\u4e0a\u989d\u5916\u7ef4\u62a4 $\\sum\\limits_{i}a_ii$ \u5373\u53ef\uff0c\u8fd9\u4e1c\u897f\u4e5f\u53ef\u5728 $\\log n$ \u65f6\u95f4\u5185\u6c42\u51fa\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $n\\log^2n$\uff0c\u56e0\u4e3a\u5728\u627e\u6700\u5927\u7684 $f(l)>0$ \u7684 $l$ \u8fc7\u7a0b\u4e2d\u9700\u4e8c\u5206\uff0c\u53ef\u80fd\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u4e8c\u5206\u7b49\u6280\u5de7\u628a\u90a3\u4e2a $\\log$ \u53bb\u6389\uff0c\u4e0d\u8fc7\u6ca1\u60f3\u4e86\uff08\n\n\u6700\u540e\uff0c\u6709\u4eba\u53ef\u80fd\u4f1a\u62c5\u5fc3\u8fd0\u7b97\u8fc7\u7a0b\u4e2d\u7206 `long long`\uff0c\u4e8b\u5b9e\u4e0a\u867d\u7136 $\\sum\\limits_{i}a_ii$ \u53ef\u80fd\u4f1a\u7206 `long long`\uff0c\u4f46\u662f\u7b54\u6848\u662f\u5728 `long long` \u8303\u56f4\u5185\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u7406\u89e3\u4e3a\u7cfb\u7edf\u50cf\u5b57\u7b26\u4e32\u54c8\u5e0c\u4e00\u6837\u81ea\u52a8\u5bf9 $2^{64}$ \u53d6\u6a21\uff0c\u800c\u6700\u540e\u8fd0\u7b97\u7ed3\u679c $<2^{64}$\uff0c\u56e0\u6b64\u53d6\u6a21\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f\u5b83\u672c\u8eab\uff0c\u6545\u76f4\u63a5\u7528 `long long` \u5b58\u662f\u4e0d\u4f1a\u51fa\u95ee\u9898\u7684\u3002\n\n```cpp\nconst int MAXN=2e5;\nint n,qu,cnt=0,num=0;\nll key[MAXN*2+5],uni[MAXN*2+5],a[MAXN+5],tot=0;\nstruct event{int opt;ll x;} q[MAXN+5];\nstruct node{int l,r,cnt;ll sum,sum_i;} s[MAXN*8+5];\nvoid build(int k,int l,int r){\n\ts[k].l=l;s[k].r=r;if(l==r) return;\n\tint mid=l+r>>1;build(k<<1,l,mid);build(k<<1|1,mid+1,r);\n}\nvoid pushup(int k){\n\ts[k].cnt=s[k<<1].cnt+s[k<<1|1].cnt;s[k].sum=s[k<<1].sum+s[k<<1|1].sum;\n\ts[k].sum_i=s[k<<1].sum_i+s[k<<1|1].sum_i+s[k<<1|1].sum*s[k<<1].cnt;\n}\nvoid modify(int k,int p,int x){\n\tif(s[k].l==s[k].r){\n\t\ts[k].cnt+=x;s[k].sum+=x*uni[p];\n\t\ts[k].sum_i=1ll*s[k].cnt*(s[k].cnt+1)/2*uni[p];\n\t\treturn;\n\t} int mid=s[k].l+s[k].r>>1;\n\tif(p<=mid) modify(k<<1,p,x);\n\telse modify(k<<1|1,p,x);\n\tpushup(k);\n}\npair<ll,ll> getxth(int k,int x){\n\tif(s[k].l==s[k].r){return mp(1ll*x*uni[s[k].l],1ll*x*(x+1)/2*uni[s[k].l]);}\n\tif(x<=s[k<<1].cnt) return getxth(k<<1,x);\n\telse{\n\t\tpair<ll,ll> ss=getxth(k<<1|1,x-s[k<<1].cnt);\n\t\treturn mp(ss.fi+s[k<<1].sum,ss.se+s[k<<1].sum_i+ss.fi*s[k<<1].cnt);\n\t}\n}\nll getf(int k){\n\tpair<ll,ll> s1=getxth(1,k+1),s2=getxth(1,n-k);\n\treturn s1.fi-(s[1].sum-s2.fi);\n}\nll getans(){\n\tif(!n) return 0;\n\tint l=0,r=(n-1)/2,p=(n-1)/2+1;\n\twhile(l<=r){\n\t\tint mid=l+r>>1;\n\t\tif(getf(mid)<=0) p=mid,r=mid-1;\n\t\telse l=mid+1;\n\t} p--;//printf(\"%d\\n\",p);\n\tpair<ll,ll> s1=getxth(1,p+1),s2=getxth(1,n-p);\n\ts2.fi=s[1].sum-s2.fi;s2.se=s[1].sum_i-s2.se;\n//\tprintf(\"%lld %lld %lld %lld\\n\",s1.fi,s1.se,s2.fi,s2.se);\n\tll sum=s1.fi*(p+2)-s1.se-s2.se+s2.fi*(n-p);\n\tsum=sum*2;if((n&1)) sum-=max(getf((n-1)/2),0ll);\n\treturn tot-sum;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&qu);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]),key[++cnt]=a[i],tot+=a[i];\n\tfor(int i=1;i<=qu;i++){scanf(\"%d%lld\",&q[i].opt,&q[i].x);key[++cnt]=q[i].x;}\n\tsort(key+1,key+cnt+1);\n\tfor(int i=1;i<=cnt;i++) if(key[i]^key[i-1]) uni[++num]=key[i];\n\tfor(int i=1;i<=n;i++) a[i]=lower_bound(uni+1,uni+num+1,a[i])-uni;\n\tfor(int i=1;i<=qu;i++) q[i].x=lower_bound(uni+1,uni+num+1,q[i].x)-uni;\n\tbuild(1,1,num);for(int i=1;i<=n;i++) modify(1,a[i],1);\n\tprintf(\"%lld\\n\",getans());\n\tfor(int i=1;i<=qu;i++){\n\t\tif(q[i].opt==1) modify(1,q[i].x,1),++n,tot+=uni[q[i].x];\n\t\telse modify(1,q[i].x,-1),--n,tot-=uni[q[i].x];\n\t\tprintf(\"%lld\\n\",getans());\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1617439592,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1500E Subset Trick"
    }
]