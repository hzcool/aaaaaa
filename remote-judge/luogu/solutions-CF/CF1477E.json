[
    {
        "content": "\u6211\u4eec\u8003\u8651\u627e\u5230\u4e00\u7ec4\u597d\u7684\u6392\u5217\u65b9\u5f0f\u3002\n\n\u9996\u5148\u8003\u8651\u5047\u5982\u8fd9\u4e2a\u6392\u5217\u4e2d\u6709\u4e00\u6bb5\u8fde\u7eed\u4e14\u5c5e\u4e8e\u540c\u4e00\u4e2a\u961f\u7684\u90e8\u5206\u5e94\u8be5\u600e\u6837\u6392\u5217\u3002\n\n\u4e0d\u59a8\u5047\u8bbe\u8fd9\u6bb5\u5f00\u59cb\u65f6\uff0c$K$ \u7684\u503c\u8db3\u591f\u5927\uff0c\u5219\u6bcf\u4e2a\u4f4d\u7f6e $x_i$ \u7684\u8d21\u732e\u90fd\u662f $K+x_i-z$\uff0c\u5176\u4e2d $z$ \u662f\u8fd9\u6bb5\u5f00\u5934\u524d\u4e00\u4e2a\u6570\u3002\n\n\u4f46\u662f\u73b0\u5728 $K$ \u4e0d\u591f\u5927\u3002\u4e8e\u662f\u73b0\u5728\u5176\u8d21\u732e\u53ef\u4ee5\u6bd4 $\\sum K+x_i-z$ **\u66f4\u5927**\uff0c\u56e0\u4e3a\u628a $K$ \u51cf\u5230 $0$ \u5c31\u4e0d\u4f1a\u66f4\u5c0f\u4e86\u3002\n\n\u4e8e\u662f\u6211\u4eec\u4fbf\u60f3\u8ba9\u5176\u66f4\u65e9\u88ab\u51cf\u5230 $0$\u3002\u90a3\u4e48\u628a\u5b83\u9012\u589e\u6392\u5217\u5373\u53ef\u3002\u540c\u7406\uff0c$b$ \u5e94\u8be5\u9012\u51cf\u6392\u5217\u3002\n\n\u7136\u540e\u8003\u8651 $a,b$ \u95f4\u7684\u5173\u7cfb\u3002\u5f97\u51fa\u7ed3\u8bba\u662f\uff0c$b$ \u7684\u6240\u6709\u5143\u7d20\u90fd\u5e94\u8be5\u653e\u5728 $a$ \u4e4b\u524d\u2014\u2014\u9664\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684\u4e1c\u897f\uff0c\u5373 $c_1$\u3002\n\n\u8fd9\u9700\u8981\u6211\u4eec\u5199\u51fa\u5728 $c$ \u56fa\u5b9a\u65f6\u7684\u5f0f\u5b50\uff1a$K-c_1+c_i+\\max(0,c_1-K-\\min\\limits_{j\\leq i}\\{c_j\\})$\u3002\u5176\u4e2d\uff0c$K-c_1+c_i$ \u662f\u4e0d\u4e0e $0$ \u53d6 $\\max$ \u65f6\u7684\u8d21\u732e\uff0c\u800c\u540e\u9762\u7684\u90a3\u4e2a $\\max$ \u662f\u53d6 $\\max$ \u65f6\u51fa\u73b0\u7684\u989d\u5916\u8d21\u732e\u3002\n\n\u53ef\u4ee5\u53d1\u73b0 $c_1$ \u786e\u5b9e\u662f\u5728\u8fd9\u4e2a\u5f0f\u5b50\u4e2d\u626e\u6f14\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u89d2\u8272\u3002\n\n\u4ee4 $f(x)$ \u8868\u793a\u9009\u62e9\u4e00\u4e2a $a_i=x$ \u4f5c\u4e3a $c_1$ \u65f6\u7684\u7b54\u6848\u3002\u5219\u6709 \n\n$$\nf(x)=K+\\sum\\limits_{a_i\\text{ except one equals to }x}\\Big(K-x+a_i+\\max(0,x-K-\\min\\{a,b\\})\\Big)-\\sum\\limits_{b_i}\\Big(K-x+b_i+\\max(0,x-K-b_i)\\Big)\\\\=K+(n-1)\\Big(K-x+\\max(0,x-K-\\min\\{a,b\\})\\Big)+\\Big(\\sum a_i\\Big)-x-m(K-x)-\\sum\\limits_{b_i}\\Big(b_i+\\max(0,x-K-b_i)\\Big)\\\\=(n-m)(K-x)+(n-1)\\max(0,x-K-\\min\\{a,b\\})+\\Big(\\sum a_i\\Big)-\\Big(\\sum b_i\\Big)-\\sum\\limits\\max(0,x-K-b_i)\n$$\n\n\u628a\u5e38\u6570\u63d0\u51fa\u6765\u3002\u4ee4 $C=(n-m)K+\\sum a_i-\\sum b_i$\uff0c\u6700\u7ec8\u5f97\u5230\n\n$$f(x)=(m-n)x+(n-1)\\max(0,x-K-\\min\\{a,b\\})-\\sum\\limits\\max(0,x-K-b_i)+C$$\n\n\u8003\u8651\u628a\u8fd9\u4e2a\u51fd\u6570\u753b\u5728\u5750\u6807\u7cfb\u4e0a\uff1a\u521d\u59cb\u6709\u4e00\u4e2a $(m-n)$ \u7684\u659c\u7387\uff1b\u5728 $K+\\min$ \u5904\u659c\u7387\u589e\u52a0\u4e86 $n-1$\uff08\u4e5f\u5373\uff0c\u53d8\u6210\u4e86 $m-1$\uff09\uff0c\u7136\u540e\u968f\u7740 $x$ \u589e\u52a0\u5728\u82e5\u5e72\u4e2a\u4f4d\u7f6e\u51cf\u5c11\u4e00\u3002\u6700\u5927\u503c\u663e\u7136\u53d1\u751f\u5728\u659c\u7387\u4e3a $0$ \u7684\u4f4d\u7f6e\u2014\u2014\u8fd9\u610f\u5473\u7740\u662f $b$ \u4e2d\u7684\u6b21\u5927\u503c\u52a0 $K$ \u9644\u8fd1\u3002\n\n\u6545\u53ef\u80fd\u7684\u6781\u503c\u5019\u9009\u53ea\u6709\u8fd9\u4e9b\u5143\u7d20\uff1a\n\n- $\\min\\{a\\}$\uff08\u8fd9\u53ef\u80fd\u53d1\u751f\u5728 $m$ \u8fdc\u5c0f\u4e8e $n$ \u7684\u573a\u5408\uff09\n- \uff08$b$ \u4e2d\u7684\u6b21\u5927\u503c\u52a0 $K$\uff09\u5728 $a$ \u4e2d\u7684\u524d\u9a71\u6216\u540e\u7f00\u3002\n\n\u73b0\u5728\u8003\u8651 $g$\u3002\u4ecd\u7136\u8981\u63a8\u4e00\u4e0b\u5f0f\u5b50\uff1a\n\n$$\ng(x)=\\sum\\limits_{a_i}\\Big(K-x+a_i+\\max(0,x-K-\\min\\{a,b\\})\\Big)-\\sum\\limits_{b_i\\text{ except one equals to }x}\\Big(K-x+b_i+\\max(0,x-K-b_i)\\Big)-K\n\\\\=n\\Big(K-x+\\max(0,x-K-\\min\\{a,b\\})\\Big)+\\Big(\\sum a_i\\Big)-(m-1)(K-x)-\\Big(\\sum\\limits_{b_i}b_i\\Big)+x-\\sum\\limits_{b_i}\\max(0,x-K-b_i)-K\n\\\\=(n-m)(K-x)+n\\max(0,x-K-\\min\\{a,b\\})+\\Big(\\sum a_i\\Big)-\\Big(\\sum b_i\\Big)-\\sum\\limits\\max(0,x-K-b_i)\n\\\\=(m-n)x+n\\max(0,x-K-\\min\\{a,b\\})-\\sum\\limits\\max(0,x-K-b_i)+C\n$$\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002\u53ea\u4e0d\u8fc7\u56e0\u4e3a\u659c\u7387\u662f $m$\uff0c\u8fdb\u800c\u76f4\u63a5\u91c7\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u8fdb\u800c\u6781\u503c\u5019\u9009\u5373\u4e3a\uff1a\n\n- $\\min\\{b\\}$\u3002\n- $\\max\\{b\\}$\u3002\n\n\u4e8e\u662f\u6bcf\u6b21\u8be2\u95ee\u65f6\u5c31\u6311\u51fa\u4e0a\u8ff0 $O(1)$ \u4e2a\u6570\u8fdb\u884c\u8be2\u95ee\u5373\u53ef\u3002\u7ef4\u62a4\u8be2\u95ee\u662f\u7b80\u5355\u7684\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int V=1000000;\ntypedef long long ll;\nint n,m,q,a[200100],b[200100];\nll C;\nmultiset<int>A,B;\nvoid insertA(int x){A.insert(x),C+=x;}\nvoid eraseA(int x){A.erase(A.find(x)),C-=x;}\n#define lson x<<1\n#define rson x<<1|1\n#define mid ((l+r)>>1)\nstruct SegTree{int num;ll sum;}seg[V<<2];\nvoid modify(int x,int l,int r,int P,int tp){\n\tseg[x].num+=tp,seg[x].sum+=tp*P;\n\tif(l!=r)P<=mid?modify(lson,l,mid,P,tp):modify(rson,mid+1,r,P,tp);\n}\nll query(int x,int l,int r,int P){\n\tif(l>P)return 0;\n\tif(r<=P)return 1ll*P*seg[x].num-seg[x].sum;\n\treturn query(lson,l,mid,P)+query(rson,mid+1,r,P);\n}\nint Kth(int x,int l,int r,int K){\n\tif(l==r)return l;\n\treturn seg[lson].num>=K?Kth(lson,l,mid,K):Kth(rson,mid+1,r,K-seg[lson].num);\n}\nvoid insertB(int x){B.insert(x),C-=x,modify(1,0,V,x,1);}\nvoid eraseB(int x){B.erase(B.find(x)),C+=x,modify(1,0,V,x,-1);}\nll queryA(int K,int x){\n//\tprintf(\"%d %d\\n\",K,x);\n\treturn 1ll*(n-m)*K+C+1ll*(m-n)*x+1ll*(n-1)*max(0,x-K-min(*A.begin(),*B.begin()))-query(1,0,V,x-K);\n}\nll queryB(int K,int x){\n\treturn 1ll*(n-m)*K+C+1ll*(m-n)*x+1ll*n*max(0,x-K-min(*A.begin(),*B.begin()))-query(1,0,V,x-K);\n}\nll solve(int K){\n\tll ret=max(queryA(K,*A.begin()),queryB(K,*B.begin()));\n\tauto it=A.lower_bound(Kth(1,0,V,m-1)+K);\n\tif(it!=A.end())ret=max(ret,queryA(K,*it));\n\tif(it!=A.begin())ret=max(ret,queryA(K,*--it));\n\tret=max(ret,queryB(K,*B.rbegin()));\n\treturn ret;\n}\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),insertA(a[i]);\n\tfor(int i=1;i<=m;i++)scanf(\"%d\",&b[i]),insertB(b[i]);\n\tfor(int i=1,tp,x;i<=q;i++){\n\t\tscanf(\"%d%d\",&tp,&x);\n\t\tif(tp==1)eraseA(a[x]),scanf(\"%d\",&a[x]),insertA(a[x]);\n\t\tif(tp==2)eraseB(b[x]),scanf(\"%d\",&b[x]),insertB(b[x]);\n\t\tif(tp==3)printf(\"%lld\\n\",solve(x));\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1645702937,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1477E\u3010Nezzar and Tournaments\u3011"
    },
    {
        "content": "*3300\n\n\u9898\u548c\u9898\u89e3\u90fd\u5f88 der\uff0c\u4f46\u662f\u6211\u5b9e\u529b\u4e0d\u5230 *800\uff0c**\u5b9e\u529b\u662f\u8fdc\u4f4e\u4e8e\u8fd9\u9053\u9898\u7684\uff0c\u8bb0\u5f55\u4e00\u4e0b\u662f\u6709\u5fc5\u8981\u7684**\uff08\u89c1\u6628\u665a\u6bd4\u8d5b![](https://cdn.luogu.com.cn/upload/image_hosting/t41xgunq.png)\n\n------------\n\n\u5148\u89e3\u51b3\u7ffb\u8bd1\u95ee\u9898\uff1a\u7ed9\u4f60\u957f\u4e3a $n,m$ \u7684\u4e24\u4e2a\u6570\u5217 $a,b$\uff0c\u521d\u59cb\u6709\u4e2a\u503c\u4e3a $k$ \u7684\u8ba1\u5206\u677f\u3002\n\n\u8bbe $c$ \u4e00\u4e2a\u957f\u4e3a $n+m$ \u7684\u6570\u5217\uff0c$c$ \u4e2d\u6bcf\u4e2a\u6570**\u6070\u5bf9\u5e94 $a,b$ \u4e2d\u7684\u67d0\u4e2a\u6570**\uff0c\u4ee4 $d_i$ \u4e3a\u7b2c $i$ \u4e2a\u6570\u539f\u672c\u5c5e\u4e8e\u54ea\u4e2a\u6570\u5217\u3002\n\n\u4f9d\u6b21\u5f80\u8ba1\u5206\u677f\u4e2d\u52a0\u5165\u6570 $c_i$\uff0c\u8ba1\u5206\u677f\u589e\u52a0 $c_i-c_{i-1}$ \u7684\u6743\u503c\uff08\u53ef\u8d1f\uff09\uff0c**\u521d\u59cb\u6709 $c_0:=c_1$ \u907f\u5f00\u8fb9\u754c\u60c5\u51b5**\u3002\n\n**\u8ba1\u5206\u677f\u59cb\u7ec8\u5bf9 $0$ \u53d6 $\\max$\uff0c\u8bbe\u7b2c $i$ \u4e2a\u6570\u52a0\u5165\u540e\u8ba1\u5206\u677f\u4e3a $v_i$\uff0c\u5f62\u5f0f\u5316\u7684\u6709 $v_i=\\max{(0,v_{i-1}+c_i-c_{i-1})}$\u3002**\n\n\u5728\u52a0\u5165 $c_i$ \u8fd9\u4e2a\u6570\u65f6\uff0c\u4f1a\u5bf9 $d_i$ \u8fd9\u4e2a\u6570\u5217\u4ea7\u751f $v_i$ \u7684\u8d21\u732e\uff0c\u8bbe\u6700\u7ec8\u7684\u8d21\u732e\u5206\u522b\u4e3a $W_a,W_b$\u3002\n\n\u6c42 $c$ \u7684\u6240\u6709\u60c5\u51b5\u4e2d $W_a-W_b$ \u7684\u6700\u5927\u503c\u3002\n\n\u652f\u6301\u64cd\u4f5c\uff1a\u5355\u70b9\u4fee\u6539 $a,b$\uff0c\u7ed9\u5b9a $k$ \u8fdb\u884c\u8be2\u95ee\u3002\n\n------------\n\n\u89e3\u6cd5\u4e00\uff1a\u624b\u73a9\uff0c\u9700\u8981\u6bd4\u8f83\u597d\u7684\u611f\u89c9\u3002\n\n\u9996\u5148\u4e0d\u8003\u8651\u652f\u6301\u4fee\u6539\uff0c\u5148\u624b\u73a9\u4e00\u4e0b\u8fd9\u4e2a\u8be2\u95ee\u3002\n\n\u4e00\u79d2\u4f1a\u505a $k=0$ \u7684\u60c5\u51b5\uff0c\u5373\u5148\u5012\u5e8f\u7684\u628a $b$ \u6570\u5217\u653e\u5b8c\uff0c\u4f7f\u5f97 $b$ \u7684\u8d21\u732e\u5168\u90e8\u6ca1\u6709\uff0c$W_b=0$\uff0c\u7136\u540e\u518d\u5347\u5e8f\u7684\u653e $a$ \u6570\u5217\uff0c\u53ef\u4ee5\u4f7f\u5f97\u8d21\u732e\u6700\u5927\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u9ed8\u8ba4 $a,b$ \u6309\u4ece\u5c0f\u5230\u5927\u6392\u597d\u4e86\u5e8f\uff0c\u6709\uff1a\n\n$$sum=W_a-W_b=W_a=\\sum_{i=1}^n(\\max(0,a_1-b_1)+a_i-a_1)$$\n\n\u8003\u8651 $k$ \u6709\u503c\u4f1a\u53d1\u751f\u4ec0\u4e48\u53d8\u5316\uff0c\u9996\u5148\u5012\u5e8f\u7684\u628a $b$ \u6570\u5217\u653e\u5b8c\u7136\u540e\u518d\u5347\u5e8f\u7684\u653e $a$ \u6570\u5217\u7684\u7b56\u7565\u4ecd\u7136\u662f\u6211\u4eec\u7684\u4f18\u9009\u65b9\u6848\u4e4b\u4e00\u3002\n\n\u4e5f\u5373\u4e0a\u5f0f\u52a0\u4e0a $k$ \u7684\u8d21\u732e\uff0c\u7531\u4e8e\u8981\u8003\u8651 $b_1\\to a_1$ \u5904\u7684\u8f6c\u6298\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5b9a\u4e49 $M=\\min(a_1,b_1)$\uff1a\n\n$$sum=W_a-W_b=-\\sum_{i=1}^m\\max(0,k-(b_n-b_i))+\\sum_{i=1}^n(\\max(0,k-b_n+M)+a_i-M)$$\n\n\u53d1\u73b0\u552f\u4e00\u7684\u53ef\u80fd\u6027\u5c31\u662f\u6211\u4eec\u5355\u72ec\u62ce\u51fa\u4e00\u4e2a $a_x$ \u57ab\u5728\u6240\u6709\u7684 $b$ \u524d\u9762\uff0c\u5269\u4e0b\u7684\u6570\u540c\u4e0a\u7b56\u7565\u7684\u76f8\u5bf9\u987a\u5e8f\u4e0d\u53d8\u3002\n\n\u611f\u6027\u7406\u89e3\u4e00\u4e0b\u5982\u679c\u591a\u62ce\u4e86\u4e00\u4e2a\u51fa\u6765\u628a\u4e24\u4e2a\u4e2d\u5927\u7684\u90a3\u4e2a\u653e\u56de $a$ \u53bb\u8d21\u732e\u66f4\u5927\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u653e\u54ea\u4e2a $a$ \u7684\u5f97\u5230\u6700\u4f18\u7684\u7b54\u6848\uff0c\u76f4\u63a5\u5217\u5f0f\uff1a\n\n$$sum=W_a-W_b=k-\\sum_{i=1}^m\\max(0,k-(a_x-b_i))+\\sum_{i=1}^n(\\max(0,k-a_x+M)+a_i-M)-(\\max(0,k-a_x+M)+a_x-M)$$\n\n\u8003\u8651\u7ef4\u62a4\u4e0a\u8ff0\u4e24\u5f0f\u7684\u6700\u5927\u503c\uff0c\u7b2c\u4e00\u5f0f\u662f\u7b80\u5355\u7684\uff0c\u6bcf\u6b21\u6539\u53d8\u91cf $O(1)$ \u6574\u4e2a\u5f0f\u5b50\u4e5f\u53ef\u4ee5 $O(1)$ \u7684\u8ba1\u7b97\u3002\n\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u4e0d\u592a\u4e00\u6837\uff0c\u56e0\u4e3a\u6709\u4e00\u4e2a\u53d8\u91cf $a_x$\uff0c\u8003\u8651\u6309 $a_x$ \u4e3a\u4e3b\u5143\u5f52\u7c7b\uff0c\u6709\uff1a\n\n$$sum=(-a_x+M)+(n-1)\\max(0,k-a_x+M)-\\sum_{i=1}^m\\max(0,k-a_x+b_i)+k+\\sum_{i=1}^na_i-M$$\n\n\u5355\u8c03\u7684\u8003\u5bdf $a_x$ \u53d8\u5316\u65f6\u7684\u8d21\u732e\uff0c\u53d1\u73b0 $a_x$ \u7684\u7cfb\u6570\u4e00\u6765\u662f $m-n$\uff0c\u7136\u540e\u4f1a\u5148\u9047\u5230 $k+M$ \u52a0\u4e00\u4e2a $n-1$ \u53d8\u6210 $m-1$\uff0c\u540e\u6765\u9047\u5230\u4e00\u4e2a $k+b_i$ \u5c31\u51cf\u4e00\uff0c\u76f4\u5230\u8d70\u8fc7 $b_n$ \u53d8\u6210 $-1$\u3002\n\n\u6545\u7b2c\u4e8c\u5f0f\u6700\u4f18\u503c\u7684\u53d6\u503c\u53ef\u80fd\u4e3a\uff1a\n\n- $m<n$ \u65f6\uff1a$a_x=a_1$\u3002\n- \u8003\u8651\u4ece $m-1\\to -1$ \u7684\u5cf0\uff0c\u663e\u7136\u662f\u659c\u7387\u4e3a $0$ \u7684\u6bb5 $[b_{n-1},b_n]$ \u5185\u7684 $a_x$\uff0c\u82e5\u6ca1\u6709\u5219\u627e\u524d\u540e\uff0c\u5373\u7ef4\u62a4 $a_x$ \u4e3a $b$ \u6b21\u5927/\u6700\u5927\u524d\u9a71\u540e\u7ee7\u7684\u503c\u5373\u53ef\u3002\n\n$O(1)$ \u6539\u53d8\u91cf\u663e\u7136\u4e5f\u80fd\u7ef4\u62a4\u3002\n\n------------\n\n\u89e3\u6cd5\u4e8c\uff1a\u7406\u6027\u7406\u89e3\u3002\n\n\u8003\u8651\u6570\u5217 $c$\uff0c\u5148\u4e0d\u8003\u8651\u6570\u5217 $d$\uff0c\u5373\u5148\u8003\u8651\u6bcf\u4e2a\u6570\u7684\u8d21\u732e\u800c\u4e0d\u8003\u8651\u8d21\u732e\u5230\u4e86\u54ea\u91cc\u3002\n\n\u53d1\u73b0 $c_1$ \u7684\u5b58\u5728\u5f88\u4e0d\u5229\u4e8e\u6211\u4eec\u7684\u8ba1\u7b97\uff0c\u4e8e\u662f\u5355\u72ec\u62ce\u51fa\u6765\uff0c\u6709\u8fd9\u6837\u7684\u516c\u5f0f\uff1a\n\n$$v_i=k+c_i-c_1+\\max(0,c_1-k-\\min_{j\\le i}c_j)$$\n\n\u53e6\u5916\u4e24\u7bc7\u9898\u89e3\u90fd\u662f\u8fd9\u79cd\u505a\u6cd5\u7136\u800c\u5728\u8fd9**\u5173\u952e\u4e00\u62db**\u4e0a\u6ca1\u89e3\u91ca\u6e05\u695a\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff1a\n\n\u6211\u4eec\u4ee4 $w_i=v_i-c_i$\uff0c\u90a3\u4e48 $v_i=\\max{(0,w_{i-1}+c_i)},w_i=v_i-c_i$\uff0c\u8003\u8651\u7ef4\u62a4 $w_i$\uff0c\u5c31\u662f\u52a0\u4e0a $c_i$ \u540e\u548c $0$ \u53d6\u4e2a $\\max$ \u518d\u51cf\u56de\u6765\u3002\n\n\u5982\u679c $c_i$ \u62ac\u9ad8\u4e86\u663e\u7136\u78b0\u4e0d\u5230 $0$ \u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u4e8e\u662f\u62ac\u7684\u6700\u4f4e\u7684\u90a3\u6b21\u663e\u7136\u51b3\u5b9a\u4e86\u5f53\u524d $w_i$ \u7684\u503c\u3002\n\n\u521d\u59cb\u6709 $w_0=k-c_1$ \u53ef\u4ee5\u4f7f\u5f97 $v_1=k$\uff0c\u4e8e\u662f $w_i=w_1+\\max{(0,0-w_1-\\min_{j\\le i}c_j)}$\uff0c\u5373\u8003\u8651\u62ac $c_i$ \u6700\u4f4e\u7684\u90a3\u6b21\u5bf9 $w$ \u7684\u8d21\u732e\uff0c\u5c06 $v_i$ \u4ee3\u56de\u6b64\u5f0f\u5b50\u5373\u5f97\u5230\u4e0a\u8ff0\u516c\u5f0f\u3002\n\n\u53d1\u73b0\u5f53 $c_1$ \u5b9a\u4e86 $v_i$ \u5c31\u53ea\u4e0e\u81ea\u5df1\u7684 $c_i$ \u548c\u5728\u5b83\u524d\u9762\u7684\u6570\u6709\u5173\u4e86\uff0c\u8003\u8651\u5f53 $c_1$ \u786e\u5b9a\u65f6\u5176\u4ed6\u6570\u8be5\u5982\u4f55\u786e\u5b9a $c_i,d_i$\u3002\n\n\u9996\u5148 $d_i=b$ \u7684\u8d21\u732e\u8981\u6700\u5c11\uff0c\u800c $-\\min_j{c_j}$ \u4e0d\u51cf\uff0c\u4e8e\u662f\u5c06\u5b83\u4eec\u90fd\u653e\u5728\u524d\u9762\uff0c\u800c\u4e3a\u4e86\u8ba9 $-\\min_j{c_j}$ \u5c0f\u663e\u7136\u5012\u5e8f\u653e\u5373\u53ef\u3002\n\n\u8003\u8651\u8ba9\u5269\u4e0b\u7684 $d_i=a$ \u7684\u8d21\u732e\u5c3d\u91cf\u591a\uff0c\u663e\u7136\u5148\u628a\u6700\u5c0f\u7684 $a$ \u653e\u4e86\u5373\u53ef\uff08\u4e3a\u4e86\u4e0d\u548c\u6211\u7684\u624b\u73a9\u77db\u76fe\u53ef\u4ee5\u770b\u4f5c\u6b63\u5e8f\u653eqwq\uff0c\u5b9e\u9645\u4e0a\u4e5f\u53ef\u4ee5\u53d1\u73b0\u5bf9\u63a8\u5f0f\u5b50\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\n\n\u7136\u540e\u5c31\u6839\u636e\u8fd9\u4e2a\u5217\u5f0f\u5373\u53ef\uff0c\u548c\u4e0a\u8ff0\u624b\u73a9\u51fa\u6765\u7684\u5f0f\u5b50\u4e00\u6a21\u4e00\u6837\uff0c\u5206\u6790\u659c\u7387\u5373\u53ef\u5f97\u5230 $c_1$ \u7684\u9009\u62e9\u5728\u54ea\u91cc\u6700\u4f18\u3002\n\n\u4e24\u79cd\u65b9\u6cd5\u7684\u7406\u89e3\u8fc7\u7a0b\u4e0d\u540c\uff0c\u54ea\u79cd\u597d\u60f3\u4e5f\u4e0d\u597d\u8bf4\uff0c\u4f60\u770b\u6211\u5c31\u662f\u89e3\u6cd5\u4e00\u63a8\u4e86\u5927\u534a\u627e\u9898\u89e3\u7684\u89e3\u6cd5\u4e8c\u9a8c\u8bc1\u4e86\u81ea\u5df1\u7684\u60f3\u6cd5\u3002\n\n\u5b9e\u9645\u4e0a\u63a8\u5176\u4ed6\u9898\u89e3\u7684 $g$ \u7684\u5f0f\u5b50\u4f1a\u5f97\u5230\u548c\u624b\u73a9\u4e00\u6837\u7684\u53d1\u73b0\uff1a\u76f4\u63a5\u53d6\u6700\u5927\u7684 $b$ \u5f53 $c_1$ \u5373\u53ef\u3002",
        "postTime": 1647868000,
        "uid": 158948,
        "name": "\u7ea6\u745f\u592b\u7528\u8111\u73a9",
        "ccfLevel": 0,
        "title": "CF1477E Nezzar and Tournaments"
    },
    {
        "content": "[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/1477/problem/E) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1477E)\n\n~~1477 \u53ef\u8fd8\u884c\uff08My rating is 1477.~~\n\n~~\u90e8\u5206\u601d\u8def\u501f\u9274\u4e86 ymx \u9e3d\u9e3d\u7684\u9898\u89e3\uff0c\u56e0\u4e3a\u73b0\u5728\u597d\u50cf\u5168\u7f51\u9664\u4e86\u5b98\u65b9\u9898\u89e3\u53ea\u6709\u8fd9\u4e00\u7bc7\u9898\u89e3\u3002~~\n\n\u9996\u5148\u8003\u8651\u5bf9\u4e8e\u4e00\u79cd\u56fa\u5b9a\u7684\u5b89\u6392\u9009\u624b\u987a\u5e8f\u7684\u65b9\u6848 $c$\uff0c\u5982\u4f55\u6c42\u904d\u5386\u5230\u7b2c $i$ \u4e2a\u9009\u624b\u65f6\u7684\u5f97\u5206\u3002\u5982\u679c\u4e0d\u8003\u8651\u5bf9 $0$ \u53d6 $\\max$ \u7684\u9650\u5236\uff0c\u90a3\u663e\u7136\u5c31\u662f $K+(c_2-c_1)+(c_3-c_2)+\\cdots+(c_i-c_{i-1})=K+c_i-c_1$\u3002\u4f46\u7531\u4e8e\u6bcf\u6b21\u5f97\u5206\u5bf9 $0$ \u53d6 $\\max$ \u8fd9\u4e00\u673a\u5236\u7684\u5b58\u5728\uff0c\u5bf9\u4e8e\u5f97\u5206\u5c0f\u4e8e $0$ \u7684\u65f6\u523b\uff0c\u5f52\u96f6\u8fd9\u4e00\u64cd\u4f5c\u76f8\u5f53\u4e8e\u7ed9\u5f97\u5206\u52a0\u4e0a\u4e86\u5f53\u524d\u5f97\u5206\u7684\u76f8\u53cd\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u771f\u5b9e\u5f97\u5206\u5176\u5b9e\u662f\u4e0d\u5c0f\u4e8e\u6211\u4eec\u7b97\u51fa\u6765\u7684\u5f97\u5206 $K+c_i-c_1$ \u7684\uff0c\u90a3\u4e48\u6211\u4eec\u7a76\u7adf\u5e94\u8be5\u5982\u4f55\u8ba1\u7b97\u771f\u5b9e\u5f97\u5206\u6bd4\u6211\u4eec\u7b97\u51fa\u6765\u7684\u5f97\u5206\u5927\u591a\u5c11\u5462\uff1f\u8003\u8651\u53d6\u51fa\u4e0b\u6807 $\\le i$ \u4e14\u503c\u6700\u5c0f\u7684 $c_j$\uff0c\u90a3\u4e48\u603b\u7684\u589e\u91cf\u5c31\u662f\u4f7f\u5f97 $K+c_j-c_1$ \u53d8\u5f97 $\\ge 0$ \u7684\u6700\u5927\u589e\u91cf\uff0c\u5373 $\\max(c_1-K-c_j,0)$\u3002\u56e0\u6b64\u6211\u4eec\u6709 $d_i=K+c_i-c_i+\\max(c_1-K-(\\min\\limits_{j\\le i}c_j),0)$\u3002\n\n\u6ce8\u610f\u5230\u4e0a\u9762\u7684\u5f0f\u5b50\u4e2d\uff0c$c_1$ \u8d77\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u4e3b\u5143\u7684\u4f5c\u7528\uff0c\u56e0\u6b64\u8003\u8651\u5c06\u5176\u62ce\u51fa\u6765\uff0c\u4e0d\u59a8\u5047\u8bbe\u5176\u503c\u5df2\u7ecf\u786e\u5b9a\uff0c\u5982\u4f55\u5b89\u6392\u540e\u9762\u4f4d\u7f6e\u4e0a\u7684\u503c\u3002\u663e\u7136\u5bf9\u4e8e $b$ \u4e2d\u7684\u6570\u800c\u8a00\uff0c\u6211\u4eec\u5e0c\u671b\u540e\u9762\u7684 $\\max$ \u8d8a\u5c0f\u8d8a\u597d\uff0c\u56e0\u6b64\u6211\u4eec\u4f1a\u5c06\u5176\u964d\u5e8f\u6392\u5e8f\uff0c\u540c\u7406\uff0c\u5bf9\u4e8e $a$ \u4e2d\u7684\u6570\u800c\u8a00\uff0c\u6211\u4eec\u5e0c\u671b\u540e\u9762\u7684 $\\max$ \u8d8a\u5927\u8d8a\u597d\uff0c\u56e0\u6b64\u6211\u4eec\u4f1a\u5c06\u5176\u5347\u5e8f\u6392\u5e8f\uff0c\u81f3\u4e8e $a,b$ \u7684\u76f8\u5bf9\u987a\u5e8f\u5173\u7cfb\u2026\u2026\u6211\u4eec\u80af\u5b9a\u5e0c\u671b $b$ \u5c3d\u91cf\u6392\u5728\u524d\u9762\uff0c$a$ \u5c3d\u91cf\u6392\u5728\u540e\u9762\uff0c\u56e0\u6b64\u6211\u4eec\u80af\u5b9a\u4f1a\u5148\u5b89\u6392 $b$ \u518d\u5b89\u6392 $a$\uff0c\u5373\u5047\u8bbe\u53bb\u6389 $c_1$ \u540e $a$ \u5347\u5e8f\u6392\u5e8f\u7684\u7ed3\u679c\u4e3a $p$\uff0c\u957f\u5ea6\u4e3a $n\u2019$\uff0c$b$ \u964d\u5e8f\u6392\u5e8f\u7684\u7ed3\u679c\u4e3a $q$\uff0c\u957f\u5ea6\u4e3a $m\u2019$\uff0c\u90a3\u4e48\u6700\u4f18\u65b9\u6848\u7684 $c$ \u5e8f\u5217\u5c06\u4f1a\u662f $q_1,q_2,\\cdots,q_{m\u2019},p_1,p_2,\\cdots,p_{n\u2019}$\u3002 \n\n\u63a5\u4e0b\u6765\u8003\u8651\u5e26\u4e0a $c_1$ \u7684\u9650\u5236\uff0c\u8003\u8651\u4ec0\u4e48\u6837\u7684 $c_1$ \u53ef\u80fd\u6210\u4e3a\u6700\u4f18\u89e3\u3002\u5047\u8bbe $f(t)$ \u8868\u793a $c_1$ \u51fa\u81ea $a$ \u5e8f\u5217\u4e14 $=t$ \u7684\u6700\u5927\u5206\u6570\u5dee\uff0c$g(t)$ \u8868\u793a $c_1$ \u51fa\u81ea $b$ \u5e8f\u5217\u4e14 $=t$ \u7684\u6700\u5927\u5206\u6570\u5dee\uff0c\u90a3\u4e48\uff1a\n$$\n\\begin{aligned}\nf(t)&=k-\\sum\\limits_{i=1}^m(k-t+b_i+\\max(t-k-b_i,0))+\\sum\\limits_{i=1}^n(k-t+a_i+\\max(t-k-M,0))-(k-t+t-\\max(t-k-M,0)\\\\\n&=(k-t)\u00b7(n-m)+\\sum\\limits_{i=1}^na_i-\\sum\\limits_{j=1}^mb_i-\\sum\\limits_{i=1}^m\\max(t-k-b_i,0)+\\max(t-k-M,0)\u00b7(n-1)\\\\\n&=t\u00b7(m-n)-\\sum\\limits_{i=1}^m\\max(t-k-b_i,0)+\\max(t-k-M,0)\u00b7(n-1)+(k\u00b7(n-m)+\\sum\\limits_{i=1}^na_i-\\sum\\limits_{j=1}^mb_i)\n\\end{aligned}\n$$\n\u5176\u4e2d $M=\\min(\\min\\limits_{i=1}^na_i,\\min\\limits_{j=1}^mb_j)$\u3002\n\n\u8003\u8651\u5c06\u4e0e $t$ \u6709\u5173\u7684\u9879\u63d0\u51fa\u6765\u5e76\u753b\u51fa $f(t)$ \u5173\u4e8e $t$ \u7684\u51fd\u6570\u56fe\u50cf\uff0c\u90a3\u4e48\u5e94\u662f\u5148\u4e00\u6bb5\u659c\u7387\u4e3a $m-n$ \u7684\u6298\u7ebf\uff0c\u7136\u540e\u5728 $k+M$ \u5904\u659c\u7387\u7a81\u589e $n-1$\uff0c\u53d8\u4e3a $m-1$\uff0c\u518d\u540e\u6765\uff0c\u6bcf $\\ge$ \u4e00\u4e2a $k+b_i$ \u659c\u7387\u90fd\u4f1a $-1$\uff0c\u6700\u540e\u659c\u7387\u53d8\u4e3a $-1$\u3002\u5927\u81f4\u56fe\u50cf\u5982\u4e0b\u56fe\u6240\u793a\uff08\u56fe\u7247\u6765\u81ea CF \u5b98\u65b9\u9898\u89e3\uff09\uff1a\n\n![](https://espresso.codeforces.com/9244f64d31ceb89bee57a166ae05c97bc980ab85.png)\n\n\u4e0d\u96be\u53d1\u73b0\u6700\u4f18\u89e3\u8981\u4e48\u5728\u6700\u5de6\u7aef\u53d6\u5230\uff0c\u8981\u4e48\u5728\u5012\u6570\u7b2c\u4e8c\u6bb5\u7ebf\u6bb5\u7684\u4e24\u4e2a\u65ad\u70b9\u5904\u53d6\u5230\uff0c\u56e0\u6b64\u53ea\u8981\u66b4\u529b\u8ba1\u7b97\u8fd9\u4e09\u4e2a\u503c\u7684 $f$ \u540e\u53d6 $\\max$ \u5373\u53ef\u7b97\u51fa $a$ \u4e2d\u5143\u7d20\u4f5c\u4e3a $c_1$ \u7684\u6700\u5927\u5206\u6570\u5dee\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651 $g$\uff0c\u5f0f\u5b50\u63a8\u6cd5\u57fa\u672c\u4e00\u6837\uff1a\n$$\n\\begin{aligned}\ng(t)&=-k-\\sum\\limits_{i=1}^m(k-t+b_i+\\max(t-k-b_i,0))+\\sum\\limits_{i=1}^n(k-t+a_i+\\max(t-k-M,0))-(k-t+t-\\max(t-k-t,0))\\\\\n&=-k+(k-t)\u00b7(n-m)+\\max(t-k-M,0)\u00b7n-\\sum\\limits_{i=1}^m\\max(t-k-b_i,0)+\\sum\\limits_{i=1}^na_i-\\sum\\limits_{i=1}^mb_i\\\\\n&=t\u00b7(m-n)+\\max(t-k-M,0)\u00b7n+\\sum\\limits_{i=1}^m\\max(t-k-b_i,0)+(k\u00b7(n-m-1)+\\sum\\limits_{i=1}^na_i-\\sum\\limits_{i=1}^mb_i)\n\\end{aligned}\n$$\n\u548c\u4e0a\u9762\u7684\u6298\u7ebf\u5f62\u6001\u57fa\u672c\u4e00\u81f4\uff0c\u53ea\u4e0d\u8fc7\u5c11\u4e86\u6700\u540e\u659c\u7387\u4e3a $-1$ \u7684\u90e8\u5206\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u7528 check $b$ \u4e2d\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u81f3\u4e8e\u600e\u4e48\u8ba1\u7b97 $f(t),g(t)$\uff0c\u6ce8\u610f\u5230\u5f0f\u5b50\u5927\u90e8\u5206\u90fd\u81f3\u4e8e $k,t,n,m,M,\\sum a_i,\\sum b_i$ \u6709\u5173\uff0c\u90fd\u53ef\u4ee5 $\\mathcal O(1)$ \u6c42\u5f97\uff0c\u552f\u72ec $\\sum\\limits_{i=1}^m\\max(t-k-b_i,0)$ \u4e0e\u5e8f\u5217 $b$ \u7684\u5177\u4f53\u6570\u503c\u6709\u5173\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u5bf9 $b$ \u5efa\u6743\u503c\u7ebf\u6bb5\u6811\u8f7b\u677e\u641e\u5b9a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $(n+q)\\log n$\u3002\n\n```cpp\nconst int MAXN = 2e5;\nconst int MAXV = 1e6;\nconst int MAXP = MAXV * 4;\nconst int INF = 0x3f3f3f3f;\nconst ll INFll = 0x3f3f3f3f3f3f3f3fll;\nint n, m, qu, a[MAXN + 5], b[MAXN + 5];\nmultiset<int> stA, stB; ll sumA, sumB;\nstruct node {int ch[2], siz; ll sum;} s[MAXP + 5];\nint rt, ncnt;\nvoid insert(int &k, int l, int r, int p, int v) {\n\tif (!k) k = ++ncnt; s[k].siz += v; s[k].sum += p * v;\n\tif (l == r) return; int mid = l + r >> 1;\n\t(p <= mid) ? insert(s[k].ch[0], l, mid, p, v) : insert(s[k].ch[1], mid + 1, r, p, v);\n}\npair<int, ll> query(int k, int l, int r, int ql, int qr) {\n\tif (!k || ql > qr) return mp(0, 0);\n\tif (ql <= l && r <= qr) return mp(s[k].siz, s[k].sum);\n\tint mid = l + r >> 1;\n\tif (qr <= mid) return query(s[k].ch[0], l, mid, ql, qr);\n\telse if (ql > mid) return query(s[k].ch[1], mid + 1, r, ql, qr);\n\telse {\n\t\tauto pl = query(s[k].ch[0], l, mid, ql, mid);\n\t\tauto pr = query(s[k].ch[1], mid + 1, r, mid + 1, qr);\n\t\treturn mp(pl.fi + pr.fi, pl.se + pr.se);\n\t}\n}\nvoid insA(int v) {sumA += v; stA.insert(v);}\nvoid insB(int v) {sumB += v; stB.insert(v); insert(rt, 0, MAXV, v, 1);}\nvoid delA(int v) {sumA -= v; stA.erase(stA.find(v));}\nvoid delB(int v) {sumB -= v; stB.erase(stB.find(v)); insert(rt, 0, MAXV, v, -1);}\nll ask(int k, int t, int opt) {\n\tint M = INF;\n\tif (!stA.empty()) chkmin(M, *stA.begin());\n\tif (!stB.empty()) chkmin(M, *stB.begin());\n\tll res = opt * k + 1ll * (k - t) * (n - m) + sumA - sumB;\n//\tprintf(\"! ask %d %d %d %lld\\n\", k, t, M, res);\n\tres += 1ll * max(t - k - M, 0) * n;\n\tauto P = query(rt, 0, MAXV, 0, t - k);\n\tres -= 1ll * (t - k) * P.fi - P.se;\n\treturn res;\n}\nll queryA(int k, int t) {delA(t); --n; ll res = ask(k, t, 1); insA(t); ++n; return res;}\nll queryB(int k, int t) {delB(t); --m; ll res = ask(k, t, -1); insB(t); ++m; return res;}\nll query(int k) {\n\tll res = -INFll;\n\tchkmax(res, queryA(k, *stA.begin()));\n\tif (stB.size() >= 2) {\n\t\tint v = (*++stB.rbegin()) + k;\n\t\tmultiset<int> :: iterator it = stA.lower_bound(v);\n\t\tint A = -1, B = -1;\n\t\tif (it != stA.end()) A = *it;\n\t\tif (it != stA.begin()) B = *--it;\n\t\tif (~A) chkmax(res, queryA(k, A));\n\t\tif (~B) chkmax(res, queryA(k, B));\n\t}\n\tchkmax(res, queryB(k, *stB.begin()));\n\tchkmax(res, queryB(k, *stB.rbegin()));\n\treturn res;\n}\nint main() {\n\tscanf(\"%d%d%d\", &n, &m, &qu);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]), insA(a[i]);\n\tfor (int i = 1; i <= m; i++) scanf(\"%d\", &b[i]), insB(b[i]);\n\twhile (qu--) {\n\t\tint opt; scanf(\"%d\", &opt);\n\t\tif (opt == 1) {\n\t\t\tint p, x; scanf(\"%d%d\", &p, &x);\n\t\t\tdelA(a[p]); a[p] = x; insA(a[p]);\n\t\t} else if (opt == 2) {\n\t\t\tint p, x; scanf(\"%d%d\", &p, &x);\n\t\t\tdelB(b[p]); b[p] = x; insB(b[p]);\n\t\t} else {\n\t\t\tint k; scanf(\"%d\", &k);\n\t\t\tprintf(\"%lld\\n\", query(k));\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1645803166,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1477E Nezzar and Tournaments"
    }
]