[
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/CF914E)\n\n## \u9898\u610f\n\n\u8f6c\u5316\u7248\u9898\u610f\u3002\n\n>\u7ed9\u4f60\u4e00\u9897 $n$ \u4e2a\u9876\u70b9\u7684\u6811\uff0c\u9876\u70b9\u4ece $1$ \u5230 $n$ \u7f16\u53f7\uff0c\u5e76\u4e14\u6bcf\u4e2a\u9876\u70b9\u5bf9\u5e94\u4e00\u4e2a\u5728 ``a`` \u5230 ``t`` \u7684\u5b57\u6bcd\u3002 \u6c42\u7ecf\u8fc7\u6bcf\u4e2a\u8282\u70b9\u7684\u81f3\u591a\u6709\u4e00\u4e2a\u5b57\u6bcd\u7684\u6570\u91cf\u4e3a\u5947\u6570\u7684\u8def\u5f84\u7684\u4e2a\u6570\u3002\n>\n>\u6ce8\u610f\uff1a\u4ece $u$ \u5230 $v$ \u7684\u8def\u5f84\u4e0e\u4ece $v$ \u5230 $u$ \u7684\u8def\u5f84\u89c6\u4e3a\u76f8\u540c\uff0c\u53ea\u8ba1\u6570\u4e00\u6b21\u3002\n\n## \u5206\u6790\n\n``a`` \u5230 ``t`` \u6709 $20$ \u4e2a\u5b57\u6bcd\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u72b6\u538b\u4e00\u4e0b\uff0c\u6bcf\u4e00\u4f4d\u4ee3\u8868\u8be5\u5b57\u6bcd\u6570\u91cf\u662f\u5947\u662f\u5076\uff0c\u800c\u7ef4\u62a4\u8def\u5f84\u7684\u4e2a\u6570\u4e0d\u96be\u60f3\u5230\u70b9\u5206\u6cbb\uff0c\u8bbe $d_x$ \u8868\u793a\u5f53\u524d\u5206\u6cbb\u4e2d\u5fc3 $pos$ \u5230\u70b9 $x$ \u7684\u8def\u5f84\u4e0a\u7684\u5b57\u6bcd\u6570\u91cf\u72b6\u538b\u540e\u7684\u7ed3\u679c\uff0c\u5219\u4e00\u6761\u8def\u5f84 $x \\Leftrightarrow y$ \u7b26\u5408\u8981\u6c42\u4ec5\u5f53 $d_x\\oplus d_y \\oplus d_{pos}=0\\lor2^j(0\\le j<20)$\u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u8def\u5f84\uff0c\u6211\u4eec\u628a\u5b83\u62c6\u6210 $x \\Leftrightarrow pos,pos \\Leftrightarrow y$ \u4e24\u90e8\u5206\uff0c\u8fd9\u6837\u6211\u4eec\u53ea\u8981\u5bf9\u534a\u8fb9\u7684\u8def\u5f84\u8ba1\u6570\u5373\u53ef\uff0c\u5177\u4f53\u5730\uff0c\u8ba1\u7b97 $x \\Leftrightarrow pos$ \u7684\u8d21\u732e\u65f6\uff0c\u7ed9 $x \\Leftrightarrow pos$ \u4e0a\u7684\u6bcf\u4e00\u4e2a\u70b9\u52a0\u4e0a\u5f53\u524d\u5206\u6cbb\u4e2d\u5fc3\u7684\u5168\u5c40\u4e2d $(d_y=2^j\\oplus d_x \\oplus d_{pos}) \\lor (d_y=0 \\oplus d_x \\oplus d_{pos})$ \u7684\u6570\u91cf\uff0c\u4f46\u8fd9\u6837\u7edf\u8ba1\u4f1a\u91cd\u590d\u52a0\u4e0a\u5f53\u524d\u5b50\u6811\u4e2d $(d_y=2^j\\oplus d_x \\oplus d_{pos}) \\lor (d_y=0 \\oplus d_x \\oplus d_{pos})$ \u7684\u6570\u91cf\uff0c\u6240\u4ee5\u518d\u7edf\u8ba1\u5f53\u524d\u5b50\u6811\u4e2d\u7684\u6570\u91cf\uff0c\u63d0\u524d\u51cf\u53bb\u5373\u53ef\u3002\n\n\u4f46\u662f\u8fd8\u662f\u6709\u7f3a\u9677\uff0c\u9996\u5148\uff0c\u8def\u5f84\u7aef\u70b9\u5728\u5206\u6cbb\u4e2d\u5fc3\u7684\u4e0d\u540c\u5b50\u6811\u65f6\u5206\u6cbb\u4e2d\u5fc3 $pos$ \u7684\u7b54\u6848\u4f1a\u88ab\u7b97\u4e24\u6b21\uff0c\u6700\u540e\u7279\u5224\u4e0b\u9664\u4ee5 $2$ \u5373\u53ef\uff1b\u5176\u6b21\uff0c\u8fd9\u6837\u7684\u505a\u6cd5\u53ea\u7edf\u8ba1\u4e86\u8def\u5f84\u7aef\u70b9\u5728\u5206\u6cbb\u4e2d\u5fc3\u7684\u4e0d\u540c\u5b50\u6811\u65f6\u7684\u7b54\u6848\uff0c\u4f46\u8fd8\u6709\u4ee5\u5206\u6cbb\u4e2d\u5fc3\u4e3a\u7aef\u70b9\uff0c\u53e6\u4e00\u7aef\u5728\u5b50\u6811\u5185\u7684\u7b54\u6848\u548c\u6574\u4e2a\u8def\u5f84\u53ea\u6709\u5206\u6cbb\u4e2d\u5fc3\u7684\u7b54\u6848\uff0c\u5bf9\u4e8e\u524d\u8005\uff0c\u7279\u5224\u8ba1\u7b97\u5373\u53ef\uff0c\u5bf9\u4e8e\u540e\u8005\uff0c\u6700\u540e\u8f93\u51fa\u7b54\u6848\u65f6\u52a0 $1$ \u5373\u53ef\u3002\n\n\u4f46\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5206\u6cbb\u4e2d\u5fc3\u7684\u7b54\u6848\u9664\u4ee5 $2$ \u65f6\u4e0d\u80fd\u628a\u4ee5\u5206\u6cbb\u4e2d\u5fc3\u4e3a\u7aef\u70b9\u7684\u9664\u4e86\uff0c\u4e8e\u662f\u8981\u5728\u524d\u9762\u7684\u7279\u5224\u4e2d\u591a\u8bb0\u4e00\u4e2a\u53d8\u91cf\u8868\u793a\u4ee5\u5206\u6cbb\u4e2d\u5fc3\u4e3a\u7aef\u70b9\u7684\u8def\u5f84\u7684\u4e2a\u6570\uff0c\u5bf9\u5206\u6cbb\u4e2d\u5fc3\u7684\u7b54\u6848\u52a0\u4e0a\u6b64\u518d\u9664\u4ee5 $2$ \u5c31\u6ca1\u95ee\u9898\u4e86\u3002\n\n\u5206\u6cbb\u8fc7\u7a0b\u4e2d\u6d89\u53ca\u5230\u6811\u4e0a\u8def\u5f84\u589e\u52a0\u7684\u64cd\u4f5c\uff0c\u7528\u6811\u4e0a\u5dee\u5206\u5c31\u53ef\u4ee5\u4e86\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nlong long read(){\n\tlong long x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n\treturn x*f;\n}\nvoid write(long long x){\n    if(x<0) putchar('-'),x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\nconst int N=2e5+10,M=4e5+10,K=1.2e6+10;\nint head[M],ver[M],nxt[M],tot,Fa[N];\nint n,pos,mx,sze[N],v1[N],d[N],f[K],f2[K],e1[N],e2[N],t1,t2;\nll sum[N],sum2;\nll ans[N],rans[N];\nstring s;\nvoid add(int x,int y){\n\tver[++tot]=y;\n\tnxt[tot]=head[x];\n\thead[x]=tot;\n}\nvoid dfs(int x,int S){\n\tv1[x]=sze[x]=1;\n\tint mx_part=0;\n\tfor(int i=head[x];i;i=nxt[i]){\n\t\tint y=ver[i];\n\t\tif(v1[y]==1||v1[y]==3)\n\t\t\tcontinue;\n\t\tdfs(y,S);\n\t\tsze[x]+=sze[y];\n\t\tmx_part=max(mx_part,sze[y]);\n\t}\n\tmx_part=max(mx_part,S-sze[x]);\n\tif(mx_part<mx){\n\t\tmx=mx_part;\n\t\tpos=x;\n\t}\n}\nvoid dfs2(int x,int fa){\n\tv1[x]=2;\n\tFa[x]=fa;\n\td[x]=d[fa]^(1<<(s[x-1]-'a'));\n\te2[++t2]=x;\n\tfor(int i=head[x];i;i=nxt[i]){\n\t\tint y=ver[i];\n\t\tif(v1[y]==2||v1[y]==3)\n\t\t\tcontinue;\n\t\tdfs2(y,x);\n\t}\n}\nvoid dfs3(int x,int F){\n\tv1[x]=0;\n\tsum[x]=rans[x];\n\tfor(int i=head[x];i;i=nxt[i]){\n\t\tint y=ver[i];\n\t\tif(!v1[y]||v1[y]==3)\n\t\t\tcontinue;\n\t\tdfs3(y,0);\n\t\tsum[x]+=sum[y];\n\t}\n\tif(F)\n\t\tsum[x]=(sum[x]+sum2)/2;\n\tans[x]+=sum[x];\n}\nvoid add(int x,int y,int v){\n\trans[Fa[x]]-=v;\n\trans[y]+=v;\n}\nvoid calc(int x){\n\tt1=sum2=Fa[x]=0;\n\tv1[x]=2;\n\td[x]=(1<<(s[x-1]-'a'));\n\tfor(int i=head[x];i;i=nxt[i]){\n\t\tif(v1[ver[i]]==3)\n\t\t\tcontinue;\n\t\tt2=0;\n\t\tdfs2(ver[i],x);\n\t\tfor(int j=1;j<=t2;j++){\n\t\t\te1[++t1]=e2[j];\n\t\t\tf[d[e2[j]]]++;\n\t\t\tf2[d[e2[j]]]++;\n\t\t}\n\t\tfor(int j=1,a;j<=t2;j++){\n\t\t\ta=0;\n\t\t\ta+=f2[d[e2[j]]^d[x]];\n\t\t\tfor(int u=0;u<20;u++)\n\t\t\t\ta+=f2[d[e2[j]]^(1<<u)^d[x]];\n\t\t\tadd(x,e2[j],-a);\n\t\t\t\n\t\t}\n\t\tfor(int j=1;j<=t2;j++)\n\t\t\tf2[d[e2[j]]]--;\n\t}\n\tfor(int i=1,a;i<=t1;i++){\n\t\ta=0;\n\t\ta+=f[d[e1[i]]^d[x]];\n\t\tif(!d[e1[i]])\n\t\t\ta++,sum2++;\n\t\tfor(int j=0;j<20;j++){\n\t\t\ta+=f[d[e1[i]]^(1<<j)^d[x]];\n\t\t\tif(d[e1[i]]==(1<<j))\n\t\t\t\ta++,sum2++;\n\t\t}\n\t\tadd(x,e1[i],a);\n\t}\n\tdfs3(x,1);\n\trans[0]=v1[x]=0;\n\tfor(int i=1;i<=t1;i++){\n\t\tf[d[e1[i]]]--;\n\t\trans[e1[i]]=0;\n\t}\n}\nvoid DFZ(int x,int S){\n\tmx=1e9;pos=0;\n\tdfs(x,S);\n\tint mxpos=pos;\n\tcalc(pos);\n\tv1[pos]=3;\n\tfor(int i=head[mxpos];i;i=nxt[i]){\n\t\tint y=ver[i];\n\t\tif(v1[y]==3)\n\t\t\tcontinue;\n\t\tDFZ(y,sze[y]);\n\t}\n}\nint main(){\n\tn=read();\n\tfor(int i=1,u,v;i<n;i++){\n\t\tu=read();v=read();\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tcin>>s;\n\tDFZ(1,n);\n\tfor(int i=1;i<=n;i++){\n\t\twrite(ans[i]+1);\n\t\tputchar(' ');\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1643617455,
        "uid": 419144,
        "name": "chenjunxiu",
        "ccfLevel": 7,
        "title": "CF914E Palindromes in a Tree"
    },
    {
        "content": "\u9996\u5148\u662f\u4e00\u4e2a\u7ed3\u8bba   \n\u672c\u9898\u8981\u6c42\u8def\u5f84\u7684\u67d0\u4e2a\u6392\u5217\u4e3a\u56de\u6587\u4e32\uff0c\u5f88\u663e\u7136\uff0c\u8def\u5f84\u4e0a\u6700\u591a\u6709\u4e00\u4e2a\u5b57\u6bcd\u51fa\u73b0\u5947\u6570\u6b21\u3002\u53ea\u9700\u8981\u8bb0\u5f55\u5947\u5076\u6027\u663e\u7136\u53ef\u4ee5\u7528\u72b6\u538b\u53bb\u89e3\u51b3\u3002  \n\u6839\u636e\u8fd9\u4e2a\u7ed3\u8bba\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u51fa\u5bf9\u4e8e\u4e00\u4e2a\u70b9u\uff0c\u4ed6\u5230\u67d0\u4e2a\u70b9v\u7684\u8def\u5f84\u5982\u679c\u6ee1\u8db3\u6761\u4ef6\uff0c\u663e\u7136\u72b6\u538b\u7684\u6570\u5b57\u7b49\u4e8e0\u6216\u80051<<i(i<=19)\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u641e\u51fa\u4e00\u4e2a\u4e2d\u70b9k\uff0c\u4e8e\u662f\u95ee\u9898\u7b49\u4ef7\u4e8edis(u,k)^dis(v,k)\u7b49\u4e8e0\u6216\u80051<<i(i<=19)   \n\u8fd9\u663e\u7136\u662f\u70b9\u5206\u6cbb\u7684\u601d\u8def   \n\u8003\u8651\u70b9\u5206\u6cbb\u4e2d\u7684\u66b4\u529b\u600e\u4e48\u5199\uff1a\u9996\u5148\u5bf9\u4e8e\u91cd\u5fc3\u8fdb\u884cdfs\uff0c\u6c42\u51fa\u6240\u6709\u70b9\u5230\u91cd\u5fc3\u7684dis\uff0cdis\u8868\u793a\u8def\u5f84\u4e0a\u4e2a\u5b57\u6bcd\u7684\u5947\u5076\u6027\uff0c\u5e76\u4e14\u8bb0\u5f55$dis_i$\u7684\u6570\u91cf\u3002   \n\u63a5\u7740\u5bf9\u4e8e\u6bcf\u68f5\u5b50\u6811\u5c06\u8be5\u5b50\u6811\u5bf9\u6240\u6709dis\u7684\u6570\u91cf\u8d21\u732e\u5168\u90e8\u53bb\u6389\uff0c\u518d\u5bf9\u8be5\u5b50\u6811\u8fdb\u884cdfs\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u7684dis\uff0c\u7edf\u8ba1\u4e0e\u4ed6\u5f02\u6216\u7b49\u4e8e0\u6216\u80051<<i(i<=19)\u7684\u6570\u91cf\uff0c\u5373\u4e3a\u8be5\u70b9\u8d21\u732e\u7b54\u6848\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7ecf\u8fc7\u8be5\u70b9\u7684\u8def\u5f84\u4e00\u5b9a\u7ecf\u8fc7\u5176\u7236\u8282\u70b9\uff0c\u56e0\u4e3a\u662f\u4ece\u53e6\u4e00\u9897\u5b50\u6811\u4e2d\u8dd1\u8fc7\u6765\u7684\uff0c\u6240\u4ee5\u5728dfs\u8fd4\u56de\u7684\u65f6\u5019\u5e94\u8be5\u7ed9\u7236\u8282\u70b9\u52a0\u4e0a\u5b50\u8282\u70b9\u7684\u8d21\u732e\u3002\u63a5\u7740\u628a\u8be5\u5b50\u6811\u7684dis\u5168\u90e8\u52a0\u56de\u53bb\u8dd1\u4e0b\u4e00\u68f5\u5b50\u6811\u3002  \n\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u672c\u8eab\u90fd\u662f\u4e00\u4e2a\u56de\u6587\u4e32\uff0c\u6240\u4ee5\u6700\u540e\u7b54\u6848\u8981\u52a0\u4e00\u3002\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```CPP\n#include<map>\n#include<set>\n#include<queue>\n#include<cmath>\n#include<cstdio>\n#include<string>\n#include<vector>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define poi void\n#define int long long\nusing namespace std;\n\nvector<int> g[200010];\nchar c[200010];\nint n,ans[200010],a[200010],size[200010],vis[200010],f[200010],tmp[(1<<20)|10]; \n\npoi get_size(int now,int fa)\n{\n\tsize[now]=1;\n\tf[now]=fa;\n\tfor(int i=0;i<g[now].size();i++)\n\t{\n\t\tif(vis[g[now][i]]||g[now][i]==fa) continue;\n\t\tget_size(g[now][i],now);\n\t\tsize[now]+=size[g[now][i]];\n\t}\n}\n\nint get_zx(int now,int fa)\n{\n\tif(size[now]==1) return now;\n\tint son,maxson=-1;\n\tfor(int i=0;i<g[now].size();i++)\n\t{\n\t\tif(vis[g[now][i]]||g[now][i]==fa) continue;\n\t\tif(maxson<size[g[now][i]])\n\t\t{\n\t\t\tmaxson=size[g[now][i]];\n\t\t\tson=g[now][i];\n\t\t}\n\t}\n\tint zx=get_zx(son,now);\n\twhile(size[zx]<2*(size[now]-size[zx])) zx=f[zx];\n\treturn zx;\n}\n\npoi get(int now,int fa,int sta,int kd)\n{ \n    sta^=(1<<a[now]);\n\ttmp[sta]+=kd;\n\tfor(int i=0;i<g[now].size();i++)\n\t{\n\t\tif(vis[g[now][i]]||g[now][i]==fa) continue;\n\t\tget(g[now][i],now,sta,kd);\n\t}\n}\n\nint calc(int now,int fa,int sta)\n{\n\tsta^=(1<<a[now]);\n\tint num=tmp[sta];\n\tfor(int i=0;i<=19;i++)\n\t{\n\t\tnum+=tmp[sta^(1<<i)];\n\t}\n\tfor(int i=0;i<g[now].size();i++)\n\t{\n\t\tif(vis[g[now][i]]||g[now][i]==fa) continue;\n\t\tnum+=calc(g[now][i],now,sta);\n\t}\n\tans[now]+=num;\n\treturn num;\n}\n\npoi solve(int now)\n{\n\tvis[now]=1;\n\tget(now,0,0,1);\n\tlong long num=tmp[0];\n\tfor(int i=0;i<=19;i++)\n\t{\n\t\tnum+=tmp[1<<i];\n\t}\n\tfor(int i=0;i<g[now].size();i++)\n\t{\n\t\tif(vis[g[now][i]]) continue;\n\t\tget(g[now][i],0,1<<a[now],-1);\n\t\tnum+=calc(g[now][i],0,0);\n\t\tget(g[now][i],0,1<<a[now],1);\n\t}\n\tans[now]+=num/2;\n\tget(now,0,0,-1);\n\tfor(int i=0;i<g[now].size();i++)\n\t{\n\t\tif(vis[g[now][i]]) continue;\n\t\tget_size(g[now][i],0);\n\t\tint zx=get_zx(g[now][i],0);\n\t\tsolve(zx);\n\t}\n}\n\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint from,to;\n\t\tscanf(\"%lld%lld\",&from,&to);\n\t\tg[from].push_back(to);\n\t\tg[to].push_back(from);\n\t}\n\tscanf(\"%s\",c+1);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\ta[i]=c[i]-'a';\n\t}\n\tsolve(1);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tprintf(\"%lld \",ans[i]+1);\n\t}\n}\n\n```",
        "postTime": 1533611925,
        "uid": 48740,
        "name": "Styx",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF914E \u3010Palindromes in a Tree\u3011"
    },
    {
        "content": "> [CF914E Palindromes in a Tree \u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF914E)\u3002\n>\n> \u9898\u610f\u7b80\u8ff0\uff1a\u7ed9\u4e00\u68f5\u6811\uff0c\u8282\u70b9\u4e0a\u6709\u5b57\u7b26\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u6c42\u6709\u591a\u5c11\u6761\u7ecf\u8fc7\u8be5\u70b9\u7684\u8def\u5f84\u6ee1\u8db3\u8be5\u8def\u5f84\u4e0a\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6700\u591a\u6709 $1$ \u4e2a\u3002\n>\n> $n\\leq 2\\times 10^5$\uff0c\u5b57\u7b26\u96c6\u5927\u5c0f\u4e3a $20$\u3002\n>\n> \u6458\u81ea [\u7b80\u5355\u6811\u8bba](https://www.cnblogs.com/alex-wei/p/Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree_Tree.html) \u70b9\u5206\u6cbb\u90e8\u5206\u4f8b\u9898 VII\u3002\n\n\u8bdd\u8bf4\u8fd9\u4e2a\u6807\u9898\u6709\u70b9\u8bef\u5bfc\u4eba\uff0c\u4e00\u5f00\u59cb\u60f3\u4e25\u683c\u610f\u4e49\u4e0a\u7684\u56de\u6587\u4e32\u89c9\u5f97\u5f88\u4e0d\u53ef\u505a\u3002\n\n---\n\n\u6811\u4e0a\u8def\u5f84\u7edf\u8ba1\uff0c\u4e0d\u96be\u60f3\u5230\u70b9\u5206\u6cbb\uff0c\u800c\u5224\u65ad\u6700\u591a\u6709\u4e00\u4e2a\u5b57\u7b26\u51fa\u73b0\u5947\u6570\u6b21\u53ef\u4ee5\u7528\u72b6\u538b\u3002\u5177\u4f53\u5730\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5206\u6cbb\u4e2d\u5fc3 $r$\uff0c\u7528\u4e00\u4e2a $20$ \u4f4d\u4e8c\u8fdb\u5236\u6570\u7edf\u8ba1\u5b83\u7684\u6240\u6709\u5b50\u8282\u70b9 $u$ \u5230 $r$\uff08\u4e0d\u5305\u62ec $r$\uff09\u7684\u8def\u5f84\u4e0a\u6bcf\u4e2a\u5b57\u7b26\u7684\u51fa\u73b0\u6b21\u6570\u7684\u5947\u5076\u6027\uff0c\u8bb0\u4e3a $msk_u$\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86\u6709\u591a\u5c11\u6761\u8def\u5f84\u4ee5\u7aef\u70b9 $u$ \u7ed3\u5c3e\u5e76\u7ecf\u8fc7\u5206\u6cbb\u4e2d\u5fc3\uff0c\u8bbe\u4e3a $p_u$\uff0c\u90a3\u4e48\u4ece $u$ \u5230 $r$ \u4e0a\u7684\u6240\u6709\u70b9\uff08\u9664\u4e86 $r$ \u9700\u8981\u5355\u72ec\u5904\u7406\uff09\u90fd\u8981\u52a0\u4e0a $p_u$\u3002\u7531\u4e8e\u662f\u79bb\u7ebf\u6240\u4ee5\u4f7f\u7528\u6811\u4e0a\u5dee\u5206\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $u$\uff0c\u6211\u4eec\u5c06**\u53ea\u5230\u5206\u6cbb\u4e2d\u5fc3**\u7684\u8def\u5f84\u548c**\u8de8\u8fc7\u5206\u6cbb\u4e2d\u5fc3**\u7684\u8def\u5f84\u5206\u5f00\u6765\u8003\u8651\uff0c\u56e0\u4e3a\u5728**\u6839\u8282\u70b9** $r$ \u5904\uff0c**\u524d\u8005\u53ea\u4f1a\u88ab\u8ba1\u7b97\u4e00\u6b21\uff0c\u800c\u540e\u8005\u4f1a\u88ab\u8ba1\u7b97\u4e24\u6b21**\u3002\u8bb0 $c=msk_u\\oplus 2^{s_r}$\u3002\n\n- \u53ea\u5230\u5206\u6cbb\u4e2d\u5fc3\uff1a\u5982\u679c\u5b58\u5728 $k$ \u4f7f\u5f97 $c\\oplus 2^k=0$ \u6216 $c$ \u672c\u8eab\u5c31\u4e3a $0$\uff0c\u90a3\u4e48\u8def\u5f84 $(u,r)$ \u662f\u5408\u6cd5\u7684\u3002\u5c06 $p_u$ \u548c $ans_r$ \u589e\u52a0 $1$\u3002\n- \u8de8\u8fc7\u5206\u6cbb\u4e2d\u5fc3\uff1a\u679a\u4e3e\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u5b57\u7b26 $k$\uff0c\u5bf9\u4e8e\u6240\u6709\u4f7f\u5f97 $c\\oplus 2^k\\oplus msk_v=0$\uff08**\u5373 $c\\oplus 2^k=msk_v$**\uff09\u7684 $v$\uff0c$(u,v)$ \u90fd\u662f\u4e00\u6761\u5408\u6cd5\u8def\u5f84\uff0c\u53ef\u4ee5\u901a\u8fc7\u7528**\u4e24\u4e2a\u6876**\u5206\u522b\u8bb0\u5f55**\u5728\u6574\u68f5 $r$ \u7684\u5b50\u6811\u5185 \u548c \u5728\u5f53\u524d\u70b9 $u$ \u6240\u5728\u7684\u5b50\u6811\u4e2d**\uff08\u4e3a\u4e86\u9664\u53bb\u4e0d\u7ecf\u8fc7\u5206\u6cbb\u4e2d\u5fc3\u7684\u7b54\u6848\uff09$msk_v=x$ \u7684 $v$ \u6570\u91cf\uff0c\u5206\u522b\u8bb0\u4e3a $buc1_x$ \u548c $buc2_x$\uff0c\u90a3\u4e48 $v$ \u7684\u6570\u91cf\u5373\u4e3a $buc1_{c\\oplus k}-buc2_{c\\oplus k}$\u3002\u4e0d\u8981\u5fd8\u8bb0\u8003\u8651\u6ca1\u6709\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u60c5\u51b5\u3002\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u6709\u4e86\u4e00\u4e2a $\\mathcal{O}(n\\log n\\mathbf|\u03a3|)$ \u7684\u7b97\u6cd5\uff1a\u70b9\u5206\u6cbb\uff0c\u7edf\u8ba1\u7b54\u6848\u65f6\u679a\u4e3e $i=0$ \u548c $i=2^k$\uff0c\u8bb0 $c=msk_u\\oplus 2^{s_r}\\oplus i$\u3002\u82e5 $c=0$\uff0c\u5219\u5c06\u6807\u8bb0\u8bb0\u4e3a $1$\u3002\u540c\u65f6\u5c06 $p_u$ \u52a0\u4e0a $buc1_c-buc2_c$\u3002\u679a\u4e3e\u7ed3\u675f\u540e\uff0c\u82e5\u6807\u8bb0\u4e3a $1$\uff0c\u5219\u5c06 $p_u$ \u548c $ans_r$ \u90fd\u52a0\u4e0a $1$\u3002\u6700\u540e\u4f7f\u7528\u6811\u4e0a\u5dee\u5206\u7edf\u8ba1**\u975e\u5206\u6cbb\u4e2d\u5fc3\u7684\u6240\u6709\u8282\u70b9**\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u8bb0\u5f97\u5c06\u6876\u6e05\u96f6\u3002\u6b64\u5916\uff0c\u4e0d\u9700\u8981\u5728\u4e00\u5f00\u59cb\u5c06 $buc1_0$ \u8bbe\u4e3a $1$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define db double\n#define ll long long\n#define ld long double\n#define ull unsigned long long\n\n#define pii pair <int,int>\n#define fi first\n#define se second\n#define pb emplace_back\n#define mem(x,v,s) memset(x,v,sizeof(x[0])*(s))\n#define cpy(x,y,s) memcpy(x,y,sizeof(x[0])*(s))\n\nconst int N=2e5+5;\nconst int S=20;\n\nint n,vis[N];\nchar s[N];\nvector <int> e[N];\n\nll ans[N],buc[1<<S],insi[1<<S],p[N];\nvector <pii> res[N];\nint root,mx[N],sz[N];\n\nvoid findr(int id,int f,int tot){\n\tmx[id]=sz[id]=1;\n\tfor(int it:e[id])\n\t\tif(it!=f&&!vis[it]){\n\t\t\tfindr(it,id,tot),sz[id]+=sz[it];\n\t\t\tmx[id]=max(mx[id],sz[it]);\n\t\t}\n\tmx[id]=max(mx[id],tot-sz[id]);\n\tif(mx[id]<mx[root])root=id;\n}\nvoid presum(int id,int f){\n\tfor(int it:e[id])\n\t\tif(it!=f&&!vis[it])\n\t\t\tpresum(it,id),\n\t\t\tp[id]+=p[it];\n\tif(f)ans[id]+=p[id];\n}\nvoid calc(int id,int f,int pre,int anc){\n\tres[anc].pb((pii){pre^=(1<<s[id]-'a'),id}),p[id]=0;\n\tfor(int it:e[id])if(it!=f&&!vis[it])calc(it,id,pre,anc);\n}\nvoid divide(int id){\n\tint msk=1<<s[id]-'a';\n\tvis[id]=1,p[id]=0;\n\tfor(int it:e[id])\n\t\tif(!vis[it]){\n\t\t\tres[it].clear(),calc(it,id,0,it);\n\t\t\tfor(pii c:res[it])buc[c.fi]++;\n\t\t}\n\tll sum=0;\n\tfor(int it:e[id]){\n\t\tif(vis[it])continue;\n\t\tfor(pii c:res[it])insi[c.fi]++;\n\t\tfor(pii c:res[it]){\n\t\t\tbool have=0;\n\t\t\tfor(int k=-1;k<20;k++){\n\t\t\t\tint msk2=(k<0?0:1<<k),r=c.fi^msk^msk2;\n\t\t\t\tif(!r)have=1;\n\t\t\t\tll d=buc[r]-insi[r];\n\t\t\t\tsum+=d,p[c.se]+=d;\n\t\t\t} if(have)p[c.se]++,ans[id]++;\n\t\t} for(pii c:res[it])insi[c.fi]=0;\n\t} presum(id,0),ans[id]+=sum>>1,assert(sum%2==0);\n\tfor(int it:e[id])for(pii c:res[it])buc[c.fi]=0;\n\tfor(int it:e[id])if(!vis[it])root=0,findr(it,id,sz[it]),divide(root);\n}\n\n\nint main(){\n\tcin>>n,mx[0]=n+1;\n\tfor(int i=1;i<n;i++){\n\t\tint u,v; cin>>u>>v;\n\t\te[u].pb(v),e[v].pb(u);\n\t} scanf(\"%s\",s+1);\n\tfindr(1,0,n),divide(root);\n\tfor(int i=1;i<=n;i++)cout<<ans[i]+1<<\" \";\n\tcout<<endl;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1631417980,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "CF914E Palindromes in a Tree"
    },
    {
        "content": "\u9996\u5148\u867d\u7136\u8fd9\u4e2a\u9898\u8bf4\u7684\u5f88\u4e0d\u6e05\u695a\uff0c\u4f46\u5b83\u7684\u56de\u6587\u4e32\u548c\u6211\u4eec\u4e00\u822c\u8bf4\u7684\u56de\u6587\u4e32\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u5728\u8fd9\u4e2a\u9898\u91cc\uff0c\u4e00\u4e2a\u4e32\u662f\u56de\u6587\u7684\u5f53\u4e14\u4ec5\u5f53\u5176\u4e2d\u81f3\u591a\u4e00\u4e2a\u5b57\u6bcd\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u3002\u540c\u65f6\uff0c\u5982\u679c\u4f60\u4e0d\u50cf\u6211\u4e00\u6837\u50bb\u53c9\u7684\u8bdd\uff0c\u4f60\u4f1a\u53d1\u73b0'a'\u5230't'\u4e00\u5171\u670919\u4e2a\u5b57\u6bcd\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u72b6\u538b\u5b58\u4e00\u4e2a\u4e32\u6bcf\u4e2a\u5b57\u6bcd\u7684\u5947\u5076\u6027\uff0c\u7136\u540e\u4e0a\u70b9\u5206\u6cbb\u3002\n\n\u70b9\u5206\u6cbb\u7684\u5177\u4f53\u5b9e\u73b0\u65b9\u6cd5\u5c31\u662f\u5148\u628a\u4e00\u4e2a\u5206\u6cbb\u4e2d\u5fc3\u5b50\u6811\u4e2d\u6240\u6709\u4e32\u72b6\u538b\u5f00\u4e2a\u6876\u5b58\u4e0b\u6765\uff0c\u7136\u540e\u679a\u4e3e\u6bcf\u4e2a\u5b50\u6811\uff0c\u628a\u5176\u4e2d\u7684\u4e32\u5728\u6876\u4e2d\u5220\u53bb\u3002dfs\u8fd9\u4e2a\u5b50\u6811\u8ba1\u7b97\u8d21\u732e\uff0c\u7531\u4e8e\u95ee\u7684\u662f\u5728\u56de\u6587\u4e32\u4e0a\u70b9\u7684\u4e2a\u6570\uff0c\u6240\u4ee5\u6bcf\u6b21\u7edf\u8ba1\u4e00\u4e2a\u70b9\u8981\u52a0\u4e0a**\u8fd9\u6b21\u7edf\u8ba1**\u4e2d\u8fd9\u4e2a\u70b9\u513f\u5b50\u7684\u7b54\u6848\u3002\u8fd9\u6837\u5206\u6cbb\u4e2d\u5fc3\u4f1a\u88ab$u->v$\u7684\u8def\u5f84\u548c$v->u$\u7684\u8def\u5f84\u7b97\u4e24\u6b21\uff0c\u6240\u4ee5\u5206\u6cbb\u4e2d\u5fc3\u7edf\u8ba1\u7684\u65f6\u5019\u9664\u4e2a2\u3002\u4ee5\u53ca\u5355\u4e2a\u5b57\u7b26\u4e5f\u662f\u4e2a\u56de\u6587\u4e32\uff0c\u6240\u4ee5\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\u518d\u52a0\u4e00\u3002\n\n\u5173\u4e8e\u5177\u4f53\u8ba1\u6570\u7684\u5b9e\u73b0\u89c1\u4ee3\u7801\u3002\n\n```c++\n#include<cstdio>\n#include<iostream>\n#define ll long long\nusing namespace std;\nstruct node{\n\tint next,to;\n}w[400001];\nint size[200001],head[200001],vis[200001];\nint maxn[200001],all,rt,a[200001],n,cnt;\nll o[1<<20],ans[200001];\nchar ch[200001];\ninline void add(int x,int y){\n\tw[++cnt].next=head[x];\n\tw[cnt].to=y; head[x]=cnt;\n}\nvoid get_rt(int x,int fa){\n\tsize[x]=1; maxn[x]=0;\n\tfor (int i=head[x]; i; i=w[i].next){\n\t\tif (w[i].to!=fa&&!vis[w[i].to]){\n\t\t\tget_rt(w[i].to,x);\n\t\t\tsize[x]+=size[w[i].to];\n\t\t\tmaxn[x]=max(maxn[x],size[w[i].to]);\n\t\t}\n\t}\n\tmaxn[x]=max(maxn[x],all-size[x]);\n\tif (maxn[x]<maxn[rt]) rt=x;\n}\nvoid dfs(int x,int fa,int y,int dis){\n\tdis^=(1<<a[x]); o[dis]+=y;\n\tfor (int i=head[x]; i; i=w[i].next)\n\t\tif (w[i].to!=fa&&!vis[w[i].to])\n\t\t\tdfs(w[i].to,x,y,dis);\n}\nll get_dis(int x,int fa,int l){\n\tl^=(1<<a[x]); ll num=o[l];\n\tfor (int i=0; i<=19; i++) num+=o[l^(1<<i)];\n\tfor (int i=head[x]; i; i=w[i].next){\n\t\tif (w[i].to!=fa&&!vis[w[i].to]){\n\t\t\tnum+=get_dis(w[i].to,x,l);\n\t\t}\n\t}\n\tans[x]+=num;\n\treturn num;\n}\nvoid calc(int x){\n\tvis[x]=1;\n\tdfs(x,0,1,0);\n\t// for (int i=head[x]; i; i=w[i].next){\n\t// \tif (vis[w[i].to]) continue;\n\t// \tdfs(w[i].to,x,1,1<<a[w[i].to]);\n\t// }\n\tll num=o[0];\n\tfor (int i=0; i<=19; i++) num+=o[1<<i];\n\tfor (int i=head[x]; i; i=w[i].next){\n\t\tif (vis[w[i].to]) continue;\n\t\tdfs(w[i].to,x,-1,1<<a[x]);\n\t\tnum+=get_dis(w[i].to,x,0);\n\t\tdfs(w[i].to,x,1,1<<a[x]);\n\t}\n\tdfs(x,0,-1,0); ans[x]+=num/2;\n}\nvoid solve(int x){\n\tcalc(x);\n\tfor (int i=head[x]; i; i=w[i].next){\n\t\tif (vis[w[i].to]) continue;\n\t\trt=0; all=size[w[i].to];\n\t\tget_rt(w[i].to,0); solve(rt);\n\t}\n}\nint main(){\n\tint x,y;\n\tscanf(\"%d\",&n);\n\tfor (int i=1; i<n; i++){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y); add(y,x);\n\t}\n\tscanf(\"%s\",ch+1);\n\tfor (int i=1; i<=n; i++) a[i]=ch[i]-'a';\n\tmaxn[0]=1e9; all=n; get_rt(1,0);\n\tsolve(rt);\n\tfor (int i=1; i<=n; i++) printf(\"%I64d \",ans[i]+1);\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1554122375,
        "uid": 63661,
        "name": "Taduro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF914E \u3010Palindromes in a Tree\u3011"
    }
]