[
    {
        "content": "\u6765\u8bf4\u4e00\u4e2a\u9a9a\u64cd\u4f5c\n\n\u9898\u76ee\u8981\u6c42\u5c31\u662f\u5b57\u7b26\u4e32\u5339\u914d\uff0c\u8bbe$|s|=|t|$\uff0c\u5982\u679c$s$\u5339\u914d$t$\uff0c\u90a3\u4e48\u8bbe$s_i=a,t_i=b$\uff0c\u5fc5\u987b\u6ee1\u8db3$a=b$\u6216$p_a=b$\u3002\n\n\u4e00\u79cd\u505a\u6cd5\u662f\u63a8\u51fa$a,b$\u7684\u8d21\u732e\u4e3a$(a-b)^2(p_a-b)^2=0$\uff0c\u7531\u4e8e\u5b83\u4e00\u5b9a\u975e\u8d1f\u6240\u4ee5\u53ea\u9700\u6c42\u51fa$s,t$\u5bf9\u5e94\u4e24\u4e2a\u5b57\u7b26\u7684\u8d21\u732e\u4e4b\u548c\uff0c\u4e3a$0$\u5c31\u5339\u914d\u4e0a\u4e86\u3002\n\n\u62c6\u5f00\u8fd9\u4e2a\u5de8\u5927\u7684\u5f0f\u5b50\uff0c\u6bcf\u4e00\u9879\u90fd\u5f62\u5982$ca^rp_a^sb^t$\u3002\n\n\u5c06$s$\u4e32\u53cd\u8f6c\u4e4b\u540e\u5c31\u5bb9\u6613\u53ef\u4ee5\u75289\u8f6eFFT\u6c42\u51fa\u7b54\u6848\u3002\u6ce8\u610f\u8fd9\u91cc\u7684FFT\u957f\u5ea6\u8bbe\u4e3a$|t|$\u5c31\u591f\u4e86\u3002\n\n\uff08\u8fd9\u79cd\u505a\u6cd5\u548c\u5b57\u7b26\u96c6\u5927\u5c0f\u65e0\u5173\uff0c\u6bd4\u8f83\u4f18\u79c0\uff09\n\n\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\uff0c\u66b4\u529b\u679a\u4e3e26\u79cd$b$\uff0c\u76f4\u63a5\u66b4\u529b\u8ba1\u7b97$a=b$\u548c$p_a=b$\u7684$(a,b)$\u5bf9\u6570\u3002\n\n\u53cd\u8f6c$s$\uff0c\u53ea\u8981\u7528\u4e24\u4e2a\u6570\u7ec4$S,T$\uff0c$S_i=[s_i=b\\lor p_{s_i}=b],T_i=[t_i=b]$\uff0c\u76f4\u63a5\u5377\u79ef\u5373\u53ef\u3002\n\n\u4f46\u662f\u53ef\u4ee5\u5c06\u4e24\u4e2a\u5b57\u7b26\u653e\u4e00\u8d77\u505a\uff0c\u5047\u8bbe\u4e00\u8d77\u5904\u7406\u5b57\u7b26$p,q$\uff0c\u8bbe$S_i=[s_i=p\\lor p_{s_i}=p]+[s_i=q\\lor p_{s_i}=q]i,T_i=[t_i=p]-[t_i=q]i$\uff08\u6709\u53d8\u91cf\u91cd\u540d\u4f46\u80fd\u770b\u61c2\uff0c$S,T$\u6700\u540e\u4e58\u7684\u90a3\u4e2a$i$\u662f\u865a\u6570\u5355\u4f4d\uff09\u5c31\u53ef\u4ee5\u51cf\u5c0f\u4e00\u534a\u5e38\u6570\uff0c\u6bd4\u8f83\u8f7b\u677e\u5730\u901a\u8fc7\u8fd9\u9898\u3002",
        "postTime": 1586618519,
        "uid": 23118,
        "name": "\u03bb\u1d09\u028d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1334G \u3010Substring Search\u3011"
    },
    {
        "content": "\u5c06 $S$ \u505a\u7f6e\u6362\u4e4b\u540e\u7684\u4e32\u4e3a $S'$\uff0c\u663e\u7136\u53ef\u4ee5\u8bbe\u5339\u914d\u51fd\u6570 $P(x) = \\sum_{i=1}^m (T_{x-m+1} - S_i)^2 (T_{x-m+1} - S'_i)^2$ \u7136\u540e\u505a\u5377\u79ef\u5339\u914d\u3002\n\n\u7136\u800c\u8fd9\u4e2a\u4e1c\u897f\u770b\u8d77\u6765\u597d\u957f\u597d\u957f\uff0c\u4e0d\u60f3\u5199\u3002\u6211\u4eec\u7a0d\u5fae\u52c7\u6562\u4e00\u70b9\uff0c\u628a\u90a3\u4e2a\u5e73\u65b9\u6254\u6389\uff0c $P(x) = \\sum_{i=1}^m (T_{x-m+1} - S_i)(T_{x-m+1} - S'_i)$ \u3002 \u8fd9\u4e2a\u4e1c\u897f\u5f53\u7136\u662f\u4e0d\u5bf9\u7684\uff0c\u4f46\u662f\u6211\u4eec\u5bf9\u6bcf\u79cd\u5b57\u7b26\u7684\u6743\u503c\u5728 $[1, 998244353)$ \u5185\u5747\u5300\u968f\u673a\u4e4b\u540e\uff0c\u8fd9\u4e2a\u4e1c\u897f\u5927\u6982\u7387\u6b63\u786e\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u79cd\u54c8\u5e0c\u7684\u601d\u60f3\u3002\n\n\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u4e00\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\uff0c\u8dd1\u5f97\u98de\u5feb\u3002\n\n\u4e0d\u8fc7\u867d\u7136A\u4e86\uff0c\u8fd9\u4e2a\u4e1c\u897f\u770b\u8d77\u6765\u8fd8\u662f\u4e0d\u662f\u5f88\u9760\u8c31\u3002\u6c42\u95ee\u4e00\u4e0b\u6709\u6ca1\u6709\u80fd\u786e\u5b9a\u6027\u5361\u6389\u5b83\u7684\u529e\u6cd5\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define maxn 1200005\ntypedef long long ll;\nconst int mod = 998244353;\nconst int g = 3;\nint rev[maxn],n,m,A[maxn],B[maxn],C[maxn],P[maxn],F[maxn],G[maxn],H[maxn],Prx[maxn],\np[29],w[29],sum;\nchar S[maxn],R[maxn];\n\nint sqr(int x){return (ll)x*x%mod;}\n\nint qpow(int a,int b){\n\tif(b==0)return 1;\n\tll d=qpow(a,b>>1);d=d*d%mod;\n\tif(b&1)d=d*a%mod;\n\treturn d;\n}\n\nvoid NTT (int *a, int lim, int flag) {\n\tfor (int i=1;i<lim;++i) rev[i] = (rev[i>>1]>>1) | ((lim>>1) * (i&1));\n\tfor (int i=1;i<lim;++i) if (i<rev[i]) std::swap(a[i],a[rev[i]]);\n\tfor (int i=1;i<lim;i<<=1) {\n\t\tint wn = qpow(g,(mod-1)/(i<<1));\n\t\tif (flag == -1) wn = qpow(wn,mod-2);\n\t\tfor (int j=0;j<lim;j+=(i<<1)) {\n\t\t\tfor (int k=0,w=1;k<i;++k,w=(ll)w*wn%mod) {\n\t\t\t\tint a1 = a[j+k], a2 = (ll) w * a[j+k+i] % mod;\n\t\t\t\ta[j+k] = (a1 + a2) % mod;\n\t\t\t\ta[j+k+i] = (a1 - a2 + mod) % mod;\n\t\t\t}\n\t\t}\n\t}if (flag == -1)\n\t\tfor (int i=0,inv=qpow(lim,mod-2);i<lim;++i) a[i] = (ll) a[i] * inv % mod;\n}\n\nvoid conv(int len){\n\tstd::memset ( C, 0, sizeof (C));\n\tint lim = 1; while (lim <= len + 2) lim <<= 1;\n\tNTT(A,lim,1); NTT(B,lim,1);\n\tfor (int i = 0; i < lim; ++ i) C[i] = (ll) A[i] * B[i] % mod;\n\tNTT(C,lim,-1);\n\tstd::memset( A, 0, sizeof(A));\n\tstd::memset( B, 0, sizeof(B));\n}\n\nint main(){\n\tfor(int i=1;i<=26;++i)scanf(\"%d\",&p[i]);\n\tscanf(\"%s%s\",R+1,S+1);\n\tn = std::strlen(S+1); m = std::strlen(R+1);\n\tstd::reverse(R+1,R+m+1);\n\tfor (int i = 1; i <= 26; ++ i) \n\t\tw[i] = (rand() * 32768 + rand())%mod;\n\tfor (int i = 1; i <= n; ++ i) {\n\t\tF[i] = w[S[i] - 'a' + 1];\n\t\tPrx[i] = (Prx[i-1] + (ll) F[i] * F[i] % mod) % mod;\n\t} for (int i = 1; i <= m; ++ i) {\n\t\tG[i] = w[p[R[i] - 'a' + 1]];\n\t\tH[i] = w[R[i] - 'a' + 1];\n\t\tsum = (sum + (ll)H[i] * G[i] % mod) % mod;\n\t}\n\tfor (int i = 1; i <= m; ++ i) A[i] = (H[i] + G[i]) % mod;\n\tfor (int i = 1; i <= n; ++ i) B[i] = F[i];\n\tconv(n+m);\n\tfor (int j = 1; j <= n+m; ++j) P[j] = (P[j] - C[j] + mod) % mod;\n\tfor (int j= m+1; j <= n+1; ++j) {\n\t\tP[j] = (P[j] + (Prx[j-1] - Prx[j-m-1] + mod) % mod) % mod;\n\t\tP[j] = (P[j] + sum) % mod;\n\t}for (int j = m+1; j <= n+1; ++j)printf(\"%d\",P[j]==0);\n\treturn 0;\n}\n\n\n\n\n\n```\n",
        "postTime": 1589896543,
        "uid": 48355,
        "name": "EternalAlexander",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1334G \u3010Substring Search\u3011"
    },
    {
        "content": "\u4e24\u4e2a\u5b57\u7b26\u5339\u914d\u7b49\u4ef7\u4e8e $(s_i-t_j)^2(s_i-p_{tj})^2=0$\uff0c\u90a3\u4e48\u4e24\u4e2a\u5b57\u7b26\u4e32\u5339\u914d\u5c31\u76f8\u5f53\u4e8e $\\sum (s_i-t_j)^2(s_i-p_{tj})^2=0$\u3002\n\n\u5c06\u8fd9\u4e2a\u5f0f\u5b50\u62c6\u5f00\uff0c\u53ef\u4ee5\u53d1\u73b0\u8f6c\u5316\u6210\u4e86\u4e00\u4e2a\u7c7b\u4f3c\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u800c\u5982\u679c\u5c06 $t$ \u7ffb\u8f6c\u7684\u8bdd\u5377\u79ef\u540e\u7b2c $i$ \u4f4d\u4e0a\u7684\u7ed3\u679c\u5c31\u8868\u793a\u4e86 $s$ \u4e2d\u4ee5 $i$ \u7ed3\u5c3e\u7684\u8fd9\u4e2a\u5b50\u4e32\u662f\u5426\u4e0e $t$ \u5339\u914d\uff0c\u90a3\u4e48\u7528 NTT \u6c42\u89e3\u5373\u53ef\uff0c\u590d\u6742\u5ea6\u4e3a $O(nlog^2n)$\u3002\n\n\u989d\u5916\u7684\uff0c\u56e0\u4e3a NTT \u53ef\u4ee5\u770b\u505a\u662f\u5728\u6a21\u5927\u8d28\u6570\u4e0b\u8fdb\u884c hash\uff0c\u6240\u4ee5\u4f1a\u88ab hack \u6570\u636e\u5361\u6389\u3002\u89e3\u51b3\u65b9\u6cd5\u6709\u51e0\u79cd\uff0c\u4e00\u662f\u56e0\u4e3a $26^4\\times10^5 \\approx 4\\times 10^{10}$\uff0c\u6240\u4ee5\u53d6\u4e24\u4e2a\u6a21\u6570\u4e00\u5b9a\u4e0d\u4f1a\u88ab\u5361\u3002\u4e8c\u662f\u7ed9\u6bcf\u4e2a\u5b57\u7b26\u8d4b\u4e00\u4e2a\u968f\u673a\u7684\u6743\u503c\uff0c\u7136\u540e\u62ff\u8fd9\u4e2a\u968f\u673a\u7684\u6743\u503c\u53bb\u505a\u5377\u79ef\u3002\u4e09\u662f\u968f\u673a NTT \u6a21\u6570\uff0c\u4f46\u6211\u611f\u89c9\u4e0d\u5982\u7b2c\u4e00\u79cd\u65b9\u6cd5\u597d\u3002\n\n\u6211\u7684\u5b9e\u73b0\u4e2d\u91c7\u7528\u4e86\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff0c\u5e76\u4e14\u5c06\u4e0a\u9762\u7684\u5f0f\u5b50\u62c6\u5f00\u540e $a$ \u7684\u5e42\u6b21\u76f8\u540c\u7684\u9879\u653e\u5230\u4e00\u8d77\u5904\u7406\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define I inline int\n#define V inline void\n#define ll long long int\n#define FOR(i,a,b) for(int i=a;i<=b;i++)\n#define ROF(i,a,b) for(int i=a;i>=b;i--)\nconst int N=1<<19,mod=998244353;\nchar st[N];\nint n,m,a[N],b[N],c[N],val[N];\nint lmt,l,w[N],r[N],p[N],q[N],t[N];\nV input(){\n\tFOR(i,1,26)scanf(\"%d\",p+i);\n\tscanf(\"%s\",st+1),m=strlen(st+1);\n\tFOR(i,1,m)b[m-i]=st[i]-'a'+1;\n\tscanf(\"%s\",st+1),n=strlen(st+1);\n\tFOR(i,1,n)a[i]=st[i]-'a'+1;\n}\nI Pow(ll t,int x){\n\tll s=1;\n\tfor(;x;x>>=1,t=t*t%mod)if(x&1)s=s*t%mod;\n\treturn s;\n}\nI o(){\n\tstatic mt19937 seed(time(0));\n\treturn abs((int)seed());\n}\nV init(){\n\tfor(lmt=1,l=-1;lmt<=n+m+1;lmt<<=1)l++;\n\tFOR(i,1,lmt-1)r[i]=r[i>>1]>>1|(i&1)<<l;\n\tint wn=Pow(3,mod>>++l);w[lmt>>1]=1;\n\tFOR(i,lmt/2+1,lmt-1)w[i]=1ll*w[i-1]*wn%mod;\n\tROF(i,lmt/2-1,1)w[i]=w[i<<1];\n\tFOR(i,0,m-1)c[i]=p[b[i]];\n\tFOR(i,1,26)val[i]=o()%mod;\n\tFOR(i,1,n)a[i]=val[a[i]];\n\tFOR(i,0,m-1)b[i]=val[b[i]],c[i]=val[c[i]];\n}\nV DFT(int*a){\n\tstatic unsigned long long int tmp[N];\n\tFOR(i,0,lmt-1)tmp[i]=a[r[i]];\n\tfor(int i=1,x;i<lmt;i<<=1)for(int j=0,d=i<<1;j<lmt;j+=d)FOR(k,0,i-1)\n\t\tx=tmp[i|j|k]*w[i|k]%mod,tmp[i|j|k]=tmp[j|k]+mod-x,tmp[j|k]+=x;\n\tFOR(i,0,lmt-1)a[i]=tmp[i]%mod;\n}\nV IDFT(int*a){\n\treverse(a+1,a+lmt),DFT(a);\n\tint bk(mod-mod/l);\n\tFOR(i,0,lmt-1)a[i]=1ll*a[i]*bk%mod;\n}\nV check(int&x){x-=mod,x+=x>>31&mod;}\nV add(int*p,int*q,int*t){FOR(i,0,lmt-1)check(t[i]+=1ll*p[i]*q[i]%mod);}\nV work(){\n\tFOR(i,0,lmt-1)p[i]=Pow(a[i],4),q[i]=i<m;\n\tDFT(p),DFT(q),add(p,q,t);\n\tFOR(i,0,lmt-1)p[i]=mod-2ll*Pow(a[i],3)%mod,check(q[i]=b[i]+c[i]);\n\tDFT(p),DFT(q),add(p,q,t);\n\tFOR(i,0,lmt-1)p[i]=1ll*a[i]*a[i]%mod,q[i]=(2ll*b[i]*c[i]+Pow(b[i]+c[i],2))%mod;\n\tDFT(p),DFT(q),add(p,q,t);\n\tFOR(i,0,lmt-1)p[i]=mod-2ll*a[i]%mod,q[i]=1ll*b[i]*c[i]%mod*(b[i]+c[i])%mod;\n\tDFT(p),DFT(q),add(p,q,t);\n\tFOR(i,0,lmt-1)p[i]=1<=i&&i<=n,q[i]=1ll*Pow(b[i],2)*Pow(c[i],2)%mod;\n\tDFT(p),DFT(q),add(p,q,t),IDFT(t);\n\tFOR(i,m,n)cout<<!t[i];\n}\nint main(){\n//\tfreopen(\"test.in\",\"r\",stdin);\n\tinput();\n\tinit();\n\twork();\n\treturn 0;\n}\n```",
        "postTime": 1586665293,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1334G \u3010Substring Search\u3011"
    }
]