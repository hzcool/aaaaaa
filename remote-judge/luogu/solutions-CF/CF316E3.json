[
    {
        "content": "## CF316E \u9898\u89e3\n\n### \u9898\u76ee\u5927\u610f\n\n\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\u4ee5\u4e0b\u4e09\u79cd\u64cd\u4f5c\uff1a\n\n1. ```1 x v```\uff1a\u5c06 $a_x$ \u8d4b\u503c\u4e3a $v$\u3002\n2. ```2 l r```\uff1a\u6c42\u4ee5\u4e0b\u5f0f\u5b50\u7684\u503c\uff1a$\\sum\\limits^{r-l}_{x=0}{f_x\\cdot a_{l+x} \\text{ mod } 10^9 }$\n3. ```3 l r d```\uff1a \u4f7f\u533a\u95f4 $[l, r]$ \u5185\u6240\u6709\u5143\u7d20\u52a0\u4e0a $d$\u3002\n\n$f$ \u6570\u7ec4\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a\n\n $$f_i = \\begin{cases}\n 1, i=0/1\\\\\n f_{i-2}+f_{i-1}\n \\end{cases}$$\n\n### \u89e3\u9898\u601d\u8def\n\n\u53ef\u4ee5\u60f3\u5230\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5355\u70b9\u4fee\u6539\u548c\u533a\u95f4\u52a0\u6cd5\uff0c\u74f6\u9888\u5728\u4e8e\u533a\u95f4\u7684\u5408\u5e76\u3002\n\n\u6211\u4eec\u8bbe $ s_0 = f_0 \\cdot a_0 + f_1\\cdot a_1 +...+ f_n\\cdot a_n, s_1 = f_1\\cdot a_0 + f_2\\cdot a_1 +...+ f_{n+1}\\cdot a_n $\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u6982\u62ec\u5730\u8bb2\uff0c\u6211\u4eec\u8bbe\uff1a\n$$\ns_i = \\sum\\limits_{j=0}^{n}{f_{i+j}\\cdot a_j}\n$$\n\n#### \u5f15\u7406\u8bc1\u660e\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5e8f\u5217 $f$ \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\u5c06\u601d\u8def\u5f80\u8fd9\u4e0a\u9762\u9760\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5f53 $ i\\geq 2 $ \u65f6\uff0c$s$ \u6ee1\u8db3 $ s_i = s_{i-1} + s_{i-2} $\u3002\u4e0b\u9762\u7ed9\u51fa\u8fd9\u6761\u5f15\u7406\u7684\u8bc1\u660e\uff1a\n$$\ns_{i-2} + s_{i-1} =\\sum\\limits_{j=0}^n{f_{i+j-2}\\cdot a_j} + \\sum\\limits_{j=0}^n{f_{i+j-1}\\cdot a_j}\n$$\n\n$$\ns_{i-2} + s_{i-1} = \\sum\\limits_{j=0}^n{(f_{i+j-2}+f_{i+j-1})\\cdot a_j}\n$$\n\n$$\ns_{i-2} + s_{i-1} = \\sum\\limits_{j=0}^n{f_{i+j}\\cdot a_j}\n$$\n\n\u5373\u4e3a\uff1a$ s_{i-2} + s_{i-1} = s_i $\uff0c\u8bc1\u6bd5\u3002\n\n\u7136\u800c\u5728\u8fdb\u884c\u8be2\u95ee\u65f6\uff0c\u4e0a\u9762\u7684 $n$ \u662f\u4f1a\u4e0d\u65ad\u53d1\u751f\u6539\u53d8\u7684\u3002\u5f88\u663e\u7136\uff0c\u6211\u4eec\u4e0d\u80fd\u5c06\u6240\u6709\u7684\u60c5\u51b5\u5168\u642c\u8fdb\u7ebf\u6bb5\u6811\u91cc\u9762\u7ef4\u62a4\u3002\u6211\u4eec\u60f3\u5230\uff0c\u6590\u6ce2\u90a3\u5951\u6709\u52a0\u901f\u9012\u63a8\uff0c\u90a3\u8fd9\u4e2a $s$ \u662f\u5426\u4e5f\u80fd\u7531\u5b83\u7684\u524d\u51e0\u9879\u63a8\u51fa\u5462\uff1f~~~\uff08\u597d\u5427\u5176\u5b9e\u548c\u52a0\u901f\u9012\u63a8\u6ca1\u4ec0\u4e48\u5173\u7cfb\uff09~~~\n\n\u6211\u4eec\u731c\u60f3\uff0c\u5bf9\u4e8e $ \\forall i \\in [2, n] $\uff0c\u5176 $s_i$ \u90fd\u53ef\u4ee5\u7531 $s_0$ \u548c $s_1$ \u63a8\u51fa\u3002\u6211\u4eec\u8bbe $x = s_0, y = s_1$\uff0c\u9996\u5148\uff0c\u5f88\u663e\u7136\u5730\uff0c\u6211\u4eec\u5f97\u5230 $ s_2 = s_0 + s_1 = x + y = f_0\\cdot x + f_1\\cdot y $\u3002\n\n\u8003\u8651\u5bf9\u5176\u8fdb\u884c\u66f4\u8fdb\u4e00\u6b65\u7684\u63a8\u5e7f\u3002\n$$\n\\because f_0 = f_1\n$$\n\n$$\n\\therefore f_2 = f_0 + f_1 =2f_1\n$$\n\n$$\n\\therefore s_3 = s_1 + s_2 = f_1\\cdot y + (f_0\\cdot x + f_1\\cdot y) = f_1\\cdot x + f_2\\cdot y\n$$\n\n\u540c\u7406\u53ef\u5f97\uff1a\n$$\ns_4 = s_2 + s_3 = (f_0\\cdot x + f_1\\cdot y) + (f_1\\cdot x + f_2\\cdot y) = f_2\\cdot x + f_3\\cdot y\n$$\n\n$$\ns_5 = s_3 + s_4 = (f_1\\cdot x + f_2\\cdot y) + (f_2\\cdot x + f_3\\cdot y) = f_3\\cdot x + f_4\\cdot y\n$$\n\n$$\n\\cdots\n$$\n\n\u7531\u6570\u5b66\u5f52\u7eb3\u6cd5\uff0c\u6211\u4eec\u77e5\u9053\uff1a\u5bf9\u4e8e $\\forall i\\in [2, n]$\uff0c$s_i = f_{i-2}\\cdot s_0 + f_{i-1}\\cdot s_1$\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u5982\u4f55\u5c06\u8fd9\u4e2a\u7ed3\u8bba\u8fd0\u7528\u5230\u7ebf\u6bb5\u6811\u4e2d\u53bb\u7ef4\u62a4\u4fe1\u606f\u3002\n\n#### \u4e0e\u7ebf\u6bb5\u6811\u7684\u7ed3\u5408\n\n##### \u5efa\u6811\u64cd\u4f5c\n\n\u7531\u524d\u9762\u7684\u7ed3\u8bba\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u5176 $s_0$ \u548c $s_1$ \u7684\u503c\u3002\u5bf9\u4e8e\u53f6\u5b50\u8282\u70b9\uff0c\u6211\u4eec\u53d1\u73b0\u5b83\u7684\u533a\u95f4\u957f\u5ea6\u4e3a $1$\uff0c\u56e0\u6b64\uff0c$s0, s1$ \u7684\u521d\u503c\u90fd\u4e3a $a_p\\cdot f_0$\uff0c\u5373 $a_p$\uff0c$p$ \u4e3a\u53f6\u5b50\u8282\u70b9\u7f16\u53f7\u3002\u8fd9\u91cc\u9762\u5411\u4e0a\u4f20\u9012\u7684\u64cd\u4f5c\u540e\u9762\u4f1a\u8bb2\u3002\n\n```cpp\ninline void Build(int p,int l,int r)\n{\n\tsgt[p].ls=l,sgt[p].rs=r,sgt[p].len=r-l+1;\n\tif(l==r)\n\t{\n\t\tsgt[p].s1=sgt[p].s2=a[l];\n\t\treturn;\n\t}\n\tre mid=l+r>>1;\n\tBuild(p<<1,l,mid);\n\tBuild(p<<1|1,mid+1,r);\n\tpushup(p);\n}\n```\n\n##### \u8be2\u95ee\u7b54\u6848\n\n\u8fd9\u4e2a\u90e8\u5206\u6bd4\u8f83\u7b80\u5355\u3002\u6211\u4eec\u8bbe\u5f53\u524d\u8be2\u95ee\u7684\u533a\u95f4\u662f $[L, R]$\u3002\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u7ebf\u6bb5\u6811\u7684\u8be2\u95ee\u51fd\u6570\u662f\u9012\u5f52\u8fdb\u884c\u7684\uff0c\u56e0\u6b64\uff0c\u5f53\u8be2\u95ee\u5230\u5b50\u533a\u95f4 $[l, r]$ \u65f6\uff0c\u5e94\u8be5\u8fd4\u56de\u7684\u503c\u662f $ f_{l-L+1}\\cdot a_l + \\cdots + f_{r-L+1}\\cdot a_r $\u3002\u4e00\u4e2a\u503c\u5f97\u6ce8\u610f\u7684\u7ec6\u8282\u662f\uff0c\u5982\u679c\u5f53\u524d\u5b50\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u4e0e\u539f\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u91cd\u5408\u65f6\uff0c\u6211\u4eec\u79f0\u8fd9\u4e2a\u5b50\u533a\u95f4\u5e76\u672a\u504f\u79fb\u3002\u5bf9\u4e8e\u8fd9\u6837\u7684\u533a\u95f4\uff0c\u53ea\u9700\u8fd4\u56de\u4ee3\u8868\u5b50\u533a\u95f4\u7684\u8282\u70b9\u7684 $s_0$ \u503c\u5373\u53ef\u3002\n\n\u4ee3\u7801\u4e2d\uff0c$calc$ \u51fd\u6570\u6c42\u7684\u662f\u5f53\u524d\u8282\u70b9 $s_k$ \u7684\u503c\u3002\n\n```cpp\ninline ll query(int p,int l,int r)\n{\n\tif(sgt[p].ls>=l&&sgt[p].rs<=r)\n\t{\n\t\tre k=sgt[p].ls-l;\n\t\tif(!k) return sgt[p].s1;\n\t\telse return calc(p,k);\n\t}\n\tpushdown(p);\n\tre mid=sgt[p].ls+sgt[p].rs>>1;\n\tll ret=0;\n\tif(l<=mid) ret=(ret+query(p<<1,l,r))%mod;\n\tif(r>mid) ret=(ret+query(p<<1|1,l,r))%mod;\n\treturn ret;\n}\n```\n\n##### \u5355\u70b9\u4fee\u6539\n\n\u8ddf\u666e\u901a\u7684\u7ebf\u6bb5\u6811\u4e00\u6837\uff0c\u6b64\u5904\u4e0d\u518d\u8d58\u8ff0\u3002\u8bb0\u5f97\u4fee\u6539\u65f6\u8981\u5c06\u8fd9\u4e2a\u8282\u70b9\u4e0a\u7684\u61d2\u6807\u8bb0\u6e05\u9664\u3002\n\n```cpp\ninline void change(int p,int x,ll v)\n{\n\tif(sgt[p].ls==sgt[p].rs)\n\t{\n\t\tsgt[p].s1=sgt[p].s2=v;\n\t\tsgt[p].tag=0;\n\t\treturn;\n\t}\n\tpushdown(p);\n\tre mid=sgt[p].ls+sgt[p].rs>>1;\n\tif(x<=mid) change(p<<1,x,v);\n\telse change(p<<1|1,x,v);\n\tpushup(p);\n}\n```\n\n##### \u533a\u95f4\u52a0\u6cd5\n\n\u5047\u8bbe\u4ee4\u533a\u95f4 $ [l, r] $ \u5185\u7684\u6240\u6709\u5143\u7d20\u589e\u52a0 $d$\u3002\n\n\u624b\u73a9\u4e00\u4e0b\uff0c\u6211\u4eec\u5c06\u589e\u52a0\u540e\u7684 $s_0$ \u548c\u5148\u524d\u7684 $s_0$ \u505a\u5dee\uff0c\u5f97\u51fa\u589e\u52a0\u91cf :\n$$\n\\Delta_{s_0} = f_1\\cdot d + f_2\\cdot d + \\cdots + f_{r-l+1}\\cdot d = (f_1 + f_2 + \\cdots + f_{r-l+1})\\cdot d\n$$\n\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u9700\u8981\u5148\u9884\u5904\u7406\u51fa $f$ \u6570\u7ec4\u7684\u524d\u7f00\u548c\uff0c\u5373\u53ef\u7ef4\u62a4\u589e\u52a0\u503c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002$s_1$ \u7684\u589e\u52a0\u91cf\u4e0e $s_0$ \u7c7b\u4f3c\uff0c\u5728\u6b64\u4e0d\u505a\u8d58\u8ff0\u3002\n\n```cpp\ninline void add(int p,int l,int r,ll d)\n{\n\tif(sgt[p].ls>=l&&sgt[p].rs<=r)\n\t{\n\t\tsgt[p].tag=(sgt[p].tag+d)%mod;\n\t\tsgt[p].s1=(sgt[p].s1+sf[sgt[p].len-1]*d%mod)%mod;\n\t\tsgt[p].s2=(sgt[p].s2+(sf[sgt[p].len]-1ll)*d%mod)%mod;\n\t\treturn;\n\t}\n\tpushdown(p);\n\tre mid=sgt[p].ls+sgt[p].rs>>1;\n\tif(l<=mid) add(p<<1,l,r,d);\n\tif(r>mid) add(p<<1|1,l,r,d);\n\tpushup(p);\n}\n```\n\n##### \u4e0a\u4f20\u64cd\u4f5c\n\n\u4f9d\u7136\u5148\u8003\u8651\u5bf9\u4e8e $s_0$ \u7684\u7ef4\u62a4\u3002\n\n\u6211\u4eec\u5c06\u5176\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\u7684\u548c\uff0c\u5176\u4e00\u4e3a\u5de6\u513f\u5b50\u7684 $s_0$\uff1b\u5176\u4e8c\u4e3a**\u53f3\u513f\u5b50\u7684\u5de6\u513f\u5b50\u957f\u5ea6\u7684 $s_i$**\u3002\u4ee4\u5f53\u524d\u8282\u70b9\u4e3a $p$\uff0c\u5176\u7ef4\u62a4\u7684\u533a\u95f4\u4e3a $[l, r]$\uff0c\u5176\u5de6\u513f\u5b50\u4e3a $ls$\uff0c\u53f3\u513f\u5b50\u4e3a $rs$\u3002\u6211\u4eec\u4ee4 $A$ \u5f0f\u4e3a\u201c\u5176\u4e00\u201d\uff0c\u4ee4 $B$ \u5f0f\u4e3a\u201c\u5176\u4e8c\u201d\u3002\u4e3a\u4e86\u8868\u8ff0\u65b9\u4fbf\uff0c\u6211\u4eec\u4ee4 $mid = \\frac{l+r}{2}$\uff0c\u8868\u793a\u8282\u70b9 $p$ \u7684\u533a\u95f4\u4e2d\u70b9\uff08\u5373\u5de6\u53f3\u513f\u5b50\u7684\u5206\u754c\uff09\u3002\u8003\u8651\u5bf9\u4ee5\u4e0a\u8f6c\u79fb\u8fdb\u884c\u5982\u4e0b\u8bc1\u660e\uff1a\n\n$ A = s_0 [ p ] = f_1\\cdot a_l + f_2\\cdot a_{l+1} + \\cdots + f_{r-l+1}\\cdot a_r $\uff0c\n\n$ B = s_0[ls] + s_{mid-l+1}[rs]$\u3002\n\n$   \\ \\ \\ = (f_1\\cdot a_l + f_2\\cdot a_{l+1} + \\cdots + f_{mid-l+1}\\cdot a_{mid}) + (f_{(mid+1)-l+1)}\\cdot a_{mid+1} + \\cdots + f_{r-l+1}\\cdot a_r)  $\n\n$ \\ \\ \\ = f_1\\cdot a_l + f_2\\cdot a_{l+1} + \\cdots + f_{r-l+1}\\cdot a_r $\n\n\u53d1\u73b0 $ A = B $\uff0c\u5373 $ s_0[p] = s_0[ls] + s_{mid-l+1}[rs] $\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u4e0a\u4f20\u64cd\u4f5c\u6b63\u786e\u6027\u7684\u8bc1\u660e\u3002\n\n```cpp\ninline void pushup(int p)\n{\n\tsgt[p].s1=(sgt[p<<1].s1+calc(p<<1|1,sgt[p<<1].len))%mod;\n\tsgt[p].s2=(sgt[p<<1].s2+calc(p<<1|1,sgt[p<<1].len+1))%mod;\n}\n```\n\n##### \u4e0b\u4f20\u64cd\u4f5c\n\n\u666e\u666e\u901a\u901a\u7684\u4e00\u4e2a $\\text{pushdown}$\uff0c\u7c7b\u6bd4\u4e00\u4e0b\u533a\u95f4\u52a0\u6cd5\u7684\u64cd\u4f5c\u5373\u53ef\u3002\n\n```cpp\ninline void pushdown(int p)\n{\n\tif(!sgt[p].tag) return;\n\trl t=sgt[p].tag;\n\tsgt[p<<1].tag=(sgt[p<<1].tag+t)%mod;\n\tsgt[p<<1|1].tag=(sgt[p<<1|1].tag+t)%mod;\n\tsgt[p<<1].s1=(sgt[p<<1].s1+sf[sgt[p<<1].len-1]*t%mod)%mod;\n\tsgt[p<<1].s2=(sgt[p<<1].s2+(sf[sgt[p<<1].len]-1ll)*t%mod)%mod;\n\tsgt[p<<1|1].s1=(sgt[p<<1|1].s1+sf[sgt[p<<1|1].len-1]*t%mod)%mod;\n\tsgt[p<<1|1].s2=(sgt[p<<1|1].s2+(sf[sgt[p<<1|1].len]-1ll)*t%mod)%mod;\n\tsgt[p].tag=0;\n}\n```\n\n#### \u6ce8\u610f\u4e8b\u9879\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u6e05\u695a\u4e86\u5982\u4f55\u5c06\u7ebf\u6bb5\u6811\u4e0e\u5148\u524d\u7684\u5f15\u7406\u76f8\u7ed3\u5408\uff0c\u8fd0\u7528\u5230\u8fd9\u4e2a\u95ee\u9898\u4e2d\uff0c\u672c\u9898\u5df2\u7ecf\u53ef\u4ee5\u89e3\u51b3\u3002\n\n\u4f46\u6211\u4eec\u8fd8\u5e94\u8be5\u6ce8\u610f\u4e00\u4e0b\u51e0\u70b9\u7ec6\u8282\uff1a\n\n- \u6ce8\u610f\u6570\u7ec4 $f$ \u548c $sf$ \u7684\u8fb9\u754c\uff0c\u5b83\u4eec\u662f\u4e0d\u540c\u7684\u3002\n- \u524d\u9762\u5df2\u7ecf\u63d0\u5230\uff0c\u6211\u4eec\u7684\u5f15\u7406\u6210\u7acb\uff0c\u5f53\u4e14\u4ec5\u5f53 $i\\geq 2$\u3002\u56e0\u6b64\uff0c\u5728\u8ba1\u7b97 $s_i$ \u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5224\u65ad\u5176\u662f\u5426\u8d8a\u754c\u3002\n- $\\text{long long}$!\n\n#### \u5b8c\u6574\u4ee3\u7801\n\n\u4e3a\u4e86\u907f\u514d\u7bc7\u5e45\u8fc7\u957f\uff0c\u5b8c\u6574\u4ee3\u7801\u5c31\u4e0d\u5728\u8fd9\u91cc\u8d34\u51fa\u6765\u4e86\uff0c\u5982\u6709\u9700\u8981\u8bf7\u8d70[\u8fd9\u8fb9](https://www.luogu.com.cn/paste/e2qxmg9y)\u3002\n\n\u611f\u8c22\u9605\u8bfb\uff01",
        "postTime": 1610332611,
        "uid": 177531,
        "name": "ZolaWatle",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF316E3 \u3010Summer Homework\u3011"
    },
    {
        "content": "# CF316E3 Summer Homework \u9898\u89e3\n\n## Analysis\n\n\u770b\u5230\u4e86 Fibonacci\uff0c\u800c\u4e14\u53c8\u662f\u8981\u7ef4\u62a4\u5e8f\u5217\u64cd\u4f5c\uff0c\u4e0d\u96be\u60f3\u5230\u7528\u7ebf\u6bb5\u6811+\u77e9\u9635\u4e58\u6cd5\u7ef4\u62a4\u3002\n\n\u5148\u8003\u8651\u6ca1\u6709\u64cd\u4f5c $3$ \u7684\u60c5\u51b5\u3002\n\n\u6211\u4eec\u4ee4 $A = \\begin{bmatrix} 1&1\\\\1&0 \\end{bmatrix}$\uff0c\u90a3\u4e48\u8be2\u95ee\u5c31\u662f\u95ee\u6211\u4eec $\\sum_{i=0}^{r-l}a_{l+x}A^i$ \u6240\u5bf9\u5e94\u7684\u77e9\u9635\u3002\n\n\u6211\u4eec\u8ba9\u7ebf\u6bb5\u6811\u7684\u4e00\u4e2a\u8282\u70b9\u5b58\u8be5\u8282\u70b9\u5bf9\u5e94\u533a\u95f4\u7684\u5927\u5c0f `siz` \u548c\u7b54\u6848\u77e9\u9635 `w`\uff0c\u90a3\u4e48\u5f53\u524d\u8282\u70b9 $u$ \u7684\u7b54\u6848\u77e9\u9635\u5c31\u4e3a $w_u=w_{lson} + A^{siz_{lson}}w_{rson}$\u3002\n\u8fd9\u4e2a\u505a\u6cd5\u7684\u6210\u6b63\u786e\u6027\u663e\u7136\u3002\n\n\u7136\u540e\u5c31\u662f\u4e00\u4e2a\u9884\u5904\u7406\u5feb\u901f\u5e42\uff0c\u548c\u7ef4\u62a4\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u7684\u5e73\u51e1\u7ebf\u6bb5\u6811\u4e86\u3002\n\n\u7136\u540e\u8003\u8651\u5e26\u4e0a\u64cd\u4f5c $3$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u7ed9\u533a\u95f4 $[l,r]$ \u52a0\u4e0a $v$ \u5b9e\u9645\u4e0a\u5bf9\u7b54\u6848\u77e9\u9635 $w$ \u7684\u5f71\u54cd\u5c31\u662f $w=w+v\\sum_{i=0}^{siz-1}A^i$ \u3002\n\n\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u9884\u5904\u7406\u51fa $\\sum_{i=0}^xA^i$ \u5c31\u53ef\u4ee5\u5728\u7ebf\u6bb5\u6811\u4e0a\u6253\u6807\u8bb0\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n## code\n\n```cpp\nconst long long p = 1e9;\nstruct Matrix {\n    long long mat[2][2];\n    inline Matrix operator*(Matrix b) {\n        Matrix c;\n        c.mat[0][0] = (mat[0][0] * b.mat[0][0] + mat[0][1] * b.mat[1][0]) % p;\n        c.mat[0][1] = (mat[0][0] * b.mat[0][1] + mat[0][1] * b.mat[1][1]) % p;\n        c.mat[1][0] = (mat[1][0] * b.mat[0][0] + mat[1][1] * b.mat[1][0]) % p;\n        c.mat[1][1] = (mat[1][0] * b.mat[0][1] + mat[1][1] * b.mat[1][1]) % p;\n        return c;\n    }\n    inline Matrix operator+(Matrix b) {\n        Matrix c;\n        c.mat[0][0] = (mat[0][0] + b.mat[0][0]) % p;\n        c.mat[0][1] = (mat[0][1] + b.mat[0][1]) % p;\n        c.mat[1][0] = (mat[1][0] + b.mat[1][0]) % p;\n        c.mat[1][1] = (mat[1][1] + b.mat[1][1]) % p;\n        return c;\n    }\n    inline Matrix operator^(long long v) const {\n        Matrix c;\n        c.mat[0][0] = (mat[0][0] * v) % p;\n        c.mat[0][1] = (mat[0][1] * v) % p;\n        c.mat[1][0] = (mat[1][0] * v) % p;\n        c.mat[1][1] = (mat[1][1] * v) % p;\n        return c;\n    }\n    inline bool operator==(Matrix b) { return mat[0][0] == b.mat[0][0] && mat[1][0] == b.mat[1][0] && mat[0][1] == b.mat[0][1] && mat[1][1] == b.mat[1][1]; }\n};\nconst Matrix A = {1, 1, 1, 0}, I = {1, 0, 0, 1};\nconst int N = 2e5 + 10;\nMatrix mi[N], sum[N];\ninline Matrix qpw(int v) { return mi[v]; }\nstruct SegmentTree {\n    struct Node {\n        Matrix w;\n        int siz;\n    } w[N << 2];\n    long long lzy[N << 2];\n    inline void pushup(Node &u, Node ls, Node rs) {\n        u.siz = ls.siz + rs.siz;\n        u.w = ls.w + mi[ls.siz] * rs.w;\n    }\n    void build(int u, int L, int R) {\n        if (L == R) {\n            w[u].siz = 1;\n            long long v;\n            read(v), w[u].w = (I ^ v);\n            return;\n        }\n        int M = L + R >> 1;\n        build(u << 1, L, M), build(u << 1 | 1, M + 1, R);\n        pushup(w[u], w[u << 1], w[u << 1 | 1]);\n    }\n    inline void maketag(int u, long long v) { w[u].w = w[u].w + (sum[w[u].siz - 1] ^ v), lzy[u] += v; }\n    inline void pushdown(int u) {\n        if (lzy[u]) maketag(u << 1, lzy[u]), maketag(u << 1 | 1, lzy[u]), lzy[u] = 0;\n    }\n    void update(int u, int L, int R, int x, int v) {\n        if (L == R) return void(w[u].w = (I ^ v));\n        int M = L + R >> 1;\n        pushdown(u);\n        if (x <= M)\n            update(u << 1, L, M, x, v);\n        else\n            update(u << 1 | 1, M + 1, R, x, v);\n        pushup(w[u], w[u << 1], w[u << 1 | 1]);\n    }\n    void update(int u, int L, int R, int l, int r, int v) {\n        if (L >= l && R <= r) return maketag(u, v);\n        if (L > r || R < l) return;\n        int M = L + R >> 1;\n        pushdown(u);\n        update(u << 1, L, M, l, r, v), update(u << 1 | 1, M + 1, R, l, r, v);\n        pushup(w[u], w[u << 1], w[u << 1 | 1]);\n    }\n    Node query(int u, int L, int R, int l, int r) {\n        if (L >= l && R <= r) return w[u];\n        int M = L + R >> 1;\n        pushdown(u);\n        if (r <= M) return query(u << 1, L, M, l, r);\n        if (M < l) return query(u << 1 | 1, M + 1, R, l, r);\n        Node ans;\n        pushup(ans, query(u << 1, L, M, l, r), query(u << 1 | 1, M + 1, R, l, r));\n        return ans;\n    }\n} seg;\nint n, m;\nint main() {\n    read(n), read(m);\n    int op, l, r, v;\n    mi[0] = I, mi[1] = A;\n    for (int i = 2; i < N; i++) mi[i] = mi[i - 1] * A;\n    sum[0] = I;\n    for (int i = 1; i < N; i++) sum[i] = mi[i] + sum[i - 1];\n    seg.build(1, 1, n);\n    Matrix ans;\n    while (m--) {\n        read(op), read(l), read(r);\n        if (op == 1)\n            seg.update(1, 1, n, l, r);\n        else if (op == 2)\n            ans = seg.query(1, 1, n, l, r).w, write((ans.mat[0][1] + ans.mat[1][1]) % p), putc('\\n');\n        else\n            read(v), seg.update(1, 1, n, l, r, v);\n    }\n    return 0;\n}",
        "postTime": 1672648179,
        "uid": 615348,
        "name": "zhouershan",
        "ccfLevel": 7,
        "title": "CF316E3 Summer Homework \u9898\u89e3"
    },
    {
        "content": "### $\\text{Difficulty : 2300}$\n---\n### \u89e3\u9898\u601d\u8def\uff1a\n\n\u5165\u95e8\u6570\u636e\u7ed3\u6784\u9898\u3002\n\n\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4 $a=\\sum_{i=l}^r a_if_{i-l}$ \u548c $b=\\sum_{i=l}^r a_if_{i-l+1}$\uff0c\u5176\u4e2d $f_i$ \u8868\u793a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u7b2c $i$ \u9879\u3002\u5355\u70b9\u4fee\u6539\u548c\u533a\u95f4\u52a0\u90fd\u662f\u5e73\u51e1\u7684\uff0c\u8be2\u95ee\u5408\u5e76\u533a\u95f4\u65f6\u8981\u6c42 $\\sum_{i=l}^r a_i f_{i-l+x}$\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $a+b$ \u5c31\u662f $\\sum_{i=l}^r a_if_{i-l+2}$ \u4ee5\u6b64\u7c7b\u63a8\u5c31\u5f97\u5230\u4e86\u6240\u6709\u7684\u9879\u3002\n\n\u8fd9\u4e2a\u8fc7\u7a0b\u6709\u4e24\u79cd\u4f18\u5316\u601d\u8def\uff0c\u4e00\u79cd\u662f\u548c\u901a\u5e38\u7684\u6590\u6ce2\u90a3\u5951\u6c42\u6cd5\u4e00\u6837\uff0c\u7528\u5feb\u901f\u5e42\u7b97\u51fa\u4e00\u4e2a\u7528 $a$ \u548c $b$ \u8868\u793a\u7684\u5f0f\u5b50\uff0c\u53e6\u4e00\u79cd\u662f\u76f4\u63a5\u9884\u5904\u7406\u51fa\u7cfb\u6570\u3002\u524d\u8005\u7528\u4e8e\u503c\u57df\u8f83\u5927\u7684\u60c5\u51b5\uff0c\u540e\u8005\u7528\u4e8e\u503c\u57df\u8f83\u5c0f\u7684\u65f6\u5019\u3002\u672c\u9898 $10^5$ \u76f4\u63a5\u9884\u5904\u7406\u5c31\u597d\u4e86\u3002\n\n\u5177\u4f53\u5730 $f_{n}=f_{n-i}f_{i}+f_{n-i-1}f_{i-1}$\uff0c\u4e5f\u5c31\u662f $\\sum_{i=l}^ra_if_{i-l+x}=f_{x-1}\\sum_{i=l}^r a_if_{i-l+1}+f_{x-2}\\sum_{i=l}^r a_if_{i-l}$\u3002\n\n\u8bc1\u660e\u76f4\u63a5\u5f52\u7eb3\u6cd5\uff0c\u5148\u7528 $f_n=f_{n-1}f_1+f_{n-2}f_0$ \u5960\u57fa\uff0c\u5f52\u7eb3\u6b65\u9aa4\u62c6 $f_{n-i}f_i$ \u9879\u4e3a $f_if_{n-i-1}+f_if_{n-i-2}$\uff0c\u5408\u5e76\u5f97\u5230 $f_{i+1}f_{n-i-1}+f_if_{n-i-2}$ \u6070\u597d\u662f\u4e0b\u4e00\u9879 $i+1$ \u7684\u5f62\u5f0f\u3002\n\n---\n\u6570\u7ec4\u4e0d\u8981\u5f00\u5c0f\uff0c\u6ce8\u610f\u7528 $\\text{long long}$ \u5b58\u3002\n\n---\n### \u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\nusing namespace std;\n#define int long long\nconst int MAXN=800005,MOD=1000000000;\nint n,m,f[MAXN],x[MAXN],lazy[MAXN],a[MAXN],b[MAXN],sum[MAXN],X,y,z,t;\nint plus(int x,int a,int b){\n\tif(x==0)return a;\n\tif(x==1)return b;\n\treturn ((f[x-2]*a)%MOD+(f[x-1]*b)%MOD)%MOD;\n}\nvoid pushdown(int now,int l,int r){\n\tif(lazy[now]==0)return;\n\t\n\tint mid=l+r>>1;\n\tlazy[now*2]=(lazy[now*2]+lazy[now])%MOD;\n\tlazy[now*2+1]=(lazy[now*2+1]+lazy[now])%MOD;\n\t\n\ta[now*2]=(a[now*2]+sum[mid-l]*lazy[now])%MOD;\n\tb[now*2]=(b[now*2]+(sum[mid-l+1]-1)*lazy[now])%MOD;\n\t\n\ta[now*2+1]=(a[now*2+1]+sum[r-mid-1]*lazy[now])%MOD;\n\tb[now*2+1]=(b[now*2+1]+(sum[r-mid]-1)*lazy[now])%MOD;\n\tlazy[now]=0;\n}\nvoid pushup(int now,int l,int r){\n\tint mid=l+r>>1;\n\ta[now]=(a[now*2]+plus(mid-l+1,a[now*2+1],b[now*2+1]))%MOD;\n\tb[now]=(b[now*2]+plus(mid-l+2,a[now*2+1],b[now*2+1]))%MOD;\n}\nvoid build(int now,int l,int r){\n\tif(l==r){\n\t\ta[now]=f[0]*x[l];\n\t\tb[now]=f[1]*x[l];\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tbuild(now*2,l,mid);\n\tbuild(now*2+1,mid+1,r);\n\tpushup(now,l,r);\n}\nvoid work1(int now,int l,int r,int x,int num){//\u5355\u70b9\u4fee\u6539 \n\tif(l==r){\n\t\ta[now]=b[now]=num;\n\t\treturn;\n\t}\n\tpushdown(now,l,r);\n\tint mid=l+r>>1;\n\tif(x<=mid)work1(now*2,l,mid,x,num);\n\telse work1(now*2+1,mid+1,r,x,num);\n\tpushup(now,l,r);\n}\nvoid work3(int now,int l,int r,int L,int R,int num){//\u533a\u95f4\u52a0 \n\tif(L<=l&&r<=R){\n\t\tlazy[now]=(lazy[now]+num)%MOD;\n\t\ta[now]=(a[now]+sum[r-l]*num)%MOD;\n\t\tb[now]=(b[now]+(sum[r-l+1]-1)*num)%MOD;\n\t\treturn;\n\t}\n\tpushdown(now,l,r);\n\tint mid=l+r>>1;\n\tif(L<=mid)work3(now*2,l,mid,L,R,num);\n\tif(R>mid)work3(now*2+1,mid+1,r,L,R,num);\n\tpushup(now,l,r);\n}\nint query(int now,int l,int r,int L,int R){\n\tif(L<=l&&r<=R){\n\t\tif(l==L)return a[now];\n\t\tif(l==L+1)return b[now];\n\t\treturn plus(l-L,a[now],b[now]);\n\t}\n\tpushdown(now,l,r);\n\tint mid=l+r>>1;\n\tint ans=0;\n\tif(L<=mid)ans+=query(now*2,l,mid,L,R);\n\tif(R>mid)ans+=query(now*2+1,mid+1,r,L,R);\n\treturn ans%MOD;\n}\nsigned main(){\n\tf[0]=f[1]=1;\n\tfor(int i=1;i<=200000;i++)f[i]=(f[i-1]+f[i-2])%MOD;\n\tsum[0]=1;\n\tfor(int i=1;i<=200000;i++)sum[i]=(sum[i-1]+f[i])%MOD;\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&x[i]);\n\tbuild(1,1,n);\n\twhile(m--){\n\t\tscanf(\"%lld\",&t);\n\t\tif(t==1){\n\t\t\tscanf(\"%lld%lld\",&X,&y);\n\t\t\twork1(1,1,n,X,y);\n\t\t}\n\t\tif(t==2){\n\t\t\tscanf(\"%lld%lld\",&X,&y);\n\t\t\tprintf(\"%lld\\n\",query(1,1,n,X,y)%MOD);\n\t\t}\n\t\tif(t==3){\n\t\t\tscanf(\"%lld%lld%lld\",&X,&y,&z);\n\t\t\twork3(1,1,n,X,y,z);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1666788017,
        "uid": 223559,
        "name": "qxp101",
        "ccfLevel": 6,
        "title": "CF316E3 \u9898\u89e3"
    }
]