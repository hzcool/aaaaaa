[
    {
        "content": "\u770b\u8d77\u6765\u5c31\u50cf 2-sat\u3002\u4f46\u6bcf\u4e2a\u70b9\u7684\u53d6\u503c\u4e3a $1\\sim k$\uff0c\u4f3c\u4e4e\u662f k-sat\u3002\n\n\u6ce8\u610f\u5230 $k$ \u6bd4\u8f83\u5c0f\uff0c\u53ef\u4ee5\u60f3\u5230\u628a\u6bcf\u4e2a\u70b9 $p$ \u62c6\u6210 $k$ \u4e2a `bool` \u53d8\u91cf\uff0c\u5176\u4e2d\u7b2c $i$ \u4e2a `bool` \u53d8\u91cf $X_{p,i}$ \u8868\u793a $a_p$ \u662f\u5426 $\\le i$\u3002\n\n\u663e\u7136\u6b64\u65f6\u8981\u8fde\u63a5 $T_{p,i}\\to T_{p_,i+1}$\uff08\u6ee1\u8db3\u53d8\u91cf\u542b\u4e49\uff09\u548c $T_{p, i} \\to T_{p-1, i}$\uff08\u6ee1\u8db3\u5355\u8c03\u4e0d\u964d\uff09\u3002\u8fd8\u6709\u5b83\u4eec\u7684\u53cd\u8fb9\uff08$u\\to v$ \u7684\u53cd\u8fb9\u6307 $v' \\to u'$\uff09\u3002\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4e0d\u62c6\u6210 $X_{p,i}$ \u8868\u793a $a_p$ \u662f\u5426 $=i$\uff0c\u89c1[\u6b64](https://280800.blog.luogu.org/2-sat)\u3002\n\n> \u53d6\u503c\u578b\u95ee\u9898\u4e00\u822c\u72b6\u6001\u8bbe\u8ba1\u662f\u53d8\u91cf $x\\ge k$\u3002\u5f62\u5982 $x=k$ \u7684\u72b6\u6001\u8bbe\u8ba1\u4e0d\u597d\u505a\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u4e86 $x$ \u7684\u82e5\u5e72\u4e2a\u72b6\u6001\u4e2d\u5fc5\u987b\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u4e3a $\\text{True}$\uff0c\u7136\u800c\u5b9e\u9645\u5efa\u56fe\u4e2d\u65e0\u6cd5\u5efa\u51fa\u8fd9\u6837\u7684\u9650\u5236\u6761\u4ef6\uff0c\u4e5f\u53ef\u80fd\u662f\u6211\u592a\u83dc\u4e86\u6240\u4ee5\u5efa\u4e0d\u51fa\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u9898\u76ee\u4e2d\u7ed9\u51fa\u7684\u82e5\u5e72\u79cd\u9650\u5236\uff1a\n\n1. $a_i\\neq x$\uff1a$T_{i,x}\\to T_{i,x-1}$ \u53ca\u5176\u53cd\u8fb9\u3002\n2. $a_i+a_j\\le x$\uff1a$F_{i, p} \\to T_{j, x-p-1}$ \u53ca\u5176\u53cd\u8fb9\u3002$F_{j,p}$ \u540c\u7406\u3002\n3. $a_i+a_j\\ge x$\uff1a$T_{i,p}\\to F_{j, x-p-1}$ \u53ca\u5176\u53cd\u8fb9\u3002$T_{j,p}$ \u540c\u7406\u3002\n\n\u6700\u540e\u6ce8\u610f\u4e00\u4e0b\u4e0a\u9762\u7684\u4e0b\u6807\u663e\u7136\u4f1a\u8d8a\u754c\uff0c\u8d8a\u754c\u7684\u65f6\u5019\u7279\u5224\u4e00\u4e0b\u5373\u53ef\u3002\u5982 $a_i+a_j\\le k-2$\uff0c\u6697\u542b $a_i, a_j\\le k-3$\u3002\n\n\u7136\u540e\u4f60\u5c31\u505a\u5b8c\u4e86\u3002~~\uff08\u8fd8\u633a\u5957\u8def\u7684\uff0c\u9664\u4e86\u5efa\u56fe\u771f\u7684\u9ebb\u70e6~~\n\n\u4e11\u964b\u7684\u4ee3\u7801\uff1a\n\n```cpp\n// Problem: F. Too Many Constraints\n// From: Codeforces - Educational Codeforces Round 130 (Rated for Div. 2)\n// URL: https://codeforces.com/contest/1697/problem/F\n// Time: 2022-06-12 22:35\n// Author: lingfunny\n\n#include <bits/stdc++.h>\n#define LL long long\nusing namespace std;\nconst int mxn = 2e4+10, mxz = 20*mxn;\n\nint n, m, k, tot;\nvector <int> G[mxz];\n#define _(x) (x > tot ? x - tot : x + tot)\ninline void add(int u, int v) { G[u].emplace_back(v);\n// int u_ = u > tot ? u - tot : u, v_ = v > tot ? v - tot: v;\n// printf(\"(%d, %d) %c -> (%d, %d) %c\\n\", u_%n?u_%n:n, (u_%n?u_/n:(u_-1)/n)+1, u>tot?'F':'T',\n// v_%n?v_%n:n, (v_%n?v_/n:(v_-1)/n)+1, v>tot?'F':'T');\n}\ninline void dadd(int u, int v) { add(u, v), add(_(v), _(u)); }\nint low[mxz], dfn[mxz], dfc, in[mxz], stk[mxz], top, scc[mxz], cnt;\nvoid tarjan(int u) {\n\tlow[u] = dfn[u] = ++dfc, in[stk[++top] = u] = 1;\n\tfor(int v: G[u]) {\n\t\tif(!dfn[v]) tarjan(v), low[u] = min(low[u], low[v]);\n\t\telse if(in[v]) low[u] = min(low[u], dfn[v]);\n\t}\n\tif(dfn[u] == low[u] && ++cnt) do scc[stk[top]] = cnt, in[stk[top]] = 0; while(stk[top--] != u);\n}\n\ninline void solve() {\n\tscanf(\"%d%d%d\", &n, &m, &k);\n\ttot = n * k;\n\t// printf(\"n = %d, m = %d, k = %d\\n\", n, m, k);\n\tfor(int i = 1; i <= tot*2; ++i) dfn[i] = 0, vector <int> ().swap(G[i]);\n\tdfc = top = cnt = 0;\n\tfor(int p = 1; p <= n; ++p) for(int i = 1; i < k; ++i) dadd(p+(i-1)*n, p+i*n);\n\tfor(int p = 2; p <= n; ++p) for(int i = 1; i <= k; ++i) dadd(p+(i-1)*n, p-1+(i-1)*n);\n\tadd(2*tot, tot);\n\t// puts(\"END\");\n\tfor(int op, i, j, x; m--;) {\n\t\tscanf(\"%d\", &op);\n\t\tif(op == 1) {\n\t\t\tscanf(\"%d%d\", &i, &x);\n\t\t\tif(x == 1) add(i, _(i));\n\t\t\telse dadd(i+(x-1)*n, i+(x-2)*n);\n\t\t} else {\n\t\t\tscanf(\"%d%d%d\", &i, &j, &x);\n\t\t\tif(op == 2) {\n\t\t\t\tif(x-1 < k)\n\t\t\t\tadd(_(i+(x-2)*n), i+(x-2)*n),\n\t\t\t\tadd(_(j+(x-2)*n), j+(x-2)*n);\n\t\t\t\tfor(int p = 1; p <= k; ++p) {\n\t\t\t\t\tint oth = x - p - 1;\n\t\t\t\t\tif(oth >= 1 && oth <= k)\n\t\t\t\t\tdadd(_(i+(p-1)*n), j+(oth-1)*n),\n\t\t\t\t\tdadd(_(j+(p-1)*n), i+(oth-1)*n);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(x-k > 1)\n\t\t\t\tadd(i+(x-k-2)*n, _(i+(x-k-2)*n)),\n\t\t\t\tadd(j+(x-k-2)*n, _(j+(x-k-2)*n));\n\t\t\t\tfor(int p = 1; p <= k; ++p) {\n\t\t\t\t\tint oth = x - p - 1;\n\t\t\t\t\tif(oth >= 1 && oth <= k)\n\t\t\t\t\tdadd(i+(p-1)*n, _(j+(oth-1)*n)),\n\t\t\t\t\tdadd(j+(p-1)*n, _(i+(oth-1)*n));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i = 1; i <= 2*tot; ++i) if(!dfn[i]) tarjan(i);\n\tfor(int i = 1; i <= tot; ++i) if(scc[i] == scc[i+tot]) return puts(\"-1\"), void();\n\tfor(int i = 1; i <= n; ++i) {\n\t\tfor(int p = 0; p < k; ++p) if(scc[i+p*n] < scc[_(i+p*n)]) { printf(\"%d%c\", p+1, \" \\n\"[i==n]); break; }\n\t}\n}\n\nint main() {\n\tint tt;\n\tscanf(\"%d\", &tt);\n\twhile(tt--) solve();\n}\n```\n\n",
        "postTime": 1655462809,
        "uid": 280800,
        "name": "lingfunny",
        "ccfLevel": 7,
        "title": "CF1697F Too Many Constraints \u9898\u89e3"
    },
    {
        "content": "## CF1697F \u9898\u89e3\n\u4e00\u9053\u7b80\u5355\u7684 `2-SAT` \u9898\uff0c\u96be\u70b9\u5728\u4e8e\u60f3\u5230\u7528 `2-SAT` \u505a\u3002\n\n\u8003\u8651\u521b\u5efa $n\\times m$ \u4e2a $01$ \u53d8\u91cf\u6765\u8868\u793a\u5e8f\u5217 $a$\uff0c\n\u5176\u4e2d\u53d8\u91cf $X_{i,j}(1\\le i\\le n,1\\le j\\le k)=[a_i\\le j]$\u3002\n\u4e3a\u65b9\u4fbf\u53d9\u8ff0\uff0c\u6211\u4eec\u89c4\u5b9a $[X_{i,j}=p]\\rightarrow[X_{i',j'}=q]$ \u4ee3\u8868\uff0c\u82e5\u6ee1\u8db3 $X_{i,j}=p$\uff0c\u5219 $X_{i',j'}$ \u5fc5\u987b\u7b49\u4e8e $q$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709\u9650\u5236\u8868\u793a\u6210\u8fd9\u4e9b\u53d8\u91cf\u95f4\u7684\u5173\u7cfb\uff0c\u5982\uff1a\n\n1. $a_i \\ne j$ \u7b49\u4ef7\u4e8e\u6ee1\u8db3 $[X_{i,j+1}=1]\\rightarrow [X_{i,j}=1]$ \u4e0e $[X_{i,j-1}=0]\\rightarrow [X_{i,j}=0]$\uff1b\n\n2. $a_i+a_j\\ge x$ \u7b49\u4ef7\u4e8e\u5bf9 $\\forall s+t<x$ \u6ee1\u8db3 $[X_{i,s}=1]\\rightarrow [X_{j,t}=0]$ \u548c $[X_{j,s}=1]\\rightarrow [X_{i,t}=0]$\uff1b\n\n3. $a_i+a_j\\le x$ \u7b49\u4ef7\u4e8e\u5bf9 $\\forall s+t\\ge x-1$ \u6ee1\u8db3 $[X_{i,s}=0]\\rightarrow [X_{j,t}=0]$ \u548c $[X_{j,s}=0]\\rightarrow [X_{i,t}=0]$\uff1b\n\n4. $a$ \u5e8f\u5217\u9012\u589e\u7b49\u4ef7\u4e8e\u5bf9 $\\forall i\\in[1,n-1],s\\in[1,k]$ \u6ee1\u8db3 $[X_{i,s}=0]\\rightarrow [X_{i+1,s}=0]$ \u548c $[X_{i+1,s}=1]\\rightarrow [X_{i,s}=1]$\uff1b\n\n5. \u5bf9 $\\forall i\\in[1,n]$\uff0c$a_i$ \u6709\u503c\u4e14\u503c\u552f\u4e00\u7b49\u4ef7\u4e8e $[X_{i,k}=0]\\rightarrow [X_{i,k}=1]$ \u548c $\\forall s,t\\in[1,k],s\\ne t$\uff0c\u6ee1\u8db3 $[X_{i,s}=1]\\rightarrow [X_{i,t}=0]$\u3002\n\n\u7136\u540e\u5efa\u51fa\u56fe\u540e\u8dd1\u4e2a\u7f29\u70b9\u5c31\u505a\u5b8c\u4e86\u3002",
        "postTime": 1655713887,
        "uid": 100091,
        "name": "GaryH",
        "ccfLevel": 6,
        "title": "CF1697F \u9898\u89e3"
    },
    {
        "content": "\u7b2c\u4e00\u773c\u662f\u62c6\u70b9\u5dee\u5206\u7ea6\u675f\uff0c\u4f46\u662f\u561b\uff0c\u5b83\u8fd9\u4e2a $a_i\\not= x$ \u5c31\u57fa\u672c\u4e0a\u4e3a\u5dee\u5206\u7ea6\u675f\u5ba3\u544a\u4e86\u6b7b\u5211\u3002\n\n2-SAT\u3002\u628a\u6bcf\u4e2a\u70b9\u62c6\u6210 $k$ \u4e2a\u5e03\u5c14\u53d8\u91cf\uff0c\u7b2c $j$ \u4e2a\u5e03\u5c14\u53d8\u91cf\u8868\u793a $a_i$ \u662f\u5426 $\\ge j$\u3002\u8bb0 $(i,j,o)$ \u8868\u793a\u7b2c $i$ \u4e2a\u70b9\u7684\u7b2c $j$ \u4e2a\u5e03\u5c14\u53d8\u91cf\u53d6\u503c\u4e3a $o$ \u4ee3\u8868\u7b2c\u7684\u70b9\u3002\u521d\u59cb\u65f6\uff0c$(i,j,0)\\to (i,j+1,0),(i,j+1,1)\\to(i,j,1)$\uff0c$(i,1,0)\\to(i,1,1)$\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\u8fb9\u754c\uff0c\u518d\u52a0\u4e00\u4e2a\u5e03\u5c14\u53d8\u91cf $(i,k+1,1)\\to(i,k+1,0)$\u3002\n\n\u5bf9\u4e8e $a_i\\le a_{i+1}$\uff0c\u679a\u4e3e $w\\in[1,k]$\uff0c\u8fde $(i,w,1)\\to(i+1,w,1),(i+1,w,0)\\to(i,w,0)$\u3002\n\n\u5bf9\u4e8e $a_i\\not= x$\uff0c\u8fde $(i,x,1)\\to (i,x+1,1),(i,x+1,0)\\to(i,x,0)$\u3002\n\n\u5bf9\u4e8e $a_i+a_j\\le x$\uff0c\u679a\u4e3e $w\\in[1,k]$\uff0c\u8fde $(i,w,1)\\to(j,x-w+1,0),(j,x-w+1,1)\\to(i,w,0)$\u3002\n\n\u5bf9\u4e8e $a_i+a_j\\ge x$\uff0c\u679a\u4e3e $w\\in[1,k]$\uff0c\u8fde $(i,w+1,0)\\to(j,x-w,1),(j,x-w,0)\\to(i,w+1,1)$\u3002\n\n\u53d1\u73b0\u9664\u4e86\u5904\u7406\u8fb9\u754c\u65f6\u7528\u5230\u7684\u5355\u70b9\u8d4b\u503c\u578b\u8bed\u53e5\uff0c\u6240\u6709\u8fb9\u90fd\u5f62\u5982 $(X,p)\\to(Y,q),(Y,!q)\\to (X,!p)$\uff0c\u90a3\u4e48\u8fd9\u662f\u4e00\u4e2a\u6807\u51c6\u7684 2-SAT \u5f62\u5f0f\u3002\u76f4\u63a5\u4e0a\u677f\u5b50\u5c31\u884c\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nnamespace vectorwyx{\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define pb push_back\n#define eb emplace_back\n#define mk make_pair\n#define sml(x,y) (x=min(x,y))\n#define big(x,y) (x=max(x,y))\n#define ll long long\n#define uint unsigned\n#define ull unsigned long long\n#define umap unordered_map\n#define db double\n#define fo(i,x,y) for(int i=(x);i<=(y);++i)\n#define go(i,x,y) for(int i=(x);i>=(y);--i)\n#define ptc putchar\n#define gtc getchar\n#define emp emplace\n#define re return\n#define co continue\n#define brk break\n#define HH (ptc('\\n'))\n#define bctz __builtin_ctz\n#define bclz __builtin_clz\n#define bppc __builtin_popcount\n//#define int ll \nusing namespace std;\nll seed=chrono::system_clock::now().time_since_epoch().count();\nmt19937 rnd(seed);\ninline int rm(int x,int y){return (int)(rnd()%(y-x+1ll)+x);}\ninline int read(){signed ch=getchar();int x=0,f=1;while(!isdigit(ch)){if(ch==(int)('-'))f=-1;ch=getchar();}while(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}return x*f;}\ninline void out(int *a,int l,int r){fo(i,l,r) cout<<*(a+i)<<' ';puts(\"\");}\n\nconst int N=2e6+5;\nint a[N],n,k,nk,nn,b[N];\nnamespace Graph{\nvector<int> e[N>>1];\nint dfn[N],ti,low[N],stk[N],top,ins[N],bel[N],num;\n\nvoid connect(int x,int y){e[x].eb(y);}//printf(\"%d -> %d\\n\",x,y);}\n\nvoid add(int x,int y){\n\tint p=x>nk?-1:1,q=y>nk?-1:1;\n//\tprintf(\"add(%d,p=%d,%d,q=%d)\\n\",x,p,y,q);\n\tconnect(x,y);\n\tif(abs(x-y)==nk) re;\n\tconnect(y+q*nk,x+p*nk);\n}\nvoid clear(){\n\tti=top=0;\n\tfo(i,1,nn) b[i]=dfn[i]=low[i]=stk[i]=ins[i]=bel[i]=0,e[i].clear();\n}\nvoid dfs(int x){\n//\tprintf(\"dfs(%d)\\n\",x);\n\tdfn[x]=low[x]=++ti;\n\tstk[++top]=x;ins[x]=1;\n\tfor(int i:e[x]){\n\t\tif(!dfn[i]) dfs(i),sml(low[x],low[i]);\n\t\telse if(ins[i]) sml(low[x],dfn[i]);\n\t}\n\tif(low[x]==dfn[x]){\n\t\t++num;\n//\t\tcout<<num<<\":\";\n\t\twhile(1){\n\t\t\tint p=stk[top--];\n//\t\t\tcout<<p<<' ';\n\t\t\tbel[p]=num;ins[p]=0;\n\t\t\tif(p==x) brk;\n\t\t}\n//\t\tHH;\n\t}\n}\nbool tarjan(){\n\tfo(i,1,nn) if(!dfn[i]) dfs(i);\n\tfo(i,1,nk) if(bel[i]==bel[i+nk]) re 0;\n\tfo(i,1,nk) b[i]=bel[i+nk]<bel[i];\n\tre 1;\n}\n}\nusing Graph::tarjan;\nusing Graph::add;\nusing Graph::clear;\nint F(int i,int j,int o=0){\n\tbig(j,1);sml(j,k+1);\n\tre (i-1)*(k+1)+j+o*nk;\n}\n\nvoid solve(){\n\tint q;\n\tcin>>n>>q>>k;nk=n*(k+1);nn=2*nk;\n//\tprintf(\"nk=%d\\n\",nk);\n\tclear();\n\tfo(i,1,n){\n\t\tfo(j,1,k) add(F(i,j,0),F(i,j+1,0));\n//\t\tgo(j,k+1,2) add(F(i,j,1),F(i,j-1,1));\n\t\tadd(F(i,1,0),F(i,1,1));\n\t\tadd(F(i,k+1,1),F(i,k+1,0));\n\t}\n\tfo(i,1,n-1) fo(w,1,k) add(F(i,w,1),F(i+1,w,1));\n\twhile(q--){\n\t\tint o=read(),i=read();\n\t\tif(o==1){\n\t\t\tint x=read();\n\t\t\tadd(F(i,x,1),F(i,x+1,1));\n\t\t\tco;\n\t\t}\n\t\tint j=read(),x=read();\n\t\tif(o==2) fo(w,1,k) add(F(i,w,1),F(j,x-w+1,0));\n\t\telse fo(w,1,k) add(F(i,w+1,0),F(j,x-w,1)); \n\t}\n\tif(!tarjan()){puts(\"-1\");re;}\n\tfo(i,1,n){\n\t\ta[i]=k;\n\t\tfo(j,1,k) if(!b[F(i,j)]){a[i]=j-1;brk;}\n\t}\n\tout(a,1,n);\n}\n\nsigned main(){\n\tint T=read();\n\twhile(T--) solve();\n\treturn 0;\n}\n}\n/*\n-------------------------------------------------\n*/\n\n\n\n\n\n\n\n\n\n\nsigned main(){re vectorwyx::main();}\n```",
        "postTime": 1675000451,
        "uid": 238408,
        "name": "vectorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1697F Too Many Constraints"
    },
    {
        "content": "2-sat \u597d\u9898\u3002\n\n\u9996\u5148\u6211\u4eec\u6bcf\u4e00\u4e2a bool \u53d8\u91cf\u8868\u793a\u300c$a_i$ \u662f\u5426 $\\ge j$\u300d\uff0c\u7531\u4e8e\u5fc5\u7136 $a_i\\ge 1$\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u53d8\u91cf\u6570\u4e3a $n(k-1)$\u3002\n\n\u7136\u540e\u6211\u4eec\u6839\u636e\u9898\u76ee\u6761\u4ef6\u6765\u5efa\u6709\u5411\u8fb9\uff0c\u6ce8\u610f 2-sat \u8981\u6ee1\u8db3**\u5bf9\u79f0\u6027**\uff0c\u6240\u4ee5\u4e0b\u6587\u4e2d\u6bcf\u4e00\u4e2a\u6761\u4ef6\u7684**\u9006\u5426\u547d\u9898\u90fd\u8981\u5efa\u8fb9**\uff1a\n\n* $a_i\\le a_{i+1}$\uff0c\u7b49\u4ef7\u4e8e\u300c\u5bf9\u4e8e\u6240\u6709\u7684 $v$\uff0c\u82e5 $a_i\\ge v$\uff0c\u5219 $a_{i+1}\\ge v$\u300d\u3002\n\n* $a_i\\ne x$\uff0c\u7b49\u4ef7\u4e8e\u300c\u82e5 $a_i\\ge x$\uff0c\u5219 $a_i\\ge x+1$\u300d\u3002\n\n* $a_i+a_j\\le x$\uff0c\u7b49\u4ef7\u4e8e\u300c\u5bf9\u4e8e\u6240\u6709\u7684 $v$\uff0c\u82e5 $a_i\\ge v$\uff0c\u5219 $\\neg(a_j\\ge x-v+1)$\u300d\u3002\n\n* $a_i+a_j\\ge x$\uff0c\u7b49\u4ef7\u4e8e\u300c\u5bf9\u4e8e\u6240\u6709\u7684 $v$\uff0c\u82e5 $\\neg(a_i\\ge v)$\uff0c\u5219 $a_j\\ge x-v+1$\u300d\u3002\n\n\u5f53\u7136\u8fd8\u6709\u4e00\u4e2a\u6700\u6d45\u663e\u7684\u522b\u5fd8\u4e86\uff1a\n\n* \u82e5 $a_i\\ge v$\uff0c\u5219 $a_i\\ge v-1$\u3002\n\n\u8dd1 Tarjan \u7f29\u70b9\u5373\u53ef\u3002\n\n```cpp\n//We'll be counting stars.\n#pragma GCC optimize(\"Ofast\")\n#include<bits/stdc++.h>\nusing namespace std;\n#define pb emplace_back\n#define For(i,j,k) for(int i=(j),i##_=(k);i<=i##_;i++)\n#define ckmn(a,b) a=min(a,b)\n#define N 360000\nvector<int> e[N];\nint n,m,k,dfn[N],low[N],col[N],tim,ct,s[N],st;\ninline void adde(int x,int y){e[x].pb(y);if(x!=(y^1))e[y^1].pb(x^1);} \ninline int num(int id,int x,bool y){return ((id-1)*(k-1)+(x-2))<<1|y;}//\u7b2c id \u4e2a\u6570 >= x \u7684 y \u72b6\u6001\u7684\u4e0b\u6807 \nvoid build(int x){For(i,2,k-1)adde(num(x,i,0),num(x,i+1,0));}\nvoid le(int x,int y){For(i,2,k) adde(num(x,i,1),num(y,i,1));}\nvoid ne(int x,int val){\n\tif(val==1) adde(num(x,val+1,0),num(x,val+1,1));\n\telse if(val==k) adde(num(x,val,1),num(x,val,0));\n\telse adde(num(x,val,1),num(x,val+1,1));\n}\nvoid sumle(int x,int y,int val){\n\tFor(i,2,k)\n\t\tif(i+1>val) adde(num(x,i,1),num(x,i,0)),adde(num(y,i,1),num(y,i,0));\n\t\telse if(val-i+1<=k) adde(num(x,i,1),num(y,val-i+1,0));\n}\nvoid sumge(int x,int y,int val){\n\tFor(i,2,k)\n\t\tif(i+k<=val) adde(num(x,i,0),num(x,i,1)),adde(num(y,i,0),num(y,i,1));\n\t\telse if(val-i+1>=2) adde(num(x,i,0),num(y,val-i+1,1));\n}\nvoid dfs(int x){\n\tdfn[x]=low[x]=++tim;\n\ts[++st]=x;\n\tfor(int i:e[x]){\n\t\tif(!dfn[i]) dfs(i),ckmn(low[x],low[i]);\n\t\telse if(!col[i]) ckmn(low[x],dfn[i]);\n\t}\n\tif(low[x]==dfn[x]){\n\t\tcol[x]=++ct;\n\t\twhile(s[st]!=x) col[s[st--]]=ct;\n\t\tst--;\n\t}\n}\nvoid work(){\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tint lim=(k-1)*2*n;\n\tFor(i,0,lim-1) e[i].clear();\n\tFor(i,1,n) build(i);\n\tFor(i,1,n-1) le(i,i+1);\n\tint x,y,val,opt;\n\tFor(i,1,m){\n\t\tscanf(\"%d\",&opt);\n\t\tif(opt==1){\n\t\t\tscanf(\"%d%d\",&x,&val);\n\t\t\tne(x,val);\n\t\t}else if(opt==2){\n\t\t\tscanf(\"%d%d%d\",&x,&y,&val);\n\t\t\tsumle(x,y,val);\n\t\t}else{\n\t\t\tscanf(\"%d%d%d\",&x,&y,&val);\n\t\t\tsumge(x,y,val);\n\t\t}\n\t}\n\tfill(dfn,dfn+lim,0);\n\tfill(col,col+lim,0);\n\ttim=ct=st=0;\n\tFor(i,0,lim-1) if(!dfn[i]) dfs(i);\n\tfor(int i=0;i<lim;i+=2) if(col[i]==col[i^1]){\n\t\tputs(\"-1\");\n\t\treturn ;\n\t}\n\tFor(i,1,n){\n\t\tval=1;\n\t\tFor(j,2,k) if(col[num(i,j,1)]<col[num(i,j,0)]) val=j;\n\t\tprintf(\"%d \",val);\n\t}\n\tputs(\"\");\n}\nint main(){\n\tint T;scanf(\"%d\",&T);\n\twhile(T--)work();\nreturn 0;}\n```",
        "postTime": 1656904738,
        "uid": 101868,
        "name": "I_am_Accepted",
        "ccfLevel": 0,
        "title": "CF1697F Too Many Constraints\uff082-sat \u53d8\u5f62\uff09"
    },
    {
        "content": "\u5efa\u56fe\u66f9\u4e39\u7684 2-SAT \u95ee\u9898\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230 $k$ \u7684\u503c\u662f\u5f88\u5c0f\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u6bcf\u4e00\u4e2a\u70b9\u62c6\u6210 $2\\times k$ \u4e2a\u70b9\uff0c$a_{i}$ \u8868\u793a $a\\le x$\uff0c$a_{i+k}$ \u8868\u793a $a> x$\u3002\n\n\u663e\u7136\u6211\u4eec\u6839\u636e\u6570\u7684\u57fa\u672c\u5173\u7cfb\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\n  \\left\\{\\begin{matrix} \n  a_{i}\\le x \\Rightarrow a_{i}\\le x+1 \\\\  \n  a_{i}> x \\Rightarrow a_{i}> x-1 \n\\end{matrix}\\right. \n$$\n\n\u4e5f\u5c31\u662f\u8fde\u63a5 $a_{i}\\to a_{i+1}$ \u548c $a_{i+k}\\to a_{i+k-1}$\u3002\n\n\u7531\u4e8e\u8981\u6ee1\u8db3\u5355\u8c03\u6027\uff0c\u6211\u4eec\u53c8\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\n  \\left\\{\\begin{matrix} \n  a_{i}\\le x \\Rightarrow a_{i-1}\\le x  \\\\  \n  a_{i}> x \\Rightarrow a_{i+1}> x \n\\end{matrix}\\right. \n$$\n\n\u4e5f\u5c31\u662f\u8981\u8fde\u63a5 $a_{i}\\to a_{i-1}$ \u548c $a_{i+k}\\to a_{i+k+1}$\u3002\n\n\u4f46\u662f\u6211\u4eec\u8981\u8003\u8651\u9650\u5236\u4e00\u4e0b\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u503c\u662f\u4e0d\u5927\u4e8e $k$ \u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u53ea\u5f00\u4e86 $2\\times k$ \u4e2a\u70b9\uff0c\u5982\u679c\u8981\u662f\u51fa\u73b0\u5927\u4e8e $k$ \u7684\u5143\u7d20\u5c31\u76f4\u63a5 G \u4e86\uff0c\u6240\u4ee5\u4eec\u76f4\u63a5\u6765\u8fde\u4e00\u6761 $2\\times tot\\to tot$ \u8fde\u4e00\u6761\u8fb9\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5b8c\u7f8e\u7684\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\n\n\u5bf9\u4e8e\u9898\u76ee\u7684\u4e09\u4e2a\u9650\u5236\uff0c\u6211\u4eec\u5206\u522b\u8fd9\u6837\u8fde\uff1a\n\n1. \u5bf9\u4e8e\u7b2c\u4e00\u4e2a\uff0c$a_{i} \\le x$ \u8981\u8fde\u5411 $a_{i} \\le x-1$ \u6765\u8ba9 $a_{i}\\ne x$\uff0c\u4ee5\u53ca $a_{i} > x-1$ \u8fde\u5411 $a_{i} > x$\u3002\n\n2. \u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\uff0c$a_{i} > y$ \u8981\u8fde\u5411 $a_{j} \\le x-y-1$\uff0c\u4ee5\u53ca $a_{j} > y$ \u8981\u8fde\u5411 $a_{i}\\le x-y-1$\uff0c\u5f53\u7136\u6211\u4eec\u8fd9\u91cc\u7684 $y$ \u5176\u5b9e\u662f\u4ece $1$ \u679a\u4e3e\u5230 $k$ \u7684\u503c\uff0c\u5f53\u7136\u6211\u4eec\u8981\u6ce8\u610f\u7684\u662f\u5982\u679c $x\\le k$ \u7684\u8bdd\u6211\u4eec\u5c31\u4f1a\u51fa\u73b0\u548c\u4e0a\u9762\u4e00\u6837\u9700\u8981\u9650\u5236\u8fb9\u754c\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7279\u5224 $x\\le k$ \u7684\u60c5\u51b5\uff0c\u5e76\u548c\u4e0a\u9762\u4e00\u6837\u52a0\u4e0a\u8fd9\u4e24\u4e2a\u6570\u7684\u503c\u4e0d\u80fd\u5927\u4e8e\u7b49\u4e8e $x$ \u7684\u9650\u5236\u3002\n\n3. \u5bf9\u4e8e\u7b2c\u4e09\u4e2a\uff0c$a_{i}\\le y$ \u8981\u8fde\u5411 $a_{j}> x-y-1$\uff0c\u4ee5\u53ca $a_{j}\\le y$ \u8981\u8fde\u5411 $a_{i}> y$\uff0c\u5f53\u7136\u8fd9\u4e2a\u4e5f\u4f1a\u51fa\u73b0\u548c\u4e0a\u9762\u4e00\u6837\u7684\u8fb9\u754c\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u91cc\u4e0d\u540c\u7684\u662f\u8981\u5904\u7406\u7684\u662f\u5927\u4e8e\u7b49\u4e8e $k+2$ \u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65f6\u5019\u4e24\u4e2a\u5404\u4e00\u4e2a $1$ \u7684\u8bdd\u8fd8\u662f\u591a\u51fa\u6765\u4e2a $k$\uff0c\u6240\u4ee5\u6700\u540e\u80af\u5b9a\u6709\u4e00\u4e2a\u6570\u4f1a\u5927\u4e8e $k$\uff0c\u6b64\u65f6\u6211\u4eec\u5c31\u8981\u52a0\u9650\u5236\u4e86\uff0c\u8fd8\u662f\u4fdd\u8bc1\u5728 $k$ \u7684\u8303\u56f4\u5185\uff0c~~\u4f46\u6211\u540e\u9762\u53d1\u73b0\u4e0d\u52a0\u4e5f\u53ef\u4ee5\u5e94\u8be5\u662f\u56e0\u4e3a\u4e4b\u524d\u6709 $\\le k$ \u7684\u9650\u5236\u7684\u539f\u56e0\u3002~~\n\ncode:\n\n```cpp\n\n#include<bits/stdc++.h>\n#define ARK(X) (X>tot?X-tot:X+tot)\n#define INF 0x3f3f3f3f\n#define N 1000100\n#define M 20010\n#define endl '\\n'\nusing namespace std;\nint t,n,m,k,tot,low[N],dfn[N],tim,vis[N],stk[N],top,sd[N],cnt;\nvector<int>G[N];\ninline int read(){int x=0,f=1;char ch=getchar();while(!isdigit(ch)){f=ch!='-';ch=getchar();}while(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}return f?x:-x;}\ninline void add(int u,int v){G[u].push_back(v),G[ARK(v)].push_back(ARK(u));}\ninline void tarjan(int u) \n{\n\tlow[u]=dfn[u]=++tim,vis[stk[++top]=u]=1;\n\tfor(int v:G[u]) \n\t{\n\t\tif(!dfn[v])tarjan(v),low[u]=min(low[u],low[v]);\n\t\telse if(vis[v])low[u]=min(low[u],dfn[v]);\n\t}\n\tif(dfn[u]==low[u]&&++cnt)while(1){sd[stk[top]]=cnt,vis[stk[top]]=0;if(stk[top--]==u)break;}\n}\ninline void work()\n{\n\tn=read(),m=read(),k=read();\n\ttot=n*k;\n\tfor(int i=1;i<=tot*2;i++)vector<int>().swap(G[i]),dfn[i]=low[i]=0;\n\ttim=top=cnt=0;\n//\tcout<<\"cao>\"<<endl;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<k;j++)\n\t\t\tadd(i+(j-1)*n,i+j*n);\n//\tcout<<\"cao>\"<<endl;\n\tfor(int i=2;i<=n;i++)\n\t\tfor(int j=1;j<=k;j++)\n\t\t\tadd(i+(j-1)*n,i+(j-1)*n-1);\n\tadd(2*tot,tot);\n//\tcout<<\"cao>\"<<endl;\n\tfor(int o=1;o<=m;o++)\n\t{\n//\t\tcout<<\"cao>\"<<endl;\n\t\tint op=read();\n\t\tif(op==1)\n\t\t{\n\t\t\tint x=read(),z=read();\n\t\t\tif(z==1)G[x].push_back(ARK(x));\n\t\t\telse add(x+(z-1)*n,x+(z-2)*n);\n\t\t}\n\t\telse if(op==2)\n\t\t{\n\t\t\tint x=read(),y=read(),z=read();\n\t\t\tif(z<=k)G[ARK(x+(z-2)*n)].push_back(x+(z-2)*n),G[ARK(y+(z-2)*n)].push_back(y+(z-2)*n);\n\t\t\tfor(int i=1;i<=k;i++)\n\t\t\t{\n\t\t\t\tint cao=z-i-1;\n\t\t\t\tif(cao>=1&&cao<=k)add(ARK(x+(i-1)*n),y+(cao-1)*n),add(ARK(y+(i-1)*n),x+(cao-1)*n);\n\t\t\t}\n\t\t}\n\t\telse if(op==3)\n\t\t{\n\t\t\tint x=read(),y=read(),z=read();\n//\t\t\tif(z-1>k)G[x+(z-k-2)*n].push_back(ARK(x+(z-k-2)*n)),G[y+(z-k-2)*n].push_back(ARK(y+(z-k-2)*n));\n\t\t\tfor(int i=1;i<=k;i++)\n\t\t\t{\n\t\t\t\tint cao=z-i-1;\n\t\t\t\tif(cao>=1&&cao<=k)add(x+(i-1)*n,ARK(y+(cao-1)*n)),add(y+(i-1)*n,ARK(x+(cao-1)*n));\n\t\t\t}\n\t\t}\n\t}\n//\tcout<<\"cao>\"<<endl;\n\tfor(int i=1;i<=2*tot;i++)if(!dfn[i])tarjan(i);\n//\tcout<<\"scc:\";\n//\tfor(int i=1;i<=2*tot;i++)cout<<sd[i]<<\" \";\n//\tcout<<endl;\n\tfor(int i=1;i<=tot;i++)if(sd[i]==sd[i+tot]){cout<<\"-1\"<<endl;return ;}\n\tfor(int i=1;i<=n;i++) \n\t{\n\t\tfor(int j=0;j<k;j++)\n\t\t\tif(sd[i+j*n]<sd[ARK(i+j*n)]){cout<<(j+1)<<\" \";if(i==n)cout<<endl;break;}\n\t}\n}\nsigned main()\n{\n\tt=read();\n\twhile(t--)work();\n\treturn 0;\n}\n```",
        "postTime": 1683941905,
        "uid": 526519,
        "name": "Aisaka_Taiga",
        "ccfLevel": 0,
        "title": "CF1697F"
    }
]