[
    {
        "content": "\u6253\u4e2a\u5e7f\u544a\uff1a[\u849f\u84bb\u7684\u535a\u5ba2](https://www.cnblogs.com/rill7747/p/9869529.html)\n\n# \u9898\u610f\n\n\u6709\u4e00\u68f5$n$\u4e2a\u8282\u70b9\u7684\u4ee51\u4e3a\u6839\u7684\u6811\uff0c\u6709$m$\u6761\u8fb9\u5df2\u77e5\uff0c\u5e76\u4e14\u6709$q$\u4e2a\u9650\u5236$a_i,b_i,c_i$\uff0c\u9700\u8981\u6ee1\u8db3$\\mathrm{LCA}(a_i,b_i)=c_i$\u3002\u6c42\u6ee1\u8db3\u6761\u4ef6\u7684\u6811\u7684\u6570\u91cf\u3002\n\n$m<n\\le 13,q\\le 100$\u3002\n\n# \u9898\u89e3\n\n\u6811\u5f62\u72b6\u538bDP\u3002DP\u72b6\u6001\u5f88\u663e\u7136\uff0c$dp_{u,mask}$\u8868\u793a\u4ee5$u$\u4e3a\u6839\uff0c\u7531$mask$\u8fd9\u4e9b\u70b9\u7ec4\u6210\u7684\u5b50\u6811\u7684\u65b9\u6848\u6570\u3002$mask$\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u72b6\u6001\u3002\n\n\u4e3a\u65b9\u4fbf\u8ba8\u8bba\uff0c\u4ee5\u4e0b\u9898\u89e3\u548c\u4ee3\u7801\u8282\u70b9\u7f16\u53f7\u4ece$0$\u5f00\u59cb\u3002\n\n## \u8f6c\u79fb\u65b9\u7a0b\n\n$$dp_{u,mask}=\\sum dp_{v,submask}\\times dp_{u,mask\\oplus submask}$$\n\n$\\oplus$\u8868\u793a\u7684\u662f\u5f02\u6216($xor$)\u8fd0\u7b97\u3002\n\n\u4f46\u662f\uff0c\u6211\u4eec\u76f4\u63a5\u679a\u4e3e$v,submask$\u4f1a\u6709\u91cd\u590d\uff0c\u4f8b\u5982\u4e00\u68f5\u4e8c\u53c9\u6811\uff0c\u6839\u4e3a$root$\uff0c\u5de6\u53f3\u513f\u5b50\u5206\u522b\u4e3a$leftson,rightson$\u3002\u5f53\u679a\u4e3e$v=leftson$\u65f6\u4f1a\u8ba1\u7b97\u8fd9\u68f5\u6811\uff0c$v=rightson$\u65f6\u53c8\u4f1a\u8ba1\u7b97\u8fd9\u68f5\u6811\uff0c\u5c31\u4f1a\u51fa\u73b0\u91cd\u590d\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u89c4\u5b9a\u4e00\u4e2a\u70b9$pos\\in mask\\ (pos\\ne u)$\uff0c\u5f3a\u5236$pos$\u5728$submask$\u4e2d\u624d\u80fd\u8f6c\u79fb\u3002\n\n## \u8f6c\u79fb\u6761\u4ef6\n\n\u9898\u76ee\u4e2d\u6709\u4e24\u79cd\u9650\u5236\u6761\u4ef6\uff0c\u5206\u522b\u4e3a\u8fb9\u548c$\\mathrm{LCA}$\u3002\n\n1. \u5bf9\u4e8e$\\mathrm{LCA}$\u7684\u9650\u5236\uff1a\n    1.1. \u5bf9\u4e8e\u9650\u5236$(a,b,c)$\uff0c\u5982\u679c$c=u$\uff0c\u4f46\u662f$a,b\\in submask$\uff0c\u90a3\u4e48$\\mathrm{LCA}$\u4e00\u5b9a\u4e0d\u4e3a$c$\uff0c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u3002\n    1.2. \u5bf9\u4e8e\u9650\u5236$(a,b,c)$\uff0c \u5982\u679c$c\\in submask$\uff0c\u4f46$a,b$\u4e2d\u6709**\u81f3\u5c11**\u4e00\u4e2a\u4e0d\u5728$submask$\u4e2d\uff0c\u5219$\\mathrm{LCA}$\u4e00\u5b9a\u4e0d\u4e3a$c$\uff0c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u3002\n2. \u5bf9\u4e8e\u8fb9\u7684\u9650\u5236\uff1a\n    2.1. \u5bf9\u4e8e\u8fb9$(x,y)$\uff0c\u5982\u679c$x,y\\ne u$\uff0c\u4f46\u662f$x,y$\u5176\u4e2d\u4e00\u4e2a\u5728$submask$\u4e2d\uff0c\u53e6\u4e00\u4e2a\u4e0d\u5728\uff0c\u5219\u8fd9\u6761\u8fb9\u4e0d\u53ef\u80fd\u5728\u6811\u4e0a\uff0c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u3002\n    2.2. \u5982\u679c$u$\u4e0e$i$\u6709\u8fb9\u4e14$i\\in submask$\u7684$i$\u7684\u6570\u91cf\u5927\u4e8e1\uff0c\u5219\u4e0d\u53ef\u80fd\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u6811\uff0c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u3002\n\n\u57282.2\u4e2d\uff0c\u5982\u679c\u8fd9\u6837\u7684$i$\u7684\u6570\u91cf\u7b49\u4e8e1\uff0c\u5219\u8f6c\u79fb\u65f6$v$\u4e0d\u7528\u679a\u4e3e\uff0c$v$\u53ea\u80fd\u662f\u90a3\u4e2a$i$\u3002\u5426\u5219$v$\u9700\u8981\u5728$submask$\u4e2d\u679a\u4e3e\u3002\n\n## \u5173\u4e8e\u590d\u6742\u5ea6\n\n\u5b50\u96c6\u679a\u4e3e\u53ef\u4ee5\u7528`for (register int submask = mask; submask; submask = (submask - 1) & mask)`\u3002\n\n\u6b64\u65f6\u590d\u6742\u5ea6\u5e76\u4e0d\u662f$O(4^n)$\uff0c\u800c\u662f$O(3^n)$\uff0c\u56e0\u4e3a\u6bcf\u6b21\u679a\u4e3e\u5230\u7684$submask$\u4e00\u5b9a\u662f$mask$\u7684\u5b50\u96c6\u3002\u72b6\u6001\u6570\u4e3a$3^n$\u3002\n\n\u56e0\u4e3a\u6b64\u65f6$n$\u4e2a\u6570\u6709\u4e09\u79cd\u72b6\u6001\uff1a\u4e0d\u5728$mask$\u4e2d\uff0c\u5728$mask$\u4f46\u4e0d\u5728$submask$\u4e2d\uff0c\u5728$submask$\u4e2d\u3002\u6240\u4ee5\u662f$3^n$\u3002\n\n\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a$O(3^nn(n+q+m))$\u3002\n\n\u89c2\u5bdf\u4ee3\u7801\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u590d\u6742\u5ea6\u975e\u5e38\u4e0d\u6ee1\uff0c\u5f88\u591a\u72b6\u6001\u548c\u5b50\u96c6\u662f\u6ca1\u7528\u7684\u3002\u52a0\u4e0aCF\u7684\u8bc4\u6d4b\u673a\u901f\u5ea6\uff0c\u8fd8\u662f\u53ef\u4ee5\u8fc7\u7684\u3002\n\n# \u4ee3\u7801\n\n[Code](http://codeforces.com/problemset/submission/599/45029702) \u5b9e\u6d4b93ms\n\n```cpp\n#include <cstdio>\n#include <cstring>\nint n, m, q, edge[15][15];\nstruct Edge{ int x, y; } E[15];\nstruct node{ int x, y, z; } a[105];\nlong long dp[15][100005];\nbool in(int x, int s){ return s & (1 << x); }\nlong long dfs(int u, int mask){ // \u7528\u8bb0\u641c\u5b9e\u73b0\n\tlong long &res = dp[u][mask];\n\tif (~res) return res;\n\tres = 0, mask -= 1 << u;\n\tint pos;\n\tfor (pos = 0; pos < n; ++pos) if (in(pos, mask)) break; // \u5f3a\u5236pos\u5728submask\u4e2d\n\tfor (register int submask = mask; submask; submask = (submask - 1) & mask) // \u679a\u4e3e\u5b50\u96c6\n\t\tif (in(pos, submask)){\n\t\t\tint flag = 1, v, cnt = 0;\n            // \u6761\u4ef61.1\n\t\t\tfor (register int i = 1; i <= q; ++i)\n\t\t\t\tif (a[i].z == u && in(a[i].x, submask) && in(a[i].y, submask))\n\t\t\t\t\t{ flag = 0; break; }\n\t\t\tif (!flag) continue;\n            // \u6761\u4ef61.2\n\t\t\tfor (register int i = 1; i <= q; ++i) \n\t\t\t\tif (in(a[i].z, submask) && (!in(a[i].x, submask) || !in(a[i].y, submask)))\n\t\t\t\t\t{ flag = 0; break; }\n            if (!flag) continue;\n            // \u6761\u4ef62.1\n\t\t\tfor (register int i = 1; i <= m; ++i)\n\t\t\t\t\tif (E[i].x != u && E[i].y != u && (in(E[i].x, submask) ^ in(E[i].y, submask)))\n\t\t\t\t\t\t{ flag = 0; break; }\n\t\t\tif (!flag) continue;\n            // \u6761\u4ef62.2\n\t\t\tfor (register int i = 0; i < n; ++i)\n\t\t\t\tif (edge[u][i] && in(i, submask)){ ++cnt; v = i; }\n\t\t\tif (cnt > 1) continue;\n\t\t\tif (cnt == 1) res += dfs(v, submask) * dfs(u, mask ^ submask ^ (1 << u));\n\t\t\telse{\n\t\t\t\tfor (v = 0; v < n; ++v)\n\t\t\t\t\tif (in(v, submask)) res += dfs(v, submask) * dfs(u, mask ^ submask ^ (1 << u)); // \u8f6c\u79fb\u65b9\u7a0b\n\t\t\t}\n\t\t}\n\treturn res;\n}\nint main(){\n\tscanf(\"%d%d%d\", &n, &m, &q);\n\tfor (register int i = 1; i <= m; ++i)\n\t\tscanf(\"%d%d\", &E[i].x, &E[i].y), --E[i].x, --E[i].y, // \u7f16\u53f7\u4ece0\u5f00\u59cb\n\t\tedge[E[i].x][E[i].y] = edge[E[i].y][E[i].x] = 1;\n\tfor (register int i = 1; i <= q; ++i)\n\t\tscanf(\"%d%d%d\", &a[i].x, &a[i].y, &a[i].z), --a[i].x, --a[i].y, --a[i].z; // \u540c\u4e0a\n\tmemset(dp, -1, sizeof dp);\n\tfor (register int i = 0; i < n; ++i) dp[i][1 << i] = 1; // \u521d\u59cb\u5316\n\tprintf(\"%lld\", dfs(0, (1 << n) - 1));\n}\n```",
        "postTime": 1540812328,
        "uid": 20561,
        "name": "AutumnKite",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF599E \u3010Sandy and Nuts\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF599E)\n# \u9898\u76ee\u5927\u610f\n\u7ed9\u51fa $n,m,q$\uff0c\u8868\u793a\u6811\u6709 $n$ \u4e2a\u70b9\uff0c\u6709 $m$ \u5bf9\u5173\u7cfb\uff0c\u5176\u4e2d\u5173\u7cfb $x\\to y$\uff0c\u8868\u793a\u6811\u4e2d\u5b58\u5728 $x\\leftrightarrow y$ \u7684\u8fb9\uff0c$q$ \u7ec4\u5173\u7cfb$a,b,c$ \u8868\u793a\u6811\u4e2d $a,b$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u4e3a $c$\u3002\u95ee\u6709\u591a\u5c11\u68f5\u6811\u6ee1\u8db3\u6761\u4ef6\u3002\n\n\u6811\u4ee5 $1$ \u4e3a\u6839\uff0c$m\\le n\\le 13,q\\le 100$\n# \u601d\u8def\n\u8fd9\u7bc7\u535a\u5ba2\u4e3b\u8981\u662f\u8bb2\u4e00\u4e9b\u7ec6\u8282\u95ee\u9898\uff0c\u4e00\u4e9b\u81ea\u5df1\u5728\u5b9e\u73b0\u7684\u65f6\u5019\u78b0\u5230\u7684\u95ee\u9898\uff0c\u5982\u679c\u4f60\u60f3\u8981\u770b\u601d\u8def\uff0c\u8bf7\u53bb\u522b\u7684\u9898\u89e3\u89c2\u770b\u3002\n\n\u9996\u5148\u4e0d\u96be\u60f3\u5230\u4e00\u4e2a\u60f3\u6cd5\uff0c\u6211\u4eec\u8bbe $f_{i,S}$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\uff0c\u5b50\u6811\u72b6\u6001\u4e3a $S$ \u7684\u65b9\u6848\u6570\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u6811\u5f62\u80cc\u5305\u7684\u8f6c\u79fb\uff1a\n\n$$f_{i,S}=\\sum_{k=1,T}^{n}f_{i,S\\otimes T}\\times f_{j,T}$$\n\n\u7136\u540e\u4f60\u53d1\u73b0\u8fd9\u6837\u505a\u5c31\u884c\u4e86\uff0c\u4e0d\u8fc7\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u95ee\u9898\u9700\u8981\u6ce8\u610f\u3002\n\n- \u5982\u4f55\u907f\u514d\u7b97\u91cd\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\u5982\u679c\u76f4\u63a5\u6309\u8fd9\u4e2a\u5f0f\u5b50\u7b97\u6211\u4eec\u80af\u5b9a\u662f\u4f1a\u7b97\u91cd\u7684\uff0c\u56e0\u4e3a\u5b50\u6811\u904d\u5386\u987a\u5e8f\u4e0d\u4e00\u6837\uff0c\u4f46\u6811\u7684\u5f62\u6001\u76f8\u540c\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u60f3\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u5f3a\u884c\u94a6\u5b9a\u4e00\u4e2a\u987a\u5e8f\uff0c\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u5f3a\u884c\u94a6\u5b9a\u6211\u73b0\u5728\u65b0\u589e\u7684\u5b50\u6811\u5e94\u8be5\u5305\u542b\u54ea\u4e2a\u70b9\uff0c\u56e0\u4e3a\u4e00\u4e2a\u70b9\u4e0d\u53ef\u80fd\u51fa\u73b0\u5728\u4e24\u4e2a\u5b50\u6811\u6240\u4ee5\u8fd9\u6837\u5c31\u786e\u5b9a\u4e86\u987a\u5e8f\u3002\n\n- \u5982\u4f55\u4fdd\u8bc1\u8fb9\u7684\u6761\u4ef6\n\n\u6211\u4eec\u53d1\u73b0\u5176\u5b9e\u5728\u6bcf\u4e2a\u5b50\u6811\u5224\u65ad\u7684\u65f6\u5019\u53ea\u9700\u8981\u5224\u65ad\u6bcf\u6761\u8fb9\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\u662f\u5426\u5728\u540c\u4e00\u4e2a\u5b50\u6811\u5373\u53ef\u3002\u56e0\u4e3a\u4e0d\u76f8\u90bb\u7684\u8bdd\u4e00\u5b9a\u4f1a\u5728\u6811\u4e0a\u67d0\u4e2a\u5730\u65b9\u88ab\u53d1\u73b0\u4e86\u4e0d\u5408\u6cd5\u3002\n\n- \u5982\u4f55\u4fdd\u8bc1\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684\u6761\u4ef6\n\n\u4f60\u53d1\u73b0\u65e0\u975e\u5c31\u4e24\u79cd\uff1a\n\n1. \u516c\u5171\u7956\u5148\u4e3a $i$\uff0c\u4f46\u662f\u4e24\u4e2a\u8282\u70b9\u90fd\u5728\u65b0\u589e\u5b50\u6811\u91cc\u9762\n\n\u8fd9\u6837\u663e\u7136 $i$ \u4e0d\u662f\u6700\u8fd1\u516c\u5171\u7956\u5148\u3002\n\n2. \u7956\u5148\u90fd\u5728\u5b50\u6811\u91cc\u9762\u4e86\uff0c\u4f46\u662f\u4e24\u4e2a\u8282\u70b9\u4efb\u4e00\u4e00\u4e2a\u4e0d\u5728\n\n\u8fd9\u6837\u663e\u7136\u4e0d\u5408\u6cd5\u3002\n\n---\n\n\u7136\u540e\u4f60\u53d1\u73b0\u4f60\u6309\u7167\u8fd9\u6837\u5199\u7684\u4e1c\u897f\u8fc7\u4e0d\u6389\u6837\u4f8b\uff0c\u4e8e\u662f\u4f60\u53d1\u73b0\u6709\u4e0b\u9762\u51e0\u4e2a\u7ec6\u8282\uff1a\n\n1. \u5408\u6cd5\u6027\u7684\u5224\u65ad\n\n\u4f60\u53d1\u73b0\u5b9e\u9645\u4e0a\u6211\u4eec\u4e0d\u80fd\u5224\u65ad\u5f53\u524d $S$ \u7684\u5408\u6cd5\u6027\u800c\u5e94\u8be5\u53bb\u5224\u65ad $T$ \u7684\u5408\u6cd5\u6027\uff0c\u56e0\u4e3a $S$ \u6709\u53ef\u80fd\u8fd8\u9700\u8981\u548c\u5176\u5b83\u5b50\u6811\u5408\u5e76\uff0c\u4f60\u53ef\u80fd\u4e00\u5f00\u59cb\u4e0d\u5408\u6cd5\uff0c\u5408\u5e76\u540e\u5c31\u5408\u6cd5\u4e86\u3002\n\n2. \u8fb9\u7684\u5408\u6cd5\u6027\n\n\u5b9e\u9645\u4e0a\u5982\u679c\u4f60\u5f53\u524d\u8282\u70b9\u8fde\u7684\u70b9\u5728\u65b0\u589e\u5b50\u6811\u91cc\u9762\u4e3a $1$ \u7684\u8bdd\uff0c\u90a3\u90a3\u4e2a\u8282\u70b9\u4e00\u5b9a\u662f\u5f53\u524d\u8282\u70b9\u7684\u513f\u5b50\uff0c\u7279\u5224\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u8fd9\u513f\u8bf4\u660e\u4e00\u4e0b\uff0c\u56e0\u4e3a\u672c\u6765\u4f60\u7684\u5408\u6cd5\u6027\u5224\u65ad\u53ef\u4ee5\u628a\u8fd9\u79cd\u60c5\u51b5\u5224\u6389\uff0c\u4f46\u662f\u56e0\u4e3a\u4f60\u5408\u6cd5\u6027\u5224\u65ad\u53ea\u5224\u65ad\u5b50\u6811\u4e86\uff0c\u5c31\u4e0d\u4f1a\u6392\u9664\u6389\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u624b\u52a8\u5224\u6389\u3002\n\n3. \u8bb0\u5f97\u5f00 $\\text{long long}$\n\n# $\\text{Code}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define Int register int\n#define int long long\n#define MAXN 14\n\ntemplate <typename T> inline void read (T &t){t = 0;char c = getchar();int f = 1;while (c < '0' || c > '9'){if (c == '-') f = -f;c = getchar();}while (c >= '0' && c <= '9'){t = (t << 3) + (t << 1) + c - '0';c = getchar();} t *= f;}\ntemplate <typename T,typename ... Args> inline void read (T &t,Args&... args){read (t);read (args...);}\ntemplate <typename T> inline void write (T x){if (x < 0){x = -x;putchar ('-');}if (x > 9) write (x / 10);putchar (x % 10 + '0');}\n\nint n,m,q,up,dp[MAXN][1 << MAXN],Edge[MAXN][2],LCA[105][3];\n\nbool inside (int S,int x){return (S >> x - 1 & 1);}\n\nsigned main(){\n\tread (n,m,q),up = 1 << n;\n\tfor (Int i = 1;i <= m;++ i) read (Edge[i][0],Edge[i][1]);\n\tfor (Int i = 1,a,b,c;i <= q;++ i) read (a,b,c),LCA[i][0] = a,LCA[i][1] = b,LCA[i][2] = c;\n\tfor (Int i = 1;i <= n;++ i) dp[i][1 << i - 1] = 1;\n\tfor (Int S = 1;S < up;++ S){\n\t\tfor (Int i = 1;i <= n;++ i){\n\t\t\tif (!(S >> i - 1 & 1)) continue;\n\t\t\tint moveto;\n\t\t\tfor (Int j = 1;j <= n;++ j) if (i != j && (S >> j - 1 & 1)){moveto = j;break;}\n\t\t\tint nowS = S ^ (1 << i - 1);\n\t\t\tfor (Int T = nowS;T;T = (T - 1) & nowS){\n\t\t\t\tif (!inside (T,moveto)) continue;\n\t\t\t\tbool flag = 1;\n\t\t\t\tfor (Int j = 1;j <= q;++ j){\n\t\t\t\t\tif (LCA[j][2] == i && inside (T,LCA[j][0]) && inside (T,LCA[j][1])){flag = 0;break;}\n\t\t\t\t\tif (inside (T,LCA[j][2]) && (!inside (T,LCA[j][0]) || !inside (T,LCA[j][1]))){flag = 0;break;}\n\t\t\t\t}\n\t\t\t\tfor (Int j = 1;j <= m;++ j){\n\t\t\t\t\tif (Edge[j][0] == i || Edge[j][1] == i) continue;\n\t\t\t\t\tif (inside (T,Edge[j][0]) && !inside (T,Edge[j][1])){flag = 0;break;}\n\t\t\t\t\tif (!inside (T,Edge[j][1]) && inside (T,Edge[j][0])){flag = 0;break;}\n\t\t\t\t}\n\t\t\t\tif (!flag) continue;\n\t\t\t\tint to,cnt = 0;\n\t\t\t\tfor (Int j = 1;j <= m;++ j){\n\t\t\t\t\tif (Edge[j][0] == i){if (inside (T,Edge[j][1])) cnt ++,to = Edge[j][1];}\n\t\t\t\t\tif (Edge[j][1] == i){if (inside (T,Edge[j][0])) cnt ++,to = Edge[j][0];}\n\t\t\t\t}\n\t\t\t\tif (!cnt){\n\t\t\t\t\tfor (Int j = 1;j <= n;++ j) \n\t\t\t\t\t\tif (inside (T,j)) dp[i][S] += dp[i][S ^ T] * dp[j][T];\n\t\t\t\t}\n\t\t\t\telse if (cnt == 1) dp[i][S] += dp[to][T] * dp[i][S ^ T];\n\t\t\t}\n\t\t}\n\t} \n\twrite (dp[1][up - 1]),putchar ('\\n'); \n\treturn 0;\n}\n```",
        "postTime": 1599827975,
        "uid": 124781,
        "name": "Walking_Dead",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF599E \u3010Sandy and Nuts\u3011"
    },
    {
        "content": "\u6839\u636e $n \\leq 13$ \u7684\u6570\u636e\u8303\u56f4\u731c\u6d4b\u8fd9\u662f\u4e00\u4e2a\u72b6\u538b dp\u3002\n\n\u4e8e\u662f\u5b9a\u4e49 $dp_{i,S}$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\uff0c\u5176\u5b50\u6811\uff08\u5305\u542b\u81ea\u5df1\uff09\u6240\u5305\u542b\u7684\u8282\u70b9\u6784\u6210\u7684\u72b6\u6001\u4e3a $S$\uff0c\u6709\u591a\u5c11\u79cd\u6784\u6210\u4e00\u68f5\u5408\u6cd5\u7684\u5b50\u6811\u7684\u65b9\u6cd5\u3002\u8003\u8651\u53bb\u8f6c\u79fb\u8fd9\u4e2a\u4e1c\u897f\uff0c\u53ef\u4ee5\u5f97\u5230\u7b80\u5355\u7684 dp \u5f0f\uff0c\u5373\uff1a\n\n$$\ndp_{u,S} = \\sum_{T\u2286S,v\\in S} dp_{v,T} \\times dp_{u,S \\operatorname{xor} T}\n$$\n\n\u89e3\u91ca\u8fd9\u4e2a dp \u65b9\u7a0b\uff0c\u8003\u8651\u6211\u4eec\u73b0\u5728\u7528\u5176\u4e2d\u7684\u4e00\u4e9b\u8282\u70b9\uff0c\u72b6\u6001\u4e3a $T$\uff0c\u6784\u6210\u4e00\u68f5\u5b50\u6811\uff0c\u5176\u65b9\u6848\u6570\u4e3a $dp_{v,T}$\uff1b\u73b0\u5728\u9700\u8981\u5206\u5b8c\u5269\u4e0b\u7684\u8282\u70b9\uff0c\u53d1\u73b0\u5b9e\u9645\u4e0a\u8fd9\u662f\u4e00\u4e2a\u9012\u5f52\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u8981\u5904\u7406\u4ee5 $u$ \u4e3a\u6839\u4f46\u72b6\u6001\u66f4\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u4e8e\u662f\u6211\u4eec\u7ee7\u7eed\u9012\u5f52\u5904\u7406 $dp_{u,S \\operatorname{xor} T}$\u3002\u6240\u4ee5\u4e0a\u9762\u7684 dp \u662f\u6b63\u786e\u7684\u3002\n\n\u4f46\u662f\u4ed4\u7ec6\u4e00\u4e0b\u4f1a\u53d1\u73b0\u6211\u4eec\u4f1a\u6709\u7b97\u91cd\u7684\u60c5\u51b5\u3002\u56e0\u4e3a\u5b50\u6811\u7684\u987a\u5e8f\u4e0d\u540c\uff0c\u6811\u8fd8\u662f\u540c\u4e00\u68f5\u6811\u3002\u4e3a\u4e86\u9664\u53bb\u7b97\u91cd\u7684\u60c5\u51b5\uff0c\u94a6\u5b9a\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u7279\u6b8a\u70b9 $p$\uff0c\u5fc5\u987b\u5f53 $T$ \u7684\u72b6\u6001\u5305\u542b $p$ \u7684\u65f6\u5019\u624d\u80fd\u591f\u8f6c\u79fb\u3002\u94a6\u5b9a\u7279\u6b8a\u70b9\u7684\u884c\u4e3a\u5b9e\u8d28\u4e0a\u662f\u94a6\u5b9a\u4e86\u5b50\u6811\u7684\u8f6c\u79fb\u987a\u5e8f\uff0c\u4e8e\u662f\u8981\u4fdd\u8bc1\u540c\u4e00\u4e2a\u72b6\u6001\u9009\u62e9\u7684\u7279\u6b8a\u70b9\u662f\u540c\u4e00\u4e2a\u3002\u8fd9\u4efd\u4ee3\u7801\u9009\u7684\u662f $S$ \u7684\u7b2c\u4e00\u4e2a\u3002\n\n\u6709\u4e86\u8fd9\u4e9b\u4fe1\u606f\u8003\u8651\u9898\u76ee\u7684 $\\mathrm{LCA}$ \u4e0e\u8fb9\u7684\u9650\u5236\u3002\n\n- $\\mathrm{LCA}$\n  - \u5982\u679c\u5f53\u524d\u8f6c\u79fb\u7684 $u$ \u662f\u67d0\u4e00\u4e2a\u9650\u5236\u7684 $c_k$\uff0c\u90a3\u4e48\u72b6\u6001 $T$ \u4e0d\u80fd\u540c\u65f6\u5305\u542b $a_k$ \u548c $b_k$\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u6ee1\u8db3\u6784\u6210\u7684\u6811\uff0c$a_k$ \u548c $b_k$ \u7684 ${c_k}'$ \u4f1a\u6bd4 $c_k$ \u66f4\u6df1\uff0c\u90a3\u4e48\u4e0d\u5408\u6cd5\uff1b   \n  - \u5982\u679c\u53d1\u73b0 $c_k$ \u5728\u72b6\u6001 $T$ \u91cc\u9762\uff0c\u7136\u800c $a_k,b_k$ \u4e2d\u6709\u4e00\u4e2a\uff0c\u4e0d\u5b58\u5728\u4e8e\u72b6\u6001 $T$\uff0c\u90a3\u4e48\u4e0d\u5408\u6cd5\u3002\n\n- \u8fb9\n  - \u5982\u679c\u5b58\u5728\u4e00\u6761\u8fb9\u6ee1\u8db3\u4e00\u6761\u8fb9\u7684\u7aef\u70b9\u4e0d\u5728\u540c\u4e00\u68f5\u5b50\u6811\u65e0\u6cd5\u8f6c\u79fb\uff1b   \n  - \u5982\u679c\u72b6\u6001 $T$ \u91cc\u9762\u5b58\u5728\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u70b9\u8981\u548c $u$ \u76f8\u8fde\uff0c\u65e0\u6cd5\u8f6c\u79fb\u3002\n  \n\u7136\u540e\u5206\u60c5\u51b5\u8ba8\u8bba\u3002\u72b6\u6001 $T$ \u91cc\u9762\u4e0d\u5b58\u5728\u70b9\u8981\u548c $u$ \u76f8\u8fde\uff0c\u90a3\u6211\u4eec\u679a\u4e3e $T$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\uff0c\u76f8\u8fde\u5224\u65ad\uff1b\u5426\u5219\u6211\u4eec\u5fc5\u987b\u53ea\u80fd\u548c\u4e00\u4e2a\u70b9\u76f4\u63a5\u76f8\u8fde\uff0c\u76f4\u63a5\u5411\u90a3\u4e2a\u70b9\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u7ec6\u8282\u6709\u70b9\u591a\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nLL n,m,q,dp[14][(1<<13)],a[105],b[105],c[105],u[14],v[14];\nLL dfs(LL now,LL S)\n{ \n\tif(~dp[now][S])\treturn dp[now][S];\n//\tprintf(\"%d %d\\n\",now,S);\n//\tLL alive=S^(1<<(now-1));\n\tLL Fuck=S^(1<<(now-1));\n\tdp[now][S]=0;\n\tLL moved=1;\n\twhile(!(Fuck&(1<<(moved-1))))\t++moved;\n\tfor(LL T=Fuck;T;T=(T-1)&Fuck)\n\t{\n\t\tLL cnt=0,to=0;\n\t\tif(!(T&(1<<(moved-1))))\tcontinue;//\u907f\u514d\u91cd\u590d\u5f3a\u5236\u89c4\u5b9a\u4e00\u4e2a\u70b9\u5728\u5b50\u96c6\u4e2d\u624d\u80fd\u8f6c\u79fb\n\t\tfor(LL i=1;i<=q;++i)\tif(now==c[i] && (T&(1<<(a[i]-1))) && (T&(1<<(b[i]-1))))\tgoto fail;//\u5982\u679c\u8bf4\u5f53\u524d\u8fd9\u4e2a\u70b9\u662f LCA\uff0c\u5e76\u4e14\u6211\u4eec\u8981\u8f6c\u79fb\u7684\u5b50\u6811\u5305\u542b\u4e86\u53e6\u5916\u4e24\u4e2a\u70b9\uff0c\u4e0d\u5408\u6cd5\n\t\tfor(LL i=1;i<=q;++i)\n\t\t{\n\t\t\tif((T&(1<<(c[i]-1))))\n\t\t\t{\n\t\t\t\tif(!(T&(1<<(a[i]-1))) || !(T&(1<<(b[i]-1))))\tgoto fail;\n\t\t\t}\n\t\t}//\u5982\u679c\u8bf4 LCA \u5728\u5b50\u6811\u91cc\u9762\u7136\u800c\u5176\u4ed6\u4e24\u4e2a\u6709\u4efb\u610f\u4e00\u4e2a\u4e0d\u5728\u91cc\u9762\u65e0\u6cd5\u8f6c\u79fb\n\t\tfor(LL i=1;i<=m;++i)\n\t\t{\n\t\t\tif(u[i]==now || v[i]==now)\tcontinue;\n\t\t\tif((T&(1<<(u[i]-1))) && !(T&(1<<(v[i]-1))))\tgoto fail;\n\t\t\tif(!(T&(1<<(u[i]-1))) && (T&(1<<(v[i]-1))))\tgoto fail;\n\t\t}//\u5982\u679c\u5b58\u5728\u4e00\u6761\u8fb9\u6ee1\u8db3\u4e00\u6761\u8fb9\u7684\u7aef\u70b9\u4e0d\u5728\u540c\u4e00\u68f5\u5b50\u6811\u65e0\u6cd5\u8f6c\u79fb\n\t\tfor(LL i=1;i<=m;++i)\n\t\t{\n\t\t\tif(u[i]==now)\n\t\t\t{\n\t\t\t\tif((T&(1<<(v[i]-1))))\t++cnt,to=v[i];\n\t\t\t}\n\t\t\telse if(v[i]==now)\n\t\t\t{\n\t\t\t\tif((T&(1<<(u[i]-1))))\t++cnt,to=u[i];\n\t\t\t}\n\t\t}\n\t\tif(cnt==0)\n\t\t{\n\t\t\tfor(LL i=1;i<=n;++i)\n\t\t\t\tif((T&(1<<(i-1))))\n\t\t\t\t\tdp[now][S]+=dfs(i,T)*dfs(now,Fuck^T^(1<<(now-1)));\n\t\t}\n\t\telse if(cnt==1)\n\t\t{\n\t\t\tdp[now][S]+=dfs(to,T)*dfs(now,Fuck^T^(1<<(now-1)));\n\t\t}\n\t\t//\u6709\u4e24\u6761\u53ca\u4ee5\u4e0a\u76f4\u63a5\u76f8\u8fde\u7684\u8fb9\uff0c\u4e0d\u5408\u6cd5\n\t\tfail:;\n\t}\n//\tS^=(1<<(now-1));\n//\tprintf(\"%d %d:%d\\n\",now,S,dp[now][S]);\n\treturn dp[now][S];\n}\nint main(){\n\tcin>>n>>m>>q;\n\tmemset(dp,-1,sizeof dp);\n\tfor(LL i=1;i<=n;++i)\tdp[i][1<<(i-1)]=1;\n\tfor(LL i=1;i<=m;++i)\tcin>>u[i]>>v[i];\n\tfor(LL i=1;i<=q;++i)\tcin>>a[i]>>b[i]>>c[i];\n\tdfs(1,(1<<n)-1);\n\tcout<<dp[1][(1<<n)-1]<<endl;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1599827793,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF599E \u3010Sandy and Nuts\u3011"
    },
    {
        "content": "&emsp;&emsp;**\u53bb\u5f80[\u539f\u535a\u5ba2](https://www.cnblogs.com/crashed/p/13395632.html)\u98df\u7528\u66f4\u4f73\u3002**    \n# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/CF599E)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&emsp;&emsp;\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4e0d\u5b58\u5728\u4efb\u4f55\u9650\u5236\u7684\u65f6\u5019\u8be5\u600e\u4e48\u505a\u3002   \n&emsp;&emsp;~~\u6839\u636e $Pr\\overset{..}{u}fer$ \u5e8f\u5217\u76f4\u63a5\u5f97\u51fa\u7b54\u6848\u4e3a $n^{n-2}$ \u3002~~     \n&emsp;&emsp;\u5ffd\u7565\u90a3\u79cd\u505a\u6cd5\uff0c\u56e0\u4e3a\u5b83\u96be\u4ee5\u5904\u7406 LCA \u7684\u9650\u5236\u3002\u770b\u5230 $n$ \u5f88\u5c0f\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u72b6\u6001\u538b\u7f29\u7684 DP :    \n&emsp;&emsp;$f(u,S)$\uff1a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u70b9\u96c6\u4e3a $S$ \u7684\u65b9\u6848\u6570\u3002   \n&emsp;&emsp;\u4e3a\u4e86\u65b9\u4fbf\uff0c\u4ee5\u4e0b\u6211\u4eec\u4e5f\u5c31\u7528 $(u,S)$ \u8868\u793a\u4e00\u68f5\u6839\u4e3a $u$ \uff0c\u70b9\u96c6\u4e3a $S$ \u7684\u5b50\u6811\u3002      \n&emsp;&emsp;\u4e4b\u540e\uff0c\u8fb9\u754c\u6761\u4ef6\u4e3a $f(u,\\{u\\})=1$ \uff0c\u7b54\u6848\u5c31\u662f $f(1,V)$ \u3002    \n&emsp;&emsp;\u7136\u540e\u5b58\u5728\u8f6c\u79fb\uff1a    \n$$f(u,S)=\\sum_{v\\in T\\subseteq S} f(u,S\\setminus T)\\times f(v,T)$$    \n&emsp;&emsp;\u76f4\u63a5\u8f6c\u79fb\u4f1a\u91cd\u590d\u8ba1\u6570\u3002\u4f8b\u5982\u8fd9\u79cd\u60c5\u51b5\uff1a   \n> &emsp;&emsp;$(u,S)$ \u6709\u4e24\u68f5\u5b50\u6811 $(v,S_1)$ \u548c $(w,S_2)$ \uff0c\u6ee1\u8db3 $S=S_1\\cup S_2\\cup \\{u\\}$ \u3002  \n\n&emsp;&emsp;\u90a3\u4e48 $f(u,S\\setminus S_1)\\times f(v,S_1)$ \u548c $f(u,S\\setminus S_2)\\times f(w,S_2)$ \u90fd\u4f1a\u8ba1\u7b97\u8fd9\u79cd\u60c5\u51b5\u3002   \n&emsp;&emsp;\u4e3a\u4e86\u89c4\u907f\u91cd\u590d\u8ba1\u7b97\uff0c\u6211\u4eec\u9700\u8981\u94a6\u5b9a\u4e00\u4e2a\u4e0d\u4e3a $u$ \u7279\u6b8a\u70b9\uff0c\u6bcf\u6b21**\u53ea\u679a\u4e3e\u5305\u542b\u7279\u6b8a\u70b9\u7684 $(v,T)$ \u8fdb\u884c\u8f6c\u79fb**\u3002     \n&emsp;&emsp;\u8fd9\u5c31\u76f8\u5f53\u4e8e\u59cb\u7ec8\u5728**\u679a\u4e3e\u7279\u6b8a\u70b9\u6240\u5728\u7684\u5b50\u6811\u7684\u60c5\u51b5**\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u6837\u53ef\u4ee5\u505a\u5230\u4e0d\u91cd\u4e0d\u6f0f\u3002    \n&emsp;&emsp;\u90a3\u4e48\u8003\u8651\u9898\u76ee\u7ed9\u51fa\u7684\u9650\u5236\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u9650\u5236 DP \u7684\u8f6c\u79fb\u3002\u5206\u5f00\u8003\u8651\uff1a   \n&emsp;&emsp;\u5148\u8003\u8651 LCA \u7684\u9650\u5236\u7b49\u4ef7\u4e8e\uff1a   \n&emsp;&emsp;1. \u5bf9\u4e8e\u6811 $(u, S)$\uff0c\u5982\u679c\u5b58\u5728 $k$ \uff0c\u4f7f\u5f97 $c_k=u$ \uff0c\u90a3\u4e48 $a_i,b_i$ \u4e0d\u80fd\u5728\u540c\u4e00\u4e2a\u5b50\u6811\u5185\uff0c\u5373\u4e0d\u80fd\u8fdb\u884c $a_i\\in T\\land b_i\\in T$ \u7684\u8f6c\u79fb\u3002   \n&emsp;&emsp;2. \u5bf9\u4e8e\u8f6c\u79fb\u7684\u5b50\u6811 $(v, T)$\uff0c \u5982\u679c\u5b58\u5728 $k$ \uff0c\u4f7f\u5f97 $c_k\\in T$ \uff0c\u90a3\u4e48 $a_i,b_i$ \u4e5f\u5e94\u8be5\u5728 $(v,T)$ \u91cc\u9762\uff0c\u5373\u4e0d\u80fd\u8fdb\u884c $a_i\\not\\in T\\lor b_i\\not\\in T$ \u7684\u8f6c\u79fb\u3002     \n&emsp;&emsp;\u518d\u8003\u8651\u8fb9\u7684\u9650\u5236\u3002\u4e00\u6761\u8fb9$(u,v)$\u540c\u65f6\u5305\u542b\u4e86 *$u$ \u662f $v$ \u7684\u7236\u4eb2* \u548c *$v$ \u662f $u$ \u7684\u7236\u4eb2* \u4e24\u79cd\u60c5\u51b5\uff0c\u800c\u524d\u8005\u5728 $f(u,S)$ \u4e2d\u8ba1\u7b97\uff0c\u540e\u8005\u5728 $f(v,S)$ \u4e2d\u8ba1\u7b97\u3002\u6545\u8f6c\u79fb\u4e2d\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651 $u$ \u4f5c\u4e3a\u7236\u4eb2\u7684\u60c5\u51b5\u3002      \n&emsp;&emsp;\u56e0\u800c\u4e00\u6761\u8fb9\u7b49\u4ef7\u4e8e\uff1a    \n&emsp;&emsp;3. \u5bf9\u4e8e\u6811 $(u,S)$\uff0c\u5982\u679c\u4e0d\u5b58\u5728 $k$ \u4f7f\u5f97 $u$ \u5728\u9650\u5236\u8fb9 $E_k=(x,y)$ \u4e0a\uff0c\u90a3\u4e48\u8f6c\u79fb\u7684\u5b50\u6811\u4e2d\uff0c\u8981\u4e48 $x\\not\\in T\\land y\\not \\in T$ \uff0c\u8981\u4e48 $x\\in T\\land y\\in T$ \u3002    \n&emsp;&emsp;4. \u5bf9\u4e8e\u6811 $(u,S)$\uff0c\u5982\u679c\u5b58\u5728 $k$ \uff0c\u4f7f\u5f97 $u$ \u5728\u9650\u5236\u8fb9 $E_k=(u,w)$ \u4e0a\uff0c\u90a3\u4e48\u8f6c\u79fb\u7684\u5b50\u6811**\u53ea\u80fd**\u662f $(w, T)$ \uff0c\u800c\u4e14 $T$ \u91cc\u9762**\u53ea\u80fd\u5305\u542b $w$ \u4e00\u4e2a\u4e0e $u$ \u6709\u5173\u7684\u9650\u5236\u8fb9\u7aef\u70b9**\u3002      \n&emsp;&emsp;\u5728\u8f6c\u79fb\u4e2d\u9014\u5224\u65ad\u4e00\u4e0b\u5373\u53ef\u3002\u540c\u6837\u7684\u9053\u7406\uff0c\u5199\u72b6\u538b\u5c3d\u91cf\u8bb0\u641c\uff0c\u56e0\u4e3a\u72b6\u6001\u7684\u9636\u6bb5\u901a\u5e38\u662f\u7531 $|S|$ \u5212\u5206\u7684\u3002   \n&emsp;&emsp;\u65f6\u95f4\u662f $O(3^nk(n+m+q))$ \u3002 ~~CF \u673a\u5b50\u662f\u51fa\u4e86\u540d\u7684\u5feb\u3002~~   \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cstring>\n\ntypedef long long LL;\n\nconst int MAXN = 15, MAXM = 105, MAXS = ( 1 << 13 ) + 5;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\nLL f[MAXN][MAXS];\nint LCARis[MAXM], LCAc[MAXM];\nint Eu[MAXM], Ev[MAXM], ERis[MAXN];\nint bit[MAXS], ref[MAXN];\nint N, M, Q;\n\nint mono( const int u ) { return 1 << u - 1; }\nint lowbit( const int x ) { return x & ( -x ); }\nint inter( const int S, const int T ) { return S & T; }\nbool chk( const int S ) { return ! ( S - lowbit( S ) ); }\nbool in( const int S, const int T ) { return ( S & T ) == T; }\nbool onE( const int u, const int id ) { return Eu[id] == u || Ev[id] == u; }\n\nLL DFS( const int u, const int S )\n{\n\tLL& ret = f[u][S];\n\n\tif( ~ ret ) return ret; ret = 0;\n\tif( ! in( S, ref[u] ) ) return ret = 0;\n\t\n\tint pos; bool flag;\n\tfor( pos = 1 ; pos <= N ; pos ++ ) \n\t\tif( pos ^ u && in( S, ref[pos] ) ) break;\n\tfor( int T = ( S - 1 ) & S ; T ; T = ( T - 1 ) & S )\n\t\tif( in( T, ref[pos] ) && ! in( T, ref[u] ) )\n\t\t{\n\t\t\tflag = true;\n\t\t\tfor( int i = 1 ; i <= Q ; i ++ )\n\t\t\t\tif( LCAc[i] == u && in( T, LCARis[i] ) )\n\t\t\t\t\t{ flag = false; break; }\n                        //\u5904\u7406\u9650\u5236 1\n\t\t\tif( ! flag ) continue;\n\t\t\tfor( int i = 1 ; i <= Q ; i ++ )\n\t\t\t\tif( in( T, ref[LCAc[i]] ) && ! in( T, LCARis[i] ) )\n\t\t\t\t\t{ flag = false; break; }\n                        //\u5904\u7406\u9650\u5236 2\n\t\t\tif( ! flag ) continue;\n\t\t\tfor( int i = 1 ; i <= M ; i ++ )\n\t\t\t\tif( ! onE( u, i ) && ( in( T, ref[Eu[i]] ) ^ in( T, ref[Ev[i]] ) ) )\n\t\t\t\t\t{ flag = false; break; }\n                        //\u5904\u7406\u9650\u5236 3\n\t\t\tif( ! flag ) continue;\n\t\t\tif( ! inter( T, ERis[u] ) )\n\t\t\t{\n\t\t\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\t\t\tif( in( T, ref[i] ) )\n\t\t\t\t\t\tret += DFS( u, S ^ T ) * DFS( i, T );\n\t\t\t}\n                        //\u5982\u679c\u4e0d\u5305\u542b\u4efb\u4f55\u9650\u5236\u8fb9\u5c31\u679a\u4e3e\u6839\u8fdb\u884c\u8f6c\u79fb\n\t\t\telse if( chk( T & ERis[u] ) )\n\t\t\t\tret += DFS( u, S ^ T ) * DFS( bit[lowbit( T & ERis[u] )], T );\n                        //\u5426\u5219\u9700\u8981\u94a6\u5b9a\u6839\u8f6c\u79fb  \n\t\t}\n\treturn ret;\n}\n\nint main()\n{\n\tread( N ), read( M ), read( Q );\n\tmemset( f, -1, sizeof f );\n\tfor( int i = 1 ; i <= N ; i ++ ) f[i][1 << i - 1] = 1, bit[ref[i] = ( 1 << i - 1 )] = i;\n\tfor( int i = 1 ; i <= M ; i ++ ) \n\t\tread( Eu[i] ), read( Ev[i] ), \n\t\tERis[Eu[i]] |= ref[Ev[i]], ERis[Ev[i]] |= ref[Eu[i]];\n\tfor( int i = 1, a, b ; i <= Q ; i ++ ) \n\t\tread( a ), read( b ), read( LCAc[i] ), \n\t\tLCARis[i] = ref[a] | ref[b];\n\twrite( DFS( 1, ( 1 << N ) - 1 ) ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1595993606,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[CF599E] Sandy and Nuts"
    },
    {
        "content": "> Codeforces 599E\n\n> \u9898\u610f\uff1a\u6709\u4e00\u68f5\u4ee5 $1$ \u4e3a\u6839\u7684\u6811\u3002\u4f60\u5fd8\u8bb0\u4e86\u5b83\u7684\u5f62\u6001\uff0c\u53ea\u8bb0\u5f97 $m$ \u6761\u8fb9 $(u_i,v_i)$\uff0c\u548c $k$ \u6761\u5f62\u5982 \" $a_i$ \u548c $b_i$ \u7684 LCA \u4e3a $c_i$ \u7684\u9650\u5236\u3002\u6c42\u6709\u591a\u5c11\u68f5\u7b26\u5408\u8981\u6c42\u7684\u6811\u3002\n\n> $1 \\leq n,m \\leq 13$\uff0c$1 \\leq k \\leq 100$\n\n\u8fd9\u9053\u9898\u5206\u660e\u6709\u4e9b\u6bd2\u7624\u4e3a\u4ec0\u4e48 CF \u4e0a\u96be\u5ea6\u53ea\u6709 2100\uff1f/yiw\n\n\u9996\u5148\u770b\u5230 $1 \\leq n \\leq 13$ \u5c31\u53ef\u4ee5\u60f3\u5230\u72b6\u538b $dp$\u3002\n\n\u8bbe $dp[i][j]$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u5305\u542b\u4e86\u72b6\u6001\u96c6\u5408\u4e3a $j$ \u7684\u5408\u6cd5\u7684\u6811\u7684\u4e2a\u6570\u3002$j$ \u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\uff0c\u7b2c $0$ \u4f4d\uff08\u6700\u4f4e\u4f4d\uff09\u4e3a $1$ \u8868\u793a\u8282\u70b9 $1$ \u5728\u72b6\u6001\u96c6\u5408\u4e2d\uff0c\u7b2c $1$ \u4f4d\u4e3a $1$ \u8868\u793a\u8282\u70b9 $2$ \u5728\u72b6\u6001\u96c6\u5408\u4e2d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n- $dp[i][j]=dp[v][k] \\times dp[i][j\\  \\operatorname{xor}\\ k]$\n\n\u5176\u4e2d $k$ \u662f $j$ \u7684\u5b50\u96c6\u3002\n\n\u7531\u4e8e\u9898\u76ee\u5bf9\u4e8e\u8fb9\u548c $lca$ \u6709\u9650\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u60f3\u600e\u4e48\u8f6c\u79fb\u5c31\u600e\u4e48\u8f6c\u79fb\uff08\u5e9f\u8bdd\uff09\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5224\u65ad\u5408\u6cd5\u6027\uff1a\n\n\u90a3\u4e48\u6709\u4ee5\u4e0b\u56db\u79cd\u60c5\u51b5\u662f\u4e0d\u5408\u6cd5\u7684\uff1a\n\n1. \u5bf9\u4e8e\u9898\u76ee\u4e2d\u7ed9\u5b9a\u7684\u8fb9\uff0c\u5982\u679c\u6ee1\u8db3\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u662f $i$\uff0c\u53e6\u4e00\u4e2a\u7aef\u70b9\u5c5e\u4e8e\u72b6\u6001\u96c6\u5408 $k$ \u5f53\u4e2d\uff0c\u8fd9\u6837\u7684\u8fb9\u7684\u4e2a\u6570 $\\geq 2$\uff0c\u90a3\u4e48\u5c31\u662f\u4e0d\u5408\u6cd5\u7684\u3002\u539f\u56e0\u662f\uff1a$i$ \u53ea\u80fd\u8ddf\u96c6\u5408 $k$ \u5f53\u4e2d\u7684\u4e00\u4e2a\u70b9\u8fde\u8fb9\uff0c\u90a3\u4e2a\u70b9\u5c31\u662f $v$\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $i,j$ \u4e4b\u540e\uff0c\u5916\u5c42\u679a\u4e3e $k$\uff0c\u518d\u770b\u770b\u6709\u51e0\u6761\u8fb9\u6ee1\u8db3\u6761\u4ef6\u3002\u5982\u679c\u6709\u4e00\u6761\u8fb9\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48 $v$ \u53ea\u80fd\u7b49\u4e8e\u90a3\u6761\u8fb9\u7684\u53e6\u4e00\u4e2a\u7aef\u70b9\u3002\u5426\u5219\u5185\u5c42\u679a\u4e3e $v$ \u7136\u540e\u8f6c\u79fb\u3002\n\n2. \u5bf9\u4e8e\u9898\u76ee\u4e2d\u7ed9\u5b9a\u7684\u8fb9 $(x,y)$\uff0c\u5982\u679c $x \\neq i$\uff0c$v \\neq i$\uff0c\u4f46\u662f $u$ \u5728 $k$ \u4e2d\uff0c$v$ \u4e0d\u5728 $k$ \u4e2d\uff0c\u8fd9\u79cd\u6761\u4ef6\u4e5f\u662f\u4e0d\u5408\u6cd5\u7684\u3002\u56e0\u4e3a\u9664\u4e86 $i$ \u4e4b\u5916\uff0c\u96c6\u5408 $k$ \u4e2d\u7684\u70b9\u4e0d\u80fd\u8ddf\u4e0d\u5728\u96c6\u5408 $k$ \u4e2d\u7684\u70b9\u4e4b\u95f4\u6709\u8fb9\u3002\n\n3. \u5bf9\u4e8e LCA \u7684\u9650\u5236 $(a,b,c)$\uff0c\u5982\u679c $c$ \u5728\u96c6\u5408 $k$ \u4e2d\uff0c\u4f46\u662f $a$ \u6216 $b$ \u4e0d\u5728\uff0c\u90a3\u4e48\u5c31\u4e0d\u884c\u3002\u8fd9\u4e2a\u5e94\u8be5\u662f\u6700\u597d\u7406\u89e3\u7684\u4e86\u3002\n\n4. \u5bf9\u4e8e LCA \u7684\u9650\u5236 $(a,b,c)$\uff0c\u5982\u679c $c=i$\uff0c\u4f46\u662f $a,b$ \u90fd\u5728 $k$ \u4e2d\u4e5f\u4e0d\u884c\u3002\u56e0\u4e3a\u8fd9\u6837\u4e00\u6765 $lca(a,b)$ \u4e00\u5b9a\u662f $k$ \u4e2d\u7684\u53e6\u5916\u4e00\u4e2a\u70b9\u800c\u4e0d\u662f $i$ \u4e86\u3002\n\n\u8fb9\u754c $dp[i+1][2^{i}]=1$\n\n\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f $dp[1][2^n-1]$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a\u679a\u4e3e\u5b50\u96c6 $3^n$\uff0c\u5185\u5c42\u679a\u4e3e $v$ \u5e76\u5224\u65ad\u6700\u574f\u662f $nk$ \u7684\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u662f $\\mathcal O(nk3^n)$\n\n\u6ce8\u610f\u4e8b\u9879\uff1a\n\n1. \u7531\u4e8e $dp[i][j\\ \\operatorname{xor}\\ k]$\uff0c\u4f1a\u8f6c\u79fb\u5230 $dp[i][j]$\uff0c\u6240\u4ee5\u9700\u8981\u5916\u5c42\u679a\u4e3e $j$\uff0c\u5185\u5c42\u679a\u4e3e $i$\n\n2. \u5bf9\u4e8e\u540c\u4e00\u68f5\u6811\uff0c\u6211\u4eec\u679a\u4e3e\u4e86\u4e00\u6b21\u5b83\u7684\u7b2c\u4e00\u68f5\u5b50\u6811\uff0c\u63a5\u7740\u53c8\u679a\u4e3e\u4e86\u5b83\u7b2c\u4e8c\u68f5\u5b50\u6811\uff0c\u8fd9\u6837\u540c\u4e00\u68f5\u6811\u4f1a\u88ab\u91cd\u590d\u8ba1\u7b97\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u4efb\u53d6\u4e00\u4e2a $j$ \u4e2d\u4e0e $i$ \u4e0d\u76f8\u7b49\u7684\u70b9 $fst$\uff0c\u5e76\u5f3a\u5236\u5b83\u5728 $msk$ \u4e2d\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u91cd\u590d\u8ba1\u7b97\u4e86\u3002\n\n~~\u5199\u9898\u89e3\u4e0d\u5bb9\u6613\uff0c\u7ed9\u4e2a\u8d5e\u5457~~\n\n```cpp\n//Coded by tzc_wk\n/*\n\u6570\u636e\u4e0d\u6e05\u7a7a\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u591a\u6d4b\u4e0d\u8bfb\u5b8c\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8fb9\u754c\u4e0d\u7279\u5224\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d2a\u5fc3\u4e0d\u8bc1\u660e\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\nD P \u987a\u5e8f\u9519\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u5927\u5c0f\u5c11\u7b49\u53f7\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u53d8\u91cf\u4e0d\u7edf\u4e00\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d8a\u754c\u4e0d\u5224\u65ad\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8c03\u8bd5\u4e0d\u6ce8\u91ca\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u6ea2\u51fa\u4e0d l l\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n*/\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi\t\t\tfirst\n#define se\t\t\tsecond\n#define fz(i,a,b)\tfor(int i=a;i<=b;i++)\n#define fd(i,a,b)\tfor(int i=a;i>=b;i--)\n#define foreach(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define all(a)\t\ta.begin(),a.end()\n#define giveup(...) return printf(__VA_ARGS__),0;\n#define fill0(a)\tmemset(a,0,sizeof(a))\n#define fill1(a)\tmemset(a,-1,sizeof(a))\n#define fillbig(a)\tmemset(a,0x3f,sizeof(a))\n#define fillsmall(a) memset(a,0xcf,sizeof(a))\n#define mask(a)\t\t(1ll<<(a))\n#define maskx(a,x)\t((a)<<(x))\n#define _bit(a,x)\t(((a)>>(x))&1)\n#define _sz(a)\t\t((int)(a).size())\n#define filei(a)\tfreopen(a,\"r\",stdin);\n#define fileo(a)\tfreopen(a,\"w\",stdout);\n#define fileio(a) \tfreopen(a\".in\",\"r\",stdin);freopen(a\".out\",\"w\",stdout)\n#define eprintf(...) fprintf(stderr,__VA_ARGS__)\n#define put(x)\t\tputchar(x)\n#define eoln        put('\\n')\n#define space\t\tput(' ')\n#define y1\t\t\ty_chenxiaoyan_1\n#define y0\t\t\ty_chenxiaoyan_0\n#define int long long\ntypedef pair<int,int> pii;\ninline int read(){\n\tint x=0,neg=1;char c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-')\tneg=-1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c))\tx=x*10+c-'0',c=getchar();\n\treturn x*neg;\n}\ninline void print(int x){\n\tif(x<0){\n\t\tputchar('-');\n\t\tprint(abs(x));\n\t\treturn;\n\t}\n\tif(x<=9)\tputchar(x+'0');\n\telse{\n\t\tprint(x/10);\n\t\tputchar(x%10+'0');\n\t}\n}\ninline int qpow(int x,int e,int _MOD){\n\tint ans=1;\n\twhile(e){\n\t\tif(e&1)\tans=ans*x%_MOD;\n\t\tx=x*x%_MOD;\n\t\te>>=1;\n\t}\n\treturn ans;\n}\nint n=read(),m=read(),q=read();\nint a[105],b[105],c[105],u[15],v[15];\nvector<int> g[15];\nint dp[14][8193];\nsigned main(){\n\tfz(i,1,m)\tu[i]=read(),v[i]=read(),g[u[i]].push_back(v[i]),g[v[i]].push_back(u[i]);\n\tfz(i,1,q)\ta[i]=read(),b[i]=read(),c[i]=read();\n\tfor(int j=0;j<(1<<n);j++){\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tif(__builtin_popcount(j)==1&&_bit(j,i-1)){\n\t\t\t\tdp[i][j]=1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(!_bit(j,i-1))\tcontinue;\n\t\t\tint msk=j-mask(i-1);\n\t\t\tint fst=0;\n\t\t\tfor(int t=1;t<=n;t++)\n\t\t\t\tif(_bit(msk,t-1)){\n\t\t\t\t\tfst=t;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n//\t\t\tcout<<msk<<endl;\n//\t\t\tcout<<\"fst=\"<<fst<<endl;\n\t\t\tfor(int k=msk;k;k=msk&(k-1)){\n\t\t\t\tif(_bit(k,fst-1)){\n\t\t\t\t\tint l=k^j;\n\t\t\t\t\tint cnt=0,s=0;\n\t\t\t\t\tforeach(it,g[i]){\n\t\t\t\t\t\tint p=*it;\n\t\t\t\t\t\tif(_bit(k,p-1))\ts=p,cnt++;\n\t\t\t\t\t}\n\t\t\t\t\tif(cnt>=2)\tcontinue;\n\t\t\t\t\tbool flag=1;\n\t\t\t\t\tfor(int p=1;p<=m;p++){\n\t\t\t\t\t\tif(u[p]==i||v[p]==i)\tcontinue;\n\t\t\t\t\t\tif(_bit(k,u[p]-1)&&!_bit(k,v[p]-1))\tflag=0;\n\t\t\t\t\t\tif(_bit(k,v[p]-1)&&!_bit(k,u[p]-1))\tflag=0;\n\t\t\t\t\t}\n\t\t\t\t\tfor(int r=1;r<=q;r++){\n\t\t\t\t\t\tif(_bit(k,c[r]-1)&&(!_bit(k,a[r]-1)||!_bit(k,b[r]-1)))\tflag=0;\n\t\t\t\t\t\tif(c[r]==i&&_bit(k,a[r]-1)&&_bit(k,b[r]-1))\t\t\t\tflag=0;\n\t\t\t\t\t}\n\t\t\t\t\tif(!flag)\tcontinue;\n//\t\t\t\t\tint tmp=dp[i][j];\n\t\t\t\t\tif(!cnt){\n\t\t\t\t\t\tfor(int o=1;o<=n;o++){\n\t\t\t\t\t\t\tif(i!=o&&_bit(k,o-1))\tdp[i][j]+=dp[i][l]*dp[o][k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tdp[i][j]+=dp[i][l]*dp[s][k];\n\t\t\t\t\t}\n//\t\t\t\t\tcout<<i<<\" \"<<j<<\" \"<<k<<\" \"<<dp[i][j]-tmp<<endl;\n\t\t\t\t}\n\t\t\t}\n//\t\t\tcout<<i<<\" \"<<j<<\" \"<<dp[i][j]<<endl;\n\t\t}\n\t}\n\tcout<<dp[1][(1<<n)-1]<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1584503899,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF599E \u3010Sandy and Nuts\u3011"
    },
    {
        "content": " \u9898\u76ee \uff1a  \n \u6709\u4e00\u68f5 $ n $ \u4e2a\u6709\u6807\u53f7\u8282\u70b9\u7684\u6811\uff0c\u6839\u8282\u70b9\u4e3a 1\uff0c\u6709 $ m $ \u6761\u8fb9\u5df2\u7ecf \u88ab\u786e\u5b9a\uff0c\u53e6\u6709 $ q $ \u9650\u5236\uff0c\u5f62\u5f0f\u4e3a\uff1a\u8282\u70b9 $a_i $ \u4e0e  $ b_i $ \u7684 $ LCA  $ \u4e3a $c_ i$ \u4f60\u9700\u8981\u6c42\u51fa\u8fd9\u68f5\u6811\u6709\u591a\u5c11\u79cd\u4e0d\u540c\u7684\u53ef\u80fd\u5f62\u6001 $n \u2264 13, q \u2264 100$\n \n \n\n\n------------\n\u770b\u5230 $ n $ \u7684\u8303\u56f4\uff0c\u60f3\u72b6\u538b\n\n\n- \u4ee4  $ f_{rt,msk} $ \u8868\u793a\u6839\u8282\u70b9\u4e3a  $ rt $ ,\u5b50\u6811\u4e2d\u7684\u70b9\u96c6\u4e3a  $ msk $ \uff0c\u8fd9\u68f5\u5b50\u6811\u4e2d\u6709\u591a\u5c11\u4e0d\u540c\u7684\u65b9\u6848\n\n- \u8f6c\u79fb\u5f62\u5f0f \u5927 \u81f4 \uff1a  $ f_{rt,msk} =  \\sum _{x\\in msk} f_{rtx,x} *  f_{t,msk-x} $  \n\n- \u5373\u6bcf\u6b21\u627e\u51fa $ rt $ \u7684\u4e00\u4e2a\u513f\u5b50\u5b50\u6811\uff0c\u7136\u540e\u53bb\u6389\u8fd9\u4e2a\u5b50\u6811\u4ee5\u540e\u5269\u4e0b\u7684\u8fd8\u662f\u4ee5 $ rt $ \u4e3a\u6839\u7684\u5b50\u6811\u3002\n\n  \u4e3a\u4e86\u9632\u6b62\u91cd\u590d\u8ba1\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5f3a\u5236  $ x $ \u5305\u542b   $ msk $ \u4e2d\u6700\u5c0f\u7684\u8282\u70b9\u3002\n\n\n\n\u63a5\u4e0b\u6765\u8003\u8651\u9650\u5236\u6761\u4ef6\n\n- \u5bf9\u4e8e\u5f3a\u5236\u8fde\u8fb9\uff0c\u5982\u679c $ rt $ \u548c $ msk $ \u4e2d\u7684\u4e00\u4e2a\u70b9 $ v $ \u8981\u5f3a\u5236\u8fde\u8fb9\uff0c\u90a3\u4e48\u8f6c\u79fb\u65f6\u5982\u679c  $ v\\in x $  ,\u90a3\u4e48 rtx\u5fc5\u987b\u4e3a $ v $\n\n- \u5bf9\u4e8e $ lca $ \u7684\u9650\u5236\uff0c\u5982\u679c\u6709\u4e00\u7ec4\u9650\u5236\u8981\u6c42  $ u,  v $  \u7684 $ lca $ \u4e3a $ rt $ \uff0c  \u90a3\u4e48 $ u, v\\in rt $ \u5fc5\u987b\u6ee1\u8db3\uff0c\u800c\u4e14$ u, v $\u5728\u4e0a\u8ff0\u8f6c\u79fb\u4e2d\u4e0d\u80fd\u540c \u65f6\u5c5e\u4e8e $ x $\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $ O(3^n \u2217 poly(n, m, q)) $\uff0c\u5176\u4e2d $ poly(n, m, q) $ \u8868 \u793a\u53ea\u4e0e   n, m, q  \u6709\u5173\u7684\u591a\u9879\u5f0f\u590d\u6742\u5ea6.  \n\n\n###### \u4ee3\u7801\u7565\n\n",
        "postTime": 1633258930,
        "uid": 130114,
        "name": "Hehe_0",
        "ccfLevel": 0,
        "title": "CF599E"
    }
]