[
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/CF1455G)\n\n## \u9898\u610f\n\u6709 $n$ \u884c\u6307\u4ee4\uff0c\u4f60\u9700\u8981\u4f9d\u6b21\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4\u3002\n\n\u521d\u59cb\u65f6\uff0c\u4f60\u6709\u4e00\u4e2a\u53d8\u91cf $x=0$\uff0c\u5171\u6709\u4e09\u79cd\u6307\u4ee4\uff1a\n1. `set y v`\uff0c\u4ee4 $x\\gets y$\uff0c\u6216\u7528 $v$ \u7684\u4ee3\u4ef7\u5220\u53bb\u8fd9\u6761\u6307\u4ee4\uff1b\n2. `if y`\uff0c\u5982\u679c $x=y$\uff0c\u5219\u6267\u884c\u5176\u8303\u56f4\u5185\u7684\u6307\u4ee4\uff0c\u5426\u5219\u8df3\u8fc7\u5176\u8303\u56f4\u5185\u7684\u6307\u4ee4\uff1b\n3. `end`\uff0c\u7528\u4e8e\u58f0\u660e\u4e0a\u4e00\u4e2a\u8fd8\u672a\u58f0\u660e\u8303\u56f4\u7684 `if` \u6307\u4ee4\u7684\u8303\u56f4\u3002\n\n\u7ed9\u4e00\u4e2a\u6570 $s$\uff0c\u6c42\u7528\u6700\u5c11\u7684\u4ee3\u4ef7\u4f7f\u5f97\u6ca1\u6709\u4e00\u4e2a\u65f6\u523b $x=s$\u3002\n\n$n\\le 2\\times 10^5$\uff0c$s,y\\le 2\\times 10^5$\u3002\n## \u601d\u8def\n\u8003\u8651\u5c06\u6307\u4ee4\u770b\u6210\u6811\u5f62\u7ed3\u6784\uff0c\u5c06\u6bcf\u6761\u6307\u4ee4\u770b\u4e3a\u76f4\u5c5e\u7684 `if` \u6307\u4ee4\u7684\u5b50\u8282\u70b9\u3002\u8fd9\u6837\u5b50\u662f\u4e00\u4e2a\u68ee\u6797\uff0c\u5728\u6700\u5916\u5c42\u8865\u4e0a `if 0 end` \u5c06\u5176\u8f6c\u6210\u6811\u3002\n\n\u8003\u8651\u6811\u5f62 dp\uff0c\u5148\u5c06\u6240\u6709 `set` \u64a4\u9500\uff0c\u4ee3\u4ef7\u6302\u5728\u7236\u8282\u70b9\u4e0a\uff0c\u4ee4 $dp_{i,j}$ \u8868\u793a\u6267\u884c $i$ \u5b50\u6811\u5185\u7684\u6307\u4ee4\uff0c\u6700\u7ec8 $x=j$ \u80fd\u64a4\u9500\u7684\u6700\u591a\u4ee3\u4ef7\u3002\n\n\u76f4\u63a5\u505a\u662f\u5f88\u4e0d\u4f18\u79c0\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0 $j$ \u7684\u53d6\u503c\u53ea\u6709 $i$ \u5b50\u6811\u5185 $y$ \u7684\u53d6\u503c\u8303\u56f4\uff0c\u5e76\u4e14 $i$ \u7684\u53d6\u503c\u8303\u56f4\u662f\u6240\u6709\u5b50\u8282\u70b9\u53d6\u503c\u8303\u56f4\u7684\u5e76\uff0c\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u542f\u53d1\u5f0f\u5408\u5e76\u3002\n\n\u5bf9\u6bcf\u4e2a\u7ed3\u70b9\u5f00 `map` \u548c `multiset` \u5206\u522b\u5b58\u50a8 $dp$ \u6570\u7ec4\u548c\u5feb\u901f\u4fee\u6539\u8ba1\u7b97 $dp_{i,k}$ \u7684\u6700\u5c0f\u503c\u3002\u6ce8\u610f\u5728\u542f\u53d1\u5f0f\u5408\u5e76\u5c06\u7236\u8282\u70b9\u5408\u5e76\u5230\u5b50\u8282\u70b9\u65f6\u5b50\u8282\u70b9\u7684 $dp$ \u503c\u90fd\u672a\u52a0\u4e0a\u5176\u5144\u5f1f\u7ed3\u70b9\u7684\u8d21\u732e\uff0c\u5f00\u4e2a\u8f85\u52a9\u6570\u503c\u8bb0\u5f55\u5168\u5c40\u52a0 tag \u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nnamespace IO{//by cyffff\n\t\n}\nconst int N=2e5+10;\nint n,s,res,f[N],t[N],v[N],p[N];\nll d[N];//\u5b50\u8282\u70b9\u64a4\u9500\u4ef7\u683c\u4e4b\u548c \nvector<int>a[N];\nmap<int,ll>dp[N];//\u53ef\u4ee5\u64a4\u9500\u7684\u8d21\u732e \nmultiset<ll>mn[N];\ninline void dfs(int x){\n\tmn[x].insert(dp[x][p[x]]=0);\n\tfor(auto to:a[x]){\n\t\tif(t[to]==1){\n\t\t\tif(p[to]!=s){\n\t\t\t\tif(dp[x].count(p[to])){\n\t\t\t\t\tll tmp=dp[x][p[to]];\n\t\t\t\t\tdp[x][p[to]]=(*mn[x].begin())-v[to];\n\t\t\t\t\tmn[x].erase(mn[x].find(tmp));\n\t\t\t\t}else{\n\t\t\t\t\tdp[x][p[to]]=(*mn[x].begin())-v[to];\n\t\t\t\t}\n\t\t\t\tmn[x].insert(dp[x][p[to]]);\n\t\t\t}\n\t\t\td[x]+=v[to];\n\t\t}else if(dp[x].count(p[to])){\n\t\t\tdfs(to);\n\t\t\tll tmp=dp[x][p[to]]+d[to];\n\t\t\tif(dp[to].size()<=dp[x].size()){\n\t\t\t\tfor(auto it:dp[to]){\n\t\t\t\t\tint val=it.first;\n\t\t\t\t\tll cst=it.second;\n\t\t\t\t\tif(!dp[x].count(val)) dp[x][val]=tmp+cst;\n\t\t\t\t\telse{\n\t\t\t\t\t\tmn[x].erase(mn[x].find(dp[x][val]));\n\t\t\t\t\t\tif(val==p[to]) dp[x][val]=tmp+cst;\n\t\t\t\t\t\telse dp[x][val]=min(dp[x][val],tmp+cst);\n\t\t\t\t\t}\n\t\t\t\t\tmn[x].insert(dp[x][val]);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\td[x]+=tmp;//\u5168\u4f53 +tmp \u4e0d\u597d\u5904\u7406 \u52a0\u5728 d \u4e0a\n\t\t\t\tfor(auto it:dp[x]){\n\t\t\t\t\tint val=it.first;\n\t\t\t\t\tll cst=it.second;\n\t\t\t\t\tif(!dp[to].count(val)) dp[to][val]=-tmp+cst;\n\t\t\t\t\telse{\n\t\t\t\t\t\tmn[to].erase(mn[to].find(dp[to][val]));\n\t\t\t\t\t\tif(val!=p[to]) dp[to][val]=min(dp[to][val],-tmp+cst);\n\t\t\t\t\t}\n\t\t\t\t\tmn[to].insert(dp[to][val]);\n\t\t\t\t}\n\t\t\t\tswap(dp[x],dp[to]);\n\t\t\t\tswap(mn[x],mn[to]);\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){\n\tn=read(),s=read();\n\tfor(int i=1;i<=n;i++){\n\t\tchar opt=getc();\n\t\tif(opt=='s'){\n\t\t\ta[res].push_back(i);\n\t\t\tt[i]=1,p[i]=read(),v[i]=read();\n\t\t}else if(opt=='i'){\n\t\t\tp[i]=read();\n\t\t\ta[res].push_back(i);\n\t\t\tt[i]=2,f[i]=res,res=i;\n\t\t}else{\n\t\t\tres=f[res];\n\t\t\tgetc(),getc();\n\t\t}\n\t}\n\tdfs(0);\n\twrite(d[0]+(*mn[0].begin()));\n\tflush();\n}\n```\n\u518d\u89c1 qwq~",
        "postTime": 1657676629,
        "uid": 365127,
        "name": "cyffff",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1455G\u3010Forbidden Value\u3011"
    },
    {
        "content": "\u5c0f\u6e05\u65b0\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u4f18\u5316 dp \u9898\u3002\n\n\u9996\u5148\u9898\u76ee\u4e2d\u7684 `if` \u5d4c\u5957\u770b\u8d77\u6765\u5c31\u5f88\u70e6\uff0c\u53ef\u4ee5\u8003\u8651\u5efa\u6811\uff0c\u5916\u9762\u518d\u5957\u4e00\u5c42\u5927\u7684 `if 0 ... end`\uff0c\u8fd9\u6837\u5c31\u5c06\u672c\u9898\u8f6c\u5316\u6210\u4e00\u4e2a\u6811\u4e0a\u95ee\u9898\u3002\n\n\u8003\u8651\u6811\u5f62 dp\u3002\u8bbe $f_{u,i}$ \u8868\u793a **\u4ece\u7ed3\u70b9 $u$ \u51fa\u6765\u65f6\uff0c$x$ \u7684\u503c\u662f $i$ \u7684\u6700\u5c11\u82b1\u8d39\u3002**\n\n\u4e0d\u96be\u8f6c\u79fb\uff1a\n\n- \u5bf9\u4e8e `set` \u547d\u4ee4\uff1a\n\n$\\begin{cases} f_{u,y} \\gets \\min\\limits_{i}{f_{u,i}} \\\\ f_{u,i} \\gets f_{u,i} + v & i \\neq y \\end{cases}$\n\n- \u5bf9\u4e8e `if` \u547d\u4ee4\uff1a\n\n$\\begin{cases} f_{u,y} \\gets f_{u,y} + f_{v,y} \\\\ f_{u,i} \\gets \\min(f_{u,i}, f_{u,y} + f_{v,i}) & i \\neq y \\end{cases}$\n\n\u6ce8\u610f\u8f6c\u79fb\u65f6 dp \u503c\u90fd\u662f\u540c\u65f6\u8ba1\u7b97\u3002\n\n\u76f4\u63a5\u66b4\u529b\u8f6c\u79fb\u663e\u7136\u662f $O(n^2)$ \u7684\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e2a\u7ed3\u70b9 $u$\uff0c\u771f\u6b63\u6709\u7528\u7684\u72b6\u6001\u53ea\u6709 $u$ \u5b50\u6811\u5185 $y$ \u7684\u53d6\u503c\u3002\u53ef\u4ee5\u8003\u8651\u5bf9\u6bcf\u4e2a\u7ed3\u70b9\u5f00\u4e00\u4e2a\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\uff0c\u5b58 $u$ \u7684\u6240\u6709\u72b6\u6001\u3002\u8f6c\u79fb\u65f6\u53ea\u9700\u5355\u70b9\u4fee\u6539\u3001\u6574\u4f53\u52a0\u548c\u5355\u70b9\u67e5\u8be2\uff0c\u5bf9\u4e8e `if` \u547d\u4ee4\u5927\u529b\u7ebf\u6bb5\u6811\u5408\u5e76\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n`map` + \u542f\u53d1\u5f0f\u5408\u5e76\u7684\u505a\u6cd5\u770b\u4e0d\u61c2\uff0c\u6211\u592a\u83dc\u4e86\u3002\n\n[code](https://codeforces.com/contest/1455/submission/174563133)",
        "postTime": 1664841162,
        "uid": 275273,
        "name": "zltqwq",
        "ccfLevel": 0,
        "title": "CF1455G \u9898\u89e3"
    },
    {
        "content": "\u5bf9\u6574\u4e2a\u5d4c\u5957if\u7684\u7a0b\u5e8f\u7ed3\u6784\u5efa\u6811\uff0c\u53f6\u5b50\u8282\u70b9\u5bf9\u5e94\u4e00\u4e2aset\u8bed\u53e5\uff0c\u975e\u53f6\u5b50\u7ed3\u70b9\u5bf9\u5e94\u4e00\u4e2aif\u7ed3\u6784\uff08\u5176\u5b50\u6811\u4e3aif\u5185\u5957\u7684\u4e1c\u897f\uff09\u3002\u6574\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u76f8\u5f53\u4e8e\u5957\u5728\u4e00\u4e2aif 0\u4e2d\uff0c\u5b83\u662f\u6839\u8282\u70b9\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4e00\u6bb5\u5957\u5728\u67d0\u4e2a$if$ $x_0$\u4e2d\u7684\u7a0b\u5e8f\uff08\u5373\u4e00\u68f5\u5b50\u6811\uff09\uff0c\u8fd9\u76f8\u5f53\u4e8e\u4e00\u4e2a\u51fd\u6570\uff0c**\u8f93\u5165\u662f\u5df2\u77e5\u7684\uff0c\u5c31\u662f$x_0$**\uff08\u8fd9\u4e2a\u6027\u8d28\u5f88\u5173\u952e\uff09\uff0c\u6709\u552f\u4e00\u4e00\u4e2a\u8f93\u51fa\uff0c\u90a3\u4e48\u5957\u8def\u7684\u4ee4$dp[i][j]$\u4e3a\uff0c\u53ea\u6267\u884c\u5b50\u6811i\u4e2d\u7684\u7a0b\u5e8f\uff0c\u8f93\u51fa\u4e3aj\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u663e\u7136\u8fd9\u4e2a\u4e0d\u80fd\u76f4\u63a5\u505a\uff0c\u4e0d\u96be\u60f3\u5230\u53ef\u4ee5\u628a\u8fd9\u4e2adp\u505a\u5230\u53ef\u5408\u5e76\u7684\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u91cc\uff08\u5373\u6574\u4f53dp\uff09\uff0c\u4e0b\u6807\u4e3a$j$\uff0c\u652f\u6301\u6253\u52a0\u6cd5\u6807\u8bb0\u4ee5\u53ca\u53d6\u6700\u5c0f\u503c\u3002\u5bf9\u4e8e\u6839\u7684\u67d0\u4e2a\u4e3a$set$ $x_0$\u7684\u513f\u5b50\uff0c\u8ba9\u7ebf\u6bb5\u6811\u4e0a$x_0$\u5904\u66f4\u65b0\u4e3a\u6574\u4f53\u6700\u5c0f\u503c\uff08\u6267\u884c\u8fd9\u6761\u8bed\u53e5\uff09\uff0c\u518d\u8ba9\u9664\u4e86$x_0$\u7684\u5730\u65b9\u52a0\u4e0a\u8bed\u53e5\u4ee3\u4ef7\uff08\u4e0d\u6267\u884c\u8fd9\u6761\u8bed\u53e5\uff09\u3002\u5bf9\u4e8e$if$ $x_0$\u7684\u513f\u5b50\uff0c\u628a\u81ea\u5df1\u539f\u6765\u7684$dp[x_0]$\u6574\u4f53\u52a0\u5230\u513f\u5b50\u7684\u7ebf\u6bb5\u6811\u4e0a\uff08\u5373\u8981\u6267\u884c\u5b50\u6811\u5185\u7684\u7a0b\u5e8f\u5fc5\u987b\u8ba9\u53d8\u91cf\u4e3a$x_0$\uff09\uff0c\u518d\u4e0e\u513f\u5b50\u7684\u7ebf\u6bb5\u6811\u5408\u5e76\uff0c\u8ba9\u5bf9\u5e94\u4f4d\u53d6min\u5373\u53ef\u3002$O(n\\log n)$\n\n\u6807\u7b97\u7528\u7684\u662fmap\u542f\u53d1\u5f0f\u5408\u5e76\uff0c\u8ddf\u7ebf\u6bb5\u6811\u5408\u5e76\u9053\u7406\u5927\u6982\u5dee\u4e0d\u591a\u3002\n\n\u4e0a\u4ee3\u7801~\n\n```cpp\n#pragma GCC optimize(2)\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<vector>\n#include<cstdlib>\n#define ll long long\n#define lim 200000\n#define N 200010\n#define M 9000000\n#define inf 1234567890987654ll\n#define add_s(_a,_b) _a=min(inf,_a+_b)\n#define up(_o) minn[_o]=min(minn[lef[_o]],minn[rgh[_o]])\nusing namespace std;\nnamespace ywy{\n\tinline int get(){\n\t\tint n=0;char c;while((c=getchar())||23333)if(c>='0'&&c<='9')break;\n\t\tn=c-'0';while((c=getchar())||23333){\n\t\t\tif(c>='0'&&c<='9')n=n*10+c-'0';else return(n);\n\t\t}\n\t}\n\tinline int sget(){\n\t\tchar c;while((c=getchar())||23333)if(c>='a'&&c<='z')break;\n\t\tif(c=='s'){\n\t\t\tgetchar();getchar();return(1);\n\t\t}if(c=='i'){\n\t\t\tgetchar();return(2);\t\n\t\t}getchar();getchar();return(3);\n\t}ll minn[M],adds[M];int lef[M],rgh[M],dp[N],gn=1,gtree=1;vector<int> vec[N];\n\tint val[N],cost[N];\n\tinline void down(int tree){\n\t\tll x=adds[tree];adds[tree]=0;\n\t\tadd_s(minn[lef[tree]],x);add_s(adds[lef[tree]],x);\n\t\tadd_s(minn[rgh[tree]],x);add_s(adds[rgh[tree]],x);\n\t}\n\tvoid dopt(int l,int r,int &tree,int pt,void (*p)(int)){\n\t\tif(!tree)tree=gn,gn++,minn[tree]=inf;\n\t\tif(l==r){p(tree);return;}int mid=(l+r)>>1;down(tree);\n\t\tif(pt<=mid)dopt(l,mid,lef[tree],pt,p);else dopt(mid+1,r,rgh[tree],pt,p);up(tree);\n\t}\n\tint united(int l,int r,int a,int b){\n\t\tif(!(a&&b))return(a|b);if(l==r){\n\t\t\tminn[a]=min(minn[a],minn[b]);return(a);\n\t\t}down(a);down(b);int mid=(l+r)>>1;lef[a]=united(l,mid,lef[a],lef[b]);\n\t\trgh[a]=united(mid+1,r,rgh[a],rgh[b]);up(a);return(a);\n\t}int danger,stk[N];ll upd;\n\tvoid none(int x){minn[x]=0;}\n\tvoid setp(int x){minn[x]=upd;}\n\tvoid update(int x){minn[x]=min(minn[x],upd);}\n\tll gpt(int l,int r,int tree,int pt){\n\t\tif(l==r)return(minn[tree]);down(tree);int mid=(l+r)>>1;\n\t\tif(pt<=mid)return(gpt(l,mid,lef[tree],pt));return(gpt(mid+1,r,rgh[tree],pt));\t\n\t}\n\tvoid dfs(int pt){\n\t\tdopt(0,lim,dp[pt],val[pt],none);\n\t\tfor(register int i=0;i<vec[pt].size();i++){\n\t\t\tint me=vec[pt][i];if(cost[me]==-1){\n\t\t\t\tll x=gpt(0,lim,dp[pt],val[me]);\n\t\t\t\tif(x<inf){\n\t\t\t\t\tdfs(me);minn[dp[me]]+=x;adds[dp[me]]+=x;\n\t\t\t\t\tupd=inf;dopt(0,lim,dp[pt],val[me],setp);\n\t\t\t\t\tdp[pt]=united(0,lim,dp[pt],dp[me]);\t\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tll m=minn[dp[pt]];adds[dp[pt]]+=cost[me];minn[dp[pt]]+=cost[me];\n\t\t\t\tif(val[me]!=danger){\n\t\t\t\t\tupd=m;dopt(0,lim,dp[pt],val[me],update);\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tvoid ywymain(){\n\t\tminn[0]=inf;int n=get(),sp=1;danger=get();\n\t\tfor(register int i=1;i<=n;i++){\n\t\t\tint op=sget();if(op==1){\n\t\t\t\tint me=gtree;gtree++;val[me]=get();cost[me]=get();\n\t\t\t\tvec[stk[sp-1]].push_back(me);\n\t\t\t}if(op==2){\n\t\t\t\tint me=gtree;gtree++;val[me]=get();cost[me]=-1;\n\t\t\t\tvec[stk[sp-1]].push_back(me);stk[sp]=me;sp++;\n\t\t\t}if(op==3)sp--;\n\t\t}dfs(0);cout<<minn[dp[0]]<<endl;\n\t}\n}\nsigned main(){\n\tywy::ywymain();return(0);\t\n}\n```",
        "postTime": 1607495405,
        "uid": 125124,
        "name": "ywy_c_asm",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1455G \u3010Forbidden Value\u3011"
    },
    {
        "content": "## Statement\n\n\u9898\u76ee\u5199\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u770b\u9898\u76ee\u7684\u7ffb\u8bd1\u5427\u3002\n\n## Solution\n\n\u8003\u8651 `if` \u6307\u4ee4\u5f62\u6210\u4e86\u4e00\u4e2a\u5d4c\u5957\u5173\u7cfb\uff0c\u662f\u4e00\u4e2a\u5c42\u5c42\u5305\u542b\u7684\u8fc7\u7a0b\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5c06\u6bcf\u4e2a `if` \u6307\u4ee4\u4e0e\u88ab\u4ed6\u5305\u542b\u7684\u6307\u4ee4\u4e4b\u95f4\u8fde\u8fb9\uff0c\u7136\u540e\u5728\u5f00\u5934\u52a0\u4e0a\u4e00\u4e2a\u6307\u4ee4 `if 0`\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5c06\u9898\u76ee\u6240\u793a\u7684\u5173\u7cfb\u5efa\u6210\u4e86\u4e00\u9897\u6811\u3002\n\n\u6211\u4eec\u73b0\u5728\u5e0c\u671b\u7684\u662f\uff0c\u5220\u9664\u67d0\u4e9b `set` \u64cd\u4f5c\uff0c\u7136\u540e\u4f7f\u5f97\u6700\u7ec8\u904d\u5386\u8fd9\u4e2a\u6811\u5e76\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\u540e\uff0c\u4efb\u610f\u65f6\u523b\u90fd\u4e0d\u4f1a\u4f7f $x= s$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u4ece\u4efb\u610f\u4e00\u68f5\u6811\u5f00\u59cb\u6267\u884c\u64cd\u4f5c\uff0c\u6700\u7ec8\u4ece\u8fd9\u4e2a\u6811\u4e2d\u64cd\u4f5c\u7ed3\u675f\u540e\uff0c\u5f97\u5230\u7684\u503c $x$\uff0c\u4e00\u5b9a\u4e3a\u5b50\u6811\u4e2d\u7684\u67d0\u4e2a `set y v` \u7684 $v$\u3002\n\n\u6ce8\u610f\u5230\u6700\u540e\u5f97\u5230\u67d0\u4e2a\u6570 $j$ \u4e14\u4e2d\u9014\u4e0d\u51fa\u73b0 $x = s$ \u4ee3\u8868\u7740\u64cd\u4f5c\u7684\u7ed3\u675f\uff0c\u6839\u636e\u8fd9\u4e2a\u5728\u6811\u4e0a\u505a\u4e00\u4e2a dp\uff0c\u8bbe $dp_{i,j}$ \u8868\u793a\u5728 $i$ \u7684\u5b50\u6811\u4e2d\uff0c\u5220\u9664\u82e5\u5e72\u64cd\u4f5c\u540e\u6700\u540e\u5f97\u5230\u7684 $x = j$ \u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u6bcf\u6b21\u5047\u5982\u5728\u6811\u4e0a\u78b0\u5230\u4e86\u53f6\u5b50\u8282\u70b9\u4e5f\u5c31\u662f `set y v` \u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5bf9\u4e8e $j \\neq y$ \u7684\u5168\u90e8\u90fd\u8981\u52a0\u4e0a\u503c $v$\uff0c\u5bf9\u4e8e $y$ \u5728\u7279\u5224\u4e00\u4e0b $y \\neq s$\uff0c\u5982\u679c $y$ \u7b49\u4e8e $s$ \u7684\u8bdd\uff0c\u5c06\u5176\u8bbe\u4e3a $\\infty$\uff0c\u5426\u5219\u9009\u62e9 $j \\neq y$ \u7684\u6700\u5c0f\u7684\u4e00\u4e2a\u503c $dp_{i,j}$ \u7136\u540e\u66f4\u65b0 $dp_{i,y}$ \u5373\u53ef\u3002\n\n\u5047\u5982\u78b0\u5230\u4e86\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\u4e5f\u5c31\u662f `if y` \u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u9996\u5148\u9700\u8981\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u80fd\u6267\u884c $y$ \u64cd\u4f5c\uff0c\u5982\u679c\u80fd\u7684\u8bdd\uff0c\u9996\u5148\u9012\u5f52\u5904\u7406\u513f\u5b50\u5b50\u6811\u5185\u7684\u7b54\u6848\uff0c\u4e4b\u540e\u5bf9\u513f\u5b50 $dp_{to,j}$ \u5168\u4f53\u52a0\u4e0a $dp_{i,j}$ \u8868\u793a\u6267\u884c\u7684\u524d\u7f6e\u4ee3\u4ef7\uff0c\u518d\u5c06 $dp_{i, y}$ \u7684\u503c\u8bbe\u4e3a $dp_{to, y}$\uff0c\u56e0\u4e3a\u6b64\u65f6\u4f1a\u8981\u8003\u8651\u5b50\u8282\u70b9\u7684\u8d21\u732e\uff0c\u4e4b\u540e\u5bf9\u4e8e\u5176\u4ed6\u7684 $j$\uff0c\u5c06 $dp_{i,j}$ \u4e0e $dp_{to, j}$ \u5bf9\u5e94\u53d6 $\\min$ \u5373\u53ef\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e2a\u662f\u4e00\u4e2a\u6574\u4f53 $dp$ \u7684\u8fc7\u7a0b\uff0c\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u5bf9\u6bcf\u4e2a\u70b9\u5f00\u4e00\u9897\u52a8\u6001\u5f00\u70b9\u503c\u57df\u7ebf\u6bb5\u6811\u8fdb\u884c\u4f18\u5316\uff0c\u7136\u540e\u7b97\u5b50\u8282\u70b9\u5bf9\u7236\u8282\u70b9\u7684\u8d21\u732e\u7684\u65f6\u5019\u76f4\u63a5\u7ebf\u6bb5\u6811\u5408\u5e76\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u542f\u53d1\u5f0f\u5408\u5e76\u8ba1\u7b97\u5b50\u8282\u70b9\u5bf9\u7236\u8282\u70b9\u7684\u8d21\u732e\uff0c\u56e0\u4e3a\u4e2d\u9014\u9012\u5f52\u5b50\u8282\u70b9\u7684\u65f6\u5019\u9700\u8981\u7ed9\u5b50\u8282\u70b9\u5168\u5c40\u52a0\u4e0a\u67d0\u4e2a\u503c $val$\uff0c\u6b64\u65f6\u9700\u8981\u5728\u5408\u5e76\u4e2d\u5bf9\u8fde\u901a\u5757\u7ef4\u62a4\u61d2\u60f0\u6807\u8bb0\u6765\u5b58\u50a8 $val$\uff0c\u7136\u540e\u5408\u5e76\u7684\u65f6\u5019\u5982\u679c\u662f\u5f53\u524d\u8282\u70b9\u5927\uff0c\u90a3\u4e48\u513f\u5b50\u76f4\u63a5\u66b4\u529b\u52a0 $val$\uff0c\u4e0d\u7528\u7ba1\u4e86\uff0c\u5982\u679c\u662f\u5f53\u524d\u513f\u5b50\u5927\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u8282\u70b9\u4e2d\u6bcf\u4e2a\u70b9\u5148 $-dp_{i,j}$\uff0c\u7136\u540e\u5168\u5c40\u52a0\u4e0a\u4e00\u4e2a $dp_{i,j}$ \u5c31\u597d\u4e86\uff0c\u800c\u5176\u4ed6\u67e5\u8be2\u6700\u5c0f\u7684\u503c\uff0c\u989d\u5916\u518d\u5f00\u4e00\u4e2a `multiset` \u5373\u53ef\u7ef4\u62a4\uff0c\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\u7684\u662f\u6574\u4f53 $dp$ \u7684\u4ee3\u7801\u3002\n\n```cpp\n// \u5fb7\u4e3d\u838e\u4f60\u597d\u53ef\u7231\u5fb7\u4e3d\u838e\u4f60\u597d\u53ef\u7231\u5fb7\u4e3d\u838e\u4f60\u597d\u53ef\u7231\u5fb7\u4e3d\u838e\u4f60\u597d\u53ef\u7231\u5fb7\u4e3d\u838e\u4f60\u597d\u53ef\u7231\n// \u5fb7\u4e3d\u838e\u7684\u53ef\u7231\u5728\u4e8e\u5fb7\u4e3d\u838e\u5f88\u53ef\u7231\uff0c\u5fb7\u4e3d\u838e\u4e3a\u4ec0\u4e48\u5f88\u53ef\u7231\u5462\uff0c\u8fd9\u662f\u56e0\u4e3a\u5fb7\u4e3d\u838e\u5f88\u53ef\u7231\uff01\n// \u6ca1\u6709\u529b\u91cf\u7684\u7406\u60f3\u662f\u620f\u8a00\uff0c\u6ca1\u6709\u7406\u60f3\u7684\u529b\u91cf\u662f\u7a7a\u865a\n#include <bits/stdc++.h>\n#define LL long long\n#define int long long\nusing namespace std;\nchar ibuf[1 << 15], *p1, *p2;\n#define getchar() (p1 == p2 && (p2 = (p1 = ibuf) + fread(ibuf, 1, 1 << 15, stdin), p1==p2) ? EOF : *p1++)\ninline int read() {\n  char ch = getchar();  int x = 0, f = 1;\n  while (ch < '0' || ch > '9')  {  if (ch == '-')  f = -1;  ch = getchar();  }\n  while (ch >= '0' && ch <= '9')  x = (x << 1) + (x << 3) + (ch ^ 48), ch = getchar();\n  return x * f;\n}\nvoid print(LL x) {\n  if (x > 9)  print(x / 10);\n  putchar(x % 10 + '0');\n}\ntemplate<class T> bool chkmin(T &a, T b) { return a > b ? (a = b, true) : false; }\ntemplate<class T> bool chkmax(T &a, T b) { return a < b ? (a = b, true) : false; }\n#define rep(i, l, r) for (int i = (l); i <= (r); i++)\n#define repd(i, l, r) for (int i = (l); i >= (r); i--)\n#define REP(i, l, r)  for (int i = (l); i < (r); i++)\nbool o1;\nconst int N = 2e5 + 5, lim = 2e5, inf = 2e17;\nint n, S, num, nex[N], first[N], v[N];\nint st[N], tp;\nstruct node {  int id, x, y;  } a[N];\nvector <int> ver[N];\nint rt[N * 19], lc[N * 19], rc[N * 19], s[N * 19], tot, tag[N * 19];\nvoid pushup(int p) {\n  s[p] = min(s[lc[p]], s[rc[p]]);\n}\nvoid gettag(int p,int val) {\n  s[p] += val;\n  tag[p] += val;\n}\nvoid pushdown(int p) {\n  if (!tag[p])  return;\n  if (lc[p])  s[lc[p]] += tag[p], tag[lc[p]] += tag[p];\n  if (rc[p])  s[rc[p]] += tag[p], tag[rc[p]] += tag[p];\n  tag[p] = 0;\n}\nvoid change(int &p,int l,int r,int pos,int val) {\n  if (!p)  p = ++tot;\n  if (l == r) { s[p] = val;  return;   }\n  pushdown(p);\n  int mid = (l + r) >> 1;\n  if (pos <= mid)  change(lc[p], l, mid, pos, val);\n  else  change(rc[p], mid + 1, r, pos, val);\n  pushup(p);\n}\nint ask(int p,int l,int r,int pos) {\n  if (!p)  return inf;\n  if (l == r)  return s[p];\n  pushdown(p);\n  int mid = (l + r) >> 1;\n  if (pos <= mid)  return ask(lc[p], l, mid, pos);\n  else  return ask(rc[p], mid + 1, r, pos);\n}\nint merge(int x,int y,int a,int b) {\n  if (!x || !y)  return x + y;\n  int nowrt = ++tot;\n  if (a == b) {\n    s[nowrt] = min(s[x], s[y]);\n    return nowrt;\n  }\n  pushdown(x);\n  pushdown(y);\n  int mid = (a + b) >> 1;\n  lc[nowrt] = merge(lc[x], lc[y], a, mid);\n  rc[nowrt] = merge(rc[x], rc[y], mid + 1, b);\n  pushup(nowrt);\n  return nowrt;\n}\nint cnt = 0;\nvoid dfs(int x) {\n  change(rt[x], 0, lim, a[x].x, 0);\n  for (auto to : ver[x]) {\n    if (a[to].id == 1) {\n      int now = s[rt[x]];\n      gettag(rt[x], a[to].y);\n      if (a[to].x != S)  change(rt[x], 0, lim, a[to].x, now);\n      else  change(rt[x], 0, lim, a[to].x, inf);\n    } else if (a[to].id == 2) {\n      int val = ask(rt[x], 0, lim, a[to].x);\n      if (val != inf) {\n        dfs(to);\n        gettag(rt[to], val);\n        change(rt[x], 0, lim, a[to].x, inf);\n        rt[x] = merge(rt[x], rt[to], 0, lim);\n      }\n    }\n  }\n}\nbool o2;\nvoid solve() {\n  // cout << (&o2 - &o1) * 1.0 / 1024 / 1024 << \"\\n\";\n  cin >> n >> S;\n  st[0] = n + 1;\n  rep (i, 1, n) {\n    string it ; \n    cin >> it;\n    if (it == \"set\") {\n      a[i].id = 1;\n      cin >> a[i].x >> a[i].y;\n      ver[st[tp]].push_back(i);\n    } else if (it == \"if\") {\n      a[i].id = 2;\n      cin >> a[i].x;\n      ver[st[tp]].push_back(i);\n      st[++tp] = i;\n    } else if (it == \"end\") {\n      tp--;\n    }\n  }\n  s[0] = inf;\n  dfs(n + 1);\n  cout << s[rt[n + 1]] << \"\\n\";\n}\nsigned main () {\n#ifdef LOCAL_DEFINE\n  freopen(\"1.in\", \"r\", stdin);\n  freopen(\"1.ans\", \"w\", stdout);\n#endif\n  ios :: sync_with_stdio(0);\n  cin.tie(0), cout.tie(0);\n  int T = 1;  while (T--)  solve();\n#ifdef LOCAL_DEFINE\n  cerr << \"Time elapsed: \" << 1.0 * clock() / CLOCKS_PER_SEC << \" s.\\n\";\n#endif\n  return 0;\n}\n```",
        "postTime": 1664842269,
        "uid": 206021,
        "name": "Pitiless0514",
        "ccfLevel": 7,
        "title": "CF1455G Forbidden Value"
    }
]