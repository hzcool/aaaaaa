[
    {
        "content": "**\u601d\u8def\uff1a**\n\n- $bfs$\n\n\u8fd9\u9898\u7684\u7279\u70b9\u5728\u4e8e\uff0c\u53ef\u4ee5**\u65cb\u8f6c**\n\n\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u5f53\u524d\u4f4d\u7f6e\uff0c\u5df2\u65cb\u8f6c\u7684\u6b21\u6570\n\n\u800c\u6211\u4eec\u53c8\u53ef\u4ee5\u53d1\u73b0\uff0c\u65cb\u8f6c$4$\u6b21\u4e0e\u4e0d\u65cb\u8f6c\u7684\u6548\u679c\u4e00\u6837\n\n\u4e8e\u662f\u6211\u4eec\u7684\u72b6\u6001\u4fbf\u53ef\u4ee5$mod$ $4$\n\n\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u5b57\u7b26\u4ee3\u8868\u7684\u95e8\u7684\u60c5\u51b5\uff08\u6253\u8868\uff09\uff0c\n\n\u4ee5\u53ca\u7ed9\u51fa\u7684$map$\u65cb\u8f6c$0,1,2,3$\u6b21\u7684\u60c5\u51b5\n\n**\u6ce8\u610f\uff1a**\n\n- \u624b\u6253\u961f\u5217\u7a7a\u95f4\u8981\u5f00$1e7$\n\n**\u4ee3\u7801**\n\n``` cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define fir first\n#define sec second\n\ntypedef pair <int, int> pii;\ntypedef pair <pii, int> ppi;\nconst int maxn = 1010;\nconst int maxlen = 1e7 + 10;\nconst int dx[] = {-1, 1, 0, 0};\nconst int dy[] = {0, 0, -1, 1};\nppi q[maxlen];\nbool to[4][1 << 8];\nchar a[4][maxn][maxn];\nint n, m, l, r, sx, sy, tx, ty, to_next[4], nxt[1 << 8], dp[4][maxn][maxn];\n\nvoid make(char ch, bool b1, bool b2, bool b3, bool b4) {\n\tto[0][ch] = b1, to[1][ch] = b2, to[2][ch] = b3, to[3][ch] = b4;\n}\n\nvoid init() {\n\tto_next[0] = 1;\n\tto_next[1] = 0;\n\tto_next[2] = 3;\n\tto_next[3] = 2; // \u56e0\u4e3a\u9898\u76ee\u8981\u6c42\u76f8\u90bb\u70b9\u90fd\u6709\u95e8\u624d\u80fd\u8d70\uff0c\u6240\u4ee5\u5c31\u8981\u5224\u65ad\u51fa\u53d1\u70b9\u7684\u5f53\u524d\u65b9\u5411\uff0c\u7ed3\u675f\u70b9\u7684\u76f8\u53cd\u65b9\u5411\u662f\u5426\u6709\u95e8\u3002\n\tnxt['+'] = '+';\n\tnxt['-'] = '|';\n\tnxt['|'] = '-';\n\tnxt['^'] = '>';\n\tnxt['>'] = 'v';\n\tnxt['<'] = '^';\n\tnxt['v'] = '<';\n\tnxt['L'] = 'U';\n\tnxt['R'] = 'D';\n\tnxt['U'] = 'R';\n\tnxt['D'] = 'L';\n\tnxt['*'] = '*'; // \u6bcf\u4e2a\u5b57\u7b26\u65cb\u8f6c\u4e00\u6b21\u7684\u72b6\u6001\n\tmake('+', 1, 1, 1, 1);\n\tmake('-', 0, 0, 1, 1);\n\tmake('|', 1, 1, 0, 0);\n\tmake('^', 1, 0, 0, 0);\n\tmake('>', 0, 0, 0, 1);\n\tmake('<', 0, 0, 1, 0);\n\tmake('v', 0, 1, 0, 0);\n\tmake('L', 1, 1, 0, 1);\n\tmake('R', 1, 1, 1, 0);\n\tmake('U', 0, 1, 1, 1);\n\tmake('D', 1, 0, 1, 1);\n\tmake('*', 0, 0, 0, 0); // \u5904\u7406\u51fa\u6bcf\u4e2a\u5b57\u7b26\u80fd\u5f80\u4ec0\u4e48\u5730\u65b9\u8d70\n}\n\nbool pd(int x, int y) {\n\treturn x > 0 && y > 0 && x <= n && y <= m;\n}\n\nint main() {\n\tinit();\n\tchar buf[maxn];\n\tscanf(\"%d %d\", &n, &m);\n\tfor (int i = 1; i <= n; i++) {\n\t\tgets(buf);\n\t\tfor (int j = 1; j <= m; j++) {\n\t\t\ta[0][i][j] = getchar();\n\t\t\tfor (int k = 1; k < 4; k++) {\n\t\t\t\ta[k][i][j] = nxt[a[k - 1][i][j]];\n\t\t\t}\n\t\t}\n\t}\n\tscanf(\"%d %d %d %d\", &sx, &sy, &tx, &ty);\n\tif (sx == tx && sy == ty) {\n\t\treturn puts(\"0\"), 0;\n\t}\n\tdp[0][sx][sy] = 1; // \u56e0\u4e3a\u53ea\u7528\u4e86dp\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5224\u91cd\uff0c\u521d\u59cb\u503c+1\n\tq[++r] = make_pair(make_pair(sx, sy), 0);\n\tfor (; l <= r; ) {\n\t\tppi u = q[l++];\n\t\tint px = u.fir.fir, py = u.fir.sec;\n\t\tif (!dp[(u.sec + 1) % 4][px][py]) {\n\t\t\tdp[(u.sec + 1) % 4][px][py] = dp[u.sec][px][py] + 1;\n\t\t\tq[++r] = make_pair(u.fir, (u.sec + 1) % 4);\n\t\t}\n\t\tfor (int i = 0; i < 4; i++) {\n\t\t\tint nx = px + dx[i], ny = py + dy[i];\n\t\t\tif (pd(nx, ny) && to[i][a[u.sec][px][py]] && to[to_next[i]][a[u.sec][nx][ny]]) {\n\t\t\t\tif (nx == tx && ny == ty) {\n\t\t\t\t\tprintf(\"%d\", dp[u.sec][px][py]);\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\tif (!dp[u.sec][nx][ny]) {\n\t\t\t\t\tdp[u.sec][nx][ny] = dp[u.sec][px][py] + 1;\n\t\t\t\t\tq[++r] = make_pair(make_pair(nx, ny), u.sec);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tputs(\"-1\");\n\treturn 0;\n}\n```\n\n\u7136\u800c\u8fd9\u9898\u4e5f\u53ef\u4ee5\u901a\u8fc7**\u4f4d\u8fd0\u7b97**\u5904\u7406\u80fd\u5426\u901a\u8fc7\u7684\u95ee\u9898\n\n\u5927\u4f53\u601d\u8def\u5c31\u662f\uff0c\u7528\u4e00\u4e2a\u6574\u6570\u8868\u793a\u5f53\u524d\u4f4d\u7f6e\u7684\u901a\u8fc7\u72b6\u6001\n\n**\u4ee3\u7801**\n\n``` cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define fir first\n#define sec second\n\ntypedef pair <int, int> pii;\ntypedef pair <pii, int> ppi;\nconst int maxn = 2010;\nconst int maxlen = 1e7 + 10;\nconst int dx[] = {-1, 0, 1, 0};\nconst int dy[] = {0, -1, 0, 1};\nppi q[maxlen];\nchar a[4][maxn][maxn];\nint n, m, l = 1, r, to[1 << 8], nxt[1 << 8], dp[4][maxn][maxn];\n\nvoid make(char ch, bool b1, bool b2, bool b3, bool b4) {\n\tto[ch] = (b1 << 0) + (b2 << 1) + (b3 << 2) + (b4 << 3);\n}\n\nvoid init() {\n\tnxt['+'] = '+';\n\tnxt['-'] = '|';\n\tnxt['|'] = '-';\n\tnxt['^'] = '>';\n\tnxt['>'] = 'v';\n\tnxt['<'] = '^';\n\tnxt['v'] = '<';\n\tnxt['L'] = 'U';\n\tnxt['R'] = 'D';\n\tnxt['U'] = 'R';\n\tnxt['D'] = 'L';\n\tnxt['*'] = '*';\n    make('+', 1, 1, 1, 1);\n    make('-', 0, 1, 0, 1);\n    make('|', 1, 0, 1, 0);\n    make('^', 1, 0, 0, 0);\n    make('>', 0, 0, 0, 1);\n    make('<', 0, 1, 0, 0);\n    make('v', 0, 0, 1, 0);\n\tmake('L', 1, 0, 1, 1);\n\tmake('R', 1, 1, 1, 0);\n\tmake('U', 0, 1, 1, 1);\n\tmake('D', 1, 1, 0, 1);\n\tmake('*', 0, 0, 0, 0);\n}\n\nbool pd(int x, int y) {\n\treturn x > 0 && y > 0 && x <= n && y <= m;\n}\n\nbool pass(int hx, int hy, int which, int chk) {\n\treturn to[a[which][hx][hy]] & 1 << chk;\n}\n\nint main() {\n\tinit();\n\tchar buf[maxn];\n\tint sx, sy, tx, ty;\n\tscanf(\"%d %d\", &n, &m);\n\tfor (int i = 1; i <= n; i++) {\n\t\tgets(buf);\n\t\tfor (int j = 1; j <= m; j++) {\n\t\t\ta[0][i][j] = getchar();\n\t\t\tfor (int k = 1; k < 4; k++) {\n\t\t\t\ta[k][i][j] = nxt[a[k - 1][i][j]];\n\t\t\t}\n\t\t}\n\t}\n\tscanf(\"%d %d %d %d\", &sx, &sy, &tx, &ty);\n\tif (sx == tx && sy == ty) {\n\t\treturn puts(\"0\"), 0;\n\t}\n\tdp[0][sx][sy] = 1;\n\tq[++r] = make_pair(make_pair(sx, sy), 0);\n\tfor (; l <= r; ) {\n\t\tppi u = q[l++];\n\t\tint px = u.fir.fir, py = u.fir.sec, t = dp[u.sec][px][py];\n\t\tif (!dp[(u.sec + 1) % 4][px][py]) {\n\t\t\tdp[(u.sec + 1) % 4][px][py] = t + 1;\n\t\t\tq[++r] = make_pair(u.fir, (u.sec + 1) % 4);\n\t\t}\n\t\tfor (int i = 0; i < 4; i++) {\n\t\t\tint nx = px + dx[i], ny = py + dy[i];\n\t\t\tif (pd(nx, ny) && pass(px, py, u.sec, i) && pass(nx, ny, u.sec, (i + 2) % 4)) {\n\t\t\t\tif (nx == tx && ny == ty) {\n\t\t\t\t\tprintf(\"%d\", t);\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\tif (!dp[u.sec][nx][ny]) {\n\t\t\t\t\tdp[u.sec][nx][ny] = t + 1;\n\t\t\t\t\tq[++r] = make_pair(make_pair(nx, ny), u.sec);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tputs(\"-1\");\n\treturn 0;\n}\n```",
        "postTime": 1532341321,
        "uid": 73934,
        "name": "Juanzhang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF676D \u3010Theseus and labyrinth\u3011"
    }
]