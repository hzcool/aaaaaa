[
    {
        "content": "**\u9898\u610f** \uff1a \u7ed9\u51fa\u4e00\u5f20\u65e0\u5411\u56fe\uff0c\u6c42\u5220\u9664\u4e00\u6761\u8fb9\u540e\u6b64\u56fe\u53d8\u6210\u4e8c\u5206\u56fe\u7684\u6240\u6709\u65b9\u6848\u3002\n\n$n,m\\leq 10^4$ \uff0c\u65f6\u9650$\\texttt{1.5s}$\u3002\n\n------------\n\n\u672c\u9898\u6570\u636e\u8303\u56f4\u8f83\u5f31\uff0c\u4f46\u5b58\u5728\u7ebf\u6027\u505a\u6cd5\u3002\n\n\u8003\u8651\u4e8c\u5206\u56fe\u7684\u5145\u8981\u6761\u4ef6 \uff1a \u4e0d\u5b58\u5728\u5947\u73af\u3002\n\n\u82e5\u539f\u56fe\u672c\u5c31\u4e3a\u4e8c\u5206\u56fe\uff0c\u663e\u7136\u968f\u610f\u5220\u9664\u90fd\u53ef\u884c\u3002\n\n\u5426\u5219\uff0c\u56fe\u4e2d\u5b58\u5728\u5947\u73af\uff0c\u6211\u4eec\u9700\u8981\u5220\u4e00\u6761\u8fb9\u7834\u574f\u56fe\u4e2d\u6240\u6709\u7684\u5947\u73af\u3002\n\n\u663e\u7136\uff0c\u7b54\u6848\u662f**\u6240\u6709\u5947\u73af\u7684\u4ea4\u96c6\u4e2d\u7684\u8fb9**\u3002\n\n\u4f46\u662f\uff0c\u5947\u73af\u7684\u4e2a\u6570\u53ef\u80fd\u975e\u5e38\u591a\uff0c\u4e0d\u53ef\u80fd\u5b9e\u9645\u6c42\u89e3\u4ea4\u96c6\u3002\n\n\u63a5\u4e0b\u6765\u7684\u601d\u8def\u53d7\u5230 [P4151 [WC2011]\u6700\u5927XOR\u548c\u8def\u5f84](https://www.luogu.com.cn/problem/P4151) \u7684\u542f\u53d1\u3002\n\n\u4e00\u4e2a\u81ea\u4ea4\u7684\u5947\u73af\u5fc5\u7136\u5f15\u51fa\u4e00\u4e2a\u7b80\u5355\u5947\u73af\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651**\u7b80\u5355\u73af**\u3002\n\n\u5bf9\u4e8e\u56fe\u4e2d\u7684\u4e00\u4e2a\u8fde\u901a\u5757\uff0c\u5148\u6c42\u51fa\u4efb\u610f\u4e00\u4e2a\u751f\u6210\u6811\uff0c\u7136\u540e\u67e5\u770b\u975e\u6811\u8fb9\u3002\n\n\u6b64\u65f6\u5bb9\u6613\u5904\u7406\u53ea\u542b\u6709\u4e00\u6761\u975e\u6811\u8fb9\u7684\u73af\uff0c\u4e14\u6bcf\u6761\u975e\u6811\u8fb9\u6070\u597d\u5bf9\u5e94\u4e00\u4e2a\u8fd9\u6837\u7684\u73af\uff0c\u6211\u4eec\u628a\u8fd9\u79cd\u73af\u53eb\u505a**\u672c\u539f\u73af**\u3002\n\n- **\u6811\u8fb9**\n\n\u82e5\u67d0\u6761\u975e\u6811\u8fb9\u5f62\u6210\u7684\u672c\u539f\u73af\u662f\u5947\u73af\uff0c\u5219\u8fd9\u6761\u8fb9\u662f\u574f\u8fb9\uff0c\u5426\u5219\u662f\u597d\u8fb9\u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u975e\u6811\u8fb9\uff0c\u79f0\u5176\u672c\u539f\u73af\u4e2d\u7684\u6811\u8fb9\u88ab\u5176\u8986\u76d6\u3002\n\n- **\u6027\u8d28\u2460** \uff1a \u7b54\u6848\u8fb9 $\\Rightarrow$ \u88ab\u6240\u6709\u574f\u8fb9\u8986\u76d6\n\n  \u8003\u8651\u6bcf\u4e2a\u574f\u8fb9\u5f62\u6210\u7684\u5947\u73af\uff0c\u663e\u7136\u3002\n  \n- **\u6027\u8d28\u2461** \uff1a \u7b54\u6848\u8fb9\u4e0d\u4f1a\u88ab\u597d\u8fb9\u8986\u76d6\n\n  ![](https://cdn.luogu.com.cn/upload/image_hosting/6uok4em0.png)\n  \n  \u56fe\u4e2d\u9ed1\u8272\u4e3a\u6811\u8fb9\u3002\n\n  \uff08\u53cd\u8bc1\uff09\u4e00\u6761\u7b54\u6848\u8fb9\uff08\u7d2b\u8272\uff09\u80af\u5b9a\u88ab\u67d0\u6761\u574f\u8fb9\uff08\u7eff\u8272\uff09\u8986\u76d6\u3002\n  \n  \u7136\u800c\uff0c\u8be5\u574f\u8fb9\u548c\u597d\u8fb9\uff08\u7ea2\u8272\uff09\u7684\u672c\u539f\u73af\u5f02\u6216\u5e76\u4e00\u5b9a\u80fd\u7ec4\u6210\u4e00\u4e2a\u5947\u73af\uff08\u84dd\u8272\uff09\u3002\n  \n  \u539f\u56e0 \uff1a \u5947\u73af + \u5076\u73af - \u6d88\u53bb\u4e24\u6b21\u7684\u516c\u5171\u90e8\u5206 = \u5947\u73af\n  \n  \u8fd9\u4e2a\u5947\u73af\u4e00\u5b9a\u4e0d\u5305\u542b\u521a\u624d\u63d0\u5230\u7684\u7b54\u6848\u8fb9\uff0c\u77db\u76fe\u3002\n  \n- **\u6027\u8d28\u2462** \uff1a \u4e0d\u88ab\u4efb\u4f55\u597d\u8fb9\u8986\u76d6\uff0c\u4e14\u88ab\u6240\u6709\u574f\u8fb9\u8986\u76d6\u7684\u8fb9\uff0c\u5c31\u662f\u7b54\u6848\u8fb9\u3002\n\n  \u5bf9\u4e8e\u67d0\u4e2a\u7b80\u5355\u73af\uff0c\u5c06\u5176\u4e2d\u6240\u6709\u975e\u6811\u8fb9\u7684\u672c\u539f\u73af\u8fdb\u884c\u5f02\u6216\u5e76\uff0c\u80fd\u5f97\u5230\u5b83\u672c\u8eab\u3002\n  \n  \u82e5\u975e\u6811\u8fb9\u4e2d\u6709\u5947\u6570\u4e2a\u574f\u8fb9\uff0c\u5219\u5f62\u6210\u5947\u73af\uff0c\u5426\u5219\u662f\u5076\u73af\u3002\n  \n  \u5bf9\u4e8e\u4e00\u6761\u4e0d\u88ab\u4efb\u4f55\u597d\u8fb9\u8986\u76d6\u7684\u8fb9\uff0c\u5176\u5728\u5f02\u6216\u5e76\u4e2d\u662f\u5426\u51fa\u73b0\u53d6\u51b3\u4e8e\u574f\u8fb9\u5bf9\u5176\u8986\u76d6\u7684\u6b21\u6570\u3002\n  \n  \u82e5\u6539\u53d8\u88ab\u6240\u6709\u574f\u8fb9\u8986\u76d6\uff0c\u5219\u5728\u6b64\u65f6\u6070\u597d\u88ab\u8986\u76d6\u5947\u6570\u6b21\uff0c\u603b\u662f\u88ab\u5305\u542b\u5728\u5f02\u6216\u5e76\u4e2d\u3002\n  \n\u6839\u636e\u6027\u8d28\u2462\uff0c\u5bb9\u6613\u60f3\u5230\u5982\u4e0b\u7b97\u6cd5\u3002\n\n\u6211\u4eec\u7edf\u8ba1\u53ea\u542b\u6709\u4e00\u6761\u975e\u6811\u8fb9\u7684\u5947\u73af\u6570\u91cf\uff0c\u8bbe\u4e3a $cnt$\u3002\n\n\u5bf9\u4e8e\u574f\u8fb9\uff0c\u5219\u5c06\u5176\u8986\u76d6\u7684\u8fb9 $+1$ \uff0c\u597d\u8fb9\u5219\u5c06\u5176\u8986\u76d6\u7684\u8fb9 $-1$\u3002\n\n\u6700\u540e\u8fb9\u6743\u4e3a $cnt$ \u7684\u8fb9\u5373\u4e3a\u7b54\u6848\u3002\n\n\u6734\u7d20\u7684\u94fe\u52a0\u5904\u7406\u65b9\u6cd5\u2014\u2014\u6811\u4e0a\u5dee\u5206\u9700\u8981\u6c42 $\\rm lca$ \uff0c\u590d\u6742\u5ea6\u5e26 $\\log$\u3002\n\n\u4f46\u662f\uff0c\u6ce8\u610f\u5230\u6211\u4eec\u8fdb\u884c\u64cd\u4f5c\u7684\u662f\u975e\u6811\u8fb9\uff0c\u5728 $\\rm dfs$ \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u975e\u6811\u8fb9\u90fd\u662f\u8fd4\u7956\u8fb9\uff0c\u6240\u4ee5\u5bb9\u6613 $O(1)$ \u5b9e\u73b0\u5dee\u5206\u3002\n\n- **\u975e\u6811\u8fb9**\n\n\u82e5 $cnt=1$ \uff0c\u5219\u53ef\u4ee5\u5220\u9664\u552f\u4e00\u7684\u4e00\u6761\u574f\u8fb9\uff0c\u5426\u5219\u574f\u8fb9\u4e0d\u53ef\u5220\u9664\u3002\n\n------------\n\n\u6ce8\u610f\uff0c\u672c\u9898\u6ca1\u6709 $\\rm SPJ$ ,\u9700\u8981\u5c06\u8fb9\u7684\u7f16\u53f7\u6392\u5e8f\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<vector>\n#define pb push_back\n#define MaxN 10500\nusing namespace std;\nvector<int> g[MaxN],p[MaxN];\nint cnt,s[MaxN],sp,ans[MaxN],tn;\nbool dis[MaxN],vis[MaxN],e[MaxN];\nvoid pfs(int u)\n{\n  vis[u]=1;\n  for (int i=0,v;i<g[u].size();i++)\n    if (!vis[v=g[u][i]]){\n      dis[v]=dis[u]^1;\n      e[p[u][i]]=1;\n      pfs(v);\n    }else if (!e[p[u][i]]){\n      e[p[u][i]]=1;\n      if (dis[u]==dis[v]){\n        cnt++;s[u]++;s[v]--;\n        sp=p[u][i];\n      }else {s[u]--;s[v]++;}\n    }\n}\nvoid dfs(int u)\n{\n  vis[u]=1;\n  for (int i=0,v;i<g[u].size();i++)\n    if (!vis[v=g[u][i]]){\n      dfs(v);\n      if (s[v]==cnt)ans[++tn]=p[u][i];\n      s[u]+=s[v];\n    }\n}\nint n,m;\nint main()\n{\n  scanf(\"%d%d\",&n,&m);\n  for (int i=1,u,v;i<=m;i++){\n    scanf(\"%d%d\",&u,&v);\n    g[u].pb(v);p[u].pb(i);\n    g[v].pb(u);p[v].pb(i);\n  }\n  for (int i=1;i<=n;i++)\n    if (!vis[i])pfs(i);\n  if (!cnt){\n    printf(\"%d\\n\",m);\n    for (int i=1;i<=m;i++)\n      printf(\"%d \",i);\n    return 0;\n  }\n  for (int i=1;i<=n;i++)vis[i]=0;\n  for (int i=1;i<=n;i++)\n    if (!vis[i])dfs(i);\n  if (cnt==1)ans[++tn]=sp;\n  printf(\"%d\\n\",tn);\n  sort(ans+1,ans+tn+1);\n  for (int i=1;i<=tn;i++)\n    printf(\"%d \",ans[i]);\n  return 0;\n}\n```\n",
        "postTime": 1604648938,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "### \u9898\u610f\uff1a\n         \u7ed9\u51fa\u4e00\u5f20\u65e0\u5411\u56fe\uff0c\u6c42\u5220\u9664\u4e00\u6761\u8fb9\u540e\u6b64\u56fe\u53d8\u6210\u4e8c\u5206\u56fe\u7684\u6240\u6709\u5220\u8fb9\u79cd\u7c7b\u3002\n### \u5206\u6790\uff1a\n1\uff1a\u4e00\u4e2a\u56fe\u662f\u4e8c\u5206\u56fe\u5f53\u4e14\u4ec5\u5f53\u5b83\u6ca1\u6709\u5947\u73af\u3002\n\n2\uff1a\u5982\u679c\u4e00\u4e2a\u56fe\u5df2\u7ecf\u662f\u4e8c\u5206\u56fe\uff0c\u90a3\u4e48\u5220\u9664\u4efb\u610f\u4e00\u6761\u8fb9\u90fd\u8fd8\u662f\u4e8c\u5206\u56fe\u3002\n\n3\uff1a\u8003\u8651\u968f\u4fbf\u6c42\u51fa\u4e00\u68f5\u751f\u6210\u6811\u3002\u90a3\u4e48\u6211\u4eec\u628a\u975e\u6811\u8fb9\u90fd\u62ff\u51fa\u6765\u3002\u6c42\u51fa\u5b83\u4eec\u4e24\u4e2a\u70b9\u7684LCA\u548c\u8ddd\u79bbdis\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u6761\u6761\u628a\u975e\u6811\u8fb9\u653e\u5728\u6811\u4e0a\uff0c\u770b\u662f\u5426\u4f1a\u6784\u6210\u5947\u73af\uff0c\u7edf\u8ba1\u5947\u73af\u6761\u6570flag\u3002\n\n4\uff1a\u4e3a\u4e86\u4ee5\u4e0b\u53d9\u8ff0\u65b9\u4fbf\uff0c\u628a\u4f1a\u6784\u6210\u5947\u73af\u7684\u975e\u6811\u8fb9\u53eb\u505a\u77db\u76fe\u8fb9\uff0c\u4e0d\u4f1a\u6784\u6210\u5947\u73af\u7684\u975e\u6811\u8fb9\u53eb\u505a\u5408\u6cd5\u8fb9\u3002\u4e00\u6761\u6811\u4e0a\u8fb9\u88ab\u975e\u6811\u4e0a\u8fb9(u,v)\u201c\u8986\u76d6\u201d\uff0c\u5373\u8fd9\u6761\u6811\u4e0a\u8fb9\u5728u-v\u7684\u6811\u4e0a\u8def\u5f84\u4e0a\u3002\n\n5\uff1a\u5982\u679cflag\u4e3a0\uff0c\u5373\u6ca1\u6709\u5947\u73af\u3002\u75312\uff0c\u53ea\u8981\u628a\u6240\u6709\u8fb9\u5e8f\u53f7\u8f93\u51fa\u5373\u53ef\u3002\n\n6\uff1a\u5982\u679cflag\u4e3a1\uff0c\u5373\u6709\u4e00\u4e2a\u5947\u73af\u3002\u90a3\u4e48\u6211\u4eec\u7684\u4e00\u4e2a\u9009\u62e9\u662f\u628a\u8be5\u6761\u77db\u76fe\u8fb9\u5220\u6389\uff0c\u6216\u8005\u662f\u5728\u8be5\u77db\u76fe\u8fb9(u,v)\u7684\u6811\u4e0a\u8def\u5f84\u4e0a\u627e\u4e00\u4e9b\u8fb9\uff0c\u6ee1\u8db3\u8fd9\u4e9b\u8fb9\u4e0d\u88ab\u5408\u6cd5\u8fb9\u8986\u76d6\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u8ba9\u5176\u4e0d\u88ab\u5408\u6cd5\u8fb9\u8986\u76d6\uff0c\u5927\u5bb6\u53ef\u4ee5\u753b\u4e00\u4e2a\u56fe\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u8be5\u77db\u76fe\u8fb9\u4e0d\u4f1a\u4e0e\u5176\u4ed6\u975e\u77db\u76fe\u8fb9\u518d\u5f62\u6210\u5947\u73af\u3002\n\n7\uff1a\u5982\u679cflag>1\uff0c\u5373\u6709\u82e5\u5e72\u4e2a\u5947\u73af\u3002\u90a3\u4e48\u6211\u4eec\u53ea\u80fd\u9009\u62e9\u5220\u9664\u6811\u4e0a\u90a3\u4e9b\uff0c\u88ab\u6240\u6709\u77db\u76fe\u8fb9\u8986\u76d6\uff0c\u4e14\u4e0d\u88ab\u975e\u77db\u76fe\u8fb9\u8986\u76d6\u7684\u8fb9\u4e86\u3002\u5982\u4f55\u5224\u65ad\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6811\u4e0a\u5dee\u5206\u7684\u601d\u60f3\uff0c\u8bb0d[x]\u4e3ax\u548c\u5176\u7236\u4eb2\u6784\u6210\u7684\u8fb9\u4e0a\u7684\u5dee\u5206\u503c\uff0c\u628a\u77db\u76fe\u8fb9\u7684\u8def\u5f84+1,\u975e\u77db\u76fe\u8fb9\u7684\u8def\u5f84\u4e0a-1\u3002\u90a3\u4e48\u6700\u540e\u6811\u4e0a\u7684\u70b9x\u5982\u679c\u6ee1\u8db3d[x]==flag\uff0c\u90a3\u4e48\u5b83\u4e0e\u5b83\u7684\u7236\u4eb2\u7ec4\u6210\u7684\u8fb9\u5c31\u662f\u6211\u4eec\u6240\u6c42\u7684\u3002\u8be6\u7ec6\u53ef\u89c1\u4ee3\u7801\u3002\n\n8\uff1a\u6ce8\u610f\u53ef\u80fd\u6b64\u56fe\u5e76\u4e0d\u8fde\u901a\u3002\n\n### Codes:\n```cpp\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\nconst int N=3e4+5;\nint v[N<<1],head[N],nxt[N<<1],tot;\nint vq[N<<1],nxtq[N<<1],headq[N],w[N<<1],totq;\nint f[N],las[N],fa[N],dis[N],d[N],tag[N],ans[N],w2[N],w3[N],w4[N];\nint vis1[N],vis2[N];\nint n,m,cnt,flag,ansn,tht,endd,sta,turn,tot4;\nstruct edge{\n    int x,y,id,lca;\n}a[N],b[N],c[N];\ninline int getf(int x){return fa[x]==x?x:fa[x]=getf(fa[x]);}\ninline int getf1(int x){return f[x]==x?x:f[x]=getf1(f[x]);}\ninline void merge(int x,int y){\n    int f1=getf(x),f2=getf(y);\n    fa[f1]=f2;\n}\ninline void add(int x,int y,int z){\n    v[++tot]=y;w4[tot]=z;\n    nxt[tot]=head[x];\n    head[x]=tot;\n}\ninline void addq(int x,int y,int z){\n    vq[++totq]=y;w[totq]=z;\n    nxtq[totq]=headq[x];\n    headq[x]=totq;\n}\ninline void tarjan(int x){\n    f[x]=x;vis1[x]=x;\n    for(int i=head[x];i;i=nxt[i]){\n        int y=v[i];\n        if(!f[y]){\n            dis[y]=dis[x]+1;\n            w3[y]=w4[i];\n            w2[y]=w[i];\n            tarjan(y);\n            f[y]=x;\n            las[y]=x;\n        }\n    }\n    for(int i=headq[x];i;i=nxtq[i]){\n        int y=vq[i],c=w[i];\n        if(f[y])b[c].lca=getf1(y);\n    }\n}\ninline void dfs(int x,int fa){\n    vis2[x]=1;\n    for(int i=head[x];i;i=nxt[i]){\n        int y=v[i];\n        if(y!=fa){\n            dfs(y,x);\n            d[x]+=d[y];\n        }\n    }\n}\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=m;++i)scanf(\"%d%d\",&a[i].x,&a[i].y),a[i].id=i;\n    for(int i=1;i<=n;++i)fa[i]=i;\n    for(int i=1;i<=m;++i){\n        int x=a[i].x,y=a[i].y;\n        if(getf(x)!=getf(y)){//\u751f\u6210\u6811\n            merge(x,y);\n            add(x,y,i);add(y,x,i);\n        }\n        else{\n            b[++cnt].x=x;b[cnt].y=y;\n            b[cnt].id=a[i].id;\n            addq(x,y,cnt);addq(y,x,cnt);\n        }\n    }\n    for(int i=1;i<=n;++i)if(!vis1[i])tarjan(i);//tarjan\u6c42lca,dis\u7b49\n    for(int i=1;i<=cnt;++i){\n        int x=b[i].x,y=b[i].y,p=b[i].lca,delta=1,curd;\n        curd=dis[x]+dis[y]-2*dis[p];\n        if(curd&1)delta=-1;//\u5076\u73af\n        else {\n            flag++;endd=y;\n            sta=x;turn=p;tht=b[i].id;\n        }//\u5947\u73af\n        d[x]+=delta;d[y]+=delta;d[p]-=2*delta;//\u5dee\u5206\n    }\n    for(int i=1;i<=n;++i)if(!vis2[i])dfs(i,i);//\u6c42d\u7684\u5b57\u6811\u548c\n    if(!flag){//\u65e0\u5947\u73af\n        printf(\"%d\\n\",m);\n        if(m){\n            for(int i=1;i<m;++i)printf(\"%d \",i);\n            printf(\"%d\\n\",m);\n        }\n    }\n    else if(flag==1){//\u4e00\u5947\u73af\n        int tot3=0;\n        for(int i=endd;i!=turn;i=las[i]){\n            if(d[i]==1)//\u53ea\u88ab\u8fd9\u4e00\u6761\u8fb9\u8986\u76d6\n            ans[++tot3]=w3[i];\n        }\n        for(int i=sta;i!=turn;i=las[i]){\n            if(d[i]==1)//\u53ea\u88ab\u8fd9\u4e00\u6761\u8fb9\u8986\u76d6\n            ans[++tot3]=w3[i];\n        }\n        ans[++tot3]=tht;//\u522b\u5fd8\u4e86\u52a0\u4e0a\u8be5\u77db\u76fe\u8fb9\n        sort(ans+1,ans+1+tot3);\n        printf(\"%d\\n\",tot3);\n        if(tot3){\n            for(int i=1;i<tot3;++i)printf(\"%d \",ans[i]);\n            printf(\"%d\\n\",ans[tot3]);\n        }\n    }\n    else{//\u591a\u4e2a\u5947\u73af\n        for(int i=1;i<=n;++i)if(d[i]==flag)ans[++tot4]=w3[i];\n        sort(ans+1,ans+1+tot4);\n        printf(\"%d\\n\",tot4);\n        if(tot4){\n            for(int i=1;i<tot4;++i)printf(\"%d \",ans[i]);\n            printf(\"%d\\n\",ans[tot4]);\n        }\n    }\n    return 0;\n}\n\n```\n\n### \u540e\u8bb0\uff1a\n\t\t\u7531\u4e8e\u6211\u5b9e\u5728\u662f\u592a\u5f31\u592a\u5f31\u4e86\uff0c\u6240\u4ee5\u4ee3\u7801\u5199\u7684\u975e\u5e38\u4e11\uff0c\u8fd8\u9646\u9646\u7eed\u7eed\u5199\u4e86\u4e00\u4e2a\u661f\u671f\uff0c\u8fd8T,WA\u4e86\u65e0\u6570\u53d1\u3002\u5728\u6b64\u5f15\u4ee5\u4e3a\u6212\u3002\u8981\u819c\u4e00\u4e0b\u673a\u623f\u5927\u4f6claduiw\u3002\n\n\n",
        "postTime": 1536238732,
        "uid": 27370,
        "name": "Chasingdreams",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "\u4e00\u9053\u5999\u9898QAQ\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\u5224\u5b9a\u662f\u5426\u4e3a\u4e8c\u5206\u56fe\u7684\u5145\u8981\u6761\u4ef6\u662f\u6709\u65e0\u5947\u73af(\u5f88\u5bb9\u6613\u8bc1\u7684)\uff0c\u7136\u540e\u6211\u4eec\u53ea\u8981\u7edf\u8ba1\u6bcf\u4e2a\u8fb9\u5728\u591a\u5c11\u4e2a\u5947\u73af\u4e0a\u5c31\u884c\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u6309dfs\u5e8f\u8dd1\u4e00\u68f5\u6811\uff0c\u56e0\u4e3adfs\u5e8f\u8dd1\u7684\u65f6\u5019\u53ea\u53ef\u80fd\u4f1a\u8dd1\u5230\u8fd4\u7956\u8fb9(\u6a2a\u53c9\u8fb9\u8dd1\u4e0d\u5230\uff0c\u53ef\u4ee5\u53cd\u8bc1)\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u6811\u4e0a\u8dd1\u6765\u8dd1\u53bb\uff0c\u8dd1\u5230\u8fd4\u7956\u8fb9\u7684\u65f6\u5019\u770b\u4e00\u4e0b\u5f53\u524d\u73af\u662f\u5947\u8fd8\u662f\u5076\uff0c\u7136\u540e\u628a\u73af\u4e0a\u7684\u6240\u6709\u8fb9\u7684\u8bb0\u5f55\u76f8\u5e94\u7684\u73af\u7684\u79cd\u7c7b\u90fd+1\u3002\n\n\u4ee5\u4e0a\u8fc7\u7a0b\u53ef\u4ee5\u7528\u5dee\u5206\u505a\u5230$O(n)$\n\n\u5224\u5b9a\u7684\u65f6\u5019\uff0c\u5982\u679c\u662fdfs\u6811\u4e0a\u7684\u8fb9\uff0c\u76f4\u63a5\u6570\u7ecf\u8fc7\u5b83\u7684\u5947\u73af\u4e2a\u6570\u662f\u5426=\u5947\u73af\u603b\u4e2a\u6570\uff0c\u5e76\u4e14\u4e0d\u80fd\u6709\u5076\u73af\u7ecf\u8fc7\u5426\u5219\u8fd9\u6761\u8fb9\u5c31\u4e00\u5b9a\u4e0d\u80fd\u5220\u3002\u5982\u679c\u662fdfs\u6811\u4e0a\u7684\u8fd4\u7956\u8fb9\uff0c\u90a3\u5b83\u5c31\u81f3\u591a\u6709\u4e00\u4e2a\u6811\u4e0a\u5947\u73af\u7ecf\u8fc7\u5b83\uff0c\u5224\u65ad\u4e00\u4e0b\u5b83\u7684\u5947\u73af\u4e2a\u6570\u548c\u603b\u5947\u73af\u4e2a\u6570\u662f\u5426\u90fd=1\u5373\u53ef\n\n```cpp\n#include<bits/stdc++.h> \n#define fo(i, a, b) for (int i = (a); i <= (b); ++i)\n#define fd(i, a, b) for (int i = (a); i >= (b); --i)\n#define edge(i, u) for (int i = head[u], v = e[i].v; i; i = e[i].nxt, v = e[i].v)\n#define N 10005\n#define pb push_back\n#define F first\n#define S second\n#define ll long long\n#define inf 1000000007\n#define mp std::make_pair\n#define lowbit(x) (x & -x)\n#define ls (k << 1)\n#define rs (k << 1 | 1)\n#define mod 100000007\n#define eps 1e-4\n#define itset std::set<node>::iterator\n#define lb lower_bound\nint head[N], u, v, n, m, ans[N], cans, p[N], fl[N];\nstruct edge{\n    int nxt, v, id;\n}e[N << 1];\nint tot = 1, d[N];\nint c1[N], c2[N], cnt;\ninline void addedge (int u, int v, int id)\n{\n    e[++tot] = (edge) {head[u], v, id};\n    head[u] = tot;\n}\ninline void dfs (int u, int fa, int pre)\n{\n    d[u] = d[fa] + 1; p[u] = e[pre].id;\n    edge (i, u)\n    {\n        if ((i ^ pre) == 1) continue;\n        if (!d[v])\n        {\n            dfs(v, u, i);\n            fl[e[i].id] = 1;\n            c1[e[pre].id] += c1[e[i].id]; c2[e[pre].id] += c2[e[i].id];\n        }\n        else\n        {\n            if (u == v && i & 1)\n            {\n                ++c1[e[i].id]; ++cnt;\n            }\n            else\n            {\n                if (d[u] > d[v])\n                if ((d[u] - d[v]) & 1)\n                {\n                    ++c2[e[i].id];\n                    ++c2[e[pre].id];\n                    --c2[p[v]];\n                }\n                else\n                {\n                    ++c1[e[i].id];\n                    ++c1[e[pre].id];\n                    --c1[p[v]];\n                    ++cnt;\n                }\n            }\n        }\n    }\n}\nint main ()\n{\n    scanf(\"%d %d\", &n, &m);\n    fo (i, 1, m)\n    {\n        scanf(\"%d %d\", &u, &v);\n        addedge(u, v, i);\n        addedge(v, u, i);\n    }\n    fo (i, 1, n)\n        if (!d[i]) dfs(i, 0, 0);\n    if (!cnt)\n        fo (i, 1, m)\n            ans[++cans] = i;\n    else\n    fo (i, 1, m)\n        if (fl[i])\n        {\n            if (c1[i] == cnt && !c2[i])\n            {\n                ans[++cans] = i;\n            }\n        }\n        else\n        {\n            if (cnt == 1 && c1[i] == 1)\n                ans[++cans] = i;\n        }\n    printf(\"%d\\n\", cans);\n    fo (i, 1, cans)\n        printf(\"%d \", ans[i]);\n    return 0;\n}\n```",
        "postTime": 1545388674,
        "uid": 13137,
        "name": "HomuraCat",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "# CF19E Fairy \u9898\u89e3:\n\n**\u672c\u9898\u5173\u952e\u8bcd** :\u5206\u6cbb,\u903c\u8fd1,\u64a4\u9500\u4ee3\u66ff\u5220\u9664.\n\n**\u76f8\u5173\u9898\u76ee** : \u6d88\u5931\u4e4b\u7269(\u4e0d\u5141\u8bb8\u4f7f\u7528\u7269\u54c1$x\\in [1,n]$\u7684\u60c5\u51b5\u4e0b,\u80cc\u5305\u8ba1\u6570)\n\n----\n\n\n\u840c\u65b0\u521a\u5f00\u59cb\u5199\u5206\u6cbb ~~\u8bf7\u95ee\u7ebf\u6bb5\u6811\u5206\u6cbbMLE\u600e\u4e48\u6551~~   \n\n\n\n\u672c\u9898\u6709$O(n)$\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u4f18\u79c0std ~~\u4f46\u662f\u4f5c\u4e3a\u4e00\u4e2a\u777f\u667a\u9009\u624b.~~ \n\u4e00\u770b256MB\u7684ML\u548c$n,m\\leq 10^4$\u679c\u65ad\u5199\u4e00\u4e2a$O(nlog^2n)$\u7684\u6c34\u8fc7\u53bb.\n\n\n\u9898\u76ee\u610f\u601d:\u7ed9\u4e00\u65e0\u5411\u56fe,\u627e\u51fa\u90a3\u4e9b\u5220\u6389\u540e\u80fd\u4f7f\u539f\u56fe\u9ed1\u767d\u67d3\u8272,\u540c\u8272\u4e0d\u76f8\u90bb.\u7684\u8fb9.  \n\n\n\n\u5c31\u662f\u95ee\u5220\u4e86\u8fb9\u4e4b\u540e\u662f\u4e0d\u662f\u4e8c\u5206\u56fe...\u8fd9\u4e2abzoj\u4e0a\u9762\u6709\u4e2a\u9898,\u6bcf\u6761\u8fb9$e(u,v)$\u5bfb\u5728\u4e8e\u65f6\u95f4$[l,r]$\u5185,\u95ee\u54ea\u4e9b\u65f6\u523b\u662f\u4e8c\u5206\u56fe....\u90a3\u4e2a\u9898\u76ee\u7684\u6570\u636e\u6bd4\u672c\u9898\u591a\u4e2a$0$...\u5199\u4e2a\u7ebf\u6bb5\u6811\u5206\u6cbb+LCT\u5c31\u80fd\u6c34\u8fc7\u53bb\u4e86....  \u6240\u4ee5\u672c\u9898\u6211\u4eec\u4e5f\u5957\u7528\u8fd9\u4e2a\u505a\u6cd5,\u4ee4\u6bcf\u6761\u8fb9$e_i(u,v)$\u7684\u5b58\u5728\u533a\u95f4\u4e3a$[0,i)\\ \\cup (i,m)$,\u8fd9\u91cc\u91c7\u7528$[0,m)$\u7684\u7f16\u53f7..~~\u7136\u540e\u5957\u4e2a\u677f\u5b50\u5c31\u53ef\u4ee5MLE\u4e86~~\u53d1\u73b0\u548c\u4e4b\u524d\u7684\u95ee\u9898\u4e00\u6837\u5462qwq.\n\n\u7ebf\u6bb5\u6811\u5206\u6cbb\u662f\u5565\u4e0d\u77e5\u9053\u7684\u8bdd,\u53ef\u4ee5\u505a[LOJ:(\u79bb\u7ebf)\u52a8\u6001\u56fe\u8054\u901a\u6027](https://loj.ac/problem/121).\n\n\n----\n\n\n\u4e0a\u9762\u90fd\u662f\u95f2\u626f,\u6211\u4eec\u4e0b\u9762\u8fdb\u5165\u6b63\u9898, **\u5206\u6cbb\u903c\u8fd1\u4e0e\u53ef\u64a4\u9500**\n\n\u8003\u8651\u4e8c\u5206\u56fe\u5224\u5b9a,\u8fd9\u91cc\u7531\u4e8e\u662f\u4e00\u4e2a\u52a8\u6001\u52a0\u5220\u8fb9\u7684\u4e1c\u897f,\u6240\u4ee5bfs/dfs\u67d3\u8272\u6784\u9020\u7684\u65b9\u6cd5\u5e76\u4e0d\u65b9\u4fbf,\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u6709\u8da3\u7684\u505a\u6cd5\u6765\u5224\u5b9a\u4e8c\u5206\u56fe.  \n\n\u8003\u8651\u52a0$(u,v)$\u524d,$u,v$\u4e0d\u8fde\u901a,\u5728\u4e24\u4e2a\u8fde\u901a\u5757\u4e2d.\u5047\u8bbe$u,v$\u90fd\u662f\u9ed1\u8272\u7684,\u6240\u5728\u8fde\u901a\u5757\u4e5f\u5df2\u7ecf\u5206\u522b\u9ed1\u767d\u4e0d\u76f8\u90bb\u67d3\u8272\u6210\u529f\u4e86,\u6211\u4eec\u8fde\u63a5$(u,v)$\u5408\u5e76\u8054\u901a\u5757,\u5982\u679c\u4fdd\u7559$v$\u662f\u9ed1\u8272,\u90a3\u4e48$u$\u6240\u5728\u7684\u96c6\u5408\u8981\u8fdb\u884c\u4e00\u4e2a\u53cd\u8272\u64cd\u4f5c\u5c31\u53ef\u4ee5\u6ee1\u8db3\u540c\u8272\u4e0d\u76f8\u90bb\u4e86.  \n\n$(u,v)$\u52a0\u5165\u524d\u8fde\u901a\u5e76\u4e14\u989c\u8272\u76f8\u540c,\u5219\u8fd9\u6761\u8fb9\u7834\u574f\u4e86\u540c\u8272\u4e0d\u76f8\u90bb,\u5df2\u7ecf\u4e0d\u662f\u4e8c\u5206\u56fe\u4e86,\u518d\u52a0\u5165\u4e5f\u4e0d\u4f1a\u662f\u4e8c\u5206\u56fe\u4e86.\n\n\n\u8fd9\u4e2a\u53cd\u8272\u64cd\u4f5c,0/1\u4e4b\u7c7b\u7684,\u96c6\u5408\u5e76...\u4e00\u770b\u662f\u4e0d\u662f\u5c31\u60f3\u7528bitset\u554a?\u522b\u641e\u4e8b\u554a\u5c0f\u8001\u5f1f...$O(\\frac{n}{w})$\u4e0d\u662f\u95f9\u7740\u73a9\u7684\u554a....\u4e0d\u8981\u771f\u7684\u4ee5\u4e3a$O(\\frac{n^2}{64})$(\u4e0d\u89c4\u8303\u5199\u6cd5....)\u53ef\u4ee5\u968f\u4fbf\u8dd11e5\u554a...\u8fd9\u601d\u60f3\u5f88\u5371\u9669...  \u6211\u4eec\u8003\u8651\u4e00\u4e2a\u590d\u6742\u5ea6\u6b63\u786e\u7684\u53cd\u8272\u73a9\u6cd5.  \n\n\u8bb0\u5f55\u4e00\u4e2a\u4e8c\u5206\u56fe\u7684 **\u751f\u6210\u6811** \u6211\u4eec\u77e5\u9053(\u94a6\u5b9a)\u6839\u7684\u989c\u8272\u5c31\u53ef\u63a8\u51fa\u6240\u6709(\u8054\u901a\u5757\u5185)\u70b9\u7684\u989c\u8272\u4e86!\u8fde\u8fb9\u5c31\u76f4\u63a5\u628a\u751f\u6210\u6811\u7684\u6839\u8fde\u63a5,\u4e0d\u5c31OK\u4e86\u5417?\u7136\u540e\u8fd8\u8981\u652f\u6301\u67e5\u8be2\u94fe\u957f\u5ea6,\u4e0a\u4e2aLCT\u5c31OK\u4e86.\n\n---\n\n\n\u8003\u8651\u4f18\u5316\u5e38\u6570.\u6211\u4eec\u6ce8\u610f\u5230,\u53ea\u9700\u8981\u67e5\u8be2\u94fe\u4e0a\u8fb9\u6570\u6a212\u5373\u53ef.\u6a212\u610f\u4e49\u4e0b\u7684\u52a0\u5373\u4e3axor\u8fd0\u7b97.\u5e76\u4e14\u8003\u8651$(u,v)$\u5728\u751f\u6210\u6811\u4e0a\u94fe,\u548c$u$\u7684\u6839\u94fe+$v$\u7684\u6839\u94fe,\u957f\u5ea6\u6a212\u610f\u4e49\u4e0b\u5fc5\u7136\u60f3\u7b49(\u4e5f\u53ef\u4ee5\u8003\u8651$x\\, xor\\,x=0$,LCA\u4e4b\u4e0a\u7684\u90e8\u5206\u8d21\u732e\u4e3a0).\u8fd9\u6837\u7684\u8bdd,\u4e00\u4e2a\u5e76\u67e5\u96c6\u5c31\u884c\u4e86,\u7ef4\u62a4$x$\u548c$fa_x$\u662f\u5426\u540c\u8272\u5373\u53ef.\u63d2\u53d9\u722c\u5230\u6839!. \u8fd9\u88ab\u79f0\u4e3a\u5e26\u6743\u5e76\u67e5\u96c6,\u5728NOIP\u4e00\u9898\u5173\u62bc\u7f6a\u72af\u4e2d,\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u6280\u5de7\u5f97\u5230\u8d2a\u5fc3\u7684\u505a\u6cd5.NOI\u4e00\u9898\u98df\u7269\u94fe\u4e2d\u4e5f\u6709\u76f8\u4f3c\u7684\u73a9\u6cd5.\n\n\n----\n\n\u7a0d\u4f5c\u6574\u7406,\u6211\u4eec\u8003\u8651\u52a8\u6001\u52a0\u8fb9\u5e76\u5224\u5b9a\u4e8c\u5206\u56fe,\u5982\u679c\u8fde\u8fb9\u524d\u4e0d\u8fde\u901a,\u90a3\u4e48\u901a\u8fc7\u53cd\u8272\u64cd\u4f5c\u53ef\u4ee5\u6784\u9020\u51fa\u65b0\u7684\u67d3\u8272\u65b9\u6848,\u5982\u679c\u8fde\u901a,\u67e5\u8be2\u662f\u5426\u989c\u8272\u4e0d\u540c,\u8fd9\u53ef\u4ee5\u901a\u8fc7\u7ef4\u62a4\u4e00\u4e2a\u751f\u6210\u6811\u5e76\u67e5\u8be2\u4e24\u70b9\u95f4\u7684\u8fb9\u6570\u6a212\u6765\u5b8c\u6210,\u66f4\u8fdb\u4e00\u6b65\u5730,\u8fd9\u4e2a\u53ef\u4ee5\u4f7f\u7528\u5e76\u67e5\u96c6\u8fd9\u4e2a\u5165\u95e8\u6570\u636e\u7ed3\u6784\u6765\u5b8c\u6210.  \n\n\n\u56de\u5230\u672c\u9898,\u6211\u4eec\u5982\u679c\u6bcf\u6b21\u8003\u8651\u4e00\u6761\u8fb9,\u52a0\u5165\u5176\u5b83\u6240\u6709\u8fb9\u4e4b\u540e\u8fdb\u884c\u5224\u5b9a,\u590d\u6742\u5ea6\u4e00\u5b9a\u4f1a\u5230\u8fbe$\\Omega(n^2)$\u4e0d\u53ef\u80fd\u901a\u8fc7\u672c\u9898,\u8003\u8651\u5206\u522b\u5220\u6389$e_i$\u548c$e_j$\u5269\u4f59\u7684\u56fe\u6709\u5927\u91cf\u76f8\u540c\u8fb9,\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a **\u79fb\u52a8\u800c\u975e\u91cd\u6784** (\u7c7b\u4f3c\u83ab\u961f\u8f6c\u79fb)\u7684\u64cd\u4f5c,\u53ef\u4ee5\u964d\u4f4e\u590d\u6742\u5ea6( **\u4f46\u662f\u52a0\u5220\u8fb9\u6b21\u6570\u4ecd\u7136\u6ca1\u6709\u826f\u597d\u7684\u4e0a\u754c** ),\u4f46\u662f\u6709\u5220\u8fb9\u7684\u8bdd,\u4e0d\u8bba\u662fUFS\u8fd8\u662fLCT\u90fd\u4e0d\u5bb9\u6613\u5b9e\u73b0, ~~\u4f60\u5f53\u7136\u53ef\u4ee5ETT\u6253\u8fc7\u53bb~~ \u6211\u4eec\u8003\u8651\u7528\u64a4\u9500\u4ee3\u66ff\u5220\u9664,LCT\u7ef4\u62a4\u751f\u6210\u6811\u64a4\u9500\u52a0\u8fb9\u662ftrivial\u7684,UFS\u7ef4\u62a4\u5982\u679c\u4f7f\u7528\u6309size/height\u5408\u5e76,\u6bcf\u6b21\u5408\u5e76\u6539\u53d8\u7684\u8fb9\u6570\u662f$O(1)$\u7684,\u53ef\u4ee5\u5feb\u901f\u64a4\u9500.\n\n\n----\n\n\n\u6700\u540e,\u6211\u4eec\u8003\u8651\u63a7\u5236\u52a0\u8fb9/\u64a4\u9500\u7684\u6b21\u6570.\u4f7f\u7528\u8fd9\u6837\u4e00\u4e2a\u6280\u5de7.\n```python\n\nsolve [l,r),f:\n    if len([l,r)) <= 1:\n        return qwq(f)\n        \n    g=f.apply(a[l,mid))\n    solve[l,mid),g\n    \n    g=f.apply(a[mid,r))\n    solve[mid,r),g\n    \n```\n\n\u8003\u8651\u4e00\u4e2a$a_i$\u88ab\u52a0\u5165\u7684\u6b21\u6570,\u662f$O(logn)$\u7684,\u4e3a\u4ec0\u4e48\u5462?\u8003\u8651solve\u7684\u9012\u5f52\u6811\u4e0a\u53f6\u5b50$i$\u5230\u6839\u7684\u94fe,solve\u8d70\u5230\u8fd9\u4e0a\u9762\u7684\u8282\u70b9,\u624d\u4f1aapply\u4e00\u6b21$a_i$,\u6bcf\u6b21\u533a\u95f4\u957f\u5ea6\u51cf\u534a,\u6811\u9ad8\u662f$O(logn)$\u7684,(\u7ebf\u6bb5\u6811\u5206\u6cbb\u5176\u5b9e\u548c\u8fd9\u4e2a\u8bf4\u7684\u4e00\u56de\u4e8b...)\n\n\u8003\u8651\u4e00\u6b21solve\u4e2d\u7684\u4e24\u6b21apply,\u5982\u679c\u6211\u4eec\u7528\u53ef\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784\u590d\u5236f,\u90a3\u4e48\u76f4\u63a5\u5f97\u5230\u65f6\u95f4\u590d\u6742\u5ea6\u6b63\u786e\u7684\u7b97\u6cd5(\u53ef\u6301\u4e45\u5316LCT\u6bd4\u8f83\u9ebb\u70e6\u9700\u8981\u53bb\u6389\u5747\u644a,\u4f46\u662f\u53ef\u6301\u4e45\u5316\u5e76\u8336\u96c6\u5f88\u5bb9\u6613\u5b9e\u73b0.).\u4f46\u662f\u6211\u4eec\u6709\u64a4\u9500\u4ee3\u66ff\u5220\u9664. \n\u8003\u8651\u9012\u5f52\u8fc7\u7a0b,\u9000\u6808return \u7684\u65f6\u5019,\u9700\u8981\u64a4\u9500\u7684\u8fb9\u4e00\u5b9a\u662f\u8fdb\u5165\u4e0b\u4e00\u5c42\u524d\u52a0\u5165\u7684,\u53cd\u5411\u6309\u987a\u5e8f\u64a4\u9500\u5b8c\u5168\u6ca1\u6709\u95ee\u9898.  \n\n\u6700\u540e\u6211\u4eec\u7b80\u7565\u5730\u8003\u8651\u7b97\u6cd5\u6b63\u786e\u6027,\u53d1\u73b0\u8fdb\u5165$[l,r]$\u65f6,$[0,l)\\cup (r,m)$ \u7684\u5143\u7d20\u90fd\u5df2\u7ecf\u88abapply\u4e86. \n\u4e3a\u4ec0\u4e48\u5462?\u8003\u8651\u9012\u5f52\u6811\u7684\u6839,\u663e\u7136\u6210\u7acb,\u540e\u9762\u7684\u533a\u95f4\u662f\u7a7a\u7684...\u5982\u679c\u5728$[l,r)$\u5904\u6210\u7acb,\u90a3\u4e48\u8fdb\u5165$[l,mid)$\u65f6,\u8fd8\u9700\u8981apply\u7684\u90e8\u5206\u6b63\u662f$[mid,r)$ \u5bf9\u4e8e$[mid,r)$\u540c\u7406. \u8fd9\u4e2a\u6027\u8d28\u80fd\u591f\u4e00\u76f4\u4fdd\u6301,\u6240\u4ee5\u5230\u8fbe\u9012\u5f52\u6811\u7684\u53f6\u5b50$[l,l+1)$\u65f6,\u53ea\u6709$a_i$\u6ca1\u6709\u88ab\u52a0\u5165,\u7b26\u5408\u6211\u4eec\u7684\u9700\u8981.\n\n\n---\n\n\n\u7ec8\u4e8e\u8bb2\u89e3\u5b8c\u4e86,\u6211\u4eec\u7a0d\u4f5c\u6574\u7406\u6765\u770b\u4ee3\u7801.\n\n- \u7528\u5e76\u67e5\u96c6(\u5e26\u6743\u6280\u5de7,\u7ef4\u62a4\u7236\u5b50\u95f4\u8fb9\u7684\u6743,\u722cparent\u65f6\u7d2f\u79ef)\u7ef4\u62a4\u67d3\u8272\u65b9\u6848,(\u6211\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u4e86\u6309\u5b50\u6811size\u548c\u5e76,\u4f46\u662f\u5e76\u6ca1\u6709\u8fdb\u884c\u91cd\u6784\u4fdd\u8bc1\u6811\u9ad8\u4e3a$O(1)$\u56e0\u4e3a\u90a3\u6837\u4e0d\u65b9\u4fbf\u64a4\u9500,\u7a0d\u4f5c\u5206\u6790\u8fd9\u6837\u590d\u6742\u5ea6\u4ecd\u7136\u662f\u4f18\u79c0\u7684\u5355\u6b21$O(logn)$)  \n- (\u79bb\u7ebf\u60c5\u51b5\u4e0b)\u7528\u64a4\u9500\u4ee3\u66ff \u5220\u9664/\u91cd\u6784 \u8ba9\u6211\u4eec\u53ea\u9700\u8981\u5199\u4e00\u4e2a\u7b80\u5355\u7684UFS.(\u5f53\u7136\u53ef\u4ee5\u5199LCT\u5566...)\u5c31\u53ef\u4ee5\u7ef4\u62a4\u52a8\u6001\u56fe.\n- \u5206\u6cbb\u4fdd\u8bc1\u63d2\u5165/\u64a4\u9500 \u6b21\u6570,\u7ef4\u6301 **\u5916\u90e8\u8d21\u732e\u5168\u90e8\u8ba1\u7b97** \u7684\u6027\u8d28,\u5230\u8fbe\u53f6\u5b50\u5373\u53ef\u8ba1\u7b97\u7b54\u6848.\n\n\u6700\u540e\u8bf4\u4e00\u4e0b\u590d\u6742\u5ea6,\u7a7a\u95f4$O(n)$\u65f6\u95f4$O(nlog^2n)$.\n\n\u7b80\u5355\u8ba1\u7b97,\u8003\u8651\u9012\u5f52\u8fc7\u7a0b,\u7b2c$i$\u5c42\u4fdd\u5b58$\\frac{n}{2^i}$\u4e2a\u52a0\u5165\u7684\u8fb9,\u9000\u6808\u8fdb\u5165\u53e6\u4e00\u534a\u65f6\u53ef\u4ee5\u6254\u6389\u4e4b\u524d\u7684\u7a7a\u95f4.\u5171$O(n)$.\n\u65f6\u95f4\u590d\u6742\u5ea6,\u8003\u8651\u4e00\u6761\u8fb9\u88ab\u63d2\u5165$O(logn)$\u6b21,\u6211\u5b9e\u73b0\u7684\u5e76\u67e5\u96c6\u662f\u5355\u6b21$O(logn)$\u7684.\u7136\u540e\u5c31\u6ca1\u4e86.\n\n\u6700\u540e\u7ed9\u51fa\u6211\u7684\u4ee3\u7801,\u7b2c\u4e00\u6b21MLE\u662f\u6ca1\u5224\u7a7a\u533a\u95f4....\u73b0\u5728\u53ef\u4ee5\u6b63\u5e38AC.\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u7528\u53ef\u6301\u4e45\u5316\u5e76\u67e5\u96c6\u8fdb\u884c\u590d\u5236\u800c\u975e\u64a4\u9500 ~~\u548c\u6211\u6bd4\u4e00\u6bd4~~ \u6216\u8005\u4f7f\u7528LCT\u7ef4\u62a4\u751f\u6210\u6811\u90fd\u53ef\u4ee5\u901a\u8fc7\u672c\u9898.\n\n\n```cpp\n// \u6211\u662f\u4e2a\u61d2\u4eba23333,\u542c\u8bf4BJOI2019\u5728NOI linux\u4e0a\u5b8c,\u8fd9\u4e2a\u53ef\u4ee5\u653e\u5fc3\u7528\u4e86.\n#include <bits/stdc++.h>\nint read(){\n\tint x=0;char c;\n\tdo{c=getchar();}while(!isdigit(c));\n\tdo{x=x*10+c-'0';c=getchar();}while(isdigit(c));\n\treturn x;\n}\nconst int N=10000+10;\n// \u5b58\u7b54\u6848\u7528\u7684...\nstd::vector<int> ans;\nint n,m;\nstruct E{ int u,v; }e[N];\n\n// \u8fd9\u91cc\u5e26\u6743\u5e76\u67e5\u96c6.dis[x]\u8868\u793afa[x]\u4e0ex\u662f\u5426\u540c\u8272.\nint fa[N],size[N],dis[N];\nint getpar(int x){\n\twhile(fa[x]!=x) x=fa[x];\n\treturn x;\n}\n// \u8fd9\u91cc\u7684xor\u5c31\u662f(a+b)%2.\u753b\u4e2a\u771f\u503c\u8868\u5c31\u77e5\u9053\u6b63\u786e\u6027\u4e86.\nint getdis(int x){\n\tint y=0;\n\twhile(fa[x]!=x){ y^=dis[x]; x=fa[x]; }\n\treturn y;\n}\n// \u8bb0\u5f55\u5408\u5e76\u8fc7\u7a0b\u7528\u7684.\n// merged (from->to),  from.size=fsz;\nstruct P{\n\tint from,to,fsz;\n\tP(int a,int b,int c){ from=a; to=b; fsz=c; }\n};\n// \u5c31\u662fapply.\nP use(int eid,int &flag){\n\tint fx=getpar(e[eid].u),dx=getdis(e[eid].u);\n\tint fy=getpar(e[eid].v),dy=getdis(e[eid].v);\n    \n    // \u6211\u4e0d\u4f1a\u6309height\u5408\u5e76\u554aQAQ...\n\tif(size[fx]>size[fy]){\n\t\tstd::swap(fx,fy);\n\t\tstd::swap(dx,dy);\n\t}\n\t// s[x]<s[y]: x->y;\n    \n    // case1:\u5728\u540c\u4e00\u4e2a\u96c6\u5408\u4e2d,\u5224\u5b9a\u53ef\u884c.\n\tif(fx==fy){\n\t\tif(dx==dy) flag=1;\n\t\treturn P(0,0,0);\n\t}\n    // case2:\u4e4b\u524d\u5e76\u4e0d\u8fde\u901a,\u53cd\u8272\u5fc5\u5b9a\u5f97\u5230\u53ef\u884c\u65b9\u6848.\n\tsize[fy]+=size[fx];\n\tfa[fx]=fy;\n\tdis[fx]=(dx^dy^1);\n    \n    // \u8bb0\u5f55\u5408\u5e76\u8fc7\u7a0b.\n\treturn P(fx,fy,size[fx]);\n}\n// \u7b80\u6613\u64a4\u9500...\u6ca1\u7684\u8bf4\nvoid back(const P& p){\n\tif(p.from==0) return ;\n\tint x=p.from,y=p.to,q=p.fsz;\n\tfa[x]=x;dis[x]=0; size[y]-=q;\n}\n\n// check e \\in [l,r) \n// \u6211\u6c38\u8fdc\u559c\u6b22\u5de6\u95ed\u53f3\u5f00.\nvoid solve(int l,int r,int f=0){\n\tif(l>=r) return ;\n\tif(r-l==1){\n\t\tif(f==0) ans.push_back(l);\n\t\treturn ;\n\t}\n    // \u8fd9\u4e2astack\u4f60\u53ef\u4ee5\u653e\u5916\u8fb9\u53bb...\u53cd\u6b63CF\u4f1a\u5f00\u6808\u7a7a\u95f4\u7206\u4e0d\u4e86..\n    // \u8003\u8651\u9012\u5f52\u8fc7\u7a0b\u64a4\u9500\u662f\u6709\u5e8f\u7684,\u5171\u7528\u4e00\u4e2astack\u5b8c\u5168\u6ca1\u95ee\u9898.\n\tstd::stack<P> stk;\n\tint mid=(l+r)>>1,g=0;\n\n\t// apply\u53f3\u8fb9,\u5411\u5de6\u8fb9\u903c\u8fd1\n\tg=f;\n\tfor(int i=mid;i<r;i++) stk.push(use(i,g));\n\tsolve(l,mid,g);\n\twhile(!stk.empty()){ back(stk.top()); stk.pop(); }\n\n\t// \u540c\u7406...\n\tg=f;\n\tfor(int i=l;i<mid;i++) stk.push(use(i,g));\n\tsolve(mid,r,g);\n\twhile(!stk.empty()){ back(stk.top()); stk.pop(); }\n}\n\n\nint main(){\n\t//freopen(\"in\",\"r\",stdin);\n\tn=read();m=read();\n\tfor(int i=0;i<m;i++){\n\t\te[i].u=read();e[i].v=read();\n\t}\n\tfor(int i=1;i<=n;i++) size[fa[i]=i]=1;\n\tsolve(0,m);\n\tprintf(\"%d\\n\",ans.size());\n\tfor(auto x:ans) printf(\"%d \",x+1);\n\tprintf(\"\\n\");\n\n\treturn 0;\n}\n\n\n``` \t\n\n\n\n\u5b8c\u7ed3\u6492\u82b1.\n~~bjoi2019 rp++~~\n\n",
        "postTime": 1553654513,
        "uid": 15295,
        "name": "hehelego",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u4e00\u5f20\u65e0\u5411\u56fe\uff0c\u6c42\u5220\u6389\u54ea\u51e0\u6761\u8fb9\u53ef\u4ee5\u53d8\u6210\u4e8c\u5206\u56fe\uff1b\n\n## \u65b9\u6cd5\n\n\u5982\u679c\u6ca1\u6709\u5947\u73af\uff0c\u4efb\u4f55\u8fb9\u90fd\u53ef\u4ee5\u5220\uff1b\n\n\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5947\u73af\uff0c\u90a3\u4e48\u5947\u73af\u4e0a\u7684\u8fb9\u90fd\u53ef\u4ee5\u88ab\u5220\uff1b\n\n\u5982\u679c\u591a\u4e8e1\u4e2a\uff0c\u5fc5\u987b\u9009\u5728\u6240\u6709\u5947\u73af\u4e14\u4e0d\u5728\u5076\u73af\u4e0a\u7684\u70b9\uff1b\n\n\u6839\u636e\u6811\u4e0a\u5dee\u5206\u7684\u65b9\u6cd5\uff0c\u5e94\u8be5\u5728\u4e24\u4e2a\u7aef\u70b9+1\uff0cLCA-2\uff0c\u800c**DFS\u6811\u65e0\u6a2a\u53c9\u8fb9**\uff0c\u6240\u4ee5LCA\u5c31\u662f\u6df1\u5ea6\u8f83\u6d45\u7684\u70b9\uff0c\u5c06\u5b83+1-2\u5373\u53ef\uff1b\n\n\u7edf\u8ba1tag==n\u7684\u70b9\uff0c\u5176\u7236\u8fb9\u5c31\u662fans\uff1b\n\n## \u4ee3\u7801\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cmath>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<vector>\n#include<map>\n#include<set>\n#include<list>\n#include<queue>\n#include<stack>\n#include<bitset>\n#include<deque>\nusing namespace std;\n#define ll long long\n#define inf 0x3f3f3f3f\n#define ri register int\n#define il inline\n#define fi first\n#define se second\n#define mp make_pair\n#define pi pair<int,int>\n#define mem0(x) memset((x),0,sizeof (x))\n#define mem1(x) memset((x),0x3f,sizeof (x))\n#define gc getchar\n#define pb push_back\ntemplate<class T>void in(T &x)\n{\n    x = 0; bool f = 0; char c = gc();\n    while (c < '0' || c > '9') {if (c == '-') f = 1; c = gc();}\n    while ('0' <= c && c <= '9') {x = (x << 3) + (x << 1) + (c ^ 48); c = gc();}\n    if (f) x = -x;\n}\n#undef gc\nvoid out(int x) {\n    if (x < 0) putchar('-'), x = -x;\n    if (x > 9) out(x / 10);\n    putchar(x % 10 + '0');\n}\n#define N 10010\n#define M N<<2\nint n, m;\nint v[M], u[M], nx[M], k[M];\nint cnt = 1, head[N];\nil void add(int uu, int vv) {\n    u[++cnt] = uu, v[cnt] = vv, nx[cnt] = head[uu];\n    head[uu] = cnt;\n    k[cnt] = (cnt >> 1);\n}\nint dep[N];\nbool vis[N];\nint tag[N];\nint zt;\nvector<int>ans;\nint lst;\nvoid dfs(int x, int f, int d) {\n\t//printf(\"V %d\\n\",x);\n    dep[x] = d;\n    vis[x] = 1;\n    for (ri i = head[x]; i; i = nx[i]) {\n        if (i == f) continue;\n        if (!vis[v[i]]) {\n            dfs(v[i], i ^ 1, d + 1);\n        }\n        else {\n            if (dep[v[i]] < dep[x]) continue;\n            if ((dep[v[i]] - dep[x] + 1) & 1) {\n                tag[x]--;  // in fact +1 -2\n                tag[v[i]]++;\n                zt++;\n                lst=k[i];\n            }\n            else {\n                tag[x]++;\n                tag[v[i]]--;\n            }\n        }\n    }\n}\nint dfs2(int x, int f) {\n    vis[x] = 1;\n    int res = tag[x];\n    for (ri i = head[x]; i; i = nx[i]) {\n        if (vis[v[i]]) continue;\n        res += dfs2(v[i], i);\n    }\n    if (res == zt) ans.pb(k[f]);\n    //printf(\"T %d %d %d\\n\",x,res,tag[x]);\n    return res;\n}\nsigned main() {\n    in(n), in(m);\n    for (ri i = 1, a, b; i <= m; ++i) {\n        in(a), in(b);\n        add(a, b);\n        add(b, a);\n    }\n    for (ri i = 1; i <= n; ++i) {\n        if (!vis[i]) dfs(i, 0, 0);\n    }\n    if (zt == 0) {\n        //cout << \"A\";\n        printf(\"%d\\n\", m);\n        for (ri i = 1; i <= m; ++i) printf(\"%d \", i);\n        return 0;\n    }\n    if(zt==1) ans.pb(lst);\n    //cout<<zt;\n    mem0(vis);\n    for (ri i = 1; i <= n; ++i) {\n        if (!vis[i]) dfs2(i, 0);\n    }\n    sort(ans.begin(), ans.end());\n    printf(\"%d\\n\", ans.size());\n    for (ri i = 0; i < ans.size(); ++i) {\n        printf(\"%d \", ans[i]);\n    }\n    return 0;\n}\n```",
        "postTime": 1531036958,
        "uid": 58302,
        "name": "i207M",
        "ccfLevel": 0,
        "title": "\u597d\u9898-Fairy-\u89e3\u9898\u62a5\u544a"
    },
    {
        "content": "\u5148\u5410\u69fd\u4e00\u4e0b\u672c\u9898\u7ffb\u8bd1\uff0c\u8fd9\u662f\u673a\u7ffb\u5427\u3002\u3002\u3002\n\n### \u9898\u610f\uff1a\n\n\u7ed9\u4f60\u4e00\u4e2a $n$ \u4e2a\u70b9\u3001 $m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe\uff0c\u53ef\u4ee5\u4ece\u56fe\u4e2d\u5220\u9664\u4e00\u6761\u8fb9\uff0c\u95ee\u5220\u9664\u54ea\u4e9b\u8fb9\u53ef\u4ee5\u4f7f\u56fe\u53d8\u6210\u4e00\u4e2a\u4e8c\u5206\u56fe\u3002\n\n### \u5148\u8bf4\u4e00\u4e0b\u4ec0\u4e48\u662f\u4e8c\u5206\u56fe\uff1a\n\n\u4e8c\u5206\u56fe\u7684\u8282\u70b9\u7531\u4e24\u4e2a\u96c6\u5408\u7ec4\u6210\uff0c\u800c\u4e14\u4e24\u4e2a\u96c6\u5408\u5185\u90e8\u6ca1\u6709\u8fb9\u3002\n\n\u6362\u8a00\u4e4b\uff0c\u5982\u679c\u8fd9\u662f\u4e00\u4e2a\u4e8c\u5206\u56fe\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a\u5b58\u5728\u4e00\u79cd\u65b9\u6848\uff0c\u5c06\u8282\u70b9\u5212\u5206\u6210\u6ee1\u8db3\u4ee5\u4e0a\u6027\u8d28\u7684\u4e24\u4e2a\u96c6\u5408\u3002    \u2014\u2014\u4ee5\u4e0a\u6458\u81eaOI Wiki\uff0c\u6709\u5220\u6539\u3002\n\n### \u4e0d\u96be\u53d1\u73b0\u4e8c\u5206\u56fe\u7684\u4e00\u4e9b\u6027\u8d28\uff1a\n\n1. \u4e8c\u5206\u56fe\u4e0d\u5b58\u5728\u5947\u73af\uff1b\n2. \u4e00\u68f5\u6811\u4e00\u5b9a\u662f\u4e8c\u5206\u56fe\uff1b\n3. \u4e00\u4e2a\u4e8c\u5206\u56fe\u5220\u6389\u4e00\u6761\u8fb9\u4e5f\u662f\u4e8c\u5206\u56fe\uff1b\n4. \u5047\u8bbe\u73b0\u5728\u6709\u4e00\u68f5\u6811\uff0c\u5728\u6811\u4e0a\u53d6\u4e24\u4e2a\u8282\u70b9 u \u548c v \uff0c\u5982\u679c u \u548c v \u7684\u6700\u77ed\u8def\u662f\u5947\u6570\uff0c\u8fde\u63a5 u , v \uff0c\u5219\u51fa\u73b0\u5076\u73af\uff08\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u73af\uff09\uff1b\u5982\u679c u \u548c v \u7684\u6700\u77ed\u8def\u662f\u5076\u6570\uff0c\u8fde\u63a5 u , v \uff0c\u5219\u51fa\u73b0\u5947\u73af\uff08\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u73af\uff09\uff1b\n5. \u5982\u679c\u5c06\u4e24\u4e2a\u96c6\u5408\u7684\u70b9\u5206\u522b\u67d3\u6210\u9ed1\u8272\u548c\u767d\u8272\uff0c\u5219\u6bcf\u4e00\u6761\u8fb9\u4e00\u5b9a\u8fde\u63a5\u7740\u4e00\u4e2a\u9ed1\u8272\u70b9\u548c\u767d\u8272\u70b9\u3002\n\n### \u66b4\u529b\uff1a\n\n\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u6761\u8fb9\uff0c\u5c06\u5176\u5220\u53bb\uff0c\u7136\u540e\u505a\u4e00\u6b21dfs\u6216bfs\uff0c\u7ed9\u6bcf\u4e2a\u70b9\u67d3\u8272\uff0c\u6700\u540e\u5224\u65ad\u6709\u6ca1\u6709\u4e24\u4e2a\u76f8\u90bb\u7684\u70b9\u989c\u8272\u76f8\u540c\u3002\n\n\u4ee3\u7801\u7565\u3002~~\u61d2~~\n\n### \u6b63\u89e3\uff1a\n\n\u5bf9\u4e8e\u6027\u8d28\u4e8c\uff0c\u6211\u4eec\u968f\u610f\u6c42\u51fa\u4e00\u68f5\u751f\u6210\u6811\uff0c\u7136\u540e\u7531\u6027\u8d28\u56db\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5269\u4e0b\u7684\u8fb9\u4e00\u6761\u6761\u5730\u653e\u5728\u6811\u4e0a\uff0c\u5224\u65ad\u8fd9\u6761\u8fb9\u4f1a\u4e0d\u4f1a\u6784\u6210\u5947\u73af\uff0c\u5e76\u7edf\u8ba1\u5947\u73af\u4e2a\u6570 sum \u3002\n\n\u4ee5\u4e0b\u628a\u4f1a\u6784\u6210\u5947\u73af\u7684\u8fb9\u53eb\u505a A \u7c7b\u8fb9\uff0c\u4e0d\u4f1a\u6784\u6210\u5947\u73af\u7684\u8fb9\u53eb\u505a B \u7c7b\u8fb9\uff0c\u5176\u4e2d A \u7c7b\u8fb9\u548c B \u7c7b\u8fb9\u90fd\u4e0d\u662f\u6811\u4e0a\u7684\u8fb9\u3002\n\n\u5b9a\u4e49\u975e\u6811\u4e0a\u8fb9 (u,v) \u5305\u542b\u6811\u4e0a\u7684\u4e00\u6761\u8fb9 (uu,vv) \uff0c\u5f53\u4e14\u4ec5\u5f53 u \u5230 v \u7684\u6700\u77ed\u8def\u4e0a\u6709\u8fb9 (uu,vv) \u3002\n\n\u7531\u6027\u8d28\u4e09\uff0c\u5982\u679c sum = 0 \uff0c\u8f93\u51fa\u6bcf\u4e00\u6761\u8fb9\u5373\u53ef\u3002\n\n\u518d\u591a\u4e3e\u51e0\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c sum = 1 \uff0c\u90a3\u5c31\u662f\u53ea\u6709\u4e00\u6761 A \u7c7b\u8fb9\uff0c\u5219\u8981\u4e48\u5220\u6389 A \u7c7b\u8fb9\uff0c\u8981\u4e48\u5728 A \u7c7b\u8fb9\u5305\u542b\u7684\u6811\u4e0a\u8fb9\u627e\u4e00\u6761 B \u7c7b\u8fb9\u4e0d\u5305\u542b\u7684\u8fb9\u5e76\u5220\u6389\u3002\n\n\u5982\u679c sum >= 2 \uff0c\u90a3\u53ea\u80fd\u5728\u6811\u4e0a\u5220\u9664\u90a3\u4e9b\u88ab\u6240\u6709 A \u7c7b\u8fb9\u5305\u542b\u4e14\u4e0d\u88ab\u4efb\u4f55\u4e00\u6761 B \u7c7b\u8fb9\u5305\u542b\u7684\u8fb9\u4e86\u3002\u8003\u8651\u7528\u6811\u4e0a\u5dee\u5206\u8fdb\u884c\u7ef4\u62a4\uff0c\u5b9a\u4e49 $s[i]$ \u8868\u793a\u8282\u70b9 i \u548c\u5b83\u7236\u4eb2\u7684\u5dee\u5206\uff0c\u5982\u679c\u627e\u5230\u4e00\u6761 A \u7c7b\u8fb9 (u,v) \uff0c\u5219\u628a (u,v) \u7684\u6811\u4e0a\u6700\u77ed\u8def\u7ecf\u8fc7\u7684\u70b9+1\uff1b\u5982\u679c\u627e\u5230\u4e00\u6761 B\u7c7b\u8fb9 (u,v) \uff0c \u5219\u628a (u,v) \u7684\u6811\u4e0a\u6700\u77ed\u8def\u7ecf\u8fc7\u7684\u70b9-1\u3002\u7528\u5dee\u5206\u6765\u7ef4\u62a4\u5c31\u662f $s[u]++$ \uff0c $s[v]++$ \uff0c $s[lca(u,v)]-=2$ \u3002\n\n\u6ce8\u610f\uff0c\u9898\u76ee\u6ca1\u6709\u8bf4\u660e\u56fe\u7684\u5176\u4ed6\u6027\u8d28\uff0c\u6240\u4ee5\u8bb0\u4f4f\uff0c\u53ef\u80fd\u6709\u81ea\u73af\uff0c\u53ef\u80fd\u6709\u91cd\u8fb9\uff0c\u53ef\u80fd\u4e0d\u8fde\u901a\n\n```cpp\n#include<stdio.h>\n#include<algorithm>\n#include<map>\n#define pii pair<int,int>\n#define N 100000\n#define M 200000\nusing namespace std;\nint n,m;\nstruct edge{\n\tint to,nxt;\n}e1[M+5],e2[M+5];//\u6811\u8fb9\uff0c\u9664\u4e86\u6811\u7684\u8fb9\n\nint hed1[M+5],cnt1;\nint hed2[M+5],cnt2;\ninline void add1(int u,int v){\n\te1[++cnt1].to = v,e1[cnt1].nxt = hed1[u];\n\thed1[u] = cnt1;\n}\n\ninline void add2(int u,int v){\n\te2[++cnt2].to = v,e2[cnt2].nxt = hed2[u];\n\thed2[u] = cnt2;\n}\n\nstruct node{\n\tint u,v,id;\n}a[100005],ano[100005];//\u9898\u76ee\u7ed9\u51fa\u7684\u56fe\uff0c\u9664\u4e86\u6811\u7684\u8fb9 \nint tot;\n\nint fa[100005];\ninline int getf(int x){return (x == fa[x])?x:fa[x] = getf(fa[x]);}\ninline void merge(int u,int v){\n\tint U = getf(u),V = getf(v);\n\tfa[V] = U;\n}//\u5e76\u67e5\u96c6\n\nint lg[100005];//\u5e38\u6570\u4f18\u5316\nint f[100005][25];//\u500d\u589e\u6c42LCA\nint dep[100005],dis[100005];\nbool vis1[100005];//\u56e0\u4e3a\u56fe\u53ef\u80fd\u4e0d\u8fde\u901a\uff0c\u6240\u4ee5\u8981\u7528vis\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u662f\u5426\u7ecf\u8fc7\ninline void dfs(int u,int fa){\n\tdep[u] = dep[fa]+1,f[u][0] = fa;\n\tvis1[u] = true;\n\tfor(int i = 1;(1<<i)<=dep[u];++i){\n\t\tf[u][i] = f[f[u][i-1]][i-1];\n\t}\n\tfor(int i = hed1[u];i;i = e1[i].nxt){\n\t\tint v = e1[i].to;\n\t\tif(v != fa) dis[v] = dis[u]+1,dfs(v,u);\n\t}\n}\n\ninline int lca(int x,int y){\n\tif(dep[x] < dep[y]) swap(x,y);\n\twhile(dep[x] > dep[y]) x = f[x][lg[dep[x]-dep[y]]-1];\n\tif(x == y) return x;\n\tfor(int i = lg[dep[x]];i>=0;--i){\n\t\tif(f[x][i] != f[y][i]){\n\t\t\tx = f[x][i],y = f[y][i];\n\t\t}\n\t}\n\treturn f[x][0];\n}\n\nint sum;//\u5947\u73af\u4e2a\u6570 \nmap<pii,int> mp;//\u8bb0\u5f55\u8fb9(u,v)\u662f\u7b2c\u51e0\u6761\u8fb9\ninline void _readin_(){//\u8bfb\u5165\n\tscanf(\"%d%d\",&n,&m);\n\tint u,v;\n\tint sum_of_edge = 0;\n\tfor(int i = 1;i<=m;++i){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tif(u != v){//\u5904\u7406\u81ea\u73af\n\t\t\ta[++sum_of_edge].u = u,a[sum_of_edge].v = v,a[sum_of_edge].id = sum_of_edge;\n\t\t\tpii add_in1 = make_pair(u,v),add_in2 = make_pair(v,u);//\u53cc\u5411\u8fb9\n\t\t\tmp[add_in1] = sum_of_edge;\n\t\t\tmp[add_in2] = sum_of_edge;\n\t\t}\n\t}\n\tm = sum_of_edge;\n}\n\ninline void _init_(){//\u521d\u59cb\u5316\n\tfor(int i = 1;i<=n;++i) fa[i] = i;\n\tfor(int i = 1;i<=N+1;++i) lg[i] = lg[i-1]+(1<<lg[i-1] == i);//\u5e38\u6570\u4f18\u5316 \n}\n\nint s[N+5];//i\u4e0e\u5b83\u7236\u4eb2\u7684\u5dee\u5206\u503c\n\nint ans[N+5],cnt;//\u7b54\u6848\u6570\u7ec4\u548c\u7b54\u6848\u6570\u7ec4\u7684\u5927\u5c0f\n\nbool vis2[N+5];\n\ninline void bfs(int u,int fa){//\u6c42\u5dee\u5206\u548c \n\tvis2[u] = true;\n\tfor(int i = hed1[u];i;i = e1[i].nxt){\n\t\tint v = e1[i].to;\n\t\tif(v == fa) continue;\n\t\tbfs(v,u);\n\t\ts[u]+=s[v];\n\t}\n}\nint main(){\n\t_readin_();\n\t_init_();\n\t\n\tfor(int i = 1;i<=m;++i){\n\t\tint x = a[i].u,y = a[i].v,tp = a[i].id;\n\t\tint X = getf(x),Y = getf(y);\n\t\tif(getf(x) != getf(y)){\n\t\t\tmerge(x,y);\n\t\t\tadd1(x,y),add1(y,x);//\u968f\u610f\u6c42\u51fa\u4e00\u68f5\u751f\u6210\u6811\n\t\t}else{\n\t\t\tano[++tot].u = x,ano[tot].v = y,ano[tot].id = tp;//\u9664\u4e86\u6811\u7684\u8fb9\n\t\t\tadd2(x,y),add2(y,x);\n\t\t}\n\t}\n\tfor(int i = 1;i<=n;++i) if(!vis1[i]) dfs(i,i);//LCA\n\tint st,mid,ed,op;//\u5982\u679c\u6709\u4e00\u4e2a\u5947\u73af\uff0cu\uff0cLCA(u,v)\uff0cv\uff0cA\u7c7b\u8fb9\u7f16\u53f7 \n\tfor(int i = 1;i<=tot;++i){\n\t\tint x = ano[i].u,y = ano[i].v,tp = ano[i].id;\n\t\tint LCA = lca(x,y);\n\t\tint dist = dis[x]+dis[y]-2*dis[LCA];//\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u6700\u77ed\u8def\n\t\tif(dist%2 == 0){//\u5947\u73af \n\t\t\tsum++;\n\t\t\tst = x,mid = LCA,ed = y,op = tp;\n\t\t\ts[x]++,s[y]++,s[LCA]-=2;\n\t\t}else{\n\t\t\ts[x]--,s[y]--,s[LCA]+=2;\n\t\t}\n\t}\n\t\n\tfor(int i = 1;i<=n;++i) if(!vis2[i]) bfs(i,i);//\u5904\u7406\u5dee\u5206\n\tif(sum == 0){\n\t\tprintf(\"%d\\n\",m);\n\t\tif(m) for(int i = 1;i<=m;++i) printf(\"%d \",i);\n\t}else if(sum == 1){\n\t\tpii que_in;\n\t\tfor(int i = st;i!=mid;i = f[i][0]){//\u6811\u4e0a\u6bcf\u6761\u8fb9\u90fd\u8981\u627e\u4e00\u904d\n\t\t\tif(s[i] == 1){\n\t\t\t\tque_in = make_pair(i,f[i][0]);\n\t\t\t\tans[++cnt] = mp[que_in];\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor(int i = ed;i!=mid;i = f[i][0]){\n\t\t\tif(s[i] == 1){\n\t\t\t\tque_in = make_pair(i,f[i][0]);\n\t\t\t\tans[++cnt] = mp[que_in];\n\t\t\t}\n\t\t}\n\t\t\n\t\tans[++cnt] = op;\n\t\t\n\t\tsort(ans+1,ans+cnt+1);\n\t\tprintf(\"%d\\n\",cnt);\n\t\tif(cnt) for(int i = 1;i<=cnt;++i) printf(\"%d \",ans[i]);\n\t}else{\n\t\tpii que_in;\n\t\tfor(int i = 1;i<=n;++i){\n\t\t\tif(s[i] == sum){\n\t\t\t\tque_in = make_pair(i,f[i][0]);\n\t\t\t\tans[++cnt] = mp[que_in];\n\t\t\t}\n\t\t}\n\t\tsort(ans+1,ans+cnt+1);\n\t\tprintf(\"%d\\n\",cnt);\n\t\tif(cnt) for(int i = 1;i<=cnt;++i) printf(\"%d \",ans[i]);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1586226880,
        "uid": 114173,
        "name": "Computer1828",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "\u9898\u76ee\u94fe\u63a5\uff1a[Codeforces](https://codeforces.com/problemset/problem/19/E)\n\n## \u9898\u76ee\u5927\u610f\n\u7ed9\u4e00\u4e2a\u65e0\u5411\u56fe\uff0c\u8981\u6c42\u5220\u53bb\u4e00\u6761\u8fb9\uff0c\u8ba9\u5b83\u53d8\u4e3a\u4e8c\u5206\u56fe\u3002\u95ee\u54ea\u4e9b\u8fb9\u7b26\u5408\u8981\u6c42\uff1f\n\n## \u9898\u89e3\n\uff08\u8fd9\u9898\u8003\u8bd5\u65f6\u62ff\u6765\u52a0\u5f3a\u4e86\u4e00\u6ce2\uff0c\u8981\u6c42\u7ebf\u6027\u3002\u7ed3\u679c\u6211\u5206\u90e8\u5206\u5206\u5199\uff0c\u66b4\u529b\u6302\u4e86\u6b63\u89e3\u5bf9\u4e86\uff09\n\n\u9996\u5148\u4e8c\u5206\u56fe\u7684\u5145\u8981\u6761\u4ef6\u662f\u6ca1\u6709\u5947\u73af\uff0c\u7740\u91cd\u8003\u8651\u6709\u5947\u73af\u7684\u60c5\u51b5\uff08\u6ca1\u6709\u5947\u73af\u5219\u6240\u6709\u8fb9\u90fd\u53ef\u884c\u3002\uff09\uff1a\n\n\u663e\u7136\u8fd9\u6761\u8fb9\u5fc5\u987b\u5728\u540c\u65f6\u6240\u6709\u5947\u73af\u4e0a\uff0c\u4e8e\u662f\u6211\u4eec\u5148\u627e\u5230\u4e00\u4e2a\u5947\u73af\uff0c\u8bb0\u5b83\u4e3a\u73af $A$\u3002BFS+\u67d3\u8272\u5c31\u80fd\u5b9e\u73b0\u3002\u628a\u73af\u4e0a\u7684\u70b9\u548c\u8fb9\u8bb0\u5f55\u4e0b\u6765\u3002\n\n\u63a5\u7740\u8003\u8651\u5269\u4e0b\u7684\u5947\u73af\uff1a\n\n- \u82e5\u8fd9\u4e2a\u5947\u73af\u6ca1\u6709\u8fb9\u5728 $A$ \u4e0a\uff0c\u5219\u6ca1\u6709\u8fb9\u7b26\u5408\u8981\u6c42\u3002\n- \u82e5\u8fd9\u4e2a\u5947\u73af\u6709\u4e00\u4e9b\u8fb9\u5728 $A$ \u4e0a\uff0c\u5219\u8fd9\u4e9b\u8fb9\u4ee5\u5916\u7684\u8fb9\u90fd\u4e0d\u53ef\u884c\n\n\u6240\u4ee5\u5c06\u73af\u4e0a\u6240\u6709\u8fb9\u53bb\u6389\uff08\u6253\u4e2a\u6807\u8bb0\uff09\uff0c\u7b80\u5355\u5224\u65ad\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u7136\u540e\u4f9d\u6b21\u4ece\u73af\u4e0a\u7684\u70b9\u5f00\u59cb BFS\uff0c\u5bfb\u627e\u73af\u4e0a\u7684\u70b9\u5230\u53e6\u4e00\u4e2a\u70b9\u7684\u5404\u4e2a\u8def\u5f84\uff0c\u6bcf\u4e2a\u8def\u5f84\u90fd\u53ef\u4ee5\u4e0e $A$ \u7684\u8fde\u7eed\u4e00\u6bb5\u6784\u6210\u5947\u73af\u3002\u5982\u4e0b\u56fe\uff0c$\\color{#0080FF}\\text{\u6df1\u84dd\u8272}$\u7684\u73af\u5373\u73af $A$\uff0c$\\color{#66CCFF}\\text{\u6d45\u84dd\u8272}$\uff08\u53ca$\\color{#66FFFF}\\text{\u7eff\u8272}$\uff09\u7684\u8fb9\u4e0e\u73af\u4e0a\u7528\u5bf9\u5e94\u989c\u8272\u865a\u7ebf\u6807\u660e\u7684\u90e8\u5206\u6784\u6210\u5947\u73af\u3002\u7528$\\color{#EE0000}\\text{\u7ea2\u8272}$\u5708\u51fa\u7684\u8fb9\u5373\u7b26\u5408\u8981\u6c42\u7684\u8fb9\u3002\n\n![\u6817\u5b50](https://cdn.luogu.com.cn/upload/image_hosting/m08nuy8p.png)\n\n\u8003\u8651\u600e\u4e48\u7ef4\u62a4\u73af\u4e0a\u54ea\u4e9b\u8fb9\u7b26\u5408\u8981\u6c42\u3002\u8bb0\u5f55\u5e8f\u5217 $a$\uff08\u6bcf\u4e2a\u5143\u7d20\u5bf9\u5e94 $A$ \u7684\u4e00\u6761\u8fb9\uff09\u4e0e\u53d8\u91cf $cnt=0$\u3002\u6bcf\u6b21\u627e\u5230\u6709\u8fb9\u5728 $A$ \u4e0a\u7684\u73af\uff0c\u4fbf\u5c06 $cnt$ \u52a0\u4e00\uff0c$A$ \u4e0a\u7684\u8fd9\u4e00\u6bb5\u8fb9\u5728 $a$ \u4e0a\u5bf9\u5e94\u7684\u503c\u4e5f\u52a0\u4e00\u3002\u7531\u4e8e\u8fd9\u4e00\u6bb5\u8fb9\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\uff08\u628a\u73af\u62c6\u5f00\u6210\u94fe\u540e\u81f3\u591a\u5206\u6210\u4e24\u6bb5\uff09\uff0c\u53ef\u4ee5\u7528\u5dee\u5206\u6570\u7ec4\u7ef4\u62a4\u3002\u6700\u540e $O(N)$ \u626b\u4e00\u904d\uff0c$a_i=cnt$ \u8005\u5373\u7b26\u5408\u8981\u6c42\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N+M+k\\log k)$\uff08$k$ \u4e3a\u7b54\u6848\u6570\u91cf\uff09\n\n```cpp#include<bits/stdc++.h>\nusing namespace std;\nint getint(){\n\tint ans=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\tans=ans*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn ans*f;\n}\nconst int N=2000010,M=N<<1;\nstruct bian{\n\tint e,n;\n\tbool on;\n};\nbian b[M];\nint s[N],tot=1;\nvoid add(int x,int y){\n\ttot++;\n\tb[tot].e=y;\n\tb[tot].n=s[x];\n\ts[x]=tot;\n}\nint n,m;\n\nint col[N],dis[N];//col: \u67d3\u8272; dis: \u79bb BFS \u8d77\u70b9\u7684\u8ddd\u79bb\nint pre[N],preb[N];//pre: BFS \u65f6\u7684\u524d\u9a71; preb: BFS \u65f6\u7684\u524d\u4e00\u6761\u8fb9\nint huan[N],num[N];//huan: \u73af\u4e0a\u7b2c i \u4e2a\u70b9; num: \u70b9\u5728\u73af\u4e0a\u7684\u7f16\u53f7\nint huanb[N];//haunb: \u73af\u4e0a\u7684\u7b2c i \u6761\u8fb9\nint a[N];//a: \u9898\u89e3\u4e2d\u7684 a \u7684\u5dee\u5206\u6570\u7ec4\nint len,cnt=0;\n\nvoid record(int x,int y,int xtoy){//\u8bb0\u5f55\u5947\u73af\n\tint x_=x,y_=y;\n\twhile(dis[y]>dis[x]){\n\t\tb[preb[y]].on=b[preb[y]^1].on=1;\n\t\ty=pre[y];\n\t}\n\twhile(x!=y){\n\t\tb[preb[y]].on=b[preb[y]^1].on=1;\n\t\ty=pre[y];\n\t\tb[preb[x]].on=b[preb[x]^1].on=1;\n\t\tx=pre[x];\n\t}\n\tint lca=x;\n\tx=x_,y=y_;\n\tlen=dis[x]+dis[y]-dis[lca]*2+1;\n\twhile(x!=lca){\n\t\thuan[dis[x_]-dis[x]+1]=x;\n\t\tnum[x]=dis[x_]-dis[x]+1;\n\t\thuanb[num[x]]=preb[x]>>1;\n\t\tx=pre[x];\n\t}\n\thuan[dis[x_]-dis[x]+1]=x;\n\tnum[x]=dis[x_]-dis[x]+1;\n\twhile(y!=lca){\n\t\thuan[len-dis[y_]+dis[y]]=y;\n\t\tnum[y]=len-dis[y_]+dis[y];\n\t\thuanb[num[y]-1]=preb[y]>>1;\n\t\ty=pre[y];\n\t}\n\thuanb[len]=xtoy>>1;\n\tb[xtoy^1].on=b[xtoy].on=1;\n}\nbool find_jihuan(int st){//\u627e\u5947\u73af\uff0c\u8fd4\u56de\u662f\u5426\u627e\u5230\n\tqueue<int>q;\n\tq.push(st);\n\tcol[st]=1;\n\twhile(q.size()){\n\t\tint f=q.front();\n\t\tq.pop();\n\t\tfor(int i=s[f];i;i=b[i].n){\n\t\t\tif(col[b[i].e]==col[f]){\n\t\t\t\trecord(f,b[i].e,i);\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(!col[b[i].e]){\n\t\t\t\tcol[b[i].e]=3-col[f];\n\t\t\t\tpre[b[i].e]=f;\n\t\t\t\tpreb[b[i].e]=i;\n\t\t\t\tdis[b[i].e]=dis[f]+1;\n\t\t\t\tq.push(b[i].e);\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\nbool bfs(int x){//\u4ece\u73af\u4e0a\u7684\u70b9\u5f00\u59cb BFS\uff0c\u8fd4\u56de\u662f\u5426**\u6ca1\u6709**\u5176\u4ed6\u5947\u73af\n\tqueue<int>q;\n\tq.push(x);\n\tcol[x]=1;\n\twhile(q.size()){\n\t\tint f=q.front();\n\t\tq.pop();\n\t\tfor(int i=s[f];i;i=b[i].n){\n\t\t\tif(b[i].on)continue;\n\t\t\tif(col[b[i].e]==col[f]){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(!col[b[i].e]){\n\t\t\t\tcol[b[i].e]=3-col[f];\n\t\t\t\tq.push(b[i].e);\n\t\t\t\tif(num[b[i].e]){\n\t\t\t\t\tcnt++;\n\t\t\t\t\tif((col[x]+col[b[i].e]+num[x]+num[b[i].e])%2==1){\n\t\t\t\t\t\tint u=x,v=b[i].e;\n\t\t\t\t\t\tif(num[u]>num[v])swap(u,v);\n\t\t\t\t\t\ta[num[u]]++;\n\t\t\t\t\t\ta[num[v]]--;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tint u=x,v=b[i].e;\n\t\t\t\t\t\tif(num[u]>num[v])swap(u,v);\n\t\t\t\t\t\ta[1]++;\n\t\t\t\t\t\ta[num[u]]--;\n\t\t\t\t\t\ta[num[v]]++;\n\t\t\t\t\t\ta[len+1]--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn 1;\n}\n\n\nint main(){\n\tn=getint(),m=getint();\n\tfor(int i=0;i<m;i++){\n\t\tint x=getint(),y=getint();\n\t\tadd(x,y);\n\t\tadd(y,x);\n\t}\n\tbool found=0;\n\tfor(int i=1;i<=n;i++){\n\t\tif(!col[i]&&find_jihuan(i)){\n\t\t\tfound=1;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif(!found){\n\t\tprintf(\"%d\\n\",m);\n\t\tfor(int i=1;i<=m;i++){\n\t\t\tprintf(\"%d \",i);\n\t\t}\n\t\treturn 0;\n\t}\n\tmemset(col,0,sizeof(col));\n\tfor(int i=1;i<=len;i++){\n\t\tif(!col[huan[i]]){\n\t\t\tif(!bfs(huan[i])){\n\t\t\t\tputs(\"0\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tif(!col[i]){\n\t\t\tif(find_jihuan(i)){\n\t\t\t\tputs(\"0\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t}\n\tint sum=0;\n\tvector<int>ans;\n\tfor(int i=1;i<=len;i++){\n\t\tsum+=a[i];\n\t\tif(sum==cnt)ans.push_back(huanb[i]);\n\t}\n\tsort(ans.begin(),ans.end());\n\tprintf(\"%d\\n\",ans.size());\n\tfor(int i=0;i<ans.size();i++){\n\t\tprintf(\"%d \",ans[i]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1570323355,
        "uid": 37676,
        "name": "\u7834\u58c1\u4eba\u4e94\u53f7",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "\u7eaa\u5ff5\u4e00\u4e0b\u6211\u901d\u53bb\u7684\u8bed\u6587\uff08110\u7684\u849f\u84bb\u819c\u62dcAK\u7684\u5927\u4f6c\uff09\n\n## \u4e00\u3001\u9898\u76ee\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problem/CF19E)\n\n**\u9898\u610f:**\n\n\u5bf9\u4e8e\u4e00\u4e2a\u56fe\u8fdb\u884c\u4e8c\u67d3\u8272\uff0c\u6c42\u5220\u53bb\u54ea\u4e9b\u8fb9\u53ef\u4ee5\u662f\u5f97\u67d3\u8272\u6210\u529f\uff08\u4e00\u5b9a\u6709\u89e3\uff09\uff0c\u8f93\u51fa\u53ef\u80fd\u7684\u8fb9\u6570\u53ca\u53ef\u80fd\u8fb9\u7684\u7f16\u53f7\uff08\u8f93\u5165\u987a\u5e8f\uff09\u3002\n\n**\u6570\u636e\u8303\u56f4\uff1a**\n\n$1\\leq n\\leq 10^{4},0\\leq m\\leq 10^{4}$\n\n## \u4e8c\u3001\u89e3\u6cd5\n\n**0x01 \u524d\u7f6e\u829d\u58eb**\n\n\u5148\u7ed9\u51fa\u4e00\u4e2a\u7ed3\u8bba\uff1a\u4e00\u4e2a\u56fe\u80fd\u67d3\u8272\u6210\u529f\u7684\u5145\u8981\u6761\u4ef6\u662f\u8be5\u56fe\u4e2d\u4e0d\u5b58\u5728\u5947\u73af\uff08\u8fb9\u6570\u4e3a\u5947\u6570\u7684\u73af\uff09\u3002\n\n\u600e\u4e48\u7406\u89e3\u8fd9\u4e2a\u7ed3\u8bba\u5462\uff1f\u6211\u4eec\u5148\u5efa\u4e00\u9897\u641c\u7d22\u6811\uff0c\u6211\u4eec\u628a\u8fb9\u6162\u6162\u52a0 \uff0c\u65b0\u52a0\u5165\u7684\u8fb9\u4f1a\u8ba9\u641c\u7d22\u6811\u6784\u6210\u73af\uff0c\u5982\u679c\u6b64\u73af\u4e3a\u5947\u73af\uff0c\u90a3\u4e48\u6811\u4e0a\u8def\u5f84\u7684\u8fb9\u6570\u4e3a\u5076\u6570\uff0c\u4e24\u70b9\u7684\u989c\u8272\u4e00\u6837\uff0c\u6545\u4e0d\u80fd\u6709\u5947\u73af\uff0c\u8be6\u7ec6\u8bc1\u660e\u9700\u8981\u8ba8\u8bba\u94fe\u5f0f\u548c\u5f2f\u6298\u5f0f\u7684\u60c5\u51b5\u3002\n\n**0x02 \u5206\u6790**\n\n\u6211\u4eec\u5148\u5efa\u4e00\u9897\u751f\u6210\u6811\uff0c\u628a\u6ca1\u6709\u51fa\u73b0\u8fc7\u5f97\u8fb9\u52a0\u5165\u3002\n\n\u9996\u5148\u5982\u679c\u6ca1\u6709\u5947\u73af\uff0c\u76f4\u63a5\u8f93\u51fa\u6240\u6709\u8fb9\u5373\u53ef\u3002\n\n\u5982\u679c\u6709\u4e00\u4e2a\u5947\u73af\uff0c\u6211\u4eec\u5220\u53bb\u73af\u4e0a\u4efb\u610f\u4e00\u6761\u8fb9\u5373\u53ef\u3002\n\n\u6211\u4eec\u8003\u8651\u591a\u4e2a\u5947\u73af\u7684\u60c5\u51b5\uff0c\u7531\u4e8e\u8981\u540c\u65f6\u7834\u73af\u6240\u6709\u5947\u73af\uff0c\u6211\u4eec\u8003\u8651\u628a\u6bcf\u6b21\u52a0\u5165\u8fb9\u6240\u5bf9\u5e94\u7684\u6811\u4e0a\u8def\u5f84\u5168\u90e8\u52a01\uff0c\u6700\u540e\u7edf\u8ba1\u6240\u6709\u6743\u503c\u7b49\u4e8e\u5947\u73af\u6570\u7684\u6811\u8fb9\uff0c\u6811\u4e0a\u5dee\u5206\u53ef\u4ee5\u505a\u5230$O(n)$\u3002\n\n\u5f53\u8fd9\u91cc\u8fd8\u5b58\u5728\u4e00\u4e2a\u96be\u4ee5\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u5f62\u6210\u5076\u73af\u7684\u8fb9\u53ef\u80fd\u56de\u548c\u5f62\u6210\u5947\u73af\u7684\u8fb9\u7ec4\u5408\u6210\u5947\u73af\uff0c\u800c\u6211\u4eec\u5e76\u6ca1\u6709\u7edf\u8ba1\u5230\uff0c\u6211\u4eec\u5c1d\u8bd5\u5bf9\u7ec4\u5408\u7684\u60c5\u51b5\u8fdb\u884c\u8ba8\u8bba\u3002\n\n\u8bbe\u5947\u73af\u6811\u4e0a\u8fb9\u6570\u4e3aJ\uff0c\u5076\u73af\u6811\u4e0a\u8fb9\u6570\u4e3aO\u3002\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubHVvZ3Uub3JnL3VwbG9hZC9pbWFnZV9ob3N0aW5nL2MxcTB0NXhxLnBuZw?x-oss-process=image/format,png)\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\uff08\u4e24\u8fb9\u8def\u5f84\u5747\u6709\u4ea4\u96c6\uff09\uff0c\u6211\u4eec\u53d1\u73b0\u7b2c\u4e00\u6761\u7ea2\u7ebf\u7ec4\u6210\u4e86\u4e00\u4e2a\u5947\u73af\uff0c\u7b2c\u4e8c\u6761\u7ea2\u7ebf\u7ec4\u6210\u4e86\u4e00\u4e2a\u5076\u73af\uff0c\u5982\u679c\u5220\u53bb\u6811\u4e0a\u8fb9\u7684\u73af\uff0c\u5269\u4e0b\u7684\u4e24\u4e2a\u7ea2\u8fb9\u7ec4\u6210\u7684\u73af\u7684\u6570\u91cf\u4e3a$O-J+2$\uff0c\u6613\u5f97\u6539\u6362\u4e3a\u5947\u73af\uff0c\u6240\u4ee5\u4e0d\u80fd\u5220\u53bb\u6811\u4e0a\u8fb9\u3002\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubHVvZ3Uub3JnL3VwbG9hZC9pbWFnZV9ob3N0aW5nLzVoajlpb3J2LnBuZw?x-oss-process=image/format,png)\n\n\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u82e5\u5220\u53bb\u6811\u8fb9\uff0c\u5219\u80fd\u7ec4\u6210\u7684\u65b0\u73af\u8fb9\u6570\u4e3a$O-s_1+s_2+2$\uff0c$s_1,s_2$\u4e3a\u5947\u73af\u6811\u4e0a\u7684\u4e24\u8fb9\u8fb9\u6570\uff0c\u6240\u4ee5$s_1,s_2$\u540c\u5947\u540c\u5076\uff0c\u6613\u5f97\u8be5\u65b0\u73af\u4e3a\u5947\u73af\uff0c\u6545\u8be5\u6811\u8fb9\u4e0d\u80fd\u9009\u3002\n\n\u8fd9\u4e24\u79cd\u60c5\u51b5\u662f\u6700\u57fa\u672c\u7684\uff0c\u53ef\u4ee5\u884d\u751f\u51fa\u5176\u4ed6\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5076\u73af\u7684\u6811\u4e0a\u8def\u5f84\u90fd\u662f\u4e0d\u80fd\u9009\u7684\uff0c\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6811\u4e0a\u5dee\u5206\u5b9e\u73b0\u3002\n\n**0x03 \u4ee3\u7801**\n\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std; \nconst int MAXN = 10005;\nint read()\n{\n    int num=0,flag=1;\n    char c;\n    while((c=getchar())<'0'||c>'9')if(c=='-')flag=-1;\n    while(c>='0'&&c<='9')num=(num<<3)+(num<<1)+(c^48),c=getchar();\n    return num*flag;\n}\nint n,m,k,cnt,tot,thm,flag,num[MAXN],c[MAXN],f[MAXN],p[MAXN],dep[MAXN],ans[MAXN],fa[MAXN][20];\nbool vis[MAXN];\nstruct node\n{\n\tint u,v,id;\n}a[MAXN],b[MAXN];\nstruct edge\n{\n\tint v,next,id;\n}e[MAXN*2];\nint findSet(int x)\n{\n\tif(p[x]^x) p[x]=findSet(p[x]);\n\treturn p[x];\n}\nvoid dfs(int u,int par)\n{\n\tfa[u][0]=par;\n\tdep[u]=dep[par]+1;\n\tfor(int i=1;i<20;i++)\n\t\tfa[u][i]=fa[fa[u][i-1]][i-1];\n\tfor(int i=f[u];i;i=e[i].next)\n\t\tif(e[i].v^par)\n\t\t{\n\t\t\tnum[e[i].v]=e[i].id;\n\t\t\tdfs(e[i].v,u);\n\t\t}\n}\nint Lca(int u,int v)\n{\n\tfor(int i=19;i>=0;i--)\n\t{\n\t\tif(dep[fa[u][i]]>=dep[v])\n\t\t\tu=fa[u][i];\n\t\tif(dep[fa[v][i]]>=dep[u])\n\t\t\tv=fa[v][i];\n\t}\n\tif(u==v) return u;\n\tfor(int i=19;i>=0;i--)\n\t\tif(fa[u][i]^fa[v][i])\n\t\t\tu=fa[u][i],v=fa[v][i];\n\treturn fa[u][0];\n}\nvoid make(int u,int par)\n{\n\tvis[u]=1;\n\tfor(int i=f[u];i;i=e[i].next)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v==par) continue;\n\t\tmake(v,u);\n\t\tc[u]+=c[v];\n\t}\n}\nint main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++)\n\t\tp[i]=i;\n\tfor(int i=1;i<=m;i++)\n\t\ta[i]=node{read(),read(),i};\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint x=findSet(a[i].u),y=findSet(a[i].v);\n\t\tif(x^y)\n\t\t{\n\t\t\tp[x]=y;\n\t\t\te[++tot]=edge{a[i].u,f[a[i].v],a[i].id},f[a[i].v]=tot;\n\t\t\te[++tot]=edge{a[i].v,f[a[i].u],a[i].id},f[a[i].u]=tot;\n\t\t}\n\t\telse\n\t\t\tb[++k]=a[i];\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tif(!dep[i]) dfs(i,0);\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tint u=b[i].u,v=b[i].v,lca=Lca(u,v);\n\t\tint len=dep[u]+dep[v]-dep[lca]*2,delta=1;\n\t\tif(len&1) delta=-1;\n\t\telse flag++,thm=b[i].id;\n\t\tc[u]+=delta,c[v]+=delta,c[lca]-=2*delta;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tif(!vis[i]) make(i,0);\n\tif(!flag)\n\t\tfor(int i=1;i<=m;i++)\n\t\t\tans[++cnt]=i;\n\telse \n\t\tfor(int i=1;i<=n;i++)\n\t\t\tif(c[i]==flag)\n\t\t\t\tans[++cnt]=num[i];\n\tif(flag==1) ans[++cnt]=thm;\n\tsort(ans+1,ans+1+cnt);\n\tprintf(\"%d\\n\",cnt);\n\tfor(int i=1;i<=cnt;i++)\n\t\tprintf(\"%d \",ans[i]); \n}\n```\n",
        "postTime": 1567345010,
        "uid": 128239,
        "name": "C20203030",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.lydsy.com/JudgeOnline/problem.php?id=4424)\n\n$CDQ$\u5206\u6cbb\u3002\n\n$O(n)$\u7684\u6b63\u89e3\u5b8c\u5168\u4e0d\u4f1a\u54ce\u3002\u53d1\u73b0\u8fd9\u9898\u7f3a\u5c11\u7269\u54c1\u7136\u540e\u8bc1\u660e\u662f\u5426\u662f\u4e8c\u5206\u56fe\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u7528$CDQ$\u5206\u6cbb\u5566\u3002\u4e8c\u5206\u56fe\u7528\u5e76\u67e5\u96c6\u53bb\u7ef4\u62a4\uff0c\u64a4\u56de\u7684\u65f6\u5019\u7528\u4e2a\u6808\u53bb\u5b58\u5c31\u597d\u5566\uff01\n\ncode:\n```\n//2018.9.24 by ljz\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register int\n#define LL long long\n#define inf 0x3f3f3f3f\n#define eps 1e-15\ninline int read(){\n    res s=0;\n    bool w=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')w=1;ch=getchar();}\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return w?-s:s;\n}\ninline void _swap(res &x,res &y){\n    x^=y^=x^=y;\n}\ninline int _abs(const res &x){\n    return x>0?x:-x;\n}\ninline int _max(const res &x,const res &y){\n    return x>y?x:y;\n}\ninline int _min(const res &x,const res &y){\n    return x<y?x:y;\n}\nconst int N=1e6+10;\nnamespace MAIN{\n    int n,m;\n    struct E{\n        int u,v;\n        E() {}\n        E(res u,res v):u(u),v(v) {}\n    }edge[N];\n    bool jh,dis[N];\n    int ans[N],cnt;\n    int fa[N],dep[N],top;\n    inline int find(res x){\n        while(x!=fa[x])x=fa[x];\n        return x;\n    }\n    inline int fdis(res x){\n        res ret=0;\n        while(x!=fa[x])ret^=dis[x],x=fa[x];\n        return ret;\n    }\n    struct St{\n        int x,y,hx,hy;\n        St() {}\n        St(res x,res y,res hx,res hy):x(x),y(y),hx(hx),hy(hy) {}\n    }S[N];\n    inline void merge(const res &id){\n        if(jh)return;\n        res fu=find(edge[id].u),fv=find(edge[id].v),du=fdis(edge[id].u),dv=fdis(edge[id].v);\n        if(fu==fv){if(du==dv)jh=1;return;}\n        if(dep[fu]<dep[fv])_swap(fu,fv);\n        S[++top]=St(fu,fv,dep[fu],dep[fv]);\n        fa[fv]=fu;\n        dis[fv]=1^du^dv;\n        if(dep[fu]==dep[fv])dep[fu]++;\n    }\n    inline void cut(const res &id){\n        fa[S[id].x]=S[id].x,dep[S[id].x]=S[id].hx,dis[S[id].x]=0;\n        fa[S[id].y]=S[id].y,dep[S[id].y]=S[id].hy,dis[S[id].y]=0;\n    }\n    void CDQ(const res &L,const res &R){\n        if(L==R){if(!jh)ans[++cnt]=L;return;}\n        res mid=(L+R)>>1,tmptop=top,tmpjh=jh;\n        for(res i=mid+1;i<=R;i++)merge(i);\n        if(!jh)CDQ(L,mid);\n        jh=tmpjh;\n        while(top>tmptop)cut(top--);\n        for(res i=L;i<=mid;i++)merge(i);\n        if(!jh)CDQ(mid+1,R);\n        jh=tmpjh;\n        while(top>tmptop)cut(top--);\n    }\n    inline void MAIN(){\n        n=read(),m=read();\n        for(res i=1;i<=m;i++){\n            res u=read(),v=read();\n            edge[i]=E(u,v);\n        }\n        for(res i=1;i<=n;i++)fa[i]=i,dep[i]=1;\n        CDQ(1,m);\n        printf(\"%d\\n\",cnt);\n        for(res i=1;i<=cnt;i++)printf(\"%d \",ans[i]);\n    }\n}\nint main(){\n    MAIN::MAIN();\n    return 0;\n}\n```",
        "postTime": 1537790521,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010CF19E\u3011Fairy"
    },
    {
        "content": "\u542c\u8bf4\u53ef\u4ee5\u7528LCT\u505a\u3002\u3002\u3002\u53ef\u662f\u849f\u84bb\u4e0d\u4f1aLCT\u3002\u3002\u3002\n\n\u9996\u5148\uff0c\u4e00\u4e2a\u56fe\u4e00\u5b9a\u662f\u7531\u4e00\u5806\u73af\u548c\u4e00\u5806\u94fe\u7ec4\u6210\u7684\u3002\u6839\u636e\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u5f88\u597d\u7684\u6027\u8d28\uff0c\u90a3\u5c31\u662f\uff0c\u6bcf\u4e00\u6761\u94fe\u5fc5\u7136\u662f\u4e00\u4e2a\u4e8c\u5206\u56fe\uff0c\u6bcf\u4e00\u4e2a\u5076\u73af\uff0c\u4e5f\u5fc5\u7136\u662f\u4e00\u4e2a\u4e8c\u5206\u56fe\uff0c\u6240\u4ee5\u3002\u3002\u53ea\u5269\u4e0b\u5947\u73af\u3002\u3002\u4e0d\u662f\u4e8c\u5206\u56fe\u4e86\u3002\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u627e\u7684\u8fb9\u662f\uff0c\u88ab\u6240\u6709\u5947\u73af\u8986\u76d6\u7684\u5e76\u4e14\u6ca1\u6709\u88ab\u5076\u73af\u8986\u76d6\u7684\u8fb9\uff0c\u56e0\u4e3a,\u5220\u6389\u8fd9\u6761\u8fb9\uff0c\u539f\u6765\u7684\u5076\u73af\u53d8\u6210\u4e86\u5947\u6570\u6761\u8fb9\uff0c\u5947\u73af\u53d8\u6210\u4e86\u5076\u6570\u6761\u8fb9\uff0c\u8fd9\u4e24\u4e2a\u73af\u7ec3\u4e86\u8d77\u6765\uff0c\u53c8~~tm~~\u5408\u6210\u4e86\u4e00\u4e2a\u5947\u73aforz\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u8bb0\u5f55\u4e00\u6761\u8fb9\u88ab\u5947\u73af\u548c\u5076\u73af\u8986\u76d6\u7684\u6b21\u6570\u3002\u8986\u76d6\u7684\u6b21\u6570\uff1f\u600e\u4e48\u8fd9\u4e48\u50cf\u8fd0\u8f93\u8ba1\u5212\u3002\u3002\u56e0\u6b64\u6211\u4eec\u60f3\u5230\u4e86\u7528\u6811\u4e0a\u5dee\u5206\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u53e6\u5916\uff0c\u8fd9\u9053\u9898\u975e\u5e38\u5751\u4eba\uff0c\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a\n\n1.\u5982\u679c\u6ca1\u6709\u5947\u73af\uff0c\u5220\u90a3\u6761\u8fb9\u90fd\u53ef\u4ee5\uff0c\u6240\u4ee5\u8f93\u51fam\u6761\u8fb9\n\n2.\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5947\u73af\uff0c\u90a3\u4e48\u8fd4\u7956\u8fb9\u4e5f\u8981\u88ab\u7b97\u8fdb\u7b54\u6848\u3002\u56e0\u4e3a\u6211\u4eec\u662f\u7528\u5dee\u5206\u6765\u6c42\u8986\u76d6\u6b21\u6570\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u662f\u4ece\u53f6\u5b50\u8282\u70b9\u5f80\u4e0a\uff0c\u6c42\u5b50\u6811\u548c\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u5e76\u4e0d\u80fd\u904d\u5386\u5230\u8fd4\u7956\u8fb9\uff0c\u5e76\u6ca1\u6709\u628a\u4ed6\u7b97\u8fdb\u7b54\u6848\u3002\u5728\u6709\u591a\u4e2a\u5947\u73af\u7684\u65f6\u5019\uff0c\u8fd4\u7956\u8fb9\u662f\u4e0d\u53ef\u80fd\u80fd\u88ab\u7b97\u8fdb\u7b54\u6848\u7684\uff0c\u56e0\u4e3a\u8fd4\u7956\u8fb9\u53ea\u80fd\u8986\u76d6\u81ea\u5df1\u7684\u5947\u73af\uff08\u4f60\u53ef\u4ee5\u5728\u6811\u4e0a\u753b\u753b\u770b\uff09\uff0c\u6240\u4ee5\u5728\u6709\u591a\u4e2a\u5947\u73af\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u6839\u672c\u4e0d\u7528\u53bb\u7ba1\u4ed6\u3002\u800c\u5728\u53ea\u6709\u4e00\u4e2a\u5947\u73af\u7684\u65f6\u5019\uff0c\u4ed6\u4e5f\u8981\u7b97\u8fdb\u53bb\u4e86\uff0c\u505a\u4e00\u4e2a\u7279\u5224\u5373\u53ef\u3002\u5f53\u7136\uff0c\u4f60\u628a\u6240\u6709\u8fb9\u9886\u51fa\u6765\u4e00\u8d77\u5dee\u5206\uff0c\u628a\u8fd4\u7956\u8fb9\u4e5f\u5dee\u5206\u5230\uff0c\u662f\u4e0d\u7528\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\u7684\uff0c\u8fd9\u79cd\u60c5\u51b5\u53ea\u662f\u9488\u5bf9\u5728dfs\u7684\u65f6\u5019\u4e00\u8d77\u505a\u5dee\u5206\u7684\u7a0b\u5e8f\uff0c\u8fd9\u79cd\u7a0b\u5e8f\u662f\u5dee\u5206\u4e0d\u5230\u8fd4\u7956\u8fb9\u7684\uff08\u5c31\u50cf\u6211\uff09\u3002\n\n3.\u7136\u540e\u3002\u3002\u8fd9\u9053\u9898\u5176\u5b9e\u8fd8\u8981\u8003\u8651\u91cd\u8fb9\u3001\u81ea\u73af\u3002\u3002\u3002\u4f46\u662f\u4ecb\u4e8e\u6570\u636e\u592a\u6c34\uff0c\u4f60\u4e0d\u53bb\u7ba1\u4e5f\u80fd\u8fc7\u3002\u3002\u3002\n\n\u90a3\u4e48\u3002\u3002\u4ee3\u7801\n\n```cpp\n#include<vector>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nint fa[2000010],tago[2000010],tage[2000010],dep[2000010];//tag\u662f\u5dee\u5206\u6570\u7ec4\uff0cdep\u8bb0\u5f55\u6df1\u5ea6\uff0c\u56de\u5230\u6df1\u5ea6\u5c0f\u7684\u5c31\u662f\u8fd4\u7956\u8fb9\u4e86\nint fr[2000010],eve[2000010],odd[2000010],f[2000010]\uff0cfz;//eve\u8bb0\u5f55\u5076\u73af\u5dee\u5206\u548c\uff0codd\u8bb0\u5f55\u5947\u73af\u5dee\u5206\u548c\uff0cfz\u662f\u5bf9\u4e8e\u53ea\u6709\u4e00\u4e2a\u5947\u73af\u65f6\uff0c\u5b58\u8fd4\u7956\u8fb9\u7684\u7f16\u53f7\nint n,m,num;//num\u8bb0\u5f55\u7684\u662f\u5947\u73af\u4e2a\u6570\nvector < pair<int,int> > to[2000010];\nvector <int> ans;\nvoid dfs(int u)\n{\n    for(int i=0;i<to[u].size();i++)\n    {\n    \tint v=to[u][i].first;\n    \tif(v==fa[u]) continue;\n\t\tif(!dep[v])\n\t\t{\n\t\t    dep[v]=dep[u]+1;\n\t\t    fa[v]=u,fr[v]=to[u][i].second;\n\t\t    dfs(v);\n\t\t    eve[u]+=eve[v],odd[u]+=odd[v];\n\t\t}\n\t\telse if(dep[v]<=dep[u])//\u4e0d\u8981\u5199\u6210<\uff0c\u56e0\u4e3a\u6709\u81ea\u73af\u60c5\u51b5\u8981\u8003\u8651\uff08\u5c3d\u7ba1\u8fd9\u4e9b\u6570\u636e\u662f\u4e0d\u4f1aWA\u7684\uff09\n\t\t{\n\t\t    if((dep[v]-dep[u])&1) tage[u]++,tage[v]--;//\u5076\u73af\u60c5\u51b5\n\t\t    else num++,tago[u]++,tago[v]--,fz=to[u][i].second;//\u5947\u73af\u60c5\u51b5\n\t\t}\n\t}\n    eve[u]+=tage[u];\n    odd[u]+=tago[u];\n}\nint solve()\n{\n    int cnt=0;\n    if(!numoddn)//\u6ca1\u6709\u5947\u73af\n    {\n        for(int i=1;i<=m;i++)\n        \tans.push_back(i);\n        return m;\n    }\n    for(int i=1;i<=n;i++)\n\t\tif(odd[i]==num && !eve[i])\n\t\t{\n\t\t\tcnt++;\n\t\t\tans.push_back(fr[i]);\n\t\t}\n    if(num==1)//\u4e00\u4e2a\u5947\u73af\n    {\n    \tcnt++;\n\t\tans.push_back(fz);//\u52a0\u4e0a\u8fd4\u7956\u8fb9\n    }\n    return cnt;\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=m;i++)\n    {\n    \tint x,y;\n        scanf(\"%d%d\",&x,&y);\n        int flag=1,it;\n        for(int j=0;j<to[x].size();j++)\n        \tif(to[x][j].first==y) flag=0,it=j;\n\t\tif(flag)\n\t\t{\n\t\t\tif(x==y) to[x].push_back(make_pair(y,i));//\u5904\u7406\u81ea\u73af\n\t\t\telse to[x].push_back(make_pair(y,i)),to[y].push_back(make_pair(x,i));\n\t\t}\n        else f[to[x][it].second]=1;//\u6709\u91cd\u8fb9\u5c31\u505a\u6807\u8bb0\n    }\n    for(int i=1;i<=n;i++)\n\t\tif(!dep[i])\n\t\t{\n\t\t\tdep[i]=1;\n\t\t\tdfs(i);\n\t\t}\n    int num=solve();\n    for(int i=0;i<ans.size();i++)\n    \tif(f[ans[i]]) ans.erase(ans.begin()+i),num--,i--;//\u5982\u679c\u9009\u4e2d\u7684\u8fb9\u4e2d\u6709\u91cd\u8fb9\uff0c\u5220\u6389\n    printf(\"%d\\n\",num);\n    sort(ans.begin(),ans.end());\n    for(int i=0;i<ans.size();i++)\n    \tprintf(\"%d \",ans[i]);\n    return 0;\n}\n```",
        "postTime": 1534505440,
        "uid": 21874,
        "name": "hicc0305",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF19E \u3010Fairy\u3011"
    }
]