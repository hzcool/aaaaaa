[
    {
        "content": "[\u9898\u76ee(cf)](https://codeforces.com/problemset/problem/1770/E)\n\n[\u9898\u76ee(\u6d1b\u8c37)](https://www.luogu.com.cn/problem/CF1770E)\n\n# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a $n$ \u4e2a\u8282\u70b9\u7684\u65e0\u6839\u6811\uff0c\u6709 $k$ \u4e2a\u6307\u5b9a\u7684\u8282\u70b9\u4e0a\u6709\u8774\u8776\u3002\u5bf9\u6bcf\u6761\u8fb9\u7b49\u6982\u7387\u5730\u6307\u5b9a\u4efb\u610f\u65b9\u5411\uff0c\u6309\u7167\u8fb9\u7684\u7f16\u53f7\u987a\u5e8f\u67e5\u627e\u6bcf\u6761\u8fb9\uff0c\u82e5\u8fb9 $u\\to v$ \u6ee1\u8db3 $u$ \u6709\u8774\u8776\u4e14 $v$ \u6ca1\u6709\u8774\u8776\uff0c\u5219\u8774\u8776\u4ece $u$ \u98de\u5230 $v$. \u6c42\u4e24\u53ea\u8774\u8776\u4e4b\u95f4\u8ddd\u79bb\u7684\u671f\u671b\u503c\u3002\n\n# \u9898\u89e3\n\n\u9996\u5148\u8981\u6ce8\u610f\uff0c\u6c42\u671f\u671b\u503c\u7684\u4e24\u53ea\u8774\u8776\u4e0d\u662f\u7ed9\u5b9a\u7684\u3002\n\n\u663e\u7136\uff0c\u8fd9\u4e2a\u671f\u671b\u503c\u7684\u6c42\u6cd5\u662f\u6bcf\u6761\u8fb9\u7684\u8d21\u732e\u7d2f\u52a0\uff0c\u6c42\u51fa\u6240\u6709\u8774\u8776\u4e24\u4e24\u8ddd\u79bb\u548c\u7684\u671f\u671b\u503c\uff0c\u518d\u9664\u4ee5\u9009\u62e9\u4e24\u53ea\u8774\u8776\u7684\u65b9\u6848\u6570 $C_k^2=\\frac {k(k-1)}{2}$.\n\n\u5148\u8003\u8651\u4e00\u4e2a\u7b80\u5316\u7684\u7ecf\u5178\u95ee\u9898\uff1a\u8774\u8776\u4e0d\u4f1a\u98de\u7684\u60c5\u51b5\u3002\n\n\u679a\u4e3e\u6bcf\u6761\u8fb9\uff0c\u82e5\u5176\u5de6\u8fb9\u6709 $x$ \u53ea\u8774\u8776\uff0c\u90a3\u4e48\u5176\u53f3\u8fb9\u6709 $k-x$ \u53ea\u8774\u8776\uff0c\u8fd9\u6761\u8fb9\u5c06\u4f1a\u6210\u4e3a $x\\times (k-x)$ \u5bf9\u8774\u8776\u4e4b\u95f4\u7684\u8def\u5f84\u4e0a\u7684\u4e00\u6761\u8fb9\u3002\u6362\u4e00\u79cd\u8bf4\u6cd5\uff0c\u6709 $x\\times (k-x)$ \u6761\u8def\u5f84\u4f1a\u7ecf\u8fc7\u8fd9\u6761\u8fb9\u3002\u90a3\u4e48\u8fd9\u6761\u8fb9\u4f1a\u5bf9\u603b\u8ddd\u79bb\u503c\u8d21\u732e $x\\times (k-x)$. \u4e5f\u5c31\u662f\u8bf4\u7b80\u5316\u60c5\u51b5\u4e0b $ans=\\frac{\\sum\\limits_{(u,v)\\in M}sum_u(k-sum_u)}{\\frac{k(k-1)}{2}}$. $sum_i$ \u8868\u793a $i$ \u7684\u5b50\u6811\u4e2d\u6709\u591a\u5c11\u53ea\u8774\u8776\u3002\u8fd9\u4e2a\u53ef\u4ee5\u4e00\u6b21dfs $O(n)$ \u6c42\u51fa\u3002\n\n\u56de\u5230\u539f\u95ee\u9898\u3002\u5982\u679c\u6211\u4eec\u77e5\u9053\u6bcf\u6761\u8fb9\u4e24\u8fb9\u5206\u522b\u6709\u591a\u5c11\u8774\u8776\uff0c\u5219\u8d21\u732e\u53ef\u6c42\u3002\n\n\u601d\u8003\u53d1\u73b0\u5bf9\u4e8e\u8fb9 $(u,v)$\uff0c\u4e0d\u7ba1\u8774\u8776\u600e\u4e48\u98de\uff0c$sum$ \u503c\u7684\u53d8\u5316\u91cf\u6700\u5927\u4e3a $1$. \u800c $sum$ \u662f\u5426\u6539\u53d8\u53ea\u53d6\u51b3\u4e8e $u$ \u548c $v$ \u4e0a\u662f\u5426\u6709\u8774\u8776\u3002\u8fd9\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u6c42\u51fa $u$ \u548c $v$ \u6709\u8774\u8776\u7684\u6982\u7387\u3002\u8bbe\u8fd9\u4e2a\u6982\u7387\u4e3a $p$.\n\n\u8003\u8651\u5bf9\u4e8e $p_u$\uff1a\n\n- \u539f\u6765 $u$ \u548c $v$ \u4e0a\u90fd\u6709\u8774\u8776\uff0c\u5219\u73b0\u5728 $u$ \u6709\u8774\u8776\u7684\u6982\u7387\u4e3a $p_u\\times p_v$.\n- \u539f\u6765 $u$ \u548c $v$ \u4e0a\u90fd\u6ca1\u6709\u8774\u8776\uff0c\u5219\u73b0\u5728 $u$ \u6709\u8774\u8776\u7684\u6982\u7387\u4e3a $0$.\n- \u539f\u6765 $u$ \u6709\u8774\u8776\uff0c$v$ \u6ca1\u6709\uff0c\u5219\u73b0\u5728 $u$ \u6709\u8774\u8776\u7684\u6982\u7387\u4e3a $\\frac {p_u(1-p_v)}{2}$. \u56e0\u4e3a\u6709 $\\frac 1 2$ \u7684\u6982\u7387\u8fb9 $(u,v)$ \u53d8\u6210 $v\\to u$\uff0c\u53ea\u6709\u8fd9\u6837\u8774\u8776\u624d\u4e0d\u4f1a\u4ece $u$ \u98de\u5230 $v$.\n- \u539f\u6765 $u$ \u6ca1\u6709\u8774\u8776\uff0c$v$ \u6709\uff0c\u5219\u73b0\u5728 $u$ \u6709\u8774\u8776\u7684\u6982\u7387\u4e3a $\\frac {(1-p_u)p_v}{2}$. \u56e0\u4e3a\u6709 $\\frac 1 2$ \u7684\u6982\u7387\u8fb9 $(u,v)$ \u53d8\u6210 $v\\to u$\uff0c\u53ea\u6709\u8fd9\u6837\u8774\u8776\u624d\u4f1a\u4ece $v$ \u98de\u5230 $u$.\n\n\u5bf9\u4e0a\u8ff0\u6982\u7387\u6c42\u548c\uff0c\u5f97\u5230 $u$ \u6709\u8774\u8776\u7684\u6982\u7387\u4e3a $p_up_v+\\frac {p_u(1-p_v)}{2}+\\frac {(1-p_u)p_v}{2}=\\frac {p_u+p_v}{2}$.\n\n\u4e5f\u5c31\u662f\u8f6c\u79fb\u65f6 $p_u=\\frac {p_u+p_v}{2}$. \u5bf9\u4e8e $p_v$ \u540c\u7406\uff0c\u5f97 $p_u=p_v=\\frac {p_u+p_v}{2}$.\n\n\u5728\u4fee\u6539\u6982\u7387\u524d\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u8fb9 $(u,v)$ \u7edf\u8ba1\u7b54\u6848\u3002\n\n\u8003\u8651\u5982\u4e0b\u60c5\u51b5\uff1a\n\n- $u$ \u548c $v$ \u90fd\u6709\u8774\u8776\uff0c\u8d21\u732e\u4e3a $p_u\\cdot p_v\\cdot sum_u\\cdot (k-sum_u)$\n- $u$ \u548c $v$ \u90fd\u6ca1\u8774\u8776\uff0c\u8d21\u732e\u4e3a $(1-p_u)\\cdot (1-p_v)\\cdot sum_u\\cdot (k-sum_u)$\n- $u$ \u6709\u8774\u8776\uff0c$v$ \u6ca1\u6709\u8774\u8776\uff0c\u6b64\u65f6\u6709 $\\frac 1 2$ \u7684\u6982\u7387\u8774\u8776\u4ece $u$ \u98de\u5230 $v$\uff0c\u5bfc\u81f4 $sum_u$ \u5c11 $1$\uff0c\u8d21\u732e\u4e3a $p_u\\cdot (1-p_v)\\cdot \\frac {sum_u\\cdot (k-sum_u)+(sum_u-1)(k-sum_u+1)}{2}$\n- $u$ \u6ca1\u6709\u8774\u8776\uff0c$v$ \u6709\u8774\u8776\uff0c\u6b64\u65f6\u6709 $\\frac 1 2$ \u7684\u6982\u7387\u8774\u8776\u4ece $v$ \u98de\u5230 $u$\uff0c\u5bfc\u81f4 $sum_u$ \u591a $1$\uff0c\u8d21\u732e\u4e3a $(1-p_u)\\cdot p_v\\cdot \\frac {sum_u\\cdot (k-sum_u)+(sum_u+1)(k-sum_u-1)}{2}$\n\n\u5bf9\u4ee5\u4e0a $4$ \u79cd\u60c5\u51b5\u6c42\u548c\u5c31\u662f\u8fb9 $(u,v)$ \u7684\u8d21\u732e\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u7684\u65f6\u5019\u53ef\u4ee5\u5bf9 $u$ \u548c $v$ \u9650\u5b9a\u7236\u5b50\u5173\u7cfb\uff0c\u8fd9\u6837\u5bb9\u6613\u8ba1\u7b97\u3002\n\n\u8bb0\u5f97\u6700\u540e\u8981\u9664\u4ee5 $\\frac {k(k-1)}{2}$.\n\n# \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst int N = 300005;\nconst LL mod = 998244353;\nint n, k, cnt = 0, fir[N], nxt[N << 1], to[N << 1], fa[N];\nLL ans = 0, p[N], s[N];\nvoid ade(int u, int v) {\n    cnt++, nxt[cnt] = fir[u], fir[u] = cnt, to[cnt] = v;\n    cnt++, nxt[cnt] = fir[v], fir[v] = cnt, to[cnt] = u;\n}\nLL qpow(LL x, LL y) {\n    LL sum = 1;\n    while (y) {\n        if (y & 1) sum = sum * x % mod;\n        x = x * x % mod, y >>= 1;\n    }\n    return sum;\n}\nvoid dfs(int r, int f) {\n    fa[r] = f, s[r] = p[r];\n    for (int i = fir[r]; i; i = nxt[i])\n        if (to[i] != f)\n            dfs(to[i], r), s[r] += s[to[i]];\n}\nint main() {\n    scanf(\"%d%d\", &n, &k);\n    for (int i = 1, x; i <= k; i++) scanf(\"%d\", &x), p[x] = 1;\n    for (int i = 1, u, v; i < n; i++) scanf(\"%d%d\", &u, &v), ade(u, v);\n    dfs(1, 0);\n    LL inv2 = qpow(2, mod - 2);\n    for (int i = 1; i <= cnt; i += 2) {\n        int u = to[i], v = to[i + 1];\n        if (fa[v] != u) swap(u, v);//\u9650\u5b9a u \u4e3a v \u7684\u7236\u4eb2\n        ans = ((ans\n        + p[u] * p[v] % mod * s[v] % mod * (k - s[v]) % mod\n        + (1 - p[u]) * (1 - p[v]) % mod * s[v] % mod * (k - s[v]) % mod\n        + (1 - p[u]) * p[v] % mod * (s[v] * (k - s[v]) % mod + (s[v] - 1) * (k - s[v] + 1) % mod) % mod * inv2 % mod\n        + p[u] * (1 - p[v]) % mod * (s[v] * (k - s[v]) % mod + (s[v] + 1) * (k - s[v] - 1) % mod) % mod * inv2 % mod) % mod + mod) % mod;\n        p[u] = p[v] = (p[u] + p[v]) * inv2 % mod;//\u6982\u7387\u8f6c\u79fb\n    }\n    printf(\"%lld\", (ans * qpow(1ll * k * (k - 1) / 2 % mod, mod - 2) % mod + mod) % mod);\n    return 0;\n}\n```\n# END\n",
        "postTime": 1679660362,
        "uid": 566238,
        "name": "hejianxing",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF1770E Koxia and Tree"
    },
    {
        "content": "\u8865\u9898\u3002\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u9053\u6bd4\u8f83\u5178\u7684 E\u3002\n\n\u9996\u5148\u6700\u540e\u4e00\u6b65\u662f\u8bc8\u9a97\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f $\\dfrac{\\sum\\limits_{i\\in a}\\sum\\limits_{j\\in a\\land j\\not=i}dis(i,j)}{C_k^2}$\u3002\n\n\u7136\u540e\u8003\u8651\u5982\u679c\u70b9\u56fa\u5b9a\u600e\u4e48\u8ba1\u7b97\u4e0a\u9762\u7684\u5f0f\u5b50\u3002\u8fd9\u662f\u4e2a\u5f88\u5e38\u89c1\u7684 trick\uff1a\u679a\u4e3e\u6bcf\u6761\u8fb9\u7b97\u8d21\u732e\uff0c\u5373\u8bb0\u5f55\u4e00\u4e2a\u70b9 $v$ \u7684\u5b50\u6811\u5185\u6709\u591a\u5c11\u4e2a\u6709\u6807\u8bb0\u7684\u70b9 $c_v$\uff0c\u8fd9\u4e2a\u70b9\u8fde\u5411\u7236\u4eb2\u7684\u8fb9\u7684\u8d21\u732e\u5373\u4e3a $c_v\\times(k-c_v)$\u3002\n\n\u8003\u8651\u63a8\u5e7f\u5230\u6709\u8f6c\u79fb\u7684\u60c5\u51b5\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u5173\u952e\u7684\u6027\u8d28\uff1a$\\Delta c_v$ \u6700\u5927\u4e3a 1\uff0c\u56e0\u4e3a\u4e0d\u5728\u8fd9\u6761\u8fb9\u4e0a\u7684\u70b9\u5bf9 $c_v$ \u660e\u663e\u6ca1\u6709\u8d21\u732e\uff0c\u800c\u5728\u8fd9\u6761\u8fb9\u4e0a\u7684\u70b9\u6700\u591a\u53ea\u4f1a\u4ea7\u751f $1$ \u7684\u8d21\u732e\u3002\u6240\u4ee5\u5206 $u,v$ \u6709\u6ca1\u6709\u8774\u8776\u7684\u60c5\u51b5\u8ba8\u8bba\u3002\u8bbe $p_u$ \u4e3a $u$ \u70b9\u6709\u8774\u8776\u7684\u6982\u7387\u3002\u5219\u6709\uff1a\n\n- \u90fd\u6709\u6807\u8bb0\uff1a$p_u\\times p_v\\times c_v\\times(k-c_v)$\u3002\u5373\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u4f1a\u5bf9\u8be5\u8fb9\u4ea7\u751f\u8d21\u732e\u3002\n\n- \u90fd\u6ca1\u6807\u8bb0\uff1a$(1-p_u)\\times(1-p_v)\\times c_v\\times(k-c_v)$\u3002\u540c\u4e0a\u3002\n\n- $u$ \u6709\u6807\u8bb0\uff1a$p_u\\times (1-p_v)\\times \\dfrac{c_v\\times(k-c_v)+(c_v+1)\\times(k-c_v-1)}{2}$\u3002\u5373\u6709 $0.5$ \u7684\u6982\u7387\u6807\u8bb0\u4f1a\u4ece $u$ \u8f6c\u79fb\u5230 $v$\u3002\n\n- $v$ \u6709\u6807\u8bb0\uff1a$p_v\\times (1-p_u)\\times \\dfrac{c_v\\times(k-c_v)+(c_v-1)\\times(k-c_v+1)}{2}$\u3002\u540c\u4e0a\u3002\n\n\u7136\u540e\u8fd8\u8981\u5904\u7406\u6807\u8bb0\u8f6c\u79fb\u540e $u,v$ \u6709\u6807\u8bb0\u7684\u6982\u7387\u3002\u4e5f\u53ef\u4ee5\u7528\u7c7b\u4f3c\u4e0a\u9762\u7684\u5206\u7c7b2\u65b9\u6cd5\u8ba1\u7b97\u3002\u6700\u540e\u62c6\u5f00\u5316\u7b80\u5f97\u5230 $p_u=p_v=\\dfrac{p_u+p_v}{2}$\u3002\n\n\u679a\u4e3e\u6bcf\u6761\u8fb9\u8f6c\u79fb\u5373\u53ef\u3002\n\ncode\uff1a\n\n```cpp\nint n,m,c[N],p[N],dep[N];\nint tot,head[N];\nstruct node{\n\tint to,nxt;\n}e[N<<1];\ninline void add(int u,int v){\n\te[++tot]={v,head[u]};\n\thead[u]=tot;\n}\ninline int qpow(int x,int y){\n\tint ret=1;\n\twhile(y){\n\t\tif(y&1)\n\t\t\tret=1ll*ret*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn ret;\n}\nvoid dfs(int u,int f){\n\tdep[u]=dep[f]+1;\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==f)\n\t\t\tcontinue;\n\t\tdfs(v,u);\n\t\tc[u]+=c[v];\n\t}\n}\nvoid solve(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1,x;i<=m;i++){\n\t\tscanf(\"%d\",&x);\n\t\tc[x]=p[x]=1;\n\t}\n\tfor(int i=1,u,v;i<n;i++){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tdfs(1,0);\n\tconst int inv=qpow(2,mod-2);\n\tint ans=0;\n\tfor(int i=1;i<=tot;i+=2){\n\t\tint u=e[i+1].to,v=e[i].to;\n\t\tif(dep[u]>dep[v])\n\t\t\tswap(u,v);\n\t\tans=(ans+1ll*(1ll*p[u]*p[v]%mod+1ll*(1-p[u]+mod)*(1-p[v]+mod)%mod)*c[v]%mod*(m-c[v])%mod//\u8fd9\u91cc\u7528\u4e86\u4e0b\u5206\u914d\u5f8b\uff0c\u6ca1\u6709\u5f71\u54cd\n\t\t\t+1ll*p[u]*(1-p[v]+mod)%mod*(1ll*c[v]*(m-c[v])%mod+1ll*(c[v]+1)*(m-c[v]-1)%mod)%mod*inv%mod\n\t\t\t+1ll*(1-p[u]+mod)*p[v]%mod*(1ll*c[v]*(m-c[v])%mod+1ll*(c[v]-1)*(m-c[v]+1)%mod)%mod*inv%mod)%mod;\n\t\tp[u]=p[v]=1ll*(p[u]+p[v])*inv%mod;//\u8f6c\u79fb\u6982\u7387\n\t}\n\tprintf(\"%lld\\n\",1ll*ans*qpow(1ll*m*(m-1)/2%mod,mod-2)%mod);\n}\n```",
        "postTime": 1684747277,
        "uid": 740322,
        "name": "_Ritsu_",
        "ccfLevel": 0,
        "title": "CF1770E"
    },
    {
        "content": "\u6ce8\u610f\u5230\u7edf\u8ba1\u6811\u4e0a\u82e5\u5e72\u70b9\u4e24\u4e24\u8ddd\u79bb\u548c\u6709\u4e00\u79cd\u8fd9\u6837\u7684\u65b9\u6cd5\uff1a\u5bf9\u6bcf\u6761\u8fb9\uff0c\u8ba1\u7b97\u8fd9\u6761\u8fb9\u4e24\u7aef\u5404\u6709\u591a\u5c11\u70b9\uff0c\u5e76\u628a\u4e24\u4fa7\u70b9\u6570\u7684\u4e58\u79ef\u7d2f\u52a0\u5230\u7b54\u6848\u4e2d\u3002\uff08\u8fd9\u4e2a\u505a\u6cd5\u7684\u672c\u8d28\u5176\u5b9e\u5c31\u662f\u5bf9\u6bcf\u6761\u8fb9\u7edf\u8ba1\u6709\u591a\u5c11\u8def\u5f84\u7ecf\u8fc7\u8be5\u8fb9\u3002\uff09\u800c\u6211\u4eec\u53d1\u73b0\uff1a\u5bf9\u6bcf\u6761\u8fb9\u6765\u8bf4\uff0c\u6574\u4e2a\u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u81f3\u591a\u53ea\u4f1a\u6709\u4e00\u53ea\u8774\u8776\u7ecf\u8fc7\u8be5\u8fb9\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4e00\u5f00\u59cb\u8be5\u8fb9\u7684\u67d0\u4e00\u4fa7\u8774\u8776\u6570\u4e3a $x$\uff0c\u90a3\u4e48\u5168\u90e8\u64cd\u4f5c\u7ed3\u675f\u540e\u8be5\u4fa7\u7684\u8774\u8776\u6570\u53ea\u80fd\u662f $x-1,x,x+1$ \u4e4b\u4e00\u3002\u6211\u4eec\u53ea\u9700\u8981\u7edf\u8ba1\u8fd9\u4e09\u79cd\u60c5\u5f62\u5206\u522b\u7684\u53d1\u751f\u6982\u7387\u5373\u53ef\u3002\r\n\r\n\u6211\u4eec\u8003\u8651\u52a8\u6001\u7ef4\u62a4\uff1a\u5728\u6bcf\u4e2a\u65f6\u523b\uff0c\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u4e0a\u6709\u8774\u8776\u7684\u6982\u7387\uff08\u4e0b\u8bb0\u4e3a $p_u$\uff09\u3002\u987a\u6b21\u626b\u63cf\u6bcf\u6761\u8fb9\uff0c\u5bf9\u4e00\u6761\u8fb9 $(u,v)$\uff0c\u6ce8\u610f\u5230\uff1a\r\n\r\n- \u6709 $\\dfrac{1}{2}f_u(1-f_v)$ \u7684\u6982\u7387\uff0c$u$ \u4e0a\u7684\u8774\u8776\u98de\u5230 $v$ \u7684\u7a7a\u4f4d\u4e0a\uff1b\r\n- \u6709 $\\dfrac{1}{2}f_v(1-f_u)$ \u7684\u6982\u7387\uff0c$v$ \u4e0a\u7684\u8774\u8776\u98de\u5230 $u$ \u7684\u7a7a\u4f4d\u4e0a\uff1b\r\n- $f'_u=f'_v=\\dfrac{f_u+f_v}{2}$\u3002\r\n\r\n\u901a\u8fc7\u4ee5\u4e0a\u89c2\u5bdf\u5373\u53ef\u7ef4\u62a4\u5f85\u6c42\u4fe1\u606f\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002",
        "postTime": 1673250872,
        "uid": 112794,
        "name": "\u5468\u5b50\u8861",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1770E\u3010Koxia and Tree\u3011"
    },
    {
        "content": "update on 2023/1/13\uff1a\u4fee\u6539\u4e86\u4e00\u4e2a\u9519\u8bef\uff0c\u611f\u8c22\u8bc4\u8bba\u533a\u5927\u4f6c\u6307\u6b63\u3002\n\n\u8d5b\u65f6\u60f3\u6cd5\u590d\u6742\u4e86\uff0c\u5176\u5b9e\u6b63\u89e3\u771f\u7684\u975e\u5e38\u7b80\u5355\u3002\n\n\u6ce8\u610f\u5230\uff0c\u6bcf\u6761\u8fb9\u81f3\u591a\u7ecf\u8fc7\u4e00\u4e2a\u70b9\uff0c\u4e14\u8fd9\u6761\u8fb9\u64cd\u4f5c\u5b8c\u4e4b\u540e\u4e24\u8fb9\u7684\u70b9\u6570\u662f\u4e0d\u53d8\u7684\u3002\n\n\u56e0\u4e3a\u7b54\u6848\u7b97\u7684\u662f\u8ddd\u79bb\uff0c\u6240\u4ee5\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6bcf\u6761\u8fb9\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f\u4e24\u8fb9\u70b9\u6570\u76f8\u4e58\u3002\n\n\u4e3a\u4e86\u8ba1\u7b97\u70b9\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5176dfs\u7b97\u51fa\u6bcf\u4e2a\u70b9\u7684\u5b50\u6811\u70b9\u6570 $s_u$\u3002\n\n\u60f3\u5230\u8fd9\u91cc\u5c31\u975e\u5e38\u7b80\u5355\u4e86\u3002\u6211\u4eec\u6309\u7167\u8fb9 $1,2,\\dots,n-1$ \u7684\u987a\u5e8f\u7b97\u4e00\u4e0b\u6bcf\u6761\u8fb9\u7aef\u70b9\u6709\u70b9\u7684\u6982\u7387 $f_u$ \u3002\n\n\u6bcf\u6b21\u64cd\u4f5c $(u,v)$ \uff08\u8bbe $u$ \u662f $v$ \u7684\u7236\u4eb2\uff09\u5c31\u662f $f_u=f_v=\\frac{f_u+f_v}{2}$ \u3002\u8fd9\u662f\u7ecf\u8fc7\u4e86\u8fd9\u6761\u8fb9\u4e4b\u540e\u7684\u6982\u7387\u3002\n\n\u5728\u4fee\u6539\u6982\u7387\u524d\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\u8fd9\u6761\u8fb9\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u82e5\u4e24\u8fb9\u90fd\u6709\u70b9\uff0c\u5219\u4ea7\u751f\u4e0d\u4e86\u53d8\u5316\uff0c\u8d21\u732e\u4e3a $f_u\\times f_v\\times (k-s_v)\\times s_v$\u3002\n\n\u82e5\u4e24\u8fb9\u90fd\u6ca1\u6709\u70b9\u4e00\u6837\u4ea7\u751f\u4e0d\u4e86\u53d8\u5316\uff0c\u8d21\u732e\u4e3a $(1-f_u)\\times(1-f_v)\\times(k-s_v)\\times s_v$\u3002\n\n\u82e5 $u$ \u7aef\u6709\u70b9\uff0c$v$ \u7aef\u6ca1\u6709\u70b9\uff0c\u5219\u6709 $\\frac{1}{2}$ \u7684\u6982\u7387 $u$ \u7aef\u70b9\u6570\u51cf\u5c111\uff0c$v$ \u7aef\u70b9\u6570\u589e\u52a01\uff0c$\\frac{1}{2}$ \u7684\u6982\u7387\u4e0d\u53d8\uff0c\u8d21\u732e\u4e3a $f_u\\times (1-f_v)\\times\\frac{(k-s_v)\\times s_v+(k-s_v-1)\\times(s_v+1)}{2}$\u3002\n\n\u82e5 $v$ \u7aef\u6709\u70b9\uff0c$u$ \u6bb5\u6ca1\u6709\u70b9\uff0c\u540c\u7406\u8d21\u732e\u4e3a $(1-f_u)\\times f_v\\times\\frac{(k-s_v)\\times s_v+(k-s_v+1)\\times(s_v-1)}{2}$\u3002\n\n\u4e0a\u9762\u56db\u4e2a\u5f0f\u5b50\u52a0\u8d77\u6765\u5c31\u662f\u8fd9\u6761\u8fb9\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\uff0c\u7d2f\u52a0\u5373\u53ef\u3002\n\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<string>\n#include<vector>\n#include<cmath>\n#include<queue>\n#define N 300005\n#define P 998244353\nusing namespace std;\ntypedef long long ll;\ntypedef long double ld;\ntypedef pair<int,int> PII;\ninline ll read(){\n\tll xx=0,ff=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')ff=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){xx=(xx<<1)+(xx<<3)+(ch^48);ch=getchar();}\n\treturn xx*ff;\n}\nll n,k,ans,tot=1,i2=499122177,head[N],nxt[N<<1],ver[N<<1],fa[N],sz[N],f[N];\nvoid add(int u,int v){\n\tnxt[++tot]=head[u];ver[tot]=v;head[u]=tot;\n}\nll qp(ll a,ll b=P-2){\n\tll res=1;\n\tfor(;b;b>>=1,a=a*a%P)if(b&1)res=res*a%P;\n\treturn res;\n}\nvoid dfs(int u,int from){//\u6c42\u51fa\u5b50\u6811\u5927\u5c0f\n\tfa[u]=from;sz[u]=f[u];\n\tfor(int i=head[u];i;i=nxt[i])if(ver[i]!=from)dfs(ver[i],u),sz[u]+=sz[ver[i]];\n}\nint main(){\n\tn=read();k=read();\n\tfor(int i=1;i<=k;i++)f[read()]=1;\n\tfor(int i=1;i<n;i++){\n\t\tint u=read(),v=read();\n\t\tadd(u,v);add(v,u);\n\t}\n\tdfs(1,1);\n\tfor(int i=2;i<=tot;i+=2){\n\t\tint u=ver[i^1],v=ver[i];\n\t\tif(fa[u]==v)swap(u,v);\n\t\tans=((ans+f[u]*f[v]%P*sz[v]%P*(k-sz[v])%P+(1-f[u]+P)*(1-f[v]+P)%P*sz[v]%P*(k-sz[v])%P+(1-f[u]+P)*f[v]%P*(sz[v]*(k-sz[v])%P+(sz[v]-1)*(k-sz[v]+1)%P)%P*i2%P+f[u]*(1-f[v]+P)%P*(sz[v]*(k-sz[v])%P+(sz[v]+1)*(k-sz[v]-1)%P)%P*i2%P)%P+P)%P;//\u8fd9\u4e00\u957f\u4e32\u5f0f\u5b50\u662f\u5f53\u524d\u8fb9\u7684\u8d21\u732e\u503c\n\t\tf[u]=f[v]=(f[u]+f[v])*i2%P;//\u4fee\u6539\u51fa\u73b0\u6982\u7387\n\t}\n\tprintf(\"%lld\\n\",ans*qp(k*(k-1)/2%P)%P);//\u7ed3\u679c\u8981\u9664\u4ee5k*(k-1)/2\n\treturn 0;\n}\n```\n",
        "postTime": 1672461030,
        "uid": 197616,
        "name": "CbrX",
        "ccfLevel": 6,
        "title": "CF1770E\u9898\u89e3"
    },
    {
        "content": "### Preface  \n\u8fd9\u662f\u849f\u84bb\u81ea\u5df1\u505a\u7684\u7b2c\u4e00\u9053\u671f\u671b\u76f8\u5173\u9898\u76ee\uff0c\u4f46\u662f\u7531\u4e8e\u662f dp \u6240\u4ee5\u505a\u51fa\u6765\u4e86\u3002  \n### Problem  \n\u7ed9\u4f60\u4e00\u68f5\u6811\uff0c\u6811\u4e0a\u6709\u82e5\u5e72\u4e2a\u70b9\u662f\u6709\u8774\u8776\u7684\uff0c\u7136\u540e\u6211\u4eec\u4f1a\u6839\u636e\u6bcf\u6761\u8fb9\u7684\u7f16\u53f7\u4f9d\u6b21\u505a\u4ee5\u4e0b\u64cd\u4f5c\uff1a  \n**\u7b49\u6982\u7387\u5730\u5bf9\u8fd9\u6761\u8fb9\u5b9a\u5411\uff0c\u5373\u4e8c\u5206\u4e4b\u4e00 $\\space a\\rightarrow b$\uff0c\u4e8c\u5206\u4e4b\u4e00\u53cd\u4e4b\u3002**  \n\u7136\u540e\uff0c\u82e5\u8fd9\u6761\u8fb9\u5b9a\u5411\u4e4b\u540e\u7684\u8d77\u59cb\u70b9\u6709\u8774\u8776\u800c\u7ec8\u70b9\u6ca1\u6709\uff0c\u6211\u4eec\u5c31\u5c06\u8fd9\u53ea\u8774\u8776\u653e\u5230\u8fd9\u6761\u8fb9\u7684\u7ec8\u70b9\u3002  \n\u5728\u6240\u6709\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e\uff0c\u968f\u673a\u9009\u4e00\u4e2a\u8774\u8776\u5bf9\uff0c\u95ee\u9009\u51fa\u8774\u8776\u5bf9\u7684\u8ddd\u79bb\u671f\u671b\u3002  \n\n\u539f\u9898\u94fe\u63a5\uff1ahttps://codeforces.com/contest/1770/problem/E  \n\n### Solution  \n\u9996\u5148\uff0c\u6709\u4e00\u4e2a\u6709\u610f\u601d\u7684\u6027\u8d28\uff1a\u7531\u4e8e\u8fd9\u662f\u4e00\u68f5\u6811\uff0c\u6240\u4ee5\u5f53\u4e00\u6761\u8fb9\u6ca1\u6709\u88ab\u64cd\u4f5c\u7684\u65f6\u5019\u4e8b\u5b9e\u4e0a\u8fd9\u6761\u8fb9\u4e24\u8fb9\u7684\u70b9\u6570\u90fd\u662f\u786e\u5b9a\u7684\uff0c\u8fd9\u4e2a\u5f88\u91cd\u8981\u3002  \n\n\u4e00\u65e6\u6211\u4eec\u77e5\u9053\u8fd9\u4e2a\u6027\u8d28\uff0c\u6211\u4eec\u5373\u53ef\u63a8\u51fa\u8fd9\u6761\u8fb9\u6b63\u53cd\u64cd\u4f5c\u65f6\u5bf9\u5168\u5c40\u8ddd\u79bb\u7684\u5f71\u54cd\u3002  \n\uff08\u5168\u5c40\u8ddd\u79bb\u5373 $\\sum_{i=1}^{i\\leq k} \\sum_{j=i+1}^{j\\leq k} dis(a_i,a_j)$ \uff09\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5f88\u7b80\u5355\u7684\u53d1\u73b0\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u5168\u5c40\u8ddd\u79bb\u7684\u671f\u671b $res$\uff0c$res\\times \\frac{2}{k(k-1)}$ \u5c31\u662f\u7b54\u6848\u3002  \n\n\u7136\u540e\u6211\u4eec\u73b0\u5728\u600e\u4e48\u529e\u5462\uff1f  \n\n\u663e\u7136\u5bf9\u4e8e\u4e00\u6761\u8fb9\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u5176\u4e24\u8fb9\u7684\u70b9\u4e0a\u9762\u6709\u8774\u8776\u7684\u6982\u7387\u624d\u597d\u505a\u4e0b\u4e00\u6b65\u64cd\u4f5c\u3002  \n\n\u4e8e\u662f\u6211\u4eec\u8bbe $f_i$ \u4e3a\u70b9 $i$ \u4e0a\u6709\u8774\u8776\u7684\u6982\u7387\u3002  \n\n\u7136\u540e\u6211\u4eec\u5c31\u5f88\u5bb9\u6613\u53d1\u73b0\u5f53\u6211\u4eec\u64cd\u4f5c\u8fb9 $i$ \u7684\u65f6\u5019\uff0c$res$ \u4f1a\u8fd9\u4e48\u53d8\u5316\uff08$s_{i,0/1}$ \u5206\u522b\u4e3a\u6b63\u53cd\u64cd\u4f5c\u5bf9\u4e8e\u5168\u5c40\u8ddd\u79bb\u7684\u53d8\u5316\u91cf\uff09\uff1a  \n$res\\leftarrow res+\\frac{1}{2}\\times(f_{u_i}\\times (1-f_{v_i}))\\times s_{i,0}$  \n$res\\leftarrow res+\\frac{1}{2}\\times(f_{v_i}\\times (1-f_{u_i}))\\times s_{i,1}$  \n\n\u7136\u540e\u662f $f$ \u7684\u8f6c\u79fb\uff1a  \n$v1\\leftarrow \\frac{1}{2} \\times (f_{u_i}\\times (1-f_{v_i}))$  \n$v2\\leftarrow \\frac{1}{2} \\times (f_{v_i}\\times (1-f_{u_i}))$  \n$f_{u_i}\\leftarrow f_{u_i}+v2-v1$  \n$f_{v_i}\\leftarrow f_{v_i}+v1-v2$  \n\n\u505a\u5b8c\u8fd9\u4e2a\u8f6c\u79fb\uff0c\u8fd9\u4e2a\u9898\u5c31\u505a\u5b8c\u4e86\u3002  \ncode\uff1a  \n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=3e5+10;\nconst int mod=998244353;\nconst int inv=(mod+1)/2;\nint n,k,a[N],u[N],v[N],res,sz[N],val[N],f[N],s[N][2];\nvector <int> edge[N];vector <int> id[N];bool tag[N];\nint h[65];\nint fast_pow(int x,int y){\n\th[0]=x;for(int i=1;i<=30;i++){\n\t\th[i]=h[i-1]*h[i-1];h[i]%=mod;\n\t}int res=1;\n\tfor(int i=30;i>=0;i--){\n\t\tif(y>=(1<<i)){\n\t\t\ty-=(1<<i);\n\t\t\tres*=h[i];res%=mod;\n\t\t}\n\t}return res;\n}\nvoid dfs(int u,int fa){\n\tsz[u]+=tag[u];\n\tfor(int i=0;i<edge[u].size();i++){\n\t\tint v=edge[u][i];\n\t\tif(v==fa)continue;\n\t\tdfs(v,u);sz[u]+=sz[v];\n\t\tval[u]+=val[v]+sz[v];val[u]%=mod;\n\t}//cout<<u<<\" \"<<val[u]<<endl;\n}\nvoid calc(int x,int fa,int p,int l){\n\tp%=mod;if(tag[x]){\n\t\t//cout<<x<<\" \"<<val[x]<<\" \"<<l<<endl;\n\t\tres+=val[x]+l,res%=mod;\n\t}\n\tfor(int i=0;i<edge[x].size();i++){\n\t\tint v=edge[x][i];int I=id[x][i];\n\t\tif(v==fa)continue;\n\t\tif(x==u[I]){\n\t\t\ts[I][0]=p+sz[x]-sz[v]-1-sz[v];\n\t\t\ts[I][1]=sz[v]-1-(sz[x]-sz[v])-p;\n\t\t}else{\n\t\t\ts[I][0]=sz[v]-1-(sz[x]-sz[v])-p;\n\t\t\ts[I][1]=p+sz[x]-sz[v]-1-sz[v];\n\t\t}\n\t\tcalc(v,x,p+(sz[x]-sz[v]),l+(k-sz[v])+(val[x]-val[v]-sz[v]));\n\t}\n}\nsigned main(){\n\tios::sync_with_stdio(0);cin.tie(0);cout.tie(0);\n\tcin>>n>>k;\n\tfor(int i=1;i<=k;i++)cin>>a[i],tag[a[i]]=1,f[a[i]]=1;\n\tfor(int i=1;i<n;i++)cin>>u[i]>>v[i];\n\tfor(int i=1;i<n;i++){\n\t\tedge[u[i]].push_back(v[i]);\n\t\tid[u[i]].push_back(i);\n\t\tedge[v[i]].push_back(u[i]);\n\t\tid[v[i]].push_back(i);\n\t}\n\tdfs(1,0);calc(1,0,0,0);res*=inv;res%=mod;//cout<<res<<endl;\n\tfor(int i=1;i<n;i++){\n\t\tres+=(inv*f[u[i]]%mod*(1-f[v[i]]+mod)%mod*s[i][0])%mod,res=(res+mod)%mod;\n\t\tres+=(inv*f[v[i]]%mod*(1-f[u[i]]+mod)%mod*s[i][1])%mod,res=(res+mod)%mod;\n\t\tint v1=(f[u[i]]*((1-f[v[i]]+mod)%mod)%mod*inv%mod);\n\t\tint v2=(f[v[i]]*((1-f[u[i]]+mod)%mod)%mod*inv%mod);\n\t\tf[v[i]]+=v1,f[v[i]]%=mod;f[u[i]]-=v1,f[u[i]]=(f[u[i]]+mod)%mod;\n\t\tf[u[i]]+=v2,f[u[i]]%=mod;f[v[i]]-=v2,f[v[i]]=(f[v[i]]+mod)%mod;\n\t\t//cout<<s[i][0]<<\" \"<<s[i][1]<<endl;\n\t\t//for(int j=1;j<=n;j++)cout<<f[j]<<\" \";cout<<endl;\n\t}res*=fast_pow(k,mod-2);res%=mod;\n\tres*=fast_pow(k-1,mod-2);res%=mod;\n\tres*=2;res%=mod;\n\tcout<<res;\n}\n```\n",
        "postTime": 1672503150,
        "uid": 213173,
        "name": "\u5c0f\u6728\u866b",
        "ccfLevel": 4,
        "title": "\u3010CF\u601d\u7ef4\u8bad\u7ec3\u3011CF1770E Koxia and Tree"
    },
    {
        "content": "### Div1.5 \u4e0d\u4f1a E \uff0c\u8b66\u949f\u957f\u9e23\u3002\n\n## \u8f6c\u5316\uff1a\n\n\u8003\u8651\u4e0d\u79fb\u52a8\u7684\u60c5\u51b5\uff0c\u8ba1\u7b97\u6bcf\u6761\u8fb9\u7684\u8d21\u732e\uff0c\n\n$$preans = \\frac{2}{k(k-1)} \\sum_{x}(k-siz_x)siz_x$$\n\n$siz_x$ \u8868\u793a $x$ \u5b50\u6811\u5185\u7684\u8774\u8776\u4e2a\u6570\u3002\n\n\u6027\u8d28\uff1a\u6bcf\u6761\u8fb9\u4e0a\u6700\u591a\u53ea\u4f1a\u6709\u4e00\u53ea\u8774\u8776\u7ecf\u8fc7\uff0c\u6240\u4ee5\u6bcf\u9897\u5b50\u6811\u5927\u5c0f\u7684\u53ef\u80fd\u6027\u81f3\u591a $3$ \u79cd\uff1b\u53c8\u8774\u8776\u7684\u76f8\u5bf9\u4f4d\u7f6e\u5173\u7cfb\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u3002\n\n\u90a3\u4e48\u4e0d\u59a8\u76f4\u63a5\u8ba1\u7b97\u6bcf\u6761\u8fb9\u4e0a\u7684\u79fb\u52a8\u5728 $preans$ \u57fa\u7840\u4e0a\u7684\u8d21\u732e\u3002\u4e3a\u6b64\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6bcf\u6761\u8fb9\u4e0a\u53d1\u751f\u67d0\u79cd\u65b9\u5411\u79fb\u52a8\u7684\u5206\u522b\u7684\u6982\u7387\u5c31\u53ef\u4ee5\u4e86\u3002\n\n## \u8ba1\u7b97\uff1a\n\n\u8bbe $f_x$ \u8868\u793a\u5728\u5f53\u524d\u65f6\u523b\u70b9 $x$ \u4e0a\u6709\u8774\u8776\u7684\u6982\u7387\uff0c\u5176\u521d\u59cb\u5316\u662f\u7b80\u5355\u7684\u3002\u6309\u987a\u5e8f\u904d\u5386\u6bcf\u6761\u8fb9 $(u,v)$ \u663e\u7136\u53ea\u6709 $f_u$ \u548c $f_v$ \u53ef\u80fd\u53d1\u751f\u53d8\u5316\u3002\u53ef\u4ee5\u5217\u51fa\u5f0f\u5b50\uff1a\n\n$$f_u=\\frac{1}{2}f_uf_v+\\frac{1}{2}(f_v(1-f_u)+f_u)=\\frac{1}{2}(f_u+f_v)$$\n\n$$f_v=\\frac{1}{2}f_vf_u+\\frac{1}{2}(f_u(1-f_v)+f_v)=\\frac{1}{2}(f_v+f_u)$$\n\n\u6bcf\u6b21\u5904\u7406\u4e00\u6761\u8fb9\u5bf9 $f_x$ \u7684\u8d21\u732e\u4e4b\u524d\uff0c\u7528\u524d\u9762\u7b97\u597d\u7684 $f_x$ \u8ba1\u7b97\u8fb9\u4e0a\u53d1\u751f\u67d0\u79cd\u65b9\u5411\u79fb\u52a8\u7684\u5206\u522b\u7684\u6982\u7387\uff0c\u518d\u4e58\u4e0a\u4e24\u8fb9\u70b9\u7684\u4e2a\u6570\u5c31\u505a\u5b8c\u4e86\u3002\u7ec6\u8282\u53ef\u4ee5\u770b\u770b code \u3002\u4e4b\u540e\u518d\u66f4\u65b0 $f_u$ \u548c $f_v$ \u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u5148\u5ffd\u7565 $\\frac{2}{k(k-1)}$ \uff0c\u5373\u59cb\u7ec8\u6c42\u7684\u662f\u6240\u6709\u8774\u8776\u4e24\u4e24\u8ddd\u79bb\u4e4b\u548c\uff0c\u6700\u540e\u518d\u4e58\u4ee5 $\\frac{2}{k(k-1)}$ \u3002\n\n## \u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nconst int mod = 998244353, i2 = 499122177;\ninline int mul(int x, int y){\n\treturn (int)(1ll * x * y % (1ll * mod));\n}\ninline int add(int x, int y){\n\treturn x + y >= mod ? x + y - mod : x + y;\n}\ninline int minus(int x, int y){\n\treturn x < y ? x - y + mod : x - y; \n}\ninline int Qpow(int x, int y){\n\tint r = 1;\n\twhile(y){\n\t\tif(y & 1) r = mul(r, x);\n\t\tx = mul(x, x);\n\t\ty >>= 1;\n\t}\n\treturn r;\n}\nint n, a[300005], k, f[300005], B, fa[300005];\nint u[300005], v[300005], siz[300005];\nint g[300005], dep[300005], m[300005], ans = 0;\nstd::vector <int> ver[300005];\nvoid dfs(int x){\n\tsiz[x] = a[x];\n\tfor(int i = 0; i < ver[x].size(); ++i){\n\t\tint y = ver[x][i];\n\t\tif(y == fa[x]) continue;\n\t\tdep[y] = dep[x] + 1;\n\t\tfa[y] = x;\n\t\tdfs(y);\n\t\tsiz[x] += siz[y];\n\t}\n\tans = add(ans, mul(siz[x], k - siz[x]));\n\treturn ;\n}\nvoid solve(){\n\tscanf(\"%d%d\", &n, &k);\n\tfor(int i = 1; i <= k; ++i){\n\t\tint x;\n\t\tscanf(\"%d\", &x);\n\t\ta[x] = 1;\n\t}\n\tfor(int i = 1; i <= n - 1; ++i){\n\t\tint x, y;\n\t\tscanf(\"%d%d\", &x, &y);\n\t\tu[i] = x; v[i] = y;\n\t\tver[x].push_back(y);\n\t\tver[y].push_back(x);\n\t}\n\tdfs(1);\n\tfor(int i = 1; i <= n; ++i) f[i] = a[i];\n\tfor(int i = 1; i <= n - 1; ++i){\n\t\tif(fa[u[i]] == v[i]) std::swap(u[i], v[i]);\n\t\tint a = f[u[i]], b = f[v[i]];\n\t\tint p1 = mul(mul(i2, f[u[i]]), minus(1, f[v[i]]));\n\t\tint p2 = mul(mul(i2, f[v[i]]), minus(1, f[u[i]]));\n\t\tans = add(ans, mul(p1, k - siz[v[i]] - 1));\n\t\tans = minus(ans, mul(p1, siz[v[i]]));\n\t\tans = add(ans, mul(p2, siz[v[i]] - 1));\n\t\tans = minus(ans, mul(p2, k - siz[v[i]]));\n\t\tf[u[i]] = add(a, b);\n\t\tf[u[i]] = mul(f[u[i]], i2);\n\t\tf[v[i]] = f[u[i]];\n\t}\n\tB = mul(k, k - 1);\n\tB = mul(B, i2);\n\tans = mul(ans, Qpow(B, mod - 2));\n\tprintf(\"%d\\n\", ans);\n\treturn ;\n}\nsigned main(){\n\tint T = 1;\n\twhile(T--) solve();\n\treturn 0;\n}\n```\n",
        "postTime": 1672492444,
        "uid": 131591,
        "name": "\u849f\u84bb\u541bHJT",
        "ccfLevel": 7,
        "title": "CF1770E Koxia and Tree \u9898\u89e3"
    },
    {
        "content": "\u5148\u5bf9\u4e0d\u597d\u5904\u7406\u7684\u90e8\u5206\u505a\u4e00\u4e2a\u8f6c\u5316\uff1a\u4efb\u53d6\u4e24\u4e2a\u8774\u8776\u5e76\u8ba1\u7b97\u5b83\u4eec\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u7b49\u4ef7\u4e8e\u6240\u6709\u8774\u8776\u4e24\u4e24\u8ddd\u79bb\u7684\u5e73\u5747\u503c\u3002\u4e8e\u662f\u53ea\u9700\u8981\u6c42\u6240\u6709\u8774\u8776\u4e24\u4e24\u8ddd\u79bb\u7684\u548c\u3002\n\n\u9996\u5148\u4ee4\u6bcf\u6761\u8fb9\u90fd\u6309\u8f93\u5165\u987a\u5e8f\u5b9a\u5411\uff0cDFS \u9884\u5904\u7406\u51fa\u6bcf\u6761\u8fb9\u4e24\u4fa7\u8774\u8776\u7684\u6570\u91cf\uff0c\u5bb9\u6613\u8ba1\u7b97\u51fa\u521d\u59cb\u5c40\u9762\u4e0b\u7684\u7b54\u6848\u3002\n\n\u7136\u540e\u6309\u7167\u8f93\u5165\u987a\u5e8f\u679a\u4e3e\u6bcf\u6761\u8fb9\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u6b65\u7684\u6309\u987a\u5e8f\u64cd\u4f5c\u3002\u6211\u4eec\u7ef4\u62a4 $dp$ \u6570\u7ec4\u8868\u793a\u6b64\u65f6\u6bcf\u4e2a\u70b9\u6709\u8774\u8776\u7684\u6982\u7387\uff0c\u7136\u540e\u5206\u522b\u8003\u8651 $u_i\\to v_i$ \u548c $v_i\\to u_i$ \u4e24\u79cd\u53ef\u80fd\u7684\u8774\u8776\u79fb\u52a8\uff0c\u901a\u8fc7\u6570\u5b66\u63a8\u5bfc\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6b64\u65f6\u6bcf\u6761\u8fb9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4ee5\u53ca\u65b0\u7684\u6982\u7387\u3002\n\n\u5f0f\u5b50\u4e0d\u96be\u63a8\uff0c\u4f46\u662f\u6bd4\u8f83\u957f\u4e0d\u65b9\u4fbf\u5217\u51fa\uff0c\u8be6\u89c1\u4ee3\u7801\u3002\n\n```cpp\n// Problem: E. Koxia and Tree\n// Contest: Codeforces - Good Bye 2022: 2023 is NEAR\n// URL: https://codeforces.com/contest/1770/problem/E\n// Memory Limit: 256 MB\n// Time Limit: 3000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n//By: OIer rui_er\n#include <bits/stdc++.h>\n#define rep(x,y,z) for(ll x=(y);x<=(z);x++)\n#define per(x,y,z) for(ll x=(y);x>=(z);x--)\n#define debug(format...) fprintf(stderr, format)\n#define fileIO(s) do{freopen(s\".in\",\"r\",stdin);freopen(s\".out\",\"w\",stdout);}while(false)\nusing namespace std;\ntypedef long long ll;\nconst ll N = 3e5+5, mod = 998244353, inv2 = 499122177;\n\nll n, k, a[N], U[N], V[N], vis[N], dp[N], cntV[N], cntE[N];\nvector<tuple<ll, ll>> e[N];\ntemplate<typename T> void chkmin(T& x, T y) {if(x > y) x = y;}\ntemplate<typename T> void chkmax(T& x, T y) {if(x < y) x = y;}\nll qpow(ll x, ll y) {\n\tll ans = 1;\n\tfor(; y; y >>= 1, x = x * x % mod) if(y & 1) ans = ans * x % mod;\n\treturn ans;\n}\nll inv(ll x) {return qpow(x, mod-2);}\nvoid dfs(ll u, ll f) {\n\tcntV[u] = vis[u];\n\tfor(auto i : e[u]) {\n\t\tll v = get<0>(i), id = get<1>(i);\n\t\tif(v == f) continue;\n\t\tdfs(v, u);\n\t\tcntV[u] += cntV[v];\n\t\tcntE[id] = v == U[id] ? cntV[v] : k - cntV[v];\n\t}\n}\n\nint main() {\n\tscanf(\"%lld%lld\", &n, &k);\n\trep(i, 1, k) scanf(\"%lld\", &a[i]);\n\trep(i, 1, n-1) {\n\t\tscanf(\"%lld%lld\", &U[i], &V[i]);\n\t\te[U[i]].emplace_back(V[i], i);\n\t\te[V[i]].emplace_back(U[i], i);\n\t}\n\trep(i, 1, k) vis[a[i]] = 1;\n\tdfs(1, 0);\n\tll ans = 0;\n\trep(i, 1, n-1) ans = (ans + cntE[i] * (k - cntE[i]) % mod) % mod;\n\trep(i, 1, n) dp[i] = vis[i];\n\trep(i, 1, n-1) {\n\t\tans = (ans + dp[U[i]] * (1 + mod - dp[V[i]]) % mod * (((cntE[i] - 1) - (k - cntE[i]) + 3 * mod) % mod) % mod * inv2 % mod) % mod;\n\t\tans = (ans + dp[V[i]] * (1 + mod - dp[U[i]]) % mod * (((k - cntE[i] - 1) - (cntE[i]) + 3 * mod) % mod) % mod * inv2 % mod) % mod;\n\t\tll x = dp[U[i]], y = dp[V[i]];\n\t\tdp[U[i]] = (x * inv2 % mod + x * y % mod * inv2 % mod + y * (1 + mod - x) % mod * inv2 % mod) % mod;\n\t\tdp[V[i]] = (y * inv2 % mod + x * y % mod * inv2 % mod + x * (1 + mod - y) % mod * inv2 % mod) % mod;\n\t}\n\tans = ans * inv(k*(k-1)/2%mod) % mod;\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1672458519,
        "uid": 122461,
        "name": "rui_er",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1770E\u3010Koxia and Tree\u3011"
    }
]