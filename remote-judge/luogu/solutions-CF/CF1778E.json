[
    {
        "content": "### \u9898\u76ee\u4f20\u9001\u95e8\n\n[\u6d1b\u8c37](https://www.luogu.com.cn/problem/CF1778E)\n\n[CF](https://codeforces.com/contest/1778/problem/E)\n\n### \u5206\u6790\n\n\u770b\u5230\u5f02\u6216\u6700\u5927\uff0c\u6211\u4eec\u9996\u5148\u8981\u60f3\u5230[\u7ebf\u6027\u57fa](https://oi-wiki.org/math/linear-algebra/basis/)\u3002\n\n\u6211\u4eec\u5148\u5b9a $1$ \u4e3a\u6839\uff0c\u6c42\u4e00\u4e2a dfs \u5e8f\u3002\n\n\u5bf9\u4e8e $r$ \u548c $v$ \u7684\u5173\u7cfb\uff0c\u6211\u4eec\u5206\u4e09\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n1.  $r = v$ \u65f6\uff0c\u53d6\u533a\u95f4 $[1,n]$ \uff08\u5373\u6574\u9897\u6811\uff09\u3002\n\n1.  \u5f53 $v$ \u4e3a $r$ \u7684\u7956\u5148\u65f6\uff0c\u53d6 $r$ \u7684\u7956\u5148\u4e2d\u6df1\u5ea6\u5c0f\u4e8e $v$ \u4e14\u6df1\u5ea6\u6700\u5927\u7684\u8282\u70b9\uff08$v$ \u7684\u5b50\u8282\u70b9\uff09\u8bb0\u4e3a $t$\uff0c\u53d6\u533a\u95f4 $[1,L_t-1]$ \u548c\u533a\u95f4 $[R_t+1,n]$\u3002\n\n1.  \u5176\u5b83\u60c5\u51b5\uff0c\u53d6\u533a\u95f4 $[L_v,R_v]$\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u539f\u6570\u7ec4\u590d\u5236\u4e24\u500d\uff0c\u628a\u540e\u7f00\u548c\u524d\u7f00\u5408\u5e76\u6210\u4e00\u4e2a\u533a\u95f4\u3002\n\n\u6211\u4eec\u4ece\u524d\u5230\u540e\u626b\u63cf\uff0c\u4e0d\u65ad\u5730\u52a0\u5165\u6570\u3002\u7531\u4e8e\u662f\u4ece\u524d\u5230\u540e\u7684\uff0c\u7ebf\u6027\u57fa\u4e2d\u5e94\u5f53\u8d2a\u5fc3\u5730\u4fdd\u7559\u4f4d\u7f6e\u6700\u5927\u7684\u6570\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u6709 $O(n \\log N)$\uff0c\u5176\u4e2d $N$ \u662f\u503c\u57df\u8303\u56f4\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>inline void read(register T &x)\n{\n\tregister T p = 1,num = 0;\n\tchar c = getchar();\n\twhile(c < '0'||c > '9')\n\t{\n\t\tif(c == '-') p = -p;\n\t\tc = getchar();\n\t}\n\twhile('0' <= c&&c <= '9')\n\t{\n\t\tnum = (num<<3)+(num<<1)+(c^48);\n\t\tc = getchar();\n\t}\n\tx = p * num;\n}\ntemplate<typename T>inline void write(register T x)\n{\n\tif(x < 0) putchar('-'),x = -x;\n\tif(x > 9) write(x/10);\n\tputchar(x%10+48);\n}\n#define D(i,a,b) for(register int i=a;i>=b;--i)\n#define F(i,a,b) for(register int i=a;i<=b;++i)\n#define ll long long\n#define pii pair<int,int>\n#define N 200010\nint head[N],nxt[N<<1],to[N<<1],cnt;\ninline void add(int u,int v)\n{\n\tnxt[++cnt] = head[u];\n\thead[u] = cnt;\n\tto[cnt] = v;\n}\npii a[N<<1];\nint ans[N],t,n,q;\nvector<pii> b[N<<1];\nint L[N],R[N],f[N][20],dep[N],times = 0;\nvoid dfs(int u,int fa)\n{\n\tL[u] = ++times;\n\tf[u][0] = fa;\n\tdep[u] = dep[fa] + 1;\n\tfor(register int i = head[u];i;i = nxt[i])\n\t{\n\t\tint v = to[i];\n\t\tif(v == fa) continue;\n\t\tdfs(v,u);\n\t}\n\tR[u] = times;\n}\ninline int lca(int u,int v)\n{\n\tif(dep[u] < dep[v]) swap(u,v);\n\tD(i,18,0)\n\t\tif(dep[f[u][i]] >= dep[v])\n\t\t\tu = f[u][i];\n\tif(u == v) return u;\n\tD(i,18,0)\n\t\tif(f[u][i] != f[v][i])\n\t\t\tu = f[u][i],v = f[v][i];\n\treturn f[u][0];\n}\ninline int near(int u,int v)\n{\n\tD(i,18,0)\n\t\tif(dep[f[v][i]] > dep[u])\n\t\t\tv = f[v][i];\n\treturn v;\n}\nstruct ji_ni_tai_mei\n{\n\tint a[35],p[35]; \n\tinline void clear()  \n\t{\n\t\tmemset(a,0,sizeof(a));\n\t\tmemset(p,0,sizeof(p));\n\t}\t\n\tinline void update(int t,int x)\n\t{\n\t\tD(i,30,0)\n\t\t{\n\t\t\tif(!(x & (1<<i))) continue;\n\t\t\tif(!a[i])\n\t\t\t{\n\t\t\t\ta[i] = x,p[i] = t;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(t > p[i])\n\t\t\t{\n\t\t\t\tswap(t,p[i]);\n\t\t\t\tint tp = x^a[i];\n\t\t\t\ta[i] = x;\n\t\t\t\tx = tp;\n\t\t\t}\n\t\t\telse x ^= a[i];\n\t\t}\n\t}\n\tinline int query(int l)\n\t{\n\t\tint ret = 0;\n\t\tD(i,30,0)\n\t\t\tif(p[i] >= l&&(ret ^ a[i]) > ret)\n\t\t\t\tret ^= a[i];\n\t\treturn ret;\t\n\t}\n}ikun;\ninline bool cmp(const pii &x,const pii &y)\n{\n\treturn L[x.first] < L[y.first];\n}\nint main()\n{\n\tread(t);\n\twhile(t--)\n\t{\n\t\tread(n);\n\t\tF(i,1,n) read(a[i].second),a[i].first = i;\n\t\tcnt = times = 0;\n\t\tF(i,0,n) head[i] = 0;\n\t\tF(i,1,n-1)\n\t\t{\n\t\t\tint u,v;\n\t\t\tread(u),read(v);\n\t\t\tadd(u,v);\n\t\t\tadd(v,u);\t\n\t\t}\n\t\tdfs(1,0);\n\t\tF(i,1,18) \n\t\t\tF(j,1,n)\n\t\t\t\tf[j][i] = f[f[j][i-1]][i-1];\n\t\tsort(&a[1],&a[n+1],cmp);\n\t\tF(i,n+1,n<<1) a[i] = a[i-n];\n\t\tread(q);\n\t\tF(i,1,n<<1) b[i].clear();\n\t\tF(i,1,q)\n\t\t{\n\t\t\tint u,v;\n\t\t\tread(u),read(v);\t\n\t\t\tint x = lca(u,v);\n\t\t\tif(u == v) b[n].push_back((pii){i,1});\n\t\t\telse if(x == v) \n\t\t\t{\n\t\t\t\tint t = near(v,u);\n\t\t\t\tb[L[t]+n-1].push_back((pii){i,R[t]+1});\n\t\t\t}\n\t\t\telse b[R[v]].push_back((pii){i,L[v]});\n\t\t}\n\t\tikun.clear();\n\t\tF(i,1,n<<1)\n\t\t{\n\t\t\tikun.update(i,a[i].second);\n\t\t\tfor(auto p:b[i]) ans[p.first] = ikun.query(p.second);\n\t\t}\n\t\tF(i,1,q) write(ans[i]),putchar('\\n');\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1677758210,
        "uid": 197648,
        "name": "Wangxun",
        "ccfLevel": 5,
        "title": "CF1778E \u9898\u89e3"
    },
    {
        "content": "\u548b\u6ca1\u4eba\u5199\u4e2a\u5355 $\\log$ \u9898\u89e3\u3002\n\n\u6c42\u51fa\u4e00\u4e2a\u4ee5 $1$ \u4e3a\u6839\u7684 dfn \u5e8f\u3002\u8be2\u95ee\u65f6\u8ba8\u8bba\u4e00\u4e0b $r$ \u548c $v$ \u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u5c06\u5b50\u6811\u5b9a\u4f4d\u5230 dfn \u5e8f\u7684\u4e00\u6bb5\u533a\u95f4\uff0c\u6216\u8005\u4e00\u6bb5\u524d\u7f00\u5e76\u4e0a\u4e00\u6bb5\u540e\u7f00\u3002\n\n\u524d\u7f00\u5e76\u540e\u7f00\u53ef\u4ee5\u901a\u8fc7\u5c06\u6574\u4e2a\u5e8f\u5217\u590d\u5236\u4e00\u4efd\uff0c\u53d8\u4e3a\u4e00\u6bb5\u533a\u95f4\u3002\n\n\u73b0\u5728\u95ee\u9898\u53d8\u4e3a\u67e5\u8be2\u533a\u95f4\u7b54\u6848\u3002\n\n\u79bb\u7ebf\uff0c\u4ece\u5de6\u5411\u53f3\u626b\u63cf\u6574\u4e2a\u5e8f\u5217\uff0c\u5728\u53f3\u7aef\u70b9\u5904\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a\u201c\u6700\u53f3\u7ebf\u6027\u57fa\u201d\uff0c\u5373\u63d2\u5165\u65f6\u9047\u5230\u4e24\u4e2a\u7b49\u4ef7\u7684\u57fa\uff0c\u6211\u4eec\u4fdd\u7559\u4f4d\u7f6e\u9760\u53f3\u7684\u57fa\uff0c\u7136\u540e\u7ee7\u7eed\u63d2\u5165\u53e6\u4e00\u4e2a\u57fa\u3002\uff08\u5177\u4f53\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\uff09\n\n\u82e5\u5de6\u7aef\u70b9\u4e3a $l$\uff0c\u7ebf\u6027\u57fa\u4e2d\u4f4d\u7f6e $\\geq l$ \u7684\u57fa\u6240\u6784\u6210\u7684\u7ebf\u6027\u57fa\u5373\u4e3a\u8fd9\u4e2a\u533a\u95f4\u7684\u7ebf\u6027\u57fa\u3002\n\n\u76f4\u63a5\u5728\u8fd9\u4e2a\u7ebf\u6027\u57fa\u91cc\u67e5\u8be2\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O((n+Q)\\log V)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=2e5+5;\n\nstruct basis {\n\tint f[30],p[30];\n\tbasis() {\n\t\tmemset(f,0,sizeof(f));\n\t\tmemset(p,0,sizeof(p));\n\t}\n\tvoid insert(int pos,int x) {\n\t\tfor (int i=29;i>=0;i--) {\n\t\t\tif (x>>i&1) {\n\t\t\t\tif (f[i]) {\n\t\t\t\t\tif (pos>p[i]) {\n\t\t\t\t\t\tswap(pos,p[i]);\n\t\t\t\t\t\tswap(x,f[i]);\n\t\t\t\t\t}\n\t\t\t\t\tx^=f[i];\n\t\t\t\t} else {\n\t\t\t\t\tp[i]=pos;\n\t\t\t\t\tf[i]=x;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint query(int l) {\n\t\tint ret=0;\n\t\tfor (int i=29;i>=0;i--) {\n\t\t\tif (ret>>i&1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (p[i]>=l) {\n\t\t\t\tret^=f[i];\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n}b;\nint n,Q,a[N],dfn[N],ndfn[N],siz[N],cntdfn;\nvector<int>e[N],son[N];\nvoid dfs(int now,int father) {\n\tndfn[dfn[now]=++cntdfn]=now;\n\tsiz[now]=1;\n\tfor (int to:e[now]) {\n\t\tif (to==father) {\n\t\t\tcontinue;\n\t\t}\n\t\tdfs(to,now);\n\t\tson[now].emplace_back(to);\n\t\tsiz[now]+=siz[to];\n\t}\n}\nint ans[N];\nvector<pair<int,int>>q[N+N];\nvoid work() {\n\tfor (int i=1;i<=n+n;i++) {\n\t\tq[i].clear();\n\t}\n\tcntdfn=0;\n\tcin>>n;\n\tfor (int i=1;i<=n;i++) {\n\t\tcin>>a[i];\n\t\te[i].clear();\n\t\tson[i].clear();\n\t}\n\tfor (int i=1;i<n;i++) {\n\t\tint u,v;\n\t\tcin>>u>>v;\n\t\te[u].emplace_back(v);\n\t\te[v].emplace_back(u);\n\t}\n\tdfs(1,0);\n\tcin>>Q;\n\tfor (int i=1;i<=Q;i++) {\n\t\tint r,x;\n\t\tcin>>r>>x;\n\t\tif (r==x) {\n\t\t\tq[n].emplace_back(1,i);\n\t\t} else if (dfn[r]<dfn[x]||dfn[x]+siz[x]<=dfn[r]) {\n\t\t\tq[dfn[x]+siz[x]-1].emplace_back(dfn[x],i);\n\t\t} else {\n\t\t\tint p=*--upper_bound(son[x].begin(),son[x].end(),r,[&](int x,int y) {\n\t\t\t\treturn dfn[x]<dfn[y];\n\t\t\t});\n\t\t\tq[dfn[p]-1+n].emplace_back(dfn[p]+siz[p],i);\n\t\t}\n\t}\n\tb=basis();\n\tfor (int i=1;i<=n+n;i++) {\n\t\tb.insert(i,a[ndfn[(i-1)%n+1]]);\n\t\tfor (auto [l,id]:q[i]) {\n\t\t\tans[id]=b.query(l);\n\t\t}\n\t}\n\tfor (int i=1;i<=Q;i++) {\n\t\tcout<<ans[i]<<\"\\n\";\n\t}\n}\n\nsigned main() {\n\tios::sync_with_stdio(false),cin.tie(0);\n\tcout.precision(10),cout.setf(ios::fixed);\n\t\n\tint T;\n\tcin>>T;\n\twhile (T--) {\n\t\twork();\n\t}\n\t\n\treturn 0;\n}\n```",
        "postTime": 1676877740,
        "uid": 61120,
        "name": "QwQcOrZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1778E \u3010The Tree Has Fallen!\u3011"
    },
    {
        "content": "\u4f7f\u7528\u7ebf\u6027\u57fa\u53ca\u5176\u53ef\u5408\u5e76\u6027\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u3002\n\n\u8003\u8651\u7ecf\u5178\u7684\u6362\u6839\u5b50\u6811\u64cd\u4f5c\uff1a\n\n\u9996\u5148\u7528\u4efb\u610f\u6839\uff08\u9ed8\u8ba4\u4e3a $1$\uff09\u6c42\u51fa\u5b50\u6811\u7ebf\u6027\u57fa\u3002\n\n- \u82e5 $r=v$\uff0c\u5219\u4e3a\u5168\u5c40\u67e5\u8be2\u3002\n- \u82e5 $r$ \u5728 $v$ \u7684\u5b50\u6811\u5185\uff0c\u4ee4 $t$ \u4e3a $1-r$ \u8def\u5f84\u4e0a $v$ \u7684\u513f\u5b50\uff0c\u5219\u4e3a\u67e5\u8be2 $v$ \u7684\u5b50\u6811\u9664\u53bb $t$ \u5b50\u6811\u7684\u7b54\u6848\u3002\n- \u5176\u4f59\u60c5\u51b5\uff0c\u5219\u4e3a\u548c $1$ \u4e3a\u6839\u76f8\u540c\u3002\n\n\u5176\u4e2d $1,3$ \u60c5\u51b5\u4f7f\u7528 $1$ \u4e3a\u6839\u5b50\u6811\u7ebf\u6027\u57fa\u5373\u53ef\uff0c$2$ \u60c5\u51b5\u53ef\u4f7f\u7528\u500d\u589e\u67e5\u8be2 $t$\uff0c\u7ef4\u62a4 dfn \u7684\u524d\u540e\u7f00\u7ebf\u6027\u57fa\u8fdb\u884c\u6c42\u89e3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)\\log^2A)$\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n\n#define N 200010\n\nstruct Base\n{\n\tint p[32];\n\tvoid ins(int x)\n\t{\n\t\tfor(int i = 30;~i;i--)\n\t\t{\n\t\t\tif(x & (1 << i))\n\t\t\t{\n\t\t\t\tif(!p[i])\n\t\t\t\t{\n\t\t\t\t\tp[i] = x;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tx ^= p[i];\n\t\t\t}\n\t\t}\n\t}\n\tvoid operator = (const Base &B)\n\t{\n\t\tfor(int i = 30;~i;i--)\n\t\t\tp[i] = B.p[i];\n\t}\n\tvoid operator += (const Base &B)\n\t{\n\t\tfor(int i = 30;~i;i--)\n\t\t\tins(B.p[i]);\n\t}\n\tint query_max()\n\t{\n\t\tint res = 0;\n\t\tfor(int i = 30;~i;i--)\n\t\t{\n\t\t\tif((res ^ p[i]) > res)\n\t\t\t\tres ^= p[i];\n\t\t}\n\t\treturn res;\n\t}\n\tvoid clear()\n\t{\n\t\tfor(int i = 30;~i;i--)\n\t\t\tp[i] = 0;\n\t}\n};\n\nint h[N],e[N << 1],ne[N << 1],idx;\nvoid add_edge(int x,int y)\n{\n\tne[++idx] = h[x];\n\th[x] = idx;\n\te[idx] = y;\n}\nvoid add(int x,int y)\n{\n\tadd_edge(x,y);\n\tadd_edge(y,x);\n}\nBase pre[N],suc[N];\nint dfn[N],fdfn[N],dfncnt;\nBase sum[N];\nint a[N],sz[N];\n\nint kfa[N][25];\n\nvoid dfs(int k,int fa)\n{\n\tdfn[k] = ++dfncnt;\n\tkfa[k][0] = fa;\n\tfor(int i = 1;i <= 20;i++)\n\t\tkfa[k][i] = kfa[kfa[k][i - 1]][i - 1];\n\tsz[k] = 1;\n\tfdfn[dfncnt] = k;\n\tsum[k].ins(a[k]);\n\tfor(int i = h[k];~i;i = ne[i])\n\t{\n\t\tint nx = e[i];\n\t\tif(nx == fa)\n\t\t\tcontinue;\n\t\tdfs(nx,k);\n\t\tsum[k] += sum[nx];\n\t\tsz[k] += sz[nx];\n\t}\n}\n\nint T;\nint n,m;\n\nint main()\n{\n\tmemset(h,-1,sizeof(h));\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i = 1;i <= n;i++)\n\t\t\tscanf(\"%d\",&a[i]);\n\t\tfor(int i = 1,x,y;i < n;i++)\n\t\t{\n\t\t\tscanf(\"%d%d\",&x,&y);\n\t\t\tadd(x,y);\n\t\t}\n\t\tdfs(1,1);\n\t\tpre[0].clear();\n\t\tfor(int i = 1;i <= n;i++)\n\t\t{\n\t\t\tpre[i].ins(a[fdfn[i]]);\n\t\t\tpre[i] += pre[i - 1];\n\t\t}\n\t\tsuc[n + 1].clear();\n\t\tfor(int i = n;i >= 1;i--)\n\t\t{\n\t\t\tsuc[i].ins(a[fdfn[i]]);\n\t\t\tsuc[i] += suc[i + 1];\n\t\t}\n\t\tscanf(\"%d\",&m);\n\t\tBase now;\n\t\tfor(int i = 1,r,v;i <= m;i++)\n\t\t{\n\t\t\tscanf(\"%d%d\",&r,&v);\n\t\t\tnow.clear();\n\t\t\tif(r == v)\n\t\t\t\tnow = pre[n];\n\t\t\telse if(dfn[v] <= dfn[r] && dfn[r] <= dfn[v] + sz[v] - 1)\n\t\t\t{\n\t\t\t\tint t = r;\n\t\t\t\tfor(int i = 20;~i;i--)\n\t\t\t\t{\n\t\t\t\t\tint f = kfa[t][i];\n\t\t\t\t\tif(dfn[v] <= dfn[f] && dfn[f] <= dfn[v] + sz[v] && v != f)\n\t\t\t\t\t\tt = f;\n\t\t\t\t}\n\t\t\t\tint L = dfn[t];\n\t\t\t\tint R = dfn[t] + sz[t] - 1;\n\t\t\t\tnow = pre[L - 1];\n\t\t\t\tnow += suc[R + 1];\n\t\t\t\tnow.ins(a[v]);\n\t\t\t}\n\t\t\telse\n\t\t\t\tnow = sum[v];\n\t\t\tprintf(\"%d\\n\",now.query_max());\n\t\t}\n\t\tfor(int i = 1;i <= n;i++)\n\t\t{\n\t\t\th[i] = -1;\n\t\t\tpre[i].clear();\n\t\t\tsuc[i].clear();\n\t\t\tsum[i].clear();\n\t\t\tdfn[i] = fdfn[i] = 0;\n\t\t\tsz[i] = 0;\n\t\t}\n\t\tfor(int i = 1;i <= idx;i++)\n\t\t\tne[i] = 0;\n\t\tidx = dfncnt = 0;\n\t}\t\n\treturn 0;\n}\n```",
        "postTime": 1675506361,
        "uid": 371968,
        "name": "ningago",
        "ccfLevel": 4,
        "title": "CF1778E"
    },
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u65e0\u6839\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u6709\u70b9\u6743\uff0c$q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u4ee5 $r$ \u4e3a\u6839\uff0c$v$ \u7684\u5b50\u6811\u4e2d\u4efb\u9009\u82e5\u5e72\u4e2a\u70b9\u70b9\u6743\u5f02\u6216\u548c\u6700\u5927\u503c\u3002\n\n## \u9898\u89e3\n\n\u9996\u5148\u4ee5 $1$ \u4e3a\u6839\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u6c42\u51fa\u5b83\u7684\u5b50\u6811\u7684\u7ebf\u6027\u57fa\u3002\u7136\u540e\u6c42\u51fa dfn \u5e8f\uff0c\u4ee5\u53ca dfn \u5e8f\u7684\u524d\u540e\u7f00\u7ebf\u6027\u57fa\u3002\n\n\u5047\u8bbe\u8fd9\u6b21\u8be2\u95ee $v$ \u7684\u5b50\u6811\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684 $r$\uff0c\u7b54\u6848\u53ea\u53ef\u80fd\u6709\u4e09\u79cd\u60c5\u51b5\uff1a\n\n- $r=v$\uff0c\u6b64\u65f6\u7b54\u6848\u5c31\u662f\u6574\u68f5\u6811\u7684\u7b54\u6848\u3002\n- $r$ \u4e0d\u5728 $v$ \u7684\u5b50\u6811\u4e2d\uff0c\u6b64\u65f6\u4ee5 $r$ \u4e3a\u6839\u548c\u4ee5 $1$ \u4e3a\u6839 $v$ \u7684\u5b50\u6811\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u7b54\u6848\u5c31\u662f $v$ \u5b50\u6811\u7684\u7b54\u6848\u3002\n- $r$ \u5728 $v$ \u7684\u5b50\u6811\u4e2d\u4e14\u4e0d\u4e3a $v$\uff0c\u8fd9\u65f6 $v$ \u7684\u5b50\u6811\u5c31\u4f1a\u53d8\u4e86\u3002\u5177\u4f53\u5730\uff0c\u6211\u4eec\u8ba9 $r$ \u5f80\u4e0a\u8df3\uff0c\u8df3 $dep_r-dep_v$ \u6b21\u4f1a\u8df3\u5230 $v$\uff0c\u90a3\u4e48\u8df3 $dep_r-dep_v-1$ \u6b21\u5230\u7684\u8282\u70b9\u5c31\u662f $v$ \u7684\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u73b0\u5728 $v$ \u7684\u5b50\u6811\u5c31\u662f\u6574\u68f5\u6811**\u9664\u4e86\u8fd9\u4e2a\u5b50\u8282\u70b9\u7684\u5b50\u6811**\u7684\u90e8\u5206\u3002\u5b66\u8fc7\u6811\u5256\u7684\u90fd\u77e5\u9053\uff0c\u4e00\u4e2a\u8282\u70b9\u7684\u5b50\u6811\u5bf9\u5e94 dfn \u5e8f\u7684\u4e00\u4e2a\u8fde\u7eed\u6bb5\uff0c\u90a3\u4e48\u9664\u6389\u8fd9\u4e2a\u5b50\u6811\u7684\u5176\u4ed6\u90e8\u5206\u5c31\u5bf9\u5e94\u4e00\u6bb5\u524d\u7f00\u52a0\u4e0a\u4e00\u6bb5\u540e\u7f00\u3002\u7b54\u6848\u5c31\u662f\u5bf9\u5e94\u7684\u524d\u7f00\u7ebf\u6027\u57fa\u548c\u540e\u7f00\u7ebf\u6027\u57fa\u5408\u5e76\u540e\u7684\u7b54\u6848\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2a_i)$\n\n```cpp\n/*\n    name: The Tree Has Fallen!\n    id:   CF1778E\n    date: 2023/02/01\n*/\n\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 2e5 + 10;\nint t, n, q, a[N], fat[N][20], dep[N], dfn[N], siz[N], fdfn[N], cnt;\nvector<int> g[N];\n\nstruct LinearBasis{\n\tint p[32];\n\tvoid ins(int k){\n\t\tfor(int i = 31; i >= 0; -- i){\n\t\t\tif(!(k&(1<<i))) continue;\n\t\t\tif(!p[i]) return p[i] = k, void();\n\t\t\tk ^= p[i];\n\t\t}\n\t\treturn; \n\t}\n\tvoid ins(LinearBasis x){\n\t\tfor(int i = 31; i >= 0; -- i)\n\t\t\tins(x.p[i]);\n\t}\n\tint getmx(){\n\t\tint ans = 0;\n\t\tfor(int i = 31; i >= 0; -- i) ans = max(ans, ans^p[i]);\n\t\treturn ans;\n\t}\n} s[N], pre[N], suf[N], ans;\n\nvoid clear(){\n\tfor(int i = 0; i <= n + 1; ++ i){\n\t\tg[i].clear();\n\t\tdep[i] = siz[i] = dfn[i] = fdfn[i] = 0;\n\t\tfor(int j = 0; j < 20; ++ j){\n\t\t\tfat[i][j] = 0;\n\t\t}\n\t\tmemset(s[i].p, 0, sizeof(s[i].p));\n\t\tmemset(pre[i].p, 0, sizeof(pre[i].p));\n\t\tmemset(suf[i].p, 0, sizeof(suf[i].p));\n\t}\n\tcnt = 0;\n}\n\nvoid dfs(int x, int fa){\n\tdep[x] = dep[fa] + 1;\n\tdfn[x] = ++ cnt;\n\tsiz[x] = 1;\n\ts[x].ins(a[x]);\n\tfdfn[cnt] = x;\n\tfat[x][0] = fa;\n\tfor(int i = 1; i < 20; ++ i){\n\t\tfat[x][i] = fat[fat[x][i-1]][i-1];\n\t}\n\tfor(int i : g[x]){\n\t\tif(i == fa){\n\t\t\tcontinue;\n\t\t}\n\t\tdfs(i, x);\n\t\tsiz[x] += siz[i];\n\t\ts[x].ins(s[i]);\n\t}\n}\n\nint jump(int x, int k){\n\tfor(int i = 19; i >= 0; -- i){\n\t\tif((k >> i) & 1){\n\t\t\tx = fat[x][i];\n\t\t}\n\t}\n\treturn x;\n}\n\nint main(){\n\tscanf(\"%d\", &t);\n\twhile(t--){\n\t\tscanf(\"%d\", &n);\n\t\tfor(int i = 1; i <= n; ++ i){\n\t\t\tscanf(\"%d\", &a[i]);\n\t\t}\n\t\tfor(int i = 1; i < n; ++ i){\n\t\t\tint u, v;\n\t\t\tscanf(\"%d%d\", &u, &v);\n\t\t\tg[u].push_back(v);\n\t\t\tg[v].push_back(u);\n\t\t}\n\t\tdfs(1, 0);\n\t\tmemset(pre[0].p, 0, sizeof(pre[0].p));\n\t\tmemset(suf[n+1].p, 0, sizeof(suf[n+1].p));\n\t\tfor(int i = 1; i <= n; ++ i){\n\t\t\tpre[i].ins(a[fdfn[i]]);\n\t\t\tpre[i].ins(pre[i-1]);\n\t\t}\n\t\tfor(int i = n; i >= 1; -- i){\n\t\t\tsuf[i].ins(a[fdfn[i]]);\n\t\t\tsuf[i].ins(suf[i+1]);\n\t\t}\n\t\tscanf(\"%d\", &q);\n\t\twhile(q--){\n\t\t\tint r, v;\n\t\t\tscanf(\"%d%d\", &r, &v);\n\t\t\tif(r == v){\n\t\t\t\tprintf(\"%d\\n\", pre[n].getmx());\n\t\t\t} else if(dep[r] <= dep[v] || jump(r, dep[r]-dep[v]) != v){\n\t\t\t\tprintf(\"%d\\n\", s[v].getmx());\n\t\t\t} else {\n\t\t\t\tmemset(ans.p, 0, sizeof(ans.p));\n\t\t\t\tint k = jump(r, dep[r]-dep[v]-1);\n\t\t\t\tans.ins(pre[dfn[k]-1]);\n\t\t\t\tans.ins(suf[dfn[k]+siz[k]]);\n\t\t\t\tprintf(\"%d\\n\", ans.getmx());\n\t\t\t}\n\t\t}\n\t\tclear();\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1631802961,
        "uid": 390770,
        "name": "AiRC0S",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1778E The Tree Has Fallen!"
    },
    {
        "content": "\u4ece\u4e00\u5806\u6570\u91cc\u9762\u9009\u4efb\u610f\u4e2a\u6570\u4f7f\u5f97\u5b83\u4eec\u7684\u5f02\u6216\u548c\u6700\u5927\uff0c\u8fd9\u662f**\u7ebf\u6027\u57fa**\u677f\u5b50\u3002\n\n\u8003\u8651\u6ca1\u6709\u6362\u6839\u64cd\u4f5c\u7684\u5f71\u54cd\uff0c\u6211\u4eec\u5c06 $v$ \u7684\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u7684\u70b9\u6743\u63d2\u5165 $l_v$ \u7684\u7ebf\u6027\u57fa\u4e2d\u3002\u7b54\u6848\u663e\u7136\u662f $l_v$ \u7684\u8d2a\u5fc3\u3002\u6c42\u51fa\u6700\u5f00\u59cb $l_i$ \u53ef\u4ee5\u901a\u8fc7\u8be5\u8282\u70b9\u4e0e\u5b50\u7ed3\u70b9\u7ebf\u6027\u57fa\u5408\u5e76\u6765\u6c42\u3002\n\n\u73b0\u5728\u8003\u8651\u6362\u6839\u7684\u5f71\u54cd\uff0c\u624b\u6a21\u4e00\u4e0b\u5bb9\u6613\u53d1\u73b0\uff1a\n\n$r=v$ \u65f6\u6216 $v$ **\u4e0d\u5728**\u539f\u6811 $1\\rightarrow r$ \u4e0a\u7684\u8def\u5f84\u65f6\uff0c\u5bb9\u6613\u53d1\u73b0 $v$ \u7684\u5b50\u6811\u7684\u7ed3\u70b9\u4e0d\u53d8\uff0c\u7b54\u6848\u4ecd\u662f $l_v$ \u7684\u8d2a\u5fc3\u3002\n\n\u8003\u8651 $r\\ne v$ \u4e14 $v$ **\u5728**\u539f\u6811 $1\\rightarrow r$ \u4e0a\u7684\u8def\u5f84\u7684\u60c5\u51b5\u3002\n\n\u627e\u70b9 $u$ \u662f $v$ \u7684\u5176\u4e2d\u4e00\u4e2a\u5b50\u7ed3\u70b9\u4e14 $u$ **\u5728**\u539f\u6811 $1\\rightarrow r$ \u4e0a\u7684\u8def\u5f84\u4e0a\u3002\u5bb9\u6613\u53d1\u73b0\uff0c$v$ \u7684\u5b50\u6811\u7684\u7ed3\u70b9\u662f\u5168\u6811\u5185\u8282\u70b9**\u9664\u53bb** $u$ \u7684\u5b50\u6811\u7684\u8282\u70b9\u3002\u627e $u$ \u8fd9\u4e00\u6b65\u7528\u6811\u4e0a\u500d\u589e\u53ef\u4ee5\u505a\u5230 $O(\\log n)$ \u7684\u590d\u6742\u5ea6\u3002\n\n\u8fd9\u4e2a\u600e\u4e48\u505a\u5230\u5462\uff1f\u6ce8\u610f\u5230\u5b50\u6811\u5185\u7684 dfs \u5e8f\u662f\u8fde\u7eed\u7684\u3002\u4ee4\u70b9 $i$ \u7684 dfs \u5e8f\u662f $d_i$\uff0c$i$ \u7684\u5b50\u6811\u7684\u5927\u5c0f\u662f $s_i$\u3002\u90a3\u4e48 $u$ \u7684\u5b50\u6811\u7684\u8282\u70b9\u7684 dfs \u5e8f\u662f $[d_u,s_u+d_u-1]$\u3002\n\n\u4e0d\u7b97\u8fd9\u4e00\u6bb5\u533a\u95f4\u7684\u8bdd\uff0c\u53ef\u4ee5\u6c42 dfs \u5e8f\u4e3a $[1,d_u-1]\\cup[s_u+d_u,n]$ \u7684\u4fe1\u606f\u3002\u8003\u8651\u5230\u591a\u7ec4\u8be2\u95ee\uff0c\u9884\u5904\u7406\u8fd9\u4e2a\u524d\u7f00\u548c\u540e\u7f00\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n\\log \\max a_i)$\u3002\n\n\u53cb\u60c5\u63d0\u793a\uff0c\u6ce8\u610f\u6e05\u7a7a\u6811\u4e0a\u500d\u589e\u7684\u4fe1\u606f\u3002\u6211\u56e0\u4e3a\u8fd9\u73a9\u610f WA \u4e86 $17$ \u53d1\u3002\n```cpp\nconst int maxn=309309;\nvector<int>g[maxn];\nnamespace linear_basis{\n\tstruct lmx{\n\t\tint p[32];\n\t\tvoid insert(int x){ dF(i,30,0) if(x&(1<<i)){ if(!p[i]) return p[i]=x,void();x^=p[i];}}\n\t\tint query(){ int rt=0; dF(i,30,0) rt=max(rt,rt^p[i]); return rt;}\n\t\tvoid clear(){ memset(p,0,sizeof(p)); }\n\t\tvoid output(){ F(i,0,30) printf(\"%d \",p[i]); HH;}\n\t}l[maxn],p[maxn],s[maxn];\n\tlmx operator+(lmx a,lmx b){\n\t\tlmx fqd=a;\n\t\tdF(i,30,0) if(b.p[i]) fqd.insert(b.p[i]);\n\t\treturn fqd;\n\t}\n};\nusing namespace linear_basis;\nint f[maxn][20],a[maxn],d[maxn],lg[maxn],n,tim,sz[maxn],dfn[maxn],rev[maxn];\nvoid dfs(int u,int fa){\n\tl[u].insert(a[u]);\n\td[u]=d[fa]+1;\n\tdfn[u]=++tim;\n\trev[tim]=u;\n\tsz[u]=1;\n\tf[u][0]=fa;\n\tfor(int i=1;(1<<i)<=d[u];i++) f[u][i]=f[f[u][i-1]][i-1];\n\tfor(int v:g[u]) \n\t\tif(v!=fa){\n\t\t\tdfs(v,u);\n\t\t\tl[u]=l[u]+l[v];\n\t\t\tsz[u]+=sz[v];\n\t\t}\n}\nint lca(int x,int y) {\n    if(d[x]<d[y])swap(x,y);\n    dF(i,lg[d[x]],0) if(d[f[x][i]]>=d[y]) x=f[x][i];\n    if(x==y) return x;\n    dF(i,lg[d[x]],0) if(f[x][i]^f[y][i]) x=f[x][i],y=f[y][i];\n    return f[x][0];\n}\nbool fl=0;\nvoid solve(int u,int v){\n\tif(u==v) return printf(\"%d\\n\",l[1].query()),void();\n\tif(lca(u,v)==v){\n\t\tdF(i,lg[n],0) if(dfn[f[u][i]]>=dfn[v]&&dfn[f[u][i]]<=dfn[v]+sz[v]&&f[u][i]^v) u=f[u][i];\n\t\tlmx ans; ans.clear();\n\t\tans=ans+p[dfn[u]-1];\n\t\tans=ans+s[dfn[u]+sz[u]];\n\t\tans.insert(a[v]);\n\t\treturn printf(\"%d\\n\",ans.query()),void();\n\t}\n\telse return printf(\"%d\\n\",l[v].query()),void();\n}\nvoid Solve(){\n\tn=read();\n\ttim=0;\n\tF(i,1,n) a[i]=read(),g[i].clear(),l[i].clear(),p[i].clear(),s[i].clear(),sz[i]=0;\n\tF(i,1,n) F(j,0,19) f[i][j]=0;\n\tF(i,1,n-1){\n\t\tint u=read(),v=read();\n\t\tg[u].pb(v);\n\t\tg[v].pb(u);\n\t}\n\tdfs(1,1);\n\tp[0].clear();\n\ts[n+1].clear();\n\tF(i,1,n){\n\t\tp[i].insert(a[rev[i]]);\n\t\tp[i]=p[i-1]+p[i];\n\t}\n\tdF(i,n,1){\n\t\ts[i].insert(a[rev[i]]);\n\t\ts[i]=s[i+1]+s[i];\n\t}\n\tint t=read();\n\twhile(t--){\n\t\tint u=read(),v=read();\n\t\tsolve(u,v);\n\t}\n}\n```\n",
        "postTime": 1683466399,
        "uid": 605313,
        "name": "Nullptr_qwq",
        "ccfLevel": 0,
        "title": "CF1778E Solution"
    },
    {
        "content": "\u6765\u4e00\u4e2a\u6700\u66b4\u529b\u7684\u7ebf\u6027\u57fa\u9898\u89e3\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u6362\u6839\uff0c\u6211\u4eec\u5bf9\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4\u5176\u5b50\u6811\u5185\u7684\u7ebf\u6027\u57fa\u5373\u53ef\u3002\u5bf9\u7b2c $i$ \u4e2a\u8282\u70b9\uff0c\u6211\u4eec\u4e0d\u59a8\u8bb0\u8fd9\u4e2a\u7ebf\u6027\u57fa\u4e3a $a_i$\u3002\n\n\u7136\u540e\u8003\u8651\u6362\u6839\u3002\u5047\u8bbe\u6211\u4eec\u4ee5 $1$ \u4e3a\u6839\uff0c\u8fd9\u4e2a\u65f6\u5019\u6362\u6839\u5230\u4e86 $z$\u3002\u6211\u4eec\u70b9 $x$ \u7684\u5b50\u6811\u53d8\u5316\uff1a\n\n1. $x$ \u5728\u4ee5 $1$ \u4e3a\u6839\u610f\u4e49\u4e0b\uff0c$z$ \u5b50\u6811\u5185\uff1a\u663e\u7136 $x$ \u7684\u5b50\u6811\u8fd8\u662f\u539f\u6765\u7684\u5b50\u6811\uff0c\u7b54\u6848\u4e0d\u53d8\u3002\n\n2. $x$ \u5728\u4ee5 $1$ \u4e3a\u6839\u610f\u4e49\u4e0b $z$ \u5b50\u6811\u5916\uff0c\u4e14\u4e0d\u662f $z$ \u7684\u7956\u5148\uff1a\u8fd9\u4e2a\u65f6\u5019 $x$ \u5411\u4e0a\u8d70\u5230 $z$ \u7684\u8def\u5f84\u5c31\u662f $x \\rightarrow \\text{LCA}(x,z) \\rightarrow z$\uff0c\u90a3\u4e48 $x$ \u7684\u5b50\u6811\u8fd8\u662f\u539f\u6765\u7684\u5b50\u6811\uff0c\u7b54\u6848\u4e0d\u53d8\u3002\n\n3. $x$ \u5728\u4ee5 $1$ \u4e3a\u6839\u610f\u4e49\u4e0b\uff0c\u662f $z$ \u7684\u7956\u5148\uff1a\n\n\t![](https://cdn.luogu.com.cn/upload/image_hosting/b2klslb6.png)\n    \n\t\u5bb9\u6613\u770b\u51fa\u8fd9\u4e2a\u5c31\u662f\u6574\u4e2a\u6811\uff0c\u6316\u6389 $z$ \u5230 $x$ \u8def\u5f84\u4e0a\u6700\u540e\u4e00\u4e2a\u70b9 $y$ \u7684\u5b50\u6811\u4e4b\u540e\uff0c\u7ec4\u6210\u7684\u7ebf\u6027\u57fa\u7684\u7b54\u6848\u3002\u6211\u4eec\u4e0d\u59a8\u5bf9\u70b9 $y$ \u628a\u8fd9\u4e2a\u7b54\u6848\u8bb0\u4e3a $b_y$\u3002\n    \n4. $x=z$\uff1a\u6574\u4e2a\u6811\u7ec4\u6210\u7684\u7ebf\u6027\u57fa\u53d6\u6700\u5927\uff0c\u5c31\u662f\u7b54\u6848\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5206\u522b\u7ef4\u62a4 $a_i$ \u548c $b_i$\u3002\u4ee5\u4e0b\u4ee4 $\\oplus$ \u7b26\u53f7\u8868\u793a\u7ebf\u6027\u57fa\u7684\u5408\u5e76\u8fd0\u7b97\uff0c$\\bigoplus$ \u8868\u793a\u8fde\u7eed\u5408\u5e76\u8fd0\u7b97\uff1a\n\n$a_i$ \u5f88\u7b80\u5355\uff0c\u4e0d\u96be\u53d1\u73b0\u6709\u8fd9\u4e2a\u9012\u63a8\u5f0f\u5b50\uff1a\n\n$$a_i=w_i \\oplus \\bigoplus\\limits_{v \\in son_i} a_v$$\n\n$b_i$ \u7565\u5fae\u590d\u6742\uff0c\u4f46\u6211\u4eec\u8fd8\u662f\u4e0d\u96be\u63a8\u51fa\u9012\u63a8\u5f0f\u5b50\uff1a\n\n$$b_v=b_{i} \\oplus \\bigoplus_{x \\in son_i \\text{\u5e76\u4e14} x \\neq v}a_{x}$$\n\n$a_i$ \u76f4\u63a5\u7ef4\u62a4\u5373\u53ef\uff0c$b_i$ \u540e\u9762\u90a3\u5757\u53ef\u4ee5\u76f4\u63a5\u62c6\u6210\u524d\u7f00\u7ebf\u6027\u57fa\u548c\u540e\u7f00\u7ebf\u6027\u57fa\u3002\u7136\u540e\u6bcf\u6b21\u5bf9\u8f93\u5165\u7684 $x,y$\uff0c\u500d\u589e\u7684\u5224\u65ad\u7956\u5148\u5173\u7cfb\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n \\log^2 W)$\uff0c$W$ \u4e3a\u503c\u57df\u3002\n\n\u6709\u70b9\u5c0f\u5361\u5e38\uff0c\u5efa\u8bae\u4ea4 C++20\u3002\u4e0d\u4fdd\u8bc1\u6bcf\u6b21\u90fd\u8fc7\uff0c\u4f46\u662f\u4e00\u5b9a\u53ef\u4ee5\u8fc7\u3002\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\n#define _cst const\n#define _IfD long long\n#define _siz 20\nchar buf[1<<_siz],buffer[1<<_siz],*p1=buf,*p2=buf,c=' ';\nint op1=-1; _cst int op2=(1<<_siz)-1;\ninline char gc(){return (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<_siz,stdin)),p1==p2?EOF:*p1++);}\ninline void flush(){fwrite(buffer,1,op1+1,stdout),op1=-1;}\ninline void pc(_cst char &x){if(op1==op2)flush();buffer[++op1]=x;}\ntemplate<typename T>void read(T &w){\n\tw=0;bool f=1;char ch=gc();\n\tfor(;ch<=32;ch=gc()); if(ch=='-')f=0;\n\tfor(;'0'<=ch && ch<='9';ch=gc()) w=(w<<1)+(w<<3)+(ch^48);\n\tw=f?w:-w;\n}template<typename T,typename ...Arg>void read(T &w,Arg &...arg){\n\tread(w); read(arg...);\n}template<typename T>void wrt(T x){\n  \tif(x<0) pc('-'),x=-x;\n\tif(x>9) wrt(x/10);\n\tpc(x%10|48);\n}template<typename T>void write(T x){\n\twrt(x); pc(c);\n}template<typename T,typename ...Arg>void write(T x,Arg ...arg){\n\twrite(x); write(arg...);\n}inline _IfD pow_10(_IfD x){\n    _IfD base=10,ans=1;\n    while(x) ans*=((x&1)?base:1),base*=base,x>>=1;\n    return ans;\n}template<typename T>void readd(T &w){\n    w=0; _IfD x=0,cnt=0; bool f=1; char ch=gc();\n    for(;ch<=32;ch=gc()); if(ch=='-')f=0;\n    for(;'0'<=ch && ch<='9';ch=gc()) x=(x<<1)+(x<<3)+(ch^48);\n    w=(T)(f?x:-x);\n    if(ch!='.') return; x=0,ch=gc();\n    for(;'0'<=ch && ch<='9';ch=gc(),++cnt) x=(x<<1)+(x<<3)+(ch^48);\n    T tmp=(T)(x/(T)pow_10(cnt));\n    w=w+(T)(f?tmp:-tmp);\n}template<typename T,typename ...Arg>void readd(T &w,Arg &...arg){\n\treadd(w); readd(arg...);\n}\ntemplate<typename T>inline T qmax(_cst T &a,_cst T &b){return a>b?a:b;}\ntemplate<typename T,typename ...Arg>inline T qmax(_cst T &a,_cst T &b,_cst Arg &...arg){return qmax(a,qmax(b,arg...));}\ntemplate<typename T>inline T qmin(_cst T &a,_cst T &b){return a<b?a:b;}\ntemplate<typename T,typename ...Arg>inline T qmin(_cst T &a,_cst T &b,_cst Arg &...arg){return qmin(a,qmin(b,arg...));}\ntemplate<typename T>inline void qswap(T &a,T &b){a+=b,b=a-b,a-=b;}\n\nusing namespace std;\n\n#define int long long\n\nconst int MAXN=200005,N=31;\n\nstruct Basis{\n\tint h[N];\n\tBasis(){memset(h,0,sizeof(h));}\n\tvoid clear(){memset(h,0,sizeof(h));}\n\tvoid insert(int x){\n\t\tfor(int j=N-1;j>=0;j--){\n\t\t\tif((x>>j)&1) \n\t\t\t\tif(!h[j]){h[j]=x; break;}\n\t\t\t\telse x^=h[j];\n\t\t}\n\t}\n\tint qry(){\n\t\tint ans=0;\n\t\tfor(int j=N-1;j>=0;j--)\n\t\t\tif((ans^h[j])>ans) ans^=h[j];\n\t\treturn ans;\n\t}\n}a[MAXN],b[MAXN];\nint w[MAXN];\nvector<Basis> pre[MAXN],suf[MAXN];\nvector<int> E[MAXN];\nconst Basis operator + (const Basis &x,const Basis &y){\n\tBasis z;\n\tfor(int j=N-1;j>=0;j--) z.insert(x.h[j]);\n\tfor(int j=N-1;j>=0;j--) z.insert(y.h[j]);\n\treturn z;\n}\n\nint f[MAXN][20],dep[MAXN];\n\nvoid dfs(int u,int fa){\n\tf[u][0]=fa; dep[u]=dep[fa]+1;\n\tint p=-1; a[u].insert(w[u]);\n\tfor(int i=0;i<E[u].size();i++){\n\t\tint v=E[u][i];\n\t\tif(v==fa){p=i;continue;}\n\t\tdfs(v,u);\n\t\ta[u]=a[u]+a[v];\n\t}\n\tif(p!=-1) swap(E[u][p],E[u][0]);\n\telse E[u].insert(E[u].begin(),0);\n}\nvoid dfs1(int u,int fa){\n\tpre[u].resize(E[u].size()+1);\n\tsuf[u].resize(E[u].size()+1);\n\tsuf[u][E[u].size()].clear();\n\tfor(int i=1;i<E[u].size();i++){\n\t\tint v=E[u][i];\n\t\tpre[u][i]=pre[u][i-1]+a[v];\n\t}\n\tfor(int i=E[u].size()-1;i>0;i--){\n\t\tint v=E[u][i];\n\t\tsuf[u][i]=suf[u][i+1]+a[v];\n\t}\n\tfor(int i=1;i<E[u].size();i++){\n\t\tint v=E[u][i];\n\t\tb[v]=b[u]+pre[u][i-1]+suf[u][i+1];\n\t\tb[v].insert(w[u]);\n\t\tdfs1(v,u);\n\t}\n}\nint check(int u,int v){\n\tif(dep[v]>dep[u]) return 0;\n\tint tmp=dep[u]-dep[v],U=u;\n\tfor(int j=0;j<20;j++) if(tmp>>j&1) u=f[u][j];\n\tif(u!=v) return 0; tmp--; u=U;\n\tfor(int j=0;j<20;j++) if(tmp>>j&1) u=f[u][j];\n\treturn u;\n}\n\nvoid solve(){\n\tint n; read(n);\n\tfor(int i=1;i<=n;i++) a[i].clear(),b[i].clear(),E[i].clear(),pre[i].resize(0),suf[i].resize(0);\n\tfor(int i=1;i<=n;i++) read(w[i]);\n\tfor(int i=1;i<n;i++){\n\t\tint u,v; read(u,v);\n\t\tE[u].push_back(v);\n\t\tE[v].push_back(u);\n\t}\n\tdfs(1,0); dfs1(1,0);\n\tfor(int j=1;j<20;j++) for(int i=1;i<=n;i++) f[i][j]=f[f[i][j-1]][j-1];\n\tint q; read(q);\n\twhile(q--){\n\t\tint x,y; read(x,y);\n\t\tif(x==y){\n\t\t\twrt(a[1].qry()),pc(10);\n\t\t}else{\n\t\t\tint tmp=check(x,y); \n\t//\t\tcout<<x<<' '<<y<<' '<<tmp<<'\\n';\n\t\t\tif(!tmp) wrt(a[y].qry()),pc(10);\n\t\t\telse wrt(b[tmp].qry()),pc(10);\n\t\t}\n\t}\n}\n\nsigned main(){\n\tint T; read(T);\n\twhile(T--) solve();\n\treturn flush(),0;\n}\n```",
        "postTime": 1678607454,
        "uid": 195198,
        "name": "E1_de5truct0r",
        "ccfLevel": 7,
        "title": "CF1778E"
    },
    {
        "content": "\u4e0d\u7528\u90a3\u4e48\u9ebb\u70e6\u7684\u5206\u8ba8\uff0c\u76f4\u63a5\u6362\u6839\u662f\u53ef\u4ee5\u505a\u7684\u3002\n\n\u9996\u5148\u9009\u6570\u5f02\u6216\u548c\u6700\u5927\u662f\u663e\u7136\u53ef\u4ee5\u7ebf\u6027\u57fa\uff0c\u6211\u4eec\u7684\u4efb\u52a1\u5c31\u662f\u8003\u8651\u7ef4\u62a4\u5b50\u6811\u7ebf\u6027\u57fa\u3002\n\n\u628a\u8be2\u95ee\u79bb\u7ebf\uff0c\u5148 dfs \u4e00\u904d\u6c42\u51fa\u5b50\u6811\u7ebf\u6027\u57fa\uff0c\u518d dfs \u4e00\u904d\u6c42\u4ee5\u6bcf\u4e2a\u70b9\u4e3a\u6839\u7684\u7b54\u6848\u3002\u7b2c\u4e8c\u904d dfs \u7ef4\u62a4\u5b50\u6811\u7ebf\u6027\u57fa\u7684\u65b9\u6cd5\u548c\u6362\u6839 dp \u7c7b\u4f3c\u3002\u5047\u8bbe\u8981\u628a\u6839 $r$ \u7684\u513f\u5b50 $v$ \u6362\u5230\u6839\u4e0a\uff0c\u5c31 swap \u4e00\u4e0b $r,v$ \u7684\u7ebf\u6027\u57fa\uff0c\u518d\u6c42\u51fa $r$ \u6ca1\u6709\u513f\u5b50 $v$ \u7684\u7ebf\u6027\u57fa\u5373\u53ef\uff0c\u8fd9\u4e2a\u9884\u5904\u7406\u4e00\u4e0b\u524d\u7f00\u548c\u540e\u7f00\u7684\u7ebf\u6027\u57fa\u53ef\u4ee5\u5f88\u65b9\u4fbf\u6c42\u51fa\u6765\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int N = 2e5 + 5;\n\ninline int read() {\n\tregister int s = 0, f = 1; register char ch = getchar();\n\twhile (!isdigit(ch)) f = (ch == '-' ? -1 : 1), ch = getchar();\n\twhile (isdigit(ch)) s = (s * 10) + (ch & 15), ch = getchar();\n\treturn s * f;\n}\n\ninline void otp(int x) {\n\t(x >= 10) ? otp(x / 10), putchar((x % 10) ^ 48) : putchar(x ^ 48);\n}\n\nvector<int> nxt[N];\n\nstruct base {\n\tvector<int> bs;\n\tinline base() { bs.resize(33, 0); for (int &i : bs) i = 0; }\n\tinline void clear() { bs.resize(33, 0); for (int &i : bs) i = 0; }\n\tinline void insert(int x) {\n\t\tfor (int i = 31; ~i; --i) {\n\t\t\tif (!((x >> i))) continue;\n\t\t\tif (!bs[i]) { bs[i] = x; break; }\n\t\t\tx ^= bs[i];\n\t\t}\n\t}\n\tinline int query() {\n\t\tint res = 0;\n\t\tfor (int i = 31; ~i; --i)\n\t\t\tif ((res ^ bs[i]) > res) res ^= bs[i];\n\t\treturn res;\n\t}\n\tinline void merge(const base &b) {\n\t\tfor (int x : b.bs) if (x) insert(x);\n\t}\n} tr[N];\n\n//inline void print(int x) {\n//\tsort(tr[x].bs.begin(), tr[x].bs.end());\n//\tcerr << \"V : \" << x << \" = \";\n//\tfor (int i : tr[x].bs) \n//\t\tif (i) cerr << i << ' ';\n//\tcerr << endl;\n//}\n\nint q[N], ans[N], val[N], T, n, m;\nvector<int> ask[N];\n\ninline void dfs(int now, int fa) {\n\ttr[now].insert(val[now]);\n\tfor (int i : nxt[now]) {\n\t\tif (i != fa) {\n\t\t\tdfs(i, now);\n\t\t\ttr[now].merge(tr[i]);\n\t\t}\n\t}\n}\n\ninline void calc(int now, int fa) {\n\tfor (int i : ask[now])\n\t\tans[i] = tr[q[i]].query();\n\tbase pre, tmp = tr[now], qwq;\n\tvector<base> suf; suf.resize(nxt[now].size());\n\tfor (int i = nxt[now].size() - 1; ~i; --i) {\n\t\tif (i == nxt[now].size() - 1) {\n\t\t\tif (nxt[now][i] != fa) suf[i] = tr[nxt[now][i]];\n\t\t} else {\n\t\t\tsuf[i] = suf[i + 1];\n\t\t\tif (nxt[now][i] != fa) suf[i].merge(tr[nxt[now][i]]);\n\t\t}\n\t} pre.insert(val[now]);\n\tif (fa) pre.merge(tr[fa]);\n\tfor (int i = 0; i < nxt[now].size(); ++i) {\n\t\tint v = nxt[now][i];\n\t\tif (v == fa) continue;\n\t\ttr[now] = pre; pre.merge(tr[v]);\n\t\tif (i < nxt[now].size() - 1) tr[now].merge(suf[i + 1]);\n\t\tqwq = tr[v]; tr[v] = tmp;\n\t\tcalc(v, now);\n\t\ttr[v] = qwq; tr[now] = tmp;\n\t}\n}\n\nint main() {\n//\tfreopen(\"qwq.txt\", \"r\", stdin);\n\tT = read();\n\twhile (T--) {\n\t\tn = read();\n\t\tfor (int i = 1; i <= n; ++i) val[i] = read();\n\t\tfor (int i = 1, u, v; i < n; ++i) {\n\t\t\tu = read(); v = read();\n\t\t\tnxt[u].push_back(v); nxt[v].push_back(u);\n\t\t} dfs(1, 0);\n\t\tm = read();\n\t\tfor (int i = 1, x; i <= m; ++i) {\n\t\t\tx = read(); q[i] = read();\n\t\t\task[x].push_back(i);\n\t\t} calc(1, 0);\n\t\tfor (int i = 1; i <= m; ++i) otp(ans[i]), putchar('\\n');\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\task[i].clear();\n\t\t\tnxt[i].clear();\n\t\t\ttr[i].clear();\n\t\t}\n\t} return 0;\n}\n```",
        "postTime": 1675759252,
        "uid": 98096,
        "name": "Smallbasic",
        "ccfLevel": 7,
        "title": "[CF1778E]The Tree Has Fallen!"
    },
    {
        "content": "## [CF1778E](https://www.luogu.com.cn/problem/CF1778E)\n\u770b\u5230\u9009\u62e9\u4e00\u4e9b\u6570\u4f7f\u5f97\u8fd9\u4e9b\u6570\u7684\u5f02\u6216\u503c\u6700\u5927\uff0c\u90a3\u80af\u5b9a\u662f\u7ebf\u6027\u57fa\u6ca1\u8dd1\u4e86\u3002\n\n\u4e0d\u59a8\u5047\u8bbe\u4e00\u5f00\u59cb\u6839\u4e3a $1$ \u53f7\u70b9\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u5982\u679c $r$ \u4e0d\u5728 $v$ \u7684\u5b50\u6811\u5185\uff0c\u90a3\u4e48\u5728\u4ee5 $r$ \u4e3a\u6839\u7684\u6811\u4e2d $v$ \u7684\u5b50\u6811\u548c\u5728\u4ee5 $1$ \u53f7\u70b9\u4e3a\u6839\u65f6\u4e00\u6837\uff0c\u5426\u5219\u5047\u8bbe $x$ \u4e3a\u65e2\u662f $r$ \u7684\u7956\u5148\u53c8\u662f $v$ \u7684\u513f\u5b50\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u5728\u4ee5 $r$ \u4e3a\u6839\u7684\u6811\u4e2d $v$ \u7684\u5b50\u6811\u5c31\u662f\u9664\u53bb\u4ee5 $1$ \u6839\u65f6 $x$ \u5b50\u6811\u5185\u8282\u70b9\u4ee5\u5916\u7684\u6240\u6709\u70b9\u3002\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\u5f88\u597d\u5904\u7406\uff0c\u4e00\u904d dfs \u5c31\u53ef\u4ee5\u5f97\u5230\u6bcf\u4e2a\u5b50\u6811\u5185\u6240\u6709\u8282\u70b9\u6743\u503c\u6784\u6210\u7684\u7ebf\u6027\u57fa\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u7528 dfs \u5e8f\u89e3\u51b3\uff0c\u6211\u4eec\u77e5\u9053\u4e00\u68f5\u5b50\u6811\u5185\u8282\u70b9\u7684 dfs \u5e8f\u662f\u8fde\u7eed\u7684\uff0c\u90a3\u4e48\u5220\u53bb\u4e00\u68f5\u5b50\u6811\u5c31\u76f8\u5f53\u4e8e\u5220\u53bb\u4e00\u6bb5\u533a\u95f4\uff0c\u5269\u4e0b\u4e86\u4e00\u4e2a\u524d\u7f00\u548c\u540e\u7f00\uff0c\u6240\u4ee5\u7ef4\u62a4\u524d\u540e\u7f00\u7ebf\u6027\u57fa\u5373\u53ef\u3002\n\n### Code\n```cpp\nconst int N=2e5+10;\n\nint a[N],idx,dfn[N],son[N][35],pre[N][35],suf[N][35],dep[N],fa[N][25],out[N],node[N];\nvector<int>e[N];\n\nvoid Insert(int *st,int x)\n{\n\tper(i,0,30)\n\t\tif(x>>i&1)\n\t\t{\n\t\t\tif(st[i]) x^=st[i];\n\t\t\telse {st[i]=x;return ;}\n\t\t}\n}\n\nvoid merge(int *a,int *b)\n{\n\trep(i,0,30)\n\t\tif(b[i]) Insert(a,b[i]);\n}\n\nvoid dfs(int cur)\n{\n\trep(i,0,30) son[cur][i]=0;\n\tInsert(son[cur],a[cur]);\n\tdfn[cur]=++idx;\n\tnode[idx]=cur;\n\trep(k,0,(int) e[cur].size()-1)\n\t{\n\t\tint nt=e[cur][k];\n\t\tif(nt==fa[cur][0]) continue;\n\t\tfa[nt][0]=cur;\n\t\tdep[nt]=dep[cur]+1;\n\t\tdfs(nt);\n\t\tmerge(son[cur],son[nt]);\n\t}\n\tout[cur]=idx;\n}\n\nint get_mx(int *st)\n{\n\tint ans=0;\n\tper(i,0,30)\n\t\tans=max(ans,ans^st[i]);\n\treturn ans;\n}\n\nint st[35];\n\nint main()\n{\n//\tfreopen(\"in\",\"r\",stdin);\n//\tfreopen(\"out\",\"w\",stdout);\n\tint T;\n\tcin>>T;\n\twhile(T--)\n\t{\n\t\tint n;\n\t\tcin>>n;\n\t\trep(i,1,n) e[i].clear();\n\t\trep(i,1,n)\n\t\t\trep(j,0,30)\n\t\t\t\tpre[i][j]=suf[i][j]=0;\n\t\trep(i,1,n) cin>>a[i];\n\t\trep(i,1,n-1)\n\t\t{\n\t\t\tint u,v;\n\t\t\tcin>>u>>v;\n\t\t\te[u].push_back(v);\n\t\t\te[v].push_back(u);\n\t\t}\n\t\tidx=0;\n\t\tdep[1]=1;\n\t\tdfs(1);\n\t\tInsert(pre[1],a[node[1]]);\n\t\tInsert(suf[n],a[node[n]]);\n\t\trep(i,2,n)\n\t\t{\n\t\t\trep(j,0,30) pre[i][j]=pre[i-1][j];\n\t\t\tInsert(pre[i],a[node[i]]);\n\t\t}\n\t\tper(i,1,n-1)\n\t\t{\n\t\t\trep(j,0,30) suf[i][j]=suf[i+1][j];\n\t\t\tInsert(suf[i],a[node[i]]);\n\t\t}\n\t\trep(j,1,20)\n\t\t\trep(i,1,n)\n\t\t\t\tfa[i][j]=fa[fa[i][j-1]][j-1];\n\t\tint q;\n\t\tcin>>q;\n\t\twhile(q--)\n\t\t{\n\t\t\tint r,v;\n\t\t\tcin>>r>>v;\n\t\t\tif(dfn[r]<dfn[v]||dfn[r]>out[v])\n\t\t\t{\n\t\t\t\tcout<<get_mx(son[v])<<endl;\n\t\t\t}\n\t\t\telse if(r!=v)\n\t\t\t{\n\t\t\t\tper(i,0,20) if(dep[fa[r][i]]>dep[v]) r=fa[r][i];\n\t\t\t\trep(i,0,30) st[i]=pre[dfn[r]-1][i];\n\t\t\t\tif(out[r]<n) merge(st,suf[out[r]+1]);\n\t\t\t\tcout<<get_mx(st)<<endl;\n\t\t\t}\n\t\t\telse cout<<get_mx(son[1])<<endl;\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1675300253,
        "uid": 571634,
        "name": "hgzxwzf",
        "ccfLevel": 7,
        "title": "CF1778E"
    },
    {
        "content": "[$\\tt Link$](/problem/CF1778E)\u3002\n\n\u662f\u8fd9\u6837\u7684\uff0c\u8bbe\u503c\u57df\u4e3a $V$\uff0c\u7ebf\u6027\u57fa\u5927\u5c0f\u4e3a $O(\\log V)$\uff0c\u652f\u6301 $O(\\log V)$ \u65f6\u95f4\u5185\u63d2\u5165\u4e00\u4e2a\u6570\uff0c\u4ee5\u53ca\u67e5\u8be2\u5f53\u524d\u9009\u51fa\u82e5\u5e72\u4e2a\u6570\u53ef\u4ee5\u7684\u6700\u5927\u5f02\u6216\u503c\uff1b$O(\\log^2 V)$ \u65f6\u95f4\u590d\u6742\u5ea6\u5408\u5e76\u4e24\u4e2a\u7ebf\u6027\u57fa\uff0c\u65b9\u6cd5\u662f\u628a\u5176\u4e2d\u4e00\u4e2a\u7684\u6bcf\u4e00\u4e2a\u6570\u63d2\u5165\u5230\u53e6\u4e00\u4e2a\u91cc\u9762\u3002\n\n\u6362\u6839\u677f\u677f\uff0c\u8ba8\u8bba\u4e09\u79cd\u60c5\u51b5\uff0c\u4e0d\u4f1a\u5c31\u770b [$\\tt CF916E$](/problem/CF916E)\u3002\n\n\u7136\u540e\u6362\u6839\u540e\u5b50\u6811\u5c31\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u539f\u6811\u67d0\u4e2a\u70b9\u7684\u5b50\u6811\uff0c\u4e00\u79cd\u662f\u5168\u5c40\u9664\u4e86\u67d0\u4e2a\u70b9\u7684\u539f\u6811\u4e0a\u5b50\u6811\u3002\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\u5199\u4e2a\u6811\u5f62 $\\tt dp$ \u7b97\u7b97\u5b50\u6811\u7ebf\u6027\u57fa\u3002\u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\u5168\u5c40\u9664\u6389\u67d0\u4e2a $\\tt dfn$ \u533a\u95f4\uff0c\u53ef\u4ee5\u62c6\u6210\u4e00\u4e2a\u524d\u7f00\u548c\u540e\u7f00\u7684\u5408\u5e76\uff0c\u9884\u5904\u7406\u524d\u7f00\u3001\u540e\u7f00\u7ebf\u6027\u57fa\u5373\u53ef\u3002\n\n\u4ee3\u7801\u633a\u597d\u5199\u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int N = 2e5 + 5;\n\nint T,n,m,a[N],in[N],out[N];\nvector<int> G[N];\nint dep[N],siz[N],son[N],fa[N];\nint dfn[N],pnt[N],top[N],tot;\n\nstruct jjj{\n\tint v[35];\n\t\n\tvoid clr(){ memset(v,0,sizeof v); }\n\t\n\tvoid ins(int x){\n\t\tfor(int i = 31;~i;--i){\n\t\t\tif(!(x & (1 << i))) continue;\n\t\t\tif(!v[i]){ v[i] = x; break; }\n\t\t\tx ^= v[i];\n\t\t}\n\t}\n\t\n\tint qry(){\n\t\tint ans = 0;\n\t\tfor(int i = 31;~i;--i)\n\t\t\tans = max(ans,ans ^ v[i]);\n\t\treturn ans;\n\t}\n\t\n\tvoid mrg(const jjj& _){\n\t\tfor(int i = 31;~i;--i) ins(_.v[i]);\n\t}\n} pr[N],sf[N],st[N];\n\njjj mrg(const jjj &a,const jjj &b){\n\tjjj res = a;\n\tfor(int i = 31;~i;--i) res.ins(b.v[i]);\n\treturn res;\n}\n\nvoid dfs1(int u,int ft){\n\tst[u].clr(); st[u].ins(a[u]);\n\tdep[u] = dep[fa[u] = ft] + 1;\n\tsiz[u] = 1; son[u] = 0;\n\tfor(int v : G[u]) if(v != ft){\n\t\tdfs1(v,u);\n\t\tsiz[u] += siz[v];\n\t\tif(siz[v] > siz[son[u]]) son[u] = v;\n\t\tst[u].mrg(st[v]);\n\t}\n}\n\nvoid dfs2(int u,int tp){\n\ttop[u] = tp; pnt[dfn[u] = ++tot] = u;\n\tif(son[u]) dfs2(son[u],tp);\n\tfor(int v : G[u]) if(v != son[u] && v != fa[u]) dfs2(v,v);\n\tG[u].clear(); G[u].shrink_to_fit();\n}\n\nint lca(int x,int y){\n\twhile(top[x] != top[y]){\n\t\tif(dep[top[x]] < dep[top[y]]) swap(x,y);\n\t\tx = fa[top[x]];\n\t}\n\treturn dep[x] < dep[y] ? x : y;\n}\n\nint sonlca(int x,int y){\n    while(top[x] != top[y]){\n        if(dep[top[x]] < dep[top[y]]) swap(x,y);\n        if(fa[top[x]] == y) return top[x];\n        x = fa[top[x]];\n    }\n    return son[dep[x] < dep[y] ? x : y];\n}\n\nvoid solve(){\n\tscanf(\"%d\",&n);\n\tfor(int i = 1;i <= n;++i) scanf(\"%d\",a + i);\n\tfor(int i = 1,u,v;i < n;++i){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tG[u].push_back(v);\n\t\tG[v].push_back(u);\n\t}\n\ttot = 0; dfs1(1,0); dfs2(1,1);\n\tfor(int i = 1;i <= n;++i)\n\t\tpr[i] = pr[i - 1],pr[i].ins(a[pnt[i]]);\n\tsf[n + 1].clr();\n\tfor(int i = n;i >= 1;--i)\n\t\tsf[i] = sf[i + 1],sf[i].ins(a[pnt[i]]);\n\tfor(int i = 1;i <= n;++i){\n\t\tin[i] = st[i].qry();\n\t\tout[i] = mrg(pr[dfn[i] - 1],sf[dfn[i] + siz[i]]).qry();\n\t}\n\tscanf(\"%d\",&m);\n\tfor(int x,u;m--;){\n\t\tscanf(\"%d%d\",&x,&u);\n\t\tif(x == u) printf(\"%d\\n\",in[1]);\n\t\telse if(lca(x,u) != u) printf(\"%d\\n\",in[u]);\n\t\telse printf(\"%d\\n\",out[sonlca(u,x)]);\n\t}\n}\n\nint main(){ for(scanf(\"%d\",&T);T--;solve()); return 0; }\n```",
        "postTime": 1675401228,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "CF1778E The Tree Has Fallen!"
    }
]