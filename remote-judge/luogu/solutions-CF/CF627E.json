[
    {
        "content": "\u4e00\u9053\u5f88\u5999\u7684\u9898\u3002\n\n\u9996\u5148\u8003\u8651\u6700\u66b4\u529b\u7684\u89e3\u6cd5\u5e94\u8be5\u5c31\u662f\u679a\u4e3e\u4e0a\u4e0b\u8fb9\u754c\u7136\u540e\u7528\u5355\u8c03\u6808\u53bb\u6c42\u4e86\uff0c\u590d\u6742\u5ea6$O(n^3)$\u3002\n\n\u8003\u8651\u600e\u4e48\u6c42\u4f18\u5316\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u8003\u8651\u80fd\u4e0d\u80fd\u53ea\u679a\u4e3e\u4e0a\u8fb9\u754c\u548c\u4e0b\u8fb9\u754c\u7136\u540e\u4e0d\u7528\u5355\u8c03\u6808\u3002\n\n\u53d1\u73b0\u7ed9\u5b9a\u7684\u70b9\u6570\u5f88\u5c11\uff08\u8ddf$n,m$\u540c\u9636\uff09\uff0c\u4e8e\u662f\u8003\u8651\u4ece\u8fd9\u91cc\u4e0b\u624b\u3002\n\n\u8003\u8651\u679a\u4e3e\u4e00\u4e2a\u4e0a\u8fb9\u754c$i$\uff0c\u7136\u540e\u8003\u8651\u5c06\u4e0a\u8fb9\u754c\u4e3a$i$\uff0c\u4e0b\u8fb9\u754c\u4e3a$j$\u7684\u5408\u6cd5\u77e9\u5f62\u4e2a\u6570\u7b97\u51fa\u6765\u3002\n\n\u8003\u8651\u600e\u4e48\u5b58\u5b83\uff0c\u4e14\u8fd8\u8981\u52a8\u6001\u4fee\u6539\uff08\u56e0\u4e3a\u8981\u628a\u4e0b\u8fb9\u754c\u4ece$n$\u5f80\u4e0a\u79fb\uff09\u3002\n\n\u4e00\u4e2a\u4e0a\u8fb9\u754c\u7684\u70b9\uff0c\u627e\u5230\u5728\u5b83\u5de6\u8fb9\u7684\u7b2c$k$\u4e2a\u5728$i$\u5230$n$\u884c\u4e4b\u95f4\u7684\u7ed9\u5b9a\u7684\u70b9\uff0c\u90a3\u4e48\u5b83\u7684\u8d21\u732e\u5c31\u662f\u8fd9\u4e2a\u70b9\u7684\u7eb5\u5750\u6807\u3002\n\n\u4e8e\u662f\u8003\u8651\u5c06\u7b2c$i$\u884c\u5230\u7b2c$n$\u884c\u7684\u70b9\u63d0\u53d6\u51fa\u6765\u6309\u7167\u7eb5\u5750\u6807\u6392\u4e2a\u5e8f\u6309\u7167\u987a\u5e8f\u5efa\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u5728\u5bf9\u6bcf\u4e2a\u70b9\u8bb0\u4e00\u4e2a$cnt_i$\u8868\u793a\u4e0a\u8fb9\u754c\u6709\u591a\u5c11\u4e2a\u70b9\u7684\u5de6\u8fb9\u7b2c$k$\u4e2a\u70b9\u662f$i$\u3002\n\n\u7136\u540e\u8003\u8651\u4e00\u884c\u4e00\u884c\u5730\u4ece\u4e0b\u9762\u5f80\u4e0a\u9762\u5220\u884c\uff0c\u5148\u8003\u8651\u5220\u9664\u4e00\u4e2a\u70b9\u3002\n\n\u753b\u4e2a\u56fe\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c\u5220\u9664\u4e00\u4e2a\u70b9\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u5b83\u5230\u5de6\u8fb9\u7684$k$\u4e2a\u70b9\u96c6\u4f53\u5de6\u79fb\u4e86\u4e00\u4f4d\uff0c\u8d21\u732e\u7684\u51cf\u5c11\u91cf\u4e5f\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u7684\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u6765\u5b9e\u73b0\uff0c\u540c\u65f6\u7ef4\u62a4\u4e00\u4e0b$cnt$\u7684\u53d8\u5316\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u70b9\u5220\u6389\u5373\u53ef\u3002\n\n\u4e8e\u662f\u8fd0\u7528\u53cc\u5411\u94fe\u8868\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u7684\u7528$O(k)$\u7684\u65f6\u95f4\u6765\u5220\u9664\u4e00\u4e2a\u70b9\u3002\n\n\u4e8e\u662f\u7528\u8fd9\u6837\u7684\u65b9\u6cd5\u6211\u4eec\u53ef\u4ee5\u7528\u4e0a\u4e00\u884c\u518d\u5220\u53bb\u8fd9\u4e00\u884c\u7684\u70b9\u6c42\u5f97\u8fd9\u4e00\u884c\u7684\u7b54\u6848\u3002\n\n\u8fd9\u6837\u5b50\u4e00\u884c\u884c\u5220\u53bb\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6$O(n^2k)$\u3002\n\ncode\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<iostream>\n#include<set>\n#include<vector>\n#include<queue>\n#include<stack>\n#include<bitset>\n#define G 3\n#define eps 1e-15\n#define maxn 3010\n#define maxm 100010\n#define inf 999999999999999\n#define mod 998244353\n#define mp(x,y) make_pair(x,y)\n#define fi first\n#define se second\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned int uint;\ntypedef pair<int,int> pii;\nint read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch-'0'<0||ch-'0'>9){if(ch=='-') f=-1;ch=getchar();}\n    while(ch-'0'>=0&&ch-'0'<=9){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nint n,m,c,K,top;\nstruct P{\n    int x,y;\n}p[maxn];\nint a[maxn];\nvector<int>v[maxn];\nbool cmp(int x,int y)\n{\n    return p[x].y<p[y].y;\n}\nint L[maxn],R[maxn],cnt[maxn];\nll ans,sum;\nbool dfs(int x,int las)\n{\n    if(!las||!x)  return true;\n    if(!dfs(L[x],las-1)) cnt[L[x]]=0;\n    cnt[L[x]]+=cnt[x];\n    return false;\n}\nint main()\n{\n    n=read();m=read();c=read();K=read();\n    for(int i=1;i<=c;i++)  p[i].x=read(),p[i].y=read(),v[p[i].x].push_back(i);\n    for(int i=1;i<=n;i++)\n    {\n        top=0;\n        for(int j=1;j<=c;j++)\n          if(p[j].x>=i)  a[++top]=j;\n        sort(a+1,a+top+1,cmp);\n        a[top+1]=c+1;\n        sum=0;\n        for(int j=0;j<=c+1;j++)  cnt[j]=L[j]=R[j]=0;\n        int now=0;\n        for(int j=1;j<=m;j++)\n        {\n            while(p[a[now+1]].y==j&&now<top)\n            {\n                now++;\n                L[a[now]]=a[now-1];\n                R[a[now]]=a[now+1];\n            }\n            int tmp=a[now];\n            for(int k=1;k<=K-1;k++)  tmp=L[tmp];\n            cnt[tmp]++;\n        }\n        for(int j=1;j<=top;j++)  sum+=p[a[j]].y*cnt[a[j]];\n        ans+=sum;\n        for(int j=n;j>=i+1;j--)\n        {\n            for(int k=0;k<v[j].size();k++)\n            {\n                int x=v[j][k];\n                for(int l=1;l<=K;l++)\n                {\n                    sum-=cnt[x]*(p[x].y-p[L[x]].y);\n                    x=L[x];\n                    if(!x)  break;\n                }\n                dfs(v[j][k],K);\n                x=v[j][k];\n                L[R[x]]=L[x];\n                R[L[x]]=R[x];\n            }\n            ans+=sum;\n        }\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1580903927,
        "uid": 46396,
        "name": "justin_cao",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF627E \u3010Orchestra\u3011"
    },
    {
        "content": "> [CF627E Orchestra](https://codeforces.com/contest/627/problem/E)\n\n## \u9898\u610f\n\n- \u5728\u4e00\u4e2a $r \\times c$ \u7684\u77e9\u9635\u4e2d\u6709 $n$ \u4e2a\u70b9\uff0c\u95ee\u6709\u591a\u5c11\u4e2a\u8fde\u7eed\u5b50\u77e9\u9635\u81f3\u5c11\u5305\u542b $k$ \u4e2a\u70b9\u3002\n- $r,c,n \\le 3 \\times 10^3$\uff0c$k \\le 10$\u3002\n\n## \u9898\u89e3\n\n\u8fd9\u9898\u4e0d\u540c\u590d\u6742\u5ea6\u7684\u505a\u6cd5\u975e\u5e38\u591a\u3002\n\n### $\\mathcal O(r^3c^3 + n)$\n\n\u6700\u6734\u7d20\u7684\u505a\u6cd5\uff0c\u679a\u4e3e\u8fde\u7eed\u5b50\u77e9\u9635\u7684\u4e0a\u4e0b\u5de6\u53f3\u8fb9\u754c\uff0c\u66b4\u529b\u8ba1\u7b97\u5176\u4e2d\u7684\u70b9\u6570\u3002\n\n\u4e5f\u5c31\u662f [https://www.luogu.com.cn/problem/CF635A](https://www.luogu.com.cn/problem/CF635A) \u8fd9\u9898\u3002\n\n### $\\mathcal O(r^2c^2 + n)$\n\n\u5bf9\u4e8e $\\mathcal O(r^3c^3)$ \u505a\u6cd5\u7684\u4f18\u5316\uff0c\u8ba1\u7b97\u8fde\u7eed\u5b50\u77e9\u9635\u4e2d\u7684\u70b9\u6570\u65f6\uff0c\u524d\u7f00\u548c\u4f18\u5316\u4e00\u4e0b\u3002\n\n### $\\mathcal O(r^2c + n)$\n\n\u53ea\u679a\u4e3e\u4e0a\u4e0b\u8fb9\u754c\uff0c\u4e2d\u95f4 two pointers \u626b\u4e00\u904d\u3002\n\n### $\\mathcal O(r^2 + rc + rnk)$\n\n\u6ce8\u610f\u5230 $n,k$ \u90fd\u975e\u5e38\u5c0f\uff0c\u5176\u4e2d $n,r,c$ \u540c\u9636\uff0c\u800c $k$ \u53ea\u6709 $10$\u3002\n\n\u8003\u8651\u679a\u4e3e\u4e0a\u8fb9\u754c $i$\uff0c\u4e0b\u8fb9\u754c\u4ece $i$ \u5f80\u4e0b\u63a8\uff0c\u7528\u94fe\u8868\u6309**\u5217\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c\u884c\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57**\u7684\u987a\u5e8f\u7ef4\u62a4\u6240\u6709\u70b9\u4ee5\u53ca\u70b9\u4e4b\u540e\u7b2c $k-1$ \u4e2a\u70b9\u7684\u5217\u3002\n\n\u5f80\u4e0b\u63a8\u7684\u8fc7\u7a0b\uff0c\u76f8\u5f53\u4e8e\u5f80\u94fe\u8868\u91cc\u52a8\u6001\u52a0\u70b9\u7684\u8fc7\u7a0b\uff0c\u6ce8\u610f\u5230\u6bcf\u6b21\u52a0\u70b9\u53ea\u4f1a\u6539\u53d8\u5176\u524d\u9762 $k-1$ \u4e2a\u70b9\u7684\u4fe1\u606f\uff0c\u90a3\u4e48\u66b4\u529b\u66f4\u65b0\u5373\u53ef\u3002\n\n\u4f46\u662f\u94fe\u8868\u65e0\u6cd5\u968f\u673a\u8bbf\u95ee\uff0c\u65e0\u6cd5\u5b9e\u73b0\u52a8\u6001\u52a0\u70b9\u3002\u90a3\u4e48\u6362\u4e2a\u65b9\u5411\uff0c\u4ece $r$ \u5f80\u4e0a\u63a8\u5230 $i$\uff0c\u52a8\u6001\u52a0\u70b9\u6539\u4e3a\u52a8\u6001\u5220\u70b9\uff0c\u5c31\u53ef\u4ee5\u7528\u94fe\u8868\u7ef4\u62a4\u4e86\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst int N = 3e3 + 7;\nint r, c, n, k, p[N], q[N], t[N], v[N];\npi a[N];\nvector<pi> R[N], C[N];\nll ans;\n\ninline ll calc(int i, int j, int o) {\n\tll ret = 1ll * (t[o] - j + 1) * (a[o].se - a[p[o]].se) * (c - a[v[o]].se + 1);\n\treturn t[o] = j - 1, ret;\n}\n\nint main() {\n\trd(r), rd(c), rd(n), rd(k);\n\tfor (int i = 1, x, y; i <= n; i++)\n\t\trd(x), rd(y), a[i] = mp(x, y), R[x].pb(mp(y, i)), C[y].pb(mp(x, i));\n\tfor (int i = 1; i <= r; i++) sort(R[i].begin(), R[i].end());\n\tfor (int i = 1; i <= c; i++) sort(C[i].begin(), C[i].end());\n\ta[n+1] = mp(r + 1, c + 1);\n\tfor (int i = 1; i <= r; i++) {\n\t\tint o = 0;\n\t\tfor (int j = 1; j <= c; j++)\n\t\t\tfor (pi x : C[j])\n\t\t\t\tif (x.fi >= i)\n\t\t\t\t\tq[o] = x.se, p[x.se] = o, o = x.se, t[o] = r, v[o] = 0;\n\t\tq[o] = q[n+1] = v[n+1] = n + 1, t[n+1] = r, o = 0;\n\t\tfor (int j = 1; j <= k; j++) o = q[o];\n\t\tfor (int j = q[0]; j != n + 1; j = q[j], o = q[o]) v[j] = o;\n\t\tfor (int j = r; j >= i; j--)\n\t\t\tfor (pi x : R[j]) {\n\t\t\t\tans += calc(i, j, q[x.se]), o = x.se;\n\t\t\t\tfor (int l = 1; o && l <= k; l++, o = p[o]) ans += calc(i, j, o);\n\t\t\t\tq[p[x.se]] = q[x.se], p[q[x.se]] = p[x.se];\n\t\t\t\tint w = o = q[o];\n\t\t\t\tfor (int l = 1; l < k; l++) w = q[w];\n\t\t\t\twhile (o != q[x.se]) v[o] = w, o = q[o], w = q[w];\n\t\t\t}\n\t}\n\tprint(ans);\n\treturn 0;\n}\n```",
        "postTime": 1583387481,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF627E \u3010Orchestra\u3011"
    },
    {
        "content": "[\u4e5f\u8bb8\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Morning-Glory/p/11681121.html)\t\n\t\n# $\\mathcal{Description}$\t\n\n**\u9898\u76ee\u5927\u610f**\t\u6709\u4e00\u4e2a$r * c$\u7684\u77e9\u9635\u4e0a\u6709$n$\u4e2a\u70b9\uff0c\u95ee\u6709\u591a\u5c11\u4e2a\u5b50\u77e9\u9635\u91cc\u5305\u542b\u81f3\u5c11$k$\u4e2a\u70b9\t\n\t\n**\u8f93\u5165\u683c\u5f0f**\t\u7b2c\u4e00\u884c\u56db\u4e2a\u6570$r,c,n,k$\uff0c\u63a5\u4e0b\u6765$n$\u884c\uff0c\u6bcf\u884c\u4e24\u4e2a\u6570$x_i,y_i$\uff0c\u8868\u793a\u7b2c$i$\u4e2a\u70b9\u7684\u5750\u6807\t\n\t\n**\u8f93\u51fa\u683c\u5f0f**\t\u4e00\u884c\u4e00\u4e2a\u6570\u8868\u793a\u5408\u6cd5\u5b50\u77e9\u9635\u4e2a\u6570\t\n\t\n**\u6570\u636e\u8303\u56f4**\t $1\\leq r,c,n\\leq 3000 , 1\\leq k\\leq \\min(n,10)$\t\n\t\n# $\\mathcal{Solution}$\t\n~~\u8fd9\u9898\u597d\u96be~~\t\n\t\n\u9898\u76ee\u8981\u6c42\u81f3\u5c11\u5305\u542b\u4e86$k$\u4e2a\u70b9\u7684\u5b50\u77e9\u9635\uff0c$k$\u5f88\u5c0f\t\n\u6734\u7d20\u7684\u60f3\u6cd5\u662f\u679a\u4e3e\u4e0a\u8fb9\u754c\uff0c\u4e0b\u8fb9\u754c\uff0c\u7136\u540e\u5728\u4e2d\u95f4\u5c3a\u53d6\uff0c\u8fd9\u6837\u662f$O\\left(n^3\\right)$\u7684\t\n\t\n\u53cd\u8fc7\u6765\u8003\u8651\uff0c\u4ece\u4e0b\u5f80\u4e0a\u679a\u4e3e\u6bcf\u4e00\u884c\t\n\u5148\u7b97\u51fa\u4ee5\u8fd9\u4e00\u884c\u7684\u6bcf\u4e2a\u9876\u70b9\u4e3a\u5de6\u4e0a\u89d2\uff0c\u6700\u4e0b\u9762\u4e00\u884c\u4e3a\u7b2c$c$\u7684\u6240\u6709\u5408\u6cd5\u77e9\u9635\u4e2a\u6570\t\n\u8ba1\u7b97\u65b9\u6cd5\u8003\u8651\u5c3a\u53d6\u5373\u53ef\t\n\u518d\u8003\u8651\u6700\u4e0b\u9762\u4e00\u884c\u9010\u6e10\u5f80\u4e0a\u8d70\u7684\u5408\u6cd5\u77e9\u9635\u4e2a\u6570\t\n\t\n\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u70b9\u662f\u5728\u4e0d\u65ad\u53d8\u5c11\u7684\t\n\u8003\u8651\u7b97\u51fa\u5c06\u6700\u4e0b\u9762\u4e00\u884c\u53d8\u4e3a\u5176\u4e0a\u9762\u90a3\u4e00\u884c\u65f6\u5408\u6cd5\u77e9\u9635\u7684\u51cf\u5c11\u91cf\uff0c\u518d\u7528\u539f\u6765\u7684\u5408\u6cd5\u77e9\u9635\u91cf\u51cf\u53bb\u5c31\u662f\u6700\u4e0b\u9762\u4e00\u884c\u5f80\u4e0a\u79fb\u4e00\u884c\u540e\u7684\u5408\u6cd5\u77e9\u9635\u6570\u91cf\t\n\t\n\u5982\u4f55\u8ba1\u7b97\u5408\u6cd5\u77e9\u9635\u7684\u51cf\u5c11\u91cf\t\n\u679a\u4e3e\u8fd9\u4e00\u884c\u4e2d\u7684\u6bcf\u4e2a\u70b9\uff0c\u8ba1\u7b97\u51fa\u5305\u542b\u8fd9\u4e2a\u70b9\u4e14\u70b9\u6570\u521a\u597d\u4e3a$k$\u7684\u77e9\u9635\u4e2a\u6570\uff0c\u7136\u540e**\u5220\u53bb\u8fd9\u4e2a\u70b9**\t\n\u8ba1\u7b97\u65b9\u6cd5\u4e5f\u662f\u5c3a\u53d6\uff0c\u53e6\u5916\uff0c\u5c3a\u53d6\u65f6\u7528\u4e00\u4e2a\u94fe\u8868\u8868\u793a\u8be5\u884c\u4e2d\u4e0b\u4e00\u4e2a\u70b9\u548c\u4e0a\u4e00\u4e2a\u70b9\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5c3a\u53d6\u590d\u6742\u5ea6\u5c31\u662f\u8be5\u884c\u70b9\u6570\uff0c\u800c\u4e0d\u662f$m$\t\n\u8fd9\u6837\u5c31\u80fd\u7b97\u51fa\u5220\u53bb\u8fd9\u4e00\u884c\u4e2d\u6240\u6709\u70b9\u540e\u4e0d\u5408\u6cd5\u7684\u77e9\u9635\u4e2a\u6570\t\n\u90a3\u4e48\u5f80\u4e0a\u79fb\u4e00\u884c\u5408\u6cd5\u77e9\u9635\u5c31\u4f1a\u51cf\u53bb\u8fd9\u4e9b\u77e9\u9635\t\n\t\n\u5982\u6b64\u8ba1\u7b97\uff0c\u603b\u590d\u6742\u5ea6\u4e3a\t\n$O\\left(n^2k+npk\\right)$\t\n\t\n\u5982\u6709\u4e0d\u61c2\u4e4b\u5904\uff0c\u8bf7\u53c2\u8003\u4ee3\u7801\t\n\n# $\\mathcal{Code}$\t\n\t\n```cpp\t\n/*******************************\t\nAuthor:Morning_Glory\t\nLANG:C++\t\nCreated Time:2019\u5e7410\u670815\u65e5 \u661f\u671f\u4e8c 15\u65f637\u520621\u79d2\t\n*******************************/\t\n#include <cstdio>\t\n#include <fstream>\t\n#include <vector>\t\n#define ll long long\t\nusing namespace std;\t\nconst int maxn = 3005;\t\nint n,m,p,k;\t\nint s[maxn],t[maxn],last[maxn],nxt[maxn];\t\nll ans;\t\nvector <int> dot[maxn];\t\nint main()\t\n{\t\n\tscanf(\"%d%d%d%d\",&n,&m,&p,&k);//\u6c42n\u884cm\u5217p\u4e2a\u70b9\u81f3\u5c11\u5305\u542bk\u4e2a\u70b9\u7684\u77e9\u9635\u4e2a\u6570\n\tfor (int i=1;i<=p;++i){\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tdot[x].push_back(y);//\u6bcf\u884c\u7684\u70b9\n\t}\n\n\tfor (int u=n;u>=1;--u){\n\t\tfor (int i=0;i<dot[u].size();++i)\t++s[dot[u][i]];//s[i] -> \u7b2cn\u884c\u5230\u7b2cu\u884c\u4e0a\u7b2ci\u5217\u7684\u70b9\u6570\n\t\tint l=1,r=0,num=0;\n\t\tll inc=0;\n\t\twhile (true){\n\t\t\twhile (r+1<=m&&num<k)\tnum+=s[++r];\n\t\t\tif (num<k)\tbreak;\n\t\t\twhile (l<=r&&num>=k)\tnum-=s[l++],inc+=m-r+1;//inc \u5408\u6cd5\u77e9\u9635\u4e2a\u6570\n\t\t}\n\n\t\tfor (int i=1;i<=m;++i)\tt[i]=s[i];\n\t\tfor (int i=0;i<=m+1;++i)\tlast[i]=i-1,nxt[i]=i+1;\n\t\tfor (int i=1;i<=m;++i)\n\t\t\tif (!s[i])\tlast[nxt[i]]=last[i],nxt[last[i]]=nxt[i];\n\n\t\tfor (int d=n;d>=u;--d){\n\t\t\tans+=inc;\n\n\t\t\tfor (int i=0;i<dot[d].size();++i){\n\n\t\t\t\tint cur=dot[d][i],sl=t[cur],sr=0;\n\t\t\t\tl=r=cur;\n\t\t\t\twhile (nxt[r]<=m&&sl+sr+t[nxt[r]]<=k)\tsr+=t[r=nxt[r]];\n\n\t\t\t\twhile (true){\n\t\t\t\t\tif (sl+sr==k)\tinc-=(l-last[l])*(nxt[r]-r);\n\t\t\t\t\tsl+=t[l=last[l]];\n\t\t\t\t\tif (!l||sl>k)\tbreak;\n\t\t\t\t\twhile (sl+sr>k)\tsr-=t[r],r=last[r];\n\t\t\t\t}\n\n\t\t\t\t--t[cur];\n\t\t\t\tif (!t[cur])\tlast[nxt[cur]]=last[cur],nxt[last[cur]]=nxt[cur];\n\t\t\t}\n\t\t}\n\t}\n\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n\n\n",
        "postTime": 1571146040,
        "uid": 89048,
        "name": "Morning_Glory",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF627E \u3010Orchestra\u3011"
    },
    {
        "content": "\u5410\u69fd\uff1a\u4e3a\u4ec0\u4e48\u6240\u6709\u9898\u89e3\u90fd\u8bf4\u53cc\u5411\u94fe\u8868\u4e0d\u80fd\u52a8\u6001\u52a0\u70b9\u554a\uff0c\u660e\u660e\u53ef\u4ee5\u7684\n\n\u9996\u5148\u505a\u4e2a\u5bb9\u65a5\uff0c\u6c42\u591a\u5c11\u4e2a\u8fde\u7eed\u5b50\u77e9\u9635\u5305\u542b\u5c11\u4e8e $K$ \u4e2a\u70b9\u3002\n\n\u679a\u4e3e\u4e0a\u8fb9\u754c\u548c\u4e0b\u8fb9\u754c\uff08\u5bf9\u884c\u800c\u8a00\uff09\u3002\u7528\u94fe\u8868\u7ef4\u62a4\u6bcf\u4e2a\u6709\u9ed1\u70b9\u7684\u5217\u3002\n\n\u5728\u52a0\u5165\u4e00\u4e2a\u65b0\u884c\u65f6\uff0c\u627e\u5230\u6bcf\u4e2a\u8fd9\u4e2a\u884c\u4e2d\u9ed1\u70b9\u5e94\u8be5\u5728\u94fe\u8868\u4e2d\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u628a\u5b83\u4eec\u63d2\u5165\u94fe\u8868\u3002\u5177\u4f53\u5730\uff0c\u53ef\u4ee5 $O(nr+n^2)$ \u9884\u5904\u7406\u51fa $lst(p,i)$ \u8868\u793a\u7b2c $p$ \u4e2a\u9ed1\u70b9 $(x_p,y_p)$ \u6240\u5728\u884c $x_p$ \u4e0e\u884c $i$\uff08$i\\le x_p$\uff09\u4e4b\u95f4\u7684\u6240\u6709\u6ee1\u8db3 $y'\\le y_p$ \u7684\u9ed1\u70b9\u4e2d\uff0c$y'$ \u6700\u5927\u7684\u90a3\u4e00\u4e2a\uff1b\u90a3\u4e48\u5728\u94fe\u8868\u4e2d $p$ \u5c31\u5e94\u8be5\u63d2\u5165\u5230\u8fd9\u4e2a\u9ed1\u70b9\u540e\u9762\u3002\u5047\u5982 $y'=y_p$ \u5c31\u4e0d\u9700\u8981\u65b0\u63d2\u5165\u5143\u7d20\uff0c\u628a\u8fd9\u4e2a\u5143\u7d20\u7684\u6743\u503c\u52a0\u4e00\u5373\u53ef\u3002\n\n\u603b\u8d21\u732e\u53ea\u4e0e $next$ \u6709\u5173\uff08$next_i$ \u8868\u793a\u6ee1\u8db3\u94fe\u8868\u4e2d\u7b2c $i$ \u4e2a\u70b9\u5230\u7b2c $next_i$ \u4e2a\u70b9\u7684\u6743\u503c\u548c\u5c0f\u4e8e $K$ \u7684\u6700\u5927 $next$\uff09\uff0c\u4e3a\u4e86\u52a8\u6001\u7ef4\u62a4\u603b\u8d21\u732e\uff0c\u53ea\u9700\u8981\u52a8\u6001\u7ef4\u62a4 $next$\u3002\u6bcf\u6b21\u63d2\u5165\u81f3\u591a\u4f1a\u5f15\u8d77 $O(K)$ \u4e2a\u70b9\u7684\u8d21\u732e\u6539\u53d8\uff0c\u53cc\u6307\u9488\u53ef\u4ee5\u505a\u5230 $O(K)$ \u4fee\u6539 $next$ \u5e76\u91cd\u65b0\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(nrK+n^2)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint n,m,K,q,is[3005][3005],X[3005],Y[3005],lst[3005][3005],l[3005],r[3005],nxt[3005],w[3005],cur[3005];\nll ans=0,sum=0;\nvector<int> t[3005];\nint S(int l,int r){\n\treturn (l+r)*(r-l+1)/2;\n}\nint Calc(int i){\n\tif(nxt[i]<i)return (i-l[i]-1)*(i-l[i])/2;\n\treturn S(r[nxt[i]]-i,r[nxt[i]]-(l[i]+1));\n}\nvoid Insert(int x,int p){\n\tint q=r[p];\n\tif(q==x)w[q]++;\n\telse r[p]=x,l[x]=p,r[x]=q,l[q]=x,w[x]=1;\n\tint i=r[x],cnt=0,j=l[i],s=0;\n\tans-=cur[i];\n\twhile(s+w[r[j]]<K)j=r[j],s+=w[j];\n\tnxt[i]=j,ans+=(cur[i]=Calc(i));\n\tfor(i=l[i],cnt++;i&&cnt<=K;i=l[i],cnt++){\n\t\tans-=cur[i],s+=w[i];\n\t\twhile(s>=K)s-=w[j],j=l[j];//\u53cc\u6307\u9488\n\t\tnxt[i]=j,ans+=(cur[i]=Calc(i));\n\t}\n}\nint main(){\n\tcin>>n>>m>>q>>K;\n\tfor(int i=1,x,y;i<=q;i++)cin>>x>>y,is[x][y]=i,t[x].push_back(y),X[i]=x,Y[i]=y;\n\tfor(int i=1;i<=n;i++)sort(t[i].begin(),t[i].end());\n\tfor(int i=1;i<=q;i++){\n\t\tint l=0;\n\t\tfor(int j=X[i];j>=1;j--){\n\t\t\tfor(int k:t[j])if(k<Y[i])l=max(l,k);\n\t\t\tlst[i][j]=l;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)sum+=i*j;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=0;j<=m+1;j++)w[j]=l[j]=r[j]=nxt[j]=cur[j]=0;\n\t\tr[0]=r[m+1]=m+1,l[0]=l[m+1]=0,nxt[0]=nxt[m+1]=m+1,w[0]=0,w[m+1]=1e9,cur[m+1]=ans=m*(m+1)/2;\n\t\tfor(int j=i;j<=n;j++){\n\t\t\tfor(int k:t[j])Insert(k,lst[is[j][k]][i]);\n\t\t\tsum-=ans;\n\t\t}\n\t}\n\tcout<<sum;\n}\n```",
        "postTime": 1628651492,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF627E\u3010Orchestra\u3011"
    },
    {
        "content": "[Codeforces \u9898\u76ee\u4f20\u9001\u95e8](https://codeforces.com/contest/627/problem/E) & [\u6d1b\u8c37\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF627E)\n\n\u4e0b\u8bbe $n,m$ \u540c\u9636\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u50bb\u5b50\u90fd\u4f1a\u7684\u66b4\u529b\u505a\u6cd5\uff0c\u679a\u4e3e\u77e9\u5f62\u7684\u4e0a\u3001\u4e0b\u8fb9\u754c $l,r$\uff0c\u8003\u8651\u96c6\u5408\u591a\u91cd\u96c6 $S=\\{y|x\\in[l,r],(x,y)\\text{\u4e3a\u6807\u8bb0\u70b9}\\}$\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u5728\u7b2c $l$ \u884c\u4e0e\u7b2c $r$ \u884c\u4e4b\u95f4\u6240\u6709\u6807\u8bb0\u70b9\u7684\u5217\u5750\u6807\u7684\u96c6\u5408\uff0c\u8003\u8651\u8fdb\u4e00\u6b65\u679a\u4e3e\u77e9\u5f62\u7684\u5de6\u7aef\u70b9 $x$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u53f3\u7aef\u70b9 $y$\uff0c\u4ee5 $(l,x)$ \u4e3a\u5de6\u4e0a\u89d2\uff0c$(r,y)$ \u4e3a\u53f3\u4e0b\u89d2\u7684\u77e9\u5f62\u4e2d\u81f3\u5c11\u6709 $k$ \u4e2a\u6807\u8bb0\u70b9\u5f53\u524d\u4ec5\u5f53 $S$ \u4e2d\u6709\u81f3\u5c11 $k$ \u4e2a\u5143\u7d20 $\\in[x,y]$\uff0c\u6545\u8003\u8651\u7528 two pointers \u6c42\u51fa\u8fd9\u4e2a $y$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $n^3$\u3002\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6ce8\u610f\u5230 $k$ \u6700\u591a\u53ea\u6709 $10$\uff0c\u56e0\u6b64\u8003\u8651\u4ece\u6b64\u4e0b\u624b\u3002\u6211\u4eec\u5c06 $S$ \u4e2d\u7684\u5143\u7d20\u4ece\u5c0f\u5230\u5927\u6392\u4e2a\u5e8f\uff0c\u8bb0\u4f5c $x_1,x_2,\\cdots,x_{|S|}$\uff0c\u8bb0 $nxt_x$ \u4e3a\u5f53\u77e9\u5f62\u7684\u5de6\u8fb9\u754c\u4e3a $x$ \u65f6\u5019\u6700\u5c0f\u7684\u53f3\u8fb9\u754c $y$ \u4f7f\u5f97 $S$ \u4e2d\u81f3\u5c11\u6709 $k$ \u4e2a\u5143\u7d20 $\\in[x,y]$\uff0c\u90a3\u4e48\u663e\u7136 $\\forall v\\in(x_{i-1},x_i],nxt_v=x_{i+k-1}$\uff0c\u56e0\u6b64 $i$ \u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f $(x_i-x_{i-1})\\times(m-x_{i+k-1})$ \u7684\u8d21\u732e\uff0c\u6211\u4eec\u518d\u8bb0 $f_i=(x_i-x_{i-1})\\times(m-x_{i+k-1})$\uff0c\u90a3\u4e48\u663e\u7136\u77e9\u5f62\u77e9\u5f62\u7684\u4e0a\u3001\u4e0b\u8fb9\u754c\u5206\u522b\u4e3a $l,r$ \u65f6\u7684\u7b54\u6848\u5c31\u662f $\\sum\\limits_{i=1}^{|S|}f_i$\u3002\n\n\u6211\u4eec\u8003\u8651\u8fd8\u662f\u679a\u4e3e\u77e9\u5f62\u7684\u4e0a\u8fb9\u754c\u3001\u4e0b\u8fb9\u754c\uff0c\u5e76\u5728\u679a\u4e3e\u7684\u8fc7\u7a0b\u4e2d**\u52a8\u6001\u7ef4\u62a4 $f_i$ \u7684\u53d8\u5316**\u3002\u6ce8\u610f\u5230\u4f60\u6bcf\u52a0\u5165/\u5220\u9664\u4e00\u4e2a\u70b9\uff0c\u6700\u591a\u4f1a\u5f71\u54cd $k+1$ \u4e2a $f_i$\u3002\u56e0\u6b64\u6bcf\u6b21\u52a0\u5165/\u5220\u9664\u65f6\u66b4\u529b\u4fee\u6539 $f_i$ \u90fd\u6ca1\u95ee\u9898\u3002\u90a3\u4e48\u73b0\u5728\u95ee\u9898\u5c31\u6765\u4e86\uff0c\u600e\u4e48\u4fee\u6539 $f_i$ \u5462\uff1f\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u601d\u8def\u662f `std::multiset<int>`\uff0c\u4e0d\u8fc7\u975e\u5e38\u62b1\u6b49\uff0c`std::multiset<int>` \u4f1a\u5e73\u767d\u591a\u4e00\u4e2a $\\log$\uff0c\u590d\u6742\u5ea6 $n^2k\\log n$\uff0c\u518d\u52a0\u4e0a `set` \u7684\u5927\u5e38\u6570\uff0c\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\u6ce8\u610f\u5230\u6bcf\u6b21\u4fee\u6539\u6211\u4eec\u53ea\u7528\u627e\u51fa\u524d\u9a71\u3001\u540e\u7ee7\uff0c\u56e0\u6b64\u8003\u8651\u4f7f\u7528\u64c5\u957f $\\mathcal O(1)$ \u6c42\u51fa\u524d\u9a71\u3001\u540e\u7ee7\u7684\u53cc\u5411\u94fe\u8868\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a `set` \u7684 $\\log$ \u53bb\u6389\u4e86\u3002\u8fd8\u6709\u4e00\u70b9\uff0c\u5c31\u662f\u53cc\u5411\u94fe\u8868\u4e0d\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u56e0\u6b64\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u52a8\u6001\u52a0\u70b9\u662f\u5b9e\u73b0\u4e0d\u4e86\u4e86\u3002\u6545\u8003\u8651\u6362\u4e2a\u601d\u8def\uff0c\u65e2\u7136\u53cc\u5411\u94fe\u8868\u4e0d\u652f\u6301**\u52a8\u6001\u52a0\u70b9**\uff0c\u6211\u4eec\u5c31\u8003\u8651**\u52a8\u6001\u5220\u70b9**\uff0c\u9996\u5148\u5c06\u6a2a\u5750\u6807 $\\ge l$ \u7684\u70b9\u6309\u7167\u7eb5\u5750\u6807\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u52a0\u5165\u53cc\u5411\u94fe\u8868\uff0c\u7136\u540e\u6bcf\u626b\u8fc7\u4e00\u884c\u5c31\u5c06\u8fd9\u4e00\u884c\u4e2d\u7684\u6807\u8bb0\u70b9\u4ece\u53cc\u5411\u94fe\u8868\u4e2d\u5220\u9664\u5373\u53ef\u3002\u590d\u6742\u5ea6 $n^2k$\u3002\n\n\u7ec6\u8282\u6709\u4ebf\u70b9\u70b9\u591a\uff0c\u5927\u7ea6\u4e5f\u5c31\u8c03\u4e86 2h \u7f62\uff08\uff08\uff08\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntypedef unsigned int u32;\ntypedef unsigned long long u64;\nnamespace fastio{\n\t#define FILE_SIZE 1<<23\n\tchar rbuf[FILE_SIZE],*p1=rbuf,*p2=rbuf,wbuf[FILE_SIZE],*p3=wbuf;\n\tinline char getc(){return p1==p2&&(p2=(p1=rbuf)+fread(rbuf,1,FILE_SIZE,stdin),p1==p2)?-1:*p1++;}\n\tinline void putc(char x){(*p3++=x);}\n\ttemplate<typename T> void read(T &x){\n\t\tx=0;char c=getchar();T neg=0;\n\t\twhile(!isdigit(c)) neg|=!(c^'-'),c=getchar();\n\t\twhile(isdigit(c)) x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\t\tif(neg) x=(~x)+1;\n\t}\n\ttemplate<typename T> void recursive_print(T x){if(!x) return;recursive_print(x/10);putc(x%10^48);}\n\ttemplate<typename T> void print(T x){if(!x) putc('0');if(x<0) putc('-'),x=~x+1;recursive_print(x);}\n\tvoid print_final(){fwrite(wbuf,1,p3-wbuf,stdout);}\n}\nconst int MAXN=3e3; \nint R,C,n,k,x[MAXN+5],y[MAXN+5];\nvector<int> vr[MAXN+5],vc[MAXN+5];\nint l[MAXN+5],r[MAXN+5];ll ans=0;\nint main(){\n\tscanf(\"%d%d%d%d\",&R,&C,&n,&k);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%d%d\",&x[i],&y[i]);\n\t\tvr[x[i]].pb(i);vc[y[i]].pb(i);\n\t}\n\tfor(int i=1;i<=MAXN;i++) sort(vr[i].begin(),vr[i].end(),[](int lhs,int rhs){return y[lhs]>y[rhs];});\n\tfor(int i=1;i<=MAXN;i++) sort(vc[i].begin(),vc[i].end(),[](int lhs,int rhs){return x[lhs]<x[rhs];});\n\tfor(int i=1;i<=R;i++){\n\t\tmemset(l,0,sizeof(l));memset(r,0,sizeof(r));\n\t\tint pre=0;\n\t\tfor(int j=1;j<=C;j++) for(int t=0;t<vc[j].size();t++)\n\t\t\tif(x[vc[j][t]]>=i){\n\t\t\t\tint id=vc[j][t];l[id]=pre;\n\t\t\t\tif(pre) r[pre]=id;pre=id;\n\t\t\t}\n\t\tll ret=0;\n\t\tfor(int j=1;j<=C;j++) for(int t=0;t<vc[j].size();t++)\n\t\t\tif(x[vc[j][t]]>=i){\n\t\t\t\tint id=vc[j][t],cur=id;\n\t\t\t\tfor(int stp=1;stp<k;stp++) cur=r[cur];\n//\t\t\t\tprintf(\"%d %d\\n\",id,cur);\n\t\t\t\tif(cur) ret+=1ll*(C-y[cur]+1)*(y[id]-y[l[id]]);\n\t\t\t}\n//\t\tprintf(\"%d %d %lld\\n\",i,R,ret);\n\t\tans+=ret;\n\t\tfor(int j=R;j>=i;j--){\n\t\t\tfor(int t=0;t<vr[j].size();t++){\n\t\t\t\tint id=vr[j][t];\n\t\t\t\tif(!r[id]){\n\t\t\t\t\tint cur=id;\n\t\t\t\t\tfor(int stp=1;stp<k;stp++) cur=l[cur];\n\t\t\t\t\tif(cur) ret-=1ll*(y[cur]-y[l[cur]])*(C-y[id]+1);\n\t\t\t\t\tif(r[id]) l[r[id]]=l[id];\n\t\t\t\t\tif(l[id]) r[l[id]]=r[id];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tint cr=r[id],cl=r[id],stp=0;\n\t\t\t\twhile(stp<k-1){if(!r[cr]) break;cr=r[cr];++stp;}\n\t\t\t\tfor(int o=1;o<=k-1-stp;o++) cl=l[cl];\n\t\t\t\tif(cl) ret-=1ll*(C-y[cr]+1)*(y[cl]-y[l[cl]]);\n\t\t\t\tfor(int o=1;o<=stp+1;o++){\n\t\t\t\t\tcr=l[cr];cl=l[cl];\n\t\t\t\t\tif(cl) ret-=1ll*(C-y[cr]+1)*(y[cl]-y[l[cl]]);\n\t\t\t\t}\n\t\t\t\tif(r[id]) l[r[id]]=l[id];\n\t\t\t\tif(l[id]) r[l[id]]=r[id];\n\t\t\t\tif(!r[id]) continue;\n\t\t\t\tcr=r[id],cl=r[id],stp=0;\n\t\t\t\twhile(stp<k-1){if(!r[cr]) break;cr=r[cr];++stp;}\n\t\t\t\tfor(int o=1;o<=k-1-stp;o++) cl=l[cl];\n\t\t\t\tif(cl) ret+=1ll*(C-y[cr]+1)*(y[cl]-y[l[cl]]);\n\t\t\t\tfor(int o=1;o<=stp;o++){\n\t\t\t\t\tcr=l[cr];cl=l[cl];\n\t\t\t\t\tif(cl) ret+=1ll*(C-y[cr]+1)*(y[cl]-y[l[cl]]);\n\t\t\t\t}\n\t\t\t} ans+=ret;\n//\t\t\tprintf(\"%d %d %lld\\n\",i,j-1,ret);\n\t\t}\n\t} printf(\"%lld\\n\",ans);\n\treturn 0;\n}\n/*\n10 10 10 4\n7 9\n8 1\n5 7\n6 8\n6 4\n5 8\n4 3\n1 3\n5 1\n6 9\n\n4 4 3 1\n1 3\n2 2\n3 4\n\n5 5 5 2\n1 2\n1 5\n3 4\n4 3\n5 2\n*/\n```\n\n",
        "postTime": 1615565237,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF627E\u3010Orchestra\u3011"
    },
    {
        "content": "\u9996\u5148\u6709\u4e00\u4e2a $O(r^3)$ \u7684\u505a\u6cd5\uff0c\u76f4\u63a5\u679a\u4e3e\u4e0a\u4e0b\u8fb9\u754c\uff0c\u7136\u540e\u4ece\u5de6\u5230\u53f3\u679a\u4e3e\u53f3\u8fb9\u754c\uff0c\u663e\u7136\u6ee1\u8db3\u6761\u4ef6\u7684\u5de6\u8fb9\u754c\u662f\u4e00\u4e2a\u524d\u7f00\u800c\u4e14\u8fd9\u4e2a\u524d\u7f00\u7684\u957f\u5ea6\u5355\u8c03\u589e\uff0c\u6240\u4ee5 two-pointer \u5373\u53ef\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u4e0a\u9762\u8fd9\u4e2a\u65b9\u6cd5\u5b8c\u5168\u6ca1\u6709\u5229\u7528 $n$ \u8f83\u5c0f\u800c\u4e14 $k$ \u5f88\u5c0f\u7684\u6027\u8d28\uff0c\u8003\u8651\u4e00\u4e0b\u600e\u4e48\u5229\u7528\u3002\n\n\u9996\u5148\u5f53\u4e0b\u8fb9\u754c\u79fb\u52a8\u65f6\u6211\u4eec\u76f4\u63a5\u91cd\u65b0\u5904\u7406\u662f\u4e00\u4ef6\u5f88\u6d6a\u8d39\u7684\u4e8b\u60c5\u3002\u4e0b\u8fb9\u754c\u7684\u5411\u4e0a\u79fb\u52a8\u4f1a\u5220\u6389\u4e00\u884c\u4e0a\u7684\u5173\u952e\u70b9\uff0c\u8fd9\u662f\u7b2c\u4e00\u4e2a\u63d0\u793a\u3002\n\n\u91cd\u65b0\u89c2\u5bdf\u53f3\u8fb9\u754c\u3002\u5bf9\u4e8e\u4e00\u4e2a\u53f3\u8fb9\u754c\uff0c\u5982\u679c\u5173\u952e\u70b9 $(x,y)$ \u521a\u597d\u662f\u5b83\u4ece\u53f3\u5f80\u5de6\u7684\u7b2c $k$ \u4e2a\u5173\u952e\u70b9\uff0c\u90a3\u4e48\u5b83\u7684\u8d21\u732e\u5c31\u662f $y$\u3002\u5bf9\u4e8e\u4e00\u4e2a\u5173\u952e\u70b9\u6211\u4eec\u8003\u8651\u7ef4\u62a4 $cnt_i$ \uff0c\u5373\u4ee5\u5b83\u4e3a\u7b2c $k$ \u4e2a\u5173\u952e\u70b9\u7684\u53f3\u8fb9\u754c\u6570\u76ee\uff0c\u8fd9\u4e2a\u5173\u952e\u70b9\u7684\u8d21\u732e\u662f $y_icnt_i$\u3002\u90a3\u4e48\u73b0\u5728\u590d\u6742\u5ea6\u5c31\u4e0e $n,k$ \u6709\u5173\u4e86\u3002\u8fd9\u662f\u7b2c\u4e8c\u4e2a\u63d0\u793a\u3002\n\n\u7efc\u5408\u4e0a\u9762\u4e24\u4e2a\u63d0\u793a\uff0c\u5f53\u4e00\u4e2a\u5173\u952e\u70b9\u88ab\u5220\u9664\uff0c\u5b83\u7684 $cnt$ \u4f1a\u8f6c\u79fb\u5230\u5b83\u5de6\u8fb9\u7684\u7b2c\u4e00\u4e2a\u5173\u952e\u70b9\uff0c\u5b83\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5173\u952e\u70b9\u7684 $cnt$ \u4f1a\u8f6c\u79fb\u5230\u5b83\u5de6\u8fb9\u7684\u7b2c\u4e8c\u4e2a\u5173\u952e\u70b9\u2026\u2026\u5171\u8f6c\u79fb\u4e86 $k$ \u4e2a\u3002\u7528\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u5373\u53ef $O(k)$ \u5220\u70b9\u3002\u4e8e\u662f\u5c31\u505a\u5230\u4e86 $O(r^2+rnk)$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nint R,C,N,K;\nstruct Node{\n\tint x,y;\n\tbool operator<(const Node b)const{\n\t\treturn y<b.y||(y==b.y&&x<b.x);\n\t}\n}A[3005],B[3005];\nint l[3005],r[3005],len;\nint cnt[3005];\nlong long ANS;\nlong long tmp=0;\nvector<int> G[3005];\n\nvoid DFS(int x,int k){\n\ttmp-=B[x].y*cnt[x];\n\ttmp+=B[l[x]].y*cnt[x];\n\tif(l[x]&&k>1) DFS(l[x],k-1);\n\tif(l[x]) cnt[l[x]]+=cnt[x];\n\tcnt[x]=0;\n}\nvoid debug(int u,int v){\n\tprintf(\"[%d,%d] :\\n\",u,v);\n\tfor(int i=1;i<=len;i++) printf(\"%d \",cnt[i]);printf(\"\\n\");\n}\n\nint main(){\n\tscanf(\"%d%d%d%d\",&R,&C,&N,&K);\n\tfor(int i=1;i<=N;i++) scanf(\"%d%d\",&A[i].x,&A[i].y);\n\tsort(A+1,A+N+1);\n\tfor(int u=1;u<=R;u++){\n\t\tint v=R;\n\t\tlen=0;\n\t\tfor(int i=1;i<=R;i++) G[i].clear();\n\t\tfor(int i=1;i<=N;i++) if(A[i].x>=u)\n\t\t\tB[++len]=A[i],\n\t\t\tl[len]=len-1,\n\t\t\tr[len]=len+1,\n\t\t\tcnt[len]=0,\n\t\t\tG[B[len].x].push_back(len);\n\t\ttmp=0;\n\t\tfor(int i=1,j=0;i<=C;i++){\n\t\t\twhile(j+1<=len&&B[j+1].y<=i) j++;\n\t\t\tif(j-K+1>0) cnt[j-K+1]++,tmp+=B[j-K+1].y;\n\t\t}\n\t\tANS+=tmp;\n//\t\tdebug(u,v);\n\t\twhile(v>u){\n\t\t\tfor(int i=0;i<G[v].size();i++){\n\t\t\t\tint c=G[v][i];\n\t\t\t\tDFS(c,K);\n\t\t\t\tr[l[c]]=r[c],l[r[c]]=l[c];\n\t\t\t}\n\t\t\tANS+=tmp;\n\t\t\tv--;\n//\t\t\tdebug(u,v);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ANS);\n}\n```",
        "postTime": 1594091053,
        "uid": 58567,
        "name": "x\u4e49x",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF627E \u3010Orchestra\u3011"
    }
]