[
    {
        "content": "~~\u5b66\u4e60\u4e86\u697c\u4e0a\uff0c\u697c\u4e0a\u8bb2\u7684\u5f88\u597d\u4e86\uff0c\u4e0d\u8fc7\u6211\u66f4\u559c\u6b22\u7ebf\u6bb5\u6811\u642d\u6811\u72b6\u6570\u7ec4\uff0c\u7528\u7ebf\u6bb5\u6811\u548c\u6811\u72b6\u6570\u7ec4\u5199\u4e86\u4e00\u904d\uff0c\u7ed9\u6709\u9700\u8981\u7684\u540c\u5b66\u51c6\u5907\u7684\u3002~~\n\n# Problem\n\u7ed9\u5b9a\u6570\u5217 $\\{a\\}$ $\\{w\\}$\uff0c\u8868\u793a\u7b2c $i$ \u7684\u70b9\u7684\u4f4d\u7f6e $a_i$\uff0c\u6743\u503c $w_i$\uff0c\u5b9e\u73b0\u4e24\u79cd\u64cd\u4f5c\uff1a\n\n- \u7ed9\u51fa $i$\uff0c$x$\uff0c\u5355\u70b9\u4fee\u6539 $w_i=x$\u3002\n- \u7ed9\u51fa $l$\uff0c$r$\uff0c\u67e5\u8be2 $min_{x=1}^n\\{\\sum_{i=l}^rw_i*(|a_x-a_i|+|x-i|)\\}$\u3002\n\n# Solution\n### \u8f6c\u5316\u9898\u610f\n\u770b\u5230\u4f7f\u540e\u9762\u7684 $\\sum_{i=l}^rw_i*(|a_x-a_i|+...)$ \u6700\u5c0f\uff0c\u4e8e\u662f\u60f3\u5230\u662f\u6c42 $l$ \u5230 $r$ \u7684[**\u5e26\u6743\u4e2d\u4f4d\u6570**](https://baike.baidu.com/item/%E5%B8%A6%E6%9D%83%E4%B8%AD%E4%BD%8D%E6%95%B0/8517609)\uff0c\u5e76\u652f\u6301\u4fee\u6539(\u7701\u7565\u7684\u90e8\u5206\u5f88\u597d\u7ef4\u62a4)\u3002\n\n\u7ed3\u5408\u5e26\u6743\u4e2d\u4f4d\u6570\u7684\u76f8\u5173\u77e5\u8bc6\uff08\u5373\u6070\u597d\u6ee1\u8db3 $\\sum_{i=1}^xw_i\\ge\\sum_{i=x+1}^nw_i$ \u7684\u6570 $x$\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u67e5\u627e $O(\\log n)$ \u5f97\u5230\u3002\n\n### \u8003\u8651\u5982\u4f55\u7ef4\u62a4\u6c42\u548c\n\n\u89c2\u5bdf\u5230\uff0c\u53bb\u6389\u7edd\u5bf9\u503c\u53ef\u4ee5\u62c6\u5206\u4e3a\n$$\\sum_{i=l}^x(w_i*(a_x-x)-w_i*(a_i-i))+\\sum_{i=x+1}^r(w_i*(a_i-i)-w_i*(a_x-x))$$\n\u8fdb\u4e00\u6b65\uff0c\u5de6\u8fb9\uff1a\n$$(\\sum_{i=l}^xw_i)* \\sum_{i=l}^x(a_x-x)-\\sum_{i=l}^xw_i*(a_i-i)$$\n\u53f3\u8fb9\uff1a\n$$\\sum_{i=x+1}^rw_i*(a_i-i)-(\\sum_{i=x+1}^rw_i)* \\sum_{i=x+1}^r(a_x-x)$$\n\u4e8c\u8005\u4e4b\u548c\u5373\u662f\u7b54\u6848\u3002\n\n\u5f88\u5bb9\u6613\u5730\uff0c\u6211\u4eec\u53ef\u7528**\u7ebf\u6bb5\u6811/\u6811\u72b6\u6570\u7ec4**\u7ef4\u62a4\u51fa $\\sum w_i$ \u548c $\\sum(a_i-i)$\uff0c\u5feb\u4e50 A \u6389\u6b64\u9898\u3002\n\n### \u5b9e\u73b0\u7ec6\u8282\n\u67e5\u8be2\u5e26\u6743\u4e2d\u4f4d\u6570\u65f6\uff0c\u6211\u4eec\u4e0d\u80fd\u5bf9 $\\sum w_i$ \u53d6\u6a21\uff0c\u6b64\u65f6\u4e5f\u4e0d\u4f1a\u7206\u6389 long long\uff1b\n\n\u4f46\u5728\u6c42\u548c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u67e5\u8be2\u5230\u7684 $\\sum w_i$ \u53d6\u6a21\uff0c\u56e0\u4e3a\u5176\u8fd8\u4f1a\u4e58\u4e0a\u4e00\u4e2a\u8db3\u4ee5\u7206\u6389 long long \u7684\u6570\u3002\n\n### Code\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define mp make_pair\nusing namespace std;\nconst int SIZE = 2e5+10;\nconst int MOD = 1e9+7;\n\nint n,q,a[SIZE],w[SIZE];\nstruct BIT{//\u6811\u72b6\u6570\u7ec4\u5b9e\u73b0,\u533a\u95f4\u67e5\u8be2w_i\n    int t[SIZE];\n    void add(int x,int y){\n        for(;x<=n;x+=x&-x) t[x]+=y;\n    }\n    int ask(int x){\n        int tmpans=0;\n        for(;x;x-=x&-x) tmpans+=t[x];\n        return tmpans;\n    }\n    int qsum(int l,int r){\n        return ask(r)-ask(l-1);\n    }\n}tr;\nstruct ST{//\u7ebf\u6bb5\u6811\u5b9e\u73b0,\u533a\u95f4\n    int t[4*SIZE];//w_i*a_i\u7684\u548c\n    void build(int p=1,int l=1,int r=n){\n        if(l==r){t[p]=w[l]*(a[l]-l);return ;}\n        int mid=(l+r)>>1;\n        build(p<<1,l,mid),build(p<<1|1,mid+1,r);\n        t[p]=(t[p<<1]+t[p<<1|1])%MOD;\n    }\n    void add(int cp,int val,int p=1,int l=1,int r=n){//\u5355\u70b9\u4fee\u6539\n        if(l==r){t[p]=val*(a[l]-l);return ;}\n        int mid=(l+r)>>1;\n        if(cp<=mid) add(cp,val,p<<1,l,mid);\n        else add(cp,val,p<<1|1,mid+1,r);\n        t[p]=(t[p<<1]+t[p<<1|1])%MOD;\n    }\n    int qsum(int cl,int cr,int p=1,int l=1,int r=n){//\u67e5\u8be2sum2\u533a\u95f4\u548c\n        if(cl<=l&&cr>=r) return t[p];\n        int mid=(l+r)>>1,tmpans;\n        if(cl<=mid) tmpans=qsum(cl,cr,p<<1,l,mid);\n        else tmpans=0;\n        if(cr>mid) tmpans=(tmpans+qsum(cl,cr,p<<1|1,mid+1,r))%MOD;\n        return tmpans;\n    }\n}t;\n\nint Binary_search(int l,int r,int ll,int rr){//\u4e8c\u5206\u67e5\u627e \u5e26\u6743\u4e2d\u4f4d\u6570\n    int tmpans;\n    while(l<=r){\n        int mid=(l+r)>>1;\n        if(tr.qsum(ll,mid)>=tr.qsum(mid+1,rr)) r=mid-1,tmpans=mid;\n        else l=mid+1;\n    }\n    return tmpans;\n}\n\nvoid query(int l,int r){\n    int pos=Binary_search(l,r,l,r),tmpans=0;\n    tmpans=(tr.qsum(l,pos)%MOD*(a[pos]-pos)-t.qsum(l,pos))%MOD;//\u5957\u7528\u63a8\u51fa\u6765\u7684\u516c\u5f0f\u5373\u53ef\n    tmpans=((tmpans+t.qsum(pos+1,r)-tr.qsum(pos+1,r)%MOD*(a[pos]-pos))%MOD+MOD)%MOD;\n    cout<<tmpans<<\"\\n\";\n}\n\nsigned main(){\n    ios::sync_with_stdio(false);\n    cin>>n>>q;\n    for(int i=1;i<=n;++i) cin>>a[i];\n    for(int i=1;i<=n;++i){cin>>w[i];tr.add(i,w[i]);}\n    t.build();\n    while(q--){\n        int x,y;cin>>x>>y;\n        if(x<0){\n            t.add(-x,y);\n            int tmp=tr.qsum(-x,-x);//\u6811\u72b6\u6570\u7ec4\u5b9e\u73b0\u5355\u70b9\u4fee\u6539\n            tr.add(-x,-tmp),tr.add(-x,y);\n        }\n        else query(x,y);\n    }\n    return 0;\n}\n```",
        "postTime": 1634562793,
        "uid": 440100,
        "name": "DNWy",
        "ccfLevel": 0,
        "title": "CF1030F Putting Boxes Together"
    },
    {
        "content": "\u5b66\u4e60\u4e86->[\u8fd9\u91cc](https://www.cnblogs.com/CzxingcHen/p/9694955.html#4085514)\n\n\u5148\u6765\u8003\u8651\u4e00\u4e0b\u8d27\u4ed3\u9009\u5740\u95ee\u9898\uff0c\u5c31\u662f\u4e00\u5806\u4e0d\u5e26\u6743\u503c\u7684\u6570\uff0c\u9009\u51fa\u4e00\u4e2a\u70b9\u4f7f\u5f97\u6240\u6709\u70b9\u5230\u4ed6\u7684\u8ddd\u79bb\u4e4b\u548c\u6700\u5c0f\uff0c\u90a3\u4e48\u80af\u5b9a\u662f\u9009\u4e2d\u4f4d\u6570\u6700\u4f18\n\n\u7136\u540e\u52a0\u4e0a\u6743\u503c\u9650\u5236\uff0c\u8fd9\u73a9\u610f\u513f\u6709\u4e2a\u5b66\u540d\u53eb\u505a\u5e26\u6743\u4e2d\u4f4d\u6570\n\n\u5e26\u6743\u4e2d\u4f4d\u6570\u4e3a\u6ee1\u8db3$\\sum_{i=1}^x w_i\\geq \\sum_{i=x+1}^n w_i$\u7684\u6700\u5927\u7684$x$\n\n\u7b80\u5355\u8bc1\uff08kou\uff09\u660e\uff08hu\uff09\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u662f\u5bf9\u7684\uff0c\u5047\u8bbe\u5c06\u533a\u95f4\u5185\u7684\u6240\u6709\u6570\u79fb\u5230$x+1$\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48$[1,x]$\u5185\u7684\u6570\u5168\u90fd\u8981\u591a\u8d70$dis[x,x+1]$\u7684\u8def\u7a0b\uff0c\u800c$[x+1,n]$\u5185\u7684\u6570\u53ef\u4ee5\u5c11\u8d70\u8fd9\u4e48\u591a\u8def\u7a0b\uff0c\u90a3\u4e48\u603b\u6743\u503c\u7684\u53d8\u5316\u91cf\u5c31\u4e3a$dis[x,x+1]*(sum_{i=1}^x w_i-\\sum_{i=x+1}^n w_i)$\uff0c\u53ef\u4ee5\u53d1\u73b0\u82e5\u4e0a\u9762\u90a3\u4e2a\u4e0d\u7b49\u5f0f\u4e0d\u6210\u7acb\u5219\u5f80\u53f3\u79fb\u603b\u6743\u503c\u53d8\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u7b54\u6848\u4f1a\u66f4\u4f18\uff0c\u6240\u4ee5\u53ea\u6709\u5f53\u4e0a\u9762\u90a3\u4e2a\u7b49\u5f0f\u6210\u7acb\u65f6\u624d\u4e0d\u4f1a\u5f80\u53f3\u79fb\u66f4\u4f18\u3002\u53c8\u56e0\u4e3a\u8fd9\u73a9\u610f\u513f\u662f\u4ece\u5de6\u8fb9\u79fb\u8fc7\u6765\u7684\uff0c\u6240\u4ee5\u5de6\u8fb9\u7684\u90fd\u6bd4\u4ed6\u52a3\u3002\u90a3\u4e48\u5b83\u4e00\u5b9a\u662f\u6700\u4f18\u7684\u3002\n\n\u4e8e\u662f\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\n\n\u7136\u540e\u6211\u4eec\u6765\u8003\u8651\u4e00\u4e0b\u539f\u95ee\u9898\uff0c\u53d1\u73b0\u6240\u6709\u7684\u79fb\u52a8\u65b9\u6848\u90fd\u53ef\u4ee5\u7b49\u4ef7\u4e8e\u56fa\u5b9a\u4e00\u4e2a\u70b9\u4e0d\u52a8\uff0c\u5176\u4ed6\u7684\u70b9\u5411\u5b83\u9760\u3002\u90a3\u4e48\u6211\u4eec\u8bbe$pos$\u4e3a\u6700\u4f18\u7684\u70b9\uff0c\u7136\u540e\u7528\u548c\u4e0a\u9762\u7684\u65b9\u6cd5\u4e00\u6837\u8003\u8651\u53ef\u4ee5\u53d1\u73b0\u5f53$pos$\u4e3a\u5e26\u6743\u4e2d\u4f4d\u6570\u65f6\u7b54\u6848\u6700\u4f18\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4e8c\u5206\u51fa$pos$\n\n\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u5feb\u901f\u8ba1\u7b97\u603b\u4ee3\u4ef7\u4e86\uff0c\u5373$\\sum_{i=l}^{pos-1}w_i*(a_{pos}-a_i-(pos-i))+\\sum_{i=pos+1}^{r}w_i*(a_{i}-a_{pos}-(i-pos))$\n\n\u8003\u8651\u5de6\u8fb9\u8fd9\u4e00\u5768\uff08\u53f3\u8fb9\u540c\u7406\uff09\uff0c\u5316\u4e00\u4e0b\u5f0f\u5b50\u53ef\u5f97\u5b83\u7b49\u4e8e$$\\sum_{i=l}^{pos-1}w_i*(a_{pos}-pos-(a_i-i))$$\n\n\u7136\u540e\u53f3\u8fb9\u4e5f\u662f\u5dee\u4e0d\u591a\u7684\u5f62\u5f0f\uff0c\u4e8e\u662f\u53ea\u8981\u7ef4\u62a4$\\sum w_i$\u548c$\\sum w_i*(a_i-i)$\u5c31\u80fd\u5feb\u901f\u7b97\u51fa\u7b54\u6848\u4e86\n\n\u4e8e\u662f\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u8fd9\u4e24\u4e2a\u73a9\u610f\u513f\uff0c\u7136\u540e\u4e8c\u5206\u627e\u51fa\u5e26\u6743\u4e2d\u4f4d\u6570\uff0c\u6bcf\u4e00\u6b21\u5feb\u901f\u8ba1\u7b97\u7b54\u6848\u5373\u53ef\n```\n//minamoto\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#define ll long long\nusing namespace std;\n#define getc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){\n    #define num ch-'0'\n    char ch;bool flag=0;int res;\n    while(!isdigit(ch=getc()))\n    (ch=='-')&&(flag=true);\n    for(res=num;isdigit(ch=getc());res=res*10+num);\n    (flag)&&(res=-res);\n    #undef num\n    return res;\n}\nchar sr[1<<21],z[20];int C=-1,Z;\ninline void Ot(){fwrite(sr,1,C+1,stdout),C=-1;}\ninline void print(int x){\n    if(C>1<<20)Ot();if(x<0)sr[++C]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++C]=z[Z],--Z);sr[++C]='\\n';\n}\nconst int N=2e5+5;const ll P=1e9+7;\nint n,q;ll a[N],w[N];\nnamespace SUM{\n    ll c[N];\n    inline void add(int x,ll y){\n        for(;x<=n;x+=x&-x) c[x]+=y;\n    }\n    inline ll que(int x){\n        ll res=0;\n        for(;x;x-=x&-x) res+=c[x];\n        return res;\n    }\n    inline ll query(int l,int r){\n        if(r<l) return 0;\n        return que(r)-que(l-1);\n    }\n}\nnamespace MUL{\n    ll c[N];\n    inline void add(int x,ll y){\n        y%=P;\n        for(;x<=n;x+=x&-x)\n        (c[x]+=y+P)%=P;\n    }\n    inline ll que(int x){\n        ll res=0;\n        for(;x;x-=x&-x) (res+=c[x])%=P;\n        return res;\n    }\n    inline ll query(int l,int r){\n        if(r<l) return 0;\n        return (que(r)-que(l-1)+P)%P;\n    }\n}\ninline int getpos(int ql,int qr){\n    int l=ql,r=qr,mid,res;\n    while(l<=r){\n        mid=(l+r)>>1;\n        if(SUM::query(ql,mid)>=SUM::query(mid+1,qr)) res=mid,r=mid-1;\n        else l=mid+1;\n    }\n    return res;\n}\nvoid solve(int l,int r){\n    if(l==r) return (void)(print(0));\n    int pos=getpos(l,r);ll res=0;\n    res=(-MUL::query(l,pos)+(SUM::query(l,pos) % P)*(a[pos] - pos)%P+P)%P;\n    res=(res+MUL::query(pos,r)-SUM::query(pos,r)%P*(a[pos]-pos)%P+P)%P;\n    print(res);\n}\nint main(){\n//    freopen(\"testdata.in\",\"r\",stdin);\n    n=read(),q=read();\n    for(int i=1;i<=n;++i) a[i]=read();\n    for(int i=1;i<=n;++i){\n        w[i]=read(),SUM::add(i,w[i]),MUL::add(i,w[i]*(a[i]-i));\n    }\n    while(q--){\n        int x=read(),y=read();\n        if(x<0){\n            x=-x,SUM::add(x,-w[x]),MUL::add(x,-w[x]*(a[x]-x));\n            w[x]=y,SUM::add(x,y),MUL::add(x,y*(a[x]-x));\n        }else solve(x,y);\n    }\n    Ot();\n    return 0;\n}\n```",
        "postTime": 1539166790,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1030F \u3010Putting Boxes Together\u3011"
    },
    {
        "content": "\u5b66\u4e60\u4e86\u697c\u4e0a\uff0c\u697c\u4e0a\u8bb2\u7684\u5f88\u597d\u4e86\uff0c\u4e0d\u8fc7\u6211\u66f4\u559c\u6b22\u7ebf\u6bb5\u6811\uff0c\u7528\u7ebf\u6bb5\u6811\u5199\u4e86\u4e00\u904d\uff0c\u7ed9\u6709\u9700\u8981\u7684\u540c\u5b66\u51c6\u5907\u7684\n```cpp\n#include<bits/stdc++.h>\n#define re register\n#define ll long long\nconst int N=2e5+5;\nconst int mod=1000000007;\nusing namespace std;\ntemplate<class T>\ninline void read(T &x)\n{\n    x=0; int f=1;\n    static char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-') f=-1; ch=getchar();}\n    while(isdigit(ch)) x=x*10+ch-'0',ch=getchar();\n    x*=f;\n}\ninline void write(ll x)\n{\n    if(x<0) {x=-x; putchar('-');}\n    if(x>9) write(x/10);\n    putchar(x%10+'0'); \n}\nint n,Q;\nll a[N],w[N],b[N];\nstruct Tree\n{\n    int l,r;\n    ll sum,s;\n}tree[4*N];\ninline void pushup(int now)\n{\n    tree[now].sum=tree[now<<1].sum+tree[now<<1|1].sum;\n    tree[now].s=(tree[now<<1].s+tree[now<<1|1].s)%mod;\n}\ninline void build(int now,int l,int r)\n{\n    tree[now].l=l,tree[now].r=r;\n    if(l==r)\n    {\n        tree[now].sum=w[l];\n        tree[now].s=b[l]*w[l]%mod;\n        return;\n    }\n    int m=(l+r)>>1;\n    build(now<<1,l,m);\n    build(now<<1|1,m+1,r);\n    pushup(now);\n}\ninline ll query(int now,int l,int r)\n{\n    if(l<=tree[now].l&&tree[now].r<=r) return tree[now].sum;\n    int m=(tree[now].l+tree[now].r)>>1; ll ans=0;\n    if(l<=m) ans+=query(now<<1,l,r);\n    if(r>m) ans+=query(now<<1|1,l,r);\n    return ans;\n}\ninline void update(int now,int pos,int x)\n{\n    if(tree[now].l==tree[now].r)\n    {\n        tree[now].sum=x;\n        tree[now].s=b[pos]*x%mod;\n        return;\n    }\n    int m=(tree[now].l+tree[now].r)>>1;\n    if(pos<=m) update(now<<1,pos,x);\n    else update(now<<1|1,pos,x);\n    pushup(now);\n}\ninline ll ask(int now,int l,int r)\n{\n    if(l<=tree[now].l&&tree[now].r<=r)\treturn tree[now].s;\n    int m=(tree[now].l+tree[now].r)>>1; ll ans=0;\n    if(l<=m) ans=(ans+ask(now<<1,l,r))%mod;\n    if(r>m) ans=(ans+ask(now<<1|1,l,r))%mod;\n    return ans;\t\n}\ninline void Solve(int l,int r)\n{\n    int L=l,R=r,ans=l;\n    while(L<=R)\n    {\n        int mid=(L+R)>>1;\n        ll QL=query(1,l,mid),QR=query(1,mid+1,r);\n        if(QL>=QR) ans=mid,R=mid-1;\n        else L=mid+1;\n    }\n    ll t1=(query(1,l,ans-1)%mod*(a[ans]-ans)%mod-ask(1,l,ans-1)+mod)%mod;\n    ll t2=(query(1,ans+1,r)%mod*(ans-a[ans]+mod)%mod+ask(1,ans+1,r)%mod)%mod;\n\twrite((t1+t2)%mod);\n\tputchar('\\n');\n} \nint main()\n{\n    read(n),read(Q);\n    for(int i=1;i<=n;i++) read(a[i]),b[i]=a[i]-i;\n    for(int i=1;i<=n;i++) read(w[i]);\n    build(1,1,n);\n    int l,r;\n    while(Q--)\n    {\n        read(l),read(r);\n        if(l<0) update(1,-l,r);\n        if(l>0)\tSolve(l,r);\n    }\n    return 0;\n} \n\n```",
        "postTime": 1549288915,
        "uid": 60299,
        "name": "Patrickpwq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1030F \u3010Putting Boxes Together\u3011"
    }
]