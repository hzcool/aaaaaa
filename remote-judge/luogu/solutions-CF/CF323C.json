[
    {
        "content": "###### \u849f\u84bb\u6e23\u6e23\u79b9\u5c0f\u5fc3\u7ffc\u7ffc\u53d1\u5e03\u9898\u89e3qwq\n\u82f1\u6587\u9898\u76ee\u6b38\u3002\u3002\u3002\u6765\u6211\u7ed9\u5927\u5bb6\u7b80\u5355\u7c97\u66b4\u7684\u7ffb\u8bd1\u4e00\u4e0b\u9898\u76ee\uff1a\n\n\u7ed9\u4f60\u4e24\u4e2a\u957f\u5ea6\u4e3an\u76841\u2212n\u6392\u5217\uff0c\u591a\u6b21\u8be2\u95ee\u5728\u7b2c\u4e00\u4e2a\u6392\u5217\u7684[l1,r1]\u548c\u7b2c\u4e8c\u4e2a\u6392\u5217\u7684[l2,r2]\u540c\u65f6\u51fa\u73b0\u7684\u6570\u6709\u591a\u5c11\u4e2a\u3002\n\n\u7136\u800c\u8fd9\u9898\u7ffb\u8bd1\u8fc7\u6765\u4e00\u770b\u3002\u3002\u3002\u3002\u597d\u50cf\u6709\u70b9\u6c34qwq\n\n\u628a\u7b2c\u4e8c\u4e2a\u6392\u5217\u7684\u6570\u5728\u7b2c\u4e00\u4e2a\u6392\u5217\u4e2d\u5bf9\u5e94\u7684\u4f4d\u7f6e\u8bb0\u4e00\u4e0b\uff0c\u4e3b\u5e2d\u6811\u8dd1\u4e00\u8dd1\u5c31\u884c\u4e86\u3002\n\n\u7136\u800c\u4e8b\u5b9e\u786e\u5b9e\u5982\u6b64qwq\uff0c\u4e0b\u9762\u9644\u4e0a\u4e3b\u5e2d\u6811\u7684\u4ee3\u7801qwq\uff1a\n\n~~\u5404\u4f4d\u8bc4\u5206\u7684\u65f6\u5019\u8bb0\u5f97\u8bc4\u4e2a\u9ed1\u9898qwq\u3002\u3002\u3002\u3002\u6211\u554a\u597d\u4e0d\u5bb9\u6613\u628a\u5b83\u4ece\u6682\u65e0\u8bc4\u5b9a\u8bc4\u6210\u9ed1\u9898qwq\u3002\u3002\u3002\u3002~~\n\n\u5404\u4f4d\u5927\u4f6c\u70b9\u4e2a\u8d5e\u518d\u8d70\u5457qwq\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#define gc getchar()\n#define mid (l + r >> 1)\n#define N 2000005\n#define M 40000005\nusing namespace std;\nint ln[M],rn[M],sum[M],root[N];\nint n,a[N],pos[N],q,ans,cnt;\nint read()\n{\n    int x = 1;\n    char ch;\n    while (ch = gc,ch < '0' || ch > '9') \n\t\tif (ch == '-') \n\t\t\tx = -1;\n    int s = ch-'0';\n    while (ch = gc,ch >= '0' && ch <= '9') \n\t\ts = s * 10 + ch - '0';\n    return s * x;\n}\nvoid ins(int &cur,int l,int r,int x,int last)\n{\n    cur = ++cnt;\n    ln[cur] = ln[last];\n    rn[cur] = rn[last];\n    sum[cur] = sum[last] + 1;\n    if (l == r) \n\t\treturn;\n    if (x <= mid) \n\t\tins(ln[cur],l,mid,x,ln[last]);\n    else ins(rn[cur],mid + 1,r,x,rn[last]);\n}\nint qry(int cur,int l,int r,int L,int R)\n{\n    if (L <= l && R >= r) \n\t\treturn sum[cur];\n    int ret = 0;\n    if (L <= mid) \n\t\tret += qry(ln[cur],l,mid,L,R);\n    if (R > mid) \n\t\tret += qry(rn[cur],mid + 1,r,L,R);\n    return ret;\n}\nint f(int x)\n{\n    return (x - 1 + ans) % n + 1;\n}\nint main()\n{\n    n = read();\n    for(int i = 1;i <= n;i++) \n\t\tpos[read()] = i;\n    for(int i = 1;i <= n;i++) \n\t\ta[i] = pos[read()];\n    for(int i = 1;i <= n;i++) \n\t\tins(root[i],1,n,a[i],root[i - 1]);\n    q = read();\n    while(q--)\n    {\n        int x = f(read()),y = f(read()),z = f(read()),w = f(read());\n        if (x > y) \n\t\t\tswap(x,y);\n        if (z > w) \n\t\t\tswap(z,w);\n        printf(\"%d\\n\",ans = qry(root[w],1,n,x,y) - qry(root[z - 1],1,n,x,y));\n        ans++;\n    }\n    return 0;\n}\n\n```",
        "postTime": 1550400202,
        "uid": 160811,
        "name": "\u4f18\u79c0\u7684\u6e23\u6e23\u79b9",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF323C \u3010Two permutations\u3011"
    },
    {
        "content": "[**\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c**](https://blog.henrytb.ml/2021/01/%E9%A2%98%E8%A7%A3-CF323C-Two-permutations/)\n\n\u8bdd\u8bf4\u8fd9\u9898\u600e\u4e48\u8bc4\u5230\u9ed1\u7684\uff1f\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u7b2c\u4e8c\u4e2a\u6392\u5217\u4e2d\u7684\u6570\u5728\u7b2c\u4e00\u4e2a\u6392\u5217\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\u90fd\u5904\u7406\u51fa\u6765\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u7b54\u6848\u5c31\u53d8\u6210\u4e86\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u4e2d $[l_2,r_2]$ \u8fd9\u4e2a\u533a\u95f4\u5185\uff0c\u5728\u7b2c\u4e00\u4e2a\u5e8f\u5217\u4e2d\u4f4d\u7f6e\u5904\u4e8e $[l_1,r_1]$ \u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u6211\u4eec\u4ee5\u7b2c\u4e8c\u4e2a\u6392\u5217\u7684\u4e0b\u6807\u4e3a\u7248\u672c\uff0c\u4ee5\u5bf9\u5e94\u7684\u7b2c\u4e00\u4e2a\u6392\u5217\u4e2d\u7684\u4f4d\u7f6e\u4e3a\u4e0b\u6807\u5efa\u7acb\u4e00\u68f5\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u3002\n\n\u5177\u4f53\u5c31\u662f\u626b\u4e00\u904d\u8fd9\u4e2a\u5e8f\u5217\uff0c\u5bf9\u4e8e\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u90fd\u5728\u524d\u4e00\u4e2a\u6570\u7684\u57fa\u7840\u4e0a\u65b0\u5efa\u4e00\u4e2a\u7248\u672c\uff0c\u4ee5\u8fd9\u4e2a\u6570\u4e3a\u4e0b\u6807\u5728\u8fd9\u4e2a\u7248\u672c\u4e0a $+1$\u3002\u7136\u540e\u7b54\u6848\u5c31\u662f\u7248\u672c $r_2$ \u4e0e\u7248\u672c $l_2-1$ \u4e2d\u8be2\u95ee $[l_1,r_1]$ \u8fd9\u4e24\u4e2a\u533a\u95f4\u7684\u533a\u95f4\u548c\u505a\u5dee\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define per(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\nconst int N=1e6+5;\nint n,a[N],b[N],tmp[N],m;\nstruct Segment{\n    int val,ls,rs;\n}t[N*32];\nint rt[N];\nint lst=0;\nint tot=0;\nint f(int x) {\n    return (x+lst-1)%n+1;\n}\nvoid modify(int &p,int q,int l,int r,int val) {\n    p=++tot;\n    t[p].ls=t[q].ls;\n    t[p].rs=t[q].rs;\n    t[p].val=t[q].val+1;\n    if(l==r) return ;\n    int mid=(l+r)>>1;\n    if(val<=mid) modify(t[p].ls,t[q].ls,l,mid,val);\n    else modify(t[p].rs,t[q].rs,mid+1,r,val);\n}\nint query(int p,int l,int r,int ql,int qr) {\n    if(ql<=l&&r<=qr) return t[p].val;\n    int mid=(l+r)>>1,ans=0;\n    if(ql<=mid) ans+=query(t[p].ls,l,mid,ql,qr);\n    if(mid<qr) ans+=query(t[p].rs,mid+1,r,ql,qr);\n    return ans;\n}\nint main() {\n    scanf(\"%d\",&n);\n    rep(i,1,n) {\n        scanf(\"%d\",&a[i]);\n        tmp[a[i]]=i;\n    }\n    rep(i,1,n) {\n        scanf(\"%d\",&b[i]);\n        a[i]=tmp[b[i]];\n        modify(rt[i],rt[i-1],1,n,a[i]);\n    }\n    scanf(\"%d\",&m);\n    rep(i,1,m) {\n        int l1,l2,r1,r2;\n        scanf(\"%d%d%d%d\",&l1,&r1,&l2,&r2);\n        l1=f(l1),l2=f(l2),r1=f(r1),r2=f(r2);\n        if(l1>r1) swap(l1,r1);\n        if(l2>r2) swap(l2,r2);\n        lst=query(rt[r2],1,n,l1,r1)-query(rt[l2-1],1,n,l1,r1);\n        printf(\"%d\\n\",lst);\n        ++lst;\n    }\n    return 0;\n}\n```",
        "postTime": 1611828580,
        "uid": 76156,
        "name": "henrytb",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF323C \u3010Two permutations\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u4f60\u4e24\u4e2a\u957f\u5ea6\u4e3an\u7684\u6392\u5217\uff0c\u591a\u6b21\u8be2\u95ee\u5728\u7b2c\u4e00\u4e2a\u6392\u5217\u7684[l1,r1]\u548c\u7b2c\u4e8c\u4e2a\u6392\u5217\u7684[l2,r2]\u540c\u65f6\u51fa\u73b0\u7684\u6570\u6709\u591a\u5c11\u4e2a\u3002\n\n\u5f3a\u5236\u5728\u7ebf\uff0c\u5177\u4f53\u5728\u9898\u91cc\u6709\n\n\u9898\u89e3\uff1a\n\t\u6211\u4eec\u8003\u8651\u4ee5\u4e0b\u6570\u7ec4\uff1a\u8bb0\u5f55b\u4e2d\u7b2ci\u4e2a\u6570\u5728a\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u7528\u4e3b\u5e2d\u6811\u7ef4\u62a4\u8fd9\u4e2a\u6570\u7ec4\u3002\u90a3\u4e48\u95ee\u9898\u4fbf\u8f6c\u5316\u4e3a\uff1a\u6c42l2-r2\u5185\u6709\u591a\u5c11\u4e2a\u6570\u7684\u503c\u5728[l1,r1]\u4e4b\u95f4\n    \n\u8fd9\u4e2a\u95ee\u9898\u5c31\u53ef\u4ee5\u7528\u4e3b\u5e2d\u6811\u89e3\u51b3\u5566\uff01\u5177\u4f53\u7684\uff0c\u6211\u4eec\u7528\u7b2cr1\u6b21\u7684\u7b54\u6848\u51cf\u53bb\u7b2c(l1 - 1)\u6b21\u7684\u7b54\u6848\u5c31ok\u4e86\n\n```\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ninline int read()\n{\n\tint ans = 0,op = 1;\n\tchar ch = getchar();\n\twhile(ch < '0' || ch > '9')\n\t{\n\t\tif(ch == '-') op = -1;\n\t\tch = getchar();\n\t}\n\twhile(ch >= '0' && ch <= '9')\n\t{\n\t\t(ans *= 10) += ch - '0';\n\t\t ch = getchar();\n\t}\n\treturn ans * op;\n}\nconst int maxn = 1e6 + 5;\nint a[maxn],b[maxn];\nint sum[maxn << 5],ls[maxn << 5],rs[maxn << 5],rt[maxn << 5];\nint cnt;\nvoid build(int &t,int l,int r)\n{\n\tt = ++cnt;\n\tif(l == r) return;\n\tint mid = l + r >> 1;\n\tbuild(ls[t],l,mid);\n\tbuild(rs[t],mid + 1,r);\n}\nint modify(int t,int l,int r,int p)//\u8fd4\u56de\u65b0\u7684\u6839\u8282\u70b9 \n{\n\tint cur = ++cnt;\n\tls[cur] = ls[t],rs[cur] = rs[t],sum[cur] = sum[t] + 1;\n\tif(l == r) return cur; \n\tint mid = l + r >> 1;\n\tif(p <= mid) ls[cur] = modify(ls[cur],l,mid,p);\n\telse rs[cur] = modify(rs[cur],mid + 1,r,p);\n\treturn cur;\n}\nint query(int i,int l,int r,int ql,int qr)\n{\n\tif(l == ql && r == qr) return sum[i];\n\tint mid = l + r >> 1;\n\tif(qr <= mid) return query(ls[i],l,mid,ql,qr);\n\telse if(ql > mid) return query(rs[i],mid + 1,r,ql,qr);\n\telse return query(ls[i],l,mid,ql,mid) + query(rs[i],mid + 1,r,mid + 1,qr);\n}\nint lastans,n;\nint f(int x)\n{\n\treturn (x - 1 + lastans) % n + 1;\n}\nint main()\n{\n\tn = read();\n\tfor(int i = 1;i <= n;i++) b[read()] = i;\n\tfor(int i = 1;i <= n;i++) a[i] = b[read()];\n\tbuild(rt[0],1,n);\n\tfor(int i = 1;i <= n;i++) rt[i] = modify(rt[i - 1],1,n,a[i]);\n\tint m = read();\n\twhile(m--)\n\t{\n\t\tint l1 = read(),r1 = read(),l2 = read(),r2 = read();\n\t\tl1 = f(l1),r1 = f(r1),l2 = f(l2),r2 = f(r2);\n\t\tif(l1 > r1) swap(l1,r1);\n\t\tif(l2 > r2) swap(l2,r2);\n\t\tprintf(\"%d\\n\",lastans = query(rt[r2],1,n,l1,r1) - query(rt[l2 - 1],1,n,l1,r1));\n\t\tlastans++;\n\t}\n}\n\t\t\n\t\n\n```",
        "postTime": 1550391719,
        "uid": 86721,
        "name": "L_M_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF323C \u3010Two permutations\u3011"
    },
    {
        "content": "> [\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/CF323C)\n\n## #0.0 \u7b80\u5355\u7ffb\u8bd1\n\n\u7ed9\u5b9a\u4e24\u4e2a\u957f\u4e3a $n$ \u7684**\u6392\u5217** $a,b$\uff0c\u6709 $m$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u5305\u542b $4$ \u4e2a\u6574\u6570 $l_1,r_1,l_2,r_2$\uff0c\u95ee\u6570\u7ec4 $a$ \u4e0a\u5728\u533a\u95f4 $[l_1,r_1]$ \u4e0e\u6570\u7ec4 $b$ \u4e0a\u5728\u533a\u95f4 $[l_2,r_2]$ \u4e2d\u6709\u591a\u5c11\u4e2a\u76f8\u540c\u7684\u6570\u3002\n\n\u672c\u9898**\u5f3a\u5236\u5728\u7ebf**\uff0c\u8bbe $x$ \u4e3a\u4e0a\u6b21\u8be2\u95ee\u7684\u7ed3\u679c\u52a0\u4e00\uff08\u82e5\u4e4b\u524d\u6ca1\u6709\u8be2\u95ee $x=0$\uff09\uff0c\u5b9a\u4e49\u51fd\u6570 $f(z)$ \u5982\u4e0b\uff1a\n\n$$\nf(z)=((z-1+x)\\bmod n)+1,\n$$\n\n\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa $4$ \u4e2a\u6574\u6570 $a, b, c, d$\uff0c\u6709\n\n$$\n\\begin{aligned}\nl_1&=\\min\\{f(a),f(b)\\},\\\\\nr_1&=\\max\\{f(a),f(b)\\},\\\\\nl_2&=\\min\\{f(c),f(d)\\},\\\\\nr_2&=\\max\\{f(c),f(d)\\}.\n\\end{aligned}\n$$\n\n## #1.0 \u7b80\u5355\u601d\u8def\n\n\u9898\u76ee\u544a\u8bc9\u6211\u4eec $a$ \u548c $b$ \u662f\u4e24\u4e2a\u6392\u5217\uff0c\u6240\u4ee5\u5bf9\u4e8e $i\\in[1,n]$\uff0c\u6bcf\u4e2a $i$ \u5728 $a$ \u4e2d\u51fa\u73b0\u4e00\u6b21\uff0c\u5728 $b$ \u4e2d\u51fa\u73b0\u4e00\u6b21\uff0c\u8003\u8651\u901a\u8fc7\u76f8\u540c\u7684\u6570\u5c06 $a$ \u4e0e $b$ \u8054\u7cfb\u8d77\u6765\uff0c\u540c\u65f6\u9700\u8981\u4fdd\u8bc1\u8054\u7cfb\u8d77\u6765\u540e\u7684\u4e0d\u540c\u7684\u6570\u5728\u5bf9\u5e94\u5e8f\u5217\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u4e0d\u6539\u53d8\uff0c\u4e8e\u662f\u5c06 $i\\in[1,n]$ \u5728 $a$ \u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e $x$ \u4f5c\u4e3a\u7b2c\u4e00\u7ef4\u5750\u6807\uff0c\u5728 $b$ \u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e $y$ \u4f5c\u4e3a\u7b2c\u4e8c\u4f4d\u5750\u6807\uff0c\u4e8e\u662f\u4fbf\u5c06\u4e00\u4e2a\u6570 $i$ \u8f6c\u5316\u4e3a\u4e86\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e0a\u7684\u4e00\u4e2a\u70b9\uff0c\u6a2a\u8f74\u662f $a$ \u6570\u5217\u7684\u4e0b\u6807\uff0c\u7eb5\u8f74\u662f $b$ \u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u663e\u7136\u8fd9\u6837\u505a\u539f\u6570\u5217\u4e2d\u7684\u6570\u7684\u76f8\u5bf9\u4f4d\u7f6e\u6ca1\u6709\u6539\u53d8\u3002\n\n\u73b0\u5728\u95ee\u9898\u53d8\u4e3a\u4e86\u7ed9\u5b9a $l_1,r_1,l_2,r_2$\uff0c\u6c42\u5728\u56db\u70b9 $(l_1,l_2),(l_1,r_2),(l_2,r_2),(l_2,r_1)$ \u56f4\u6210\u7684\u77e9\u5f62\u4e2d\u51fa\u73b0\u7684\u70b9\u7684\u6570\u91cf\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u662f**\u4e3b\u5e2d\u6811**\u7684\u7ecf\u5178\u8fd0\u7528\u3002\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2a $x$ \u770b\u4f5c\u4e00\u4e2a\u7248\u672c\uff0c\u4e3b\u5e2d\u6811\u6bcf\u4e2a\u53f6\u8282\u70b9\u5bf9\u5e94\u4e00\u4e2a $y$\uff0c\u6bcf\u6b21\u5c06\u5bf9\u5e94 $x$ \u4e0a\u6240\u6709\u7684\u70b9\u63d2\u5165\u4e3b\u5e2d\u6811\uff0c\u5373\u4e3b\u5e2d\u6811\u4e0a\u5bf9\u5e94 $y$ \u4e0a\u7684\u8ba1\u6570\u52a0\u4e00\uff0c\u7ef4\u62a4\u533a\u95f4\u548c\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u6bcf\u6b21\u67e5\u8be2\u6240\u8981\u7684\u7b54\u6848\u7684\u4fbf\u662f $r_1$ \u7248\u672c\u7684 $[l_2,r_2]$ \u7684\u533a\u95f4\u548c\u51cf\u53bb $l_1-1$ \u7248\u672c\u7684 $[l_2,r_2]$ \u7684\u533a\u95f4\u548c\u3002\n\n\u6bd4\u5982\u6837\u4f8b\u4e8c\u8f6c\u5316\u540e\u4fbf\u5982\u4e0b\u56fe\uff1a\n\n![](https://pic.imgdb.cn/item/60fe9ec75132923bf827aa68.png)\n\n\u9014\u4e2d\u6846\u51fa\u90e8\u5206\u662f\u7b2c\u4e00\u6b21\u8baf\u95ee\u7684\u8986\u76d6\u8303\u56f4\u3002\n\n## #2.0 \u4ee3\u7801\u5b9e\u73b0\n\n``` cpp\nconst int M = 1000010;\nconst int N = 40000010;\nconst int INF = 0x3fffffff;\n\ntemplate <typename T>\ninline T Max(const T a, const T b) {\n    return a > b ? a : b;\n}\n\ntemplate <typename T>\ninline T Min(const T a, const T b) {\n    return a < b ? a : b;\n}\n\nstruct Point {\n    int x, y;\n\n    inline bool operator < (const Point b) const {\n        /*\u91cd\u8f7d\u8fd0\u7b97\u7b26\uff0c\u4fdd\u8bc1\u6309 x \u81ea\u5c0f\u5411\u5927\u63d2\u5165\u4e3b\u5e2d\u6811*/\n        return (x == b.x) ? (y <= b.y) : (x < b.x);\n    }\n};\nPoint t[M];\n\nstruct Node {\n    int ls, rs;\n    int val;\n};\nNode p[N];\n\nint n, m, a[M], b[M], cnt, rt[M], lst;\n\ninline int f(int x) { //\u5e94\u5bf9\u5f3a\u5236\u5728\u7ebf\n    return ((x - 1 + lst) % n) + 1;\n}\n\ninline void pushup(int k) {\n    p[k].val = p[p[k].ls].val + p[p[k].rs].val;\n}\n\n/*\u9700\u8981\u63d0\u524d\u6784\u5efa\u51fa x=0 \u7684\u7248\u672c\uff0c\u4e0a\u9762\u6240\u6709\u8ba1\u6570\u4e3a 0*/\nvoid build(int &k, int l, int r) {\n    if (!k) k = ++ cnt;\n    if (l == r) return;\n    int mid = (l + r) >> 1;\n    build(p[k].ls, l, mid);\n    build(p[k].rs, mid + 1, r);\n}\n\nvoid insert(int &k, int pr, int l, int r, int x) {\n    if (!k) k = ++ cnt; //\u5efa\u65b0\u70b9\n    if (l == r) {\n        p[k].val = p[pr].val + 1; return;\n    } //\u6ce8\u610f\u8981\u4ece\u539f\u70b9\u590d\u5236\n    int mid = (l + r) >> 1;\n    if (x <= mid) {\n        p[k].rs = p[pr].rs;\n        insert(p[k].ls, p[pr].ls, l, mid, x);\n    } else {\n        p[k].ls = p[pr].ls;\n        insert(p[k].rs, p[pr].rs, mid + 1, r, x);\n    } //\u5206\u522b\u8003\u8651\u9012\u5f52\u4fee\u6539\u5de6\u53f3\u5b50\u6811\n    pushup(k);\n}\n\nint query(int k1, int k2, int l, int r, int x, int y) {\n    if (x <= l && r <= y) return p[k1].val - p[k2].val;\n    int mid = (l + r) >> 1, res = 0;\n    if (x <= mid) res += query(p[k1].ls, p[k2].ls, l, mid, x, y);\n    if (y > mid) res += query(p[k1].rs, p[k2].rs, mid + 1, r, x, y);\n    return res;\n}\n\nint main() {\n    scanf(\"%d\", &n);\n    for (int i = 1; i <= n; ++ i) {\n        int x; scanf(\"%d\", &x);\n        t[x].x = i;\n    }\n    for (int i = 1; i <= n; ++ i) {\n        int x; scanf(\"%d\", &x);\n        t[x].y = i;\n    }\n    sort(t + 1, t + n + 1);\n    build(rt[0], 1, n);\n    /*\u5148\u5c06\u6240\u6709\u7684\u70b9\u63d2\u5165\u4e3b\u5e2d\u6811*/\n    for (int i = 1; i <= n; ++ i)\n      insert(rt[t[i].x], rt[t[i].x - 1], 1, n, t[i].y);\n    scanf(\"%d\", &m);\n    while (m --) {\n        int l1, l2, r1, r2, a, b, c, d;\n        scanf(\"%d%d%d%d\", &a, &b, &c, &d);\n        l1 = Min(f(a), f(b)), r1 = Max(f(a), f(b));\n        l2 = Min(f(c), f(d)), r2 = Max(f(c), f(d));\n        int res = query(rt[r1], rt[l1 - 1], 1, n, l2, r2);\n        printf(\"%d\\n\", res); lst = res + 1;\n    }\n    return 0;\n}\n```",
        "postTime": 1627299671,
        "uid": 162191,
        "name": "Dfkuaid",
        "ccfLevel": 6,
        "title": "[\u9898\u89e3]CF323C Two permutations"
    },
    {
        "content": "[\u6d1b\u8c37\u9898\u9762](https://www.luogu.com.cn/problem/CF323C)\n\n[\u539f\u9898\u94fe\u63a5](https://codeforces.com/problemset/problem/323/C)\n\n## \u5f15\u5165\n\n\u4ece\u601d\u8def\u4e0a\u4ece\u5934\u5f00\u59cb\u8bb2\u8fd9\u9053\u9898\u3002\n\n\u8fd9\u9053\u9898\u76ee\u7684\u672c\u8d28\u662f\u4e00\u4e2a\u533a\u95f4\u8ba1\u6570\u95ee\u9898\uff0c\u5e76\u4e14\u8981\u6ee1\u8db3\u8ba1\u6570\u5bf9\u8c61\u5728\u4e24\u4e2a\u5e8f\u5217\u7684\u7ed9\u5b9a\u8be2\u95ee\u533a\u95f4\u4e4b\u4e2d\u90fd**\u5b58\u5728**\u3002\n\n\u4e00\u8bf4\u5230\u533a\u95f4\u95ee\u9898\uff0c\u5e76\u4e14\u8981\u7ef4\u62a4\u5b58\u5728\u6027\u7684\u8ba1\u6570\uff0c\u6211\u4eec\u9996\u5148\u60f3\u5230\u7684\u5f53\u7136\u662f\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u82e5\u67d0\u4e2a\u5143\u7d20\u5b58\u5728\uff0c\u5219\u5728\u5b83\u7684\u4f4d\u7f6e\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u8d21\u732e\u3002\n\n\u4f46\u662f\u4ed4\u7ec6\u60f3\u4e00\u60f3\uff0c\u6211\u4eec\u8981\u7ef4\u62a4\u7684\u5b58\u5728\u6027\u5fc5\u987b\u5728\u4e24\u4e2a\u5e8f\u5217\u4e2d\u540c\u65f6\u6ee1\u8db3\uff0c\u4e5f\u5c31\u662f\u6709\u4e24\u4e2a\u9650\u5236\uff0c\u4f46\u662f\u6211\u4eec\u8981\u5728\u4e00\u4e2a\u7ef4\u5ea6\u4e0a\u540c\u65f6\u7ef4\u62a4\u4e24\u4e2a\u9650\u5236\u663e\u7136\u662f\u4e0d\u90a3\u4e48\u5bb9\u6613\u7684\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u60f3\u5230\u4e3b\u5e2d\u6811\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e3b\u5e2d\u6811\u7684\u4e00\u4e2a\u5e38\u7528\u6280\u5de7\uff0c\u5373\u628a\u4e24\u4e2a\u9650\u5236\u4e2d\u7684\u4e00\u4e2a\u653e\u5230**\u65f6\u95f4\u8f74**\u4e0a\u6765\u7ef4\u62a4\uff08\u4e5f\u5c31\u662f\u4e3b\u5e2d\u6811\u7684\u82e5\u5e72\u7248\u672c\uff09\uff0c\u53e6\u4e00\u4e2a\u9650\u5236\u5219\u5229\u7528\u7ebf\u6bb5\u6811\u672c\u8eab\u5728\u53e6\u4e00\u7ef4\u5ea6\u6765\u7ef4\u62a4\u3002\n\n\u4e0a\u8ff0\u8fc7\u7a0b\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u5728\u4fdd\u8bc1\u4e00\u4e2a\u9650\u5236\u6210\u7acb\u7684\u524d\u63d0\u4e0b\uff0c\u8ba1\u7b97\u6ee1\u8db3\u53e6\u4e2a\u9650\u5236\u7684\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\u6765\u8bf4\uff0c\u6211\u4eec\u5c31\u6709\u4e86\u4e00\u4e2a\u521d\u6b65\u7684\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5 $s_1$ \u4e2d\u7684\u6570\u5b57\u51fa\u73b0\u7684\u987a\u5e8f\u4f5c\u4e3a\u65f6\u95f4\u8f74\u5efa\u7acb\u4e3b\u5e2d\u6811\uff0c\u6765\u7ef4\u62a4 $s_2$ \u4e2d\u6570\u5b57\u7684\u5b58\u5728\u6027\u3002\n\n\u90a3\u4e48\u8ba1\u7b97\u7b54\u6848\u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u5206\u4e3a\u4e24\u6b65\uff1a**\u8ba1\u6570**\u548c**\u5dee\u5206**\uff0c\n\n\u5373\u5229\u7528\u7ebf\u6bb5\u6811\u8ba1\u7b97 $[l_2,r_2]$ \u4e2d\u7684\u8d21\u732e\uff0c\u7136\u540e\u5728 $r_1$ \u548c $l_1-1$ \u7684\u7248\u672c\u4e4b\u95f4\u5dee\u5206\u3002\n\n\u60f3\u4e00\u60f3\uff0c\u6211\u4eec\u65e2\u7136\u8981\u5b9e\u73b0\u5dee\u5206\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u4e3b\u5e2d\u6811\u4e0a\u5e94\u8be5\u7ef4\u62a4\u4ec0\u4e48\u4fe1\u606f\u5462\uff1f\n\n## \u5b9e\u73b0\n\n\u5148\u6ce8\u610f\u5230\u5173\u952e\u7684\u4e00\u70b9\uff0c$s_1$ \u548c $s_2$ \u90fd\u662f**\u6392\u5217**\uff0c\u4e5f\u5c31\u662f\u8bf4\u4efb\u610f\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7684\u5143\u7d20\u90fd\u662f**\u4e92\u5f02**\u7684\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u7684 $s_1$ \u6765\u8bf4\uff0c$s_2$ \u5c31\u662f $s_1$ \u7684**\u91cd\u6392**\u3002\n\n\u5047\u5982\u6211\u4eec\u4ece\u5de6\u5f80\u53f3\u987a\u5e8f\u63d2\u5165\u4e0e $s_1$ \u7684\u5f53\u524d\u4f4d\u7f6e\u7684\u5143\u7d20\u6709\u5173\u7684\u4fe1\u606f\uff0c\n\n\u5bf9\u4e8e\u5728 $[l_1,r_1]$ \u4e2d\u5b58\u5728\u8fd9\u4e2a\u9650\u5236\uff0c\u5929\u7136\u5c31\u5f97\u5230\u4e86\u6ee1\u8db3\uff0c\u6211\u4eec\u60f3\u8981\u77e5\u9053\u6ee1\u8db3\u7b2c\u4e8c\u4e2a\u9650\u5236\u7684\u7b54\u6848\u6709\u591a\u5c11\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u60f3\u77e5\u9053\u539f\u5148\u5728 $[l_1,r_1]$ \u8fd9\u6bb5\u533a\u95f4\u4e2d\u7684\u5143\u7d20**\u504f\u79fb**\u5230\u4e86\u4ec0\u4e48\u5730\u65b9\uff08\u4e0b\u6587\u7b80\u79f0\u504f\u79fb\u503c\uff09\uff0c\u5982\u679c\u504f\u79fb\u503c\u5728 $[l_2,r_2]$ \u7684\u8303\u56f4\u4e4b\u4e2d\uff0c\u8fd9\u4e2a\u5143\u7d20\u5c31\u53ef\u4ee5\u5bf9\u8fd9\u6b21\u8be2\u95ee\u7684\u7b54\u6848\u4ea7\u751f\u8d21\u732e\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e $s_1$\uff0c\u6211\u4eec\u60f3\u8981\u5bf9\u6bcf\u4e2a $i\\in [1,n]$\uff0c\u6309 $i$ \u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u5728**\u6743\u503c**\u4e3b\u5e2d\u6811\u4e0a\u63d2\u5165 $s_{1,i}$ \u7684\u504f\u79fb\u503c\u3002\n\n\u90a3\u4e48\u8fd9\u4e2a\u504f\u5dee\u503c\u5e94\u8be5\u600e\u4e48\u8ba1\u7b97\u5462\uff1f\n\n\u9996\u5148\u6211\u4eec\u8981\u660e\u786e\u4e00\u70b9\uff0c\u6211\u4eec\u5728\u8ba1\u6570\u6b65\u9aa4\u65f6\u662f\u5728**\u4e0b\u6807\u533a\u95f4**\u4e0a\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u7684\u6743\u503c\u4e3b\u5e2d\u6811\u7684\u503c\u57df\u6240\u7ef4\u62a4\u7684\u662f $1$ \u5230 $n$ **\u4e0b\u6807\u4f4d\u7f6e**\uff0c\n\n\u90a3\u4e48\u6211\u4eec\u663e\u7136\u8981\u628a\u5143\u7d20\u7684\u503c\u4e0e\u5176\u4e0b\u6807\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\uff0c\n\n\u5177\u4f53\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 $pos$ \u6570\u7ec4\u8bb0\u5f55\u67d0\u4e2a\u5143\u7d20\u5728 $s_1$ \u4e2d\u7684\u4e0b\u6807\uff0c\u7528\u4e00\u4e2a\u6570\u7ec4 $a$ \u8bb0\u5f55\u504f\u5dee\u503c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $s_{1,i}$\uff0c\u6211\u4eec\u6709 $pos[s1[i]]=i$\n\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $s_{2,i}$\uff0c\u6211\u4eec\u5c31\u6709 $a[pos[s2[i]]]=i$\u3002\n\n\u8fd9\u4e2a\u4e24\u91cd\u6620\u5c04\u7684\u64cd\u4f5c\u7684\u542b\u4e49\u5c31\u662f\uff0c\u539f\u5148\u5728 $pos$ \u4f4d\u7f6e\u7684 $s_1$ \u4e2d\u7684\u5143\u7d20\uff0c\u5728 $s_2$ \u4e2d\u7684\u504f\u5dee\u503c\uff0c\u5373\u539f\u5148 $s_{2,i}$ \u6240\u4ee3\u8868\u7684\u5143\u7d20\u5728 $s_1$ \u4e2d\u7684\u4f4d\u7f6e\u662f $pos[s2[i]]$\uff0c\u73b0\u5728\u504f\u79fb\u5230\u4e86 $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u3002\n\n\uff08\u59cb\u7ec8\u8981\u8bb0\u5f97\uff0c$s_1$ \u548c $s_2$ \u7684\u5143\u7d20\u96c6\u5408\u662f\u76f8\u540c\u7684\uff0c\u53ea\u662f $s_2$ \u662f $s_1$ \u7684\u91cd\u6392\u3002\uff09\n\n\u4e00\u5b9a\u8981\u5206\u6e05 $pos$ \u6570\u7ec4\u548c $a$ \u6570\u7ec4\u7684\u672c\u8d28\u533a\u522b\uff0c\u524d\u8005\u662f\u628a\u503c\u6620\u5c04\u4e3a\u4e0b\u6807\uff0c\u540e\u8005\u5219\u628a**\u4e0b\u6807\u6620\u5c04\u4e3a\u65b0\u7684\u4e0b\u6807**\u3002\n\n\u90a3\u4e48\u5728\u4e3b\u5e2d\u6811\u7684\u63d2\u5165\u65f6\uff0c\u6211\u4eec\u5c31\u8fd9\u6837\uff1a\n\n`for(int i=1;i<=n;++i)rt[i]=insert(rt[i-1],1,n,a[i]);`\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u63d2\u5165\u5b83\u5bf9\u5e94\u7684 $a[i]$\u3002\uff08\u5176\u5b9e\u5c31\u7b49\u6548\u4e8e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $s_1[i]$\uff0c\u63d2\u5165\u5b83\u5bf9\u5e94\u7684\u504f\u5dee\u503c\uff0c\u56e0\u4e3a $s_1[i]$ \u5df2\u7ecf\u88ab\u6620\u5c04\u5230\u4e0b\u6807\u4e0a\u4e86\u3002\uff09\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 1000010\nusing namespace std;\nint n,m,a[maxn],s1[maxn],s2[maxn],pos[maxn],rt[maxn],tot,ans;\ninline int f(int x)\n{\n    return ((x-1+ans)%n)+1;\n}\nstruct seg_tree{\n    int lc,rc,sum;\n    #define lc(x) tree[x].lc\n    #define rc(x) tree[x].rc\n    #define sum(x) tree[x].sum\n    #define tr(x) tree[x]\n}tree[maxn<<5];\nint build(int l,int r)\n{\n    int p=++tot;\n    if(l==r){sum(p)=a[l];return p;}\n    int mid=(l+r)>>1;\n    lc(p)=build(l,mid);\n    rc(p)=build(mid+1,r);\n    return p;\n}\nint insert(int now,int l,int r,int pos)\n{\n    int p=++tot;\n    tr(p)=tr(now);\n    sum(p)=sum(now)+1;\n    if(l==r)return p;\n    int mid=(l+r)>>1;\n    if(pos<=mid)lc(p)=insert(lc(now),l,mid,pos);\n    else rc(p)=insert(rc(now),mid+1,r,pos);\n    return p;\n}\nint ask(int now,int l,int r,int L,int R)\n{\n    if(l>=L&&r<=R)return sum(now);\n    int mid=(l+r)>>1;\n    int val=0;\n    if(L<=mid)val+=ask(lc(now),l,mid,L,R);\n    if(R>mid)val+=ask(rc(now),mid+1,r,L,R);\n    return val;\n}\nint main()\n{\n    ios::sync_with_stdio(false);\n    cin>>n;\n    for(int i=1;i<=n;++i)cin>>s1[i],pos[s1[i]]=i;\n    for(int i=1;i<=n;++i)cin>>s2[i],a[pos[s2[i]]]=i;\n    //for (int i=1;i<=n;++i) printf(\"i=%d a=%d\\n\",i,a[i]);\n    rt[0]=build(1,n);\n    for(int i=1;i<=n;++i)rt[i]=insert(rt[i-1],1,n,a[i]);\n    cin>>m;\n    while(m--)\n    {\n        int l1,r1,l2,r2;\n        int a,b,c,d;\n        cin>>a>>b>>c>>d;\n        l1=min(f(a),f(b));\n        r1=max(f(a),f(b));\n        l2=min(f(c),f(d));\n        r2=max(f(c),f(d));\n        ans=ask(rt[r1],1,n,l2,r2)-ask(rt[l1-1],1,n,l2,r2);\n        cout<<ans<<'\\n';\n        ans++;\n    }\n\treturn 0;\n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1671094940,
        "uid": 625380,
        "name": "FriedrichC",
        "ccfLevel": 0,
        "title": "CF323C Two permutations \u9898\u89e3"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://registergen.github.io/post/solution-cf323c/)\n\n\u534a\u5e74\u6ca1\u6572\u4e3b\u5e2d\u6811\u5374\u4e00\u904d\u5199\u5bf9\uff0c\u796d\u4e4b\u3002\n\n# Solution\n\n\u540c\u65f6\u51fa\u73b0\u7684\u6570\u7684 **\u4e2a\u6570**\uff1f\u4e3b\u5e2d\u6811\uff01\n\n\u8f6c\u5316\u662f\u6bd4\u8f83\u5de7\u5999\u7684\u3002\n\n\u53ef\u4ee5\u8bb0\u5f55 $b_i$ \u5728 $a$ \u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u7528\u4e3b\u5e2d\u6811\u7ef4\u62a4\u8fd9\u4e2a\u6570\u7ec4\u3002\n\n\u90a3\u4e48\u8be2\u95ee\u5c31\u662f\u6c42 $l_2\\sim r_2$ \u5185\u6709\u591a\u5c11\u4e2a\u6570\u5728 $[l_1,r_1]$ \u4e4b\u95f4\u3002\u7528\u7b2c $r_2$ \u4e2a\u6839\u7684\u7b54\u6848\u51cf\u4e00\u4e0b\u7b2c $l_2-1$ \u4e2a\u6839\u7684\u7b54\u6848\u5c31\u884c\u4e86\u3002\n\n~~\u5f3a\u5236\u5728\u7ebf\u771f\u9b3c\u755c\u3002~~ \u6ce8\u610f $lstans$ \u5728\u8be2\u95ee\u540e\u4e00\u5b9a\u8981\u52a0 $1$\u3002\u3002\u3002\n\n# Code\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n\nconst int N=1e6;\n\nstruct Node\n{\n\tint v,ls,rs;\n};\n\nNode t[N<<5];\nint a[N+10],b[N+10],rt[N+10],cnt;\nint n,m,lstans;\n\n#define SIZ 1000000\n\ninline char gc()\n{\n#ifndef ONLINE_JUDGE\n\treturn char(getchar());\n#else\n\tstatic char buf[SIZ],*p1=buf,*p2=buf;\n\treturn p1==p2&&(p2=(p1=buf)+fread(buf,1,SIZ,stdin),p1==p2)?EOF:*p1++;\n#endif\n}\n\n#undef SIZ\n\ninline int read()\n{\n\tint x=0,f=0;char c=gc();\n\twhile(c<'0'||c>'9')f|=c=='-',c=gc();\n\twhile(c>='0'&&c<='9')x=x*10+c-48,c=gc();\n\treturn f?-x:x;\n}\n\ninline int f(int x)\n{\n\treturn (x-1+lstans)%n+1;\n}\n\n#define ls(x) (t[x].ls)\n#define rs(x) (t[x].rs)\n\nvoid modify(int& i,int j,int l,int r,int pos)\n{\n\ti=++cnt;\n\tls(i)=ls(j),rs(i)=rs(j),t[i].v=t[j].v+1;\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tif(pos<=mid)modify(ls(i),ls(j),l,mid,pos);\n\telse modify(rs(i),rs(j),mid+1,r,pos);\n}\n\nint query(int i,int l,int r,int ql,int qr)\n{\n\tif(ql<=l&&r<=qr)return t[i].v;\n\tint mid=(l+r)>>1;\n\tint res=0;\n\tif(ql<=mid)res+=query(ls(i),l,mid,ql,qr);\n\tif(qr>mid) res+=query(rs(i),mid+1,r,ql,qr);\n\treturn res;\n}\n\n#undef ls\n#undef rs\n\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t\tb[read()]=i;\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=b[read()];\n\tfor(int i=1;i<=n;i++)\n\t\tmodify(rt[i],rt[i-1],1,n,a[i]);\n\tm=read();\n\twhile(m--)\n\t{\n\t\tint l1=f(read()),r1=f(read()),l2=f(read()),r2=f(read());\n\t\tif(l1>r1)std::swap(l1,r1);\n\t\tif(l2>r2)std::swap(l2,r2);\n\t\tprintf(\"%d\\n\",lstans=query(rt[r2],1,n,l1,r1)-query(rt[l2-1],1,n,l1,r1));\n\t\tlstans++;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1593763159,
        "uid": 242702,
        "name": "registerGen",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF323C \u3010Two permutations\u3011"
    },
    {
        "content": "# \u9898\u610f\n\n\u7ed9\u51fa\u4e24\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217\uff0c\u7ed9\u51fa $m$ \u4e2a\u8be2\u95ee\uff0c\u95ee\u5728\u7b2c\u4e00\u4e2a\u6392\u5217 $[l1,r1]$ \u533a\u95f4\u5185\uff0c\u7b2c\u4e8c\u4e2a\u6392\u5217 $[l2,r2]$ \u533a\u95f4\u5185\u540c\u65f6\u51fa\u73b0\u7684\u6570\u6709\u591a\u5c11\u4e2a\u3002\n\n# \u601d\u8def\n\n\u6ca1\u770b\u5230\u5f3a\u5236\u5728\u7ebf\u7684\u6211\uff1a \u5bf9 $[l1,r1]$ \u548c $[l2,r2]$ \u4e24\u4e2a\u533a\u95f4\u5206\u522b\u8dd1\u83ab\u961f\uff0c\u7528 bitset \u5b58\u4e00\u4e0b\u6bcf\u4e2a\u6570\u662f\u5426\u51fa\u73b0\uff0c\u7136\u540e\u53d6\u4e0e\uff0c\u590d\u6742\u5ea6 $O(\\frac{nm}{w})$\uff0c\u5e94\u8be5\uff0c\u5e94\u8be5\u80fd\u8fc7\u3002\n\n\u7136\u540e\u5c31\u5f00\u7801\uff0c\u4e2d\u95f4\u53d1\u73b0 bitset \u5f00\u4e0d\u4e0b\uff0c\u88ab\u8feb\u5206\u7ec4\u5904\u7406\u8be2\u95ee\uff0c\u540e\u6765\u6b7b\u6d3b\u8fc7\u4e0d\u4e86\u7b2c\u4e8c\u4e2a\u5927\u6837\u4f8b\uff0c\u624d\u53d1\u73b0\u662f\u5f3a\u5236\u5728\u7ebf\u3002\n\n\u6124\u6012\u5730\u5220\u7a7a\u4e86\u4ee3\u7801\uff0c\u5f00\u59cb\u60f3\u6b63\u89e3\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u8be2\u95ee\u6709\u4e24\u7ef4\uff0c\u4e00\u822c\u7684\u6570\u636e\u7ed3\u6784\u5f88\u96be\u5e94\u4ed8\uff0c\u53ef\u4ee5\u964d\u7ef4\u7684\u4e14\u5728\u7ebf\u7684\u6709\u6811\u5957\u6811\uff0c\u4e3b\u5e2d\u6811\uff0c KD-tree \u7b49\uff0c\u7ecf\u8fc7\u4e00\u756a\u601d\u8003\uff0c\u4f1a\u53d1\u73b0\u4e3b\u5e2d\u6811\u662f\u6700\u5408\u9002\u7684\u3002\n\n\u9996\u5148\u6211\u4eec\u5bf9\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u5f00\u4e3b\u5e2d\u6811\uff0c\u8bb0\u5f55\u51fa\u73b0\u5728\u7b2c\u4e00\u4e2a\u6392\u5217\u5bf9\u5e94\u533a\u95f4\u5185\u6570\u7684\u4e2a\u6570\uff0c\u968f\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u6211\u4eec\u5148\u5728\u4e3b\u5e2d\u6811\u4e0a\u8fdb\u884c\u63d0\u53d6\u51fa\u5bf9\u5e94\u533a\u95f4\uff0c\u7136\u540e\u67e5\u7b2c\u4e00\u4e2a\u533a\u95f4\u5bf9\u5e94\u533a\u95f4\u5185\u51fa\u73b0\u6570\u7684\u4e2a\u6570\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n# \u4ee3\u7801\n\n\u6682\u65f6\u7684 rank 1\uff0c[rt](https://www.luogu.com.cn/paste/r85416ai)\u3002\n\n",
        "postTime": 1657453632,
        "uid": 571229,
        "name": "__stick",
        "ccfLevel": 7,
        "title": "CF323C"
    },
    {
        "content": "### \u9898\u610f\uff1a\n\n\u7ed9\u5b9a\u4e24\u4e2a\u957f\u5ea6\u5747\u4e3a $n$ \u7684\u6392\u5217\u3002\n$m$ \u6b21\u8be2\u95ee\u3002\u6bcf\u6b21\u8be2\u95ee\u60a8\u8981\u6c42\u51fa\u5728\u7b2c\u4e00\u4e2a\u6392\u5217\u7684 $[l1,r1]$ \u548c\u7b2c\u4e8c\u4e2a\u6392\u5217\u7684 $[l2,r2]$ \u540c\u65f6\u51fa\u73b0\u7684\u6570\u6709\u591a\u5c11\u4e2a\u3002\n\n$1\\le n\\le10^6$\uff0c$1\\le m\\le 2\\times 10^5$\n \u3002\u5f3a\u5236\u5728\u7ebf\u3002\n \n### \u601d\u8def\uff1a\n\n\u9996\u5148\u601d\u8003\uff0c\u5982\u679c\u4e0d\u5f3a\u5236\u5728\u7ebf\u600e\u4e48\u505a\u3002\u5982\u8fc7\u5c06\u7b2c\u4e00\u4e2a\u6570\u5217\u4e2d\u6570\u51fa\u73b0\u7684\u4f4d\u7f6e\u6620\u5c04\u5230\u6570\u7ec4 $wz$ \u4e2d\uff0c\u7b54\u6848\u5c31\u8f6c\u5316\u4e3a$\\sum_{n=l2}^{r2}[l1\u2264wz_{a_n}\u2264r1]$\u3002\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u8f6c\u5316\u4e3a$\\sum_{n=1}^{r2}[l1\u2264wz_{a_n}\u2264r1]-\\sum_{n=1}^{l2-1}[l1\u2264wz_{a_n}\u2264r1]$\uff0c\u4e8e\u662f\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u6309\u7b2c\u4e00\u4e2a\u6392\u5217\u4e2d\u7684\u4e0b\u6807\u987a\u5e8f\u52a0\u70b9\uff0c\u7ebf\u6bb5\u6811\u5185\u7684 $l$\uff0c$r$ \u5206\u522b\u5bf9\u5e94\u7740\u7b2c\u4e8c\u4e2a\u6392\u5217\u7684\u4e0b\u6807 $l$\uff0c$r$\u3002\n\n\u7531\u4e8e\u6b64\u9898\u8981\u6c42\u5f3a\u5236\u5728\u7ebf\uff0c\u800c\u4e0a\u8ff0\u505a\u6cd5\u9700\u8981\u901a\u8fc7\u67e5\u8be2\u5386\u53f2\u7248\u672c\uff08\u5373\u52a0\u5b8c\u7b2c $l-1$ \u4e2a\u5143\u7d20 \u548c \u52a0\u5b8c\u7b2c $l-1$ \u4e2a\u5143\u7d20\u7684\u7248\u672c\uff09\uff0c\u7528\u666e\u901a\u7ebf\u6bb5\u6811\u9700\u8981\u79bb\u7ebf\u4e0b\u6765\uff0c\u4e8e\u662f\u7528\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u5c31\u53ef\u4ee5\u8fa3\u3002\n\n### \u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,wz[1000005],a[1000005],x,cnt,hd[1000005],m,A,B,C,D,l1,l2,r1,r2,lst;\nint tr[1000005<<5],ls[1000005<<5],rs[1000005<<5];//\u7a7a\u95f4\u52a0\u500d\uff01\nint bd(int l,int r)//\u5efa\u6811\n{\n\tint rt=++cnt;\n\tif(l==r) return rt;\n\tint mid=(l+r)/2;\n\tls[rt]=bd(l,mid);\n\trs[rt]=bd(mid+1,r);\n\treturn rt;\n}\nint f(int x)\n{\n\treturn (x-1+lst)%n+1;\n}\nint add(int u,int l,int r,int k)\n{\n\tint rt=++cnt;\n\ttr[rt]=tr[u]+1,ls[rt]=ls[u],rs[rt]=rs[u];\n\tif(l==r) return rt;\n\tint mid=(l+r)/2;\n\tif(mid>=k) ls[rt]=add(ls[rt],l,mid,k);\n\telse rs[rt]=add(rs[rt],mid+1,r,k);\n\treturn rt;\n}\ninline int read()\n{\n    int x=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9') ch=getchar();\n    while(ch>='0' && ch<='9') x=x*10+ch-'0',ch=getchar();\n    return x;\n}\nint qr(int u,int l,int r,int  L,int R)\n{\n\tif(L<=l&&r<=R) return tr[u];\n\tif(L>r||l>R) return 0;\n\tint mid=(l+r)/2;\n\treturn qr(ls[u],l,mid,L,R)+qr(rs[u],mid+1,r,L,R); \n}\nint main()\n{\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tx=read();\n\t\twz[x]=i;\n\t}\n\thd[0]=bd(1,n);\n\tfor(int i=1;i<=n;i++) hd[i]=add(hd[i-1],1,n,wz[a[i]]);//\u4e00\u6b21\u52a0\u70b9\n\tcin>>m;\n\twhile(m--)\n\t{\n\t\tA=read(),B=read(),C=read(),D=read();\n\t\tl1=min(f(A),f(B)),r1=max(f(A),f(B)),l2=min(f(C),f(D)),r2=max(f(C),f(D));\n//\t\tcout<<l1<<\" \"<<r1<<' '<<l2<<' '<<r2<<endl;\n\t\tlst=qr(hd[r1],1,n,l2,r2)-qr(hd[l1-1],1,n,l2,r2);//\u67e5\u8be2\u5386\u53f2\u7248\u672c\n\t\tprintf(\"%d\\n\",lst++);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1649408526,
        "uid": 448159,
        "name": "wz20201136",
        "ccfLevel": 7,
        "title": "CF323C\u9898\u89e3"
    }
]