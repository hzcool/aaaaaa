[
    {
        "content": "\u8bbe$val_{i,j}$\u4e3a\u533a\u95f4$[l,r]$\u7684\u7b54\u6848\n\n\u6839\u636e\u9898\u610f\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4$a_i$\u548c$i* a_i$\u7684\u524d\u7f00\u548c$sum1,sum2$\n\n$val_{l,r}=sum2[r]-sum2[l-1]-(l-1)*(sum1[r]-sum1[l-1])$\n\n\u6211\u4eec\u679a\u4e3e$r$\n\n\u5bf9\u4e8e\u6240\u6709$val_{l',r}\\le val_{l,r}$\uff0c\u6709\n\n$(l'-1)*sum1_{l'-1}-sum2_{l'-1}-(l'-1)*sum1_r\\le (l-1)*sum1_{l-1}-sum2_{l-1}-(l-1)*sum1_r$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u659c\u7387\u4f18\u5316\n\n\u659c\u7387\u4f18\u5316\u4e00\u822c\u628a\u6211\u4eec\u8981\u7684\u6700\u5927\u503c/\u6700\u5c0f\u503c\u4e5f\u5c31\u662f\u8fd9\u91cc\u7684$val_{l,r}$\u653e\u5728$b$\u91cc\u9762\uff0c\u90a3\u4e48$(l-1)*sum1_{l-1}-sum2_{l-1}-(l-1)*sum1_r$\u5c31\u53ef\u4ee5\u8868\u793a\u6210$y-kx$\uff0c\n\n\u628a\u8ddf$r$\u6709\u5173\u7684\u653e\u5728$k$\u91cc\u9762\uff0c$k=sum1_r$\n\n\u4e8e\u662f$b=val_{l,r}-sum_r,x=l-1,y=(l-1)*sum1_{l-1}$\n\n\u56e0\u4e3a\u662f\u6700\u5927\u503c\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\u6bcf\u6b21\u4e8c\u5206\u627e\u5230\u7b2c\u4e00\u4e2a\u659c\u7387\u5c0f\u4e8e$sun1_r$\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u66f4\u65b0\u7b54\u6848\u5373\u53ef\n\n~~\u4ee5\u4e0b\u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003~~\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<queue>\n#include<algorithm>\n#include<cstring>\n#include<set>\n#include<vector>\n#include<cmath>\n#define PII pair<int,int>\n#define pb push_back\n#define ep emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define int long long\nusing namespace std;\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){ if(c=='-') f=-1; c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<3)+(x<<1)+(c^48);c=getchar();}\n\treturn f==1?x:-x;\n}\ninline void print(int x){\n\tif(x<0) putchar('-'),x=~x+1;\n\tif(x>=10) print(x/10);\n\tputchar((x%10)|48);\n}\nconst double eps=1e-12;\nint n;\nint a[200010]; \nint sum1[200010],sum2[200010];\nint stk[200010];\nint top;\ndouble getx(int id){\n\tif(id==0) return 0;\n\treturn id-1;\n}\ndouble gety(int id){\n\tif(id==0) return 0;\n\treturn (id-1)*(sum1[id-1])-sum2[id-1];\n}\ndouble getslope(int x,int y){\n\treturn (gety(y)-gety(x))/(getx(y)-getx(x)+eps);\n}\nint calc(int l,int r){\n\treturn sum2[r]-sum2[l-1]-(l-1)*(sum1[r]-sum1[l-1]);\n}\nsigned main(){\n\tn=read();\n\tfor(int i=1;i<=n;++i) a[i]=read();\n\tfor(int i=1;i<=n;++i) sum1[i]=sum1[i-1]+a[i],sum2[i]=sum2[i-1]+a[i]*i;\n\tint ans=0;\n\tfor(int i=1;i<=n;++i){\n\t\tif(top>1){\n\t\t\twhile(top>1&&getslope(stk[top-1],stk[top])<getslope(stk[top-1],i)) --top;\n\t\t\tstk[++top]=i;\n\t\t}\n\t\telse{\n\t\t\tstk[++top]=i;\n\t\t}\n\t\tint l=2,r=top;\n\t\tdouble k=sum1[i];\n\t\tint res=1;\n\t\twhile(l<=r){\n\t\t\tint mid=l+r>>1;\n\t\t\tif(getslope(stk[mid-1],stk[mid])>=k)res=mid,l=mid+1;\n\t\t\telse r=mid-1;\n\t\t}\n\t\tans=max(ans,calc(stk[res],i));\n\t}\n\tprint(ans);\n} \n```\n",
        "postTime": 1604630590,
        "uid": 131933,
        "name": "sunzh",
        "ccfLevel": 9,
        "title": "CF660F\u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF660F)\n\n[\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://chenyu-w.github.io./2023/03/24/CF660F%20Bear%20and%20Bowling%204/)\n\nDP\uff1fDS\uff01\n\n\u9996\u5148\u8003\u8651\u5982\u4f55 $O(1)$ \u8ba1\u7b97\u6bcf\u4e2a\u533a\u95f4\u7684\u7ed3\u679c\uff0c\u8bb0 $A_i = \\sum_{j = 1}^i j \\cdot a_j$\uff0c$B_i = \\sum_{j = 1}^i a_j$\uff0c\u90a3\u4e48\u9009\u62e9 $[l, r]$ \u7684\u7b54\u6848\u5373\u4e3a\n$$\n\\sum_{i = l}^r (i - l + 1)a_i = \\sum_{i = l}^r i \\cdot a_i - (l - 1)\\sum_{i = l}^r a_i = A_r - A_{l - 1} - (l - 1)(B_r - B_{l - 1})\n$$\n\u8fd9\u6837\u662f $O(n^2)$ \u7684\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u8fdb\u884c\u6570\u636e\u7ed3\u6784\u4f18\u5316\u3002\n\n\u8bb0 $f_i$ \u4e3a\u4ee5 $a_i$ \u4e3a\u7ed3\u5c3e\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u5bb9\u6613\u5f97\u5230\n$$\nf_i = A_i + \\max_{j \\in [1, i]}\\left\\{ (1 - j) \\cdot B_i + (j - 1)B_{j - 1} - A_{j - 1}\\right\\}\n$$\n\u8fd9\u5f88\u50cf\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u5f62\u5f0f\uff0c\u4e8e\u662f\u6211\u4eec\u4ee4 $k_i = 1 - i$\uff0c$b_i = (i - 1)B_{i - 1} - A_{i - 1}$\n\n\u7136\u540e\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\n$$\nf_i = A_i + \\max_{j \\in [1, i]} \\left\\{k_jB_i + b_j\\right\\}\n$$\n\u76f4\u63a5\u674e\u8d85\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6700\u5927\u503c\u5373\u53ef\u3002\n\n```c++\n#include <bits/stdc++.h>\n#define L(i, j, k) for(int i = (j); i <= (k); i++)\n#define R(i, j, k) for(int i = (j); i >= (k); i--)\n#define G(i, u) for (int i = h[(u)]; ~i; i = ne[i])\n#define ll long long\n#define ld long double\n#define ull unsigned long long\n\nusing namespace std;\nconst int N = 2e5 + 10;\nconst ll INF = 1e18;\nll a[N], b[N], c[N];\nstruct Func {\n    ll k, b;\n} line[N];\nint s[N << 2];\n\ninline int read() {\n    int x = 0, y = 1; char c = getchar();\n    while (c < '0' || c > '9') {if (c == '-') y = -1; c = getchar();}\n    while (c >= '0' && c <= '9') x = x * 10 + c - '0', c = getchar();\n    return x * y;\n}\n\ninline ll calc(int i, int x) {\n    return line[i].k * c[x] + line[i].b;\n}\n\ninline void change(int p, int l, int r, int x) {\n    if (l == r) {\n        if (calc(x, l) > calc(s[p], l)) s[p] = x;\n        return;\n    }\n    int mid = (l + r) >> 1; \n    if (calc(x, mid) > calc(s[p], mid)) swap(x, s[p]);\n    calc(x, l) > calc(s[p], l) ? change(p << 1, l, mid, x) : change(p << 1 | 1, mid + 1, r, x);\n}\n\ninline ll query(int p, int l, int r, int x) {\n    if (l == r) return calc(s[p], x);\n    int mid = (l + r) >> 1;\n    return max(calc(s[p], x), x <= mid ? query(p << 1, l, mid, x) : query(p << 1 | 1, mid + 1, r, x));\n}\n\nint main() {\n    int n = read();\n    L(i, 1, n) {\n        int x = read();\n        a[i] = a[i - 1] + 1ll * i * x, b[i] = b[i - 1] + x, c[i] = b[i];\n    }\n    sort(c + 1, c + n + 1);\n    int len = unique(c + 1, c + n + 1) - c - 1;\n    line[0].b = -INF;\n    ll res = 0;\n    L(i, 1, n) {\n        int pos = lower_bound(c + 1, c + len + 1, b[i]) - c;\n        line[i] = {1 - i, b[i - 1] * (i - 1) - a[i - 1]};\n        change(1, 1, len, i);\n        res = max(res, query(1, 1, len, pos) + a[i]);\n    }\n    printf(\"%lld\\n\", res);\n    return 0;\n}\n```\n\n",
        "postTime": 1679667628,
        "uid": 587248,
        "name": "wcywcywcywcy",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF660F"
    },
    {
        "content": "# CF660F \u9898\u89e3\n\n## \u9898\u610f\n\n\u5b9a\u4e49\u4e00\u4e2a\u957f\u5ea6\u4e3a $m$ \u7684\u5e8f\u5217 $b$ \u7684\u4ef7\u503c\u4e3a $\\sum^m_{i=1}ib_i$\uff0c\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217 $a$\uff0c\u957f\u5ea6\u4e3a $n$\uff0c\u6c42 $a$ \u7684\u6240\u6709\u8fde\u7eed\u5b50\u5e8f\u5217\u7684\u6700\u5927\u4ef7\u503c\u3002\n\n#### \u6570\u636e\u8303\u56f4\n\n$1\\leq n\\leq2\\times10^5,1\\leq |a_i|\\leq10^7$\n\n## \u5206\u6790\n\n### \u63a8\u5f0f\u5b50\n\n\u8003\u8651\u4ee5 $i$ \u7ed3\u5c3e\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\u7684\u4ef7\u503c $ans_i$\u3002\n\n\u9ed8\u8ba4 $a_0=0$\uff0c\u8bbe $sum_i=\\sum^i_{j=0}a_j$\uff0c\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u8003\u8651\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\u5f00\u5934\u662f $j$\u3002\u518d\u5411\u5de6\u6269\u5c55\u4e00\u4e2a\uff0c\u5c31\u52a0\u4e0a $sum_i-sum_{j-2}$ \u7684\u4ef7\u503c\u3002\u53ef\u4ee5\u53d1\u73b0\u4ee5 $j$ \u5f00\u5934\uff0c\u4ee5 $i$ \u7ed3\u5c3e\u7684\u8fde\u7eed\u5b50\u5e8f\u5217\u7684\u4ef7\u503c\u4e3a:\n$$\n(i-j+1)sum_i-\\sum^{i-1}_{k=j-1}sum_k\n$$\n\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u4e0d\u96be\u8bc1\u660e\uff0c\u7406\u89e3\u8d77\u6765\u5e94\u8be5\u4e5f\u4e0d\u96be\u5427\u3002\n\n\u4e8e\u662f\u7ef4\u62a4 $sum$ \u7684\u524d\u7f00\u548c\uff0c\u8bbe $s_i=\\sum^i_{j=0}sum_i$\u3002\u5219\u4e0a\u8ff0\u5f0f\u5b50\u53ef\u5316\u4e3a\n$$\n(i-j+1)sum_i-(s_{i-1}-s_t)\n$$\n\u5176\u4e2d $t=\\max\\{j-2,0\\}$\u3002\n\n\u4e8e\u662f \n$$\nans_i=\\max_{1\\leq j\\leq i}\\{(i-j+1)sum_i-sum(s_{i-1}-s_t)\\}\n$$\n\u663e\u7136\u662f $O(n)$ \u7684\uff0c\u679a\u4e3e\u6bcf\u4e00\u4e2a $i$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u8fc7\u4e0d\u53bb\u3002\n\n### \u4f18\u5316\n\n\u90a3\u4e2a\u5f0f\u5b50\u975e\u5e38\u6709\u659c\u7387\u4f18\u5316\u7684\u611f\u89c9\u3002\u5c06 $\\max$ \u51fd\u6570\u62c6\u5f00\uff0c\u79fb\u9879\u53ef\u53d8\u4e3a\n$$\n(j-1)sum_i+ans_i+s_{i-1}-isum_i=s_t\n$$\n\u5219\u6709\n$$\n\\begin{aligned}\nx=(j-1),y=s_t\\\\\nk=sum_i,b=ans_i+s_{i-1}-isum_i\n\\end{aligned}\n$$\n\u5c31\u662f\u659c\u7387\u4f18\u5316\u7684\u677f\u5b50\u9898\u4e86\uff0c\u53d6\u6700\u5927\u503c\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\u5373\u53ef\u3002\u6ce8\u610f\u5230\u659c\u7387 $k$ \u5355\u8c03\u4f46\u662f $y$ \u4e0d\u5355\u8c03\uff0c\u9700\u8981\u5728\u5355\u8c03\u6808\u5185\u4e8c\u5206\u7b2c\u4e00\u4e2a\u659c\u7387\u5c0f\u4e8e $k$ \u7684\u4f4d\u7f6e\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n### Code\n\n```cpp\n#include<bits/stdc++.h>\n\n#define rep(i,x,y) for(int i=(x), _=(y); i<=_; i++)\n#define per(i,x,y) for(int i=(x), _=(y); i>=_; i--)\n\nusing namespace std;\ntemplate <class T1, class T2>inline bool cmax(T1 &a, T2 b) {return a < b ? a = b, 1 : 0;}\ntemplate <class T1, class T2>inline bool cmin(T1 &a, T2 b) {return b < a ? a = b, 1 : 0;}\ntypedef pair<int, int> pii;\ntypedef pair<int, long long> pil;\ntypedef pair<long long, int> pli;\ntypedef pair<long long, long long> pll;\ntypedef long long LL;\n\nconst int N = 2e5 + 10;\nconst LL Inf = 0x3f3f3f3f3f3f3f3f;\n\nint n, a[N + 1];\nLL sum[N + 1], s[N + 1];\nint stac[N + 1], top;\n\ninline double\nslope(int i, int j) {\n\treturn double(s[max(i - 1, 0)] - s[max(j - 1, 0)]) / (i - j);\n}\n\ninline LL\ncalc(int i, int j) {\n\treturn (i - j) * sum[i] - s[max(i - 1, 0)] + s[max(j - 1, 0)];\n}\n\nint\nmain() {\n\tios::sync_with_stdio(0); cin.tie(0); cout.tie(0);\n\tcin >> n;\n\trep(i, 1, n) cin >> a[i];\n\trep(i, 1, n) sum[i] = sum[i - 1] + a[i];\n\trep(i, 1, n) s[i] = s[i - 1] + sum[i];\n\tLL ans = max(0ll, sum[1]);\n\tstac[++ top] = 0, stac[++ top] = 1;\n\trep(i, 2, n) {\n\t\tint l = 1, r = top, mid, res = stac[top];\n\t\twhile(l <= r) {\n\t\t\tmid = (l + r) >> 1;\n\t\t\tdouble slp = slope(stac[mid], stac[mid + 1]);\n\t\t\tif(slp <= sum[i]) res = stac[mid], r = mid - 1;\n\t\t\telse l = mid + 1;\n\t\t}\n\t\tLL temp = calc(i, res);\n\t\tcmax(ans, temp);\n\t\twhile(top > 1 && slope(stac[top - 1], stac[top]) <= slope(stac[top], i)) top --;\n\t\tstac[++ top] = i;\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n\n```\n\n\n\n\n\n\n\n# End\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1662691258,
        "uid": 582035,
        "name": "_cyle_King",
        "ccfLevel": 0,
        "title": "CF660F \u9898\u89e3"
    },
    {
        "content": "\u4f20\u9001\u95e8:[CF660F](https://www.luogu.com.cn/problem/CF660F)\n\n\u7528\u5206\u6cbb\u548c\u674e\u8d85\u7ebf\u6bb5\u6811\u8fc7\u6389\u6b64\u9898\u7684\u6211\u770b\u7740\u4e00\u5806\u7ebf\u6027\u505a\u6cd5\u6d41\u4e0b\u4e86\u773c\u6cea\u3002\n\n\u9996\u5148\uff0c\u95ee\u9898\u662f\u5728\u5e8f\u5217\u4e2d\u9009\u53d6\u4e00\u6bb5\u4e0d\u5b9a\u957f\u7684\u533a\u95f4\uff0c\u4f7f\u5f97\u6743\u503c\u6700\u5927\n\n\u5bf9\u4e8e\u8fd9\u79cd\u95ee\u9898\uff0c\u5206\u6cbb\u5176\u5b9e\u662f\u4e2a\u4e00\u822c\u6027\u7684\u601d\u8def\uff0c\u8bbe $solve(l,r)$ \u8868\u793a\u533a\u95f4 $[l,r]$ \u7684\u7b54\u6848\uff0c\u6211\u4eec\u53d6 $mid = \\frac{l + r}{2}$\uff0c\u5219\u6240\u6c42\u53ef\u4ee5\u88ab\u5316\u4e3a\u4e09\u90e8\u5206\uff1a\n\n1. \u533a\u95f4 $[l,mid]$ \u7684\u7b54\u6848\n2. \u533a\u95f4 $[mid+1,r]$ \u7684\u7b54\u6848\n3. \u5728\u533a\u95f4 $[l,r]$ \u4e2d\uff0c\u7ecf\u8fc7\u70b9 $mid$ \u7684\u533a\u95f4\u7684\u7b54\u6848\n\n\u663e\u7136\u524d\u4e24\u90e8\u5206\u53ef\u4ee5\u9012\u5f52\u4e0b\u53bb\uff0c\u91cd\u70b9\u5728\u7b2c\u4e09\u90e8\u5206\n\n\u6211\u4eec\u5229\u7528\u5206\u6cbb\u6846\u67b6\uff0c\u4ee5\u590d\u6742\u5ea6\u591a\u4e2a $\\log$ \u4e3a\u4ee3\u4ef7\uff0c\u7ed9\u539f\u95ee\u9898\u52a0\u4e86\u4e2a\"\u5fc5\u987b\u7ecf\u8fc7\u70b9 $mid$ \" \u7684\u9650\u5236\uff0c\u8fd9\u5c31\u662f\u8fd9\u4e2a\u65b9\u6cd5\u7684\u539f\u7406\u3002\n\n\u6211\u4eec\u8003\u8651\u628a\u7b54\u6848\u6309 $mid$ \u5206\u6210\u5de6\u53f3\u4e24\u90e8\u5206\n\n\u8fd9\u662f\u6211\u4eec\u5982\u679c\u679a\u4e3e\u7aef\u70b9\uff0c\u590d\u6742\u5ea6\u8fd8\u662f $\\Theta(n^2)$\n\n\u4f46\u6ce8\u610f\u5230\u53ea\u6709 $\\Theta(r-l)$ \u4e2a\u53ef\u80fd\u7684\u5de6\u534a\u6bb5\uff0c$\\Theta(r - l)$ \u4e2a\u53ef\u80fd\u7684\u53f3\u534a\u6bb5\n\n\u4e0d\u96be\u60f3\u5230\u628a\u6240\u6709\u53f3\u534a\u6bb5\u7684\u4fe1\u606f\u63d2\u5165\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u5de6\u534a\u6bb5\u5feb\u901f\u5bfb\u6c42\u7b54\u6848\n\n\u8bbe\u4e00\u4e2a\u53f3\u534a\u6bb5\u7684\u533a\u95f4\u548c\u4e3a $sum$ \uff0c\u7b54\u6848\u4e3a $ans$\n\n\u6211\u4eec\u5bf9\u4e8e\u73b0\u5728\u8003\u8651\u7684\u5de6\u534a\u6bb5\uff0c\u5176\u7b54\u6848\u4e3a $ansl$ ,\u957f\u5ea6\u4e3a $len$ \uff0c\u6211\u4eec\u5c31\u662f\u8981\u6c42 $ansl + \\max\\limits_{sum,ans}(sum \\times len + ans)$\n\n\u5982\u679c\u628a\u6bcf\u4e2a\u53f3\u534a\u6bb5\u7684 $sum,ans$ \u770b\u505a\u4e00\u6761\u76f4\u7ebf $y = sum \\cdot x + ans$\n\n\u90a3\u6bcf\u6b21\u8be2\u95ee\u5c31\u662f\u67e5\u8be2 $x = len$ \u65f6\u4e0e\u5404\u76f4\u7ebf\u4ea4\u70b9\u7684\u6700\u9ad8\u5904\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0kiwxwm1.png?x-oss-process=image/resize,m_lfit,h_220,w_300)\n\n\u5c31\u50cf\u8fd9\u5f20\u56fe\u4e2d\uff0c\u7ea2\u8272\u7684\u76f4\u7ebf\u4e3a $x = len$ \uff0c$W$ \u70b9\u5c31\u4e3a\u6240\u6c42\n\n\u719f\u6089\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u670b\u53cb\u90fd\u77e5\u9053\uff0c\u8fd9\u5c31\u662f\u4e2a\u677f\u5b50\n\n\u4e8e\u662f\u95ee\u9898\u89e3\u51b3\u4e86\n\n\u6ce8\u610f\u7ebf\u6bb5\u6811\u7684\u6e05\u7a7a\u95ee\u9898\uff0c\u5efa\u8bae\u5f00\u4e2a\u5783\u573e\u6876\uff0c\u8bb0\u5f55\u88ab\u8bbf\u95ee\u5230\u7684\u8282\u70b9\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 2e5 + 5;\ntypedef long long ll;\ntypedef double db;\nint n,a[N];ll sum[N];\n/*\n\u5148\u5206\u6cbb\uff0c\u5904\u7406\u51fa\u53f3\u534a\u8fb9\u6bcf\u4e2a\u7aef\u70b9\u7684 sum \u548c ans\n\u90a3\u5bf9\u4e8e\u5de6\u534a\u8fb9\u6bcf\u4e2a\u7aef\u70b9 i,\u957f\u5ea6\u4e3a len ,\u7b54\u6848\u4e3a ansl \uff0c\u5c31\u662f\u6c42 ansl + max(sum * len + ans)\n\u5bf9\u4e8e\u6bcf\u4e2a len \u9700\u8981\u5341\u5206\u5feb\u901f O(polylog) \u7684\u56de\u7b54\u8be2\u95ee\n\u5982\u679c\u628a\u4e00\u6761\u76f4\u7ebf y = sum * x + ans \u52a0\u8fdb\u53bb\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u4ed6\u5728 x = len \u5904\u7684\u6700\u5927\u503c\n\u4e0d\uff0c\u53ea\u8981\u51f8\u5305\u5c31\u884c\uff0c\u5f88\u597d\u7684 O(nlog^2n)\n\u4e0d\u5bf9\uff0c\u51f8\u5305\u5982\u679c\u628a\u4e24\u4e2a\u5927\u5411\u91cf\u53c9\u8d77\u6765\uff0c\u5c31\u5f97\u7206\u70b8\uff0c\u7b54\u6848\u53ef\u80fd\u8fbe\u5230 1e17\n\u674e\u8d85\u53ea\u9700\u8981\u6bd4\u8f83\u53d6\u503c\uff0c\u4e0d\u5b58\u5728\u8fd9\u79cd\u4e8b\n*/\n// struct Vec{\n// \tdb x,y;\n// \tVec(){}\n// \tVec(const db _x,const db _y):x(_x),y(_y){}\n// \tVec operator + (const Vec &rhs) const { return Vec(x+rhs.x,y+rhs.y);}\n// \tVec operator - (const Vec &rhs) const { return Vec(x-rhs.x,y-rhs.y);}\n// \tVec operator * (const db &rhs) const { return Vec(x*rhs,y*rhs);}\n// \tdb operator * (const Vec &rhs) const { return this->x*rhs.y-this->y*rhs.x;}\n// };\n// struct line{\n// \tVec u,v;\n// \tdb angle;\n// \tline(){}\n// \tline(const Vec &_u,const Vec &_v):u(_u),v(_v){angle = atan2(_v.y-_u.y,_v.x-_u.x);}\n// };\n// const db eps = 1e-9,PI = acos(-1.0);\n// inline int dcmp(const db &a,const db &b)\n// {\n// \tif(fabs(a - b) < eps)\n// }\nlong long K[N],B[N],tot;\nint tag[N << 2];\nint bac[N << 5],baccnt = 0;\ninline ll calc(int i,int x) { return K[i] * x + B[i];}\n#define ls k<<1\n#define rs k<<1|1\nvoid change(int k,int l,int r,int x)\n{\n\tbac[++baccnt] = k;\n\tif(l == r)\n\t{\n\t\tif((calc(tag[k],l) < calc(x,l))) tag[k] = x;\n\t\treturn;\n\t}\n\tif(!tag[k]) tag[k] = x;\n\telse\n\t{\n\t\tint mid = l + r >> 1;\n\t\tll y1 = calc(tag[k],mid),y2 = calc(x,mid);\n\t\tif(K[tag[k]] < K[x])\n\t\t{\n\t\t\tif(y1 <= y2) { change(ls,l,mid,tag[k]);tag[k] = x;}\n\t\t\telse change(rs,mid+1,r,x);\n\t\t}\n\t\telse if(K[tag[k]] > K[x])\n\t\t{\n\t\t\tif(y1 <= y2) { change(rs,mid+1,r,tag[k]);tag[k] = x;}\n\t\t\telse change(ls,l,mid,x);\n\t\t}\n\t\telse if(B[tag[k]] < B[x]) tag[k] = x;\n\n\t}\n}\nll Qry(int k,int l,int r,int x)\n{\n\tif(l == r) return calc(tag[k],x);\n\tint mid = l + r >> 1;\n\tll res = calc(tag[k],x);\n\tif(x <= mid) res = max(res,Qry(ls,l,mid,x));\n\telse res = max(res,Qry(rs,mid+1,r,x));\n\treturn res;\n}\ninline void clear()\n{\n\twhile(baccnt) tag[bac[baccnt --]] = 0;\n}\nll solve(int l,int r)\n{\n\tif(l == r) return max(0,a[l]);\n\tint mid = l + r >> 1;\n\tll res = max(solve(l,mid),solve(mid+1,r));\n\ttot = 0;\n\tll nowsum = 0,nowans = 0;\n\t++tot;K[tot] = 0;B[tot] = 0;\n\tchange(1,1,n,tot);\n\tfor(int i = mid + 1;i <= r;i++)\n\t{\n\t\tnowsum += a[i];\n\t\tnowans += 1ll * (i - mid) * a[i];\n\t\t++tot;K[tot] = nowsum;B[tot] = nowans;\n\t\t// if(l == 1 && r == n) printf(\"%lld,%lld\\n\",nowsum,nowans);\n\t\tchange(1,1,n,tot);\n\t}\n\tnowsum = 0;nowans = 0;\n\tfor(int i = mid;i >= l;i--)\n\t{\n\t\tint len = mid - i + 1;\n\t\tnowans += sum[mid] - sum[i - 1];\n\t\tres = max(res,nowans + Qry(1,1,n,len));\n\t}\n\tclear();\n\treturn res;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i = 1;i <= n;i++) scanf(\"%d\",&a[i]),sum[i] = sum[i-1] + a[i];\n\tprintf(\"%lld\\n\",solve(1,n));\n\treturn 0;\n}\n```\n",
        "postTime": 1648442617,
        "uid": 226435,
        "name": "\u5929\u547d\u4e4b\u8def",
        "ccfLevel": 0,
        "title": "CF660F Bear and Bowling 4 \u9898\u89e3"
    },
    {
        "content": "\u5148\u8003\u8651\u666e\u901a\u7684dp\u3002\n\n\u8bbe $num1_i$\u4e3a\u524di\u4e2a\u6570\u7684\u548c\uff0c$num2_i$\u4e3a\u524di\u4e2a$j*a_j$\u7684\u548c\u3002\n\n\u5219      \n$v_{i, j} = sum2_i-sum2_j-j*(sum1_i-sum1_j)$   \n$dp_i = max(v_i)$\n\n\u8fd9\u6837\u662f$O(n^2)$\u7684\u3002\n\n\u4e8e\u662f\u5bf9\u4e8e$v$\u6211\u4eec\u8003\u8651\u5c06\u542bi\u7684\u90fd\u79fb\u5230\u5de6\u8fb9\u3002\n\n$v_{i, j} - sum2_i + j * sum1_i = -sum2_j + j * sum1_j$\n\n\u53d1\u73b0\u53ef\u4ee5\u4f7f\u7528\u659c\u7387\u4f18\u5316\uff0c\u5373\n\n$x = j$   \n$y = -sum2_j + j * sum1_j$   \n$k = sum1_i$   \n$b = v_{i, j} - sum2_i$\n\n$x,y$\u662f\u5355\u8c03\u9012\u589e\u7684   \n\n\u6240\u4ee5\u76f4\u63a5\u7ef4\u62a4\u4e0a\u51f8\u58f3\u6765\u627e\u5230\u7b2c\u4e00\u4e2a\u659c\u7387\u5927\u4e8e$sum1_i$\u7684\u5373\u4e3a\u5728\u5f53\u524di\u7684dp\u503c\u3002\u6700\u7ec8\u7b54\u6848\u5c31\u662f\u6700\u5927\u7684dp\u503c\n\n```\n#include <iostream>\n#include <cstdio>\nusing namespace std;\nconst int N = 2e5 + 10;\nlong long a[N], num1[N], num2[N], ans;\nint n;\nint st[N], num;\n#define x(i) (i)\n#define y(i) ((long long)(i) * num1[i] - num2[i])\nlong long gk(int i, int j)\n{\n\treturn (y(i) - y(j)) / (x(i) - x(j));\n}\nint main()\n{\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\tscanf(\"%lld\", &a[i]);\n\t\tnum1[i] = num1[i - 1] + a[i];\n\t\tnum2[i] = num2[i - 1] + a[i] * (long long)i;\n\t}\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\tint l = 0, r = num;\n\t\tfor (; l < r;)\n\t\t{\n\t\t\tint mid = (l + r) >> 1;\n\t\t\tif(gk(st[mid], st[mid + 1]) > num1[i])\n\t\t\t\tl = mid + 1;\n\t\t\telse r = mid;\n\t\t}\n\t\tans = max(ans, num2[i] - num2[st[l]] - (long long)st[l] * (num1[i] - num1[st[l]]));\n\t\twhile(num >= 1 && gk(st[num - 1], st[num]) < gk(st[num], i))-- num;\n\t\tst[++ num] = i;\n\t}\n\tprintf(\"%lld\\n\", ans);\n}\n```\n",
        "postTime": 1600784278,
        "uid": 111728,
        "name": "\u5e7b\u5f71\u661f\u575a\u5f3a",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF660F \u3010Bear and Bowling 4\u3011"
    },
    {
        "content": "\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5148\u5c06\u5e8f\u5217\u7ffb\u8f6c\uff0c\u8bbe $s_i = \\sum_{j=1}^{i}{a_j}$\uff0c\u90a3\u4e48\u679a\u4e3e\u533a\u95f4\u7684\u53f3\u7aef\u70b9 $i$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u5de6\u7aef\u70b9 $i$\uff0c\u8bbe $t_x=\\sum_{k=x+1}^{i}s_k$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u7684\u6743\u503c\u5c31\u662f $t_{x+1}-(i-x)s_x$\uff0c\u6211\u4eec\u628a\u6bcf\u4e2a $x$ \u770b\u6210\u4e00\u4e2a $k=-s_x,b=t_{x+1}+xs_x$ \u7684\u7ebf\u6bb5\uff0c\u674e\u8d85\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6700\u503c\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=2e5+5;\nconst ll INF=1e18;\nint n,a[N],t[N<<2];\nll s[N],k[N<<2],b[N<<2],tag;\nll calc(int p,int x){\n    if(p==-1)return -INF;\n    return k[p]*x+b[p]+tag;\n}\nvoid change(int p,int l,int r,int v){\n    if(calc(t[p],l)<calc(v,l)&&calc(t[p],r)<calc(v,r))return t[p]=v,void();\n    if(calc(t[p],l)>=calc(v,l)&&calc(t[p],r)>=calc(v,r))return;\n    if(l==r)return;int mid=l+r>>1;\n    change(p<<1,l,mid,v);change(p<<1|1,mid+1,r,v);\n}\nll ask(int p,int l,int r,int x){\n    if(l==r)return calc(t[p],x);\n    int mid=l+r>>1;ll ret=calc(t[p],x);\n    if(x<=mid)ret=max(ret,ask(p<<1,l,mid,x));\n    else ret=max(ret,ask(p<<1|1,mid+1,r,x));\n    return ret;\n}\nint main(){\n    memset(t,-1,sizeof(t));\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n    reverse(a+1,a+n+1);\n    for(int i=1;i<=n;i++)s[i]=s[i-1]+a[i];\n    ll ans=0;k[0]=0;b[0]=0;\n    change(1,0,n,0);\n    for(int i=1;i<=n;i++){\n        tag+=s[i];\n        ans=max(ans,ask(1,0,n,i));\n        k[i]=-s[i];b[i]=i*s[i]-tag;\n        change(1,0,n,i);\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1667467746,
        "uid": 225183,
        "name": "\u5468\u5c0f\u6db5",
        "ccfLevel": 0,
        "title": "CF660F Bear and Bowling 4"
    }
]