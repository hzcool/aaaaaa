[
    {
        "content": "> D. [CF623E Transforming Sequence](https://www.luogu.com.cn/problem/CF623E) *3300\n\n\u633a\u6ca1\u6280\u672f\u542b\u91cf\u7684\u4e00\u9053\u9898\u3002\u6bd4 CF755G \u8fd8\u8981\u7b80\u5355\u7684\u500d\u589e NTT\u3002\n\n\u5f53 $n > k$ \u65f6\u7b54\u6848\u4e3a $0$\uff0c\u4ee5\u4e0b\u9ed8\u8ba4 $n \\leq k$\u3002\n\n\u8bbe $f_{i, j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u6216\u8d77\u6765\u4e8c\u8fdb\u5236\u4e0a\u6709 $j$ \u4e2a $1$ \u7684\u65b9\u6848\u6570\uff08\u53ea\u662f\u5355\u7eaf\u8003\u8651\u8fd9 $j$ \u4e2a $1$\uff0c\u5143\u7d20\u4e4b\u95f4\u65e0\u5e8f\uff0c\u4e14 **\u5ffd\u7565\u6389\u5269\u4e0b\u6765 $k - j$ \u4e2a\u4f4d\u7f6e\u7684\u5b58\u5728**\uff09\uff0c\u8f6c\u79fb\u4e3a\n$$\nf_{i, j} = \\sum\\limits_{p = 1} ^ {j} f_{i - 1, j - p} \\dbinom j p 2 ^ {j - p}\n$$\n\u542b\u4e49\u662f\u4ece $j$ \u7684 $1$ \u7684\u4f4d\u7f6e\u4e2d\u9009 $p$ \u4e2a\u653e\u65b0\u7684 $1$\uff0c\u5269\u4e0b $2 ^ {j - p}$ \u4e2a\u4f4d\u7f6e\u4efb\u9009\u3002\n\n\u5f88\u597d\uff0c\u8fd9\u5f88\u5377\u79ef\u3002\n\n\u628a\u7ec4\u5408\u6570\u62c6\u6389\uff0c\u6709\n$$\nf_{i, j} = j!\\sum\\limits_{p = 1} ^ {j} \\dfrac{f_{i - 1, j - p}}{(j - p)!} p! 2 ^ {j - p}\n$$\n\u7b54\u6848\u5373 $\\sum\\limits_{j = 0} ^ k \\dbinom k j f_{k, j}$\u3002\n\n\u8fd9\u6837\u6709\u4e86\u4e00\u4e2a\u505a $n$ \u904d\u5377\u79ef\u7684 $\\mathcal{O}(nk\\log k)$ \u8fc7\u4e0d\u53bb\u505a\u6cd5\u3002\n\n\u6ce8\u610f\u5230\u6bcf\u6b21\u8f6c\u79fb\u7684\u5f0f\u5b50\u4e00\u6a21\u4e00\u6837\uff0c\u8003\u8651\u5206\u6cbb\u3002\n\n\u8003\u5bdf $f_{i, j}$ \u548c $f_{i', j'}$ \u4e24\u4e2a\u503c\uff0c\u5b83\u4eec\u4f1a\u5408\u5e76\u5230 $f_{i + i', j + j'}$\u200b\u3002\u5c1d\u8bd5\u63a2\u7a76\u5176\u7cfb\u6570\u3002\n\n\u4ece\u5b9e\u9645\u610f\u4e49\u89d2\u5ea6\u51fa\u53d1\uff0c\u4ece $j + j'$ \u4e2a\u4f4d\u7f6e\u4e2d\u9009\u62e9 $j$ \u4e2a\u4f4d\u7f6e\u5f52\u5230 $f_{i, j}$ \u5bf9\u5e94\u7684 $1$\uff0c\u5269\u4e0b\u6765\u7684\u4f4d\u7f6e\u5f52\u5230 $f_{i', j'}$ \u5bf9\u5e94\u7684 $1$\u3002\u6b64\u5916\uff0c\u5bf9\u4e8e\u540e $i'$ \u4e2a\u4e0b\u6807\uff0c\u6bcf\u4e2a\u4e0b\u6807\u4e0a\u90fd\u6709 $j$ \u4e2a\u4f4d\u7f6e\u53ef\u4ee5\u81ea\u7531\u9009\u3002\u7efc\u4e0a\uff0c\u5f97\u5230 $f_{i, j}$ \u548c $f_{i', j'}$ \u7684\u5408\u5e76\u7cfb\u6570 $\\dbinom {j + j'} j 2 ^ {i'j}$\u3002\n\n\u8bbe $a + b = i(a, b > 0)$\uff0c\u5219\u8f6c\u79fb\u5f0f\u5373\n$$\nf_{i, j} = \\sum\\limits_{p = 0} ^ j f_{a, p} f_{b, j - p} \\dbinom j p 2 ^ {bp}\n$$\n\u5bb9\u6613\u5199\u6210\u5377\u79ef\u5f62\u5f0f\n$$\nf_{i, j} = j! \\sum\\limits_{p = 0} ^ j \\dfrac{f_{a, p} 2 ^ {bp}}{p!} \\dfrac{f_{b, j - p}}{(j - p)!}\n$$\n\n\u76f4\u63a5\u53d6 $i$ \u7684\u4e00\u534a\u5206\u6cbb\u9012\u5f52\u5373\u53ef\u3002\u6ce8\u610f\u52a0\u4e0a\u8bb0\u5fc6\u5316\u3002\u5982\u679c\u76f4\u63a5\u9012\u5f52 $a$ \u7b49\u4e8e $i$ \u9664\u4ee5 $2$ \u4e0b\u53d6\u6574\uff0c\u9012\u5f52 $b = i - a$ \u4f46\u4e0d\u52a0\u8bb0\u5fc6\u5316\uff0c\u53ef\u4ee5\u88ab\u5361\u7206\uff0c\u56e0\u4e3a\u5f53 $n$ \u662f\u5947\u6570\u65f6\uff0c\u4e3b\u5b9a\u7406\u5206\u6790 $T(n) = 2T(\\frac n 2) + \\mathcal{O}(1)$ \u89e3\u5f97\u8981\u505a $\\mathcal{O}(n)$ \u6b21\u5377\u79ef\uff0c\u7206\u70b8\u3002\u53e6\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u662f\u76f4\u63a5\u9012\u5f52 $a$\uff0c\u5f53 $i$ \u662f\u5947\u6570\u65f6\u5148\u505a\u4e00\u904d\u4e00\u6b65\u8f6c\u79fb\u5377\u79ef\u5f97\u5230 $f_b$ \u518d\u5408\u5e76 $f_a$ \u548c $f_b$\u3002\n\n\u8981\u5199\u4e09\u6a21 NTT \u6216 MTT\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ull unsigned long long\nconst int N = 1 << 16;\nconst int mod = 1e9 + 7;\nint ksm(int a, int b, int p) {\n\tint s = 1;\n\twhile(b) {\n\t\tif(b & 1) s = 1ll * s * a % p;\n\t\ta = 1ll * a * a % p, b >>= 1;\n\t}\n\treturn s;\n}\nlong long n;\nint k, ans, rev[N];\nint fc[N], ifc[N];\nvoid NTT(vector <int> &a, int op, int p) {\n\tstatic ull f[N], w[N];\n\tfor(int i = 0; i < N; i++) f[i] = a[rev[i]];\n\tfor(int k = 1; k < N; k <<= 1) {\n\t\tint wn = ksm(op ? 3 : ksm(3, p - 2, p), (p - 1) / k / 2, p); // mod -> p =.= \u6a21\u6570\u522b\u5199\u9519\u4e86\n\t\tfor(int i = w[0] = 1; i < k; i++) w[i] = w[i - 1] * wn % p;\n\t\tfor(int i = 0; i < N; i += k << 1)\n\t\t\tfor(int j = 0; j < k; j++) {\n\t\t\t\tint y = w[j] * f[i | j | k] % p;\n\t\t\t\tf[i |j | k] = f[i | j] + p - y, f[i | j] += y;\n\t\t\t}\n\t}\n\tint coef = op ? 1 : ksm(N, p - 2, p);\n\tfor(int i = 0; i < N; i++) a[i] = f[i] % p * coef % p;\n}\nvector <int> conv(vector <int> a, vector <int> b, int p) {\n\tNTT(a, 1, p), NTT(b, 1, p);\n\tfor(int i = 0; i < N; i++) a[i] = 1ll * a[i] * b[i] % p;\n\treturn NTT(a, 0, p), a;\n}\nvector <int> operator * (vector <int> a, vector <int> b) { // add operator\n\tfor(int i = N >> 1; i < N; i++) a[i] = b[i] = 0;\n\t__int128 p[3] = {998244353, 1004535809, 469762049}, M = p[0] * p[1] * p[2];\n\tvector <int> res[3];\n\tfor(int i = 0; i < 3; i++) res[i] = conv(a, b, p[i]);\n\tfor(int i = 0; i < N; i++) {\n\t\t__int128 v = 0;\n\t\tfor(int j = 0; j < 3; j++) v += res[j][i] * (M / p[j]) * ksm((M / p[j]) % p[j], p[j] - 2, p[j]);\n\t\ta[i] = v % M % mod;\n\t}\n\treturn a;\n}\nmap <int, vector <int>> mp;\nvector <int> solve(int n) {\n\tvector <int> ans(N, 0);\n\tif(n == 1) {\n\t\tfor(int i = 1; i <= k; i++) ans[i] = 1;\n\t\treturn ans;\n\t}\n\tif(mp.find(n) != mp.end()) return mp[n];\n\tint a = n >> 1, b = n - a, pw = ksm(2, b, mod), coef = 1;\n\tvector <int> f = solve(a), g = solve(b), h;\n\tfor(int i = 1; i <= k; i++) f[i] = 1ll * f[i] * (coef = 1ll * coef * pw % mod) % mod * ifc[i] % mod;\n\tfor(int i = 1; i <= k; i++) g[i] = 1ll * g[i] * ifc[i] % mod;\n\th = f * g;\n\t// for(int i = 1; i <= k; i++) cout << h[i] << endl;\n\tfor(int i = 1; i <= k; i++) h[i] = 1ll * h[i] * fc[i] % mod;\n\treturn mp[n] = h;\n}\nint main() {\n\t// freopen(\"1.in\", \"r\", stdin);\n\tfor(int i = 0; i < N; i++) rev[i] = (rev[i >> 1] >> 1) | (i & 1) << 15;\n\tfor(int i = fc[0] = 1; i < N; i++) fc[i] = 1ll * fc[i - 1] * i % mod;\n\tifc[N - 1] = ksm(fc[N - 1], mod - 2, mod);\n\tfor(int i = N - 2; ~i; i--) ifc[i] = 1ll * ifc[i + 1] * (i + 1) % mod;\n\tcin >> n >> k;\n\tif(n > k) puts(\"0\"), exit(0);\n\tvector <int> res = solve(n);\n\tfor(int i = 1; i <= k; i++) ans = (ans + 1ll * res[i] * fc[k] % mod * ifc[i] % mod * ifc[k - i]) % mod;\n\tcout << ans << endl;\n\treturn cerr << clock() << endl, 0;\n}\n\n/*\n2022/4/28\nstart thinking at 21:26\n\n\u6bd4 CF755G \u8fd8\u8981\u7b80\u5355\u7684\u500d\u589e NTT.\nf_{i, j} \u8868\u793a n = i, \u6709 j \u4e2a 1 \u65f6\u7684\u7b54\u6848.\n\nsb \u9519\u8bef: \u4e0b\u6807\u4e0a\u754c\u4e3a k \u800c\u4e0d\u662f n!\nmod \u548c p \u522b\u641e\u6df7\u4e86. \u591a\u6a21 NTT \u4e0d\u719f\u7ec3.\n\u8001\u8001\u5b9e\u5b9e\u505a\u5377\u79ef.\n\u6ce8\u610f f * g \u65f6 g \u8981\u5148\u9664\u6389\u94a6\u5b9a\u987a\u5e8f\u7684 binom(k, j)\n\n=.= \u6709\u4e2a\u5730\u65b9\u5fd8\u53d6\u6a21\u4e86\n\nfinish debugging at 23:04\n*/\n```",
        "postTime": 1651541233,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "CF623E Transforming Sequence"
    },
    {
        "content": "# Transforming Sequence\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF623E)\n## \u601d\u8def\n\u5dee\u70b9\u81ea\u95ed\u3002\u3002\u3002\n\n\u6211\u4eec\u8bbe$dp[i][j]$\u8868\u793a\u524d\u9762$i$\u4e2a\u6570\u7684\u6216\u503c\u6709$j$\u4f4d\u4e3a\u4e00\uff0c\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\u5f0f:\n\n$$dp[i][j]=\\sum_{k=0}^{j} dp[i-1][k]\\binom{j}{k}2^{k}$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u5e94\u8be5\u5f88\u597d\u7406\u89e3\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8fdb\u884c\u89e3\u91ca\u4e86\u3002\n\n\u8fb9\u754c\u6761\u4ef6\u5c31\u662f$dp[1][0]=0,dp[1][i]=1(i\\le k)$\u3002\n\n\u6211\u4eec\u53c8\u53d1\u73b0:\n\n$$dp[n+m][i]=\\sum_{j=0}^{i} dp[n][j]\\times dp[m][i-j]\\binom{i}{j}2^{m\\times j}$$\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u500d\u589e\u89e3\u51b3\u4e86\u3002\u5373:\n\n$$dp[2n][i]=\\sum_{j=0}^{i} dp[n][j]\\times dp[n][i-j]\\binom{i}{j}2^{n\\times j}$$\n\n\u8fd9\u90fd\u4e0d\u662f\u96be\u70b9\uff0c\u5176\u5b9e\u8fd9\u9053\u9898\u96be\u70b9\u5728\u4e8e\u4efb\u610f\u6a21\u6570$\\text {NTT}$\uff0c\u5dee\u70b9\u628a\u6211\u641e\u81ea\u95ed\u4e86\u3002\n## $\\text {Code}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define Int register int\n#define ll long long \n#define MAXN 502151\n\nint quick_pow (int a,int b,int c){\n\tint res = 1;\n\twhile (b){\n\t\tif (b & 1) res = 1ll * res * a % c;\n\t\ta = 1ll * a * a % c;\n\t\tb >>= 1;\n\t}\n\treturn res;\n}\n\nint inv (int x,int mod){\n\treturn quick_pow (x,mod - 2,mod);\n}\n\nint mod = 1e9 + 7,mod1 = 998244353,mod2 = 1004535809,mod3 = 469762049,G = 3;\nll mod_1_2 = 1ll * mod1 * mod2;\nint inv1 = inv (mod1,mod2),inv2 = inv (mod_1_2 % mod3,mod3);\n\nstruct NewInt{\n\tint A,B,C;\n\tNewInt (){}\n\tNewInt (int _num) : A (_num),B (_num),C (_num) {}\n\tNewInt (int _A,int _B,int _C) : A (_A),B (_B),C (_C) {}\n\tNewInt reduce (const NewInt &x){\n\t\treturn NewInt (x.A + (x.A >> 31 & mod1),x.B + (x.B >> 31 & mod2),x.C + (x.C >> 31 & mod3));\n\t} \n\tNewInt operator + (const NewInt &x){\n\t\treturn reduce (NewInt (A + x.A - mod1,B + x.B - mod2,C + x.C - mod3));\n\t}\n\tNewInt operator - (const NewInt &x){\n\t\treturn reduce (NewInt (A - x.A,B - x.B,C - x.C));\n\t}\n\tNewInt operator * (const NewInt &x){\n\t\treturn NewInt (1ll * A * x.A % mod1,1ll * B * x.B % mod2,1ll * C * x.C % mod3);\n\t}\n\tint get (){\n\t\tll x = 1ll * (B - A + mod2) % mod2 * inv1 % mod2 * mod1 + A;\n\t\treturn (1ll * (C - x % mod3 + mod3) % mod3 * inv2 % mod3 * (mod_1_2 % mod) % mod + x) % mod;\n\t}\n};\n\nnamespace Poly{\n\tint limit,rev[MAXN << 1];\n\tNewInt Wn[MAXN << 1 | 1];\n\tvoid Init (int N){\n\t\tlimit = 1;int logn = 0;\n\t\twhile (limit < N) limit <<= 1,logn ++;\n\t\tfor (int i = 0;i < limit;++ i) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << logn - 1);\n\t\tNewInt t = NewInt (quick_pow (G,(mod1 - 1) / limit,mod1),quick_pow (G,(mod2 - 1) / limit,mod2),quick_pow (G,(mod3 - 1) / limit,mod3));\n\t\t*Wn = NewInt (1);for (NewInt *i = Wn;i != Wn + limit;++ i) *(i + 1) = *i * t;\n\t} \n\tvoid NTT (NewInt *a,int type){\n\t\tfor (int i = 1;i < limit;++ i) if (i < rev[i]) swap (a[i],a[rev[i]]);\n\t\tfor (int mid = 1;mid < limit;mid <<= 1){\n\t\t\tint t = limit / mid >> 1;\n\t\t\tfor (int i = 0;i < limit;i += mid << 1)\n\t\t\t\tfor (int j = 0;j < mid;++ j){\n\t\t\t\t\tNewInt W = (type == 1 ? Wn[t * j] : Wn[limit - t * j]);\n\t\t\t\t\tNewInt X = a[i + j],Y = W * a[i + j + mid];\n\t\t\t\t\ta[i + j] = X + Y,a[i + j + mid] = X - Y;\n\t\t\t\t}\n\t\t}\n\t\tif (type == 1) return ;\n\t\tNewInt Inv = NewInt (inv (limit,mod1),inv (limit,mod2),inv (limit,mod3));\n\t\tfor (NewInt *i = a;i != a + limit;++ i) *i = *i * Inv;\n\t}\n};\n\nvoid Multi (NewInt *a,NewInt *b){\n\tPoly::NTT (a,1),Poly::NTT (b,1);\n\tfor (Int i = 0;i < Poly::limit;++ i) a[i] = a[i] *b[i];\n\tPoly::NTT (a,-1);\n}\n\nll n;int k;\nNewInt A[MAXN << 1],B[MAXN << 1];\n\nint fac[MAXN];\n\nvoid Solve (int now){\n\tif (now == 1){\n\t\tA[0] = NewInt (0);\n\t\tfor (Int i = 1;i <= k;++ i) A[i] = NewInt (inv (fac[i],mod));\n\t\treturn ;\n\t}\n\tSolve (now >> 1);\n\tB[0] = NewInt (0);\n\tfor (Int i = 1;i <= k;++ i) B[i] = NewInt (1ll * A[i].get() * quick_pow (2,1ll * (now >> 1) * i % (mod - 1),mod) % mod);\n\tfor (Int i = k + 1;i < Poly::limit;++ i) A[i] = B[i] = NewInt (0);\n\tMulti (A,B);\n\tif (now & 1){\n\t\tB[0] = NewInt (0);\n\t\tfor (Int i = 1;i <= k;++ i){\n\t\t\tint x = A[i].get();\n\t\t\tA[i] = NewInt (1ll * x * quick_pow (2,i,mod) % mod);\n\t\t\tB[i] = NewInt (inv (fac[i],mod));\n\t\t}\n\t\tfor (Int i = k + 1;i < Poly::limit;++ i) A[i] = B[i] = NewInt (0);\n\t\tMulti (A,B);\n\t}\n\tfor (Int i = 0,x;i <= k;++ i) x = A[i].get(),A[i] = NewInt (x);\n}\n \ntemplate <typename T> inline void read (T &t){t = 0;char c = getchar();int f = 1;while (c < '0' || c > '9'){if (c == '-') f = -f;c = getchar();}while (c >= '0' && c <= '9'){t = (t << 3) + (t << 1) + c - '0';c = getchar();} t *= f;}\ntemplate <typename T,typename ... Args> inline void read (T &t,Args&... args){read (t);read (args...);}\ntemplate <typename T> inline void write (T x){if (x < 0){x = -x;putchar ('-');}if (x > 9) write (x / 10);putchar (x % 10 + '0');}\n\nsigned main(){\n\tread (n,k);\n\tif (n > k){\n\t\tputs (\"0\");\n\t\treturn 0;\n\t}\n\tPoly::Init (k * 2 + 10);\n\tfac[0] = 1;\n\tfor (Int i = 1;i <= k;++ i) fac[i] = 1ll * fac[i - 1] * i % mod;\n\tSolve (n);\n\tint ans = 0;\n\tfor (Int i = 1;i <= k;++ i)\tans = (ans + 1ll * A[i].get() * fac[k] % mod * inv(fac[k - i],mod) % mod) % mod;\n\twrite (ans),putchar ('\\n');\n\treturn 0; \n}\n```",
        "postTime": 1592008952,
        "uid": 124781,
        "name": "Walking_Dead",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "\u8fd9\u4e2a\u9898\u597d\u554a\uff0c\u4e09\u7bc7\u9898\u89e3\u90fd\u662f\u4e0d\u4e00\u6837\u7684\u601d\u8def\uff01\n\n\u9996\u5148\uff0c\u6211\u4eec\u628a\u9898\u610f\u8f6c\u5316\u4e3a\u6709 $n$ \u4e2a\u96c6\u5408\uff0c$k$ \u79cd\u5143\u7d20\u3002\u6bcf\u4e2a\u96c6\u5408\u91cc\u5fc5\u987b\u6709\u65b0\u7684\u5143\u7d20\uff0c\u6bcf\u4e2a\u96c6\u5408\u4e4b\u524d\u7684\u96c6\u5408\u5143\u7d20\u53ef\u4ee5\u9009\u62e9\u52a0\u5165\u6216\u4e0d\u52a0\u5165\uff0c\u6c42\u4e0d\u540c\u7684\u96c6\u5408\u6570\u3002\n\n\u663e\u7136 $n > k$ \u65f6\u7b54\u6848\u4e3a $0$\u3002\n\n\u4ee5\u4e0b\u9ed8\u8ba4\u5df2\u7279\u5224\u6b64\u60c5\u51b5\u3002\n\n\u6211\u4eec\u8003\u8651\u9012\u63a8\u7b54\u6848\u3002\u8bbe $f_{i, j}$ \u8868\u793a\u524d $i$ \u4e2a\u96c6\u5408\uff0c\u51fa\u73b0\u4e86\u524d $j$ \u79cd\u5143\u7d20\u7684\u65b9\u6848\u6570\uff08\u6211\u4eec\u5047\u8bbe\u5143\u7d20\u5df2\u7ecf\u4ece $1$ \u81f3 $k$ \u6807\u53f7\uff09\u3002\u5219\u7b54\u6848\u4e3a $\\sum _{i=n}^k f_{n, i}\\times A_k^i$\uff0c\u5176\u4e2d $A_k^i$ \u4e3a\u6392\u5217\u6570\uff0c\u8868\u793a\u4e0d\u540c\u7684\u6807\u53f7\u65b9\u6848\u3002\n\n\u5219\u6709\n\n$$f_{i, j}=\\sum_{l=i-1}^{j-1} \\frac{f_{i-1, l}\\times 2^l}{(j-l)!}$$\n\n\u8fb9\u754c\u4e3a $f_{0, 0}=1$\u3002\n\n\u5176\u4e2d\u56e0\u4e3a\u5df2\u6709 $l$ \u79cd\u5143\u7d20\uff0c\u6bcf\u79cd\u90fd\u53ef\u4ee5\u9009\u6216\u4e0d\u9009\uff0c\u6240\u4ee5\u4e58 $2^l$\u3002\u56e0\u4e3a\u5355\u4e2a\u96c6\u5408\u91cc\u5143\u7d20\u7531\u6392\u5217\u5173\u7cfb\u53d8\u4e3a\u7ec4\u5408\u5173\u7cfb\uff0c\u6240\u4ee5\u9700\u8981\u9664\u4ee5 $(j-k)!$\u3002\n\n\u7531\u4e8e\u8f6c\u79fb\u90fd\u662f $i - 1 \\to i$\uff0c\u6211\u4eec\u53ef\u4ee5\u9664\u53bb\u7b2c\u4e00\u7ef4\u3002\u5219\u6709 \n\n$$f_j=\\sum_{l=i-1}^{j-1} \\frac{f_l\\times 2^l}{(j-l)!}$$\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u5c06 $2^l$ \u4e58\u5165\u72b6\u6001\uff0c\u5373 $f_i$ \u8868\u793a\u51fa\u73b0\u4e86 $i$ \u79cd\u5143\u7d20\u7684\u65b9\u6848\u6570\u4e58 $2^i$ \u7684\u503c\u3002\u5219\u6709\n\n$$f_j=2^j\\sum_{l=i-1}^{j-1} \\frac{f_l}{(j-l)!}$$\n\n\u6700\u7ec8\u7b54\u6848\u4e3a\n\n$$\\sum _{i=n}^k \\frac{f_{n, i}\\times A_k^i}{2^i}$$\n\n\u6211\u4eec\u89c2\u5bdf\u9012\u63a8\u5f0f\uff0c\u53d1\u73b0\u540e\u9762\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u591a\u9879\u5f0f\u4e58\u6cd5\u5c06\u5176\u65f6\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u81f3 $O(nk\\log k)$\u3002\n\n\u6211\u4eec\u73b0\u5728\u8003\u8651\u5982\u4f55\u52a0\u901f\u8fd9\u4e00\u8fc7\u7a0b\u3002\u53d1\u73b0\u6211\u4eec\u5c06\u91cd\u590d\u7684\u64cd\u4f5c\u8fdb\u884c\u4e86 $n$ \u904d\uff0c\u80fd\u5426\u8fdb\u884c\u500d\u589e\u5462\uff1f\u53d1\u73b0 $2^i$ \u96be\u4ee5\u5904\u7406\u3002\n\n\u6211\u4eec\u8bbe $g_i=\\frac 1{i!}$\uff0c\u5219\u6709 $f'_i=2^i \\sum_j f_jg_{i-j}$\u3002\u5176\u4e2d $\\ast$ \u8868\u793a\u5377\u79ef\u3002\n\n$$f'=\\sum_i 2^i(\\sum_j f_jg_{i-j})x^i=\\sum_i (\\sum_j f_jg_{i-j})(2x)^i=\\sum_i f(2x)\\ast g(2x)$$\n\n\u8fdb\u884c\u8fed\u4ee3\uff0c\u4e0d\u96be\u53d1\u73b0\u6700\u7ec8\u7b54\u6848\u4e3a $\\prod_{i=1}^n g(2^ix)$\u3002\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u8fdb\u884c\u500d\u589e\uff0c\u8bbe $P_n(x) =\\prod_{i=1}^n g(2^ix)$\uff0c\u5219\u6709 $P_{2n}(x)=P_n(x) \\ast P_n(2^nx)$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O((n+k)\\log n\\log k)$\u3002\n\n\u6ce8\u610f\u6a21\u6570\u4e3a $10^9+7$\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u4e00\u4e2a\u4efb\u610f\u6a21\u6570 NTT\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n\nconst int Maxn = 1 << 19 | 5, bloc = 100000;\nconst long long p1 = 469762049, p2 = 998244353, p3 = 1004535809, p = 1e9 + 7;\nint rev[Maxn];\nlong long fac[Maxn], inv[Maxn], Pow2[Maxn], big_Pow2[Maxn];\nvoid get_rev(int len)\n{\n\tfor (int i = 0; i < len; i++)\n\t\trev[i] = (rev[i >> 1] >> 1) | ((i & 1) * (len >> 1));\n}\nlong long fast_pow(long long x, long long y, long long mod = p)\n{\n\tlong long ans = 1, now = x;\n\twhile (y)\n\t{\n\t\tif (y & 1) ans = ans * now % mod;\n\t\tnow = now * now % mod;\n\t\ty >>= 1;\n\t}\n\treturn ans;\n}\nvoid NTT(long long now[], int len, int p, bool type = false)\n{\n\tlong long inv3 = fast_pow(3, p - 2, p);\n\tget_rev(len);\n\tfor (int i = 0; i < len; i++)\n\t\tif (i < rev[i]) swap(now[i], now[rev[i]]);\n\tfor (int i = 1; i < len; i <<= 1)\n\t{\n\t\tlong long w = fast_pow(type ? inv3 : 3, (p - 1) / (i << 1), p);\n\t\tfor (int j = 0; j < len; j += (i << 1))\n\t\t{\n\t\t\tlong long l = 1;\n\t\t\tfor (int k = j; k < i + j; k++, l = l * w % p)\n\t\t\t{\n\t\t\t\tlong long x = now[i + k] * l % p, y = now[k];\n\t\t\t\tnow[k] = (x + y) % p;\n\t\t\t\tnow[i + k] = (y - x + p) % p;\n\t\t\t}\n\t\t}\n\t}\n\tif (type)\n\t{\n\t\tlong long inv = fast_pow(len, p - 2, p);\n\t\tfor (int i = 0; i < len; i++)\n\t\t\tnow[i] = now[i] * inv % p;\n\t}\n}\nvoid multi(long long x[], long long y[], long long ans[], int len, int p)\n{\n\tget_rev(len);\n\tstatic long long tmpx[Maxn], tmpy[Maxn];\n\tmemcpy(tmpx, x, sizeof(long long[len]));\n\tmemcpy(tmpy, y, sizeof(long long[len]));\n\tNTT(tmpx, len, p), NTT(tmpy, len, p);\n\tfor (int i = 0; i < len; i++)\n\t\tans[i] = tmpx[i] * tmpy[i] % p;\n\tNTT(ans, len, p, true);\n}\nvoid multi(long long x[], long long y[], int len)\n{\n\tstatic long long ans1[Maxn], ans2[Maxn], ans3[Maxn];\n\tmulti(x, y, ans1, len, p1), multi(x, y, ans2, len, p2), multi(x, y, ans3, len, p3);\n\tlong long inv_p1 = fast_pow(p1, p2 - 2, p2), inv_p12 = fast_pow(p1 * p2 % p3, p3 - 2, p3);\n\tfor (int i = 0; i < len; i++)\n\t{\n\t\tlong long k1 = (ans2[i] - ans1[i] + p2) * inv_p1 % p2;\n\t\tlong long tmp = (ans1[i] + k1 * p1) % (p1 * p2);\n\t\tlong long k2 = (ans3[i] - tmp % p3 + p3) * inv_p12 % p3;\n\t\tx[i] = (tmp + k2 * p1 % p * p2 % p) % p;\n\t}\n}\nlong long pow2(int x)\n{\n\treturn Pow2[x % bloc] * big_Pow2[x / bloc] % p;\n}\nlong long * work(long long now[], int t, int len)\n{\n\tstatic long long tmp[Maxn];\n\tmemset(tmp, 0, sizeof(len));\n\tfor (int i = 0; i < len; i++)\n\t\ttmp[i] = now[i] * pow2(i * t % (p - 1)) % p;\n\treturn tmp;\n}\nvoid poly_pow(long long x[], long long ans[], int y, int len)\n{\n\tint res = 1, Now = 1;\n\tstatic long long now[Maxn];\n\tmemcpy(now, x, sizeof(long long[len]));\n\tans[0] = 1;\n\twhile (y)\n\t{\n\t\tif (y & 1) multi(ans, work(now, res, len << 1), len << 1), res += Now;\n\t\tmulti(now, work(now, Now, len << 1), len << 1);\n\t\tfor (int i = len; i < (len << 1); i++)\n\t\t\tnow[i] = ans[i] = 0;\n\t\ty >>= 1;\n\t\tNow <<= 1;\n\t}\n}\nint k;\nlong long n;\nvoid init(void)\n{\n\tfac[0] = 1;\n\tfor (int i = 1; i <= k; i++)\n\t\tfac[i] = fac[i - 1] * i % p;\n\tinv[k] = fast_pow(fac[k], p - 2);\n\tfor (int i = k - 1; i >= 0; i--)\n\t\tinv[i] = inv[i + 1] * (i + 1) % p;\n\tPow2[0] = big_Pow2[0] = 1;\n\tfor (int i = 1; i <= bloc; i++)\n\t\tPow2[i] = Pow2[i - 1] * 2 % p;\n\tfor (int i = 1; i <= bloc; i++)\n\t\tbig_Pow2[i] = big_Pow2[i - 1] * Pow2[bloc] % p;\n}\nint lower(int x)\n{\n\tint tmp = 1;\n\tfor (; tmp < x; tmp <<= 1);\n\treturn tmp;\n}\nlong long tot, g[Maxn], ans[Maxn];\nlong long A(int x, int y)\n{\n\treturn fac[x] * inv[x - y] % p;\n}\nint main()\n{\n\tscanf(\"%lld%d\", &n, &k);\n\tif (n > k)\n\t{\n\t\tputs(\"0\");\n\t\treturn 0;\n\t}\n\tk++;\n\tinit();\n\tfor (int i = 1; i < k; i++)\n\t\tg[i] = inv[i];\n\tpoly_pow(g, ans, n, lower(k));\n\tfor (int i = n; i < k; i++)\n\t\t(tot += ans[i] * A(k - 1, i) % p * fast_pow(Pow2[i], p - 2) % p) %= p;\n\tprintf(\"%lld\", tot);\n\treturn 0;\n}\n```",
        "postTime": 1584119895,
        "uid": 49093,
        "name": "_sys",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://codeforces.com/problemset/problem/623/E)\n\n---\n\n**\u3010\u5206\u6790\u3011**\n--\n\n\u4e0d\u96be\u60f3\u5230\uff0c\u4ee4 $f_{n, k}$ \u8868\u793a\u524d $n$ \u4e2a\u6570\uff0c\u4f7f\u5f97 $b_n$ \u6709 $k$ \u4e2a $1$ \u7684\u65b9\u6848\u6570\u3002\n\n\u5219\u5f88\u5bb9\u6613\u5217\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff0c\u7531\u4e8e $a_i>0$ \uff0c\u6545 $\\displaystyle f_{n, k}=\\sum_{i=0}^{k-1} \\binom k if_{n-1, i}\\cdot 2^i$ \u3002\n\n\u53d8\u5f62\u5f97\u5230 $\\displaystyle {f_{n, k}\\over k!}x^k=\\sum_{i+j=k} {f_{n-1,i}\\cdot 2^i\\over i!}x^i\\cdot {[j>0]\\over j!}x^j$ \u3002\n\n\u56e0\u6b64\u5f97\u5230\u751f\u6210\u51fd\u6570\u7684\u8f6c\u79fb\u5173\u7cfb $\\displaystyle \\hat F_{n}(x)=\\hat F_{n-1}(2x)\\cdot (e^x-1)$ \u3002\n\n\u800c\u7531 $f_{0, k}=[k=0]$ \u5f97\u5230 $\\hat F_0(x)=1$ \u3002\n\n\u5217\u4e3e\u51e0\u9879\u5f97\u5230 $\\hat F_1(x)=e^x-1, \\hat F_2(x)=(e^{2x}-1)(e^x-1), \\hat F_3(x)=(e^{4x}-1)(e^{2x}-1)(e^x-1)$ \u3002\n\n\u731c\u60f3 $\\displaystyle \\hat F_n(x)=\\prod_{i=0}^{n-1} (e^{2^ix}-1)$ \uff0c\u82e5\u5bf9 $n\\leq m$ \u65f6\u6210\u7acb\u3002\n\n\u5219 $\\displaystyle \\hat F_{m+1}(x)=\\hat F_m(x)(2x)\\cdot (e^x-1)=\\prod_{i=0}^{m-1}(e^{2^i\\cdot 2x}-1)\\cdot (e^x-1)=\\prod_{i=0}^m (e^{2^ix}-1)$ \u3002\n\n\u7531\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\u731c\u60f3\u6b63\u786e\u3002\n\n---\n\n\u8bbe\u7b54\u6848\u4e3a $A_{n, k}$ \uff0c\u5219 $\\displaystyle A_{n, k}=\\sum_{i=0}^k \\binom k i f_{n, i}\\Rightarrow \\hat A_n(x)=\\hat F_n(x)\\cdot e^x$ \u3002\n\n\u95ee\u9898\u5316\u4e3a\u5982\u4f55\u6c42\u89e3 $\\hat F_n(x)$ \u4e0d\u8d85\u65f6\u3002\n\n\u8003\u8651\u5230 $\\displaystyle \\hat F_{2n}(x)=\\prod_{i=0}^{2n-1}(e^{2^ix}-1)=\\prod_{i=0}^{n-1}(e^{2^ix}-1)\\cdot \\prod_{i=n}^{2n-1}(e^{2^ix}-1)=\\prod_{i=0}^{n-1}(e^{2^ix}-1)\\cdot \\prod_{i=0}^{n-1}(e^{2^{i+n}x}-1)=\\hat F_n(x)\\cdot \\hat F_n(2^n x)$ \u3002\n\n\u800c $\\displaystyle F(x)=\\sum_{i=0}^\\infty f_ix^i\\Rightarrow F(Ax)=\\sum_{i=0}^\\infty f_iA^i\\cdot x^i$ \u3002\n\n\u6545\u5df2\u77e5 $\\hat F_n(x)$ \uff0c\u53ef\u4ee5\u5148 $O(n)$ \u6c42\u89e3 $\\hat F(2^n x)$ \uff0c\u518d\u591a\u9879\u5f0f\u5377\u79ef $O(n\\log n)$ \u6c42\u51fa $\\hat F_{2n}(x)$ \u3002\n\n\u56e0\u800c\u6c42\u89e3 $\\hat F_n(x)$ \u65f6\uff0c\u5148\u9012\u5f52\u6c42\u89e3 $\\hat F_{n/2}(x)$ \uff0c\u82e5 $n$ \u4e3a\u5947\u6570\uff0c\u518d\u5229\u7528\u9012\u63a8\u5f0f $O(n\\log n)$ \u7b97\u51fa\u7ed3\u679c\u3002\n\n\u6700\u540e\u518d\u5377\u4e0a $e^x$ \u5373\u53ef\u5f97\u5230\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570\u3002\n\n\u603b\u590d\u6742\u5ea6 $\\displaystyle T(n)=T({n\\over 2})+O(n\\log n)=O(n\\log n)$ \uff0c\u5e38\u6570\u7ea6\u4e3a $20$ \u6b21 FFT \u3002\n\n---\n\n**\u3010\u4ee3\u7801\u3011**\n---\n\n\u7531\u4e8e\u9700\u8981\u4efb\u610f\u6a21\u6570\uff0c\u8003\u8651\u4f7f\u7528 MTT \u3002\u4f46\u8fd9\u9898\u8c8c\u4f3c\u7cbe\u5ea6\u9700\u6c42\u975e\u5e38\u9ad8\uff0c\u7528 double \u4f1a\u7b97\u51fa\u95ee\u9898\uff0c\u5f97 long double \u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef vector<int> vi;\ntypedef pair<int, int> pii;\ntypedef long double db;\n#define fi first\n#define se second\n\nstruct vir{\n    db r, i;\n    vir(db r_=0, db i_=0):r(r_), i(i_) {}\n};\ninline vir operator + (const vir &a, const vir &b) { return vir(a.r+b.r, a.i+b.i); }\ninline vir operator - (const vir &a, const vir &b) { return vir(a.r-b.r, a.i-b.i); }\ninline vir operator * (const vir &a, const vir &b) { return vir(a.r*b.r-a.i*b.i, a.r*b.i+a.i*b.r); }\ninline vir operator / (const vir &a, db b) { return vir(a.r/b, a.i/b); }\ninline vir operator ! (const vir &z) { return vir(z.r, -z.i); }\ninline vir operator / (const vir &a, const vir &b) { return a*!b/(b*!b); }\nconst db pi=acos(-1), eps=1e-6;\n\nconst int LimBit=18, M=1<<LimBit;\nint a[M], b[M], c[M];\nstruct NTT{\n    int Stk[M], curStk;\n    int N, na, nb, P, m, N_;\n    inline ll kpow(ll a,ll x) { ll ans=1; for(;x;x>>=1,a=a*a%P) if(x&1) ans=ans*a%P; return ans; }\n    NTT(int P_=1e9+7):P(P_){\n        m=1<<15;\n        curStk=0;\n\t\tN_=-1;\n    }\n\n    vir w[2][M], invN;\n    int rev[M];\n    void work(){\n\t\tif(N_==N) return ; N_=N;\n        int d = __builtin_ctz(N);\n        w[0][0] = w[1][0] = vir(1, 0);\n        vir x = vir(cos(2*pi/N), sin(2*pi/N)), y = !x;\n        for (int i = 1; i < N; i++) {\n            rev[i] = (rev[i>>1] >> 1) | ((i&1) << (d-1));\n            w[0][i] = x * w[0][i-1] , w[1][i] = y * w[1][i-1];\n        }\n        invN=vir(1.0/N, 0);\n    }\n\n    inline void fft(vir *a,int f){\n        static vir x;\n        for(int i=0;i<N;++i) if(i<rev[i]) swap(a[i],a[rev[i]]);\n        for(int i=1;i<N;i<<=1)\n            for(int j=0,t=N/(i<<1);j<N;j+=i<<1)\n                for(int k=0,l=0;k<i;++k,l+=t)\n                    x=w[f][l]*a[j+k+i], a[j+k+i]=a[j+k]-x, a[j+k]=a[j+k]+x;\n        if(f) for(int i=0;i<N;++i) a[i]=a[i]*invN;\n    }\n    inline int mergeNum(ll a1,ll a0,ll b1,ll b0){\n        // return ((a1*m+a0+b1)%p*m+b0+p)%p;\n        return (( ((a1<<15)+a0+b1)%P<<15 )+b0)%P;\n    }\n    inline void doit(int *a,int *b,int na,int nb){\n        static vir x, y, p0[M], p1[M];\n        for(N=1;N<na+nb-1;N<<=1);\n        for(int i=na;i<N;++i) a[i]=0;\n        for(int i=nb;i<N;++i) b[i]=0;\n        for(int i=0;i<N;++i)\n            // p1[i]=pdd(a[i]/m,a[i]%m),p0[i]=pdd(b[i]/m,b[i]%m);\n            p1[i]=vir(a[i]>>15, a[i]&(m-1)), p0[i]=vir(b[i]>>15, b[i]&(m-1));\n        work(); fft(p1,0); fft(p0,0);\n        for(int i=0,j;i+i<=N;++i){\n            j=(N-1)&(N-i);\n            x=p0[i], y=p0[j];\n            p0[i]=(x-!y)*p1[i]*vir(0, -0.5);\n            p1[i]=(x+!y)*p1[i]*vir(0.5, 0);\n            if(i==j) continue;\n            p0[j]=(y-!x)*p1[j]*vir(0, -0.5);\n            p1[j]=(y+!x)*p1[j]*vir(0.5, 0);\n        }\n        fft(p1,1); fft(p0,1);\n        for(int i=0;i<N;++i)\n            a[i]=mergeNum(p1[i].r+0.5, p1[i].i+0.5, p0[i].r+0.5, p0[i].i+0.5);\n    }\n}ntt;\n\nll n;\nint k, f[M];\ninline void init() {\n\tb[1]=1;\n\tfor(int i=2, P=ntt.P; i<=3e4; ++i)\n\t\tb[i]=P-(ll)b[P%i]*(P/i)%P;\n\tfor(int i=2, P=ntt.P; i<=3e4; ++i)\n\t\tb[i]=(ll)b[i-1]*b[i]%P;\n}\ninline void work(ll n) {\n\tif(n==0) {\n\t\tfor(int i=0; i<=k; ++i) f[i]=0;\n\t\tf[0]=1;\n\t\treturn ;\n\t}\n\twork(n>>1);\n\tfor(int i=0, x=ntt.kpow(2, n>>1), y=1, P=ntt.P; i<=k; ++i)\n\t\ta[i]=(ll)f[i]*y%P, y=(ll)y*x%P;\n\tntt.doit(f, a, k+1, k+1);\n\n\tif(n+1&1) return ;\n\tfor(int i=0, x=2, y=1, P=ntt.P; i<=k; ++i)\n\t\tf[i]=(ll)f[i]*y%P, y=(ll)y*x%P;\n\tntt.doit(f, b, k+1, k+1);\n}\nint main() {\n\tios::sync_with_stdio(0);\n\tcin.tie(0); cout.tie(0);\n\tinit();\n\tcin>>n>>k;\n\twork(n);\n\t++b[0];\n\tntt.doit(f, b, k+1, k+1);\n\tfor(int i=0, x=1, P=ntt.P; i<=k; ++i)\n\t\tf[i]=(ll)f[i]*x%P, x=(ll)x*(i+1)%P;\n\tcout<<f[k];\n\tcout.flush();\n\treturn 0;\n}\n```",
        "postTime": 1636717645,
        "uid": 36031,
        "name": "JustinRochester",
        "ccfLevel": 4,
        "title": "CF623E Transforming Sequence \u9898\u89e3"
    },
    {
        "content": "---\n### Update\n* dp \u5f0f\u6ca1\u6709\u4f7f\u7528\u51fd\u6570\u5f62\u5f0f\uff0c\u5426\u5219\u4f1a\u4e0e\u751f\u6210\u51fd\u6570\u6df7\u6dc6\uff0c\u8bf7\u6ce8\u610f\u3002\n\n---\n### \u524d\u8a00\n\n\u624b\u63a8\u4e86\u597d\u4e45\u67ff\u5b50\u624d\u63a8\u51fa\u6765\uff0c\u7ed3\u679c\u6700\u540e\u4e00\u6b65\u4e0d\u4f1a\uff0c\u6700\u540e\u770b\u4e86\u9898\u89e3\u624d\u77e5\u9053\u662f\u500d\u589e\u3002\n\n\u6240\u4ee5\uff0c**\u8fd9\u7b97\u4e00\u4e2a\u6559\u8bad\u5427**\u3002\n\n---\n### \u601d\u8def\n\n\u4ee5\u4e0b\u9ed8\u8ba4 $b_0=0$\u3002\n\n\u9996\u5148 $n>k$ \u663e\u7136\u65e0\u89e3\uff0c\u539f\u7406\u662f\u6bcf\u6b21 $n$ \u52a0\u4e00\u5fc5\u7136\u591a\u81f3\u5c11\u4e00\u4f4d\u503c\u4e3a $1$\u3002\n\n\u6211\u4eec\u8bbe $f_{n,k}$ \u4e3a**\u6070\u597d**\u5360\u7528\u4e86 $k$ \u4e2a\u4e8c\u8fdb\u5236\u4f4d\u65f6\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\u7684\u65b9\u6848\u6570\u3002\u7279\u522b\u7684\uff0c$n>k$ \u65f6 $f_{n,k}=0$\u3002\n\n\u7531\u5b9a\u4e49\uff0c\u6211\u4eec\u6709\n\n$$ans=\\sum_{i=0}^{k}\\binom kif_{n,i}$$\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a dp \u5f0f\uff1a\n\n$$f_{n,k}=\\sum_{i=0}^{k-1}\\binom ki2^if_{n-1,i}$$\n\n\u4e3a\u5565\u6211\u611f\u89c9\u8fd9\u4e2a\u5f88\u96be\u60f3\u554a\uff08~~\u56e0\u4e3a\u6211\u6700\u5f00\u59cb\u6ca1\u52a0\u8fd9\u4e2a\u4e8c\u9879\u5f0f\u7cfb\u6570\uff0c\u63a8\u4e86 $114514$ \u79d2\u540e\u5f97\u5230\u4e86\u4e00\u4e2a\u5047\u67ff\u5b50~~\uff09\uff0c\u7b80\u8981\u8bf4\u8bf4\u539f\u7406\uff1a\n\n* \u679a\u4e3e $b_{n-1}$ \u5df2\u7ecf\u5360\u6709\u7684\u4f4d\u6570 $i$\uff08$f_{n-1,i}$\uff09\uff0c\u540c\u65f6\u679a\u4e3e\u662f\u54ea $i$ \u4f4d\uff08$\\binom ki$\uff09\uff0c\u90a3\u4e48\u8fd9 $i$ \u4f4d $a_n$ \u65e2\u53ef\u5360\u6709\u4ea6\u53ef\u4e0d\u5360\u6709\uff08$2^i$\uff09\u3002\n* \u6b64\u5916 $k-i$ \u4f4d\u5fc5\u987b\u5360\u6709\u3002\n\n\u7136\u540e\uff0c\u8bbe $\\operatorname{EGF}$\uff1a\n\n$$\\hat f_n(x)=\\sum_{k=0}^{+\\infty}f_{n,k}{x^k\\over k!}$$\n\n\u90a3\u4e48\uff1a\n\n$$\\hat f_n(x)=\\sum_{k=0}^{+\\infty}{x^k\\over k!}\\sum_{i=0}^{k-1}{k!\\over i!\\times(k-i)!}2^i[{x^i\\over i!}]\\hat f_{n-1}(x)$$\n\n$$=\\sum_{k=0}^{+\\infty}x^k\\sum_{i=0}^{k-1}{1\\over (k-i)!}\\times{2^i\\over i!}[{x^i\\over i!}]\\hat f_{n-1}(x)$$\n\n$$=\\sum_{k=0}^{+\\infty}x^k\\sum_{i=0}^{k-1}{1\\over (k-i)!}[x^i]\\hat f_{n-1}(2x)$$\n\n$$=\\sum_{i=0}^{+\\infty}x^i[x^i]\\hat f_{n-1}(2x)\\sum_{k=i+1}^{+\\infty}x^{k-i}{1\\over (k-i)!}$$\n\n$$=\\sum_{i=0}^{+\\infty}x^i[x^i]\\hat f_{n-1}(2x)\\sum_{k=1}^{+\\infty}{x^k\\over k!}$$\n\n$$=(e^x-1)\\sum_{i=0}^{+\\infty}x^i[x^i]\\hat f_{n-1}(2x)$$\n\n$$=(e^x-1)\\hat f_{n-1}(2x)$$\n\n\u5373\uff0c$\\hat f_n(x)=(\\exp x-1)\\hat f_{n-1}(2x)$\u3002\n\n\u8fb9\u754c $\\hat f_0(x)=1$\u3002\n\n---\n\n\u5c55\u5f00\u6765\uff0c\u6211\u4eec\u6709\n\n$$\\hat f_n(x)=\\prod_{i=0}^{n-1}(e^{2^ix}-1)$$\n\n\u800c\u6211\u4eec\u8981\u6c42\u7684\uff0c\u5c31\u662f\n\n$$ans=\\sum_{i=0}^{k}\\binom ki[{x^i\\over i!}]\\hat f_n(x)=k!\\sum_{i=0}^{k}{[x^i]\\hat f_n(x)\\over(k-i)!}$$\n\n\u56e0\u6b64\u53ea\u8981\u80fd\u5377\u51fa $f_n(x) \\bmod x^{k+1}$ \u5c31\u53ef\u5f97\u7b54\u6848\u3002\n\n\u7531\u5c55\u5f00\u5f0f\uff0c\u6211\u4eec\u6709\uff1a\n\n$$\\hat f_{2n}(x)=\\hat f_n(x)\\times\\hat f_n(2^nx)$$\n\n\u53c8\u6709\n\n$$\\hat f_{2n+1}(x)=\\hat f_{2n}(x)\\times(e^{2^{2n}x}-1)$$\n\n\u4e8e\u662f\u53ef\u4ee5\u500d\u589e\u6216\u8005\u9012\u5f52\u5377\u51fa $\\hat f_n(x)$\u3002\u6211\u91c7\u7528\u4e86\u540e\u8005\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a\n\n$$T(n)=T(\\frac n2)+O(n\\log n)=O(n\\log n)$$\n\n---\n### Code\n\n\u6a21\u6570 $1000000007$ \u592a\u5410\u4e86\uff0c\u8981 MTT\u3002\n\n![](https://\u5567.tk/tuu)\n\n\u4ee3\u7801\u592a\u957f\u4e86\uff0c\u6254\u526a\u8d34\u677f\u91cc\u4e86\u3002\n\n[\u94fe\u63a5](https://www.luogu.com.cn/paste/q1rsafsf)\u3002\n\n\u6838\u5fc3\u4ee3\u7801\u7684\u4f2a\u4ee3\u7801\uff1a\n\n```stein\nInteger n,k;\npoly f(Integer n)\n\tif n == 1\n\t\tpoly ans = \"x\"\n\t\tans = exp(ans) - 1\n\t\tMake deg(ans) = k\n\t\treturn ans\n\tpoly ans, g\n\tg = f(n/2)\n\tans = g\n\tModint w, p\n\tw = pow(2, n/2)\n\tp = 1\n\tfor Integer i from 0 to k\n\t\tg[i] = g[i] * p\n\t\tp = p * w\n\tans = ans * g\n\tMake deg(ans) = k\n\tif n % 2 == 1\n\t\tg = pow(2, n/2) * \"x\"\n\t\tg = exp(g) - 1\n\t\tMake deg(g) = k\n\t\tans = ans * g\n\t\tMake deg(ans) = k\n\treturn ans\nmain()\n\tInput n, k\n\tif n > k\n\t\tOutput 0\n\t\treturn\n\tpoly w = f(n)\n\tModint ans\n\tans = 0\n\tfor Integer i from n to k\n\t\tans = ans + Inv((k-i)!) * w[i]\n\tans = ans * k!\n\tOutput ans\n```\n\n---\n### \u603b\u7ed3\n\n\u5f00\u5934\u8bf4\u4e86\uff0c\u6211\u6ca1\u6709\u60f3\u5230\u500d\u589e\u3002\n\n\u8fd9\u9898\u8bf4\u660e\u4e86**\u5982\u4f55\u5feb\u901f\u5377\u51fa\u51fa\u81ea\u500d\u589e\u5f0f\u7684\u591a\u9879\u5f0f\u7ec4\u7684\u6307\u5b9a\u9879**\u3002\n\n\u8fd9\u786e\u5b9e\u7b97\u662f\u4e00\u4e2a\u6559\u8bad\u5427\u3002\n",
        "postTime": 1632319430,
        "uid": 105050,
        "name": "myee",
        "ccfLevel": 7,
        "title": "623E"
    },
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a $n,k$\uff0c\u6c42\u6709\u591a\u5c11\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u5e8f\u5217 $A$\uff1a\n\n- \u5bf9\u4e8e $1\\leq i\\leq n$\uff0c$0< A_i< 2^k$\u3002\n\n- \u5bf9\u4e8e $1<i\\leq n$\uff0c$B_i>B_{i-1}$\u3002\n\n\u5176\u4e2d $B_i$ \u4e3a $A_i$ \u7684\u524d\u7f00\u6216\u3002\n\n$\\texttt{Data Range:}1\\leq n\\leq 10^{18},1\\leq k\\leq 3\\times 10^4$\u3002\n\n### \u9898\u89e3\n\n\u9898\u5355\u91cc\u7684\u9898\u90fd\u505a\u4e0d\u51fa\u6765\u4e86\uff0c\u8fd9\u5c31\u662f\u6211\u5417/dk\n\n\u5230\u4e86\u6700\u540e\u4e00\u6b65\u60f3\u5230\u4e86\u5404\u79cd\u4e1c\u897f\u5374\u60f3\u4e0d\u5230\u500d\u589e\uff0c\u8fd9\u5c31\u662f\u6211\u5417/dk\n\n~~\u4e5f\u6709\u53ef\u80fd\u662f\u81ea\u5df1\u4f5c\u6b7b\u4e4b\u524d\u5b66\u9898\u89e3\u505a\u6cd5\u73b0\u5728\u8bb0\u4e0d\u8d77\u6765 \u81ea\u5df1 yy \u4e86\u4e2a\u505a\u6cd5\u53d1\u73b0\u505a\u5230\u6700\u540e\u4e0d\u4f1a\u4e86~~\n\n\u7531\u4e8e\u67d0\u4e9b\u4f4d\u5982\u679c\u8fd9 $n$ \u4e2a\u6570\u4e0a\u8fd9\u4e00\u4f4d\u90fd\u4e3a $0$ \u4e5f\u80fd\u5408\u6cd5\uff0c\u6240\u4ee5\u5148\u8003\u8651\u4e00\u4e2a\u5f31\u5316\u7684\u7248\u672c\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\uff0c$n$ \u4e2a\u6570\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u6ee1\u8db3\u8fd9\u4e2a\u4f4d\u4e3a $1$\u3002\n\n\u9996\u5148\u9898\u76ee\u7684\u9650\u5236\u76f8\u5f53\u4e8e\u5bf9\u4e8e\u4efb\u610f\u7684 $1\\leq i\\leq n$ \uff0c\u603b\u5b58\u5728\u4e00\u4e2a $j$ \u4f7f\u5f97\u524d $i-1$ \u4e2a\u6570\u4e2d\u7684\u7b2c $j$ \u4f4d\u90fd\u4e3a $0$\uff0c\u4e14\u7b2c $i$ \u4e2a\u6570\u7684\u7b2c $j$ \u4f4d\u4e3a $1$\u3002\n\n\u6240\u4ee5\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u679a\u4e3e\u6709\u591a\u5c11\u8fd9\u6837\u7684\u4f4d\u3002\u8bbe $a_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u6570\u4e2d\u67d0\u4e2a\u4f4d\u4e3a $1$ \u4e14\u524d $i-1$ \u4e2a\u6570\u4e2d\u67d0\u4e2a\u4f4d\u4e3a $0$ \u7684\u4f4d\u7684\u6570\u91cf\uff0c\u90a3\u4e48\u663e\u7136\u8981\u6ee1\u8db3 $a_i>0$\uff0c\u540c\u65f6 $a_i$ \u7684\u548c\u4e3a $k$\u3002\n\n\u8003\u8651\u7b2c $i$ \u4e2a\u6570\u4e2d\u6ee1\u8db3\u6761\u4ef6\u7684 $a_i$ \u4e2a\u4f4d\u5728 $n$ \u4e2a\u6570\u4e2d\u7684\u586b\u6cd5\u3002\u9996\u5148\u524d $i-1$ \u4e2a\u6570\u8fd9\u4e2a\u4f4d\u5fc5\u987b\u53d6 $0$\uff0c\u7136\u540e\u8fd9\u4e2a\u6570\u7684\u8fd9\u4e2a\u4f4d\u5fc5\u987b\u53bb $1$\uff0c\u540e\u9762\u7684 $n-i$ \u4e2a\u6570\u7684\u8fd9\u4e2a\u4f4d\u53ef\u4ee5\u4efb\u9009\uff0c\u6240\u4ee5\u53ef\u4ee5\u7b97\u51fa\u8fd9 $a_i$ \u4e2a\u4f4d\u7684\u8d21\u732e\uff0c\u8fdb\u800c\u63a8\u51fa\u603b\u7684\u8d21\u732e\u4e3a\uff1a\n\n$$\\sum\\binom{k}{a_1,\\cdots,a_n}\\prod2^{a_j(n-j)}$$\n\n\u5176\u4e2d\u548c\u5f0f\u679a\u4e3e\u7684\u662f\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u5e8f\u5217 $a$\u3002\n\n\u62c6\u6389\u591a\u9879\u5f0f\u7cfb\u6570\u5219\u53ef\u4ee5\u8868\u793a\u4e3a\n\n$$k!\\sum\\prod\\frac{2^{a_j(n-j)}}{a_j!}$$\n\n\u5982\u679c\u5199\u7684\u597d\u770b\u4e00\u70b9\u5c31\u662f\n\n$$k!2^{nk}\\sum\\prod\\frac{1}{a_j!2^{ja_j}}$$\n\n\u7531\u4e8e $\\sum a_j=k$\uff0c\u53f3\u8fb9\u7684\u4e00\u5927\u5768\u4e1c\u897f\u5b9e\u8d28\u4e0a\u5c31\u662f $n$ \u4e2a\u5e8f\u5217\u7684\u5377\u79ef\u3002\n\n\u8003\u8651\u5bf9\u53f3\u8fb9\u4f7f\u7528 GF\uff0c\u6ce8\u610f\u5230\n\n$$\\sum\\frac{x^i}{i!2^{it}}=e^{\\frac{x}{2^t}}$$\n\n\u4f46\u662f\u5f53 $a_j=0$ \u65f6\u4e0d\u5408\u6cd5\uff0c\u8d21\u732e\u4e3a $0$\uff0c\u6240\u4ee5\u9700\u8981\u51cf\u6389\u5e38\u6570\u9879\uff0c\u5373\n\n$$\\prod_{i=1}^{n}\\left(e^{\\frac{x}{2^i}}-1\\right)$$\n\n~~\u7136\u540e\u6211\u5c31\u4e0d\u77e5\u9053\u8fd9\u4e2a\u4e1c\u897f\u600e\u4e48\u6c42\u4e86~~\n\n\u8bbe $F_n(x)$ \u4e3a\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u500d\u589e\u3002\u5177\u4f53\u800c\u8a00\u5373\n\n$$F_{2n}(x)=F_n(x)F_n\\left(\\frac{x}{2^n}\\right)$$\n\n\u7136\u540e\u5c31\u80fd\u65b9\u4fbf\u8f6c\u79fb\u4e86\uff01\u4f46\u662f\u5982\u679c\u5b58\u5728\u82e5\u5e72\u4f4d\u7f6e\u4f7f\u5f97\u6ca1\u6709\u6570\u5728\u8fd9\u4e00\u4f4d\u4e0a\u53d6 $1$ \u53c8\u8be5\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u91cc\u76f4\u63a5\u5c06\u8fd9\u4e9b\u4f4d\u7f6e\u679a\u4e3e\u51fa\u6765\u7136\u540e\u7b97\u4e00\u4e0b\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6 $O(k\\log k\\log n)$\u3002\n\n\u4ee3\u7801\u5c31\u4e0d\u653e\u4e86\uff0c\u6bd5\u7adf\u4e4b\u524d\u5199\u7684\u4e1c\u897f\u662f\u5b66\u7684\u9898\u89e3\u505a\u6cd5\uff0c\u53c8\u4e0d\u662f\u81ea\u5df1\u73b0\u5728\u7684\u505a\u6cd5\u3002",
        "postTime": 1617171835,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "\u9996\u5148\u8003\u8651\u9898\u76ee\u542b\u4e49\uff1a\u7ed9\u51fa\u5143\u7d20\u4e2a\u6570 $k$ \u548c\u96c6\u5408\u4e2a\u6570 $n$\uff0c\u4ece $1$ \u5230 $n$ \u6bcf\u4e00\u4e2a\u96c6\u5408\u4fdd\u7559\u524d\u4e00\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff0c\u4e14\u81f3\u5c11\u52a0\u5165\u4e00\u4e2a\u524d\u4e00\u4e2a\u96c6\u5408\u4e0d\u5b58\u5728\u7684\u5143\u7d20\u3002\u6c42\u96c6\u5408\u5e8f\u5217\u6570\u3002\n\n\u7136\u540e\u8003\u8651DP\u3002\u72b6\u6001\u7684\u8bbe\u8ba1\u9700\u8981\u6ce8\u610f\uff0c\u4e0d\u59a8\u63d0\u51fa\u9898\u76ee\u4e2d\u7684\u82e5\u5e72\u8981\u7d20\uff1a\n\n- \u96c6\u5408\u662f\u987a\u5e8f\u7684\uff1b\n- \u5143\u7d20\u662f\u6807\u53f7\uff08\u6709\u5e8f\uff09\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5982\u4e0b\u72b6\u6001\u3002\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u96c6\u5408\u4e2d**\u9009\u4e86 $j$ \u4e2a** \u5143\u7d20\u7684\u65b9\u6848\u6570\u3002\n\n\u8fd9\u91cc\u8868\u793a\u7684\u5143\u7d20\u662f\u65e0\u5e8f\u7684\u3002\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u7684\u5f0f\u5b50\u4e3a\n\n$$ans=\\sum_{i=1}^{k}\\binom ki f_{n,i}$$\n\n\u65e0\u5e8f\u9009\u51fa\u7684 $i$ \u4e2a\u5143\u7d20\u4e58\u4e0a\u4e00\u4e2a\u7ec4\u5408\u7ed9\u5b83\u4eec\u6807\u53f7\u3002\n\n\u53d1\u73b0\u82e5 $n > k$ \u5230\u67d0\u4e00\u4e2a\u4f4d\u7f6e\u65f6\u96c6\u5408\u5c31\u4e00\u5b9a\u4f1a\u9009\u6ee1\uff0c\u7b54\u6848\u4e3a $0$\u3002$f_{i,j}$ \u5f53 $i > j$ \u65f6\u4e5f\u5e94\u8be5\u4e3a $0$\u3002\u4f46\u8fd9\u5e76\u4e0d\u5f71\u54cd\u6211\u4eec\u9012\u63a8\u3002 \n\n\u9996\u5148\u6709\u4e00\u4e2a\u5f0f\u5b50\n\n$$f_{n,i}=\\sum_{j=0}^{i}f_{n-1,j}\\binom ij2^j$$\n\n\u8868\u793a\u4e0a\u4e00\u4e2a\u96c6\u5408\u5df2\u7ecf\u6709 $j$ \u4e2a\u5143\u7d20\uff0c\u5269\u4e0b $i-j$ \u4e2a\u5143\u7d20\u5fc5\u987b\u9009\u3002\u4e58\u4e0a\u7ec4\u5408\u6570\u786e\u5b9a\u5df2\u9009\u5143\u7d20\u7684\u4f4d\u7f6e\u540e\uff0c\u5b83\u4eec\u5728\u8be5\u96c6\u5408\u4e2d\u53ef\u9009\u53ef\u4e0d\u9009\u6709 $2^j$ \u79cd\u65b9\u6848\u3002\n\n\u4e8e\u662f\u5f97\u5230\u4e00\u4e2a $O(n^3)$ \u7684\u505a\u6cd5\u3002\u8003\u8651\u5230 $n$ \u7684\u5927\u5c0f\uff0c\u6211\u4eec\u60f3\u5230\u500d\u589e\u3002\n\n\u9996\u5148\uff0c\u6839\u636e\u4e0a\u5f0f\uff0c\u8fdb\u4e00\u6b65\u5f97\u5230\u5982\u4e0b\u5f0f\u5b50\uff1a\n\n$$f_{n+m,i}=\\sum_{j=0}^{i}f_{n,j}\\times f_{m,i-j}\\binom ij2^{mj}$$\n\n\u8be5\u5f0f\u610f\u4e49\u7c7b\u4f3c\uff0c\u8868\u793a $n$ \u4e2a\u96c6\u5408\u540e\u8ffd\u52a0 $m$ \u4e2a\u96c6\u5408\uff0c\u5c31\u81ea\u7136\u6709 $m\\times j$ \u4e2a\u4f4d\u7f6e\u53ef\u9009\u53ef\u4e0d\u9009\u3002\n\n\u6839\u636e\u500d\u589eFFT\u7684\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5199\u51fa\u518d\u4e00\u4e2a\u91cd\u8981\u7684\u5f0f\u5b50\uff1a\n\n$$f_{2n,i}=\\sum_{j=0}^{i}f_{n,j}\\times f_{n,i - j}\\binom ij2^{nj}$$\n\n\u53c8\u6709\u521d\u59cb\u72b6\u6001 $f_{1,0}=0,f_{1,i}=1,i\\in[1,k]$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6709\u4e86\u4ece $f_n$ \u63a8\u77e5 $f_{n+1}$ \u548c $f_{2n}$ \u7684\u65b9\u6cd5\u3002\u5982\u679c\u8fd9\u4e24\u4e2a\u6b65\u9aa4\u90fd\u662f\u4e00\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\u5c31\u53ef\u4ee5\u505a\u5230\u7684\uff0c\u90a3\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002\n\n\u9996\u5148\u5728\u4e58\u79ef\u4e2d\u6709\u4e00\u4e2a\u7ec4\u5408\u6570\u3002~~\u9605\u8bfb[\u8fd9\u7bc7\u6587\u7ae0](https://www.luogu.com.cn/blog/void-basic-learner/generating-function-preview)\u6700\u540e\u4e00\u6bb5\u540e~~\u53d1\u73b0\uff0c\u56fa\u7136\u6211\u4eec\u53ef\u4ee5\u62c6\u5f00\u7ec4\u5408\u6570\uff0c\u5373\n\n$$f_{n,i}=i!\\sum_{j=0}^i\\frac{f_{n-1,j}2^j}{j!}\\times \\frac{1}{(i-j)!}$$\n\n\u4e5f\u53ef\u4ee5\u63a8\u60f3\u5982\u679c\u6211\u4eec\u4e00\u5f00\u59cb\u5c31\u8bbe\u5b9a $f_{i,j}$ \u4e3a\u5176\u539f\u672c\u610f\u4e49\u4e58 $\\frac 1{j!}$\uff0c\u5c31\u53ef\u4ee5\u81ea\u7136\u5730\u5ffd\u7565\u5f0f\u5b50\u4e2d\u7684\u7ec4\u5408\u6570\u3002\u521d\u59cb\u72b6\u6001\u4fbf\u8bbe\u4e3a $f_{1,0}=0,f_{1,i}=\\frac 1{i!},i\\in[1,k]$\u3002\n\n\u5f53\u7136\u7b54\u6848\u4e5f\u53d8\u6210\n\n$$ans=\\sum_{i=1}^{k}f_{n,i}\\times A(k,i)$$\n\n\u5c31\u662f\u4e86\u3002\n\n\u4e8e\u662f\u4f7f\u7528\u500d\u589eFFT\u65b9\u4fbf\u5730\u89e3\u51b3\u4e86\u8be5\u9898\u3002\u5177\u4f53\u5730\uff0c\u5bf9\u4e8e\u4e00\u4e2a $n$ \uff0c\u82e5\u4e3a $1$\uff0c\u6784\u9020\u521d\u59cb\u6570\u5217\u8fd4\u56de\uff1b\u5426\u5219\u9012\u5f52 $\\lfloor\\frac n2\\rfloor$\u3002\u5982\u679c $n$ \u4e3a\u5947\u6570\uff0c\u6309\u7167\u666e\u901a\u7684\u4e00\u9636\u9012\u63a8\u5f0f\u63a8\u4e00\u6b21\u3002\n\n\u4e00\u5171 $O(\\log n)$ \u6b21\u500d\u589e $O(k\\log k)$\uff0c\u6700\u591a $O(\\log n)$ \u6b21\u4e00\u9636\u9012\u63a8 $O(k\\log k)$\u3002\u603b\u590d\u6742\u5ea6\u662f $O(k\\log k\\log n)$ \u7684\u3002\n\n\u4ee5\u53ca\uff0c\u56e0\u4e3a\u6709\u5947\u602a\u7684\u6a21\u6570\uff0c\u8fd9\u91cc\u4f7f\u7528 $4$ \u6b21DFT\u7684MTT\u4f5c\u4e58\u6cd5\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff0c\u6b22\u8fce\u63d0\u95ee\u3002\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\n\ntypedef long long ll;\ntypedef long double ldb;\nconst int p = 1000000007;\nconst int MAXN = 1000001;\nconst int B = 1 << 15;\nconst ldb pi = acos(-1);\n\ninline ll read() {\n    ll x = 0,f = 1; char ch = getchar();\n    while(ch > '9' || ch < '0') { if(ch == '-') f = -1; ch = getchar(); }\n    do x = x * 10 + ch - 48, ch = getchar(); while(ch >= '0' && ch <= '9');\n    return x * f;\n}\n\nint fac[MAXN],ifac[MAXN];\nint f[MAXN],g[MAXN];\n\nstruct Complex\n{\n    ldb x,y;\n    Complex() { x = y = 0; }\n    Complex(const ldb _x,const ldb _y) : x(_x), y(_y) {}\n    Complex operator +(const Complex a) { return Complex(x + a.x,y + a.y); }\n    Complex operator -(const Complex a) { return Complex(x - a.x,y - a.y); }\n    Complex operator *(const Complex a) { return Complex(x * a.x - y * a.y,x * a.y + y * a.x); }\n    Complex operator *(const ldb t) { return Complex(x * t,y * t); }\n    Complex operator /(const ldb t) { return Complex(x / t,y / t); }\n};\n\nComplex I(0,1);\n\nll n;\nint k,r[MAXN]; Complex wn[MAXN];\nComplex a0[MAXN],a1[MAXN],b0[MAXN],b1[MAXN];\nComplex P[MAXN],Q[MAXN];\n\nint pow2(int b) {\n\tint res = 1,a = 2;\n\twhile(b) {\n\t\tif(b & 1) res = 1ll * res * a % p;\n\t\ta = 1ll * a * a % p;\n\t\tb >>= 1;\n\t}\n\treturn res;\n}\n\nvoid FFT(Complex *a,int N) {\n    for(int i = 0;i < N;i++) if(i < r[i]) std::swap(a[i],a[r[i]]);\n    Complex t1,t2;\n    for(int n = 2, m = 1;n <= N;m = n, n <<= 1)\n        for(int l = 0;l < N;l += n)\n            for(int i = l;i < l + m;i++) {\n                Complex w = wn[N / m * (i - l)];\n                t1 = a[i], t2 = w * a[i + m];\n                a[i] = t1 + t2;\n                a[i + m] = t1 - t2;\n            }\n    return;\n}\n\nvoid IFFT(Complex *a,int N) {\n    FFT(a,N);\n    std::reverse(a + 1,a + N);\n    for(int i = 0;i < N;i++) a[i] = a[i] / N;\n    return;\n}\n\nvoid ConnectFFT(Complex *a,Complex *b,int N) {\n    for(int i = 0;i < N;i++) a[i].y = b[i].x;\n    FFT(a,N);\n    b[0] = Complex(a[0].x,-a[0].y);\n    for(int i = 1;i < N;i++) b[i] = Complex(a[N - i].x,-a[N - i].y);\n    Complex t1,t2;\n    for(int i = 0;i < N;i++) {\n        t1 = a[i], t2 = b[i];\n        a[i] = (t1 + t2) / 2.0;\n        b[i] = (t2 - t1) * I / 2.0;\n    }\n    return;\n}\n\nll rd(const ldb x) {\n    if(x >= 0) return ll(x + 0.5) % p;\n    else return ll(x - 0.5) % p;\n}\n\nvoid MTT(int *a,int *b,int n,int N) {\n    for(int i = 0;i <= N;i++) a0[i].x = a[i] / B, a1[i].x = a[i] % B;\n    for(int i = 0;i <= N;i++) b0[i].x = b[i] / B, b1[i].x = b[i] % B;\n    for(int i = 0;i < N;i++) wn[i] = Complex(cos(pi / N * i),sin(pi / N * i));\n    ConnectFFT(a0,a1,N); ConnectFFT(b0,b1,N);\n    for(int i = 0;i < N;i++) {\n        P[i] = a0[i] * b0[i] + I * a1[i] * b0[i];\n        Q[i] = a0[i] * b1[i] + I * a1[i] * b1[i];\n    }\n    IFFT(P,N); IFFT(Q,N);\n    for(int i = 0;i < n;i++) a[i] = ((1ll * B * B % p * rd(P[i].x) % p + B * rd(Q[i].x + P[i].y) % p) % p + rd(Q[i].y)) % p;\n\treturn;\n}\n\nvoid Solve(int k,int n,int N) {\n\tif(k == 1) {\n\t\tf[0] = 0;\n\t\tfor(int i = 1;i < n;i++) f[i] = ifac[i];\n\t\treturn;\n\t}\n\tSolve(k >> 1,n,N);\n\tg[0] = 0;\n\tfor(int i = 1;i < n;i++) g[i] = 1ll * f[i] * pow2(1ll * (k >> 1) * i % (p - 1)) % p;\n\tMTT(f,g,n,N);\n\tif(k & 1) {\n\t\tg[0] = 0;\n\t\tfor(int i = 1;i < n;i++) f[i] = 1ll * f[i] * pow2(i) % p;\n\t\tfor(int i = 1;i < n;i++) g[i] = ifac[i];\n\t\tMTT(f,g,n,N);\n\t}\n\treturn;\n}\n\nint main() {\n    n = read(), k = read();\n\tif(n > k) return std::puts(\"0\"), 0; // \u4e4b\u6240\u4ee5\u8fd8\u8981\u5224\uff0c\u662f\u56e0\u4e3a n \u592a\u5927\uff0c\u6ca1\u529e\u6cd5\u76f4\u63a5\u7b97\u4e86\uff0c\u5426\u5219\u4f1aMLE\u3002\n\tfac[0] = ifac[0] = ifac[1] = 1;\n    int N = 1, l = -1; while(N <= (k + 1) << 1) N <<= 1, l++;\n    for(int i = 1;i < N;i++) r[i] = (r[i >> 1] >> 1) | ((i & 1) << l);\n\tfor(int i = 1;i < N;i++) fac[i] = 1ll * fac[i - 1] * i % p;\n\tfor(int i = 2;i < N;i++) ifac[i] = 1ll * ifac[p % i] * (p - p / i) % p;\n\tfor(int i = 1;i < N;i++) ifac[i] = 1ll * ifac[i - 1] * ifac[i] % p;\n\tSolve(n,k + 1,N);\n\tll ans = 0;\n\tfor(int i = 1;i <= k;i++) ans = (ans + 1ll * f[i] * fac[k] % p * ifac[k - i] % p) % p;\n\tstd::printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1595043051,
        "uid": 219595,
        "name": "Vocalise",
        "ccfLevel": 9,
        "title": "\u500d\u589eFFT--\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "**\u9898\u610f\uff1a**\n\n\n\u7ed9\u5b9a $n$\uff0c\u521d\u59cb\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5168 $0$ \u4e32 $s$\uff0c\u63a5\u7740\u64cd\u4f5c $k$ \u8f6e\uff0c\u6bcf\u6b21\u9009\u62e9\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684 $01$ \u4e32 $a$ \u64cd\u4f5c\uff0c\u4ee4 $s=a|s$\uff0c\u8bbe $|s|$ \u8868\u793a\u5176\u4e2d $1$ \u7684\u6570\u91cf\uff0c\u90a3\u4e48\u6bcf\u6b21\u64cd\u4f5c\u540e\u8981\u6ee1\u8db3 $|s|$ \u5355\u8c03\u9012\u589e\u3002\n\n\u6c42\u5408\u6cd5\u7684\u64cd\u4f5c\u65b9\u6848\u6570\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n\n* \u4e0e\u9898\u9762\u7684 $n,k$ \u521a\u597d\u662f\u53cd\u8fc7\u6765\u7684\u3002\n\n\n---\n\n- \u5927\u6982\u662f\u4e00\u4e2a\u5947\u602a\u7684\u5bb9\u65a5\u505a\u6cd5...\n\n\u9996\u5148\u6211\u4eec\u7279\u5224\u6389 $k>n$ \u7684\u60c5\u51b5\u3002\n\n\u63a5\u7740\u8003\u8651\u64cd\u4f5c\u4e86 $k$ \u6b21\uff0c\u90a3\u4e48\u4ece\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u770b $s$ \u7684\u503c\u5fc5\u7136\u662f\u5f62\u5982 $000111...$\n\n\u4e0d\u59a8\u5047\u8bbe\u8fd9\u4e00\u4f4d\u4e0a\u6709 $t$ \u4e2a $1$\uff0c\u90a3\u4e48\u5176\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $2^{t-1}$\uff0c\u5982\u679c $t=0$ \u90a3\u4e48\u8d21\u732e\u4e3a $1$\n\n\u6240\u4ee5\u5047\u8bbe\u6709 $i$ \u4e2a\u4f4d\u7f6e\u6709\u503c\uff0c\u5728\u4e0d\u8003\u8651 $|s|$ \u5355\u8c03\u589e\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7b49\u4ef7\u4e8e\u8ba1\u7b97 $\\sum \\prod 2^i=\\prod (\\sum 2^i)$\uff0c\u6240\u4ee5\u6240\u6709\u60c5\u51b5\u6743\u503c\u548c\u4e3a $\\sum_k \\binom{n}{k} (\\sum 2^i)^k=(\\sum 2^i+1)^{n}$\n\n\u8003\u8651 $|s|$ \u5355\u8c03\u589e\u7684\u6761\u4ef6\uff0c\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u6761\u4ef6\u7b49\u4ef7\u4e8e $1\\sim k$ \u4e0a\u7684\u6570\u5747\u51fa\u73b0\u81f3\u5c11\u4e00\u6b21\uff0c\u8003\u8651\u901a\u8fc7\u5bb9\u65a5\u539f\u7406\u6765\u8ba1\u7b97\uff0c\u8bbe\u5168\u96c6 S \u4e3a $\\{1,1,1...k \\text{\u4e2a} 1\\}$\uff0c\u6211\u4eec\u7b49\u4ef7\u4e8e\u6c42\uff1a\n\n$$\\sum_{T\\subseteq S} (-1)^{|S|-|T|}f(T)$$\n\n\u5176\u4e2d $f(T)$ \u8868\u793a\u96c6\u5408 $T$ \u4e2d\u7684\u6570\u4efb\u610f\u4f7f\u7528\u7684\u8d21\u732e\u548c\uff0c\u90a3\u4e48\u4e0d\u59a8\u8bbe $w(T)$ \u4e3a $\\sum_{i\\in T}2^i$\uff0c\u5219\u6240\u6c42\u4e3a $f(T)= w(T)^n$\n\n\u4e8e\u662f\u6211\u4eec\u7b49\u4ef7\u4e8e\u6c42\uff1a\n\n$$\\sum_{T\\subseteq S}(-1)^{|S|+|T|}(w(T)+1)^{n}$$\n\n$$(-1)^{|S|}\\sum \\binom{n}{i}\\sum_{T\\subseteq S}(-1)^{|T|}w(T)^{i}$$\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u901a\u8fc7\u500d\u589e\u7ef4\u62a4\u4e0a\u5f0f\uff0c\u4e0d\u59a8\u8bbe $f(z,i)$ \u4e3a\uff1a\n\n$$f(z,i)=\\sum^{2^z-1} (-1)^{|T|}w(T)^i$$\n\n\u90a3\u4e48\u8003\u8651\uff1a\n\n$$f(2z,i)=\\sum^{2^{2z}-1}(-1)^{|T|}w(T)^i$$\n\n$$f(2z,i)=\\sum_{T}^{2^z-1}(-1)^{|T|}\\sum_S^{2^z-1}(-1)^{|S|}(w(T)+w(S\\times 2^z))^i$$\n\n$$f(2z,i)=\\sum_{T}^{2^z-1}(-1)^{|T|}\\sum_S^{2^z-1}(-1)^{|S|}\\binom{i}{j}w(T)^jw(S\\times 2^z)^{i-j}$$\n\n\u5c06 $f(2z,i)$ \u89c6\u4e3a\u5173\u4e8e $i$ \u7684\u6307\u6570\u578b\u751f\u6210\u51fd\u6570 EGF $F_{2z}(x)$\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$F_{2z}=F_{z}(x)F_z(2^zx)$$\n\n\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa $F_k[x^i],\\{i=1,2\\sim n\\}$ \u5c31\u80fd\u5f97\u5230\u7b54\u6848\u4e86\uff0c\u90a3\u4e48\u76f4\u63a5\u591a\u9879\u5f0f\u500d\u589e\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n\\log n\\log k)$\n\n\u8bb2\u9053\u7406\uff0c$10^9+7$ \u8fd9\u4e2a\u6a21\u6570\u771f\u7684\u975e\u4eba\u54c9\u3002\n\ntips: \u4ee3\u7801\u5199\u4e86\u4e00\u4e0b\u5348\uff0c\u4e00\u5f00\u59cb\u6253\u7b97\u5199MTT(4FFT)\uff0c\u6700\u540e\u53d1\u73b0\u81ea\u5df1\u8c03\u4e0d\u51fa\u6765\uff0c\u7136\u540e\u6539\u6210\u4e86 7FFT /fad\uff0c$10^9+7$ \u4ec0\u4e48\u7684\u771f\u7684\u662f\u70e6\u6b7b\u4e86\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define int long long\n#define double long double \nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int N = 4e5 + 5 ;\nconst int P = 1e9 + 7 ; \nconst double Pi = acos( -1.0 ) ; \nint n, m, cnt, num, maxn, limit, nAns, L, R[N], Ans[N], Base[N], G[N], base[N], fac[N], inv[N] ; \nstruct Complex {\n\tdouble x, y ; \n\tComplex( double xx = 0, double yy = 0 ) { x = xx, y = yy ; }\n\tvoid init() { x = 0, y = 0 ; }\n} F[N], Q[N], C[N], A1[N], A2[N], B1[N], B2[N] ; \nComplex Conj( Complex x ) { return Complex( x.x, -x.y ) ; }\nint fpow( int x, int k ) {\n\tint ans = 1, base = x ; \n\twhile( k ) {\n\t\tif( k & 1 ) ans = ans * base % P ;\n\t\tbase = base * base % P, k >>= 1 ; \n\t} return ans ; \n}\nComplex operator * ( Complex x, Complex y ) { return Complex( x.x * y.x - x.y * y.y, x.x * y.y + x.y * y.x ) ; }\nComplex operator + ( Complex x, Complex y ) { return Complex( x.x + y.x, x.y + y.y ) ; }\nComplex operator - ( Complex x, Complex y ) { return Complex( x.x - y.x, x.y - y.y ) ; }\nComplex operator / ( Complex x, double y ) { return Complex(x.x / y, x.y / y ) ; }\nvoid FFT( Complex *a, int type ) {\n\tfor( int i = 0; i < limit; ++ i ) if( R[i] > i ) swap( a[R[i]], a[i] ) ;\n\tfor( int k = 1; k < limit; k <<= 1 ) {\n\t\tComplex Dw = Complex( cos( Pi / k ), type * sin( Pi / k ) );\t\n\t\tfor( int i = 0; i < limit; i += ( k << 1 ) ) {\n\t\t\tComplex w = Complex( 1, 0 ) ;\n\t\t\tfor( int j = i; j < i + k; ++ j, w = w * Dw ) {\n\t\t\t\tComplex Ny = w * a[j + k], Nx = a[j] ;\n\t\t\t\ta[j + k] = Nx - Ny,\ta[j] = Nx + Ny ; \n\t\t\t} \n\t\t}\n\t}\t\n\tif( type != 1 ) rep( i, 0, limit ) a[i] = a[i] / (double)limit ;\n}\nvoid init( int x ) {\n\tlimit = 1, L = 0 ; \n\twhile( limit < x ) limit <<= 1, ++ L ;\n\trep( i, 0, limit ) R[i] = ( R[i >> 1] >> 1 ) | ( ( i & 1 ) << ( L - 1 ) ) ;\n}\nvoid Mul( int *a, int *b, int l ) {\n\trep( i, 0, l ) A1[i].x = a[i] / cnt, A2[i].x = a[i] % cnt ; \n\trep( i, 0, l ) B1[i].x = b[i] / cnt, B2[i].x = b[i] % cnt ; \n\tFFT( A1, 1 ), FFT( A2, 1 ), FFT( B1, 1 ), FFT( B2, 1 ) ; \n\trep( i, 0, limit ) F[i] = A1[i] * B1[i], Q[i] = ( A1[i] * B2[i] + A2[i] * B1[i] ), C[i] = A2[i] * B2[i] ; \n\tFFT( F, -1 ), FFT( Q, -1 ), FFT( C, -1 ) ;\n\trep( i, 0, limit ) \n\t\ta[i] = ( (int)(F[i].x + 0.5) % P * num % P + ( (int)(Q[i].x + 0.5) % P * cnt ) % P + (int)(C[i].x + 0.5) % P ) % P,\n\t\tF[i].init(), Q[i].init(), C[i].init(), A1[i].init(), A2[i].init(), B1[i].init(), B2[i].init() ; \n\tfor( re int i = l + l + 1; i <= limit; ++ i ) a[i] = 0 ;\n} \nint A[N], B[N] ; \nvoid Mull( int *a, int *b, int k ) {\n\tint fs = fpow( 2, k ) ;\n\trep( i, 0, limit ) A[i] = a[i] * fpow( fs, i ) % P ; \n\trep( i, 0, limit ) B[i] = b[i] ; \n\tMul( A, B, n ) ;\n\trep( i, 0, limit ) a[i] = A[i] % P ; \n\trep( i, n + 1, limit ) a[i] = 0 ; \n\trep( i, 0, limit ) A[i] = 0, B[i] = 0 ;\n}\nint CC( int x, int y ) {\n\treturn ( y > x ) ? 0 : fac[x] * inv[y] % P * inv[x - y] % P ; \n}\nsigned main()\n{\n\tm = gi(), n = gi() ; maxn = n + m ; \n\tif( m > n ) { puts(\"0\") ; exit(0) ; }\n\tcnt = 32768, num = cnt * cnt % P ; \n\tfac[0] = inv[0] = 1, init(n + n + 1) ; \n\trep( i, 1, limit ) fac[i] = fac[i - 1] * i % P, inv[i] = fpow( fac[i], P - 2 ) ;\n\tAns[0] = 1 ; rep( i, 1, limit ) Base[i] = P - inv[i] ; \n\tint k = 1, uk = m ; \n\twhile(m) {\n\t\tif( m & 1 ) Mull( Ans, Base, k ) ;\n\t\trep( i, 0, limit ) G[i] = Base[i] ; \n\t\tMull( Base, G, k ), m >>= 1 ; \n\t\trep( i, 0, limit ) G[i] = 0 ;  k <<= 1 ; \n\t}\n\trep( i, 0, n ) nAns = ( nAns + fac[i] * Ans[i] % P * CC( n, i ) % P ) % P ;\n\tif( uk & 1 ) nAns = P - nAns ; \n\tprintf(\"%lld\\n\", nAns ) ;\n\treturn 0 ;\n}\n```",
        "postTime": 1591933882,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "\u6211\u600e\u4e48\u611f\u89c9\u53ea\u6709\u4e00\u7bc7\u9898\u89e3(\u90a3\u7bc7\u6d89\u53caEGF\u7684)\u6211\u80fd\u7406\u89e3\u5462\uff1f~~\u5176\u4ed6\u90fd\u662f\u9006\u5411\u9898\u89e3\u5417~~\n\n-------\n\n\u8fd8\u662f\u9996\u5148\u5148\u63a8\u5f0f\u5b50\uff0c\u8bbe $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\uff0c\u6709 $j$ \u4e2a $1$ (\u65e0\u5173\u4e8e\u5177\u4f53\u4f4d\u7f6e)\u7684\u65b9\u6848\u6570\u3002\n\n\u7531\u4e8e\u65e0\u5173\u4e8e\u5177\u4f53\u4f4d\u7f6e\uff0c\u90a3\u4e48\u7b54\u6848\u4e3a $\\sum\\limits_{i=n}^{k}f_{n,i}*\\dbinom{k}{i}$\n\n\u8003\u8651\u9012\u63a8:\n\n$$f_{i,j}=\\sum\\limits_{l=1}^{j-1}f_{i-1,l}\\dbinom{j}{l}2^{l}$$\n\n\u610f\u4e49\u4e3a:\u9009\u62e9\u4e00\u4e2a $a_i$ \uff0c\u4f7f\u5f97 $b_i$ \u6709 $j$ \u4e2a $1$ \uff0c$a_1|a_2|\\ldots|a_{i-1}$ \u5df2\u7ecf\u5305\u542b\u4e86 $l$ \u4e2a\uff0c\u90a3\u4e48 $a_i$ \u5fc5\u987b\u5305\u542b\u9664\u8fd9 $l$ \u4e2a\u4e4b\u5916\u7684\u4f4d\u7f6e\u7684 $1$ \uff0c\u76f8\u5f53\u4e8e\u6709 $j$ \u4e2a\u6570\uff0c\u8ba9\u4f60\u4ece\u4e2d\u9009\u51fa $j-l$ \u4e2a\u6570\uff0c \u5c31\u53ef\u4ee5\u5f97\u5230\u65b9\u6848\u6570 $\\dbinom{j}{l}$ \u3002\u7136\u540e $a_i$ \u8fd8\u53ef\u4ee5\u9009\u62e9\u6027\u7684\u542b\u6709 $l$ \u4e2d $1$ \uff0c\u5373 $2^l$ \u3002\n\n\u663e\u7136\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u5377\u79ef\uff0c\u4e5f\u5f88\u5bb9\u6613\u5f97\u5230 $EGF$\u3002\n\n$F_{n-1}(x)=\\sum\\limits_{i}f_{n-1,i}\\frac{x^i}{i!},e^x-1=\\sum\\limits_{i}\\frac{x^i}{i!}$\n\n\u89c2\u5bdf\u4e0a\u8ff0\u8f6c\u79fb\u65b9\u7a0b\uff0c\u5b9e\u9645\u4e0a $F_{n}(x)=\\sum_{i}(\\sum_{j}2^j\\dbinom{i}{j}f_{n-1,j})\\frac{x^i}{i!}=(e^x-1)F_{n-1}(2x)$\n\n($F(cx)=\\sum_ic^i\\frac{x^i}{i!}$)\n\n$F_{n-1}(2x)=(e^{2x}-1)F_{n-2}(4x)$\n\n\u5982\u6b64\u5f80\u590d\u4e0b\u53bb\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u4e00\u4e2a\u4f18\u7f8e\u7684\u5f0f\u5b50\uff0c\n\n$F_{n}=\\prod\\limits_{i=0}^{n-1}(e^{2^ix}-1)$\n\n\u8fb9\u754c: $F_0=0,F_{1}=e^x-1$\n\n\u4e4b\u540e\u5c31\u662f\u5957\u8def\u500d\u589e\uff0c\u5173\u4e8e\u8fd9\u4e00\u6b65\uff0c\u5927\u90e8\u5206\u9898\u89e3\u91cc\u9762\u7684\u89e3\u91ca\u90fd\u662f\u53e3\u80e1\u6216\u8005\u662f\u611f\u6027\u7684\u7406\u89e3\uff0c\u6240\u4ee5\u6211\u4eec\u6765\u63a8\u4e00\u4e0b\u5427\uff01\n\n$\\begin{aligned}F_{2n}&=\\prod\\limits_{i=0}^{2n-1}(e^{2^ix}-1)\\\\&=\\prod\\limits_{i=0}^{n-1}(e^{2^ix}-1)\\prod\\limits_{i=0}^{n-1}(e^{2^{n+i}x}-1)\\\\&=\\prod\\limits_{i=0}^{n-1}(e^{2^ix}-1)\\prod\\limits_{i=0}^{n-1}(e^{2^i2^nx}-1)\\end{aligned}$ \n\n\u89c2\u5bdf\u540e\u5f0f\uff0c\u5b8c\u5168\u53ef\u4ee5\u6362\u5143 $u=2^nx$\n\n$\\begin{aligned}F_{2n}&=F_n(x)F_n(u)\\\\&=F_n(x)F_{n}(2^nx)\\end{aligned}$\n\n\u5c55\u5f00\u56de\u539f\u5f0f:\n\n\u5176\u4e2d $F_n(2^nx)$ \u5c55\u5f00\u662f\u8fd9\u6837\u7684:\n\n$\\large\\sum\\limits_{i}2^{in}\\frac{x^i}{i!}$\n\n\u4e8e\u662f\u5377\u79ef\u4e4b\u540e\u4e3a:\n\n$\\large f_{2n,i}\\frac{x^{i}}{i!}=(\\sum\\limits_j\\dbinom{i}{j}2^{jn}f_{n,j}f_{n,i-j})\\frac{x^{i}}{i!}$\n\n\u540c\u6837\u5730\uff0c\u4e5f\u53ef\u4ee5\u5377\u79ef\uff0c\u8bb0\u5f97\u7528MTT\u3002\n\n\u4f18\u5316\u7ec6\u8282\u81ea\u5df1\u60f3\u5427\uff0c\u4e0d\u60f3\u5361\u5e38\u4e86\u3002\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<ctime>\n#include<map>\n#include<cstdlib>\n#include<vector> \n#define gc getchar()\n#define ll long long\n#define ull unsigned long long\n#define file(s) freopen(s\".in\",\"r\",stdin);freopen(s\".out\",\"w\",stdout)\n#define I inline \n#define clr(f,n) memset(f,0,sizeof(int)*(n))\n#define cpy(f,g,n) memcpy(f,g,sizeof(int)*(n)) \nusing namespace std;\nconst int N=4e5+5,mod=1e9+7,M=1<<15;\nconst double pi=acos(-1);\ntemplate<class o>I void qr(o &x)\n{\n    char c=gc;int f=1;x=0;\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n    while(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n    x*=f;\n}\ntemplate<class o>I void qw(o x)\n{\n    if(x<0)x=-x,putchar('-');\n    if(x/10)qw(x/10);\n    putchar(x%10+48);\n}\nI int ksm(int a,int b=mod-2){int ans=1;for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;return ans;}\nstruct cp\n{\n\tdouble x,y;\n\tcp(double x=0.0,double y=0.0):x(x),y(y){}\n\tI cp operator +(const cp &a)const{return cp(x+a.x,y+a.y);}\n\tI cp operator -(const cp &a)const{return cp(x-a.x,y-a.y);}\n\tI cp operator *(const cp &a)const{return cp(x*a.x-y*a.y,x*a.y+y*a.x);}\n\tI cp operator /(const double &a)const{return cp(x/a,y/a);}\n\tI cp operator *(const double &a)const{return cp(x*a,y*a);}\n\tI cp operator +(const double &a)const{return cp(x+a,y+a);}\n}w[N<<1];\ncp Ii=cp(0,1);\nint tr[N<<1],cnt;\nI void rev(int n)\n{\n\tif(cnt==n)return ;cnt=n;\n\tfor(int i=0;i<n;i++)tr[i]=(tr[i>>1]>>1|((i&1)?n>>1:0));\n}\nI void Init(int n){for(int i=1;i<n;i<<=1){w[i]=cp(1,0);for(int j=1;j<i;j++)w[i+j]=(((j&31)==1)?cp(cos(pi*j/i),sin(pi*j/i)):w[i+j-1]*w[i+1]);}}\nvoid dft(cp *g,bool op,int n)\n{\n\trev(n);\n\tstatic cp f[N<<1],t;\n\tfor(int i=0;i<n;i++)f[i]=g[tr[i]];\n\tfor(int p=2,l=1;p<=n;l=p,p<<=1)\n\t\tfor(int i=0;i<n;i+=p)for(int j=0;j<l;j++)\n\t\t\tt=w[j|l]*f[i|j|l],f[i|j|l]=f[i|j]-t,f[i|j]=f[i|j]+t;\n\tif(op)for(int i=0;i<n;i++)g[i]=f[i]/n;\n\telse for(int i=0;i<n;i++)g[i]=f[i];\n}\ncp a0[N<<1],a1[N<<1],b0[N<<1],b1[N<<1],p[N<<1],q[N<<1];\nvoid calc(cp *a,cp *b,int n)\n{\n\tfor(int i=0;i<n;i++)p[i]=a[i]+Ii*b[i];\n\tdft(p,0,n);q[0]=cp(p[0].x,-p[0].y);\n\tfor(int i=1,j=n-1;i<n;i++,j--)q[i]=cp(p[j].x,-p[j].y);\n\tfor(int i=0;i<n;i++)a[i]=(p[i]+q[i])*0.5,b[i]=(q[i]-p[i])*0.5*Ii;\n}\nll num(double x){return x<0?(ll)(x-0.49)%mod:(ll)(x+0.49)%mod;}\nvoid mtt(int *f,int *g,int m)\n{\n\tint n=1;for(;n<(m<<1);n<<=1);\n\tfor(int i=0;i<m;i++)a0[i]=cp(f[i]>>15,0),a1[i]=cp(f[i]&(M-1),0);\n\tfor(int i=0;i<m;i++)b0[i]=cp(g[i]>>15,0),b1[i]=cp(g[i]&(M-1),0);\n\tfor(int i=m;i<n;i++)a0[i]=a1[i]=b0[i]=b1[i]=cp(0,0);\n\t\n\tcalc(a0,a1,n);calc(b0,b1,n);\n\tfor(int i=0;i<n;i++)p[i]=a0[i]*b0[i]+Ii*a1[i]*b0[i],q[i]=a0[i]*b1[i]+Ii*a1[i]*b1[i];\n\treverse(p+1,p+n),reverse(q+1,q+n);\n\tdft(p,1,n),dft(q,1,n);\n\tfor(int i=0;i<m;i++)f[i]=(1ll*M*M%mod*num(p[i].x)%mod+1ll*M*num(p[i].y+q[i].x)%mod+num(q[i].y)+4ll*mod)%mod;\n\tfor(int i=m;i<n;i++)f[i]=0;\n}\nint f[N],sav[N],g[N];//f[i]->f[i]/i!\nint fac[N],ifac[N],k,dfac[N],pw[N];\nvoid init(int m)\n{\t\n\tfac[0]=ifac[0]=pw[0]=1;for(int i=1;i<=m;i++)fac[i]=1ll*fac[i-1]*i%mod,pw[i]=pw[i-1]*2%mod;\n\tdfac[0]=1;for(int i=1;i<=m;i++)dfac[i]=1ll*dfac[i-1]*(k-i+1)%mod;\n\tifac[m]=ksm(fac[m]);for(int i=m-1;i;i--)ifac[i]=1ll*ifac[i+1]*(i+1)%mod;\n}\nvoid add(int m)\n{\n\tfor(int i=1;i<m;i++)f[i]=1ll*f[i]*pw[i]%mod*ifac[i]%mod;\n\tmtt(f,sav,m);\n\tfor(int i=1;i<m;i++)f[i]=1ll*f[i]*fac[i]%mod;\n}\nvoid mul(int l,int m)\n{\n\tfor(int i=1;i<m;i++)f[i]=1ll*f[i]*ifac[i]%mod;cpy(g,f,m);\n\tfor(int i=1;i<m;i++)f[i]=1ll*f[i]*ksm(pw[l],i)%mod;\n\tmtt(f,g,m);\n\tfor(int i=1;i<m;i++)f[i]=1ll*f[i]*fac[i]%mod;\n}\nint C(int n,int m)\n{\n\tif(n<m)return 0;\n\treturn 1ll*fac[n]*ifac[m]%mod*ifac[n-m]%mod;\n}\nll n;\nint main()\n{\n\tqr(n),qr(k);int t=n;\n\tif(n>k){puts(\"0\");return 0;}\n\tinit(k);\n\tint m=k+1;\n\tfor(n=1;n<(m<<1);n<<=1);\n\tInit(n);for(int i=1;i<m;i++)f[i]=1,sav[i]=ifac[i];\n\tint lg=log2(t),j=1;\n\tfor(int i=lg-1;~i;i--)\n\t{\n\t\tmul(j,m);j<<=1;\n\t\tif(t&(1<<i))\n\t\t\tadd(m),j|=1;\n\t}\n\tll ans=0;\n\tfor(int i=1;i<=k;i++)\n\t\tans=(ans+1ll*f[i]*C(k,i)%mod)%mod;\n\tqw(ans);puts(\"\");\n\treturn 0;\n}\n \n```",
        "postTime": 1591313728,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "\u9996\u5148\u4e00\u4e2a\u5f88\u663e\u7136\u7684$O(n^2)$DP\u5f0f\u5b50\uff0c$dp[i][j]$\u8868\u793a\u8003\u8651\u4e86\u524di\u4f4d\uff1a\n\n$$dp[i][j]=\\sum_{k=1}^{j}{j\\choose k}2^{j-k}dp[i-1][j-k]$$\n\n\u5148\u8bf4\u8bf4\u6211\u63a8\u8fd9\u4e2a\u5f0f\u5b50\u7684\u5fc3\u8def\u5386\u7a0b\uff1a\n\n\u6211\u4eec\u628a\u8f6c\u79fb\u7528EGF\u5199\u51fa\u6765\uff0c\u5c31\u662f\n\n$$dp_i(x)=(e^x-1)dp_{i-1}(2x)$$\n\n\u5199\u4e0b\u6765\u53d1\u73b0\uff1a\n\n$$dp_1(x)=e^x-1$$\n\n$$dp_2(x)=(e^x-1)(e^{2x}-1)$$\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\n\n$$\\begin{aligned}dp_n(x)&=\\prod_{i=0}^{n-1} (e^{2^ix}-1)\\\\&=\\sum _{i=0}^{2^n-1}(-1)^{popcount(i)}e^{ix}\\end{aligned}$$\n\n\u6ce8\u610f\u5230\u6700\u7ec8\u7b54\u6848\u662f\n\n$$[x^k]e^xdp_n(x)$$\n\n\u6cf0\u52d2\u5c55\u5f00\u5f97\u5230\n\n$$ans=\\sum_i^{2^n-1}(-1)^{popcount(i)}(i+1)^k$$\n\n------------\n\n\u63d2\u4e00\u4e2a\u6709\u610f\u601d\u7684\u6027\u8d28\uff1a\n\n$$\\sum_i^{2^n-1}(-1)^{popcount(i)}i^k$$\n\n\u5f53$n>k$\u65f6\u4e3a0.\n\n\u5982\u679c\u4f60\u5728\u505a\u8fd9\u9053\u9898\uff0c\u4f60\u4f1a\u89c9\u5f97\u975e\u5e38\u663e\u7136\uff1b\u4f46\u662f\u5982\u679c\u6ca1\u6709\u8fd9\u9053\u9898\u7684\u80cc\u666f\uff0c\u600e\u4e48\u8bc1\uff1f\n\n\u8003\u8651n\u5143\u96c6\u5408\uff0c\u7b2ci\u4e2a\u5143\u7d20\u7684\u6743\u503c\u4e3a$2^i$\uff0c\u90a3\u4e48$i^k$\u5c31\u662f\u4ece\u5168\u96c6\u4e2d\u53ef\u91cd\u590d\u7684\u9009k\u4e2a\uff0c\u5982\u679c\u8fd9k\u4e2a\u7684\u5e76\u96c6\u4e0d\u662f\u5168\u96c6\uff0c\u90a3\u4e48\u7cfb\u6570\u548c\u4e3a0\uff0c\u56e0\u4e3a$n>k$\uff0c\u6240\u4ee5\u5e76\u96c6\u4e0d\u53ef\u80fd\u662f\u5168\u96c6\u3002\n\n--------------\n\n\u8003\u8651\u5bf9n\u500d\u589e\uff0c\u8bbe\n\n$$f(n,k,0)=\\sum_i^{2^n-1}[popcount(i)\\bmod 2=0]i^k$$\n\n\u7c7b\u4f3c\u7684\u8bbe$f(n,1)$\u3002\n\n\u90a3\u4e48$n \\to 2n$\u7684\u8fc7\u7a0b\uff0c\u8ba8\u8bba\u5947\u5076\u7ec4\u5408\u540e\uff0c\u5c31\u76f8\u5f53\u4e8e\u5df2\u77e5$\\sum a^k,\\sum b^k$\uff0c\u6c42$\\sum(a+b)^k$\uff0c\u4e8c\u9879\u5f0f\u5c55\u5f00\uff0cNTT\u5377\u79ef\u5373\u53ef\u3002\n\n~~\u5982\u679c\u8fd9\u9053\u9898\u6a21\u6570\u4e3a998244353\u6211\u5c31\u5199\u4e86~~\n\n---------------\n\n\u6b63\u5e38\u7684\u9898\u89e3(by ywy)\u7684\u505a\u6cd5\uff0c\u548c\u6211\u8bf4\u7684\u672c\u8d28\u76f8\u540c\uff1a\n\n![\u6355\u83b7.png](https://i.loli.net/2019/06/11/5cff6ec43a11194983.png)",
        "postTime": 1560242408,
        "uid": 58302,
        "name": "i207M",
        "ccfLevel": 0,
        "title": "\u500d\u589eFFT-CF623E Transforming Sequence-\u89e3\u9898\u62a5\u544a"
    },
    {
        "content": "\u9898\u610f\uff1a\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a $a\\rightarrow b$ \u53d8\u6362\u4e3a $b_i=|_{j=1}^ia_j$\uff08\u9ad8\u80fd\u751f\u8349\u524d\u7f00\u6216\uff0c\u79f0\u4e00\u4e2a\u725b\u903c\u7684 $a$ \u4e3a\uff0c\u5b83\u7684\u53d8\u6362\u662f\u4e25\u683c\u5355\u8c03\u9012\u589e\u7684\uff0c\u90a3\u5c31\u8981\u95ee\u4f60\u4e86\uff0c\u7ed9\u5b9a $k$ \u6709\u591a\u5c11 $a$ \u6ee1\u8db3 $|a|=n$ \u4e14 $\\forall 1\\le i\\le n,s.t.\\ 1\\le a_i\\le 2^k-1$\u3002$1\\le n\\le 10^{18},1\\le k\\le 3\\times10^4$\n\n\u6211\u4eec\u524d\u7f00\u6216\u662f\u4e00\u5b9a\u4e0d\u4f1a\u51cf\u5c11\u7684\uff0c\u95ee\u9898\u5c31\u662f\u8fd9\u4e2a\u5355\u8c03\u9012\u589e\uff0c\u6211\u4eec\u8003\u8651\u641e\u4e00\u4e2a $dp$ \u65b9\u7a0b\uff0c\u8bbe $f_{i,j}$ \u4e3a\u524d $i$ \u4e2a\u6709 $j$ \u4e2a $1$\uff08\u4e0d\u4fdd\u8bc1\u5408\u6cd5\uff09\uff0c\u5219\uff1a\n\n$$f_{i,j}=\\sum_{k=0}^jf_{i-1,k}\\binom j k2^{k}$$\n\n\u5c31\u662f\u8bf4\uff0c\u8fd9 $k$ \u4e2a\u4f4d\u7f6e\u5fc5\u7136\u5305\u542b\u4e8e $j$ \u4e2a\u4f4d\u7f6e\u4e2d\uff0c\u4e8e\u662f\u4e58\u4e0a\u4e00\u4e2a\u7ec4\u5408\u6570\u8868\u793a\u6240\u6709\u5305\u542b\u7684\u60c5\u51b5\uff0c\u518d\u4e58\u4e0a\u4e00\u4e2a\u4e8c\u7684\u5e42\u8868\u793a\u8fd9 $k$ \u4e2a\u4f4d\u7f6e\u53ef\u6709\u53ef\u65e0\uff0c\u56e0\u4e3a\u662f\u6216\u8fd0\u7b97\u3002\n\n\u7136\u540e\u6211\u4eec\u4f7f\u7528\u500d\u589e\uff0c\u8fd8\u6709\n\n$$f_{2n,k}=\\sum_{i=0}^kf_{n,i}f_{n,k-i}\\binom k i2^{ni}$$\n\n\u539f\u7406\u7565\u540c\uff0c\u7136\u540e\u5c31\u80fd\u6574\u4e2a $\\text{EGF}$ \u500d\u589e\u4e86\u3002\n\n\u73b0\u5728\u662f $11:41$\uff0c\u6211\u770b\u6211\u4ec0\u4e48\u65f6\u5019\u5199\u5b8c\u3002\n\n\u73b0\u5728\u662f $13:08$\uff0c\u6211\u5199\u5b8c\u4e86\u3002\n\n\u5404\u79cd\u795e\u79d8\u7ec4\u5408\u9519\u8bef\uff0c\u8c03\u6b7b\u6211\u4e86\u3002\n\n```cpp\nlong long n;\nint k;\npoly f,ex_1;\npoly solve(int n){\n\tif(n==1)return ex_1;\n\tpoly f=solve(n>>1);\n\tpoly g=f;\n\tfor(int i=0,j=ksm(2,n>>1),l=1;i<=k;i++,mul(l,j))mul(g[i],l);\n\tf=mtt(f,g);f.resize(k+1);\n\tif(n&1){\n\t\tfor(int i=0,l=1;i<=k;i++,mul(l,2))mul(f[i],l);\n\t\tf=mtt(f,ex_1),f.resize(k+1);\n\t}\n\treturn f;\n}\nsigned main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"testdata.in\",\"r\",stdin);\n#endif\n\tcin>>n>>k;\n\tif(n>k)return cout<<0,0;\n\tinit(k);\n\tex_1.resize(k+1);\n\tfor(int i=1;i<=k;i++)ex_1[i]=jcinv[i];\n\tf=solve((int)n);\n\tint ans=0;\n\tfor(int i=1;i<=k;i++)add(ans,Mul(f[i],Mul(jc[k],jcinv[k-i])));\n\tcout<<ans;\n#ifndef ONLINE_JUDGE\n\tcerr<<endl<<(double)clock()/CLOCKS_PER_SEC;\n#endif\n}\n```\n\u4e0a\u9762\u662f\u6211\u7684\u591a\u9879\u5f0f\u677f\u5b50\uff0c[\u5b89\u5229\u4e00\u6ce2](https://www.luogu.com.cn/blog/Peterprpr/mu-ban)\u3002",
        "postTime": 1632368525,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "CF623E Transforming Sequence \u8bb0\u5f55"
    },
    {
        "content": "&emsp;&emsp;[\u63a8\u9500\u535a\u5ba2 owo](https://www.cnblogs.com/rainybunny/p/13161559.html)\u3002\n\n# \u9898\u76ee\n\n## \u9898\u610f\u7b80\u8ff0\n\n&emsp;&emsp;[link](https://www.luogu.com.cn/problem/CF623E).\n\n&emsp;&emsp;\u6709\u4e00\u4e2a $n$ \u4e2a\u5143\u7d20\u7684\u96c6\u5408\uff0c\u4f60\u9700\u8981\u8fdb\u884c $m$ \u6b21\u64cd\u4f5c\u3002\u6bcf\u6b21\u64cd\u4f5c\u9009\u62e9\u96c6\u5408\u7684\u4e00\u4e2a\u975e\u7a7a\u5b50\u96c6\uff0c\u8981\u6c42\u8be5\u96c6\u5408\u4e0d\u662f\u5df2\u9009\u96c6\u5408\u7684\u5e76\u7684\u5b50\u96c6\u3002\u6c42\u64cd\u4f5c\u7684\u65b9\u6848\u6570\uff0c\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n## \u6570\u636e\u89c4\u6a21\n\n&emsp;&emsp;$n\\le3\\times10^4$\u3002\n\n# $\\text{Solution}$\n\n&emsp;&emsp;\u663e\u7136\u5f53 $n<m$\uff0c\u7b54\u6848\u4e3a $0$\uff0c\u5148\u7279\u5224\u6389\u3002\n\n&emsp;&emsp;\u9996\u5148\u5217\u4e00\u4e2a naive \u7684 DP \u65b9\u7a0b\uff0c\u4ee4 $f(i,j)$ \u4e3a**\u524d $i$ \u6b21\u64cd\u4f5c\u9009\u51fa\u7684\u96c6\u5408\u5e76\u5927\u5c0f\u4e3a $j$ \u7684\u65b9\u6848\u6570**\u3002\u6613\u6709\uff1a\n$$\nf(i,j)=\\sum_{k=1}^j2^{j-k}{n-(j-k)\\choose k}f(i-1,j-k)\n$$\n&emsp;&emsp;\u90a3\u4e48\u7b54\u6848\u4e3a $\\sum_{i=1}^nf(m,i)$\u3002\u66b4\u529b DP \u662f $\\mathcal{O}(mn^2)$ \u7684\u3002\u4e0d\u8fc7\u5f88\u663e\u7136\u8fd9\u4e2a\u5f0f\u5b50\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\u3002\u628a\u5b83\u53d8\u4e00\u4e0b\u5f62\uff1a\n$$\nf(i,j)=\\frac{1}{(n-j)!}\\sum_{k=1}^j\\frac{1}{k!}\\cdot2^{j-k}[n-(j-k)]!f(i-1,j-k)\n$$\n&emsp;&emsp;~~\u5ffd\u7565\u6bd2\u7624\u7684\u6a21\u6570\uff0c~~\u6bcf\u6b21\u8f6c\u79fb NTT \u5c31\u53ef\u4ee5\u4e86\uff0c\u590d\u6742\u5ea6 $\\mathcal{O}(mn\\log n)$\u3002\n\n&emsp;&emsp;\u8fd9\u4e2a $f$ \u4e0d\u592a\u597d\u4f18\u5316\u3002\u6211\u4eec\u6362\u4e00\u79cd\u5f62\u5f0f\uff0c\u4ee4 $g(i,j)$ \u4e3a**\u524d $i$ \u6b21\u64cd\u4f5c\u9009\u51fa\u524d $j$ \u4e2a\u5143\u7d20\u7684\u65b9\u6848\u6570**\u3002\u6240\u4ee5 $g(i,j)=\\frac{f(i,j)}{n\\choose j}$\u3002\u90a3\u4e48\u5bf9\u4e8e $g(1)$\uff0c\u6709 $g(1,i)=[0<i\\le n]$\u3002\u6765\u8003\u8651\u4e24\u5c42\u72b6\u6001\u7684\u5408\u5e76\uff1a\n$$\ng(u+v,i)=\\sum_{j=0}^ig(u,j)g(v,i-j){i\\choose j}(2^j)^v\n$$\n&emsp;&emsp;\u7406\u89e3\u4e00\u4e0b\uff1a\u628a $u+v$ \u6b21\u64cd\u4f5c\u548c $i$ \u4e2a\u9009\u51fa\u7684\u5143\u7d20\u5206\u62c6\u6210\u4e24\u6b65\u5b8c\u6210\uff1a\u7b2c\u4e00\u6b65\u9009 $j$ \u4e2a\u5143\u7d20\uff0c\u7b2c\u4e8c\u6b65\u9009 $i-j$ \u4e2a\u3002\u7531\u4e8e\u8981\u5728 $i$ \u91cc\u62ff\u51fa $j$ \u4e2a\u7ed9\u7b2c\u4e00\u6b65\uff08\u6216\u8bf4\u62ff\u51fa $i-j$ \u7ed9\u7b2c\u4e8c\u6b65\uff09\uff0c\u6240\u4ee5\u6709\u7cfb\u6570 $i\\choose j$\u3002\u5173\u952e\u70b9\u5728\u4e8e $(2^u)^j$\uff1a\u5728\u7b2c\u4e00\u6b65\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u9009\u51fa\u4e86 $j$ \u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\u5728\u7b2c\u4e8c\u6b65\u7684\u6bcf\u6b21\u64cd\u4f5c\uff0c\u90fd\u53ef\u4ee5\u4efb\u610f\u53d6 $j$ \u4e2a\u5143\u7d20\u7684\u5b50\u96c6\uff0c\u6545\u6709\u7cfb\u6570 $(2^j)^v$\u3002\n\n&emsp;&emsp;\u5411\u5377\u79ef\u5f62\u5f0f\u9760\u62e2\uff1a\n$$\ng(u+v,i)=i!\\sum_{j=0}^i\\frac{2^{jv}g(u,j)}{j!}\\cdot\\frac{g(v,i-j)}{(i-j)!}\n$$\n&emsp;&emsp;\u500d\u589e\u5904\u7406 $g$ \u5373\u53ef\u3002\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n\\log m)$\u3002\n\n## \u4ee3\u7801\n\n&emsp;&emsp;\u8fd9\u91cc\u7528 MTT \u5b9e\u73b0\u4efb\u6a21 NTT\u3002\u8981\u7279\u522b\u7559\u610f\u6bcf\u4e00\u6b65\u7684\u53d6\u6a21\u55f7 qwq\u3002\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <iostream>\n\ntypedef long long LL;\n\nconst int MAXN = 1 << 16, P = 1e9 + 7;\nconst double PI = acos ( -1 );\nint n, m, len, lg, rev[MAXN + 5], fac[MAXN + 5], ifac[MAXN + 5], pwr[MAXN + 5];\nint F[MAXN + 5], ans[MAXN + 5];\n\nstruct Complex {\n\tdouble x, y;\n\tComplex () {} Complex ( const double tx, const double ty ): x ( tx ), y ( ty ) {}\n\tinline Complex operator + ( const Complex t ) const { return Complex ( x + t.x, y + t.y ); }\n\tinline Complex operator - ( const Complex t ) const { return Complex ( x - t.x, y - t.y ); }\n\tinline Complex operator * ( const Complex t ) const { return Complex ( x * t.x - y * t.y, x * t.y + y * t.x ); }\n\tinline Complex operator / ( const double t ) const { return Complex ( x / t, y / t ); }\n} omega[MAXN + 5];\n\ninline void FFT ( const int n, Complex* A, const int tp ) {\n\tfor ( int i = 0; i < n; ++ i ) if ( i < rev[i] ) std::swap ( A[i], A[rev[i]] );\n\tfor ( int i = 2, stp = 1; i <= n; i <<= 1, stp <<= 1 ) {\n\t\tfor ( int j = 0; j < n; j += i ) {\n\t\t\tfor ( int k = 0; k < stp; ++ k ) {\n\t\t\t\tComplex w ( omega[n / stp * k].x, tp * omega[n / stp * k].y );\n\t\t\t\tComplex ev ( A[j + k] ), ov ( w * A[j + k + stp] );\n\t\t\t\tA[j + k] = ev + ov, A[j + k + stp] = ev - ov;\n\t\t\t}\n\t\t}\n\t}\n\tif ( ! ~ tp ) for ( int i = 0; i < n; ++ i ) A[i] = A[i] / n;\n}\n\ninline void initFFT ( const int lg ) {\n\tint n = 1 << lg;\n\tfor ( int i = 0; i < n; ++ i ) rev[i] = ( rev[i >> 1] >> 1 ) | ( ( i & 1 ) << lg >> 1 );\n\tfor ( int i = 1; i < n; i <<= 1 ) {\n\t\tfor ( int k = 0; k < i; ++ k ) {\n\t\t\tomega[n / i * k] = Complex ( cos ( PI * k / i ), sin ( PI * k / i ) );\n\t\t}\n\t}\n}\n\ninline void polyConv ( const int n, const int* A, const int* B, int* C ) {\n\tstatic Complex highA[MAXN + 5], highB[MAXN + 5], lowA[MAXN + 5], lowB[MAXN + 5];\n\tfor ( int i = 0; i < n; ++ i ) {\n\t\tlowA[i].x = A[i] & 0x7fff, highA[i].x = A[i] >> 15;\n\t\tlowB[i].x = B[i] & 0x7fff, highB[i].x = B[i] >> 15;\n\t\tlowA[i].y = highA[i].y = lowB[i].y = highB[i].y = 0;\n\t}\n\tFFT ( n, lowA, 1 ), FFT ( n, highA, 1 ), FFT ( n, lowB, 1 ), FFT ( n, highB, 1 );\n\tfor ( int i = 0; i < n; ++ i ) {\n\t\tComplex la ( lowA[i] ), ha ( highA[i] ), lb ( lowB[i] ), hb ( highB[i] );\n\t\tlowA[i] = ha * hb, highA[i] = la * hb, lowB[i] = ha * lb, highB[i] = la * lb;\n\t}\n\tFFT ( n, lowA, -1 ), FFT ( n, highA, -1 ), FFT ( n, lowB, -1 ), FFT ( n, highB, -1 );\n\tfor ( int i = 0; i < n; ++ i ) {\n\t\tC[i] = ( ( 1ll << 30 ) % P * ( LL ( round ( lowA[i].x ) ) % P ) % P\n\t\t\t + ( LL ( round ( highA[i].x ) ) % P << 15 ) % P\n\t\t\t + ( LL ( round ( lowB[i].x ) ) % P << 15 ) % P\n\t\t\t + ( LL ( round ( highB[i].x ) ) % P ) ) % P;\n\t}\n}\n\ninline int qkpow ( int a, int b, const int p = P ) {\n\tint ret = 1;\n\tfor ( ; b; a = 1ll * a * a % p, b >>= 1 ) ret = 1ll * ret * ( b & 1 ? a : 1 ) % p;\n\treturn ret;\n}\n\ninline void init ( const int n ) {\n\tfac[0] = ifac[0] = pwr[0] = 1;\n\tfor ( int i = 1; i <= n; ++ i ) {\n\t\tfac[i] = 1ll * i * fac[i - 1] % P;\n\t\tpwr[i] = ( pwr[i - 1] << 1 ) % P;\n\t}\n\tifac[n] = qkpow ( fac[n], P - 2 );\n\tfor ( int i = n - 1; i; -- i ) ifac[i] = ( i + 1ll ) * ifac[i + 1] % P;\n}\n\ninline void add ( const int fn, const int fm ) {\n\tif ( ! fn ) {\n\t\tfor ( int i = 0; i <= n; ++ i ) ans[i] = F[i];\n\t\treturn ;\n\t}\n\tstatic int A[MAXN + 5], B[MAXN + 5];\n\tfor ( int i = 0; i <= n; ++ i ) {\n\t\tA[i] = 1ll * ans[i] * ifac[i] % P * qkpow ( 2, 1ll * i * fm % ( P - 1 ) ) % P;\n\t\tB[i] = 1ll * F[i] * ifac[i] % P;\n\t}\n\tfor ( int i = n + 1; i < len; ++ i ) A[i] = B[i] = 0;\n\tpolyConv ( len, A, B, ans );\n\tfor ( int i = 0; i <= n; ++ i ) ans[i] = 1ll * ans[i] * fac[i] % P;\n\tfor ( int i = n + 1; i < len; ++ i ) ans[i] = 0;\n}\n\ninline void shift ( const int cur ) {\n\tstatic int A[MAXN + 5], B[MAXN + 5];\n\tfor ( int i = 0; i <= n; ++ i ) {\n\t\tA[i] = 1ll * F[i] * ifac[i] % P * qkpow ( 2, 1ll * i * cur % ( P - 1 ) ) % P;\n\t\tB[i] = 1ll * F[i] * ifac[i] % P;\n\t}\n\tfor ( int i = n + 1; i < len; ++ i ) A[i] = B[i] = 0;\n\tpolyConv ( len, A, B, F );\n\tfor ( int i = 0; i <= n; ++ i ) F[i] = 1ll * F[i] * fac[i] % P;\n\tfor ( int i = n + 1; i < len; ++ i ) F[i] = 0;\n}\n\nint main () {\n\tscanf ( \"%d %d\", &m, &n );\n\tif ( m > n ) return puts ( \"0\" ), 0;\n\tlen = 1, lg = 0;\n\tfor ( ; len <= n << 1; len <<= 1, ++ lg );\n\tinitFFT ( lg ), init ( n );\n\tfor ( int i = 1; i <= n; ++ i ) F[i] = 1;\n\tfor ( int i = 0, cur = 0; 1 << i <= m; ++ i ) {\n\t\tif ( ( m >> i ) & 1 ) add ( cur, 1 << i ), cur |= 1 << i;\n\t\tshift ( 1 << i );\n\t}\n\tint sum = 0;\n\tfor ( int i = 0; i <= n; ++ i ) {\n\t\tsum = ( sum + 1ll * ans[i] * fac[n] % P * ifac[i] % P * ifac[n - i] ) % P;\n\t}\n\tprintf ( \"%d\\n\", sum );\n\treturn 0;\n}\n```\n",
        "postTime": 1592532932,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    },
    {
        "content": "\u7531\u4e8e\u53ef\u80fd\u6709\u51b2\u7a81\uff0c\u4ee5\u4e0b\u5747\u7528$m$\u6765\u4ee3\u66ff\u9898\u76ee\u4e2d\u7684$k$\u3002\n\n\u8981\u60f3$B$\u4e25\u683c\u5355\u8c03\uff0c\u663e\u7136\u63d2\u5165\u7684\u8fd9\u4e2a\u6570\u81f3\u5c11\u6709\u4e00\u4e2a\u4f4d\u7f6e\u662f$1$\uff0c\u800c\u4e4b\u524d\u5168\u90e8\u6570\u8be5\u4f4d\u7f6e\u90fd\u662f$0$\u3002\n\n\u8fd9\u6837\u5c31\u8bf4\u660e\u4e86\uff0c\u5f53$n>m$\u65f6\uff0c\u65e0\u89e3\u3002\n\n\u9996\u5148\u8003\u8651dp\uff0c\u8bbe$f[i][j]$\u4e3a\u53d6\u4e86$i$\u4e2a\u6570\uff0c\u5176\u4e2d\u6709$j$\u4e2a\u4f4d\u7f6e\u662f$1$\u7684\u65b9\u6848\u6570\uff0c\u8fd9\u91cc\u4e0d\u8003\u8651$1$\u7684\u4f4d\u7f6e\u3002\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f$\\sum_{i=0}^{m}f[n][i]*\\binom{m}{i}$\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4ece$m$\u4f4d\u9009\u51fa$i$\u4f4d\u662f$1$\u7684\u6240\u6709\u65b9\u6848\u4e58\u4e0a$f[i][j]$\uff0c\u8fd8\u662f\u8981\u8bb0\u4f4f$f[i][j]$\u7684\u5b9a\u4e49\u3002\n\u53ef\u4ee5\u8fd9\u6837\u8f6c\u79fb\uff1a\n$$f[i][j]=\\sum_{k=0}^{j-1}f[i-1][k]*\\binom{j}{k}*2^{k}$$\n\u5176\u4e2d\uff0c$\\binom{j}{k}$\u8868\u793a\u4ece$j$\u4e2a$1$\u4e2d\u54ea$k$\u4e2a\u4f4d\u7f6e\u524d\u9762\u5df2\u7ecf\u5360\u7528\uff0c\u800c$2^{k}$\u8868\u793a\u80fd\u586b\u7684\u6570\u7684\u4e2a\u6570\u3002\u663e\u7136\uff0c\u90a3\u5df2\u7ecf\u5360\u7528\u7684$k$\u7684\u4f4d\u7f6e\u53ef\u4ee5\u586b$0$\u6216$1$\uff0c\u5176\u4ed6\u65b0\u5360\u7528\u4f4d\u7f6e\u53ea\u80fd\u586b$1$\uff0c\u672a\u5360\u7528\u53ea\u80fd\u586b$0$\u3002\u4e8e\u662f\u5f97\u5230\u4e86\u4e00\u4e2a$O(k^3)$\u7684\u7b97\u6cd5\u3002\n\n\u6211\u4eec\u8003\u8651\u4f18\u5316\uff0c\u5148\u628a\u7ec4\u5408\u6570\u62c6\u51fa\u6765\uff0c\u6709\n$$f[i][j]=\\sum_{k=1}^{j-1}f[i-1][k]*\\frac{j!}{k!*(j-k)!}*2^{k}$$\n$$\\frac{f[i][j]}{j!}=\\sum_{k=0}^{j-1}\\frac{f[i-1][k]*2^{k}}{k!}*\\frac{1}{(j-k)!}$$\n\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0c\u7528$fft$\u52a0\u901f\u3002\u590d\u6742\u5ea6\u4e3a$O(k^2logk)$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u53ea\u4ece$i-1$\u8f6c\u79fb\u6709\u70b9\u6162\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u5feb\u901f\u8f6c\u79fb\uff0c\u628a\u5f0f\u5b50\u5199\u6210\u8fd9\u6837\uff0c\n$$f[x+y][i]=\\sum_{j=0}^{i}f[x][j]*f[y][i-j]*\\binom{i}{j}*2^{y*j}$$\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7b2c$x$\u4e2a\u591a\u9879\u5f0f\u548c\u7b2c$y$\u4e2a\u591a\u9879\u5f0f\u5377\u79ef\u5c31\u662f\u7b2c$x+y$\u4e2a\u591a\u9879\u5f0f\u4e86\uff0c\u76f4\u63a5\u5feb\u901f\u5e42\u5c31\u597d\u4e86\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(klog^2k)$\u3002\u5355\u4f4d\u590d\u6839\u8981\u7528\u6570\u7ec4\u6765\u5b58\uff0c\u4e0d\u7136\u4f1awa\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#define LL long long \n\nusing namespace std;\n\nconst LL maxk=70007;\nconst LL p=1e9+7;\nconst double pi=acos(-1);\n\nLL n,m,len;\nLL f[maxk],f1[maxk];\nLL jc[maxk],r[maxk],inv[maxk],bit[maxk];\n\nstruct rec{\n    double x,y;\n};\n\nrec operator +(rec x,rec y)\n{\n    return (rec){x.x+y.x,x.y+y.y};\n}\n\nrec operator -(rec x,rec y)\n{\n    return (rec){x.x-y.x,x.y-y.y};\n}\n\nrec operator *(rec x,rec y)\n{\n    return (rec){x.x*y.x-x.y*y.y,x.x*y.y+x.y*y.x};\n}\n\nrec operator /(rec x,LL y)\n{\n    return (rec){x.x/(double)y,x.y/(double)y};\n}\n\nrec operator !(rec x)\n{\n    return (rec){x.x,-x.y};\n}\n\nrec dfta[maxk],dftb[maxk],dftc[maxk],dftd[maxk];\nrec a[maxk],b[maxk],w[maxk];\n\nvoid init(LL len)\n{\n    LL k=trunc(log(len+0.5)/log(2));\n    for (LL i=0;i<len;i++)\n    {\n        r[i]=(r[i>>1]>>1)|((i&1)<<(k-1));\n    }\n}\n\nvoid fft(rec *a,LL f)\n{\n    for (LL i=0;i<len;i++)\n    {\n        if (i<r[i]) swap(a[i],a[r[i]]);\n    }\n    w[0]=(rec){1,0};\n    for (LL i=2;i<=len;i*=2)\n    {\n        rec wn=(rec){cos(2*pi/i),f*sin(2*pi/i)};\n        for(LL j=i/2;j>=0;j-=2)w[j]=w[j/2];\n        for(LL j=1;j<i/2;j+=2)w[j]=w[j-1]*wn;\n        for (LL j=0;j<len;j+=i)\n        {\n            //rec w=(rec){1,0};\n            for (LL k=0;k<i/2;k++)\n            {\n                rec v=w[k]*a[j+k+i/2];\n                a[j+k+i/2]=a[j+k]-v;\n                a[j+k]=a[j+k]+v;\n            //    w=w*wn;\n            }\n        }\n    }\n}\n\nvoid FFT(LL *x, LL *y, LL *z,LL n,LL m)\n{\n    len=1;\n    while (len<n+m) len*=2;\n    init(len);\n    for (LL i=0;i<len;i++)\n    {\n        LL A,B;\n        if (i<n) A=x[i]%p; else A=0;\n        if (i<m) B=y[i]%p; else B=0;\n        a[i]=(rec){A&32767,A>>15};\n        b[i]=(rec){B&32767,B>>15};\n    }\n    fft(a,1); fft(b,1);  \t \n    for (LL i=0;i<len;i++)\n    {\n        LL j=(len-i)&(len-1);\n        rec da,db,dc,dd;\n        da=(a[i]+(!a[j]))*(rec){0.5,0};\n        db=(a[i]-(!a[j]))*(rec){0,-0.5};\n        dc=(b[i]+(!b[j]))*(rec){0.5,0};\n        dd=(b[i]-(!b[j]))*(rec){0,-0.5};\n        dfta[i]=da*dc;\n        dftb[i]=da*dd;\n        dftc[i]=db*dc;\n        dftd[i]=db*dd;\n    }    \n    for (int i=0;i<len;i++)\n    {\n    \ta[i]=dfta[i]+dftb[i]*(rec){0,1};\n    \tb[i]=dftc[i]+dftd[i]*(rec){0,1};\n    }\t\n    fft(a,-1); fft(b,-1);\n    for (int i=0;i<n+m-1;i++)\n    {\n        LL da=(LL)(a[i].x/len+0.5)%p;\n        LL db=(LL)(a[i].y/len+0.5)%p;\n        LL dc=(LL)(b[i].x/len+0.5)%p;\n        LL dd=(LL)(b[i].y/len+0.5)%p;\n        z[i]=(da%p+(((db+dc)<<15)%p+(dd<<30)%p)%p)%p;\n    }\n}\n\nLL power(LL x,LL y)\n{\n    if (y==1) return x;\n    LL c=power(x,y/2);\n    c=(c*c)%p;\n    if (y%2) c=(c*x)%p;\n    return c;\n}\n\nvoid solve(LL n,LL k)\n{\n    if (n==1)\n    {\n        f[0]=0;\n        for (LL i=1;i<=k;i++) f[i]=1;\n        return;\n    }\n    solve(n/2,k);\n    for(LL i=1;i<=k;i++)\n    {\n        f[i]=(LL)f[i]*inv[i]%p;\n        f1[i]=(LL)f[i]*power(2,(n/2)*i%(p-1))%p;\n    } \t \t    \n    FFT(f,f1,f,k+1,k+1); \t\t   \n    if(n&1)\n    {\n        for(LL i=1;i<=k;i++)\n        {\n            f[i]=(LL)f[i]*bit[i]%p;\n            f1[i]=inv[i];\n        }\n        FFT(f,f1,f,k+1,k+1);\n    }\n    for (LL i=1;i<=k;i++)f[i]=(LL)f[i]*jc[i]%p;\n}\n\nLL binom(LL x,LL y)\n{\n    if ((x<0) || (y<0) || (y>x)) return 0;\n    if ((x==0) || (y==x))  return 1;\n    return jc[x]*inv[y]%p*inv[x-y]%p;\n}\n\nint main()\n{\n    scanf(\"%lld%lld\",&n,&m);\n    jc[0]=1; inv[0]=1; bit[0]=1;\n    for (LL i=1;i<=m;i++)\n    {\n        jc[i]=(jc[i-1]*i)%p;\n        bit[i]=(bit[i-1]*2)%p;\n        inv[i]=power(jc[i],p-2);\n    }\n    if (n>m)\n    {\n        printf(\"0\");\n        return 0;\n    }\t\t\t\t\t\n    solve(n,m);\t\n    LL ans=0;\n    for(LL i=1;i<=m;i++)\n      ans=(ans+f[i]*binom(m,i)%p)%p;\n    printf(\"%lld\",ans);\n}\n```",
        "postTime": 1533809883,
        "uid": 18895,
        "name": "liangzihao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF623E \u3010Transforming Sequence\u3011"
    }
]