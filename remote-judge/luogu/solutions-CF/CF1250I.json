[
    {
        "content": "\u9996\u5148\u4e00\u4e2a\u663e\u7136\u7684\u60f3\u6cd5\u662f\u4ece\u5927\u5f80\u5c0f\u679a\u4e3e\u96c6\u5408\u5927\u5c0f $K$\uff0c\u7136\u540e\u627e\u5230\u8be5\u96c6\u5408\u5927\u5c0f\u65f6\u6700\u5c0f\u7684\u82e5\u5e72\u65b9\u6848\u3002\n\n\u9996\u5148\u628a\u6240\u6709\u5143\u7d20\u9012\u589e\u6392\u5e8f\uff0c\u5f97\u5230\u6570\u7ec4 $a$\u3002\u8bb0 $s$ \u4e3a\u5176\u524d\u7f00\u548c\u3002\n\n\u6700\u5c0f\u7684\u65b9\u6848\u663e\u7136\u662f\u9009\u62e9\u524d $K$ \u5c0f\u7684\u5143\u7d20\u3002\u7136\u540e\u8003\u8651\u7528\u4e00\u4e2a\u5806\u6765\u7ef4\u62a4\u5f53\u524d\u6240\u6709\u53ef\u80fd\u7684\u5907\u9009\u72b6\u6001\u3002\n\n\u6211\u4eec\u7528\u4e00\u4e2a\u56db\u5143\u7ec4 $(i,j,k,w)$ \u6765\u63cf\u8ff0\u4e00\u4e2a\u72b6\u6001\uff1a\u5b83\u610f\u4e3a\u7b2c $i$ \u5c0f\u7684\u5143\u7d20\u4f4d\u4e8e\u4f4d\u7f6e $j$\uff0c$i+1$ \u5c0f\u7684\u5143\u7d20\u4f4d\u4e8e\u4f4d\u7f6e $k$\uff0c\u4e14 $[i+1,K]$ \u4e2d\u7684\u5143\u7d20\u4f4d\u7f6e\u90fd\u5df2\u56fa\u5b9a\uff0c$[1,i-1]$ \u4e2d\u5143\u7d20\u90fd\u4f4d\u4e8e\u5176\u521d\u59cb\u4f4d\u7f6e\uff0c\u6240\u6709\u5143\u7d20\u548c\u4e3a $w$ \u65f6\u7684\u72b6\u6001\u3002\u7528\u4e00\u4e2a\u5806\u6765\u7ef4\u62a4\u4e4b\u3002\n\n\u521d\u59cb\u5f80\u5806\u4e2d\u6254\u4e00\u4e2a $(K,K,n+1,s_K)$\u3002\u7136\u540e\u6bcf\u6b21\u53d6\u51fa\u5806\u9876\u5143\u7d20 $(i,j,k,w)$\uff0c\u5f80\u91cc\u9762\u518d\u6254\u4e24\u4e2a\u5143\u7d20 $(i,j+1,k,w+a_{j+1}-a_j)$\uff08\u5047\u5982 $j+1<k$\uff09\u4e0e $(i-1,i,j,w+a_i-a_{i-1})$\uff08\u5047\u5982 $i>1$ \u4e14 $i<j$\uff09\uff0c\u5206\u522b\u8868\u793a\u628a $i$ \u540e\u79fb\u4e00\u4f4d\uff0c\u4ee5\u53ca\u628a $i$ \u7684\u4f4d\u7f6e\u56fa\u5b9a\uff0c\u5c1d\u8bd5\u540e\u79fb $i-1$\u3002\n\n\u56e0\u4e3a\u6bcf `pop` \u4e00\u4e2a\u5143\u7d20\u5c31\u4f1a\u518d\u591a\u4e24\u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\u4e00\u5171\u5806\u4e2d\u53ea\u4f1a\u6709 $O(m)$ \u4e2a\u5143\u7d20\uff0c\u590d\u6742\u5ea6 $O(m\\log m)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nstruct dat{\n\tint i,j,k,las;\n\tll w;\n\tdat(){}\n\tdat(int I,int J,int K,ll W,int LAS=0){i=I,j=J,k=K,w=W,las=LAS;}\n\tfriend bool operator<(const dat&u,const dat&v){return u.w>v.w;}\n};\npriority_queue<dat>q;\ndat d[1001000];\nint T,n,m,cnt,r[1001000],p[1001000];ll S,a[1001000],s[1001000];\nvector<pair<int,ll> >v;\nvoid mina(){\n\tscanf(\"%d%lld%d\",&n,&S,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&a[i]),p[i]=i;\n\tsort(p+1,p+n+1,[](int x,int y){return a[x]<a[y];});\n\tfor(int i=1;i<=n;i++)s[i]=s[i-1]+a[p[i]];\n\tint K=n,M;\n\tfor(K=n;K;K--){\n\t\tq.emplace(K,K,n+1,s[K]);\n\t\tM=m;\n\t\twhile(!q.empty()&&m){\n\t\t\tauto x=q.top();q.pop();\n\t\t\tif(x.w>S)break;\n\t\t\tm--,v.emplace_back(K,x.w);\n\t\t\tif(x.j+1<x.k)q.emplace(x.i,x.j+1,x.k,x.w+a[p[x.j+1]]-a[p[x.j]]);\n\t\t\tif(x.i>1&&x.i<x.j)q.emplace(x.i-1,x.i,x.j,x.w+a[p[x.i]]-a[p[x.i-1]]);\n\t\t}\n\t\twhile(!q.empty())q.pop();\n\t\tif(!m)break;\n\t}\n\tif(v.empty()){puts(\"0\");return;}\n\tprintf(\"%d\\n\",v.size());\n\tfor(auto x:v)printf(\"%d %lld\\n\",x.first,x.second);v.clear();\n\tif(!K)K=1;\n\tq.emplace(K,K,n+1,s[K]);\n\twhile(!q.empty()&&M){\n\t\tauto x=q.top();q.pop();\n\t\tif(x.w>S)break;\n\t\td[++cnt]=x,M--;\n\t\tif(x.j+1<x.k)q.emplace(x.i,x.j+1,x.k,x.w+a[p[x.j+1]]-a[p[x.j]],cnt);\n\t\tif(x.i>1&&x.i<x.j)q.emplace(x.i-1,x.i,x.j,x.w+a[p[x.i]]-a[p[x.i-1]],cnt);\n\t}\n\tfor(int i=1;i<d[cnt].i;i++)r[i]=p[i];\n\tfor(int i=d[cnt].i,j=cnt;i<=K;i++){\n\t\twhile(d[j].i!=i)j=d[j].las;\n\t\tr[d[j].i]=p[d[j].j];\n\t}\n\tfor(int i=1;i<=K;i++)printf(\"%d \",r[i]);puts(\"\");\n\tcnt=0,v.clear();\n\twhile(!q.empty())q.pop();\n}\nint main(){\n\tscanf(\"%d\",&T);\n\twhile(T--)mina();\n\treturn 0;\n} \n```",
        "postTime": 1645513559,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1250I\u3010Show Must Go On\u3011"
    }
]