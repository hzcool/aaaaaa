[
    {
        "content": "~~\u5f88\u611f\u8c22\u8fd9\u9053\u82b1\u8d39\u4e86\u6211\u4e00\u6574\u4e2a\u4e0a\u5348\u7684\u9898\u76ee\uff0c\u5f88\u611f\u8c22\u3002~~\n\n\n[CF \u4f20\u9001\u95e8](https://codeforces.com/problemset/problem/1051/G)\n\n\u7ebf\u6bb5\u6811\u5408\u5e76 + \u5e76\u67e5\u96c6\u7ef4\u62a4\u3002\n\n## Update\n\n- 2023.03.15\uff1a\u9898\u610f\u63cf\u8ff0\u7684\u56fe\u70b8\u4e86\uff0c\u4fee\u56fe\u3002\n\n## Description\n\n[\u9898\u610f\u6982\u8ff0\u3002](https://img-blog.csdnimg.cn/53f26fa1e5f145a89bd929d6ba160ba1.png#pic_center)\n\n## Solution\n\n\u4ee5\u4e0b\u4f7f\u7528 $a_i$ \u4ee3\u66ff $A_i$\uff0c$b_i$ \u540c\u7406\u3002\n\n### 1 \u89c2\u5bdf\n\n\u89c2\u5bdf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\uff0c\u5bb9\u6613\u53d1\u73b0\u5982\u679c\u65b0\u52a0\u8fdb\u6765\u4e00\u4e2a\u6570\uff0c\u60f3\u8981\u901a\u8fc7\u64cd\u4f5c\u8fd9\u4e2a\u6570\u4f7f\u5f97\u5e8f\u5217\u4e2d\u6ca1\u6709\u91cd\u590d\u7684\u6570\uff0c\u53ea\u80fd\u662f\u628a\u8fd9\u4e2a\u65b0\u6570\u4e0d\u65ad\u52a0\u4e00\u76f4\u5230\u6ca1\u6709\u6570\u4e0e\u5b83\u76f8\u540c\u3002\u901a\u8fc7\u8fd9\u4e2a\u89c2\u5bdf\uff0c\u53ef\u4ee5\u5f97\u5230\u7ed3\u8bba\uff1a**\u6700\u7ec8 $a_i$ \u6784\u6210\u7684\u96c6\u5408\u662f\u786e\u5b9a\u7684**\u3002\u6ce8\u610f\uff0c\u662f**\u96c6\u5408**\u786e\u5b9a\u3002\n\n\u8fdb\u4e00\u6b65\u89c2\u5bdf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\uff0c\u5c31\u80fd\u53d1\u73b0\uff1a\u5bf9\u4e8e $1\\leq i,\\ j \\leq n$\uff0c\u82e5 $a_i = a_j + 1$\uff0c\u53ef\u4ee5\u901a\u8fc7\u82b1\u8d39 $b_j-b_i$ \u7684\u4ee3\u4ef7\uff0c\u5c06\u4e24\u8005\u4ea4\u6362\u3002\u4ea4\u6362\u6709\u4ec0\u4e48\u597d\u5904\uff1f\u82e5 $b_i < b_j$\uff0c\u5219 $a_i \\times b_i + a_j \\times b_j \\geq a_i \\times b_j + a_j \\times b_i$\u3002\n\n\u540c\u65f6\uff0c\u4e0d\u59a8\u5047\u8bbe\u6700\u540e\u6ee1\u8db3\u6761\u4ef6\u7684\u6574\u4e2a\u64cd\u4f5c\u540e\u5e8f\u5217\u6bcf\u9879\u4e3a $c_i,\\ 1\\leq i \\leq n$\u3002\u90a3\u4e48\u603b\u5171\u6240\u9700\u4ee3\u4ef7\u5373\u4e3a $\\sum_{i=1}^n (c_i-a_i) \\times b_i$\u3002\u4e3a\u4ec0\u4e48\uff1f\u56e0\u4e3a\u82e5 $a_i$ \u52a0\u4e86 $1$\uff0c\u4ee3\u8868\u82b1\u8d39\u589e\u52a0\u4e86 $b_i$\uff1b\u82e5 $a_i$ \u51cf\u53bb $1$\uff0c\u4ee3\u8868\u82b1\u8d39\u51cf\u5c11\u4e86 $b_i$\u3002\u90a3\u4e48\u6700\u540e $a_i$ \u603b\u5171\u589e\u52a0\u4e86 $(c_i-a_i)$\uff0c\u4f46\u662f\u5185\u90e8\u8fc7\u7a0b\u662f\u5982\u4f55\u7684\u6211\u4eec\u5b9e\u9645\u4e0a\u5e76\u4e0d\u4f1a\u5173\u6ce8\uff0c\u56e0\u4e3a\u9664\u4e86 $(c_i-a_i) \\times b_i$ \u4e4b\u5916 $a_i$ \u5e26\u6765\u7684\u82b1\u8d39\u5df2\u7ecf\u62b5\u6d88\u6389\u4e86\u3002\u6545\u6700\u7ec8\u7684\u82b1\u8d39\u603b\u5171\u4e3a $\\sum_{i=1}^n (c_i-a_i) \\times b_i$\u3002\u8fdb\u4e00\u6b65\u62c6\u5206\uff0c\u5f97\u603b\u4ee3\u4ef7\u4e3a $\\sum_{i=1}^n c_i \\times b_i - \\sum_{i=1}^na_i \\times b_i$\uff0c\u800c\u5f0f\u5b50\u4e2d\u7684\u7b2c\u4e8c\u9879\u5df2\u7ecf\u786e\u5b9a\uff0c\u6240\u4ee5\u6211\u4eec\u60f3\u8981 $c_i\\times b_i$ \u7684\u603b\u548c\u5c3d\u53ef\u80fd\u5c0f\u3002\n\n\u7efc\u4e0a\u4e24\u6bb5\u5206\u6790\uff0c\u6211\u4eec\u660e\u767d\uff1a\u6211\u4eec\u9700\u8981\u505a\u7684\u662f\u901a\u8fc7\u4ea4\u6362 $a$ \u4e2d\u5143\u7d20\u7684\u4f4d\u7f6e\uff0c\u5373\u91cd\u65b0\u6392\u5e8f\u4f7f\u5f97\u7b54\u6848\u6700\u5c0f\u3002\n\n\u56e0\u4e3a\u4ea4\u6362 $a_i$ \u548c $a_j$ \u7684\u524d\u63d0\u6761\u4ef6\u662f $a_i=a_j+1$\uff0c\u6545\u6211\u4eec\u53ea\u80fd\u5728\u2f00\u4e2a $a_i$ \u7684\u8fde\u7eed\u6bb5\u5185\u4efb\u610f\u8c03\u6574\u987a\u5e8f\u3002\u4e3a\u4e86\u4e0d\u7834\u574f\u8fde\u7eed\u6bb5\u7684\u5355\u8c03\u9012\u589e\u6027\uff0c\u6211\u4eec\u5c06\u8c03\u6362 $a_i$ \u7684\u987a\u5e8f\u8f6c\u5316\u4e3a\u8c03\u6362 $b_i$ \u7684\u987a\u5e8f\uff0c\u8fd9\u5e76\u4e0d\u5f71\u54cd\u7ed3\u679c\u3002\u518d\u7ed3\u5408\u4ea4\u6362\u4e24\u9879\u5e26\u6765\u7684\u4f18\u52bf\uff0c\u4e0d\u96be\u5f97\u51fa\uff1a\u6211\u4eec\u8981\u5728\u4e00\u4e2a $a$ \u7684\u8fde\u7eed\u6bb5\u5185\u5c06\u5176\u76f8\u5bf9\u5e94\u7684 $b$ \u4e2d\u7684\u9879\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u7136\u540e\u4e0e $a$ \u4e2d\u7684\u9879\u4e00\u4e00\u5bf9\u5e94\uff0c\u4ece\u800c\u8fbe\u5230 $\\sum_{i=1}^n c_i\\times b_i$ \u5c3d\u53ef\u80fd\u5c0f\u7684\u76ee\u7684\u3002\n\n### 2 \u6c42\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u82b1\u8d39\n\n\u4e3a\u4e86\u7ef4\u62a4\u8fde\u7eed\u6bb5\u5e76\u4e14\u652f\u6301\u5408\u5e76\uff08\u52a0\u5165\u65b0\u7684\u6570\uff09\uff0c\u6211\u4eec\u8003\u8651\u7ebf\u6bb5\u6811\u5408\u5e76\u3002$rt_i$ \u8868\u793a\u6bb5\u5185\u6700\u5c0f\u7684\u6570\u4e3a $i$ \u7684\u8fde\u7eed\u6bb5\uff08\u6b64\u65f6\u5df2\u4fdd\u8bc1 $a_i$ \u4e24\u4e24\u4e92\u4e0d\u76f8\u540c\uff09\u76f8\u5bf9\u5e94\u7684\u4e00\u68f5\u6743\u503c\u7ebf\u6bb5\u6811\u3002\u7ebf\u6bb5\u6811\u5185\u90e8\u4ee5 $b_i$ \u4e3a\u4e0b\u6807\u3002\n\n\u663e\u7136\uff0c\u5728 $rt_i$ \u8fd9\u68f5\u6743\u503c\u7ebf\u6bb5\u6811\u5185\uff0c\u6bcf\u4e2a $b_i$ \u4ece\u5c0f\u5230\u5927\u6392\u597d\u4e86\u5e8f\u3002\u800c\u6211\u4eec\u8981\u6c42\u7684\uff0c\u5c31\u662f\u8fd9\u4e9b $b_i$ \u4ece\u5927\u5230\u5c0f \u5206\u522b\u4e58\u4e0a \u5bf9\u5e94\u6700\u5c0f\u503c\u4e3a $i$ \u7684\u4ece\u5c0f\u5230\u5927\u7684\u8fde\u7eed\u6bb5\u7684\u6bcf\u4e00\u9879\u3002\u6211\u4eec\u53ef\u4ee5\u660e\u786e\u4e00\u70b9\uff1a\u6bcf\u4e2a $b_i$ \u90fd\u4f1a\u81f3\u5c11\u4e58\u4e0a $i$\uff0c\u6545\u53ef\u4ee5\u76f4\u63a5\u5c06 $t_{rt_i}.sum \\times i$ \u7edf\u8ba1\u8fdb $ans$\uff0c\u4e4b\u540e\u52a0\u5165\u6bcf\u4e2a $b_i$\uff08$b_i$ \u4ece\u5c0f\u5230\u5927\u5347\u5e8f\u6392\u5217\uff09\u4e58\u4e0a $a$ \u4e2d\u7b2c $t_{rt_i}.size - i + 1$ \u9879\u7684\u4e24\u8005\u4e4b\u79ef\u3002\n\n\u90a3\u600e\u4e48\u5feb\u901f\u6c42\u5f97\u8fd9\u4e9b\u4e58\u79ef\u7684\u548c\u5462\uff1f\u5176\u5b9e\u53ea\u9700\u8981\u5728\u9012\u5f52\u7ebf\u6bb5\u6811\u7684\u65f6\u5019\uff0c\u6bcf\u4e00\u5c42\u90fd\u7ed9 $ans$ \u52a0\u4e0a $t_{ls}.sum \\times t_{rs}.siz$ \u5373\u53ef\u3002\u53ef\u4ee5\u611f\u6027\u7406\u89e3\u4e3a\u6bcf\u4e00\u5c42\u90fd\u5c06 $[l,mid]$ \u548c $[mid+1,r]$ \u8fd9\u4e24\u4e2a\u533a\u95f4\u8c03\u6362\u4e86\u4f4d\u7f6e\uff0c\u90a3\u6700\u540e\u6574\u4e2a $b$ \u5e8f\u5217\u80af\u5b9a\u88ab\u6392\u4e3a\u4ece\u5927\u5230\u5c0f\u7684\u964d\u5e8f\u6392\u5217\u3002\u800c\u4e0a\u9762\u7684 $t_{ls}.sum \\times t_{rs}.siz$ \u5c31\u662f\u5c06\u533a\u95f4 $[l,mid]$ \u79fb\u4f4d\u5230\u4e86\u533a\u95f4 $[mid+1,r]$ \u4e4b\u540e\u6240\u591a\u51fa\u7684\u82b1\u8d39\u3002\n\n### 3 \u7edf\u8ba1\u52a0\u6570\u540e\u7b54\u6848\n\n\u77e5\u9053\u5982\u4f55\u7edf\u8ba1\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u7684\u8d21\u732e\u4e4b\u540e\uff0c\u5206\u6790\u4e00\u4e0b\u6bcf\u6b21\u65b0\u52a0\u5165\u4e00\u4e2a\u6570\u4e4b\u540e\u5982\u4f55\u91cd\u65b0\u7edf\u8ba1\u7b54\u6848\u3002\u6d41\u7a0b\u5982\u4e0b\uff1a\n\n1. \u627e\u5230\u8f93\u5165\u7684\u8fd9\u4e2a\u6570 $a_i$ \u6240\u5728\u7684\u8fde\u7eed\u6bb5\u4e2d\uff0c\u6700\u5927\u7684\u6570\u662f\u591a\u5c11\u3002\u800c $a_i$\uff0c\u5c31\u8981\u8d4b\u503c\u4e3a\u8fd9\u4e2a\u6700\u5927\u503c\u52a0\u4e00\u7684\u6570\uff0c\u8bb0\u4e3a $y$\u3002\n2. \u7edf\u8ba1\u5c06 $a_i$ \u53d8\u4e3a $y$ \u6240\u9700\u7684\u4ee3\u4ef7\uff0c\u52a0\u8fdb $ans$\u3002\u6b64\u4ee3\u4ef7\u5373\u4e3a $(y-a_i)\\times b_i$\u3002\n3. $y$ \u6682\u65f6\u72ec\u7acb\u6210\u4e3a\u4e00\u4e2a\u8fde\u7eed\u6bb5\uff0c\u5c06 $b_i$ \u8bb0\u5165 $t_{rt_{y}}$ \u4e2d\u3002\n4. \u5c06 $rt_y$ \u4e0e\u5de6\u53f3\u76f8\u90bb\u7684\u6bb5\u7684\u6743\u503c\u7ebf\u6bb5\u6811\u5408\u5e76\uff08\u524d\u63d0\u662f\u8981\u5408\u5e76\u6bb5\u4e0d\u4e3a\u7a7a\uff09\uff0c\u5de6\u53f3\u76f8\u90bb\u7684\u8fde\u7eed\u6bb5\u5373\u4e3a $rt_{y-1}$ \u548c $rt_{y+1}$\u3002\n5. \u5408\u5e76\u65f6\u5df2\u7ecf\u91cd\u65b0\u7edf\u8ba1\u8fc7\u65b0\u7684\u8fde\u7eed\u6bb5\u7684\u4ee3\u4ef7\uff0c\u6545\u6b64\u65f6\u76f4\u63a5\u8f93\u51fa\u7b54\u6848\u5373\u53ef\u3002\n\n\u5e76\u67e5\u96c6\u7ef4\u62a4\u4ec0\u4e48\uff1f\u5f53\u7136\u5c31\u662f\u7b2c\u4e00\u6b65\u4e2d\u6bcf\u4e2a\u6570\u6240\u5728\u7684\u8fde\u7eed\u6bb5\u7684\u6700\u5c0f\u503c\uff08\u5373\u5de6\u7aef\u70b9\uff09\uff0c\u540c\u65f6\u518d\u5f00\u4e00\u4e2a\u6570\u7ec4\u7ef4\u62a4\u76f8\u5e94\u53f3\u7aef\u70b9\u5373\u53ef\u3002\n\n\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u91cd\u590d\uff0c\u6bcf\u4e2a $a_i$ \u90fd\u8981\u52a0 $1$ \u52a0\u5230\u4e0d\u4e0e\u4e4b\u524d\u6570\u91cd\u590d\uff0c\u6240\u4ee5\u6781\u7aef\u60c5\u51b5\u4e0b $a_i$ \u53ef\u80fd\u52a0\u5230 $2 \\times 2e5$\uff0c\u6545\u6570\u7ec4\u8981\u5f00\u4e24\u500d\u3002\n\n\u81f3\u6b64\uff0c\u8be5\u9898\u5df2\u5f7b\u5e95\u89e3\u51b3\uff0c\u65f6\u590d $O(n \\log n)$\u3002\n\n## Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define ll long long \n#define rep(i, a, b) for(register int i = a; i <= b; ++i)\nconst int maxn = 4e5 + 10, maxm = maxn * 30;\nint n, rt[maxn], fa[maxn], bl[maxn];\nll ans;\n\ninline int fnd(int x){\n\treturn x == fa[x] ? x : fa[x] = fnd(fa[x]);\n}\n\nstruct segment_tree{\n\t#define L(x) ch[0][x]\n\t#define R(x) ch[1][x]\n\t#define ls L(x)\n\t#define rs R(x)\n\t#define sz(x) t[x].siz\n\t#define sm(x) t[x].sum\n\tstruct tree{\n\t\tint siz; ll sum;\n\t}t[maxm]; int tot, ch[2][maxm];\n\tinline void up(int x){\n\t\tsm(x) = sm(ls) + sm(rs), sz(x) = sz(ls) + sz(rs);\n\t}\n\tinline void updt(int &x, int l, int r, int p){\n\t\tif(!x) x = ++tot;\n\t\tif(l == r){\n\t\t\tsz(x) = 1, sm(x) = p; return;\n\t\t} int mid = l + r >> 1;\n\t\tp <= mid ? updt(ls, l, mid, p) : updt(rs, mid + 1, r, p);\n\t\tup(x);\n\t}\n\tinline int merge(int a, int b, int l, int r){\n\t\tif(!a or !b) return a + b;\n\t\tint x = ++tot; if(l == r) return x;\n\t\tans -= sm(L(a)) * sz(R(a)) + sm(L(b)) * sz(R(b));\n\t\tint mid = l + r >> 1;\n\t\tls = merge(L(a), L(b), l, mid), rs = merge(R(a), R(b), mid + 1, r);\n\t\tans += sm(ls) * sz(rs), up(x); return x;\n\t}\n\tinline void link(int a, int b){\n\t\ta = fnd(a), b = fnd(b), fa[b] = a;\n\t\tans -= sm(rt[a]) * a + sm(rt[b]) * b;\n\t\trt[a] = merge(rt[a], rt[b], 1, n);\n\t\tans += sm(rt[a]) * a, bl[a] = bl[b];\n\t}\n}T;\n\nint main(){ rep(i, 1, maxn - 5) fa[i] = bl[i] = i;\n\tscanf(\"%d\", &n); \n\trep(i, 1, n){ int x, y, v;\n\t\tscanf(\"%d%d\", &x, &v);\n\t\ty = rt[x] ? bl[fnd(x)] + 1 : x;\n\t\tans += 1ll * (y - x) * v;\n\t\tT.updt(rt[y], 1, n, v);\n\t\tif(rt[y - 1]) T.link(y - 1, y); if(rt[y + 1]) T.link(y, y + 1);\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n```\n\n\n------------\n\u611f\u8c22\u9605\u8bfb\u3002",
        "postTime": 1659413030,
        "uid": 469672,
        "name": "\u4f0d\u53c1\u58f9",
        "ccfLevel": 7,
        "title": "\u3010CF1051G\u3011 Distinctification \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\uff1a\n\n\u7ed9\u4e86 $n$ \u4e2a\u6570\u5bf9 $(A,B)$\u3002\n\u4f60\u53ef\u4ee5\u82e5\u5e72\u6b21\u64cd\u4f5c\u3002\n\n$1. A_i = A_i + 1, cost\\ B_i [A_i = A_j, i != j]$\u3002\n\n$2.A_i = A_i - 1, cost\\ -B_i [A_i = A_j + 1, i != j]$\u3002\n\n## solution:\n\n\u5982\u679c $A_i$ \u4e92\u4e0d\u76f8\u540c\uff0c\u5b58\u5728 $A_i = A_j + 1$,\u90a3\u4e48\u663e\u800c\u6613\u89c1\u53ef\u4ee5\u4ea4\u6362\u4e24\u4e2a\u6570\uff0c\u4ee3\u4ef7\u662f $B_i - B_j$\u3002\n\n\u6240\u4ee5\u6700\u540e\u5e8f\u5217\u4f1a\u88ab\u5206\u6210 $A_i$ \u7684\u82e5\u5e72\u6bb5\uff0c\u4e14\u6bcf\u6bb5 $B$ \u9012\u51cf\u3002\n\n\u5982\u679c $A_i$ \u6709\u53ef\u80fd\u76f8\u540c\uff0c\u90a3\u4e48\u6211\u4eec\u627e\u4e00\u4e2a\u6700\u8fd1\u7684\uff0c\u4f7f\u5f97\u4e92\u4e0d\u76f8\u540c\uff0c\u8fd9\u4e2a\u53f3\u7aef\u70b9\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\uff0c\u518d\u540c\u6837\u64cd\u4f5c\u3002\n\n\u8bbe $A_i$ \u53d8\u6210\u4e86 $A_i'$\uff0c\u90a3\u4e48\u6211\u4eec\u53d1\u73b0 $A_i$ \u7684\u8d21\u732e\u5176\u5b9e\u662f $(A_i'-A_i) \\times B_i$\uff0c\u7136\u540e\u6211\u4eec\u7ef4\u62a4\u6240\u6709\u6570\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f $\\sum_i (A_i' - A_i) \\times B_i$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u4ee5 $B_i$ \u4f5c\u4e3a\u4e0b\u6807\u505a\u7ebf\u6bb5\u6811\u3002\n\n\u6700\u540e $B_i$ \u4e00\u5b9a\u662f\u9012\u51cf\u7684\uff0c\u90a3\u4e48\u8d21\u732e\u662f\u5de6\u533a\u95f4\u7684 $B_i$ \u4e58\u4e0a\u53f3\u533a\u95f4\u7684\u4e2a\u6570\u3002\n\n\u7136\u540e\u52a0\u5165\u4e00\u4e2a $A_i$ \u65f6\uff0c\u5148\u51cf\u6389\u539f\u6765\u7684\u8d21\u732e\uff0c\u5408\u5e76\u4e4b\u540e\u518d\u7b97\u4e00\u4e0b\u8d21\u732e\uff0c\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n",
        "postTime": 1601097432,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1051G \u3010Distinctification\u3011"
    },
    {
        "content": "vp \u8fd9\u573a CF \u4e4b\u540e\u5199\u4e86\u7bc7\u603b\u7ed3\u535a\u5ba2\uff0c\u558a\u5e06\u5de8@[zhiyangfan](/user/137603) \u9a8c\u4e86\u4e00\u904d\uff0c\u5e06\u5de8\u9510\u8bc4\u8fd9\u9053 G \u662f\u5389\u5bb3\u9898\uff0c\u4e8e\u662f\u6211\u51b3\u5b9a\u63d0\u51fa\u6765\u5b83\u7ec6\u5316\u51fa\u7bc7\u9898\u89e3\u3002\n\n>[G. Distinctification](https://codeforces.com/contest/1051/problem/G)\n>\n> \u5bf9\u4e8e\u542b $k$ \u4e2a\u6570\u5bf9 $(a_i,b_i)$ \u7684\u5e8f\u5217 $S$\uff0c\u53ef\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a\n>\n>- \u4efb\u9009\u4e00\u4e2a $i$\uff0c\u5f53 $\\exists j\\ne i,a_i=a_j$ \u65f6\uff0c\u53ef\u4ee4 $a_i\\gets a_i+1$\uff0c\u82b1\u8d39\u4e3a $b_i$\uff1b\n>\n>- \u4efb\u9009\u4e00\u4e2a $i$\uff0c\u5f53 $\\exists j,a_i=a_j+1$ \u65f6\uff0c\u53ef\u4ee4 $a_i\\gets a_i-1$\uff0c\u82b1\u8d39\u4e3a $-b_i$\u3002\n>\n> \u5b9a\u4e49 $f(S)$ \u4e3a\u8fdb\u884c\u64cd\u4f5c\u4f7f\u5f97 $S$ \u4e2d $a_i$ \u4e24\u4e24\u4e0d\u540c\u7684\u6700\u5c0f\u82b1\u8d39\u3002\n>\n> \u7ed9\u51fa\u542b $n$ \u4e2a\u6570\u5bf9 $(a_i,b_i)$ \u7684\u5e8f\u5217 $P$\uff0c\u4fdd\u8bc1 $b_i$ \u4e24\u4e24\u4e0d\u540c\uff0c\u5bf9 $i\\in[1,n]$\uff0c\u6c42 $f(P_{[1,i]})$\u3002\n>\n>$1\\le b_i\\le n\\le2\\cdot10^5,1\\le a_i\\le2\\cdot10^5$\n\n\u9996\u5148\u8003\u8651\u5982\u9898\u610f\u7684\u64cd\u4f5c\u6240\u5e26\u6765\u7684\u6027\u8d28\u3002\n\n- \u5bb9\u6613\u53d1\u73b0\u6240\u7ed9\u7684\u4e24\u9879\u64cd\u4f5c\u662f\u4e92\u9006\u7684\uff0c\u5373\u82e5\u5728\u67d0\u4f4d\u7f6e\u8fdb\u884c\u4e86\u4e00\u9879\u64cd\u4f5c\uff0c\u7acb\u523b\u5bf9\u8be5\u4f4d\u7f6e\u8fdb\u884c\u53e6\u4e00\u9879\u64cd\u4f5c\u662f\u53ef\u884c\u7684\uff0c\u4e14\u64cd\u4f5c\u540e\u7684\u5e8f\u5217\u548c\u82b1\u8d39\u4e0e\u4e24\u6b21\u64cd\u4f5c\u524d\u5b8c\u5168\u76f8\u540c\u3002\n\n- \u5f53 $\\exists i,j,a_i=a_j$ \u65f6\uff0c\u7531\u4e8e\u9898\u610f\u9650\u5236\uff0c\u5fc5\u987b\u4f7f\u7528\u64cd\u4f5c\u4e00\uff0c\u76f4\u81f3 $a_i$ \u4e24\u4e24\u4e0d\u540c\u3002\n\n- \u5f53 $\\exists i,j,a_i=a_j+1$ \u65f6\uff0c\u53ef\u4ee5\u5bf9 $i$ \u4f7f\u7528\u4e00\u6b21\u64cd\u4f5c\u4e8c\u3001\u5bf9 $j$ \u4f7f\u7528\u4e00\u6b21\u64cd\u4f5c\u4e00\uff0c\u4ee5 $b_j-b_i$ \u7684\u82b1\u8d39\u4ea4\u6362 $a_i,a_j$\uff0c\u4e5f\u5373\u76f8\u5f53\u4e8e\u4ea4\u6362 $b_i,b_j$\u3002\u6240\u4ee5\u82e5\u6b64\u65f6\u6709 $b_j<b_i$\uff0c\u6211\u4eec\u4e00\u5b9a\u4f1a\u5982\u6b64\u64cd\u4f5c\u4f7f\u5f97\u82b1\u8d39\u964d\u4f4e\uff0c\u4e8e\u662f**\u5728 $a_i$ \u8fde\u7eed\u7684\u524d\u63d0\u4e0b\uff0c\u6700\u7ec8 $a_i$ \u5927\u7684\u4f4d\u7f6e\u5bf9\u5e94\u7684 $b_i$ \u4e00\u5b9a\u5c0f\u3002**\n\n\u7531\u4ee5\u4e0a\u4e09\u70b9\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff0c\u4efb\u4e00\u7b26\u5408\u9898\u610f\u7684\u5e8f\u5217 $S$\uff0c\u5b83\u7684\u82b1\u8d39\u5728\u53d6\u5230 $f(S)$ \u65f6\u4e00\u5b9a\u6709 $a_i$ \u4e24\u4e24\u4e0d\u540c\uff0c\u4e14\u5728\u4ee5 $a_i$ \u4e3a\u5173\u952e\u5b57\u5f62\u6210\u7684\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u4e2d $b_i$ \u9012\u51cf\u3002\n\n\u56de\u5230\u9898\u76ee\u6240\u6c42\u7684\u95ee\u9898\u4e0a\uff0c\u6211\u4eec\u53d1\u73b0\u95ee\u9898\u53ef\u4ee5\u770b\u4f5c\u5411\u5e8f\u5217 $P$ \u4e2d\u9010\u4e00\u6dfb\u52a0\u5143\u7d20\u5e76\u52a8\u6001\u6c42\u89e3 $f(P)$\u3002\u7531\u4e8e\u64cd\u4f5c\u53ef\u9006\uff0c\u6211\u4eec\u76f4\u63a5\u5728\u5f53\u524d\u6700\u4f18\u89e3\u7684\u5e8f\u5217\u548c\u82b1\u8d39\u4e0a\u6dfb\u52a0\u65b0\u5143\u7d20\uff0c\u4e0e\u9898\u610f\u662f\u7b49\u4ef7\u7684\u3002\n\n\u82e5\u65b0\u5143\u7d20\u7684 $a_i$ \u5728\u5e8f\u5217\u4e2d\u51fa\u73b0\u8fc7\uff0c\u5219\u9700\u8981\u8fde\u7eed\u4f7f\u7528\u64cd\u4f5c\u4e00\uff0c\u76f4\u81f3 $a_i$ \u672a\u51fa\u73b0\u8fc7\u3002\u6b64\u65f6\u65b0\u5143\u7d20\u7684 $a_i$ \u4e3a\u539f\u6765\u51fa\u73b0\u8fc7\u7684 $a_i$ \u6240\u5728\u8fde\u7eed\u6bb5\u4e2d\u7684 $\\max a_i+1$\u3002**\u7ecf\u8fc7\u8fd9\u6b65\u64cd\u4f5c\u540e\uff0c$a_i$ \u6700\u5927\u53ef\u80fd\u8fbe\u5230 $n+V-1$\uff0c\u6240\u4ee5\u76f8\u5e94\u7684\u6570\u7ec4\u5927\u5c0f\u9700\u5f00\u4e24\u500d\u3002**\n\n\u6b64\u65f6\u65b0\u5143\u7d20\u4e0e\u539f\u5e8f\u5217\u4e2d\u7684 $a_i$ \u90fd\u4e0d\u76f8\u540c\u3002\u539f\u5e8f\u5217\u5df2\u7ecf\u53d6\u5f97\u6700\u4f18\u4ee3\u4ef7\uff0c\u6240\u4ee5\u4e00\u5b9a\u7531\u82e5\u5e72\u6ee1\u8db3 $b_i$ \u9012\u51cf\u7684\u8fde\u7eed\u6bb5\u7ec4\u6210\uff0c\u800c\u65b0\u5143\u7d20\u663e\u7136\u4e5f\u53ef\u4ee5\u89c6\u4f5c\u4e00\u4e2a\u8fd9\u6837\u7684\u957f\u5ea6\u4e3a $1$ \u7684\u8fde\u7eed\u6bb5\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8003\u8651\u5c06\u4e24\u4e2a\u76f8\u63a5\u7684\u8fde\u7eed\u6bb5\u5408\u5e76\u4e3a\u4e00\u4e2a\u66f4\u5927\u7684\u8fde\u7eed\u6bb5\u6240\u4ea7\u751f\u7684\u82b1\u8d39\u5373\u53ef\u3002\n\n\u8bbe $x,y$ \u4e3a\u4e24\u4e2a\u76f8\u63a5\u7684\u8fde\u7eed\u6bb5\uff0c\u4e5f\u5373 $\\max\\limits_{x}a_i+1=\\min\\limits_{y}a_i$\u3002\u8bb0 $calc(op,num)$ \u4e3a\u8fde\u7eed\u6bb5 $op$ \u4e2d\u6ee1\u8db3 $b_i>num$ \u7684\u5143\u7d20\u6570\u91cf\u3002\n\n\u9996\u5148\u5bf9 $y$ \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8fdb\u884c $|x|$ \u6b21\u64cd\u4f5c\u4e8c\uff0c\u4f7f\u5f97 $x,y$ \u7684\u5de6\u7aef\u70b9\u5bf9\u9f50\uff0c\u5e76\u8bb0\u5de6\u7aef\u70b9\u7684\u4e0b\u6807\u4e3a $0$\u3002\n\n\u8003\u8651 $x$ \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u5b83\u5728\u5408\u5e76\u540e\u7684\u8fde\u7eed\u6bb5\u4e2d\u4f4d\u7f6e\u663e\u7136\u5e94\u4e3a $calc(x,b_i)+calc(y,b_i)$\uff0c\u800c\u5b83\u5f53\u524d\u7684\u4f4d\u7f6e\u662f $calc(x,b_i)$\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u5e94\u8fdb\u884c $calc(y,b_i)$ \u6b21\u64cd\u4f5c\u4e00\uff0c\u4e5f\u5373 **$y$ \u4e2d\u6bcf\u4e2a $b$ \u503c\u8d85\u8fc7 $b_i$ \u7684\u5143\u7d20\u90fd\u4f1a\u5bf9\u82b1\u8d39\u4ea7\u751f $b_i$ \u7684\u8d21\u732e\u3002**$y$ \u4e2d\u7684\u5143\u7d20\u540c\u7406\u3002\u4e5f\u53ef\u4ee5\u611f\u6027\u7406\u89e3\u4e3a\u6bcf\u4e2a\u5143\u7d20\u90fd\u9700\u8981\u7528\u64cd\u4f5c\u4e00\u6765\u201c\u8d8a\u8fc7\u201d$b$ \u503c\u8d85\u8fc7\u5b83\u7684\u5143\u7d20\u3002\n\n\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u4e2d $a_i$ \u7684\u6700\u5927\u503c\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6700\u5927\u503c\u4e3a $a_i$ \u7684\u8fde\u7eed\u6bb5\u7684\u4fe1\u606f\uff0c\u5728\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u8282\u70b9\u4e0a\u8bb0\u5f55 $b_i$ \u5728\u5bf9\u5e94\u533a\u95f4\u5185\u7684\u5143\u7d20\u6570\u91cf\u53ca\u5b83\u4eec\u7684 $b_i$ \u7684\u548c\uff0c\u7ebf\u6bb5\u6811\u5408\u5e76\u5373\u53ef\u5b9e\u73b0\u4e0a\u9762\u7684\u5206\u6790\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002~~\u5e72\u5230\u4e86 CF \u8fd0\u884c\u65f6\u95f4 rk9~~\n\n```cpp\n#include<cstdio>\n#include<numeric>\nusing namespace std;\nconst int N=4e5+2;\nint n,cnt,fa[N],rt[N];long long ans;\nstruct node{\n    int l,r,siz;long long sum;\n}t[N*10];\nint getfa(int x){\n    return x==fa[x]?x:fa[x]=getfa(fa[x]);\n}\nvoid add(int &x,int l,int r,int k){\n    x=++cnt;\n    t[x].siz=1,t[x].sum=k;\n    if(l==r) return;\n    int mid=(l+r)>>1;\n    k>mid?add(t[x].r,mid+1,r,k):\n        add(t[x].l,l,mid,k);\n}\nvoid merge(int &x,int y,int l,int r){\n    if(!y) return;\n    if(!x){x=y;return;}\n    ans+=t[t[x].l].sum*t[t[y].r].siz\n        +t[t[y].l].sum*t[t[x].r].siz;\n    int mid=(l+r)>>1;\n    merge(t[x].l,t[y].l,l,mid);\n    merge(t[x].r,t[y].r,mid+1,r);\n    t[x].siz+=t[y].siz,t[x].sum+=t[y].sum;\n}\nvoid work(int x,int y){\n    fa[x]=y;\n    ans-=t[rt[y]].sum*t[rt[x]].siz;\n    merge(rt[y],rt[x],1,n);\n}\nint main(){\n    iota(fa,fa+N,0);\n    scanf(\"%d\",&n);\n    for(int i=1,x,k;i<=n;++i){\n        scanf(\"%d%d\",&x,&k);\n        if(rt[x]){\n            ans+=(getfa(x)+1ll-x)*k;\n            x=getfa(x)+1;\n        }\n        add(rt[x],1,n,k);\n        if(rt[x-1]) work(x-1,x);\n        if(rt[x+1]) work(x,getfa(x+1));\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1666667700,
        "uid": 128570,
        "name": "StarLbright40",
        "ccfLevel": 9,
        "title": "CF1051G (Edu Round 51) \u9898\u89e3"
    },
    {
        "content": "\u8003\u573a\u4e0a\u770b\u5230\u8fd9\u9053\u9898\uff1a\u54c7\uff01\u8fd9\u4e2a\u64cd\u4f5c\u597d\u795e\u5947\uff01\u54c7\uff01\u6837\u4f8b\u8fd9\u4e2a\u64cd\u4f5c\u65b9\u6848\u592a\u5999\u4e86\uff01\u5367\u69fd\uff1f\u4e3a\u4ec0\u4e48\u603b\u8d39\u7528\u8fd8\u80fd\u662f\u8d1f\u6570\uff1f\uff08\u82b130min\u6a21\u62df\u6837\u4f8b\uff09\u4ec0\u4e48\u9634\u95f4\u64cd\u4f5c\uff0c\u6beb\u65e0\u89c4\u5f8b\u53ef\u5faa\uff0c\u8dd1\u8def\u8dd1\u8def\u3002\u2026\u2026\n\n\u7b14\u8005\u8d5b\u573a\u4e0a\u7684\u601d\u7ef4\u80fd\u529b\u4ec5\u9650\u4e8e\u6b64\u3002\u8a00\u5f52\u6b63\u4f20\uff0c\u63d0\u5347\u89c2\u5bdf\u7684\u9ad8\u5ea6\uff0c\u53d1\u73b0\u6bcf\u4e2a $a_i$ \u64cd\u4f5c\u524d\u6216\u64cd\u4f5c\u540e\u603b\u6709\u4e00\u4e2a $a_j$ \u4e0e\u4e4b\u76f8\u90bb\uff0c\u4e8e\u662f\u5f80 $a$ \u503c\u57df\u4e0a\u7684\u8fde\u7eed\u6bb5\u4e0a\u53bb\u60f3\u3002\u8bbe\u521d\u59cb\u7684 $a$ \u5e8f\u5217\u4e3a $p$\uff0c\u4e0b\u6587\u7684 $a$ \u5747\u6307\u82e5\u5e72\u6b21\u64cd\u4f5c\u540e\u5f97\u5230\u7684 $a$\u3002\u8df3\u51fa\u51fa\u9898\u4eba\u6316\u7684\u601d\u7ef4\u9677\u9631\uff0c\u4ece\u7ed3\u679c\u51fa\u53d1\uff0c\u5148\u4e0a\u4e24\u4e2a\u5f88\u91cd\u8981\u7684 Lemma\uff1a\n\n> 1.\u6bcf\u52a0\u5165\u4e00\u4e2a $p_i$ \u540e\u7ecf\u64cd\u4f5c\u5f97\u5230\u7684\u6ee1\u8db3\u8981\u6c42\uff08\u4e24\u4e24\u4e0d\u540c\uff09\u7684 $a_1,\\cdots,a_{i}$ \u7ec4\u6210\u7684\u96c6\u5408\u662f\u786e\u5b9a\u7684\uff0c\u4e0d\u786e\u5b9a\u6027\u4ec5\u5728\u4e8e\u5982\u4f55\u5206\u914d\u8fd9\u4e2a\u96c6\u5408\u4e2d\u7684 $i$ \u4e2a\u6570\u5230 $1,\\cdots,i$ \u4e2d\u53bb\uff1b\n\n> 2.\u7b54\u6848\u4e0e\u64cd\u4f5c\u8fc7\u7a0b\u65e0\u5173\u800c\u4ec5\u4e0e\u6700\u7ec8\u7684\u5e8f\u5217 $a$ \u6709\u5173\uff0c\u5bf9\u4e8e\u4e00\u79cd $a$ \u6211\u4eec\u7684\u7b54\u6848\u4e3a $\\sum_{j=1}^i (a_j-p_j)\\times b_j=\\sum_{j=1}^ia_jb_j-\\sum_{j=1}^i p_jb_j$\u3002\n\n\u7b2c\u4e8c\u4e2a\u8f83\u4e3a\u6d45\u663e\uff0c\u4e00\u6b21\u8ba9 $a_j\\gets a_j+1$ \u7684\u64cd\u4f5c\u82b1\u8d39\u4e3a $b_j$\uff0c\u8ba9 $a_j\\gets a_j-1$ \u7684\u64cd\u4f5c\u82b1\u8d39\u4e3a $-b_j$\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u4e2a $j$\uff0c\u4ece $p_j$ \u8f6c\u79fb\u5230 $a_j$ \u7684\u8d39\u7528\u4fbf\u4e00\u5b9a\u662f $(a_j-p_j)\\times b_j$\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\uff0c\u6570\u5b66\u5f52\u7eb3\u3002$i=1$ \u65f6\u663e\u7136\uff1b\u82e5 $a_1,\\cdots,a_{i-1}(i>1)$ \u7ec4\u6210\u7684\u96c6\u5408\u786e\u5b9a\uff0c\u8bbe\u5176\u4e3a $S_{i-1}$\uff0c\u5c06\u5176\u6392\u5e8f\u540e\u5f62\u6210\u7684\u8fde\u7eed\u6bb5\u4e3a $[l_1,r_1],\\cdots,[l_s,r_s](r_k<l_{k+1}-1)$\uff0c\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n- $\\not\\exists k,p_i\\in[l_k-1,r_k+1]$\uff0c\u90a3\u4e48\u4efb\u4f55 $j<i$ \u90fd\u4e0d\u53ef\u80fd\u548c $i$ \u53d1\u751f\u64cd\u4f5c\uff0c$a_i$ \u52a8\u5f39\u4e0d\u5f97\u53ea\u80fd\u6210\u4e3a $p_i$\uff0c\u96c6\u5408\u4ecd\u7136\u786e\u5b9a\uff1b\n\n- \u5426\u5219\uff0c\u65b9\u4fbf\u8d77\u89c1\u8bbe $l_0=r_0=-\\infty,l_{s+1}=r_{s+1}=\\infty$\uff0c\u627e\u5230 $\\min\\{k:l_k>p_i\\}$\uff0c\u5219\u521d\u59cb\u72b6\u6001\u4e0b $a_i=p_i$ \u4f1a\u5c31\u8fd1\u52a0\u5165\u4e00\u4e2a\u8fde\u7eed\u6bb5\uff0c\u53ef\u80fd\u7684\u60c5\u51b5\u6709\uff1a\n\n  - \u2160.\u53ea\u52a0\u5165 $[l_k,r_k]$\uff0c\u5f53\u4e14\u4ec5\u5f53 $r_{k-1}+1<p_i=l_k-1$\uff1b\n  - \u2161.\u53ea\u52a0\u5165 $[l_{k-1},r_{k-1}]$\uff0c\u5f53\u4e14\u4ec5\u5f53 $p_i\\le r_{k-1}+1$\uff1b\n  - \u2162.\u540c\u65f6\u52a0\u5165 $[l_{k-1},r_{k-1}]$ \u548c $[l_k,r_k]$\uff08\u5373\u628a\u5b83\u4eec\u5408\u5e76\u8d77\u6765\uff09\uff0c\u5f53\u4e14\u4ec5\u5f53 $r_{k-1}+1=p_i=l_k-1$\u3002\n\n  \u65e0\u8bba\u5982\u4f55\u521d\u59cb\u65f6 $a_i=p_i$ \u603b\u4f1a\u52a0\u5165\u4e00\u4e2a\u8fde\u7eed\u6bb5\u3002\u63a5\u4e0b\u6765 $a_i$ \u4f1a\u548c\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u5185\u7684\u6570\u8fdb\u884c\u5404\u79cd\u4e71\u4e03\u516b\u7cdf\u7684\u64cd\u4f5c\uff0c\u5176\u4e2d\u6211\u4eec\u53d1\u73b0\u4e00\u79cd\u53ef\u4ee5\u7ef4\u6301\u96c6\u5408\u6ee1\u8db3\u8981\u6c42\u7684\u64cd\u4f5c\u65b9\u6848\uff1a\n\n  - \u5728 $\\exists x\\in S_{i-1},x=a_i$ \u65f6\uff0c\u8ba9 $a_i$ \u4e0e\u4e4b\u8fdb\u884c\u64cd\u4f5c\uff0c\u5f97\u5230 $a_i\\gets a_{i+1}$\u3002\n\n  \u8fd9\u4e2a\u64cd\u4f5c\u65b9\u6848\u4f1a\u5f97\u5230\u4ec0\u4e48\u7ed3\u679c\u5462\uff1f\n\n  - \u2160.\uff08\u53ea\u52a0\u5165 $[l_k,r_k]$\uff09$a_i$ \u4e0d\u52a8\uff0c\u5f97\u5230 $a_i=l_k-1$\uff1b\n  - \u2161.\uff08\u53ea\u52a0\u5165 $[l_{k-1},r_{k-1}]$\uff09 $a_i\\gets r_{k-1}+1$\uff1b\n  - \u2162.\uff08\u5408\u5e76\u4e24\u4e2a\u8fde\u7eed\u6bb5\uff09$a_i$ \u4ecd\u7136\u4e0d\u52a8\uff0c$a_i=l_k-1$\u3002\n\n  \u7efc\u5408\u4ee5\u4e0a\u4e09\u79cd\u60c5\u51b5\u7684\u7ed3\u679c\u627e\u51fa\u5171\u6027\uff1a\n\n  - \u901a\u8fc7\u8be5\u64cd\u4f5c\u6211\u4eec\u5f97\u5230\u4e00\u4e2a\u63d2\u5165 $a_i$ \u540e\u7684\u6570\u5b57\u4e92\u4e0d\u76f8\u540c\u7684\u65b0\u8fde\u7eed\u6bb5\uff0c\u8be5\u8fde\u7eed\u6bb5\u4e0e $S_{i-1}$ \u5305\u542b\u7740\u7684 \u9664\u4e86\u88ab $a_i$ \u52a0\u5165/\u5408\u5e76\u7684\u6bb5 \u7684\u5176\u5b83\u8fde\u7eed\u6bb5\u4e0d\u63a5\u3002\n\n  \u5728 $S_{i-1}$ \u7684\u57fa\u7840\u4e0a\u5220\u6389\u88ab $a_i$ \u52a0\u5165/\u5408\u5e76\u7684\u8fde\u7eed\u6bb5\u540e\u63d2\u5165\u8fd9\u4e2a\u65b0\u8fde\u7eed\u6bb5\u5c31\u5f97\u5230\u4e86\u4e00\u79cd $S_i$\u3002\u4e3a\u4ec0\u4e48\u5b83\u662f\u552f\u4e00\u786e\u5b9a\u7684\u5462\uff1f\n\n  \u56e0\u4e3a\u4efb\u4f55\u4e00\u4e2a\u64cd\u4f5c\u90fd\u53ea\u80fd\u548c\u540c\u8fde\u7eed\u6bb5\u7684\u6570\u5b57\u8fdb\u884c\uff0c\u8fdb\u4e00\u6b65\u5730\uff0c\u5bf9\u4e00\u4e2a\u6570 $x$ \u8fdb\u884c\u4e00\u6b21\u64cd\u4f5c**\u4e0d\u4f1a\u4f7f\u5176\u8131\u79bb\u6240\u5728\u8fde\u7eed\u6bb5**\uff0c\u9876\u591a\u5c31\u662f\u8ba9\u5b83\u6302\u5728\u8fde\u7eed\u6bb5\u4e24\u8fb9\u800c\u5df2\uff08$l-1$ \u6216 $r+1$\uff09\u3002\u7279\u522b\u5730\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u6570\u5b57\u4e92\u4e0d\u76f8\u540c\u7684\u8fde\u7eed\u6bb5\uff0c\u65e0\u8bba\u600e\u4e48\u64cd\u4f5c $x$ \u5176\u503c\u90fd\u4f1a\u4e25\u683c\u4fdd\u6301\u5728\u8fde\u7eed\u6bb5\u5de6\u53f3\u7aef\u70b9 $[l,r]$ \u95f4\u3002**\u2460**\uff08\u8fd9\u4e2a\u7ed3\u8bba\u53ef\u4ee5\u624b\u52a8\u6a21\u62df\uff0c\u662f\u6bd4\u8f83\u6613\u61c2\u7684\uff09\n\n  \u53e6\u5916\u7684\u4e00\u4e2a\u70b9\u662f\uff0c\u9898\u8bbe\u4e24\u4e2a\u64cd\u4f5c**\u4e92\u4e3a\u9006\u8fd0\u7b97**\uff0c\u4e5f\u5373\uff0c\u65e2\u7136\u5728\u52a0\u5165 $p_i$ \u540e $a_i=p_i$ \u7684\u72b6\u6001\u53ef\u4ee5\u5bfc\u5411\u5982\u4e0a\u64cd\u4f5c\u65b9\u6848\u5f97\u51fa\u7684\u7ed3\u679c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ed3\u679c\u4e5f\u53ef\u4ee5\u5bfc\u56de\u53bb\u3002\u7531 **\u2460** \u5bf9 \u6309\u5982\u4e0a\u65b9\u6848\u64cd\u4f5c $a_i$ \u540e\u5f97\u5230\u7684\u65b0\u8fde\u7eed\u6bb5 \u4efb\u610f\u64cd\u4f5c\u4e0d\u4f1a\u4f7f\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u7684\u503c\u57df\u53d1\u751f\u6539\u53d8\uff0c\u6240\u4ee5\u5728\u521d\u59cb $a_i=p_i$ \u7684\u72b6\u6001\u4e0b\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u4e5f\u90fd\u4e00\u5b9a\u4f1a\u5bfc\u5411\u8fd9\u4e00\u4e2a\u503c\u57df\u4e0a\u7684\u65b0\u8fde\u7eed\u6bb5\u3002\n\n  \u503c\u57df\u786e\u5b9a\u4e0b\u6765\u540e\u5185\u90e8\u6570\u5b57\u4e92\u4e0d\u76f8\u540c\u7684\u8fde\u7eed\u6bb5\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b0\u8fde\u7eed\u6bb5\u662f\u677f\u4e0a\u9489\u9489\u4e00\u5b9a\u8981\u52a0\u5230 $S_i$ \u91cc\u9762\u7684\uff0c\u540c\u65f6\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u628a\u88ab $a_i$ \u52a0\u5165/\u5408\u5e76\u7684\u8fde\u7eed\u6bb5\uff08\u4eec\uff09\u5168\u90e8\u8986\u76d6\u4e86\uff0c\u4e8e\u662f\u5b83\uff08\u4eec\uff09\u4e5f\u4e00\u5b9a\u4f1a\u88ab\u5220\u9664\u3002\u6211\u4eec\u5728\u5b9a\u96c6\u5408 $S_{i-1}$ \u7684\u57fa\u7840\u4e0a\u6539\u53d8\u7684\u53ea\u6709\u88ab $a_i$ \u52a0\u5165/\u5408\u5e76\u7684\u8fde\u7eed\u6bb5\u4ee5\u53ca\u63d2\u5165\u540e\u7684\u65b0\u8fde\u7eed\u6bb5\uff0c\u6240\u4ee5 $S_i$ \u88ab\u552f\u4e00\u786e\u5b9a\u3002\u4e8e\u662f\u8bc1\u5b8c\u4e86\u3002\n\n\u4ee5\u4e0a\u6240\u6709\u8ba8\u8bba\u90fd\u662f\u5728\u5ffd\u7565\u8d39\u7528\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u7684\uff0c\u5374\u80fd\u591f\u4f7f\u63a5\u4e0b\u6765\u7684\u5206\u6790\u8f7b\u677e\u8bb8\u591a\u3002\u6211\u4eec\u52a0\u8fdb $b_i$ \u7684\u9650\u5236\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002\n\n\u4e0a\u9762\u6211\u4eec\u5206\u6790\u4e86\u201c\u53ef\u884c\u6027\u201d\uff0c\u73b0\u5728\u6211\u4eec\u6765\u8c08\u201c\u6700\u4f18\u6027\u201d\u3002\u6211\u4eec\u5df2\u7ecf\u628a\u8ba8\u8bba\u8303\u56f4\u7f29\u51cf\u5230\u4e86\u4e00\u4e2a\u4e00\u4e2a\u4e00\u4e2a\u4e00\u4e2a\u7684\u8fde\u7eed\u6bb5\uff0c\u8fde\u7eed\u6bb5\u4eec\u7684\u64cd\u4f5c\u76f8\u4e92\u72ec\u7acb\uff1b\u7531 Lemma2 \u6211\u4eec\u5b8c\u5168\u4e0d\u7528\u7ba1\u64cd\u4f5c\u8fc7\u7a0b\u800c\u53ea\u6ce8\u91cd\u7ed3\u679c\uff08[@JustKevinXie(\u73b0\u540dDestroyer_Garing)](https://www.luogu.com.cn/user/324412)\uff09\uff1b\u7531 Lemma1 \u65e0\u8bba\u600e\u4e48\u64cd\u4f5c\u5f97\u5230\u7684\u6700\u7ec8 $a_{1,\\cdots,i}$ \u96c6\u5408\u786e\u5b9a\u3002\u8fd9\u542f\u53d1\u6211\u4eec\u5bf9\u6bcf\u4e00\u4e2a\u8fde\u7eed\u6bb5\u8fdb\u884c\u4e71\u641e\uff08\u6211\u4eec\u4e5f\u53ea\u80fd\u5bf9\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u5206\u522b\u4e71\u641e\uff09\uff0c\u628a\u5b83\u7ffb\u4e2a\u5e95\u671d\u5929\u90fd\u6ca1\u95ee\u9898\uff0c\u53ea\u9700\u8981\u8fbe\u5230\u6700\u4f18\u8d39\u7528\u5373\u53ef\u3002\u91cd\u65b0\u770b\u5411 Lemma2 \u7684\u5f0f\u5b50\uff1a\n$$\n\\sum_{j=1}^i a_jb_j-\\sum_{j=1}^ip_jb_j\n$$\n\u540e\u9762\u90a3\u9879\u786e\u5b9a\uff0c\u6211\u4eec\u53ea\u9700\u6700\u5c0f\u5316 $\\sum_{j=1}^i a_jb_j$\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8fde\u7eed\u6bb5\u6211\u4eec\u53ef\u4ee5\u968f\u4fbf\u9550\u9550\u9450\u9450\uff0c\u51c6\u786e\u6765\u8bf4\u5c31\u662f\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u6539\u53d8\u4e00\u4e2a\u8fde\u7eed\u6bb5\u4e2d $a_i$ \u7684**\u6392\u5217**\uff0c\u5373\u82e5\u4e00\u4e2a\u8fde\u7eed\u6bb5\uff08\u5176\u4e2d\u6570\u4e24\u4e24\u4e0d\u540c\uff09\u662f $a_{q_1},a_{q_2},\\cdots,a_{q_s}$ \u7ecf\u64cd\u4f5c\u5f97\u51fa\u7684\u7ed3\u679c\u7684\u96c6\u5408\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u4e2d\u7684\u6570\u53ef\u4ee5\u4efb\u610f\u5206\u914d\u7ed9 $a_{q_1},\\cdots,a_{q_s}$\u3002\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u5206\u914d\u624d\u80fd\u4f7f\u5f97 $\\sum a_jb_j$ \u6700\u5c0f\u5462\uff1f\n\n\u8fd9\u662f\u4e2a\u7ecf\u5178\u95ee\u9898\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u91cd\u6392\u540e\u6700\u5c0f\u7684 $b_j$ \u5bf9\u5e94\u6700\u5927\u7684 $a_j$\u3001\u6b21\u5c0f\u7684 $b_j$ \u5bf9\u5e94\u6b21\u5927\u7684 $a_j$\u3001\u2026\u2026 \u3001\u6700\u5927\u7684 $b_j$ \u5bf9\u5e94\u6700\u5c0f\u7684 $a_j$ \u4e00\u5b9a\u662f\u6700\u4f18\u65b9\u6848\u3002\u8bc1\u660e\u4e5f\u5f88\u7b80\u5355\uff0c\u968f\u4fbf\u4ea4\u6362\u4e24\u4e2a $a_j$ \u90fd\u53ea\u4f1a\u4f7f\u7b54\u6848\u53d8\u52a3\u3002\n\n\u4e8e\u662f\u8fd9\u9053\u9898\u505a\u5b8c\u4e86\u3002\u6211\u4eec\u8981\u505a\u7684\u4fbf\u662f\u7ef4\u62a4\u6bcf\u4e2a\u8fde\u7eed\u6bb5\uff08\u53ef\u4ee5\u7528 `std::set` \u6216\u8005\u5404\u79cd\u5947\u602a\u7684\u4e1c\u897f\uff09\uff0c\u5bf9\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u5206\u522b\u5f00\u4e00\u4e2a\u5e73\u8861\u6811/\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5355\u8c03\u7684 $b_j$\uff0c\u52a0\u5165 $p_i$ \u65f6\u76f4\u63a5\u6309\u7167\u6211\u4eec\u8bc1\u660e Lemma1 \u65f6\u7ed9\u51fa\u7684\u64cd\u4f5c\u65b9\u6848\u4e0d\u65ad\u8ba9 $a_i\\gets a_i+1$ \u7136\u540e\u5206\u4e09\u79cd\u60c5\u51b5\u8ba8\u8bba\u3001\u52a0\u4e0a\u8d21\u732e\u5373\u53ef\uff0c\u5408\u5e76\u8fde\u7eed\u6bb5\u65f6\u7528\u542f\u53d1\u5f0f\u5408\u5e76\u3002\u603b\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\n\n\u53c2\u8003\u5b9e\u73b0\uff1a\n\n```cpp\n#include <cstdio>\n#include <random>\n#include <vector>\n#include <set>\n#define ll long long\n\nusing namespace std;\n\nnamespace fIO{\n    bool f;char c;void re(int &x){\n        x=0;f=0;c=getchar();\n        while(c<'0'||c>'9') f|=c=='-',c=getchar();\n        while(c>='0'&&c<='9') x=(x<<3)+(x<<1)+(c^48),c=getchar();\n        if(f) x=-x;\n    }\n    void re(char &c){\n        c=getchar();while(c==' '||c=='\\n'||c=='\\r') c=getchar();\n    }\n    template<class tp,class ...Tp>void re(tp &x,Tp &...y){re(x);re(y...);}\n    char st[20];int tp;\n    void wr(int n){\n        if(!n) return putchar('0'),void();\n        if(n<0) putchar('-'),n=-n;\n        while(n) st[++tp]=n%10+48,n/=10;\n        while(tp) putchar(st[tp--]);\n    }\n    inline void wr(char c){putchar(c);}\n    template<class tp,class ...Tp>void wr(tp x,Tp ...y){wr(x);wr(y...);}\n}using fIO::re;using fIO::wr;\n\nmt19937 rnd;\n\nconst int N=4e5+5.14114;\n\nint memo[N],tp;\n\nstruct info{\n\tint c;ll s;\n\tinfo operator+(const info &x)const{\n\t\treturn (info){c+x.c,s+x.s};\n\t}\n};\n\nvector<int> vals;\n\nnamespace BLT{\n\tstruct node{\n\t\tint v,ls,rs;unsigned int pr;info s;\n\t\t#define v(x) t[x].v\n\t\t#define ls(x) t[x].ls\n\t\t#define rs(x) t[x].rs\n\t\t#define pr(x) t[x].pr\n\t\t#define s(x) t[x].s\n\t}t[N];\n\tvoid updata(int x){s(x)=s(ls(x))+s(rs(x))+(info){1,v(x)};};\n\tvoid div(int now,int &x,int &y,int k){\n\t\tif(!now) return x=y=0,void();\n\t\tif(v(now)<=k) x=now,div(rs(now),rs(now),y,k);\n\t\telse y=now,div(ls(now),x,ls(now),k);\n\t\tupdata(now);\n\t}\n\tint merge(int x,int y){\n\t\tif(!x||!y) return x|y;\n\t\tif(pr(x)<pr(y)){\n\t\t\trs(x)=merge(rs(x),y);\n\t\t\tupdata(x);return x;\n\t\t}else{\n\t\t\tls(y)=merge(x,ls(y));\n\t\t\tupdata(y);return y;\n\t\t}\n\t}\n\tint newnod(int k){\n\t\tint nwn=memo[tp--];t[nwn]=(node){k,0,0,rnd(),(info){1,k}};return nwn;\n\t}\n\tvoid ins(int &rt,int k){\n\t\tint x,y;div(rt,x,y,k);\n\t\trt=merge(merge(x,newnod(k)),y);\n\t}\n\tinfo qryles(int &rt,int k){\n\t\tint x,y;div(rt,x,y,k-1);info res=s(x);\n\t\trt=merge(x,y);return res;\n\t}\n\tinfo qrygrt(int &rt,int k){\n\t\tint x,y;div(rt,x,y,k);info res=s(y);\n\t\trt=merge(x,y);return res;\n\t}\n\tvoid breakdown(int now){\n\t\tif(!now) return ;\n\t\tbreakdown(rs(now));\n\t\tvals.push_back(v(now));\n\t\tbreakdown(ls(now));\n\t\tmemo[++tp]=now;\n\t}\n}using namespace BLT;\n\nstruct itv{\n\tint l,r,rttr;\n\tbool operator<(const itv &x)const{\n\t\treturn l<x.l;\n\t}\n};\n\nset<itv> sa;\n\nll saftz;\n\nenum position{lft,rht};\n\nset<itv>::iterator addtoitv(set<itv>::iterator p,int b,position po){\n\tint l=p->l,r=p->r,rttr=p->rttr;\n\tif(po==lft){\n\t\t--l;info x=BLT::qrygrt(rttr,b);\n\t\tsaftz-=x.s-1ll*(l+x.c)*b;\n\t}else{\n\t\t++r;info x=BLT::qryles(rttr,b);\n\t\tsaftz+=x.s+1ll*(r-x.c)*b;\n\t}\n\tBLT::ins(rttr,b);sa.erase(p);\n\treturn sa.insert((itv){l,r,rttr}).first;\n}\n\nint main()\n{\n\twhile(tp<N) memo[tp]=N-tp,++tp;--tp;\n\tint n;re(n);ll sorgn=0;\n\tfor(int i=1;i<=n;++i){\n\t\tint a,b,flg=0;re(a,b);sorgn+=1ll*a*b;\n\t\tauto py=sa.upper_bound((itv){a});\n\t\tauto px=py;if(px!=sa.begin()) --px;\n\t\tif(py!=sa.begin()&&px->r+1>=a) flg=1,a=px->r+1,px=addtoitv(px,b,rht);\n\t\tif(py!=sa.end()&&a==py->l-1){\n\t\t\tif(py!=sa.begin()&&a==px->r){\n\t\t\t\tvals.clear();\n\t\t\t\tint szx=px->r-px->l+1,szy=py->r-py->l+1,rttr;\n\t\t\t\tif(szx<szy){\n\t\t\t\t\tBLT::breakdown(px->rttr);\n\t\t\t\t\tint pl=px->l;sa.erase(px);\n\t\t\t\t\tfor(int i=vals.size()-1;~i;--i) saftz-=1ll*vals[i]*(pl+i),\n\t\t\t\t\t\t\t\t\t\t\t\t\tpy=addtoitv(py,vals[i],lft);\n\t\t\t\t}else{\n\t\t\t\t\tBLT::breakdown(py->rttr);\n\t\t\t\t\tint pl=py->l;sa.erase(py);\n\t\t\t\t\tfor(int i=0;i<vals.size();++i) saftz-=1ll*vals[i]*(pl+i),\n\t\t\t\t\t\t\t\t\t\t\t\t\tpx=addtoitv(px,vals[i],rht);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse addtoitv(py,b,lft);\n\t\t\tflg=1;\n\t\t}\n\t\tif(!flg) sa.insert((itv){a,a,BLT::newnod(b)}),saftz+=1ll*a*b;\n\t\tprintf(\"%lld\\n\",saftz-sorgn);\n\t}\n}\n```\n\n\u6240\u4ee5\u8bf4\u78b0\u5230\u8fd9\u79cd\u9898\u8fd8\u662f\u8981\u63d0\u5347\u89c2\u5bdf\u9ad8\u5ea6\u3001\u591a\u4ece\u7ed3\u679c\u51fa\u53d1\u627e\u5171\u6027\uff0c\u5355\u5355\u76ef\u7740\u6837\u4f8b\u770b\u6709\u65f6\u662f\u4e0d\u4e00\u5b9a\u6709\u7ed3\u679c\u7684\u3002\n\n\u672c\u9898\u601d\u7ef4\u96be\u5ea6\u5927\u7801\u91cf\u4e5f\u6bd4\u8f83\u5927\uff08\u4e2a\u4eba\u89c2\u70b9\uff09\uff0c\u53cd\u6b63\u6211\u662f\u4e0d\u7b97\u5feb\u8bfb\u5199\u4e86130\u591a\u884c\u3002\u5f88\u4e0d\u7406\u89e3\u540c\u673a\u623fdalao\u662f\u5982\u4f55\u4e0d\u538b\u884c\u7684\u60c5\u51b5\u4e0b\u5199\u8fdb60\u884c\u4ee5\u5185\u7684\u3002\n\n",
        "postTime": 1659511105,
        "uid": 326780,
        "name": "Albert_van",
        "ccfLevel": 0,
        "title": "Distinctification \u9898\u89e3"
    },
    {
        "content": "\u6ce8\u610f\u5230\u5982\u679c\u6709\u4e00\u8fde\u4e32 $A_i$ \u662f\u8fde\u7740\u7684\uff0c\u4ed6\u4eec\u4e4b\u95f4\u53ef\u4ee5\u4efb\u610f\u4ea4\u6362\u987a\u5e8f\u3002\n\n\u6211\u4eec\u7684\u76ee\u6807\u662f\u8ba9 $\\sum B_i(A_i^\\prime-A_i)$ \u6700\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8ba9 $A_i$ \u8fde\u7eed\u7684\u4e00\u6bb5\u7684 $B_i$ \u8f83\u5927\u7684\u6392\u5728\u524d\u9762\u3002\n\n\u5982\u679c\u6709\u4e24\u4e2a $A_i$ \u76f8\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4efb\u610f\u4e00\u4e2a\u5148\u82b1\u4e00\u5b9a\u4ee3\u4ef7\u4e0d\u505c\u7684 $+1$ \u76f4\u5230\u6ca1\u6709\u548c\u4ed6\u76f8\u7b49\u7684\uff0c\u5373\u4f7f\u8fd9\u6837\u662f\u4e8f\u7684\u4e5f\u6ca1\u5173\u7cfb\uff0c\u6700\u540e\u6211\u4eec\u6309\u7167\u4e0a\u9762\u8bf4\u7684\u6392\u597d\u5e8f\u4e4b\u540e\u4ee3\u4ef7\u4f1a\u62b5\u6d88\u6389\u3002\n\n\u4e0b\u4e00\u6b65\u95ee\u9898\u662f\u5982\u4f55\u77e5\u9053\u65b0\u63d2\u5165\u4e00\u4e2a $A_i$ \u653e\u5728\u54ea\u91cc\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u5e76\u67e5\u96c6\u6765\u7ef4\u62a4\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8fde\u7eed\u7684\u6bb5\u5f00\u4e00\u4e2a\u5e73\u8861\u6811\u7ef4\u62a4\u8fd9\u91cc\u9762\u7684 $B_i$ \u4ece\u5927\u5230\u5c0f\uff0c\u65b0\u63d2\u5165\u4e00\u4e2a\u6570\u7684\u65f6\u5019\uff0c\u6211\u4eec\u627e\u5230\u4ed6\u8981\u63d2\u7684\u4f4d\u7f6e $p$\uff0c\u7b54\u6848\u52a0\u4e0a\u6bd4 $p$ \u5927\u7684\u8fd9\u4e00\u6bb5\u91cc\u7684 $B_i$ \u7684\u548c\uff0c\u548c\u8fd9\u4e2a\u65b0\u63d2\u8fdb\u6765\u7684\u6570\u672c\u8eab\u7684\u8d21\u732e\u3002\n\n\u63a5\u4e0b\u6765\u662f\u5408\u5e76\u4e24\u6bb5\u7684\u95ee\u9898\uff0c\u76f4\u63a5\u542f\u53d1\u5f0f\u5408\u5e76\u5373\u53ef\uff0c\u6ce8\u610f\u5de6\u8fb9\u5411\u53f3\u8fb9\u5408\u5e76\u548c\u53f3\u8fb9\u5411\u5de6\u8fb9\u5408\u5e76\u4e24\u79cd\u60c5\u51b5\u662f\u4e0d\u540c\u7684\u3002\n\n6 \u79d2\u65f6\u9650 $\\mathcal O(n\\log^2n)$ \u968f\u4fbf\u8dd1\u3002\n\n~~\u611f\u89c9cf ds\u9898\u8bc4\u5206\u666e\u904d\u865a\u9ad8~~\n\n```cpp\nint n,m;\nint a[N],b[N];\nint fa[N];\nint rt[N],son[N][2],siz[N],treap[N],val[N],pos[N],tag[N],tot;\nint bin[N],bintop;\nll sum[N];\nll ans;\n\nint find(int x){\n    if(fa[x]==x)return x;\n    return fa[x]=find(fa[x]);\n}\n\nint newnode(){\n    if(bintop)return bin[bintop--];\n    return ++tot;\n}\n\nvoid update(int x){\n    siz[x]=siz[son[x][0]]+siz[son[x][1]]+1;\n    sum[x]=sum[son[x][0]]+sum[son[x][1]]+val[x];\n}\n\nvoid pusht(int u,int k){\n    pos[u]+=k,tag[u]+=k;\n}\n\nvoid pushdown(int x){\n    if(tag[x]){\n        pusht(son[x][0],tag[x]);\n        pusht(son[x][1],tag[x]);\n        tag[x]=0;\n    }\n}\n\nint merge(int u,int v){\n    if(!u||!v)return u|v;\n    if(treap[u]<treap[v]){\n        pushdown(u);\n        son[u][1]=merge(son[u][1],v);\n        return update(u),u;\n    }\n    else{\n        pushdown(v);\n        son[v][0]=merge(u,son[v][0]);\n        return update(v),v;\n    }\n}\n\nvoid split(int o,int &u,int &v,int k){\n    if(!o){u=v=0;return;}\n    pushdown(o);\n    if(val[o]>=k)split(son[u=o][1],son[o][1],v,k);\n    else split(son[v=o][0],u,son[o][0],k);\n    update(o);\n}\n\nvoid insert(int i,int x){\n    int lft,rht;\n    split(rt[i],lft,rht,x);\n    ans+=sum[rht];\n    pusht(rht,1);\n    int y=lft,z=rht;\n    while(son[y][1])pushdown(y),y=son[y][1];\n    while(son[z][0])pushdown(z),z=son[z][0];\n    int u=newnode();\n    siz[u]=1,treap[u]=rand(),sum[u]=val[u]=x;\n    if(y)pos[u]=pos[y]+1;\n    else if(z)pos[u]=pos[z]-1;\n    else pos[u]=i;\n    ans+=1ll*x*pos[u];\n    rt[i]=merge(merge(lft,u),rht);\n}\n\nvoid chifa(int u,int x){\n    pushdown(u);\n    if(son[u][0])chifa(son[u][0],x);\n    if(son[u][1])chifa(son[u][1],x);\n    ans-=1ll*val[u]*pos[u];\n    insert(x,val[u]);\n    son[u][0]=son[u][1]=siz[u]=sum[u]=val[u]=pos[u]=tag[u]=0;\n    bin[++bintop]=u;\n}\n\nvoid combine(int x,int y){\n    x=find(x),y=find(y);\n    if(siz[rt[x]]>=siz[rt[y]]){\n        if(rt[y])chifa(rt[y],x);\n        rt[y]=rt[x];\n        fa[x]=y;\n    }\n    else{\n        ans-=siz[rt[x]]*sum[rt[y]];\n        pusht(rt[y],-siz[rt[x]]);\n        if(rt[x])chifa(rt[x],y);\n        fa[x]=y;\n    }\n}\n\nint main()\n{\n    # ifdef hibike\n    freopen(\"testdata.in\",\"r\",stdin);\n    freopen(\"test1.out\",\"w\",stdout);\n    # endif\n    srand(time(0));\n    read(n);\n    Rep(i,1,n)read(a[i]),read(b[i]);\n    m=4e5;\n    Rep(i,1,m)fa[i]=i;\n    Rep(i,1,n){\n        int p=find(a[i]);\n        ans+=1ll*(p-a[i])*b[i];\n        ans-=1ll*p*b[i],a[i]=p;\n        insert(a[i],b[i]);\n        combine(p,p+1);\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1629459038,
        "uid": 97344,
        "name": "devout",
        "ccfLevel": 9,
        "title": "CF1051G Distinctification"
    },
    {
        "content": "[$\\tt Link$](/problem/CF1051G)\u3002\n\n\u8bb0\u539f\u5e8f\u5217\u4ece $a_{1\\cdots n}$ \u53d8\u6210 $s_{1\\cdots n}$ \u6700\u7ec8\u7684\u7b54\u6848\u5e94\u8be5\u662f\n\n$$\n\\sum_{i=1}^nb_i(s_i-a_i)\n$$\n\n\u89c2\u5bdf\u5f97\u8fd9\u4e2a\u4e1c\u897f\u4e0e\u4ea4\u6362\u7684\u8fc7\u7a0b\u65e0\u5173\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8\u5982\u4f55\u627e\u5230\u6700\u7ec8\u7684\u7ed3\u679c\u3002\n\n\u5982\u679c\u5b58\u5728 $i,j$ \u4f7f\u5f97 $a_i-a_j=1$\uff0c\u90a3\u4e48\u4ea4\u6362\u5b83\u4eec\uff0c\u6240\u7528\u7684\u4ee3\u4ef7\u662f $b_j-b_i$\u3002\n\n\u8003\u8651\u6700\u7ec8\u7684\u5e8f\u5217\uff0c\u5982\u679c\u6709\u4e00\u6bb5\u6ee1\u8db3 $a$ \u503c\u8fde\u7eed\uff0c\u90a3\u4e48\u8fd9\u4e00\u6bb5\u4e00\u5b9a\u53ef\u4ee5\u4e92\u76f8\u4ea4\u6362\u3002\u800c\u5206\u6790\u7b54\u6848\u7684\u5f0f\u5b50\uff0c\u77e5\u9053\u5bf9\u4e8e\u4e00\u4e2a $a$ \u7684\u8fde\u7eed\u6bb5\uff0c\u8ba9 $b$ \u964d\u5e8f\u5e94\u8be5\u6700\u4f18\u3002\n\n\u503c\u57df\u6bb5\u9700\u8981\u5408\u5e76\uff0c\u8fd9\u91cc\u7528\u5e76\u67e5\u96c6\u3002\n\n\u5408\u5e76\u7684\u540c\u65f6\u9700\u8981\u7ef4\u62a4\u7b54\u6848\uff0c\u6240\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u5408\u5e76\u3002\n\n```cpp\n#import<stdio.h>\n#import<numeric>\n#import<algorithm>\nusing namespace std;\n\nusing ll = long long;\n\nconst int N = 4e5 + 5;\nconst int S = N * 25;\n\nint n,a[N],b[N],c[N],fa[N],rt[N]; ll res; bool vis[N];\n\nint fnd(int i){ return i == fa[i] ? i : fa[i] = fnd(fa[i]); }\n\nint lc[S],rc[S],siz[S],tot; ll sum[S],val[S];\n#define mid ((L + R) >> 1)\n\nvoid psu(int i,int ls,int rs){\n\tsiz[i] = siz[ls] + siz[rs];\n\tsum[i] = sum[ls] + sum[rs];\n\tval[i] = val[ls] + val[rs];\n\tval[i] += sum[ls] * siz[rs];\n}\n\nvoid ins(int x,int &i,int L = 1,int R = 2e5){\n\tif(!i) i = ++tot;\n\tif(L == R) return sum[i] = val[i] = x,void(siz[i] = 1);\n\tx <= mid ? ins(x,lc[i],L,mid) : ins(x,rc[i],mid + 1,R);\n\tpsu(i,lc[i],rc[i]);\n}\n\nint mrg(int x,int y){\n\tif(!x || !y) return x + y; int i = x;\n\tlc[i] = mrg(lc[x],lc[y]);\n\trc[i] = mrg(rc[x],rc[y]);\n\t(lc[i] || rc[i]) ? psu(i,lc[i],rc[i]) : psu(i,y,x);\n\treturn i;\n}\n\nll cnt(int i){ return sum[rt[i]] * (i - 1) + val[rt[i]]; };\n\nvoid upd(int x,int y){\n\tfa[y = fnd(y)] = x = fnd(x);\n\tres -= cnt(x) + cnt(y);\n\trt[x] = mrg(rt[x],rt[y]);\n\tres += cnt(x);\n}\n\nsigned main(){\n\tscanf(\"%d\",&n);\n\tiota(begin(fa),end(fa),0);\n\tfor(int i = 1;i <= n;++i){\n\t\tscanf(\"%d%d\",a + i,b + i);\n\t\tc[i] = fnd(a[i]);\n\t\tfa[c[i]] = c[i] + 1;\n\t\tins(b[i],rt[c[i]]);\n\t}\n\tiota(begin(fa),end(fa),0);\n\tll sum = 0;\n\tfor(int i = 1;i <= n;++i){\n\t\tres += cnt(c[i]);\n\t\tif(vis[c[i] + 1]) upd(c[i],c[i] + 1);\n\t\tif(vis[c[i] - 1]) upd(c[i] - 1,c[i]);\n\t\tsum += 1LL * a[i] * b[i];\n\t\tvis[c[i]] = true;\n\t\tprintf(\"%lld\\n\",res - sum);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1659410612,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "CF1051G \u7ebf\u6bb5\u6811\u5408\u5e76"
    },
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/CF1051G)\n## \u9898\u610f\n\u7ed9\u4f60\u4e24\u4e2a\u957f\u4e3a $n$ \u7684\u5e8f\u5217 $a$ \u548c $b$\uff0c\u4f60\u53ef\u4ee5\u8fdb\u884c\u4e24\u79cd\u64cd\u4f5c\u82e5\u5e72\u6b21\uff1a\n1. \u82e5\u6709 $i\\ne j$ \u4e14 $a_i=a_j$\uff0c\u5219\u53ef\u4ee5\u4ee4 $a_i\\gets a_i+1$\uff0c\u4ee3\u4ef7\u4e3a $b_i$\u3002\n2. \u82e5\u6709 $a_i=a_j+1$\uff0c\u5219\u53ef\u4ee5\u4ee4 $a_i\\gets a_i-1$\uff0c\u4ee3\u4ef7\u4e3a $-b_i$\u3002\n\n\u5bf9\u4e8e $\\forall i\\in[1,n]$\uff0c\u6c42\u51fa\u6700\u5c0f\u7684\u4ee3\u4ef7\u4f7f\u5f97 $a_{1\\dots i}$ \u4e92\u4e0d\u76f8\u540c\u3002\n\n$1\\le n,a_i\\le 2\\times 10^5$\uff0c$b$ \u4e3a\u4e00\u4e2a $[1,n]$ \u7684\u6392\u5217\u3002\n## \u601d\u8def\n\u6700\u7ec8\u7684\u4ee3\u4ef7\u53ea\u4e0e $a_i$ \u6700\u7ec8\u7684\u503c\u6709\u5173\u3002\n\n\u5728\u4e00\u4e2a\u503c\u57df\u8fde\u7eed\u6bb5\u4e2d\uff0c$a_i$ \u7684\u503c\u65e0\u8bba\u5982\u4f55\u64cd\u4f5c\u90fd\u65e0\u6cd5\u5c0f\u4e8e\u6700\u5c0f\u503c\uff0c\u6240\u4ee5\u53ea\u662f\u5c06 $a_i$ \u6216 $b_i$ \u91cd\u65b0\u6392\u5e8f\u4f7f\u5f97\u7b54\u6848\u6700\u5c0f\u7684\u95ee\u9898\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u82e5 $a_i=a_j+1$\uff0c\u5219\u53ef\u4ee5\u4ea4\u6362 $a_i$\uff0c$a_j$\uff0c\u5e76\u82b1\u8d39 $b_j-b_i$ \u7684\u4ee3\u4ef7\u3002\u6240\u4ee5\u5982\u679c $a_i$ \u5728\u4e00\u4e2a\u503c\u57df\u4e0a\u7684\u8fde\u7eed\u6bb5\u4e2d\uff0c\u5219\u53ef\u4ee5\u5c06 $b_i$ \u964d\u5e8f\u6392\u5e8f\uff0c\u4f7f\u5f97\u4ee3\u4ef7\u6700\u5c0f\u3002\n\n\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u6bcf\u4e2a\u503c\u57df\u8fde\u7eed\u6bb5\u5e76\u652f\u6301\u5408\u5e76\uff0c\u8003\u8651\u7ebf\u6bb5\u6811\u5408\u5e76\u3002\n\n\u5bf9\u6bcf\u4e2a\u503c\u57df\u8fde\u7eed\u6bb5\u7684\u5de6\u7aef\u70b9\u5efa\u7acb\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u4ee5 $b_i$ \u4e3a\u4e0b\u6807\uff0c\u8003\u8651\u5230\u53ef\u4ee5\u89c6\u4e3a\u5c06\u5c0f\u4e8e $mid$ \u7684\u503c\u6574\u4f53\u53f3\u79fb\uff0c\u7b54\u6848\u4e3a $sum_{rt}\\times l+\\displaystyle\\sum sum_{ls}\\times siz_{rs}$\u3002\n\n\u7528\u5e76\u67e5\u96c6\u627e\u5230\u8fde\u7eed\u6bb5\u5de6\u7aef\u70b9\u5e76\u8bb0\u5f55\u76f8\u5e94\u53f3\u7aef\u70b9\u3002\n\n\u6570\u7ec4\u8bb0\u5f97\u5f00\u4e24\u500d\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nnamespace IO{//by cyffff\n\t\n}\nconst int N=4e5+10;\nint n,f[N],br[N];\nll ans;\ninline int find(int x){\n\treturn x==f[x]?x:f[x]=find(f[x]);\n}\nint rt[N];\nstruct Segument_Tree{\n    int son[2][N*60],cnt;\n    int siz[N*60];\n\tll sum[N*60];\n    #define ls (son[0][rt])\n    #define rs (son[1][rt])\n    inline void pushup(int rt){\n        sum[rt]=sum[ls]+sum[rs];\n        siz[rt]=siz[ls]+siz[rs];\n    }\n    inline void insert(int &rt,int l,int r,int p){\n        if(!rt)\n            rt=++cnt;\n        if(l==r){\n        \tsum[rt]=p,siz[rt]=1;\n            return ;\n        }\n        int mid=l+r>>1;\n        if(p<=mid) insert(ls,l,mid,p);\n        else insert(rs,mid+1,r,p);\n        pushup(rt);\n    }\n    inline int merge(int a,int b,int l,int r){\n        if(!a||!b) return a+b;\n        int rt=++cnt;\n        if(l==r) return rt;\n        ans-=sum[son[0][a]]*siz[son[1][a]]+\n\t\t\tsum[son[0][b]]*siz[son[1][b]];\n        int mid=l+r>>1;\n        ls=merge(son[0][a],son[0][b],l,mid);\n        rs=merge(son[1][a],son[1][b],mid+1,r);\n        ans+=sum[ls]*siz[rs];\n        pushup(rt);\n        return rt;\n    }\n}t;\ninline void solve(int u,int v){\n\tu=find(u),v=find(v),f[v]=u;\n\tans-=t.sum[rt[u]]*u+t.sum[rt[v]]*v;\n\trt[u]=t.merge(rt[u],rt[v],1,n);\n\tans+=t.sum[rt[u]]*u;\n\tbr[u]=br[v];\n}\nint main(){\n\tn=read();\n\tfor(int i=1;i<=N-10;i++)\n\t\tf[i]=br[i]=i;\n\tfor(int i=1;i<=n;i++){\n\t\tint p=read(),v=read();\n\t\tint xp=rt[p]?br[find(p)]+1:p;\n\t\tans+=1ll*(xp-p)*v;\n\t\tt.insert(rt[xp],1,n,v);\n\t\tif(rt[xp-1]) solve(xp-1,xp);\n\t\tif(rt[xp+1]) solve(xp,xp+1);\n\t\twrite(ans),putc('\\n');\n\t}\n\tflush();\n}\n```\n\u518d\u89c1 qwq~",
        "postTime": 1659403077,
        "uid": 365127,
        "name": "cyffff",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1051G\u3010Distinctification\u3011"
    },
    {
        "content": "\u5c0f\u6e05\u65b0\u6570\u636e\u7ed3\u6784\u9898\u3002\n\n\u5047\u8bbe\u64cd\u4f5c\u540e\u7684 $a$ \u5e8f\u5217\u53d8\u4e3a $a^\\prime$ \u5e8f\u5217\uff0c\u5219\u7b49\u4ef7\u4e8e\u8981\u6700\u5c0f\u5316 $\\sum (a_i^\\prime-a_i)\\times b_i=\\sum a^\\prime_ib_i-\\sum a_ib_i$\u3002\n\n\u7b2c\u4e8c\u9879\u662f\u5b9a\u503c\uff0c\u8bb0 $S=\\sum a^\\prime_ib_i$\uff0c\u6211\u4eec\u5c31\u8981\u6700\u5c0f\u5316 $S$\u3002\n\n\u5173\u6ce8\u5230\u5bf9\u4e8e\u4e00\u4e2a\u5173\u4e8e $a$ \u7684\u503c\u57df\u8fde\u7eed\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u91cd\u6392\u5176\u4e2d\u7684\u5143\u7d20\u987a\u5e8f\uff0c\u5e76\u4e14\u8fd9\u4e2a\u503c\u57df\u6bb5\u6700\u7ec8\u5bf9\u5e94\u533a\u95f4 $[\\min\\{a\\},\\min\\{a\\}+cnt-1]$\u3002\n\n\u8fd9\u6837\u505a\u4e00\u6b21\u53ef\u80fd\u4f1a\u518d\u5408\u5e76\u82e5\u5e72\u503c\u57df\u8fde\u7eed\u6bb5\uff0c\u6211\u4eec\u8ba4\u4e3a\u4e00\u76f4\u505a\u5230\u65e0\u6cd5\u518d\u5408\u5e76\u540e\uff0c\u5728\u540c\u4e00\u6bb5\u5185\u7684 $a$ \u662f\u503c\u57df\u8fde\u7eed\u7684\u3002\n\n\u5bf9\u5e94\u533a\u95f4\u662f\u663e\u7136\u7684\uff0c\u91cd\u6392\u987a\u5e8f\u7684\u8bdd\uff0c\u8003\u8651\u4e24\u4e2a\u5143\u7d20 $x$ \u548c $x+1$\uff0c\u987a\u6b21\u7528\u64cd\u4f5c $2$\u3001\u64cd\u4f5c $1$ \u5373\u53ef\u5c06\u5176\u4ea4\u6362\u3002\n\n\u56e0\u6b64\u8981\u5c3d\u91cf\u8ba9 $b_i$ \u5927\u7684\u5206\u914d\u5728\u9760\u524d\u7684\u4f4d\u7f6e\u3002\u6362\u800c\u8a00\u4e4b\uff0c\u5bf9\u4e8e\u4e00\u4e2a $(a_i,b_i)$\uff0c\u5176\u6700\u540e\u7684 $a^\\prime_i$ \u4e3a $w+rank_{b_i}-1$\u3002$w$ \u4e3a\u5176\u5bf9\u5e94\u503c\u57df\u6bb5\u7684\u6700\u5c0f\u503c\uff0c$rank_{b_i}$ \u8868\u793a $b_i$ \u5728\u8fd9\u4e2a\u6bb5\u5185\u662f\u7b2c\u51e0\u5927\u7684\u3002\n\n\u7a0d\u5fae\u5c55\u5f00\u4e00\u4e0b\u5f0f\u5b50\uff1a$\\sum (w+rk_{b_i}-1)b_i=(w-1)\\sum b+\\sum b_i\\times rk_{b_i}$\u3002\n\n$w$ \u4e0e $\\sum b$ \u662f\u597d\u7ef4\u62a4\u7684\uff0c\u8fb9\u63d2\u5165\u8fb9\u66f4\u65b0\u5373\u53ef\u3002\u63a5\u4e0b\u6765\u5904\u7406 $rk$ \u7684\u95ee\u9898\u3002\n\n\u8003\u8651\u6bcf\u63d2\u5165\u4e00\u4e2a\u6570\u65f6\uff0c\u4f1a\u53d1\u751f\u4e09\u79cd\u60c5\u51b5\u3002\n\n1. \u65b0\u5efa\u4e00\u4e2a\u989c\u8272\u6bb5\u3002\n2. \u5e76\u5165\u67d0\u4e2a\u989c\u8272\u6bb5\u3002\n3. \u5408\u5e76\u4e24\u4e2a\u989c\u8272\u6bb5\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u7c7b\uff0c\u76f4\u63a5\u65b0\u5efa\u989c\u8272\u6bb5\u66f4\u65b0 $S$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u7c7b\uff0c\u8003\u8651\u5176\u6240\u5728\u7684\u989c\u8272\u6bb5\uff0c\u6211\u4eec\u5c06\u5176\u7684 $a$ \u53d8\u4e3a\u8be5\u6bb5\u6700\u5927\u503c $+1$\uff0c\u8f6c\u5316\u4e3a\u7b2c\u4e00\u7c7b\u52a0\u7b2c\u4e09\u7c7b\u3002\n\n\u7136\u540e\u662f\u7b2c\u4e09\u7c7b\u3002\n\n\u5173\u6ce8\u5230 $n$ \u53ea\u6709 $2\\times 10^5$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u56de\u6536\u6389\u6570\u8f83\u5c11\u7684\u90a3\u4fa7\u7684\u7ebf\u6bb5\u6811\uff0c\u7136\u540e\u5c06\u90a3\u4e9b\u6570\u66b4\u529b\u63d2\u5165\u53e6\u4e00\u6bb5\u3002\n\n\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u542f\u53d1\u5f0f\u5408\u5e76\u642c\u5230\u4e86\u5e8f\u5217\u4e0a\uff0c\u590d\u6742\u5ea6 $O(n\\log^2n)$ \u53ef\u8fc7\u3002\n\n\u8003\u8651\u4f18\u96c5\u4e00\u4e9b\u7684\u7ebf\u6bb5\u6811\u5408\u5e76\u3002\n\n\u9996\u5148\u8fd8\u662f\u628a\u65b0\u52a0\u5165\u7684\u6570\u968f\u4fbf\u5e76\u5230\u4e24\u4fa7\u989c\u8272\u6bb5\u4e4b\u4e00\uff0c\u7136\u540e\u4e13\u5fc3\u641e\u5408\u5e76\u3002\n\n\u4e00\u79cd\u505a\u6cd5\u662f\u7c7b\u4f3c\u5206\u6cbb\u7684\u601d\u60f3\u7edf\u8ba1\u65b0\u589e\u8d21\u732e\uff0c\u5408\u5e76\u4e2d\u8d70\u5230\u4e24\u68f5\u6811\u7684\u540c\u4e00\u4f4d\u7f6e\u8282\u70b9 $x,y$ \u65f6\uff0c\u7edf\u8ba1 $rs_x$ \u5bf9 $ls_y$\u3001$rs_y$ \u5bf9 $ls_x$ \u7684\u8d21\u732e\u3002\n\n\u4ee5 $p=rs_x,q=ls_y$ \u4e3a\u4f8b\uff0c$p$ \u4e2d\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u4f7f\u5f97 $q$ \u4e2d\u7684\u6240\u6709\u5143\u7d20\u6392\u540d\u52a0\u4e00\uff0c\u56e0\u6b64 $p$ \u5bf9 $q$ \u7684\u8d21\u732e\u5c31\u662f $cnt_p\\times sum_q$\u3002\n\n\u800c\u5b50\u6811\u5143\u7d20\u4e2a\u6570\u3001\u5143\u7d20\u548c\u90fd\u662f\u6743\u503c\u7ebf\u6bb5\u6811\u91cc\u7ef4\u62a4\u7684\u4e1c\u897f\uff0c\u76f4\u63a5\u5904\u7406\u5373\u53ef\u3002\n\n\u53e6\u4e00\u79cd\u662f\u5148\u5b8c\u6210\u5e95\u5c42\u5408\u5e76\uff0c\u7136\u540e `pushup` \u4e00\u8def\u66f4\u65b0\u7b54\u6848\u3002\u672c\u8d28\u4e0a\u8fd8\u662f\u7edf\u8ba1\u53f3\u5b50\u6811\u5bf9\u5de6\u5b50\u6811\u7684\u8d21\u732e\u3002\u4e0e\u4e0a\u4e00\u79cd\u60c5\u51b5\u7c7b\u4f3c\uff0c\u5c31\u4e0d\u5c55\u5f00\u4e86\u3002\n\n\u7136\u540e\u5224\u65ad\u7b2c\u4e8c\u3001\u4e09\u7c7b\u662f\u5426\u53d1\u751f\uff0c\u53ea\u9700\u8981\u5224\u65ad $a_i$ \u548c\u63d2\u5165\u540e $a_i$ \u6240\u5728\u4f4d\u7f6e\u76f8\u90bb\u4e24\u70b9\u7684\u72b6\u6001\uff0c\u5e76\u67e5\u96c6\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002[record](https://codeforces.com/contest/1051/submission/206084428)\u3002\n",
        "postTime": 1684239889,
        "uid": 128606,
        "name": "2018ljw",
        "ccfLevel": 7,
        "title": "CF1051G \u9898\u89e3"
    },
    {
        "content": "### CF1051G Distinctification\n\n\u663e\u7136\uff0c\u6700\u540e\u7684 $a$ \u96c6\u5408\u662f\u552f\u4e00\u7684\u3002\n\n\u82e5 $a_i$ \u4e24\u4e24\u4e0d\u540c\uff0c\u5219\u6709\u591a\u4e2a $a_i$ \u8fde\u7eed\u7684\u503c\u57df\u6bb5\uff0c\u6bb5\u5185\u6ee1\u8db3 $b_i$ \u9012\u51cf\u6700\u4f18\u3002\n\n\u5426\u5219\uff0c\u5c06 $a_i$ \u5e73\u94fa\u5f80\u540e\uff0c\u4e0e\u540e\u9762\u7684\u503c\u57df\u6bb5\u5408\u5e76\u5373\u53ef\uff0c\u5e76\u67e5\u96c6\u7ef4\u62a4\u3002\n\n\u8003\u8651\u8ba1\u7b97\u7b54\u6848\uff0c\u53d1\u73b0\u5176\u53ea\u4e0e\u6700\u7ec8\u7ed3\u679c\u76f8\u5173\uff0c\u4e3a $\\sum (a'_i-a_i)\\times b_i$\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u503c\u57df\u5757\u7b54\u6848\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n//#define int long long\ntypedef long long ll;\n#define ha putchar(' ')\n#define he putchar('\\n')\n\ninline int read()\n{\n\tint x = 0, f = 1;\n\tchar c = getchar();\n\twhile (c < '0' || c > '9')\n\t{\n\t\tif (c == '-')\n\t\t\tf = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9')\n\t\tx = x * 10 + c - '0', c = getchar();\n\treturn x * f;\n}\n\ninline void write(ll x)\n{\n\tif (x < 0)\n\t{\n\t\tputchar('-');\n\t\tx = -x;\n\t}\n\tif (x > 9)\n\t\twrite(x / 10);\n\tputchar(x % 10 + '0');\n}\n\nconst int _ = 4e5 + 10;\n\nint n, cnt, a[_], b[_], fa[_], rt[_];\n\nbool vis[_];\n\nll s[_], ans;\n\nstruct Tr\n{\n\tint siz, c[2];\n\tll sum, val;\n} t[_ * 30];\n\nvoid pushup(int o)\n{\n\tt[o].sum = t[t[o].c[0]].sum + t[t[o].c[1]].sum;\n\tt[o].siz = t[t[o].c[0]].siz + t[t[o].c[1]].siz;\n\tt[o].val = t[t[o].c[0]].val + t[t[o].c[1]].val + 1ll * t[t[o].c[0]].sum * t[t[o].c[1]].siz;\n}\n\nvoid upd(int &o, int l, int r, int p)\n{\n\tif (!o)\n\t\to = ++cnt;\n\tif (l == r)\n\t{\n\t\tt[o].sum = t[o].val = p;\n\t\tt[o].siz = 1;\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tif (p <= mid)\n\t\tupd(t[o].c[0], l, mid, p);\n\telse\n\t\tupd(t[o].c[1], mid + 1, r, p);\n\tpushup(o);\n}\n\nll qry(int x)\n{\n\treturn t[rt[x]].val + 1ll * (x - 1) * t[rt[x]].sum;\n}\n\nint merge(int x, int y)\n{\n\tif (!x || !y)\n\t\treturn x | y;\n\tint nw = x;\n\tt[nw].c[0] = merge(t[x].c[0], t[y].c[0]);\n\tt[nw].c[1] = merge(t[x].c[1], t[y].c[1]);\n\tif (!t[nw].c[0] && !t[nw].c[1])\n\t{\n\t\tt[nw].val = t[x].val + t[y].val + t[y].sum * t[x].siz;\n\t\tt[nw].sum = t[x].sum + t[y].sum;\n\t\tt[nw].siz = t[x].siz + t[y].siz;\n\t}\n\telse\n\t\tpushup(nw);\n\treturn nw;\n}\n\nint find(int x)\n{\n\treturn fa[x] == x ? x : fa[x] = find(fa[x]);\n}\n\nvoid link(int x, int y)\n{\n\tx = find(x), y = find(y);\n\tfa[y] = x;\n\tans -= qry(x) + qry(y);\n\trt[x] = merge(rt[x], rt[y]);\n\tans += qry(x);\n}\n\nsigned main()\n{\n\tn = read();\n\tfor (int i = 1; i <= 4e5; ++i)\n\t\tfa[i] = i;\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\ta[i] = read(), b[i] = read();\n\t\ts[i] = s[i - 1] + 1ll * a[i] * b[i];\n\t\ta[i] = find(a[i]), fa[a[i]] = a[i] + 1;\n\t\tupd(rt[a[i]], 1, 4e5, b[i]);\n\t}\n\tfor (int i = 1; i <= 4e5; ++i)\n\t\tfa[i] = i;\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\tans += qry(a[i]);\n\t\tif (vis[a[i] + 1])\n\t\t\tlink(a[i], a[i] + 1);\n\t\tif (vis[a[i] - 1])\n\t\t\tlink(a[i] - 1, a[i]);\n\t\tvis[a[i]] = 1;\n\t\twrite(ans - s[i]), he;\n\t}\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1659361991,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "CF1051G Distinctification"
    }
]