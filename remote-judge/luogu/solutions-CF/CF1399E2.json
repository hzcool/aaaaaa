[
    {
        "content": "## \u9898\u610f \n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u8fb9\u5e26\u6743\uff0c\u6bcf\u4e00\u6b21\u53ef\u4ee5\u5c06\u4e00\u6761\u8fb9\u7684\u6743\u503c\u9664\u4ee5 $2$ \u5e76\u5411\u4e0b\u53d6\u6574\u5e76\u82b1\u8d39 $1$ \u6216 $2$ \u786c\u5e01\uff0c\u95ee\u8981\u4f7f\u6240\u6709\u53f6\u5b50\u5230\u6839\u7684\u8ddd\u79bb\u548c\u4e0d\u8d85\u8fc7 $S$ \u7684\u6700\u5c0f\u82b1\u8d39\u786c\u5e01\u3002\n## \u601d\u8def\n\u6ce8\u610f\u5230\u64cd\u4f5c\u6b21\u6570\u4e0d\u4f1a\u8d85\u8fc7 $nlogw$ \u6b21\uff0c\u5373\u6bcf\u6761\u8fb9\u6700\u591a $logw$ \u6b21\u540e\u5c31\u4f1a\u53d8\u6210 $0$ \u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u7528 $set$ \u7ef4\u62a4\u6700\u4f18\u51b3\u7b56\u3002\n\n~~\u5148 $dfs$ \u51fa\u6bcf\u6761\u8fb9\u7ecf\u8fc7\u4e86\u51e0\u904d\uff0c\u7136\u540e\u5168\u90e8\u653e\u5165 $set$ \u91cc\uff0c$set$ \u6839\u636e\u5c06\u8fd9\u6761\u8fb9\u9664\u4ee5 $2$ \u518d\u9664\u4ee5 $coin$ \u540e\u8ddd\u79bb\u548c\u51cf\u5c0f\u7684\u503c\u6392\u5e8f\uff0c\u6bcf\u6b21\u53d6\u51fa\u6700\u4f18\u89e3\uff0c\u6267\u884c\u64cd\u4f5c\u540e\u518d\u653e\u56de $set$ \u4e2d\uff0c\u5f53\u6ee1\u8db3\u8981\u6c42\u65f6\u9000\u51fa\u5e76\u8f93\u51fa\u7b54\u6848\u3002~~\n\n~~\u8bb0\u5f97\u5f00 $multiset$ \u907f\u514d\u4e24\u4e2a\u4f18\u5148\u7ea7\u76f8\u540c\u7684\u89e3\u88ab\u541e\u4e86\u4e00\u4e2a\u3002~~\n\n~~\u606d\u559c\u4f60\uff0c\u559c\u63d0 $\\red{\\text{Wrong answer on pretest 21}}$~~\n\n\u8fd9\u4e2a\u8d2a\u5fc3\u663e\u7136\u662f\u9519\u7684\uff01\u6bd4\u5982\u8fd9\u7ec4\u6570\u636e\n```\n1\n3 10099\n1 2 10000 2 \n1 3 100 1\n```\n\u867d\u7136\u5c06\u7b2c\u4e00\u6761\u8fb9\u9664\u4ee5 $2$ \u6536\u76ca\u66f4\u5927\uff0c\u4f46\u662f\u7b2c\u4e8c\u6761\u8fb9\u9664\u4ee5 $2$ \u5df2\u7ecf\u6ee1\u8db3\u8981\u6c42\u4e86\u3002\n\n\u4e0d\u8fc7\u6709\u4e86 $E1$ \u7684\u94fa\u57ab\uff0c\u89e3\u51b3\u8fd9\u9898\u5e76\u4e0d\u662f\u5f88\u96be\u3002\n\n\u8003\u8651\u7b54\u6848\uff0c\u4e00\u5b9a\u662f\u53d6\u4e86\u4e00\u4e9b\u6700\u4f18\u7684 $coin=1$ \u548c\u4e00\u4e9b\u6700\u4f18\u7684 $coin=2$d \u7684\u51b3\u7b56\u3002\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5c06 $coin=1$ \u548c $coin=2$ \u5206\u522b\u653e\u5165\u4e24\u4e2a $set$ \uff0c\u7136\u540e\u5206\u522b\u7b97\u51fa\u53ea\u7528 $x$ \u4e2a $coin=1$ \u6216 $coin=2$ \u80fd\u51cf\u5c0f\u7684 $S$ \u3002\u7136\u540e\u679a\u4e3e\u4e00\u8fb9\uff0c\u5e76\u4e8c\u5206\u786e\u5b9a\u53e6\u4e00\u8fb9\u7684\u7b54\u6848\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n(dfs)+nlognlogw(set)+nlogw^2(bs))$\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\ninline long long readll(){\n   long long s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nint to[1000003],nxt[1000003],head[1000003],val[1000003],f[1000003],t[1000003],cnt=0;\nint d[1000003];\nstruct cmp  \n{  \n    bool operator ()(const pair<int,int> &a, const pair<int,int> &b)  \n    {  \n        if(1LL*(a.first-(a.first/2))*a.second!=1LL*(b.first-(b.first/2))*b.second) return 1LL*(a.first-(a.first/2))*a.second>1LL*(b.first-(b.first/2))*b.second; \n\t\treturn a.first>b.first; \n    }  \n};  \nvoid dfs(int x,int fa,int from)\n{\n\tif(d[x]==1 && x!=1) \n\t{\n\t\tt[from]=1;\n\t\treturn ;\n\t}\n\tfor(int i=head[x]; i; i=nxt[i]) if(to[i]!=fa)\n\t{\n\t\tdfs(to[i],x,i);\n\t\tt[from]+=t[i];\n\t}\n\treturn ;\n}\nmultiset<pair<int,int>,cmp> s1,s2;\nlong long ans1[5000003],ans2[5000003];\nint cnt1,cnt2,n,m,ans;\nint bs(long long k)\n{\n\tint res=cnt2,l=0,r=cnt2;\n\twhile(l<=r)\n\t{\n\t\tint mid=(l+r)>>1;\n\t\tif(ans2[mid]>=k) res=mid,r=mid-1; else l=mid+1;\n\t}\n\treturn res;\n}\nint main()\n{\n\tint T=read(); while(T--)\n\t{\n\t\ts1.clear(),s2.clear(),cnt=cnt1=cnt2=0;\n\t\tn=read(),ans=1000000007,m=(n-1)<<1;\n\t\tfor(int i=1; i<=n; i++) head[i]=0,d[i]=0;\n\t\tfor(int i=1; i<=m; i++) t[i]=0;\n\t\tlong long S=-readll(); \n\t\tfor(int i=1; i<n; i++) \n\t\t{\n\t\t\tint u=read(),v=read(),w=read(),qwq=read();\n\t\t\tto[++cnt]=v,val[cnt]=w,f[cnt]=qwq,nxt[cnt]=head[u],head[u]=cnt;\n\t\t\tto[++cnt]=u,val[cnt]=w,f[cnt]=qwq,nxt[cnt]=head[v],head[v]=cnt;\n\t\t\td[u]++,d[v]++;\n\t\t}\n\t\tdfs(1,1,0);\n\t\tfor(int i=1; i<=m; i++) if(t[i]) {\n\t\t\tS+=1LL*val[i]*t[i];\n\t\t\tif(f[i]==1) s1.insert(make_pair(val[i],t[i]));\n\t\t\telse s2.insert(make_pair(val[i],t[i]));\n\t\t}\n\t\tlong long tS=0;\n\t\twhile(tS<=S)\n\t\t{\n\t\t\tif(s1.empty()) break;\n\t\t\tpair<int,int> tmp=*s1.begin();\n\t\t\ts1.erase(s1.begin());\n\t\t\ttS+=1LL*(tmp.first-(tmp.first/2))*tmp.second;\n\t\t\ttmp.first/=2;\n\t\t\tif(tmp.first) s1.insert(tmp);\n\t\t\tans1[++cnt1]=tS;\n\t\t}\n\t\ttS=0;\n\t\twhile(tS<=S)\n\t\t{\n\t\t\tif(s2.empty()) break;\n\t\t\tpair<int,int> tmp=*s2.begin();\n\t\t\ts2.erase(s2.begin());\n\t\t\ttS+=1LL*(tmp.first-(tmp.first/2))*tmp.second;\n\t\t\ttmp.first/=2;\n\t\t\tif(tmp.first) s2.insert(tmp);\n\t\t\tans2[++cnt2]=tS;\n\t\t}\n\t\tfor(int i=0; i<=cnt1; i++) \n\t\t{\n\t\t\tif(ans1[i]+ans2[cnt2]<S) continue;\n\t\t\tif(ans1[i]>=S) { ans=min(ans,i); break; }\n\t\t\tans=min(ans,i+2*bs(S-ans1[i]));\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n    return 0;\n}\n//By dead_X\n```",
        "postTime": 1596686175,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1399E2 \u3010Weights Division (hard version)\u3011"
    },
    {
        "content": "\u8fd9\u9898\u662f\u4e00\u9053 $ 2 \\times 10^4 $ \u7684\u591a\u6d4b\u9898\u3002\n\n\u7ed9\u4f60\u4e00\u68f5\u6811\uff0c\u6811\u4e0a\u6bcf\u6761\u8fb9\u6709\u5bf9\u5e94\u7684\u8fb9\u6743 $ w_i $ \u548c\u64cd\u4f5c\u4ee3\u4ef7 $ c_i $ \u3002\n\n\u8ba9\u4f60\u5bf9\u4e00\u4e9b\u8fb9\u8fdb\u884c\u64cd\u4f5c\uff0c\u4f7f\u5b83\u7684\u8fb9\u6743\u53d8\u6210 $ \\lfloor \\frac{w_i}{2} \\rfloor $ \u3002\n\n\u95ee\u4f60\u81f3\u5c11\u4ed8\u51fa\u591a\u5c11\u4ee3\u4ef7\u53ef\u4ee5\u4f7f\u6240\u6709\u53f6\u5b50\u7ed3\u70b9\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u6743\u503c\u548c\u4e0d\u8d85\u8fc7 $ S $ \u3002\n\n\u4e00\u6761\u8fb9\u663e\u7136\u53ef\u4ee5\u88ab\u591a\u4e2a\u53f6\u5b50\u7ed3\u70b9\u8ba1\u7b97\u7b54\u6848\u3002\n\n $ n\\leq 10^5 $ \n \n $ \\sum n \\leq 10^5 $ \n \n------------\n\n\u89c2\u5bdf\u5230\u53ea\u6709 $ 2 $ \u79cd\u4ee3\u4ef7 $ c_i $ \u6240\u4ee5\u53ef\u4ee5\u5148\u9884\u5904\u7406\uff0c\u518d\u679a\u4e3e\u64cd\u4f5c\u591a\u5c11\u4ee3\u4ef7\u4e3a   $ 2 $ \u7684\u8fb9\u3002\n\n\u9884\u5904\u7406\u4e00\u79cd\u64cd\u4f5c\u4ee3\u4ef7\u7684\u8fb9\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8d2a\u5fc3\u4e86\uff0c\u6bd5\u7adf\u64cd\u4f5c\u4ee3\u4ef7\u76f8\u7b49\u3002\n\n\u53ef\u4ee5\u4f7f\u7528 ` priority_queue ` \u8fdb\u884c\u5904\u7406\uff0c\u8d2a\u5fc3\u5730\u9009\u62e9\u64cd\u4f5c\u4ea7\u751f\u8d21\u732e\uff08\u7b54\u6848\u53d8\u5316\uff09\u6700\u5927\u7684\u8fb9\u3002\n\n\u8bb0\u7b2c $ i $ \u6761\u8fb9\u5728 $ d_i $ \u4e2a\u53f6\u5b50\u7ed3\u70b9\u5230\u6839\u7ed3\u70b9\u7684\u8def\u5f84\u4e0a\uff0c\u8d21\u732e\u5c31\u662f $ ( w_i - \\lfloor \\frac{w_i}{2} \\rfloor ) \\times d_i $  \u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u8fb9\u8ba1\u7b97\u5b8c\u7b54\u6848\u8981\u8bb0\u5f97\u4f7f $ w_i = \\lfloor \\frac{w_i}{2} \\rfloor $ \uff0c\u5728\u91cd\u65b0\u5f39\u5165\u4f18\u5148\u961f\u5217\u3002\n\n\u56e0\u4e3a\u9009\u4ee3\u4ef7\u4e3a $ 2 $ \u7684\u8fb9\u8d8a\u591a\uff0c\u9700\u8981\u9009\u7684\u4ee3\u4ef7\u4e3a $ 1 $ \u7684\u8fb9\u6570\u91cf\u5355\u8c03\u9012\u51cf\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u53cc\u6307\u9488\u8ba1\u7b97\u7b54\u6848\u3002\n\n------------\n\n\u7a0b\u5e8f\u6bcf\u7ec4\u6570\u636e\u590d\u6742\u5ea6 $ O( \\sum_{i = 1}^{n - 1}{ \\log_{2}{w_i} } \\times \\log_{2}n) $ \u3002\n\n\u8ba1\u7b97\u7b54\u6848\u7684\u590d\u6742\u5ea6\u662f $ O( \\sum_{i = 1}^{n - 1}{ \\log_{2}{w_i} } ) $ \u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002\n\n------------\n\n\u4ee3\u7801\u5982\u4e0b \uff08~~\u975e\u5e38\u7684\u77ed~~)\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,s,l;\nlong long now,mst;\n//xy\u5728\u8fd9\u91cc\u6709\u4e24\u79cd\u610f\u601d\n//\u5728\u8868\u793a\u8fb9\u662fx\u662f\u6307\u5411\u7684\u70b9\uff0cy\u662f\u8fb9\u7684\u7f16\u53f7\n//\u5728\u8868\u793a\u8d21\u732e\u65f6x\u662f\u8fb9\u7684\u6743\u503c\uff0cy\u662f\u8fb9\u7684\u8986\u76d6\u53f6\u8282\u70b9\u6570\u91cf\nstruct xy{int x,y;};\n#define dv(a) (1ll*(a.x-(a.x>>1))*a.y)//\u8ba1\u7b97\u8d21\u732e\uff0c\u5982\u679c\u66f4\u6539\u4e00\u6b21\u5219\u8d21\u732e\u662f\u591a\u5c11\nbool operator < (xy a,xy b){return dv(a)<dv(b);}\nxy ls;\nlong long sum;\nint aa[101010],bb[101010],vs[101010];\nlong long a[2020202],as;\nlong long b[2020202],bs;\nvector<xy>q[101010];\npriority_queue<xy>p;\nint dfs(int x,int fa){\n\tint siz=1,sf=0;\n\tfor(register int i=0;i<q[x].size();++i){\n\t\tif(q[x][i].x==fa)continue;\n\t\tsf=1;\n\t\tvs[q[x][i].y]=dfs(q[x][i].x,x);\n\t\tsiz+=vs[q[x][i].y];\n\t}\n\treturn siz-sf;//\u8fd4\u56de\u53f6\u8282\u70b9\u4e2a\u6570\n}\nvoid doing(){\n\tcin>>n>>mst;\n\tfor(register int i=1;i<=n;++i)q[i].clear();\n\tfor(register int i=1;i<n;++i){\n\t\tscanf(\"%d %d %d %d\",&s,&l,&aa[i],&bb[i]);\n\t\tq[s].push_back((xy){l,i});\n\t\tq[l].push_back((xy){s,i});\n\t\tvs[i]=0;\n\t}\n\tdfs(1,0);\n\tnow=as=sum=0;\n\t//\u8ba1\u7b97\u82b1\u8d39\u4e3a1\u7684\u6240\u6709\u8fb9\u64cd\u4f5c\u65f6\u80fd\u4ea7\u751f\u7684\u8d21\u732e\u964d\u5e8f\n\tfor(register int i=1;i<n;++i){\n\t\tif(bb[i]==2)continue;\n\t\tnow+=1ll*aa[i]*vs[i];\n\t\tp.push((xy){aa[i],vs[i]});\n\t}\n\tmst-=now;\n\twhile(now){\n\t\tls=p.top();p.pop();\n\t\tsum+=dv(ls);\n\t\ta[++as]=dv(ls);\n\t\tnow-=dv(ls);\n\t\tls.x>>=1;\n\t\tp.push(ls);\n\t}\n\twhile(p.size())p.pop();\n\tnow=bs=0;\n\t//\u8ba1\u7b97\u82b1\u8d39\u4e3a2\u7684\u6240\u6709\u8fb9\u64cd\u4f5c\u65f6\u80fd\u4ea7\u751f\u7684\u8d21\u732e\u964d\u5e8f\n\tfor(register int i=1;i<n;++i){\n\t\tif(bb[i]==1)continue;\n\t\tnow+=1ll*aa[i]*vs[i];\n\t\tp.push((xy){aa[i],vs[i]});\n\t}\n\tmst-=now;\n\twhile(now){\n\t\tls=p.top();p.pop();\n\t\tb[++bs]=dv(ls);\n\t\tnow-=dv(ls);\n\t\tls.x>>=1;\n\t\tp.push(ls);\n\t}\n\twhile(p.size())p.pop();\n\tmst=-mst;\n\tif(mst<=0ll){printf(\"0\\n\");return;}//\u4e00\u5f00\u59cb\u5c31\u7b26\u5408\u8981\u6c42\uff0c\u4e0d\u7528\u64cd\u4f5c\uff0c\u4f46\u8981\u5224\u6389\n\ts=as+bs*2+1;\n\t//\u679a\u4e3e\u8981\u5220\u591a\u5c11\u82b1\u8d39\u4e3a2\u7684\u8fb9\uff0c\u5e76\u5f97\u5230\u7b54\u6848\n\tfor(register int i=0;i<=bs;++i){\n\t\tsum+=b[i];\n\t\twhile(sum-a[as]>=mst && as)sum-=a[as--];\n\t\tif(sum>=mst && as+i*2<s)s=as+i*2;\n\t}\n\tif(s==as+bs*2+1)s=-1;\n\tprintf(\"%d\\n\",s);\n}\nint main(){\n\tint t;\n\tcin>>t;\n\twhile(t--)doing();\n\treturn 0;\n}\n```",
        "postTime": 1636678762,
        "uid": 218376,
        "name": "IloveSurtr",
        "ccfLevel": 7,
        "title": "CF1399E2"
    },
    {
        "content": "\n\u672c\u9898\u89e3\u5df2\u5ba1\u8fc7\uff0c\u611f\u8c22\u5927\u4f6c\u6307\u6b63\u65f6\u95f4\u590d\u6742\u5ea6\n\n\n\u9898\u76ee\u94fe\u63a5\uff1a[https://www.luogu.com.cn/problem/CF1399E2](https://www.luogu.com.cn/problem/CF1399E2)\n\n\u6211\u4eec\u5148\u8ba1\u7b97\u51fa\u6bcf\u6761\u8fb9\u5bf9\u53f6\u5b50\u8282\u70b9\u7684\u8d21\u732e\u6b21\u6570\uff0c\u7528\u4e00\u904d**DFS**\u5c31\u80fd\u89e3\u51b3\n\n\u7136\u540e\u5f00\u4e2a\u7ed3\u6784\u4f53\u50a8\u5b58\u8fb9\u7684\u4fe1\u606f\uff1a\n1. \u5bf9\u53f6\u5b50\u8282\u70b9\u8d21\u732e\u6b21\u6570 **Vis**\n1. \u5f53\u524d\u6743\u503c **Wi**\n1. \u6539\u53d8\u7684\u82b1\u8d39 **Ci**\n\n\n\u4e00\u4e2a\u9519\u8bef\u7684\u8d2a\u5fc3\u5c31\u662f\u6309\u7167 **Vis\u00d7(Wi-Wi/2)\u00d71.0\u00f7Ci**\u6392\uff0c\u5f00\u4f18\u5148\u961f\u5217\uff0c\u7136\u540e\u4ece\u5927\u5230\u5c0f\u9009\u3002\u56e0\u4e3a\u53ef\u80fd\u540e\u9762\u6709\u66f4\u597d\u7684\u9009\u62e9\n\n\u8003\u8651\u5230**Ci<=2**\uff0c\u6211\u4eec\u5f00\u4e09\u4e2a\u4f18\u5148\u961f\u5217\uff0c\u4e00\u4e2a\u5b58\u6240\u6709**Ci**\u7684\u60c5\u51b5\uff0c\u4e00\u4e2a\u5f00**Ci=1**\u7684\uff0c\u4e00\u4e2a\u5f00**Ci=2**\u7684\u3002\u6309\u7167 **Vis\u00d7(Wi-Wi/2)\u00d71.0\u00f7Ci**\u6392\u3002\n\n\u5f53**Ci=1**\u7684\u4f18\u5148\u961f\u5217\u7684\u961f\u9996\u53ef\u4ee5\u76f4\u63a5\u5b8c\u6210\u8981\u6c42\uff0c\u5c31\u9009\u5b83\u540e**break**\u3002\u5f53**Ci=2**\u7684\u4f18\u5148\u961f\u5217\u7684\u961f\u9996\u53ef\u4ee5\u5b8c\u6210\u8981\u6c42\u5c31\u9009\u5b83\uff0c\u7136\u540e\u68c0\u67e5\u524d\u9762**Ci=1**\u7684\u9009\u8fc7\u7684\u5143\u7d20\u4e2d\u6709\u6ca1\u6709\u53ef\u4ee5\u653e\u5f03\u7684\u3002\n\n\u5982\u679c\u4e0d\u80fd\u76f4\u63a5\u5b8c\u6210\u8981\u6c42\uff0c\u6211\u4eec\u5c31\u76f4\u63a5\u627e**Ci**\u6240\u6709\u60c5\u51b5\u7684\u961f\u9996\u3002\n\n```\n\u56e0\u4e3a\u4e00\u6761\u8fb9\u5728\u8fdb\u884c\u4e00\u6b21\u64cd\u4f5c\u540e\u4f1a\u51cf\u534a\uff0c\u968f\u540e\u91cd\u65b0\u52a0\u5165\u4f18\u5148\u961f\u5217\u3002\n\u56e0\u6b64\u4e00\u6761\u8fb9\u6700\u574f\u4f1a\u52a0\u5165log\u6b21\uff0c\u56e0\u6b64\u603b\u590d\u6742\u5ea6\u6700\u5927\u4e3aO(n*logn*log(nlogn))\n\n```\n**\u611f\u8c22** [\u5927\u4f6c](https://www.luogu.com.cn/user/90610) **\u6307\u6b63**\n\nAC\u60c5\u51b5\uff1a[https://www.luogu.com.cn/record/37201605](https://www.luogu.com.cn/record/37201605)\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=100010;\nint t,n;\nlong long int S,qaq;\nint Head[N],cnt,Next[N*2],V[N*2],W[N*2],C[N*2],ovo[N*2],f[N*2];\nlong long int bef;\nstruct d{\n\tlong long int Wi,Ci,Vis;\n\tbool operator < (const d x) const {return ((Wi-Wi/2)*Vis*1.0/Ci)<((x.Wi-x.Wi/2)*x.Vis*1.0/x.Ci);}\n}qwq,ouo;\npriority_queue<d> Q,Q2,Q3;\nvoid add(int u,int v,int w,int c){\n\tV[cnt]=v;\n\tW[cnt]=w;\n\tC[cnt]=c;\n\tNext[cnt]=Head[u];\n\tHead[u]=cnt++;\n\treturn ;\n}\nint vis[N];\nvoid dfs(int u,int father){\n\tfor(int i=Head[u];i!=-1;i=Next[i]){\n\t\tif(V[i]!=father){\n\t\t\tdfs(V[i],u);\n\t\t\tovo[i]+=vis[V[i]];\n\t\t\tvis[u]+=vis[V[i]];\n\t\t}\n\t}\n\tif(vis[u]==0)vis[u]=1;\n}\nint main(){\n\tscanf(\"%d\",&t);\n\twhile(t--){\n\t\tmemset(Head,-1,sizeof(Head));\n\t\tmemset(ovo,0,sizeof(ovo));\n\t\tmemset(vis,0,sizeof(vis));\n\t\tcnt=0;qaq=0;bef=1e18;\n\t\tscanf(\"%d%lld\",&n,&S);\n\t\tfor(int i=1;i<=n-1;i++){\n\t\t\tint u,v,w,c;\n\t\t\tscanf(\"%d%d%d%d\",&u,&v,&w,&c);\n\t\t\tadd(u,v,w,c);\n\t\t\tadd(v,u,w,c);\n\t\t}\n\t\tdfs(1,0);\n\t\twhile(!Q.empty()){\n\t\t\tQ.pop();\n\t\t}\n\t\twhile(!Q2.empty()){\n\t\t\tQ2.pop();\n\t\t}\n\t\twhile(!Q3.empty()){\n\t\t\tQ3.pop();\n\t\t}\n\t\tfor(int i=0;i<=(2*n-3);i++){\n\t\t\tqwq.Wi=W[i];\n\t\t\tqwq.Vis=ovo[i];\n\t\t\tqaq+=qwq.Wi*qwq.Vis;\n\t\t\tqwq.Ci=C[i];\n\t\t\tif(C[i]==1){\n\t\t\t\tQ2.push(qwq);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tQ3.push(qwq);\n\t\t\t}\n\t\t\tQ.push(qwq);\n\t\t}\n\t\tqaq-=S;\n\t\tint ans=0;\n\t\twhile(!Q.empty()&&qaq>0){\n\t\t\tif(!Q2.empty()){\n\t\t\t\touo=Q2.top();\n\t\t\t\tif(qaq<=ouo.Vis*(ouo.Wi-ouo.Wi/2)){\n\t\t\t\t\tans+=ouo.Ci;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(!Q3.empty()){\n\t\t\t\touo=Q3.top();\n\t\t\t\tif(qaq+bef<=ouo.Vis*(ouo.Wi-ouo.Wi/2)){\n\t\t\t\t\tans+=1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(qaq<=ouo.Vis*(ouo.Wi-ouo.Wi/2)){\n\t\t\t\t\tans+=ouo.Ci;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tqwq=Q.top();\n\t\t\tans+=qwq.Ci;\n\t\t\tqaq-=(qwq.Wi-qwq.Wi/2)*qwq.Vis;\n\t\t\tbef=min(bef,(qwq.Wi-qwq.Wi/2)*qwq.Vis);\n\t\t\tqwq.Wi=qwq.Wi/2;\n\t\t\tif(qwq.Ci==1){\n\t\t\t\tQ2.pop();\n\t\t\t\tQ2.push(qwq);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tQ3.pop();\n\t\t\t\tQ3.push(qwq); \n\t\t\t}\n\t\t\tQ.pop();\n\t\t\tQ.push(qwq);\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n}\n```\n\n\n",
        "postTime": 1597721295,
        "uid": 104319,
        "name": "Why_not_use_longlong",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1399E2 \u3010Weights Division (hard version)\u3011"
    },
    {
        "content": "## CF1399E2 2200\n\n### \u9898\u76ee\u63cf\u8ff0\n\n\u7ed9\u51fa\u4e00\u4e2a\u7ed3\u70b9\u6570\u91cf\u4e3a $n$ \u7684\u8fb9\u5e26\u6743\u7684\u6709\u6839\u6811\uff0c\u6811\u7684\u6839\u7ed3\u70b9\u4e3a $1$\u3002\u4f60\u53ef\u4ee5\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\u3002\n\n* \u9009\u5b9a\u4efb\u610f\u4e00\u6761\u6743\u503c\u4e3a $w_i$ \u7684\u8fb9\uff0c\u4f7f $w_i \\gets \\lfloor \\frac{w_i}{2} \\rfloor$\uff0c\u82b1\u8d39\u4e3a $c_i$ \u4e14 $c_i \\in \\{1, 2\\}$\u3002\n\n\u5b9a\u4e49 $w(i,j)$ \u4e3a\u7ed3\u70b9 $i$ \u5230\u7ed3\u70b9 $j$ \u7684\u8def\u5f84\u8fb9\u6743\u548c\u3002\u5bf9\u4e8e\u6bcf\u7ec4\u6d4b\u8bd5\u6570\u636e\uff0c\u4f60\u9700\u8981\u56de\u7b54\u6700\u5c0f\u7684\u82b1\u8d39\uff0c\u4f7f\u5f97 $\\sum\\limits_{v\\in leaves}w(root,v)\\leq S$\uff0c\u5176\u4e2d $leaves$ \u4e3a\u53f6\u5b50\u7ed3\u70b9\u7f16\u53f7\u7684\u96c6\u5408\u3002\n\n\n\n### \u601d\u8def\n\n\u53ef\u4ee5\u7edf\u8ba1\u51fa\u6bcf\u4e00\u6761\u8fb9\u88ab\u7ecf\u8fc7\u7684\u6b21\u6570\uff0c\u5bf9\u4e8e\u4e00\u6761\u88ab\u7ecf\u8fc7\u4e86 $cnt$ \u6b21\u3001\u6743\u503c\u4e3a $w$ \u7684\u8fb9\u6765\u8bf4\uff0c\u64cd\u4f5c\u4e00\u6b21\u76f8\u5f53\u4e8e\u4f7f\u603b\u8fb9\u6743\u548c\u51cf\u5c11\u4e86 $(w-\\lfloor w/2 \\rfloor) * cnt$\uff0c\u53ef\u4ee5\u7528 pq \u7ef4\u62a4\u5bf9\u6bcf\u4e00\u6761\u64cd\u4f5c\u7684\u4ef7\u503c\uff0c\u5b8c\u6210\u4e00\u6b21\u64cd\u4f5c\u540e\u66f4\u65b0 $w$ \u503c\u3002\u4f46\u662f\uff0c\u5e76\u4e0d\u80fd\u76f4\u63a5\u9009\u62e9\u80fd\u4f7f\u603b\u8fb9\u6743\u51cf\u5c11\u66f4\u591a\u7684\u8fb9\u8fdb\u884c\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u8fb9\u7684\u64cd\u4f5c\u4ee3\u4ef7\u4e5f\u4e0d\u540c\u3002\u6240\u4ee5\uff0c\u7edf\u8ba1\u51fa\u5bf9\u4ee3\u4ef7\u4e3a $1$ \u7684\u8fb9\u64cd\u4f5c\u4e86 $i$ \u6b21\u540e\u548c\u5bf9\u4ee3\u4ef7\u4e3a $2$ \u7684\u8fb9\u64cd\u4f5c\u4e86 $i$ \u6b21\u540e\u5206\u522b\u7684\u6700\u5c0f\u8fb9\u6743\u548c\uff0c\u7136\u540e\u7528\u53cc\u6307\u9488\u7edf\u8ba1\u6700\u5c0f\u4ee3\u4ef7\u5373\u53ef\u3002\n\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int MAXN=2e6+10;\nint T,n,S,u[MAXN],v[MAXN],w[MAXN],c[MAXN],cnt[MAXN];\nint fa[MAXN],ans,alls,tmpw,ts[3][MAXN],l,r,maxx[MAXN];\nstruct node1\n{\n\tint v,w,c;\n};\nstruct node2\n{\n\tint v,w,cnt;\n\tbool operator <(const node2 &xx)const\n\t{\n\t\treturn xx.v>v;\n\t}\n}tmp,tmpp;\nvector<node1> a[MAXN];\npriority_queue<node2> pq[3];\nvoid dfs(int x,int f)\n{\n\tif(a[x].size()==1&&a[x][0].v==f)  cnt[x]=1;\n\tfor(int i=0;i<a[x].size();i++)\n\t{\n\t\tif(a[x][i].v!=f)\n\t\t{\n\t\t\tfa[a[x][i].v]=x;\n\t\t\tdfs(a[x][i].v,x);\n\t\t\tcnt[x]+=cnt[a[x][i].v];\n\t\t}\n\t}\n}\nint solve(int ty)\n{\n\tint cntt=0;\n\twhile(pq[ty].size()&&pq[ty].top().v!=0)\n\t{\n\t\ttmp=pq[ty].top();\n\t\tpq[ty].pop();\n\t\tcntt++;\n\t\tif(cntt!=0)  ts[ty][cntt]=ts[ty][cntt-1]+tmp.v;\n\t\tmaxx[ty]=cntt;\n\t\ttmpw=tmp.w/2;\n\t\tpq[ty].push((node2){(tmpw-tmpw/2)*tmp.cnt,tmpw,tmp.cnt});\n\t}\n}\nsigned main()\n{\n\tscanf(\"%lld\",&T);\n\twhile(T--)\n\t{\n\t\talls=0;\n\t\tscanf(\"%lld%lld\",&n,&S);\n\t\tfor(int i=1;i<=n-1;i++)\n\t\t{\n\t\t\tscanf(\"%lld%lld%lld%lld\",&u[i],&v[i],&w[i],&c[i]);\n\t\t\ta[u[i]].push_back((node1){v[i],w[i],c[i]});\n\t\t\ta[v[i]].push_back((node1){u[i],w[i],c[i]});\n\t\t}\n\t\tdfs(1,0);\n\t\twhile(pq[1].size())  pq[1].pop();\n\t\twhile(pq[2].size())  pq[2].pop();\n\t\tfor(int i=1;i<=n-1;i++)\n\t\t{\n\t\t\tif(fa[u[i]]==v[i])  swap(u[i],v[i]);\n\t\t\talls+=cnt[v[i]]*w[i];\n\t\t\tpq[c[i]].push((node2){(w[i]-w[i]/2)*cnt[v[i]],w[i],cnt[v[i]]});\n\t\t}\n\t\tif(alls<=S)\n\t\t{\n\t\t\tfor(int i=0;i<=n;i++)\n\t\t\t{\n\t\t\t\tmaxx[1]=maxx[2]=fa[i]=ts[1][i]=ts[2][i]=cnt[i]=0;\n\t\t\t\ta[i].clear();\n\t\t\t}\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\tsolve(1);\n\t\tsolve(2);\n\t\tans=LONG_LONG_MAX;\n\t\tr=0;\n\t\tfor(int l=maxx[1];l>=0;l--)\n\t\t{\n\t\t\twhile(alls-ts[1][l]-ts[2][r]<S&&r>0)  r--;\n\t\t\twhile(alls-ts[1][l]-ts[2][r]>S&&r<maxx[2])  r++;\n\t\t\tif(alls-ts[1][l]-ts[2][r]<=S)  ans=min(ans,l+2*r);\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t\tfor(int i=0;i<=n;i++)\n\t\t{\n\t\t\tmaxx[1]=maxx[2]=fa[i]=ts[1][i]=ts[2][i]=cnt[i]=0;\n\t\t\ta[i].clear();\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1663845483,
        "uid": 457247,
        "name": "zsyyyy",
        "ccfLevel": 6,
        "title": "CF1399E2\u9898\u89e3"
    },
    {
        "content": "\u6ce8\u610f\u4e00\u4e0b\u5f53\u9664\u6cd5\u4e3a\u5411\u4e0b\u53d6\u6574\uff0c\u6bcf\u6761\u8fb9\u6700\u591a\u88ab\u9664 logw \u6b21\u5c31\u4f1a\u53d8\u6210 0\u3002\n\n\u7136\u540e\u8fd8\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\u5f53\u4e00\u6761\u8fb9\u6743\u503c\u88ab\u9664\u4e86 2\uff0c\u8fd9\u6761\u8fb9\u4e0b\u9762\u7684\u6240\u6709\u53f6\u8282\u70b9\u7684\u8d21\u732e\u90fd\u4f1a\u51cf\u5c11\u76f8\u5e94\u7684\u6570\u91cf\u3002\n\n\u53ef\u4ee5\u7528\u4e00\u4e2a dfs \u6c42\u51fa\u6bcf\u6761\u8fb9\u88ab\u591a\u5c11\u4e2a\u53f6\u8282\u70b9\u8d70\u8fc7\uff0c\u8fd9\u4e2a\u4e0d\u8bb2\u3002\n\n\u7136\u540e\u6ce8\u610f\u5230\u8d39\u7528\u4e3a 1\uff0c2\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u4e24\u4e2a\u4f18\u5148\u961f\u5217\u3002\u5982\u679c\u53ea\u7528\u8d39\u7528 1\u5c31\u80fd\u89e3\u51b3\uff0c\u90a3\u4e48\u6211\u4eec\u80af\u5b9a\u9009\u62e9\u7528\u8d39\u7528 1 \u7684\u3002\u5426\u5219\uff0c\u6211\u4eec\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- \u5f53\u7528\u524d\u4e24\u5927\u7684\u8d39\u7528 1 \u7684\u8fb9\u7684\u8d21\u732e\u5927\u4e8e\u7528\u8d39\u7528 2 \u7684\u8fb9\u7684\u8d21\u732e\uff0c\u6211\u4eec\u9009\u62e9 **\u4e00\u6761\u8d39\u7528\u4e3a 1** \u7684\u8fb9\u7d2f\u8ba1\u8d21\u732e\u3002\n- \u5426\u5219\u4f7f\u7528\u8d39\u7528 2 \u7684\u8fb9\u7d2f\u8ba1\u8d21\u732e\u3002\n\n**\u6ce8\u610f\u6392\u5e8f\u4e0d\u80fd\u76f4\u63a5\u7528 $siz \\times val$ \u8fdb\u884c\u6392\u5e8f\uff0c\u53ea\u80fd\u4ee5\u6d88\u9664\u4e00\u6b21\u7684\u8d21\u732e\u8fdb\u884c\u6392\u5e8f**\n```cpp\nstruct Node{\n  int siz, val;\n  bool operator < (const Node &oth) const{\n    return ceil(val/2.0)*siz<ceil(oth.val/2.0)*oth.siz;\n  }\n};\ninline void init(){\n  tot = cnt = ans = 0;\n  memset(head,0,sizeof(head));\n  memset(sz,0,sizeof(sz));\n}\ninline int dfs(int u, int fa){\n  int cnt = 0; dep[u] = dep[fa]+1;\n  for(int i=head[u];i;i=edge[i].nxt){\n    int v = edge[i].v;\n    if (v==fa) continue;\n    cnt++;\n    sz[u] += dfs(v,u);\n  }\n  if (!cnt) sz[u] = 1;\n  return sz[u];\n}\nNode qt1,qt2,qs1,premin;\ninline void solve(){\n  n=read(), m = read();\n  init();\n  pq<Node> q1,q2;\n  For(i,1,n-1) a = read(), b = read(), c = read(), d = read(), add(a,b,c,d), add(b,a,c,d);\n  dfs(1,1);\n  For(i,1,tot){\n    int u = edge[i].u, v = edge[i].v, d = edge[i].d, c = edge[i].cn;\n    if (dep[u]>dep[v]) continue;\n    ans += sz[v]*d;\n    if (c==1) q1.push((Node){sz[v],d});\n    else q2.push((Node){sz[v],d});\n  }\n  while(ans>m){\n    if (q1.size() && ans-q1.top().siz*ceil(q1.top().val/2.0) <= m) {cnt++; break;}\n    qt1 = qt2 = qs1 = (Node){0,0};\n    if (q1.size()) qt1 = q1.top(), q1.pop();\n    if (q1.size()) qt2 = q1.top();\n    if (q2.size()) qs1 = q2.top();\n    if (qt1.val/2*qt1.siz>=qt2.val*qt2.siz){\n      if (qt1.siz*ceil(qt1.val/2.0) + qt1.siz*ceil((qt1.val/2)/2.0)<=qs1.siz*ceil(qs1.val/2.0)){\n        ans -= qs1.siz*ceil(qs1.val/2.0);\n        q1.push(qt1);\n        q2.pop();\n\n        if (qs1.val/2!=0) q2.push((Node){qs1.siz,qs1.val/2});\n        cnt+=2;\n      }else{\n        ans -= qt1.siz*ceil(qt1.val/2.0);\n        if (qt1.val/2!=0)q1.push((Node){qt1.siz,qt1.val/2});\n        cnt++;\n      }\n    }else{\n      if (qt1.siz*ceil(qt1.val/2.0)+qt2.siz*ceil(qt2.val/2.0)<=qs1.siz*ceil(qs1.val/2.0)){\n        ans -= qs1.siz*ceil(qs1.val/2.0);\n        q1.push(qt1);\n        q2.pop();\n        if (qs1.val/2!=0)q2.push((Node){qs1.siz,qs1.val/2});\n        cnt+=2;\n      }else{\n        ans -= qt1.siz*ceil(qt1.val/2.0);\n        if (qt1.val/2!=0)q1.push((Node){qt1.siz,qt1.val/2});\n        cnt++;\n      }\n    }\n  }\n  writeln(cnt);\n}\n```",
        "postTime": 1599769145,
        "uid": 219099,
        "name": "pocafup",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1399E2 \u3010Weights Division (hard version)\u3011"
    }
]