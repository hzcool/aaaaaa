[
    {
        "content": "[**\u539f\u9898\u94fe\u63a5**](https://www.luogu.com.cn/problem/CF1442F)\n\n\u7531\u4e8e\u9898\u76ee\u9898\u89e3\u5c11\uff0c\u4e14\u4e0d\u751a\u8be6\u7ec6\uff0c\u6240\u4ee5\u53c8\u5199\u4e86\u4e00\u7bc7\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u5982\u679c\u6211\u4eec\u5229\u7528\u539f\u672c\u7684 DAG\uff0c\u90a3\u4e48\u8be2\u95ee $\\{u\\}$ \u5c31\u53ef\u4ee5\u77e5\u9053 $\\operatorname{SG}(u)\\operatorname{xor}\\operatorname{SG}(x)$ \u662f\u5426\u4e3a $0$\u3002\u4f46\u662f\u7531\u4e8e\u4e0d\u540c\u8282\u70b9\u7684 $\\operatorname{SG}$ \u503c\u53ef\u80fd\u76f8\u540c\uff0c\u6240\u4ee5\u4ec5\u4ec5\u8fd9\u6837\u4e0d\u80fd\u627e\u5230 $x$\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u539f\u56fe\u8865\u5168\u6210\u5b8c\u5168 DAG\uff0c\u8fd9\u6837\u6240\u6709\u8282\u70b9 $\\operatorname{SG}$ \u4e92\u4e0d\u76f8\u540c\uff0c\u5c31\u53ef\u4ee5\u627e\u5230 $x$ \u4e86\u3002\n\n\u53ef\u60dc\u5929\u4e0d\u4ece\u4eba\u613f\uff0c\u53d1\u73b0\u8865\u5168\u6210\u5b8c\u5168 DAG \u7684\u82b1\u8d39\u8ba9\u4eba\u96be\u4ee5\u63a5\u53d7\u3002\u6240\u4ee5\u6362\u4e00\u79cd\u65b9\u5f0f\uff0c\u5229\u7528\u73af\u3002\u800c\u5728\u5f62\u5f62\u8272\u8272\u7684\u73af\u4e2d\uff0c\u81ea\u73af\u4fbf\u662f\u6700\u7b80\u5355\u7684\u4e00\u79cd\u4e86\uff0c\u8003\u8651\u4f7f\u7528\u81ea\u73af\u641e\u4e8b\u60c5\u3002\n\n\u6211\u4eec\u628a\u6574\u4e2a\u56fe\u5206\u6210\u4e24\u4e2a\u70b9\u96c6 $S_1,\\ S_2$\u3002\u5bf9\u4e8e $S_1$\uff0c\u6211\u4eec\u5c06\u5b83\u8865\u5168\u6210\u5b8c\u5168 DAG\uff0c\u5e76\u5220\u6389\u6240\u6709\u5411 $S_2$ \u7684\u8fde\u8fb9\uff08\u5373\u4e0d\u5b58\u5728\u8fb9 $i\\to j$\uff0c\u4f7f\u5f97 $i\\in S_1,j\\in S_2$\uff09\uff1b\u5bf9\u4e8e $S_2$\uff0c\u6211\u4eec\u5411\u5176\u4e2d\u6bcf\u4e2a\u70b9\u8fde\u81ea\u73af\uff0c\u5e76\u4e14\u4f7f\u5f97 $S_2$ \u4e2d\u7684\u4efb\u610f\u70b9\u76f4\u63a5\u8fde\u51fa\u53bb\u7684 $S_1$ \u4e2d\u7684\u70b9\u7684\u96c6\u5408\u4e24\u4e24\u4e0d\u540c\uff08\u5373\u8bbe $T_u=\\{v|\\exists u\n\\to v\\}\\cap S_1$\uff0c\u5bf9\u4e8e $\\forall u,v\\in S_2,u\\neq v,\\ T_u\\neq T_v$\uff09\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u8be2\u95ee $|S_1|$ \u6b21\uff0c\u6bcf\u6b21\u8be2\u95ee $S_1$ \u91cc\u9762\u7684\u4e00\u4e2a\u70b9 $u$\u3002\n\n* \u5982\u679c\u5f97\u5230\u4e86 `Lose`\uff0c\u8bf4\u660e $x$ \u5c31\u662f $u$\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u53d1\u73b0\u5982\u679c $x$ \u5728 $S_2$ \u4e2d\uff0c\u90a3\u4e48\u82e5\u662f\u5fc5\u80dc\u6001\uff0c\u5148\u624b\u5c31\u5fc5\u80dc\u4e86\uff1b\u800c\u82e5\u662f\u5fc5\u8d25\u6001\uff0c\u5148\u624b\u53ef\u4ee5\u8d70\u81ea\u73af\u800c\u628a\u8fd9\u4e2a\u72b6\u6001\u9001\u7ed9\u540e\u624b\u3002\u56e0\u6b64\u65e0\u8bba\u5982\u4f55\u5148\u624b\u5fc5\u4e0d\u4f1a\u8d25\u3002\u6240\u4ee5 $x\\in S_1$\u3002\u800c\u4e14\u6211\u4eec\u628a $S_1$ \u8865\u5168\u6210\u4e86\u5b8c\u5168 DAG\uff0c\u6240\u4ee5 $\\operatorname{SG}$ \u4e24\u4e24\u4e0d\u540c\u3002\u5f97\u5230 `Lose` \u8bf4\u660e $\\operatorname{SG}(u)\\operatorname{xor}\\operatorname{SG}(x)$\uff0c\u5373 $x=u$\u3002\n\n* \u5982\u679c\u5f97\u5230\u4e86 `Win`\uff0c\u8bf4\u660e $u\\in T_x$\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u9996\u5148\u77e5\u9053 $x\\in S_2$\uff0c\u5982\u679c\u5148\u624b\u5c06\u68cb\u5b50\u8d70\u5230\u67d0\u4e2a\u4e0d\u662f $u$ \u7684 $S_1$ \u4e2d\u8282\u70b9\uff0c\u90a3\u4e48\u53d1\u73b0\u6b64\u65f6 $\\operatorname{SG}$ \u5f02\u6216\u548c\u4e0d\u662f $0$\uff08\u56e0\u4e3a $S_1$ \u4e2d\u7684 $\\operatorname{SG}$ \u4e24\u4e24\u4e0d\u540c\uff09\uff0c\u662f\u5fc5\u80dc\u6001\uff0c\u6240\u4ee5\u5148\u624b\u5fc5\u7136\u4e0d\u4f1a\u8fd9\u4e48\u8d70\u3002\u800c\u56e0\u4e3a\u68cb\u5b50\u5728 $S_2$ \u4e2d\u65f6\u662f\u5fc5\u4e0d\u8d25\u6001\uff0c\u6240\u4ee5\u5148\u624b\u4e5f\u4e0d\u4f1a\u628a\u68cb\u5b50\u8d70\u5230 $S_2$ \u4e2d\u5176\u5b83\u8282\u70b9\u3002\u6240\u4ee5 `Win` \u53ea\u6709\u53ef\u80fd\u662f\u5148\u624b\u7b2c\u4e00\u6b65\u628a\u68cb\u5b50\u8d70\u5230 $u$\uff0c\u4f7f\u5f97 $\\operatorname{SG}$ \u5f02\u6216\u548c\u4e3a $0$\uff0c\u4e5f\u5c31\u662f\u8bf4 $u\\in T_x$\u3002\n\n* \u5982\u679c\u5f97\u5230\u4e86 `Draw`\uff0c\u540c\u7406\u5f97\u5230 $u\\notin T_x$\u3002\u6b64\u65f6\u53ea\u53ef\u80fd\u662f\u4e24\u4e2a\u4eba\u5728 $x$ \u4e0a\u4e0d\u538c\u5176\u70e6\u5730\u8d70\u81ea\u73af\u3002\u7ecf\u8fc7\u6240\u6709 $|S_1|$ \u6b21\u8be2\u95ee\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230 $T_x$\u3002\u53c8\u56e0\u4e3a\u6211\u4eec\u6784\u9020\u4e86\u4e00\u4e2a $S_2$ \u4e2d $T_u$ \u4e24\u4e24\u4e0d\u540c\u7684\u56fe\uff0c\u6240\u4ee5\u53ef\u4ee5\u786e\u5b9a $x$\uff0c\u5927\u529f\u544a\u6210\uff01\n\n\u6700\u540e\uff0c$S_1$ \u53ef\u4ee5\u53d6\u539f\u56fe\u62d3\u6251\u5e8f\u7684\u6700\u540e $20$ \u4e2a\u70b9\uff0c\u53d1\u73b0\u8fd9\u6837\u521a\u597d\u53ef\u4ee5\u6ee1\u8db3\u8981\u6c42\u3002\n\n\u8fd9\u9898\u7684\u5b9e\u73b0\u611f\u89c9\u8fd8\u662f\u53ef\u4ee5\u8bf4\u4e00\u4e0b\u7684\u3002\u9996\u5148\u62d3\u6251\u6392\u5e8f\uff0c\u9009\u51fa $S_1$\uff0c\u7136\u540e\u628a $S_1$ \u4e2d\u8be5\u8fde\u7684\u8fb9\u8fde\uff0c\u8be5\u5220\u7684\u8fb9\u5220\uff0c\u4f7f\u5176\u5f62\u6210\u5b8c\u5168 DAG\u3002\n\n\u7136\u540e\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $u\\in S_2$\uff0c\u5148\u6c42\u51fa $T_u$\u3002\u73b0\u5728\u60f3\u65b9\u6cd5\u5c3d\u91cf\u8282\u7701\u5730\u8ba9 $T_u$ \u4e24\u4e24\u4e0d\u540c\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a $u$\uff0c\u6309\u7167 $\\operatorname{popcount}$ \u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u4e00\u4e2a $mask$\uff0c\u8868\u793a\u6539\u53d8\u7684\u5143\u7d20\uff0c\u5982\u679c $T_u\\operatorname{xor}mask$ \u8fd8\u6ca1\u6709\u7528\u8fc7\uff0c\u5c31 $T'_u\\gets T_u\\operatorname{xor}mask$\uff0c\u5426\u5219\u7ee7\u7eed\u679a\u4e3e\u3002\n\n\u7136\u540e\u7b80\u5355\u8be2\u95ee $S_1$ \u4e2d\u6bcf\u4e2a\u70b9\u5c31\u884c\u4e86\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\u81ea\u8ba4\u4e3a\u662f\u6e05\u6670\u6613\u61c2\u7684\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n/* \u7701\u7565\u4e00\u767e\u591a\u884c\u7684\u5feb\u8bfb\u5feb\u5199  */\n\nint n,m,T,D;\nstruct Edge{ int to,nxt; }e[100005];\nint cnt,head[1005];\ninline void addEdge(int u,int v)\n\t{ e[++cnt]=(Edge){v,head[u]},head[u]=cnt; }\n\n// \u4ea4\u4e92\u7528\u7684\u51fd\u6570\nvector<tuple<char,int,int>> mdf;\ninline void adde(int u,int v) { mdf.emplace_back('+',u,v); }\ninline void dele(int u,int v) { mdf.emplace_back('-',u,v); }\ninline int ask(const vector<int> &V)\n{\n\tstatic char s[10];\n\tqout.writesp('?',V.size());\n\tfor(auto &i: V) qout<<i<<' ';\n\tqout<<'\\n',fflush(stdout);\n\tqin>>s;\n\tif(s[0]=='W') return 1;\n\telse if(s[0]=='L') return 0;\n\telse if(s[0]=='D') return -1;\n\telse return 114514;\n}\ninline bool report(int x)\n{\n\tstatic char s[10];\n\tqout<<\"! \"<<x<<'\\n',fflush(stdout);\n\treturn qin>>s,s[0]=='C';\n}\n\nbool isa[1005],has[1005][1005];\nint tp[1005],pos[1005],deg[1005],id[1005],rev[1005],tos[1005];\nvoid topo() // \u62d3\u6251\u6392\u5e8f\n{\n\tint cnt=0;D=min(n-1,20); \n\tqueue<int> q;\n\tvector<int> vec;\n\tfor(int i=1;i<=n;i++) if(!deg[i]) q.push(i);\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();\n\t\tfor(int i=head[u],v;v=e[i].to;i=e[i].nxt)\n\t\t\tif(!--deg[v]) q.push(v);\n\t\ttp[pos[u]=++cnt]=u,q.pop();\n\t}\n\tcnt=0;\n\tfor(int i=n-D+1;i<=n;i++) isa[tp[i]]=true,rev[id[tp[i]]=cnt++]=tp[i];\n}\nvoid process1() // \u5904\u7406 S_1 \u4e2d\u8fde\u8fb9\n{\n\tfor(int u=1;u<=n;u++)\n\t{\n\t\tif(!isa[u]) continue;\n\t\tfor(int i=head[u],v;v=e[i].to;i=e[i].nxt)\n\t\t\tif(!isa[v] || pos[v]<pos[u]) dele(u,v);\n\t\tfor(int i=pos[u]+1,v;i<=n;i++)\n\t\t\tif(!has[u][tp[i]]) adde(u,tp[i]);\n\t}\n}\nvoid process2() // \u5904\u7406 S_2 \u4e2d\u8fde\u8fb9\n{\n\tstatic bool vis[1500005];\n\tvector<int> vec{0};\n\tvis[0]=true;\n\tfor(int i=0;i<vec.size();i++)\n\t{\n\t\tint S=vec[i],T;\n\t\tfor(int i=0;i<D;i++)\n\t\t\tif(!vis[T=S^(1<<i)])\n\t\t\t\tvec.push_back(T),vis[T]=true;\n\t}\n\tfor(int u=1;u<=n;u++)\n\t{\n\t\tif(isa[u]) continue;\n\t\tadde(u,u);\n\t\tint S=0;\n\t\tfor(int i=head[u],v;v=e[i].to;i=e[i].nxt)\n\t\t\tif(isa[v]) S|=1<<id[v];\n\t\tfor(auto &mask: vec)\n\t\t{\n\t\t\tif(!vis[S^mask]) continue;\n\t\t\tfor(int i=0;i<D;i++)\n\t\t\t{\n\t\t\t\tif(!(mask&(1<<i))) continue;\n\t\t\t\tif(S&(1<<i)) dele(u,rev[i]);\n\t\t\t\telse adde(u,rev[i]);\n\t\t\t}\n\t\t\tvis[tos[u]=S^mask]=false;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nint main()\n{\n\tqin>>n>>m>>T;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint x,y;qin>>x>>y;\n\t\taddEdge(x,y),has[x][y]=true,deg[y]++;\n\t}\n\ttopo(),process1(),process2();\n\tqout.writeln(mdf.size());\n\tfor(auto &i: mdf)\n\t\tqout<<get<0>(i)<<' '<<get<1>(i)<<' '<<get<2>(i)<<'\\n',fflush(stdout);\n\twhile(T--)\n\t{\n\t\tint ans=0,S=0;\n\t\tfor(int i=0;i<D;i++)\n\t\t{\n\t\t\tint res=ask(vector<int>{rev[i]});\n\t\t\tif(res==0) { ans=rev[i];break; }\n\t\t\telse if(res==1) S|=1<<i;\n\t\t}\n\t\tif(!ans)\n\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\tif(!isa[i] && tos[i]==S) { ans=i;break; }\n\t\tif(!report(ans)) return puts(\"Oh shit!\"),0;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1657191893,
        "uid": 279800,
        "name": "ExplodingKonjac",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3\u3011CF1442F Differentiating Games"
    },
    {
        "content": "[\u5ba3\u4f20\uff0c\u6709\u53c2\u8003\u4ee3\u7801](https://www.cnblogs.com/2005lz/p/14725659.html)\n\n\u4ee5\u4e0b\u5185\u5bb9\u642c\u8fd0\u81eacf\u5b98\u65b9\u9898\u89e3\n\n\u771f\u662f\u6bd2\u7624\u3002\n\n\u5148\u8003\u8651\u5bf9\u4e8e\u4e00\u5f20\u7a7a\u56fe\u600e\u4e48\u505a\u3002\n\n\u5982\u679c\u6700\u540e\u662f\u4e00\u5f20\u6709\u5411\u65e0\u73af\u56fe\uff0c\u5219\u6bcf\u4e00\u4e2a\u70b9\u6709\u552f\u4e00\u7684SG\u51fd\u6570\u503c\u3002\u901a\u8fc7\u5b34\u6216\u8005\u662f\u8f93\u7684\u8be2\u95ee\u53ea\u80fd\u786e\u5b9a\u76ee\u6807\u8282\u70b9\u7684SG\u51fd\u6570\u503c\uff0c\u5bf9\u4e8eSG\u51fd\u6570\u503c\u76f8\u540c\u7684\u70b9\u4fbf\u65e0\u80fd\u4e3a\u529b\u3002\n\n\u4e8e\u662f\u9700\u8981$O(n^2)$\u6761\u8fb9\u4f7f\u5f97\u6bcf\u4e00\u4e2a\u70b9\u7684SG\u503c\u5747\u4e0d\u540c\uff0c\u800c\u4e14\u6bcf\u6b21\u8be2\u95ee\u53ea\u80fd\u6392\u9664\u4e00\u4e2a\u70b9\uff0c\u5355\u4e2a\u9636\u6bb5\u9700\u8981$O(n)$\u6b21\u8be2\u95ee\uff0c\u8fd9\u6837\u65e0\u8bba\u5982\u4f55\u90fd\u662f\u65e0\u6cd5\u901a\u8fc7\u7684\u3002\n\n\u4e8e\u662f\u9700\u8981\u5229\u7528\u73af\u7684\u6027\u8d28\u3002\n\n\u4f46\u662f\u6709\u73af\u65f6\u4e0d\u5bb9\u6613\u5224\u65ad\u6e38\u620f\u7684\u7ed3\u679c\u3002\n\n\u8003\u8651\u5230\u6709\u4e00\u4e2a\u70b9\u6709\u8fde\u5411\u81ea\u5df1\u7684\u8fb9\u5e76\u4e14\u8be5\u70b9\u4e0a\u6709\u81f3\u5c11\u4e00\u679a\u68cb\u5b50\uff0c\u5219\u5148\u624b\u4e0d\u4f1a\u5931\u8d25\uff08\u6ca1\u6709\u5fc5\u80dc\u7b56\u7565\u65f6\uff0c\u64cd\u4f5c\u65b9\u53ef\u4ee5\u6cbf\u81ea\u73af\u79fb\u52a8\u5df2\u4fdd\u8bc1\u4e0d\u8d25\uff09\u3002\n\n\u8003\u8651\u5c06\u70b9\u96c6\u5212\u5206\u4e3a$S_1$\u548c$S_2$\uff0c\u4e0d\u5b58\u5728\u8fb9$e:i->j$\u540c\u65f6\u4f7f$i \\in S_1$\u548c$j \\in S_2$\u6210\u7acb\uff0c\u4e14\uff1a\n\n$$\\underset{i \\in S_1}{\\text{mex}} \\space SG_i=|S_1|+1$$\n\n\u8bbe$j \\in S_2$\u51fa\u8fb9\u8fde\u5411\u70b9\u4e0e$S_1$\u4ea4\u96c6\u4e3a$T_j$\uff0c\u4e14$T_j$\u4e92\u4e0d\u76f8\u540c\uff0c$S_2$\u4e2d\u6240\u6709\u70b9\u5411\u81ea\u5df1\u6709\u8fb9\u3002\n\n\u7136\u540e\uff0c\u725b\u903c\u7684\u6765\u4e86\uff0c\u53ea\u9700\u8981\u505a$|S_1|$\u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u4e00\u4e2a\u70b9\uff0c\u4fbf\u53ef\u786e\u5b9a\u7b54\u6848\u3002\n\n\u5047\u8bbe\u7b54\u6848\u662f\u70b9$x$\u3002\n\n\u5982\u679c\u8be2\u95ee\u70b9$i$\u65f6\u5148\u624b\u5fc5\u8d25\uff0c\u8bf4\u660e$x \\notin S_2$\uff08\u539f\u56e0\u5982\u4e0a\uff09\uff0c\u7531$SG_i \\space \\text{xor} \\space SG_x=0$\u77e5$x=i$\u3002\n\n\u5982\u679c\u6ca1\u6709\u5148\u624b\u5fc5\u8d25\u7684\u60c5\u51b5\uff0c\u5219\u5e73\u5c40\u70b9\u96c6\u5373\u4e3a$T_x$\uff01\u8bc1\u660e\u663e\u7136\u3002\n\n\u53ea\u9700\u53d6$|S_1|=20$\uff0c\u8fde\u6700\u5c11\u7684\u8fb9\u4f7f$T_j$\u4e92\u4e0d\u76f8\u540c\u5373\u53ef\u3002\n\n\u975e\u7a7a\u56fe\u7c7b\u4f3c\uff0c\u7528\u62d3\u6251\u5e8f\u627e$S_1$\uff0c\u7136\u540e\u6539\u53d8\u6700\u5c11\u7684\u8fb9\u4f7f$T_j$\u4e92\u4e0d\u76f8\u540c\uff08\u53ef\u4ee5\u5220\u8fb9\uff09\u5373\u53ef\u3002\n\n\u7a0d\u52a0\u8ba1\u7b97\u5f97\u6539\u53d8\u8fb9\u6570\u5728$4000$\u4ee5\u5185\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002",
        "postTime": 1620225007,
        "uid": 60202,
        "name": "csyakuoi",
        "ccfLevel": 0,
        "title": "CF1442F"
    }
]