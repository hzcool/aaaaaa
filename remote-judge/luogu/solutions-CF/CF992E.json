[
    {
        "content": "[\u4f20\u9001\u95e8 qwq](https://www.luogu.com.cn/problem/CF992E)\n\n\u7ebf\u6bb5\u6811\u9898\u89e3\u3002\n\n\u601d\u8def\u8fd8\u7b97\u53ef\u4ee5\uff0c\u91cd\u8981\u4e4b\u5904\u5728\u4e8e\u610f\u8bc6\u5230\u4e00\u79cd\u770b\u4f3c\u66b4\u529b\u7684\u505a\u6cd5\u7531\u4e8e\u67d0\u4e9b\u6027\u8d28\u800c\u53d8\u5f97\u6b63\u786e\u3002\n\n\u9996\u5148\u60f3\u6700\u539f\u59cb\u7684\u66b4\u529b\u3002\u76f4\u63a5\u7ef4\u62a4\u539f\u6570\u7ec4 $a$ \u548c\u524d\u7f00\u6570\u7ec4 $s$\uff0c\u6bcf\u6b21\u4fee\u6539\u7684\u65f6\u5019\u5c31\u66b4\u529b\u5728 $a$ \u7684\u4e00\u4e2a\u5355\u70b9\u548c $s$ \u7684\u4e00\u4e2a\u533a\u95f4\u4e0a\u6539\u503c\u3002\u67e5\u8be2\u7684\u65f6\u5019\u66b4\u529b\u679a\u4e3e\u6240\u6709\u7684 $i$\uff0c\u5224\u65ad $a_i-s_{i-1}$ \u662f\u5426\u4e3a $0$\u3002\n\n\u5148\u8003\u8651\u8fd9\u6837\u4e00\u4ef6\u4e8b\uff1a\u5bf9\u4e8e\u6240\u6709\u7684 $i$\uff0c\u6ee1\u8db3\u6761\u4ef6\u7684\u4e00\u5b9a\u4e0d\u8d85\u8fc7 $log s_n$ \u4e2a\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u82e5 $i$ \u6ee1\u8db3\u6761\u4ef6\uff0c\u5373 $a_i-s_{i-1}\\ge0$\uff0c\u53ef\u5f97 $s_i>=2s_{i-1}$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u6709\u4e00\u4e2a $i$ \u6ee1\u8db3\u6761\u4ef6\uff0c$s$ \u503c\u5c31\u4f1a\u7ffb\u500d\uff0c\u90a3\u4e48\u603b\u5171\u7684\u6ee1\u8db3\u6761\u4ef6\u7684 $i$ \u7684\u4e2a\u6570\u4e0d\u8d85\u8fc7 $log s_n$\u3002\u5148\u8bb0\u4f4f\u8fd9\u6761\u6027\u8d28\uff0c\u540e\u9762\u4f1a\u7528\u3002\n\n\u8003\u8651\u4f18\u5316\u3002\u7531\u4e8e\u6d89\u53ca\u5230\u5927\u91cf\u533a\u95f4\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u4e0d\u59a8\u5efa\u7acb\u7ebf\u6bb5\u6811\u7ef4\u62a4 $a_i-s_{i-1}$ \u7684\u533a\u95f4 $max$\u3002\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u505a\uff1f\u56e0\u4e3a\u67e5\u8be2\u7684\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u9012\u5f52\u533a\u95f4 $max$ \u5927\u4e8e\u7b49\u4e8e $0$ \u7684\u533a\u95f4\uff0c\u7ed3\u5408\u4e0a\u9762\u8bf4\u7684\u6027\u8d28\uff0c\u6211\u4eec\u4e00\u5171\u627e\u7684\u7684\u53f6\u5b50\u603b\u6570\u4e0d\u4f1a\u8d85\u8fc7 $log s_n$\uff0c\u590d\u6742\u5ea6\u6b63\u786e\u3002\n\n\u518d\u60f3\u5982\u4f55\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c\u3002\u6211\u4eec\u5047\u8bbe\u628a $a_x$ \u589e\u52a0\u4e86 $y$\uff08\u6ce8\u610f\u9898\u76ee\u8bf4\u7684\u662f\u4fee\u6539\uff0c\u8fd9\u91cc\u8bf4\u7684\u662f\u589e\u52a0\uff09\uff0c\u9996\u5148 $x$ \u4f4d\u7f6e\u5355\u70b9\u52a0 $y$ \u4e0d\u5fc5\u591a\u8bf4\u3002\u518d\u8003\u8651\u54ea\u4e9b $s$ \u503c\u53d7\u5230\u4e86\u5f71\u54cd\uff1a\u5e94\u8be5\u662f\u533a\u95f4 $[x+1,n]$\u3002\u53c8\u56e0\u4e3a $a_i-s_{i-1}$ \u7684 $s$ \u524d\u9762\u5e26\u4e2a\u51cf\u53f7\uff0c\u6211\u4eec\u5bf9\u533a\u95f4 $[x+1,n]$ \u8fdb\u884c\u533a\u95f4\u52a0 $-y$\u3002\uff08\u6ce8\u610f $x=n$ \u9020\u6210\u8d8a\u754c\uff09\u3002\n\n\u6572\u5b8c\u9898\u89e3\u4e86 rmj \u8fd8\u5904\u4e8e\u7206\u70b8\u72b6\u6001\uff0c\u4f46\u662f\u5728 CF \u4e0a\u5df2\u7ecf\u901a\u8fc7\uff0c\u4ee3\u7801\u53ef\u4ee5\u4fdd\u8bc1\u6b63\u786e\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nint n,m;\nint read(){\n\tint ss=0,ww=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){\n\t\tif(ch=='-')\n\t\t\tww=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9'){\n\t\tss=ss*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn ss*ww;\n}\nconst int N=200010;\nint a[N],s[N];\nstruct ST{\n\tint tag;\n\tint maxx;\n}st[N*4];\nvoid update(int root,int l,int r){\n\tst[root].maxx=max(st[root*2].maxx,st[root*2+1].maxx);\n}\nvoid push_down(int root,int l,int r){\n\tint k=st[root].tag;\n\tst[root].tag=0;\n\tint mid=(l+r)/2;\n\tst[root*2].tag+=k;\n\tst[root*2+1].tag+=k;\n\tst[root*2].maxx+=k;\n\tst[root*2+1].maxx+=k;\n}\nvoid build(int root,int l,int r){\n\tif(l==r){\n\t\tst[root].maxx=a[l]-s[l-1];\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tbuild(root*2,l,mid);\n\tbuild(root*2+1,mid+1,r);\n\tupdate(root,l,r);\n}\nvoid add(int root,int l,int r,int x,int y,int k){\n\tif(l>=x&&r<=y){\n\t\tst[root].maxx+=k;\n\t\tst[root].tag+=k;\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tif(st[root].tag)\n\t\tpush_down(root,l,r);\n\tif(mid>=x)\n\t\tadd(root*2,l,mid,x,y,k);\n\tif(mid+1<=y)\n\t\tadd(root*2+1,mid+1,r,x,y,k);\n\tupdate(root,l,r);\n}\nint res;\nvoid ask(int root,int l,int r){\n\tif(res!=-1)\n\t\treturn;\n\tif(l==r){\n\t\tif(st[root].maxx==0)\n\t\t\tres=l;\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tif(st[root].tag)\n\t\tpush_down(root,l,r);\n\tif(st[root*2].maxx>=0)\n\t\task(root*2,l,mid);\n\tif(st[root*2+1].maxx>=0)\n\t\task(root*2+1,mid+1,r);\n}\nsigned main(){\n\tn=read();\n\tm=read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i]=read();\n\t\ts[i]=a[i]+s[i-1];\n\t}\n\tbuild(1,1,n);\n\tfor(int i=1;i<=m;i++){\n\t\tint x,k;\n\t\tx=read();\n\t\tk=read();\n\t\tint y=k-a[x];\n\t\ta[x]=k;\n\t\tadd(1,1,n,x,x,y);\n\t\tif(x!=n)\n\t\t\tadd(1,1,n,x+1,n,-y);\n\t\tres=-1;\n\t\task(1,1,n);\n\t\tprintf(\"%lld\\n\",res);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1651133569,
        "uid": 140360,
        "name": "LKawaii",
        "ccfLevel": 0,
        "title": "CF992E \u9898\u89e3"
    },
    {
        "content": "## \u89e3\u6790\n\n### \u89e3\u6cd5\u4e00\n\n\u9898\u610f\u5373\u8ba9\u6211\u4eec\u6c42 $a_i=s_{i-1}$ \u7684\u4f4d\u7f6e\uff0c\u5176\u4e2d $s_i$ \u8868\u793a\u524d\u7f00\u548c\n\n\u4ec5\u8003\u8651**\u975e\u96f6**\u4f4d\u7f6e\uff0c\u4e0d\u96be\u53d1\u73b0\u8fd9\u6837\u7684\u4f4d\u7f6e\u4e0d\u4f1a\u8d85\u8fc7 $\\log a$ \u4e2a\uff1b\u56e0\u4e3a\u82e5\u6709\u4e00\u5904\u6ee1\u8db3\u8981\u6c42\u7684 $a_i$\uff0c\u90a3\u4e48 $s_i$ \u76f8\u6bd4 $s_{i-1}$ \u5fc5\u5b9a\u7ffb\u500d\n\n\u8fd9\u91cc\u8bb2\u4e00\u79cd\u7ebf\u6bb5\u6811\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u7ef4\u62a4\u533a\u95f4\u6700\u5927\u7684 $a_i-s_{i-1}$\u3002\u67e5\u8be2\u65f6\u5f00\u59cb\u5148\u548c\u666e\u901a\u7ebf\u6bb5\u6811\u4e00\u6837 \u201c\u5207\u5206\u201d \u533a\u95f4\uff1b\u76f4\u5230\u67e5\u8be2\u7684\u533a\u95f4\u548c\u5f53\u524d\u7ebf\u6bb5\u6811\u7ed3\u70b9\u7ba1\u8f96\u7684\u533a\u95f4\u4e00\u81f4\u65f6\uff0c\u76f4\u63a5\u66b4\u529b\u9012\u5f52 $a_i-s_{i-1}\\geq 0$ \u7684\u5de6\u53f3\u5b50\u6811\uff1b\u4e00\u6b21\u67e5\u8be2\u7684\u590d\u6742\u5ea6 $\\Theta(\\log n\\log a)$\u3002\u4fee\u6539\u65f6\u5c31\u76f8\u5f53\u4e8e\u533a\u95f4\u4fee\u6539\n\n\u81f3\u4e8e\u4e3a\u96f6\u7684\u4f4d\u7f6e\u7684\u8d21\u732e\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5728 pushup \u65f6\u5ffd\u7565\n\n\u63a5\u7740\u8003\u8651\u4e3a\u96f6\u7684\u4f4d\u7f6e\u4ec0\u4e48\u65f6\u5019\u80fd\u4ea7\u751f\u8d21\u732e\u3002\u53ef\u4ee5\u53d1\u73b0 $a_i=0$ \u80fd\u6210\u4e3a\u7b54\u6848\u5f53\u4e14\u4ec5\u5f53 $a_k=0, 0\\leq k<i$\u3002\u53d1\u73b0\u82e5\u96f6\u7684\u4f4d\u7f6e\u80fd\u4ea7\u751f\u8d21\u732e\uff0c\u90a3\u4e48 $a_0$ \u4e5f\u4e00\u5b9a\u80fd\u4ea7\u751f\u8d21\u732e\uff1b\u4e8e\u662f\u6211\u4eec\u76f4\u63a5\u68c0\u67e5 $a_0$ \u662f\u5426\u4e3a $0$ \u5373\u53ef\n\n### \u89e3\u6cd5\u4e8c\n\n\uff08\u5373\u793e\u8bba $\\texttt{Solution III}$\uff09\n\n\u8003\u8651\u6309\u6bcf\u4e2a\u6570\u7684\u6700\u9ad8\u4e8c\u8fdb\u5236\u4f4d\u5bf9\u6570\u5b57\u5206\u7ec4\uff0c\u5171\u5206\u6210 $\\log a$ \u4efd\uff0c\u5e76\u4e14\u6bcf\u7ec4\u5185\u6309\u539f\u5e8f\u5217\u7684\u4e0b\u6807\u987a\u5e8f\u6392\u5e8f\n\n\u4e0d\u96be\u53d1\u73b0\u6bcf\u7ec4\u4ec5\u6709\u4e24\u4e2a\u6570\u2014\u2014\u4e14\u4e00\u5b9a\u662f\u5f00\u5934\u7684\u4e24\u4e2a\u6570\u2014\u2014\u53ef\u4ee5\u4f5c\u4e3a\u7b54\u6848\uff1b\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u6570\u7684\u548c\u4e00\u5b9a\u5927\u4e8e\u8be5\u7ec4\u5185\u7684\u6240\u6709\u5176\u5b83\u6570\n\n\u56e0\u6b64\u6709\u4e00\u4e2a\u6bd4\u8f83 naive \u7684\u505a\u6cd5\uff1a\n\n\u6bcf\u6b21\u8be2\u95ee\u65f6\uff0c\u68c0\u67e5\u6bcf\u7ec4\u5f00\u5934\u7684\u4e24\u4e2a\u6570\u662f\u5426\u6ee1\u8db3\u8981\u6c42\uff1b\u68c0\u67e5\u76f4\u63a5\u7ebf\u6bb5\u6811\u67e5\u8be2\u524d\u7f00\u548c\u5373\u53ef\uff1b\u8fd9\u6837\u5355\u6b21\u67e5\u8be2\u590d\u6742\u5ea6\u5c31\u662f $\\Theta(\\log a\\log n)$\u3002\u81f3\u4e8e\u4fee\u6539\uff0c\u76f4\u63a5\u7528 `set` \u7ef4\u62a4\u6bcf\u7ec4\u5143\u7d20\u7684\u987a\u5e8f\u5373\u53ef\uff1b\u5355\u6b21\u4fee\u6539\u7684\u590d\u6742\u5ea6\u5c31\u662f $\\Theta(\\log a+\\log n)$ \u7684\uff08\u5176\u4e2d\u7684 $\\log a$ \u662f\u56e0\u4e3a\u8981\u627e\u5230\u6700\u9ad8\u7684\u4e8c\u8fdb\u5236\u4f4d\uff09\n\n\u53d1\u73b0\u6bcf\u6b21\u8be2\u95ee\u65f6\u5bf9\u6bcf\u4e2a\u53ef\u80fd\u6210\u4e3a\u7b54\u6848\u7684\u5143\u7d20\u90fd\u67e5\u8be2\u4e00\u6b21\u524d\u7f00\u548c\u5f88\u6d6a\u8d39\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5b58\u4e0b\u6bcf\u7ec4\u5f00\u5934\u4e24\u4e2a\u6570\u7684\u524d\u7f00\u548c\uff0c\u8fd9\u6837\u5c31\u53ea\u5728\u4fee\u6539\u65f6\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\uff08\u81f3\u591a\u4e24\u4e2a\u5143\u7d20\u7684\uff09\u524d\u7f00\u548c\u4e86\u3002\u8fd9\u6837\u505a\u7684\u5355\u6b21\u67e5\u8be2\u590d\u6742\u5ea6\u662f $\\Theta(\\log a)$ \u7684\uff0c\u5355\u6b21\u4fee\u6539\u590d\u6742\u5ea6\u662f $\\Theta(\\log a+\\log n)$ \u7684\n\n## CODE\n\n### \u89e3\u6cd5\u4e00\n\n\u5b9e\u73b0\u53ef\u80fd\u6709\u4e9b\u70c2\uff0c\u4ec5\u4f9b\u53c2\u8003 \\kk\n\n\u5176\u4e2d\u9009\u62e9\u5ffd\u7565\u4e3a\u96f6\u7684\u4f4d\u7f6e\u7684\u8d21\u732e\u65f6\uff0c\u5176\u5b9e\u53ea\u7528\u5728\u53f6\u7ed3\u70b9\u7684\u7236\u4eb2\u5904\u5224\u65ad\u4e00\u6b21\u5373\u53ef\uff1b\u4e0d\u9700\u8981\u50cf\u4e0b\u9762\u7684\u5b9e\u73b0\u90a3\u6837\u5728\u6240\u6709\u7ebf\u6bb5\u6811\u7ed3\u70b9\u5904\u90fd\u5224\u65ad\u4e00\u6b21\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#define ll long long\n#define inf 0x3f3f3f3f3f3f3f3f\nusing std::max;\n\nconst int MAXN =2e5+20, MAXT =1<<19;\n\n/*------------------------------IO------------------------------*/\n\nint read(){\n\tint x =0; char c =getchar(); bool f =0;\n\twhile(c < '0' || c > '9') (c == '-') ? f =1, c =getchar() : c =getchar();\n\twhile(c >= '0' && c <= '9') x =(x<<1)+(x<<3)+(48^c), c =getchar();\n\treturn (f) ? -x : x;\n}\n\nvoid write(const int &x){\n\tif(x/10)\n\t\twrite(x/10);\n\tputchar('0'+x%10);\n}\n\n/*------------------------------Seg------------------------------*/\n\nint N =1;\nll mx[MAXT], sum[MAXT];\nll tag_mx[MAXT], tag_sum[MAXT];\n\ninline void pushdown(const int &x){\n\tif(tag_mx[x]){\n\t\tif(mx[x<<1] != -inf) mx[x<<1] +=tag_mx[x];\n\t\tif(mx[x<<1^1] != -inf) mx[x<<1^1] +=tag_mx[x];\n\t\ttag_mx[x<<1] +=tag_mx[x], tag_mx[x<<1^1] +=tag_mx[x];\n\t\ttag_mx[x] =0;\n\t}\n\tif(tag_sum[x]){\n\t\tsum[x<<1] +=tag_sum[x], sum[x<<1^1] +=tag_sum[x];\n\t\ttag_sum[x<<1] +=tag_sum[x]/2, tag_sum[x<<1^1] +=tag_sum[x]/2;\n\t\ttag_sum[x] =0;\n\t}\n}\n\ninline void pushup(const int &x){\n\t// \u5ffd\u7565 a_i=0 \u5904\u7684\u503c -V //\n\tmx[x] =max((sum[x<<1] == 0) ? -inf : mx[x<<1], (sum[x<<1^1] == 0) ? -inf : mx[x<<1^1]);\n\tsum[x] =sum[x<<1]+sum[x<<1^1];\n}\n\nvoid modify(const int &l, const int &r, const int &val1, const int &val2, const int &nl =1, const int &nr =N, const int &x =1){\n\tif(l == nl && r == nr){\n\t\tif(mx[x] != -inf) mx[x] +=val1;\n\t\ttag_mx[x] +=val1;\n\t\tsum[x] +=1ll*val2*(nr-nl+1);\n\t\ttag_sum[x] +=1ll*val2*(nr-nl+1);\n\t\treturn;\n\t}\n\tpushdown(x);\n\tint mid =(nl+nr)>>1;\n\tif(r <= mid)\n\t\tmodify(l, r, val1, val2, nl, mid, x<<1);\n\telse if(l >= mid+1)\n\t\tmodify(l, r, val1, val2, mid+1, nr, x<<1^1);\n\telse\n\t\tmodify(l, mid, val1, val2, nl, mid, x<<1), modify(mid+1, r, val1, val2, mid+1, nr, x<<1^1);\n\tpushup(x);\n}\n\nint query(const int &l, const int &r, const int &val, const int &nl =1, const int &nr =N, const int &x =1){\n\tif(nl == nr)\n\t\treturn (sum[x] != 0 && mx[x] == val) ? nl : -1;\n\telse if(l == nl && r == nr){\n\t\tpushdown(x);\n\t\tint mid =(nl+nr)>>1;\n\t\tint ret =-1;\n\t\tif(sum[x<<1] > 0 && mx[x<<1] >= val)\n\t\t\tret =max(ret, query(nl, mid, val, nl, mid, x<<1));\n\t\tif(sum[x<<1^1] > 0 && mx[x<<1^1] >= val)\n\t\t\tret =max(ret, query(mid+1, nr, val, mid+1, nr, x<<1^1));\n\t\treturn ret;\n\t}\n\telse{\n\t\tpushdown(x);\n\t\tint mid =(nl+nr)>>1;\n\t\tif(r <= mid)\n\t\t\treturn query(l, r, val, nl, mid, x<<1);\n\t\telse if(l >= mid+1)\n\t\t\treturn query(l, r, val, mid+1, nr, x<<1^1);\n\t\telse\n\t\t\treturn max(query(l, mid, val, nl, mid, x<<1), query(mid+1, r, val, mid+1, nr, x<<1^1));\n\t}\n}\n\nint query0(const int *a){\n\t// \u65e2\u7136\u8981\u6c42\u524d\u7f00\u90fd\u4e3a 0 \u65f6 a_i=0 \u624d\u53ef\u80fd\u6210\u4e3a\u8d21\u732e\uff0c\u90a3\u4e48\u627e\u6700\u5de6\u7684\u4f4d\u7f6e\u5c31\u884c\u4e86 //\n\treturn (a[1] == 0) ? 1 : -1;\n}\n\n/*------------------------------Main------------------------------*/\n\nint a[MAXN];\nll s[MAXN];\n\nint main(){\n\tint n =read(), q =read();\n\tfor(int i =1; i <= n; ++i)\n\t\ta[i] =read(), s[i] =s[i-1]+a[i];\n\t\n\twhile(N < n)\n\t\tN <<=1;\n\tfor(int i =N; i < N+n; ++i)\n\t\tmx[i] =a[i-N+1]-s[i-N+1 -1], sum[i] =a[i-N+1];\n\tfor(int i =N+n; i < 2*N; ++i)\n\t\tmx[i] =-inf, sum[i] =0;\n\tfor(int i =N-1; i; --i)\n\t\tpushup(i);\n\t\n\tfor(int t =0; t < q; ++t){\n\t\tint p =read(), x =read();\n\t\tmodify(p, p, x-a[p], x-a[p]);\n\t\tif(p+1 <= n) modify(p+1, n, -(x-a[p]), 0);\n\t\ta[p] =x;\n\t\tint ans =max(query(1, n, 0), query0(a));\n\t\tif(ans == -1)\n\t\t\tputchar('-'), putchar('1'), putchar('\\n');\n\t\telse\n\t\t\twrite(ans), putchar('\\n');\n\t}\n}\n```\n\n### \u89e3\u6cd5\u4e8c\n\n\u6682\u65f6\u5495\u5495 \\kk\n\n\u53ef\u53c2\u8003 [\u8fd9\u4efd](https://codeforces.com/contest/992/submission/39392321)\n\n\uff08\u4e0d\u8fc7\u611f\u89c9\u8fd9\u79cd\u89e3\u6cd5\u7684\u5b9e\u73b0\u7ec6\u8282\u5176\u5b9e\u4e0d\u592a\u591a \\fad\uff09",
        "postTime": 1605770032,
        "uid": 105254,
        "name": "Piwry",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF992E \u3010Nastya and King-Shamans\u3011"
    },
    {
        "content": "\u6bcf\u6b21\u4ecep=1 \u8df3\u8d77 \u6bcf\u6b21\u8df3\u5230 sum[i]>=2*sum[p]\u7684\u6700\u5c0f\u7684i\u5904\n\n\u53ef\u4ee5\u8bc1\u660e\u7b54\u6848\u4e00\u5b9a\u5728\u8df3\u8fc7\u7684i\u4e0a\uff08\u53cd\u8bc1\u6cd5\uff09\n\n\u7406\u6027\u7684\u60f3\u4e00\u4e0b\uff0c\u5982\u679csum[i]<2*sum[p]\n\n\u90a3\u4e48sum[i]-sum[p]<sum[p]\n\n\u7531\u4e8ei>p\u6240\u4ee5\u4e00\u5b9a\u4e0d\u5b58\u5728num[i]=sum[i-1]\n\n```cpp\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\ninline int read(){int x=0,f=1,ch=getchar(); while(ch<'0'||ch>'9'){if(ch=='-') f=-1; ch=getchar();} while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();} return x*f;}\ninline void write(int x){if (x<0) putchar('-'),x=-x; if (x>=10) write(x/10); putchar(x%10+'0');}\ninline void writeln(int x){write(x); puts(\"\");}\nconst int N=2e5+5;\ntypedef long long ll;\nint n,num[N],q;\nll sum[N],S;\ninline void init(){\n\tn=read(); q=read();\n\tfor (int i=1;i<=n;i++) num[i]=read(); \n}\nstruct node{\n\tll mx,plu;\n}a[N<<2];\nvoid build(int k,int l,int r){\n\ta[k].mx=sum[r];\n\tif (l==r) return;\n\tint mid=(l+r)>>1; build(k<<1,l,mid); build(k<<1|1,mid+1,r);\n}\ninline void plus(int k,ll w){\n\ta[k].mx+=w; a[k].plu+=w;\n}\ninline void pushdown(int k){\n\tif (a[k].plu){\n\t\tplus(k<<1,a[k].plu);\n\t\tplus(k<<1|1,a[k].plu);\n\t\ta[k].plu=0;\n\t}\n}\ninline void pushup(int k){\n\ta[k].mx=max(a[k<<1].mx,a[k<<1|1].mx);\n}\nvoid upd(int k,int l,int r,int x,int y,int w){\n\tif (l==x&&r==y) {plus(k,w); return;}\n\tint mid=(l+r)>>1; pushdown(k);\n\tif (mid>=y) upd(k<<1,l,mid,x,y,w);\n\t\telse if (mid<x) upd(k<<1|1,mid+1,r,x,y,w);\n\t\t\telse upd(k<<1,l,mid,x,mid,w),upd(k<<1|1,mid+1,r,mid+1,y,w);\n\tpushup(k);\n}\nint qry(int k,int l,int r,ll x){\n\tif (a[k].mx<2ll*x) return 0;\n\tif (l==r) {S=a[k].mx; return r;}\n\tint mid=(l+r)>>1; pushdown(k);\n\tif (a[k<<1].mx>=2ll*x) return qry(k<<1,l,mid,x);\n\t\telse return qry(k<<1|1,mid+1,r,x);\n}\ninline void solve(){\n\tfor (int i=1;i<=n;i++) sum[i]=sum[i-1]+num[i];\n\tbuild(1,1,n);\n\tfor (int i=1;i<=q;i++){\n\t\tint x=read(),w=read();\n\t\tupd(1,1,n,x,n,w-num[x]);\n\t\tnum[x]=w; S=num[1];\n\t\tif (S==0){\n\t\t\tputs(\"1\");\n\t\t\tcontinue;\n\t\t}\n\t\tfor (;;){\n\t\t\tint p=qry(1,1,n,S);\n\t\t\tif (!p) {\n\t\t\t\tputs(\"-1\");\n\t\t\t\tbreak;\n\t\t\t}else{\n\t\t\t\tif (S==2ll*num[p]) {\n\t\t\t\t\twriteln(p);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){\n\tinit();\n\tsolve();\n\treturn 0;\n} \n```",
        "postTime": 1533992103,
        "uid": 34444,
        "name": "\u5927\u83dc\u9e21fks",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF992E \u3010Nastya and King-Shamans\u3011"
    },
    {
        "content": "\u5206\u5757\n\n\u5bf9\u4e8e\u6bcf\u4e00\u5757\uff0c\u663e\u7136\u5f71\u54cd\u8fd9\u4e2a\u5757\u7b54\u6848\u7684\u56e0\u7d20\u53ea\u6709\u8fd9\u4e2a\u5757\u4e4b\u524d\u7684$a_{i}$\u548c\uff08\u5e9f\u8bdd\uff09\u3002\n\n\u4f46\u662f\u8fd9\u542f\u53d1\u6211\u4eec\u53ef\u4ee5\u5b58\u50a8**\u5757\u524d$a_{i}$\u548c**\u4e3a\u591a\u5c11\u65f6\uff0c\u8fd9\u4e2a\u5757\u4f1a\u6709\u7b54\u6848\u3002\n\n\u5177\u4f53\u7684\uff0c\u8bbe\u5f53\u524d\u6307\u5411$i$\uff0c\u5f53 $S=a_{i}-Sblock_{i-1}$ \u65f6\uff0c$i$\u662f\u4e00\u4e2a\u53ef\u884c\u89e3\u3002\n\n\uff08$S$\u5c31\u662f\u4e0a\u6587\u63d0\u5230\u7684\u5757\u524d $a_{i}$ \u548c\uff0c $Sblock_{i-1}$ \u5c31\u662f\u6307\u5757\u5185\u7684\u524d\u7f00\u548c\uff09 \n\n\u628a\u5dee\u503c\u6392\u5e8f\uff0c\u6bcf\u6b21\u8be2\u95ee\u5757\u5185\u4e8c\u5206\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(q\\sqrt{n}\\log{\\sqrt{n}})$ \u3002\n\n\u4f46\u662f\u6709\u4eba\u8bf4\u4e86\u554a\u4f60\u8fd9\u4e2a\u4e0d\u884c\u7684\u554a\uff0ctoo slow too naive \u3002\n\n\u505a\u4e2a\u5c0f\u4f18\u5316\uff0c\u8fd9\u4e2a$S$\u663e\u7136\u662f\u975e\u8d1f\u7684\uff0c\u4e5f\u5c31\u662f\u5f53\u5dee\u503c\u4e3a\u6b63\u7684\u65f6\u5019\u6211\u4eec\u624d\u628a\u5b83\u653e\u5230\u5e8f\u5217\u91cc\u9762\uff0c\u7279\u5224\u4e00\u624b\u5dee\u503c\u4e3a$0$\u3002\n\n```cpp\nif( a[i] >= ts && a[i] != ts ) b[++len] = (node){ a[i] - ts , i } ; \nts += a[i] ; \n```\n\n\u6bcf\u5f53 $len$ \u52a0\u4e00\u65f6\uff0c$ts$ \u81f3\u5c11\u4e58\u4e8c\uff0c\u90a3\u4e48 $len$ \u7684\u5927\u5c0f\u5c06\u662f $\\log{V}$ \u3002\n\n\u597dyeah\uff01\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u662f$O(q\\sqrt{n}\\log{\\log{V}})$\u4e86\u3002\n\n\u4e0d\u8fc7\u8fd8\u662f\u6162\u7684\u8981\u6b7b/px\u3002\n\n```cpp\n#include<bits/stdc++.h> \n#define rg register \n#define fp( i , x , y ) for( rg int i=(x); i<=(y); ++i ) \n#define fq( i , x , y ) for( rg int i=(y); i>=(x); --i ) \n#define i60 long long \n#define dou double \n#define ls k<<1 \n#define rs k<<1|1 \nusing namespace std ; \nconst int N = 2e5+10 , B = 450 ;  \nint pos[N] , lef[N] , rig[N] , a[N] , n ;  \nstruct node { \n  i60 vl ; int id ; \n  friend bool operator < ( node A , node B ) { return A.vl < B.vl ; } \n} ; \t\t\t\nstruct block_ { \n  node b[40] ; int len , tp , v0 ; i60 ts ;  \n  void build( int p ) { \n    len = 0 ; ts = 0 ; v0 = -1 ; \n    fp( i , lef[p] , rig[p] ) { \n      if( a[i] >= ts && a[i] != ts ) b[++len] = (node){ a[i] - ts , i } ; \n      if( a[i] == ts ) v0 = i ; \n\t  ts += a[i] ; \n\t} \n\tsort( b+1 , b+1+len ) ; \n  } \n  int query( i60 nw ) { \n    if( nw == 0 ) return v0 ; \n    tp = lower_bound( b+1 , b+1+len , (node){nw,0} ) - b ; \n\treturn ( tp && tp <= len && b[tp].vl == nw ) ? b[tp].id : -1 ;   \n  } \n} t[B] ;  \nint ask( ) { \n  i60 nw = 0 ; int tp ; \n  fp( i , 1 , pos[n] ) { \n    tp = t[i].query( nw ) ; if( tp != -1 ) return tp ;  \n    nw += t[i].ts ; \n  } return -1 ; \n} \nsigned main( ) { \n  ios::sync_with_stdio(false) ; \n  cin.tie(0) ; \n  int q , x , y ; cin >> n >> q ; int blo = sqrt(n) ;  \n  fp( i , 1 , n ) cin >> a[i] , pos[i] = (i-1)/blo+1 ; \n  fp( i , 1 , n ) rig[pos[i]] = i ; \n  fq( i , 1 , n ) lef[pos[i]] = i ; \n  fp( i , 1 , pos[n] ) t[i].build( i ) ; \n  while( q -- ) { \n    cin >> x >> y ; a[x] = y ; t[pos[x]].build( pos[x] ) ; \n    cout << ask( ) << '\\n' ; \n  } \n  return 0 ; \n}  \n```\n",
        "postTime": 1622299317,
        "uid": 100114,
        "name": "hater",
        "ccfLevel": 0,
        "title": "CF992E Nastya and King-Shamans"
    },
    {
        "content": "\u5c0f\u670b\u53cb\u5206\u5757\n\n\u5bb9\u6613\u60f3\u5230\u5728\u6bcf\u4e2a\u5757\u5185\u7ef4\u62a4\u4e00\u4e2a `hash` \uff0c\n\n\u8fd9\u6837\u53ef\u4ee5\u6bcf\u6b21 $O(1)$ \u8be2\u95ee\u5757\u5185\u662f\u5426\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u7b54\u6848\uff0c\n\n\u505a\u5230 $O(\\sqrt n)$ \u4fee\u6539\u548c\u8be2\u95ee\u3002\n\n$a[i]=s[i-1]\\\\\na[i]=s[st[bl[i]]-1]+s[i-1]-s[st[bl[i]]-1]\\\\\ns[st[bl[i]]-1]=a[i]-s[i-1]+s[st[bl[i]]-1]\n$\n\n\u6240\u4ee5\u6211\u4eec\u4ee5 `a[i]-s[i-1]+s[st[bl[i]]-1]` \u4e3a\u4e0b\u6807\uff0c `i` \u4e3a\u503c\u5b58\u8fdb `hash` \u5c31\u53ef\u4ee5\u4e86\uff0c\n\n\u4fee\u6539\u7684\u65f6\u5019\u76f4\u63a5\u91cd\u6784\u6574\u4e2a\u5757\uff0c\n\n\u8be2\u95ee\u7684\u65f6\u5019\u66b4\u529b\u904d\u5386\u5757\uff0c\u7b97\u524d\u7f00\u548c\uff0c\u7528 `hash` \u67e5\u8be2\u6bcf\u4e2a\u5757\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5,len=300;\nconst long long mod=107;\nint n,m,a[N+10],x,k,bl[N+10],st[N/len+10],ed[N/len+10],cnt,last;\nlong long s[N/len+10][N/len+10];\nint read()\n{\n\tchar ch=getchar();\n\tint r=0,w=1;\n\twhile(ch<'0'||ch>'9') w=ch=='-'?-1:w,ch=getchar();\n\twhile(ch>='0'&&ch<='9') r=r*10+ch-'0',ch=getchar();\n\treturn r*w;\n}\nstruct hash\n{\n\tint cnt,key[110];\n\tstruct node\n\t{\n\t\tlong long x;\n\t\tint v,next;\n\t}a[10010];\n\tvoid clear()\n\t{\n\t\tmemset(key,0,sizeof(key));\n\t\tcnt=0;\n\t}\n\tvoid add(long long x,int k)\n\t{\n\t\ta[++cnt]={x,k,key[x%mod]};\n\t\tkey[x%mod]=cnt;\n\t}\n\tint ask(long long x)\n\t{\n\t\tfor(int i=key[x%mod];i;i=a[i].next)\n\t\tif(a[i].x==x)\n\t\treturn a[i].v;\n\t\treturn 0;\n\t}\n}vis[N/len+10];\nvoid build()\n{\n\tfor(int i=1;i<=n;i+=len)\n\tst[++cnt]=i,ed[cnt]=i+len-1;\n\ted[cnt]=n;\n\tfor(int i=1;i<=cnt;i++)\n\tfor(int j=st[i];j<=ed[i];j++)\n\tbl[j]=i,s[i][j-st[i]+1]=s[i][j-st[i]]+a[j],vis[i].add(a[j]-s[i][j-st[i]],j);\n}\nint add(int x,int k)\n{\n\ta[x]=k;\n\tvis[bl[x]].clear();\n\tfor(int j=st[bl[x]];j<=ed[bl[x]];j++)\n\ts[bl[x]][j-st[bl[x]]+1]=s[bl[x]][j-st[bl[x]]]+a[j],s[bl[x]][j-st[bl[x]]+1]=s[bl[x]][j-st[bl[x]]]+a[j],vis[bl[x]].add(a[j]-s[bl[x]][j-st[bl[x]]],j);\n\tif(last>0&&x>last)\n\treturn last;\n\tlong long sum=0;\n\tfor(int i=1;i<=cnt;i++)\n\t{\n\t\tint k=vis[i].ask(sum);\n\t\tif(k)\n\t\treturn k;\n\t\telse\n\t\tsum+=s[i][ed[i]-st[i]+1];\n\t}\n\treturn -1;\n}\nint main()\n{\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\ta[i]=read();\n\tbuild();\n\twhile(m--)\n\t{\n\t\tx=read(),k=read();\n\t\tprintf(\"%d\\n\",last=add(x,k));\n\t}\n}\n```",
        "postTime": 1645537786,
        "uid": 363350,
        "name": "hxdts",
        "ccfLevel": 6,
        "title": "CF992E Nastya and King-Shamans \u9898\u89e3"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF992E)\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/zxh-mc/p/16988408.html)\n\n## \u5206\u6790\n\n\u7531\u4e8e\u6ee1\u8db3 $a_i\\ge0$\uff0c\u6240\u4ee5 $s_i$ \u5355\u8c03\u4e0d\u51cf\u3002\n\n\u5f53\u6211\u4eec\u627e\u5230\u4e00\u4e2a $i$ \u65f6\uff0c\u4e0d\u7ba1 $i$ \u662f\u5426\u6ee1\u8db3\uff0c\u4e0b\u4e00\u4e2a\u53ef\u80fd\u7684\u4e00\u5b9a\u5927\u4e8e\u7b49\u4e8e $a_i+s_{i-1}$\u3002\n\n\u800c\u4e14 $a_i+s_{i-1}=2a_i$ \u6216 $a_i+s_{i-1}=2s_{i-1}$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u627e\u5230\u4e00\u4e2a $i$ \u540e\uff0c\u4e0b\u4e00\u4e2a\u53ef\u80fd\u7684 $i$ \u548c\u5f53\u524d $i$ \u7684\u503c\u5448\u73b0**\u4e8c\u500d\u5173\u7cfb**\u3002\n\n\u7531\u6b64\u6211\u4eec\u5f97\u51fa\uff0c\u5982\u679c\u6211\u4eec\u6309\u7167\u8fd9\u79cd\u65b9\u6cd5\u67e5\u8be2\uff0c\u6bcf\u4e00\u6b21\u90fd\u8df3\u5230\u540e\u9762\u6240\u6709 $i$ \u4e2d\u7b2c\u4e00\u4e2a $a_i$ \u5927\u4e8e\u7b49\u4e8e $a_{nowi}+s_{nowi-1}$ \u7684\uff0c\u6700\u591a\u80fd\u8df3 $\\log10^9$ \u6b21\u3002\n\n\u7136\u540e\u9700\u8981\u89e3\u51b3\u5feb\u901f\u627e\u5230\u533a\u95f4\u4e2d\u7684\u5927\u4e8e\u7b49\u4e8e $x$ \u7684\u7b2c\u4e00\u4e2a\u6570\u3002\n\n\u8003\u8651\u4e8c\u5206\uff0c\u5efa\u7acb\u7ebf\u6bb5\u6811\u6c42\u533a\u95f4\u6700\u503c\uff0c\u590d\u6742\u5ea6 $O(\\log^2n)$\uff0c\u603b\u590d\u6742\u5ea6 $O(n\\log^2n\\log10^9)$\uff0c\u8d85\u65f6\u3002\n\n\u4f18\u5316\u4e8c\u5206\uff0c\u7ebf\u6bb5\u6811\u662f\u5929\u751f\u7684\u5206\u6cbb\u7ed3\u6784\uff0c\u8003\u8651\u5c06\u67e5\u8be2\u7684\u533a\u95f4\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6bb5\u7684\u957f\u5ea6\u4e5f\u662f\u4e8c\u500d\u5173\u7cfb\uff0c\u6bcf\u4e00\u6bb5\u5bf9\u5e94\u7ebf\u6bb5\u6811\u4e2d\u7684\u4e00\u4e2a\u7ed3\u70b9\uff0c\u518d\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\uff0c\u6700\u540e\u5408\u5e76\u7ed3\u679c\uff0c\u603b\u590d\u6742\u5ea6 $\\log n$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n\\log n\\log 10^9)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long LL;\nconst int N = 2e5 + 10;\n\nint n, a[N], q;\n\nstruct node {\n\tint l, r, maxn;\n\tLL v;\n}nodes[N << 2];\n\ninline void push_up (int p) {\n\tnodes[p].v = nodes[p << 1].v + nodes[p << 1 | 1].v;\n\tif (nodes[p << 1].maxn > nodes[p << 1 | 1].maxn) nodes[p].maxn = nodes[p << 1].maxn;\n\telse nodes[p].maxn = nodes[p << 1 | 1].maxn;\n}\n\nvoid build (int p, int l, int r) {\n\tnodes[p].l = l; nodes[p].r = r;\n\tif (l == r) {\n\t\tnodes[p].v = nodes[p].maxn = a[l];\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild (p << 1, l, mid); build (p << 1 | 1, mid + 1, r);\n\tpush_up(p);\n}\n\nvoid add (int p, int idx, int x) {\n\tint tl = nodes[p].l, tr = nodes[p].r;\n\tif (tl == tr) {\n\t\tnodes[p].v = nodes[p].maxn = a[idx] = x;\n\t\treturn;\n\t}\n\tint mid = (tl + tr) >> 1;\n\tif (idx <= mid) add(p << 1, idx, x);\n\telse add(p << 1 | 1, idx, x);\n\tpush_up(p);\n}\n\nint get_max (int p, int l, int r) {\n\tif (l > r) return 0;\n\tint tl = nodes[p].l, tr = nodes[p].r;\n\tif (tl >= l && tr <= r) return nodes[p].maxn;\n\tint res = -1, mid = (tl + tr) >> 1;\n\tif (l <= mid) {\n\t\tint k = get_max(p << 1, l, r);\n\t\tif (k > res) res = k;\n\t}\n\tif (r > mid) {\n\t\tint k = get_max (p << 1 | 1, l, r);\n\t\tif (k > res) res = k;\n\t}\n\treturn res;\n}\n\nLL get_s (int p, int l, int r) {\n\tif (l > r) return 0;\n\tint tl = nodes[p].l, tr = nodes[p].r;\n\tif (tl >= l && tr <= r) return nodes[p].v;\n\tint mid = (tl + tr) >> 1; LL res = 0;\n\tif (l <= mid) res += get_s (p << 1, l, r);\n\tif (r > mid) res += get_s (p << 1 | 1, l, r);\n\treturn res;\n}\n\nint find (int p, LL x) {\n\tint tl = nodes[p].l, tr = nodes[p].r;\n\tif (tl == tr) if (a[tl] >= x) return tl; else return -1;\n\tint k1 = nodes[p << 1].maxn, k2 = nodes[p << 1 | 1].maxn;\n\tif (k1 >= x) return find (p << 1, x);\n\telse if (k2 >= x) return find(p << 1 | 1, x);\n\treturn -1;\n} \n\nint ask (int l, int r, LL x) {\n\tif (l > r) return -1;\n\tint p = 1, res = n + 1;\n\twhile (nodes[p].l != nodes[p].r) {\n\t\tif (nodes[p << 1 | 1].l <= l) p = p << 1 | 1;\n\t\telse {\n\t\t\tint k = find(p << 1 | 1, x);\n\t\t\tif (k != -1) res = min(res, k);\n\t\t\tp = p << 1;\n\t\t}\n\t}\n\tif (nodes[p].maxn >= x) res = min(res, nodes[p].l);\n\tif (res > n) return -1;\n\treturn res;\n}\n\nint main () {\n\tscanf(\"%d%d\", &n, &q);\n\tfor (int i = 1;i <= n;i++) scanf(\"%d\", &a[i]);\n\tbuild(1, 1, n);\n\twhile (q--) {\n\t\tint idx, k;\n\t\tscanf(\"%d%d\", &idx, &k);\n\t\tadd(1, idx, k);\n\t\tbool flag = 0;\n\t\tfor (int i = 1;i <= n;) {\n\t\t\tLL x1 = get_s(1, 1, i - 1), x2 = a[i];\n\t\t\tif (x1 == x2) {\n\t\t\t\tprintf(\"%d\\n\", i); flag = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\ti = ask(i + 1, n, x1 + x2);\n\t\t\tif (i == -1) break;\n\t\t}\n\t\tif (!flag) printf(\"-1\\n\");\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1671149699,
        "uid": 757990,
        "name": "zxh_mc",
        "ccfLevel": 0,
        "title": "CF992E Nastya and King-Shamans \u9898\u89e3"
    }
]