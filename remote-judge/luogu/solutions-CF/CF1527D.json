[
    {
        "content": "# CF1527D MEX Tree\n\n> \u9898\u610f:\u7ed9\u5b9a\u4e00\u68f5n\u4e2a\u70b9\u7684\u7f16\u53f7\u4e3a$0\\sim n-1$\u7684\u6811\uff0c\u6c42\u51famex\u5206\u522b\u4e3a$0\\sim n$\u7684\u8def\u5f84\u6570\uff0c\u8def\u5f84\u81f3\u5c11\u5305\u542b2\u4e2a\u70b9\n>\n> mex\u4e3a\u4e00\u4e2a\u96c6\u5408\u5185\u672a\u51fa\u73b0\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\n>\n> $n\\leq 2\\cdot 10^5$\n\n\u53ef\u4ee5\u77e5\u9053\uff0cmex\u4e3ax\u7684\u5145\u8981\u6761\u4ef6\u4e3a0~x-1\u7684\u6570\u5747\u5728\u8def\u5f84\u4e0a\u4e14x\u4e0d\u5728\u8def\u5f84\u4e0a\n\n\u7ef4\u62a4x\u4e0d\u5728\u8def\u5f84\u4e0a\u6bd4\u8f83\u590d\u6742\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u5bb9\u65a5\uff0c\u7528\u5305\u542b$[0,x-1]$\u7684\u8def\u5f84\u6570\u51cf\u53bb\u5305\u542b$[0,x]$\u7684\u8def\u5f84\u5373\u53ef\n\n\u6b64\u65f6\u7684\u95ee\u9898\u8f6c\u6362\u4e3a\u6c42\u5305\u542b$[0,x]$\u7684\u8def\u5f84\u6570\n\n\u56e0\u4e3a\u8def\u5f84\u6709\u4e14\u4ec5\u67092\u4e2a\u7aef\u70b9\uff0c\u6240\u4ee5\u5bf9\u4e8e$x$\u53ea\u6709\u5f53$|\\{i\\mid i\\in[0,x],\\exists j\\in [0,x],i\\in {\\tt anc}(j)\\}|\\leq 2$\u65f6\u5b58\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u8def\u5f84.\u5176\u4e2d${\\tt anc}(i)$\u8868\u793a$i$\u7684\u7956\u5148\u96c6\u5408(\u4e0d\u5305\u62ec$i$)\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4$[0,x]$\u7684\u4e24\u4e2a\"\u7aef\u70b9\"(\u6ca1\u7f16\u53f7\u5728$[0,x]$\u4e2d\u7684\u540e\u4ee3\u7684\u70b9)\uff0c\u6bcf\u6b21\u52a0\u5165\u70b9$x+1$\u65f6\u5219\u5224\u662f\u5426\u4e3a\u4e24\u4e2a\u7aef\u70b9\u4e2d\u7684\u4e00\u4e2a\u7684\u7956\u5148\u6216\u540e\u4ee3;\u5982\u679c\u90fd\u4e0d\u662f\u5219\u5f53$[x+1,n-1]$\u65f6\u65e0\u89e3\n\n\u76f4\u63a5\u7528\u500d\u589e\u6216\u6811\u5256$\\tt lca$\u7684\u8bdd\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\log n)$,\u53ef\u4ee5\u8fc7(\u5f53\u7136\u4f60\u60f3\u7528\u6807\u51c6$\\tt rmq$\u6c42$\\tt  lca$\u4e5f\u53ef\u4ee5\u505a\u5230$O(n)$),\u4f46\u662f\u6211\u4eec\u5176\u5b9e\u53ef\u4ee5\u4e0d\u5fc5\u6c42$\\tt lca$,\u76f4\u63a5$O(n)$\u7684\u6c42\u89e3\n\n\u6211\u4eec\u518d$dfs$\u8fc7\u7a0b\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u7ef4\u62a4\u4e00\u4e2a\u5173\u4e8e\u7f16\u53f7\u5355\u8c03\u9012\u589e\u7684\u5e8f\u5217.\u88ab\u5f39\u6389\u4e86\u7684\u70b9\u5219\u8bf4\u660e**\u5b58\u5728\u7f16\u53f7\u6bd4\u4ed6\u5c0f\u7684\u70b9\u4e3a\u4ed6\u7684\u540e\u4ee3**\uff0c\u5373\u5b83\u4e0d\u4f1a\u6539\u53d8\u7aef\u70b9.\u540c\u65f6\u6211\u4eec\u8fd8\u53ef\u4ee5\u6c42\u51fa\u8fd9\u4e2a\u70b9\u79bb\u4ed6\u6700\u8fd1\u7684\u7f16\u53f7\u5c0f\u4e8e\u4ed6\u7684\u70b9(\u4e0b\u6587\u4e2d\u79f0\u8fd9\u4e2a\u70b9\u4e3a\u524d\u9a71).$x$\u7684\u524d\u9a71\u5728\u52a0\u5165$x$\u65f6\u4e00\u5b9a\u4e3a\u4e00\u4e2a\u7aef\u70b9\uff0c\u5426\u5219\u5219\u6784\u6210\u4e86\"\u4eba\"\u5b57\u5f62\n\n\u4f46\u5176\u5b9e\u8fd9\u91cc\u6c42\u51fa\u7684\u4e0d\u4e00\u5b9a\u4e3a\u4e25\u683c\u7684\u524d\u9a71\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u6709\"\u8fdc\u623f\u5144\u5f1f\"\u5f39\u6389\u4e86\u524d\u9a71.\u4f46\u5176\u5b9e\u6ca1\u6709\u95ee\u9898\uff0c\u82e5\u771f\u7684\u5f39\u6389\u4e86\u524d\u9a71\uff0c\u5219\u8bf4\u660e\u6b64\u65f6\u5c31\u81f3\u5c11\u5b58\u5728$3$\u4e2a\u7aef\u70b9\u4e86:\u5f39\u6389\u524d\u9a71\u7684\u70b9(\u7684\u540e\u4ee3),\u81ea\u5df1(\u7684\u540e\u4ee3)\uff0c\u524d\u9a71\u4e0a\u9762\u7684\u70b9.\u5373\u6784\u6210\u4e86\"\u4eba\"\u5b57\u5f62\n\n\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u7528\u5224\u65ad\u8981\u52a0\u5165\u70b9\u7684\u524d\u9a71\u7684\u65b9\u6cd5\u4ee3\u66ff\u4e86\u6c42$lca$(\u8fd8\u6bd4\u500d\u589e\u597d\u6253\u4e9b)\n\n\u65f6\u7a7a\u590d\u6742\u5ea6$O(n)$,\u5355\u70b9\u6700\u616246ms\uff0c\u603b\u65f6\u95f4869ms,\u76ee\u524d$rk1$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n# define ll long long\n# define read read1<ll>()\n# define Type template<typename T>\nType T read1(){\n\tT t=0;\n\tchar k;\n\tbool vis=0;\n\tdo (k=getchar())=='-'&&(vis=1);while('0'>k||k>'9');\n\twhile('0'<=k&&k<='9')t=(t<<3)+(t<<1)+(k^'0'),k=getchar();\n\treturn vis?-t:t;\n}\n# define fre(k) freopen(k\".in\",\"r\",stdin);freopen(k\".out\",\"w\",stdout)\nint fa[200005],s,sz[200005],sta[200005],to[200005];\nll ans[200005];\nbool vis[200005];\nvector<int>G[200005];\nvoid dfs(int n,int f){\n\tfa[n]=f;sz[n]=1;\n\twhile(*sta&&sta[*sta]>n)vis[sta[*sta]]=1,--*sta;\n\tto[n]=sta[*sta];sta[++*sta]=n;\n\tfor(auto i:G[n])\n\t\tif(i!=f)dfs(i,n),sz[n]+=sz[i];\n\tif(sta[*sta]==n)--*sta;\n}\nvoid Put(ll x){\n\tstatic int st[20],p;\n\tif(x<0)putchar('-'),x=-x;\n\tdo st[++p]=x-x/10*10,x/=10;while(x);\n\twhile(p)putchar(st[p]^'0'),--p;\n}\nint main(){\n\tfor(int T=read;T--;){\n\t\ts=read;*sta=0;memset(vis,0,s);\n\t\tfor(int i=0;i<s;++i)G[i].clear();\n\t\tfor(int i=1;i<s;++i){\n\t\t\tint u=read,v=read;\n\t\t\tG[u].push_back(v);\n\t\t\tG[v].push_back(u);\n\t\t}dfs(0,0);ans[0]=ans[s]=0;\n\t\tint u=0,v=0,lt=-1,t=1,p=0;\n\t\tfor(auto i:G[0])ans[0]+=1ll*t*sz[i],t+=sz[i];\n\t\tfor(int i=1;i<s;++i){\n\t\t\tif(vis[i]){ans[i]=ans[i-1];continue;}\n\t\t\tif(to[i]==v)swap(u,v);\n\t\t\tif(to[i]==u){\n\t\t\t\tif(!u&&v){\n\t\t\t\t\tint j=i;while(fa[j])j=fa[j];\n\t\t\t\t\tif(j==p){memset(ans+i,0,s-i+1<<3);break;}\n\t\t\t\t}\n\t\t\t\tu=i;\n\t\t\t\tif(!v)\n\t\t\t\t\tif(~lt)ans[i]=1ll*sz[u]*lt;\n\t\t\t\t\telse{\n\t\t\t\t\t\tint j=u;lt=1;while(fa[j])j=fa[j];\n\t\t\t\t\t\tfor(auto x:G[0])if(x!=j)lt+=sz[x];\n\t\t\t\t\t\tans[i]=1ll*sz[u]*lt;p=j;\n\t\t\t\t\t}\n\t\t\t\telse ans[i]=1ll*sz[u]*sz[v];\n\t\t\t}else{memset(ans+i,0,s-i+1<<3);break;}\n\t\t}Put(1ll*s*(s-1)/2-ans[0]);putchar(' ');\n\t\tfor(int i=0;i<s;++i)Put(ans[i]-ans[i+1]),putchar(' ');;putchar('\\n');\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1621675068,
        "uid": 108067,
        "name": "\u4e1b\u96e8",
        "ccfLevel": 0,
        "title": "CF1527D MEX Tree"
    },
    {
        "content": "## \u9898\u610f  \n\n\u7ed9\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u6807\u53f7\u4ece $0$ \u5230 $n-1$\uff0c\u5bf9\u4e8e\u4efb\u610f $k$\uff0c\u6c42\u70b9\u5bf9 $u,v$ \u7684\u6570\u91cf\uff0c\u4f7f\u5f97 $\\text{Mex}_{ w \\in path(u,v)}=k$\u3002\n\n## \u9898\u89e3\n\nwhk \u4e86\u4e24\u4e2a\u6708\u4e4b\u540e\u611f\u89c9\u81ea\u5df1\u5df2\u7ecf\u6ca1\u6709\u8111\u5b50\u4e86\uff08\u5947\u602a\uff0c\u8bf4\u5f97\u597d\u50cf\u6211\u66fe\u7ecf\u6709\u8fc7\u4e00\u6837\uff09\u3002\n\n\u9996\u5148\u8003\u8651\u5728\u94fe\u4e0a\u600e\u4e48\u505a\u3002\u6211\u4eec\u4ece $0$ \u5f00\u59cb\u5f80\u4e0a\u63a8\uff0c\u6bd4\u5982\u6211\u4eec\u73b0\u5728\u679a\u4e3e\u5230\u4e86 $x$\u3002  \n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0 $0$ \u5230 $x$ \u7684\u6570\u4e00\u5b9a\u5728\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u5185\uff0c\u4e8e\u662f\u6211\u4eec\u77e5\u9053 $\\text{Mex}> x$ \u7684\u8def\u5f84\u6570\u6709 $l\\times(n-r+1)$ \u6761\u3002\u7136\u540e\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6700\u540e\u8f93\u51fa\u7684\u65f6\u5019\u51cf\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u600e\u4e48\u4e0a\u6811\u3002\u9996\u5148\uff0c\u5982\u679c $0$ \u5230 $x$ \u7684\u6570\u4e0d\u5728\u540c\u4e00\u6761\u94fe\u4e0a\uff0c\u90a3\u4e48\u80fd\u591f\u540c\u65f6\u7ecf\u8fc7\u8fd9\u4e9b\u6570\u7684\u8def\u5f84\u4e00\u5b9a\u4e0d\u5b58\u5728\u3002\u5426\u5219\u663e\u7136 $0$ \u5230 $x-1$ \u4e5f\u4e00\u5b9a\u662f\u4e00\u6761\u94fe\uff0c\u90a3\u4e48\u6211\u4eec\u7ef4\u62a4\u8fd9\u6761\u94fe\u548c\u94fe\u4e24\u7aef\u7684\u8282\u70b9\u6570\u5373\u53ef\u3002\n\n\u6211\u7ef4\u62a4\u94fe\u7684\u65b9\u6cd5\u662f\uff0c\u5982\u679c\u5f53\u524d\u70b9\u4e0d\u5728\u94fe\u4e0a\uff0c\u5c31\u4e0d\u505c\u5730\u8df3\u7236\u4eb2\u76f4\u5230\u627e\u5230\u5df2\u7ecf\u5728\u94fe\u4e0a\u7684\u70b9\u3002\u5982\u679c\u662f\u7aef\u70b9\uff0c\u90a3\u4e48\u5c31\u4ea7\u751f\u4e86\u65b0\u7684\u7aef\u70b9\uff0c\u5426\u5219\u4e00\u5b9a\u4e0d\u662f\u4e00\u6761\u94fe\u3002\u94fe\u4e24\u7aef\u7684\u8282\u70b9\u6570\u53ef\u4ee5\u76f4\u63a5\u7528\u5b50\u6811\u5927\u5c0f\u3002\n\n## \u4ee3\u7801\uff1a\n\u5b9e\u73b0\u975e\u5e38\u4e11\u964b\uff08\u6700\u5f00\u59cb\u7684\u65f6\u5019\u751a\u81f3\u628a\u4e00\u4e2a bool \u6570\u7ec4\u80fd\u5e72\u7684\u4e8b\u7528 set \u6765\u505a\uff0c\u6211\u679c\u7136\u6ca1\u8111\u5b50\uff09  \n\n```cpp\n\nint n,ans,m,l,r,L,R;\nint a[N],b[N],sz1[N],sz2[N],FA[N],S[N];\nvector<int> T[N];\nvoid dfs(int u,int fa,int sz[])\n{\n    FA[u]=fa;\n    sz[u]=1;for (int v:T[u]) if (v!=fa) dfs(v,u,sz),sz[u]+=sz[v];\n}\nsigned main()\n{\n    int qwq;rd(qwq);while (qwq--)\n    {\n        rd(n);\n        for (int i=0;i<=n;i++) T[i].clear();\n        for (int i=1,x,y;i<n;i++) rd(x),rd(y),T[x].push_back(y),T[y].push_back(x);\n        for (int i=0;i<=n+1;i++) a[i]=0,sz1[i]=sz2[i]=0,S[i]=0;\n        l=r=0;dfs(0,-1,sz1);a[0]=n*(n-1)/2;\n        a[1]=2*n-2;for (int v:T[0]) a[1]+=(n-1-sz1[v])*sz1[v];a[1]/=2;\n        dfs(1,-1,sz2);l=1;r=0;L=sz1[l];R=sz2[r];a[2]=L*R;\n        int x=0;while (x!=1) S[x]=1,x=FA[x];S[1]=1;\n        for (int k=2;k<n;k++)\n        {\n            if (S[k]) {a[k+1]=L*R;continue;}\n            int x=k;\n            while (!S[x]) x=FA[x];\n            if (x==l) \n            {\n                int x=k;while (x!=l) S[x]=1,x=FA[x];\n                l=k,L=sz1[l],a[k+1]=L*R;\n            } else if (x==r) \n            {\n                int x=k;while (x!=r) S[x]=1,x=FA[x];\n                r=k;R=sz2[r],a[k+1]=L*R;\n            } else break;\n        }\n        for (int i=0;i<=n;i++) a[i]-=a[i+1],cout<<a[i]<<\" \";\n        puts(\"\");\n    }\n}\n```",
        "postTime": 1625572384,
        "uid": 70132,
        "name": "AsunderSquall",
        "ccfLevel": 7,
        "title": "CF1527D"
    },
    {
        "content": "\u7531 $\\text{mex}$ \u7684\u5b9a\u4e49\u6613\u77e5\uff0c\u5305\u542b $[0,i-1]$ \u7684\u8def\u5f84\u6570\u51cf\u53bb\u5305\u542b $[0,i]$ \u7684\u8def\u5f84\u6570\u8868\u793a\u7684\u662f\u5305\u542b $[0,i-1]$ \u4e14\u4e0d\u5305\u542b $i$ \u7684\u8def\u5f84\u6570\uff0c\u5373 $\\text{mex}$ \u4e3a $i$ \u7684\u8def\u5f84\u6570\u3002\n\n\u5b9a\u4e49 $ans_i$ \u4e3a\u5305\u542b $[0,i]$ \u7684\u8def\u5f84\u6570\uff0c\u5219 $\\forall i\\ge 1$\uff0c\u6709 $\\text{mex}_i=ans_{i-1}-ans_{i}$\uff0c\u800c $\\text{mex}_0=\\frac{n(n-1)}{2}-ans_0$\u3002\u6545\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u51fa $ans_i$\u3002\n\n\u8003\u8651\u4ee5 $0$ \u4e3a\u6839\u7684\u6700\u77ed\u7684\u5305\u542b $[0,i-1]$ \u7684\u8def\u5f84\uff0c\u8bbe\u5176\u5de6\u3001\u53f3\u7aef\u70b9\u5206\u522b\u4e3a $l,r$\uff0c\u5219 $i$ \u6709\u4e09\u79cd\u4e0d\u540c\u7684\u60c5\u51b5\u9700\u8981\u5904\u7406\uff0c\u6211\u4eec\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\uff1a\n\n1. $i$ \u5728 $l$ \u6216 $r$ \u7684\u5b50\u6811\u4e2d\uff0c\u8fd9\u65f6\u9700\u8981\u5c06\u5bf9\u5e94\u7aef\u70b9\u79fb\u52a8\u5230 $i$\u3002\n2. $i$ \u5728 $l$ \u5230 $r$\u7684\u8def\u5f84\u4e0a\uff0c\u5373 $l$ \u6216 $r$ \u5728 $i$ \u7684\u5b50\u6811\u4e2d\uff0c\u8fd9\u65f6\u65e0\u9700\u4efb\u4f55\u64cd\u4f5c\u3002\n3. \u5176\u4f59\u60c5\u51b5\uff0c\u7531\u4e8e\u4e00\u6761\u8def\u5f84\u53ea\u80fd\u6709\u4e24\u4e2a\u7aef\u70b9\uff0c\u5219\u6b64\u65f6\u6ca1\u6709\u4efb\u4f55\u4e00\u6761\u8def\u5f84\u80fd\u5305\u542b $[0,i]$\uff0c\u4e0b\u6807 $\\ge i$ \u7684 $ans$ \u7684\u503c\u5747\u4e3a $0$\u3002\n\n\u82e5\u4e3a\u7b2c 1\u30012 \u79cd\u60c5\u51b5\uff0c\u56e0\u4e3a\u4e24\u4e2a\u7aef\u70b9\u7684\u5b50\u6811\u5185\u5404\u53d6\u4e00\u70b9\u4f5c\u4e3a\u7aef\u70b9\u90fd\u80fd\u5f62\u6210\u4e00\u6761\u5305\u542b $[0,i]$ \u7684\u8def\u5f84\uff0c\u5219 $ans_i$ \u4e3a\u4e24\u4e2a\u7aef\u70b9\u5b50\u6811\u5927\u5c0f\u76f8\u4e58\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u82e5\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u4f4d\u4e8e\u6839\uff0c\u5373 $1$ \u5904\u65f6\uff0c\u8be5\u7aef\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u5e94\u51cf\u53bb**\u53e6\u4e00\u4e2a\u7aef\u70b9\u6240\u5728\u513f\u5b50**\u7684\u5b50\u6811\u5927\u5c0f\u3002\n\n\u81f3\u4e8e\u5982\u4f55\u5224\u65ad\u662f\u54ea\u79cd\u60c5\u51b5\uff0c\u53ea\u9700\u8981\u6c42 $\\text{LCA}$ \u5373\u53ef\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff0c\u8bf7\u6ce8\u610f\u5b9e\u73b0\u4e0e\u4e0a\u8ff0\u5185\u5bb9\u6709\u4e9b\u8bb8\u5dee\u5f02\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ri register int\ntypedef long long ll;\nconst int maxn=2e5+10;\nstruct node{\n\tint to,nxt;\n}e[maxn<<1];\nint hd[maxn],len;\ninline void addedge(int fr,int to){\n\te[++len]={to,hd[fr]};\n\thd[fr]=len;\n}\nint dep[maxn],fa[maxn],n,son[maxn],t,top[maxn];\nll siz[maxn];\nvoid dfs1(int p,int f){\n\tdep[p]=dep[f]+1;\n\tfa[p]=f;\n\tsiz[p]=1;\n\tfor(ri i=hd[p];i;i=e[i].nxt)\n\t\tif(e[i].to!=f){\n\t\t\tdfs1(e[i].to,p);\n\t\t\tsiz[p]+=siz[e[i].to];\n\t\t\tif(siz[e[i].to]>siz[son[p]])son[p]=e[i].to;\n\t\t}\n}\nvoid dfs2(int p,int k){\n\ttop[p]=k;\n\tif(son[p]){\n\t\tdfs2(son[p],k);\n\t\tfor(ri i=hd[p];i;i=e[i].nxt)\n\t\t\tif(!top[e[i].to])\n\t\t\t\tdfs2(e[i].to,e[i].to);\n\t}\n}\ninline int lca(int x,int y){\n\twhile(top[x]!=top[y]){\n\t\tif(dep[top[x]]<dep[top[y]])swap(x,y);\n\t\tx=fa[top[x]];\n\t}\n\treturn dep[x]<dep[y]?x:y;\n}\nll ans[maxn];\nint main(){\n\tscanf(\"%d\",&t);\n\twhile(t--){\n\t\tscanf(\"%d\",&n);\n\t\tlen=0;\n\t\tmemset(hd,0,sizeof hd);\n\t\tmemset(son,0,sizeof son);\n\t\tmemset(top,0,sizeof top);\n\t\tfor(ri i=1,x,y;i<n;++i){\n\t\t\tscanf(\"%d%d\",&x,&y),++x,++y;\n\t\t\taddedge(x,y),addedge(y,x);\n\t\t}\n\t\tdfs1(1,0);\n\t\tdfs2(1,1);\n\t\tmemset(ans,0,sizeof ans);\n\t\tll sum=1;\n\t\tfor(ri i=hd[1];i;i=e[i].nxt)ans[1]+=siz[e[i].to]*sum,sum+=siz[e[i].to];\n\t\tprintf(\"%lld\",1ll*n*(n-1)/2-ans[1]);\n\t\tri l=1,r=1,sl,sr;\n\t\tfor(ri i=2;i<=n;++i){\n\t\t\tri a=lca(i,l),b=lca(i,r);\n\t\t\tif(a==l&&b==1){\n\t\t\t\tif(l==1){\n\t\t\t\t\tsl=siz[i];\n\t\t\t\t\tfor(ri j=i;fa[j]>1;j=fa[j],sl=siz[j]);\n\t\t\t\t}\n\t\t\t\tl=i;\n\t\t\t}\n\t\t\telse if(b==r&&a==1){\n\t\t\t\tif(r==1){\n\t\t\t\t\tsr=siz[i];\n\t\t\t\t\tfor(ri j=i;fa[j]>1;j=fa[j],sr=siz[j]);\n\t\t\t\t}\n\t\t\t\tr=i;\n\t\t\t}\n\t\t\telse if(a!=i&&b!=i)break;\n\t\t\tif(l==1)ans[i]=siz[r]*(n-sr);\n\t\t\telse if(r==1)ans[i]=siz[l]*(n-sl);\n\t\t\telse ans[i]=siz[l]*siz[r];\n\t\t}\n\t\tfor(ri i=2;i<=n+1;++i)printf(\" %lld\",ans[i-1]-ans[i]);\n\t\tprintf(\"\\n\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1622189198,
        "uid": 67942,
        "name": "meyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1527D \u3010MEX Tree\u3011"
    },
    {
        "content": "\u6c42\u51fa $mex\\geq i$ \u7684\u8def\u5f84\u6570\uff0c\u7136\u540e\u518d\u5dee\u5206\u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u3002\n\n\u8ba1\u7b97 $mex\\geq i$ \u7684\u8def\u5f84\u6570\uff0c\u8003\u8651 $0\\sim i-1$ \u5728\u6811\u4e0a\u5fc5\u987b\u5f62\u6210\u7684\u4e00\u6761\u94fe\uff0c\u8def\u5f84\u6570\u5c31\u662f\u4e24\u4e2a\u7aef\u70b9\u5b50\u6811\u5927\u5c0f\u7684\u4e58\u79ef\u3002\n\n\u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u662f\u53e6\u4e00\u4e2a\u7aef\u70b9\u7684\u7956\u5148\uff0c\u90a3\u4e48\u5c31\u662f\u5e95\u90e8\u7684\u7aef\u70b9\u5b50\u6811\u5927\u5c0f $\\times $ \u9876\u90e8\u4ece\u4e0a\u5230\u4e0b\u7b2c\u4e8c\u4e2a\u8282\u70b9\u7684\u5b50\u6811\u8865\u5927\u5c0f\u3002\n\n\u627e\u5230\u9876\u90e8\u4ece\u4e0a\u5230\u4e0b\u7b2c\u4e8c\u4e2a\u8282\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528\u500d\u589e\u3002\n\n\u770b\u4e00\u4e2a\u70b9\u662f\u5426\u5728\u4e00\u6761\u94fe\u4e0a\uff0c\u5c31\u7b97\u4e00\u4e0b\u8fd9\u4e2a\u70b9\u5230\u8fd9\u6761\u94fe\u7684\u8ddd\u79bb\u5373\u53ef\u3002\n\n\u8003\u8651\u7ef4\u62a4\u8fd9\u6761\u94fe\u7684\u4e24\u4e2a\u7aef\u70b9\uff0c\u6bcf\u6b21\u65b0\u52a0\u8fdb\u6765\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\u770b\u770b\u8fd9\u4e2a\u70b9\u4f1a\u7834\u574f\u6389\u94fe\uff0c\u8fd8\u662f\u5728\u94fe\u4e2d\uff0c\u8fd8\u662f\u4f5c\u4e3a\u65b0\u7684\u7aef\u70b9\u3002\n\n\u7801\u529b\u5f52\u96f6\u9009\u624b\u8868\u793a\u597d\u96be\u5199\u3002\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\n#define int long long\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x, T2& ...y){ read(x); read(y...); }\nconst int N=200010;\nint n;\nint f[N],siz[N],dfn[N],dft,in[N],out[N],eft;\nint L,R;\nint pa[N][20];\nint dep[N];\nint trs[N];\nint getfa(int x){\n\treturn f[x]==x?x:f[x]=getfa(f[x]);\n}\nll ans[N];\nvi eg[N];\nvoid dfs1(int x,int fa){\n\ttrs[x]=1;\n\tif(x!=0){\n\t\tfor(auto v:eg[x])if(v!=fa)dfs1(v,x),trs[x]+=trs[v];\n\t}\n\telse\n\t\tfor(auto v:eg[x])if(v!=fa)dfs1(v,x),ans[1]+=1ll*trs[x]*trs[v],trs[x]+=trs[v];\n}\nvoid dfs2(int x,int fa){\n\tdep[x]=dep[fa]+1;trs[x]=1;dfn[x]=++dft;\n\tpa[x][0]=fa;\n\tfor(int i=1;i<=19;i++)pa[x][i]=pa[pa[x][i-1]][i-1];\n\tin[x]=++eft;\n\tfor(auto v:eg[x])if(v!=fa){\n\t\tdfs2(v,x);\n\t\ttrs[x]+=trs[v];\n\t}\n\tout[x]=++eft;\n}\nint findsub(int x,int y){\n\tfor(int i=19;~i;--i)\n\t\tif(dep[pa[y][i]]>dep[x])\n\t\t\ty=pa[y][i];\n\treturn y;\n}\nint chkfa(int x,int y){//y is x's fafafa\n\treturn in[y]<=in[x]&&out[x]<=out[y];\n}\nint LCA(int x,int y){\n\tif(dep[y]>dep[x])swap(x,y);\n\tfor(int i=19;~i;--i)\n\t\tif(dep[pa[x][i]]>=dep[y])\n\t\t\tx=pa[x][i];\n\tif(x==y)return x;\n\tfor(int i=19;~i;--i)\n\t\tif(pa[x][i]!=pa[y][i])\n\t\t\tx=pa[x][i],y=pa[y][i];\n\treturn pa[x][0];\n}\nint dis(int x,int y){\n\tint lca=LCA(x,y);\n\treturn dep[x]+dep[y]-2*dep[lca];\n}\nll calc(){\n\tif(dep[L]<dep[R])swap(L,R);\n\tint lca=LCA(L,R);\n\tif(lca==R){\n\t\treturn 1ll*trs[L]*(n-trs[findsub(R,L)]);\n\t}\n\telse{\n\t\treturn 1ll*trs[L]*trs[R];\n\t}\n}\nvoid solve(){\n\tread(n);dft=eft=0;\n\tfor(int i=0;i<=n;i++){\n\t\tans[i]=0;\n\t\tvi().swap(eg[i]);\n\t}\n\tL=0;R=1;\n\tfor(int i=1;i<n;i++){\n\t\tint u,v;read(u,v);\n\t\teg[u].pb(v);eg[v].pb(u);\n\t}\n\tdfs1(0,N-1);\n\tdfs2(0,N-1);\n\tfor(int x=1;x<n;x++){\n\t\tif(dep[L]<dep[R])swap(L,R);\n//\t\tdpi(L,R);\n\t\tif(dis(x,L)+dis(x,R)-dis(L,R)==0){\n\t\t\tans[x+1]=calc();\n\t\t}\n\t\telse{\n\t\t\tint lca=LCA(L,R);\n\t\t\tif(lca==R){\n\t\t\t\tif(chkfa(R,x))\n\t\t\t\t\tR=x;\n\t\t\t\telse{\n\t\t\t\t\tif(chkfa(x,L))L=x;\n\t\t\t\t\telse{\n\t\t\t\t\t\tint tl=findsub(R,L);\n//\t\t\t\t\t\tdbg(tl);\n\t\t\t\t\t\tif(chkfa(x,tl))break;\n\t\t\t\t\t\tR=x;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(chkfa(x,L))L=x;\n\t\t\t\telse if(chkfa(x,R))R=x;\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tans[x+1]=calc();\n\t\t}\n\t}\n\tans[0]=1ll*n*(n-1)/2;\n//\tfor(int i=0;i<=n;i++)cout << ans[i] << ' ';\n//\tputs(\"\");\n\tans[n+1]=0;\n\tfor(int i=0;i<=n;i++)cout << ans[i]-ans[i+1] << ' ';\n\tputs(\"\");\n\t\n}\nsigned main(){\n\tint T;read(T);\n\twhile(T--)solve();\n\treturn 0;\n}\n```",
        "postTime": 1659064632,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dCodeforces 1527D MEX Tree"
    },
    {
        "content": "> [\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/CF1527D)\n\n## #1.0 \u57fa\u672c\u601d\u8def\n\n\u9996\u5148\u9700\u8981\u7406\u89e3\u8fd9\u4e2a \"mex\" \u7684\u542b\u4e49\uff0c\u6211\u4eec\u9700\u8981\u627e\u51fa\u6240\u6709\u7684\u8def\u5f84\u4f7f\u5f97 $i$ \u662f\u7f16\u53f7\u6700\u5c0f\u7684\u672a\u51fa\u73b0\u7684\u70b9\uff0c\u90a3\u4e48\u4e5f\u5c31\u610f\u5473\u7740 $[0,i-1]$ \u5e94\u5f53\u5168\u90e8\u5305\u542b\u5728\u6211\u4eec\u8981\u627e\u7684\u8def\u5f84\u4e2d\u3002\u90a3\u4e48\u6211\u4eec\u4fbf\u53ef\u4ee5\u5c1d\u8bd5\u7ef4\u62a4\u8fd9\u6837\u7684\u8def\u5f84\uff1a\u8def\u5f84\u4e24\u7aef $x, y\\in[0,i-1]$\uff0c$[0\uff0ci-1]$ \u5305\u542b\u5728\u8def\u5f84\u7ecf\u8fc7\u7684\u70b9\u96c6\u4e2d\uff0c\u7136\u540e\u8ba1\u7b97\u6709\u591a\u5c11\u6761\u8def\u7ecf\u53ef\u4ee5\u4e0d\u7ecf\u8fc7 $i$\uff08\u8be2\u95ee\uff09\u3002\u6700\u540e\u518d\u5c1d\u8bd5\u5c06 $i$\u200b \u52a0\u5165\u5f53\u524d\u7ef4\u62a4\u7684\u8def\u5f84\uff08\u4fee\u6539\uff09\u3002\n\n\u4e0d\u59a8\u5148\u5c06\u6574\u68f5\u6811\u7684\u6839\u8282\u70b9\u8bbe\u4e3a $0$\u3002\n\n## #2.0 \u5206\u7c7b\u8ba8\u8bba\n\n>  \u4e0b\u6587\u4e2d\u4f1a\u53cd\u590d\u8fd0\u7528 LCA \u6765\u8fdb\u884c\u5224\u65ad\uff0c\u8fd9\u91cc\u91c7\u7528 st \u8868 $O(n\\log n)$ \u9884\u5904\u7406\uff0c$O(1)$\u200b \u8be2\u95ee\u7684\u65b9\u6cd5\u3002\u200b\n\n- `siz[i]` \u8868\u793a\u4ee5 $i$\u200b \u4e3a\u6839\u7684\u5b50\u6811\u5927\u5c0f\u3002\n- `sp` \u4e3a\u975e\u96f6\u7aef\u70b9\u6240\u5728 $0$ \u7684\u5bf9\u5e94\u513f\u5b50\u7684\u5b50\u6811\u5927\u5c0f\n\n\u672c\u9898\u6d89\u53ca\u5230\u7684\u60c5\u51b5\u6bd4\u8f83\u591a\uff0c\u8fd9\u91cc\u4f1a\u4e00\u4e00\u8ba8\u8bba\u3002\n\n### #2.1 \u8be2\u95ee\n\n\u5148\u6765\u770b\u8be2\u95ee\u7684\u90e8\u5206\uff0c\u6574\u4f53\u5206\u4e3a $3$\u200b \u79cd\u60c5\u51b5\uff1a\n\n- **$i$ \u5728\u5f53\u524d\u8def\u5f84\u4e2d**\uff1b\n- **$i$ \u662f\u5f53\u524d\u8def\u5f84\u7aef\u70b9\u7684\u5b50\u5b59**\uff1b\n- **$i$ \u4e0d\u5c5e\u4e8e\u4e0a\u9762\u7684\u4efb\u610f\u4e00\u79cd\u60c5\u51b5**\uff1b\n\n\u8fd9\u91cc\u518d\u62ce\u51fa\u6765\u4e24\u79cd\u6bd4\u8f83\u7279\u6b8a\u7684\u60c5\u51b5\uff1a$mex=0$ \u548c $mex=1.$\n\n\u5f53 $mex=0$\u200b \u65f6\uff0c\u6bcf\u6b21\u9009\u62e9\u7684\u8def\u5f84\u5e94\u5f53\u662f\u90fd\u5728\u540c\u4e00 $0$\u200b \u7684\u5b50\u6811\u5185\u7684\u4e24\u4e2a\u70b9\u4e3a\u7aef\u70b9\uff1b\u5f53 $mex=1$\u200b\u200b \u65f6\uff0c\u53ef\u884c\u7684\u8def\u5f84\u6570\u4e3a\u5728\u53bb\u6389 $1$\u200b \u7684\u5b50\u6811\u540e\u7684\u70b9\u96c6\u4e2d\u4efb\u610f\u9009\u53d6\u4e24\u4e2a\u70b9\u4ea7\u751f\u7684\u8def\u5f84\u6761\u6570\uff0c\u51cf\u53bb\u4e0d\u7ecf\u8fc7 $0$ \u7684\u8def\u5f84\u6570\u91cf\uff08\u5373\u5728\u4ec5\u5728 $0$\u200b \u7684\u5b50\u8282\u70b9\u7684\u5b50\u6811\u5185\u7684\u8def\u5f84\uff09\uff0c\u9700\u8981\u7279\u5224\u662f $1$ \u7684\u7956\u5148\u7684\u5b50\u6811\u7684\u60c5\u51b5\uff0c\u91c7\u7528 LCA \u5224\u65ad\u3002\u8ba1\u7b97\u4ee3\u7801\u5982\u4e0b\uff1a\n\n``` cpp\ninline void pre_ans() {\n    ans[1] = (siz[0] - siz[1]) * (siz[0] - siz[1] - 1) / 2;\n    for (int i = head[0]; i; i = e[i].nxt) {\n        ans[0] += (1ll * siz[e[i].v] * (siz[e[i].v] - 1)) / 2;\n        int lca = LCA(1, e[i].v);\n        if (lca == e[i].v) ans[1] -= ((siz[e[i].v] - siz[1])\n                                    * (siz[e[i].v] - siz[1] - 1) / 2);\n        else ans[1] -= siz[e[i].v] * (siz[e[i].v] - 1) / 2;\n    }\n}\n```\n\n\u89e3\u51b3\u4e0a\u9762\u7684\u4e24\u79cd\u7279\u6b8a\u60c5\u51b5\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u5c06\u6240\u6709\u60c5\u51b5\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a\n\n- **\u8def\u5f84\u4e00\u7aef\u662f\u96f6**\uff1b\n- **\u8def\u5f84\u4e24\u7aef\u90fd\u4e0d\u662f\u96f6**\uff1b\n\n\u5148\u6765\u770b\u8def\u5f84\u4e00\u7aef\u662f\u96f6\uff08\u4e24\u7aef\u5206\u522b\u4e3a $x,0$\uff09\u7684\u60c5\u51b5\uff1a\n\n- **$i$\u200b \u5728\u5f53\u524d\u8def\u5f84\u4e2d**\uff1b\n\n  $LCA(x,i)=i$\uff0c\u8fd9\u79cd\u60c5\u51b5\u7b54\u6848\u4e00\u5b9a\u4e3a $0$\uff1b\n\n- **$i$ \u662f\u5f53\u524d\u8def\u5f84\u7aef\u70b9\u7684\u5b50\u5b59**\uff1b\n  1. $i$\u200b \u662f\u4e0d\u4e3a\u96f6\u7684\u4e00\u7aef\u7684\u7aef\u70b9\u7684\u5b50\u5b59\u3002\u90a3\u4e48\u7b54\u6848\u5e94\u5f53\u662f `(siz[x] - siz[i]) * (siz[0] - sp)`\u3002\u8fd9\u79cd\u60c5\u51b5\u7684\u5224\u65ad\u6761\u4ef6 $LCA(x,i)=x$\uff1b\n  2. $i$\u200b \u662f\u4e0d\u4e0e\u975e\u96f6\u7aef\u70b9\u6240\u5728 $0$\u200b \u7684\u5bf9\u5e94\u513f\u5b50\u7684\u5b50\u6811\u4e2d\u3002\u90a3\u4e48\u7b54\u6848\u662f `(siz[0] - sp - siz[i]) * siz[x]`\u3002\u8fd9\u79cd\u60c5\u51b5\u7684\u5224\u65ad\u6761\u4ef6 $LCA(x, i)=0$\u200b\uff1b\n\n- **$i$ \u4e0d\u5c5e\u4e8e\u4e0a\u9762\u7684\u4efb\u610f\u4e00\u79cd\u60c5\u51b5**\uff1b\n\n  \u90a3\u4e48\u4e5f\u5c31\u610f\u5473\u7740 $i$ \u662f\u5f53\u524d\u8def\u5f84\u4e0a\u7684\u4e00\u4e2a\u5206\u53c9\uff0c\u7b54\u6848\u5373\u4e3a `(siz[0] - sp) * siz[x]`\u3002\n\n\u518d\u6765\u770b\u8def\u5f84\u4e24\u7aef $x,y$ \u90fd\u4e0d\u662f\u96f6\u7684\u60c5\u51b5\uff1a\n\n- **$i$ \u5728\u5f53\u524d\u8def\u5f84\u4e2d**\uff1b\n\n  $LCA(x,i)=i$ \u6216 $LCA(y,i)=i$\u200b\uff0c\u90a3\u4e48\u7b54\u6848\u4e3a\u96f6\uff1b\n\n- **$i$ \u662f\u5f53\u524d\u8def\u5f84\u7aef\u70b9\u7684\u5b50\u5b59**\uff1b\n\n  \u7b54\u6848\u4e3a\u5bf9\u5e94\u7aef\u70b9\u5b50\u6811\u5927\u5c0f\u51cf\u53bb `siz[i]` \u518d\u4e58\u4e0a\u53e6\u4e00\u7aef\u70b9\u5b50\u6811\u5927\u5c0f\uff1b\n\n- **$i$\u200b \u4e0d\u5c5e\u4e8e\u4e0a\u9762\u7684\u4efb\u610f\u4e00\u79cd\u60c5\u51b5**\uff1b\n\n  \u7b54\u6848\u4e3a `siz[x] * siz[y]`\uff1b\n\n\u4ee5\u4e0a\uff0c\u4fbf\u662f\u67e5\u8be2\u64cd\u4f5c\u7684\u6240\u6709\u5185\u5bb9\u3002\u4ee5\u4e0b\u662f\u4ee3\u7801:\n\n``` cpp\ninline ll GetAns(int k){\n    int lca1 = LCA(k, lp), lca2 = LCA(k, rp);\n    ll res1, res2;\n    if (rp) { //\u8fd9\u91cc\u5728\u63d2\u5165\u65f6\u4f1a\u4fdd\u8bc1\u4e3a 0 \u7684\u4e00\u7aef\u4e00\u5b9a\u662f rp\n        res1 = siz[lp]; res2 = siz[rp];\n        if (lca1 == k || lca2 == k) return 0;\n        /*i \u5728\u5f53\u524d\u8def\u5f84\u4e0a*/\n        else if (lca1 == lp) res1 -= siz[k];\n        else if (lca2 == rp) res2 -= siz[k];\n        /*\u4e24\u79cd\u4e0d\u540c\u7684\u60c5\u51b5*/\n    } else {\n        res1 = siz[lp]; res2 = siz[rp] - sp;\n        if (lca1 == k || lca2 == k) return 0;\n        else if (lca1 == lp) res1 -= siz[k];\n        else if (lca1 == 0) res2 -= siz[k];\n    }\n    return res1 * res2;\n}\n```\n\n### #2.2 \u4fee\u6539\n\n\u73b0\u5728\u6765\u5c1d\u8bd5\u5c06 $i$ \u52a0\u5165\u5f53\u524d\u6240\u7ef4\u62a4\u7684\u8def\u5f84\u3002\n\n\u4ecd\u65e7\u5206\u4e3a\u4e24\u79cd\u5927\u60c5\u51b5\uff1a\n\n- \u81f3\u5c11\u4e00\u7aef\u4e3a $0$\uff1b\n- \u4e24\u7aef\u90fd\u4e0d\u4e3a $0$\uff1b\n\n\u82e5\u4e24\u7aef\u90fd\u4e0d\u4e3a $0$\uff0c\u90a3\u4e48\u6709\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\uff1a\n\n- **\u5728\u8def\u5f84\u4e0a**\u3002\u5373 $LCA(x, i)=i$ \u6216 $LCA(y,i)=i$\uff0c\u90a3\u4e48\u8bf4\u660e $i$ \u5df2\u7ecf\u5728\u8def\u5f84\u4e0a\u3002\n- **\u662f\u5176\u4e2d\u4e00\u7aef\u7684\u513f\u5b50**\uff0c\u5373 $LCA(x,i)=x$ \u6216 $LCA(y,i)=y$\uff0c\u5c06\u5bf9\u5e94\u7684\u7aef\u70b9\u8bbe\u7f6e\u4e3a $i$ \u5373\u53ef\uff1b\n- **\u4e0d\u5c5e\u4e8e\u4e0a\u9762\u7684\u4e24\u79cd\u60c5\u51b5**\uff0c\u5373\u662f\u5f53\u524d\u8def\u5f84\u7684\u5206\u53c9\uff0c\u90a3\u4e48\u663e\u7136\u4e0d\u53ef\u80fd\u5c06 $[1,i]$ \u901a\u8fc7\u4e00\u6761\u8def\u5f84\u76f8\u8fde\uff0c\u90a3\u4e48\u540e\u9762\u7684\u6240\u6709\u7b54\u6848\u6570\u90fd\u5e94\u5f53\u662f $0$\u200b\u3002\n\n\u82e5\u5b58\u5728\u81f3\u5c11\u4e00\u7aef $y=0$\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a\n\n- \u53e6\u4e00\u7aef\u4e5f\u662f $0$\uff0c\u90a3\u4e48\u4ee4\u5176\u4e2d\u4e00\u7aef\u53d8\u4e3a $i$\uff1b\n- $LCA(x,i)=i$\uff0c\u5df2\u7ecf\u5728\u8def\u5f84\u4e0a\uff1b\n- $LCA(x,i)=i$\uff0c\u66f4\u65b0 $x=i$\u200b\uff1b\n- \u4e0d\u5c5e\u4e8e\u4e0a\u9762\u7684\u60c5\u51b5\u4f46 $LCA(x,i)\\ne0$\uff0c\u90a3\u4e48\u610f\u5473\u7740\u5206\u53c9\u4e86\uff0c\u63d2\u5165\u5931\u8d25\uff1b\n- $x\\ne0$ \u4e14 $LCA(x,i)=0$\uff0c\u90a3\u4e48\u66f4\u65b0 $y=0$\uff1b\n\n``` cpp\ninline bool add(int x) {\n    int lf = LCA(lp, x), rf = LCA(rp, x);\n    if (rp) {\n        if (lf == lp) {lp = x; return true;}\n        else if (lf == x) return true;\n        if (rf == rp) {rp = x; return true;}\n        else if (rf == x) return true;\n    } else {\n        if (lf && (lf != lp && lf != x)) return false;\n        else if (lf == lp) {lp = x; return true;}\n        else if (lf == x) return true;\n        else if (lf) return false;\n        else {rp = x; return true;}\n    }\n    return false;\n}\n```\n\n## #3.0 \u5b8c\u6574\u4ee3\u7801\n\n> \u6709\u8bb8\u591a\u6570\u7ec4\u53ef\u4ee5\u4e0d `memset()` \u5c31\u4e0d `memset()`\uff1b\u6bd4\u5982\u672c\u9898\u4e2d\u7684 `dep[]` \u548c `siz[]`\uff1b\n\n``` cpp\nconst int N = 600010;\nconst int INF = 0x3fffffff;\n\nstruct Edge {\n    int u, v;\n    int nxt;\n};\nEdge e[N << 1];\n\nint n, head[N], cnt = 1, st[N << 1], scnt, lp, rp;\nint mn[N << 1][30], dep[N], w[N], rt, t, lg2[N], f1, f2;\nll ans[N], sp, siz[N];\n\ninline void clear() { //\u6e05\u7a7a\n    cnt = 1, scnt = lp = rp = 0;\n    mset(head, 0); dep[0] = 0;\n}\n\ninline void add(const int &u, const int &v) {\n    e[cnt].u = u, e[cnt].v = v;\n    e[cnt].nxt = head[u], head[u] = cnt ++;\n}\n\ninline int LCA(int a, int b) { //O(1) \u83b7\u5f97 LCA\n    int l = w[a], r = w[b];\n    if (r < l) swap(l, r);\n    int k = lg2[r - l + 1];\n    if (dep[mn[l][k]] < dep[mn[r - (1 << k) + 1][k]])\n        return mn[l][k];\n    else return mn[r - (1 << k) + 1][k];\n}\n\nvoid dfs(int x, int fa) { //\u8ba1\u7b97 siz[],dep[] \u7b49\u6570\u7ec4\n    st[++ scnt] = x, w[x] = scnt;\n    siz[x] = 1, dep[x] = dep[fa] + 1;\n    for (int i = head[x]; i; i = e[i].nxt) {\n        if (e[i].v == fa) continue;\n        dfs(e[i].v, x); st[++ scnt] = x;\n        siz[x] += siz[e[i].v];\n    }\n}\n\ninline void get_st() { //\u8ba1\u7b97 st \u8868\uff0c\u7528\u4e8e O(1) LCA\n    lg2[1] = 0;\n    for (int i = 2; i <= scnt; ++ i) lg2[i] = lg2[i >> 1] + 1;\n    for (int i = 1; i <= scnt; ++ i) mn[i][0] = st[i];\n    for (int j = 1; j <= lg2[scnt]; ++ j)\n      for (int i = 1; i + (1 << j) - 1 <= scnt; ++ i)\n        if (dep[mn[i][j - 1]] < dep[mn[i + (1 << (j - 1))][j - 1]])\n          mn[i][j] = mn[i][j - 1];\n        else mn[i][j] = mn[i + (1 << (j - 1))][j - 1];\n}\n\ninline void pre_ans() { //\u9884\u5904\u7406 0 \u548c 1 \u7684\u7b54\u6848\n    ans[1] = (siz[0] - siz[1]) * (siz[0] - siz[1] - 1) / 2;\n    for (int i = head[0]; i; i = e[i].nxt) {\n        ans[0] += (1ll * siz[e[i].v] * (siz[e[i].v] - 1)) / 2;\n        int lca = LCA(1, e[i].v);\n        if (lca == e[i].v) ans[1] -= ((siz[e[i].v] - siz[1])\n                                    * (siz[e[i].v] - siz[1] - 1) / 2);\n        else ans[1] -= siz[e[i].v] * (siz[e[i].v] - 1) / 2;\n    }\n}\n\ninline bool add(int x) { //\u5c1d\u8bd5\u5c06\u70b9\u52a0\u5165\u8def\u5f84\n    int lf = LCA(lp, x), rf = LCA(rp, x);\n    if (rp) {\n        if (lf == lp) {lp = x; return true;}\n        else if (lf == x) return true;\n        if (rf == rp) {rp = x; return true;}\n        else if (rf == x) return true;\n    } else {\n        if (lf && (lf != lp && lf != x)) return false;\n        else if (lf == lp) {lp = x; return true;}\n        else if (lf == x) return true;\n        else if (lf) return false;\n        else {rp = x; return true;}\n    }\n    return false;\n}\n\ninline ll GetAns(int k){ //\u8ba1\u7b97\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\n    int lca1 = LCA(k, lp), lca2 = LCA(k, rp);\n    ll res1, res2;\n    if (rp) {\n        res1 = siz[lp]; res2 = siz[rp];\n        if (lca1 == k || lca2 == k) return 0;\n        else if (lca1 == lp) res1 -= siz[k];\n        else if (lca2 == rp) res2 -= siz[k];\n    } else {\n        res1 = siz[lp]; res2 = siz[rp] - sp;\n        if (lca1 == k || lca2 == k) return 0;\n        else if (lca1 == lp) res1 -= siz[k];\n        else if (lca1 == 0) res2 -= siz[k];\n    }\n    return res1 * res2;\n}\n\nint main(){\n    scanf(\"%d\", &t);\n    while (t --) {\n        scanf(\"%d\", &n); clear();\n        for (int i = 1; i < n; ++ i) {\n            int u, v; scanf(\"%d%d\", &u, &v);\n            add(u, v); add(v, u);\n        }\n        dfs(rt = 0, 0); get_st(); pre_ans();\n        /*\u8fdb\u884c\u6240\u9700\u8981\u7684\u9884\u5904\u7406*/\n        for (int i = head[0]; i; i = e[i].nxt)\n          if (LCA(e[i].v, 1) == e[i].v) {\n              sp = siz[e[i].v]; break;\n          } //\u8ba1\u7b97 sp\n        for (int i = 2; i <= n; ++ i) {\n            if (!add(i - 1)) break; \n            //\u5c1d\u8bd5\u52a0\u5165 i-1\uff0c\u4e0d\u884c\u5c31\u9000\u51fa\n            if (i == n) {ans[i] = 1; break;}\n            /*\u5982\u679c i == n\uff0c\u90a3\u4e48\u663e\u7136\u53ea\u5b58\u5728\u4e00\u6761\u8def\u5f84\n            \u8d2f\u7a7f\u6574\u4e2a\u6811\uff08\u5176\u5b9e\u662f\u4e00\u6761\u94fe\uff09*/\n            ans[i] = GetAns(i);\n        }\n        for (int i = 0; i <= n; ++ i) {\n            printf(\"%lld \", ans[i]);\n            ans[i] = 0;\n        }\n        printf(\"\\n\");\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1627277415,
        "uid": 162191,
        "name": "Dfkuaid",
        "ccfLevel": 6,
        "title": "[\u9898\u89e3]CF1527D MEX Tree"
    },
    {
        "content": "\u5bf9\u4e8e\u4e0d\u7ecf\u8fc7 $0$ \u70b9\u7684\u8def\u5f84\uff0c\u663e\u7136\u5176 $\\operatorname{mex}$ \u503c\u4e3a $0$ \u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4ee5 $0$ \u53f7\u70b9\u4e3a\u6839\u7ed3\u70b9\uff0c\u5219\u6240\u6709 $\\operatorname{mex}$ \u503c\u5927\u4e8e $0$ \u7684\u8def\u5f84\u5fc5\u987b\u7ecf\u8fc7\u6839\u7ed3\u70b9\uff0c\u65b9\u4fbf\u5c06\u6765\u7684\u8ba1\u7b97\u3002\n\n\u6ee1\u8db3 $\\operatorname{mex} \\geq k$ \u7684\u4e00\u6761\u6700\u77ed\u8def\u5f84\u53ef\u80fd\u7531\u4e00\u4e2a\u6216\u4e24\u4e2a\u975e $0$ \u7684\u7aef\u70b9\u3002\u6211\u4eec\u5728\u8fd0\u7b97\u65f6\u7ef4\u62a4\u8fd9\u4e24\u4e2a\u7aef\u70b9\uff0c\u540c\u65f6\u7ef4\u62a4\u6bcf\u4e2a\u8282\u70b9\u7684\u6700\u8fdc\u975e $0$ \u7956\u5148\uff0c\u8fd9\u6837\u53ef\u4ee5\u65b9\u4fbf\u5730\u7531\u5b83\u4eec\u63a8\u51fa\u6ee1\u8db3 $\\operatorname{mex}\\geq k$ \u7684\u8def\u5f84\u6761\u6570\uff08\u5373\u5b8c\u5168\u5305\u542b\u8fd9\u6761\u6700\u77ed\u8def\u5f84\u7684\u8def\u5f84\u6761\u6570\uff09\uff1a\n\n$$\ncnt_k=\\begin{cases}\nsiz_{st}*(n-siz_{bel_1}),& ed=0 \\\\\nsiz_{st}*siz_{ed},& \\text{otherwise.}\n\\end{cases}\n$$\n\n\u5176\u4e2d $siz_k$ \u4e3a $k$ \u7ed3\u70b9\u5b50\u6811\u5927\u5c0f\uff0c$bel_k$ \u4e3a $k$ \u7ed3\u70b9\u7684\u6df1\u5ea6\u6700\u5c0f\u7684\u975e $0$ \u7956\u5148\uff0c$cnt_k$ \u4e3a\u6ee1\u8db3 $\\operatorname{mex} \\geq k$ \u7684\u8def\u5f84\u6570\uff0c $st,ed$ \u4e3a\u6b64\u6700\u77ed\u8def\u5f84\u7684\u975e $0$ \u7aef\u70b9\u3002\u7279\u522b\u5730\uff0c\u5f53\u6b64\u6700\u77ed\u8def\u5f84\u53ea\u6709\u4e00\u4e2a\u975e $0$ \u7aef\u70b9\u65f6\uff0c\u4ee4 $ed$ \u4e3a $0$ \u3002\n\n\u56e0\u6b64\uff0c\u5728\u5bf9\u4e00\u6761\u8def\u5f84\u8fdb\u884c\u62d3\u5c55\uff08\u6307\u7531 $\\operatorname{mex} \\geq k$ \u7684\u8def\u5f84\u6761\u6570\u53ca\u5176\u6ee1\u8db3\u7684\u6027\u8d28\u63a8\u51fa $\\operatorname{mex} \\geq k+1$ \u7684\u8def\u5f84\u6761\u6570\u7684\u64cd\u4f5c\uff09\u65f6\uff0c\u53ef\u80fd\u9047\u5230\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a\n\n1.  $k$ \u7ed3\u70b9\u4e3a $st$ \u7ed3\u70b9\u7684\u7956\u5148\u6216\u540e\u4ee3\u3002\u6b64\u65f6\u82e5 $k$ \u7ed3\u70b9\u7684\u6df1\u5ea6\u5927\u4e8e $st$ \u7ed3\u70b9\u7684\u6df1\u5ea6\uff0c\u5219\u5c06 $st$ \u8d4b\u4e3a $k$ \u3002\n\n2.  $k$ \u7ed3\u70b9\u4e0e $st$ \u7ed3\u70b9\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u975e $0$ \u4e14\u4e0d\u6ee1\u8db3\u60c5\u51b5 $1$ \uff0c\u5373 $bel_k = bel_{st} $ \u3002\u6b64\u65f6\u4e0d\u5b58\u5728 $\\operatorname{mex} \\geq k+1$ \u7684\u7b80\u5355\u8def\u5f84\u3002\n\n3.  $k$ \u7ed3\u70b9\u4e3a $ed$ \u7ed3\u70b9\u7684\u7956\u5148\u6216\u540e\u4ee3\u4e14\u4e0d\u6ee1\u8db3\u60c5\u51b5 $1,2$ \uff08\u5305\u62ec $ed=0$ \u7684\u60c5\u51b5\uff09\u3002\u5904\u7406\u65b9\u5f0f\u4e0e\u60c5\u51b5 $1$ \u65b9\u5f0f\u7c7b\u4f3c\u3002\n\n4.  \u4e0d\u6ee1\u8db3\u60c5\u51b5 $1,2,3$ \u3002\u6b64\u65f6\u540c\u6837\u4e0d\u5b58\u5728 $\\operatorname{mex} \\geq k+1$ \u7684\u7b80\u5355\u8def\u5f84\u3002\n\n\u5bf9\u4e8e\u67d0\u7ed3\u70b9\u662f\u5426\u4e3a\u53e6\u4e00\u7ed3\u70b9\u7684\u7956\u5148\u6216\u540e\u4ee3\uff0c\u6211\u4eec\u6709 $O(n)$ \u9884\u5904\u7406\uff0c $O(1)$ \u67e5\u8be2\u7684\u5728\u7ebf\u505a\u6cd5\u3002\n\n\u8003\u8651\u5229\u7528\u4e00\u68f5\u6811\u7684 dfn \u5e8f\u3002\u5bf9\u4e8e\u4e00\u4e2a\u7ed3\u70b9 $i$ \uff0c\u5b83\u7684\u5b50\u6811\u7684 dfn \u5e8f\u4e00\u5b9a\u662f\u4ee5\u6b64\u7ed3\u70b9 dfn \u5e8f\u4e3a\u9996\u7684\u4e00\u6bb5\u957f\u4e3a $siz_i-1$ \u8fde\u7eed\u5e8f\u5217\u3002\u6545\u800c\u5224\u65ad\u67d0\u7ed3\u70b9\u662f\u5426\u4e3a\u53e6\u4e00\u7ed3\u70b9\u7684\u540e\u4ee3\uff0c\u53ea\u9700\u770b\u5b83\u7684 dfn \u5e8f\u662f\u5426\u5728\u53e6\u4e00\u7ed3\u70b9\u7684\u5b50\u6811 dfn \u5e8f\u5217\u4e2d\u5373\u53ef\uff0c\u662f\u5426\u4e3a\u53e6\u4e00\u7ed3\u70b9\u7684\u7956\u5148\u5219\u53cd\u4e4b\u3002\u6545\u800c\u53ea\u9700\u5728 dfs \u6c42\u6df1\u5ea6\u548c\u5b50\u6811\u5927\u5c0f\u65f6\uff0c\u987a\u4fbf\u6c42\u5176 dfn \u5e8f\u5373\u53ef\u3002\n\n\u6838\u5fc3\u4ee3\u7801\uff1a\n\n```cpp\n\nvoid dfs(const int &p){\n\tsiz[p]=1;\n\tdfn[p]=++tim;\n\tint lp,to;\n\tfor(lp=h[p];lp;lp=E[lp].nxt){\n\t\tto=E[lp].to;if(siz[to]) continue;\n\t\tdep[to]=dep[p]+1;bel[to]=u;\n\t\tdfs(to);siz[p]+=siz[to];\n\t}\n\tEnd[p]=tim;//\u6b64\u5904\u4e3a\u4e86\u65b9\u4fbf\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bb0\u5f55\u6b64\u8282\u70b9\u7684\u5b50\u6811\u5bf9\u5e94\u7684 dfn \u5e8f\u5217\u7684\u5de6\u53f3\u7aef\u70b9\n}\n#define in(x,y) ((dfn[x]<dfn[y])&&(End[x]>=dfn[y]))\n#define rel(x,y) ((in(x,y))||(in(y,x)))\n\n//main\u51fd\u6570\u4e2d\uff1a\ndep[0]=1;siz[0]=End[0]=n;dfn[0]=tim=1;\nfor(i=h[0];i;i=E[i].nxt){\n\tu=E[i].to;bel[u]=u;\n\tdep[u]=2;dfs(u);\n\tall+=s*siz[u];\n\ts+=siz[u];\n}\ncnt[0]=((n-1ll)*n)>>1LL;\ncnt[1]=all;cnt[2]=siz[1]*(n-siz[bel[1]]);\nst=1;ed=0;\neds=n-siz[bel[1]];\nfor(i=2;i<n;++i){\n\tif(rel(i,st)){if(dep[st]<dep[i]) st=i;}\n\telse if(bel[i]==bel[1]) break;\n\telse if(rel(i,ed)){if(dep[ed]<dep[i]) ed=i;}\n\telse break;\n\tif(ed) cnt[i+1]=siz[st]*siz[ed];\n\telse cnt[i+1]=siz[st]*eds;\n}\nfor(i=0;i<=n;++i) printf(\"%lld \",cnt[i]-cnt[i+1]);\n```\n",
        "postTime": 1646994963,
        "uid": 546086,
        "name": "Francais_Drake",
        "ccfLevel": 7,
        "title": "CF1527D"
    }
]