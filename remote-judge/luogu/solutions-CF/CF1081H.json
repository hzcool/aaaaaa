[
    {
        "content": "\u7ed3\u8bba\u7684\u8bc1\u660e\u8bf7\u79fb\u6b65[\u8fd9\u91cc](https://www.luogu.com.cn/blog/user25308/proof-cf1081h)\u3002\n\n### \u4e00\u70b9\u5b9a\u4e49\n\n\u6211\u4eec\u79f0 $t$ \u4e3a $s$ \u7684\u4e00\u4e2a **border**\uff0c\u5f53\u4e14\u4ec5\u5f53 $s[1,t]=s[|s|-t+1,|s|]$\u3002\n\n---\n\n\u7279\u522b\u5730\uff0c\u6211\u4eec\u4ee4 $border(s)$ \u4e3a $s$ \u6700\u957f\u7684 border\uff0c\u5982 $border('aba')='a'$, $border('ab')=''$(\u7a7a\u4e32)\u3002\n\n---\n\n\u6211\u4eec\u79f0 $s$ \u662f\u4e00\u4e2a**\u5faa\u73af\u4e32**\uff0c\u5f53\u4e14\u4ec5\u5f53 $s$ \u5b58\u5728\u4e00\u4e2a\u4e0d\u7b49\u4e8e $|s|$ \u7684**\u5b8c\u5168\u5468\u671f**\u3002\n\n---\n\n\u4ee4 $S=pq$\uff0c$p,q$ \u662f\u4e24\u4e2a\u975e\u7a7a\u56de\u6587\u4e32\uff0c\u6211\u4eec\u79f0 $(p,q)$ \u662f\u4e00\u7ec4 $S$ \u7684**\u56de\u6587\u62c6\u5206**\u3002\n\n\u82e5 $S=pq$\uff0c$p,q$ \u662f\u4e24\u4e2a\u56de\u6587\u4e32\u4e14 $q$ \u975e\u7a7a\uff0c\u5219\u6211\u4eec\u79f0 $(p,q)$ \u662f\u4e00\u7ec4 $S$ \u7684**\u975e\u4e25\u683c\u56de\u6587\u62c6\u5206**\u3002\n\n---\n\n### \u9898\u89e3\n\n\u8003\u8651\u600e\u4e48\u7edf\u8ba1\u9898\u4e0a\u8981\u6c42\u7684\u5b57\u7b26\u4e32\u3002\n\n\u4e0d\u8003\u8651\u53bb\u91cd\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba1\u6570 $A$ \u4e2d\u672c\u8d28\u4e0d\u540c\u7684\u56de\u6587\u4e32\u4e2a\u6570\u548c $B$ \u4e2d\u672c\u8d28\u4e0d\u540c\u7684\u56de\u6587\u4e32\u4e2a\u6570\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u4e24\u4e2a\u4e58\u8d77\u6765\u3002\u8fd9\u663e\u7136\u4f1a\u8ba1\u91cd\u3002\n\n\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u7ed3\u8bba\u662f\uff0c\u8bbe\u4e00\u4e2a\u4e32 $S$ \u7684\u6240\u6709\uff08\u53ef\u4ee5\u975e\u4e25\u683c\uff09\u56de\u6587\u62c6\u5206\u4e3a $p_1q_1,p_2q_2,\\cdots,p_tq_t$\uff0c\u4e14 $|p_1|<|p_2|<\\cdots<|p_t|$\uff0c\u5219 $p_i=border(p_{i+1}),q_{i+1}=border(q_i)$ \u4e2d\u81f3\u5c11\u6709\u4e00\u6761\u6210\u7acb\u3002\n\n\u5047\u8bbe $S=xy$\uff0c\u5982\u679c\u7528 $border(x)$ \u4ee3\u66ff $x$ \u540e\u80fd\u5f97\u5230\u4e00\u79cd\u51d1\u51fa $S$ \u7684\u65b9\u6cd5\uff0c\u6216\u8005\u7528 $border(y)$ \u4ee3\u66ff $y$ \u540e\u80fd\u5f97\u51fa\u4e00\u79cd\u51d1\u51fa $S$ \u7684\u65b9\u6cd5\uff0c\u663e\u7136\u6b64\u65f6 $S$ \u5c31\u88ab\u91cd\u590d\u7edf\u8ba1\u4e86\u3002\n\n\u73b0\u5728\u95ee\u9898\u53d8\u6210\u4e86\uff1a\u5bf9\u4e8e\u4e00\u4e2a $A$ \u4e2d\u7684\u56de\u6587\u4e32 $x$\uff0c\u6211\u4eec\u60f3\u8981\u77e5\u9053\u6709\u591a\u5c11\u4e2a $S$ \u65e2\u80fd\u4ece $x$ \u5f97\u5230\u53c8\u80fd\u4ece $border(x)$ \u5f97\u5230\uff0c\u7136\u540e\u5c06\u7b54\u6848\u51cf\u53bb\u90a3\u4e48\u591a\u3002\u627e\u5230 $x$ \u548c $border(x)$ \u5206\u522b\u662f\u5565\u662f\u7b80\u5355\u7684\uff0c\u53ea\u9700\u8981\u4e00\u68f5\u56de\u6587\u6811\u5373\u53ef\u3002\n\n\u4ee4 $x=border(x)w$\uff0c\u6211\u4eec\u8981\u6570\u7684\u5c31\u662f\u5728 $B$ \u4e2d\u6709\u591a\u5c11\u4e2a $T$\uff0c\u4f7f\u5f97 $T=wS$\uff0c\u4e14 $S$ \u548c $T$ \u90fd\u662f $B$ \u4e2d\u7684\u56de\u6587\u4e32\u3002\u56e0\u4e3a $|w|$ \u662f $x$ \u6700\u77ed\u7684\u5468\u671f\uff0c\u56e0\u6b64 $w$ \u4e0d\u662f\u4e00\u4e2a\u5faa\u73af\u4e32\u3002\n\n\u82e5 $|w|>|S|$\uff0c\u5219 $w$ \u4e00\u5b9a\u53ef\u4ee5\u5199\u6210 $S+U$\uff0c$U$ \u662f\u67d0\u4e2a\u56de\u6587\u4e32\uff08\u56e0\u4e3a\u8981\u6ee1\u8db3 $wS$ \u662f\u56de\u6587\u4e32\uff09\u3002\n\n\u56e0\u4e3a $w$ \u4e0d\u662f\u4e00\u4e2a\u5faa\u73af\u4e32\uff0c\u6709\u7ed3\u8bba\u662f\uff0c$w$ \u53ea\u6709\u81f3\u591a\u4e00\u79cd\u975e\u4e25\u683c\u56de\u6587\u62c6\u5206\uff0c\u5e76\u4e14\u8fd9\u4e2a\u975e\u4e25\u683c\u56de\u6587\u62c6\u5206\u4e00\u5b9a\u5305\u542b $w$ \u7684\u6700\u957f\u56de\u6587\u524d\u7f00/\u540e\u7f00\uff0c\u6211\u4eec\u53ea\u9700\u8981\u9a8c\u8bc1\u8fd9\u4e2a\u5373\u53ef\uff0c\u7136\u540e\u4f7f\u7528\u54c8\u5e0c\u9a8c\u8bc1 $S$ \u548c $wS$ \u662f\u5426\u5728 $B$ \u4e2d\u5b58\u5728\u5373\u53ef\u3002\n\n\u82e5 $|w|\\leq|S|$\uff0c\u82e5 $S$ \u4e0d\u662f $T$ \u7684\u6700\u957f\u56de\u6587\u540e\u7f00\uff0c\u8bb0\u6700\u957f\u56de\u6587\u540e\u7f00\u4e3a $P$\uff0c\u6709 $|T|-|P|$ \u662f\u4e00\u4e2a $T$ \u7684\u5468\u671f\uff0c\u8fd8\u6709 $|w|$ \u4e5f\u662f\u4e00\u4e2a $T$ \u7684\u5468\u671f\uff0c\u7531\u53e6\u4e00\u4e2a\u7ed3\u8bba\uff0c\u6709 $(|T|-|P|)\\mid |w|$\uff0c\u5f97\u51fa $w$ \u662f\u5faa\u73af\u4e32\uff0c\u77db\u76fe\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u56de\u6587\u6811\u4e0a\u6240\u6709 $S=border(T)$\uff0c\u4e14 $(|T|-|S|)\\times 2\\leq |T|$ \u7684\u4f4d\u7f6e\u5224\u65ad\u4e00\u904d\u5373\u53ef\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u54c8\u5e0c\u5b9e\u73b0\u3002\n\n\u5173\u4e8e\u5982\u4f55\u627e $A$ \u67d0\u4e2a\u5b50\u4e32\u7684\u6700\u957f\u56de\u6587\u524d\u7f00/\u540e\u7f00\uff0c\u4f60\u53ef\u4ee5\u5728\u56de\u6587\u6811\u4e0a\u500d\u589e\u76f4\u5230\u5408\u6cd5\u3002\n\n\u540c\u7406\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5728 $B$ \u4e2d\u6570\u4e00\u904d $y$\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u6837\u4f1a\u989d\u5916\u51cf\u6389\u65e2\u80fd\u88ab $border(x)$ \u7edf\u8ba1\u5230\u7684\uff0c\u53c8\u80fd\u88ab $border(y)$ \u7edf\u8ba1\u5230\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5728\u6700\u540e\u989d\u5916\u52a0\u56de\u6765\u8fd9\u79cd\u60c5\u51b5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0x0jswy0.png)\n\n\u8003\u8651\u82e5\u6b64\u65f6 $w$ \u65e2\u662f\u5de6\u8fb9\u90a3\u4e2a\u5927\u4e32\u7684 $border$\uff0c\u53c8\u662f\u53f3\u8fb9\u90a3\u4e2a\u4e32\u7684 $border$\uff0c\u4e14\u7ea2\u4e32\u5c5e\u4e8e $A$\uff0c\u84dd\u4e32\u5c5e\u4e8e $B$\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u4f1a\u88ab\u51cf\u53bb\u4e24\u6b21\uff0c\u4e8e\u662f\u53ea\u9700\u8981\u52a0\u4e0a\u516c\u5171 $w$ \u5bf9\u6570\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int mod1 = 1e9 + 7,mod2 = 1e9 + 9;\nconst int base1 = 131,base2 = 1331;\n\nint pw1[200050],pw2[200050];\n\nstruct Hash\n{\n\tint h1,h2;\n\tlong long val() const\n\t{\n\t\treturn h1 * 1ll * mod2 + h2;\n\t}\n\tbool operator == (const Hash &a) const\n\t{\n\t\treturn val() == a.val();\n\t}\n\tbool operator < (const Hash &a) const\n\t{\n\t\treturn val() < a.val();\n\t}\n\tHash operator + (const int &a) const\n\t{\n\t\treturn (Hash){(h1 + a) % mod1,(h2 + a) % mod2};\n\t}\n\tHash operator + (const Hash &a) const\n\t{\n\t\treturn (Hash){(h1 + a.h1) % mod1,(h2 + a.h2) % mod2};\n\t}\n\tHash operator - (const Hash &a) const\n\t{\n\t\treturn (Hash){(h1 - a.h1 + mod1) % mod1,(h2 - a.h2 + mod2) % mod2};\n\t}\n\tHash operator * (const int &h) const\n\t{\n\t\treturn (Hash){h1 * 1ll * pw1[h] % mod1,h2 * 1ll * pw2[h] % mod2};\n\t}\n\tHash operator * (const long long &h) const\n\t{\n\t\treturn (Hash){h1 * h % mod1,h2 * h % mod2};\n\t}\n}h1[200050],h2[200050];\n\nmap<Hash,int> mpa1,mpa2,mpb1,mpb2;\n\nHash HashA(int l,int r)\n{\n\treturn h1[r] - h1[l - 1] * (r - l + 1);\n}\n\nHash HashB(int l,int r)\n{\n\treturn h2[r] - h2[l - 1] * (r - l + 1);\n}\n\nint N;\n\nstruct Palindromic_Tree\n{\n\tint fail[200050],len[200050],son[200050][26];\n\tint fa[200050][19],pcnt,ln;\n\tint dy[200050];\n\tint ed[200050];\n\tint lst;\n\tbool rev_tag;\n\tchar str[200050];\n\tvoid init()\n\t{\n\t\tpcnt = 1;\n\t\tfail[0] = 1; len[1] = -1;\n\t}\n\tbool chk(int nd,int r)\n\t{\n\t\treturn str[r] == str[r - len[nd] - 1];\n\t}\n\tvoid append(char s)\n\t{\n\t\tstr[++ ln] = s;\n\t\tint p = lst;\n\t\twhile(!chk(p,ln))\n\t\t\tp = fail[p];\n\t\tif(!son[p][s - 'a'])\n\t\t{\n\t\t\tint k = fail[p];\n\t\t\twhile(!chk(k,ln)) k = fail[k];\n\t\t\tpcnt ++; lst = pcnt; len[pcnt] = len[p] + 2; dy[pcnt] = ln;\n\t\t\tfail[pcnt] = fa[pcnt][0] = son[k][s - 'a']; son[p][s - 'a'] = pcnt;\n\t\t\tfor(int i = 1;i <= 18; ++ i)\n\t\t\t\tfa[pcnt][i] = fa[fa[pcnt][i - 1]][i - 1];\n\t\t}\n\t\telse lst = son[p][s - 'a'];\n\t\tif(rev_tag) ed[N - ln + 1] = lst;\n\t\telse ed[ln] = lst;\n\t}\n\tint locate(int l,int r)\n\t{\n\t\tif(rev_tag)\n\t\t{\n\t\t\tint po = ed[l];\n\t\t\tfor(int i = 18;i >= 0; -- i)\n\t\t\t\tif(len[fa[po][i]] >= r - l + 1)\n\t\t\t\t\tpo = fa[po][i];\n\t\t\tif(len[po] > r - l + 1) po = fail[po];\n\t\t\treturn l + len[po] - 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint po = ed[r];\n\t\t\tfor(int i = 18;i >= 0; -- i)\n\t\t\t\tif(len[fa[po][i]] >= r - l + 1)\n\t\t\t\t\tpo = fa[po][i];\n\t\t\tif(len[po] > r - l + 1) po = fail[po];\n\t\t\treturn r - len[po] + 1;\n\t\t}\n\t}\n\tbool check(int l,int r)\n\t{\n\t\tif(rev_tag)\n\t\t{\n\t\t\tint po = ed[l];\n\t\t\tfor(int i = 18;i >= 0; -- i)\n\t\t\t\tif(len[fa[po][i]] >= r - l + 1)\n\t\t\t\t\tpo = fa[po][i];\n\t\t\treturn len[po] == r - l + 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint po = ed[r];\n\t\t\tfor(int i = 18;i >= 0; -- i)\n\t\t\t\tif(len[fa[po][i]] >= r - l + 1)\n\t\t\t\t\tpo = fa[po][i];\n\t\t\treturn len[po] == r - l + 1;\n\t\t}\n\t}\n}A,RA,B,RB;\n\nchar S[200050],T[200050];\n/*\naaabbaabbaabbbbaaaba\nbbabababbaaaaabbbaba\n*/\n\nint main()\n{\n\tA.init(); RA.init(); B.init(); RB.init();\n\tscanf(\"%s%s\",S + 1,T + 1);\n\tint len1 = strlen(S + 1),len2 = strlen(T + 1);\n\tpw1[0] = pw2[0] = 1;\n\tfor(int i = 1;i <= 200000; ++ i)\n\t\tpw1[i] = pw1[i - 1] * 1ll * base1 % mod1,\n\t\tpw2[i] = pw2[i - 1] * 1ll * base2 % mod2;\n\tN = len1;\n\tfor(int i = 1;i <= len1; ++ i)\n\t{\n\t\tA.append(S[i]);\n\t\th1[i].h1 = h1[i - 1].h1 * 1ll * base1 % mod1;\n\t\th1[i].h2 = h1[i - 1].h2 * 1ll * base2 % mod2;\n\t\th1[i] = h1[i] + S[i];\n\t}\n\tRA.rev_tag = 1; RB.rev_tag = 1;\n\tfor(int i = len1;i >= 1; -- i)\n\t\tRA.append(S[i]);\n\tN = len2;\n\tfor(int i = 1;i <= len2; ++ i)\n\t{\n\t\tB.append(T[i]);\n\t\th2[i].h1 = h2[i - 1].h1 * 1ll * base1 % mod1;\n\t\th2[i].h2 = h2[i - 1].h2 * 1ll * base2 % mod2;\n\t\th2[i] = h2[i] + T[i];\n\t}\n\tfor(int i = len2;i >= 1; -- i)\n\t\tRB.append(T[i]);\n\tlong long as = (A.pcnt - 1) * 1ll * (B.pcnt - 1);\n\tcerr << as << endl;\n\tfor(int i = 2;i <= A.pcnt; ++ i)\n\t{\n\t\tmpa1[HashA(A.dy[i] - A.len[i] + 1,A.dy[i])] ++;\n\t\tif(A.fail[i] < 2) continue;\n\t\tif((A.len[i] - A.len[A.fail[i]]) * 2 <= A.len[i])\n\t\t\tmpa2[HashA(A.dy[i] - (A.len[i] - A.len[A.fail[i]]) + 1,A.dy[i])] ++;\n\t}\n\tfor(int i = 2;i <= B.pcnt; ++ i)\n\t{\n\t\tmpb1[HashB(B.dy[i] - B.len[i] + 1,B.dy[i])] ++;\n\t\tif(B.fail[i] < 2) continue;\n\t\tif((B.len[i] - B.len[B.fail[i]]) * 2 <= B.len[i])\n\t\t\tmpb2[HashB(B.dy[i] - B.len[i] + 1,B.dy[i] - B.len[B.fail[i]])] ++;\n\t}\n\tfor(int i = 2;i <= A.pcnt; ++ i)\n\t{\n\t\tif(A.fail[i] < 2) continue;\n\t\tint l = A.dy[i] - (A.len[i] - A.len[A.fail[i]]) + 1,r = A.dy[i];\n\t\tHash w = HashA(l,r);\n\t\tas -= mpb2[w];\n\t\tint rbd = A.locate(l,r);\n\t\tif(rbd == l) continue;\n\t\t// U \u5728\u540e\u9762\n\t\tif(A.check(l,rbd - 1))\n\t\t{\n\t\t\tw = HashA(l,r) * (rbd - l) + HashA(l,rbd - 1);\n\t\t\tif(mpb1.count(HashA(l,rbd - 1))) \n\t\t\t\tas -= mpb1[w];\n\t\t\tcontinue;\n\t\t}\n\t\tint lbd = RA.locate(l,r);\n\t\tif(A.check(lbd + 1,r))\n\t\t{\n\t\t\tw = HashA(l,r) * (lbd - l + 1) + HashA(l,lbd);\n\t\t\tif(mpb1.count(HashA(l,lbd)))\n\t\t\t\tas -= mpb1[w];\n\t\t}\n\t}\n\tcerr << as << endl;\n\tfor(int i = 2;i <= B.pcnt; ++ i)\n\t{\n\t\tif(B.fail[i] < 2) continue;\n\t\tint l = B.dy[i] - B.len[i] + 1,r = B.dy[i] - B.len[B.fail[i]];\n\t\tHash w = HashB(l,r);\n\t\tas -= mpa2[w];\n\t\tint rbd = B.locate(l,r);\n\t\tif(rbd == l) continue;\n\t\t// U \u5728\u540e\u9762\n\t\tif(B.check(l,rbd - 1))\n\t\t{\n\t\t\tw = HashB(rbd,r) * (r - l + 1) + HashB(l,r);\n\t\t\tif(mpa1.count(HashB(rbd,r)))\n\t\t\t\tas -= mpa1[w];\n\t\t\tcontinue;\n\t\t}\n\t\tint lbd = RB.locate(l,r);\n\t\tif(B.check(lbd + 1,r))\n\t\t{\n\t\t\tw = HashB(lbd + 1,r) * (r - l + 1) + HashB(l,r);\n\t\t\tif(mpa1.count(HashB(lbd + 1,r)))\n\t\t\t\tas -= mpa1[w];\n\t\t}\n\t}\n\tcerr << as << endl;\n\tfor(int i = 2;i <= A.pcnt; ++ i)\n\t\tif(A.fail[i] >= 2 && (A.len[i] - A.len[A.fail[i]]) * 2 > A.len[i])\n\t\t\tmpa2[HashA(A.dy[i] - (A.len[i] - A.len[A.fail[i]]) + 1,A.dy[i])] ++;\n\tfor(int i = 2;i <= B.pcnt; ++ i)\n\t\tif(B.fail[i] >= 2 && (B.len[i] - B.len[B.fail[i]]) * 2 > B.len[i])\n\t\t\tmpb2[HashB(B.dy[i] - B.len[i] + 1,B.dy[i] - B.len[B.fail[i]])] ++;\n\tfor(auto v : mpa2)\n\t\tas += v.second * 1ll * mpb2[v.first];\n\tprintf(\"%lld\\n\",as);\n}\n```",
        "postTime": 1592892330,
        "uid": 25308,
        "name": "Wen_kr",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1081H \u3010Palindromic Magic\u3011"
    },
    {
        "content": "\u4e00\u4e2a\u663e\u7136\u9519\u8bef\u7684\u60f3\u6cd5\u662f\u5206\u522b\u8ba1\u7b97 $A,B$ \u672c\u8d28\u4e0d\u540c\u7684\u56de\u6587\u4e32\u4e2a\u6570\uff0c\u7136\u540e\u5c06\u4e24\u8005\u76f8\u4e58\uff0c\u8fd9\u5c06\u4f1a\u591a\u6b21\u8ba1\u7b97\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\n\n\u56e0\u6b64\u8981\u601d\u8003\u7684\u95ee\u9898\u662f\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u8ba1\u7b97\u591a\u6b21\uff1f\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c06\u7528\u5230\u4e0b\u9762\u6570\u4e2a\u5f15\u7406\uff0c\u5982\u679c\u53ea\u662f\u60f3\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5efa\u8bae\u8df3\u8fc7\u6240\u6709\u8bc1\u660e\u3002\n\n\n\u5047\u8bbe\u6240\u6709\u5b57\u7b26\u4e32\u7684\u4e0b\u6807\u4ece $0$ \u5f00\u59cb\u3002\n\n\u4ee4 $x^R$ \u8868\u793a\u5b57\u7b26\u4e32 $x$ \u7ffb\u8f6c\uff0c\u4ee4 $x^a$ \u8868\u793a\u7531\u5b57\u7b26\u4e32 $x$ \u8fde\u7eed\u62fc\u63a5 $a$ \u6b21\u540e\u7684\u5b57\u7b26\u4e32\u3002\n\n\u4ee4 $t$ \u4e3a\u5b57\u7b26\u4e32 $x$ \u7684\u4e00\u4e2a border\uff0c\u5f53\u4e14\u4ec5\u5f53 $x$ \u957f\u4e3a $t$ \u7684\u524d\u7f00\u4e0e\u540e\u7f00\u76f8\u540c\uff0c\u5373 $x{[0,t-1]}=x{[|x|-t,|x|-1]}$\u3002\n\n\u4ee4 $t$ \u4e3a\u5b57\u7b26\u4e32 $x$ \u7684\u4e00\u4e2a\u5468\u671f\uff0c\u5f53\u4e14\u4ec5\u5f53 $x_{i}=x_{i+t}(0\\le i<|x|-t)$\u3002\u82e5 $t \\mid |x|\n$\uff0c\u5219 $t$ \u4e3a $x$ \u7684\u4e00\u4e2a\u5b8c\u5168\u5468\u671f\u3002\u53ef\u4ee5\u53d1\u73b0 $x$ \u5b58\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a $t$ \u7684\u5468\u671f\u5f53\u4e14\u4ec5\u5f53 $x$ \u6709\u4e00\u4e2a\u957f\u4e3a $|x|-t$ \u7684 border\u3002\n\n\u4ee4 $border(x) $ \u4e3a $x$ \u6700\u957f\u7684 border\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u82e5 $x$ \u662f\u56de\u6587\u4e32\uff0c\u5219\u4ed6\u7684\u56de\u6587\u524d\u7f00\u4e0e\u540e\u7f00\u5747\u4e3a $x$ \u7684 border\u3002\n\n\u56e0\u6b64 $border(x)$ \u4e3a $x$ \u7684\u6700\u957f\u56de\u6587\u524d\u7f00\uff08\u540e\u7f00\uff09\u3002\n\n\u8bc1\u660e\uff1a\n\n\u5047\u8bbe $a$ \u4e3a $x$ \u7684\u4e00\u4e2a border\uff0c\u5373 $x_i=x_{|x|-a+i}(0\\le i\\le a-1)$\u3002\u4e14 $x$ \u6709\u957f\u4e3a $a$ \u7684\u56de\u6587\u524d\u7f00 $x_i=x_{a-1-i}(0\\le i\\le a-1)$\uff0c\u56e0\u6b64 $x_i=x_{|x|-i-1}$\uff0c\u6ee1\u8db3 $x$ \u4e3a\u56de\u6587\u4e32\u3002\n\n\u82e5 $S=xy$\uff0c$x,y$ \u4e3a\u4e24\u4e2a\u975e\u7a7a\u56de\u6587\u4e32\uff0c\u5219 $(x,y)$ \u4e3a $S$ \u7684\u4e00\u7ec4\u56de\u6587\u5206\u89e3\u3002\n\n\u82e5 $S=xy$\uff0c$x,y$ \u5747\u4e3a\u56de\u6587\u4e32\u4e14 $y$ \u975e\u7a7a\uff0c\u5219 $(x,y)$ \u4e3a\u4e00\u7ec4\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\u3002\n\n\u82e5\u5b57\u7b26\u4e32 $x$ \u7684\u6700\u5c0f\u5b8c\u5168\u5468\u671f\u957f\u5ea6 $\\neq |x|$\uff0c\u5219\u79f0 $x$ \u4e3a\u5faa\u73af\u4e32\u3002\n\n\u5f15\u7406 1:\n\n\u5982\u679c $p,q$ \u5747\u4e3a $s$ \u7684\u4e00\u4e2a\u5468\u671f\uff0c\u4e14 $p+q\\le |s|$\uff0c\u5219 $\\gcd(p,q)$ \u540c\u6837\u4e5f\u662f $s$ \u7684\u4e00\u4e2a\u5468\u671f\u3002\n\n\u8bc1\u660e\uff1a\n\n\u5047\u8bbe $p<q,d=q-p$\n\n$s_i=s_{i-p}=s_{i+d}(|s|-q\\le i<|s|-d)$.\n\n$s_i=s_{i+q}=s_{i+q-p}=s_{i+d}(0\\le i<|s|-q)$.\n\n\u56e0\u6b64 $q-p$ \u4e5f\u662f\u4e00\u4e2a\u5468\u671f\uff0c\u6839\u636e\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u53ef\u4ee5\u5f97\u5230 $\\gcd(p,q)$ \u540c\u6837\u4e5f\u662f\u4e00\u4e2a\u5468\u671f\u3002\n\n\u5f15\u7406 2\uff1a\n\n\u4ee4 $S$ \u8868\u793a\u5b57\u7b26\u4e32 $s$ \u6240\u6709 $\\le \\frac{|s|}{2}$ \u5468\u671f\u7684\u96c6\u5408\uff0c\u5982\u679c $S$ \u975e\u7a7a\uff0c\u5219 $\\forall u\\in S,\\min S\\mid u$\u3002\n\n\u8bc1\u660e\uff1a\n\n\u4ee4 $v=\\min S$\uff0c\u663e\u7136 $u+v\\le|s|$\uff0c\u6839\u636e\u5f15\u7406 1\uff0c$\\gcd(u,v)$ \u540c\u6837\u5c5e\u4e8e\u96c6\u5408 $S$\uff0c\u6240\u4ee5 $\\gcd(u,v)\\ge v,v\\mid u$\u3002\n\n\u5f15\u7406 3\uff1a\n\n\u82e5 $S=x_1x_2=y_1y_2=z_1z_2,|x_1|<|y_1|<|z_1|$\uff0c$x_2,y_1,y_2,z_1$ \u5747\u4e3a\u975e\u7a7a\u56de\u6587\u4e32\uff0c\u5219 $x_1,z_2$ \u5747\u4e3a\u56de\u6587\u4e32\u3002\n\n\u8bc1\u660e\uff1a\n\n\u4ee4 $z_1=y_1v$\uff0c\u663e\u7136 $v^R$ \u4e3a $y_2$ \u7684\u4e00\u4e2a\u540e\u7f00\uff0c\u540c\u6837\u4e5f\u662f $x_2$ \u7684\u4e00\u4e2a\u540e\u7f00\u3002\n\n\u56e0\u4e3a $x_2$ \u4e3a\u56de\u6587\u4e32\uff0c\u56e0\u6b64 $v$ \u4e3a $x_2$ \u7684\u524d\u7f00\uff0c\u6240\u4ee5 $x_1v$ \u662f $z_1$ \u7684\u4e00\u4e2a\u524d\u7f00\u3002\n\n\u53c8\u56e0\u4e3a $y_1$ \u662f $z_1$ \u7684\u56de\u6587\u524d\u7f00\uff0c\u6240\u4ee5 $|v|$ \u4e3a $z_1$ \u7684\u4e00\u4e2a\u5468\u671f\uff0c\u5373 $|v|$ \u4e3a $x_1v$ \u7684\u4e00\u4e2a\u5468\u671f\u3002\n\n\u5047\u8bbe $t$ \u4e3a\u4e00\u4e2a\u4efb\u610f\u5927\u7684\u6570\uff0c\u5373 $x_1$ \u4e3a $v^t$ \u7684\u540e\u7f00\u3002\n\n\u56e0\u4e3a $v^R$ \u4e3a $z_1$ \u7684\u524d\u7f00\uff0c$x_1$ \u4e3a $(v^R)^t$ \u7684\u524d\u7f00\u3002\u6240\u4ee5 $x_1^R$ \u4e3a $v^t$ \u7684\u4e00\u4e2a\u540e\u7f00\uff0c\u56e0\u6b64 $x_1$ \u4e3a\u56de\u6587\u4e32\u3002\n\n\u5f15\u7406 4\uff1a\n\n\u82e5\u4e32 $S$ \u5b58\u5728\u56de\u6587\u5206\u89e3\uff0c\u4ee4 $a$ \u8868\u793a $S$ \u7684\u6700\u957f\u56de\u6587\u524d\u7f00\uff0c$S=ax$\uff0c$b$ \u8868\u793a $S$ \u7684\u6700\u957f\u56de\u6587\u540e\u7f00\uff0c$S=yb$\uff0c\u5219 $x,y$ \u4e2d\u5fc5\u7136\u6709\u4e00\u4e2a\u662f\u56de\u6587\u4e32\u3002\n\n\u8bc1\u660e\uff1a\n\n\u5047\u8bbe $x,y$ \u5747\u4e0d\u662f\u56de\u6587\u4e32\uff0c\u4ee4 $p,q$ \u4e3a $S$ \u7684\u4e00\u4e2a\u56de\u6587\u5206\u89e3\uff0c\u56e0\u6b64 $S=yb=pq=ax$\uff0c\u6839\u636e\u5f15\u7406 3\uff0c\u8fd9\u663e\u7136\u4e0d\u6210\u7acb\u3002\n\n\u5f15\u7406 5\uff1a\n\n\u82e5 $S=p_1q_1=p_2q_2$\uff08$|p_1|<|p_2|$\uff0c\u4e14 $p_1,p_2,q_1,q_2$ \u5747\u4e3a\u56de\u6587\uff0c$q_1,q_2$ \u975e\u7a7a\uff09\uff0c\u5219 $S$ \u662f\u4e00\u4e2a\u5faa\u73af\u4e32\u3002\n\n\u8bc1\u660e\uff1a\n\n\u53ef\u4ee5\u53d1\u73b0 $\\gcd(|p_2|-|p_1|,|S|)$ \u662f $S$ \u7684\u4e00\u4e2a\u5468\u671f\u3002\n\n\u56e0\u4e3a $p_1$ \u662f $p_2$ \u7684\u4e00\u4e2a\u56de\u6587\u524d\u7f00\uff0c\u6240\u4ee5 $p_2,q_1$ \u5747\u6709\u5468\u671f $|p_2|-|p_1|$\u3002\u7531\u4e8e $[p_1,p_2-1]$ \u8fd9\u90e8\u5206\u88ab\u91cd\u590d\u8986\u76d6\uff0c\u56e0\u6b64 $S$ \u4e5f\u6709\u5468\u671f $|p_2|-|p_1|$\u3002\n\n$\\forall x\\in[0,t),S_x=S_{|p_2|-1-x}=S_{|S|-1+|p_1|-(|p_2|-1-x)}=S_{|S|-|p_2|+|p_1|+x}$\n\n\u56e0\u6b64 $|S|-(|p_2|-|p_1|)$ \u4e3a $S$ \u7684\u4e00\u4e2a\u5468\u671f\u3002\u6839\u636e\u5f15\u7406 1\uff0c$\\gcd(|p_2|-|p_1|,|S|)\\mid |S|$\uff0c\u6240\u4ee5 $|S|$ \u662f\u4e00\u4e2a\u5faa\u73af\u4e32\u3002\n\n\u5f15\u7406 6\uff1a\n\n\u4ee4 $S=p_1q_1=p_2q_2=\\cdots=p_tq_t$ \u662f\u6240\u6709 $S$ \u7684\u975e\u4e25\u683c\u5206\u89e3\uff0c\u4ee4 $h$ \u8868\u793a\u6700\u5c0f\u5b8c\u5168\u5468\u671f\u3002\u82e5 $t\\ne 0$\uff0c\u5219 $t=\\frac{|S|}{h}$\u3002\n\n\u8bc1\u660e\uff1a\n\n\u6839\u636e\u5f15\u7406 5\uff0c\u5f53 $t=1$ \u65f6 $h=|S|$\uff0c\u4e8e\u662f\u63a5\u4e0b\u6765\u53ea\u8ba8\u8bba $t\\ge 2$\u3002\n\n\u4ee4 $\\alpha =S[0,h-1]$\uff0c\u663e\u7136 $\\alpha$ \u5e76\u4e0d\u662f\u5faa\u73af\u4e32\uff08\u5426\u5219 $S$ \u5c31\u4f1a\u6709\u4e00\u4e2a\u66f4\u5c0f\u7684\u5b8c\u5168\u5468\u671f\uff09\uff0c\u56e0\u6b64 $\\alpha$ \u6700\u591a\u6709\u4e00\u4e2a\u975e\u4e25\u683c\u5206\u89e3\u3002\n\n\n\u4ee4 $S=pq$ \u4e3a\u4e00\u7ec4\u975e\u4e25\u683c\u5206\u89e3\uff0c\u5b58\u5728 $\\max(|p|,|q|)\\ge h$\u3002\n\n\u5f53 $|p|\\ge h$ \u65f6\uff0c$\\alpha=p[0,h-1]$\uff0c\u56e0\u4e3a $\\alpha[0,|p|\\bmod h-1]=p^R[0,|p|\\bmod h-1]=(\\alpha[0,|p|\\bmod h-1])^R$\uff0c\u56e0\u6b64 $\\alpha[0,|p|\\bmod h-1]$ \u4e3a\u56de\u6587\u4e32\u3002\u7c7b\u4f3c\u7684\uff0c$\\alpha[|p|\\bmod h-1,h-1]$ \u540c\u6837\u4e5f\u662f\u56de\u6587\u7684\u3002\n\n$|q|\\ge h$ \u65f6\u540c\u7406\u3002\u6240\u4ee5 $\\alpha[0,|p|\\bmod h-1],\\alpha[|p|\\bmod h-1,h-1]$ \u4e3a $\\alpha$ \u7684\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\u3002\n\n\n\u56e0\u6b64 $\\alpha$ \u5177\u6709\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\uff0c\u5047\u8bbe\u552f\u4e00\u7684\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\u4e3a $\\alpha[0,g-1],\\alpha[g,h-1]$\u3002\u6240\u4ee5\u6240\u6709 $p_i$ \u5fc5\u987b\u6ee1\u8db3 $p_i\\bmod h=g$\uff0c\u6240\u4ee5 $t\\le \\frac{|S|}{h}$\uff0c\u5e76\u4e14\u8fd9 $\\frac{|S|}{h}$ \u79cd $p_i$ \u90fd\u662f\u5408\u6cd5\u7684\u3002\n\n\u5f15\u7406 7\uff1a\n\n\u4ee4 $S=p_1q_1=p_2q_2=\\cdots=p_tq_t(|p_i|<|p_{i+1}|)$ \u662f\u6240\u6709 $S$ \u7684\u975e\u4e25\u683c\u5206\u89e3\u3002\u5219 $\\forall i \\in [1,t-1]$\uff0c$p_i=border(p_{i+1})$ \u4e0e $q_{i+1}=border(q_i)$ \u81f3\u5c11\u6709\u4e00\u9879\u6210\u7acb\u3002\n\u81f3\u5c11\u6709\u4e00\u9879\u6210\u7acb\u3002\n\n\u8bc1\u660e\uff1a\n\n\u5148\u76f4\u63a5\u8003\u8651\u5982\u4f55\u6c42\u51fa\u6240\u6709\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\u3002\n\n\u5047\u8bbe $S$ \u7684\u6700\u957f\u56de\u6587\u524d\u7f00\u4e3a $a(a\\ne S),S=ax$\uff0c\u6700\u957f\u56de\u6587\u540e\u7f00\u4e3a $b$\uff08$b$ \u6709\u53ef\u80fd\u4e3a $S$\uff09$S=yb$\u3002\n\n\u82e5 $x=b$\uff0c\u663e\u7136 $S=ab$ \u4e3a\u552f\u4e00\u7684\u5206\u89e3\u65b9\u6cd5\u3002\n\n\u82e5 $S=pq$ \u5e76\u4e14 $p\\ne a,q\\ne b$\uff0c$p,q$ \u5747\u4e3a\u56de\u6587\uff0c\u6839\u636e\u5f15\u7406 3\uff0c\u53ef\u4ee5\u5f97\u5230 $x,y$ \u5747\u4e3a\u56de\u6587\u4e32\u3002\n\n\u56e0\u6b64\u82e5 $x,y$ \u5747\u4e0d\u4e3a\u56de\u6587\uff0c\u5219 $S$ \u4e0d\u5b58\u5728\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3  \n\n\u82e5 $x,y$ \u4e2d\u53ea\u6709\u4e00\u4e2a\u4e3a\u56de\u6587\u4e32\uff0c\u5219 $S$ \u53ea\u5b58\u5728\u552f\u4e00\u4e00\u79cd\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\u3002\n\n\u82e5 $x,y$ \u5747\u4e3a\u56de\u6587\u4e32\uff0c\u7136\u540e\u53ef\u4ee5\u627e\u5230\u7b2c\u4e8c\u957f\u7684\u975e\u81ea\u56de\u6587\u524d\u7f00 $c,S=cz$\uff0c\u82e5 $z$ \u4e0d\u662f\u56de\u6587\u4e32\u6216 $c=y$\uff0c\u5219 $S=ax=yb$ \u662f\u552f\u4e8c\u5408\u6cd5\u7684\u5206\u89e3\u3002\n\n\u5426\u5219 $z$ \u662f\u56de\u6587\u4e32\uff0c\u53ef\u4ee5\u627e\u51fa\u6240\u6709\u957f\u5ea6\u4ecb\u4e8e $|z|$ \u4e0e $b$ \u4e4b\u95f4\u7684\u56de\u6587\u540e\u7f00\uff0c\u5b83\u4eec\u5bf9\u5e94\u7684\u524d\u7f00\u4e5f\u4e00\u5b9a\u662f\u56de\u6587\u7684\uff08\u5f15\u7406 3\uff09\u3002\u56e0\u6b64\u5c31\u6c42\u51fa\u4e86\u6240\u6709\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\uff08\u7531\u4e8e\u56de\u6587\u540e\u7f00\u957f\u5ea6\u4e0d\u4f1a\u5927\u4e8e $|b|$\uff0c\u56de\u6587\u524d\u7f00\u957f\u5ea6\u4e0d\u4f1a\u5927\u4e8e $|a|$\uff0c\u56e0\u6b64\u8fd9\u6837\u6c42\u51fa\u7684\u56de\u6587\u5206\u89e3\u662f\u4e0d\u6f0f\u7684\uff09\n\n\u91cd\u65b0\u8003\u8651\u5982\u4f55\u8bc1\u660e\uff0c\u5bf9\u4e8e\u975e $S=ax=yb$ \u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e $(c,z),(a,x)$ \u6ee1\u8db3 $p_i=border(p_{i+1})$\uff0c\u5176\u4f59\u5747\u6ee1\u8db3 $q_i=border(q_{i+1})$\u3002\n\n\u7136\u540e\u8003\u8651\u5982\u4f55\u8bc1\u660e $S=ax=yb$ \u8fd9\u79cd\u60c5\u51b5\u5f15\u7406\u4f9d\u7136\u6210\u7acb\u3002\n\n\u5148\u5047\u8bbe\u8fd9\u79cd\u60c5\u51b5\u662f\u9519\u8bef\u7684\uff0c\u4ee4 $p=border(a),s=border(b),S=ax=pq=rs=yb$\uff08$|a|>|p|>|y|,|a|>|r|>|y|$\uff0c$p,s$ \u5747\u4e3a\u56de\u6587\u4e32\uff09\n\n\u6839\u636e\u5f15\u7406 6\uff0c\u53ef\u4ee5\u5f97\u5230 $S$ \u53ea\u6709\u4e24\u79cd\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\uff0c\u4e14 $S=\\alpha^2$\u3002\n\n\u82e5 $|p|\\ge |\\alpha|$\uff0c\u6709 $q=\\alpha[|p|\\bmod h,h-1]$\uff0c\u56e0\u6b64 $q$ \u4e5f\u662f\u4e00\u4e2a\u56de\u6587\u4e32\uff0c\u77db\u76fe\u3002\n\n\u56e0\u6b64\u6709 $|p|<|\\alpha|$\uff0c\u540c\u6837\u53ef\u4ee5\u5f97\u5230 $|s|<|\\alpha|$\uff0c\u4ee4 $\\alpha=pq'=r's$\uff0c\u5e76\u4e14\u6839\u636e\u5f15\u7406 6\uff0c\u4ee4 $\\alpha$ \u552f\u4e00\u7684\u975e\u4e25\u683c\u5206\u89e3\u4e3a $\\beta\\theta$\u3002\u56e0\u6b64\u6839\u636e\u5f15\u7406 3 \u53ef\u5f97\u5230 $q'$ \u548c $r\u2018$ \u4e5f\u662f\u4e00\u4e2a\u56de\u6587\u4e32\uff0c\u77db\u76fe\u3002\n\n\u6839\u636e\u5f15\u7406 7\uff0c\u5047\u8bbe $S=xy$\uff0c\u5982\u679c\u7528 $border(x)$ \u4ee3\u66ff $x$ \u6216 $border(y)$ \u4ee3\u66ff $y$ \u540e\u4e5f\u80fd\u62fc\u51fa $S$\uff0c\u90a3\u4e48 $S$ \u5c06\u4f1a\u88ab\u91cd\u590d\u8ba1\u7b97\uff0c\u7b54\u6848\u9700\u8981\u51cf 1\u3002\n\n\u6240\u4ee5\u5bf9\u4e8e $A$ \u4e2d\u7684\u4e00\u4e2a\u56de\u6587\u4e32 $x$\uff0c\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u4ece $x$ \u548c $border(x)$ \u4e2d\u90fd\u53ef\u4ee5\u62fc\u51fa\u7684\u5b57\u7b26\u4e32 $S$ \u5e76\u4ece\u7b54\u6848\u4e2d\u51cf\u53bb\u3002\u5176\u4e2d\u627e $x$ \u548c $border(x)$ \u90fd\u53ef\u4ee5\u901a\u8fc7\u56de\u6587\u6811\u5b8c\u6210\u3002\n\n\u4ee4 $x=border(x)w$\uff0c\u9700\u8981\u8ba1\u7b97\u7684\u5c31\u662f\u5728 $B$ \u4e2d\u6709\u591a\u5c11 $T$ \u6ee1\u8db3 $T=wS$\uff0c\u4e14 $S,T$ \u5747\u4e3a $B$ \u4e2d\u7684\u56de\u6587\u4e32\u3002\u56e0\u4e3a $|w|$ \u662f $x$ \u7684\u6700\u77ed\u5468\u671f\uff0c\u56e0\u6b64 $w$ \u4e0d\u662f\u5faa\u73af\u4e32\u3002\n\n\u82e5 $|w|>|S|,w=S+U$\uff0c\u5176\u4e2d $S,U$ \u5747\u4e3a\u56de\u6587\u4e32\u3002\u4e14\u56e0\u4e3a $w$ \u4e0d\u662f\u4e00\u4e2a\u5faa\u73af\u4e32\uff0c\u6240\u4ee5 $w$ \u6700\u591a\u6709\u4e00\u4e2a\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\uff08\u5f15\u74065\uff09\u3002\u6211\u4eec\u53ea\u9700\u9a8c\u8bc1\u8fd9\u4e2a\u975e\u4e25\u683c\u56de\u6587\u5206\u89e3\u662f\u5426\u5305\u542b $w$ \u7684\u6700\u957f\u524d\u7f00\u548c\u540e\u7f00\uff0c\u7136\u540e\u901a\u8fc7 hash \u9a8c\u8bc1 $S$ \u548c $wS$ \u662f\u5426\u5728 $B$ \u4e2d\u5b58\u5728\u5373\u53ef\u3002\n\n\u82e5 $|w|\\le |S|$\uff0c\u82e5 $S$ \u4e0d\u662f $T$ \u7684\u6700\u957f\u56de\u6587\u540e\u7f00\uff0c\u5219 $w$ \u4e00\u5b9a\u662f\u5faa\u73af\u4e32\uff08\u5f15\u7406 2)\uff0c\u77db\u76fe\u3002\n\n\u56e0\u6b64\u53ea\u9700\u8981\u5bf9\u6240\u6709\u6700\u957f\u56de\u6587\u540e\u7f00\uff08\u5373 $S=border(T)$ \u4e14 $(|T|-|S|\\times 2 \\le |T|$\uff09\u7684\u4f4d\u7f6e\u5224\u65ad\u4e00\u904d\u5373\u53ef\uff0c\u53ef\u4ee5\u901a\u8fc7 hash \u5b9e\u73b0\u3002\n\n\u627e\u5b50\u4e32\u7684\u6700\u5927\u56de\u6587\u524d\u7f00\u548c\u540e\u7f00\u53ef\u4ee5\u901a\u8fc7\u5bf9\u4e24\u68f5\u56de\u6587\u6811\uff08\u4e00\u68f5\u6b63\u5e38\u548c\u4e00\u68f5\u7ffb\u8f6c\uff09\u500d\u589e\uff0c\u4ee4 $up_{i,j}$ \u8868\u793a\u4ece\u8282\u70b9 $i$ \u8df3 fail \u94fe $2^j$ \u6b65\u540e\u7684\u8282\u70b9\u3002\u5728\u67e5\u8be2 $s[l,r]$ \u7684\u6700\u5927\u56de\u6587\u540e\u7f00\u65f6\uff0c\u627e\u5230\u5bf9\u5e94 $s[1,r]$ \u7684\u6700\u5927\u56de\u6587\u540e\u7f00\u7684\u8282\u70b9\u3002\u5982\u679c\u5c31\u662f\u5305\u542b\u4e0e $[l,r]$\u533a\u95f4\uff0c\u8fd9\u5c31\u662f\u7b54\u6848\u3002\u5426\u5219\uff0c\u4ece\u5927\u5230\u5c0f\u679a\u4e3e\u679a\u4e3e $j$ \u627e\u5408\u9002\u7684\u5373\u53ef\u3002\n\n\u7136\u540e\u518d\u5bf9 $B$ \u540c\u6837\u505a\u4e00\u904d\uff0c\u6ce8\u610f\u9700\u8981\u52a0\u4e0a\u65e2\u4f1a\u88ab $border(x)$ \u8ba1\u7b97\uff0c\u53c8\u4f1a\u88ab $border(y)$ \u8ba1\u7b97\u7684\u8fd9\u90e8\u5206\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define qwq printf(\"qwq\\n\");\n#define R(i,a,b) for(int i=(a),i##E=(b);i<=i##E;i++)\n#define L(i,a,b) for(int i=(b),i##E=(a);i>=i##E;i--)\nusing namespace std;\nconst int base1=1379973;\nconst int base2=3771931;\nconst int mod1=1e9+7;\nconst int mod2=1e9+9;\n\nint pw1[222222],pw2[222222];\nchar A[222222],B[222222];\nint n,m;\nll ans;\n\nstruct hashing\n{\n    ll x,y;\n    inline hashing (ll X=0,ll Y=0):x(X),y(Y) {}\n    inline hashing nxt(int a)\n    {\n        return hashing(x*pw1[a]%mod1,y*pw2[a]%mod2);\n    }\n    inline hashing operator +(const char a)\n    {\n        return hashing((x+a)%mod1,(y+a)%mod2);\n    }\n    inline hashing operator +(const hashing a)\n    {\n        return hashing((x+a.x)%mod1,(y+a.y)%mod2);\n    }\n    inline hashing operator -(const hashing a)\n    {\n        return hashing((x-a.x+mod1)%mod1,(y-a.y+mod2)%mod2);\n    }\n    inline ll val()\n    {\n        return x*mod2+y;\n    }\n};\nconst ll hs=1235287;\nstruct hashtable\n{\n    ll head[hs+10],cnt;\n    struct edge\n    {\n        ll nxt;\n        ll key,val;\n    }e[666666];\n    inline ll hash(ll x)\n    {\n        return (x%hs+hs)%hs;\n    }\n    inline void add_edge(ll u,ll v,ll d)\n    {\n        e[++cnt]=(edge){head[u],v,d};head[u]=cnt;\n    }\n    inline int get_val(ll x)\n    {\n        ll h=hash(x);\n        for(int i=head[h];i;i=e[i].nxt) \n            if(e[i].key==x) return e[i].val;\n        return 0;\n    }\n    inline void ins(ll x,ll d)\n    {\n        ll h=hash(x);\n        for(int i=head[h];i;i=e[i].nxt)\n        {\n            if(e[i].key==x) \n            {\n                e[i].val=d;\n                return;\n            }\n        } \n        add_edge(h,x,d);\n    }\n};\n\nstruct PalindromicTree\n{\n    hashtable mxlen,hst;\n    hashing hs1[222222],hs2[222222];\n    char s[222222];\n    int n,tot,to[222222][26];\n    int fil[222222],diff[222222],slink[222222],len[222222];\n    int mnp[222222];\n    ll phs1[222222],phs2[222222];\n    pair<int,int>seg[222222];\n    int append(int n,int p)\n    {\n        int c=s[n]-'a';\n        while(s[n-1-len[p]]!=s[n]) p=fil[p];\n        if(to[p][c]) return to[p][c];\n        int q=++tot;\n        len[q]=len[p]+2;\n        seg[q]={n-len[q]+1,n};\n        int f=fil[p];\n        while(s[n-1-len[f]]!=s[n]) f=fil[f];\n        fil[q]=to[f][c];\n        to[p][c]=q;\n        diff[q]=len[q]-len[fil[q]];\n        slink[q]=diff[q]==diff[fil[q]]?slink[fil[q]]:fil[q];\n        return q;\n    }\n    int st[222222];\n    ll geths2(int l,int r,int l2,int r2)\n    {\n        return ((hs1[r]-hs1[l-1].nxt(r-l+1)).nxt(r2-l2+1)+hs1[r2]-hs1[l2-1].nxt(r2-l2+1)).val();\n    }\n    ll geths(int l,int r)\n    {\n        return (hs1[r]-hs1[l-1].nxt(r-l+1)).val();\n    }\n    ll gethss(int l,int r)\n    {\n        return (hs2[l]-hs2[r+1].nxt(r-l+1)).val();\n    }\n    void construct(int _n,char _s[])\n    {\n        n=_n;\n        hs1[0]=hashing(0,0);\n        R(i,1,n) s[i]=_s[i],hs1[i]=hs1[i-1].nxt(1)+s[i];\n        hs1[n+1]=hashing(0,0);\n        L(i,1,n) hs2[i]=hs2[i+1].nxt(1)+s[i];\n        int p=0;\n        fil[0]=1,len[0]=0,seg[0]={1,0};\n        fil[1]=0,len[1]=-1,seg[1]={1,0};\n        tot=1;\n        st[0]=p;\n        R(i,1,n)\n        {\n            p=append(i,p);\n            st[i]=p;\n        }\n        R(i,2,tot)\n        {\n            hst.ins(geths(seg[i].first,seg[i].second),1);\n            mnp[i]=len[i]-len[fil[i]];\n            phs1[i]=geths(seg[i].first,seg[i].first+mnp[i]-1);\n            phs2[i]=gethss(seg[i].first,seg[i].first+mnp[i]-1);\n            if(len[i]>=mnp[i]*2) mxlen.ins(phs1[i],max(mxlen.get_val(phs1[i]),len[i]/mnp[i]-1));\n        }\n    }\n    int query_mxp(int p,int b)\n    {\n        if(b>len[p]) return len[p];\n        while(1)\n        {\n            int l=len[slink[p]];\n            int d=diff[p];\n            if(b>=l) return ((b-l)/d)*d+l;\n            p=slink[p];\n        }\n    }\n}t1,t2,t11,t22;\nvoid init()\n{\n    t1.construct(n,A);\n    t2.construct(m,B);\n    ans=1ll*(t1.tot-1)*(t2.tot-1);\n    reverse(A+1,A+n+1);\n    reverse(B+1,B+m+1);\n    t11.construct(n,A);\n    t22.construct(m,B);\n    reverse(A+1,A+n+1);\n    reverse(B+1,B+m+1);\n}\ninline bool is_pal(int l,int r)\n{\n    return t1.query_mxp(t1.st[r],r-l+1)==r-l+1;\n}\nvoid check_pal_deco(int l,int r)\n{\n    int p=t1.query_mxp(t1.st[r],r-l+1);\n    if(l<=r-p&&r-p<r&is_pal(l,r-p))\n    {\n        ans-=t2.hst.get_val(t1.geths2(l,r,l,r-p));\n        return;\n    }\n    p=t11.query_mxp(t11.st[n-l+1],r-l+1);\n    if(l<l+p&&l+p<=r&&is_pal(l+p,r))\n    {\n        ans-=t2.hst.get_val(t1.geths2(l,r,l,l+p-1));\n        return;\n    }\n}\nunordered_map<ll,int>mp;\n\nvoid calc(int opt)\n{\n    R(i,2,t1.tot)\n    {\n        int p=t1.mnp[i];\n        if(t1.len[i]<=p) continue;\n        int cnt=t2.mxlen.get_val(t1.phs2[i]);\n        ans-=cnt;\n        check_pal_deco(t1.seg[i].second-p+1,t1.seg[i].second);\n        if(!opt) mp[t1.phs1[i]]++;\n        else ans+=mp[t1.phs2[i]];\n    }\n}\n\nsigned main()\n{\n    pw1[0]=pw2[0]=1;\n    R(i,1,200005) pw1[i]=1ll*pw1[i-1]*base1%mod1,pw2[i]=1ll*pw2[i-1]*base2%mod2;\n    scanf(\"%s%s\",A+1,B+1);\n    n=strlen(A+1),m=strlen(B+1);\n    init();\n    calc(0);\n    swap(A,B);\n    swap(n,m);\n    swap(t1,t2);\n    swap(t11,t22);\n    calc(1);\n    printf(\"%lld\\n\",ans);\n}\n```\n\n\n",
        "postTime": 1658683712,
        "uid": 115779,
        "name": "\u6781\u5bd2\u795e\u51b0",
        "ccfLevel": 0,
        "title": "cf1081h"
    }
]