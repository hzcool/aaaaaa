[
    {
        "content": "$$\\texttt{Foreword}$$\n\n\u4e0a\u5348\u521a\u8bb2\u5b8c\u7ebf\u6027\u4ee3\u6570\uff0c\u548c\u5f80\u5e38\u4e00\u6837\u53c8\u6ca1\u542c\u61c2\uff0c\u8bfe\u540e\u4f5c\u4e1a\u6709\u8fd9\u4e48\u4e00\u9053\uff0c\u5c31\u6765\u8bb2\u8bb2\u8fd9\u9053\u9898\u5982\u4f55\u4e0d\u7528\u7ebf\u6027\u4ee3\u6570\u505a\u3002\n\n\u5f53\u7136\u4f1a\u7ebf\u6027\u4ee3\u6570\u80af\u5b9a\u4ee3\u7801\u66f4\u597d\u5199\u5e76\u4e14\u65f6\u95f4\u590d\u6742\u5ea6\u66f4\u4f18\uff0c\u8fd9\u7bc7\u9898\u89e3\u4e13\u95e8\u9762\u5411\u50cf\u6211\u4e00\u6837\u4e0d\u4f1a\u7ebf\u6027\u4ee3\u6570\u7684\u849f\u84bb\u3002\n\n$$\\texttt{Description}$$\n\n[CF249D Donkey and Stars](https://www.luogu.com.cn/problem/CF249D)\n\n$$\\texttt{Solution}$$\n\n\u6211\u4eec\u80fd\u591f\u628a\u8fd9\u9053\u9898\u8f6c\u6362\u4e3a\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217\u95ee\u9898\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u4e24\u4e2a\u70b9 $(x_i, y_i)$ \u548c $(x_j, y_j)$ \u8981\u6ee1\u8db3\u4ec0\u4e48\u6761\u4ef6\u624d\u80fd\u4ece $j$ \u8f6c\u79fb\u5230 $i$\u3002\n\n\u9996\u5148\u80af\u5b9a\u8981\u6ee1\u8db3 $x_i > x_j$\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u659c\u7387\u7684\u4e24\u4e2a\u9650\u5236\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u659c\u7387\u5927\u4e8e $\\dfrac{a}{b}$ \u7684\u9650\u5236\uff1a\n\n$$\\dfrac{y_i - y_j}{x_i - x_j} > \\dfrac{a}{b}$$\n\n$$(y_i - y_j) \\times b > (x_i - x_j) \\times a$$\n\n$$y_i \\times b - y_j \\times b > x_i \\times a - x_j \\times a$$\n\n$$y_i \\times b - x_i \\times a > y_j \\times b - x_j \\times a$$\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u659c\u7387\u5c0f\u4e8e $\\dfrac{c}{d}$ \u7684\u9650\u5236\uff0c\u540c\u7406\u53ef\u5f97\uff1a\n\n$$y_i \\times d - x_i \\times c < y_j \\times d - x_j \\times c$$\n\n\u6240\u4ee5\u6211\u4eec\u8bbe $F(i) = y_i \\times b - x \\times a, G(i) = y_i \\times d - x_i \\times c$\u3002\n\n\u5c31\u53ef\u4ee5\u5f97\u5230\u4ece $j$ \u8f6c\u79fb\u5230 $i$ \u7684\u6761\u4ef6\uff1a\n\n$$x_i > x_j, F(i) > F(j), G(i) < G(j)$$\n\n\u8fd9\u660e\u663e\u53ef\u4ee5\u5bf9\u4e8e $\\forall i \\in [1, n], F(i)$ \u548c $G(i)$ \u79bb\u6563\u5316\u540e\uff0c\u7528 $\\text{cdq}$ \u5206\u6cbb\u4f18\u5316\u8f6c\u79fb\u3002\n\n$\\text{cdq}$ \u5206\u6cbb\u4e0d\u4f1a\u7684\u53ef\u4ee5\u53f3\u8f6c [OI Wiki](https://oi-wiki.org/misc/cdq-divide/)\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(n \\log^2 n)}$\u3002\n\n$$\\texttt{Notice}$$\n\n\u7531\u4e8e $x, y, a, b, c, d \\leq 10^5$\uff0c\u6240\u4ee5\u5728\u8ba1\u7b97 $y \\times b - x \\times a$ \u6216\u8005 $y \\times d - x \\times c$ \u65f6\u53ef\u80fd\u4f1a\u7206 $\\text{int}$\u3002\n\n\u7531\u4e8e\u8d77\u59cb\u70b9\u5fc5\u987b\u662f\u539f\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u539f\u70b9\u52a0\u5165\u4e4b\u540e\uff0c\u53cd\u7740\u8fdb\u884c $\\text{dp}$\uff0c\u8fd9\u6837\u5c31\u53d8\u6210\u4e86\u7ec8\u70b9\u5fc5\u987b\u662f\u539f\u70b9\uff0c\u5c31\u53d6\u539f\u70b9\u7684 $\\text{dp}$ \u503c\u5373\u53ef\u3002\n\n$$\\texttt{Code}$$\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int N = 1e5 + 5;\n\nnamespace io {\n\tconst int __SIZE = (1 << 21) + 1;\n\tchar ibuf[__SIZE], *iS, *iT, obuf[__SIZE], *oS = obuf, *oT = oS + __SIZE - 1, __c, qu[55]; int __f, qr, _eof;\n\t#define Gc() (iS == iT ? (iT = (iS = ibuf) + fread (ibuf, 1, __SIZE, stdin), (iS == iT ? EOF : *iS ++)) : *iS ++)\n\tinline void flush () { fwrite (obuf, 1, oS - obuf, stdout), oS = obuf; }\n\tinline void gc (char &x) { x = Gc(); }\n\tinline void pc (char x) { *oS ++ = x; if (oS == oT) flush (); }\n\tinline void pstr (const char *s) { int __len = strlen(s); for (__f = 0; __f < __len; ++__f) pc (s[__f]); }\n\tinline void gstr (char *s) { for(__c = Gc(); __c < 32 || __c > 126 || __c == ' ';)  __c = Gc();\n\t\tfor(; __c > 31 && __c < 127 && __c != ' ' && __c != '\\n' && __c != '\\r'; ++s, __c = Gc()) *s = __c; *s = 0; }\n\ttemplate <class I> inline bool gi (I &x) { _eof = 0;\n\t\tfor (__f = 1, __c = Gc(); (__c < '0' || __c > '9') && !_eof; __c = Gc()) { if (__c == '-') __f = -1; _eof |= __c == EOF; }\n\t\tfor (x = 0; __c <= '9' && __c >= '0' && !_eof; __c = Gc()) x = x * 10 + (__c & 15), _eof |= __c == EOF; x *= __f; return !_eof; }\n\ttemplate <class I> inline void print (I x) { if (!x) pc ('0'); if (x < 0) pc ('-'), x = -x;\n\t\twhile (x) qu[++ qr] = x % 10 + '0',  x /= 10; while (qr) pc (qu[qr --]); }\n\tstruct Flusher_ {~Flusher_(){flush();}}io_flusher_;\n} using io::pc; using io::gc; using io::pstr; using io::gstr; using io::gi; using io::print;\n\nint n, a, b, c, d, M1, M2;\nll dis1[N], dis2[N], B[N], C[N];\n\nstruct Node {\n\tint a, b, c, dp;\n}f[N];\n\nint t[N];\ninline int lowbit(int x) {\n\treturn x & (-x);\n}\n\ninline void update(int x, int v) {\n\twhile (x > 0) {\n\t\tt[x] = max(t[x], v);\n\t\tx -= lowbit(x);\n\t}\n}\n\ninline void clear(int x) {\n\twhile (x > 0) {\n\t\tt[x] = 0;\n\t\tx -= lowbit(x);\n\t}\n}\n\ninline int query(int x) {\n\tint ans = 0;\n\twhile (x <= M1) {\n\t\tans = max(ans, t[x]);\n\t\tx += lowbit(x);\n\t}\n\treturn ans;\n}\n\ninline bool cmp1(Node A, Node B) {\n\tif (A.a ^ B.a) return A.a > B.a;\n\tif (A.c ^ B.c) return A.c < B.c;\n\tif (A.b ^ B.b) return A.b > B.b;\n}\n\ninline bool cmp2(Node A, Node B) {\n\tif (A.c ^ B.c) return A.c < B.c;\n\tif (A.b ^ B.b) return A.b > B.b;\n\tif (A.a ^ B.a) return A.a > B.a;\n}\n\nvoid cdq(int l, int r) {\n\tif (l == r) {\n\t\tf[l].dp++; return ;\n\t}\n\tint mid = l + r >> 1;\n\tcdq(l, mid);\n\tsort(f + l, f + mid + 1, cmp2);\n\tsort(f + mid + 1, f + r + 1, cmp2);\n\tint L = l;\n\tfor (int R = mid + 1; R <= r; R++) {\n\t\twhile (L <= mid && f[L].c < f[R].c) update(f[L].b, f[L].dp), L++;\n\t\tf[R].dp = max(f[R].dp, query(f[R].b + 1));\n\t}\n\tfor (int i = l; i < L; i++) clear(f[i].b);\n\tsort(f + l, f + mid + 1, cmp1);\n\tsort(f + mid + 1, f + r + 1, cmp1);\n\tcdq(mid + 1, r);\n}\n\nint main() {\n\tgi(n); n++;\n\tgi(a); gi(b); gi(c); gi(d);\n\tdis1[1] = dis2[1] = f[1].a = f[1].b = f[1].c = f[1].dp = 0;\n\tfor (int i = 2; i <= n; i++) {\n\t\tint x, y; gi(x); gi(y);\n\t\tf[i].a = x;\n\t\tdis1[i] = B[i] = 1ll * y * b - 1ll * x * a;\n\t\tdis2[i] = C[i] = 1ll * y * d - 1ll * x * c;\n\t\tf[i].dp = 0;\n\t}\n\tsort(dis1 + 1, dis1 + n + 1); sort(dis2 + 1, dis2 + n + 1);\n\tM1 = unique(dis1 + 1, dis1 + n + 1) - dis1 - 1;\n\tM2 = unique(dis2 + 1, dis2 + n + 1) - dis2 - 1;\n\tfor (int i = 1; i <= n; i++) {\n\t\tf[i].b = lower_bound(dis1 + 1, dis1 + M1 + 1, B[i]) - dis1;\n\t\tf[i].c = lower_bound(dis2 + 1, dis2 + M2 + 1, C[i]) - dis2;\n\t}\n\tsort(f + 1, f + n + 1, cmp1);\n\tcdq(1, n);\n\tprint(f[n].dp - 1);\n\treturn 0;\n}\n```\n\n$$\\texttt{Thanks for watching!}$$",
        "postTime": 1660714662,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "CF249D Donkey and Stars"
    },
    {
        "content": "\u8003\u8651\u4ee4 $\\mathbf u = (b,a),\\mathbf v = (d,c)$\uff0c\u6211\u4eec\u628a\u6240\u6709 $(x_i,y_i)$ \u8868\u793a\u6210 $(\\lambda_i,\\mu_i)$\uff0c\u4f7f\u5f97 $\\lambda_i\\mathbf u + \\mu_i\\mathbf v = (x_i,y_i)$\uff0c\u7136\u540e\u91cd\u65b0\u753b\u5728\u5e73\u9762\u4e0a\uff0c\u90a3\u4e48\u4e00\u4e2a\u70b9 $(\\lambda_i,\\mu_i)$ \u80fd\u770b\u5230\u7684\u70b9 $(\\lambda_j,\\mu_j)$ \u5fc5\u7136\u6ee1\u8db3 $\\lambda_i < \\lambda_j$ \u4e14 $\\mu_i < \\mu_j$\uff0c\u663e\u7136\u5c31\u662f\u4e00\u4e2a LIS \uff0c\u4f7f\u7528\u7ebf\u6bb5\u6811\u4f18\u5316 DP \u5c31\u53ef\u4ee5\u5728 $\\mathcal O(n\\log n)$ \u7684\u65f6\u95f4\u5185\u5b8c\u6210\u672c\u9898\u3002\n\n[\u4ee3\u7801\u94fe\u63a5](https://codeforces.com/contest/249/submission/124466210).",
        "postTime": 1627783497,
        "uid": 34238,
        "name": "zhylj",
        "ccfLevel": 9,
        "title": "CF249D Donkey and Stars"
    },
    {
        "content": "### \u9898\u610f\n\u5750\u6807\u7cfb\u4e0a\u7ed9\u51fa $n$ \u4e2a\u70b9\uff0c\u7b2c $i$ \u4e2a\u70b9\u4e3a $(x_i,y_i)$ \u4e14\u8fd9\u4e9b\u70b9\u4e24\u4e24\u4e0d\u540c\u3002\u6c42\u6700\u591a\u6709\u591a\u5c11\u4e2a\u70b9\u4f9d\u6b21\u8fde\u6210\u7684\u6298\u7ebf\u4e0a\u7684\u7ebf\u6bb5\u7684\u659c\u7387\u5728 $\\frac ab$ \u5230 $\\frac cd$ \u4e4b\u95f4\uff08**\u4e0d\u5305\u62ec** $\\boldsymbol{\\frac ab}$ **\u548c** $\\boldsymbol{\\frac cd}$\uff09\u3002\u6298\u7ebf\u5fc5\u987b\u4ece\u5750\u6807\u539f\u70b9\u5f00\u59cb\u4e14\u5750\u6807\u539f\u70b9\u4e0d\u8ba1\u5165\u7b54\u6848\u3002$1\\le n,x_i,y_i\\le 10^5,\\boldsymbol{0\\le}\\ a,b,c,d\\le 10^5,\\frac ab<\\frac cd$\u3002\n### \u89e3\u6cd5\n\u8003\u8651\u628a\u4e24\u4e2a\u70b9\u7684\u659c\u7387\u7528\u53e6\u4e00\u79cd\u65b9\u5f0f\u8868\u793a\uff1a$i$ \u548c $j$ \u4e4b\u95f4\u7684\u659c\u7387\u5728 $\\frac ab$ \u548c $\\frac cd$ \u4e4b\u95f4\u53ef\u4ee5\u8868\u793a\u5982\u4e0b\uff1a\n\n\u5b9a\u4e49\u5411\u91cf $\\overrightarrow {e_1}=(b,a),\\overrightarrow {e_2}=(d,c)$\uff0c\u540c\u65f6\u5c06 $\\overrightarrow{ij}$ \u8868\u793a\u4e3a $a\\overrightarrow{e_1}+b\\overrightarrow{e_2}$\uff08\u5176\u4e2d $a$ \u548c $b$ \u4e3a\u5e38\u6570\uff09\uff0c\u5219\u4ece $i$ \u70b9\u5230 $j$ \u70b9\u80fd\u5ef6\u4f38\u4e00\u6761\u6298\u7ebf\u5f53\u4e14\u4ec5\u5f53 $a>0,b>0$\u3002\u8bc1\u660e\u663e\u7136\u3002\n\n\u540c\u65f6\u4ee4\u539f\u70b9\u4e3a $O$\uff0c\u5219 $\\overrightarrow{ij}=\\overrightarrow{Oj}-\\overrightarrow{Oi}$\u3002\u6545\u800c\u53ef\u4ee5\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u70b9\uff0c\u5904\u7406 $A_i,B_i$ \u6ee1\u8db3 $\\overrightarrow{Oi}=A_i\\overrightarrow{e_1}+B_i\\overrightarrow{e_2}$\u3002\u53ef\u5f97 $B_i=\\frac{y_ib-x_ia}{cb-ad},A_i=\\frac{x_ic-y_id}{cb-ad}$\u3002\uff08\u6ce8\u610f\u6709\u89e3\u5bf9\u5e94\u4e86 $\\frac cd>\\frac ab$\uff0c\u4e5f\u5c31\u662f $cb>ad$\uff0c\u6545\u800c\u53ef\u4ee5\u53ea\u9700\u8981\u7ef4\u62a4 $y_ib-x_ia$ \u548c $x_ic-y_id$ \u4e4b\u95f4\u7684\u5927\u5c0f\u5173\u7cfb\uff09\u8fd9\u6837\u53ef\u4ee5\u4ee4 $dp_i$ \u4e3a $O$ \u70b9\u5230 $i$ \u70b9\u7684\u6700\u957f\u6298\u7ebf\u957f\u5ea6\uff0c\u5219\u8f6c\u79fb\u65b9\u7a0b\u6709 $dp_i=\\max_{A_i-A_j>0\\text{ and }B_i-B_j>0}(dp_j)+1$\u3002\u76f4\u63a5\u7528\u6811\u72b6\u6570\u7ec4\u7edf\u8ba1\u4e8c\u7ef4\u504f\u5e8f\u5373\u53ef\u3002\n### \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int maxn=100010;\nint n,i,a,b,c,d,x,y; \nstruct Vals{\n\tlong long val;\n\tint idx;\n\tinline bool operator <(const Vals &p)const{return val<p.val;}\n}A[maxn],B[maxn];\nstruct node{\n\tint ra,rb;\n\tinline bool operator <(const node &p)const{\n\t\tif(ra!=p.ra) return ra<p.ra;\n\t\treturn rb<p.rb; \n\t}\n}N[maxn];\nint C[maxn],dp[maxn];\ninline void Add(int p,const int &v){\n\tfor(;p<maxn;p+=(p&-p)) C[p]=max(C[p],v);\n}\ninline int Que(int p){\n\tint ret=0;\n\tfor(;p;p&=(p-1)) ret=max(ret,C[p]);\n\treturn ret;\n}\nlong long lst;\nint main(){\n\tscanf(\"%d\",&n);\n\tscanf(\"%d/%d%d/%d\",&a,&b,&c,&d);\n\tfor(i=1;i<=n;++i){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tA[i].idx=B[i].idx=i;\n\t\tB[i].val=(1LL*y*b)-(1LL*x*a);\n\t\tA[i].val=(1LL*x*c)-(1LL*y*d);\n\t}\n\tsort(A+1,A+n+1);sort(B+1,B+n+1);\n\tfor(i=1;A[i].val<=0;++i);\n\tx=1;lst=A[i].val; \n\tfor(;i<=n;++i){\n\t\twhile(A[i].val==lst) N[A[i++].idx].ra=x;\n\t\tlst=A[i].val;N[A[i].idx].ra=++x;\n\t}\n\tfor(i=1;B[i].val<=0;++i);\n\tx=1;lst=B[i].val;\n\tfor(;i<=n;++i){\n\t\twhile(B[i].val==lst) N[B[i++].idx].rb=x;\n\t\tlst=B[i].val;N[B[i].idx].rb=++x;\n\t}\n\tsort(N+1,N+n+1);x=1;a=0;\n\tfor(i=1;!N[i].ra;++i);\n\tfor(;i<=n;++i){\n\t\tif(N[i].ra!=N[x].ra) for(;x<i;++x) if(N[x].rb) Add(N[x].rb,dp[x]);\n\t\tif(N[i].rb) a=max(a,dp[i]=Que(N[i].rb-1)+1);\n\t}\n\tprintf(\"%d\",a);\n\treturn 0;\n}\n```",
        "postTime": 1655544142,
        "uid": 546086,
        "name": "Francais_Drake",
        "ccfLevel": 7,
        "title": "CF249D \u9898\u89e3"
    }
]