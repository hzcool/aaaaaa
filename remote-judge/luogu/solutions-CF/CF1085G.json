[
    {
        "content": "\u82b1\u4e86\u4e00\u4e0b\u5348\u548c\u534a\u4e2a\u665a\u4e0a\u7684\u65f6\u95f4\uff0c\u7ec8\u4e8e\u8fc7\u4e86\uff0c\u5199\u7bc7\u9898\u89e3\u5e86\u795d\u4e00\u4e0b\u3002\n\n\u9996\u5148\uff0c\u60f3\u8981\u505a\u8fd9\u9053\u9898\u9700\u8981\u53bb\u5b66\u4e60\u4e00\u4e0b\u5eb7\u6258\u5c55\u5f00\u548c\u4e0d\u5b8c\u5168\u9519\u6392\u3002\n\n\u9898\u76ee\u8981\u6c42\u627e\u7ed9\u5b9a\u77e9\u9635\u7684\u5b57\u5178\u5e8f\u6392\u540d\uff0c\u4e5f\u5c31\u662f\u6c42\u5b57\u5178\u5e8f\u5c0f\u4e8e\u7ed9\u5b9a\u77e9\u9635\u7684\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u6392\u7684\u6392\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5eb7\u6258\u5c55\u5f00\u6c42\u51fa\u7ed9\u5b9a\u77e9\u9635\u7b2c\u4e00\u6392\u7684\u6392\u540d\u3002\n\n\u4ece\u7b2c\u4e8c\u6392\u5f00\u59cb\uff0c\u5c31\u6709\u4e86\u4e0a\u4e00\u6392\u7684\u9650\u5236\uff0c\u6211\u4eec\u8981\u53bb\u7edf\u8ba1\u524d\u9762\u6240\u6709\u4f4d\u76f8\u540c\u65f6\uff0c\u6bcf\u4e00\u4f4d\u4e0d\u540c\u6240\u4ea7\u751f\u7684\u5b57\u5178\u5e8f\u5c0f\u4e8e\u7ed9\u5b9a\u77e9\u9635\u7684\u77e9\u9635\u4e2a\u6570\u3002\n\n\u5148\u58f0\u660e\u51e0\u4e2a\u53d8\u91cf\uff1a\n\n$a_{i,j}$ \u8868\u793a\u7ed9\u5b9a\u77e9\u9635\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684\u6570\u5b57\u3002\n\n$dp_{i,j}$ \u8868\u793a $i$ \u4e2a\u4f4d\u7f6e\u4e4b\u4e2d\uff0c\u6709 $j$ \u4e2a\u6570\u6709\u9650\u5236\uff08\u63a8\u5bfc\u8fc7\u7a0b\u540e\u9762\u518d\u8bf4\uff09\u3002\n\n\u8fd9\u91cc\u7684\u6709\u9650\u5236\u6307\u7684\u662f\uff0c\u67d0\u4e2a\u6570\u4e0d\u80fd\u653e\u5728\u4e00\u6bb5\u533a\u95f4\u4e2d\u7684\u67d0\u4e2a\u4f4d\u7f6e\u3002\n\n\u4f8b\u5982\uff1a\u4e0a\u4e00\u884c\u67d0\u6bb5\u533a\u95f4\u5185\u7684\u503c\u4e3a $1$ $2$ $3$\uff0c\u672c\u884c\u4e0e\u4e0a\u4e00\u884c\u76f8\u5bf9\u5e94\u7684\u533a\u95f4\u5185\u7684\u503c\u4e3a $1$ $2$ $4$\uff0c\u56e0\u4e3a\u662f\u4ece\u4e0a\u5230\u4e0b\u6b63\u5e8f\u5904\u7406\uff0c\u6240\u4ee5 $1$ \u548c $2$ \u5c31\u662f\u6709\u9650\u5236\u7684\u6570\uff0c\u800c $4$ \u662f\u53ef\u4ee5\u968f\u4fbf\u653e\u7684\u3002\n\n\u90a3\u4e48 $dp_{i,i}$ \u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u9519\u6392\uff0c\u5c31\u662f\u5728 $i$ \u4e2a\u4f4d\u7f6e\u4e0a\u653e $i$ \u4e2a\u6570\uff0c\u4e0d\u80fd\u653e\u5728\u81ea\u5df1\u7684\u4f4d\u7f6e\u4e0a\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5904\u7406\u597d\u7b2c $i$ \u884c\u5b57\u5178\u5e8f\u5c0f\u4e8e\u7ed9\u5b9a\u77e9\u9635\u7b2c $i$ \u884c\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u5269\u4e0b\u7684 $n-i$ \u884c\u5c31\u662f\u9519\u6392\u7684\u6240\u6709\u60c5\u51b5\uff0c\u56e0\u4e3a\u7b2c $i$ \u884c\u5df2\u7ecf\u5904\u7406\u597d\u4e86\uff0c\u800c\u4e14\u8fd9\u4e9b\u60c5\u51b5\u4e2d\u7b2c $i$ \u884c\u7684\u5b57\u5178\u5e8f\u5c0f\u4e8e\u7ed9\u5b9a\u77e9\u9635\uff0c\u90a3\u4e48\u7b2c $i+1$ \u884c\u7684\u60c5\u51b5\u5c31\u76f8\u5f53\u4e8e\u6bcf\u4e2a\u6570\u4e0d\u80fd\u653e\u5728\u7b2c $i$ \u884c\u4e0a\u539f\u6765\u7684\u4f4d\u7f6e\u7684\u9519\u6392\uff0c\u5269\u4e0b\u7684\u6bcf\u884c\u540c\u7406\u3002\n\n\u5047\u8bbe\u7b2c $i$ \u884c\u7684\u60c5\u51b5\u6570\u4e3a $sum$\uff0c\u90a3\u4e48\u5f53\u524d\u4ee5\u8be5\u4f4d\u4ea7\u751f\u7684\u5b57\u5178\u5e8f\u5c0f\u4e8e\u7ed9\u5b9a\u77e9\u9635\u7684\u4e2a\u6570\u4e3a $sum \\times (dp_{n,n})^{n - i}$\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8ba8\u8bba\u7b2c $i$ \u884c\u7684\u60c5\u51b5\u5982\u4f55\u8ba1\u7b97\u3002\n\n\u6211\u4eec\u8ba1\u7b97\u7684\u662f\u524d\u9762\u6bcf\u4f4d\u90fd\u76f8\u540c\uff0c\u76f4\u5230\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u4ea7\u751f\u4e86\u5b57\u5178\u5e8f\u5c0f\u7684\u77e9\u9635\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u77e5\u9053\u4e24\u4e2a\u4e1c\u897f\uff1a\n\n\u4e00\u4e2a\u662f\u53ef\u4ee5\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u653e\u54ea\u4e9b\u6570\u6765\u4ea7\u751f\u5b57\u5178\u5e8f\u5c0f\u7684\u77e9\u9635\uff0c\u53e6\u4e00\u4e2a\u662f\u8fd9\u4e2a\u4f4d\u7f6e\u53f3\u8fb9\u9519\u6392\u7684\u65b9\u6848\u6570\u3002\n\n\u7b2c\u4e00\u4e2a\u6bd4\u8f83\u597d\u5904\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u6765\u5904\u7406\u524d\u9762\u5c0f\u4e8e\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u7b2c\u4e8c\u4e2a\u4f1a\u6709\u4e00\u4e9b\u5c0f\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u8fd9\u4e2a\u4f4d\u7f6e\u653e\u7684\u5b57\u5178\u5e8f\u5c0f\u7684\u6570\u5bf9\u540e\u9762\u9519\u6392\u6570\u7684\u5f71\u54cd\uff0c\u56e0\u4e3a\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u653e\u4e0d\u540c\u7684\u6570\uff0c\u4f1a\u4f7f\u5f97\u540e\u9762\u53ef\u6392\u5e8f\u7684\u6570\u5b57\u53d8\u5316\uff0c\u53ef\u80fd\u4f1a\u4f7f\u7b54\u6848\u53d8\u5316\uff0c\u6240\u4ee5\u6211\u4eec\u7ef4\u62a4\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u4e00\u4e2a\u7ef4\u62a4\u7b2c $i-1$ \u884c\u6ca1\u6709\u51fa\u73b0\u8fc7\u7684\u6570\u5b57\uff0c\u4e00\u4e2a\u7ef4\u62a4\u7b2c $i-1$ \u884c\u51fa\u73b0\u8fc7\u7684\u6570\u5b57\u3002\n\n\u5728 $j$ \u540e\u9762\u7684\u6709\u9650\u5236\u7684\u6570\u662f\u540c\u65f6\u5728\u7b2c $i-1$ \u884c\u7b2c $j$ \u5217\u540e\u9762\u548c\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u540e\u9762\u51fa\u73b0\uff0c\u5047\u8bbe\u6709 $k$ \u4e2a\uff0c\u90a3\u4e48\u5f53\u8fd9\u4e2a\u4f4d\u7f6e\u653e\u7f6e\u5b57\u5178\u5e8f\u5c0f\u7684\u6570\u5b57\u65f6\uff0c$k$ \u53ef\u80fd\u4f1a\u6539\u53d8\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u5c06\u672c\u6765\u6709\u9650\u5236\u7684\u6570\u53d8\u6210\u65e0\u9650\u5236\u7684\u6570\u3002\n\n\u6700\u540e\u6211\u4eec\u6765\u89e3\u91ca\u4e00\u4e0b $dp_{i,j}$ \u6570\u7ec4\u7684\u8f6c\u79fb\uff1a\n\n\u5f53 $j = 0$ \u65f6\uff0c\u56e0\u4e3a\u6ca1\u6709\u9650\u5236\uff0c\u76f4\u63a5\u653e\uff0c\u6240\u4ee5\u662f $i!$\u3002\n\n$dp_{1,1}$ \u9700\u8981\u7279\u6b8a\u5904\u7406\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u6570\uff0c\u800c\u4e14\u6709\u9650\u5236\uff0c\u6240\u4ee5\u4e3a $0$\u3002\n\n\u5f53 $j > 0$ \u65f6\uff0c\u6211\u4eec\u8003\u8651\u524d $i-1$ \u4e2a\u6570\u6709 $j$ \u4e2a\u9650\u5236\uff0c\u6211\u4eec\u5047\u8bbe\u6bcf\u4e2a\u6709\u9650\u5236\u7684\u6570\u5b57\u90fd\u653e\u5728\u81ea\u5df1\u7684\u4f4d\u7f6e\u4e0a\uff08\u5373\u9650\u5236\u81ea\u5df1\u7684\u4f4d\u7f6e\uff09\uff0c\u65e0\u8bba $i$ \u662f\u5426\u6709\u9650\u5236\uff0c\u5c06\u4ed6\u4e0e\u67d0\u4e2a\u6570\u4ea4\u6362\u540e\u518d\u5c06\u5176\u4ed6\u6570\u9519\u6392\uff0c$i$ \u90fd\u4e0d\u4f1a\u6709\u9650\u5236\uff0c\u6240\u4ee5\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5:\u4e0e\u6709\u9650\u5236\u7684\u6570\u4ea4\u6362\uff0c\u4e0e\u65e0\u9650\u5236\u7684\u6570\u4ea4\u6362\uff0e\u7b2c\u4e00\u79cd\u60c5\u51b5\u4f1a\u4f7f\u6709\u9650\u5236\u7684\u6570 $-1$\uff0c\u65b9\u6848\u6570\u4e3a $j \\times dp_{i-1,j-1}$\uff0c\uff08\u5c06 $i$ \u4e0e $j$ \u4ea4\u6362\u540e\uff0c\u56fa\u5b9a $j$\uff0c\u5c06\u5176\u4ed6\u6570\u9519\u6392\uff09\uff1b\u7b2c\u4e8c\u79cd\u60c5\u51b5\u4e0d\u4f1a\u4f7f\u6709\u9650\u5236\u7684\u6570\u7684\u4e2a\u6570\u4ea7\u751f\u53d8\u5316\uff0c\u65b9\u6848\u6570\u4e3a $(i - j) \\times dp_{i - 1,j}$\u3002\n\n\u6240\u4ee5\u5f53 $j > 0$ \u65f6\u7684\u8f6c\u79fb\u4e3a $dp_{i,j} = j \\times dp_{i - 1,j - 1} + (i - j) \\times dp_{i - 1,j}$\u3002\n\n```cpp\n#include <iostream>\n#include <cstring>\nusing namespace std;\n#define ll long long\n#define Re register int\ninline int in(){\n    int x = 0;\n    bool f = 0;\n    char c = getchar();\n    while(c < '0' || c > '9'){\n        if(c == '-') f ^= 1;\n        c = getchar();\n    }\n    while(c <= '9' && c >= '0'){\n        x = (x << 1) + (x << 3) + (c ^ 48);\n        c = getchar();\n    }\n    if(f) return -x;\n    return x;\n}\nconst int N = 2010;\nconst int mod = 998244353;\nint n;\nint a[N][N];\nint c[2][N];\nll dp[N][N];\nll jc[N];\nll ans;\nbool vis[2][N];\ninline void add(int x,int y,bool q){//0\u7ef4\u62a4\u7b2ci-1\u884cj\u5217\u540e\u6709\u9650\u5236\u6570\u5b57\u4e2a\u6570\uff0c1\u7ef4\u62a4\u7b2ci-1\u884cj\u5217\u540e\u65e0\u9650\u5236\u6570\u5b57\u7684\u4e2a\u6570\n    while(x <= n){                  //\u7528\u6765\u5904\u7406\u7b2ci\u884c\u7b2cj\u4e2a\u4f4d\u7f6e\u653e\u6570\u65f6\u5bf9\u540e\u9762\u9519\u6392\u6570\u7684\u5f71\u54cd\n        c[q][x] += y;\n        x += x&(-x);\n    }\n}\ninline ll query(int x,bool q){\n    ll res = 0;\n    while(x){\n        res += c[q][x];\n        x -= x&(-x);\n    }\n    return res;\n}\ninline ll qpow(ll x,int y){\n    ll res = 1;\n    while(y){\n        if(y&1) res = res*x%mod;\n        x = x*x%mod;\n        y >>= 1;\n    }\n    return res;\n}\ninline void pre(){\n    jc[0] = 1;\n    for(Re i = 1;i <= n;++i) jc[i] = jc[i-1]*i%mod;\n    dp[0][0] = 1;\n    for(Re i = 1;i <= n;++i){\n        for(Re j = 0;j <= i;++j){\n            if(!j) dp[i][j] = dp[i-1][j]*i%mod;\n            else if(i == j){\n                if(i == 1) dp[i][i] = 0;\n                else dp[i][i] = (i-1)*(dp[i-1][j-1] + dp[i-2][j-2])%mod;\n            }else dp[i][j] = (j*dp[i-1][j-1]%mod + (i - j)*dp[i-1][j]%mod)%mod;\n            //i\u662f\u5426\u6709\u9650\u5236\u4e0d\u9700\u8981\u8003\u8651\uff0c\u56e0\u4e3a\u65e0\u8bba\u4ed6\u6362\u5230\u54ea\u91cc\uff0c\u90fd\u4f1a\u53d8\u6210\u65e0\u9650\u5236\u7684\u6570\n            //\uff08\u6bcf\u4e2a\u6570\u653e\u5728\u81ea\u5df1\u7684\u4f4d\u7f6e\u4e0a\uff0c\u4ea4\u6362\u7b2ci\u4e2a\u6570\u548c\u53e6\u4e00\u4e2a\u6570\uff0c\u8ba9\u5269\u4e0b\u7684i-1\u4e2a\u6570\u9519\u6392\uff09\n            //\u7528j\u4e2a\u6709\u9650\u5236\u7684\u4f4d\u7f6e\u4e0ei\u6362\n            //\u7528i-j\u4e2a\u65e0\u9650\u5236\u7684\u6570\u4e0ei\u6362\n        }\n    }\n}\nint main(){\n    n = in();\n    for(Re i = 1;i <= n;++i)\n        for(Re j = 1;j <= n;++j)\n            a[i][j] = in();\n    pre();\n    ll res = 0;\n    for(Re i = 1;i <= n;++i){//\u7b2c\u4e00\u5c42\u65e0\u9650\u5236\uff0c\u5eb7\u6258\u5c55\u5f00\u6c42\u6392\u540d\n        ll sum = a[1][i] - 1 - query(a[1][i],1);\n        res = (res + jc[n-i]*sum%mod)%mod;\n        add(a[1][i],1,1);\n    }\n    ans = res*qpow(dp[n][n],n-1)%mod;\n    int k;\n    for(Re i = 2;i <= n;++i){\n        k = n;\n        ll sum = 0;\n        memset(c,0,sizeof(c));\n        memset(vis,0,sizeof(vis));\n        for(Re j = 1;j <= n;++j) add(j,1,0);//\u7528\u6765\u8ba1\u7b97\u7b2cj\u5217\u540e\u6ca1\u6709\u51fa\u73b0\u8fc7\u7684\u4e2a\u6570\n        for(Re j = 1;j <= n;++j){\n            if(!vis[1][a[i-1][j]]){//\u5982\u679ca[i-1][j]\u6ca1\u6709\u5728\u7b2ci\u884c\u51fa\u73b0\u8fc7\uff0c\u90a3\u4e48\u6709\u9650\u5236\u7684\u6570\u5c31\u4f1a\u5c11\u4e00\u4e2a\n                k--;               //\u56e0\u4e3a\u7b2cj\u5217\u540ei-1\u884c\u6ca1\u6709\u8fd9\u4e2a\u6570\uff0c\u4f46i\u884c\u6709\uff0c\u6240\u4ee5\u4ed6\u6ca1\u6709\u9650\u5236\n                add(a[i-1][j],-1,0);\n            }\n            sum = (sum + query(a[i][j]-1,1)*dp[n-j][k]%mod)%mod;//query\u67e5\u8be2\u7684\u662f\u7b2ci-1\u884c\u7b2cj\u5217\u540e\u65e0\u9650\u5236\u7684<a[i][j]\u7684\u4e2a\u6570,\u5c06\u8fd9\u4e9b\u6570\u653e\u5728(i,j)\u7684\u4f4d\u7f6e\uff0c\u540e\u9762\u6709\u9650\u5236\u7684\u6570\u4e0d\u4f1a\u6539\u53d8\n            if(k) sum = (sum + query(a[i][j]-1,0)*dp[n-j][k-1]%mod)%mod;//query\u67e5\u8be2\u7684\u662f\u7b2ci-1\u884c\u7b2cj\u5217\u540e\u6709\u9650\u5236\u7684<a[i][j]\u7684\u4e2a\u6570\uff0c\u5c06\u8fd9\u4e9b\u6570\u653e\u5728(i,j)\u7684\u4f4d\u7f6e\uff0c\u540e\u9762\u6709\u9650\u5236\u7684\u6570\u4f1a-1\n            if(vis[0][a[i][j]]) add(a[i][j],-1,1);//\u5982\u679ci-1\u884c\u51fa\u73b0\u8fc7a[i][j]\uff0c\u90a3\u4e48\u540e\u9762\u65e0\u9650\u5236\u7684\u4e2a\u6570\u5c31\u8981-1\n            else add(a[i][j],-1,0);//\u5426\u5219\u6709\u9650\u5236\u7684\u6570-1\n            vis[0][a[i-1][j]] = vis[1][a[i][j]] = 1;\n            if(!vis[1][a[i-1][j]]) add(a[i-1][j],1,1);//\u5982\u679ca[i-1][j]\u5728\u7b2ci\u884c\u6ca1\u6709\u51fa\u73b0\u8fc7,\u90a3\u4e48\u65e0\u9650\u5236\u7684\u6570+1\n            if(!vis[0][a[i][j]]) k--;//\u5982\u679ca[i][j]\u5728\u7b2ci-1\u884c\u6ca1\u6709\u51fa\u73b0\u8fc7,\u90a3\u4e48\u6709\u9650\u5236\u7684\u6570-1\n        }\n        ans = (ans + sum*qpow(dp[n][n],n-i)%mod)%mod;\n    }\n    printf(\"%lld\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1658709450,
        "uid": 654518,
        "name": "HT_walnut",
        "ccfLevel": 6,
        "title": "CF1085G Beautiful Matrix\u9898\u89e3"
    },
    {
        "content": "- Update on 2023.1.23 \u91cd\u5199\u9898\u89e3\u3002\n\n#### I. [CF1085G Beautiful Matrix](https://www.luogu.com.cn/problem/CF1085G)\n\n\u679a\u4e3e\u6240\u6709\u5b57\u5178\u5e8f\u5c0f\u4e8e $a$ \u7684\u597d\u77e9\u9635 $b$ \u4e0e $a$ \u7684 LCP \u4ee5\u53ca $b$ \u7684\u4e0b\u4e00\u4f4d\u7684\u503c\u3002\u4e0d\u59a8\u8bbe\u7b2c\u4e00\u4e2a\u4e0d\u540c\u4f4d\u4e3a $(i, j)$\u3002\n\n\u679a\u4e3e $b_{i, j}\\in [1, a_{i, j})$ \u4e14 $b_{i, j}$ \u5728 $b_{i, 1} \\sim b_{i, j - 1}$\uff08\u5373 $a_{i, 1}\\sim a_{i, j - 1}$\uff09\u548c $b_{i - 1, j}$\uff08\u5373 $a_{i - 1, j}$\uff09\u5f53\u4e2d\u4e0d\u80fd\u51fa\u73b0\u8fc7\uff0c\u90a3\u4e48\u5f53\u524d\u884c\u63a5\u4e0b\u6765\u53ef\u4ee5\u968f\u4fbf\u586b\uff0c\u4e0b\u9762\u6240\u6709\u884c\u4e5f\u53ef\u4ee5\u968f\u4fbf\u586b\uff0c\u4f46\u8981\u6ee1\u8db3\u4e0a\u4e0b\u76f8\u90bb\u4e24\u4e2a\u6570\u4e0d\u540c\u3002\n\n\u5bf9\u4e8e\u4e0b\u9762\u6240\u6709\u884c\uff0c\u65b9\u6848\u6570\u5f88\u5bb9\u6613\u7b97\uff0c\u5c31\u662f $n$ \u9636\u9519\u6392\u6570\u7684 $n - i$ \u6b21\u65b9\u3002\u4f46\u662f\u5bf9\u4e8e\u5f53\u524d\u884c\u5269\u4e0b $n - j$ \u4e2a\u5143\u7d20\uff0c\u5b83\u4eec\u7684\u586b\u6cd5\u53d7\u5230 $b_{i - 1, j + 1} \\sim b_{i - 1, n}$\uff08\u5373 $a_{i - 1, j + 1} \\sim a_{i - 1, n}$\uff09\u7684\u9650\u5236\uff0c\u4f46\u4e0d\u5b8c\u5168\u53d7\u5230\u9650\u5236\u3002\u5177\u4f53\u5730\uff0c\u6c42\u51fa\u6709\u591a\u5c11\u4e2a\u6570 $v$ \u4f7f\u5f97 $v$ **\u6ca1\u6709** \u5728 $b_{i, 1} \\sim b_{i, j}$ \u5f53\u4e2d\u51fa\u73b0\u8fc7\uff0c\u4e14\u5728 $b_{i - 1, j + 1} \\sim b_{i + 1, n}$ \u5f53\u4e2d\u51fa\u73b0\u8fc7\uff0c\u8bb0\u4f5c $L$\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e $n - j$ \u9636\u6392\u5217\u9650\u5236\u4e86 $L$ \u4e2a\u4f4d\u7f6e\u7684\u9519\u6392\u7684\u65b9\u6848\u6570\uff0c\u8bb0\u4f5c $f_{n - j, L}$\u3002\n\n\u5047\u8bbe $f_{i, j}$ \u5df2\u7ecf\u6c42\u51fa\uff0c\u8003\u8651\u4f18\u5316 $n ^ 3$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\u56e0\u552f\u4e00\u4e0d\u786e\u5b9a\u56e0\u7d20\u662f $b_{i, j}$\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6c42\u51fa\u6ca1\u6709\u51fa\u73b0\u5728 $b_{i, 1}\\sim b_{i, j - 1}$ \u4e14\u51fa\u73b0\u5728 $b_{i - 1, j + 1}\\sim b_{i - 1, n}$ \u7684\u6570\u7684\u4e2a\u6570 $L$\uff0c$b_{i, j}$ \u5bf9 $L$ \u7684\u5f71\u54cd\u6700\u591a\u662f\u5f53 $b_{i, j}$ \u51fa\u73b0\u5728 $b_{i - 1, j + 1}\\sim b_{i - 1, n}$ \u65f6\u5c06 $L$ \u51cf\u53bb $1$\u3002\n\n\u56e0\u6b64\uff0c\u53ea\u9700\u5728 $v\\notin b_{i, 1} \\sim b_{i, j - 1}$ \u7684\u524d\u63d0\u4e0b\uff0c\u7ef4\u62a4\u5b58\u5728\u591a\u5c11\u4e2a $v$ \u4f7f\u5f97 $v\\in b_{i - 1, j + 1}\\sim b_{i - 1, n}$\uff0c\u5e76\u4e14\u652f\u6301\u67e5\u8be2 $\\leq V$ \u7684 $v$ \u7684\u4e2a\u6570\u3002\n\n\u7528\u4e24\u4e2a BIT\uff0c\u4e00\u4e2a\u7ef4\u62a4\u524d\u63d0\u4e0b\u6240\u6709 $v\\in b_{i - 1, j + 1} \\sim b_{i - 1, n}$\uff0c\u53e6\u4e00\u4e2a\u7ef4\u62a4\u524d\u63d0\u4e0b\u6240\u6709 $v$\u3002\u6ce8\u610f $b_{i, j}$ \u4e0d\u80fd\u7b49\u4e8e $b_{i - 1, j}$\uff0c\u6240\u4ee5\u82e5 $b_{i - 1, j} < b_{i, j}$ \u4e14 $b_{i - 1, j}$ \u6ca1\u6709\u5728 $b_{i, 1}\\sim b_{i, j - 1}$ \u51fa\u73b0\u8fc7\uff0c\u8fd8\u8981\u51cf\u53bb $b_{i, j} = b_{i - 1, j}$ \u4ea7\u751f\u7684\u8d21\u732e\u3002\n\n\u63a5\u4e0b\u6765\u89e3\u51b3\u9057\u7559\u95ee\u9898 $f_{i, j}$\u3002\n\n\u5f53 $i = j$ \u65f6\u662f\u7ecf\u5178\u9519\u6392\uff0c\u6709\u9012\u63a8\u5f0f $f_{i, i} = (n - 1)(f_{i - 1} + f_{i - 2})$\u3002\n\n\u5426\u5219 $i > j$\uff0c\u4e0d\u59a8\u8bbe $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u6ca1\u6709\u9650\u5236\u3002\u9009\u62e9 $j$ \u4e2a\u6709\u9650\u5236\u7684\u6570\u5f53\u4e2d\u67d0\u4e00\u4e2a\u653e\u5230\u4f4d\u7f6e $i$\uff0c\u5f97 $j f_{i - 1, j - 1}$\uff1b\u9009\u62e9 $i - j$ \u4e2a\u65e0\u9650\u5236\u7684\u6570\u5f53\u4e2d\u67d0\u4e00\u4e2a\u653e\u5230\u4f4d\u7f6e $i$\uff0c\u5f97 $(i - j)f_{i - 1, j}$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n ^ 2\\log n)$\u3002[\u4ee3\u7801](https://codeforces.com/contest/1085/submission/190149236)\u3002",
        "postTime": 1651136960,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "CF1085G Beautiful Matrix"
    },
    {
        "content": "\u8bbe$A$\u8868\u793a\u7ed9\u51fa\u7684\u77e9\u5f62,$B$\u8868\u793a\u4e00\u4e2a\u5b57\u5178\u5e8f\u5c0f\u4e8e$A$\u7684\u7f8e\u4e3d\u77e9\u5f62.\n\n\u90a3\u4e48,\u6211\u4eec\u5e94\u8be5\u8ba1\u7b97\u5bf9\u4e8e\u6240\u6709\u884c$i$,$A$\u4e0e$B$\u7684\u524d$i-1$\u884c\u76f8\u540c,\u4e14$A_i$\u7684\u5b57\u5178\u5e8f\u5927\u4e8e$B_i$\u7684\u65b9\u6848\u6570.\n\n\u663e\u7136,\u7b2c\u4e00\u884c\u76f4\u63a5\u5eb7\u6258\u5c55\u5f00\u4e00\u4e0b\u5373\u53ef\n\n\u5bf9\u4e8e\u7b2c$2\\rightarrow n$\u884c,\u6bcf\u884c\u7684\u603b\u65b9\u6848\u6570\u5373\u4e3a$n$\u7684\u5143\u7d20\u7684\u9519\u6392\u6570,\u8fd9\u6837\u6bcf\u79cd\u65b9\u6848\u7684\u8d21\u732e\u4e5f\u53ef\u4ee5\u8f7b\u6613\u8ba1\u7b97.\n\n\u7136\u800c\u9ebb\u70e6\u7684\u662f,\u5bf9\u4e8e\u7b2c$i$\u884c,\u73b0\u5728\u5df2\u7ecf\u94a6\u70b9$B_{i-1}=A_{i-1}$,\u6bd4\u8f83\u96be\u8ba1\u7b97\u5b58\u5728\u591a\u5c11\u79cd\u5408\u6cd5\u7684$B_i<A_i$.\n\n\u663e\u7136\u7684\u662f,\u5bf9\u4e8e\u7b2c$i$\u884c\u7684\u6bcf\u4e00\u5217$j$,\u6211\u4eec\u4e5f\u8ba1\u7b97$A_i$\u4e0e$B_i$\u7684\u524d$j-1$\u5217\u76f8\u540c,\u4e14$A_{i,j}>B_{i,j}$\u7684\u65b9\u6848\u6570\u5373\u53ef\n\n\u73b0\u5728\u6211\u4eec\u8981\u8003\u8651\u7684\u95ee\u9898\u662f,\u5df2\u7ecf\u94a6\u70b9\u4e86$A_i$\u4e0e$B_i$\u7684\u524d$j-1$\u5217\u76f8\u540c,\u4e14$A_{i,j}>B_{i,j}$\u7684\u65b9\u6848\u6570\u540e,\u5982\u4f55\u5feb\u901f\u8ba1\u7b97\u540e$n-j$\u5217\u7684\u5408\u6cd5\u65b9\u6848\u6570.\n\n\u8003\u8651\u8fd9\u6837\u4e00\u4ef6\u4e8b\u60c5,\u8bbe$S=\\{A_{i-1,k}|k\\in [1,j]\\},T=\\{B_{i,k}|k\\in [1,j]\\},y=|T|-|S\\bigcap T|=|S|-|S\\bigcap T|$,\u90a3\u4e48$(j,n]$\u4e2d\u5c06\u6709$y$\u4e2a\u4f4d\u7f6e\u4e0d\u53d7\u9650\u5236,\u56e0\u4e3a$\\forall k\\in(j,n]$ \u4e14$A_{i-1,k}\\in T-S\\bigcap T$,$\\nexists B_{i,k}=A_{i-1,k}$.\n\n\u8003\u8651\u8bbe$f_{i,j}$\u8868\u793a\u6709$i$\u4e2a\u5143\u7d20\u7684\u6392\u5217,\u9700\u8981\u6ee1\u8db3$j$\u4e2a\u9650\u5236\u7684\u65b9\u6848\u6570.\u73b0\u5728\u8003\u8651$\\mathtt{DP}$\u8fd9\u4e2a\u4e1c\u897f.\n\n\u663e\u7136,$f_{i,i}$\u5c31\u662f$i$\u4e2a\u5143\u7d20\u7684\u9519\u6392\u6570,$f_{i,0}=i!$\n\n\u5bb9\u6613\u5f97\u51fa,$f_{i,j}=f_{i,j-1}-f_{i-1,j-1}$.\n\n\u8fd9\u6837,\u6bcf\u4e2a\u4f4d\u7f6e\u90fd\u53ef\u4ee5\u5206\u4e24\u7c7b\u8ba8\u8bba.\n1. \u5728$B_{i,j}$\u586b\u4e00\u4e2a$<A_{i,j}$,\u4e14\u6ca1\u6709\u5728$A_{i-1,k}(k\\in[1,j])$\u4e2d\u51fa\u73b0\u8fc7\u7684\u5408\u6cd5\u7684\u6570\n2. \u5728$B_{i,j}$\u586b\u4e00\u4e2a$<A_{i,j}$,\u4e14\u5df2\u7ecf\u5728$A_{i-1,k}(k\\in[1,j])$\u4e2d\u51fa\u73b0\u8fc7\u7684\u5408\u6cd5\u7684\u6570\n\n\u4ee5\u4e0a\u4e24\u79cd\u6570\u7684\u6570\u91cf\u90fd\u53ef\u4ee5\u901a\u8fc7\u6811\u72b6\u6570\u7ec4\u8f7b\u6613\u8ba1\u7b97.\n\n\u8bbe$S=\\{A_{i-1,k}|k\\in [1,j]\\},T=\\{A_{i,k}|k\\in [1,j)\\},x=|S|-|S\\bigcap T|$\n\n\u82e5\u586b\u4e86\u7b2c\u4e00\u79cd\u6570,\u90a3\u4e48\u65b9\u6848\u6570\u4e3a$f_{n-j,n-j-x}$.\n\n\u82e5\u586b\u4e86\u7b2c\u4e8c\u79cd\u6570,\u90a3\u4e48\u65b9\u6848\u6570\u4e3a$f_{n-j,n-j-x+1}$.\n\n```\nint n;\nint a[2005][2005];\nlong long f[2005][2005],g[2005];\nlong long fac[2005];\ntemplate<int T>\nstruct BIT\n{\n\tint c[T];\n\tBIT(){memset(c,0,sizeof(c));}\n\t#define lowbit (x&-x)\n\tinline void add(int x,int val){for(;x<T;x+=lowbit)c[x]+=val;}\n\tinline int ask(int x){int re=0;for(;x;x-=lowbit)re+=c[x];return re;}\n};\nint main()\n{\n\tread(n);\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tread(a[i][j]);\n\tfac[0]=1;for(int i=1;i<=n;i++)fac[i]=fac[i-1]*i%p;\n\tf[0][0]=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tf[i][0]=fac[i];\n\t\tfor(int j=1;j<=i;j++)\n\t\t\tf[i][j]=(f[i][j-1]-f[i-1][j-1]+p)%p;\n\t}\n\tfor(int i=0;i<=n;i++)g[i]=f[i][i];\n\tlong long ans=0;\n\tstatic bool vis[2005];\n\tfor(int j=1;j<=n;j++)\n\t{\n\t\tint t=0;\n\t\tfor(int i=1;i<a[1][j];i++)if(!vis[i])t++;\n\t\tans=(ans+fac[n-j]*t)%p;\n\t\tvis[a[1][j]]=1;\n\t}\n\tans=ans*power(g[n],n-1)%p;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tstatic BIT<2005> S,T;S=BIT<2005>();T=BIT<2005>(); \n\t\tlong long sum=0;\n\t\tstatic bool vis[2005];memset(vis,0,sizeof(vis));\n\t\tstatic bool used[2005];memset(used,0,sizeof(used));\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tlong long A=a[i][j]-1-S.ask(a[i][j]-1);\n\t\t\tlong long B=T.ask(a[i][j]-1);\n\t\t\tif(vis[a[i-1][j]]==0&&a[i-1][j]<a[i][j])A--;//B_{i,j}=A_{i-1,j}\u7684\u4e0d\u5408\u6cd5\u65b9\u6848\u6570 \n\t\t\tif(vis[a[i-1][j]]==0)T.add(a[i-1][j],1);\n\t\t\tvis[a[i][j]]=1;\n\t\t\tint x=T.ask(n);\n\t\t\tsum=(sum+B*f[n-j][n-j-x+1]+(A-B)*f[n-j][n-j-x])%p;\n\t\t\tS.add(a[i][j],1);\n\t\t\tif(used[a[i][j]])T.add(a[i][j],-1);used[a[i-1][j]]=1;\n\t\t}\n\t\tans=(ans+sum*power(g[n],n-i))%p;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1604723073,
        "uid": 114409,
        "name": "9AC8E2",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1085G \u3010Beautiful Matrix\u3011"
    }
]