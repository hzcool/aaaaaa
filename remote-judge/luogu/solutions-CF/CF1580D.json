[
    {
        "content": "\u7b2c\u4e00\u773c\u770b\u5230\u8fd9\u4e2a\u9898\u76ee\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u5173\u6ce8\u8fd9\u4e2a\u5f0f\u5b50\u7684\u7279\u70b9\uff0c\u5e76\u5c1d\u8bd5\u7528\u4eba\u8bdd\u628a\u4ed6\u7ffb\u8bd1\u4e00\u4e0b\n\n\u6240\u4ee5\uff0c\u539f\u5f0f $=$ \u5b50\u5e8f\u5217\u548c $\\times$ \u5b50\u5e8f\u5217\u957f\u5ea6 - **\u6bcf\u5bf9\u5b50\u5e8f\u5217\u4e2d\u7684\u70b9\u6240\u6846\u8d77\u7684\u533a\u95f4\u7684\u6700\u5c0f\u503c\u4e4b\u548c**\n\n\u9996\u5148\u770b\u5230\u540e\u9762\u90a3\u4e24\u4e2a $\\sum$ \uff0c\u5148\u628a $i=j$ \u7684\u7279\u6b8a\u60c5\u51b5\u53bb\u6389\u518d\u8bf4\n\n\u5219\u539f\u5f0f $=$ $\\sum\\limits_{i=1}^m (m-1)*a_{b_i} - \\sum\\limits_{i=1}^n\\sum\\limits_{j=1,i\\ne j}^n f(\\min(b_i,b_j),\\max(b_i,b_j)) $\n\n\u200b            $=\\sum\\limits_{i=1}^m (m-1)*a_{b_i} - 2*\\sum\\limits_{i=1}^n\\sum\\limits_{j=i+1}^n f(b_i,b_j)$\n\n  \u6ce8\u610f\u5230\u5728\u540e\u9762\u7684 $\\sum$ \u4e2d\uff0c\u6bcf\u4e2a $b_i$ \u88ab\u7b97 $m-1$ \u6b21\uff0c\u6070\u597d\u4e0e \u524d\u9762\u5bf9\u5e94\uff0c\u6240\u4ee5\u62c6\u8fdb\u53bb\n\n\u5219\u539f\u5f0f\u5316\u4e3a $\\sum\\limits_{i=1}^n\\sum\\limits_{j=i+1}^n a_{b_i} +a_{b_j} -2*f(b_i,b_j)$\n\n\u5982\u679c\u505a\u60ef\u4e86\u6570\u8bba\u9898\uff0c\u6216\u8bb8\u4f60\u731b\u7136\u5c31\u4f1a\u6709\u4e00\u4e2a\u76f4\u89c9\uff0c\u8fd9\u8ddf\u6811\u4e0a\u4e24\u70b9\u95f4\u7684\u8ddd\u79bb\u5b9e\u5728\u592a\u50cf\u4e86\n\n\u6811\u4e0a\u4e24\u70b9\u95f4\u7684\u8ddd\u79bb\u4e3a $\\operatorname{dep}[x]+\\operatorname{dep}[y]-2*\\operatorname{dep}[\\operatorname{lca}(x,y)]$\n\n\u8fd9\u91cc\u4e3a $a_{b_i}+a_{b_j} - 2 * \\min\\limits_{k=b_i}^{b_j} a_k$\n\n\u6211\u4eec\u601d\u8003\u600e\u4e48\u8f6c\u6362\n\n\n\n\u6240\u4ee5\u6211\u4eec\u8981\u6784\u9020\u4e00\u68f5\u5e26\u6743\u7684\u6811\uff0c\u4ed6\u6ee1\u8db3\u4efb\u610f\u4e24\u70b9\u95f4\u7684 $\\operatorname{lca}$ \u4e3a\u539f\u5e8f\u5217\u4e2d\u6b64\u4e8c\u6570\u6240\u5939\u5b50\u533a\u95f4\u7684\u6700\u5c0f\u503c**\u6240\u5728\u4f4d\u7f6e**\n\n$a_i - d$ \u4e3a\u70b9 $i$ \u5230\u6839\u7684\u6df1\u5ea6 (\u8fd9\u91cc\u7684 $d$ \u53ef\u4e3a\u4efb\u610f\u5e38\u6570)\n\n\u5eb7\u5eb7\u7b2c\u4e00\u4e2a\u9650\u5236\uff0c\u8fd9\u5c31\u662f\u7b1b\u5361\u5c14\u6811 !\n\n\u7b2c\u4e8c\u4e2a\u9650\u5236\u7275\u6d89\u5230\u5bf9\u4e8e\u8fb9\u6743\u7684\u8bbe\u7f6e\n\n\u8003\u8651 $i$ \u5230 $fa_i$ \u7684\u8fb9\u6743\u600e\u4e48\u8bbe,\u8bbe\u5176\u4e3a $w$\n\n\u5219 $w = dep_i - dep_{fa_i} = (a_i - d) -(a_{fa_i} - d) = a_i - a_{fa_i}$\n\n\n\n\u4e8e\u662f\uff0c\u8fd9\u9898\u5c31\u8f6c\u6362\u4e3a\u5728\u6811\u4e0a\u627e $m$ \u4e2a\u70b9\uff0c\u4f7f\u5f97\u4ed6\u4eec\u4e24\u4e24\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e4b\u548c\u6700\u5927\n\n\u6811\u4e0a\u80cc\u5305\u5373\u53ef\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N=4e3+5;\nint ls[N],rs[N],stk[N],top=0,lw[N],rw[N],a[N],n,m;\nint sze[N];\ntypedef long long ll;\nll f[N][N];\ninline void dfs(int x)\n{\n\tsze[x] = 1;\n\tif(ls[x])\n\t{\n\t\tdfs(ls[x]);\n\t\tfor(int i=min(m,sze[x]);i>=0;i--)\n\t\t\tfor(int j=min(m,sze[ls[x]]);j>=0;j--)\n\t\t\t\tf[x][i+j] = max(f[x][i+j],f[x][i] + f[ls[x]][j] + 1ll*j*(m-j)*lw[x]);\n\t\tsze[x] += sze[ls[x]];\n\t}\n\tif(rs[x])\n\t{\n\t\tdfs(rs[x]);\n\t\tfor(int i=min(m,sze[x]);i>=0;i--)\n\t\t\tfor(int j=min(m,sze[rs[x]]);j>=0;j--)\n\t\t\t\tf[x][i+j] = max(f[x][i+j],f[x][i] + f[rs[x]][j] + 1ll*j*(m-j)*rw[x]);\n\t\tsze[x] += sze[rs[x]];\n\t}\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint tmp = top;\n\t\twhile(top && a[stk[top]]>a[i]) rs[stk[top-1]]=stk[top],top--;\n\t\tif(top<tmp) ls[i]=stk[top+1];\n\t\tstk[++top] = i;\n\t}\n\twhile(top) rs[stk[top-1]]=stk[top],top--;\n\n\tfor(int i=1;i<=n;i++)\n\t{\n\t//\tprintf(\"%d,%d\\n\",ls[i],rs[i]);\n\t\tif(ls[i]) lw[i] = abs(a[i]-a[ls[i]]);\n\t\tif(rs[i]) rw[i] = abs(a[i]-a[rs[i]]);\n\t}\n\tint minn=0x7f7f7f7f,pos=0;\n\n\tfor(int i=1;i<=n;i++)\n\t\tif(a[i]<minn)minn=a[i],pos=i;\n\tassert(stk[1] == pos);\n\tdfs(pos);\n\tprintf(\"%lld\\n\",f[pos][m]);\n\treturn 0;\n}\n```\n\n\u4f60\u6216\u8bb8\u4f1a\u5947\u602a\u4e8e\u8fd9\u4e2a\u5199\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\u4f55\u662f $O(n^2)$ \u7684\n\n\u89c2\u5bdf\u6811\u4e0a\u80cc\u5305\u65f6\uff0c\u6211\u4eec\u5176\u5b9e\u662f\u628a\u4e24\u4e2a\u96c6\u5408 $S$ \u548c $T$ \u5408\u5e76\uff0c\u82b1\u8d39 $|S|*|T|$ \u7684\u4ee3\u4ef7\n\n\u63a5\u4e0b\u6765\u53c8\u662f\u4e00\u4e2a\u5947\u5999\u7684\u8f6c\u5316\n\n\n\n\u6211\u4eec\u5efa\u7acb\u4e00\u5f20 $n$ \u4e2a\u70b9\u7684\u65e0\u5411\u56fe\uff0c\u521d\u59cb\u6ca1\u6709\u8fb9\n\n\u6bcf\u5f53\u6211\u4eec\u8981\u5408\u5e76\u70b9\u96c6 $S$ \u548c $T$ \u65f6\uff0c\u5c31\u628a $S$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u5411 $T$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u8fde\u8fb9\n\n\u663e\u7136\uff0c\u56e0\u4e3a $S \\cap T = \\varnothing$ ,\u6240\u4ee5\u6211\u4eec\u4e0d\u4f1a\u8fde\u51fa\u91cd\u8fb9\n\n\u6240\u4ee5\u6bcf\u4e00\u6761\u8fb9\u5c31\u4ee3\u8868\u7740 $O(1)$ \u7684\u590d\u6742\u5ea6\n\n\u800c $n$ \u4e2a\u70b9\u7684\u65e0\u5411\u56fe\u8fde\u5230\u6700\u540e\uff0c\u6700\u591a\u53ea\u6709 $\\frac{n(n-1)}{2}$ \u6761\u8fb9\n\n\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\n\n\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u662f\u4e00\u79cd\u52bf\u80fd\u5206\u6790\u7684\u601d\u60f3\n\n\n\n\u5b8c\u7ed3\u6492\u82b1 \uff01\uff01\uff01",
        "postTime": 1633334485,
        "uid": 226435,
        "name": "\u5929\u547d\u4e4b\u8def",
        "ccfLevel": 0,
        "title": "CF1580D Subsequence \u9898\u89e3"
    },
    {
        "content": "\u5148\u628a\u5f0f\u5b50\u5316\u6210 $(m-1)\\sum_{i=1}^{m}a_{b_i}+2\\sum_{i=1}^{m}\\sum_{j=i+1}^{m}f(b_i,b_j)$\u3002\u76f4\u63a5\u4ece\u5e8f\u5217\u7684\u89d2\u5ea6\u8003\u8651\uff0c\u5982\u679c\u6700\u5c0f\u503c\u7684\u4f4d\u7f6e\u4e3a $pos$\uff0c\u5047\u8bbe\u6700\u5c0f\u503c\u7684\u5de6\u8fb9\u9009 $x$ \u4e2a\u6570\uff0c\u5de6\u8fb9\u548c\u53f3\u8fb9\u5c31\u8f6c\u4e3a\u4e86\u4e24\u4e2a\u89c4\u6a21\u66f4\u5c0f\u7684\u5b50\u95ee\u9898\uff0c$(m-1)\\sum_{i=1}^{m}a_{b_i}$ \u53ef\u4ee5\u7531\u5de6\u8fb9\u548c\u53f3\u8fb9\u5408\u5e76\u4e0a\u6765\uff0c\u800c $2\\sum_{i=1}^{m}\\sum_{j=i+1}^{m}f(b_i,b_j)$ \u5728\u5408\u5e76\u540e\u53ea\u5269\u6a2a\u8de8\u6700\u5c0f\u503c\u7684\u533a\u95f4\u6ca1\u6709\u8ba1\u5165\u7b54\u6848\uff0c\u56e0\u6b64\u9700\u8981\u518d\u52a0\u4e0a $x(m-x)a_{pos}$\u3002\u8bb0\u5fc6\u5316\u4e00\u4e0b\uff0c\u8fd9\u7b49\u4ef7\u4e8e\u6811\u4e0a\u80cc\u5305\uff0c\u590d\u6742\u5ea6\u770b\u4f3c\u662f $O(nm^2)$ \u5b9e\u5219\u662f $O(nm)$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define fo(i,x,y) for(int i=x;i<=y;++i)\n#define go(i,x,y) for(int i=x;i>=y;--i)\n#define sml(x,y) x=min(x,y)\n#define big(x,y) x=max(x,y)\n#define mk make_pair\n#define pb push_back\n#define ll long long\n#define db double\nusing namespace std;\ninline void out(int *a,int l,int r){fo(i,l,r) printf(\"%d \",*(a+i));puts(\"\");}\ninline int read(){ int x=0,f=1; char ch=getchar(); while(!isdigit(ch)){ if(ch=='-') f=-1; ch=getchar(); } while(isdigit(ch)){ x=(x<<1)+(x<<3)+(ch^48); ch=getchar(); } return x*f; }\n\nconst int N=4005;\nconst ll inf=1e15;\nint a[N],n,k,pos[N][N],tot;\nshort int mp[N][N];//\u5361\u7a7a\u95f4\nbool g[N][N];\nll f[N][N];\n\nll solve(int L,int R,int m){\n\t//printf(\"solve(%d,%d,%d)\\n\",L,R,m);\n\tif(m<0) return -inf;\n\tif(L>R){\n\t\tif(m==0) return 0;\n\t\treturn -inf;\n\t}\n\tif(L==R){\n\t\tif(m==0) return 0;\n\t\tif(m==1) return a[L]*(k-1ll);\n\t\treturn -inf;\n\t}\n\tif(!mp[L][R]) mp[L][R]=++tot;\n\tint x=mp[L][R];\n\tif(g[x][m]) return f[x][m];\n\tg[x][m]=1;\n\tint mid=pos[L][R];\n\tif(mid==L) return f[x][m]=max(solve(L+1,R,m),solve(L+1,R,m-1)+a[L]*(k-1ll)-2ll*a[L]*(m-1));\n\tif(mid==R) return f[x][m]=max(solve(L,R-1,m),solve(L,R-1,m-1)+a[R]*(k-1ll)-2ll*a[R]*(m-1));\n\tif(mid-L<R-mid) fo(i,0,min(m,mid-L+1)) big(f[x][m],solve(L,mid,i)+solve(mid+1,R,m-i)-2ll*i*(m-i)*a[mid]);\n\telse fo(i,0,min(m,R-mid+1)) big(f[x][m],solve(L,mid,m-i)+solve(mid+1,R,i)-2ll*i*(m-i)*a[mid]);\n\treturn f[x][m];\n}\n\nint main(){\n\tcin>>n>>k;\n\tfo(i,1,n) a[i]=read(),pos[i][i]=i;\n\tfo(len,2,n)\n\t\tfo(i,1,n-len+1){\n\t\t\tint j=i+len-1;\n\t\t\tif(a[pos[i+1][j]]<a[i]) pos[i][j]=pos[i+1][j];\n\t\t\telse pos[i][j]=i;\n\t\t}\n\tcout<<solve(1,n,k);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1633679542,
        "uid": 238408,
        "name": "vectorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1580D Subsequence"
    },
    {
        "content": "2022/2/18 UPD: [$\\text{\\color{black}C\\color{red}irno\\_9}$](https://www.luogu.com.cn/user/78372) \u6307\u51fa\u65f6\u95f4\u590d\u6742\u5ea6\u5e94\u8be5\u662f $O(n^2)$ \u800c\u975e $O(n^2\\log n)$\uff0c\u5df2\u4fee\u6b63\u3002\n\n\u9996\u5148\u7b80\u5316\u4e00\u4e0b\u9898\u610f\uff0c\u53d1\u73b0\u5c31\u662f\u8ba9\u4f60\u4ece $n$ \u4e2a\u6570\u4e2d\u6309\u987a\u5e8f\u53d6 $m$ \u4e2a\uff0c\u5b9a\u4e49\u5b83\u7684\u6743\u503c\u4e3a\u53d6\u7684\u6570\u7684\u603b\u548c\u7684 $m$ \u500d\u51cf\u53bb\u5b83\u4eec**\u5728\u539f\u5e8f\u5217\u4e2d**\u4e24\u4e24\u4e4b\u95f4\u7684\u6700\u5c0f\u503c\uff0c\u7b54\u6848\u5c31\u662f\u6240\u6709\u53d6\u6cd5\u7684\u6700\u5927\u6743\u503c\u3002\n\n\u4ee4 $dp_{l,r,k}$ \u8868\u793a\u5728 $[l,r]$ \u5185\u9009 $k$ \u4e2a\u6570\u80fd\u591f\u5f97\u5230\u7684\u6700\u5927\u6743\u503c\uff0c$pos$ \u8868\u793a $[l,r]$ \u5185\u6700\u5c0f\u5143\u7d20\u7684\u4e0b\u6807\uff0c\u5219\u6709\u5982\u4e0b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n- $dp_{l,pos-1,x}+dp_{pos+1,r,k-x}-2\\times x\\times (k-x)\\times a_{pos}\\to dp_{l,r,k}$\n\n- $dp_{l,pos-1,x}+dp_{pos+1,r,k-x}+m\\times a_{pos}-(2\\times (x+1)\\times (k-x+1)-1)\\times a_{pos}\\to dp_{l,r,k+1}$\n\n\u7136\u540e\u4f60\u4f1a\u53d1\u73b0\u8fd9\u662f\u4e2a\u88f8\u7684\u80cc\u5305\u95ee\u9898\uff0c\u4e8e\u662f\u4e0a\u9762\u4e24\u4e2a\u5f0f\u5b50\u7684\u610f\u4e49\u4e5f\u5c31\u4e0d\u96be\u5f97\u51fa\uff1a\n\n- \u5982\u679c\u5728 $[l,r]$ \u5185\u4e0d\u9009 $a_{pos}$ \uff0c\u90a3\u4e48\u5df2\u9009\u7684\u5728 $pos$ \u5de6\u8fb9\u7684\u6570\u6709 $x$ \u4e2a\uff0c\u5728 $pos$ \u53f3\u8fb9\u7684\u6570\u6709 $k-x$ \u4e2a\uff0c\u5b83\u4eec\u7684 $f$ \u503c\u5747\u4e3a $pos$ \uff0c\u6545\u5b83\u4eec\u7684\u8d21\u732e\u4e3a $-2\\times x\\times (k-x)\\times a_{pos}$\u3002\n\n- \u5982\u679c\u5728 $[l,r]$ \u5185\u9009\u4e86 $a_{pos}$\uff0c\u90a3\u4e48 $a_{pos}$ \u9996\u5148\u4f5c\u4e3a\u88ab\u9009\u7684\u5143\u7d20\u8981\u8d21\u732e $m\\times a_{pos}$\uff0c\u5df2\u9009\u7684\u5728 $pos$ \u5de6\u8fb9\u7684\u6570\u6709 $x+1$ \u4e2a\uff0c\u5728 $pos$ \u53f3\u8fb9\u7684\u6570\u6709 $k-x+1$ \u4e2a\uff0c\u5b83\u4eec\u5728\u539f\u5e8f\u5217\u4e2d\u4e4b\u95f4\u7684\u6700\u5c0f\u503c\u5747\u4e3a $a_{pos}$ \uff0c\u4f46\u8981\u6ce8\u610f $pos$ \u81ea\u5df1\u548c\u81ea\u5df1\u53ea\u80fd\u8d21\u732e\u4e00\u6b21\uff0c\u6545\u5b83\u4eec\u7684\u603b\u8d21\u732e\u4e3a $m\\times a_{pos}-(2\\times (x+1)\\times (k-x+1)-1)\\times a_{pos}$\u3002\n\n\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u9012\u5f52\u5206\u6cbb\u6c42\u89e3\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ri register int\ntypedef long long ll;\nconst int maxn=4010;\ntemplate<class T>inline bool ckmin(T &x,const T &y){return x>y?x=y,1:0;}\ntemplate<class T>inline bool ckmax(T &x,const T &y){return x<y?x=y,1:0;}\nint a[maxn],m,n;\nvector<ll>solve(int l,int r){\n\tvector<ll>ret(r-l+2,LLONG_MIN);\n\tret[0]=0;\n\tif(l>r)return ret;\n\tri pos=min_element(a+l,a+r+1)-a;\n\tvector<ll>ansL=solve(l,pos-1),ansR=solve(pos+1,r);\n\tfor(ri i=0;i<ansL.size();++i)\n\t\tfor(ri j=0;j<ansR.size();++j){\n\t\t\tckmax(ret[i+j],ansL[i]+ansR[j]-2ll*i*j*a[pos]);\n\t\t\tckmax(ret[i+j+1],ansL[i]+ansR[j]-(2ll*(i+1)*(j+1)-1)*a[pos]+1ll*m*a[pos]);\n\t\t}\n\treturn ret;\n}\nsigned main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(ri i=1;i<=n;++i)scanf(\"%d\",a+i);\n\tprintf(\"%lld\",solve(1,n)[m]);\n\treturn 0;\n}\n```\n",
        "postTime": 1633058225,
        "uid": 67942,
        "name": "meyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1580D \u3010Subsequence\u3011"
    },
    {
        "content": "#### \u524d\u8a00\n\n\u8fd9\u9898\u771f\u7684\u662f \\*2900 \u7684\u9898\u5417\u2026\u2026\uff0c\u611f\u89c9\u53ea\u6709 \\*2300 \u5de6\u53f3\u3002\n\n#### \u6b63\u9898\n\n\u9996\u5148\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u9898\u76ee\u7684\u5f0f\u5b50\uff0c\u53d1\u73b0\u6d89\u53ca\u8bb8\u591a\u6bb5\u533a\u95f4\u6700\u5c0f\u503c\u7684\u548c\uff0c\u9047\u5230\u8fd9\u79cd\u95ee\u9898\uff0c\u6211\u4eec\u8003\u8651\u4f7f\u7528\u7b1b\u5361\u5c14\u6811\u89e3\u51b3\u3002\n\n\u9996\u5148\u5efa\u7acb\u7b1b\u5361\u5c14\u6811\uff0c\u6211\u4eec\u5229\u7528\u7b1b\u5361\u5c14\u6811\u7684\u4e00\u4e2a\u6027\u8d28\uff1a$[x,y]$ \u4e2d\u7684\u6700\u5927/\u5c0f\u503c\u7b49\u4e8e\u6811\u4e0a $x$\uff0c$y$ \u7684 LCA \u7684\u70b9\u6743\u3002\u90a3\u4e48\u4e00\u4e2a\u8282\u70b9\u4f1a\u5728\u5f0f\u5b50\u7684\u540e\u534a\u90e8\u5206\u53ea\u4f1a\u88ab\u81ea\u5df1\u5b50\u6811\u4e2d\u7684\u8282\u70b9\u8d21\u732e\u5230\u3002\u6211\u4eec\u53d1\u73b0\u5408\u5e76\u513f\u5b50\u7684\u8fc7\u7a0b\u5176\u5b9e\u5c31\u662f DP \u7684\u5f62\u5f0f\uff0c\u4e8e\u662f\u6211\u4eec\u8bbe $f_{i,j}$ \u8868\u793a $i$ \u7684\u5b50\u6811\u4e2d\u9009\u4e86 $j$ \u4e2a\u8282\u70b9\u7684\u6700\u5927\u4ef7\u503c\u3002\u90a3\u4e48\u663e\u7136\u6709\u521d\u503c $f_{i,1}=(m-1)\\times a_i$\u3002\u81f3\u4e8e\u5408\u5e76\u513f\u5b50\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a\n\n$$f_{x,i+j}\\leftarrow f_{x,i}+f_{v,j}-2\\times a_x\\times i\\times j$$\n\n\u4e8e\u662f\u5c31\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n^2)$\u3002\n\nCode:\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std ;\nconst int MAXN = 4e3 + 10 ;\nint n , m , a[MAXN] , st[MAXN] , tp , lc[MAXN] , rc[MAXN] , vis[MAXN] , rt , sz[MAXN] ;\ntypedef long long ll ;\nll f[MAXN][MAXN] , g[MAXN] ;\nvoid dfs (int x) {\n\tf[x][1] = (ll)(m - 1) * a[x] , sz[x] = 1 ; \n\tif (lc[x]) {\n\t\tdfs (lc[x]) ;\n\t\tfor (int i = 1 ; i <= sz[x] ; i++) g[i] = f[x][i] ;\n\t\tfor (int i = 0 ; i <= sz[x] ; i++)\n\t\t\tfor (int j = 0 ; j <= sz[lc[x]] ; j++)\n\t\t\t\tf[x][i + j] = max (f[x][i + j] , g[i] + f[lc[x]][j] - 2LL * i * j * a[x]) ;\n\t\tsz[x] += sz[lc[x]] ;\n\t}\n\tif (rc[x]) {\n\t\tdfs (rc[x]) ;\n\t\tfor (int i = 1 ; i <= sz[x] ; i++) g[i] = f[x][i] ;\n\t\tfor (int i = 0 ; i <= sz[x] ; i++)\n\t\t\tfor (int j = 0 ; j <= sz[rc[x]] ; j++)\n\t\t\t\tf[x][i + j] = max (f[x][i + j] , g[i] + f[rc[x]][j] - 2LL * i * j * a[x]) ;\n\t\tsz[x] += sz[rc[x]] ;\n\t}\n}\nint main () {\n\tscanf (\"%d%d\" , &n , &m) ;\n\tfor (int i = 1 ; i <= n ; i++) scanf (\"%d\" , &a[i]) ;\n\tst[tp = 1] = 1 ;\n\tfor (int i = 2 ; i <= n ; i++) {\n\t\tfor (; tp && a[i] < a[st[tp]] ; tp--) ;\n\t\tif (!tp) lc[i] = st[1] ;\n\t\telse lc[i] = rc[st[tp]] , rc[st[tp]] = i ;\n\t\tst[++tp] = i ; \n\t}\n\tfor (int i = 1 ; i <= n ; i++) vis[lc[i]] = vis[rc[i]] = 1 ;\n\tfor (int i = 1 ; i <= n ; i++) if (!vis[i]) rt = i ;\n\tdfs (rt) ;\n\tprintf (\"%lld\\n\" , f[rt][m]) ;\n\treturn 0 ;\n}\n```",
        "postTime": 1660650578,
        "uid": 122641,
        "name": "GIFBMP",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1580D\u3010Subsequence\u3011"
    },
    {
        "content": "\u7a0d\u4f5c\u8f6c\u5316\uff0c\u9898\u76ee\u5c31\u662f\u8981\u6c42\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=i+1}^na_i+a_j-2\\times f(i,j)$$\n\n\u4f60\u4e5f\u8bb8\u4f1a\u53d1\u73b0\u8fd9\u548c\u6811\u4e0a\u4e24\u70b9\u8ddd\u79bb\u516c\u5f0f\u957f\u5f97\u5f88\u50cf\u3002\u4e8e\u662f\u628a\u7b1b\u5361\u5c14\u6811\u5efa\u51fa\u6765\uff0c\u6bcf\u6761\u8fb9\u7684\u6743\u503c\u662f\u4e24\u4e2a\u8282\u70b9\u7684\u6743\u503c\u5dee\u3002\u4e8e\u662f\u5c31\u662f\u9009\u51fa $m$ \u4e2a\u70b9\u4f7f\u4e24\u4e24\u7684\u8ddd\u79bb\u548c\u6700\u5927\u3002\n\n\u8003\u8651 $O(n^2)$ \u7684\u6811\u4e0a DP\u3002\u5b9a\u4e49 $dp[i][j]$ \u8868\u793a\u5728 $i$ \u8fd9\u4e2a\u5b50\u6811\u5185\u9009\u4e86 $j$ \u4e2a\u8282\u70b9\u7684\u6700\u5927\u4ee3\u4ef7\uff0c\u8f6c\u79fb\u65f6\u53ea\u8981\u7b97\u4e00\u6761\u8fb9\u88ab\u7ecf\u8fc7\u4e86\u51e0\u904d\u5c31\u884c\u4e86\u3002\n\n```cpp\n// By: Little09\n// Problem: D. Subsequence\n// Contest: Codeforces - Codeforces Round #745 (Div. 1)\n// URL: https://codeforces.com/problemset/problem/1580/D\n// Memory Limit: 256 MB\n// Time Limit: 1000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst ll inf=1000000000000000000;\nconst int N=4005;\nint n,m; \nll a[N],dp[N][N];\n\ninline int read()\n{\n    int F=1,ANS=0;\n\tchar C=getchar();\n    while (C<'0'||C>'9')\n\t{\n\t\tif (C=='-') F=-1;\n\t\tC=getchar();\n\t}\n    while (C>='0'&&C<='9')\n\t{\n\t\tANS=ANS*10+C-'0';\n\t\tC=getchar();\n\t}\n    return F*ANS;\n}\nint st[N],ls[N],rs[N],rt=1;\nll lw[N],rw[N],size[N];\nvoid build()\n{\n\tint top=0,tot=0;\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tif (a[i]<a[rt]) rt=i;\n\t\ttot=top;\n\t\twhile (tot&&a[st[tot]]>a[i]) tot--;\n\t\tif (tot) rs[st[tot]]=i,rw[st[tot]]=a[i]-a[st[tot]];\n\t\tif (tot<top) ls[i]=st[tot+1],lw[i]=a[st[tot+1]]-a[i];\n\t\tst[++tot]=i;\n\t\ttop=tot;\n\t}\n}\nvoid dfs(int u)\n{\n\tsize[u]=1;\n\tif (ls[u])\n\t{\n\t\tdfs(ls[u]);\n\t\tfor (int i=size[u];i>=0;i--)\n\t\t{\n\t\t\tfor (ll j=size[ls[u]];j>=0;j--)\n\t\t\t{\n\t\t\t\tdp[u][i+j]=max(dp[u][i+j],dp[u][i]+dp[ls[u]][j]+j*(m-j)*lw[u]);\n\t\t\t}\n\t\t}\n\t\tsize[u]+=size[ls[u]];\n\t}\n\tif (rs[u])\n\t{\n\t\tdfs(rs[u]);\n\t\tfor (int i=size[u];i>=0;i--)\n\t\t{\n\t\t\tfor (ll j=size[rs[u]];j>=0;j--)\n\t\t\t{\n\t\t\t\tdp[u][i+j]=max(dp[u][i+j],dp[u][i]+dp[rs[u]][j]+j*(m-j)*rw[u]);\n\t\t\t}\n\t\t}\n\t\tsize[u]+=size[rs[u]];\n\t}\n}\nint main()\n{\n\tn=read(),m=read();\n\tfor (int i=1;i<=n;i++) a[i]=read();\n\tbuild();\n\tdfs(rt);\n\tcout << dp[rt][m];\n\treturn 0;\n}\n\n```\n",
        "postTime": 1633391911,
        "uid": 151475,
        "name": "Little09",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1580D Subsequence"
    },
    {
        "content": "\u7531\u4e8e $f$ \u8868\u793a\u7684\u662f\u4e00\u6bb5\u533a\u95f4\u7684 $\\min$\uff0c\u8003\u8651\u628a\u95ee\u9898\u653e\u5230\u7b1b\u5361\u5c14\u6811\u4e0a\u3002\n\n\u628a\u7b2c\u4e8c\u4e2a\u8d21\u732e\u62c6\u5f00\uff0c\u5c31\u76f8\u5f53\u4e8e $\\sum (m-1)a_{b_i}-2\\sum_{i<j}a_{lca(b_i,b_j)}$\u3002\u8bbe $f_{i,j}$ \u8868\u793a\u70b9 $i$ \u5b50\u6811\u9009\u4e86 $j$ \u4e2a\u7684\u6700\u4f18\u89e3\uff0c\u6811\u5f62 dp \u5373\u53ef\u3002\u7531\u6811\u5377\u79ef\u76f8\u5173\u7406\u8bba\u5bb9\u6613\u8bc1\u660e\u590d\u6742\u5ea6\u4e3a $O(n^2)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=4002;\nll g[N][N];\nint st[N],c[N][2],f[N],siz[N],a[N];\nint n,m,i,tp,rt;\nvoid dfs(int x)\n{\n\tint lc=c[x][0],rc=c[x][1];\n\tsiz[x]=1;\n\tif (!lc&&!rc)\n\t{\n\t\tg[x][0]=0;\n\t\tg[x][1]=(ll)a[x]*(m-1);\n\t\treturn;\n\t}\n\tif (!lc&&rc) swap(lc,rc);\n\tif (!rc)\n\t{\n\t\tdfs(lc);\n\t\tsiz[x]+=siz[lc];\n\t\tmemcpy(g[x],g[lc],(siz[lc]+1)*sizeof g[0][0]);\n\t\tfor (int i=0;i<=siz[lc];i++) g[x][i+1]=max(g[x][i+1],g[lc][i]+(ll)(m-1)*a[x]-2ll*i*a[x]);\n\t\treturn;\n\t}\n\tdfs(lc);dfs(rc);siz[x]+=siz[lc]+siz[rc];\n\tfor (int i=0;i<=siz[lc];i++) for (int j=0;j<=siz[rc];j++) g[x][i+j]=max(g[x][i+j],g[lc][i]+g[rc][j]-2ll*i*j*a[x]);\n\tfor (int i=0;i<=siz[lc];i++) for (int j=0;j<=siz[rc];j++) g[x][i+j+1]=max(g[x][i+j+1],g[lc][i]+g[rc][j]+(ll)(m-1)*a[x]-2ll*(i*j+i+j)*a[x]);\n}\nint main()\n{\n\tmemset(g,-0x3f,sizeof g);\n\tios::sync_with_stdio(false);cin.tie(0);\n\tcin>>n>>m;\n\tfor (i=1;i<=n;i++)\n\t{\n\t\tcin>>a[i];st[tp+1]=0;\n\t\twhile (tp&&a[st[tp]]>a[i]) --tp;\n\t\tc[st[tp]][1]=i;\n\t\tc[i][0]=st[tp+1];\n\t\tst[++tp]=i;\n\t}\n\tfor (i=1;i<=n;i++) f[c[i][0]]=f[c[i][1]]=i;\n\trt=min_element(f+1,f+n+1)-f;\n\tdfs(rt);cout<<g[rt][m]<<endl;\n}\n```",
        "postTime": 1633016125,
        "uid": 29826,
        "name": "SSerxhs",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1580D \u3010Subsequence\u3011"
    }
]