[
    {
        "content": "### \u9898\u610f\n\n\u4e00\u5171\u6709$q$\u7ec4\u8be2\u95ee\uff0c\u6bcf\u7ec4\u8be2\u95ee\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u6392\u5217$p$\uff0c\u8282\u70b9$i$\u5411$p_i$\u8fde\u8fb9\uff0c\u6c42\u6bcf\u4e2a\u70b9\u6240\u5c5e\u7684\u6700\u5c0f\u73af\u7684\u957f\u5ea6\u3002\n\n$\\texttt{Data Range:}1\\leq q\\leq 10^3,1\\leq n\\leq 2\\times 10^5$\n\n### \u9898\u89e3\n\n\u6709\u4e00\u9053\u4e0e\u4e4b\u7c7b\u4f3c\u7684\u9898\uff0c\u53eb\u505a[$\\texttt{Fixed Point Theorem}$](https://www.luogu.org/problem/UVA13074)\uff08\u8bdd\u8bf4\u8fd9\u662f\u5728\u6211\u677f\u5237$\\texttt{UVa}$\u65f6\u5076\u7136\u78b0\u5230\u7684\uff09\n\n\u9996\u5148\u6211\u4eec\u628a\u6392\u5217\u5199\u6210\u7f6e\u6362\u7684\u5f62\u5f0f\uff0c\u6709\n\n$$\\begin{pmatrix}1&2&3&\\cdots&n\\\\p_1&p_2&p_3&\\cdots&p_n\\end{pmatrix}$$\n\n\u7136\u540e\u53ef\u4ee5\u628a\u7f6e\u6362\u62c6\u89e3\u6210\u5faa\u73af\uff0c\u7136\u540e\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u4f4d\u7f6e\u6240\u5728\u5faa\u73af\u7684\u5927\u5c0f\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(qn)$\uff0c\u6bd4$\\texttt{Tarjan}$\u5e38\u6570\u5c0f\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\nconst ll MAXN=1e6+51;\nll test,cnt,tot;\nll vis[MAXN],perm[MAXN],bel[MAXN],size[MAXN];\ninline ll read() \n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll dfs(ll cur,ll cnt,ll tot)\n{\n\tif(vis[cur])\n\t{\n\t\treturn cnt;\n\t}\n\tvis[cur]=1,size[tot]++,bel[cur]=tot;\n\treturn dfs(perm[cur],cnt+1,tot);\n}\ninline void solve()\n{\n\tfor(register int i=1;i<=cnt;i++)\n\t{\n\t\tif(!vis[i])\n\t\t{\n\t\t\tdfs(i,0,++tot);\n\t\t}\n\t}\n\tfor(register int i=1;i<=cnt;i++)\n\t{\n\t\tprintf(\"%d \",size[bel[i]]);\n\t}\n\tputs(\"\");\n}\nint main()\n{\n\ttest=read();\n\tfor(register int t=0;t<test;t++)\n\t{\n\t\tcnt=read();\n\t\tfor(register int i=1;i<=cnt;i++)\n\t\t{\n\t\t\tperm[i]=read();\n\t\t}\n\t\tsolve();\n\t\ttot=0,\n\t\tmemset(vis,0,sizeof(vis)),memset(bel,0,sizeof(bel));\n\t\tmemset(size,0,sizeof(size));\n\t}\n}\n```",
        "postTime": 1571831684,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF1249B2 \u3010Books Exchange (hard version)\u3011"
    },
    {
        "content": "\u672c\u9898\u7684\u6807\u51c6\u505a\u6cd5\u662f$Tarjan$\u6216\u8005$Kosarajo$\u7f29\u70b9\uff0c\u4f46\u662f\u778e\u641c\u4e00\u4e0b\u4e5f\u662f\u53ef\u4ee5\u8fc7\u7684\u3002$dfs$\u5bfb\u627e\u5982\u679c\u4e0b\u4e00\u4e2a\u5c31\u662f\u8981\u627e\u7684\u76ee\u6807\u90a3\u5c31\u8fd4\u56de$cnt$\u7684\u503c\uff0c$cnt$\u4e3a\u5f53\u524d\u8fdb\u884c\u4e86\u51e0\u6b21\u4ea4\u6362\n```cpp\n#include<iostream>\n#include<cstring>\nusing namespace std;\n\n#define mfor(i,a,b) for(register int i=(a);i<=(b);i++)\n#define mem(a,b) memset(a,(b),sizeof(a))\n\nint T;\nint n;\nint tu[1000010];\nbool vis[1000010];\nint ans[1000010];\n\nint dfs(int x, int t, int cnt)\n{\n//t\u8868\u793a\u641c\u7d22\u76ee\u6807\uff0cx\u8868\u793a\u5f53\u524d\u641c\u7d22\u7684\u662f\u54ea\u4e2a\uff0ccnt\u8868\u793a\u5f53\u524d\u6df1\u5ea6\n    vis[x] = true;\n    if (t == tu[x]) return ans[x] = cnt + 1;\n    return ans[x] = dfs(tu[x], t, cnt + 1);\n}\n\nint main()\n{\n    cin >> T;\n    mfor(p, 1, T)\n    {\n        cin >> n;\n        mem(vis, false);\n        //\u591a\u7ec4\u6837\u4f8b\u4e00\u5b9a\u8981\u6ce8\u610f\u521d\u59cb\u5316\u95ee\u9898\n        mfor(i, 1, n) cin >> tu[i];\n        mfor(i, 1, n)\n        {\n            if (!vis[i])\n            {\n                dfs(i, i, 0);\n            }\n        }\n        mfor(i, 1, n)\n        {\n            cout << ans[i] << \" \";\n        }\n        cout << endl;\n    }\n}\n```\n\n\n-------------------------\n### \u66f4\u65b0\n\u5949\u4e0a$Tarjan$\u7b97\u6cd5\u7f29\u70b9\u6b63\u89e3\uff08\u6bd4\u778e\u641c\u5199\u8d77\u6765\u9ebb\u70e6\u5f88\u591a\uff0c\u800c\u4e14\u56e0\u4e3a\u591a\u79cd\u539f\u56e0\u6bd4\u5982\u521d\u59cb\u5316\u9ebb\u70e6\uff0c\u5e38\u6570\u66f4\u5927\u7b49\u7b49\u6bd4\u778e\u641c\u8fd8\u6162\u4e00\u70b9\uff09\n\n\u6839\u636e\u9898\u610f\uff0c\u6bcf\u6b21\u4f20\u4e66\u6700\u7ec8\u90fd\u80fd\u4f20\u56de\u81ea\u5df1\uff0c\u6240\u4ee5\u8fd9\u4e2a\u4f20\u4e66\u7684\u5faa\u73af\u6784\u6210\u4e00\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\uff0c\u800c\u6bcf\u4e2a\u70b9\u6240\u5728\u5f3a\u8fde\u901a\u5206\u91cf\u4e2d\u7684\u70b9\u6570\u5c31\u662f\u4f20\u56de\u81ea\u5df1\u6240\u9700\u8981\u7684\u4f20\u4e66\u6b21\u6570\n```cpp\n#include<iostream>\n#include<stack>\n#include<algorithm>\n#include<cstring>\nusing namespace std;\n\nint T, n;\nconst int maxn = 200010;\nint dfn[maxn]; //\u7b2ci\u4e2a\u70b9\u88abdfs\u5230\u7684\u6b21\u5e8f\nint low[maxn];    //\u4e8c\u53c9\u641c\u7d22\u6811\u4e0ai\u6240\u5728\u5b50\u6811\u4e0a\u4ecd\u5728\u6808\u4e2d\u7684\u6700\u5c0fdfn\uff0clow[i]\u76f8\u7b49\u7684\u70b9\u5728\u4e00\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u4e2d\nbool vis[maxn];\t//\u662f\u5426\u5728\u6808\u4e2d\nstack<int>s;\nint turn[maxn];\nint tot;\nint num[maxn];    //\u7b2ci\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u7684\u70b9\u6570\nint res[maxn];\t//res[i]\u8868\u793ai\u5728\u7b2c\u51e0\u4e2a\u5f3a\u8fde\u901a\u5206\u91cf\u4e2d\nint cnt;\n\nvoid tarjan(int x)\n{\n\tdfn[x] = low[x] = ++cnt;\n\ts.push(x);\n\tvis[x] = true;\n\tif (!dfn[turn[x]])\n\t{\n\t\ttarjan(turn[x]);\n\t\tlow[x] = min(low[x], low[turn[x]]);\n\t}\n\telse if (vis[turn[x]])\n\t{\n\t\tlow[x] = min(low[x], dfn[turn[x]]);\n\t}\n\tif (low[x] == dfn[x])\n\t{\n\t\ttot++;\n\t\twhile (!s.empty() && s.top() != x)\n\t\t{\n\t\t\tint t = s.top();\n\t\t\tnum[tot]++;\n\t\t\tres[t] = tot;\n\t\t\tvis[t] = false;\n\t\t\ts.pop();\n\t\t};\n\t\ts.pop();\n\t\tnum[tot]++;\n\t\tres[x] = tot;\n\t\tvis[x] = false;\n\t}\n}\n\nint main()\n{\n\tcin >> T;\n\twhile (T--)\n\t{\n\t\tcin >> n;\n\t\tfor (int i = 1; i <= n; i++)\n\t\t{\n\t\t\tcin >> turn[i];\n\t\t}\n\t\tfor (int i = 1; i <= n; i++)\n\t\t{\n\t\t\tif (!dfn[i])\n\t\t\t{\n\t\t\t\ttarjan(i);\n\t\t\t}\n\t\t}\n\t\tfor (int i = 1; i <= n; i++)\n\t\t{\n\t\t\tcout << num[res[i]] << \" \";\n\t\t}\n\t\tcout << endl;\n\t\tmemset(dfn, 0, sizeof(dfn));\n\t\tmemset(low, 0, sizeof(low));\n\t\tmemset(num, 0, sizeof(num));\n\t\tmemset(res, 0, sizeof(res));\n\t\ttot = 0;\n\t\tcnt = 0;\n\t}\n}\n```",
        "postTime": 1572007520,
        "uid": 205228,
        "name": "thjkhdf12",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1249B2 \u3010Books Exchange (hard version)\u3011"
    },
    {
        "content": "~~\u597d\u50cf\u5728\u8003\u573a\u4e0a\u770b\u89c1\u8fd9\u79cd\u9898~~\n\n- \u9898\u610f\n\n\u6765\u63d0\u4f9b\u4e00\u6ce2\u7ffb\u8bd1\uff1a\n\n\u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217 $p$\uff0c\u8868\u793a $i$ \u6307\u5411 $p_i$\uff0c\u6c42\u6bcf\u4e2a\u70b9\u6240\u5728\u73af\u7684\u957f\u5ea6\uff0c\u591a\u7ec4\u6d4b\u8bd5\uff0c$\\sum n \\le 2 \\times 10^5$\u3002\n\n- \u5206\u6790\n\n\u6211\u89c9\u5f97\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u65e2\u7136\u662f\u6392\u5217\uff0c\u5c31\u76f4\u63a5\u66b4\u529b\u8df3\u3001\u6253\u6807\u8bb0\uff0c\u590d\u6742\u5ea6 $O(n)$\u3002\n\n- code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nnamespace IO{\n\tchar ibuf[(1 << 20) + 1], *iS, *iT;\n\t#if ONLINE_JUDGE\n\t#define gh() (iS == iT ? iT = (iS = ibuf) + fread(ibuf, 1, (1 << 20) + 1, stdin), (iS == iT ? EOF : *iS++) : *iS++)\n \t#else\n\t#define gh() getchar()\n\t#endif\n\t#define reg register\n\tinline long long read () {\n\t\treg char ch = gh();\n\t\treg long long x = 0;\n\t\treg char t = 0;\n\t\twhile (ch < '0' || ch > '9')   t |= ch == '-', ch = gh();\n\t\twhile (ch >= '0' && ch <= '9') x = (x << 1) + (x << 3) + (ch ^ 48), ch = gh();\n\t\treturn t ? -x : x;\n\t}\n\tinline void write(long long x) {\n\t\tif (x < 0) {\n\t\t\tx = ~(x - 1);\n\t\t\tputchar('-');\n\t\t}\n\t\tif (x > 9)\n\t\t\twrite(x / 10);\n\t\tputchar(x % 10 + '0');\n\t}\n}\n\nusing IO::read;\nusing IO::write;\n\nconst int maxn = 2e5 + 500;\nint T, n, p[maxn], ans[maxn];\nbool vis[maxn];\n\nint main () {\n\tT = read();\n\twhile (T--) {\n\t\tn = read();\n\t\tfor (int i = 1; i <= n; i++) p[i] = read(), vis[i] = 0; \n\t\tfor (int i = 1; i <= n; i++) {\n\t\t\tif (vis[i]) continue;\n\t\t\tint len = 0, x = i;\n\t\t\twhile (p[x] != i) vis[x] = 1, len++, x = p[x];\n\t\t\tvis[x] = 1, len++, x = i;\n\t\t\twhile (p[x] != i) ans[x] = len, x = p[x];\n\t\t\tans[x] = len;\n\t\t}\n\t\tfor (int i = 1; i <= n; i++) write(ans[i]), putchar(' ');\n\t\tputs(\"\");\n\t}\n}\n```",
        "postTime": 1663248670,
        "uid": 317495,
        "name": "JWRuixi",
        "ccfLevel": 7,
        "title": "CF1249B2"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\n\u5171 $q$ \u7ec4\u8be2\u95ee\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u7ec4\u8be2\u95ee\u6709\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $p$\uff0c$p_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u4eba\u7684\u4e0b\u4e00\u4f4d\u662f $p_i$\u3002\n\n\u6c42\u6bcf\u4e00\u4e2a\u70b9\u6240\u5728\u73af\u7684\u957f\u5ea6\u3002\n\n### \u5173\u4e8e\u89e3\u6cd5\n\n\u672c\u9898\u662f\u4e00\u9053\u8bb0\u5fc6\u5316\u641c\u7d22\u9898\uff08\u6211\u4e0d\u4f1a Tarjan \u7f29\u70b9\uff09\uff0c\u4ece\u800c\u51cf\u5c11\u65f6\u95f4\u590d\u6742\u5ea6\u3002\u9898\u76ee\u5927\u610f\u8bf7\u53c2\u8003 [CF1249B1](https://www.luogu.com.cn/problem/CF1249B1)\u3002\n\n\u6211\u4eec\u53d1\u73b0\u5982\u679c\u66b4\u529b\u641c\u7d22\u7684\u8bdd\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u6211\u4eec\u90fd\u4f1a\u4e00\u76f4\u641c\u7d22\u76f4\u5230\u73af\uff0c\u800c\u8fd9\u4e2a\u7b97\u6cd5\u4f1a\u8ba9\u6709\u8bb8\u591a\u70b9\u91cd\u590d\u8d70\u8fc7\u591a\u6b21\uff0c\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u60f3\u5230\u4e86\u8bb0\u5fc6\u5316\u641c\u7d22\u3002\n\n\u66b4\u529b\u641c\u7d22\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(\\sum n^2)$\uff0c\u8bb0\u5fc6\u5316\u641c\u7d22\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(\\sum n)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint e[200010],q,n,cnt,t,f[200010],ans[200010];//\u8bb0\u5fc6\u5316\u641c\u7d22 \ninline int read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0' || ch>'9')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9') x=x*10+ch-'0',ch=getchar();\n    return x*f;\n}\nvoid write(int x)\n{\n    if(x<0) putchar('-'),x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n    return;\n}\ninline int search(int pos,int t,int cnt)\n{\n\tf[pos]=1;\n\tif(t==e[pos]) return ans[pos]=cnt+1;\n\telse return ans[pos]=search(e[pos],t,cnt+1);\n}\nint main()\n{\n    q=read();\n    while(q--)\n    {\n        n=read();\n        memset(e,0,sizeof(e)),memset(f,0,sizeof(f));\n        for(int i=1;i<=n;i++) e[i]=read();\n        for(int i=1;i<=n;i++) if(!f[i]) search(i,i,0);\n        for(int i=1;i<=n;i++) write(ans[i]),printf(\" \");\n        printf(\"\\n\");\n    }\n    return 0;\n}\n```\n",
        "postTime": 1663074392,
        "uid": 553625,
        "name": "scp020",
        "ccfLevel": 4,
        "title": "CF1249B2 Books Exchange (hard version) \u9898\u89e3"
    },
    {
        "content": "**\u9898\u76ee\u5927\u610f**\n\n\u6709 $n$ \u4e2a\u5c0f\u670b\u53cb\u6bcf\u4eba\u624b\u91cc\u6709\u4e00\u672c\u4e66\uff0c\u7ed9\u5b9a\u4e00\u4e2a\u6392\u5217 $a$\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u7b2c $i$ \u4e2a\u5c0f\u670b\u53cb\u4f1a\u628a\u4e66\u7ed9 $a_i$\u3002\u6c42\u6bcf\u4e2a\u5c0f\u670b\u53cb\u7684\u4e66\u4f1a\u5728\u51e0\u8f6e\u540e\u56de\u5230\u81ea\u5df1\u624b\u91cc\u3002\n\n**\u89e3\u9898\u601d\u8def\u4e00**\n\n\u5f88\u7b80\u5355\uff0c\u5b9e\u73b0\u4e00\u4e2a\u7b80\u6613\u7684 $\\texttt{DFS}$\uff0c\u5c31\u53ef\u4ee5\u627e\u51fa\u6bcf\u4e2a\u5c0f\u670b\u53cb\u5728\u7b2c\u51e0\u8f6e\u53ef\u4ee5\u62ff\u56de\u81ea\u5df1\u7684\u4e66\u3002\n\n\u867d\u7136\u8fd9\u79cd\u65b9\u6cd5\u770b\u4e0a\u53bb\u5f88\u7b80\u5355\uff0c\u4f46\u5b9e\u9645\u4e0a\u4f1a $\\texttt{TLE}$\uff0c\u6240\u4ee5\u5efa\u8bae\u4f7f\u7528\u601d\u8def\u4e8c\u3002\n\n**\u89e3\u9898\u601d\u8def\u4e8c**\n\n\u9012\u5f52\u3001\u5e76\u67e5\u96c6\u3002\u7531\u4e8e\u6bcf\u4e2a\u6570\u5b57\u53ea\u51fa\u73b0\u4e00\u6b21\uff0c\u81ea\u5df1\u591a\u753b\u51e0\u4e2a\u6837\u4f8b\uff0c\u53ef\u4ee5\u53d1\u73b0\u8981\u4e48\u4f1a\u5f62\u6210\u73af\uff0c\u8981\u4e48\u5c31\u5355\u72ec\u4e00\u4e2a\u70b9\uff08\u6216\u8005\u53eb\u81ea\u73af\uff09\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ece\u6bcf\u4e2a\u6ca1\u6709\u904d\u5386\u8fc7\u7684\u70b9\u90fd\u8fdb\u884c\u4e00\u6b21\u9012\u5f52\u641c\u7d22\u5373\u53ef\uff0c\u6700\u540e\u8fd9\u4e2a\u73af\u91cc\u9762\u6709\u51e0\u4e2a\u70b9\uff0c\u90a3\u4e48\u5c31\u8981\u4f20\u9012\u51e0\u4e2a\u4eba\u3002\n\n**AC \u4ee3\u7801\uff0c\u8bf7\u52ff\u6284\u88ad**\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N = 2e5 + 5;\nint t, n, a[N], ans[N];\nbool vis[N];\nint dfs(int x, int d) {\n\tif(vis[x]) {\n\t\treturn d - 1;\n\t}\n\tvis[x] = 1;\n\treturn ans[x] = dfs(a[x], d + 1);\n}\nint main() {\n\tint t;\n\tcin >> t;\n\twhile(t--) {\n\t\tcin >> n;\n\t\tfill(vis, vis + n + 1, 0);\n\t\tfor(int i = 1; i <= n; i++) {\n\t\t\tcin >> a[i];\n\t\t}\n\t\tfor(int i = 1; i <= n; i++) {\n\t\t\tif(vis[i]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tdfs(i, 1);\n\t\t}\n\t\tfor(int i = 1; i <= n; i++) {\n\t\t\tcout << ans[i] << \" \";\n\t\t}\n\t\tcout << \"\\n\";\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1660536080,
        "uid": 482592,
        "name": "cyfqwq",
        "ccfLevel": 4,
        "title": "CF1249B2 Books Exchange (hard version)\u9898\u89e3"
    },
    {
        "content": "\u770b\u5230\u5927\u4f6c\u4eec\u5404\u79cd$Tarjan$\u7f29\u70b9\uff0c\u849f\u84bb\u745f\u745f\u53d1\u6296\u2026\u2026\n\n\u5f53\u65f6\u73b0\u573a\u6bd4\u8d5b\u7684\u65f6\u5019\u5c31\u770b\u5230\u5b83\u548c[\u8fd9\u4e2a\u9898](https://www.luogu.org/problem/P2661)\u6709\u8bf8\u591a\u76f8\u4f3c\u4e4b\u5904\u3002\n\n\u5728\u8fd9\u9053$NOIP$\u539f\u9898\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u6bcf\u4e2a\u70b9\u5230\u5bf9\u5e94\u6839\u7684\u8ddd\u79bb\u4ee5\u53ca\u6700\u5c0f\u73af\u7684\u5927\u5c0f\u3002\u7c7b\u4f3c\u5730\uff0c\u6b64\u9898\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5e76\u67e5\u96c6\u89e3\u51b3\u3002\u7ef4\u62a4\u8ddd\u79bb\u64cd\u4f5c\u5b8c\u5168\u76f8\u540c\uff0c\u7ef4\u62a4\u73af\u65f6\u5f00\u4e00\u4e2a$ans$\u6570\u7ec4\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u6240\u5728\u73af\u7684\u5927\u5c0f\uff0c\u6bcf\u6b21$find$\u65f6\u66f4\u65b0\u8ddd\u79bb\uff0c\u5408\u5e76\u65f6\u66f4\u65b0\u6362\u7684\u5927\u5c0f\u5373\u53ef\u3002\n\n\u8fd9\u91cc\u8fd8\u6709\u4e00\u70b9\u5c0f\u95ee\u9898\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u4e2d\u4e0d\u5728\u6700\u540e\u4e00\u6761\u8fb9\u4e0a\u7684\u70b9\uff08\u5373\u4e0d\u662f\u201c\u5c01\u53e3\u201d\u7684\u70b9\uff09\uff0c\u66f4\u65b0$ans$\u6570\u7ec4\u65f6\uff0c\u8fd9\u4e9b\u70b9\u5e76\u4e0d\u4f1a\u88ab\u66f4\u65b0\u5230\u3002\u6240\u4ee5\u6211\u4eec\u5728\u8f93\u51fa\u65f6\uff0c\u5c06$ans[i]$\u6539\u4e3a$ans[find(i)]$\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ull unsigned long long\n#define ff first\n#define ss second\n#define rep(i,a,b) for(int i=(a);i<=(b);i++)\n#define per(i,a,b) for(int i=(a);i>=(b);i--)\nusing namespace std;\nconst int INF=2147483647;\ninline int read()\n{\n\tint x=0,k=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')k=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<3)+(x<<1)+(c^48);c=getchar();}\n\treturn x*k;\n}\nint f[200086],n,q,ans[200086],d[200086];\nint find(int x)\n{\n\tif(x!=f[x])\n\t{\n\t\tint last=f[x];\n\t\tf[x]=find(f[x]);\n\t\td[x]+=d[last];\n\t}\n\treturn f[x];\n}\nvoid merge(int x,int y)\n{\n\tint fx=find(x),fy=find(y);\n\tif(fx!=fy)f[fx]=fy,d[x]=d[y]+1;\n\telse\n\t{\n\t\tans[x]=min(ans[x],d[x]+d[y]+1);\n\t\tans[y]=min(ans[x],d[x]+d[y]+1);\n\t}\n}\nint main()\n{\n\tq=read();\n\twhile(q--)\n\t{\n\t\tmemset(f,0,sizeof(f));\n\t\tmemset(ans,0x7f,sizeof(ans));\n\t\tmemset(d,0,sizeof(d));\n\t\tn=read();\n\t\trep(i,1,n)f[i]=i;\n\t\trep(i,1,n)\n\t\t{\n\t\t\tint p=read();\n\t\t\tmerge(i,p);\n\t\t}\n\t\trep(i,1,n)printf(\"%d \",ans[find(i)]);\n\t\tprintf(\"\\n\");\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1572528063,
        "uid": 35617,
        "name": "lengxinjy",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 CF1249B2 \u3010Books Exchange (hard version)\u3011"
    },
    {
        "content": "\u66b4\u529b\u6a21\u62df\u5373\u53ef\u3002\n\n\u6bcf\u6b21\u641c\u7d22\u7b2c\u4e00\u4e2a\u8fd8\u6ca1\u52a0\u5165\u5230\u73af\u4e2d\u7684\u70b9$i$\uff0c\u5728\u8def\u5f84\u4e2d\u628a\u9014\u4e2d\u7ecf\u8fc7\u7684\u70b9\u7684$step$\u6807\u8bb0\u4e3a$i$\u3002\u6700\u540e\u5c06\u73af\u7684\u957f\u5ea6\u8d4b\u7ed9$i$\u5373\u53ef\u3002\n\n```cpp\n#include<cctype> \n#include<cstdio>\n#define R register\nint Q,N,A[200005],f[200005],p[200005];\ntemplate<class T>inline void read(R T &m)\n{\n\tm=0;\n\tR char c=getchar();\n\twhile(!isdigit(c))c=getchar();\n\twhile(isdigit(c))m=(m<<3)+(m<<1)+(c&15),c=getchar();\n}\nint main()\n{\n\tread(Q);\n\twhile(Q--)\n\t{\n\t\tread(N);\n\t\tfor(R int i=1;i<=N;++i)\n\t\t{\n\t\t\tread(A[i]);\n\t\t\tf[i]=0; //\u5f53\u524d\u70b9\u5f00\u59cb\u7684\u73af\u957f\u5ea6\n\t\t\t\t//\u6ce8\u610f\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u641c\u5230\u7684\u70b9\u6807\u8bb0\u73af\u957f\u5ea6\uff0c\u5176\u4ed6\u70b9\u901a\u8fc7 \u6807\u8bb0\u5728\u67d0\u4e2a\u70b9\u5f00\u59cb\u7684\u73af\u4e2d \u7684\u65b9\u5f0f\u6765\u627e\u73af\u957f\n\t\t\tp[i]=i;//\u8fd9\u4e2a\u70b9\u5728\u4ee5\u54ea\u4e2a\u70b9\u5f00\u59cb\u7684\u73af\u4e2d\n\t\t}\n\t\tfor(R int i=1;i<=N;++i)\n\t\t{\n\t\t\tif(!f[p[i]])//\u6ce8\u610f\u8fd9\u91cc\u662ff[p[i]]\uff0c\u4e0d\u662ff[i]\n\t\t\t{\n\t\t\t\tR int tmp=A[i],step=1;\n\t\t\t\tp[i]=i;\n\t\t\t\twhile(tmp!=i)//\u4e0d\u6210\u73af\n\t\t\t\t{\n\t\t\t\t\t++step;//\u73af\u957f\u589e\u52a0\n\t\t\t\t\tp[tmp]=i;//\u6807\u8bb0\u662f\u4ee5i\u5f00\u59cb\u7684\u73af\n\t\t\t\t\ttmp=A[tmp];//\u627e\u4e0b\u4e00\u4e2a\u70b9\n\t\t\t\t}\n\t\t\t\tf[i]=step;\n\t\t\t}\n\t\t}\n\t\tfor(R int i=1;i<=N;++i)\n\t\t{\n\t\t\tprintf(\"%d \",f[p[i]]);\n\t\t}\n\t\tputs(\"\");\n\t}\n}\n```",
        "postTime": 1571823461,
        "uid": 5880,
        "name": "B_Qu1e7",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF1249B2 \u3010Books Exchange (hard version)\u3011"
    }
]