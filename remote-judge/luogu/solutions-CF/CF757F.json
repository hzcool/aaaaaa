[
    {
        "content": "\u300a\u5173\u4e8e\u6211\u968f\u673a\u5f00 CF \u7136\u540e\u5237\u5230\u652f\u914d\u6811\u6a21\u677f\u81ea\u95ed\u4e00\u4e07\u5e74\u8fd9\u4ef6\u4e8b\u300b\n\n\u90a3\u4e48\uff0c\u5982\u679c\u50cf\u6211\u4e00\u6837\uff0c\u4e0d\u4f1a\u652f\u914d\u6811~~\u4e5f\u4e0d\u60f3\u5b66~~\u600e\u4e48\u529e\u5462\uff1f\n\n---\n\n\u63d0\u4f9b\u4e00\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6 $O(n+m\\log n)$\uff08\u74f6\u9888\u5728\u6700\u77ed\u8def\uff09\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n+m)$\uff0c\u4e0d\u9700\u8981\u652f\u914d\u6811\uff08\u6211\u76f8\u4fe1\u6211\u6ca1\u6709\u81ea\u5df1\u53d1\u660e\uff09\uff0c\u66f4\u4e0d\u9700\u8981\u500d\u589e LCA \u548c LCT \u7684\u505a\u6cd5\u3002\n\n\uff08\u622a\u81f3 2021.3.21\uff0c\u8be5\u505a\u6cd5\u5728 CF \u4e0a\u662f\u6700\u4f18\u89e3\u3002\uff09~~\uff08\u867d\u7136\u53ef\u80fd\u662f\u8bc4\u6d4b\u673a\u8fdb\u5316\u4e86\uff09~~\n\n\u9996\u5148\u8fd8\u662f\u8981\u8dd1\u4e00\u904d Dijkstra\uff0c\u5efa\u51fa\u6700\u77ed\u8def DAG\u3002\n\n\u95ee\u9898\u53d8\u6210\u5220\u9664\u9664\u4e86 $s$ \u4ee5\u5916\u7684\u4e00\u4e2a\u70b9\uff0c\u4f7f\u5f97 $s$ \u65e0\u6cd5\u5230\u8fbe\u7684\u70b9\u6570\u5c3d\u53ef\u80fd\u591a\u3002\n\n\u6ce8\u610f\u6211\u4eec\u53ea\u9700\u8981\u6c42\u6700\u5927\u503c\uff0c\u6240\u4ee5\u6ca1\u6709\u5fc5\u8981\u628a\u6bcf\u4e2a\u70b9\u5220\u6389\u90fd\u6c42\u4e00\u904d\u3002\n\n\u9996\u5148\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u5165\u5ea6\u4e3a $1$ \u4e14\u5b83\u7684\u5165\u70b9\u4e0d\u662f $s$\uff0c\u90a3\u4e48\u5220\u5b83\u80af\u5b9a\u4e0d\u5982\u5220\u5b83\u7684\u5165\u70b9\u4f18\u3002\u56e0\u4e3a\u5220\u6389\u5b83\u7684\u5165\u70b9\u540e\uff0c\u5b83\u4e5f\u65e0\u6cd5\u88ab\u5230\u8fbe\u3002\u4e5f\u5c31\u662f\u8bf4\u4e00\u6761\u201c\u94fe\u201d\u53ef\u4ee5\u88ab\u7f29\u6210\u4e00\u4e2a\u70b9\u3002\n\n\u90a3\u4e48\u505a\u4e00\u904d\u62d3\u6251\u6392\u5e8f\uff0c\u6bcf\u6b21\u770b\u6240\u6709\u5165\u8fb9\u7684\u5165\u70b9\u662f\u5426\u88ab\u7f29\u6210\u4e86\u540c\u4e00\u4e2a\u70b9\u3002\u5982\u679c\u662f\uff0c\u90a3\u4e48\u5c06\u5f53\u524d\u70b9\u4e5f\u7f29\u8fdb\u53bb\u3002\n\n\u7f29\u5b8c\u4e4b\u540e\uff0c\u6bcf\u4e2a\u70b9\u8981\u4e48\u5165\u5ea6 $\\ge 2$\uff0c\u8981\u4e48\u5165\u70b9\u662f $s$\uff0c\u8981\u4e48\u81ea\u5df1\u5c31\u662f $s$\u3002\u90a3\u4e48\u65e0\u8bba\u5220\u6389\u54ea\u4e2a\u5f02\u4e8e $s$ \u7684\u70b9\uff0c\u5176\u5b83\u70b9\u90fd\u80fd\u4ece $s$ \u5230\u8fbe\u3002\u4e0d\u80fd\u5230\u8fbe\u7684\u53ea\u6709\u5f53\u524d\u70b9\u4ee5\u53ca\u548c\u5b83\u7f29\u5728\u4e00\u8d77\u7684\u70b9\u3002\n\n\u5bf9\u6bcf\u4e2a\u7f29\u5728\u4e00\u8d77\u7684\u70b9\u96c6\u6c42\u5927\u5c0f\u6700\u5927\u503c\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int> PII;\nconst int maxn=666666,mod=998244353;\n#define PB push_back\n#define MP make_pair\n#define lson o<<1,l,mid\n#define rson o<<1|1,mid+1,r\n#define FOR(i,a,b) for(int i=(a);i<=(b);i++)\n#define ROF(i,a,b) for(int i=(a);i>=(b);i--)\n#define MEM(x,v) memset(x,v,sizeof(x))\ninline int read(){\n    int x=0,f=0;char ch=getchar();\n    while(ch<'0' || ch>'9') f|=ch=='-',ch=getchar();\n    while(ch>='0' && ch<='9') x=x*10+ch-'0',ch=getchar();\n    return f?-x:x;\n}\nint n,m,s,el,head[maxn],to[maxn],nxt[maxn],w[maxn];\nint el2,head2[maxn],to2[maxn],nxt2[maxn],deg[maxn];\nint q[maxn],h,r,id[maxn],sz[maxn],ans,tmp[maxn];\nll dis[maxn];\nstruct node{\n\tll d;\n\tint u;\n\tbool operator<(const node &nd)const{return d>nd.d;}\n};\npriority_queue<node> pq; \ninline void add(int u,int v,int ww){\n\tto[++el]=v;nxt[el]=head[u];head[u]=el;w[el]=ww;\n}\ninline void add2(int u,int v){\n\tto2[++el2]=v;nxt2[el2]=head2[u];head2[u]=el2;deg[v]++;\n}\nint main(){\n\tn=read();m=read();s=read();\n\tFOR(i,1,m){\n\t\tint u=read(),v=read(),w=read();\n\t\tadd(u,v,w);add(v,u,w);\n\t}\n\tFOR(i,1,n) dis[i]=1e18;\n\tpq.push((node){dis[s]=0,s});\n\twhile(!pq.empty()){\n\t\tint u=pq.top().u;\n\t\tll d=pq.top().d;\n\t\tpq.pop();\n\t\tif(dis[u]!=d) continue;\n\t\tfor(int i=head[u];i;i=nxt[i]){\n\t\t\tint v=to[i];\n\t\t\tif(d+w[i]<dis[v]) pq.push((node){dis[v]=d+w[i],v});\n\t\t}\n\t}\n\tFOR(u,1,n) for(int i=head[u];i;i=nxt[i]){\n\t\tint v=to[i];\n\t\tif(dis[u]+w[i]==dis[v]) add2(u,v);\n\t}\n\tq[h=r=1]=s;\n\tFOR(i,1,n) tmp[i]=i;\n\twhile(h<=r){\n\t\tint u=q[h++];\n\t\tif(tmp[u]!=-1 && tmp[u]!=s) id[u]=tmp[u];\n\t\telse id[u]=u;\n\t\tsz[id[u]]++;\n\t\tfor(int i=head2[u];i;i=nxt2[i]){\n\t\t\tint v=to2[i];\n\t\t\tif(tmp[v]==v) tmp[v]=id[u];\n\t\t\telse if(tmp[v]!=id[u]) tmp[v]=-1;\n\t\t\tif(!--deg[v]) q[++r]=v;\n\t\t}\n\t}\n\tFOR(i,1,n) if(i!=s) ans=max(ans,sz[i]);\n\tprintf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1616290333,
        "uid": 72118,
        "name": "AThousandSuns",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\n\n1.\u6700\u77ed\u8def\n\n2.\u652f\u914d\u6811\n\n\u652f\u914d\u6811\u4e0d\u4f1a\u53ef\u4ee5\u70b9[\u6211](https://www.luogu.com.cn/blog/chenzidaCZD-648/zhi-pei-shu)\n\n\u601d\u8def\u89e3\u6790\uff1a\n\n\u7531\u4e8e\u662f\u5f71\u54cd\uff0c\u6240\u4ee5\u5f88\u81ea\u7136\u7684\u80fd\u60f3\u5230\u652f\u914d\u6811\uff0c\u5982\u679c\u6211\u4eec\u628a\u5f71\u54cd\u7684\u70b9\u627e\u5230\uff0c\u90a3\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u6211\u4eec\u8003\u8651\u8fdb\u884c\u4e00\u6b21 $dijkstra$\uff0c\u5c06\u6bcf\u4e00\u4e2a\u70b9\u5230 $s$ \u7684\u6700\u77ed\u8def\u90fd\u6c42\u51fa\u6765\u3002\n\n\u90a3\u4e48\u76f4\u63a5\u9650\u5236 $v$ \u7684\u70b9\u6709\u54ea\u4e9b\u5462\uff1f\u90a3\u5c31\u662f\u90a3\u4e9b\u70b9 $u$ \u6ee1\u8db3 $dis_u+val_{u-v}=dis_v$\u3002\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $x$\uff0c\u5982\u679c\u6240\u6709\u9650\u5236\u5b83\u7684\u70b9 $y$ \u90fd\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u7684\u4f7f $dis_y$ \u51fa\u73b0\u4e86\u6539\u53d8\uff0c\u90a3\u4e48 $dis_x$ \u4e00\u5b9a\u88ab\u6539\u53d8\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u4e00\u904d\u6700\u77ed\u8def\u6c42\u51fa\u5355\u6e90\u6700\u77ed\u8def\u7136\u540e\u6839\u636e\u521a\u624d\u7684\u6761\u4ef6\u521d\u59cb\u5316\u51fa\u9650\u5236\u60c5\u51b5\uff0c\u7136\u540e\u4f7f\u7528\u652f\u914d\u6811\u5373\u53ef\u3002\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int NR=3e5+10;\nvoid Min(int& x,int y){x=min(x,y);}\nvoid Max(int& x,int y){x=max(x,y);}\nint n,m,s;\nint in[NR];\nstruct Edge\n{\n\tint to,nxt;\n}e1[NR<<2],e2[NR];\nint head1[NR],head2[NR];\nint tot1=1,tot2=1;\nvoid add1(int x,int y)\n{\n\te1[tot1].to=y;\n\te1[tot1].nxt=head1[x];\n\thead1[x]=tot1++;\n}\nvoid add2(int x,int y)\n{\n\te2[tot2].to=y;\n\te2[tot2].nxt=head2[x];\n\thead2[x]=tot2++;\n}\nint to[NR<<1],nxt[NR<<1],val[NR<<1];\nint head[NR];\nint tot=1;\nvoid add(int x,int y,int z)\n{\n\tto[tot]=y;\n\tnxt[tot]=head[x];\n\tval[tot]=z;\n\thead[x]=tot++;\n}\nstruct Nd\n{\n\tint x,d;\n\tbool operator <(const Nd& A)const\n\t{\n\t\treturn d>A.d;\n\t}\n};\nNd md(int x,int d){Nd tmp;tmp.x=x,tmp.d=d;return tmp;}\nbool vis[NR];\nint dis[NR];\nvoid dijkstra()\n{\n\tmemset(vis,0,sizeof(vis));\n\tmemset(dis,0x3f,sizeof(dis));\n\tpriority_queue<Nd>q;\n\tq.push(md(s,0)),dis[s]=0;\n\twhile(!q.empty())\n\t{\n\t\tint x=q.top().x;q.pop();\n\t\tif(vis[x])continue;vis[x]=1;\n\t\tfor(int i=head[x];i;i=nxt[i])\n\t\t{\n\t\t\tint y=to[i];\n\t\t\tif(dis[y]>dis[x]+val[i])\n\t\t\t{\n\t\t\t\tdis[y]=dis[x]+val[i];\n\t\t\t\tq.push(md(y,dis[y]));\n\t\t\t}\n\t\t}\n\t}\n}\nvoid build()\n{\n\tfor(int x=1;x<=n;x++)\n\t{\n\t\tfor(int i=head[x];i;i=nxt[i])\n\t\t{\n\t\t\tint y=to[i];\n\t\t\tif(dis[y]==dis[x]+val[i])\n\t\t\t\tadd1(x,y),in[y]++;\n\t\t}\n\t}\n}\nint lg[NR];\nint dep[NR],fa[NR];\nint f[NR][20];\nint LCA(int x,int y)\n{\n\tif(dep[x]<dep[y])swap(x,y);\n\twhile(dep[x]>dep[y])x=f[x][lg[dep[x]-dep[y]]-1];\n\tif(x==y)return x;\n\tfor(int i=lg[dep[x]];i>=0;i--)if(f[x][i]!=f[y][i])\n\t\tx=f[x][i],y=f[y][i];\n\treturn f[x][0];\n}\nint siz[NR];\nvoid dfs(int x)\n{\n\tsiz[x]=1;\n\tfor(int i=head2[x];i;i=e2[i].nxt)\n\t{\n\t\tint y=e2[i].to;\n\t\tdfs(y);siz[x]+=siz[y];\n\t}\n}\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch<='9'&&ch>='0'){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nsigned main()\n{\n//\tfreopen(\"1.in\",\"r\",stdin);\n//\tfreopen(\"1.out\",\"w\",stdout);\n\tn=read(),m=read(),s=read();\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint x=read(),y=read(),z=read();\n\t\tadd(x,y,z),add(y,x,z);\n\t}\n\tfor(int i=1;i<=n;i++)lg[i]=lg[i-1]+((1<<lg[i-1])==i);\n\tdijkstra();build();queue<int>q;memset(fa,-1,sizeof(fa));\n\tfor(int i=1;i<=n;i++)if(!in[i])q.push(i),fa[i]=0;\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();q.pop();add2(fa[x],x);\n\t\tf[x][0]=fa[x],dep[x]=dep[fa[x]]+1;\n\t\tfor(int i=1;i<=lg[dep[x]];i++)\n\t\t\tf[x][i]=f[f[x][i-1]][i-1];\n\t\tfor(int i=head1[x];i;i=e1[i].nxt)\n\t\t{\n\t\t\tint y=e1[i].to;\n\t\t\tif(fa[y]==-1)fa[y]=x;\n\t\t\telse fa[y]=LCA(fa[y],x);\n\t\t\tif(!(--in[y]))q.push(y);\n\t\t}\n\t}\n\tdfs(s);int ans=0;\n\tfor(int i=1;i<=n;i++)if(i!=s)\n\t\tMax(ans,siz[i]);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n",
        "postTime": 1609600330,
        "uid": 97136,
        "name": "chenzida",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "\u5bb9\u6613\u60f3\u5230\u5efa\u51fa\u6700\u77ed\u8def\u56fe\uff0c\u95ee\u9898\u53d8\u4e3a\u6c42\u6700\u77ed\u8def\u56fe\u4e0a\u53bb\u6389\u4e00\u4e2a\u70b9\u540e\u6709\u591a\u5c11\u4e2a\u70b9\u65e0\u6cd5\u5230\u8fbe\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\uff08[ZJOI2012]\u707e\u96be\uff09\uff0c\u76f4\u63a5\u5efa\u51fa\u652f\u914d\u6811\u5373\u53ef\u3002\n\n\u5177\u4f53\u6c42\u6cd5\u662f\u62d3\u6251\u6392\u5e8f\uff0c\u5e76\u5c06\u6bcf\u4e2a\u70b9\u7684\u7236\u8282\u70b9\u8bbe\u4e3a\u6240\u6709\u524d\u9a71\u7684 LCA \u5373\u53ef\u3002\u5b9e\u73b0\u65f6\u53ef\u4ee5\u500d\u589e LCA ~~\u4e5f\u53ef\u4ee5 LCT~~\u3002\n\n```cpp\n// ===================================\n//   author: M_sea\n//   website: http://m-sea-blog.com/\n// ===================================\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n\nint read() {\n    int X=0,w=1; char c=getchar();\n    while (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n    while (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n    return X*w;\n}\n\nconst int N=200000+10,M=600000+10;\n\nint n,m,s;\nint x[M],y[M],l[M];\nint id[M],sum[M],ans[N];\n\nstruct edge { int v,w,nxt; };\nstruct Graph {\n    edge e[M]; int head[N],ecnt;\n    Graph() { memset(head,0,sizeof(head)); ecnt=0; }\n    void addEdge(int u,int v,int w=0) {\n        e[++ecnt]=(edge){v,w,head[u]},head[u]=ecnt;\n    }\n} O,G,T;\n\nstruct node { int u; ll d; };\nbool operator <(node a,node b) { return a.d>b.d; }\nll dis[N];\nvoid dijkstra() {\n    memset(dis,0x3f,sizeof(dis));\n    priority_queue<node> Q; Q.push((node){s,0}); dis[s]=0;\n    while (!Q.empty()) {\n        int u=Q.top().u; ll d=Q.top().d; Q.pop();\n        if (d!=dis[u]) continue;\n        for (int i=O.head[u];i;i=O.e[i].nxt) {\n            int v=O.e[i].v,w=O.e[i].w;\n            if (dis[u]+w<dis[v])\n                dis[v]=dis[u]+w,Q.push((node){v,dis[v]});\n        }\n    }\n}\n\nnamespace DT {\nint deg[N],fa[N],f[18][N],dep[N],sz[N];\n\nint getlca(int u,int v) {\n    if (dep[u]<dep[v]) swap(u,v);\n    for (int i=17;~i;--i)\n        if (dep[f[i][u]]>dep[v]) u=f[i][u];\n    if (dep[u]!=dep[v]) u=f[0][u];\n    for (int i=17;~i;--i)\n        if (f[i][u]!=f[i][v]) u=f[i][u],v=f[i][v];\n    if (u!=v) u=f[0][u];\n    return u;\n}\n\nvoid dfs(int u) {\n    sz[u]=dis[u]!=dis[0];\n    for (int i=T.head[u];i;i=T.e[i].nxt)\n        dfs(T.e[i].v),sz[u]+=sz[T.e[i].v];\n}\n\nvoid build() {\n    queue<int> Q; memset(fa,-1,sizeof(fa));\n    for (int i=1;i<=n;++i)\n        if (!deg[i]) fa[i]=0,Q.push(i);\n    while (!Q.empty()) {\n        int u=Q.front(); Q.pop();\n        dep[u]=dep[fa[u]]+1,T.addEdge(fa[u],u);\n        f[0][u]=fa[u];\n        for (int i=1;i<18;++i) f[i][u]=f[i-1][f[i-1][u]];\n        for (int i=G.head[u];i;i=G.e[i].nxt) {\n            int v=G.e[i].v;\n            if (fa[v]==-1) fa[v]=u;\n            else fa[v]=getlca(fa[v],u);\n            if (!--deg[v]) Q.push(v); \n        }\n    }\n}\n} // namespace DT\n\nint main() {\n    n=read(),m=read(),s=read();\n    for (int i=1;i<=m;++i) {\n        x[i]=read(),y[i]=read(),l[i]=read();\n        O.addEdge(x[i],y[i],l[i]),O.addEdge(y[i],x[i],l[i]);\n    }\n    dijkstra();\n    for (int i=1;i<=m;++i) {\n        if (dis[x[i]]+l[i]==dis[y[i]])\n            G.addEdge(x[i],y[i]),++DT::deg[y[i]];\n        if (dis[y[i]]+l[i]==dis[x[i]])\n            G.addEdge(y[i],x[i]),++DT::deg[x[i]];\n    }\n    DT::build(); DT::dfs(0); int ans=0;\n    for (int i=1;i<=n;++i) \n        if (i!=s) ans=max(ans,DT::sz[i]);\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1587437797,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "# \u5e7f\u544a\n\n[\u849f\u84bb\u7684blog](https://www.luogu.com.cn/blog/111990/)\n\n# \u6b63\u6587\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd\u4e0d\u9700\u8981\u5b58\u50a8\u62d3\u6251\u5e8f\u7684\u505a\u6cd5\u3002\n\n\u57fa\u672c\u601d\u8def\uff1a\n\n# \u6700\u77ed\u8def\u5f84DAG+\u652f\u914d\u6811+dfs\u6c42size\n\n\u9996\u5148\uff0c\u6700\u77ed\u8def\u5f84\u4e00\u5b9a\u662f\u4e00\u4e2aDAG\uff08\u81f3\u5c11\u5728\u8fb9\u6743>0\u7684\u65f6\u5019\u6210\u7acb\uff09\n\n\u7c97\u7565\u7684\u8bc1\u660e\uff1a\u56e0\u4e3a\u5982\u679c\u5b58\u5728\u73af\uff0c\u4e14\u8fb9\u6743>0\uff0c\u90a3\u4e48\u4e00\u4e2a\u70b9\u5c31\u6709\u53ef\u80fd\u6709\u4e24\u4e2a\u957f\u5ea6\u4e0d\u4e00\u6837\u7684\u6700\u77ed\u8def\u5f84\u5230\u8fbe\u5b83\uff0c\u800c\u6700\u77ed\u8def\u5f84\u7684\u957f\u5ea6\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u4ee5\u4e0d\u6210\u7acb\u3002\u5f97\u8bc1\u3002\n\n~~\uff08\u597d\u50cf\u6709\u70b9\u4e0d\u5bf9\u3002\u3002\u3002\uff09~~\n\n\u7136\u540e\u5177\u4f53\u601d\u8def\uff1a\n\n## 1\u3001\u5148\u6765\u4e00\u4e2aspfa\uff0c\u6c42\u51fa\u6240\u6709\u70b9\u7684dis\uff0c\u7136\u540e\u5224\u65ad\u6bcf\u4e00\u6761\u8fb9\u662f\u5426\u5728\u6700\u77ed\u8def\u5f84\u4e0a\u3002\n\n```cpp\nvoid spfa()\n{\n\twhile(!q.empty())q.pop();\n\tmemset(dis,0x3f,sizeof(dis));\n\tq.push(s);dis[s]=0;vis[s]=1;\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();q.pop();vis[u]=0;\n\t\tfor(re ed *i=head[u];i;i=i->next)\n\t\t{\n\t\t\tint v=i->to;\n\t\t\tif(dis[v]>dis[u]+i->w)\n\t\t\t{\n\t\t\t\tdis[v]=dis[u]+i->w;\n\t\t\t\tif(!vis[v])q.push(v),vis[v]=1;\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid jiantu()\n{\n      for(re int u=1;u<=n;++u)\n      {\n          for(re ed *i=head[u];i;i=i->next)\n          {\n              int v=i->to;\n              if(dis[u]!=infll&&dis[v]!=infll&&dis[u]+i->w==dis[v])\n              {\n                  adde2(u,v);++rudu[v];//\u5efa\u7acb\u6700\u77ed\u8def\u5f84DAG\n              }\n          }\n      }\n}\n```\n\n\n## 2\u3001\u7136\u540e\u628a\u5728\u6700\u77ed\u8def\u5f84\u4e0a\u7684\u8fb9\u5efa\u7acbDAG\uff0c\u7136\u540e\u641e\u4e00\u4e2a\u652f\u914d\u6811\u3002\n\n\uff08\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u652f\u914d\u6811\u662f\u524d\u9762\u652f\u914d\u540e\u9762\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5efa\u7acb\u53cd\u56fe\uff09\n\n```cpp\nroot=n+1;\nfor(re int i=1;i<=n;++i)\n{\n\tif(!rudu[i]&&dis[i]!=infll)q.push(i),fa[i][0]=root;\n\telse fa[i][0]=-1;\n}\nwhile(!q.empty())\n{\n\tint u=q.front();q.pop();deep[u]=deep[fa[u][0]]+1;\n\tfor(re int i=1;(1<<i)<=deep[u];++i)fa[u][i]=fa[fa[u][i-1]][i-1];\n\tfor(re ed *i=head2[u];i;i=i->next)\n\t{\n\t\tint v=i->to;\n\t\tif(fa[v][0]==-1)fa[v][0]=u;\n\t\telse fa[v][0]=lca(fa[v][0],u);\n\t\t--rudu[v];\n\t\tif(!rudu[v])q.push(v);\n\t}\n//\tputs(\"OK\");\n}\n```\n## 3\u3001\u7136\u540e\u518d\u628a\u652f\u914d\u6811\u5efa\u56fe\uff0c\u8dd1\u4e00\u904ddfs\u6c42\u51fasize\u3002\n\n```cpp\nfor(re int i=1;i<=n;++i)if(fa[i][0]!=-1)adde(i,fa[i][0],0),adde(fa[i][0],i,0);\ninline void dfs(int x,int f)\n{\n\tsize[x]=1;int v;\n\tfor(re ed *i=head[x];i;i=i->next)\n\t{\n\t\tv=i->to;\n\t\tif(v==f)continue;\n\t\tdfs(v,x);\n\t\tsize[x]+=size[v];\n\t}\n\tif(x!=root&&x!=s)maxx=max(maxx,size[x]);\n   //\u6ce8\u610f\uff0c\u8fd9\u91cc\u8d77\u70b9\u548c\u8d85\u7ea7\u6e90\u70b9\u4e0d\u80fd\u7b97\n}\n```\n## \u6700\u540e\u6709\u4e00\u4e9b\u7ec6\u8282\uff1a\n\n1\u3001\u4e0d\u80fd\u7b97\u4e0a\u8d77\u70b9\u548c\u8d85\u7ea7\u6e90\u70b9\uff0c\u56e0\u4e3a\u8d85\u7ea7\u6e90\u70b9\u4e0d\u88ab\u4efb\u4f55\u70b9\u652f\u914d\uff0c\u4e5f\u4e0d\u652f\u914d\u4efb\u4f55\u70b9\uff0c\u8d77\u70b9\u5982\u679c\u5220\u6389\uff0c\u6700\u77ed\u8def\u5f84\u90fd\u6ca1\u4e86\uff0c\u8fd8\u8c08\u4ec0\u4e48\u6700\u77ed\u8def\u5f84\u6539\u53d8\u3002\u3002\u3002\u3002\n\n2\u3001\u500d\u589eLCA\u8981\u6ce8\u610f\u7279\u5224x\u548cy\u5728\u4e00\u6761\u94fe\u4e0a\u9762\uff0c\u5426\u5219\u4f1awa\u3002\n\n\u6700\u540e\u603b\u4ee3\u7801\uff1a\n\n# code\uff1a\n\n```cpp\n#include <queue>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n\n#define re register\n#define ll long long\n#define N 200000\n#define M 300000\n#define inf 0x3f3f3f3f\n#define infll 0x3f3f3f3f3f3f3f3fll\n\ninline int read()\n{\n\tchar ch=getchar();\n\tint x=0,f=1;\n\tfor(;ch>'9'||ch<'0';ch=getchar())if(ch=='-')f=-1;\n\tfor(;ch>='0'&&ch<='9';ch=getchar())x=(x<<1)+(x<<3)+ch-'0';\n\treturn x*f;\n}\n\nstruct ed{\n\tint to,w;\n\ted *next;\n}*edge,*head[N+10],*head2[N+10];\n\nint n,m,s,rudu[N+10],fa[N+10][40],deep[N+10];\nll dis[N+10];\nqueue<int>q;\n\ninline int lca(int x,int y)\n{\n\tif(deep[x]<deep[y])swap(x,y);\n\tint delta=deep[x]-deep[y];\n\tfor(re int i=0;(1<<i)<=delta;++i)if((1<<i)&delta)x=fa[x][i];\n\tif(x==y)return x;\n\tfor(re int i=18;i>=0;--i)\n\t{\n\t\tif(fa[x][i]!=fa[y][i])\n\t\t{\n\t\t\tx=fa[x][i];y=fa[y][i];\n\t\t}\n\t}\n\treturn fa[x][0];\n}\n\ninline void adde(int u,int v,int w)\n{\n\tedge=new ed;\n\tedge->to=v;\n\tedge->next=head[u];\n\tedge->w=w;\n\thead[u]=edge;\n}\n\ninline void adde2(int u,int v)\n{\n//\tprintf(\"u==%d v==%d\\n\",u,v);\n\tedge=new ed;\n\tedge->to=v;\n\tedge->next=head2[u];\n\thead2[u]=edge;\n}\n\nbool vis[N+10];\n\nvoid spfa()\n{\n\twhile(!q.empty())q.pop();\n\tmemset(dis,0x3f,sizeof(dis));\n\tq.push(s);dis[s]=0;vis[s]=1;\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();q.pop();vis[u]=0;\n\t\tfor(re ed *i=head[u];i;i=i->next)\n\t\t{\n\t\t\tint v=i->to;\n\t\t\tif(dis[v]>dis[u]+i->w)\n\t\t\t{\n\t\t\t\tdis[v]=dis[u]+i->w;\n\t\t\t\tif(!vis[v])q.push(v),vis[v]=1;\n\t\t\t}\n\t\t}\n\t}\n}\n\nint size[N+10],maxx,root;\n\ninline void dfs(int x,int f)\n{\n\tsize[x]=1;int v;\n\tfor(re ed *i=head[x];i;i=i->next)\n\t{\n\t\tv=i->to;\n\t\tif(v==f)continue;\n\t\tdfs(v,x);\n\t\tsize[x]+=size[v];\n\t}\n\tif(x!=root&&x!=s)maxx=max(maxx,size[x]);\n}\n\nsigned main()\n{\n\tn=read(),m=read(),s=read();\n\tint a,b,c;\n\tfor(re int i=1;i<=m;++i)\n\t{\n\t\ta=read(),b=read(),c=read();\n\t\tadde(a,b,c);adde(b,a,c);\n\t}\n\tspfa();\n//\tfor(re int i=1;i<=n;++i)printf(\"%lld \",dis[i]);puts(\"\");\n//\texit(0);\n\tfor(re int u=1;u<=n;++u)\n\t{\n\t\tfor(re ed *i=head[u];i;i=i->next)\n\t\t{\n\t\t\tint v=i->to;\n\t\t\tif(dis[u]!=infll&&dis[v]!=infll&&dis[u]+i->w==dis[v])\n\t\t\t{\n\t\t\t\tadde2(u,v);++rudu[v];\n\t\t\t}\n\t\t}\n\t}\n\tmemset(head,0,sizeof(head));\n\twhile(!q.empty())q.pop();\n\troot=n+1;\n\tfor(re int i=1;i<=n;++i)\n\t{\n\t\tif(!rudu[i]&&dis[i]!=infll)q.push(i),fa[i][0]=root;\n\t\telse fa[i][0]=-1;\n\t}\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();q.pop();deep[u]=deep[fa[u][0]]+1;\n\t\tfor(re int i=1;(1<<i)<=deep[u];++i)fa[u][i]=fa[fa[u][i-1]][i-1];\n\t\tfor(re ed *i=head2[u];i;i=i->next)\n\t\t{\n\t\t\tint v=i->to;\n\t\t\tif(fa[v][0]==-1)fa[v][0]=u;\n\t\t\telse fa[v][0]=lca(fa[v][0],u);\n\t\t\t--rudu[v];\n\t\t\tif(!rudu[v])q.push(v);\n\t\t}\n//\t\tputs(\"OK\");\n\t}\n//\tfor(re int i=1;i<=n;++i)printf(\"%d \",deep[i]);puts(\"\");\n\tfor(re int i=1;i<=n;++i)if(fa[i][0]!=-1)adde(i,fa[i][0],0),adde(fa[i][0],i,0);\n\tdfs(root,0);\n\tprintf(\"%d\\n\",maxx);\n\treturn 0;\n}\n```\n",
        "postTime": 1569814493,
        "uid": 111990,
        "name": "\u849f\u84bb\u521d\u97f3\u30df\u30af",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2alct\u5efa\u6811\n\ndijktra\u8dd1\u6700\u77ed\u8def\uff0c\u5efa\u6700\u77ed\u8def\u6811(dag)\uff0c\u7136\u540e\u8dd1\u652f\u914d\u6811\uff0c\u83b7\u53d6\u6700\u5927\u7684\u9664s\u7684\u5b50\u6811\u5927\u5c0f\n\n\u5efa\u6811\u8fc7\u7a0b\u9700\u8981\u652f\u6301\u8fde\u63a5\u4e00\u4e2a\u53f6\u5b50\uff0c\u627elca\uff0c\u6700\u540e\u8fd8\u8981\u83b7\u53d6\u5b50\u6811\uff0c\u500d\u589e\u4ec0\u4e48\u7684\u6ca1\u610f\u601d\uff0c\u5f53\u7136\u9009\u62e9\u5927\u529blct\n\n[\u52a8\u6001lca](https://www.luogu.org/problem/SP8791)\u8fd9\u91cc\u5b66\n\n\u7136\u540elct\u7ef4\u62a4\u5b50\u6811\u5927\u5c0f\uff0c\u5f00\u4e2a$imagsize$\u8868\u793a\u865a\u5b50\u6811\u5927\u5c0f\uff0caccess\u8fdb\u884c\u4e86\u865a\u5b9e\u94fe\u5207\u6362\uff0c\u539f\u6765\u7684\u513f\u5b50\u53d8\u865a\u52a0\u4e0a\uff0c\u65b0\u513f\u5b50\u53d8\u5b9e\u51cf\u6389\n\n```cpp\n#include<queue>\n#include<cstdio>\n#include<vector>\n#include<cstring>\nusing namespace std;\ntypedef long long ll;\ntypedef vector<int>vit;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef vector<pii>vpii;\ntypedef priority_queue<pli,vector<pli>,greater<pli> >heap;\ntemplate<class type>inline const void read(type &in)\n{\n\tin=0;char ch=getchar();\n\twhile (ch<48||ch>57)ch=getchar();\n\twhile (ch>47&&ch<58)in=(in<<3)+(in<<1)+(ch&15),ch=getchar();\n}\nconst ll inf=0x7f7f7f7f7f7f7f7f;\nconst int N=2e5+10;\nint n,m,s,ans;\nvpii g[N];\nll dis[N];\nbool vis[N];\nint ind[N];\nvit in[N],out[N];\ninline const void addedge(int u,int v)\n{\n\tin[v].push_back(u);ind[v]++;\n\tout[u].push_back(v);\n}\ninline const void dijkstra(int s)\n{\n\tmemset(dis,0x7f,sizeof(dis));\n\theap q;q.push(make_pair(dis[s]=0,s));\n\twhile (!q.empty())\n\t{\n\t\tint u=q.top().second,v;q.pop();\n\t\tif (vis[u])continue;vis[u]=1;\n\t\tfor (vpii::iterator i=g[u].begin();i!=g[u].end();i++)\n\t\t\tif (dis[v=i->first]>dis[u]+i->second)\n\t\t\t\tq.push(make_pair(dis[v]=dis[u]+i->second,v));\n\t}\n}\ninline const void build()\n{\n\tfor (int i=1;i<=n;i++)\n\t\tfor (vpii::iterator j=g[i].begin();j!=g[i].end();j++)\n\t\t\tif (dis[j->first]^inf&&dis[j->first]==dis[i]+j->second)\n\t\t\t\taddedge(i,j->first);\n}\nclass Link_Cut_Tree\n{\n\tprivate:\n\t\tstruct tree\n\t\t{\n\t\t\tint fa,son[2],size,imagsize;\n\t\t}t[N];\n\t\tinline const bool identity(int p)\n\t\t{\n\t\t\treturn t[t[p].fa].son[1]==p;\n\t\t}\n\t\tinline const bool nroot(int p)\n\t\t{\n\t\t\treturn t[t[p].fa].son[0]==p||identity(p);\n\t\t}\n\t\tinline const void pushup(int p)\n\t\t{\n\t\t\tt[p].size=t[t[p].son[0]].size+t[t[p].son[1]].size+t[p].imagsize+1;\n\t\t}\n\t\tinline const void rotate(int p)\n\t\t{\n\t\t\tconst bool f=identity(p);\n\t\t\tint fa=t[p].fa,gfa=t[fa].fa,q=t[p].son[f^1];\n\t\t\tif (nroot(fa))t[gfa].son[identity(fa)]=p;\n\t\t\tt[t[p].son[f^1]=fa].son[f]=q;\n\t\t\tt[t[t[q].fa=fa].fa=p].fa=gfa;\n\t\t\tpushup(fa);\n\t\t}\n\t\tinline const void splay(int p)\n\t\t{\n\t\t\tfor (int fa;nroot(p);rotate(p))\n\t\t\t\tif (nroot(fa=t[p].fa))\n\t\t\t\t\trotate(identity(p)^identity(fa)?p:fa);\n\t\t\tpushup(p);\n\t\t}\n\t\tinline const int access(int x)\n\t\t{\n\t\t\tint y=0;\n\t\t\tfor (;x;x=t[y=x].fa)\n\t\t\t\tsplay(x),\n\t\t\t\tt[x].imagsize+=t[t[x].son[1]].size,\n\t\t\t\tt[x].imagsize-=t[t[x].son[1]=y].size,\n\t\t\t\tpushup(x);\n\t\t\treturn y;\n\t\t}\n\t\tinline const int findroot(int x)\n\t\t{\n\t\t\taccess(x);splay(x);\n\t\t\twhile (t[x].son[0])x=t[x].son[0];\n\t\t\tsplay(x);return x;\n\t\t}\n\tpublic:\n\t\tinline const void link(int x,int y)\n\t\t{\n\t\t\tsplay(x);\n\t\t\tt[x].fa=y;\n\t\t\taccess(y);splay(y);\n\t\t\tt[y].son[1]=x;pushup(y);\n\t\t}\n\t\tinline const int lca(int x,int y)\n\t\t{\n\t\t\tif (findroot(x)^findroot(y))return 0;\n\t\t\taccess(x);return access(y);\n\t\t}\n\t\tinline const int getsize(int x)\n\t\t{\n\t\t\taccess(x);splay(x);return t[x].imagsize+1;\n\t\t}\n}lct;\ninline const void toposort(int s)\n{\n\tqueue<int>q;q.push(s);\n\twhile (!q.empty())\n\t{\n\t\tint u=q.front(),lca=-1;q.pop();\n\t\tfor (vit::iterator i=out[u].begin();i!=out[u].end();i++)\n\t\t\tif (!--ind[*i])q.push(*i);\n\t\tfor (vit::iterator i=in[u].begin();lca&&i!=in[u].end();i++)\n\t\t\t\tif (~lca)lca=lct.lca(lca,*i);\n\t\t\t\telse lca=*i;\n\t\tif (~lca&&lca)lct.link(u,lca);\n\t}\n}\nint main()\n{\n\tread(n);read(m);read(s);\n\tfor (int u,v,w;m--;)\n\t\tread(u),read(v),read(w),\n\t\tg[u].push_back(make_pair(v,w)),\n\t\tg[v].push_back(make_pair(u,w));\n\tdijkstra(s);build();toposort(s);\n\tfor (int i=1;i<=n;i++)if (i^s&&dis[i]^inf)ans=max(ans,lct.getsize(i));\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1572933685,
        "uid": 14374,
        "name": "zhengrunzhe",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "#### \u9898\u76ee\u5927\u610f\n\n- \u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9\uff0c$m$ \u6761\u8fb9\u7684\u5e26\u6743\u65e0\u5411\u56fe\uff0c\u548c\u8d77\u70b9 $s$\u3002\n- \u9009\u62e9\u4e00\u4e2a\u70b9 $u$\uff08$u \\neq S$\uff09\uff0c\u4f7f\u5728\u56fe\u4e2d\u5220\u6389\u70b9 $u$ \u540e\uff0c\u6709\u5c3d\u53ef\u80fd\u591a\u7684\u70b9\u5230 $s$ \u7684\u6700\u77ed\u8ddd\u79bb\u6539\u53d8\u3002\n- $1 \\leq n \\leq 2 \\times 10^5$,$1 \\leq m \\leq 3 \\times 10^5$\uff0c\u7ed9\u51fa\u7684\u56fe\u65e0\u91cd\u8fb9\u65e0\u81ea\u73af\uff0c**\u4e0d**\u4fdd\u8bc1\u8fde\u901a\u3002\n\n\u5206\u6790\uff1a\n\n\u7b2c\u4e00\u53cd\u5e94\u662f\u8fd9\u6837\u5b50\u7684\uff1a\u66b4\u529b\u5220\u70b9+$dijkstra$\uff0c\u53ef\u4ee5\u505a\u5230$O(N^2logM)$\u7684\u590d\u6742\u5ea6\u3002\n\n\u6b63\u89e3\u662f\u652f\u914d\u6811\u3002\n\n\u8003\u8651\u5efa\u51fa\u6700\u77ed\u8def\u56fe\uff0c\u8fd9\u5f20\u56fe\u4e0a\u4efb\u610f\u4e00\u6761\u8fb9$(u,v,w)$\u90fd\u6ee1\u8db3$dis_u+w=dis_v$\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u5728\u4e8e\uff0c\u53ef\u4ee5\u7528\u8fd9\u5e45\u56fe\u8868\u793a\u8fd9\u4e9b\u70b9\u4e4b\u95f4\u6700\u77ed\u8def\u7684\u5f71\u50cf\u5173\u7cfb\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u6240\u6709\u7684\u5165\u70b9\u6700\u77ed\u8def\u5168\u6539\u53d8\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u7684\u6700\u77ed\u8def\u80af\u5b9a\u4e5f\u88ab\u6539\u53d8\u4e86\u3002\n\n\u8fd9\u5e45\u56fe\u53e6\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u6027\u8d28\u5728\u4e8e\u8fd9\u662f\u4e00\u4e2aDAG\uff0c\u7b80\u5355\u8bc1\u660e\u4e00\u4e0b\uff1a\u5982\u679c\u4e0d\u662f\u4e00\u4e2aDAG\u90a3\u4e48\u5fc5\u7136\u5b58\u5728$n,n\\geq3$\u4e2a\u70b9\u6784\u6210\u7684\u73af\uff0c\u90a3\u4e48\u8fd9\u663e\u7136\u662f\u4e0d\u6ee1\u8db3\u4e09\u89d2\u5f62\u4e0d\u7b49\u5f0f\u7684\u3002\u800cDAG\u4e0a\u5efa\u652f\u914d\u6811\u53ea\u9700\u8981\u62d3\u6251\u6392\u5e8f+LCA\u5373\u53ef\u3002\n\n\u5efa\u597d\u652f\u914d\u6811\u540e$dfs$\u4e00\u904d\u67e5\u8be2\u6bcf\u4e2a\u70b9\u652f\u914d\u7684\u70b9\u7684\u4e2a\u6570\u5373\u53ef\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<queue>\n#define N 1000005\nusing namespace std;\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nint n,m,s,v[N],w[N],head[N],nxt[N],cnt,dist[N],vis[N],fa[N][25],f[N],dep[N],siz[N],de[N];\nint v1[N],head1[N],nxt1[N],cnt1;\nint v2[N],head2[N],nxt2[N],cnt2;\nvoid add(int a,int b,int c)\n{\n\tv[++cnt]=b;\n\tw[cnt]=c;\n\tnxt[cnt]=head[a];\n\thead[a]=cnt;\n}\nvoid add1(int a,int b)\n{\n\tv1[++cnt1]=b;\n\tnxt1[cnt1]=head1[a];\n\thead1[a]=cnt1;\n}\nvoid add2(int a,int b)\n{\n\tv2[++cnt2]=b;\n\tnxt2[cnt2]=head2[a];\n\thead2[a]=cnt2;\n}\nvoid dij()\n{\n\tpriority_queue<pair<int,int>,vector<pair<int,int> >,greater<pair<int,int> > >q;\n\tmemset(dist,0x3f,sizeof(dist));\n\tq.push(make_pair(0,s));\n\tdist[s]=0;\n\twhile(!q.empty())\n\t{\n\t\tint c=q.top().second;\n\t\tq.pop();\n\t\tif(vis[c])continue;\n\t\tvis[c]=1;\n\t\tfor(int i=head[c];i;i=nxt[i])\n\t\t{\n\t\t\tif(dist[v[i]]>dist[c]+w[i])\n\t\t\t{\n\t\t\t\tdist[v[i]]=dist[c]+w[i];\n\t\t\t\tq.push(make_pair(dist[v[i]],v[i]));\n\t\t\t}\n\t\t}\n\t}\n}\nint lca(int x,int y)\n{\n\tif(dep[x]<dep[y])swap(x,y);\n\tfor(int i=20;i>=0;i--)\n\t{\n\t\tif(dep[fa[x][i]]>=dep[y])x=fa[x][i];\n\t}\n\tif(x==y)return x;\n\tfor(int i=20;i>=0;i--)\n\t{\n\t\tif(fa[x][i]!=fa[y][i])x=fa[x][i],y=fa[y][i];\n\t}\n\treturn fa[x][0];\n}\nvoid dfs(int x)\n{\n\tsiz[x]=1;\n\tfor(int i=head2[x];i;i=nxt2[i])\n\t{\n\t\tdfs(v2[i]);\n\t\tsiz[x]+=siz[v2[i]];\n\t}\n}\nint main()\n{\n\tn=read();m=read();s=read();\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint x=read(),y=read(),z=read();\n\t\tadd(x,y,z);add(y,x,z);\n\t}\n\tdij();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=head[i];j;j=nxt[j])\n\t\t{\n\t\t\tif(dist[v[j]]==dist[i]+w[j])\n\t\t\t{\n\t\t\t\tadd1(i,v[j]);\n\t\t\t\tde[v[j]]++;\n\t\t\t}\n\t\t}\n\t}\n\tmemset(f,-1,sizeof(f));\n\tqueue<int>q;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(!de[i])q.push(i),f[i]=0;\n\t}\n\twhile(!q.empty())\n\t{\n\t\tint c=q.front();\n\t\tq.pop();\n\t\tadd2(f[c],c);\n\t\tdep[c]=dep[f[c]]+1;fa[c][0]=f[c];\n\t\tfor(int i=0;i<=19;i++)fa[c][i+1]=fa[fa[c][i]][i];\n\t\tfor(int i=head1[c];i;i=nxt1[i])\n\t\t{\n\t\t\tif(f[v1[i]]==-1)f[v1[i]]=c;\n\t\t\telse f[v1[i]]=lca(f[v1[i]],c);\n\t\t\t--de[v1[i]];\n\t\t\tif(!de[v1[i]])q.push(v1[i]);\n\t\t}\n\t}\n\tdfs(0);\n\tint ans=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(i!=s)\n\t\t{\n\t\t\tans=max(ans,siz[i]);\n\t\t}\n\t}\n\tcout<<ans<<endl;\n}\n```\n\n",
        "postTime": 1609832901,
        "uid": 179600,
        "name": "shao0320",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "\u706d\u7edd\u6811\u3002\u4ece $\\text{S}$ \u8dd1\u6700\u77ed\u8def\uff0c\u7136\u540e\u5c31\u7528\u53ef\u4ee5\u6240\u6709\u5728\u6700\u77ed\u8def\u4e0a\u7684\u8fb9\u5efa\u51fa\u4e00\u4e2a\u6700\u77ed\u8def\u201c\u6811\u201d\u3002\u8bf4\u662f\u6811\uff0c\u5176\u5b9e\u5b83\u4e5f\u6709\u53ef\u80fd\u662f\u4e00\u4e2a $\\text{DAG}$\uff0c\u663e\u7136\uff0c\u8fd9\u5f20\u56fe\u4e0a\u5220\u53bb\u67d0\u4e9b\u70b9\u5c31\u4f1a\u5bf9\u4ece $\\text{S}$ \u5230\u67d0\u4e9b\u70b9\u7684\u6700\u77ed\u8def\u4ea7\u751f\u5f71\u54cd\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u5220\u53bb\u540e\u4ea7\u751f\u5f71\u54cd\u6700\u591a\u7684\u90a3\u4e2a\u70b9\uff0c\u663e\u7136\uff0c\u8fd9\u4e2a\u70b9\u5f71\u54cd\u7684\u70b9\u6570\u5c31\u662f\u5b83**\u652f\u914d**\u7684\u70b9\u6570\uff0c\u4e8e\u662f\u6211\u4eec\u5728\u65b0\u7684\u8fd9\u4e2a $\\text{DAG}$ \u4e0a\u8dd1\u652f\u914d\u6811\u5373\u53ef\u3002\u7531\u4e8e\u8fd9\u662f\u4e00\u4e2a $\\text{DAG}$\uff0c\u6240\u4ee5\u7528 [`P2597 [ZJOI2012]\u707e\u96be`](https://www.luogu.org/blog/Venus/solution-p2597) \u7684\u505a\u6cd5\uff0c\u62d3\u6251\u6392\u5e8f+$\\text{LCA}$ \u6c42\u706d\u7edd\u6811\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define MAXN 200005\n#define MAXM 300005\nusing namespace std;\nstruct Node\n{\n\tint u;\n\tll dis;\n\tbool operator < (const Node &x) const\n\t{\n\t\treturn x.dis<dis;\n\t}\n};\npriority_queue <Node> q;\nqueue <int> que;\nint cnt[2],fst[2][MAXN],nxt[2][MAXM<<1],to[2][MAXM<<1],w[MAXM<<1];\nint n,m,S,fr[MAXM],tx[MAXM],cot[MAXM],top[MAXN],ind[MAXN],f[MAXN][25],dep[MAXN],siz[MAXN];\nll dis[MAXN];\nbool vis[MAXN];\nvoid AddEdge(int u,int v,int c,int id)\n{\n\tto[id][++cnt[id]]=v;\n\tnxt[id][cnt[id]]=fst[id][u];\n\tfst[id][u]=cnt[id];\n\tw[cnt[id]]=c;\n}\nvoid Dijkstra(int x)\n{\n\tmemset(dis,30,sizeof(dis));\n\tdis[x]=0;\n\tq.push((Node){x,0});\n\twhile(!q.empty())\n\t{\n\t\tNode now=q.top();\n\t\tq.pop();\n\t\tint u=now.u;\n\t\tll d=now.dis;\n\t\tif(d!=dis[u]) continue;\n\t\tfor(int i=fst[0][u];i;i=nxt[0][i])\n\t\t{\n\t\t\tint v=to[0][i];\n\t\t\tif(dis[v]>dis[u]+w[i])\n\t\t\t{\n\t\t\t\tdis[v]=dis[u]+w[i];\n\t\t\t\tq.push((Node){v,dis[v]});\n\t\t\t}\n\t\t}\n\t}\n}\nvoid TopoSort()\n{\n\tque.push(S);\n\tint tot=0;\n\twhile(!que.empty())\n\t{\n\t\tint u=que.front();\n\t\tque.pop();\n\t\ttop[++tot]=u;\n\t\tfor(int i=fst[0][u];i;i=nxt[0][i])\n\t\t{\n\t\t\tint v=to[0][i];\n\t\t\tind[v]--;\n\t\t\tif(!ind[v]) que.push(v);\n\t\t}\n\t}\n\tn=tot;\n}\nint LCA(int x,int y)\n{\n\tif(dep[x]>dep[y]) swap(x,y);\n\tfor(int i=20;i>=0;i--) if(dep[f[y][i]]>=dep[x]) y=f[y][i];\n\tif(x==y) return x;\n\tfor(int i=20;i>=0;i--)\n\t{\n\t\tif(f[x][i]!=f[y][i])\n\t\t{\n\t\t\tx=f[x][i];\n\t\t\ty=f[y][i];\n\t\t}\n\t}\n\treturn f[x][0];\n}\nint main()\n{\n\tscanf(\"%d %d %d\",&n,&m,&S);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint x,y,z;\n\t\tscanf(\"%d %d %d\",&x,&y,&z);\n\t\tAddEdge(x,y,z,0);\n\t\tAddEdge(y,x,z,0);\n\t\tfr[i]=x;\n\t\ttx[i]=y;\n\t\tcot[i]=z;\n\t}\n\tDijkstra(S);\n\tcnt[0]=0;\n\tmemset(fst[0],0,sizeof(fst[0]));\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tif(dis[fr[i]]>dis[tx[i]]) swap(fr[i],tx[i]);\n\t\tif(dis[fr[i]]+cot[i]==dis[tx[i]])\n\t\t{\n\t\t\tAddEdge(fr[i],tx[i],cot[i],0);\n\t\t\tAddEdge(tx[i],fr[i],cot[i],1);\n\t\t\tind[tx[i]]++;\n\t\t}\n\t}\n\tTopoSort();\n\tfor(int i=20;i>=0;i--) f[S][i]=S;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint lca=to[1][fst[1][top[i]]];\n\t\tfor(int j=fst[1][top[i]];j;j=nxt[1][j])\n\t\t{\n\t\t\tint v=to[1][j];\n\t\t\tlca=LCA(lca,v);\n\t\t}\n\t\tf[top[i]][0]=lca;\n\t\tdep[top[i]]=dep[lca]+1;\n\t\tfor(int j=1;j<=20;j++) f[top[i]][j]=f[f[top[i]][j-1]][j-1];\n\t}\n\tfor(int i=n;i>1;i--) siz[f[top[i]][0]]+=++siz[top[i]];\n\tint ans=0;\n\tfor(int i=2;i<=n;i++) ans=max(ans,siz[top[i]]);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1546934487,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "\u6700\u77ed\u8def\u6811+\u652f\u914d\u6811\u3002\n\n\u5148\u628a$s$\u5230\u5176\u4ed6\u70b9\u7684\u6700\u77ed\u8def\u6c42\u51fa\u6765\uff0c\u7136\u540e\u8fde\u6210\u6700\u77ed\u8def\u6811\uff08\u5176\u5b9e\u662f\u4e00\u4e2a$DAG$\uff09\uff0c$s$\u5230\u4efb\u4f55\u70b9\u7684\u6700\u77ed\u8def\u90fd\u5728\u6811\u4e0a\u3002 \n\n\u7136\u540e\u5728\u8fd9\u4e2a$DAG$\u4e0a\u5efa\u652f\u914d\u6811\uff0c\u65ad\u6389\u67d0\u4e2a\u70b9\u7684\u7b54\u6848\u5c31\u662f\u5b83\u6240\u5728$dfs$\u6811\u7684\u5b50\u6811\u4e0a\u6709\u591a\u5c11\u4e2a\u70b9\u80fd\u88ab\u5b83\u652f\u914d\uff0c\u76f4\u63a5\u7528\u652f\u914d\u94fe\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#include <vector>\n#include <queue>\n#define LL long long\n\nconst int maxn=2e5+7;\nconst int maxe=3e5+7;\nconst LL inf=1e16+7;\n\nusing namespace std;\n\nint n,m,s,x,y,cnt;\nint ls[maxn],last[maxn],idom[maxn],sdom[maxn],fa[maxn];\nint p[maxn],val[maxn],f[maxn],dfn[maxn],id[maxn];\nvector <int> dom[maxn],pre[maxn];\nint v[maxn];\nLL dis[maxn],w;\n\nstruct edge{\n    int x,y,next;\n    LL w;\n}e[maxe*2];\n\nstruct node{\n    int y,next;\n}g[maxe*2];\n\nstruct rec{\n    int x;\n    LL d;\n};\n\npriority_queue <rec> q;\n\nbool operator <(rec x,rec y)\n{\n    return x.d>y.d;\n}\n\nvoid dij()\n{\n    for (int i=1;i<=n;i++) dis[i]=inf;\n    dis[s]=0;\n    q.push((rec){s,0});\n    while (!q.empty())\n    {\n        rec u=q.top();\n        q.pop();\n        int x=u.x;\n        if (v[x]) continue;\n        v[x]=1;\n        for (int j=last[x];j>0;j=e[j].next)\n        {\n            int y=e[j].y;\n            if (dis[y]>dis[x]+e[j].w)\n            {\n                dis[y]=dis[x]+e[j].w;\n                q.push((rec){y,dis[y]});\n            }\n        }\n    }\n}\n\nvoid add(int x,int y)\n{\n    g[++cnt]=(node){y,ls[x]};\n    ls[x]=cnt;\n}\n\nvoid dfs(int x)\n{\n    dfn[x]=++cnt;\n    id[cnt]=x;\n    for (int i=ls[x];i>0;i=g[i].next)\n    {\n        int y=g[i].y;\n        pre[y].push_back(x);\n        if (!dfn[y])\n        {\n            fa[y]=x;\n            dfs(y);\n        }\n    }\n}\n\nint smin(int x,int y)\n{\n    if (dfn[x]<dfn[y]) return x;\n    return y;\n}\n\nint get(int x)\n{\n    if (p[x]==x) return x;\n    int y=get(p[x]);\n    if (dfn[sdom[val[p[x]]]]<dfn[sdom[val[x]]]) val[x]=val[p[x]];\n    p[x]=y;\n    return y;\n}\n\nvoid DMT()\n{\n    for (int i=cnt;i>0;i--)\n    {\n        int x=id[i];\n        if (!pre[x].empty())\n        {\n            for (int j=0;j<pre[x].size();j++)\n            {\n                int y=pre[x][j];\n                if (dfn[y]<dfn[x]) sdom[x]=smin(sdom[x],y);\n                else\n                {\n                    get(y);\n                    sdom[x]=smin(sdom[x],sdom[val[y]]);\n                }\n            }\n        }\n        pre[x].clear();\n        p[x]=fa[x];\n        dom[sdom[x]].push_back(x);\n        if (!dom[fa[x]].empty())\n        {\n            for (int j=0;j<dom[fa[x]].size();j++)\n            {\n                int y=dom[fa[x]][j];\n                get(y);\n                int d=val[y];\n                if (dfn[sdom[d]]>=dfn[sdom[y]]) idom[y]=sdom[y];\n                                           else idom[y]=d;\n            }\n            dom[fa[x]].clear();\n        }\n    }\n    for (int i=1;i<=cnt;i++)\n    {\n        int x=id[i];\n        if (idom[x]!=sdom[x]) idom[x]=idom[idom[x]];\n    }\n    for (int i=cnt;i>0;i--)\n    {\n        x=id[i];\n        f[idom[x]]+=f[x];\n    }\n}\n\nint main()\n{\n    scanf(\"%d%d%d\",&n,&m,&s);\t\t\n    for (int i=1;i<=m;i++)\n    {\n        scanf(\"%d%d%lld\",&x,&y,&w);\n        e[i].x=x;\n        e[i].y=y;\n        e[i].w=w;\n        e[i].next=last[x];\n        last[x]=i;\n        e[i+m].x=y;\n        e[i+m].y=x;\n        e[i+m].w=w;\n        e[i+m].next=last[y];\n        last[y]=i+m;\n    }\t\n    dij();\n    for (int i=1;i<=m*2;i++)\n    {\n        int x=e[i].x,y=e[i].y;\n        if (dis[x]+e[i].w==dis[y]) add(x,y);\n    }\t\n    cnt=0;\t\n    dfs(s);\n    for (int i=1;i<=n;i++)\n    {\n        p[i]=val[i]=sdom[i]=i;\n        f[i]=1;\n    }\t\n    DMT();\n    int ans=0;\n    for (int i=2;i<=cnt;i++)\n    {\n        int x=id[i];\n        ans=max(ans,f[x]);\n    }\n    printf(\"%d\",ans);\n}\n```",
        "postTime": 1534052617,
        "uid": 18895,
        "name": "liangzihao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "DAG \u4e0a\u7684\u652f\u914d\u6811\u7b80\u5355\u9898\u3002\u4ee5\u4e0b\u662f\u524d\u7f6e\u77e5\u8bc6\u3002\n\n### \u6700\u77ed\u8def\u56fe\n\n\u5bf9\u4e8e\u4e00\u4e2a\u5e26\u6743\u6709\u5411\u56fe\u548c\u8d77\u70b9 $s$\uff0c\u6211\u4eec\u5148\u4ece\u8d77\u70b9 $s$ \u8dd1\u4e00\u904d\u5355\u6e90\u6700\u77ed\u8def\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u6761\u6709\u5411\u8fb9 $(x,y,z)$\uff0c\u82e5 $dis_y=dis_x+z$\uff0c\u90a3\u4e48\u5c31\u5728\u65b0\u56fe\u4e0a\u4ece $x$ \u5411 $y$ \u8fde\u8fb9\u3002\u5f62\u6210\u7684\u56fe\u5c31\u662f\u6700\u77ed\u8def\u56fe\u3002\n\n\u6700\u77ed\u8def\u56fe\u7684\u7b80\u5355\u6027\u8d28\uff1a\n\n- \u4ece $s$ \u5230\u4efb\u610f\u4e00\u70b9 $u$ \u7684\u4efb\u610f\u4e00\u6761\u6700\u77ed\u8def\u7684\u6bcf\u4e00\u6761\u8fb9\u4e00\u5b9a\u5b58\u5728\u5728\u65b0\u56fe\u4e2d\u3002\u9664\u6b64\u4e4b\u5916\u7684\u5176\u4ed6\u8fb9\u4e00\u5b9a\u4e0d\u5b58\u5728\u3002\n\n- \u6700\u77ed\u8def\u56fe\u662f\u4e00\u4e2a DAG\u3002\n\n### DAG \u4e0a\u7684\u652f\u914d\u6811\n\n\u53ef\u4ee5\u6c42 DAG \u4e0a\u4efb\u610f\u4e00\u70b9 $u$ \u5220\u9664\u540e\uff0c\u8d77\u70b9 $s$ \u65e0\u6cd5\u5230\u8fbe\u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n\u5177\u4f53\u8bf7\u53c2\u8003[[ZJOI2012]\u707e\u96be](https://www.luogu.com.cn/problem/P2597)\u3002\n\n\n\n------------\n\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u53d1\u73b0\uff1a\u5220\u6389\u70b9 $u$ \u540e\u5230 $s$ \u7684\u6700\u77ed\u8ddd\u79bb\u6539\u53d8\u7684\u70b9\u7684\u6570\u91cf\uff0c\u7b49\u4ef7\u4e8e\u5728\u6700\u77ed\u8def\u56fe\u4e0a\u5220\u6389\u70b9 $u$ \u540e $s$ \u65e0\u6cd5\u5230\u8fbe\u7684\u6570\u91cf\u3002\n\n\u7136\u540e\u6211\u4eec\u76f4\u63a5\u5efa\u51fa\u6700\u77ed\u8def\u56fe\uff0c\u5728\u4e0a\u9762\u5efa\u652f\u914d\u6811\u6c42\u89e3\u5373\u53ef\u3002\u6ce8\u610f\uff0c\u5220\u9664\u7684\u4e0d\u80fd\u662f\u8d77\u70b9\u3002\n\n[\u6211\u7684\u4ee3\u7801\u5199\u5f97\u6bd4\u8f83\u9ebb\u70e6](https://www.luogu.com.cn/paste/gaez9xum)\uff0c\u4f46\u5176\u5b9e\u601d\u8def\u8fd8\u662f\u5f88\u6e05\u6670\u7684\u3002",
        "postTime": 1621862543,
        "uid": 151475,
        "name": "Little09",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF757F Team Rocket Rises Again"
    },
    {
        "content": "### \u9898\u76ee\u63cf\u8ff0\n\u7ed9\u5b9a $n$ \u4e2a\u70b9\uff0c $m$ \u6761\u8fb9\u7684\u5e26\u6743\u65e0\u5411\u56fe\uff0c\u4e00\u4e2a\u8d77\u70b9 $s$ \u3002\n\n\u5728\u5220\u6389\u4e00\u4e2a\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u5c3d\u53ef\u80fd\u591a\u7684\u70b9\u5230\u8d77\u70b9\u7684\u6700\u77ed\u8ddd\u79bb\u88ab\u6539\u53d8\uff0c\u6c42\u6700\u591a\u7684\u70b9\u6570\u3002\n\n$1\\leq n \\leq n\\cdot 10^5$ \uff0c $1\\leq m\\leq 3\\cdot 10^5$\n\n\uff08\u4fdd\u8bc1\u65e0\u91cd\u8fb9\uff0c\u65e0\u81ea\u73af\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u8fde\u901a\uff09\n\n### \u524d\u7f6e\u829d\u58eb\n\u652f\u914d\u6811\uff08 DAG \uff0c\u4f46\u5176\u5b9e\u6211\u5199\u7684\u4e00\u822c\u6709\u5411\u56fe\u7248\uff09\n\n\u4e0d\u4f1a\u51fa\u95e8\u5de6\u62d0\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u7531\u6b64\u8fdb[\u6211\u7684\u535a\u5ba2](https://www.luogu.com.cn/blog/N-pilot-S/solution-p5180)\uff0c[\u522b\u4eba\u7684\u4e25\u683c\u8bc1\u660e](https://www.cnblogs.com/fenghaoran/p/dominator_tree.html)\u3002\n\n### solution\n\u5176\u5b9e\u8fd9\u7bc7\u9898\u89e3\u4f1a\u5f88\u77ed\uff0c\u56e0\u4e3a\u53ea\u9700\u8981\u89e3\u51b3\u7684\u662f\u6700\u77ed\u8ddd\u79bb\u88ab\u6539\u53d8 $\\Longrightarrow$ \u65e0\u6cd5\u5230\u8fbe\u7684\u8f6c\u5316\u3002\n\n\u5e94\u8be5\u4f1a\u5f88\u81ea\u7136\u7684\u60f3\u5230\u5148\u628a\u6700\u77ed\u8def\u6c42\u51fa\u6765\u3002\n\n\u600e\u4e48\u529e\u5462\n\n\u5982\u679c\u4ece\u8d77\u70b9\u5230\u67d0\u4e2a\u70b9 $u$ \u7684\u6700\u77ed\u8def\u5f84\u4e0a\u7684\u53e6\u4e00\u4e2a\u80fd\u76f4\u63a5\u5230\u8fbe $u$ \u7684\u70b9 $v$ \u88ab\u53bb\u6389\uff0c\u90a3\u4e48 $v$ \u5c31\u53ef\u80fd\u5f71\u54cd $u$ \u7684\u6700\u77ed\u8def\u5f84\u3002\uff08\u4e07\u4e00\u8fd8\u6709\u4e00\u6761\u8def\u5f84\u957f\u5ea6\u4e0e\u4e4b\u76f8\u7b49\u8fd8\u4e0d\u7ecf\u8fc7 $v$ \u5462\uff09\n\n\u6211\u4eec\u53ef\u80fd\u4f1a\u60f3\u5230\u5c06\u6240\u6709\u5bf9 $u$ \u6709\u5f71\u54cd\u7684\u70b9 $v$ \u5b58\u4e0b\u6765\uff0c\u663e\u7136\u53ea\u4f1a\u8d8a\u641e\u8d8a\u590d\u6742\u3002\uff08\u6211\u4eec\u7684\u773c\u5149\u662f\u8981\u505c\u7559\u5728\u6574\u5f20\u56fe\u4e0a\u7684\u5440\uff01\uff09\n\n\u6240\u4ee5\u53ea\u597d\u5f3a\u884c\u5efa\u8fb9\uff0c\u6682\u65f6\u5b8c\u6210\u4e86\u95ee\u9898\u7684\u8f6c\u5316\uff0c\u63a5\u4e0b\u6765\u7531\u600e\u4e48\u89e3\u51b3\u5462\uff1f\uff1f\uff1f\n\n\u53d1\u73b0\u76f4\u63a5\u8dd1\u652f\u914d\u6811**\u4e00\u4e0d\u5c0f\u5fc3**\u5c31\u80fd\u89e3\u51b3\u521a\u521a\u7684\u95ee\u9898\u3002\n\n\u827e\u739b\uff0c\u5f04\u5b83\uff01\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log_{2} n)$ \uff0c\u4f46\u4e0d\u7ba1\u95ee\u9898\u8f6c\u5316\u540e\u662f\u8dd1 DAG \u8fd8\u662f\u8dd1\u4e00\u822c\u6709\u5411\u56fe\uff0c\u901f\u5ea6\u90fd\u86ee\u5feb\u7684\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+10,M=3e5+10;\nint n,m,s,ans[N],toot,tot,Ans;\nint fsst[N],nxxt[M<<1],too[M<<1];\nll vaal[M<<1],diis[N],zz[M];\nint xx[M],yy[M];\nint fst[N][3],nxt[M+M+N],to[M+M+N];\nint dfn[N],ord[N],cnt,fth[N];\nint idom[N],semi[N],uni[N],mn[N];\nstruct mdzz\n{\n\tint id;ll dis;\n\tbool operator <(const mdzz &b) const\n\t{return dis>b.dis;}\n};\npriority_queue<mdzz> q;\ninline ll read()\n{\n\tll s=0,w=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n\treturn s*w;\n}\ninline void addd(int u,int v,ll w)\n{\n\tnxxt[++toot]=fsst[u];\n\ttoo[toot]=v,vaal[toot]=w;\n\tfsst[u]=toot;\n}\ninline void add(int u,int v,int id)\n{\n\tnxt[++tot]=fst[u][id];\n\tto[tot]=v,fst[u][id]=tot;\n}\ninline void dijkstra(int s)\n{\n\tmemset(diis,0x3f,sizeof(diis));\n\tdiis[s]=0;\n\tq.push((mdzz){s,0});\n\twhile(!q.empty())\n\t{\n\t\tmdzz id=q.top();q.pop();\n\t\tint u=id.id;\n\t\tll ds=id.dis;\n\t\tif(ds!=diis[u])continue;\n\t\tfor(int i=fsst[u];i;i=nxxt[i])\n\t\t{\n\t\t\tint v=too[i];\n\t\t\tif(diis[v]>diis[u]+vaal[i])\n\t\t\t{\n\t\t\t\tdiis[v]=diis[u]+vaal[i];\n\t\t\t\tq.push((mdzz){v,diis[v]});\n\t\t\t}\n\t\t}\n\t}\n}\ninline void Tarjan(int u)\n{\n\tord[dfn[u]=++cnt]=u;\n\tfor(int i=fst[u][0];i;i=nxt[i])\n\t{\n\t\tint v=to[i];\n\t\tif(!dfn[v])\n\t\t{\n\t\t\tfth[v]=u;\n\t\t\tTarjan(v);\n\t\t}\n\t}\n}\ninline int uni_query(int u)\n{\n\tif(u==uni[u])return u;\n\tint tmp=uni_query(uni[u]);\n\tif(dfn[semi[mn[u]]]>dfn[semi[mn[uni[u]]]])mn[u]=mn[uni[u]];\n\treturn uni[u]=tmp;\n}\ninline void Lengauer_Tarjan(int s)\n{\n\tTarjan(s);\n\tfor(int i=1;i<=n;++i)semi[i]=uni[i]=mn[i]=i;\n\tfor(int id=cnt;id>=2;--id)\n\t{\n\t\tint u=ord[id];\n\t\tfor(int i=fst[u][1];i;i=nxt[i])\n\t\t{\n\t\t\tint v=to[i];\n\t\t\tif(!dfn[v])continue;\n\t\t\tuni_query(v);\n\t\t\tif(dfn[semi[u]]>dfn[semi[mn[v]]])semi[u]=semi[mn[v]];\n\t\t}\n\t\tuni[u]=fth[u];\n\t\tadd(semi[u],u,2);\n\t\tu=fth[u];\n\t\tfor(int i=fst[u][2];i;i=nxt[i])\n\t\t{\n\t\t\tint v=to[i];\n\t\t\tuni_query(v);\n\t\t\tidom[v]=(u==semi[mn[v]]?u:mn[v]);\n\t\t}\n\t\tfst[u][2]=0;\n\t}\n\tfor(int i=2;i<=cnt;++i)\n\t{\n\t\tint u=ord[i];\n\t\tif(idom[u]^semi[u])\n\t\tidom[u]=idom[idom[u]];\n\t}\n}\nint main()\n{\n\tn=read(),m=read(),s=read();\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tint x=read(),y=read();\n\t\tll z=read();\n\t\taddd(x,y,z),addd(y,x,z);\n\t\txx[i]=x,yy[i]=y,zz[i]=z;\n\t}\n\tdijkstra(s);\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tif(diis[xx[i]]>diis[yy[i]])\n\t\t{\n\t\t\tint tt=xx[i];\n\t\t\txx[i]=yy[i],yy[i]=tt;\n\t\t}\n\t\tif(diis[xx[i]]+zz[i]==diis[yy[i]])\n\t\t{\n\t\t\tadd(xx[i],yy[i],0);\n\t\t\tadd(yy[i],xx[i],1);\n\t\t}\n\t}\n\tLengauer_Tarjan(s);\n\tfor(int i=cnt;i>=2;--i)ans[idom[ord[i]]]+=(++ans[ord[i]]);\n\t++ans[s];\n\tfor(int i=1;i<=n;++i)\n\tif(i!=s&&ans[i]>Ans)Ans=ans[i];\n\tprintf(\"%d\",Ans);\n\treturn 0;\n}\n```\n\u53ea\u6c42\u80fd\u5e2e\u52a9\u5230\u51e0\u4e2a\u4eba\u7f62\u3002\u3002",
        "postTime": 1619001870,
        "uid": 206024,
        "name": "Illusory_dimes",
        "ccfLevel": 7,
        "title": "CF757F Team Rocket Rises Again \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u770b\u5230\u7834\u574f\u6700\u77ed\u8def\uff0c\u53ef\u4ee5\u60f3\u5230\u5efa\u51fa\u6700\u77ed\u8def\u56fe\u540e\u8f6c\u5316\u4e3a\u7834\u574f\u8def\u5f84\u3002\n\n\u4e8e\u662f\u8fd9\u5c31\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u652f\u914d\u6811\u95ee\u9898\uff0c\u53ea\u8981\u5efa\u51fa\u652f\u914d\u6811\uff0c\u7136\u540e\u7b97\u51fa\u9664\u6839\u8282\u70b9\uff08\u5373 $s$ \u8282\u70b9\uff09\u5916\u6bcf\u4e2a\u8282\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u7684\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u7531\u4e8e\u6700\u77ed\u8def\u56fe\u662f DAG\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u62d3\u6251\u6392\u5e8f\u540e\u6309\u62d3\u6251\u5e8f\u5efa\u6811\uff0c\u7236\u8282\u70b9\u5c31\u662f\u5b83\u7684\u524d\u9a71\u8282\u70b9\u7684 LCA\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nstruct IO_Tp {\n    const static ll _I_Buffer_Size = 2 << 22;\n    char _I_Buffer[_I_Buffer_Size], *_I_pos = _I_Buffer;\n\n    const static ll _O_Buffer_Size = 2 << 22;\n    char _O_Buffer[_O_Buffer_Size], *_O_pos = _O_Buffer;\n\n    IO_Tp() { fread(_I_Buffer, 1, _I_Buffer_Size, stdin); }\n    ~IO_Tp() { fwrite(_O_Buffer, 1, _O_pos - _O_Buffer, stdout); }\n\n    IO_Tp &operator>>(ll &res) {\n    \tll f=1;\n        while (!isdigit(*_I_pos)&&(*_I_pos)!='-') ++_I_pos;\n        if(*_I_pos=='-')f=-1,++_I_pos;\n        res = *_I_pos++ - '0';\n        while (isdigit(*_I_pos)) res = res * 10 + (*_I_pos++ - '0');\n        res*=f;\n        return *this;\n    }\n\n    IO_Tp &operator<<(ll n) {\n    \tif(n<0)*_O_pos++='-',n=-n;\n        static char _buf[10];\n        char *_pos = _buf;\n        do\n            *_pos++ = '0' + n % 10;\n        while (n /= 10);\n        while (_pos != _buf) *_O_pos++ = *--_pos;\n        return *this;\n    }\n\n    IO_Tp &operator<<(char ch) {\n        *_O_pos++ = ch;\n        return *this;\n    }\n} IO;\n\nconst ll N=200005,INF=0x3f3f3f3f3f3f3f3f;\n//\u652f\u914d\u6811 \nll d[N],sz[N],f[N][20];\nll dis[N];\nbool vst[N];\nvector<ll>es[N],tree[N];\nvoid add(ll u,ll v){\n\ttree[u].push_back(v);\n\td[v]=d[u]+1,f[v][0]=u;\n\tfor(ll i=1;i<20;i++)f[v][i]=f[f[v][i-1]][i-1];\n}\nll LCA(ll x,ll y){\n\tif(d[x]<d[y])swap(x,y);\n\tfor(ll i=19;i>=0;i--)if(d[f[x][i]]>=d[y])x=f[x][i];\n\tif(x==y)return x;\n\tfor(ll i=19;i>=0;i--)if(f[x][i]!=f[y][i])x=f[x][i],y=f[y][i];\n\treturn f[x][0];\n}\nvoid build(ll u){\n\tif(vst[u])return;\n\tvst[u]=1;\n\tll fa=0;\n\tfor(auto x:es[u])build(x);\n\tfor(auto x:es[u])\n\t\tif(!fa)fa=x;\n\t\telse fa=LCA(fa,x);\n\tadd(fa,u);\n}\nvoid dfs(ll u){\n\tsz[u]=(dis[u]!=INF);\n\tfor(auto v:tree[u])if(v!=f[u][0])dfs(v),sz[u]+=sz[v];\n}\n\n//\u5efa\u56fe \nll n,m,s;\nstruct edge{ll t,w;edge(ll t_,ll w_){t=t_,w=w_;}};\nvector<edge>G[N];\nstruct node{ll id,d;bool operator<(const node&x)const{return d>x.d;}};\nvoid dijkstra(ll s){\n\tpriority_queue<node>q;\n\tmemset(dis,0x3f,sizeof(dis));\n\tdis[s]=0;\n\tq.push((node){s,0});\n\tfor(node cur;!q.empty();){\n\t\tcur=q.top();q.pop();\n\t\tll u=cur.id;\n\t\tif(cur.d>dis[u])continue;\n\t\tfor(auto x:G[u])\n\t\t\tif(dis[x.t]>dis[u]+x.w)\n\t\t\t\tdis[x.t]=dis[u]+x.w,q.push((node){x.t,dis[x.t]});\n\t} \n}\nint main(){\n\tIO>>n>>m>>s;\n\t//\u5efa\u56fe\n\tfor(ll i=1,u,v,w;i<=m;i++)IO>>u>>v>>w,G[u].push_back(edge(v,w)),G[v].push_back(edge(u,w)); \n\tdijkstra(s);\n\tfor(ll u=1;u<=n;u++)\n\t\tfor(auto v:G[u])\n\t\t\tif(dis[v.t]==dis[u]+v.w)\n\t\t\t\tes[v.t].push_back(u),d[v.t]++;\n\t//\u6700\u5c0f\u652f\u914d\u6811 \n\tfor(ll i=1;i<=n;i++)if(!d[i])es[i].push_back(n+1);\n\tfor(ll i=1;i<=n;i++)if(!vst[i])build(i);\n\tdfs(n+1);\n\tll ans=0;\n\tfor(ll i=1;i<=n;i++)if(i!=s)ans=max(ans,sz[i]);\n\tIO<<ans<<'\\n';\n\treturn 0;\n}\n```",
        "postTime": 1606402877,
        "uid": 121027,
        "name": "Spasmodic",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    },
    {
        "content": "\u55ef......\u6211\u662f\u505a\u4e86P2597\u6765\u7684\u3002\u6ca1\u505aP2579\u7684\u63a8\u8350\u56de\u53bb\u505a\u4e00\u4e0b\u3002\n\n\u95ee\uff1a\u8fd9\u4e2a\u9898\u4e0d\u662fDAG\u600e\u4e48\u8bf4\uff1f\n\n\u7b54\uff1a\u89c2\u5bdf\u9898\u9762\uff0c\u6709\u8fd9\u4e48\u51e0\u4e2a\u7279\u70b9\uff1a\n\t\n    1.\u8981\u6c42\u6700\u77ed\u8def\n    2.\u53ea\u6709\u6b63\u8fb9\n\n\u6240\u4ee5\u53ea\u7528\u8dd1\u4e00\u4e2a\u5355\u6e90\u6700\u77ed\u8def\uff0c\u4ee5\u6700\u77ed\u8def\u4e0a\u7684\u70b9\u641e\u51faDAG\u5c31\u884c\u4e86\n\n\u7136\u540e\u5c31\u662f\u88f8\u7684\u652f\u914d\u6811......\n\n```cpp\n#include<bits/stdc++.h>\n#define big long long\nusing namespace std;\nconst big maxn=2e5+5;\nbig N,M,S,dis[maxn],in[maxn],top[maxn],lg2[maxn]={-1},dep[maxn],fa[maxn][20],size[maxn],ans;\nvector<big>G[maxn],W[maxn],G1[maxn],G2[maxn],G3[maxn];\nvoid topsort(){\n\tbig cnt=0;\n\tqueue<big>q;\n\tfor(big i=1;i<=N;i++)\n\t\tif(!in[i]&&dis[i]!=4557430888798830399ll)\n\t\t\tq.push(i);\n\twhile(!q.empty()){\n\t\tbig u=q.front();\n\t\tq.pop();\n\t\ttop[++cnt]=u;\n\t\tfor(big i=0;i<G1[u].size();i++){\n\t\t\tbig v=G1[u][i];\n\t\t\t--in[v];\n\t\t\tif(!in[v])\n\t\t\t\tq.push(v);\n\t\t}\n\t}\n}\nbig LCA(big u,big v){\n\tif(dep[u]<dep[v])swap(u,v);\n\twhile(dep[u]>dep[v])\n\t\tu=fa[u][lg2[dep[u]-dep[v]]];\n\tif(u==v)return u;\n\tfor(big k=lg2[dep[u]];k>=0;k--)\n\t\tif(fa[u][k]!=fa[v][k])\n\t\t\tu=fa[u][k],v=fa[v][k];\n\treturn fa[u][0];\n}\nvoid dfs(big u){\n\tsize[u]=1;\n\tfor(big i=0;i<G3[u].size();i++){\n\t\tbig v=G3[u][i];\n\t\tdfs(v);\n\t\tsize[u]+=size[v];\n\t}\n\tif(u!=N+1&&u!=S)ans=max(ans,size[u]);\n}\nint main(){\n\t//freopen(\"in.txt\",\"r\",stdin);\n\tios::sync_with_stdio(false);\n\tcin>>N>>M>>S;\n\tfor(big i=1;i<=N;i++)\n\t\tlg2[i]=lg2[i>>1]+1;\n\tfor(big i=1,u,v,w;i<=M;i++){\n\t\tcin>>u>>v>>w;\n\t\tG[u].push_back(v);\n\t\tW[u].push_back(w);\n\t\tG[v].push_back(u);\n\t\tW[v].push_back(w);\n\t}//\u7b2c\u4e00\u5f20\u56fe\uff1a\u65e0\u5411\u5e26\u6743\u56fe \n\tmemset(dis,0x3f,sizeof(dis));\n\tqueue<big>q;\n\tq.push(S);\n\tdis[S]=0;\n\twhile(!q.empty()){\n\t\tbig u=q.front();\n\t\tq.pop();\n\t\tfor(big i=0;i<G[u].size();i++){\n\t\t\tbig v=G[u][i],w=W[u][i];\n\t\t\tif(dis[v]>dis[u]+w){\n\t\t\t\tdis[v]=dis[u]+w;\n\t\t\t\tq.push(v);\n\t\t\t}\n\t\t}\n\t}//\u8dd1\u4e00\u6ce2\u6700\u77ed\u8def \n\tfor(big u=1;u<=N;u++){\n\t\tfor(big i=0;i<G[u].size();i++){\n\t\t\tbig v=G[u][i],w=W[u][i];\n\t\t\tif(dis[v]==dis[u]+w){\n\t\t\t\tG1[u].push_back(v);//\u5927\u529b\u505a\u6709\u5411\u65e0\u73af\u56fe \n\t\t\t\t++in[v];\n\t\t\t\tG2[v].push_back(u);//\u5927\u529b\u505a\u53cd\u56fe \n\t\t\t}\n\t\t}\n\t}\n\ttopsort();\n\tfor(big i=1;i<=N;i++){\n\t\tif(!top[i])break;\n\t\tbig u=top[i];\n\t\tif(!G2[u].size())\n\t\t\tG2[u].push_back(N+1);\n\t\tbig x=G2[u][0];\n\t\tfor(big j=1;j<G2[u].size();j++){\n\t\t\tbig v=G2[u][j];\n\t\t\tx=LCA(x,v);\n\t\t}\n\t\tG3[x].push_back(u);\n\t\tdep[u]=dep[x]+1;\n\t\tfa[u][0]=x;\n\t\tfor(big k=1;k<=lg2[dep[u]];k++)\n\t\t\tfa[u][k]=fa[fa[u][k-1]][k-1];\n\t}\n\tdfs(N+1);\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1566913352,
        "uid": 109396,
        "name": "Uniecho1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF757F \u3010Team Rocket Rises Again\u3011"
    }
]