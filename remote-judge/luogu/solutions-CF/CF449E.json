[
    {
        "content": "[\u6211\u7684\u535a\u5ba2](https://www.cnblogs.com/Memory-of-winter/p/11209128.html)\n\n**\u9898\u76ee\u5927\u610f\uff1a** \u6709\u4e00\u4e2a$n\\times m$\u7684\u65b9\u683c\u56fe\uff0c\u6c42\u5176\u4e2d\u6240\u6709\u7684\u683c\u70b9\u6b63\u65b9\u5f62\u5b8c\u6574\u5305\u542b\u7684\u5c0f\u65b9\u683c\u4e2a\u6570\uff0c\u591a\u7ec4\u8be2\u95ee\u3002$n,m\\leqslant 10^6$\n\n**\u9898\u89e3\uff1a** \u4ee4$n\\leqslant m$\u3002\u6709\u4e00\u4e2a\u663e\u7136\u7684\u5f0f\u5b50\uff1a\n$$ans=\\sum\\limits_{i=1}^n(n-i+1)(m-i+1)f(i)$$\n$f(i)$\u8868\u793a\u53ef\u4ee5\u5b8c\u6574\u5305\u542b\u5728$i\\times i$\u7684\u6b63\u65b9\u5f62\u4e2d\u4e14\u9876\u70b9\u5728\u8fd9\u4e2a\u6b63\u65b9\u5f62\u8fb9\u4e0a\u7684\u6b63\u65b9\u5f62\u6240\u5305\u542b\u7684\u5c0f\u65b9\u683c\u603b\u6570\u3002\u53ef\u4ee5\u5206\u9009\u7684\u6b63\u65b9\u5f62\u548c$i\\times i$\u6b63\u65b9\u5f62\u91cd\u5408\u548c\u8fb9\u8f6c\u52a8$j$\u683c\u6765\u8ba1\u7b97\n$$f(n)=n^2+\\sum\\limits_{i=1}^{n-1}[(n-2\\max\\{i,n-1\\})^2+g(i,n-i)]$$\n\u5176\u4e2d$(n-2\\max\\{i,n-1\\})^2$\u662f\u8f6c\u52a8$i$\u683c\u540e\u6b63\u4e2d\u95f4\u7684\u5b8c\u6574\u5c0f\u65b9\u683c\uff0c$g(i,n-i)$\u8868\u793a\u56db\u5468\u7684$4$\u4e2a\u5c0f\u76f4\u89d2\u4e09\u89d2\u5f62\u4e2d\u5305\u542b\u7684\u5b8c\u6574\u5c0f\u65b9\u683c\u4e2a\u6570\u3002\n\n\u6bd4\u5982\u8ba1\u7b97\u5de6\u4e0a\u89d2\u7684\u76f4\u89d2\u4e09\u89d2\u5f62\uff0c\u53d1\u73b0\u5b8c\u6574\u7684\u5c0f\u65b9\u683c\u7684\u5de6\u4e0a\u89d2\u6ee1\u8db3\u5728\u76f4\u89d2\u4e09\u89d2\u5f62\u7684\u659c\u8fb9\u4e0a\u6216\u4e09\u89d2\u5f62\u5185\u3002\u4e09\u89d2\u5f62\u5185\u7684\u70b9\u53ef\u4ee5\u7528\u76ae\u514b\u5b9a\u7406\u6765\u89e3\u51b3\uff0c\u4ee4\u4e09\u89d2\u5f62\u4e24\u76f4\u89d2\u8fb9\u4e3a$n,m$\uff0c\u5219\u4e09\u89d2\u5f62\u5185\u7684\u70b9\u4e2a\u6570\u4e3a$\\dfrac{nm-n-m+2-\\gcd(n,m)}2$\uff0c\u518d\u52a0\u4e0a\u5728\u659c\u8fb9\u4e0a\u7684\u70b9\uff0c\u5219\u4e00\u4e2a\u76f4\u89d2\u4e09\u89d2\u5f62\u5185\u7684\u65b9\u683c\u6570\u4e3a$\\dfrac{nm-m-n+gcd(n,m)}2$\u3002\n\n\u628a$n=i,m=n-i$\u5e26\u5165\u5f0f\u5b50\n$$\\begin{aligned}f(n)=&n^2+\\sum\\limits_{i=1}^{n-1}[(n-2\\max\\{i,n-1\\})^2+g(i,n-i)]\\\\=&n^2+\\sum\\limits_{i=1}^{n-1}(n-2\\max\\{i,n-1\\})^2+\\sum\\limits_{i=1}^{n-1}g(i,n-i)\\\\=&n^2+\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{n-1}2\\right\\rfloor}(n-2i)^2+\\sum\\limits_{i=\\left\\lfloor\\frac{n-1}2\\right\\rfloor+1}^{n-1}(2i-n)^2\\\\&+\\sum\\limits_{i=1}^{n-1}\\dfrac{i(n-i)-(n-i)-i+\\gcd(i,n-i)}2\\\\=&n^2+2\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{n-1}2\\right\\rfloor}(n-2i)^2+\\sum\\limits_{i=1}^{n-1}\\dfrac{in-i^2-n+\\gcd(i,n)}2\\end{aligned}$$\n\u5176\u4e2d$n^2$\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\uff0c$\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{n-1}2\\right\\rfloor}(n-2i)^2$\u53ef\u4ee5\u524d\u7f00\u548c\u89e3\u51b3\uff0c\u95ee\u9898\u5728$\\sum\\limits_{i=1}^{n-1}\\dfrac{in-i^2-n+\\gcd(i,n)}2$\u90e8\u5206\u3002\u4ee4$h(n)=\\sum\\limits_{i=1}^{n-1}\\dfrac{in-i^2-n+\\gcd(i,n)}2$\uff0c$sgcd(n)=\\sum\\limits_{i=1}^{n-1}\\gcd(i,n)$\n$$h(n)=\\dfrac12[\\sum\\limits_{i=1}^{n-1}(in-i^2-n)+sgcd(n)]$$\n$$\\begin{aligned}h(n-1)&=\\dfrac12[\\sum\\limits_{i=1}^{n-2}(i(n-1)-i^2-(n-1))+sgcd(n-1)]\\\\&=\\dfrac12[\\sum\\limits_{i=1}^{n-2}(in-i^2-n-i+1)+sgcd(n-1)]\\\\\\end{aligned}$$\n\n$$\\begin{aligned}h(n)=&h(n-1)+\\dfrac12[\\sum\\limits_{i=1}^{n-2}(i-1)+(n-1)n-(n-1)^2-n\\\\&-sgcd(n-1)+sgcd(n)]\\\\=&h(n-1)+\\dfrac12[\\left(\\sum\\limits_{i=0}^{n-3}i\\right)-1-sgcd(n-1)+sgcd(n)]\\\\=&h(n-1)+\\dfrac12[\\left(\\dfrac{(n-2)(n-3)}2\\right)-1-sgcd(n-1)+sgcd(n)]\\end{aligned}$$\n\n\u5176\u4ed6\u90e8\u5206\u90fd\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\uff0c\u95ee\u9898\u5728\u6c42$sgcd(n)$\n$$\\begin{aligned}sgcd(n)&=\\sum\\limits_{i=1}^{n-1}\\gcd(i,n)\\\\&=\\left(\\sum\\limits_{d|n}\\dfrac nd\\varphi(d)\\right)-n\\end{aligned}$$\n\u5168\u90e8\u9884\u5904\u7406\u51fa\u6765\u5373\u53ef\u3002\n\n\n\n**C++ Code\uff1a**\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <iostream>\n#define mul(a, b) (static_cast<long long> (a) * (b) % mod)\nconst int mod = 1e9 + 7, maxn = 1e6 + 10, half = (mod + 1) / 2;\ninline void reduce(int &x) { x += x >> 31 & mod; }\n\nint gcd(int a, int b) {\n\tif (!b) return a;\n\treturn gcd(b, a % b);\n}\ninline int sqr(int x) { return mul(x, x); }\n\nint g[maxn], sumgcd[maxn], phi[maxn], plist[maxn / 2], ptot;\nint pre[maxn], R[maxn], T[maxn], preF[maxn];\nbool notp[maxn];\nint Q;\n\nint F(int n) {\n\tint ans = g[n];\n\treduce(ans += sqr(n) - mod);\n\treduce(ans += pre[n - 2] - mod);\n\treduce(ans += pre[n - 2] - mod);\n\treturn ans;\n}\nvoid sieve(int N) {\n\tphi[1] = 1;\n\tfor (int i = 2; i <= N; i++) {\n\t\tif (!notp[i]) phi[plist[ptot++] = i] = i - 1;\n\t\tfor (int j = 0, t; j < ptot && (t = i * plist[j]) <= N; j++) {\n\t\t\tnotp[t] = true;\n\t\t\tif (i % plist[j] == 0) {\n\t\t\t\tphi[t] = phi[i] * plist[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[t] = phi[i] * phi[plist[j]];\n\t\t}\n\t}\n\tfor (int i = 1; i <= N; ++i) {\n\t\tfor (int j = i + i; j <= N; j += i) reduce(sumgcd[j] += mul(phi[j / i], i));\n\t}\n\tfor (int i = 4; i <= N; ++i) {\n\t\tg[i] = (1ll * (i - 3) * (i - 2) / 2 - 1 - sumgcd[i - 1] + sumgcd[i]) % mod;\n\t\treduce(g[i]);\n\t\tg[i] = mul(g[i], half);\n\t\treduce(g[i] += g[i - 1] - mod);\n\t}\n\tfor (int i = 1; i <= N; ++i) g[i] = mul(g[i], 4);\n\tpre[1] = 1;\n\tfor (int i = 2; i <= N; ++i) reduce(pre[i] = pre[i - 2] + sqr(i) - mod);\n\tfor (int i = 1; i <= N; ++i) reduce(preF[i] = preF[i - 1] + F(i) - mod);\n\tfor (int i = 1; i <= N; ++i) {\n\t\treduce(R[i] = R[i - 1] + preF[i - 1] - mod);\n\t\treduce(R[i] += F(i) - mod);\n\t}\n\tfor (int i = 1; i <= N; ++i) {\n\t\treduce(T[i] = T[i - 1] + preF[i - 1] - mod);\n\t\treduce(T[i] += R[i - 1] - mod);\n\t\treduce(T[i] += R[i - 1] - mod);\n\t\treduce(T[i] += F(i) - mod);\n\t}\n}\nint solve(int n, int m) {\n\tint ans = T[n];\n\treduce(ans += mul(R[n], m - n) - mod);\n\treturn ans;\n}\n\nint main() {\n\tstd::ios::sync_with_stdio(false), std::cin.tie(0), std::cout.tie(0);\n\tsieve(1000005);\n\tstd::cin >> Q;\n\twhile (Q --> 0) {\n\t\tstatic int n, m;\n\t\tstd::cin >> n >> m;\n\t\tif (n > m) std::swap(n, m);\n\t\tstd::cout << solve(n, m) << '\\n';\n\t}\n\treturn 0;\n}\n\n```\n\n\n\n",
        "postTime": 1563506268,
        "uid": 22072,
        "name": "Memory_of_winter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF449E \u3010Jzzhu and Squares\u3011"
    },
    {
        "content": "\u5c0f\u5b66\u5965\u6570\u9898\u3002\n\n\u8bbe $f(i)$ \u8868\u793a\u56db\u4e2a\u70b9\u53ef\u4ee5\u5212\u5206\u5230\u4e00\u4e2a $i\\cdot i$ \u7684\u77e9\u5f62\u5185\u7684\u5305\u542b\u5c0f\u65b9\u683c\u7684\u603b\u4e2a\u6570\u3002\n\n\u6211\u4eec\u4ee4 $n\\leq m$ \u5219 $Ans=\\sum_{i=1}^n(n-i+1)\\cdot (m-i+1)\\cdot f(i)$ \u3002\n\n\u800c \n$$\nf(n)=n^2+\\sum_{i=1}^{n-1} (n-2\\cdot i)^2+4\\cdot g(i,n-i)\n$$\n$g(i,j)$ \u8868\u793a\u5728\u4e00\u4e2a $i,j$ \u4e3a\u5e95\u7684\u76f4\u89d2\u4e09\u89d2\u5f62\u4e2d\u5305\u542b\u7684\u5c0f\u65b9\u683c\u4e2a\u6570\u3002\n\n\u7531\u4e8e\u76ae\u514b\u5b9a\u7406\u53ef\u5f97\n$$\ng(i,j)=\\dfrac{nm-n-m+\\gcd(n,m)}{2}\n$$\n\u901a\u8fc7\u5316\u7b80\u5f0f\u5b50\u90a3\u4e48\u53ef\u4ee5\u5feb\u901f\u6c42\u5f97 $f(i)$ \u3002\n\n\u5219\u73b0\u5728\u53ea\u8981\u5feb\u901f\u6c42\n$$\n\\sum_i\\sum_j (n-i+1)\\cdot (m-i+1)\\cdot f_i\n$$\n\n\u518d\u62c6\u5f00\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$ \u3002\n```cpp\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<cstring>\n#include<vector>\n#include<queue>\n#include<algorithm>\n#include<climits>\n#define int long long\n#define mod 1000000007\n#define pii pair<int,int>\n#define pb push_back\n#define mp make_pair\n#define fi first\n#define se second\nusing namespace std;\ninline int read(){\n    int f=1,ans=0;char c=getchar();\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n    while(c>='0'&&c<='9'){ans=ans*10+c-'0';c=getchar();}\n    return f*ans;\n}\nconst int MAXN=1e6+11;\nconst int inv2=500000004;\nconst int inv6=166666668;\nconst int Lim=1e6;\nint N,M,F[MAXN],W[MAXN],v[MAXN],pri[MAXN],phi[MAXN];\nint ksm(int a,int b){int ans=1;while(b){if(b&1) ans*=a,ans%=mod;a*=a,a%=mod;b>>=1;}return ans;}\nint gcd(int a,int b){return !b?a:gcd(b,a%b);}\nint g(int a,int b){return (a*b-a-b+gcd(a,b))/2;}\nint Q1(int a){return a*(a+1)%mod*inv2%mod;}\nint Q2(int a){return a*(a+1)%mod*(2*a+1)%mod*inv6%mod;}\nvoid Init(){\n    phi[1]=1;\n    for(int i=2;i<=Lim;i++){\n        if(!v[i]){v[i]=i;pri[++pri[0]]=i;phi[i]=i-1;}\n        for(int j=1;pri[j]*i<=Lim&&j<=pri[0];j++){\n            v[pri[j]*i]=pri[j];\n            if(!(i%pri[j])){phi[i*pri[j]]=phi[i]*pri[j];break;}\n            phi[pri[j]*i]=phi[i]*(pri[j]-1);\n        }\n    }return;\n}\nint G[MAXN],S1[MAXN],S2[MAXN];\nsigned main(){\n    //freopen(\"5.in\",\"r\",stdin);\n    Init();\n    for(int i=1;i<=Lim;i++){\n        for(int j=1;i*j<=Lim;j++) W[i*j]+=phi[i]*j%mod,W[i*j]%=mod;\n        W[i]-=i,W[i]=((W[i]%mod)+mod)%mod;\n    }\n    int cas=read();\n    for(int i=1;i<=Lim;i++){\n        int res=0; res=i*i*i; res%=mod;\n        res-=2*i*Q1(i-1);res%=mod; res+=2*Q2(i-1); res%=mod;\n        res-=2*(i-1)*i; res%=mod;res+=2*W[i],res%=mod;\n        res=(res%mod+mod)%mod;\n        F[i]=res;\n    }\n    for(int i=1;i<=Lim;i++){\n        G[i]=G[i-1]+F[i]+(2*i+1)*S1[i-1]-2*S2[i-1];\n        G[i]=((G[i]%mod)+mod)%mod;\n        S1[i]=(S1[i-1]+F[i])%mod,S2[i]=(S2[i-1]+F[i]*i)%mod;\n    }\n    \n    while(cas--){\n        N=read(),M=read(); if(N>M) swap(N,M);\n        /*int Ans=0;\n        for(int i=1;i<=N;i++) Ans+=(N-i+1)*(M-i+1)%mod*F[i]%mod,Ans%=mod;*/\n        int del=M-N,Ans=G[N],res=0;\n        res=del*((N+1)*S1[N]%mod-S2[N])%mod,res=((res%mod)+mod)%mod;\n        printf(\"%lld\\n\",(Ans+res)%mod);\n    }\n}\n\n```\n",
        "postTime": 1610277744,
        "uid": 293177,
        "name": "sry_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF449E \u3010Jzzhu and Squares\u3011"
    }
]