[
    {
        "content": "\u8fd9\u9053\u9898\u8fd8\u86ee\u6709\u610f\u601d\u7684\uff0c\u6bd4\u8d5b\u6700\u540e\u51e0\u5206\u949f\u809d\u51fa\u6765\u4e86\uff0c\u5374\u56e0\u4e3a\u7206 int \u4e00\u76f4 WA 8\uff0c\u8d5b\u540e 2min \u628a\u5b83 A \u6389\u4e86\u2026\u2026\n\n\u9996\u5148\u6ce8\u610f\u5230\u56fe\u4e2d\u6bcf\u4e2a\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\u90fd $\\le m$\uff0c\u56e0\u6b64\u5f53 $k$ \u6bd4\u8f83\u5927\uff08$>m$\uff09\u7ec4\u6210\u7684\u8def\u5f84\u80af\u5b9a\u4e0d\u662f\u7b80\u5355\u8def\u5f84\uff0c\u6545\u4e0d\u96be\u731c\u51fa\u5f53 $k$ \u6bd4\u8f83\u5927\u65f6\u6700\u4f18\u65b9\u6848\u662f\u5148\u8d70\u5230\u67d0\u6761\u8fb9 $e$ \u7684\u4e00\u4e2a\u7aef\u70b9\u5904\uff0c\u7136\u540e\u5728\u8fd9\u6761\u8fb9\u4e0a\u6765\u56de\u8d70\u52a8\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6bcf\u8fc7\u4e00\u79d2\u7ecf\u8fc7\u7684\u957f\u5ea6 $\\Delta l$ \u90fd\u7b49\u4e8e\u8fd9\u6761\u8fb9\u7684\u8fb9\u6743 $w$\uff0c\u56e0\u6b64\u8fd9\u6761\u8fb9\u7ecf\u8fc7\u7684\u8def\u5f84\u957f\u5ea6\u53ef\u4ee5\u5199\u6210\u4e00\u4e2a\u4e0e\u65f6\u95f4 $t$ \u6709\u5173\u7684\u4e00\u6b21\u51fd\u6570 $y=wt+b(t\\ge t_0)$\uff0c\u5176\u4e2d $t_0$ \u4e3a\u5230\u8fbe\u8fd9\u6761\u8fb9\u7684\u65f6\u95f4\u3002\n\n\u53d7\u5230\u8fd9\u4e2a\u601d\u60f3\u7684\u542f\u53d1\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u66b4\u529b $dp$ \u6c42\u51fa\u5f53 $k\\le m$ \u65f6\u4ee5\u6bcf\u4e2a\u70b9\u7ed3\u675f\u7684\u6700\u77ed\u8def\u5f84\uff0c\u8fd9\u90e8\u5206\u7684\u8d21\u732e\u6211\u4eec\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\uff0c\u7279\u5224\u6389\u3002\u5bf9\u4e8e $k>m$ \u7684\u90e8\u5206\u6211\u4eec\u5c31\u66b4\u529b\u679a\u4e3e\u662f\u54ea\u6761\u8fb9\uff0c\u4ee5\u53ca\u5230\u8fbe\u8fd9\u6761\u8fb9\u7684\u65f6\u95f4 $t_0$\uff0c\u8fd9\u6837\u6709 $n^2$ \u6761\u76f4\u7ebf\uff08\u6216\u8005\u51c6\u786e\u6765\u8bf4\uff0c\u662f\u4e00\u6761\u5c04\u7ebf\uff09\uff0c\u6c42\u51fa\u5b83\u4eec\u7684\u51f8\u58f3\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $n^2\\log n$ \u53ef\u4ee5\u901a\u8fc7\u3002\u5f53\u7136\u8fd9\u91cc\u4e5f\u6709\u4e00\u4e2a\u975e\u5e38 trival \u7684\u4f18\u5316\uff0c\u4e0d\u96be\u53d1\u73b0\u540c\u4e00\u6761\u8fb9\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684 $t_0$\uff0c\u5b83\u4eec\u8868\u793a\u7684\u76f4\u7ebf\u7684\u659c\u7387\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u53ea\u9700\u4fdd\u7559\u622a\u8ddd\u6700\u5927\u7684\u90a3\u6761\u5373\u53ef\u3002\u8fd9\u6837\u5efa\u51f8\u5305\u7684\u65f6\u95f4\u53ef\u4ee5\u964d\u5230 $n\\log n$\uff0c\u603b\u590d\u6742\u5ea6 $nm+n\\log n$\u3002\n\n```cpp\nconst int MAXN=2e3;\nconst double EPS=1e-7;\nconst int MOD=1e9+7;\nconst int INV2=5e8+4;\nint n,m,q,dp[MAXN+5][MAXN+5];ll mx[MAXN+5];\nstruct edge{int u,v,w;} e[MAXN+5];\nvector<pii> g[MAXN+5];\nstruct line{\n\tint k,b;\n\tbool operator <(const line &rhs){\n\t\tif(k!=rhs.k) return k<rhs.k;\n\t\treturn b<rhs.b;\n\t}\n} l[MAXN+5];\ndouble inter(line a,line b){return 1.0*(a.b-b.b)/(b.k-a.k);}\nint stk[MAXN+5],tp=0;\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d%d%d\",&e[i].u,&e[i].v,&e[i].w);\n\t\tg[e[i].u].pb(mp(e[i].v,e[i].w));\n\t\tg[e[i].v].pb(mp(e[i].u,e[i].w));\n\t} memset(dp,192,sizeof(dp));dp[0][1]=0;\n\tfor(int i=0;i<m;i++) for(int j=1;j<=n;j++){\n\t\tfor(pii p:g[j]) chkmax(dp[i+1][p.fi],dp[i][j]+p.se);\n\t} int ans=0;memset(mx,192,sizeof(mx));\n\tfor(int i=1;i<=m;i++){\n\t\tint mxs=0;\n\t\tfor(int j=1;j<=n;j++) chkmax(mxs,dp[i][j]);\n\t\tans=(0ll+ans+mxs)%MOD;\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tchkmax(mx[j],dp[i][e[j].u]-1ll*e[j].w*i);\n\t\t\tchkmax(mx[j],dp[i][e[j].v]-1ll*e[j].w*i);\n\t\t}\n\t} int p=0;\n\tfor(int j=1;j<=m;j++) if(mx[j]>-0x3f3f3f3f) l[++p].k=e[j].w,l[p].b=mx[j];\n\tsort(l+1,l+p+1);\n\tfor(int i=1;i<=p;i++){\n\t\tif(l[i+1].k==l[i].k) continue;\n\t\twhile(tp>1){\n\t\t\tdouble it1=inter(l[stk[tp]],l[stk[tp-1]]);\n\t\t\tdouble it2=inter(l[stk[tp]],l[i]);\n\t\t\tif(it2>it1) break;tp--;\n\t\t} stk[++tp]=i;\n\t}\n\tfor(int i=1;i<=tp;i++){\n\t\tdouble lft=((i==1)?m:inter(l[stk[i]],l[stk[i-1]]));\n\t\tdouble rit=((i==tp)?q:inter(l[stk[i]],l[stk[i+1]]));\n\t\tint L=(int)ceil(lft+EPS),R=floor(rit);\n\t\tchkmax(L,m+1);chkmin(R,q);\n\t\tif(L>R) continue;\n//\t\tprintf(\"%d %d\\n\",L,R);\n//\t\tprintf(\"%d %d\\n\",l[stk[i]].k,l[stk[i]].b);\n\t\tint tl=(l[stk[i]].b+1ll*L*l[stk[i]].k)%MOD;\n\t\tint tr=(l[stk[i]].b+1ll*R*l[stk[i]].k)%MOD;\n\t\tans=(ans+1ll*(tl+tr)*(R-L+1)%MOD*INV2)%MOD;\n\t} printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1624625149,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF1366F Jog Around The Graph"
    }
]