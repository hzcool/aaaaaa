[
    {
        "content": "\u8bbe\u70b9 $i$ \u7684\u513f\u5b50\u4e2a\u6570\u4e3a $d_i$\uff0c\u90a3\u4e48\u663e\u7136 $\\sum d_i=n-1$\u3002\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u8fd9\u4e2a\u4e1c\u897f\uff1a\uff08\u5177\u4f53\u5c31\u770b\u522b\u7684\u9898\u89e3\u5427\uff09\n\n$$\\prod\\limits_{i=1}^n (1-d_ix)$$\n\n$\\mathcal{O}(n\\log^2n)$ \u7684\u505a\u6cd5\u5206\u6cbb NTT \u5f88 naive \u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u8fd9\u91cc\u5206\u4eab\u4e00\u4e0b zz \u7684\u4e24\u4e2a $\\mathcal{O}(n\\log n)$ \u505a\u6cd5\u3002\n\n$first:$\n\n\u8bbe\u4e00\u4e2a\u9608\u503c $B$\u3002\n\n- $d_i\\leq B$\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684 $k$\uff0c\u53ef\u4ee5 $\\mathcal{O}(n)$ \u6c42\u51fa $\\ln(1-kx)$\u3002\u90a3\u4e48\u628a $\\ln(1-d_i x)$ \u52a0\u8d77\u6765\uff0c\u7136\u540e\u518d $\\exp$ \u56de\u53bb\u3002\u8fd9\u90e8\u5206\u7684\u590d\u6742\u5ea6\u662f $\\mathcal{O}(Bn+n\\log n)$\u3002\n\n- $d_i>B$\uff1a\u7531\u4e8e $\\sum d_i=n-1$\uff0c\u6240\u4ee5\u6700\u591a\u53ea\u6709 $\\frac{n}{B}$ \u4e2a\uff0c\u76f4\u63a5\u5206\u6cbb NTT\uff0c\u8fd9\u90e8\u5206\u7684\u590d\u6742\u5ea6\u662f $\\mathcal{O}(\\frac{n}{B}\\log^2 \\frac{n}{B})$\u3002\n\n\u8bbe $B=\\log n$\uff0c\u90a3\u4e48\u603b\u590d\u6742\u5ea6\u5c31\u662f $\\mathcal{O}(n\\log n)$\u3002\n\n\u4f17\u6240\u5468\u77e5\uff0c$\\exp$ \u5f88 slow\uff0c\u6240\u4ee5\u6548\u7387\u4e0e $\\mathcal{O}(n\\log^2 n)$ \u7684\u505a\u6cd5\u65e0\u592a\u5927\u5dee\u5f02\u3002\n\n---\n\n$second:$\n\n\u5bf9\u4e8e $\\prod\\limits_{i=1}^{n} (1-d_ix)$\uff0c\u82e5 $\\sum d_i$ \u4e0e $n$ \u540c\u9636\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5c06 $d_i$ \u4ece\u5927\u5230\u5c0f\u4f9d\u6b21\u66b4\u529b\u5377\u79ef\u3002\u590d\u6742\u5ea6\u7531\u5982\u4e0b\u5f0f\u5b50\u5f97\u5230\uff1a\n$$\n\\sum_{i}\\sum_{j\\in S}\\ [j\\ge i]=\\sum_{j\\in S}j=O(n)\n$$\n\u518d\u5e26\u4e0a NTT \u5e26\u7684 $\\log$\uff0c\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n\\log n)$\u3002\n\n[**zz \u306e code**](https://codeforces.ml/contest/1613/submission/137738311)\n\n---\n\n",
        "postTime": 1638441701,
        "uid": 100285,
        "name": "Froggy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF1613F\u3010Tree Coloring\u3011"
    },
    {
        "content": "## \u601d\u8def\n\u770b\u5230\u5168\u90e8\u4e0d\u7b49\u4e8e\u76f4\u63a5\u8003\u8651\u5bb9\u65a5\u3002\n\n\u6211\u4eec\u8003\u8651\u94a6\u5b9a\u4e00\u4e9b\u70b9\u4e0d\u5408\u6cd5\uff0c\u5c06\u5076\u6570\u4e2a\u4e0d\u5408\u6cd5\u7684\u51cf\u53bb\u5947\u6570\u4e2a\u4e0d\u5408\u6cd5\u7684\u5c31\u662f\u7b54\u6848\u3002\n\n\u8003\u8651\u6bcf\u4e2a\u70b9\u53ea\u80fd\u94a6\u5b9a\u5b83\u5b69\u5b50\u4e2d\u81f3\u591a\u4e00\u4e2a\u4e0d\u5408\u6cd5\uff0c\u800c\u70b9\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c06\u6709 $t$ \u4e2a\u5b69\u5b50\u7684\u70b9\u7528\u591a\u9879\u5f0f $(tx+1)$ \u8868\u793a\uff0c\u5c06\u6240\u6709\u591a\u9879\u5f0f\u76f8\u4e58\u7684 $k$ \u6b21\u9879\u5c31\u662f $k$ \u4e2a\u70b9\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\u6570\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8981\u5c06 $n$ \u4e2a\u5f62\u5982 $(tx+1)$ \u7684\u591a\u9879\u5f0f\u76f8\u4e58\u3002\n\n\u7528\u5206\u6cbb NTT \u5df2\u7ecf\u53ef\u4ee5\u505a\u5230 $O(n\\log^2 n)$ \u4e86\uff0c\u4f46\u662f\u6ca1\u6709\u5c01\u88c5\u5206\u6cbb NTT \u677f\u5b50\u7684 dXqwq \u5e76\u4e0d\u60f3\u73b0\u5199\u5206\u6cbb NTT\u3002\n## \u5c0f\u6027\u8d28\n\u663e\u7136\u53ea\u4f1a\u6709\u4e0d\u8d85\u8fc7 $\\sqrt n$ \u4e2a $t$\u3002\n\n\u6211\u4eec\u5c06\u6bcf\u4e2a $(tx+1)^k$ \u53ea\u5bf9 $(tx+1)$ \u8fdb\u884c DFT\uff0c\u5e76\u5c06 DFT \u6bcf\u9879\u90fd\u53d8\u4e3a\u5176 $k$ \u6b21\u65b9\u540e\u52a0\u5165\u7b54\u6848\uff0c\u6700\u540e IDFT \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt n\\log n)$\uff0c\u751a\u81f3\u65e0\u6cd5\u901a\u8fc7 pretest\u3002\n## \u5c0f\u4f18\u5316\n\u5bf9 $(tx+1)$ \u7684 DFT \u5e76\u4e0d\u9700\u8981 $O(n\\log n)$ \u8ba1\u7b97\u3002\n\n\u76f4\u63a5\u5c06\u524d $\\frac{N}{2}$ \u9879\u8d4b\u503c\u4e3a $1$\uff0c\u540e $\\frac{N}{2}$ \u9879\u8d4b\u503c\u4e3a $t$\uff0c\u6700\u540e\u4e58\u5355\u4f4d\u6839\u505a\u4e00\u904d\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u964d\u4f4e\u5230 $O(n\\sqrt n)$\uff0c\u53ef\u4ee5\u901a\u8fc7 pretest\uff0c\u7565\u5fae\u5361\u5e38\u540e\u80fd\u901a\u8fc7\u3002\n\n\u53e6\u4e00\u4e2a\u5c0f\u4f18\u5316\u662f\u591a\u9879\u5f0f\u7684\u6700\u9ad8\u6b21\u9879\u7b49\u4e8e\u975e\u53f6\u5b50\u8282\u70b9\u4e2a\u6570\uff0c\u4e8e\u662f\u6211\u4eec $N$ \u9884\u5904\u7406\u65f6\u53ef\u4ee5\u9002\u5f53\u51cf\u5c0f\u89c4\u6a21\uff0c\u8fd9\u4e2a\u4f18\u5316\u53ef\u4ee5\u5361\u6389\u5927\u7ea6 $\\frac{1}{\\sqrt 2}$ \u7684\u5e38\u6570\u3002\n## \u4ee3\u7801\n```cpp\n// Problem: F. Tree Coloring\n// Contest: Educational Codeforces Round 118 (Rated for Div. 2)\n// URL: https://codeforces.com/contest/1613/problem/F\n// Memory Limit: 512 MB\n// Time Limit: 4500 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n//And in that light,I find deliverance.\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"unroll-loops\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nconst int p=998244353;\nint qp(int x,int y)\n{\n\tint res=1;\n\tfor(int t=x; y; y>>=1,t=1ll*t*t%p) if(y&1) res=1ll*res*t%p;\n\treturn res;\n}\n#define ull unsigned long long\ninline ull calc(const ull&x){return x-(__uint128_t(x)*9920937979283557439ull>>93)*998244353;}\nint A[262144],B[262144],C[262144];\nint rev[262144],N=2;\ninline void init()\n{\n    int d=N>>2;\n    rev[0]=0,rev[1]=N>>1;\n    for(int i=2; i<N; i<<=1,d>>=1)\n        for(int j=0; j<i; ++j) rev[i+j]=rev[j]+d;\n    return ;\n}\ninline void NTT(int *F)\n{\n    for(int i=0; i<(N>>1); ++i) F[i]=F[0];\n    for(int i=(N>>1); i<N; ++i) F[i]=F[N>>1];\n    int w0=1,w=qp(3,998244352/N);\n\tfor(int i=0; i<(N>>1); ++i)\n    {\n        int x=F[i],y=calc(1ull*w0*F[i+(N>>1)]);\n        ((F[i]=x+y)>=p)&&(F[i]-=p),\n        ((F[i+(N>>1)]=x-y)<0)&&(F[i+(N>>1)]+=p),\n        w0=calc(1ull*w0*w);\n    }\n}\ninline void NTT_(int *F)\n{\n    for(int i=0; i<N; ++i) if(rev[i]>i) F[i]^=F[rev[i]]^=F[i]^=F[rev[i]];\n    for(int len=2,M=1; len<=N; len<<=1,M<<=1)\n    {\n        int w=qp(332748118,998244352/len);\n        for(int l=0; l<N; l+=len)\n        {\n            int w0=1;\n            for(int i=l; i<l+M; ++i)\n            {\n                int x=F[i],y=calc(1ull*w0*F[i+M]);\n                ((F[i]=x+y)>=p)&&(F[i]-=p),((F[i+M]=x-y)<0)&&(F[i+M]+=p),w0=calc(1ull*w0*w);\n            }\n        }\n    }\n}\nint fac[300003],ifac[300003];\nbool f[300003];\nint a[300003],cnt[300003];\nvector<int> e[300003];\nvoid dfs(int x,int fa=0)\n{\n\tfor(int y:e[x]) if(y!=fa) ++a[x],dfs(y,x);\n\treturn ;\n}\nsigned main()\n{\n\tint n=read();\n\tfac[0]=ifac[0]=1;\n\tfor(int i=1; i<n; ++i)\n\t{\n\t\tint x=read(),y=read();\n\t\te[x].push_back(y);\n\t\te[y].push_back(x);\n\t}\n\tdfs(1);\n\tint Q=0;\n\tfor(int i=1; i<=n; ++i) if(a[i]) ++Q,++cnt[a[i]];\n\tfor(int i=1; i<=n; ++i) fac[i]=1ll*fac[i-1]*i%p,ifac[i]=qp(fac[i],p-2);\n\tfor(;N<=Q;N<<=1);\n\tinit(),A[0]=1,NTT(A);\n\tfor(int i=1; i<=n; ++i) if(cnt[i])\n\t{\n\t\tmemset(B,0,sizeof(B));\n\t\tB[N>>1]=i,B[0]=1,NTT(B);\n\t\tfor(int j=0; j<N; ++j) A[j]=1ll*A[j]*qp(B[j],cnt[i])%p;\n\t}\n\tNTT_(A);\n\tint ans=0,inv=qp(N,p-2);\n\tfor(int i=0; i<=n; ++i) A[i]=1ll*A[i]*inv%p;\n\tfor(int i=0; i<=n; ++i) ans=(ans+1ll*fac[n-i]*((i&1)?p-A[i]:A[i]))%p;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1638409015,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1613F"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF1613F)\n\n[\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://chenyu-w.github.io./2023/03/08/CF1613F%20Tree%20Coloring/)\n\n\u8fd9\u7bc7\u9898\u89e3\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u4f46\u662f\u4f1a\u66f4\u8be6\u7ec6\u5730\u8bb2\u5bb9\u65a5\u90e8\u5206\u3002\n\n\n\u9996\u5148\u76f4\u63a5\u6c42\u4e0d\u592a\u597d\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5bb9\u65a5\uff0c\u8bb0 $g(i)$ \u8868\u793a\u94a6\u5b9a $i$ \u4e2a\u70b9\u6ee1\u8db3 $c_u = c_{fa_u} - 1$ \u7684\u8d21\u732e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6709 $ans = \\sum_{i=0}^n(-1)^ig(i)$\uff0c\u7136\u540e\u6211\u4eec\u8f6c\u800c\u6c42 $g(i)$\u3002\n\n\u89c2\u5bdf\u5230 $g(i)$ \u662f\u7531\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\u7684\uff0c\u4e00\u4e2a\u662f\u88ab\u94a6\u5b9a\u7684\u90e8\u5206\uff0c\u4e00\u4e2a\u5219\u662f\u4e3a\u88ab\u94a6\u5b9a\u7684\u90e8\u5206\uff0c\u540e\u8005\u5f88\u597d\u8ba1\u7b97\uff0c\u56e0\u4e3a\u6ca1\u6709\u8981\u6c42\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7b97\uff0c\u4e5f\u5c31\u662f $(n - i)!$\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u524d\u9762\u7684\u90e8\u5206\u3002\u89c2\u5bdf\u5230\u88ab\u94a6\u5b9a\u7684\u70b9\u4e00\u5b9a\u5f62\u6210\u82e5\u5e72\u6761\u4ece\u4e0a\u5230\u4e0b\u7684\u94fe\uff0c\u800c\u53ea\u8981\u94fe\u4e2d\u4e00\u4e2a\u70b9(\u5305\u62ec\u94fe\u9876\u7236\u4eb2)\u7684 $c$ \u503c\u786e\u5b9a\u4e86\u90a3\u4e48\u6574\u4e2a\u94fe\u4e5f\u90fd\u786e\u5b9a\u4e86\u3002\u6839\u636e\u6211\u4eec\u5bf9 $g(i)$ \u7684\u5b9a\u4e49\uff0c\u6bcf\u6761\u94fe\u9876\u7684\u7236\u4eb2\u662f\u672a\u88ab\u94a6\u5b9a\u7684\uff0c\u6240\u4ee5\u8fd9\u4e00\u90e8\u5206\u5df2\u7ecf\u88ab\u7b97\u5728\u4e86 $(n - i)!$ \u4e2d\uff0c\u6240\u4ee5\u540e\u9762\u7684\u90e8\u5206\u786e\u5b9a\u4e86\uff0c\u6bcf\u6761\u94fe\u7684 $c$ \u503c\u4e5f\u5c31\u786e\u5b9a\u4e86\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u53ea\u9700\u8ba1\u7b97\u8fd9 $i$ \u4e2a\u70b9\u53ef\u80fd\u7684\u5f62\u6001\u6709\u591a\u5c11\u3002\n\n\u73b0\u5728\u6211\u4eec\u68b3\u7406\u4e00\u4e0b\uff0c\u95ee\u9898\u88ab\u6211\u4eec\u8f6c\u5316\u4e3a\u5728\u6811\u4e0a\u53d6 $i$ \u4e2a\u70b9\uff0c\u5f62\u6210\u82e5\u5e72\u6761\u76f4\u94fe\u7684\u65b9\u6848\u6570\uff0c\u56e0\u4e3a\u662f\u76f4\u94fe\uff0c\u6240\u4ee5\u6211\u4eec\u6bcf\u4e2a\u70b9\u4e0d\u80fd\u6709\u591a\u4e2a\u513f\u5b50\u88ab\u9009\uff0c\u6240\u4ee5\u8fd9\u4e2a\u70b9\u7684\u751f\u6210\u51fd\u6570\u5373\u4e3a $\\text{son}_ux + 1$\uff0c\u5176\u4e2d $\\text{son}_u$ \u4ee3\u8868\u9009\u8fd9\u4e2a\u70b9\u7684\u65b9\u6848\uff0c\u540e\u9762\u7684 $1$ \u4ee3\u8868\u4e0d\u9009\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u7b54\u6848\u5373\u4e3a $[x^i]\\prod_{i = 1}^n(\\text{son}_ux + 1)$\uff0c\u53ef\u4ee5\u7528\u5206\u6cbb $\\text{NTT}$ \u5728 $O(n\\log^2n)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u3002\n\n## \u4ee3\u7801\n\n```c++\n#include <bits/stdc++.h>\n#define L(i, j, k) for (int i = (j); i <= (k); i++)\n#define R(i, j, k) for (int i = (j); i >= (k); i--)\n#define G(i, u) for (int i = h[(u)]; ~i; i = ne[i])\n#define ll long long\n#define ld long double\n#define ull unsigned long long\n\nusing namespace std;\nconst int N = 5e5 + 10, M = 30, mod = 998244353, G = 3;\nint deg[N], res[M][N], tmpL[N], tmpR[N], rev[N], fac[N];\n\ninline int read() {\n    int x = 0, y = 1; char c = getchar();\n    while (c < '0' || c > '9') {if (c == '-') y = -1; c = getchar();}\n    while (c >= '0' && c <= '9') x = x * 10 + c - '0', c = getchar();\n    return x * y;\n}\n\ninline int mul(int x, int y) {return 1ll * x * y % mod;}\n\ninline int qpow(int a, int b) {\n\tint res = 1;\n\twhile (b) {\n\t\tif (b & 1) res = mul(res, a);\n\t\ta = mul(a, a);\n\t\tb >>= 1;\n\t}\n\treturn res;\n}\n\ninline void ntt(int a[], int n, int flg) {\n\tL(i, 0, n - 1) if (i < rev[i]) swap(a[i], a[rev[i]]);\n\tfor (int mid = 1; mid < n; mid <<= 1) {\n\t\tint W = qpow(G, (mod - 1) / (mid << 1));\n\t\tif (flg == -1) W = qpow(W, mod - 2);\n\t\tfor (int i = 0; i < n; i += (mid << 1)) {\n\t\t\tint w = 1;\n\t\t\tL(j, i, i + mid - 1) {\n\t\t\t\tint x = a[j], y = mul(w, a[j + mid]);\n\t\t\t\ta[j] = (x + y) % mod, a[j + mid] = (x - y + mod) % mod;\n\t\t\t\tw = mul(w, W);\n\t\t\t}\n\t\t}\n\t}\n}\n\ninline void NTT(int a[], int b[], int n, int m) {\n\tint k = 1, l = 0;\n\twhile (k <= n + m) k <<= 1, l++;\n\tL(i, n + 1, k) a[i] = 0;\n\tL(i, m + 1, k) b[i] = 0;\n\tL(i, 0, k - 1) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (l - 1));\n\tntt(a, k, 1), ntt(b, k, 1);\n\tL(i, 0, k - 1) a[i] = mul(a[i], b[i]);\n\tntt(a, k, -1);\n\tint invK = qpow(k, mod - 2);\n\tL(i, 0, k - 1) a[i] = mul(a[i], invK);\n}\n\ninline void cdq(int d, int l, int r) {\n\tif (l == r) {\n\t\tres[d][0] = 1, res[d][1] = deg[l];\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tcdq(d + 1, l, mid);\n\tL(i, 0, mid - l + 1) res[d][i] = res[d + 1][i];\n\tcdq(d + 1, mid + 1, r);\n\tL(i, 0, mid - l + 1) tmpL[i] = res[d][i];\n\tL(i, 0, r - mid) tmpR[i] = res[d + 1][i];\n\tNTT(tmpL, tmpR, mid - l + 1, r - mid);\n\tL(i, 0, r - l + 1) res[d][i] = tmpL[i];\n}\n\ninline int getMod(int x) {return (x % mod + mod) % mod;}\n\nint main() {\n\tint n = read();\n\tL(_, 1, n - 1) deg[read()]++, deg[read()]++;\n\tL(i, 2, n) deg[i]--;\n\tcdq(0, 1, n);\n\tfac[0] = 1;\n\tL(i, 1, n) fac[i] = mul(fac[i - 1], i);\n\tint ans = 0;\n\tL(i, 0, n - 1) ans = getMod(ans + ((i & 1) ? -1 : 1) * mul(fac[n - i], res[0][i]));\n\tprintf(\"%d\\n\", ans);\n    return 0;\n}\n```\n\n\n\n",
        "postTime": 1678287249,
        "uid": 587248,
        "name": "wcywcywcywcy",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011CF1613F"
    }
]