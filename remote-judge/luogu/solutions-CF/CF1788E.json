[
    {
        "content": "> \u8840\u7684\u6559\u8bad\uff1aCF \u4e0a\u5343\u4e07\u4e0d\u8981\u548c C/D \u6b7b\u78d5\uff0c\u4e0d\u7136\u53ef\u80fd E \u9001\u5206\u90fd\u62ff\u4e0d\u5230\u3002\n\n$\\tiny{\\color{White}\\text{\u5e76\u4e14\u4f60\u8fde D \u90fd\u6ca1\u6709\u78d5\u51fa\u6765\u3002}}$\n\n## \u9898\u610f\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6574\u6570\u5e8f\u5217 $a$\u3002\u5b9a\u4e49\u4e00\u4e2a\u4e8c\u5143\u7ec4\u96c6\u5408 $S=\\{(x,y)|1\\leq x\\leq y\\leq n\\}$ \u662f\u5408\u6cd5\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53\uff1a\n1. \u5bf9\u4e8e\u4efb\u610f\u7684\u4e00\u4e2a $t(1\\leq x\\leq n)$\uff0c\u4e0d\u5b58\u5728 $1\\leq i<j\\leq |S|$\uff0c\u4f7f\u5f97 $x_i\\leq t\\leq y_i\\And x_j\\leq t\\leq y_j$\u3002\n2. $\\forall 1\\leq i\\leq |S|,\\sum\\limits_{j=x_i}^{y_i}a_j\\geq 0$\u3002\n\n\u5b9a\u4e49 $S$ \u7684\u4ef7\u503c\u4e3a $\\sum\\limits_{i=1}^{|S|}(y_i-x_i+1)$\uff0c\u6c42\u6240\u6709\u5408\u6cd5\u7684 $|S|$ \u7684\u6700\u5927\u4ef7\u503c\u3002\n### \u6570\u636e\u8303\u56f4\n$1\\leq n\\leq 2\\times10^5,|a_i|\\leq 10^9$\n\n## \u5206\u6790\n\u663e\u7136\uff0c\u5c31\u662f\u4ece $[1,n]$ \u4e2d\u6263\u6389\u4e00\u4e9b\u70b9\uff0c\u4f7f\u5f97\u5269\u4e0b\u7684\u70b9\u7ec4\u6210\u7684\u6781\u957f\u5b50\u4e32\u7684\u548c\u90fd\u4e0d\u5c0f\u4e8e $0$\u3002\n\n\u8003\u8651 dp\uff0c\u8bbe $f_i$ \u4e3a\u8003\u8651\u533a\u95f4 $[1,i]$ \u7684 $S$ \u7684\u6700\u5927\u4ef7\u503c\uff0c\u5206 $i$ \u9009/\u4e0d\u9009\u8003\u8651\uff0c\u679a\u4e3e\u4e0a\u4e00\u6bb5\u533a\u95f4\u7684\u7ed3\u5c3e\uff0c\u6709\n$$\nf_i=\\max\\{f_{i-1},\\max_{0\\leq j<i,\\sum\\limits_{k=j+1}^{i-1}a_k\\geq 0}\\{f_j+i-j\\}\\}\n$$\n\u8fb9\u754c $f_0=0$\u3002\n\n\u663e\u7136\u76f4\u63a5\u8f6c\u79fb\u662f $O(n^2)$ \u7684\u3002\n\n\u8f6c\u79fb\u4e2d\u6700\u70e6\u4eba\u7684\u5730\u65b9\u5c31\u662f\u90a3\u4e2a\u5b57\u6bb5\u548c\u4e3a\u975e\u8d1f\u6570\u7684\u9650\u5236\u4e86\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9650\u5236\u4e0e $a$ \u7684\u503c\u76f8\u5173\uff0c\u8003\u8651\u4f7f\u7528\u503c\u57df\u4e0a\u7684\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\n\n\u4ee4\u5f53\u524d\u8ba1\u7b97\u7684\u662f $f_i$\uff0c\u8bbe $sum_j=\\sum_{k=j}^ia_k$\uff0c\u5219\u80fd\u8f6c\u79fb\u5230 $i$ \u7684 $j$ \u8981\u6ee1\u8db3 $sum_{j}\\geq 0$\uff0c\u5373\n$$\nf_i=\\max\\{f_{i-1},i+\\max_{sum_j\\geq 0}\\{f_j-j\\}\\}\n$$\n\u8f6c\u79fb\u524d\uff0c\u8981\u52a8\u6001\u7ef4\u62a4\u5168\u5c40\u7684 $sum_j$\uff0c\u5373\u5168\u5c40 $sum_j$ \u52a0\u4e0a\u4e00\u4e2a $a_i$\u3002\u8f6c\u79fb\u540e\uff0c\u8981\u52a8\u6001\u63d2\u5165\u4e00\u4e2a\u70b9\uff0c\u6743\u503c\u4e3a $a_i$\uff0c\u6620\u5c04\u503c $f_i-i$\u3002\n\n\u56e0\u6b64\u6211\u4eec\u8981\u4f7f\u7528\u7684\u6570\u636e\u7ed3\u6784\u8981\u80fd\u652f\u6301\uff1a\n1. \u5168\u5c40\u52a0\u4e0a\u4e00\u4e2a\u6570\u3002\n2. \u52a8\u6001\u63d2\u5165\u4e00\u4e2a\u6570\u3002\n3. \u67e5\u8be2\u5927\u4e8e\u6216\u7b49\u4e8e $0$ \u7684\u6570\u7684\u6620\u5c04\u503c\u7684\u6700\u5927\u503c\u3002\n\n\u96c6\u5408\u7c7b\u6570\u636e\u7ed3\u6784\uff0c\u679c\u65ad\u4f7f\u7528\u5e73\u8861\u6811\u3002\n### Code\n\u8d5b\u540e\u6253\u5b8c\u7684\uff0cCF \u4e0a\u53ef\u4ee5 AC\u3002$\\tiny{\\color{White}{\\text{\u524d\u63d0\u662f\u53bb\u6389\u9632\u6284\u88ad\u3002}}}$\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<iomanip>\n#include<cstring>\n#include<cmath>\n#include<climits>\n#include<ctime>\n#include<chrono>\n#include<cassert>\n#include<algorithm>\n#include<iterator>\n#include<numeric>\n#include<vector>\n#include<queue>\n#include<stack>\n#include<set>\n#include<map>\n#include<bitset>\n#include<functional>\n#include<random>\n\nusing namespace std;\ntemplate<class T1,class T2>inline bool cmax(T1 &a,T2 b) {return a<b?a=b,1:0;}\ntemplate<class T1,class T2>inline bool cmin(T1 &a,T2 b) {return b<a?a=b,1:0;}\ntypedef pair<int,int> pii;\ntypedef long long LL;\n\nconst int N=2e5+10,INF=0x3f3f3f3f;\n\nmt19937 gen(chrono::system_clock::now().time_since_epoch().count());\n//mt19937 gen(114514);\nuniform_int_distribution<int>dist(1,1e9);\n\nint n,a[N+1];\nstruct \nFHQ{\n    int ls,rs,dp,key,sdp;\n    LL sum,tag;\n}tree[N+1];\nint f[N+1];\n#define ls(p) tree[p].ls\n#define rs(p) tree[p].rs\n#define dp(p) tree[p].dp\n#define key(p) tree[p].key\n#define sdp(p) tree[p].sdp\n#define sum(p) tree[p].sum\n#define tag(p) tree[p].tag\nint root,tot;\n\ninline void\npush_up(int p){\n    sdp(p)=dp(p);\n    if(ls(p))cmax(sdp(p),sdp(ls(p)));\n    if(rs(p))cmax(sdp(p),sdp(rs(p)));\n    return ;\n}\n\ninline void\nupdate(int p,int x){\n    sum(p)+=x,tag(p)+=x;\n}\n\ninline void\npush_down(int p){\n    if(!tag(p))return ;\n    if(ls(p))update(ls(p),tag(p));\n    if(rs(p))update(rs(p),tag(p));\n    tag(p)=0;\n    return ;\n}\n\ninline void\nsplit(int p,int &x,int &y,LL v){\n    if(!p)return void(x=y=0);\n    push_down(p);\n    while(1)cout<<\"Never gonna give you up, never gonna let you down.\"<<endl;\n    if(sum(p)>=v)y=p,split(ls(p),x,ls(y),v);\n    else x=p,split(rs(p),rs(x),y,v);\n    push_up(p);\n}\n\ninline int\nmerge(int x,int y){\n    if(!x||!y)return x+y;\n    int p;\n    push_down(x),push_down(y);\n    if(key(x)<key(y))p=x,rs(x)=merge(rs(x),y);\n    else p=y,ls(y)=merge(x,ls(y));\n    push_up(p);\n    return p;\n}\n\ninline int\nnewnode(int x,int y){\n    int p=++tot;\n    key(p)=dist(gen),dp(p)=sdp(p)=x,sum(p)=y;\n    return p;\n}\n\nint\nmain(){\n    //freopen(\"QWQ.in\",\"r\",stdin);\n    //freopen(\"WQW.out\",\"w\",stdout);\n    ios::sync_with_stdio(0);cin.tie(0),cout.tie(0);\n    cin>>n;\n    for(int i=1;i<=n;i++)cin>>a[i];\n    sdp(0)=dp(0)=-INF;\n    root=merge(root,newnode(0,0));\n    for(int i=1,x,y;i<=n;i++){\n        update(root,a[i]);\n        split(root,x,y,a[i]);\n        root=merge(merge(x,newnode(f[i-1]-i+1,a[i])),y);\n        split(root,x,y,0);\n        f[i]=max(f[i-1],sdp(y)+i);\n        root=merge(x,y);\n    }\n    //for(int i=1;i<=n;i++)cout<<f[i]<<' ';\n    //cout<<'\\n';\n    cout<<f[n]<<endl;\n    return 0;\n}\n\n```\n$\\tiny{\\color{White}{\\text{Never gonna give you up, never gonna let you down.}}}$\n## \u540e\u8bdd\n1. ~~\u4e0d\u8981\u5984\u60f3\u6700\u540e 15 \u5206\u949f\u4e00\u68f5\u5e73\u8861\u6811\uff08\u5e26\u8c03\u8bd5\uff09\uff0c\u4f60\u4e0d\u662f lxl~~\u3002\n2. \u8bf7\u4e0d\u8981 Ctrl A + Ctrl C + Ctrl V\u3002\u4e00\u662f\u8fdd\u89c4\uff0c\u4e8c\u662f\u8fd9\u6837\u4e0d\u5229\u4e8e\u63d0\u5347\u80fd\u529b\u3002$\\tiny{\\color{White}{\\text{\u4e09\u662f\u6709\u9632\u6284\u88ad\u4ee3\u7801\u7247\u6bb5\uff0c\u56db\u662f\u4e0d\u60f3\u8ba9\u4f60\u770b\u89c1\u9690\u85cf\u6587\u5b57}}}$\u3002\n\n# End\n\n\n\n\n\n",
        "postTime": 1675995546,
        "uid": 582035,
        "name": "_cyle_King",
        "ccfLevel": 0,
        "title": "CF1788E \u9898\u89e3"
    },
    {
        "content": "\u55ef\uff0c\u4e94\u5206\u949f\u63a8\u5b8c\u7136\u540e\u5199\u4e86\u4e2a\u66b4\u529b\u53d1\u73b0 wa on pretest4 \u5c31\u5f03\u4e86\uff0c\u7ed3\u679c\u662f\u5bf9\u7684\u3002\n\n\u9898\u610f\uff1a\u9009\u51fa\u4e00\u4e9b\u8fde\u7eed\u7684\u533a\u95f4\uff0c\u6ee1\u8db3\u6bcf\u4e2a\u9009\u51fa\u7684\u533a\u95f4\u7684\u6570\u7684\u548c\u90fd\u662f\u975e\u8d1f\u7684\uff0c\u6c42\u9009\u51fa\u533a\u95f4\u7684\u6700\u5927\u957f\u5ea6\u603b\u548c\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c $s$\uff0c\u82e5 $s_i-s_{j}\\geq 0$\uff0c\u5219 $[j+1,i]$ \u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u533a\u95f4\uff0c\u6b64\u65f6\u518d\u52a0\u4e0a $[0,j]$ \u7684\u6700\u4f18\u957f\u5ea6\u5373\u53ef\u3002\u5373\uff0c\u4ee4 $dp_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684\u6700\u957f\u5408\u6cd5\u533a\u95f4\uff0c$pre_i$ \u8868\u793a\u4ee5 $[0,i]$ \u4e2d\u67d0\u4e2a\u70b9\u4e3a\u7ed3\u5c3e\u7684\u6700\u957f\u5408\u6cd5\u533a\u95f4\uff0c\u6709 $dp_i=\\max\\limits^{i-1}_{j=0,s_i-s_j\\geq 0}{pre_j+i-j},{pre_i}=\\max\\limits_{j=0}^i {dp_j}$\uff0c\u679a\u4e3e $i$\uff0c\u679a\u4e3e $j$\uff0c\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n$pre$ \u7684\u5feb\u901f\u6c42\u6cd5\u53ef\u4ee5\u7528\u524d\u7f00\u6700\u5927\u503c\u89e3\u51b3\uff0c\u81f3\u4e8e $dp$\uff0c\u6211\u4eec\u8003\u8651\u628a\u5bf9\u5e94\u7684\u503c\u5b58\u5230\u503c\u57df\u800c\u4e0d\u662f\u4e0b\u6807\u91cc\uff0c\u5373\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u76f8\u7b49\u7684 $s_j$\uff0c\u5b58\u4e0b\u6700\u5927\u7684 $pre_j-j$\uff0c\u7136\u540e\u5c31\u53d8\u6210\u4e86\u67e5\u8be2 $(-\\infty,s_i]$ \u91cc\u7684\u6700\u5927\u503c\uff0c\u7528\u7ebf\u6bb5\u6811\u89e3\u51b3\u5c31\u597d\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long ll;\ntypedef unsigned long long ull;\nusing namespace std;\nconst int N = 2e5 + 5;\n/*\nez to solve:\n\tfor (int i = 1; i <= n; i++) {\n\t\tfor (int j = 0; j < i; j++)\n\t\t\tif (sum[i] - sum[j] >= 0)\n\t\t\t\tdp[i] = max(dp[i], pre[j] + i - j);\n\t\tpre[i] = max(pre[i - 1], dp[i]);\n\t}\n\tcout << pre[n] << endl;\nbut i give up\n\nsi ma le, bi xu li san hua.\n*/\nint a[N];\nint ls[N << 5], rs[N << 5], val[N << 5], n, idx, rt, dp[N], pre[N];\nll sum[N];\ninline void modify(int &p, int l, int r, int x, int k) {\n\tif (!p)\n\t\tval[p = ++idx] = INT_MIN;\n\tval[p] = max(val[p], k);\n\tif (l == r)\n\t\treturn;\n\tint mid = (l + r) >> 1;\n\tif (x <= mid)\n\t\tmodify(ls[p], l, mid, x, k);\n\telse\n\t\tmodify(rs[p], mid + 1, r, x, k);\n}\ninline int query(int p, int l, int r, int L, int R) {\n\tif (!p)\n\t\treturn INT_MIN;\n\tif (L <= l && r <= R)\n\t\treturn val[p];\n\tint mid = (l + r) >> 1, res = INT_MIN;\n\tif (L <= mid)\n\t\tres = max(res, query(ls[p], l, mid, L, R));\n\tif (R > mid)\n\t\tres = max(res, query(rs[p], mid + 1, r, L, R));\n\treturn res;\n}\nsigned main() {\n\tcin.tie(nullptr)->sync_with_stdio(false);\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i];\n\tfor (int i = 1; i <= n; i++) \n\t\tsum[i] = sum[i - 1] + a[i];\n\tvector<ll> lsh;\n\tfor (int i = 0; i <= n; i++)\n\t\tlsh.emplace_back(sum[i]);\n\tsort(lsh.begin(), lsh.end());\n\tunique(lsh.begin(), lsh.end());\n\tint k = lsh.size();\n\tfor (int i = 0; i <= n; i++)\n\t\tsum[i] = lower_bound(lsh.begin(), lsh.end(), sum[i]) - lsh.begin() + 1;\n\tmodify(rt, 1, k, sum[0], 0);\n\tfor (int i = 1; i <= n; i++) {\n\t\tdp[i] = query(rt, 1, k, 1, sum[i]) + i;\n\t\tpre[i] = max(pre[i - 1], dp[i]);\n\t\tmodify(rt, 1, k, sum[i], pre[i] - i);\n\t}\n\tcout << pre[n] << endl;\n\treturn 0;\n}\n```",
        "postTime": 1676031303,
        "uid": 434929,
        "name": "Usada_Pekora",
        "ccfLevel": 7,
        "title": "CF1788E DS \u4f18\u5316 dp"
    },
    {
        "content": "## E \u9898\u89e3\n\n### \u4e00\u4e9b\u58f0\u660e\n\n$dp_i$ \u8868\u793a\u5230\u4f4d\u7f6e $i$ \u4e3a\u6b62\u6709\u591a\u5c11\u70b9**\u6ca1\u6709\u9009**\u3002\n\n$sum_i$ \u8868\u793a $\\sum_{i=1}^{n}a_i$\u3002\n\n\u5173\u4e8e\u4e3a\u4ec0\u4e48\u8981\u4ee4 $dp_i$ \u662f\u6ca1\u6709\u9009\u7684\u6700\u4f18\u89e3\uff1a$dp$ \u8868\u793a\u9009\u4e0e\u4e0d\u9009\u5728\u590d\u6742\u5ea6 $O(n^2)$ \u65f6\u662f\u90fd\u53ef\u4ee5\u5b9e\u73b0\u7684\uff0c\u4f46\u662f\u5728\u590d\u6742\u5ea6 $O(n\\log{n})$ \u65f6\uff0c\u7531\u4e8e\u8981\u5c06\u4e4b\u524d\u7684\u4fe1\u606f\u653e\u5230\u6570\u636e\u7ed3\u6784\u91cc\uff0c\u8fd9\u4e2a\u4fe1\u606f\u662f\u4e0d\u80fd\u968f\u4f4d\u7f6e\u800c\u6539\u53d8\u7684\uff0c\u4f46\u662f\u5982\u679c\u662f $dp_i$ \u8868\u793a\u9009\u7684\u8bdd\uff0cdp \u8f6c\u79fb\u65b9\u7a0b\u5c31\u662f $dp_i=\\max(dp_j+i-j)$\uff0c\u8fd9\u4e2a\u4fe1\u606f\u4f1a\u6539\u53d8\u6240\u4ee5\u4e0d\u9002\u5408\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\u8fd9\u4e5f\u662f\u201c\u6b63\u96be\u5219\u53cd\u201d\u7684\u601d\u60f3\u3002\n\n### \u6734\u7d20 dp\n\n$dp_i$ \u53ef\u4ee5\u7531\u4e24\u79cd\u65b9\u6cd5\u8f6c\u79fb:\n\n1. $dp_i$ \u4e0d\u53d6\uff0c\u6b64\u65f6 $dp_i=dp_{i-1}+1$\u3002\n2. $dp_i$ \u53d6\uff0c\u4ece $1$ \u5230 $i-1$ \u679a\u4e3e $j$\u3002\u8003\u8651\u4ec0\u4e48\u6837\u7684 $j$ \u53ef\u4ee5\u8f6c\u79fb\uff0c\u5373 $j+1$ \u5230 $i$ \u8fd9\u4e00\u6bb5\u90fd\u53d6\u4e86\uff0c\u5373 $sum_i-sum_j\\geq0$\u3002\u6b64\u65f6 $dp_i=\\min(dp_j)$\u3002\n\n\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n```cpp\nfor(int i=1;i<=n;i++){\n    dp[i]=dp[i-1]+1;\n    for(int j=1;j<i;j++)\n        if(sum[i]>=sum[j])\n            dp[i]=min(dp[i],dp[j]);\n}\n```\n\n### \u5982\u4f55\u4f18\u5316\n\n\u8fd9\u4e2a dp \u7684\u590d\u6742\u5ea6\u4e0d\u591f\u4f18\u79c0\uff0c\u6211\u4eec\u8003\u8651\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\n\n\u53d1\u73b0\u5bf9\u4e8e $i$ \u67e5\u8be2\u7684\u662f\uff0c\u4f4d\u7f6e\u5728 $i$ \u4e4b\u524d\uff0c\u524d\u7f00\u548c\u5c0f\u4e8e $i$ \u7684\u6240\u6709 $dp$ \u7684\u6700\u5c0f\u503c\u3002\u7528\u7ebf\u6bb5\u6811\uff08\u5176\u4ed6\u6570\u636e\u7ed3\u6784\u4e5f\u53ef\u4ee5\uff09\u7ef4\u62a4\u8fd9\u4e2a\u4fe1\u606f\u3002\n\n\u5c06\u524d\u7f00\u548c\u79bb\u6563\u5316\uff0c\u66f4\u65b0\u65f6\u67e5\u8be2\u6bd4\u5f53\u524d\u524d\u7f00\u548c\u5c0f\u7684\u6700\u5c0f\u503c\uff0c\u5728\u5b8c\u6210 $dp_i$ \u7684\u66f4\u65b0\u4e4b\u540e\u5c06\u5176\u63d2\u5165\u7ebf\u6bb5\u6811\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log{n})$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<class T>void read(T &x){\n    x=0;long long f=0;char ch=getchar();\n    while(ch<'0'||ch>'9')  {f|=(ch=='-');ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n    x=f?-x:x;return;\n}\nconst long long N=2e5+5;\nlong long n,val[N],dp[N],sum[N],cpy[N];\nstruct node{\n    long long val;\n}a[N*20];\nvoid build(long long p,long long l,long long r){\n    a[p].val=0x3f3f3f3f;\n    if(l==r) return ;\n    long long mid=l+r>>1;\n    build(p<<1,l,mid);\n    build(p<<1|1,mid+1,r);\n}\nvoid update(long long p,long long l,long long r,long long pos,long long val){\n    if(l==r){a[p].val=min(a[p].val,val);return ;}\n    long long mid=(l+r)>>1;\n    if(pos<=mid) update(p<<1,l,mid,pos,val);\n    else update(p<<1|1,mid+1,r,pos,val);\n    a[p].val=min(a[p<<1].val,a[p<<1|1].val);\n}\nlong long query(long long p,long long l,long long r,long long L,long long R){\n    if(L<=l&&R>=r) return a[p].val;\n    long long mid=l+r>>1,ret=0x3f3f3f3f;\n    if(L<=mid) ret=min(ret,query(p<<1,l,mid,L,R));\n    if(R>mid) ret=min(ret,query(p<<1|1,mid+1,r,L,R));\n    return ret;\n}\nmain(){\n    read(n);\n    for(long long i=1;i<=n;i++)read(val[i]),sum[i]=val[i]+sum[i-1],cpy[i]=sum[i];\n    sort(cpy,cpy+n+1);\n    long long len=unique(cpy,cpy+n+1)-cpy;\n    build(1,0,len);\n    long long rnk_0=lower_bound(cpy,cpy+len,0)-cpy;\n    update(1,0,len,rnk_0,0);\n    for(long long i=1;i<=n;i++){\n        dp[i]=dp[i-1]+1;\n        if(sum[i]>=0) dp[i]=0;\n        long long pos=lower_bound(cpy,cpy+len,sum[i])-cpy;\n        long long tmp=query(1,0,len,0,pos);\n        dp[i]=min(dp[i],tmp);\n        update(1,0,len,pos,dp[i]);\n    }\n    printf(\"%lld\\n\",n-dp[n]);\n    return 0;\n}\n```\n",
        "postTime": 1676272417,
        "uid": 151947,
        "name": "\u6d1b\u6d54",
        "ccfLevel": 0,
        "title": "CF1788E"
    },
    {
        "content": "[Link.](https://www.luogu.com.cn/problem/CF1788E)\n\n\u4ee4 $s_i=\\sum\\limits_{k=1}^i a_k$\u3002\n\n\u5b9a\u4e49 $dp_i$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u4e2d\u6240\u80fd\u7ec4\u6210\u7684\u96c6\u5408\u7684 $f(S)$ \u6700\u5927\u503c\uff0c\u5e76\u4e14\u5f3a\u5236\u9009\u4e2d\u70b9 $i$\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$\ndp_i=\\max\\{dp_{i-1},\\max_{j\\in [0,i-1],s_j\\le s_i}\\{\\{\\max_{k\\in [0,j]}dp_k\\}+i-j\\}\\}\n$$\n\n\u4ee4 $sum_i=\\max\\limits_{k\\in [0,i]} dp_k$\uff0c\u5219\u53ef\u4ee5\u5c06\u4e0a\u5f0f\u4f18\u5316\u81f3 $\\mathcal O(n^2)$\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c$j\\lt i,s_j\\le s_i$ \u662f\u5178\u578b\u7684\u504f\u5e8f\u5173\u7cfb\uff0c\u56e0\u6b64\u4e0d\u96be\u60f3\u5230\u7528 CDQ \u5206\u6cbb\u548c\u5355\u8c03\u6808\u4f18\u5316\u8fd9\u4e2a DP \u8fc7\u7a0b\u3002\n\n\u4e00\u4e2a\u5c0f\u7ec6\u8282\uff0cCDQ \u5206\u6cbb\u4e2d\uff0c\u8981\u5148 `solve(l,mid)`\uff0c\u7136\u540e\u5904\u7406\u5de6\u534a\u533a\u95f4\u5bf9\u53f3\u8fb9\u7684\u8d21\u732e\uff0c\u6700\u540e\u518d `solve(mid+1,r)`\u3002\u8fd9\u662f\u56e0\u4e3a\u5de6\u533a\u95f4\u5bf9\u53f3\u8fb9\u7684\u5f71\u54cd\u82e5\u4e0d\u5148\u8ba1\u7b97\uff0c\u5219\u53f3\u533a\u95f4\u7684\u51b3\u7b56\u70b9\u96c6\u5408\u4e0d\u5b8c\u6574\u3002\n\n\u611f\u89c9\u8fd9\u6837\u7684\u8ba1\u7b97\u987a\u5e8f\u4f3c\u4e4e\u65e0\u6cd5\u5f52\u5e76\u6392\u5e8f\uff0c\u5c31\u7528\u4e86 `std::sort`\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log^2 n)$\uff0c\u8dd1\u5f97\u8fd8\u662f\u633a\u5feb\u7684\u3002\u6709 CDQ \u7684 $\\mathcal O(n\\log n)$ \u505a\u6cd5\u6b22\u8fce\u63d0\u51fa qwq\u3002\n\n```cpp\n// Problem: Sum Over Zero\n// Contest: Luogu\n// URL: https://www.luogu.com.cn/problem/CF1788E\n// Memory Limit: 250 MB\n// Time Limit: 1000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n#include <bits/stdc++.h>\nusing i64 = long long;\n\nconst int maxn = 2e5 + 5;\nint n,f[maxn],sum[maxn],b[maxn],c[maxn],stk[maxn],tp;\ni64 s[maxn];\n\nvoid solve(int l,int r) {\n\tif(l == r) {\n\t\tsum[l] = f[l];\n\t\tif(l)\n\t\t\tsum[l] = std::max(sum[l] , sum[l - 1]);\n\t\treturn ;\n\t}\n\tint mid = (l + r) >> 1;\n\tsolve(l , mid);\n\tfor(int i = l;i <= mid;++ i)\n\t\tc[i] = i;\n\tfor(int i = mid + 1;i <= r;++ i)\n\t\tb[i] = i;\n\tstd::sort(c + l , c + 1 + mid , [&](const int& x,const int &y) {\n\t\treturn s[x] < s[y];\n\t});\n\tstd::sort(b + mid + 1 , b + r + 1 , [&](const int& x,const int& y) {\n\t\treturn s[x] < s[y];\n\t});\n\tstk[tp = 0] = 0;\n\tfor(int i = l,k = mid + 1;k <= r;++ k) {\n\t\twhile(i <= mid&&s[c[i]] <= s[b[k]]) {\n\t\t\twhile(tp > 0&&sum[stk[tp]] - stk[tp] <= sum[c[i]] - c[i])\n\t\t\t\tstk[tp --] = 0;\n\t\t\tstk[++ tp] = c[i ++];\n\t\t}\n\t\tif(tp > 0)\n\t\t\tf[b[k]] = std::max(f[b[k]] , sum[stk[1]] + b[k] - stk[1]);\n\t}\n\tsolve(mid + 1 , r);\n\treturn ;\n}\n\nint main() {\n\tscanf(\"%d\",&n);\n\tfor(int i = 1;i <= n;++ i)\n\t\tscanf(\"%lld\",&s[i]),s[i] += s[i - 1];\n\tsolve(0 , n);\n\tprintf(\"%d\\n\",sum[n]);\n\treturn 0;\n}\n```",
        "postTime": 1676026735,
        "uid": 561077,
        "name": "ImALAS",
        "ccfLevel": 0,
        "title": "[CF1788E] Sum Over Zero \u9898\u89e3"
    },
    {
        "content": "### \u601d\u8def\n\u9996\u5148\u6211\u4eec\u89c2\u5bdf\u9898\uff0c\u5148\u8003\u8651 $\\mathcal{O}(N^2)$ \u505a\u6cd5\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u5c31\u53ef\u4ee5\u5217\u4e00\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u3002  \n\u5148\u6c42\u4e00\u4e0b\u524d\u7f00\u548c `sum`\u3002    \n\u5982\u679c $sum_i \\ge sum_j$\uff0c\u5219\u6709 $F_i = \\max(F_i, F_j + i - j)$\u3002  \n\u5982\u679c $sun_i < sum_j$\uff0c\u5219\u6709 $F_i = \\max(F_i, F_j)$\u3002  \n\u5f97\u5230\u8fd9\u4e2a\u4e4b\u540e\u518d\u8003\u8651\u600e\u4e48\u8fdb\u884c\u4f18\u5316\uff0c\u5f88\u660e\u663e\u6211\u4eec\u5c06 $F_i - i$ \u6dfb\u52a0\u5230\u5e73\u8861\u6811\u4e2d\uff0c\u7136\u540e\u7528 $sum_i$ \u4f5c\u4e3a\u5e73\u8861\u6811\u7684\u6392\u5e8f\u5173\u952e\u8bcd\u3002   \n\u6700\u540e\u732e\u4e0a\u6211\u4e11\u964b\u7684\u4ee3\u7801\u3002  \n### \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define int ll\nconst int MaxN = 1e6 + 100;\nconst int INF = 1e18;\nint T, N, M, a[MaxN];\nint F[MaxN], sum[MaxN];\nint num, rt, t1, t2, t3, ans;\nstruct Point\n{\n\tint p, v, l, r, maxn;\n\tint ts;\n} tree[MaxN];\ninline void updata(int x)\n{\n\ttree[x].maxn = max(tree[tree[x].l].maxn, tree[tree[x].r].maxn);\n\ttree[x].maxn = max(tree[x].maxn, tree[x].ts);\n}\ninline int add1(int v, int ts)\n{\n\tint x = ++num;\n\ttree[x].l = tree[x].r = 0;\n\ttree[x].v = v;\n\ttree[x].maxn = tree[x].ts = ts;\n\ttree[x].p = rand();\n\treturn x;\n}\nvoid split(int x, int k, int &l, int &r)\n{\n\tif (!x)\n\t{\n\t\tl = r = 0;\n\t\treturn;\n\t}\n\tif (tree[x].v <= k)\n\t{\n\t\tl = x;\n\t\tsplit(tree[x].r, k, tree[x].r, r);\n\t}\n\telse\n\t{\n\t\tr = x;\n\t\tsplit(tree[x].l, k , l, tree[x].l);\n\t}\n\tupdata(x);\n}\nint hebin(int x, int y)\n{\n\tif (!x || !y)\n\t\treturn x + y;\n\tif (tree[x].p < tree[y].p)\n\t{\n\t\ttree[x].r = hebin(tree[x].r, y);\n\t\tupdata(x);\n\t\treturn x;\n\t}\n\telse\n\t{\n\t\ttree[y].l = hebin(x, tree[y].l);\n\t\tupdata(y);\n\t\treturn y;\n\t}\n}\ninline void Solve()\n{\n\tcin >> N;\n\ttree[0].maxn = -INF;\n\tfor (int i = 1 ; i <= N; i++)\n\t{\n\t\tcin >> a[i];\n\t\tsum[i] = sum[i - 1] + a[i];\n\t}\n\trt = add1(0, 0);\n\tfor (int i = 1; i <= N; i++)\n\t{\n\t\tF[i] = ans;\n\t\tsplit(rt, sum[i], t1, t3);\n\t\tint jg = tree[t1].maxn;\n\t\tF[i] = max(F[i], i + jg);\n\t\trt = hebin(hebin(t1, add1(sum[i], F[i] - i)), t3);\n\t\tans = max(ans, F[i]);\n\t}\n\tcout << F[N];\n}\nsigned main()\n{\n\tios::sync_with_stdio(0);\n\tcin.tie(0);\n\tT = 1;\n\twhile (T--)\n\t\tSolve();\n}\n```",
        "postTime": 1676783936,
        "uid": 300531,
        "name": "EBeason",
        "ccfLevel": 0,
        "title": "CF1788E"
    },
    {
        "content": "\u8fd9\u7bc7\u9898\u89e3\u8bd5\u56fe\u8bb2\u5f97\u6d45\u663e\u6613\u61c2\u4e00\u4e9b\u3002\n\n\u9996\u5148\u5148\u611f\u8c22 @\u4e00\u4e2a\u7a0b\u5e8f\u5458 @Max_s_xaM \u548c\u6211\u8ba8\u8bba\u51fa\u8fd9\u4e2a\u89e3\u6cd5\u3002\n\n\u8003\u8651 dp\u3002\n\n\u8bbe $dp[i]$ \u8868\u793a\u53ea\u8003\u8651\u524d $i$ \u4e2a\u6570\u65f6\u6700\u591a\u80fd\u9009\u591a\u5c11\u6570\u3002$dp[n]$ \u5373\u4e3a\u7b54\u6848\u3002\n\n\u5219 $dp[i]=\\max(dp[i-1],dp[j]+i-j)$\uff08\u9700\u6ee1\u8db3 $\\sum_{k=j+1}^ia[k]\\geq0$\uff09\n\n\u4ec0\u4e48\u610f\u601d\u5462\uff1f\n\n\u9996\u5148\uff0c\u7ee7\u627f $dp[i-1]$ \u8868\u793a\u4e0d\u9009 $i$\uff0c\u76f4\u63a5\u6309\u524d $i-1$ \u4e2a\u6570\u7684\u6700\u4f18\u65b9\u6848\u6765\u3002\n\n\u5176\u6b21\uff0c\u5982\u679c $a$ \u6570\u7ec4 $[j+1,i]$ \u4e2d\u6570\u7684\u548c\u975e\u8d1f\uff08$\\sum_{k=j+1}^ia[k]\\geq0$\uff09\uff0c\u5219\u53ef\u4ee5\u5728 $dp[j]$ \u7684\u57fa\u7840\u4e0a\u52a0\u4e0a $[j+1,i]$ \u7684\u957f\u5ea6\uff0c\u8868\u793a\u9009\u4e2d\u8fd9\u6bb5\u533a\u95f4\u3002\n\n\u53ef\u60dc\u8be5\u505a\u6cd5\u662f $O(n^2)$ \u7684\uff0c\u9700\u8981\u4f18\u5316\u3002\n\n\u6211\u4eec\u4e4b\u540e\u6682\u4e0d\u8003\u8651\u8f6c\u79fb\u65b9\u7a0b\u91cc $dp[i-1]$ \u7684\u90e8\u5206\uff0c\u56e0\u4e3a\u8fd9\u90e8\u5206\u6bd4\u8f83\u597d\u641e\u3002\n\n\u8bbe $pre[i]=\\sum_{j=1}^ia[i]$\uff0c\u5373\u4e3a\u524d\u7f00\u548c\u6570\u7ec4\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c$\\sum_{k=j+1}^ia[k]\\geq0$ \u4e0e $pre[i]\\geq pre[j]$ \u7b49\u4ef7\u3002\n\n\n\u6240\u4ee5\uff0c\u5982\u679c $dp[j]$ \u80fd\u8f6c\u79fb\u5230 $dp[i]$\uff0c\u5219\u6709\uff1a\n- $j<i$\n- $pre[j]\\leq pre[i]$\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u7528\u8003\u8651 $[1,i-1]$ \u4e2d $pre[j]$ \u7684\u503c\u6bd4\u8f83\u5c0f\u7684\u90a3\u4e9b\u4f4d\u7f6e\u3002\n\n\u8fd9\u8ba9\u6211\u4eec\u60f3\u5230\u4ece $dp[1]$ \u5230 $dp[n]$ \u4f9d\u6b21\u6c42\u51fa\uff0c\u7528\u6570\u636e\u7ed3\u6784\uff08\u7ebf\u6bb5\u6811/\u6811\u72b6\u6570\u7ec4\uff09\u5728 $pre[j]$ \u7684\u503c\u57df\u4e0a\u7ef4\u62a4\u3002\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u8bbe\u8be5\u6570\u636e\u7ed3\u6784\u4e3a $T$\uff0c$T[i]$ \u8868\u793a $T$ \u7ef4\u62a4\u7684\u7b2c $i$ \u4e2a\u4f4d\u7f6e\uff0c$T.\\max[l,r]$ \u8868\u793a $T$ \u4e2d $[l,r]$ \u4f4d\u7f6e\u7684\u6700\u5927\u503c\u3002\n\n\u6240\u4ee5\uff0c\u5148\u5bf9 $pre[0\\dots n]$ \u79bb\u6563\u5316\uff0c\u8bbe $v[i]$ \u8868\u793a $pre[i]$ \u79bb\u6563\u5316\u540e\u7684\u503c\u3002\n\n\u521d\u59cb\u5316\u65f6\uff0c\u5bf9\u4e8e\u4efb\u610f $i$\uff0c$T[i]=0$\u3002\n\n\u786e\u5b9a $dp[j]$ \u4e4b\u540e\uff0c\u6839\u636e\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u7684\u5f0f\u5b50 $dp[j]+i-j$\uff0c\u6211\u4eec\u53d1\u73b0 $dp[j]-j$ \u662f\u4e2a\u5173\u952e\u91cf\u3002\u5982\u679c\u8981\u628a\u67d0\u4e2a $dp[j]$ \u7ee7\u627f\u5230 $dp[i]$\uff0c\u53ea\u9700\u5728 $\\max(dp[j]-j)$ \u7684\u57fa\u7840\u4e0a\u52a0\u4e0a $i$ \u5373\u53ef\u3002\u56e0\u6b64\uff0c\u5c06 $T[v[j]]$ \u6539\u4e3a $\\max(T[v[j]],dp[j]+n-j)$\uff08\u52a0 $n$ \u662f\u4e3a\u4e86\u907f\u514d\u7ed3\u679c\u4e3a\u8d1f\u6570\uff09\u3002\n\n\u7531\u6b64\u5f97\u5230\u521d\u59cb\u6761\u4ef6\uff1a$dp[0]=0,T[v[0]]=n$\u3002\n\n\u7136\u540e\u662f\u6c42 $dp[i]$\u3002\n\n\u7531\u4e8e\u662f\u987a\u5e8f\u904d\u5386\uff0c\u5f53\u524d $T$ \u4e2d\u7684\u975e $0$ \u4f4d\u7f6e\u90fd\u662f\u5728\u904d\u5386\u5230 $i$ \u4e4b\u524d\u8d4b\u503c\u7684\uff0c\u56e0\u6b64\u6c42 $T.\\max$ \u80fd\u4fdd\u8bc1 $j<i$\u3002\n\n\u8981\u4fdd\u8bc1 $pre[j]\\leq pre[i]$\uff08\u5373 $v[j]\\leq v[i]$\uff09\uff0c\u53ea\u9700\u6c42 $T.\\max[1,v[i]]$ \u5373\u53ef\u3002\u5b83\u7684\u610f\u4e49\u662f\uff0c\u5728\u6ee1\u8db3 $v[j]\\leq v[i]$ \u7684\u524d\u63d0\u4e0b\uff0c\u6700\u5927\u7684 $dp[j]+n-j$\u3002\u4e3a\u4e86\u628a\u5f0f\u5b50\u8f6c\u5316\u6210 $dp[j]+i-j$\uff0c\u9700\u8981\u5728 $T.\\max[1,v[i]]$ \u7684\u57fa\u7840\u4e0a\u52a0\u4e0a $i-n$ \u3002\n\n\u6240\u4ee5\u8fd9\u5c31\u662f\u6838\u5fc3\u90e8\u5206\uff1a\n\n1. $dp[i]\\gets\\max(dp[i-1],T.\\max[1,v[i]]-n+i)$\n2. $T[v[i]]\\gets\\max(T[v[i]],dp[i]+n-i)$\n\n\u6ce8\u610f\u4e00\u70b9\uff0c\u5c31\u662f\u5f53 $pre[j]\\leq pre[i]$ \u4e0d\u5b58\u5728\u65f6\uff0c$T.\\max$ \u4f1a\u5f97\u5230 $0$\uff0c\u6240\u4ee5\u4e0d\u5f71\u54cd\u7ed3\u679c\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include <algorithm>\n#include <bitset>\n#include <cmath>\n#include <complex>\n#include <cstdio>\n#include <cstring>\n#include <ctime>\n#include <iostream>\n#include <list>\n#include <map>\n#include <queue>\n#include <random>\n#include <set>\n#include <stack>\n#include <string>\n#include <unordered_map>\n#include <unordered_set>\n#include <vector>\n#define ll long long\n#define lf double\n#define eps 1e-8\n#define inf (1ll << 60)\n#define pi 3.1415926535897932\n#define _pb push_back\n#define _mp make_pair\n#define _1 first\n#define _2 second\n#define MAX_N 324304\n\nusing namespace std;\n\nll read(){ll x=0;char c=0,v=1;while(c<'0'||c>'9'){c=getchar();if(c=='-')v=-1;}while(!(c<'0'||c>'9')){x=(x<<1)+(x<<3)+c-'0';c=getchar();}return x*v;}void write(ll p){if(p<0){putchar('-');write(-p);return;}if(p<10){putchar(p+'0');return;}write(p/10);putchar((p%10)+'0');}\nlf Read(){char c=0,v=1;lf x=0,u=1;while(48>c||57<c){c=getchar();if(c==45)v=-1;}while(47<c&&58>c){x=10.0*x+c-48.0;c=getchar();}if(c!='E'&&c!='e'&&c!='.')return v*x;else if(c=='.'){c=getchar();while(48>c||57<c)c=getchar();while(47<c&&58>c){x=10.0*x+c-48.0;c=getchar();u*=10;}}if(c!='E'&&c!='e')return v*x/u;ll y=0;lf e=1;char w=1;while(48>c||57<c){c=getchar();if(c==45)w=0;}while(47<c&&58>c){y=10*y+c-48;c=getchar();}if(w)while(y--)e*=10.0;else while(y--)e/=10.0;return v*x*e/u;}\nchar gtc(){char c;do c = getchar();while(c < 33);return c;}\n\ntemplate<size_t N, int s>\nstruct jnode // \u79bb\u6563\u5316\u7ed3\u6784\u4f53\n{\n    int n, m;\n    pair<ll, int> jv[N];\n    int ja[N];\n    ll jo[N];\n    jnode() { n = s; }\n    void insert(ll x) { jv[n] = _mp(x, n), n++; }\n    void rebuild()\n    {\n        sort(jv + s, jv + n);\n        for(int i = s; i < n; i++)\n            if(i == s || jv[i]._1 != jv[i - 1]._1)\n                jo[++m] = jv[i]._1, ja[jv[i]._2] = m;\n            else\n                ja[jv[i]._2] = m;\n    }\n    int operator [] (int x) { return ja[x]; }\n    ll operator () (int id) { return jo[id]; }\n    void upper_bound(ll x) { return upper_bound(jo + 1, jo + m + 1, x) - jo; }\n    void lower_bound(ll x) { return lower_bound(jo + 1, jo + m + 1, x) - jo; }\n}; // \u79bb\u6563\u5316\u7ed3\u6784\u4f53\n\ntemplate<size_t N>\nstruct BIT1mx // \u6811\u72b6\u6570\u7ec4\n{\n    ll t[N];\n    void update(int x, ll k) // T[x] = max(T[x], k);\n    {\n        for( ; x < N; x += (x & -x))\n            t[x] = max(t[x], k);\n    }\n\n    ll query(int x) // max(T[1...x])\n    {\n        ll ans = 0;\n        for( ; x; x -= (x & -x))\n            ans = max(ans, t[x]);\n        return ans;\n    }\n}; // \u6811\u72b6\u6570\u7ec4\n\njnode<MAX_N, 0> jc; // \u79bb\u6563\u5316\uff1ajc[i] \u8868\u793apre[i]\u79bb\u6563\u5316\u540e\u7684\u7ed3\u679c\uff0c\u5373 v[i]\nBIT1mx<MAX_N> t;\nint n;\nll a[MAX_N], dp[MAX_N];\n\nvoid MAIN()\n{\n    n = read();\n    jc.insert(0);\n    for(int i = 1; i <= n; i++)\n        jc.insert(a[i] = a[i - 1] + read()); // \u8ba1\u7b97\u524d\u7f00\u548c\u5e76\u52a0\u5165\u79bb\u6563\u5316\u7ed3\u6784\u4f53\n    jc.rebuild();\n    dp[0] = 0; // \u521d\u59cb\u5316 dp[0]\n    t.update(jc[0], n); // \u5c06 T[v[0]] \u8d4b\u503c\u4e3a n\n    for(int i = 1; i <= n; i++) // \u987a\u5e8f\u904d\u5386\u6c42 dp \u503c\n    {\n        dp[i] = max(dp[i - 1], t.query(jc[i]) - n + i);\n        t.update(jc[i], dp[i] + n - i);\n    }\n    printf(\"%lld\\n\", dp[n]);\n}\n\nvoid CLEAR()\n{\n    ;\n}\n\nvoid EXPERIMENT()\n{\n    ;\n}\n\nint main()\n{\n    //freopen(\"a.in\", \"r\", stdin);\n    //freopen(\"a.out\", \"w\", stdout);\n    EXPERIMENT();\n    int T = 1;\n    while(T--)\n    {\n        MAIN();\n        CLEAR();\n    }\n    return 0;\n}\n```",
        "postTime": 1676464926,
        "uid": 315448,
        "name": "whdywjd",
        "ccfLevel": 7,
        "title": "CF1788E\u9898\u89e3"
    }
]