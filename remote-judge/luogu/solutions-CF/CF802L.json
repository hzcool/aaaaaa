[
    {
        "content": ">\u7ed9\u5b9a\u4e00\u68f5\u6709\u8fb9\u6743\u7684\u6811\u6c42\u4ece$1$\u51fa\u53d1\u968f\u673a\u904d\u5386\u5230\u53f6\u5b50\u7ed3\u70b9\u7684\u671f\u671b\u8ddd\u79bb\n\n$\\displaystyle f_x=\\frac{f_{fa_x}+v_{x,fa_x}+\\sum\\limits_{y}(f_y+v_{x,y})}{deg_x}$\n\n\u8bbe$out_x$\u8868\u793a$x$\u51fa\u8fb9\u4e4b\u548c\n\n\u5219$\\displaystyle f_x=\\frac{f_{fa_x}+\\sum\\limits_{y}f_y+out_x}{deg_x}$\n\n\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u662f\u81ea\u5df1\u5305\u542b\u81ea\u5df1\u7684\u6240\u4ee5\u8981\u9ad8\u65af\u6d88\u5143\n\n\u4f46\u662f\u7ecf\u5386\u8fc7\u968f\u673a\u6e38\u8d70\u90a3\u9898\u6211\u4eec\u4f1a\u77e5\u9053\u6811\u4e0a\u8fd9\u7c7b$dp$\u7684\u901a\u7528\u6280\u5de7\u662f$f_x$\u4e00\u5b9a\u80fd\u8868\u793a\u4e3a$f_{fa_x}$\u7684\u4e00\u6b21\u51fd\u6570\n\n\u4e8e\u662f\u8bbe$f_{x}=k_xf_{fa_x}+b_x$\n\n\u5219\n$$\n\\begin{aligned}\nf_x&=\\frac{f_{fa_x}+\\sum\\limits_{y}f_y+out_x}{deg_x}\n\\\\&=\\frac{f_{fa_x}+\\sum\\limits_{y}(k_yf_x+b_y)+out_x}{deg_x}\n\\\\&=\\frac{f_{fa_x}+sk_x f_x+sb_x+out_x}{deg_x}\n\\end{aligned}\n$$\n\u6240\u4ee5\u6709\n$$\n\\begin{aligned}\ndeg_xf_x=f_{fa_x}+sk_x f_x+sb_x+out_x\n\\\\\\Leftrightarrow (deg_x-sk_y)f_x=f_{fa_x}+sb_x+out_x\n\\\\\\Leftrightarrow f_x=\\frac{1}{deg_x-sk_y}f_{fa_x}+\\frac{sb_x+out_x}{deg_x-sk_y}\n\\end{aligned}\n$$\n$$\\therefore \\begin{cases}k_x=\\frac{1}{deg_x-sk_y}\\\\b_x=\\frac{sb_x+out_x}{deg_x-sk_y}\\end{cases}$$\n\n\u53ef\u4ee5\u8f7b\u6613\u53d1\u73b0\u5f53\u6211\u4eec\u7b97\u51fa\u6bcf\u4e2a\u70b9$k/b$\u540e\u7b2c\u4e00\u4e2a\u5b9a\u4e0b\u6765\u7684\u503c\u5c31\u662f$f_{rt}=b_{rt}$\n\n\u672c\u9898\u5e76\u4e0d\u8981\u6c42\u4f46\u5982\u679c\u8981\u6c42\u5176\u4ed6\u70b9\u53cd\u63a8\u5373\u53ef\n\n```cpp\n#include<bits/stdc++.h>\n#define N 100001 \n#define mod 1000000007\nusing namespace std;\n#define G if(++ip==ie)if(fread(ip=ibuf,1,L,stdin))\nconst int L=1<<19;\nchar ibuf[L],*ie=ibuf+L,*ip=ie-1;\ninline char nc(void){G;return *ip;}\n#define getchar nc\ninline int read(void){\n\tchar opt;int flag=1,res=0;\n\twhile((opt=getchar())<'0')if(opt=='-')flag=-1;\n\twhile(opt>='0'){res=(res<<3)+(res<<1)+opt-'0';opt=getchar();}\n\treturn res*flag;\n}\nint n,f[N],b[N],k[N];\nstruct Edge{int to,v;};\nvector<Edge>g[N];\ninline int Mod(int x){return x>=mod?x-mod:x;}\ninline int qpow(int a,int b){int res=1;while(b){if(b&1)res=1ll*res*a%mod;a=1ll*a*a%mod;b>>=1;}return res;}\ninline void dfs(int x,int prt){\n\tint y,div=0;if(g[x].size()==1u)return k[x]=0,void();k[x]=1; \n\tfor(auto t:g[x]){if((y=t.to)^prt)dfs(y,x),div=Mod(div+k[y]),b[x]=Mod(b[x]+b[y]);b[x]=Mod(b[x]+t.v);}//b_x\u539f\u6765\u8868\u793asb_x+out_x\n\tdiv=qpow(Mod(g[x].size()-div+mod),mod-2);//1/(deg_x-sk_x)\n\tk[x]=1ll*k[x]*div%mod;b[x]=1ll*b[x]*div%mod;\n}\nsigned main(void){\n\tn=read();\n\tint i,x,y,z;for(i=1;i<n;++i)x=read()+1,y=read()+1,z=read(),g[x].push_back({y,z}),g[y].push_back({x,z});\n\tdfs(1,0);printf(\"%d\\n\",b[1]);\n\treturn 0;\n}\n\n```",
        "postTime": 1599920095,
        "uid": 40629,
        "name": "zzw4257",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF802L \u3010Send the Fool Further! (hard)\u3011"
    },
    {
        "content": "\u63a8\u8350 **[\u535a\u5ba2](https://blog.csdn.net/YunYuanWang/article/details/126042175?spm=1001.2014.3001.5501)** \u5185\u98df\u7528\u66f4\u4f73\n\n\u9898\u9762\u81ea\u5df1\u53bb\u770b\n\n\u539f\u7248\u9898\u9762\uff1a[CF802L](https://www.codeforces.com/contest/802/problem/L)\n\n\u6d1b\u8c37\u4e2d\u6587\u9898\u9762\uff1a[CF802L](https://www.luogu.com.cn/problem/CF802L)\n\n# \u72b6\u6001\u8bbe\u8ba1\n\u6211\u4eec\u4ee4 $f[i]$ \u8868\u793a\u4ece $i$ \u53f7\u8282\u70b9\u5f00\u59cb**\u5230\u8fbe\u53f6\u5b50\u8282\u70b9**\u7684\u671f\u671b\u8ddd\u79bb\u3002\n\u5f53\u7136\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u5bf9\u4e8e\u53f6\u5b50\u8282\u70b9\u6709 $f[leaf] = 0$\u3002\n\n# \u66b4\u529b\u505a\u6cd5\n\u663e\u7136\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9 $x$ \u6211\u4eec\u90fd\u6709\u4ee5\u4e0b\u8f6c\u79fb\u65b9\u7a0b ( \u4ee5\u4e0b\u65b9\u7a0b\u4e2d\u4f1a\u4ee5\u4e0b\u6807\u548c\u4e2d\u62ec\u53f7\u4e24\u79cd\u5f62\u5f0f\u8868\u793a\u6570\u7ec4\u6216\u51fd\u6570\u503c\u4ee5\u4f53\u73b0\u66f4\u6e05\u6670\u7684\u5c42\u6b21 ) \uff1a\n$$f[x] = \\sum_{y \\in \\{\\{son_x\\},\\; fa_x\\}}\\frac{f[y]+dis_{x,\\;y}}{deg[x]}$$\n\u901a\u8fc7\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u4e2d\u5305\u542b\u4e86\u672a\u77e5\u91cf $f[fa_x]$\u3002\u4f46\u6bcf\u4e2a\u70b9\u90fd\u6784\u6210\u8fd9\u6837\u7684\u4e00\u4e2a\u65b9\u7a0b\uff0c\u4e8e\u662f\u6211\u4eec\u6709 $n$ \u4e2a\u672a\u77e5\u91cf\u548c $n$ \u4e2a\u65b9\u7a0b\uff0c\u6240\u4ee5\u6211\u4eec\u60f3\u5230\u7528**\u9ad8\u65af\u6d88\u5143**\u6765\u6c42\u89e3\uff0c\u6700\u7ec8 $f[1]$ \u5c31\u662f\u7b54\u6848\u3002\n\n# \u94b3\u5236\u829d\u58eb\n\u9996\u5148\u5fc5\u987b\u660e\u786e\u4e00\u70b9\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u8282\u70b9 $x$ \u90fd\u6709\u4e00\u4e2a\u5173\u4e8e\u81ea\u5df1\u7236\u4eb2\u7684\u4e00\u6b21\u51fd\u6570\u8868\u8fbe\u5f62\u5f0f:\n$$f[x] = k_x \\times f[fa_x] + b_x$$\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u561b\uff0c\u4f60\u81ea\u5df1\u753b\u68f5\u6811\u81ea\u5df1\u624b\u63a8\u4e24\u4e2a\u4f60\u5c31\u77e5\u9053\u4e86\u3002\n\n# \u65b9\u7a0b\u63a8\u5bfc\n\u6211\u4eec\u6ce8\u610f\u5230\u6bcf\u4e2a\u8282\u70b9 $x$ \u7684\u65b9\u7a0b\u4e2d\u53ea\u6709\u4e00\u4e2a\u672a\u77e5\u91cf ( \u9664\u53bb\u4ed6\u81ea\u5df1 ) \u4e5f\u5c31\u662f $f[fa_x]$\uff0c\u4e8e\u662f\u6211\u4eec\u6709\u4e86\u4ee5\u4e0b\u63a8\u5bfc ( ~~\u8fd9\u53e5\u8bdd\u6211\u4e71\u80e1\u7684\uff0c\u770b\u4e0d\u61c2\u53ef\u4ee5\u76f4\u63a5\u770b\u4e0b\u9762\u7684\u63a8\u5bfc~~ )\uff1a\n\n\u9996\u5148\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u5f0f\u5b50\u4e2d\u8282\u70b9 $x$ \u7684\u513f\u5b50\u90e8\u5206\u548c\u7236\u4eb2\u90e8\u5206\u5206\u5f00\uff1a\n$$f[x] = \\sum_{y \\in \\{son_x\\}}\\frac{f[y]+dis_{x,\\;y}}{deg[x]} + \\frac{f[fa_x]+dis_{fa_x,\\;x}}{deg[x]}$$ \n$$=\\frac{\\sum_{y \\in \\{son_x\\}} (f[y]+dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x})}{deg[x]}$$\n\n\u7136\u540e\u6211\u4eec\u79fb\u9879\uff0c\u628a $deg[x]$ \u4e58\u5230\u5de6\u8fb9\u53bb\uff1a\n$$f[x] \\times deg[x] = \\sum_{y \\in \\{son_x\\}} (f[y]+dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x})$$\n\n\u7136\u540e\u6211\u4eec\u5c06 $f[x] = k_x \\times f[fa_x] + b_x$ \u4ee3\u5165\u5230\u4e0a\u5f0f\u7684 $f[y]$ \u4e0a\u53bb\u5f97\u5230\uff1a\n$$f[x] \\times deg[x] = \\sum_{y \\in \\{son_x\\}} (k_y * f[x]+ b_y + dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x})$$\n\n\u518d\u5c06 $Sigma$ \u4e2d\u7684\u4e1c\u897f\u62c6\u5f00\u5f97\uff1a\n$$f[x] \\times deg[x] = \\sum_{y \\in \\{son_x\\}} k_y * f[x ] + \\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x})$$\n\n\u518d\u628a\u4e0e $f[x]$ \u6709\u5173\u7684\u5f0f\u5b50\u5168\u90e8\u6254\u5230\u5de6\u8fb9\u53bb\u5f97\uff1a\n$$f[x] \\times deg[x] - \\sum_{y \\in \\{son_x\\}} k_y * f[x ] = \\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x})$$\n$$\\implies f[x] \\times deg[x] - f[x] * \\sum_{y \\in \\{son_x\\}} k_y = \\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x}) $$\n$$\\implies f[x] \\times (deg[x] - \\sum_{y \\in \\{son_x\\}} k_y) = \\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x}) $$\n\n\u7136\u540e\u518d\u79fb\u9879\u628a\u5de6\u8fb9\u7684 $deg[x] - \\sum_{y \\in \\{son_x\\}} k_y$ \u9664\u5230\u53f3\u8fb9\u53bb\uff1a\n$$f[x] = \\frac{\\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;(f[fa_x]+dis_{fa_x,\\;x})}{deg[x] - \\sum_{y \\in \\{son_x\\}} k_y} $$\n\n\u6700\u540e\u628a\u5f0f\u5b50\u6574\u7406\u6210 $f[x] = k_x \\times f[fa_x] + b_x$ \u7684\u5f62\u5f0f\uff1a\n$$f[x] = \\frac{1}{deg[x] - \\sum_{y \\in \\{son_x\\}} k_y} \\times f[fa_x] + \\frac{\\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;dis_{fa_x,\\;x}}{deg[x] - \\sum_{y \\in \\{son_x\\}} k_y} $$\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u9012\u63a8\u5f0f\uff1a\n$$k_x = \\frac{1}{deg[x] - \\sum_{y \\in \\{son_x\\}} k_y}$$\n$$b_x = \\frac{\\sum_{y \\in \\{son_x\\}} (b_y +dis_{x,\\;y}) \\;+ \\;dis_{fa_x,\\;x}}{deg[x] - \\sum_{y \\in \\{son_x\\}} k_y} $$\n\n\u6700\u540e\u7531\u4e8e \u6839\u8282\u70b9 1 \u53f7\u8282\u70b9\u6ca1\u6709\u7236\u4eb2\uff0c\u4e5f\u5c31\u662f\u8bf4 $f[1] = b[1]$\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5728 dfs \u65f6\u9012\u5f52\u6c42\u89e3 $k_x$ \u548c $b_x$ \u5373\u53ef ( $b_x$ \u7684\u65b9\u7a0b\u4e2d\u542b\u6709 $k_y$ \uff0c\u6240\u4ee5\u4e24\u4e2a\u90fd\u9700\u8981\u8ba1\u7b97)\uff0c\u800c\u4e0d\u9700\u8981\u5355\u72ec\u8ba1\u7b97 $f_x$\u3002\n\n# \u6ce8\u610f\n\u539f\u9898\u4e2d\u7684\u6807\u70b9\u662f\u4ece 0 \u5f00\u59cb\u7684\uff01\uff01\uff01(~~\u4ec0\u4e48\u6076\u5fc3\u4e1c\u897f~~)\n\n# dfs \u90e8\u5206\u5173\u952e\u4ee3\u7801\n```cpp\nvoid dfs(int x, int fa)\n{\n\tif(deg[x] == 1 && x != 1) {\n\t\tk[x] = b[x] = 0;\n\t\treturn ;\n\t}\n\t\n\tint sumk = 0;\n\tfor(int i = e.hd[x]; i; i = e.nxt[i]) {\n\t\tint y = e.to[i], z = e.w[i];\n\t\tif(y == fa) {\n\t\t\tb[x] = pls(b[x], z);\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\tdfs(y, x);\n\t\tb[x] = pls(b[x], b[y]);//\u8fd9\u91cc\u662f\u52a0\u540c\u65f6\u53d6\u6a21\u64cd\u4f5c\n\t\tb[x] = pls(b[x], z);\n\t\tsumk = pls(sumk, k[y]);\n\t}\n\t\n\tk[x] = qpow(dec(deg[x], sumk), MOD - 2);\n\tb[x] = mul(b[x], k[x]);//\u540c\u7406\n}\n```\n# \u5b8c\u6574\u4ee3\u7801\n```cpp\n//\u7701\u53bb\u5934\u6587\u4ef6\u548c\u5feb\u8bfb\n\nint n;\nstruct Edge {\n\tint hd[MAXN];\n\tint nxt[MAXN << 1], to[MAXN << 1];\n\tint w[MAXN << 1];\n\tint tot = 0;\n\t\n\tvoid Add(int x, int y, int z) {\n\t\tnxt[++tot] = hd[x];\n\t\thd[x] = tot;\n\t\tto[tot] = y;\n\t\tw[tot] = z;\n\t}\n}e;\nint deg[MAXN];\n\n//------------\u4ee5\u4e0b\u662f\u4e00\u7cfb\u5217\u7684\u53d6\u6a21\u64cd\u4f5c------------\nint pls(int x, int y)\n{\n\tif(x + y >= MOD)\n\t\treturn x + y - MOD;\n\telse\n\t\treturn x + y;\n}\nint dec(int x, int y) \n{\n\tif(x - y < 0)\n\t\treturn x - y + MOD;\n\telse\n\t\treturn x - y;\n}\nint mul(int x, int y) \n{\n\tif(1ll * x * y >= 1ll * MOD)\n\t\treturn 1ll * x * y % MOD;\n\telse\n\t\treturn x * y;\n}\nint qpow(int x, int y)\n{\n\tint val = 1;\n\twhile(y) {\n\t\tif(y & 1)\n\t\t\tval = mul(val, x);\n\t\t\n\t\tx = mul(x, x);\n\t\ty >>= 1;\n\t}\n\treturn val;\n}\n//------------\u4ee5\u4e0a\u662f\u4e00\u7cfb\u5217\u7684\u53d6\u6a21\u64cd\u4f5c------------\n\nint k[MAXN], b[MAXN];\nvoid dfs(int x, int fa)\n{\n\tif(deg[x] == 1 && x != 1) {\n\t\tk[x] = b[x] = 0;\n\t\treturn ;\n\t}\n\t\n\tint sumk = 0;\n\tfor(int i = e.hd[x]; i; i = e.nxt[i]) {\n\t\tint y = e.to[i], z = e.w[i];\n\t\tif(y == fa) {\n\t\t\tb[x] = pls(b[x], z);\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\tdfs(y, x);\n\t\tb[x] = pls(b[x], b[y]);\n\t\tb[x] = pls(b[x], z);\n\t\tsumk = pls(sumk, k[y]);\n\t}\n\t\n\tk[x] = qpow(dec(deg[x], sumk), MOD - 2);//\u6ce8\u610f\u8981\u53d6\u9006\u5143\n\tb[x] = mul(b[x], k[x]);\n}\n\nint main()\n{\n\tn = inpt();\n\tfor(int i = 1; i < n; i++) {\n\t\tint x = inpt() + 1, y = inpt() + 1, z = inpt();\n\t\t\n\t\te.Add(x, y, z);\n\t\te.Add(y, x, z);\n\t\tdeg[x]++, deg[y]++;\n\t}//\u5bf9\u4e8e\u6240\u6709\u8282\u70b9\u90fd\u53ef\u4ee5\u5f0f\u5b50\u5316\u4e3af[x] = k[x] * f[fa] + b[x]\n\t\n\tdfs(1, 0);\n\t\n\tprintf(\"%d\", b[1]);//\u56e0\u4e3a\u6839\u8282\u70b9\u6ca1\u6709\u7236\u4eb2\uff0c\u6240\u4ee5 f[1] = b[1] \n\t\n\treturn 0;\n}\n\n```\n\n\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\uff0c\u524d\u9762\u7684\u516c\u5f0f\u6216\u8bb8\u6709\u4e9b\u773c\u82b1\u7f2d\u4e71\uff0c\u8fd8\u8bf7\u8bf8\u4f4d\u5de8\u4f6c\u8c05\u89e3QwQ",
        "postTime": 1659010999,
        "uid": 164883,
        "name": "Zigh_Wang",
        "ccfLevel": 0,
        "title": "CF802L Send the Fool Further! (hard) \u9898\u89e3"
    }
]