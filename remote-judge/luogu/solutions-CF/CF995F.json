[
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u4f60\u8981\u7ed9\u6bcf\u4e2a\u70b9\u5b9a\u4e00\u4e2a $[1,D]$ \u7684\u6743\u503c\uff0c\u6ee1\u8db3\u6bcf\u4e2a\u70b9\u6743\u503c\u4e0d\u5927\u4e8e\u7236\u4eb2\u3002\u95ee\u6709\u591a\u5c11\u79cd\u65b9\u6848\uff0c\u7b54\u6848\u6a21 $10^9+7$ \u3002\n\n## \u9898\u89e3\n\n\u7531\u4e8e\u6211\u592a\u83dc\u4e0d\u4f1a\u63d2\u503c\uff0c\u53ea\u597d\u7528\u5bb9\u65a5\u6765\u505a\u4e86\u3002\n\n\u6211\u4eec\u8003\u8651\u4e00\u4e2a$DP$\uff0c\u7528 $ f_{i,j} $ \u8868\u793a\u5728\u8282\u70b9 $i$ \u7684\u5b50\u6811\u4e2d\uff0c\u4ee4\u8282\u70b9 $i$ \u7684\u6743\u503c\u4e3a $j$ \u7684\u5408\u6cd5\u65b9\u6848\u6570\u3002\u8bb0 $s_{i,j} = \\sum_{k=1}^j f_{i,k}$ \uff0c\u7531\u4e8e\u4e0d\u540c\u5b50\u6811\u4e4b\u95f4\u4e92\u76f8\u72ec\u7acb\uff0c\u5f88\u5bb9\u6613\u5bfc\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$f_{i,j} = \\prod_{fa_v = i} s[v][j]$$\n\n\u4f46\u662f\uff0c\u7531\u4e8e $d \\leq 10^9$ \uff0c\u76f4\u63a5\u4e0a\u8fd9\u79cd\u505a\u6cd5\u662f\u80af\u5b9a\u4e0d\u884c\u7684\u3002\u89c2\u5bdf\u53d1\u73b0\uff0c\u9898\u76ee\u4e2d $n \\leq 3000$ \uff0c\u76f8\u6bd4\u4e4b\u4e0b\u7279\u522b\u5c0f\uff0c\u6240\u4ee5\u8003\u8651\u8f6c\u6362\u4e00\u79cd\u601d\u8def\u3002\u5b9e\u9645\u4e0a\uff0c\u603b\u5171\u53ea\u4f1a\u6709\u81f3\u591a $n$ \u79cd\u672c\u8d28\u4e0d\u540c\u7684\u6743\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u4eec\u79bb\u6563\u5316\uff0c\u7136\u540e\u518d\u8ba1\u7b97 $f_{i,j}$ \u3002\u6b64\u65f6\uff0c $f_{i,j}$ \u4e2d $j$ \u7684\u610f\u4e49\u5c31\u53d8\u4e3a\u8282\u70b9 $i$ \u7684\u6743\u503c\u4e3a\u79bb\u6563\u5316\u4e4b\u540e\u7684\u7b2c $j$ \u5927\u7684\u6743\u503c\u3002\n\n\u8ba1\u7b97\u51fa $f_{i,j}$ \u4e4b\u540e\uff0c\u4e0b\u4e00\u6b65\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u7b54\u6848\u3002\u79bb\u6563\u5316\u4e4b\u540e\uff0c\u6211\u4eec\u5e94\u8be5\u8ba1\u7b97\u51fa\u6070\u597d\u7528\u4e86 $i$ \u79cd\u6743\u503c\u7684\u65b9\u6848\uff0c\u8bb0\u4e3a $g_i$ \u3002\u663e\u7136\uff0c\u76f4\u63a5\u7edf\u8ba1\u4f1a\u5bfc\u81f4\u91cd\u590d\u8ba1\u6570\uff0c\u4f8b\u5982\u6837\u4f8b\u4e00\u4e2d\u7684 $(2,2,2)$ \u5c31\u4f1a\u88ab\u540c\u65f6\u8ba1\u5165 $g_1$ \u4e0e $g_2$ \u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5bb9\u65a5\u3002\n\n\u7531\u5b9a\u4e49\u53ef\u77e5\uff0c $f_{1,i}$ \u6307\u6700\u5927\u6743\u503c\u4e3a $i$ \u7684\u65b9\u6848\u6570\uff0c\u5b8c\u5168\u5305\u542b\u4e86 $g_i$ \u3002\u6240\u4ee5\uff0c $g_i$ \u4e2d\u6211\u4eec\u8981\u5220\u53bb\u7684\u4e0d\u5408\u6cd5\u65b9\u6848\u4e00\u5b9a\u662f\u5305\u542b\u6743\u503c $i$ \u7684\u4e00\u4e9b\u65b9\u6848\uff0c\u5176\u6743\u503c\u79cd\u6570\u5c0f\u4e8e $i$ \u3002\u8003\u8651\u6743\u503c\u79cd\u6570\u6070\u4e3a $j$ \u7684\u65b9\u6848\u6570 $g_j$ \uff0c\u5219\u5b83\u7684\u8d21\u732e\u4e3a $g_i \\times C_{i-1}^{i-j}$ \u3002  \n\u5176\u4e2d\uff0c\u7cfb\u6570 $C_{i-1}^{j-1}$ \u8868\u793a\u9664\u4e86\u6743\u503c $i$ \u5fc5\u987b\u9009\u4e2d\u4e4b\u5916\uff0c\u4f59\u4e0b\u7684 $i-1$ \u79cd\u6743\u503c\u4e2d\u9009\u51fa $j-1$ \u79cd\u6743\u503c\uff0c\u7ec4\u6210\u4e00\u79cd\u6743\u503c\u79cd\u6570\u6070\u4e3a $j$ \u7684\u6743\u503c\u9009\u53d6\u65b9\u6848\u7684\u65b9\u6848\u6570\u3002\u4e5f\u5c31\u662f\uff0c\u5bf9\u4e8e $g_j$ \u6240\u5305\u542b\u7684\u6240\u6709\u65b9\u6848\u6570\uff0c\u5b83\u4eec\u90fd\u5c06\u5728 $f_{1,i}$ \u4e2d\u51fa\u73b0 $C_{i-1}^{j-1}$ \u6b21\u3002\n\n\u63a5\u7740\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u63a8\u51fa\u6700\u7ec8\u7684\u5bb9\u65a5\u65b9\u7a0b\u548c\u7b54\u6848\uff1a\n$$g_i = f_{1,i} - \\sum_{j=1}^{i-1} C_{i-1}^{i-j} \\times g_j$$\n$$Ans = \\sum_{i=1}^{\\min(n,d)} C_{d}^{i} \\times g_i$$\n\u8fd9\u91cc\uff0c\u7531\u4e8e $i$ \u8fdc\u5c0f\u4e8e $d$ \uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u8ba1\u7b97 $C_{d}^{i}$ \uff0c\u5f97\u51fa\u7b54\u6848\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define reg register\ntypedef long long ll;\nusing namespace std;\nconst int MN=3005;\nconst int mod=1e9+7;\nint to[MN],nxt[MN],h[MN],cnt;\ninline void ins(int s,int t){\n    to[++cnt]=t;nxt[cnt]=h[s];h[s]=cnt;\n}\nint n,m,f[MN][MN],s[MN][MN],g[MN],C[MN][MN],inv[MN];\nvoid dfs(int st){\n    for(reg int i=h[st];i;i=nxt[i]){\n        dfs(to[i]);\n        for(reg int j=1;j<=n;j++)\n            f[st][j]=1ll*f[st][j]*s[to[i]][j]%mod;\n    }\n    for(reg int i=1;i<=n;i++)\n        s[st][i]=(s[st][i-1]+f[st][i])%mod;\n}\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    for(reg int i=2,x;i<=n;i++)scanf(\"%d\",&x),ins(x,i);\n    for(reg int i=1;i<=n;i++)for(reg int j=1;j<=n;j++)f[i][j]=1;\n    dfs(1);C[0][0]=C[1][0]=C[1][1]=1;\n    for(reg int i=2;i<=n;i++){\n        C[i][0]=1;\n        for(reg int j=1;j<=i;j++)\n            C[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n    }\n    inv[0]=inv[1]=1;\n    for(reg int i=2;i<=n;i++)inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n    for(reg int i=2;i<=n;i++)inv[i]=1ll*inv[i-1]*inv[i]%mod;\n    for(reg int i=1;i<=n;i++){\n        g[i]=f[1][i];\n        for(reg int j=1;j<i;j++)\n            g[i]=(g[i]-1ll*C[i-1][i-j]*g[j]%mod+mod)%mod;\n    }\n    reg int Ans=0;\n    for(reg int i=1;i<=min(n,m);i++){\n        reg int Res=inv[i];\n        for(reg int j=m-i+1;j<=m;j++)Res=1ll*Res*j%mod;\n        Ans=(Ans+1ll*Res*g[i]%mod)%mod;\n    }\n    printf(\"%d\\n\",Ans);\n    return 0;\n}\n```",
        "postTime": 1561219957,
        "uid": 17930,
        "name": "Marser",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF995F \u3010Cowmpany Cowmpensation\u3011"
    },
    {
        "content": "### \u9898\u610f\u7b80\u8ff0\n\n&emsp;&emsp;[link](https://www.luogu.com.cn/problem/CF995F).\n\n&emsp;&emsp;\u7ed9\u5b9a\u4e00\u68f5 $n$ \u4e2a\u7ed3\u70b9\u7684\u6709\u6839\u6811\uff0c\u7528 $[1,d]$ \u4e3a\u6bcf\u4e2a\u7ed3\u70b9\u67d3\u8272\uff0c\u8981\u6c42\u5b50\u7ed3\u70b9\u989c\u8272\u4e0d\u5927\u4e8e\u7236\u8282\u70b9\u989c\u8272\uff0c\u6c42\u65b9\u6848\u6570\u3002\u5bf9\u5927\u7d20\u6570\u53d6\u6a21\u3002\n\n### \u6570\u636e\u89c4\u6a21\n\n&emsp;&emsp;$n\\le3000;~d\\le10^9$\u3002\n\n### Solution\n\n#### Step 1\n\n&emsp;&emsp;\u6211\u4eec\u8fd8\u662f\u5148\u5217\u51fa\u4e00\u4e2a\u66b4\u529b\u7684 DP\u3002\u4ee4 $f(u,i)$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u7528 $[1,i]$ \u67d3\u8272\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u663e\u7136\u6709\uff1a\n$$\nf(u,i)=f(u,i-1)+\\prod_{v\\in son_u}f(v,i)\n$$\n&emsp;&emsp;\u76f4\u63a5 DP\uff0c\u590d\u6742\u5ea6 $O(nd)$\uff0c\u4e0d\u53ef\u8fc7\u3002\n\n#### Step 2\n\n&emsp;&emsp;~~\u5927\u58f0\u8bf4\u51fa\u4f60\u7684\u731c\u60f3\uff01~~  \n\n&emsp;&emsp;Bingo\uff01**\u8bbe $u$ \u7684\u5b50\u6811\u5927\u5c0f\u4e3a $s_u$\uff0c\u5219 $f(u,x)$ \u662f\u5173\u4e8e $x$ \u7684 $s_u$ \u6b21\u51fd\u6570**\u3002\n\n##### \u8bc1\u660e\n\n&emsp;&emsp;\u4ecd\u8003\u8651\u5f52\u7eb3\uff1a\n\n- $1).$ \u5f53 $u$ \u4e3a\u53f6\u5b50\u7ed3\u70b9\u65f6\uff0c$f(u,x)=1$\uff0c\u6210\u7acb\u3002\n\n- $2).$ \u5f53 $v\\in son_u$  \u65f6\u6210\u7acb\uff0c\u8003\u8651 $u$\uff1a\n    $$\n    f(u,x)-f(u,x-1)=\\prod_{v\\in son_u}f(v,x)\n    $$\n    &emsp;&emsp;\u7531\u4e8e $v$ \u6ee1\u8db3\u7ed3\u8bba\uff0c\u5373 $f(v,x)$ \u7684\u6b21\u6570\u4e3a $s_v$\uff0c\u5219 $f(u,x)-f(u,x-1)$ \u7684\u6b21\u6570\u4e3a $\\sum_{v\\in son_u}s_v$\uff0c\u5373 $s_u-1$\u3002\u518d\u8fd8\u539f\u5dee\u5206\uff0c\u6b21\u6570 $+1$\uff0c\u6709 $f(u,x)$ \u662f\u5173\u4e8e $x$ \u7684 $s_u-1+1=s_u$ \u6b21\u51fd\u6570\u3002\n\n    &emsp;&emsp;\u7531 $1).~2).$ \u8bc1\u6bd5\u3002\n\n    \n\n&emsp;&emsp;\u6240\u4ee5\uff0c\u53ea\u9700\u8981\u5904\u7406\u51fa $f(u,1..n)$\uff0c\u6700\u540e\u5229\u7528 $\\left(x,f(1,x)\\right)~(x\\in[0,n])$ \u6c42\u51fa $f(1,x)$ \u7684\u66f2\u7ebf\u65b9\u7a0b\uff0c\u518d\u4ee3\u5165 $d$ \u5373\u53ef\u3002\n\n&emsp;&emsp;\u8fde\u7eed\u63d2\u503c\u90e8\u5206\u53ef\u4ee5\u4f18\u5316\u5230 $O(n)$\uff0c\u4e0d\u8fc7\u8fd9\u5e76\u4e0d\u662f\u552f\u4e00\u7684\u74f6\u9888\u590d\u6742\u5ea6\u3002\u6700\u7ec8\u590d\u6742\u5ea6\u4ecd\u662f $O(n^2)$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n\nconst int MAXN = 3000, MOD = 1e9 + 7;\nint n, d, ecnt, head[MAXN + 5], x[MAXN + 5], f[MAXN + 5][MAXN + 5];\n\nstruct Edge { int to, nxt; } graph[MAXN + 5];\n\ninline int qkpow ( int a, int b, const int p = MOD ) {\n\tint ret = 1;\n\tfor ( ; b; a = 1ll * a * a % p, b >>= 1 ) ret = 1ll * ret * ( b & 1 ? a : 1 ) % p;\n\treturn ret;\n}\n\ninline int lagrange ( const int n, const int* x, const int* y, const int k ) {\n\tint ret = 0;\n\tfor ( int i = 1; i <= n; ++ i ) {\n\t\tint num = y[i], den = 1;\n\t\tfor ( int j = 1; j <= n; ++ j ) {\n\t\t\tif ( i ^ j ) {\n\t\t\t\tnum = 1ll * num * ( k - x[j] + MOD ) % MOD;\n\t\t\t\tden = 1ll * den * ( x[i] - x[j] + MOD ) % MOD;\n\t\t\t}\n\t\t}\n\t\tret = ( ret + 1ll * num * qkpow ( den, MOD - 2 ) ) % MOD;\n\t}\n\treturn ret;\n}\n\ninline void link ( const int s, const int t ) { graph[++ ecnt] = { t, head[s] }, head[s] = ecnt; }\n\ninline void DFS ( const int u ) {\n\tfor ( int i = 1; i <= n; ++ i ) f[u][i] = 1;\n\tfor ( int i = head[u], v; i; i = graph[i].nxt ) {\n\t\tDFS ( v = graph[i].to );\n\t\tfor ( int j = 1; j <= n; ++ j ) f[u][j] = 1ll * f[u][j] * f[v][j] % MOD;\n\t}\n\tfor ( int i = 2; i <= n; ++ i ) f[u][i] = ( f[u][i] + f[u][i - 1] ) % MOD;\n}\n\nint main () {\n\tscanf ( \"%d %d\", &n, &d );\n\tfor ( int i = 1; i <= n; ++ i ) x[i] = i;\n\tfor ( int i = 2, f; i <= n; ++ i ) scanf ( \"%d\", &f ), link ( f, i );\n\tprintf ( \"%d\\n\", ( DFS ( 1 ), d <= n ? f[1][d] : lagrange ( n + 1, x - 1, f[1] - 1, d ) ) );\n\treturn 0;\n}\n```",
        "postTime": 1592197432,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF995F \u3010Cowmpany Cowmpensation\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u4f60\u9700\u8981\u5bf9\u6bcf\u4e2a\u8282\u70b9\u5206\u914d\u4e00\u4e2a $[1,D]$ \u7684\u6743\u503c\uff0c\u4f46\u5fc5\u987b\u8981\u6ee1\u8db3\u4efb\u610f\u8282\u70b9 $u$ \u7684\u6743\u503c\u4e0d\u5c0f\u4e8e $u$ \u7684\u4efb\u610f\u4e00\u4e2a\u513f\u5b50\uff0c\u6c42\u5206\u914d\u65b9\u6848\uff0c\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n$\\texttt{Data Range:}1\\leq n\\leq 3000,1\\leq D\\leq 10^9$\n\n### \u9898\u89e3\n\n\u5957\u8def DP \u52a0\u4e0a\u4e0d\u5bfb\u5e38\u7684\u4f18\u5316\u3002\n\n~~\u9f13\u5439\u4e00\u6ce2\uff1a\u591a\u9879\u5f0f\u5927\u6cd5 yyds\uff01~~\n\n\u9996\u5148\u8003\u8651\u66b4\u529b DP\u3002\u8bbe $f_{i,j}$ \u8868\u793a\u4ee5 $i$ \u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u94a6\u5b9a $i$ \u8282\u70b9\u5206\u914d\u6743\u503c $j$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u7684\u65f6\u5019\u56e0\u4e3a\u5b50\u6811\u76f8\u4e92\u72ec\u7acb\u6240\u4ee5\u53ef\u4ee5\u4e58\u8d77\u6765\u3002\u679a\u4e3e\u5b50\u6811\u7684\u6743\u503c\u6709\u5982\u4e0b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_{i,j}=\\prod_{fa_u=i}\\sum\\limits_{k=1}^{j}f_{u,k}$$\n\n\u7136\u800c\u8fd9\u4e2a\u8f6c\u79fb\u66b4\u529b\u662f $O(nD^2)$ \u7684\uff0c\u5982\u679c\u8bbe $g_{i,j}$ \u4e3a $f_{i,j}$ \u5728 $j$ \u8fd9\u4e2a\u7ef4\u5ea6\u4e0a\u7684\u524d\u7f00\u548c\u53ef\u4ee5\u505a\u5230 $O(nD)$\uff0c\u7136\u800c\u8fd8\u662f\u65e0\u6cd5\u901a\u8fc7\u3002\n\n\u63a5\u4e0b\u6765\u6709\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u8282\u70b9 $u$ \u6765\u8bf4\uff0c$g_{u,i}$ \u4e3a\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $sz_u$ \u6b21\u591a\u9879\u5f0f\u5728 $i$ \u5904\u7684\u70b9\u503c\uff0c\u6211\u4eec\u6765\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u3002\n\n\u8003\u8651\u5f52\u7eb3\u3002\u5bf9\u4e8e\u53f6\u5b50\u8282\u70b9\u6765\u8bf4 $g_{u,i}=1$ \u662f\u4e00\u4e2a $0$ \u6b21\u591a\u9879\u5f0f\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u975e\u53f6\u5b50\u8282\u70b9\u3002\n\n\u6ce8\u610f\u5230\u6709\u8fd9\u4e48\u4e2a\u4e1c\u897f\uff1a\n\n$$g_{i,j}-g_{i,j-1}=f_{i,j}=\\prod_{fa_u=i}g_{u,j}$$\n\n\u7531\u4e8e\u53f3\u8fb9\u7684\u4e58\u79ef\u5f0f\u662f\u5bf9\u5e94\u4f4d\u7f6e\u7684\u70b9\u503c\u4e58\u8d77\u6765\uff0c\u6839\u636e FFT \u90a3\u5957\u7406\u8bba\u4e00\u5806\u591a\u9879\u5f0f\u7684\u5bf9\u5e94\u70b9\u503c\u4e58\u8d77\u6765\u4f1a\u662f\u67d0\u4e2a\u591a\u9879\u5f0f\u7684\u5bf9\u5e94\u70b9\u503c\uff0c\u800c\u4e14\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u6b21\u6570\u4e3a\u6240\u6709\u88ab\u4e58\u8d77\u6765\u7684\u591a\u9879\u5f0f\u6b21\u6570\u4e4b\u548c\u3002\n\n\u6240\u4ee5\u8bf4 $g_{i,j}-g_{i,j-1}$ \u4e3a\u4e00\u4e2a\u6b21\u6570\u4e0d\u8d85\u8fc7 $sz_i-1$ \u7684\u591a\u9879\u5f0f\uff0c\u4e5f\u5373 $g_{i,j}$ \u4e3a\u4e00\u4e2a\u6b21\u6570\u4e0d\u8d85\u8fc7 $sz_i$ \u7684\u591a\u9879\u5f0f\u3002\n\n\u7b2c\u4e00\u6b21 DP \u6211\u4eec\u80fd\u591f\u6c42\u51fa\u6ee1\u8db3 $1\\leq i\\leq n+1$ \u7684\u6240\u6709 $g_{1,i}$\uff0c\u7136\u540e\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5c31\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848\u3002\u7531\u4e8e\u70b9\u503c\u6bd4\u8f83\u7279\u6b8a\u662f\u8fde\u7eed\u7684\u4e00\u6bb5\u6240\u4ee5\u53ef\u4ee5\u9884\u5904\u7406\u7136\u540e $O(n)$ \u6c42\uff0c\u5f53\u7136 $O(n^2)$ \u4e5f\u53ef\u4ee5\u8fc7\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=3e3+51,MOD=1e9+7;\nll n,m,u,v,res;\nvector<ll>vg[MAXN];\nll f[MAXN][MAXN],g[MAXN][MAXN],pl[MAXN],pr[MAXN],fact[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n\tll res=1;\n\twhile(exponent)\n\t{\n\t\tif(exponent&1)\n\t\t{\n\t\t\tres=(li)res*base%MOD;\n\t\t}\n\t\tbase=(li)base*base%MOD,exponent>>=1;\n\t}\n\treturn res;\n}\ninline void dfs(ll node)\n{\n\tfor(register int i=1;i<=n+5;i++)\n\t{\n\t\tf[node][i]=1;\n\t}\n\tfor(register int i:vg[node])\n\t{\n\t\tdfs(i);\n\t\tfor(register int j=1;j<=n+5;j++)\n\t\t{\n\t\t\tf[node][j]=(li)f[node][j]*g[i][j]%MOD;\n\t\t}\n\t}\n\tfor(register int i=1;i<=n+5;i++)\n\t{\n\t\tg[node][i]=(g[node][i-1]+f[node][i])%MOD;\n\t}\n}\nint main()\n{\n\tn=read(),m=read();\n\tfor(register int i=2;i<=n;i++)\n\t{\n\t\tvg[read()].push_back(i);\n\t}\n\tdfs(1),pl[0]=pr[n+2]=fact[0]=1;\n\tfor(register int i=1;i<=n+1;i++)\n\t{\n\t\tpl[i]=(li)pl[i-1]*(m-i+MOD)%MOD,fact[i]=(li)fact[i-1]*i%MOD;\n\t}\n\tfor(register int i=n+1;i;i--)\n\t{\n\t\tpr[i]=(li)pr[i+1]*(m-i+MOD)%MOD;\n\t}\n\tfor(register int i=1;i<=n+1;i++)\n\t{\n\t\tv=(li)fact[i-1]*fact[n+1-i]%MOD,v=(n-i)&1?v:MOD-v;\n\t\tu=(li)pl[i-1]*pr[i+1]%MOD;\n\t\tres=(res+(li)g[1][i]*u%MOD*qpow(v,MOD-2)%MOD)%MOD;\n\t}\n\tprintf(\"%d\\n\",res);\n}\n```",
        "postTime": 1605707340,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF995F \u3010Cowmpany Cowmpensation\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.org/problemnew/show/CF995F)\n\n\u62c9\u683c\u6717\u65e5\u63d2\u503c\u3002\n\n\u8fd9\u9898\u4e3b\u8981\u5728\u4e8e\u8bc1\u660e\u3002\u8bbe$dp[i][j]$\u8868\u793a$i$\u53f7\u8282\u70b9\u9009\u62e9\u7684\u503c\u4e3a$j$\u7684\u5b50\u6811\u65b9\u6848\u6570\u3002\u663e\u7136\u7684\u8f6c\u79fb\u65b9\u7a0b\uff1a$dp[i][j]$=$\\prod_{q\u2208tox} \\sum_{k=0}^j dp[q][j]$\u3002\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e$dp$\u6570\u7ec4\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c\u3002\u7136\u540e\u53d1\u73b0$DP$\u5b9e\u5728\u662f\u592a\u5927\u4e86\uff0c\u76f4\u63a5$DP$\u662f\u4e0d\u73b0\u5b9e\u7684\uff0c\u89c2\u5bdf\u5f0f\u5b50\uff0c\u53d1\u73b0\u53ef\u4ee5\u8bc1\u660e\u8fd9\u662f\u4e00\u4e2a\u6700\u9ad8\u6b21\u4e3a$n$\u5173\u4e8e$j$\u591a\u9879\u5f0f\u3002\u8bc1\u660e\u5982\u4e0b\uff1a\u53f6\u5b50\u8282\u70b9\u7684$dp$\u5f0f\u663e\u7136\u662f\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570(\u90fd\u662f1\uff09\uff0c\u4ed6\u4eec\u7684\u7236\u4eb2\u56e0\u4e3a\u7ef4\u62a4\u4e86\u4e00\u4e2a\u4e58\u79ef\u6240\u4ee5\u53d8\u6210\u4e86\u4e00\u4e2a\u4ed6\u4eec\u6700\u9ad8\u6b21\u4e3a\u53f6\u5b50\u8282\u70b9\u4e2a\u6570\u5173\u4e8e$j$\u7684\u591a\u9879\u5f0f\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6839\u8282\u70b9\u5c31\u662f\u4e00\u4e2a\u6700\u9ad8\u6b21\u4e3a$n$\u5173\u4e8e$j$\u7684\u591a\u9879\u5f0f\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5957\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u4e86\u3002\n\ncode:\n```\n//2018.10.11 by ljz\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register int\n#define LL long long\n#define inf 0x3f3f3f3f\n#define eps 1e-15\ninline int read(){\n    res s=0;\n    bool w=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')w=1;ch=getchar();}\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return w?-s:s;\n}\ninline void _swap(res &x,res &y){\n    x^=y^=x^=y;\n}\ninline int _abs(const res &x){\n    return x>0?x:-x;\n}\ninline int _max(const res &x,const res &y){\n    return x>y?x:y;\n}\ninline int _min(const res &x,const res &y){\n    return x<y?x:y;\n}\nconst int kcz=1e9+7;\nconst int N=3e3+10;\nnamespace MAIN{\n    int n,d;\n    struct E{\n        int next,to;\n        E() {}\n        E(res next,res to):next(next),to(to) {}\n    }edge[N];\n    int head[N],cnt;\n    inline void addedge(const res &u,const res &v){\n        edge[++cnt]=E(head[u],v),head[u]=cnt;\n    }\n    int dp[N][N];\n    inline int qpow(res x,res y){\n        res ret=1;\n        while(y){\n            if(y&1)ret=1LL*ret*x%kcz;\n            y>>=1,x=1LL*x*x%kcz;\n        }\n        return ret%kcz;\n    }\n    inline void add(res &x,const res &y){\n        x+=y;\n        x>=kcz?x-=kcz:1;\n        x<0?x+=kcz:1;\n    }\n    inline int calc(const res &x){\n        res tmp=1,ret=0,p=(n&1)?kcz-1:1;\n        for(res i=1;i<=n;i++)tmp=1LL*tmp*(x-i)%kcz*qpow(i,kcz-2)%kcz;\n        for(res i=0;i<=n;i++,p=kcz-p)\n            add(ret,1LL*p*dp[1][i]%kcz*tmp%kcz),tmp=1LL*tmp*(x-i)%kcz*qpow(x-i-1,kcz-2)%kcz*(n-i)%kcz*qpow(i+1,kcz-2)%kcz;\n        return ret;\n    }\n    void dfs(const res &x){\n        for(res i=1;i<=n;i++)dp[x][i]=1;\n        for(res i=head[x];~i;i=edge[i].next){\n            res tox=edge[i].to;\n            dfs(tox);\n            for(res j=1;j<=n;j++)dp[x][j]=1LL*dp[x][j]*dp[tox][j]%kcz;\n        }\n        for(res i=1;i<=n;i++)add(dp[x][i],dp[x][i-1]);\n    }\n    inline void MAIN(){\n        memset(head,-1,sizeof(head));\n        n=read(),d=read();\n        for(res i=2;i<=n;i++){\n            res fa=read();\n            addedge(fa,i);\n        }\n        dfs(1);\n        if(d<=n)printf(\"%d\\n\",dp[1][d]);\n        else printf(\"%d\\n\",calc(d));\n    }\n}\nint main(){\n    MAIN::MAIN();\n    return 0;\n}\n```",
        "postTime": 1539254876,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010CF995F\u3011Cowmpany Cowmpensation"
    },
    {
        "content": "## \u6807\u7b7e\uff1a\n\n\u6570\u5b66\uff0c\u5bb9\u65a5\uff0c$Dp$\n\n## \u6765\u6e90\uff1a\n\n$CF995F$\n\n## \u9898\u610f\uff1a\n\n$given \\ a \\ tree$\n\n$given \\ a \\ number \\ D$\n\n\u8be2\u95ee\u6709\u591a\u5c11\u65b9\u6848\u4f7f\u5f97\uff0c\u6bcf\u4e2a\u70b9\u7684\u53d6\u503c\u5728$[1,D]$\u4e4b\u95f4\n\n\u4e14\u6bcf\u4e2a\u8282\u70b9\u7684\u503c\u5c0f\u4e8e\u7b49\u4e8e\u7236\u4eb2\u3002$(D\\leq 10^9 , n \\leq 3000)$\n\n# $Solution$\n\n\u6211\u4eec\u8003\u8651\uff0c\u82e5$D$\u975e\u5e38\u7684\u5c0f\uff0c\u5e94\u8be5\u600e\u4e48\u505a\u3002\u4e00\u4e2a\u663e\u7136\u7684\u6811\u5f62$Dp$\n\n$$Dp_{i,j}=\\prod{v \\in son}\\sum_{k=1}^iDp_{v,k}$$\n\n\u5bf9\u4e8e\u540e\u9762\u90a3\u4e2a$sum$\uff0c\u6211\u4eec\u76f4\u63a5\u524d\u7f00\u548c\u4f18\u5316\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u4f46\u662f\u6211\u4eec\u73b0\u5728\u7684\u95ee\u9898\u662f$D$\u975e\u5e38\u7684\u5927\uff0c\u4f46\u76f8\u5bf9\u4e8e\u6765\u8bf4$n$\u6bd4\u8f83\n\n\u7684\u5c0f\u3002\u4e8e\u662f\u6211\u4eec\u8fd9\u6837\u8003\u8651\u3002\n\n\u5047\u8bbe\u6211\u4eec\u53d6\u51fa\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a$j$\u7684\u6570\u5217\uff0c\u4f7f\u5f97\u8fd9\u68f5\u6811\u5408\u6cd5\u7684\u65b9\n\n\u6848\u6570\uff0c\u5c31\u662f\u5c06\u6bcf\u4e2a\u6570\u79bb\u6563\u5316\u540e\u7684$Dp_{1,j}$\uff0c\u4f46\u662f\u5bf9\u4e8e\u8fd9\u4e2a\n\n\u800c\u8a00\u6211\u4eec\u5176\u5b9e\u53ea\u662f\u5728\u5927\u5c0f\u4e3a$j$\u7684\u6570\u5217\u4e2d\u53bb\u53d6\u6570\uff0c\u4e14\u6839\u4e3a$j$\n\n\u7684\u65b9\u6848\u3002\u5982\u679c\u6211\u4eec\u76f4\u5230\u786e\u5207\u7684\u6bcf\u4e00\u4e2a$g_j$\uff0c\u8868\u793a\u9009\u51fa\u6070\u597d\n\n$j$\u4e2a\u6570\u7684\u65b9\u6848\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u7ec4\u5408\u6570\u4e58\u4e00\u4e0b\uff0c\u7b97\u51fa\u7b54\u6848\u3002\n\n\u5373\uff1a\n\n$$Ans=\\sum_{i=1}^{min(D,n)}g_i \\dbinom{D}{i} $$\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u6c42\u51fa\u6bcf\u4e00\u4e2a$g_j$,\u5229\u7528\u5bb9\u65a5\u539f\u7406\u3002\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$g_j$\n\n$$g_i=Dp_{1,i}-\\sum_{j=1}^{i-1}g_j \\dbinom{i - 1}{j-1}$$\n\n",
        "postTime": 1572781922,
        "uid": 119610,
        "name": "Regimes",
        "ccfLevel": 7,
        "title": "CF995F"
    },
    {
        "content": "\u6700\u8fd1\u624d\u4f1a\u4e86\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u4e00\u4e9b\u4e1c\u897f\u3002\n\n\u8fd8\u662f\u5199\u4e00\u7bc7\u9898\u89e3\u5de9\u56fa\u4e00\u4e0b\u3002\n\n### \u601d\u8def\n\n\u8003\u8651\u66b4\u529b\u5982\u4f55\u53bb\u5199\u3002\n\n$$dp_{i,j}=dp_{i,j-1}+\\prod_{x\\in son(i)}dp_{x,j}$$\n\n\u8fd9\u662f\u4e00\u4e2a\u66b4\u529b $dp$ \u7684\u65b9\u7a0b\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nd)$\u3002\n\n\u8003\u8651\u5982\u4f55\u4f18\u5316\u3002\n\n\u6211\u4eec\u5c06\u7b54\u6848\u770b\u505a\u4e00\u4e2a\u591a\u9879\u5f0f $f(x)$ \u8868\u793a $dp_{1,x}$\u3002\n\n\u62d3\u5c55\u5230\u6574\u68f5\u6811\u4e0a\u5373\uff0c$f(u,x)$ \u8868\u793a $dp_{u,x}$\u3002\n\n\u6211\u4eec\u731c\u6d4b $f(u,x)$ \u662f\u4e00\u4e2a $siz_u$ \u9879\u591a\u9879\u5f0f\u3002\n\n\u8bc1\u660e\uff1a\n\n\u4f7f\u7528\u5f52\u7eb3\u6cd5\u3002\n\n- \u5f53 $u$ \u4e3a\u53f6\u5b50\u662f\u539f\u5f0f\u6210\u7acb\u3002\n- \u5f53 $v\\in son(u)$\uff0c\u4e14 $v$ \u6210\u7acb\u65f6\uff1a\n\n$$f(u,x)-f(u,x-1)=\\prod_{v\\in son(u)}f(v,x)$$\n\n\u90a3\u4e48 $f(u,x)-f(u,x-1)$ \u4e3a $\\sum_{v\\in son(u)}siz_v$ \u9879\u591a\u9879\u5f0f\u3002\n\n\u5c06\u5dee\u5206\u8fd8\u539f\uff0c\u6b21\u6570\u52a0\u4e00\u5373 $\\sum_{v\\in son(u)}siz_v+1=siz_u$ \u9879\u591a\u9879\u5f0f\u3002\n\n\u8bc1\u6bd5\u3002\n\n\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u8fdb\u884c\u4f18\u5316\u3002\n\n\u7531\u4e8e\u4e00\u4e2a $n$ \u6b21\u591a\u9879\u5f0f\u53ef\u4ee5\u7528 $n+1$ \u4e2a\u70b9\u8868\u793a\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa $f(1,0\\cdots n)$ \u540e\u3002\n\n\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5feb\u901f\u6c42\u51fa $f(1,d)$ \u7684\u7b54\u6848\uff1a\n\n$$f(d)=\\sum_{i=0}^n f(i)\\prod_{j\\ne i}\\frac{d-j}{i-j}$$\n\n\u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\u3002\n\n[code](https://www.luogu.com.cn/record/104959333)",
        "postTime": 1679040490,
        "uid": 320933,
        "name": "Mfeitveer",
        "ccfLevel": 0,
        "title": "CF995F Cowmpany Cowmpensation \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\n\u6811\u5f62\u7ed3\u6784\uff0c\u7ed9\u6bcf\u4e2a\u8282\u70b9\u5206\u914d\u5de5\u8d44\uff08 $[1, d]$ \uff09\uff0c\u5b50\u8282\u70b9\u4e0d\u80fd\u8d85\u8fc7\u7236\u4eb2\u8282\u70b9\u7684\u5de5\u8d44\uff0c\u95ee\u6709\u591a\u5c11\u79cd\u5206\u914d\u65b9\u6848\uff0c\u7b54\u6848\u6a21 $10^9+7$ \u3002( $ 1 \\le n \\le 3000 $ , $ 1 \\le D \\le 10^9 $ )\u3002\n### \u9898\u89e3\n\n\u770b\u5230 $\\text D$ \u90a3\u4e48\u5927\uff0c\u6211\u4eec\u80af\u5b9a\u4e0d\u80fd\u628a $\\text D$ \u5199\u5230\u590d\u6742\u5ea6\u91cc\u9762\u53bb\u3002  \n\u6ce8\u610f\u5230 $n$ \u6bd4\u8f83\u5c0f\uff0c\u53ef\u4ee5\u7528\u5230\u7684\u503c\u4e5f\u5c31\u90a3\u4e48\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u503c\u57df\"\u79bb\u6563\u5316\"\u6210 $\\mathcal O(n)$ \u7684\uff0c\u518d\u5199\u8fdb\u590d\u6742\u5ea6\u91cc\u3002  \n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u7528 $f_{u,m}$ \u8868\u793a\u586b\u5b8c $u$ \u7684\u5b50\u6811\u53d6\u4e86 $m$ \u79cd\u503c\u7684\u65b9\u6848\uff0c\u6700\u540e\u518d\u8d21\u732e\u5230\u7b54\u6848\u4e2d\u3002\n\n\u8003\u8651\u5728\u4e0d\u7b97$u$\u7684\u8d21\u732e\u65f6\u7684\u8f6c\u79fb $f_{u,m}'=\\sum_i \\sum_j f_{u,i}f_{v,j}V(i,j,m)$  \n\u5176\u4e2d $V(i,j,m)$ \u8868\u793a\u628a\u4e24\u4e2a\u79bb\u6563\u5316\u540e\u5927\u5c0f\u4e3a $i,j$ \u7684\u4e24\u4e2a\u503c\u57df\u5408\u5e76\u4e3a\u4e00\u4e2a\u79bb\u6563\u5316\u540e\u5927\u5c0f\u4e3a $m$ \u7684\u503c\u57df\u3002\u53ef\u4ee5\u7406\u89e3\u4e3a\u628a $i$ \u4e2a\u7ea2\u7403\u548c $j$ \u4e2a\u84dd\u7403\u653e\u5230 $m$ \u4e2a\u76d2\u5b50\u91cc\uff0c\u4e14\u6bcf\u4e2a\u76d2\u5b50\u6bcf\u79cd\u7403\u6700\u591a\u653e\u4e00\u4e2a\u4e14\u4e0d\u80fd\u4e3a\u7a7a\u7684\u65b9\u6848\u6570\u3002  \n\u7b80\u5355\u5bb9\u65a5\u4e0b\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $V(i,j,n)=\\sum_{k\\ge0}(-1)^k {n-k\\choose i}{n-k \\choose j}{n \\choose k}$\n\n\u5199\u5230\u6211\u4eec\u7684\u8f6c\u79fb\u65b9\u7a0b\u4e2d $f_{u,m}'=\\sum_i \\sum_j f_{u,i} f_{v,j} \\sum_{k \\ge 0}(-1)^k {m-k\\choose i}{m-k \\choose j}{m \\choose k}$  \n\u628a\u7ec4\u5408\u6570\u62c6\u6210\u9636\u4e58\uff0c\u518d\u79fb\u52a8\u4e00\u4e0b $\\sum$ \uff0c\u53ef\u4ee5\u5f97\u5230  \n$f_{u,m}'=\\sum_{k \\ge 0} \\dfrac{m!(-1)^k(m-k)!}{k!}(\\sum_i \\dfrac {f_{u,i}}{i!}\\dfrac 1 {(m-k-i)!})(\\sum_j \\dfrac {f_{v,j}}{j!}\\dfrac 1 {(m-k-j)!})$  \n$\\dfrac{f_{u,m}'}{m!}=\\sum_{k \\ge 0} \\dfrac{(-1)^k}{k!}\\times(m-k)!(\\sum_i \\dfrac {f_{u,i}}{i!}\\dfrac 1 {(m-k-i)!})(\\sum_j \\dfrac {f_{v,j}}{j!}\\dfrac 1 {(m-k-j)!})$ \n\n$\\dfrac {f_{u,i}} {i!}$ \u683c\u5916\u663e\u773c\uff0c\u6211\u4eec\u5199\u51fa\u5b83\u7684\u751f\u6210\u51fd\u6570  $\\text F_u(x)= \\sum_{i \\ge 1} \\dfrac {f_{u,i}}{i!}x^i$  \n\u5c31\u6709 $[x^m]\\text F_u'(x)=\\sum_{k \\ge 0} \\dfrac {(-1)^k}{k!}\\times (m-k)![x^{m-k}](\\text F_u(x)e^x)[x^{m-k}](\\text F_v(x)e^x)$  \n\u6ce8\u610f\uff1a\u6211\u4eec\u7528 $\\text F_u'(x)$ \u8868\u793a\u8f6c\u79fb\u540e\u7684 $\\text F_u(x)$ \uff0c\u800c\u975e\u6c42\u5bfc\u3002\u5176\u4e2d$[x^n]$\u8868\u793a\u63d0\u53d6\u4e00\u4e2a\u591a\u9879\u5f0f$x^n$\u9879\u7684\u7cfb\u6570\u3002  \n\u8fd9\u8fd8\u662f\u4e00\u4e2a\u5377\u79ef\uff0c\u6211\u4eec\u7ee7\u7eed\u5316\u7b80\u3002  $[x^m]\\text F_u'(x)=[x^m]e^{-x}(\\sum_{k \\ge0}k![x^k](\\text F_u(x)e^x)[x^k](F_v(x)e^x)x^k)$  \n\u4e5f\u5c31\u662f\u8bf4  $\\text F_u'(x)=e^{-x}(\\sum_{k \\ge0}k![x^k](\\text F_u(x)e^x)[x^k](F_v(x)e^x)x^k)$  \n$e^x\\text F_u'(x)=\\sum_{k \\ge0}k![x^k](\\text F_u(x)e^x)[x^k](F_v(x)e^x)x^k$  \n\u4e0d\u59a8\u8bbe $\\text G_u(x)=\\sum_{k \\ge 0}g_{u,k}x^k=\\text F_u(x)e^x$ ,\u4e8e\u662f\u6709 $g_{u,i}'=i!g_{u,i}g_{v,i}$   \n\u4e8e\u662f\u6b63\u5982\u6211\u4eec\u671f\u5f85\u7684\u90a3\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 $\\mathcal O(n)$ \u7684\u65f6\u95f4\u5b8c\u6210 $G_u(x)$ \u7684\u8f6c\u79fb\u3002  \n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $\\text F_u(x)=\\text G_u(x)e^{-x}$ \u548c $\\text G_u(x)=\\text F_u(x)e^x$ \u5b9e\u73b0 $\\text F_u,\\text G_u$ \u4e4b\u95f4\u7684\u53d8\u6362\uff0c\u53ef\u60dc\u8fd9\u662f $\\mathcal O(n^2)$ \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u5148\u6c42\u51fa $\\text G_1(x)$ \u518d\u901a\u8fc7\u5b83\u8fd8\u539f\u51fa $\\text F_1(x)$\u3002  \n\u518d\u8003\u8651\u52a0\u4e0a $u$ \u7684\u8d21\u732e\uff0c$u$ \u8981\u4e48\u586b\u5f53\u524d\u7684\u6700\u5927\u503c\uff0c\u8981\u4e48\u586b\u4e00\u4e2a\u65b0\u7684\u6700\u5927\u503c\uff0c\u6240\u4ee5   $f_{u,i}'=f_{u,i}+f_{u,i-1}$\u3002   \n\u4f53\u73b0\u5728 $\\text F_u(x)$ \u4e0a\u5c31\u662f $\\text F_u'(x)=\\text F_u(x)+\\int \\text F_u(x)dx$  \n\u4e8e\u662f $\\text G_u'(x)=e^x\\text F_u'(x)=e^x\\text F_u(x)+e^x\\int \\text F_u(x)dx=G_u(x)+e^x\\int \\text F_u(x)dx$\n\n\u6211\u4eec\u73b0\u5728\u9700\u8981\u6c42\u51fa $e^x\\int \\text F_u(x)dx$ ,\u6211\u4eec\u5bf9\u5b83\u6c42\u5bfc\u53ef\u4ee5\u5f97\u5230 $(e^x\\int \\text F_u(x)dx)'=e^x\\text F(x)+e^x\\int \\text F_u(x)dx$  \n\u63d0\u53d6\u51fa\u4e24\u8fb9 $x^i$ \u9879\u7684\u7cfb\u6570\uff0c\u8bbe $[x^i]e^x\\int \\text F_u(x)dx$ \u4e3a $h_i$ ,\u4e8e\u662f\u6709 $(i+1)h_{i+1}=g_{u.i}+h_i$ \uff0c\u4e5f\u5c31\u662f $h_i=\\dfrac {g_{u,i-1}+h_{i-1}}i$ \u3002\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5 $\\mathcal O(n)$ \u5730\u6c42\u51fa $e^x\\int \\text F_u(x)dx$ \u5e76\u5b8c\u6210\u8f6c\u79fb\u4e86\u3002\n\n\u5173\u4e8e\u521d\u59cb\u5316\uff0c\u5bf9\u4e8e\u53f6\u5b50\u8282\u70b9\uff0c\u56e0\u4e3a $f_{u,1}=1$ \u4e14\u5176\u4ed6\u4f4d\u7f6e\u90fd\u4e3a $0$ ,\u6839\u636e\u5b9a\u4e49\u53ef\u4ee5\u5f97\u5230 $g_{u,i}=\\dfrac 1 {(i-1)!}$ \uff1b\u5bf9\u4e8e\u5176\u4ed6\u8282\u70b9\uff0c\u4e3a\u4e86\u6d88\u9664\u7b2c\u4e00\u6b21\u8f6c\u79fb\u591a\u51fa\u6765\u7684 $i!$ ,\u6211\u4eec\u8ba9 $g_{u,i}=\\dfrac 1 {i!}$\u3002\n\n\u5173\u4e8e\u7b54\u6848\uff0c\u663e\u7136\u6709 $ans=\\sum_{k \\ge 1} {\\text D\\choose k}f_{1,k}=\\sum_{k \\ge 1}\\text D^{\\underline k}[x^k]\\text F_ 1(x)$\n\n\u590d\u6742\u5ea6\u81ea\u7136\u662f $\\mathcal O(n^2)$ \u7684  \n\u6700\u540e\u7ed9\u4e0a\u4ee3\u7801\uff08\u7565\u53bb\u5feb\u8bfb\u548c\u5934\u6587\u4ef6\uff09\n```\n//\u5fb7\u4e3d\u838e\u4e16\u754c\u7b2c\u4e00\u53ef\u7231\n#define int long long\nconst int maxn=4000,mod=1e9+7;\nint fac[maxn],ifc[maxn],n,m,g[maxn][maxn],f[maxn],h[maxn],ans;\nint qpow(int a,int x){int ans=1;while(x){if(x&1)ans=ans*a%mod;a=a*a%mod,x>>=1;}return ans;}\nvector<int> son[maxn];\nvoid dfs(int u){\n    if(!son[u].size()){for(int i=1;i<=n;i++)g[u][i]=ifc[i-1];return;}\n    for(int i=1;i<=n;i++)g[u][i]=ifc[i];\n    for(int v:son[u]){dfs(v);for(int i=1;i<=n;i++)g[u][i]=g[u][i]*g[v][i]%mod*fac[i]%mod;}\n    for(int i=1;i<=n;i++)h[i]=(g[u][i-1]+h[i-1]+mod)%mod*fac[i-1]%mod*ifc[i]%mod;//\u5077\u4e2a\u61d2\uff0c1/n=(n-1)!/n!\n    for(int i=1;i<=n;i++)g[u][i]=(g[u][i]+h[i])%mod;\n}\nsigned main(){\n    n=read(),m=read();for(int i=2;i<=n;i++)son[read()].push_back(i); \n    fac[0]=1;for(int i=1;i<=n;i++)fac[i]=fac[i-1]*i%mod;//\u9884\u5904\u7406\u9636\u4e58\n    ifc[n]=qpow(fac[n],mod-2);for(int i=n-1;i>=0;i--)ifc[i]=ifc[i+1]*(i+1)%mod;//\u9636\u4e58\u7684\u9006\u5143\n    dfs(1);for(int i=1;i<=n;i++)for(int j=0;j<=i;j++)f[i]=(f[i]+g[1][i-j]*ifc[j]%mod*((j&1)?mod-1:1)%mod)%mod;\n    for(int i=1,t=m;i<=n;i++)ans=(ans+f[i]*t)%mod,t=t*(m-i)%mod;\n    return printf(\"%lld\",ans),0;\n}   \n```\n\n\n\n",
        "postTime": 1667186351,
        "uid": 520914,
        "name": "\u9716ux",
        "ccfLevel": 7,
        "title": "\u9898\u89e3CF995F"
    },
    {
        "content": "**\u6ce8\uff1a\u672c\u9898\u76ee\u819c\u6570\u5e94\u4e3a $10^9+7$\uff0c\u5728\u52aa\u529b\u5199NTT\u7684\u805a\u805a\u770b\u6e05\u695a\u3002\u3002\u3002**\n\n\u4f17\u6240\u5468\u77e5\uff0c\u8bbe $dp_i(j)$ \u4e3a\u5728\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u5185\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u5de5\u8d44\u8303\u56f4\u5728 $[1,j]$ \u5185\u7684\u60c5\u51b5\u6570\u91cf\uff0c\u90a3\u4e48\n\n$$dp_i(0)=0$$\n\n$$dp_i(j)=\\sum\\limits_{k=1}^j \\prod\\limits_{f_{s-1}=i}dp_{k}(s)=dp_i(j-1)+\\prod\\limits_{f_{s-1}=i}dp_{j}(s)$$\n\n\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f $dp_1(d)$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nd)$\u3002\n\n\u7136\u9e45\u2014\u2014\u4ea4\u4e0a\u53bb\u4e0d\u901a\u8fc7\uff0c\u56e0\u4e3a $d$ \u592a ${}^\\texttt{TM}$ \u5927\u4e86\u3002\u90a3\u600e\u4e48\u4f18\u5316\u5462\uff1f\n\n**\u63d0\u793a\uff1a\u5982\u679c\u4f60\u77e5\u9053 $dp_1$ \u51fd\u6570\u53ef\u4ee5\u5199\u6210\u4ec0\u4e48\u6837\u7684\u591a\u9879\u5f0f\uff0c\u6c42\u8fd9\u4e2a\u503c\u8fd8\u96be\u5417\uff1f**\n\n\u63a5\u4e0b\u6765\uff0c\u5c31\u7531\u6211\u4eec~~\u81ed\u540d\u662d\u8457~~\u7684\u62c9\u683c\u6717\u65e5\u63d2\u503c\u51fa\u573a\u5566\uff01\n\n\u82e5 $f$ \u662f\u4e00\u4e2a $n$ \u6b21\u51fd\u6570\uff0c\u7ed9\u5b9a $n+1$ \u4e2a\u6837\u672c\u70b9 $(x_i,y_i)$\uff0c\u5176\u4e2d $0\\le i\\le n$\uff0c\u90a3\u4e48\n\n$$f(x)=\\sum\\limits_{i=0}^n \\gamma_i(x)y_i$$\n\n\u5176\u4e2d\n\n$$\\gamma_i(x)=\\prod\\limits_{0\\le j\\le n,i\\not= j}\\frac{x-x_j}{x_i-x_j}$$\n\n\u89c2\u5bdf\u5230\u51fd\u6570 $dp_i$ \u4e3a\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u4e14\u5176\u6700\u9ad8\u6b21\u6570\u4e3a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\uff0c\u90a3\u4e48 $dp_1$ \u5c31\u662f\u4e00\u4e2a $n$ \u6b21\u51fd\u6570\uff0c\u6211\u4eec\u53ea\u7528\u6c42\u51fa $dp_1(0)$ \u5230 $dp_1(n)$ \u8fd9 $n+1$ \u4e2a\u4f4d\u7f6e\u4e0a\u7684\u503c\u5373\u53ef\u3002\n\n\u7136\u540e\u6c42\u51fa\u8fd9\u4e9b\u503c\u4f5c\u4e3a\u6837\u672c\u70b9\u4e4b\u540e\uff0c\u4ee5\u6c42\u51fa $\\gamma_i(d)$ \u7684 $O(n^2)$ \u6b21\u6570\u4e58\u5355\u6b21\u5feb\u901f\u5e42\u7684 $O(\\log p)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u2014\u2014\u76f4\u63a5T\u98de\u3002\u3002\u3002\n\n\u7531\u4e8e\u8fd9\u4e9b\u6837\u672c\u70b9\u7684 $x$ \u4e4b\u95f4\u503c\u53ea\u5dee $1$\uff0c\u6240\u4ee5\n\n$$\\gamma_i(d)=(\\prod\\limits_{0\\le j\\le n,i\\not= j}(d-j))(\\prod\\limits_{0\\le j<i}\\frac{1}{i-j})(\\prod\\limits_{i<j\\le n}\\frac{1}{i-j})$$\n\n\u518d\u8fdb\u884c\u5316\u7b80\uff1a\n\n$$\\gamma_i(d)=(\\prod\\limits_{0\\le j\\le n,i\\not= j}(d-j))(i!)^{-1}((n-i)!)^{-1}(-1)^{n-i}$$\n\n\u4e8e\u662f\uff0c$O(n\\log p)$ \u9884\u5904\u7406\u4e00\u4e0b\u9636\u4e58\u6c42\u9006\uff0c\u8fd9\u6837\u8fd9\u91cc\u5c31\u4e0d\u81f3\u4e8eT\u98de\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log p+n^2)$\uff0c\u4e5f\u5c31\u662f $O(n^2)$\u2014\u2014\u5b8c\u7f8e\u6492\u82b1\uff01\n\n\u63d0\u524d\u795d\u5e7f\u5927\u8c37\u6c11\u4eec\u516d\u4e00\u513f\u7ae5\u8282\u5237\u9898\u6109\u5feb\uff01\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define F(_i,_b,_e) for(int _i=_b;_i<=_e;_i++)\n#define RF(_i,_b,_e) for(int _i=_b;_i>=_e;_i--)\n#define B(_v,_u) for(int _v=s[_u];_v;_v=b[_v])\n#define Md(_n) _n%=p\n#define maxn 3005\nusing namespace std;\n\nint n,d,f[maxn],s[maxn],b[maxn],mc[maxn],lglrcz[maxn],dp[maxn][maxn],p=1000000007,ans;\n\nint qp(int xx,int yy){\n\tif(!yy)return 1;\n\tif(yy&1)return qp(xx,yy-1)*xx%p;\n\tint hr=qp(xx,yy/2);\n\treturn hr*hr%p;\n}\n\nsigned main(){\n\tcin>>n>>d;\n\tF(i,2,n){\n\t\tcin>>f[i];\n\t\tb[i]=s[f[i]];\n\t\ts[f[i]]=i;\n\t}\n\tRF(u,n,1)F(sal,1,n){\n\t\tdp[u][sal]=1;\n\t\tB(v,u){\n\t\t\tdp[u][sal]*=dp[v][sal];\n\t\t\tMd(dp[u][sal]);\n\t\t}\n\t\tdp[u][sal]+=dp[u][sal-1];\n\t\tMd(dp[u][sal]);\n\t}\n\tmc[0]=1;\n\tF(i,1,n)mc[i]=mc[i-1]*qp(i,p-2)%p;\n\tF(i,0,n){\n\t\tlglrcz[i]=mc[i]*mc[n-i]%p;\n\t\tlglrcz[i]=lglrcz[i]*((n-i)&1?p-1:1)%p;\n\t\tF(j,0,n){\n\t\t\tif(i==j)continue;\n\t\t\tlglrcz[i]*=((d-j)%p+p)%p;\n\t\t\tMd(lglrcz[i]);\n\t\t}\n\t\tans+=dp[1][i]*lglrcz[i];\n\t\tMd(ans);\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1652497255,
        "uid": 472950,
        "name": "Mr_Terminator",
        "ccfLevel": 4,
        "title": "\u80cc\u5305\u52a8\u5f52\u5212\uff0c\u518d\u52a0\u4e0a\u63d2\u503c\u2014\u2014\u5b8c\u7f8e\u6492\u82b1\uff01"
    },
    {
        "content": "[\u539f\u9898\u94fe\u63a5](http://https://codeforces.com/problemset/problem/995/F \"\u539f\u9898\u94fe\u63a5\")\n\n## \u9898\u610f\n\n\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u7ed9\u6bcf\u4e2a\u8282\u70b9\u5206\u914d\u5de5\u8d44\uff08$[1, D]$\uff09\uff0c\u5b50\u8282\u70b9\u4e0d\u80fd\u8d85\u8fc7\u7236\u4eb2\u8282\u70b9\u7684\u5de5\u8d44\uff0c\u95ee\u6709\u591a\u5c11\u79cd\u5206\u914d\u65b9\u6848\u3002\n\n$ 1 \\le n \\le 3000 $ , $ 1 \\le D \\le 10^9 $\n\n## \u601d\u8def\n\n\u6ce8\u610f\u5230\u53ef\u5206\u914d\u7684\u5de5\u8d44\u6570\u5f88\u591a\uff0c\u4f46\u5b9e\u9645\u80fd\u7528\u5230\u7684\u81f3\u591a\u53ea\u6709 $n$ \u79cd\u3002\u53ef\u4ee5\u8003\u8651\u5148\u8bb0\u5f55\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\uff0c\u6700\u540e\u518d\u4e58\u4e0a\u4e00\u4e2a\u7ec4\u5408\u6570\u3002\n\n\u4ee4 $f_{i,j}$ \u8868\u793a\u5728\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u8282\u70b9 $i$ \u7684\u6743\u503c\u662f**\u79bb\u6563\u5316\u540e**\u7b2c $j$ \u5927\u65f6\u7684\u5408\u6cd5\u65b9\u6848\u6570\u3002\u53ef\u4ee5\u5f97\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_{i,j}=\\prod_{v \\in son_i}\\left ( \\sum_{k=1}^{j} f_{v,k} \\right )$$\n\n\u5176\u4e2d $\\sum_{k=1}^{j} f_{v,k} $ \u53ef\u4ee5\u7528\u524d\u7f00\u548c\u4f18\u5316\u6389\uff0c\u603b\u7684\u8f6c\u79fb\u590d\u6742\u5ea6\u4e3a $O(n^2)$\u3002\n\n\u7136\u800c\uff0c\u5047\u8bbe\u5f53\u524d\u8282\u70b9\u7684\u6743\u503c\u662f $j$\uff0c\u513f\u5b50\u8282\u70b9\u7684\u6743\u503c\u662f $k$\u3002\u5728\u8f6c\u79fb\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u4fdd\u8bc1 $k+1,k+2,\\ldots,j-1$ \u8fd9\u4e9b\u6743\u503c\u90fd\u88ab\u53d6\u5230\uff0c\u5728\u539f\u59cb\u72b6\u6001\u4e0b\u8fd9\u4e9b\u6743\u503c\u4e0d\u88ab\u53d6\u5230\u662f\u4e0d\u5f71\u54cd\u6b63\u786e\u6027\u7684\uff0c\u4f46\u662f\u79bb\u6563\u5316\u540e\u663e\u7136\u5c31\u4f1a\u7b97\u91cd\u3002\u6839\u636e\u9898\u610f\uff0c\u6839\u8282\u70b9\u7684\u6743\u503c\u662f\u6700\u5927\u7684\uff0c\u90a3\u4e48 $f_{1,i}$ \u7684\u5b9e\u9645\u5b9a\u4e49\u5c31\u662f**\u81f3\u591a\u7528\u4e86** $i$ \u79cd\u6743\u503c\uff0c\u4e14\u6700\u5927\u503c\u4e3a $i$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u5bb9\u65a5\uff0c\u8bbe $g_i$ \u4e3a\u6070\u597d\u7528\u4e86 $i$ \u79cd\u6743\u503c\u7684\u65b9\u6848\u6570\u3002\u6839\u636e\u5b9a\u4e49\uff0c\u5176\u4e00\u5b9a\u88ab $f_{1,i}$ \u5b8c\u5168\u5305\u542b\u3002\u8003\u8651\u51cf\u53bb\u5b9e\u9645\u7528\u4e86 $j$ \u79cd\u6743\u503c\u7684\u65b9\u6848\uff0c\u7531\u4e8e\u6839\u8282\u70b9\u4e00\u5b9a\u4e3a $i$\uff0c\u90a3\u4e48\u5269\u4e0b\u7684 $j-1$ \u79cd\u6743\u503c\u5c31\u4e00\u5b9a\u5728 $1 \\sim i-1$ \u4e2d\u9009\u53d6\uff0c\u4e8e\u662f\u53ef\u4ee5\u5f97\u5230\u5bb9\u65a5\u65b9\u7a0b\uff1a\n\n$$g_i=f_{1,i}-\\sum_{j=1}^{i-1} \\binom{i-1}{j-1} g_j$$\n\n\u90a3\u4e48\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum_{i=1}^{\\min(n,d)} \\binom{d}{i} g_i$$\n\n## code\uff1a\n\n```\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int N=3010,mod=1e9+7;\nint s[N][N],n,d,h[N],idx,f[N][N],ans,fac[N],g[N],inv[N],infac[N];\nstruct edge{int v,nex;}e[N];\nvoid add(int u,int v){e[++idx]=edge{v,h[u]};h[u]=idx;}\nvoid init()\n{\n\tfac[0]=fac[1]=infac[0]=infac[1]=inv[0]=inv[1]=1;\n\tfor(int i=2;i<N;i++) fac[i]=1ll*fac[i-1]*i%mod;\n\tfor(int i=2;i<N;i++) inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n\tfor(int i=2;i<N;i++) infac[i]=1ll*infac[i-1]*inv[i]%mod;\n}\nint C(int n,int m){if(n<0||m<0||n<m) return 0;return 1ll*fac[n]*infac[m]%mod*infac[n-m]%mod;}\nvoid Add(int &a,int b){a+=b;if(a>=mod) a-=mod;}\nvoid Sub(int &a,int b){a-=b;if(a<0) a+=mod;}\nvoid Mul(int &a,int b){a=1ll*a*b%mod;}\nvoid dfs(int u)\n{\n\tfor(int i=h[u];i;i=e[i].nex)\n\t{\n\t\tint v=e[i].v;dfs(v);\n\t\tfor(int j=1;j<=min(n,d);j++) Mul(f[u][j],s[v][j]);\n\t}\n\tfor(int i=1;i<=min(n,d);i++) s[u][i]=(s[u][i-1]+f[u][i])%mod;\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&d);for(int i=1;i<=n;i++) for(int j=1;j<=min(n,d);j++) f[i][j]=1;init();\n\tfor(int u,v=2;v<=n;v++) scanf(\"%d\",&u),add(u,v);dfs(1);g[1]=f[1][1];\n\tfor(int i=2;i<=min(n,d);i++)\n\t{\n\t\tg[i]=f[1][i];for(int j=1;j<i;j++) Sub(g[i],1ll*C(i-1,j-1)*g[j]%mod);\n\t\t}\n\tfor(int i=1;i<=min(n,d);i++)\n\t{\n\t\tint tmp=infac[i];for(int j=d;j>=d-i+1;j--) Mul(tmp,j);//C(n,i)\n\t\tAdd(ans,1ll*tmp*g[i]%mod);\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1678499004,
        "uid": 288192,
        "name": "ListenSnow",
        "ccfLevel": 7,
        "title": "CF995F Cowmpany Cowmpensation"
    },
    {
        "content": "\u8003\u8651 $D<n$ \u7684\u60c5\u51b5\u662f\u7b80\u5355\u7684\uff0c\u76f4\u63a5\u4ee4 $f_{u,i}$ \u8868\u793a\u70b9 $u$ \u586b\u6570 $i$ \u65f6\uff0c$u$ \u7684\u5b50\u6811\u7684\u7b54\u6848\u3002\u8f6c\u79fb\u662f\u7b80\u5355\u7684\u3002\n\n$$f_{u,i}=\\prod_{v\\in son(u)}\\sum_{j=1}^if_{v,j}$$\n\n\u7136\u540e\u76f4\u63a5\u67e5\u8be2 $\\sum_{i=1}^df_{1,i}$ \u5373\u53ef\u3002\n\n\u90a3\u4e48\u95ee\u9898\u7684\u74f6\u9888\u5728\u4e8e $D$ \u5f88\u5927\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u5b9e\u9645\u4e0a\u6811\u5185\u7684\u6570\u7684\u79cd\u6570\u4e0d\u8d85\u8fc7 $n$\uff0c\u90a3\u4e48\u53ea\u8981\u6211\u4eec\u77e5\u9053 $g_i$ \u8868\u793a\u7528\u521a\u597d $i$ \u79cd\u6570\u7684\u7b54\u6848\uff0c\u90a3\u4e48\u9898\u76ee\u7684\u7b54\u6848\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u5f0f\u5b50\u8868\u793a\u3002\n\n$$ans=\\sum_{i=1}^ng_i\\binom{D}{i}$$\n\n\u7ec4\u5408\u6570\u66b4\u529b $O(n)$ \u6c42\u5373\u53ef\u3002\u95ee\u9898\u8f6c\u5316\u4e3a\u5982\u4f55\u6c42 $g_i$\u3002\n\n\u6211\u4eec\u8003\u8651\u6700\u5f00\u59cb\u7684\u505a\u6cd5\u3002\n\n\u76f4\u63a5\u8c03\u7528 $f_{1,i}$ \u663e\u7136\u662f\u9519\u7684\uff0c\u56e0\u4e3a\u53ef\u80fd\u662f\u7528\u4e86\u5c11\u4e8e $i$ \u79cd\uff0c\u4f46\u662f\u53c8\u4e0d\u5305\u542b\u6240\u6709 $\\le i$ \u79cd\u7684\u3002\n\n\u4f46\u662f\u53d1\u73b0 $f_{1,i}$ \u5305\u542b\u4e86\u6240\u6709\u6070\u597d\u628a $[1,i]$ \u7684 $i$ \u79cd\u90fd\u7528\u8fc7\u7684\u65b9\u6848\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u53d6\u4e00\u4e2a\u524d\u7f00\u548c\u3002\u6216\u8005\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u6765\u8bb2\uff0c\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u7684\u539f\u56e0\u662f\u8fd9\u4e2a $f_{1,i}$ \u94a6\u5b9a\u4e86\u6839\u7684\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u628a $a_1=i$ \u7684\u5f62\u5f0f\u53d8\u6210 $a_1\\le i$ \u5373\u53ef\uff0c\u8fd9\u4e5f\u4f1a\u8d70\u5230\u524d\u7f00\u548c\u3002\n\n\u53d6\u5b8c\u540e $f_{1,i}$ \u5c31\u53d8\u6210\u4e86\u5728 $[1,i]$ \u5185\u7684\u6240\u6709\u65b9\u6848\u4e86\uff0c\u8003\u8651\u4ece\u5c0f\u5230\u5927\u6c42\u89e3\uff0c\u663e\u7136 $g_j$ \u4f1a\u5728 $f_{1,i}$ \u91cc\u8d21\u732e $\\binom{i}{j}$ \u6b21\uff0c\u6240\u4ee5\u6709\u4e0b\u9762\u7684\u5f0f\u5b50\u3002\n\n$$g_i=f_{1,i}-\\sum_{j=1}^{i-1}g_j\\binom{i}{j}$$\n\n\u7136\u540e\u5c31\u6ca1\u4e86\uff0c\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\nhttps://codeforces.com/contest/995/submission/171687696",
        "postTime": 1662885724,
        "uid": 115936,
        "name": "\u6cf7\u6cfd\u4e09\u6708",
        "ccfLevel": 0,
        "title": "CF995F"
    },
    {
        "content": "### P.S.\n\u771f\u7684\u9ad8\u5999\u9898\u3002\u3002\u3002  \n\n### Description.\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u5bf9\u6bcf\u4e2a\u7ed3\u70b9\u52a0\u6743\uff0c\u4f7f\u5f97 $\\forall x\\in[1,n],a_x\\in[1,D]$ \u4e14 $\\forall x\\in[1,n],\\forall y\\in\\text{son}_x,a_x\\ge a_y$\u3002  \n\u6c42\u65b9\u6848\u6570\u3002  \n\n### Solution.\n\u770b\u5230\u8fd9\u79cd\u9898\uff0c\u4e00\u773c\u7ebf\u6bb5\u6811\u5408\u5e76\u3002\uff08\u867d\u7136\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u2026\u2026  \n\u8003\u8651\u5728\u503c\u57df\u4e0a\u8fdb\u884c $dp$\uff0c\u6709\u5982\u4e0b\u5f0f\u5b50\u3002  \n$$dp_{x,i}=\\prod_{y\\in \\text{son}_x}\\sum_{j=1}^idp_{x,i}$$  \n\u521d\u59cb\u503c\u4e3a $dp_{x,i}=1$\u3002  \n\u4f46\u662f\u6ce8\u610f\u8fd9\u521d\u59cb\u72b6\u6001\u4e0d\u662f\u4e00\u4e2a\u70b9\uff0c\u800c\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u8981\u8003\u8651\u4e00\u4e2a\u5957\u8def\u3002  \n\u5c31\u662f\u628a\u5f53\u524d\u53ea\u88ab\u4fee\u6539\u4e00\u6b21\u7684\u533a\u95f4\u6253\u4e2a\u7ed3\u675f\u6807\u8bb0\uff0c\u4e0d\u5efa\u7acb\u4e0b\u9762\u7684\u5b50\u6811\u3002  \n\u7136\u540e\u6bcf\u6b21 pushdown \u518d\u5efa\u7acb\u4e0b\u9762\u7684\u5185\u5bb9\u3002  \n\u8fd9\u6837\u7a7a\u95f4\u590d\u6742\u5ea6\u548c\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u666e\u901a\u7ebf\u6bb5\u6811\u5408\u5e76\u662f\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002  \n\u7a81\u7136\u53d1\u73b0\u6709\u70b9\u4e0d\u5bf9\u52b2\u3002  \n\u8003\u8651\u4e24\u4e2a\u91cd\u5408\u7684\u7ed3\u675f\u7ed3\u70b9\uff0c\u8f6c\u79fb\u4e00\u6b21\u540e\u5c31\u76f8\u5f53\u4e8e\u52a0\u4e0a\u4e86\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002  \n\u90a3\u662f\u4e0d\u662f\u8fd8\u9700\u8981\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217 ![](//xn--9zr.tk/xia)  \n\u4f46\u662f\uff0c\u51b7\u9759\u601d\u8003\u4e00\u4e0b\uff0c\u53d1\u73b0\u4e24\u4e2a\u7b49\u5dee\u6570\u5217\u5408\u5e76\u8d77\u6765\u5c31\u4e0d\u53ea\u662f\u7b49\u5dee\u6570\u5217\u4e86\uff0c**\u7ebf\u6bb5\u6811\u7b97\u6cd5\u5047\u54af**  \n\n\u4f46\u662f\uff0c\u6211\u4eec\u80fd\u4ece\u7ebf\u6bb5\u6811\u5408\u5e76\u7684\u601d\u8def\u4e2d\u5f97\u5230\u542f\u53d1\uff0c\u53d1\u73b0\u4e00\u4e9b\u7279\u6b8a\u6027\u8d28\u3002  \n\u8003\u8651\u5408\u5e76\u4e00\u6b21\u662f\u7b49\u5dee\u6570\u5217\u662f $a_i=i$\uff0c\u5408\u5e76\u4e24\u6b21\u6253\u8868\u53d1\u73b0\u662f $a_i=i^2$\u3002  \n\u6211\u4eec\u53d1\u73b0\u5408\u5e76 $n-1$ \u6b21\u662f\u4e00\u4e2a\u81f3\u591a $n-1$ \u6b21\u7684\u591a\u9879\u5f0f\u3002  \n\u90a3\u4e48\u6211\u4eec\u5e26 $n$ \u4e2a\u70b9\u503c\u5c31\u80fd\u786e\u5b9a\u8fd9\u4e2a\u591a\u9879\u5f0f\uff0c\u8bbe\u4e3a $dp(i)$\u3002  \n\u6ce8\u610f\u6211\u4eec\u6700\u540e\u9700\u8981\u6c42 $S(D)=\\sum_{i=1}^Ddp(i)$\u3002  \n\u6839\u636e\u591a\u9879\u5f0f\u90a3\u5957\u7406\u8bba\uff0c$S(x)$ \u80af\u5b9a\u662f\u81f3\u591a $n+1$ \u9879\u7684\u591a\u9879\u5f0f\u3002  \n\u7136\u540e\u76f4\u63a5\u4e0a $O(n^2)$ \u63d2\u503c\u5c31\u597d\u4e86\u3002  \n\n### Coding.\n```cpp\n//\u662f\u554a\u2026\u2026\u4f60\u5c31\u662f\u90a3\u53ea\u9b3c\u4e86\u2026\u2026\u6240\u4ee5\u88ab\u4f60\u78b0\u5230\u4ee5\u540e\uff0c\u5c31\u8f6e\u5230\u6211\u53d8\u6210\u9b3c\u4e86{{{\n#include<bits/stdc++.h>\nusing namespace std;typedef long long ll;\ntemplate<typename T>inline void read(T &x)\n{\n\tx=0;char c=getchar(),f=0;\n\tfor(;c<'0'||c>'9';c=getchar()) if(c=='-') f=1;\n\tfor(;c>='0'&&c<='9';c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\tif(f) x=-x;\n}/*}}}*/\nconst int P=1e9+7;int n,D,dp[3005][3005],s[3005][3005],res;\nstruct edge{int to,nxt;}e[3005];int et,head[3005],iv[3005];\ninline int ksm(int x,int q=P-2) {int r=1;for(;q;q>>=1,x=1ll*x*x%P) if(q&1) r=1ll*r*x%P;return r;}\ninline void adde(int x,int y) {e[++et]=(edge){y,head[x]},head[x]=et;}\ninline void dfs(int x)\n{\n\tfor(int i=1;i<=n;i++) dp[x][i]=1;\n\tfor(int i=head[x];i;i=e[i].nxt)\n\t{\n\t\tdfs(e[i].to);for(int j=1;j<=n;j++)\n\t\t\tdp[x][j]=1ll*dp[x][j]*s[e[i].to][j]%P;\n\t}\n\tfor(int i=1;i<=n;i++) s[x][i]=(s[x][i-1]+dp[x][i])%P;\n}\ninline int inv(int x) {return x<0?P-iv[-x]:iv[x];}\nint main()\n{\n\tread(n),read(D);for(int i=2,f;i<=n;i++) read(f),adde(f,i);\n\tiv[1]=1;for(int i=2;i<=n;i++) iv[i]=1ll*iv[P%i]*(P-P/i)%P;\n\tdfs(1);for(int i=1,w=1;i<=n;(res+=1ll*w*s[1][i]%P)%=P,w=1,i++)\n\t\tfor(int j=1;j<=n;j++) if(i^j) w=1ll*w*(D-j)%P*inv(i-j)%P;\n\treturn printf(\"%d\\n\",(res+P)%P),0;\n}\n```",
        "postTime": 1619835279,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "CF995F Cowmpany Cowmpensation\uff08\u9898\u89e3\uff09"
    },
    {
        "content": "# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/CF995F)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&emsp;&emsp;\u4e0d\u96be\u770b\u51fa\u4e00\u4e2a\u66b4\u529b DP \uff1a     \n&emsp;&emsp;$f(u,i)$\uff1a\u5f53$u$\u53d6$i$\u65f6\uff0c$u$\u7684\u5b50\u6811\u5185\u7684\u65b9\u6848\u6570\u3002   \n&emsp;&emsp;\u8f6c\u79fb\u663e\u7136\uff1a   \n$$f(u,i)=\\prod_{v\\in son(u)}\\sum_{j\\le i} f(v,j)$$  \n&emsp;&emsp;\u518d\u8bbe$S(u,i)=\\sum_{j\\le i}f(u,j)$\uff0c\u5373\u524d\u7f00\u548c\u3002\u7b54\u6848\u5c31\u662f$S(1,D)$\u3002$S$\u7684\u8f6c\u79fb\u4e5f\u5f88\u597d\u60f3\uff1a   \n$$S(u,i)=\\sum_{j\\le i}f(u,i)=\\sum_{j\\le i}\\prod_{v\\in son(u)}S(v,j)$$    \n&emsp;&emsp;\u663e\u7136\uff0c\u5f53$u$\u786e\u5b9a\u7684\u65f6\u5019\uff0c$S(u,i)$\u5c31\u662f$i$\u7684**\u591a\u9879\u5f0f\u51fd\u6570**\u3002\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u51fa\u5b83\u7684\u6b21\u6570\uff0c\u5c31\u53ef\u4ee5\u7528\u63d2\u503c\u6cd5\uff0c\u5f97\u5230$S(u,D)$\u7684\u7b54\u6848\u3002  \n&emsp;&emsp;\u8bbe$g(u)$\u4e3a$S(u)$\u7684\u6b21\u6570\uff0c\u6839\u636e\u8f6c\u79fb\u65b9\u7a0b\uff0c\u53ef\u4ee5\u5f97\u5230$g(u)$\u4e3a\uff1a  \n$$g(u)=1+\\sum_{v\\in son(u)}g(v)$$   \n&emsp;&emsp;\u6240\u4ee5$S(1)$\u7684\u6b21\u6570\u5c31\u662f$n$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa$S(1,1)\\sim S(1,n+1)$\uff0c\u5373\u53ef\u8fdb\u884c\u63d2\u503c\uff0c\u6c42\u51fa$S(1,D)$\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2)$\u3002  \n# \u4ee3\u7801\n```cpp\n#include<cstdio>\n\nconst int mod = 1e9 + 7;\nconst int MAXN = 3005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\nstruct edge\n{\n\tint to, nxt;\n}Graph[MAXN << 1];\n\nint f[MAXN][MAXN];\nint head[MAXN];\nint N, M, D, cnt;\n\nvoid addEdge( const int from, const int to )\n{\n\tGraph[++ cnt].to = to, Graph[cnt].nxt = head[from];\n\thead[from] = cnt;\n}\n\nint qkpow( int base, int indx )\n{\n\tint ret = 1;\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret = 1ll * ret * base % mod;\n\t\tbase = 1ll * base * base % mod, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nint inver( const int a ) { return qkpow( a, mod - 2 ); }\nint fix( const int a ) { return ( a % mod + mod ) % mod; }\nvoid add( int &x, const int v ) { x = ( x + v >= mod ? x + v - mod : x + v ); }\n\nvoid DFS( const int u )\n{\n\tfor( int i = 1 ; i <= M ; i ++ ) f[u][i] = 1;\n\tfor( int i = head[u], v ; i ; i = Graph[i].nxt )\n\t{\n\t\tDFS( v = Graph[i].to );\n\t\tfor( int j = 1 ; j <= M ; j ++ ) \n\t\t\tf[u][j] = 1ll * f[u][j] * f[v][j] % mod;\n\t}\n\tfor( int i = 1 ; i <= M ; i ++ ) add( f[u][i], f[u][i - 1] );\n}\n\nint Lagrange()\n{\n\tif( D <= M ) return f[1][D];\n\tint ans = 0, w = 1, L = 1;\n\tfor( int i = 1 ; i <= M ; i ++ ) L = 1ll * L * ( D - i ) % mod;\n\tfor( int i = 2 ; i <= M ; i ++ ) w = 1ll * w * inver( fix( 1 - i ) ) % mod;\n\tfor( int i = 1 ; i <= M ; i ++ )\n\t{\n\t\tadd( ans, 1ll * L * w % mod * inver( D - i ) % mod * f[1][i] % mod );\n\t\tif( i < M ) w = 1ll * w * fix( i - M ) % mod * inver( i ) % mod;\n\t}\n\treturn ans;\n}\n\nint main()\n{\n\tread( N ), read( D );\n\tfor( int i = 2, p ; i <= N ; i ++ ) read( p ), addEdge( p, i );\n\tM = N + 1, DFS( 1 );\n\twrite( Lagrange() ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1592189825,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[CF995F]Cowmpany Cowmpensation"
    }
]