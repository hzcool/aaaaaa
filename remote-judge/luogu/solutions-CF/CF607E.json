[
    {
        "content": "> [CF607E Cross Sum](https://codeforces.com/contest/607/problem/E)\n\n## \u9898\u610f\n\n- \u5728\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e2d\uff0c\u7ed9\u5b9a $n$ \u6761\u4e0d\u540c\u7684\u76f4\u7ebf\uff0c\u7b2c $i$ \u6761\u76f4\u7ebf\u4e3a $y=a_i x+b_i$\u3002\n- \u53ef\u91cd\u70b9\u96c6 $\\mathcal I$ \u4e3a $n$ \u6761\u76f4\u7ebf\u4e24\u4e24\u7684\u4ea4\u70b9\uff0c\u53ef\u91cd\u6570\u96c6 $\\mathcal D$ \u4e3a $\\mathcal I$ \u4e2d\u6240\u6709\u70b9\u4e0e $(p,q)$ \u7684\u8ddd\u79bb\u3002\n- \u4f60\u9700\u8981\u6c42\u51fa $\\mathcal D$ \u4e2d\u524d $m$ \u5c0f\u7684\u6570\u4e4b\u548c\u3002\n- $n \\le 5 \\times 10^4$\uff0c$m \\le 3 \\times 10^7$\uff0c$|p|,|q|,|a_i|,|b_i| \\le 10^3$ \u4e14\u8f93\u5165\u7684\u6574\u6570\u503c\u4e3a\u5b9e\u9645\u503c\u7684 $10^3$ \u500d\uff0c\u7b54\u6848\u7cbe\u5ea6\u8bef\u5dee $\\le 10^6$\u3002\n\n## \u9898\u89e3\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06 $(p,q)$ \u4f5c\u4e3a\u5750\u6807\u7cfb\u539f\u70b9\uff0c\u5219\u6bcf\u6761\u76f4\u7ebf\u53ef\u4ee5\u8f6c\u6210 $y+q=a_i(x+p)+b_i$\uff0c\u4e5f\u5c31\u662f $y=a_ix + a_ip+b_i-q$\u3002\n\n\u9996\u5148\u663e\u7136\u8981\u627e\u5230\u4e00\u4e2a\u534a\u5f84\u6700\u5c0f\u7684\u5706\u4f7f\u5176\u80fd\u591f\u8986\u76d6\u81f3\u5c11 $m$ \u4e2a\u4ea4\u70b9\u3002\n\n\u8003\u8651\u4e8c\u5206\u7b54\u6848\u8f6c\u5316\u4e3a\u5224\u5b9a\u95ee\u9898\u3002\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa\u6bcf\u6761\u76f4\u7ebf\u4e0e\u5706\u7684\u4ea4\u70b9\u5750\u6807\u5e76\u6781\u89d2\u6392\u5e8f\u548c\u79bb\u6563\u5316\uff0c\u95ee\u9898\u5c31\u53d8\u6210\u82e5\u5e72\u6761\u7ebf\u6bb5\u6709\u591a\u5c11\u4e24\u4e24\u76f8\u4ea4\uff0c\u662f\u7ecf\u5178\u7684\u626b\u63cf\u7ebf\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6c42\u51fa\u3002\u8fd9\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log n \\log w)$\u3002\n\n\u627e\u5230\u8fd9\u4e2a\u534a\u5f84\u4e4b\u540e\uff0c\u6211\u4eec\u73b0\u5728\u8981\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u4e0e\u4e0a\u9762\u7684\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u4f46\u7531\u4e8e\u6b64\u65f6\u4ea4\u70b9\u6570\u6700\u591a\u53ea\u6709 $m$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528 set \u4ee3\u66ff\u6811\u72b6\u6570\u7ec4\uff0c\u76f4\u63a5\u5f97\u5230\u6240\u6709\u76f8\u4ea4\u7684\u7ebf\u6bb5\uff0c\u7136\u540e\u6c42\u51fa\u5b83\u4eec\u7684\u4ea4\u70b9\u4e0e\u539f\u70b9\u7684\u8ddd\u79bb\u3002\n\n\u4f46\u53ef\u80fd\u6709\u591a\u4e2a\u70b9\u6070\u597d\u5728\u5706\u4e0a\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u7edf\u8ba1\u8ddd\u79bb\u7684\u65f6\u5019\u53ea\u7edf\u8ba1\u4e25\u683c\u5728\u5706\u5185\u7684\u70b9\uff0c\u5982\u679c\u4e2a\u6570\u5c11\u4e8e $m$\uff0c\u5219\u5269\u4e0b\u7684\u8ddd\u79bb\u5168\u90fd\u662f\u534a\u5f84\u3002\u8fd9\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(m \\log n)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log n \\log w + m \\log n)$\uff0c\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u7cbe\u5ea6\u95ee\u9898\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst int N = 5e4 + 7;\nint n, m, x, y, t, v[N], c[N*2];\nld p, q, a[N], b[N];\npair<ld, int> s[N*2];\n\ninline void add(int x) {\n\twhile (x <= t) ++c[x], x += x & -x;\n}\n\ninline int ask(int x) {\n\tint k = 0;\n\twhile (x) k += c[x], x -= x & -x;\n\treturn k;\n}\n\ninline void work(ld r) {\n\tt = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tld a = ::a[i], b = ::b[i];\n\t\tld d = 4 * a * a * b * b - 4 * (a * a + 1) * (b * b - r * r);\n\t\tif (d < eps) continue;\n\t\td = sqrt(d);\n\t\tld x1 = (-2 * a * b - d) / (2 * (a * a + 1));\n\t\tld x2 = (-2 * a * b + d) / (2 * (a * a + 1));\n\t\tld y1 = a * x1 + b, y2 = a * x2 + b;\n\t\ts[++t] = mp(P(x1, y1).a(), i), s[++t] = mp(P(x2, y2).a(), i);\n\t\tv[i] = 0;\n\t}\n\tsort(s + 1, s + t + 1);\n\tfor (int i = t; i; i--)\n\t\tif (!v[s[i].se]) v[s[i].se] = i;\n}\n\ninline bool pd(ld r) {\n\twork(r);\n\tfor (int i = 1; i <= t; i++) c[i] = 0;\n\tll ret = 0;\n\tfor (int i = 1; i <= t; i++)\n\t\tif (v[s[i].se] != i) {\n\t\t\tret += ask(v[s[i].se]) - ask(i - 1);\n\t\t\tadd(v[s[i].se]);\n\t\t}\n\treturn ret >= m;\n}\n\ninline ld calc(int i, int j) {\n\tld x = (b[j] - b[i]) / (a[i] - a[j]), y = a[i] * x + b[i];\n\treturn sqrt(x * x + y * y);\n}\n\ninline ld calc(ld r) {\n\twork(r);\n\tset<pi> st;\n\tld ret = 0;\n\tint cnt = 0;\n\tfor (int i = 1; i <= t; i++)\n\t\tif (v[s[i].se] != i) {\n\t\t\tauto it = st.upper_bound(mp(i + 1, 0));\n\t\t\twhile (it != st.end() && (it -> fi) < v[s[i].se])\n\t\t\t\tret += calc(s[i].se, it -> se), ++it, ++cnt;\n\t\t\tst.insert(mp(v[s[i].se], s[i].se));\n\t\t}\n\treturn ret + (m - cnt) * r;\n}\n\nint main() {\n\trd(n), rd(x), rd(y), rd(m), p = x / 1e3, q = y / 1e3;\n\tfor (int i = 1; i <= n; i++)\n\t\trd(x), rd(y), a[i] = x / 1e3, b[i] = y / 1e3 + a[i] * p - q;\n\tld l = 0, r = 1e10;\n\tfor (int i = 1; i <= 100; i++) {\n\t\tld mid = (l + r) / 2;\n\t\tif (pd(mid)) r = mid;\n\t\telse l = mid;\n\t}\n\tprintf(\"%.10Lf\\n\", max(0.0L, calc(r)));\n\treturn 0;\n}\n```\n\n",
        "postTime": 1582193195,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF607E \u3010Cross Sum\u3011"
    },
    {
        "content": "## \u300c\u535a\u5ba2\u94fe\u63a5\u300d\n[\u70b9\u51fb\u6253\u5f00\u94fe\u63a5](http://blog.chhokmah.top/index.php/archives/22/)\n## \u300c\u9898\u76ee\u94fe\u63a5\u300d\n[\u70b9\u51fb\u6253\u5f00\u94fe\u63a5](codeforces.com/problemset/problem/607/E)\n\n## \u300c\u9898\u76ee\u6982\u62ec\u300d\n\u7ed9\u51fa\u5e73\u9762\u5185$n$\u6761\u76f4\u7ebf\uff0c\u6c42\u51fa$n$\u6761\u76f4\u7ebf\u7684\u4e24\u4e24\u7684\u4ea4\u70b9\uff0c\u8ddd\u79bb\u7ed9\u5b9a\u70b9$(p,q)$\u524d$m$\u8fd1\u7684\u70b9\u7684\u8ddd\u79bb\u548c\u3002  \n\u6570\u636e\u8303\u56f4 $n\\leq 50000,m\\leq 3\\times 10^7$\u3002   \n## \u300c\u601d\u8def\u8981\u70b9\u300d\n\u4e8c\u5206\u7b54\u6848\uff0c\u9700\u8981\u534a\u5f84\u4e3a$mid$\u7684\u5706\uff0c\u624d\u80fd\u5c06\u8fd9\u4e9b\u4ea4\u70b9\u5168\u90e8\u8986\u76d6\u3002  \n\u8fd9\u6837\u5c31\u53d8\u6210\u4e86\u4e24\u4e2a\u5b50\u95ee\u9898\uff1a\u5224\u65ad$mid$\u662f\u5426\u53ef\u884c\u4ee5\u53ca\u8ba1\u7b97\u957f\u5ea6\u4e3a$mid$\u65f6\u7684\u7b54\u6848\u3002  \n### \u5b50\u4efb\u52a1$1$\n\u9996\u5148\u6211\u4eec\u6c42\u51fa\u6bcf\u4e00\u6761\u548c\u5706\u76f8\u4ea4\u7684\u76f4\u7ebf\u7684\u4ea4\u70b9\u7684\u5750\u6807\uff0c\u8f6c\u6210\u6781\u89d2\u5e8f\u3002  \n\u7136\u540e\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e\u4e24\u6761\u76f4\u7ebf\u5728\u5706\u5185\u6709\u4ea4\u70b9\u7684\u5145\u8981\u6761\u4ef6\u662f\u5728\u5706\u4e0a\u4ea4\u70b9\u4ea4\u53c9\u5206\u5e03\u3002  \n\u8fd9\u6837\u6211\u4eec\u79bb\u6563\u5316\u51fa\u6240\u6709\u70b9\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u95ee\u9898\u5c31\u53c8\u53d8\u6210\u4e86\u5728\u5e73\u9762\u4e2d\u6709\u591a\u5c11\u7ebf\u6bb5\u76f8\u4ea4\u3002    \n\u5bf9\u4e8e\u6240\u6709\u7684\u7ebf\u6bb5\u6211\u4eec\u9884\u5904\u7406\u51fa\u8d77\u59cb\u70b9$f$\u548c\u7ec8\u70b9$s$\u3002  \n\u5bf9\u4e8e\u4e00\u4e2a\u8d77\u59cb\u70b9$f$\uff0c\u6211\u4eec\u67e5\u8be2$[f,s]$\u4e2d\u7ec8\u70b9\u7684\u4e2a\u6570\uff0c\u7136\u540e\u518d\u5c06\u7ec8\u70b9$s$\u52a0\u5165\u3002  \n\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u7edf\u8ba1\u7684\u5de5\u4f5c\u3002  \n\u52a0\u4e0a\u4e8c\u5206\u540e\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(nlog_2n)$\u3002\n### \u5b50\u4efb\u52a1$2$\n\u6211\u4eec\u8fd8\u662f\u5c06\u4ea4\u70b9\u6c42\u51fa\u6781\u89d2\u5e8f\u540e\u79bb\u6563\u5316\u3002  \n\u8fd9\u4e2a\u95ee\u9898\u7684\u672c\u8d28\u662f\u4e00\u4e2a\u504f\u5e8f\u95ee\u9898\uff0c\u9650\u5236\u6761\u4ef6\u662f$f_i<f_j$\u548c$s_i<s_j$\uff0c\u53ea\u4e0d\u8fc7\u591a\u4e86\u4e00\u90e8\u5206$f_j<s_i$\u3002  \n\u5148\u6309\u7167$s$\u5347\u5e8f\u6392\u5e8f\u540e\u5206\u6cbb\u3002  \n\u5047\u8bbe\u6211\u4eec\u5de6\u53f3\u533a\u95f4\u5df2\u7ecf\u6309\u7167$f$\u5347\u5e8f\u6392\u5e8f\u597d\u4e86\u3002  \n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5de6\u53f3\u53cc\u6307\u9488\u904d\u5386\uff0c\u66b4\u529b\u8ba1\u7b97\u7b54\u6848\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6\u5e94\u8be5\u662f$\\mathcal O(mlog_2n)$\u3002  \n## \u300c\u4ee3\u7801\u300d\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long double ld;\n\nconst int N = 1e5 + 5;\nconst ld eps = 1e-19;\n\nld K[N], B[N], a[N];\nint n, m;\nvector<int> v[N];\nint L[N], R[N];\n\nstruct Fenwick {\n  int tr[N], n;\n  \n  void init(int _n) {\n    n = _n;\n    memset(tr, 0, sizeof tr);\n  }\n  void modify(int p, int v) {\n    for (; p <= n; p += p & -p) {\n      tr[p] += v;\n    }\n  }\n  int query(int p) {\n    int ans = 0;\n    for (; p >= 1; p -= p & -p) {\n      ans += tr[p];\n    }\n    return ans;\n  }\n} bit;\n\nint sgn(ld x) {\n  return (fabs(x) <= eps) ? 0 : (x < 0 ? -1 : 1);\n}\nbool cmp1(ld x, ld y) {\n  return sgn(x - y) == 0;\n}\nbool cmp2(ld x, ld y) {\n  return sgn(x - y) < 0;\n}\n\nbool check(ld r) {\n  int cnt = 0;\n  for (int i = 1; i <= n; i++) {\n    ld del = r * r + K[i] * K[i] * r * r - B[i] * B[i];\n    if (sgn(del) >= 0) {\n      del = sqrt(del);\n      ld x1 = (-K[i] * B[i] + del) / (1 + K[i] * K[i]);\n      ld y1 = x1 * K[i] + B[i];\n      ld x2 = (-K[i] * B[i] - del) / (1 + K[i] * K[i]);\n      ld y2 = x2 * K[i] + B[i];\n      a[++cnt] = atan2(y1, x1);\n      a[++cnt] = atan2(y2, x2);\n    }\n  }\n  sort(a + 1, a + 1 + cnt, cmp2);\n  cnt = unique(a + 1, a + 1 + cnt, cmp1) - a - 1;\n  bit.init(cnt);\n  for (int i = 1; i <= cnt; i++) {\n    v[i].clear();\n  }\n  for (int i = 1; i <= n; i++) {\n    ld del = r * r + K[i] * K[i] * r * r - B[i] * B[i];\n    if (sgn(del) >= 0) {\n      del = sqrt(del);\n      ld x1 = (-K[i] * B[i] + del) / (1 + K[i] * K[i]);\n      ld y1 = x1 * K[i] + B[i];\n      ld x2 = (-K[i] * B[i] - del) / (1 + K[i] * K[i]);\n      ld y2 = x2 * K[i] + B[i];\n      L[i] = lower_bound(a + 1, a + 1 + cnt, atan2(y1, x1), cmp2) - a;\n      R[i] = lower_bound(a + 1, a + 1 + cnt, atan2(y2, x2), cmp2) - a;\n      if (L[i] > R[i]) {\n        swap(L[i], R[i]);\n      }\n      v[L[i]].push_back(i);\n    }\n  }\n  long long ans = 0;\n  for (int i = 1; i <= cnt; i++) {\n    for (int j = 0; j < (int)v[i].size(); j++) {\n      ans += bit.query(R[v[i][j]]) - bit.query(L[v[i][j]] - 1);\n      bit.modify(R[v[i][j]], 1);\n    }\n  }\n  return ans >= m;\n}\n\nstruct Data {\n  int l, r, id;\n  \n  bool operator < (const Data& b) const {\n    return r < b.r;\n  }\n} b[N], c[N];\n\nld ans;\nint tot, sum;\n\nld calc(int i, int j) {\n  ld x = (B[j] - B[i]) / (K[i] - K[j]);\n  ld y = K[i] * x + B[i];\n  return sqrt(x * x + y * y);\n}\n\nvoid cdq(int l, int r) {\n  if (l == r) {\n    return;\n  }\n  int mid = (l + r) >> 1;\n  cdq(l, mid);\n  cdq(mid + 1, r);\n  int p = l, q = mid + 1, t = l;\n  while (p <= mid && q <= r) {\n    if (b[p].l < b[q].l) {\n      for (int i = q; i <= r; i++) {\n        if (b[i].l >= b[p].r) {\n          break;\n        }\n        tot++;\n        ans += calc(b[p].id, b[i].id);\n      }\n      c[t++] = b[p++];\n    } else {\n      c[t++] = b[q++];\n    }\n  }\n  while (p <= mid) {\n    c[t++] = b[p++];\n  }\n  while (q <= r) {\n    c[t++] = b[q++];\n  }\n  for (int i = l; i <= r; i++) {\n    b[i] = c[i];\n  }\n}\n\nld getAns(ld r) {\n  int cnt = 0;\n  for (int i = 1; i <= n; i++) {\n    ld del = r * r + K[i] * K[i] * r * r - B[i] * B[i];\n    if (sgn(del) >= 0) {\n      del = sqrt(del);\n      ld x1 = (-K[i] * B[i] + del) / (1 + K[i] * K[i]);\n      ld y1 = x1 * K[i] + B[i];\n      ld x2 = (-K[i] * B[i] - del) / (1 + K[i] * K[i]);\n      ld y2 = x2 * K[i] + B[i];\n      a[++cnt] = atan2(y1, x1);\n      a[++cnt] = atan2(y2, x2);\n    }\n  }\n  sort(a + 1, a + 1 + cnt, cmp2);\n  cnt = unique(a + 1, a + 1 + cnt, cmp1) - a - 1;\n  sum = 0;\n  tot = 0;\n  for (int i = 1; i <= n; i++) {\n    ld del = r * r + K[i] * K[i] * r * r - B[i] * B[i];\n    if (sgn(del) >= 0) {\n      del = sqrt(del);\n      ld x1 = (-K[i] * B[i] + del) / (1 + K[i] * K[i]);\n      ld y1 = x1 * K[i] + B[i];\n      ld x2 = (-K[i] * B[i] - del) / (1 + K[i] * K[i]);\n      ld y2 = x2 * K[i] + B[i];\n      int p, q;\n      p = lower_bound(a + 1, a + 1 + cnt, atan2(y1, x1), cmp2) - a;\n      q = lower_bound(a + 1, a + 1 + cnt, atan2(y2, x2), cmp2) - a;\n      sum++;\n      b[sum].l = min(p, q);\n      b[sum].r = max(p, q);\n      b[sum].id = i;\n    }\n  }\n  sort(b + 1, b + 1 + sum);\n  cdq(1, sum);\n  return ans + (m - tot) * r;\n}\n\nint main() {\n  ios::sync_with_stdio(false);\n  cin.tie(0);\n  cout.tie(0);\n  ld p, q;\n  cin >> n >> p >> q >> m;\n  p /= 1000.0, q /= 1000.0;\n  for (int i = 1; i <= n; i++) {\n    cin >> K[i] >> B[i];\n    K[i] /= 1000.0;\n    B[i] /= 1000.0;\n    B[i] = -q + B[i] + K[i] * p;\n  }\n  ld l = 0, r = 1e10;\n  for (int i = 1; i <= 100; i++) {\n    ld mid = (l + r) / 2.0;\n    if (check(mid)) {\n      r = mid;\n    } else {\n      l = mid;\n    }\n  }\n  cout << fixed << setprecision(9) << getAns(l) << endl;\n  return 0; \n}\n```\n## \u300c\u540e\u8bb0\u300d\n\u4e0d\u5f97\u4e0d\u8bf4\u8fd9\u4e00\u9053\u9898\u76ee\u7efc\u5408\u4e86\u591a\u4e2a\u77e5\u8bc6\u70b9\uff0c\u662f\u4e00\u9053\u4e0d\u53ef\u591a\u5f97\u7684\u597d\u9898\u3002  \n\u8fd9\u9053\u9898\u76ee\u88ab\u51fa\u5728\u4e86\u5e38\u4e2d\u96c6\u8bad\u7684\u9898\u76ee\uff0c\u4f46\u662f\u8fd9\u4efd\u4ee3\u7801\u6ca1\u6cd5\u901a\u8fc7\u5e38\u4e2d\u7684\u6570\u636e\uff0c\u5e94\u8be5\u662f\u6807\u7a0b\u7684\u8bef\u5dee\u548c\u8fd9\u4efd\u4ee3\u7801\u7684\u8bef\u5dee\u53cd\u5411\u4e86\uff0c\u5bfc\u81f4\u4f1aWA\u6389\u3002  \n\u4f46\u662f\u5728CF\u4e0a\u9762\u8fd8\u662f\u53ef\u4ee5AC\u7684\u3002  ",
        "postTime": 1580396844,
        "uid": 35567,
        "name": "Ayers",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 CF607E \u3010Cross Sum\u3011"
    }
]