[
    {
        "content": "> [CF616F Expensive Strings \u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF616F)\n\n> \u9898\u610f\u7b80\u8ff0\uff1a\u7ed9\u51fa $t_{1,2,\\cdots,n}$ \u548c $c_{1,2,\\cdots,n}$\uff0c\u6c42 $\\max f(s)=\\sum_i^n c_i\\times p_{s,i} \\times |s|$ \u7684\u6700\u5927\u503c\uff0c\u5176\u4e2d $s$ \u4e3a\u4efb\u610f\u5b57\u7b26\u4e32\uff0c$p_{s,i}$ \u4e3a $s$ \u5728 $t_i$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n[\u6211\u7684 SAM \u5b66\u4e60\u7b14\u8bb0 \u2014\u2014 cnblogs](https://www.cnblogs.com/alex-wei/p/Suffix_Automaton.html)\u3002\n\n---\n\n\u5e7f\u4e49 SAM \u677f\u5b50\u9898\u3002\n\n\u8003\u8651 SAM \u4e0a\u6bcf\u4e2a\u72b6\u6001\u6240\u8868\u793a\u7684\u610f\u4e49\uff1a\u51fa\u73b0\u4f4d\u7f6e\u76f8\u540c\u7684\u5b57\u7b26\u4e32\u96c6\u5408\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e SAM \u4e0a\u7684\u4e00\u4e2a\u72b6\u6001 $t$\uff0c\u5b83\u6240\u8868\u793a\u7684\u6240\u6709\u5b57\u7b26\u4e32 $s$ \u7684 $\\sum_{i=1}^n c_i\\times p_{s,i}$ \u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u5b83\u5bf9\u7b54\u6848\u7684\u53ef\u80fd\u8d21\u732e\u5c31\u662f $\\sum_{i=1}^n c_i\\times p_{s,i}\\times len(t)$\u3002$\\sum_{i=1}^n c_i\\times p_{s,i}$ \u53ef\u4ee5\u76f4\u63a5\u5728 $link$ \u6811\u4e0a\u6811\u5f62 DP \u6c42\u51fa\u3002~~\u6211\u4e00\u5f00\u59cb\u8fd8\u4ee5\u4e3a\u8981\u7ebf\u6bb5\u6811\u5408\u5e76\uff0c\u505a\u9898\u505a\u50bb\u4e86\u3002~~\n\n\u4e00\u4e9b\u6ce8\u610f\u70b9\uff1a\u5982\u679c\u4f60\u5199\u7684\u662f $las=1$ \u7248\u672c\u7684\u4f2a\u5e7f\u4e49 SAM\uff0c\u5982\u679c\u4e0d\u5224\u91cd\uff0c\u53ef\u80fd\u4f1a\u5efa\u7a7a\u8282\u70b9 $p$\uff0c\u6b64\u65f6 $len(link(p))=len(p)$\u3002\u6240\u4ee5\u7279\u5224\u4e00\u4e0b\u8fd9\u79cd\u60c5\u51b5\u5c31\u884c\u4e86\uff0c\u5426\u5219\u4f1a WA on 16\uff0c\u5e76\u4e14 \u201cexpected 0\uff0cfound 500\u201d\u3002\n\n\u540c\u65f6\uff0c\u7b54\u6848\u7684\u521d\u59cb\u503c\u5e94\u8d4b\u4e3a $0$ \u800c\u4e0d\u662f $-\\infty$\uff0c\u56e0\u4e3a\u53ea\u8981\u8ba9 $s$ \u4e0d\u5728\u4efb\u4f55\u4e00\u4e2a $t_i$ \u4e2d\u51fa\u73b0\u8fc7\u5c31\u53ef\u4ee5 $f(s)=0$\u3002\n\n~~\u4e00\u5f00\u59cb\u76f4\u63a5\u62ff P4022 \u719f\u6089\u7684\u6587\u7ae0 \u7684\u5e7f\u4e49 SAM \u5199\u7684\uff0c\u90a3\u4e2a\u9898\u76ee\u662f 01 \u4e32\uff0c\u6240\u4ee5\u590d\u5236\u513f\u5b50\u53ea\u590d\u5236\u4e86 0 \u548c 1\uff08\u8fd9\u9898\u5c31\u662f a \u548c b\uff09\uff0c\u7136\u540e\u8fc7\u4e86 43 \u4e2a\u6d4b\u8bd5\u70b9\u3002~~\n\n```cpp\n/*\n\tPowered by C++11.\n\tAuthor : Alex_Wei.\n*/\n\n#include <bits/stdc++.h>\nusing namespace std;\n\n//#pragma GCC optimize(3)\n\n//using int = long long\n//using i128 = __int128;\n\nusing uint = unsigned int;\nusing ll = long long;\nusing ull = unsigned long long;\nusing db = double;\nusing ld = long double;\nusing pii = pair <int,int>;\nusing pll = pair <ll,ll>;\nusing pdd = pair <double,double>;\nusing vint = vector <int>;\nusing vpii = vector <pii>;\n\n#define fi first\n#define se second\n#define pb emplace_back\n#define mpi make_pair\n#define all(x) x.begin(),x.end()\n#define sor(x) sort(all(x))\n#define rev(x) reverse(all(x))\n#define mem(x,v) memset(x,v,sizeof(x))\n#define mcpy(x,y) memcpy(x,y,sizeof(y))\n#define Time 1.0*clock()/CLOCKS_PER_SEC\n\nconst int N=1e6+5;\n\n// Suffix_Automaton\nint cnt,las;\nint fa[N],len[N],son[N][26];\nll val[N];\nvector <int> e[N];\nvoid ins(int it,int v){\n\tint p=las,cur=++cnt;\n\tlen[cur]=len[las]+1,las=cur,val[cur]=v;\n\twhile(p&&!son[p][it])son[p][it]=cur,p=fa[p];\n\tif(!p)return fa[cur]=1,void();\n\tint q=son[p][it];\n\tif(len[p]+1==len[q])return fa[cur]=q,void();\n\tint cl=++cnt;\n\tfa[cl]=fa[q],fa[q]=fa[cur]=cl,len[cl]=len[p]+1;\n\tmcpy(son[cl],son[q]);\n\twhile(p&&son[p][it]==q)son[p][it]=cl,p=fa[p];\n} void build(string s,int v){\n\tlas=1;\n\tfor(int i=0;i<s.size();i++)ins(s[i]-'a',v);\n} void dfs(int id){\n\tfor(int it:e[id])dfs(it),val[id]+=val[it];\n}\n\nint n;\nll ans;\nstring s[N];\nint main(){\n\tcin>>n,cnt=1;\n\tfor(int i=1;i<=n;i++)cin>>s[i];\n\tfor(int i=1,c;i<=n;i++)cin>>c,build(s[i],c);\n\tfor(int i=1;i<=cnt;i++)e[fa[i]].pb(i);\n\tdfs(1); for(int i=1;i<=cnt;i++)if(len[fa[i]]!=len[i])ans=max(ans,len[i]*val[i]);\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1613877630,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF616F Expensive Strings"
    },
    {
        "content": "\u9898\u89e3\u90fd\u662f\u5e7f\u4e49 SAM \u2026\u2026\u6211\u4e0d\u4f1a\u3002\u8003\u8651 SA \u505a\u6cd5\u3002\n\n\u5148\u628a\u6240\u6709\u4e32\u63a5\u8d77\u6765\uff0c\u63d2\u5165\u4e0d\u540c\u7684\u5206\u9694\u7b26\uff0c\u7136\u540e\u8dd1\u4e00\u904d SA\u3002\n\n\u90a3\u4e48\u8fd9\u4e2a $f(s)$ , \u5176\u5b9e\u5c31\u662f\u51fa\u73b0\u7684\u6240\u6709\u4f4d\u7f6e\u7684\u6743\u503c\u548c\u4e58\u4e0a\u5b83\u7684\u957f\u5ea6\u3002\n\nQ\uff1as \u5305\u542b\u4e86\u95f4\u9694\u7b26\u5462\uff1f\n\nA\uff1a\u56e0\u4e3a\u95f4\u9694\u7b26\u4e92\u4e0d\u76f8\u540c\uff0c\u5b83\u5fc5\u7136\u53ea\u4f1a\u51fa\u73b0\u4e00\u6b21\u3002\u540e\u9762\u7279\u5224\u3002\n\n\u8003\u8651\u6240\u6709\u957f\u5ea6\u4e3a $L$ \u7684\u5b50\u4e32\uff0c\u5982\u679c\u5de6\u7aef\u4e3a $a$ \u548c\u5de6\u7aef\u4e3a $b$ \u7684\u5b50\u4e32\u76f8\u540c\uff0c\u90a3\u4e48\u6709 $L\\le lcp(s_a,s_b)$  \uff0c\u5176\u4e2d $s_i$ \u8868\u793a\u6574\u4e2a\u4e32\u5de6\u7aef\u4e3a $i$ \u7684\u540e\u7f00\u3002\n\n\u7136\u540e\u5c31\u53d1\u73b0\uff0c$lcp(s_a,s_b)=\\min_{i=rk_a+1}^{rk_b}h_i$ \uff0c\u6240\u4ee5\u5bf9\u4e8e $rk_a< i \\le rk_b $ \uff0c\u6709 $L\\le h_i$ \u3002\u7c7b\u4f3c\u54c1\u9152\u5927\u4f1a\u7684\u5957\u8def\uff0c\u5efa\u4e2a\u56fe\uff0c\u5982\u679c $rk_a,rk_b$ \u5728\u4e00\u4e2a\u8054\u901a\u5757\uff0c\u5219 $L\\le lcp(s_a,s_b)$ \u3002\n\n\u628a $L$ \u4ece\u5927\u5230\u5c0f\u8003\u8651\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u6240\u6709\u7684 $h_i=L$ ,\u628a $i$ \u548c $i-1$ \u4e4b\u95f4\u8fde\u4e00\u6761\u8fb9\u3002\u540c\u65f6\u7ef4\u62a4\u4e00\u4e0b\u5f53\u524d\u8054\u901a\u5757\u7684\u6743\u503c\u548c\uff0c\u628a\u7b54\u6848\u7528\u6bcf\u4e2a\u65b0\u8054\u901a\u5757\u7684 $L\\cdot sz$ \u66f4\u65b0\u5373\u53ef\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u6743\u503c\u5b58\u5728\u8d1f\u6570\uff0c\u6240\u4ee5\u5bf9\u6bcf\u4e2a $L$ ,\u5f97\u5148\u8fde\u5b8c\u8fb9\uff0c\u518d\u66f4\u65b0\u7b54\u6848\u3002\n\nQ\uff1a\u5982\u679c $L$ \u53d8\u5c0f\uff0c$sz$ \u4e3a\u8d1f\u6570\uff0c\u8054\u901a\u5757\u6743\u503c\u4e0d\u662f\u53d8\u5927\u4e86\u5417\uff1f\n\nA\uff1a$L$ \u662f\u6b63\u6570\uff0c\u6240\u4ee5\u6743\u503c\u662f\u8d1f\u7684\uff0c\u53ef\u53d6\u7a7a\u4e32\u5c31\u80fd\u4f7f $ans=0$ \u3002\n\n\u4e0a\u9762\u90e8\u5206\uff0c $ans$ \u90fd\u662f\u7528\u65b0\u8054\u901a\u5757\u66f4\u65b0\u7684\uff0c\u6240\u4ee5\u6ca1\u6709\u4e32\u53ea\u51fa\u73b0\u4e00\u6b21\u7684\u60c5\u51b5\uff0c\u90fd\u662f\u5408\u6cd5\u7684\u4e32\u3002\u90a3\u4e48\u51fa\u73b0\u4e00\u6b21\u7684\u4e32\uff0c\u9996\u5148\u5de6\u7aef\u4e0d\u80fd\u662f\u95f4\u9694\u7b26\uff1b\u5176\u6b21\uff0c\u4ee4\u5de6\u7aef\u4e3a $i$ , \u5219\u6709 $\\max(h_{rk_i},h_{rk_i+1})+1\\le p$ \uff0c\u5176\u4e2d $p$ \u4e3a\u5de6\u7aef $i$ \u80fd\u53d6\u5230\u7684\u6700\u957f\u4e32\u3002\u6839\u636e\u4e0a\u9762\u7684\u8ba8\u8bba\uff0c\u8fd9\u6837\u5c31\u6db5\u76d6\u4e86\u6700\u4f18\u89e3\u3002\u505a\u5b8c\u4e86\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nint c[600010];char p[500010];int m=128,rk[600010],sa[600010],t[600010],tr[600010],h[600010];\nvector<int>g[600010];\nvoid SA(int n){\n\tfor(int i=1;i<=n;i++)t[rk[i]=c[i]]++;\n\tfor(int i=1;i<=m;i++)t[i]+=t[i-1];\n\tfor(int i=1;i<=n;i++)sa[t[c[i]]--]=i;\n\tfor(int k=1;;k<<=1){\n\t\tint p=0;\n\t\tfor(int i=1;i<=m;i++)t[i]=0;\n\t\tfor(int i=n-k+1;i<=n;i++)tr[++p]=i;\n\t\tfor(int i=1;i<=n;i++)if(sa[i]>k)tr[++p]=sa[i]-k;\n\t\tfor(int i=1;i<=n;i++)t[rk[i]]++;\n\t\tfor(int i=1;i<=m;i++)t[i]+=t[i-1];\n\t\tfor(int i=n;i>=1;i--)sa[t[rk[tr[i]]]--]=tr[i];\n\t\tp=1;swap(tr,rk);rk[sa[1]]=1;\n\t\tfor(int i=2;i<=n;i++)rk[sa[i]]=(tr[sa[i]]==tr[sa[i-1]]&&tr[sa[i]+k]==tr[sa[i-1]+k])?p:++p;\n\t\tif(n==p)break;m=p;\n\t}\n\tfor(int i=1,k=0;i<=n;i++){\n\t\tif(k)k--;int j=sa[rk[i]-1];\n\t\twhile(c[i+k]==c[j+k])k++;\n\t\tg[k].push_back(rk[i]);h[rk[i]]=k;\n\t}\n}\nint n,l[100010],f[600010],cp[600010],lp[100010];ll v[100010],sz[600010],ans;\nint find(int x){if(x==f[x])return x;return f[x]=find(f[x]);}\nll merge(int u,int v){\n\tu=find(u),v=find(v);f[u]=v;sz[v]+=sz[u];\n\treturn sz[v];\n}\nint main(){\n\tint len=0;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%s\",p);l[i]=strlen(p);\n\t\tfor(int j=0;j<l[i];j++)c[++len]=p[j],cp[len]=i;\n\t\tlp[i]=len;if(i<n)m++,c[++len]=m;\n\t}\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&v[i]);\n\tSA(len);\n\tfor(int i=1;i<=len;i++){\n\t\tf[i]=i,sz[i]=v[cp[sa[i]]];\n\t\tif(max(h[i],h[i+1])+1<=lp[cp[sa[i]]]-sa[i]+1)ans=max(ans,(lp[cp[sa[i]]]-sa[i]+1)*sz[i]);\n\t}\n\tfor(int i=len;i;i--){\n\t\tfor(int j=0;j<g[i].size();j++)merge(g[i][j]-1,g[i][j]);\n\t\tfor(int j=0;j<g[i].size();j++)ans=max(ans,sz[find(g[i][j])]*i);\n\t}\n\treturn printf(\"%lld\",ans),0;\n}\n```\n",
        "postTime": 1624945903,
        "uid": 223624,
        "name": "Apollo13",
        "ccfLevel": 8,
        "title": "CF616F"
    },
    {
        "content": "\u51e0\u4f4d\u795e\u4ed9\u8bb2\u7684 SA \u505a\u6cd5\u6211\u90fd\u4e0d\u592a\u660e\u767d\uff0c\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u601d\u8003\u6211\u7ec8\u4e8e\u7406\u89e3\u4e86\u4e00\u70b9\u3002\n\n\u6211\u4eec\u5148\u628a\u8fd9\u4e9b\u5b57\u7b26\u4e32\u4e32\u8d77\u6765\uff0c\u7136\u540e\u4e2d\u95f4\u7684\u5206\u9694\u7b26\u53f7\u7528 `'z'+i`\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5206\u9694\u7b26\u53f7\u4e0d\u4f1a\u5f71\u54cd\u6211\u4eec\u540e\u7f00\u6392\u5e8f\u3002\n\n\u7136\u540e\u6211\u4eec\u9700\u8981\u77e5\u9053\u7684\u662f\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u76ee\u6807\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u4ed6\u51fa\u73b0\u4e86\u4e24\u6b21\uff0c\u90a3\u4e48\u5fc5\u7136\u662f\u67d0\u4e2a\u6392\u540d\u4e3a $i$ \u548c\u6392\u540d\u4e3a $i+1$ \u7684 LCP\u3002\n\n---\n\n\u8bc1\u660e\u662f\u8fd9\u6837\u7684\uff0c\u5047\u5982\u8bf4\u8fd9\u4e2a\u4e0d\u662f LCP\uff0c\u8bbe\u8fd9\u4e2a\u5b57\u7b26\u4e32\u662f $s1$\uff0c\u90a3\u4e48\u5fc5\u7136\u4f1a\u5b58\u5728\u4e00\u4e2a LCP\uff0c\u8bbe\u4e3a $s2$\uff0c\u4f7f\u5f97 $s1$ \u662f $s2$ \u7684\u524d\u7f00\u3002\n\n\u90a3\u4e48\u6211\u4eec\u770b\u770b\u8fd9\u4e2a\u67ff\u5b50\u4f1a\u53d1\u73b0\uff0c\u51fa\u73b0\u6b21\u6570\u662f\u4e0d\u53d8\u7684\uff0c\u5982\u679c\u53d1\u751f\u4e86\u6539\u53d8\u90a3\u4e48\u5fc5\u7136\u662f\u6709\u5355\u72ec\u7684\u4e00\u4e2a $s1$\uff0c\u6240\u6709 $s1$ \u51fa\u73b0\u7684\u5730\u65b9\uff0c\u80af\u5b9a\u90fd\u662f\u88ab $s2$ \u7ed9\u8986\u76d6\u7684\u3002\n\n\u8bbe $|s|$ \u4e3a\u5b57\u7b26\u4e32 $s$ \u7684\u957f\u5ea6\u3002\n\n\u7136\u540e\u6211\u4eec\u5c06\u8fd9\u4e2a\u67ff\u5b50\u7a0d\u5fae\u6539\u4e00\u6539\u5c31\u53d8\u6210\u4e86 $|s| \\sum c_i \\times p_{i,s}$\uff0c\u5047\u5982\u8bf4 $\\sum c_i \\times p_{i,s}$ \u662f\u8d1f\u6570\uff0c\u90a3\u4e48\u5fc5\u7136\u4e00\u70b9\u7528\u5904\u90fd\u6ca1\u6709\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u968f\u4fbf\u9009\u4e00\u4e2a\u672a\u51fa\u73b0\u8fc7\u7684\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u8bf4\u540e\u9762\u90a3\u4e2a\u548c\u80af\u5b9a\u662f\u4e00\u4e2a\u6b63\u6570\uff0c\u7531\u4e8e\u8981\u6c42\u7b54\u6848\u5c3d\u91cf\u5927\uff0c\u6240\u6709\u957f\u5ea6\u80af\u5b9a\u662f\u8d8a\u957f\u8d8a\u597d\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8bc1\u660e\u4e86\u4e0a\u9762\u90a3\u4e2a\u7ed3\u8bba\n\n---\n\n\u7136\u540e\u6211\u4eec\u5c31\u9700\u8981\u7528 SA \u7684\u7ecf\u5178\u5957\u8def\u4e86\uff0c\u76f8\u4fe1\u5b66\u8fc7 SA \u7684\u90fd\u5e94\u8be5\u505a\u8fc7 P4248 [AHOI2013]\u5dee\u5f02 \uff0c\u5bf9\u4e8e\u4e00\u4e2a LCP \u800c\u8a00\uff0c\u4ed6\u80fd\u6269\u5c55\u5230\u7684\u5de6\u8fb9\u754c\u662f height \u90fd\u5927\u4e8e\u4ed6\u7684\u5730\u65b9\uff0c\u53f3\u8fb9\u754c\u4e5f\u662f\u4e00\u6837\u7684\u3002\n\n\u6211\u4eec\u8ba1\u7b97\u5f53\u524d\u8fd9\u4e2a\u5b57\u7b26\u4e32\u6bcf\u4e00\u4e2a\u70b9\u662f\u5728\u54ea\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u8d4b\u503c\u4e3a\u5bf9\u5e94\u7684 $c_i$\uff0c\u505a\u4e00\u904d\u524d\u7f00\u548c\u5c31\u80fd\u5feb\u901f\u7684\u7ef4\u62a4\u8fd9\u4e2a\u95ee\u9898\u4e86\uff01\n\n\u7136\u540e\u5bf9\u4e8e\u51fa\u73b0\u4e00\u6b21\u7684\u5b50\u4e32\u53ef\u4ee5\u66b4\u529b\u5224\u65ad\uff0c\u5373\u679a\u4e3e\u5934\uff0c\u7136\u540e\u5224\u65ad\u524d\u540e\u4e24\u4e2a height \u5c31\u53ef\u4ee5\u4e86\uff01\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long \nusing namespace std;\nconst int INF=2e6+5;\nint n,rk[INF],sa[INF],sa1[INF],sum[INF],rk1[INF],he[INF],c[INF],m,vis[INF],q[INF],r;\nint L[INF],R[INF],P[INF];\nint aa[INF];\nsigned main()\n{\n    ios::sync_with_stdio(false);\n    cin>>m;\n    for (int i=1;i<=m;i++) {\n        string s1;cin>>s1;\n        // s2=s2+(char)(i+'z')+s1;\n        aa[++n]=(i+'z');\n        for (char i:s1) aa[++n]=i;\n    }\n    for (int i=1;i<=n;i++) sa[i]=i,rk[i]=aa[i]-'a'+1;\n    for (int i=1;i<=m;i++) cin>>c[i];\n    int l=0;\n    for (int i=1;i<=n;i++) {\n        if (aa[i]>='a' && aa[i]<='z') vis[i]=l;\n        else l++;\n    }\n    for (int i=n;i>=1;i--)\n        if (aa[i]>='a' && aa[i]<='z') P[i]=P[i+1]+1;\n    for (int w=1;w<n;w*=2) {\n        int N=1e5;\n        for (int i=0;i<=n+N;i++) sum[i]=0;\n        for (int i=1;i<=n;i++) sum[rk[sa[i]+w]]++;\n        for (int i=1;i<=n+N;i++) sum[i]+=sum[i-1];\n        for (int i=n;i;i--) \n            sa1[sum[rk[sa[i]+w]]--]=sa[i];\n        for (int i=1;i<=n;i++) sa[i]=sa1[i];\n\n        for (int i=0;i<=n+N;i++) sum[i]=0;\n        for (int i=1;i<=n;i++) sum[rk[sa[i]]]++;\n        for (int i=1;i<=n+N;i++) sum[i]+=sum[i-1];\n        for (int i=n;i;i--) \n            sa1[sum[rk[sa[i]]]--]=sa[i];\n        for (int i=1;i<=n;i++) sa[i]=sa1[i];\n\n        for (int i=1;i<=n;i++) rk1[i]=rk[i];\n        int tot=0;\n        for (int i=1;i<=n;i++)\n            if (i>1 && rk1[sa[i-1]+w]==rk1[sa[i]+w] && rk1[sa[i]]==rk1[sa[i-1]]) rk[sa[i]]=tot;\n            else rk[sa[i]]=++tot;\n    }\n    // cout<<n<<\"\\n\";\n    // for (int i=1;i<=n;i++) cout<<aa[i]<<\" \";\n    // cout<<\"\\n\";\n\n    // for (int i=1;i<=n;i++) cout<<sa[i]<<\" \";\n    // cout<<\"\\n\";\n\n    for (int i=1;i<=n;i++) rk[sa[i]]=i;\n    for (int i=1;i<=n;i++) {\n        if (rk[i]==1) continue;\n        if (he[i-1]) he[i]=he[i-1]-1;\n        int j=sa[rk[i]-1];\n        while (j+he[i]<=n && i+he[i]<=n && aa[j+he[i]]==aa[i+he[i]]) he[i]++;\n        // if (i==8) cout<<j<<\" \"<<i<<\" \"<<he[i]<<\" ???\\n\";\n    }\n    // cout<<s2<<\" \"<<n<<\" endl\\n\";\n    // for (int i=1;i<=37;i++) cout<<i<<\" \"<<sa[i]<<\" \"<<he[sa[i]]<<\" \"<<he[37]<<\" kelkel\\n\";\n    for (int i=1;i<=n;i++) sum[i]=sum[i-1]+c[vis[sa[i]]];\n    int ans=0;r=0;\n    for (int i=2;i<=n;i++) {\n        while (r && he[sa[q[r]]]>=he[sa[i]]) r--;\n        if (r) L[i]=q[r]+1;\n        else L[i]=1;\n        q[++r]=i;\n    }\n    r=0;\n    for (int i=n;i>1;i--) {\n        while (r && he[sa[q[r]]]>=he[sa[i]]) r--;\n        if (r) R[i]=q[r]-1;\n        else R[i]=n;\n        q[++r]=i;\n    }\n\n    for (int i=1;i<=n;i++) {\n        if (aa[i]<'a' || aa[i]>'z') continue;\n        // he[i] & he[sa[rk[i]+1]]\n        // cout<<i<<\" \"<<c[vis[i]]<<\" \"<<P[i]<<\" \"<<he[i]<<\" \"<<he[sa[rk[i]+1]]<<\" \"<<sa[rk[i]-1]<<\" bomb\\n\";\n        if (max(he[i],he[sa[rk[i]+1]])!=P[i]) \n             ans=max(ans,c[vis[i]]*P[i]);\n    }\n\n    for (int i=2;i<=n;i++) {\n        // cout<<i<<\" \"<<he[sa[i]]<<\" \"<<(sum[R[i]]-sum[max(0ll,L[i]-2)])<<\" kqwe\\n\";\n        // cout<<sa[i]<<\" \"<<sa[i-1]<<\" \"<<L[i]<<\" \"<<R[i]<<\" oqwe\\n\"; \n        ans=max(ans,he[sa[i]]*(sum[R[i]]-sum[max(0ll,L[i]-2)]));\n    }\n    cout<<ans<<\"\\n\";\n    return 0;\n}\n```\n\n\n\u6709\u4e0d\u61c2\u7684\u8fd8\u8bf7\u6307\u51fa\u3002",
        "postTime": 1671771558,
        "uid": 128754,
        "name": "\u65b9123456",
        "ccfLevel": 0,
        "title": "CF616F"
    },
    {
        "content": "\u9996\u5148\uff0c\u82e5\u6211\u4eec\u9700\u8981\u7684 $s$ \u81f3\u5c11\u5728\u67d0\u4e2a\u4e32\u91cc\u51fa\u73b0\u4e86\u4e00\u6b21\uff0c\u5219\u5176\u4e00\u5b9a\u662f\u6240\u6709\u4e32\u4e2d\u67d0\u4e9b\u4e32\u7684\u5b50\u4e32\u3002\u4e8e\u662f\u6211\u4eec\u5efa\u7acb\u5e7f\u4e49SAM\u3002\n\n\u5e7f\u4e49SAM\u4e2d\u6240\u6709\u8282\u70b9\u6db5\u76d6\u4e86\u6240\u6709 $n$ \u4e2a\u4e32\u7684\u6240\u6709\u5b50\u4e32\u3002\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u4f9d\u6b21\u904d\u5386\u6240\u6709\u8282\u70b9\uff0c\u627e\u5230\u6240\u6709\u8282\u70b9\u4e2d\u6700\u4f18\u7684\u90a3\u4e00\u4e2a\u8282\u70b9\u5373\u53ef\u3002\n\n\u8003\u8651\u4e00\u4e2a\u8282\u70b9\u7684\u8d21\u732e\uff0c\u5373\u4e3a\u5176\u5bf9\u5e94\u7684 $\\text{endpos}$ \u96c6\u5408\u4e2d\u6240\u6709\u4e32\u7684\u8d21\u732e\u3002\u6211\u4eec\u8003\u8651\u5c06\u8d21\u732e\u8ba1\u7b97\u516c\u5f0f $\\sum\\limits_{i=1}^nc_i\\times p_{s,i}\\times|s|$ \u62c6\u5f00\uff0c\u62c6\u6210 $\\Big(\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{p_{s,i}}c_i\\Big)|s|$\u3002\u663e\u7136\uff0c\u5bf9\u4e8e\u67d0\u4e2a\u56fa\u5b9a\u7684\u8282\u70b9\u5185\u7684\u4e32\u7684\u8d21\u732e\uff0c\u62ec\u53f7\u5185\u7684\u4e1c\u897f\u603b\u662f\u76f8\u7b49\uff08$\\text{endpos}$ \u96c6\u5408\u4e0d\u53d8\uff09\uff0c\u5f71\u54cd\u5176\u7684\u53ea\u6709 $|s|$\u3002\u663e\u7136\uff0c\u5f53\u62ec\u53f7\u5185\u7684\u4e1c\u897f $>0$ \u65f6\uff0c$|s|$ \u8d8a\u5927\u8d8a\u597d\uff0c\u56e0\u6b64\u6b64\u65f6\u5c31\u76f4\u63a5\u53d6 $|s|=len$ \u5373\u53ef\u3002\u800c\u5f53\u62ec\u53f7\u5185\u7684\u4e1c\u897f $\\leq0$ \u65f6\uff0c\u663e\u7136\u65e0\u8bba $|s|$ \u600e\u4e48\u53d6\uff0c\u8fd9\u4e00\u5927\u5768\u4e1c\u897f\u6700\u7ec8\u7684\u7ed3\u679c\u90fd $\\leq0$\uff0c\u4e00\u5b9a\u4e0d\u4f18\u4e8e\u672a\u5728\u4efb\u4f55\u4e32\u5185\u51fa\u73b0\u7684 $s$\uff0c\u6545\u76f4\u63a5\u8df3\u8fc7\u5373\u53ef\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u62ec\u53f7\u91cc\u7684\u4e1c\u897f\u3002\u5176\u5c31\u662f\u5bf9\u4e8e $i$ \u4e32\u7684\u6bcf\u4e00\u6b21\u51fa\u73b0\uff0c\u90fd\u8ba1\u5165\u4e00\u6b21 $c_i$\u3002\u4e8e\u662f\u5c31\u5728 parent tree \u4e0aDP\uff0c\u6c42\u51fa $f_i$ \u8868\u793a\u4e0a\u8ff0\u62ec\u53f7\u5185\u4e1c\u897f\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n|\\Sigma|)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint n,cnt=1,S;\nstruct Suffix_Automaton{int ch[26],len,fa;}t[1000100];\nint Add(int x,int c){\n\tif(t[x].ch[c]){\n\t\tint y=t[x].ch[c];\n\t\tif(t[y].len==t[x].len+1)return y;//(x,c) has been added into the tree already.\n\t\tint yy=++cnt;t[yy]=t[y];\n\t\tt[yy].len=t[x].len+1,t[y].fa=yy;\n\t\tfor(;x&&t[x].ch[c]==y;x=t[x].fa)t[x].ch[c]=yy;\n\t\treturn yy;\n\t}\n\tint xx=++cnt;t[xx].len=t[x].len+1;\n\tfor(;x&&!t[x].ch[c];x=t[x].fa)t[x].ch[c]=xx;\n\tif(!x){t[xx].fa=1;return xx;}\n\tint y=t[x].ch[c];\n\tif(t[y].len==t[x].len+1){t[xx].fa=y;return xx;}\n\tint yy=++cnt;t[yy]=t[y];\n\tt[yy].len=t[x].len+1;\n\tt[y].fa=t[xx].fa=yy;\n\tfor(;x&&t[x].ch[c]==y;x=t[x].fa)t[x].ch[c]=yy;\n\treturn xx;\n}\nchar s[500100];\nvector<int>id[100100],v[1001000];\nll res,f[1001000];\nvoid dfs(int x){for(auto y:v[x])dfs(y),f[x]+=f[y];}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%s\",s),S=strlen(s);\n\t\tfor(int j=0,las=1;j<S;j++)id[i].push_back(las=Add(las,s[j]-'a'));\n\t}\n\tfor(int i=1,x;i<=n;i++){\n\t\tscanf(\"%d\",&x);\n\t\tfor(auto j:id[i])f[j]+=x;\n\t}\n\tfor(int i=2;i<=cnt;i++)v[t[i].fa].push_back(i);\n\tdfs(1);\n\tfor(int i=1;i<=cnt;i++)res=max(res,f[i]*t[i].len);\n\tprintf(\"%lld\\n\",res);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1611731268,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF616F \u3010Expensive Strings\u3011"
    },
    {
        "content": "\u672c\u9898\u8003\u67e5$parent$\u6811\u7684\u6027\u8d28\uff0c\u76f4\u63a5\u5728\u4e0a\u9762$dp$\u5373\u53ef\u3002\n\n\u5148\u5efa\u51fa$Trie$\u6811\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u7684\u4ef7\u503c\uff0c\u4e3a\u7ecf\u8fc7\u4ed6\u7684\u4e32\u7684\u4ef7\u503c\u4e4b\u548c\uff0c\u5bf9\u4e8e$Trie$\u6811\u5efa\u7acb\u5e7f\u4e49\u540e\u7f00\u81ea\u52a8\u673a\uff0c\u5982\u679c\u4f60\u4e0d\u4f1a\u5e7f\u4e49\u540e\u7f00\u81ea\u52a8\u673a\uff0c\u53ef\u4ee5\u79fb\u6b65 [P6139\u3010\u6a21\u677f\u3011\u5e7f\u4e49\u540e\u7f00\u81ea\u52a8\u673a\uff08\u5e7f\u4e49SAM\uff09](https://www.luogu.com.cn/problem/P6139) \u3002\n\n\u672c\u9898\u5efa\u5b8c\u5e7f\u4e49\u540e\u7f00\u81ea\u52a8\u673a\u540e\uff0c$dp$\u4e00\u4e0b\uff0c\u7edf\u8ba1\u7b54\u6848\u5c31$OK$\u4e86,$ans=\\max\\{dp[u]\\times len[u],ans\\}$\u3002\n\n**\u6ce8\u610f\u5f00$long\\ long$**\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\n#include<cstring>\n#include<queue>\n#include<vector>\n#define int long long\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\ninline int getint()\n{\n\tint x=0,f=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9')\n\t{\n\t\tif(ch=='-')f=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9')\n\t{\n\t\tx=(x<<3)+(x<<1)+(ch^48);\n\t\tch=getchar();\n\t}\n\treturn (f==1)?x:-x;\n}\nconst int maxn=1e6+5;\nint val[maxn];\nll dp[maxn],ans;\nstruct Trie\n{\n\tint tot;\n\tint ch[maxn][26];\n\tinline void insert(string s,int v)\n\t{\n\t\tint now=1;\n\t\tfor(int i=0;i<s.size();++i)\n\t\t{\n\t\t\tif(!ch[now][s[i]-'a'])\n\t\t\t{\n\t\t\t\tch[now][s[i]-'a']=++tot;\n\t\t\t}\n\t\t\tnow=ch[now][s[i]-'a'];\n\t\t\tval[now]+=v;\n\t\t}\n\t}\n}trie;\nint last=1,tot=1,fa[maxn],now[maxn],p[maxn],sz,len[maxn];\nstruct edge\n{\n\tint v,nxt;\n\tedge(){}\n\tedge(int vv,int nn){v=vv,nxt=nn;}\n}e[maxn];\nstruct SAM\n{\n\tint son[maxn][26],val[maxn];\n\tinline void insert(int c,int p)\n\t{\n\t\tint np=++tot;\n\t\tlast=np,len[np]=len[p]+1;\n\t\twhile(p&&!son[p][c])son[p][c]=np,p=fa[p];\n\t\tif(!p)fa[np]=1;\n\t\telse\n\t\t{\n\t\t\tint q=son[p][c];\n\t\t\tif(len[q]==len[p]+1)fa[np]=q;\n\t\t\telse\n\t\t\t{\n\t\t\t\tint nq=++tot;\n\t\t\t\tlen[nq]=len[p]+1;\n\t\t\t\tmemcpy(son[nq],son[q],sizeof(son[q]));\n\t\t\t\tfa[nq]=fa[q];\n\t\t\t\tfa[np]=fa[q]=nq;\n\t\t\t\twhile(p&&son[p][c]==q)son[p][c]=nq,p=fa[p];\n\t\t\t}\n\t\t}\n\t}\n}sam;\ninline void add(int u,int v)\n{\n\te[++sz]=edge(v,p[u]);\n\tp[u]=sz;\n}\ninline void dfs1(int u)\n{\n\tint temp=last;\n\tdp[last]=val[u];\n\tfor(int i=0;i<=25;++i)\n\t{\n\t\tif(trie.ch[u][i])\n\t\t{\n\t\t\tsam.insert(i,temp);\n\t\t\tdfs1(trie.ch[u][i]);\n\t\t}\n\t}\n}\ninline void dfs(int u)\n{\n\tfor(int i=p[u];i!=-1;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;\n\t\tdfs(v);\n\t\tdp[u]+=dp[v];\n\t}\n\tans=max(ans,dp[u]*len[u]);\n}\nint n;\nchar s[maxn];\nvector<string>v;\nsigned main()\n{\n\tmemset(p,-1,sizeof(p));\n\tscanf(\"%d\",&n);\n\ttrie.tot=1;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tstring s;\n\t\tcin>>s;\n\t\tv.push_back(s);\n\t}\t\n\tfor(int i=0;i<=n-1;++i)\n\t{\n\t\tint va=getint(); \n\t\tstring s=v[i];\n\t\ttrie.insert(s,va);\n\t}\n\tdfs1(1);\n\tfor(int i=2;i<=tot;++i)add(fa[i],i);\n\tdfs(1);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1588428966,
        "uid": 333789,
        "name": "lory1608",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF616F \u3010Expensive Strings\u3011"
    },
    {
        "content": "[\u66f4\u7cdf\u7684\u9605\u8bfb\u4f53\u9a8c](https://blog.csdn.net/BUG_Creater_jie/article/details/122254012)\n## $\\text{Descripion}$\n\u7ed9\u4f60 $n$ \u4e2a\u5b57\u7b26\u4e32\u3002\u6bcf\u4e2a\u5b57\u7b26\u4e32\u7684\u6210\u672c\u90fd\u662f $c_i$\u3002\n\u5b9a\u4e49\u5b57\u7b26\u4e32\u7684\u51fd\u6570\uff0c\u5176\u4e2d $f(s)=\\sum_{i=1}^n c_i \\cdot p_{s,i} \\cdot |s|$\uff0c$p_{s,i}$ \u662f $s$ \u5728 $t_i$ \u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c$|s|$ \u662f\u5b57\u7b26\u4e32 $s$ \u7684\u957f\u5ea6\u3002\u6c42**\u6240\u6709\u5b57\u7b26\u4e32\u51fd\u6570 $f(s)$ \u7684\u6700\u5927\u503c**\u3002\n\n\u6ce8\u610f\u5b57\u7b26\u4e32 $s$ **\u4e0d\u4e00\u5b9a**\u662f $t$ \u4e2d\u7684\u67d0\u4e2a\u5b57\u7b26\u4e32\u3002\n## $\\text{Solution}$\n\u636e\u8bf4\u7528\u5e7f\u4e49 SAM \u7684\u8bdd\u5c31\u662f\u677f\u5b50\u4e86\u3002\n\u4f46\u662f\u6211\u5e76\u4e0d\u4f1aqwq\u3002  \n\n\u8003\u8651\u4f7f\u7528 SA\u3002  \n\u5148\u628a\u6240\u6709\u4e32\u8fde\u8d77\u6765\uff0c\u4e2d\u95f4\u5939\u4e00\u4e9b\u6ce5\u5df4\u3002  \n\u540e\u7f00\u6392\u5e8f\u540e\u5148\u6c42\u51fa $\\operatorname{height}$\u3002\n\u6bcf\u4e2a\u540e\u7f00\u7684\u4ef7\u503c\u5b9a\u4e49\u4e3a\u5176\u6240\u5c5e\u4e32\u7684\u4ef7\u503c\uff0c\u5e76\u6c42\u51fa\u4ef7\u503c\u7684\u524d\u7f00\u548c\u3002  \n\u7136\u540e\u5982\u679c\u9009\u62e9\u533a\u95f4 $[l,r]$ \u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u9009\u62e9\u7684\u4ef7\u503c\u5c31\u662f\uff1a\n$$(\\min_{i=l+1}^{r}\\operatorname{height}_i )\\times sum_r-sum_{l-1}$$\n\u56e0\u4e3a\u8d2a\u5fc3\u7684\u8003\u8651\u4e00\u5b9a\u4f7f\u8fd9\u4e2a\u4e32\u6700\u957f\u3002   \n\u90a3\u4e48\u6211\u4eec\u60ac\u7ebf\u6cd5\u6c42\u51fa\u6bcf\u4e2a $height$ \u4f5c\u4e3a\u6700\u5c0f\u503c\u7684\u6709\u6548\u533a\u95f4\uff0c\u626b\u4e00\u904d\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002  \n\u4f46\u8fd9\u6837\u662f\u65e0\u6cd5\u8003\u8651\u8fd9\u4e2a\u4e32\u53ea\u51fa\u73b0\u4e00\u904d\u7684\u60c5\u51b5\u7684\uff0c\u8fd9\u4e2a\u4e32\u4e00\u5b9a\u5c31\u662f\u67d0\u4e2a\u4e32\u672c\u8eab\uff0c`map` \u66b4\u529b\u5224\u4e00\u4e0b\u5373\u53ef\u3002\n### update on 2022.1.1\n\u611f\u8c22 [@\u671b\u6708Asta](https://www.luogu.com.cn/user/122520) \u63d0\u4f9b\u7684hack\uff0c\u4e0a\u9762\u7684\u7b97\u6cd5\u4f1a\u5728\u4e0b\u9762\u8fd9\u4e2a\u6570\u636e\u51fa\u9519\uff1a\n```\n2\nod\niod\n2 -1\nans:2\n```\n\u539f\u56e0\u662f\u4e4b\u524d `map` \u5224\u6574\u4e32\u5224\u7684\u8fc7\u4e8e\u8349\u7387\u4e86\uff0c\u6b63\u786e\u7684\u505a\u6cd5\u5e94\u8be5\u662f\u8bb0\u5f55\u6bcf\u4e2a\u4e32\u5f00\u5934\u7684\u4f4d\u7f6e $pl$\uff0c\u7136\u540e\u770b\u770b $height_{pl}$ \u548c $height_{pl+1}$ \u662f\u5426\u90fd\u5c0f\u4e8e\u8be5\u4e32\u957f\u5ea6\u3002\n\n## $\\text{Code}$\n\n```cpp\n# include <bits/stdc++.h>\n# include <bits/extc++.h>\nusing namespace std;\n#define ll long long\n#define ull unsigned long long\n#define debug(...) fprintf(stderr,__VA_ARGS__)\ninline ll read(){\n  ll x(0),f(1);char c=getchar();\n  while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n  while(isdigit(c)){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n  return x*f;\n}\n\nconst int N=1e6+100;\nconst int mod=1e9+7;\n\nint n,m,tot;\nint sa[N],rk[N],id[N],oldrk[N],bel[N],len[N],p,cnt[1234567],a[N],l[N],r[N];\nll h[N],c[N];\nvoid calc(){\n  for(int k=0,i=1;i<=n;i++){\n    if(k) --k;\n    while(a[i+k]==a[sa[rk[i]-1]+k]) ++k;\n    h[rk[i]]=k;\n  }\n  return;\n}\nbool jd[N];\nll ans,sum[N];\nstring s[N];\nmap<string,int>mp;\n\nsigned main(){\n#ifndef ONLINE_JUDGE\n  freopen(\"a.in\",\"r\",stdin);\n  freopen(\"a.out\",\"w\",stdout);\n#endif\n  m=read();\n  for(int i=1;i<=m;i++){\n    cin>>s[i];\n    n=s[i].size();\n    for(int j=0;j<n;j++) a[++tot]=s[i][j]-'a'+1,bel[tot]=i;\n    a[++tot]=i+26;\n    bel[tot]=i;jd[tot]=1;\n    len[i]=n;\n    mp[s[i]]++;\n  }\n  for(int i=1;i<=m;i++) c[i]=read();//ans=max(ans,c[i]*len[i]);\n  for(int i=1;i<=m;i++) if(mp[s[i]]==1) ans=max(ans,c[i]*len[i]);\n  n=tot;\n  m+=26;\n  for(int i=1;i<=n;i++) ++cnt[rk[i]=a[i]];\n  for(int i=1;i<=m;i++) cnt[i]+=cnt[i-1];\n  for(int i=n;i>=1;i--) sa[cnt[rk[i]]--]=i;\n  for(int w=1;;w<<=1){\n    p=0;\n    for(int i=n;i>n-w;i--) id[++p]=i;\n    for(int i=1;i<=n;i++){\n      if(sa[i]>w) id[++p]=sa[i]-w;\n    }\n    memset(cnt,0,sizeof(cnt));\n    memcpy(oldrk,rk,sizeof(rk));\n    //for(int i=1;i<=n;i++) printf(\"%d \",id[i]);\n    //putchar('\\n');\n    for(int i=n;i>=1;i--) ++cnt[rk[id[i]]];\n    for(int i=1;i<=m;i++) cnt[i]+=cnt[i-1];\n    for(int i=n;i>=1;i--) sa[cnt[rk[id[i]]]--]=id[i];\n    p=0;\n    for(int i=1;i<=n;i++){\n      if(oldrk[sa[i]]==oldrk[sa[i-1]]&&oldrk[sa[i]+w]==oldrk[sa[i-1]+w]) rk[sa[i]]=p;\n      else rk[sa[i]]=++p;\n    }\n    m=p;\n    //for(int i=1;i<=n;i++) printf(\"%d \",sa[i]);\n    //putchar('\\n');\n    if(m==n) break;\n  }\n  calc();\n  for(int i=1;i<=n;i++) sum[i]=sum[i-1]+c[bel[sa[i]]];  \n  for(int i=1;i<=n;i++){\n    l[i]=i;\n    //printf(\"i=%d\\n\",i);\n    while(l[i]>1&&h[l[i]-1]>=h[i]) l[i]=l[l[i]-1];\n  }\n  for(int i=n;i>=1;i--){\n    r[i]=i;\n    while(r[i]<n&&h[r[i]+1]>=h[i]) r[i]=r[r[i]+1];\n  }\n  //for(int i=1;i<=n;i++){\n    //printf(\"i=%d pl=%d h=%lld l=%d r=%d sum=%lld tmp=%lld\\n\",\n    //\t   i,sa[i],h[i],l[i],r[i],sum[i],h[i]*(sum[r[i]]-sum[max(0,l[i]-2)]));\n  //}\n  for(int i=2;i<=n;i++){   \n      ans=max(ans,h[i]*(sum[r[i]]-sum[max(0,l[i]-2)]));\n  }\n  printf(\"%lld\\n\",ans);\n  return 0;\n}\n/*\n5\nbbbab\nbbaab\nbbbaa\nbbabb\nbabba\n3 -9 8 -3 9 \n */\n\n```\n",
        "postTime": 1640931983,
        "uid": 449265,
        "name": "wind_whisper",
        "ccfLevel": 10,
        "title": "CF616F Expensive Strings"
    }
]