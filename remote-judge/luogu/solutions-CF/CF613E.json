[
    {
        "content": "> [CF613E Puzzle Lover](https://codeforces.com/contest/613/problem/E)\n\n## \u9898\u610f\n\n- \u7ed9\u5b9a\u4e00\u4e2a $2 \\times n$ \u7684\u77e9\u9635\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u6709\u4e00\u4e2a\u5c0f\u5199\u5b57\u6bcd\u3002\n- \u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $k$ \u7684\u5c0f\u5199\u5b57\u7b26\u4e32 $w$\uff0c\u8be2\u95ee\u77e9\u9635\u4e2d\u6709\u591a\u5c11\u6761\u6709\u5411\u8def\u5f84\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a\n  - \u8def\u5f84\u4e0a\u7684\u5b57\u6bcd\u8fde\u8d77\u6765\u6070\u597d\u4e3a $w$\u3002\n  - \u4e0d\u591a\u6b21\u7ecf\u8fc7\u540c\u4e00\u4e2a\u4f4d\u7f6e\u3002\n  - \u53ea\u80fd\u5411\u4e0a\u4e0b\u5de6\u53f3\u56db\u4e2a\u65b9\u5411\u8d70\u3002\n- $n,k \\le 2 \\times 10^3$\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n## \u9898\u89e3\n\n\u5047\u8bbe $n,k$ \u540c\u9636\u3002\n\n\u8003\u8651**\u5934\u5c3e\u4e0d\u5728\u540c\u4e00\u5217**\u7684\u60c5\u51b5\uff0c\u4e0d\u59a8\u8bbe\u5934\u5728\u5c3e\u7684\u5de6\u4fa7\u3002\u5bf9\u4e8e\u5934\u5728\u5c3e\u7684\u53f3\u4fa7\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u5c06 $w$ \u7ffb\u8f6c\u4e4b\u540e\u5728\u6c42\u4e00\u904d\u3002\n\n\u5f53\u5934\u5728\u5c3e\u7684\u5de6\u4fa7\u65f6\uff0c\u6211\u4eec\u5c06\u8def\u5f84\u5212\u5206\u6210\u8fde\u7eed\u7684\u4e09\u4e2a\u90e8\u5206\uff1a\n\n1. \u5934\u6240\u5728\u7684\u5217\u53ca\u5176\u5de6\u4fa7\u7684\u90e8\u5206\uff1b\n2. \u5728\u5934\u7684\u53f3\u4fa7\u5c3e\u7684\u5de6\u4fa7\u7684\u90e8\u5206\uff1b\n3. \u5c3e\u6240\u5728\u7684\u5217\u53ca\u5176\u53f3\u4fa7\u7684\u90e8\u5206\u3002\n\n\u5bf9\u4e8e\u4efb\u610f\u4e00\u6761\u8def\u5f84\uff0c\u5b83\u7684\u7b2c $1/3$ \u90e8\u5206\u90fd\u80af\u5b9a\u975e\u7a7a\uff0c\u800c\u7b2c $2$ \u90e8\u5206\u53ef\u80fd\u4e3a\u7a7a\u3002\n\n\u4e0b\u9762\u6211\u4eec\u4f9d\u6b21\u8003\u8651\u6bcf\u4e00\u4e2a\u90e8\u5206\uff1a\n\n1. \u8fd9\u90e8\u5206\u8981\u4e48\u662f\u4e00\u4e2a\u683c\u5b50\uff0c\u8981\u4e48\u662f\u4e00\u4e2a U \u5b57\u5f62\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u683c\u5b50\u6c42\u51fa\u300c\u82e5\u7b2c $1$ \u90e8\u5206\u5728\u8fd9\u4e2a\u683c\u5b50\u7ed3\u675f\uff0c\u6240\u6709\u53ef\u80fd\u7684\u7b2c $1$ \u90e8\u5206\u7684\u957f\u5ea6\u300d\uff0c\u501f\u52a9 Hash \u5373\u53ef\u505a\u5230 $\\mathcal O(n^2)$\u3002\n2. \u8fd9\u90e8\u5206\u4e0d\u80fd\u5f80\u5de6\uff0c\u8003\u8651 dp\uff0c\u8bbe $f_{i,j,k}$ \u8868\u793a\u300c\u82e5\u7b2c $2$ \u90e8\u5206\u5728 $(i,j)$ \u7ed3\u675f\uff0c\u4e0a\u4e00\u4e2a\u683c\u5b50\u4e3a $(i,j-1)$\uff0c\u4e14\u7b2c $1,2$ \u90e8\u5206\u7684\u957f\u5ea6\u548c\u4e3a $k$ \u7684\u65b9\u6848\u6570\u300d\uff0c\u8bbe $g_{i,j,k}$ \u8868\u793a\u300c\u82e5\u7b2c $2$ \u90e8\u5206\u5728 $(i,j)$ \u7ed3\u675f\uff0c\u4e0a\u4e00\u4e2a\u683c\u5b50\u5176\u540c\u4e00\u5217\uff0c\u4e14\u7b2c $1,2$ \u90e8\u5206\u7684\u957f\u5ea6\u548c\u4e3a $k$ \u7684\u65b9\u6848\u6570\u300d\uff0c\u4ece\u5de6\u5230\u53f3\u8f6c\u79fb\uff0c\u8f6c\u79fb\u65f6\u679a\u4e3e\u4e0b\u4e00\u4e2a\u683c\u5b50\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n^2)$\u3002\n3. \u4e0e\u7b2c $1$ \u90e8\u5206\u4e00\u6837\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u683c\u5b50\u6c42\u51fa\u300c\u82e5\u7b2c $3$ \u90e8\u5206\u4ece\u8fd9\u4e2a\u683c\u5b50\u5f00\u59cb\uff0c\u6240\u6709\u53ef\u80fd\u7684\u7b2c $3$ \u90e8\u5206\u7684\u957f\u5ea6\u300d\uff0c\u7136\u540e\u4e0e\u7b2c $2$ \u90e8\u5206\u63a5\u4e0a\uff0c\u5373\u7b2c $2$ \u90e8\u5206\u7684\u7ed3\u675f\u7684\u683c\u5b50\u7684\u53f3\u8fb9\u4e00\u4e2a\u683c\u5b50\u5c31\u662f\u7b2c $3$ \u90e8\u5206\u5f00\u59cb\u7684\u683c\u5b50\uff0c\u540c\u6837\u501f\u52a9 Hash \u53ef\u4ee5\u505a\u5230 $\\mathcal O(n^2)$\u3002\n\n\u8fd8\u5269\u4e0b**\u5934\u5c3e\u5728\u540c\u4e00\u5217**\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u76f4\u63a5\u5728\u8003\u8651\u7b2c $1/3$ \u90e8\u5206\u65f6\u987a\u4fbf\u89e3\u51b3\u6389\u5c31\u597d\u4e86\uff0c\u6ce8\u610f\u7ffb\u8f6c\u524d\u540e\u4f1a\u91cd\u590d\u8ba1\u7b97\u4e00\u6b21\uff0c\u6700\u540e\u9664\u6389\u5c31\u597d\u4e86\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^2)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#define Hash pair<modint, modint>\nconst Hash B = mp(131, 13331);\ninline Hash operator + (Hash a, Hash b) { return mp(a.fi + b.fi, a.se + b.se); }\ninline Hash operator - (Hash a, Hash b) { return mp(a.fi - b.fi, a.se - b.se); }\ninline Hash operator * (Hash a, Hash b) { return mp(a.fi * b.fi, a.se * b.se); }\ninline Hash operator + (Hash a, int b) { return mp(a.fi + b, a.se + b); }\n\nconst int N = 2e3 + 7;\nint n, m;\nchar s[3][N];\nmodint f[2][N][N], g[2][N][N], ans, now;\nHash p[N], h[2][3][N];\nbool a[2][N][N], b[2][N][N];\n\ninline Hash H(int o, int i, int l, int r) {\n\tif (!o) return h[o][i][r] - h[o][i][l-1] * p[r-l+1];\n\treturn h[o][i][l] - h[o][i][r+1] * p[r-l+1];\n}\n\ninline bool pd(int o, int i, int j, int k) {\n\tif (!o) {\n\t\tif (j < k) return 0;\n\t\tif (H(1, i ^ 1, j - k + 1, j) != H(0, 2, 1, k)) return 0;\n\t\tif (H(0, i, j - k + 1, j) != H(0, 2, k + 1, 2 * k)) return 0;\n\t\treturn 1;\n\t}\n\tif (j + k - 1 > n) return 0;\n\tif (H(0, i, j, j + k - 1) != H(0, 2, m - 2 * k + 1, m - k)) return 0;\n\tif (H(1, i ^ 1, j, j + k - 1) != H(0, 2, m - k + 1, m)) return 0;\n\treturn 1; \n}\n\ninline void solve() {\n\tfor (int i = 1; i <= m; i++) h[0][2][i] = h[0][2][i-1] * B + s[2][i];\n\tfor (int i = 0; i <= 1; i++)\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\tfor (int k = 1; k <= m; k++) {\n\t\t\t\tf[i][j][k] = g[i][j][k] = 0;\n\t\t\t\tif (k == 1) {\n\t\t\t\t\tg[i][j][k] = a[i][j][k] = s[i][j] == s[2][1];\n\t\t\t\t\tb[i][j][k] = s[i][j] == s[2][m];\n\t\t\t\t} else if (!(k & 1)) {\n\t\t\t\t\tg[i][j][k] = a[i][j][k] = pd(0, i, j, k / 2);\n\t\t\t\t\tb[i][j][k] = pd(1, i, j, k / 2);\n\t\t\t\t}\n\t\t\t\tif (k == m) {\n\t\t\t\t\tnow += a[i][j][k];\n\t\t\t\t\tif (m > 2) now += b[i][j][k];\n\t\t\t\t}\n\t\t\t}\n\tdbg(ans.x);\n\tfor (int j = 1; j <= n; j++)\n\t\tfor (int k = 1; k <= m; k++) {\n\t\t\tfor (int i = 0; i <= 1; i++)\n\t\t\t\tif (s[i][j] == s[2][k])\n\t\t\t\t\tf[i][j][k] += f[i][j-1][k-1] + g[i][j-1][k-1];\n\t\t\tfor (int i = 0; i <= 1; i++)\n\t\t\t\tif (s[i][j] == s[2][k])\n\t\t\t\t\tg[i][j][k] += f[i^1][j][k-1];\n\t\t\tfor (int i = 0; i <= 1; i++)\n\t\t\t\tif (b[i][j+1][m-k])\n\t\t\t\t\tans += f[i][j][k] + g[i][j][k];\n\t\t}\n}\n\nint main() {\n\trds(s[0], n), rds(s[1], n), rds(s[2], m), p[0] = mp(1, 1);\n\tfor (int i = 1; i <= max(n, m); i++) p[i] = p[i-1] * B;\n\tfor (int i = 0; i <= 1; i++) {\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\th[0][i][j] = h[0][i][j-1] * B + s[i][j];\n\t\tfor (int j = n; j; j--)\n\t\t\th[1][i][j] = h[1][i][j+1] * B + s[i][j];\n\t}\n\tsolve(), reverse(s[2] + 1, s[2] + m + 1), solve(), print(ans + now / 2);\n\treturn 0;\n}\n```",
        "postTime": 1581519309,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF613E \u3010Puzzle Lover\u3011"
    },
    {
        "content": "# $\\mathrm{CF613E\\ Puzzle \\ Lover}$ \n* \u5934\u94c1\u5730\u53bb\u505a\u4e00\u9053$*3200$\u7684\u9898\uff0c\u6ca1\u60f3\u5230\u8fd8\u662f\u6bd4\u8f83\u597d\u60f3~~\uff08\u770b\u9898\u89e3~~ \n\n## **\u9898\u76ee\u610f\u601d**\n* [\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/CF613E)\n\n* \u5c31\u662f\u7ed9\u4f60\u4e00\u4e2a$2\\times n$\u7684\u5b57\u7b26\u77e9\u9635\uff0c\u4ee5\u53ca\u7ed9\u4f60\u4e2a$m$\u7684\u5b57\u7b26\u4e32$t$\u3002\u95ee\u4f60\u6709\u591a\u5c11\u79cd\u65b9\u6848\u4f7f\u5f97\u8def\u5f84\u4e0a\u7684\u5b57\u7b26\u8fde\u63a5\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u4e3a$t$\uff08\u6bcf\u6b21\u53ef\u4ee5\u5f80\u4e0a\u4e0b\u5de6\u53f3\u8d70\uff0c\u4f46\u4e0d\u80fd\u8d70\u5230\u540c\u4e00\u683c\uff09\u3002\u7b54\u6848\u5bf9$1e9+7$\u53d6\u6a21\n* $n,m\\leq 2e3$\n\n## $\\mathrm{Sol}$\n* \u524d\u7f6e\u77e5\u8bc6\uff1a**\u5b57\u7b26\u4e32\u54c8\u5e0c+DP**\uff0c\u662f\u4e0d\u662f$PJ$\u5185\u5bb9\u554a\u3002\n* \u6211\u4eec\u8bbe\u8fd9\u6761\u8def\u5f84\u7684\u7aef\u70b9\u4e3a$s,t$\u3002\u90a3\u4e48\u4e00\u6761$s\\to t$\u7684\u8def\u5f84\u6837\u5b50\u5982\u4e0b\uff1a\n![\u56fe1-1](https://img-blog.csdnimg.cn/20200512154909727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dhbmd5aXlhbmcy,size_16,color_FFFFFF,t_70#pic_center)\n* **\u90e8\u5206\u4e00:** \u4ece$s$\u5f80\u5de6\u8d70\uff0c\u518d\u5f80\u53f3\u7ed5\u56de\u6765\n* **\u90e8\u5206\u4e8c:** \u4e0a\u4e0b\u5f80\u53f3\u8fb9\u79fb\u52a8\n* **\u90e8\u5206\u4e09:** \u7ed5\u9053$t$\u7684\u53f3\u8fb9\u518d\u7ed5\u56de\u6765\n\n* \u7136\u540e\u6211\u4eec\u5bf9\u4e8e$1,3$\u90e8\u5206\u5b57\u7b26\u4e32\u54c8\u5e0c\u3002\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u5373\u679a\u4e3e\u7ec8\u70b9\u7528\u54c8\u5e0c\u5224\u65ad\u662f\u5426\u5408\u6cd5\u3002\u4ee5\u53ca\u4e3a\u4e2d\u95f4\u90e8\u5206\u505a$dp$\u9884\u5904\u7406\u3002\u4e0d\u5728\u8fc7\u591a\u8bb2\u3002\n* \u5173\u952e\u662f\u4e2d\u95f4\u53cd\u590d\u6a2a\u8df3\u7684\u8fc7\u7a0b\uff0c\u8bbe$f_{i,j,k}$\u8868\u793a\u5230$(i,j)$\u914d\u5bf9\u5230$t$\u4e2d\u7b2c$k$\u4e2a\u5b57\u7b26\uff0c\u4ece$f_{i,j-1,k-1}$\u8f6c\u79fb\u8fc7\u6765\u3002\u540c\u7406$g_{i,j,k}$\u8868\u793a\u5230$(i,j)$\u914d\u5bf9\u5230$t$\u4e2d\u7b2c$k$\u4e2a\u5b57\u7b26\uff0c\u4ece$g_{3-i,j,k-1}$\u8f6c\u79fb\u8fc7\u6765\u3002\uff08$3-i$\u5373\u5728\u7b2c\u4e00\u884c\u4e0e\u7b2c\u4e8c\u884c\u53cd\u590d\u6a2a\u8df3\u7684\u7b80\u5355\u8f6c\u6362\uff09\u3002\n* \u90a3\u4e48\u8f6c\u79fb\u5c31\u5f88\u7b80\u5355\uff08\u4e0d\u4f1a\u5f80\u56de\u8d70\uff09\u3002\u6240\u4ee5$f,g$\u4e4b\u95f4\u76f8\u4e92\u66f4\u65b0\u5373\u53ef\u3002\u5177\u4f53\u7684\uff1a\n\t* $f_{i,j+1,k+1}=\\sum g_{i,j,k}[j\\leq n,ch_{i,j+1}=t_{k+1}]$\n\t* $f_{i,j+1,k+1}=\\sum f_{i,j,k}[j\\leq n,ch_{i,j+1}=t_{k+1}]$\n\t* $g_{3-i,j,k+1}=\\sum f_{i,j,k}[ch_{3-i,j}=t_{k+1}]$\n* \u5bf9\u4e8e\u7b2c\u4e09\u90e8\u5206\u6211\u4eec\u6765\u7edf\u8ba1\u7b54\u6848\u3002\u6211\u4eec\u679a\u4e3e\u7ec8\u70b9\u7b97\u51fa\u8d77\u70b9\uff0c\u90a3\u4e48$ans=\\sum f_{i,j-1,m-1}+\\sum g_{i,j-1,m-1}$\uff08\u4e3a\u4ec0\u4e48\u662f$j-1$\u56e0\u4e3a\u7b2c\u4e8c\u90e8\u5206\u7684\u7ed3\u675f\u7684\u90a3\u4e00\u5217\u52a0\u4e00\u4e5f\u662f$t$\u6240\u5728\u7684\u90a3\u4e00\u5217\uff09\u3002\n* \u6211\u4eec\u8fd8\u5b58\u5728$s,t$\u5728\u540c\u4e00\u5217\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u628a\u5b57\u7b26\u4e32\u7ffb\u8f6c\u7684\u7b54\u6848\u662f\u91cd\u7684\u6240\u4ee5\u8981\u5220\u6389\u3002\u540c\u65f6\u4e5f\u8981\u52a0\u4e0a\u8fd9\u79cd\u60c5\u51b5\u7684\u8d21\u732e\uff08\u5373\u4ee3\u7801\u4e2d\u7684$gs$\uff0c\u6b64\u65f6\u4e0d\u5b58\u5728\u7b2c\u4e8c\u90e8\u5206\u7684\u8d21\u732e\uff09\n\n* \u4e8e\u662f\u6211\u4eec\u505a\u51fa\u4e86\u4e00\u9053$3200$\u7684\u9898\u3002\n\n## $\\mathrm{Code}$\n```cpp\n#include <bits/stdc++.h>\n#define pb push_back\n#define int long long\nusing namespace std;\n\ninline int read()\n{\n\tint sum=0,ff=1; char ch=getchar();\n\twhile(!isdigit(ch))\n\t{\n\t\tif(ch=='-') ff=-1;\n\t\tch=getchar();\n\t}\n\twhile(isdigit(ch))\n\t\tsum=sum*10+(ch^48),ch=getchar();\n\treturn sum*ff;\n}\n\nconst int N=2005;\nconst int mo=1e9+7;\nconst int base=131;\n\nchar ch[3][N],t[N];\nint Hash1[3][N],Hash2[3][N],Hasht[N],bin[N];\nint n,m,f[3][N][N],g[3][N][N],ans,gs;\n\ninline int get1(int l,int r,int id)\n{\n\treturn Hash1[id][r]-Hash1[id][l-1]*bin[r-l+1];\n}\n\ninline int get2(int l,int r,int id)\n{\n\treturn Hash2[id][l]-Hash2[id][r+1]*bin[r-l+1];\n}\n\ninline void Add(int &x,int y)\n{\n\tx+=y;\n\tif(x>=mo) x-=mo;\n}\n\ninline int merge(int H1,int H2,int len)\n{\n\treturn H2+H1*bin[len];\n}\n\ninline void dp()\n{\n\tmemset(f,0,sizeof(f));\n\tmemset(g,0,sizeof(g));\n\tfor ( int i=1;i<=m;i++ ) \n\t\tHasht[i]=Hasht[i-1]*base+(t[i]-'a'+1);\n\tfor ( int i=1;i<=2;i++ ) \n\t\tfor ( int j=1;j<=n;j++ )\n\t\t\tfor ( int k=j;k>=1;k-- )\n\t\t\t{\n\t\t\t\tint len=2*(j-k+1);\n\t\t\t\tif(len>m) continue;\n\t\t\t\tint HA=get1(k,j,i);\n\t\t\t\tint HB=get2(k,j,3-i);\n\t\t\t\tint HH=Hasht[len];\n\t\t\t\tif(merge(HB,HA,j-k+1)==HH) \n\t\t\t\t{\n\t\t\t\t\tif(len==m) gs++;\n\t\t\t\t\telse g[i][j][len]=1;\n\t\t\t\t}\n\t\t\t}\n\tfor ( int i=1;i<=2;i++ ) \n\t\tfor ( int j=1;j<=n;j++ )\n\t\t\tif(ch[i][j]==t[1]) g[i][j][1]=1;\n\tfor ( int i=m;i>=1;i-- ) \n\t\tHasht[i]=Hasht[i+1]*base+(t[i]-'a'+1);\n\tfor ( int k=1;k<m;k++ ) \n\t\tfor ( int j=1;j<=n;j++ ) \n\t\t\tfor ( int i=1;i<=2;i++ ) \n\t\t\t{\n\t\t\t\tif(g[i][j][k]) \n\t\t\t\t\tif(j<n&&ch[i][j+1]==t[k+1]) \n\t\t\t\t\t\tAdd(f[i][j+1][k+1],g[i][j][k]);\n\t\t\t\tif(f[i][j][k]) \n\t\t\t\t{\n\t\t\t\t\tif(j<n&&ch[i][j+1]==t[k+1]) \n\t\t\t\t\t\tAdd(f[i][j+1][k+1],f[i][j][k]);\n\t\t\t\t\tif(ch[3-i][j]==t[k+1]) \n\t\t\t\t\t\tAdd(g[3-i][j][k+1],f[i][j][k]);\n\t\t\t\t}\n\t\t\t}\n\tfor ( int i=1;i<=2;i++ ) \n\t\tfor ( int j=1;j<=n;j++ ) \n\t\t{\n\t\t\tif(ch[i][j]==t[m]) \n\t\t\t{\n\t\t\t\tif(m==1) Add(ans,1);\n\t\t\t\tAdd(ans,f[i][j-1][m-1]);\n\t\t\t\tAdd(ans,g[i][j-1][m-1]);\n\t\t\t}\n\t\t\tfor ( int k=j;k<=n;k++ )\n\t\t\t{\n\t\t\t\tint len=(k-j+1)*2;\n\t\t\t\tif(len>m) continue;\n\t\t\t\tint HA=get1(j,k,3-i);\n\t\t\t\tint HB=get2(j,k,i);\n\t\t\t\tint HH=Hasht[m-len+1];\n\t\t\t\tif(merge(HA,HB,k-j+1)==HH)\n\t\t\t\t{\n\t\t\t\t\tif(len==m&&m!=2) gs++;\n\t\t\t\t\telse \n\t\t\t\t\t{\n\t\t\t\t\t\tAdd(ans,f[i][j-1][m-len]);\n\t\t\t\t\t\tAdd(ans,g[i][j-1][m-len]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n}\n\t\t\t\t\t\nsigned main()\n{\n\tscanf(\"%s\",ch[1]+1);\n\tscanf(\"%s\",ch[2]+1);\n\tn=strlen(ch[1]+1);\n\tscanf(\"%s\",t+1);\n\tm=strlen(t+1);\n\tbin[0]=1;\n\tint Lim=max(n,m);\n\tfor ( int i=1;i<=Lim;i++ ) \n\t\tbin[i]=bin[i-1]*base; \n\tfor ( int i=1;i<=2;i++ ) \n\t\tfor ( int j=1;j<=n;j++ ) \n\t\t\tHash1[i][j]=Hash1[i][j-1]*base+(ch[i][j]-'a'+1);\n\tfor ( int i=1;i<=2;i++ ) \n\t\tfor ( int j=n;j>=1;j-- ) \n\t\t\tHash2[i][j]=Hash2[i][j+1]*base+(ch[i][j]-'a'+1);\n\tdp();\n\treverse(t+1,t+m+1);\n\tdp();\n\tAdd(ans,gs/2);\n\tif(m==1) ans/=2;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n\n\n```\n",
        "postTime": 1589271700,
        "uid": 308464,
        "name": "\u5947\u7c73",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 CF613E \u3010Puzzle Lover\u3011"
    },
    {
        "content": "\u5bf9\u4e8e $|w| \\le 2$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u8fdb\u884c\u7279\u5224\uff0c\u8fd9\u662f\u4e3a\u4e86\u4e4b\u540e\u5199\u8d77\u6765\u5206\u7c7b\u8ba8\u8bba\u53ef\u4ee5\u7b80\u6d01\u4e00\u4e9b\u3002\n\n\u89c2\u5bdf\u4e00\u4e0b\u6700\u7ec8\u7684\u884c\u8d70\u65b9\u5f0f\u53ef\u80fd\u4f1a\u53d8\u6210\u5565\u6837\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fkecjfml.png)\n\n\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u4f1a\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\u3002\n\n\u6ce8\u610f\u5230\u53ef\u4ee5\u5206\u6210\u4e09\u6bb5\uff0c\u5de6\u8fb9\u4e00\u4e2a U \u5f62\uff0c\u4e2d\u95f4\u4e00\u4e2a\u53ea\u4f1a\u5411\u53f3\u8d70\u7684\u5f62\u72b6\uff0c\u53f3\u8fb9\u53c8\u4e00\u4e2a U \u5f62\u3002\n\n\u554a\uff0c\u4e3a\u5565\u8bf4\u4e2d\u95f4\u662f\u53ea\u4f1a\u5411\u53f3\u8d70\uff1f\u56e0\u4e3a\u6211\u4eec\u662f\u8fd9\u4e48\u94a6\u70b9\u7684\uff0c\u5f53\u7136\u4e5f\u53ef\u80fd\u662f\u4ece\u53f3\u8fb9\u51fa\u53d1\u5f80\u5de6\u8d70\uff0c\u8fd9\u65f6\u53ea\u8981\u628a $w$ \u53cd\u8f6c\uff0c\u518d\u6c42\u4e00\u6b21\u5c31\u884c\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5904\u7406\u51fa\uff0c\u4ece\u4e00\u4e2a\u5730\u65b9\u5206\u6bb5\uff0c\u4f1a\u4e0d\u4f1a\u4ea7\u751f\u5411\u5de6\u7684\uff0c\u957f\u5ea6\u4e3a\u67d0\u4e2a\u503c\u7684 U \u5f62\u3002\n\n\u8fd9\u53ef\u4ee5\u901a\u8fc7\u9884\u5904\u7406 LCP \u505a\u5230\u3002\n\n\u540c\u7406\u53ef\u4ee5\u5904\u7406\u51fa\uff0c\u4ece\u4e00\u4e2a\u5730\u65b9\u5206\u6bb5\uff0c\u4f1a\u4e0d\u4f1a\u4ea7\u751f\u5411\u53f3\u7684\uff0c\u957f\u5ea6\u4e3a\u67d0\u4e2a\u503c\u7684 U \u5f62\u3002\n\n\u5904\u7406\u4e0a\u8ff0\u4e24\u4e2a\u6570\u7ec4\uff0c\u5b83\u4eec\u5c31\u80fd\u591f\u4f5c\u4e3a\u7b2c\u4e00\u90e8\u5206\u548c\u7b2c\u4e09\u90e8\u5206\u3002\n\n\u6211\u4eec\u628a\u7b2c\u4e8c\u90e8\u5206\u63a5\u5728\u7b2c\u4e00\u90e8\u5206\u540e\uff0c\u8bb0 $f(i, j, k)$ \u8868\u793a\uff0c\u5f53\u524d\u7b2c\u4e8c\u90e8\u5206\u8d70\u5230\u4e86 $(i, j)$\uff0c\u5e76\u4e14\u5339\u914d\u4e86 $w$ \u7684\u524d $k$ \u4e2a\u5b57\u7b26\uff0c\u5e76\u4e14\u4e0d\u662f\u4ece\u540c\u4e00\u5217\u8d70\u6765\u7684\u65b9\u6848\u6570\u3002\n\n\u7c7b\u4f3c\u5730\uff0c\u8bb0 $g(i, j, k)$ \u4e3a\u5fc5\u987b\u4ece\u540c\u4e00\u5217\u8d70\u6765\u7684\u65b9\u6848\u6570\u3002\u5219 $f, g$ \u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u8f6c\u79fb\uff0c\u8fd9\u90e8\u5206\u53ef\u4ee5 $\\mathcal O (n |w|)$ \u5904\u7406\u3002\n\n\u7136\u540e\u8003\u8651\u5728 DP \u5230 $(i, j, k)$ \u65f6\uff0c\u63a5\u4e0a\u7b2c\u4e09\u90e8\u5206\u5373\u53ef\uff0c\u53ef\u4ee5\u76f4\u63a5\u5224\u65ad\u63a5\u4e0d\u63a5\u5f97\u4e0a\u3002\n\n\u5f53\u7136\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u60c5\u51b5\u6ca1\u6709\u8ba8\u8bba\u7684\uff0c\u6bd4\u5982\u4e09\u4e2a\u90e8\u5206\u4e2d\u7684\u67d0\u4e00\u90e8\u5206\u5e76\u4e0d\u5b58\u5728\uff0c\u751a\u81f3\u662f\u4e24\u4e2a\u90e8\u5206\u4e0d\u5b58\u5728\u4e4b\u7c7b\u7684\uff0c\u4ed4\u7ec6\u8ba8\u8bba\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u6ce8\u610f\u8981\u4e0d\u91cd\u4e0d\u6f0f\uff0c\u7279\u522b\u6ce8\u610f $w$ \u53cd\u8f6c\u540e\u4e0d\u8981\u7edf\u8ba1\u91cd\u590d\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O (n |w|)$\uff0c[\u8bc4\u6d4b\u94fe\u63a5](https://codeforces.com/contest/613/submission/70898060)\u3002",
        "postTime": 1583785829,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 CF613E \u3010Puzzle Lover\u3011"
    },
    {
        "content": ">[\u63a8\u9500](https://www.cnblogs.com/Varuxn/p/15171225.html)\n\n# \u89e3\u9898\u601d\u8def\n\u5176\u5b9e\u4ed4\u7ec6\u89c2\u5bdf\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8def\u5f84\u4e00\u5b9a\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u4e0b\u56fe\u7684\u4e00\u4e2a\u5de6\u62ec\u53f7\u4e4b\u540e\u4e2d\u95f4\u968f\u4fbf\u53cd\u590d\u66f2\u6298\uff0c\u7136\u540e\u53f3\u8fb9\u5728\u6765\u4e00\u4e2a\u53f3\u62ec\u53f7\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/uxlmbwv3.png)\n\n\u7136\u540e\u5bf9\u4e8e\u4e24\u4e2a\u62ec\u53f7\u5f62\u72b6\u7684\u4e1c\u897f\u5176\u5b9e\u662f\u53ef\u4ee5\u5229\u7528 Hash \u6765\u5224\u7b49\u7279\u6b8a\u5904\u7406\u7684\u3002\n\n\u5bf9\u4e8e\u4e2d\u95f4\u7684\u90e8\u5206\u76f4\u63a5 DP \uff1a\n\n$f_{i,j,k,0/1}$ \u8868\u793a\u7b2c $i$ \u884c\uff0c\u7b2c $j$ \u5217\uff0c\u5f53\u524d\u626b\u5230\u4e86\u8be2\u95ee\u8def\u5f84\u7684\u7b2c $k$ \u4e2a\u4f4d\u7f6e\uff0c\u5e76\u4e14\u662f\u5426\u53ef\u4ee5\u5411\u4e0a\u6216\u8005\u4e0b\u8f6c\u79fb\u3002\n\n\u7136\u540e\u4f18\u5148\u5904\u7406\u4e00\u4e0b\u5de6\u62ec\u53f7\u5f62\uff0c\u8fd9\u91cc\u53ef\u4ee5\u7ef4\u62a4\u4e24\u4e2a Hash \u5206\u522b\u5b58\u50a8\u6b63\u53cd\u7684 Hash \u503c\u8fdb\u884c\u5224\u7b49\u3002\n\n\u63a5\u4e0b\u6765\u5c31 DP \u5904\u7406\u4e2d\u95f4\u66f2\u6298\u7684\u90e8\u5206\uff08 $ch$ \u4e3a\u5b57\u7b26\u77e9\u9635\uff0c $s$ \u4e3a\u76ee\u6807\u5b57\u7b26\u4e32\uff09\uff0c\u5bf9\u4e8e $ch_{i,j}=s_k$ \u7684\u60c5\u51b5\u8fdb\u884c\u8f6c\u79fb\uff0c\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b\uff1a\n\n$$f_{i,j,k,0}=f_{i,j,k,0}+f_{i,j-1,k-1,0}+f_{i,j-1,k-1,1}$$\n\n$$f_{i,j,k,1}=f_{i,j,k,1}+f_{i\\;xor\\;1,j,k-1,0}$$\n\n\u6ce8\u610f\u8f6c\u79fb\u7684\u65f6\u5019\u4e3a\u4e86\u9632\u6b62\u5f53\u524d\u72b6\u6001\u5bf9\u4e8e\u4e4b\u540e\u72b6\u6001\u9020\u6210\u8fc7\u591a\u5f71\u54cd\uff0c\u5e94\u8be5\u628a k \u7684\u5faa\u73af\u653e\u5728\u6700\u5916\u5c42\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u8def\u5f84\u800c\u8a00\u56e0\u4e3a\u662f\u6709\u5411\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u628a\u5b57\u7b26\u4e32\u7ffb\u8f6c\u4e4b\u540e\u518d\u505a\u4e00\u8fb9 DP \u5c31\u597d\u4e86\u3002\n# code\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define ull unsigned long long\n#define f() cout<<\"Pass\"<<endl\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nconst int N=2e3+10,mod=1e9+7;\nconst ull base=1331ull;\null has[N],pre[2][N],suf[2][N],p[N<<1];\nint n,m,ans,f[2][N][N<<1][2];\nchar ch[2][N],s[N<<1];\nvoid Hash()\n{\n\tfor(int i=0;i<=1;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tpre[i][j]=pre[i][j-1]*base+ch[i][j];\n\tfor(int i=0;i<=1;i++)\n\t\tfor(int j=n;j>=1;j--)\n\t\t\tsuf[i][j]=suf[i][j+1]*base+ch[i][j];\n}\null get_suf(int x,int l,int r){return suf[x][l]-suf[x][r+1]*p[r-l+1];}\null get_pre(int x,int l,int r){return pre[x][r]-pre[x][l-1]*p[r-l+1];}\null get_hash(int l,int r){return has[r]-has[l-1]*p[r-l+1];}\nvoid add(int &x,int y){x+=y;if(x>=mod)x-=mod;}\nvoid solve()\n{\n\tHash();\n\tfor(int i=0;i<=1;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tf[i][j][1][0]=(ch[i][j]==s[1]);\n\t\t\tfor(int k=2;k<=min(j,m/2);k++)\n\t\t\t\tif((get_hash(1,k)==get_suf(i^1,j-k+1,j))&&(get_hash(k+1,k<<1)==get_pre(i,j-k+1,j)))\n\t\t\t\t\tf[i][j][k<<1][1]=1;\n\t\t}\n\tfor(int k=1;k<=m;k++)\n\t\tfor(int i=0;i<=1;i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tif(ch[i][j]==s[k])\n\t\t\t\t{\n\t\t\t\t\tadd(f[i][j][k][0],f[i][j-1][k-1][0]+f[i][j-1][k-1][1]);\n\t\t        \tadd(f[i][j][k][1],f[i^1][j][k-1][0]);\n\t\t\t\t}\n\tfor(int i=0;i<=1;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tfor(int k=0;k<=m;k++)\n\t\t\t\tif(m-k!=2&&((k&1)==(m&1)))\n\t\t\t\t\tadd(ans,(f[i][j][k][1]+f[i][j][k][0])*(m==k||(j+(m-k)/2<=n&&get_pre(i,j+1,j+(m-k)/2)==get_hash(k+1,k+(m-k)/2)&&get_suf(i^1,j+1,j+(m-k)/2)==get_hash(k+(m-k)/2+1,m))));\n}\nvoid Special_Judge1()\n{\n\tfor(int i=0;i<=1;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tans-=(ch[i][j]==s[1]);\n}\nvoid Special_Judge2()\n{\n\tfor(int i=0;i<=1;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tans-=(ch[i][j]==s[1]&&ch[i^1][j]==s[2]);\n}\nsigned main()\n{\n\tscanf(\"%s%s%s\",ch[0]+1,ch[1]+1,s+1);\n\tn=strlen(ch[0]+1);\tm=strlen(s+1);\n\tp[0]=1;\tfor(int i=1;i<=m;i++)\tp[i]=p[i-1]*base;\n\tfor(int i=1;i<=m;i++)\thas[i]=has[i-1]*base+s[i];\n\tif(m==1)\tSpecial_Judge1();\n\tif(m==2)\tSpecial_Judge2();\n\tsolve();\n\tmemset(f,0,sizeof(f));\n\tfor(int i=0;i<=1;i++)\treverse(ch[i]+1,ch[i]+n+1);\n\tsolve();\n\tprintf(\"%lld\",(ans+mod)%mod);\n\treturn 0;\n}\n```\n",
        "postTime": 1629589042,
        "uid": 190322,
        "name": "Varuxn",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 \u86c7/CF613E Puzzle Lover"
    },
    {
        "content": "\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u8d70\u56de\u5934\u8def\u7684\u8bdd\u8fd9\u4e2a\u8def\u5f84\u95ee\u9898\u8fd8\u662f\u975e\u5e38\u5bb9\u6613\u7528dp\u6765\u89e3\u51b3\u7684\uff0c\u5982\u679c\u8d70\u56de\u5934\u8def\u7684\u8bdd\u4e0d\u592a\u597d\u8bb0\u54ea\u4e9b\u683c\u5b50\u88ab\u8d70\u4e86\u54ea\u4e9b\u6ca1\u88ab\u8d70\u3002\n\n\u4f46\u662f\u53c8\u53ef\u4ee5\u53d1\u73b0\u8d70\u56de\u5934\u8def\u7684\u53ea\u53ef\u80fd\u662f\u5728\u8def\u5f84\u7684\u5f00\u5934\u4ee5\u53ca\u7ed3\u5c3e\u3002\n\n\u4e8e\u662f\u8003\u8651\u628a\u8def\u5f84\u62c6\u6210\u4e09\u90e8\u5206\u6765\u5904\u7406\uff1a\n\n- \u4ece\u8d77\u70b9\u5f00\u59cb\u5f80\u5de6\u8d70\u7136\u540e\u7ed5\u56de\u8d77\u70b9\u8fd9\u4e00\u5217\u7684\u8def\u5f84\u3002\n- \u8d77\u70b9\u4e0e\u7ec8\u70b9\u6240\u5728\u5217\u4e2d\u95f4\u7684\u8def\u5f84\n- \u4ece\u7ec8\u70b9\u6240\u5728\u5217\u5411\u53f3\u7ed5\u56de\u7ec8\u70b9\u7684\u8def\u5f84\u3002\n\n\u6ce8\u610f\uff0c\u73b0\u5728\u6240\u6709\u7684\u8ba8\u8bba\u90fd\u662f\u5047\u8bbe\u8d77\u70b9\u5728\u7ec8\u70b9\u5de6\u7684\uff0c\u5982\u679c\u53cd\u8fc7\u6765\u7684\u8bdd\u53ea\u9700\u8981\u628a\u5b57\u7b26\u4e32$w$\u7ffb\u8f6c\u4e00\u4e0b\u518d\u505a\u4e00\u904d\u540c\u6837\u7684\u5373\u53ef\uff0c\u4f46\u662f\u5982\u679c\u7ec8\u70b9\u4e0e\u8d77\u70b9\u5728\u540c\u4e00\u5217\uff0c\u7b54\u6848\u4f1a\u88ab\u8ba1\u7b97\u4e24\u6b21\uff0c\u9664\u6389\u5373\u53ef\u3002\n\n\u9996\u5148\u8003\u86511,3\u90e8\u5206\uff0c\u8fd9\u4e2a\u975e\u5e38\u597d\u5904\u7406\uff0c\u679a\u4e3e\u7ec8\u70b9\u4f4d\u7f6e\uff0c\u7136\u540e\u54c8\u5e0c\u5373\u53ef\u5224\u65ad\uff0c\u7b2c1\u90e8\u5206\u7ed9\u7b2c2\u90e8\u5206\u7684dp\u8d4b\u4e0a\u521d\u503c\u3002\n\n\u7b2c2\u90e8\u5206\u8003\u8651dp\u89e3\u51b3\u3002\u8bbe$f[i][j][k]$\u548c$g[i][j][k]$\u5206\u522b\u8868\u793a\u4ece\u70b9$(i,j-1)$\u70b9\u8fd8\u662f\u4ece$(3-i,j)$\u70b9\u8d70\u8fc7\u6765\u7684\uff0c\u56e0\u4e3a\u6ca1\u6709\u56de\u5934\u8def\u6240\u4ee5\u4e0d\u80fd\u5411\u5de6\u8f6c\u79fb\uff0c\u8f6c\u79fb\u975e\u5e38\u7b80\u5355\u3002\n\n1,2\u90e8\u5206\u5408\u5e76\u4ee5\u540e\uff0c\u518d\u627e\u5230\u6240\u6709\u7684\u7b2c3\u90e8\u5206\uff0c\u62fc\u8d77\u6765\u8ba1\u7b97\u7b54\u6848\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6$O(n^2)$\u3002\n\n\ncode\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define maxn 3010\n#define mod 1000000007\nusing namespace std;\ntypedef long long ll;\nint read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch-'0'<0||ch-'0'>9){if(ch=='-') f=-1;ch=getchar();}\n    while(ch-'0'>=0&&ch-'0'<=9){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nchar s[3][maxn],t[maxn];\nll has_pre[3][maxn],has_suf[3][maxn],has[maxn],base[maxn];\nint n,m;\nint f[3][maxn][maxn],g[3][maxn][maxn];\nll get_pre(int l,int r,int id)\n{\n    return has_pre[id][r]-has_pre[id][l-1]*base[r-l+1];\n}\nll get_suf(int l,int r,int id)\n{\n    return has_suf[id][l]-has_suf[id][r+1]*base[r-l+1];\n}\nvoid add(int &x,int y)\n{\n    x=x+y>=mod?x+y-mod:x+y;\n}\nll merge(ll h1,ll h2,int len)\n{\n    return h2+h1*base[len];\n}\nint ans,res;\nvoid solve()\n{\n    memset(f,0,sizeof(f));\n    memset(g,0,sizeof(g));\n    for(int i=1;i<=m;i++)  has[i]=has[i-1]*131+t[i]-'a'+1;\n    for(int i=1;i<=2;i++)\n    {\n        for(int j=1;j<=n;j++)\n        {\n            for(int k=j;k>=1;k--)\n            { \n                int len=2*(j-k+1);\n                if(len>m)  continue;\n                ll h1=get_pre(k,j,i),h2=get_suf(k,j,3-i),hx=has[len];\n                if(merge(h2,h1,j-k+1)==hx)\n                {\n                    if(len==m)   res++;\n                    else         g[i][j][len]=1; \n                }\n            }\n        }\n    }\n    for(int i=1;i<=2;i++)\n      for(int j=1;j<=n;j++)\n        if(s[i][j]==t[1])  g[i][j][1]=1;\n    for(int i=m;i>=1;i--)  has[i]=has[i+1]*131+t[i]-'a'+1;\n    for(int k=1;k<m;k++)\n    {\n        for(int j=1;j<=n;j++)\n        {\n            for(int i=1;i<=2;i++)\n            {\n                if(g[i][j][k])\n                {\n                    if(j<n&&s[i][j+1]==t[k+1])  add(f[i][j+1][k+1],g[i][j][k]);\n                }\n                if(f[i][j][k])\n                {\n                    if(j<n&&s[i][j+1]==t[k+1])  add(f[i][j+1][k+1],f[i][j][k]);\n                    if(s[3-i][j]==t[k+1])       add(g[3-i][j][k+1],f[i][j][k]);\n                }\n            }\n        }\n    }\n    for(int i=1;i<=2;i++)\n    {\n        for(int j=1;j<=n;j++)\n        {\n            if(s[i][j]==t[m])\n            {\n                if(m==1)  add(ans,1);\n                add(ans,f[i][j-1][m-1]);\n                add(ans,g[i][j-1][m-1]);\n            }\n            for(int k=j;k<=n;k++)\n            {\n                int len=2*(k-j+1);\n                if(len>m)  continue;\n                ll h1=get_pre(j,k,3-i),h2=get_suf(j,k,i),hx=has[m-len+1];\n                if(merge(h1,h2,k-j+1)==hx)\n                {\n                    if(len==m&&m!=2)  res++;\n                    else{\n                        add(ans,f[i][j-1][m-len]);\n                        add(ans,g[i][j-1][m-len]);\n                    }\n                }\n            }\n        }\n    }\n}\nint main()\n{\n\n    scanf(\"%s\",s[1]+1);scanf(\"%s\",s[2]+1);n=strlen(s[1]+1);\n    scanf(\"%s\",t+1);m=strlen(t+1);\n    base[0]=1;for(int i=1;i<=max(n,m);i++)  base[i]=base[i-1]*131;\n    for(int i=1;i<=2;i++)\n      for(int j=1;j<=n;j++)  has_pre[i][j]=has_pre[i][j-1]*131+s[i][j]-'a'+1;\n    for(int i=1;i<=2;i++)\n      for(int j=n;j>=1;j--)  has_suf[i][j]=has_suf[i][j+1]*131+s[i][j]-'a'+1;\n    solve();\n    reverse(t+1,t+m+1);\n    solve();\n    add(ans,res/2);\n    if(m==1)  ans/=2;\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1582094397,
        "uid": 46396,
        "name": "justin_cao",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 CF613E \u3010Puzzle Lover\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u4e2a\u548c\u9898\u89e3\u533a\u6e05\u4e00\u8272\u7684\u5206\u4e09\u6bb5\u4e0d\u540c\u7684\u7b97\u6cd5\uff0c\u533a\u522b\u5728\u4e8e\u7ad6\u7740\u7684\u8fc7\u7a0b\u5728\u8f6c\u79fb\u4e2d\u4f53\u73b0\u3002\n\n\u4ee5\u4e0b\u5747\u770b\u505a $n,k$ \u540c\u9636\uff0c\u6545\u53ea\u7528 $n$ \u8fdb\u884c\u5206\u6790\u590d\u6742\u5ea6\u3002\n\n\u4e00\u773c\u770b\u5230 $2\\times n$ \u7684\u7f51\u683c\u56fe\u53ea\u80fd\u4e0a\u4e0b\u5de6\u53f3\u8d70\uff0c\u4e0d\u96be\u60f3\u5230[P4740](https://www.luogu.com.cn/problem/P4740)\u3002\n\n\u7c7b\u4f3c\u7684\u601d\u8def\uff0c\u6211\u4eec\u8bbe $f_{i,j,0/1,0/1}$ \u8868\u793a\u5728\u7b2c $i$ \u5217\uff0c\u5b57\u7b26\u4e32\u4ece\u7b2c $j$ \u4e2a\u4f4d\u7f6e\u5339\u914d**\u5e76\u4e14\u4e0d\u80fd\u56de\u5934**\u7684\u65b9\u6848\u6570\uff0c\u540e\u9762\u7684 $0/1$ \u8868\u793a\u5728\u4e0a\u4e00\u884c/\u4e0b\u4e00\u884c\uff0c\u662f\u5426\u8fdb\u884c\u4e86\u5de6\u53f3\u7ffb\u8f6c\u3002\n\n\u8fd9\u91cc**\u4e0d\u80fd\u56de\u5934**\u4e0d\u597d\u8bf4\uff0c\u4f46\u5982\u679c\u505a\u4e86[P4740](https://www.luogu.com.cn/problem/P4740)\u80af\u5b9a\u80fd\u7406\u89e3\uff0c\u6211\u7528\u4e0b\u56fe\u89e3\u91ca\u4e00\u4e0b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/owdrp64h.png?x-oss-process=image/resize,m_lfit,h_150,w_200)\n\n$f_{x,y,0,0}$ \u8868\u793a\u7684\u5c31\u662f\u4ece\u7ea2\u8272\u7bad\u5934\u5904\u51fa\u53d1\uff0c**\u4f46\u4e0d\u80fd\u8d70\u5230\u84dd\u8272\u7684\u7ebf\u4ee5\u5de6\u7684\u9ed1\u8272\u90e8\u5206**\uff0c\u53ea\u80fd\u5728\u767d\u8272\u90e8\u5206\u8fdb\u884c\u5339\u914d\u7684\u65b9\u6848\u6570\u3002\n\n\u5148\u8003\u8651\u4e00\u4e2a naive \u7684\u8f6c\u79fb\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3e\u5728\u5f53\u524d\u884c\u6a2a\u7740\u5339\u914d\u4e86\u591a\u957f\uff0c\u5047\u8bbe\u5339\u914d\u4e86 $k$\uff0c\u94a6\u5b9a\u5c31\u5339\u914d\u4e86\u8fd9\u4e48\u957f\uff0c\u4e0b\u4e00\u6b65\u5fc5\u987b\u8f6c\u5f2f\uff0c\u5373\u7ad6\u7740\u8d70\u3002\n\n\u7ad6\u7740\u8d70\u4e86\u8fc7\u540e\u8981\u4e0d\u5411\u5de6\uff0c\u8981\u4e0d\u5411\u53f3\uff0c\u5373\u8981\u4e0d\u53cd\u7740\u5f80\u56de\u8d70\uff0c\u8981\u4e0d\u987a\u7740\u5f80\u540e\u8d70\u3002\n\n\u53cd\u7740\u8d70\u53ea\u6709\u4e00\u79cd\u8d70\u6cd5\uff0c\u800c\u4e14\u5fc5\u987b\u6070\u597d\u5339\u914d\u3002\n\n\u987a\u7740\u5f80\u540e\u8d70\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528 $f_{i+k,j+k+1,f1\\hat\\ 1,f2}$ \u8f6c\u79fb\u5230 $f_{i,j,f1,f2}$\uff0c\u6ce8\u610f\u8fd9\u91cc $j+k+1$ \u591a\u52a0\u4e86 $1$ \u662f\u56e0\u4e3a\u7ad6\u7740\u8d70\u4e86\u4e00\u6b65.\n\n\u603b\u590d\u6742\u5ea6 $O(n^3)$\uff0c\u72b6\u6001 $O(n^2)$\uff0c\u8f6c\u79fb $O(n)$\u3002\n\n\u8fd9\u4e2a\u8f6c\u79fb naive \u7684\u5730\u65b9\u5728\u4e8e\u6a2a\u7740\u80fd\u5339\u914d\u591a\u957f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\uff0c\u4f46\u662f\u8fd8\u5f97\u8003\u8651\u7ad6\u7740\u80fd\u8d70\u624d\u80fd\u8f6c\u79fb\uff0c\u53d1\u73b0\u7ad6\u7740\u80fd\u8d70\u7684\u6761\u4ef6\u6709\u4e24\u79cd\uff1a\n\n- \u6a2a\u7740\u4e0b\u4e00\u4f4d\u5339\u914d\u4e14\u7ad6\u7740\u4e0b\u4e00\u4f4d\u4e0e\u6a2a\u7740\u4e0b\u4e00\u4f4d\u76f8\u7b49\n- \u6a2a\u7740\u4e0b\u4e00\u4f4d\u4e0d\u5339\u914d\u4f46\u7ad6\u7740\u4e0b\u4e00\u4f4d\u5339\u914d\n\n\u7b2c\u4e8c\u79cd\u53ea\u4f1a\u6709\u4e00\u5904\uff0c\u5373\u5931\u914d\u7684\u4f4d\u7f6e\uff0c\u7279\u6b8a\u8003\u8651\u5373\u53ef\u3002\n\n\u7b2c\u4e00\u79cd\u53ef\u4ee5\u9884\u5904\u7406\u5e26\u6743\u524d\u7f00\u548c\uff0c\u6743\u4e3a\u7ad6\u7740\u4e0b\u4e00\u4f4d\u4e0e\u6a2a\u7740\u4e0b\u4e00\u4f4d\u662f\u5426\u76f8\u7b49\u3002\n\n\u53cd\u7740\u8d70\u7684\u8f6c\u79fb\u53ca\u5176\u7c7b\u4f3c\uff0c\u540c\u6837\u53ef\u4ee5\u7528\u7279\u6b8a\u5904\u7406\u548c\u5e26\u6743\u524d\u7f00\u548c\u5904\u7406\uff0c\u7136\u540e\u53ea\u53d6\u8fc7\u534a\u7684\u8f6c\u79fb\u3002\n\n\u7136\u540e\u53ea\u8981\u77e5\u9053\u80fd\u5339\u914d\u591a\u957f\u5c31\u80fd $O(1)$ \u8f6c\u79fb\u4e86\uff0c\u800c\u80fd\u5339\u914d\u7684\u957f\u5ea6\u663e\u7136\u53ef\u4ee5\u968f\u4fbf\u9884\u5904\u7406\uff0c\u81f3\u6b64\u53ef\u4ee5\u5904\u7406\u51fa $f$ \u6570\u7ec4\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u7edf\u8ba1\u7b54\u6848\u4e86\uff0c\u6211\u4eec\u679a\u4e3e\u8d77\u59cb\u4f4d\u7f6e\u5e76\u5411\u67d0\u4e2a\u65b9\u5411\u8d70 $O(n)$\uff0c\u518d\u679a\u4e3e\u7b2c\u4e00\u6b21\u6a2a\u7740\u8d70\u4e86\u591a\u957f $O(n)$\uff0c\u663e\u7136\u53cd\u7740\u8d70\u8fc7\u540e\u548c\u987a\u7740\u8d70\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 $f$ \u6570\u7ec4\u8f6c\u79fb\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u9884\u5904\u7406 $O(n^2)$\u3002\n\n\u5904\u7406 $f$ \u6570\u7ec4 $O(n^2)$\uff0c\u56e0\u4e3a\u72b6\u6001\u6570\u4e3a $O(n^2)$\uff0c\u8f6c\u79fb $O(1)$\u3002\n\n\u7edf\u8ba1\u7b54\u6848 $O(n^2)$\uff0c\u5176\u5b9e\u7528\u8f6c\u79fb $f$ \u6570\u7ec4\u7684\u6280\u5de7\u53ef\u4ee5\u505a\u5230 $O(n)$\uff0c\u4f46\u6ca1\u5fc5\u8981\u3002\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/ifhrymkx)\n\n\u4ebf\u4e9b\u7ec6\u8282\uff1a\n\n- \u5982\u679c\u5339\u914d\u4e32 $w$ \u53ea\u6709\u4e00\u4e2a\u5b57\u7b26\u76f4\u63a5\u7b97\u5f88\u5bb9\u6613\u91cd\uff0c\u76f4\u63a5\u7279\u5224\u627e\u8fd9\u79cd\u5b57\u7b26\u6709\u591a\u5c11\u4e2a\u3002\n- \u77e9\u9635\u7684\u4e32\u4e0e\u5339\u914d\u4e32\u80fd\u5339\u914d\u591a\u957f\u7684\u9884\u5904\u7406\u5176\u5b9e\u5c31\u662f\u6c42\u4e24\u4e32\u4efb\u610f\u4e24\u540e\u7f00\u7684 LCP\u3002\n  \n  \u5728 CF \u7684\u6807\u89e3\u4e2d\u5217\u4e3e\u51fa\u4e86\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u7684\u62c9\u80ef\u7b97\u6cd5\uff1aHash\u3001suffix structures\uff08\u540e\u7f00\u7ed3\u6784\uff09\n  \n  \u7136\u540e\u63a8\u8350\u4e86\u4e00\u4e2a\u66f4\u62c9\u80ef\u7684\u7b97\u6cd5\uff1a\u6269\u5c55 KMP\uff0c~~\u66f4\u559c\u5267\u7684\u662f\u6211\u6ca1\u770b CF \u6807\u89e3\u7136\u540e\u548c\u6807\u89e3\u60f3\u4e00\u5757\u53bb\u4e86~~\u3002\n  \n  \u5b9e\u9645\u4e0a\u7528\u4e00\u4e2a DP \u5c31\u53ef\u4ee5\u8f7b\u677e\u89e3\u51b3\uff1a$f_{i,j}$ \u8868\u793a $i,j$ \u4e24\u540e\u7f00\u7684 LCP\uff0c\u5224\u65ad\u5f53\u524d\u4f4d\u7f6e\u7136\u540e\u7528 $f_{i+1,j+1}$ \u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\u3002\n  \n- \u5982\u679c\u7b2c\u4e00\u6b21\u6a2a\u7740\u8d70\u4e86 1 \u7684\u957f\u5ea6\uff0c\u5373\u76f4\u63a5\u5f80\u4e0a\u8d70\uff0c\u4f1a\u548c\u53cd\u8f6c\u540e\u7684\u8d21\u732e\u7b97\u91cd\uff0c\u6240\u4ee5\u7279\u5224\u8d21\u732e\u4e58 $\\frac12$\u3002\n- \u524d\u7f00\u548c\u4f18\u5316\u90e8\u5206\u5bb9\u6613\u6302\uff0c\u540c\u65f6 $f$ \u8f6c\u79fb\u548c\u7edf\u8ba1\u7b54\u6848\u6709**\u5f88\u591a\u7279\u5224**\uff0c\u5efa\u8bae\u5148\u5199\u4e2a\u66b4\u529b\u518d\u5bf9\u7740\u6539\uff0c\u4e5f\u53ef\u4ee5\u53c2\u8003\u6211\u7684\u5b9e\u73b0\u3002\n\nUpd\uff1a\u91cd\u6784\u4e86\u90e8\u5206\u62c9\u80ef\u7684\u5730\u65b9\uff0c\u8865\u5145\u4e86\u4ee3\u7801\u3002",
        "postTime": 1628473936,
        "uid": 158948,
        "name": "\u7ea6\u745f\u592b\u7528\u8111\u73a9",
        "ccfLevel": 0,
        "title": "CF613E Puzzle Lover"
    }
]