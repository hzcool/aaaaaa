[
    {
        "content": "# CF1717F \u9898\u89e3\n\n## \u601d\u8def\u5206\u6790\n\n\u8003\u8651\u628a\u539f\u9898\u8f6c\u5316\u6210\u4e00\u4e2a\u56fe\u8bba\u9898\uff0c\u5373\u7ed9\u5b9a\u4e00\u5f20\u65e0\u5411\u56fe\uff0c\u5c06\u5176\u4e2d\u7684\u6bcf\u6761\u8fb9\u89c4\u5b9a\u4e00\u4e2a\u65b9\u5411\u4f7f\u5f97\u5bf9\u4e8e\u6240\u6709 $u\\in \\mathbf S$ \u6709 $\\operatorname{InDegree}(u)-\\operatorname{OutDegree}(u)=a_u$\uff0c\u5176\u4e2d $\\mathbf S$ \u662f\u9898\u76ee\u4e2d\u6240\u6709 $s_i=1$ \u7684 $i$ \u6784\u6210\u7684\u96c6\u5408\u3002\n\n\u6ce8\u610f\u5230 $\\operatorname{InDegree}(u)+\\operatorname{OutDegree}(u)=\\operatorname{Degree}(u)$ \u5df2\u7ecf\u786e\u5b9a\uff0c\u56e0\u6b64\u8be5\u9650\u5236\u7b49\u4ef7\u4e8e $\\operatorname{InDegree}(u)=\\dfrac{a_u+\\operatorname{Degree}(u)}2$\uff0c\u8bb0\u4e3a $f_u$\uff0c\u663e\u7136\uff0c\u5982\u679c\u67d0\u4e2a $f_u\\not\\in \\mathbb N$ \u5219\u65e0\u89e3\u3002\n\n\u8003\u8651\u5efa\u6a21\u6210\u7f51\u7edc\u6d41\u6a21\u578b\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u548c\u6bcf\u4e2a\u8fb9\u5206\u522b\u5efa\u7acb\u8282\u70b9\uff0c\u663e\u7136\u5148\u5c06\u6bcf\u4e2a\u8fb9\u8282\u70b9\u5411\u5176\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\u7684\u5bf9\u5e94\u8282\u70b9\u8fde\u63a5\u4e00\u6761\u4efb\u610f\u8fb9\u6743\u7684\u8fb9\uff0c\u4ee5\u8fb9\u6743\u4e3a $1$ \u4e3a\u4f8b\u3002\n\n\u7531\u4e8e\u6bcf\u6761\u8fb9\u53ea\u80fd\u6d41\u5411\u4e00\u4e2a\u7aef\u70b9\u4e14\u6bcf\u6761\u8fb9\u53ea\u80fd\u9009\u62e9\u4e00\u6b21\uff0c\u56e0\u6b64\u4ece\u6e90\u70b9\u5411\u6bcf\u4e2a\u8fb9\u8282\u70b9\u8fde\u4e00\u6761\u8fb9\u6743\u4e3a $1$ \u7684\u8fb9\u3002\n\n\u6b64\u65f6\uff0c\u6bcf\u5411\u67d0\u4e2a\u70b9 $u$ \u5bf9\u5e94\u7684\u8282\u70b9\u6d41 $1$ \u7684\u6d41\u91cf\uff0c\u5373\u7b49\u4ef7\u4e8e\u4f7f $\\operatorname{InDegree}(u)\\gets \\operatorname{InDegree}(u)+1$\u3002\n\n\u7136\u540e\u8003\u8651\u5728\u5f53\u524d\u9650\u5236\u4e0b\u80fd\u4e0d\u80fd\u8ba9 $\\mathbf S$ \u4e2d\u7684\u5143\u7d20 $i$ \u6d41\u8fc7 $f_i$ \u7684\u6d41\u91cf\uff0c\u56e0\u6b64\u5bf9\u4e8e $\\mathbf S$ \u4e2d\u7684\u6bcf\u4e2a $i$ \u5bf9\u5e94\u7684\u8282\u70b9\u90fd\u5411\u6c47\u70b9\u8fde\u4e00\u6761\u8fb9\u6743\u4e3a $f_i$ \u7684\u8fb9\uff0c\u5982\u679c\u6700\u7ec8\u7684\u6700\u5927\u6d41\u7b49\u4e8e $\\mathbf S$ \u4e2d $f_i$ \u7684\u548c\u5219\u8868\u793a\u5b58\u5728\u4e00\u79cd\u65b9\u5f0f\u4f7f\u5f97\u5bf9\u4e8e\u539f\u95ee\u9898\u4e2d\u6bcf\u4e00\u4e2a $s_i=1$ \u6709 $a_i=b_i$\u3002\n\n\u8003\u8651\u5982\u4e0b\u6570\u636e\uff1a\n\n```\n3 3\n1 1 1\n0 -1 0\n1 2\n2 3\n3 1\n```\n\n\u6b64\u65f6\u5f97\u5230\u7684\u6d41\u91cf\u7f51\u7edc\u5982\u4e0b\u56fe\uff1a\n\n[![voG2bn.png](https://s1.ax1x.com/2022/09/03/voG2bn.png)](https://imgse.com/i/voG2bn)\n\n\u5176\u4e2d $e1\\sim e3$ \u8868\u793a\u4e09\u6761\u8fb9\u5206\u522b\u5bf9\u5e94\u7684\u8282\u70b9\uff0c$n1\\sim n3$ \u662f\u4e09\u4e2a\u8282\u70b9\u5bf9\u5e94\u7684\u8282\u70b9\uff0c$S,T$ \u662f\u6e90\u70b9\u548c\u6c47\u70b9\u3002\n\n\u4e0a\u56fe\u7684\u6700\u5927\u6d41\u4e3a $2$\uff0c\u6ee1\u8db3\u6761\u4ef6\uff0c\u4f46\u662f\u539f\u6570\u636e\u5e76\u6ca1\u6709\u89e3\uff0c\u56e0\u4e3a\u56fe\u4e0a $S\\to e2$ \u7684\u8fb9\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u80fd\u6d41\uff0c\u5426\u5219\u5c31\u65e0\u89e3\u4e86\u3002\n\n\u7531\u4e8e\uff0c\u7f51\u7edc\u6d41\u53ea\u80fd\u4fdd\u8bc1\u6bcf\u6761\u8fb9**\u81f3\u591a**\u9009\u62e9\u4e00\u6b21\u800c\u4e0d\u662f**\u6070\u597d**\u9009\u62e9\u4e00\u6b21\uff0c\u56e0\u6b64\u6211\u4eec\u6700\u540e\u8fd8\u9700\u8981**\u5728\u521a\u624d\u6c42\u8fc7\u6700\u5927\u6d41\u7684\u56fe\u4e2d**\uff0c\u628a\u4e0d\u5728 $\\mathbf S$ \u91cc\u7684\u8282\u70b9\u90fd\u5411\u6c47\u70b9\u8fde\u4e00\u6761\u8fb9\u6743\u4e3a $\\infty$ \u7684\u8fb9\uff0c\u518d\u6c42\u4e00\u6b21\u6700\u5927\u6d41\uff0c\u5982\u679c\u4e24\u6b21\u6700\u5927\u6d41\u5f97\u5230\u7684\u7ed3\u679c\u7684\u548c\u4e3a $m$ \u624d\u80fd\u8bf4\u660e\u6211\u4eec\u9009\u62e9\u4e86\u6240\u6709\u7684\u8fb9\u3002\n\n\u8f93\u51fa\u7b54\u6848\u7684\u65f6\u5019\u53ea\u9700\u8981\u8003\u8651\u6bcf\u6761\u8fb9\u8282\u70b9\u7684\u6d41\u91cf\u6d41\u5411\u54ea\u4e2a\u8282\u70b9\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta((n+m)\\sqrt m)$\uff0c\u8bc1\u660e\u53c2\u89c1\u5b98\u65b9\u9898\u89e3\u3002\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h> \n#define int long long\nusing namespace std;\n\nnamespace Dinic {\n\nconst int MAXN=2e4+5,MAXM=1e5+5,INF=1e18;\nstruct node {\n\tint des,val,lst;\n}\tedge[MAXM];\nint head[MAXN],cur[MAXN],dep[MAXN],tot=1;\nint S,T;\nbool inq[MAXN];\ninline void add(int u,int v,int w) {\n\tedge[++tot]=(node){v,w,head[u]};\n\thead[u]=tot;\n}\ninline bool bfs() {\n\tqueue <int> q;\n\tmemset(dep,0,sizeof(dep));\n\tmemcpy(cur,head,sizeof(cur));\n\tq.push(S),dep[S]=1;\n\twhile(!q.empty()) {\n\t\tint p=q.front();\n\t\tq.pop();\n\t\tfor(int i=head[p];i;i=edge[i].lst) {\n\t\t\tint v=edge[i].des;\n\t\t\tif(!edge[i].val||dep[v]) continue;\n\t\t\tdep[v]=dep[p]+1;\n\t\t\tq.push(v);\n\t\t}\n\t}\n\treturn dep[T]>0;\n}\ninline int dfs(int p,int MaxFlow) {\n\tif(p==T||!MaxFlow) return MaxFlow;\n\tint RestFlow=MaxFlow;\n\tfor(int i=cur[p];i;i=edge[i].lst) {\n\t\tcur[p]=i;\n\t\tint v=edge[i].des;\n\t\tif(dep[v]==dep[p]+1&&edge[i].val) {\n\t\t\tint GetFlow=dfs(v,min(RestFlow,edge[i].val));\n\t\t\tif(!GetFlow) dep[v]=INF;\n\t\t\tedge[i].val-=GetFlow;\n\t\t\tedge[i^1].val+=GetFlow;\n\t\t\tRestFlow-=GetFlow;\n\t\t\tif(!RestFlow) break;\n\t\t}\n\t}\n\treturn MaxFlow-RestFlow;\n}\ninline int solve(int Source,int Dest) {\n\tS=Source,T=Dest;\n\tint MaxFlow=0;\n\twhile(bfs()) MaxFlow+=dfs(S,INF);\n\treturn MaxFlow;\n}\n\n}\n\ninline int link(int u,int v,int w) {\n\tDinic::add(v,u,0);\n\tDinic::add(u,v,w);\n\treturn Dinic::tot;\n}\ninline int value(int id) {\n\treturn Dinic::edge[id].val;\n}\n\nconst int MAXN=1e4+1,INF=1e18;\nint a[MAXN],s[MAXN],p[MAXN];\nstruct node {\n\tint src,des;\n}\tedge[MAXN];\n\nsigned main() {\n\tint n,m;\n\tscanf(\"%lld%lld\",&n,&m);\n\tint S=n+m+1,T=n+m+2;\n\tfor(int i=1;i<=n;++i) scanf(\"%lld\",&s[i]);\n\tfor(int i=1;i<=n;++i) scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<=m;++i) {\n\t\tint u,v;\n\t\tscanf(\"%lld%lld\",&u,&v);\n\t\t++a[u],++a[v];\n\t\tedge[i]=(node){u,v};\n\t\tlink(S,n+i,1);\n\t\tp[i]=link(n+i,u,1);\n\t\tlink(n+i,v,1);\n\t}\n\tint tot=0,res=0;\n\tfor(int i=1;i<=n;++i) {\n\t\tif(!s[i]) continue;\n\t\tif(a[i]<0||a[i]%2==1) return 0&puts(\"NO\");\n\t\ta[i]>>=1;\n\t\tlink(i,T,a[i]);\n\t\ttot+=a[i];\n\t}\n\tres=Dinic::solve(S,T);\n\tif(res!=tot) return 0&puts(\"NO\");\n\tfor(int i=1;i<=n;++i) if(!s[i]) link(i,T,INF);\n\tres+=Dinic::solve(S,T);\n\tif(res!=m) return 0&puts(\"NO\");\n\tputs(\"YES\");\n\tfor(int i=1;i<=m;++i) {\n\t\tif(value(p[i])>0) printf(\"%lld %lld\\n\",edge[i].src,edge[i].des);\n\t\telse printf(\"%lld %lld\\n\",edge[i].des,edge[i].src);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1662277886,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "CF1717F \u9898\u89e3"
    },
    {
        "content": "\u6df1\u611f wxw \u7206\u53c9 $33$ \u4eba\u7684\u5f3a\u5927\uff0c\u4ee5\u53ca\u6570\u636e\u4eba\u548c\u9898\u89e3\u4eba\u7684\u884c\u4e3a\u8fc7\u4e8e\u6446\u70c2\u3002\n\n\u8017\u5728\u8fd9\u9053\u9898\u4e0a\u4e00\u5929\u4e86\u634f\u3002\n\n## \u5206\u6790\n\n\u5148\u5c06\u6bcf\u4e00\u6761\u8fb9\u7684\u4e24\u7aef\u5747 $-1$\uff0c\u5219\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u5bf9\u4e8e\u6bcf\u4e00\u6761\u8fb9\u9009\u4e00\u4e2a\u7aef\u70b9 $+2$\u3002\n\n\u4e3a\u65b9\u4fbf\uff0c\u4e0d\u59a8\u8bbe $b_i=\\dfrac{a_i+deg_i}{2}$\u3002\n\n\u76f8\u5f53\u4e8e\u6bcf\u4e2a\u70b9\u73b0\u5728\u662f $-b_i$\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u6761\u8fb9\u9009\u4e00\u4e2a\u7aef\u70b9 $+1$\uff0c\u95ee\u662f\u5426\u5b58\u5728\u5168\u90e8\u6e05\u96f6\u7684\u65b9\u6848\u3002\n\n\u5148\u6392\u6389\u4e09\u7c7b\u975e\u6cd5\u60c5\u51b5\uff1a\n\n* \u5b58\u5728 $b_i$ \u4e3a\u8d1f\u6570\u3002\n* \u5b58\u5728 $b_i$ \u4e0d\u4e3a\u6574\u6570\u3002\n* $b_i$ \u4e4b\u548c $>m$\u3002\n\n## \u5efa\u56fe\n\n\u7f51\u7edc\u6d41\uff0c\u5c06\u6bcf\u6761\u8fb9\u4e5f\u5efa\u65b0\u70b9\uff08\u7b97\u8fdb\u6e90\u6c47\u5171 $n+m+2$ \u4e2a\u70b9\uff09\u3002\n\n\u4ee5\u4e0b\u65b9\u62ec\u53f7\u5185\u7684\u4e24\u4e2a\u6570\u5b57\u4ee3\u8868\u6d41\u91cf\u4e0a\u4e0b\u754c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u6761\u8fb9 $x:(u,v)$\uff08$x$ \u4e3a\u8fb9\u6240\u5bf9\u5e94\u7684\u70b9\u6807\u53f7\uff09\uff0c\u5efa\u8fb9\n$$\nS\\to x[1,1]\\quad x\\to u[0,1]\\quad x\\to v[0,1]\n$$\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $s=1$ \u7684\u70b9 $x$\n\n$$\nx\\to T[b_x,b_x]\n$$\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $s=0$ \u7684\u70b9 $x$\n\n$$\nx\\to T[0,\\infty]\n$$\n\n\u8dd1\u4e0a\u4e0b\u754c\u53ef\u884c\u6d41\u5373\u53ef\u3002\n\n~~\u5148\u4e0a\u4ee3\u7801\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5148\u522b\u6025\u3002~~\n\n## \u5982\u4f55\u5efa\u56fe\u53ca\u65f6\u95f4\u590d\u6742\u5ea6\n\n\u6211\u4eec\u5efa\u8fd9\u4e9b\u8fb9\uff08$E$ \u4e3a $m$ \u6761\u8fb9\u7684\u96c6\u5408\uff0c$S',T'$ \u4e3a\u539f\u56fe\u7684\u6e90\u6c47\uff0c$S,T$ \u4e3a\u4e0a\u4e0b\u754c\u5efa\u56fe\u7684\u6e90\u6c47\uff09\uff1a\n$$\n\\begin{array}{rll|l}\nS&\\to e&:1&e\\in E\n\\\\\nS'&\\to T&:1&\n\\\\\nS&\\to T'&:\\sum_i b_i&\n\\\\\n(u,v) &\\to u&:1& (u,v)\\in E\n\\\\\n(u,v) &\\to v&:1&\n\\\\\nx &\\to T&:b_x&s_x=1\n\\\\\nx &\\to T'&:\\color{red}\\infty&s_x=0\n\\\\\nT' &\\to S'&:\\color{blue}\\infty\n\\end{array}\n$$\n\u53d1\u73b0\u4e00\u4e2a\u70b9 $x$ \u7684\u5165\u6d41\u91cf\u4e0d\u8d85\u8fc7 $deg_x$\uff0c\u6240\u4ee5 ${\\color{red}\\infty}\\Rightarrow deg_x$\u3002\n\n\u53d1\u73b0\u539f\u56fe\u7684\u603b\u6d41\u91cf\u6700\u5927\u4e0d\u8d85\u8fc7 $m$\uff0c\u6240\u4ee5 ${\\color{blue}\\infty}\\Rightarrow m$\u3002\n\n\u8dd1 Dinic\uff0c\u7531\u4e8e\u6700\u591a\u589e\u5e7f $n-1$ \u6b21\uff0c\u800c\u4e14\u6bcf\u6b21\u589e\u5e7f\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7\u603b\u5bb9\u91cf $O(n+m)$\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(n(n+m))$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n/*\n* Author: ShaoJia\n* Last Modified time: 2022-09-03 20:47:59\n* Motto: We'll be counting stars.\n*/\n#pragma GCC optimize(\"Ofast\")\n#include<bits/stdc++.h>\nusing namespace std;\n#define fir first\n#define sec second\n#define mkp make_pair\n#define pb emplace_back\n#define For(i,j,k) for(int i=(j),i##_=(k);i<=i##_;i++)\n#define Rof(i,j,k) for(int i=(j),i##_=(k);i>=i##_;i--)\n#define ckmx(a,b) a=max(a,b)\n#define ckmn(a,b) a=min(a,b)\n#define debug(...) cerr<<\"#\"<<__LINE__<<\": \"<<__VA_ARGS__<<endl\nconst int N=10010,M=40010;\nint n,m,sum=0,a[N],deg[N],p[N],L[N],R[N];\nbool s[N];\nstruct edge{\n\tint nxt,to,flow;\n}e[M<<1];\nint mf=0,dis[N<<1],cur[N<<1],head[N<<1],S0,T0,S,T,tot=1,v[N],ans[N];\ninline void adde(int x,int y,int z){\n\t// cout<<x<<\" \"<<y<<\":\"<<z<<endl;\n\te[++tot]=(edge){head[x],y,z}; head[x]=tot;\n\te[++tot]=(edge){head[y],x,0}; head[y]=tot;\n}\nqueue<int> q;\nbool bfs(){\n\tfill(dis+1,dis+1+T,0);\n\tdis[S]=1;\n\tq.push(S);\n\tint x;\n\twhile(!q.empty()){\n\t\tx=q.front();\n\t\tq.pop();\n\t\tcur[x]=head[x];\n\t\tfor(int i=head[x],to;i;i=e[i].nxt){\n\t\t\tto=e[i].to;\n\t\t\tif(!e[i].flow) continue;\n\t\t\tif(!dis[to]){\n\t\t\t\tdis[to]=dis[x]+1;\n\t\t\t\tq.push(to);\n\t\t\t}\n\t\t}\n\t}\n\treturn dis[T];\n}\nint dfs(int x,int flow){\n\tif(x==T) return flow;\n\tint res=0;\n\tfor(int &i=cur[x],to,tmp;i;i=e[i].nxt){\n\t\tto=e[i].to;\n\t\tif(!e[i].flow || dis[to]!=dis[x]+1) continue;\n\t\ttmp=dfs(to,min(flow,e[i].flow));\n\t\tflow-=tmp;\n\t\tres+=tmp;\n\t\te[i].flow-=tmp;\n\t\te[i^1].flow+=tmp;\n\t\tif(!flow) break;\n\t}\n\treturn res;\n}\nvoid Dinic(){\n\twhile(bfs()) mf+=dfs(S,m+sum);\n}\nsigned main(){ios::sync_with_stdio(false),cin.tie(nullptr);\n\tcin>>n>>m;\n\tS0=n+m+1; T0=S0+1; S=T0+1; T=S+1;\n\tFor(i,1,n) cin>>s[i];\n\tint x,y;\n\tFor(i,1,n) cin>>a[i];\n\tFor(i,1,m){\n\t\tcin>>x>>y;\n\t\tdeg[x]++,deg[y]++;\n\t\tL[i]=x,R[i]=y;\n\t}\n\tFor(i,1,n){\n\t\tif(s[i]){\n\t\t\ta[i]+=deg[i];\n\t\t\tif(a[i]<0 || a[i]&1) return cout<<\"NO\"<<endl,0;\n\t\t\ta[i]>>=1;\n\t\t}else a[i]=0;\n\t}\n\t// debug(\"?\");\n\tFor(i,1,n) sum+=a[i];\n\tif(sum>m) return cout<<\"NO\"<<endl,0;\n\tFor(i,1,m){\n\t\tadde(S,i+n,1);\n\t\tp[i]=tot+1;\n\t\tadde(i+n,L[i],1);\n\t\tadde(i+n,R[i],1);\n\t}\t\n\tadde(S0,T,m);\n\tadde(S,T0,sum);\n\tadde(T0,S0,m);\n\tFor(i,1,n)\n\t\tif(s[i]) adde(i,T,a[i]);\n\t\telse adde(i,T0,deg[i]);\n\tDinic();\n\tif(mf!=m+sum) return cout<<\"NO\"<<endl,0;\n\tcout<<\"YES\"<<endl;\n\tFor(i,1,m){\n\t\tif(e[p[i]].flow) cout<<L[i]<<\" \"<<R[i]<<endl;\n\t\telse cout<<R[i]<<\" \"<<L[i]<<endl;\n\t}\nreturn 0;}\n```",
        "postTime": 1662688260,
        "uid": 101868,
        "name": "I_am_Accepted",
        "ccfLevel": 0,
        "title": "CF1717F Madoka and The First Session"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u8d39\u7528\u6d41](https://oi-wiki.org/graph/flow/min-cost/)\n\n\u4e00\u4e2a\u52a0\u4e00\u4e00\u4e2a\u51cf\u4e00\u4e0d\u4fbf\u64cd\u4f5c\uff0c\u4e0d\u59a8\u5148\u5bf9\u6bcf\u4e2a\u64cd\u4f5c $(u, v)$\uff0c\u628a $a_u, a_v$ \u5404\u51cf\u4e00\uff0c\u628a\u64cd\u4f5c\u53d8\u6210\uff1a\n\n- \u8ba9 $a_u$ \u6216 $a_v$ \u52a0\u4e8c\u3002\n\n\u73b0\u5728\u95ee\u9898\u53d8\u4e3a\u6c42\u6bcf\u4e2a\u64cd\u4f5c\u4e8c\u9009\u4e00\u6267\u884c\u65f6\u80fd\u5426\u628a $a_u$ \u53d8\u4e3a $0$\u3002\n\n\u9996\u5148\u6709\u4e00\u4e9b\u663e\u7136\u7684\u65e0\u89e3\u6761\u4ef6\uff08\u4e0b\u9762\u5747\u4e3a\u5bf9 $1 \\leq i \\leq n, s_i = 1$ \u7684\u8ba8\u8bba\uff09\uff1a\n\n- $a_i > 0$\n- $a_i \\bmod 2 \\neq 0$\n\n\u628a\u8fd9\u4e9b\u60c5\u51b5\u5224\u6389\u540e\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u4ee4 $a_i \\leftarrow -\\frac{a_i}{2}$\u3002\n\n\u4e0b\u9762\u662f\u6211\u7684\u8d5b\u65f6 AC \u4f46\u8d5b\u540e WA \u7684\u505a\u6cd5\uff1a\n\n\u6ce8\u610f\u5230\u64cd\u4f5c\u662f\u4e8c\u9009\u4e00\uff0c\u8003\u8651\u901a\u8fc7\u7f51\u7edc\u6d41\u7684\u6d41\u91cf\u6765\u5bf9\u6b64\u8fdb\u884c\u9650\u5236\u3002\n\n\u8003\u8651\u5bf9\u6bcf\u4e2a\u64cd\u4f5c $i$ \u5efa\u70b9 $i$\uff0c\u5bf9\u6bcf\u4e2a\u5143\u7d20 $j$ \u5efa\u70b9 $j'$\u3002\n\n- $S \\to^1 i, i \\to^1 u_i', i \\to^1 v_i'$\uff0c\u8fd9\u4efd\u6d41\u91cf\u8981\u4e48\u524d\u5f80 $u_i'$\uff0c\u8981\u4e48\u524d\u5f80 $v_i'$\u3002\n- $\\forall s_i = 0, i' \\to^{\\infty} T$\uff0c\u5bf9\u4e8e\u65e0\u9650\u5236\u7684\u70b9\uff0c\u5176\u6d41\u91cf\u4e4b\u548c\u65e0\u9650\u5236\u3002\n- $\\forall s_i = 1, i' \\to^{a_i} T$\uff0c\u5bf9\u4e8e\u6709\u9650\u5236\u7684\u70b9\uff0c\u5176\u6d41\u91cf\u5fc5\u987b\u6070\u4e3a $a_i$\u3002\n\n\u5efa\u56fe\u8dd1\u6700\u5927\u6d41\u5373\u53ef\u3002\u6700\u540e\u82e5\u67d0\u4e2a\u64cd\u4f5c\u6ca1\u6709\u88ab\u6267\u884c\u6216\u6709\u9650\u5236\u7684\u70b9\u6ca1\u6709\u6d41\u6ee1\u65f6\u5747\u65e0\u89e3\u3002\u8f93\u51fa\u65b9\u6848\u65f6\u770b\u4e00\u4e0b\u5bf9\u4e8e\u6bcf\u4e2a\u64cd\u4f5c $i$\uff0c\u5176\u6d41\u91cf\u662f\u6d41\u5411\u4e86 $u_i'$ \u8fd8\u662f $v_i'$ \u5373\u53ef\u3002\n\n\u7136\u800c\u8d5b\u540e\u518d\u6b21\u63d0\u4ea4\u5374\u663e\u793a WA on 67 /fn\n\n\u4ed4\u7ec6\u60f3\u4e00\u60f3\u4f1a\u53d1\u73b0\u8fd9\u79cd\u505a\u6cd5\u662f\u6709\u95ee\u9898\u7684\uff0c\u95ee\u9898\u51fa\u5728\u5bf9\u65e0\u9650\u5236\u7684\u70b9\u7684\u8ba8\u8bba\u4e0a\uff0c\u56e0\u4e3a\u6211\u4eec\u53ea\u9700\u8981\u6709\u9650\u5236\u7684\u70b9\u6ee1\u6d41\u3002\n\n\u8003\u8651\u4e0d\u5efa\u51fa\u65e0\u9650\u5236\u7684\u70b9\u76f8\u5173\u7684\u8fb9\u3002\n\n\u6211\u4eec\u73b0\u5728\u5bf9\u4e0a\u8ff0\u5efa\u56fe\u8fdb\u884c\u4fee\u6b63\uff1a\n\n- $S \\to^1 i$\uff0c\u64cd\u4f5c $i$ \u81f3\u591a\u4e00\u4efd\u6d41\u5411\u6709\u9650\u5236\u7684\u70b9\u7684\u6d41\u91cf\u3002\n- \u82e5 $s_{u_i} = 1$\uff0c$i \\to^1 u_i'$\uff0c\u8fd9\u4efd\u6d41\u91cf\u53ef\u4ee5\u524d\u5f80 $u_i'$\u3002\n- \u82e5 $s_{v_i} = 1$\uff0c$i \\to^1 v_i'$\uff0c\u8fd9\u4efd\u6d41\u91cf\u53ef\u4ee5\u524d\u5f80 $v_i'$\u3002\n- $\\forall s_i = 1, i' \\to^{a_i} T$\uff0c\u5bf9\u4e8e\u6709\u9650\u5236\u7684\u70b9\uff0c\u5176\u6d41\u91cf\u5fc5\u987b\u6070\u4e3a $a_i$\u3002\n\n\u5efa\u56fe\u8dd1\u6700\u5927\u6d41\u5373\u53ef\u3002\u6700\u540e\u82e5\u6709\u9650\u5236\u7684\u70b9\u6ca1\u6709\u6d41\u6ee1\u65f6\u5747\u65e0\u89e3\u3002\n\n\u4f46\u8fd9\u91cc\u6709\u4e00\u5904\u4e0e\u4e0a\u8ff0\u4e0d\u540c\uff0c\u8f93\u51fa\u65b9\u6848\u65f6\u6709\u5982\u4e0b\u4e24\u79cd\u53ef\u80fd\uff1a\n\n1. \u8fd9\u6761\u8fb9\u6ca1\u6709\u6d41\u91cf\n\n\u82e5 $s_{u_i} = 1$ \u4e14 $s_{v_i} = 1$\uff0c\u65e0\u89e3\uff1b\u82e5 $s_{u_i} = 0$\uff0c\u8f93\u51fa $(u_i, v_i)$\uff1b\u5426\u5219\uff0c\u8f93\u51fa $(v_i, u_i)$\u3002\n\n2. \u8fd9\u6761\u8fb9\u6709\u6d41\u91cf\n\n\u82e5 $s_{u_i} = 1$ \u4e14 $i \\to u_i'$ \u8fd9\u6761\u8fb9\u6d41\u6ee1\u4e86\uff0c\u8f93\u51fa $(u_i, v_i)$\uff1b\u5426\u5219\uff0c\u8f93\u51fa $(v_i, u_i)$\u3002\n\n\u7136\u800c\u8fd8\u662f\u663e\u793a WA on 68 /fn\n\n\u73b0\u5728\u7684\u95ee\u9898\u5728\u4e8e\u4e5f\u8bb8\u67d0\u6761\u6ee1\u8db3 $s_{u_i} = 1$ \u4e14 $s_{v_i} = 1$ \u7684\u8fb9\u6709\u6d41\u91cf\u65f6\u53ef\u884c\uff0c\u4f46\u6ca1\u6709\u6d41\u91cf\u65f6\u53ef\u4ee5\u7531\u5176\u4ed6\u8fb9\u8865\u8db3\uff0c\u800c\u6b64\u65f6\u4f1a\u8f93\u51fa\u65e0\u89e3\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8981\u4f18\u5148\u8003\u8651\u6ee1\u8db3 $s_{u_i} = 1$ \u4e14 $s_{v_i} = 1$ \u7684\u8fb9\uff0c\u6240\u4ee5\u8003\u8651\u7ed9\u8fd9\u51e0\u6761\u8fb9\u8d4b\u8d39\u7528 $1$\uff0c\u7ed9\u5176\u4ed6\u8fb9\u8d4b\u8d39\u7528 $0$\u3002\n\n\u5efa\u56fe\u8dd1\u8d39\u7528\u6d41\u5373\u53ef\u3002\u6ce8\u610f\u9700\u8981\u5199 zkw \u8d39\u7528\u6d41\uff0c\u76f4\u63a5\u8dd1 SSP \u7b97\u6cd5\u4f1a TLE on 15\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <queue>\n\nusing namespace std;\n\ntypedef struct {\n\tint nxt;\n\tint end;\n\tint dis;\n\tint cost;\n} Edge;\n\nint cnt = 1, tm = 0;\nint s[10007], a[10007], u[10007], v[10007], head[20007], operation[10007], choice[10007], full[10007], dis[20007], vis1[20007];\nbool vis2[20007];\nEdge edge[80007];\nqueue<int> q;\n\ninline void init(int n){\n\tfor (register int i = 0; i <= n; i++){\n\t\tdis[i] = -2e9;\n\t\tvis1[i] = false;\n\t}\n}\n\ninline void add_edge(int start, int end, int dis, int cost){\n\tcnt++;\n\tedge[cnt].nxt = head[start];\n\thead[start] = cnt;\n\tedge[cnt].end = end;\n\tedge[cnt].dis = dis;\n\tedge[cnt].cost = cost;\n}\n\ninline void spfa(int start){\n\tdis[start] = 0;\n\tvis2[start] = true;\n\tq.push(start);\n\twhile (!q.empty()){\n\t\tint cur = q.front();\n\t\tq.pop();\n\t\tvis2[cur] = false;\n\t\tfor (register int i = head[cur]; i != 0; i = edge[i].nxt){\n\t\t\tif (edge[i].dis == 0){\n\t\t\t\tint x = edge[i].end, y = dis[cur] - edge[i].cost;\n\t\t\t\tif (dis[x] < y){\n\t\t\t\t\tdis[x] = y;\n\t\t\t\t\tif (!vis2[x]){\n\t\t\t\t\t\tvis2[x] = true;\n\t\t\t\t\t\tq.push(x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nint dfs(int u, int flow, int end){\n\tif (u == end) return flow;\n\tint ans = 0;\n\tvis1[u] = tm;\n\tfor (register int i = head[u]; i != 0; i = edge[i].nxt){\n\t\tint x = edge[i].end;\n\t\tif (vis1[x] != tm && edge[i].dis != 0 && dis[x] == dis[u] - edge[i].cost){\n\t\t\tint t = dfs(x, min(flow - ans, edge[i].dis), end);\n\t\t\tedge[i].dis -= t;\n\t\t\tedge[i ^ 1].dis += t;\n\t\t\tans += t;\n\t\t\tif (ans == flow) return ans;\n\t\t}\n\t}\n\treturn ans;\n}\n\ninline bool update(int n, int start){\n\tint delta = -2e9;\n\tfor (register int i = 0; i <= n; i++){\n\t\tif (vis1[i] == tm){\n\t\t\tfor (register int j = head[i]; j != 0; j = edge[j].nxt){\n\t\t\t\tif (edge[j].dis != 0){\n\t\t\t\t\tint x = edge[j].end;\n\t\t\t\t\tif (vis1[x] != tm) delta = max(delta, dis[x] - dis[i] + edge[j].cost);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (delta == -2e9) return false;\n\tfor (register int i = 0; i <= n; i++){\n\t\tif (vis1[i] == tm) dis[i] += delta;\n\t}\n\treturn dis[start] != 0x80000000;\n}\n\t \ninline pair<int, int> maxcost_maxflow(int n, int start, int end){\n\tpair<int, int> ans(0, 0);\n\tinit(n);\n\tspfa(end);\n\tdo {\n\t\tint flow = 0;\n\t\twhile (true){\n\t\t\tint t;\n\t\t\ttm++;\n\t\t\tt = dfs(start, 0x7fffffff, end);\n\t\t\tif (t == 0) break;\n\t\t\tflow += t;\n\t\t}\n\t\tans.first += flow;\n\t\tans.second += flow * dis[start];\n\t} while (update(n, start));\n\treturn ans;\n}\n\nint main(){\n\tint n, m, end;\n\tcin >> n >> m;\n\tend = n + m + 1;\n\tfor (register int i = 1; i <= n; i++){\n\t\tcin >> s[i];\n\t}\n\tfor (register int i = 1; i <= n; i++){\n\t\tcin >> a[i];\n\t}\n\tfor (register int i = 1; i <= m; i++){\n\t\tint cost;\n\t\tcin >> u[i] >> v[i];\n\t\tcost = s[u[i]] == 1 && s[v[i]] == 1 ? 1 : 0;\n\t\tadd_edge(0, i, 1, cost);\n\t\toperation[i] = cnt;\n\t\tadd_edge(i, 0, 0, -cost);\n\t\tif (s[u[i]] == 1){\n\t\t\tint u_ = u[i] + m;\n\t\t\ta[u[i]]--;\n\t\t\tadd_edge(i, u_, 1, 0);\n\t\t\tchoice[i] = cnt;\n\t\t\tadd_edge(u_, i, 0, 0);\n\t\t}\n\t\tif (s[v[i]] == 1){\n\t\t\tint v_ = v[i] + m;\n\t\t\ta[v[i]]--;\n\t\t\tadd_edge(i, v_, 1, 0);\n\t\t\tadd_edge(v_, i, 0, 0);\n\t\t}\n\t}\n\tfor (register int i = 1; i <= n; i++){\n\t\tif (s[i] != 0){\n\t\t\tif (a[i] > 0 || a[i] % 2 != 0){\n\t\t\t\tcout << \"NO\";\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tint i_ = i + m;\n\t\t\tadd_edge(i_, end, -a[i] / 2, 0);\n\t\t\tfull[i] = cnt;\n\t\t\tadd_edge(end, i_, 0, 0);\n\t\t}\n\t}\n\tmaxcost_maxflow(end, 0, end);\n\tfor (register int i = 1; i <= n; i++){\n\t\tif (s[i] == 1 && edge[full[i]].dis != 0){\n\t\t\tcout << \"NO\";\n\t\t\treturn 0;\n\t\t}\n\t}\n\tfor (register int i = 1; i <= m; i++){\n\t\tif (s[u[i]] == 1 && s[v[i]] == 1 && edge[operation[i]].dis != 0){\n\t\t\tcout << \"NO\";\n\t\t\treturn 0;\n\t\t}\n\t}\n\tcout << \"YES\" << endl;\n\tfor (register int i = 1; i <= m; i++){\n\t\tif (edge[operation[i]].dis == 0){\n\t\t\tif (choice[i] != 0 && edge[choice[i]].dis == 0){\n\t\t\t\tcout << u[i] << \" \" << v[i] << endl;\n\t\t\t} else {\n\t\t\t\tcout << v[i] << \" \" << u[i] << endl;\n\t\t\t}\n\t\t} else if (s[u[i]] == 0){\n\t\t\tcout << u[i] << \" \" << v[i] << endl;\n\t\t} else {\n\t\t\tcout << v[i] << \" \" << u[i] << endl;\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1662366102,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 CF1717F \u3010Madoka and The First Session\u3011"
    },
    {
        "content": "\u505a\u5b8c\u8fd9\u9053\u9898\u540e\uff0c\u5c45\u7136\u53d1\u73b0\u9898\u89e3\u533a\u90fd\u662f\u957f\u7bc7\u5927\u8bba\uff01\n\n\u770b\u5230 $n,m\\le 10000$ \u7684\u6570\u636e\u8303\u56f4\u548c\u9898\u76ee\u7684\u5e94\u7528\u80cc\u666f\uff0c\u4e0d\u96be\u60f3\u5230\u8fd9\u662f\u4e00\u9053\u6d41\u9898\u3002\n\n\u5bf9\u4e8e\u201c\u4e8c\u9009\u4e00\u201d\u7684\u9650\u5236\uff0c\u81ea\u7136\u8f6c\u5316\u4e3a\u5148\u5168\u90e8 $a_{u_i}\\gets a_{u_i}+1,a_{v_i}\\gets a_{v_i}-1$\uff0c\u7136\u540e\u5c31\u53d8\u6210\u4e86\u201c\u662f\u5426\u9009\u62e9\u5c06 $a_{u_i}\\gets a_{u_i}-2,a_{v_i}\\gets a_{v_i}+2$\u201d\u3002\n\n\u6b64\u65f6\u5982\u679c $\\exists 2\\nmid a_i$\uff0c\u65e0\u89e3\u3002\n\n\u90a3\u4e48\u81ea\u7136\u5c06 $\u00b12$ \u770b\u4f5c $\u00b11$\uff0c\u8fde\u8fb9 $(u_i,v_i,1,0)$\u3002\n\n\u73b0\u5728\u8981\u628a $s_i=1$ \u7684\u6240\u6709 $a_i$ \u5168\u90e8\u5f52\u96f6\uff0c$s_i=0$ \u7684\u968f\u4fbf\u5269\u591a\u5c11\u90fd\u53ef\u4ee5\u3002\n\n\u81ea\u7136\u5bf9\u4e8e\u6240\u6709 $s_i=1$\uff0c\u5f53 $a_i>0$ \u65f6\u8fde $(S,i,\\frac {a_i} 2,-\\inf)$\uff0c\u5f53 $a_i<0$ \u65f6\u8fde $(i,T,-\\frac {a_i}2,-\\inf)$\u3002\u8fd9\u5c31\u662f\u53ef\u884c\u6d41\u7684\u5e73\u8861\u6d41\u91cf\u7684\u6b65\u9aa4\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5982\u679c $a_i>0$ \u5c31\u4e00\u5b9a\u4f1a\u4f18\u5148\u589e\u5e7f\u8fd9\u4e00\u6761\u8fb9\uff0c\u5bfc\u81f4\u771f\u6b63\u7684\u51fa\u6d41\u603b\u662f\u6bd4\u5165\u6d41\u591a $\\frac {a_i}2$\uff0c\u4e5f\u5c31\u4ee3\u8868\u6700\u7ec8 $a_i$ \u4f1a\u51cf\u53bb $a_i$ \u53d8\u6210 $0$\u3002\n\n\u6700\u540e\u5bf9\u4e8e $s_i=0$\uff0c\u5165\u6d41\u51fa\u6d41\u53ef\u4ee5\u4e0d\u5e73\u8861\uff0c\u6240\u4ee5\u52a0 $(S,i,\\inf,0),(i,T,\\inf,0)$ \u5373\u53ef\u3002\n\n\u6700\u540e\u5224\u65ad\u662f\u5426\u201c\u771f\u7684\u201d\u5f52\u96f6\u4e86\u3002\u8fd9\u4e5f\u662f\u53ef\u884c\u6d41\u7684\u5fc5\u8981\u68c0\u9a8c\u6b65\u9aa4\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nnamespace IO {\nconst int buflen=1<<21;\nint x;\nbool f;\nchar ch,buf[buflen],*p1=buf,*p2=buf;\ninline char gc(){return p1==p2&&(p2=buf+fread(p1=buf,1,buflen,stdin),p1==p2)?EOF:*p1++;}\ninline int read(){\n\tx=0,f=1,ch=gc();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=0;ch=gc();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=gc();\n\treturn f?x:-x;\n}\n}\nusing IO::read;\nconst int N=1e4+5,E=6e4+5;\nint n,m,S,T,tot=1,a[N],s[N],we[E],dis[N],u[N],v[N];\nbool inq[N];\nstruct Edge {\n\tint y,z,c;\n}fr[N];\nvector<Edge>G[N];\nqueue<int>Q;\ninline void adde(int u,int v,int w,int c){\n\tG[u].emplace_back(Edge{v,++tot,c}),we[tot]=w;\n\tG[v].emplace_back(Edge{u,++tot,-c}),we[tot]=0;\n}\nbool spfa(){\n\tmemset(dis,0x3f,sizeof dis);\n\tQ.push(S);dis[S]=0;\n\twhile(!Q.empty()){\n\t\tint x=Q.front();Q.pop();inq[x]=0;\n\t\tfor(auto e:G[x]){\n\t\t\tint y=e.y,z=e.z,c=e.c;\n\t\t\tif(we[z]&&dis[y]>dis[x]+c){\n\t\t\t\tdis[y]=dis[x]+c;\n\t\t\t\tfr[y]=Edge{x,z,c};\n\t\t\t\tif(!inq[y])Q.push(y),inq[y]=1;\n\t\t\t}\n\t\t}\n\t}\n\treturn dis[T]!=dis[0];\n}\nint main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)s[i]=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<=m;i++)u[i]=read(),v[i]=read(),a[u[i]]++,a[v[i]]--;\n\tfor(int i=1;i<=n;i++)if(s[i]&&(a[i]&1)){puts(\"NO\");return 0;}\n\tfor(int i=1;i<=m;i++)adde(u[i],v[i],1,0);\n\tS=n+1,T=n+2;\n\tfor(int i=1;i<=n;i++){\n\t\tif(s[i]){\n\t\t\tif(a[i]>0)adde(S,i,a[i]/2,-100);\n\t\t\tif(a[i]<0)adde(i,T,-a[i]/2,-100);\n\t\t}\n\t\telse adde(S,i,1000000,0),adde(i,T,1000000,0);\n\t}\n\twhile(spfa()){\n\t\tint mn=1e9;\n\t\tfor(int i=T;i!=S;i=fr[i].y)mn=min(mn,we[fr[i].z]);\n\t\tif(dis[T]>=0)break;\n\t\tfor(int i=T;i!=S;i=fr[i].y)we[fr[i].z]-=mn,we[fr[i].z^1]+=mn;\n\t}\n\tfor(int i=1;i<=m;i++)if(we[2*i+1])a[u[i]]-=2,a[v[i]]+=2;\n\t//for(int i=1;i<=n;i++)cerr<<a[i]<<';';\n\tfor(int i=1;i<=n;i++)if(s[i]&&a[i]){puts(\"NO\");return 0;}\n\tputs(\"YES\");\n\tfor(int i=1;i<=m;i++)if(we[2*i+1])cout<<v[i]<<' '<<u[i]<<'\\n';else cout<<u[i]<<' '<<v[i]<<'\\n';\n\treturn 0;\n}\n/*\ng++ -o CF0529.exe CF0529.cpp -O2 -lm -std=c++14 -Wall -Wextra\n./CF0529.exe<in\n*/\n```",
        "postTime": 1685434624,
        "uid": 300078,
        "name": "pengyule",
        "ccfLevel": 7,
        "title": "Madoka and The First Session"
    }
]