{
    "description": "This is the hard version of the problem. It differs from the easy one only in constraints on $ n $ . You can make hacks only if you lock both versions.\n\nLet $ a_1, a_2, \\ldots, a_n $ be an array of non-negative integers. Let $ F(a_1, a_2, \\ldots, a_n) $ be the sorted in the non-decreasing order array of $ n - 1 $ smallest numbers of the form $ a_i + a_j $ , where $ 1 \\le i < j \\le n $ . In other words, $ F(a_1, a_2, \\ldots, a_n) $ is the sorted in the non-decreasing order array of $ n - 1 $ smallest sums of all possible pairs of elements of the array $ a_1, a_2, \\ldots, a_n $ . For example, $ F(1, 2, 5, 7) = [1 + 2, 1 + 5, 2 + 5] = [3, 6, 7] $ .\n\nYou are given an array of non-negative integers $ a_1, a_2, \\ldots, a_n $ . Determine the single element of the array $ \\underbrace{F(F(F\\ldots F}_{n-1}(a_1, a_2, \\ldots, a_n)\\ldots)) $ . Since the answer can be quite large, output it modulo $ 10^9+7 $ .",
    "inputFormat": "The first line contains one integer $ n $ ( $ 2 \\le n \\le 2 \\cdot 10^5 $ ) \u2014 the initial length of the array.\n\nThe second line contains $ n $ integers $ a_1, a_2, \\ldots, a_n $ ( $ 0 \\le a_i \\le 10^9 $ ) \u2014 the array elements.",
    "outputFormat": "Output a single number \u2014 the answer modulo $ 10^9 + 7 $ .",
    "samples": [
        [
            "5\n1 2 4 5 6",
            "34"
        ],
        [
            "9\n1 1 1 7 7 7 9 9 9",
            "256"
        ],
        [
            "7\n1 7 9 2 0 0 9",
            "20"
        ],
        [
            "3\n1000000000 1000000000 777",
            "1540"
        ]
    ],
    "hint": "In the first test, the array is transformed as follows: $ [1, 2, 4, 5, 6] \\to [3, 5, 6, 6] \\to [8, 9, 9] \\to [17, 17] \\to [34] $ . The only element of the final array is $ 34 $ .\n\nIn the second test, $ F(a_1, a_2, \\ldots, a_n) $ is $ [2, 2, 2, 8, 8, 8, 8, 8] $ . This array is made up of $ 3 $ numbers of the form $ 1 + 1 $ and $ 5 $ numbers of the form $ 1 + 7 $ .\n\nIn the fourth test, the array is transformed as follows: $ [10^9, 10^9, 777] \\to [10^9+777, 10^9+777] \\to [2 \\cdot 10^9 + 1554] $ . $ 2 \\cdot 10^9 + 1554 $ modulo $ 10^9+7 $ equals $ 1540 $ .",
    "translation": "\u7ed9\u51fa\u5e8f\u5217 $a_{1\\sim n}$\uff0c\u4e00\u6b21\u64cd\u4f5c\u5b9a\u4e49\u4e3a\u5c06 $a$ \u66ff\u6362\u4e3a $a_i + a_j(i<j)$ \u4e2d\u7684\u524d $(n-1)$ \u5c0f\u8005\uff0c\u6c42\u8fdb\u884c $(n-1)$ \u6b21\u64cd\u4f5c\u540e\u7684\u7ed3\u679c\u3002\u5bf9 $10^9+7$ \u53d6\u6a21\u3002"
}