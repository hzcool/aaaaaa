[
    {
        "content": "## Subtask 1\n\n\u7ed9\u66b4\u529b\u5206\u662f\u4e2d\u534e\u6c11\u65cf\u7684\u4f18\u79c0\u4f20\u7edf\u7f8e\u5fb7\u3002\n\n## Subtask 2\n\n\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u4e2a\u5b50\u4efb\u52a1\u7ed9\u4e86\u5f88\u591a\u5206\uff0c\u6697\u793a\u7740\u51fa\u9898\u4eba\u8ba4\u4e3a\u4f1a\u4e86\u6c42\u5355\u70b9\u5c31\u5dee\u4e0d\u591a\u4f1a\u505a\u4e86\uff08\u55ef\u55ef\uff09\u3002\n\n\u4fdd\u7559\u9898\u76ee\u4e2d 1 \u5f00\u59cb\u7684\u4e0b\u6807\u673a\u5236\uff0c\u6211\u4eec\u53d1\u73b0\u6d17\u4e00\u6b21\u724c\u672c\u8d28\u4e0a\u5c31\u662f\u8fdb\u884c\u4e00\u6b21\n\n$$\nk\\rightarrow 2k\\pmod{2^n+1}\n$$\n\n\u7684\u7f6e\u6362\uff08\u8bb0\u4e3a $P$\uff09\u3002\u800c\u9898\u76ee\u4e2d\u7684 $f(n)$ \u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u5bf9 $P^0,P^1,P^2,\\dots,P^{n-1}$ \u8fd9\u4e9b\u7f6e\u6362\u7684\u4e0d\u52a8\u70b9\u4e2a\u6570\u6c42\u548c\u3002\n\n\u4e0d\u59a8\u5148\u6765\u7814\u7a76\u4e00\u4e0b\u8fd9\u4e2a\u7f6e\u6362\u7684\u73af\u3002\u9996\u5148\u6709\u4e2a\u663e\u7136\u7684\u89c2\u5bdf\uff1a\u73af\u957f\u6700\u5927\u662f $2n$\u3002\u56e0\u4e3a\u5bf9\u4e8e\u4efb\u4f55\u6574\u6570 $t$\uff08$1\\le t\\le\\left(2^n+1\\right)$\uff09\uff0c\u6211\u4eec\u6709\n\n$$\n\\begin{aligned}\n&2^{2n}t\\\\\n=&\\left(2^{2n}-1\\right)t+t\\\\\n=&\\left(2^n-1\\right)\\left(2^n+1\\right)t+t\\\\\n=&t\\pmod{2^n+1}\n\\end{aligned}\n$$\n\n\u6211\u4eec\u60f3\u8981\u6c42\u51fa\u957f\u5ea6\u4e3a $k$ \u7684\u73af\u6709\u591a\u5c11\u4e2a\uff0c\u53ef\u76f4\u63a5\u5207\u5165\u4f3c\u4e4e\u4f1a\u6ca1\u6709\u4ec0\u4e48\u601d\u8def\u3002\u6211\u4eec\u8003\u8651\u8ba1\u7b97\u6240\u5728\u73af\u957f\u5ea6\u4e3a $k$ \u7684\u7ea6\u6570\u7684\u6570\u7684\u4e2a\u6570 $B_k$\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u5f97\u5230\u6240\u5728\u73af\u957f\u5ea6\u4e3a $k$ \u7684\u6570\u7684\u4e2a\u6570 $A_k$\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u6570 $t$\uff0c\u5b83\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a $k$ \u7684\u7ea6\u6570\u7684\u73af\u5185\uff0c\u5f53\u4e14\u4ec5\u5f53\n\n$$\n\\begin{aligned}\n2^kt&\\equiv t\\pmod{2^n+1}\\\\\n\\left(2^k-1\\right)t&\\equiv 0\\pmod{2^n+1}\n\\end{aligned}\n$$\n\n\u5373\n\n$$\n\\begin{aligned}\n(2^n+1)&\\mid \\left((2^k-1)t\\right)\\\\\n\\frac{2^n+1}{\\left(2^n+1,2^k-1\\right)}&\\mid t\n\\end{aligned}\n$$\n\n$\\left(2^n+1,2^k-1\\right)$\uff1f\u8fd9\u4e0d\u96be\u8ba9\u6211\u4eec\u60f3\u8d77\u4e00\u4e2a\u5b9a\u7406\uff1a\n\n> \u5b9a\u7406\u4e00\uff1a\u5bf9\u4e8e $n,m,a\\in\\Z^+$\uff0c\u6709\n>\n$$\n\\left(a^n-1,a^m-1\\right)=a^{(n,m)}-1\n$$\n\n\u5173\u4e8e\u8fd9\u4e2a\u5b9a\u7406\u7684\u4e00\u4e2a\uff08\u751a\u81f3\u66f4\u901a\u7528\u7684\u8bc1\u660e\uff09\u53ef\u4ee5\u770b [\u8fd9\u91cc](https://math.stackexchange.com/questions/7473/prove-that-gcdan-1-am-1-a-gcdn-m-1)\u3002\n\n\u53ef\u662f\u4e0a\u9762\u7684\u662f $\\left(2^n+1,2^k-1\\right)$\uff0c\u770b\u8d77\u6765\u4f3c\u4e4e\u6ca1\u4ec0\u4e48\u8054\u7cfb\u554a\uff1f\n\n\u6211\u4eec\u4e0d\u59a8\u6539\u5199\u4e3a\n\n$$\n\\left(2^n+1,2^k-1\\right)=\\left(\\frac{2^{2n}-1}{2^n-1},2^k-1\\right)\n$$\n\n\u7136\u540e\u6211\u4eec\u77e5\u9053\n\n> \u5b9a\u7406\u4e8c\uff1a\u5bf9\u4e8e $p,q,k\\in\\Z^+,(p,q)=1$\uff0c\u6709\n>\n$$\n(k,p)=\\frac{(k,pq)}{(k,q)}\n$$\n\n\u8fd9\u4e2a\u633a\u663e\u7136\u7684\u3002\u7531\u4e8e $(2^n-1,2^n+1)=(2^n-1,2)=1$\uff0c\u4e8e\u662f\u5c31\u6709\n\n$$\n\\begin{aligned}\n&\\left(2^n+1,2^k-1\\right)\\\\\n=&\\left(\\frac{2^{2n}-1}{2^n-1},2^k-1\\right)\\\\\n=&\\frac{\\left(2^{2n}-1,2^k-1\\right)}{\\left(2^n-1,2^k-1\\right)}\\\\\n=&\\frac{2^{(2n,k)}-1}{2^{(n,k)}-1}\n\\end{aligned}\n$$\n\n\u6211\u4eec\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n### $\\frac k{(n,k)}$ \u4e3a\u5947\u6570\n\n\u4e5f\u5c31\u662f\u8bf4 $(k,2n)=(k,n)$\uff0c\u90a3\u4e48\n\n$$\n\\begin{aligned} \\left(2^{2n}-1,2^k-1\\right)=\\left(2^n-1,2^k-1\\right)&=2^{(n,k)}-1\\\\\n\\left(2^n+1,2^k-1\\right)&=1\n\\end{aligned}\n$$\n\n\u6761\u4ef6\u8f6c\u5316\u4e3a\n\n$$\n\\left(2^n+1\\right)\\mid t\n$$\n\n\u7531\u4e8e $1\\le t\\le 2^n$\uff0c\u663e\u7136\u6709 $B_k=0$\u3002\n\n### $\\frac k{(n,k)}$ \u4e3a\u5076\u6570\n\n\u90a3\u4e48 $(k,2n)=2(k,n)$\uff0c\u5219\u6709\n\n$$\n\\begin{aligned}\n\\left(2^{2n}-1,2^k-1\\right)&=2^{2(n,k)}-1\\\\\n\\left(2^n-1,2^k-1\\right)&=2^{(n,k)}-1\\\\\n\\left(2^n+1,2^k-1\\right)&=2^{(n,k)}+1\n\\end{aligned}\n$$\n\n\u6761\u4ef6\u8f6c\u5316\u4e3a\n\n$$\n\\frac{2^n+1}{2^{(n,k)}+1}\\mid t\n$$\n\n\u7531\u4e8e $1\\le t\\le 2^n$\uff0c\u5219 $B_k=2^{(n,k)}$\u3002\n\n---\n\n\u603b\u7ed3\u4e00\u4e0b\n\n$$\nB_k=\n\\begin{cases}\n2^{(n,k)},&2\\mid\\frac k{(n,k)}\\\\\n0,&\\text{otherwise.}\n\\end{cases}\n$$\n\n\u8bb0 $n=2^qp$\uff08$p$ \u4e3a\u5947\u6570\uff09\uff0c\u90a3\u4e48\n\n$$\n2\\mid\\frac k{(n,k)}\\iff 2^{q+1}\\mid k\n$$\n\n\u5957\u7528\u53cd\u6f14\u53ef\u5f97\n\n$$\nA_k=\\sum_{d|k}\\mu(d)B_{k/d}\n$$\n\n\u6211\u4eec\u8003\u8651\u5230\u539f\u9898\u8981\u6c42\u7684 $P^0,P^1,P^2,\\dots,P^{n-1}$ \u7684\u4e0d\u52a8\u70b9\u4e2a\u6570\u4e4b\u548c\u4f3c\u4e4e\u5e76\u4e0d\u662f\u975e\u5e38\u7684 canonical\uff1a\u6700\u957f\u7684\u73af\u6709 $2n$ \u957f\u600e\u4e48\u53ea\u6c42\u524d $n$ \u4e2a\uff1f\u6211\u4eec\u4e0d\u59a8\u5148\u6c42\u51fa $P^0,P^1,P^2,\\dots,P^{2n-1}$ \u7684\u4e0d\u52a8\u70b9\u4e2a\u6570\u4e4b\u548c\uff0c\u8bb0\u4e4b\u4e3a $g(n)$\u3002\n\n\u9996\u5148\u6211\u4eec\u89c2\u5bdf\u5230\u73af\u957f\u5fc5\u987b\u5f97\u662f $(2n)$ \u7684\u7ea6\u6570\u3002\u7531\u4e8e\u4e00\u4e2a\u957f\u5ea6\u4e3a $w$ \u7684\u73af\u5bf9 $f(n)$ \u7684\u8d21\u732e\u4e3a $\\left(\\frac{2n}w\\right)$\uff0c\u5bf9 $g(n)$ \u7684\u8d21\u732e\u4e3a \n\n$$\n\\left\\lfloor\\frac nw\\right\\rfloor=\\frac12\\left(1+\\frac{2n}w\\right)\n$$\n\n\u4e8e\u662f\u5c31\u6709 $f(n)=\\frac12\\left(g(n)+2^n\\right)$\u3002\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa $g(n)$ \u5373\u53ef\u3002\n\n\u6574\u7406\u5f0f\u5b50\u4e4b\u524d\u73b0\u6709\u4e00\u4e2a\u5c0f\u5b9a\u7406\uff1a\n\n> \u5b9a\u7406\u4e09\uff1a\n>\n$$\n\\sum_{k=1}^n\\mu(k)\\left\\lfloor\\frac nk\\right\\rfloor=1\n$$\n\n\u8bc1\u660e\uff1a\n\n$$\n\\begin{aligned}\n&\\sum_{k=1}^n\\mu(k)\\left\\lfloor\\frac nk\\right\\rfloor\\\\\n=&\\sum_{k=1}^n\\mu(k)\\sum_{k|d,d\\le n}1\\\\\n=&\\sum_{d=1}^n\\sum_{k|d}\\mu(k)\\\\\n=&\\sum_{d=1}^n\\left[d=1\\right]\\\\\n=&1\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u5f00\u59cb\u6574\u7406\u5f0f\u5b50\uff1a\n\n$$\n\\begin{aligned}\ng(n)&=\\sum_{k=1}^{2n}\\left\\lfloor\\frac{2n}k\\right\\rfloor\\sum_{d|k}\\mu(d)B_{k/d}\\\\\n&=\\sum_{k=1}^p\\left\\lfloor\\frac pk\\right\\rfloor\\sum_{d|2Qk}\\mu(d)B_{2Qk/d}\\\\\n&=\\sum_{k=1}^p\\left\\lfloor\\frac pk\\right\\rfloor\\sum_{d|k}\\mu\\left(\\frac kd\\right)2^{Q(d,p)}\\\\\n&=\\sum_{g|p}2^{Qg}\\sum_{k=1}^{\\frac pg}\\left\\lfloor\\frac p{kg}\\right\\rfloor\\sum_{d|k}\\mu\\left(\\frac kd\\right)\\sum_{t|d,t|\\frac pg}\\mu(t)\\\\\n&=\\sum_{g|p}2^{Qg}\\sum_{t|\\frac pg}\\mu(t)\\sum_{d=1}^{\\frac p{gt}}\\sum_{k=1}^{\\left\\lfloor\\frac p{gtd}\\right\\rfloor}\\left\\lfloor\\frac p{kgtd}\\right\\rfloor\\mu(k)\\\\\n&=\\sum_{g|p}2^{Qg}\\sum_{t|\\frac pg}\\mu(t)\\sum_{d=1}^{\\frac p{gt}}1\\\\\n&=\\sum_{g|p}2^{Qg}\\sum_{t|\\frac pg}\\mu(t)\\frac p{gt}\\\\\n&=\\sum_{g|p}2^{Qg}\\phi\\left(\\frac pg\\right)\\\\\n&=\\sum_{g|p}2^{n/g}\\phi(g)\\\\\n&=\\sum_{g|n,g\\text{ is odd}}2^{n/g}\\phi(g)\n\\end{aligned}\n$$\n\n\u55ef\uff0c\u4e8e\u662f\u6211\u4eec\u62ff\u5230\u4e86 45 \u5206\u3002\n\n## Subtask 3\n\n\u6211\u4eec\u8003\u8651\u6c42 $g(n)$ \u7684\u524d\u7f00\u548c $G(n)$\uff0c\u518d\u968f\u4fbf\u64cd\u4f5c\u4e0b\u5c31\u80fd\u6c42\u5230 $f(n)$ \u7684\u524d\u7f00\u548c $F(n)$ \u4e86\u3002\n\n$$\n\\begin{aligned}\nG(N)&=\\sum_{n=1}^N\\sum_{g|n,g\\text{ is odd}}2^{n/g}\\phi(g)\\\\\n&=\\sum_{d=1}2^d\\sum_{g=1}^{\\left\\lfloor\\frac Nd\\right\\rfloor}\\left[g\\text{ is odd}\\right]\\phi(g)\n\\end{aligned}\n$$\n\n\u6211\u4eec\u8bb0\n\n$$\nS(n)=\\sum_{k=1}^n\\left[k\\text{ is odd}\\right]\\phi(k)\n$$\n\n\u90a3\u4e48 $G(N)=\\sum_{d=1}2^dS\\left(\\left\\lfloor\\frac Nd\\right\\rfloor\\right)$\u3002\u9884\u5904\u7406\u597d $10^6$ \u4e4b\u5185\u7684 $S(n)$\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u8ba1\u7b97\u5566\uff5e\n\n## Subtask 4\n\n\u6211\u4eec\u6765\u89c2\u5bdf\u8fd9\u4e2a $S(n)$\u3002\u9996\u5148\u6211\u4eec\u6ce8\u610f\u5230\n\n$$\n\\phi(2n)=\n\\begin{cases}\n\\phi(n),&n\\text{ is odd}\\\\\n2\\phi(n),&\\text{otherwise.}\n\\end{cases}\n$$\n\n\u90a3\u4e48\u6211\u4eec\u8bbe $H(n)=\\sum_{k=1}^n\\phi(k)$\uff0c\u5219\u6709\n\n$$\n\\begin{aligned}\nS(n)&=\\sum_{k=1}^n\\left[k\\text{ is odd}\\right]\\phi(k)\\\\\n&=H(n)-\\sum_{k=1}^n\\left[k\\text{ is even}\\right]\\phi(k)\\\\\n&=H(n)-\\sum_{k=1}^{\\left\\lfloor\\frac n2\\right\\rfloor}\\left[k\\text{ is even}\\right]\\phi(2k)-\\sum_{k=1}^{\\left\\lfloor\\frac n2\\right\\rfloor}\\left[k\\text{ is odd}\\right]\\phi(2k)\\\\\n&=H(n)-2\\sum_{k=1}^{\\left\\lfloor\\frac n2\\right\\rfloor}\\left[k\\text{ is even}\\right]\\phi(k)-\\sum_{k=1}^{\\left\\lfloor\\frac n2\\right\\rfloor}\\left[k\\text{ is odd}\\right]\\phi(k)\\\\\n&=H(n)-2\\left(H\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)-S\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)\\right)-S\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)\\\\\n&=H(n)-2H\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)+S\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)\\\\\n&=H(n)-2H\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)+H\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)-2H\\left(\\left\\lfloor\\frac n4\\right\\rfloor\\right)+\\cdots\\\\\n&=H(n)-H\\left(\\left\\lfloor\\frac n2\\right\\rfloor\\right)-H\\left(\\left\\lfloor\\frac n4\\right\\rfloor\\right)-H\\left(\\left\\lfloor\\frac n8\\right\\rfloor\\right)-\\cdots\n\\end{aligned}\n$$\n\n\u90a3\u4e48\u7528\u675c\u6559\u7b5b\u8ba1\u7b97 $H(n)$ \u5373\u53ef\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u8ba1\u7b97\u5355\u4e2a $S(n)$ \u4f1a\u9700\u8981\u8ba1\u7b97 $\\log n$ \u6b21 $H(n)$\uff0c\u52a0\u4e4b\u6211\u4eec\u9700\u8981\u7b97 $\\sqrt N$ \u4e2a\u4e0d\u540c\u4f4d\u7f6e\u7684 $S(n)$\uff0c\u770b\u4f3c\u65f6\u95f4\u590d\u6742\u5ea6\u7206\u8868\uff0c\u5b9e\u5219\u4e0d\u7136\u3002\n\n\u8bb0 $D(n)=\\left\\{n,\\left\\lfloor\\frac n2\\right\\rfloor,\\left\\lfloor\\frac n3\\right\\rfloor,\\left\\lfloor\\frac n4\\right\\rfloor,\\cdots\\right\\}$\uff08\u4e0d\u8981\u7ed9\u6211\u4ee5\u521d\u4e2d\u8001\u5e08\u7684\u53e3\u543b\u8bf4\u96c6\u5408\u4e0d\u53ef\u91cd\u2026 \u81ea\u52a8\u53bb\u91cd\uff0c\u554a\uff0c\u81ea\u52a8\u53bb\u91cd\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u77e5\u9053\u675c\u6559\u7b5b\u5728\u8ba1\u7b97 $H(n)$ \u65f6\u5b9e\u9645\u4e0a\u662f\u5bf9 $D(n)$ \u4e2d\u7684\u6240\u6709\u6570\u90fd\u8ba1\u7b97\u4e86\u4e00\u904d $H(n)$ \u5e76\u5b58\u5165\u4e86\u7f13\u5b58\u3002\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u7531\u4e8e\u6211\u4eec\u6c42\u7684 $G(N)=\\sum_{d=1}2^dS\\left(\\left\\lfloor\\frac Nd\\right\\rfloor\\right)$\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u6c42\u7684 $S(x)$ \u662f\u6ee1\u8db3 $x\\in D(N)$ \u7684\uff0c\u800c\u6839\u636e\uff1a\n\n> \u5b9a\u7406\u56db\uff1a$\\left\\lfloor\\frac{\\left\\lfloor\\frac np\\right\\rfloor}q\\right\\rfloor=\\left\\lfloor\\frac n{pq}\\right\\rfloor$\n\n\u6211\u4eec\u77e5\u9053\u6211\u4eec\u5728\u6c42 $S(x)$ \u65f6\uff0c\u9700\u8981\u6c42\u7684 $H(x),H\\left(\\left\\lfloor\\frac x2\\right\\rfloor\\right),H\\left(\\left\\lfloor\\frac x3\\right\\rfloor\\right),\\dots$ \u8fd9\u4e9b\u4e1c\u897f\u5b9e\u9645\u4e0a\u4e5f\u662f\u5728 $D(N)$ \u4e2d\uff0c\u4e5f\u5c31\u662f\u88ab\u8ba1\u7b97\u5e76\u7f13\u5b58\u8fc7\u7684\u3002\u56e0\u6b64\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4f9d\u65e7\u7b49\u540c\u4e8e\u505a\u4e00\u6b21\u675c\u6559\u7b5b\u7684\u590d\u6742\u5ea6\uff08\u5f53\u7136\u662f\u8ba1\u7b97 $H(n)$ \u7684\u90e8\u5206\uff0c\u5176\u5b83\u5730\u65b9\u4e0d\u4e00\u5b9a\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u603b\u590d\u6742\u5ea6\uff09\uff0c\u4e5f\u5c31\u662f $O(N^{2/3})$\uff08\u5982\u679c\u9884\u5904\u7406\u524d $N^{2/3}$ \u4e2a $H(n)$ \u7684\u8bdd\uff09\u3002\n\n[ametus.h](https://pastebin.com/U0qK4eJb) / [dream.cpp](https://pastebin.com/z0uv8W3G)",
        "postTime": 1643858518,
        "uid": 45182,
        "name": "Mivik",
        "ccfLevel": 9,
        "title": "[Mivik Round / \u68a6\u5883\u5f7c\u5cb8] [\u9898\u89e3] \u5f7c\u5cb8 The Next Part of the Dream"
    },
    {
        "content": "\u6709\u8da3\u7684\u6570\u5b66\u9898\uff08\n\n\u9996\u5148 $S_q$ \u662f $S_1$ \u7684 $q$ \u6b21\u8fed\u4ee3\uff0c\u800c\u5c06\u6240\u6709\u6570\u51cf\u53bb $1$ \u540e\u8868\u793a\u6210 $n$ \u4f4d\u4e8c\u8fdb\u5236\u6570\uff0c$S_1$ \u64cd\u4f5c\u76f8\u5f53\u4e8e\u5c06\u672b\u4f4d\u53d6\u53cd\u540e\u79fb\u5230\u9996\u4f4d\u3002\u56e0\u6b64\u6211\u4eec\u5bb9\u6613\u60f3\u5230\u5b83\u7684\u7b49\u4ef7\u5f62\u5f0f\uff1a\u5c06\u6574\u4e2a\u6570\u53d6\u53cd\u62fc\u5728\u539f\u6570\u524d\u9762\u5f62\u6210 $2n$ \u4f4d 01 \u4e32\uff0c\u6bcf\u6b21\u5faa\u73af\u53f3\u79fb $1$ \u4f4d\u540e\u53d6\u672b $n$ \u4f4d\u5373\u53ef\u3002\n\n\u7531\u4e8e\u5faa\u73af\u79fb\u4f4d\u65f6\u524d $n$ \u4f4d\u548c\u672b $n$ \u4f4d\u59cb\u7ec8\u4e92\u4e3a\u53d6\u53cd\uff0c\u56e0\u6b64 $(S_q)_ k=k$ \u65f6\u6574\u4e2a $2n$ \u4f4d 01 \u4e32\u548c\u521d\u59cb\u65f6\u5b8c\u5168\u76f8\u540c\u3002\u56e0\u6b64\u6b64 $2n$ \u4f4d 01 \u4e32\u4ee5 $q$ \u4e3a\u5468\u671f\u3002\n\n\u53d6 $k$ \u5bf9\u5e94\u7684 01 \u4e32\u7684\u6700\u5c0f\u6b63\u5468\u671f $t$\uff0c\u5219\u663e\u7136 $t \\mid 2n$\uff0c\u4e14\u5f53\u4e14\u4ec5\u5f53 $q$ \u4e3a $t$ \u7684\u500d\u6570\u65f6\u6709 $(S_q)_ k=k$\u3002\u800c\u7531\u4e8e $k$ \u79fb $n$ \u4f4d\u540e\u4e3a\u5176\u53d6\u53cd\uff0c\u663e\u7136\u4e0e $k$ \u4e0d\u540c\uff0c\u56e0\u6b64 $t \\nmid n$\u3002\u6545 $\\dfrac{2n}{t}$ \u4e3a\u5947\u6570\uff0c\u8bbe\u5176\u4e3a $s$\u3002\n\n\u6211\u4eec\u8003\u8651\u6c42\u4f7f\u5f97 $t=2n$ \u7684 $k$ \u7684\u6570\u91cf $g(n)$\uff0c\u5219\u53ef\u4ee5\u5bf9 $n$ \u4f4d\u6570 $k$ \u6309 $t$ \u7684\u503c\u5206\u7c7b\uff0c$t<2n$ \u8005\u5747\u53ef\u4ee5\u5bf9\u5e94\u4e00\u4e2a $\\dfrac{t}{2}=\\dfrac{n}{s}$ \u4f4d\u6570 $k'$\u3002\u56e0\u6b64\u6709\u5f0f\u5b50\uff1a\n\n$$\\sum_{s \\mid n,2 \\nmid s}g\\left(\\dfrac{n}{s}\\right)=2^n.$$\n\n~~\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u63a8\u5f0f\u5b50\u3002~~ \u63a8\u4ec0\u4e48\u5f0f\u5b50\uff0c\u624b\u7b97\u51e0\u9879\u6254 [oeis](http://oeis.org/A045663) \u5c31\u884c\u4e86\u3002\n\n\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a formula:\n\n$$g(n)=\\sum_{d \\mid n,2 \\nmid d}\\mu(d)2^{\\frac{n}{d}}.$$\n\n\u4e8b\u5b9e\u4e0a\u770b\u5230\u8fd9\u4e2a\u5f0f\u5b50\u6211\u4eec\u4f1a\u53d1\u73b0\u5b83\u5f88\u5bb9\u6613\u63a8\u5bfc\uff0c\u662f\u4e00\u4e2a\u663e\u7136\u7684\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u5f62\u5f0f\uff0c\u5bb9\u6613\u7528\u548c\u63a8\u5bfc\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u516c\u5f0f\u7c7b\u4f3c\u7684\u65b9\u6cd5\u5f97\u5230\n\n$$\\begin{aligned}\n\\sum_{d \\mid n,2 \\nmid d}\\mu(d)2^{\\frac{n}{d}}&=\\sum_{d \\mid n,2 \\nmid d}\\mu(d)\\sum_{s\\mid\\frac{n}{d},2 \\nmid s}g\\left(\\dfrac{n}{ds}\\right)\\\\\n&=\\sum_{S \\mid n,2 \\nmid S}g\\left(\\dfrac{n}{S}\\right)\\sum_{d|S}\\mu(d)=g(n).\n\\end{aligned}$$\n\n\u5176\u4e2d\u7b2c\u4e8c\u884c\u7528 $S$ \u4ee3\u66ff\u4e86\u7b2c\u4e00\u884c\u4e2d\u7684 $ds$\uff0c\u7531\u4e8e $S$ \u662f\u5947\u6570\uff0c\u56e0\u6b64 $d \\mid S$ \u5373\u8574\u542b\u4e86 $2 \\nmid d$\u3002\u63a5\u7740\u6211\u4eec\u8003\u8651\u8f6c\u5316\u9898\u76ee\u4e2d\u6240\u7ed9\u51fa\u7684\u5f0f\u5b50\u3002\n\n$$\\begin{aligned}\nf(n)&=\\sum_{q=0}^{n-1}\\sum_{k=1}^{2^n}[S_q([1,2,3,\\dots,2^n])_ k=k]\\\\\n&=\\sum_{s \\mid n,2 \\nmid s}\\dfrac{s+1}{2}g\\left(\\dfrac{n}{s}\\right)\\\\\n&=\\dfrac{1}{2}\\sum_{s \\mid n,2 \\nmid s}(s+1)\\sum_{d \\mid \\frac{n}{s},2 \\nmid d}\\mu(d)2^{\\frac{n}{ds}}\\\\\n&=\\dfrac{1}{2}\\sum_{S \\mid n,2 \\nmid s}2^{\\frac{n}{S}}\\sum_{s \\mid S}(s+1)\\mu\\left(\\dfrac{S}{s}\\right)\\\\\n&=\\dfrac{1}{2}\\sum_{S \\mid n,2 \\nmid s}2^{\\frac{n}{S}}(\\varphi(S)+[S=1]),\n\\end{aligned}$$\n\n\u56e0\u6b64\n\n$$\\begin{aligned}\nAns=\\sum_{n=l}^{r}f(n)&=\\dfrac{1}{2}\\sum_{n=l}^{r}\\sum_{S \\mid n,2 \\nmid S}2^{\\frac{n}{S}}(\\varphi(S)+[S=1])\\\\\n&=\\dfrac{1}{2}\\sum_{2 \\nmid S}(\\varphi(S)+[S=1])\\sum_{n=l}^{r}[S \\mid n]2^{\\frac{n}{S}}\\\\\n&=\\dfrac{1}{2}\\sum_{2 \\nmid S}(\\varphi(S)+[S=1])\\sum_{n=\\left\\lceil\\frac{l}{S}\\right\\rceil}^{\\left\\lfloor\\frac{r}{S}\\right\\rfloor}2^n.\n\\end{aligned}$$\n\n\u6211\u4eec\u8bb0\n\n$$\\begin{aligned}\nG(n)&=\\dfrac{1}{2}\\sum_{2 \\nmid S}(\\varphi(S)+[S=1])\\sum_{i=1}^{\\left\\lfloor\\frac{n}{S}\\right\\rfloor}2^i\\\\\n&=2^n-1+\\sum_{d}2^{d-1}\\sum_{1 \\le S \\le \\left\\lfloor\\frac{n}{d}\\right\\rfloor,2 \\nmid S}\\varphi(S).\n\\end{aligned}$$\n\n\u5219 $Ans=G(r)-G(l-1)$\u3002\u8bb0\n\n$$F(n)=\\sum_{1 \\le S \\le n,2 \\nmid S}\\varphi(S),$$\n\n\u5219\u53ef\u4ee5\u7528\u675c\u6559\u7b5b\u52a0\u500d\u589e\u8ba1\u7b97\u3002\u603b\u590d\u6742\u5ea6\u5728[\u51fa\u9898\u4eba\u795e Mivik \u7684\u9898\u89e3](https://mivik.blog.luogu.org/mivik-round-4-solution-dream)\u91cc\u5206\u6790\u5f97\u4e3a $O(n^{\\frac{2}{3}})$\uff08\u611f\u89c9\u8fd9\u4e00\u90e8\u5206\u975e\u5e38\u795e\u4ed9\uff09\uff0c\u6211\u5c31\u4e0d\u505a\u8d58\u8ff0\u4e86\u3002\n\n~~\u7136\u800c\u9000\u5f79\u9009\u624b\u9646\u7eed\u72af\u4e86\u5fd8\u5220\u8c03\u8bd5\uff0c\u5fd8\u5f00 ll\uff0c\u8ba1\u7b97\u7206 ll \u7b49\u591a\u79cd sb \u9519\u8bef\u671f\u95f4\u751a\u81f3\u8ba4\u4e3a\u590d\u6742\u5ea6\u5047\u4e86\uff0c\u5927\u5bb6\u5f15\u4ee5\u4e3a\u6212\uff08~~\n\nCode:\n```cpp\n#include<cctype>\n#include<cstdio>\n#include<cstring>\n#define rg register\n#define ll unsigned long long\nconst int ntf=998244353;\nconst int inv2=499122177;\nconst int N=1e7;int pr[N+7],cnt;\nint mp[N+7];ll Sphi[N+7];\ninline void init(){\n\tSphi[1]=1;for(rg int i=2;i<=N;++i){\n\t\tif(!mp[i])mp[i]=i,Sphi[i]=i-1,pr[++cnt]=i;\n\t\tfor(rg int j=1,k=i<<1;j<=cnt&&k<=N;++j,k=i*pr[j]){\n\t\t\tmp[k]=pr[j];if(mp[i]==pr[j]){\n\t\t\t\tSphi[k]=Sphi[i]*pr[j];break;\n\t\t\t}Sphi[k]=Sphi[i]*(pr[j]-1);\n\t\t}Sphi[i]=(Sphi[i]+Sphi[i-1])%ntf;\n\t}\n}ll sphi[1007],mxn;\ninline ll GetSphi(ll n){\n\tif(n<=N)return Sphi[n];\n\tif(~sphi[mxn/n])return sphi[mxn/n];\n\tll res=n%ntf*(n+1)%ntf*inv2%ntf;\n\tfor(rg ll i=2,j;i<=n;i=j+1){j=n/(n/i);\n\t\tres=(res-(j-i+1)*GetSphi(n/i)%ntf+ntf)%ntf;\n\t}return sphi[mxn/n]=res;\n}inline ll GetF(ll n){\n\tif(!n)return 0;\n\tll res=GetSphi(n);\n\tfor(rg ll i=n>>1;i;i>>=1){\n\t\tres=(res-GetSphi(i)+ntf)%ntf;\n\t}return res;\n}inline ll qpw(ll v){\n\tll r=1,x=2;v%=(ntf-1);while(v){\n\t\t(v&1)&&(r=r*x%ntf);x=x*x%ntf,v>>=1;\n\t}return r;\n}inline ll solve(ll n){ll res=0,ls=1,nw;\n\tmxn=n,memset(sphi,-1,sizeof(sphi));\n\tfor(rg ll i=1,j;i<=n;i=j+1,ls=nw){\n\t\tj=n/(n/i);res=(res+GetF(n/i)*\\\n\t\t((nw=qpw(j))-ls+ntf)%ntf)%ntf;\n\t}return res;\n}ll l,r,ans;int main(){init();\n\tscanf(\" %llu %llu\",&l,&r),--l;\n\tans=(solve(r)-solve(l)+qpw(r)-qpw(l)+ntf+ntf)%ntf;\n\treturn 0&printf(\"%llu\\n\",ans);\n}\n```",
        "postTime": 1644733007,
        "uid": 59388,
        "name": "VinstaG173",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P8151 \u3010\u5f7c\u5cb8 | To See the Next Part of the Dream\u3011"
    },
    {
        "content": "\u7ed9\u4e2a\u65e0\u8111\u63a8\u5f0f\u5b50\u505a\u6cd5\u3002\n\n---\n\n> \u8bbe\u957f $2^n$ \u7684\u6392\u5217\u7684 in-shuffle \u7684\u7f6e\u6362\u4e3a $\\sigma_n$\uff0c\u6c42\n> $$\\sum_{n=l}^{r}\\sum_{i=0}^{n-1}\\operatorname{fix}\\left(\\sigma_n^i\\right).$$\n>\n> \u5176\u4e2d $\\operatorname{fix}(\\sigma)$ \u8868\u793a\u6392\u5217 $\\sigma$ \u7684\u4e0d\u52a8\u70b9\u6570\u76ee\u3002$l\\le r\\le10^{10}$\u3002\n\n\u5206\u522b\u5bf9 $N=r$ \u548c $N=l-1$ \u6c42\n$$\\sum_{n=1}^{N}\\sum_{i=0}^{n-1}\\operatorname{fix}\\left(\\sigma_n^i\\right).$$\n\u4f5c\u5dee\u540e\u5f97\u5230\u7b54\u6848\u3002\n\n\u6ce8\u610f\u5230 $\\sigma_n(t)=2t\\bmod\\left(2^n+1\\right)$\uff0c\u4e8e\u662f\n$$\n\\begin{aligned}\n\\sum_{n=1}^{N}\\sum_{i=0}^{n-1}\\operatorname{fix}\\left(\\sigma_n^i\\right)&=\\sum_{n=1}^{N}\\sum_{i=0}^{n-1}\\sum_{t=1}^{2^n}\\left[2^it\\equiv t\\pmod{2^n+1}\\right]\\\\\n&=\\sum_{n=1}^{N}\\sum_{i=0}^{n-1}\\sum_{t=1}^{2^n}\\left[\\left(2^i-1\\right)t\\equiv 0\\pmod{2^n+1}\\right]\\\\\n&=\\sum_{n=1}^{N}\\sum_{i=0}^{n-1}\\sum_{t=1}^{2^n}\\left[t\\mid\\frac{2^n+1}{\\left(2^n+1,2^i-1\\right)}\\right]\\\\\n&=\\sum_{n=1}^{N}\\sum_{i=0}^{n-1}\\left\\lfloor\\frac{2^n\\left(2^n+1,2^i-1\\right)}{2^n+1}\\right\\rfloor\\\\\n&=\\sum_{n=1}^{N}\\left(2^n+\\sum_{i=1}^{n-1}\\left\\lfloor\\frac{2^n\\left(2^n+1,2^i-1\\right)}{2^n+1}\\right\\rfloor\\right)\\\\\n&=\\sum_{n=1}^{N}\\left(2^n+\\sum_{i=1}^{n-1}\\left(\\left(2^n+1,2^i-1\\right)-1\\right)\\right)\\\\\n&=\\sum_{n=1}^{N}\\left(2^n+\\sum_{i=1}^{n-1}\\left(\\left(2^n+1,2^n-2^{n-i}\\right)-1\\right)\\right)\\\\\n&=\\sum_{n=1}^{N}\\left(2^n+\\sum_{i=1}^{n-1}\\left(\\left(2^n+1,2^{n-i}+1\\right)-1\\right)\\right)\\\\\n&=\\sum_{n=1}^{N}\\left(2^n+\\sum_{i=1}^{n-1}\\left(\\left(2^n+1,2^i+1\\right)-1\\right)\\right)\\\\\n&=\\sum_{i=1}^{N}\\sum_{j=1}^i\\left(\\left(2^i+1,2^j+1\\right)-1\\right)\\\\\n&=\\sum_{i=1}^{N}\\sum_{j=1}^i2^{(i,j)}\\left[2\\nmid\\frac{ij}{(i,j)^2}\\right]\\\\\n&=\\sum_{d=1}^N2^d\\sum_{k=1}^{\\lfloor N/d\\rfloor}\\mu(k)\\sum_{i=1}^{\\lfloor N/dk\\rfloor}\\sum_{j=1}^i\\left[2\\nmid ijk^2\\right]\\\\\n&=\\sum_{d=1}^N2^d\\sum_{k=1}^{\\lfloor N/d\\rfloor}\\mu(k)[2\\nmid k]f\\left(\\left\\lfloor\\frac{N}{dk}\\right\\rfloor\\right)\\\\\n&=\\sum_{d=1}^N2^dg\\left(\\left\\lfloor\\frac{N}{d}\\right\\rfloor\\right).\n\\end{aligned}\n$$\n\n\u5176\u4e2d\n\n$$\n\\begin{gathered}\ng(n)=\\sum_{k=1}^n\\mu(k)[2\\nmid k]f\\left(\\left\\lfloor\\frac nk\\right\\rfloor\\right),\\\\\nf(n)=\\sum_{i=1}^{n}\\sum_{j=1}^i\\left[2\\nmid ij\\right]=\\frac{\\lfloor(n+1)/2\\rfloor\\lfloor(n+3)/2\\rfloor}2.\n\\end{gathered}\n$$\n\n\u4e0a\u8ff0\u63a8\u5bfc\u7528\u5230\n\n>  **\u5b9a\u7406**\uff1a$\\forall i,j\\in\\mathbb N^+$ \u6709\n>\n>  $$\\left(2^i+1,2^j+1\\right)=1+2^{(i,j)}\\left[2\\nmid\\frac{ij}{(i,j)^2}\\right].$$\n\n\u5176\u8bc1\u660e\u5728\u6587\u7ae0\u672b\u5c3e\u3002\n\n\u6574\u9664\u5206\u5757\u8ba1\u7b97\u6700\u7ec8\u7b54\u6848\u3002\u5bf9\u4e8e $g$ \u7684\u8ba1\u7b97\u53ef\u4ee5\u8bbe\u9608\u503c $T$\uff0c\u5bf9 $n\\le T$ \u9884\u5904\u7406 $g(n)$\uff0c$n>T$ \u65f6\u6574\u9664\u5206\u5757\u3002\u5c0f\u8303\u56f4\u7684\u8ba1\u7b97\u76f4\u63a5\u65e0\u8111\u72c4\u5229\u514b\u96f7\u5dee\u5206\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(T\\log\\log T)$\uff1b\u5927\u8303\u56f4\u7684\u8ba1\u7b97\u9700\u8981\u7528\u5230 $\\mu(k)[2\\nmid k]$ \u7684\u5757\u7b5b\uff0c\u65e0\u8111\u675c\u6559\u7b5b\uff1a\n$$\n\\sum_{k|n}\\mu(k)[2\\nmid k]=[n\\text{ is a power of }2].\n$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\n$$\nO\\left(T\\log\\log T+\\sum_{d=1}^{\\lfloor N/T\\rfloor}\\sqrt{\\frac Nd}\\right)=O\\left(T\\log\\log T+\\frac{N}{\\sqrt T}\\right).\n$$\n\n\u53d6 $T=\\sqrt[3]{\\left(N/\\log\\log N\\right)^2}$ \u6709\u6700\u4f18\u65f6\u95f4\u590d\u6742\u5ea6 $O\\left(\\sqrt[3]{N^2\\log\\log N}\\right)$\u3002\u6709\u4e86\u8fd9\u4e2a\u9608\u503c\u540e\u53ef\u4ee5\u5bf9\u675c\u6559\u7b5b\u7684\u9608\u503c\u7a0d\u4f5c\u4fee\u6539\u505a\u5230\u7a7a\u95f4\u590d\u6742\u5ea6 $O\\left(\\sqrt[3]{\\left(N/\\log\\log N\\right)^2}\\right)$\u3002\n\n---\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5e94\u8be5\u80fd\u8fdb\u4e00\u6b65\u964d\u5230 $O\\left(N^{2/3}\\right)$\uff0c\u4f46\u8111\u5b50\u88ab\u50f5\u5c38\u5403\u4e86\uff0c\u6240\u4ee5\u53ea\u4f1a\u65e0\u8111\u505a\u6cd5\u3002\n\n---\n\n>  **\u5b9a\u7406\u8bc1\u660e**\uff1a\u6b32\u6c42 $\\left(2^i+1,2^j+1\\right)$\u3002\u82e5 $i=j$\uff0c\u5219\u503c\u4e3a $2^i+1$\u3002\u5426\u5219\u4e0d\u59a8\u5047\u8bbe $i>j$\u3002\u5219\n>  $$\\begin{aligned}\\left(2^i+1,2^j+1\\right)&=\\left(\\left(2^i+1\\right)-2^{i-j}\\left(2^j+1\\right),2^j+1\\right)\\\\&=\\left(1-2^{i-j},2^j+1\\right)\\\\&=\\left(2^{i-j}-1,2^j+1\\right).\\end{aligned}$$\n>\n>  \u6b32\u6c42 $\\left(2^i+1,2^j-1\\right)$\u3002\u82e5 $i=j$\uff0c\u5219\u503c\u4e3a $1$\u3002\u82e5 $i>j$\uff0c\u5219\n>  $$\\begin{aligned}\\left(2^i+1,2^j+1\\right)&=\\left(\\left(2^i+1\\right)-2^{i-j}\\left(2^j-1\\right),2^j-1\\right)\\\\&=\\left(2^{i-j}+1,2^j-1\\right).\\end{aligned}$$\n>  \u82e5 $i<j$\uff0c\u5219\n>  $$\\begin{aligned}\\left(2^i+1,2^j-1\\right)&=\\left(2^i+1,\\left(2^j-1\\right)-2^{j-i}\\left(2^i+1\\right)\\right)\\\\&=\\left(2^i+1,-1-2^{j-i}\\right)\\\\&=\\left(2^i+1,2^{j-i}+1\\right).\\end{aligned}$$\n>\n>  \u5bb9\u6613\u53d1\u73b0\u8fd9\u4e2a\u8fc7\u7a0b\u5728\u6307\u6570\u4e0a\u662f\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u3002\u4e8e\u662f\u6c42 $\\left(2^i+1,2^j+1\\right)$ \u6700\u7ec8\u4e00\u5b9a\u4f1a\u9012\u5f52\u5230 $2^{(i,j)}+1$ \u4e0e $2^{(i,j)}\\pm1$ \u65f6\u505c\u6b62\uff0c\u6545\u8be5\u503c\u4e00\u5b9a\u662f $2^{(i,j)}+1$ \u6216 $1$\u3002\n>\n>  \u786e\u5b9a\u503c\u5230\u5e95\u662f\u591a\u5c11\u53ea\u9700\u8981\u6267\u884c\u4e0a\u8ff0\u8fc7\u7a0b\u6c42 $\\left(2^{(i,j)}+1,2^i+1\\right)$ \u4e0e $\\left(2^{(i,j)}+1,2^j+1\\right)$ \u5373\u53ef\u3002\u4e0d\u96be\u53d1\u73b0\n>  $$\\left(2^{(i,j)}+1,2^i+1\\right)=2^{(i,j)}+1\\iff2\\nmid\\frac{i}{(i,j)}.$$\n>\n>  \u56e0\u6b64\n>  $$\\left(2^i+1,2^j+1\\right)=2^{(i,j)}+1\\iff2\\nmid\\frac{i}{(i,j)},2\\nmid\\frac{i}{(i,j)}.$$\n>\n>  \u4ece\u800c\u5b9a\u7406\u5f97\u8bc1\u3002",
        "postTime": 1644678646,
        "uid": 55251,
        "name": "Daniel13265",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P8151 \u3010\u5f7c\u5cb8 | To See the Next Part of the Dream\u3011"
    },
    {
        "content": "[P8151 \u5f7c\u5cb8 | To See the Next Part of the Dream](https://www.luogu.com.cn/problem/P8151) \u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/xiaoziyao/p/15888171.html)\n\n**\u4e0b\u6587\u79f0\u5947\u6570\u96c6\u5408\u4e3a $\\mathbb{O}$\u3002**\n\n\n## \u9898\u610f\n\n\u5bf9\u4e8e\u4e00\u4e2a\u957f\u5ea6\u4e3a $2^n$ \u7684\u6392\u5217 $1,2,\\cdots,2^n$\uff0c\u4ee4\u7f6e\u6362 $P$ \u4e3a $x\\mapsto 2x\\pmod{2^n+1}$\uff0c\u4ee4 $f(n)$ \u4e3a $P^0,P^1,\\cdots,P^{n-1}$ \u7684\u4e0d\u52a8\u70b9\u6570\u91cf\u4e4b\u548c\uff0c\u6c42 $f$ \u7684\u524d\u7f00\u548c\u3002\n\n$1\\leqslant n\\leqslant 10^{10}$\n\n## \u5206\u6790\n\n\u601d\u8def\u66f2\u6298\u590d\u6742\uff0c\u9700\u8981\u4e00\u5b9a\u7684\u719f\u7ec3\u5ea6\u4e0e\u6280\u5de7\u7684\u9898\u3002\n\n\u5c06\u7f6e\u6362\u62c6\u6210\u82e5\u5e72\u4e2a\u73af\uff0c\u53ef\u4ee5\u53d1\u73b0\u70b9 $x$ \u5728\u957f\u5ea6\u4e3a $l$ \u7ea6\u6570\u7684\u73af\u5185\u5f53\u4e14\u4ec5\u5f53 $(2^l-1)x\\equiv0\\pmod{2^n+1}$\uff0c\u4e5f\u5c31\u662f\uff1a\n\n$$\\frac{2^n+1}{\\gcd(2^n+1,2^l-1)}\\mid x$$\n\n\u7136\u540e\u8054\u60f3\u5230\u7ecf\u5178\u7ed3\u8bba $\\gcd(x^a-1,x^b-1)=x^{\\gcd(a,b)}-1$\uff0c\u4e8e\u662f\u8003\u8651\u5411\u5176\u8f6c\u5316\uff1a\n\n$$\\gcd(2^n+1,2^l-1)=\\gcd(\\frac{2^{2n}-1}{2^n-1},2^l-1)=\\frac{2^{\\gcd(2n,l)}-1}{2^{\\gcd(n,l)}-1}$$\n\n\u4ee4 $t_l$ \u4e3a\u957f\u5ea6\u4e3a $l$ \u7684\u7ea6\u6570\u7684\u73af\u6570\u91cf\uff08\u663e\u7136 $l$ \u662f $2n$ \u7684\u56e0\u6570\uff0c\u56e0\u4e3a $2^{2n}l=(2^n+1)(2^n-1)l+l\\equiv l\\pmod{2^n+1}$\uff09\uff0c\u90a3\u4e48\uff1a\n\n\u82e5 $\\gcd(2n,l)=\\gcd(n,l)$\uff0c\u90a3\u4e48 $2^n+1\\mid x$\uff0c\u6b64\u65f6 $t_l=0$\u3002\n\n\u5426\u5219\uff0c$\\gcd(2n,l)=2\\gcd(n,l)$\uff0c\u90a3\u4e48 $\\dfrac{2^n+1}{2^{\\gcd(n,l)}-1}\\mid x$\uff0c\u90a3\u4e48 $t_l=2^{\\gcd(n,l)}$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4 $t_l=\\begin{cases}0&\\gcd(2n,l)=\\gcd(n,l)\\\\2^{\\gcd(n,l)}&\\text{otherwise}\\end{cases}$\n\n\u4ee4 $p$ \u4e3a $n$ \u5206\u89e3\u8d28\u56e0\u6570\u6709\u591a\u5c11\u4e2a $2$\uff0c\u90a3\u4e48 $t_l$ \u975e\u96f6\u5f53\u4e14\u4ec5\u5f53 $2^{p+1}\\mid l$\u3002\n\n\u7531\u4e8e\u73af\u957f\u662f $2n$ \u7684\u7ea6\u6570\u800c\u4e0d\u662f $n$ \u7684\u7ea6\u6570\uff0c\u8d70 $n$ \u6b65\u4e4b\u540e\u6bcf\u4e2a\u73af\u90fd\u4e00\u5b9a\u8d70\u4e86\u4e00\u534a\uff08\u539f\u56e0\u662f\u9020\u6210\u8d21\u732e\u7684\u73af\u957f\u7684\u4e8c\u5e42\u6b21\u81f3\u5c11\u662f $2^{p+1}$\uff0c\u8d70 $2n$ \u6b65\u8d70\u5b8c\u7684\u5b8c\u6574\u73af\u6570\u91cf\u4e3a\u5947\u6570\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4ee4 $g(n)$ \u4e3a $P^0,P^1,\\cdots,P^{2n-1}$ \u7684\u4e0d\u52a8\u70b9\u6570\u91cf\uff0c\u90a3\u4e48\u6709 $f(n)=\\sum\\frac{g(n)+2^n}{2}$\u3002\n\n\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u201d\u4e3a $l$ \u7ea6\u6570\u201c\u83ab\u53cd\uff0c\u5e76\u8bbe $n=2^ab$\uff1a\n\n\u4e0b\u9762\u8981\u7528\u5230\u7684\u4e00\u4e2a\u5f0f\u5b50\uff1a$\\sum_{k=1}^n\\mu(k)\\lfloor\\frac{n}{k}\\rfloor=\\sum_{d=1}^n\\sum_{k\\mid d}\\mu(k)=1$\u3002\n\n$$g(n)=\\sum_{k=1}^{b}\\lfloor\\frac{2n}{k}\\rfloor\\sum_{d\\mid k\\times 2^{a+1}}2^{\\gcd(d,b)2^a}\\mu(\\frac{k}{d})\\\\=\\sum_{p\\mid b}2^{2^ap}\\sum_{k=1}^{\\frac{b}{p}}\\lfloor\\frac{b}{pk}\\rfloor\\sum_{d\\mid k}\\mu(\\frac{k}{d})\\sum_{z\\mid d,z\\mid\\frac{b}{p}}\\mu(z)\\\\=\\sum_{p\\mid b}2^{2^ap}\\sum_{z\\mid\\frac{b}{p}}\\mu(z)\\sum_{d=1}^{\\frac{b}{pz}}\\sum_{k=1}^{\\lfloor\\frac{b}{pzd}\\rfloor}\\mu(k)\\lfloor\\frac{b}{pzdk}\\rfloor\\\\=\\sum_{p\\mid b}2^{2^ap}\\sum_{z\\mid\\frac{b}{p}}\\mu(z)\\sum_{d=1}^{\\frac{b}{pz}}1=\\sum_{p\\mid b}2^{2^ap}\\sum_{z\\mid\\frac{b}{p}}\\mu(z)\\frac{b}{pz}\\\\=\\sum_{p\\mid b}2^{2^ap}\\varphi(\\frac{b}{p})=\\sum_{p\\mid n,p\\in\\mathbb{O}}2^{\\frac{n}{p}}\\varphi(p)$$\n\n\u7ee7\u7eed\u63a8\uff1a\n\n$$\\sum_{i=1}^ng(i)=\\sum_{i=1}^n\\sum_{p\\mid n,p\\in\\mathbb{O}}2^{\\frac{n}{p}}\\varphi(p)\\\\=\\sum_{d=1}^n2^d\\sum_{1\\leqslant p\\leqslant \\lfloor\\frac{n}{d}\\rfloor,p\\in\\mathbb{O}}\\varphi(p)$$\n\n\u8bb0 $h(n)=\\sum_{i=1}^n[i\\in\\mathbb{O}]\\varphi(i),p(n)=\\sum_{i=1}^n\\varphi(i)$\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$g(i)=\\sum_{d=1}^n 2^dh(\\lfloor\\frac{n}{d}\\rfloor)\\\\h(n)=p(n)-\\sum_{i=1}^n[i\\notin\\mathbb{O}]\\varphi(i)=p(n)-\\sum_{i=1}^{\\lfloor\\frac{n}{2}\\rfloor}[i\\in\\mathbb{O}]\\varphi(2i)-\\sum_{i=1}^{\\lfloor\\frac{n}{2}\\rfloor}[i\\notin\\mathbb{O}]\\varphi(2i)\\\\=p(n)-\\sum_{i=1}^{\\lfloor\\frac{n}{2}\\rfloor}[i\\in\\mathbb{O}]\\varphi(i)-2\\sum_{i=1}^{\\lfloor\\frac{n}{2}\\rfloor}[i\\notin\\mathbb{O}]\\varphi(i)\\\\=p(n)-h(\\lfloor\\frac{n}{2}\\rfloor)-2(p(\\lfloor\\frac{n}{2}\\rfloor)-h(\\lfloor\\frac{n}{2}\\rfloor))=p(n)-2p(\\lfloor\\frac{n}{2}\\rfloor)+h(\\lfloor\\frac{n}{2}\\rfloor)$$\n\n\u5f52\u7eb3\u53ef\u4ee5\u8bc1\u660e $h(n)=p(n)-\\sum_{i=1}^{\\lfloor\\log_2 n\\rfloor}p(\\lfloor\\frac{n}{2^i}\\rfloor)$\u3002\n\n\u7531\u4e8e\u675c\u6559\u7b5b\u662f\u5757\u7b5b\uff08\u5373\u5176\u53ef\u4ee5\u7b5b\u51fa $x=\\lfloor\\frac{n}{1}\\rfloor,\\lfloor\\frac{n}{2}\\rfloor,\\cdots,\\lfloor\\frac{n}{n}\\rfloor$ \u65f6\u51fd\u6570\u524d\u7f00\u548c\u7684\u503c\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u8fdb\u884c\u4e00\u6b21\u675c\u6559\u7b5b\uff0c\u7136\u540e\u66b4\u529b\u7b97\u5c31\u597d\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(n^{\\frac{2}{3}}+\\sqrt n\\log n)$\u3002\n\n## \u4ee3\u7801\n\n\u5199\u7684\u65f6\u5019\u5077\u61d2\u7528\u4e86 map\uff0c\u5b9e\u73b0\u7684\u4e5f\u4e0d\u592a\u7cbe\u7ec6\uff0c\u4e0d\u8fc7\u8fd8\u662f\u52c9\u5f3a\u8fc7\u4e86\u3002\n\n```\n#include<stdio.h>\n#include<map>\nusing namespace std;\nconst int maxn=5000005,mod=998244353,inv2=(mod+1)/2;\nlong long L,R;\nint ps;\nint c[maxn],p[maxn],phi[maxn],sum[maxn];\nmap<long long,int>mp;\nint ksm(int a,long long b){\n\tint res=1;\n\twhile(b){\n\t\tif(b&1)\n\t\t\tres=1ll*res*a%mod;\n\t\ta=1ll*a*a%mod,b>>=1;\n\t}\n\treturn res;\n}\nvoid sieve(int n){\n\tc[1]=phi[1]=sum[1]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tif(c[i]==0)\n\t\t\tp[++ps]=i,phi[i]=i-1;\n\t\tfor(int j=1;j<=ps&&i*p[j]<=n;j++){\n\t\t\tc[i*p[j]]=1;\n\t\t\tif(i%p[j]==0){\n\t\t\t\tphi[i*p[j]]=phi[i]*p[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*p[j]]=phi[i]*(p[j]-1);\n\t\t}\n\t\tsum[i]=(sum[i-1]+phi[i])%mod;\n\t}\n}\nint calcp(long long n){\n\tif(n<=5000000)\n\t\treturn sum[n];\n\tif(mp.count(n))\n\t\treturn mp[n];\n\tint res=1ll*(n%mod)*(n%mod+1)%mod*inv2%mod;\n\tlong long l=2,r;\n\twhile(l<=n)\n\t\tr=n/(n/l),res=(res-1ll*(r-l+1)%mod*calcp(n/l)%mod+mod)%mod,l=r+1;\n\treturn mp[n]=res;\n}\nint calch(long long n){\n\tint res=calcp(n);\n\tn>>=1;\n\twhile(n)\n\t\tres=(res-calcp(n)+mod)%mod,n>>=1;\n\treturn res;\n}\nint calcf(long long n){\n\tlong long l=1,r;\n\tint res=0,lst=0;\n\twhile(l<=n){\n\t\tr=n/(n/l);\n\t\tint now=(ksm(2,r+1)-2+mod)%mod;\n\t\tres=(res+1ll*(now-lst+mod)*calch(n/l))%mod;\n\t\tlst=now;\n\t\tl=r+1;\n\t}\n\treturn 1ll*(0ll+res+ksm(2,n+1)-2+mod)*inv2%mod;\n}\nint main(){\n\tsieve(5000000);\n\tscanf(\"%lld%lld\",&L,&R);\n\tprintf(\"%d\\n\",(calcf(R)-calcf(L-1)+mod)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1644759071,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8151\u3010\u5f7c\u5cb8 | To See the Next Part of the Dream\u3011"
    }
]