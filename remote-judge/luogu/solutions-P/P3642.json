[
    {
        "content": "\u795e\u4ed9\u9898\u76ee\u554aQwQ\n\n\u8bbe$f_i(x)$\u8868\u793a\u4ee5\u7b2c$i$\u4e2a\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u9700\u8981$x$\u79d2\u5f15\u7206\u7684\u4ee3\u4ef7\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u51fd\u6570\u662f\u4e00\u4e2a\u4e0b\u51f8\u7684\u4e00\u6b21\u5206\u6bb5\u51fd\u6570\u3002\n\n\u8003\u8651\u8fd9\u4e2a\u51fd\u6570\u5408\u5e76\u5230\u7236\u4eb2\u8282\u70b9\u65f6\u4f1a\u53d1\u751f\u600e\u6837\u7684\u53d8\u5316\u3002\n\n\u8bbe$f_i'(x)$\u662f\u539f\u51fd\u6570\uff0c$f_i(x)$\u662f\u65b0\u51fd\u6570\uff0c$i$\u548c\u7236\u4eb2\u4e4b\u95f4\u7684\u8fb9\u957f\u5ea6\u4e3a$l$\uff0c$[L, R]$\u662f$f_i'(x)$\u659c\u7387\u4e3a$0$\u7684\u90a3\u4e00\u6bb5\u7684\u5de6\u53f3\u7aef\u70b9\u7684\u6a2a\u5750\u6807\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$f_i(x) = \\begin{cases}f_i'(x) + l & x \\leq L \\\\f_i'(L) + (l - (x - L)) & L < x \\leq L + l \\\\f_i'(L) & L + l < x \\leq R + l \\\\f_i'(L) + ((x - R) - l) & R + l < x\\end{cases}$$\n\n\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2a\u6765\u770b\u3002\n\n\u9996\u5148\u7b2c\u4e00\u4e2a\uff0c\u5f53$x \\leq L$\u65f6\uff0c\u6211\u4eec\u80af\u5b9a\u8981\u8ba9\u65b0\u7684$l$\u8d8a\u5c0f\u8d8a\u597d\uff0c\u56e0\u4e3a\u6539\u53d8$l$\u7684\u4ee3\u4ef7\u4e3a$1$\uff0c\u800c\u8fd9\u4e2a\u51fd\u6570\u5728$\\leq L$\u7684\u65f6\u5019\u659c\u7387$\\leq -1$\uff0c\u5373\u4fee\u6539\u4e00\u6b21$x$\u7684\u4ee3\u4ef7$\\geq 1$\uff0c\u6240\u4ee5\u5e72\u8106\u5c06$l$\u53d8\u6210$0$\u3002\n\n\u7b2c\u4e8c\u4e2a\uff0c\u6211\u4eec\u53ea\u8981\u4fdd\u8bc1$x = L$\u5c31\u80fd\u53d6\u5230\u51fd\u6570\u7684\u6700\u5c0f\u503c\uff0c\u4e8e\u662f$l$\u7684\u53d8\u5316\u91cf\u8d8a\u5c0f\u8d8a\u597d\u3002\n\n\u7b2c\u4e09\u4e2a\uff0c\u6211\u4eec\u4e0d\u7528\u6539\u53d8$l$\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u80fd\u53d6\u5230\u6700\u5c0f\u503c\uff0c\u90a3\u5c31\u4e0d\u7528\u6539\u53d8\u4e86\u3002\n\n\u7b2c\u56db\u4e2a\u548c\u7b2c\u4e00\u4e2a\u5f88\u50cf\uff0c\u8fd9\u91cc\u5c31\u7565\u53bb\u4e86\u3002\n\n------\n\n\u90a3\u4e48\u8fd9\u4e2a\u8fc7\u7a0b\u7a76\u7adf\u5bf9\u8fd9\u4e2a\u51fd\u6570\u505a\u4e86\u4ec0\u4e48\u6539\u53d8\u5462\uff1f\n\n\u6211\u4eec\u5c06$\\leq L$\u90e8\u5206\u7684\u51fd\u6570\u5411\u4e0a\u5e73\u79fb\u4e86$l$\u5355\u4f4d\uff0c\u5c06$[L,R]$\u90e8\u5206\u5411\u53f3\u5e73\u79fb$l$\u5355\u4f4d\uff0c\u5728$[L,L+l]$\u90e8\u5206\u63d2\u5165\u4e86\u4e00\u6761\u659c\u7387\u4e3a$-1$\u7684\u76f4\u7ebf\uff0c\u5e76\u5c06$> R + l$\u7684\u90e8\u5206\u7684\u659c\u7387\u6539\u4e3a\u4e86$1$\u3002\n\n\u4e8e\u662f\u5927\u6982\u53d8\u6210\u4e86\u8fd9\u4e2a\u6837\u5b50\uff08\u56fe\u6e90\u7f51\u7edc\uff09\uff1a\n\n![](https://i.loli.net/2019/03/31/5ca05e4a15b2b.png)\n\n\u8fd9\u6837\uff0c\u5404\u4e2a\u62d0\u70b9\u4e4b\u95f4\u7684\u76f4\u7ebf\u7684\u659c\u7387\u662f\u4ece\u5de6\u5230\u53f3\u9012\u589e\u7684\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u5047\u8bbe\u5404\u4e2a\u62d0\u70b9\u4e4b\u95f4\u7684\u76f4\u7ebf\u659c\u7387\u7684\u589e\u91cf\u4e3a$1$\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u659c\u7387\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u7528\u4e24\u4e2a\u540c\u4e00\u4f4d\u7f6e\u7684\u62d0\u70b9\u6765\u8868\u793a\u8fd9\u4e2a\u4e0d\u5b58\u5728\u7684\u659c\u7387\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ea\u53ef\u80fd\u5b58\u4e0b\u62d0\u70b9\u7684\u6a2a\u5750\u6807\uff0c\u4e8e\u662f\u600e\u4e48\u6c42\u51fd\u6570\u503c\u662f\u4e00\u4e2a\u95ee\u9898\u3002\n\n\u6211\u4eec\u5982\u679c\u80fd\u77e5\u9053$f(0)$\u7684\u503c\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u5c31\u597d\u529e\u4e86\u3002\n\n$f(0)$\u7684\u503c\u8fd8\u4e0d\u597d\u6c42\uff1f\uff1f\uff1f\u5c31\u662f\u6240\u6709\u8fb9\u6743\u4e4b\u548c\u554a\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86\u901a\u8fc7\u62d0\u70b9\u6a2a\u5750\u6807\u6c42\u5f97$f(L)$\u7684\u65b9\u6cd5\uff0c\u7686\u5927\u6b22\u559c\u3002\n\n\u90a3\u4e48\u6211\u4eec\u77e5\u9053\u6bcf\u4e2a\u51fd\u6570\u88ab\u5408\u5e76\u4e0a\u53bb\u4e4b\u524d\u4f1a\u53d8\u6210\u4ec0\u4e48\u6837\u5b50\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u4e5f\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u7684\u5408\u5e76\u4e24\u4e2a\u51fd\u6570\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u4e24\u4e2a\u51fd\u6570\u7684\u62d0\u70b9\u5217\u8868\u5408\u5e76\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u6211\u4eec\u518d\u770b\u770b\u5728\u5408\u5e76\u5230\u7236\u4eb2\u8282\u70b9\u65f6\u8981\u505a\u7684\u64cd\u4f5c\uff1a\n\n\u4e00\u3001\u5c06\u659c\u7387$> 0$\u7684\u90a3\u4e00\u6bb5\u7684\u659c\u7387\u6539\u4e3a$1$\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u5408\u5e76\u4e0a\u6765\u7684\u51fd\u6570\u7684\u659c\u7387\u6700\u5927\u503c\u90fd\u4e3a$1$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5220\u9664$k - 1$\u4e2a\u6700\u5927\u7684\u62d0\u70b9\u5373\u53ef\uff0c\u5176\u4e2d$k$\u662f\u8fd9\u4e2a\u70b9\u513f\u5b50\u7684\u6570\u91cf\u3002\n\n\u4e8c\u3001\u5c06\u659c\u7387$=0$\u7684\u90a3\u4e00\u6bb5\u5e73\u79fb$l$\u5355\u4f4d\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u505a\u5b8c\u4e00\u64cd\u4f5c\u4e4b\u540e\uff0c\u6a2a\u5750\u6807\u6700\u5927\u7684\u4e24\u4e2a\u62d0\u70b9\u5c31\u662f\u659c\u7387\u4e3a$0$\u7684\u4e24\u4e2a\u7aef\u70b9\u4e86\uff0c\u5c06\u5b83\u4eec\u5f39\u51fa\u6765\uff0c\u52a0\u4e0a$l$\u518d\u653e\u8fdb\u53bb\u5c31\u6ca1\u4e86\u3002\n\n\u4e09\u3001\u52a0\u5165\u4e00\u6bb5\u659c\u7387\u4e3a$-1$\u7684\u76f4\u7ebf\u3002\n\n\u8fd9\u4e2a\u5176\u5b9e\u5728\u505a\u64cd\u4f5c\u4e8c\u7684\u65f6\u5019\u5c31\u987a\u5e26\u505a\u5b8c\u4e86\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u53ef\u5e76\u5806\u5c31\u53ef\u4ee5\u505a\u4e0a\u9762\u7684\u6240\u6709\u64cd\u4f5c\u3002\n\n\u6700\u540e\u6c42\u7b54\u6848\u65f6\uff0c\u6211\u4eec\u4fdd\u7559$L$\u53ca\u5176\u5de6\u8fb9\u7684\u62d0\u70b9\uff0c\u4f9d\u6b21\u51cf\u53bb\u5b83\u4eec\u7684\u6a2a\u5750\u6807\u5c31\u662f\u6211\u4eec\u60f3\u8981\u7684\u51fd\u6570\u503c\u4e86\u3002\n\n\u4ee3\u7801\u89c1\u6211\u7684[$\\texttt{blog}$](https://www.cnblogs.com/cj-xxz/p/10631433.html)",
        "postTime": 1554016214,
        "uid": 46800,
        "name": "xgzc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3642 \u3010[APIO2016]\u70df\u706b\u8868\u6f14\u3011"
    },
    {
        "content": "\u9996\u5148\u6709\u4e00\u4e2a\u5f88\u663e\u7136\u7684 dp \u65b9\u7a0b\n\n\u8bbe $f_{u,x}$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7ed3\u675f\u65f6\u95f4\u7edf\u4e00\u4e3a $x$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u6709 $f_{u,x}=\\sum \\min_{y\\le x}\\{f_{v,y}+|w-x+y|\\}$\n\n\u4e8e\u662f\u6709\u4e86\u4e00\u4e2a $\\mathcal O(n(\\sum w)^2)$ \u7684\u65b9\u7a0b\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8003\u8651\u628a $f_u$ \u7684\u6240\u6709\u70b9\u503c\u5199\u6210\u51fd\u6570\u7684\u5f62\u5f0f $f_u(x)$\n\n\u8003\u8651 $f_v(y)$ \u5bf9\u7236\u4eb2 $f_u(x)$ \u7684\u8d21\u732e\n\n\u9996\u5148\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u51fd\u6570\u6bcf\u4e00\u6bb5\u7684\u659c\u7387\u4e00\u5b9a\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u5e76\u4e14\u659c\u7387\u5747\u4e3a\u6574\u6570\uff0c\u4e8e\u662f $f_v(y)$ \u7684\u6700\u4f18\u53d6\u503c\u5c31\u662f\u659c\u7387\u4e3a 0 \u7684\u4e00\u6bb5\uff0c\u8bb0\u4e3a $[L,R]$\uff0c\u63a5\u4e0b\u6765\uff0c\u8bb0 $f_v$ \u5bf9\u4e8e $f_u(x)$ \u7684\u8d21\u732e\u51fd\u6570\u4e3a $F_v(x)$\uff0c\u8bb0 $u\\to v$ \u7684\u8fb9\u6743\u4e3a $w$\n\n\u6839\u636e $F_v$ \u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053 $F_v(x)=\\min_{y\\le x}\\{f_v(y)+|w-x+y|\\}$\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u4e09\u7c7b\u6765\u8ba8\u8bba\u4e00\u4e0b\uff1a\n\n1. \u5f53 $x$ \u5f88\u5c0f\u7684\u65f6\u5019\uff0c\u6700\u4f18\u60c5\u51b5\u4e00\u5b9a\u662f\u628a $w$ \u4fee\u6539\u4e3a 0\uff08\u7531\u4e8e\u4fee\u6539 $w$ \u4e00\u5b9a\u6bd4\u4e0b\u9762\u6bcf\u4e00\u4e2a\u90fd\u4fee\u6539\u4f18\uff09  \n\u5177\u4f53\u6765\u8bf4\u5c31\u662f $x<L$ \u65f6\uff0c$F_v(x)=f_v(x)+w$ \u4e00\u5b9a\u6700\u4f18\uff0c\u56e0\u4e3a $f_v(x)$ \u5728 $x<L$ \u65f6\u4e3a\u5355\u8c03\u964d\u51fd\u6570\uff0c\u4e14\u659c\u7387\u5c0f\u4e8e\u7b49\u4e8e -1\uff0c\u4e8e\u662f $w$ \u5c11\u7f29\u77ed $k$\uff0c\u5219 $f_v$ \u7684\u589e\u52a0\u91cf\u4e00\u5b9a $\\ge k$\uff0c\u4e8e\u662f\u5728 $w$ \u4fee\u6539\u4e3a 0 \u65f6\u53d6\u5230\u6700\u4f18\u89e3\n\n2. \u5f53 $x$ \u5f88\u5927\u7684\u65f6\u5019\uff0c\u548c\u4e0a\u79cd\u60c5\u51b5\u7c7b\u4f3c\uff0c\u6700\u4f18\u60c5\u51b5\u4e00\u5b9a\u8981\u628a $w$ \u62c9\u957f  \n\u5177\u4f53\u6765\u8bf4\u5c31\u662f $x\\ge R+w$ \u65f6\uff0c$F_v(x)=f_v(R)+x-R-w$ \u4e00\u5b9a\u6700\u4f18\uff0c\u56e0\u4e3a $f_v(x)$ \u5728 $x>R$ \u65f6\u4e3a\u5355\u8c03\u5347\u51fd\u6570\uff0c\u4e14\u659c\u7387\u5927\u4e8e\u7b49\u4e8e 1\uff0c\u4e8e\u662f $w$ \u5c11\u62c9\u957f $k$\uff0c$f_v$ \u7684\u589e\u52a0\u91cf\u4e00\u5b9a $\\ge k$\uff0c\u53c8 $f_v$ \u5728 $[L,R]$ \u5185\u90fd\u80fd\u53d6\u5230\u6700\u4f18\u503c\uff0c\u6240\u4ee5 $w$ \u62c9\u957f\u5230 $x-R$ \u65f6\u53d6\u5230\u6700\u4f18\u89e3\n\n3. \u5f53 $x$ \u9002\u4e2d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574 $w$ \u7f29\u5c0f\u7684\u503c\u4f7f $F_v$ \u53d6\u5230\u6700\u4f18\uff0c\u6211\u4eec\u53ef\u4ee5\u7ee7\u7eed\u5206\u4e24\u7c7b\u8ba8\u8bba  \n\t1\uff09\u8fd9\u79cd\u60c5\u51b5 $w$ \u4e0d\u7528\u4fee\u6539\u5373\u53ef\u53d6\u5230\u6700\u4f18\u503c\uff0c\u5177\u4f53\u6765\u8bf4\uff0c $L+w\\le x\\le R+w$ \u65f6\uff0c $F_v(x)=f_v(x-w)$ \u4e00\u5b9a\u6700\u4f18\uff0c\u56e0\u4e3a $w$ \u4e0d\u4fee\u6539\uff0c\u90a3\u4e48\u4fee\u6539 $w$ \u7684\u4ee3\u4ef7\u53d6\u5230\u4e86\u6700\u5c0f\uff0c\u540c\u65f6\u7531\u4e8e $x-w\\in[L,R]$\uff0c$f_v(x-w)$ \u4e5f\u53d6\u5230\u4e86\u6700\u5c0f\uff0c\u90a3\u4e48\u8fd9\u5c31\u662f\u6700\u4f18\u503c  \n   2\uff09\u8fd9\u79cd\u60c5\u51b5 $w$ \u9700\u8981\u4fee\u6539\uff0c\u5e76\u4e14\u4e00\u5b9a\u662f\u7f29\u5c0f\uff08\u62c9\u4f38\u5c5e\u4e8e 2. \u60c5\u51b5\uff09\uff0c\u5177\u4f53\u6765\u8bf4\uff0c$L\\le x<L+w$ \u65f6\uff0c$F_v(x)=f_v(L)+w-x+L$\uff0c\u539f\u56e0\u4e0e 1. \u60c5\u51b5\u76f8\u540c\uff0c\u53ea\u662f\u8fd9\u91cc\u6ca1\u6709\u5fc5\u8981\u628a $w$ \u4fee\u6539\u4e3a 0\uff08\u539f\u56e0\u662f $w$ \u591a\u4fee\u6539\u4e86\u4ee5\u540e $f_v$ \u5e76\u4e0d\u4f1a\u56e0\u6b64\u51cf\u5c0f\uff09\n   \n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u51e0\u79cd\u60c5\u51b5\u6574\u7406\u4e00\u4e0b\uff0c\u5f97\uff1a\n$$\nF_v(x)=\n\\begin{cases}\nf_v(x)+w & (x<L)\\\\\nf_v(L)+w-x+L & (L\\le x<L+w)\\\\\nf_v(x-w)=f_v(L) &(L+w\\le x\\le R+w)\\\\\nf_v(R)+x-R-w &(x>R+w)\n\\end{cases}\n$$\n\n\u8003\u8651 $F_v$ \u5bf9\u4e8e $f_v$ \u7684\u53d8\u5316\u5173\u7cfb\n\n1. $x<L$ \u65f6\uff0c$f_v$ \u5f80\u4e0a\u5e73\u79fb $w$ \u5355\u4f4d\u5373\u53ef  \n2. $L\\le x<L+w$ \u65f6\uff0c\u5728\u5411\u4e0a\u5e73\u79fb $w$ \u7684\u57fa\u7840\u4e0a\u9700\u8981\u628a\u659c\u7387\u4fee\u6539\u4e3a -1  \n3. $L+w\\le x\\le R+w$ \u65f6\uff0c\u5c06\u539f\u5148 $[L,R]$ \u7684\u51fd\u6570\u5e73\u79fb\u5230 $[L+w,R+w]$ \u5373\u53ef  \n4. $x>R+w$ \u65f6\uff0c\u628a\u8fd9\u6bb5\u51fd\u6570\u7684\u659c\u7387\u7edf\u4e00\u4fee\u6539\u4e3a 1\n\n\u53c8\u5bb9\u6613\u53d1\u73b0 $F_v$ \u662f\u8fde\u7eed\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u5728\u5b58\u50a8\u8fd9\u6bb5\u51fd\u6570\u7684\u65f6\u5019\u53ea\u9700\u8981\u5b58\u50a8 $F_v$ \u7684\u5404\u4e2a\u62d0\u70b9\u5373\u53ef\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u4fee\u6539 $F_v$ \u53ea\u9700\u8981\u628a $L$ \u548c $L$ \u4e4b\u540e\u7684\u6240\u6709\u62d0\u70b9\u5168\u90e8\u5220\u9664\uff0c\u65b0\u52a0\u5165 $L+w$\uff0c$R+w$ \u4e24\u4e2a\u62d0\u70b9\u5373\u53ef\n\n\u4e0e $f_u$ \u5408\u5e76\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a\u8fd9\u4e9b\u62d0\u70b9\u5e8f\u5217\u76f4\u63a5\u548c $f_u$ \u672c\u8eab\u62e5\u6709\u7684\u62d0\u70b9\u5e8f\u5217\u5408\u5e76\uff0c\u5e76\u4e14**\u4e0d\u53bb\u91cd**\uff0c\u56e0\u4e3a\u91cd\u590d $k$ \u6b21\u7684\u62d0\u70b9\u53ef\u4ee5\u8868\u793a\u8fd9\u4e2a\u70b9\u5de6\u53f3\u4e24\u8fb9\u7684\u659c\u7387\u5dee\u4e3a $k$\n\n\u53c8\u62d0\u70b9\u6a2a\u5750\u6807\u5355\u8c03\u4e0b\u964d\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u53ef\u4ee5\u60f3\u5230\u7528\u53ef\u5e76\u7684\u5927\u6839\u5806\u6765\u7ef4\u62a4\u8fd9\u4e2a\u51fd\u6570\n\n\u63a5\u4e0b\u6765\u8fd8\u6709\u4e24\u4e2a\u95ee\u9898\n\n1. \u5982\u4f55\u4ece\u53ef\u5e76\u5806\u4e2d\u627e\u5230\u659c\u7387\u4e3a 0 \u7684\u533a\u95f4\u7684\u4e24\u4e2a\u62d0\u70b9 $L,R$  \n\u6211\u4eec\u53d1\u73b0\u6bcf\u6b21\u4fee\u6539\u7684 $F$ \u51fd\u6570\u4e2d\uff0c\u659c\u7387\u4e3a\u6b63\u7684\u62d0\u70b9\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\uff08$R+w$\uff09\uff0c\u800c\u4e00\u4e2a\u51fd\u6570 $f_v$ \u4f1a\u5408\u5e76\u513f\u5b50\u4e2a\u6570 $k_v$ \u6b21\uff0c\u4e5f\u5c31\u662f\u8bf4 $f_v$ \u4e2d\u6709 $k_v$ \u4e2a\u659c\u7387\u4e3a\u6b63\u7684\u62d0\u70b9\uff0c\u4e8e\u662f\u5f39\u51fa $k_v-1$ \u4e2a\uff0c\u5269\u4e0b\u7684\u7b2c\u4e00\u4e2a\u5c31\u662f $R$\uff0c\u4e0b\u4e00\u4e2a\u5c31\u662f $L$\n\n2. \u5982\u4f55\u8ba1\u7b97\u7b54\u6848  \n\u6211\u4eec\u77e5\u9053\u4e86\u6839\u8282\u70b9\uff081 \u53f7\u8282\u70b9\uff09\u7684\u51fd\u6570\u62d0\u70b9\u96c6\u5408\uff0c\u53c8\u77e5\u9053\u4e86 $f_1(0)$ \u65f6\u7684\u53d6\u503c\uff08\u6240\u6709\u8fb9\u7684\u6743\u503c\u548c\uff09\uff0c\u53c8\u77e5\u9053\u4e86\u4e00\u4e2a\u62d0\u70b9\u548c\u4e0b\u4e00\u4e2a\u62d0\u70b9\u5bf9\u5e94\u7684\u51fd\u6570\u659c\u7387\u5dee\u4e3a 1\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u8f7b\u677e\u5730\u7b97\u51fa\u7b54\u6848\u4e86\n\n\u53ef\u5e76\u5806\u7528\u5de6\u504f\u6811\u5b9e\u73b0\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $\\mathcal O((n+m)\\log (n+m))$\n\n\u53e6\u5916\u6709\u4e00\u4e2a\u7ec6\u8282\u5c31\u662f\u5de6\u504f\u6811\u7684\u8282\u70b9\u8981\u5f00\u4e24\u500d\u5927\u5c0f\uff0c\u56e0\u4e3a\u6bcf\u6b21\u628a $f$ \u4fee\u6539\u6210 $F$ \u90fd\u8981\u65b0\u5efa\u4e24\u4e2a\u8282\u70b9\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 300010\n#define int long long\nusing namespace std;\nint n,m,ans;\nint fa[MAXN],w[MAXN],deg[MAXN];\nint val[MAXN<<1],d[MAXN<<1],rt[MAXN],tot;\nint lc[MAXN<<1],rc[MAXN<<1];\nint create(int v){\n\tval[++tot]=v;d[tot]=0;\n\treturn tot;\n}\nint merge(int p,int q){\n\tif(!p||!q)return p+q;\n\tif(val[p]<val[q])swap(p,q);\n\trc[p]=merge(rc[p],q);\n\tif(d[lc[p]]<d[rc[p]])swap(lc[p],rc[p]);\n\td[p]=d[rc[p]]+1;return p;\n}\nvoid pop(int &p){p=merge(lc[p],rc[p]);}\nsigned main(){\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=2;i<=n+m;i++){\n\t\tscanf(\"%lld%lld\",&fa[i],&w[i]);\n\t\tans+=w[i];deg[fa[i]]++;\n\t}\n\tfor(int u=n+m;u>=2;u--){\n\t\tif(u<=n)while(deg[u]-->1)pop(rt[u]);\n\t\tint R=val[rt[u]];pop(rt[u]);\n\t\tint L=val[rt[u]];pop(rt[u]);\n\t\trt[u]=merge(rt[u],merge(create(L+w[u]),create(R+w[u])));\n\t\trt[fa[u]]=merge(rt[fa[u]],rt[u]);\n\t}\n\twhile(deg[1]--)pop(rt[1]);\n\twhile(rt[1])ans-=val[rt[1]],pop(rt[1]);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1606536919,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3642 \u3010[APIO2016]\u70df\u706b\u8868\u6f14\u3011"
    },
    {
        "content": "\u53ef\u5e76\u5806\u597d\u9898\u554a\u2026\u2026\n\n\u4e0d\u662f\u5f88\u660e\u767d\u4e3a\u5565\u5de6\u504f\u6811\u662f\u6700\u5e38\u89c1\u7684\u53ef\u5e76\u5806\u2026\u2026\n\n~~\u660e\u660e\u914d\u5bf9\u5806\u6bd4\u5de6\u504f\u6811\u53c8\u5feb\u53c8\u597d\u5199~~\n\n\u9664\u4e86\u53ef\u6301\u4e45\u5316\u53ef\u5e76\u5806\u8fd9\u79cd\u4e1c\u897f\u4ee5\u5916\u5de6\u504f\u6811\u4f3c\u4e4e\u6ca1\u6709\u4ec0\u4e48\u5b58\u5728\u4ef7\u503c\u554a\n\n~~\u4f46\u662f\u8fd9\u9898\u53c8\u4e0d\u9700\u8981\u53ef\u6301\u4e45\u5316~~\n\n_________________\n\n# \u672c\u9898\u9898\u89e3\n\n\u7ed9\u5b9a\u4e00\u9897\u6811\u6bcf\u4e2a\u8fb9\u4e0a\u6709\u6743\u503c,\u4f60\u53ef\u4ee5\u4efb\u610f\u8c03\u6574\u6bcf\u4e2a\u8fb9\u7684\u6743\u503c\u4e3a\u4e00\u4e2a\u975e\u8d1f\u7684\u6574\u6570,\u5c06\u4e00\u6761\u539f\u6765\u6743\u503c\u4e3aval\u7684\u8fb9\u7684\u6743\u503c\u8c03\u6574\u4e3aa\u7684\u4ee3\u4ef7\u662f$|val-a|$,\u8981\u6c42\u8c03\u6574\u5b8c\u8fb9\u6743\u4e4b\u540e\u6bcf\u4e2a\u53f6\u5b50\u5230\u6839\u7684\u8ddd\u79bb\u662f\u76f8\u7b49\u7684,\u6c42\u6700\u5c0f\u4ee3\u4ef7\n\n### \u4ece\u4e00\u4e2anaive\u7684dp\u5f00\u59cb\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8bbe\u8ba1\u4e00\u4e2a\u975e\u5e38naive\u7684dp\u72b6\u6001\u5c31\u662f$dp(u,i)$\u8868\u793a\u5c06u\u5b50\u6811\u4e2d\u7684\u6240\u6709\u53f6\u5b50\u8282\u70b9\u8c03\u6574\u81f3\u8dddu\u7684\u7236\u4eb2\u8ddd\u79bb\u4e3a$j$\u7684\u6700\u5c0f\u4ee3\u4ef7\n\n\u90a3\u4e48\u6211\u4eec\u7684\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u662f\u5341\u5206\u7684\u5e73\u51e1\u7684,\u679a\u4e3eu\u548c\u7236\u4eb2\u7684\u8fb9\u5230\u5e95\u53d8\u6210\u4e86\u4ec0\u4e48\u503c\u7136\u540e\u8fdb\u884c\u53d6min\u64cd\u4f5c\n\n\u53ef\u4ee5\u63a8\u51fa\u8fd9\u6837\u7684\u4e00\u4e2a\u5f0f\u5b50\n\n$$f(u,i)=\\min_{k=0}^{i}|val-k|+\\sum_{v \\in u.son}f(v,i-k)$$\n\n_____________\n\n### \u89c2\u5bdf\u5f0f\u5b50\u7684\u7279\u70b9\n\n\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u5904\u7406\u7684\u51fd\u6570\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8emin\u5377\u79ef\u4e00\u6837\u7684\u5f0f\u5b50, \u663e\u7136\u5feb\u901f\u7684\u8ba1\u7b97\u8fd9\u4e2a\u4e1c\u897f\u662f\u6ca1\u4ec0\u4e48\u53ef\u80fd\u7684\u2026\u2026\n\n\u4e0d\u8fc7\u6211\u4eec\u7684$f(u,x)$\u8fd9\u4e2a\u51fd\u6570\u76f8\u5f53\u7684\u6709\u7279\u70b9\uff0c\u5728\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528\u5f52\u7eb3\u6cd5\u8bc1\u660e$f(u,x)$\u662f\u4e00\u4e2a\u5173\u4e8ex\u7684\u5206\u6bb5\u51fd\u6570\u5e76\u4e14\u5728\u6bcf\u6bb5\u90fd\u662f\u7ebf\u6027\u7684\n\n\u90a3\u4e48\u5bf9\u4e8e\u51fd\u6570\u7684min\u5377\u79ef\u8fd9\u4e2a\u8fd0\u7b97\uff0c\u5c3d\u7ba1\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u6ca1\u6709\u4ec0\u4e48\u6027\u8d28\u7684\uff0c\u4f46\u662f\u5728\u8fd9\u9053\u9898\u91cc\u6211\u4eec\u6709\u4e00\u4e2a\u51fd\u6570\u662f\u7edd\u5bf9\u503c\u51fd\u6570\uff0c\u800c\u53e6\u4e00\u4e2a\u51fd\u6570\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5206\u6bb5\u51fd\u6570\n\n\u6b64\u65f6\u6211\u4eec\u5c31\u6709\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u6027\u8d28\u4e86\n\n\u90a3\u4e48\u6211\u4eec\u624b\u52a8\u5206\u60c5\u51b5\u5927\u529b\u8ba8\u8bba\u4e00\u6ce2\u2026\u2026\uff08\u60f3\u8bc1\u660e\u7684\u4eba\u81ea\u5df1\u624b\u4e38\u53bb\u5427,\u63a8\u5f0f\u5b50\u63a8\u4e86\u6211\u4e00\u4e2a\u4e0b\u5348\uff09\n\n\u4f1a\u53d1\u73b0min\u5377\u79ef\u5927\u6982\u6709\u8fd9\u4e48\u51e0\u4e2a\u6027\u8d28\n\n1.\u4e00\u4e2a\u659c\u7387\u6bd4-1\u5927\u7684\u76f4\u7ebf\u5377\u79ef\u4e0a\u659c\u7387\u4e3a-1\u7684\u76f4\u7ebf\u4e4b\u540e\u65b0\u51fd\u6570\u622a\u8ddd\u4e3a\u4e24\u4e2a\u51fd\u6570\u7684\u622a\u8ddd\u4e4b\u548c,\u659c\u7387\u4e0d\u53d8\n\n2.\u4e00\u4e2a\u5e38\u6570\u51fd\u6570\u548c\u4e00\u4e2a\u659c\u7387\u4e3a-1\u7684\u76f4\u7ebf\u5377\u79ef\u4e4b\u540e\u622a\u8ddd\u4e3a\u4e24\u4e2a\u51fd\u6570\u622a\u8ddd\u4e4b\u548c\u800c\u659c\u7387\u53d8\u4e3a-1\n\n3.\u5bf9\u4e8e\u4e00\u4e2a\u4e0b\u51f8\u7684\u5206\u6bb5\u51fd\u6570\u5e76\u4e14\u6bcf\u4e00\u6bb5\u7684\u659c\u7387\u90fd\u5927\u4e8e1,\u548c\u4e00\u4e2a\u659c\u7387\u4e3a+1\u7684\u76f4\u7ebf\u5377\u79ef\u4e4b\u540e,\u8fd9\u4e2a\u51fd\u6570\u5c06\u4f1a\u53d8\u6210\u4e00\u6761\u659c\u7387\u4e3a1\u7684\u76f4\u7ebf\n\n\u4e8b\u5b9e\u4e0a\u521a\u624d\u7684\u7ed3\u8bba\u53ea\u662f\u4e00\u4e2a\u611f\u6027\u7406\u89e3,\u56e0\u4e3a\u6211\u4eec\u5728\u5377\u79ef\u7684\u65f6\u5019\u8fdc\u4e0d\u6b62\u8fd9\u51e0\u79cd\u60c5\u51b5\n\n\u7136\u540e\u6211\u4eec\u80e1\u4e71\u7206\u63a8\u4e00\u6ce2\u7ed3\u8bba\u4e4b\u540e\u53ef\u4ee5\u5f97\u5230\u8fd9\u4e2a\u5f0f\u5b50,\u5982\u679c\u6211\u4eec\u7ed9$f(u,x)$\u8fd9\u4e2a\u51fd\u6570\u6dfb\u52a0\u4e00\u6761\u7236\u4eb2\u8fb9\u7684\u8bdd\u6211\u4eec\u51fd\u6570\u4f1a\u505a\u8fd9\u6837\u7684\u53d8\u5316\uff0c\u5047\u8bbe\u8fd9\u4e2a\u51fd\u6570\u5728$[L,R]$\u5904\u53d6\u503c\u4e3a0\n\n1.\u5c06\u51fd\u6570\u5728$[1,L]$\u7684\u4e00\u6bb5\u5411\u4e0a\u5e73\u79fb$val$\u4e2a\u5355\u4f4d\n\n2.\u5c06\u51fd\u6570\u5728$[R,+\\infty]$\u7684\u4e00\u6bb5\u5411\u53f3\u5e73\u79fb$val$\u4e2a\u5355\u4f4d\u5e76\u4e14\u659c\u7387\u6539\u4e3a+1\n\n3.\u5c06\u51fd\u6570\u5728$[L,R]$\u7684\u4e00\u6bb5\u5411\u53f3\u5e73\u79fb$val$\u4e2a\u5355\u4f4d\n\n4.\u6b64\u65f6\u4f60\u53d1\u73b0\u4e2d\u95f4\u7a7a\u51fa\u4e86\u4e00\u6bb5\u659c\u7387\u4e3a-1,$val$\u4e2a\u5355\u4f4d\u9ad8$val$\u4e2a\u5355\u4f4d\u5bbd\u7684\u7ebf\u6bb5,\u5728\u4e2d\u95f4\u63d2\u5165\u4e00\u4e2a\u7ebf\u6bb5\u5c31\u884c\u4e86\n\n\u5408\u5e76\u76f8\u90bb\u7684\u5b50\u6811\u5c31\u662f\u5c06\u51fd\u6570\u7b80\u5355\u7684\u76f8\u52a0\u8d77\u6765\n\n\u90a3\u4e48\u6211\u4eec\u91c7\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u5b58\u50a8\u4e00\u4e2a\u51fd\u6570$f(u,x)$\n\n\u901a\u8fc7\u6570\u5b66\u5f52\u7eb3\u6cd5\u53ef\u4ee5\u5f97\u5230$f(u,x)$\u7684\u6700\u53f3\u7aef\u659c\u7387\u7b49\u4e8e1,\u800c\u5728\u63d2\u5165\u7236\u4eb2\u4e4b\u524d\u51fd\u6570\u7684\u6700\u5de6\u6bb5\u659c\u7387=u\u7684\u513f\u5b50\u6570\u76ee\n\n\u6211\u4eec\u73b0\u5728\u901a\u8fc7\u5b58\u50a8\u8fd9\u4e2a\u5206\u6bb5\u51fd\u6570\u7684\u6bcf\u4e00\u4e2a\u62d0\u70b9\u7684x\u5750\u6807\u6765\u8868\u793a\u8fd9\u4e2a\u51fd\u6570\n\n\u5e76\u4e14\u6211\u4eec\u8ba4\u4e3a\uff0c**\u4ece\u53f3\u5411\u5de6,\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u62d0\u70b9\uff0c\u51fd\u6570\u7684\u659c\u7387-1**\n\n\u90a3\u4e48\u521d\u59cb\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u5b58\u50a8\u4e00\u4e2a\u7edd\u5bf9\u503c\u51fd\u6570,\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5c31\u7528\u4e24\u4e2a\u5728\u540c\u4e00\u4e2a\u4f4d\u7f6e\u7684\u62d0\u70b9\u6765\u63cf\u8ff0\u8fd9\u4e2a\u7edd\u5bf9\u503c\u51fd\u6570\n\n\u8fd9\u6837\u50a8\u5b58\u51fd\u6570\u6709\u4e00\u4e2a\u597d\u5904\u5c31\u662f\u5f53\u6211\u4eec\u628a\u51fd\u6570\u76f8\u52a0\u7684\u65f6\u5019\u53ea\u9700\u8981\u7b80\u6613\u7684\u5c06\u4e24\u4e2a\u51fd\u6570\u7684\u62d0\u70b9\u5217\u8868\u5408\u5e76\u4e00\u4e0b\u518d\u5c06\u6700\u53f3\u7aef\u659c\u7387\u7b80\u5355\u76f8\u52a0\u5c31\u53ef\u4ee5\u5b8c\u6210\u51fd\u6570\u7684\u5408\u5e76\u5de5\u4f5c\u4e86\n\n\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u5df2\u7ecf\u53ef\u4ee5\u5b8c\u6210\u51fd\u6570\u76f8\u52a0\u7684\u64cd\u4f5c\u4e86,\u6211\u4eec\u73b0\u5728\u9700\u8981\u5179\u74f7\u7684\u64cd\u4f5c\u5c31\u662f\u5c06\u51fd\u6570\u6240\u6709\u659c\u7387\u4e3a\u6b63\u7684\u62d0\u70b9\u5168\u90e8\u5f39\u51fa\u8fd9\u4e2a\u64cd\u4f5c\u4e86(\u81f3\u4e8e\u4fee\u6539\u659c\u7387\u4ec0\u4e48\u7684\u5176\u5b9e\u7b80\u5355\u7684\u5c31\u662f\u63d2\u5165\u4e24\u4e2a\u62d0\u70b9\u5c31\u884c\u4e86)\n\n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\u5176\u5b9e\u8fd9\u4e2a\u64cd\u4f5c\u5c31\u7b49\u4ef7\u4e8e\u5f39\u51fa\u51fd\u6570\u4e2dx\u5750\u6807\u524dk\u5927\u7684\u62d0\u70b9\u5176\u4e2dk\u4e3a\u6211\u4eec\u5f53\u524d\u5904\u7406\u7684\u70b9\u7684\u5b69\u5b50\u4e2a\u6570\n\n\u90a3\u4e48\u8fd9\u4e2a\u64cd\u4f5c\u5f88\u663e\u7136\u5c31\u662f\u5220\u9664k\u6b21\u6700\u5927\u503c\n\n\u53c8\u53d1\u73b0\u6211\u4eec\u4e4b\u524d\u5c06\u4e24\u4e2a\u51fd\u6570\u76f8\u52a0\u7684\u64cd\u4f5c\u5c31\u662f\u5c06\u4e24\u4e2a\u51fd\u6570\u7684\u62d0\u70b9\u5217\u8868\u5408\u5e76\n\n\u6240\u4ee5\u6211\u4eec\u5199\u4e00\u4e2a\u53ef\u5e76\u7684\u5927\u6839\u5806(\u6216\u8005\u76f4\u63a5\u4f7f\u7528pb_ds)\u5c31\u53ef\u4ee5\u5b8c\u6210\u5408\u5e76\u51fd\u6570\u548c\u63d2\u5165\u4e00\u6761\u8fb9\u7684\u64cd\u4f5c\u4e86\n\n\u6700\u540e\u6211\u4eec\u5f97\u5230\u4e86\u6839\u8282\u70b9\u7684\u51fd\u6570,\u663e\u7136$f(root,0)=\\sum val$\u4e5f\u5c31\u662f\u6240\u6709\u8fb9\u7684\u548c,\u800c\u6700\u53f3\u6bb5\u7684\u659c\u7387\u5c31\u662f\u6839\u8282\u70b9\u7684\u5ea6\u6570\uff0c\u6211\u4eec\u8fd8\u77e5\u9053\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u70b9\u51fd\u6570\u7684\u659c\u7387\u5c31\u4f1a-1,\u56e0\u6b64\u6839\u636e\u8fd93\u70b9\u6211\u4eec\u5c31\u53ef\u4ee5\u53cd\u63a8\u51fa\u6574\u4e2a\u51fd\u6570\u7684\u8868\u8fbe\u5f0f\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u505a\u4e86,\u63d0\u53d6\u4e00\u4e0b\u8fd9\u4e2a\u5206\u6bb5\u51fd\u6570\u659c\u7387\u4e3a0\u7684\u90a3\u4e00\u6bb5\u503c\u5c31ok\u4e86\n\n\u8fd9\u91cc\u4f7f\u7528\u4e86\u914d\u5bf9\u5806\u6765\u5b9e\u73b0\u53ef\u5e76\u5806\n\n\u4e0a\u4ee3\u7801~\n\n```C\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=6*1e5+10;typedef long long ll;\ntemplate <class T>\nvoid read(T &x){\n    char c;\n    bool op = 0;\n    while(c = getchar(), c < '0' || c > '9')\n    if(c == '-') op = 1;\n    x = c - '0';\n    while(c = getchar(), c >= '0' && c <= '9')\n    x = x * 10 + c - '0';\n    if(op) x = -x;\n}\nint n;int m;ll tot;ll ans[N];int tp;\nnamespace par_hp//\u7b80\u6613\u914d\u5bf9\u5806\u677f\u5b50 \n{\n    int x[N];int al[N];int ct;ll val[N];\n    inline void add(int u,int v){x[v]=al[u];al[u]=v;}\n    inline int mg(int u,int v)\n    {\n        if(!u)return v;if(!v)return u; \n        if(val[u]<val[v])swap(u,v);add(u,v);return u;\n    }\n    inline int fpop(int u)\n    {\n        if(!u)return 0;if(!x[u])return u;int v1=x[u];int v2=x[v1];\n        x[u]=x[v1]=0;return mg(mg(u,v1),fpop(v2));\n    }\n    inline void dfs(int u){ans[++tp]=val[u];for(int i=al[u];i;i=x[i])dfs(i);}\n    struct hp//\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\u5355\u72ec\u5c01\u4e86\u4e00\u4e2a\u53ef\u5e76\u5806\u7ed3\u6784\u4f53 \n    {\n        int rt;\n        inline void push(const ll& x){val[++ct]=x;rt=mg(rt,ct);}\n        inline ll top(){return val[rt];}\n        inline void pop(){rt=fpop(al[rt]);}\n        inline void join(int p){rt=mg(rt,p);}\n    };\n}par_hp::hp h[N];int fa[N];ll val[N];int d[N];ll sum;\nint main()\n{\n    read(n);read(m);\n    for(int i=2;i<=n+m;i++)read(fa[i]),read(val[i]),d[fa[i]]++,sum+=val[i];\n    for(int i=n+m;i>1;i--)\n    {\n        ll l=0;ll r=0;//\u5408\u5e76 \n        while(d[i]--){r=h[i].top(),h[i].pop();}l=h[i].top();h[i].pop();\n        h[i].push(l+val[i]);h[i].push(r+val[i]);h[fa[i]].join(h[i].rt);\n    }par_hp::dfs(h[1].rt);sort(ans+1,ans+tp+1);tp-=d[1];//\u5904\u7406\u51fd\u6570 \n    for(int i=1;i<=tp;i++)\n        sum-=(ll)(ans[i]-ans[i-1])*(tp-i+1);printf(\"%lld\\n\",sum);\n}\n\n```\n\n\n\n\n\n\n\n",
        "postTime": 1539853626,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3642 \u3010[APIO2016]\u70df\u706b\u8868\u6f14\u3011"
    },
    {
        "content": "### Description \n\n\u7ed9\u5b9a\u4e00\u68f5\u4ee5 $1$ \u4e3a\u6839\u7684 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u6bcf\u6761\u8fb9\u6709\u4e00\u4e2a\u8fb9\u6743\u3002\u6709 $m$ \u4e2a\u53f6\u5b50\u3002\u5c06\u4e00\u6761\u8fb9\u7684\u8fb9\u6743\u4ece $x$ \u4fee\u6539\u81f3 $y$ \u9700\u8981\u7684\u4ee3\u4ef7\u662f $|x-y|$  \u3002\u6c42\u5c06\u6240\u6709\u53f6\u5b50\u5230\u6839\u8282\u70b9\u7684\u8ddd\u79bb\u4fee\u6539\u6210\u76f8\u540c\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\n### Solution \n\n\u795e\u4ed9\u9898\u3002\u53c2\u8003\uff1ahttps://blog.csdn.net/u014609452/article/details/52347062\uff1b\u6d1b\u8c37\u9898\u89e3\u7b2c\u4e00\u7bc7\u3002\n\n\u5b9a\u4e49 $f_x(y)$ \u8868\u793a\u5c06\u4ee5 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6240\u6709\u53f6\u5b50\u7ed3\u70b9\u5230 $x$ \u8282\u70b9\u7684\u8ddd\u79bb\u90fd\u4fee\u6539\u6210 $y$ \u6240\u9700\u8981\u7684\u4ee3\u4ef7\u3002\u6211\u4eec\u5f97\u5230\u7684\u7ed3\u8bba\u662f\uff1a**$f_x$ \u662f\u4e2a\u5206\u6bb5\u51fd\u6570\uff0c\u6bcf\u4e00\u6bb5\u4e3a\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570\uff0c\u5e76\u4e14\u4e0b\u51f8\uff08\u5373\u4e00\u4e2a\u51f8\u58f3\uff09**\u3002\n\n\u8fd9\u4e2a\u7ed3\u8bba\u7684\u8bc1\u660e\u8981\u7528\u5230\u6570\u5b66\u5f52\u7eb3\u6cd5\uff0c\u4e0d\u591a\u8d58\u8ff0\u3002\n\n\u8003\u8651\u7ef4\u62a4\u8fd9\u4e2a\u51f8\u58f3\u3002\u5373\u73b0\u5728\u5df2\u77e5\u6bcf\u4e2a\u513f\u5b50\u7684\u51f8\u58f3\uff0c\u5e94\u8be5\u5982\u4f55\u5408\u5e76\u51fa\u8fd9\u4e2a\u8282\u70b9\u7684\u51f8\u58f3\u3002\n\n\u513f\u5b50\u8282\u70b9\u7684\u51f8\u58f3\u9996\u5148\u9700\u8981\u5f80\u5176\u4e2d\u52a0\u5165\u7236\u4eb2\u5230\u4ed6\u7684\u8fd9\u4e00\u6761\u8fb9\u3002\u53ef\u4ee5\u8bc1\u660e\u6709\u4e86\u8fd9\u4e00\u6761\u8fb9\u540e\u4f9d\u7136\u662f\u4e00\u4e2a\u51f8\u58f3\u3002\n\n\u5bf9\u6bcf\u4e2a\u513f\u5b50\u90fd\u8fd9\u4e48\u505a\uff0c\u5f97\u5230\u7684\u6240\u6709\u51f8\u58f3\u76f8\u52a0\u5373\u4e3a\u7236\u4eb2\u8282\u70b9\u7684\u51f8\u58f3\u3002\n\n\u4e8e\u662f\u95ee\u9898\u53d8\u4e3a\u5982\u4f55\u7ef4\u62a4 \u201d\u5f80\u4e0a\u589e\u52a0\u4e00\u6761\u8fb9\u201c \u540e\u51f8\u58f3\u7684\u53d8\u5316\u3002\n\n\u8bbe\u589e\u52a0\u8fd9\u6761\u8fb9\u7684\u8fb9\u6743\u662f $w$ \uff0c\u8981\u589e\u52a0\u7684\u8fd9\u4e2a\u51fd\u6570\u662f $f$ \uff0c\u65b0\u7684\u51fd\u6570\u662f $g$ \uff0c\u6700\u5c0f\u503c\u5728 $L$ \u5230 $R$ \u53d6\u5230\u3002\n\n1. \u5bf9\u4e8e $x \\leq L$ \uff0c\u6b64\u65f6\u8981\u628a\u65b0\u52a0\u7684\u8fd9\u6761\u8fb9\u51cf\u6210 $0$ \uff0c\u4ee3\u4ef7 $w$ \u5373 $g(x) = f(x) + w$\n2. \u5bf9\u4e8e $L \\leq x \\leq L + w$ \uff0c\u6b64\u65f6\u5148\u5c06\u539f\u6765\u7684\u5b50\u6811\u91cc\u7684\u6bcf\u4e2a\u53f6\u5b50\u5230\u6839\u7684\u8ddd\u79bb\u4fee\u6539\u6210 $L$ \uff0c\u52a0\u4e0a $w$ \u540e\u8981\u518d\u4fee\u6539\u6210 $x$ \u9700\u8981 $L + w - x$ \u7684\u4ee3\u4ef7 \uff08\u5148\u628a $w$ \u7684\u8fb9\u5e72\u6389\u7136\u540e\u7528 $L - x$ \u7684\u4ee3\u4ef7\u4ece $L$ \u5230 $x$ \uff09\u3002\u5373 $g(x) = f(x) + w + L -x$\n3. \u5bf9\u4e8e $L + w \\leq x \\leq R + w$ \uff0c\u6b64\u65f6 $g(x) = f(x - w)$ \u3002\u53c8\u56e0\u4e3a $x - w \\in [L, R]$ \u90fd\u662f\u6700\u5c0f\u503c\uff0c\u6240\u4ee5 $g(x) = f(L)$ \n4. \u5bf9\u4e8e $R+w \\leq x$ \uff0c\u6b64\u65f6\u5148\u5c06\u539f\u6765\u7684\u5b50\u6811\u91cc\u7684\u6bcf\u4e2a\u53f6\u5b50\u5230\u6839\u7684\u8ddd\u79bb\u4fee\u6539\u6210 $R$ \uff0c\u52a0\u4e0a $w$ \u518d\u4fee\u6539\u6210 $x$ \u9700\u8981 $|R + w - x| = x - w - R$ \uff08\u5176\u5b9e\u548c 2 \u5dee\u4e0d\u591a\u53ea\u662f\u6b63\u8d1f\u7684\u95ee\u9898\uff09\u3002\u5373 $g(x) = f(x) + x - w - R$ \n\n\u5bb9\u6613\u770b\u51fa\uff0c$g$ \u7684\u6700\u5c0f\u503c\u5728 $[L + w, R + w]$ \u53d6\u5230\u3002\n\n\u5f97\u5230\u8fd9\u4e9b\u6027\u8d28\u540e\uff0c~~\u6211\u5df2\u7ecf\u81ea\u95ed\u4e86...~~ \u6211\u4eec\u53ef\u4ee5\u5206\u6790\u5b83\u7684\u51e0\u4f55\u610f\u4e49\u3002\n\n\u7b2c\u4e00\u6bb5\uff08$x \\leq L$\uff09 \u76f8\u5f53\u4e8e\u662f\u5f80\u4e0a\u505a\u4e86\u4e00\u4e2a\u5e73\u79fb\u3002\n\n\u7b2c\u4e8c\u6bb5\uff08$L \\leq x \\leq L + w$\uff09\u4f60\u4f1a\u53d1\u73b0\uff0c$g(x) = f(x) + w - L - x$ \u4e2d\u6709\u4e00\u4e2a $-x$ \u3002\u8fd9\u8bf4\u660e\u8fd9\u4e00\u6bb5\u7684\u659c\u7387\u662f $-1$ \n\n\u7b2c\u4e09\u6bb5\uff08$L + w \\leq x \\leq R + w$\uff09\u8fd9\u4e00\u6bb5\u5176\u5b9e\u5c31\u662f\u4e00\u6bb5\u5e73\u7684\uff08\u8fd9\u4e5f\u662f\u4e3a\u5565\u5b83\u662f\u65b0\u51fd\u6570\u53d6\u5230\u6700\u5c0f\u503c\u7684\u6bb5\uff09\uff0c\u659c\u7387\u7ef4 $0$\n\n\u7b2c\u56db\u6bb5\uff08$R + w \\leq x$ \uff09\u4f60\u4f1a\u53d1\u73b0\uff0c$g(x) = f(x) + x - w - R$ \u6709\u4e00\u4e2a $+x$ \u3002\u8fd9\u8bf4\u660e\u8fd9\u4e00\u6bb5\u7684\u659c\u7387\u662f $1$ \n\n\u8fd9\u6837\u6211\u4eec\u5c31\u77e5\u9053\u4e86\u65b0\u51f8\u58f3\u4e0e\u539f\u6765\u7684\u51f8\u58f3\u7684\u533a\u522b\uff1a**\u5c06 $L$ \u5de6\u8fb9\u4e00\u6bb5\u5411\u4e0a\u5e73\u79fb\uff0c\u5220\u9664\u53f3\u8fb9\uff0c\u65b0\u589e\u4e24\u4e2a\u62d0\u70b9 $L+w, R+w$ \u5e76\u4e14 $L$  \u5230 $L+w$ \u7684\u659c\u7387\u4e3a $-1$ \uff0c$L+w$ \u5230 $R + w$ \u7684\u659c\u7387\u662f $0$\uff0c$R + w$ \u5f80\u53f3\u7684\u659c\u7387\u662f $1$ **\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u7ed3\u8bba\uff0c\u7136\u540e\u7684\u505a\u6cd5\u5176\u5b9e\u8fd8\u4e0d\u662f\u5f88\u663e\u7136\uff08\u81f3\u5c11\u5bf9\u6211\u6765\u8bf4\uff09\u3002\n\n\u8fd9\u4e2a\u51f8\u58f3\u8fd8\u6709\u4e00\u4e2a\u53ef\u4ee5\u8bc1\u660e\u7684\u6027\u8d28\uff1a\uff08\u4ece\u5de6\u5230\u53f3\uff09\u6bcf\u5f53**\u7ecf\u8fc7\u4e00\u4e2a\u62d0\u70b9**\uff0c\u90a3\u4e48**\u659c\u7387\u4f1a\u589e\u52a0 $1$ **\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u70b9\u5b58\u653e\u51f8\u58f3\u7684\u62d0\u70b9\uff08\u7684\u6a2a\u5750\u6807\uff09\u3002\n\n\u6bcf\u6b21\u5c06\u513f\u5b50\u8282\u70b9\u7684\u51f8\u58f3\u5f39\u51fa\u540e\u9762\u7684\uff08\u4ece\u5927\u5230\u5c0f\uff09\u62d0\u70b9\uff0c\u7136\u540e\u52a0\u5165\u4e24\u4e2a\u65b0\u62d0\u70b9\u3002\u7136\u540e\u5c06\u513f\u5b50\u8282\u70b9\u7684\u62d0\u70b9\u5408\u5e76\u5230\u8be5\u8282\u70b9\u7684\u51f8\u58f3\u4e2d\u3002\n\n\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u652f\u6301\uff1a\u5220\u9664\uff08\u6a2a\u5750\u6807\uff09\u6700\u5927\u7684\u62d0\u70b9\uff1b\u5408\u5e76\u3002\u81ea\u7136\u60f3\u5230**\u53ef\u5e76\u5806**\u3002\n\n\u8fd8\u5269\u4e0b\u51e0\u4e2a\u5c0f\u95ee\u9898\uff1a\n\n1. **\u5b9e\u73b0\u65f6\uff0c\u5982\u4f55\u5f39\u51fa\u62d0\u70b9\u76f4\u5230\u6700\u5c0f\u503c\u7684\u90a3\u4e00\u6bb5**\uff1f\u6700\u53f3\u8fb9\u7684\u90a3\u4e00\u6bb5\u7684\u659c\u7387\u662f\u513f\u5b50\u6570\u91cf\u3002\uff08\u56e0\u4e3a\u6bcf\u5408\u5e76\u4e00\u6b21\u53f3\u7aef\u659c\u7387 ++\uff09 \u6240\u4ee5\u5f39\u51fa\u513f\u5b50\u6570\u91cf\u4e2a\u62d0\u70b9\u5373\u53ef\u3002\n2. **\u6700\u540e\u7684\u7b54\u6848\u5982\u4f55\u8ba1\u7b97\uff1f\u6216\uff1a\u6700\u5c0f\u503c\u90a3\u4e00\u6bb5\u8be5\u5982\u4f55\u8ba1\u7b97\uff1f** $f_1(0)$ \u5f88\u597d\u8ba1\u7b97\uff0c\u4e3a\u6240\u6709\u8fb9\u6743\u7684\u548c\u3002\u6211\u4eec\u53c8\u77e5\u9053\uff0c\u6bcf\u4e00\u4e2a\u62d0\u70b9\u4f7f\u5f97\u659c\u7387++\u3002\u4e8e\u662f\u53ef\u4ee5\u5148\u628a\u53f3\u8fb9\u7684\u70b9\u5f39\u6389\uff08\u513f\u5b50\u4e2a\uff09\uff0c\u7136\u540e\u8ba1\u7b97\u5373\u53ef\n\n\u8fd8\u6709\u4e00\u4e2a\u5f88\u9a9a\u7684\u64cd\u4f5c\uff0c\u5373\u4e00\u79cd\u5feb\u4e50\u7684\u53ef\u5e76\u5806\uff1a\n\n```cpp\nint merge(int x, int y) {\n  if(!x || !y) return x + y; \n  if(vx[x] < vx[y]) swap(x, y); \n  int d = rand() % 2; \n  ch[x][d] = merge(ch[x][d], y); \n  return x; \n}\n```\n\n\u61d2\u4eba\u4e13\u7528\uff0c\u590d\u6742\u5ea6\u5f88\u5bf9\uff08426ms\uff09\u3002\u4f1a\u8bc1\u660e\u590d\u6742\u5ea6\u7684\u53ef\u4ee5\u79c1\u4fe1\u6211\uff0c\u6211\u592a\u83dc\u4e86\u4e0d\u4f1a\u8bc1...\n\n### Code \n\n[\u770b\u4ee3\u7801\u6233\u8fd9\u91cc](https://acfunction.github.io/2019/04/05/BZOJ4585/)\n\n\u770b\u6211\u5199\u7684\u8fd9\u4e48\u8f9b\u82e6\uff0c\u70b9\u4e2a\u8d5e\u5427qaq",
        "postTime": 1554461417,
        "uid": 54745,
        "name": "Gypsophila",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3642 \u3010[APIO2016]\u70df\u706b\u8868\u6f14\u3011"
    },
    {
        "content": "\u9996\u5148 DP \u8bbe $f(u,i)$ \u8868\u793a $u$ \u4e3a\u6839\u7684\u5b50\u6811\u5185\u6240\u6709\u53f6\u5b50\u5230 $u$ \u7684\u7206\u70b8\u65f6\u95f4\u4e3a $i$ \u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u4ee3\u4ef7\u51fd\u6570\u662f\u4e00\u4e2a\u7edd\u5bf9\u503c\u51fd\u6570\uff0c\u53ef\u4ee5\u53d1\u73b0 $f(u,x)$ \u7684\u56fe\u50cf\u662f\u4e00\u4e2a\u4e0b\u51f8\u5305\u3002\n\n\u5c06 $u$ \u7684\u6240\u6709\u513f\u5b50\u5408\u5e76\u5c31\u662f\u51f8\u5305\u76f8\u52a0\u3002\n\n\u52a0\u5165 $u$ \u5230 $\\mathrm{fa}(u)$ \u7684\u8fb9 $c_u$ \u7684\u4ee3\u4ef7\u65f6\uff0c\n\n$$\nf'(u,i)=\\min_{0\\le j\\le i}\\{|c_u-j|+f(u,i-j)|\\}\n$$\n\n\u4e5f\u5c31\u662f\u51fd\u6570 $|c_u-x|$ \u548c $f(u,x)$ \u5f62\u6210\u7684\u51f8\u5305\u7684\u95f5\u53ef\u592b\u65af\u57fa\u548c\uff08\u6ce8\uff1a\u4e24\u4e2a\u70b9\u96c6 $A,B$ \u7684\u95f5\u53ef\u592b\u65af\u57fa\u548c\u4e3a $\\{x+y\\mid x\\in A,y\\in B\\}$\uff09\u3002\n\n\u6a21\u62df\u4e00\u4e0b\u95f5\u53ef\u592b\u65af\u57fa\u548c\u7684\u5f52\u5e76\u8fc7\u7a0b\uff0c\u5728\u8fd9\u91cc\u53ea\u9700\u8981\u5c06 $f(u,x)$ \u4e2d\u659c\u7387\u4e3a $0$ \u7684\u7ebf\u6bb5\u5411\u540e\u5e73\u79fb\uff0c\u524d\u9762\u63d2\u5165\u5411\u91cf $(c_u,-c_u)$\uff0c\u540e\u9762\u53ea\u4fdd\u7559\u4e00\u6761\u659c\u7387\u4e3a $1$ \u7684\u5c04\u7ebf\u3002\n\n\u5177\u4f53\u5b9e\u73b0\uff0c\u7528\u62d0\u70b9\u8868\u793a\u6cd5\u53ef\u4ee5\u65b9\u4fbf\u5730\u5c06\u4e24\u4e2a\u51f8\u5305\u76f8\u52a0\uff0c\u7528\u53ef\u5e76\u5806\u7ef4\u62a4\u51f8\u5305\u7684\u6240\u6709\u62d0\u70b9\uff0c\u6bcf\u4e2a\u62d0\u70b9\u540c\u65f6\u4ee3\u8868\u540e\u9762\u7ebf\u6bb5\u659c\u7387 $+1$\u3002\n\n\u6bcf\u6b21\u5408\u5e76\u5b50\u6811\u6ce8\u610f\u7ed3\u5c3e\u53ea\u4fdd\u7559\u4e00\u4e2a\u659c\u7387\u4e3a $+1$ \u7684\u5c04\u7ebf\u3002\n\n\u6700\u540e\u53d6\u659c\u7387 $0$ \u5904\u7684\u503c\uff0c\u53ef\u4ee5\u7528\u51f8\u5305\u5f00\u5934\u7684\u70b9\u503c $\\sum_i c_i$ \u51cf\u53bb\u6bcf\u4e2a\u62d0\u70b9\u7684\u6a2a\u5750\u6807\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n\n// \u8fd9\u662f\u4e2a\u81ea\u9002\u5e94\u7684\u5de6\u504f\u6811\uff0c\u4e0d\u7528\u8bb0 dist\nstruct Node {\n    int64_t pos;\n    Node *ls, *rs;\n    \n    Node(int64_t v) : pos(v), ls{}, rs{} {}\n};\n\nNode *merge(Node *x, Node *y) {\n    if (!x) return y;\n    if (!y) return x;\n    if (x->pos < y->pos) std::swap(x, y);\n    x->rs = merge(x->rs, y);\n    std::swap(x->ls, x->rs);\n    return x;\n}\n\nvoid pop(Node *&x) {\n    x = merge(x->ls, x->rs);\n}\n\nint main() {\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n\n    int n, m;\n    std::cin >> n >> m;\n    std::vector<int> fa(n + m), c(n + m), son(n + m);\n    for (int i = 1; i < n + m; ++i) {\n        std::cin >> fa[i] >> c[i];\n        --fa[i];\n        ++son[fa[i]];\n    }\n\n    std::vector<Node *> f(n + m);\n    for (int u = n + m - 1; u > 0; --u) {\n        int64_t l = 0;\n        int64_t r = 0;\n        if (u < n) {\n            --son[u];\n            while (son[u]--) pop(f[u]);\n            r = f[u]->pos;\n            pop(f[u]);\n            l = f[u]->pos;\n            pop(f[u]);\n        }\n        // [l, r] \u5c31\u662f\u659c\u7387\u4e3a 0 \u7684\u7ebf\u6bb5\n        f[u] = merge(f[u], merge(new Node(l + c[u]), new Node(r + c[u])));\n        f[fa[u]] = merge(f[fa[u]], f[u]);\n    }\n\n    while (son[0]--) pop(f[0]);\n    int64_t ans = std::accumulate(c.begin(), c.end(), 0ll);\n    while (f[0]) {\n        ans -= f[0]->pos;\n        pop(f[0]);\n    }\n    std::cout << ans << '\\n';\n\n    return 0;\n}\n```\n\n",
        "postTime": 1639141431,
        "uid": 52243,
        "name": "RenaMoe",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3642 [APIO2016]\u70df\u706b\u8868\u6f14"
    },
    {
        "content": "\u8d85\u795e\uff01\uff01\uff01\u6839\u672c\u60f3\u4e0d\u5230\u554a\uff01\n\n\u6211\u53ef\u662f\u7406\u89e3\u4e86\u597d\u4e45\u597d\u4e45\u7684\u55b5\u545c\u3002\u3002\u3002(\u03c3-`\u0434\uff65\u00b4)\n\n\u9898\u89e3\u6bd4\u4ee3\u7801\u8fd8\u957f.jpg\n\n\n```cpp\n/*\n*\t\u4ee4f(x)\u8868\u793a\u5c06\u67d0\u4e2a\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6240\u6709\u53f6\u5b50\u5230\u5b83\u7684\u8ddd\u79bb\u7f6e\u4e3ax\u7684\u6700\u5c0f\u4ee3\u4ef7\uff1b\n*\t\u53d1\u73b0\u5b83\u662f\u4e00\u4e2a\u4e0b\u51f8\u51fd\u6570\uff0c\u5e76\u4e14\u662f\u7ebf\u6027\u7684\uff0c\u5373\u4e00\u6b21\u51fd\u6570\uff1b\n*\t\u5f62\u8c61\u5730\u7406\u89e3\u4e00\u4e0b\uff0c\u6700\u5c0f\u503c\u5de6\u8fb9\u7684\u90e8\u5206\uff0c\u5927\u90e8\u5206\u662f\u7531\u539f\u6765\u7684\u957f\u5ea6\u51cf\u53bb\u503c\u5f97\u5230\uff1b\n*\t\u6700\u5c0f\u503c\u53f3\u8fb9\u7684\u90e8\u5206\uff0c\u5927\u90e8\u5206\u662f\u7531\u539f\u6765\u7684\u957f\u5ea6\u52a0\u4e0a\u503c\u5f97\u5230\uff1b\n*\t\u8003\u8651\u4e00\u4e2a\u70b9u\uff0c\u4ece\u6240\u6709\u513f\u5b50v\u8f6c\u79fb\u8fc7\u6765\uff1b\n*\t\u8fc7\u7a0b\u5206\u4e24\u6b65\uff1a\n*\t<1> \u5c06\u6240\u6709v\u7684\u51f8\u5305\u52a0\u4e0au-v\u8fd9\u6761\u8fb9\uff1b\n*\t<2> \u5c06\u52a0\u5b8c\u8fb9\u7684\u51f8\u5305\u5408\u5e76\uff1b\n*\t\u5047\u8bbe\u73b0\u5728\u8981\u52a0\u4e00\u6761\u8fb9w\uff0cf(x)\u5728x\u5c5e\u4e8e[L,R]\u662f\u53d6\u5230\u6700\u5c0f\u503c\uff0c\u8981\u4ecef(x)\u8f6c\u79fb\u5230f'(x)\uff1b\n*\t\u5206\u56db\u79cd\u60c5\u51b5\uff1a\n*\t+================================================================+\n*\t1.x<=L\t\t\tf'(x)=f(x)+w;\n*\t\u539f\u6765\u8fd9\u90e8\u5206\u90fd\u662f\u51cf\u53bb\u503c\u5f97\u5230\uff0c\u73b0\u5728\u52a0\u4e86\u4e00\u6761\u8fb9\u4e4b\u540e\u4ecd\u8981\u5f97\u5230\u8fd9\u4e2a\u503cx\uff1b\n*\t\u6240\u4ee5\u4e5f\u5fc5\u987b\u8981\u51cf\u53bb\u503c\u624d\u80fd\u6ee1\u8db3\uff0c\u6545\u76f4\u63a5\u51cf\u53bbw\uff0c\u5c06\u8fd9\u6761\u8fb9\u53d8\u4e3a0\uff1b\n*\t2.L<=x<=L+w\t\tf'(x)=f(L)+w-(x-L)\n*\t\u8fd9\u4e00\u6bb5\u662f\u4ecex=L\u5f00\u59cb\u7684\u659c\u7387\u4e3a-1\u7684\u4e00\u6b21\u51fd\u6570\uff1b\n*\t\u7531\u4e8e\u4e4b\u524d\u5c06\u8fd9\u6761\u8fb9\u51cf\u4e3a0\u4e86\uff0c\u73b0\u5728\u4e00\u70b9\u70b9\u52a0\u56de\u53bb\uff0c\u76f8\u5e94\u7684\u4ee3\u4ef7\u5c31\u9010\u6e10\u51cf\u5c111\uff1b\n*\t3.L+w<=x<=R+w\tf'(x)=f(L)\n*\t\u5c06\u539f\u5148\u7684\u53d6\u5230\u6700\u5c0f\u503c\u7684\u90e8\u5206\u8f6c\u79fb\u5230\u4e86\u8fd9\u4e00\u6bb5\uff1b\n*\t4.R+w<=x\t\tf'(x)=f(L)+(x-R)-w\n*\t\u8fd9\u4e00\u6bb5\u662f\u4ecex=R+w\u5f00\u59cb\u7684\u659c\u7387\u4e3a1\u7684\u4e00\u6b21\u51fd\u6570\uff1b\n*\t\u539f\u56e0\u662f\u5230\u4e86\u8fd9\u91cc\u4ee5\u540e\uff0c\u6bcf\u6b21\u53ea\u8981\u5728w\u8fd9\u6761\u8fb9\u4e0a+1\u5373\u53ef\uff1b\n*\t+================================================================+\n*\t\u603b\u7ed3\u4e00\u4e0b\u5373\uff0c\u5c06[L,R]\u4e00\u6bb5\u5411\u53f3\u5e73\u79fb\uff0c[0,L]\u4e00\u6bb5\u5411\u4e0a\u5e73\u79fb\uff1b\n*\t\u4e2d\u95f4\u63d2\u5165\u4e00\u6bb5\u659c\u7387\u4e3a-1\u7684\u7ebf\u6bb5\uff0c\u518d\u5c06\u53f3\u8fb9\u6539\u4e3a\u659c\u7387\u4e3a1\u7684\u76f4\u7ebf\uff1b\n*\t\u5408\u5e76\u64cd\u4f5c\u53ea\u8981\u5c06\u51fd\u6570\u76f8\u52a0\u5373\u53ef\uff1b\n*\t\u8003\u8651\u600e\u4e48\u7ef4\u62a4\uff1a\n*\t\u4e0d\u5931\u4e00\u822c\u6027\uff0c\u8ba4\u4e3a\u6bcf\u4e00\u4e2a\u62d0\u70b9\u90fd\u80fd\u4f7f\u659c\u7387+1\uff1b\n*\t///\u89c2\u5bdf///\uff1a\n*\t- \u6bcf\u6b21\u52a0\u8fb9\u540e\uff0c\u4f1a\u8ba9\u51f8\u5305\u6700\u53f3\u7aef\u659c\u7387\u4e3a1\uff0c\u5373\u4e00\u6b21\u5408\u5e76\u540e\u6700\u53f3\u7aef\u659c\u7387\u5373\u4e3a\u513f\u5b50\u4e2a\u6570\uff1b\n*\t- \u51f8\u5305\u5de6\u8fb9\u4e00\u6bb5\u501f\u636e\u5df2\u77e5\uff0c\u5373f(0)=\u8fb9\u6743\u548c\uff1b\n*\t\u636e\u6b64\u63a8\u7b97\u51f8\u5305\u8868\u8fbe\u5f0f\uff1a\n*\t\u8bbe\u6b64\u65f6\u62d0\u70b9\u4e2a\u6570\u4e3ap\uff0c\u6839\u7684\u513f\u5b50\u4e2a\u6570\u4e3ad\uff0c\u603b\u8fb9\u6743\u548c\u4e3as\uff1b\n*\t\u5219f(x)\u57280\u5904\u7684\u8868\u8fbe\u5f0f\u4e3a\uff1af(x)=-(d-p)*x+s\uff1b\n*\t\u4ece\u5c0f\u5230\u5927\u626b\u63cf\u6bcf\u4e2a\u62d0\u70b9\u5c31\u80fd\u5f97\u5230\u6574\u4e2a\u51f8\u5305\u7684\u8868\u8fbe\u5f0f\uff1b\n*\t\u6211\u4eec\u73b0\u5728\u53ea\u5173\u5fc3\u62d0\u70b9\u7684\u6a2a\u5750\u6807\u4f4d\u7f6e\uff1b\n*\t\u8003\u8651\u7528\u53ef\u5408\u5e76\u5927\u6839\u5806\u5b58\u50a8\u62d0\u70b9\uff1b\n*\t\u4e8e\u662f <1> \u5c31\u53d8\u6210\u4e86\uff1a\u4ece\u5806\u4e2d\u5f39\u51fa\u70b9\u76f4\u5230\u659c\u7387\u4e3a0\uff0c\u518d\u5c06[L,R]\u53f3\u79fb\u4ee5\u540e\u7684\u4e24\u4e2a\u62d0\u70b9\u52a0\u5165\uff1b\n*\t<2> \u5c31\u76f4\u63a5\u5408\u5e76\u5373\u53ef\uff1b\n*\t\u6700\u540e\u8ba1\u7b97\u7b54\u6848\u53ea\u9700\u627e\u5230\u659c\u7387\u4e3a0\u7684\u90a3\u4e00\u6bb5\u8ba1\u7b97\u4ee3\u4ef7\u5373\u53ef\uff1b\n*\t\u795e\u9898\u554a\uff01\n*/\n#include<bits/stdc++.h>\n#define rep(i, x, y) for(int i = (x); i <= (y); i++)\n#define per(i, x, y) for(int i = (x); i >= (y); i--)\n#define N 600010\n#define ll long long\nusing namespace std;\nint n, m, tot, fa[N], w[N], d[N], rt[N];\nll sum;\nstruct heap {//\u5de6\u504f\u6811\uff0c\u7ef4\u62a4\u5927\u6839\u5806\n\tint l, r, dis; ll v;//v\u5b58\u5f53\u524d\u70b9\u7684\u6a2a\u5750\u6807\u503c\n} tr[N];\ninline int merge(int x, int y) {\n\tif(!x || !y) return x+y;\n\tif(tr[x].v < tr[y].v) swap(x, y);\n\ttr[x].r = merge(tr[x].r, y);\n\tif(tr[tr[x].l].dis < tr[tr[x].r].dis) swap(tr[x].l, tr[x].r);\n\tif(!tr[x].r) tr[x].dis = 0; else tr[x].dis = tr[tr[x].r].dis+1;\n\treturn x;\n}\ninline int pop(int x) { return merge(tr[x].l, tr[x].r); }\nint main() {\n\tscanf(\"%d%d\", &n, &m);\n\trep(i, 2, n+m) {\n\t\tscanf(\"%d%d\", &fa[i], &w[i]);\n\t\tsum += w[i]; d[fa[i]] ++;//d[]\u513f\u5b50\u4e2a\u6570\uff0csum\u8fb9\u6743\u548c\n\t}\n\tper(i, n+m, 2) {\n\t\tll l = 0, r = 0;//l,r\u4fdd\u5b58\u5f53\u524d\u7684\u659c\u7387\u4e3a0\u7684\u4e00\u6bb5\n\t\tif(i <= n) {\n\t\t\twhile(--d[i]) rt[i] = pop(rt[i]);//\u4e0d\u505c\u5f39\u51fa\u6700\u5927\u7684\u70b9\uff0c\u76f4\u5230\u659c\u7387\u4e3a0\uff1b\u70b9\u6570\u521a\u597d\u662f\u513f\u5b50\u6570\n\t\t\tr = tr[rt[i]].v; rt[i] = pop(rt[i]);\n\t\t\tl = tr[rt[i]].v; rt[i] = pop(rt[i]);\n\t\t}\n\t\ttr[++tot].v = l+w[i]; tr[++tot].v = r+w[i];\n\t\trt[i] = merge(rt[i], merge(tot, tot-1));\n\t\trt[fa[i]] = merge(rt[fa[i]], rt[i]);//\u5408\u5e76\u513f\u5b50\n\t}\n\twhile(d[1]--) rt[1] = pop(rt[1]);\n\twhile(rt[1]) { sum -= tr[rt[1]].v; rt[1] = pop(rt[1]); }\n\tprintf(\"%lld\\n\", sum);\n\treturn 0;\n}\n```",
        "postTime": 1520443336,
        "uid": 19722,
        "name": "fy0123",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3642 \u3010[APIO2016]\u70df\u706b\u8868\u6f14\u3011"
    },
    {
        "content": "\u8bbe $dp[u][k]$ \u8868\u793a\u5b50\u6811\u4e2d\u6240\u6709\u53f6\u5b50\u90fd\u8ddd\u79bb\u81ea\u5df1\u7684\u7236\u4eb2\u8282\u70b9\u957f\u5ea6\u4e3a $k$ \u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\uff08\u5b9a\u4e49 $1$ \u53f7\u8282\u70b9\u7684\u7236\u4eb2\u8282\u70b9\u4e3a $0$\uff0c\u8ddd\u79bb\u4e3a $0$\uff09\n\n\u4e0d\u96be\u53d1\u73b0\u6709 $dp[u][k]=\\min_{i=0}^{k}(|i+w-k|+(\\sum_{v\\in son(u)}dp[v][i]))$\u3002\u5176\u4e2d $w$ \u8868\u793a\u7236\u4eb2\u5230\u81ea\u5df1\u7684\u8fb9\u6743\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\uff0c\u82e5 $F_u(x)=dp[u][x]$\uff0c\u90a3\u4e48 $F_u$ \u662f\u4e00\u4e2a\u5206\u6bb5\u4e00\u6b21\u51fd\u6570\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u5355\u8c37\u51fd\u6570\u3002\n\n\u5bf9\u4e8e\u540e\u9762\u7684 $\\sum$ \u53ef\u4ee5\u770b\u505a\u662f\u5c06\u82e5\u5e72\u5206\u6bb5\u51fd\u6570\u52a0\u8d77\u6765\u3002\u5c06\u5206\u6bb5\u51fd\u6570\u6c42\u5bfc\u540e\u4f1a\u5355\u8c03\u4e0d\u589e\uff0c\u52a0\u8d77\u6765\u540e\u4e00\u5b9a\u4ecd\u7136\u5355\u8c03\u4e0d\u589e\u3002\n\n\u5bf9\u4e8e\u524d\u9762\u7684\u52a0\u7edd\u5bf9\u503c\uff0c\u53ef\u4ee5\u628a\u5c06\u8fb9\u6743\u53d8\u957f\u548c\u5c06\u8fb9\u6743\u53d8\u77ed\u5206\u5f00\u8ba8\u8bba\u3002\n\n\u5c06\u8fb9\u6743\u53d8\u77ed\u7c7b\u4f3c\u4e8e $G[k]=\\min_{i=k}^{k+w}(F[i]+(i-k))$\u3002\n\n\u5c06\u8fb9\u6743\u53d8\u957f\u7c7b\u4f3c\u4e8e $G[k]=\\min_{i=0}^{k}(F[i]+(k-i))$\u3002\n\n\u663e\u7136\u53ef\u4ee5\u5148\u53d8\u957f\u518d\u53d8\u77ed\uff0c\u8fd9\u6837\u662f\u65e0\u6240\u8c13\u7684\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u8fb9\u6743\u53d8\u77ed\u76f8\u5f53\u4e8e\u662f\u5728\u8c37\u70b9\u7684\u524d\u9762\u52a0\u4e86\u4e00\u6bb5\u659c\u7387\u4e3a $1$ \u957f\u5ea6\u4e3a $w$ \u7684\u4e00\u6b21\u51fd\u6570\uff0c\u53d8\u957f\u76f8\u5f53\u4e8e\u662f\u628a\u659c\u7387\u5bf9 $1$ \u53d6 $\\min$\u3002\n\n\u4f7f\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u5206\u6bb5\u51fd\u6570\uff0c\u53ea\u7ef4\u62a4\u5206\u6bb5\u51fd\u6570\u7684\u659c\u7387\u4ee5\u53ca\u5176\u5728 $0$ \u5904\u7684\u503c\uff08\u5176\u5b9e\u5c31\u662f\u8fb9\u6743\u4e4b\u548c\uff09\uff0c\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\u4e0d\u77e5\u9053 16 \u5e74\u7684\u673a\u5b50\u80fd\u4e0d\u80fd\u8dd1\u3002\n\n\u4f46\u662f\u5f53\u5206\u6bb5\u51fd\u6570\u7279\u6b8a\u65f6\u662f\u53ef\u4ee5\u4f7f\u7528\u5806\u7ef4\u62a4\u5206\u6bb5\u70b9\u7684\uff0c\u8868\u793a\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u5206\u6bb5\u70b9\u659c\u7387\u5c31\u51cf\u5c0f $1$\u3002\n\n\u5f88\u663e\u7136\u4e00\u6b21\u64cd\u4f5c\u7ed3\u675f\u540e\u7684\u5206\u6bb5\u51fd\u6570\u6700\u53f3\u8fb9\u90a3\u4e2a\u5206\u6bb5\u70b9\u4ee3\u8868\u7684\u662f\u53f3\u8fb9\u659c\u7387\u4e3a $1$\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u4f7f\u7528\u53ef\u5e76\u5806\u7ef4\u62a4\u5206\u6bb5\u70b9\u7684\u6700\u5927\u503c\uff0c\u6bcf\u6b21\u5f39\u51fa\u6700\u5927\u7684\u4e24\u4e2a\u7136\u540e\u5c06\u5f39\u51fa\u503c\u52a0\u4e0a $w$ \u540e\u518d\u63d2\u56de\u53bb\u5373\u662f\u5c06\u8fb9\u6743\u53d8\u77ed\u7684\u64cd\u4f5c\u3002\n\n\u7136\u540e\u518d pop \u513f\u5b50\u6570\u91cf-1 \u4e2a\u5206\u5272\u70b9\u5373\u53ef\u4f7f\u6700\u53f3\u4fa7\u7684\u659c\u7387\u4e3a $1$\u3002\n\n\u53ea\u9700\u8981\u5199\u5de6\u504f\u6811\uff0c\u4e14\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n```cpp\n#include<cstdio>\n#include<cctype>\nnamespace SOLVE{\n\tinline int read(){\n\t\tint n(0);char s;while(!isdigit(s=getchar()));while(n=n*10+(s&15),isdigit(s=getchar()));return n;\n\t}\n\ttypedef long long ll;\n\tconst int M=3e5+5;\n\tint n,ege,h[M];int tot,d[M<<1],ls[M<<1],rs[M<<1];ll w[M<<1];\n\tstruct Edge{\n\t\tint v,nx;ll w;\n\t}e[M];\n\tinline void swap(int&a,int&b){\n\t\tint c=a;a=b;b=c;\n\t}\n\tinline void Add(const int&u,const int&v,const ll&w){\n\t\te[++ege]=(Edge){v,h[u],w};h[u]=ege;\n\t}\n\tinline int merge(const int&q,const int&p){\n\t\tif(!q||!p)return q|p;if(w[q]<w[p])return merge(p,q);\n\t\trs[q]=merge(rs[q],p);if(d[rs[q]]>d[ls[q]])swap(ls[q],rs[q]);d[q]=d[rs[q]]+1;return q;\n\t}\n\tinline int DFS(const int&u,const int&V){\n\t\tint rt(0),cnt(-1);for(int E=h[u];E;E=e[E].nx)rt=merge(rt,DFS(e[E].v,e[E].w)),++cnt;\n\t\tif(~cnt)while(cnt--)rt=merge(ls[rt],rs[rt]);if(u==1)return rt;\n\t\tconst ll&X=w[rt]+V;rt=merge(ls[rt],rs[rt]);const ll&Y=w[rt]+V;rt=merge(ls[rt],rs[rt]);\n\t\tw[++tot]=X;d[tot]=1;rt=merge(rt,tot);w[++tot]=Y;d[tot]=1;rt=merge(rt,tot);return rt;\n\t}\n\tinline void main(){\n\t\tll sum(0);n=read()+read();for(int f,w,i=2;i<=n;++i)f=read(),w=read(),Add(f,i,w),sum+=w;\n\t\tint rt=DFS(1,0);while(rt=merge(ls[rt],rs[rt]))sum-=w[rt];printf(\"%lld\",sum);\n\t}\n}\nsigned main(){\n\tSOLVE::main();\n}\n```",
        "postTime": 1663916783,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "DP+\u6570\u5b66+\u6570\u636e\u7ed3\u6784 \u5de6\u504f\u6811+\u51f8\u51fd\u6570 P3642\u9898\u89e3"
    },
    {
        "content": "\u8bbe $f_i(x)$ \u4e3a\u4ee5\u8282\u70b9 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u90fd\u4ee5\u65f6\u523b $x$ \u7206\u70b8\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u53d1\u73b0\u5176\u4e3a\u4e00\u4e2a\u4e0b\u51f8\u7684\u5206\u6bb5\u51fd\u6570\uff0c\u5373\u4e3a\u4e00\u4e2a\u4e0b\u51f8\u5305\u3002\n\n\u8003\u8651\u4e00\u4e2a\u8282\u70b9\u52a0\u4e0a\u5176\u4e0e\u7236\u8282\u70b9\u7684\u8fb9\u540e\u51fd\u6570\u7684\u53d8\u5316\uff0c\u8bbe\u539f\u51fd\u6570\u7684\u6700\u5c0f\u503c\u4e3a $f_{\\min}$\uff0c\u53d6\u5230\u6700\u5c0f\u503c\u7684\u533a\u95f4\u4e3a $[l,r]$\uff0c\u4e0e\u7236\u8282\u70b9\u7684\u8fb9\u7684\u8fb9\u6743\u4e3a $v$\uff0c\u5f97\uff1a\n$$\n{f}'(x) = \n\\begin{cases}\nf(x) + v & x \\leqslant l \\\\\nf_{\\min} + l + v - x  & l < x \\leqslant l + v \\\\\nf_{\\min} & l + v < x \\leqslant r + v \\\\\nf_{\\min} + x - r - v & r + v < x\n\\end{cases}\n$$\n\u53d1\u73b0\u548c\u539f\u51fd\u6570\u5bf9\u6bd4\uff0c\u52a0\u4e0a\u8fd9\u6761\u8fb9\u540e\uff0c\u51fd\u6570\u7684\u53d8\u5316\u4e3a\u5411\u4e0a\u5e73\u79fb\u5de6\u8fb9\u7684\u4e00\u6bb5\uff0c\u7136\u540e\u52a0\u5165\u4e09\u6bb5\u659c\u7387\u5206\u522b\u4e3a $-1,0,1$ \u7684\u51fd\u6570\u3002\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\uff0c\u5176\u6240\u6709\u513f\u5b50\u7684\u65b0\u51fd\u6570\u5408\u5e76\u540e\u7684\u51fd\u6570\uff0c\u5373\u4e3a\u8be5\u8282\u70b9\u5bf9\u5e94\u7684\u51fd\u6570\u3002\u56e0\u4e3a\u662f\u5408\u5e76\u8d77\u6765\u7684\uff0c\u6240\u4ee5\u8be5\u5206\u6bb5\u51fd\u6570\u7684\u6bcf\u4e00\u6bb5\u7684\u659c\u7387\u7684\u5dee\u4e3a $1$\uff0c\u6700\u5c0f\u503c\u53f3\u8fb9\u7684\u51fd\u6570\u6bb5\u6570\u4e3a\u5176\u513f\u5b50\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e\u51fd\u6570\uff0c\u53ea\u9700\u7ef4\u62a4\u5176\u7aef\u70b9\u4f4d\u7f6e\u5373\u53ef\uff0c\u56e0\u4e3a\u9700\u8981\u5408\u5e76\u548c\u5220\u9664\uff0c\u6240\u4ee5\u7528\u53ef\u5e76\u5806\u6765\u7ef4\u62a4\uff0c\u6211\u8fd9\u91cc\u7528\u7684\u662f\u5de6\u504f\u6811\u3002\u5f97 $f_{root}(0)$ \u4e3a\u6240\u6709\u8fb9\u6743\u548c\uff0c\u7ed3\u5408\u7aef\u70b9\u4f4d\u7f6e\uff0c\u5373\u53ef\u8ba1\u7b97\u6700\u5c0f\u503c\u3002\n\n$code:$\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 600010\nusing namespace std;\ntypedef long long ll;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nint n,m,tot;\nll ans;\nint fa[maxn],rt[maxn],ls[maxn],rs[maxn],dis[maxn],son[maxn];\nll v[maxn],val[maxn];\nint merge(int x,int y)\n{\n    if(!x||!y) return x+y;\n    if(val[x]<val[y]) swap(x,y);\n    rs[x]=merge(rs[x],y);\n    if(dis[ls[x]]<dis[rs[x]]) swap(ls[x],rs[x]);\n    dis[x]=dis[rs[x]]+1;\n    return x;\n}\nint del(int x)\n{\n    return merge(ls[x],rs[x]);\n}\nint main()\n{\n    read(n),read(m);\n    for(int i=2;i<=n+m;++i)\n        read(fa[i]),read(v[i]),son[fa[i]]++,ans+=v[i];\n    for(int i=n+m;i>1;--i)\n    {\n        ll l=0,r=0;\n        if(son[i])\n        {\n            for(int j=1;j<son[i];++j) rt[i]=del(rt[i]);\n            l=val[rt[i]],rt[i]=del(rt[i]);\n            r=val[rt[i]],rt[i]=del(rt[i]);\n        }\n        val[++tot]=l+v[i],rt[i]=merge(rt[i],tot);\n        val[++tot]=r+v[i],rt[i]=merge(rt[i],tot);\n        rt[fa[i]]=merge(rt[fa[i]],rt[i]);\n    }\n    while(son[1]--) rt[1]=del(rt[1]);\n    while(rt[1]) ans-=val[rt[1]],rt[1]=del(rt[1]);\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1596721323,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3642 \u3010[APIO2016]\u70df\u706b\u8868\u6f14\u3011"
    },
    {
        "content": "# \u89e3\u6790\n\u611f\u89c9\u662f\u5de6\u504f\u6811\u7684\u795e\u9898\u4e86.\n\n\u9996\u5148\u6709\u4e00\u4e2a\u6bd4\u8f83\u663e\u7136\u7684\u7ed3\u8bba\uff0c\u4e00\u4e2a\u5408\u6cd5\u7684\u65b9\u6848\u4e2d\uff0c\u4e24\u4e2a\u53f6\u5b50\u5230\u5b83\u4eec $\\text{lca}$ \u7684\u8ddd\u79bb\u5fc5\u987b\u76f8\u7b49.\n\n\u8003\u8651\u8bbe\u8ba1 $\\text{dp}$ \uff1a\n\n$f_{i,x}$ \u8868\u793a $i$ \u7684\u5b50\u6811\u4e2d\uff0c\u6240\u6709\u53f6\u5b50\u5230\u5b83\u7684\u8ddd\u79bb\u4e3a $x$ \u7684\u6700\u5c0f\u4ee3\u4ef7.\n\n\u8003\u8651\u8fd9\u4e2a\u51fd\u6570\u5982\u4f55\u5411\u7236\u4eb2\u5408\u5e76.\n\u8bbe\u4e00\u4e2a\u7ed3\u70b9\u5230\u7236\u4eb2\u7684\u8ddd\u79bb\u4e3a $c_i$ .\n\u6734\u7d20 $\\text{dp}$ \uff0c\u5c31\u6709\uff1a\n$$f_{i,x}=\\sum_{j\\in son_i}\\min_{v\\geq0}^xf_{j,x-v}+|c_j-v|$$\n\u8fd9\u73a9\u610f\u663e\u7136\u590d\u6742\u5ea6\u7206\u70b8\u554a...\n\n------\n\u6362\u4e2a\u89d2\u5ea6\uff0c\u8003\u8651 $f$ \u51fd\u6570\u672c\u8eab\u7684\u6027\u8d28.  \n\u4e0d\u96be\u60f3\u5230\uff0c\u539f\u6765\u7684\u51fd\u6570\u5e94\u8be5\u662f\u4e00\u4e2a\u4e0b\u51f8\u7684\u7ebf\u6027\u51fd\u6570.  \n$son_i$ \u7684\u51fd\u6570\u5982\u4f55\u5411 $i$ \u5408\u5e76\uff1f  \n\u4e00\u5f00\u59cb\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f3c\u4e4e\u5c31\u662f\u7b80\u5355\u7684\u6240\u6709\u5b50\u8282\u70b9\u51fd\u6570\u76f8\u52a0\u5408\u6210.  \n\u5e76\u4e14\uff0c\u7531\u4e8e $c_{i}$ \u7684\u5b58\u5728\uff0c\u8fd9\u4e2a\u51fd\u6570\u80af\u5b9a\u8981\u5f80\u53f3\u79fb $c_i$ .  \n\u5047\u8bbe\u79fb\u52a8\u5b8c\u957f\u8fd9\u6837\uff1a\n\n![\u8bf7\u6dfb\u52a0\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/eec4035e7b694f419a3300467b2f8c40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2luZF9fd2hpc3Blcg==,size_12,color_FFFFFF,t_70,g_se,x_16)\n\n\u4f46\u662f\uff0c\u8003\u8651\u5230\u6709 $i$ \u8fde\u5411 $fa_i$ \u7684\u8fb9\uff0c\u6709\u4e9b\u4fee\u6539\u53ef\u4ee5\u5728\u8fd9\u91cc\u4e00\u8d77\u6539\uff0c\u5c31\u4e0d\u5fc5\u5404\u81ea\u9ebb\u70e6\u4e86\uff0c\u6240\u4ee5\u80af\u5b9a\u51fd\u6570\u4f1a\u53d8\u5316\uff0c\u51c6\u786e\u7684\u8bf4\uff0c\u53d8\u5f97\u66f4\u597d.  \n\n\u8bbe\u659c\u7387\u4e3a $0$ \u7684\u533a\u95f4\u4e3a $[L,R]$ .  \n\u7136\u540e\u6211\u4eec\u53d1\u73b0 $R$ \u53f3\u4fa7\u8fd8\u6709\u597d\u591a\u659c\u7387\u5927\u4e8e $1$ \u7684\u5730\u65b9.  \n\u5927\u6982\u7684\u5b9e\u9645\u610f\u4e49\u5c31\u662f\u6bcf\u4e2a\u513f\u5b50\u90fd\u5404\u81ea\u4fee\u6539\uff0c\u8fd9\u5c31\u5f88\u4e8f.  \n\u6240\u4ee5\u5bf9\u4e8e $f_{i,x}$ \u6211\u4eec\u5e72\u8106\u5728\u5148\u5168\u90e8\u8c03\u6574\u6210\u8ddd\u79bb\u4e3a $R$\uff0c\u652f\u4ed8 $f_{i,R}$ \u7684\u4ee3\u4ef7\uff0c\u518d\u628a\u5f53\u524d\u7ed3\u70b9\u8fde\u5411\u7236\u4eb2\u7684\u8fb9\u6743\u503c\u589e\u5927 $x-R$ .\n\u8fd9\u6837\u5c31\u628a $R$ \u53f3\u4fa7\u7684\u659c\u7387\u5168\u90fd\u53d8\u6210\u4e86 $1$ .\n\u53d8\u6210\u8fd9\u6837\uff1a  \n\n![\u8bf7\u6dfb\u52a0\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/1a88c1c008ca486fb216a114074e4642.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2luZF9fd2hpc3Blcg==,size_20,color_FFFFFF,t_70,g_se,x_16)\n\n\n\n\u53e6\u4e00\u8fb9\u53ef\u4ee5\u7c7b\u4f3c\u7684\u641e\u5417\uff1f\n\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u6709\u4e2a\u95ee\u9898...\n**\u8fb9\u7684\u6743\u503c\u975e\u8d1f\uff01**\n\u6240\u4ee5\u6211\u4eec\u659c\u7387\u4e3a $1$ \u7684\u533a\u95f4\u5f80\u5de6\u589e\u52a0\u7684\u957f\u5ea6\u6700\u591a\u4e3a $c_i$ .\n\u540e\u9762\u7684\u51fd\u6570\u5c31\u5f80\u5de6\u987a\u5ef6 $c_i$ .\n\u4e5f\u5c31\u662f\u53d8\u6210\uff1a\n\n![\u8bf7\u6dfb\u52a0\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/2e90dda2055c4787959bb9cc371b7bf4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2luZF9fd2hpc3Blcg==,size_17,color_FFFFFF,t_70,g_se,x_16)\n\n\n\u522b\u5fd8\u4e86\uff0c\u672c\u6765\u8fd9\u4e2a\u51fd\u6570\u662f\u6574\u4f53\u53f3\u79fb $c_i$ .\n\u8fd9\u91cc\u5de6\u8fb9\u7684\u659c\u7387\u5927\u4e8e1\u7684\u533a\u95f4\u53c8\u5f80\u5de6\u79fb\u52a8\u4e86 $c_i$ .\n\u6240\u4ee5\u5176\u5b9e\u6839\u672c\u4f4d\u7f6e\u6ca1\u53d8.\n\n\u603b\u7ed3\u4e00\u4e0b\u7684\u8bdd\uff0c\u8fd9\u4e2a\u51fd\u6570\u5408\u5e76\u5230\u7236\u4eb2\u540e\uff0c\u5c31\u662f **\u628a\u659c\u7387\u4e3a $0$ \u7684\u533a\u95f4 $[L,R]$ \u53f3\u79fb $c_i$ \uff0c\u628a $R$ \u53f3\u8fb9\u7684\u51fd\u6570\u659c\u7387\u5168\u6539\u4e3a $1$ \uff0c\u659c\u7387\u4e3a $0$ \u7684\u533a\u95f4\u5f80\u53f3\u5ef6\u957f $c_i$ \u8865\u4e0a $L$ \u53f3\u79fb\u7684\u7a7a\u7f3a**. \n\u5b9e\u73b0\u4e0a\uff0c\u5efa\u4e00\u4e2a\u53ef\u5e76\u5806\u7ef4\u62a4\u6240\u6709\u7684\u62d0\u70b9\uff0c\u4ee4\u76f8\u90bb\u62d0\u70b9\u659c\u7387\u5dee\u4e3a $1$ \uff08\u5982\u679c\u4e24\u7aef\u4e4b\u95f4\u659c\u7387\u5dee\u5927\u4e8e $1$ \u5c31\u63d2\u591a\u4e2a\u6a2a\u5750\u6807\u76f8\u540c\u7684\u62d0\u70b9\uff09\uff0c\u90a3\u4e48\u5176\u5b9e\u5c31\u628a $R$  \u53f3\u4fa7\u7684\u6240\u6709\u62d0\u70b9\u5f39\u6389\uff0c\u5e76\u628a $L$ \u548c $R$ \u7684\u5750\u6807\u52a0\u4e0a $c_i$ \u5c31\u884c\u4e86.\n\n\u6700\u540e\u5408\u5e76\u5230\u6839\u4e4b\u540e\uff0c\u6211\u4eec\u53ea\u6709\u62d0\u70b9\u7684\u6a2a\u5750\u6807\uff0c\u5982\u4f55\u6c42\u51fa\u7b54\u6848\uff08\u4e5f\u5c31\u662f $f_{1,L}$ \uff09\u5462\uff1f\n\u6ce8\u610f\u5230\uff0c $f_{1,0}$ \u5176\u5b9e\u5c31\u662f\u6240\u6709\u8fb9\u6743\u4e4b\u548c\uff0c\u80fd\u5f88\u65b9\u4fbf\u7684\u6c42\u51fa\u6765\uff0c\u53c8\u56e0\u4e3a\u6211\u4eec\u77e5\u9053\u76f8\u90bb\u4e24\u4e2a\u7aef\u70b9\u7684\u659c\u7387\u5dee\u5747\u4e3a $1$ \uff0c $[L,R]$ \u7684\u659c\u7387\u4e3a $0$ \uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u5012\u7740\u63a8\u4e00\u904d\u5c31\u884c\u4e86.\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nconst int N=1e6+100;\nconst int mod=1e9+7;\n#define ll long long\nusing namespace std;\ninline ll read() {\n\tll x(0),f(1);char c=getchar();\n\twhile(!isdigit(c)) {if(c=='-')f=-1;c=getchar();}\n\twhile(isdigit(c)) {x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n\treturn x*f;\n}\n\nint n,m;\nint fa[N],fv[N],son[N];\nint rt[N],tot,ls[N],rs[N],dis[N];\nll val[N];\nint merge(int x,int y){\n\t//printf(\"merge x=%d y=%d\\n\",x,y);\n\tif(!x||!y) return x|y;\n\tif(val[x]<val[y]) swap(x,y);\n\trs[x]=merge(rs[x],y);\n\tif(dis[ls[x]]<dis[rs[x]]) swap(ls[x],rs[x]);\n\tdis[x]=dis[rs[x]]+1;\n\treturn x;\n}\ninline int pop(int x){\n\treturn merge(ls[x],rs[x]);\n}\nll sum;\nvoid debug(int x){\n\tif(!x) return;\n\tprintf(\"x=%d ls=%d rs=%d val=%lld\\n\",x,ls[x],rs[x],val[x]);\n\tdebug(ls[x]);debug(rs[x]);\n\treturn;\n}\nint main(){\n\tdis[0]=-1;\n\tn=read();m=read();\n\tfor(int i=2;i<=n+m;i++){\n\t\tfa[i]=read();son[fa[i]]++;sum+=(fv[i]=read());\n\t}\n\tfor(int i=n+m;i>=2;i--){\n\t\tll l(0),r(0);\n\t\t//printf(\"i=%d\\n\",i);\n\t\tif(i<=n){\n\t\t\twhile(--son[i]) rt[i]=pop(rt[i]);\n\t\t\tr=val[rt[i]];rt[i]=pop(rt[i]);\n\t\t\tl=val[rt[i]];rt[i]=pop(rt[i]);\n\t\t\t//printf(\"ok\");\n\t\t}\n\t\tval[++tot]=l+fv[i];val[++tot]=r+fv[i];\n\t\trt[i]=merge(rt[i],merge(tot-1,tot));//printf(\"OK rtfa=%d\\n\",rt[fa[i]]);\n\t\tprintf(\"\\ni=%d:\\n\",i);debug(rt[i]);\n\t\trt[fa[i]]=merge(rt[fa[i]],rt[i]);\n\t}\n\t//debug(rt[1]);\n\twhile(son[1]--){\n\t\trt[1]=pop(rt[1]);\n\t\t//printf(\"\\nrt=%d\\n\",rt[1]);\n\t}\n\twhile(rt[1]){\n\t\tsum-=val[rt[1]];rt[1]=pop(rt[1]);\n\t\t//printf(\"\\nrt=%d\\n\",rt[1]);\n\t}\n\tprintf(\"%lld\\n\",sum);\n}\n/*\n1\n281239\n*/\n```\n",
        "postTime": 1636944514,
        "uid": 449265,
        "name": "wind_whisper",
        "ccfLevel": 10,
        "title": "P3642 \u70df\u706b\u8868\u6f14"
    },
    {
        "content": "\u542c\u5b66\u957f\u8bb2\u7684\u4e00\u9053\u53ef\u5e76\u5806\u795e\u9898\uff0c\u88ab [\u540c\u673a\u623f\u7684\u795e](https://www.luogu.com.cn/user/429573) \u79d2\u4e86\uff0c\u5199\u4e2a\u9898\u89e3\u52a0\u6df1\u4e00\u4e0b\u7406\u89e3\u3002\n\n### \u9898\u610f\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u6bcf\u6761\u8fb9\u6709\u8fb9\u6743\uff0c\u73b0\u5728\u6307\u5b9a\u4e00\u79cd\u4fee\u6539\u8fb9\u6743\u7684\u64cd\u4f5c\uff0c\u5c06\u8fb9\u6743 $x$ \u4fee\u6539\u81f3\u8fb9\u6743 $y$ \u6240\u9700\u8981\u7684\u4ee3\u4ef7\u4e3a $|x - y|$ \uff0c\u5b9a\u4e49\u53f6\u5b50\u7ed3\u70b9\u7684\u6df1\u5ea6\u4e3a\u5176\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u957f\u5ea6\u603b\u548c\uff0c\u73b0\u6c42\u4f7f\u5f97\u6240\u6709\u53f6\u5b50\u7ed3\u70b9\u7684\u6df1\u5ea6\u5747\u76f8\u7b49\u7684\u6700\u5c0f\u4ee3\u4ef7\u603b\u548c\u3002\n\n### \u521d\u6b65\u5206\u6790\n\n\u9996\u5148\uff0c\u8003\u8651\u8fd9\u6837\u4e00\u4e2a dp \u8f6c\u79fb\uff0c\u6211\u4eec\u8003\u8651\u8bbe $dp_{i,j}$ \u4e3a**\u5728\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d**\uff0c\u6240\u6709\u7684\u53f6\u5b50\u7ed3\u70b9\u6df1\u5ea6\u5747 **\u88ab\u7edf\u4e00\u6210 $j$** \u65f6\uff0c\u6240\u9700\u8981\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u6211\u4eec\u5b9a\u4e49\u8282\u70b9 $u$ \u5230\u8282\u70b9 $v$ \u7684\u8fb9\u6743\u4e3a $val(u,v)$ \uff0c\u5219\u6709\u4e00\u4e2a\u663e\u7136\u7684\u8f6c\u79fb\u5982\u4e0b\uff1a\n$$dp_{i,j} = \\sum_{v \\in sons_i} \\min_{k \\leq j}( | val(i,v) - k | + dp_{v,j - k} )$$ \n\u679a\u4e3e\u6240\u6539\u6210\u7684\u8fb9\u6743\uff0c\u4f9d\u7167\u72b6\u6001\u7684\u5b9a\u4e49\u679a\u4e3e\u5373\u53ef\u3002\n\n\u73b0\u5728\uff0c\u5f88\u660e\u663e\u8fd9\u4e2a\u7b97\u6cd5\u662f\u5f88\u52a3\u7684\uff0c\u72b6\u6001\u6570\u548c\u8fb9\u6743\u503c\u57df\u6709\u5173\uff0c\u56e0\u6b64\u8981\u7ee7\u7eed\u4f18\u5316\u3002\n\n### \u8fdb\u4e00\u6b65\u5206\u6790\n\n\u6211\u4eec\u5c06\u8f6c\u79fb\u7684\u8fc7\u7a0b\u5206\u6210\u4e24\u6b65\u6765\u770b\uff1a\n\n1.\u5c06\u5b50\u6811\u4e2d\u7684\u8282\u70b9\u5bf9\u4e8e\u6bcf\u4e2a\u72b6\u6001\u7684\u8f6c\u79fb\u53d6 $\\min$ \u3002\n\n2.\u5c06\u5b50\u6811\u4e2d\u5904\u7406\u597d\u7684\u6700\u5c0f\u503c\u8f6c\u79fb\u5230\u7236\u8282\u70b9\u4e0a\u3002\n\n\u6211\u4eec\u8bbe $g_{i,j}$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u53ea\u4fee\u6539\u5b50\u6811\u4e2d\u7684\u8fb9\u4e0e\u5b50\u6811\u6839\u8282\u70b9\u53ca\u5176\u7236\u8282\u70b9\u6240\u8fde\u7684\u8fb9\u65f6\uff0c\u4f7f\u5f97\u5b50\u6811\u4e2d\u6240\u6709\u53f6\u5b50\u7ed3\u70b9\u7684\u8ddd\u79bb\u5230 $i$ \u7684\u7236\u8282\u70b9\u5747\u4e3a $j$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u8bbe $i$ \u7684\u7236\u8282\u70b9\u4e3a $fa_i$ \u5373\uff1a\n\n$$g_{i,j} = \\min_{0\\leq k\\leq j }(|val(fa_i,i) - k| + dp_{i,j - k})$$\n$$dp_{i,j} = \\sum_{v \\in sons_i} g_{v,j}$$\n\n\u6211\u4eec\u753b\u51fa\u56fe\u50cf\u6765\u89c2\u5bdf\u8f6c\u79fb\u7684\u7279\u70b9\u3002\n\n\u9996\u5148\uff0c\u5bf9\u4e8e\u53f6\u5b50\u7ed3\u70b9 $x$ :\n![](https://cdn.luogu.com.cn/upload/image_hosting/5lnhsx79.png)\n\n\u4e3a\u65b9\u4fbf\u8868\u8ff0\uff0c\u5b9a\u4e49\u51fd\u6570 $dp_i(x)$ \u4e3a $dp_{i,x}$ \u7684\u53d6\u503c\uff0c\n$g_i(x)$ \u4e3a $g_{i,x}$ \u7684\u53d6\u503c\u3002\n\n\u5f88\u663e\u7136\uff0c\u6211\u4eec\u53ea\u80fd\u4fee\u6539\u4e00\u6761\u8fb9\u7684\u6743\u503c\uff0c\u5f88\u663e\u7136\uff0c $g_x(j)$  \u5173\u4e8e $j$ \u7684\u56fe\u50cf\u5c31\u662f\u4e00\u4e2a\u7edd\u5bf9\u503c\u65b9\u7a0b\uff0c\u5176\u4e2d\u4e24\u6bb5\u7684\u659c\u7387\u5206\u522b\u4e3a $1$ \u4e0e $-1$ \uff0c\u5728 $j$ \u4e0e $x$ \u548c $x$ \u7236\u8282\u70b9\u8fde\u8fb9\u7684\u6743\u503c\u76f8\u7b49\u65f6\u53d6\u5230\u6700\u5c0f\u503c $0$ \u3002\n\n\u6211\u4eec\u73b0\u5728\u8981\u8bc1\u660e\u4e00\u4ef6\u4e8b\u60c5\uff1a\u5728\u6bcf\u4e2a\u70b9 $i$ , $dp_i(j)$ \u4e0e $g_i(j)$ \u5173\u4e8e $j$ \u7684\u56fe\u50cf\u5747\u4e3a\u5206\u6bb5\u51fd\u6570\uff0c\u4e14\u6bcf\u6bb5\u659c\u7387\u5355\u8c03\u9012\u589e\u3002\n\n\u6839\u636e\u5f52\u7eb3\u6cd5\uff0c\u6211\u4eec\u5df2\u7ecf\u8bc1\u660e\u4e86\u5bf9\u4e8e\u53f6\u5b50\u7ed3\u70b9 $x$ , $g_{x,j}$ \u6ee1\u8db3\u6761\u4ef6\u3002\n\n\u6613\u77e5\u8f6c\u79fb\u65f6\u659c\u7387\u5747\u4e3a\u6574\u6570\u3002\n\n\u73b0\u5728\uff0c\u5bf9\u4e8e\u8282\u70b9 $i$ \uff0c\u82e5\u5bf9\u4e8e $i$ \u7684\u6240\u6709\u5b50\u8282\u70b9 $v$ \uff0c\u5176 $g_v(j)$ \u7684\u56fe\u50cf\u6ee1\u8db3\u6b64\u89c4\u5f8b\uff0c\u7531\u4e8e $i$ \u7684 $dp_i(j)$ \u5728\u65e0\u8bba $j$ \u7684\u53d6\u503c\u65f6\u5747\u4e3a\u6240\u6709 $g_v(j)$ \u4e4b\u548c\uff0c\u5219 $i$ \u7684 $dp_i(j)$ \u503c\u5fc5\u7136\u4e5f\u6ee1\u8db3\u89c4\u5f8b\uff0c\u8fd9\u662f\u663e\u800c\u6613\u89c1\u7684\u3002\n\n\u90a3\u4e48\u6b32\u8bc1\u660e\u6b64\u547d\u9898\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bc1\u660e\u5bf9\u4e8e\u6240\u6709\u7684\u8282\u70b9 $i$ \uff0c\u82e5 $dp_i(j)$ \u7684\u503c\u6709\u5173 $j$ \u6709\u4e0a\u8ff0\u89c4\u5f8b\uff0c\u5219 $g_i(j)$ \u7684\u503c\u5173\u4e8e $j$ \u4e5f\u6ee1\u8db3\u4e0a\u8ff0\u89c4\u5f8b\u5373\u53ef\u3002\u7531\u4e8e\u53d6 $\\min$ \u64cd\u4f5c\u4e0d\u5b58\u5728\u4f18\u79c0\u7684\u6027\u8d28\uff0c\u4fbf\u53ef\u4ee5\u8003\u8651\u731c\u60f3\u4ec0\u4e48\u6837\u7684\u64cd\u4f5c\u662f\u4e0d\u4f18\u7684\u3002\n\n\u6211\u4eec\u6b32\u5f97\u77e5 $g_i(j)$ \u7684\u6700\u5c0f\u503c\uff0c\u53ea\u9700\u4fdd\u8bc1\u9009\u62e9\u8f6c\u79fb\u4f4d\u7f6e\u540e\u7684\u56fe\u50cf\u5c3d\u91cf\u5728\u4e0b\u65b9\u5373\u53ef\u3002\n\n\u9996\u5148\uff0c\u5f53 $dp_i(j)$ \u5728 $j$ \u70b9\u659c\u7387\u5c0f\u4e8e\u7b49\u4e8e $-1$ \u65f6\uff0c\u4e0d\u53d6 $g_i(j)$ \u662f\u4e00\u5b9a\u4e0d\u4f18\u7684\uff0c\u56e0\u4e3a\u5047\u5982\u9009\u62e9\u7684\u51b3\u7b56\u70b9\u66f4\u9760\u5de6\uff0c\u53d8\u5316\u7684\u901f\u5ea6\u4e00\u5b9a\u6bd4\u659c\u7387\u4e3a $-1$ \u7684\u7edd\u5bf9\u503c\u51fd\u6570\u8981\u5feb\uff0c\u56e0\u6b64\u53d6\u503c\u5c31\u4f1a\u66f4\u5927\uff0c\u5373\u6b64\u65f6 $dp_i(j)$ \u7684 \u56fe\u50cf\u5c31\u76f8\u5f53\u4e8e $g_i(j)$ \u7684\u56fe\u50cf\u5411\u4e0a\u5e73\u79fb\u4e86\u7b49\u4e8e\u5176\u4e0e\u7236\u8282\u70b9\u8fb9\u6743\u7684\u4e00\u6bb5\uff0c\u6ee1\u8db3\u6761\u4ef6\u3002\n\n\u5176\u6b21\uff0c\u5728 $dp_i(j)$ \u7684\u659c\u7387\u5927\u4e8e\u7b49\u4e8e $1$ \u65f6\uff0c\u4e00\u5b9a\u6709\u65b9\u6cd5\u4f7f $g_i(j)$ \u5904\u659c\u7387\u7b49\u4e8e $1$ \uff0c\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u9009\u53d6 $dp_i(0)$ \u4e0e\u4e00\u4e2a\u7edd\u5bf9\u503c\u51fd\u6570\u76f8\u52a0\uff0c\u6b64\u65f6\u659c\u7387\u81f3\u591a\u4e3a $1$ \u3002\n\n\u63a5\u7740\uff0c\u5728 $dp_i(j)$ \u7684\u659c\u7387\u4e3a $0$ \u65f6\uff0c $g_i(j+val(i,fa_i))$ \u4e0d\u6539\u53d8\u8fb9\u6743\u76f8\u52a0\u7684\u4e24\u90e8\u5206\u90fd\u662f\u6700\u4f18\u7684\uff0c\u56e0\u6b64\uff0c\u8fd9\u90e8\u5206\u7684\u56fe\u50cf\u53ef\u4ee5\u7531 $dp_i(j)$ \u7684\u56fe\u50cf\u5411\u53f3\u5e73\u79fb\u5f97\u51fa\u3002\n\n\u6700\u540e\uff0c\u6211\u4eec\u89c2\u5bdf\u5230\uff0c\u5728 $dp_i(j)$ \u8f6c\u79fb\u5230 $g_i(j)$ \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5de6\u4fa7\u659c\u7387\u7684\u51fd\u6570\u56fe\u50cf\u5411\u4e0a\u5e73\u79fb\u4e86 $val(i,fa_i)$ \uff0c\u53f3\u4fa7\u7684\u51fd\u6570\u56fe\u50cf\u5411\u53f3\u5e73\u79fb\u4e86 $val(i,fa_i)$ \uff0c\u518d\u5c06\u659c\u7387\u5927\u4e8e $1$ \u7684\u90e8\u5206\u63a8\u5e73\u4e3a $1$ \uff0c\u90a3\u4e48\uff0c\u56fe\u50cf\u7a7a\u51fa\u6765\u7684\u4e00\u6bb5\u4e4b\u95f4\u663e\u7136\u6ca1\u6709\u4efb\u4f55\u53ef\u4ee5\u5bfc\u81f4\u659c\u7387\u53d8\u5316\u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u731c\u6d4b\u6b64\u6bb5\u659c\u7387\u4e3a $-1$ \uff0c\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u6700\u5c0f\u7684 $j_0$ \u4f7f\u5f97 $j_0$ \u5904 $dp_i(j)$ \u7684\u659c\u7387\u4e3a $0$ \uff0c\u540c\u65f6\uff0c$j_0$ \u4e5f\u662f\u6240\u8ba8\u8bba\u60c5\u51b5\u7684\u53f3\u7aef\u70b9\u3002\u63a5\u7740\uff0c\u56fa\u5b9a\u9009\u53d6 $dp_i(j_0)$ \u53ef\u4ec5\u901a\u8fc7\u53d8\u6362\u7edd\u5bf9\u503c\u51fd\u6570\u6765\u8fbe\u5230\u53d6\u503c\uff0c\u6b64\u65f6\u659c\u7387\u4e3a $-1$ \u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/hy3hu31g.png)\n\n\u6b64\u65f6\uff0c\u7ed3\u8bba\u5f97\u8bc1\uff0c\u7531\u6b64\u8bc1\u660e\u8fc7\u7a0b\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u77e5\u9053\uff0c**\u5bf9\u4e8e $dp_i$ \u4e0e $g_i$ \u76f8\u90bb\u7684\u4e24\u6bb5\uff08\u6bb5\u7531\u53ef\u6539\u53d8\u659c\u7387\u7684\u70b9\u6784\u6210\uff0c\u6bb5\u7684\u957f\u5ea6\u53ef\u4ee5\u4e3a $0$ \uff09\u800c\u8a00\uff0c\u5176\u659c\u7387\u4e4b\u5dee\u4e3a $1$** \u3002\u5229\u7528\u5f52\u7eb3\u6cd5\uff0c\u7531\u4e8e\u51fd\u6570\u7684\u659c\u7387\u53d8\u5316\u53ea\u4e0e\u542b\u6709\u7edd\u5bf9\u503c\u7684\u4e00\u6b21\u51fd\u6570\u7684\u96f6\u70b9\u6709\u5173\uff0c\u800c\u56e0\u96f6\u70b9\u5de6\u53f3\u7684\u659c\u7387\u76f8\u5dee\u4e3a $1$ \uff0c\u6545\u5f97\u8bc1\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u53ef\u5e76\u5806\u6765\u7ef4\u62a4\u51fd\u6570\u6bcf\u6bb5\u4e4b\u95f4\u7684\u65ad\u70b9\uff0c\u5f62\u6210\u659c\u7387\u4ee5 $1$ \u4e3a\u516c\u5dee\u7684\u533a\u95f4\uff0c\u90a3\u4e48\uff0c\u5728\u8f6c\u79fb\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1a\n\n1.\u5c06\u8282\u70b9 $i$ \u5bf9\u5e94\u7684 $dp_i$ \u56fe\u50cf\u901a\u8fc7\u5b50\u8282\u70b9\u7684 $g_v$ \u56fe\u50cf\u5408\u5e76\u3002\n\n2.\u8bbe $i$ \u6709 $x$ \u4e2a\u5b50\u8282\u70b9\uff0c\u5f39\u51fa\u53ef\u5e76\u5806\u4e2d $x - 1$ \u4e2a\u5143\u7d20\uff0c\u7531\u4e8e\u5171\u6709 $x$ \u4e2a\u5b50\u8282\u70b9\uff0c\u6b64\u65f6\u6700\u53f3\u4fa7\u7684\u659c\u7387\u4e3a $x$ \uff0c\u5220\u53bb $x - 1$ \u4e2a\u5143\u7d20\u540e\uff0c\u610f\u5473\u7740\u6700\u53f3\u4fa7\u7684\u659c\u7387\u53d8\u4e3a $1$ \u3002\n\n3.\u5c06 $i$ \u5bf9\u5e94\u7684\u53ef\u5e76\u5806\u4e2d\u6700\u5927\u7684\u4e24\u4e2a\u5143\u7d20\u52a0\u4e0a\u5176\u4e0e\u7236\u8282\u70b9\u8fde\u8fb9\u7684\u6743\u503c\uff0c\u5373\u76f8\u5f53\u4e8e\u5411\u53f3\u5e73\u79fb\uff0c\u540c\u65f6\u8865\u5168\u4e86\u659c\u7387\u4e3a $-1$ \u7684\u56fe\u50cf\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u6c42\u5f97 $g_i$ \u7684\u56fe\u50cf\u3002\n\n\u5408\u5e76\u81f3\u6839\u8282\u70b9 $1$ \uff0c\u5c06\u53f3\u4fa7\u65e0\u7528\u7ed3\u70b9\u5f39\u51fa\uff0c\u7559\u4e0b\u659c\u7387\u5c0f\u4e8e $0$ \u7684\u90e8\u5206\uff0c\u73b0\u5728\uff0c\u6211\u4eec\u5df2\u77e5 $dp_{1,0}$ \u7684\u53d6\u503c\uff08\u8fb9\u6743\u548c\uff09\u4ee5\u53ca\u6bcf\u4e2a\u70b9\u7684 $x$ \u5750\u6807\uff0c\u9700\u8981\u77e5\u9053 $y$ \u5750\u6807\u7684\u53d6\u503c\uff0c\u7531\u4e8e\u659c\u7387\u6309\u7167 $1$ \u7684\u516c\u5dee\u5355\u51cf\u7684\u6027\u8d28\uff0c\u53ea\u9700\u8981\u5c06 $dp_{1,0}$ \u51cf\u53bb\u6bcf\u4e2a\u70b9\u7684 $x$ \u5750\u6807\u4e4b\u548c\u4fbf\u662f\u7b54\u6848\uff08\u8003\u8651\u4e00\u6bb5\u659c\u7387\u4e3a $-k$ \u7684\u56fe\u50cf\uff0c\u610f\u5473\u7740\u4ee5 $k$ \u500d\u7684\u901f\u7387\u5728\u51cf\u5c11\uff0c\u800c\u5b9e\u9645\u4e0a\u8fd9\u6bb5\u4e5f\u88ab\u6070\u597d\u8ba1\u7b97\u4e86 $k$ \u6b21\uff09\u3002\n\n### AC \u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\n#include<cstdlib>\n#define int long long\n#define MAXN 600005\n\nusing namespace std;\n\nvector <int> edge[MAXN];\n\nint root[MAXN],val[MAXN],lc[MAXN],rc[MAXN];\n\nint v[MAXN],fa[MAXN],cnt=0,n,deg[MAXN];\n\nint New_Node(int v){\n\tval[++cnt]=v;\n\treturn cnt;\n}\n\nint merge(int x,int y){\n\tif(!x||!y) return x|y;\n\tif(val[x]<val[y]) swap(x,y);\n\tif(rand()&1) lc[x]=merge(lc[x],y);\n\telse rc[x]=merge(rc[x],y);\n\treturn x;\n}\n\nint top(int x){\n\treturn val[root[x]];\n}\n\nvoid pop(int x){\n\troot[x]=merge(lc[root[x]],rc[root[x]]);\n}\n\nvoid dfs(int x){\n\tfor(int i : edge[x]){\n\t\tdfs(i);\n\t\tfor(int j=1;j<deg[i];j++) pop(i);\n\t\tint r=top(i); pop(i);\n\t\tint l=top(i); pop(i);\n\t\troot[i]=merge(root[i],New_Node(l+v[i]));\n\t\troot[i]=merge(root[i],New_Node(r+v[i]));\n\t\troot[x]=merge(root[x],root[i]);\n\t}\n}\n\nsigned main(){\n\tsrand(20070109);\n\tint a,b; scanf(\"%lld%lld\",&a,&b);\n\tn=a+b;\n\tlong long ans=0;\n\tfor(int i=2;i<=n;i++){\n\t\tscanf(\"%lld%lld\",fa+i,v+i);\n\t\tedge[fa[i]].push_back(i);\n\t\tans+=v[i]; deg[fa[i]]++;\n\t}\n\tdfs(1);\n\tfor(int i=1;i<=deg[1];i++) pop(1);\n\twhile(root[1]) ans-=top(1),pop(1);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n### \u540e\u8bb0\n\n\u73b0\u5728\u6211\u4e5f\u60f3\u8d77\u4e86\u90a3\u5929\u773a\u671b\u5230\u7684\u6d77\u5cb8\uff0c\n\n\u90a3\u5728\u6c99\u6ee9\u4e0a\u523b\u4e0b\u7684\u8bdd\u8bed\u4ee5\u53ca\u4f60\u7684\u80cc\u5f71\uff0c\n\n\u62cd\u6765\u7684\u6d77\u6d6a\u63a0\u8fc7\u811a\u8fb9\uff0c\u5e26\u8d70\u4e86\u4ec0\u4e48\u3002\n\n\u98ce\u5e73\u6d6a\u9759\u4e2d\u53ea\u6709\u9ec4\u660f\u9759\u9759\u6d41\u8fc7\uff0c\n\n\u556a\u7684\u4e00\u58f0\uff0c\u770b\u5230\u4e86\u70df\u82b1\u7684\u5149\u8292\u7efd\u653e\u3002\n\n\u90a3\u4e2a\u590f\u5929\u4e00\u5b9a\u8fd8\u6ca1\u6709\u7ed3\u675f\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bgqa4z9a.png)",
        "postTime": 1652323315,
        "uid": 525349,
        "name": "Sakura_xyz",
        "ccfLevel": 4,
        "title": "P3642 [APIO2016]\u70df\u706b\u8868\u6f14 \u9898\u89e3"
    }
]