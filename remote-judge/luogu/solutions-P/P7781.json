[
    {
        "content": "upd. \u628a\u90a3\u4e2a\u5927\u516c\u5f0f\u6539\u5f97\u7a0d\u5fae\u597d\u770b\u4e00\u70b9\u2026\u8981\u4e0d\u7136\u592a\u957f\u4e86\n\n---\n\n~~idea \u4e3a\u539f\u9898\u6539\u7f16~~\n\n\u8bbe $I$ \u4e3a\u5168\u5c40\u9006\u5e8f\u5bf9\u6570\u91cf\uff0c\u4ee5\u53ca\uff1a\n\n$$\\begin{cases}f(n)=\\sum_{i=0}^n[n]_i\\\\g(n)=\\sum_{i=0}^n(i+1)[n]_i\\\\h(n)=\\sum_{i=0}^n(i+1)^2[n]_i\\end{cases}$$\n\n\u5176\u4e2d $f,g,h$ \u5747\u6709\u7ebf\u6027\u9012\u63a8\u5f0f\uff1a\n\n$$\\begin{cases}f(n)=1+nf(n-1)\\\\g(n)=1+n[g(n-1)+f(n-1)]\\\\h(n)=1+n[h(n-1)+2g(n-1)+f(n-1)]\\end{cases}$$\n\n\u5bf9\u4e8e $i<j\\leq n$\uff0c\u8003\u8651\u5728\u54ea\u4e9b\u65b9\u6848\u4e2d $a_i$ \u548c $a_j$ \u4f1a\u88ab\u4ea4\u6362\u3002\n\n\u60c5\u51b5 $1$\uff1a\u5b50\u5e8f\u5217\u4e2d\u540c\u65f6\u51fa\u73b0 $i,j$\uff0c\u4e14\u91cd\u65b0\u6392\u5217\u4e4b\u540e $j$ \u6362\u5230 $i$ \u524d\u9762\u3002\n\n\u8003\u8651\u679a\u4e3e\u5b50\u5e8f\u5217\u957f\u5ea6\uff0c\u5f97\u5230\u65b9\u6848\u6570\u4e3a\uff1a\n\n$$\\begin{aligned}&\\sum_{k=0}^{n-2}\\binom{n-2}{k}\\cdot \\dfrac{(k+2)!}{2}\\\\=&\\sum_{k=0}^{n-2}\\dfrac{(n-2)!}{k!(n-2-k)!}\\cdot\\dfrac{k!\\cdot(k+1)\\cdot(k+2)}{2}\\\\=&\\sum_{k=0}^{n-2}\\dfrac{(k+1)\\cdot(k+2)}{2}[n-2]_k\\\\=&\\dfrac{g(n-2)+h(n-2)}{2}\\end{aligned}$$\n\n\u60c5\u51b5 $2$\uff1a$i$ \u5728\u5b50\u5e8f\u5217\u91cc\u9762\uff0c$j$ \u4e0d\u5728\u5b50\u5e8f\u5217\u91cc\u9762\uff0c\u91cd\u65b0\u6392\u5217\u540e $i$ \u88ab\u653e\u5230\u4e86 $j$ \u540e\u9762\u3002\n\n\u8003\u8651\u679a\u4e3e\u6709\u51e0\u4e2a\u5b50\u5e8f\u5217\u7684\u5143\u7d20\u51fa\u73b0\u5728 $j$ \u524d\u9762\uff0c\u4ee5\u53ca\u6709\u51e0\u4e2a\u51fa\u73b0\u5728 $j$ \u540e\u9762\u3002\n\n\u5f97\u5230\u4e0b\u5f0f\uff1a\n\n$$\\sum_{k=1}^{n-j}\\sum_{l=0}^{j-2}\\binom{n-j}{k}\\binom{j-2}{l}k(k+l)!$$\n\n\u62c6\u5b9a\u4e49\u5f0f\u53d8\u5f62\uff1a\n\n$$\\sum_{k=1}^{n-j}\\sum_{l=0}^{j-2}\\dfrac{(n-j)!}{k!(n-j-k)!}\\cdot\\dfrac{(j-2)!}{l!(j-l-2)!}\\cdot k(k+l)!$$\n\n\u63d0\u51fa $n-j$\uff0c\u7ea6\u53bb $k$\uff1a\n\n$$(n-j)\\sum_{k=1}^{n-j}\\sum_{l=0}^{j-2}\\dfrac{(n-j-1)!}{(k-1)!(n-j-k)!}\\cdot\\dfrac{(j-2)!}{l!(j-l-2)!}\\cdot (k+l)!$$\n\n\u7ec4\u5408\u6570\u5b9a\u4e49\u5f0f\u53d8\u5f62\uff1a\n\n$$(n-j)\\sum_{k=0}^{n-j-1}\\sum_{l=0}^{j-2}\\binom{n-j-1}{k}\\binom{j-2}{l}(k+l+1)!$$\n\n\u8c03\u6362\u679a\u4e3e\u987a\u5e8f\uff08\u5148\u679a\u4e3e $k+l$\uff09\uff1a\n\n$$(n-j)\\sum_{k=0}^{n-3}(k+1)!\\sum_{l=0}^{j-2}\\dbinom{n-j-1}{k-l}\\dbinom{j-2}{l}$$\n\n\u6c83\u5fb7\u4f60\u8499\u5fb7\u6052\u7b49\u5f0f\u53d8\u5f62\uff1a\n\n$$(n-j)\\sum_{k=0}^{n-3}(k+1)!\\dbinom{n-3}{k}$$\n\n\u62c6\u5b9a\u4e49\u5f0f\u53d8\u5f62\uff1a\n\n$$(n-j)\\sum_{k=0}^{n-3}(k+1)[n-3]_k$$\n\n\u4ee3\u5165\u9884\u8bbe\u51fd\u6570\uff1a\n\n$$(n-j)g(n-3)$$\n\n\u60c5\u51b5 $3$\uff1a$j$ \u5728\u5b50\u5e8f\u5217\u91cc\u9762\uff0c$i$ \u4e0d\u5728\u5b50\u5e8f\u5217\u91cc\u9762\uff0c\u91cd\u65b0\u6392\u5217\u540e $j$ \u88ab\u653e\u5230\u4e86 $i$ \u524d\u9762\u3002\n\n\u7c7b\u4f3c\u60c5\u51b5 $2$ \u53ef\u4ee5\u5f97\u5230\u60c5\u51b5\u6570\u4e3a $(i-1)g(n-3)$\n\n\u5168\u90e8\u5408\u8d77\u6765\u518d\u52a0\u4e0a\u5168\u5c40\u9006\u5e8f\u5bf9\u7684\u8d21\u732e\u5c31\u5f97\u5230\u533a\u95f4 $[1,n]$ \u7684\u7b54\u6848\u5f0f\uff1a\n\n$$\\text{Ans}(1,n)=f(n)\\cdot I-\\sum_{i=1}^n\\sum_{j=i+1}^n \\operatorname{sgn}(a_i-a_j)\\cdot\\left[\\dfrac{h(n-2)+g(n-2)}{2}+(i-1+n-j)g(n-3)\\right]$$\n\n\u9884\u5904\u7406 $f,g,h$\uff0c\u6811\u72b6\u6570\u7ec4\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002",
        "postTime": 1619016913,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "AC6 Round B sol"
    },
    {
        "content": "\u7ed9\u4e00\u79cd\u7b80\u5355\u4e00\u70b9\u7684\u63a8\u6cd5\u3002\n\n\u5b9a\u4e49 $F_k$ \u4e3a\u53ea\u9009\u53d6 $[1,k]$ \u7684\u5b50\u5e8f\u5217\u8fdb\u884c\u64cd\u4f5c\u7684\u65b9\u6848\u6570\u3002\u663e\u7136\uff1a\n\n$$\nF_k=\\sum\\limits_{c=0}^k \\binom{k}{c}c!\n$$\n\n\u8003\u8651\u7b97\u6bcf\u4e00\u5bf9 $(a_i,a_j)$ \u5bf9 $k$ \u4f4d\u7f6e\u7b54\u6848\u7684\u8d21\u732e\u3002\u82e5\u521d\u59cb $a_i>a_j$\uff0c\u5219\u5148\u7ed9\u7b54\u6848\u52a0\u4e0a $F_k$\uff0c\u5e76\u5c06\u4e0b\u9762\u6240\u6709\u7684\u8d21\u732e\u53d6\u53cd\u3002\u4e0b\u9762\u7684\u8ba1\u7b97\u9ed8\u8ba4 $i<j\\le k$\u3002\n\n\u8003\u8651\u9009\u62e9\u7684\u5b50\u5e8f\u5217\u5305\u542b $a_i,a_j$ \u7684\u60c5\u51b5\uff1a\n\n- \u5305\u542b\u4e86 $a_i$ \u548c $a_j$\n\n\u5bf9\u4e8e\u4efb\u4f55\u4e00\u4e2a\u5b50\u5e8f\u5217\u7684\u6240\u6709\u91cd\u6392\u5217\uff0c\u5fc5\u7136\u6709\u4e00\u534a $a_i$ \u5728 $a_j$ \u524d\uff0c\u53e6\u4e00\u534a\u76f8\u53cd\u3002\u5bf9\u7b54\u6848\u7684\u989d\u5916\u8d21\u732e\u5373\u4e3a\uff1a\n\n$$\n\\frac{1}{2}\\sum_{c=2}^k \\binom{k-2}{c-2}c!\n$$\n\n- \u5305\u542b\u4e86 $a_i$ \u6216 $a_j$ \u4e2d\u7684\u6070\u597d\u4e00\u4e2a\n\n\u4ee5\u9009\u4e2d $a_j$ \u4e3a\u4f8b\u3002\u8981\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\uff0c\u5fc5\u7136\u8981\u628a $a_j$ \u6362\u5230 $a_{j'}$ \u4e14 $j'<i<j$\u3002\u5219\u5148\u8003\u8651\u94a6\u5b9a $j'$ \u518d\u786e\u5b9a\u5176\u4f59\u7684\u6392\u5217\uff0c\u5373\uff1a\n\n$$\n(i-1)\\sum_{c=1}^{k-2}\\binom{k-3}{c-1}c!\n$$\n\n\u76f4\u63a5\u505a\u53ef\u80fd\u4f1a\u6709 $\\mathcal{O}(n^3)$ \u751a\u81f3 $\\mathcal{O}(n^4)$ \u7684\u590d\u6742\u5ea6\u3002\n\n---\n\n\u5b9a\u4e49 $I_k$ \u4e3a\u524d $k$ \u4e2a\u5143\u7d20\u7684\u9006\u5e8f\u5bf9\u4e2a\u6570\uff0c\u4e14\u4ee4\uff1a\n\n$$\n\\begin{aligned}\nG_k&=\\sum_{c=1}^k \\binom{k-1}{c-1}c!\\\\\nH_k&=\\sum_{c=2}^k \\binom{k-2}{c-2}c!\n\\end{aligned}\n$$\n\n~~OEIS~~ \u5e73\u51e1\u63a8\u5bfc\u53ef\u5f97\uff1a\n\n$$\n\\begin{aligned}\nF_k&=kF_{k-1}+1\\\\\nG_k&=F_k-F_{k-1}\\\\\nH_k&=G_k-G_{k-1}\n\\end{aligned}\n$$\n\n\u524d\u4e24\u7c7b\u8d21\u732e\u7684\u548c\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\uff1a\n\n$$\nF_kI_n+\\frac{1}{2}H_k\\left(\\frac{l(l-1)}{2}-2I_k\\right)\n$$\n\n\u7b2c\u4e09\u7c7b\u8d21\u732e\u65e0\u6cd5\u76f4\u63a5\u8ba1\u7b97\uff0c\u8fd8\u9700\u8981\u7ef4\u62a4\u5f53\u524d\u524d\u7f00\u7684\u6240\u6709\u6570\u5bf9\u8f83\u5927\u4f4d\u7f6e\u7684\u4e0b\u6807\u548c\uff0cBIT \u7ef4\u62a4\u662f\u5e73\u51e1\u7684\u3002\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n```cpp\ntypedef long long ll;\nconst int max_n = 1000000, mod = 20051131;\n\nint p[max_n], prec[max_n], n;\nmint fac[max_n + 1], ifac[max_n + 1], F[max_n + 1], G[max_n + 1], H[max_n + 1];\nll pinvc[max_n + 1], tr[max_n + 1];\n\nvoid initfac(int _lim)\n{\n\tfac[0] = 1;\n\tfor (int i = 0; i < _lim; i++)\n\t\tfac[i + 1] = fac[i] * (i + 1);\n\tifac[_lim] = fac[_lim].inv();\n\tfor (int i = _lim; i > 0; i--)\n\t\tifac[i - 1] = ifac[i] * i;\n}\n\nint lowbit(int x) { return x & -x; }\nvoid add(int x, int v)\n{\n\tfor (x++; x <= n; x += lowbit(x))\n\t\ttr[x] += v;\n}\nll get(int x)\n{\n\tll ret = 0;\n\tfor (x++; x; x -= lowbit(x))\n\t\tret += tr[x];\n\treturn ret;\n}\n\nsigned main()\n{\n\tios_base::sync_with_stdio(false);\n\tcin.tie(nullptr);\n\t\n\tcin >> n;\n\tfor (int i = 0; i < n; i++)\n\t\tcin >> p[i], p[i]--;\n\tinitfac(n);\n\t\n\tF[0] = 1;\n\tfor (int i = 1; i <= n; i++)\n\t\tF[i] = F[i - 1] * i + 1;\n\tadjacent_difference(F, F + n + 1, G), G[0] = 0;\n\tadjacent_difference(G, G + n + 1, H), H[0] = H[1] = 0;\n\t\n\tpinvc[0] = 0;\n\tfor (int i = 0; i < n; i++)\n\t{\n\t\tint res = get(p[i]);\n\t\tprec[i] = res;\n\t\tpinvc[i + 1] = i - res + pinvc[i];\n\t\tadd(p[i], 1);\n\t}\n\t\n\tfill(tr, tr + n + 1, 0);\n\tmint cpc = 0;\n\tfor (int l = 1; l <= n; l++)\n\t{\n\t\tmint ans = pinvc[n] * F[l] + (1ll * l * (l - 1) / 2 - 2 * pinvc[l]) * H[l] / 2;\n\t\tcpc += 1ll * (l - 1) * prec[l - 1] + 1ll * (l - 2) * (l - 1) / 2 - get(p[l - 1]);\n\t\tans += (l <= 2 ? 0 : G[l - 2]) * ((l - 1) * (1ll * l * (l - 1) - 2 * pinvc[l]) - 2 * cpc);\n\t\tcout << ans << \"\\n\";\n\t\tadd(p[l - 1], l - 1);\n\t}\n\t\n\treturn 0;\n}\n```",
        "postTime": 1676123077,
        "uid": 119491,
        "name": "5ab_juruo",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011P7781 \u300cMCOI-Zero / AC6-M07\u300dSelumna Peak"
    }
]