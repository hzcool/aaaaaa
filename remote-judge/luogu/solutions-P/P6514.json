[
    {
        "content": "\u6bd4\u8d5b\u4e2d\u601d\u8003\u8fc7\u7a0b\u6700\u77ed\u7684\u4e00\u9053\u9898\u3002\n\n\u8003\u8651\u8f6c\u5316\u4e00\u4e0b\u9898\u610f\uff0c\u6bcf\u6b21\u4fee\u6539\u76f8\u5f53\u4e8e\u6dfb\u52a0\u4e00\u6761\u4ece$l$\u5230$r$\u7684\u7ebf\u6bb5\uff0c\u6bcf\u6b21\u67e5\u8be2\u5c31\u662f\u8be2\u95ee\u8d2f\u7a7f\u533a\u95f4$[l, r]$\u7684\u7ebf\u6bb5\u4e2a\u6570\u3002\n\n\u628a\u6bcf\u6761\u7ebf\u6bb5\u7684\u5de6\u7aef\u70b9\u5f53\u505a\u7b2c\u4e00\u7ef4\uff0c\u53f3\u7aef\u70b9\u5f53\u505a\u7b2c\u4e8c\u7ef4\uff0c\u90a3\u4e48\u8fd9\u6761\u7ebf\u6bb5\u53ef\u4ee5\u5bf9\u5e94\u5750\u6807\u7cfb\u4e2d\u7684\u4e00\u4e2a\u70b9\uff0c\u67e5\u8be2\u5c31\u53ef\u4ee5\u770b\u505a\u8be2\u95ee$x \\in [1, l]$\u4e14$y \\in [r, n]$\u7684\u77e9\u5f62\u4e0a\u7684\u70b9\u6570\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u4e00\u4e2akd-tree\u7684\u6a21\u677f\u4e86\u3002\n\n\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <cstdio>\n\nusing namespace std;\nconst int MAXN = 1e5 + 5;\nconst double A = 0.7;\n\nstruct Data{\n\tint x[2];\n\t\n\tData(int a, int b) {\n\t\tx[0] = a;\n\t\tx[1] = b;\n\t}\n\t\n\tData() {}\n};\n\nint operator == (const Data &a, const Data &b) {\n\treturn a.x[0] == b.x[0] && a.x[1] == b.x[1];\n}\n\nstruct Node{\n\tData pos;\n\tNode *ch[2];\n\tint cnt, sum, cov;\n\tint mn[2], mx[2];\n\t\n\tNode(Data pos, int cnt) : pos(pos), cnt(cnt) {\n\t\tcov = 1;\n\t\tsum = cnt;\n\t\tfor (int i = 0; i < 2; i++) mn[i] = mx[i] = pos.x[i];\n\t\tch[0] = ch[1] = NULL;\n\t}\n\t\n\tNode() {}\n}npool[MAXN];\n\nint Comp0(Node *a, Node *b) {\n\tif (a->pos.x[0] != b->pos.x[0]) return a->pos.x[0] < b->pos.x[0];\n\telse return a->pos.x[1] < b->pos.x[1];\n}\n\nint Comp1(Node *a, Node *b) {\n\tif (a->pos.x[1] != b->pos.x[1]) return a->pos.x[1] < b->pos.x[1];\n\telse return a->pos.x[0] < b->pos.x[0];\n}\n\nint n, m;\nint ncnt;\nNode *rt;\nNode *tree[MAXN];\nint tcnt;\n\nNode *New(Data pos, int cnt) {\n\tnpool[ncnt] = Node(pos, cnt);\n\treturn &npool[ncnt++];\n}\n\nvoid Update(Node *now) {\n\tnow->cov = 1 + (now->ch[0] ? now->ch[0]->cov : 0) + (now->ch[1] ? now->ch[1]->cov : 0);\n\tnow->sum = now->cnt + (now->ch[0] ? now->ch[0]->sum : 0) + (now->ch[1] ? now->ch[1]->sum : 0);\n\tfor (int i = 0; i < 2; i++) now->mn[i] = now->mx[i] = now->pos.x[i];\n\tfor (int i = 0; i < 2; i++) {\n\t\tif (now->ch[i]) {\n\t\t\tfor (int j = 0; j < 2; j++) {\n\t\t\t\tnow->mn[j] = min(now->mn[j], now->ch[i]->mn[j]);\n\t\t\t\tnow->mx[j] = max(now->mx[j], now->ch[i]->mx[j]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nint Bad(Node *now) {\n\tint ls = now->ch[0] ? now->ch[0]->cov : 0;\n\tint rs = now->ch[1] ? now->ch[1]->cov : 0;\n\treturn 1.0 * ls > A * now->cov || 1.0 * rs > A * now->cov;\n}\n\nvoid DFS(Node *now) {\n\tif (!now) return;\n\tDFS(now->ch[0]);\n\tDFS(now->ch[1]);\n\ttree[++tcnt] = now;\n\tnow->ch[0] = now->ch[1] = NULL;\n\tUpdate(now);\n}\n\nvoid Rebuild(Node *&now, int l, int r, int d) {\n\tif (l > r) return;\n\tint mid = l + r >> 1;\n\tif (d) nth_element(tree + l, tree + mid, tree + r + 1, Comp1);\n\telse nth_element(tree + l, tree + mid, tree + r + 1, Comp0); \n\tnow = tree[mid];\n\tRebuild(now->ch[0], l, mid - 1, (d + 1) % 2);\n\tRebuild(now->ch[1], mid + 1, r, (d + 1) % 2);\n\tUpdate(now);\n}\n\nvoid Maintain(Node *&now, int d) {\n\tif (Bad(now)) {\n\t\ttcnt = 0;\n\t\tDFS(now);\n\t\tRebuild(now, 1, tcnt, d);\n\t}\n}\n\nvoid Insert(Node *&now, Data pos, int cnt, int d) {\n\tif (!now) {\n\t\tnow = New(pos, cnt);\n\t\treturn;\n\t}\n\tif (pos == now->pos) {\n\t\tnow->cnt += cnt;\n\t\tUpdate(now);\n\t\treturn;\n\t}\n\tif (pos.x[d] < now->pos.x[d]) Insert(now->ch[0], pos, cnt, (d + 1) % 2);\n\telse Insert(now->ch[1], pos, cnt, (d + 1) % 2);\n\tUpdate(now);\n\tMaintain(now, d);\n}\n\nint Inside(Node *now, int mn[], int mx[]) {\n\tfor (int i = 0; i < 2; i++) {\n\t\tif (now->pos.x[i] < mn[i] || now->pos.x[i] > mx[i]) return 0;\n\t}\n\treturn 1;\n}\n\nint AllIn(Node *now, int mn[], int mx[]) {\n\tfor (int i = 0; i < 2; i++) {\n\t\tif (now->mn[i] < mn[i] || now->mx[i] > mx[i]) return 0;\n\t}\n\treturn 1;\n}\n\nint AllOut(Node *now, int mn[], int mx[]) {\n\tfor (int i = 0; i < 2; i++) {\n\t\tif (now->mn[i] > mx[i] || now->mx[i] < mn[i]) return 1;\n\t}\n\treturn 0;\n}\n\nint Query(Node *now, int mn[], int mx[]) {\n\tif (!now) return 0;\n\tif (AllIn(now, mn, mx)) return now->sum;\n\tif (AllOut(now, mn, mx)) return 0;\n\treturn (Inside(now, mn, mx) ? now->cnt : 0) + Query(now->ch[0], mn, mx) + Query(now->ch[1], mn, mx);\n}\n\nint main() {\n\tios::sync_with_stdio(false); cin.tie(NULL);\n\tint op, x, y;\n\tint mn[2], mx[2];\n\tcin >> n >> m;\n\tfor (int i = 1; i <= m; i++) {\n\t\tcin >> op >> x >> y;\n\t\tif (op == 1) {\n\t\t\tInsert(rt, Data(x, y), 1, 0);\n\t\t} else {\n\t\t\tmn[0] = 1; mx[0] = x;\n\t\t\tmn[1] = y; mx[1] = n;\n\t\t\tcout << Query(rt, mn, mx) << '\\n';\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1588591143,
        "uid": 126376,
        "name": "Irelia\u10e6",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6514 \u3010[QkOI#R1] Quark and Strings\u3011"
    },
    {
        "content": "\u6b38\u4e3a\u4ec0\u4e48\u5927\u5bb6\u559c\u6b22\u6811\u5957\u6811\uff0c\u77ed\u5c0f\u7cbe\u608d\u7684CDQ\u5206\u6cbb\u4e0d\u9999\u4e48\uff1f\n\n---\n\n\u9898\u610f\u5f88\u5bb9\u6613\u8f6c\u5316\uff0c\u8003\u8651\u6bcf\u4e2a\u4fee\u6539\u64cd\u4f5c\u5bf9\u540e\u9762\u67e5\u8be2\u64cd\u4f5c\u7684\u8d21\u732e\u3002\n\n\u663e\u7136\u5f53\u524d\u67e5\u8be2\u64cd\u4f5c $i$\uff0c\u4f1a\u5bf9\u540e\u9762\u6bcf\u4e2a\u67e5\u8be2\u64cd\u4f5c $j$ \u53ea\u8981\u6ee1\u8db3 $l_i\\leq l_j,r_i\\geq r_j$ \u5c31\u4f1a\u4ea7\u751f $1$ \u7684\u8d21\u732e\u3002\n\n\u90a3\u4e48\u67e5\u8be2\u64cd\u4f5c $j$ \u5c31\u662f\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a\u4fee\u6539\u64cd\u4f5c $i$ \u6ee1\u8db3 $i<j,l_i\\leq l_j,r_i\\geq r_j$\u3002\n\n\u663e\u7136\u7684\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u628a\u8be2\u95ee\u79bb\u7ebf\u7136\u540eCDQ\u5206\u6cbb\u89e3\u51b3\u5373\u53ef\u3002\n\n\uff08\u55ef\uff0c\u662f\u4e2a\u88f8\u5230\u4e0d\u80fd\u518d\u88f8\u7684\u9898\u76ee\u4e86\u3002\u3002\uff09\n\n\u653e\u4e00\u4e0b\u6781\u77ed\u7684 \u2193\n\n***code**:* \n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n#define N 100010\nint n,m,qs,ans[N];\nstruct BIT{           //\u6811\u72b6\u6570\u7ec4\u677f\u5b50\n\tint bit[N];\n\tinline int lowbit(int x){\n\t\treturn x&(-x);\n\t}\n\tvoid Add(int x,int d){\n\t\twhile(x<=n){\n\t\t\tbit[x]+=d;\n\t\t\tx+=lowbit(x);\n\t\t}\n\t}\n\tint Ask(int x){\n\t\tint ans=0;\n\t\twhile(x){\n\t\t\tans+=bit[x];\n\t\t\tx-=lowbit(x);\n\t\t}\n\t\treturn ans;\n\t}\n}A;\nstruct Op{\n\tint id,l,r,type;\n}a[N];\nbool cmp(Op x,Op y){\n\treturn x.r==y.r?(x.l==y.l?x.type<y.type:x.l<y.l):x.r>y.r;  //\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\n}\nvoid CDQ(int l,int r){\n\tif(l>=r)return;\n\tint mid=(l+r)>>1;\n\tCDQ(l,mid),CDQ(mid+1,r);\n\tsort(a+l,a+mid+1,cmp),sort(a+mid+1,a+r+1,cmp);\n\tint i=l,j=mid+1;\n\twhile(j<=r){\n\t\twhile(a[i].r>=a[j].r&&i<=mid){        //\u5de6\u8fb9\u5bf9\u53f3\u8fb9\u7684\u8d21\u732e\uff0cCDQ\u5206\u6cbb\u5e38\u89c4\u64cd\u4f5c\n\t\t\tif(a[i].type==1)A.Add(a[i].l,1);\n\t\t\t++i;\n\t\t}\n\t\tif(a[j].type==2)ans[a[j].id]+=A.Ask(a[j].l);\n\t\t++j;\n\t}\n\tfor(int j=l;j<i;++j){\n\t\tif(a[j].type==1)A.Add(a[j].l,-1);\n\t}\n}\nint main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=m;++i){\n\t\tint opt=read(),l=read(),r=read();\n\t\ta[i].id=(opt==2?++qs:0),a[i].l=l,a[i].r=r,a[i].type=opt;  //\u79bb\u7ebf\u5b58\u8be2\u95ee\n\t}\n\tCDQ(1,m);\n\tfor(int i=1;i<=qs;++i){\n\t\tprintf(\"%d\\n\",ans[i]);\n\t}\n\treturn 0;\n}\n\n```\n\n[*Froggy's blog*](https://www.luogu.org/blog/1445353309froggy/)\n\n#### \u5471!!\n",
        "postTime": 1588576022,
        "uid": 100285,
        "name": "Froggy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6514 \u3010[QkOI#R1] Quark and Strings\u3011"
    },
    {
        "content": "\u9996\u5148\u51fa\u9898\u4eba\u7684\u9898\u89e3\u5199\u4e86\uff0c\u5c31\u662f\u4e2a\u533a\u95f4\u52a0\u6cd5\uff0c\u5355\u70b9\u67e5\u8be2\u3002\n\n\u7ed9\u4e2a\u5947\u602a\u7684 KDT \u505a\u6cd5\uff0c\u8dd1\u7684\u6d77\u661f\u3002\n\n\u6211\u4eec\u628a\u70b9\u79bb\u7ebf\u4e0b\u6765\uff0c\u5c31\u53d8\u6210\u4e86\u533a\u95f4\u52a0\u5355\u70b9\u67e5\u8be2\u7684\u95ee\u9898\u4e86\u3002\n\n\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u4e2a\u5fc5\u987b\u8981\u628a\u67e5\u8be2\u65b9\u5f0f\u6539\u4e00\u4e0b\uff0c\u8fd9\u6837\u67e5\u8be2\u5c31\u80fd\u53d8\u6210 $1\\log$ \u7684\u3002\u4fee\u6539\u5e94\u8be5\u662f $2\\log$\uff0c\u800c\u4e0d\u662f\u5927\u5bb6\u5e73\u5e38\u6240\u77e5\u9053\u7684 $n^{2-\\frac{1}{k}}$\u3002\n\n\u8ba9\u5b83\u53d8\u6210 $1\\log$  \u7684\u529e\u6cd5\u5f88\u7b80\u5355\uff0c\u5f53\u6210\u7ebf\u6bb5\u6811\uff0c\u7528 zkw \u7ebf\u6bb5\u6811\u7684\u601d\u60f3\uff0c\u5e73\u8861\u6811\u7528\u4e2a\u6808 $pushdown$ \u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u5199\u7684\u5f88\u5947\u602a\uff1f\u4e0d\u7528\u5361\u5e38\u5c31\u80fd\u8f7b\u677e 1s/3s\uff08\n\n```cpp\ninline int inc(int x, int y) {\n\treturn x + y;\n}\n\nconst int maxn = 2e5 + 52;\nint x[2], y[2];\nint t[maxn], val[maxn][2], K;\nbool cmp(int a, int b) {\n\treturn val[a][K] < val[b][K];\n}\n\nint mn[maxn][2], mx[maxn][2], ch[maxn][2], sum[maxn];\nint fa[maxn]; \nint add[maxn];\n#define ls ch[x][0]\n#define rs ch[x][1]\ninline void up(int x) {\n\tadd[x] = 0;\n\tfor(int i = 0 ; i < 2 ; i ++) {\n\t\tmn[x][i] = min(val[x][i], min(mn[ls][i], mn[rs][i]));\n\t\tmx[x][i] = max(val[x][i], max(mx[ls][i], mx[rs][i]));\n\t}\n}\n\nvoid bld(int &x, int l, int r, int k) {\n\tif(l > r) return;\n\tK = k;\n\tint mid = l + r >> 1;\n\tnth_element(t + l, t + mid, t + r + 1, cmp);\n\tx = t[mid],  bld(ls, l, mid - 1, k ^ 1);\n\tbld(rs, mid + 1, r, k ^ 1), up(x);\n\tfa[ls] = x;\n\tfa[rs] = x;\n}\n\ninline void down(int x) {\n\tif(add[x]) {\n\t\tsum[ls] = inc(sum[ls], add[x]);\n\t\tsum[rs] = inc(sum[rs], add[x]);\n\t\tadd[ls] = inc(add[ls], add[x]);\n\t\tadd[rs] = inc(add[rs], add[x]);\n\t\tadd[x] = 0;\n\t}\n}\n\nint allin, allout, thisin;\n\ninline void chk(int u) {\n\tallin = allout = thisin = 1;\n\tfor (int i = 0; i < 2; i++) {\n\t\tif (x[i] > mn[u][i] || mx[u][i] > y[i]) {\n\t\t\tallin = 0;\n\t\t\tif (x[i] > val[u][i] || val[u][i] > y[i]) {\n\t\t\t\tthisin = 0;\n\t\t\t\tif (x[i] > mx[u][i] || y[i] < mn[u][i]) {\n\t\t\t\t\tallout = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tallout ^= 1;\n}\n\nvoid mdf(int x, int y) {\n\tif(!x) return;\n\tchk(x);\n\tif(allout) return;\n\tif(thisin) {\n\t\tsum[x] = inc(sum[x], y);\n\t}\n\tif(allin) {\n\t\tadd[x] = inc(add[x], y);\n\t\treturn;\n\t}\n\tdown(x); \n\tmdf(ls, y), mdf(rs, y);\n}\n\nint n, q;\nstruct qwq {\n\tint op, l, r;\n} a[maxn];\n\nint root;\nint top = 0;\nsigned main() {\n#ifdef LOCAL\n\tfreopen(\"testdata.in\", \"r\", stdin);\n#endif\n\tio in;\n\tin >> n >> q;\n\tmn[0][0] = mn[0][1] = maxn;\n\tmx[0][0] = mx[0][1] = 0;\n\tfor(register int i = 1 ; i <= q ; i ++) {\n\t\tint op, l, r;\n\t\tin >> op >> l >> r;\n\t\ta[i] = { op, l, r };\n\t\tif(op == 2)\n\t\t\tt[++ top] = i, val[i][0] = l, val[i][1] = r;\n\t}\n\troot = 0;\n\tbld(root, 1, top, 0);\n\tstatic int st[maxn], tp = 0;\n\tfor(register int i = 1 ; i <= q ; i ++) {\n\t\tint op, l, r;\n\t\top = a[i].op;\n\t\tl = a[i].l;\n\t\tr = a[i].r;\n\t\tif(op == 1) {\n\t\t\tx[0] = x[1] = l;\n\t\t\ty[0] = y[1] = r;\n\t\t\tmdf(root, 1);\n\t\t} else {\n\t\t\tint x = fa[i];\n\t\t\twhile(x) st[++ tp] = x, x = fa[x];\n\t\t\twhile(tp) down(st[tp --]);\n\t\t\tout << sum[i] << '\\n';\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1588595766,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6514 \u3010[QkOI#R1] Quark and Strings\u3011"
    },
    {
        "content": "~~\u8fd9\u5176\u5b9e\u5c31\u662f\u4e2a\u4e09\u7ef4\u504f\u5e8f\u7684\u677f\u5b50\u3002~~\n\n\u8003\u8651\u8f6c\u5316\u4e00\u4e0b\u9898\u610f\uff0c\u6bcf\u6b21\u4fee\u6539\u76f8\u5f53\u4e8e\u6dfb\u52a0\u4e00\u6761\u4ece $l$ \u5230 $r$ \u7684\u7ebf\u6bb5\uff0c\u6bcf\u6b21\u67e5\u8be2\u5c31\u662f\u8be2\u95ee\u8d2f\u7a7f\u533a\u95f4 $[l,r]$ \u7684\u7ebf\u6bb5\u4e2a\u6570\u3002\n\n\u628a\u6bcf\u6761\u7ebf\u6bb5\u7684\u5de6\u7aef\u70b9\u5f53\u505a\u7b2c\u4e00\u7ef4\uff0c\u53f3\u7aef\u70b9\u5f53\u505a\u7b2c\u4e8c\u7ef4\uff0c\u90a3\u4e48\u8fd9\u6761\u7ebf\u6bb5\u53ef\u4ee5\u5bf9\u5e94\u5750\u6807\u7cfb\u4e2d\u7684\u4e00\u4e2a\u70b9\uff0c\u67e5\u8be2\u5c31\u53ef\u4ee5\u770b\u505a\u8be2\u95ee $x\\in [1,l] \\land y \\in [r, n]$ \u7684\u77e9\u5f62\u4e0a\u7684\u70b9\u6570\n\n\u8fd9\u65f6\u5019\u6709\u5f88\u591a\u65b9\u6cd5\uff0c\u6211\u6765\u5217\u4e3e\u4e00\u4e0b\u4f18\u52a3\uff1a\n\n\u6811\u5957\u6811\uff1a\u65f6\u95f4 $O(n\\log^2n)$\uff0c\u7a7a\u95f4 $O(n\\log^2n)$\uff0c\u4ee3\u7801\u91cf\u5927\uff0c\u5728\u7ebf\n\n\u4e8c\u7ef4\u6811\u72b6\u6811\u7ec4 $+$ \u54c8\u5e0c\u8868\uff1a\u65f6\u95f4 $O(n\\log^2n)$\uff0c\u7a7a\u95f4 $O(n\\log^2n)$\uff0c\u4ee3\u7801\u91cf\u5c0f\uff0c\u5728\u7ebf\n\nKD-Tree: \u65f6\u95f4 $O(n\\sqrt n)$\uff0c\u7a7a\u95f4 $O(n)$\uff0c\u4ee3\u7801\u91cf\u8f83\u5927\uff0c\u5728\u7ebf\n\nCDQ \u5206\u6cbb\uff1a\u65f6\u95f4 $O(n\\log^2n)$\uff0c\u7a7a\u95f4 $O(n)$\uff0c\u4ee3\u7801\u91cf\u5c0f\uff0c\u53ea\u80fd\u79bb\u7ebf\n\n\u8fd9\u9898\u8017\u65f6\u8c8c\u4f3c\u662f:\n\nCDQ \u5206\u6cbb $<$ \u4e8c\u7ef4\u6811\u72b6\u6811\u7ec4 $+$ \u54c8\u5e0c\u8868 $<$ \u6811\u5957\u6811 $<$ KD-Tree\n\n\u7531\u4e8e\u5176\u4ed6\u51e0\u4e2a\u89e3\u6cd5\u5728\u5176\u4ed6\u51e0\u4e2a\u9898\u89e3\u91cc\u90fd\u6709\u63d0\u53ca\uff0c\u672c\u6587\u91cd\u70b9\u8bb2\u4e8c\u7ef4\u6811\u72b6\u6811\u7ec4 $+$ \u54c8\u5e0c\u8868\u7684\u505a\u6cd5\n\n\u4e8c\u7ef4\u6811\u72b6\u6811\u7ec4\u7684\u76f8\u8f83\u4e8e\u4f18\u70b9\u662f\u5e38\u6570\u6bd4\u8f83\u5c0f\uff0c\u7f3a\u70b9\u662f\u4e0d\u80fd\u591f\u76f4\u63a5\u52a8\u6001\u5f00\u70b9\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528\u54c8\u5e0c\u8868\u6765\u52a8\u6001\u5f00\u70b9\n\n\u8fd9\u9898\u7a7a\u95f4\u5bf9\u4e8e\u6b64\u89e3\u6cd5\u6709\u70b9\u5361\uff0c\u6240\u4ee5\u6211\u91c7\u7528\u5c06\u539f\u6765\u54c8\u5e0c\u8868\u91cc\u7684 `long long` \u6539\u79f0\u4e00\u4e2a `int+char` \u5b58\u50a8\u6765\u538b\u7f29\u7a7a\u95f4 \n\n\u6b64\u5916\u8fd9\u9898\u628a\u5b58\u50a8 $r$ \u7684\u503c\u7ffb\u8f6c\u8fc7\u6765\u4f1a\u6bd4\u8f83\u597d\u505a\n\n\u6700\u540e\u653e\u4e00\u4e0b\u4ee3\u7801:\n\n```cpp\n#include <bits/stdc++.h>\n#define for1(i,n) for(i=1;i<=(n);i++)\nusing namespace std;\nconst int N=55000005,H=1073741823,Z=100007,V=55000000,P=54989993;\ntypedef long long ll;\nint n,m,a[N],h[N];\nchar c[N];\nvoid f(int x,int y){\n\tll z=(ll)x*Z+y;\n\tint i,xx=z&H;\n\tchar yy=z>>30;\n\tfor(i=z%V;~c[i]&&(c[i]!=yy||h[i]!=xx);i>=P?i-=P:i+=10007);\n\th[i]=xx;c[i]=yy;a[i]++;\n}\nint g(int x,int y){\n\tll z=(ll)x*Z+y;\n\tint i,xx=z&H;\n\tchar yy=z>>30;\n\tfor(i=z%V;~c[i]&&(c[i]!=yy||h[i]!=xx);i>=P?i-=P:i+=10007);\n\treturn a[i];\n}\nvoid add(int x,int y){\n\tint i,j;\n\tfor(i=x;i<=n;i+=i&-i)\n\t\tfor(j=y;j<=n;j+=j&-j) f(i,j);\n}\nint gsum(int x,int y){\n\tint i,j,ans=0;\n\tfor(i=x;i;i-=i&-i)\n\t\tfor(j=y;j;j-=j&-j) ans+=g(i,j);\n\treturn ans;\n}\nint main(){\n\tmemset(c,-1,sizeof(c));\n\tint i,opt,x,y;\n\tscanf(\"%d%d\",&n,&m);\n\tfor1(i,m){\n\t\tscanf(\"%d%d%d\",&opt,&x,&y);\n\t\tif(opt==1) add(x,n-y+1);\n\t\telse printf(\"%d\\n\",gsum(x,n-y+1));\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1661616177,
        "uid": 288222,
        "name": "a326820068122c",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6514"
    },
    {
        "content": "## D - Quark and Strings\n\n##### $\\text{Description}$\n\n\u4f60\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e8f\u5217 $\\{S_n\\}$\uff0c\u5176\u4e2d\u6709 $n$ \u4e2a\u5b57\u7b26\u4e32\uff0c\u5b57\u7b26\u96c6\u4e3a $[1,q]\\cap N_+$\uff0c\u521d\u59cb\u5168\u4e3a\u7a7a\u3002\u63a5\u4e0b\u6765\u6709 $q$ \u6b21\u64cd\u4f5c\uff0c\u652f\u6301\u4e24\u79cd\u64cd\u4f5c\uff08\u8bbe\u5f53\u524d\u4e3a\u7b2c $i$ \u6b21\u64cd\u4f5c\uff09\uff1a\n\n- `1 l r`\uff0c\u8868\u793a\u5728\u6240\u6709\u7f16\u53f7\u5728 $[l,r]$ \u5185\u7684\u5b57\u7b26\u4e32\u672b\u5c3e\u6dfb\u52a0\u4e00\u4e2a\u5b57\u7b26 $i$\uff08\u6570\u5b57\uff09\n- `2 l r`\uff0c\u8868\u793a\u8be2\u95ee\u6240\u6709\u7f16\u53f7\u5728 $[l,r]$ \u5185\u7684\u5b57\u7b26\u4e32\u7684\u6700\u957f\u516c\u5171\u5b50\u5e8f\u5217\u957f\u5ea6\u3002\n\n$n,q\\le 10^5$\n\n##### $\\text{Solution}$\n\n\u6ce8\u610f\u64cd\u4f5c $1$ \u53ea\u4f1a\u6dfb\u52a0\u4e4b\u524d\u672a\u51fa\u73b0\u8fc7\u7684\u5b57\u7b26\uff0c\u53ef\u4ee5\u5f97\u77e5\uff0c\u73b0\u5728\u6dfb\u52a0\u7684\u5b57\u7b26\u53ea\u4f1a\u5728\u8fd9\u4e00\u6b21\u64cd\u4f5c\u4e2d\u51fa\u73b0\uff0c\u6240\u4ee5\u4e00\u4e2a $[L,R]$ \u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\u53ea\u4f1a\u5bf9 $l\\ge L,r\\le R$ \u7684 $[l,r]$ \u8be2\u95ee\u64cd\u4f5c\u8d21\u732e $1$ \u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u95ee\u9898\u8f6c\u6362\u4e3a\u4ee5\u4e0b\u95ee\u9898\uff1a\n\n> \u7ef4\u62a4\u4e00\u4e2a\u77e9\u9635\uff0c\u5176\u4e2d\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684\u5143\u7d20\u4e3a $a_{i,j}$\uff0c\u521d\u59cb\u5168\u4e3a $0$\u3002\u652f\u6301\u4e24\u4e2a\u64cd\u4f5c\uff1a\n>\n> - `1 l r`\uff0c\u8868\u793a\u5bf9\u6240\u6709\u6ee1\u8db3 $i,j\\in[l,r]$ \u7684 $a_{i,j}$ \u6267\u884c$\\mathbf{a_{i,j}\\gets a_{i,j}+1}$\u3002\n> - `2 l r`\uff0c\u8868\u793a\u8be2\u95ee $a_{l,r}$ \u7684\u503c\u3002\n\n\u5229\u7528\u4e8c\u7ef4\u5dee\u5206\uff0c\u53ef\u4ee5\u5c06\u64cd\u4f5c $1$ \u53d8\u4e3a\u5355\u70b9\u52a0 $1$\uff0c\u64cd\u4f5c $2$ \u53d8\u4e3a\u8be2\u95ee\u77e9\u5f62\u5185\u6240\u6709\u6570\u7684\u548c\uff0c\u4ece\u800c\u53ef\u4ee5\u4f7f\u7528\u6811\u5957\u6811\u89e3\u51b3\u3002",
        "postTime": 1588500098,
        "uid": 83547,
        "name": "LCuter",
        "ccfLevel": 7,
        "title": "[QkOI#R1] Quark and Strings \u5b98\u65b9\u9898\u89e3"
    }
]