[
    {
        "content": "\u65e2\u7136\u90fd\u51b3\u5b9a\u5199\u4e86\uff0c\u4e3a\u4e86\u4ee5\u540e\u7684\u81ea\u5df1\u8bfb\u5f97\u61c2\uff0c\u8fd8\u662f\u5199\u4e00\u7bc7\u8be6\u7ec6\u7684\u9898\u89e3\u5427\u3002\n\n\u6709\u70b9\u957f\uff0c\u5206\u4e2a\u5c42\u3002\n\n## \u5feb\u901f\u5e42\n\n\u901a\u8bfb\u5168\u9898\uff0c\u7b2c\u4e00\u4e2a\u6ce8\u610f\u5230\u7684\u662f\u5927\u7684\u4e0d\u6b63\u5e38\u7684 $m$\uff0c\u800c\u9898\u76ee\u8981\u6c42\u7684\u662f\u591a\u9879\u5f0f\u7684 $m$ \u6b21\u65b9\uff0c\u90a3\u4e48\u5feb\u901f\u5e42\u7684\u601d\u60f3\u8dd1\u4e0d\u4e86\u3002\n\n## \u7cfb\u6570\u6269\u500d\n\n\u63a5\u7740\u53ef\u4ee5\u6ce8\u610f\u5230\u662f\u5728\u6a21 2 \u610f\u4e49\u4e0b\u8fdb\u884c\uff0c\u8003\u8651\u5feb\u901f\u5e42\u7684\u8fc7\u7a0b\u53d1\u73b0 $f(x)^k \\Rightarrow f(x)^{2k}$ \u5c31\u662f\u7cfb\u6570\u7684\u6b21\u6570\u6269\u500d\u3002\n\n\u4e3a\u4ec0\u4e48\uff1f\u628a $f(x)^k$ \u5199\u5f00\uff0c\u5373 $f(x)^k=\\sum_i c_i x^i$\uff0c\u5219 $f(x)^{2k}=(\\sum_i c_i x^i)\\cdot(\\sum_i c_i x^i)=\\sum_ic_i^2x^{2i}+\\sum_i\\sum_{j\\not=i}c_ic_jx^{i+j}$\n\n\u7531\u4e8e\u6709\u6a21 2\uff0c\u9996\u5148\u6709 $c_i^2=c_i$\uff0c\u63a5\u7740\u6709 $\\sum_i\\sum_{j\\not=i}c_ic_jx^{i+j}=2\\sum_i\\sum_{j>i}c_ic_jx^{i+j}=0$\u3002\n\n\u6545 $f(x)^{2k}=\\sum_ic_ix^{2i}$\n\n## \u8f6c\u79fb\u72b6\u6001\n\n~~\u7136\u540e\u6211\u5c31\u4e0d\u4f1a\u4e86~~\uff0c\u4f46\u662f\u53ef\u4ee5\u53d1\u73b0 $n,K$ \u5c0f\u7684\u4e0d\u5bf9\u52b2\u3002\n\n\u4e3a\u4e86\u540e\u6587\u65b9\u4fbf\uff0c\u4ee4 $K\\rightarrow K-1,t=\\max(n,K)$\uff0c\u5373\u540e\u6587\u7684 $K$ \u8868\u793a\u8be2\u95ee\u4e32\u770b\u4f5c\u591a\u9879\u5f0f\u7684\u6700\u9ad8\u6b21\u6570\u4e3a $K$\u3002\n\n\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0 $f(x)^k$ \u7684\u76f8\u90bb $t$ \u9879\u7cfb\u6570\u53ea\u6709 $2^t$ \u79cd\u60c5\u51b5\uff0c\u8bb0 $F(st)$ \u8868\u793a\u5f53\u524d\u76f8\u90bb\u7cfb\u6570\u72b6\u6001\u4e3a $st$ \u7684\u4e2a\u6570\uff0c\u53d1\u73b0\u662f\u53ef\u4ee5~~\u8f7b\u677e~~\u8f6c\u79fb\u5feb\u901f\u5e42\u7684\u3002\n\n\u66f4\u91cd\u8981\u7684\u662f\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5bf9\u6700\u540e\u6c42\u7b54\u6848\u5f88\u6709\u5e2e\u52a9\uff0c~~\u4f46\u6211\u4eec\u8fd8\u4e0d\u4f1a\u8f6c\u79fb~~\u3002\n\n## \u5feb\u901f\u5e42\u8f6c\u79fb\n\n\u8fd8\u662f\u4e3a\u4e86\u540e\u6587\u65b9\u4fbf\uff0c\u5bf9\u4e8e\u5f00\u5934\u4e0d\u5230 $t$ \u9879\u7684\u76f8\u90bb $r<t$ \u9879\uff0c\u6211\u4eec\u5728\u5176**\u524d\u9762**\u8865 $t-r$ \u4e2a 0 \u4f5c\u4e3a\u72b6\u6001\uff0c\u4f60\u53ef\u4ee5\u770b\u4f5c\u8d1f\u6570\u9879\u4e3a 0\uff0c\u5e76\u8003\u8651\u4e86\u90e8\u5206\u8d1f\u6570\u9879\u3002\n\n\u8003\u8651\u67d0\u4e00\u6bb5\u72b6\u6001\u4e3a $st$\uff0c\u6269\u500d\u540e\u4e00\u5b9a**\u552f\u4e00\u786e\u5b9a**\u4e86\u4e00\u6bb5\u957f\u4e3a $2t$ \u7684\u72b6\u6001 $st'$\uff0c(\u4e0d\u4e25\u8c28\u7684\u8868\u793a\u4e00\u4e0b)\u5373 $st_{k,k+t}=\\sum_{i=k}^{k+t}c_ix^i$\uff0c\u5219 $st'_ {2k,2(k+t)}=\\sum_{i=k}^{k+t}c_{i}x^{2i}$\n\n\u4f46\u5982\u679c\u6211\u4eec\u5c06 $st'$ \u91cc\u9762\u7684 $t$ \u4e2a(\u76f8\u90bb $t$ \u9879\u7cfb\u6570)\u72b6\u6001\u5168\u90e8\u8ba1\u6570\u5230\u6269\u500d\u540e\u7684 $F'$ \u91cc\u9762\u7684\u8bdd\u662f\u4f1a**\u91cd\u590d\u8ba1\u6570**\u7684\u3002\n\n~~\u5982\u679c\u4f60\u4e0d\u60f3\u81ea\u5df1 yy \u4e00\u4e2a\u529e\u6cd5\u53bb\u91cd\u7136\u540e\u8c03\u8fb9\u754c\u81f4\u6b7b\u7684\u8bdd~~\uff0c\u53ef\u4ee5\u60f3\u529e\u6cd5\u5c06\u5176\u4e00\u4e00\u5bf9\u5e94\u8fdb\u884c\u8ba1\u6570\u3002\n\n\u6211\u4eec\u5bf9\u5e94\u53d6\u6700\u540e\u4e24\u4e2a\u72b6\u6001\uff0c\u5373\u5bf9\u4e8e $st_{k,k+t}$ \u6211\u4eec\u53ea\u5bf9\u5e94\u8ba1\u6570 $st'_ {2k+t-1,2k+2t-1},st'_ {2k+t,2k+2t}$\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u6837\u5c31\u5de7\u5999\u5730\u8f6c\u79fb\u4e86\u6269\u500d\u3002\n\n\u603b\u7684\u6765\u770b\u4e5f\u662f\u6b63\u786e\u7684\uff0c\u8bbe $f(x)^k$ \u6709 $y$ \u9879\uff0c\u6709 $y$ \u4e2a\u72b6\u6001\uff0c\u90a3\u4e48 $f(x)^{2k}$ \u6709 $2y$ \u9879\uff0c\u90a3\u4e48\u5c31\u5e94\u8be5\u6709 $2y$ \u4e2a\u72b6\u6001\u3002\n\n\u7136\u800c\u8fd8\u6709\u4e2a\u4e25\u91cd\u7684\u95ee\u9898\u5c31\u662f\u5feb\u901f\u5e42\u4e0d\u6b62\u4e58 2\uff0c\u8fd8\u53ef\u80fd\u52a0 1\u3002\n\n\u5982\u679c\u6211\u4eec\u5148\u8f6c\u79fb\u4e86 $F'$ \u518d\u4e58 1 \u8f6c\u79fb $F''$ \u7684\u8bdd\u662f\u6709\u95ee\u9898\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2a\u72b6\u6001\u4e0d\u88ab $F'$ \u4e00\u79cd\u72b6\u6001\u4e00\u4e00\u5bf9\u5e94\u4e86\uff0c\u8fd8\u4e0e\u8fd9\u79cd\u72b6\u6001\u76f8\u90bb\u7684 $t$ \u4e2a**\u72b6\u6001**\u6709\u5173\u3002\n\n\u55ef\uff0c$t$ \u4e2a\uff1f\u6211\u4eec\u53d1\u73b0\u7531 $F$ \u8f6c\u79fb\u65f6\u521a\u597d\u5c31\u5bf9\u5e94\u4e86\u76f8\u90bb $2t$ \u4e2a\u4f4d\u7f6e\uff0c\u5373\u76f8\u90bb $t$ \u4e2a\u72b6\u6001\u3002\n\n\u4e8e\u662f\u6211\u4eec\u76f4\u63a5\u5728\u8fd9\u91cc\u786e\u5b9a\u4e58\u4e0a $f(x)$ \u540e\u5f97\u5230\u5bf9\u5e94\u7684\u957f\u4e3a $2t+n$ \u7684\u72b6\u6001\uff0c\u4f46\u8fd9\u91cc\u786e\u5b9a\u7684 $t+n$ \u4e2a\u72b6\u6001\u4e5f\u6709\u5de7\u5999\u7684\u91cd\u53e0\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u91c7\u7528\u7684\u65b9\u6cd5\u662f\u53d6\u4e2d\u95f4\u4e24\u4e2a\u72b6\u6001\uff0c\u5373 $st_{k,k+t}$ \u5bf9\u5e94 $st''_ {2k+n,2(k+t)+n}$\uff0c\u53d6 $st''_ {2k+t-1,2k+2t-1},st''_ {2k+t,2k+2t}$ \uff0c\u548c\u524d\u9762\u4e00\u6837\u6b38\uff01(((\n\n\u603b\u7684\u6765\u770b\u5e94\u8be5\u6709 $2y+n$ \u9879\uff0c\u5373 $2y+n$ \u4e2a\u72b6\u6001\uff0c\u90a3\u4e48\u6700\u524d\u9762\u4f1a\u591a\u51fa $n$ \u79cd\u72b6\u6001\u6ca1\u6709\u8ba1\u6570\u8fdb\u53bb\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u6700\u524d\u9762\u7684 $T$ \u4f4d\uff0c\u7136\u540e\u66b4\u529b\u5c06\u524d\u9762 $n$ \u79cd\u72b6\u6001\u52a0\u8fdb\u53bb\u5373\u53ef\u3002\n\n\u540c\u65f6\u6700\u524d\u9762\u7684\u8fd9 $T$ \u4f4d\u4e5f\u6709\u5176\u4ed6\u7684\u7528\u5904\uff0c\u9a6c\u4e0a\u5c31\u8981\u7528\u5230\u3002\u800c\u4e14\u6211\u5e76\u4e0d\u77e5\u9053 $T$ \u53d6\u591a\u5c11\u6ca1\u95ee\u9898\uff0c\u6bd5\u7adf\u6709\u7684\u9898\u89e3\u91cc\u8bf4\u53d6\u4e2a\u51e0\u5341\u51e0\u767e\u4f4d\u90fd\u4e0d\u662f\u74f6\u9888(\u6211\uff1a*@^#%*@!%#)\uff0c\u4e8e\u662f\u6211~~\u968f\u4fbf\u5730~~\u91c7\u53d6\u4e86 $T=2t+1$\u3002\n\n## \u540e\u7f00\u548c\n\n\u8f6c\u79fb\u5c31\u8fd9\u6837\u6109\u5feb\u7684\u7ed3\u675f\u4e86\uff0c\u4f46\u4f60\u53ef\u80fd\u53d1\u73b0\u9898\u76ee\u7ed9\u7684 $L,R$ \u7528\u90fd\u8fd8\u6ca1\u7528\u8fc7\u3002\n\n\u7531\u4e8e\u5feb\u901f\u5e42\u8f6c\u79fb\u8fc7\u7a0b\u4e2d\u6211\u4eec\u5c06\u524d\u9762 $T$ \u4f4d\u5e26\u7740\u8d70\u4e86\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8f7b\u6613\u5730\u6390\u6389\u524d\u9762\u7684\u4e00\u90e8\u5206\u3002\n\n\u7528\u9898\u76ee\u4e2d\u7684\u5f62\u5f0f\u8868\u8fbe\u4e00\u4e0b\uff0c$f(x)^m$ \u5c31\u662f $s$\uff0c\u90a3\u4e48\u5176\u540e\u7f00\u5c31\u662f $s\\left[ k,N \\right] ,N$ \u662f\u603b\u957f\uff0c$k$ \u5c31\u662f\u540e\u7f00\u5f00\u59cb\u7684\u4f4d\u7f6e\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $s\\left[ k,N \\right]$ \u7684 $F$ \u6570\u7ec4\uff0c\u5177\u4f53\u5c31\u662f\u6bcf\u6b21\u6269\u500d\u6216\u6269\u500d\u52a0\u4e00\u65f6\u7528\u524d $T$ \u4f4d\u66b4\u529b\u6390\u6389\u4e00\u6bb5\u6390\u5230 $k$ \u90a3\u4e2a\u4f4d\u7f6e\u5c31\u884c\u3002\n\n## \u7edf\u8ba1\u7b54\u6848\n\n\u663e\u7136\u5730\uff0c\u6211\u4eec\u7528 $s\\left[ L,N \\right]$ \u7684 $F$ \u51cf\u53bb $s\\left[ R-K+1,N \\right]$ \u7684\u5c31\u662f\u7b54\u6848\u3002\n\n\u7edf\u8ba1\u7684\u8bdd\u7531\u4e8e $K$ \u53ef\u80fd\u6bd4 $t$ \u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u524d\u9762\u8865\u4e0a\u4efb\u610f\u4e00\u79cd\u524d\u7f00\u7edf\u8ba1\u3002\n\n\u6ce8\u610f\u8865\u4e1c\u897f\u90fd\u662f\u5728\u524d\u9762\u8865\uff0c\u7c7b\u6bd4\u524d\u9762\u8865 0\uff0c\u4f46\u8fd9\u91cc\u4e0d\u662f\u8865 0\uff0c\u800c\u662f\u8865\u4efb\u610f\u4e00\u79cd\u524d\u7f00\u3002\n\n\u4ee5\u4e0a\u3002\n\n\u54e6\u4e0d\u5bf9\u8fd8\u6709\u6211\u96be\u770b\u7684\u4ee3\u7801\uff0c\u4f46\u597d\u6b79\u8fd8\u6709\u70b9\u6ce8\u91ca\uff0c\u4e3a\u4e86\u770b\u5f97\u61c2\u6211\u591a\u622a\u4e86\u4e00\u70b9\uff1a\n\n```cpp\nconst int Mx=100;\nconst int M=1<<19;\nint n,m,mx,mxx,trs[2][2][M];\nLL T,L,R,stf,stg,alf,alg;\nint tt,flg[Mx+5];\nLL len[Mx+5],F[2][M];\ninline LL Ask(LL v)\n{\n\tint i,t,f,fl;\n\tLL k=T,l,dl,sm;\n\tLLL prf,prg;\n//\u524d T \u4f4d\u5077\u61d2\u7528 __int128 \u5b58\u7684\n\tfor(;k^1;k>>=1)\n\t{\n\t\tflg[++tt]=k&1;\n\t\tlen[tt]=tt-1?(len[tt-1]+1)>>1:v;\n//\u8981\u6c42\u5230 [v,N] \u7684 F \u6bcf\u6b21\u8981\u7684\u957f\u5ea6\n\t}\n\tfor(i=0;i<=n;F[0][(stf<<(mx-(i++)))&alf]++);\n\tfor(t=1,f=0,l=n,prf=stf<<(mx+1);tt;tt--,t^=1,f^=1)\n\t{\n\t\tfl=flg[tt];\n\t\tfor(i=0;i<=alf;i++)\n\t\t{\n\t\t\tif((k=F[f][i]))\n\t\t\t{\n\t\t\t\tF[t][trs[fl][0][i]]+=k;F[t][trs[fl][1][i]]+=k;\n\t\t\t\tF[f][i]=0;\n//\u7528\u9884\u5904\u7406\u597d\u7684\u76f4\u63a5\u8f6c\u79fb\n\t\t\t}\n\t\t}\n\t\tfor(i=prg=0;i<=mxx;i++)\n\t\t{\n\t\t\tprg|=((prf>>i)&1)<<(i<<1);\n\t\t}\n//\u66b4\u529b\u8f6c\u79fb\u524d T \u4f4d\n\t\tdl=Max(0ll,(l=(l<<1)+(fl?mx:0))-len[tt]);\n//\u8be5\u6390\u591a\u957f\n\t\tif(fl)\n\t\t{\n\t\t\tfor(i=prf=0;i<=mx;i++)\n\t\t\t{\n\t\t\t\tif((stf>>i)&1)\n\t\t\t\t{\n\t\t\t\t\tprf^=prg<<i;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(dl<mx)for(i=dl;i<mx;F[t][(prf>>(mxx+mx+mx-(i++)+1))&alf]++);\n\t\t\tif(mx<dl)for(i=mx;i<dl;F[t][(prf>>(mxx+mx+mx-(i++)+1))&alf]--);\n//\u6390\u548c\u52a0\u4e0a n \u79cd\u72b6\u6001\u4e8c\u5408\u4e8c(\u6211\u6bd2\u7624)\n\t\t\tprf=(prf>>(mxx+mx-dl))&alg;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(i=0;i<dl;F[t][(prg>>(mxx+mx-(i++)+1))&alf]--);\n//\u6390\n\t\t\tprf=(prg>>(mxx-dl))&alg;\n\t\t}\n\t\tl-=dl;\n\t}\n\tfor(i=sm=0;i<(1<<(mx-m));sm+=F[f][(i++)|stg]);\n//\u8865\u524d\u7f00\u7edf\u8ba1\n\tfor(i=0;i<=alf;F[f][i++]=0);\n\treturn sm;\n}\ninline int gt()\n{\n\tchar ch;\n\tfor(ch=gc();ch^48&&ch^49;ch=gc());\n\treturn ch^48;\n}\nint TT;\nsigned main()\n{\n\t#ifndef ONLINE_JUDGE\n//\tfreopen(\"poly1.in\",\"r\",stdin);\n\tfreopen(\"_.in\",\"r\",stdin);\n//\tfreopen(\"_.out\",\"w\",stdout);\n\t#endif\n\tint i,j;\n\tLL k,kk;\n\tfor(TT=read();TT;TT--)\n\t{\n\t\tn=read();read(T);m=read()-1;read(L);read(R);mx=Max(n,m);mxx=(mx<<1)+1;\n//\u9898\u89e3\u5bf9\u5e94\u4ee3\u7801 n->n m->T K->m t->mx T->mxx\n\t\tfor(i=stf=0;i<=n;i++)\n\t\t{\n\t\t\tstf|=gt()<<(mx-i);\n\t\t}\n\t\tfor(i=stg=0;i<=m;i++)\n\t\t{\n\t\t\tstg|=gt()<<(mx-i);\n\t\t}\n\t\talf=(1<<(mx+1))-1;alg=(1ll<<(mxx+1))-1;\n\t\tfor(i=0;i<=alf;i++)\n\t\t{\n\t\t\tfor(j=k=0;j<=mx;j++)\n\t\t\t{\n\t\t\t\tk|=((i>>j)&1ll)<<(j<<1);\n\t\t\t}\n\t\t\ttrs[0][0][i]=k>>mx;trs[0][1][i]=(k>>(mx-1))&alf;\n//\u6269\u500d\u8f6c\u79fb\u7684\u9884\u5904\u7406\n\t\t\tfor(j=kk=0;j<=mx;j++)\n\t\t\t{\n\t\t\t\tif((stf>>j)&1)\n\t\t\t\t{\n\t\t\t\t\tkk^=k<<j;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttrs[1][0][i]=(kk>>mx)&alf;trs[1][1][i]=(kk>>(mx-1))&alf;\n//\u6269\u500d\u52a0\u4e00\u8f6c\u79fb\u7684\u9884\u5904\u7406\n\t\twritenum(R-L+1<m?0:Ask(n*T+1-L)-Ask(n*T+1-(R-m+1)),10);\n//\u6bd2\u7624\n\t}\n\treturn output;\n}\n```",
        "postTime": 1624090389,
        "uid": 158948,
        "name": "\u7ea6\u745f\u592b\u7528\u8111\u73a9",
        "ccfLevel": 0,
        "title": "P3689 [ZJOI2017]\u591a\u9879\u5f0f"
    }
]