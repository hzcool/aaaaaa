[
    {
        "content": "\u4e00\u9053\u6700\u77ed\u8def\u7684\u53d8\u5f62\u9898\u3002\n\n\u9996\u5148\uff0c\u628a\u4f20\u9001\u7684\u8fc7\u7a0b\u62c6\u5f00\uff0c\u5c31\u662f\u5148\u5c04\u4e24\u67aa\uff0c\u518d\u8d70\u5230\u4e00\u4e2a\u4f20\u9001\u95e8\uff0c\u4f20\u9001\u5230\u53e6\u4e00\u4e2a\u4f20\u9001\u95e8\uff0c\u5171\u82b1\u8d39 $1$ \u5355\u4f4d\u65f6\u95f4\u3002\n\n\u6240\u4ee5\u4e00\u5171\u6709\u4e24\u79cd\u8d70\u6cd5\uff1a\u4e00\u79cd\u662f\u8d70\u5230\u76f8\u90bb\u7684\u683c\u5b50\uff08spfa \u5373\u53ef\uff09\uff0c\u4e00\u79cd\u662f\u4f20\u9001\u3002\n\n\u5bf9\u4e8e\u4f20\u9001\uff0c\u5728\u641c\u7d22\u65f6\u679a\u4e3e**\u8d77\u70b9\u4f20\u9001\u95e8**\u548c**\u7ec8\u70b9\u4f20\u9001\u95e8**\u3002\u5728 spfa \u4e4b\u524d $O(n^2)$ \u9012\u63a8\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5411\u56db\u4e2a\u65b9\u5411\u76f4\u7ebf\u8d70\u6700\u8fd1\u7684\u5899\u7684\u8ddd\u79bb\uff0c\u8d70\u5230\u8d77\u70b9\u4f20\u9001\u95e8\u5373\u53ef\u3002\u5f53\u7136\uff0c\u4f20\u9001\u5230\u6bcf\u4e2a\u4f4d\u7f6e\u6709 $3$ \u79cd\u65b9\u6848\uff08\u8d77\u70b9\u4f20\u9001\u95e8\u548c\u7ec8\u70b9\u4f20\u9001\u95e8\u65b9\u5411\u4e0d\u540c\uff09\uff0c\u4f46\u662f\u8d77\u5230\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u9700\u8981\u53d6\u6700\u5c0f\u503c\u3002\n\n\u6ce8\u610f\uff1a\u4e0d\u4e00\u5b9a\u662f\u8981\u6328\u7740\u5899\u624d\u80fd\u4f20\u9001\uff0c\u4f1a $78$ \u5206\u3002\n\n```cpp\nconst int dx[]={0,1,0,-1},dy[]={1,0,-1,0};\nint n,m,sx,sy,tx,ty,vis[N][N],dis[N][N],b[N][N][4];\nchar ch[N][N];\nstruct node\n{\n\tint x,y;\n};\nvoid bfs()\n{\n\tmemset(dis,0x3f,sizeof dis),dis[sx][sy]=0;\n\tqueue<node> q;q.push({sx,sy}),vis[sx][sy]=1;\n\twhile(!q.empty())\n\t{\n\t\tnode f=q.front();q.pop(),vis[f.x][f.y]=0;\n\t\tfor(int i=0;i<4;i++)//\u8d70\u5230\u76f8\u90bb\u683c\u5b50\n\t\t{\n\t\t\tint nx=f.x+dx[i],ny=f.y+dy[i];\n\t\t\tif(ch[nx][ny]!='#'&&dis[f.x][f.y]+1<dis[nx][ny])\n\t\t\t{\n\t\t\t\tdis[nx][ny]=dis[f.x][f.y]+1;\n\t\t\t\tif(!vis[nx][ny])\n\t\t\t\t\tq.push({nx,ny}),vis[nx][ny]=1;\n\t\t\t}\n\t\t}\n\t\tfor(int i=0;i<4;i++)//\u4f20\u9001\uff0c\u679a\u4e3e\u7ec8\u70b9\n\t\t{\n\t\t\tint d=b[f.x][f.y][i],minn=INF,nx=f.x+dx[i]*d,ny=f.y+dy[i]*d;\n\t\t\tfor(int j=0;j<4;j++)//\u679a\u4e3e\u8d77\u70b9\n\t\t\t\tif(i!=j)\n\t\t\t\t\tminn=min(minn,b[f.x][f.y][j]);//\u53d6\u6700\u5c0f\u503c\u8f6c\u79fb\n\t\t\tminn+=dis[f.x][f.y]+1;\n\t\t\tif(dis[nx][ny]>minn)\n\t\t\t{\n\t\t\t\tdis[nx][ny]=minn;\n\t\t\t\tif(!vis[nx][ny])\n\t\t\t\t\tvis[nx][ny]=1,q.push({nx,ny});\n\t\t\t}\n\t\t}\n\t}\n}\nvoid solve()\n{\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tcin>>ch[i][j];\n\t\t\tif(ch[i][j]=='C')\n\t\t\t\tsx=i,sy=j;\n\t\t\tif(ch[i][j]=='F')\n\t\t\t\ttx=i,ty=j;\n\t\t}\n\tfor(int i=1;i<=n;i++)//\u9884\u5904\u7406\u5899\u58c1\u8ddd\u79bb\n\t\tfor(int j=m;j;j--)\n\t\t\tif(ch[i][j]=='#')\n\t\t\t\tb[i][j][0]=-1;\n\t\t\telse\n\t\t\t\tb[i][j][0]=b[i][j+1][0]+1;\n\tfor(int j=1;j<=m;j++)\n\t\tfor(int i=n;i;i--)\n\t\t\tif(ch[i][j]=='#')\n\t\t\t\tb[i][j][1]=-1;\n\t\t\telse\n\t\t\t\tb[i][j][1]=b[i+1][j][1]+1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t\tif(ch[i][j]=='#')\n\t\t\t\tb[i][j][2]=-1;\n\t\t\telse\n\t\t\t\tb[i][j][2]=b[i][j-1][2]+1;\n\tfor(int j=1;j<=m;j++)\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tif(ch[i][j]=='#')\n\t\t\t\tb[i][j][3]=-1;\n\t\t\telse\n\t\t\t\tb[i][j][3]=b[i-1][j][3]+1;\n\tbfs();\n\tif(dis[tx][ty]==INF)\n\t\tputs(\"nemoguce\");\n\telse\n\t\twrite(dis[tx][ty],\"\");\n}\n```",
        "postTime": 1677917541,
        "uid": 474577,
        "name": "_M28_",
        "ccfLevel": 0,
        "title": "P4442"
    },
    {
        "content": "\n\u6211\u4eec\u8003\u8651\u672c\u9898\u4e2d\u4eba\u7269\u7684\u884c\u8d70\u65b9\u5f0f\u3002\u5bb9\u6613\u53d1\u73b0\uff0c\u5982\u679c\u4eba\u7269\u5728$(x,y)$\uff0c\u90a3\u4e48\u4eba\u7269\u5c31\u53ea\u6709\u4ee5\u4e0b\u4e24\u79cd\u79fb\u52a8\u65b9\u5f0f\uff1a\n\n 1. \u79fb\u52a8\u81f3$(x,y)$\u4e0a\u4e0b\u5de6\u53f3\u7684\u683c\u5b50\uff0c\u82b1\u8d391\u3002\n \n 2. \u79fb\u52a8\u5230$(x,y)$\u56db\u4e2a\u65b9\u5411\u7684\u5899\u58c1\u65c1\u7684\u683c\u5b50\uff0c\u7531\u4e8e\u5fc5\u987b\u79fb\u52a8\u5230\u4e00\u9762\u5899\u58c1\u65c1\u8fb9\u624d\u53ef\u4ee5\u4f7f\u7528\u4f20\u9001\u95e8\uff0c\u6240\u4ee5\u82b1\u8d39\u4e3a$(x,y)$\u6700\u8fd1\u7684\u5899\u58c1+1\u3002\u56e0\u4e3a\u8d70\u8fdb\u4f20\u9001\u95e8\u4e5f\u9700\u89811\u7684\u82b1\u8d39\u3002\n\n\u8fd9\u663e\u7136\u662f\u4e00\u9053\u6700\u77ed\u8def\u7684\u9898\u76ee\uff0c~~\u663e\u7136\u51fa\u9898\u4eba\u6ca1\u6cd5\u7528\u83ca\u82b1\u56fe\u6765\u5361spfa~~\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u8003\u8651\u7528$spfa$\u6765\u89e3\u51b3\u3002\n\n\u5bf9\u4e8e\u79fb\u52a8\u65b9\u5f0f\u4e00\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ece\u4efb\u610f\u4e00\u70b9\u5411\u56db\u5468\u8fde\u8fb9\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u79fb\u52a8\u65b9\u5f0f\u4e8c\uff0c\u6211\u4eec\u53ef\u4ee5$O(nm)$\u5148\u66b4\u529b\u6c42\u51fa\u6bcf\u4e00\u4e2a\u70b9\u56db\u4e2a\u65b9\u5411\u7684\u5899\u58c1\u4f4d\u7f6e\u3002\u4ee5\u4e0a\u65b9\u7684\u5899\u58c1\u4e3a\u4f8b\uff1a\n\n- \u5982\u679c$(x-1,y)$\u4e3a\u5899\u58c1\uff0c\u5219\u80fd\u4f20\u9001\u5230\u7684\u4f4d\u7f6e\u4e3a$(x,y)$\u3002\n\n- \u5982\u679c$(x-1,y)$\u4e0d\u4e3a\u5899\u58c1\uff0c\u90a3\u4e48$(x-1,y)$\u80fd\u4f20\u9001\u5230\u7684\u4f4d\u7f6e\u5373\u4e3a$(x,y)$\u80fd\u4f20\u9001\u5230\u7684\u4f4d\u7f6e\uff0c\u76f4\u63a5\u7528$(x-1,y)$\u7684\u7b54\u6848\u8d4b\u503c\u5373\u53ef\u3002\n\n\n\u7136\u540e\u8981\u6c42\u51fa\u6bcf\u4e00\u4e2a\u70b9\u5230\u6700\u8fd1\u7684\u5899\u58c1\u7684\u8ddd\u79bb\u3002\u8fd9\u4e2a\u53ea\u9700\u8981\u4ece\u6240\u6709\u7684\u5899\u58c1\u5f00\u59cb$bfs$\u5c31\u53ef\u4ee5$O(nm)$\u6c42\u51fa\u3002\n\n\u7136\u540e\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u5c31\u53ef\u4ee5\u4e86\u3002\n```cpp\n#include <queue>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n\nconst int N=510;\nconst int dx[]={0,0,0,-1,1};\nconst int dy[]={0,-1,1,0,0};\nint n,m,S,T,tot,map[N][N],dis[N*N],d[N][N],go[N*N][5],near[N*N],head[N*N];\nchar ch;\nbool vis[N*N];\n\nstruct edge\n{\n\tint next,to,dis;\n}e[N*N*8];\n\nvoid add(int from,int to,int dis)\n{\n\te[++tot].to=to;\n\te[tot].dis=dis;\n\te[tot].next=head[from];\n\thead[from]=tot;\n}\n\nint com(int x,int y)\n{\n\treturn x*m-m+y;  //\u7ed9\u70b9(x,y)\u7f16\u53f7\n}\n\nvoid bfs()\n{\n\tqueue<int> q;\n\tfor (int i=1;i<=n;i++)\n\t\tfor (int j=1;j<=m;j++)\n\t\t\tif (map[i][j])  //\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u5899\u58c1\n\t\t\t{\n\t\t\t\td[i][j]=1;\n\t\t\t\tq.push(com(i,j));\n\t\t\t}\n\twhile (q.size())\n\t{\n\t\tint u=q.front();\n\t\tq.pop();\n\t\tint x=(u-1)/m+1,y=(u-1)%m+1;\n\t\tfor (int i=1;i<=4;i++)\n\t\t{\n\t\t\tint xx=x+dx[i],yy=y+dy[i];\n\t\t\tif (map[xx][yy] || d[xx][yy] || xx<1 || xx>n || yy<1 || yy>m) continue;\n\t\t\tif (!d[xx][yy])\n\t\t\t{\n\t\t\t\td[xx][yy]=d[x][y]+1;\n\t\t\t\tq.push(com(xx,yy));\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid spfa()\n{\n\tmemset(dis,0x3f3f3f3f,sizeof(dis));\n\tqueue<int> q;\n\tq.push(S);\n\tdis[S]=0; vis[S]=1;\n\twhile (q.size())\n\t{\n\t\tint u=q.front();\n\t\tq.pop();\n\t\tvis[u]=0;\n\t\tfor (int i=head[u];~i;i=e[i].next)\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tif (dis[v]>dis[u]+e[i].dis)\n\t\t\t{\n\t\t\t\tdis[v]=dis[u]+e[i].dis;\t\n\t\t\t\tif (!vis[v])\n\t\t\t\t{\n\t\t\t\t\tvis[v]=1;\n\t\t\t\t\tq.push(v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nint main()\n{\n\tmemset(head,-1,sizeof(head));\n\tscanf(\"%d%d\",&n,&m);\n\tfor (int i=1;i<=n;i++)\n\t\tfor (int j=1;j<=m;j++)\n\t\t{\n\t\t\twhile (ch=getchar()) if (ch=='#'||ch=='.'||ch=='F'||ch=='C') break;\n\t\t\tif (ch=='#') map[i][j]=1;\n\t\t\tif (ch=='C') S=com(i,j);\n\t\t\tif (ch=='F') T=com(i,j);\n\t\t}\n\tfor (int i=1;i<=n;i++)  //\u5206\u522b\u6c42\u56db\u4e2a\u65b9\u5411\u7684\u5899\u58c1\u4f4d\u7f6e\n\t\tfor (int j=1;j<=m;j++)\n\t\t\tif (map[i][j-1]) go[com(i,j)][1]=com(i,j);\n\t\t\t\telse go[com(i,j)][1]=go[com(i,j-1)][1];\n\tfor (int i=1;i<=n;i++)\n\t\tfor (int j=m;j>=1;j--)\n\t\t\tif (map[i][j+1]) go[com(i,j)][2]=com(i,j);\n\t\t\t\telse go[com(i,j)][2]=go[com(i,j+1)][2];\n\tfor (int j=1;j<=m;j++)\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tif (map[i-1][j]) go[com(i,j)][3]=com(i,j);\n\t\t\t\telse go[com(i,j)][3]=go[com(i-1,j)][3];\n\tfor (int j=1;j<=m;j++)\n\t\tfor (int i=n;i>=1;i--)\n\t\t\tif (map[i+1][j]) go[com(i,j)][4]=com(i,j);\n\t\t\t\telse go[com(i,j)][4]=go[com(i+1,j)][4];\n\tbfs();\n\tfor (int i=1;i<=n;i++)\n\t\tfor (int j=1;j<=m;j++)\n\t\t{\n\t\t\tif (map[i][j]) continue;\n\t\t\tfor (int k=1;k<=4;k++)\n\t\t\t\tif (!map[i+dx[k]][j+dy[k]]) add(com(i,j),com(i+dx[k],j+dy[k]),1);\n\t\t\tfor (int k=1;k<=4;k++)\n\t\t\t\tif (go[com(i,j)][k]!=com(i,j)) add(com(i,j),go[com(i,j)][k],d[i][j]-1);\n\t\t}\n\tspfa();\n\tif (dis[T]>=1e9) printf(\"nemoguce\");\n\t\telse printf(\"%d\",dis[T]);\n\treturn 0;\n}\n```\n",
        "postTime": 1565348079,
        "uid": 53962,
        "name": "stoorz",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4442 \u3010[COCI2017-2018#3] Portal \u3011"
    },
    {
        "content": "~~\u5176\u4ed6\u9898\u89e3\u5df2\u7ecf\u628a\u601d\u8def\u8bb2\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u8fd9\u91cc\u4e3b\u8981\u63d0\u4f9b\u4e00\u7bc7\u6bd4\u8f83**\u89c4\u6574**\u7684\u4ee3\u7801\u3002~~\n\nupd\uff1a2021.11.9 \u7ecf\u8bc4\u8bba\u533a\u7684\u63d0\u9192\uff0c\u66f4\u6b63\u4e86\u4e00\u70b9\u95ee\u9898\u3002\n\n## \u601d\u8def\n\n\u6709\u4f20\u9001\u95e8\u7684\u5b58\u5728\uff0c\u6211\u4eec\u8d70\u5230\u4e00\u4e2a\u70b9\u5c31\u8981\u8003\u8651\u4e09\u79cd\u60c5\u51b5\uff1a\n\n- \u8d70\u8def\n\n- \u4f20\u9001\n\n- \u8d70\u8def+\u4f20\u9001\n\n\u90a3\u4e48\u90e8\u5206\u5206\u5c31\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e+\u641c\u7d22\u3002\n\n***\n\n\u4f20\u9001\u4e0e\u8d70\u8def\u81ea\u7136\u662f\u8981\u9009\u62e9\u8def\u5f84\u6700\u77ed\u7684\u4e00\u4e2a\u3002\n\n\u8003\u8651\u5728\u6bcf\u4e2a\u70b9\u53ef\u4ee5\u5efa\u7684\u4f20\u9001\u95e8\u4ee5\u53ca\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u8fdb\u90a3\u4e2a\u4f20\u9001\u95e8\u3002\u9996\u5148\uff0c\u5982\u679c\u5728\u5f53\u524d\u70b9\u8981\u8d70\u5230\u9762\u524d\uff08\u4e0a\uff0c\u5de6\uff0c\u4e0b\uff0c\u53f3\uff09\u7684\u4e00\u5835\u5899\u9762\u524d\uff08\u58991\uff09\uff0c\u53ef\u4ee5\u5148\u53d1\u5c04\u4e00\u4e2a\u4f20\u9001\u95e8\u5230\u90a3\u5835\u5899\uff0c\u518d\u8d70\u5230\u79bb\u5f53\u524d\u70b9\u6700\u8fd1\u7684\u4e00\u5835\u5899\uff08\u58992\uff09\u53d1\u5c04\u53e6\u4e00\u4e2a\u4f20\u9001\u95e8\u4e4b\u540e\u8fdb\u53bb\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5728\u5f53\u524d\u70b9\u548c**\u58991**\u5efa\u4e00\u6761\u8fb9\uff0c\u8fb9\u7684\u957f\u5ea6\u4e3a\u8fd9\u4e2a\u70b9\u5230**\u58992**\u7684\u8ddd\u79bb\u3002\u5bf9\u6574\u5f20\u56fe\u90fd\u505a\u4e00\u4e2a\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u6700\u540e\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u4e00\u4e2a\u5355\u6e90\u6700\u77ed\u8def\u5f84\u3002\u5f53\u7136\uff0c\u76f8\u90bb\u4e24\u70b9\u7684\u8fb9\u4e5f\u4e0d\u8981\u5fd8\u4e86\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\u5efa\u56fe\u51fd\u6570\u662f\u4e0d\u80fd\u5c11\u7684\u3002\u7531\u4e8e\u539f\u56fe\u662f\u4e00\u4e2a\u4e8c\u7ef4\u5e73\u9762\uff0c\u6240\u4ee5\u6bcf\u4e2a\u70b9\u53ef\u4ee5\u7528\u4e00\u4e2a $id$ \u8868\u793a\u3002\u5bf9\u4e8e\u70b9 $(i,j)$\uff0c\u5f53 $id_{i,j}=(i-1)\\cdot \\max(n,m)+j$ \u65f6\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u70b9\u7684\u7f16\u53f7\u4e0d\u51b2\u7a81\u3002\n\n```\ninline int id(int x,int y) {return (x-1)*max(n,m)+y;}\nvoid inc(int x,int y,int l) {nxt[++cnt]=first[x],to[cnt]=y,first[x]=cnt,lth[cnt]=l;}\n```\n\n\u8981\u627e\u5230\u79bb\u6bcf\u4e2a\u53ef\u4ee5\u8d70\u7684\u70b9\u6700\u8fd1\u7684\u4e00\u5835\u5899\uff0c\u7528\u4e00\u4e2a BFS \u5373\u53ef\u3002\u5c06\u6bcf\u4e00\u5835\u5899\u4f5c\u4e3a\u8d77\u70b9\uff0c\u4e00\u904d\u641c\u8fc7\u53bb\uff0c\u5982\u679c\u4e0b\u4e00\u4e2a\u70b9\u8fd8\u6ca1\u6709\u641c\u8fc7\uff0c\u8bf4\u660e\u8fd9\u5835\u5899\u79bb\u8fd9\u4e2a\u70b9\u6700\u8fd1\u3002\n\n```\nfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++)\n{\n\tif(a[i][j]=='C') a[i][j]='.',start=id(i,j);\n\tif(a[i][j]=='F') a[i][j]='.',end=id(i,j);\n\tif(a[i][j]=='#') BFS[++t].x=i,BFS[t].y=j;\n}\nfor(int h=1;h<=t;h++) for(int i=0;i<4;i++)\n{\n\tint x=BFS[h].x,y=BFS[h].y;\n\tint tx=x+c[i][0],ty=y+c[i][1];\n\tif(a[tx][ty]=='.'&&!bs[tx][ty]) BFS[++t].x=tx,BFS[t].y=ty,bs[tx][ty]=bs[x][y]+1;\n}\n```\n\n\u8fd9\u4e2a\u70b9\u9762\u5bf9\u7684\u4e0a\u4e0b\u5de6\u53f3\u7684\u5899\u90fd\u662f\u53ef\u4ee5\u4f20\u9001\u53bb\u7684\uff0c\u5148\u627e\u5230\u8fd9\u4e9b\u5899\u7684\u7f16\u53f7\uff0c\u518d\u53bb\u5efa\u8fb9\u3002lt\u662f\u5de6\u8fb9\u7684\u5899\uff0cup\u662f\u4e0a\u9762\u7684\u5899\uff0cdn\u662f\u4e0b\u9762\u7684\u5899\uff0crt\u662f\u53f3\u8fb9\u7684\u5899\u3002\n\n```\n//\u627e\u53ef\u4ee5\u4f20\u9001\u53bb\u7684\u5899\nfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++) if(a[i][j]=='.')\n{\n\tif(a[i][j-1]=='#') lt[i][j]=id(i,j);\n\telse lt[i][j]=lt[i][j-1];\n\tif(a[i-1][j]=='#') up[i][j]=id(i,j);\n\telse up[i][j]=up[i-1][j];\n}\nfor(int i=n;i;i--) for(int j=m;j;j--) if(a[i][j]=='.')\n{\n\tif(a[i][j+1]=='#') rt[i][j]=id(i,j);\n\telse rt[i][j]=rt[i][j+1];\n\tif(a[i+1][j]=='#') dn[i][j]=id(i,j);\n\telse dn[i][j]=dn[i+1][j];\n}\n//\u5bf9\u4e8e\u76f8\u90bb\u70b9\uff0c\u5219\u5efa\u4e00\u6761\u8fb9\u6743\u4e3a1\u7684\u8fb9\n//\u5bf9\u4e8e\u53ef\u4ee5\u4f20\u9001\u53bb\u7684\u5899\uff0c\u5219\u5efa\u4e00\u6761\u4ee5\u79bb\u6700\u8fd1\u5899\u7684\u8ddd\u79bb\u4e3a\u8fb9\u6743\u7684\u8fb9\nfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++) if(a[i][j]=='.')\n{\n\tif(a[i][j+1]=='.') Inc(id(i,j),id(i,j+1),1);\n\tif(a[i+1][j]=='.') Inc(id(i,j),id(i+1,j),1);\n\tif(lt[i][j]!=id(i,j)) inc(id(i,j),lt[i][j],bs[i][j]);\n\tif(up[i][j]!=id(i,j)) inc(id(i,j),up[i][j],bs[i][j]);\n\tif(rt[i][j]!=id(i,j)) inc(id(i,j),rt[i][j],bs[i][j]);\n\tif(dn[i][j]!=id(i,j)) inc(id(i,j),dn[i][j],bs[i][j]);\n}\n```\n\n\u5efa\u5b8c\u56fe\u540e\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n```\nfor(int i=1;i<=n*m;i++) dis[i]=inf;\ndis[start]=0,dijkstra.push((ok){start,0});\nwhile(!dijkstra.empty())\n{\n\tint x=dijkstra.top().x,l=dijkstra.top().y;\n\tdijkstra.pop();\n\tif(l>dis[x]) continue;\n\tfor(int i=first[x],v;i;i=nxt[i]) if(dis[v=to[i]]>dis[x]+lth[i])\n\t{\n\t\tdis[v]=dis[x]+lth[i];\n\t\tdijkstra.push((ok){v,dis[v]});\n\t}\n}\n```\n\n## code\n\n```\n#include<bits/stdc++.h>\n#define N 505\n#define mx 300005\nusing namespace std;\nconst int inf=0x3f3f3f;\nstruct ok{\n\tint x,y;\n\tbool operator <(const ok &A) const{return y>A.y;}\n}BFS[mx];\nint n,m,start,end;//main\nint t,bs[N][N],c[4][2]={{0,1},{0,-1},{1,0},{-1,0}};//Bfs\nint lt[N][N],rt[N][N],up[N][N],dn[N][N];//init\nint nxt[mx<<4],to[mx<<4],first[mx],lth[mx<<4],cnt;//build\npriority_queue<ok>dijkstra;\nint dis[mx];//Dijkstra\nchar a[N][N];\ninline int id(int x,int y) {return (x-1)*max(n,m)+y;}\nvoid inc(int x,int y,int l) {nxt[++cnt]=first[x],to[cnt]=y,first[x]=cnt,lth[cnt]=l;}\nvoid Inc(int x,int y,int l) {inc(x,y,l),inc(y,x,l);}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%s\",a[i]+1);\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++)\n\t{\n\t\tif(a[i][j]=='C') a[i][j]='.',start=id(i,j);\n\t\tif(a[i][j]=='F') a[i][j]='.',end=id(i,j);\n\t\tif(a[i][j]=='#') BFS[++t].x=i,BFS[t].y=j;\n\t}\n\t//Bfs\n\tfor(int h=1;h<=t;h++) for(int i=0;i<4;i++)\n\t{\n\t\tint x=BFS[h].x,y=BFS[h].y;\n\t\tint tx=x+c[i][0],ty=y+c[i][1];\n\t\tif(a[tx][ty]=='.'&&!bs[tx][ty]) BFS[++t].x=tx,BFS[t].y=ty,bs[tx][ty]=bs[x][y]+1;\n\t}\n\t//init\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++) if(a[i][j]=='.')\n\t{\n\t\tif(a[i][j-1]=='#') lt[i][j]=id(i,j);\n\t\telse lt[i][j]=lt[i][j-1];\n\t\tif(a[i-1][j]=='#') up[i][j]=id(i,j);\n\t\telse up[i][j]=up[i-1][j];\n\t}\n\tfor(int i=n;i;i--) for(int j=m;j;j--) if(a[i][j]=='.')\n\t{\n\t\tif(a[i][j+1]=='#') rt[i][j]=id(i,j);\n\t\telse rt[i][j]=rt[i][j+1];\n\t\tif(a[i+1][j]=='#') dn[i][j]=id(i,j);\n\t\telse dn[i][j]=dn[i+1][j];\n\t}\n\t//build\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++) if(a[i][j]=='.')\n\t{\n\t\tif(a[i][j+1]=='.') Inc(id(i,j),id(i,j+1),1);\n\t\tif(a[i+1][j]=='.') Inc(id(i,j),id(i+1,j),1);\n\t\tif(lt[i][j]!=id(i,j)) inc(id(i,j),lt[i][j],bs[i][j]);\n\t\tif(up[i][j]!=id(i,j)) inc(id(i,j),up[i][j],bs[i][j]);\n\t\tif(rt[i][j]!=id(i,j)) inc(id(i,j),rt[i][j],bs[i][j]);\n\t\tif(dn[i][j]!=id(i,j)) inc(id(i,j),dn[i][j],bs[i][j]);\n\t}\n\t//Dijkstra\n\tfor(int i=1;i<=n*m;i++) dis[i]=inf;\n\tdis[start]=0,dijkstra.push((ok){start,0});\n\twhile(!dijkstra.empty())\n\t{\n\t\tint x=dijkstra.top().x,l=dijkstra.top().y;\n\t\tdijkstra.pop();\n\t\tif(l>dis[x]) continue;\n\t\tfor(int i=first[x],v;i;i=nxt[i]) if(dis[v=to[i]]>dis[x]+lth[i])\n\t\t{\n\t\t\tdis[v]=dis[x]+lth[i];\n\t\t\tdijkstra.push((ok){v,dis[v]});\n\t\t}\n\t}\n\tif(dis[end]!=inf) printf(\"%d\",dis[end]);\n\telse printf(\"nemoguce\");\n\treturn 0;\n}\n```\n\n\uff08\u4ee5\u524d\u4ee3\u7801\u4e60\u60ef\u4e3a\uff0c\u80fd\u5728\u4e3b\u51fd\u6570\u91cc\u9762\u88c5\u7740\u7684\u5c31\u4e0d\u65b0\u5efa\u51fd\u6570\uff0c\u6240\u4ee5\u770b\u7740\u6709\u70b9\u522b\u626d\uff1b\u7531\u4e8e\u61d2\u5f97\u6539\u4e86\uff0c\u5c31\u52a0\u4e86\u70b9\u6ce8\u91ca\u3002\uff09\n\n\u5b8c\u7ed3\u6492\u82b1owo\u3002",
        "postTime": 1635766677,
        "uid": 485780,
        "name": "Perta",
        "ccfLevel": 7,
        "title": "P4442 [COCI2017-2018#3] Portal"
    },
    {
        "content": "- ## \u5ba1\u9898\n\u9898\u4e2d\u6240\u8bf4\u7684\u8d70\u6cd5\u6709\u4e24\u79cd\uff1a\n\n1. \u5411\u5468\u56f4\u56db\u8054\u901a\u7684\u683c\u5b50\u8d70\u4e00\u6b65\n\n2. \u53d1\u4e24\u67aa\u4f20\u9001\u95e8\uff0c\u5728\u4e00\u6247\u4f20\u9001\u95e8\u524d\u8d70\u5230\u53e6\u4e00\u6247\u4f20\u9001\u95e8\u524d\u3002\n\n\u4ee5\u4e0a\u4e24\u79cd\u8d70\u6cd5\u7684\u82b1\u8d39\u90fd\u662f $1$ \u3002\n\n- ## \u601d\u8def\n\u9996\u5148\uff0c\u7528**\u524d\u7f00\u548c**\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u4f4d\u7f6e\u5f80\u524d\u548c\u5f80\u4e0a\u7684\u969c\u788d\u7269\u6570\u91cf:\n```cpp\n\t//g[][]\u8868\u793a\u884c\u95f4\u7684\u969c\u788d\u7269\u6570\u91cf\uff0cl[][]\u8868\u793a\u5217\u95f4\u7684\u969c\u788d\u7269\u6570\u91cf\uff0ce[][]\u8868\u793a\u8be5\u4f4d\u7f6e\u662f\u5426\u6709\u969c\u788d\u7269\u3002 \n\tfor(RI i=1;i<=n;i=-~i){\n\t\tfor(RI j=1;j<=m;j=-~j){\n\t\t\tg[i][j]=g[i][j-1]+e[i][j];\n\t\t\tl[i][j]=l[i-1][j]+e[i][j];\n\t\t}\n\t} \n```\n\n\u63a5\u7740\uff0c\u7528**\u500d\u589e**\u6c42\u51fa\u6bcf\u4e2a\u7a7a\u4f4d\u7684\u56db\u4e2a\u65b9\u5411\u7684\u969c\u788d\u7269**\u4e4b\u524d\u7684\u65e0\u969c\u788d\u533a\u57df**\u7684\u5750\u6807\uff1a\n```cpp \n\t//a[i][j][t][0]\u548ca[i][j][t][1]\u5206\u522b\u8868\u793a\u5750\u6807(i,j)\u7684t\u65b9\u5411\u7684\u65e0\u969c\u788d\u533a\u57df\u3002\n\t//\u4e0a\u884c\u6ce8\u91ca\u7684t\u4ece0\u52303\u5206\u522b\u8868\u793a\u4e0a\u3001\u4e0b\u3001\u5de6\u3001\u53f3\u3002 \n\tfor(RI i=1;i<=n;i=-~i)\n\t\tfor(RI j=1;j<=m;j=-~j)\n\t\t\tif(!e[i][j]){\t\n\t\t\t\tx=i;y=j;p=1;r=y;\n\t\t\t\twhile(p&&r<m)//\u500d\u589e\u6c42\u89e3 \n\t\t\t\t\tif(r+p<=m&&g[x][r+p]-g[x][r]==0) r+=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r<m)\n\t\t\t\t\ta[i][j][3][1]=r,a[i][j][3][0]=x;\n\t\t\t\tp=1;r=y;\n\t\t\t\twhile(p&&r>1)\n\t\t\t\t\tif(r>p&&g[x][r]-g[x][r-p-1]==0) r-=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r>1) a[i][j][2][1]=r,a[i][j][2][0]=x;\n\t\t\t\tp=1;r=x;\n\t\t\t\twhile(p&&r<n)\n\t\t\t\t\tif(r+p<=n&&l[r+p][y]-l[r][y]==0) r+=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r<n) a[i][j][1][0]=r,a[i][j][1][1]=y;\n\t\t\t\tp=1;r=i;\n\t\t\t\twhile(p&&r>1)\n\t\t\t\t\tif(r>p&&l[r][y]-l[r-p-1][y]==0) r-=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r>1) a[i][j][0][0]=r,a[i][j][0][1]=y;\n\t\t\t} \n```\n\u6700\u540e\uff0c\u518d\u8dd1\u4e00\u904d\u5806\u4f18\u7684 dijkstra :\n```\n\t//#define ru(x) q.push((du){-f[x],x})\n\tmemset(f,127/3,sizeof f);\n\tf[qd]=0;ru(qd);\n\twhile(q.size()){\n\t\tu=q.top().second;q.pop();\n\t\tif(b[u]) continue;\n\t\tb[u]=1;\n\t\tfor(RI i=h[u];i;i=d[i].n){\n\t\t\tv=d[i].t;s=d[i].s;\n\t\t\tif(f[v]>f[u]+s)\n\t\t\t\tf[v]=f[u]+s,ru(v);\n\t\t}\n\t}\n```\n- ## \u5751\u70b9\n\u672c\u9898\u7684\u5751\u70b9\u4e5f\u662f\u672c\u9898\u7684\u96be\u70b9\u5c31\u5728\u4e8e\u5efa\u56fe\uff0c\u4ee5\u4e0b\u662f\u6211\u4e00\u76f4\u5361\u5728 $78$ \u5206\u7684\u4ee3\u7801\uff1a\n```cpp\n\tfor(RI i=1;i<=n;i=-~i)\n\t\tfor(RI j=1;j<=m;j=-~j)\n\t\t\tif(!e[i][j]){\n\t\t\t\ts=cg(i,j);\n\t\t\t\tfor(RI t=0;t<4;t=-~t){\n\t\t\t\t\tx=mx[t]+i;y=my[t]+j;\n\t\t\t\t\tif(pd(x,y)) continue;\n\t\t\t\t\tif(!e[x][y]) add(s,cg(x,y));\n\t\t\t\t\telse{\n\t\t\t\t\t\tfor(RI k=0;k<4;k=-~k)\n\t\t\t\t\t\t\tif(k!=t&&abs(a[i][j][k][0]-i)+abs(a[i][j][k][1]-j)>0)\n\t\t\t\t\t\t\t\tadd(s,cg(a[i][j][k][0],a[i][j][k][1]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n``` \n\u8fd9\u79cd\u8d2a\u5fc3\u4e4b\u6240\u4ee5\u6709\u9519\u8bef\uff0c\u662f\u56e0\u4e3a\u4e0d\u4e00\u5b9a\u8981\u5728\u8d70\u8fdb\u4f20\u9001\u95e8\u524d\u4e00\u79d2\u624d\u80fd\u53d1\u4f20\u9001\u95e8\u67aa\uff0c\u4f60\u5b8c\u5168\u53ef\u4ee5\u5728\u8d70\u591a\u6b65\u4e4b\u524d\u5c31\u5f00\u67aa\uff0c\u7ecf\u6539\u6b63\u540e\u7684\u5efa\u56fe\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n\tfor(RI i=1;i<=n;i=-~i)\n\t\tfor(RI j=1;j<=m;j=-~j)\n\t\t\tif(!e[i][j]){\n\t\t\t\ts=cg(i,j);\n\t\t\t\tminl=1e9;\n\t\t\t\tfor(RI t=0;t<4;t=-~t){\n\t\t\t\t\tx=mx[t]+i;y=my[t]+j;\n\t\t\t\t\tif(pd(x,y)) continue;\n\t\t\t\t\tif(!e[x][y]) add(s,cg(x,y));\n\t\t\t\t\tdis=abs(a[i][j][t][0]-i)+abs(a[i][j][t][1]-j);\n\t\t\t\t\tif(dis<minl) minl=dis,p=t;//\u627e\u5230\u56db\u4e2a\u65b9\u5411\u7684\u6700\u77ed\u8ddd\u79bb \n\t\t\t\t}\n\t\t\t\tminl=-~minl;//\u6ce8\u610f\u8d70\u8fdb\u4f20\u9001\u95e8\u4e5f\u9700\u82b1\u8d39$1$ \n\t\t\t\tfor(RI t=0;t<4;t=-~t)\n\t\t\t\t\tif(t!=p)\n\t\t\t\t\t\tadd(s,cg(a[i][j][t][0],a[i][j][t][1]),minl);\n\t\t\t}\n```\n\u6700\u540e\u5949\u4e0a\u5b8c\u6574\u7684AC\u4ee3\u7801\uff1a \n```cpp\n#include<bits/stdc++.h>\n#define RI register int \n#define pd(x,y) x<1||y<1||x>n||y>m\n#define du pair<int,int>\n#define ru(x) q.push((du){-f[x],x})\nusing namespace std;\nconst int N=502;\nconst int M=N*N;\nstruct wu{\n\tint n,t,s;\n}d[M<<3];\nint n,m,f[M],h[M],z,g[N][N],l[N][N],a[N][N][4][2];\nbool b[M],e[N][N];char c[N];\ninline int cg(int x,int y){return (x-1)*m+y;}\ninline void add(int u,int v,int s=1){\n\tz=-~z;d[z].t=v;d[z].s=s;\n\td[z].n=h[u];h[u]=z;\n}\npriority_queue<du>q;\nint mx[]={-1,1,0,0},my[]={0,0,-1,1};\ninline int min(int x,int y){return x<y?x:y;}\nint main(){\n\tRI u,v,s,x,y,qd,zd,dis,p,r,minl;\n\tscanf(\"%d%d\",&n,&m);\n\tfor(RI i=1;i<=n;i=-~i){\n\t\tscanf(\"%s\",c+1);\n\t\tfor(RI j=1;j<=m;j=-~j){\n\t\t\tif(c[j]=='C') qd=cg(i,j);\n\t\t\telse if(c[j]=='F') zd=cg(i,j);\n\t\t\tdis=e[i][j]=c[j]=='#';\n\t\t\tg[i][j]=g[i][j-1]+dis;\n\t\t\tl[i][j]=l[i-1][j]+dis;\n\t\t}\n\t}\n\tfor(RI i=1;i<=n;i=-~i)\n\t\tfor(RI j=1;j<=m;j=-~j)\n\t\t\tif(!e[i][j]){\t\n\t\t\t\tx=i;y=j;\n\t\t\t\tp=1;r=y;\n\t\t\t\twhile(p&&r<m)\n\t\t\t\t\tif(r+p<=m&&g[x][r+p]-g[x][r]==0) r+=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r<m)\n\t\t\t\t\ta[i][j][3][1]=r,a[i][j][3][0]=x;\n\t\t\t\tp=1;r=y;\n\t\t\t\twhile(p&&r>1)\n\t\t\t\t\tif(r>p&&g[x][r]-g[x][r-p-1]==0) r-=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r>1) a[i][j][2][1]=r,a[i][j][2][0]=x;\n\t\t\t\tp=1;r=x;\n\t\t\t\twhile(p&&r<n)\n\t\t\t\t\tif(r+p<=n&&l[r+p][y]-l[r][y]==0) r+=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r<n) a[i][j][1][0]=r,a[i][j][1][1]=y;\n\t\t\t\tp=1;r=i;\n\t\t\t\twhile(p&&r>1)\n\t\t\t\t\tif(r>p&&l[r][y]-l[r-p-1][y]==0) r-=p,p<<=1;\n\t\t\t\t\telse p>>=1;\n\t\t\t\tif(r>1) a[i][j][0][0]=r,a[i][j][0][1]=y;\n\t\t\t}\n\tfor(RI i=1;i<=n;i=-~i)\n\t\tfor(RI j=1;j<=m;j=-~j)\n\t\t\tif(!e[i][j]){\n\t\t\t\ts=cg(i,j);\n\t\t\t\tminl=1e9;\n\t\t\t\tfor(RI t=0;t<4;t=-~t){\n\t\t\t\t\tx=mx[t]+i;y=my[t]+j;\n\t\t\t\t\tif(pd(x,y)) continue;\n\t\t\t\t\tif(!e[x][y]) add(s,cg(x,y));\n\t\t\t\t\tdis=abs(a[i][j][t][0]-i)+abs(a[i][j][t][1]-j);\n\t\t\t\t\tif(dis<minl) minl=dis,p=t;\n\t\t\t\t}\n\t\t\t\tminl=-~minl;\n\t\t\t\tfor(RI t=0;t<4;t=-~t)\n\t\t\t\t\tif(t!=p)\n\t\t\t\t\t\tadd(s,cg(a[i][j][t][0],a[i][j][t][1]),minl);\n\t\t\t}\n\tmemset(f,127/3,sizeof f);\n\tf[qd]=0;ru(qd);\n\twhile(q.size()){\n\t\tu=q.top().second;q.pop();\n\t\tif(b[u]) continue;\n\t\tb[u]=1;\n\t\tfor(RI i=h[u];i;i=d[i].n){\n\t\t\tv=d[i].t;s=d[i].s;\n\t\t\tif(f[v]>f[u]+s)\n\t\t\t\tf[v]=f[u]+s,ru(v);\n\t\t}\n\t}\n\tif(f[zd]>1e8) printf(\"nemoguce\");\n\telse printf(\"%d\",f[zd]);\n\treturn 0;\n}\n```",
        "postTime": 1614954693,
        "uid": 133037,
        "name": "_OccDreamer_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3  P4442 [COCI2017-2018#3] Portal"
    },
    {
        "content": "\u849f\u84bb\u5c45\u7136A\u4e86\u9ed1\u9898\uff08\u96fe\uff09~~\u6211\u624d\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u8003\u573a\u72060\u5462~~\u5176\u5b9e\u8fd9\u662f\u4e00\u4e2aidea\u5f88nice\u7684\u9898\u76ee\n\n\u5982\u679c\u6ca1\u6709\u7ffb\u8bd1\u7684\u8bdd\u53ef\u4ee5\u51d1\u5408\u770b\u770b\u8fd9\u4e2a\uff0c[COCI2017-2018 3#Portal](https://www.luogu.org/blog/mycute-is-so-cuteQAQ/luo-gu-p4442-coci2017-20183-portal-ti-mu-tai-yi-post)~~\u4e0d\u8981\u8138\u7684\u63a8\u9500\u81ea\u5df1\u7684blog~~\n\n\u8fd9\u9898\u662f\u4e00\u4e2a\u77e9\u9635\u7684\u6700\u77ed\u8def\u5f84\uff0c\u7b2c\u4e00\u65f6\u95f4\u60f3\u5230\u5bbd\u641c\u3002\u53ef\u8fd9\u4e00\u9898\u6709\u4e00\u4e2a\u9ebb\u70e6\u7684\u4f20\u9001\u95e8\u600e\u4e48\u5904\u7406\uff1f\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u7c7b\u4f3c\u8d2a\u5fc3\u7684\u4e1c\u897f\uff0c\u5f53\u6211\u4eec\u5728\u5bbd\u641c\u6269\u5c55\u8282\u70b9\u65f6\uff0c\u9047\u5230\u5899\u58c1\u624d\u4f7f\u7528\u4f20\u9001\u95e8\u3002\u5176\u5b9e\u5c31\u662f\u591a\u4e86\u4e09\u4e2a\u6269\u5c55\u89c4\u5219\uff0c\u5728\u539f\u5148\u77e9\u9635\u5bbd\u641c\u7684\u57fa\u7840\u4e0a\u628a\u5750\u6807\u6539\u4e3a\u6240\u80fd\u5230\u8fbe\u7684\u5899\u7684\u5750\u6807\u5373\u53ef\u3002\u5f53\u7136\uff0c\u6211\u4eec\u8981\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5230\u56db\u4e2a\u65b9\u5411\u5899\u7684\u8ddd\u79bb\uff0c\u8fd9\u91cc\u6211\u7528\u7684\u662f4\u4e2a\u4e24\u91cd\u5faa\u73af\u66b4\u529b\u679a\u4e3e\u3002\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int dx[4]={0,0,1,-1};\nconst int dy[4]={1,-1,0,0};\nint n,m,xx,yy,ans;\nint visit[505][505];\nchar a[505][505];\nstruct data\n{\n    int x,y,t;\n};\nqueue<data> q;\nstruct Nobe\n{\n    int nx[10],ny[10];\n}sum[505][505];\nvoid bfs(int x,int y,int t)\n{\n    data tmp;\n    tmp.x=x,tmp.y=y;tmp.t=0;\n    q.push(tmp);\n    while (!q.empty())\n    {\n        data t=q.front();\n        int kx=-1,ky=-1;\n        for (int i=0;i<4;i++)\n        {\n            int nx=t.x+dx[i];\n            int ny=t.y+dy[i];\n            int nt=t.t+1;\n            if (nx<1||nx>n||ny<1||ny>m||visit[nx][ny]==1) continue;\n            if (a[nx][ny]=='#') {kx=nx;ky=ny;continue;\n            }\n            visit[nx][ny]=1;\n            if (nx==xx&&ny==yy) {cout<<nt;exit(0);\n            }\n            data tmp1;\n            tmp1.x=nx;\n            tmp1.y=ny;\n            tmp1.t=nt;\n            q.push(tmp1);\n        }\t\n        if (kx!=-1&&ky!=-1)\n        {\n            for (int i=1;i<=4;i++)\n            {\n                if ((kx==sum[t.x][t.y].nx[i]&&ky==sum[t.x][t.y].ny[i])\n                ||(visit[sum[t.x][t.y].nx[i]][sum[t.x][t.y].ny[i]]==1)) \n                continue;\n                data tmp1;\n                tmp1.x=sum[t.x][t.y].nx[i];\n                tmp1.y=sum[t.x][t.y].ny[i];\n                tmp1.t=t.t+1;\n                visit[tmp1.x][tmp1.y]=1;\n                if (tmp1.x==xx&&tmp1.y==yy) {cout<<tmp1.t;exit(0);\n                }\n                q.push(tmp1);\n            }\n        }\n        q.pop();\n    }\n}\nint x,y;\nint main()\n{\n    //freopen(\"Portal.in\",\"r\",stdin);\n    //freopen(\"Portal.out\",\"w\",stdout);\n    cin>>n>>m;\n    for (int i=1;i<=n;i++)\n     for (int j=1;j<=m;j++)\n      \t {\n      \t \tcin>>a[i][j];\n      \t \tif (a[i][j]=='C'){x=i,y=j;\n      \t \t}\n      \t \tif (a[i][j]=='F'){xx=i,yy=j;\n      \t \t}\n      \t }\n    ans=9999999;\n    int ty=0;\n    for (int i=1;i<=n;i++)\n      for (int j=1;j<=m;j++)\n        {\n        \tif (a[i][j]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tsum[i][j].nx[1]=i;\n        \t\tsum[i][j].ny[1]=ty+1;\n        \t}\n        }\n    ty=0;\n    for (int i=1;i<=n;i++)\n      for (int j=m;j>=1;j--)\n        {\n        \tif (a[i][j]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tsum[i][j].nx[2]=i;\n        \t\tsum[i][j].ny[2]=ty-1;\n        \t}\n        }\n    ty=0;\n    for (int i=1;i<=m;i++)\n      for (int j=1;j<=n;j++)\n        {\n        \tif (a[j][i]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tsum[j][i].nx[3]=ty+1;\n        \t\tsum[j][i].ny[3]=i;\n        \t}\n        }\n    ty=0;\n    for (int i=1;i<=m;i++)\n      for (int j=n;j>=1;j--)\n        {\n        \tif (a[j][i]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tsum[j][i].nx[4]=ty-1;\n        \t\tsum[j][i].ny[4]=i;\n        \t}\n        }//\n    visit[x][y]=1;\n    bfs(x,y,0);\n    cout<<\"nemoguce\";\n    return 0;\n}\n```\n\u7136\u800c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4ee3\u7801\u53ea\u670990\u5206~~\u5c45\u7136\u670990\u5206\u51fa\u9898\u4eba\u771f\u826f\u5fc3~~\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u8003\u8651\u4e00\u7ec4\u53cd\u4f8b\uff1a\n\n![](https://s8.postimg.cc/6lluyu6gl/image.png)\n\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u7528\u6211\u4eec\u8d2a\u5fc3\u7684\u65b9\u6cd5\u7b54\u6848\u662fs1+s2,\u800c\u5b9e\u9645\u4e0a\u662fs1\uff0c\u53ef\u4ee5hack\u6389\u6211\u4eec\u7684\u8d2a\u5fc3\u3002~~\u5982\u679c\u4f60\u8bf4\u4f60\u53ef\u4ee5\u7ed9bfs\u961f\u5217\u589e\u52a0\u72b6\u6001\u5e76\u7528\u4e00\u4e9b\u5947\u602a\u7684\u59ff\u52bf\u6765\u5224\u91cd\u90a3\u5f53\u849f\u84bb\u4e0b\u9762\u7684\u8bdd\u662f\u5e9f\u8bdd~~\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u539f\u6765\u7684\u60f3\u6cd5\u95ee\u9898\u51fa\u5728\u4f20\u9001\u95e8\u4e0a\u3002\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u6362\u4e2a\u601d\u8def\uff1a\u5b9e\u9645\u4e0a\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u800c\u8a00\uff0c\u5b83\u5230\u56db\u9762\u5899\u7684\u8ddd\u79bb\u4e2d\u7684\u6700\u5c0f\u503c\u5c31\u662f\u5b83\u5230\u56db\u9762\u5899\u7684\u8ddd\u79bb\n\n![](https://s8.postimg.cc/u13s420gl/image.png)\n\u770b\u5230\u8fd9\u4e2a\u4f60\u60f3\u5230\u4ec0\u4e48\uff1f\u677e\u5f1b\uff01\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u4e3a\u5728\u77e9\u9635\u91cc\u8dd1\u6700\u77ed\u8def\u7684\u95ee\u9898\u4e86(\u6ca1\u5199\u8fc7\u7684\u5de6\u8f6c[Why Did the Cow Cross the Road I G](https://www.luogu.org/problemnew/show/P3659))\uff0c\u53ea\u8981\u5728\u539f\u5148\u521d\u59cb\u5316\u65f6\u591a\u8bb0\u5f55\u4e00\u4e2a\u5230\u6700\u8fd1\u5899\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u677e\u5f1b\u7684\u65f6\u5019\u628a\u6bcf\u4e2a\u70b9\u5230\u56db\u4e2a\u5899\u7684\u975e\u6700\u77ed\u8ddd\u79bb\u677e\u5f1b\u6389\u5373\u53ef\u3002\uff08\u6e29\u99a8\u63d0\u793a\uff1a\u77e9\u9635\u6700\u77ed\u8def\u7684\u70b9\u7684\u6570\u91cf\u662f\u77e9\u9635\u7684\u70b9\u6570500*500\uff0c\u4efb\u4f55\u63a5\u8fd1n^2\u7684\u7b97\u6cd5\u90fd\u53ef\u80fd\u8fc7\u4e0d\u4e86\uff09~~\u8fde\u6211\u8fd9\u4e2anlog(n)\u90fd\u5f97\u5f00O2\uff0c\u4f60\u4eecn^2\u8fd8\u60f3\u8fc7\uff1f~~\n\n\u8fd9\u91cc\u7528\u4e86dijkstra+priority-queue\u7684\u5199\u6cd5\uff0c\u5b83\u7684\u601d\u8def\u4e5f\u662f\u53ef\u4ee5\u7684\uff1a\n\t\u5373\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u72b6\u6001\u90fd\u5b58\u5230\u5c0f\u6839\u5806\uff0c\u6b64\u65f6\u4f1a\u6709\u91cd\u590d\u4f4d\u7f6e\u7684\u72b6\u6001\uff0c\u6839\u636edijkstra\u7684\u539f\u7406\uff0c\u5bf9\u4e8e\u5df2\u8bbf\u95ee\u7684\u70b9\uff0c\u5176\u4e00\u5b9a\u662f\u6700\u4f18\u7684\uff0c\u6240\u4ee5\u53d6\u51fa\u72b6\u6001\u65f6\uff0c\u53ef\u4ee5\u628a\u5df2\u8bbf\u95ee\u8fc7\u4f4d\u7f6e\u7684\u72b6\u6001\u5168\u90e8\u6e05\u9664\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u6709\u91cd\u590d\uff0c\u6548\u7387\u4e5f\u4e0d\u4f4e \n    \n\u4ee5\u4e0b\u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\uff0c\u7528SPFA\u662f\u53ef\u4ee5\u8fc7\u7684\uff0c~~\u4e0d\u8fc7\u6211\u6ca1\u5199\u3002\u5b98\u65b9\u8bc4\u6d4b\u53ef\u4ee5\u8fc7\u7684\u4e00\u5b9a\u662f\u8bc4\u6d4b\u673a\u592a\u5361\u4e86~~\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int INF=99999999;\nconst int dx[4]={0,0,1,-1};\nconst int dy[4]={1,-1,0,0};\nint n,m,xx,yy,ans;\nint midis[505][505];\nchar a[505][505];\nstruct data\n{\n    int x,y,t;\n};\ndata s;\nvector<data> v[505][505];\nint visit[505][505];\nbool operator<(const data&a,const data&b)\n{\n\treturn a.t>b.t;\n}\nint dijkstra()\n{\n\tpriority_queue<data> dis;\n\tdis.push(s);\n\twhile(!dis.empty())\n\t{\n\t\tbool flag=false;\n\t\tdata tmp;\n\t\tdo\n\t\t{\n\t\t\tif(dis.empty())\n\t\t\t{\n\t\t\t\tflag=true;break;\n\t\t\t}\n\t\t\ttmp=dis.top();\n\t\t\tdis.pop();\n\t\t}while(visit[tmp.x][tmp.y]==1);\n\t\tif (flag==true) break;\n\t\tvisit[tmp.x][tmp.y]=1;\n\t\tif (tmp.x==xx&&tmp.y==yy) return tmp.t;\n\t\tfor (int i=0;i<4;i++)\n\t\t{\n\t\t\tdata ntmp;\n\t\t\tntmp.x=tmp.x+dx[i];\n\t\t\tntmp.y=tmp.y+dy[i];\n\t\t\tntmp.t=tmp.t+1;\n\t\t\tint nx=ntmp.x,ny=ntmp.y;\n\t\t\tif (nx<1||nx>n||ny<1||ny>m||a[nx][ny]=='#') continue;\n\t\t\tdis.push(ntmp);\n\t\t}\n\t\tfor (int i=0;i<v[tmp.x][tmp.y].size();i++)\n\t\t{\n\t\t\tint nx=tmp.x,ny=tmp.y;\n\t\t\tif (v[nx][ny][i].t==midis[nx][ny]) continue;\n\t\t\tdata ntmp=tmp;\n\t\t\tntmp.x=v[nx][ny][i].x;\n\t\t\tntmp.y=v[nx][ny][i].y;\n\t\t\tntmp.t+=(midis[nx][ny]+1);\n\t\t\tdis.push(ntmp);\n\t\t}\n\t}\n\treturn -1;\n}\nint x,y;\nint main()\n{\n    //freopen(\"Portal.in\",\"r\",stdin);\n    //freopen(\"Portal.out\",\"w\",stdout);\n    std::ios::sync_with_stdio(false);\n    cin>>n>>m;\n    for (int i=1;i<=n;i++)\n     for (int j=1;j<=m;j++)\n      \t {\n      \t \tcin>>a[i][j];\n      \t \tif (a[i][j]=='C'){s.x=i,s.y=j;a[i][j]='.';\n      \t \t}\n      \t \tif (a[i][j]=='F'){xx=i,yy=j;a[i][j]='.';\n      \t \t}\n      \t }\n    for (int i=1;i<=n;i++)\n     for (int j=1;j<=m;j++)\n       midis[i][j]=INF;\n    int ty=0;\n    for (int i=1;i<=n;i++)\n      for (int j=1;j<=m;j++)\n        {\n        \tif (a[i][j]=='#') ty=j;\n        \telse\n        \t{\n        \t\tmidis[i][j]=min(midis[i][j],j-ty-1);//\u8ddd\u79bb\u4e00\u5b9a\u4e0d\u80fd\u9519\uff0c\u8981\u4ed4\u7ec6\u601d\u8003\uff0c\u624b\u753b\u4f8b\u5b50\uff01\uff01 \n        \t\tdata tmp;\n        \t\ttmp.x=i;\n        \t\ttmp.y=ty+1;\n        \t\ttmp.t=j-ty;\n        \t\tv[i][j].push_back(tmp);\n        \t}\n        }\n    ty=0;\n    for (int i=1;i<=n;i++)\n      for (int j=m;j>=1;j--)\n        {\n        \tif (a[i][j]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tmidis[i][j]=min(midis[i][j],ty-j-1);\n        \t\tdata tmp;\n        \t\ttmp.x=i;\n        \t\ttmp.y=ty-1;\n        \t\ttmp.t=ty-j;\n        \t\tv[i][j].push_back(tmp);\n        \t}\n        }\n    ty=0;\n    for (int i=1;i<=m;i++)\n      for (int j=1;j<=n;j++)\n        {\n        \tif (a[j][i]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tmidis[j][i]=min(midis[j][i],j-ty-1);\n        \t\tdata tmp;\n        \t\ttmp.x=ty+1;\n        \t\ttmp.y=i;\n        \t\ttmp.t=j-ty;\n        \t\tv[j][i].push_back(tmp);\n        \t}\n        }\n    ty=0;\n    for (int i=1;i<=m;i++)\n      for (int j=n;j>=1;j--)\n        {\n        \tif (a[j][i]=='#') \n        \t{\n        \t\tty=j;\n        \t}\n        \telse\n        \t{\n        \t\tmidis[j][i]=min(midis[j][i],ty-j-1);\n        \t\tdata tmp;\n        \t\ttmp.x=ty-1;\n        \t\ttmp.y=i;\n        \t\ttmp.t=ty-j;\n        \t\tv[j][i].push_back(tmp);\n        \t}\n        }\n    ans=dijkstra();\n    if (ans==-1) cout<<\"nemoguce\";\n    else cout<<ans;\n    return 0;\n}\n```\n~~\u968f\u4fbf\u6284\u88ad\uff0c\u8fc7\u4e86\u7b97\u6211\u8f93~~",
        "postTime": 1534776881,
        "uid": 78195,
        "name": "\u668c\u8fdd",
        "ccfLevel": 0,
        "title": "\u6d1b\u8c37P4442 [COCI2017-2018#3] Portal \u9898\u89e3"
    },
    {
        "content": "## Portal \u9898\u89e3\n\n\u9898\u76ee\u5927\u610f\uff0c\u4ece $C$ \u8d70\u5230 $F$ \uff0c\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c\u4e00\u662f\u66b4\u529b\u8d70\uff0c\u8017\u65f6 $1s$\uff0c\u4e8c\u662f\u9020\u4f20\u9001\u95e8\uff0c\u4f20\u9001\u95e8\u6700\u591a\u540c\u65f6\u5b58\u5728\u4e24\u4e2a\uff0c\u4e4b\u524d\u7684\u90fd\u4f1a\u6d88\u5931\uff0c\u4f20\u9001\u95e8\u4e24\u7aef\u4e92\u901a\uff0c\u9020\u4f20\u9001\u95e8\u4e0d\u8017\u65f6\uff0c\u8d70\u4f20\u9001\u95e8\u8017\u65f6\u3002\n\n-----\n\n### Part1\n\n\u7eaf BFS\uff0c\u4e0d\u8003\u8651\u4f20\u9001\u95e8\uff0c\u53ef\u4ee5\u5f97 31pts\u3002\n\n### Part2\n\n\u53ea\u8003\u8651\u5728\u5899\u8fb9\u5f00\u4f20\u9001\u95e8\u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u5728\u6bcf\u4e2a\u5899\u8fb9\u7684\u70b9\u8fdb\u884c\u989d\u5916\u6269\u5c55\uff0c\u8fde\u7eed\u5f00\u4e24\u67aa\uff0c\u4e00\u67aa\u671d\u7740\u6328\u7740\u7684\u5899\uff0c\u4e00\u67aa\u671d\u7740\u6ca1\u6328\u7740\u7684\u5899\uff0c\u8fdb\u884c\u4ee3\u4ef7\u4e3a $1$ \u7684\u4f20\u9001\uff0c\u66f4\u65b0\u53ef\u901a\u8fc7\u8be5\u4f20\u9001\u95e8\u5230\u8fbe\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u5f97\u5230 85pts\u3002\n\n### Part3\n\n\u53ef\u4ee5\u5728 Part2 \u7684\u57fa\u7840\u4e0a\u8003\u8651\u8fdb\u884c\u66f4\u6df1\u5c42\u6b21\u7684\u6269\u5c55\uff0c\u5176\u5b9e\u4e5f\u662f\u8fde\u7eed\u5f00\u4e24\u67aa\uff0c\u53ea\u4e0d\u8fc7\u4ee3\u4ef7\u53d8\u6210\u4e86\u5230\u6700\u8fd1\u7684\u5899\u7684\u8ddd\u79bb\u3002\n\n\u5177\u4f53\u7ec6\u8282\uff1a\n\n- \u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5230\u5176\u4e0a\u4e0b\u5de6\u53f3\u56db\u4e2a\u65b9\u5411\u7684\u7b2c\u4e00\u5835\u5899\uff0c\u7136\u540e\u8bb0\u5f55\u5230\u6700\u8fd1\u7684\u4e00\u4e2a\u65b9\u5411\u7684\u5899\u7684\u8ddd\u79bb\u3002\n- \u7136\u540e\u8003\u8651\u6269\u5c55\uff0c\u66b4\u529b\u6269\u5c55\u548c\u7528\u4f20\u9001\u95e8\u8df3\u53ef\u4ee5\u4e00\u8d77\u6269\u5c55\uff0c\u8fd9\u91cc\u6709\u4e2a\u5c0f\u53ea\u56e0\u5de7\uff0c\u53ef\u4ee5\u4f7f\u7528\u4f18\u5148\u961f\u5217\u4f18\u5316 BFS\uff0c\u6bcf\u6b21\u7528\u70b9\u6743\u6700\u5c0f\u7684\u8fdb\u884c\u66f4\u65b0\uff0c\u8ddf Dj \u4e00\u6837\u505a\u5230 $O(nm \\log(nm))$ \u7684\u6548\u7387\u3002\n- \u6700\u540e\u5982\u679c\u66f4\u65b0\u5230 $F$ \u70b9\u5219\u6709\u7b54\u6848\uff0c\u53cd\u4e4b\u5219\u65e0\u89e3\u3002\n\n\u8fd9\u6837\u64cd\u4f5c\u7684\u6700\u4f18\u6027\u4e5f\u53ef\u4ee5\u8bc1\u660e\uff0c\u8003\u8651\u5f80\u56de\u627e\u4e0a\u4e00\u4e2a\u4f20\u9001\u95e8\uff0c\u90a3\u4e48\u4e0a\u4e00\u4e2a\u4f20\u9001\u95e8\u7684\u4f4d\u7f6e\u4e00\u5b9a\u6709\u4e00\u5835\u5899\uff0c\u4e0e\u5176\u8d70\u5df2\u7ecf\u8d70\u8fc7\u7684\u8def\uff0c\u4e0d\u5982\u518d\u5f00\u4e00\u4e2a\u4f20\u9001\u95e8\uff0c\u53cd\u800c\u53ef\u4ee5\u7701\u53bb\u4e00\u4e9b\u8fc2\u56de\u7684\u8ddd\u79bb\u3002\n\n\u590d\u6742\u5ea6\u7684\u9650\u5236\u5176\u5b9e\u662f\u9884\u5904\u7406\uff0c\u6548\u7387\u6700\u5927 $O(nm\\times \\max(n,m))$\u3002\n\n## CODE\n\n```c++\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int inf=0x3f3f3f3f;\ntemplate<typename T>inline void read(T &x){\n\tx=0;\n\tchar c=getchar();\n\tT ret=0;\n\twhile(!isdigit(c))ret|=!(c^'-'),c=getchar();\n\twhile(isdigit(c))x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\tif(ret)x=(~x)+1;\n\treturn;\n}\ntemplate<typename T>inline void print(T x){\n\tif(x<0)putchar('-'),x=(~x)+1;\n\tif(x>9)print(x/10);\n\tputchar((x-x/10*10)^48);\n\treturn;\n}\ntemplate<typename T>inline void wr1(T x){\n\tprint(x);\n\tputchar(' ');\n\treturn;\n}\ntemplate<typename T>inline void wr2(T x){\n\tprint(x);\n\tputchar('\\n');\n\treturn;\n}\nstruct jl{\n\tint u,d,l,r,mi;\n}nm[510][510];\nint n,m,dis[510][510],c1[]={1,0,-1,0},c2[]={0,1,0,-1};\nbool pd[510][510],vis[510][510];\nchar mp[510][510];\npriority_queue<pair<int,pair<int,int>>>q;\npair<int,int>s;\npair<int,int>t;\njl work(int x,int y){//\u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u5230\u56db\u4e2a\u65b9\u5411\u5899\u7684\u8ddd\u79bb\n\tjl a;\n\tint X=x-1,Y=y;\n\twhile(mp[X][Y]!='#'&&X>0){\n\t\tX--;\n\t}\n\tif(X==0)a.u=0;\n\telse a.u=x-X;\n\tX=x+1,Y=y;\n\twhile(mp[X][Y]!='#'&&X<=n){\n\t\tX++;\n\t}\n\tif(X==n+1)a.d=0;\n\telse a.d=X-x;\n\tX=x,Y=y-1;\n\twhile(mp[X][Y]!='#'&&Y>0){\n\t\tY--;\n\t}\n\tif(Y==0)a.l=0;\n\telse a.l=y-Y;\n\tX=x,Y=y+1;\n\twhile(mp[X][Y]!='#'&&Y<=m){\n\t\tY++;\n\t}\n\tif(Y==m+1)a.r=0;\n\telse a.r=Y-y;\n\ta.mi=1e9;\n\tif(a.l){\n\t\ta.mi=min(a.mi,a.l);\n\t}\n\tif(a.r){\n\t\ta.mi=min(a.mi,a.r);\n\t}\n\tif(a.u){\n\t\ta.mi=min(a.mi,a.u);\n\t}\n\tif(a.d){\n\t\ta.mi=min(a.mi,a.d);\n\t}\n\treturn a;\n}\nint main(){\n//\tfreopen(\"portal.in\",\"r\",stdin);\n//\tfreopen(\"portal.out\",\"w\",stdout);\n    read(n);\n    read(m);\n    for(int i=1;i<=n;++i){\n    \tscanf(\"%s\",mp[i]+1);\n\t}\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=m;++j){//\u9884\u5904\u7406\n\t\t\tif(mp[i][j]=='C'){\n\t\t\t\ts.first=i;\n\t\t\t\ts.second=j;\n\t\t\t\tnm[i][j]=work(i,j);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(mp[i][j]=='F'){\n\t\t\t\t\tt.first=i;\n\t\t\t\t\tt.second=j;\n\t\t\t\t\tnm[i][j]=work(i,j);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(mp[i][j]=='.'){\n\t\t\t\t\t\tnm[i][j]=work(i,j);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tmemset(dis,0x3f,sizeof dis);\n\tdis[s.first][s.second]=0;\n\tq.push(make_pair(0,s));\n\twhile(!q.empty()){\n\t\tint x=q.top().second.first;\n\t\tint y=q.top().second.second;\n\t\tq.pop();\n\t\tif(vis[x][y])continue;\n\t\tvis[x][y]=1;\n\t\tfor(int i=0;i<4;++i){//\u66b4\u529b\u6269\u5c55\n\t\t\tint xx=x+c1[i];\n\t\t\tint yy=y+c2[i];\n\t\t\tif(xx>0&&xx<=n&&yy>0&&yy<=m&&mp[xx][yy]!='#'){\n\t\t\t\tif(dis[xx][yy]>dis[x][y]+1){\n\t\t\t\t\tdis[xx][yy]=dis[x][y]+1;\n\t\t\t\t\tq.push(make_pair(-dis[xx][yy],make_pair(xx,yy)));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(nm[x][y].l>nm[x][y].mi){//\u4ee5\u4e0b\u56db\u4e2a\u90fd\u662f\u4f20\u9001\u95e8\u6269\u5c55\n\t\t\tint yy=y-nm[x][y].l+1;\n\t\t\tif(dis[x][yy]>dis[x][y]+nm[x][y].mi){\n\t\t\t\tdis[x][yy]=dis[x][y]+nm[x][y].mi;\n\t\t\t\tq.push(make_pair(-dis[x][yy],make_pair(x,yy)));\n\t\t\t}\n\t\t}\n\t\tif(nm[x][y].r>nm[x][y].mi){\n\t\t\tint yy=y+nm[x][y].r-1;\n\t\t\tif(dis[x][yy]>dis[x][y]+nm[x][y].mi){\n\t\t\t\tdis[x][yy]=dis[x][y]+nm[x][y].mi;\n\t\t\t\tq.push(make_pair(-dis[x][yy],make_pair(x,yy)));\n\t\t\t}\n\t\t}\n\t\tif(nm[x][y].u>nm[x][y].mi){\n\t\t\tint xx=x-nm[x][y].u+1;\n\t\t\tif(dis[xx][y]>dis[x][y]+nm[x][y].mi){\n\t\t\t\tdis[xx][y]=dis[x][y]+nm[x][y].mi;\n\t\t\t\tq.push(make_pair(-dis[xx][y],make_pair(xx,y)));\n\t\t\t}\n\t\t}\n\t\tif(nm[x][y].d>nm[x][y].mi){\n\t\t\tint xx=x+nm[x][y].d-1;\n\t\t\tif(dis[xx][y]>dis[x][y]+nm[x][y].mi){\n\t\t\t\tdis[xx][y]=dis[x][y]+nm[x][y].mi;\n\t\t\t\tq.push(make_pair(-dis[xx][y],make_pair(xx,y)));\n\t\t\t}\n\t\t}\n\t}\n\tif(dis[t.first][t.second]>1e9){//\u4e0d\u80fd\u5230\u8fbe\n\t\tputs(\"nemoguce\");\n\t}\n\telse{\n\t\tprint(dis[t.first][t.second]);\n\t}\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1667386882,
        "uid": 591138,
        "name": "Hide_In_The_Shadow",
        "ccfLevel": 7,
        "title": "P4442 [COCI2017-2018#3] Portal"
    },
    {
        "content": "\u9996\u5148\u8003\u8651\u4f20\u9001\u95e8\u7684\u4f5c\u7528\uff0c\u90a3\u5c31\u662f\u4f7f\u6211\u80fd\u66f4\u5feb\u5730\u8d70\u5230\u7ec8\u70b9\uff0c\u4e5f\u5c31\u662f\u8df3\u8fc7\u4e00\u6bb5\u8def\u7ecf\u3002\n\n\u90a3\u4e48\u65e2\u7136\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5728\u9700\u8981\u4f20\u9001\u65f6\u5148\u6253\u4f20\u9001\u95e8\uff0c\u7136\u540e\u627e\u5230\u4e00\u4e2a\u5899\u6253\u4f20\u9001\u95e8\u518d\u4f20\u9001\u5373\u53ef\u3002\n\n\u5f88\u660e\u663e\u9009\u62e9\u7684\u5899\u5373\u662f\u79bb\u81ea\u5df1\u6700\u8fd1\u7684\u5899\u3002\n\n\u4f46\u662f\u8fd9\u6837\u660e\u663e\u9ebb\u70e6\u4e86\uff0c\u5b9e\u9645\u4e0a\u4e00\u5b9a\u4f1a\u5b58\u5728\u81ea\u5df1\u6216\u53e6\u4e00\u4e2a\u4e0d\u662f\u5899\u7684\u70b9\u80fd\u540c\u65f6\u6253\u5230\u79bb\u81ea\u5df1\u6700\u8fd1\u7684\u5899\u4e0e\u8981\u6253\u4f20\u9001\u95e8\u7684\u5899\u3002\n\n\u8003\u8651\u8bc1\u660e\uff0c\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u90a3\u4e48\u79bb\u81ea\u5df1\u6700\u8fd1\u7684\u5899\u4e00\u5b9a\u662f\u80fd\u540c\u65f6\u6253\u5230\u4ed6\u4eec\u7684\u70b9\uff0c\u8fd9\u6837\u6253\u5230\u7684\u5899\u5c31\u4e0d\u7b26\u5408\u8981\u6c42\u4e86\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u9884\u5904\u7406\u5efa\u56fe\uff0c\u7136\u540e\u8dd1\u6700\u77ed\u8def\u3002\n\n\u9884\u5904\u7406\u5efa\u56fe\u65f6\u5148\u627e\u5230\u6bcf\u4e00\u4e2a\u70b9\u56db\u5468\u7684\u5899\uff0c\u5176\u4e2d\u79bb\u7684\u6700\u8fd1\u7684\u5899\u662f\u81ea\u5df1\u7684\u4f20\u9001\u8d77\u70b9\uff0c\u800c\u8f83\u8fdc\u7684\u5176\u4ed6\u5899\u662f\u4f20\u9001\u7ec8\u70b9\uff0c\u5bf9\u6bcf\u4e2a\u4f20\u9001\u7ec8\u70b9\u8fde\u63a5\u8fb9\u6743\u4e3a\u5230\u4f20\u9001\u8d77\u70b9\u7684\u65f6\u95f4\u52a0\u4f20\u9001\u65f6\u95f4\u7684\u8fb9\u5373\u53ef\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5411\u76f8\u90bb\u975e\u5899\u70b9\u8fde\u8fb9\uff0c\u8dd1\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\times m\\times\\log(n\\times m))$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\n#include<cstring>\n#include<queue>\nusing namespace std;\nconst int N=505;\nint n,m,x1,y1,x2,y2,dis[N*N];\nchar s[N][N];\nvector<int>b[N*N];\nvector<pair<int,int> >a[N*N];\ninline int clac(int x,int y)\n{\n\treturn (x-1)*m+y; \n}\ninline pair<int,int> position(int x)\n{\n\treturn {(x-1)/m+1,(x-1)%m+1};\n}\ninline int tabs(int x)\n{\n\treturn x>0?x:-x;\n}\ninline int distance(int x,int y)\n{\n\tint xt=position(x).first,yt=position(x).second,xp=position(y).first,yp=position(y).second;\n\treturn tabs(xt-xp)+tabs(yt-yp);\n}\nstruct node2\n{\n\tint name,data;\n};\npriority_queue<node2>q;\nbool operator <(node2 fi,node2 se)\n{\n\treturn fi.data>se.data;\n}\nvoid dijstra()\n{\n\tmemset(dis,0x3f,sizeof(dis));\n\tdis[clac(x1,y1)]=0;\n\tq.push({clac(x1,y1),0});\n\twhile(!q.empty())\n\t{\n\t\tint x=q.top().name;\n\t\tq.pop();\n\t\tint len=a[x].size();\n\t\tfor(int i=0;i<len;i++)\n\t\t{\n\t\t\tif(dis[x]+a[x][i].second<dis[a[x][i].first])\n\t\t\t{\n\t\t\t\tdis[a[x][i].first]=a[x][i].second+dis[x];\n\t\t\t\tq.push({a[x][i].first,dis[a[x][i].first]});\n\t\t\t}\n\t\t}\n\t}\n}\nint main()\n{\n\tfreopen(\"portal.in\",\"r\",stdin);\n\tfreopen(\"portal.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%s\",s[i]+1);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint bef=0;\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tif(s[i][j]=='#')bef=j;\n\t\t\telse if(bef)b[clac(i,j)].push_back(clac(i,bef+1));\n\t\t}\n\t\tbef=0;\n\t\tfor(int j=m;j>=1;j--)\n\t\t{\n\t\t\tif(s[i][j]=='#')bef=j;\n\t\t\telse if(bef)b[clac(i,j)].push_back(clac(i,bef-1));\n\t\t}\n\t}\n\tfor(int j=1;j<=m;j++)\n\t{\n\t\tint bef=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(s[i][j]=='#')bef=i;\n\t\t\telse if(bef)b[clac(i,j)].push_back(clac(bef+1,j));\n\t\t}\n\t\tbef=0;\n\t\tfor(int i=n;i>=1;i--)\n\t\t{\n\t\t\tif(s[i][j]=='#')bef=i;\n\t\t\telse if(bef)b[clac(i,j)].push_back(clac(bef-1,j));\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tif(s[i][j]=='#')continue;\n\t\t\tif(s[i][j]=='C')x1=i,y1=j;\n\t\t\tif(s[i][j]=='F')x2=i,y2=j;\n\t\t\tint len=b[clac(i,j)].size();\n\t\t\tint minn=1e9;\n\t\t\tfor(int k=0;k<len;k++)minn=min(minn,distance(b[clac(i,j)][k],clac(i,j)));\n\t\t\tfor(int k=0;k<len;k++)a[clac(i,j)].push_back({b[clac(i,j)][k],minn+1});\n\t\t\tif(i>1&&s[i-1][j]!='#')a[clac(i,j)].push_back({clac(i-1,j),1});\n\t\t\tif(i<n&&s[i+1][j]!='#')a[clac(i,j)].push_back({clac(i+1,j),1});\n\t\t\tif(j>1&&s[i][j-1]!='#')a[clac(i,j)].push_back({clac(i,j-1),1});\n\t\t\tif(j<m&&s[i][j+1]!='#')a[clac(i,j)].push_back({clac(i,j+1),1});\n\t\t}\n\t}\n\tdijstra();\n\tif(dis[clac(x2,y2)]>1e9)printf(\"nemoguce\");\n\telse printf(\"%d\",dis[clac(x2,y2)]);\n\treturn 0;\n}\n```\n",
        "postTime": 1667216399,
        "uid": 275793,
        "name": "Gmt\u4e36FFF",
        "ccfLevel": 5,
        "title": "P4442 [COCI2017-2018#3] Portal"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u6709\u4e24\u79cd\u79fb\u52a8\u65b9\u5f0f\uff0c\u5411\u5468\u56f4\u56db\u4e2a\u683c\u5b50\u79fb\u52a8\u548c\u5728\u9762\u5411\u7684\u5899\u4e0a\u5efa\u4f20\u9001\u5e26\uff0c\u6c42\u89e3\u4ece\u8d77\u70b9\u5f00\u59cb\u5230\u7ec8\u70b9\u7684\u6700\u77ed\u65f6\u95f4\u3002\n\n$\\texttt{Data Range}$\uff1a$1 \\leq n,m \\leq 500$\u3002\n\n## \u5206\u6790\n\n\u5411\u5468\u56f4\u56db\u4e2a\u683c\u5b50\u5efa\u7acb\u4f20\u9001\u5e26\uff0c**\u5b9e\u8d28\u4e0a\u53ef\u4ee5\u8f6c\u4e3a\u4e00\u79cd\u64cd\u4f5c**\uff1a\n\n\u8bbe\u4ece\u4e00\u4e2a\u683c\u5b50 $(x,y)$ \u5411\u56db\u5468\u76f4\u7740\u8d70\uff0c\u78b0\u5230\u5899\u7684\u6700\u77ed\u6b65\u6570\u4e3a $s$\uff0c\u8d70\u5230\u5c3d\u5934\u53ef\u4ee5\u8d70\u5230 $(x_0,y_0)$\u3001$(x_1,y_1)$\u3001$(x_2,y_2)$\u3001$(x_3,y_3)$\uff0c\u90a3\u4e48\u53ef\u4ee5\u770b\u505a\u53ef\u4ee5\u4ece $(x,y)$ \u53ef\u4ee5\u8d70\u5230 $(x_0,y_0)$\u3001$(x_1,y_1)$\u3001$(x_2,y_2)$\u3001$(x_3,y_3)$ \u8017\u8d39 $s$ \u7684\u65f6\u95f4\u3002\n\n\u90a3\u4e48\u6709\u4e86\u8fd9\u4e00\u4e2a\uff0c\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u975e\u5e38\u666e\u901a\u7684\u6700\u77ed\u8def\u4e86\u3002\u7528 Dijkstra \u5b9e\u73b0\u5373\u53ef\u3002\n\n\u90a3\u4e48\u600e\u4e48\u6c42\u51fa $(x_0,y_0)$ \u8fd9\u4e9b\u70b9\u5462\uff1f\u4e8b\u5b9e\u4e0a\u53ef\u4ee5\u66b4\u529b\u4ece\u6bcf\u4e00\u4e2a\u70b9\u5f00\u59cb\u5411\u56db\u4e2a\u65b9\u5411\u5faa\u73af\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\uff08\u8fd9\u91cc\u89c6\u4e3a $n,m$ \u540c\u9636\uff09\uff0c\u8fd9\u6837\u5b50\u662f\u53ef\u4ee5\u8fc7\u7684\u3002\n\n\u600e\u4e48\u66f4\u9ad8\u6548\u5462\uff1f\u8003\u8651\u5230\u4e00\u4e2a\u53ef\u8d70\u683c\u5b50 $(x,y)$ \u5de6\u8fb9\u7684\u53ef\u8d70\u683c\u5b50 $(x,y-1)$ \u548c $(x,y)$ \u4e00\u76f4\u5f80\u5de6\u8d70\u8d70\u5230\u7684\u683c\u5b50\u662f\u4e00\u6837\u7684\u3002\u6240\u4ee5\u53ef\u4ee5\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\u6765\u5b9e\u73b0\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\ninline go dfs(const int x, const int y, const int dir){\n\tif(vis[x][y][dir].x>0){return vis[x][y][dir];} \n\tRI ax, ay;\n\tax=x+dx[dir], ay=y+dy[dir];\n\tif(ok(ax,ay)) return vis[x][y][dir]=dfs(ax,ay,dir);\n\tctmp.x=x, ctmp.y=y;\n\treturn vis[x][y][dir]=ctmp;\n}//\u8bb0\u5fc6\u5316\u641c\u7d22 \n```\n\n\u5176\u4e2d $dir$ \u662f\u8d70\u7684\u65b9\u5411\uff0c$x,y$ \u662f\u5f53\u524d\u70b9\u5750\u6807\uff0c$vis$ \u6570\u7ec4\u4e2d\u5b58\u7684\u4fbf\u662f $(x_0,y_0)$ \u7b49\u4e00\u7cfb\u5217\u70b9\u3002\n\n\u8fd9\u6837\u5b50\u5b8c\u6210\u4e86\u91cd\u65b0\u6784\u56fe\uff0c\u6700\u540e\u8dd1 Dijkstra \u5373\u53ef\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define RI register int\n\nusing namespace std;\nnamespace IO {\n\tinline int read() {\n\t\tRI X=0,w=0;register char ch=0;\n\t\twhile(!isdigit(ch)) {w|=ch=='-';ch=getchar();}\n\t\twhile(isdigit(ch)) X=(X<<3)+(X<<1)+(ch^48),ch=getchar();\n\t\treturn w?-X:X;\n\t}\n\tinline void write(int x){\n\t\tif(x>9){write(x/10);putchar('0'+x%10);}\n\t\telse{putchar(x+'0');}\n\t}\n}using namespace IO;\n\nconst int MAXN = 502;\nconst int dx[]={1,-1,0,0}, dy[]={0,0,1,-1};\n\nint n, m;\nint stx, sty, edx, edy;\nint dis[MAXN][MAXN];\nint Min[MAXN][MAXN];\n\nbool vist[MAXN][MAXN];\n\nstruct go{\n\tint x, y;\n\tgo(){x=y=0;}\n}vis[MAXN][MAXN][5], ctmp;\n\nchar mapp[MAXN][MAXN];\n\nstruct bfs_Queue{\n\tint x, y;\n\tbool friend operator < (const bfs_Queue a, const bfs_Queue b){return dis[a.x][a.y]>dis[b.x][b.y];}\n}tmp, now; \n\npriority_queue<bfs_Queue>Q;//\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5c0f\u6839\u5806 \n\ninline bool ok(const int x, const int y){return 1<=x && x<=n && 1<=y && y<=m && mapp[x][y]!='#';}//\u61d2\u5f97\u5199\u8fd9\u4e48\u591a\uff0c\u76f4\u63a5\u653e\u5728\u51fd\u6570\u91cc\u4e86 \n\ninline go dfs(const int x, const int y, const int dir){\n\tif(vis[x][y][dir].x>0){return vis[x][y][dir];} \n\tRI ax, ay;\n\tax=x+dx[dir], ay=y+dy[dir];\n\tif(ok(ax,ay)) return vis[x][y][dir]=dfs(ax,ay,dir);\n\tctmp.x=x, ctmp.y=y;\n\treturn vis[x][y][dir]=ctmp;\n}//\u8bb0\u5fc6\u5316\u641c\u7d22 \n\ninline void bfs(){\n\tmemset(dis,127/3,sizeof dis);//dis \u7f6e\u4e3a\u5f88\u5927\u7684\u4e00\u4e2a\u6570\u5b57 \n\ttmp.x=stx, tmp.y=sty;dis[stx][sty]=0;//\u8d77\u70b9\u7f6e\u4e3a 0 \n\tQ.push(tmp);RI ax, ay;//\u4f18\u961f \n\twhile(!Q.empty()){\n\t\tnow=Q.top();Q.pop();\n\t\tif(vist[now.x][now.y]) continue;\n\t\tvist[now.x][now.y]=1;\n\t\tfor(RI i=0;i<4;++i){\n\t\t\tax=now.x+dx[i], ay=now.y+dy[i];\n\t\t\tif(ok(ax,ay) && dis[ax][ay]>dis[now.x][now.y]+1){\n\t\t\t\tdis[ax][ay]=dis[now.x][now.y]+1;\n\t\t\t\ttmp.x=ax, tmp.y=ay;\n\t\t\t\tQ.push(tmp);\n\t\t\t}\n\t\t}\n\t\tfor(RI i=0;i<4;++i){\n\t\t\tax=vis[now.x][now.y][i].x, ay=vis[now.x][now.y][i].y;\n\t\t\tif(ok(ax,ay) && dis[ax][ay]>dis[now.x][now.y]+Min[now.x][now.y]){\n\t\t\t\tdis[ax][ay]=dis[now.x][now.y]+Min[now.x][now.y];\n\t\t\t\ttmp.x=ax, tmp.y=ay;\n\t\t\t\tQ.push(tmp);\n\t\t\t}\n\t\t}\n\t}\n\tif(dis[edx][edy]>1e7) puts(\"nemoguce\");\n\telse write(dis[edx][edy]);\n}//\u4e0d\u89e3\u91ca\u4e86 \n\nint main(){\n\tn=read(), m=read();\n\tfor(RI i=1;i<=n;++i){\n\t\tscanf(\"%s\",mapp[i]+1);\n\t\tfor(RI j=1;j<=m;++j){\n\t\t\tif(mapp[i][j]=='C') stx=i, sty=j;\n\t\t\tif(mapp[i][j]=='F') edx=i, edy=j;\n\t\t}\n\t}//\u8bfb\u5165 \n\tfor(RI i=1;i<=n;++i){\n\t\tfor(RI j=1;j<=m;++j){\n\t\t\tif(mapp[i][j]=='#') continue;\n\t\t\tMin[i][j]=2147483647;\n\t\t\tfor(RI p=0;p<4;++p){\n\t\t\t\tvis[i][j][p]=dfs(i,j,p);\n\t\t\t\tMin[i][j]=min(Min[i][j],abs(i-vis[i][j][p].x)+abs(j-vis[i][j][p].y)+1);\n\t\t\t}\n\t\t}\n\t}//\u4f20\u9001\u7684\u64cd\u4f5c\u53ef\u4ee5\u770b\u505a\u7528 Min[i][j] \u7684\u4ee3\u4ef7\u4ece\u5f53\u524d\u683c\u5b50\u8d70\u5230\u56db\u4e2a\u65b9\u5411\u7684\u4efb\u610f\u4e00\u4e2a\u65b9\u5411\u7684\u5c3d\u5934\uff0c\u8fd9\u4e00\u90e8\u5206\u662f\u7528\u7684\u8bb0\u5fc6\u5316\u641c\u7d22\u9884\u5904\u7406 \n\tbfs();//\u5176\u5b9e\u662f Dijkstra \n\treturn 0;\n}\n```\n\n",
        "postTime": 1633416420,
        "uid": 261914,
        "name": "Emy_Ycc",
        "ccfLevel": 6,
        "title": "P4442 \u9898\u89e3"
    },
    {
        "content": "\u6211\u4eec\u9047\u5230\u8fd9\u9053\u9898\u548c [UVA1714 Keyboarding](https://www.luogu.com.cn/problem/UVA1714) \u8fd9\u79cd\u53ef\u4ee5\u4e00\u6b21\u79fb\u52a8\u4e00\u884c\u7684\u9898\u3002\n\n\n\u6211\u4eec\u7528\u4e00\u822c\u7684 dfs \u548c bfs \u65f6\u95f4\u590d\u6742\u5ea6\u80af\u5b9a\u662f\u4e0d\u591f\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u8981\u9884\u5904\u7406\u51fa\u4ed6\u80fd\u591f\u79fb\u52a8\u5230\u7684\u4f4d\u7f6e\u3002\n\n\u7136\u540e\u628a\u4ed6\u7684\u6bcf\u6b21\u79fb\u52a8\u5f53\u6210\u957f\u5ea6\u4e3a\u8fb9\u6743\u3002\n\n\u7136\u800c\u662f\u6c42\u8d77\u59cb\u70b9\u5230\u7ec8\u6b62\u70b9\u7684\u6700\u77ed\u79fb\u52a8\u6b65\u6570\u3002\n\n\u6211\u4eec\u53ea\u9700\u8981\u7528 dijkstra \u5feb\u901f\u6c42\u51fa\u6700\u77ed\u79fb\u52a8\u6b65\u6570\u3002\n\n\u867d\u7136\u6211\u4eec\u53d1\u73b0\u4f7f\u7528\u4f20\u9001\u67aa\u8981\u6d88\u8017\u4e00\u70b9\u7684\u65f6\u95f4\u3002\n\n\u4f46\u662f\u4f7f\u7528\u4f20\u9001\u67aa\u4e00\u5b9a\u662f\u6bd4\u4e0d\u4f7f\u7528\u4f20\u9001\u67aa\u66f4\u4f18\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u7684\u4f7f\u7528\u4f20\u9001\u67aa\u60c5\u51b5\u5c31\u662f\u5bf9\u6700\u8fd1\u7684\u4e00\u9762\u5899\u5f00\u67aa\uff0c\u7136\u540e\u5bf9\u76ee\u7684\u5730\u5f00\u67aa\u3002\n\n\u8fd9\u6837\u6211\u4eec\u8981\u8d70\u5230\u6700\u8fd1\u7684\u5899\u7684\u65f6\u95f4\u5c31\u662f $ minlen $ \u8d70\u5230\u5176\u4ed6\u4e09\u9762\u5899\u7684\u65f6\u95f4\u5c31\u662f $ minlen+1 $ \u3002\n\n**\u4f46\u662f\u6211\u4eec\u5728\u8003\u8651\u7684\u65f6\u5019\u4f1a\u60f3\uff1a** \n\n\u73b0\u5728\u4e00\u4e2a\u70b9\u5f00\u4e00\u67aa\uff0c\u518d\u8d70\u5230\u5176\u4ed6\u70b9\u518d\u5f00\u4e00\u67aa,\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u8fd9\u79cd\u8d70\u6cd5\u5e76\u4e0d\u4f1a\u66f4\u4f18\u3002\n\n**\u8bc1\u660e\u5982\u4e0b\uff1a**\n\n\u56e0\u4e3a\u6211\u4eec\u7684\u6bcf\u4e00\u79cd\u8d70\u6cd5\u90fd\u662f\u5bf9\u4e8e\u4e00\u4e2a\u969c\u788d\u7269\u7684\u4e0d\u540c\u5904\u7406\u65b9\u5f0f\uff0c\u6211\u4eec\u4e0d\u7ba1\u600e\u4e48\u5c04\u5b50\u5f39\uff0c\u6211\u4eec\u5230\u8fbe\u76ee\u7684\u5730\u7684\u6700\u77ed\u8ddd\u79bb\u6c38\u8fdc\u90fd\u662f\uff1a\u8fd9\u4e2a\u70b9\u5230\u6700\u8fd1\u7684\u5899\u7684\u8ddd\u79bb $ +1 $\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u6613\u7684\u5199\u51fa\u9884\u5904\u7406\u7684\u4ee3\u7801\u5757\u3002\n\n```cpp\ninline void draw(){\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=m;++j){\n\t\t\tif(s[i][j]=='#')continue;\n\t\t\tfor(int k=0;k<4;++k){\n\t\t\t\tint nx=i+mx[k];\n\t\t\t\tint ny=j+my[k];\n\t\t\t\tif(s[nx][ny]=='#'||s[nx][ny]=='$')continue;\n\t\t\t\tadd(change[i][j],change[nx][ny],1);\n\t\t\t}\n\t\t\tint l1=0,l2=0,l3=0,l4=0;\n\t\t\tint nx=i;\n\t\t\twhile(s[nx][j]!='#'&&s[nx][j]!='$')nx++;\n\t\t\tl1=nx-i-1;\n\t\t\tif(s[nx][j]=='$')l1=INF;\n\t\t\tnx=i;\n\t\t\twhile(s[nx][j]!='#'&&s[nx][j]!='$')nx--;\n\t\t\tl2=i-nx-1;\n\t\t\tif(s[nx][j]=='$')l2=INF;\n\t\t\tint ny=j;\n\t\t\twhile(s[i][ny]!='#'&&s[i][ny]!='$')ny++;\n\t\t\tl3=ny-j-1;\n\t\t\tif(s[i][ny]=='$')l3=INF;\n\t\t\tny=j;\n\t\t\twhile(s[i][ny]!='#'&&s[i][ny]!='$')ny--;\n\t\t\tl4=j-ny-1;\n\t\t\tif(s[i][ny]=='$')l4=INF;\n\t\t\tint minn=min(min(l1,l2),min(l3,l4));\n\t\t\tif(l1!=INF){\n\t\t\t\tif(l1==minn)add(change[i][j],change[i+l1][j],minn);\n\t\t\t\telse add(change[i][j],change[i+l1][j],minn+1);\n\t\t\t}\n\t\t\tif(l2!=INF){\n\t\t\t\tif(l2==minn)add(change[i][j],change[i-l2][j],minn);\n\t\t\t\telse add(change[i][j],change[i-l2][j],minn+1);\n\t\t\t}\n\t\t\tif(l3!=INF){\n\t\t\t\tif(l3==minn)add(change[i][j],change[i][j+l3],minn);\n\t\t\t\telse add(change[i][j],change[i][j+l3],minn+1);\n\t\t\t}\n\t\t\tif(l4!=INF){\n\t\t\t\tif(l4==minn)add(change[i][j],change[i][j-l4],minn);\n\t\t\t\telse add(change[i][j],change[i][j-l4],minn+1);\n\t\t\t}\n\t\t}\n\t}\n} \n```\n\n\n\u90a3\u4e48\u6211\u4eec\u5728\u6700\u96be\u7684\u90e8\u5206\u5199\u5b8c\u4e4b\u540e\u5c31\u53ef\u4ee5\u5957\u6a21\u677f\u5c31\u884c\u4e86\u3002\n\n**CODE**\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 510\n#define M 1400010\n#define INF 0x3f3f3f3f\n#define PII pair<int,int>\nstruct Edge{\n\tint ne,to,dis;\n\t#define ne(x) edge[x].ne\n\t#define to(x) edge[x].to\n\t#define dis(x) edge[x].dis\n}edge[M<<1];\nint head[N*N],idx,n,m,st,ed,o=1;\nchar s[N][N];\nint change[N][N],f[N*N];\nint mx[4]={0,0,1,-1},my[4]={1,-1,0,0};\ninline void add(int from,int to,int dis){\n\tne(++idx)=head[from];\n\tto(idx)=to;\n\tdis(idx)=dis;\n\thead[from]=idx;\n}\ninline void draw(){\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=m;++j){\n\t\t\tif(s[i][j]=='#')continue;\n\t\t\tfor(int k=0;k<4;++k){\n\t\t\t\tint nx=i+mx[k];\n\t\t\t\tint ny=j+my[k];\n\t\t\t\tif(s[nx][ny]=='#'||s[nx][ny]=='$')continue;\n\t\t\t\tadd(change[i][j],change[nx][ny],1);\n\t\t\t}\n\t\t\tint l1=0,l2=0,l3=0,l4=0;\n\t\t\tint nx=i;\n\t\t\twhile(s[nx][j]!='#'&&s[nx][j]!='$')nx++;\n\t\t\tl1=nx-i-1;\n\t\t\tif(s[nx][j]=='$')l1=INF;\n\t\t\tnx=i;\n\t\t\twhile(s[nx][j]!='#'&&s[nx][j]!='$')nx--;\n\t\t\tl2=i-nx-1;\n\t\t\tif(s[nx][j]=='$')l2=INF;\n\t\t\tint ny=j;\n\t\t\twhile(s[i][ny]!='#'&&s[i][ny]!='$')ny++;\n\t\t\tl3=ny-j-1;\n\t\t\tif(s[i][ny]=='$')l3=INF;\n\t\t\tny=j;\n\t\t\twhile(s[i][ny]!='#'&&s[i][ny]!='$')ny--;\n\t\t\tl4=j-ny-1;\n\t\t\tif(s[i][ny]=='$')l4=INF;\n\t\t\tint minn=min(min(l1,l2),min(l3,l4));\n\t\t\tif(l1!=INF){\n\t\t\t\tif(l1==minn)add(change[i][j],change[i+l1][j],minn);\n\t\t\t\telse add(change[i][j],change[i+l1][j],minn+1);\n\t\t\t}\n\t\t\tif(l2!=INF){\n\t\t\t\tif(l2==minn)add(change[i][j],change[i-l2][j],minn);\n\t\t\t\telse add(change[i][j],change[i-l2][j],minn+1);\n\t\t\t}\n\t\t\tif(l3!=INF){\n\t\t\t\tif(l3==minn)add(change[i][j],change[i][j+l3],minn);\n\t\t\t\telse add(change[i][j],change[i][j+l3],minn+1);\n\t\t\t}\n\t\t\tif(l4!=INF){\n\t\t\t\tif(l4==minn)add(change[i][j],change[i][j-l4],minn);\n\t\t\t\telse add(change[i][j],change[i][j-l4],minn+1);\n\t\t\t}\n\t\t}\n\t}\n}\npriority_queue<PII,vector<PII>,greater<PII> > q;\nbool v[M];\nvoid dijkstra(int sta){\n\tmemset(f,0x3f,sizeof(f));\n\tf[sta]=0;\n\tq.push(make_pair(f[sta],sta));\n\twhile(!q.empty()){\n\t\tint u=q.top().second;\n\t\tq.pop();\n\t\tif(v[u])continue;\n\t\tv[u]=1;\n\t\tfor(int i=head[u];i;i=ne(i)){\n\t\t\tint y=to(i);\n\t\t\tif(f[y]>f[u]+dis(i)){\n\t\t\t\tf[y]=f[u]+dis(i);\n\t\t\t\tq.push(make_pair(f[y],y));\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){\n\t//freopen(\".in\",\"r\",stdin);\n\t//freopen(\".out\",\"w\",stdout);\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=m;++j){\n\t\t\tcin>>s[i][j];\n\t\t\tchange[i][j]=o++;\n\t\t\tif(s[i][j]=='C'){\n\t\t\t\tst=change[i][j];\n\t\t\t}\n\t\t\tif(s[i][j]=='F'){\n\t\t\t\ted=change[i][j];\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=0;i<=n+1;++i){\n\t\ts[i][0]=s[i][m+1]='$';\n\t}\n\tfor(int i=0;i<=m+1;++i){\n\t\ts[0][i]=s[n+1][i]='$';\n\t}\n\tdraw();\n\tdijkstra(st);\n\tif(f[ed]!=INF)cout<<f[ed];\n\telse puts(\"nemoguce\");\n\treturn 0;\n}\n```",
        "postTime": 1599044427,
        "uid": 226447,
        "name": "\u54c8\u6492\u5404\u4e00",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4442 [COCI2017-2018#3] Portal"
    }
]