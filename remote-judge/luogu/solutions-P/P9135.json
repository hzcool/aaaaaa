[
    {
        "content": "[\u9898\u4f20](https://www.luogu.com.cn/problem/P9135)\n\n\u8d5b\u65f6\u60f3\u7740\u83ab\u53cd\u53bb\u4e86\uff0c\u6709\u70b9\u53ef\u60dc\u6ca1\u60f3\u51fa\u6765\uff0c\u5b9e\u9645\u4e0a\u8fd8\u662f\u633a\u6709\u8da3\u7684\u3002\n\n\u53d1\u73b0\u5220\u6389 $a_{i}, a_{j}$ \u518d\u52a0\u4e0a $a_{i}+a_{j}$  \u5f88\u4e0d\u597d\u7b97\uff0c\u8981\u662f\u80fd\u6709\u4ec0\u4e48\u4e1c\u897f\u80fd\u5c06\u4e09\u4e2a\u64cd\u4f5c\u7684\u8d21\u732e\u72ec\u7acb\u5206\u5f00\u5c31\u597d\u4e86\u3002\n\n\u8003\u8651\u6240\u6709\u6570\u4e3a $2^{x}$ \u7684\u60c5\u51b5\uff0c\u5982\u679c\u4e00\u5bf9 $(i,j)$ \u4f1a\u6539\u53d8\u539f\u6765\u7684 $\\operatorname{lcm}$\uff0c\u90a3\u4e48 $i/j$ \u81f3\u5c11\u6709\u4e00\u4e2a\u662f $2$ \u7684\u6700\u9ad8\u6b21\u5e42\uff0c\u73b0\u5728\u5047\u5b9a\u6700\u9ad8\u7684\u662f $i$\uff0c\u770b $j$ \u548c\u6b21\u9ad8\u7684\u5173\u7cfb\u3002\n\n1. \u82e5 $x_{j}<x_{i}$\uff0c\u5219 $i$ \u7684\u8d21\u732e\u662f $2^{mx'-x_{i}}$\uff08$mx'$ \u662f\u6b21\u5927\u503c\uff09\uff0c$j$ \u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u8d21\u732e\uff0c\u6b64\u65f6 $a_{i}=2^{k'} a_{j}$\uff0c\u90a3\u4e48 $a_{i}+a_{j}=(2^{k'}+1)a_{j}$\uff0c\u5373\u5176\u6307\u6570\u4e3a $x_{j}$ \u4e0d\u4f1a\u4ea7\u751f\u8d21\u732e\u3002\n\n2. \u82e5 $x_{i}=x_{j}$\uff0c\u90a3\u4e48 $a_{i}+a_{j}$ \u4f1a\u591a\u5206\u51fa\u4e00\u4e2a $2^{1}$\u3002\n\n\u4e0d\u59a8\u4ee4 $h(x)$ \u4e3a\u5220\u6389\u4e00\u4e2a $x$ \u540e $\\operatorname{lcm}$ \u7684\u53d8\u5316\u7cfb\u6570\uff0c$g(x)$ \u4e3a\u65b0\u589e\u4e00\u4e2a $x$ \u540e $\\operatorname{lcm}$ \u7684\u53d8\u5316\u7cfb\u6570\u3002\u6839\u636e\u4e0a\u9762\u7684\u8ba8\u8bba\uff0c$h(a_{i}),h(a_{j}), g(a_{i}+a_{j})$ \u4e2d\u6700\u591a\u6709\u4e00\u4e2a\u4e0d\u4e3a $1$\uff0c\u65b0\u7684 $\\operatorname{lcm}$ \u53ef\u4ee5\u7528\u539f $\\operatorname{lcm}$ \u4e58\u4e0a\u4e09\u8005\u7684\u79ef\u5f97\u5230\u3002\n\n\u4e0d\u96be\u63a8\u5e7f\u5230\u591a\u4e2a\u8d28\u6570\u7684\u60c5\u51b5\uff08\u56e0\u4e3a\u8d28\u6570\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\uff09\u3002\n\n\u90a3\u4e48\u7b54\u6848\u5373\u4e3a \n\n$$\\sum_{i<j} \\operatorname{lcm}(a_{k})g(a_{i}+a_{j})h(a_{i})h(a_{j})$$\n\n$$=\\operatorname{lcm}(a_{k})\\sum_{k} g(k) \\sum_{a_{i}+a_{j}=k} h(a_{i})h(a_{j})$$\n\n\u540e\u9762\u7684\u6c42\u548c\u76f4\u63a5\u5377\u79ef\u505a\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6 $O(A\\log A)$\uff0c$A$ \u662f\u503c\u57df\u3002\n\n\n### Code:\n\n```cpp\n#include <stdio.h>\n#include <algorithm>\n#include <string.h>\n#include <cctype>\n#include <vector>\n#include <queue>\n#include <bitset>\n#define vi vector<int>\n#define pb push_back\n#define mp make_pair\n#define st first\n#define nd second\nusing namespace std;\ntypedef long long ll;\ntypedef pair <int, int> Pii;\nconst int INF=0x3f3f3f3f;\nconst int cp=998244353;\ninline int mod(int x){if(x>=cp) x-=cp;if(x<0) x+=cp;return x;}\ninline void plust(int &x, int y){x=mod(x+y);return ;}\ninline void minut(int &x, int y){x=mod(x-y);return ;}\ninline int read(){\nchar ch=getchar();int x=0, f=1;\nwhile(!isdigit(ch)){if(ch=='-') f=-1; ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn x*f;\n}\ninline void write(int x){\n    if(x<0) putchar('-'), x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\ninline int ksm(int a, int b=cp-2){\n\tint ret=1;\n\tfor(; b; b>>=1, a=1ll*a*a%cp)\n\t\tif(b&1) ret=1ll*ret*a%cp;\n\treturn ret;\n}\nconst int g0=3;\nconst int invg=ksm(g0);\nconst int inv2=ksm(2);\nconst int N=5e5+5;\nconst int M=1.5e3+5;\nconst int S=2.1e6+5;\nconst int T=2e6;\nconst int Pcnt=240;\nint n, tot, ans, LCM, pr[Pcnt], mn[S], inv[S], a[N], mx[S], cmx[S];\nint g[S], h[N], len=1<<21, f[S], to[S];\nvoid init(){\n\tn=read();for(int i=1; i<=n; ++i) a[i]=read();inv[0]=inv[1]=1;\n\tfor(int i=2; i<=T; ++i) inv[i]=1ll*(cp-cp/i)*inv[cp%i]%cp;\n\tmn[1]=1;for(int i=2; i<=T; ++i) if(!mn[i]) for(int j=i; j<=T; j+=i) mn[j]=i;\n\tfor(int i=1; i<=n; ++i){\n\t\tint x=a[i];\n\t\twhile(x>1){\n\t\t\tint p=mn[x], s=1;\n\t\t\twhile(mn[x]==p) x/=p, s*=p;\n\t\t\tif(mx[p]<s) swap(mx[p], s);\n\t\t\tif(cmx[p]<s) swap(cmx[p], s);\n\t\t}\n\t}\n\tLCM=1;\n\tfor(int i=1; i<=T; ++i) if(mx[i]) LCM=1ll*LCM*mx[i]%cp;\n\tfor(int i=1; i<=n; ++i){\n\t\tint x=a[i], t=LCM;\n\t\twhile(x>1){\n\t\t\tint p=mn[x], s=1;\n\t\t\twhile(mn[x]==p) x/=p, s*=p;\n\t\t\tif(cmx[p]<s) t=1ll*t*inv[s]%cp*max(1, cmx[p])%cp;\n\t\t}\n\t\th[i]=t;\n\t}\n\tfor(int i=1; i<=T; ++i){\n\t\tint x=i, t=LCM;\n\t\twhile(x>1){\n\t\t\tint p=mn[x], s=1;\n\t\t\twhile(mn[x]==p) x/=p, s*=p;\n\t\t\tif(mx[p]<s) t=1ll*t*inv[mx[p]]%cp*s%cp;\n\t\t}\n\t\tg[i]=t;\n\t}\n}\nvoid NTT(int *F, int flag){\n\tfor(int i=0; i<len; i++)\n\t\tif(i<to[i]) swap(F[i], F[to[i]]);\n\tfor(int s=2; s<=len; s<<=1){\n\t\tint size=s>>1;\n\t\tint omega=ksm(flag>0?g0:invg, (cp-1)/s);\n\t\tfor(int L=0; L<len; L+=s){\n\t\t\tint buf=1;\n\t\t\tfor(int i=L; i<L+size; i++, buf=1ll*omega*buf%cp){\n\t\t\t\tint F2=1ll*buf*F[i+size]%cp;\n\t\t\t\tF[i+size]=mod(F[i]-F2);\n\t\t\t\tF[i]=mod(F[i]+F2);\n\t\t\t}\n\t\t}\n\t}\n\tif(~flag) return ;int invlen=ksm(len);\n\tfor(int i=0; i<=len; ++i) F[i]=1ll*F[i]*invlen%cp;\n}\nsigned main(){\n\tinit();\n\tmemset(f, 0, sizeof(f));\n\tfor(int i=1; i<=n; ++i) plust(f[a[i]], h[i]);\n\tfor(int i=0; i<=len; i++) to[i]=(to[i>>1]>>1)|((i&1)?len>>1:0);\n\tNTT(f, 1);\n\tfor(int i=0; i<=len; ++i) f[i]=1ll*f[i]*f[i]%cp;\n\tNTT(f, -1);\n\tfor(int i=1; i<=n; ++i) minut(f[a[i]+a[i]], 1ll*h[i]*h[i]%cp);\n\t// for(int i=1; i<=8; ++i) printf(\"%d*%d \", f[i], g[i]);\n\tfor(int i=1; i<=T; ++i) plust(ans, 1ll*f[i]*g[i]%cp);\n\tLCM=1ll*LCM*LCM%cp;LCM=ksm(LCM);\n\tans=1ll*ans*LCM%cp;ans=1ll*ans*inv2%cp;\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1678200976,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "P9135 [THUPC 2023 \u521d\u8d5b] \u5feb\u901f LCM \u53d8\u6362"
    },
    {
        "content": "> [P9135 [THUPC 2023 \u521d\u8d5b] \u5feb\u901f LCM \u53d8\u6362](https://www.luogu.com.cn/problem/P9135)\n\n\u5bf9\u8d28\u6570 $p$\uff0c\u6211\u4eec\u5355\u72ec\u5206\u6790\u8d21\u732e\u3002\u8bbe $r_i$ \u6709 $k_1$ \u4e2a $p$\uff08$k_1 = v_p(r_i)$\uff09\uff0c$r_j$ \u6709 $k_2$ \u4e2a $p$\uff0c$r_i + r_j$ \u6709 $k_3$ \u4e2a $p$\uff0c\u4e14 $p$ \u5728\u6240\u6709 $r_i$ \u7684\u6700\u9ad8\u6b21\u6570\u4e3a $mx_p$\uff0c\u7b2c\u4e8c\u5927\u6b21\u6570\u4e3a $smx_p$\u3002\u4e0d\u59a8\u8bbe $k_1 \\geq k_2$\u3002\n\n- \u5f53 $k_1 > k_2$ \u65f6\uff0c$k_3 = k_2$\u3002\u6b64\u65f6\u82e5 $a_i = mx_p$\uff0c\u5219 $p$ \u7684\u6307\u6570\u53d8\u6210 $smx_p$\uff0c\u5426\u5219\u6307\u6570\u4e0d\u53d8\u3002\u6ce8\u610f\u8fd9\u548c $k_2$ \u662f\u5426\u7b49\u4e8e $smx_p$ \u65e0\u5173\u3002\n- \u5f53 $k_1 = k_2$ \u65f6\uff0c$k_3\\geq k_1$\u3002$p$ \u7684\u6307\u6570\u53d8\u6210 $\\max(k_3, smx_p)$\u3002\n\n\u8003\u8651\u8bbe $c_i$ \u8868\u793a\u82e5\u53bb\u6389 $i$\uff0c\u5219 $\\operatorname{lcm}$ \u4f1a\u53d8\u6210\u539f\u6765\u7684\u591a\u5c11\u500d\uff0c\u5373\u82e5 $v_p(r_i) = mx_p$\uff0c\u5219 $c_i$ \u4e58\u4e0a $\\frac 1 {p ^ {mx_p - smx_p}}$\u3002\u8ba1\u7b97 $(i, j)$ \u7684\u8d21\u732e\u65f6\uff0c\u5148\u8003\u8651\u60c5\u51b5\u4e00\uff0c\u5f53\u6210 $c_ic_j$ \u7b97\uff0c\u518d\u52a0\u5165 $r_i + r_j$ \u7684\u60c5\u51b5\u4e8c\u7684\u8d21\u732e\uff1a\u82e5 $v_p(r_i + r_j) > mx_p$\uff0c\u5219 $\\operatorname{lcm}$ \u4e58\u4e0a $p ^ {v_p(r_i + r_j) - mx_p}$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $k$\uff0c\u8ba1\u7b97\u4f7f\u5f97 $r_i + r_j = k$ \u7684 $c_ic_j$ \u7684\u8d21\u732e\u662f\u6807\u51c6\u5377\u79ef\u5f62\u5f0f\uff0cNTT \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(V\\log V)$\uff0c\u5176\u4e2d $V$ \u662f\u503c\u57df\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nusing ll = long long;\nusing ull = unsigned long long;\n\nbool Mbe;\nconstexpr int N = 1 << 21;\nconstexpr int mod = 998244353;\nconstexpr int iv3 = (mod + 1) / 3;\nvoid add(int &x, int y) {\n  x += y, x >= mod && (x -= mod);\n}\nint ksm(int a, int b) {\n  int s = 1;\n  while(b) {\n    if(b & 1) s = 1ll * s * a % mod;\n    a = 1ll * a * a % mod, b >>= 1;\n  }\n  return s;\n}\n\nint rev[N];\nvoid NTT(int L, int *a, int type) {\n  static ull f[N], w[N];\n  for(int i = 0; i < L; i++) {\n    rev[i] = (rev[i >> 1] >> 1) | (i & 1 ? L >> 1 : 0);\n    f[i] = a[rev[i]];\n  }\n  for(int d = 1; d < L; d <<= 1) {\n    int wn = ksm(type ? 3 : iv3, (mod - 1) / (d + d));\n    for(int i = w[0] = 1; i < d; i++) w[i] = w[i - 1] * wn % mod;\n    for(int i = 0; i < L; i += d + d)\n      for(int j = 0; j < d; j++) {\n        int y = f[i | j | d] * w[j] % mod;\n        f[i | j | d] = f[i | j] + mod - y, f[i | j] += y; \n      }\n    if(d == (1 << 16)) for(int i = 0; i < L; i++) f[i] %= mod;\n  }\n  int inv = ksm(L, mod - 2);\n  for(int i = 0; i < L; i++) a[i] = f[i] % mod * (type ? 1 : inv) % mod;\n}\n\nint vis[N], pr[N], mpr[N], cnt;\nint n, r[N], coe[N], f[N];\npair<int, int> mx[N], smx[N];\nvector<pair<int, int>> buc[N];\nbool Med;\nint main() {\n  fprintf(stderr, \"%.3lf MB\\n\", (&Mbe - &Med) / 1048576.0);\n  #ifdef ALEX_WEI\n    FILE* IN = freopen(\"1.in\", \"r\", stdin); \n    FILE* OUT = freopen(\"1.out\", \"w\", stdout);\n  #endif\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  for(int i = 2; i < N; i++) {\n    if(!vis[i]) pr[++cnt] = mpr[i] = i;\n    for(int j = 1; j <= cnt && i * pr[j] < N; j++) {\n      vis[i * pr[j]] = 1, mpr[i * pr[j]] = pr[j];\n      if(i % pr[j] == 0) break;\n    }\n    int tmp = i;\n    while(tmp > 1) {\n      int p = mpr[tmp], c = 0;\n      while(tmp % p == 0) tmp /= p, c++;\n      buc[i].push_back({p, c});\n    }\n  }\n  cin >> n;\n  for(int i = 1; i <= n; i++) {\n    cin >> r[i], coe[i] = 1;\n    for(auto _ : buc[r[i]]) {\n      int p = _.first, c = _.second;\n      pair<int, int> v = {c, i};\n      if(v > mx[p]) smx[p] = mx[p], mx[p] = v;\n      else if(v > smx[p]) smx[p] = v;\n    }\n  }\n  int lcm = 1;\n  for(int i = 2; i < N; i++) {\n    if(!mx[i].first) continue;\n    lcm = 1ll * lcm * ksm(i, mx[i].first) % mod;\n    int v = ksm(i, mx[i].first - smx[i].first);\n    coe[mx[i].second] = 1ll * coe[mx[i].second] * ksm(v, mod - 2) % mod;\n  }\n  for(int i = 1; i <= n; i++) add(f[r[i]], coe[i]);\n  NTT(N, f, 1);\n  for(int i = 0; i < N; i++) f[i] = 1ll * f[i] * f[i] % mod;\n  NTT(N, f, 0);\n  for(int i = 1; i <= n; i++) add(f[r[i] + r[i]], mod - 1ll * coe[i] * coe[i] % mod);\n  int ans = 0;\n  for(int i = 1; i < N; i++) {\n    if(!f[i]) continue;\n    int other = 1;\n    for(auto _ : buc[i]) {\n      int p = _.first, c = _.second;\n      other = 1ll * other * ksm(p, max(0, c - mx[p].first)) % mod;\n    }\n    add(ans, 1ll * lcm * other % mod * f[i] % mod);\n  }\n  cout << 1ll * ans * (mod + 1 >> 1) % mod << \"\\n\";\n  cerr << 1e3 * clock() / CLOCKS_PER_SEC << \" ms\\n\";\n  return 0;\n}\n```",
        "postTime": 1678320672,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P9135 [THUPC 2023 \u521d\u8d5b] \u5feb\u901f LCM \u53d8\u6362"
    }
]