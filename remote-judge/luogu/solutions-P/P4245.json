[
    {
        "content": "[\u6211\u7684\u535a\u5ba2](https://www.cnblogs.com/Memory-of-winter/p/10223844.html)\n\n**\u9898\u76ee\u5927\u610f\uff1a**\u7ed9\u4f60\u4e24\u4e2a\u591a\u9879\u5f0f$f(x)$\u548c$g(x)$\u4ee5\u53ca\u4e00\u4e2a\u6a21\u6570$p(p\\leqslant10^9)$\uff0c\u6c42$f*g\\pmod p$\n\n**\u9898\u89e3\uff1a**\u4efb\u610f\u6a21\u6570$NTT$\uff0c\u6700\u5927\u7684\u6570\u4e3a$p^2\\times\\max\\{n,m\\}\\leqslant10^{23}$\uff0c\u6240\u4ee5\u4e00\u822c\u9009$3$\u4e2a\u6a21\u6570\u5373\u53ef\uff0c\u6c42\u51fa\u8fd9\u4e09\u4e2a\u6a21\u6570\u4e0b\u7684\u7b54\u6848\uff0c\u7136\u540e\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5373\u53ef\u3002\n\n\u5047\u8bbe\u8fd9\u4e00\u4f4d\u7684\u7b54\u6848\u662f$x$\uff0c\u4e09\u4e2a\u6a21\u6570\u5206\u522b\u4e3a$A,B,C$\uff0c\u90a3\u4e48\uff1a\n\n$$\\begin{aligned}x\\equiv x_1\\pmod{A} \\\\ x\\equiv x_2\\pmod{B} \\\\ x\\equiv x_3\\pmod{C}\\end{aligned}$$\n\n\u5148\u628a\u524d\u4e24\u4e2a\u5408\u5e76\uff1a\n\n$$\\begin{aligned}x_1+k_1A=x_2+k_2B\\\\x_1+k_1A\\equiv x_2\\pmod{B}\\\\k_1\\equiv \\frac{x_2-x_1}A\\pmod{B}\\end{aligned}$$\n\n\u4e8e\u662f\u6c42\u51fa\u4e86$k_1$\uff0c\u4e5f\u5c31\u6c42\u51fa\u4e86$x\\equiv x_1+k_1A\\pmod{AB}$\uff0c\u8bb0$x_4=x_1+k_1A$\n\n$$\\begin{aligned}x_4+k_4AB=x_3+k_3C\\\\x_4+k_4AB\\equiv x_3\\pmod{C}\\\\k_4\\equiv \\dfrac{x_3-x_4}{AB}\\pmod{C}\\end{aligned}$$\n\n\u6c42\u51fa\u4e86$k_4$\uff0c$x\\equiv x_4+k_4AB\\pmod{ABC}$\uff0c\u56e0\u4e3a$x<ABC$\uff0c\u6240\u4ee5$x=x_4+k_4AB$\n\n\n\n**C++ Code\uff1a**\n\n```cpp\n#include <algorithm>\n#include <cstdio>\n#include <cstring>\nint mod;\nnamespace Math {\n\tinline int pw(int base, int p, const int mod) {\n\t\tstatic int res;\n\t\tfor (res = 1; p; p >>= 1, base = static_cast<long long> (base) * base % mod) if (p & 1) res = static_cast<long long> (res) * base % mod;\n\t\treturn res;\n\t}\n\tinline int inv(int x, const int mod) { return pw(x, mod - 2, mod); }\n}\n\nconst int mod1 = 998244353, mod2 = 1004535809, mod3 = 469762049, G = 3;\nconst long long mod_1_2 = static_cast<long long> (mod1) * mod2;\nconst int inv_1 = Math::inv(mod1, mod2), inv_2 = Math::inv(mod_1_2 % mod3, mod3);\nstruct Int {\n\tint A, B, C;\n\texplicit inline Int() { }\n\texplicit inline Int(int __num) : A(__num), B(__num), C(__num) { }\n\texplicit inline Int(int __A, int __B, int __C) : A(__A), B(__B), C(__C) { }\n\tstatic inline Int reduce(const Int &x) {\n\t\treturn Int(x.A + (x.A >> 31 & mod1), x.B + (x.B >> 31 & mod2), x.C + (x.C >> 31 & mod3));\n\t}\n\tinline friend Int operator + (const Int &lhs, const Int &rhs) {\n\t\treturn reduce(Int(lhs.A + rhs.A - mod1, lhs.B + rhs.B - mod2, lhs.C + rhs.C - mod3));\n\t}\n\tinline friend Int operator - (const Int &lhs, const Int &rhs) {\n\t\treturn reduce(Int(lhs.A - rhs.A, lhs.B - rhs.B, lhs.C - rhs.C));\n\t}\n\tinline friend Int operator * (const Int &lhs, const Int &rhs) {\n\t\treturn Int(static_cast<long long> (lhs.A) * rhs.A % mod1, static_cast<long long> (lhs.B) * rhs.B % mod2, static_cast<long long> (lhs.C) * rhs.C % mod3);\n\t}\n\tinline int get() {\n\t\tlong long x = static_cast<long long> (B - A + mod2) % mod2 * inv_1 % mod2 * mod1 + A;\n\t\treturn (static_cast<long long> (C - x % mod3 + mod3) % mod3 * inv_2 % mod3 * (mod_1_2 % mod) % mod + x) % mod;\n\t}\n} ;\n\n#define maxn 131072\n\nnamespace Poly {\n#define N (maxn << 1)\n\tint lim, s, rev[N];\n\tInt Wn[N | 1];\n\tinline void init(int n) {\n\t\ts = -1, lim = 1; while (lim < n) lim <<= 1, ++s;\n\t\tfor (register int i = 1; i < lim; ++i) rev[i] = rev[i >> 1] >> 1 | (i & 1) << s;\n\t\tconst Int t(Math::pw(G, (mod1 - 1) / lim, mod1), Math::pw(G, (mod2 - 1) / lim, mod2), Math::pw(G, (mod3 - 1) / lim, mod3));\n\t\t*Wn = Int(1); for (register Int *i = Wn; i != Wn + lim; ++i) *(i + 1) = *i * t;\n\t}\n\tinline void NTT(Int *A, const int op = 1) {\n\t\tfor (register int i = 1; i < lim; ++i) if (i < rev[i]) std::swap(A[i], A[rev[i]]);\n\t\tfor (register int mid = 1; mid < lim; mid <<= 1) {\n\t\t\tconst int t = lim / mid >> 1;\n\t\t\tfor (register int i = 0; i < lim; i += mid << 1) {\n\t\t\t\tfor (register int j = 0; j < mid; ++j) {\n\t\t\t\t\tconst Int W = op ? Wn[t * j] : Wn[lim - t * j];\n\t\t\t\t\tconst Int X = A[i + j], Y = A[i + j + mid] * W;\n\t\t\t\t\tA[i + j] = X + Y, A[i + j + mid] = X - Y;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!op) {\n\t\t\tconst Int ilim(Math::inv(lim, mod1), Math::inv(lim, mod2), Math::inv(lim, mod3));\n\t\t\tfor (register Int *i = A; i != A + lim; ++i) *i = (*i) * ilim;\n\t\t}\n\t}\n#undef N\n}\n\nint n, m;\nInt A[maxn << 1], B[maxn << 1];\nint main() {\n\tscanf(\"%d%d%d\", &n, &m, &mod); ++n, ++m;\n\tfor (int i = 0, x; i < n; ++i) scanf(\"%d\", &x), A[i] = Int(x % mod);\n\tfor (int i = 0, x; i < m; ++i) scanf(\"%d\", &x), B[i] = Int(x % mod);\n\tPoly::init(n + m);\n\tPoly::NTT(A), Poly::NTT(B);\n\tfor (int i = 0; i < Poly::lim; ++i) A[i] = A[i] * B[i];\n\tPoly::NTT(A, 0);\n\tfor (int i = 0; i < n + m - 1; ++i) {\n\t\tprintf(\"%d\", A[i].get());\n\t\tputchar(i == n + m - 2 ? '\\n' : ' ');\n\t}\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1546659812,
        "uid": 22072,
        "name": "Memory_of_winter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u60ca\u5947\u5730\u53d1\u73b0\u4f60\u8c37\u7adf\u7136\u6ca1\u6709 4 \u6b21 FFT \u7684 MTT \u7684\u9898\u89e3\u3002\n\n\u62c6\u7cfb\u6570\u5c31\u4e0d\u8bf4\u4e86\uff0c\u628a\u4e24\u4e2a\u591a\u9879\u5f0f $A(x), B(x)$ \u5206\u522b\u62c6\u6210 $A_0(x), A_1(x)$ \u548c$B_0(x), B_1(x)$ \u540e\uff0c\u8003\u8651\u6c42\u51fa\u5b83\u4eec\u7684\u70b9\u503c\u8868\u793a\uff0c\u4e5f\u5c31\u662f\u505a DFT \u3002  \n\u6734\u7d20\u5730\u505a DFT \u9700\u8981 4 \u6b21\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u4e9b\u591a\u9879\u5f0f\u865a\u90e8\u90fd\u4e3a 0 \uff0c\u53ef\u4ee5\u8003\u8651\u5c06\u4e24\u6b21 DFT \u5408\u5e76\u6210\u4e00\u6b21\u3002\n\n\u4f8b\u5982\u8981\u7ed9\u4e24\u4e2a\u591a\u9879\u5f0f $A, B$ \u505a DFT \uff0c\u8003\u8651\u6784\u9020\u4e24\u4e2a\u591a\u9879\u5f0f\uff1a\n\n$$P(x) = A(x) + i B(x)$$\n$$Q(x) = A(x) - i B(x)$$\n\n\u90a3\u4e48\u7531\u4e8e $A, B$ \u7684\u865a\u90e8\u90fd\u4e3a 0 \uff0c$P, Q$ \u7684\u6bcf\u4e00\u9879\u7cfb\u6570\u90fd\u4e92\u4e3a\u5171\u8f6d\uff0c\u540c\u6837\u6bcf\u4e00\u4e2a\u70b9\u503c\u4e5f\u4e92\u4e3a\u5171\u8f6d\u3002  \n\u90a3\u4e48\u53ea\u9700\u5bf9 $P$ \u505a\u4e00\u6b21 DFT \uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5171\u8f6d $O(n)$ \u6c42\u51fa $Q$ \u7684\u70b9\u503c\u8868\u793a\u3002  \n\u7136\u540e\u901a\u8fc7 $P, Q$ \u7684\u70b9\u503c\u8868\u793a\u6c42 $A, B$ \u7684\u70b9\u503c\u8868\u793a\u5c31\u662f\u89e3\u4e0a\u9762\u7684\u4e8c\u5143\u4e8c\u6b21\u65b9\u7a0b\u7ec4\uff0c\u4e5f\u662f\u53ef\u4ee5 $O(n)$ \u505a\u5230\u7684\u3002\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u7528\u4e24\u6b21 DFT \u6c42\u51fa $A_0, A_1, B_0, B_1$ \u7684\u70b9\u503c\u8868\u793a\u3002\n\n\u63a5\u4e0b\u6765\u9700\u8981\u6c42 $A, B$ \u4e4b\u95f4\u7684\u4e24\u4e24\u4e58\u79ef\u3002\u76f4\u63a5\u4e58\u51fa\u6765\u540e\u8981\u5bf9 $A_0 B_0, A_0 B_1, A_1 B_0, A_1 B_1$ \u56db\u4e2a\u591a\u9879\u5f0f\u505a IDFT \u3002  \n\u5e76\u4e14\u8fd9\u65f6\u5019\u5b83\u4eec\u7684\u865a\u90e8\u5e76\u4e0d\u4e3a 0 \uff0c\u4e0d\u80fd\u7528\u4e0a\u8ff0\u7684\u65b9\u6cd5\u3002\n\n\u4f46\u662f\u4e0a\u8ff0\u65b9\u6cd5\u7684\u601d\u60f3\u4ecd\u53ef\u501f\u9274\uff0c\u8003\u8651\u6784\u9020\u4e24\u4e2a\u591a\u9879\u5f0f\uff1a\n\n$$P(x) = A_0(x) B_0(x) + i A_1(x) B_0(x)$$\n$$Q(X) = A_0(x) B_1(x) + i A_1(x) B_1(x)$$\n\n\u901a\u8fc7\u5df2\u77e5\u7684\u70b9\u503c\u6c42\u51fa\u6b64\u65f6 $P, Q$ \u7684\u70b9\u503c\uff0c\u7136\u540e\u5206\u522b\u5bf9 $P, Q$ \u505a IDFT \uff0c  \n\u7531\u4e8e $A_0 B_0, A_0 B_1, A_1 B_0, A_1 B_1$ \u8fd9\u56db\u4e2a\u591a\u9879\u5f0f\u5377\u8d77\u6765\u540e\u7684\u7cfb\u6570\u8868\u793a\u4e2d\u865a\u90e8\u4e00\u5b9a\u4e3a 0 \uff0c  \n\u90a3\u4e48\u6b64\u65f6 $P$ \u7684\u5b9e\u90e8\u548c\u865a\u90e8\u5c31\u5206\u522b\u4e3a $A_0(x) B_0(x)$ \u548c $A_1(x) B_0(x)$ \uff0c\n\u540c\u6837 $Q$ \u7684\u5b9e\u90e8\u548c\u865a\u90e8\u5c31\u5206\u522b\u4e3a $A_0(x) B_1(x)$ \u548c $A_1(x) B_1(x)$ \u3002\n\n\u53c2\u8003\u5b9e\u73b0\uff1a\n\n```cpp\n#include <cstdio>\n#include <complex>\n#define debug(...) fprintf(stderr, __VA_ARGS__)\n\ntypedef long long lolong;\ntypedef std::complex<double> complex;\n\ninline int input() { int x; scanf(\"%d\", &x); return x; }\ninline lolong linput() { lolong x; scanf(\"%lld\", &x); return x; }\n\nconst int maxn = 400005, maxk = 20;\nconst complex I(0, 1);\nint R[maxn];\ncomplex Wn[maxn];\n\nvoid FFT(complex *A, int n, int t) {\n\tif(t == -1)\n\t\tfor(int i = 1; i < n; i ++)\n\t\t\tif(i < (n - i))\n\t\t\t\tstd::swap(A[i], A[n - i]);\n\tfor(int i = 0; i < n; i ++)\n\t\tif(i < R[i])\n\t\t\tstd::swap(A[i], A[R[i]]);\n\n\tfor(int m = 1, l = 0; m < n; m <<= 1, l ++) {\n\t\t/* complex Wn(cos(M_PI / m), sin(M_PI / m) * t); */\n\t\tfor(int i = 0; i < n; i += m << 1) {\n\t\t\t/* complex W = 1; */\n\t\t\tfor(int k = i; k < i + m; k ++) {\n\t\t\t\t/* complex W(cos(M_PI / m * (k - i)), sin(M_PI / m * (k - i)) * t); */\n\t\t\t\tcomplex W = Wn[1ll * (k - i) * n / m];\n\t\t\t\t/* if(t == -1) W = std::conj(W); */\n\t\t\t\tcomplex a0 = A[k], a1 = A[k + m] * W;\n\t\t\t\tA[k] = a0 + a1;\n\t\t\t\tA[k + m] = a0 - a1;\n\t\t\t\t/* W *= Wn; */\n\t\t\t}\n\t\t}\n\t}\n\n\tif(t == -1)\n\t\tfor(int i = 0; i < n; i ++)\n\t\t\tA[i] /= n;\n}\n\nint mod;\ninline lolong num(complex x) {\n\tdouble d = x.real();\n\treturn d < 0 ? lolong(d - 0.5) % mod : lolong(d + 0.5) % mod;\n}\n\ninline void FFTFFT(complex *a, complex *b, int len, int t) {\n\tfor(int i = 0; i < len; i ++)\n\t\ta[i] = a[i] + I * b[i];\n\tFFT(a, len, t);\n\tfor(int i = 0; i < len; i ++)\n\t\tb[i] = std::conj(a[i ? len - i : 0]);\n\tfor(int i = 0; i < len; i ++) {\n\t\tcomplex p = a[i], q = b[i];\n\t\ta[i] = (p + q) * 0.5;\n\t\tb[i] = (q - p) * 0.5 * I;\n\t}\n}\n\ncomplex a0[maxn], a1[maxn], b0[maxn], b1[maxn];\n/* complex a0b0[maxn], a1b0[maxn], a0b1[maxn], a1b1[maxn]; */\ncomplex p[maxn], q[maxn];\n\nint main() {\n\tint n = input(), m = input();\n\tmod = input();\n\tint M = int(sqrt(mod) + 1);\n\n\tfor(int i = 0; i <= n; i ++) {\n\t\tint x = input() % mod;\n\t\ta0[i] = x / M;\n\t\ta1[i] = x % M;\n\t}\n\tfor(int i = 0; i <= m; i ++) {\n\t\tint x = input() % mod;\n\t\tb0[i] = x / M;\n\t\tb1[i] = x % M;\n\t}\n\n\tint len = 1;\n\twhile(len < n + m + 1)\n\t\tlen <<= 1;\n\n\tfor(int i = 1; i < len; i ++)\n\t\tR[i] = R[i >> 1] >> 1 | ((i & 1) * (len >> 1));\n\n\tfor(int i = 0; i < len; i ++)\n\t\tWn[i] = complex(cos(M_PI / len * i), sin(M_PI / len * i));\n\n\tFFTFFT(a0, a1, len, 1);\n\tFFTFFT(b0, b1, len, 1);\n\n\tfor(int i = 0; i < len; i ++) {\n\t\tp[i] = a0[i] * b0[i] + I * a1[i] * b0[i];\n\t\tq[i] = a0[i] * b1[i] + I * a1[i] * b1[i];\n\t}\n\n\tFFT(p, len, -1);\n\tFFT(q, len, -1);\n\n\tfor(int i = 0; i <= n + m; i ++)\n\t\tprintf(\"%lld \", (M * M * num(p[i].real()) % mod +\n\t\t\t\tM * (num(p[i].imag()) + num(q[i].real())) % mod +\n\t\t\t\tnum(q[i].imag())) % mod);\n\tputs(\"\");\n}\n```\n",
        "postTime": 1571408407,
        "uid": 52232,
        "name": "Kewth",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u4e00\u79cd\u5947\u602a\u7684\u62c6\u7cfb\u6570FFT?\u9700\u89815\u6b21FFT\u4f46\u662f\u63a8\u5bfc\u5f88\u7b80\u5355,\u4fbf\u4e8e\u8bb0\u5fc6,\u5e38\u6570\u4e5f\u4e0d\u5927\u3002\n\n\u5377\u79ef\u540e\uff0c\u80fd\u4ea7\u751f\u7684\u6700\u5927\u7684\u6570\u4e5f\u5c31\u662f$mod*mod*len$,\u5b9e\u6218\u5e94\u7528\u4e2d\u4e00\u822c\u662f$10^9*10^9*10^5=10^{23}$\u3002\n\n\u6211\u4eec\u53ea\u8981\u5f04\u4e00\u4e2a\u7cbe\u5ea6\u591f\u9ad8\u7684\u591a\u9879\u5f0f\u4e58\u6cd5,\u5c31\u80fd\u505a\u5230\u4e0d\u4e22\u7cbe\u5ea6\u3002\n\n\u4e00\u79cd\u60f3\u6cd5\u662f:\u8dd1\u4e5d\u6b21NTT(\u4e09\u6b21\u4e58\u6cd5),\u628a\u7b54\u6848\u7528\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5408\u5e76,\u7cbe\u5ea6\u53ef\u8fbe$10^{26}$\n\n\u8fd9\u79cd\u505a\u6cd5\u5e38\u6570\u5b9e\u5728\u8fc7\u5927,\u800c\u4e14$10^{26}$\u4f7f\u7528`long long`\u5b58\u4e0d\u4e0b,\u8fd8\u9700\u8981\u4e00\u4e9b\u9ed1\u79d1\u6280\u8f85\u52a9,\u6240\u4ee5\u4e0d\u63a8\u8350\u3002\n\n\u53e6\u4e00\u79cd\u60f3\u6cd5\u662f:\u62c6\u7cfb\u6570FFT\u3002\n\n\u628a\u4e00\u4e2a\u6570\u62c6\u6210$a*2^{15}+b$\u7684\u5f62\u5f0f,\u90a3\u4e48$a,b<=2^{15}$\n\n\u628a$a$\u548c$b$\u5f04\u6210\u4e24\u4e2a\u591a\u9879\u5f0f,\u8fd9\u6837\u76f8\u4e58\u7684\u503c\u57df\u662f$n*mod\u224810^{14}$\n\n\u90a3\u4e48$c_1*c_2=(a_1*2^{15}+b_1)(a_2*2^{15}+b_2)$\n\n$=a_1a_2*2^{30}+(a_1b_2+a_2b_1)2^{15}+b_1b_2$\n\n\u90a3\u4e48\u5c31\u662f\u8981\u505a$4$\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5?12\u6b21FFT?\u5e38\u6570\u7206\u70b8!\n\n\u51b7\u9759\u5206\u6790:\u6bcf\u4e2a\u591a\u9879\u5f0f\u53ea\u7528\u63d2\u503c\u4e00\u6b21,\u51714\u6b21\u3002\n\n\u70b9\u4e58\u590d\u6742\u5ea6\u5ffd\u7565,\u6700\u540e\u5f97\u5230\u7684\u56db\u4e2a\u591a\u9879\u5f0f\u5404\u63d2\u503c\u4e00\u6b21,\u51714\u6b21\u3002\n\n\u8fd9\u6837\u5c31\u662f8\u6b21FFT,\u5e38\u6570\u8fd8\u662f\u7206\u70b8\u2026\u2026\n\n\u6211\u4eec\u8003\u8651\u63a8\u63a8\u5f0f\u5b50\u6765\u4f18\u5316:\n\n\u6211\u4eec\u6709\u56db\u4e2a\u591a\u9879\u5f0f$A1,A2,B1,B2$,\u6c42\u8fd9\u4e9b\u591a\u9879\u5f0f\u7684\u4e24\u4e24\u4e58\u79ef\u3002\n\n\u8003\u8651\u5230$(a+bi)*(c+di)=a(c+di)*bi(c+di)=ac-bd+(ad+bc)i$\n\n\u90a3\u4e48\u6211\u4eec\u8bbe\u590d\u591a\u9879\u5f0f$P=A1+iA2;\\ Q=B1+iB2;$\n\n\u90a3\u4e48$T1=P*Q=A1B1-A2B2+(A1B2+A2B1)i$\n\n\u6211\u4eec\u53c8\u8bbe$P'=A1-iA2$\n\n\u90a3\u4e48$T2=P'*Q=A1B1+A2B2+(A1B2-A2B1)i$\n\n$T1+T2=2(A1B1+iA1B2)$,\u8fd9\u6837\u6211\u4eec\u5c31\u6c42\u51fa\u4e86\u5176\u4e2d\u4e24\u4e2a,\u51cf\u4e00\u51cf\u5c31\u80fd\u5f97\u5230\u53e6\u5916\u4e24\u4e2a\u3002\n\n\u603b\u7684FFT\u6b21\u6570\u662f:3\u6b21DFT+2\u6b21IDFT=5\u6b21.\n\n\u4e0d\u8fc7,\u503c\u57df\u5e76\u4e0d\u662f\u7f8e\u597d\u7684$10^{14}$,\u800c\u662f$10^{19}$,\u56e0\u4e3a\u5728IDFT\u51fa\u6765\u4e4b\u524d\u8fd8\u5f97\u9664\u4ee5$n$\u2026\u2026\n\n`long double`\u4fe1\u4ef0\u8dd1\u5427,\u4ee3\u7801\u5e76\u4e0d\u96be\u5199\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<cmath>\n#define Maxn 100500\n#define lim 32000\nconst long double Pi=acos(-1);\nusing namespace std;\ninline int read()\n{\n  register int X=0;\n  register char ch=0;\n  while(ch<48||ch>57)ch=getchar();\n  while(ch>=48&&ch<=57)X=X*10+(ch^48),ch=getchar();\n  return X;\n}\nint n,m,p,tr[Maxn<<2];\nstruct CP\n{\n  long double x,y;\n  CP operator + (const CP& B) const\n  {return (CP){x+B.x,y+B.y};}\n  CP operator - (const CP& B) const\n  {return (CP){x-B.x,y-B.y};}\n  CP operator * (const CP& B) const\n  {return (CP){x*B.x-y*B.y,x*B.y+y*B.x};}\n}P1[Maxn<<2],P2[Maxn<<2],Q[Maxn<<2];\nvoid FFT(CP *f,int op,int n)\n{\n  for (int i=0;i<n;i++)\n   if (i<tr[i])swap(f[i],f[tr[i]]);\n  for(int p=2;p<=n;p<<=1){\n    int len=p>>1;\n    CP tmp=(CP){std::cos(Pi/len),op*std::sin(Pi/len)};\n    for(int k=0;k<n;k+=p){\n      CP buf=(CP){1,0};\n      for(int l=k;l<k+len;l++){\n        CP tt=buf*f[len+l];\n        f[len+l]=f[l]-tt;\n        f[l]=f[l]+tt;\n        buf=buf*tmp;\n      }//F(x)=FL(x^2)+x*FR(x^2)\n       //F(W^k)=FL(w^k)+W^k*FR(w^k)\n       //F(W^{k+n/2})=FL(w^k)-W^k*FR(w^k)\n    }\n  }\n}\nint ans[Maxn<<2];\nint main()\n{\n  scanf(\"%d%d%d\",&n,&m,&p);n++;m++;\n  for (int i=0,sav;i<n;i++){\n    sav=read();\n    P1[i]=(CP){sav/lim,sav%lim};\n    P2[i]=(CP){sav/lim,-sav%lim};\n  }\n  for (int i=0,sav;i<m;i++){\n    sav=read();\n    Q[i]=(CP){sav/lim,sav%lim};\n  }\n  int len=1;\n  for (m=m+n-1;len<m;len<<=1);\n  for (int i=1;i<len;i++)\n    tr[i]=tr[i>>1]>>1|((i&1)?len>>1:0);\n  FFT(P1,1,len);FFT(P2,1,len);FFT(Q,1,len);\n  for (int i=0;i<len;i++){Q[i].x/=len;Q[i].y/=len;}\n  for (int i=0;i<len;i++)P1[i]=P1[i]*Q[i];\n  for (int i=0;i<len;i++)P2[i]=P2[i]*Q[i];\n  FFT(P1,-1,len);FFT(P2,-1,len);\n  for (int i=0;i<m;i++){\n    long long a1b1=0,a1b2=0,a2b1=0,a2b2;\n    a1b1=(long long)floor((P1[i].x+P2[i].x)/2+0.49)%p;\n    a1b2=(long long)floor((P1[i].y+P2[i].y)/2+0.49)%p;\n    a2b1=((long long)floor(P1[i].y+0.49)-a1b2)%p;\n    a2b2=((long long)floor(P2[i].x+0.49)-a1b1)%p;\n    ans[i]=((a1b1*lim+(a1b2+a2b1))*lim+a2b2)%p;\n    ans[i]=(ans[i]+p)%p;\n    printf(\"%d \",ans[i]);\n  }return 0;\n}\n```\n\n\u5982\u679c\u88ab\u5361,\u8003\u8651\u9884\u5904\u7406\u5355\u4f4d\u6839\u3002\n\n\u76ee\u6d4b\u5e38\u6570\u662f$NTT$\u76844\u500d\u2026\u2026",
        "postTime": 1563707118,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u5176\u5b9e\u8fd9\u4e2a\u9898\u5361\u7cbe\u5ea6\u6765\u7740\u2026\u2026\u6211\u4e5f\u6ca1\u60f3\u5230\u8981\u5f00long double\u624d\u80fd\u8fc7\u2026\u2026\u56e0\u4e3a\u6570\u636e\u662f\u7528ddd\u7684\u6a21\u677f\u505a\u7684\uff0c\u4ed6\u7528\u7684\u597d\u50cf\u662f\u5408\u5e76dft\u7cbe\u5ea6\u6bd4\u8f83\u9ad8\u6765\u7740QAQ  \n\u5176\u5b9e\u5c31\u662f\u628a\u6bcf\u4e2a\u6570\u62c6\u6210 $a \\cdot 32768 + b$ \u7684\u5f62\u5f0f\uff0c\u7136\u540e\u4e58\u8d77\u6765\u518d\u5c55\u5f00\u5c31\u53ef\u4ee5\u4e86\u3002\u5f53\u7136\u4f60\u60f3\u8981NTT\u5408\u5e76\u4e5f\u884cqwq  \n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include <bits/stdc++.h>\n\ntypedef long long int64;\ntypedef long double D;\n\nint MOD;\nconst int MAXN = 524288;\nconst D PI = acos(-1);\n\nstruct complex {\n\tD real, imag;\n\tcomplex() { real = imag = 0; }\n\tcomplex(D x): real(x), imag(0) {} \n\tcomplex(D x, D y): real(x), imag(y) {}\n\tinline complex conj() { return complex(real, -imag); }\n\tinline complex operator+(complex rhs) const { return complex(real + rhs.real, imag + rhs.imag); }\n\tinline complex operator-(complex rhs) const { return complex(real - rhs.real, imag - rhs.imag); }\n\tinline complex operator*(complex rhs) const { return complex(real * rhs.real - imag * rhs.imag,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t imag * rhs.real + real * rhs.imag); }\n\tinline complex operator*=(complex rhs) { return (*this) = (*this) * rhs; }\n\t//(a+bi)(c+di) = (ac-bd) + (bc+ad)i\n\tfriend inline complex operator*(D x, complex cp) { return complex(x * cp.real, x * cp.imag); }\n\tinline complex operator/(D x) const { return complex(real / x, imag / x); }\n\tinline complex operator/=(D x) { return (*this) = (*this) / x; }\n\tfriend inline complex operator/(D x, complex cp) { return x * cp.conj() / (cp.real * cp.real - cp.imag * cp.imag); }\n\tinline complex operator/(complex rhs) const { \n\t\treturn (*this) * rhs.conj() / (rhs.real * rhs.real - rhs.imag * rhs.imag); \n\t}\n\tinline complex operator/=(complex rhs) { return (*this) = (*this) / rhs; }\n\tinline D length() { return sqrt(real * real + imag * imag); }\n};\n\ninline complex get_omega(int len, bool inv) {\n\treturn inv ? complex(std::cos(2*PI / len), -std::sin(2*PI / len))\n\t\t\t\t:complex(std::cos(2*PI / len),  std::sin(2*PI / len));\n}\n\ninline void fft(int len, complex* A, bool inv = false) {\n\tstatic int R[MAXN+10];\n\tfor(int i = 0; i < len; i++)\n\t\tR[i] = ((R[i>>1]>>1) | (len >> (i&1))) & (len-1);\n\tfor(int i = 0; i < len; i++)\n\t\tif(R[i] > i) std::swap(A[i], A[R[i]]);\n\tfor(int step = 1; step < len; step <<= 1) \n\t\tfor(int i = 0; i < len; i += (step<<1)) {\n\t\t\tcomplex omega = 1, t = 0, rt = get_omega(step<<1, inv);\n\t\t\tfor(int j = 0; j < step; j++, omega *= rt) {\n\t\t\t\tt = A[i+j+step] * omega;\n\t\t\t\tA[i+j+step] = A[i+j] - t;\n\t\t\t\tA[i+j] = A[i+j] + t;\n\t\t\t}\n\t\t}\n\tif(inv)\n\t\tfor(int i = 0; i < len; i++)\n\t\t\tA[i] /= len;\n}\n\nvoid mtt(int deg, int *lhs, int *rhs, int *ret) {\n\tstatic complex A[MAXN+10], B[MAXN+10], C[MAXN+10], D[MAXN+10],\n\t\t\t\t   E[MAXN+10], F[MAXN+10], G[MAXN+10], H[MAXN+10];\n\tint len; for(len = 1; len <= 2*deg; len<<=1);\n\tfor(int i = 0; i < len; i++) {\n\t\tlhs[i] %= MOD; rhs[i] %= MOD;\n\t\tA[i] = lhs[i] >> 15; B[i] = lhs[i] & 0x7fff;\n\t\tC[i] = rhs[i] >> 15; D[i] = rhs[i] & 0x7fff;\n\t}\n\tfft(len, A); fft(len, B); fft(len, C); fft(len, D);\n\tfor(int i = 0; i < len; i++) {\n\t\tE[i] = A[i] * C[i]; F[i] = B[i] * C[i];\n\t\tG[i] = A[i] * D[i]; H[i] = B[i] * D[i];\n\t}\n\tfft(len, E, true); fft(len, F, true); \n\tfft(len, G, true); fft(len, H, true);\n\tfor(int i = 0; i < len; i++)\n\t\tret[i] = (((int64(round(E[i].real)) % MOD)<<30) % MOD + ((int64(round(F[i].real)) % MOD)<<15) % MOD\n\t\t\t+ ((int64(round(G[i].real)) % MOD)<<15) % MOD + int64(round(H[i].real)) % MOD) % MOD;\n}\n\nint deg, n, m, F[MAXN+10], G[MAXN+10], H[MAXN+10];\n\ninline int readint() {\n\tint f=1, r=0; char c=getchar();\n\twhile(!isdigit(c)) { if(c=='-')f=-1; c=getchar(); }\n\twhile(isdigit(c)) { r=r*10+c-'0'; c=getchar(); }\n\treturn f*r;\n}\n\nint main() {\n\tn = readint(); m = readint(); MOD = readint();\n\tfor(int i = 0; i <= n; i++) \n\t\tF[i] = readint();\n\tfor(int i = 0; i <= m; i++)\n\t\tG[i] = readint();\n\tmtt(std::max(n, m), F, G, H);\n\tfor(int i = 0; i <= n + m; i++)\n\t\tprintf(\"%d \", H[i]);\n}\n```",
        "postTime": 1520382577,
        "uid": 23865,
        "name": "panda_2134",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011MTT\u3011"
    },
    {
        "content": "## \u4efb\u610f\u6a21\u6570NTT\n\n### \u66b4\u529b\n\n\u6709\u5982\u4e0b\u4e24\u79cd\u89e3\u51b3\u601d\u8def\uff1a\n\n- \u9009\u53d6\u4e09\u4e2a\u6709\u539f\u6839\u7684\u6a21\u6570\uff0c\u5e76\u4e14\u4e09\u4e2a\u6a21\u6570\u7684\u4e58\u79ef\u5927\u4e8e\u6700\u7ec8\u7ed3\u679c\u7684\u7406\u8bba\u6700\u5927\u503c\uff0c\u8fdb\u884c\u4e09\u6b21NTT\uff0c\u6700\u540e\u628a\u6bcf\u4e00\u9879\u7528CRT\u5408\u5e76\uff0c\u9700\u89819\u6b21DFT\u3002\n- \u4ee4$k=sqrt(p)$\uff0c\u591a\u9879\u5f0f$M(x)=k*A(x)+B(x)$\uff0c$N(x)=k*C(x)+D(x)$\uff0c\u7136\u540e$M(x)N(x)=k^2A(x)C(x)+k(A(x)D(x)+B(x)C(x))+B(x)D(x)$\uff0c\u8981\u8fdb\u884c8\u6b21DFT\u3002\n\n\u90fd\u5f88\u6162...\n\n### \u4f18\u5316\n\nmyy\u5728\u300a\u518d\u63a2\u5feb\u901f\u5085\u91cc\u53f6\u53d8\u6362\u300b\u4e2d\u4ecb\u7ecd\u4e86\u4e00\u79cd\u65b9\u6cd5\u3002\n\n\u4ee4$Q_j=A_j+iB_j$,$E_j=C_j+iD_j$\u3002\n\n\u590d\u6570m\u5b9e\u90e8\u4e3a$m.a$\uff0c\u865a\u90e8\u4e3a$m.b$\uff0c$Q(x)$\u4e2d\u7b2c$j$\u9879\u8d21\u732e\u4e3a$Q(x)_j$\u3002\n\n\u5c55\u5f00\n$$\nQ(w_n^j)_x=(A_x+iB_x) {w_n^j}^x=A_x(cos({2\u03c0x j\\over n})+isin({2\u03c0xj \\over n}))+B_x(icos({2\u03c0x j\\over n})-sin({2\u03c0xj \\over n}))\n$$\n\u540c\u7406\n$$\nQ(w_n^{-j})_x=A_x(cos({2\u03c0xj\\over n})-isin({2\u03c0x j \\over n}))+B_x(icos({2\u03c0x j\\over n})+sin({2\u03c0xj \\over n}))\n$$\n\n\u56e0\u6b64\n$$\nA(w_n^j)_x={Q(w_n^j)_x.a+Q(w_n^{-j})_x.a\\over 2}+i{Q(w_n^j)_x.b-Q(w_n^{-j})_x.b\\over 2}\n$$\n\n\u540c\u7406\n$$\nB(w_n^j)_x={Q(w_n^j)_x.b+Q(w_n^{-j})_x.b\\over 2}+i{Q(w_n^{-j})_x.a-Q(w_n^j)_x.a\\over 2}\n$$\n\n\u5148\u4e0a\u4ee3\u7801\u3002\n```cpp\nconst int LIM=(1<<15)-1;\nfor(int i=0;i<len;++i)Q[i]= {M[i]&LIM,M[i]>>15};\nfor(int i=len;i<n;++i)Q[i]= {0,0};\nfor(int i=0;i<len1;++i)E[i]= {N[i]&LIM,N[i]>>15};\nfor(int i=len1;i<n;++i)E[i]= {0,0};\nDFT(Q,1),DFT(E,1);\nfor(int i=0;i<n;++i){\n\tint fr=(n-i)&(n-1);\n\tc1[i]= (cp) {0.5*(Q[i].a+Q[fr].a),0.5*(Q[i].b-Q[fr].b)}*E[i];\n\td1[i]= (cp) {0.5*(Q[i].b+Q[fr].b),0.5*(Q[fr].a-Q[i].a)}*E[i];\n}\nDFT(c1,-1),DFT(d1,-1);\nfor(int i=0;i<n;++i)c1[i]=c1[i]/n,d1[i]=d1[i]/n;\nfor(int i=0;i<n;++i){\n\tlong long p=c1[i].a+0.5,o=c1[i].b+0.5,x=d1[i].a+0.5,u=d1[i].b+0.5;\n\tans[i]=(p%mod+((o+x)%mod<<15)+(u%mod<<30))%mod;\n}\n```\n\n\u663e\u7136$c1(x)=A(x)*E(x)=A(x)*C(x)+i*A(x)*D(x)$\u3002\n\n\u6613\u77e5$c1(x)$\u5b9e\u90e8\u4e3a$A(x)C(x)$\uff0c\u865a\u90e8\u4e3a$A(x)D(x)$\u3002\n\n\u5bf9\u4e8e$d1$\u540c\u7406\u3002\n\n\u56e0\u6b64\u6700\u7ec8\u53ea\u9700\u89814\u6b21DFT\u5373\u53ef\u6c42\u51fa$A(x)C(x),A(x)D(x),B(x)C(x),B(x)D(x)$\u3002\n\n\n### FFT\u4e09\u5408\u4e8c\n\n\u540c\u6837\u7684\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u65b9\u6cd5\u5e94\u7528\u5230FFT\u4e2d\u3002\n\n\u4e24\u4e2a\u591a\u9879\u5f0f$A(x),B(x)$,\u4ee4$C(x)=A(x)+iB(x)$\uff0c\u53ef\u4ee5\u5c062\u6b21DFT\u7b80\u5316\u4e3a1\u6b21DFT\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u5f88\u7b80\u5355\u3002\n\n",
        "postTime": 1552280475,
        "uid": 92040,
        "name": "KLauraLee",
        "ccfLevel": 0,
        "title": "\u300c\u6a21\u677f\u300dMTT"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u4e2a $5$ \u6b21 FFT \u7684\u505a\u6cd5\uff0c\u4f46\u662f\u53ef\u4ee5\u628a $4$ \u6b21 FFT \u540a\u8d77\u6765\u9524\u3002\r\n\r\n\u6211\u7ed9\u540c\u5b66\u8bb2\u4e86\u8fd9\u79cd\u505a\u6cd5\uff0c\u4ed6\u8bf4\u8fd9\u4e2a\u505a\u6cd5\u540a\u6253\u522b\u7684 $5$ \u6b21 FFT\uff0c\u5efa\u8bae\u6211\u53d1\u7bc7\u9898\u89e3\uff0c\u90a3\u5c31\u53d1\u5427\u3002\u3002\u3002\r\n\r\n\u8fd9\u79cd $5$ \u6b21 FFT \u7684\u505a\u6cd5\u4e0d\u9700\u8981\u6839\u636e\u7cfb\u6570\u7684\u5173\u7cfb\u89e3\u65b9\u7a0b\u4ec0\u4e48\u7684\uff0c\u53ea\u9700\u8981\u8bbe\u590d\u591a\u9879\u5f0f\u7136\u540e\u5927\u529b\u5377\u5c31\u884c\u4e86\u3002\u3002\u3002\u91cd\u8981\u7684\u662f $4$ \u6b21 FFT \u4e0d\u80fd\u7528\u8f6c\u7f6e\u4f46\u662f\u8fd9\u79cd $5$ \u6b21\u7684\u53ef\u4ee5\u3002\r\n\r\n\u5047\u8bbe\u6211\u4eec\u8981\u8ba1\u7b97 $F(x)\\times G(x)$\u3002\r\n\r\n\u8bbe $F(x)=A(x)+c\\times B(x),G(x)=C(x)+c\\times D(x)$\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\uff1a\r\n$$A(x)C(x)+c\\times(A(x)D(x)+B(x)C(x))+c^2\\times B(x)D(x)$$\r\n\u5bf9\u6bd4\u4e00\u4e0b\uff1a\r\n$$A(x)C(x),A(x)D(x)$$\r\n$$B(x)C(x),B(x)D(x)$$\r\n\u8bbe $T(x)=C(x)+i\\times D(x)$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728 $A(x)T(x)$ \u548c $B(x)T(x)$ \u4e2d\u627e\u5230\u6211\u4eec\u9700\u8981\u7684\u6240\u6709\u9879\u3002\r\n\r\n\u9700\u8981\u5bf9 $A(x),B(x),T(x)$ \u505a DFT\uff0c$A(x)T(x)$ \u548c $B(x)T(x)$ \u505a IDFT\uff0c\u8dd1\u8d77\u6765\u8fd8\u662f\u76f8\u5f53\u5feb\u7684\u3002\r\n\r\n\u5e76\u4e14\u6211\u4f7f\u7528\u8fd9\u79cd MTT \u8dd1\u957f\u5ea6\u4e3a $2^{21}$ \u7684\u5377\u79ef\u65f6\u4ecd\u7136\u6ca1\u6389\u7cbe\u5ea6\u3002\r\n```cpp\r\n#include<cstdio>\r\n#include<cctype>\r\n#include<cmath>\r\n#define IMP(lim,act) for(int qwq=(lim),i=0;i^qwq;++i)act\r\ntypedef double db;\r\nconst int M=1<<18|5;\r\nconst db Pi=acos(-1);\r\nint n,m,P,F[M],G[M],H[M];\r\nstruct Barrett{\r\n\ttypedef unsigned long long ull;\r\n\ttypedef __uint128_t LL;\r\n\tull B,m;\r\n\tBarrett(const ull&m=2):m(m),B((LL(1)<<64)/m){}\r\n\tfriend inline ull operator%(const ull&a,const Barrett&mod){\r\n\t\tull r=a-mod.m*(LL(mod.B)*a>>64);return r>=mod.m?r-mod.m:r;\r\n\t}\r\n}mod;\r\nstruct complex{\r\n\tdb x,y;\r\n\tcomplex(const db&x=0,const db&y=0):x(x),y(y){}\r\n\tinline complex operator+(const complex&it)const{\r\n\t\treturn complex(x+it.x,y+it.y);\r\n\t}\r\n\tinline complex operator-(const complex&it)const{\r\n\t\treturn complex(x-it.x,y-it.y);\r\n\t}\r\n\tinline complex operator*(const complex&it)const{\r\n\t\treturn complex(x*it.x-y*it.y,x*it.y+y*it.x);\r\n\t}\r\n}buf[M<<1],*w[20];\r\ninline int Getlen(const int&n){\r\n\tint len(0);while((1<<len)<n)++len;return len;\r\n}\r\ninline void swap(complex&a,complex&b){\r\n\tcomplex c=a;a=b;b=c;\r\n}\r\ninline int Get(const db&x){\r\n\treturn((long long)(x+.5))%mod;\r\n}\r\ninline void init(const int&n){\r\n\tconst int&m=Getlen(n);complex*now=buf;w[m]=now;now+=1<<m;\r\n\tIMP(1<<m,w[m][i]=complex(std::cos(i*Pi/(1<<m)),std::sin(i*Pi/(1<<m))));\r\n\tfor(int k=m-1;k>=0&&(w[k]=now,now+=1<<k);--k)IMP(1<<k,w[k][i]=w[k+1][i<<1]);\r\n}\r\ninline void DFT(complex*f,const int&M){\r\n\tconst int&n=1<<M;\r\n\tfor(int len=n>>1,d=M-1;d>=0;--d,len>>=1)for(int k=0;k^n;k+=len<<1){\r\n\t\tcomplex*W=w[d],*L=f+(k),*R=f+(k|len),x,y;IMP(len,(x=*L,y=*R)),*L++=(x+y),*R++=*W++*(x-y);\r\n\t}\r\n}\r\ninline void IDFT(complex*f,const int&M){\r\n\tconst int&n=1<<M;\r\n\tfor(int len=1,d=0;d^M;++d,len<<=1)for(int k=0;k^n;k+=len<<1){\r\n\t\tcomplex*W=w[d],*L=f+(k),*R=f+(k|len),x,y;IMP(len,(x=*L,y=*W++**R)),*L++=(x+y),*R++=(x-y);\r\n\t}\r\n\tIMP(n,(f[i].x/=n,f[i].y/=n));for(int i=1;(i<<1)<n;++i)swap(f[i],f[n-i]);\r\n}\r\ninline void MTT(int*f,int*g,int*h,const int&n,const int&m,const int&LEN){\r\n\tstatic complex Q[M],P[M],T[M];const int&len=Getlen(n+m-1);\r\n\tIMP(n,(Q[i].x=f[i]&32767,P[i].x=f[i]>>15));IMP(m,T[i]=complex(g[i]&32767,g[i]>>15));\r\n\tDFT(Q,len);DFT(P,len);DFT(T,len);IMP(1<<len,(Q[i]=Q[i]*T[i],P[i]=P[i]*T[i]));IDFT(Q,len);IDFT(P,len);\r\n\tIMP(LEN,h[i]=(Get(Q[i].x)+(1ll*(Get(Q[i].y)+Get(P[i].x))<<15)+(1ll*Get(P[i].y)<<30))%mod);\r\n\tIMP(1<<len,Q[i]=P[i]=T[i]=complex());\r\n}\r\ninline int read(){\r\n\tint n(0);char s;while(!isdigit(s=getchar()));while(n=n*10+(s&15),isdigit(s=getchar()));return n;\r\n}\r\ninline void write(int n){\r\n\tstatic char s[15];int top(0);while(s[++top]=n%10^48,n/=10);while(putchar(s[top]),--top);putchar(' ');\r\n}\r\nsigned main(){\r\n\tn=read()+1;m=read()+1;mod=Barrett(P=read());init(n+m-1);\r\n\tIMP(n,F[i]=read());IMP(m,G[i]=read());MTT(F,G,H,n,m,n+m-1);IMP(n+m-1,write(H[i]));\r\n}\r\n```",
        "postTime": 1656501409,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6a21\u677f P4245\u9898\u89e3"
    },
    {
        "content": "\u5927\u5bb6\u597d\uff0c\u4f5c\u4e3a\u4e00\u540d\u591a\u9879\u5f0f\u83dc\u9e21\uff0c\u6211\u7528karatsuba\u4e58\u6cd5\u901a\u8fc7\u4e86\u672c\u9898\u3002\n\n$\\quad$\u4f17\u6240\u5468\u77e5\uff0c\u5982\u679c\u6a21\u6570\u4e0d\u540c\uff0cNTT\u652f\u6301\u7684\u503c\u57df\u53ea\u80fd\u5c0f\u4e8e\u6a21\u6570\uff0c\u4e5f\u5c31\u662f\u53d6\u6a21\u5bf9\u6240\u6709\u7b54\u6848\u90fd\u4e0d\u4f1a\u4ea7\u751f\u5f71\u54cd\uff0c\u4e0d\u7136\u5c31\u53ea\u80fd\u4f7f\u7528\u4e09\u6a21NTT\u52a0\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u89e3\u51b3\u3002\u800cFFT\u652f\u6301\u53d6\u6a21\u64cd\u4f5c\uff0c\u4f46\u662f\u7cbe\u5ea6\u7206\u70b8\uff0c\u5165\u95e8\u591a\u9879\u5f0f\u9009\u624b\u901a\u5e38\u8981\u75287\u30018\u6b21FFT\uff08\u5f53\u7136\uff0c\u5f88\u591a\u795e\u4ed9\u53ef\u4ee5\u53ea\u75284\u6b215\u6b21\u751a\u81f33\u6b21\uff09\u3002\u76f8\u6bd4\u4e8e\u6a21\u677f\uff0c\u8fd9\u9053\u9898\u4f7f\u7528NTT\u548cFFT\u7684\u96be\u5ea6\u52a0\u5927\u4e86\u8bb8\u591a\u3002\n\n$\\quad$\u7136\u800c\uff0c\u591a\u9879\u5f0f\u4e58\u6cd5\u5e76\u4e0d\u53ea\u6709\u8fd9\u4e24\u79cd\u4e58\u6cd5\uff0c\u8fd8\u6709\u4e00\u79cd\u601d\u8def\u66f4\u52a0\u7b80\u5355\u7684\u3001\u53ea\u9760\u4ee3\u6570\u8f6c\u5316\u6765\u964d\u4f4e\u590d\u6742\u5ea6\u7684\u7b97\u6cd5\uff1akaratsuba\u4e58\u6cd5\u3002\u5b83\u7684\u539f\u7406\u53ea\u6709\u77ed\u77ed\u51e0\u884c\uff1a\n\n\u6211\u4eec\u628a\u591a\u9879\u5f0f$f$\u62c6\u6210$A\\times x^p+B$,$g$\u62c6\u6210$C\\times x^p+D$\n$$f\\times g$$\n$$=(A\\times x^p+B)\\times(C\\times x^p+D)$$\n$$=AC\\times x^{2p}+BC\\times x^p+AD\\times x^p+BD$$\n$$=AC\\times x^{2p}+(BC+AD)\\times x^p+BD$$\n\u800c$BC+AD=(A+B)(C+D)-AC-BD$\n\n\u6240\u4ee5\u539f\u5f0f$=AC\\times x^{2p}+[(A+B)(C+D)-AC-BD]\\times x^p+BD$\n\n\u6211\u4eec\u53d1\u73b0\u53ea\u9700\u89813\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\u548c\u82e5\u5e72\u6b21\u52a0\u51cf\u6cd5\u5373\u53ef\u3002\n\n\u90a3\u8fd9\u4e2a\u590d\u6742\u5ea6\u662f\u591a\u5c11\u5462\uff1f\n\n\u5b66\u4e60\u4e86[\u8fd9\u7bc7\u535a\u5ba2](https://zhuanlan.zhihu.com/p/55653747)\n\n\u5b83\u7684\u9012\u63a8\u5f0f\u662f$T(n)=3T(\\frac{n}{2})+O(n),T(1)=1$\n\n\u6211\u4eec\u63a8\u4e00\u4e0b\uff1a\n\n\u8bbe \n$$k=log_2n,n=2^k,f(k)=T(2^k)$$\n\u6240\u4ee5\n$$f(k)=3f(k-1)+2^k$$\n\u540c\u65f6\u9664\u4ee5$3^k$\n$$\\frac{f(k)}{3^k}=\\frac{f(k-1)}{3^{k-1}}+(\\frac{2}{3})^k$$\n\u8bbe\n$$g(k)=\\frac{f(k)}{3^k}$$\n\u6240\u4ee5\n$$g(k)=\\sum_{i=1}^k{(\\frac{2}{3})^i}\\leq 3$$\n\u4e0a\u9762\u53ef\u4ee5\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u8bc1\u660e,\u5e26\u56de\u6765\uff1a\n$$f(k)\\leq 3^{k+1}$$\n$$T(n)=f(log_2n)\\leq f({3}^{log_2n+1})$$\n$$=O(3^{log_2n})=O(2^{log_2 3\\times log_2 n})=O(n^{log_2 3})$$\n\n$log_23$\u5927\u6982\u662f1.585\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u590d\u6742\u5ea6\u53ef\u4ee5\u8fd1\u4f3c\u5730\u770b\u6210$O(n\\sqrt{n})$\n\n\u53e6\u5916\u5982\u679c$n=2^k$\uff0c\u5b83\u7684\u901a\u9879\u662f$T(n)=2\\times 3^k-2^{k+1}$(orz [Crazyali](https://www.luogu.com.cn/user/18215))\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u63a8\u4e00\u4e0b\u3002\n\n\u5f53\u7136\uff0c\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u5206\u66f4\u591a\u7ec4\uff0c\u590d\u6742\u5ea6\u53ef\u4ee5\u8fdb\u4e00\u6b65\u964d\u4f4e\uff0c\u4f46\u4f1a\u589e\u5927\u5e38\u6570\u4e14\u53d8\u6362\u66f4\u52a0\u590d\u6742\uff0c\u901a\u5e38\u4e0d\u4f1a\u4f7f\u7528\u3002\n\n\u4ecb\u7ecd\u5b8c\u8fd9\u4e2a\u7b97\u6cd5\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u5b83\u5728\u771f\u6b63\u7684\u4e58\u6cd5\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u4efb\u4f55\u7684\u8981\u6c42\uff0c\u4e5f\u6ca1\u6709\u5355\u4f4d\u6839\u3001\u539f\u6839\u7b49\u9650\u5236\uff0c\u6240\u4ee5\u8fd9\u9898\u5bf9\u4e8ekaratsuba\u4e58\u6cd5\u6765\u8bf4\u548c\u591a\u9879\u5f0f\u4e58\u6cd5\u6a21\u677f\u51e0\u4e4e\u6ca1\u6709\u5dee\u522b\uff0c\u52a0\u4e0a\u8fd9\u9898\u4ec5$10^5$\u7684\u6570\u636e\u8303\u56f4\uff0c\u5bf9karatsuba\u975e\u5e38\u53cb\u597d~~\u5f53\u7136\u8fd8\u662f\u5361\u5e38~~\n\n\u4e8e\u662f\u51fa\u73b0\u4e86\u5c0f\u849f\u84bb\u7b2c\u4e00\u4efd\u4ee3\u7801:\n```cpp\n\nvoid fill(vector<LL> &f,vector<LL> &a,vector<LL> &b,int len){\n\tb.resize(len);a.resize(f.size()-len);\n\tint cnt=0;\n\tfor(int i=0;i<len;++i)\n\t\tb[cnt++]=f[i];\n\tcnt=0;\n\tfor(int i=len;i<f.size();++i)\n\t\ta[cnt++]=f[i];\n}\n//(a*p+b)(c*p+d)=ac*p^2+bc*p+ad*p+bd\n//=ac*p^2+(ad+bc)*p+bd\n//=ac*p^2+((a+b)(c+d)-ac-bd)*p+bd\nvoid add(LL &a,LL b){((a+=b)>=Mod)?(a-=Mod):0;}\nvoid sub(LL &a,LL b){((a-=b)<0)?(a+=Mod):0;} \nvoid MUL(vector<LL> &f,vector<LL> &g,vector<LL> &res){\n\tres.resize(f.size()+g.size()-1);\n\tfor(int i=0;i<res.size();++i)res[i]=0;\n\tif(f.size()<2||g.size()<2){\n\t\tfor(int i=0;i<f.size();++i)\n\t\t\tfor(int j=0;j<g.size();++j)\n\t\t\t\tres[i+j]=(res[i+j]+f[i]*g[j])%Mod;\n\t\treturn;\n\t}\n\tvector<LL>a,b,c,d,r1,r2,r3,r4;\n\tint len1=(f.size())/2,len2=(g.size())/2;\n\ta.clear();b.clear();c.clear();d.clear();\n\tfill(f,a,b,len1);fill(g,c,d,len2);\n\tr1.clear();r2.clear();r3.clear();r4.clear();\n\tMUL(a,c,r1);\n\tfor(int i=0;i<r1.size();++i){\n\t\tadd(res[i+len1+len2],r1[i]);\n\t\tsub(res[i+len1],r1[i]);\n\t}\n\tMUL(b,d,r4);\n\tfor(int i=0;i<r4.size();++i){\n\t\tadd(res[i],r4[i]);\n\t\tsub(res[i+len1],r4[i]);\n\t}\n\tfor(int i=0;i<len1;++i)add(a[i],b[i]);\n\tfor(int i=0;i<len2;++i)add(c[i],d[i]);\n\tMUL(a,c,r3);\n\tfor(int i=0;i<r3.size();++i){\n\t\tadd(res[i+len1],r3[i]);\n\t}\n}\n```\n[\u7ed3\u679c](https://www.luogu.com.cn/record/29927587)\n\n\u8981\u662f\u8fd9\u6837\u5c31\u80fd\u8fc7\uff0c\u90a3\u4f30\u8ba1\u4e5f\u8f6e\u4e0d\u4e0a\u6211\u5199\u9898\u89e3\u4e86\u3002\n- \u5c0f\u6280\u5de70\n\n\u8fd9\u4e2a\u5e94\u8be5\u4e0d\u7528\u89e3\u91ca\u5427\n```cpp\n#pragma GCC optimize(2) \n#pragma GCC optimize(3) \n#pragma GCC optimize(\"Ofast\")\n```\n- \u5c0f\u6280\u5de71\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u7b97\u6cd5\u7684\u5e38\u6570\u8fd8\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u8981\u597d\u51e0\u6b21\u591a\u9879\u5f0f\u52a0\u51cf\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u5230\u6bd4\u8f83\u5c0f\u7684\u6570\u636e\u8303\u56f4\u65f6\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u7b97\u3002\u7a9d\u53d6\u7684\u8303\u56f4\u662f30\u4ee5\u5185\u3002\n```cpp\n\nvoid fill(vector<LL> &f,vector<LL> &a,vector<LL> &b,int len){\n\tb.resize(len);a.resize(f.size()-len);\n\tint cnt=0;\n\tfor(int i=0;i<len;++i)\n\t\tb[cnt++]=f[i];\n\tcnt=0;\n\tfor(int i=len;i<f.size();++i)\n\t\ta[cnt++]=f[i];\n}\n//(a*p+b)(c*p+d)=ac*p^2+bc*p+ad*p+bd\n//=ac*p^2+(ad+bc)*p+bd\n//=ac*p^2+((a+b)(c+d)-ac-bd)*p+bd\nvoid add(register LL &a,register LL b){((a+=b)>=Mod)?(a-=Mod):0;}\nvoid sub(register LL &a,register LL b){((a-=b)<0)?(a+=Mod):0;} \nvoid MUL(vector<LL> &f,vector<LL> &g,vector<LL> &res){\n\tres.resize(f.size()+g.size()-1);\n\tfor(int i=0;i<res.size();++i)res[i]=0;\n\tif(f.size()<32||g.size()<32){\n\t\tfor(int i=0;i<f.size();++i)\n\t\t\tfor(int j=0;j<g.size();++j)\n\t\t\t\tres[i+j]=(res[i+j]+f[i]*g[j])%Mod;\n\t\treturn;\n\t}\n\tvector<LL>a,b,c,d,r1,r2,r3,r4;\n\tint len1=(f.size())/2,len2=(g.size())/2;\n\ta.clear();b.clear();c.clear();d.clear();\n\tfill(f,a,b,len1);fill(g,c,d,len2);\n\tr1.clear();r2.clear();r3.clear();r4.clear();\n\tMUL(a,c,r1);\n\tfor(int i=0;i<r1.size();++i){\n\t\tadd(res[i+len1+len2],r1[i]);\n\t\tsub(res[i+len1],r1[i]);\n\t}\n\tMUL(b,d,r4);\n\tfor(int i=0;i<r4.size();++i){\n\t\tadd(res[i],r4[i]);\n\t\tsub(res[i+len1],r4[i]);\n\t}\n\tfor(int i=0;i<len1;++i)add(a[i],b[i]);\n\tfor(int i=0;i<len2;++i)add(c[i],d[i]);\n\tMUL(a,c,r3);\n\tfor(int i=0;i<r3.size();++i){\n\t\tadd(res[i+len1],r3[i]);\n\t}\n}\n```\n[\u7ed3\u679c](https://www.luogu.com.cn/record/29928466)\n\n- ~~\u5c0f\u6280\u5de72~~\n\n~~\u53ef\u4ee5\u628aint\u6539\u6210long long~~\n\n\u7136\u540e\u53d1\u73b0\u751a\u81f3\u6162\u4e86\u4e00\u70b9\u3002\n\n\u6d1b\u8c37\u7684\u8bc4\u6d4b\u673a\u662f64\u4f4d\uff0c\u6240\u4ee5long long\u771f\u7684\u6ca1\u6709\u6bd4int\u6162\u3002\n\n~~\u5c51~~\n\n- \u5c0f\u6280\u5de73\n\n\u90fd\u8bf4vector\u5e38\u6570\u5927\uff0c\u90a3\u6211\u6539\u6210\u6570\u7ec4\uff1f\n\n\u5728\u6211\u795e\u5947\u7684\u672c\u673a\u4ece20s\u53d8\u6210\u4e866s\uff01\uff08\u672c\u673a20s\u4ea4\u4e0a\u53bb\u771f\u670970\uff09\n```cpp\nvoid fill(LL *f,LL *a,LL *b,int len,int sz){\n\tfor(rint i=0;i<len;++i)\n\t\tb[i]=f[i];\n\tint cnt=0;\n\tfor(rint i=len;i<sz;++i)\n\t\ta[cnt++]=f[i];\n}\n//(a*p+b)(c*p+d)=ac*p^2+bc*p+ad*p+bd\n//=ac*p^2+(ad+bc)*p+bd\n//=ac*p^2+((a+b)(c+d)-ac-bd)*p+bd\nvoid add(register LL &a,register LL b){((a+=b)>=Mod)?(a-=Mod):0;}\nvoid sub(register LL &a,register LL b){((a-=b)<0)?(a+=Mod):0;} \nvoid MUL(LL *f,LL *g,LL *res,int dep,int sz1,int sz2){\n\tfor(int i=0;i<sz1+sz2;++i)res[i]=0;\n\tif(sz1<28){\n\t\tfor(register int i=0;i<sz1;++i)\n\t\t\tfor(register int j=0;j<sz2;++j)\n\t\t\t\tres[i+j]=(res[i+j]+f[i]*g[j])%Mod;\n\t\treturn;\n\t}\n\tint len=sz1/2;\n\tfill(f,a[dep],b[dep],len,sz1);fill(g,c[dep],d[dep],len,sz2);\n\tMUL(a[dep],c[dep],r1[dep],dep+1,sz1-len,sz2-len);\n\tint L=sz1+sz2-len-len-1;\n\tfor(int i=0;i<L;++i){\n\t\tsub(res[i+len],r1[dep][i]);\n\t\tadd(res[i+(len<<1)],r1[dep][i]);\n\t}\n\tMUL(b[dep],d[dep],r4[dep],dep+1,len,len);\n\tfor(rint i=0;i<len*2-1;++i){\n\t\tregister LL tmp=r4[dep][i];\n\t\tadd(res[i],tmp);\n\t\tsub(res[i+len],tmp);\n\t}\n\tfor(rint i=0;i<len;++i)add(a[dep][i],b[dep][i]);\n\tfor(rint i=0;i<len;++i)add(c[dep][i],d[dep][i]);\n\tMUL(a[dep],c[dep],r3[dep],dep+1,sz1-len,sz2-len);\n\tfor(rint i=0;i<L;++i){\n\t\tadd(res[i+len],r3[dep][i]);\n\t}\n}\n```\n[\u53d1\u73b0\u6beb\u65e0\u610f\u4e49](https://www.luogu.com.cn/record/29930918)\n\n\u5185\u5b58\u8c03\u7528\u597d\u7384\u5b66\u554a\uff0c~~\u53c8\u60f3\u8d77k\u7ea7\u7956\u5148\u957f\u5256\u88ab\u6811\u5256\u540a\u6253\u7684\u6050\u60e7~~\n\n- \u6700\u66b4\u529b\u7684\u64cd\u4f5c\n\n\u4e00\u76f4\u572870\u5206\u5f98\u5f8a\u597d\u4e45\uff0c\u4e07\u5ff5\u4ff1\u7070\u4e4b\u9645\uff0c\u770b\u5230\u66b4\u529b\u4e58\u6cd5\uff1a\n```cpp\n\tfor(register int i=0;i<sz1;++i)\n\t\tfor(register int j=0;j<sz2;++j)\n\t\t\tres[i+j]=(res[i+j]+f[i]*g[j])%Mod;\n\treturn;\n```\n\u53d6\u6a21\u597d\u50cf\u6709\u70b9\u591a\u3002\u3002\u3002\u3002\n\n\u4f46\u662flong long \u80af\u5b9a\u8981\u968f\u65f6\u53d6\u6a21\u554a\u3002\u3002\u3002\n\n### __int128???\n\n\u6d1b\u8c37\u662f64\u4f4d\u673a\u5b50\u6765\u7740\u3002\u3002\u3002\n\n```cpp\n\n\tif(sz1<28){\n\t\tfor(register int i=0;i<sz1;++i)\n\t\t\tfor(register int j=0;j<sz2;++j)\n\t\t\t\tqwq[i+j]+=(LL)f[i]*g[j];\n\t\tfor(int i=0;i<sz1+sz2;++i)res[i]=qwq[i]%Mod,qwq[i]=0;\n\t\treturn;\n\t}\n    //qwq\u662f__int128\n```\n\n\u7136\u540e\u63d0\u4ea4\u2014\u2014[???](https://www.luogu.com.cn/record/29931859)\n\n\u8fc7 \u4e86\n\n\u884c\u5427\uff0c\u771f\u7384\u5b66\u3002\n\n\u6700\u540e\u7684AC\u4ee3\u7801\uff1a\n```cpp\n#pragma GCC optimize(2) \n#pragma GCC optimize(3) \n#pragma GCC optimize(\"Ofast\")\n#include<bits/stdc++.h>\nusing namespace std;\n#define LL long long\n#define mn 19\n#define MN 200005\n#define rint register int\nint Mod=998244353,n,m;\n__int128 qwq[59]; \n//vector<LL>F,G,ANS;\nint a[mn][MN],b[mn][MN],c[mn][MN],d[mn][MN],r1[mn][MN],r4[mn][MN],r3[mn][MN],F[MN],G[MN],ANS[MN];\nvoid fill(int *f,int *a,int *b,int len,int sz){\n\tfor(rint i=0;i<len;++i)\n\t\tb[i]=f[i];\n\tint cnt=0;\n\tfor(rint i=len;i<sz;++i)\n\t\ta[cnt++]=f[i];\n}\n//(a*p+b)(c*p+d)=ac*p^2+bc*p+ad*p+bd\n//=ac*p^2+(ad+bc)*p+bd\n//=ac*p^2+((a+b)(c+d)-ac-bd)*p+bd\nvoid add(register int &a,register int b){((a+=b)>=Mod)?(a-=Mod):0;}\nvoid sub(register int &a,register int b){((a-=b)<0)?(a+=Mod):0;} \nvoid MUL(int *f,int *g,int *res,int dep,int sz1,int sz2){\n\tfor(int i=0;i<sz1+sz2;++i)res[i]=0;\n\tif(sz1<28){\n\t\tfor(register int i=0;i<sz1;++i)\n\t\t\tfor(register int j=0;j<sz2;++j)\n\t\t\t\tqwq[i+j]+=(LL)f[i]*g[j];\n\t\tfor(int i=0;i<sz1+sz2;++i)res[i]=qwq[i]%Mod,qwq[i]=0;\n\t\treturn;\n\t}\n\tint len=sz1/2;\n\tfill(f,a[dep],b[dep],len,sz1);fill(g,c[dep],d[dep],len,sz2);\n\tMUL(a[dep],c[dep],r1[dep],dep+1,sz1-len,sz2-len);\n\tint L=sz1+sz2-len-len-1;\n\tfor(int i=0;i<L;++i){\n\t\tsub(res[i+len],r1[dep][i]);\n\t\tadd(res[i+(len<<1)],r1[dep][i]);\n\t}\n\tMUL(b[dep],d[dep],r4[dep],dep+1,len,len);\n\tfor(rint i=0;i<len*2-1;++i){\n\t\tregister LL tmp=r4[dep][i];\n\t\tadd(res[i],tmp);\n\t\tsub(res[i+len],tmp);\n\t}\n\tfor(rint i=0;i<len;++i)add(a[dep][i],b[dep][i]);\n\tfor(rint i=0;i<len;++i)add(c[dep][i],d[dep][i]);\n\tMUL(a[dep],c[dep],r3[dep],dep+1,sz1-len,sz2-len);\n\tfor(rint i=0;i<L;++i){\n\t\tadd(res[i+len],r3[dep][i]);\n\t}\n}\ninline int read(){\n\tint a=0;char c=getchar();\n\twhile(c>'9'||c<'0')c=getchar();\n\twhile('0'<=c&&c<='9'){\n\t\ta=a*10+c-48;\n\t\tc=getchar();\n\t}\n\treturn a;\n}\nint main(){\n//\tfreopen(\"qwq.in\",\"r\",stdin);\n//\tfreopen(\"qwq.out\",\"w\",stdout);\n\tn=read();m=read();Mod=read();\n\tint N=max(n+1,m+1);\n\tfor(int i=0;i<=n;++i)F[i]=read()%Mod;\n\tfor(int i=0;i<=m;++i)G[i]=read()%Mod;\n\tMUL(F,G,ANS,0,N,N);\n\tfor(int i=0;i<=n+m;++i)\n\t\tprintf(\"%d \",ANS[i]);\n\treturn 0;\n}\n```\n\u4e8e\u662f\u51b3\u5b9a\u5199\u7bc7\u535a\u5ba2\u4f9b\u5927\u5bb6\u5a31\u4e50\u3002\n\n\u53e6\u5916\uff0c\u5c0f\u849f\u84bb\u7684\u5b9e\u73b0\u4e0d\u7b97\u6e05\u771f\uff0c\u6b22\u8fce\u5927\u5bb6\u63d0\u51fa\u6539\u8fdb\u5efa\u8bae\u548c\u6279\u8bc4\u3002\n\n\n",
        "postTime": 1580613119,
        "uid": 7480,
        "name": "skydogli",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u5982\u679c\u4e0d\u53d6\u6a21\uff0c\u6309 OI \u5e38\u89c1\u6570\u636e\u8303\u56f4\u6765\u8bb2\u4e24\u4e2a\u591a\u9879\u5f0f\u76f8\u4e58\u4ee5\u540e\u7cfb\u6570\u4e0d\u8d85\u8fc7 $10^9\\times10^9\\times10^5=10^{23}$\uff0c\u5982\u679c\u6211\u4eec\u7b97\u51fa\u8be5\u591a\u9879\u5f0f\u5206\u522b $\\bmod$ 3 \u4e2a NTT \u6a21\u6570\u4e0b\u7684\u503c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 CRT \u5408\u5e76\u8ba1\u7b97\u51fa\u6a21\u4e09\u4e2a\u6a21\u6570\u4e4b\u79ef\u7684\u503c\uff0c\u800c\u8fd9\u6837\u6700\u9ad8\u7cbe\u5ea6\u80fd\u8fbe\u5230 $10^{26}$ \u7ea7\u522b\uff0c\u8db3\u591f\u5e94\u4ed8\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u4e00\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\u9700\u8981 9 \u6b21 DFT\uff0c\u6bd4\u8f83\u6162\u3002\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0b\u6bd4\u8f83\u5e38\u89c1\u7684\u4f18\u5316\u62c6\u7cfb\u6570 FFT\u3002\n\n\u4f17\u6240\u5468\u77e5\uff0cFFT \u4e2d\u4e0d\u7528\u53d6\u6a21\uff0c\u53ea\u9700\u8981\u7ed3\u679c\u53d6\u4e00\u6b21\u6a21\u5c31\u53ef\u4ee5\u4e86\u3002\u4f46\u662f\u8fd9\u9898\u6700\u5927\u7684\u7cfb\u6570\u8fbe\u5230\u4e86 $10^{23}$ \u7ea7\u522b\uff0c\u76f4\u63a5 FFT \u7cbe\u5ea6\u4e0d\u8db3\u3002\u5bf9\u6b64\u6211\u4eec\u5f15\u51fa\u62c6\u7cfb\u6570 FFT\u3002\n\n\u8bbe $bas$ \u4e3a\u4e00\u4e2a $\\sqrt{p}$ \u7ea7\u522b\u7684\u6570\uff0c$F(x),G(x)$ \u4e3a\u6211\u4eec\u8981\u8fdb\u884c\u4e58\u6cd5\u7684\u591a\u9879\u5f0f\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a \u4e24\u4e2a\u591a\u9879\u5f0f\u8868\u793a\u6210\u4ee5\u4e0b\u5f62\u5f0f\uff1a\n$$\n\\begin{aligned}\nF(x)=basA(x)+B(x)\\\\\nG(x)=basC(x)+D(x)\n\\end{aligned}\n$$\n\u5176\u4e2d\uff0c$[x^n]A(x)=\\lfloor \\frac{[x^n]F(x)}{bas} \\rfloor$\uff0c$[x^n]B(x)=[x^n]F(x)\\bmod bas$\uff0c\u5bf9\u4e8e $C(x),D(x)$ \u540c\u7406\u3002\u8fd9\u6837\u7cfb\u6570\u5c31\u88ab\u964d\u4f4e\u5230\u4e86 $10^5bas^2$ \u7684\u7ea7\u522b\u3002\u90a3\u4e48\u6709\n$$\n\\begin{aligned}\nF(x)G(x)&=(basA(x)+B(x))(basC(x)+D(x))\\\\\n&=bas^2A(x)C(x)+bas(A(x)D(x)+B(x)C(x))+B(x)D(x)\n\\end{aligned}\n$$\n\u8fd9\u6837\u5148\u7b97\u51fa $A(x),B(x),C(x),D(x)$ \u7684\u70b9\u503c\u8868\u793a\uff0c\u7136\u540e\u6839\u636e\u4e58\u7684\u7cfb\u6570\u4e0d\u540c\u505a\u4e09\u6b21 IDFT\uff0c\u8fd9\u6837\u4e00\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\u4e00\u5171\u8981\u505a 7 \u6b21 FFT\u3002\n\n\u6211\u4eec\u53d1\u73b0 DFT \u7684\u65f6\u5019\u865a\u90e8\u4e00\u5f00\u59cb\u5168\u4e3a 0\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u65b9\u6cd5\u5229\u7528\u4e0a\u8fd9\u91cc\uff0c\u51cf\u5c11 DFT \u6b21\u6570\u3002\n\n\u9996\u5148\u6211\u4eec\u8981\u660e\u767d DFT \u7684\u672c\u8d28\u662f $F(w_n^k)=\\sum\\limits_{i=0}^nf_iw_n^{ki}$ \uff0c\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u8981\u7b97\u51fa $A(x)$ \u4e0e $B(x)$ \u7684\u70b9\u503c\u8868\u793a\u3002\n\n\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u4e2a\u6570\u7ec4\u4f7f\u5f97 $F[k]=A(w_n^k)+iB(w_n^k)$\uff0c$G[k]=A(w_n^k)-iB(w_n^k)$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u89e3\u65b9\u7a0b\u7ec4\u7684\u65b9\u5f0f\u77e5\u9053 $A(w_n^k)$ \u4e0e $B(w_n^k)$\u3002\n\n\u73b0\u5728\u6211\u4eec\u5c1d\u8bd5\u63a8\u5bfc $F$ \u4e0e $G$ \u7684\u5173\u7cfb\uff0c\u901a\u8fc7 DFT \u7684\u5b9a\u4e49\u53ef\u4ee5\u77e5\u9053\uff1a\n$$\n\\begin{aligned}\nF[k]&=A(w_n^k)+iB(w_n^k)\\\\\n&=\\sum\\limits_{j=0}^{n-1}a_iw_n^{kj}+i\\sum\\limits_{i=0}^nb_jw_n^{kj}\\\\\n&=\\sum\\limits_{j=0}^{n-1}{n-1}(a_j+ib_j)w_n^{kj}\\\\\n&=\\sum\\limits_{j=0}^{n-1}(a_j+ib_j)(\\cos(X)+i\\sin(X))\\\\\n&=\\sum\\limits_{j=0}^{n-1}(a_j\\cos(X)-b_j\\sin(X))+i(b_j\\cos(X)+a_j\\sin(X))\\\\\n\\end{aligned}\n$$\n\u5176\u4e2d\uff0c$X=\\frac{2\\pi kj}{n}$\u3002\n\n\u540c\u65f6\uff0c\u6211\u4eec\u6709\n$$\n\\begin{aligned}\nG[n-k]&=A(w_n^{n-k})-iB(w_n^{n-k})\\\\\n&=A(w_n^{-k})-iB(w_n^{-k})\\\\\n&=\\sum\\limits_{j=0}^{n-1}a_iw_n^{-kj}-i\\sum\\limits_{i=0}^nb_jw_n^{-kj}\\\\\n&=\\sum\\limits_{j=0}^{n-1}{n-1}(a_j-ib_j)w_n^{-kj}\\\\\n&=\\sum\\limits_{j=0}^{n-1}(a_j-ib_j)(\\cos(X)-i\\sin(X))\\\\\n&=\\sum\\limits_{j=0}^{n-1}(a_j\\cos(X)-b_j\\sin(X))-i(b_j\\cos(X)+a_j\\sin(X))\\\\\n\\end{aligned}\n$$\n\u6240\u4ee5\uff0c\u6211\u4eec\u53d1\u73b0 $F[k]$ \u4e0e $G[n-k]$ \u662f\u5171\u8f6d\u7684\uff08$k=0$ \u65f6\u8981\u7279\u5224\u4e00\u4e0b\u653e\u5230 $G[0]$ \u53bb\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u51fa $F$\uff0c\u5c31\u53ef\u4ee5 $O(n)$ \u8ba1\u7b97\u51fa $G$\u3002\u8fd9\u6837\u53ea\u9700\u8981 2 \u6b21 FFT\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u56db\u4e2a\u591a\u9879\u5f0f\u7684\u70b9\u503c\u3002\n\n\u7136\u540e\u8003\u8651 IDFT \u90e8\u5206\uff0c\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u7701\u4e00\u6b21 FFT\u3002\u6211\u4eec\u6b63\u5e38\u6c42 IDFT \u7684\u65f6\u5019\u6700\u540e\u7ed3\u679c\u5168\u90e8\u90fd\u5728\u5b9e\u90e8\uff08\u4e0d\u660e\u767d\u53bb\u770b\u5355\u4f4d\u6839\u53cd\u6f14\uff09\uff0c\u90a3\u4e48\u5982\u679c\u6211\u4eec\u5728\u6700\u5f00\u59cb\u6bcf\u4e2a\u70b9\u503c\u90fd\u4e58\u4e0a $i$\uff0c\u90a3\u4e48\u6700\u540e\u51fa\u6765\u7684\u7ed3\u679c\u5e94\u8be5\u90fd\u5728\u865a\u90e8\uff0c\u800c\u4e14\u6570\u503c\u548c\u653e\u5728\u5b9e\u90e8\u4e0a\u76f8\u7b49\u3002\u6211\u4eec\u77e5\u9053 FFT \u662f\u4e00\u4e2a\u7ebf\u6027\u53d8\u6362\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u8981\u6c42\u7684\u4e24\u4e2a\u591a\u9879\u5f0f\u5206\u522b\u653e\u5728\u5b9e\u90e8\u548c\u865a\u90e8\u4e0a\uff0c\u7136\u540e IDFT \u4e4b\u540e\u5b9e\u90e8\u548c\u865a\u90e8\u4e0a\u5c31\u662f\u5206\u522b\u7684\u539f\u591a\u9879\u5f0f\u4e86\u3002\u8fd9\u6837\u5c31\u53c8\u7701\u4e86\u4e00\u6b21 FFT\uff0c\u4e00\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\u603b\u5171\u9700\u8981 4 \u6b21\u3002\n\n\u5b9e\u9645\u4f7f\u7528\u4e00\u822c\u8bbe $bas$ \u4e3a $2$ \u7684\u6b21\u5e42\uff0c\u6bd4\u8f83\u65b9\u4fbf\u63d0\u53d6\u7cfb\u6570\u3002  \n\u8fd9\u4efd\u4ee3\u7801\u5b9e\u73b0\u4e0d\u591f\u7cbe\u7ec6\uff0c\u6ca1\u6709\u9884\u5904\u7406\u5355\u4f4d\u6839\uff0c\u5bfc\u81f4\u7cbe\u5ea6\u4e0d\u8db3\u5fc5\u987b\u5f00 `long double`  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace poly\n{\n    long double const pi=acos(-1);\n    struct comp\n    {\n        long double r,i;\n        comp(){r=i=0;}\n        comp(long double x,long double y){r=x,i=y;}\n        comp conj(){return comp(r,-i);}\n        friend comp operator +(comp x,comp y){return comp(x.r+y.r,x.i+y.i);}\n        friend comp operator -(comp x,comp y){return comp(x.r-y.r,x.i-y.i);}\n        friend comp operator *(comp x,comp y){return comp(x.r*y.r-x.i*y.i,x.i*y.r+x.r*y.i);}\n    };\n    typedef long long ll;\n    int r[400005];\n    comp a[400005],b[400005],c[400005],d[400005];\n    void fft(comp *f,int n,int op)\n    {\n        for(int i=1;i<n;i++)r[i]=(r[i>>1]>>1)+((i&1)?(n>>1):0);\n        for(int i=1;i<n;i++)if(i<r[i])swap(f[i],f[r[i]]);\n        for(int len=2;len<=n;len<<=1)\n        {\n            int q=len>>1;\n            comp wn=comp(cos(pi/q),op*sin(pi/q));\n            for(int i=0;i<n;i+=len)\n            {\n                comp w=comp(1,0);\n                for(int j=i;j<i+q;j++,w=w*wn)\n                {\n                    comp d=f[j+q]*w;\n                    f[j+q]=f[j]-d;\n                    f[j]=f[j]+d;\n                }\n            }\n        }\n    }\n    void mtt(int *f,int *g,int *h,int n,int p)\n    {\n        for(int i=0;i<n;i++)\n            a[i].r=(f[i]>>15),a[i].i=(f[i]&32767),\n            c[i].r=(g[i]>>15),c[i].i=(g[i]&32767);\n        fft(a,n,1),fft(c,n,1);\n        for(int i=1;i<n;i++)b[i]=a[n-i].conj();\n        b[0]=a[0].conj();\n        for(int i=1;i<n;i++)d[i]=c[n-i].conj();\n        d[0]=c[0].conj();\n        for(int i=0;i<n;i++)\n        {\n            comp \n            aa=(a[i]+b[i])*comp(0.5,0),\n            bb=(a[i]-b[i])*comp(0,-0.5),\n            cc=(c[i]+d[i])*comp(0.5,0),\n            dd=(c[i]-d[i])*comp(0,-0.5);\n            a[i]=aa*cc+comp(0,1)*(aa*dd+bb*cc),b[i]=bb*dd;\n        }\n        fft(a,n,-1),fft(b,n,-1);\n        for(int i=0;i<n;i++)\n        {\n            int \n            aa=(ll)(a[i].r/n+0.5)%p,\n            bb=(ll)(a[i].i/n+0.5)%p,\n            cc=(ll)(b[i].r/n+0.5)%p;\n            h[i]=((1ll*aa*(1<<30)+1ll*bb*(1<<15)+cc)%p+p)%p;\n        }\n    }\n}\nusing namespace poly;\nint f[400005],g[400005],h[400005];\nint main()\n{\n    int n,m,p;\n    scanf(\"%d%d%d\",&n,&m,&p);\n    for(int i=0;i<=n;i++)scanf(\"%d\",&f[i]);\n    for(int i=0;i<=m;i++)scanf(\"%d\",&g[i]);\n    int lim=1;\n    while(lim<=(n+m))lim<<=1;\n    mtt(f,g,h,lim,p);\n    for(int i=0;i<=n+m;i++)printf(\"%d \",h[i]);\n    return 0;\n}",
        "postTime": 1596091168,
        "uid": 96912,
        "name": "AzusaCat",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u5b89\u5229\u4e0b[blog](http://www.yhzq-blog.cc/\u4efb\u610f\u6a21\u6570ntt\u603b\u7ed3/)\n\n\u8fd9\u91cc\u7528\u7684\u662f\u4e09\u6a21\u6570NTT\n\n\u9898\u610f\uff1a\u4e24\u4e2a\u591a\u9879\u5f0f\u505a\u4e58\u6cd5\uff0c$n \\leq 10^5, a_i \\leq 10^9$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u7684\u6700\u5927\u503c\u662f$10^{9^2} \\times 10^5 = 10^{23}$\uff0c\u597d\u50cf\u662f\u7206longlong\u7684\u3002\u800c\u4e14\u4e0d\u662f\u8d28\u6570\u6ca1\u6cd5ntt\u554a\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u60f3\u5230\u9009\u4e09\u4e2a\u6ee1\u8db3NTT\u6027\u8d28\u4e14\u4e58\u8d77\u6765$ > 10^{23} $\u7684\u6a21\u6570\u5206\u522bNTT\uff0c\u6700\u540e\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5408\u5e76\u3002\n\n\u8fd9\u53ea\u89e3\u51b3\u4e86\u540e\u9762\u7684\u90a3\u4e2a\u95ee\u9898\uff0c\u600e\u4e48\u89e3\u51b3\u70b8longlong\u7684\u95ee\u9898\u5462\u3002\u8fd9\u9700\u8981\u4e00\u4e9b\u7279\u6b8a\u6280\u5de7\n\n\u6211\u4eec\u5f97\u5230\u7684\u540c\u4f59\u5f0f\u662f\u8fd9\u6837\u7684\n\n![](http://www.yhzq-blog.cc/wp-content/uploads/2018/04/m1.png)\n\n\u5148\u7528\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5408\u5e76\u524d\u4e24\u4e2a\u540c\u4f59\u5f0f\uff0c\u5f97\u5230\n\n![](http://www.yhzq-blog.cc/wp-content/uploads/2018/04/m2.png)\n\n\u628aans\u62c6\u5f00\n\n$$Ans=kM+A=k'm_3+a_3$$\n\n\u5047\u5982\u5728$\\pmod {m_3}$\u7684\u610f\u4e49\u4e0b\u7684\u8bdd\uff0c\u90a3\u4e48\u6709\uff08\u6d88\u6389$k'm_3$\uff09\n\n$$kM \\equiv a_3 - A \\pmod {m_3}$$\n\n\u4e5f\u5c31\u662f\u8bf4\n\n$$k \\equiv (a_3 \u2212 A) M^{\u22121} \\pmod {m_3}$$\n\n\u6c42\u51fak\u4e4b\u540e\u4ee3\u5165$Ans = kM + A$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u6a21\u4efb\u610f\u6570\u4e86\u3002\n\n\u6ce8\u610f\u5728\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5408\u5e76\u7684\u65f6\u5019\u9700\u8981\u5feb\u901f\u4e58\u3002\n\n2009\u56fd\u5bb6\u96c6\u8bad\u961f\u8bba\u6587\uff1a\u9a86\u53ef\u5f3a\uff1a\u300a\u8bba\u7a0b\u5e8f\u5e95\u5c42\u4f18\u5316\u7684\u4e00\u4e9b\u65b9\u6cd5\u4e0e\u6280\u5de7\u300b\n\n![](http://www.yhzq-blog.cc/wp-content/uploads/2018/04/fastmul.png)\n\n```cpp\n// luogu-judger-enable-o2\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\nusing namespace std;\nconst int N = 300010, m1 = 469762049, m2 = 998244353, m3 = 1004535809, g = 3;\nconst long long M = 1ll * m1 * m2;\nint n, m, r[N], a[N], b[N], c[N], d[N], ans[3][N], mod;\nint fast_pow(int a, int p, int mod) {\n    int ans = 1;\n    for (; p; p >>= 1, a = 1ll * a * a % mod)\n        if (p & 1) ans = 1ll * ans * a % mod;\n    return ans;\n}\nlong long fast_mul(long long a, long long b, long long mod) {\n    a %= mod, b %= mod;\n    return ((a * b - (long long)((long long)((long double)a / mod * b + 1e-3) * mod)) % mod + mod) % mod;\n}\nvoid ntt(int n, int *a, int opt, int mod) {\n    for (int i = 0; i < n; ++i)\n        if (i < r[i]) swap(a[i], a[r[i]]);\n    for (int k = 1; k < n; k <<= 1)\n        for (int i = 0, wn = fast_pow(g, (mod - 1) / (k << 1), mod); i < n; i += (k << 1))\n            for (int j = 0, w = 1; j < k; ++j, w = 1ll * w * wn % mod) {\n                int x = a[i + j], y = 1ll * w * a[i + j + k] % mod;\n                a[i + j]= (x + y) % mod, a[i + j + k] = (x - y + mod) % mod;\n\t\t\t}\n    if (opt == -1) {\n        a[0] = 1ll * a[0] * fast_pow(n, mod - 2, mod) % mod;\n        for (int i = 1, inv = fast_pow(n, mod - 2, mod); i <= n / 2; ++i) {\n            a[i] = 1ll * a[i] * inv % mod;\n            if (i != n - i) a[n - i] = 1ll * a[n - i] * inv % mod;\n            swap(a[i], a[n - i]);\n        }\n    }\n}\nmain() {\n    static int fn = 1, l = 0;\n    scanf(\"%d%d%d\", &n, &m, &mod);\n    for (int i = 0; i <= n; ++i) scanf(\"%d\", &a[i]);\n    for (int i = 0; i <= m; ++i) scanf(\"%d\", &b[i]);\n    while (fn <= n + m) fn <<= 1, ++l;\n    for (int i = 0; i < fn; ++i)\n        r[i] = (r[i >> 1] >> 1) | ((i & 1) << (l - 1));\n    copy(a, a + n + 1, c), copy(b, b + m + 1, d), ntt(fn, c, 1, m1), ntt(fn, d, 1, m1);\n    for (int i = 0; i <= fn; ++i) ans[0][i] = 1ll * c[i] * d[i] % m1;\n    memset(c, 0, sizeof c), memset(d, 0, sizeof d);\n    copy(a, a + n + 1, c), copy(b, b + m + 1, d), ntt(fn, c, 1, m2), ntt(fn, d, 1, m2);\n    for (int i = 0; i <= fn; ++i) ans[1][i] = 1ll * c[i] * d[i] % m2;\n    memset(c, 0, sizeof c), memset(d, 0, sizeof d);\n    copy(a, a + n + 1, c), copy(b, b + m + 1, d), ntt(fn, c, 1, m3), ntt(fn, d, 1, m3);\n    for (int i = 0; i <= fn; ++i) ans[2][i] = 1ll * c[i] * d[i] % m3;\n    ntt(fn, ans[0], -1, m1), ntt(fn, ans[1], -1, m2), ntt(fn, ans[2], -1, m3);\n    for (int i = 0; i <= n + m; ++i) {\n        long long A = (fast_mul(1ll * ans[0][i] * m2 % M, fast_pow(m2 % m1, m1 - 2, m1), M) +\n                       fast_mul(1ll * ans[1][i] * m1 % M, fast_pow(m1 % m2, m2 - 2, m2), M)) % M;\n        long long k = ((ans[2][i] - A) % m3 + m3) % m3 * fast_pow(M % m3, m3 - 2, m3) % m3;\n        printf(\"%d \", ((k % mod) * (M % mod) % mod + A % mod) % mod);\n    }\n}\n```",
        "postTime": 1523452363,
        "uid": 17689,
        "name": "\u8fdc\u822a\u4e4b\u66f2",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011MTT\u3011"
    },
    {
        "content": "4\u6b21FFT\u7684MTT\u505a\u6cd5\u3002\u6743\u5f53\u7ed9\u81ea\u5df1\u770b\u7684\u4e86\u3002\n\n\u6b64\u9898\u7cfb\u6570\u8303\u56f4\u5f88\u5927\uff0c\u5982\u679c\u7528\u6734\u7d20\u7684FFT\u4f1a\u6389\u7cbe\u5ea6\uff0c\u4ece\u800c\u6211\u4eec\u9700\u8981\u5c06\u4e00\u4e2a\u6574\u6570 $a$ \u5206\u89e3\u6210 $a0\\times B+a1$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $B$ \u53ef\u53d6\u5e38\u6570\uff0c\u4ee3\u7801\u4e2d\u662f $2^{15}$\u3002\u8fd9\u6837\u53d6\u5230\u4e86\u7cbe\u5ea6\uff0c\u4f46\u662f\u4f1a\u589e\u52a0\u590d\u6742\u5ea6\u3002\n\n\u7136\u540e\u5c31\u8868\u793a\u51fa ${a0\\times B+a1}$ \u548c ${b0\\times B+b1}$ \u7684\u4e58\u6cd5\u4e3a\uff1a\n\n$$B^2a0b0+B(a0b1+a1b0)+a1b1$$\n\n\u4e8e\u662f\u6211\u4eec\u8981\u6c42\u56db\u4e2a\u591a\u9879\u5f0f\u7684\u79ef\uff1a$a0b0,a1b1,a1b0,a0b1$\u3002\n\n\u8003\u8651\u5148\u6c42\u51fa $a0,b0,a1,b1$ \u7684\u70b9\u503c\u3002\n\n\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u5b9e\u6570\uff0c\u4e0d\u59a8\u4ee5\u865a\u6570\u7684\u5f62\u5f0f\u5c06\u5176\u4e24\u4e24\u7ed3\u5408\u3002\n\n\u6709\uff1a\n\n$$A_x=a0_x+ia1_x$$\n\n$$B_x=b0_x+ib1_x$$\n\n\u8003\u8651\u501f\u52a9\u7b2c\u4e00\u4e2a $A$ \u5982\u4f55\u6c42\u51fa $a0,a1$ \u7684\u70b9\u503c\u3002\n\n\u5148\u6c42 $A$ \u7684\u70b9\u503c\u4e3a $A1$\u3002\u7136\u540e\u5c06 $A$ \u7684\u7cfb\u6570\u5171\u8f6d\u540e\u518d\u6784\u9020 $A2$\u3002\n\n\u4e0b\u9762\u8bd5\u56fe\u8bc1\u660e $A1$ \u7684\u7b2c $k$ \u9879\u4e0e $A2$ \u7684\u7b2c $n-k$ \u9879\u662f\u5171\u8f6d\u7684\u3002\n\n$$\\begin{aligned}\nA1_k&=\\sum_{i=0}^{n-1}(a0_i+ia1_i)(w_n^k)^i \\\\\n&=\\sum_{i=0}^{n-1}a0_i(w_n^k)^i+ia1_i(w_n^k)^i \\\\\n&=\\sum_{i=0}^{n-1}a0_i\\cos\\theta+ia0_i\\sin\\theta+ia1_i\\cos\\theta+i^2a1_i\\sin\\theta \\\\\n&=\\sum_{i=0}^{n-1}(a0_i\\cos\\theta-a1_i\\sin\\theta)+i(a0_i\\sin\\theta+a1_i\\cos\\theta)\n\\end{aligned}$$\n\n$$\\begin{aligned}\nA2_{n-k}&=\\sum_{i=0}^{n-1}(a0_i-ia1_i)(w_n^{-k})^i \\\\\n&=\\sum_{i=0}^{n-1}a0_i(w_n^{-k})^i-ia1_i(w_n^{-k})^i \\\\\n&=\\sum_{i=0}^{n-1}a0_i\\cos\\theta-ia0_i\\sin\\theta-ia1_i\\cos\\theta+i^2a1_i\\sin\\theta \\\\\n&=\\sum_{i=0}^{n-1}(a0_i\\cos\\theta-a1_i\\sin\\theta)-i(a0_i\\sin\\theta+a1_i\\cos\\theta)\n\\end{aligned}$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b21 $A$ \u7684DFT\u6c42\u51fa $A1$ \u548c $A2$\u3002\n\n\u518d\u53ef\u4ee5\u7528\u666e\u901a\u7ebf\u6027\u65b9\u7a0b\u6c42\u51fa $a0,a1$ \u7684\u70b9\u503c\u4e86\u3002\n\n\u6c42 $b0,b1$ \u7c7b\u4f3c\u3002\n\n\u8fd9\u91cc\u4e00\u5171\u4e24\u6b21FFT\u3002\n\n\u7136\u540e\u5f97\u5230 $a0,a1,b0,b1$ \u7684\u70b9\u503c\uff0c\u73b0\u5728\u6c42\u4e24\u4e24\u4e58\u79ef\u7684\u7cfb\u6570\uff0c\u540c\u6837\u8003\u8651\u5408\u5e76\uff1a\n\n$$P(x)=a0_xb0_x+ia1_xb0_x$$\n\n$$Q(x)=a0_xb1_x+ia1_xb1_x$$\n\n\u5f97\u5230 $P$ \u548c $Q$ \u7684\u70b9\u503c\u540e\u4e24\u6b21FFT\u6c42\u51fa\u7cfb\u6570\uff0c\u53d6\u51fa\u5404\u90e8\u4ee3\u5165\u7bc7\u5934\u7684\u5f0f\u5b50\u91cc\u5373\u53ef\u3002\n\n\u4ee3\u7801\u5982\u4e0b\u3002\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\n\ntypedef long long ll;\ntypedef long double ldb;\nconst ldb pi = acos(-1);\nconst int MAXN = 400001;\nconst ll B = 1 << 15;\n\ninline int read() {\n    int x = 0,f = 1; char ch = getchar();\n    while(ch > '9' || ch < '0') { if(ch == '-') f = -1; ch = getchar(); }\n    do x = x * 10 + ch - 48, ch = getchar(); while(ch >= '0' && ch <= '9');\n    return x * f;\n}\n\nstruct Complex\n{\n    ldb x,y;\n    Complex() { x = y = 0; }\n    Complex(const ldb _x,const ldb _y) : x(_x), y(_y) {}\n    Complex operator +(const Complex a) { return Complex(x + a.x,y + a.y); }\n    Complex operator -(const Complex a) { return Complex(x - a.x,y - a.y); }\n    Complex operator *(const Complex a) { return Complex(x * a.x - y * a.y,x * a.y + y * a.x); }\n    Complex operator *(const ldb t) { return Complex(x * t,y * t); }\n    Complex operator /(const ldb t) { return Complex(x / t,y / t); }\n};\n\nComplex I(0,1);\n\nint n,m,p,r[MAXN]; Complex wn[MAXN];\nComplex a0[MAXN],a1[MAXN],b0[MAXN],b1[MAXN];\nComplex P[MAXN],Q[MAXN];\n\nvoid FFT(Complex *a,int N) {\n    for(int i = 0;i < N;i++) if(i < r[i]) std::swap(a[i],a[r[i]]);\n    Complex t1,t2;\n    for(int n = 2, m = 1;n <= N;m = n, n <<= 1)\n        for(int l = 0;l < N;l += n)\n            for(int i = l;i < l + m;i++) {\n                Complex w = wn[N / m * (i - l)];\n                t1 = a[i], t2 = w * a[i + m];\n                a[i] = t1 + t2;\n                a[i + m] = t1 - t2;\n            }\n    return;\n}\n\nvoid IFFT(Complex *a,int N) {\n    FFT(a,N);\n    std::reverse(a + 1,a + N);\n    for(int i = 0;i < N;i++) a[i] = a[i] / N;\n    return;\n}\n\nvoid ConnectFFT(Complex *a,Complex *b,int N) {\n    for(int i = 0;i < N;i++) a[i].y = b[i].x;\n    FFT(a,N);\n    b[0] = Complex(a[0].x,-a[0].y);\n    for(int i = 1;i < N;i++) b[i] = Complex(a[N - i].x,-a[N - i].y);\n    Complex t1,t2;\n    for(int i = 0;i < N;i++) {\n        t1 = a[i], t2 = b[i];\n        a[i] = (t1 + t2) / 2.0;\n        b[i] = (t2 - t1) * I / 2.0;\n    }\n    return;\n}\n\nll rd(const ldb x) {\n    if(x >= 0) return ll(x + 0.5) % p;\n    else return ll(x - 0.5) % p;\n}\n\nint main() {\n    n = read(), m = read(), p = read();\n    for(int i = 0,v;i <= n;i++) v = read() % p, a0[i].x = v / B, a1[i].x = v % B;\n    for(int i = 0,v;i <= m;i++) v = read() % p, b0[i].x = v / B, b1[i].x = v % B;\n    int N = 1, l = -1; while(N <= n + m) N <<= 1, l++;\n    for(int i = 1;i < N;i++) r[i] = (r[i >> 1] >> 1) | ((i & 1) << l);\n    for(int i = 0;i < N;i++) wn[i] = Complex(cos(pi / N * i),sin(pi / N * i));\n    ConnectFFT(a0,a1,N); ConnectFFT(b0,b1,N);\n    for(int i = 0;i < N;i++) {\n        P[i] = a0[i] * b0[i] + I * a1[i] * b0[i];\n        Q[i] = a0[i] * b1[i] + I * a1[i] * b1[i];\n    }\n    IFFT(P,N); IFFT(Q,N);\n    for(int i = 0;i <= n + m;i++) {\n        ll ans = B * B % p * rd(P[i].x) % p +\n                 B * rd(Q[i].x + P[i].y) % p +\n                 rd(Q[i].y) % p;\n        std::printf(\"%lld \",ans % p);\n    }\n    return 0;\n}\n\n```",
        "postTime": 1593875594,
        "uid": 219595,
        "name": "Vocalise",
        "ccfLevel": 9,
        "title": "MTT\u5b66\u4e60\u7b14\u8bb0--\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\n\n\u5bf9\u7ed9\u5b9a\u7684\u4e24\u4e2a\u591a\u9879\u5f0f $F(x)\\ ,G(x)$ \u6c42\u51fa $F(x)*G(x)$ \u5bf9 $p$ \u53d6\u6a21\u7684\u7ed3\u679c\u3002\n\n$p$ \u4e3a\u4efb\u610f\u5c0f\u4e8e\u7b49\u4e8e $10^9+9$ \u7684\u6574\u6570\u3002\n\n\u591a\u9879\u5f0f\u4f4d\u6570 $n \\leq 10^5$ \uff0c \u591a\u9879\u5f0f\u7cfb\u6570 $0 \\leq a_i,b_i \\leq 10^9$ \n\n---\n\u56e0\u4e3a\u4f7f\u7528 $\\text{NTT}$ \u9700\u8981\u4fdd\u8bc1\u6a21\u6570\u53ef\u4ee5\u5206\u89e3\u6210 $a\\times2^k+b$ \u7684\u5f62\u5f0f\uff0c\u8fd9\u91cc\u6ca1\u529e\u6cd5\u76f4\u63a5\u89e3\u51b3\u3002\n\n\u9996\u5148\u8003\u8651\u76f4\u63a5\u8ba1\u7b97\uff1a\u968f\u4fbf\u7528\u4e00\u4e2a\u8d28\u6570\uff08 \u8bbe\u8fd9\u4e2a\u8d28\u6570\u662f $P'$ \uff09\u7b97\uff0c\u90a3\u4e48\u7b97\u51fa\u6765\u7684\u7ed3\u679c\uff08 \u8bbe\u5b83\u4e3a $ans'$ \uff09\u80af\u5b9a\u4e0d\u662f\u6b63\u786e\u7b54\u6848\uff0c\u5b83\u53ea\u6ee1\u8db3\u8fd9\u6837\u4e00\u4e2a\u5f0f\u5b50\uff1a\n\n$$ans'\\ \\equiv ans\\ \\pmod {P'}$$\n\n\u4e8e\u662f\u8003\u8651\u4ece\u5de6\u8fb9\u63a8\u51fa\u53f3\u8fb9\uff1a\u591a\u5efa\u7acb\u51e0\u4e2a\u65b9\u7a0b\uff0c\u7136\u540e\u5229\u7528\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u8ba1\u7b97\u51fa\u7b54\u6848\u3002\n\n\u53d6\u4e09\u4e2a\u8d28\u6570 $P_1,P_2,P_3$ \uff0c\u8bbe\u7b97\u51fa\u6765\u7ed3\u679c\u5206\u522b\u662f $A_1,A_2,A_3$ \uff0c \u90a3\u4e48\u6709\uff1a\n\n$$\\begin{cases}\n{A_1\\ \\equiv ans\\ \\pmod {P_1}}\\\\\n{A_2\\ \\equiv ans\\ \\pmod {P_2}}\\\\\n{A_3\\ \\equiv ans\\ \\pmod {P_3}}\\\\\n\\end{cases}$$\n\n\u4e8e\u662f\u53ef\u4ee5\u5229\u7528\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u8ba1\u7b97\u51fa $ans \\mod (P_1P_2P_3)$ \u7684\u7ed3\u679c\uff0c\u7531\u4e8e $ans \\leq \\max\\{A_i\\} \\times \\max\\{B_i\\} \\times n$ \uff0c\u53ea\u8981\u6a21\u6570\u4e4b\u79ef\u5927\u4e8e $10^{23}$\uff0c\u8fd9\u65f6\u8ba1\u7b97\u7684\u7b54\u6848\u5c31\u662f\u771f\u6b63\u7684\u7b54\u6848\u3002\n\n\u63a8\u8350\u6a21\u6570 $998244353,1004535809,469762049$\n\n---\n\n\u5173\u4e8e\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff1a\u53ef\u4ee5\u77e5\u9053\u7b54\u6848\u4e3a\n\n$ans = A_1P_2P_3P'_{2,1}P'_{3,1}+A_2P_1P_3P'_{1,2}P'_{3,2}+A_3P_1P_2P'_{1,3}P'_{2,3}$\n\n\u5176\u4e2d $P'_{i,j}$ \u8868\u793a\u7b2c $i$ \u4e2a\u8d28\u6570\u5728\u6a21 $P_j$ \u610f\u4e49\u4e0b\u7684\u9006\u5143\u3002\n\n---\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define Mid ((L+R)>>1)\nusing namespace std;\ntypedef pair<int,int> pii;\ninline int read(){\n\tchar c;int x=0;int b=1;do{c=getchar();if(c==45)b=-1;}while(c>57||c<48);\n\tdo x=x*10+c-48,c=getchar();while(c<=57&&c>=48);x*=b;return x;\n}\nconst ll mod1=998244353,mod2=1004535809,mod3=469762049,P=3;\nconst int maxn=100010;\nll i,j,k,n,m,p,a[maxn*4],b[maxn*4];\n\nll A[maxn*4],B[maxn*4],Ans[maxn*4][4],tmp[maxn*4];\nint R[maxn*4];\nll ksm(ll sum,ll num,ll mod){\n\tll ans=1;\n\twhile(num){\n\t\tif(num&1)ans=ans*sum%mod;\n\t\tsum=sum*sum%mod;\n\t\tnum>>=1;\n\t}return ans;\n}\nvoid NTT(int len,ll *a,bool op,ll mod){\n\tfor(int i=0;i<len;i++)tmp[R[i]]=a[i];\n\tfor(int i=0;i<len;i++)a[i]=tmp[i];\n\tll Wn,w,P2=ksm(P,mod-2,mod);\n\tfor(int i=1;i<len;i*=2){\n\t\tWn=ksm((op? P:P2),(mod-1)/(i*2),mod);\n\t\tfor(int j=0;j<len;j+=i*2){\n\t\t\tw=1;\n\t\t\tfor(int k=0;k<i;k++,w=w*Wn%mod){\n\t\t\t\tint K=k+j;\n\t\t\t\tll S1=a[K],S2=a[K+i]*w%mod;\n\t\t\t\ta[K]=(S1+S2)%mod;\n\t\t\t\ta[K+i]=(S1-S2+mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n}\nvoid work1(){\n\tmemset(A,0,sizeof(A));memset(B,0,sizeof(B));\n\tfor(i=0;i<n;i++)A[i]=a[i]%mod1;for(i=0;i<m;i++)B[i]=b[i]%mod1;\n\tint len=1,L=0;\n\twhile(len<=n+m)len*=2,++L;\n\tfor(i=0;i<len;i++)R[i]=(R[i/2]/2)+((i&1)*(1<<L-1));\n\tNTT(len,A,true,mod1);NTT(len,B,true,mod1);\n\tfor(i=0;i<len;i++)A[i]=A[i]*B[i]%mod1;\n\tNTT(len,A,false,mod1);\n\tfor(i=0;i<len;i++)Ans[i][0]=A[i]*ksm(len,mod1-2,mod1)%mod1;\n}\nvoid work2(){\n\tmemset(A,0,sizeof(A));memset(B,0,sizeof(B));\n\tfor(i=0;i<n;i++)A[i]=a[i]%mod2;for(i=0;i<m;i++)B[i]=b[i]%mod2;\n\tint len=1,L=0;\n\twhile(len<=n+m)len*=2,++L;\n\tfor(i=0;i<len;i++)R[i]=(R[i/2]/2)+((i&1)*(1<<L-1));\n\tNTT(len,A,true,mod2);NTT(len,B,true,mod2);\n\tfor(i=0;i<len;i++)A[i]=A[i]*B[i]%mod2;\n\tNTT(len,A,false,mod2);\n\tfor(i=0;i<len;i++)Ans[i][1]=A[i]*ksm(len,mod2-2,mod2)%mod2;\n}\nvoid work3(){\n\tmemset(A,0,sizeof(A));memset(B,0,sizeof(B));\n\tfor(i=0;i<n;i++)A[i]=a[i]%mod3;for(i=0;i<m;i++)B[i]=b[i]%mod3;\n\tint len=1,L=0;\n\twhile(len<=n+m)len*=2,++L;\n\tfor(i=0;i<len;i++)R[i]=(R[i/2]/2)+((i&1)*(1<<L-1));\n\tNTT(len,A,true,mod3);NTT(len,B,true,mod3);\n\tfor(i=0;i<len;i++)A[i]=A[i]*B[i]%mod3;\n\tNTT(len,A,false,mod3);\n\tfor(i=0;i<len;i++)Ans[i][2]=A[i]*ksm(len,mod3-2,mod3)%mod3;\n}\nvoid out(__int128 x){\n\tif(x/10)out(x/10);\n\tputchar(x%10+'0');\n}\nvoid get(int i){\n\t__int128 ans=0,A=mod1,B=mod2,C=mod3,a=Ans[i][0],b=Ans[i][1],c=Ans[i][2],MOD=A*B*C;\n\t//out(a);cout<<' ';out(b);cout<<' ';out(c);cout<<endl;\n\tans+=a*C%MOD*B%MOD*ksm(B,A-2,A)%MOD*ksm(C,A-2,A)%MOD;\n\tans+=b*A%MOD*C%MOD*ksm(C,B-2,B)%MOD*ksm(A,B-2,B)%MOD;\n\tans+=c*B%MOD*A%MOD*ksm(A,C-2,C)%MOD*ksm(B,C-2,C)%MOD;\n\tans%=MOD;printf(\"%lld \",(ll)(ans%p));\n}\nint main() {\n\tfreopen(\"P4245.in\",\"r\",stdin);\n\tfreopen(\"P4245.out\",\"w\",stdout);\n\tcin>>n>>m>>p;++n;++m;\n\tfor(i=0;i<n;i++)a[i]=read();\n\tfor(i=0;i<m;i++)b[i]=read();\n\twork1();work2();work3();\n\tfor(i=0;i<n+m-1;i++)get(i);\n\tcout<<endl;\n\t//cerr << 1.0*clock()/CLOCKS_PER_SEC << endl;\n\treturn 0;\n}\n```",
        "postTime": 1591522001,
        "uid": 35891,
        "name": "huangzirui",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u5199\u8fd9\u79cd\u53c8\u957f\uff0c\u53c8\u9700\u8981\u6269\u5c55\u6027\u7684\u4e1c\u897f\uff0c\u5f53\u7136\u8981\u7528`\u9762\u5411\u5bf9\u8c61`\u6765\u4f18\u5316\u7a0b\u5e8f\u554a\u3002\n\n\u8bc1\u660e\u548c\u8bb2\u89e3\u4e0a\u9762\u5df2\u7ecf\u6709\u4e86\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e2a\u5c01\u88c5\u6027\u597d\u3001\u901f\u5ea6\u5feb\uff08900ms \u5de6\u53f3\uff09\u7684\u6a21\u677f\u3002\n\n\u5176\u4e2d\u8fd0\u7528\u5230\u7684\u77e5\u8bc6\u70b9\uff1a\n\n- \u7ee7\u627f\n  - \u7ee7\u627f\u6a21\u5f0f\n- \u91cd\u8f7d\n- \u591a\u6001\n  - \u7eaf\u865a\u51fd\u6570\n- \u57fa\u7840\u591a\u9879\u5f0f\n- \u8be1\u5f02\u7684\u795e\u4ed9\u4f18\u5316\n\n```cpp\n/* Header {{{ */\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long readtype;\ntypedef long long var;\ntypedef long double let;\n\nreadtype read() {\n  readtype a = 0, c = getchar(), s = 0;\n  while (!isdigit(c)) s |= c == '-', c = getchar();\n  while (isdigit(c)) a = a * 10 + c - 48, c = getchar();\n  return s ? -a : a;\n}\n\n#ifdef LOCAL_LOGGER\n#define logger(...) fprintf(stderr, __VA_ARGS__)\n#else\n#define logger(...);\n#endif\n/* }}} */\n\nstruct Node {\n  double x, y;\n  void operator = (int t) { x = t >> 15, y = t & 32767; }\n  Node operator + (Node t) { return (Node) {x + t.x, y + t.y}; }\n  Node operator - (Node t) { return (Node) {x - t.x, y - t.y}; }\n  Node operator * (Node t) { \n    return (Node) {x * t.x - y * t.y, x * t.y + y * t.x }; \n  }\n  Node operator * (double t) { return (Node) {x * t, y * t}; }\n  Node operator ~ () { return (Node) {x, -y}; }\n};\n\nclass Poly {\n  protected:\n    static const int N = 1e6 + 1;\n\n    int MOD;\n    int limit, rev[N];\n    void InitLimit(const int need_len) {\n      if (limit >= need_len) return ;\n      for (limit = 1; limit <= need_len; limit <<= 1);\n      for (int i = 0; i < limit; ++i) \n        rev[i] = (rev[i >> 1] >> 1) | ((i & 1) ? (limit >> 1) : 0);\n      InitLimitExtra(need_len);\n    }\n\n    virtual void InitLimitExtra(const int need_len) = 0;\n    virtual void Transform() = 0;\n\n  public:\n    void SetMod(int p) { MOD = p; }\n    virtual void Mul(const int len_a, const int *a, const int len_b, const int *b,\n        int &len_c, int *c) = 0;\n};\n\nclass FFT: public Poly {\n  private:\n    Node w[N];\n\n  protected:\n    void InitLimitExtra(const int need_len) {\n      const double Pi = acos(-1.0);\n      for (int mid = 1; mid < limit; mid <<= 1) {\n        w[mid] = (Node) {1, 0};\n        for (int i = 1; i < mid; ++i) {\n          if ((i & 31) == 1) \n            w[i + mid] = (Node) {cos(Pi * i / mid), sin(Pi * i / mid)};\n          else\n            w[i + mid] = w[i + mid - 1] * w[mid + 1];\n        }\n      }\n    }\n\n    void Transform() {};\n    void Transform(Node *val, const int type) {\n      if (type == -1) reverse(val + 1, val + limit);\n      for (int i = 0; i < limit; ++i) \n        if (i < rev[i]) swap(val[i], val[rev[i]]);\n      for (int mid = 1; mid < limit; mid <<= 1) {\n        int R = mid << 1;\n        for (int i = 0; i < limit; i += R) {\n          for (int j = 0; j < mid; ++j) {\n            Node v = w[mid + j] * val[i + mid + j];\n            val[i + mid + j] = val[i + j] - v;\n            val[i + j] = val[i + j] + v;\n          }\n        }\n      }\n    }\n\n};\n\nclass MTT: public FFT {\n  private:\n    Node tmp_a[N], tmp_b[N], tmp_c[N], tmp_d[N];\n\n  public:\n    void Mul(const int len_a, const int *a, const int len_b, const int *b,\n        int &len_c, int *c) {\n      assert(MOD);\n\n      len_c = len_a + len_b;\n      InitLimit(len_c);\n\n      for (int i = 0; i <= len_a; ++i) tmp_a[i] = a[i];\n      for (int i = 0; i <= len_b; ++i) tmp_b[i] = b[i];\n      Transform(tmp_a, 1), Transform(tmp_b, 1);\n\n      for (int i = 0; i < limit; ++i) {\n        Node ft = ~tmp_a[i ? (limit - i) : 0], \n             f0 = (tmp_a[i] - ft) * (Node) {0, -0.5}, \n             f1 = (tmp_a[i] + ft) * 0.5;\n        Node gt = ~tmp_b[i ? (limit - i) : 0], \n             g0 = (tmp_b[i] - gt) * (Node) {0, -0.5},\n             g1 = (tmp_b[i] + gt) * 0.5;\n        tmp_c[i] = f1 * g1, tmp_d[i] = f0 * g1 + f1 * g0 + f0 * g0 * (Node) {0, 1};\n      }\n      for (int i = 0; i < limit; ++i) tmp_a[i] = 0, tmp_b[i] = 0;\n\n      Transform(tmp_c, -1), Transform(tmp_d, -1);\n      for (int i = 0; i <= len_c; ++i) {\n        var v1 = (var) (tmp_c[i].x / limit + 0.5) % MOD, \n            v2 = (var) (tmp_d[i].x / limit + 0.5) % MOD,\n            v3 = (var) (tmp_d[i].y / limit + 0.5) % MOD;\n        c[i] = ((v1 << 30) + (v2 << 15) + v3) % MOD;\n        tmp_c[i] = 0, tmp_d[i] = 0;\n      }\n    }\n\n};\n\nconst int N = 1e6 + 1;\n\nint n, m, p;\nint f[N], g[N];\nMTT poly;\nint len, res[N];\n\nint main() {\n#ifndef ONLINE_JUDGE\n  freopen(\"P4245.in\", \"r\", stdin);\n  freopen(\"P4245.out\", \"w\", stdout);\n#endif\n#ifdef LOCAL_LOGGER\n  freopen(\"P4245.log\", \"w\", stderr);\n#endif\n  n = read(), m = read(), p = read();\n  poly.SetMod(p);\n  for (int i = 0; i <= n; ++i) f[i] = read();\n  for (int i = 0; i <= m; ++i) g[i] = read();\n  poly.Mul(n, f, m, g, len, res);\n  for (int i = 0; i <= len; ++i)\n    printf(\"%d \", res[i]);\n  puts(\"\");\n  return 0;\n}\n\n/* ==== Makefile ==== {{{\nCompileAndRun:\nmake Compile\nmake Run\n\nCompile:\ng++ -o P4245 P4245.cpp -g -Wall -DLOCAL_LOGGER\n\nCompileUF:\ng++ -o P4245 P4245.cpp -g -Wall -DLOCAL_LOGGER -fsanitize=undefined\n\nRun:\n./P4245 < P4245.in > P4245.out\n==================\n}}} */\n```",
        "postTime": 1595328237,
        "uid": 20522,
        "name": "ccviolett",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u6a21\u6570\u4e0d\u662f\u50cf $998244353$ \u8fd9\u6837\u53ef\u4ee5\u7528NTT\u641e\u7684\u73a9\u610f\u513f\u5566\uff0c\u8fd9\u4e0d\u6ee1\u8db3NTT\u7684\u6027\u8d28\uff0c\u4e0d\u80fd\u76f4\u63a5\u7528\u539f\u6839\u641e\uff0c\u8981MTT\u62163\u6a21NTT\uff0c\u7b14\u8005\u8fd9\u91cc\u91c7\u7528\u7684\u662f\u5229\u7528\u590d\u6570\u5171\u8f6d\u6027\u8d28\uff08\u4e09\u6b21\u53d8\u4e24\u6b21\u4f18\u5316\uff1f\uff09\u76845\u6b21FFT\uff0c\u6bd44\u6b21\u6b63\u5b97MTT\u7684\u7a0d\u5fae\u6162\u4e00\u70b9\u4f46\u597d\u60f3\u3002\n\n\u4e0d\u59a8\u4ee4\uff1a\n$$a_1 = a / c$$\n$$a_0 = a - a_1$$\n\n\u540c\u7406\uff1a\n$$b_1 = b / c$$\n$$b_0 = b - b_1$$\n\n\u8fd9\u91cc\u53d6\n$$c = 32767 (2^{15} - 1)$$\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u62c6\u7cfb\u6570\u4fdd\u6301\u7cbe\u5ea6FFT\u8fa3~~~\n\n\u7136\u540e\uff0c\u6734\u7d20\u7b97\u6cd5\u662f\u9700\u8981\u8c03\u75287\u6b21FFT\u3002\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u590d\u6570\uff1a\n$$f = a_0 + a_1i$$\n$$h = a_0 - a_1i$$\n$$g = b_0 + b_1i$$\n\u6240\u4ee5\n$$f * g = a_0b_0 + (a_1b_0 + a_0b_1)i - a_1b_1$$\n$$h * g = a_0b_0 - (a_1b_0 - a_0b_1)i + a_1b_1$$\n\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e24\u5f0f\u52a0\u51cf\u6765\u5f97\u5230\n$$a_0b_0 \\ a_1b_1 \\ a_1b_0 \\ a_0b_1$$\n\u6211\u4eec\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u5148dft\u51fa  $f \\ h \\ g$ \u518d\u628a\u4e24\u4e2a\u7b54\u6848\u6570\u7ec4idft\u5373\u53ef\u3002\n\n\u53c2\u8003[command_block\u5927\u4f6c\u535a\u5ba2](https://www.luogu.com.cn/blog/command-block/solution-p4245)\n\n```cpp\nnamespace _MTT {\n\tconst long double PI = acos(-1.0);\n\tconst Complex I = Complex(1, 0);\n\tconst int mod = 1e9 + 7;\n\tint lim = 1, rev[Maxn];\n\tComplex f[Maxn], g[Maxn], h[Maxn];\n\t\n\tinline void FFT(int limit, Complex *arr, int type) {\n\t\tfor (int i = 0; i < limit; i++)\n\t\t\tif (i < rev[i]) swap(arr[i], arr[rev[i]]);\n\t\tfor (int mid = 1; mid < limit; mid <<= 1) {\n\t\t\tComplex tmp(cos(PI / mid), type * sin(PI / mid));\n\t\t\tfor (int i = 0; i < limit; i += mid << 1) { Complex w(1, 0);\n\t\t\t\tfor (register int j = 0; j < mid; j++, w = w * tmp) {\n\t\t\t\t\tComplex x = arr[i + j], y = w * arr[i + j + mid];\n\t\t\t\t\tarr[i + j] = x + y, arr[i + j + mid] = x - y;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tinline void MTT(int *a, int *b, int n, int m, int *ret) {\n\t\tint c = 32767; int v = 1ll * c * c % mod; ll a0b0, a1b1, a0b1, a1b0;\n\t\tfor (int i = 0; i < lim; i++) f[i] = g[i] = h[i] = Complex(0, 0);\n\t\tfor (int i = 0; i < n; i++) f[i] = Complex(a[i] % c, a[i] / c), h[i] = f[i].Vary();\n\t\tfor (int i = 0; i < m; i++) g[i] = Complex(b[i] % c, b[i] / c);\n\t\tFFT(lim, f, 1), FFT(lim, g, 1), FFT(lim, h, 1);\n\t\tfor (int i = 0; i < lim; i++)\n\t\t\tg[i] = g[i] / lim, f[i] = f[i] * g[i], h[i] = h[i] * g[i];\n\t\tFFT(lim, f, -1), FFT(lim, h, -1);\n\t\tfor (int i = 0; i < lim; i++) {\n    \t\ta0b0 = ll(round((f[i].x + h[i].x) / 2.0)) % mod;\n    \t\ta0b1 = ll(round((f[i].y + h[i].y) / 2.0)) % mod;\n    \t\ta1b0 = ll(round(f[i].y) - a0b1) % mod;\n    \t\ta1b1 = ll(round(h[i].x) - a0b0) % mod;\n    \t\tret[i] = ll(a0b0 + 1ll * c * (a0b1 + a1b0) % mod) % mod;\n    \t\tret[i] = ll(ret[i] + 1ll * v * a1b1 % mod) % mod;\n    \t\tret[i] = ll(ret[i] + mod) % mod;\n\t\t}\n\t}\n} using namespace _MTT;\n```\n",
        "postTime": 1584534610,
        "uid": 50925,
        "name": "EternalEpic",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u56e0\u4e3a\u6a21\u6570\u4e0d\u4e00\u5b9a\u6709\u539f\u6839\uff0c\u6240\u4ee5\u6734\u7d20\u7684NTT\u65e0\u6cd5\u901a\u8fc7\uff0c\u800c\u6734\u7d20FFT\u4f1a\u5bfc\u81f4\u7cbe\u5ea6\u70b8\u6389\u4e5f\u65e0\u6cd5\u901a\u8fc7\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e00\u79cd\u5947\u6280\u6deb\u5de7\uff1a\n\u6211\u4eec\u53d6\u4e00\u4e2a\u53c2\u6570t\uff0c\u5c06\u591a\u9879\u5f0f\u8868\u793a\u6210\u5b83\u9664\u4ee5t\u7684\u5546\u548c\u4f59\u6570\uff0c\u8fd9\u6837\u4f1a\u751f\u62102n\u4e2a\u591a\u9879\u5f0f\uff0c\u5206\u522b\u5bf9\u4ed6\u4eecFFT\u4ee5\u540e\uff0c\u518d\u5408\u5e76\u7b54\u6848\u5373\u53ef\u3002\n\u7531\u4e8e\u8fd9\u79cd\u7b97\u6cd5\u5bf9\u7cbe\u5ea6\u8981\u6c42\u8f83\u9ad8\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528long double\u3002\n\u4ee3\u7801\u975e\u5e38\u5bb9\u6613\u5b9e\u73b0\uff1a\n```\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nint n,m,i,j,k,len,A[500005],B[500005],p;ll C[500005];const long double pi=acos(-1);\nstruct cp\n{\n\tlong double x,y;\n\tcp(long double x=0.0,long double y=0.0):x(x),y(y){}\n\tfriend cp operator+(cp a,cp b){return cp(a.x+b.x,a.y+b.y);}\n\tfriend cp operator-(cp a,cp b){return cp(a.x-b.x,a.y-b.y);}\n\tfriend cp operator*(cp a,cp b){return cp(a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x);}\n}w,wn,t,a[524288],b[524288],c[524288],d[524288],e[524288],f[524288],g[524288],h[524288];\nvoid fft(cp *a,int n,int op)\n{\n    for(i=k=0;i<n;i++)\n    {\n        if(i>k) swap(a[i],a[k]);\n        for(j=(n>>1);(k^=j)<j;j>>=1);\n    }\n    for(k=2,wn=cp(cos(2*pi*op/k),sin(2*pi*op/k));k<=n;k<<=1,wn=cp(cos(2*pi*op/k),sin(2*pi*op/k)))\n        for(i=0,w=cp(1,0);i<n;i+=k,w=cp(1,0)) for(j=0;j<(k>>1);j++,w=w*wn)\n            t=a[i+j+(k>>1)]*w,a[i+j+(k>>1)]=a[i+j]-t,a[i+j]=a[i+j]+t;\n    if(op==-1) for(i=0;i<n;i++) a[i].x/=n;\n}\nvoid mtt(int n,ll M)\n{\n\tfor(int i=0;i<n;i++) a[i].x=A[i]/M,b[i].x=A[i]%M,c[i].x=B[i]/M,d[i].x=B[i]%M;//\u62c6\u5206\n\tfft(a,n,1);fft(b,n,1);fft(c,n,1);fft(d,n,1);\n\tfor(int i=0;i<n;i++) e[i]=a[i]*c[i],f[i]=a[i]*d[i],g[i]=b[i]*c[i],h[i]=b[i]*d[i];//\u5408\u5e76\uff0cab\uff0ccd\u4e0d\u7528\u5408\u5e76\uff0c\u56e0\u4e3a\u6ca1\u6709\u610f\u4e49\n\tfft(e,n,-1);fft(f,n,-1);fft(g,n,-1);fft(h,n,-1);\n\tfor(int i=0;i<n;i++) C[i]=((ll)(e[i].x+0.1)*M%p*M%p+(ll)(f[i].x+0.1)*M%p+(ll)(g[i].x+0.1)*M%p+(ll)(h[i].x+0.1))%p;//\u62c6\u5206\u7684\u65f6\u5019\u9664\u4e86\u51e0\u6b21\u53c2\u6570\uff0c\u8fd9\u91cc\u5c31\u8981\u4e58\u56de\u53bb\u51e0\u6b21\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&m,&p);\n\tfor(int i=0;i<=n;i++) scanf(\"%d\",&A[i]);\n\tfor(int i=0;i<=m;i++) scanf(\"%d\",&B[i]);\n\tfor(len=1;len<=n+m;len<<=1);mtt(len,32768);\n\tfor(int i=0;i<=n+m;i++) printf(\"%lld \",C[i]);\n}\n```",
        "postTime": 1532577418,
        "uid": 70545,
        "name": "Awar3ness",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "\u6211\u662f\u4e00\u53ea\u83dc\u9e21\uff0c\u5b66\u4e0d\u4f1a NTT\uff0c\u6240\u4ee5\u53ea\u80fd\u7528 **\u7cfb\u6570\u5206\u652f** \u505a\u8fd9\u9053\u9898\u4e86\u3002\u3002\u3002\n\n\u5982\u679c\u76f4\u63a5\u66b4\u529b\u7528 FFT\uff0c\u7528 `long double` \u8fd8\u662f0\u5206\u3002\u660e\u663e\u7cbe\u5ea6\u70b8\u4e86\uff0c\u6240\u4ee5\u8003\u8651\u5982\u4f55\u7f29\u5c0f\u7cfb\u6570\u3002\n\n\u9996\u5148\uff0c\u8bbe\u5b9a $C=\\lceil\\sqrt{P}\\rceil$\u3002\n\n\u53ef\u4ee5\u628a $A(x)$ \u5199\u6210 $A_0(x)+C\\times A_1(x)$\uff0c\u548c $A_0(x)$ \u548c $A_1(x)$ \u7684\u7cfb\u6570\u90fd\u5c0f\u4e8e $C$\u3002\n\n\u628a $B(x)$ \u4e00\u6837\u5199\u6210 $B_0(x)+C\\times B_1(x)$\u3002\n\n\u73b0\u5728\uff0c\n\n$$A(x)B(x)=A_0(x)B_0(x)+A_0(x)B_1(x)C+A_1(x)B_0(x)C+A_1(x)B_1(x)C^2$$\n\n\u8fd9\u4e9b\u7cfb\u6570\u7f29\u5c0f\u7684\u65f6\u5019\uff0c\u76f8\u4e58\u6700\u5927\u7ed3\u679c\u7cfb\u6570\u662f $N(C-1)^2$\uff0c\u5927\u6982\u5728 $10^{14}$ \u7ea7\u522b\uff0c\u4f7f\u7528 `long double` \u5c31\u53ef\u4ee5\u8fc7\u3002\u53ea\u7528 4 \u6b21\u591a\u9879\u5f0f\u76f8\u4e58\u3002\u5982\u679c\u8bb0\u4e00\u5316 $A_0$\uff0c$A_1$\uff0c$B_0$\uff0c$B_1$ \u7684 DFT \u548c $A_0(x)B_1(x)+A_1(x)B_0(x)$ \u6346\u7ed1 IDFT\uff0c\u53ef\u4ee5\u8fbe\u5230 7 \u6b21 FFT\u3002\n\n\u4e3b\u8981\u4ee3\u7801\uff1a\n\n```cpp\ncd a1[262144], b1[262144];\ncd a2[262144], b2[262144];\ncd r1[262144], r2[262144], r3[262144];\nint Av[100005], Bv[100005];\nll ans[262144];\n\nvoid mult(const int& as, const int& bs, const int& C, const int& P) {\n\tint n = as+bs-1;\n\twhile(n - (n & (-n))) n += (n & (-n));\n\tconstructrev(n);\n\trep(i, as) {\n\t\ta1[i] = cd(Av[i] % C);\n\t\ta2[i] = cd(Av[i] / C);\n\t}\n\trep(i, bs) {\n\t\tb1[i] = cd(Bv[i] % C);\n\t\tb2[i] = cd(Bv[i] / C);\n\t}\n\tfft(a1, n, 0); fft(a2, n, 0); fft(b1, n, 0); fft(b2, n, 0);\n\trep(i, n) r1[i] = a1[i]*b1[i];\n\trep(i, n) r2[i] = (a1[i]*b2[i]+a2[i]*b1[i]);\n\trep(i, n) r3[i] = a2[i]*b2[i];\n\tfft(r1, n, 1); fft(r2, n, 1); fft(r3, n, 1);\n\tint V = C*C%P;\n\trep(i, n) ans[i] = (((ll)round(r1[i].real())%P)+C*((ll)round(r2[i].real()))%P+V*((ll)round(r3[i].real())%P))%P;\n}\n\n\n```",
        "postTime": 1584250553,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4245 \u4efb\u610f\u6a21\u6570NTT"
    },
    {
        "content": "$\\textbf{MTT}$.  \n\uff08\u8fd9\u4e2a sb \u5199 $\\textbf{FFT}$ \u7684\u65f6\u5019\u5fd8\u8bb0 $/\\text{lim}$ \u8c03\u4e86\u4e00\u5e74\uff09  \n\u8fd9\u9898\u662f\u4e0d\u662f\u4e09\u6a21 $\\textbf{NTT}$ \u8981\u5947\u6280\u6deb\u5de7\u554a\u2026\u2026\u54b1\u4e0d\u4f1a\u90a3\u79cd\u4e1c\u897f\uff0c\u8fd8\u662f\u62c6\u7cfb\u6570 $\\textbf{FFT}$ \u53cb\u597d\u4e00\u70b9\uff0c\u597d\u8bb0\u2026\u2026  \n\u4f3c\u4e4e\u53ef\u4ee5\u4ece 7 \u6b21\u4f18\u5316\u5230 2 / 1.5 \u6b21\u8bf6\u2026\u2026\u4e0d\u8fc7\u4e0d\u4f1a\u90a3\u79cd\u4e1c\u897f\u4e5f\u53ef\u4ee5\u8fc7\u2026\u2026  \n\u601d\u8def\u5c31\u662f\u628a\u6bcf\u4e2a\u6570\u62c6\u6210 $a\\times2^{15}+b$\uff0c\u8fd9\u6837\u53ef\u4ee5\u4ee4 $F=a* b$\uff0c$G=c* d$ \uff0c\u90a3\u4e48 $F* G$ \u5c31\u53ef\u4ee5\u8868\u793a\u4e3a $a* c+a* d+b* c+b* d$\uff0c\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f $a* c\\times2^{30}+(a* d+b* c)\\times 2^{15}+b* d$\u3002  \n\u4e00\u5171 7 \u6b21 $\\textbf{FFT}$\uff0c\u4f18\u79c0\uff0c\u6069\u3002\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 1000005\n#define reg register\n#define inl inline\n#define int long long\n#define db long double\nusing namespace std;\nconst db Pi=acos(-1.0);\nstruct Complex\n{\n\tdb x,y;\n\tfriend Complex operator + (const Complex &a,const Complex &b)\n\t{\n\t\treturn ((Complex){a.x+b.x,a.y+b.y});\n\t}\n\tfriend Complex operator - (const Complex &a,const Complex &b)\n\t{\n\t\treturn ((Complex){a.x-b.x,a.y-b.y});\n\t}\n\tfriend Complex operator * (const Complex &a,const Complex &b)\n\t{\n\t\treturn ((Complex){a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x});\n\t}\n}a[MAXN],b[MAXN],c[MAXN],d[MAXN],f[MAXN],g[MAXN],h[MAXN];\nint n,m,Mod,lim=1,maxn,rev[MAXN],F[MAXN],G[MAXN],ans[MAXN];\ninl void FFT(reg Complex *A,reg int opt)\n{\n\tfor(reg int i=0;i<lim;i++) if(i<rev[i]) swap(A[i],A[rev[i]]);\n\tfor(reg int mid=1;mid<lim;mid<<=1)\n\t{\n\t\treg Complex Wn=((Complex){cos(Pi/(db)mid),(db)opt*sin(Pi/(db)mid)});\n\t\tfor(reg int j=0;j<lim;j+=(mid<<1))\n\t\t{\n\t\t\treg Complex W=((Complex){1,0});\n\t\t\tfor(reg int k=0;k<mid;k++,W=W*Wn)\n\t\t\t{\n\t\t\t\treg Complex x=A[j+k],y=W*A[j+k+mid];\n\t\t\t\tA[j+k]=x+y;\n\t\t\t\tA[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n}\ninl void MTT(reg int *A,reg int *B)\n{\n\twhile(lim<=(n+m))\n\t{\n\t\tlim<<=1;\n\t\tmaxn++;\n\t}\n    for(reg int i=0;i<lim;i++) rev[i]=((rev[i>>1]>>1)|((i&1)<<maxn-1));\n\tfor(reg int i=0;i<lim;i++)\n\t{\n\t\ta[i].x=A[i]>>15;\n\t\tb[i].x=A[i]&0x7fff;\n\t\tc[i].x=B[i]>>15;\n\t\td[i].x=B[i]&0x7fff;\n\t}\n\tFFT(a,1); FFT(b,1); FFT(c,1); FFT(d,1);\n\tfor(reg int i=0;i<lim;i++)\n\t{\n\t\tf[i]=a[i]*c[i];\n\t\tg[i]=a[i]*d[i]+b[i]*c[i];\n\t\th[i]=b[i]*d[i];\n\t}\n\tFFT(f,-1); FFT(g,-1); FFT(h,-1);\n\tfor(reg int i=0;i<lim;i++) ans[i]=((((int)(f[i].x/(db)lim+0.5)%Mod)<<30)%Mod+(((int)(g[i].x/(db)lim+0.5)%Mod)<<15)%Mod+(int)(h[i].x/(db)lim+0.5)%Mod)%Mod;\n    //\u4e0d\u8981\u5fd8\u4e86 /lim \u554a\uff01\n}\nsigned main()\n{\n\tscanf(\"%lld %lld %lld\",&n,&m,&Mod);\n\tfor(reg int i=0;i<=n;i++) scanf(\"%lld\",&F[i]),F[i]%=Mod;\n\tfor(reg int i=0;i<=m;i++) scanf(\"%lld\",&G[i]),G[i]%=Mod;\n\tMTT(F,G);\n\tfor(reg int i=0;i<=n+m;i++) printf(\"%lld \",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1574471518,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    },
    {
        "content": "# ~~\u4e09\u6a21\u6570NTT~~\n~~\u4e0d\u4f1a~~\n\n\u672c\u6765\u60f3\u5199\u4e09\u6a21\u6570NTT\uff0c\u53d1\u73b0\u5e38\u6570\u592aTM\u5927\u4e86\uff0c\u8fd8\u4e0d\u77e5\u9053\u600e\u4e48\u4f18\u5316\uff0c\u4e8e\u662f\u5c31\u5199\u62c6\u7cfb\u6570FFT\u5427\n\n\n\u9996\u5148\u4e00\u4e2a\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u76f4\u63a5FFT\u5f00long double \u53bb\u8dd1\uff0c\u53d1\u73b0\u7cbe\u5ea6\u6389\u5f97\u5341\u5206\u4e25\u91cd\uff08\u503c\u57df\u5927\u4e8elong long\uff09\uff0c\u4e8e\u662f\u8003\u8651\u5982\u4f55\u89e3\u51b3\n\n\n~~\u901a\u8fc7\u5b66\u4e60bitset\u7684\u7ecf\u9a8c\u6211\u4eec\u77e5\u9053\u8981\u538b\u4f4d~~\n\n\u8003\u8651\u62c6\u7cfb\u6570\n\n\u5047\u8bbe\u591a\u9879\u5f0f$A * B$, \u6a21\u6570\u662f$P$\n\n\u786e\u5b9a\u4e00\u4e2a\u5e38\u6570 $C$ \u4e00\u822c\u4e3a$2^{15}= 32$,$768$ \u6216 $\\sqrt{P}$\n\n\n\u8003\u8651\u628a$A_i$ \u62c6\u6210 $a_i *C+b_i$\n\n\u628a$B_i$ \u62c6\u6210 $c_i *C+d_i$\n\n\u5373\n\n$A_i = a_i *C+b_i$\n\n$B_i = c_i *C+d_i$\n\n\u8003\u8651\u4e24\u4e2a\u6570$X,Y$\u76f8\u4e58\n\n\u8bbe$X = a*C+b$\n\n$Y= c *C+d$\n\n$X*Y=(a *C+b)*(c *C+d)$\n\n$=ac*C^2 + (ad+bc)C+bd$\n\n\u53d1\u73b0$C$\u5148\u4e0d\u7528\u7ba1\uff0c\u8981\u6c42\u7684\u662f$ac,ad+bc,bd$\n\n\u7136\u540e\u628a$a,b,c,d$\u5206\u522b\u6c42\u503c(DFT)\uff0c\u4e58\u8d77\u6765\u540e\u518d\u5bf9$ac,ad+bc,bd$\u505a\u63d2\u503c(IDFT)\u5c31\u884c\u4e86\n\n\u4e00\u5171\u662f4\u6b21DFT+3\u6b21IDFT=7\u6b21FFT\n\n\n\u5e38\u6570\u5de8\u5927\n\n\u53d1\u73b0\u4e00\u5f00\u59cb\u7684\u865a\u6570\u90e8\u5e76\u6ca1\u6709\u7528\u5230\uff0c\u53c2\u8003FFT3\u6b21\u53d82\u6b21\u7684\u4f18\u5316\uff0c\u8bd5\u8bd5\u8fd9\u4e2a\u80fd\u4e0d\u80fd\u884c\n\n\n\u8bbe$X = a+bi$\n\n$Y= c +di$\n\n$X*Y=(a+bi)*(c+di)=ac-bd + (bc+ad)i$\n\n\n\u7136\u9e45\u548c\u6211\u4eec\u8981\u6c42\u7684$ac,bd,ad+bc$\n\n\u73b0\u5728\u5df2\u7ecf\u5c31\u51fa\u6765\u4e86$ad+bc$\n\n\u8003\u8651\u5982\u4f55\u6c42\u5269\u4e0b\u4e24\u4e2a\n\n\u8bbe$X' = a - bi$\n\n$Y= c + di$\n\n$X'*Y=(a-bi)*(c+di)=ac+bd + (ad-bc)i$\n\n\u7136\u540e\u5c31\u77e5\u9053\u4e86\u5b9e\u6570\u90e8$ac+bd$\u7684\u503c\n\n\u7ed3\u5408\u4e0a\u9762$ac-bd$\u7684\u503c\u5c31\u53ef\u4ee5\u6c42\u51fa\u6765$ac$\u548c$bd$\u4e86\n\n\u7136\u540e\u4ee3\u5165$ac*C^2 + (ad+bc)C+bd$\u5c31\u884c\u4e86\n\n\n\u8fd9\u6837\u8c8c\u4f3c\u53ea\u7528\u5bf9$X,Y,X'$\u505a3\u6b21\u6c42\u503c\uff08DFT\uff09\n\n\u518d\u5bf9$X*Y,X'*Y$\u505a2\u6b21\u63d2\u503c\u5c31\u53ef\u4ee5\u4e86\n\n\u4e5f\u5c31\u662f\u8bf4\u4e00\u51715\u6b21\n\n\u636e\u8bf4myy\u67094\u6b21\u7684%%%%% orz\n\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define N 4000005\n#define ll long long\n#define double long double\nusing namespace std;\nconst double pi = acos(-1);\nconst double eps = 0.49;\nconst int C = 32768;//\u5e38\u6570\nstruct cp {\n\tdouble a, b;\n}X[N], Y[N], Xd[N];\ncp operator +(cp x, cp y) {return cp{x.a + y.a, x.b + y.b};}\ncp operator -(cp x, cp y) {return cp{x.a - y.a, x.b - y.b};}\ncp operator *(cp x, cp y) {return cp{x.a * y.a - x.b * y.b, x.b * y.a + x.a * y.b};}\nint rev[N], n, m, P;\nvoid fft(cp *a, int len, int o) {\n\tfor(int i = 1; i <= len; i ++) rev[i] = (rev[i >> 1] >> 1) | ((i&1) * len >> 1);\n\tfor(int i = 1; i <= len; i ++) if(i < rev[i]) swap(a[i], a[rev[i]]);\n\n\tfor(int i = 2; i <= len; i <<= 1) {\n\t\tcp wn = cp{cos(2 * pi / i), o * sin(2 * pi / i)};\n\t\tfor(int j = 0, p = i / 2; j + i - 1 <= len; j += i) {\n\t\t\tcp w0 = cp{1, 0};\n\t\t\tfor(int k = j; k < j + p; k ++, w0 = w0 * wn) {\n\t\t\t\tcp x = a[k], y =  w0 * a[k + p];\n\t\t\t\ta[k] = x + y;\n\t\t\t\ta[k + p] = x - y;\n\t\t\t}\n\t\t}\n\t}\n\tif(o == -1) for(int i = 0; i <= len; i ++) a[i].a /= len, a[i].b /= len;\n}\nint main() {\n\tscanf(\"%d%d%d\", &n, &m, &P);\n\tfor(int i = 0; i <= n; i ++) {\n\t\tint x;\n\t\tscanf(\"%d\", &x);\n\t\tX[i].a = x / C;\n\t\tX[i].b = x % C;\n\t\tXd[i].a = x / C;//Xd\u5c31\u662fX'\n\t\tXd[i].b = -(x % C);\n\t}\n\tfor(int i = 0; i <= m; i ++) {\n\t\tint x;\n\t\tscanf(\"%d\", &x);\n\t\tY[i].a = x / C;\n\t\tY[i].b = x % C;\n\t}\n\tint len = 1;\n\tfor(; len <= n + m;) len <<= 1;\n\tfft(X, len, 1), fft(Xd, len, 1), fft(Y, len, 1);//DFT \u4e09\u6b21\n\tfor(int i = 0; i <= len; i ++) X[i] = X[i] * Y[i], Xd[i] = Xd[i] * Y[i];\n\tfft(X, len, -1), fft(Xd, len, -1);//IDFT\u4e24\u6b21\n\tfor(int i = 0; i <= n + m; i ++) {\n\t\tll ac = (X[i].a + Xd[i].a) / 2 + eps;\n\t\tll bd = Xd[i].a - ac + eps;\n\t\tll bcad = X[i].b + eps;\n\t\tprintf(\"%lld \", (ac * C % P * C % P + bcad * C % P + bd) % P);//\u8ba1\u7b97\n\t}\n\treturn 0;\n}\n\n```\n\u677f\u5b50\u4e00\u904d\u8fc7\uff0c\u611f\u52a8.jpg\n",
        "postTime": 1570931964,
        "uid": 31656,
        "name": "lomit",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4245 \u3010\u3010\u6a21\u677f\u3011\u4efb\u610f\u6a21\u6570NTT\u3011"
    }
]