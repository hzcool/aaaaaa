[
    {
        "content": "### \u9898\u89e3\n\u9898\u76ee\u5b9e\u9645\u5728\u6c42\u8fd9\u6837\u4e00\u4e2a\u4e1c\u897f\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6811\u548c\u8fb9\u6743\uff0c\u4f60\u53ef\u4ee5\u5728\u6811\u4e2d\u52a0\u4e0a\u4e00\u6761\u957f\u4e3a $S$ \u7684\u6709\u5411\u8fb9\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u53f6\u5b50\u8282\u70b9\u95ee\uff1a\u662f\u5426\u80fd\u6784\u9020\u51fa\u4e00\u6761\u4ece\u6839\u8282\u70b9\u51fa\u53d1\u4ee5\u8be5\u8282\u70b9\u4e3a\u7ec8\u70b9\u7684\u957f\u4e3a $K$ \u7684\u8def\u5f84\n\n\u8bbe\u6709\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9 $x$\n\n#### \u60c5\u51b51\n\u6839\u5230 $x$ \u7684\u8def\u5f84\u957f\u7b49\u4e8e $K$\n\n\u90a3\u663e\u7136\u7b54\u6848\u5c31\u662f `Yes`\n\n#### \u60c5\u51b52\n\u8d70\u4e86\u4e00\u6b21\u9644\u52a0\u7684\u6709\u5411\u8fb9\u4f7f\u5f97\u8def\u5f84\u957f\u4e3a $K$\n\n\u8003\u8651\u8fd9\u6761\u6709\u5411\u8fb9\u7684\u7ec8\u70b9\u5728\u54ea\u91cc\uff1a\u7531\u4e8e\u8d70\u8fc7\u8fd9\u6761\u6709\u5411\u8fb9\u4e4b\u540e\u8fd8\u8981\u4ece\u5b83\u7684\u7ec8\u70b9\u8d70\u5230 $x$\uff0c\u6240\u4ee5\u6709\u5411\u8fb9\u7684\u7ec8\u70b9\u4e00\u5b9a\u8981\u662f $x$ \u7684\u4e00\u4e2a\u7956\u5148\n\n\u8bb0\u70b9 $p$ \u7684\u6df1\u5ea6\u662f $d_p$\uff0c\u90a3\u4e48\u5047\u8bbe\u8d70\u4e86\u4e00\u6761 $p\\rightarrow q$ \u7684\u6709\u5411\u8fb9\uff0c\u603b\u957f\u5ea6\u5c31\u662f $d_p+S+(d_x-d_q)$\n\n\u5176\u4e2d\uff0c$p$ \u662f\u6811\u4e0a\u7684\u4efb\u610f\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff0c$q$ \u5fc5\u987b\u662f $x$ \u7684\u7956\u5148\n\n\u8981\u5224\u65ad\u662f\u5426\u6709 $p,q$ \u6ee1\u8db3 $d_p+S+(d_x-d_q)=K$\uff0c\u53ef\u4ee5\u8003\u8651\u679a\u4e3e $q$\uff0c\u8fd9\u6837\u5c31\u786e\u5b9a\u4e86 $d_x-d_q$\uff0c\u9884\u5904\u7406\u51fa $d_p+S$ \u53ef\u4ee5\u53d6\u54ea\u4e9b\u503c(\u5b58\u5728\u4e00\u4e2a `bool` \u6570\u7ec4\u91cc)\uff0c\u5982\u679c\u5b58\u5728\u67d0\u4e2a $p$ \u4f7f\u5f97 $d_p+S=K-(d_x-d_q)$ \u90a3\u4e48 $x$ \u7684\u7b54\u6848\u5c31\u662f `Yes`\n\n\u4e00\u4e2a\u4f8b\u5b50\n\n![1.png](https://i.loli.net/2020/11/30/cK1j5sPYlGWkXOy.png)\n\n#### \u60c5\u51b53\n\u5f53\u7136\uff0c\u53ef\u80fd\u53ef\u4ee5\u8d70\u5f88\u591a\u6b21\u9644\u52a0\u7684\u6709\u5411\u8fb9(\u5728\u4e00\u4e2a\u73af\u4e0a\u4e00\u76f4\u7ed5)\n\n\u5982\u679c\u4e00\u6761\u6709\u5411\u8fb9\u53ef\u4ee5\u8d70\u5f88\u591a\u6b21\uff0c\u90a3\u4e48\u5fc5\u987b\u6ee1\u8db3\u5b83\u7684\u7ec8\u70b9\u662f\u8d77\u70b9\u7684\u7956\u5148\n\n\u53c8\u56e0\u4e3a\u7ec8\u70b9\u8981\u662f $x$ \u7684\u7956\u5148\uff0c\u6240\u4ee5\u73b0\u5728\u9700\u8981\u627e\u5230\u8fd9\u6837\u4e00\u6761\u8def\u5f84 $p\\rightarrow q$\uff1a\n\n\u6ee1\u8db3 $d_x+t*(d_p-d_q+S)=K$ ($t$ \u4e3a\u4e00\u4e2a\u6b63\u6574\u6570)\n\n\u5176\u4e2d $q$ \u662f $x$ \u7684\u7956\u5148\uff0c$p$ \u662f $q$ \u5b50\u6811\u4e2d\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\n\n\u5728dfs\u65f6\uff0c\u6bcf\u5230\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\u5c31\u518d\u628a\u4ee5\u5b83\u4e3a\u6839\u7684\u5b50\u6811\u904d\u5386\u4e00\u904d\uff0c\u628a\u6240\u6709\u5408\u6cd5\u7684 $d_p-d_q+S$ \u5b58\u5728 `bool` \u6570\u7ec4\u91cc\uff0c\u5e76\u5728\u56de\u6eaf\u65f6\u6e05\u9664\u8d21\u732e\n\n\u679a\u4e3e $K-d_x$ \u7684\u6240\u6709\u7ea6\u6570\uff0c\u5224\u65ad\u662f\u5426\u6709\u6ee1\u8db3\u6761\u4ef6\u7684 $d_p-d_q+S$ \u5373\u53ef\n\n![](https://i.loli.net/2020/11/30/T7J5kcrFIPLzmQR.png)\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)^2+m\\sqrt{K})$\n\n```cpp\n#include <bits/stdc++.h>\n#define N 20005\nusing namespace std;\ntypedef long long ll;\n\ntemplate <typename T>\ninline void read(T &num) {\n\tT x = 0, ff = 1; char ch = getchar();\n\tfor (; ch > '9' || ch < '0'; ch = getchar()) if (ch == '-') ff = -1;\n\tfor (; ch <= '9' && ch >= '0'; ch = getchar()) x = (x << 3) + (x << 1) + (ch ^ '0');\n\tnum = x * ff;\n}\n\nint n, ccf, K, S, a[N], d[N];\nint head[N], pre[N<<1], to[N<<1], sz;\nint ok[1000005], ok2[1000005], ans[N];\n\ninline void addedge(int u, int v) {\n\tpre[++sz] = head[u]; head[u] = sz; to[sz] = v;\n\tpre[++sz] = head[v]; head[v] = sz; to[sz] = u;\n}\n\nvoid dfs1(int x, int fa) {\n\tif (d[x]+S <= 1000000 && x <= ccf) ok[d[x]+S]++;\n\tfor (int i = head[x]; i; i = pre[i]) {\n\t\tint y = to[i];\n\t\tif (y == fa) continue;\n\t\td[y] = d[x] + a[y];\n\t\tdfs1(y, x);\n\t}\n} \n\nvoid dfs3(int x, int fa, int rt, int v) {\n\tif (x > ccf) return;\n\tint now = d[x] - d[rt] + S;\n\tif (now <= 1000000) ok2[now] += v;\n\tfor (int i = head[x]; i; i = pre[i]) {\n\t\tint y = to[i];\n\t\tif (y != fa) dfs3(y, x, rt, v);\n\t}\n}\n\nint stk[N], top;\n\nvoid solve(int x) {\n\tif (d[x] == K) {\n\t\tans[x] = 1; return;\n\t}\n\tfor (int i = 1; i <= top; i++) {\n\t\tint y = stk[i];\n\t\tint v = d[x] - d[y];\n\t\tif (v <= K && ok[K-v]) ans[x] = 1;\n\t}\n\tif (d[x] < K) {\n\t\tint v = K - d[x];\n\t\tfor (int i = 1; i * i <= v; i++) {\n\t\t\tif (v % i == 0) {\n\t\t\t\tif (ok2[i] || ok2[v/i]) ans[x] = 1;\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid dfs2(int x, int fa) {\n\tif (x > ccf) {\n\t\tsolve(x);\n\t\treturn;\n\t}\n\tstk[++top] = x;\n\tdfs3(x, fa, x, 1);\n\tfor (int i = head[x]; i; i = pre[i]) {\n\t\tint y = to[i];\n\t\tif (y != fa) dfs2(y, x);\n\t}\n\tdfs3(x, fa, x, -1);\n\ttop--;\n}\n\nint main() {\n\tread(n); read(ccf); read(K); read(S); S++;\n\tswap(ccf, n); n += ccf;\n\tfor (int i = 1, p; i <= n; i++) {\n\t\tread(p); read(a[i]); a[i]++;\n\t\taddedge(p, i);\n\t}\n\tdfs1(0, 0);\n\tdfs2(0, 0);\n\tfor (int i = ccf + 1; i <= n; i++) puts(ans[i]?\"YES\":\"NO\");\n\treturn 0;\n}\n```",
        "postTime": 1607414987,
        "uid": 153123,
        "name": "AK_Dream",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6843 \u3010[BalticOI 2015]File Paths\u3011"
    }
]