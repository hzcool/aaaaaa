[
    {
        "content": "\u8fd9\u91cc\u8bf4\u4e00\u79cd\u51b3\u7b56\u5355\u8c03\u6027+\u5355\u8c03\u6808+\u4e8c\u5206\u7684\u505a\u6cd5\u3002\n\n\u9996\u5148\u8003\u8651\u662f\u5426\u6709\u51b3\u7b56\u5355\u8c03\u6027\u3002\u5bf9\u4e8e\u4e00\u4e2a$i$\uff0c\u8bbe\u5176\u6700\u4f18\u51b3\u7b56\u70b9\u4e3a$o_i$\uff0c\u90a3\u4e48\u4e00\u5b9a\u6709$color[i]=color[o_i]$\u3002\n\n\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5c31\u5f88\u5bb9\u6613\u5217\u51fa\u6765\uff1a\n\n$$f_i=\\max_{color_i=color_j}\\{ f_{j-1}+color_i\\cdot (sum_i-sum_j+1)^2\\} \\quad (j<i)$$\n\n\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u4f1a\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff0c\u56e0\u4e3a\u8f6c\u79fb\u53ea\u5728\u76f8\u540c\u989c\u8272\u95f4\u8f6c\u79fb\uff0c\u6240\u4ee5\u5bf9\u4e8e\u540e\u9762\u7684$color_i\\cdot (sum_i-sum_j+1)$\u662f\u968f\u7740$i$\u7684\u53d8\u5316\u800c\u5355\u589e\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u4e00\u4e2a$j_1<j_2$\uff0c\u4e00\u5f00\u59cb\u65f6\u6ee1\u8db3$j_1$\u66f4\u4f18\uff0c\u90a3\u4e48\u968f\u7740$i$\u589e\u5927$j_2$\u5c31\u6c38\u8fdc\u4e0d\u4f1a\u6bd4$j_1$\u66f4\u4f18\uff0c\u56e0\u4e3a\u4e8c\u6b21\u51fd\u6570\u7684\u589e\u957f\u5bf9\u4e8e\u66f4\u4f18\u7684$j_1$\u53ea\u4f1a\u589e\u957f\u5f97\u66f4\u5feb\uff08\u7c7b\u4f3c\u4e8e\u8f93\u5728\u8d77\u8dd1\u7ebf\u4e0a233\uff09\u3002\n\n\u6240\u4ee5\u53d1\u73b0\u662f\u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\u7684\uff0c\u5373\u540c\u4e00\u6bb5\u533a\u95f4\u7684\u3001\u540c\u4e00\u79cd\u989c\u8272\u7684\u51b3\u7b56\u70b9\u4f1a\u51fa\u73b0\u4e0d\u589e\u7684\u5c40\u9762\u3002\n\n\u90a3\u4e48\u4e00\u4e2a\u81ea\u7136\u7684\u60f3\u6cd5\u4f7f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\uff0c\u53d1\u73b0\u7b2c\u4e8c\u4e2a\u5143\u7d20\u6bd4\u7b2c\u4e00\u4e2a\u5143\u7d20\u4f18\u7684\u65f6\u5019$pop$\u6389\u5373\u53ef\u3002\u4f46\u662f\u95ee\u9898\u5728\u4e8e\u5f53\u524d\u70b9\u7684\u6700\u7ec8\u51b3\u7b56\u70b9\u53ef\u80fd\u4f1a\u66f4\u9760\u524d\uff0c\u6bd4\u5982$j_1<j_2<j_3$\u4f46$val(j_1)>val(j_3)>val(j_2)$\uff0c\u5c31\u5e94\u8be5\u4ece$j_1$\u8f6c\u79fb\u3002\n\n\n\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u6839\u636e\u5927\u8d8b\u52bf\u800c\u8a00\uff0c\u51fa\u73b0\u4e0a\u8ff0\u90a3\u79cd\u60c5\u51b5\u5f53\u4e14\u4ec5\u5f53\u4e00\u6bb5\u65f6\u95f4\u5185$j_2$\u6bd4$j_1$\u66f4\u4f18\uff08\u5426\u5219\u5f53\u65f6\u5c31\u4e0d\u4f1a\u5165\u6808\uff09\uff0c\u4e4b\u540e$j_1$\u5f00\u59cb\u6bd4$j_2$\u4f18\uff08\u5bfc\u81f4\u51fa\u73b0\u4e86\u73b0\u5728\u7684$val(j_1)>val(j_2)$\uff09\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5**\u4e8c\u5206\u51fa**\u4e00\u4e2a\u786e\u5b9a\u7684\u65f6\u95f4\uff08\u6b64\u5904\u65f6\u95f4\u7684\u6d41\u6dcc\u7528\u65b0\u7684$color_i$\u4e2a\u6570\u7684\u589e\u591a\u523b\u753b\uff09\u4f18\u52a3\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u800c\u5982\u679c\u8fd9\u4e2a\u65f6\u95f4\u5728$\\leq sum_i$\n\u4e4b\u524d\uff0c\u90a3\u4e48\u5c31\u8981$pop$\u6389$j_2$\uff0c\u56e0\u4e3a\u6ca1\u7528\u4e86\u3002\n\n\u6240\u4ee5\uff0c\u6bcf\u6b21\u52a0\u5165\u5143\u7d20\u7684\u65f6\u5019\u90fd\u8981\u5224\u65ad\u5f53\u524d\u6808\u4e2d$top-1$\u8d85\u8fc7$top$\n\u7684\u5143\u7d20\u7684\u65f6\u95f4\u662f\u5426\u5c0f\u4e8e\u7b49\u4e8e$top$\u8d85\u8fc7\u8981\u6dfb\u52a0\u8fdb\u6765\u7684$x$\u7684\u65f6\u95f4\uff0c\u5982\u679c\u662f\u5c31\u8981\u628a$top$\u7ed9$pop$\u6389\uff0c\u56e0\u4e3a\u5728$top$\u8d85\u8fc7$x$\u4e4b\u524d$top$\u5c31\u6b7b\u4e86\u3002\n\n\u2026\u2026 \u8fd9\u4e48\u4e00\u6bd4\u8f83\u4f3c\u4e4e\u659c\u7387\u4f18\u5316\u7b80\u76f4\u662f`pj`\u7b97\u6cd5\uff0c\u6bd4\u51b3\u7b56\u5355\u8c03\u6027\u7684\u601d\u7ef4\u96be\u5ea6\u4e0d\u77e5\u9053\u4f4e\u5230\u54ea\u91cc\u53bb\u4e86\uff08\u96fe\uff09\u3002\u7136\u800c\u4e8b\u5b9e\u4e0a\u8fd9\u662f\u6bd4\u8f83`hard`\u7684\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u6bd4\u8f83\u666e\u901a\u7684\u6ee1\u8db3\u5168\u5c40\u7684\u51b3\u7b56\u70b9\u5355\u8c03\uff0c\u4f46\u662f\u8fd9\u9053\u9898\u8981\u5206\u989c\u8272\u8003\u8651\u624d\u80fd\u53d1\u73b0\u51b3\u7b56\u70b9\u5355\u8c03233\n\n```cpp\n#define o(a, b) stk[a][b]\n#define sz(k) stk[k].size()\n#define sp(k) stk[k].size() - 1\n#define sq(k) stk[k].size() - 2\nil LL calc(int p, int t){\n    return dp[p - 1] + 1ll * base[p] * t * t ;\n}\nil int chk(int x, int y){\n\trg int ret = N + 1 ;\n\trg int l = 1, r = N, mid ; \n\twhile (l <= r){\n\t\tmid = (l + r) >> 1 ; \n\t\tif (calc(x, mid - s[x] + 1) >= calc(y, mid - s[y] + 1))\n\t\t\tret = mid, r = mid - 1 ; else l = mid + 1 ; \n\t}\n\treturn ret ;\n}\nint main(){\n\tcin >> N ; int i ; \n\tfor (i = 1 ; i <= N ; ++ i) \n\t\tscanf(\"%d\", &base[i]), s[i] = ++ buc[base[i]] ; \n\tfor (i = 1 ; i <= N ; ++ i){\n\t\trg int t = base[i] ; \n\t\twhile (sz(t) >= 2 && chk(o(t, sq(t)), o(t, sp(t))) <= chk(o(t, sp(t)), i)) \n\t\t\tstk[t].pop_back() ; stk[t].push_back(i) ; \n\t\twhile (sz(t) >= 2 && chk(o(t, sq(t)), o(t, sp(t))) <= s[i]) stk[t].pop_back() ;\n\t\tdp[i] = calc(o(t, sp(t)), s[i] - s[o(t, sp(t))] + 1) ;  \n\t}\n\tcout << dp[N] << endl ; return 0 ;\n}\n```\n\n$\\rm By~the~way$\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u51b3\u7b56\u5355\u8c03\u6027\u53ea\u8981\u5199\u597d\u5206\u6cbb\u5c31\u53ef\u4ee5\u4e86\uff0c\u5206\u6cbb\u53ef\u4ee5\u7528\u7684\u524d\u63d0\u662f\u5f53\u524d\u7ef4\u5ea6\u7684$\\{f_i\\}$\u5f7c\u6b64\u4e4b\u95f4\u7ebf\u6027\u65e0\u5173\u3002",
        "postTime": 1572339032,
        "uid": 28313,
        "name": "\u768e\u6708\u534a\u6d12\u82b1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011"
    },
    {
        "content": "[\u849f\u84bb\u7684\u535a\u5ba2QwQ](https://oi.kkkstra.cn/)\n\n### Description\n\n\u5c06\u4e00\u4e2a\u6570\u5217\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u4ece\u6bcf\u4e00\u6bb5\u4e2d\u9009\u5b9a\u4e00\u4e2a\u6570$s_0$\uff0c\u5047\u8bbe\u8fd9\u4e2a\u6570\u6709$t$\u4e2a\uff0c\u8fd9\u4e00\u6bb5\u4ef7\u503c\u4e3a$s_0 t^2$\uff0c\u6570\u5217\u7684\u603b\u4ef7\u503c\u4e3a\u6bcf\u4e00\u6bb5\u7684\u4ef7\u503c\u548c\uff0c\u8981\u4f7f\u6700\u7ec8\u7684\u603b\u4ef7\u503c\u6700\u5927\uff0c\u6c42\u8fd9\u4e2a\u603b\u4ef7\u503c\u3002\n\n### Solution\n\n\u9996\u5148\u8981\u77e5\u9053\u4e00\u4e2a\u663e\u7136\u7684\u6027\u8d28\uff0c\u5c31\u662f\u6bcf\u4e00\u6bb5\u7684\u5de6\u53f3\u7aef\u70b9\u7684\u8d1d\u58f3\u5927\u5c0f\u4e00\u5b9a\u662f\u76f8\u7b49\u7684\uff0c\u4e14\u8fd9\u4e00\u6bb5\u9009\u5b9a\u7684$s_0$\u4e00\u5b9a\u662f\u5de6\u53f3\u7aef\u70b9\u7684\u8d1d\u58f3\u5927\u5c0f\u3002\n\n\u56e0\u4e3a\u5982\u679c\u5de6\u53f3\u7aef\u70b9\u8d1d\u58f3\u5927\u5c0f\u4e0d\u76f8\u7b49\u7684\u8bdd\uff0c\u5fc5\u7136\u6709\u4e00\u4e2a\u7aef\u70b9\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\uff0c\u90a3\u4e48\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u7aef\u70b9\u7aef\u70b9\u548c\u5176\u5b83\u8d1d\u58f3\u518d\u6784\u6210\u65b0\u7684\u4e00\u6bb5\uff0c\u4f1a\u4f7f\u5f97\u7b54\u6848\u66f4\u4f18\u3002\n\n\u8bbe$f_i$\u8868\u793a\u524d$i$\u4e2a\u4f4d\u7f6e\u5206\u6210\u82e5\u5e72\u6bb5\u7684\u7b54\u6848\u6700\u5927\u662f\u591a\u5c11\uff0c$c_i$\u8868\u793a$i$\u662f\u76f8\u540c\u5927\u5c0f\u7684\u8d1d\u58f3\u4e2d\u7684\u7b2c\u51e0\u4e2a\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5f88\u5bb9\u6613\u53ef\u4ee5\u5199\u51fa\u6765\uff1a\n\n$$f_i = \\max \\limits_{0<j\\le i,s_i=s_j} \\left \\{ f_{j-1 + s_i(c_i-c_j+1)^2} \\right \\}$$\n\n~~\u663e\u7136~~\u8fd9\u4e2a\u5f0f\u5b50\u6709\u540c\u65f6\u4e0e$i$\u548c$j$\u76f8\u5173\u7684\u9879\uff0c\u53ef\u4ee5\u659c\u7387\u4f18\u5316\n\n\u5148\u5c06\u5f0f\u5b50\u5c55\u5f00\uff0c\u628a$\\max$\u53bb\u6389\uff0c$s_i$\u548c$s_j$\u53ef\u4ee5\u76f8\u4e92\u66ff\u6362\n\n$$f_i = f_j-1 + s_i c_i^2 - 2s_i c_i c_j + s_j c_j^2 + 2s_i c_i - 2 s_j c_j + s_i$$\n\n\u628a\u53ea\u548c$i$\u6709\u5173\u7684\u90e8\u5206\u62ff\u51fa\u6765\uff1a$f_i-s_i c_i^2 - 2s_i c_i + s_i$\n\n\u628a\u53ea\u548c$j$\u6709\u5173\u7684\u90e8\u5206\u62ff\u51fa\u6765\uff1a$f_{j-1}+s_j c_j^2 - 2s_j c_j$\n\n\u628a\u548c$i,j$\u90fd\u6709\u5173\u7684\u90e8\u5206\u62ff\u51fa\u6765\uff1a$2s_i c_i c_j$\n\n\u628a$j$\u6709\u5173\u7684\u90e8\u5206\u653e\u5728\u5de6\u8fb9\uff0c\u5176\u4f59\u7684\u653e\u5728\u53f3\u8fb9\uff0c\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\n\n$$f_{j-1}+s_j c_j^2 - 2s_j c_j = 2s_i c_i c_j + f_i-s_i c_i^2 - 2s_i c_i + s_i$$\n\n\u4ee4\n\n$$\n\\begin{cases}\ny = f_{j-1}+s_j c_j^2 - 2s_j c_j \\\\\nk=2s_i c_i \\\\\nx=c_j \\\\\nb=f_i-s_i c_i^2 - 2s_i c_i + s_i\n\\end{cases}\n$$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u6bcf\u4e00\u4e2a\u51b3\u7b56\u770b\u505a\u4e00\u4e2a\u70b9$(x_j,y_j)$\uff0c\u5c06\u6bcf\u4e2a\u72b6\u6001\u770b\u505a\u4e00\u6761\u659c\u7387$2s_i c_i$\u7684\u76f4\u7ebf\uff0c\u6bcf\u6b21\u8f6c\u79fb\u5c31\u76f8\u5f53\u4e8e\u8ba9\u659c\u7387\u4e3a$k_i$\u7684\u76f4\u7ebf\u7ecf\u8fc7\u67d0\u4e2a\u70b9\u4f7f\u5f97\u622a\u8ddd\u6700\u5927\u3002\n\n\u663e\u7136\u8fd9\u91cc\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\uff0c\u56e0\u4e3a$x_i$\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u51b3\u7b56\u7684\u6700\u4f18\u70b9\u5728\u51f8\u58f3\u7684\u6700\u540e\u4e00\u4e2a\u70b9\u53d6\u5230\uff0c\u4e8e\u662f\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u6bcf\u6b21\u8f6c\u79fb\u53bb\u6808\u9876\u5373\u53ef\u3002\n\n### Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\nconst int _ = 100000 + 10;\nconst int __ = 10000 + 10;\nint n, tot[__];\nll s[_], c[_], f[_];\nvector<int> stk[__];\n\ninline ll X(int i) { return c[i]; }\ninline ll Y(int i) { return f[i - 1] + s[i] * c[i] * c[i] - 2 * s[i] * c[i]; }\ninline double slope(int i, int j) { return 1.0 * (Y(i) - Y(j)) / (X(i) - X(j)); }\ninline ll calc(int i, int j) { return f[j - 1] + s[i] * (c[i] - c[j] + 1) * (c[i] - c[j] + 1); }\n\n#define t1 stk[t][stk[t].size() - 1]\n#define t2 stk[t][stk[t].size() - 2]\n\nint main() {\n\tcin >> n;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tcin >> s[i];\n\t\tc[i] = ++tot[s[i]];\n\t}\n\tfor (int i = 1; i <= n; ++i) {\n\t\tint t = s[i];\n\t\twhile (stk[t].size() >= 2 && slope(t2, i) >= slope(t2, t1)) stk[t].pop_back();\n\t\tstk[t].push_back(i);\n\t\twhile (stk[t].size() >= 2 && calc(i, t1) <= calc(i, t2)) stk[t].pop_back();\n\t\tf[i] = calc(i, stk[t][stk[t].size() - 1]);\n\t}\n\tcout << f[n] << endl;\n\treturn 0;\n}\n```",
        "postTime": 1572058011,
        "uid": 49777,
        "name": "kkkstra",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011"
    },
    {
        "content": "\u7ed9\u5b9a\u957f\u4e3a$n$(1e5)\u7684\u6570\u5217$s$(1e4)\uff0c\u5c06\u5176\u5206\u6210\u82e5\u5e72\u8fde\u7eed\u6bb5\u3002\n\n\u53ef\u4ee5\u4ece\u4e00\u6bb5\u4e2d\u4efb\u9009\u4e00\u4e2a\u6570$s_0$\uff0c\u8fd9\u4e00\u6bb5\u7684\u8d21\u732e\u5c31\u662f$cnt[s_0]^2*s_0$\uff0c\u5176\u4e2d$cnt[s_0]$\u8868\u793a\u8fd9\u4e00\u6bb5\u4e2d$s_0$\u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u6c42\u6240\u6709\u6bb5\u7684\u8d21\u732e\u4e4b\u548c\u7684\u6700\u5927\u503c\u3002\n\n---\n\u4e00\u4e2a\u57fa\u7840\u7684dp\uff1a\n\n\u8bbe$d_i$\u8868\u793a\u628a\u524d$i$\u4e2a\u6570\u5206\u597d\u7684\u6700\u5927\u8d21\u732e\uff0c$d_0=0$.\n\n$d_i = max\\{d_{j-1}+cal(j,i)\\}$\uff0c\u5176\u4e2d$0<j<=i$\uff0c$cal(a,b)$\u8868\u793a\u628a$a$\u5230$b$\u5206\u6210\u4e00\u6bb5\u7684\u6700\u5927\u8d21\u732e\u3002\n\n\u4e00\u4e2a\u660e\u663e\u7684\u95ee\u9898\u662f$cal(j,i)$\u96be\u4ee5\u8ba1\u7b97\uff0c\u76f4\u63a5\u679a\u4e3e\u7684\u590d\u6742\u5ea6\u53ef\u80fd\u8fbe\u5230$O(n^3)$\n\n---\n\n\u7ed3\u8bba\uff1a\u6700\u4f18\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e00\u6bb5\u7684\u9996\u5c3e\u6570\u5b57\u5fc5\u5b9a\u76f8\u540c\uff0c\u800c\u4e14\u4f5c\u4e3a$s_0$\u3002\n\n\u8bc1\u660e\uff1a\u5982\u679c\u5b58\u5728\u4e00\u4e2a\u6bb5\u7684\u9996\u90e8\u6570\u5b57\u4e0d\u662f\u8fd9\u4e2a\u6bb5\u7684$s_0$\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u5176\u72ec\u7acb\u6210\u6bb5\uff0c\u8d21\u732e\u663e\u7136\u589e\u52a0\u3002\u5c3e\u90e8\u540c\u7406\u3002\n\n\u628a$n$\u4e2a\u4f4d\u7f6e\u6309\u503c\u5206\u7ec4\uff0c\u8bb0$p_{i,j}$\u8868\u793a\u6570\u503c$i$\u5728\u539f\u6570\u5217\u4e2d\u7b2c$j$\u6b21\uff08\u4ece\u7b2c0\u6b21\u5f00\u59cb\u7b97\uff09\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u6709\uff1a$s[p_{i,j}]=i$\u3002\n\n\u6b64\u65f6\u5bf9\u4e8e\u4f4d\u7f6e$p_{i,j}$\uff0c\u53ea\u5e94\u8be5\u4ece$p_{i,j}-1,p_{i,j-1}-1,p_{i,j-2}-1,...,p_{i,0}-1$\u53bb\u8f6c\u79fb\uff0c\u4e14\u6570\u503c$i$\u51fa\u73b0\u7684\u6b21\u6570\u5f88\u5bb9\u6613\u7b97\u51fa\uff0c\u5373\uff1a\n\n$d[p_{i,j}] = max\\{d[p_{i,k}-1]+i*(j-k+1)^2\\}$\uff0c$0<=k<=j$\n\n\u4fdd\u5b58\u6bcf\u4e2a\u4f4d\u7f6e\u5bf9\u5e94\u7684$i,j$\u503c\uff0c\u6309$p_{i,j}$\u9012\u589e\u7684\u987a\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u6b64\u65f6\u590d\u6742\u5ea6\u5e76\u4e0d\u80fd\u5b8c\u5168\u6ee1\u8db3\u9700\u6c42\uff0c\u5982\u679c\u6240\u6709\u6570\u503c\u90fd\u76f8\u540c\u8fd8\u662f\u4f1a\u5361\u5230$O(n^2)$\uff0c\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u4f18\u5316\u3002\n\n```cpp\nint xi[M], xj[M]; \nvector<int> pos[10016];\nll dp[M];\nint main()\n{\n\tint n = read();\n\tfor(int p=1; p<=n; ++p)\n\t{\n\t\txi[p] = read();\n\t\txj[p] = pos[xi[p]].size();\n\t\tpos[xi[p]].push_back(p);\n\t}\n\tfor(int p=1; p<=n; ++p)\n\t{\t\n\t\tint i = xi[p], j = xj[p]; \n\t\tfor(int k=0; k<=j; ++k)\n\t\t\tdp[p] = max(dp[p], dp[pos[i][k]-1] + 1ll*i*(j-k+1)*(j-k+1));\n\t}\n\tcout << dp[n] << \"\\n\";\n}\n```\n~~\u5f00O2\u76f4\u63a5AC\u4e86\u4f60\u6562\u4fe1~~ \n\n---\n\u4ee5\u4e0b\u5185\u5bb9\u9700\u8981**\u659c\u7387\u4f18\u5316**\u4f5c\u4e3a\u524d\u7f6e\u77e5\u8bc6\uff0c\u53ef\u4ee5\u81ea\u884c\u4e86\u89e3\u6216\u8005\u5bdf\u770b[\u6211\u7684\u535a\u5ba2](https://blog.csdn.net/m0_37809890/article/details/102389121)qwq.\n\n\u5bf9\u4e8e\u8f6c\u79fb\u5f0f\uff1a$d[p_{i,j}] = max\\{d[p_{i,k}-1]+i*(j-k+1)^2\\}$\n\n\u6574\u7406\u5f97\u5230\uff1a$d[p_{i,j}] = i(j+1)^2 +max\\{d[p_{i,k}-1]+ik^2-2i(j+1)k\\}$\n\n\u8bbe$a<b<j$\uff0c\u90a3\u4e48\u4ece$d[p_{i,b}-1]$\u8f6c\u79fb\u6bd4\u4ece$d[p_{i,a}-1]$\u8f6c\u79fb\u66f4\u4f18\u7b49\u4ef7\u4e8e\n\n$d[p_{i,b}-1]+ib^2-2i(j+1)b>d[p_{i,a}-1]+ia^2-2i(j+1)a$\n\n\u6574\u7406\u5f97\u5230\uff1a\n\n$\\frac{(d[p_{i,b}-1]+ib^2) - (d[p_{i,a}-1]+ia^2)}{b-a}>2i(j+1)$\n\n\u7531\u659c\u7387\u4f18\u5316\u539f\u7406\uff1a\n1. $y_a=d[p_{i,a}-1]+ia^2,x_a=a,k=2i(j+1)$\u3002\n2. \u7b26\u53f7\u662f\u5927\u4e8e\u53f7\uff0c\u7ef4\u62a4\u4e0a\u51f8\u5305\u3002\n3. \u4e0a\u51f8\u5305\u659c\u7387\u9012\u51cf\uff0c\u76ee\u6807\u659c\u7387\u9012\u589e\uff0c\u6240\u4ee5\u5728\u961f\u5c3e\u64cd\u4f5c\u3002\n4. \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5355\u8c03\u6808\u3002\n\n\u6ce8\u610f\uff0c\u9700\u8981\u7ed9\u6bcf\u4e00\u4e2a$i$\u503c\u90fd\u7ef4\u62a4\u4e00\u4e2a\u72ec\u7acb\u7684\u51f8\u5305\u3002\n\n---\n\n\u5b9e\u73b0\u7ec6\u8282\uff1a\n1. \u5355\u8c03\u6808\u4e2d\u53ef\u4ee5\u5b58\u653e\u5b9e\u9645\u4f4d\u7f6e\uff0c$i$\u548c$j$\u53ef\u4ee5\u7531\u63a8\u5bfc\u5f97\u5230\u3002\n2. \u6b64\u9898\u4e2d\u6c42$dp[p]$\u65f6\u9700\u8981\u628a$p$\u653e\u5165\u51f8\u5305\u4e2d\uff0c\u6240\u4ee5\u64cd\u4f5c\u987a\u5e8f\u5e94\u8be5\u662f\uff1a\n\t1. \u51c6\u5907\u653e\u5165p\uff0c\u628a\u6784\u6210\u4e0b\u51f8\u70b9\u7684\u6808\u9876\u5f39\u51fa\n\t2. \u653e\u5165p\n\t3. \u66f4\u65b0\u76ee\u6807\u659c\u7387\uff0c\u628a\u4e0d\u6ee1\u8db3\u76ee\u6807\u659c\u7387\u7684\u6808\u9876\u5f39\u51fa\n\t4. \u6c42dp[p]\n\n---\nAC\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\nll xi[M], xj[M]; \nvector<int> pos[10016];\nll dp[M];\n\nvector<int> ms[10016]; //\u5355\u8c03\u6808\ninline int t1(const vector<int> &vc){return vc[vc.size()-1];} //\u6808\u9876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\ninline int t2(const vector<int> &vc){return vc[vc.size()-2];} //\u6808\u9876\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\ninline ll subx(int p1, int p2){return xj[p2]-xj[p1];}\ninline ll suby(int p1, int p2){\n\treturn (dp[p2-1] + xi[p2]*xj[p2]*xj[p2]) - (dp[p1-1] + xi[p1]*xj[p1]*xj[p1]);\n}\ninline ll cal(int p, int lp){\n\treturn dp[lp-1] + xi[p]*(xj[p]-xj[lp]+1)*(xj[p]-xj[lp]+1);\n}\nint main(void)\n{\n\tint n = read();\n\tfor(int p=1; p<=n; ++p)\n\t{\n\t\txi[p] = read();\n\t\txj[p] = pos[xi[p]].size();\n\t\tpos[xi[p]].push_back(p);\n\t}\n\n\tfor(int p=1; p<=n; ++p)\n\t{\t\n\t\tint i = xi[p], j = xj[p]; \n\t\twhile(ms[i].size()>=2 &&\n\t\t\tsuby(t2(ms[i]),t1(ms[i]))*subx(t1(ms[i]),p) <= subx(t2(ms[i]),t1(ms[i]))*suby(t1(ms[i]),p)\n\t\t) ms[i].pop_back(); \n\n\t\tms[i].push_back(p);\n\n\t\twhile(ms[i].size()>=2 && suby(t2(ms[i]),t1(ms[i])) <= 2ll*i*(j+1)*subx(t2(ms[i]),t1(ms[i])))\n\t\t\tms[i].pop_back();\n\n\t\tdp[p] = cal(p, t1(ms[i]));\n\t}\n\tcout << dp[n] << \"\\n\";\n\n    return 0;\n}\n```",
        "postTime": 1570738798,
        "uid": 43358,
        "name": "LittleFall",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011\u659c\u7387\u4f18\u5316"
    },
    {
        "content": "[\u5e7f\u544a](http://m-sea-blog.com)\n\n---\n\n\u659c\u7387\u4f18\u5316\u597d\u9898\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u663e\u7136\u7684\u6027\u8d28\uff1a\u6bcf\u4e00\u6bb5\u5de6\u53f3\u7aef\u7684\u8d1d\u58f3\u5927\u5c0f\u4e00\u5b9a\u76f8\u540c\uff0c\u800c\u4e14\u8fd9\u4e00\u6bb5\u7684 $s_0$ \u4e00\u5b9a\u662f\u5de6\u53f3\u7aef\u8d1d\u58f3\u7684\u5927\u5c0f\u3002\u56e0\u4e3a\u5982\u679c\u4e0d\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u663e\u7136\u53ef\u4ee5\u628a\u7aef\u70b9\u5355\u72ec\u6210\u4e00\u6bb5\uff0c\u7136\u540e\u7b54\u6848\u4f1a\u53d8\u5927\u3002\n\n\u8bbe $dp_i$ \u8868\u793a\u524d $i$ \u4e2a\u8d1d\u58f3\u6700\u591a\u53ef\u4ee5\u5f97\u5230\u591a\u5c11\u67e0\u6aac\uff0c$c_i$ \u8868\u793a $i$ \u662f\u7b2c\u51e0\u4e2a $a_i$ \u5927\u5c0f\u7684\u67e0\u6aac\uff0c\u5bb9\u6613\u5f97\u5230\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n$$dp_i=\\max_{j=1}^i\\left\\{dp_{j-1}+a_i(c_i-c_j+1)^2\\right\\}$$\n\n\u628a $\\max$ \u91cc\u7684\u4e1c\u897f\u62c6\u5f00\uff0c\u5e76\u628a\u6240\u6709\u9879\u5206\u4e3a\u4e09\u7c7b\uff1a\n\n- \u4e0e $j$ \u65e0\u5173\u7684\uff1a$a_ic_i\\!^2+2a_ic_i+a_i$\n- \u53ea\u548c $j$ \u6709\u5173\u7684\uff1a$dp_{j-1}+a_ic_j\\!^2-2a_ic_j$\uff08\u6ce8\u610f\uff0c $a_i=a_j$\uff09\n- \u65e2\u548c $i$ \u6709\u5173\u53c8\u548c $j$ \u6709\u5173\u7684\uff1a$-2a_ic_ic_j$\n\n\u4ee4 $pre_i=a_ic_i\\!^2+2a_ic_i+a_i$\uff0c$k_i=2c_i$\uff0c$x_i=a_ic_i$\uff0c$y_i=dp_{i-1}+a_ic_i\\!^2-2a_ic_i$\uff0c\u90a3\u4e48\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u6539\u5199\u4e3a\uff1a\n\n$$dp_i=pre_i+\\max_{j=1}^{i}\\left\\{-k_ix_j+y_j\\right\\}$$\n\n\u628a\u6bcf\u4e2a\u8f6c\u79fb\u70b9\u770b\u505a\u4e00\u4e2a\u70b9 $(x_j,y_j)$\uff0c\u90a3\u4e48\u6211\u4eec\u76f8\u5f53\u4e8e\u8981\u627e\u4e00\u4e2a\u70b9\uff0c\u4f7f\u5f97\u659c\u7387\u4e3a $k_i$ \u7684\u7ecf\u8fc7\u5b83\u7684\u76f4\u7ebf\u7684\u7eb5\u622a\u8ddd\u6700\u5927\u3002\n\n\u663e\u7136\u6240\u6709\u53ef\u80fd\u7684\u8f6c\u79fb\u70b9\u5728\u4e0a\u51f8\u58f3\u4e0a\uff1b\u56e0\u4e3a $x_i$ \u5355\u589e\u3001$k_i$ \u5355\u589e\uff0c\u6240\u4ee5\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u4e0a\u51f8\u58f3\uff0c\u6808\u9876\u4e3a\u6700\u4f18\u51b3\u7b56\u3002\n\n\u6ce8\u610f\u6bcf\u6b21\u8981\u628a\u81ea\u5df1\u5148\u52a0\u5230\u5355\u8c03\u6808\u4e2d\u53bb\u518d\u53d6\u6808\u9876\u8f6c\u79fb\u3002\n\n```cpp\n// ===================================\n//   author: M_sea\n//   website: http://m-sea-blog.com/\n// ===================================\n#include <algorithm>\n#include <iostream>\n#include <cstdlib>\n#include <cstring>\n#include <cstdio>\n#include <cmath>\n#include <vector>\n#include <stack>\n#define re register\n#define sqr(x) ((x)*(x))\n#define int long long\nusing namespace std;\n\ninline int read() {\n    int X=0,w=1; char c=getchar();\n    while (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n    while (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n    return X*w;\n}\n\nconst int N=100000+10,V=10000+10;\n\nint n,a[N],o[V],c[N];\nint dp[N];\nvector<int> Q[V];\n\ninline int X(int i) { return a[i]*c[i]; }\ninline int Y(int i) { return dp[i-1]+a[i]*c[i]*c[i]-2*a[i]*c[i]; }\ninline double slope(int i,int j) {\n    return 1.0*(Y(i)-Y(j))/(X(i)-X(j));\n}\ninline int calc(int i,int j) {\n    return dp[j-1]+a[i]*sqr(c[i]-c[j]+1);\n}\n\n#define A Q[t][Q[t].size()-2]\n#define B Q[t][Q[t].size()-1]\n\nsigned main() {\n    n=read();\n    for (re int i=1;i<=n;++i)\n        a[i]=read(),c[i]=c[o[a[i]]]+1,o[a[i]]=i;\n    for (re int i=1;i<=n;++i) { int t=a[i];\n        while (Q[t].size()>=2&&slope(A,i)>=slope(A,B)) Q[t].pop_back();\n        Q[t].push_back(i);\n        while (Q[t].size()>=2&&calc(i,B)<=calc(i,A)) Q[t].pop_back();\n        dp[i]=calc(i,Q[t].back());\n    }\n    printf(\"%lld\\n\",dp[n]);\n    return 0;\n}\n```",
        "postTime": 1571799375,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.com.cn/problem/P5504)\n\n\u9898\u610f\uff1a\u6709$n$\u4e2a\u8d1d\u58f3\uff0c\u6bcf\u4e2a\u8d1d\u58f3\u6709\u5927\u5c0f$v_i$\u3002\u6bcf\u6b21\u53ef\u4ee5\u4ece\u5de6\u8fb9\u53d6\u4e00\u6bb5\uff0c\u4e5f\u53ef\u4ee5\u4ece\u53f3\u8fb9\u53d6\u4e00\u6bb5\u3002\u53d6\u51fa\u6765\u7684\u4e00\u6bb5\u4e2d\uff0c\u9009\u62e9\u5176\u4e2d\u7684\u4e00\u79cd\u8d1d\u58f3\u7684\u5927\u5c0f$v_0$\uff0c\u90a3\u4e48\u8fd9\u4e00\u6bb5\u7684\u8d21\u732e\u4e3a$v_0*k^2$\uff0c$k$\u662f\u8fd9\u4e00\u6bb5\u4e2d\u5927\u5c0f\u4e3a$v_0$\u7684\u4e2a\u6570\u3002\n\n$n\\leq 10^5,v_i\\leq 10^4$\n\n\u7b80\u5316\u4e00\u4e0b\u9898\u76ee\uff1a\n\n\u9996\u5148\uff0c\u9898\u76ee\u8bf4\u53ef\u4ee5\u4ece\u5de6\u8fb9\u53d6\uff0c\u4e5f\u53ef\u4ee5\u4ece\u53f3\u8fb9\u53d6\uff0c\u4f46\u662f\u53d6\u7684\u987a\u5e8f\u5e76\u4e0d\u4f1a\u5f71\u54cd\u7b54\u6848\u3002\u6240\u4ee5\u7edf\u4e00\u4ece\u5de6\u8fb9\u53d6\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u5728\u5f53\u524d\u70b9$i$\uff0c\u9009\u53d6\u7684\u8d1d\u58f3\u4e00\u5b9a\u662f$s_i$\u3002\u5047\u8bbe\u4ece\u70b9$i$\u9009\u7684\u8d1d\u58f3$v_0\\neq v_i$\uff0c\u90a3\u4e48$k_i=k_{i-1}$\uff0c\u90a3\u6211\u4eec\u5728$i$\u5904\u9009\u62e9$v_0$\u8fd9\u79cd\u8d1d\u58f3\u548c\u5728$i-1$\u5904\u9009\u62e9\u8fd9\u79cd\u8d1d\u58f3\u8d21\u732e\u662f\u4e00\u6837\u7684\u3002\u5b8c\u5168\u53ef\u4ee5\u5728$i-1$\u5904\u9009\u62e9$v_0$\u8fd9\u79cd\u8d1d\u58f3\uff0c\u7136\u540e\u5728$i$\u5904\u72ec\u7acb\u4e3a\u4e00\u4e2a\uff0c\u8fd9\u6837\u8d21\u732e\u4f1a\u66f4\u5927\u3002\n\n\u65e2\u7136\u8fd9\u4e00\u6bb5\u7684\u6700\u540e\u662f$v_i$\uff0c\u90a3\u6211\u4eec\u4e5f\u80fd\u540c\u6837\u63a8\u7406\u51fa\uff0c\u8fd9\u4e00\u6bb5\u7684\u5f00\u5934\u4e5f\u5e94\u8be5\u662f$v_i$\u3002\u5047\u8bbe\u5f00\u5934\u4e0d\u662f$v_i$\uff0c\u90a3\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u628a\u5f00\u5934\u5f80\u540e\u79fb\u4e00\u4f4d\uff0c\u7136\u540e\u539f\u5f00\u5934\u72ec\u7acb\u4e3a\u4e00\u4e2a\u3002\u8fd9\u6837\u8d21\u732e\u4e5f\u4f1a\u66f4\u5927\u3002\n\n\u6240\u4ee5\u6211\u4eec\u4e00\u5f00\u59cb\u7528\u4e00\u4e2a\u6876\u7edf\u8ba1\u51fa\uff0c$[1,i]$\u4e2d\u4e3a$v_i$\u7684\u6709\u591a\u5c11\u4e2a\uff0c\u8bb0\u4e3a$s_i$\n\n\u8bbe$f_i$\u8868\u793a\u5230\u7b2c$i$\u4e2a\u8d1d\u58f3\u53d6\u5f97\u7684\u6700\u5927\u8d21\u732e\uff0c\u5219\n\n$\\displaystyle f_i=\\max\\limits_{1\\leq j\\leq i,s_j=s_i}\\{f_{j-1}+v_i(s_i-s_j+1)^2\\}$\n\n\u8fd9\u4e5f\u5c31\u8bf4\u660e\u4e86\uff0c\u4e0d\u540c\u989c\u8272\u4e4b\u95f4\u7684\u8f6c\u79fb\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0\uff08\u4ee3\u7801\u4e5f\u662f\u90a3\u4e48\u5199\u7684\uff09\uff0c\u6211\u4eec\u628a\u540c\u4e00\u79cd\u989c\u8272\u7684\u7684\u603c\u5230\u4e00\u4e2a$vector$\u91cc\u3002\u8bb0$g_j=f_{j-1}$\uff0c$col$\u4e3a\u8fd9\u4e00\u5806\u7684\u989c\u8272\u3002\u90a3\u4e48\u8f6c\u79fb\u6539\u5199\u4e3a\n\n$f_i=\\max\\limits_{1\\leq j\\leq i}\\{g_j+col(i-j+1)^2\\}$\n\n\u8fd9\u65f6\u5c31\u53ef\u4ee5\u5199\u51fa\u66b4\u529b\u7684\u4ee3\u7801\u4e86\uff08~~O2\u53ef\u8fc7~~\uff09\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <vector>\n#define ll long long\nusing namespace std;\nconst int N=1e5+10,M=1e4+10;\nstruct node\n{\n\tint p;\n\tint l,r;\n}que[N];\nint v;\nll f[N];\nvector<int>col[M];\ninline ll cal(int c,int j,int i)\n{\n\treturn f[col[c][j]-1]+(ll)c*(i-j+1)*(i-j+1);\n}\nint main()\n{\n\tint v,n;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&v);\n\t\tint len=col[v].size();\n\t\tif(len) \n\t\t{\n\t\t\tfor(int j=0;j<len;j++)\n\t\t\t\tf[i]=max(f[i],cal(v,j,len));\n\t\t}\n\t\tf[i]=max(f[i],f[i-1]+v);\n\t\tcol[v].push_back(i);\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\t\n} \n\n```\n\u770b\u5230$(i-j+1)^2$\u8003\u8651\u659c\u7387\u4f18\u5316\n\n\u8bbe\u51b3\u7b56$j,k$\uff0c$k$\u6bd4$j$\u66f4\u4f18\n\n\u90a3\u4e48\u6709$g_k+col(i-k+1)^2\\geq g_j+col(i-j+1)^2$\n\n\u5c55\u5f00\u5f97\uff1a$g_k-2col\\times i\\times k+col\\times k^2-2col\\times k\\geq g_j-2col\\times i\\times j+col\\times j^2-2col\\times j$\n\n\u8bbe$Y(j)=g_j+col\\times j^2-2col\\times j,X(j)=j$\n\n\u5f97\u5230\uff1a$\\displaystyle \\frac{Y(k)-Y(j)}{X(k)-X(j)}\\geq 2col\\times i$\n\n\u8fd9\u4e2a\u8f6c\u5316\u4e3a\u7ebf\u6027\u89c4\u5212\u6765\u7406\u89e3\u5c31\u662f\uff1a\n\n\u4e00\u6761\u659c\u7387\u4e3a$2col\\times i$\u7684\u76ee\u6807\u76f4\u7ebf\uff0c\u4ece\u4e0a\u5f80\u4e0b\u5207\u5230\u7684\u7b2c\u4e00\u4e2a\u70b9\u5c31\u662f\u6700\u4f18\u51b3\u7b56\u70b9\u3002\u6211\u4eec\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\uff0c\u4e5f\u5c31\u662f\u659c\u7387\u9012\u51cf\u7684\u51b3\u7b56\u70b9\u3002\n\n\u56e0\u4e3a$i$\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6240\u4ee5\u76ee\u6807\u76f4\u7ebf\u659c\u7387\u662f\u9012\u589e\u7684\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/5d8iavoi.png)\n\n\u8bbe\u5f53\u524d\u76ee\u6807\u76f4\u7ebf\u5bf9\u5e94\u7684\u662f\u7ea2\u7ebf\uff0c\u5b83\u5728\u70b9$3$\u53d6\u5f97\u6700\u4f18\u51b3\u7b56\uff0c\u90a3\u4e48\u5bf9\u4e8e$i'>i$\u5bf9\u5e94\u7684\u76ee\u6807\u76f4\u7ebf\u659c\u7387\u66f4\u5927\uff0c\u5bf9\u5e94\u6a59\u7ebf\u3002\u90a3\u4e48\u51b3\u7b56\u70b9$4$\u6c38\u8fdc\u4e0d\u53ef\u80fd\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\uff0c\u76f4\u63a5\u6254\u6389\u5c31\u597d\u4e86\u3002\u6ce8\u610f\u5230\u8fdb\u961f\u548c\u51fa\u961f\u90fd\u662f\u5728\u961f\u5c3e\u8fdb\u884c\u7684\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a\u6808\uff08\u5b9e\u73b0\u65f6\u53ef\u4ee5\u7528$vector$\uff09\u3002\n\n\u5177\u4f53\u6765\u8bf4\u5c31\u662f\uff1a\n\n1\u3001\u5bf9\u4e8e\u5f53\u524d\u76ee\u6807\u51fd\u6570\uff0c\u5982\u679c\u6808\u9876\u4fdd\u5b58\u7684\u659c\u7387\u5c0f\u4e8e$2col\\times i$\u5c31\u51fa\u6808\n\n2\u3001\u6808\u9876\u4fdd\u5b58\u7684\u5c31\u662f\u6700\u4f18\u51b3\u7b56\uff0c\u8ba1\u7b97\u51fa$f_i$\n\n3\u3001\u5982\u679c\u8fd9\u6761\u65b0\u7684\u76f4\u7ebf\u7684\u659c\u7387\u5927\u4e8e\u6808\u9876\u7684\u659c\u7387\uff0c\u6808\u9876\u51fa\u6808\u3002\n\n4\u3001\u63d2\u5165\u65b0\u7684\u76f4\u7ebf\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <vector>\n#define top sta[v].size()-1\n#define ll long long\nusing namespace std;\nconst int N=1e5+10,M=1e4+10;\nint v;\nll f[N];\nvector<int>col[M],sta[M];\ninline ll X(int c,int j){ return j; }\ninline ll Y(int c,int j){ return f[col[c][j]-1]+(ll)c*j*j-2*c*j; }\ninline ll cal(int c,int j,int i){ return f[col[c][j]-1]+(ll)c*(i-j+1)*(i-j+1); }\ninline double slope(int c,int j,int k){ return (double)(Y(c,k)-Y(c,j))/(double)(X(c,k)-X(c,j)); }\nint main()\n{\n\tint v,n;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=10000;i++)\n\t\tcol[i].push_back(0);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&v);\n\t\tint len=col[v].size();\n\t\tcol[v].push_back(i);\n\t\tif(len==1) sta[v].push_back(len);\n\t\telse\n\t\t{\n\t\t\twhile(sta[v].size()>1&&slope(v,sta[v][top-1],sta[v][top])<=2*v*len) sta[v].pop_back();\n\t\t\tf[i]=cal(v,sta[v][top],len);\n\t\t\twhile(sta[v].size()>1&&slope(v,sta[v][top-1],sta[v][top])<=slope(v,sta[v][top],len)) sta[v].pop_back();\n\t\t\tsta[v].push_back(len);\n\t\t}\n\t\tf[i]=max(f[i],f[i-1]+v);\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\t\n} \n```\n\n",
        "postTime": 1586522427,
        "uid": 81238,
        "name": "MCAdam",
        "ccfLevel": 7,
        "title": "P5504 [JSOI2011]\u67e0\u6aac"
    },
    {
        "content": "\uff08\u6bd5\u7adf\u662f\u7b2c\u4e00\u6b21\u505a\u5230\u7528\u5355\u8c03\u6808\u7684\u659c\u7387\u4f18\u5316\uff0c\u5c31\u5199\u7bc7\u9898\u89e3\u5427\uff09\n\n\u9996\u5148\uff0c\u663e\u7136\u5206\u6210\u7684\u6bcf\u6bb5\u4e24\u7aef\u70b9\u503c\u5e94\u8be5\u76f8\u7b49  \n\u56e0\u4e3a\u82e5\u4e0d\u76f8\u7b49\u5219\u5176\u4e2d\u5fc5\u6709\u4e00\u70b9\u5bf9\u5f53\u524d\u6bb5\u65e0\u8d21\u732e\uff0c\u5219\u653e\u5230\u522b\u7684\u6bb5\u4e2d\u663e\u7136\u66f4\u4f18\n\n\u8bbe$dp_i$\u8868\u793a\u524d$i$\u4e2a\u6570\u5206\u6210\u82e5\u5e72\u6bb5\u6240\u53d6\u5f97\u7684\u6700\u5927\u503c  \n\u5219\u6709\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n$$dp_i=\\max_{1\\le j\\le i,\\ a_i=a_j}\\{dp_{j-1}+a_i\\times(sum_i-sum_j+1)^2\\},sum_n=\\sum_{i=1}^n[a_i=a_n]$$\n\n\u62c6\u5f00+\u6574\u7406 \u5f97\uff1a\n\n$$dp_{j-1}+a_jsum_j^2=2a_jsum_j(sum_i+1)+dp_i-a_i(sum_i+1)^2$$\n\n\u5219\u4ee4\u51b3\u7b56\u70b9$y=dp_{j-1}+a_jsum_j^2,x=2a_jsum_j$\n\n\u53d1\u73b0\u6c42\u7684\u662f\u6700\u5927\u503c\uff0c\u4e14\u622a\u8ddd\u8d8a\u5927$dp_i$\u8d8a\u5927\uff0c\u5982\u56fe\uff0c\u65e0\u8bba\u659c\u7387\uff0c\u4e0b\u9762\u7684\u70b9\u6c38\u8fdc\u4e0d\u80fd\u4f18\u4e8e\u4e0a\u9762\u7684\uff0c**\u6b64\u65f6\u7ef4\u62a4\u4e0a\u51f8\u5305**\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/k9dj4gsx.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u53c8\u56e0\u4e3a$sum_i+1$\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u5982\u56fe\uff0c\u6700\u540e\u4e00\u6bb5\u659c\u7387\u5927\u4e8e$sum_i+1$\u65f6\uff0c\u53d6\u6700\u540e\u4e00\u4e2a\u70b9\uff0c\u5426\u5219\u5e94\u8be5\u9000\u5230\u524d\u9762\u72b6\u6001\uff0c\u5e76\u53ca\u65f6\u6392\u9664\u6700\u540e\u4e00\u6bb5\uff08\u659c\u7387\u5355\u8c03\u9012\u589e\uff0c\u6700\u540e\u4e00\u4e2a\u70b9\u4e0d\u53ef\u80fd\u518d\u6b21\u6bd4\u524d\u4e00\u4e2a\u70b9\u4f18\uff09\uff0c\u6b64\u65f6\u7ef4\u62a4\u4e00\u4e2a**\u5355\u8c03\u6808**\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/6dtrds6g.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n*10.10 \u4fee\u6539\u6253\u9519\u7684\u7b26\u53f7*\n\n**AC\u4ee3\u7801\uff1a**\n\n~~~c++\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<vector>\n#include<cmath>\n#include<map>\n#include<bitset>\n#include<set>\n#include<queue>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define dwn(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\ntypedef long long ll;\nint n,a[100010],sum[100010],l[10010];\nvector<int> st[10010];//vector\u6a21\u62df\u5355\u8c03\u6808\uff0c\u5f00\u6570\u7ec4\u5185\u5b58\u4e0d\u591f\nll dp[100010];\ninline int read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0'||ch>'9')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0'&&ch<='9')\n    {\n        x=(x<<3)+(x<<1)+(ch^48);\n        ch=getchar();\n    }\n    return x*f;\n}\ndouble slope(int x,int y)//\u6c42\u4e24\u51b3\u7b56\u70b9\u7684\u659c\u7387\n{\n    return (double)(dp[y-1]-dp[x-1]+(ll)a[y]*sum[y]*sum[y]-(ll)a[x]*sum[x]*sum[x])/(2*(a[y]*sum[y]-a[x]*sum[x]));\n}\nint main()\n{\n    n=read();\n    rep(i,1,n)\n    {\n        a[i]=read();\n        sum[i]=sum[l[a[i]]]+1;\n        l[a[i]]=i;\n    }\n    rep(i,1,n)\n    {\n        while(st[a[i]].size()>1&&slope(st[a[i]][st[a[i]].size()-1],st[a[i]][st[a[i]].size()-2])<=slope(st[a[i]][st[a[i]].size()-1],i)) st[a[i]].pop_back();\n        //\u786e\u4fdd\u5355\u8c03\u6808\u7ef4\u62a4\u7684\u662f\u4e0a\u51f8\u5305\n        st[a[i]].push_back(i);\n        while(st[a[i]].size()>1&&slope(st[a[i]][st[a[i]].size()-1],st[a[i]][st[a[i]].size()-2])<=sum[i]+1) st[a[i]].pop_back();\n        //\u628a\u6700\u540e\u51e0\u6bb5\u659c\u7387\u5c0f\u4e8esum[i]+1\u7684\u51b3\u7b56\u6392\u9664\n        dp[i]=dp[st[a[i]].back()-1]+(ll)a[i]*(sum[i]-sum[st[a[i]].back()]+1)*(sum[i]-sum[st[a[i]].back()]+1);\n    }\n    printf(\"%lld\\n\",dp[n]);\n    return 0;\n}\n~~~",
        "postTime": 1569412202,
        "uid": 128523,
        "name": "ZhuMingYang",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u6bb5\u957f\u5ea6\u4e3a$n$\u7684\u5e8f\u5217$a$\uff0c\u8981\u628a\u5b83\u5212\u5206\u6210\u8bb8\u591a\u6bb5\u3002\u5bf9\u4e8e\u6bcf\u4e00\u6bb5\uff0c\u9009\u51fa\u4e00\u4e2a\u6570$p$\uff0c\u82e5$p$\u5728\u8fd9\u6bb5\u5e8f\u5217\u4e2d\u51fa\u73b0$k$\u6b21\uff0c\u5219\u8fd9\u6bb5\u5e8f\u5217\u7684\u8d21\u732e\u4e3a$pk^2$\u3002\u6c42\u51fa\u6700\u5927\u8d21\u732e\u548c\u3002\n\n### \u9898\u89e3\n\n\u659c\u7387\u4f18\u5316\u597d\u9898\u3002~~\u4f46\u8fd9\u65e0\u6cd5\u63a9\u76d6\u6211\u7b2c\u4e00\u6b21\u5199\u659c\u7387\u4f18\u5316\u7684\u4e8b\u5b9e~~\n\n\u9996\u5148\u6709\u4e2a\u663e\u7136\u7684\u6027\u8d28\uff1a**\u6bcf\u4e00\u6bb5\u7684\u4e24\u7aef\u7684\u6570\u76f8\u540c**\u3002\n\n\u5982\u679c\u4e0d\u540c\u7684\u8bdd\uff0c\u90a3\u4e9b\u4e0d\u540c\u7684\u6570\u4e5f\u4e0d\u4f1a\u7ed9\u8fd9\u4e00\u6bb5\u6709\u8d21\u732e\uff0c\u53cd\u800c\u628a\u5b83\u4eec\u5206\u5230\u53e6\u5916\u7684\u6bb5\u53bb\u671f\u671b\u5bf9\u5176\u4ed6\u6bb5\u4ea7\u751f\u8d21\u732e\uff0c\u624d\u80fd\u4f7f\u8d21\u732e\u6700\u5927\u5316\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u8bbe$dp_i$\u8868\u793a\u524d\u9762$i$\u4e2a\u6570\u4ea7\u751f\u7684\u6700\u5927\u8d21\u732e\uff0c$c_i$\u8868\u793a\u8fd9\u4e2a\u6570\u662f\u7b2c\u51e0\u6b21\u51fa\u73b0\uff0c\u5219\u6709\n\n$$dp_i=\\max\\{dp_{j-1}+a_i\\times(c_i-c_j+1)^2\\}(i>j,a_i=a_j)$$\n\n\u53ef\u8fd9\u662f$O(n^2)$\u7684\uff0c\u8dd1\u4e0d\u8fc7,\u8003\u8651\u659c\u7387\u4f18\u5316\u3002\n\n\u89c2\u5bdf\u4e00\u4e0b\u539f\u6765\u7684\u5f0f\u5b50\uff0c\u628a\u4e0e$j$\u6709\u5173\u7684\u653e\u5230$y,x$\u9879\uff0c\u4e0e$j$\u65e0\u5173\u7684\u653e\u5230$k,b$\u9879\uff0c\u5219\u6709\n\n$$dp_i=dp_{j-1}+a_i\\times(c_i^2+(c_j-1)^2-2c_i(c_j-1))$$\n\n\u79fb\u9879\u4e4b\u540e\uff0c\u6709\n\n$$dp_{j-1}+a_i(c_j-1)^2=2a_ic_i(c_j-1)+dp_i-a_ic_i^2$$\n\n\u4e8e\u662f\uff0c\u6709\n\n$$\\begin{cases}y=dp_{j-1}+a_i(c_j-1)^2\\\\k=2c_i\\\\x=a_i(c_j-1)\\\\b=dp_i-a_ic_i^2\\end{cases}$$\n\n\u4e8e\u662f\u8003\u8651\u7528\u4e00\u4e2a\u5355\u8c03\u6808\u7ef4\u62a4$k$\u5c31\u884c\u5566qwq\n\n\u9996\u5148\uff0c\u5982\u679c\u6808\u9876\u7684\u659c\u7387\u6bd4\u65b0\u52a0\u8fdb\u6765\u7684\u659c\u7387\u5c0f\uff0c\u5c31\u4e00\u76f4\u5f39\u6808\u3002\n\n\u628a\u65b0\u52a0\u8fdb\u6765\u7684\u659c\u7387\u5165\u6808\u3002\n\n\u5982\u679c\u6808\u9876\u659c\u7387\u5c0f\u4e8e$2c_i$\uff0c\u5c31\u4e00\u76f4\u5f39\u6808\u3002\n\n\u6700\u540e\u53d6\u6808\u9876\u5c31\u53ef\u4ee5\u5566qwq\n\n### \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=1e5+51;\nvector<ll>q[MAXN>>3];\nll cnt,cur,top,tmp;\nli num[MAXN],occ[MAXN],st[MAXN],x[MAXN],y[MAXN],dp[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline double slope(ll xx,ll yy)\n{\n\treturn (double)(y[yy]-y[xx])/(double)(x[yy]-x[xx]);\n}\nint main()\n{\n\tcnt=read();\n\tfor(register int i=1;i<=cnt;i++)\n\t{\n\t\tnum[i]=read(),st[i]=++occ[num[i]];\n\t}\n\tfor(register int i=1;i<=cnt;i++)\n\t{\n\t\tcur=num[i],top=q[cur].size()-1;\n\t\tx[i]=(st[i]-1)*cur,y[i]=x[i]*(st[i]-1)+dp[i-1];\n\t\twhile(top>0&&slope(q[cur][top-1],q[cur][top])<slope(q[cur][top],i))\n\t\t{\n\t\t\tq[cur].pop_back(),top--;\n\t\t}\n\t\tq[cur].push_back(i),top++;\n\t\twhile(top>0&&slope(q[cur][top-1],q[cur][top])<2*st[i])\n\t\t{\n\t\t\tq[cur].pop_back(),top--;\n\t\t}\n\t\ttmp=q[cur][top];\n\t\tdp[i]=dp[tmp-1]+cur*(st[i]-st[tmp]+1)*(st[i]-st[tmp]+1);\n\t}\n\tprintf(\"%lld\",dp[cnt]);\n}\n```",
        "postTime": 1565575649,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a $n(n\\leq 10^5)$ \u7684\u5e8f\u5217\uff0c\u5c06\u5176\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6bcf\u6bb5\u9009\u62e9\u4e00\u4e2a\u6570\uff0c\u83b7\u5f97\u8fd9\u4e2a\u6570\u7684\u4ef7\u503c $\\times$ \u5b83\u5728\u8fd9\u6bb5\u51fa\u73b0\u6b21\u6570\u7684\u5e73\u65b9\uff0c\u6c42\u6700\u5927\u603b\u4ef7\u503c\u3002\n\n## \u505a\u6cd5\n\n\u5f15\u7406\uff1a\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a $i$\uff0c\u6240\u9009\u7684\u6700\u540e\u4e00\u6bb5\u6240\u6307\u5b9a\u7684 $s_0$ \u5b9a\u4e3a $s_i$\u3002\n\n\u8bc1\u660e\uff1a$i$ \u8fd9\u4e2a\u70b9\u4f1a\u5728 $s_0 \\not =s_i$ \u6ca1\u6709\u8d21\u732e\uff0c\u4e0d\u5982\u6700\u540e\u4e00\u6bb5\u53ea\u9009 $i$\u3002\n\n\u6240\u4ee5\u8003\u8651\u52a8\u6001\u89c4\u5212\uff0c\u4ee4 $f_i$ \u4e3a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u6700\u5927\u503c\uff0c$c_i$ \u4e3a\u51fa\u73b0\u6b21\u6570\u7684\u524d\u7f00\u548c\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_i=\\max_{j\\leq i \\wedge s_i=s_j} \\{f_{j-1}+s_i(c_i-c_{j}+1)^2\\}$$\n\n\u66b4\u529b\u6c42\u89e3\u662f $O\\left(n^2\\right)$ \u7684\uff0c\u53d1\u73b0 dp \u65b9\u7a0b\u4e2d\u5b58\u5728\u79ef\u7684\u5f62\u5f0f\uff0c\u8003\u8651\u659c\u7387\u4f18\u5316\u53ef\u5f97\uff1a\n\n$$f_i-s_i{c_i}^2=\\max_{j\\leq i \\wedge s_i=s_j} \\{f_{j-1}+s_i(c_{j}+1)^2-s_ic_i\\times 2(c_j-1)\\}$$\n\n\u4ee4 $y=f_i-s_i{c_i}^2$\uff0c$k=-s_ic_i$\uff0c$x=2(c_j-1)$\uff0c$b=f_{j-1}+s_i(c_{j}+1)^2$\uff0c\u53ef\u5f97\uff1a\n\n$$y=\\max_{j\\leq i \\wedge s_i=s_j} \\{kx+b\\}$$\n\n\u6b64\u5904 $k$\uff0c$x$ \u5355\u8c03\u9012\u589e\uff0c\u7ef4\u62a4\u4e0a\u51f8\u58f3\u4e8c\u5206\u67e5\u8be2\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\n## Code\n\n\u4e4b\u524d\u4e8c\u5206\u5199\u6210\u4e86 `r=mid-1` \u8c03\u4e86\u534a\u4e2a\u591a\u5c0f\u65f6\uff0c\u6211\u9178\u4e86....\n\n```cpp\n#pragma GCC optimize(2,3,\"Ofast\",\"unroll-loops\")\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define re register int\n#define db double\n#define in inline\nnamespace fast_io\n{\n    char buf[1<<12],*p1=buf,*p2=buf,sr[1<<23],z[23],nc;int C=-1,Z=0,Bi=0,ny;\n    in char gc() {return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<12,stdin),p1==p2)?EOF:*p1++;}\n    in ll read()\n    {\n        ll x=0;ny=1;while(nc=gc(),(nc<48||nc>57)&&nc!=EOF)if(nc==45)ny=-1;Bi=1;if(nc<0)return nc;\n        x=nc-48;while(nc=gc(),47<nc&&nc<58&&nc!=EOF)x=(x<<3)+(x<<1)+(nc^48),Bi++;return x*ny;\n    }\n    in db gf() {re a=read(),y=ny,b=(nc!='.')?0:read();return (b?a+(db)b/pow(10,Bi)*y:a);}\n    in int gs(char *s) {char c,*t=s;while(c=gc(),c<32);*s++=c;while(c=gc(),c>32)*s++=c;return s-t;}\n    in void ot() {fwrite(sr,1,C+1,stdout);C=-1;}\n    in void flush() {if(C>1<<22) ot();}\n    template <typename T>\n    in void write(T x,char t)\n    {\n        re y=0;if(x<0)y=1,x=-x;while(z[++Z]=x%10+48,x/=10);\n        if(y)z[++Z]='-';while(sr[++C]=z[Z],--Z);sr[++C]=t;flush();\n    }\n    in void write(char *s) {re l=strlen(s);for(re i=0;i<l;i++)sr[++C]=*s++;sr[++C]='\\n';flush();}\n};\nusing namespace fast_io;\nconst int N=1e5+5,M=1e4+5;\n#define q v[a[i]]\n#define push push_back\n#define pop pop_back\nint n,a[N],cnt[M],c[N];\nll f[N];\nvector<int>v[N];\nin ll sqr(ll x) {return x*x;}\nin ll slp(re i,re j,re k) \n{\n\tll xi=2*c[i],bi=f[i-1]+a[i]*sqr(c[i]);\n\tll xj=2*c[j],bj=f[j-1]+a[j]*sqr(c[j]),xk=2*c[k],bk=f[k-1]+a[k]*sqr(c[k]);\n\treturn ((xi-xj)*(bk-bj)-(bi-bj)*(xk-xj))>0;\n}\nin ll calc(re i,re x) {return f[x-1]+a[i]*sqr(c[i]-c[x]+1);}\nint main()\n{\n\tn=read();\n\tfor(re i=1,l,r,mid,t;i<=n;i++)\n\t{\n\t\ta[i]=read(),c[i]=(++cnt[a[i]])-1;\n\t\twhile((t=q.size()-1)>0&&slp(i,q[t],q[t-1])) q.pop();q.push(i);\n\t\tfor(l=0,r=q.size();mid=(l+r)>>1,l+1<r;) (calc(i,q[mid])>calc(i,q[mid-1]))?l=mid:r=mid;\n\t\tf[i]=calc(i,q[l]);\n\t}\n\twrite(f[n],'\\n');\n\treturn ot(),0;\n}\n//Author: disangan233\n//In my dream's scene,I can see the everything that in Cyaegha.\n```",
        "postTime": 1570719248,
        "uid": 72679,
        "name": "disangan233",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5504 \u3010[JSOI2011]\u67e0\u6aac\u3011"
    },
    {
        "content": "## \u8d34\u4e00\u53d1\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u505a\u6cd5awa\r\n\r\n\u770b\u674e\u8d85\u76f4\u63a5\u8df3\u5230\u7b2c\u4e09\u677f\u5757awa\u3002\r\n\r\n### 1\u3001\u9898\u610f\r\n\r\n\u901a\u8fc7\u777f\u667a\u7684\u5927\u8111\u601d\u8003\u53ef\u4ee5\u53d1\u73b0\uff0c\u6b64\u9898\u662f\u8f83\u4e3a\u5178\u578b\u7684 \u201c\u5206\u6bb5\u51b3\u7b56\u201d \u7c7b\u578b\u52a8\u6001\u89c4\u5212\uff0c\u6bcf\u4e00\u6bb5\u4ea7\u751f\u7684\u4ef7\u503c\u4e3a\u4efb\u9009\u4e00\u4e2a\u5927\u5c0f\u79cd\u7c7b\uff0c\u5176\u5927\u5c0f\u4e0e\u6b64\u79cd\u7c7b\u5728\u8be5\u6bb5\u4e2a\u6570\u7684\u5e73\u65b9\u4e4b\u79ef\u3002\r\n\r\n### 2\u3001\u63a8\u5f0f\u5b50\r\n\r\n\u6211\u4eec\u8bbe $dp[i]$ \u8868\u793a\u524di\u4e2a\u8d1d\u58f3\u6240\u80fd\u505a\u51fa\u7684\u6700\u5927\u8d21\u732e\u3002\r\n\r\n\u90a3\u4e48 $dp[i]$ \u53ef\u4ee5\u7531\u524d\u9762\u7684 $dp[j]+v(j+1,i)$ \u8f6c\u79fb\u800c\u6765,\r\n\r\n\u5176\u4e2d $v(j+1,i)$ \u8868\u793a $[j+1,i]$ \u8fd9\u8d1d\u58f3\u53ef\u4ea7\u751f\u7684\u6700\u5927\u4ef7\u503c\u3002(\u5373\u4e0a\u9762 $max$ \u90a3\u5768\u4e1c\u897f)\r\n\r\n\u4e3a\u4e86\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u65b9\u4fbf,\u6211\u4eec\u5c06\u4e0a\u9762\u4e00\u6b65\u7684\u64cd\u4f5c\u6539\u4e3a\"\u7531\u524d\u9762\u7684 $dp[j-1]+v(j+1,i)$ \"\u8f6c\u79fb\u800c\u6765\u3002\r\n\r\n\u6b64\u65f6,\u901a\u8fc7\u8d2a\u5fc3\u7684\u601d\u60f3\u53d1\u73b0\u53ea\u6709\u5f53 $i$ \u548c\u524d\u9762\u67d0\u4e2a\u8d1d\u58f3 $j$ \u989c\u8272\u4e00\u81f4\u65f6\u624d\u9700\u8981\u8f6c\u79fb,\u4e0d\u7136\u8d1d\u58f3 $i$ \u4e00\u70b9\u7528\u90fd\u6ca1\u6709,\u8fd8\u4e0d\u5982\u5355\u72ec\u4e00\u4e2a,\u8fd9\u6837\u8fd8\u80fd\u7b97\u4ed6\u4e00\u4efd\u4ef7\u503c\u3002\r\n\r\n\u4e8e\u662f\u53ef\u4ee5\u63a8\u51fa\u5f0f\u5b50:\r\n\r\n( $s[a[i]][j]$ \u8868\u793a $a[i]$ \u5927\u5c0f\u7684\u8d1d\u58f3\u5230\u4e86\u7b2c $j$ \u4e2a\u4f4d\u7f6e\u524d\u7f00\u4e2a\u6570)\r\n\r\n$dp[i]=max\\{ dp[j-1]+a[i]\\times (s[a[i]][i]-s[a[i]][j-1])^2 \\} $\r\n\r\n\r\n\u5176\u4e2d $j\u2208[1,i]$ \u4e14 $a[j]=a[i]$\u3002\r\n\r\n\u5904\u7406\u4e0a\u5f0f\u4e2d $max$ \u91cc\u9762\u7684\u4e1c\u897f\u53ef\u4ee5\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\u2014\u2014\r\n\r\n\u592a\u70e6\u4e86\uff0c\u7528 $x$ \u4ee3\u66ff $a[i]$ \uff1a\r\n\r\n$dp[j-1]+x\\times s[x][i]^2-2x\\times s[x][i]\\times s[x][j-1]+x\\times s[x][j-1]^2$\r\n\r\n\u56e0\u4e3a\u4e8b\u5b9e\u4e0a\u8d1d\u58f3\u5927\u5c0f\uff08 $x$ \uff09\u53ef\u4ee5\u76f4\u63a5\u5f53\u6210\u5e38\u6570\uff08\u53ef\u8f6c\u79fb\u7684\u51b3\u7b56\u7684\u4f4d\u7f6e\u4e0a\u8d1d\u58f3\u5927\u5c0f\u76f8\u540c\uff09\uff0c\u4e14 $x\\times s[x][i]^2$ \u4e5f\u53ef\u4ee5\u5f53\u6210\u5e38\u6570\uff0c\r\n\r\n\u800c\u5269\u4e0b\u7684 $2x\\times s[x][i]\\times s[x][j-1]$ \u548c $x\\times s[x][j-1]^2$ \u5206\u522b\u662f\u548c\u5f53\u524d\u4f4d\u7f6e\u4e0e\u4e4b\u524d\u51b3\u7b56\u90fd\u6709\u5173\u3001\u53ea\u548c\u4e4b\u524d\u51b3\u7b56\u6709\u5173\u7684\u9879\u3002\r\n\r\n\u4e8e\u662f\u5c31\u8f6c\u5316\u6210\u4e86\u674e\u8d85\u7ebf\u6bb5\u6811\u53ef\u4ee5\u89e3\u51b3\u7684\u7ecf\u5178\u95ee\u9898\u3002\r\n\r\n### 3\u3001\u674e\u8d85\u7ebf\u6bb5\u6811\r\n\r\n\u8fd9\u7bc7\u9898\u89e3\u9ed8\u8ba4\u5927\u5bb6\u90fd\u5b66\u8fc7\u674e\u8d85\u7ebf\u6bb5\u6811qwq\u3002\r\n\r\n[\u4e0d\u4f1a\u6233\u8fd9\u91cc\uff08\u674e\u8d85\u6a21\u677f\u9898\uff09](https://www.luogu.com.cn/problem/P4254)\r\n\r\n[\u8fd8\u6709\u8fd9\u91cc\uff0c\u975e\u5e38\u7ecf\u5178\u7684\u674e\u8d85\u4f18\u5316dp](https://www.luogu.com.cn/problem/P4655)\r\n\r\n\u63a5\u7740\u601d\u8003\u5982\u4f55\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u5b9e\u73b0\u8fd9\u4e2a\u8fc7\u7a0b\u3002\r\n\r\n\u9996\u5148\u4e0a\u9762\u7684 $s$ \u6570\u7ec4\u80af\u5b9a\u4e0d\u80fd\u7528\u4e8c\u7ef4\uff0c\u4f46\u662f\u7531\u4e8e\u9898\u76ee\u7684\u7279\u6b8a\u6027\uff0c\u5176\u5b9e\u65e0\u9700\u8bb0\u5f55\u6240\u6709\u4f4d\u7f6e\u7684\u524d\u7f00\u548c\uff0c\u5f00\u4e2a $10000$ \u5c31\u884c\u4e86\u3002\uff08\u770b\u4e00\u773c\u6211\u7684\u7a0b\u5e8f\u53ef\u4ee5\u5f88\u597d\u7406\u89e3\uff09\r\n\r\n\u7136\u540e\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e2a\u5927\u5c0f\u7684\u79cd\u7c7b\u90fd\u5f97\u5efa\u4e00\u68f5\u674e\u8d85\u7ebf\u6bb5\u6811\uff0c\u7531\u4e8e\u603b\u5171\u53ea\u6709 $n$ \u4e2a\u8d1d\u58f3\uff0c\u6240\u4ee5\u4e0d\u4f1a\u7206\u7a7a\u95f4\u3002\r\n\r\n\u63a5\u7740\u662f\u8981\u63d0\u524d\u628a\u9700\u8981\u67e5\u8be2\u7684x\u5750\u6807\uff08\u4e0a\u9762\u7684 $2x\\times s[x][i]$ \uff09\u79bb\u6563\u5316\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\r\n\r\n**\u7b80\u5355\u6765\u8bf4\uff0c\u8fd9\u9053\u9898\u7684\u674e\u8d85\u7ebf\u6bb5\u6811\u9700\u8981\u52a8\u6001\u5f00\u70b9\u548c\u79bb\u6563\u5316\u3002**\r\n\r\n### 4\u3001CODE\r\n\r\n\u4e5f\u4e0d\u662f\u5f88\u9ebb\u70e6\uff0c\u4f46\u662f\u5f88\u9ebb\u70e6\u3002\uff08\u662f\u6211\u592a\u7caa\u4e86qwq\uff09\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define int long long\r\n#define MAXN 100005\r\n#define MAXS 10005\r\nusing namespace std;\r\nint n,a[MAXN];\r\nint h[MAXS];\r\nvector<int>A[MAXS];\r\nint dp[MAXN];\r\n\r\nint rt[MAXS],tot;\r\nstruct Line{\r\n\tint b,k;\r\n\tbool flg;\r\n}tr[MAXN<<3];\r\nint calc(Line L,int x){\r\n\treturn L.k*x+L.b;\r\n}\r\nint ls[MAXN<<3],rs[MAXN<<3];\r\nint build(int l,int r,int opt){\r\n\tint now=++tot,mid=l+r>>1;\r\n\ttr[now]={0,0,0};\r\n\tif(l==r){\r\n\t\treturn now;\r\n\t}\r\n\tls[now]=build(l,mid,opt);\r\n\trs[now]=build(mid+1,r,opt);\r\n\treturn now;\r\n}\r\n#define pos_l A[opt][l-1]\r\n#define pos_r A[opt][r-1]\r\n#define pos_m A[opt][mid-1]\r\n//\u79bb\u6563\u5316\u7684\u9519\u8bef\u67e5\u4e86\u4e00\u4e2a\u665a\u4e0aqwq \r\nvoid modify(int now,int l,int r,Line x,int opt){\r\n\tif(!tr[now].flg){\r\n\t\ttr[now]=x;\r\n\t\treturn;\r\n\t}\r\n\tif(calc(x,pos_l)>calc(tr[now],pos_l)&&calc(x,pos_r)>calc(tr[now],pos_r)){\r\n\t\ttr[now]=x;\r\n\t\treturn;\r\n\t}\r\n\tif((calc(x,pos_l)>calc(tr[now],pos_l)) ^ (calc(x,pos_r)>calc(tr[now],pos_r))){\r\n\t\tint mid=l+r>>1;\r\n\t\tif(calc(x,pos_m)>calc(tr[now],pos_m)){\r\n\t\t\tswap(x,tr[now]);\r\n\t\t}\r\n\t\tif(calc(x,pos_l)>calc(tr[now],pos_l))\r\n\t\t\tmodify(ls[now],l,mid,x,opt);\r\n\t\telse\r\n\t\t\tmodify(rs[now],mid+1,r,x,opt);\r\n\t}\r\n}\r\nint query(int now,int l,int r,int x,int opt){\r\n\tif(l==r){\r\n\t\treturn tr[now].flg?calc(tr[now],x):0;\r\n\t}\r\n\tint mid=l+r>>1,res=tr[now].flg?calc(tr[now],x):0;\r\n\tif(x<=pos_m)res=max(res,query(ls[now],l,mid,x,opt));\r\n\telse res=max(res,query(rs[now],mid+1,r,x,opt));\r\n\treturn res;\r\n}//\u9664\u4e86\u79bb\u6563\u5316\u4e4b\u5916\u5c31\u662f\u674e\u8d85\u7ebf\u6bb5\u6811\u677f\u5b50\uff0c\u8fd9\u91cc\u4e0d\u591a\u8d58\u8ff0 \r\nsigned main(){\r\n\tscanf(\"%lld\",&n);\r\n\tfor(int i=1;i<=n;++i){\r\n\t\tscanf(\"%lld\",&a[i]);\r\n\t\t++h[a[i]];\r\n\t\tA[a[i]].push_back((a[i]<<1)*h[a[i]]);\r\n\t\t//\u79bb\u6563\u5316\u8981\u67e5\u8be2\u7684\u4f4d\u7f6e \r\n\t}\r\n\tfor(int i=1;i<=10000;++i){\r\n\t\tif(A[i].size()){\r\n\t\t\tsort(A[i].begin(),A[i].end());\r\n\t\t\trt[i]=build(1,A[i].size(),i);\r\n\t\t\t//\u6bcf\u4e2a\u5927\u5c0f\u79cd\u7c7b\u5efa\u4e00\u68f5\u6811 \r\n\t\t}\r\n\t}\r\n\tmemset(h,0,sizeof h);\r\n   //\u975e\u5e38\u5931\u8d25\u7684\u5199\u6cd5qwq\r\n\tfor(int i=1;i<=n;++i){\r\n\t\t++h[a[i]];\r\n\t\tLine t1={dp[i-1]+a[i]*(h[a[i]]-1)*(h[a[i]]-1),1-h[a[i]],1};\r\n\t\tmodify(rt[a[i]],1,A[a[i]].size(),t1,a[i]);\r\n\t\tdp[i]=query(rt[a[i]],1,A[a[i]].size(),(a[i]<<1)*h[a[i]],a[i]);\r\n\t\tdp[i]+=a[i]*h[a[i]]*h[a[i]];\r\n\t}\r\n\tprintf(\"%lld\",dp[n]);\r\n\treturn 0;\r\n}\r\n/*\r\n6\r\n1 1 4 5 1 4\r\n\r\n20\r\n*/\r\n```\r\n\r\n\u611f\u8c22\u5927\u5bb6\u770b\u5230\u6700\u540e\uff01(* *\u2579\u25bd\u2579* *)\r\n",
        "postTime": 1684327283,
        "uid": 90971,
        "name": "\u667a\u5b50\u00b7\u8d77\u6e90",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5504 [JSOI2011] \u67e0\u6aac \u9898\u89e3"
    }
]