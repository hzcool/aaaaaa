[
    {
        "content": "\u611f\u89c9\u5728\u54ea\u89c1\u8fc7\u539f\u9898\u3002\u3002\u3002\n\n\u611f\u6027\u4e00\u4e0b\u8fd9\u4e2a\u9650\u5236\u6761\u4ef6\uff0c\u53d1\u73b0\u5c31\u662f\u8981\u6c42\u8fd9\u4e2a\u8054\u901a\u5757\u662f\u4e2a\u51f8\u591a\u8fb9\u5f62\u7684\u5f62\u72b6\u3002\n\n\u7531\u4e8e\u662f\u4e2a\u7f51\u683c\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4ece\u4e0a\u5f80\u4e0b\uff0c\u5de6\u7aef\u70b9\u5148\u51cf\u540e\u589e\uff0c\u53f3\u7aef\u70b9\u5148\u589e\u540e\u51cf\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5355\u589e\u6216\u5355\u51cf\u3002\n\n\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u72b6\u6001 $\\large f_{i,l,r,0/1,0/1}$ \u8868\u793a\u7b2c $i$ \u7ed3\u5c3e\uff0c\u7b2c $i$ \u884c\u586b\u4e86 $[l,r]$ \u7684\u683c\u5b50\uff0c\u5de6\u8fb9\u5904\u4e8e\u589e/\u51cf\u72b6\u6001\uff0c\u53f3\u8fb9\u5904\u4e8e\u589e/\u51cf\u72b6\u6001\u7684\u65b9\u6848\u6570\u3002\n\n\u679a\u4e3e\u524d\u9762\u4e00\u884c\u586b\u7684\u683c\u5b50\uff0c\u6211\u4eec\u4e0d\u96be\u5f97\u5230\u4e00\u4e2a $\\rm O(N^5)$  \u7684\u89e3\u6cd5\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 155\nusing namespace std;\nint n,u[N],f[N][N][N][2][2];char s[N];\nint main(){\n\tscanf(\"%d\",&n);int ans=0;\n\trep(i,1,n){\n\t\tscanf(\"%s\",s+1);\n\t\trep(j,1,n)u[j]=u[j-1]+(s[j]=='G');\n\t\tpre(l,n,1)rep(r,l,n)if(u[r]-u[l-1]==r-l+1){\n\t\t\tf[i][l][r][0][0]=1;\n\t\t\tpre(x,n,1)rep(y,x,n){\n\t\t\t\tif(x>=l&&y<=r)f[i][l][r][0][0]+=f[i-1][x][y][0][0];\n\t\t\t\tif(x>=l&&x<=r&&y>r)f[i][l][r][0][1]+=f[i-1][x][y][0][0];\n\t\t\t\tif(x>=l&&x<=r&&y>=r)f[i][l][r][0][1]+=f[i-1][x][y][0][1];\n\t\t\t\tif(y>=l&&y<=r&&x<l)f[i][l][r][1][0]+=f[i-1][x][y][0][0];\n\t\t\t\tif(y>=l&&y<=r&&x<=l)f[i][l][r][1][0]+=f[i-1][x][y][1][0];\n\t\t\t\tif(x<=l&&y>=r)f[i][l][r][1][1]+=f[i-1][x][y][1][1];\n\t\t\t\tif(x<l&&y>=r)f[i][l][r][1][1]+=f[i-1][x][y][0][1];\n\t\t\t\tif(x<=l&&y>r)f[i][l][r][1][1]+=f[i-1][x][y][1][0];\n\t\t\t\tif(x<l&&y>r)f[i][l][r][1][1]+=f[i-1][x][y][0][0];\n\t\t\t}\n\t\t\trep(x,0,1)rep(y,0,1)ans+=f[i][l][r][x][y];\n\t\t}\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n\u89c2\u5bdf\u4e00\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u628a $f$ \u6570\u7ec4\u5199\u6210\u4e00\u4e2a\u77e9\u9635\uff0c\u5219\u6bcf\u6b21\u8f6c\u79fb\u52a0\u4e0a\u7684\u4e00\u5b9a\u662f $f[i-1]$ \u7684\u4e00\u4e2a\u5b50\u77e9\u9635\u4e4b\u548c\uff01\n\n\u5927\u529b\u4e8c\u7ef4\u524d\u7f00\u548c\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$\\rm O(N^3)$\u3002\n\n\u4f5c\u4e3a USACO P\u7ec4\u6700\u540e\u4e00\u9898\u8c8c\u4f3c\u7b80\u5355\u4e86\u4e00\u70b9\uff1f\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 155\n#define P 1000000007\nusing namespace std;\nint n,u[N],f[N][N][N][2][2],g[N][N][N][2][2];char s[N];\nint w(int i,int x,int y,int p,int q,int l,int r){\n\treturn (((g[i][y][q][l][r]-g[i][x-1][q][l][r])%P-g[i][y][p-1][l][r])%P+g[i][x-1][p-1][l][r])%P;\n}\nint main(){\n\tscanf(\"%d\",&n);int ans=0;\n\trep(i,1,n){\n\t\tscanf(\"%s\",s+1);\n\t\trep(j,1,n)u[j]=u[j-1]+(s[j]=='G');\n\t\tpre(l,n,1)rep(r,l,n)if(u[r]-u[l-1]==r-l+1){\n\t\t\tf[i][l][r][0][0]=1+w(i-1,l,r,l,r,0,0);\n\t\t\tf[i][l][r][0][1]=(w(i-1,l,r,r+1,n,0,0)+w(i-1,l,r,r,n,0,1))%P;\n\t\t\tf[i][l][r][1][0]=(w(i-1,1,l-1,l,r,0,0)+w(i-1,1,l,l,r,1,0))%P;\n\t\t\tf[i][l][r][1][1]=((w(i-1,1,l,r,n,1,1)+w(i-1,1,l-1,r+1,n,0,0))%P+\n\t\t\t\t\t\t\t  (w(i-1,1,l-1,r,n,0,1)+w(i-1,1,l,r+1,n,1,0))%P)%P;\n\t\t\trep(x,0,1)rep(y,0,1)(ans+=f[i][l][r][x][y])%=P;\n\t\t}\n\t\trep(p,0,1)rep(q,0,1)rep(x,1,n)rep(y,1,n)\n\t\t\tg[i][x][y][p][q]=(((g[i][x-1][y][p][q]+g[i][x][y-1][p][q])%P-g[i][x-1][y-1][p][q])%P+f[i][x][y][p][q])%P;\n\t}\n\tprintf(\"%d\\n\",(ans+P)%P);\n\treturn 0;\n}\n```",
        "postTime": 1619660534,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011P7532 [USACO21OPEN] Balanced Subsets P"
    }
]