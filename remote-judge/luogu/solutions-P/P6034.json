[
    {
        "content": "\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u770b\u5230 $\\text{xor,and,or},+,-$ \u7b49\u7b49\u6bd2\u7624\u8fd0\u7b97\u7ed3\u5408\u7684\u65f6\u5019\uff0c\u4e0b\u9762\u8fd9\u4e2a\u6362\u5143\u90fd\u4f1a\u975e\u5e38\u6709\u6548\uff1a\n\n\u8bbe $y=a\\;\\text{and}\\;b$\uff0c$a=x+y$\uff0c$b=y+z$\uff0c\u5219 $a\\;\\text{or}\\;b=x+y+z$\uff0c$a\\;\\text{xor}\\;b=x+z$\u3002\n\n\u6bd4\u5982\u672c\u9898\uff0c\u91c7\u7528\u4ee5\u4e0a\u6362\u5143\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff1a$x+z|(y+z)-(x+y)$\uff0c\u5373 $x+z|z-x$\u3002\n\n\u7531\u4e8e $z+x\\ge z-x>0$\uff0c\u6240\u4ee5 $x=0$\uff0c\u5373 $a$ \u7684\u4e8c\u8fdb\u5236\u4f4d\u88ab $b$ \u7684\u4e8c\u8fdb\u5236\u4f4d\u5b8c\u5168\u5305\u542b\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u679a\u4e3e $b$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $b$\uff0c\u5f88\u663e\u7136\u6709 $2^{f(b)}-1$ \u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684 $a$\uff0c\u5176\u4e2d $f(b)$ \u8868\u793a $b$ \u5728\u4e8c\u8fdb\u5236\u4e0b\u4e3a $1$ \u7684\u4f4d\u7684\u4e2a\u6570\u3002\n\n\u6240\u4ee5\u7b54\u6848\u4e3a $\\sum\\limits_{i=1}^n(2^{f(i)})-n$\u3002\n\n\u8bb0 $s(n)=\\sum\\limits_{i=1}^n2^{f(i)}$\u3002\n\n$f(n)$ \u663e\u7136\u662f\u53ef\u4ee5 $O(\\log n)$ \u6c42\u7684\uff1a\uff08`ll`\u4ee3\u8868`long long`\uff0c\u540e\u9762\u540c\u7406\uff09\n\n```cpp\ninline ll f(ll n){if(!n)return 0;return f(n>>1)+n&1;}\n```\n\n\u5373\uff0c$f(2n+1)=f(n)+1,f(2n)=f(n)$\u3002\n\n\uff08\u4ee3\u7801\u4e2d\u6211\u4f7f\u7528\u4e86\u53e6\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff09\n\n\u7531\u4e8e\u6211\u4eec\u6709\uff1a\n\n$$\\begin{aligned}s(2n)&=\\sum_{i=1}^{2n}2^{f(i)}\\\\&=\\sum_{i=1}^n2^{f(2i-1)}+\\sum_{i=1}^n2^{f(2i)}\\\\&=\\sum_{i=1}^n2^{f(i-1)+1}+\\sum_{i=1}^n2^{f(i)}\\\\&=2(1+\\sum_{i=1}^{n-1}2^{f(i)})+\\sum_{i=1}^n2^{f(i)}\\\\&=2+2s(n-1)+s(n)\\\\&=3s(n-1)+2^{f(n)}+2\\end{aligned}$$\n\n\u56e0\u6b64\u6211\u4eec\u5c31\u53ef\u4ee5\u9012\u5f52/\u500d\u589e\u6c42 $s(n)$ \u4e86\u3002\u6700\u540e\u51cf\u53bb $n$ \u5373\u53ef\u3002\n\n$\\texttt{code:}$\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<fstream>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n#define Set(a) memset(a,0,sizeof(a))\n#define F(i,a,b) for(register int i=a,i##end=b;i<=i##end;++i)\n#define UF(i,a,b) for(register int i=a,i##end=b;i>=i##end;--i)\n#define openf(a) freopen(#a\".in\",\"r\",stdin);freopen(#a\".out\",\"w\",stdout)\n#define re register\n#define ri re int\n#define il inline\ntypedef long long ll;\ntypedef unsigned long long ull;\ntemplate<typename T> inline T rd(T& x)\n{\n\tT f=1;x=0;char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(; isdigit(c);c=getchar()) x=(x<<3)+(x<<1)+(T)(c-'0');\n\tx*=f;\n\treturn x;\n}\nll rd(){ll x;rd(x);return x;}\ninline int max(int a,int b){return a>b?a:b;}\ninline int min(int a,int b){return a<b?a:b;}\nconst int inf=1<<30;\n\nconst ll p=1000000007;\nll p2[70];\nll mod(ll t){return t>=p?t-p:t;}\nint bitc(ll x){int ans=0;while(x)x&=x-1,++ans;return ans;}\nll f(ll n){return p2[bitc(n)];}\nll sum(ll n)\n{\n\tif(n==0) return 0;\n\tif(n&1) return mod(sum(n^1)+f(n));\n\tll t=sum((n>>1)-1);\n\treturn (3*t+f(n>>1)+2)%p;\n}\nint main()\n{\n\tp2[0]=1;F(i,1,64) p2[i]=mod(2*p2[i-1]);\n\tll n;\n\tcin>>n;\n\tcout<<((sum(n)-n)%p+p)%p<<endl;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1580471001,
        "uid": 130151,
        "name": "WYXkk",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6034 \u3010Ryoku \u4e0e\u6700\u521d\u4e4b\u4eba\u7b14\u8bb0\u3011"
    },
    {
        "content": "# \u5bfc\u8a00\n\n\u56e0\u4e3a\u8fd9\u9898\u6ca1\u505a\u51fa\u6765\u8fd9\u573a\u6bd4\u8d5b\u6211 $360$\u2026\u2026\uff08\u5dee\u4e00\u70b9\u5c31 $AK$ \u4e86\u2026\u2026\uff09\n\n\u5176\u5b9e\u6b63\u89e3\u4e0d\u96be\u60f3\uff0c\u800c\u66b4\u529b\u66f4\u597d\u60f3\u3002\u56e0\u6b64\u4e0b\u9762\u4f1a\u7ed9\u51fa\u4e24\u79cd\u89e3\u9898\u7684\u601d\u8def\u3002\n\n\u4e5f\u611f\u8c22\u5927\u5bb6\u80fd\u591f\u8010\u5fc3\u5730\u9605\u8bfb\u5b8c\u6211\u7684\u8fd9\u7bc7\u9898\u89e3\u3002\n\n\u58f0\u660e\uff1a\u82e5\u8981\u8f6c\u8f7d\u6b64\u6587\u6216\u90e8\u5206\u5185\u5bb9\uff0c\u8bf7\u6ce8\u660e\u51fa\u5904\u3002\u8c22\u8c22\u5408\u4f5c\u3002\n\n# \u89e3\u6cd5 1\n\n\u8003\u573a\u4e0a\u5565\u90fd\u60f3\u4e0d\u51fa\u6765\u2026\u2026\uff08~~\u662f\u6211\u8822\u4e86~~\uff09\u548b\u529e\u5462\uff1f\n\n\u6253\u4e2a\u66b4\u529b\uff01\u66b4\u529b\u8ba1\u7b97\u662f $O(n^2)$ \u7684\uff0c\u53ef\u4ee5\u62ff\u5230 $20pts$\u3002\n\n\u66b4\u529b\u6253\u5b8c\u4e86\u53ef\u4e0d\u80fd\u5750\u4ee5\u5f85\u6bd9\u554a\uff0c\u4e8e\u662f\u5f00\u59cb\u627e\u89c4\u5f8b\uff0c\u6211\u53d1\u73b0\u8fd9\u4e2a\u6570\u5217\u5728\u67d0\u7f51\u7ad9\u6709\u6536\u5f55\uff0c\u4f46\u90fd\u662f\u82f1\u6587\uff0c\u800c\u4e14\u6ca1\u6709\u901a\u5f0f\u3002\uff08\u8fd9\u4e0b\u5b8c\u4e86\uff0c\u8fde $60pts$ \u90fd\u8981\u6ca1\u4e86\uff1f\uff09\n\n\u4e0d\uff01\u6709\u7684\u65f6\u5019\u539f\u5e8f\u5217\u6ca1\u6709\u89c4\u5f8b\uff0c\u4e0d\u59a8\u6362\u6210 **\u5dee\u5206** \u6570\u5217\u3002\n\n\u6211\u4eec\u5bf9 $n=1\u202620$ \u8fdb\u884c\u4e00\u4e0b\u5dee\u5206\uff0c\u5f97\u5230\uff1a\n\n~~~\n(0) 1 1 3 1 3 3 7 1 3 3 7 3 7 7 15 1 3 3 7 3\n~~~\n\n\u5982\u679c\u80fd $O(N)$ \u6c42\u51fa\u5dee\u5206\u6570\u7ec4\uff0c\u5c31\u53ef\u4ee5 $O(N)$ \u6c42\u51fa\u7b54\u6848\u3002\u5b9a\u4e49\u5dee\u5206\u6570\u7ec4\u4e3a $b$\u3002\n\n\u4e4d\u4e00\u770b\u6ca1\u4ec0\u4e48\u89c4\u5f8b\uff0c\u4f46\u6709\u4e9b\u6570\u5b57\u76f8\u7b49\uff0c\u6709\u4e9b\u6570\u5b57\u662f\u201c\u4e58\u4e8c\u52a0\u4e00\u201d\u7684\u5173\u7cfb\uff1f\u770b\u770b\u6709\u6ca1\u6709\u89c4\u5f8b\u3002\u53d1\u73b0\u76f8\u90bb\u7684\u6ca1\u6709\u89c4\u5f8b\uff0c\u53c8\u8003\u8651\u5230\u6570\u636e\u8303\u56f4\u662f $log$ \u7684\uff0c\u6240\u4ee5\u770b\u770b\u201c\u9664\u4e8c\u201d\u4e4b\u7c7b\u3002\u679c\u4e0d\u5176\u7136\uff0c\u5c31\u8ba9\u6211\u4eec\u627e\u5230\u4e86\uff1a\n\n$$b_i=\\begin{cases}0&i=0\\\\b_{\\frac{i}{2}}& i\\text{ \u4e3a\u5076\u6570}\\\\ 2\u00d7b_{\\frac{i}{2}}+1&i\\text{ \u4e3a\u5947\u6570}\\end{cases}$$\n\n\uff08\u4e0a\u9762\u7684\u9664\u6cd5\u9ed8\u8ba4\u5411\u4e0b\u53d6\u6574\uff09\n\n\u6709\u4e86\u8fd9\u4e2a\u9012\u63a8\u5f0f\u6211\u4eec\u5c31\u53ef\u4ee5 $O(N)$ \u6c42\u51fa $b$ \u6570\u7ec4\uff0c\u6700\u7ec8\u7684\u7b54\u6848\u5373\u4e3a\uff1a\n\n$$ans=\\sum_{i=1}^{n}b_i$$\n\n\u8fd9\u4e2a\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\u8fd9\u6837\u53ef\u4ee5\u62ff\u5230 $60pts$\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u4f18\u5316\u3002\uff08$70pts$ \u5206\u6bb5\u6253\u8868\u5373\u53ef\uff09\n\n\u56e0\u4e3a\u539f\u6570\u7ec4\u53ef\u4ee5\u901a\u8fc7\u5dee\u5206\u6570\u7ec4\u8fd8\u539f\uff0c\u4ee4\u539f\u6570\u7ec4\u4e3a $S$\u3002\uff08\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\u5dee\u5206\u6570\u7ec4\u662f $n=1,2\u2026$ \u5bf9\u5e94\u7b54\u6848\u7684\u5dee\u5206\u6570\u7ec4\uff0c\u6240\u4ee5 $S$ \u5373\u4e3a\u7b54\u6848\u6570\u7ec4\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a $S_n$\uff09\n\n**\u4e0b\u9762\u7684\u9664\u6cd5\u9ed8\u8ba4\u5411\u4e0b\u53d6\u6574\u3002**\n\n\u5148\u5c06\u4e0a\u9762\u6c42 $b$ \u7684\u5f0f\u5b50\u53d8\u5f62\u4e00\u4e0b\uff1a\n\n$$\\begin{cases}b_0=0\\\\b_{2i}=b_i\\\\b_{2i+1}=2b_i+1\\end{cases}$$\n\n\u90a3\u4e48\u8003\u8651\uff0c\u5f53 $n$ \u4e3a\u5076\u6570\u7684\u65f6\u5019\uff1a\n\n$$S_n=\\sum_{i=1}^{n}b_i=\\sum_{i=1}^{n/2}b_{2i-1}+\\sum_{i=1}^{n/2}b_{2i}$$\n\n\u4e0a\u9762\u7684\u53d8\u6362\u662f\u5bf9 $b$ \u6570\u7ec4\u8fdb\u884c\u5947\u5076\u5206\u7c7b\uff0c\u7136\u540e\u6211\u4eec\u53d1\u73b0 $b$ \u6570\u7ec4\u5df2\u7ecf\u51fa\u73b0\u4e86\u5f0f\u5b50\uff0c\u518d\u6b21\u5957\u7528\u4e0a\u9762 $b$ \u6570\u7ec4\u7684\u9012\u63a8\u5f0f\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$S_n=\\sum_{i=1}^{n/2}(2b_{i-1}+1)+\\sum_{i=1}^{n/2}b_{i}=\\frac{n}{2}+\\sum_{i=0}^{n/2-1}2b_{i}+\\sum_{i=1}^{n/2}b_{i}$$\n\n\u56e0\u4e3a $b_0=0$\uff0c\u56e0\u6b64\u53c8\u53ef\u4ee5\u518d\u6b21\u53d8\u6362\uff1a\n\n$$S_n=n+2\\sum_{i=1}^{n/2-1}b_{i}+\\sum_{i=1}^{n/2}b_{i}=2S_{\\frac{n}{2}-1}+S_{\\frac{n}{2}}+\\frac{n}{2}$$\n\n\u56e0\u6b64\u6211\u4eec\u5f97\u5230\u4e86\u5076\u6570\u7684 $S$ \u9012\u5f52\u5f0f\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651 $n$ \u4e3a\u5947\u6570\u3002 $n$ \u4e3a\u5947\u6570\u65f6\u552f\u4e00\u4e0d\u540c\u7684\u662f\u8fd8\u8981\u8ba1\u7b97\u4e0a $n$\uff0c\u56e0\u4e3a\u4e0a\u9762\u7684\u8ba1\u7b97\u65b9\u6cd5\u4f1a\u5ffd\u7565\u6389 $n$ \u8fd9\u4e2a\u5947\u6570\u3002\uff08\u53ef\u4ee5\u89c2\u5bdf\u4e00\u4e0b\u5947\u6570\u90e8\u5206\uff0c\u5de6\u8fb9\u7684\u548c\u5f0f\uff09\n\n\u6240\u4ee5\u91cd\u65b0\u5217\u5f0f\uff1a\n\n$$S_n=\\sum_{i=0}^{n/2}b_{2i+1}+\\sum_{i=1}^{n/2}b_{2i}$$\n\n\uff08\u56e0\u4e3a\u4e0e\u4e0a\u9762\u53d8\u6362\u7c7b\u4f3c\u6211\u5c31\u4e0d\u591a\u5217\u4e00\u4e2a\u5f0f\u5b50\u4e86\uff09\n\n\u4f60\u4f1a\u53d1\u73b0\u6211\u4eec\u5de6\u8fb9\u7684\u548c\u5f0f\u53d8\u6362\u4e86\u4e00\u4e0b\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8003\u8651\u5230 $n$ \u4e5f\u4e3a\u5947\u6570\u3002\n\n\u53c8\u56e0\u4e3a\u5f53 $n=1$ \u65f6\uff0c\u4e5f\u5373 $i=0,2i+1=1$\uff0c$S_n=1$\uff08\u6253\u8868\u53ef\u4ee5\u8ba1\u7b97\uff0c\u624b\u7b97\u4e5f\u53ef\u4ee5\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u5de6\u8fb9\u7684\u548c\u5f0f\u4e0b\u754c $i$ \u4ece $0$ \u53d8\u4e3a $1$\uff0c\u7136\u540e\u6574\u4e2a\u5f0f\u5b50\u52a0\u4e00\uff1a\n\n$$S_n=1+\\sum_{i=1}^{n/2}b_{2i+1}+\\sum_{i=1}^{n/2}b_{i}$$\n\n\uff08\u56e0\u4e3a\u5f88\u591a\u90e8\u5206\u548c\u4e0a\u9762\u76f8\u540c\u8fd9\u8fb9\u76f4\u63a5\u5316\u5f00\uff09\n\n\u7ee7\u7eed\uff1a\n\n$$S_n=1+\\sum_{i=1}^{n/2}(2b_{i}+1)+S_{\\frac{n}{2}}=3S_{\\frac{n}{2}}+\\frac{n}{2}+1$$\n\n\uff08\u5df2\u7ecf\u8bf4\u8fc7\u9664\u6cd5\u9ed8\u8ba4\u4e0b\u53d6\u6574\uff09\n\n\u73b0\u5728 $n$ \u7684\u60c5\u51b5\u5df2\u7ecf\u8ba8\u8bba\u5b8c\u4e86\uff0c\u9898\u76ee\u4e5f\u89e3\u51b3\u4e86\u3002\n\n\u91cd\u65b0\u6574\u7406\u4e00\u4e0b\u4e0a\u9762\u7684\u5f0f\u5b50\uff1a\uff08\u636e\u9898\u76ee\u7684\u5f0f\u5b50\u77e5\u9053 $S_0=0$\uff09\n\n$$S_n=\\begin{cases}0&n=0\\\\2S_{\\frac{n}{2}-1}+S_{\\frac{n}{2}}+\\frac{n}{2}&n\\text{ \u4e3a\u5076\u6570}\\\\3S_{\\frac{n}{2}}+\\frac{n}{2}+1&n\\text{ \u4e3a\u5947\u6570}\\end{cases}$$\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u9012\u5f52\u6c42\u51fa $S_n$\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\text{log }n)$\u3002 \u8bb0\u5f97\u8bb0\u5fc6\u5316\uff0c\u4e0d\u7136\u4f1a\u91cd\u590d\u7b97\u5f88\u591a\uff0c\u5982\u679c\u61d2\u5f97\u624b\u5199 $Hash$ \u8868\uff0c\u5c31\u7528 $map$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\text{log}^2n)$\u3002\n\n\uff08\u5f53\u65f6\u6211\u591a\u4e48\u8822\uff0c\u5c31\u63a8\u4e2a\u5f0f\u5b50\u7adf\u7136\u6ca1\u60f3\u5230\u2026\u2026\uff09\n\n# \u89e3\u6cd5 2\n\n\u8003\u8651\u628a\u539f\u6765\u7684\u5f0f\u5b50\u53d8\u5f62\u4e00\u4e0b\uff0c\u56e0\u4e3a $a<b$\uff0c\u6240\u4ee5\u539f\u6765\u7684\u5f0f\u5b50\u76f8\u5f53\u4e8e\uff1a\n\n$$\\sum_{a=0}^{n}\\sum_{b=a+1}^{n}[ \\ b\\text{ xor }a\\mid b-a\\ ]$$\n\n\u56e0\u4e3a\u5f02\u6216\u76f8\u5f53\u4e8e\u4e0d\u9000\u4f4d\u7684\u51cf\u6cd5\uff0c\u6240\u4ee5\u5728\u4e8c\u8fdb\u5236\u4e0b\u6a21\u62df\u5373\u53ef\u53d1\u73b0\uff1a\n\n$$b\\text{ xor }a\u2265b-a$$\n\n\u6240\u4ee5\u4e0a\u5f0f\u7684\u4e3b\u4f53\u90e8\u5206\u5373 $[ \\ b\\text{ xor }a=b-a \\ ]$\u3002\n\n\u5728\u4e8c\u8fdb\u5236\u4e0b\uff0c\u53d1\u73b0 $a$ \u4e2d\u4e3a $1$ \u7684\u4f4d\u5728 $b$ \u4e2d\u4e00\u5b9a\u8981\u4e3a $1$\uff0c\u901a\u8fc7\u679a\u4e3e $b$\uff0c\u5229\u7528\u7ec4\u5408\u6570\u5b66\u5373\u53ef\u8ba1\u7b97\u3002\u8ba1\u7b97\u65b9\u6cd5\u5c31\u662f\uff1a\u5047\u8bbe $i$ \u4e2d\u6709 $f(i)$ \u4f4d\u662f $1$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u53d6\u5176\u4e2d\u7684 $1$ \u4f4d\uff0c\u65b9\u6848\u5373 $C_{f(i)}^1$\uff0c\u540c\u7406\u53d6 $2$ \u4f4d\u7684\u65b9\u6848\u662f $C_{f(i)}^2$\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u8fd9\u6837\u679a\u4e3e\u7684\u65b9\u6848\u5c31\u662f\u6ee1\u8db3 $i\\text{ xor }?=i-?$ \u7684\u3002\n\n\u8fd9\u91cc\u4e0d\u7528\u8003\u8651\u6392\u5217\uff0c\u662f\u56e0\u4e3a\u8fd9\u4e9b\u6570\u5b57\u5728 $b$ \u4e2d\u5df2\u7ecf\u6392\u597d\u3002\n\n\u8003\u8651\u65b9\u6848\u603b\u548c\uff0c\u56e0\u4e3a $a<b$\uff0c\u5373 $a\u2260b$\uff0c\u56e0\u6b64 $C_{f(i)}^{f(i)}=1$ \u7684\u65b9\u6848\u6392\u9664\uff0c\u90a3\u4e48\u603b\u65b9\u6848\u6570\uff08\u4e0a\u9762\u7684 $S$ \u6570\u7ec4\uff0c\u89e3\u6cd5 1\uff09\u6709\uff1a\n\n$$S_{n}=\\sum_{i=1}^{n}(2^{f(i)}-1)=\\sum_{i=1}^{n}2^{f(i)}-n$$\n\n\u4f7f\u7528 $lowbit$ \u8fd0\u7b97\u53ef\u8ba1\u7b97 $i$ \u4e2d $1$ \u7684\u6570\u91cf\uff0c\u5747\u644a\u662f $O(1)$ \u7684\uff0c\u53ef\u4ee5\u62ff\u5230 $60pts$\uff0c\u603b\u7684\u4ee3\u7801\u5982\u4e0b\uff1a\n\n~~~cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define lowbit(x) (x & -x)\n\nint calc(int x) {\n\tint cnt = 0;\n\tfor( ; x; x -= lowbit(x))\n\t\tcnt++;\n\treturn cnt;\n}\n\nint bit[32];\n\nint main() {\n\tint n;\n\tscanf(\"%d\", &n);\n\tbit[0] = 1;\n\tfor(int i = 1; i < 32; i++)\n\t\tbit[i] = 1 << i;\n\tint ans = 0;\n\tfor(int i = n; i; i--)\n\t\tans += bit[calc(i)] - 1;\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n~~~\n\n\u63a5\u4e0b\u6765\u8003\u8651\u4f18\u5316\u3002\n\n\u89c2\u5bdf $f$ \u6570\u7ec4\u662f\u5426\u4e5f\u5177\u6709\u53ef\u9012\u5f52\u7684\u6027\u8d28\uff1f\u5176\u5b9e\u6709\u7684\uff0c\u5728\u4f4d\u8fd0\u7b97\u4e2d\uff0c\u53f3\u79fb\u4e00\u4f4d\u5c31\u662f\u9664 $2$\uff0c\u8003\u8651\u5947\u6570\u9664\u4e8c\uff0c\u90a3\u4e48 $f_n=f_\\frac{n}{2}+1$\uff0c\u8fd9\u662f\u56e0\u4e3a\u5947\u6570\u53f3\u79fb\u7684\u65f6\u5019\u6700\u4f4e\u4f4d\u7684 $1$ \u88ab\u820d\u53bb\u4e86\uff1b\u540c\u7406\u5076\u6570 $f_n=f_\\frac{n}{2}$\uff0c\u56e0\u4e3a\u5076\u6570\u6700\u4f4e\u4f4d\u4e3a $0$\u3002\n\n\uff08\u77e5\u9053\u4f4d\u8fd0\u7b97\u7684\u4e0a\u9762\u5e94\u8be5\u6bd4\u8f83\u663e\u7136\uff09\n\n\u6574\u7406\u4e00\u4e0b\uff1a\n\n$$\\begin{cases}f_0=0\\\\f_{2i}=f_i\\\\f_{2i+1}=f_i+1\\end{cases}$$\n\n\u7136\u540e\u4ecd\u7136\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5\u63a8\u7406\u5373\u53ef\uff0c\u6211\u8bb0\u5f97\u6211\u7ffb\u4e86\u4e00\u4e0b\u522b\u4eba\u7684\u9898\u89e3\u4e5f\u6709\u8fd9\u79cd\u65b9\u6cd5\u63a8\u7406\u7684\uff0c\u56e0\u4e3a\u7bc7\u5e45\u9650\u5236\u8fd9\u91cc\u5c31\u4e0d\u63a8\u4e86\uff0c\u5927\u5bb6\u81ea\u5df1\u5c1d\u8bd5\u4e00\u4e0b\u5982\u4f55\uff1f\n\n\n\u4f46\u662f\u6211\u8bb0\u5f97\u522b\u4eba\u63a8\u7684\u60c5\u51b5\u53ea\u6709\u5076\u6570\u7684\uff0c\u5efa\u8bae\u5927\u5bb6\u63a8\u4e0b\u5947\u6570\u7684\u60c5\u51b5\u770b\u770b\u662f\u5426\u76f8\u540c\u3002\n\n\u4e0b\u9762\u662f\u6211\u63a8\u51fa\u7684\u7ed3\u8bba\uff1a\n\n$$S_n=\\begin{cases}0&n=0\\\\2S_{\\frac{n}{2}-1}+S_\\frac{n}{2}+\\frac{n}{2}&n\\text{ \u4e3a\u5076\u6570}\\\\3S_\\frac{n}{2}+\\frac{n}{2}+1&n\\text{ \u4e3a\u5947\u6570}\\end{cases}$$\n\n\u4e0e\u89e3\u6cd5 $1$ \u63a8\u51fa\u6765\u7684\u5f0f\u5b50\u4e0d\u8c0b\u800c\u5408\uff0c\u53ef\u4ee5 $O(\\text{log }n)$ \u8ba1\u7b97\u3002\n\n# \u4ee3\u7801\n\n\u81f3\u6b64\uff0c\u672c\u9898\u7684\u4e24\u79cd\u89e3\u6cd5\u5c31\u8bb2\u5b8c\u4e86\uff0c\u7b2c\u4e00\u79cd\u60f3\u6cd5\u9002\u5408\u8003\u573a\u5199\uff0c\u800c\u7b2c\u4e8c\u79cd\u60f3\u5fc5\u624d\u80fd\u591f\u6210\u4e3a\u6b63\u89e3\u3002\u4f46\u662f\u8003\u573a\u53d1\u73b0\u89c4\u5f8b\u4e5f\u662f\u4e0d\u5bb9\u6613\u7684\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u7b2c\u4e00\u79cd\u89e3\u6cd5\u6bd4\u8f83\u5b9e\u7528\u3002\n\n\u6211\u77e5\u9053\u4f60\u4eec\u53ea\u60f3\u770b\u4ee3\u7801\uff0c\u4f46\u662f\u56e0\u4e3a\u8be5\u8bb2\u7684\u6211\u8bb2\u5b8c\u4e86\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u6709\u4efb\u4f55\u6ce8\u91ca\u3002\n\n\u56e0\u4e3a\u4e24\u79cd\u89e3\u6cd5\u7684\u5f0f\u5b50\u76f8\u540c\uff0c\u4ee3\u7801\u81ea\u7136\u4e5f\u5c31\u76f8\u540c\uff1a\n\n~~~cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int mod = 1e9 + 7;\n\nmap<long long, int> f;\n\nint solve(long long n) {\n\tif(!n) return 0;\n\tif(f[n]) return f[n];\n\tif(n & 1) \n\t\tf[n] = (3LL * solve(n >> 1) + (n >> 1) + 1) % mod;\n\telse f[n] = (2LL * solve((n >> 1) - 1) + solve(n >> 1) + (n >> 1)) % mod;\n\treturn f[n];\n}\n\nint main() {\n\tlong long n;\n\tscanf(\"%lld\", &n);\n\tprintf(\"%d\\n\", solve(n));\n\treturn 0;\n}\n~~~\n\n\u56e0\u4e3a\u6211\u61d2\u5f97\u624b\u5199 $Hash$ \u8868\uff0c\u53c8\u4e0d\u60f3\u7528 $C++11$ \u7684 $unordered\\_map$\uff0c\u56e0\u6b64\u9009\u62e9\u4e86 $C++ \\ STL$ \u4e2d\u7684 $map$\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f $O(\\text{log }n)$ \u7684\uff0c\u56e0\u6b64\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\text{log}^2n)$\uff0c\u671f\u671b\u5f97\u5206 $100pts$\u3002\n\n# \u540e\u8bb0\n\n\u611f\u8c22\u5927\u5bb6\u9605\u8bfb\u5b8c\u8fd9\u4e00\u7bc7\u9898\u89e3\uff0c\u540c\u65f6\u6211\u4e5f\u518d\u6b21\u91cd\u7533\uff1a\u82e5\u8981\u8f6c\u8f7d\u6b64\u6587\u6216\u90e8\u5206\u5185\u5bb9\uff0c\u8bf7\u6ce8\u660e\u51fa\u5904\u3002\n\n\u5982\u679c\u5bf9\u672c\u6587\u6709\u4efb\u4f55\u7591\u95ee\u6216\u8005\u6307\u51fa\u9519\u8bef\uff0c\u8bf7\u79c1\u4fe1\u6211\uff08\u6d1b\u8c37\uff09\u3002\n\n\uff08~~**\u4e0d\u77e5\u9053\u6211\u5199\u4e86\u8fd9\u4e48\u591a\u53ef\u5426\u65e0\u803b\u7684\u6c42\u4e2a\u8d5e\u2026\u2026**~~\uff09\n\n## Update\n\n- $2020-02.02$\uff0c\u81ea\u5df1\u9605\u8bfb\u7684\u65f6\u5019\u53d1\u73b0\u4e86\u4e00\u4e9b\u516c\u5f0f\u9519\u8bef\uff0c\u8fdb\u884c\u4e86\u4fee\u6b63\uff0c\u6ca1\u60f3\u5230\u7b2c\u4e00\u6b21\u4fee\u6b63\u7684\u65f6\u5019\u7ba1\u7406\u5ba1\u6838\u90a3\u4e48\u5feb\uff0c\u8fd9\u91cc\u8bf4\u58f0\u62b1\u6b49\uff0c\u8fd8\u5e0c\u671b\u7ba1\u7406\u91cd\u5ba1\u3002",
        "postTime": 1580538476,
        "uid": 196649,
        "name": "xiejinhao",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P6034 \u3010Ryoku \u4e0e\u6700\u521d\u4e4b\u4eba\u7b14\u8bb0\u3011"
    },
    {
        "content": "\u9996\u5148\u7b54\u6848\u4e3a $\\sum_{i=1}^n 2^{f(i)}$\uff0c$f(i)$ \u4e3a $i$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d $1$ \u7684\u4e2a\u6570\uff0c\u8bc1\u660e\u53c2\u89c1\u51fa\u9898\u4eba\u7684\u9898\u89e3\u3002\u91cd\u70b9\u5728\u4e8e\u5982\u4f55\u6c42\u5b83\u3002\n\n\u679a\u4e3e $f(i)=j$\uff0c\u539f\u5f0f\u7b49\u4e8e $\\sum_{j=1}^{64}2^jg(n,j)$\uff0c$g(n,j)$ \u4e3a\u5c0f\u4e8e\u7b49\u4e8e $n$ \u7684\u3001\u4e8c\u8fdb\u5236\u8868\u793a\u91cc\u6709 $j$ \u4e2a $1$ \u7684\u6570\u7684\u4e2a\u6570\u3002\u6c42 $g(n,j)$ \u7684\u65b9\u6cd5\u5f88\u591a\uff0c\u6211\u7528\u4e86\u6570\u4f4d DP\u3002\n\n\u8bb0\u5fc6\u5316\u641c\u7d22\uff0c\u7ef4\u62a4\u76ee\u524d $1$ \u7684\u4e2a\u6570\uff0c\u5047\u5982\u5230\u6700\u540e\u4e00\u4f4d\uff0c$1$ \u7684\u4e2a\u6570\u592a\u591a/\u592a\u5c11\uff0c\u5c31\u8fd4\u56de $0$\u3002\u5176\u4ed6\u7684\u5c31\u662f\u6807\u51c6\u7684\u6a21\u677f\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<cmath>\nusing namespace std;\ntypedef long long ll;\nll f[80][80][2],c[80],l=0;\nconst ll mod=1000000007;\nvoid Turn(ll k){\n    memset(c,0,sizeof(c));\n    while(k)c[++l]=k%2,k/=2;\n    return ;\n}\nll dp(ll x,bool flag,ll sum){\n\tif(sum<0)return 0;\n\tif(!x){\n\t\tif(!sum)return 1;\n\t\treturn 0;\n\t}\n\tif(~f[x][sum][flag])return f[x][sum][flag];\n\tf[x][sum][flag]=0;\n\tfor(int i=0;i<=(flag?c[x]:1);i++){\n\t\tf[x][sum][flag]+=dp(x-1,flag&&i==c[x],sum-i);\n\t}\n\treturn f[x][sum][flag];\n}\nll Calc(ll n,ll k){\n\tmemset(f,-1,sizeof(f));\n\tll r=dp(l,1,k);\n\treturn r%mod;\n}\nint main(){\n    ll x,ans=0;\n    scanf(\"%lld\",&x);\n\tTurn(x);\n    for(int i=1;i<=63;i++)ans=(ans+((1ll<<i)%mod)*(Calc(x,i)%mod)%mod)%mod;\n    printf(\"%lld\\n\",(ans-x%mod+mod)%mod);\n}\n//100000000000000000\n```",
        "postTime": 1580472049,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6034 \u3010Ryoku \u4e0e\u6700\u521d\u4e4b\u4eba\u7b14\u8bb0\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u6c42\u6ee1\u8db3 $a\\equiv b\\pmod {a \\text{ xor } b}$ \u4e14 $a,b$ \u5747\u4e3a\u5c0f\u4e8e\u7b49\u4e8e $n(\\le10^{18})$ \u7684\u975e\u8d1f\u6574\u6570\u3002\n\n### Sol\n\n\u7b49\u4ef7\u4e8e\u6c42 $\\sum_{i=1}^n2^{f(i)}-n$ \u5176\u4e2d $f(i)$,\u4e3a $i$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d $1$ \u7684\u4e2a\u6570\uff0c\u8bc1\u660e\u53c2\u89c1\u51fa\u9898\u4eba\u7684\u9898\u89e3\u3002\uff08~~\u65e2\u7136fee\u7684\u9898\u89e3\u53ef\u4ee5\u8fd9\u6837\u5199\u94a0\u6211\u4e5f\u8fd9\u6837\u5199\u3002~~\uff09\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cd\u66f4\u52a0\u7b80\u5355\u7684\u6c42\u503c\u65b9\u6cd5\u3002\n\n\u8003\u8651\u5230 $f(i)$ \u5f88\u5c0f\uff0c\u53ef\u4ee5\u7edf\u8ba1 $f(i)=x$ \u7684\u4e2a\u6570\u3002\u6362\u8a00\u4e4b\uff0c\u6c42\u4e00\u4e2a\u6570\u7ec4\uff0c\u5176\u4e2d $c_i\\sum_{j=1}^n[f(j)=i]$\u3002\u8fd9\u4e2a $c$ \u7684\u957f\u5ea6\u663e\u7136\u4e0d\u8d85\u8fc7 $\\lceil \\log n\\rceil\\approx 60$\u3002\n\n\u90a3\u4e48\u600e\u4e48\u6c42 $c_i$ \u5462\uff1f\n\n\u5982\u679c $n+1$ \u662f\u4e8c\u7684\u5e42\u6b21\uff0c\u90a3\u4e48\u5728\u4e8c\u8fdb\u5236\u4e0b\u4efb\u9009\u4e00\u4f4d\u53d8\u6210 $1$ ,\u4e00\u5171\u9009 $i$ \u4e2a\uff0c\u7b26\u5408\u7ec4\u5408\u6570\u7684\u5b9a\u4e49\uff0c\u7b54\u6848\u663e\u7136\u662f $c_i=C_{\\log_2n}^i$\u3002\n\n\u5982\u679c $n+1$ \u4e0d\u662f\u4e8c\u7684\u5e42\u6b21\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u7c7b\u8ba8\u8bba $x>n+1-lowbit(n+1)$ \u548c $x\\le n+1-lowbit(n+1)$ \u3002\uff08\u8fd9\u91cc lowbit \u5c31\u662f\u6811\u72b6\u6570\u7ec4 lowbit \u7684\u5b9a\u4e49\uff09\uff0c\u663e\u7136\u540e\u8005\u53ef\u4ee5\u9012\u5f52\u6c42\u89e3\uff0c\u524d\u8005\u76f8\u5f53\u4e8e\u4e8c\u7684\u5e42\u6b21\u7684\u90a3\u79cd\u60c5\u51b5\u52a0\u4e0a\u56fa\u5b9a\u4e2a\u6570\u4e2a $1$\u3002\n\n\u590d\u6742\u5ea6 $f(n)\\log n+\\log^2n$ \u8dd1\u4e86 31ms\uff0c\u6bd4\u6700\u4f18\u89e3\u6162\u4e86 1ms \u4f46\u662f\u6bd4\u5176\u4ed6\u9898\u89e3\u90fd\u5feb qwq\u3002\n\n### Code\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<stdio.h>\n#include<vector>\nusing namespace std;\ntypedef long long ll;\ninline const void readln(ll&I){\n    I=0;char C=getchar();\n    while(!isdigit(C))C=getchar();\n    while( isdigit(C))(I*=10ll)+=(C-'0'),C=getchar();\n}\nconst unsigned long long p=1e9+7;\nstruct fint{int v;fint(unsigned long long V=0){v=V%p;}};\nfint operator+ (fint U,fint V){return (1ull*U.v+V.v)%p;}\nfint operator* (fint U,fint V){return (1ull*U.v*V.v)%p;}\nfint operator+=(fint&U,fint V){return U=U+V;}\nfint operator*=(fint&U,fint V){return U=U*V;}\nfint f[61][61],c[61],ans;\nfint C(int n,int k){\n    fint&ans=f[n][k];\n    if(k==0)return 1;\n    else if(ans.v!=0)return ans;\n    else if((k<<1)>n)return ans=C(n,n-k);\n    else return ans=C(n-1,k)+C(n-1,k-1);\n}\nint ctbt(ll val){\n    int res=0;\n    while(val)res++,val-=(val&-val);\n    return res;\n}\nll n;\nint q;\nint main(){\n    readln(n),ans=p-(n%p),q=ctbt(++n);\n    for(int i=0;(1ll<<i)<=n;i++){\n        if(n&(1ll<<i)){\n            --q,n^=(1ll<<i);\n            for(int j=0;j<=i;j++)\n                c[j+q]+=C(i,j);\n        }\n    }\n    for(int i=1;i<=60;i++)\n        ans+=c[i]*((1ll<<i)%p);\n    printf(\"%d\\n\",ans.v);\n}\n```",
        "postTime": 1666091137,
        "uid": 217300,
        "name": "Error_Eric",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6034 Ryoku \u4e0e\u6700\u521d\u4e4b\u4eba\u7b14\u8bb0"
    }
]