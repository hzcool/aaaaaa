[
    {
        "content": "\u673a\u623f\u5927\u4f6c\u8bb2\u89e3\u540e, \u5199\u4e00\u5199\u9898\u89e3\n\n### \u8fd9\u662f\u5f88\u7ecf\u5178\u7684\u90bb\u63a5\u77e9\u9635\u4e58\u6cd5\u4e86\n\n\u5bf9\u4e8e\u90bb\u63a5\u77e9\u9635G\\[i][j] \u8868\u793ai\u5230j\u6709\u6ca1\u6709\u8fb9\n\n\u5982\u679c\u662f$G^1$ , \u53d1\u73b0\u5c31\u662f\u539f\u77e9\u9635,  G\\[i][j]\u53ef\u4ee5\u7406\u89e3\u4e3a\u4ecei\u8d70\u4e00\u6b65\u5230j\u7684\u65b9\u6848\u6570\n\n\u4e0b\u9762\u8003\u8651$G^2$ \n\n\u77e9\u9635\u4e58\u6cd5\u4ee3\u7801:\n\n```cpp\nMatrix operator * (const Martix &p) const{\n\t\tMartix tmp;\n\t\tfor (rint i = 0;i < n; i++) \n\t\t\tfor (rint j = 0;j < n; j++) \n\t\t\t\tfor (rint k = 0;k < n; k++) \n\t\t\t\t\ttmp.Mar[i][j] = (tmp.Mar[i][j] + Mar[i][k] * p.Mar[k][j]) % P;\n\t\treturn tmp;\n\t}\n```\n\n\u53d1\u73b0$G^2[i][j] = \\sum_{k=0}^{n-1}  G[i][k] * G[k][j]$ \u50cf\u4e0d\u50cfFloyd\n\n\u5373\u679a\u4e3e\u4e00\u4e2a\u4e2d\u95f4\u70b9k, \u4ecei\u5230j\u8d70\u4e24\u6b65\u7684\u7684\u65b9\u6848\u6570\u7b49\u4e8e\u4ecei\u5230\u8d70\u4e00\u6b65k\u7684\u65b9\u6848\u6570, \u518d\u4e58\u4e0a\u4ecek\u8d70\u4e00\u6b65\u5230j\u7684\u65b9\u6848\u6570\u4e4b\u548c\n\n\u4ee5\u6b64\u7c7b\u63a8\n\n$G^t[i][j]$\u4e3a\u518dG\u8fd9\u4e2a\u90bb\u63a5\u77e9\u9635\u4e0a\u4ecei\u8d70t\u6b65\u5230j\u7684\u65b9\u6848\u6570\n\n### \u539f\u77e9\u9635$G^0$\u4e3a\u5355\u4f4d\u77e9\u9635, \u6bcf\u4e58\u4e00\u4e2a\u65b0\u7684\u90bb\u63a5\u77e9\u9635\u76f8\u5f53\u4e8e\u53c8\u5728\u65b0\u7684\u90bb\u63a5\u77e9\u9635\u4e0a\u8d70\u4e00\u6b65\n\n\u56de\u5230\u672c\u9898\n\n2, 3, 4\u7684\u6700\u5c0f\u516c\u500d\u6570\u4e3a12\n\n\u6240\u4ee5\u5f00\u5341\u4e8c\u4e2a\u90bb\u63a5\u77e9\u9635\u5373\u53ef, \u6bcf\u4e2a\u77e9\u9635\u8868\u793a\u5f53\u524d\u8d70\u4e00\u6b65\u7684\u5408\u6cd5\u60c5\u51b5\n\na[0]\u8868\u793a\u8d7012\u6b65\u7684\u77e9\u9635, \u537312\u4e2a\u90bb\u63a5\u77e9\u9635\u4e4b\u79ef\n\nk/12\u4e2aa[0]\u76f8\u4e58\u4f7f\u7528\u5feb\u901f\u5e42, \u5728\u6309\u987a\u5e8f\u4ecea[1]\u4e58\u5230a[k%12]\n\n\u7b54\u6848\u4e3a $a[0]^{k/12} * a[1] * a[2] * \\cdots s[k\\%12]$ \n\n\u7ec6\u8282\u89c1\u4ee3\u7801\u53ca\u6ce8\u91ca:\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#define ll long long\nusing namespace std;\ntemplate <typename T> \nvoid read(T &x) {\n\tx = 0; int f = 1;\n\tchar c = getchar();\n\tfor (;!isdigit(c);c=getchar()) if (c=='-') f=-1;\n\tfor (;isdigit(c);c=getchar()) x = (x << 3) + (x << 1) + c - '0';\n\tx *= f;\n}//\u5feb\u8bfb\nconst int N = 52;\nint n, m;\nll t, k;\nconst int P = 10000;\n#define rint register int\nstruct matrix{\n\tint Mar[N][N];\n\tmatrix () {\n\t\tmemset(Mar, 0, sizeof(Mar));\n\t}\n\tmatrix operator * (const matrix &p) const{\n\t\tmatrix tmp;\n\t\tfor (rint i = 0;i < n; i++) \n\t\t\tfor (rint j = 0;j < n; j++) \n\t\t\t\tfor (rint k = 0;k < n; k++) \n\t\t\t\t\ttmp.Mar[i][j] = (tmp.Mar[i][j] + Mar[i][k] * p.Mar[k][j]) % P;\n\t\treturn tmp;\n\t}//\u77e9\u9635\u4e58\u6cd5\n\tvoid print(void) {\n\t\tfor (int i = 0;i < n; i++) {\n\t\t\tfor (int j = 0;j < n; j++) \n\t\t\t\tprintf (\"%d \", Mar[i][j]);\n\t\t\tcout << endl;\n\t\t}\n\t\tcout << endl;\n\t}//\u8c03\u8bd5\u8f93\u51fa\n}a[15], b, c;\n\nmatrix pow() {\n\tmatrix ans = b, tmp = a[0];\n\tint tttmp = k / 12;\n\twhile (tttmp) {\n\t\tif (tttmp & 1) ans = ans * tmp;\n\t\ttmp = tmp * tmp;\n\t\ttttmp >>= 1;\n\t}\n\treturn ans;\n}//\u77e9\u9635\u5feb\u901f\u5e42\nint nfish, ttmp[50], st, ed;\t\t\t\nint main() {\n//\tfreopen(\"hs.out\",\"w\",stdout);\n\tread(n), read(m), read(st), read(ed), read(k);\n\twhile (m--) {\n\t\tint x, y;\n\t\tread(x), read(y);\n\t\tc.Mar[x][y] = c.Mar[y][x] = 1; //\u539f\u77e9\u9635\n\t}\n//\tc.print();\n\tfor (rint i = 1;i <= 12; i++) a[i] = c; //\u521d\u59cb\u5316\n\tfor (rint i = 0;i < n; i++) b.Mar[i][i] = 1; //\u5355\u4f4d\u77e9\u9635\n\tread(nfish);\n\twhile (nfish--) {\n\t\tread(t);\n\t\tfor (int i = 0;i < t; i++) read(ttmp[i]); ttmp[t] = ttmp[0]; \n        \t//\u7531\u4e8e\u5f00\u59cb\u65f6\u65f6\u95f4\u4e3a0, \u6240\u4ee5\u8bfb\u5165\u8981\u4ece\u96f6\u5f00\u59cb\n\t\tfor (int i = 1;i <= 12; i++) \n\t\t\tfor (int j = 0;j < n; j++) \n\t\t\t\ta[i].Mar[j][ttmp[(i-1)%t+1]] = 0; \n        \t\t//\u6ce8\u610f\u53ea\u6e05\u7a7a\u4ece\u5176\u4ed6\u5730\u65b9\u5230\u9cc4\u9c7c\u65b0\u6765\u7684\u5730\u70b9\u7684\u8fb9\n\t}\n//\tfor (int i = 1;i <= 12; i++) a[i].print();\n\ta[0] = b;\n\tfor (int i = 1;i <= 12; i++) a[0] = a[0] * a[i];\t\n//\ta[0].print();\n\tmatrix ans = pow();\n\tfor (int i = 1;i <= k % 12; i++) ans = ans * a[i];\n\tcout << ans.Mar[st][ed] << endl;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1572277994,
        "uid": 122144,
        "name": "hs_black",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "\u4eca\u5929\u521a\u521a\u5b66\u4e60\u4e86\u77e9\u9635\u4e58\u6cd5\uff08\u7136\u800c\u5168\u673a\u623f\u53ef\u80fd\u5c31\u6211\u81ea\u5df1\u4e0d\u4f1a\n\n\u770b\u5230\u7f51\u4e0a\u8bf4\u8fd9\u9053\u9898\u662f\u77e9\u9635\u4e58\u6cd5\u7684\u5165\u95e8\u9898,\u4e8e\u662f\u5c31\u6765\u5c1d\u8bd5\n\n\u7136\u540e\u6211\u80af\u5b9a\u662f\u4e0d\u4f1a\u7684,\u4e8e\u662f\u5c31\u6df1\u5165\u601d\u8003~~\u770b\u9898\u89e3~~\n\n\u53d1\u73b0\u90bb\u63a5\u77e9\u9635\u505a\u4e58\u6cd5\u6709\u4e9b\u795e\u5947\u7684\u6027\u8d28\n\n\u5bf9\u4e8e\u4efb\u610f$g[i][j]^n$ , \u8868\u793a\u4ecei\u51fa\u53d1\u8d70n\u6b65\u6070\u597d\u5230j\u7684\u65b9\u6848\u6570\n\n\u4e86\u89e3\u4e86\u8fd9\u4e2a\u6027\u8d28\u4ee5\u540e,\u8fd9\u9053\u9898\u5c31\u80a5\u80a0\u660e\u4e86\u4e86\n\n\u4f46\u662f\u8fd8\u8981\u8003\u8651\u98df\u4eba\u9c7c\u7684\u95ee\u9898\n\n\u6211\u4eec\u53d1\u73b0\u98df\u4eba\u9c7c\u6e38\u52a8\u7684\u5468\u671f\u53ea\u6709$2,3,4$\u4e09\u79cd\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u76f4\u63a5\u5904\u7406\u4ed6\u4eec\u7684\u6700\u5c0f\u516c\u5171\u5468\u671f$12$\n\n\u6211\u4eec\u8bbeg[i]\u8868\u793a\u5728\u8d70\u7b2c $k * 12 + i (k\u2208Z)$ \u6b65\u7684\u65f6\u5019\u6574\u4e2a\u56fe\u7684\u8054\u901a\u60c5\u51b5\n\n\u7136\u540e\u6211\u4eec\u5c31\u5904\u7406\u51fa\u6bcf\u8d70$12$\u6b65\u7684\u540e\u60c5\u51b5\u7684\u77e9\u9635\n\n\u7136\u540e\u4ee5\u6bcf$12$\u6b65\u4e3a\u4e00\u4e2a\u6574\u4f53\u505a\u5feb\u901f\u5e42\n\n\u6700\u540e\u5355\u72ec\u5904\u7406\u4f59\u4e0b\u7684\u65f6\u95f4\u5373\u53ef\n\n\u4e0a\u4ee3\u7801\u2193\n\n```\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\nconst int M = 55 ;\nconst int N = 15 ;\nconst int mod = 10000 ;\nusing namespace std ;\nint n , m , s , t , k , Fish ;\nint G[M][M] ;\nstruct Mat{\n\tint f[M][M] ;\n}Ans , g[N] , b , st ;\nint w[M] ;\nMat operator * (Mat A , Mat B){\n\tMat temp ;\n\tmemset(temp.f , 0 , sizeof(temp.f)) ;\n\tfor(int i=1;i<=n;i++)\n\t  for(int j=1;j<=n;j++)\n\t    for(int k=1;k<=n;k++)\n\t      temp.f[i][j] = (temp.f[i][j] + A.f[i][k] * B.f[k][j])%mod ;\n\treturn temp ;\n}\ninline Mat Pow(Mat Base , int k){\n\tMat temp = st ;\n\twhile(k){\n\t\tif(k&1) temp = (temp * Base) ;\n\t\tBase = (Base * Base) ; k >>= 1 ;\n\t}\n\treturn temp ;\n}\nint main(){\n\tcin >> n >> m >> s >> t >> k ;\n\t++s ; ++t ;\n\tfor(int i=1;i<=n;i++) st.f[i][i] = 1 ;\n\tfor(int i=1 , x , y;i<=m;i++){\n\t\tcin >> x >> y ;\n\t\t++x , ++y ;\n        for(int j=1;j<=12;j++) g[j].f[x][y] = g[j].f[y][x] = 1 ;\n\t}\n\tcin >> Fish ;\n\twhile(Fish--){\n\t\tint num = 0 ; cin >> num ;\n\t\tfor(int i=1;i<=num;i++)  cin >> w[i] , w[i]++ ;\n\t\tfor(int i=1;i<=n;i++)\n\t\t  for(int j=0;j<=12;j++)\n\t\t    g[j].f[i][w[j%num + 1]] = 0 ;\n\t}\n\tfor(int i=1;i<=n;i++) b.f[i][i] = 1 ;\n\tfor(int i=1;i<=12;i++) b = (b * g[i]) ;\n\tAns = Pow(b , k/12) ;\n\tfor(int i=1;i<=k%12;i++) Ans = (Ans * g[i]) ;\n    cout << Ans.f[s][t] <<endl ;\n    return 0 ;\n}\n```",
        "postTime": 1531223621,
        "uid": 53884,
        "name": "beretty",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "\u7ed9\u6211\u7684\u535a\u5ba2\u6253\u4e2a\u5e7f\u544a\uff1a\n\n[Mychael\u7684\u65e0\u58f0\u4e50\u7ae0](https://www.cnblogs.com/Mychael/)\n\n\n\n**\u90bb\u63a5\u77e9\u9635\u4e58\u6cd5**\n\n\n\u5728\u5199\u8fd9\u9053\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4e86\u89e3\u90bb\u63a5\u77e9\u9635\u4e58\u6cd5\u7684\u610f\u4e49\n\n\u4ec0\u4e48\u90bb\u63a5\u77e9\u9635\u8fd8\u6709\u4e58\u6cd5\uff1f\n\n\u60f3\u60f3\u5bf9\u4e8e\uff0cG[i][j]\uff0c\u5982\u679c\u5b58\u5728i->j\u7684\u8fb9\u90a3\u4e48G[i][j]=1\n\n\u5982\u679c\u6211\u4eec\u628a\u8fd9\u770b\u505aG\u7684\u4e00\u6b21\u5e42\uff0c\u7406\u89e3\u4e3a\u53ea\u8d70\u4e00\u6b65\u65f6i->j\u7684\u8def\u7ebf\u6761\u6570\u3010\u5f53\u7136\u80af\u5b9a\u662f1\u5566\u3002\u3002\u3011\n\n\n\u5bf9\u4e8eG^2\u5462\uff1f\n\n\u5bf9\u4e8e\u6240\u6709\u7684G[i][k]\u548cG[k][j]\uff0c\u90fd\u4f1a\u76f8\u4e58\u4e14\u7ed3\u679c\u5b58\u5728\u6700\u540e\u7684G'[i][j]\u4e2d\uff0c\u96be\u9053\u8fd9\u4e0d\u662f\u8d70\u4e24\u6b65\u65f6i->j\u7684\u8def\u7ebf\u4e48\uff1f\n\n\n\u7531\u6b64\uff0c\u5bf9\u4e8e\u4efb\u610fG^n[i][j],\u8868\u793a\u4ecei\u51fa\u53d1\u8d70n\u6b65\u5230j\u7684\u65b9\u6848\u6570\u3010\u53ef\u4ee5\u4e2d\u9014\u7ecf\u8fc7j\u3011\n\n\n\u5178\u9898\uff1a\u7ed9\u5b9a\u4e00\u5f20\u56fe\uff0c\u6c42\u4ecei\u51fa\u53d1\u8d70k\u6b65\u5230j\u7684\u65b9\u6848\u6570\u3002\n\n\n\n**\u9898\u89e3**\n\n\n\u6709\u4e86\u8fd9\u6837\u7684\u77e5\u8bc6\u50a8\u5907\uff0c\u4f3c\u4e4e\u89e3\u51fa\u8fd9\u9053\u9898\u5c31\u4e0d\u662f\u96be\u4e8b\u4e86\u3002\n\n\u7b49\u7b49\u3002\u3002\u98df\u4eba\u9c7c\u600e\u4e48\u8003\u8651\uff1f\n\n\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u98df\u4eba\u9c7c\u7684\u5468\u671f\u5f88\u5c0f\uff0c\u4e3a2,3,4\uff0c\u6700\u5c0f\u516c\u500d\u6570\u662f12\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf912\u4e2a\u65f6\u95f4\u5185\u6bcf\u4e2a\u65f6\u95f4\u70b9\u5efa\u4e00\u4e2a\u90bb\u63a5\u77e9\u9635\uff0c\u7136\u540e\u987a\u6b21\u3010\u6ce8\u610f\u662f\u987a\u6b21\uff0c\u77e9\u9635\u4e58\u6cd5\u6ca1\u6709\u4ea4\u6362\u5f8b\u3011\u76f8\u4e58\n\n\u4e3a\u4e86\u964d\u4f4e\u590d\u6742\u5ea6\uff0c\u5176\u4e2d[K/12]\u7ec4\u53ef\u4ee5\u653e\u5728\u4e00\u8d77\u7528\u5feb\u901f\u5e42\u7b97\u51fa\n\n\n\u5751\u70b9\uff1a\n\n1\u3001\u6ce8\u610f\u6b63\u786e\u628a\u63e1\u5468\u671f\u65f6\u95f4\u70b9\uff0c\u4eceA[1]\u4e58\u5230A[11]\u518d\u4e58A[0]\n\n1\u3001\u77e9\u9635\u4e58\u6cd5\u6ca1\u6709\u4ea4\u6362\u5f8b\uff0c\u5f97\u5148\u9884\u5904\u7406Q=A[1]\\*A[2]\\*......\\*A[11]\\*A[0]\uff0c\u518d\u7528\u7b97\u51faQ^[K/12]\uff0c\u5bf9\u4e8e\u5269\u4e0b\u7684\uff0c\u4eceA[1]\u5f00\u59cb\u4e58\u5b8cK%12\u4e2a\u3010\u8fd9\u4e2a\u5751\u4e86\u6211\u597d\u4e45\u3011\n\n3\u3001\u6807\u53f7\u4ece0\u5f00\u59cb= =\n\n\n\n\n\n\n\n\n\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define LL long long int\nusing namespace std;\nconst int maxn=55,INF=2000000000,P=10000;\ninline int read(){\n    int out=0,flag=1;char c=getchar();\n    while(c<48||c>57) {if(c=='-') flag=-1;c=getchar();}\n    while(c>=48&&c<=57){out=out*10+c-48;c=getchar();}\n    return out*flag;\n}\nstruct Matrix{\n    LL s[maxn][maxn],n,m;\n    Matrix() {n=m=0;memset(s,0,sizeof(s));}\n}A[20],Q;\ninline Matrix operator *(const Matrix& a,const Matrix& b){\n    Matrix c;\n    if(a.m!=b.n) return c;\n    c.n=a.n;c.m=b.m;\n    for(int i=1;i<=c.n;i++)\n        for(int j=1;j<=c.m;j++)\n            for(int k=1;k<=a.n;k++)\n                c.s[i][j]=(c.s[i][j]+a.s[i][k]*b.s[k][j])%P;\n    return c;\n}\nMatrix qpow(Matrix a,LL b){\n    Matrix ans;\n    ans.n=ans.m=a.n;\n    for(int i=1;i<=ans.n;i++) ans.s[i][i]=1;\n    for(;b;b>>=1,a=a*a) if(b&1) ans=ans*a;\n    return ans;\n}\nint N,M,S,E,K,uns[20][maxn],G[maxn][maxn];\nvoid init(){\n    N=read();M=read();S=read()+1;E=read()+1;K=read();\n    int a,b;\n    while(M--){\n        a=read()+1;\n        b=read()+1;\n        G[a][b]=G[b][a]=1;\n    }\n    int NF=read(),T,u;\n    while(NF--){\n        T=read();\n        for(int i=0;i<T;i++){\n            u=read()+1;\n            for(int j=i;j<12;j+=T)\n                uns[j][u]=true;\n        }\n    }\n    Q.n=Q.m=N;\n    for(int i=1;i<=N;i++) Q.s[i][i]=1;\n    for(int t=0;t<12;t++){\n        A[t].n=A[t].m=N;\n        for(int i=1;i<=N;i++)\n            for(int j=1;j<=N;j++){\n                A[t].s[i][j]=(G[i][j]&&!uns[t][j]);\n            }\n    }\n    for(int i=1;i<12;i++) Q=Q*A[i];\n    Q=Q*A[0];\n}\nvoid solve(){\n    int k=K/12,t=K-k*12;\n    Matrix ans;ans.n=ans.m=N;\n    for(int i=1;i<=N;i++) ans.s[i][i]=1;\n    ans=ans*qpow(Q,k);\n    for(int i=1;i<=t;i++) ans=ans*A[i];\n    cout<<ans.s[S][E]<<endl;\n}\nint main(){\n    init();\n    /*for(int i=1;i<=N;i++){\n        for(int j=1;j<=N;j++) cout<<G[i][j]<<' ';\n        cout<<endl;\n    }\n    for(int t=0;t<12;t++){\n        cout<<endl<<endl;\n        for(int i=1;i<=N;i++){\n            for(int j=1;j<=N;j++) cout<<A[t].s[i][j]<<' ';\n            cout<<endl;\n        }\n    }*/\n    solve();\n    return 0;\n}\n\n```",
        "postTime": 1504677708,
        "uid": 32842,
        "name": "Mychael",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "# \u9898\u89e3-[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\n\n\n[$\\texttt{Read it in my cnblogs.}$](https://www.cnblogs.com/Wendigo/p/12545665.html)\n\n**\u524d\u7f6e\u77e5\u8bc6\uff1a**\n\n> \u90bb\u63a5\u77e9\u9635\n\n> \u77e9\u9635\u4e58\u6cd5\n\n> \u77e9\u9635\u5feb\u901f\u5e42\n\n---\n\n> [``[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c``](https://www.luogu.com.cn/problem/P2579)\n\n> \u7ed9\u4e00\u4e2a\u6709 $N$ \u4e2a\u70b9\uff0c$M$ \u6761\u53cc\u5411\u8fb9\u7684\u56fe $G$\uff0c\u5176\u4e2d\u6709 $NFish$ \u53ea\u9cc4\u9c7c\u4ee5 $T$ \u4e2a\u70b9 $P_0\\sim P_t$ \u4e3a\u5468\u671f\u8fd0\u52a8\u3002\u6c42\u4ece $Start$ \u51fa\u53d1\u5230 $End$ \u4e0d\u505c\u7559\u8d70 $K$ \u6b65\u6bcf\u6b65\u4e0d\u78b0\u5230\u9cc4\u9c7c\u7684\u65b9\u6848\u6570\uff08\u8282\u70b9\u4e0b\u6807\u4ece $0$ \u5f00\u59cb\u7f16\u53f7\uff09\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$1\\le N\\le 50$\uff0c$1\\le K\\le 2\\times 10^9$\uff0c$1\\le NFish\\le 20$\uff0c$2\\le T\\le 4$\u3002\n\n---\n\n\u770b\u5230\u8fd9\u4e2a $K$ \u7684\u8303\u56f4\u5c31\u77e5\u9053\u8981\u5e26\u4e2a $\\log$\uff0c\u800c\u5728\u56fe\u4e0a\u53ef\u4ee5\u5e26 $\\log$ \u7684\u7b97\u6cd5\uff0c\u552f\u6709**\u4e8c\u5206\u3001\u500d\u589e\uff08\u6811\u5f62\u56fe\uff09\u548c\u90bb\u63a5\u77e9\u9635\u5feb\u901f\u5e42\uff08\u5c0f\u56fe\uff09**\u3002\u770b\u5230\u8fd9\u9898 $N$ \u5f88\u5c0f\uff0c\u53c8\u65e0\u4ece\u4e8c\u5206\uff0c\u4fbf\u77e5\u9053\u53ef\u4ee5**\u90bb\u63a5\u77e9\u9635\u5feb\u901f\u5e42**\u3002\n\n---\n\n\u9996\u5148\u8981\u77e5\u9053\u4ec0\u4e48\u662f**\u77e9\u9635\u4e58\u6cd5**\u3002\u5927\u5c0f\u4e3a $a\\times b$ \u7684\u77e9\u9635 $A$ \u548c\u5927\u5c0f\u4e3a $b\\times c$ \u7684\u77e9\u9635\u65b9\u53ef\u76f8\u4e58\uff0c\u4e58\u79ef\u77e9\u9635 $C$ \u5927\u5c0f\u4e3a $a\\times c$\uff0c\u6ee1\u8db3 $C_{i,j}=\\sum\\limits_{k=1}^bA_{i,k}\\cdot B_{k,j}(1\\le i\\le a,1\\le j\\le c)$\u3002\n\n**\u77e9\u9635\u4e58\u6cd5**\u53ef\u4ee5\u89e3\u51b3\u96c6\u5408\u7684\u5b9a\u5411\u6c42\u548c\u53d8\u6362\u64cd\u4f5c\u3002\u5176\u4e2d\u539f\u77e9\u9635\u4e58\u4ee5\u53d8\u6362\u77e9\u9635\u53d8\u6210\u76ee\u6807\u77e9\u9635\u3002\n\n---\n\n**\u77e9\u9635\u5feb\u901f\u5e42**\uff1a\u539f\u77e9\u9635\u591a\u6b21\u5b9a\u5411\u53d8\u6362\uff0c\u53ef\u4ee5\u901a\u8fc7\u591a\u6b21\u4e58\u4ee5\u53d8\u6362\u77e9\u9635\u89e3\u51b3\u3002\u77e9\u9635\u4e58\u6cd5\u6ee1\u8db3\u7ed3\u5408\u5f8b\uff0c\u6240\u4ee5\u53ef\u4ee5\u5148\u6c42\u51fa\u53d8\u6362\u77e9\u9635\u7684\u5e42\u3002\u77e9\u9635\u4e5f\u53ef\u4ee5\u5feb\u901f\u5e42\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n^3\\log k)$\u3002\n\n---\n\n**\u90bb\u63a5\u77e9\u9635**\uff1a\u7528\u4e8e\u8868\u793a\u56fe\u8fb9\uff0c\u5728\u65e0\u6743\u56fe\u4e2d\uff0c\u5982\u679c\u77e9\u9635 $M$ \u7684\u5143\u7d20 $M_{i,j}=1$\uff0c\u8868\u793a\u5b58\u5728\u8fb9 $(i,j)$\u3002  \n\n---\n\n**\u800c\u90bb\u63a5\u77e9\u9635\u5feb\u901f\u5e42**\u5c31\u662f\u5efa\u7acb\u5728\u90bb\u63a5\u77e9\u9635\u548c\u77e9\u9635\u5feb\u901f\u5e42\u4e0a\u7684\u3002**\u539f\u77e9\u9635\u8868\u793a\u8d77\u70b9\u72b6\u6001\uff0c\u53d8\u6362\u77e9\u9635\u4e3a\u90bb\u63a5\u77e9\u9635\uff0c\u6bcf\u4e58\u4e00\u6b21\u5c31\u8868\u793a\u4e0d\u505c\u7559\u5730\u8d70\u4e00\u6b65\u540e\u7684\u72b6\u6001**\uff0c\u4e58 $K$ \u6b21\u5c31\u6210\u4e86\u6700\u7ec8\u72b6\u6001\uff0c\u53d6\u7ec8\u70b9\u77e9\u9635\u503c\u5219\u4e3a\u7b54\u6848\u3002\n\n> \u72b6\u6001\uff1a\u5230\u6bcf\u4e2a\u8282\u70b9\u7684\u65b9\u6848\u6570\u3002\n\n---\n\n### Example\n\n> \u8bb2\u89e3\u65f6\u6682\u65f6\u521d\u59cb\u4e0b\u6807\u4e3a $1$ \u5427\uff0c\u6682\u65f6\u4e0d\u8003\u8651\u9cc4\u9c7c\u3002\n\n\u4f8b\u5982 $N=3$\uff0c$Start=1$\uff0c$End=3$\uff0c\u6709\u53cc\u5411\u8fb9 ${(1,3),(3,2)}$\uff0c\u6c42\u8d70 $K=3$ \u6b65\u540e\u5230\u7ec8\u70b9 $End$ \u7684\u65b9\u6848\u6570\u3002\n\n**\u539f\u59cb\u72b6\u6001\uff1a**\n\n$$\nA=\n\\begin{bmatrix}\n1 & 0 & 0\\\\\n\\end{bmatrix}\n$$\n\n**\u53d8\u6362\u77e9\u9635\u4e3a\u90bb\u63a5\u77e9\u9635\uff1a**\n\n$$\nB=\n\\begin{bmatrix}\n0 & 0 & 1\\\\\n0 & 0 & 1\\\\\n1 & 1 & 0\\\\\n\\end{bmatrix}\n$$\n\n**\u76ee\u6807\u72b6\u6001\uff1a**\n\n![jz323.png](https://i.loli.net/2020/03/23/cidnxBCSAIO8Tav.png)\n\n\u6240\u4ee5\u5230\u7ec8\u70b9 $End=3$ \u7684\u65b9\u6848\u6570\u4e3a $2$\u3002\n\n---\n\n**\u4f46\u662f\u9cc4\u9c7c\u600e\u4e48\u529e\u5462\uff1f**\n\n\u53ef\u4ee5\u53d1\u73b0 $2\\le T\\le 4$\uff0c\u6240\u4ee5\u6240\u6709\u9cc4\u9c7c\u8fd0\u52a8\u7684\u603b\u5468\u671f\u662f $12$\u3002\u53ef\u4ee5\u8ba1\u7b97 $12$ \u79cd\u53d8\u6362\u90bb\u63a5\u77e9\u9635\uff0c\u8868\u793a\u5230\u6bcf\u4e2a\u5468\u671f\u65f6\u53ef\u4ee5\u8d70\u7684\u8fb9\u3002\u7136\u540e\u987a\u6b21\u76f8\u4e58\uff0c\u6c42\u4e58\u79ef\u7684 $\\lfloor\\frac K{12}\\rfloor$ \u6b21\u5e42\uff08**\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42**\uff09\u4e58\u4ee5 \u524d $\\left(K\\bmod 12\\right)$ \u79cd\u53d8\u6362\u77e9\u9635\u7684\u4e58\u79ef\uff0c\u5c31\u662f**\u603b\u53d8\u6362\u77e9\u9635**\u3002\u7528\u8868\u793a\u8d77\u70b9\u7684\u539f\u77e9\u9635\u4e58\u4ee5\u603b\u53d8\u6362\u77e9\u9635\uff0c\u5373\u53ef\u5f97\u7b54\u6848\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(NFish+N^3\\log K)$\uff08\u6ce8\u610f\uff0c$NFish$ \u4e3a\u4e00\u4e2a\u5b8c\u6574\u53d8\u91cf\u540d\uff09\u3002\n\n---\n\n\u771f\u7684\u96be\u8bb2\uff0c\u8fd8\u662f\u653e\u4ee3\u7801\u5427\u3002\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n//&Start\n#define inf 0x3f3f3f3f\n#define re register\n#define il inline\n#define hash unorded_map\ntypedef long long lng;\ntypedef unsigned long long ulng;\ntypedef vector<int> veci;\n#define fo(i,st,xb,y) for(re int i=st;i xb;i y)\n\n//&Data\n#define N 50\n#define mod 10000\nint n,m,s,t,k,fish,p[25][12];\n\n//&Matrix\nstruct Matrix{ //\u77e9\u9635\n\tint arr[N+5][N+5];\n\tMatrix(re int op=0){\n\t\tmemset(arr,0,sizeof arr);\n\t\tif(op==1) fo(i,1,<=N,++) arr[i][i]=1; //\u6784\u9020\u5355\u4f4d\u77e9\u9635 E \u6ee1\u8db3 E*A=A*E=A\n\t}\n\til int* operator[](re int x){return arr[x];} \n\til friend Matrix operator*(re Matrix x,re Matrix y){\n\t\tre Matrix res;\n\t\tfo(k,1,<=N,++)fo(i,1,<=N,++)fo(j,1,<=N,++)\n\t\t\t(res[i][j]+=x[i][k]*y[k][j]%mod)%=mod;\n\t\treturn res;\n\t}\n\til void print(re char*s){\n\t\tputs(s);\n\t\tfo(i,1,<=n,++)fo(j,1,<=n,++)\n\t\t\tprintf(\"%d%c\",arr[i][j],\"\\n \"[j<n]);\t\n\t}\n}st,e,g[12],all,ans;\nil Matrix Pow(re Matrix a,re int x){ //\u77e9\u9635\u5feb\u901f\u5e42\n\tre Matrix res(1);\n\tfor(;x;a=a*a,x>>=1)if(x&1) res=res*a;\n\treturn res;\n}\n\n//&Main\nint main(){\n\tscanf(\"%d%d%d%d%d\",&n,&m,&s,&t,&k);\n\ts++,t++,st[1][s]=1; //\u539f\u77e9\u9635\n\tfo(i,1,<=m,++){\n\t\tre int u,v;scanf(\"%d%d\",&u,&v);\n\t\te[u+1][v+1]=e[v+1][u+1]=1; //\u90bb\u63a5\u77e9\u9635\n\t}\n\tscanf(\"%d\",&fish);\n\tfo(i,1,<=fish,++){\n\t\tre int tmp; scanf(\"%d\",&tmp);\n\t\tfo(j,0,<tmp,++) scanf(\"%d\",p[i]+j),p[i][j]++;\n\t\tfo(j,tmp,<12,++) p[i][j]=p[i][j%tmp];\n\t}\n\tre int fb[N+5];\n\tfo(i,0,<12,++){\n\t\tfill(fb+1,fb+n+1,0);\n\t\tfo(j,1,<=fish,++) fb[p[j][i]]=1;\n\t\tfo(j,1,<=n,++)fo(k,1,<=n,++)\n\t\t\tif(!fb[k]) g[i][j][k]=e[j][k]; //12\u79cd\u53d8\u6362\u77e9\u9635\n\t}\n\tall=Matrix(1);\n\tfo(i,1,<12,++) all=all*g[i];\n\tall=all*g[0]; //12\u4e2a\u77e9\u9635\u987a\u6b21\u76f8\u4e58\uff081,2,...,11,0\uff09\n\tans=st*Pow(all,k/12); //\u539f\u77e9\u9635\u4e58\u4ee5\u53d8\u6362\u77e9\u9635\n\tfo(i,1,<=k%12,++) ans=ans*g[i]; //\u4e58\u4ee5\u5269\u4f59 K%12 \u4e2a\u77e9\u9635\n\tprintf(\"%d\\n\",ans[1][t]); //\u7b54\u6848\n\treturn 0;\n}\n```\n\n---\n\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**\n",
        "postTime": 1584938508,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "### \u77e9\u9635\u4f18\u5316dp\n** \u6ce8\u610f\uff1a\u77e9\u9635\u4e58\u6cd5\u6ca1\u6709\u4ea4\u6362\u5f8b **\n\n\u601d\u8def\uff1a\u7c7b\u6bd4P2151hh\u53bb\u6563\u6b65\n\n\u4ee3\u7801\u7279\u70b9\u5728**\u4e00\u7ef4**\u7684\u7b54\u6848\u77e9\u9635\n\n1.\u77e9\u9635\u4f18\u5316\u4e24\u70b9\u95f4\u65b9\u6848\u6570\u4e0d\u5fc5\u8d58\u8ff0\n\n2.\u6ce8\u610f2\uff0c3\uff0c4\u53ef\u4ee5\u529e\u5230\u4ee5\u4ed6\u4eec\u7684lcm\u4e3a\u5468\u671f\uff0c\u6b63\u662f\u56e0\u4e3a\u5982\u6b64\u6211\u4eec\u53ef\u4ee5\u77e9\u9635\u52a0\u901f\uff08\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5316\u52a8\u4e3a\u9759\uff0c\u77e9\u9635\u4e58\u6cd5\u4e86\uff09\n\n3.\u4e00\u7ef4\u521d\u59cb\u77e9\u9635\uff08\u4e00\u7ef4\u90bb\u63a5\u77e9\u9635+\u7b2c\u4e8c\u4e2a\u77e9\u9635\u53d6\u4ea4\u96c6\uff09\u6ce8\u610f\u5f53\u524d\u9cc4\u9c7c\u7684\u4f4d\u7f6e\u4e0e\u6211\u4eec\u4e0b\u4e00\u6b21\u8d70\u5e76\u65e0\u5173\uff0c\u4ed6\u4eec\u6b63\u597d\u6413\u4e86\u4e00\u4f4d\uff0c\u8981\u5c0f\u5fc3\n\n4.\u518d\u6b21\u5f3a\u8c03\uff1a**\u77e9\u9635\u4e58\u6cd5\u6ca1\u6709\u4ea4\u6362\u5f8b**\uff1a\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u6784\u9020\u8f6c\u79fb\u77e9\u9635\u65f6\u8981\u4ece2\u5f00\u59cb\u523012\uff0c\u518d\u4e581\uff08\u8fd9\u91cc\u6307\u7684\u662f\u77e9\u9635\uff09\n\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nint n,m,S,E,k,t,mod=10000;\nint record[20][60],Map[60][60];\nstruct M{\n  int m[60][60];\n  M(){\n    memset(m,0,sizeof(m));\n  }\n  M operator *(const M &a)const {//\u91cd\u8f7d\u5b9a\u4e49\u77e9\u9635\u4e58\u6cd5\n    M ret;\n    for(int i=1;i<=n;++i)\n      for(int j=1;j<=n;++j)\n        for(int k=1;k<=n;++k)\n          ret.m[i][j]=(ret.m[i][j]+m[i][k]%mod*a.m[k][j]%mod)%mod;\n    return ret;\n  }\n}c[20],e,A;\ninline void build(){//\u6784\u9020\u8f6c\u79fb\u77e9\u9635\n  for(int i=1;i<=n;++i)e.m[i][i]=1;\n   for(int i=1;i<=12;++i){\n      for(int j=1;j<=n;++j){\n          for(int k=1;k<=n;++k){           \n            if(Map[j][k]&&(!record[i][j]))c[i].m[k][j]=1;\n          }\n      }\n   }\n   for(int i=2;i<=12;i++)e=e*c[i];//\u77e9\u4e58\u6ca1\u6709\u4ea4\u6362\u5f8b\n   e=e*c[1];//\u56e0\u4e3a\u6211\u4eec\u7684\u7b2c\u4e8c\u4e2a\u77e9\u9635\u8ddf\u7b2c\u4e00\u6b65\u6709\u5173\uff0c\u6240\u4ee5\u5148\u4e582\u77e9\u9635\n}\ninline void power(M &a,M &b,int k){\n  while(k){\n    if(k&1)a=a*b;\n    b=b*b;\n    k>>=1;\n  }\n}//\u77e9\u9635\u5feb\u901f\u5e42\ninline void solve(){//\u6781\u5176\u7e41\u7410\u9700\u8981\u5934\u8111\u51b7\u9759\n  if(k==1){printf(\"%d\",Map[S][E]);return ;}\n  for(int i=1;i<=n;++i)if(Map[S][i]&&c[2].m[S][i])A.m[S][i]=1;//\u5148\u8ddf\u7b2c\u4e8c\u77e9\u9635\u53d6\u4ea4\u96c6\uff0c\u8868\u793a\u8d70\u7b2c\u4e00\u6b65--\u6b64\u5904\u8868\u793a\u6784\u9020\u521d\u59cb\u77e9\u9635\n  if(k<=12)for(int i=3;i<=k+1;++i)A=A*c[i%12];//\u6b64\u5904\u5206\u7c7b\u8ba8\u8bba\n  else {//\u56e0\u4e3a\u521d\u59cb\u77e9\u9635\u7684\u5b58\u5728\uff0c\u6211\u4eec\u5df2\u7ecf\u8d70\u4e86\u4e00\u6b65\n    for(int i=3;i<=12;++i)A=A*c[i];//\u6240\u4ee5\u5728\u8fd9\u91cc\u6211\u4eec\u5148\u66b4\u529b\u8d70\u4e00\u904d\n    A=A*c[1];//\u6ce8\u610f\u4e0d\u80fd\u4ea4\u6362\u5f8b\n    power(A,e,(k/12)-1);//\u5148\u4e58\u4e86\u4e00\u904d\u6240\u4ee5-1\n    for(int i=2;i<=(k-12)%12+1;++i)A=A*c[i];//\u6700\u540e\u518do\u518d\n  }\n  printf(\"%d\",A.m[S][E]);\n}\n\nint main(){\n   scanf(\"%d%d%d%d%d\",&n,&m,&S,&E,&k);\n   S++,E++;//\u52a01\u6bd4\u8f83\u987a\u6211\u7684\u601d\u8def\uff0c\u4e0b\u9762\u7684\u52a01\u540c\n   for(int i=1;i<=m;++i){\n    int x,y;\n    scanf(\"%d%d\",&x,&y);\n    ++x,++y;\n    Map[x][y]=1;\n    Map[y][x]=1;\n   }\n   scanf(\"%d\",&t);\n   for(int i=1;i<=t;++i){\n     int num;\n     scanf(\"%d\",&num);\n     for(int j=1;j<=num;++j){\n      int x;\n      scanf(\"%d\",&x);\n      int k=j;\n      x++;\n      while(k<=12){\n        record[k][x]=1;\n            k+=num;\n      }//12\u4e00\u5faa\u73af\n     }\n   }\n   build();\n   solve();\n   return 0;\n}\n```",
        "postTime": 1530614048,
        "uid": 56838,
        "name": "wangjyqh",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "## \u9898\u76ee\u603b\u7ed3\n\n\u4e00\u4e2a\u65e0\u5411\u56fe\uff0c\u6bcf\u4e00\u65f6\u523b\u6709\u4e00\u4e9b\u70b9\u4e0d\u80fd\u5230\u8fbe\uff0c\u8fd9\u4e9b\u70b9\u7684\u51fa\u73b0\u4ee512\u4e3a\u6700\u5c0f\u516c\u500d\u6570\uff0c\u6c42s\u5230t\u7684\u8def\u5f84\u6570\uff1b\n\n## \u6570\u636e\u8303\u56f4\n\n 1 \u2264 N \u2264 50\n\n 1 \u2264 K \u2264 2,000,000,000\n\n 1 \u2264 NFish \u2264 20\n\n## \u89e3\u9898\u601d\u8def\n\n\u5904\u7406\u51fa\u6bcf\u4e00\u65f6\u523b\u7684\u90bb\u63a5\u77e9\u9635\uff0c12\u7684\u6574\u6570\u500d\u6709\u5feb\u901f\u5e42\uff0c\u5269\u4e0b\u7684\u624b\u52a8\u4e58\uff0c\u6ce8\u610f\u987a\u5e8f\uff1b\n\n## \u6613\u9519\u8bef\u533a\n\n**\u4e0d\u8be5\u52a0\u7684\u4ee3\u7801\u4e00\u5b9a\u4e0d\u8981\u52a0**\n\n```cpp\nday[i][k][t] = 0;\n//day[i][t][k] = 0;\n```\n\n\u6ce8\u91ca\u6389\u7684\u90a3\u4e00\u884c\u4e0d\u53ef\u4ee5\u52a0\uff0c\u56e0\u4e3a\u5047\u5982\u6b64\u65f6\u4f60\u5df2\u7ecf\u5230\u8fbe\u90a3\u4e2a\u70b9\uff0c\u800c\u98df\u4eba\u9c7c\u5728\u8def\u4e0a\uff0c\u4f60\u662f\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u70b9\u5230\u5176\u4ed6\u70b9\u7684\uff1b\n\n**\u77e9\u9635\u4e58\u6cd5\u6ca1\u6709\u4ea4\u6362\u5f8b**\n\n\u4e58\u6cd5\u4e00\u5b9a\u6309\u987a\u5e8f\uff0c\u4ece1\u4e58\u523011\uff0c\u518d\u4e580\uff1b\n\n## \u4ee3\u7801\u5c55\u793a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cmath>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<vector>\n#include<map>\n#include<set>\n#include<list>\n#include<queue>\n#include<stack>\n#include<bitset>\n#include<deque>\nusing namespace std;\n#define ll long long\n#define inf 0x3f3f3f3f\n#define ri register int\n#define il inline\n#define fi first\n#define se second\n#define mp make_pair\n#define pi pair<int,int>\n#define mem0(x) memset((x),0,sizeof (x))\n#define mem1(x) memset((x),0x3f,sizeof (x))\nil char gc() {\n    static const int BS = 1 << 22;\n    static unsigned char buf[BS], *st, *ed;\n    if (st == ed) ed = buf + fread(st = buf, 1, BS, stdin);\n    return st == ed ? EOF : *st++;\n}\n#define gc getchar\ntemplate<class T>void in(T &x)\n{\n    x = 0; bool f = 0; char c = gc();\n    while (c < '0' || c > '9') {if (c == '-') f = 1; c = gc();}\n    while ('0' <= c && c <= '9') {x = (x << 3) + (x << 1) + (c ^ 48); c = gc();}\n    if (f) x = -x;\n}\n#undef gc\nvoid out(int x) {\n    if (x < 0) putchar('-'), x = -x;\n    if (x > 9) out(x / 10);\n    putchar(x % 10 + '0');\n}\n#define Maxsz 130\n#define md 10000\n#define sz n\nil void mod(int &x) {\n    while (x > md) x -= md;\n    while (x < 0) x += md;\n}\nint n, m, st, en, d, nf;\nstruct Mat {\n    int m[Maxsz][Maxsz];\n    il void clear() {mem0(m);}\n    Mat () {clear();}\n    int* operator[](int x) {\n        return this->m[x];\n    }\n    Mat operator*(const Mat &x)const {\n        Mat res;\n        for (ri i = 1; i <= sz; i++) {\n            for (ri k = 1; k <= sz; k++) {\n                for (ri j = 1; j <= sz; j++)\n                    mod(res.m[i][j] += m[i][k] * x.m[k][j] % md);\n            }\n        }\n        return res;\n    }\n    void operator*=(const Mat &x) {\n        *this = (*this) * x;\n    }\n    void operator+=(const Mat &x) {\n        for (ri i = 1; i <= sz; ++i) {\n            for (ri j = 1; j <= sz; ++j) {\n                mod(m[i][j] += x.m[i][j]);\n            }\n        }\n    }\n    Mat operator+(const Mat &x)const {\n        Mat res = *this;\n        res += x;\n        return res;\n    }\n    void print() {\n        for (ri i = 1; i <= sz; i++) {\n            for (ri j = 1; j <= sz; j++)\n                printf(\"%lld \", m[i][j]);\n            puts(\"\");\n        }\n        puts(\"*****************\");\n    }\n    void toe() {\n        clear();\n        for (ri i = 1; i <= sz; i++)\n            m[i][i] = 1;\n    }\n    Mat qpow(int x) {\n        Mat res, mul = *this;\n        if (x == 0) {\n            res.toe();\n            return res;\n        }\n        res = *this; --x;\n        for (; x; x >>= 1, mul *= mul) if (x & 1) res *= mul;\n        return res;\n    }\n} pri, day[15], s;\n#define N 55\n#define M 2010\nint v[M], u[M], nx[M];\nint cnt, head[N];\nil void add(int uu, int vv) {\n    u[++cnt] = uu, v[cnt] = vv, nx[cnt] = head[uu];\n    head[uu] = cnt;\n}\nint fish[25][8];\nint zh, res;\nsigned main() {\n    in(n), in(m), in(st), in(en), in(d);\n    ++st, ++en;\n    for (ri i = 1, a, b; i <= m; ++i) {\n        in(a), in(b);\n        ++a, ++b;\n        add(a, b);\n        add(b, a);\n        pri[a][b] = pri[b][a] = 1;\n    }\n    in(nf);\n    for (ri i = 1; i <= nf; ++i) {\n        in(fish[i][5]);\n        for (ri j = 0; j < fish[i][5]; ++j) {\n            in(fish[i][j]);\n            fish[i][j]++;\n        }\n    }\n    day[13].toe();\n    for (ri i = 0; i < 12; ++i) {\n        day[i] = pri;\n        for (ri j = 1, t; j <= nf; ++j) {\n            t = fish[j][i % fish[j][5]];\n            for (ri k = 1; k <= n; ++k) {\n                day[i][k][t] = 0;\n                //day[i][t][k] = 0;\n            }\n        }\n        //day[i].print();\n        if (i) day[13] *= day[i];\n    }\n    day[13] *= day[0];\n    zh = (int)(d / 12);\n    res = d % 12;\n    day[13] = day[13].qpow(zh);\n    //day[13].print();\n    for (ri i = 0; i < res; ++i) day[13] *= day[(i + 1) % 12];\n    // day[13].print();\n    printf(\"%lld\", day[13][st][en]);\n    return 0;\n}\n```",
        "postTime": 1530403814,
        "uid": 58302,
        "name": "i207M",
        "ccfLevel": 0,
        "title": "\u77e9\u9635\u52a0\u901f-[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c-\u89e3\u9898\u62a5\u544a"
    },
    {
        "content": "\u5148\u628a\u65e0\u5411\u8fb9\u62c6\u6210\u4e24\u6761\u6709\u5411\u8fb9\u3002\n\n\u5982\u679c\u4e0d\u8003\u8651\u98df\u4eba\u9c7c\uff0c\u90a3\u4e48\u6b64\u9898\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u77e9\u4e58\u95ee\u9898\u3002\u5efa\u7acb\u77e9\u9635$P$\uff0c\u5982\u679c\u5b58\u5728\u8fb9$i->j$\u5219$P[i][j]=1$\uff0c\u5426\u5219$P[i][j]=0$\u3002\n\n\u6700\u540e$P^K[Start][End]$\u5c31\u662f\u6700\u7ec8\u7ed3\u679c\u3002\n\n\u8003\u8651\u98df\u4eba\u9c7c\u3002\u6ce8\u610f\u5230\u9898\u76ee\u91cc\u98df\u4eba\u9c7c\u7684\u8fd0\u52a8\u5468\u671f\u957f\u5ea6\u53ea\u6709$2$\uff0c$3$\uff0c$4$\uff0c\u53ef\u4ee5\u5f97\u51fa\uff0c\u7b2c$t$\u4e2a\u65f6\u95f4\u5355\u4f4d\u65f6\u662f\u5426\u53ef\u4ee5\u5728\u8fd9\u4e2a\u70b9\u4e0a\uff08\u6ca1\u6709\u98df\u4eba\u9c7c\u7ecf\u8fc7\uff09\uff0c\u53d6\u51b3\u4e8e$t\\mod 12$\u7684\u503c\u3002\u6240\u4ee5\u8fd9\u91cc\uff0c\u5148\u9884\u5904\u7406\u51fa\u4e00\u4e2a\u6570\u7ec4$vis[j][i]$\uff0c\u5982\u679c\u5f53\u524d\u7684\u65f6\u95f4\u53d6\u6a21$12$\u7684\u503c\u4e3a$j$\uff0c$vis[j][i]$\u4e3a\u5047\u8868\u793a\u6b64\u65f6\u53ef\u4ee5\u5728\u70b9$i$\u4e0a\uff0c\u4e3a\u771f\u8868\u793a\u6b64\u65f6\u4e0d\u80fd\u5728\u70b9$i$\u4e0a\u3002\n\n\u6784\u9020\u51fa$12$\u4e2a\u77e9\u9635$P_0,P_1,P_2,...,P_{11}$\uff0c\u5206\u522b\u50a8\u5b58\u5f53\u524d\u5355\u4f4d\u65f6\u95f4\u6a21$12$\u7684\u503c\u4e3a $0,1,2,...,11$\u65f6\u7684\u90bb\u63a5\u77e9\u9635\u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u8fb9$i->j$\uff0c\u5982\u679c$vis[k][j]$\u4e3a\u5047\uff0c\u90a3\u4e48$P_k[i][j]=1$\uff0c\u5426\u5219\u5982\u679c\u4e0d\u5b58\u5728\u8fb9$i->j$\u6216\u8005$vis[k][j]$\u4e3a\u771f\uff0c\u90a3\u4e48$P_k[i][j]=0$\u3002\n\n\u6b64\u65f6\u4ee4\u77e9\u9635$Q=P_1*P_2*P_3*...*P_{11}*P_0$\u3002\n\n\u5e76\u6c42\u77e9\u9635$F=Q^{\\lfloor\\frac{K}{12}\\rfloor}$\uff0c\n\n\u5c31\u5f97\u5230\u4e86\u5728\u6070\u597d$\\lfloor\\frac{K}{12}\\rfloor*12$\u7684\u65f6\u95f4\u5185\u4efb\u610f\u4e24\u70b9\u4e92\u76f8\u5230\u8fbe\u7684\u65b9\u6848\u6570\u3002\u7531\u4e8e\u5269\u4e0b\u7684\u4e0d\u4f1a\u8d85\u8fc7$12$\u4e2a\u65f6\u95f4\u5355\u4f4d\uff0c\u6240\u4ee5\u5bf9\u4e8e\u5269\u4f59\u7684\u65f6\u95f4\u5355\u4f4d\uff0c\u66b4\u529b\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\ninline int read() {\n    int res = 0; bool bo = 0; char c;\n    while (((c = getchar()) < '0' || c > '9') && c != '-');\n    if (c == '-') bo = 1; else res = c - 48;\n    while ((c = getchar()) >= '0' && c <= '9')\n        res = (res << 3) + (res << 1) + (c - 48);\n    return bo ? ~res + 1 : res;\n}\nconst int N = 55, M = 3005, PYZ = 1e4;\nstruct cyx {\n    int m, n, v[N][N];\n    cyx() {}\n    cyx(int _m, int _n) :\n        m(_m), n(_n) {memset(v, 0, sizeof(v));}\n    friend inline cyx operator * (cyx a, cyx b) {\n        cyx res = cyx(a.m, b.n); int i, j, k;\n        for (i = 1; i <= res.m; i++) for (j = 1; j <= res.n; j++)\n        for (k = 1; k <= a.n; k++)\n            (res.v[i][j] += a.v[i][k] * b.v[k][j]) %= PYZ;\n        return res;\n    }\n    friend inline cyx operator ^ (cyx a, int b) {\n        int i, d = b; cyx c = a, res = cyx(a.m, a.n);\n        for (i = 1; i <= res.m; i++) res.v[i][i] = 1;\n        while (d) {\n            if (d & 1) res = res * c;\n            c = c * c;\n            d >>= 1;\n        }\n        return res;\n    }\n} P[15], Q, F;\nint n, m, S, T, K, nf, ecnt, nxt[M], adj[N], go[M];\nbool vis[15][N];\nvoid add_edge(int u, int v) {\n    nxt[++ecnt] = adj[u]; adj[u] = ecnt; go[ecnt] = v;\n}\nint main() {\n    int i, j, k, x, y; n = read(); m = read(); S = read() + 1;\n    T = read() + 1; K = read(); for (i = 1; i <= m; i++) {\n        x = read() + 1; y = read() + 1;\n        add_edge(x, y); add_edge(y, x);\n    }\n    nf = read(); for (i = 1; i <= nf; i++) {\n        x = read(); for (j = 0; j < x; j++) {\n            y = read() + 1;\n            for (k = j; k < 12; k += x)\n                vis[k][y] = 1;\n        }\n    }\n    Q = cyx(n, n); for (i = 1; i <= n; i++) Q.v[i][i] = 1;\n    for (j = 0; j < 12; j++) {\n        P[j] = cyx(n, n);\n        for (i = 1; i <= n; i++)\n            for (int e = adj[i]; e; e = nxt[e])\n                if (!vis[j][go[e]]) P[j].v[i][go[e]] = 1;\n        if (j) Q = Q * P[j];\n    }\n    Q = Q * P[0]; F = Q ^ (K / 12);\n    for (j = 1; j <= K % 12; j++) F = F * P[j];\n    printf(\"%d\\n\", F.v[S][T]);\n    return 0;\n}\n```",
        "postTime": 1503837705,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "## \u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011\n\n[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P2579)\n\n\u3010\u5206\u6790\u3011\n\n\u5982\u679c\u4e0d\u8003\u8651\u98df\u4eba\u9c7c\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u8fd9\u9053\u9898\u5c31\u662f\u4e00\u4e2a\u7279\u522b\u6a21\u677f\u7684\u90bb\u63a5\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u4e0d\u4f1a\u77e9\u9635\u5feb\u901f\u5e42\u7684[\u6233\u8fd9\u91cc](https://www.bilibili.com/video/BV1D5411Y7Vb)\uff08\u6211\u7684\u505a\u7684\u8bb2\u89e3\u89c6\u9891\uff09\u3002\n\n\u4f46\u662f\u5982\u679c\u52a0\u4e0a\u98df\u4eba\u9c7c\uff0c\u53c8\u8be5\u600e\u4e48\u505a\u5462\uff1f\u6211\u4eec\u53d1\u73b0\uff0c\u98df\u4eba\u9c7c\u7684\u5468\u671f\u603b\u662f $2,3,4$\uff0c\u4e5f\u5c31\u662f\u8bf4\u6240\u6709\u98df\u4eba\u9c7c\u7684\u6e38\u52a8\u5468\u671f\u662f $12$\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5148\u628a\u8fd9 $12$ \u4e2a\u72b6\u6001\uff08\u90bb\u63a5\u77e9\u9635\uff09\u7b97\u51fa\u6765\uff0c\u7136\u540e\u518d\u628a\u4ed6\u4eec\u5f53\u6210\u4e00\u4e2a\u6574\u4f53\u53bb\u8fdb\u884c\u77e9\u9635\u5feb\u901f\u5e42\u4e0d\u5c31\u884c\u4e86\u5417\uff1f\u4f59\u4e0b\u7684\u53ea\u9700\u8981\u5355\u72ec\u5904\u7406\u5c31\u884c\u4e86\u3002\n\n\u6240\u4ee5\u603b\u4f53\u4e0a\uff0c\u8fd9\u9053\u9898\u8fd8\u662f\u6bd4\u8f83\u5957\u8def\u7684\u3002\n\n\u4e0b\u9762\u662f AC \u4ee3\u7801\n\n```cpp\n/*\nluogu P2579\n*/\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\nconst int M = 1e4;\n\nint n,m,fis,s,t,k;\nint x[5005],y[5005],mov[5];\nbool saf[13][55];\nstruct matrix{\n\tint mat[55][55];\n\tvoid init()\n\t{\n\t\tmemset(mat,0,sizeof(mat));\n\t}\n\tmatrix operator * (const matrix b) const\n\t{\n\t\tmatrix res;\n\t\tres.init();\n\t\tfor(int k=1;k<=n;k++)\n\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\t\tres.mat[i][j] = (res.mat[i][j]+mat[i][k]*b.mat[k][j])%M;\n\t\treturn res;\n\t}\n}g[20],st;\n\nmatrix ksm(matrix x,int w)\n{\n\tmatrix s=st;\n\twhile(w)\n\t{\n\t\tif(w&1)\n\t\t\ts = s*x;\n\t\tx = x*x;\n\t\tw >>= 1;\n\t}\n\treturn s;\n}\n\nsigned main()\n{\n\tcin>>n>>m>>s>>t>>k;\n\ts++, t++;\n\tfor(int i=1;i<=m&&cin>>x[i]>>y[i];i++)\n\t\tx[i]++, y[i]++;\n\tcin>>fis;\n\tfor(int i=1,tim;i<=fis&&cin>>tim;i++)\n\t{\n\t\tfor(int j=1;j<=tim&&cin>>mov[j];j++)\n\t\t\tmov[j]++;\n\t\tmov[0] = mov[tim];\n\t\tfor(int j=1;j<=12;j++)\n\t\t\tsaf[j][mov[j%tim]] = true;\n\t}\n\tfor(int i=1;i<12;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tif(!saf[i+1][y[j]])\n\t\t\t\tg[i].mat[x[j]][y[j]] = 1;\n\t\t\tif(!saf[i+1][x[j]])\n\t\t\t\tg[i].mat[y[j]][x[j]] = 1;\n\t\t}\n\t}\n\tfor(int j=1;j<=m;j++)\n\t{\n\t\tif(!saf[1][y[j]])\n\t\t\tg[12].mat[x[j]][y[j]] = 1;\n\t\tif(!saf[1][x[j]])\n\t\t\tg[12].mat[y[j]][x[j]] = 1;\n\t}\n\tst = g[1];\n\tint tim=k/12,r=k%12;\n\tif(tim>0)\n\t{\n\t\tfor(int i=2;i<=12;i++)\n\t\t\tst = st*g[i];\n\t\tst = ksm(st,tim-1);\n\tfor(int i=1;i<=r;i++)\n\t\tst = st*g[i];\n\t}\n\telse\n\t{\n\t\tfor(int i=2;i<=r;i++)\n\t\t\tst = st*g[i];\n\t}\n\tcout<<st.mat[s][t]%M<<endl;\n\t\n\treturn 0;\n}\n```\n\n\u795d\u5927\u5bb6 AC \u6109\u5feb\uff01",
        "postTime": 1594797238,
        "uid": 123298,
        "name": "kouylty",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u60f3\u5230DP\n\ni\u4e3a\u73b0\u5728\u7684\u65f6\u95f4\n\nf[i][j] += f[i - 1][k] (k\u53ef\u4ee5\u5230j\uff0c\u4e14j\u4e0a\u6ca1\u6709\u98df\u4eba\u9c7c)\n\n\u800c\u8fd9\u6837\u663e\u7136\u4f1a\u8d85\u65f6\n\n\u7136\u540e\u53ef\u4ee5\u53d1\u73b0n\u7684\u8303\u56f4\u8d85\u5c0f\uff0ck\u7684\u8303\u56f4\u8d85\u5927\uff0c\u8fd8\u8981mod10000\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u60f3\u5230\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u7136\u540e\u53c8\u53d1\u73b0\u9c7c\u7684\u5faa\u73af\u5468\u671f\u53ea\u67092\u52304\uff0c\u6700\u5c0f\u516c\u500d\u6570\u53ea\u670912\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u5e72\u8106\u6c42\u51fa12\u79cd\u7684\u77e9\u9635\u7136\u540e\u4e58\u5728\u4e00\u8d77\u53bb\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u7136\u540e\u5bf9\u4e8ek mod \u6700\u5c0f\u516c\u500d\u6570\u5c31\u4e00\u4e2a\u4e00\u4e2a\u4e58\u4e0a\u53bb\n\n\u5bf9\u4e8e\u521d\u59cb\u7684\u77e9\u9635\uff08\u6ca1\u6709\u98df\u4eba\u9c7c\uff09\u5c31\u628a\u4e24\u7aef\u77f3\u58a9\u7684\u503c+1\u5c31\u884c\u4e86\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define mod 10000\nusing namespace std;\n\nstruct node{\n    int a[51][51]; //\u77e9\u9635\n}xs[13], txs, tmp, f;\n\nstruct data{\n    int t;\n    int p[4];//\u9c7c\n}fi[21];\n\nint n, m, st, en, k, fish, lcg = 1;\n\nnode mul(node x, node y)//\u77e9\u9635\u4e58\u6cd5\n{\n    node res;\n    memset(res.a, 0, sizeof(res.a));\n    for(int i = 0; i < n; i++)\n        for(int j = 0; j < n; j++)\n            for(int k = 0; k < n; k++)\n                res.a[i][j] = (res.a[i][j] + x.a[i][k] % mod * y.a[k][j] % mod) % mod;\n    return res;\n}\n\nnode qmul(node xs, int n)//\u5feb\u901f\u5e42\n{\n    node res = f;\n    while(n > 0)\n    {\n        if(n & 1) res = mul(res, xs);\n        xs = mul(xs, xs);\n        n >>= 1;\n    }\n    return res;\n}\n\nvoid init(node &x)\n{\n    memset(x.a, 0, sizeof(x.a));\n    for(int i = 0; i < n; i++) x.a[i][i] = 1;\n}\n\nint main()\n{\n    scanf(\"%d%d%d%d%d\", &n, &m, &st, &en, &k);\n    for(int i = 1; i <= m; i++)\n    {\n        int x, y;\n        scanf(\"%d%d\", &x, &y);\n        txs.a[x][y]++, txs.a[y][x]++;//\u521d\u59cb\u77e9\u9635\uff08\u6ca1\u6709\u98df\u4eba\u9c7c\uff09\n    }\n    scanf(\"%d\", &fish);\n    init(tmp);//\u4f7f\u5f97tmp\u4e58\u4efb\u4f55\u77e9\u9635\u7b49\u4e8e\u4efb\u4f55\u77e9\u9635\n    for(int i = 1; i <= fish; i++)\n    {\n        scanf(\"%d\", &fi[i].t);\n        if(lcg % fi[i].t) lcg *= fi[i].t;\n        for(int j = 0; j < fi[i].t; j++) scanf(\"%d\", &fi[i].p[j]);\n    }\n    if(lcg == 24) lcg = 12;//\u6c42\u6700\u5c0f\u516c\u500d\u6570\n    for(int i = 0; i < lcg; i++)\n    {\n        for(int j = 0; j < n; j++)\n            for(int k = 0; k < n; k++) xs[i].a[j][k] = txs.a[j][k];\n        for(int j = 1; j <= fish; j++)\n        {\n            int x = fi[j].p[i % fi[j].t];\n            for(int k = 0; k < n; k++)\n                for(int l = 0; l < n; l++) if(k == x) xs[i].a[k][l] = 0;//\u6c42\u51fa\u6240\u6709\u77e9\u9635\n        }\n        tmp = mul(tmp, xs[i]);//\u628a\u6240\u6709\u7684\u77e9\u9635\u4e58\u8d77\u6765\n    }\n    f.a[0][st] = 1;\n    node res = qmul(tmp, k / 12);\n    for(int i = 0; i < k % 12; i++) res = mul(res, xs[i]);\n    printf(\"%d\\n\", res.a[0][en]);\n    return 0;\n}\n```\n\n",
        "postTime": 1563001242,
        "uid": 98468,
        "name": "abs001",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    },
    {
        "content": "\u770b\u4e0a\u53bb\u50cf\u662f\u4e2a\u641c\u7d22\u3002\u4f46\u662fk\u5b9e\u5728\u592a\u5927\uff0cO(k)\u90fd\u4f1a\u8d85\u65f6\uff0c\u4f46\u662f\u77f3\u67f1\u5e76\u4e0d\u591a\uff08\u5982\u679c\u592a\u591a\u5219\u77e9\u9635\u4f1a\u592a\u5927\uff0c\u7206\u5185\u5b58\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528\u77e9\u9635\u4e58\u6cd5\u3002\n\n\u9c7c\u7684\u5468\u671f\u53ea\u4e3a2\uff0c3\uff0c4\uff0c\u6240\u4ee5\u6700\u591a12\u6b65\u4e00\u4e2a\u5468\u671f\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u65f6\u523b\u7684\u90bb\u63a5\u77e9\u9635\u76f8\u4e58\uff0c\u4fbf\u53ef\u77e5\u9053\u8def\u5f84\u7684\u6570\u76ee\u3002\u5f53a[i,k]>0,b[k,j]>0\u65f6\uff0c\u5373i\u2014>k\u548ck\u2014>j\u90fd\u6709\u8def\u5f84\u65f6c[I,j]\u624d\u6709\u8def\u5f84\uff0c\u4e14\u7b49\u4e8e\u5b9e\u9645i\u2014j\u7684\u8def\u5f84\u3002\n\nA[i]\u4ee3\u8868\u7b2ci\u4e2a\u65f6\u523b\u7684\u90bb\u63a5\u77e9\u9635,Ans[start,end]\u4e3a\u6240\u6c42\u3002\u90a3\u4e48Ans=A[1]\\*A[2]\\*A[3]\\*\u2026..\\*A[K]\n\n\u6211\u4eec\u77e5\u905312\u6b65\u4e00\u4e2a\u5468\u671f\uff0c\n\nA[1]\\*A[2]\\*\u2026\u2026\\*A[12]=A[12p+1]\\*A[12p+2]\\*\u2026\u2026\\*A[12p+12] (p\u4e3a\u4efb\u610f\u6b63\u6574\u6570)\n\n\u90a3\u4e48\nAns=(A[1]\\*A[2]\\*\u2026\u2026\\*A[12])k div 12 \\*(A[1]\\*A[2]\\*\u2026\u2026\\*A[k mod 12])\n\n \n\u6211\u4eec\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u6c42\u51faG k div 12(G=A[1]\\*A[2]\\*\u2026\u2026\\*A[12]),\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4e3aO(log n)\n\n \n\u4ee3\u7801\uff1a\n\n\n\n\n\n```cpp\nconst\n  p=10000;\ntype\n  arr=array[1..50,1..50] of longint;\nvar\n  n,m,s,e,t,w1,nf,x,y,i,j,k,u:longint;\n  a,c,d:arr;\n  f:array[1..12] of arr;\n  w:array[1..4] of longint;\nprocedure cheng(a,b:arr);\nvar\n  i,j,k:longint;\nbegin\n  fillchar(c,sizeof(c),0);\n  for i:=1 to n do\n    for j:=1 to n do\n      for k:=1 to n do\n        c[i,j]:=(c[i,j]+a[i,k]*b[k,j]) mod p;\nend;\nprocedure ksm(x:longint);\nbegin\n  if x=0 then exit;\n  ksm(x div 2);\n  cheng(c,c);\n  if x mod 2=1 then cheng(c,d);\nend;\nbegin\n  readln(n,m,s,e,t);\n  for i:=1 to m do\n  begin\n    readln(x,y);\n    a[x+1,y+1]:=1;\n    a[y+1,x+1]:=1;\n  end;\n  readln(nf);\n  for i:=1 to 12 do\n    f[i]:=a;\n  for i:=1 to nf do\n  begin\n    read(w1);\n    for j:=1 to w1 do\n      read(w[j]);\n    for j:=1 to 12 do\n    begin  \n      u:=j mod w1+1;\n      for k:=1 to n do\n        f[j,k,w[u]+1]:=0;\n    end;\n  end;\n  for i:=1 to n do\n    c[i,i]:=1;\n  for i:=1 to 12 do\n    cheng(c,f[i]);\n  d:=c;\n  fillchar(c,sizeof(c),0);\n  for i:=1 to n do\n    c[i,i]:=1;\n  ksm(t div 12);\n  for i:=1 to t mod 12 do\n    cheng(c,f[i]);\n  writeln(c[s+1,e+1]);\nend.\n\n```",
        "postTime": 1492215193,
        "uid": 18895,
        "name": "liangzihao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2579 \u3010[ZJOI2005]\u6cbc\u6cfd\u9cc4\u9c7c\u3011"
    }
]