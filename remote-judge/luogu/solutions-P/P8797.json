[
    {
        "content": "~~\u6570\u636e\u592a\u5f3a\u5566~~\r\n\r\n\u4e00\u9053\u4e3b\u5e2d\u6811\u597d\u9898\r\n\r\n\u5f88\u663e\u7136\u8981\u4e8c\u5206 $h$ \uff0c\u90a3\u4e48\u95ee\u9898\u5c31\u662f\u5feb\u901f\u5904\u7406\u4e2d\u95f4\u9ad8\u5ea6\u5c0f\u4e8e $h$ \u7684\u5706\u5708\u4e2a\u6570\u3002\r\n\r\n\u6839\u636e\u5206\u5757\u7684\u601d\u60f3\uff0c\u6211\u4eec\u628a\u4e00\u4e2a\u533a\u95f4\u5206\u6210\u4e09\u90e8\u5206\uff1a\r\n\r\n\u5de6\u7aef\u70b9\u6240\u5728\u4e09\u89d2\u5f62 $L$ \uff0c\u53f3\u7aef\u70b9\u6240\u5728\u4e09\u89d2\u5f62 $R$ \uff0c\u4e2d\u95f4\u7684\u4e09\u89d2\u5f62 $L+1 \\sim R-1$  \u3002\r\n\r\n\u7136\u540e\u5206\u7c7b\u8ba8\u8bba\uff1a\r\n\r\n$L = R$ \u65f6:\r\n\r\n\u8bf4\u660e\u5de6\u53f3\u7aef\u70b9\u5728\u540c\u4e2a\u4e09\u89d2\u5f62\u5185\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\u9ad8\u5ea6\u5c0f\u4e8e $h$ \u7684\u5706\u5708\u4e2a\u6570\u3002\r\n\r\n```cpp\r\nint calc(int i,int l,int r,int h){\r\n\t//\u7b2ci\u4e2a\u4e09\u89d2\u5f62 \u7b2cl~r\u5217 \u9ad8\u5ea6\u4e0d\u5927\u4e8eh\u7684\u5706\u5708\u4e2a\u6570\r\n\tint v1,v2;\r\n\tif(b[i]==0) v1=l,v2=r;\r\n\tif(b[i]==1) v1=a[i]-r+1,v2=a[i]-l+1;\r\n\t\r\n\tif(h<=v1) return h*(r-l+1);\r\n\tif(h>v2)  return (v2+v1)*(r-l+1)/2;\r\n\treturn (v2-h)*h+(h+v1)*(h-v1+1)/2;\r\n}\r\n```\r\n\r\n\r\n$L \\neq R$ \u65f6:\r\n\r\n\u6bd4\u8f83\u9ebb\u70e6\uff0c\u5de6\u53f3\u4e24\u8fb9\u53ef\u4ee5\u901a\u8fc7 ``calc`` \u51fd\u6570\u5feb\u901f\u8ba1\u7b97\uff0c\u95ee\u9898\u5728\u4e8e\u4e2d\u95f4\u7684\u5b8c\u6574\u4e09\u89d2\u5f62\u3002\r\n\r\n\u76f4\u63a5\u8ba1\u7b97\u7b26\u5408\u6761\u4ef6\u7684\u5706\u5708\u4e2a\u6570\u6bd4\u8f83\u96be\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u603b\u4e2a\u6570-\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e2a\u6570\u3002\r\n\r\n\u8bbe\u4e2d\u95f4\u5b8c\u6574\u4e09\u89d2\u5f62**\u9ad8\u5ea6\u5927\u4e8eh**\u7684\u9ad8\u5ea6\u4e3a $h_1,h_2 ... h_k$ \uff0c\u90a3\u4e48\u4e0d\u7b26\u5408\u6761\u4ef6\u5706\u5708\u4e2a\u6570\u7b49\u4e8e\uff1a\r\n\r\n${\\frac{1}{2}} \\sum_{i=1}^{k} (h-h_i)(h-h_i+1)$\r\n\r\n$= {\\frac{1}{2}} \\sum_{i=1}^{k} (h^{2}-2h_ih+h_i^{2}+h+1)$\r\n\r\n\u8bbe $S_1= \\sum_{i=1}^{k}h_i , S_2= \\sum_{i=1}^{k}h_i^{2}$\r\n\r\n\u90a3\u4e48\u539f\u5f0f $= \\frac{1}{2}(h^{2}k-2S_1h+S_2+kh+k)$\r\n\r\n\u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u4e3b\u5e2d\u6811\uff0c\u533a\u95f4\u4ee3\u8868\u4e09\u89d2\u5f62\u9ad8\u5ea6\uff0c\u5feb\u901f\u67e5\u8be2 $S_1 , S_2 , k$ \uff0c\u8fdb\u800c\u8ba1\u7b97\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u5706\u5708\u4e2a\u6570\u3002\r\n\r\n\u4ee3\u7801\u5982\u4e0b\uff0c\u5e38\u6570\u7565\u5927\uff0c\u4e0d\u5f00 $O2$ \u8fc7\u4e0d\u4e86 QAQ\r\n\r\n```cpp\r\n#include<cmath>\r\n#include<cstdio>\r\n#include<algorithm>\r\n#define int long long\r\nusing namespace std;\r\nconst int M=1e6+10;\r\nconst int inf=1000000;\r\n\r\nint L[M],R[M];\r\nint pre[M],cnt_pre[M],a[M],b[M],n,m;\r\n\r\nint calc(int i,int l,int r,int h){\r\n\tint v1,v2;\r\n\tif(b[i]==0) v1=l,v2=r;\r\n\tif(b[i]==1) v1=a[i]-r+1,v2=a[i]-l+1;\r\n\t\r\n\tif(h<=v1) return h*(r-l+1);\r\n\tif(h>v2)  return (v2+v1)*(r-l+1)/2;\r\n\treturn (v2-h)*h+(h+v1)*(h-v1+1)/2;\r\n}\r\n\r\nstruct PresidentTree{\r\n\tint lc,rc,sum,sqs,cnt;\r\n\t//sum[k,k]=k sqs[k,k]=k*k cnt[k,k]=1\r\n}tr[M<<3];\r\nint rt[M],cntv;\r\nvoid pushup(int k){\r\n\ttr[k].sum=tr[tr[k].lc].sum+tr[tr[k].rc].sum;\r\n\ttr[k].sqs=tr[tr[k].lc].sqs+tr[tr[k].rc].sqs;\r\n\ttr[k].cnt=tr[tr[k].lc].cnt+tr[tr[k].rc].cnt;\r\n}\r\nvoid update(int &k,int pre,int l,int r,int pos,int h){\r\n\ttr[k=++cntv]=tr[pre];\r\n\tif(l==r){\r\n\t\ttr[k].sum+=h;\r\n\t\ttr[k].sqs+=h*h;\r\n\t\ttr[k].cnt+=1;\r\n\t\treturn;\r\n\t}\r\n\tint mid=(l+r)>>1;\r\n\tif(pos<=mid) update(tr[k].lc,tr[pre].lc,l,mid,pos,h);\r\n\telse update(tr[k].rc,tr[pre].rc,mid+1,r,pos,h);\r\n\tpushup(k);\r\n}\r\nint query_sum(int k,int pre,int L,int R,int l,int r){\r\n\tif(L<=l and r<=R) return tr[k].sum-tr[pre].sum;\r\n\tint mid=(l+r)>>1,ans=0;\r\n\tif(L<=mid) ans+=query_sum(tr[k].lc,tr[pre].lc,L,R,l,mid);\r\n\tif(R>mid)  ans+=query_sum(tr[k].rc,tr[pre].rc,L,R,mid+1,r);\r\n\treturn ans;\r\n}\r\nint query_sqs(int k,int pre,int L,int R,int l,int r){\r\n\tif(L<=l and r<=R) return tr[k].sqs-tr[pre].sqs;\r\n\tint mid=(l+r)>>1,ans=0;\r\n\tif(L<=mid) ans+=query_sqs(tr[k].lc,tr[pre].lc,L,R,l,mid);\r\n\tif(R>mid)  ans+=query_sqs(tr[k].rc,tr[pre].rc,L,R,mid+1,r);\r\n\treturn ans;\r\n}\r\nint query_cnt(int k,int pre,int L,int R,int l,int r){\r\n\tif(L<=l and r<=R) return tr[k].cnt-tr[pre].cnt;\r\n\tint mid=(l+r)>>1,ans=0;\r\n\tif(L<=mid) ans+=query_cnt(tr[k].lc,tr[pre].lc,L,R,l,mid);\r\n\tif(R>mid)  ans+=query_cnt(tr[k].rc,tr[pre].rc,L,R,mid+1,r);\r\n\treturn ans;\r\n}\r\n\r\nsigned main(){\r\n\tscanf(\"%lld%lld\",&n,&m);\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tscanf(\"%lld%lld\",&a[i],&b[i]);\r\n\t\tupdate(rt[i],rt[i-1],1,inf,a[i],a[i]);\r\n\t\tpre[i]=pre[i-1]+a[i];\r\n\t\tcnt_pre[i]=cnt_pre[i-1]+a[i]*(a[i]+1)/2;\r\n\t\tL[i]=pre[i-1]+1,R[i]=pre[i];\r\n\t}\r\n\tfor(int i=1,l,r,v;i<=m;i++){\r\n\t\tscanf(\"%lld%lld%lld\",&l,&r,&v);\r\n\t\tint ll=lower_bound(pre+1,pre+1+n,l)-pre;\r\n\t\tint rr=lower_bound(pre+1,pre+1+n,r)-pre;\r\n\t\t//ll,rr\u4e3a\u5de6\u53f3\u7aef\u70b9\u6240\u5904\u7684\u4e09\u89d2\u5f62\r\n\t\t\r\n\t\tint lb=1,rb=inf,ans=-1;\r\n\t\twhile(lb<=rb){\r\n\t\t\tint mid=(lb+rb)>>1;\r\n\t\t\tint res;\r\n\t\t\tif(ll==rr) res=calc(ll,l-L[ll]+1,r-L[ll]+1,mid);\r\n\t\t\telse{\r\n\t\t\t\tint tmp_sum=query_sum(rt[rr-1],rt[ll],mid,inf,1,inf)-query_sum(rt[rr-1],rt[ll],mid,mid,1,inf);//S1\r\n\t\t\t\tint tmp_sqs=query_sqs(rt[rr-1],rt[ll],mid,inf,1,inf)-query_sqs(rt[rr-1],rt[ll],mid,mid,1,inf);//S2\r\n\t\t\t\tint tmp_cnt=query_cnt(rt[rr-1],rt[ll],mid,inf,1,inf)-query_cnt(rt[rr-1],rt[ll],mid,mid,1,inf);//k\r\n\t\t\t\tres=(tmp_sqs-2*tmp_sum*mid+tmp_cnt*mid*mid+tmp_sum-tmp_cnt*mid)/2;\r\n\t\t\t\tres=cnt_pre[rr-1]-cnt_pre[ll]-res;\r\n\t\t\t\tres+=calc(ll,l-L[ll]+1,R[ll]-L[ll]+1,mid)+calc(rr,1,r-L[rr]+1,mid);\r\n\t\t\t}\r\n\t\t\tif(res>=v) ans=mid,rb=mid-1;\r\n\t\t\telse lb=mid+1;\r\n\t\t}\r\n\t\tprintf(\"%lld\\n\",ans);\r\n\t}\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1669025630,
        "uid": 469066,
        "name": "zzxLLL",
        "ccfLevel": 6,
        "title": "P8797 [\u84dd\u6865\u676f 2022 \u56fd A] \u4e09\u89d2\u5e8f\u5217"
    },
    {
        "content": "### \u8fd9\u9053\u9898\u5f88\u6709\u610f\u601d\uff0c\u9898\u76ee\u63d0\u4f9b\u4e86\u79bb\u6563\u5316\u4fe1\u606f\u800c\u8ba9\u6211\u4eec\u7edf\u8ba1\u539f\u4fe1\u606f\u3002\r\n\r\n\u9996\u5148\uff0c\u770b\u5230 \u201c\u6700\u5c0f\u7684 $h_i$\u201d\uff0c\u663e\u7136\u53ef\u4ee5\u4e8c\u5206\u7b54\u6848\u3002\r\n\r\n\u63a5\u4e0b\u6765\uff0c\u8003\u8651\u5982\u4f55\u5feb\u901f\u67e5\u8be2\u533a\u95f4\u5185\u9ad8\u5ea6\u5c0f\u4e8e $h_i$ \u7684\u70b9\u3002\u6211\u4eec\u5148\u7c97\u7565\u5730\u60f3\u4e00\u4e2a\u505a\u6cd5\uff0c\u8fd9\u662f\u4e00\u4e2a\u533a\u95f4\u548c\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\r\n\r\n\u7136\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u95ee\u9898\u5728\u4e8e\u76f4\u63a5\u7ef4\u62a4\uff08\u66b4\u529b\u5efa\u6811\uff09\u7684\u8bdd\uff0c\u590d\u6742\u5ea6\u5dee\u4e0d\u591a\u662f $O(\\sum a_i \\times \\log(n))$ \u7ea7\u522b\u3002\u90a3\u4e48\u8003\u8651\u901a\u8fc7\u7ef4\u62a4\u4e09\u89d2\u5f62\u7684\u4fe1\u606f\u5f97\u5230\u70b9\u7684\u4fe1\u606f\uff0c\u800c\u4e09\u89d2\u5f62\u548c\u533a\u95f4\u7684\u5173\u7cfb\u6709\u4e24\u79cd\uff0c\u9700\u8981\u5206\u7c7b\u5904\u7406\u3002\r\n\r\n#### \u7b2c\u4e00\u79cd\u60c5\u51b5\uff1a\u4e09\u89d2\u5f62\u5305\u542b\u4e86\u4e00\u4e2a\u533a\u95f4\r\n\r\n\u89c4\u5b9a $pos_i$ \u4e3a\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u6700\u5de6\u8fb9\u7684\u70b9\u7684\u4e0b\u6807\uff0c $d_i$ \u4e3a\u4e09\u89d2\u5f62\u8fb9\u957f\u3002\u73b0\u5728\u8ba1\u7b97\u7b2c $i$ \u4e2a\u4e09\u89d2\u5f62\u533a\u95f4 $[l,r]$ \u4e2d\u9ad8\u5ea6\u4e0d\u5927\u4e8e $h$ \u7684\u70b9\u6570\u3002\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/g1zumk9h.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\r\n\r\n\uff08\u56fe\u4e2d\u7d2b\u8272\u548c\u9752\u8272\u7ebf\u5bf9\u5e94\u76f8\u7b49\uff09\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u5c06\u4e09\u89d2\u5f62\u6cbf\u84dd\u7ebf\u5206\u4e3a\u4e00\u4e2a\u68af\u5f62\u548c\u77e9\u5f62\u3002\u5047\u8bbe\u8fd9\u4e2a\u4e09\u89d2\u5f62\u6709\u6070\u597d $h$ \u4e2a\u70b9\u7684\u4e00\u5217\u4e3a $mid$ \uff08\u6211\u5c06\u5176\u5f52\u5165\u68af\u5f62\uff09\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c$mid$ \u53ef\u80fd\u4e0d\u5728\u8be2\u95ee\u533a\u95f4\u5185\uff0c\u4e5f\u5c31\u662f\u8bf4\u77e9\u5f62\u548c\u68af\u5f62\u4e0d\u4e00\u5b9a\u90fd\u5b58\u5728\uff0c\u9700\u8981\u7279\u5224\u3002\r\n\r\n\u90a3\u4e48\u68af\u5f62\u4e2d\u7684\u70b9\u6570\u4e3a $(l - pos_i + 1 + h) \\times (mid - l + 1) / 2$ \uff0c\u77e9\u5f62\u4e2d\u7684\u70b9\u6570\u4e3a $(r - mid) \\times h$\u3002\r\n\r\n\u8fd9\u79cd\u60c5\u51b5\u53ea\u4f1a\u5728\u8be2\u95ee\u533a\u95f4\u88ab\u4e00\u4e2a\u4e09\u89d2\u5f62\u5b8c\u5168\u5305\u542b\uff0c\u6216\u8005\u8be2\u95ee\u533a\u95f4\u7684\u4e24\u7aef\u51fa\u73b0\u3002\u6bcf\u6b21\u8be2\u95ee\u627e\u5230\u8fd9\u6837\u7684\u4e09\u89d2\u5f62\u66b4\u529b\u7b97\u5373\u53ef\u3002\r\n\r\n#### \u7b2c\u4e8c\u79cd\u60c5\u51b5\uff1a\u533a\u95f4\u5305\u542b\u4e86\u4e00\u4e2a\u4e09\u89d2\u5f62\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/2ct055x7.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\r\n\r\n\u8fd9\u79cd\u60c5\u51b5\u6bd4\u8f83\u7b80\u5355\uff0c\u5bf9\u4e8e $d \\le h$ \u7684\u4e09\u89d2\u5f62\u5c31\u662f\u5168\u90e8\u70b9\uff0c\u5176\u4f59\u7684\u76f4\u63a5\u7528\u6574\u4e2a\u4e09\u89d2\u5f62\u51cf\u53bb\u6700\u4e0a\u65b9\u7684\u4e09\u89d2\u5f62\u5373\u53ef\u3002\r\n\r\n\u90a3\u4e48\u70b9\u6570\u5373\u4e3a$(1 + d) \\times d / 2$ \u6216 $(1 + d) \\times d / 2 - (1 + d - h) \\times (d - h) / 2 $\u3002\r\n\r\n\u8fd9\u79cd\u60c5\u51b5\u51fa\u73b0\u7684\u6b21\u6570\u5f88\u591a\uff0c\u56e0\u6b64\u9700\u8981\u4f18\u5316\u5b83\u7684\u6c42\u89e3\u3002\u5c06\u4e0a\u9762\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u5316\u7b80\uff0c\u5f97\u5230 $(h + h ^ 2 + 2 \\times d \\times h) / 2$ \u3002\u8fd9\u542f\u793a\u6211\u4eec\u7ef4\u62a4\u4e09\u89d2\u5f62\u4e2a\u6570\uff0c\u9ad8\u5ea6\u4ee5\u53ca\u603b\u70b9\u6570\u3002\r\n\r\n\u56e0\u4e3a\u9700\u8981\u5bf9 $d$ \u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff0c\u6240\u4ee5\u8981\u4ee5 $d$ \u4e3a\u4e0b\u6807\u5efa\u4e3b\u5e2d\u6811\u5e76\u4ee5\u4e09\u89d2\u5f62\u7f16\u53f7\u4e3a\u4e0b\u6807\u7ef4\u62a4\u4e0a\u8ff0\u4e09\u4e2a\u91cf\u3002\r\n\r\n\u7406\u8bba\u4e0a\u7684\u603b\u590d\u6742\u5ea6\u662f $O(n \\times \\log^2(n))$\u3002\r\n\r\n#### \u5e38\u6570\u7206\u70b8\u7684 AC \u4ee3\u7801\r\n\r\n```\r\n#include<iostream>\r\n#include<algorithm>\r\n#define ll long long\r\n#define fst(a,b,c) for(int a = (b);a <= (c);a++)\r\n#define fr first\r\n#define sc second\r\nusing namespace std;\r\nconst int N = 2e5 + 10; bool check = 0;\r\nint n,m;\r\nll pos[N];\r\nint h[N],d[N],hh[N],n_,ord[N];\r\nstruct Node{\r\n\tint l,r,c;\r\n\tll v1,v2;\r\n}t[N * 20]; int Rt[N],num;\r\ninline ll read(){\r\n\tchar in = getchar(); ll x = 0;\r\n\twhile(!isdigit(in)) in = getchar();\r\n\twhile(isdigit(in)) x = x * 10 + (in ^ 48),in = getchar();\r\n\treturn x;\r\n}\r\ninline bool cmp(int a,int b){return h[a] < h[b];}\r\ninline ll cal(int id,ll l,ll r,int h_){\r\n\tll mid,cut,ans = 0;\r\n//\tif(check) printf(\"cal(%lld,%lld,%lld,%lld)\\n\",id,l,r,h_);\r\n\tif(!d[id]){\r\n\t\t//\u53f3\u9760\u4e09\u89d2\u5f62 \r\n\t\tmid = pos[id] + h_ - 1;\r\n\t\t//\u521a\u597d\u78b0\u5230\u9ad8\u5ea6\u7684\u6807 \r\n//\t\tif(check) printf(\"mid = %lld\\n\",mid);\r\n\t\tif(mid >= l){\r\n\t\t\tcut = min(r,mid);\r\n\t\t\tans += 1ll * ((l - pos[id] + 1) + (cut - pos[id] + 1)) * \r\n\t\t\t(cut - l + 1) / 2;\r\n\t\t\t//\u5de6\u534a\u90e8\u5206\u662f\u7b49\u5dee\u6570\u5217 \r\n\t\t}\r\n\t\tif(mid < r){\r\n\t\t\tcut = max(l - 1,mid);\r\n\t\t\tans += 1ll * (r - cut) * h_;\r\n\t\t\t//\u53f3\u534a\u90e8\u5206\u77e9\u5f62 \r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tmid = pos[id + 1] - h_;\r\n//\t\tif(check) printf(\"mid = %lld\\n\",mid);\r\n\t\tif(mid <= r){\r\n\t\t\tcut = max(l,mid);\r\n\t\t\tans += 1ll * ((pos[id + 1] - r) + (pos[id + 1] - cut)) * \r\n\t\t\t(r - cut + 1) / 2;\r\n\t\t}\r\n\t\tif(mid > l){\r\n\t\t\tcut = min(r + 1,mid);\r\n\t\t\tans += 1ll * (cut - l) * h_;\r\n\t\t}\r\n\t}\r\n//\tif(check) printf(\"ans = %lld\\n\",ans);\r\n\treturn ans;\r\n}\r\ninline void up(int rt){\r\n\tt[rt].c = t[t[rt].l].c + t[t[rt].r].c;\r\n\tt[rt].v1 = t[t[rt].l].v1 + t[t[rt].r].v1;\r\n\tt[rt].v2 = t[t[rt].l].v2 + t[t[rt].r].v2;\r\n}\r\ninline void upd(int k,int x,int &rt,int L = 1,int R = n){\r\n\tint rt_ = ++num; t[rt_] = t[rt]; rt = rt_;\r\n\tif(L == R){t[rt].c += 1; t[rt].v1 += x; t[rt].v2 += 1ll * (1 + x) * x / 2; return;}\r\n\tint mid = (L + R) >> 1;\r\n\t(k <= mid) ? upd(k,x,t[rt].l,L,mid) : upd(k,x,t[rt].r,mid + 1,R);\r\n\tup(rt);\r\n\treturn;\r\n}\r\ninline pair<int,pair<ll,ll> > operator + (pair<int,pair<ll,ll> > a,pair<int,pair<ll,ll> > b){\r\n\treturn {a.fr + b.fr,{a.sc.fr + b.sc.fr,a.sc.sc + b.sc.sc}};\r\n}\r\ninline pair<int,pair<ll,ll> > qry(int l,int r,int rt_,int rt,int L = 1,int R = n){\r\n\tif(l <= L && R <= r) return {t[rt].c - t[rt_].c,{t[rt].v1 - t[rt_].v1,t[rt].v2 - t[rt_].v2}};\r\n\tint mid = (L + R) >> 1;\r\n\tif(r <= mid) return qry(l,r,t[rt_].l,t[rt].l,L,mid);\r\n\telse if(l > mid) return qry(l,r,t[rt_].r,t[rt].r,mid + 1,R);\r\n\telse return qry(l,r,t[rt_].l,t[rt].l,L,mid) + qry(l,r,t[rt_].r,t[rt].r,mid + 1,R);\r\n}\r\nsigned main(){\r\n//\tfreopen(\"in.txt\",\"r\",stdin);\r\n//\tfreopen(\"out.txt\",\"w\",stdout);\r\n\tll l1,r1,v,l2,r2,l,r,mid;\r\n\tn = read(),m = read();\r\n\tpos[0] = 1;\r\n\tfst(i,1,n){\r\n\t\tpos[i] = pos[i - 1] + h[i - 1];\r\n\t\th[i] = hh[i] = read(),d[i] = read();\r\n\t\tord[i] = i;\r\n\t}\r\n\tpos[0] = 0;\r\n//\tprintf(\"%lld\\n\",cal(1,1,3,10));\r\n\tpos[n + 1] = pos[n] + h[n];\r\n\tsort(hh + 1,hh + n + 1);\r\n\tn_ = unique(hh + 1,hh + n + 1) - hh - 1;\r\n\t//\u79bb\u6563\u9ad8\u5ea6 \r\n//\tif(check){printf(\"h:: \"); fst(i,1,n_) printf(\"%lld \",hh[i]); puts(\"\");}\r\n\tsort(ord + 1,ord + n + 1,cmp);\r\n//\tif(check) fst(i,1,n) printf(\"id = %lld pos = %lld h = %lld\\n\",ord[i],pos[ord[i]],h[ord[i]]);\r\n\tint id = 0;\r\n\tfst(i,1,n){\r\n\t\tint now = ord[i],pre = ord[i - 1];\r\n\t\tif(h[now] != h[pre]) id++,Rt[id] = Rt[id - 1];\r\n\t\tupd(now,h[now],Rt[id]);\r\n\t}\r\n\t//\u7528\u9ad8\u5ea6\u4f5c\u4e3a\u65f6\u95f4\u6233\uff0c\u6a2a\u5750\u6807\u4f5c\u4e3a\u4e0b\u6807\u5efa\u4e3b\u5e2d\u6811 \r\n\tll tmp,ans;\r\n\tpair<int,pair<ll,ll> > tmp_;\r\n\tfst(i,1,m){\r\n\t\tans = -1;\r\n\t\tl1 = read(),r1 = read(),v = read();\r\n//\t\tif(check) if(i != 4) continue;\r\n\t\tl2 = upper_bound(pos + 1,pos + n + 2,l1) - pos - 1;\r\n\t\tr2 = upper_bound(pos + 1,pos + n + 2,r1) - pos - 1;\r\n\t\t//\u5de6\u53f3\u7aef\u70b9\u6240\u5728\u4e09\u89d2\u5f62\u4e0b\u6807 \r\n//\t\tif(check) printf(\"qry[%lld,%lld] [%lld,%lld]\\n\",l1,r1,l2,r2);\r\n\t\tl = 1; r = hh[n_] + 1;\r\n\t\twhile(l <= r){\r\n\t\t\ttmp = 0;\r\n\t\t\tmid = (l + r) >> 1;\r\n\t\t\t//\u4e8c\u5206\u7b54\u6848 \r\n//\t\t\tif(check) printf(\"mmmmmmmmmmmmmmmmmmmmid = %lld\\n\",mid);\r\n\t\t\tif(l2 == r2) tmp = cal(l2,l1,r1,mid);\r\n\t\t\telse{\r\n\t\t\t\tif(r2 > l2 + 1){\r\n//\t\t\t\t\tif(check) printf(\"[%lld,%lld]\\n\",pos[l2 + 1],pos[r2] - 1);\r\n\t\t\t\t\tid = upper_bound(hh + 1,hh + n_ + 1,mid) - hh - 1;\r\n\t\t\t\t\ttmp_ = qry(l2 + 1,r2 - 1,Rt[id],Rt[n_]);\r\n//\t\t\t\t\tif(check) printf(\"{%lld,{%lld,%lld}}\\n\",tmp_.fr,tmp_.sc.fr,tmp_.sc.sc);\r\n\t\t\t\t\ttmp += 1ll * tmp_.sc.fr * mid;\r\n\t\t\t\t\ttmp += 1ll * tmp_.fr * (mid - mid * mid) / 2;\r\n//\t\t\t\t\tif(check) printf(\"tmp = %lld\\n\",tmp);\r\n\t\t\t\t\ttmp_ = qry(l2 + 1,r2 - 1,Rt[0],Rt[id]);\r\n\t\t\t\t\ttmp += tmp_.sc.sc;\r\n//\t\t\t\t\tif(check) printf(\"tmp = %lld\\n\",tmp);\r\n\t\t\t\t}\r\n\t\t\t\ttmp += cal(l2,l1,pos[l2 + 1] - 1,mid);\r\n\t\t\t\ttmp += cal(r2,pos[r2],r1,mid);\r\n//\t\t\t\tif(check) printf(\"%lld\\n\",tmp);\r\n\t\t\t}\r\n\t\t\tif(tmp >= v) ans = mid,r = mid - 1;\r\n\t\t\telse l = mid + 1;\r\n\t\t}\r\n//\t\tif(check) printf(\"aaaaaaaaaaaaaaaaans = \");\r\n\t\tprintf(\"%lld\\n\",ans);\r\n\t}\r\n\treturn 0;\r\n}\r\n//1 1 1 -2 1 1 1 -2 -1 2 -1 -1 0 1 1 1 1\r\n//\u533a\u95f4\u6700\u5927\u503c\u53ca\u6570\u91cf\uff0c\u524d\u7f00\u548c \r\n```\r\n",
        "postTime": 1668878511,
        "uid": 150611,
        "name": "mrozhx",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011P8797 [\u84dd\u6865\u676f 2022 \u56fd A] \u4e09\u89d2\u5e8f\u5217"
    }
]