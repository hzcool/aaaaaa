[
    {
        "content": "\u8003\u8651\u6811\u5f62 DP\u3002\u8bbe $f_{i,0/1/2/3}$ \u8868\u793a\u4ece\u7ed3\u70b9 $i$ \u4e0a\u4f20\u4e86\u957f\u5ea6\u4e3a\u591a\u5c11\u7684\u94fe\u3002\u5408\u5e76\u5404\u4e2a\u513f\u5b50\u7684\u65f6\u5019\u53ef\u4ee5\u91c7\u7528\u80cc\u5305\u7684\u601d\u8def\uff0c\u8bbe $g_{k,0/1}$ \u8868\u793a\u6240\u6709\u513f\u5b50\u4e2d\u4e0a\u4f20\u957f\u5ea6 1 \u7684\u6bd4\u4e0a\u4f20\u957f\u5ea6 3 \u7684\u591a\u591a\u5c11\uff0c\u4ee5\u53ca\u4e0a\u4f20\u957f\u5ea6 2 \u513f\u5b50\u7684\u4e2a\u6570\u5947\u5076\u6027\u3002\n\n\u76f4\u63a5\u8fd9\u6837\u663e\u7136\u662f $O(n^2)$ \u7684\uff0c\u74f6\u9888\u5728\u4e8e\u5dee\u503c\u7684\u8bb0\u5f55\u3002\u628a\u4e0a\u4f20\u957f\u5ea6\u4e3a 1 \u7684\u94fe\u770b\u6210 $-1$\uff0c\u957f\u5ea6\u4e3a 3 \u7684\u94fe\u770b\u6210 $+1$\uff0c\u90a3\u4e48\u5982\u679c\u6253\u4e71\u513f\u5b50\u987a\u5e8f\uff0c\u6700\u4f18\u89e3\u4e2d $-1/1$ \u5e8f\u5217\u7684\u524d\u7f00\u548c\u662f $O(\\sqrt{n})$ \u7ea7\u522b\u7684\u3002\u6b64\u65f6\u8bbe\u7acb\u4e00\u4e2a\u9608\u503c $B=500$\uff0c\u53ea\u8bb0\u5f55\u5dee\u503c\u5728 $[-B,B]$ \u4e4b\u95f4\u7684\u7b54\u6848\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(Bn)$\uff0c\u52a0\u4e0a\u4e00\u4e9b\u526a\u679d\u540e\u8dd1\u5f97\u5f88\u5feb\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define For(i,a,b) for(int i=(a);i<=(b);++i)\n#define Rof(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\nconst int Maxn=2e5,B=500;\nconst ll inf=1e18;\n\ninline int read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0' || ch>'9')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9')\n    {\n        x=x*10+ch-'0';\n        ch=getchar();\n    }\n    return x*f;\n}\n\nstruct Node{int frm,to,nxt,w;} Edge[Maxn*2+5];\nint tot,Head[Maxn+5];\ninline void Addedge(int x,int y,int w)\n{\n    Edge[++tot]=(Node){x,y,Head[x],w};\n    Head[x]=tot;\n}\nint n,val[Maxn+5]; ll f[Maxn+5][4],h[B*2+5][2],g[B*2+5][2];\nmt19937 rnd(time(0));\n\ninline void fmax(ll &x,ll y) {x=max(x,y);}\ninline void dfs(int x,int fa)\n{\n    vector<int> v;\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(y==fa) continue;\n        val[y]=Edge[i].w,dfs(y,x),v.push_back(y);\n    }\n    shuffle(v.begin(),v.end(),rnd);\n    int L=B,R=B,c=v.size()/2+1;\n    For(i,0,B*2) For(j,0,1) g[i][j]=-inf; g[B][0]=0;\n    for(auto y:v)\n    {\n        For(j,L-1,R+1) h[j][0]=h[j][1]=-inf;\n        For(j,L,R) For(k,0,1) if(g[j][k]>-inf)\n        {\n            fmax(h[j][k],g[j][k]+f[y][0]);\n            fmax(h[j-1][k],g[j][k]+f[y][1]);\n            fmax(h[j][k^1],g[j][k]+f[y][2]);\n            fmax(h[j+1][k],g[j][k]+f[y][3]);\n        } L=max(L-1,max(B-c,0)),R=min(R+1,min(B+c,B*2));\n        For(j,L,R) g[j][0]=h[j][0],g[j][1]=h[j][1];\n    }\n    if(x>1) f[x][0]=max(max(0ll,g[B][0]),g[B+1][0]+val[x]); else f[x][0]=max(0ll,g[B][0]);\n    f[x][1]=max(0ll,g[B][0])+val[x],f[x][2]=g[B-1][0]+val[x],f[x][3]=g[B][1]+val[x];\n}\n\nint main()\n{\n    n=read();\n    For(i,1,n-1)\n    {\n        int a=read(),b=read(),c=read();\n        Addedge(a,b,c),Addedge(b,a,c);\n    }\n    dfs(1,0);\n    cout<<f[1][0]<<endl;\n    return 0;\n}\n```",
        "postTime": 1679573383,
        "uid": 148913,
        "name": "Graphcity",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P9047 [PA2021] Poborcy podatkowi"
    }
]