[
    {
        "content": "## [\u539f\u6587\u5730\u5740](https://www.cnblogs.com/bcoier/p/10392413.html)\n\n~~\u5148\u5410\u69fd\u4e00\u6ce2\uff1a\u51c9\u5fc3\u51fa\u9898\u4eba\u53c8\u5361\u65f6\u95f4\u53c8\u5361\u7a7a\u95f4~~\n\n\u5148\u6765\u5316\u7b80\u4e00\u6ce2\u67ff\u5b50\n\n$$\\prod_{i=1}^{n}\\prod_{j=1}^{n}\\frac{lcm(i,j)}{gcd(i,j)}$$\n\n$$=\\prod_{i=1}^{n}\\prod_{j=1}^{n}\\frac{i*j}{gcd(i,j)^2}$$\n\n$$=(\\prod_{i=1}^{n}\\prod_{j=1}^{n}i*j)*(\\prod_{i=1}^{n}\\prod_{j=1}^{n}gcd(i,j))^{-2}$$\n\n\u5148\u770b\u524d\u9762\u7684\u90a3\u4e00\u5768\uff1a\n\n$$\\prod_{i=1}^{n}\\prod_{j=1}^{n}i*j$$\n\n$$=\\prod_{i=1}^{n}(i^n*n!)$$\uff08\u4e0d\u7406\u89e3\u53ef\u4ee5\u628a\u4e0a\u8ff0\u5f0f\u5b50\u6253\u5f00\uff0c\u5c31\u53ef\u4ee5\u53d1\u73b0\u4e86\uff09\n\n$$=(n!)^{n}*\\prod_{i=1}^{n}i^n$$\n\n$$=(n!)^n*(n!)^n$$\n\n$$=(n!)^{2n}$$\n\n\u7136\u540e\u6211\u4eec\u6765\u770b\u540e\u9762\u90a3\u4e00\u5768\uff08\u5148\u4e0d\u770b-2\u6b21\u65b9\uff09\uff1a\n\n$$\\prod_{i=1}^{n}\\prod_{j=1}^{n}gcd(i,j)$$\n\n$$=\\prod_{d=1}^{n}\\prod_{i=1}^{n}\\prod_{j=1}^{n}[gcd(i,j)==d]$$\n\n$$=\\prod_{d=1}^{n}d^{\\sum_{i=1}^{n}\\sum_{j=1}^{n}[gcd(i,j)==d]}$$\n\n$$=\\prod_{d=1}^{n}d^{\\sum_{i=1}^{\\frac{n}{d}}\\sum_{j=1}^{\\frac{n}{d}}[gcd(i,j)==1]}$$\n\n\u5148\u53ea\u770b\u6307\u6570\uff1a\n\n$$\\sum_{i=1}^{\\frac{n}{d}}\\sum_{j=1}^{\\frac{n}{d}}[gcd(i,j)==1]$$\n\n\u8fd9\u4e0d\u5c31\u662f[\u4eea\u4ed7\u961f](https://tbr-blog.blog.luogu.org/ou-la-han-shuo-zong-jie)\u5417\uff1f\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u6c42\u51fa\u5566\u6b27\u62c9\u51fd\u6570\u524d\u7f00\u548c\uff0c\u5c31\u53ef\u4ee5\u7528\u6b27\u62c9\u51fd\u6570$O(1)$\u7b97\u51fa\u6307\u6570\u4e86~\n\n\u6240\u4ee5\u6211\u4eec\u628a\u67ff\u5b50\u7efc\u5408\u4e00\u4e0b\uff1a\n\n\u4ee4$$sum[x]=\\sum_{i=1}^x\\phi(i)$$\n\n\u539f\u5f0f\u5316\u4e3a\uff1a$$(n!)^{2n}*(\\Pi_{d=1}^{n}d^{2*sum[\\frac{n}{d}]-1})^{-2}$$\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5$O(nlogn)$\u6c42\u51fa\u7b54\u6848\u4e86\n\n\u6700\u540e\u6ce8\u610f\u4e00\u4e0b\uff0c\u56e0\u4e3a\u6b27\u62c9\u51fd\u6570\u524d\u7f00\u548c\u4f1a\u7206int\uff0c\u6240\u4ee5\u8981\u7528longlong\uff0c\u4f46\u662f\u8fd9\u6837\u5c31\u4f1aMLE\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8003\u8651\u4f18\u5316\n\n\u6839\u636e\u6b27\u62c9\u5b9a\u7406\uff0c\u56e0\u4e3a\u6a21\u6570\u4e3a\u8d28\u6570\uff0c\u6240\u4ee5$\\phi(mod)=mod-1$\uff0c\u6240\u4ee5\u539f\u5f0f\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5316\u4e3a\uff1a\n\n$$(n!)^{2n}*(\\prod_{d=1}^{n}d^{(2*sum[\\frac{n}{d}]-1)\\%(mod-1)})^{-2}$$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e0d\u9700\u8981longlong\u4e86\n\n\u4e0b\u9762\u7ed9\u51fa\u4ee3\u7801\uff1a\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define il inline\n#define re register\n#define debug printf(\"Now is Line : %d\\n\",__LINE__)\n#define file(a) freopen(#a\".in\",\"r\",stdin);freopen(#a\".out\",\"w\",stdout)\n#define ll long long\n#define mod 104857601\nil int read()\n{\n    re int x=0,f=1;re char c=getchar();\n    while(c<'0'||c>'9') {if(c=='-') f=-1;c=getchar();}\n    while(c>='0'&&c<='9') x=x*10+c-48,c=getchar();\n    return x*f;\n}\n#define maxn 1000000+5\nint n,cnt,ans1=1,prim[80000],ans2=1,pai[maxn];\nbool vis[maxn];\nil int qpow(int a,ll b)\n{\n    int r=1;\n    while(b)\n    {\n        if(b&1ll) r=1ll*r*a%mod;\n        b>>=1ll;\n        a=1ll*a*a%mod;\n    }\n    return r;\n}\nint main()\n{\n    n=read();\n    pai[1]=1;\n    for(re int i=2;i<=n;++i)\n    {\n    \tans1=1ll*ans1*i%mod;\n        if(!vis[i]) prim[++cnt]=i,pai[i]=i-1;\n        for(re int j=1;j<=cnt;++j)\n        {\n            if(prim[j]*i>n) break;\n            vis[prim[j]*i]=1;\n            if(i%prim[j]==0) {pai[i*prim[j]]=pai[i]*prim[j];break;}\n            pai[i*prim[j]]=pai[prim[j]]*pai[i];\n        }\n    }\n    for(re int i=1;i<=n;++i) pai[i]=pai[i]*2+pai[i-1]%(mod-1);\n    ans1=qpow(ans1,2*n);\n    for(re int i=2;i<=n;++i) ans2=1ll*ans2*qpow(i,pai[n/i]-1)%mod;\n    printf(\"%d\",(1ll*ans1*qpow(1ll*ans2*ans2%mod,mod-2))%mod);\n    return 0;\n}\n```",
        "postTime": 1550404313,
        "uid": 57014,
        "name": "Nemlit",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\n\u8fd9\u573a\u6bd4\u8d5b\u6211\u662f\u73b0\u573a\u6253\u7684\uff0c\u7531\u4e8e\u6211\u592a\u83dc\u4e86qwq\uff0c\u6240\u4ee5\u4e0d\u4f1a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u53ea\u80fd\u5199\n\u4e00\u7bc7\u4e0d\u7528\u83ab\u53cd\u7684\u9898\u89e3\u6c34\u6c34\u5566\u3002\n\n## \u601d\u8def\n- \u770b\u5230\u4e86$gcd$\u548c$lcm$\uff0c \u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u8fd9\u6837\u7684\u4e00\u6761\u6027\u8d28\uff1a\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6b63\u6574\u6570$x$\uff0c\u6839\u636e\u552f\u4e00\u5206\u89e3\u5b9a\u7406\uff0c\u53ef\u4ee5\u552f\u4e00\u7684\u5199\u51fa\u5b83\u7684\u4e00\u4e2a\u8868\u793a:\n$\\prod_{i=1}^tp_i^{e_i}$ \u8fd9\u91cc$p_i$\u662f$x$\u7684\u7d20\u56e0\u5b50\uff0c$e_i$\u662f$p_i$\u7684\u6b21\u6570\u3002\n\n\u5bf9\u4e8e\u4e24\u4e2a\u6570$x,y$:\n\n$gcd(x,y)=\\prod_{i=1}^tp_i^{min(e_{xi},e_{yi})}$; $lcm(x,y)=\\prod_{i=1}^tp_i^{max(e_{xi},e_{yi})}$\n\n\u6ce8\u610f\u8fd9\u91cc\u7684\u7d20\u56e0\u5b50\uff0c\u5982\u679c\u4e00\u4e2a\u6570$x$\u7684\u4e00\u4e2a\u7d20\u56e0\u5b50$p$\u7684\u6b21\u6570\u662f$0$\uff0c\u4e5f\u662f\u8981\u7edf\u8ba1\u7684\u3002\n\n\u8fd9\u6837\uff0c\u8981\u6c42\u7684\u4e1c\u897f\u5c31\u53ef\u4ee5\u8f6c\u5316\u6210\uff1a\n\n$\\sum_{i=1}^N\\sum_{j=1}^N\\prod_{k=1}^tp_k^{max(e_{ik},e_{jk})-min(e_{ik}, e{jk})}$\n\n\u5c31\u662f $\\prod_{k=1}^t\\sum_{i=1}^N\\sum_{j=1}^Np_k^{max(e_{ik},e_{jk})-min(e_{ik}, e{jk})}$\n\n\u76f8\u5f53\u4e8e\u6211\u4eec\u8003\u8651\u6bcf\u4e00\u4e2a\u8d28\u56e0\u5b50\u7b97\u5b83\u7684\u8d21\u732e\u3002\n\n\u8fd9\u91cci\u548cj\u662f\u5bf9\u79f0\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53ea\u8ba1\u7b97\n$\\sum_{i=1}^N\\sum_{j=1}^i{max(e_{ik},e_{jk})-min(e_{ik}, e_{jk})}$ \u7684\u503c\uff0c\u6700\u540e\u6b21\u6570*2\u5c31\u597d\u4e86\u3002\n\n\u6211\u4eec\u8003\u86511~n\u4e2d\u54ea\u4e9b\u6570\u53ef\u80fd\u5bf9\u4e8e\u7b54\u6848\u6709\u8d21\u732e\uff0c\u6613\u77e5\u6709$floor(\\frac{n}{p_k})$ \u4e2a\uff0c \u8fd9\u4e9b\u6570\u7684$p_k$\u7684\u6b21\u6570\u975e0\u3002($floor$\u8868\u793a\u4e0b\u53d6\u6574\uff0c\u539f\u8c05\u6211\u4e0d\u4f1amarkdown\u7684\u4e0b\u53d6\u6574\u5427qwq)\u3002\n\n\u6211\u4eec\u8bbe\u4e00\u4e2a$num$\u6570\u7ec4\uff0c$num[i]$\u8868\u793a$1\\ to\\  N$\u4e2d\u6709$p_k^i$\u8fd9\u4e2a\u56e0\u5b50\u7684\u6570\u7684\u4e2a\u6570\u3002\u5982\u4f55\u8ba1\u7b97$num$\u5462\uff1f\u6211\u4eec\u8003\u8651$floor(\\frac{n}{p_k^i})$\u8ba1\u7b97\u7684\u662f\u4ec0\u4e48\uff0c\u8fd9\u4e2a\u8ba1\u7b97\u7684\u5b9e\u9645\u4e0a\u662f\u6b21\u6570$>=i$\u7684\u56e0\u5b50\u7684\u4e2a\u6570\u3002\u6211\u4eec\u5148\u7528$num$\u628a\u5b83\u5b58\u8d77\u6765\uff0c\u7136\u540e\u5bf9$num$\u505a\u4e00\u4e2a\u5dee\u5206\u5c31\u662f\u6211\u4eec\u60f3\u77e5\u9053\u7684\u5566\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5df2\u7ecf\u628a$1\\ to\\ n$ \u7684\u8fd9\u4e9b\u6570\u6309\u7167\u5176\u4e2d$p_k$\u7684\u6b21\u6570\u5206\u6210\u4e86$log_{p_k}n$ \u6bb5\uff0c\u6bcf\u4e00\u6bb5\u4e2d\u7684$p_k$\u6b21\u6570\u90fd\u662f\u4e00\u6837\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4ece\u5c0f\u5230\u5927\u8003\u8651$p_i$\u7684\u6b21\u6570\uff0c\u6839\u636e\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u53ea\u9700\u8981\u5728\u6bcf\u4e00\u6bb5\u7684\u5206\u754c\u5904\u7edf\u8ba1\u524d\u9762\u6709\u591a\u5c11\u4e2a\u6b21\u6570\u5c0f\u4e8e\u5b83\u7684\u6570\u548c\u5f53\u524d\u679a\u4e3e\u5230\u4e86\u54ea\u4e00\u6bb5\u3002\u5728\u8fd9\u91cc\u7edf\u8ba1\u8fd9\u4e00\u6bb5\u5bf9\u4e8e\u524d\u9762\u6240\u6709\u6bb5\u7684\u8d21\u732e\u5c31\u53ef\u4ee5\u5566\u3002\n\n\u6700\u540e\u522b\u5fd8\u4e86\u628a\u8fd9\u4e2a\u6b21\u6570\u8d21\u732e$*2$\u54e6\u3002\n\n## \u70b9\u8bc4\n\n\u6211\u4e0d\u77e5\u9053\u8fd9\u6837\u8bf4\u5927\u5bb6\u662f\u5426\u53ef\u4ee5\u7406\u89e3\uff0c\u4f46\u5173\u4e8e\u8d21\u732e\u7684\u7edf\u8ba1\u90a3\u91cc\u7a0d\u5fae\u6709\u70b9\u7ed5\u3002\u6211\u81ea\u5df1\u5728\u5199\u7684\u65f6\u5019\u4e5f\u4ed4\u7ec6\u60f3\u4e86\u4e00\u4f1a\u3002\u4e0d\u8fc7\u5927\u5bb6\u53ea\u8981\u60f3\u6e05\u695a\u5206\u6bb5\u7684\u8fc7\u7a0b\u5c31\u53ef\u4ee5\u5566\uff01\n\n## codes\uff08\u6ce8\u91ca\u5728\u4e0b\u9762\uff09\n\n```cpp\n#include <cstdio>\n#include <vector>\nusing std :: vector;\nvector<int> prime;\ntypedef long long LL;\nconst int N = 1e6 + 5, P = 104857601;\nint vis[N], num[N], cnt, sum, tot;\nint n;\ninline void eluer(){\n    vis[1] = 1;\n    for (int i = 2; i <= (int)1e6; ++i) {\n        if (!vis[i]) prime.push_back(i);\n        for (int j = 0; j < prime.size(); ++j) {\n            int cur = i * prime[j];\n            if (cur > (int)1e6) break;\n            vis[cur] = 1;\n            if (i % prime[j] == 0) break;\n        }\n    }\n}\ninline LL quick_power(LL a, LL b) {\n    LL res = 1;\n    while (b) {\n        if (b & 1) res = (res * a) % P;\n        a = (a * a ) % P;\n        b >>= 1;\n    }\n    return res;\n}\nint main() {\n    //freopen(\"luoguU61329.out\", \"w\", stdout);\n    scanf(\"%d\", &n);\n    eluer();\n    LL ans = 1; LL sumwork = 0;\n    int tt = prime.size();\n    for (int i = 0; i < tt; ++i) {\n        LL b = 1; sum = 0;\n        if (n < prime[i]) break;\n        while (n >= b) {\n            num[++sum] = n / b;\n            b *= prime[i];\n        }\n        for (int j = 1; j < sum; ++j) num[j] -= num[j + 1];\n        sumwork += sum;\n        LL res = 0, sumv = 0, sumcos = 0;\n        for (int j = 1; j <= sum; ++j) {\n            res +=  1LL * num[j] * (sumcos * (j - 1) - sumv);\n            sumcos += num[j];\n            sumv += num[j] * (j - 1);\n        }\n        res <<= 1;\n        ans = (ans * quick_power(prime[i], res)) % P;\n    }\n    printf(\"%lld\\n\", ans);\n    //printf(\"%lld\\n\", sumwork);\n    return 0;\n}\n\n```\n\u8fd9\u91cc\u4e3b\u8981\u7ed9\u5927\u5bb6\u89e3\u91ca\u4e00\u4e0b\u7b97\u8d21\u732e\u7684\u8fc7\u7a0b; $num[]$\u7684\u542b\u4e49\u5c31\u5982\u540c\u6211\u4e0a\u9762\u8bf4\u7684\uff0c$sum$\u8bb0\u5f55\u7684\u662f$p_k$\u4e00\u5171\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u6b21\u6570,\n$res$\u8bb0\u5f55\u7684\u662f$p_k$\u8fd9\u4e2a\u8d28\u6570\u7684\u6b21\u6570\uff0c$sumcos$\u8bb0\u5f55\u7684\u662f\u4e4b\u524d\u4e00\u5171\u6709\u591a\u5c11\u4e2a\n\u6570\uff0c$sumv$\u8bb0\u5f55\u7684\u662f\u4e4b\u524d\u7684\u56e0\u6570\u7684\u603b\u51fa\u73b0\u6b21\u6570\u3002\u6211\u4eec\u662f\u6309\u7167$j$\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u7684\uff0c\u6240\u4ee5$j-1$\u53ef\u4ee5\u8868\u793a\u5f53\u524d\u8fd9\u4e9b\u6570\u7684\u6b21\u6570\u3002\u6b21\u6570\u662f\u4ece$0$\u5f00\u59cb\u7684\u3002\n\n## \u590d\u6742\u5ea6\n\n\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u7d20\u56e0\u5b50\u4e2a\u6570\u561b\uff0c\u67e5\u4e86\u4e00\u4e0b\u4e00\u4e2a\u6570$n$\u7684\u4e92\u5f02\u7d20\u56e0\u5b50\u4e2a\u6570\u662f$O(loglogn)$\u7ea7\u522b\u7684\u3002 \u91cc\u9762\u679a\u4e3e$j$\u7684\u590d\u6742\u5ea6\u662f$O(logn)$\u7ea7\u522b\u7684\u3002\u603b\u590d\u6742\u5ea6\u5c31\u662f$O(n + lognloglogn)$\u7684\u5566\uff01\u7ebf\u6027\u7b5b\u5012\u662f\u74f6\u9888\u4e86qwq\u3002\n\n## \u5c0f\u5410\u69fd\n\n\u8fd9\u9898\u7a7a\u95f4\u5361\u7684\u8ba9\u6211\u6df1\u6076\u75db\u7edd\u554a\u5624\u5624\u5624\u3002$8mb$\u7684\u5185\u5b58\u6807\u5fd7\u7740\u4e0d\u80fd\u540c\u65f6\u5f00$3$\u4e2a$1e6$\u7684\u6570\u7ec4\u3002\u8feb\u4e0d\u5f97\u5df2\u6211\u7528\u4e86$vector$\u6765\u5b58\u7d20\u6570\u3002\n\n## \u7ed3\u8bed\n\n\u8fd9\u9898\u611f\u89c9\u8fd8\u662f\u633a\u6709\u610f\u601d\u7684\uff0c\u53ef\u60dc\u6211\u592a\u5f31\u4e86wvw\uff0c\u5927\u5bb6\u8d76\u7d27\u53bb\u4eab\u53d7\u5207\u9898\u7684\u4e50\u8da3\u5566\u3002",
        "postTime": 1550242296,
        "uid": 27370,
        "name": "Chasingdreams",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u9996\u5148\u89c2\u5bdf\u539f\u5f0f\n\n$$\\prod_{i=1}^n\\prod_{j=1}^n \\dfrac{lcm(i,j)}{gcd(i,j)}$$\n\n\u56e0\u4e3a$lcm(i,j) = ij /gcd(i,j)$\n\n\u6240\u4ee5\u539f\u5f0f\u5c31\u662f\uff1a\n\n$$\\prod_{i=1}^n\\prod_{j=1}^n \\dfrac{ij}{gcd(i,j)^2}$$\n\n\u7136\u540e\u8c8c\u4f3c\u6709\u4e2a\u6027\u8d28\uff0c\uff08\u611f\u6027\u7406\u89e3\uff09\n\n$$\\dfrac{a}{b}\\%mod == \\dfrac{a\\%mod}{b\\%mod}$$\n\n\u8fd9\u4e2a\u6027\u8d28\u4e5f\u662f\uff1a\n\n$$\\dfrac{a}{b}\\%mod = (a\\%mod) * inv(b\\%mod)$$\n\n\u5176\u4e2d$inv$\u662f\u9006\u5143\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u539f\u5f0f\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\uff1a\n\n$$\\dfrac{\\prod_{i=1}^n\\prod_{j=1}^n ij}{\\prod_{i=1}^n\\prod_{j=1}^ngcd(i,j)^2}\\%mod$$\n\n\u4e8e\u662f\u5206\u522b\u8ba8\u8bba\uff1a\n\n$$\\prod_{i=1}^n\\prod_{j=1}^n ij = \\prod_{i=1}^ni^n\\prod_{j=1}^n j= \\prod_{i=1}^ni^n * n! = (n!)^n * \\prod_{i=1}^ni^n$$\n$$ = (n!)^{2n}$$\n\n\u5bf9\u4e8e\u4e0b\u9762\u8fd9\u4e00\u5768\u4e1c\u897f\uff1a\n\n$$\\prod_{i=1}^n\\prod_{j=1}^ngcd(i,j)^2$$\n\n\u6211\u4eec\u6ce8\u610f\u5230\u4e00\u4e2a\u8fd9\u6837\u7684\u6027\u8d28\uff1a\n\n\u82e5$i,j$\u4e92\u8d28\uff0c\u5219$gcd(i,j) = 1$\n\n\u82e5$i,j$\u4e0d\u4e92\u8d28\uff0c\u4e0d\u59a8\u8bbe$gcd(i,j) = x, $\u5219$i = p*x, j = q*x$\n\n\u6240\u4ee5$gcd(i,j) = x*gcd(p,q)$\n\n\u90a3\u4e48\u5b9e\u9645\u4e0a\u6211\u4eec\u53ea\u9700\u8981\u5bf9$p,q$\u8fdb\u884c\u8003\u8651\n\n\u8bbe$pq$\u4e92\u8d28\uff0c\u5176\u4e2d$p <= q,$\u90a3\u4e48\u6211\u4eec\u8003\u8651\u6709\u591a\u5c11\u4e2a\u6570\u5bf9$(i,j)$\uff0c\u6ee1\u8db3\uff1a\n\n$i = x*p, j = x*q$ \uff0c\u90a3\u4e48$gcd(i,j) = x * gcd(p,q) = x$\n\n\u8fd9\u6837\u7684\u6570\u5bf9\u6709$\\left\\lfloor\\dfrac{n}{q}\\right\\rfloor$\u4e2a\uff08$q > p$\uff09\n\n\u8fd9\u4e9b\u6570\u5bf9\u5bf9\u7b54\u6848\u4ea7\u751f\u7684\u8d21\u732e\u4e3a\uff1a\n\n$$\\prod_{x=1}^{n/q} gcd(x*p,x*q)^2$$\n\n\u56e0\u4e3a$q,p$\u4e92\u8d28\uff0c\u6240\u4ee5$gcd(p,q) = 1$\uff0c\u539f\u5f0f\u5b9e\u9645\u4e0a\u5c31\u662f\uff1a\n\n$$\\prod_{x=1}^{n/q} x^2$$\n\n\u5373\n\n$$\\Bigg(\\left\\lfloor\\dfrac{n}{q}\\right\\rfloor!\\Bigg)^2$$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u56e0\u4e3a$p<=q$\uff0c\u5047\u8bbe\u5bf9\u4e8e$q$\u800c\u8a00\uff0c\u8fd9\u6837\u7684$p$\u6709$k$\u4e2a\uff0c\u5b9e\u9645\u4e0a$q$\u5bf9\u7b54\u6848\u4ea7\u751f\u7684\u8d21\u732e\u5c31\u662f\n\n$$\\Bigg(\\left\\lfloor\\dfrac{n}{q}\\right\\rfloor!\\Bigg)^{2k}$$\n\n\u4e0d\u96be\u53d1\u73b0\u5176\u5b9e$p$\u7684\u4e2a\u6570\u5c31\u662f$1-q$\u4e2d\u4e0e$q$\u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570\n\n\u6240\u4ee5$q$\u5bf9\u7b54\u6848\u4ea7\u751f\u7684\u8d21\u732e\u5c31\u662f\uff1a\n\n$$\\Bigg(\\left\\lfloor\\dfrac{n}{q}\\right\\rfloor!\\Bigg)^{2\u03c6(q)}$$\n\n\u56e0\u4e3a\u5b9e\u9645\u4e0a\u9898\u76ee\u6240\u6c42\u7684\u4e0d\u4ec5\u4ec5\u6709$p<=q$\u7684\u6570\u5bf9\uff0c$p>q$\u7684\u4e5f\u5305\u542b\u4e86\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6570\u5bf9$(p,q)$\u800c\u8a00\uff0c\u4ea7\u751f\u7684\u7b54\u6848\u5176\u5b9e\u8fd8\u6709$(q,p),$\u6240\u4ee5\u8fd8\u8981\u5e73\u65b9\u4e00\u6b21\u3002\n\n\u6700\u540e\uff0c\u6211\u4eec\u628a\u5e95\u90e8\u5316\u7b80\u6210\u4e3a\u4e86\uff1a\uff08\u6ce8\u610f\u5bf9\u4e8e$1$\u800c\u8a00\uff0c\u4ea7\u751f\u8d21\u732e\u4e3a\u6570\u5bf9$(1,1)$\uff0c\u8fd9\u4e2a\u4e0d\u9700\u8981\u5e73\u65b9\uff09\n\n$$(n!)^2 * \\prod_{i=2}^{n}\\Bigg(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor!\\Bigg)^{2\u03c6(i)*2}$$\n\n\u7136\u540e\u8bb0\u5f97\u968f\u65f6\u53d6\u6a21\u3002\n\n\u4ee5\u53ca\u5176\u5b9e\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\dfrac{(n!)^{2n}\\%mod}{(n!)^2 \\prod_{i=2}^{n}\\Big(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor!\\Big)^{4\u03c6(i)}\\%mod}$$\n\n\u7136\u540e\u60a8\u8fd9\u6837\u5199\uff0c\u53d1\u73b0$MLE$\u4e86\uff0c\u8fd9\u9053\u9898\u5361\u7a7a\u95f4\u3002\u3002\u3002\n\n\u6309\u7167\u4e0a\u8ff0\u505a\u6cd5\uff0c\u6211\u4eec\u9700\u8981\u8bb0\u5f55\u9636\u4e58\u6570\u7ec4\uff0c\u7136\u540e\u6c42$\u03c6$\u51fd\u6570\u7684\u65f6\u5019\u7528\u6b27\u62c9\u7b5b\u8981\u8bb0\u5f55\u8d28\u6570\u6570\u7ec4\uff0c\u8fd8\u8981\u8bb0\u5f55$\u03c6$\u51fd\u6570\u6570\u7ec4\u3002\u3002\u600e\u4e48\u4f18\u5316\uff1f\u8bb0\u5f55\u4e86$3$\u4e2a$int$\u6570\u7ec4\uff0c\u8fd8\u8981\u5f00$long long$\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4e0a\u5f0f\u4e0b\u534a\u90e8\u53d8\u5f62\uff1a\n\n$$(n!)^2 \\prod_{i=2}^{n}\\Big(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor!\\Big)^{4\u03c6(i)}$$\n\n\u5ffd\u7565\u90a3\u4e2a$(n!)^2$\uff0c\u8003\u8651\u4f18\u5316\u540e\u534a\u90e8\u5206\uff1a\n\n$$\\prod_{i=2}^{n}\\Big(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor!\\Big)^{4\u03c6(i)}$$\n\n\u6211\u4eec\u5bf9\u6bcf\u4e2a\u6570\u8ba8\u8bba\uff0c\u8003\u8651\u5b83\u88ab\u4e58\u4e86\u591a\u5c11\u6b21\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6570$x$\n\n\u5047\u8bbe$\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor > x$\u90a3\u4e48$x$\u5c31\u4f1a\u5728\u8ba1\u7b97$\\Big(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor!\\Big)^{4\u03c6(i)}$\u88ab\u4e58\u4ee5$4\u03c6(i)$\u6b21\u3002\n\n\u7136\u540e$i$\u7684\u53d6\u503c\u662f$2-n$\uff0c\u5bf9\u4e8e$x$\u5047\u8bbe$i>j$\u4e14\u6709$\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor > x$\n\n\u90a3\u4e48\uff1a$\\left\\lfloor\\dfrac{n}{j}\\right\\rfloor > x$\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\uff0c\u5f53$\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor >= x$\u7684\u65f6\u5019\uff0c\u5176\u4f59\u6bd4$i$\u5c0f\u7684\u6570$j$\u5728\u8ba1\u7b97$\\Big(\\left\\lfloor\\dfrac{n}{j}\\right\\rfloor!\\Big)^{4\u03c6(j)}$\u65f6\u4e5f\u4f1a\u7b97\u5230$x$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u7edf\u8ba1$\u03c6(i)$\u7684\u524d\u7f00\u548c\u3002\u8bb0\u4e3a$f(i)$\uff1b\u5bf9\u4e8e\u6570$x$\uff0c\n\u5176\u4f1a\u88ab\u8ba1\u7b97\u6b21\u6570\u4e3a$4*f(n/i)$\u3002\n\n\u8fd9\u4e2a\u5e94\u8be5\u6bd4\u8f83\u663e\u7136\u5427\uff1f\u7136\u540e$f(x)$\u6570\u7ec4\u53ef\u4ee5\u76f4\u63a5\u5728\u539f\u6765\u7684$\u03c6(i)$\u6570\u7ec4\u4e0a\u5904\u7406\uff0c\u4e8e\u662f\u53ea\u7528\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a$N$\u7684$int$\u6570\u7ec4\n\n\u4ee5\u53ca\u6700\u540e\u5f0f\u5b50\u5c31\u662f\u8fd9\u6837\u4e86\uff1a\n\n$$\\dfrac{(n!)^{2n}\\%mod}{(n!)^2\\prod_i^{n/2} i^{4f(n/i)}}$$\n\n\n\u9644\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint read(){\n\tchar cc = getchar(); int cn = 0, flus = 1;\n\twhile(cc < '0' || cc > '9'){\n    \tif(cc == '-') flus = -flus;\n\t\tcc = getchar();\n\t}\n\twhile(cc >= '0' && cc <= '9')\n\t    cn = cn * 10 + cc - '0', cc = getchar();\n\treturn cn * flus;\n}\n#define LL long long\n#define re register\nconst int N = 1000000 + 1;\nconst int mod = 104857601;\nint phi[N], pm[80000+5], top;\nLL fac;\nint n;\nbool isp[N];\nint pow2(re int x, re int k){//\u5feb\u901f\u5e42 \n\tre LL base = x, ans = 1;//\u7528long long \n\twhile(k){\n\t\tif(k & 1) ans *= base, ans %= mod;\n\t\tbase *= base, base %= mod;\n\t\tk >>= 1;\n\t}\n\treturn ans % mod;\n}\nvoid init(){\n\tfac = 1;\n\tfor(int i = 2; i <= n; i++){\n\t\tfac = fac * i % mod;//\u6c42n\u7684\u9636\u4e58 \n\t\tif(!isp[i]) phi[i] = i - 1, pm[++top] = i;\n\t\tfor(int j = 1; j <= top; j++){\n\t\t\tif(i * pm[j] > n) break;\n\t\t\tisp[i * pm[j]] = 1;\n\t\t\tif(i % pm[j] == 0){\n\t\t\t\tphi[i * pm[j]] = phi[i] * pm[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i * pm[j]] = phi[i] * phi[pm[j]];\n\t\t}\n\t\t\n\t}\n}\nvoid solve(){\n\tLL ans1 = pow2(fac, 2*n);\n\tLL ans2 = pow2(fac, 2);\n\tfor(int i = 2; i <= n; i++){\n\t\tphi[i] = phi[i - 1] + phi[i], phi[i] = phi[i] % (mod - 1);//\u6c42\u524d\u7f00\u548c \n\t}\n\tfor(int i = 2; i <= n/2; i++){\n\t\tans2 = (ans2 * pow2(i, 4 * phi[n/i])) % mod;//\u5bf9\u6bcf\u4e2a\u6570\u8ba8\u8bba\uff0c\u81f3\u591a\u8ba8\u8bba\u5230n/2\uff0c\u56e0\u4e3ai\u521d\u59cb\u4e3a2\uff0c\u53d6\u503c\u6700\u5927\u4e3an/2 \n\t}\n\tLL ans = ans1 * pow2(ans2, mod - 2) % mod;//ans = ans1/ans2\uff08ans2\u6c42\u9006\u5143\uff09 \n\tprintf(\"%d\", ans);//\u6700\u540e\u7684\u7b54\u6848\u53d6\u4e86\u6a21\uff0c\u5728int\u5185 \n}\nsigned main()\n{\n\tn = read();\n\tinit();\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1550204038,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u4e00\u6b21\u5076\u7136\u542c\u5230\u5927\u5bb6\u8bf4\u53cd\u6f14\u5c31\u662f\u8fc7\u4e0d\u4e86\u8fd9\u9898\uff1f\n\n\u51fa\u9898\u4eba\u6807\u7a0b\u662f\u53cd\u6f14\uff0c\u4f46\u662f\u662f $O(n\\log n)$ \u7684\uff1f\n\n\u6709 $O(n)$ \u7684\u505a\u6cd5\uff0c\u4f46\u4e0d\u662f\u53cd\u6f14\uff1f\n\n\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\n\n\u90a3\u6211\u6765\u5199 $O(n)$ \u7684\u53cd\u6f14\u505a\u6cd5\u5427\u3002\n\n---\n\u7531 $\\operatorname{lcm}(i,j)=\\frac{ij}{\\gcd(i,j)}$ \u5f97\uff1a\n$$\\prod\\limits^n_{i=1}\\prod\\limits^n_{j=1}\\frac{ij}{\\gcd^2(i,j)}$$\n$$\\frac{\\prod\\limits^n_{i=1}\\prod\\limits^n_{j=1}ij}{\\prod\\limits^n_{i=1}\\prod\\limits^n_{j=1}\\gcd^2(i,j)}$$\n\u5206\u5b50\u5c31\u662f $(n!)^2$\u3002\u5206\u6bcd\u662f\u4e0b\u9762\u8fd9\u4e2a\u5f0f\u5b50\u7684\u5e73\u65b9\uff1a\n$$\\prod\\limits^n_{i=1}\\prod\\limits^n_{j=1}\\gcd(i,j)$$\n\u679a\u4e3e $\\gcd$\uff0c\u6709\u591a\u5c11\u4e2a\u6570\u5bf9 $(i,j)$ \u6ee1\u8db3 $\\gcd(i,j)=d$\uff0c\u90a3\u4e48\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $d$ \u7684\u591a\u5c11\u6b21\u65b9\u3002\n$$\\prod\\limits^n_{d=1}d^{\\sum\\limits^n_{i=1}\\sum\\limits^n_{j=1}[\\gcd(i,j)=d]}$$\n\u679a\u4e3e $id$ \u548c $jd$\uff1a\n$$\\prod\\limits^n_{d=1}d^{\\sum\\limits^{\\lfloor n/d\\rfloor}_{i=1}\\sum\\limits^{\\lfloor n/d\\rfloor}_{j=1}[\\gcd(i,j)=1]}$$\n\u7531 $\\sum\\limits_{g|n}\\mu(g)=[n=1]$ \u5f97\uff1a\n$$\\prod\\limits^n_{d=1}d^{\\sum\\limits^{\\lfloor n/d\\rfloor}_{i=1}\\sum\\limits^{\\lfloor n/d\\rfloor}_{j=1}\\sum\\limits_{g|\\gcd(i,j)}\\mu(g)}$$\n$$\\prod\\limits^n_{d=1}d^{\\sum\\limits^{\\lfloor n/d\\rfloor}_{g=1}\\mu(g)\\lfloor\\frac{n}{dg}\\rfloor^2}$$\n\u8fd9\u4e2a\u6307\u6570\u53ef\u4ee5\u6574\u9664\u5206\u5757\u3002\uff08\u6ce8\u610f\uff0c$mod$ \u662f\u4e2a\u8d28\u6570\uff0c\u6839\u636e\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff0c\u8ba1\u7b97\u6307\u6570\u65f6\u5e94\u8be5\u5bf9 $mod-1$ \u53d6\u6a21\uff09\n\n\u51fa\u9898\u4eba\u7684\u505a\u6cd5\u662f\u4e00\u4e2a\u4e2a\u679a\u4e3e $d$ \u7136\u540e\u5bf9\u6bcf\u4e2a $d$ \u6574\u9664\u5206\u5757\u3002\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u6307\u6570\u4e2d $\\sum$ \u7684\u4e0a\u754c\u662f $\\lfloor\\frac{n}{d}\\rfloor$\uff0c\u660e\u663e\u53ef\u4ee5\u5bf9 $d$ \u518d\u6765\u4e00\u6b21\u6574\u9664\u5206\u5757\uff01\n\n\u7136\u540e\u5f00\u5fc3\u7684\u628a\u7a0b\u5e8f\u4ea4\u4e86\u4e0a\u53bb\u2026\u2026\n\nMLE\uff1f\uff1f\uff1f\uff01\uff01\uff01\n\n\u8fd9\u5c31\u662f\u51fa\u9898\u4eba\u6076\u6bd2\u6240\u5728\u4e86\u3002\u5982\u679c\u6211\u4eec\u7528\u4e24\u6b21\u6574\u9664\u5206\u5757\uff0c\u5c31\u9700\u8981\u518d\u591a\u4e00\u4e2a\u9636\u4e58\u6570\u7ec4\uff0c\u5206\u5206\u949f\u88ab\u5361\u2026\u2026\n\n\u90a3\u4e5f\u6ca1\u4e8b\u3002\u7528\u5c3a\u53d6\u6cd5\u7684\u601d\u60f3\uff0c\u53ef\u4ee5\u5f04\u4e24\u4e2a\u6307\u9488\uff0c\u6bcf\u6b21\u5206\u5757\u7684 $[l,r]$ \u53d8\u5316\u65f6\uff0c\u6307\u9488\u5c31\u79fb\u52a8\u5230\u76f8\u5e94\u7684\u4f4d\u7f6e\uff0c\u8fb9\u79fb\u8fb9\u5bf9\u9636\u4e58\u505a\u4e58\u6cd5\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u8fd8\u662f\u6709\u70b9\u8bf4\u4e0d\u6e05\u695a\u2026\u2026\u770b\u4ee3\u7801\u5427\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int maxn=1000100,mod=104857601;\n#define FOR(i,a,b) for(int i=(a);i<=(b);i++)\n#define ROF(i,a,b) for(int i=(a);i>=(b);i--)\n#define MEM(x,v) memset(x,v,sizeof(x))\ninline int read(){\n\tchar ch=getchar();int x=0,f=0;\n\twhile(ch<'0' || ch>'9') f|=ch=='-',ch=getchar();\n\twhile(ch>='0' && ch<='9') x=x*10+ch-'0',ch=getchar();\n\treturn f?-x:x;\n}\nint n,mu[maxn],pr[maxn/10],pl;\nbool vis[maxn];\nvoid init(){\n\tmu[1]=1;\n\tFOR(i,2,n){\n\t\tif(!vis[i]) mu[pr[++pl]=i]=-1;\n\t\tFOR(j,1,pl){\n\t\t\tif(i*pr[j]>n) break;\n\t\t\tvis[i*pr[j]]=true;\n\t\t\tif(i%pr[j]) mu[i*pr[j]]=-mu[i];\n\t\t\telse{mu[i*pr[j]]=0;break;}\n\t\t}\n\t}\n\tFOR(i,2,n) mu[i]+=mu[i-1];\n}\nint calc(int n){\t//\u5185\u5c42\u6574\u9664\u5206\u5757\uff0c\u4e0a\u754c\u662fn\n\tint ans=0;\n\tfor(int l=1,r;l<=n;l=r+1){\n\t\tr=n/(n/l);\n\t\tans+=1ll*(n/l)*(n/l)%(mod-1)*(mu[r]-mu[l-1]+mod-1)%(mod-1);\n\t\tans%=mod-1;\t//\u6ce8\u610f\u5bf9mod-1\u53d6\u6a21\uff01\n\t}\n\treturn ans;\n}\nint qpow(int a,int b){\n\tint ans=1;\n\tfor(;b;b>>=1,a=1ll*a*a%mod) if(b&1) ans=1ll*ans*a%mod;\n\treturn ans;\n}\nint main(){\n\tn=read();\n\tinit();\n\tint ans=1;\n\tFOR(i,1,n) ans=1ll*ans*i%mod;\n\tans=qpow(ans,2*n);\n\tint f1=1,f2=1,c1=1,c2=1;\t//\u4e24\u4e2a\u9636\u4e58\u548c\u4e24\u4e2a\u6307\u9488\n\tfor(int l=1,r;l<=n;l=r+1){\t//\u5916\u5c42\u6574\u9664\u5206\u5757\n\t\tr=n/(n/l);\n\t\twhile(c1<=r) f1=1ll*f1*c1%mod,c1++;\t//\u628a\u6307\u9488\u79fb\u5230\u76f8\u5e94\u7684\u4f4d\u7f6e\n\t\twhile(c2<=l-1) f2=1ll*f2*c2%mod,c2++;\t//\u540c\u65f6\u4fee\u6539\u9636\u4e58\n\t\tans=1ll*ans*qpow(1ll*qpow(f1,mod-2)*f2%mod,2*calc(n/l))%mod;\n        //\u7b54\u6848\u9664\u4ee5l\u5230r\u6240\u6709\u6570\u7684\u79ef\u76842*calc(n/l)\u6b21\u65b9\n\t}\n\tprintf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1550297829,
        "uid": 72118,
        "name": "AThousandSuns",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5221\u3010Product\u3011"
    },
    {
        "content": "## Product\n\n### 30\u5206\n\n\u76f4\u63a5\u679a\u4e3e\u3002\u3002\u4e0d\u7528\u591a\u8bf4\u5427\u3002\u3002\n\n### 100\u5206\n\n#### \u849f\u84bb${\\rm CYJian}$\u7684\u8fa3\u9e21$O(NlogN)$\u505a\u6cd5\uff1a\n\n\u9996\u5148\uff0c\u6211\u4eec\u7528\u4e00\u4e2a\u5e38\u8bc6\u516c\u5f0f\uff1a$i \\ast j = gcd(i,j)\\ast lcm(i,j)$\n\n\u7136\u540e\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n\n$$\\prod_{i=1}^{N}\\prod_{j=1}^{N}\\frac{i \\ast j}{(gcd(i, j))^2} \\ (\\bmod\\ 104857601)$$\n\n$$(\\prod_{i=1}^{N}\\prod_{j=1}^{N}i \\ast j)\\ast(\\prod_{i=1}^{N}\\prod_{j=1}^{N}gcd(i, j))^{-2} \\ (\\bmod\\ 104857601)$$\n\n$$(\\prod_{i=1}^{N}i^N \\ast N!) \\ast (\\prod_{d=1}^{N} d^{\\sum_{i=1}^{N}\\sum_{j=1}^{N} [gcd(i, j)==d])^{-2}} \\ (\\bmod\\ 104857601)$$\n\n$$(N!)^{2N} \\ast (\\prod_{d=1}^{N} d^{\\sum_{i=1}^{\\lfloor \\frac{N}{d} \\rfloor}\\sum_{j=1}^{\\lfloor \\frac{N}{d} \\rfloor} [gcd(i, j)==1])^{-2}} \\ (\\bmod\\ 104857601)$$\n\n\u8fd9\u6837\u7684\u8bdd\u5c31\u80fd\u505a\u4e86\u3002\u3002\n\n\u524d\u9762\u7684\u4e1c\u897f\u641e\u4e00\u4e2a\u5feb\u901f\u5e42\uff0c\u540e\u9762\u7684\u679a\u4e3e$d$\uff0c\u7136\u540e\u8ba1\u7b97$N/d$\u5185\u6709\u591a\u5c11\u7ec4\u6570\u662f\u4e92\u8d28\u7684\uff0c\u53ef\u4ee5\u7528\u6b27\u62c9\u51fd\u6570\u7b97\u3002\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u3002\n\n### \u5927\u4f6c${\\rm suwakow}$\u7684\u5f3a\u52b2$O(N)$(\u8fd1\u4f3c)\u505a\u6cd5\n\n> \u5bf9\u4e8e$\\frac{lcm(i,j)}{gcd(i,j)}$\uff0c\u53ef\u4ee5\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u4e2a\u8d28\u6570$p$\uff0c\u8fd9\u6837\u7684\u8bdd\u8fd9\u4e00\u5768\u4e1c\u897f\u5728\u8d28\u6570$p$\u7684\u8d21\u732e\u5373\u4e3a$p^{|t_i-t_j|}$\uff0c\u5176\u4e2d$t_x$\u8868\u793a$x$\u6709\u591a\u5c11\u4e2a\u4e3a$p$\u7684\u56e0\u5b50\u3002\n\n> \u7136\u540e\u53ef\u4ee5\u8003\u8651\u7b5b\u51fa\u6240\u6709\u8d28\u6570\u540e\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8d28\u6570\u5bb9\u65a5\u5904\u7406\u51fa$N$\u4ee5\u5185\u6240\u6709\u6570\u7684\u5f53\u524d\u8d28\u56e0\u5b50\u4e2a\u6570\uff0c\u7136\u540e\u7ecf\u8fc7\u5904\u7406\u540e\u5c31\u80fd\u5f97\u5230\u5f53\u524d\u8fd9\u4e2a\u8d28\u56e0\u5b50\u7684\u7b54\u6848\u4e86\u3002\n\nSTO ${\\rm suwakow}$ orz\n\n\u4ee3\u7801\u7684\u8bdd\u3002\u3002\u592a\u4e11\u4e86\u8fd8\u662f\u4e0d\u653e\u4e86\u5427\u3002\u3002",
        "postTime": 1550151536,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "[$blog$](https://www.cnblogs.com/henry-1202/p/10462180.html)\n\n\u6ce8\uff0c\u4e0b\u65b9$(i,j)$\u5747\u6307$gcd(i,j)$\uff0c\u4ee5\u53ca\u8bc1\u660e\u8fc7\u7a0b\u6709\u4e00\u5b9a\u7684\u8df3\u6b65\uff0c\u8bf7\u786e\u4fdd\u81ea\u5df1\u4f1a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u57fa\u672c\u5957\u8def\u3002\n\n\u4ecb\u7ecd\u672c\u9898\u7684$O(n)$\u548c$O(n\\sqrt{n})$\u505a\u6cd5\uff0c\u672c\u9898\u8fd8\u6709$O(nlogn)$\u505a\u6cd5\uff0c\u9700\u8981\u7528\u5230\u6b27\u62c9\u51fd\u6570\uff0c\u6216\u8005\u662f\u4ece\u8d28\u56e0\u5b50\u89d2\u5ea6\u8003\u8651\u4e5f\u53ef\u4ee5\u5f97\u5230\u53e6\u5916\u4e00\u4e2a$O(n)$\u505a\u6cd5\u3002\n\n\u8fd9\u4e2a$O(n)$\u505a\u6cd5\u80fd\u8fdb\u7b2c\u4e00\u9875\u3002\n\n\u9898\u76ee\u5c31\u662f\u6c42\n$$\\prod_{i=1}^n\\prod_{j=1}^n\\frac{ij}{(i,j)^2}$$\n\n\u8003\u8651\u5206\u89e3\u4e00\u4e0b\n\n$$\\prod_{i=1}^n\\prod_{j=1}^n\\frac{ij}{(i,j)^2}=        \\frac{\\prod_{i=1}^n\\prod_{j=1}^nij}{\\prod_{i=1}^n\\prod_{j=1}^n(i,j)^2}$$\n\n\u5bf9\u4e8e\u5206\u5b50\u53ef\u5f97\n\n$$\\begin{aligned}&\\prod_{i=1}^n\\prod_{j=1}^nij\\\\&=\\prod_{i=1}^ni\\prod_{j=1}^nj\\\\&=\\prod_{i=1}^ni*n!\\\\&=(n!)^{2n}\\end{aligned}$$\n\u5bf9\u4e8e\u5206\u6bcd\uff0c\u6211\u4eec\u8003\u8651\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\n\n$$\\begin{aligned}&\\prod_{i=1}^n\\prod_{j=1}^n(i,j)^2\\\\&=\\prod_{d=1}^nd^{2\\sum_{i=1}^n\\sum_{j=1}^n[(i,j)=d]}\\\\&=\\prod_{d=1}^nd^{2\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}[(i,j)=1]}\\\\&=\\prod_{d=1}^nd^{2\\sum_{k=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(k)\\lfloor\\frac{n}{kd}\\rfloor^2}\\\\\\end{aligned}$$\n\n\u81f3\u6b64\uff0c\u679a\u4e3e$d$\uff0c\u5bf9\u6307\u6570\u6574\u9664\u5206\u5757\uff0c\u5373\u53ef$O(n\\sqrt{n})$\u89e3\u51b3\u6b64\u9898\u3002\n\n\u5bb9\u6613\u53d1\u73b0$\\lfloor\\frac{n}{d}\\rfloor$\u662f\u53ef\u4ee5\u6574\u9664\u5206\u5757\u7684\u3002\u90a3\u4e48\u600e\u4e48\u5904\u7406\u533a\u95f4$[l,r]$\u7684$d$\u5462\uff0c\u5c06\u5b83\u5c55\u5f00\uff0c\u5176\u5b9e\u5c31\u662f$\\frac{r!}{(l-1)!}$\uff0c\u7531\u4e8e\u51fa\u9898\u4eba\u5361\u7a7a\u95f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u9636\u4e58\u800c\u4e0d\u662f\u9884\u5904\u7406\uff08\u590d\u6742\u5ea6\u540c\u6837\u662f$O(n)$\uff0c\u6bcf\u4e2a\u6570\u53ea\u4f1a\u88ab\u904d\u5386\u4e00\u6b21\uff09\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u505a\u5230$O(n)$\u89e3\u51b3\u672c\u9898\u4e86\u3002\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#define ll long long\nusing namespace std;\n\nconst int mod = 104857601;\nconst int p = 104857600;\nconst int N = 1000010;\n\nbool vis[N];\nshort mu[N];\nint pr[N], cnt = 0;\nint fac;\n\nint power(int a, int b, int Mod) {\n\tint ans = 1;\n\twhile(b) {\n\t\tif(b & 1) ans = (ll)ans * a % Mod;\n\t\ta = (ll)a * a % Mod;\n\t\tb >>= 1;\n\t}\n\treturn ans % Mod;\n}\n\nvoid init(int n) {\n\tmu[1] = 1;\n\tfor(int i = 2; i <= n; ++i) {\n\t\tif(!vis[i]) pr[++cnt] = i, mu[i] = -1;\n\t\tfor(int j = 1; j <= cnt && i * pr[j] <= n; ++j) {\n\t\t\tvis[i * pr[j]] = 1;\n\t\t\tif(i % pr[j] == 0) break;\n\t\t\tmu[i * pr[j]] = -mu[i];\n\t\t}\n\t\tmu[i] += mu[i - 1];\n\t}\n\tfac = 1;\n\tfor(int i = 1; i <= n; ++i) fac = (ll)fac * i % mod;\n}\n\nint n;\n\nint calc2(int n) {\n\tint ans = 0;\n\tfor(int l = 1, r; l <= n; l = r + 1) {\n\t\tr = n / (n / l);\n\t\tans = (ans + (ll)(n / l) * (n / l) % p * (mu[r] - mu[l - 1] + p) % p) % p;\n\t}\n\treturn ans % p;\n}\n\nint main() {\n\tscanf(\"%d\", &n);\n\tinit(n);\n\tint ans = 1;\n\tint sum = power((ll)fac * fac % mod, n, mod);\n\tfor(int l = 1, r; l <= n; l = r + 1) {\n\t\tr = n / (n / l); fac = 1ll;\n\t\tfor(int i = l; i <= r; ++i) fac = (ll)fac * i % mod;\n\t\tint t = power((ll)fac * fac % mod, calc2(n / l), mod);\n\t\tans = (ll)ans * t % mod;\n\t}\n\tprintf(\"%lld\\n\", (ll)sum * power(ans, mod - 2, mod) % mod);\n}\n```\n\n$O(n\\sqrt{n})$\u4ee3\u7801\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <cstring>\n#include <cstdlib>\n#include <cstdio>\n#include <vector>\n#include <queue>\n#include <cmath>\n#include <stack>\n#include <deque>\n#include <map>\n#include <set>\n\n#define ll long long\n#define inf 0x3f3f3f3f\n#define il inline\n\nnamespace io {\n\n#define in(a) a = read()\n#define out(a) write(a)\n#define outn(a) out(a), putchar('\\n')\n\n#define I_int int\ninline I_int read() {\n    I_int x = 0, f = 1;\n    char c = getchar();\n    while (c < '0' || c > '9') {\n        if (c == '-') f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9') {\n        x = x * 10 + c - '0';\n        c = getchar();\n    }\n    return x * f;\n}\nchar F1[200];\ninline void write(I_int x) {\n    if (x == 0) return (void) (putchar('0'));\n    I_int tmp = x > 0 ? x : -x;\n    if (x < 0) putchar('-');\n    int cnt = 0;\n    while (tmp > 0) {\n        F1[cnt++] = tmp % 10 + '0';\n        tmp /= 10;\n    }\n    while (cnt > 0) putchar(F1[--cnt]);\n}\n#undef I_int\n\n}\nusing namespace io;\n\nusing namespace std;\n\nconst ll mod = 104857601;\nconst ll p = 104857600;\nconst int N = 1000010;\n\nbool vis[N];\nshort mu[N];\nint pr[N], cnt = 0;\nll fac;\n\nll power(ll a, int b, int Mod) {\n    ll ans = 1;\n    while(b) {\n        if(b & 1) ans = (long long) ans * a % Mod;\n        a = (long long) a * a % Mod;\n        b >>= 1;\n    }\n    return ans % mod;\n}\n\nvoid init(int n) {\n    mu[1] = 1;\n    for(int i = 2; i <= n; ++i) {\n        if(!vis[i]) pr[++cnt] = i, mu[i] = -1;\n        for(int j = 1; j <= cnt && i * pr[j] <= n; ++j) {\n            vis[i * pr[j]] = 1;\n            if(i % pr[j] == 0) break;\n            mu[i * pr[j]] = -mu[i];\n        }\n        mu[i] += mu[i - 1];\n    }\n    fac = 1;\n    for(ll i = 1; i <= n; ++i) fac = (ll)fac * i % mod;\n}\n\nint n;\n\nll calc2(ll n) {\n    ll ans = 0;\n    for(ll l = 1, r; l <= n; l = r + 1) {\n        r = n / (n / l);\n        ans = ans + (n / l) % p * (n / l) % p * (ll)(mu[r] - mu[l - 1] + p) % p;\n        ans %= p; ans += p; ans %= p;\n    }\n    return ans % p;\n}\n\nint main() {\n    n = read();\n    init(n);\n    ll ans = 1;\n    for(ll i = 1; i <= n; ++i) \n        ans = ans * power((long long)i * i % mod, calc2(n / i), mod) % mod;\n    ll sum = power((long long)fac * fac % mod, n, mod);\n    printf(\"%lld\\n\", sum % mod * power(ans, mod - 2, mod) % mod);\n}\n```",
        "postTime": 1551520980,
        "uid": 36526,
        "name": "henry_y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u4e8b\u5b9e\u8bc1\u660e,$gcd$\u548c$\\sum$\u5957\u8d77\u6765\u771f\u7684\u6bd4\u8f83\u597d\u73a9!\n\n$gcd$\u548c$\u220f$\u5957\u8d77\u6765\u2026\u2026\u4e5f\u5f88\u597d\u73a9\u3002\n\n\u4e0b\u9762\u7684\u89e3\u6cd5\u662f**\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14**,\u8fd0\u7528\u8fd9\u4e2a\u89e3\u6cd5,\u8fd9\u9053\u9898\u7684\u4e24\u4e2a$\u220f$\u4e0a\u9762\u7684\u6570\u5b57\u53ef\u4ee5\u4e0d\u540c(\u4f1a\u6709MLE\u7684\u5371\u9669)\u3002\n\n\u4e8b\u5b9e\u8bc1\u660e\u6211\u60f3\u591a\u4e86,\u63d0\u4ea4\u8bb0\u5f55\u91cc\u6709\u8bb8\u591a\u5927\u4f6c\u7528\u6bd4\u6211\u77ed\u8fd8\u6bd4\u6211\u5feb\u7684\u4ee3\u7801\u534e\u4e3dAC\u4e86,\u7136\u800c\u6211\u5e76\u770b\u4e0d\u61c2,\u5750\u7b49\u5176\u4ed6\u89e3\u6cd5\u7684\u9898\u89e3\u3002\n\n\u4ece\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u89d2\u5ea6\u6765\u770b,\u8fd9\u9898\u662f\u9053\u597d\u9898,\u89e3\u6cd5\u5f88\u673a\u667a(\u81f3\u5c11\u5728\u6211\u8fd9\u4e2a\u849f\u84bb\u770b\u6765\u662f\u8fd9\u6837\u7684\u3002)\n\n[\u4ecb\u7ecd\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u6587\u7ae0](https://www.luogu.org/blog/command-block/mu-bi-wu-si-fan-yan-ji-ji-ying-yong)\n\n------------\n\n\u9996\u5148\u5462,\u9898\u76ee\u53eb\u6211\u4eec\u6c42$\\large{\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^N\\dfrac{lcm(i,j)}{gcd(i,j)}}$,\u5bf9\u5927\u8d28\u6570\u53d6\u6a21\u3002\n\n\u5c0f\u5b66\u5965\u6570\u544a\u8bc9\u6211\u4eec$lcm(i,j)=\\dfrac{i*j}{gcd(i,j)}$\n\n\u4e8e\u662f\u5f0f\u5b50\u53d8\u6210$\\large{\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^N\\dfrac{i*j}{gcd(i,j)^2}}$\n\n\u518d\u53d8\u6210$\\Large{\\frac{\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^Ni*j}{\\left(\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^Ngcd(i,j)\\right)^2}}$\n\n$\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^Ni*j$\u7528\u4e00\u4e2a\u5f88simple\u7684\u5feb\u901f\u5e42\u5c31\u53ef\u4ee5\u6c42\u51fa\u6765\u4e86\u3002\n\n\u91cd\u70b9\u662f\u5982\u4f55\u6c42$\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^Ngcd(i,j)$\n\n\u6211\u4eec\u8bbe$G(x,y)$\u4e3a$\\sum\\limits_{i=1}^y\\sum\\limits_{j=1}^y[gcd(i,j)==x]$\u3002\n\n\u90a3\u4e48$\\large{\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^Ngcd(i,j)=\u220f\\limits_{i=1}^Ni^{G(i,N)}}$(\u597d\u597d\u7406\u89e3\u54e6)\n\n\u8fd9\u76f8\u5f53\u4e8e\u628a$gcd(i,j)$\u4e2d\u76f8\u540c\u7684\u4e2a\u6570\u7edf\u8ba1\u51fa\u6765,\u7136\u540e\u7528\u5feb\u901f\u5e42\u4e00\u6b21\u641e\u5b9a\u3002\n\n\u8003\u8651\u5982\u4f55\u6c42\u51fa$G(1,N),G(2,N)\u2026\u2026G(N,N)$\u3002\n\n\u4e00\u4e2a\u66b4\u529b\u7684\u505a\u6cd5\u662f:\u76f4\u63a5\u5957\u7528[\u8fd9\u9053\u9898](https://www.luogu.org/problemnew/show/P3455)\u7684\u89e3\u6cd5,\u5bf9\u6bcf\u4e2a$G(1,N)$\u7528\u4e00\u4e2a\u6574\u9664\u5206\u5757$O(\\sqrt{n})$\u6c42,\u8d85\u65f6\u59a5\u59a5\u7684\u3002\n\n\u8bb2\u4e00\u4e0b\u8fd9\u4e2a\u505a\u6cd5\u3002\n\n\u6211\u4eec\u8981\u6c42$G(x,N)=\\sum\\limits_{i=1}^N\\sum\\limits_{j=1}^N[gcd(i,j)==x]$\n\n\u6211\u4eec\u628a\u5f0f\u5b50\u4e2d\u6240\u6709\u7684\u6570\u6574\u9664x(\u8fd9\u662f\u8001\u5957\u8def\u4e86)\u3002\n\n\u5f97\u5230$G(x,N)=\\sum\\limits_{i=1}^{N/x}\\sum\\limits_{j=1}^{N/x}[gcd(i,j)==1]=G(1,N/x)$\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ea\u8981\u80fd\u591f\u6c42\u51fa\u6c42$G(1,N)$(N\u4e3a\u53d8\u91cf)\u5c31\u597d\u4e86\u3002\n\n\u63a5\u4e0b\u6765**\u53cd\u6f14**\u3002\n\n\u5bf9\u4e00\u4e2a\u786e\u5b9a\u7684$N$\u8bbe$f(x)=\\sum\\limits_{i=1}^N\\sum\\limits_{j=1}^N[gcd(i,j)==x]$ , $F(x)=\\sum\\limits_{i=1}^{N}\\sum\\limits_{j=1}^{N}[x|gcd(i,j)]$\n\n\u5f97\u51fa$F(N)=\\sum\\limits_{N|d}f(d)$\n\n\u7531\u53cd\u6f14\u5b9a\u7406\u5f97\u51fa$f(N)=\\sum\\limits_{N|d}\\mu(d/N)F(d)$\n\n\u5148\u5bf9$F(d)$\u8fdb\u884c\u7b80\u5316,\u628a\u5f0f\u5b50\u4e2d\u6240\u6709\u7684\u6570\u6574\u9664x\u3002\n\n\u5f97\u5230$F(d)=\\sum\\limits_{i=1}^{N/x}\\sum\\limits_{j=1}^{N/x}[1|gcd(i,j)]=(N/x)^2$\n\n\u6211\u4eec\u8981\u6c42$G(1,N)=f(1)$,\u76f4\u63a5\u4ee4\u4e0a\u5f0f\u4e2d$N=1$\u5f97\u5230:\n\n$f(1)=\\sum\\limits_d\\mu(d)F(d)$\n\n\u8003\u8651\u5230$F(d)=(N/x)^2$,\u5728$1<=d<=N$\u65f6\u624d\u6709\u503c(\u610f\u4e49):\n\n$f(1)=\\sum\\limits_{d=1}^{N}\\mu(d)F(d)=\\sum\\limits_{d=1}^{N}\\mu(d)(N/d)^2$\n\n\u5230\u8fd9\u91cc\u5df2\u7ecf\u53ef\u4ee5$O(n)$\u6c42\u4e86,\u6211\u4eec\u5bf9$(N/d)$\u6574\u9664\u5206\u5757\u5373\u53ef\u8fbe\u5230$O(\\sqrt{n})$,\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0,\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u9605\u8bfb\u4e0a\u9762\u4ecb\u7ecd\u83ab\u53cd\u7684\u6587\u7ae0\u3002\n\n------------\n\n\u63a5\u4e0b\u6765\u662f\u6b63\u89e3,\u5728\u4e0a\u9762\u7684\u89e3\u6cd5\u4e2d\u7a0d\u4f5c\u4fee\u6539\u5373\u53ef\u3002\n\n\u5982\u679c\u4f60\u4f1a\u6574\u9664\u5206\u5757,\u518d\u6ce8\u610f\u5230$G(x,N)=G(1,N/x)$\u4f60\u4f1a\u53d1\u73b0$N/x$\u7684\u53d6\u503c\u53ea\u4f1a\u6709$O(\\sqrt{N})$\u79cd\u3002\n\n\u6211\u4eec\u5bf9$G(1,N/x)$\u6574\u9664\u5206\u5757,\u5c31\u53ea\u7528\u6c42$O(\\sqrt{N})$\u6b21$G(1,?)$\u590d\u6742\u5ea6\u4ece$O(N\\sqrt{N})$\u964d\u5230$O(NlogN)$\n\n(\u74f6\u9888\u5728\u5feb\u901f\u5e42,\u5982\u679c\u6709\u5fc3\u601d\u628a\u5206\u5757\u8fdb\u884c\u5230\u5e95,\u8fd8\u53ef\u4ee5\u53d8\u6210$O(N)$)\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define mod 104857601\nusing namespace std;\nint t,n,m,tn,p[200500],mu[1000500];\nbool e[1000500];\nlong long sav[1000500],ans=1;\nlong long powM(long long a,long long t=mod-2)\n{\n  long long ans=1,buf=a;\n  while(t){\n  \tif (t&1)ans=ans*buf%mod;\n  \tbuf=buf*buf%mod;\n  \tt>>=1;\n  }return ans;\n}\nvoid getmu()\n{\n  e[1]=1;mu[1]=1;\n  for (int i=2;i<=1000100;i++){\n  \tif (!e[i]){\n  \t  p[++tn]=i;\n  \t  mu[i]=-1;\n    }for (int j=1;j<=tn;j++){\n      if (1ll*i*p[j]>1000100)break;\n      e[i*p[j]]=1;\n      mu[i*p[j]]=i%p[j] ? -mu[i] : 0;\n      if (!i%p[j])break;\n    }\n  }//\u7ebf\u7b5b\u51famu \n}\nlong long calc(int n)\n{\n  long long ans=0;\n  int l=1,r;\n  for (;l<=n;l=r+1){\n  \tr=n/(n/l);\n  \tans+=1ll*(n/l)*(n/l)*(mu[r]-mu[l-1]);\n  }return ans;\n  //\u5957\u8def\u53cd\u6f14\n}\nint main()\n{\n  scanf(\"%d\",&n);\n  getmu();\n  for (int i=2;i<=1000100;i++)mu[i]+=mu[i-1];\n  //\u9884\u5904\u7406mu\u524d\u7f00\u548c\n  for (int i=1;i<=n;i++){\n  \tint nn=n/i;\n  \tif (!sav[nn])sav[nn]=calc(nn);\n    //\u5982\u679c\u6c42\u8fc7\u5c31\u4e0d\u7528\u518d\u6c42,\u61d2\u4eba\u5206\u5757\u6cd5\n\tans=(ans*powM(i,sav[nn]))%mod;\n  }ans=powM(ans);\n  ans=(ans*ans)%mod;\n\n  for (int i=1;i<=n;i++)\n   ans=ans*powM(i,n*2)%mod;\n  printf(\"%lld\",ans);\n  return 0;\n}\n```\n\n\u6240\u4ee5\u8fd9\u9898\u53ef\u4ee5\u51fa\u4e2a\u52a0\u5f3a\u7248:\u6c42$\\large{\u220f\\limits_{i=1}^N\u220f\\limits_{j=1}^M\\dfrac{lcm(i,j)}{gcd(i,j)}},(N,M<=10^7)$\u3002",
        "postTime": 1550210186,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u8fd9\u79cd\u5f0f\u5b50\u80af\u5b9a\u662f\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u4e4b\u7c7b\u7684\u5957\u8def\n$$\\begin{aligned}& \\prod_{i=1}^n\\prod_{j=1}^n \\frac{\\mathrm{lcm}(i,j)}{\\gcd(i,j)} \\\\=& \\prod_{i=1}^n\\prod_{j=1}^n \\frac{ij}{\\gcd^2(i,j)} \\\\\\end{aligned}$$\n\n\u5176\u4e2d\n\n$$\\begin{aligned}&\\prod_{i=1}^n\\prod_{j=1}^n \\gcd(i,j)\\\\=&\\prod_{d=1}^n d^{\\sum_{i=1}^n\\sum_{j=1}^n[\\gcd(i,j)=d]}\\end{aligned}$$\n\u7136\u540e\u66b4\u529b\u53cd\u6f14\u6216\u8005\u6c42$\\varphi$\u5373\u53ef\n\n------\n\n\u8fd9\u79cd\u65b9\u6cd5\u592a$\\texttt{naive}$\u4e86\uff0c\u6362\u4e00\u79cd\n\n\u8003\u8651\u7b5b\u51fa$f(i) = \\prod_{j=1}^n \\gcd(i,j)$\n\n\u5f53$i \\in \\mathrm{prime}$\u65f6\uff0c$f(i) = i^{n / i}$\n\n\u5426\u5219\u627e\u5230\u4e00\u4e2a\u8d28\u56e0\u5b50$p$\n\n\u8bbe$i = i' \\times p^a$\uff0c\u90a3\u4e48\u56e0\u4e3a$p$\u80fd\u591f\u52a0\u5230$\\prod \\gcd(i,j)$\u7684\u603b\u8d21\u732e\u662f$p^{n / p^a}$\uff0c\u6240\u4ee5\n\n$$f(i) = f(i') \\times p^{n / p^a}$$\n\n\u7136\u540e\u66b4\u529b\u7ebf\u6027\u7b5b\u5c31\u53ef\u4ee5\u4e86\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u7ea6\u662f$\\mathrm{O}(n\\log_2 n)$\n\n\u4ee3\u7801\u89c1\u6211\u7684[$blog$](https://www.cnblogs.com/cj-xxz/p/10386719.html)",
        "postTime": 1550279043,
        "uid": 46800,
        "name": "xgzc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u9700\u8981\u6211\u4eec\u8ba1\u7b97\u7684\u503c\uff1a\n\n$ \\prod_{i=1}^{n}\\prod_{j=1}^{n}\\frac{lcm(i, j)}{gcd(i, j)} $\n\n\u9996\u5148\uff0c\u6211\u4eec\u77e5\u9053\uff1a\n\n$ lcm(i, j)=\\frac{ij}{gcd(i, j)} $\n\n\u4e8e\u662f\uff0c\u6700\u4e0a\u9762\u7684\u516c\u5f0f\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1a\n\n$ \\prod_{i=1}^{n}\\prod_{j=1}^{n}\\frac{ij}{gcd(i, j)^{2}} $\n\n\u5230\u8fd9\u91cc\uff0c\u5206\u522b\u8ba1\u7b97\u5206\u5b50\u7684\u4e58\u79ef\uff0c\u4ee5\u53ca\u5206\u6bcd\u7684\u4e58\u79ef\u5373\u53ef\u3002\n\n\u90a3\u4e48\u5982\u4f55\u8ba1\u7b97\u8fd9\u4e24\u4e2a\u4e58\u79ef\u5462\uff1f\n\n### 1. \u5206\u5b50\n\n$ \\prod_{i=1}^{n}\\prod_{j=1}^{n}ij $\n\n\u753b\u4e00\u4e2a\u8868\u683c\uff08\u4f8b\u5982\u5728 $ n = 5 $ \u7684\u65f6\u5019\uff0c\u5982\u4e0b\uff09\uff1a\n\n| 1 | 2 | 3 | 4 | 5 |\n| - | - | - | - | - |\n| $ 1 \\times 1 $ | $ 1 \\times 2 $ | $ 1 \\times 3 $ | $ 1 \\times 4 $ | $ 1 \\times 5 $ |\n| $ 2 \\times 1 $ | $ 2 \\times 2 $ | $ 2 \\times 3 $ | $ 2 \\times 4 $ | $ 2 \\times 5 $ |\n| $ 3 \\times 1 $ | $ 3 \\times 2 $ | $ 3 \\times 3 $ | $ 3 \\times 4 $ | $ 3 \\times 5 $ |\n| $ 4 \\times 1 $ | $ 4 \\times 2 $ | $ 4 \\times 3 $ | $ 4 \\times 4 $ | $ 4 \\times 5 $ | \n| $ 5 \\times 1 $ | $ 5 \\times 2 $ | $ 5 \\times 3 $ | $ 5 \\times 4 $ | $ 5 \\times 5 $ |\n\n\u6211\u4eec\u5148\u53ea\u89c2\u5bdf\u8868\u683c\u4e2d\u6bcf\u4e00\u683c\u4e2d\uff0c\u4e58\u53f7**\u5de6\u4fa7**\u7684\u6570\u3002\n\n| 1 | 2 | 3 | 4 | 5 |\n| - | - | - | - | - |\n| 1 | 1 | 1 | 1 | 1 |\n| 2 | 2 | 2 | 2 | 2 |\n| 3 | 3 | 3 | 3 | 3 |\n| 4 | 4 | 4 | 4 | 4 |\n| 5 | 5 | 5 | 5 | 5 |\n\n\u5b83\u4eec\u7684\u4e58\u79ef\u662f\u591a\u5c11\uff1f\u6bcf\u4e00\u5217\u7684\u4e58\u79ef\u662f $ n! $\uff0c\u6240\u4ee5\u8fd9\u4e9b\u6570\u7684\u4e58\u79ef\u662f $ n!^{n} $\u3002\n\n\u4e58\u53f7**\u53f3\u4fa7**\u7684\u6570\u4e5f\u5f88\u76f8\u4f3c\uff0c\u4e58\u79ef\u4e5f\u662f$ n!^{n} $\u3002\n\n\u6240\u4ee5\uff0c\u6700\u4e0a\u9762\u7684\u516c\u5f0f\uff0c\u5206\u5b50\u90e8\u5206\u7684\u4e58\u79ef\u662f$ n!^{2n} $\u3002\n\n### 2. \u5206\u6bcd\n\n$ \\prod_{i=1}^{n}\\prod_{j=1}^{n}gcd(i, j)^{2} $\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u7279\u70b9\uff1a\u867d\u7136\u6211\u4eec\u8981\u5bf9\u5f88\u591a\u4e2agcd\u7684\u503c\u6c42\u4e58\u79ef\uff0c\u4f46\u662f\u4e0d\u540c\u7684gcd\u503c\u7684\u6570\u91cf\u662f\u76f8\u5bf9\u6709\u9650\u7684\uff08n\u4e2a\uff09\u3002\n\n\u6240\u4ee5\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff1a\u4ee4 $ f[i] $ \u8868\u793a\u5728 $ a \\in [1, n] $ \u4e14 $ b \\in [1, n] $ \u7684\u6761\u4ef6\u4e0b\uff0c\u6709\u591a\u5c11\u5bf9 $ a $\uff0c$ b $ \u6ee1\u8db3 $ gcd(a, b)=i $\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8ba1\u7b97 $ f[i] $\uff1a\n\n1. \u5148\u8ba1\u7b97\u6709\u591a\u5c11\u5bf9 $ a $\uff0c$ b $ \u6ee1\u8db3 $ gcd(a, b)=i $ \u662f **$ i $ \u7684\u500d\u6570**\u3002\u8fd9\u4e2a\u503c\u5f88\u5bb9\u6613\u5f97\u5230\uff0c\u662f $ \\lfloor\\frac{n}{i}\\rfloor\\lfloor\\frac{n}{i}\\rfloor $\u3002\n2. \u5c06 $ f[i] $ \u7684\u503c**\u51cf\u53bb** $ f[2i] $\u3001$ f[3i] $\u3001$ f[4i]\\cdots $\u7684\u503c\u3002\n\n\u6ce8\u610f $ f[i] $ \u7684\u503c\u5fc5\u987b\u6309\u7167\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u8ba1\u7b97\u3002\u53ef\u4ee5\u8bc1\u660e\u8fd9\u6837\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $ O(nlogn) $ \u7684\u3002\n\n\u8ba1\u7b97\u5b8c $ f[i] $ \u4e4b\u540e\uff0c\u5206\u6bcd\u7684\u503c\u5c31\u5f88\u5bb9\u6613\u8ba1\u7b97\u4e86\u3002\n\n### 3.\u6ce8\u610f\u4e8b\u9879\n\n\u8fd9\u9898\u7684\u5185\u5b58\u9650\u5236\u53ea\u67098MB\uff0c\u4f46 $ f[i] $ \u7684\u53d6\u503c\u662f long long \u8303\u56f4\u7684\u3002\n\n\u628a $ f[i] $ \u5f00 long long \u7684\u8bdd\uff0c\u518d\u52a0\u4e0a\u5176\u4ed6\u90e8\u5206\u7684\u5185\u5b58\u5360\u7528\uff0c\u5f88\u5bb9\u6613\u5c31 MLE \u4e86\u3002\n\n\u6240\u4ee5\u6211\u4f7f\u7528\u4e86\u4e00\u4e2a\u5c0f\u6280\u5de7\uff1a\u56e0\u4e3a\u5bf9\u4e8e\u5f88\u5927\u7684 $ i $ \uff0c$ f[i] $ \u4f1a\u5f88\u5c0f\uff0c\u4e0d\u9700\u8981 long long\uff0c\u6240\u4ee5\u6211\u628a $ i $ \u6bd4\u8f83\u5c0f\u7684 $ f[i] $ \u5b58\u50a8\u5728 long long \u6570\u7ec4\u91cc\uff0c\u628a$ i $ \u6bd4\u8f83\u5927\u7684 $ f[i] $ \u5b58\u50a8\u5728 int \u6570\u7ec4\u91cc\u3002\n\n```cpp\n#include <cstdio>\n\nusing namespace std;\n\n#define MOD 104857601\n#define inv(a) fpow(a, MOD - 2)\n\n// \u5728\u4ee3\u7801\u4e2d\uff0ccnt\u4ee3\u8868\u4e86f\u7684\u610f\u601d\n#define getcnt(a) ((a) > 100000 ? cntR[a-100000] : cntL[a])\n#define setcnt(a, b) ((a) > 100000 ? cntR[a-100000] = b : cntL[a] = b)\n\nlong long cntL[100005];\nint cntR[900005];\n\nlong long n;\n\nint mul(int a, int b)\n{\n    return ((long long)a * (long long)b) % MOD;\n}\n\nint fpow(int base, long long exponent)\n{\n    int ans = 1;\n    int cur = base;\n    for (int i = 0; i < 45; i++) {\n        if (exponent < ((long long)1 << (long long)i)) break;\n        if (exponent & ((long long)1 << (long long)i)) {\n            ans = mul(ans, cur);\n        }\n        cur = mul(cur, cur);\n    }\n    return ans;\n}\n\nint main()\n{\n    scanf(\"%lld\", &n);\n    for (int i = n; i >= 1; i--) {\n        setcnt(i, (long long)(n / i) * (long long)(n / i));\n        for (int j = i * 2; j <= n; j += i) {\n            setcnt(i, getcnt(i) - getcnt(j));\n        }\n    }\n    int nfact = 1;\n    for (int i = 2; i <= n; i++) nfact = mul(nfact, i);\n    int numerator = fpow(nfact, n * 2);\n    int denominator = 1;\n    for (int i = 2; i <= n; i++) {\n        denominator = mul(denominator, fpow(mul(i, i), getcnt(i)));\n    }\n    printf(\"%d\", mul(numerator, inv(denominator)));\n    return 0;\n}\n\n```\n\n\n\n\n",
        "postTime": 1550191593,
        "uid": 148038,
        "name": "SHZhang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "## \u6765\u4e00\u4e2a\u7b80\u5355\u7684 $O(n)$ \u89e3\u6cd5\uff1a\u4e0d\u7528\u5361\u5e38\uff0c\u4e0d\u7528\u7b5b $\\mu,\\phi$\uff0c\u4e0d\u7528\u6574\u9664\u5206\u5757\u3002\n\n\u53ea\u9700\u8981\u7ebf\u6027\u7b5b\u8d28\u6570\u3002\n\n\u76f4\u63a5\u5217\u5f0f\uff1a\n\n$$A=\\prod_{i=1}^{n}\\prod_{j=1}^n\\frac{\\text{lcm}(i,j)}{\\gcd(i,j)}=\\prod_{d=1}^n \\prod_{i=1}^{\\lfloor n/d\\rfloor}\\prod_{j=1}^{\\lfloor n/d\\rfloor}(ij)^{[gcd(i,j)=1]}$$\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u4e00\u4e0b\u3002\n\n$$A=\\prod_{d=1}^n \\prod_{i=1}^{\\lfloor n/d\\rfloor}\\prod_{j=1}^{\\lfloor n/d\\rfloor}(ij)^{\\sum_{s|i,s|j}\\mu(s)}=\\prod_{d=1}^n \\prod_{i=1}^{\\lfloor n/d\\rfloor}\\prod_{j=1}^{\\lfloor n/d\\rfloor}\\prod_{s|i,s|j}(ij)^{\\mu(s)}=\\prod_{d=1}^n\\prod_{s=1}^{\\lfloor n / d \\rfloor}\\prod_{i=1}^{\\lfloor n / ds \\rfloor}\\prod_{j=1}^{\\lfloor n / ds \\rfloor}(ijs^2)^{\\mu(s)}=\\prod_{d=1}^n\\prod_{s=1}^{\\lfloor n / d \\rfloor}(\\lfloor n / ds \\rfloor !)^{2\\mu(s)\\lfloor n / ds \\rfloor}s^{2\\mu(s)\\lfloor n / ds \\rfloor^2}$$\n\n\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u5bf9\u7b54\u6848 $A$ \u5148\u5f00\u4e2a\u6839\uff0c\u6700\u540e\u518d\u5e73\u65b9\u56de\u53bb\u3002\u6ce8\u610f $t=ds$\u3002\n\n$$\\sqrt A=\\prod_{d=1}^n\\prod_{s=1}^{\\lfloor n / d \\rfloor}(\\lfloor n / ds \\rfloor !)^{\\mu(s)\\lfloor n / ds \\rfloor}s^{\\mu(s)\\lfloor n / ds \\rfloor^2}=\\prod_{t=1}^n(\\lfloor n / t \\rfloor !)^{\\lfloor n / t \\rfloor \\sum_{r|s}\\mu(r)}(\\prod_{s|t}s^{\\mu(s)})^{\\lfloor n / t \\rfloor ^2}$$\n\n\u6ce8\u610f\u5230 $\\sum_{r|s}\\mu(r)=[s=1]$\uff0c\u6211\u4eec\u628a $t=1$ \u548c $t\\geq 2 $\u7684\u60c5\u51b5\u5206\u5f00\u3002\u8bb0\u6570\u8bba\u51fd\u6570 $g(t)=\\prod_{s|t}s^{\\mu(s)}$\u3002\n\n$$\\sqrt A= (n!)^n\\prod_{t=2}^n (g(t))^{\\lfloor n / t \\rfloor ^2}$$\n\n\u7531\u4e8e\u7528\u5199\u51fa $t$ \u7684\u5206\u89e3\u5f0f\u540e\uff0c\u53ef\u4ee5\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u7b80\u5355\u8bc1\u660e\u5982\u4e0b\u6027\u8d28\uff0c\u56e0\u6b64\u6b64\u5904\u4e0d\u52a0\u8bc1\u660e\u5730\u76f4\u63a5\u7ed9\u51fa\u6b64\u6027\u8d28\uff1a\n\n\uff08\u539f\u8c05\u4e0d\u4f1a\u6253\u5927\u62ec\u53f7\u7684 LaTeX\uff09\n\n\u82e5 $t$ \u53ef\u4ee5\u8868\u793a\u4e3a $p^k$ \uff08$p$ \u4e3a\u8d28\u6570\uff09\u7684\u5f62\u5f0f\uff0c\u5219 $g(t)=\\frac{1}{p}$\uff1b\n\n\u5426\u5219 $g(t)=1$\u3002\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e\u6240\u6709\u80fd\u8868\u793a\u6210 $p^k$ \u7684 $t$ \u5c31\u884c\u4e86\u3002\u7b5b\u5230\u67d0\u4e2a\u8d28\u6570 $p$ \u65f6\uff0c\u76f4\u63a5\u679a\u4e3e $k$ \u5c31\u884c\uff0c\u628a\u5e42\u6b21\u7d2f\u52a0\u5e76\u5bf9 $mod - 1$ \u53d6\u6a21\uff0c\u53ea\u9700\u6c42\u4e00\u6b21\u9006\u5143\u548c\u4e00\u6b21\u5feb\u901f\u5e42\u3002\u8bbe\u4e0d\u5927\u4e8e $n$ \u7684\u8d28\u6570\u4e2a\u6570\u4e3a $\\pi(n)$\uff0c\u5219\u8fd9\u90e8\u5206\u590d\u6742\u5ea6\u4e3a $O(\\pi(n)\\log mod)$\u3002\n\n\u7ebf\u6027\u7b5b\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u4fdd\u5b58\u4e00\u4e2a\u8d28\u6570\u8868\uff0c\u4e00\u4e2a\u8868\u793a\u6bcf\u4e2a\u6570\u662f\u5426\u4e3a\u8d28\u6570\u7684 $\\text{bitset}$\u3002\u7a7a\u95f4\u6d88\u8017\u4e0d\u5230 $\\text{1MB}$\uff0c\u6389\u6389\u6709\u4f59\u3002\n\n\u6700\u7ec8\u4ee5 $O(n+\\pi(n)\\log mod)=O(n+n\\log mod/\\log n)\\approx O(n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u89e3\u51b3\u4e86\u672c\u9898\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u7ebf\u6027\u7684\u3002\u867d\u7136\u63a8\u5bfc\u8fc7\u7a0b\u4e2d\u7528\u5230\u4e86\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u548c\u5176\u53cd\u6f14\uff0c\u4f46\u6700\u7ec8\u7684\u5f0f\u5b50\u975e\u5e38\u7b80\u6d01\u3002\n\ncode\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nconst int mod = 104857601;\ninline int mul(int x, int y){\n\treturn (int)(1ll * x * y % (1ll * mod));\n}\ninline int add(int x, int y){\n\treturn x + y >= mod ? x + y - mod : x + y;\n}\ninline int minus(int x, int y){\n\treturn x < y ? x - y + mod : x - y;\n}\ninline int Qpow(int x, int y){\n\tint r = 1;\n\twhile(y){\n\t\tif(y & 1) r = mul(r, x);\n\t\tx = mul(x, x);\n\t\ty >>= 1;\n\t}\n\treturn r;\n}\nint n, ans = 1;\nint p[100005], cnt = 0;\nstd::bitset <1000005> is;\nvoid solve(){\n\tscanf(\"%d\", &n);\n\tis.set();\n\tis[1] = 0;\n\tfor(int i = 1; i <= n; ++i) ans = mul(ans, i);\n\tans = Qpow(ans, n);\n\tfor(int i = 2; i <= n; ++i){\n\t\tif(is[i] == 1){\n\t\t\tp[++cnt] = i;\n\t\t\tint q = i, t = Qpow(i, mod - 2);\n\t\t\tint s = 0;\n\t\t\twhile(q <= n){\n\t\t\t\ts += 1ll * (n / q) * (n / q) % (mod - 1);\n\t\t\t\ts >= mod - 1 ? s -= (mod - 1) : true; \n\t\t\t\tif(i <= 1000) q *= i;\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tans = mul(ans, Qpow(t, s));\n\t\t}\n\t\tfor(int j = 1; j <= cnt && i * p[j] <= n; ++j){\n\t\t\tis[i * p[j]] = 0;\n\t\t\tif(i % p[j] == 0) break;\n\t\t}\n\t}\n\tprintf(\"%d\\n\", mul(ans, ans));\n\treturn ;\n}\nint main(){\n\tint T = 1;\n\twhile(T--) solve();\n\treturn 0;\n}\n\n```\n\n\u540e\u8bb0\uff1a\u4f5c\u8005\u975e\u5e38\u83dc\uff0c\u5b8c\u5168\u4e0d\u4f1a\u505a\u8fd9\u9053\u7b80\u5355\u9898\uff0c\u4e00\u76f4\u5230 $\\sqrt A$ \u4e4b\u524d\u7684\u90e8\u5206\u90fd\u662f @p31pr \u5b8c\u6210\u7684\u3002",
        "postTime": 1677249965,
        "uid": 131591,
        "name": "\u849f\u84bb\u541bHJT",
        "ccfLevel": 7,
        "title": "P5221 Product \u9898\u89e3"
    },
    {
        "content": "1. $30 \\operatorname{pts}$ \u505a\u6cd5\n\n\u76f4\u63a5\u66b4\u529b\u8ba1\u7b97\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2 \\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n\ntypedef long long ll;\n\nconst int mod = 104857601;\n\nint gcd(int a, int b){\n\treturn b == 0 ? a : gcd(b, a % b);\n}\n\ninline ll lcm(int a, int b){\n\treturn (ll)a * b / gcd(a, b);\n}\n\nint main(){\n\tint n;\n\tll ans = 1;\n\tscanf(\"%d\", &n);\n\tfor (register int i = 1; i <= n; i++){\n\t\tfor (register int j = 1; j <= n; j++){\n\t\t\tans = ans * (lcm(i, j) / gcd(i, j) % mod) % mod;\n\t\t}\n\t}\n\tprintf(\"%lld\", ans);\n\treturn 0;\n}\n```\n2. $100 \\operatorname{pts}$ \u505a\u6cd5\n\n\u524d\u7f6e\u829d\u58eb\uff1a[\u6b27\u62c9\u5b9a\u7406\uff08Euler\uff09](https://www.cnblogs.com/yifusuyi/p/9997009.html)\u3001[\u675c\u6559\u7b5b](https://gypsophila.blog.luogu.org/dls-tql)\n\n\u6211\u4eec\u5148\u6765\u5316\u7b80\u539f\u5f0f\u3002\n\n\u539f\u5f0f $= \\displaystyle\\prod_{i = 1}^N \\prod_{j = 1}^N \\frac{ij}{\\gcd(i, j)^2}$\n\n$ = \\displaystyle\\frac{(N!)^{2N}}{\\displaystyle\\prod_{i = 1}^N \\prod_{j = 1}^N \\gcd(i, j)^2}$\n\n$ = \\displaystyle\\frac{(N!)^{2N}}{\\displaystyle(\\prod_{i = 1}^N \\prod_{j = 1}^N \\gcd(i, j))^2}$\n\n$ = \\displaystyle\\frac{(N!)^{2N}}{\\displaystyle(\\prod_{d = 1}^N d^{\\sum_{i = 1}^{\\lfloor \\frac{N}{d} \\rfloor} \\sum_{j = 1}^{\\lfloor \\frac{N}{d} \\rfloor} [\\gcd(i, j) = 1]})^2}$\n\n$ = \\displaystyle\\frac{(N!)^{2N}}{\\displaystyle(\\prod_{d = 1}^N d^{2 \\sum_{i = 1}^{\\lfloor \\frac{N}{d} \\rfloor} \\varphi(i) - 1})^2}$\n\n\u9884\u5904\u7406\u9636\u4e58\u548c\u6b27\u62c9\u51fd\u6570\u524d\u7f00\u548c\u5373\u53ef\u3002\u7531\u4e8e $\\varphi(104857601) = 104857601 - 1 = 104857600$\uff0c\u6240\u4ee5\u53ea\u8981\u5bf9\u5206\u6bcd\u4e0a\u7684\u6307\u6570\u6a21 $104857600$ \u5373\u53ef\u3002\u7531\u4e8e\u6b64\u9898\u6781\u4e3a\u5361\u7a7a\u95f4\uff0c\u6240\u4ee5\u9884\u5904\u7406\u9636\u4e58\u7684\u6570\u7ec4\u53ea\u80fd\u7528 int\uff0c\u4e14\u9700\u8981\u7528\u675c\u6559\u7b5b\u7b97\u6b27\u62c9\u51fd\u6570\u524d\u7f00\u548c\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <map>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int N = 1e4 + 7, M = 1e6 + 7, mod = 104857601;\nint prime[N], phi[N], sum[N], fac[M]; // \u4e07\u6076\u7684\u7a7a\u95f4\u9650\u5236\u8feb\u4f7f\u6211\u7528 int\nbool p[N];\nmap<ll, ll> mp;\n\ninline ll quick_pow(ll x, ll p, ll mod){\n\tll ans = 1;\n\twhile (p){\n\t\tif (p & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn ans;\n}\n\ninline void init(int n){\n\tint cnt = 0;\n\tp[0] = p[1] = true;\n\tphi[1] = 1;\n\tfor (register int i = 2; i < N; i++){\n\t\tif (!p[i]){\n\t\t\tprime[++cnt] = i;\n\t\t\tphi[i] = i - 1;\n\t\t}\n\t\tfor (register int j = 1; j <= cnt && i * prime[j] < N; j++){\n\t\t\tint t = i * prime[j];\n\t\t\tp[t] = true;\n\t\t\tif (i % prime[j] == 0){\n\t\t\t\tphi[t] = phi[i] * prime[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[t] = phi[i] * (prime[j] - 1);\n\t\t}\n\t}\n\tfor (register int i = 1; i < N; i++){\n\t\tsum[i] = (sum[i - 1] + phi[i]) % (mod - 1);\n\t}\n\tfac[0] = fac[1] = 1;\n\tfor (register int i = 2; i <= n; i++){\n\t\tfac[i] = (ll)fac[i - 1] * i % mod;\n\t}\n}\n\ninline ll get_euler_sum(int n, int mod){\n\tif (n < N) return sum[n];\n\tif (mp.count(n)) return mp[n];\n\tll ans = (ll)n * (n + 1) / 2 % mod;\n\tfor (register int i = 2, j; i <= n; i = j + 1){\n\t\tint tn = n / i;\n\t\tj = n / tn;\n\t\tans = ((ans - get_euler_sum(tn, mod) * (j - i + 1) % mod) % mod + mod) % mod;\n\t}\n\treturn mp[n] = ans;\n}\n\nint main(){\n\tint n;\n\tll ans = 1;\n\tcin >> n;\n\tinit(n);\n\tfor (register int i = 1, j; i <= n; i = j + 1){\n\t\tint tn = n / i;\n\t\tj = n / tn;\n\t\tans = ans * quick_pow(fac[j] * quick_pow(fac[i - 1], mod - 2, mod) % mod, ((get_euler_sum(tn, mod - 1) * 2 - 1) % (mod - 1) + (mod - 1)) % (mod - 1), mod) % mod;\n\t}\n\tcout << quick_pow(fac[n], n * 2, mod) * quick_pow(ans * ans % mod, mod - 2, mod) % mod;\n\treturn 0;\n}\n```",
        "postTime": 1594342494,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u6ce8\u610f\uff0c\u672c\u6587\u7684\u201c/\u201d\u4ee3\u8868\u9664\u6cd5\u5411\u4e0b\u53d6\u6574\u3002\n\n$lcm(i,j)=i\\times j/gcd(i,j)$\n\n$lcm(i,j)/gcd(i,j)=i\\times j / gcd(i,j)^2$\n\n\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa\u6240\u6709$i\\times j$\u7684\u4e58\u79ef\u503c\u3002\n\n$\\prod ^n_{i=1} \\prod ^n_{j=1}i\\times j=n!^{2n}$\n\n\u90a3\u4e48\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u6c42\u51fa\u6240\u6709$gcd(i,j)^2$\u7684\u4e58\u79ef\u503c\uff0c\u7528$n!^{2n}$\u53bb\u9664\u5c31\u884c\u4e86\u3002\n\n\u90a3\u4e48\u600e\u4e48\u6c42\u51fa\u6240\u6709\u7684$gcd(i,j)^2$\u7684\u4e58\u79ef\u5462\uff1f\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u6570$x$\uff0c\u6709$(n/x)\\times (n/x)$\u5bf9$gcd$\u53ef\u4ee5\u6574\u9664$x$\u3002\n\n\u5982\u679c\u6211\u4eec\u8bbe$x$\u4e3a\u8d28\u6570\uff0c\u90a3\u4e48$(n/x^y)\\times (n/x^y)$\u7684\u542b\u4e49\u5c31\u662f\u591a\u5c11\u4e2a$gcd$\u5206\u89e3\u8d28\u56e0\u6570\u540e\u8d28\u56e0\u6570\u4e2d\u7684$x$\u7684\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e$y$\u4e2a\n\n\u90a3\u4e48\u6211\u4eec\u679a\u4e3e$x$\u548c$y$\uff08$x$\u4e3a\u8d28\u6570\uff0c$y \\ge 1$\uff09\uff0c\u90a3\u4e48\u73b0\u5728\u6240\u6709$gcd(i,j)^2$\u7684\u4e58\u79ef\u5c31\u7b49\u4e8e\u6240\u6709\n$$x^{2\\times(n/x^y)\\times (n/x^y)}$$\u7684\u4e58\u79ef\u3002\n\n\u5f53\u7136\u4e86\uff0c$x^y\\le n$\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u53ea\u542b$1$\u4e2a$2$\u7684$gcd$\u5728$x=2,y=1$\u65f6\u6c42\u51fa\u6765\u4e86\uff0c\u540c\u65f6\u4e5f\u628a\u542b$2$\u4e2a$2$,$3$\u4e2a$2$...\u7684$gcd$\u90fd\u63d0\u524d\u4e58\u4e86\u4e00\u4e2a$2$\uff0c\u90a3\u4e48\u5728\u679a\u4e3e\u542b$x=2,y=2$\u65f6\uff0c\u6211\u4eec\u53ea\u7528\u4e58\u4e00\u4e2a$2$\uff0c\u56e0\u4e3a\u4e4b\u524d\u5df2\u7ecf\u4e58\u4e86\u4e00\u4e2a$2$\uff0c\u521a\u597d\u628a\u53ea\u542b$2$\u4e2a$2$\u7684$gcd$\u7ed9\u7b97\u51fa\u6765\u4e86\uff0c\u4f46\u662f\u540c\u65f6\u4e5f\u63d0\u524d\u7ed9\u542b$3$\u4e2a\uff0c$4$\u4e2a..\u4e58\u4e86\u4e2a$2$\u3002\u4ee5\u6b64\u7c7b\u63a8\u3002\u6700\u540e\u4e00\u6b21\u4e00\u5b9a\u4e0d\u4f1a\u591a\u4e58\u3002\n\n\u8fd9\u6837\uff0c\u53ef\u4ee5\u4e0d\u91cd\u590d\u4e0d\u591a\u4e8e\u5730\u6c42\u51fa\u6240\u6709$gcd(i,j)^2$\u7684\u503c\u3002\n\n\u6700\u540e\uff0c\u7531\u4e8e\u6bd4\u8f83\u5927\uff0c\u6211\u4eec\u7528\u9006\u5143\u5c06\u9664\u8f6c\u6362\u6210\u4e58\u6cd5\u3002\n\n\u7b54\u6848\uff1a$(n!^{2n}\\times (\\prod ^n_{i=1} \\prod ^n_{j=1}gcd(i,j)^2)^{mod-2})\\%mod$\n\n\u4ee3\u7801\u5982\u4e0b:\n\n```\n#include <bits/stdc++.h>\nusing namespace std;\n\nlong long n;\nlong long mod=104857601;\nlong long k=1;\nlong long ans=1;\n\nlong long p[1000005];\nlong long f[1000005];\nint m[1000005];\nint num;\n\nlong long fast(long long x,long long v)\n{\n    long long an=1;\n    while(v)\n    {\n        if(v%2)\n            an=(an*x)%mod;\n        x=(x*x)%mod;\n        v/=2;\n    }\n    return an;\n}\n\nvoid Prime()\n{\n    num=1;\n    memset(m,0,sizeof(m));\n    for(int i = 2; i <=n; i++)\n    {\n        if(m[i] == 0)\n            p[num++] = i;\n        for(int j = 1; j < num && p[j] * i <= n; j++)\n        {\n            m[i * p[j]] = 1;\n            if(i % p[j] == 0)\n                break;\n        }\n    }\n    num--;\n}\n\nint main()\n{\n    scanf(\"%lld\",&n);\n    for(int i=1; i<=n; i++)\n        ans=(ans*i)%mod;\n    ans=fast(ans,2*n);\n    Prime();\n    for(int i=1; i<=num; i++)\n    {\n        if(f[i]==0)\n        {\n            f[i]=p[i];\n            if(p[i]*p[i]<=n)\n            {\n                num++;\n                p[num]=p[i]*p[i];\n                f[num]=p[i];\n                while(p[num]*p[i]<=n)\n                {\n                    num++;\n                    p[num]=p[num-1]*p[i];\n                    f[num]=p[i];\n                }\n            }\n        }\n       ans=(ans*fast(fast(f[i],2*(n/p[i])*(n/p[i])),mod-2))%mod;\n    }\n    printf(\"%lld\\n\",ans);\n}\n\n```",
        "postTime": 1550376148,
        "uid": 34663,
        "name": "redegg",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "$$ \\prod_{i=1}^{N} \\prod_{j=1}^{N} \\frac{LCM(i,j)}{(i,j)} $$\n\n$$ \\prod_{i=1}^{N} \\prod_{j=1}^{N} \\frac{ij}{(i,j)^2} $$\n\n\u5148\u679a\u4e3e$gcd$\n\n$$\\frac{\\prod_{i=1}^{N}\\prod_{j=1}^{N}ij}{\\prod_{d=1}^{N}d^{2\\sum_{d|i}\\mu(\\frac{i}{d})\\lfloor \\frac{N}{i} \\rfloor^2}}$$\n\n\u7136\u540e\u6211\u4eec\u679a\u4e3e$i$\n\n$$\\frac{\\prod_{i=1}^{N}\\prod_{j=1}^{N}ij}{\\prod_{i=1}^{N}(\\prod_{d|i}d^{\\mu(\\frac{i}{d})})^{2\\lfloor \\frac{N}{i} \\rfloor^2}}$$\n\n\u53d1\u73b0\n\n$$(\\prod_{d|i}d^{\\mu(\\frac{i}{d})})$$\n\n\u53ef\u4ee5\u5728\u8c03\u548c\u7ea7\u6570\u590d\u6742\u5ea6\u5185\u7528\u679a\u4e3e\u500d\u6570\u7684\u65b9\u5f0f\u6c42\u5f97\n\n\u5904\u7406\u524d\u7f00\u79ef\u540e\u5206\u6bcd\u53ef\u4ee5\u9664\u6cd5\u5206\u5757\n\n\u5206\u5b50\u5176\u5b9e\u662f$(n!)^{2n}$\n\n\u6ce8\u610f\u4e0b\u7a7a\u95f4\u548c\u5e38\u6570\uff0c\u7136\u540e\u8fd9\u4e2a\u95ee\u9898\u5c31$\\Theta(n \\log n)$\u89e3\u51b3\u4e86\n\n```cpp\n#include\"cstdio\"\n#include\"cstring\"\n#include\"iostream\"\n#include\"algorithm\"\nusing namespace std;\n\nconst int MAXN=1e6+5;\nconst int MOD=104857601;\n\nint n,ans=1;\nint p[80005],v[MAXN];\nshort mu[MAXN];\nbool b[MAXN];\n\nint Fpw(int a,int b)\n{\n\tint x=1;\n\twhile(b){\n\t\tif(b&1) x=(long long)x*a%MOD;\n\t\tb>>=1;a=(long long)a*a%MOD;\n\t}return x;\n}\n\nint main()\n{\n\tscanf(\"%d\",&n);\n\tmu[1]=v[0]=v[1]=1;\n\tfor(int i=2;i<=n;++i){\n\t\tv[i]=1;\n\t\tif(!b[i]) p[++p[0]]=i,mu[i]=-1;\n\t\tfor(int j=1;j<=p[0]&&i*p[j]<=n;++j){\n\t\t\tb[i*p[j]]=1;\n\t\t\tif(i%p[j]) mu[i*p[j]]=-mu[i];\n\t\t\telse{mu[i*p[j]]=0;break;}\n\t\t}\n\t}for(int i=2;i<=n;++i){\n\t\tint tmp;\n\t\tif(i<<1<=n) tmp=Fpw(i,MOD-2);\n\t\tfor(int j=i,c=1;j<=n;j+=i,++c){\n\t\t\tif(mu[c]>0) v[j]=(long long)v[j]*i%MOD;\n\t\t\telse if(mu[c]<0) v[j]=(long long)v[j]*tmp%MOD;\n\t\t}v[i]=(long long)v[i]*v[i-1]%MOD;\n\t}for(int l=1,r;l<=n;l=r+1){\n\t\tr=n/(n/l);\n\t\tint tmp=(long long)v[r]*Fpw(v[l-1],MOD-2)%MOD,c=(long long)(n/l)*(n/l)*2%(MOD-1);\n\t\tans=(long long)ans*Fpw(tmp,c)%MOD;\n\t}int base=1;for(int i=2;i<=n;++i) base=(long long)base*i%MOD;\n\tbase=Fpw(base,n);base=(long long)base*base%MOD;\n\tprintf(\"%d\\n\",(long long)base*Fpw(ans,MOD-2)%MOD);\n\treturn 0;\n}\n```",
        "postTime": 1550243233,
        "uid": 31293,
        "name": "Adove",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    },
    {
        "content": "\u770b\u5230gcd\u548cpai\u679c\u65ad\u53cd\u6f14\u3002\uff08\u4ee5\u4e0b\u5206\u6570\u5747\u4e3a\u6574\u9664\uff09\n\n\u5148\u5316\u5f0f\u5b50\uff1a\n```latex\n\\prod_{i=1}^n\\prod_{j=1}^n \\frac{ij}{gcd(i,j)^2}\n```\n\u7531\u4e8e\u662f\u8fde\u4e58\uff0c\u6240\u4ee5\u53ef\u4ee5\u5206\u5f00\u5206\u5b50\u5206\u6bcd\u8003\u8651\n\n\u5148\u770b\u5206\u5b50\uff1a\n\n\n```latex\n\\prod_{i=1}^n\\prod_{j=1}^n ij\n=\\prod_{i=1}^ni^n\\prod_{j=1}^n j\n=\\prod_{i=1}^ni^nn!\n=(n!)^{2n}\n```\n\n\u7b97\u4e2a\u9636\u4e58\u5c31\u5b8c\u4e8b\u4e86\n\n\u518d\u770b\u5206\u6bcd(\u4ee5\u4e0b\u4e3a\u4e86\u65b9\u4fbf\u53ea\u8ba1\u7b97\u5206\u6bcd\u7684\u7b97\u672f\u5e73\u65b9\u6839\uff0c\u6700\u540e\u5e73\u65b9\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86)\uff1a\n```latex\n\\prod_{i=1}^n\\prod_{j=1}^n gcd(i,j)\n```\n\n\u8003\u8651\u679a\u4e3egcd(i,j)\n```latex\n=\\prod_{k=1}^nk^{\\sum_{i=1}^n\\sum_{j=1}^n [gcd(i,j)==k]}\n```\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u5f88\u7b80\u5355\u7684\u53cd\u6f14\u9898\u4e86\uff0c\u6309\u7167\u5957\u8def\n```latex\n=\\prod_{k=1}^nk^{\\sum_{i=1}^\\frac{n}{k}\\sum_{j=1}^\\frac{n}{k}[gcd(i,j)==1]}\n=\\prod_{k=1}^nk^{\\sum_{i=1}^\\frac{n}{k}\\mu(i)\\frac{n}{ki}\\frac{n}{ki}}\n```\n\u6309\u7167\u53cd\u6f14\u7684\u5957\u8def\u5e94\u8be5\u628aki\u62c9\u51fa\u53bb\u5355\u72ec\u679a\u4e3e\u505a\u4e2a\u6574\u9664\u5206\u5757\n\n\u4f46\u8fd9\u9898\u4e0d\u7528\u3002\u8003\u8651\u8bbe\n```latex\nf(x)=\\sum_{i=1}^x\\mu(i)\\frac{x}{i}\\frac{x}{i}\n```\n\u5219\u539f\u5f0f\u4e3a\n```latex\n=\\prod_{k=1}^nk^{f(\\frac{n}{k})}\n```\n\n\u9884\u5904\u7406\u51fa\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u524d\u7f00\u548c\u4e4b\u540e\uff0c\u53ef\u4ee5\u5bf9\u539f\u5f0f\u505a\u4e00\u6b21\u6574\u9664\u5206\u5757\uff0c\u6c42f(x)\u65f6\u505a\u4e00\u6b21\u6574\u9664\u5206\u5757\uff0c\u603b\u590d\u6742\u5ea6O(sqrt(n)*(sqrt(n)+log(n))+n)=O(n)\n\n\u8fd9\u91cc\u6709\u51e0\u4e2a\u7ec6\u8282:\n\n1.\u6309\u7167\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff0c\u6c42f(x)\u7684\u65f6\u5019\u6a21\u6570\u4e0d\u662f104857601\uff0c\u800c\u662f104857600\uff0c\u6bd4\u8d5b\u7684\u65f6\u5019\u88ab\u5751\u6389\u4e8610\u5206\n\n2.\u672c\u9898\u5361\u7a7a\u95f4\uff0c\u6c42\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u53ef\u4ee5\u548c\u5b58\u524d\u7f00\u548c\u5171\u7528\u4e00\u4e2a\u6570\u7ec4\uff0c\u7d20\u6570\u6570\u7ec4\u53ef\u4ee5\u4f30\u8ba1\u4e00\u4e0b\u4e2a\u6570\u6765\u5f00(\u672c\u4eba\u5f00\u4e8680000)\uff0c\u8bb0\u5f55\u662f\u5426\u7d20\u6570\u7528bool/bitset\u8282\u7ea6\u7a7a\u95f4\n```cpp\n#include <stdio.h>\n#include <string.h>\ntypedef long long ll;\nconst int N=1e6+2,p=104857601;\nint ss[80000],mu[N];\nint n,i,j,gs,ans=1,k,l;\nbool ed[N];\ninline int ksm(int x,int y,int p)\n{\n    int r=1;\n    while (y)\n    {\n        if (y&1) r=(ll)r*x%p;\n        x=(ll)x*x%p;\n        y>>=1;\n    }\n    return r;\n}\ninline int gcd(int x,int y)\n{\n    if (x==0) return y;\n    if (y==0) return x;\n    return gcd(y%x,x);\n}\ninline int f(int n)\n{\n    int i,j,k,ans=0;\n    for (i=1;i<=n;i=j+1)\n    {\n        j=n/(k=n/i);\n        ans=(ans+(ll)k*k%(p-1)*(mu[j]-mu[i-1]))%(p-1);\n    }\n    if (ans<0) ans+=p-1;\n    return ans;\n}\nint main()\n{\n    scanf(\"%d\",&n);mu[1]=1;\n    for (i=2;i<=n;i++)\n    {\n        if (!ed[i]) mu[ss[++gs]=i]=-1;\n        for (j=1;(j<=gs)&&(i*ss[j]<=n);j++)\n        {\n            ed[i*ss[j]]=1;\n            if (i%ss[j]==0) break;\n            mu[i*ss[j]]=-mu[i];\n        }\n        mu[i]+=mu[i-1];\n    }\n    for (i=1;i<=n;i=j+1)\n    {\n        l=1;\n        j=n/(n/i);\n        for (k=i;k<=j;k++) l=(ll)l*k%p;\n        ans=(ll)ans*ksm(l,f(n/i),p)%p;\n    }\n    l=1;\n    for (i=1;i<=n;i++) l=(ll)l*i%p;\n    ans=(ll)ksm(l,n<<1,p)*ksm(ans,p-3,p)%p;\n    printf(\"%d\",ans);\n}\n```",
        "postTime": 1550569711,
        "uid": 29826,
        "name": "SSerxhs",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5221 \u3010Product\u3011"
    }
]