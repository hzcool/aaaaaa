[
    {
        "content": "\u8fd9\u662f\u4e00\u7bc7\u70b9\u5206\u6cbb + \u53cc\u6307\u9488\u7684\u9898\u89e3\u3002\n\n### \u8ba1\u7b97\u8def\u5f84\n\n\u8bbe\u70b9\u5206\u6cbb\u4e2d\uff0c**\u5f53\u524d**\u627e\u5230\u7684**\u6839**\u4e3a $rt$\uff0c$w_i$ \u8868\u793a\u4ece $rt$ \u5230 $i$ \u7684**\u70b9\u6743\u548c**\uff0c$d_i$ \u5219\u8868\u793a\u4ece $rt$ \u5230 $i$ \u7684**\u8fb9\u6743\u548c**\u3002\n\n\u5206\u4e24\u79cd\u60c5\u51b5\u8003\u8651\u5408\u6cd5\u6027\uff1a\n\n- \u4ece $i$ \u8d70\u5230 $rt$\uff1a\u663e\u7136\u9700\u8981\u5bf9\u4e8e\u4efb\u610f\u5728 $i$ \u5230 $rt$ \u8def\u5f84\u4e0a\u7684\u8282\u70b9 $j$\uff0c\u6ee1\u8db3 $w_i-w_j \\ge d_i - d_j$\u3002\u7a0d\u52a0\u53d8\u6362\u5f97\uff1a$w_i-d_i-(w_j-d_j)\\ge 0$\u3002\u6b64\u65f6\u53ea\u9700\u8981\u7ef4\u62a4\u3001\u8bb0\u5f55**\u6700\u5927\u7684** $w_j-d_j$ \u5373\u53ef\u5224\u65ad\u4ece $i$ \u5230 $rt$ \u7684\u5408\u6cd5\u6027\u3002\n\n- \u4ece $rt$ \u8d70\u5230 $i$\uff1a\u8fd9\u79cd\u60c5\u51b5\uff0c\u8def\u5f84\u7684\u8d77\u70b9**\u4e0d\u4e00\u5b9a**\u662f $rt$\uff0c\u53ef\u4ee5\u4ece\u5176\u4ed6\u5b50\u6811\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9 $k\\rightarrow rt \\rightarrow i$\u3002\u8bbe $k\\rightarrow rt$ \u540e\u8fd8\u5269\u4e0b\u7684\u6cb9\u91cf\u4e3a $x$\uff08\u76f4\u63a5\u4ece $rt$ \u51fa\u53d1\u90a3\u4e48 $x$ \u4e3a $0$\uff09\uff0c\u5219 $rt\\rightarrow i$ \u8def\u5f84\u4e0a\u4efb\u610f\u4e00\u70b9 $j$\uff0c\u9700\u8981\u6ee1\u8db3 $x+w_{fa_j} \\ge d_j$\u3002\u4f9d\u65e7\u662f\u7a0d\u52a0\u53d8\u6362\uff1a$x+(w_{fa_j}-d_j) \\ge 0$\uff0c\u7ef4\u62a4\u3001\u8bb0\u5f55\u8def\u5f84\u4e0a**\u6700\u5c0f\u7684** $w_{fa_j}-d_j$ \u5373\u53ef\u3002\n\n### \u7edf\u8ba1\u7b54\u6848\n\n\u904d\u5386\u6240\u6709\u5b50\u6811\uff0c\u628a\u6240\u6709\u8def\u5f84\u90fd\u8bb0\u5f55\u4e0b\u6765\u3002\n\n\u4ece $i$ \u5230 $rt$ \u8bb0\u5f55 $w_i-d_i$\uff0c\u8868\u793a\u5230 $rt$ \u540e\u7684\u5269\u4f59\u6cb9\u91cf\u3002\n\n\u4ece $rt$ \u5230 $i$ \u8bb0\u5f55 $w_{fa_j}-d_j$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u5206\u522b\u5c06\u4e24\u79cd\u60c5\u51b5\u6309\u8bb0\u5f55\u7684\u6743\u503c\u6392\u5e8f\uff0c\u7528 $rt\\rightarrow i$ \u5339\u914d $k\\rightarrow i$\uff08\u53cd\u8fc7\u6765\u4e5f\u53ef\u4ee5\uff09\u3002\n\n\u6b64\u65f6\u5bf9\u4e8e\u6240\u6709 $w_k-d_k + w_{fa_j}-d_j \\ge 0$ \u7684 $k$ \u90fd\u53ef\u4ee5\uff0c\u53cc\u6307\u9488\u626b\u63cf\u7edf\u8ba1\u5373\u53ef\u3002\n\n\u6ce8\u610f\u8981\u5c06 $k$ \u548c $i$ \u5728\u540c\u4e00\u5b50\u6811\u5185\u7684\u60c5\u51b5\u63d0\u524d\u51cf\u53bb\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N = 100005;\nint rd(){\n\tint x = 0;char ch = getchar();\n\twhile(ch < '0' || ch > '9')ch = getchar();\n\twhile(ch >= '0' && ch <= '9'){x = x * 10 + ch - '0';ch = getchar();}\n\treturn x;\n}\nll s1[N],s2[N],q1[N],q2[N],w[N],d[N],ans;\nint tot,head[N],ver[2*N],edge[2*N],Next[2*N];\nint n,a[N],rt,sum,s[N],Mas[N],vis[N],t1,t2,h1,h2;\nvoid add(int x,int y,int z){\n\ttot++;\n\tver[tot] = y;\n\tedge[tot] = z;\n\tNext[tot] = head[x];\n\thead[x] = tot;\n}\nvoid Grt(int fa,int x){\n\ts[x] = 1,Mas[x] = 0;\n\tfor(int i = head[x];i;i = Next[i]){\n\t\tint y = ver[i];\n\t\tif(y == fa || vis[y])continue;\n\t\tGrt(x,y);\n\t\ts[x] += s[y];\n\t\tMas[x] = max(Mas[x],s[y]);\n\t}\n\tMas[x] = max(Mas[x],sum - s[x]);\n\tif(!rt || Mas[x] < Mas[rt])rt = x;\n}\nvoid dfs(int fa,int x,ll Max,ll Min){//Max \u6700\u5927 w[j] - d[j]\uff1bMin \u6700\u5c0f w[fa[j]]-d[j]\n\tif(w[x] - d[x] >= Max)//\u5408\u6cd5\u624d\u8bb0\u5f55\n\t\ts1[++t1] = w[x] - d[x];//i\u5230rt\n\ts2[++t2] = Min;//rt\u5230i\uff0c\u76ee\u524d\u4e0d\u80fd\u786e\u5b9a\u662f\u5426\u5408\u6cd5\uff0c\u90fd\u8bb0\u5f55\n\tfor(int i = head[x];i;i = Next[i]){\n\t\tint y = ver[i],z = edge[i];\n\t\tif(y == fa || vis[y])continue;\n\t\td[y] = d[x] + z,w[y] = w[x] + a[y];\n\t\tdfs(x,y,max(Max,w[x] - d[x]),min(Min,w[x] - d[y]));//\u6ce8\u610f\u66f4\u65b0 Max \u548c Min\n\t}\n}\nvoid calc(int x){\n\tint L;\n\th1 = 0,h2 = 0;\n\td[x] = 0,w[x] = a[x];\n\tfor(int i = head[x];i;i = Next[i]){\n\t\tint y = ver[i],z = edge[i];\n\t\tif(vis[y])continue;\n\t\tt1 = 0,t2 = 0;\n\t\td[y] = z,w[y] = w[x] + a[y];//\u521d\u59cb\u5316d[y]\u548cw[y]\n\t\tdfs(x,y,w[x] - d[x],w[x] - d[y]);\n\t\tsort(s1 + 1,s1 + 1 + t1);//s1\u3001s2\u8bb0\u5f55\u5f53\u524d\u5b50\u6811\u5185\u7684\u8def\u5f84\n\t\tsort(s2 + 1,s2 + 1 + t2);\n\t\tL = 1;\n\t\tfor(int i = t2;i >= 1;i--){//\u6ce8\u610f\u5012\u5e8f\u679a\u4e3e\n\t\t\twhile(L <= t1 && s1[L] + s2[i] - a[x] < 0)L++;\n\t\t\tans -= t1 - L + 1;//\u51cf\u53bb\u540c\u4e00\u5b50\u6811\u5185\u7684\u7b54\u6848\n\t\t}\n\t\tfor(int i = 1;i <= t1;i++)\n\t\t\tq1[++h1] = s1[i];\n\t\tfor(int i = 1;i <= t2;i++)\n\t\t\tq2[++h2] = s2[i];//q1\u548cq2\u8bb0\u5f55\u6240\u6709\u8def\u5f84\n\t}\n\tsort(q1 + 1,q1 + 1 + h1);\n\tsort(q2 + 1,q2 + 1 + h2);\n\tL = 1;\n\tfor(int i = h2;i >= 1;i--){\n\t\tif(q2[i] >= 0)//rt\u5230i\u76f4\u63a5\u4ecert\u51fa\u53d1\n\t\t\tans++;\n\t\twhile(L <= h1 && q1[L] + q2[i] - a[x] < 0)L++;//i\u5230rt\uff0crt\u5230i\u90fd\u52a0\u4e86a[x]\uff0c\u51cf\u6389\u4e00\u6b21\n\t\tans += h1 - L + 1;\n\t}\n\tans += h1;//i\u51fa\u53d1\u5230rt\u7ed3\u675f\u7684\u60c5\u51b5\n}\nvoid solve(int x){\n\tvis[x] = 1,calc(x);\n\tfor(int i = head[x];i;i = Next[i]){\n\t\tint y = ver[i],z = edge[i];\n\t\tif(vis[y])continue;\n\t\trt = 0,sum = s[y];\n\t\tGrt(x,y),solve(rt);\n\t}\n}\nint main(){\n\tn = rd();\n\tfor(int i = 1;i <= n;i++)\n\t\ta[i] = rd();\n\tfor(int i = 1;i < n;i++){\n\t\tint x = rd(),y = rd(),z = rd();\n\t\tadd(x,y,z);\n\t\tadd(y,x,z);\n\t}\n\trt = 0,sum = n;\n\tGrt(0,1),solve(rt);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1648120663,
        "uid": 400072,
        "name": "sprads",
        "ccfLevel": 7,
        "title": "P5306 [COCI2019] Transport \u9898\u89e3"
    },
    {
        "content": "## \u95f2\u804a\n\n\u770b\u5230\u6811\u4e0a\u8def\u5f84\u95ee\u9898\u70b9\u5206\u6cbb\u80af\u5b9a\u53ef\u4ee5\u505a\n\n\u770b\u4e86\u4e00\u4e0b\u5176\u4ed6\u9898\u89e3\u597d\u50cf\u6ca1\u6709\u5177\u4f53\u4ecb\u7ecd\u5982\u4f55\u4e0d\u91cd\u4e0d\u6f0f\u5730\u8ba1\u6570\u4ee5\u53ca\u4e00\u4e9b\u7ec6\u8282\uff08~~\u5176\u5b9e\u662f\u6211\u592a\u83dc\u4e86\u6ca1\u770b\u61c2~~\n\n\u849f\u84bb\u6211\u505a\u70b9\u5206\u9898\u8fd8\u6ca1\u6709\u7528\u8fc7\u5bb9\u65a5\u5b9a\u7406\uff0c\u4e00\u822c\u90fd\u662f\u5728\u6bcf\u9897\u5b50\u6811\u91cc\u8dd1\u4e00\u904d\u7684\u65f6\u5019\u76f4\u63a5\u7d2f\u52a0\u524d\u9762\u5df2\u7ecf\u8dd1\u8fc7\u7684\u8d21\u732eQWQ\n\n## \u524d\u7f6e\u829d\u58eb\n- \u70b9\u5206\u6cbb\n- \u5e73\u8861\u6811\uff08\u5176\u5b9e\u53ef\u4ee5\u4e0d\u7528\uff0c~~\u4f46\u56e0\u4e3a\u6211\u4e0d\u592a\u4f1a\u5bb9\u65a5~~\uff0c\u800c\u4e14\u8fd9\u9898\u8fb9\u6743\u6bd4\u8f83\u5927\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u4e0d\u4e86\n\n## \u5927\u4f53\u601d\u8def\n\uff08\u540e\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u7d2f\u8ba1\u7b54\u6848\n- ~~\u9996\u5148\u70b9\u5206\u6cbb~~\n- \u8003\u8651\u5bf9\u5206\u6cbb\u4e2d\u5fc3\u7684\u6bcf\u4e00\u9897\u5b50\u6811\u8dd1\u4e24\u904d\uff0c\uff08\u9274\u4e8e\u65b9\u4fbf\uff0c\u5148\u8bf4\u7b2c\u4e8c\u904d\u7684\u4f5c\u7528\uff09\u7b2c\u4e8c\u904d\u7b97\u4ece\u6bcf\u4e2a\u70b9\u80fd\u5426\u5230\u5206\u6cbb\u4e2d\u5fc3\uff0c\u5982\u679c\u80fd\u5230\u7684\u8bdd\u5230\u4e86\u4ee5\u540e\u8fd8\u5269\u591a\u5c11\u6cb9\u5e76\u63d2\u8fdbTreap\u91cc\uff0c\u7b2c\u4e00\u904d\u8dd1\u7684\u65f6\u5019\u76f4\u63a5\u5408\u5e76\u5206\u6cbb\u4e2d\u5fc3\u5230\u5f53\u524d\u5b50\u6811\u70b9\u7684\u8def\u5f84\u548c \u4e0e \u4e4b\u524dTreap\u91cc\u7684\u8ba1\u7b97\u4e00\u4e0b\u5c31OK\u4e86(\u5177\u4f53\u600e\u4e48\u7ef4\u62a4\u6211\u89c9\u5f97\u697c\u4e0a\u5199\u7684\u7279\u522b\u6e05\u695a\u5c31\u4e0d\u8d58\u8ff0\u4e86)\n- Upd 7.20\uff1a \u7b97\u4e86\u8fd8\u662f\u8bb2\u4e00\u8bb2\u8fd9\u4e2a\u5177\u4f53\u600e\u4e48\u5f80Treap\u91cc\u63d2\u5427\uff08\u987a\u4fbf\u4fee\u4e00\u4e0b\u9519\u522b\u5b57\uff09\u3002\u9996\u5148\u7b2c\u4e00\u904dDFS\uff0c\u8fd9\u4e2a\u70b9\u5230\u5206\u6cbb\u4e2d\u5fc3\u7684\u4efb\u610f\u8fc7\u7a0b\u4e2d\u90fd\u4e0d\u80fd\u51fa\u73b0\u6cb9\u91cf\u4e3a\u8d1f\u6570\u7684\u60c5\u51b5\uff1b\u7b2c\u4e8c\u904dDFS\uff0c\u5206\u6cbb\u4e2d\u5fc3\u5230\u8fd9\u4e2a\u70b9\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u6700\u5c0f\u6cb9\u91cf \u52a0\u4e0a Treap\u91cc\u76ee\u524d\u7684\u6700\u5927\u6cb9\u91cf\u5e94\u8be5\u5927\u4e8e\u7b49\u4e8e0\n- \u81f3\u4e8e\u4e24\u904dDFS\u7684\u987a\u5e8f\u95ee\u9898\u5e94\u8be5\u5f88\u663e\u7136\uff08\u5c31\u662f\u56e0\u4e3a\u8fd9\u6837\u6240\u4ee5\u4e0d\u7528\u5bb9\u65a5\u4e86\n- \u90a3\u4e48\u8fd9\u6837\u7b97\u4e0b\u6765\uff0c\u4f60\u4f1a\u53d1\u73b0\u7b54\u6848\u5c11\u4e86\u5f88\u591a\uff0c\u56e0\u4e3a\u6211\u4eec\u679a\u4e3e\u5230\u7ec8\u70b9\u7684\u8def\u5f84\uff08\u4e5f\u5c31\u662f\u5206\u6cbb\u4e2d\u5fc3\u5230\u67d0\u4e2a\u8282\u70b9\u7684\u8def\u5f84\uff09\u65f6\u53ea\u6709\u524d\u9762\u8dd1\u8fc7\u7684\u5b50\u6811\u4f1a\u5bf9\u5b83\u4ea7\u751f\u8d21\u732e\uff0c\u4f46\u662f\u76ee\u524d\u6ca1\u8dd1\u8fc7\u7684\u5b50\u6811\u4e5f\u4f1a\u5bf9\u5b83\u4ea7\u751f\u8d21\u732e\n- \u89e3\u51b3\u65b9\u6cd5\u662f\u6bcf\u6b21\u5206\u6cbb\u7684\u65f6\u5019\u8bb0\u4e00\u4e0b\u5206\u6cbb\u4e2d\u5fc3\u5373\u5c06\u8bbf\u95ee\u7684\u6bcf\u68f5\u5b50\u6811\uff0c\u5148\u6b63\u7740\u8dd1\u4e00\u904d\uff0c\u518d\u5012\u7740\u8dd1\u4e00\u904d\u5c31\u53ef\u4ee5\u628a\u7b54\u6848\u5168\u7d2f\u52a0\u4e86\n\n## \u5982\u4f55\u7d2f\u52a0\u7b54\u6848\uff08\u91cd\u70b9\u6765\u5566\uff09\n- \u4e0a\u6587\u8bf4\u5230\u4e00\u5171\u8981\u8dd1\u4e24\u904d\uff0c\u8fd9\u5c31\u4f1a\u5f15\u53d1\u4e00\u4e9b\u5947\u5947\u602a\u602a\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u5206\u6cbb\u4e2d\u5fc3\u4e0e\u5b50\u6811\u8282\u70b9\u5f62\u6210\u7684\u70b9\u5bf9\u4f1a\u88ab\u52a0\u4e24\u6b21\uff0c\u4e0b\u9762\u5c31\u6765\u8bf4\u4e00\u8bf4\u6211\u7684\u5904\u7406\u65b9\u6cd5\n- \u8ba1\u7b97\u70b9\u5bf9\uff08\u5206\u6cbb\u4e2d\u5fc3\uff0c\u5b50\u6811\u8282\u70b9\uff09\u7684\u8d21\u732e\uff1a\u6ce8\u610f\u5230\u7d2f\u52a0\u4ee5\u6839\u4e3a\u8d77\u70b9\u4ea7\u751f\u7684\u8d21\u732e\u5176\u5b9e\u5c31\u662f\u628a\u6839(\u5206\u6cbb\u4e2d\u5fc3)\u62e5\u6709\u7684\u6c7d\u6cb9\u91cf\u63d2\u8fdbTreap\u91cc\uff0c\u8fd9\u6837\u6211\u4eec\u5728\u6b63\u7740\u8dd1\u7684\u65f6\u5019\u4e0d\u7ba1\u4ed6\uff0c\u5012\u7740\u8dd1\u4e4b\u524d$Insert\uff08point[\u5206\u6cbb\u4e2d\u5fc3]\uff09$\u5c31\u53ef\u4ee5\u4e86\n- \u8ba1\u7b97\u70b9\u5bf9\uff08\u5b50\u6811\u8282\u70b9\uff0c\u5206\u652f\u4e2d\u5fc3\uff09\u7684\u8d21\u732e\uff1a\u6211\u7684\u5904\u7406\u65b9\u6cd5\u662f\u7528\u4e00\u4e2a\u53d8\u91cfans_1\u6765\u4e34\u65f6\u8bb0\u4e0b\u8d21\u732e,\u7d2f\u52a0\u7ed9\u7b54\u6848\u7684\u65f6\u5019\u9664\u4ee52\u5c31\u597d\u5566\n- \u81f3\u4e8e\u5176\u4ed6\u8d77\u70b9\u548c\u7ec8\u70b9\u90fd\u4e0d\u662f\u5206\u6cbb\u4e2d\u5fc3\u7684\u70b9\u5bf9,\u6211\u4eec\u7684\u505a\u6cd5\u80fd\u5f88\u597d\u7684\u5e94\u5bf9\n\n#### \u8fd9\u9898\u7684\u7ec6\u8282\u5176\u5b9e\u8fd8\u662f\u975e\u5e38\u591a\u7684,\u6709\u4e0d\u61c2\u7684\u5730\u65b9\u53ef\u4ee5\u79c1\u6211QWQ\n\n\u4e0a\u4ee3\u7801\n```\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n\nusing namespace std;\n\nconst int N=100009;\ntypedef long long LL;\nint n,point[N],head[N],cnt,siz[N],del[N],l[N],tmp,pool,root,w[N],tot;\nLL ans,all[N],ans_1;\nstruct Edge\n{\n\tint nxt,to,w;\n}g[2*N];\nstruct Tree\n{\n\tint pri,l,r,cnt,siz;\n\tLL val;\n\t#define p(x) a[x].pri\n\t#define v(x) a[x].val\n\t#define l(x) a[x].l\n\t#define r(x) a[x].r\n\t#define c(x) a[x].cnt\n\t#define s(x) a[x].siz\n}a[N*10];\n\nvoid Zig(int &k)\n{\n\tint x=l(k);\n\tl(k)=r(x);\n\tr(x)=k;\n\ts(x)=s(k);\n\ts(k)=s(l(k))+s(r(k))+c(k);\n\tk=x;\n}\n\nvoid Zag(int &k)\n{\n\tint x=r(k);\n\tr(k)=l(x);\n\tl(x)=k;\n\ts(x)=s(k);\n\ts(k)=s(l(k))+s(r(k))+c(k);\n\tk=x;\n}\n\nvoid Insert(int &k,LL x)\n{\n\tif(!k)\n\t{\n\t\tk=++pool,v(k)=x,c(k)=s(k)=1,p(k)=rand();\n\t\treturn;\n\t}\n\ts(k)++;\n\tif(x==v(k))\n\t\tc(k)++;\n\telse if(x<v(k))\n\t{\n\t\tInsert(l(k),x);\n\t\tif(p(l(k))<p(k))\n\t\t\tZig(k);\n\t}\n\telse\n\t{\n\t\tInsert(r(k),x);\n\t\tif(p(r(k))<p(k))\n\t\t\tZag(k);\n\t}\n}\n\nvoid Delete(int &k,LL x)\n{\n\tif(v(k)==x)\n\t{\n\t\tif(c(k)>1)\n\t\t\tc(k)--,s(k)--;\n\t\telse if(!l(k)||!r(k))\n\t\t\tk=l(k)+r(k);\n\t\telse if(p(l(k))<p(r(k)))\n\t\t\tZig(k),Delete(k,x);\n\t\telse\n\t\t\tZag(k),Delete(k,x);\n\t\treturn;\n\t}\n\ts(k)--;\n\tif(x<v(k))\n\t\tDelete(l(k),x);\n\telse\n\t\tDelete(r(k),x);\n}\n\nint Query(LL x)//\u8ba1\u7b97\u5f53\u524dTreap\u91cc>=x\u7684\u6570\u6709\u591a\u5c11\u4e2a\n{\n\tint k=root,ans=0;\n\twhile(k)\n\t{\n\t\tif(x<v(k))\n\t\t\tans+=c(k)+s(r(k)),k=l(k);\n\t\telse if(x>v(k))\n\t\t\tk=r(k);\n\t\telse\n\t\t\treturn ans+c(k)+s(r(k));\n\t}\n\treturn ans;\n}\n\nvoid add(int from,int to,int w)\n{\n\tg[++cnt].nxt=head[from];\n\tg[cnt].to=to;\n\tg[cnt].w=w;\n\thead[from]=cnt;\n}\n\nvoid init()\n{\n\tscanf(\"%d\",&n);\n\tfor (int i=1;i<=n;i++)\n\t\tscanf(\"%d\",&point[i]);\n\tint x,y,z;\n\tfor (int i=1;i<n;i++)\n\t{\n\t\tscanf(\"%d %d %d\",&x,&y,&z);\n\t\tadd(x,y,z),add(y,x,z);\n\t}\n}\n\nvoid dfs(int x,int fa)//\u8ba1\u7b97\u5b50\u6811\u5927\u5c0f\n{\n\tsiz[x]=1;\n\tfor (int i=head[x];i;i=g[i].nxt)\n\t{\n\t\tint v=g[i].to;\n\t\tif(v==fa||del[v])\n\t\t\tcontinue;\n\t\tdfs(v,x);\n\t\tsiz[x]+=siz[v];\n\t}\n}\n\nint Get_Weight(int x)//\u627e\u91cd\u5fc3\n{\n\tdfs(x,-1);\n\tint k=siz[x]/2,fa=-1;\n\twhile(1)\n\t{\n\t\tint tmp=0;\n\t\tfor (int i=head[x];i;i=g[i].nxt)\n\t\t{\n\t\t\tint v=g[i].to;\n\t\t\tif(del[v]||v==fa)\n\t\t\t\tcontinue;\n\t\t\tif(siz[v]>siz[tmp])\n\t\t\t\ttmp=v;\n\t\t}\n\t\tif(siz[tmp]<=k)\n\t\t\treturn x;\n\t\tfa=x,x=tmp;\n\t}\n}\n\nvoid DFS(int x,int fa,LL Max,LL now)//\u7b2c\u4e00\u904dDFS\n{\n\tans+=Query(Max);\n\tfor (int i=head[x];i;i=g[i].nxt)\n\t{\n\t\tint v=g[i].to;\n\t\tif(v==fa||del[v])\n\t\t\tcontinue;\n\t\tDFS(v,x,max(Max,now-point[x]+g[i].w),now-point[x]+g[i].w);\n\t}\n}\n\nvoid DFS_1(int x,int fa,LL Max,LL now)//\u7b2c\u4e8c\u904dDFS\n{\n\tif(now>=Max)\n\t\tInsert(root,now),all[++tot]=now,ans_1++;\n\tfor (int i=head[x];i;i=g[i].nxt)\n\t{\n\t\tint v=g[i].to;\n\t\tif(v==fa||del[v])\n\t\t\tcontinue;\n\t\tDFS_1(v,x,max(now,Max),now+point[v]-g[i].w);\n\t}\n}\n\nvoid Get_Ans(int x)\n{\n\ttmp=tot=ans_1=0;\n\tfor (int i=head[x];i;i=g[i].nxt)\n\t{\n\t\tint v=g[i].to;\n\t\tif(del[v])\n\t\t\tcontinue;\n\t\tl[++tmp]=v,w[tmp]=g[i].w;\n\t}\n    //\u6b63\u7740\u8dd1\u4e00\u904d\n\tfor (int i=1;i<=tmp;i++)\n\t{\n\t\tDFS(l[i],x,w[i],w[i]);\n\t\tDFS_1(l[i],x,point[x],point[x]+point[l[i]]-w[i]);\n\t}\n\twhile(tot)\n\t\tDelete(root,all[tot--]);//\u6e05\u7a7a\u9632\u6b62\u5bf9\u4ee5\u540e\u4ea7\u751f\u5f71\u54cd\n    //\u5012\u7740\u8dd1\u4e00\u904d\n\tInsert(root,point[x]);//\u5206\u6cbb\u4e2d\u5fc3\u7684\u6cb9\u91cf\u7b2c\u4e8c\u904d\u518d\u52a0\u8fdb\u6765\n\tfor (int i=tmp;i>=1;i--)\n\t{\n\t\tDFS(l[i],x,w[i],w[i]);\n\t\tDFS_1(l[i],x,point[x],point[x]+point[l[i]]-w[i]);\n\t}\n\twhile(tot)\n\t\tDelete(root,all[tot--]);\n\tDelete(root,point[x]);\n\tans+=ans_1/2;//\u70b9\u5bf9\uff08\u5b50\u6811\u8282\u70b9\uff0c\u5206\u6cbb\u4e2d\u5fc3\uff09\u7684\u8d21\u732e\u6700\u540e\u8981\u9664\u4ee5\u4e8c\n}\n\nvoid conquer(int x)\n{\n\tint w=Get_Weight(x);\n\tGet_Ans(w);\n\tdel[w]=1;\n\tfor (int i=head[w];i;i=g[i].nxt)\n\t{\n\t\tint v=g[i].to;\n\t\tif(del[v])\n\t\t\tcontinue;\n\t\tconquer(v);\n\t}\n}\n\nvoid work()\n{\n\tInsert(root,-(1LL<<60)),conquer(1);//\u52a0\u5165\u8d1f\u65e0\u7a77\u5927\u662f\u4e3a\u4e86\u6015Query\u51fa\u9505\n\tprintf(\"%lld\\n\",ans);\n}\n\nint main()\n{\n\tinit();\n\twork();\n\treturn 0;\n}\n```\n",
        "postTime": 1578659583,
        "uid": 31646,
        "name": "\u67f3\u6697\u82b1\u660e",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5306 \u3010[COCI2019] Transport\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\uff1a\n\n\u5728\u4e00\u68f5\u6811\u4e2d\uff0c\u627e\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684\u70b9\u5bf9 $i$\uff0c$j$ \u6570\u91cf\uff0c\u4f7f\u4ece $i$ \u80fd\u8d70\u5230 $j$\uff0c\u5176\u4e2d\u4efb\u610f\u65f6\u523b\uff0c\u6ee1\u8db3\u70b9\u6743\u4e4b\u548c $\\geq$ \u8fb9\u6743\u4e4b\u548c\u3002\n\n## \u7b97\u6cd5\u5206\u6790\uff1a\n\n\u770b\u9898\u76ee\u7684\u63cf\u8ff0\uff0c\u5f88\u660e\u663e\u662f\u4e00\u9053\u70b9\u5206\u6cbb\u7684\u9898\u76ee\u3002\u5173\u952e\u5728\u4e8e\u5982\u4f55\u53bb\u7ef4\u62a4\u7b54\u6848\u3002\n\n\u8fd9\u9053\u9898\u662f\u6211\u4eec\u7684\u6a21\u62df\u8d5b\u9898\uff0c\u8003\u573a\u4e0a\u6253\u4e86\u4e00\u4e2a\u5047\u5230\u4e0d\u80fd\u518d\u5047\u7684\u70b9\u5206\u6cbb\uff0c\u4e00\u5206\u6ca1\u6709\u3002\n\n\u5148\u6765\u6a21\u62df\u4e00\u4e0b\u70b9\u5206\u6cbb\u7684\u8fc7\u7a0b\uff1a\u9996\u5148\u627e\u5230 $root$\uff0c\u5bf9\u4e8e\u6839\u4e3a $root$ \u7684\u8fd9\u68f5\u6811\u8fdb\u884c\u64cd\u4f5c\uff0c\u6700\u540e\u628a $root$ \u5220\u6389\u3002\n\n\u90a3\u4e48\u8fd9\u9053\u9898\uff0c\u5f88\u81ea\u7136\u7684\u96be\u70b9\uff0c\u5c31\u662f\u5982\u4f55\u5bf9\u8fd9\u68f5\u6811\u8fdb\u884c\u64cd\u4f5c\uff0c\u6211\u4eec\u4e00\u6b65\u4e00\u6b65\u770b\u3002\n\n\u9996\u5148\uff0c$i$\u548c $j$ \u8981\u5728 $root$ \u7684\u4e24\u68f5\u4e0d\u540c\u7684\u5b50\u6811\u4e2d\uff0c\u6700\u540e\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\uff0c\u628a $i$ \u548c $j$ \u5728\u4e00\u68f5\u5b50\u6811\u7684\u60c5\u51b5\u7ed9\u5220\u6389\u5c31\u884c\u3002\n\n\u5173\u952e\u64cd\u4f5c\uff1a\u628a $i$ \u5230 $j$ \u7684\u8def\u5f84\uff0c\u5206\u4e3a $i$ \u5230 $root$ \u548c $root$ \u5230 $j$\u3002\u6211\u4eec\u7528\u4e24\u4e2a\u6570\u7ec4 $w_i$\uff0c$d_i$ \u5206\u522b\u8bb0\u5f55\u8fd9\u6761\u8def\u5f84\u7684\u70b9\u6743\u4e4b\u548c\uff0c\u548c\u8fb9\u6743\u4e4b\u548c\u3002\n\n\u7b2c\u4e00\u6b65\uff0c\u4ece $i$ \u5230 $root$ \uff1a\u5bf9\u4e8e\u6ee1\u8db3\u6761\u4ef6\u7684\u8282\u70b9 $k$\uff0c\u9700\u8981 $w[i]-w[k] \\geq d[i]-d[k]$\uff0c\u628a\u8fd9\u4e2a\u5f0f\u5b50\u79fb\u9879\uff0c\u53ef\u4ee5\u5f97\u5230 $(w[i]-d[i])-(w[k]-d[k]) \\geq 0$\u3002\u6240\u4ee5\u6211\u4eec\u8bb0\u5f55\u6700\u5927\u7684 $w[k]-d[k]$ \u5c31\u53ef\u4ee5\u5224\u65ad $i$ \u5230 $root$ \u662f\u5426\u5408\u6cd5\u3002 \n\n\u7b2c\u4e8c\u6b65\uff0c\u4ece $root$ \u5230 $j$\uff1a\u8fd9\u79cd\u60c5\u51b5\uff0c\u8be5\u8def\u5f84\u7684\u8d77\u70b9\u4e0d\u4e00\u5b9a\u662f $root$\uff0c\u53ef\u4ee5\u4ece\u53e6\u4e00\u4e2a\u5b50\u6811\u7684 $u$ \u4e3a\u8d77\u70b9\u3002\u8bbe\u4ee5 $u$ \u4e3a\u8d77\u70b9\u5230 $root$\uff0c\u5269\u4f59\u7684\u6cb9\u91cf\u662f $x$\uff0c\u5219\u8def\u5f84\u4e0a\u7684\u4efb\u610f\u4e00\u70b9 $k$\uff0c\u9700\u8981\u6ee1\u8db3 $x+w[fa[k]] \\geq d[k]$\uff0c$fa[k]$ \u8868\u793a $k$ \u7684\u7236\u4eb2\u3002\u53d8\u6362\u4e00\u4e0b\uff0c\u5f0f\u5b50\u5c31\u53d8\u6210 $x+(w[fa[k]]-d[k]) \\geq 0$\u3002\u8fd9\u65f6\u6211\u4eec\u7ef4\u62a4\u8def\u5f84\u4e0a $w[fa[k]]-d[k]$ \u7684\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n\u5982\u4f55\u7edf\u8ba1\u7b54\u6848\uff1a\n\n\u5148\u904d\u5386\u6240\u6709\u5b50\u6811\uff0c\u4ece $i$ \u5230 $root$ \u8bb0\u5f55 $w[i]-d[i]$ \u8868\u793a\u4ece $i$ \u5230 $root$ \u7684\u5269\u4f59\u6cb9\u91cf\u3002\n\n\u4ece $root$ \u5230 $j$ \u8bb0\u5f55 $w[fa[j]]-d[j]$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u5c06\u4e24\u79cd\u60c5\u51b5\u6309\u5347\u5e8f\u6392\u5e8f\uff0c\u7528\u53cc\u6307\u9488\u6765\u7ef4\u62a4\u7b54\u6848\u7684\u533a\u95f4\u3002\n\n\u7b54\u6848\u533a\u95f4\u4e3a $w[k]-d[k]+w[f[a[j]]-d[j]$ \u7684 $k$ \u90fd\u53ef\u4ee5\u3002\n\n\u6ce8\u610f\uff0c\u50cf\u4e0a\u9762\u6240\u8bf4\uff0c\u8981\u5148\u628a $i$ \u548c $k$ \u5728\u540c\u4e00\u68f5\u5b50\u6811\u4e2d\u7684\u60c5\u51b5\u63d0\u524d\u5220\u6389\u3002\n\n## \u603b\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <algorithm>\n#include <cstring>\n#include <cmath>\n#define re register\n#define int long long\n#define drep(a,b,c) for(re int a(b) ; a>=(c) ; --a)\n#define rep(a,b,c) \tfor(re int a(b) ; a<=(c) ; ++a)\nusing namespace std;\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch == '-') f=-1 ; ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nconst int M = 2e5+10;\nint n;\nint head[M],siz[M],maxp[M],vis[M],a[M];\nint w[M],d[M],tmp1[M],tmp2[M],q1[M],q2[M];\nint root,sum,ans,cnt,cnt1,cnt2; \nstruct edge{\n\tint to,nxt,w;\n}e[M];\ninline void add(int u,int v,int w){ //\u6751\u8fb9 \n\te[++cnt].to = v;\n\te[cnt].w = w;\n\te[cnt].nxt = head[u];\n\thead[u] = cnt;\n}\ninline void getroot(int u,int fa){\n\tsiz[u] = 1;maxp[u] = 0; //maxp\u8bb0\u5f55\u8be5\u8282\u70b9\u7684\u6700\u5927\u7684\u5b50\u6811\u7684size \n\tfor(re int i(head[u]) ; i ; i=e[i].nxt){\n\t\tint v = e[i].to;\n\t\tif(vis[v] || v==fa) continue;\n\t\tgetroot(v,u);\n\t\tsiz[u] += siz[v];\n\t\tmaxp[u] = max(maxp[u],siz[v]); //\u627e\u6700\u5927 \n\t}\n\tmaxp[u] = max(maxp[u],sum-siz[u]); //\u6ce8\u610f\uff0c\u8be5\u8282\u70b9\u5916\u90e8\u4e5f\u53ef\u80fd\u6709\u70b9\uff0c\u8981\u8003\u8651\u5230 \n\tif(maxp[u] < maxp[root]) root = u; //\u66f4\u65b0\u91cd\u5fc3 \n}\ninline void dfs(int u,int fa,int mx,int mi){\n\tif(w[u] - d[u] >= mx) tmp1[++cnt1] = w[u]-d[u]; //\u628a\u7b26\u5408\u8981\u6c42\u7684\u8bb0\u5f55\u4e0b\u6765 \n\ttmp2[++cnt2] = mi; //\u56e0\u4e3a\u4e0d\u786e\u5b9a\u4eceroot\u5230j\u7684\u8def\u5f84\u662f\u4ece\u54ea\u4e00\u4e2a\u70b9\u5f00\u59cb\uff0c\u6240\u4ee5\u4e5f\u90fd\u8981\u8bb0\u5f55\u4e0b\u6765 \n\tfor(re int i(head[u]) ; i ; i=e[i].nxt){\n\t\tint v = e[i].to;\n\t\tif(v==fa || vis[v]) continue;\n\t\td[v] = d[u]+e[i].w; //\u66f4\u65b0\u8fb9\u6743\u4e4b\u548c \n\t\tw[v] = w[u]+a[v];\t//\u66f4\u65b0\u70b9\u6743\u4e4b\u548c \n\t\tdfs(v,u,max(mx,w[u]-d[u]),min(mi,w[u]-d[v])); //\u5f80\u4e0b\u63a5\u7740\u66f4\u65b0 \n\t}\n}\ninline void solve(int u){\n\tint tot1=0,tot2=0;\n\td[u] = 0,w[u] = a[u]; //\u521d\u59cb\u5316 \n\tfor(re int i(head[u]) ; i ; i=e[i].nxt){\n\t\tint v = e[i].to;\n\t\tif(vis[v]) continue;\n\t\tcnt1 = cnt2 = 0;\n\t\td[v] = e[i].w,w[v] = w[u]+a[v]; //\u521d\u59cb\u5316\u4e24\u4e2a\u6570\u7ec4 \n\t\tdfs(v,u,w[u]-d[u],w[u]-d[v]); //\u8fdb\u884cdfs\uff0c\u627etmp1\u548ctmp2\u6765\u66f4\u65b0\u7b54\u6848 \n\t\tsort(tmp1+1,tmp1+cnt1+1); //\u5347\u5e8f \n\t\tsort(tmp2+1,tmp2+cnt2+1); //tmp1\u548ctmp2\u8bb0\u5f55\u7684\u662f\u5f53\u524d\u5b50\u6811\u5185\u7684\u8def\u5f84 \n\t\tint l = 1;\n\t\tfor(re int i(cnt2) ; i>=1 ; --i){ //\u6ce8\u610f\u662f\u53cd\u7740\u679a\u4e3e\uff0c\u76f8\u5f53\u4e8e\u53cc\u6307\u9488\u7ef4\u62a4 \n\t\t\twhile(l<=cnt1 && tmp1[l]+tmp2[i]-a[u]<0) l++; //\u5982\u679c\u6539\u8def\u5f84\u4e0d\u7b26\u5408\u8981\u6c42 \n\t\t\tans -= cnt1-l+1; //\u628a\u5728\u540c\u4e00\u68f5\u5b50\u6811\u5185\u7684\u8d21\u732e\u7ed9\u5220\u6389 \n\t\t}\t\n\t\tfor(re int i(1) ; i<=cnt1 ; ++i) q1[++tot1] = tmp1[i];\n\t\tfor(re int i(1) ; i<=cnt2 ; ++i) q2[++tot2] = tmp2[i]; //q1\u548cq2\u8bb0\u5f55\u7684\u662f\u6240\u6709\u7684\u8def\u5f84 \n\t}\n\tsort(q1+1,q1+tot1+1); //\u540c\u6837\u5347\u5e8f\u6392\u5e8f \n\tsort(q2+1,q2+tot2+1);\n\tint l = 1;\n\tfor(re int i(tot2) ; i>=1 ; --i){ //\u53cc\u6307\u9488\u627e\u7b54\u6848 \n\t\tif(q2[i] >= 0) ans++; //\u76f8\u5f53\u4e8e\u53ef\u4ee5\u76f4\u63a5\u4eceroot\u51fa\u53d1\u5230j\uff0c\u90a3\u4e48\u76f4\u63a5+1\u5373\u53ef \n\t\twhile(l<=tot1 && q1[l]+q2[i]-a[u]<0) l++; //\u4ecei\u5230root\u548c\u4eceroot\u5230j\u52a0\u4e86\u4e24\u6b21a[root]\uff0c\u51cf\u53bb\u5c31\u884c \n\t\tans += tot1-l+1; //\u66f4\u65b0\u7b54\u6848 \n\t}\n\tans += tot1; //\u8fd9\u662f\u52a0\u4e0a\u4ecei\u51fa\u53d1\u76f4\u63a5\u5230root\u7ed3\u675f\u7684\u60c5\u51b5 \n}\ninline void work(int u){\n\tvis[u] = 1; //\u76f8\u5f53\u4e8e\u628a\u8fd9\u4e2a\u70b9\u5220\u4e86 \n\tsolve(u); //\u4ece\u8fd9\u4e2a\u70b9\u5f00\u59cb \n\tfor(re int i(head[u]) ; i ; i=e[i].nxt){\n\t\tint v = e[i].to;\n\t\tif(vis[v]) continue;\n\t\tmaxp[root = 0] = sum = siz[v]; //\u91cd\u65b0\u627e\u91cd\u5fc3 \n\t\tgetroot(v,0);\n\t\tgetroot(root,0); //\u6ce8\u610f\u8fd8\u662f\u4e24\u6b21 \n\t\twork(root); //\u91cd\u590d\u8be5\u8fc7\u7a0b \n\t}\n}\nsigned main(){\n\tn=read();\n\trep(i,1,n) a[i] = read();\n\trep(i,1,n-1){\n\t\tint u=read(),v=read(),w=read();\n\t\tadd(u,v,w),add(v,u,w);\n\t}\n\tmaxp[0] = sum = n; //\u6ce8\u610f\u8981\u5148\u8d4b\u503c \n\tgetroot(1,0);\n\tgetroot(root,0); //\u53ef\u4ee5\u7b97\u662f\u4e00\u4e2a\u7ec6\u8282\u5427\uff0c\u56e0\u4e3a\u5982\u679c\u53ea\u627e\u4e00\u6b21\u6839\uff0c\n\t\t\t\t\t //\u90a3\u4e48\u8bb0\u5f55\u7684siz\u6570\u7ec4\u5f88\u6709\u53ef\u80fd\u4e0d\u662f\u4ee5root\u4e3a\u6839\u7684size \n\twork(root); //\u4eceroot\u5f00\u59cb\u70b9\u5206\u6cbb \n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1660047129,
        "uid": 226367,
        "name": "glorious_dream",
        "ccfLevel": 4,
        "title": "P5306 [COCI2019] Transport \u9898\u89e3"
    },
    {
        "content": "[\u5b89\u5229blog](https://ctz45562.github.io/2019/09/21/%E6%B4%9B%E8%B0%B7-P5306-COCI2019-Transport/)\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problem/P5306)\n\n\u4e0b\u8bb0$root$\u4e3a\u5206\u6cbb\u4e2d\u5fc3\uff0c$dis_i$\u4e3a$i$\u5230$root$\u7684\u8ddd\u79bb\uff0c$sum_i$\u4e3a$i$\u5230$root$\u8def\u5f84\u7684\u70b9\u6743\u548c\uff08\u4e0d\u5305\u62ec$root$\u7684\u70b9\u6743\uff09\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u5206\u6cbb\uff0c\u5148\u628a\u5f53\u524d\u6811\u5185\u70b9\u4f5c\u4e3a\u8d77\u70b9\u5224\u65ad\u662f\u5426\u80fd\u5230\u6839\uff0c\u5e76\u7528\u5e73\u8861\u6811\u5b58\u4e00\u4e0b\u5230\u8fbe\u6839\u540e\u5269\u4f59\u6cb9\u91cf\u3002\n\n\u4f7f\u70b9$i$\u80fd\u5230\u8fbe\u6839\uff0c\u5c31\u8981\u6ee1\u8db3$\\forall j$\u4f4d\u4e8e\u8def\u5f84$i\\rightarrow root$\uff0c$sum_i-dis_i-sum_j+dis_j\\ge 0$\u3002\n\n$dfs$\u65f6\u7ef4\u62a4\u6700\u5c0f\u7684$dis_j-sum_j$\u5224\u65ad\u5373\u53ef\u3002\n\n\u518d$dfs$\u4e00\u904d\u6811\uff0c\u4ee5\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u7ec8\u70b9\uff0c\u5224\u65ad\u662f\u5426\u5b58\u5728\u4e00\u6761\u8def\u5f84\u548c\u81ea\u5df1\u62fc\u8d77\u6765\u5408\u6cd5\u3002\n\n\u540c\u7406\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6700\u5927\u7684$dis_j-sum_{fa_j}$\u5373\u53ef\uff0c\u6ce8\u610f\u662f$fa_j$\u7684$sum$\u3002\u5e73\u8861\u6811\u91cc\u67e5\u4e00\u4e0b\u5927\u4e8e\u7b49\u4e8e\u8be5\u503c\u51cf\u53bb$a_{root}$\u7684\u6570\u4f5c\u4e3a\u8d21\u732e\u3002\u51cf\u53bb$a_{root}$\u662f\u56e0\u4e3a\u8fd9\u4e24\u6b21\u7edf\u8ba1\u65f6\u90fd\u6ca1\u6709\u7b97\u4e0a$root$\u7684\u70b9\u6743\u3002\u8fd8\u8981\u51cf\u53bb\u540c\u4e00\u5b50\u6811\u7684\u70b9\u7684\u8d21\u732e\u3002\n\n\u590d\u6742\u5ea6\u662f$O(n\\log^2 n)$\u7684\u3002\n\n\u4e00\u5f00\u59cb\u60f3\u628a\u5269\u4f59\u6cb9\u91cf\u5b58\u6570\u7ec4\u91cc\u6392\u4e2a\u5e8f`build`\u4e00\u68f5\u5e73\u8861\u6811\u3002\u751a\u81f3\u53ef\u4ee5\u628a\u5e8f\u5217\u53bb\u91cd\uff0c\u4e0d\u6d89\u53ca\u63d2\u5165\u5220\u9664\u76f4\u63a5\u641e\u4e00\u4e2a$BST$\u51fa\u6765\u3002\n\n`build`\u662f$O(n)$\u7684\uff0c\u4e8e\u662f\u603b\u590d\u6742\u5ea6\u5c31\u6210$O(n\\log n)$\u4e86\uff0c\u7136\u540e\u53d1\u73b0\u6392\u5e8f\u8fd8\u662f\u5e26\u4e2a$\\log$.\n\n\u7136\u800c\u6211\u5df2\u7ecf\u5199\u51fa\u6765\u4e86\u6240\u4ee5\u4ee3\u7801\u5982\u6b64\u5197\u957f\u4e11\u964b$QAQ$\uff1a\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n\n#define maxn 100005\n#define inf 0x3f3f3f3f\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\n#define ls(x) ls[x]\n#define rs(x) rs[x]\nstruct edge{\n\tint pre,to,l;\n}e[maxn<<1];\nint a[maxn],h[maxn],siz[maxn],s[maxn],ls[maxn],rs[maxn],c[maxn],cn[maxn],cnt,num,mx,root,all,len,rt;\nbool vis[maxn];\nlong long ans,base[maxn],b[maxn],dat[maxn];\nvoid build(int l,int r,int &node){\n\tif(l>r){node=0;return;}\n\tnode=++cnt;\n\tint mid=l+r>>1;\n\tbuild(l,mid-1,ls(node));\n\tbuild(mid+1,r,rs(node));\n\tdat[node]=b[mid],c[node]=cn[mid];\n\ts[node]=s[ls(node)]+s[rs(node)]+c[node];\n}\nvoid clear(int node){\n\tif(!node)return;\n\tclear(ls(node)),clear(rs(node));\n\tls(node)=rs(node)=0;\n}\nvoid change(long long x,int d){\n\tint node=rt;\n\twhile(node){\n\t\ts[node]+=d;\n\t\tif(dat[node]==x){c[node]+=d;return;}\n\t\tif(dat[node]<x)node=rs(node);\n\t\telse node=ls(node);\n\t}\n}\nint ask(long long d){\n\tint node=rt,ans=0;\n\twhile(node){\n\t\tif(dat[node]>=d)ans+=s[rs(node)]+c[node],node=ls(node);\n\t\telse node=rs(node);\n\t}\n\treturn ans;\n}\ninline void add(int from,int to,int l){\n\te[++num]=(edge){h[from],to,l};\n\th[from]=num;\n}\nvoid getroot(int node,int f=0){\n\tint x,ma=all-siz[node];\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tgetroot(x,node),ma=max(ma,siz[x]);\n\t}\n\tif(ma<mx)mx=ma,root=node;\n}\nvoid Count(int node,long long sum,long long dis,long long mi,int f=0){\n\tsum+=a[node];\n\tmi=min(mi,dis-sum);\n\tfor(register int i=h[node],x;i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x]||x==f)continue;\n\t\tCount(x,sum,dis+e[i].l,mi,node);\n\t\tif(a[x]>=e[i].l&&sum+a[x]-dis-e[i].l+mi>=0)base[++len]=a[x]+sum-dis-e[i].l;\n\t}\n}\nvoid work(int node,int opt,long long sum,long long dis,long long mi,int f=0){\n\tsum+=a[node];\t\n\tmi=min(mi,dis-sum);\n\tfor(register int i=h[node],x;i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x]||x==f)continue;\n\t\twork(x,opt,sum,dis+e[i].l,mi,node);\n\t\tif(a[x]>=e[i].l&&sum+a[x]-dis-e[i].l+mi>=0)change(a[x]+sum-dis-e[i].l,opt);\n\t}\n}\nvoid calc(int node,long long sum,long long dis,long long ma=0,int f=0){\n\tma=max(ma,dis-sum),sum+=a[node],siz[node]=1;\n\tans+=ask(ma-a[root]);\n\tfor(register int i=h[node],x;i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tcalc(x,sum,dis+e[i].l,ma,node);\n\t\tsiz[node]+=siz[x];\n\t}\n}\nint uniq(){\n\tsort(base+1,base+1+len);\n\tint pos,k=0;\n\tfor(register int i=1;i<=len;i=pos){\n\t\tpos=i+1;\n\t\twhile(pos<=len&&base[pos]==base[i])++pos;\n\t\tb[++k]=base[i],cn[k]=pos-i;\n\t}\n\treturn k;\n}\nvoid solve(int node){\n\tint x;\n\tvis[node]=1,base[len=1]=0,cnt=0;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x])continue;\n\t\tCount(x,0,e[i].l,0);\n\t\tif(a[x]>=e[i].l)base[++len]=a[x]-e[i].l;\n\t}\n\tans+=len-1,len=uniq();\n\tbuild(1,len,rt);\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x])continue;\n\t\twork(x,-1,0,e[i].l,0);\n\t\tif(a[x]>=e[i].l)change(a[x]-e[i].l,-1);\n\t\tcalc(x,0,e[i].l,e[i].l);\n\t\twork(x,1,0,e[i].l,0);\n\t\tif(a[x]>=e[i].l)change(a[x]-e[i].l,1);\n\t}\n\tclear(rt);\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x])continue;\n\t\tmx=inf,all=siz[x],getroot(x),solve(root);\n\t}\n}\nvoid dfs(int node=1){\n\tsiz[node]=1;\n\tfor(register int i=h[node],x;i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(siz[x])continue;\n\t\tdfs(x),siz[node]+=siz[x];\n\t}\n}\nint main(){\n\tint n=read();\n\tfor(register int i=1;i<=n;++i)a[i]=read();\n\tfor(register int i=1,x,y,z;i<n;++i)x=read(),y=read(),z=read(),add(x,y,z),add(y,x,z);\n\tdfs(),all=n,mx=inf,getroot(1),solve(root);\n\tprintf(\"%lld\\n\",ans);\n}\n```\n\n",
        "postTime": 1569073909,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5306 \u3010[COCI2019] Transport\u3011"
    },
    {
        "content": "\u70b9\u5206\u6cbb\u3002\n\n\u5173\u4e8e\u6811\u4e0a\u8def\u5f84\u7edf\u8ba1\u95ee\u9898\u9996\u5148\u5c31\u4f1a\u60f3\u5230\u70b9\u5206\u6cbb\u6216\u8005\u8fb9\u5206\u6cbb\u3002\u8fb9\u5206\u592a\u9ebb\u70e6\u4e86\uff0c\u6211\u4eec\u91c7\u7528\u70b9\u5206\u6cbb\u3002\n\n\u6211\u4eec\u8003\u8651\u8ba1\u7b97\u51fa\u5f53\u524d\u70b9\u5206\u6811\u5185\u7684\u6240\u6709\u70b9\u80fd\u5426\u5230\u5206\u6cbb\u4e2d\u5fc3\uff0c\u4ee5\u53ca\u5230\u4e86\u4e2d\u5fc3\u540e\u8fd8\u5269\u4e0b\u591a\u5c11\u6cb9\uff0c\u7136\u540e\u518d\u7b97\u51fa\u4ece\u5206\u6cbb\u4e2d\u5fc3\u5230\u6240\u6709\u70b9\u7684\u8def\u5f84\u524d\u7f00\u6700\u5c0f\u503c\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6392\u5e8f\u540e\u76f4\u63a5\u7528\u53cc\u6307\u9488\u626b\u63cf\u5373\u53ef\u3002\n\n\u8bb0\u5f97\u5bb9\u65a5\u6389\u540c\u4e00\u9897\u5b50\u6811\u5185\u7684\u7b54\u6848\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log^2 n)$ \u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cctype>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cassert>\n#include<queue>\n#include<iostream>\n#include<climits>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mp make_pair\n#define mx(a,b) (a>b?a:b)\n#define mn(a,b) (a<b?a:b)\ntypedef unsigned long long uint64;\ntypedef unsigned int uint32;\ntypedef long long ll;\nusing namespace std;\n\nnamespace IO\n{\n\tconst uint32 Buffsize=1<<15,Output=1<<24;\n\tstatic char Ch[Buffsize],*S=Ch,*T=Ch;\n\tinline char getc()\n\t{\n\t\treturn((S==T)&&(T=(S=Ch)+fread(Ch,1,Buffsize,stdin),S==T)?0:*S++);\n\t}\n\tstatic char Out[Output],*nowps=Out;\n\t\n\tinline void flush(){fwrite(Out,1,nowps-Out,stdout);nowps=Out;}\n\n\ttemplate<typename T>inline void read(T&x)\n\t{\n\t\tx=0;static char ch;T f=1;\n\t\tfor(ch=getc();!isdigit(ch);ch=getc())if(ch=='-')f=-1;\n\t\tfor(;isdigit(ch);ch=getc())x=x*10+(ch^48);\n\t\tx*=f;\n\t}\n\n\ttemplate<typename T>inline void write(T x,char ch='\\n')\n\t{\n\t\tif(!x)*nowps++='0';\n\t\tif(x<0)*nowps++='-',x=-x;\n\t\tstatic uint32 sta[111],tp;\n\t\tfor(tp=0;x;x/=10)sta[++tp]=x%10;\n\t\tfor(;tp;*nowps++=sta[tp--]^48);\n\t\t*nowps++=ch;\n\t\tif(nowps-Out>=1<<23)flush();\n\t}\n}\nusing namespace IO;\n\nvoid file()\n{\n#ifndef ONLINE_JUDGE\n\tFILE*DSD=freopen(\"water.in\",\"r\",stdin);\n\tFILE*CSC=freopen(\"water.out\",\"w\",stdout);\n#endif\n}\n\nconst int MAXN=1e5+7,MAXM=5e5+7;\n\ninline void Chkmin(int&u,int v){u>v?u=v:0;}\n\ninline void Chkmax(int&u,int v){u<v?u=v:0;}\n\ninline void Chkmax(ll&u,ll v){u<v?u=v:0;}\n\ninline void Chkmin(ll&u,ll v){u>v?u=v:0;}\n\nstatic int n,a[MAXN];\n\nstatic struct edge{int v,w,nxt;}p[MAXN<<1];\n\nstatic int head[MAXN],e;\n\ninline void add(int u,int v,int w){p[++e]=(edge){v,w,head[u]},head[u]=e;}\n\ninline void init()\n{\n\tread(n);\n\tRep(i,1,n)read(a[i]);\n\tstatic int u,v,w;\n\tRep(i,1,n-1)read(u),read(v),read(w),add(u,v,w),add(v,u,w);\n}\n\nstatic int sz[MAXN],F[MAXN],rt,al,vis[MAXN];\n\nvoid getrt(int u,int fr)\n{\n\tsz[u]=1,F[u]=0;\n\tfor(int i=head[u];i;i=p[i].nxt)\n\t{\n\t\tint v=p[i].v;\n\t\tif(v^fr&&!vis[v])getrt(v,u),sz[u]+=sz[v],Chkmax(F[u],sz[v]);\n\t}\n\tChkmax(F[u],al-sz[u]);\n\tif(F[u]<F[rt])rt=u;\n}\n\nstatic ll ans;\n\nstatic ll wa[MAXN],wb[MAXN];\n\nstatic int tp1,tp2;\n\nvoid getnd(int u,int fr,ll sm,ll mntl,ll mnhd,int st)\n{\n\tif(mntl==0)wa[++tp1]=sm;\n\twb[++tp2]=-mnhd;\n\tfor(int i=head[u];i;i=p[i].nxt)\n\t{\n\t\tint v=p[i].v;\n\t\tif(v^fr&&!vis[v])\n\t\t\tgetnd(v,u,sm-p[i].w+a[v],min(0ll,mntl-p[i].w+a[v])\n\t\t\t,min(mnhd,sm-a[st]-p[i].w),st);\n\t}\n}\n\nvoid getans(int u)\n{\n\tvis[u]=1;\n\ttp2=0;\n\twa[tp1=1]=a[u];\n\tfor(int i=head[u];i;i=p[i].nxt)\n\t{\n\t\tint v=p[i].v;\n\t\tif(!vis[v])\n\t\t{\n\t\t\tif(sz[v]>sz[u])sz[v]=al-sz[u];\n\t\t\tint cr1=tp1+1,cr2=tp2+1;\n\t\t\tgetnd(v,u,a[u]+a[v]-p[i].w,min(0,a[v]-p[i].w),min(0,-p[i].w),u);\n\t\t\tif(tp1>=cr1&&tp2>=cr2)\n\t\t\t{\n\t\t\t\tsort(wa+cr1,wa+tp1+1),sort(wb+cr2,wb+tp2+1);\n\t\t\t\tint r=cr2;\n\t\t\t\tRep(l,cr1,tp1)\n\t\t\t\t{\n\t\t\t\t\twhile(r<=tp2&&wa[l]>=wb[r])++r;\n\t\t\t\t\tans-=r-cr2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tsort(wa+1,wa+tp1+1),sort(wb+1,wb+tp2+1);\n\tint r=1;\n\tRep(l,1,tp1)\n\t{\n\t\twhile(r<=tp2&&wa[l]>=wb[r])++r;\n\t\tans+=r-1;\n\t}\n\tans+=tp1-1;\n\tfor(int i=head[u];i;i=p[i].nxt)\n\t{\n\t\tint v=p[i].v;\n\t\tif(!vis[v])al=F[rt=0]=sz[v],getrt(v,u),getans(rt);\n\t}\n}\n\ninline void solve()\n{\n\tal=F[0]=n,getrt(1,0),getans(rt);\n\tcout<<ans<<endl;\n}\n\nint main()\n{\n\tfile();\n\tinit();\n\tsolve();\n\tflush();\n\treturn 0;\n}\n```",
        "postTime": 1555503741,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5306 \u3010[COCI2019] Transport\u3011"
    },
    {
        "content": "\u501f\u9274\u81ea @AxDea\u5927\u4f6c \u7684\u601d\u8def\uff0c\u5e0c\u671b\u901a\u8fc7\u8fd9\u7bc7\u9898\u89e3\u53ef\u4ee5\u66f4\u8be6\u7ec6\u7684\u8bc1\u660e\u5e76\u4e14\u9610\u8ff0\u4e00\u4e0b\u601d\u8def\u3002\n\n### \u601d\u8def\n\n\u4e00\u770b\u4e0e\u6811\u4e0a\u8def\u5f84\u95ee\u9898\u6709\u5173\uff0c\u9996\u5148\u5c31\u4f1a\u60f3\u5230**\u70b9\u5206\u6cbb**\uff0c\u8fd9\u91cc\u53ea\u8bb2\u4e00\u4e0b\u7528\u5bb9\u65a5\u600e\u4e48\u505a\uff0c~~\u5e73\u8861\u6811\u7684\u65b9\u6cd5\u6211\u662f\u770b\u4e0d\u61c2~~\u3002\n\n\u65e2\u7136\u8981\u7528\u5230\u70b9\u5206\u6cbb\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a\u628a\u8def\u5f84\u5206\u6210\u4e24\u4efd\u6765\u8ba1\u6570\uff0c\u4f46\u662f\u8fd9\u6b21\u8fd9\u4e24\u4e2a\u8def\u5f84\u7edf\u8ba1\u7684\u4e1c\u897f\u5e94\u8be5\u662f\u4e0d\u4e00\u6837\u7684\u3002\n\n\u6ce8\uff1a\u4ee5\u4e0b\u7684 $rt$ \u90fd\u662f\u5728\u8ba1\u7b97\u7684\u65f6\u5019\u5b50\u6811\u7684\u6839\uff0c\u4e0d\u662f\u6811\u7684\u91cd\u5fc3\uff08~~\u4e0d\u8fc7\u597d\u50cf\u5c31\u662f\u4e00\u4e2a\u4e1c\u897f~~\uff09\u3002\n\n\u6211\u4eec\u8003\u8651\u628a\u8def\u5f84\u5206\u6210 $L_{u\\to\\ rt},R_{rt\\to\\ v}$ \u4e24\u90e8\u5206\uff0c\u7b2c\u4e00\u90e8\u5206\uff0c\u6211\u4eec\u8bb0\u5f55\u4e00\u4e0b\uff0c\u4ece $u\\to rt$ \u6700\u540e\u5269\u4e0b\u7684\u6cb9\u91cf\uff0c\u4f46\u662f\u6211\u4eec\u50a8\u5b58\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u770b\u4e00\u4e0b\u8fd9\u4e2a\u662f\u5426\u662f\u5408\u6cd5\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u662f\u4ece $rt$ \u5f00\u59cb\u8ba1\u6570\u7684\uff0c\u6240\u4ee5\u5c31\u8981\u8003\u8651\u9006\u5e8f\u63a8\uff0c\u662f\u5426\u80fd\u8d70\u5230 $rt$\uff0c\u53ea\u6709\u5408\u6cd5\u7684\u8def\u5f84\u624d\u8bb0\u5f55\u4e0b\u6765\u3002\n\n1\u3001\u5224\u65ad $L_{u\\to rt}$ \u7684\u5408\u6cd5\u6027\u3002\n\n\u8bbe\u7f6e\u4e00\u4e2a $\\text{flag}$\uff0c\u4ece $rt$ \u5f00\u59cb\uff0c\u6bcf\u6b21\u8fdb\u5165\u4ed6\u7684\u513f\u5b50\u7684\u65f6\u5019\uff0c\u5c31\u8bb0\u5f55\u4e00\u4e0b$-w+oil_v$\uff0c\u5f53\u7136\u9700\u8981\u4e0e $0$ \u53bb\u4e00\u4e2a\u6700\u5c0f\u503c\uff0c\u5982\u679c\u662f\u5408\u6cd5\u7684\uff0c\u90a3\u4e48\u4ece $0$ \u5f00\u59cb\u8bb0\u5f55\u5373\u53ef\u3002\n\n\u5982\u679c\u5f53\u524d\u8fdb\u5165\u513f\u5b50\u7684\u5b50\u6811\u65f6 $\\text{flag}=0$\uff0c\u90a3\u4e48\u5c31\u76f4\u63a5\u8bb0\u5f55\u4e00\u4e0b\u4ece $u\\to rt$ \uff08\u5e76\u4e14\u5df2\u7ecf\u5728 $rt$ \u52a0\u6ee1\u6cb9\uff09\u65f6\u7684\u6cb9\u7684\u5269\u4f59\u91cf\u5373\u53ef\uff0c\u53cd\u4e4b\u4e0d\u8bb0\u5f55\u3002\n\n2\u3001\u8bb0\u5f55 $R_{rt\\to v}$ \u4e2d\u7684\u503c\u53ea\u9700\u8981\u8bb0\u5f55\u4ece $rt\\to v$ \u4e2d\uff0c\u6240\u5269\u6cb9\u91cf \uff08\u53ef\u4ee5\u662f\u8d1f\u6570\uff09\u6700\u5c0f\u7684\u90a3\u4e00\u6bb5\u5373\u53ef\uff0c\u5982\u679c\u8fd9\u4e00\u6bb5\u6700\u5c0f\u503c\u90fd\u53ef\u4ee5\u8865\u5145\u4e0a\uff0c\u90a3\u4e48\u4ece $u$ \u8d70\u8fc7\u6765\u7684\u6cb9\u4e00\u5b9a\u662f\u591f\u7684\uff0c\u5224\u65ad\u6761\u4ef6\u4e3a $L_{u\\to rt}\\geq\\ R_{rt\\to v}$ \uff0c\u90a3\u4e48\u8fd9\u4e00\u6761\u8def\u5f84\u5c31\u662f\u5408\u6cd5\u7684\u3002\n\n\u8fd9\u91cc\u8bc1\u660e\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u662f\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\uff1a\n\n\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u6700\u5c0f\u503c\uff0c\u5f53\u7136\u662f\u5728\u53bb $v$ \u7684\u4e00\u6761\u8fb9\u4e0a\uff0c\u5728\u90a3\u91cc\u8865\u5145\u7684\u6cb9\u91cf\u652f\u6491\u4e0d\u4e86\u8fd9\u4e00\u6761\u8fb9\u7684\u8017\u8d39\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a\u70b9\u518d\u8d70\u5230\u4e0b\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\uff0c\u8865\u5145\u7684\u6cb9\u91cf\u53c8\u53ef\u4ee5\u652f\u6491\u8fd9\u4e00\u6761\u8fb9\u7684\u8017\u8d39\uff0c\u6240\u4ee5\u4ece $rt\\to\\ poi$ \u8fd9\u4e2a\u70b9\u7684\u8def\u5f84\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u6700\u5c0f\u503c\uff0c\u65e2\u7136\u8d70\u5230\u4e0b\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\u6cb9\u91cf\u4f1a\u6709\u5269\u4f59\uff0c\u90a3\u4e48\u5e76\u4e0d\u4f1a\u5f71\u54cd\u4e0b\u9762\u7684\u8d70\u52a8\uff0c\u53ea\u9700\u8981\u8003\u8651\u5982\u4f55\u628a\u8fd9\u4e00\u5757\u6cb9\u91cf\u8865\u9f50\u5373\u53ef\uff0c\u6240\u4ee5\u8bf4\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u770b $u\\to rt$ \u6240\u5269\u4e0b\u7684\u6cb9\u91cf\u7684\u591a\u5c11\u4e86\uff0c\u5982\u679c\u591f\uff0c\u90a3\u4e48\u8d70\u8fd9\u6761\u8def\u5f84\u5c31\u4e00\u5b9a\u4f1a\u591f\uff0c\u53cd\u4e4b\u4e0d\u4f1a\u3002\n\n3\u3001\u5bb9\u65a5\u7b54\u6848\n\n\u5728\u8bb0\u5f55 $L,R$ \u7684\u540c\u65f6\uff0c\u8ddf\u968f\u7740\u8fd9\u4e2a\u6570\u503c\u7684\u8fd8\u662f\u8981\u8bb0\u5f55\u4e00\u4e2a\u4e1c\u897f\uff0c\u90a3\u5c31\u662f\u8d77\u70b9\uff0c\u4e5f\u5c31\u662f\u4ece $rt$ \u5f00\u59cb\u8d70\u51fa\u6765\u7684\u7b2c\u4e00\u4e2a\u70b9 $st$ \u8fd9\u4e00\u4e2a\u70b9\n\u8fd9\u4e00\u4e2a\u70b9\u7528\u4e8e\u5bb9\u65a5\u3002\n\n\u5728\u5bb9\u65a5\u7684\u65f6\u5019\uff0c\u5148\u6309\u7167 $L,R$ \u7684\u6743\u503c\u5206\u522b\u5347\u5e8f\u6392\u5e8f\uff0c\u7136\u540e\u53cc\u6307\u9488\u8bb0\u5f55\u5373\u53ef\u3002\n\n\u6700\u540e\u522b\u5fd8\u4e86\u5bb9\u65a5\u6389\u672c\u6765\u5f53\u524d\u7684 $L$ \u8d77\u59cb\u70b9 $st$ \u539f\u672c\u7684\u8d21\u732e\u4e2a\u6570\uff0c\u9632\u6b62\u91cd\u590d\u3002\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<stack>\n#include<queue>\n#include<vector>\n#include<map>\n#define int long long\nusing namespace std;\nconst int N=1e5+9;\nconst int INF=2e9+9;\nstruct node{\n\tint last;\n\tint to;\n\tint dis;\n}e[N<<1];\nint head[N],cnt;\nint oil[N];//\u6cb9\nint n,sum; \nint siz[N],maxp[N],rt;\nbool vis[N];\nint ans,l,r;\nint idl[N],idr[N];\nint Line[N],Rine[N];\nint L[N],R[N];\nint Cen;//\u5f53\u524d\u7684\u91cd\u5fc3\nint st;//\u8d77\u70b9 \nint f[N];//\u8bb0\u5f55 \nint read()\n{\n\tint f=1,x=0;\n\tchar s=getchar();\n\twhile(s<'0'||s>'9'){if(s=='-')f=-1;s=getchar(); }\n\twhile(s>='0'&&s<='9'){x=(x<<1)+(x<<3)+(s^'0');s=getchar(); }\n\treturn f*x;\n}\nvoid add(int from,int to,int dis)\n{\n\te[++cnt].last=head[from];\n\te[cnt].to=to;\n\te[cnt].dis=dis;\n\thead[from]=cnt; \n}\nbool cmpl(int x,int y)\n{\n\treturn L[x]<L[y];\n}\nbool cmpr(int x,int y)\n{\n\treturn R[x]<R[y];\n}\nvoid getdis(int u,int fa,int dis,int weast,int flag)\n//\u5f53\u524d\u70b9\uff0c\u7236\u4eb2\uff0c\u5230\u8fd9\u4e2a\u70b9\u6cb9\u7684\u603b\u5269\u4f59\u91cf\uff0c\u4e24\u4e2a\u70b9\u7684\u8def\u5f84\u4e2d\u82b1\u8d39\u7684\u6700\u5927\u503c\uff0c\u5224\u65ad\u80fd\u5426\u8d70\u5230\t \n{\n\tif(flag==0)\n\t{\n\t\tL[++l]=dis; \n\t\tLine[l]=st;\n\t}\n\tR[++r]=-weast;\n\tRine[r]=st;\n\tfor(int i=head[u];i;i=e[i].last)\n\t{\n\t\tint v=e[i].to;\n\t\tint w=e[i].dis;\n\t\tif(v==fa or vis[v])\n\t\t\tcontinue;\n\t\tgetdis(v,u,dis-w+oil[v],min(weast,dis-oil[Cen]-w),min(0ll,flag-w+oil[v]));\n\t} \n}\nvoid calc(int u)\n{\n\tint j=1;\n\tl=r=0;\n\tCen=u;\n\tL[++l]=oil[u]; Line[l]=u; f[u]=0;\n\tR[++r]=0; Rine[r]=u;\n\tfor(int i=head[u];i;i=e[i].last)\n\t{\n\t\tint v=e[i].to;\n\t\tint w=e[i].dis;\n\t\tif(vis[v]) continue;\n\t\tst=v;\n\t\tf[st]=0;\n\t\tgetdis(v,u,oil[u]+oil[v]-w,-w,min(0ll,oil[v]-w));\n\t}\n\tfor(int i=1;i<=l;i++)\n\t\tidl[i]=i;\n\tfor(int i=1;i<=r;i++)\n\t\tidr[i]=i;\n\tsort(idl+1,idl+1+l,cmpl);\n\tsort(idr+1,idr+1+r,cmpr);\n\tfor(int i=1;i<=l;i++)\n\t{\n\t\twhile(j<=r and L[idl[i]]>=R[idr[j]])\n\t\t{\n\t\t\tf[Rine[idr[j]]]++;\n\t\t\tj++; \n\t\t}\n\t\tans+=(j-1)-f[Line[idl[i]]];//\u5bb9\u65a5\uff0c\u5f53\u524d\u7684j\u4e0d\u7b97\u6570 \n\t}\n}\nvoid root(int u,int fa)\n{\n\tsiz[u]=1;\n\tmaxp[u]=0;\n\tfor(int i=head[u];i;i=e[i].last)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==fa or vis[v]) continue;\n\t\troot(v,u);\n\t\tsiz[u]+=siz[v];\n\t\tmaxp[u]=max(maxp[u],siz[v]);\n\t}\n\tmaxp[u]=max(maxp[u],sum-siz[u]);\n\tif(maxp[u]<maxp[rt])\n\t\trt=u;\n}\nvoid solution(int u)\n{\n\tvis[u]=1;\n\tcalc(u);\n\tfor(int i=head[u];i;i=e[i].last)\n\t{\n\t\tint v=e[i].to;\n\t\tif(vis[v]) continue;\n\t\tsum=siz[v];\n\t\tmaxp[rt=0]=INF;\n\t\troot(v,0);\n\t\tsolution(rt);\n\t}\n}\nsigned main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t\toil[i]=read();\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u=read();\n\t\tint v=read();\n\t\tint w=read();\n\t\tadd(u,v,w);\n\t\tadd(v,u,w);\n\t}\n\tmaxp[rt=0]=sum=n;\n\troot(1,0);\n\tsolution(rt);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n\n\n\n",
        "postTime": 1626920808,
        "uid": 230804,
        "name": "Durancer",
        "ccfLevel": 4,
        "title": "\u3010\u9898\u89e3\u3011P5306 [COCI2019] Transport"
    },
    {
        "content": "**sol of P5306**\n\n\u4e2a\u4eba\u611f\u89c9\u6bd4\u8f83 trick\u3002\u6ca1\u6709\u592a\u5927\u7684\u601d\u7ef4\u96be\u5ea6\u3002\n\n\u4e00\u4e2a\u5957\u8def\u7684\u60f3\u6cd5\u662f\u89c2\u5bdf\u5230\u6c42\u603b\u7684\u5408\u6cd5\u8def\u5f84\u6570\uff0c\u76f4\u63a5\u5c1d\u8bd5\u70b9\u5206\u6cbb\u3002\n\n\u53d1\u73b0\u7ef4\u62a4\u7684\u4e1c\u897f\u53ef\u4ee5\u88ab\u62c6\u4e3a\u81ea\u5e95\u5411\u9876\u7684\u8def\u5f84\u548c\u81ea\u9876\u5411\u5e95\u7684\u8def\u5f84\uff0c\u53d1\u73b0\u8def\u5f84\u672c\u8eab\u5c31\u662f\u4e00\u4e2a $y$ \u503c\u4e0e\u524d\u7f00\u548c\u76f8\u5173\u7684\u5e26\u6298\u70b9\u51fd\u6570\uff0c\u5219\u5bf9\u4e8e\u81ea\u9876\u5411\u5e95\u7684\u8def\u5f84\u76f4\u63a5\u4ece\u4e0a\u5f80\u4e0b\u8dd1\u7ef4\u62a4\u524d\u7f00\u548c\u4e0a\u62d0\u70b9\u7684\u6700\u5c0f\u503c\u3002\n\n\u8003\u8651\u62fc\u63a5\u7684\u6761\u4ef6\uff0c\u9700\u8981\u4e00\u4e2a**\u5408\u6cd5**\u7684\u81ea\u5e95\u5411\u9876\u51fd\u6570\uff0c\u7ef4\u62a4\u51fa\u6765\u6700\u540e\u4e00\u4e2a\u62d0\u70b9\u7684 $y$ \u503c\u540e\u5728\u6bcf\u4e2a\u5b50\u6811\u4e0a\u505a\u4e8c\u7ef4\u6570\u70b9\u5c31\u968f\u4fbf $O(n \\log ^ 2 n)$ \u4e86\u3002\n\n\u5982\u679c\u4f60\u505a\u8fc7\u5f88\u591a\u9898\uff0c\u5f88\u5bb9\u6613\u5c31\u770b\u51fa\u6765\u5bf9\u4e8e\u81ea\u5e95\u5411\u9876\u8def\u5f84\u5bf9\u5e94\u7684\u524d\u7f00\u51fd\u6570\u662f\u9700\u8981\u4ece\u540e\u5f80\u524d\u6784\u9020\u7684\uff08\u8def\u5f84\u662f\u5e95\u5230\u9876\uff0c\u4f46\u5b9e\u9645\u4e0a\u904d\u5386\u7684\u65f6\u5019\u662f\u4ece\u6839\u5f80\u5b50\u6811\u8d70\uff09\uff0c\u9700\u8981\u7684\u4fe1\u606f\u662f\u51fd\u6570\u7684\u9876\u70b9\uff0c\u8fd9\u662f\u4e00\u4e2a\u534a\u7fa4\u4fe1\u606f\uff0c\u6bcf\u6b21\u5f80\u524d\u52a0\u70b9\u65f6\u53ef\u4ee5\u76f4\u63a5 $O(1)$ \u5408\u5e76\u3002\n\n\u5b9e\u73b0\u65f6\u9700\u6ce8\u610f\u8def\u5f84\u7684\u5212\u5206\u3002\u6211\u91c7\u7528\u7684\u662f\u5c06\u6839\u5212\u5206\u8fdb\u81ea\u9876\u5411\u5e95\u7684\u8def\u5f84\u8fd9\u6837\u7684\u5199\u6cd5\uff0c\u5219\u6211\u4eec\u5728\u6c42\u7ecf\u8fc7 $\\text{rt}$ \u7684\u5408\u6cd5\u8def\u5f84\u65f6\uff1a\n\n- \u9700\u8981\u5355\u72ec\u6c42\u548c\u81ea\u9876\u5411\u5e95\u8def\u5f84\u7684\u5408\u6cd5\u4e2a\u6570\uff08\u5305\u542b $\\text{rt}$\uff09\uff1b\n\n- \u7ef4\u62a4**\u5408\u6cd5**\u7684\u81ea\u5e95\u5411\u9876\u8def\u5f84\u51fd\u6570\u65f6\u53ea\u9700\u8981\u5bf9\u8def\u5f84\u6c42\u548c\u4ee5\u53ca\u7ef4\u62a4\u9876\u70b9\u4fe1\u606f\u5373\u53ef\u5224\u65ad\u662f\u5426\u5408\u6cd5\u4ee5\u53ca\u9700\u8981\u7684\u6570\u70b9\uff1b\n\n- \u7ef4\u62a4\u81ea\u9876\u5411\u5e95\u8def\u5f84\u51fd\u6570\u65f6\u7ef4\u62a4\u9876\u70b9\u5373\u53ef\u3002\n\n\u6ce8\u610f\u7684\u662f\u8def\u5f84\u662f\u65e0\u5e8f\u7684\uff0c\u6240\u4ee5\u5728\u679a\u4e3e\u5b50\u6811\u65f6\u5339\u914d\u6709\u4e24\u7c7b\uff1a\u524d\u540e\u5206\u522b\u662f\u5e95\u5411\u9876\u5339\u914d\u9876\u5411\u5e95\uff0c\u9876\u5411\u5e95\u5339\u914d\u5e95\u5411\u9876\u3002\n\n\u5bf9\u4e8e\u6c42\u89e3\u4e8c\u7ef4\u6570\u70b9\u5728\u6b64\u9898\u53ef\u4ee5\u91c7\u53d6\u6392\u5e8f\u52a0\u53cc\u6307\u9488\u6216\u6570\u636e\u7ed3\u6784\u7684\u65b9\u5f0f\u8fdb\u884c\u6c42\u89e3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log ^ 2 n)$\uff0c\u4f7f\u7528\u7684\u7ebf\u6bb5\u6811\u5b9e\u73b0\u3002\n\n```cpp\n/*\n\u8003\u8651\u6dc0\u7c89\u8d28\uff0c\u7531\u4e8e\u662f\u6709\u5e8f\u8def\u5f84\u6240\u4ee5\u8003\u8651\u6bcf\u6b21\u590d\u5408\u4e24\u4e2a\u8def\u5f84\u3002\n\u663e\u7136\u8def\u5f84\u7b49\u4ef7\u4e8e\u6298\u73b0\u51fd\u6570\u4e0a\u6492\u70b9\uff0c\u4fe1\u606f\u53ef\u4ee5\u8f6c\u5316\u6210\u534a\u7fa4\u7684\uff0c\u7ef4\u62a4\u8def\u5f84\u6700\u5c0f\u7684\u9700\u8981\u71c3\u6599\u6570\u5373\u53ef\u3002\n\u7136\u540e\u5c31\u76f4\u63a5\u7edf\u8ba1\u5c31\u505a\u5b8c\u4e86\n\u6211\u4eec\u7ec6\u8282\u4e00\u70b9\uff0c\u60f3\u4e00\u4e0b\u8fd9\u4e2a\u534a\u7fa4\u4fe1\u606f\u600e\u4e48\u5408\u5e76\uff1a\n\u81ea\u5e95\u5411\u4e0a\uff0c\u76f8\u5f53\u4e8e\u4ea7\u751f\u7684\u662f maxv\uff0c\u8fd9\u4e2a\u662f\u53ef\u4ee5\u5e73\u8861\u6811\u542f\u53d1\u5f0f\u5408\u5e76\u7684\uff1f\u5957\u4e2a\u6dc0\u7c89\u8d28\u5c31\u8d77\u98de\u4e86\u554a\uff01\u60f3\u70b9\u5feb\u7684\u3002\n\u597d\u50cf\u6211\u662f\u795e\u7b14\uff0c\u76f4\u63a5\u5bf9\u4e8e\u6574\u6761\u94fe\u6c42\u548c\u5c31\u884c\u4e86\u3002 \n\u81ea\u5e95\u5411\u4e0b\uff0c\u8fd9\u4e2a\u5c31\u76f4\u63a5\u7ef4\u62a4\u521d\u59cb\u4e3a 0 \u65f6\u5411\u4e0b\u4f20\u7684\u4fe1\u606f\u5c31\u884c\u4e86\u3002 \n*/\n#include \"bits/stdc++.h\"\nusing namespace std;\n#define int ll \n#define ll long long\ninline int read() {\n    char ch = getchar();\n    int x = 0, f = 1;\n    while (ch < '0' || ch > '9') {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while ('0' <= ch && ch <= '9') {\n        x = x * 10 + ch - '0';\n        ch = getchar();\n    }\n    return x * f;\n}\ninline void write(ll x) {\n    if (x < 0)\n        putchar('-'), x = -x;\n    if (x > 9)\n        write(x / 10);\n    putchar(x % 10 + '0');\n}\nconst int Len = 1e5 + 5;\nconst ll Inf = 1e14;\nint n,m,w[Len],rt,siz[Len],vis[Len],head[Len],cnt,S,mx[Len];\nll sm[Len],mns[Len][3],tr[Len];\nstruct node\n{\n\tint next,to,w;\n}edge[Len << 1];\ninline void add(int from,int to,int w)\n{\n\tedge[++ cnt].to = to;\n\tedge[cnt].w = w;\n\tedge[cnt].next = head[from];\n\thead[from] = cnt;\n}\nvoid getrt(int x,int f)\n{\n\tmx[x] = 0 , siz[x] = 1;\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tint to = edge[e].to;\n\t\tif(to == f || vis[to]) continue;\n\t\tgetrt(to , x);\n\t\tsiz[x] += siz[to];\n\t\tif(siz[to] > mx[x]) mx[x] = siz[to];\n\t}\n\tif(S - siz[x] > mx[x]) mx[x] = S - siz[x];\n\tif(mx[x] < mx[rt]) rt = x;\n}\nvoid resiz(int x,int f)\n{\n\tsiz[x] = 1;\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tint to = edge[e].to;\n\t\tif(to == f || vis[to]) continue;\n\t\tresiz(to , x);\n\t\tsiz[x] += siz[to]; \n\t}\n}\nll q[Len][2];int len[2];ll as,ss;\nstruct info\n{\n\t#define ls(x) ch[x][0]\n\t#define rs(x) ch[x][1]\n\tint rt,ct,ch[Len * 50][2],sum[Len * 50];\n\tinline void clr(){rt = 0;for(int i = 1 ; i <= ct ; i ++) ch[i][0] = ch[i][1] = sum[i] = 0;ct = 0;}\n\tinline void push_up(int p){sum[p] = 0;if(ls(p)) sum[p] += sum[ls(p)];if(rs(p)) sum[p] += sum[rs(p)];}\n\tvoid update(int &p,ll l,ll r,ll idx)\n\t{\n\t\tif(!p) p = ++ ct;\n\t\tif(l == r) \n\t\t{\n\t\t\tsum[p] ++;\n\t\t\treturn;\n\t\t}\n\t\tll mid = (l + r) >> 1;\n\t\tif(idx <= mid) update(ls(p) , l , mid , idx);\n\t\telse update(rs(p) , mid + 1 , r , idx);\n\t\tpush_up(p); \n\t}\n\tll query(int &p,ll l,ll r,ll nl,ll nr)\n\t{\n\t\tif(!p) return 0;\n\t\tif(nl <= l && nr >= r) return sum[p];\n\t\tll mid = (l + r) >> 1;ll res = 0;\n\t\tif(nl <= mid) res += query(ls(p) , l , mid , nl , nr);\n\t\tif(nr > mid) res += query(rs(p) , mid + 1 , r , nl , nr);\n\t\treturn res; \n\t}\n\tinline void upd(ll idx){update(rt , -Inf , Inf , idx);return;}\n\tinline ll Q(ll nl,ll nr){return query(rt , -Inf , Inf , nl , nr);}\n}T1,T2;\nvoid getdis(int x,int f)\n{\n\tas += T1.Q(-mns[x][1] , Inf);\n\tif(mns[x][0] >= 0 && sm[x] - w[rt] >= 0) as += T2.Q(-Inf , sm[x] - w[rt]); \n\tas += (mns[x][1] >= 0);\n\tas += (mns[x][2] >= 0);\n\t//printf(\"!!!%d %lld %lld\\n\",x,mns[x][1],mns[x][2]);\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tint to = edge[e].to;\n\t\tif(to == f || vis[to]) continue;\n\t\tsm[to] = sm[x] - edge[e].w + w[to];\n\t\tmns[to][0] = min(mns[x][0] + (w[to] - edge[e].w) , 1ll * (w[to] - edge[e].w));\n\t\tmns[to][1] = min(mns[x][1] , sm[x] + - edge[e].w);\n\t\tmns[to][2] = min(mns[x][2] + (w[to] - edge[e].w) , 1ll * (w[to] - edge[e].w));\n\t\tif(mns[to][0] >= 0) q[++ len[0]][0] = sm[to] - w[rt];\n\t\tq[++ len[1]][1] = mns[to][1];\n\t\tgetdis(to , x);\n\t}\n}\nvoid calc(int x)\n{\n\tT1.clr();T2.clr();ss = as;\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tlen[0] = len[1] = 0;\n\t\tint to = edge[e].to;if(vis[to]) continue;\n\t\tsm[to] = w[x] + w[to] - edge[e].w;\n\t\tmns[to][0] = (w[to] - edge[e].w);\n\t\tmns[to][1] = w[x] - edge[e].w;\n\t\tmns[to][2] = w[to] - edge[e].w;\n\t\tif(mns[to][0] >= 0) q[++ len[0]][0] = sm[to] - w[rt];\n\t\tq[++ len[1]][1] = mns[to][1];\n\t\tgetdis(to , x);\n\t\tfor(int j = 1 ; j <= len[0] ; j ++) if(q[j][0] >= 0) \n\t\t{\n\t\t\t//printf(\"####%lld\\n\",q[j]);\n\t\t\tT1.upd(q[j][0]);\n\t\t}\n\t\tfor(int j = 1 ; j <= len[1] ; j ++) T2.upd(-q[j][1]);\n\t}\n\t//printf(\"%d %lld\\n\",x,as - ss);\n}\nvoid solve(int x)\n{\n\tvis[x] = 1;calc(x);\n\tfor(int e = head[x] ; e ; e = edge[e].next)\n\t{\n\t\tint to = edge[e].to;\n\t\tif(vis[to]) continue;\n\t\tresiz(to , x);\n\t\tS = siz[to] , mx[rt = 0] = n + 1;\n\t\tgetrt(to , 0) , resiz(rt , 0) , solve(rt);\n\t}\n}\nsigned main()\n{\n\tn = read();\n\tfor(int i = 1 ; i <= n ; i ++) w[i] = read();\n\tfor(int i = 1 ; i < n ; i ++)\n\t{\n\t\tint x,y,w;x = read() , y = read() , w = read();\n\t\tadd(x , y , w) , add(y , x , w); \n\t}\n\tS = n , mx[rt = 0] = n + 1; \n\tgetrt(1 , 0);resiz(rt , 0);\n\tsolve(rt);\n\tprintf(\"%lld\\n\",as);\n\treturn 0;\n}\n```",
        "postTime": 1672473975,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u8863\u886b\u5c3d\u6e7f \u4e00\u540c\u62d4\u9664 \u547d\u8fd0\u7ea0\u7f20 \u524d\u4e16\u56de\u6eaf"
    },
    {
        "content": "\u9996\u5148\u505a\u4e00\u6b65\u8f6c\u5316\uff1a\u539f\u9898\u7684\u9650\u5236\u76f8\u5f53\u4e8e\u8d70\u8fc7\u4e00\u6761\u8fb9\u71c3\u6599\u91cf\u5c31\u4f1a\u51cf\u53bb\u8fb9\u6743\uff0c\u6c42\u51fa\u4efb\u610f\u65f6\u523b\u71c3\u6599\u91cf\u5747\u4e0d\u5c0f\u4e8e\u96f6\u7684\u65b9\u6848\u6570\u3002\n\n\u7528\u6570\u5b66\u8bed\u8a00\u53bb\u523b\u753b\u5b83\uff1a\u8bbe\u4e00\u6761\u8def\u5f84\u4f9d\u6b21\u7ecf\u8fc7\u70b9 $u_1,u_2,\\cdots,u_k$\uff0c\u90a3\u4e48\u5c31\u6709\n\n$$\n\\min_{i=1}^{k-1}\\sum_{j=1}^ia_{u_j}-w(u_j,u_{j+1})\\ge 0\n$$\n\n\u8003\u8651\u70b9\u5206\u6cbb\u3002\u8bbe\u5f53\u524d\u5206\u6cbb\u4e2d\u5fc3\u4e3a $k$\uff0c\u9700\u8981\u6c42\u51fa\u7ecf\u8fc7 $k$ \u7684\u5408\u6cd5\u8def\u5f84\u6570\u91cf\u3002\u5bf9\u4e8e\u4e00\u6761\u8def\u5f84 $(u,v)$\uff0c\u6211\u4eec\u628a\u5b83\u62c6\u5206\u6210\u4e24\u4e2a\u90e8\u5206\uff1a$(u,l)$ \u7684\u90e8\u5206\u548c $(l,v)$ \u7684\u90e8\u5206\u3002\n\n- \u5bf9\u4e8e $(u,l)$ \u7684\u90e8\u5206\uff1a\n\n\u8bbe $val_i$ \u4e3a $a_i-w(i,fa_i)$\uff0c\u90a3\u4e48\u70b9 $u$ \u80fd\u591f\u5230\u8fbe\u5206\u6cbb\u4e2d\u5fc3 $l$ \u5f53\u4e14\u4ec5\u5f53\u4efb\u610f\u65f6\u523b $val$ \u4e4b\u548c\u5927\u4e8e\u7b49\u4e8e\u96f6\u3002\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u5229\u7528\u52a8\u6001\u89c4\u5212\u6765\u6c42\uff1a\u8bbe $f_i$ \u4e3a\u4ece $i$ \u5230 $l$ \u7684\u8def\u5f84\u4e0a $val$ \u503c\u4e4b\u548c\u7684\u6700\u5c0f\u503c\uff0c\u5c31\u6709\n\n$$\nf_i=\\min(f_{fa_i}+val_i,val_i)\n$$\n\n\u6c42\u51fa $f_i$ \u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u987a\u4fbf\u6c42\u51fa\u4ece $i$ \u5230 $l$ \u65f6\u5019\u7684\u5269\u4f59\u71c3\u6599\u91cf\uff0c\u8bbe\u5b83\u4e3a $dis_i$\u3002\n\n$$\ndis_i=dis_{fa_i}+val_i\n$$\n\n- \u5bf9\u4e8e $(l,v)$ \u7684\u90e8\u5206\uff1a\n\n\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u548c\u4e0a\u4e00\u90e8\u5206\u7efc\u5408\u8003\u8651\u4e86\u3002\u8bbe $g_i$ \u4e3a\u5bf9\u4e8e $l$ \u5230 $i$ \u7684\u8def\u5f84\uff0c\u4ece $l$ \u51fa\u53d1\u65f6\u81f3\u5c11\u9700\u8981\u7684\u71c3\u6599\u91cf\uff0c\u5219\u6709\n\n$$\ng_i=\\max(g_{fa_i},dis_i-a_i+a_l)\n$$\n\n\u5c06 $dis$ \u79bb\u6563\u5316\u540e\uff0c\u5229\u7528\u6811\u72b6\u6570\u7ec4\u53ef\u4ee5\u65b9\u4fbf\u7684\u6c42\u51fa\u6709\u591a\u5c11\u4e2a\u70b9\u7684 $dis$ \u503c\u5927\u4e8e\u7b49\u4e8e $g_i$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define For(i,a,b) for(int i=(a);i<=(b);++i)\n#define Rof(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\nconst int Maxn=2e5;\n\ninline int read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0' || ch>'9')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9')\n    {\n        x=x*10+ch-'0';\n        ch=getchar();\n    }\n    return x*f;\n}\n\nstruct Node{int frm,to,nxt,w;} Edge[Maxn*2+5];\nint tot,Head[Maxn+5];\ninline void Addedge(int x,int y,int z)\n{\n    Edge[++tot]=(Node){x,y,Head[x],z};\n    Head[x]=tot;\n}\nint n,s,val[Maxn+5],siz[Maxn+5],maxs[Maxn+5];\nint rt,sum,vis[Maxn+5],t[Maxn+5];\nll num[Maxn+5],f[Maxn+5],g[Maxn+5],dis[Maxn+5],dep[Maxn+5],ans;\nvector<ll> v;\n#define lowbit(x) (x&-x)\n\ninline void Add(int x,int y) {while(x<=s) t[x]+=y,x+=lowbit(x);}\ninline int Count(int x) {int res=0; while(x){res+=t[x],x-=lowbit(x);} return res;}\ninline void GetRt(int x,int f)\n{\n    siz[x]=1,maxs[x]=0;\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(y==f || vis[y]) continue;\n        GetRt(y,x),siz[x]+=siz[y];\n        maxs[x]=max(maxs[x],siz[y]);\n    }\n    maxs[x]=max(maxs[x],sum-siz[x]);\n    rt=(maxs[x]<maxs[rt]?x:rt);\n}\ninline void dfs1(int x,int fa)\n{\n    dis[x]=dis[fa]+num[x];\n    f[x]=min(f[fa]+num[x],num[x]);\n    if(f[x]>=0) v.push_back(dis[x]),ans++;\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(y==fa || vis[y]) continue;\n        num[y]=val[y]-Edge[i].w,dfs1(y,x);\n    }\n}\ninline void dfs2(int x,int fa,int opt)\n{\n    if(f[x]>=0)\n    {\n        if(!opt)\n        {\n            dis[x]=lower_bound(v.begin(),v.end(),dis[x])-v.begin()+1;\n            Add(dis[x],1);\n        }\n        else Add(dis[x],opt);\n    }\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(y==fa || vis[y]) continue;\n        dfs2(y,x,opt);\n    }\n}\ninline void dfs3(int x,int fa)\n{\n    if(g[x]<=0ll) ans++;\n    int id=lower_bound(v.begin(),v.end(),g[x])-v.begin()+1;\n    if(id<=s) ans+=(Count(s)-Count(id-1));\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(y==fa || vis[y]) continue;\n        dep[y]=dep[x]+val[x]-Edge[i].w;\n        g[y]=max(g[x],-dep[y]);\n        dfs3(y,x);\n    }\n}\ninline void Discrete()\n{\n    sort(v.begin(),v.end());\n    v.erase(unique(v.begin(),v.end()),v.end());\n    s=v.size();\n}\ninline void Solve(int x)\n{\n    f[x]=0,dis[x]=0,v.clear();\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(vis[y]) continue;\n        num[y]=val[y]-Edge[i].w,dfs1(y,x);\n    }\n    Discrete();\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(vis[y]) continue;\n        dfs2(y,x,0);\n    }\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(vis[y]) continue;\n        g[y]=max(0ll,1ll*Edge[i].w-val[x]);\n        dep[y]=val[x]-Edge[i].w;\n        dfs2(y,x,-1),dfs3(y,x),dfs2(y,x,1);\n    }\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(vis[y]) continue;\n        dfs2(y,x,-1);\n    }\n}\ninline void dfs(int x)\n{\n    vis[x]=1; Solve(x);\n    for(int i=Head[x];i;i=Edge[i].nxt)\n    {\n        int y=Edge[i].to;\n        if(vis[y]) continue;\n        rt=0,sum=siz[y],GetRt(y,0),GetRt(rt,0),dfs(rt);\n    }\n}\n\nint main()\n{\n    n=read(),maxs[0]=n+5;\n    For(i,1,n) val[i]=read();\n    For(i,1,n-1)\n    {\n        int a=read(),b=read(),c=read();\n        Addedge(a,b,c),Addedge(b,a,c);\n    }\n    rt=0,sum=n,GetRt(1,0),GetRt(rt,0),dfs(rt);\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1666317410,
        "uid": 148913,
        "name": "Graphcity",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5306\u3010[COCI2018-2019#5] Transport\u3011"
    },
    {
        "content": "\u6811\u4e0a\u70b9\u5bf9\u95ee\u9898\u8003\u8651\u70b9\u5206\u6cbb\u3002\n\n\u6309\u7167\u5957\u8def\u8ba8\u8bba\u7ecf\u8fc7\u4e00\u4e2a\u70b9 $p$ \u7684\u8def\u5f84\u7684\u60c5\u51b5\u3002\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\u7684\u6bcf\u4e00\u4e2a\u70b9\u5bf9 $(u,v)$ \u7684\u8def\u5f84\u53ef\u4ee5\u5206\u4e3a $u\\rightarrow p$ \u548c $p\\rightarrow v$ \u4e24\u6bb5\u3002\n\n\u5bf9\u4e8e\u524d\u8005\uff0c\u9700\u8981\u77e5\u9053\u8d70\u5b8c\u8fd9\u6761\u8def\u5f84\u540e\u5269\u4f59\u7684\u6cb9\u91cf\uff0c\u8bb0\u4f5c $L_{u\\rightarrow p}$ \uff0c\n\n\u5bf9\u4e8e\u540e\u8005\uff0c\u9700\u8981\u77e5\u9053\u5728\u5141\u8bb8\u6cb9\u91cf\u5c0f\u4e8e 0 \u65f6\uff0c\u8d70\u8fd9\u6761\u8def\u5f84\u65f6\u6cb9\u91cf\u7684\u6700\u5c0f\u503c\uff0c\u8bb0\u4f5c $R_{p\\rightarrow v}$ \u3002\n\n\u8fd9\u6837\u53ea\u8981\u6ee1\u8db3 $L_{u\\rightarrow p}\\geq R_{p\\rightarrow v}$ \u65f6\uff0c\u70b9\u5bf9 $(u,v)$ \u6210\u7acb\u3002\n\n\u5904\u7406\u51fa $L$ \u548c $R$ \u540e\uff0c\u5c06\u4e24\u8005\u66b4\u529b\u6392\u5e8f\uff0c\u4e4b\u540e\u7528\u53cc\u6307\u9488\u626b\u4e00\u904d\u5c31\u884c\u4e86\uff0c\u4e0d\u8981\u5fd8\u4e86\u7528\u5bb9\u65a5\u6216\u8005\u67d3\u8272\u6cd5\u907f\u514d\u91cd\u590d\u8ba1\u6570\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log_2^2 n)$\n\nCode(C++):\n\n```cpp\n#include<bits/stdc++.h>\n#define forn(i,s,t) for(register int i=(s);i<=(t);++i)\nusing namespace std;\ntypedef long long LL;\nconst int N = 1e5+1e3;\ntemplate<typename T>inline T Max(T A, T B) {return A>B?A:B;}\ntemplate<typename T>inline T Min(T A, T B) {return A<B?A:B;}\nstruct List {int dir, nxt; LL lng; } E[N<<1];\nint G[N], cnt;\ninline void Add(int u, int v, LL w) {\n\tE[++cnt].dir = v, E[cnt].nxt = G[u], G[u] = cnt;\n\tE[cnt].lng = w;\n}\nint n; LL a[N], Ans;\nbool vis[N];\nint Mx[N], sz[N], rt, S;\nvoid Getrt(int u, int fa) { // \u627e\u91cd\u5fc3 \n\tsz[u] = 1, Mx[u] = 0;\n\tfor(int i=G[u];i;i=E[i].nxt) {\n\t\tint v = E[i].dir;\n\t\tif(vis[v] || v == fa) continue ;\n\t\tGetrt(v, u);\n\t\tsz[u] += sz[v];\n\t\tMx[u] = Max(Mx[u], sz[v]);\n\t}\n\tMx[u] = Max(Mx[u], S - sz[u]);\n\t(Mx[u] < Mx[rt]) && (rt = u);\n}\nLL L[N], R[N];\nint f[N], l, r, Cl[N], Cr[N], now, Nu, idl[N], idr[N];\ninline bool cmpl(int A, int B) {return L[A] < L[B];}\ninline bool cmpr(int A, int B) {return R[A] < R[B];}\nvoid dfs(int u, int fa, LL dist, LL Dn, LL Up) {\n\tif(Up == 0) L[++l] = dist, Cl[l] = now;\n\tR[++r] = -Dn, Cr[r] = now;\n\tfor(int i=G[u];i;i=E[i].nxt) {\n\t\tint v = E[i].dir; LL w = E[i].lng;\n\t\tif(vis[v] || v == fa) continue ;\n\t\tdfs(v, u, dist - w + a[v], Min(Dn, dist - a[Nu] - w), Min(0ll, Up - w + a[v]));\n\t}\n}\nvoid calc(int u) {\n\tl = r = 0, Nu = u;\n\tL[++l] = a[u], Cl[l] = u, f[u] = 0;\n\tR[++r] = 0, Cr[r] = u;\n\tfor(int i=G[u];i;i=E[i].nxt) {\n\t\tint v = E[i].dir; LL w = E[i].lng;\n\t\tif(vis[v]) continue ;\n\t\tnow = v; f[now] = 0;\n\t\tdfs(v, u, a[u] + a[v] - w, -w, Min(0ll, - w + a[v]));\n\t}\n\tforn(i,1,l) idl[i] = i; sort(idl+1, idl+l+1, cmpl);\n\tforn(i,1,r) idr[i] = i; sort(idr+1, idr+r+1, cmpr);\n\tint j = 1;\n\tforn(i,1,l) {\t// 2 Pnt \n\t\twhile(j <= r && R[idr[j]] <= L[idl[i]]) f[Cr[idr[j++]]] ++ ;\n\t\tAns += j - 1 - f[Cl[idl[i]]];\n\t}\n}\nvoid solve(int u) {\n\tvis[u] = 1;\n\tcalc(u);\n\tfor(int i=G[u];i;i=E[i].nxt) {\n\t\tint v = E[i].dir;\n\t\tif(vis[v]) continue ;\n\t\tS = sz[v] > sz[u] ? n - sz[u] : sz[v];\n\t\trt = 0, Getrt(v, v);\n\t\tsolve(rt);\n\t}\n}\nint main() {\n\tscanf(\"%d\", &n);\n\tforn(i,1,n) scanf(\"%lld\", a+i);\n\tforn(i,2,n) {\n\t\tint u, v; LL w;\n\t\tscanf(\"%d%d%lld\", &u, &v, &w);\n\t\tAdd(u, v, w), Add(v, u, w);\n\t}\n\tS = Mx[rt = 0] = n;\n\tGetrt(1, 1);\n\tsolve(rt);\n\tprintf(\"%lld\\n\", Ans);\n\treturn 0;\n} \n```",
        "postTime": 1614328698,
        "uid": 223884,
        "name": "AxDea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3\uff1a\u300cCOCI2019\u300d Transport"
    },
    {
        "content": "\u4e00\u4e2a\u5927\u5e38\u6570\u5199\u6cd5\uff0c\u4f46\u662f\u5c31\u662f\u7eafDS\uff0c\u6ca1\u6709\u601d\u7ef4\u96be\u5ea6\u3002\n\n\u89e3\u6cd5\uff1a\u9898\u76ee\u4e0a\u8981\u6c42\u4e00\u76f4\u6709\u6cb9\u7528\uff0c\u5047\u8bbe\u6211\u4eec\u7ecf\u8fc7\u7684\u70b9\u662f $p_1,p_2 \\dots p_{k+1}$\uff0c\u8d70\u8fc7\u7684\u8fb9\u662f $l_1,l_2 \\dots ,l_k$\u3002\u90a3\u4e48\u9898\u76ee\u53ef\u4ee5\u8f6c\u5316\u6210\u5bf9\u4e8e\u4efb\u610f\u7684 $i \\in [1,k]$\uff0c\u6ee1\u8db3\uff1a\n\n$$ \\sum_{j=1}^i a_{p_i}- \\sum_{j=1}^i w_{l_i}\\ge 0$$\n\n\u6052\u6210\u7acb\u3002\u4e5f\u5c31\u662f\uff1a\n\n$$ \\min_{i=1}^k{\\sum_{j=1}^i a_{p_i}- \\sum_{j=1}^i w_{l_i}}\\ge 0$$\n\n\u6210\u7acb\u3002\n\n\u8003\u8651\u70b9\u5206\u6cbb\uff0c\u5bf9\u4e8e\u5f53\u524d\u7684\u5206\u6cbb\u4e2d\u5fc3 $x$ \uff0c\u8bb0\u5f55 $\\text{minn} _ i$ \u8868\u793a $x$ \u8d70\u5230 $i$ \u7684\u8def\u5f84\u4e0a\u51fa\u73b0\u8fc7\u7684\u6700\u7f3a\u6cb9\u7684\u65f6\u5019\u3002\u90a3\u4e48\u5bf9\u4e8e $\\text{minn} _ i \\ge 0$ \u7684\u70b9\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u4e4b\u524d\u7684\u904d\u5386\u5230\u7684\u70b9\u4e2d\u80fd\u591f\u8d70\u5230 $x$ \u7684\u70b9\uff0c\u81f3\u4e8e\u600e\u4e48\u6c42\u8fd9\u4e9b\u70b9\uff0c\u4e4b\u540e\u518d\u8bf4\u3002\u5426\u5219\uff0c\u6211\u4eec\u5c31\u53ea\u80fd\u4e0e\u4e4b\u524d\u90a3\u4e9b\u8d70\u5230 $x$ \u70b9\u4e4b\u540e\u5269\u4f59\u6cb9\u91cf $\\text{left} \\ge -minn_i$ \u7684\u70b9\u7684\u6570\u91cf\uff0c\u8fd9\u76f8\u5f53\u4e8e\u533a\u95f4\u6570\u70b9\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u7528\u503c\u57df\u7ebf\u6bb5\u6811\u6765\u8ba1\u7b97\u3002\n\n\u7136\u540e\u5728\u8003\u8651\u8fd9\u9897\u5b50\u6811\u52a0\u5165\u5230\u7ebf\u6bb5\u6811\u4e2d\uff0c\u540c\u6837\u8fd8\u662f\u8bb0\u5f55 \u8bb0\u5f55 $\\text{minn} _ i$ \u8868\u793a $i$ \u8d70\u5230 $x$ \u7684\u8def\u5f84\u4e0a\u51fa\u73b0\u8fc7\u7684\u6700\u7f3a\u6cb9\u7684\u65f6\u5019\u3002\u8981\u6c42 $\\text{minn} _ i \\ge 0$ \uff0c\u5176\u624d\u80fd\u6210\u4e3a\u5019\u9009\u70b9\uff0c\u7136\u540e\u5c06\u5176\u52a0\u5165\u5230\u503c\u57df\u7ebf\u6bb5\u6811\u4e2d\u3002\u5176\u5b9e\u5e73\u8861\u6811\u4e5f\u662f\u53ef\u4ee5\u7684\uff0c\u5e38\u6570\u5927\u6982\u6bd4\u7ebf\u6bb5\u6811\u5c0f\u3002\n\n\u7136\u540e\u5012\u7740\u6765\u4e00\u8fb9\uff0c\u518d\u8ba1\u7b97\u4e00\u4e2a\u7aef\u70b9\u4e3a $x$ \u7684\u70b9\u5bf9\u6570\u91cf\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log{n}\\log{v})$\u3002\u5e73\u8861\u6811\u5c31\u662f $O(n\\log^2{n})$ \u3002\u9700\u8981\u5783\u573e\u56de\u6536\u3002\n\n```\n#include<bits/stdc++.h>\n#define N 100005\n#define INF 1e14\n#define pb push_back \n#define pii pair<int,int>\n#define mp make_pair\n#define fi first\n#define se second  \n#define int long long  \nusing namespace std;\nint rt,cnt,sum[N<<5],ls[N<<5],rs[N<<5];\nint rubbish[N<<3],rub;\nint newnode(){\n\tif(rub) return rubbish[rub--];\n\treturn ++cnt;\n}\nvoid destory(int &x){\n\tls[x]=rs[x]=sum[x]=0;\n\trubbish[++rub]=x;\n\tx=0;\n}\nvoid modify(int &p,int l,int r,int x,int v){\n\tif(!p) p=newnode();\n\tif(l==r){\n\t\tsum[p]+=v;\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tif(x<=mid) modify(ls[p],l,mid,x,v);\n\telse modify(rs[p],mid+1,r,x,v);\n\tsum[p]=sum[ls[p]]+sum[rs[p]];\n}\nint query(int p,int l,int r,int ql,int qr){\n\tif(!p) return 0;\n\tif(ql<=l&&qr>=r) return sum[p];\n\tint mid=(l+r)>>1,res=0;\n\tif(ql<=mid) res+=query(ls[p],l,mid,ql,qr);\n\tif(qr>mid) res+=query(rs[p],mid+1,r,ql,qr); \n\treturn res;\n}\nvoid clear(int &p,int l,int r){\n\tif(!p) return ;\n\tif(l==r){\n\t\tdestory(p);\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tclear(ls[p],l,mid);\n\tclear(rs[p],mid+1,r);\n\tdestory(p);\n}\nint n,m;\nint a[N];\nvector<pii > e[N];\nbool vis[N];\nint ans=0,len=0;\nint maxn[N],tot,size[N],root;\nvoid getroot(int x,int f){\n\tsize[x]=1;\n\tmaxn[x]=1;\n\tfor(int i=0;i<e[x].size();i++){\n\t\tint y=e[x][i].fi;\n\t\tif(y==f||vis[y]) continue;\n\t\tgetroot(y,x);\n\t\tsize[x]+=size[y];\n\t\tmaxn[x]=max(maxn[x],size[y]); \n\t}\n\tmaxn[x]=max(maxn[x],tot-size[x]);\n\tif(maxn[x]<maxn[root]) root=x;\n}\nint sumw1[N],suma1[N],minn1[N],sumw2[N],suma2[N],minn2[N];\nvector<int> v1[N],v2[N];\nvoid dfs1(int x,int f,int id){\n\tv1[id].pb(x);\n\tfor(int i=0;i<e[x].size();i++){\n\t\tint y=e[x][i].fi,z=e[x][i].se;\n\t\tif(y==f||vis[y]) continue;\n\t\tsumw1[y]=sumw1[x]+z;\n\t\tsuma1[y]=suma1[x]+a[x];\n\t\tminn1[y]=min(minn1[x],suma1[y]-sumw1[y]);//\u6c42\u6700\u5c0f\n\t\tdfs1(y,x,id);\n\t}\n}\nvoid dfs2(int x,int f,int id){\n\tif(minn2[x]>=0) v2[id].pb(x); \n\tfor(int i=0;i<e[x].size();i++){\n\t\tint y=e[x][i].fi,z=e[x][i].se;\n\t\tif(y==f||vis[y]) continue;\n\t\tminn2[y]=min(minn2[x]+a[y]-z,a[y]-z);//\u6c42\u6700\u5c0f\n\t\tsuma2[y]=suma2[x]+a[y];\n\t\tsumw2[y]=sumw2[x]+z;\n\t\tdfs2(y,x,id);\n\t}\n}\nvoid solve(int x){//\u8fd9\u4e2a\u65b9\u6cd5\u5e38\u719f\u771f\u7684\u5f88\u5927\uff0c\u6240\u4ee5\u4e0d\u8981\u6bcf\u6b21\u8ba1\u7b97\u90fd\u904d\u5386\u5b50\u6811\uff0c\u8bb0\u5f55\u4e0b\u6765\u3002\n\tif(!x) return ;\n\tfor(int i=0;i<e[x].size();i++){\n\t\tint y=e[x][i].fi,z=e[x][i].se;\n\t\tif(vis[y]) continue;\n\t\tv1[i].clear();\n\t\tminn1[y]=a[x]-z;\n\t\tsuma1[y]=a[x];\n\t\tsumw1[y]=z;\n\t\tdfs1(y,x,i);\n\t\tfor(int j=0;j<v1[i].size();j++){\n\t\t\tint t=v1[i][j];\n\t\t\tif(minn1[t]>=0) ans+=sum[rt];\n\t\t\telse ans+=query(rt,0,INF,-minn1[t],INF);\n\t\t}\n\t\tminn2[y]=a[y]-z;\n\t\tsuma2[y]=a[y];\n\t\tsumw2[y]=z;\n\t\tv2[i].clear();\n\t\tdfs2(y,x,i);\n\t\tfor(int j=0;j<v2[i].size();j++){\n\t\t\tint t=v2[i][j];\n\t\t\tmodify(rt,0,INF,suma2[t]-sumw2[t],1);\n\t\t}\n\t}\n\tclear(rt,0,INF);\n\tfor(int i=e[x].size()-1;i>=0;i--){\n\t\tint y=e[x][i].fi,z=e[x][i].se;\n\t\tif(vis[y]) continue;\n\t\tfor(int j=0;j<v1[i].size();j++){\n\t\t\tint t=v1[i][j];\n\t\t\tif(minn1[t]>=0) ans+=sum[rt];\n\t\t\telse ans+=query(rt,0,INF,-minn1[t],INF);\n\t\t}\n\t\tfor(int j=0;j<v2[i].size();j++){\n\t\t\tint t=v2[i][j];\n\t\t\tmodify(rt,0,INF,suma2[t]-sumw2[t],1);\n\t\t}\n\t}\n\tclear(rt,0,INF);\n\tfor(int i=0;i<e[x].size();i++){\n\t\tint y=e[x][i].fi,z=e[x][i].se;\n\t\tif(vis[y]) continue;\n\t\tfor(int j=0;j<v1[i].size();j++){\n\t\t\tint t=v1[i][j];\n\t\t\tif(minn1[t]>=0) ans++;\n\t\t}\n\t\tans+=v2[i].size();\n\t}\n} \nvoid divide(int x){\n\tvis[x]=1;\n\tsolve(x);\n\tfor(int i=0;i<e[x].size();i++){\n\t\tint y=e[x][i].fi;\n\t\tif(vis[y]) continue;\n\t\tmaxn[0]=tot=size[y];\n\t\troot=0;\n\t\tgetroot(y,x);\n\t\tdivide(root);\n\t}\n}\nsigned main(){\n\t//freopen(\"data.in\",\"r\",stdin);\n\t//freopen(\"my.out\",\"w\",stdout);\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<n;i++){\n\t\tint u,v,w;\n\t\tscanf(\"%lld%lld%lld\",&u,&v,&w);\n\t\te[u].pb(mp(v,w));\n\t\te[v].pb(mp(u,w));\n\t}\n\tmaxn[0]=tot=n,root=0;\n\tgetroot(1,0);\n\tdivide(root);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n/*\n4\n4 3 3 3 \n4 3 4\n2 1 3\n4 1 4\n*/\n```\n",
        "postTime": 1619960708,
        "uid": 128870,
        "name": "chen_qian",
        "ccfLevel": 7,
        "title": "P5306"
    }
]