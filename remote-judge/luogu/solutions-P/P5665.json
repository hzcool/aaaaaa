[
    {
        "content": "\u5148\u8bf4\u8bf4\u90e8\u5206\u5206\u505a\u6cd5\u5427\n\n1.$n \\leq 10$ \u6307\u6570\u7ea7\u778e\u8349\u90fd\u53ef\u4ee52333\n\n2.$n \\leq 50$ \u597d\u50cf\u5e76\u6ca1\u6709\u4ec0\u4e48\u505a\u6cd5\u2026~~\u4e5f\u8bb8\u7ed9\u526a\u679d\u7684\u4eba\u90e8\u5206\u5206\u5427~~\n\n3.$n \\leq 400$ \u8fd9\u4e2a\u590d\u6742\u5ea6\u662f\u7ed9 $O(n^3)$ \u8fc7\u7684\u2026 \u5927\u6982\u5c31\u662f \u8003\u8651\u4e00\u4e2a\u6570\u7ec4 $dp_{n,n}$ \u6bcf\u6b21\u679a\u4e3e\u8f6c\u79fb\u70b9$i , j ,k$ \n\n$$dp_{j,k} = min\\{ dp_{i,j} + (sum_k - sum_j)^2\\}$$\n\n4.$n \\leq 5000$ \n\n\u8fd9\u9053\u9898\u6709\u4e2a\u663e\u800c\u6613\u89c1\u7684\u7ed3\u8bba\uff1a\u6700\u540e\u4e00\u6bb5\u5c3d\u91cf\u5c0f \u7b54\u6848\u4f1a\u6700\u4f18\u2026\n\n\u6240\u4ee5\u6bcf\u6b21\u8003\u8651\u8f6c\u79fb\u80fd\u8f6c\u79fb\u7684 \u6700\u5c0f\u7684\u76f4\u63a5\u4e8c\u5206\u5c31\u884c\u4e86\u5427\u2026\u8fd9\u6837\u5c31\u5c11\u6389\u4e00\u7ef4\u7a7a\u95f4 \u65f6\u95f4\u4e5f\u53d8\u6210 $O(n^2 \\log n)$ \u4e86\n~~\u4e0d\u8fc7\u4ed4\u7ec6\u60f3\u60f3\u597d\u50cf $n^2$\u5c31\u884c\u4e86~~\n\n5. \u6b63\u89e3\u5427\u2026\u2026 \u8fd9\u4e2a\u9898\u7684\u5927\u6bd2\u7624\u51fa\u9898\u4eba\u51fa\u7684\u9898\u8981\u7528\u9ad8\u7cbe\u5ea6 \u987a\u624b\u8fd8\u5361\u4e86\u5185\u5b58\u2026 \u597d\u50cf\u628azyy\u548chy\u7b49\u4e00\u5806\u795e\u4ed9\u5361\u6389\u4e86\u2026\n\n\u7531\u4e8e\u662f\u5355\u8c03\u7684 \u6240\u4ee5\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a $\\text{d(i)}$ \u5373\u4ee5 $i$ \u7ed3\u5c3e\u7684\u8fd9\u4e00\u6bb5\u7684\u503c\u2026\n\n\u6240\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217 \u7136\u540e\u6ce8\u610f\u4e00\u70b9 \u8bb0\u5f55\u6bcf\u4e2a\u70b9\u7684\u524d\u9a71$pre_i$ \u6700\u540e\u7edf\u8ba1\u7b54\u6848 \u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1~~int128~~\u7a7a\u95f4\u4e0d\u4f1a\u7206\u70b8\n\u524d\u6392\u8d60\u9001 $\\texttt{88pts}$ \u4ee3\u7801\n\n$\\texttt{code}$\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std ;\nconst int N = 4e7 + 10 ;\nint n , type , a[N] , q[N] , dp[N] , sum[N] , d[N] ;\nsigned main() {\n  ios :: sync_with_stdio(false) ; cin.tie(nullptr) ; cout.tie(nullptr) ;\n  cin >> n >> type ;\n  for(register int i = 1 ; i <= n ; i ++) { cin >> a[i] ; sum[i] = sum[i - 1] + a[i] ; }\n  int h , t ; q[h = t = 0] = 0 ;\n  for(register int i = 1 ; i <= n ; i ++) {\n    while(h < t && d[q[h + 1]] + sum[q[h + 1]] <= sum[i]) ++ h ;\n    d[i] = sum[i] - sum[q[h]] ; dp[i] = dp[q[h]] + (d[i] * d[i]) ;\n    while(h < t && d[q[t]] + sum[q[t]] >= d[i] + sum[i]) -- t ;\n    q[++ t] = i ;\n  }\n  cout << dp[n] << '\\n' ;\n  return 0 ;\n}\n```\n\n\u81f3\u4e8e\u9ad8\u7cbe\u61d2\u5f97\u5199\u2026 \u76f4\u63a5\u62ffint128\u6c34\u4e86 \u7136\u540e\u628adp\u6570\u7ec4\u7c7b\u578b\u6539\u6210int128 \u548c\u539f\u6765\u7684\u5206\u6570\u83ab\u5f97\u533a\u522b2333\n\u76f4\u63a5\u8f6c\u79fb\u7adf\u7136$\\texttt{1G}$ \u5185\u5b58\u90fd\u4e0d\u591f\u7528 \u4f5b\u4e86\u2026\n\n$\\texttt{code}$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\nconst int N = 4e7 + 10 ;\nconst int M = 1e5 + 10 ;\nconst int mod = (1 << 30) ;\nint n , type , x , y , z , m ;\nint a[N] , b[N] , p[M] , l[M] , r[M] , q[N] , pre[N] ;\nlong long sum[N] ;\ninline long long d(int x) { return sum[x] - sum[pre[x]] ; }\nsigned main() {\n  ios :: sync_with_stdio(false) ; cin.tie(nullptr) ; cout.tie(nullptr) ;\n  cin >> n >> type ;\n  if(type) {\n\t\tcin >> x >> y >> z >> b[1] >> b[2] >> m ;\n    for(register int i = 1 ; i <= m ; i ++) { cin >> p[i] >> l[i] >> r[i] ; }\n    for(register int i = 3 ; i <= n ; i ++) { b[i] = (0ll + 1ll * b[i - 1] * x + 1ll * b[i - 2] * y + z) % mod ; }\n    for(register int i = 1 ; i <= m ; i ++)\n      for(register int j = p[i - 1] + 1 ; j <= p[i] ; j ++) { a[j] = (b[j] % (r[i] - l[i] + 1)) + l[i] ; sum[j] = sum[j - 1] + a[j] ; }\n\t}\n  else {\n  \tfor(register int i = 1 ; i <= n ; i ++) { cin >> a[i] ; sum[i] = sum[i - 1] + a[i] ; }\n\t} int h , t ; q[h = t = 0] = 0 ;\n  for(register int i = 1 ; i <= n ; i ++) {\n    while(h < t && d(q[h + 1]) + sum[q[h + 1]] <= sum[i]) ++ h ; \n\t\tpre[i] = q[h] ;\n    while(h < t && d(q[t]) + sum[q[t]] >= d(i) + sum[i]) -- t ;\n    q[++ t] = i ;\n  }  int now = n ; __int128 ans = 0 , tmp = 1 ;\n\twhile(now) { tmp = d(now) ; tmp *= d(now) ; ans += tmp ; now = pre[now] ; }\n\tint st[50] , tp = 0 ;\n\twhile(ans) { st[++ tp] = ans % 10 ; ans /= 10 ; }\n\twhile(tp) { cout << st[tp --] ; }\n  return 0 ;\n}\n```\n\n~~\u522b\u55b7int128\u554a~~",
        "postTime": 1574152337,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "---\n\n\u6682\u65f6\u53ef\u4ee5\u901a\u8fc7\u6d1b\u8c37\u6240\u6709\u6570\u636e\u7684\u4e0d\u5bf9\u52b2\u505a\u6cd5\uff0c\u5f53\u7136\u5728\u8003\u8bd5\u7684\u65f6\u5019\u5e76\u4e0d\u80fd\u5f97\u5206qwq\n\n\u5148\u8bb2\u4e00\u4e0b\u672c\u9898\u9898\u89e3\uff1a\n\n\u9996\u5148\u662f\u4e00\u4e2a\u795e\u5947\u7684\u6027\u8d28\uff0c\u8003\u8651\u6700\u540e\u7684\u7b54\u6848\uff0c\u6700\u4f18\u89e3\u5fc5\u7136\u6ee1\u8db3\u6700\u540e\u4e00\u6bb5\u6700\u5c0f\u3002\n\n~~\u8bc1\u660e\u7684\u8bdd\u53ef\u4ee5\u67e5\u770b\u5176\u4ed6\u7684\u9898\u89e3\uff0c\u5df2\u7ecf\u6709\u4eba\u8bc1\u8fc7\u4e86\u6211\u5c31\u4e0d\u732e\u4e11\u4e86\u3002~~\n\n\u6709\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u540e\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u8003\u8651 dp \u4e86\n\n\u4ee4 $f_i$ \u8868\u793a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u6700\u4f18\u65b9\u6848\uff0c\u90a3\u4e48\u540c\u65f6\u8bb0\u5f55\u4e00\u4e0b $l_i$ \u8868\u793a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u6700\u5c0f\u6bb5\n\n\u7531\u4e8e\u6211\u4eec\u77e5\u9053\u6700\u4f18\u89e3\u662f\u6ee1\u8db3\u6700\u540e\u7ed3\u5c3e\u6bb5\u6700\u5c0f\u7684\u60c5\u51b5\uff0c\u53c8\u7531\u4e8e\u5bf9\u4e8e\u4efb\u610f\u7684\u4e00\u4e2a\u524d\u7f00\u5176\u90fd\u6ee1\u8db3\u6700\u4f18\u89e3\u6ee1\u8db3\u6700\u540e\u6bb5\u6700\u5c0f\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6ee1\u8db3\u6b64\u4f4d\u7f6e $j$ \u7ed3\u5c3e\u7684\u6700\u5c0f\u6bb5 $l_j$ \u6bd4 $S_i-S_j$ \u5c0f\u5373\u53ef\n\n\u4e8e\u662f\u8f6c\u79fb\u5408\u6cd5\u7684\u5224\u5b9a\u5c31\u547c\u4e4b\u800c\u51fa\u4e86\uff1a\n\n$$f_i=f_{\\max(j)\\in (S_i-S_j\\ge l_j)}+(S_i-S_j)^2$$\n\n\u7b80\u5355\u5316\u7b80\u4e00\u4e0b\u6761\u4ef6\u5c31\u662f\uff1a\n\n$$S_i\\ge S_j+l_j$$\n\n\u4e8e\u662f\u4ee4 $R_i=S_i+l_i$ \u5c31\u53ef\u4ee5\u5f88\u7b80\u5355\u7684\u8003\u8651\u8f6c\u79fb\u4e86\n\n\u663e\u7136\u662f\u6ee1\u8db3 $S_i\\ge R_k$ \u4e2d\u6700\u5927\u7684 $k$\uff0c\u4e8e\u662f\u5355\u8c03\u961f\u5217\u4f18\u5316\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\n\n\u7136\u540e\u7531\u4e8e\u8fd9\u91cc\u662f Luogu \u6240\u4ee5\u901a\u8fc7 ```int128``` \u901a\u8fc7\u8fd9\u9053\u9898 $88$\n\n\u4e0b\u9762\u662f\u5173\u4e8e\u8fd9\u9053\u9898\u7684\u4e0d\u6b63\u7ecf\u641e\u6cd5\n\n\u5173\u4e8e\u53d8\u6210 $1\\rm 00pts$ \u503c\u5f97\u4ee4\u4eba\u63a2\u7a76\u7684\u662f\u5173\u4e8e\u5b83\u7684\u7a7a\u95f4\u95ee\u9898\n\n\u5982\u679c\u60a8\u91c7\u53d6\u6211\u8fd9\u4e2a**\u4e0d\u65b9\u4fbf\u7684\u505a\u6cd5**\uff0c\u90a3\u4e48\u6211\u4eec\u6700\u8d77\u7801\u9700\u8981\u8bb0 dp \u6570\u7ec4\uff0c\u8bb0 $\\rm sum$ \u6570\u7ec4\uff08\u524d\u7f00\u548c\u6570\u7ec4\uff09\u4ee5\u53ca $R$ \u6570\u7ec4\uff08\u7528\u4e8e\u5224\u5b9a\u8f6c\u79fb\uff09\n\n\u5927\u6982\u9700\u8981\u538b\u6389\u5176\u4e2d\u4e00\u4e2a\u624d\u53ef\u4ee5\u8fc7\u53bb\u3002\n\n\u6211\u4eec\u5927\u80c6\u731c\u6d4b\u8f6c\u79fb\u7684\u65f6\u5019\u88ab\u5b58\u4e0b\u6765\u7684\u53ef\u4ee5\u7528\u7684\u72b6\u6001\u6570\u5e76\u4e0d\u591a\uff0c\u5373\u53ef\u4ee5\u88ab\u4f7f\u7528\u7684 $dp_k$ \u5e76\u4e0d\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u628a $dp_i$ \u5f53\u505a $dp_{i\\% P}$ \u5373\u53ef\uff0c\u5c06 $p$ \u8bbe\u6210\u5927\u6982 $1e7$ \u5373\u53ef\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b58\u653e\u5728\u5355\u8c03\u961f\u5217\u5185\u7684$dp$ \u503c\u7684\u6570\u91cf\u5e94\u8be5\u4e0d\u4f1a\u8d85\u8fc7 $1e7$\uff0c\u7136\u540e\u901a\u8fc7\u5b9e\u8df5\u53d1\u73b0\u8fd9\u6837\u786e\u5b9e\u662f\u53ef\u4ee5\u7684\u3002\n\n\u4e0d\u8fc7\u5b98\u65b9\u6570\u636e\u6709\u70b9\u6bd2\uff0c\u5927\u6982\u9700\u8981\u8bbe\u6210 $1.5\\cdot 10^7$ \u751a\u81f3\u4ee5\u4e0a\u624d\u53ef\u4ee5\u3002\n\n\u7136\u540e\u6ce8\u610f $\\rm int,long~long,int128$ \u8981\u5206\u5f00\u770b\u5f85\u4e5f\u5c31\u662f\u8bf4\u4f60\u9700\u8981\u6ce8\u610f\u53d8\u91cf\u7684\u4f7f\u7528\u3002\n\n\u7136\u800c\u5373\u4f7f\u5728\u4ee5\u524d\u7684 Luogu \u8fd9\u6837\u505a\u4e5f\u4f1a $\\text{TLE}$\uff0c\u6211\u4eec\u5fc5\u7136\u662f\u975e\u5e38\u4e0d\u723d\u7684\uff0c\u4f60\u9700\u8981\u5f00 $\\rm O2$ \u624d\u80fd\u8fc7\u9898\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5c06\u53d6\u819c\u8fd0\u7b97\u52a0\u901f\uff0c\u5c06 $p$ \u9009\u6210 $2^x$ \u5c31\u53ef\u4ee5\u901a\u8fc7 $\\&$ \u8fd0\u7b97\u7b80\u5355\u5b9e\u73b0\u4e86\n\n\u9002\u5408\u7684\u6a21\u6570 $P=16,777,215$\n\n- \u4e0d\u8fc7 Luogu \u7684\u8bc4\u6d4b\u673a\u6bd4\u8d77\u4ee5\u524d\u5df2\u7ecf\u6162\u5f88\u591a\u4e86\uff0c\u73b0\u5728\u8fd9\u6837\u505a\u9700\u8981\u5f00\u7740 O2 \u624d\u80fd\u52c9\u5f3a\u8fc7\u53bb......\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define re register\n#define LL __int128\nLL gi() { \n    LL cn = 0, flus = 1 ; char cc = getchar() ; \n    while( cc > '9' || cc < '0' ) { if( cc == '-' ) flus = -flus ; cc = getchar() ; } \n    while( cc >= '0' && cc <= '9' ) cn = cn * 10 + cc - '0', cc = getchar() ; \n    return cn * flus ; \n} \nconst int N = 4e7 + 5 ; \nconst int M = 1e5 + 5 ; \nconst int P = ( 1 << 30 ) - 1 ; \nconst int Y = 16777215 ; \nint n, m, q[N], he, ta ; \nLL dp[Y + 5] ; \nlong long sum[N], B[N] ; \nint L[M], R[M], p[M] ; \nLL D( LL x ) { \n    return x * x ; \n} \nvoid write( LL x ) { \n    if( x == 0 ) return ; \n    write( x / 10 ), printf(\"%d\", x % 10 ) ; \n} \nsigned main() { \n    n = gi() ; int type = gi() ; \n    if( type == 0 ) {\n        rep( i, 1, n ) sum[i] = gi(), sum[i] = sum[i - 1] + sum[i] ; \n    }\n    else {\n        LL x, y, z ; \n        x = gi(), y = gi(), z = gi() ;\n        sum[1] = gi(), sum[2] = gi(), m = gi() ;\n        rep( i, 3, n ) sum[i] = ( x * sum[i - 1] + y * sum[i - 2] + z ) & P ; \n        rep( i, 1, m ) p[i] = gi(), L[i] = gi(), R[i] = gi() ; p[0] = 0 ;\n        for( re int t = 1; t <= m; ++ t ) {\n            for( re int i = p[t - 1] + 1; i <= p[t]; ++ i ) {\n                sum[i] = sum[i] % ( R[t] - L[t] + 1ll ) + L[t] ; \n                sum[i] = sum[i - 1] + sum[i] ; \n            }\n        }\n    }\n    memset( dp, -1, sizeof(dp) ), dp[0] = 0, B[0] = 0, he = 1, q[++ ta] = 0 ; \n    for( re int i = 1; i <= n; ++ i ) { \n        long long Ri = sum[i] ; \n        while( he < ta && Ri >= B[q[he + 1]] ) ++ he ; \n        if( he <= ta ) \n            if( Ri >= B[q[he]] ) {\n                dp[i & Y] = dp[q[he] & Y] + D( sum[i] - sum[q[he]] ) ;\n                B[i] = sum[i] - sum[q[he]] ; \n                B[i] = sum[i] + B[i] ; \n            }\n        if( dp[i & Y] != -1 ) {\n            while( he <= ta && B[q[ta]] > B[i] ) -- ta ; \n            q[++ ta] = i ; \n        } \n    } \n    write(dp[n & Y]) ; \n    return 0 ; \n} \n```",
        "postTime": 1574155829,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "~~**UPD\uff1a\u5b98\u65b9\u6570\u636e\u51fa\u6765\uff0c\u539f\u9898\u89e3\u65e0\u6cd5\u901a\u8fc7\u3002\u73b0\u5728\u5df2\u7ecf\u5e38\u6570\u4f18\u5316\uff0c\u4fdd\u9669\u8d77\u89c1\uff0c\u8bc4\u6d4b\u8bf7\u5f00\u542f O2\u3002**~~\n\n**\uff08\u4e00\u5e74\u534a\u540e\uff09UPD2\uff1a\u7ecf\u8fc7\u4e00\u665a\u4e0a\u7684\u5361\u5e38\uff0c\u624b\u5199\u9ad8\u7cbe\u5ea6\u7ec8\u4e8e\u5728\u4e0d\u5f00 O2 \u7684\u60c5\u51b5\u4e0b\u7a33\u7a33\u5730\u901a\u8fc7\u4e86\u8fd9\u9898\uff01**\n\n---\n\n\u65e2\u5f53\u4f5c\u662f\u4e00\u4e2a\u8d5b\u573a\u81ea\u5df1\u6ca1\u505a\u51fa\u6765\u7684\u603b\u7ed3\uff0c\u4e5f\u7ed9\u90a3\u4e9b\u4e0d\u613f\u4f7f\u7528 `__int128` \u7684\u540c\u5b66\u4eec\u4e00\u7bc7\u53ef\u4ee5\u53c2\u8003\u7684\u9898\u89e3\u5427\u3002\n\n\u9996\u5148\u7531 **\u5b8c\u5168\u5e73\u65b9\u516c\u5f0f** \uff0c\u53ef\u4ee5\u5f97\u5230 $(a + b)^2 \\ge a^2 + b^ 2$\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5c3d\u53ef\u80fd **\u591a\u5206\u6bb5**\u3002\n\n\u89c2\u5bdf\u8fd9\u4e2a\u56fe\uff1a\n\n![](https://i.loli.net/2019/12/01/M18YfQrFOXDikC6.png)\n\n\n\u5982\u679c\u6b64\u65f6\uff0c$sum_L + x \\le sum_R$\uff0c\u90a3\u4e48 $x$ \u8fd9\u4e2a\u6570\u5e94\u8be5\u5206\u5230\u90a3\u4e00\u8fb9\u5462\uff1f\n\n\u663e\u7136\uff0c$sum_L \\le sum_R$\uff0c$x$ \u52a0\u5230 $side$ **\u90a3\u8fb9** \u5c06\u4f1a\u4ea7\u751f $2x\\cdot sum_{side}$ \u7684\u4ee3\u4ef7\u3002\n\n\u4e3a\u4e86\u4f7f\u5f97\u603b\u4ee3\u4ef7\u6700\u5c0f\uff0c\u6211\u4eec\u5f53\u7136\u628a $x$ \u52a0\u5230 $sum_L$ \u90a3\u4e00\u8fb9\u5566\uff01\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u5bf9\u4e8e\u67d0\u4e00\u6bb5\uff0c\u6211\u4eec\u8d2a\u5fc3\u7684\u5728\u6700\u9760\u540e\u7684\u53ef\u884c\u4f4d\u7f6e\u5212\u5206\uff0c\u4e5f\u5c31\u662f\u4f7f\u5f97\u6700\u540e\u4e00\u6bb5\u6700\u5c0f\uff0c\u7b54\u6848\u5fc5\u7136\u6700\u4f18\u3002\n\n-----\n\n64pts \u7684\u505a\u6cd5\u662f\u8d2a\u5fc3\u7684\u8bb0\u5f55\u8fd9\u4e00\u6bb5\u7684\u503c\uff0c\u679a\u4e3e **\u4e0a\u4e00\u6bb5\u7684\u7ec8\u70b9**\u3002\n\n\u5927\u6982\u5c31\u662f\u8fd9\u6837\uff1a\n\n```cpp\nfor(int i = 2; i <= n; ++i)\n    for(int j = 1; j < i; ++j)\n        if(sum[i] - sum[j] >= last[j] && f[j] + (sum[i] - sum[j]) * (sum[i] - sum[j]) < f[i])\n            f[i] = f[j] + (sum[i] - sum[j]) * (sum[i] - sum[j]), last[i] = sum[i] - sum[j];\n```\n\n$last_i$ \u8868\u793a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u90a3\u4e00\u6bb5\u7684\u548c\uff0c$f_n$ \u5373\u4e3a\u7b54\u6848\u3002\n\n----\n\n\u90a3 100pts \u7684\u505a\u6cd5\u5462\uff1f\n\n\u7528 $g_i$ \u8868\u793a\u73b0\u5728\u5212\u5206\u6bb5\u7684\u672b\u5c3e\u4e3a $i$ \uff0c**\u4e0a\u4e00\u6bb5\u7684\u672b\u5c3e**\u3002\n\n\u7528 $s_i$ \u8868\u793a $\\sum_{k = 1}^{i} a_k$\uff08\u524d\u7f00\u548c\uff09\u3002\n\n\u6362\u8a00\u4e4b\uff0c $g_i = \\max pos\\ s.t.  \\ s_i - s_{pos} \\ge s_{pos} - s_{g_{pos}}$\u3002\n\n\u79fb\u9879\u5f97\u5230\uff0c$g_i = \\max pos\\ s.t.  \\ s_i \\ge 2s_{pos} - s_{g_{pos}}$\u3002\n\n\u4ee4 $ val(x) = 2 s_x-s_{g_x} $\uff0c\u5219$g_i = \\max pos\\ s.t.  \\ s_i \\ge val(pos)$\uff0c\u6709\u7ed3\u8bba\uff1a\n\n\u5982\u679c $x, y$ \u90fd\u662f\u5f53\u524d\u4f4d\u7f6e $i$ \u7684\u5408\u6cd5\u6765\u6e90\uff0c\u5373 $s_i \\ge val(x), val(y)$\uff0c\u800c\u4e14 $x<y$\uff0c\u5219 $x$ \u5fc5\u7136 **\u65e0\u6cd5\u6210\u4e3a** $g_i$\u3002\n\n\u7531\u6b64\uff0c\u5f53\u6c42 $g_i$ \u65f6\uff0c\u5148\u628a\u5355\u8c03\u961f\u5217\u4e2d\u6240\u6709\u961f\u9996\u7684\u8fc7\u65f6\u51b3\u7b56\u5f39\u51fa\uff08\u5982\u679c\u961f\u5217\u4e2d\u7684\u4e0b\u4e00\u4e2a\u6570\u7684 $val$ \u90fd $\\le s_i $ \u7684\u8bdd\uff0c\u8fd9\u4e2a\u51b3\u7b56\u5c31\u88ab\u5f39\u51fa\uff09\u3002\n \n$g_i$ \u5c31\u662f **\u65b0\u7684\u961f\u9996** \uff0c\u7136\u540e\u628a $i$ \u52a0\u5165\u51b3\u7b56\u65f6\uff0c\u8981\u628a\u961f\u5c3e\u6240\u6709 $val \\ge val(i)$ \u7684\u5f39\u51fa\uff08\u56e0\u4e3a $i$ \u5728\u5b83\u4eec **\u540e\u9762** \uff0c$val$ \u8fd8\u6bd4\u5b83\u4eec **\u5c0f** \uff0c\u90a3\u5b83\u4eec\u5fc5\u7136 **\u4e0d\u4f1a\u6210\u4e3a** \u4efb\u4f55\u4e00\u4e2a\u4f4d\u7f6e\u7684 $g$ \u4e86\uff09\u3002\n\n\u6700\u540e\u4e00\u6bb5\u7684\u672b\u7aef\u70b9\u662f $n$\uff0c\u6240\u4ee5\u8ba9 $p = n$\uff0c\u4e0d\u65ad\u7684\u671d $g_p$ \u8ffd\u6eaf\uff0c\u5e76\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u6ce8\u610f\u65f6\u95f4\u4f18\u5316\uff0c\u7a7a\u95f4\u4f18\u5316\uff0c\u9ad8\u7cbe\u5ea6\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u524d\u7f00\u548c\u4e0d\u7528\u5e73\u65b9\uff0c\u4e0d\u8981\u5f00 **\u9ad8\u7cbe\u5ea6\u6570\u7ec4** \uff01\n\n\u4ee3\u7801\u5982\u4e0b:\n\n```cpp\n#include <stdio.h>\n#include <ctype.h>\n#include <memory.h>\n#define rg register\n#define gc() (p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, 1 << 21, stdin), p1 == p2) ? EOF : *p1++)\n#define val(x) (s[x] << 1) - s[g[x]]\ntypedef unsigned long long ULL;\nconst int MOD = (1 << 30) - 1, N = 4e7 + 3, M = 1e5 + 3, BASE = 1e9;\nint g[N], b[N], p[M], q[N];\nULL s[N];\nchar buf[1 << 21], *p1 = buf, *p2 = buf;\ninline int read()\n{\n    int val = 0; char c = gc();\n    while(!isdigit(c)) c = gc();\n    while(isdigit(c)) { val = (val << 3) + (val << 1) + (c ^ 48); c = gc(); }\n    return val;\n}\nstruct bigint\n{\n    int len;\n    ULL num[4];\n    bigint operator + (const bigint &oth)\n    {\n        bigint res; \n        memset(res.num, 0, sizeof(res.num));\n        res.len = len > oth.len ? len : oth.len; rg ULL p = 0;\n        for(rg int i = 0; i < res.len; i++) \n        {\n            res.num[i] = num[i] + oth.num[i] + p;\n            p = res.num[i] / BASE;\n            res.num[i] -= BASE * p;\n        }\n        if(p) res.num[res.len++] = p;\n        return res;\n    }\n} ans;\nint main()\n{\n    int n = read(), type = read();\n    if(type)\n    {\n        ULL x, y; int z, m, l, r;\n        x = read(); y = read(); z = read(); b[1] = read(); b[2] = read(); m = read();\n        for(rg int i = 3; i <= n; i++) b[i] = (x * b[i - 1] & MOD) + (y * b[i - 2] & MOD) + z & MOD;\n        for(rg int j = 1; j <= m; j++)\n        {\n        \tp[j] = read(); l = read(); r = read();\n        \tfor(rg int i = p[j - 1] + 1, a; i <= p[j]; s[i] = s[i - 1] + a, i++)\n                a = b[i] % (r - l + 1) + l;\n\t\t}\n    }\n    else for(rg int i = 1, a; i <= n; s[i] = s[i - 1] + a, i++) a = read();\n   \trg int head = 1, tail = 1;\n    for(rg int i = 1; i <= n; i++)\n    {\n        while(head < tail && val(q[head + 1]) <= s[i]) head++;\n        g[i] = q[head];\n        while(head <= tail && val(q[tail]) >= val(i)) tail--;\n        q[++tail] = i;\n    }\n    ans.len = 0;\n    for(rg int pos = n; pos; pos = g[pos])\n    {\n        bigint tmp, res; ULL val = s[pos] - s[g[pos]];\n        tmp.len = 0;\n        while(val) { tmp.num[tmp.len++] = val % BASE; val /= BASE; }\n\t    memset(res.num, 0, sizeof(res.num));\n\t    res.len = (tmp.len << 1) - 1; ULL p = 0;\n\t    for(rg int i = 0; i < tmp.len; i++) for(rg int j = 0; j < tmp.len; j++)\n\t        res.num[i + j] += tmp.num[i] * tmp.num[j];\n\t    for(rg int i = 0; i < res.len; i++)\n\t    {\n\t        res.num[i] += p;\n\t        p = res.num[i] / BASE;\n\t        res.num[i] -= BASE * p;\n\t    }\n\t    while(p) { res.num[res.len++] = p % BASE; p /= BASE; }\n        ans = ans + res;\n    }\n    printf(\"%llu\", ans.num[ans.len - 1]); for(rg int i = ans.len - 2; ~i; i--) printf(\"%09llu\", ans.num[i]);\n    return 0;\n}\n```",
        "postTime": 1575166141,
        "uid": 51971,
        "name": "syksykCCC",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "## \u4e00\u3001\u9898\u76ee\n\n[\u70b9\u6b64\u770b\u9898](https://www.luogu.org/problem/P5665)\n\n## \u4e8c\u3001\u89e3\u6cd5\n\n**0x01 \u8003\u573a\u7684\u60f3\u6cd5**\n\n\u8003\u8651\u5230\u5212\u5206\u7684\u6bb5\u662f\u9012\u589e\u7684\uff0c\u8bbe$dp[i][j]$\u4e3a\u5212\u5206\u5230\u7b2c$i$\u4e2a\u7684\u524d\u9a71\u662f$j$\uff0c\u8f6c\u79fb\uff1a\n$$dp[i][j]=dp[j][k]+(sum[i]-sum[j])^2$$\n\u5224\u4e00\u4e0b\u9012\u589e\uff0c\u66b4\u529b\u8f6c\u79fb\u65f6\u95f4\u590d\u6742\u5ea6$O(n^3)$\uff0c\u53ef\u4ee5\u62ff\u5230$36$\u5206\u7684\u9ad8\u5206\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u53ef\u4ee5**\u56fa\u5b9a**$j$\uff0c\u53d1\u73b0\u5728\u79fb\u52a8$i$\u7684\u8fc7\u7a0b\u4e2d\uff0c$k$\u4e5f\u5728\u79fb\u52a8\uff0c\u6ee1\u8db3\u4e00\u4e2a\u5355\u8c03\u6027\uff0c\u7136\u540e\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a$dp[j][k]$\u7684\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2)$\uff0c\u53ef\u4ee5\u62ff\u5230$64$\u5206\u7684\u9ad8\u5206\u3002\n\n**0x02 \u8d2a\u5fc3\u7684\u7ed3\u5408**\n\n\u636e\u8bf4\u6253\u8868\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u7ed3\u8bba\uff0c\u5728**\u5408\u6cd5\u7684\u60c5\u51b5**\u4e0b\uff0c$dp[i][j]\\leq dp[i][j-1]$\u3002\n\n\u6240\u4ee5\u6700\u53f3\u8fb9\u7684\u524d\u9a71\u662f\u6700\u4f18\u7684\uff0c\u7136\u540e\u6211\u4eec**\u4e0d\u8003\u8651\u66f4\u65b0\uff0c\u800c\u8003\u8651\u8f6c\u79fb\u70b9**\uff0c\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6700\u53f3\u8fb9\u7684\u524d\u9a71\uff0c\u7ed3\u5408\u524d\u7f00\u548c\u7684\u5355\u8c03\u6027\uff0c\u5f53\u5de6\u8fb9$head+1$\u6ee1\u8db3\u6761\u4ef6\u65f6\u79fb\u52a8\u5de6\u7aef\u70b9\uff0c\u53f3\u7aef\u70b9\u7ef4\u62a4\u5355\u8c03\u9012\u589e\uff0c\u5f97\u5230\u4e86\u8f6c\u79fb\u70b9\u4e4b\u540e\u53ef\u4ee5\u76f4\u63a5\u7b97\u7b54\u6848\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n)$\u3002\n\n\u4e0d\u60f3\u5199\u9ad8\u7cbe\u4e86\uff0c\u76f4\u63a5\u641e\u4e86\u4e2a$\\_\\_int128$\uff0c~~\u53ef\u80fd\u6211\u6ca1\u6709\u804c\u4e1a\u7cbe\u795e~~ \u3002\n\n\n```cpp\n#include <cstdio>\n#define LL __int128\n#define ll long long\n#define calc(x) (2*s[x]-s[g[x]])\nconst int MAXN = 40000005;\nconst int MAXM = 100005;\nconst int MOD = 1<<30;\nint read()\n{\n    int x=0,flag=1;char c;\n    while((c=getchar())<'0' || c>'9') if(c=='-') flag=-1;\n    while(c>='0' && c<='9') x=(x<<3)+(x<<1)+(c^'0'),c=getchar();\n    return x*flag;\n}\nvoid write(LL x)\n{\n\tif(x>9) write(x/10);\n\tputchar(x%10+'0');\n}\nint n,type,q[MAXN],g[MAXN],l[MAXM],r[MAXM],p[MAXM];\nll s[MAXN];ll b[MAXN];\nsigned main()\n{\n\tn=read();type=read();\n\tif(type==0)\n\t{\n\t\tfor(int i=1;i<=n;i++)\n\t\t\ts[i]=s[i-1]+read();\n\t}\n\telse\n\t{\n\t\tint x=read(),y=read(),z=read(),m,now=1;\n\t\tb[1]=read();b[2]=read();m=read();\n\t\tfor(int i=1;i<=m;i++)\n\t\t\tp[i]=read(),l[i]=read(),r[i]=read();\n\t\tfor(int i=3;i<=n;i++)\n\t\t\tb[i]=(x*b[i-1]+y*b[i-2]+z)%MOD;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(i>p[now]) now++;\n\t\t\ts[i]=s[i-1]+(b[i]%(r[now]-l[now]+1))+l[now];\n\t\t}\n\t}\n\tint head=1,tail=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail && calc(q[head+1])<=s[i]) head++;\n\t\tg[i]=q[head];\n\t\twhile(head<tail && calc(q[tail])>=calc(i)) tail--;\n\t\tq[++tail]=i;\n\t}\n\tint now=n;LL ans=0;\n\twhile(now) ans+=((LL)s[now]-s[g[now]])*(s[now]-s[g[now]]),now=g[now];\n\twrite(ans);\n}\n```\n",
        "postTime": 1574169496,
        "uid": 128239,
        "name": "C20203030",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u53d1\u5e03\u5728\u6211\u7684\u535a\u5ba2\uff1a[[CSP-S2 2019]\u5212\u5206 \u9898\u89e3 | KSkun's Blog](https://ksmeow.moe/partition-csps219-sol/)\uff0c\u6b22\u8fce\u6765\u901b~\n\n\u5e7f\u544a\uff1aCSP-J/S2 2019 \u5fd7\u613f\u8005\u7684\u5e55\u540e\u6545\u4e8b\uff1a[CSP-JS2 2019 \u6e38\u8bb0 | KSkun's Blog](https://ksmeow.moe/csp-js2-2019/)\n\n## \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u5217 $\\{a_i\\}$\uff0c\u6c42\u5bf9\u6570\u5217\u7684\u4e00\u4e2a\u5212\u5206 $T = \\{ k_1, k_2, \\dots, k_p \\}$\uff0c\u4f7f\u5f97\u8be5\u5212\u5206\u6ee1\u8db3 $\\sum\\limits_{i=1}^{k_1} a_i\\le \\sum\\limits_{i=k_1+1}^{k_2} a_i \\le \\dots \\le \\sum\\limits_{i=k_p+1}^n a_i$\uff0c\u4e14\u6700\u5c0f\u5316 $ \\left(\\sum\\limits_{i=1}^{k_1} a_i \\right)^2+\\left(\\sum\\limits_{i=k_1}^{k_2} a_i \\right)^2+\\cdots +\\left(\\sum\\limits_{i=k_p+1}^n a_i \\right)^2 $\u3002\n\n## \u9898\u89e3\n\n\u8fd9\u4e2a\u9898\u7684\u90e8\u5206\u601d\u8def\u5e76\u4e0d\u96be\uff0c\u4f46\u6700\u4f18\u89e3\u6cd5\u786e\u5b9e\u5177\u6709\u4e00\u5b9a\u7684\u96be\u5ea6\u548c\u590d\u6742\u7a0b\u5ea6\uff0c\u4ee5\u81f3\u4e8e\u4ece\u5f00\u59cb\u5199\u5230\u6574\u7406\u601d\u8def\u5199\u8fd9\u7bc7\u9898\u89e3\u4e00\u5171\u7528\u4e86\u4e09\u5929\u65f6\u95f4\u3002\n\n### \u6700\u521d\u7684 DP\n\n\u9996\u5148\u53ef\u4ee5\u8bbe\u8ba1\u51fa\u4e00\u4e2a\u6bd4\u8f83\u7b80\u5355\u7684 DP\uff0c\u72b6\u6001 $f(i, j)$ \u8868\u793a\u5bf9\u524d $i$ \u4e2a\u6570\u5b57\u5206\u6bb5\uff0c\u4e0a\u4e00\u6bb5\u7684\u7ed3\u5c3e\u4e3a $j$ \u7684\u65f6\u5019\u6bb5\u5e73\u65b9\u548c\u7684\u6700\u5c0f\u503c\u3002\u8f6c\u79fb\u65f6\uff0c\u679a\u4e3e\u4e0a\u4e00\u6bb5\u7684\u7ed3\u5c3e $j$\uff0c\u518d\u679a\u4e3e\u4e0a\u4e0a\u4e00\u6bb5\u7684\u7ed3\u5c3e $k$\uff0c\u5148\u5224\u65ad\u662f\u5426\u6ee1\u8db3\u8f6c\u79fb\u6761\u4ef6 $\\sum\\limits_{t=k+1}^j a_t \\leq \\sum\\limits_{t'=j+1}^i a_{t'}$\uff0c\u7136\u540e\u8fdb\u884c\u6700\u5c0f\u5316\u8f6c\u79fb\uff1a\n\n$$ f(i, j) = \\min_{ \\sum\\limits_{t=k+1}^j a_t \\leq \\sum\\limits_{t'=j+1}^i a_{t'} } \\left\\{ f(j, k) + \\left( \\sum\\limits_{t=j+1}^i a_i \\right)^2 \\right\\} $$\n\n\u663e\u7136\u8fd9\u4e2a DP \u7684\u590d\u6742\u5ea6\u4e3a $O(n^3)$\u3002\n\n### \u8d2a\u5fc3\u7b56\u7565\u4e0e DP \u4f18\u5316\n\n\u770b\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n$$ a^2 + b^2 < (a+b)^2 \\ \\ \\ (a, b > 0) $$\n\n\u5728\u8f6c\u79fb\u65f6\uff0c\u6700\u540e\u4e00\u6bb5\u6700\u957f\u80af\u5b9a\u8d8a\u53ef\u80fd\u6ee1\u8db3\u8f6c\u79fb\u6761\u4ef6\u3002\u5f53\u6bb5\u8f83\u957f\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u5c06\u6bb5\u4ece\u4e2d\u95f4\u62c6\u6210\u591a\u6bb5\u4e5f\u53ef\u4ee5\u6ee1\u8db3\u8f6c\u79fb\u6761\u4ef6\u3002\u5047\u8bbe\u5207\u4e3a\u4e24\u6bb5\u540e\u6ee1\u8db3\u8f6c\u79fb\u6761\u4ef6\u4e14\u524d\u4e00\u6bb5\u4e4b\u548c\u4e3a $a$\u3001\u540e\u4e00\u6bb5\u4e4b\u548c\u4e3a $b$\uff0c\u4e0a\u9762\u7684\u5f0f\u5b50\u544a\u8bc9\u6211\u4eec\uff0c\u8fd9\u91cc\u5207\u6210\u4e24\u6bb5\u540e\u7684\u6bb5\u5e73\u65b9\u548c\u66f4\u5c0f\u3002\u56e0\u6b64\uff0c\u6bb5\u80af\u5b9a\u662f\u8d8a\u77ed\u8d8a\u597d\u7684\uff0c\u6216\u8005\u4e5f\u53ef\u4ee5\u8bf4\uff0c\u6700\u540e\u4e00\u6bb5\u8d8a\u77ed\u8d8a\u597d\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6bb5\u8d8a\u77ed\u6709\u5229\u4e8e\u4e4b\u540e\u5206\u7684\u6bb5\u4e5f\u8f83\u77ed\u3002\n\n\u56e0\u6b64\uff0c\u8fd9\u91cc\u6709\u8d2a\u5fc3\u7b56\u7565\uff1a\u6bb5\u5206\u5f97\u8d8a\u77ed\u8d8a\u597d\u3002\n\n\u8003\u8651\u5c06\u8d2a\u5fc3\u5e94\u7528\u8fdb DP \u7684\u8fc7\u7a0b\u4e2d\uff0c\u65e2\u7136\u6700\u540e\u4e00\u6bb5\u8d8a\u77ed\u8d8a\u597d\uff0c\u6700\u4f18\u89e3\u4e2d\u7684\u6700\u540e\u4e00\u6bb5\u4e00\u5b9a\u662f\u6700\u77ed\u7684\uff0c\u56e0\u6b64\u4e0a\u4e00\u6bb5\u7684\u7ed3\u5c3e\u4e0d\u518d\u6709\u591a\u79cd\u53ef\u80fd\u6027\uff0c\u800c\u662f\u76f4\u63a5\u9009\u62e9\u4f7f\u6700\u540e\u4e00\u6bb5\u6700\u77ed\u7684\u90a3\u4e00\u4e2a\u3002\u5c06\u524d $i$ \u4e2a\u6570\u5b57\u5206\u6bb5\u7684\u6700\u4f18\u89e3\u4e2d\uff0c\u4e0a\u4e00\u6bb5\u7684\u7ed3\u5c3e\u8bb0\u4e3a $lst(i)$\uff0cDP \u72b6\u6001\u4e5f\u53ef\u6539\u4e3a $f(i)$ \u4ee3\u8868\u524d $i$ \u4e2a\u6570\u5b57\u5206\u6bb5\u7684\u6700\u4f18\u89e3\u7684\u6bb5\u5e73\u65b9\u548c\u3002\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b\uff1a\n\n$$ f(i) = \\min_{ \\sum\\limits_{t=lst(j)+1}^j a_t \\leq \\sum\\limits_{t'=j+1}^i a_{t'} } \\left\\{ f(j) + \\left( \\sum\\limits_{t=j+1}^i a_i \\right)^2 \\right\\} $$\n\n\u590d\u6742\u5ea6\u964d\u4e3a $O(n^2)$\uff0c\u4f46\u4f9d\u7136\u4e0d\u591f\u3002\n\n### \u5355\u8c03\u961f\u5217\n\n\u8bb0 $a_i$ \u7684\u524d\u7f00\u548c\u4e3a $s(i)$\uff0c\u5c06\u8f6c\u79fb\u6761\u4ef6\u5199\u6210\u524d\u7f00\u548c\u7684\u5f62\u5f0f\uff1a\n\n$$ s(j)-s[lst(j)-1] \\leq s(i)-s(j) $$\n\n\u79fb\u9879\u53ef\u5f97\n\n$$ s(i) \\geq 2s(j)-s[lst(j)-1] $$\n\n\u4e0a\u5f0f\u7684\u5de6\u8fb9\u53ea\u4e0e $i$ \u6709\u5173\uff0c\u53f3\u8fb9\u53ea\u4e0e $j$ \u6709\u5173\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u6700\u5927\u7684 $j$\u3002\n\n\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u4e00\u4e2a $j$ \u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u65f6\uff0c\u6839\u636e\u524d\u7f00\u548c\u7684\u5355\u589e\u6027\u53ef\u4ee5\u5f97\u5230 $s(i+1) \\geq s(i) \\geq 2s(j)-s[lst(j)-1]$\uff0c\u5373 $j$ \u4e5f\u53ef\u4ee5\u4f5c\u4e3a $i+1$ \u7684\u51b3\u7b56\u3002\u56e0\u6b64\u53ef\u884c\u7684\u51b3\u7b56\u70b9\u662f\u4e00\u4e2a\u4ee5 $1$ \u4e3a\u5de6\u7aef\u70b9\u7684\u533a\u95f4\uff0c\u5f53 $i$ \u589e\u5927\u65f6\uff0c\u51b3\u7b56\u70b9\u7684\u533a\u95f4\u53f3\u7aef\u70b9\u4e5f\u662f\u5355\u589e\u7684\uff08\u6027\u8d28 1\uff09\u3002\u663e\u7136\uff0c$2s(j)-s[lst(j)-1]$ \u7684\u503c\u8d8a\u5c0f\uff0c$j$ \u8d8a\u53ef\u80fd\u6210\u4e3a\u5408\u6cd5\u7684\u51b3\u7b56\u70b9\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bb0 $A(j) = 2s(j)-s[lst(j)-1]$\uff0c\u5f53 $j_1 > j_2$ \u4e14 $A(j_1) \\leq A(j_2)$ \u65f6\uff0c$j_1$ \u4e00\u5b9a\u4f18\u4e8e $j_2$\uff08\u6027\u8d28 2\uff09\u3002\n\n\u4e0a\u8ff0\u6027\u8d28\u51b3\u5b9a\u4e86\u6211\u4eec\u53ef\u4ee5\u5e94\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316 DP \u8f6c\u79fb\u7684\u590d\u6742\u5ea6\uff1a\u7ef4\u62a4\u4e00\u4e2a $A(j)$ \u6570\u503c\u5355\u8c03\u9012\u589e\u4e14 $j$ \u4e5f\u5355\u589e\u7684\u5355\u8c03\u961f\u5217\uff0c\u6bcf\u6b21\u8f6c\u79fb\u65f6\u627e\u5230\u961f\u5217\u4e2d\u6700\u5927\u7684\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u51b3\u7b56\u70b9 $j_m$\uff08\u6027\u8d28 1\uff09\uff0c\u8f6c\u79fb\u540e\u4ec5\u4fdd\u7559 $j_m$ \u800c\u5f39\u51fa\u5c0f\u4e8e $j_m$ \u7684\u6ee1\u8db3\u6761\u4ef6\u7684\u51b3\u7b56\u70b9\uff08\u6027\u8d28 2\uff09\u3002\u8f6c\u79fb\u5b8c\u6210\u540e\uff0c\u8ba1\u7b97 $A(i)$ \u518d\u5c06 $i$ \u653e\u5165\u961f\u5217\u4e2d\uff0c\u4f5c\u4e3a\u4ee5\u540e\u7684\u72b6\u6001\u7684\u53ef\u80fd\u51b3\u7b56\u70b9\u3002\n\n\u5229\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316 DP \u540e\uff0c\u8f6c\u79fb\u7684\u590d\u6742\u5ea6\u53d8\u4e3a $O(1)$\uff0c\u5219\u603b\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6781\u9650\u6570\u636e\u3002\n\n### \u5361\u5e38\n\n\u7531\u4e8e\u6700\u5f00\u59cb\u7684\u5199\u6cd5\u4f7f\u7528\u4e86\u5927\u91cf STL \u548c\u5e38\u6570\u7565\u5927\u7684\u5199\u6cd5\uff0c\u5728\u5404\u79cd OJ \u4e0a\u90fd\u8dd1\u4e0d\u8fc7\u6781\u9650\u6570\u636e\uff0c\u4e8e\u662f\u5f00\u59cb\u4e86\u5361\u5e38\u3002\n\n- \u9996\u5148\u81ea\u7136\u662f\u7528\u4e86 fread \u7248\u5feb\u8bfb\uff0c\u8fd9\u7b97\u662f\u6211\u7684\u4e00\u4e2a\u4e60\u60ef\u3002\n- \u5728\u9ad8\u7cbe\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u5229\u7528\u7279\u6b8a\u6761\u4ef6\u5224\u65ad\u51cf\u5c11\u4e86\u603b\u8fd0\u7b97\u6b21\u6570\uff0c\u5c24\u5176\u662f\u51cf\u5c11\u4e86\u53d6\u6a21\u7684\u6b21\u6570\u3002\n- \u539f\u672c\u662f\u5728\u8f93\u5165\u4e4b\u540e\u5355\u72ec\u7b97\u4e00\u904d\u524d\u7f00\u548c\uff0c\u6539\u6210\u4e86\u8fb9\u8f93\u5165\u8fb9\u7b97\u524d\u7f00\u548c\u3002\n- \u7531\u4e8e\u6709\u70b9\u5361\u7a7a\u95f4\uff0c\u590d\u7528\u4e86\u524d\u7f00\u548c\u6570\u7ec4 s \u7684\u7a7a\u95f4\u4f5c\u4e3a\u751f\u6210\u6570\u636e\u7528\u7684\u4e34\u65f6\u7a7a\u95f4\u3002\n- \u5355\u8c03\u961f\u5217\u6ca1\u5c01\u88c5\uff0c\u76f4\u63a5\u628a\u5b9e\u73b0\u5c55\u5f00\u5230 DP \u7684\u8fc7\u7a0b\u4e2d\u4e86\u3002\n- \u624b\u52a8\u5f00\u4e86\u4e2a O3\u3002\n\n\u6700\u540e\u7ec8\u4e8e\u5728\u6d1b\u8c37\u4e0a AC \u4e86\u3002\u4e0d\u8fc7\u6ca1\u5361\u7684\u8fd9\u4e48\u6781\u7aef\u7684\u65f6\u5019\u4e5f\u80fd\u5728 LOJ\u3001UOJ \u4e4b\u7c7b\u7684\u5730\u65b9\u8dd1\u8fc7\uff0c\u53ef\u80fd\u6d1b\u8c37\u8dd1\u7684\u4f1a\u7565\u6709\u70b9\u6162\u3002\n\n### \u4e25\u8c28\u6027\u8bf4\u660e\u548c\u6027\u8d28\u8bc1\u660e\n\n\u672c\u9898\u89e3\u7684\u8bf4\u660e\u5e76\u4e0d\u4e25\u8c28\uff0c\u5728\u8bf4\u660e\u5355\u8c03\u961f\u5217\u4f18\u5316\u8f6c\u79fb\u65f6\u5e76\u672a\u7ed9\u51fa\u76f8\u5173\u6027\u8d28\u7684\u8bc1\u660e\uff0c\u8868\u8ff0\u4e5f\u4e0d\u5c3d\u6e05\u6670\u3002\u672c\u6587\u53d7\u672c\u4eba\u6c34\u5e73\u3001\u65f6\u95f4\u3001\u7cbe\u529b\u7b49\u6240\u9650\uff0c\u6682\u65f6\u65e0\u6cd5\u5448\u73b0\u51fa\u66f4\u597d\u7684\u6548\u679c\uff0c\u6b22\u8fce\u63d0\u51fa\u5efa\u8bae\u6216\u6539\u5199\u672c\u6587\u90e8\u5206\u5185\u5bb9\u3002\n\n\u5173\u4e8e\u6709\u5173\u6027\u8d28\u7684\u8bc1\u660e\uff0c\u53ef\u4ee5\u5728\u6bdb\u7237\u7237\u7684\u535a\u5ba2\uff1a[CSP2019\u5212\u5206\u7684\u7b80\u8981\u9898\u89e3 - \u535a\u5ba2 - matthew99](http://matthew99.blog.uoj.ac/blog/5299)\u7684\u535a\u5ba2\u9605\u8bfb\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#pragma GCC optimize(3) // \u624b\u52a8\u5f00 O3\n// Code by KSkun, 2019/12\n#include <cstdio>\n#include <cctype>\n#include <cstring>\n\n#include <algorithm>\n#include <utility>\n\ntypedef unsigned long long LL;\ntypedef std::pair<int, int> PII;\n\ninline char fgc() {\n\tstatic char buf[100000], * p1 = buf, * p2 = buf;\n\treturn p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, 100000, stdin), p1 == p2)\n\t\t? EOF : *p1++;\n}\n\ninline LL readint() {\n\tregister LL res = 0, neg = 1; register char c = fgc();\n\tfor (; !isdigit(c); c = fgc()) if (c == '-') neg = -1;\n\tfor (; isdigit(c); c = fgc()) res = res * 10 + c - '0';\n\treturn res * neg;\n}\n\ninline char readsingle() {\n\tchar c;\n\twhile (!isgraph(c = fgc())) {}\n\treturn c;\n}\n\nconst int MAXN = 40000005, MAXM = 100005;;\nconst LL MASK = (1ull << 30) - 1; // % 2^30 \u548c & MARK \u7b49\u4ef7\n\nint n, type, lst[MAXN];\nLL s[MAXN];\n\nvoid gen_data() {\n\tLL x, y, z, m;\n\tx = readint(); y = readint(); z = readint();\n\ts[1] = readint(); s[2] = readint();\n\tm = readint();\n\tint* p = new int[MAXM], * l = new int[MAXM], * r = new int[MAXM];\n\tp[0] = l[0] = r[0] = 0;\n\tfor (int i = 1; i <= m; i++) {\n\t\tp[i] = readint();\n\t\tl[i] = readint();\n\t\tr[i] = readint();\n\t}\n\tfor (int i = 3; i <= n; i++) {\n\t\ts[i] = (x * s[i - 1] + y * s[i - 2] + z) & MASK; // \u590d\u7528 s \u6570\u7ec4\u7701\u7a7a\u95f4\n\t}\n\tfor (int i = 1; i <= m; i++) {\n\t\tfor (int j = p[i - 1] + 1; j <= p[i]; j++) {\n\t\t\ts[j] = (s[j] % (r[i] - l[i] + 1)) + l[i] + s[j - 1]; // \u590d\u7528 s \u6570\u7ec4\u7701\u7a7a\u95f4\n\t\t}\n\t}\n\tdelete[] p; delete[] l; delete[] r; // \u5185\u5b58\u56de\u6536\n}\n\nconst int BN_MAX = 1e9;\nstruct BigNum {\n\tLL dat[5];\n\tint len;\n\tBigNum() {\n\t\tdat[0] = dat[1] = dat[2] = dat[3] = dat[4] = 0; // \u624b\u52a8\u521d\u59cb\u5316\u6ca1\u7528 memset \u51cf\u5c0f\u5e38\u6570\n\t\tlen = 0;\n\t}\n\tBigNum(LL x) {\n\t\tdat[0] = dat[1] = dat[2] = dat[3] = dat[4] = 0;\n\t\tlen = 0;\n\t\twhile (x > 0) {\n\t\t\tdat[len++] = x % BN_MAX;\n\t\t\tx /= BN_MAX;\n\t\t}\n\t}\n\n\tBigNum operator+(const BigNum& rhs) const {\n\t\tBigNum res;\n\t\tif (len == 0) return rhs; // \u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\n\t\tif (rhs.len == 0) return *this;\n\n\t\tres.len = std::max(len, rhs.len);\n\t\tfor (register int i = 0; i < res.len; i++) {\n\t\t\tif (dat[i] == 0 && rhs.dat[i] == 0) continue; // \u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\n\t\t\tres.dat[i] += dat[i] + rhs.dat[i];\n\t\t\tif (res.dat[i] > BN_MAX) { // \u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\n\t\t\t\tres.dat[i + 1] += res.dat[i] / BN_MAX;\n\t\t\t\tres.dat[i] %= BN_MAX;\n\t\t\t}\n\t\t}\n\t\tif (res.dat[res.len] != 0) res.len++;\n\t\treturn res;\n\t}\n\tBigNum operator*(const BigNum& rhs) const {\n\t\tBigNum res;\n\t\tif (len == 0 || rhs.len == 0) return res;\n\n\t\tres.len = len + rhs.len - 1;\n\t\tfor (register int i = 0; i < len; i++) {\n\t\t\tif (dat[i] == 0) continue; // \u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\n\t\t\tfor (register int j = 0; j < rhs.len; j++) {\n\t\t\t\tif (rhs.dat[j] == 0) continue; // \u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\n\t\t\t\tres.dat[i + j] += dat[i] * rhs.dat[j];\n\t\t\t}\n\t\t}\n\t\tfor (register int i = 0; i < res.len; i++) {\n\t\t\tif (res.dat[i] > BN_MAX) { // \u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\n\t\t\t\tres.dat[i + 1] += res.dat[i] / BN_MAX;\n\t\t\t\tres.dat[i] %= BN_MAX;\n\t\t\t}\n\t\t}\n\t\tif (res.dat[res.len] != 0) res.len++;\n\t\treturn res;\n\t}\n};\n\nint d_dat[MAXN], d_l, d_r;\n\ninline LL A(int idx) {\n\treturn 2 * s[idx] - s[lst[idx]];\n}\n\nint main() {\n\tn = readint(); type = readint();\n\n\tif (type == 0) {\n\t\tfor (register int i = 1; i <= n; i++) {\n\t\t\ts[i] = s[i - 1] + readint(); // \u8f93\u5165\u65f6\u5c31\u628a\u524d\u7f00\u548c\u505a\u4e86\uff0c\u51cf\u5c0f\u5355\u72ec\u8ba1\u7b97\u7684\u5e38\u6570\n\t\t}\n\t} else {\n\t\tgen_data();\n\t}\n\n\td_l = d_r = 0; // \u5355\u8c03\u961f\u5217\u624b\u5199\u800c\u4e14\u6ca1\u5c01\u88c5\uff0c\u5e38\u6570\u4f18\u5316\n\tfor (register int i = 1; i <= n; i++) {\n\t\tint lst_ele = 0;\n\t\twhile (d_l != d_r && s[i] >= A(d_dat[d_l])) {\n\t\t\tlst_ele = d_dat[d_l]; d_l++;\n\t\t}\n\t\tlst[i] = lst_ele; d_dat[--d_l] = lst_ele;\n\t\tLL Ai = A(i); // \u6ca1\u7a7a\u95f4\u5b58 A \u6570\u7ec4\uff0c\u6240\u4ee5\u7528\u51fd\u6570\uff0c\u8fd9\u91cc\u662f\u907f\u514d\u91cd\u590d\u8fd0\u7b97\u51cf\u5c0f\u5e38\u6570\n\t\twhile (d_l != d_r && Ai <= A(d_dat[d_r - 1])) d_r--;\n\t\td_dat[d_r++] = i;\n\t}\n\n\tBigNum ans;\n\tfor (register int i = n; i != 0; i = lst[i]) {\n\t\tBigNum t = BigNum(s[i] - s[lst[i]]);\n\t\tans = ans + t * t;\n\t}\n\tfor (register int i = ans.len - 1; i >= 0; i--) {\n\t\tif (i == ans.len - 1) {\n\t\t\tprintf(\"%llu\", ans.dat[i]);\n\t\t} else {\n\t\t\tprintf(\"%09llu\", ans.dat[i]);\n\t\t}\n\t}\n\n\treturn 0;\n}\n```",
        "postTime": 1577350960,
        "uid": 35795,
        "name": "KSkun",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.org/problem/P5665)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n### $36pts$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u96be\u770b\u51fa\u4e00\u4e2a$O(n^3)$\u7684\u6734\u7d20$DP$\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$f(i,j)$\uff1a\u5f53\u524d\u5df2\u7ecf\u5212\u5206\u597d\u4e86\u524d$i$\u4e2a\u6570\uff0c\u4e0b\u4e00\u6b21\u76f4\u63a5\u5212\u5206\u51fa$[i+1,j]$\u7684\u6700\u5c0f\u8fd0\u884c\u65f6\u95f4\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$s_i=\\sum_{j=1}^ia_j$\uff0c\u7136\u540e\u6709\u8f6c\u79fb\uff1a\n$$f(i,j)=\\min_{(0\\le k<i)\\land (s_i-s_k\\le s_j-s_i)}\\{f(k,i)+(s_j-s_i)^2\\}$$  \n### $64pts$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u4f18\u531636pts\u5c31\u53ef\u4ee5\u4e86\u3002~~  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u96be\u53d1\u73b0\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\uff0c\u5982\u679c$i$\u76f8\u540c\uff0c\u90a3\u4e48\u968f\u7740$j$\u7684\u589e\u5927\uff0c$k$\u7684\u53d6\u503c\u8303\u56f4\u662f\u589e\u5927\u7684\u3002\u6240\u4ee5\u4ece\u5c0f\u5230\u5927\u679a\u4e3e$j$\uff0c\u7136\u540e\u632a\u52a8$k$\uff0c\u7528\u4e00\u4e2a\u53d8\u91cf\u5b58\u50a8$\\min\\{f(k,i)\\}$\uff0c\u8ba1\u7b97\u5f97\u5230\u7b54\u6848\u3002  \n### $88pts\\sim100pts$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7ee7\u7eed\u6316\u6398\u9898\u76ee\u7684\u6027\u8d28\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u6839\u636e\u5b8c\u5168\u5e73\u65b9\u516c\u5f0f\uff0c~~ \u6211\u4eec\u4e0d\u96be\u53d1\u73b0\u5982\u4e0b\u7684\u6027\u8d28\uff1a  \n$$a^2+b^2\\le(a+b)^2$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u4e2a\u5f0f\u5b50\u544a\u8bc9\u4e86\u6211\u4eec\u4ec0\u4e48\u6df1\u523b\u7684\u9053\u7406\u5462\uff1f  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u2014\u2014\u5c3d\u91cf\u591a\u5206\u6bb5\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u65e2\u7136\u5982\u6b64\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$i$\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u627e\u5230\u7b2c\u4e00\u4e2a\u53ef\u884c\u7684$k$\u5c31\u53ef\u4ee5\u4e86\uff08\u6709\u4e00\u4e9b$k$\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u6210\u529f\u5206\u6bb5\uff09\u3002\u7528$g(i)$\u6765\u8bb0\u5f55\u8fd9\u4e2a\u7b2c\u4e00\u4e2a$k$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8003\u8651\u5feb\u901f\u6c42\u51fa\u8fd9\u4e2a$g(i)$\u3002\u4ece$g(i)$\u7684\u5b9a\u4e49\u5165\u624b\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**$g(i)$\u662f\u6700\u5927\u7684$k$\u4f7f\u5f97$s_i-s_k\\ge s_k-s_{g(k)}$**   \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u79fb\u9879\u7684\u5230\uff1a  \n$$s_i\\ge 2s_k-s_{g(k)}$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u540c\u65f6\uff0c$g(i)$\u662f\u9012\u589e\u7684\u3002\u6240\u4ee5\u5bf9\u4e8e$i$\uff0c\u5982\u679c$j<g(i)$\uff0c\u90a3\u4e48$j$\u4e0d\u53ef\u80fd\u6210\u4e3a$g(i+1)$\uff0c\u8fd9\u5c31\u662f\u51b3\u7b56\u7684\u5355\u8c03\u6027\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u53e6\u5916\uff0c\u7531\u4e8e$\\forall 1\\le i\\le n,1\\le g(i)< i$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u6765\u7ef4\u62a4\u53ef\u80fd\u53ef\u4ee5\u6210\u4e3a\u7b54\u6848\u7684$j$\uff0c\u7136\u540e\u6bcf\u6b21\u627e\u5230\u5355\u8c03\u961f\u5217\u91cc\u9762\u6700\u5927\u7684\u4e14\u53ef\u884c\u7684\u90a3\u4e2a\u4f5c\u4e3a$g(i)$\u5373\u53ef\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8003\u8651\u5f80\u5355\u8c03\u961f\u5217\u91cc\u9762\u63d2\u5165\u4e00\u4e2a\u503c\u3002\u8bbe$v(i)=2s_i-s_{g(i)}$\uff0c\u5219\u6211\u4eec\u5e94\u8be5\u5728\u63d2\u5165\u7684\u65f6\u5019\u5f39\u6389\u961f\u5c3e\u7684\u6240\u6709$v\\ge v(i)$\u7684\u503c\u3002\u5047\u5982$v$\u5bf9\u5e94\u7684\u4f4d\u7f6e\u53ef\u4ee5\u6210\u4e3a\u4e00\u4e2a$g$\uff0c\u90a3\u4e48$i$\u5fc5\u7136\u53ef\u4ee5\uff0c\u800c\u4e14\u66f4\u4f18\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7136\u540e\u5199\u4e00\u4e2a\u9ad8\u7cbe~~\u6216\u8005\u4f7f\u7528__int128~~\u5c31\u53ef\u4ee5\u5f97\u5230$100pts$\u5566\uff01  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u53e6\u5916\uff0c\u8bb0\u5f97\u4f18\u5316$23\\sim 25$\u7684\u70b9\u7684\u7a7a\u95f4\uff0c\u4e0d\u7136$MLE$\u5230\u6b7b\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n\ntypedef __int128 LLL;\n//\u6ca1\u4eba\u60f3\u5199\u9ad8\u7cbe\u7684\uff08\u5212\u6389\uff09\n\nconst int mod = 1 << 30;\nconst int MAXN = 4e7 + 5, MAXM = 1e5 + 5;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0; char s = getchar();int f = 1;\n\twhile( s < '0' || '9' < s ) { f = 1; if( s == '-' ) f = -1; s = getchar(); }\n\twhile( '0' <= s && s <= '9' ) { x = ( x << 3 ) + ( x << 1 ) + s - '0', s = getchar(); }\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ) { putchar( '-' ), x = -x; }\n\tif( 9 < x ) { write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntypedef void ( *spf )();\n\nLLL s[MAXN];\nint p[MAXM], l[MAXM], r[MAXM];\nint b[MAXN];\nint deq[MAXN], h, t;\nint f[MAXN];\nint N, x, y, z, M;\n\nLLL val( const int indx ) { return ( s[indx] << 1 ) - s[f[indx]]; }\n\nvoid spawn1()\n{\n\tint tmp;\n\tfor( int i = 1 ; i <= N ; i ++ ) read( tmp ), s[i] = s[i - 1] + tmp;\n}\n\nvoid spawn2()\n{\n\tread( x ), read( y ), read( z ), read( b[1] ), read( b[2] ), read( M );\n\tfor( int i = 1 ; i <= M ; i ++ ) read( p[i] ), read( l[i] ), read( r[i] );\n\tfor( int i = 3 ; i <= N ; i ++ ) b[i] = ( ( 1ll * x * b[i - 1] + 1ll * y * b[i - 2] ) % mod + z ) % mod;\n\tp[0] = 0;\n\tint tmp;\n\tfor( int j = 1 ; j <= M; j ++ )\n\t\tfor( int i = p[j - 1] + 1 ; i <= p[j] ; i ++ )\n\t\t\ttmp = b[i] % ( r[j] - l[j] + 1 ) + l[j], s[i] = s[i - 1] + tmp;\n}\n\nspf spawn[2] = { spawn1, spawn2 };\n\nint main()\n{\n\tint type;\n\tread( N ), read( type );\n\tspawn[type]();\n\tf[0] = 0;\n\th = 1, t = 0; deq[++ t] = 0;\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\twhile( h < t && val( deq[h + 1] ) <= s[i] ) h ++;\n\t\tf[i] = deq[h];\n\t\twhile( h <= t && val( deq[t] ) >= val( i ) ) t --;\n\t\tdeq[++ t] = i;\n\t}\n\tLLL res = 0; \n\tfor( int i = N ; i ; i = f[i] )\n\t\tres += ( s[i] - s[f[i]] ) * ( s[i] - s[f[i]] );\n\twrite( res ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1574400721,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[CSP-S2019]\u5212\u5206"
    },
    {
        "content": "\u778e\u903c\u5439\u4e00\u5439\u6211\u60f3\u7684\u4e1c\u897f\u597d\u4e86\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u663e\u7136\u7684 $n^2$ \u52a8\u6001\u89c4\u5212\uff0c$f(i,\\,j)$ \u8868\u793a\u8003\u8651\u524d $i$ \u4e2a\u6570\uff0c\u6700\u540e\u7684\u51b3\u7b56\u70b9\u4e3a $j$ \u65f6\u7684\u6700\u4f18\u89e3\u3002\n\n\u4ee4 $s_i$ \u4e3a\u524d\u7f00\u548c\uff0c\u5373 $s_i=\\sum_{j=1}^ia_j$\uff0c\u5219\n\n$$f(i,\\,j)=(s_i-s_j)^2+\\min_{k=0}^{j-1}f(j,\\,k)\\quad\\text{s.t. }s_i-s_j\\geq s_j-s_k$$\n\n\u7136\u540e\u7ed9 $f$ \u6253\u4e2a\u8868\uff0c\u4f1a\u53d1\u73b0\u5728 $f(i,\\,j)$ **\u4e0d\u4e3a\u65e0\u89e3**\u7684\u60c5\u51b5\u4e0b\u6709 $f(i,\\,j-1)\\geq f(i,\\,j)$ \u3002\n\n\u56e0\u6b64\u6211\u4eec\u5b9e\u9645\u4e0a\u5bf9\u4e8e $i$\uff0c\u60f3\u8981\u627e\u5230\u6700\u5927\u7684 $j$ \u6ee1\u8db3\u5c06 $(j,\\,i]$ \u5206\u4f5c\u4e00\u6bb5\u7684\u65f6\u5019\u6709\u89e3\u3002\n\n\u4ee4 $g(i)$ \u4e3a\u4e0a\u9762\u63cf\u8ff0\u7684\u201c\u6700\u5927\u7684 $j$\u201d\uff0c\u5219\n\n$$g(i)=\\max_{j=0}^{i-1}j\\quad\\text{s.t. }s_i-s_j\\geq s_j-s_{g(j)}$$\n\n\u5373 $2s_j-s_{g(j)}\\leq s_i$ \u3002\u663e\u7136 $s_i$ \u662f\u5355\u8c03\u4e0a\u5347\u7684\uff0c\u56e0\u6b64\u5355\u8c03\u961f\u5217\u4f18\u5316\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u6700\u540e\u4e09\u4e2a\u6d4b\u8bd5\u70b9\uff0c\u7b54\u6848\u53ef\u80fd\u8d85\u51fa $\\texttt{long long}$ \u7684\u8868\u793a\u8303\u56f4\u3002\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u7528\u4e24\u4e2a $\\texttt{long long}$ \u50a8\u5b58\u6700\u540e\u7684\u7b54\u6848\u5373\u53ef\u3002\n\n\u5728\u66f4\u5148\u8fdb\u7684\u8bc4\u6d4b\u7cfb\u7edf\u4e0a\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 $\\texttt{\\_\\_int128}$\uff0c\u7136\u800c $\\text{NOI Linux}$ \u662f $32$ \u4f4d\u7684\uff0c\u65e0\u6cd5\u4f7f\u7528\u3002\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <vector>\n#include <utility>\n#define N 40000020\nusing namespace std;\n\nclass Bigint\n{\nprivate:\n    vector<int> v;\n    \npublic:\n    Bigint(long long _v = 0)\n    {\n        if(_v)\n            for(; _v; _v /= 10)\n                v.push_back(_v % 10);\n\n        return;\n    }\n    \n    Bigint operator+(const Bigint &that) const\n    {\n        Bigint o;\n        int i;\n\n        if(this -> v.empty())\n            return that;\n        if(that.v.empty())\n            return *this;\n\n        o.v.resize(max(this -> v.size(), that.v.size()));\n        for(i = 0; i < (signed)o.v.size(); i ++)\n        {\n            if(i < (signed)this -> v.size())\n                o.v[i] += this -> v[i];\n            if(i < (signed)that.v.size())\n                o.v[i] += that.v[i];\n        }\n\n        return o;\n    }\n    \n    Bigint operator*(const Bigint &that) const\n    {\n        Bigint o;\n        int i, j;\n\n        if(this -> v.empty() || that.v.empty())\n            return Bigint();\n\n        o.v.resize(this -> v.size() + that.v.size() - 1);\n        for(i = 0; i < (signed)this -> v.size(); i ++)\n            for(j = 0; j < (signed)that.v.size(); j ++)\n                o.v[i + j] += this -> v[i] * that.v[j];\n\n        return o;\n    }\n    \n    void Print(void)\n    {\n        int i;\n\n        for(i = 0; i < (signed)v.size(); i ++)\n            if(v[i] >= 10)\n            {\n                if(i + 1 >= (signed)v.size())\n                    v.push_back(0);\n                v[i + 1] += v[i] / 10;\n                v[i] %= 10;\n            }\n\n        if(v.empty())\n            putchar('0');\n        else\n            for(i = (signed)v.size() - 1; i > -1; i --)\n                putchar(v[i] + 48);\n        putchar('\\n');\n\n        return;\n    }\n};\n\nlong long a[N];\nint b[N];\nint f[N];\nint q[N];\n\nvoid InitA(int n)\n{\n    int x, y, z, m;\n    int p, l, r;\n    int i;\n\n    scanf(\"%d %d %d %d %d %d\", &x, &y, &z, &b[1], &b[2], &m);\n    for(i = 1, p = 0; i <= n; i ++)\n    {\n        if(i > p)\n            scanf(\"%d %d %d\", &p, &l, &r);\n        if(i > 2)\n            b[i] = ((long long)b[i - 1] * x + (long long)b[i - 2] * y + z) & 1073741823;\n        a[i] = a[i - 1] + (b[i] % (r - l + 1) + l);\n    }\n\n    return;\n}\n\nint main(void)\n{\n    int n, k;\n    int i, l, r;\n    long long t;\n    Bigint o;\n\n    scanf(\"%d %d\", &n, &k);\n    if(!k)\n        for(i = 1; i <= n; i ++)\n        {\n            scanf(\"%lld\", &a[i]);\n            a[i] += a[i - 1];\n        }\n    else\n        InitA(n);\n\n    f[0] = 0;\n    l = r = 0;\n    q[r ++] = 0;\n    for(i = 1; i <= n; i ++)\n    {\n        while(l + 1 < r && a[q[l + 1]] * 2 - a[f[q[l + 1]]] <= a[i])\n            l ++;\n        f[i] = q[l];\n        \n        t = a[i] * 2 - a[f[i]];\n        while(l < r && a[q[r - 1]] * 2 - a[f[q[r - 1]]] >= t)\n            r --;\n        q[r ++] = i;\n    }\n\n    if(!k)\n    {\n        for(i = n, t = 0; i; i = f[i])\n            t += (a[i] - a[f[i]]) * (a[i] - a[f[i]]);\n        printf(\"%lld\\n\", t);\n    }\n    else\n    {\n        for(i = n; i; i = f[i])\n            o = o + Bigint(a[i] - a[f[i]]) * Bigint(a[i] - a[f[i]]);\n        o.Print();\n    }\n\n    return 0;\n}\n\n```",
        "postTime": 1574055045,
        "uid": 34354,
        "name": "gorokokoro",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u4e2a\u8d2a\u5fc3\u9898\uff0c\u9996\u5148\u8bf4\u7ed3\u8bba\uff1a\u6700\u4f18\u60c5\u51b5\u662f\u5212\u5206\u7684\u6700\u540e\u4e00\u6bb5\u6700\u5c0f\u3002\n\n\u6211\u4eec\u6765\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u3002\n\n\u9996\u5148\uff0c\u8bbe $sum_i$ \u8868\u793a\u524d\u7f00\u548c\uff0c\u4ee4 $j$ \u4e3a\u957f\u5ea6\u4e3a $i$ \u7684\u524d\u7f00\u6700\u4f18\u60c5\u51b5\u4e0b\u7684\u6700\u540e\u4e00\u4e2a\u5212\u5206\u70b9\uff0c\u4ee4 $s_i=sum_i-sum_j$\n\n\u8003\u8651\u5f52\u7eb3\u8bc1\u660e\uff1a\n\n1. \u957f\u5ea6\u4e3a $1$ \u7684\u524d\u7f00\u4e0d\u9700\u8981\u5212\u5206\uff0c\u6700\u540e\u4e00\u6bb5\u957f\u5ea6\u53ea\u80fd\u662f $1$\uff0c\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\u3002\n\n2. \u5047\u8bbe\u5bf9\u4e8e\u957f\u5ea6 $<i(i\\ge 2)$ \u7684\u524d\u7f00\uff0c\u6700\u4f18\u60c5\u51b5\u90fd\u662f\u5212\u5206\u7684\u6700\u540e\u4e00\u6bb5\u6700\u5c0f\uff0c\u73b0\u5728\u6765\u8bf4\u660e\u957f\u5ea6\u4e3a $i$ \u7684\u524d\u7f00\u5212\u5206\u7684\u6700\u4f18\u60c5\u51b5\u4e5f\u662f\u5212\u5206\u7684\u6700\u540e\u4e00\u6bb5\u6700\u5c0f\u3002\n\n\u6211\u4eec\u627e\u5230\u6700\u5927\u7684 $j$\uff0c\u6ee1\u8db3 $sum_i-sum_j\\ge s_j$\uff0c\u6b64\u65f6\u524d\u7f00 $i$ \u6700\u540e\u4e00\u4e2a\u5212\u5206\u70b9\u53ef\u4ee5\u662f $j$\u3002\n\n\u73b0\u5728\u6211\u4eec\u6765\u8bf4\u660e\u5bf9\u4e8e\u5176\u5b83\u6ee1\u8db3 $sum_i-sum_k\\ge s_k$ \u4e14 $k<j$ \u7684 $k$\uff0c\u524d\u7f00 $i$ \u4ee5 $j$ \u4e3a\u6700\u540e\u4e00\u4e2a\u5212\u5206\u70b9 \u4e00\u5b9a\u4e0d\u52a3\u4e8e \u4ee5 $k$ \u4e3a\u6700\u540e\u4e00\u4e2a\u5212\u5206\u70b9\u3002\n\n\u6211\u4eec\u5206\u522b\u8003\u8651\u4ee5 $j,k$ \u4e3a\u5212\u5206\u70b9\u65f6\uff0c\u6574\u4e2a\u524d\u7f00\u7684\u6240\u6709\u5212\u5206\u70b9\u3002\n\n\u9996\u5148\uff0c\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5\u662f\u4e0d\u5b58\u5728\u7684\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/h9f1hau1.png)\n\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u56e0\u4e3a $B$ \u53ef\u4ee5\u4f5c\u4e3a\u524d\u7f00 $C$ \u7684\u5212\u5206\u70b9\uff0c\u6240\u4ee5 $sum_D-sum_B> sum_C-sum_B\\ge s_B$\uff0c\u4e14 $sum_D-sum_B<sum_D-sum_A=s_D$\uff0c\u524d\u540e\u4ecd\u7136\u6ee1\u8db3\uff0c\u4e8e\u662f $B$ \u4f5c\u4e3a\u524d\u7f00 $D$ \u7684\u5212\u5206\u70b9\u4e00\u5b9a\u53ef\u884c\uff0c\u800c\u7531\u5f52\u7eb3\u5047\u8bbe\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff0c$D$ \u4e00\u5b9a\u4e0d\u4f1a\u4ee5 $A$ \u4e3a\u5212\u5206\u70b9\u3002\n\n\u4e8e\u662f\u6700\u7ec8\u4e00\u5b9a\u662f\u4e0b\u9762\u4e24\u79cd\u60c5\u51b5\u4e4b\u4e00\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/e22jpj37.png)\n![](https://cdn.luogu.com.cn/upload/image_hosting/pbjlur3a.png)\n\n\u5176\u4e2d\u7b2c\u4e00\u6761\u7ea2\u7ebf\u4e3a\u4e24\u79cd\u5212\u5206\u4e0b\u7684\u6700\u540e\u4e00\u4e2a\u516c\u5171\u5212\u5206\u70b9(\u8fd9\u91cc\u628a $0$ \u4e5f\u770b\u6210\u4e86\u5212\u5206\u70b9)\u3002\n\n\u4e24\u79cd\u60c5\u51b5\u7684\u533a\u522b\u4ec5\u4ec5\u5728\u4e8e\u516c\u5171\u5212\u5206\u70b9\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u5212\u5206\u70b9\u5c5e\u4e8e\u524d\u4e00\u79cd\u5212\u5206\u8fd8\u662f\u540e\u4e00\u79cd\u5212\u5206\u3002\n\n\u7136\u540e\u9664\u4e86\u7b2c\u4e00\u79cd\u5212\u5206\u4e2d\u6700\u540e\u7684\u82e5\u5e72\u4e2a\u5212\u5206\u70b9\uff0c\u5176\u5b83\u7684\u5212\u5206\u70b9\u90fd\u6ee1\u8db3\u4ea4\u66ff\u51fa\u73b0\u3002\n\n\u6ce8\u610f\u5230\u6211\u4eec\u53ea\u9700\u8981\u5148\u8bf4\u660e $j$ \u6bd4 $l$ \u4f18\uff0c\u518d\u8bf4\u660e $l$ \u6bd4 $k$ \u4f18\u5373\u53ef\uff0c\u6240\u4ee5\u73b0\u5728\u53ea\u8003\u8651\u4e0b\u9762\u8fd9\u4e24\u79cd\u60c5\u51b5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/584j9tzg.png)\n![](https://cdn.luogu.com.cn/upload/image_hosting/fi2ixm2q.png)\n\n\u8bbe\u524d\u4e00\u79cd\u5212\u5206\u4e2d\u516c\u5171\u5212\u5206\u70b9\u4e4b\u540e\u7684\u6bcf\u4e00\u6bb5\u6570\u5b57\u548c\u4e3a $a_1,a_2,...,a_{n1}$\uff0c\u540e\u4e00\u79cd\u5212\u5206\u4e3a $b_1,b_2,...,b_{n2}$\n\n\u73b0\u5728\u6211\u4eec\u4e0d\u8003\u8651\u539f\u5e8f\u5217\uff0c\u53ea\u8003\u8651\u8fd9\u4e24\u4e2a $a,b$ \u5e8f\u5217\uff0c\u6211\u4eec\u8981\u8bc1\u660e $\\sum_{i=1}^{n1} a_i^2\\le \\sum_{i=1}^{n2} b_i^2$\n\n\u6211\u4eec\u6765\u901a\u8fc7\u4e00\u4e9b\u64cd\u4f5c\u4f7f $a$ \u548c $b$ \u76f8\u540c\uff0c\u5e76\u4e14\u8981\u6c42\u5bf9 $a$ \u7684\u64cd\u4f5c\u4e0d\u4f7f $a$ \u66f4\u4f18\uff0c\u5bf9 $b$ \u7684\u64cd\u4f5c\u4e0d\u4f7f $b$ \u66f4\u52a3\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u63a8\u51fa $a$ \u4e0d\u52a3\u4e8e $b$ \u4e86\u3002\n\n\u5728\u4e24\u79cd\u60c5\u51b5\u4e2d\uff0c\u5982\u679c $b_1+1<b_{n2}$\uff0c\u90a3\u4e48\u6211\u4eec\u627e\u5230\u6700\u5c0f $l$ \u6ee1\u8db3 $b_l!=b_1$\uff0c\u627e\u5230\u6700\u5927\u7684 $b_r$ \u6ee1\u8db3 $b_r!=b_{n2}$\u3002\n\n\u7136\u540e\u7ed9 $b_{l-1}+1$\uff0c\u7ed9 $b_{r+1}-1$\uff0c\u8fd9\u6837\u4f1a\u4f7f $b$ \u5728\u6ee1\u8db3 $b_i\\le b_{i+1}$ \u7684\u540c\u65f6\u53d8\u5f97\u66f4\u4f18\u3002\n\n\u5982\u679c\u8fd9\u65f6\u5b58\u5728 $b$ \u5e8f\u5217\u7684\u4e00\u4e2a\u524d\u7f00\u548c $a$ \u5e8f\u5217\u7684\u4e00\u4e2a\u524d\u7f00\u76f8\u7b49\uff0c\u6211\u4eec\u5c31\u5c06 $a,b$ \u4ece\u8fd9\u4e2a\u524d\u7f00\u7684\u4f4d\u7f6e\u65ad\u5f00\uff0c\u5206\u6210\u4e24\u4e2a\u5b50\u5e8f\u5217\uff0c\u5c06\u95ee\u9898\u5212\u5206\u4e3a\u4e24\u4e2a\u5b50\u95ee\u9898\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u5b50\u95ee\u9898\u4e2d\uff0c\u4ecd\u7136\u6ee1\u8db3\u5212\u5206\u70b9\u4ea4\u66ff\u51fa\u73b0\u3002\u6211\u4eec\u4e00\u76f4\u8fdb\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u76f4\u5230\u4e0d\u80fd\u8fdb\u884c\u4e3a\u6b62\u3002\n\n\u8fd9\u65f6\uff0c\u6211\u4eec\u6709 $b_1=b_{n2}$ \u6216 $b_1=b_{n2}-1$\n\n\u7531\u4e8e $a_{n1}<b_{n2}$\uff0c\u6240\u4ee5 $a_{n1}\\le b_1$\uff0c\u6240\u4ee5 $\\forall i\\in[1,n1],a_i\\le b_1$\n\n\u5982\u679c\u6709 $n1=n2$\uff0c\u90a3\u4e48\u4e24\u4e2a\u5e8f\u5217\u4e00\u5b9a\u5b8c\u5168\u76f8\u540c\u3002\n\n\u5426\u5219\u6709 $n1=n2+1$\uff0c\u6b64\u65f6\u6211\u4eec\u53bb\u6389 $a_1$\uff0c\u5c06 $a$ \u91cd\u65b0\u7f16\u53f7\uff0c\u7136\u540e\u5bf9\u4e8e\u6240\u6709 $i\\in[1,n2]$ \u7ed9 $a_i$ \u52a0\u4e00\u4e2a\u6570\uff0c\u4f7f\u4e4b\u53d8\u4e3a $b_i$\uff0c\u5219 $a$ \u4e0e $b$ \u76f8\u540c\u4e86\u3002\u6ce8\u610f\u5230\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4f7f\u4e00\u4e2a\u8f83\u5c0f\u7684\u6570\u53d8\u5c0f\uff0c\u8f83\u5927\u7684\u6570\u53d8\u5927\uff0c\u4f1a\u4f7f $a$ \u53d8\u5f97\u66f4\u52a3\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u901a\u8fc7\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f7f\u5f97 $a$ \u4e0e $b$ \u76f8\u540c\uff0c\u5e76\u4e14\u6240\u6709\u5bf9 $b$ \u7684\u64cd\u4f5c\u90fd\u662f\u4f7f\u4e4b\u66f4\u4f18\uff0c\u6240\u6709\u5bf9 $a$ \u7684\u64cd\u4f5c\u90fd\u662f\u4f7f\u4e4b\u66f4\u52a3\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230 $a$ \u4e0d\u52a3\u4e8e $b$\u3002\n\n\u8fd9\u6837\u5c31\u8bc1\u660e\u5b8c\u4e86\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\uff0c\u9700\u8981\u624b\u5199\u9ad8\u7cbe\u5ea6\u3002\n\n\u590d\u6742\u5ea6 $O(n)$\n\n\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cassert>\nusing namespace std;\nnamespace io\n{\n\tconst int N=1<<20;\n\tchar buf[N],*t1=buf,*t2=buf;\n\t#define getc() t1==t2&&(t2=(t1=buf)+fread(buf,1,N,stdin),t1==t2)?EOF:*t1++\n\tinline int read()\n\t{\n\t\tstatic int an;an=0;\n\t\tstatic char ch;ch=getc();\n\t\twhile(ch<48||ch>57)ch=getc();\n\t\twhile(ch>=48&&ch<=57)an=(an<<3)+(an<<1)+(ch^48),ch=getc();\n\t\treturn an;\n\t}\n}\nusing io::read;\nint n,op,f[40000010];\nlong long sum[40000010];\n\nnamespace task1\n{\n\tlong long dp[51][50050];\n\tvoid solve()\n\t{\n\t\tfor(int i=1;i<=n;++i)\n\t\t{\n\t\t\tfor(int j=0;j<=50000;++j)dp[i][j]=0x3f3f3f3f3f3f3f3fll;\n\t\t\tfor(int k=0;k<i;++k)dp[i][sum[i]-sum[k]]=dp[k][sum[i]-sum[k]]+(sum[i]-sum[k])*(sum[i]-sum[k]);\n\t\t\tfor(int j=1;j<=50000;++j)dp[i][j]=min(dp[i][j],dp[i][j-1]);\n\t\t}\n\t\tprintf(\"%lld\",dp[n][sum[n]]);\n\t}\n}\n\nint x,y,z,m,p[100010],l[100010],r[100010],b[40000010],pos=1;\nint rnd(int i)\n{\n\tif(i>2)b[i]=(b[i-1]*x+b[i-2]*y+z)&((1<<30)-1);\n\tif(i>p[pos])++pos;\n\treturn b[i]%(r[pos]-l[pos]+1)+l[pos];\n}\n\nint q[40000010],h,t;\nstruct data\n{\n\tint a[4];\n\tfriend data operator * (data a,data b)\n\t{\n\t\tstatic long long C[4];\n\t\tstatic data c;\n\t\tmemset(C,0,sizeof(C));\n\t\tfor(int i=0;i<4;++i)\n\t\t\tfor(int j=0;i+j<4;++j)\n\t\t\t\tC[i+j]+=1ll*a.a[i]*b.a[j];\n\t\tfor(int i=0;i<4;++i)\n\t\t\tif(C[i]>999999999)\n\t\t\t{\n\t\t\t\tC[i+1]+=C[i]/1000000000;\n\t\t\t\tC[i]%=1000000000;\n\t\t\t}\n\t\tfor(int i=0;i<4;++i)c.a[i]=C[i];\n\t\treturn c;\n\t}\n\tfriend data operator + (data a,data b)\n\t{\n\t\tstatic long long C[4];\n\t\tstatic data c;\n\t\tmemset(C,0,sizeof(C));\n\t\tfor(int i=0;i<4;++i)C[i]=a.a[i]+b.a[i];\n\t\tfor(int i=0;i<4;++i)\n\t\t\tif(C[i]>1000000000)\n\t\t\t{\n\t\t\t\tC[i+1]+=C[i]/1000000000;\n\t\t\t\tC[i]%=1000000000;\n\t\t\t}\n\t\tfor(int i=0;i<4;++i)c.a[i]=C[i];\n\t\treturn c;\n\t}\n}cur,ans;\nvoid print(data x)\n{\n\tstatic int st[100],tp;\n\tfor(int i=0;i<=3;++i)\n\t{\n\t\tint w=x.a[i];\n\t\tfor(int j=0;j<9;++j)st[++tp]=w%10,w/=10;\n\t}\n\twhile(tp>1&&!st[tp])--tp;\n\twhile(tp)putchar(st[tp]^48),--tp;\n}\nint main()\n{\n//\tfreopen(\"partition.in\",\"r\",stdin);\n//\tfreopen(\"partition.out\",\"w\",stdout);\n\tn=read(),op=read();\n\tif(!op)\n\t{\n\t\tfor(int i=1;i<=n;++i)sum[i]=read();\n\t}\n\telse \n\t{\n\t\tx=read(),y=read(),z=read(),b[1]=read(),b[2]=read(),m=read();\n\t\tfor(int i=1;i<=m;++i)p[i]=read(),l[i]=read(),r[i]=read();\n\t\tfor(int i=1;i<=n;++i)sum[i]=rnd(i);\n\t}\n\tlong long mx=0;\n\tfor(int i=1;i<=n;++i)mx=max(mx,sum[i]),sum[i]+=sum[i-1];\n\tif(n<=50&&mx<=1000)\n\t{\n\t\ttask1::solve();\n\t\treturn 0;\n\t}\n\th=0,t=0;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\twhile(h<t&&sum[q[h+1]]+sum[q[h+1]]-sum[f[q[h+1]]]<=sum[i])++h;\n\t\tf[i]=q[h];\n\t\twhile(h<=t&&sum[q[t]]+sum[q[t]]-sum[f[q[t]]]>=sum[i]+sum[i]-sum[f[i]])--t;\n\t\tq[++t]=i;\n\t}\n\tint x=n;\n\twhile(x)\n\t{\n\t\tcur.a[0]=(sum[x]-sum[f[x]])%1000000000;\n\t\tcur.a[1]=(sum[x]-sum[f[x]])/1000000000;\n\t\tcur.a[2]=cur.a[3]=0;\n\t\tans=ans+cur*cur;\n\t\tx=f[x];\n\t}\n\tprint(ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1574563967,
        "uid": 91247,
        "name": "cjy2003",
        "ccfLevel": 10,
        "title": "P5665 \u5212\u5206 \u9898\u89e3"
    },
    {
        "content": "\u4e4b\u524d\u5199\u7684\u5185\u5bb9\u5b9e\u5728\u662f\u6ca1\u4ec0\u4e48\u7528\uff0c\u4e8e\u662f\u5168\u90e8\u4fee\u6539\u4e86\uff08\n\n\u9996\u5148\u53ef\u4ee5\u77e5\u9053\uff0c\u6700\u5c0f\u5316\u5e73\u65b9\u548c\u4e00\u5b9a\u5c31\u662f\u8981\u6700\u5c0f\u5316\u6700\u540e\u4e00\u6bb5\u7684\u548c\n  \n\u5c31\u662f\u8981\u6c42 $dp_i$\uff0c\u8868\u793a $(dp_i,i]$ \u5212\u5206\u4e3a\u4e00\u6bb5\n  \n\u5c06 $[j + 1,i]$ \u5212\u5206\u4e3a\u4e00\u6bb5\uff0c\u9700\u8981\u6ee1\u8db3\n  \n$pre_i - pre_j \\ge pre_j - pre_k$\n  \n$pre_i \\ge pre_j \\times 2 - pre_k$\n  \n\u6211\u4eec\u5e0c\u671b\u6700\u5927\u5316 $j$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $j$\uff0c$k$ \u662f\u56fa\u5b9a\u7684\uff0c\u800c $pre$ \u9012\u589e\n\n\u663e\u7136\u53ef\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u4e4b\u7c7b\u7684\u6570\u636e\u7ed3\u6784\u5728 $O(n \\log n)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u6837\u5c31\u629b\u5f03\u4e86 $pre$ \u7684\u5355\u8c03\u6027\n\n\u5f53 $i$ \u8f6c\u79fb\u5230 $i +1$ \u65f6\uff0c\u4f1a\u6709\u82e5\u5e72\u4e2a $j$ \u6ee1\u8db3\u9650\u5236\uff0c\u5e76\u4e14\u5bf9\u4e8e\u540e\u9762\u7684\u6240\u6709\u51b3\u7b56\uff0c\u5b83\u4eec\u90fd\u5c06\u6ee1\u8db3\u9650\u5236\n  \n\u90a3\u4e48\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\uff0c\u5982\u4f55\u627e\u5230\u5f53\u524d\u6ee1\u8db3\u9650\u5236\u7684 $j$\n  \n\u5bf9\u4e8e\u4e00\u4e2a $j$\uff0c\u6211\u4eec\u770b\u505a\u4e00\u4e2a\u4e8c\u5143\u5bf9 $(pre_j \\times 2 - pre_k,j)$\uff0c\u6211\u4eec\u5e0c\u671b\u524d\u8005\u5c3d\u91cf\u5c0f\uff0c\u800c\u540e\u8005\u5c3d\u91cf\u5927\n  \n\u90a3\u4e48\u5bf9\u4e8e\u4e24\u4e2a\u51b3\u7b56 $j_1,j_2$\uff0c\u5982\u679c $j_1$ \u7684 $x$ \u5927\uff0c\u800c $y$ \u5c0f\uff0c\u90a3\u4e48\u4e00\u5b9a\u4e0d\u4f1a\u9009\u62e9 $j_1$\uff0c\u76f4\u63a5\u5220\u9664\n  \n\u5220\u5b8c\u4e4b\u540e\uff0c\u6211\u4eec\u5f00\u4e00\u4e2a\u6ee1\u8db3 $y$ \u9012\u589e\u7684\u961f\u5217\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u77e5\u9053 $x$ \u4e5f\u9012\u589e\uff0c\u6bcf\u6b21\u8be5\u961f\u5217\u7684\u4e00\u4e2a\u524d\u7f00\u4f1a\u6ee1\u8db3\u9650\u5236\n  \n\u7136\u540e\u8981\u628a $i$ \u63d2\u5165\u8fd9\u4e2a\u961f\u5217\uff0c\u56e0\u4e3a $i$ \u7684 $y$ \u5927\u4e8e\u961f\u5217\u4e2d\u7684\u4efb\u610f\u5143\u7d20\uff0c\u4e8e\u662f\u9700\u8981\u5220\u53bb\u8be5\u961f\u5217\u7684\u4e00\u4e2a\u540e\u7f00\uff0c\u76f4\u5230\u518d\u6b21\u6ee1\u8db3 $x,y$ \u5747\u9012\u589e\n\n\u5bb9\u6613\u88ab\u5361\u7a7a\u95f4\uff0c\u8fd9\u91cc\u7684\u65b9\u6848\u662f\u4e0d\u5b58 $a$ \u5e8f\u5217\uff0c\u53ea\u5b58 $pre$\uff0c$b$ \u548c $pre$ \u7528\u4e00\u4e2a\u6570\u7ec4\u4f4d\u7f6e\n\n```cpp\n#include <cstdio>\n#define ll long long\nint n,type;\nint dp[40000005];\nll pre[40000005];\n\nint h = 1,r = 1;\nstruct node{\n\tll x,y;\n}Q[40000005];\n\nint m;\nll x,y,z;\nint p[100005],l[100005],_r[100005];\n\nvoid init(){\n\tscanf(\"%lld%lld%lld%lld%lld%d\",&x,&y,&z,&pre[1],&pre[2],&m);\n\tfor(int i = 3;i <= n;i++) pre[i] = (x * pre[i - 1] + y * pre[i - 2] + z) % 1073741824;\n\tfor(int i = 1;i <= m;i++){\n\t\tscanf(\"%d%d%d\",&p[i],&l[i],&_r[i]);\n\t\tfor(int j = p[i - 1] + 1;j <= p[i];j++) pre[j] = pre[j] % (_r[i] - l[i] + 1) + l[i];\n\t}\n}\n\nint main(){\n\tscanf(\"%d%d\",&n,&type);\n\tif(type == 1) init();\n\telse for(int i = 1;i <= n;i++) scanf(\"%lld\",&pre[i]);\n\tfor(int i = 1;i <= n;i++) pre[i] += pre[i - 1];\n\tQ[r++] = {0,0};\n\tint j = 0;\n\tfor(int i = 1;i <= n;i++){\n\t\twhile(h != r){\n\t\t\tif(Q[h].x <= pre[i]){\n\t\t\t\tj = Q[h++].y;\n\t\t\t}else{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tdp[i] = j;\n\t\twhile(h != r){\n\t\t\tif(Q[r - 1].x >= 2 * pre[i] - pre[j]){\n\t\t\t\tr--;\n\t\t\t}else{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tQ[r++] = {2 * pre[i] - pre[j],i};\n\t}\n\t__int128 ans = 0;\n\tint p = n;\n\twhile(p){\n\t\tans += (__int128)(pre[p] - pre[dp[p]]) * (pre[p] - pre[dp[p]]);\n\t\tp = dp[p];\n\t}\n\t\n\tint st[70],tp = 0;\n\twhile(ans){\n\t\tst[++tp] = ans % 10;\n\t\tans /= 10;\n\t}\n\twhile(tp) printf(\"%d\",st[tp--]);\n\treturn 0;\n}\n```\n",
        "postTime": 1574066633,
        "uid": 49776,
        "name": "chenxinyang2006",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "### 1. \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6b63\u6574\u6570\u5e8f\u5217 $\\{a\\}$ \uff0c\u8981\u6c42\u627e\u51fa\u4e00\u79cd\u5212\u5206\u65b9\u5f0f\uff0c\u4f7f\u5f97\u5f53\u5212\u5206\u7684\u65ad\u70b9\u5728 $k_1,k_2,\\ldots,k_p$ \u65f6\uff0c\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a\n\n$\\bullet\\ \\displaystyle\\sum_{i=1}^{k_1} a_i\\le\\displaystyle\\sum_{i=k_1 + 1}^{k_2} a_i\\le\\ldots\\le\\displaystyle\\sum_{i=k_p + 1}^{n} a_i $\n\n$\\bullet\\ \\left(\\displaystyle\\sum_{i=1}^{k_1} a_i \\right)^2 +\\left( \\displaystyle\\sum_{i=k_1 + 1}^{k_2} a_i\\right )^2 + \\cdots + \\left(\\displaystyle\\sum_{i=k_p + 1}^{n} a_i\\right)^2 $\u7684\u503c\u6700\u5c0f\u3002\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 $p$ \u53ef\u4ee5\u662f\u4efb\u610f\u503c\uff0c\u5373\u53ef\u4ee5\u5212\u5206\u4efb\u610f\u6bb5\u6570\u3002\u7279\u522b\u5730\uff0c\u6240\u6709\u7684\u6570\u53ef\u4ee5\u5168\u90e8\u5212\u4e3a\u4e00\u6bb5\u3002\n\n### 2. \u90e8\u5206\u5206\u7b97\u6cd5\n\n#### 2.1 $12\\text{pts}$ \u505a\u6cd5\n\n**\u5173\u952e\u8bcd\uff1a\u679a\u4e3e\uff0c\u641c\u7d22**\n\n\u6ce8\u610f\u5230 $n\\le 10$ \uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u4e24\u4e2a\u6570\u4e4b\u95f4\u662f\u5426\u5206\u5f00\uff0c\u6700\u540e\u7edf\u8ba1\u4e00\u6b21\u7b54\u6848\u53d6\u6700\u4f18\u89e3\u3002\n\n\u7531\u4e8e\u6bcf\u4e24\u4e2a\u6570\u4e4b\u95f4\u4f1a\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u6709\u5206\u5f00\u548c\u4e0d\u5206\u5f00\u4e24\u79cd\u60c5\u51b5\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728 $\\mathcal{O}(n\\cdot 2^{n-1})$ \u7684\u65f6\u95f4\u5185\u5f97\u51fa\u7b54\u6848\u3002\n\n#### 2.2 $24\\text{pts}$ \u505a\u6cd5\n\n**\u5173\u952e\u8bcd\uff1a\u641c\u7d22\uff0c\u526a\u679d\uff0c\u641c\u7d22\u5e8f**\n\n$n\\le 50$\uff0c\u66b4\u529b\u65e0\u6cd5\u901a\u8fc7\u3002\u4f46\u662f\u5f97\u5230\u66b4\u529b\u7b97\u6cd5\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4f18\u5316\u641c\u7d22\u987a\u5e8f\u548c\u6700\u4f18\u6027\u526a\u679d\u3002\n\n\u663e\u7136\u5730\uff0c\u6839\u636e $(a+b)^2\\le a^2+b^2$\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u5212\u5206\u7684\u6bb5\u6570\u8d8a\u591a\u8d8a\u597d\uff0c\u4f46\u662f\u5355\u8c03\u9012\u589e\u7684\u6761\u4ef6\u9650\u5236\u7740\u6211\u4eec\u3002\u6240\u4ee5\u6211\u4eec\u641c\u7d22\u7684\u65f6\u5019\u4f18\u5148\u641c\u7d22\u5212\u5206\u591a\u7684\u65b9\u6848\uff0c\u4e5f\u5c31\u662f\u80fd\u5212\u5c3d\u91cf\u5212\uff1b\n\n\u53e6\u4e00\u65b9\u9762\uff0c\u6211\u4eec\u5982\u679c\u5f53\u524d\u5df2\u7ecf\u5212\u7684\u7b54\u6848\u751a\u81f3\u5927\u4e8e\u6700\u4f18\u89e3\u4e86\uff0c\u76f4\u63a5\u7ed3\u675f\u8fd9\u90e8\u5206\u201c\u5931\u8d25\u201d\u7684\u641c\u7d22\u3002\n\n\u7efc\u5408\u4ee5\u4e0a\u4f18\u5316\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $12\\sim 24$ \u5206\u4e0d\u7b49\u7684\u90e8\u5206\u5206\u3002\n\n#### 2.3 $36\\text{pts}$ \u505a\u6cd5\n\n**\u5173\u952e\u8bcd\uff1a\u52a8\u6001\u89c4\u5212 $\\cdot\\ \\alpha$**\n\n\u9762\u5bf9 $n\\le 400$ \u7684\u8303\u56f4\uff0c\u641c\u7d22\u65e0\u6cd5\u627f\u53d7\uff0c\u6211\u4eec\u8003\u8651\u52a8\u6001\u89c4\u5212\u7b97\u6cd5\u3002\n\n\u6211\u4eec\u8bbe\u8ba1\u4e00\u4e2a\u72b6\u6001 $f(j,i)$ \u8868\u793a\u5f53\u524d\u5212\u5206\u5230 $i$ \u5e76\u4e14\u51b3\u5b9a\u5728\u8fd9\u91cc\u622a\u65ad\uff0c\u4e0a\u4e00\u6b21\u65ad\u70b9\u53d6\u5728\u4e86 $j$ \u7684\u5730\u65b9\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u7b97\u51fa\u533a\u95f4 $[j,i]$ \u7684\u8d21\u732e\u4e86\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u518d\u679a\u4e3e\u4e00\u7ef4 $k$ \u8868\u793a $j$ \u4e4b\u524d\u4ece\u54ea\u4e00\u4e2a\u65ad\u70b9\u8f6c\u79fb\u8fc7\u6765\uff0c\u663e\u7136\u6709\u8f6c\u79fb\u65b9\u7a0b $f(j,i)=\\min\\left\\{f(k,j-1)+\\left(\\displaystyle\\sum_{x=j}^{i}a_x\\right)^2\\right\\}$\n\n\u72b6\u6001\u662f $\\mathcal{O}(n^2)$ \u7684\uff0c\u8f6c\u79fb\u662f $\\mathcal{O}(n)$ \u7684\uff0c\u603b\u590d\u6742\u5ea6 $\\mathcal{O}(n^3)$\u3002\n\n#### 2.4 $64\\text{pts}$ \u505a\u6cd5\n\n**\u5173\u952e\u8bcd\uff1a\u52a8\u6001\u89c4\u5212 $\\cdot\\ \\beta$**\n\n\u5728 $n\\le 5000$ \u7684\u65f6\u5019\uff0c\u4e0a\u8ff0\u52a8\u6001\u89c4\u5212\u96be\u4ee5\u8fdb\u884c\u76f4\u63a5\u7684\u4f18\u5316\uff0c\u6211\u4eec\u9700\u8981\u53d1\u6398\u9898\u76ee\u7684\u6027\u8d28\u3002\n\n\u91cd\u65b0\u8003\u8651 $24\\text{pts}$ \u7b97\u6cd5\u4e2d\u5173\u4e8e\u641c\u7d22\u5e8f\u4f18\u5316\u7684\u90e8\u5206\u3002\n\n\u7531\u4e8e $(a+b)^2=a^2+b^2+2ab>a^2+b^2$ \uff0c\u6211\u4eec\u5f97\u51fa\u7684\u7ed3\u8bba\u662f\u6bb5\u6570\u8981\u5212\u5206\u5f97\u8d8a\u591a\u8d8a\u597d\uff1b\u90a3\u4e48\u53cd\u8fc7\u6765\uff0c\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u4e00\u6bb5 $i$\uff0c\u5982\u679c\u5bf9\u4e8e\u4efb\u610f\u7684\u4f4d\u7f6e $j(1\\le j<i)$ \u4e4b\u524d\u7684\u90a3\u4e00\u6bb5\u603b\u548c\u503c\u786e\u5b9a\u7684\uff0c\u6362\u53e5\u8bdd\u8bf4\u5bf9\u4e8e\u4efb\u610f\u7684 $j$\u90fd\u6709 $\\displaystyle\\sum_{x=j}^{i}a_x$ \u5fc5\u987b\u8981\u5927\u4e8e\u7684\u503c\u53ea\u548c $j$ \u6709\u5173\u5e76\u4e14\u662f\u786e\u5b9a\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u5177\u4f53\u9009\u62e9\u54ea\u4e00\u4e2a $j$ \u662f\u4e0d\u662f\u4e5f\u662f\u786e\u5b9a\u7684\u5462\uff1f\n\n\u7b54\u6848\u662f\u80af\u5b9a\u7684\u3002\n\n\u5047\u8bbe\u6211\u4eec\u53d1\u73b0\u4e86\u6709 $j_1,j_2,\\ldots(j_1<j_2<\\ldots)$ \u8fd9\u4e9b $j$ \u90fd\u662f\u53ef\u4ee5\u8f6c\u79fb\u5230 $i$ \u7684\uff0c\u4e5f\u5c31\u662f $\\displaystyle\\sum_{x=j}^{i}a_x$ \u90fd\u80fd\u4fdd\u8bc1\u4f7f\u5f97\u5230\u76ee\u524d\u4e3a\u6b62\u7684\u5e8f\u5217\u662f\u9012\u589e\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u4f1a\u9009\u62e9\u54ea\u4e00\u4e2a\u5462\uff1f\n\n\u663e\u7136\u9009\u62e9\u6700\u5927\u7684\u4e00\u4e2a $j$ \u662f\u6700\u4f18\u7684\uff0c\u8fd9\u6837\u5206\u7684\u6bb5\u6570\u4f1a\u5c3d\u53ef\u80fd\u5927\u3002\u5982\u679c\u9009\u62e9\u7684\u4e0d\u662f\u6700\u5927\u7684\u90a3\u4e2a $j$\uff08\u8bb0\u4e3a $j'$\uff09 \uff0c\u90a3\u4e48\u80af\u5b9a $j'$ \u524d\u9762\u80fd\u5206\u7684\u6bb5\u6570\u8981\u5927\u4e8e $j$ \u524d\u9762\u7684\u6bb5\u6570\u2014\u2014\u53ef\u662f\u6211\u4eec\u53ef\u4ee5\u548c $j'$ \u7684\u5206\u6cd5\u4e00\u6a21\u4e00\u6837\uff0c\u7136\u540e\u628a $(j',j]$ \u8fd9\u4e2a\u533a\u95f4\u76f4\u63a5\u5e76\u8fdb\u6700\u540e\u4e00\u6bb5\uff0c\u8fd9\u6837\u603b\u7684\u6bb5\u6570\u81f3\u5c11\u4e0d\u4f1a\u53d8\u52a3\uff1b\u7531\u4e8e $(j',j]$ \u5185\u53ef\u80fd\u53ef\u4ee5\u518d\u5206\uff0c\u56e0\u6b64\u53ef\u80fd\u66f4\u4f18\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u8bc1\u660e\u4e86\u8f6c\u79fb\u7b56\u7565\uff1a**\u6bcf\u6b21\u5fc5\u7136\u662f\u8f6c\u79fb\u5230\u80fd\u8f6c\u79fb\u5230\u7684\u6700\u9760\u540e\u7684\u70b9**\u3002\n\n\u65e2\u7136\u8f6c\u79fb\u662f\u552f\u4e00\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u81ea\u7136\u53ef\u4ee5\u8bb0\u4e0b\u5206\u5230 $i$ \u7684\u65f6\u5019\uff0c\u4ee5 $i$ \u7ed3\u5c3e\u7684\u8fd9\u4e00\u6bb5\u603b\u548c\u662f\u591a\u5c11\u2014\u2014\u8fd9\u4e2a\u662f\u552f\u4e00\u786e\u5b9a\u7684\uff0c\u8bb0\u4e3a $g(i)$\uff1b\u7ee7\u627f $f(i)$ \u7684\u5b9a\u4e49\uff0c\u540c\u65f6\u7701\u7565 $j$ \u8fd9\u4e00\u7ef4\uff0c\u8868\u793a\u7684\u5c31\u662f\u5230 $i$ \u4e3a\u6b62\u7684\u6700\u4f18\u89e3\uff0c\u5219\n\n$$f(i)=f(\\text{argmax}(j))+\\sum_{x=j}^i a_x$$\n\n\u5176\u4e2d $\\text{argmax}(j)$ \u8868\u793a\u7684\u662f $j$ \u80fd\u53d6\u7684\u6700\u5927\u503c\u3002\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u5230\u4e86 $\\mathcal{O(n^2)}$\uff0c\u53ef\u4ee5\u901a\u8fc7 $n\\le 5000$ \u7684\u6570\u636e\u3002\n\n### 3. \u6807\u89e3\u7b97\u6cd5\n\n#### 3.1 \u7b97\u6cd5\n\n\u4ece $64\\text{pts}$ \u7684\u505a\u6cd5\u5f00\u59cb\u8003\u8651\u3002\u6211\u4eec\u6bcf\u6b21\u90fd\u9700\u8981\u5411\u524d\u679a\u4e3e\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u80fd\u591f\u8f6c\u79fb\u7684 $j$ \uff0c\u8fd9\u4e2a\u770b\u8d77\u6765\u5f88\u53ef\u4f18\u5316\u7684\u6837\u5b50\u3002\n\n\u5982\u679c\u6709\u4e24\u4e2a\u4f4d\u7f6e $a,b$ \uff0c\u6ee1\u8db3$a>b$ \u4e14 $f(a)\\le f(b)$\uff0c\u8fd9\u8bf4\u660e $a$ \u79bb\u5f97\u66f4\u8fd1\uff0c\u5e76\u4e14\u8fde\u8d77\u6765\u7684\u4ee3\u4ef7\u8fd8\u66f4\u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u80af\u5b9a\u5c31\u4e0d\u4f1a\u9009 $b$ \u4e86\uff1b\u8fd9\u4e2a\u7ed3\u8bba\u751a\u81f3\u4e0e $i$ \u65e0\u5173\uff0c\u4e5f\u5c31\u662f\u4e00\u65e6\u51fa\u73b0\u4e86\u4e00\u4e2a\u8fd9\u6837\u7684 $a$ \uff0c\u90a3\u4e48\u8fd9\u4e2a $b$ \u5b83\u5c31\u88ab\u6c38\u8fdc\u5730\u629b\u5f03\u4e86\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u6700\u540e\u4f1a\u7559\u4e0b\u6765\u4e00\u4e32\u7684\u6570\uff0c\u5b83\u4eec\u4e00\u5b9a\u662f\u6ee1\u8db3\u82e5 $a>b$ \u5219 $f(a)>f(b)$ \uff0c\u6362\u8a00\u4e4b\u5b83\u4eec\u662f\u5355\u8c03\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u7528\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u6240\u6709\u53ef\u80fd\u7684\u8f6c\u79fb\u70b9\u3002\n\n\u7136\u540e\u6bcf\u6b21 $i$ \u5411\u53f3\u79fb\u7684\u65f6\u5019\u9700\u8981\u5224\u65ad\u961f\u9996\u662f\u4e0d\u662f\u5df2\u7ecf\u6ca1\u6709\u7b2c\u4e8c\u4e2a\u4f18\u4e86\uff0c\u5982\u679c\u662f\uff0c\u5f39\u51fa\u961f\u9996\u3002\u53cd\u590d\u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c\u3002\n\n\u6b64\u65f6\u6211\u4eec\u7684 $f(i)$ \u5c31\u662f\u7528\u961f\u9996\u6765\u66f4\u65b0\u7684\u3002\u7136\u540e\u5c1d\u8bd5\u52a0\u5165 $i$ \u8fd9\u4e2a\u51b3\u7b56\u70b9\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u539f\u6765\u7684\u961f\u5c3e\u662f\u4e0d\u662f\u8fd8\u4e0d\u5982 $i$ \u8fd9\u4e2a\u70b9\u4f18\uff0c\u5982\u679c\u662f\uff0c\u5f39\u51fa\u961f\u5c3e\u3002\u6700\u540e\u52a0\u5165 $i$\u3002\n\n\u8fd9\u6837\uff0c\u56e0\u4e3a\u5355\u8c03\u961f\u5217\u6bcf\u4e2a\u6570\u81f3\u591a\u8fdb\u961f\u4e00\u6b21\uff0c\u51fa\u961f\u4e00\u6b21\uff0c\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n)$ \u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u62ff\u5230 $88\\text{pts}$\u3002\n\n#### 3.2 \u4f18\u5316\n\n\u53ef\u662f\u60f3\u8981\u62ff\u5230 $100\\text{pts}$ \u53ef\u4e0d\u662f\u4e00\u4ef6\u5bb9\u6613\u7684\u4e8b\u60c5\u3002\n\n##### 3.2.1 \u8f93\u5165\n\n\u6839\u636e\u9898\u76ee\u7684\u8981\u6c42\uff0c\u6211\u4eec\u9700\u8981\u7528\u4e00\u4e9b\u5947\u602a\u7684\u65b9\u6cd5\u8f93\u5165\uff0c\u8fd9\u4e9b\u6309\u7167\u9898\u76ee\u7684\u610f\u601d\u8d70\u5373\u53ef\u2014\u2014**\u4f46\u662f**\uff0c\u5982\u679c\u76f4\u63a5\u5f00\u4e86`long long`\u4ee5\u8fbe\u5230\u7b97\u51fa $b_i$ \u7136\u540e\u518d\u53d6\u6a21\u5f97\u51fa $a_i$ \uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u8d85\u65f6\u2014\u2014**`long long`\u7684\u4e58\u6cd5\u4e0e\u53d6\u6a21\u8fd0\u7b97\u975e\u5e38\u6162\uff01**\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `unsigned int` \u6765\u5b58\u50a8\u8fd9\u4e9b\u6570\u5b57\u3002\u4f17\u6240\u5468\u77e5\uff0c`unsigned int` \u5728\u6ea2\u51fa\u7684\u65f6\u5019\u56de\u820d\u5f03\u9ad8\u4f4d\u800c\u4fdd\u7559\u4f4e\u4f4d\uff0c\u800c\u9898\u76ee\u7ed9\u51fa\u7684\u6a21\u6570\u662f $2^{30}$\u2014\u2014\u6070\u597d\u5c31\u662f\u4e8c\u8fdb\u5236\u4f4d\u4e0b\u7684\u540e $30$ \u4f4d\u3002\u4e8e\u662f\u6211\u4eec\u5927\u80c6\u5730\u8ba9\u5b83\u81ea\u7136\u6ea2\u51fa\uff0c\u7136\u540e\u53d6\u540e $30$ \u4f4d\u3002\u6548\u7387\u663e\u8457\u63d0\u9ad8\u3002\n\n**Tips: \u63a8\u8350\u4f7f\u7528`fread`\u5feb\u8bfb\u3002**\n\n##### 3.2.2 \u72b6\u6001\u5b58\u50a8\n\n\u9898\u76ee\u7ed9\u51fa\u7684\u6570\u636e\u8303\u56f4\u975e\u5e38\u5927\uff0c\u6700\u591a\u60c5\u51b5\u4e0b\u53ef\u80fd\u662f $(4\\times 10^{7}\\times 10^{9})^2=1.6\\times 10^{33}$\uff0c\u6b64\u65f6 $64$ \u4f4d\u6574\u6570\u65e0\u6cd5\u5b58\u4e0b\uff0c\u9700\u8981\u4f7f\u7528\u9ad8\u7cbe\u5ea6\uff08$4$\u4f4d`int`\uff09\u3002\n\n\u4f46\u662f\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u7a7a\u95f4\u4e0a\u76f4\u63a5\u4e58\u4e0a\u4e86 $4$ \u7684\u5e38\u6570\uff0c\u52a0\u4e4b $n=4\\times 10^7$ \uff0c\u5373\u4f7f\u662f $1\\text{G}$ \u7684\u5185\u5b58\u4e5f\u662f\u4e0d\u591f\u7528\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u7684 $f$ \u6570\u7ec4\u9700\u8981\u4f5c\u51fa\u6539\u53d8\uff1a\u6bcf\u6b21\u5b58\u5b83\u662f\u4ece\u54ea\u91cc\u8f6c\u79fb\u8fc7\u6765\u7684\u3002\u663e\u7136\u8f6c\u79fb\u70b9\u56fa\u5b9a\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a `int` \u5b58\u4e0b\u6240\u6709\u7684\u8f6c\u79fb\u4e86\u3002\n\n\u53ef\u662f\u8fd9\u6837\u6700\u540e\u7684\u7b54\u6848\u600e\u4e48\u8ba1\u7b97\uff1f\u6700\u540e\u4ece $n$ \u5012\u63a8\u56de\u53bb\u5373\u53ef\uff01\u53cd\u6b63\u524d\u7f00\u548c\u662f `long long`\u8303\u56f4\u7684\uff0c\u6700\u540e\u53ea\u8981\u5f00\u4e00\u4e2a\u9ad8\u7cbe\u5ea6\u6570\u5373\u53ef\u3002\u7a7a\u95f4\u7701\u4e0b\u6765\u4e86\uff01~~`fread`\u5feb\u8bfb\u7684\u7a7a\u95f4\u5f00\u5f97\u4e0b\u4e86\uff01~~\n\n##### 3.2.3 \u9ad8\u7cbe\u5ea6\u8ba1\u7b97\n\n\u4f60\u522b\u4ee5\u4e3a\u7701\u4e0b\u7a7a\u95f4\u5c31\u597d\u4e86\uff01\u9ad8\u7cbe\u5ea6\u53ef\u6162\u4e86\uff01\n\n\u60f3\u4e00\u60f3\u5e38\u6570\u90a3\u4e48\u5927\u7684\u4e58\u6cd5\u8fd0\u7b97\uff0c\u52a8\u4e0d\u52a8\u6a21\u4e00\u6a21\u9664\u4e00\u9664\uff0c\u4e24\u4e0b\u5b50\u5c31`Time Limit Exceeded`\u4e86\u3002\n\n\u90a3\u4e48\u5c31\u628a\u6a21\u8fd0\u7b97\u548c\u9664\u6cd5\u8fd0\u7b97\u53bb\u6389\u5427\uff01\n\n\u9996\u5148\uff0c\u5148\u628a\u9ad8\u7cbe\u5ea6\u6570\u7528 $2^{32}$ \u8fdb\u5236\u5b58\u50a8\uff0c\u7136\u540e\u6a21\u8fd0\u7b97\u5c31\u662f `a&0x7fffffff` \u6216\u662f\u5f3a\u5236\u8f6c\u6362 `unsigned int`\uff0c\u9664\u6cd5\u8fd0\u7b97\u5c31\u662f `a>>32`\u3002\n\n\u7136\u540e\u6b63\u5e38\u5730\u7b97\u9ad8\u7cbe\u5ea6\uff0c\u7531\u4e8e\u662f\u4f4d\u8fd0\u7b97\uff0c\u5feb\u5f97\u8d77\u98de\u3002\n\n\u7136\u540e\u6700\u540e\u8fd8\u539f\u4e00\u6b21\u7b54\u6848\uff0c\u8fd8\u539f\u6210 $10$ \u8fdb\u5236\u5373\u53ef\u3002\n\n-----\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u8fd9\u9053\u9898\u7684\u7edd\u5927\u591a\u6570\u95ee\u9898\uff0c\u5269\u4e0b\u7684\u5e38\u6570\u95ee\u9898\u5c31\u5404\u663e\u795e\u901a\u4e86\u3002\n\n\u4ee5\u4e0b\u4ee3\u7801\u53ef\u4ee5\u5728\u6d1b\u8c37\u7684\u8bc4\u6d4b\u673a\u4e0a\u8dd1\u8fdb1.2s\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <ctime>\nconst int MAXN=40000010;\nconst unsigned PMOD=(1<<30)-1;\nconst unsigned MOD=1e9;\n\nlong long _sum[MAXN],*sum=_sum+5,g[MAXN];\nint q[MAXN],f[MAXN];\nint p[100010],l[100010],r[100010];\n\nchar _B[1<<21],*_S=_B,*_T=_B;\n#define getchar() (_S==_T&&(_T=(_S=_B)+fread(_B,1,1<<21,stdin),_S==_T)?EOF:*_S++)\ninline int read(){\n\tregister int res=0;\n\tregister char ch=getchar();\n\twhile(ch<'0'||ch>'9')\n\t\tch=getchar();\n\twhile(ch>='0'&&ch<='9'){\n\t\tres=(res<<3)+(res<<1)+(ch&15);\n\t\tch=getchar();\n\t}\n\treturn res;\n}\n\nint main(){\n\tint n=read(),type=read();\n\tif(type==0){\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tint x=read();\n\t\t\tsum[i]=sum[i-1]+x;\n\t\t}\n\t}\n\telse{\n\t\tregister unsigned x,y,z,m;\n\t\tregister unsigned s1,s2,s3,pos=1;\n\t\tx=read();y=read();z=read();s1=read();s2=read();m=read();\n\t\tfor(register int i=1;i<=m;i++){\n\t\t\tregister unsigned p=read(),l=read(),r=read(),len=r-l+1;\n\t\t\tfor(;pos<=p;pos++){\n\t\t\t\tif(pos==1)\n\t\t\t\t\ts3=s1;\n\t\t\t\telse if(pos==2)\n\t\t\t\t\ts3=s2;\n\t\t\t\telse{\n\t\t\t\t\ts3=(x*s2+y*s1+z)&PMOD;\n\t\t\t\t\ts1=s2;s2=s3;\n\t\t\t\t}\n\t\t\t\tsum[pos]=sum[pos-1]+s3%len+l;\n\t\t\t}\n\t\t}\n\t}\n\tregister int *hd=q+1,*tl=q+1;\n\tfor(register int i=1;i<=n;i++){\n\t\twhile(hd<tl&&sum[*hd]+g[*hd]<=sum[i])\n\t\t\thd++;\n\t\tg[i]=sum[i]-sum[*(hd-1)];\n//\t\tf[i]=f[q[hd-1]]+g[i]*g[i];\n\t\tf[i]=*(hd-1);\n\t\twhile(hd<tl&&sum[*(tl-1)]+g[*(tl-1)]>=sum[i]+g[i])\n\t\t\ttl--;\n\t\t*tl++=i;\n\t}\n\tregister unsigned pos=n;\n\tregister unsigned long long ans[3]={0,0,0};\n\twhile(pos){\n\t\tregister unsigned long long tmp1=g[pos]&PMOD,tmp2=g[pos]>>30;\n\t\tans[2]+=tmp2*tmp2;\n\t\tans[1]+=tmp1*tmp2<<1;\n\t\tans[0]+=tmp1*tmp1;\n\t\tans[1]+=ans[0]>>30;ans[0]&=PMOD;\n\t\tans[2]+=ans[1]>>30;ans[1]&=PMOD;\n\t\tpos=f[pos];\n\t}\n\tregister unsigned long long tmp[4]={ans[2],0,0,0};\n\tfor(int i=1;~i;i--){\n\t\tfor(int j=0;j<=3;j++)\n\t\t\ttmp[j]<<=30;\n\t\ttmp[0]+=ans[i];\n\t\tfor(int j=0;j<=2;j++){\n\t\t\ttmp[j+1]+=tmp[j]/1000000000;\n\t\t\ttmp[j]%=1000000000;\n\t\t}\n\t}\n\tif(tmp[3])\n\t\tprintf(\"%llu%09llu%09llu%09llu\\n\",tmp[3],tmp[2],tmp[1],tmp[0]);\n\telse if(tmp[2])\n\t\tprintf(\"%llu%09llu%09llu\\n\",tmp[2],tmp[1],tmp[0]);\n\telse if(tmp[1])\n\t\tprintf(\"%llu%09llu\\n\",tmp[1],tmp[0]);\n\telse\n\t\tprintf(\"%llu\\n\",tmp[0]);\n\treturn 0;\n}\n```",
        "postTime": 1576325133,
        "uid": 23398,
        "name": "frankchenfu",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "\u8003\u573a\u4e0a\u8bfb\u5b8c\u9898\u611f\u89c9\u662fDP\u5c31\u76f4\u63a5\u6254\u4e86\u5f00T3\u4e86\uff0c\u8003\u5b8c\u624d\u53d1\u73b0\u90e8\u5206\u5206\u597d\u50cf\u4e0d\u96be\u62ff\uff0c\u67af\u4e86\n\n\u672c\u6587\u540c\u6b65\u53d1\u8868\u5728[\u6211\u7684blog](https://www.cnblogs.com/TEoS/p/11908728.html)\n\n------\n\n**\u9898\u610f\u5206\u6790**\n\n\u7ed9\u51fa\u4e00\u4e2a\u6570\u5217\uff0c\u8981\u6c42\u5c06\u5176\u5206\u6210\u51e0\u6bb5\uff0c\u4f7f\u6bcf\u6bb5\u7684\u548c\u975e\u4e25\u683c\u9012\u589e\uff0c\u6c42\u6700\u5c0f\u7684\u6bcf\u6bb5\u7684\u548c\u7684\u5e73\u65b9\u548c\u3002\n\n**\u601d\u8def\u5206\u6790**\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5206\u6210\u7684\u6bb5\u8d8a\u591a\uff0c\u5373\u5408\u5e76\u8d8a\u5c11\uff0c\u7b54\u6848\u8d8a\u5c0f\uff1b\u56e0\u6b64\u6211\u4eec\u5e0c\u671b\u6bcf\u6bb5\u7684\u548c\u90fd\u5c3d\u91cf\u5c0f\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8d2a\u5fc3\u7684\u601d\u60f3\u6765\u89e3\u9898\u3002\n\n~~\u4ee5\u4e0a\u53ea\u662f\u5408\u60c5\u63a8\u7406\uff0c\u5927\u5bb6\u770b\u7740\u5f00\u5fc3\u5c31\u597d\uff0c\u4e0d\u8fc7\u770b\u8d77\u6765\u4f3c\u4e4e\u6ca1\u4ec0\u4e48\u95ee\u9898~~\n\n\u8bbe$f_i$\u8868\u793a\u6570\u5217$[a_1,a_i]$\u6700\u540e\u4e00\u6bb5\u7684\u548c\u6700\u5c0f\u65f6\u6700\u540e\u4e00\u4e2a\u65ad\u70b9\uff08\u82e5\u9700\u8981\u6574\u6bb5\u5408\u5e76\uff0c\u5219\u4e3a0\uff09\u3002\u8fd9\u4e2a$f_i$\u9700\u8981\u5728\u4f7f\u5206\u6bb5\u6ee1\u8db3\u9898\u76ee\u8981\u6c42\u7684\u5355\u8c03\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u91cf\u5730\u5927\uff0c\u4e5f\u5c31\u662f\u4f7f\u6700\u540e\u4e00\u6bb5\u7684\u548c\u5c3d\u91cf\u5c0f\uff0c\u4ece\u800c\u4f7f\u6bcf\u6bb5\u7684\u548c\u90fd\u5c3d\u91cf\u5c0f\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u6bcf\u4e2a$i$\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u6700\u5927\u7684\u5408\u6cd5\u7684$f_i$\u3002\u6bcf\u6b21\u90fd\u904d\u5386\u4e00\u904d\u66b4\u529b\u67e5\u627e\uff0c\u590d\u6742\u5ea6$O(n^2)$\uff0c\u9884\u8ba1\u53ef\u4ee5\u5f97\u523064\u5206\u7684\u9ad8\u5206\u3002\n\n\u67e5\u627e\u65f6\u7528\u6570\u5217\u524d\u7f00\u548c\u6765\u6c42\u6bb5\u548c\uff0c\u8bbe$sum_i$\u8868\u793a$i$\u4f4d\u7f6e\u7684\u524d\u7f00\u548c\u3002\n\n\u901a\u8fc7\u5206\u6790\u6216\u8005\u624b\u73a9\u6837\u4f8b\u53ef\u4ee5\u53d1\u73b0\uff0c$f_i$\u4e00\u5b9a\u662f\u5355\u8c03\u4e0d\u964d\u7684\uff0c\u5e76\u4e14\u5224\u5b9a\u5408\u6cd5\u7684\u6761\u4ef6$sum_i-sum_j\\geq sum_j-sum_{f_j}$\uff0c\u53ef\u4ee5\u53d8\u5f62\u4e3a$sum_i\\geq sum_j+(sum_j-sum_{f_j})$\uff0c\u6839\u636e\u9898\u610f\uff0c$sum_j-sum_{f_j}$\u548c$sum_j$\u90fd\u5177\u6709\u5355\u8c03\u6027\u3002\u663e\u7136\uff0c\u8fd9\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u6765\u4f18\u5316\uff0c\u590d\u6742\u5ea6$O(n)$\u3002\n\n\u636e\u8bf4\uff0c\u4e3a\u4e86\u9632\u6b62\u88ab\u770b\u51fa\u53ef\u4ee5\u76f4\u63a5\u63a8\u51fa\u5206\u6bb5\u7136\u540e\u6c42\u89e3\u7b54\u6848\uff0c\u51fa\u9898\u4eba\u653e\u5f03\u4e86\u53d6\u6a21\u800c\u4f7f\u7528\u4e86\u9ad8\u7cbe\u3002~~\u7136\u800c\u6211\u592a\u61d2\uff0c~~\u672c\u6587\u7684\u4ee3\u7801\u76f4\u63a5\u7528int128\u5b9e\u73b0\u3002\u5f53\u7136\uff0c\u8003\u573a\u4e0a\u662f\u7528\u4e0d\u4e86int128\u7684\uff0c\u8fd8\u662f\u8981\u719f\u7ec3\u9ad8\u7cbe\u624d\u884c\u3002\n\n\u6ce8\u610f\u8981\u5c3d\u91cf\u4f18\u5316\u7a7a\u95f4\uff0c\u4e0d\u9700\u8981\u5b58\u50a8\u7684\u4fe1\u606f\u53ef\u4ee5\u4e0d\u7528\u5b58\u50a8\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u6b63\u89e3MLE\u7684\u60e8\u72b6\u3002\n\n```c++\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#define ll long long\n#define INT __int128\nusing namespace std;\nconst int N=4e7+100,P=1073741824;\nint n,type,head=1,tail=1,x,y,z,m,p,l,r;\nint f[N],q[N];\nll b1,b2,b3,w;\nll sum[N];\nINT ans;\nvoid in1()\n{\n\tscanf(\"%d%d%d%lld%lld%d\",&x,&y,&z,&b1,&b2,&m);\n\tint now=1;ll w;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%d%d%d\",&p,&l,&r);\n\t\twhile(now<=p)\n\t\t{\n\t\t\tif(now==1)\n\t\t\t\tw=(b1%(r-l+1))+l,sum[1]=w;\n\t\t\telse\n\t\t\t\tif(now==2)\n\t\t\t\t\tw=(b2%(r-l+1))+l,sum[2]=sum[1]+w;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tb3=(x*b2+y*b1+z)%P;\n\t\t\t\t\tw=(b3%(r-l+1))+l,sum[now]=sum[now-1]+w;\n\t\t\t\t\tb1=b2,b2=b3;\n\t\t\t\t}\n\t\t\tnow++;\n\t\t}\n\t}\n}//\u7279\u6b8a\u8f93\u5165\nvoid write(INT x)\n{\n    if(x>9) \n\t\twrite(x/10);\n    putchar(x%10+'0');\n}//int128\u4e0d\u80fd\u76f4\u63a5\u8f93\u51fa\nint main()\n{\n\tscanf(\"%d%d\",&n,&type);\n\tif(type)\n\t\tin1();\n\telse\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tscanf(\"%lld\",&w),sum[i]=sum[i-1]+w;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail && 2*sum[q[head+1]]-sum[f[q[head+1]]]<=sum[i])\n\t\t\thead++;//\u627e\u5230\u6700\u5927\u7684f[i]\n\t\tf[i]=q[head];\n\t\twhile(head<tail && 2*sum[q[tail]]-sum[f[q[tail]]]>=2*sum[i]-sum[q[head]])\n\t\t\ttail--;//\u7ef4\u62a4\u5355\u8c03\u6027\n\t\tq[++tail]=i;\n\t}\n\tint now=n;\n\twhile(now)\n\t{\n\t\tans+=(INT)(sum[now]-sum[f[now]])*(sum[now]-sum[f[now]]);\n\t\tnow=f[now];\n\t}//\u8ba1\u7b97\u7b54\u6848\n\twrite(ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1574345135,
        "uid": 91534,
        "name": "TEoS",
        "ccfLevel": 6,
        "title": "P5665 \u5212\u5206"
    },
    {
        "content": "\u554a\u554a\u554a\u7ec8\u4e8e\u4f1a\u6b63\u786e\u6027\u8bc1\u660e\u4e86\uff0c\u8d76\u7d27\u53d1\u7bc7\u9898\u89e3\u3002\n\n\u9996\u5148\u8bb2\u505a\u6cd5\n>\u8bbe$f[i]$\u4ee3\u8868\u8003\u86511\uff5ei\u7684\u5e8f\u5217\uff0c\u6700\u540e\u4e00\u6bb5\u7684\u548c\u6700\u5c0f\u662f\u591a\u5c11\u3002\n\n\u8f6c\u79fb\u663e\u7136$f[i]=\\displaystyle \\min^{s[i]-s[j]\u2265f[j]}_{j}{s[i]-s[j]}$\n\n\u8fd9\u91cc$s[i]$\u4ee3\u8868\u524di\u4e2a\u6570\u7684\u548c\n\n\u8003\u573a\u4e0a\u6211\u6709\u4e00\u4e2a\u5927\u80c6\u7684\u731c\u6d4b\uff0c\u4ece\u53f3\u5f80\u5de6\u6bcf\u6b21\u9009\u957f\u5ea6\u4e3a$f[i]$\u7684\u4e00\u6bb5\u4e00\u5b9a\u6700\u4f18\u3002\n\n\u5f53\u65f6\u4e0d\u4f1a\u8bc1\uff0c\u4f46\u662f\u5199\u4e86\u4e2adp\u8fc7\u4e86\u5927\u6837\u4f8b\u3002\n\n\u8003\u8651\u6b63\u786e\u6027\u8bc1\u660e\n\n//\u8bc1\u660e\u8fc7\u7a0b\u7e41\u7410\u4e14\u4e0d\u6613\u7406\u89e3\uff0c\u5982\u6709\u4e0d\u9002\u8bf7\u8df3\u8fc7\n\n\u8bbe$a_i$\u4ee3\u8868\u6309\u4e0a\u8ff0\u89e3\u6cd5\u9009\u51fa\u7684\u5012\u6570\u7b2ci\u6bb5\u7684\u548c\uff0c\u8003\u8651\u4e00\u4e2a\u4e0d\u540c\u7684\u89e3$b_i$.\n\n\u8bbe$a_i$\u7684\u524d\u7f00\u548c\u4e3a$s_i$\uff0c$b_i$\u7684\u524d\u7f00\u548c\u4e3a$t_i$\n\n\u7ed3\u8bba1\uff1a$s_i\u2264t_i$\n\n\u53ef\u4ee5\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\n\n1. $a_1$\u7684\u53f3\u7aef\u70b9\u4e0e$b_1$\u76f8\u540c\n\n2. \u5bf9\u4e8e\u4efb\u610f\u4e00\u6bb5$i$\uff0c\u82e5$a_i$\u7684\u53f3\u7aef\u70b9\u5927\u4e8e\u7b49\u4e8e$b_i$\uff0c\u5219$a_i$\u7684\u5de6\u7aef\u70b9\u5927\u4e8e\u7b49\u4e8e$b_i$\uff0c\u5373$a_i$ $_+$ $_1$\u7684\u53f3\u7aef\u70b9\u5927\u4e8e\u7b49\u4e8e$b_i$ $_+$ $_1$\n\n\u56e0\u6b64\u6211\u4eec\u4e00\u5b9a\u53ef\u4ee5\u627e\u51fa\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e$p$\uff0c\u4f7f\u5f97$a_p<b_p$\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u663e\u7136\u5b58\u5728\uff0c\u5426\u5219a\u4e0eb\u76f8\u540c\u3002\n\n\u53c8\u56e0\u4e3a$s_p$ $_-$ $_1$ $\u2264$ $t_p$ $_-$ $_1$\uff0c$a_p<b_p$\uff0c\u6240\u4ee5$s_p<t_p$\uff0c\u53c8\u56e0\u4e3a$\\sum{a_i}=\\sum{b_i}$ \u56e0\u6b64\u6211\u4eec\u4e5f\u4e00\u5b9a\u53ef\u4ee5\u627e\u5230\u7b2c\u4e00\u4e2a\u5728$p$\u4e4b\u540e\u7684\u4f4d\u7f6e$q$\uff0c\u4f7f\u5f97$a_q>b_q$\n\n\u6211\u4eec\u5c06$b_p$\u51cf\u4e00\uff0c$b_q$\u52a0\u4e00\uff0c\u7136\u540e\u91cd\u590d\u8be5\u64cd\u4f5c\u76f4\u5230a\u4e0eb\u76f8\u540c\n\n\u8003\u8651\u6bcf\u6b21\u64cd\u4f5c\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\n\n\u9996\u5148\u6211\u4eec\u53d1\u73b0$b_p>a_p\u2265a_q>b_q$\uff0c\u56e0\u6b64$b_p-b_q\u22652$\uff0c\u6211\u4eec\u5c06\u4e00\u4e2a\u5927\u7684\u6570\u51cf\u4e00\uff0c\u5c0f\u7684\u6570\u52a0\u4e00\uff0c\u6574\u4e2a\u5e8f\u5217\u7684\u5e73\u65b9\u548c\u4e00\u5b9a\u662f\u51cf\u5c0f\u7684\u3002\n\n\u5176\u6b21\u6613\u8bc1\u64cd\u4f5c\u8fc7\u540eb\u5e8f\u5217\u4f9d\u7136\u6ee1\u8db3\u5355\u8c03\u4e0d\u4e0a\u5347\u6027\u4ee5\u53ca$s_i\u2264t_i$\n\n\u56e0\u6b64\u6211\u4eec\u8bc1\u660e\u4e86\u4efb\u4f55\u4e00\u4e2a\u89e3\u7684\u5e8f\u5217$b_i$\u90fd\u53ef\u4ee5\u901a\u8fc7\u4e00\u7cfb\u5217\u4f7f\u5176\u5e73\u65b9\u548c\u51cf\u5c0f\u7684\u64cd\u4f5c\u5c06\u5176\u53d8\u6210$a_i$\uff0c\u5373$a_i$\u662f\u6700\u4f18\u89e3\u3002\n\n64\u5206\uff1a\u5bf9\u4e8e\u6bcf\u4e2ai\u66b4\u529b\u679a\u4e3ej  $O(n^2)$\n\n88\u5206\uff1a\u5c06$s[i]-s[j]\u2265f[j]$\u79fb\u9879\uff0c\u5f97$s[i]\u2265f[j]+s[j]$\uff0c \u5373\u5bf9\u4e8e\u6bcf\u4e2ai\uff0c\u6211\u4eec\u8981\u627e$f[j]+s[j]\u2264s[i]$\u7684\u6700\u5927\u7684j\uff0c\u6811\u72b6\u6570\u7ec4/\u7ebf\u6bb5\u6811\u7ef4\u62a4 $O(nlogn)$\n\n100\u5206\uff1a\u6211\u4eec\u53d1\u73b0$s[i]$\u5177\u6709\u5355\u8c03\u6027\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u7c7b\u4f3c\u5355\u8c03\u961f\u5217\u7684\u4e1c\u897f\u7ef4\u62a4$f[j]+s[j]$ $O(n)$\n\n66\u5206\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define N 1100000\n#define P 20031101\n#define ll long long\nusing namespace std;\nint n,a[N],t[N];\nll ans,f[N],s[N];\nint main(){\n    scanf(\"%d%*d\",&n);\n    for(int i=1;i<=n;i++) scanf(\"%d\",&a[i]),s[i]=s[i-1]+a[i];\n    for(int i=1;i<=n;i++){\n\tfor(int j=i-1;j>=0;j--){\n\t    if(s[i]-s[j]>=f[j]){\n\t\t\tf[i]=s[i]-s[j]; t[i]=j; break;\n\t    }\n\t}\n    }\n    for(int i=n;i;i=t[i]) ans+=1ll*f[i]*f[i];\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n\n```\n88\u5206\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define N 1100000\n#define P 20031101\n#define ll long long\n#define lb(x) (x&(-x))\nusing namespace std;\nint n,a[N],t[N],mx[N];\nll ans,f[N],s[N];\nvoid ins(int x,int v){ for(int i=x;i<=n;i+=lb(i)) mx[i]=max(mx[i],v);}\nint ask(int x){int res=0;for(int i=x;i;i-=lb(i)) res=max(res,mx[i]); return res;}\nint main(){\n    scanf(\"%d%*d\",&n);\n    for(int i=1;i<=n;i++) scanf(\"%d\",&a[i]),s[i]=s[i-1]+a[i];\n    for(int i=1;i<=n;i++){\n\tt[i]=ask(i); f[i]=s[i]-s[t[i]];\n\tins(lower_bound(s+1,s+n+1,f[i]+s[i])-s,i);\n    }\n    for(int i=n;i;i=t[i]) ans+=1ll*f[i]*f[i];\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```\n\n\n",
        "postTime": 1575281128,
        "uid": 118695,
        "name": "A2391833679",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "# Description\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5665)\n\n# Solution\n\n## \u7b97\u6cd51 12pts\n\n\u6307\u6570\u7b97\u6cd5\u968f\u4fbf\u4e71\u641e\u3002\n\n## \u7b97\u6cd52 36pts\n\n$O(n^3)$dp\u3002\n\n\u8bbe$f_{i,j}$\u8868\u793a\u4ee5\u4f4d\u7f6e$j$\u7ed3\u5c3e\uff0c\u4e0a\u4e00\u4e2a\u51b3\u7b56\u70b9\u4e3a$j$\u65f6\u7684\u6700\u5c0f\u503c\u3002\n\n\u8f6c\u79fb\u4e5f\u662f\u663e\u800c\u6613\u89c1\u7684\uff1a\n\n\u4ee4 $s_i=\\sum \\limits_{j=1}^{i} a_j$\uff0c\u5373\u524d\u7f00\u548c\u3002\n\n\u5219 \n\n$f_{i,j}=f_{j,k}+(s_i-s_j)^2$\uff0c\u5176\u4e2d $s_i-s_j \\ge s_j-s_k$$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\n\ninline ll ty() {\n\tchar ch = getchar(); ll x = 0, f = 1;\n\twhile (ch < '0' || ch > '9') { if (ch == '-') f = -1; ch = getchar(); }\n\twhile (ch >= '0' && ch <= '9') { x = x * 10 + ch - '0'; ch = getchar(); }\n\treturn x * f;\n}\n\nconst int _ = 5000 + 10;\nint n, type;\nll A[_], sum[_], f[_][_], ans;\n\ninline ll _2(ll x) { return x * x; }\n\nint main() {\n\tn = ty(), type = ty();\n\tfor (int i = 1; i <= n; ++i) {\n\t\tA[i] = ty();\n\t\tsum[i] = sum[i - 1] + A[i];\n\t\t// cout << sum[i] << endl;\n\t}\n\tmemset(f, 0x3f, sizeof(f));\n\tans = f[0][0];\n\tfor (int i = 1; i <= n; ++i) {\n\t\tfor (int j = 1; j <= i; ++j) {\n\t\t\tif (j == 1) f[i][j] = _2(sum[i]);\n\t\t\telse\n\t\t\t\tfor (int k = 1; k < j; ++k)\n\t\t\t\t\tif (sum[i] - sum[j - 1] >= sum[j - 1] - sum[k - 1])\n\t\t\t\t\t\tf[i][j] = min(f[i][j], f[j - 1][k] + _2(sum[i] - sum[j - 1]));\n\t\t}\n\t}\n\t\n\tfor (int i = 1; i <= n; ++i) ans = min(ans, f[n][i]);\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n\n## \u7b97\u6cd53 64pts\n\n$O(n^2)$dp\u3002\u8fd9\u4e2a\u56e0\u4e3a\u6211\u592a\u84bb\u4e86\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5199\u3002\u5927\u6982\u601d\u8def\u5c31\u662f\n\n\u201c\u53ef\u4ee5\u56fa\u5b9a$j$\uff0c\u53d1\u73b0\u5728\u79fb\u52a8$i$\u7684\u8fc7\u7a0b\u4e2d\uff0c$k$\u4e5f\u5728\u79fb\u52a8\uff0c\u6ee1\u8db3\u4e00\u4e2a\u5355\u8c03\u6027\uff0c\u7136\u540e\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a$f_{j,k}$\u7684\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\u4e86\u201d\n\n## \u7b97\u6cd54 84/100pts\n\n~~\u636e\u8bf4\u901a\u8fc7\u6253\u8868\u53ef\u4ee5\u53d1\u73b0~~\uff0c[\u8bc1\u660e\u94fe\u63a5](http://matthew99.blog.uoj.ac/blog/5299)\uff0c\u5f53\u6700\u540e\u4e00\u6bb5\u5728**\u6ee1\u8db3\u6709\u89e3**\u7684\u60c5\u51b5\u4e0b\u548c\u6700\u5c0f\u65f6\uff0c\u7b54\u6848\u6700\u4f18\u3002\n\n\u56e0\u6b64\u53ef\u4ee5\u8bbe$g_i$\u8868\u793a\u5230\u4f4d\u7f6e$i$\u65f6\uff0c\u5728\u6709\u89e3\u7684\u60c5\u51b5\u4e0b\u503c\u6700\u5c0f\u7684\u4e0a\u4e00\u4e2a\u51b3\u7b56\u70b9\u7684\u4f4d\u7f6e\uff0c\u5373\n\n$$g_i = \\max \\limits_{j=0}^{i-1}j, s.t. s_i-s_j \\ge s_j-s_{g_j}$$\n\n\u7a0d\u5fae\u79fb\u4e2a\u9879\u5c31\u53ef\u4ee5\u5f97\u5230\n\n$$s_i \\ge 2s_j-s_{g_j}$$\n\n\u663e\u7136\u8fd9\u662f\u5355\u8c03\u7684\uff0c\u4e8e\u662f\u7528\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5373\u53ef\u3002\n\n**Code**\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ninline int ty() {\n\tchar ch = getchar(); int x = 0, f = 1;\n\twhile (ch < '0' || ch > '9') { if (ch == '-') f = -1; ch = getchar(); }\n\twhile (ch >= '0' && ch <= '9') { x = x * 10 + ch - '0'; ch = getchar(); }\n\treturn x * f;\n}\n\ntypedef long long ll;\nconst int _ = 5e5 + 10;\nint n, type, a[_], q[_], g[_];\nll sum[_], ans;\n\ninline ll calc(int j) { return 2ll * sum[j] - sum[g[j]]; }\ninline ll _2(const ll &x) { return x * x; }\n\nint main() {\n#ifndef ONLINE_JUDGE\n\tfreopen(\"divide.in\", \"r\", stdin);\n\tfreopen(\"divide.out\", \"w\", stdout);\n#endif\n\tn = ty(), type = ty();\n\tfor (int i = 1; i <= n; ++i) a[i] = ty(), sum[i] = sum[i - 1] + a[i];\n\tint h = 1, t = 1;\n\tfor (int i = 1; i <= n; ++i) {\n\t\twhile (h < t && calc(q[h + 1]) <= sum[i]) ++h;\n\t\tg[i] = q[h];\n\t\twhile (h < t && calc(q[t]) >= calc(i)) --t;\n\t\tq[++t] = i;\n\t}\n\tint now = n;\n\twhile (now) {\n\t\tans = ans + _2(sum[now] - sum[g[now]]);\n\t\tnow = g[now];\n\t}\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1576319321,
        "uid": 49777,
        "name": "kkkstra",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u53d1\u73b0\uff0c\u67d0\u4e2a\u70b9\u7684\u6700\u4f18\u51b3\u7b56\u4e00\u5b9a\u662f\u4ece\u4e0a\u4e00\u4e2a\u5408\u6cd5\u7684\u6700\u4f18\u51b3\u7b56\u8f6c\u79fb\u8fc7\u6765\u7684\u3002\n\n\u7136\u540e\u8fd9\u4e2a\u8fc7\u7a0b\u663e\u7136\u53ef\u4ee5\u5355\u8c03\u961f\u5217\u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n)$\u3002\n\n```cpp\nconst int N = 4e7 + 7;\nint n, o, a[N], p[N], q[N], l, r;\nll s[N];\n__int128 ans;\n\nnamespace GET {\n\tconst int M = 1e5 + 7, P = (1 << 30) - 1;\n\tint x, y, z, b[N], m, p[M], l[M], r[M];\n\tinline void get() {\n\t\trd(x), rd(y), rd(z), rd(b[1]), rd(b[2]), rd(m);\n\t\tfor (int i = 3; i <= n; i++) b[i] = (1ll * x * b[i-1] + 1ll * y * b[i-2] + z) & P;\n\t\tfor (int j = 1; j <= m; j++) {\n\t\t\trd(p[j]), rd(l[j]), rd(r[j]);\n\t\t\tfor (int i = p[j-1] + 1; i <= p[j]; i++)\n\t\t\t\ta[i] = b[i] % (r[j] - l[j] + 1) + l[j];\n\t\t}\n\t}\n}\n\ninline ll calc(int x) {\n\treturn s[x] * 2 - s[p[x]];\n}\n\nint main() {\n\trd(n), rd(o);\n\tif (o) GET::get();\n\telse for (int i = 1; i <= n; i++) rd(a[i]);\n\tfor (int i = 1; i <= n; i++) {\n\t\ts[i] = s[i-1] + a[i];\n\t\twhile (l < r && calc(q[l+1]) <= s[i]) ++l;\n\t\tp[i] = q[l];\n\t\twhile (l <= r && calc(q[r]) >= calc(i)) --r;\n\t\tq[++r] = i;\n\t}\n\twhile (n) ans += (__int128)(s[n] - s[p[n]]) * (s[n] - s[p[n]]), n = p[n];\n\tprint(ans);\n\treturn 0;\n}\n```",
        "postTime": 1575126479,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u4e3a\u5927\u5bb6\u5e26\u6765\u975e\u5e38\u6709\u5fc3\u8def\u5386\u7a0b\u7684\u4e00\u7bc7\u9898\u89e3\uff0c\u7528\u6765\u7f05\u6000\u5df2\u7ecf\u8003\u6302\u7684CSP-S 2019\uff0c\u5e76\u4e14\u5c06\u8be6\u7ec6\u5730\u8bf4\u4e00\u4e0b\u60f3\u51fa\u6b63\u89e3\u7684\u8fc7\u7a0bemmm\n\n\u539f\u9898\u4f20\u9001\u95e8\uff1a[P5665 \u5212\u5206](https://www.luogu.org/problem/P5665)\n\n\u8fd9\u9053\u9898~~\u5f88\u660e\u663e~~\u544a\u8bc9\u6211\u4eec\u9700\u8981\u5728\u7ed9\u5b9a\u7684\u957f\u5ea6\u4e3an\u7684\u6570\u7ec4\u4e2d\uff0c\u5212\u5206\u51fa\u4efb\u610f\u6bb5\u8fde\u7eed\u4e0d\u91cd\u5408\u7684\u5143\u7d20\uff0c\u5e76\u4f7f\u6bcf\u4e00\u6bb5\u5143\u7d20\u4e4b\u548c\u5927\u4e8e\u7b49\u4e8e\u524d\u4e00\u6bb5\u5143\u7d20\u4e4b\u548c\uff0c\u6700\u540e\u5bf9\u6bcf\u4e00\u6bb5\u5143\u7d20\u548c\u5206\u522b\u5e73\u65b9\uff0c\u518d\u6c42\u548c\u3002\n\n\u5bf9\u4e8e\u524d60%\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u51faO\uff08n\u00b2\uff09\u7684\u7b97\u6cd5\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\uff0c\u90a3\u4e48\u5f00\u59cb\u601d\u8003\u8fd9\u4e00\u90e8\u5206\u5206\u7684\u7b97\u6cd5\u3002  \n\n\u6211\u4eec\u7528dp[i] (1 <= i <= n)\u6765\u8868\u793a\u4ece1\u53f7\u5143\u7d20\u4e00\u76f4\u5230\u7b2ci\u53f7\u5143\u7d20\u7684\u6700\u4f18\u89e3\uff0c\u4e0d\u8bba\u5212\u5206\u6210\u51e0\u6bb5\u3002\u518d\u7528a[i]\u8868\u793a\u4ece1\u5230i\u7684\u5143\u7d20\u524d\u7f00\u548c\u3002  \n\n\u90a3\u4e48dp[i]\u4e00\u5b9a\u7b49\u4e8ea[1] * a[1]  \n\u5982\u679cdp[i] (i > 1)\u662f\u6700\u4f18\u89e3\u7684\u8bdd\uff0c\u90a3\u4e48\u4e00\u5b9a\u5b58\u5728\u4ece\u67d0\u4e00\u4e2adp[j] (1 <= j < i)\u8f6c\u79fb\u8fc7\u6765\uff0c\u4e5f\u5c31\u662fdp[i] = dp[j] + (a[i] - a[j])\u00b2  \n\u90a3\u4e4860\u5206\u7684\u505a\u6cd5\u5c31\u6709\u4e86\uff0c\u4ece1\u5faa\u73af\u81f3n\uff08\u53d8\u91cf\u4e3ai\uff0c\u610f\u4e3a\u8ba1\u7b97\u81f31\u81f3i\u7684\u6700\u4f18\u89e3\uff09\uff0c\u518d\u5728\u6bcf\u4e00\u5c42\u5faa\u73af\u4e2d\u518d\u4ece0\u5faa\u73af\u81f3i-1\uff0c\uff08\u53d8\u91cf\u4e3aj\uff0c\u610f\u4e3a\u5bf9\u4e8e\u5c0f\u4e8ei\u7684\u6bcf\u4e00\u4e2aj\uff0c\u66b4\u529b\u5224\u65ad\u6700\u4f18\u89e3\uff09\n\n60\u5206\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,type;\nlong long a[500005],cnt,dp[500005],lastt[500005],ans,maxx=9223372036854775807,temp;\nint main(){\n//\tfreopen(\"partition.in\",\"r\",stdin);\n//\tfreopen(\"partition.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&type);\n\tif(type==1){\n\t\tprintf(\"0\\n\");\n\t\treturn 0;\n\t}\n\tfor(register int i=1;i<=n;++i){\n\t\tscanf(\"%lld\",&a[i]);\n\t}\n\tfor(register int i=1;i<=n;++i)dp[i]=maxx;\n\tdp[1]=a[1]*a[1],lastt[1]=a[1]*a[1];\n\tfor(register int i=1;i<=n;++i)a[i]+=a[i-1];\n\tfor(register int i=2;i<=n;++i){\n\t\tfor(register int j=0;j<i;++j){\n\t\t\ttemp=(a[i]-a[j])*(a[i]-a[j]); \n\t\t\tif(temp>=lastt[j]){\n\t\t\t\tif(dp[i]>dp[j]+temp){\n\t\t\t\t\tdp[i]=dp[j]+temp,lastt[i]=temp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",dp[n]);\n\treturn 0;\n}\n```\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8ba8\u8bba\u6ee1\u5206\u7684\u505a\u6cd5\uff0c\u65e2\u7136\u5df2\u7ecf\u6709\u4e86O\uff08n\u00b2\uff09\u7684DP\u505a\u6cd5\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4f18\u5316\uff0c\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\u4e86\u5185\u5c42\u5faa\u73af\u662f\u66b4\u529b\u5224\u65ad\uff0c\u90a3\u4e48\u5c06\u8fd9\u5c42\u5faa\u73af\u4f18\u5316\u6389\u5c31\u662f\u6211\u4eec\u7684\u76ee\u6807\u3002\n\n\u8fd9\u4e00\u56de\u6211\u4eec\u5c06dp[i] \u91cd\u65b0\u5b9a\u4e49\uff0c\u5c06\u5176\u8868\u793a\u4e3a\u5728\u524di\u7684\u5143\u7d20\u5e8f\u5217\u6700\u4f18\u89e3\u65f6\uff0c\u4ee5i\u4e3a\u6700\u540e\u4e00\u6bb5\u4e3a\u7ed3\u5c3e\u65f6\uff0cdp[i] \u5c31\u662f\u5012\u6570\u7b2c\u4e8c\u6bb5\u7684\u7ed3\u5c3e\u3002\n\n![\u793a\u4f8b\u56fe](https://cdn.luogu.com.cn/upload/image_hosting/iapp3iry.png)\n\n\u770b\u4e00\u4e0b\u4e0a\u9762\u8fd9\u5f20\u56fe\uff0c\u5982\u679c\u5b58\u5728a[i] - a[dp[i]] > a[k] - a[i]\uff0c\u90a3\u4e48\u662f\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u4fdd\u5b58\u4e0b\u6765\u3002\n\n\u518d\u60f3\u4e00\u4e0b\uff0c\u5373\u4f7fa[i] - a[dp[i]] > a[k] - a[i]\uff0c\u90a3\u4e48\u8bf4\u4e0d\u5b9a\u5728\u4e0d\u4e45\u7684\u5c06\u6765\u4e5f\u4f1a\u6ee1\u8db3\uff0c\u4e5f\u53ef\u80fd\u4e0d\u6ee1\u8db3\u3002\n\n\u4f46\u5982\u679c \u5728\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0ca[i] - a[dp[i]] -\uff08a[k] - a[i]\uff09\u8868\u793a\u4ee5i\u4e3a\u7ed3\u5c3e\u7684\u6700\u4f18\u89e3\u5728\u540e\u65b9\u6709k\u65f6\uff0c\u6ee1\u8db3\u6761\u4ef6\u8fd8\u9700\u8981\u591a\u5c11\uff0c\u540c\u7406\uff0ca[j] - a[dp[j]] -\uff08a[k] - a[j]\uff09\u8868\u793a\u4ee5j\u4e3a\u7ed3\u5c3e\u7684\u6700\u4f18\u89e3\u5728\u540e\u65b9\u6709k\u65f6\uff0c\u6ee1\u8db3\u6761\u4ef6\u8fd8\u9700\u8981\u591a\u5c11\u3002\n\n\u90a3\u4e48\u5f88\u660e\u663e\uff0c\u5f53\u8fd9\u4e2a\u503c\u5c0f\u4e8e\u7b49\u4e8e0\u65f6\uff0c\u662f\u6ee1\u8db3\u6761\u4ef6\u7684\uff0c\u5f53i\u4e0ej\u90fd\u4e0d\u6ee1\u8db3\u6761\u4ef6\u65f6\uff0c\u5982\u679ca[i] - a[dp[i]] -\uff08a[k] - a[i]\uff09< a[j] - a[dp[j]] -\uff08a[k] - a[j]\uff09\u65f6\uff0c\u8bf4\u660ei\u5728\u4e0d\u4e45\u7684\u5c06\u6765\uff0c\u4f1a\u66f4\u5148\u4e00\u6b65\u627e\u5230\u6ee1\u8db3\u6761\u4ef6\u7684k\uff0c\u90a3\u4e48j < i\u5e76\u4e14\u5408\u4e4e\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\uff0c\u90a3\u4e48i\u4e00\u5b9a\u6bd4j\u66f4\u4f18\uff0cj\u5c31\u6ca1\u7528\u4e86\u3002\n\n _\u4e00\u4e2a\u4eba\u6bd4\u4f60\u5e74\u8f7b\uff0c\u8fd8\u6bd4\u4f60\u5f3a\uff0c\u90a3\u4f60\u5c31\u5b8c\u86cb\u4e86\u3002\u2014\u2014\u67d0\u5b66\u957f_\n \n \u60f3\u5230\u4e86\u4ec0\u4e48\uff1f\u6ca1\u9519\uff0c\u5355\u8c03\u961f\u5217\u3002\n \n \u90a3\u4e48\u63a5\u4e0b\u6765\u8003\u8651\u6ee1\u8db3\u6761\u4ef6\u7684\u60c5\u51b5\uff0c\u5982\u4e0a\u56fe\uff0c\u56e0\u4e3aa[k] - a[i] < a[k] - a[j]\uff0c\u90a3\u4e48i\u4e00\u5b9a\u6bd4j\u4f18\uff0cj\u53c8\u4e00\u6b21\u6ca1\u7528\u4e86\uff0c\u4e22\u6389\u5c31\u53ef\u4ee5\uff0c\u4f7f\u961f\u5217\u4e2d\u53ea\u5269\u4e0b\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\uff0c\u90a3\u4e48k\u5c31\u4ece\u6700\u65b0\u51fa\u961f\u5934\u7684\u5143\u7d20\u8f6c\u79fb\u3002\n \n \u9ad8\u7cbe\u5ea6\u6211\u5199\u7684\u4e0d\u600e\u4e48\u597d\uff0c\u4ec1\u8005\u89c1\u4ec1\u667a\u8005\u89c1\u667a\u4e86\uff0c\u4e0d\u559c\u52ff\u55b7\u3002\n \u5177\u4f53\u5b9e\u73b0\u5982\u4e0b\uff1a\n ```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,type,tail,dp[40000005],que[40000005],pointt,head;\nlong long mul[9],ans[6],P=100000000,MOD=1073741824,x,y,z,b1,b2,b3,a[40000005],p[100005],l[100005],r[100005];\nvoid res(int step,long long X){\n\tans[step]+=X;\n\twhile(ans[step]>=P){\n\t\tres(step+1,ans[step]/P);\n\t\tans[step]%=P;\n\t}\n}\nvoid add(long long X){\n\tlong long a=X/P,b=X%P;\n\tres(1,b*b);res(2,a*b*2);res(3,a*a);\n}\nint main(){\n//\tfreopen(\"partition.in\",\"r\",stdin);\n//\tfreopen(\"partition.out\",\"w\",stdout);\n\tmul[1]=1;\n\tfor(register int i=2;i<=8;++i){\n\t\tmul[i]=mul[i-1]*10;\n\t}\n\tscanf(\"%d%d\",&n,&type);\n\tif(type==1){\n\t\tscanf(\"%lld%lld%lld%lld%lld%d\",&x,&y,&z,&b1,&b2,&m);\n\t\tfor(register int i=1;i<=m;++i){\n\t\t\tscanf(\"%lld%lld%lld\",&p[i],&l[i],&r[i]);\n\t\t\tr[i]=r[i]-l[i]+1;\n\t\t}\n\t\tint temp=1;\n\t\tfor(register int i=1;i<=n;++i){\n\t\t\twhile(i>p[temp])++temp;\n\t\t\ta[i]=b1%r[temp]+l[temp];\n\t\t\tb3=(x*b2+y*b1+z)%MOD;\n\t\t\tb1=b2,b2=b3;\n\t\t}\n\t}\n\telse for(register int i=1;i<=n;++i)scanf(\"%lld\",&a[i]);\n\thead=1,tail=1;\n\tfor(register int i=1;i<=n;++i)a[i]+=a[i-1];\n\tfor(register int i=1;i<=n;++i){\n\t\twhile(head<=tail&&a[i-1]-a[dp[i-1]]-(a[i]-a[i-1])<=a[que[tail]]-a[dp[que[tail]]]-(a[i]-a[que[tail]]))--tail;\n\t\tque[++tail]=i-1;\n\t\twhile(head<=tail&&a[que[head]]+a[que[head]]-a[dp[que[head]]]<=a[i])++head;\n\t\tdp[i]=que[head-1];\n\t}\n\tpointt=n;\n\twhile(pointt>0){\n\t\tadd(a[pointt]-a[dp[pointt]]);\n\t\tpointt=dp[pointt];\n\t}\n\tint pas=0;\n\tfor(register int i=5;i>=1;--i){\n\t\tif(ans[i]>0&&!pas){\n\t\t\tprintf(\"%lld\",ans[i]);\n\t\t\tpas=1;\n\t\t}\n\t\telse if(ans[i]>0){\n\t\t\tfor(register int j=1;j<=8;++j){\n\t\t\t\tprintf(\"%lld\",ans[i]/mul[8-j+1]);\n\t\t\t\tans[i]%=mul[8-j+1];\n\t\t\t}\n\t\t}\n\t\telse if(ans[i]==0&&pas){\n\t\t\tprintf(\"00000000\");\n\t\t}\n\t}\n\tif(!pas)printf(\"0\\n\");\n\treturn 0;\n}\n```\n",
        "postTime": 1574237301,
        "uid": 85514,
        "name": "\u4e07\u4e07\u6ca1\u60f3\u5230",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P5665 \u5212\u5206"
    },
    {
        "content": "### $\\text{D2T2}$ \u5212\u5206\n\n##### $\\text{Description}$\n\n\u7ed9\u5b9a $\\{a_n\\}$\uff0c\u6c42\u4e00\u4e2a\u5bf9 $\\{a_n\\}$ \u7684\u5212\u5206\u65b9\u5f0f\uff0c\u4f7f\u5f97\u6bcf\u4e00\u6bb5\u7684\u548c\u7684\u5e73\u65b9\u548c\u6700\u5c0f\u3002\n\n##### $\\text{Solution}$\n\n\u8003\u8651\u4e00\u4e2a\u52a8\u6001\u89c4\u5212\uff0c\u6211\u4eec\u9700\u8981\u524d\u4e00\u6bb5\u7684\u548c\u4e0e\u5f53\u524d\u6700\u5c0f\u503c\uff0c\u5148\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c $s_i=\\sum_{j=1}^{i}a_j$\uff0c\u6240\u4ee5\u4ee4 $f_{i,j}$ \u8868\u793a\u6700\u540e\u4e00\u6bb5\u662f $(j,i]$ \u7684\u6700\u5c0f\u503c\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$f_{i,j}=\\min_{0\\le k<j,s_i-s_j\\ge s_j-s_k}\\{f_{j,k}+(s_i-s_j)^2\\}$$\n\n\u8fd9\u4e2a\u590d\u6742\u5ea6\u662f $O(n^3)$ \u7684\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u6b63\u6574\u6570\u5e8f\u5217 $\\{a_n\\}$\uff0c\u6709 $(\\sum_{i=1}^na_i)^2>\\sum_{i=1}^na_n^2$\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u5c3d\u91cf\u591a\u5206\u6bb5\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ee4 $g_i$ \u8868\u793a\u5c06 $[1,i]$ \u6309\u6700\u4f18\u65b9\u6848\u5212\u5206\u540e\uff0c\u6700\u540e\u4e00\u6bb5 $(j,i]$ \u7684 $j$\uff0c\u6211\u4eec\u6709\uff1a\n\n$$g_i=\\max_{s_i-s_j\\ge s_j-s_{g_j}}\\{j\\}$$\n\n\u4e8e\u662f\u6709\u4e86\u4e2a $O(n^2)$ \u7684\u505a\u6cd5\u3002\n\n\u6574\u7406\u4e0b\u4e0b\u6807\u91cc\u7684\u4e0d\u7b49\u5f0f\uff0c\u6709 $2s_j-s_{g_j}\\le s_i$\u3002\n\n\u4ee4 $w(i)=2s_i-s_{g_i}$\uff0c\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u6c42\uff1a\n\n$$g_i=\\max_{w(j)\\le s_i}\\{j\\}$$\n\n\u8003\u8651\u5bf9\u4e8e $i$ \uff0c\u6709 $x<y,w(x)\\le s_i,w(y)\\le s_i$\uff0c\u5219\u6211\u4eec\u80af\u5b9a\u9009\u53d6 $y$\u3002\u53c8\u56e0\u4e3a $s_i$ \u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6545 $x$ \u4e4b\u540e\u80af\u5b9a\u4e5f\u4e0d\u5982 $y$ \uff0c\u4ece\u800c\u60f3\u5230\u7ef4\u62a4\u4e00\u4e2a\u961f\u5185\u5143\u7d20\u6309 $w$ \u5355\u8c03\u9012\u51cf\u7684\u5355\u8c03\u961f\u5217\uff0c\u6bcf\u6b21\u5148\u5c06\u961f\u5934\u540e\u7684 $w$ \u6bd4 $s_i$ \u5c0f\u6216\u7b49\u7684\u5143\u7d20\u5220\u9664\uff0c\u4e4b\u540e\u53d6\u51fa\u961f\u5934\u4f5c\u4e3a\u6700\u4f18\u51b3\u7b56\uff0c\u7136\u540e\u5c06\u961f\u5c3e\u7684 $w$ \u5927\u4e8e\u7b49\u4e8e\u5f53\u524d\u7684 $w$  \u7684\u5220\u9664\uff0c\u6700\u540e\u63d2\u5165\u5f53\u524d\u5143\u7d20\u3002\n\n\u5173\u4e8e\u540e\u4e09\u4e2a\u70b9\u7684\u9ad8\u7cbe\uff0c\u5728 $\\text{OJ}$ \u4e0a\u53ef\u4ee5\u7528 $\\text{int128}$ \u4ee3\u66ff\u3002\u7136\u540e\u5361\u5e38\u5c31\u7528\u7528 $\\text{fread}$\uff0c\u7384\u5b66\u8c03 $\\text{Buf}$ \u6570\u7ec4\u957f\u5ea6\u5c31\u53ef\u4ee5\u3002\n\n##### $\\text{Code}$\n\n```cpp\n#include<bits/stdc++.h>\n#define REG register\n#define LL long long\n#define IL __int128\n#define MAXN 40000005\n#define MOD 1073741824\nusing namespace std;\nchar buf[1<<17],*p1=buf,*p2=buf;\n#define mgetc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<13,stdin),p1==p2)?EOF:*(p1++))\ninline LL read(){\n    REG LL x(0);\n    static char c=mgetc();\n    while(!isdigit(c)) c=mgetc();\n    while(isdigit(c)) x=(x*10)+(c^48),c=mgetc();\n    return x;\n}\n\nint n;\nLL s[MAXN];int b[MAXN];\nint g[MAXN];\nLL Que[MAXN];\nint head,tail;\nIL ans=0;\n\ninline void Print(IL x){\n    int st[51]={},top=0;\n    while(x) st[++top]=x%10,x/=10;\n    for(REG int i=top;i>=1;--i) putchar(st[i]+48);\n}\n\ninline void Input(int type){\n    if(type){\n        int x=read(),y=read(),z=read();b[1]=read(),b[2]=read();int m=read();\n        int lstp=0;\n        for(REG int i=1;i<=m;++i){\n            LL p=read(),l=read(),r=read();\n            for(REG int j=lstp+1;j<=p;++j){\n                if(!b[j]) b[j]=(((LL)x*b[j-1]%MOD+(LL)y*b[j-2]%MOD)%MOD+z)%MOD;\n                s[j]=s[j-1]+(LL)b[j]%(r-l+1)+l;\n            }\n            lstp=p;\n        }\n    }\n    else \n        for(REG int i=1;i<=n;++i) s[i]=s[i-1]+read();\n}\n\ninline LL W(int pos){return 2*s[pos]-s[g[pos]];}\ninline IL Work(){\n    head=tail=0;\n    for(REG int i=1;i<=n;++i){\n        while(head<tail&&W(Que[head+1])<=s[i]) ++head;\n        g[i]=Que[head];\n        while(head<tail&&W(Que[tail])>=W(i)) --tail;\n        Que[++tail]=i;\n    }\n    IL ans=0;\n    int now=n;\n    while(now){\n//        printf(\" Debuging , Now : %d , G[now] : %d \\n\",now,g[now]);x    \n        IL tmp=(s[now]-s[g[now]]);\n        tmp=tmp*tmp;\n        ans=ans+tmp;\n        now=g[now];\n    }\n    return ans;\n}\n\nint main(){\n    n=read();\n    Input(read());\n    Print(Work());\n}\n```",
        "postTime": 1578321100,
        "uid": 83547,
        "name": "LCuter",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3011"
    },
    {
        "content": "# P5665\n## \u9898\u610f\n\u4e00\u5806\u6570\uff0c\u8981\u6c42\u4f60\u8fdb\u884c\u5212\u5206\uff0c\u5212\u5206\u51fa\u7684\u6570\u5217\u4e00\u5b9a\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u7136\u540e\u5c06\u4ed6\u4eec\u7684\u5e73\u65b9\u548c\u6c42\u51fa\uff0c\u6c42\u6700\u5c0f\u503c\n## \u601d\u8def\n\u5148\u6765\u8bf4\u4e00\u4e0b\u6211\u7684\u8003\u573a\u601d\u8def\n\n\u4e00\u770b\u5230\u8fd9\u4e2a\u9898\u5c31\u662f\u7206\u641cqaq\uff0c\u4f46\u662f\u663e\u7136\u4f1a\u7206\n\n\u5176\u5b9e\u60f3\u5230\u4e86\u7206\u641c\u5c31\u662f12\u5206\n\n\u7d27\u63a5\u7740\uff0c\u5c31\u662f\u526a\u679dqaq\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8981\u662f\u8fd9\u4e2a\u6570\u5df2\u7ecf\u6bd4\u524d\u9762\u5806\u7684\u6570\u5927\u4e86\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5e8f\u5217\u76ee\u524d\u4e5f\u662f\u5408\u6cd5\u7684\n\n\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u8fd9\u4e2a\u6570\u4f5c\u4e3a\u65b0\u5e8f\u5217\u7684\u5f00\u5934\uff0c\u8fd9\u6837\u4e00\u5b9a\u66f4\u4f18\n\n\u4e8e\u662f\u5c31\u6709\u4e86\u6211\u768424pts\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\ninline int read(){\n\tregister int x=0;\n\tregister char c=getchar();\n\tregister bool f=0;\n\twhile(c<'0' || c>'9'){\n\t\tif(c=='-') f=1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\tx=(x<<3)+(x<<1)+c-48;\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst ll sj=4e18+1000000000;\nconst int maxn=5e5+100;\nint a[maxn],n,type;\nll ans=sj;\nvoid dfs(int now,ll sum_lst,ll sum_now,ll sum){\n\tif(sum>=sj) return ;\n\tif(sum<0) return ;\n\tif(sum>=ans) return;\n\tif(now==n+1){\n\t\tif(sum_now<sum_lst) return; \n\t\tans=sum;\n\t}\n\tdfs(now+1,sum_lst,sum_now+a[now],sum-sum_now*sum_now+(sum_now+a[now])*(sum_now+a[now]));\n\tif(sum_now<sum_lst) return;\n\tdfs(now+1,sum_now,a[now],sum+a[now]*a[now]);\n}\nint main(){\n\t//freopen(\"partition.in\",\"r\",stdin);\n\t//freopen(\"partition.out\",\"w\",stdout);\n\tn=read();type=read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i]=read();\n\t}\n\tdfs(1,0,0,0);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n\n\n\n\n\n```\n## \u7ee7\u7eed\u601d\u8003\n\u5176\u5b9e\u6211\u4eec\u53d1\u73b0\uff0c\u628a\u4e00\u4e2a\u5757\u5206\u5f00\u6c38\u8fdc\u6bd4\u5408\u4e0a\u8981\u597d\uff08\u5982\u679c\u90fd\u662f\u5408\u6cd5\u7684\uff09\n\n\u4e5f\u5c31\u662fa+b\u7684\u5e73\u65b9\u5927\u4e8ea\u7684\u5e73\u65b9*b\u7684\u5e73\u65b9\n\n\u8fd9\u6837\u5c31\u53ea\u8981\u8981\u6c42\u5176\u5e73\u5747\u5c31\u597d\u4e86\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u60f3\u5230dp\n\n64\u5206\u5230\u624b\n\n## \u518d\u53d1\u73b0\n\u5176\u5b9e\u8fd9\u4e2a\u601d\u8def\u6211\u8003\u573a\u60f3\u5230\u4e86\uff0c\u4f46\u662f\u4e3a\u4e86\u4fdd\u5b88\u6ca1\u6709\u6572qaq\n\n\u56e0\u4e3a\u6700\u540e\u4e00\u5757\u662f\u6700\u5927\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u53ea\u8981\u6700\u540e\u4e00\u5757\u5c3d\u53ef\u80fd\u7684\u5c0f\uff0c\u7b54\u6848\u5c31\u4f1a\u66f4\u4f18\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u53ef\u4ee5\u4e8c\u5206\u4e86\uff0c88\u5206qaq\n\n\uff08\u6211\u597d\u60e8\u554a\uff09\n## \u6700\u540e\u8bf4\u4e00\u4e0b\u6b63\u89e3\n\u8fd9\u4e2a\u9898\u7684\u6b63\u89e3\uff0c\u5c31\u662f\u4f60\u8981\u53d1\u73b0\u5176\u4e2d\u7684\u5355\u8c03\u6027\n\n\u8981\u662f\u6709\u591a\u4e2a\u6570\u90fd\u662f\u5408\u6cd5\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u9009\u62e9\u6700\u5927\u7684\u4f5c\u4e3a\u524d\u9a71\uff08\u5c31\u662f\u4e0a\u4e00\u4e2a\u5757\uff09\n\n\u8981\u662f\u6709\u961f\u5c3e\u7684\u5757\u5df2\u7ecf\u5927\u4e8e\u8fd9\u4e2a\u6570\u4e86\uff0c\u53ea\u8981\u5220\u53bb\u5c31\u597d\n\n\u518d\u52a0\u4e0a\u4e00\u4e2a~~int128~~\u9ad8\u7cbe\u5c31\u53ef\u4ee5\u8fc7\u4e86\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define ll long long \n#define lll __int128\nusing namespace std;\nint read(){\n    int x=0,flag=1;char c;\n    while((c=getchar())<'0' || c>'9') if(c=='-') flag=-1;\n    while(c>='0' && c<='9') x=(x<<3)+(x<<1)+(c^'0'),c=getchar();\n    return x*flag;\n}\nvoid write(lll x){\n\tif(x/10)\n\t\twrite(x/10);\n\tputchar(x%10+48);\n}\nconst int maxn=4e7+100;\nconst int N=100005;\nconst int MOD=1<<30;\nint n,type,head=1,tail=1,q[maxn],l[N],r[N],p[N],pri[maxn];\nll sum[maxn],b[maxn];\nlll ans;\nint main(){\n\tn=read();type=read();\n\tif(type){\n\t\tint x=read(),y=read(),z=read(),m,now=1;\n        b[1]=read();b[2]=read();m=read();\n        for(int i=1;i<=m;i++)\n            p[i]=read(),l[i]=read(),r[i]=read();\n        for(int i=3;i<=n;i++)\n            b[i]=(x*b[i-1]+y*b[i-2]+z)%MOD;\n        for(int i=1;i<=n;i++){\n            if(i>p[now]) now++;\n            sum[i]=sum[i-1]+(b[i]%(r[now]-l[now]+1))+l[now];\n        }\n\t}\n\telse{\n\t\tfor(int i=1;i<=n;i++) sum[i]=sum[i-1]+read();\n\t}//\u8bfb\u5165\n\tfor(int i=1;i<=n;i++){\n\t\twhile(head<tail && sum[q[head+1]]-sum[pri[q[head+1]]]<=sum[i]-sum[q[head+1]]) head++;\n\t\tpri[i]=q[head];//\u5355\u8c03\u961f\u5217\uff0c\u9009\u62e9\u524d\u9a71\n\t\twhile(head<tail && sum[q[tail]]*2-sum[pri[q[tail]]]>=sum[i]*2-sum[pri[i]]) tail--;\n\t\tq[++tail]=i;//\u628a\u4e0d\u4f18\u7684\u70b9\u76f4\u63a5\u5220\u6389\uff0c\u7ef4\u62a4\u5355\u8c03\u6027\n\t}\n\twhile(n){\n\t\tans+=((lll)(sum[n]-sum[pri[n]])*(sum[n]-sum[pri[n]])),n=pri[n];\n\t}\n\twrite(ans);//int128\u4e0d\u5141\u8bb8\u76f4\u63a5\u8f93\u51fa\n\treturn 0;\n} \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n```\n",
        "postTime": 1575162763,
        "uid": 120074,
        "name": "BFqwq",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "# Solution\n\n\u9996\u5148\u6709\u4e00\u4e2a\u66b4\u529b DP\uff1a \u8bbe $f(i, j)$ \u8868\u793a\u5df2\u7ecf\u5212\u5206\u4e86\u524d $i$ \u4e2a\u6570\u7684\u6bb5\uff0c\u6700\u540e\u4e00\u6bb5\u4ee5 $j$ \u5f00\u5934\u7684\u6700\u5c0f\u603b\u8fd0\u884c\u65f6\u95f4\u3002\u8bbe $S(j, i) = \\sum \\limits _{k = j} ^i a _k$\uff0c\u6709\u8f6c\u79fb\uff1a\n\n$$\nf(i, j) = \\min _{0 < k < j, S(j, i) \\ge S(k, j - 1)} \\{f(j - 1, k)\\} + S(j, i) ^2\n$$\n\n\u76f4\u63a5\u6309\u65b9\u7a0b\u8f6c\u79fb\u662f $O(n ^3)$ \u7684\u3002\u6ce8\u610f\u5230\u82e5\u5c06 $j$ \u4ece $i$ \u5230 $1$ \u9006\u987a\u5e8f\u8f6c\u79fb\uff0c\u80fd\u591f\u8d21\u732e\u7684\u90a3\u4e9b $k$ \u4e0d\u65ad\u53d8\u591a\u3002\u4e8e\u662f\u8bbe\u7f6e\u4e00\u4e2a\u6307\u9488 $p$\uff0c\u521d\u503c\u4e3a $i$\uff0c\u6bcf\u6b21 $j \\gets j - 1$ \u65f6\u8c03\u6574 $p$ \u7684\u4f4d\u7f6e\u4e0d\u65ad\u5411\u5de6\u8d70\uff0c\u5373\u53ef\u505a\u5230\u5747\u644a\u4e0b $O(1)$ \u8f6c\u79fb\uff0c\u590d\u6742\u5ea6 $O(n ^2)$\u3002\n\n\u72b6\u6001\u6570\u5f88\u660e\u663e\u7684\u9700\u8981\u4f18\u5316\uff0c\u6253\u8868\u53ef\u4ee5\u53d1\u73b0\uff1a\u80fd\u591f\u8f6c\u79fb\u5230\u5176\u4ed6\u72b6\u6001\u7684 $f(i, j)$ \u5fc5\u5b9a\u6ee1\u8db3 $f(i, j)$ \u662f\u6700\u540e\u4e00\u4e2a\u5408\u6cd5\u7684\u72b6\u6001\uff0c\u5373 $f(i, j + x)$ \u5747\u662f\u4e0d\u5408\u6cd5\u72b6\u6001\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u53ea\u8981\u8ba9\u4ee5 $i$ \u7ed3\u5c3e\u7684\u6700\u540e\u4e00\u6bb5\u5212\u51fa\u6765\u7684\u603b\u548c\u5c3d\u53ef\u80fd\u5c0f\uff0c\u5c31\u53ef\u4ee5\u6784\u9020\u51fa\u4e00\u79cd\u6700\u4f18\u65b9\u6848\u3002\n\n[myy \u7684\u8bc1\u660e](http://matthew99.blog.uoj.ac/blog/5299)\n\n\u4e8e\u662f\u91cd\u8bbe\u72b6\u6001\uff1a\u8bbe $g _i$ \u8868\u793a\u6700\u5927\u7684\u6ee1\u8db3\u4ee5 $g _i$ \u4f5c\u4e3a\u6700\u540e\u4e00\u6bb5\u7684\u5f00\u5934\u80fd\u591f\u5408\u6cd5\u7684\u4f4d\u7f6e\u3002\u6709\u8f6c\u79fb\uff1a\n\n$$\ng _i = \\max _{0 < j < i, S(j + 1, i) \\ge S(g _j, j)} \\{j\\} + 1\n$$\n\n\u8bbe $P _i = \\sum \\limits _{j = 1} ^i a _i$\uff0c\u5c06 $S(j + 1, i) \\ge S(g _j, j)$ \u53d8\u5f62\u4e3a $P _i \\ge 2P _j - P _{g _j}$\u3002\u518d\u8bbe $T _i = 2P _i - P _{g _i}$\u3002\n\n\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4 $T$ \u56fa\u7136\u53ef\u884c\uff0c\u4f46\u590d\u6742\u5ea6\u4ecd\u4e0d\u591f\u4f18\u79c0\u3002\u6ce8\u610f\u5230\u5176\u5355\u8c03\u6027\uff1a\u7531\u4e8e\u662f\u53d6 $\\max$ \u5e76\u4e14\u662f\u4ece\u524d\u5f80\u540e\u8f6c\u79fb\u7684\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u72b6\u6001 $i$ \u800c\u8a00\uff0c\u524d\u9762\u7684 $j$ \u82e5\u6709 $T _j \\ge T _i$ \u5219 $j$ \u4e00\u5b9a\u4e0d\u4f1a\u6bd4 $i$ \u66f4\u4f18\u3002\n\n\u8fd9\u662f\u4e2a\u5178\u578b\u7684\u5355\u8c03\u961f\u5217\u4f18\u5316\u8f6c\u79fb\u7684\u60c5\u51b5\u3002\u961f\u5c3e\u51fa\u961f\u6309 $T$ \u6bd4\u8f83\u5373\u53ef\uff0c\u5f53\u961f\u5934\u7684\u540e\u4e00\u4e2a\u5143\u7d20 $u$ \u6ee1\u8db3 $T _u < P _i$ \u65f6\u53ef\u77e5\u961f\u5934\u5df2\u7ecf\u4e0d\u4f1a\u518d\u4ea7\u751f\u8d21\u732e\uff0c\u5c06\u961f\u5934\u51fa\u961f\u3002\n\n\u6ce8\u610f\u4e00\u5f00\u59cb\u8981\u653e\u5165 0\uff0c\u5e76\u8bbe $g _0 = 1$ \u4ee5\u51cf\u5c11\u8fb9\u754c\u60c5\u51b5\u7684\u5904\u7406\u3002\n\n\u8fd9\u6837\u53ef\u4ee5\u987a\u5229\u83b7\u5f97 88pts\u3002\u518d\u8003\u8651\u9ad8\u7cbe\u5ea6\u7684\u95ee\u9898\u3002\n\n\u53ef\u4ee5\u8003\u8651\u5c06\u7b54\u6848\u8868\u793a\u4e3a $a \\times 10 ^{18} + b$ \u7684\u5f62\u5f0f\u5e76\u8fdb\u884c\u8fd0\u7b97\u3002\u52a0\u6cd5\u76f4\u63a5\u5c06 $a, b$ \u5206\u522b\u76f8\u52a0\uff08\u6ce8\u610f $b > 10 ^{18}$ \u65f6\u5f97\u8fdb\u4f4d\uff09\u3002\u4e58\u6cd5\u5219\u662f\u4e00\u4e2a `long long` \u8303\u56f4\u5185\u6570 $x$ \u7684\u5e73\u65b9\uff0c\u5c06 $x$ \u8868\u793a\u4e3a $a \\times 10 ^9 + b$ \u7684\u5f62\u5f0f\u5219\u6709\uff08\u5c06 $10 ^9$ \u7701\u7565\u4e3a $B$\uff09\uff1a\n\n$$\n\\begin{aligned}\n& x ^2 \\\\\\\\\n=& (aB + b) ^2 \\\\\\\\\n=& a ^2 B ^2 + 2abB + b ^2 \\\\\\\\\n=& a ^2 B ^2 + 2(a'B + b')B + b ^2 \\\\\\\\\n=& (a ^2 + 2a') B ^2 + (2b'B + b ^2) \\\\\\\\\n=& (a ^2 + 2a') 10 ^{18} + (2b'B + b ^2)\n\\end{aligned}\n$$\n\n\u5176\u4e2d $ab = a' \\times 10 ^9 + b'$\u3002\u8fd9\u6837\u5373\u53ef\u907f\u514d\u9ad8\u7cbe\u5ea6\u95ee\u9898\u3002\n\n\u540c\u6837\u7684\uff0c$2b'B + b ^2$ \u5904\u6ce8\u610f\u8fdb\u4f4d\u3002\u53e6\u5916\u7531\u4e8e\u53ef\u4ee5\u76f4\u63a5\u6c42\u51fa\u5206\u6bb5\u60c5\u51b5\uff08\u4e5f\u5c31\u662f $g _i$\uff09\uff0c\u4e0d\u9700\u8981\u5b58\u7b54\u6848\u6570\u7ec4\uff0c\u4e5f\u907f\u514d\u4e86\u70b8\u7a7a\u95f4\u7684\u95ee\u9898\u3002\n\n# Code\n\n\uff08\u5f53\u7136\u4e0d\u662f\u8003\u573a\u4ee3\u7801...\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n\n#define squ(x) (LL(x) * (x))\n\nusing namespace std;\n\ntypedef long long LL;\ntypedef unsigned int uint;\n\nconst int maxN = 4e7 + 5;\nconst LL INF = 0x3F3F3F3F3F3F3F3F;\nconst int BASE = 1e9;\nconst LL __base = 1e18;\n\nint n, type, head, tail;\nint g[maxN], q[maxN];\nLL sum[maxN];\n\ntemplate<typename _Tp>\ninline bool Chkmin(_Tp& x, const _Tp& y)\n{ return x > y ? x = y, true : false; }\n\ninline LL Res(int i)\n{ return sum[i] * 2 - sum[g[i] - 1]; }\n\nstruct Num\n{\n    LL a, b;\n\n    Num() { }\n\n    Num(LL num) : a(0), b(num) { }\n\n    Num& operator+=(const Num& x)\n    {\n        a += x.a, b += x.b;\n        if (b >= __base)\n            ++a, b -= __base;\n        return *this;\n    }\n} ans;\n\nNum Squ(LL num)\n{\n    Num res;\n    int a = num / BASE, b = num - (LL)a * BASE;\n    int _a = (LL)a * b / BASE, _b = (LL)a * b - (LL)_a * BASE;\n    res.a = (LL)a * a + 2 * _a;\n    res.b = (LL)b * b + 2ll * _b * BASE;\n    res.a += res.b / __base, res.b %= __base;\n    return res;\n}\n\nuint b[maxN];\n\nvoid Input()\n{\n    int x, y, z, m, last = 0;\n    cin >> x >> y >> z >> b[1] >> b[2] >> m;\n    for (int i = 3; i <= n; ++i)\n        b[i] = x * b[i - 1] + y * b[i - 2] + z;\n    for (int i = 1; i <= m; ++i)\n    {\n        int l, r, p;\n        cin >> p >> l >> r;\n        for (int j = last + 1; j <= p; ++j)\n            sum[j] = sum[j - 1] + (b[j] & ((1 << 30) - 1)) % (r - l + 1) + l;\n        last = p;\n    }\n}\n\nint main()\n{\n    freopen(\"partition.in\", \"r\", stdin);\n    freopen(\"partition.out\", \"w\", stdout);\n    ios::sync_with_stdio(false);\n    cin >> n >> type;\n    if (type == 1)\n        Input();\n    else\n        for (int i = 1; i <= n; ++i)\n            cin >> sum[i], sum[i] += sum[i - 1];\n    g[0] = 1;\n    head = tail = 1;\n    for (int i = 1; i <= n; ++i)\n    {\n        while (head < tail and Res(q[head + 1]) <= sum[i])\n            ++head;\n        g[i] = q[head] + 1;\n        while (tail > head and Res(i) <= Res(q[tail]))\n            --tail;\n        q[++tail] = i;\n    }\n    for (int i = n; i; i = g[i] - 1)\n        ans += Squ(sum[i] - sum[g[i] - 1]);\n    if (ans.a)\n        printf(\"%lld%18lld\\n\", ans.a, ans.b);\n    else\n        printf(\"%lld\\n\", ans.b);\n    return 0;\n}\n```",
        "postTime": 1575090427,
        "uid": 91252,
        "name": "EndSaH",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "\u8003\u573a\u4e0a\u5e76\u6ca1\u6709\u6253\u51fa\u6765$QWQ$   \n\u8fd9\u9898\u5176\u5b9e\u5f88\u5bb9\u6613\u60f3\u5230$DP$    \n\u8bbe$f[i][j]$\u4e3a\u7ed3\u5c3e\u4e3a$i$\u4e14\u6700\u540e\u4e00\u6bb5\u7684\u5f00\u5934\u4e3a$j$\u7684\u6700\u4f18\u65b9\u6848\uff0c$s[i]=\\sum\\limits^{i}_{j=1}a_j$   \n\u6613\u5f97\u52a8\u6001\u8f6c\u79fb\u65b9\u7a0b\n$$f[i][j]=\\min_{s[j-1]-s[k-1]\\le s[i]-s[j-1]}(f[k][j-1]+(s[i]-s[j-1])^2)$$\n\u4f46\u662f\u8fd9\u4e2a$DP$\u662f$O(n^3)$\u5f88\u6162\u5f88\u6162 ~~\u7136\u800c\u6211\u8003\u573a\u53ea\u60f3\u5230\u8fd9\u4e2a~~\n\n\u7531\u4e8e\u9898\u76ee\u91cc\u8981\u6c42\u6bcf\u4e00\u6bb5\u5927\u4e8e\u7b49\u4e8e\u524d\u4e00\u6bb5\uff0c\u90a3\u4e48\u524d\u4e00\u6bb5\u5f53\u7136\u8d8a\u5c0f\u8d8a\u597d    \n\u6545\u8bbe$f[i]$\u4e3a\u7ed3\u5c3e\u4e3a$i$\u7684\u6700\u4f18\u65b9\u6848\uff0c$d[i]$\u4e3a\u7ed3\u5c3e\u4e3a$i$\u7684\u6700\u4f18\u65b9\u6848\u5f53\u4e2d\u7684\u6700\u540e\u4e00\u6bb5\u7684\u6700\u5c0f\u503c     \n\u6613\u5f97\u52a8\u6001\u8f6c\u79fb\u65b9\u7a0b\n$$f[i]=\\min_{d[j]\\le s[i]-s[j]}(f[j]+(s[i]-s[j])^2)$$\n$f[j]$\u80fd\u591f\u8f6c\u79fb\u5230$f[i]$\u7684\u5fc5\u8981\u6761\u4ef6\u4e3a$d[j]\\le s[i]-s[j]$\uff0c\u79fb\u9879\u5f97$d[j]+s[j]\\le s[i]$\uff0c\u7136\u540e\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5373\u53ef \n```cpp\n#include<cstdio>\n#define ll long long\n#define N 41000001\nusing namespace std;\nint n,type;\nll a[N+1],sum[N+1],f[N+1],d[N+1];\nint q[N+1];\nint main()\n{\n\tscanf(\"%d %d\",&n,&type);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lld\",&a[i]),sum[i]=sum[i-1]+a[i];\n\tint h=0,t=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(h<t&&d[q[h+1]]+sum[q[h+1]]<=sum[i])\n\t\t\th++;\n\t\td[i]=sum[i]-sum[q[h]],f[i]=f[q[h]]+d[i]*d[i];\n\t\twhile(h<t&&d[q[t]]+sum[q[t]]>=d[i]+sum[i])\n\t\t\tt--;\n\t\tq[++t]=i;\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n\u7531\u4e8e\u4e0d\u60f3\u6253\u9ad8\u7cbe\u5ea6\uff0c\u6240\u4ee5\u53ea\u8d34$88$\u5206\u4ee3\u7801\n",
        "postTime": 1574919264,
        "uid": 111475,
        "name": "doctorZ_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "## CSP-S\u60ca\u73b0\u4e24\u9053\u9ed1\u9898\n\n\u9996\u5148\uff0c\u8fd9\u9053\u9898\u9700\u8981\u4e00\u4e2a\u7ed3\u8bba ~~\uff08\u6253\u8868\u5927\u6cd5\u597d\uff09~~:  \n\u5bf9\u4e8e\u4efb\u4f55 $i$ ,\u6700\u540e\u4e00\u5757\u5c3d\u91cf\u5c0f\uff0c\u5e73\u65b9\u548c\u8d8a\u5c0f  \n\u82e5\u6210\u7acb\uff1a  \n$sum_i= \\sum^i_{j=1} a_j$  \n\u4ee4$dp_i$\u4e3a\u6700\u5927\u4e14\u6ee1\u8db3$sum_{dp_i}-sum_{dp_{dp_i}} \\leq sum_i-sum_{dp_i}$  \n\n```cpp\nINT ans=0;\nfor(int i=n;i;i=dp[i])\n\tans+=(sum[i]-sum[dp[i]])*(sum[i]-sum[dp[i]]);\nprint(ans);\n```\n\n\u5355\u8c03\u961f\u5217\u4f18\u5316\u53efO(n)  \n\u518d\u6253\u4e00\u4e2a\u538b\u4f4d\u9ad8\u7cbe\u5373\u53efAC  \n\n## \u672c\u9898\u89e3\u826f(hei)\u5fc3\u63d0\u4f9b\u8bc1\u660e\uff1a\n\n### part1:  \n\n\u5f53$i\\leq2$\u65f6\uff0c\u4e00\u5b9a\u6210\u7acb\u3002\u3002\u3002  \n\u592a\u663e\u7136\u4e86\uff0c\u5c31\u4e0d\u8bc1\u4e86\u3002\u3002\u3002\n\n### part2:\n\n~~\u524d\u65b9\u9ad8\u80fd~~\n\n\u8003\u8651\u6570\u5b66\u5f52\u7eb3\u6cd5  \n\u5047\u8bbe\u5df2\u8bc1\u5f53$i < x$\u65f6\u6210\u7acb    \n\n\u4ee4$ans_x=\\sum (sum_i-sum_{dp_i})^2$\n\n\u4ee4$y=dp_x(y<x)$ \n\u53cd\u8bc1\uff1a  \n\u5047\u8bbe$i=x$\u65f6\u4e0d\u6210\u7acb  ~~\u4e00\u5927\u6ce2\u516c\u5f0f\u5373\u5c06\u6765\u88ad~~  \n\u5b58\u5728$k(k<y \\&\\& sum_k-sum_{dp_k} \\leq sum_x-sum_y)$\u4f7f$ans_k+(sum_x-sum_k)^2<ans_y+(sum_x-sum_y)^2$\n\n$\\therefore ans_y-ans_k>(sum_x-sum_k)^2-(sum_x-sum_y)^2$  \n\n$\\therefore ans_y-ans_k>(sum_y-sum_k)(2sum_x-sum_y-sum_k)$  \n\n$\\because sum_x>sum_y $  \n\n$\\therefore sum_x-sum_k>sum_y-sum_k$  \n\n$\\therefore 2sum_x-sum_y-sum_k>sum_y-sum_k$    \n\n$\\therefore (sum_y-sum_k)^2<(sum_y-sum_k)(2sum_x-sum_y-sum_k)<ans_y-ans_k$  \n\n$\\therefore ans_k+(sum_y-sum_k)^2<ans_y$  \n\n$\\therefore $  \u77db\u76fe  \n\n$\\therefore$ \u539f\u547d\u9898\u6210\u7acb  \n\n\u7531\u6570\u5b66\u5f52\u7eb3\u6cd5\u53ef\u5f97\uff1a\u539f\u547d\u9898\u6052\u6210\u7acb\u3002\n\n\u8bc1\u6bd5\n\n### part3:code  \n\n\u7b49CCF\u4e0b\u53d1\u6e90\u4ee3\u7801\u65f6\u518d\u8865 ~~\uff08\u4e2d\u8003\u538b\u529b\u5927\uff0c\u6ca1\u65f6\u95f4\u518d\u6253\u4e00\u4efd\uff09~~  ",
        "postTime": 1574003527,
        "uid": 103990,
        "name": "asd_a",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    },
    {
        "content": "\u600e\u4e48\u8bf4\u5462\uff0c\u6211\u771f\u6ca1\u60f3\u51fa\u6b63\u89e3\n\n~~\uff08\u592a\u83dc\u4e86\uff09~~\n\n\u4f46\u662f\u5728\u8003\u573a\u4e0a\u4f60\u662f\u5b8c\u5168\u53ef\u4ee5\u60f3\u51fa64\u5206\u7684\u5199\u6cd5\u7684\uff0c\uff0c\uff0c\n\n\u9996\u5148\uff0c\u4f60\u5148\u60f3\u8fd9\u4e2a\u9898\u7684\u63cf\u8ff0\u662f\u4e0d\u662f\u8d3c\u50cf\u62c6\u5206\u6570\u5217(P1415)\n\n\u4f46\u662f\u4f60\u8fd8\u662f\u9700\u8981\u6c42\u4e00\u4e2a\u6700\u4f18\u503c\n\n\u6211\u4e00\u770b\uff0c\u54c7\uff0c\u90a3\u4e48\u957f\n\n\u5176\u5b9e\u5e76\u4e0d\u590d\u6742\uff0c\u5c31\u662f\u7ed9\u4f60\u4e00\u4e2an\u4e2a\u6570\u7684\u6570\u5217\uff0c\u4f60\u53ef\u4ee5\u5408\u5e76\u4efb\u610f\u8fde\u7eed\u7684\u82e5\u5e72\u4e2a\u6570\u4efb\u610f\u6b21\uff0c\u4f46\u662f\u8981\u6c42\u5408\u5e76\u540e\u7684\u6570\u5217\u5fc5\u987b\u4e25\u683c\u4e0d\u4e0b\u964d\n\n\u9898\u76ee\u770b\u61c2\u4e86\u5c31\u8bbe\u8ba1\u72b6\u6001\u5427\uff0c\u663e\u7136\u4e0d\u662f\u533a\u95f4dp\uff08\u56e0\u4e3a\u6211\u4e0d\u4f1a\u533a\u95f4\u5408\u5e76\uff09\uff0c\u90a3\u5c31\u8bbef[i][0]\u8868\u793a\u524di\u4e2a\u6570\u7684\u6700\u4f18\u503c\uff0cf[i][1]\u8868\u793a\u4e0ei\u6700\u8fd1\u7684\u90a3\u4e2a\u6570\uff08\u53ef\u4ee5\u662f\u5408\u5e76\u8fc7\u7684\uff09\u7684\u503c\u3002\n\n\u8f6c\u79fb\u7684\u8bdd\u8fd8\u662f\u5f88\u597d\u60f3\u7684\uff0c\u5f53\u524d\u7684\u6570\u8981\u4e48\u5c31\u548c\u524d\u9762\u7684\u5408\u5e76\uff0c\u8981\u4e48\u548c\u540e\u9762\u7684\u5408\u5e76\uff08\u6211\u628a\u8fd9\u4e2a\u6570\u4e0d\u5408\u5e76\u8ba4\u4e3a\u548c\u7a7a\u7684\u6570\u5408\u5e76\uff09\uff0c\u90a3\u5c31\u5206\u522b\u8f6c\u79fb\u5457\n\n\u5224\u65ad\u548c\u524d\u9762\u7684\u5408\u5e76\u66f4\u65b0f[i][0]\u7684\u503c\uff0c\u8003\u8651\u548c\u540e\u9762\u7684\u5408\u5e76,\u66f4\u65b0f[j][0]\uff0cj>=i\u7684\u503c\u5373\u53ef\n\n~~\u542c\u8bf4\u6b63\u89e3\u662f\u8d2a\u5fc3\uff1f~~\n\n### talk is cheap,show you my code\n```\n#include<cstdio>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<cmath>\n#include<queue>\n#include<set>\n#include<map>\n#define N 5050\n\nusing namespace std;\ntypedef long long ll;\n\nll ans=0;\nint n;\nll f[N][2];\nll a[N];\nll sum[N];\n\nint main()\n{\n//\tfreopen(\"partition.in\",\"r\",stdin);\n//\tfreopen(\"partition.out\",\"w\",stdout);\n\tmemset(f,127,sizeof(f));//\u521d\u59cb\u5316\u4e3a\u6700\u5927\u65b9\u4fbf\u8f6c\u79fb \n\tint len,i,j,k;\n\tint n,t;\n\tscanf(\"%d%d\",&n,&t);\n\tfor(i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n//\tfor(i=1;i<=n;i++) sum[i]=sum[i-1]+a[i];\n\tf[0][0]=f[0][1]=0;//\u524d0\u4e2a\u6570\u7684\u4e24\u4e2a\u503c\u90fd\u662f0 \n\tfor(i=1;i<=n;i++)\n\t{\n\t\tll w1=f[i-1][0]-(f[i-1][1]*f[i-1][1]);//\u5148\u8ba1\u7b97\u9664\u4e86\u6700\u8fd1\u7684\u90a3\u4e2a\u6570\u4ee5\u5916\u7684\u8d21\u732e\u503c \n\t\tll tw=w1+(f[i-1][1]+a[i])*(f[i-1][1]+a[i]);//\u518d\u8ba1\u7b97\u5f53\u524d\u7684\u53ef\u80fd\u7684\u8d21\u732e \n\t\tif(tw<f[i][0]) f[i][0]=tw,f[i][1]=f[i-1][1]+a[i];//\u66f4\u65b0\u72b6\u6001\uff0c\u6ce8\u610f\u662f\u4e0d\u4e0b\u964d \n\t\tll sum=0;\n\t\tfor(j=i;j<=n;j++) //\u679a\u4e3e\u540e\u9762\u7684\u72b6\u6001 \n\t\t{\n\t\t\tsum+=a[j];\n\t\t\tif(sum<f[i-1][1]) continue;//\u5fc5\u987b\u8981\u4e0d\u4e0b\u964d\u5440 \n\t\t \tll w2=f[i-1][0]+sum*sum;//\u8ba1\u7b97\u8d21\u732e \n\t\t\tif(w2<f[j][0]) f[j][0]=w2,f[j][1]=sum;//\u66f4\u65b0\u72b6\u6001 \n\t\t}\n\t}\n\tprintf(\"%lld\",f[n][0]);//\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f\u5b83\u4e86\uff01 \n\treturn 0;\n}\n```\n",
        "postTime": 1573980013,
        "uid": 129001,
        "name": "\u77e2\u5fd7\u4e0d\u6e1d",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5665 \u3010\u5212\u5206\u3010\u6c11\u95f4\u6570\u636e\u3011\u3011"
    }
]