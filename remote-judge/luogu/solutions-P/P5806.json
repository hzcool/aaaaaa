[
    {
        "content": "CF \u4e0a\u4e5f\u6709\u4e00\u6837\u7684\u9898\uff1a<https://codeforces.com/gym/102392/problem/K>\u3002\n\n\u8981\u4e0d\u662f\u4e00\u4e2a\u665a\u4e0a\u90fd\u5728\u809d\u8fd9\u9053\u9898\u8fd8\u6ca1\u8c03\u51fa\u6765 WC \u4e5f\u4e0d\u81f3\u4e8e\u6253\u94c1 /fn\u3002\n\n\u5047\u8bbe $n$\uff0c$m$\uff0c$l$ \u540c\u9636\u3002\n\n---\n\n\u8fd9\u9053\u9898\u6700\u590d\u6742\u7684\u5730\u65b9\u5c31\u5728\u4e8e\u5904\u7406\u8f93\u5165\uff0c\u5176\u5b9e\u53ea\u8981\u7cbe\u7ec6\u5b9e\u73b0\u5c31\u53ef\u4ee5\u89c4\u907f\u5f88\u591a\u95ee\u9898\u3002\n\n\u9996\u5148\uff0c\u7531\u4e8e\u673a\u5668\u4eba\u53ea\u80fd\u5728\u6709\u5149\u7167\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u771f\u6b63\u6709\u610f\u4e49\u7684\u70b9\uff08\u5b9a\u4e49\u5176\u4e3a\u300c\u5173\u952e\u70b9\u300d\uff09\u6700\u591a\u53ea\u6709 $6n^2$ \u4e2a\u3002\u6ce8\u610f\u8fd9\u4e9b\u70b9\u8981\u6ee1\u8db3\uff1a\n\n- \u67d0\u4e2a\u65b9\u5411\u4e0a\u6ca1\u6709\u969c\u788d\uff1b\n- \u8fd9\u4e2a\u70b9\u6ca1\u6709\u969c\u788d\uff1b\n- \u5728\u5bf9\u5e94\u53cd\u65b9\u5411\u4e0a\u6070\u597d\u4e00\u5355\u4f4d\u5904\u6709\u969c\u788d\u3002\n\n\u4e0b\u4e00\u6b65\u8981\u5bf9\u8fd9\u4e9b\u70b9\u7f16\u53f7\uff0c\u4f46\u7531\u4e8e\u4e00\u4e2a\u70b9\u53ef\u80fd\u4f1a\u88ab\u591a\u4e2a\u65b9\u5411\u4e0a\u7684\u5149\u7167\u5230\uff0c\u6240\u4ee5\u8981\u8fdb\u884c\u53bb\u91cd\u3002\uff08\u53ef\u4ee5 Hash\uff0c\u4e5f\u53ef\u4ee5\u8bb0\u5f55\u67d0\u4e2a\u70b9\u662f\u5426\u5b58\u5728\u7136\u540e\u4ece\u5df2\u7ecf\u8bb0\u5f55\u8fc7\u7684\u65b9\u5411\u4e0a\u627e\uff09\n\n\u7136\u540e\u662f\u8fde\u8fb9\u30021\u30012 \u4e24\u7c7b\u8fb9\u662f\u5e73\u51e1\u7684\uff0c\u7b2c\u4e09\u7c7b\u5219\u53ef\u4ee5\u5bf9\u4e8e\u4e00\u4e2a\u70b9\u548c\u4e00\u4e2a\u65b9\u5411\uff0c\u679a\u4e3e\u8fd9\u4e2a\u65b9\u5411\u4e0a\u5728\u8fd9\u4e2a\u70b9\u4e0a\u65b9\u7684\u5176\u4ed6\u70b9\u5e76\u8fde\u8fb9\u3002\u6613\u8bc1\u8fd9\u6837\u7684\u679a\u4e3e\u91cf\u4e0d\u4f1a\u8d85\u8fc7 $3n^3$\u3002\n\n\u7531\u4e8e\u8fb9\u6743\u90fd\u662f $1$\uff0c\u6700\u540e\u8dd1\u4e00\u4e2a bfs \u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6 $O(n^3)$\u3002\n\n\u7136\u540e\uff0c\u5c31\u7801\u5427\u3002\u6ce8\u610f\u7cbe\u7ec6\u5b9e\u73b0\uff0c\u5e38\u6570\u4e0d\u662f\u5f88\u7d27\u3002\uff08\u6211\u5199\u7684\u8fd8\u662f\u592a\u4e11\u4e86\uff09\n\n```cpp\n#include <queue>\n#include <cstdio>\n#include <bitset>\n#include <cstring>\nusing namespace std;\n\ntypedef long long ll;\nconst int max_n = 500, efct = 36, nfct = 6, max_sn = max_n * max_n;\ntypedef int (*A)[max_n];\n\n#define S [max_n][max_n]\n#define C(x, v) memset(x, v, sizeof x)\n\nchar tmp[max_n][max_n][max_n+1];\nbitset<max_sn> ex[max_n];\nint da S, db S, dc S, dd S, de S, df S, pa S, pb S, pc S, pd S, pe S, pf S;\nint ind = 0, n, m, l;\nint hd[max_sn*nfct], des[max_sn*efct], nxt[max_sn*efct], dis[max_sn*nfct], e_cnt = 0;\n\ninline void add(int s, int t)\n{\n\tdes[e_cnt] = t;\n\tnxt[e_cnt] = hd[s];\n\thd[s] = e_cnt++;\n}\n\n// \u8bb0\u5f55\u7f16\u53f7\uff0c\u4e3a\u4e86\u7701\u5e38\u6570\u5199\u4e86\u4e09\u4e2a\nvoid RA(A da, A pa)\n{\n\tfor (int i = 0, j, k = 0; i < m; i++)\n\t\tfor (j = 0; j < l; j++, k++)\n\t\t\tif (da[i][j] != -1)\n\t\t\t\tpa[i][j] = ind++, ex[da[i][j]][k] = true;\n}\n\nvoid RB(A dc, A pc)\n{\n\tfor (int i = 0; i < n; i++)\n\t\tfor (int j = 0; j < l; j++)\n\t\t\tif (dc[i][j] != -1)\n\t\t\t{\n\t\t\t\tif (!ex[i][dc[i][j]*l+j])\n\t\t\t\t\tpc[i][j] = ind++, ex[i][dc[i][j]*l+j] = true;\n\t\t\t\telse\n\t\t\t\t\tpc[i][j] = (da[dc[i][j]][j] == i)? pa[dc[i][j]][j]:pb[dc[i][j]][j];\n\t\t\t}\n}\n\nvoid RC(A de, A pe)\n{\n\tfor (int i = 0, j, k, t, x; i < n; i++)\n\t\tfor (j = 0, k = 0; j < m; j++, k += l)\n\t\t\tif ((t = de[i][j]) != -1)\n\t\t\t{\n\t\t\t\tif (!ex[i][k+t])\n\t\t\t\t\tpe[i][j] = ind++, ex[i][k+t] = true;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (da[j][t] == i)\n\t\t\t\t\t\tpe[i][j] = pa[j][t];\n\t\t\t\t\telse if (db[j][t] == i)\n\t\t\t\t\t\tpe[i][j] = pb[j][t];\n\t\t\t\t\telse if (dc[i][t] == j)\n\t\t\t\t\t\tpe[i][j] = pc[i][t];\n\t\t\t\t\telse\n\t\t\t\t\t\tpe[i][j] = pd[i][t];\n\t\t\t\t}\n\t\t\t}\n}\n\n// \u52a0 1,2 \u4e24\u7c7b\u8fb9\uff0c\u8fd9\u91cc\u6b63\u5411\u548c\u53cd\u5411\u4e00\u8d77\u52a0\nvoid E(A da, A pa, A db, A pb, int m, int l)\n{\n\tfor (int i = 1; i < m; i++)\n\t\tfor (int j = 0; j < l; j++)\n\t\t{\n\t\t\tif (da[i-1][j] != -1 && da[i][j] != -1)\n\t\t\t{\n\t\t\t\tif (da[i-1][j] <= da[i][j])\n\t\t\t\t\tadd(pa[i-1][j], pa[i][j]);\n\t\t\t\tif (da[i-1][j] >= da[i][j])\n\t\t\t\t\tadd(pa[i][j], pa[i-1][j]);\n\t\t\t}\n\t\t\tif (db[i-1][j] != -1 && db[i][j] != -1)\n\t\t\t{\n\t\t\t\tif (db[i-1][j] >= db[i][j])\n\t\t\t\t\tadd(pb[i-1][j], pb[i][j]);\n\t\t\t\tif (db[i-1][j] <= db[i][j])\n\t\t\t\t\tadd(pb[i][j], pb[i-1][j]);\n\t\t\t}\n\t\t}\n\tfor (int i = 0; i < m; i++)\n\t\tfor (int j = 1; j < l; j++)\n\t\t{\n\t\t\tif (da[i][j-1] != -1 && da[i][j] != -1)\n\t\t\t{\n\t\t\t\tif (da[i][j-1] <= da[i][j])\n\t\t\t\t\tadd(pa[i][j-1], pa[i][j]);\n\t\t\t\tif (da[i][j-1] >= da[i][j])\n\t\t\t\t\tadd(pa[i][j], pa[i][j-1]);\n\t\t\t}\n\t\t\tif (db[i][j-1] != -1 && db[i][j] != -1)\n\t\t\t{\n\t\t\t\tif (db[i][j-1] >= db[i][j])\n\t\t\t\t\tadd(pb[i][j-1], pb[i][j]);\n\t\t\t\tif (db[i][j-1] <= db[i][j])\n\t\t\t\t\tadd(pb[i][j], pb[i][j-1]);\n\t\t\t}\n\t\t}\n}\n\n// \u627e\u5750\u6807\u5bf9\u5e94\u7684\u5173\u952e\u70b9\nint sek(int x, int y, int z)\n{\n\t#define G(d, p, k, i, j)\\\n\tif (d[i][j] == k)\\\n\t\treturn p[i][j];\n\tG(da, pa, x, y, z) G(db, pb, x, y, z)\n\tG(dc, pc, y, x, z) G(dd, pd, y, x, z)\n\tG(de, pe, z, x, y) G(df, pf, z, x, y)\n\treturn -114514;\n}\n\nsigned main()\n{\n\tint sx, sy, sz, tx, ty, tz;\n\t\n\tscanf(\"%d%d%d\", &l, &m, &n);\n\tC(da, -1), C(db, -1), C(dc, -1), C(dd, -1), C(de, -1), C(df, -1), C(hd, -1);\n\t\n\tfor (int i = 0, j, k; i < n; i++)\n\t\tfor (j = 0; j < m; j++)\n\t\t{\n\t\t\tscanf(\"%s\", tmp[i][j]);\n\t\t\tfor (k = 0; k < l; k++)\n\t\t\t{\n\t\t\t\tif (tmp[i][j][k] == 'R')\n\t\t\t\t\tsx = i, sy = j, sz = k;\n\t\t\t\telse if (tmp[i][j][k] == 'T')\n\t\t\t\t\ttx = i, ty = j, tz = k;\n\t\t\t}\n\t\t}\n\t\n    // \u627e\u5173\u952e\u70b9\n\tfor (int i = 0, j, k; i < m; i++)\n\t\tfor (j = 0; j < l; j++)\n\t\t{\n\t\t\tif (tmp[0][i][j] != '*')\n\t\t\t\tfor (k = 1; k < n; k++)\n\t\t\t\t\tif (tmp[k][i][j] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmp[k-1][i][j] != '*')\n\t\t\t\t\t\t\tda[i][j] = k - 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\tif (tmp[n-1][i][j] != '*')\n\t\t\t\tfor (int k = n - 1; k > 0; k--)\n\t\t\t\t\tif (tmp[k-1][i][j] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmp[k][i][j] != '*')\n\t\t\t\t\t\t\tdb[i][j] = k;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t}\n\tfor (int i = 0, j, k; i < n; i++)\n\t\tfor (j = 0; j < l; j++)\n\t\t{\n\t\t\tif (tmp[i][0][j] != '*')\n\t\t\t\tfor (k = 1; k < m; k++)\n\t\t\t\t\tif (tmp[i][k][j] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmp[i][k-1][j] != '*')\n\t\t\t\t\t\t\tdc[i][j] = k - 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\tif (tmp[i][m-1][j] != '*')\n\t\t\t\tfor (int k = m - 1; k > 0; k--)\n\t\t\t\t\tif (tmp[i][k-1][j] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmp[i][k][j] != '*')\n\t\t\t\t\t\t\tdd[i][j] = k;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t}\n\tfor (int i = 0, j, k; i < n; i++)\n\t\tfor (j = 0; j < m; j++)\n\t\t{\n\t\t\tif (tmp[i][j][0] != '*')\n\t\t\t\tfor (k = 1; k < l; k++)\n\t\t\t\t\tif (tmp[i][j][k] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmp[i][j][k-1] != '*')\n\t\t\t\t\t\t\tde[i][j] = k - 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\tif (tmp[i][j][l-1] != '*')\n\t\t\t\tfor (int k = l - 1; k > 0; k--)\n\t\t\t\t\tif (tmp[i][j][k-1] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmp[i][j][k] != '*')\n\t\t\t\t\t\t\tdf[i][j] = k;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t}\n\t\n\tC(pa, -1), C(pb, -1), C(pc, -1), C(pd, -1), C(pe, -1), C(pf, -1);\n\tRA(da, pa); RA(db, pb);\n\tRB(dc, pc), RB(dd, pd);\n\tRC(de, pe), RC(df, pf);\n\tE(da, pa, db, pb, m, l);\n\tE(dc, pc, dd, pd, n, l);\n\tE(de, pe, df, pf, n, m);\n\t\n    // \u52a0\u7b2c\u4e09\u7c7b\u8fb9\n\t#define HA(p, u, v, t)\\\n\tif (da[u][v] == t)\\\n\t\tadd(pa[u][v], p[i][j]);\\\n\telse if (db[u][v] == t)\\\n\t\tadd(pb[u][v], p[i][j]);\n\t#define HC(p, u, v, t)\\\n\tif (dc[u][v] == t)\\\n\t\tadd(pc[u][v], p[i][j]);\\\n\telse if (dd[u][v] == t)\\\n\t\tadd(pd[u][v], p[i][j]);\n\t#define HE(p, u, v, t)\\\n\tif (de[u][v] == t)\\\n\t\tadd(pe[u][v], p[i][j]);\\\n\telse if (df[u][v] == t)\\\n\t\tadd(pf[u][v], p[i][j]);\n\tfor (int i = 0, j, k, s = 0; i < m; i++)\n\t\tfor (j = 0; j < l; j++, s++)\n\t\t{\n\t\t\tif (da[i][j] != -1)\n\t\t\t\tfor (k = 0; k < da[i][j]; k++)\n\t\t\t\t\tif (ex[k][s]) { HC(pa, k, j, i) HE(pa, k, i, j) }\n\t\t\tif (db[i][j] != -1)\n\t\t\t\tfor (k = db[i][j] + 1; k < n; k++)\n\t\t\t\t\tif (ex[k][s]) { HC(pb, k, j, i) HE(pb, k, i, j) }\n\t\t}\n\tfor (int i = 0, j, k, s; i < n; i++)\n\t\tfor (j = 0; j < l; j++)\n\t\t{\n\t\t\tif (dc[i][j] != -1)\n\t\t\t\tfor (k = 0, s = 0; k < dc[i][j]; k++, s += l)\n\t\t\t\t\tif (ex[i][s+j]) { HA(pc, k, j, i) HE(pc, i, k, j) }\n\t\t\tif (dd[i][j] != -1)\n\t\t\t\tfor (k = dd[i][j] + 1; k < m; k++)\n\t\t\t\t\tif (ex[i][k*l+j]) { HA(pd, k, j, i) HE(pd, i, k, j) }\n\t\t}\n\tfor (int i = 0, j, k, s; i < n; i++)\n\t\tfor (j = 0, s = 0; j < m; j++, s += l)\n\t\t{\n\t\t\tif (de[i][j] != -1)\n\t\t\t\tfor (k = 0; k < de[i][j]; k++)\n\t\t\t\t\tif (ex[i][s+k]) { HA(pe, j, k, i) HC(pe, i, k, j) }\n\t\t\tif (df[i][j] != -1)\n\t\t\t\tfor (k = df[i][j] + 1; k < l; k++)\n\t\t\t\t\tif (ex[i][s+k]) { HA(pf, j, k, i) HC(pf, i, k, j) }\n\t\t}\n\t\n\tqueue<int> q;\n\tC(dis, 0x3f);\n\t\n    // \u786e\u8ba4\u8d77\u70b9\u548c\u7ec8\u70b9\u662f\u5426\u90fd\u5728\u5173\u952e\u70b9\u4e0a\n\tsx = sek(sx, sy, sz), tx = sek(tx, ty, tz);\n\tif (sx == -114514 || tx == -114514)\n\t{\n\t\tputs(\"-1\");\n\t\treturn 0;\n\t}\n\tq.push(sx), dis[sx] = 0;\n\t\n\tint cur;\n\twhile (!q.empty()) // BFS\n\t{\n\t\tcur = q.front(), q.pop();\n\t\tfor (int p = hd[cur]; p != -1; p = nxt[p])\n\t\t\tif (dis[des[p]] > dis[cur] + 1)\n\t\t\t{\n\t\t\t\tdis[des[p]] = dis[cur] + 1;\n\t\t\t\tq.push(des[p]);\n\t\t\t}\n\t}\n\t\n\tif (dis[tx] >= 0x3f3f3f)\n\t\tputs(\"-1\");\n\telse\n\t\tprintf(\"%d\\n\", dis[tx]);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1643286513,
        "uid": 119491,
        "name": "5ab_juruo",
        "ccfLevel": 0,
        "title": "P5806 \u9898\u89e3"
    }
]