[
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\u7ed9\u5b9a $k$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u4e0a\u7684\u4e24\u4e2a\u70b9\u7684\u5750\u6807\uff0c\u8bf7\u95ee\u8fd9\u4e24\u4e2a\u70b9\u4e4b\u95f4\uff0c\u5982\u679c\u6cbf\u7740\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8d70\uff0c\u8ddd\u79bb\u662f\u591a\u5c11?\n### \u9898\u76ee\u5206\u6790\n\n\u4e00\u770b\u8fd9\u9898\u4e0d\u662f\u628a\u8d70\u6cd5\u90fd\u7ed9\u51fa\u4e86\u5417\uff0c\u6240\u4ee5\u53ea\u8981\u6309\u7167\u9898\u76ee\u8981\u6c42\u8d70\u4e00\u904d\u5c31\u597d\u4e86\u3002\n\n\u4f46\u662f\uff01\uff01\uff01\u8fd9\u6837\u505a\u5f88\u96be\u77e5\u9053\u6bcf\u4e2a\u70b9\u5e94\u8be5\u600e\u4e48\u8d70\uff08\u89c4\u5f8b\u592a\u590d\u6742\u4e86\uff0c\u61d2\u5f97\u63a8\u4e86\uff09\u800c\u4e14\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(3 ^ {2\\times k})$ \u80af\u5b9a\u4f1a\u6302\u3002\n\n\u4e8e\u662f\u6211\u4eec\u4ed4\u7ec6\u89c2\u5bdf $k$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e2a\u4e8c\u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u5206\u6210 $3\\times3$ \u4e2a\u4e00\u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\uff0c\u800c\u4e14\u8fd9 $9$ \u4e2a\u7684\u6392\u5217\u987a\u5e8f\u4e0e\u4e00\u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u7684\u884c\u8d70\u987a\u5e8f\u662f\u4e00\u6837\u7684\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u9012\u5f52\u6c42\u89e3\uff0c\u5bf9\u4e8e $n$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u7684\u4e00\u4e2a\u70b9 $A(x_n,y_n)$\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 $A$ \u70b9\u7684\u8ddd\u79bb\u8f6c\u5316\u4e3a $n-1$ \u9636\u7684\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u603b\u8ddd\u79bb\u52a0\u4e0a $A$ \u5728\u7b2c $n$ \u9636\u7684\u8ddd\u79bb\u3002\u901a\u9879\u516c\u5f0f\u4e3a\uff1a\n\n$$A(n, x, y) = B(1, \\dfrac{x}{3 ^ {k-1}}, \\dfrac{y}{3 ^ {k-1}}) \\times 3 ^ {2 \\times 3 ^{k-1}} + A(n - 1, x_1, y_1)$$\n\n> PS\uff1a\u6309\u7167\u4e0a\u8ff0\u7b97\u6cd5\uff0c\u7b54\u6848\u6709\u53ef\u80fd\u662f\u8d1f\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u624b\u52a8\u53d6\u7edd\u5bf9\u503c\u3002\n\n### code\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#define int long long\n\nusing namespace std;\n\nint qpow[200], cnt[3][3] = {{0, 1, 2}, {5, 4, 3}, {6, 7, 8}}, k, x1, y_1, x2, y2;\n\nint calc(int p, int &x, int &y)\n{\n    int u = x / p, v = y / p;\n    x %= p, y %= p;\n    (u == 1) ? y = p - y - 1 : y;\n    (v == 1) ? x = p - x - 1 : x;\n    return cnt[u][v];\n}\n\nint dfs(int k, int x, int y)\n{\n\treturn (k == 1) ? cnt[x][y] : qpow[k-1] * qpow[k-1] * calc(qpow[k-1], x, y) + dfs(k-1, x, y);\n}\n \nsigned main()\n{\n\tscanf(\"%lld %lld %lld %lld %lld\", &k, &x1, &y_1, &x2, &y2);\n    k = k > 39 ? 39 : k;\n    qpow[0] = 1;\n    for(int i = 1;i <= 39;i++)\n\t\tqpow[i] = qpow[i - 1] * 3;\n    int ans = dfs(k, x1, y_1) - dfs(k, x2, y2);\n    printf(\"%lld\", abs(ans));\n    return 0;\n}\n```",
        "postTime": 1682501797,
        "uid": 551108,
        "name": "Zhang_bingjia",
        "ccfLevel": 3,
        "title": "P8730\u9898\u89e3"
    },
    {
        "content": "## \u7b80\u8981\u9898\u610f\n\n\u6c42\u4e24\u70b9\u4e4b\u95f4\u7684\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8ddd\u79bb\u3002\n\n## \u601d\u8def\n\n\u5c06\u8be5\u77e9\u5f62\u5206\u4e3a $9$ \u4e2a\u90e8\u5206\uff0c\u5982\u56fe\u6240\u793a\uff0c\u7528\u7ea2\u8272\u65b9\u6846\u6309\u987a\u5e8f\u6846\u51fa\u4e86\u5c31\u5404\u90e8\u5206\uff0c\u84dd\u6846\u662f\u6bcf\u4e2a\u90e8\u5206\u7684\u8d77\u70b9\uff1a\n\n![](https://huatu.98youxi.com/markdown/work/uploads/upload_a021469e2ba376205d5d8bd2abd493f9.png)\n\n\n\n\u8bb0 $(0, 0)$ \u5230 $(x, y)$ \u7684\u8ddd\u79bb\u5728 $k$ \u9636\u65f6\u4e3a $dis(k, x, y)$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0 $(x_1, y_1)$ \u5230 $(x_2, y_2)$ \u7684\u8ddd\u79bb\u7b49\u4e8e $|dis(k, x_1, y_1) - dis(k, x_2, y_2)|$ \u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u8ba1\u7b97\u4e24\u4e2a\u8ddd\u79bb\u7136\u540e\u5f97\u51fa\u7b54\u6848\u3002\n\n\u9996\u5148\u8bb0\u6b64\u65f6\u77e9\u5f62\u7684\u8fb9\u957f $len = 3^k$ \u548c\u8d70\u5b8c\u5176\u4e2d\u4e00\u4e2a\u90e8\u5206\u6240\u9700\u7684\u6b65\u6570 $step = \\frac{3^{2\\times k}}{9} = 2^{2\\times k - 2}$\u3002\n\n\u5728\u8fd9\u91cc\u660e\u786e\u4e00\u4e2a\u95ee\u9898\uff1a\u56e0\u4e3a\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8ddd\u79bb\u662f\u4ee5\u5de6\u4e0b\u89d2\u4e3a\u8d77\u70b9\uff0c\u53f3\u4e0a\u89d2\u4e3a\u7ec8\u70b9\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u8ba1\u7b97\u6bcf\u4e00\u4e2a\u90e8\u5206\u7684\u65f6\u5019\u8981\u628a\u84dd\u6846\u653e\u5230\u5de6\u4e0b\u89d2\uff0c\u6bcf\u6b21\u8ba1\u7b97\u7684\u65f6\u5019\u90fd\u8981\u628a\u539f\u5148\u7684 $(x, y)$ \u6539\u53d8\u6210\u4ee5\u5f53\u524d\u90e8\u5206\u7684\u8d77\u70b9\u4e3a\u53c2\u8003\u7cfb\u7684\u5750\u6807\u3002\n\n\u63a5\u4e0b\u6765\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $\\texttt{if }x < \\frac{len}{3}$\uff1a\n\n\t- $\\texttt{if }y < \\frac{len}{3}$\uff1a\u8bf4\u660e\u5728\u7b2c $1$ \u4e2a\u90e8\u5206\uff0c\u8d77\u70b9\u662f $(0, 0)$\uff0c\u4ee5\u7b2c $1$ \u90e8\u5206\u8d77\u70b9\u4e3a\u53c2\u8003\u7cfb\u8ba1\u7b97 $dis(k-1, x, y)$\u3002\n    \n   - $\\texttt{else if }y < \\frac{2len}{3}$\uff1a\u8bf4\u660e\u5728\u7b2c $2$ \u4e2a\u90e8\u5206\uff0c\u8d77\u70b9\u4e3a $(\\frac{len}{3}-1, \\frac{len}{3})$\uff0c\u4ee5\u7b2c $2$ \u90e8\u5206\u8d77\u70b9\u4e3a\u53c2\u8003\u7cfb\uff0c\u518d\u52a0\u4e0a\u7b2c $1$ \u90e8\u5206\u8d70\u7684\u8ddd\u79bb\u8ba1\u7b97 $step + dis(k-1, \\frac{len}{3}-1-x, y-\\frac{len}{3})$\u3002\n   \n   - $\\texttt{else}$\uff1a\u8bf4\u660e\u5728\u7b2c $3$ \u90e8\u5206\uff0c\u8d77\u70b9\u4e3a $(0, \\frac{2len}{3})$ \u8ba1\u7b97 $2 \\times step + dis(k - 1, x, y - \\frac{2len}{3})$\u3002\n   \n2. $\\texttt{else if }x < \\frac{2len}{3}$\uff1a\n\n\t- $\\texttt{if }y < \\frac{len}{3}$\uff1a\u8bf4\u660e\u5728\u7b2c $6$ \u4e2a\u90e8\u5206\uff0c\u8d77\u70b9\u662f $(\\frac{len}{3}, \\frac{len}{3}-1)$\uff0c\u8ba1\u7b97 $5 \\times step + dis(k-1, x-\\frac{len}{3}, \\frac{len}{3}-1-y)$\u3002\n    \n   - $\\texttt{else if }y < \\frac{2len}{3}$\uff1a\u8bf4\u660e\u5728\u7b2c $5$ \u4e2a\u90e8\u5206\uff0c\u8d77\u70b9\u4e3a $(\\frac{2len}{3}-1, \\frac{2len}{3}-1)$\uff0c\u8ba1\u7b97 $4\\times step + dis(k-1, \\frac{2len}{3}-1-x, \\frac{2len}{3}-1-y)$\u3002\n   \n   - $\\texttt{else}$\uff1a\u8bf4\u660e\u5728\u7b2c $4$ \u90e8\u5206\uff0c\u8d77\u70b9\u4e3a $(\\frac{len}{3}, len-1)$ \u8ba1\u7b97 $3 \\times step + dis(k - 1, x-\\frac{len}{3}, len-1-y)$\u3002\n   \n3. $\\texttt{else}$\uff1a\n\n\t- $\\texttt{if }y < \\frac{len}{3}$\uff1a\u8bf4\u660e\u5728\u7b2c $7$ \u4e2a\u90e8\u5206\uff0c\u8d77\u70b9\u662f $(\\frac{2len}{3}, 0)$\uff0c\u8ba1\u7b97 $6\\times dis(k-1, x-\\frac{2len}{3}, y)$\u3002\n    \n   - $\\texttt{else if }y < \\frac{2len}{3}$\uff1a\u8bf4\u660e\u5728\u7b2c $8$ \u4e2a\u90e8\u5206\uff0c\u8d77\u70b9\u4e3a $(len-1, \\frac{len}{3})$\uff0c\u8ba1\u7b97 $7\\times step + dis(k-1, len-1-x, y-\\frac{len}{3})$\u3002\n   \n   - $\\texttt{else}$\uff1a\u8bf4\u660e\u5728\u7b2c $9$ \u90e8\u5206\uff0c\u8d77\u70b9\u4e3a $(\\frac{len}{3}, len-1)$ \u8ba1\u7b97 $8 \\times step + dis(k - 1, x-\\frac{2len}{3}, y - \\frac{2len}{3})$\u3002\n\n\n## \u4ee3\u7801\n\n\u6ce8\u610f\u5728 $k > 40$ \u65f6\u4f1a\u7206 long long\uff0c\u6ce8\u610f\u7279\u5224\u4e00\u4e0b\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define setp setprecision\n#define mem(a, m) memset(a, m, sizeof(a));\nusing namespace std;\n\nll k;\nll x1, Y1, x2, y2;\nll qpow(ll a, ll b)\n{\n    if(!b)  return 1;\n    ll t=qpow(a, b/2);\n    if(b%2 == 0)    return t * t;\n    else    return t * t * a;\n}\nll dis(ll k, ll x, ll y)\n{\n\tif(k == 0)\treturn 1;\n\tll step = qpow(3, 2 * k - 2);\n\tll len = qpow(3, k);\n\tif(x < len / 3)\n\t{\n\t\tif(y < len / 3)\treturn dis(k - 1, x, y);//\u533a\u57df\u4e00 \n\t\telse if(y < len * 2 / 3)\treturn step + dis(k - 1, len / 3 - 1 - x, y - len / 3);//\u533a\u57df\u4e8c\n\t\treturn 2 * step + dis(k - 1, x, y - len * 2 / 3);//\u533a\u57df\u4e09 \n\t}\n\telse if(x < len * 2 / 3)\n\t{\n\t\tif(y < len / 3)\treturn 5 * step + dis(k - 1, x - len / 3, len / 3 - 1 - y);//\u533a\u57df\u516d \n\t\telse if(y < len * 2 / 3)\treturn 4 * step + dis(k - 1, len * 2 / 3 - 1 - x, len * 2 / 3 - 1 - y);//\u533a\u57df\u4e94 \n\t\treturn 3 * step + dis(k - 1, x - len / 3, len - 1 - y);//\u533a\u57df\u56db \n\t}\n\telse\n\t{\n\t\tif(y < len / 3)\treturn 6 * step + dis(k - 1, x - len * 2 / 3, y);//\u533a\u57df\u4e03 \n\t\telse if(y < len * 2 / 3)\treturn 7 * step + dis(k - 1, len - 1 - x, y - len / 3);//\u533a\u57df\u516b \n\t\treturn 8 * step + dis(k - 1, x - len * 2 / 3, y - len * 2 / 3);//\u533a\u57df\u4e5d \n\t}\n}\nint main()\n{\n\tios::sync_with_stdio(false);\n\tcin >> k >> x1 >> Y1 >> x2 >> y2;\n\tif(k >= 40)\tk = 39;\n\tcout << abs(dis(k, x1, Y1) - dis(k, x2, y2));\n\treturn 0;\n}\n\n\n```",
        "postTime": 1682429449,
        "uid": 778011,
        "name": "DreamLand_zcb",
        "ccfLevel": 4,
        "title": "P8730 [\u84dd\u6865\u676f 2020 \u56fd ABC] \u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8ddd\u79bb \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\n\n\u4e24\u4e2a\u70b9\u4e4b\u95f4, \u5982\u679c\u6cbf\u7740\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8d70, \u8ddd\u79bb\u662f\u591a\u5c11?\n\n### \u601d\u8def\n\n\u8003\u8651\u9012\u5f52\u6c42\u89e3\n\n\u6211\u4eec\u628a\u6bcf\u4e2a $n$ \u9636\u7684\u56fe\u770b\u6210\u4e5d\u4e2a $n-1$ \u9636\u7684\u56fe\u3002\n\n\u6839\u636e $n$ \u9636\u7684\u548c $n-1$ \u9636\u7684 $(x,y)$ \u4e4b\u95f4\u7684\u5173\u7cfb\u6765\u9010\u5c42\u964d\u9636\u3002\n\n\u5bf9\u4e8e $k$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u70b9 $a(k,x,y)$ \u7684\u8ddd\u79bb\u8868\u793a\u4e3a\n\n$a(k,x,y)=a(1,\\frac{x}{p},\\frac{y}{p})\\times(3^p)^2+a(k-1,x1,y1)$\u3002\n\n\u5176\u4e2d\n\n$a(1,\\frac{x}{p},\\frac{y}{p})$ \u8868\u793a $1$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8ddd\u79bb\uff0c$p=3^{k-1}$\u3002\n\n$(3^p)^2$ \u8868\u793a\u5c06\u6574\u4e2a $k$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u5212\u5206\u4e3a $1$ \u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\uff0c$1$ \u5355\u5143\u683c\u5185\u7684\u603b\u6570,\u5373\u603b\u8ddd\u79bb\u3002\n\n$a(k-1,xx,yy)$ \u8868\u793a $k$ \u9636 $(xx,yy)$ \u6620\u5c04\u5230 $k-1$ \u9636\u7684\u5750\u6807, \u4e3a\u4e0d\u5b8c\u6574\u5355\u5143\u683c\u5728 $k-1$ \u9636\u5230 $(xx,yy)$ \u7684\u8ddd\u79bb\u3002\u5176\u5212\u5206\u89c4\u5219\u4e3a\n\n```cpp\nif(x/p==1) yy=p-1-y;\nif(y/p==1) xx=p-1-x;   \n```\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u5199\u51fa\u4ee3\u7801\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <iostream>\nusing namespace std;\nlong long pw[200],leng[3][3] = {{0, 1, 2}, {5, 4, 3}, {6, 7, 8}};//3\u7684i\u6b21\u5e42\u548c1\u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u7684\u8ddd\u79bb\u77e9\u9635\nlong long len(long long p,long long &x,long long &y)//\u8ba1\u7b97\u8ddd\u79bb\uff0c\u53d8\u6362x,y\n{\n    long long ix=x/p,iy=y/p;\n    x%=p;\n\ty%=p;\n    if(ix == 1) y=p-1-y;\n    if(iy == 1) x=p-1-x;\n    return leng[ix][iy];\n}\nlong long a(long long k,long long x,long long y)//k\u9636\u76ae\u4e9a\u8bfa\u66f2\u7ebf\u70b9(0, 0)\u5230\u70b9(x, y)\u7684\u8ddd\u79bb\n{\n    if(k==1) return leng[x][y];\n    else return pw[k-1]*pw[k-1]*len(pw[k-1],x,y)+a(k-1,x,y);\n}\n \nint main()\n{\n    long long k,xx,yy,xxx,yyy;\n    cin>>k>>xx>>yy>>xxx>>yyy;\n    if(k>=40)k=39;//k>40\u65e0\u6548\u4e14\u7206long long\n    pw[0]=1;\n    for (int i=1;i<=39;i++) pw[i] = pw[i - 1] * 3;\n    long long ans=a(k,xx,yy)-a(k,xxx,yyy);\n    cout<<(ans>0?ans:-ans)<<endl;//\u7279\u5224 ans<0 \n    return 0;\n \n}\n```",
        "postTime": 1680704855,
        "uid": 734264,
        "name": "Alvin20100228",
        "ccfLevel": 0,
        "title": "P8730 [\u84dd\u6865\u676f 2020 \u56fd ABC] \u76ae\u4e9a\u8bfa\u66f2\u7ebf\u8ddd\u79bb"
    }
]