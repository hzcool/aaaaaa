[
    {
        "content": "\u4e00\u79cd\u6734\u7d20\u7684\u591a\u9879\u5f0f\u505a\u6cd5\u3002\n\n\u9996\u5148\u53d1\u73b0\u7b54\u6848\u4e0e\u51fa\u53d1\u7ed3\u675f\u70b9\u65e0\u5173\uff0c\u76f4\u63a5\u8bbe $f_{i,j}$ \u8868\u793a\u8d70\u8fc7\u8ddd\u79bb\u4e3a $i$\uff0c\u7ecf\u8fc7\u65c5\u5e97\u4e3a $j$ \u7684\u65b9\u6848\u6570\uff0c\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_{i,j}=\\sum_{d=1}^mf_{i-d,j-1}$$\n\n\u8bbe $ans_d$ \u8868\u793a\u8ddd\u79bb\u4e3a $d$ \u7684\u7b54\u6848\uff0c\u5219\n$$ans_d=\\sum_{i=0}^kf_{d,j}$$\n\n$f$ \u7684\u7b2c\u4e8c\u7ef4\u53ef\u4ee5\u8003\u8651\u7ecf\u5178\u77e9\u9635\u4f18\u5316\uff1b\u4f46\u8fdb\u4e00\u6b65\u53d1\u73b0\u8f6c\u79fb\u65b9\u7a0b\u7684\u5f62\u5f0f\u5f88\u50cf\u591a\u9879\u5f0f\u4e58\u6cd5\u3002\n\n\u5219\u8bbe\u72b6\u6001\u51fd\u6570 $F_k(x)$\uff0c\u8f6c\u79fb\u51fd\u6570 $G(x)$\uff0c\u7b54\u6848\u51fd\u6570 $A(x)$\uff0c\u4f7f \n$$\n\\begin{aligned}  \nF_k(x)&=\\sum_{i=0}^\\infty f_{i,k}x^i \\\\ \nG(x)&=\\sum_{i=1}^mx^i \\\\  \nA(x)&=\\sum_{i=0}^\\infty\\sum_{j=0}^kf_{i,j}x^i \n\\end{aligned}\n$$\n\u53c8\u6709 $F_0(x)=1$\uff0c\u53ef\u77e5\n$$\n\\begin{aligned}\nF_{k}(x)&=F_{k-1}(x)G(x) \\\\ \n&=G^k(x)\n\\end{aligned}\n$$\n\n\u8003\u8651\u7b54\u6848\u51fd\u6570\n$$\n\\begin{aligned}\nA(x)&=\\sum_{i=0}^kF_i(x) \\\\\n&=\\sum_{i=0}^kG^i(x) \\\\\n&=\\dfrac{1-G^{k+1}(x)}{1-G(x)}\n\\end{aligned}\n$$\n\n\u6b64\u65f6\u5df2\u53ef\u505a\u5230 $O(n\\log n\\log k)$ \u9884\u5904\u7406\uff0c$O(q)$ \u8be2\u95ee\u3002\n```\n#include<bits/stdc++.h>\n#define INF 1000000007\n#define MAXN 400000\nusing namespace std;\nconst int mod=998244353,og=3,invg=332748118;\n\ntemplate<typename T>\ninline void read( T& r )\n{\n\tr=0;\n\tbool w=true;\n\tchar ch=getchar();\n\twhile( ch<'0' || ch>'9' ) w=(!(ch^45))?false:w,ch=getchar();\n\twhile( ch>='0' && ch<='9' ) r=(r*10)+(ch^48),ch=getchar();\n\tr=w?r:-r;\n}\n//================================\nint n,m,k,q;\n\ninline int quick_pow( int a , int p )\n{\n\tint ret=1;\n\tfor(;p;p>>=1)\n\t{\n\t\tif( p&1 ) ret=1ll*ret*a%mod;\n\t\ta=1ll*a*a%mod;\n\t}\n\treturn ret;\n}\n\nint rev[MAXN+5];\ninline void ntt( int *a , int tep , int typ )\n{\n\tint len=1<<tep;\n\tfor(int i=1;i<len;i++) rev[i]=rev[i>>1]>>1 | (i&1)<<tep-1;\n\tfor(int i=1;i<len;i++) if( i>rev[i] ) swap(a[i],a[rev[i]]);\n\t\n\tfor(int j=1,lim,gn;j<=tep;j++)\n\t{\n\t\tlim=1<<j-1;\n\t\tgn=quick_pow(typ?og:invg,mod-1>>j);\n\t\tfor(int s=0,g0;s<len;s+=lim<<1)\n\t\t{\n\t\t\tg0=1;\n\t\t\tfor(int i=0;i<lim;i++,g0=1ll*g0*gn%mod)\n\t\t\t{\n\t\t\t\tint x=a[s+i],y=1ll*g0*a[s+i+lim]%mod;\n\t\t\t\ta[s+i]=(x+y)%mod;\n\t\t\t\ta[s+i+lim]=(x-y+mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif( !typ )\n\t{\n\t\tint inv=quick_pow(len,mod-2);\n\t\tfor(int i=0;i<len;i++) a[i]=1ll*a[i]*inv%mod;\n\t}\n}\ninline void mul( int *f , int *g , int n , int m )\n{\n\tint tep=0;\n\twhile( 1<<tep<=n+m ) ++tep;\n\tntt(f,tep,1),ntt(g,tep,1);\n\tfor(int i=0;i<1<<tep;i++) f[i]=1ll*f[i]*g[i]%mod;\n\tntt(f,tep,0),ntt(g,tep,0);\n}\nint c[MAXN+5];\ninline void inv( int *f , int *h , int deg )\n{//\u6c42mod x^(deg+1)\u610f\u4e49\u4e0bh\u7684\u9006f\n\tmemset(f,0,sizeof(f));memset(c,0,sizeof(c));\n\tf[0]=quick_pow(h[0],mod-2);\n\tfor(int tep=2;;tep++)\n\t{\n\t\tmemcpy(c,h,sizeof(int)*1<<tep-1);\n\t\tntt(c,tep,1),ntt(f,tep,1);\n\t\tfor(int i=0;i<1<<tep;i++) f[i]=(2-1ll*f[i]*c[i]%mod+mod)%mod*f[i]%mod;\n\t\tntt(f,tep,0);\n\t\tfor(int i=1<<tep-1;i<1<<tep;i++) f[i]=0;\n\t\tif( 1<<tep-1>deg ) break;\n\t}\n}\ninline void qpow( int *f , int p , int deg )\n{\n\tint tep=0;\n\twhile( 1<<tep<deg*2+1 ) ++tep;\n\t\n\tmemcpy(c,f,sizeof(int)*(deg+1));\n\tmemset(f+1,0,sizeof(int)*deg);\n\tf[0]=1;\n\tfor(;p;p>>=1)\n\t{\n\t\tif( p&1 ) mul(f,c,deg,deg);\n\t\tntt(c,tep,1);\n\t\tfor(int i=0;i<1<<tep;i++) c[i]=1ll*c[i]*c[i]%mod;\n\t\tntt(c,tep,0);\n\t}\n}\nint F[MAXN+5],G[MAXN+5],g[MAXN+5];\nint main()\n{\n\tread(n),read(m),read(k),read(q);\n\tfor(int i=1;i<=m;i++) g[i]=1;\n\tF[0]=(1-g[0]+mod)%mod; \n\tfor(int i=1;i<=n;i++) \n\t{\n\t\tF[i]=(mod-g[i])%mod;\n\t}\n\tqpow(g,k+1,n);\n\tG[0]=(1-g[0]+mod)%mod; \n\tfor(int i=1;i<=n;i++) \n\t{\n\t\tG[i]=(mod-g[i])%mod;\n\t}\n\tmemset(g,0,sizeof(g));\n\tinv(g,F,n);\n\tmul(G,g,n,n);\t\n\tfor(int i=1,l,r;i<=q;i++)\n\t{\n\t\tread(l),read(r);\n\t\tr=abs(l-r);\n\t\tprintf(\"%d\\n\",G[r]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1647229776,
        "uid": 389133,
        "name": "514InParadox",
        "ccfLevel": 6,
        "title": "P7493 \u591a\u9879\u5f0f"
    },
    {
        "content": "\n\n## \u9898\u610f\n\n\u4e00\u6761\u7b14\u76f4\u7684\u516c\u8def\u4e0a\u6709 $n$ \u4e2a\u65c5\u5e97\uff0c\u7b2c $i$ \u4e2a\u65c5\u5e97\u7684\u5750\u6807\u662f $i$\uff0c\u6bcf\u4e00\u5929\u65e9\u4e0a\u4ece\u65c5\u5e97\u51fa\u53d1\u8d70\u6700\u591a $m$ \u4e2a\u8ddd\u79bb\uff0c\u540c\u65f6\u56fa\u5b9a\u7ed9\u4f60\u4e00\u4e2a\u5e38\u6570 $k$\u3002\n\n\u7ed9\u5b9a $q$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u5b9a $u,v$\uff0c\u6c42\u65e9\u4e0a\u4ece\u65c5\u5e97 $u$ \u51fa\u53d1\u5230\u65c5\u5e97 $v$\uff0c\u9014\u5f84\u4e0d\u8d85\u8fc7 $k$ \u4e2a\u65c5\u5e97\uff08\u4e0d\u542b\u8d77\u70b9 $u$\uff09\u4e14\u884c\u8d70\u65b9\u5411\u4e0d\u53d8\u7684\u65b9\u6848\u6570\u3002\u4e24\u79cd\u65b9\u6848\u4e0d\u540c\u5f53\u4e14\u4ec5\u5f53\u5b58\u5728\u4e00\u4e2a\u4e0d\u540c\u7684\u65c5\u5e97\u9009\u62e9\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n\u5bf9\u4e8e\u6240\u6709\u6570\u636e\uff0c$n,q\\leq 10^5$\uff0c$m,k\\leq 10^4$\uff0c$mk\\leq 10^5$\uff0c$u,v\\leq n$\u3002\n\n## \u601d\u8def\n\n\u53d1\u73b0\u91cd\u8981\u7684\u4ec5\u4ec5\u662f $v-u$ \u7684\u503c\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u8bbe\u8ba1 $dp$ z\u72b6\u6001\u4e86\uff1a\n\n$F_{i,j}$ \u8868\u793a\u8d70\u5230 $i$ \u8d70\u4e86 $j$ \u6b65\u7684\u65b9\u6848\u6570\u3002\n\n\u7b54\u6848\u5c31\u662f\uff1a\n$$\n\\sum_{i=0}^{k}F_{v-u,i}\n$$\n\u7136\u540e\u8003\u8651\u8f6c\u79fb\uff1a\n$$\nF_{i,j}=\\sum_{k=1}^m F_{i-k,j-1}\n$$\n\u53d1\u73b0\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(nmk)$ \u7684\u3002\n\n\u4ea4\u6362\u4e24\u7ef4\uff0c\u6eda\u52a8\u6570\u7ec4\uff0c\u5c31\u53ef\u4ee5 dp \u4e86\u3002\n\n\u590d\u6742\u5ea6\u770b\u8d77\u6765 $10^{10}$ \u80fd\u8fc7\uff0c\u597d\u5427\uff0c\u770b\u8d77\u5566\u4e5f\u4e0d\u884c\uff0c\u4f46\u662f\u8fd8\u662f\u4f1a T\u3002\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u9b3c\u73a9\u610f\u3002\n\n\u4ea4\u6362\u4e24\u7ef4\uff0c\u4ee4\uff1a\n$$\nG_i(x)=\\sum_{j\\ge0}F_{i,j}x^j\n$$\n\u7136\u540e\u8f6c\u79fb\u5c31\u53d8\u6210\u4e86\uff1a\n$$\nG_i(x)=\\sum_{j\\ge 0}\\sum_{k=1}^m[x^{j-k}]G_{i-1}(x)\\cdot x^k\n$$\n\u8fd8\u6ca1\u6709\u770b\u51fa\u6765\uff1f\n$$\n[x^n]G_i(x)=\\sum_{k=1}^n[x^{n-k}]G_{i-1}(x)\\cdot [x^k]h(x)\n$$\n\u5176\u4e2d \uff1a\n$$\nh(x)=\\sum_{i=1}^mx^i\n$$\n\u660e\u663e\u540e\u9762\u5c31\u662f\u5377\u79ef\u4e86\uff08\u6bd4\u539f\u6765\u591a\u51fa\u6765\u7684\u9879\u90fd\u662f $0$\uff09\u3002\n\n\u7136\u540e\uff1a\n$$\nG_i(x)=G_{i-1}(x)\\cdot h(x)\n$$\n\u53ef\u4ee5\u76f4\u63a5\u7b97\u4e86\uff0c\u4f46\u662f\u590d\u6742\u5ea6 $O(nk \\log n)$ \u6700\u574f\u60c5\u51b5\u4e0b\u53cd\u800c\u589e\u52a0\u4e86\u3002\n\n\u4f46\u662f\u56e0\u4e3a $G_0(x)=1$ \u3002\n\n\u4e8e\u662f $G_i(x)=h(x)^i$ \u3002\n\n\u7136\u540e\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570\uff1a\n$$\nans(x)=\\sum_{i=0}^kG_i(x)\n$$\n\u5373\uff1a\n$$\n\\sum_{i=0}^kh(x)^i\n$$\n\u6839\u636e\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff1a\n$$\nans(x)=\\frac{1-h(x)^{k+1}}{1-h(x)} \n$$\n\u7531\u4e8e $k$ \u6bd4\u8f83\u5c0f\uff0c\u53ef\u4ee5\u8003\u8651\u76f4\u63a5\u500d\u589e\uff0c\u5e94\u8be5\u6bd4\u5927\u5e38\u6570 exp \u8981\u5feb\u3002\n\n\u8fd9\u91cc exp \u7531\u4e8e\u4e0d\u4fdd\u8bc1 $h(0)=1$\uff0c\u6240\u4ee5\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u76f8\u5f53\u9ebb\u70e6\uff0c\u8fd8\u5f97\u8ba1\u7b97\uff1a\n\n$(\\frac{h(x)}{x})^{k+1}\\cdot x^{k+1}$ \u3002\u7136\u540e\u679c\u7136\u6162\u4e86 500 \u591a ms\u3002\n\n\n\n## code\n\n\u677f\u5b50\u5c31\u4e0d\u653e\u4e86\uff0c\u8fd9\u662f\u500d\u589e\u7684\u3002\n\n```c++\nint main()\n{\t\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tint n,m,k,T;\n\tcin>>n>>m>>k>>T;\n\tvi h(m+1);\n\tfor(int i=1;i<=m;i++)h[i]=1;\n\tvi a(n+1);\n\tfor(int i=1;i<=min(n,m);i++)a[i]=mod-h[i];\n\ta[0]++;\n\tgetinv(a);\n\tvi ans={1};\n\tfor(int p=k+1;p;p>>=1)\n\t{\n\t\tif(p&1)\n\t\t{\n\t\t\tans=ans*h;\n\t\t\tif(ans.size()>n+1)ans.resize(n+1);\n\t\t}\n\t\tprework(n*2+2);h.resize(lim);\n\t\tntt(h,1);\n\t\tfor(int i=0;i<lim;i++)h[i]=mul(h[i],h[i]);\n\t\tntt(h,0);h.resize(n+1);\n\t}\n\tfor(int i=0;i<=n;i++)ans[i]=mod-ans[i];\n\tans[0]++;\n\tans=ans*a;\n\twhile(T--)\n\t{\n\t\tint u,v;cin>>u>>v;\n\t\tcout<<ans[abs(u-v)]<<'\\n';\n\t}\n\treturn 0;\n}\n```\n\n\u8fd9\u662f\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u7684\uff1a\n\n```c++\nint main()\n{\t\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tint n,m,k,T;\n\tcin>>n>>m>>k>>T;\n\tvi g(m+1);\n\tfor(int i=1;i<=m;i++)g[i]=1;\n\tvi a(n+1);\n\tfor(int i=1;i<=min(n,m);i++)a[i]=mod-g[i];\n\ta[0]++;\n\tgetinv(a);\n\tvi ans(max(n,m)+1);\n\tfor(int i=0;i<m;i++)ans[i]=1;\n\tgetln(ans);\n\tfor(int i=0;i<=n;i++)ans[i]=mul(ans[i],k+1);\n\tgetexp(ans);\n\tfor(int i=n-k-1;i>=0;i--)ans[i+k+1]=ans[i];\n\tfor(int i=0;i<=k;i++)ans[i]=0;\n\tfor(int i=0;i<=n;i++)ans[i]=mod-ans[i];\n\tans[0]++;\n\tans=ans*a;\n\twhile(T--)\n\t{\n\t\tint u,v;cin>>u>>v;\n\t\tcout<<ans[abs(u-v)]<<'\\n';\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1673916363,
        "uid": 571229,
        "name": "__stick",
        "ccfLevel": 7,
        "title": "P7493 [\u4f20\u667a\u676f #3 \u51b3\u8d5b] \u65c5\u4eba1969"
    }
]