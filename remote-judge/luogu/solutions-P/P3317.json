[
    {
        "content": "\n\n\n## \u505a\u6cd5\n\n\u6211\u4eec\u90fd\u77e5\u9053(\u5176\u5b9e\u6211\u662f\u521a\u77e5\u9053\u7684)\uff0c\u77e9\u9635\u6811\u6c42\u7684\u662f\uff1a$\\sum\\limits_{T}\\prod\\limits_{e \\in T}p_e$\n\n\u800c\u8fd9\u9898\u6c42\u7684\u662f\uff1a$\\sum\\limits_{T}(\\prod\\limits_{e\\in T}p_e \\prod\\limits_{e\\notin T} (1-p_e))$\n\n\u901a\u4fd7\u5730\u5c06\uff1a\u679a\u4e3e\u6bcf\u4e2a\u6811\uff0c\u5c5e\u4e8e\u8fd9\u4e2a\u6811\u8fb9\u51fa\u73b0\u7684\u6982\u7387$\u00d7$\u975e\u6811\u8fb9\u51fa\u73b0\u7684\u6982\u7387\n\n$$\\sum\\limits_{T}(\\prod\\limits_{e\\in T}p_e \\prod\\limits_{e\\notin T} (1-p_e))$$\n\n$$=\\sum\\limits_{T}(\\prod\\limits_{e\\in T}p_e \\frac{\\prod_{e}(1-P_e)}{\\prod_{e\\in T}(1-P_e)})$$\n$$=\\prod\\limits_{e}(1-p_e)(\\sum\\limits_{T}\\prod\\limits_{e\\in T}\\frac{pe}{(1-pe)})$$\n\n\u5316\u6210\u6807\u51c6\u5f62\u5f0f\u5957\u819c\u62dc\u5c31\u597d\u4e86\n\n## [Code](https://www.cnblogs.com/y2823774827y/p/10266614.html)",
        "postTime": 1547448698,
        "uid": 88804,
        "name": "y2823774827y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "\u6ca1\u4eba\u53d1\u9898\u89e3\uff1f\u90a3\u6211\u5c31\u6765\u6c34\u4e00\u7bc7\uff08\u9003\uff09\n\n\u9996\u5148\uff0c\u5927\u5bb6\u5e94\u8be5\u90fd\u80fd\u770b\u51fa\u6765\u8fd9\u662f\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u7136\u540e\u5927\u90e8\u5206\u4eba\u5e94\u8be5\u5c31\u4f1a\u628a\u6982\u7387\u76f4\u63a5\u5e26\u8fdb\u53bb\u7b97\uff0c\u7136\u540e\u5c31\u6109\u5feb\u5730WA\u6389\u4e86\uff08\u6211\u5f53\u65f6\u5c31\u662f\u8fd9\u4e48\u60f3\u7684\uff0c\u5e78\u4e8f\u6ca1\u4ea4\uff09\n\n\u7136\u540e\u5c31\u6765\u8bb2\u8fd9\u4e2a\u9898\u7684\u6b63\u89e3\u601d\u8def\u3002\n\n\u9996\u5148\u6211\u4eec\u6765\u770b\u7b54\u6848\u5e94\u8be5\u662f\u600e\u6837\u7684\uff1a\n\n$$ans=\\sum_{Tree}\\prod_{(u,v)\\in E} P_{(u,v)}\\prod_{(u,v)\\notin E}\\big(1-P_{(u,v)}\\big)$$\u7136\u540e\u6211\u4eec\u6765\u60f3\u4e00\u4e0b\u600e\u4e48\u6765\u6784\u9020\u8fd9\u4e2a\u7b54\u6848\uff1a\u9996\u5148\uff0c\u6211\u4eec\u76f4\u63a5\u77e9\u9635\u6811\u7528\u9ad8\u65af\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u5e94\u8be5\u662f\u8fd9\u4e2a\uff1a\n\n$$now=\\sum_{Tree}\\prod_{(u,v)\\in E} P_{(u,v)}$$\u90a3\u6211\u4eec\u600e\u4e48\u8ba9\u5b83\u53d8\u6210\u7b54\u6848\u90a3\u4e2a\u6837\u5b50\u5462\uff1f\u76f4\u89c2\u5730\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\uff1a\n\n$$now=now*\\prod_{(u,v)}\\big(1-P_{(u,v)}\\big)$$\u7136\u540e\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\u5b50\uff1a\n\n$$now=\\sum_{Tree}\\prod_{(u,v)\\in E} P_{(u,v)}*\\big(1-P_{(u,v)}\\big)\\prod_{(u,v)\\notin E}\\big(1-P_{(u,v)}\\big)$$\u73b0\u5728\u6211\u4eec\u53d1\u73b0now\u4e0e\u7b54\u6848\u6709\u7740\u4e2d\u95f4\u90a3\u4e00\u90e8\u5206\u7684\u5dee\u8ddd\uff0c\u90a3\u4e48\u5982\u4f55\u6d88\u9664\u90a3\u4e2a\u5dee\u8ddd\u5462\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u6ce8\u610f\u5230\u5f0f\u5b50\u4e2d\u7684\u7b2c\u4e00\u4e2a$P_{(u,v)}$\u5176\u5b9e\u5c31\u662f\u77e9\u9635\u7684\u521d\u503c\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u8fd9\u4e2a\uff1a\n\n$$now=\\sum_{Tree}\\prod_{(u,v)\\in E} A_{u,v}*\\big(1-P_{(u,v)}\\big)\\prod_{(u,v)\\notin E}\\big(1-P_{(u,v)}\\big)$$\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u5c31\u662f\u8981\u8ba9\uff1a\n\n$$A_{u,v}*\\big(1-P_{(u,v)}\\big)\\to P_{(u,v)}$$\u60f3\u5fc5\u6211\u8bf4\u5230\u73b0\u5728\u5927\u5bb6\u5e94\u8be5\u5c31\u61c2\u4e86\u5427\uff0c\u6211\u4eec\u53ea\u8981\u8fd9\u6837\uff1a\n\n$$A_{u,v}=\\frac {P_{(u,v)}}{\\big(1-P_{(u,v)}\\big)}$$\u8fd9\u6837\u6211\u4eec\u73b0\u5728\u7684now\u503c\u5c31\u662f\u7b54\u6848\u4e86\uff01\n\n$$tmp=\\prod_{(u,v)}\\big(1-P_{(u,v)}\\big)$$ $$now=tmp*\\sum_{Tree}\\prod_{(u,v)\\in E} \\frac {P_{(u,v)}}{\\big(1-P_{(u,v)}\\big)}$$\n\n\u8fd8\u6709\u5c31\u662f\u51e0\u4e2a\u6280\u5de7\uff1a\n\n\u5f53\u77e9\u9635\u4e2d\u51fa\u73b0$|a|<eps$\u65f6\u5c31$a=eps$\n\u5f53\u77e9\u9635\u4e2d\u51fa\u73b0$|1-a|<eps$\u65f6\u5c31$a=1-eps$\n\u81ea\u5df1\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\u3002\n\n\u770b\u6211\u6253\u516c\u5f0f\u8fd9\u4e48\u8f9b\u82e6\uff0c\u5c31\u6765[\u6211\u7684blog](http://blog.csdn.net/stone41123/article/details/78050473)\u770b\u770b\u5427^\\_^\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n/**************************************************************\n    Problem: 3534\n    User: stone41123\n    Language: C++\n    Result: Accepted\n    Time:16 ms\n    Memory:1308 kb\n****************************************************************/\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nint n;\ndouble a[51][51];\ndouble ans;\ndouble eps=1e-8;\nvoid gauss(){\n    for(int i=1;i<n;i++){\n        int mx=i;\n        for(int j=i+1;j<n;j++){\n            if(fabs(a[j][i])>fabs(a[mx][i]))mx=j;\n        }\n        if(mx!=i)for(int j=1;j<n;j++)swap(a[i][j],a[mx][j]);\n        for(int k=i+1;k<n;k++){\n            double mul=a[k][i]/a[i][i];\n            for(int j=i;j<n;j++){\n                a[k][j]-=a[i][j]*mul;\n            }\n        }\n        if(fabs(a[i][i])<eps){\n            ans=0;\n            return;\n        }\n    }\n    for(int i=1;i<n;i++){\n        ans*=a[i][i];\n    }\n    ans=fabs(ans);\n}\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++){\n        for(int j=1;j<=n;j++){\n            scanf(\"%lf\",&a[i][j]);\n        }\n    }\n    ans=1;\n    double tmp=1;\n    for(int i=1;i<=n;i++){\n        for(int j=1;j<=n;j++){\n            if(fabs(a[i][j])<eps)a[i][j]=eps;\n            if(fabs(1.0-a[i][j])<eps)a[i][j]=1-eps;\n            if(i<j)tmp*=1.0-a[i][j];\n            a[i][j]=a[i][j]/(1.0-a[i][j]);\n        }\n    }\n    for(int i=1;i<=n;i++){\n        a[i][i]=0;\n        for(int j=1;j<=n;j++){\n            if(i!=j)\n            a[i][i]-=a[i][j];\n        }\n    }\n    gauss();\n    ans*=tmp;\n    printf(\"%.10lf\",ans);\n    return 0;\n}\n```",
        "postTime": 1505972066,
        "uid": 39505,
        "name": "\u73ab\u8475\u4e4b\u8776",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u6bcf\u6761\u8fb9\u90fd\u6709\u4e00\u5b9a\u6982\u7387$p\\in[0,1]$\u51fa\u73b0\u5728\u56fe\u4e2d,\u6c42\u751f\u6210\u4e00\u68f5\u6811\u7684\u6982\u7387\u662f\u591a\u5c11\n\n---\n\n### \u9898\u89e3\n\n\u53ef\u4ee5\u60f3\u4e00\u4e2a\u7b80\u5355\u7684\u66b4\u529b\u679a\u4e3e\u6240\u6709\u6811$T$,\u7136\u540e\n\n$$Ans=\\sum_T\\prod_{e\\in T}p_e\\prod_{e\\notin T}(1-p_e)$$\n\n\u9898\u76ee\u4e2d\u8981\u95ee\u7684\u751f\u6210\u6811\u7684\u6982\u7387,\u65e2\u7136\u662f\u751f\u6210\u6811\u90a3\u4e48\u60f3\u4e00\u60f3\u5e94\u8be5\u8981\u7528\u5230\u77e9\u9635\u6811\u5b9a\u7406\u6765\u6c42\n\n\u6839\u636e\u57fa\u5c14\u970d\u592b\u77e9\u9635\u7684[\u5b9a\u4e49](https://baike.baidu.com/item/%E5%8F%98%E5%85%83%E7%9F%A9%E9%98%B5-%E6%A0%91%E5%AE%9A%E7%90%86?fr=aladdin)\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4ed6\u4efb\u610f\u4e00\u4e2a\u4ee3\u6570\u4f59\u5b50\u5f0f\u662f**\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u79ef\u7684\u548c** \n\n~~\u8bf4\u4eba\u8bdd\u5c31\u662f\u6c42\u7684~~\n\n$$\\sum_T\\prod_{e\\in T}w_e$$\n\n\u548c\u4e0a\u9762\u8981\u6c42\u7684\u957f\u5f97\u597d\u50cf,\u4f46\u662f\u540e\u9762\u90a3\u4e00\u5768\u600e\u4e48\u529e?\n\n\u8003\u8651\u5230\n\n$$\\prod_{e\\notin T}(1-p_e)=\\frac{\\prod_e(1-p_e)}{\\prod_{e\\in T}(1-p_e)}$$\n\n\u628a\u8fd9\u4e2a\u5e26\u56de\u53bb\u5c31\u5f97\u5230\u4e86\n\n$$Ans=\\prod_e(1-p_e)\\sum_T\\prod_{e\\in T}\\frac{p_e}{1-p_e}$$\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u4ee4$w_e=\\frac{p_e}{1-p_e}$\u7136\u540e\u7528\u9ad8\u65af\u6d88\u5143\u6c42\u4e00\u904d\u884c\u5217\u5f0f\u518d\u4e58\u4e0a\u524d\u9762\u90a3\u4e00\u5768\u5c31\u597d\u4e86\n\n\u8981\u662f$p_e=1$\u600e\u4e48\u529e$?$\n\n\u8003\u8651\u5230$\\frac1{1-p_e}\\to\\infty$\u53c8\u6709$\\frac1\\epsilon\\approx\\infty$\u6240\u4ee5\u8fd1\u4f3c\u4ee4$p_e=1-\\epsilon$\u5c31\u597d\u4e86\n\n```\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nconst int N=55;\nconst double eps=1e-8;\ntypedef double d;\nint n;d prod=1,G[N][N];\ninline int cmp(double x){return fabs(x)<eps?0:(x<0?-1:1);}\ninline d det(int n){\n    int mx;d t,tp=1;\n    fp(i,1,n){mx=i;\n        fp(j,i+1,n)if(cmp(G[mx][i]-G[j][i])<0)mx=i;\n        if(mx^i)fp(j,i,n)swap(G[i][j],G[mx][j]);\n        if(!G[i][i])return 0;\n        fp(j,i+1,n){\n            t=G[j][i]/G[i][i];\n            fp(k,i,n)G[j][k]-=G[i][k]*t;\n        }tp*=G[i][i];\n    }\n    return fabs(tp);\n}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    scanf(\"%d\",&n);\n    fp(i,1,n)fp(j,1,n){\n        scanf(\"%lf\",G[i]+j);\n        if(i==j)continue;\n        if(G[i][j]>1-eps)G[i][j]-=eps;\n        if(i<j)prod*=(1-G[i][j]);\n        G[i][j]/=(1-G[i][j]);\n    }\n    fp(i,1,n)fp(j,1,n)if(i^j)\n        G[i][i]+=G[i][j],G[i][j]=-G[i][j];\n    printf(\"%.8lf\\n\",det(n-1)*prod);\nreturn 0;\n}\n```",
        "postTime": 1522304514,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "[Link](https://www.luogu.com.cn/problem/P3317)\n----------------\n\n### Description\n\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u56fe $G$\uff0c\u6bcf\u4e24\u4e2a\u70b9\u4e4b\u95f4\u90fd\u6709\u4e00\u4e2a\u6982\u7387 $p_{i,j}$ \u5b58\u5728\u4e00\u6761\u8fb9\u3002\u6c42\u5b58\u5728\u751f\u6210\u6811\u7684\u6982\u7387\u3002\n\n### Solution\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684\u751f\u6210\u6811 $T$\uff0c\u5176\u8fb9\u96c6\u4e3a $E$\uff0c\u90a3\u4e48\u751f\u6210\u5b83\u7684\u6982\u7387\u5c31\u662f\n$$\\prod_{e\\in E} p_e \\prod_{e'\\notin E} (1-p_{e'})$$\n\u5373\u51fa\u73b0\u6811\u8fb9\u7684\u6982\u7387\u79ef\u4e58\u4e0a\u4e0d\u51fa\u73b0\u975e\u6811\u8fb9\u7684\u6982\u7387\u79ef\u3002\u90a3\u4e48\u6240\u6709\u751f\u6210\u6811\u7684\u6982\u7387\u5c31\u662f\n$$\\sum_{T} \\prod_{e\\in E} p_e \\prod_{e'\\notin E} (1-p_{e'})$$\n\u4f46\u662f\u8fd9\u5e76\u4e0d\u80fd\u76f4\u63a5\u5957 Matrix-tree \u3002\u8003\u8651\u5230 Matrix-tree \u6c42\u7684\u662f\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u79ef\u4e4b\u548c\uff0c\u6240\u4ee5\u9700\u8981\u60f3\u529e\u6cd5\u5c06\u540e\u9762\u7684\u5f0f\u5b50\u5316\u6210\u8fb9\u6743\u79ef\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u5982\u679c\u628a\u8fb9\u6743\u8bbe\u6210 $\\frac{p_e}{1-p_e}$ \u5c31\u80fd\u5f88\u597d\u7684\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u7b54\u6848\u5373\u4e3a\n$$\\prod_{e} (1-p_e)\\sum_{T} \\prod_{e\\in E} \\frac{p_e}{1-p_e}$$\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5bf9\u4e8e\u4e00\u6761\u8fb9\uff0c\u5176\u51fa\u73b0\u7684\u6982\u7387\u53ef\u80fd\u662f 1\u3002\u8fd9\u5c31\u76f4\u63a5\u5bfc\u81f4\u4e86\u5206\u6bcd\u4e3a 0\uff0c\u9664\u6cd5\u4f1a\u51fa\u95ee\u9898\u3002\u4e00\u5f00\u59cb\u60f3\u7684\u662f\u6709\u6ca1\u6709\u4ec0\u4e48\u505a\u6cd5\u53ef\u4ee5\u6c42\u7ed9\u5b9a\u786e\u5b9a\u8fb9\u7684\u751f\u6210\u6811\u4e2a\u6570\uff0c\u7136\u540e\u540e\u9762\u653e\u5f03\u4e86\u2026\u2026\u8f6c\u800c\u56de\u6765\u60f3\u5148\u524d\u7684\u505a\u6cd5\u3002\u4e3b\u8981\u95ee\u9898\u5728\u4e8e\u4e0d\u80fd\u9664 0\uff0c\u7136\u540e\u6211\u975e\u5e38\u7075\u6027\u5730\u5bf9\u6240\u6709\u6570\u52a0\u4e86\u4e00\u4e2a $eps=10^{-10}$ \u2026\u2026\u7adf\u4e00\u53d1\u8fc7\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(n^3)$\n\n```cpp\n#include<stdio.h>\n#define N 53\n#define eps 1e-10\n\nint n;\ndouble a[N][N];\nint main(){\n\tscanf(\"%d\",&n);\n\tdouble ans=1;\n\tfor(int i=1;i<=n;i++)\n    \tfor(int j=1;j<=n;j++){\n        \tdouble x;\n        \tscanf(\"%lf\",&x);\n        \tx+=eps;\n        \tif(i!=j) a[i][j]=-x/(1-x),a[i][i]+=x/(1-x);\n        \tif(i<j) ans*=(1-x);\n        }\n\tfor(int i=2;i<=n;i++){\n    \tfor(int j=i+1;j<=n;j++){\n        \tdouble t=a[j][i]/a[i][i];\n        \tfor(int k=i;k<=n;k++)\n            \ta[j][k]-=a[i][k]*t;\n        }\n    \tans*=a[i][i];\n    }\n\tprintf(\"%.4lf\",ans);\n}\n/*\n3\n0 0.5 0.5\n0.5 0 0.5\n0.5 0.5 0\n*/\n```",
        "postTime": 1612009725,
        "uid": 83337,
        "name": "wwlw",
        "ccfLevel": 7,
        "title": "[SDOI2014]\u91cd\u5efa"
    },
    {
        "content": "[Blog](https://ctz45562.github.io/2019/12/17/%E6%B4%9B%E8%B0%B7-P3317-SDOI2014-%E9%87%8D%E5%BB%BA/)\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P3317)\n\n\u53ea\u6709\u6211\u662f\u66b4\u529b\u7f29\u70b9\u641e\u7684\u5417\u3002\u3002\u3002\n\n\u4ee4$E$\u4e3a\u751f\u6210\u6811\u8fb9\u96c6\uff0c\u663e\u7136\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f$\\sum\\limits_E\\left(\\prod\\limits_{e\\in E}p_e\\prod\\limits_{e\\notin E}(1-p_e)\\right)$\n\n\u4ee4$P=\\prod(1-p_e)$\uff0c\u5373\u539f\u56fe\u6240\u6709\u8fb9\u7684$1-p_e$\u4e4b\u79ef\u3002\u4e0a\u9762\u7684\u5f0f\u5b50\u5c31\u6210\u4e86$P\\sum\\limits_E\\left(\\prod\\limits_{e\\in E}\\dfrac{p_e}{1-p_e}\\right)$\n\n\u76f4\u63a5\u53d8\u5143\u77e9\u9635\u6811\u5b9a\u7406\u641e\u5b83\u5c31\u5b8c\u4e8b\u4e86\u3002\u3002\u3002\u5417\uff1f\n\n\u82e5$p_e=1$\uff0c\u4f1a\u51fa\u73b0\u5206\u6bcd\u4e3a$0$\u7684\u60c5\u51b5\u3002\u5176\u4ed6\u9898\u89e3\u91cc\u90fd\u662f\u6539\u4e3a$1-eps$\uff0c\u7cbe\u5ea6\u8bef\u5dee\u53ef\u4ee5\u63a5\u53d7\u3002\n\n\u6ca1\u60f3\u5230\u4e8e\u662f\u66b4\u529b\u7f29\u70b9\u3002$p_e=1$\u8bf4\u660e\u751f\u6210\u6811\u4e2d\u4e00\u5b9a\u6709\u8fd9\u6761\u8fb9\uff0c\u7528\u5e76\u67e5\u96c6\u7f29\u6210\u4e00\u4e2a\u70b9\u3002\n\n\u5bf9\u4e8e\u4e24\u7aef\u70b9\u5728\u540c\u4e00\u5e76\u67e5\u96c6\u7684$e$\uff0c\u82e5$p_e\\neq 1$\uff0c\u5f53\u6210\u81ea\u73af\u4e0d\u7528\u7ba1\u5b83\uff1b\u82e5$p_e=1$\uff0c\u8bf4\u660e\u4e00\u5b9a\u4f1a\u51fa\u6765\u4e00\u4e2a\u73af\uff0c\u8f93\u51fa`0`\u3002\u7136\u800c\u6211\u4e00\u5f00\u59cb\u6ca1\u5224\u8fc7\u4e86\uff0c\u5927\u6982\u662f\u6570\u636e\u6c34\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n\n#define maxn 55\n#define inf 0x3f3f3f3f\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\ndouble a[maxn][maxn],e[maxn][maxn];\nint cnt,fa[maxn],id[maxn];\ninline void add(int x,int y,double l){a[x][x]+=l,a[y][y]+=l,a[x][y]-=l,a[y][x]-=l;}\nint find(int x){return fa[x]==x?x:fa[x]=find(fa[x]);}\ndouble Gauss(){\n\tdouble ans=1.0;\n\tfor(register int i=2;i<=cnt;++i){\n\t\tint t=i;\n\t\tfor(register int j=i+1;j<=cnt;++j)if(fabs(a[j][i])>fabs(a[t][i]))t=j;\n\t\tif(t!=i)swap(a[t],a[i]),ans=-ans;\n\t\tfor(register int j=i+1;j<=cnt;++j)\n\t\t\tfor(register int k=cnt;k>=i;--k)\n\t\t\t\ta[j][k]-=a[i][k]*a[j][i]/a[i][i];\n\t\tans*=a[i][i];\n\t}\n\treturn ans;\n}\nint main(){\n\tint n=read();\n\tdouble P=1.0;\n\tfor(register int i=1;i<=n;++i)fa[i]=i;\n\tfor(register int i=1;i<=n;++i)\n\t\tfor(register int j=1;j<=n;++j){\n\t\t\tscanf(\"%lf\",&e[i][j]);\n\t\t\tif(i<j&&e[i][j]==1.0){\n\t\t\t\tint u=find(i),v=find(j);\n\t\t\t\tif(u==v){puts(\"0.000000\");return 0;}\n\t\t\t\tfa[u]=v;\n\t\t\t}\n\t\t}\n\tfor(register int i=1;i<=n;++i){\n\t\tif(!id[find(i)])id[find(i)]=++cnt;\n\t\tid[i]=id[find(i)];\n\t}\n\tfor(register int i=1;i<=n;++i)\n\t\tfor(register int j=1;j<=n;++j)\n\t\t\tif(i<j&&e[i][j]!=1.0)add(id[i],id[j],e[i][j]/(1.0-e[i][j])),P*=1.0-e[i][j];\n\tprintf(\"%.8lf\\n\",Gauss()*P);\n}\n```\n",
        "postTime": 1576552545,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u53d1\u8868\u4e8e[\u6211\u7684\u4e2a\u4eba\u535a\u5ba2](https://wa-automaton.github.io/2019/03/07/BZOJ3534/)qwq\n\n# \u9898\u76ee\u5927\u610f\uff1a\n\u4f60\u6709\u4e00\u4e2a\u65e0\u5411\u5b8c\u5168\u56fe\u3002\u5728\u4e00\u573a\u6d2a\u6c34\uff08\uff1f\uff09\u4ee5\u540e\uff0c\u6bcf\u6761\u8fb9\u90fd\u53ef\u80fd\u4f1a\u635f\u6bc1\u3002\u7ed9\u5b9a\u6bcf\u6761\u8fb9\u6ca1\u6709\u88ab\u635f\u6bc1\u7684\u6982\u7387\uff0c\u6c42\u6700\u540e\u5269\u4e0b\u7684\u8fb9\u6b63\u597d\u7ec4\u6210\u539f\u6765\u7684\u56fe\u7684\u4e00\u68f5\u751f\u6210\u6811\u7684\u6982\u7387\u3002\n\n# \u5206\u6790\n\u8bbe\u4e00\u6761\u8fb9$w$\u635f\u6bc1\u7684\u6982\u7387\u4e3a$E(w)$\u3002\u7531\u9898\u610f\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5176\u5b9e\u662f\n$$\\sum_{T \\ is \\ a \\ spanning \\ tree \\ of \\ G}\\prod_{e\\in T}E(e)\\prod_{e\\in \\complement_G^T}(1-E(e))\\ \\ \\ (*)$$\n\u628a\u8fd9\u4e2a\u67ff\u5b50\u5199\u51fa\u6765\uff0c\u6211\u4eec\u53d1\u73b0\u5b83\u5f88\u50cf\u53d8\u5143\u77e9\u9635\u6811\u5b9a\u7406..\u6240\u4ee5\u8003\u8651\u600e\u4e48\u5316\u6210\u77e9\u9635\u6811\u5b9a\u7406\u7684\u5f62\u5f0f.  \n\u6211\u4eec\u662f\u8981\u628a\u5b83\u5316\u4e3a$\\sum_T \\prod_{e\\in T} w(e)$\u7684\u5f62\u5f0f...\u90a3\u4e48\u5fc5\u987b\u628a\u540e\u9762\u4e00\u9879\u5411T\u4e2d\u7684\u8fb9\u9760\u62e2\u3002\u600e\u4e48\u505a\u5462\uff1f  \n\u6211\u4eec\u5c06\u540e\u9762\u4e00\u4e2a\u8fde\u4e58\u67ff\u5b50\u53d8\u6362\u4e00\u4e0b\u5f62\u5f0f...\n$$\\prod_{e\\in \\complement_G^T}(1-E(e))=\\prod_{e \\in G}(1-E(e))*\\prod_{e \\in T}\\frac{1}{(1-E(e))}$$\n\u5219..\n$$(*)=\\prod_{e \\in G}(1-E(e)) *\\sum_T \\prod_{e\\in T}\\frac{E(e)}{1-E(e)} $$\n\u8fd9\u5c31\u662f\u77e9\u9635\u6811\u5b9a\u7406\u677f\u5b50\u4e86..\n\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282\uff1a\u5f53\u6982\u7387\u7b49\u4e8e1\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f1a\u7b97\u51fa\u6765nan..\u4e8e\u662f\u6211\u60f3\u7f29\u70b9...\u5176\u5b9e\u5e76\u4e0d\u9700\u8981\u590d\u6742\u7684\u5206\u7c7b\u8ba8\u8bba\u3001\u7f29\u70b9\u4e4b\u7c7b\u7684\uff0c\u53ea\u9700\u8981\u5c061\u51cf\u53bb\u4e00\u4e2aeps\u5c31\u884c\u4e86\u3002\u9020\u6210\u7684\u7cbe\u5ea6\u8bef\u5dee\u4e0d\u4f1a\u592a\u5927\u7684^_^\u3002\n\u7136\u540e\u6211\u4eec\u5c31\u73c2\u4ee5\u6109\u5feb\u5730AC\u8fa3\uff01\n# \u53c2\u8003\u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\n\nusing std::swap;\nusing std::fabs;\n\nconst int maxn=1e3+1;\nconst double eps=1e-6;\n\ndouble G[maxn][maxn];\n\ninline double determinant(double (*A)[maxn],int n)\n{\n    for (int i=1,c=1,j;i<=n;++i)\n    {\n        for (j=c;j<=n && fabs(A[j][i])<eps;++j);\n        if (j==n+1) continue;\n        for (int k=1;k<=n;++k) swap(A[c][k],A[j][k]);\n        for (int j=c+1;j<=n;++j)\n            if (fabs(A[j][i])>eps)\n            {\n                double t=A[j][i]/A[c][i];\n                for (int k=i;k<=n;++k)\n                    A[j][k]-=A[c][k]*t;\n            }\n        ++c;\n    }\n    double ans=1;\n    for (int i=1;i<=n;++i) ans*=A[i][i];\n    return fabs(ans);\n}\n\nint main()\n{\n    int n;\n    scanf(\"%d\",&n);\n    for (int i=1;i<=n;++i)\n        for (int j=1;j<=n;++j)\n        {\n            scanf(\"%lf\",&G[i][j]);\n            if (G[i][j]==1) G[i][j]-=eps;\n        }\n    double prod=1;\n    for (int i=1;i<=n;++i)\n        for (int j=1;j<i;++j)\n            prod*=1-G[i][j];\n    for (int i=1;i<=n;++i)\n        for (int j=1;j<=n;++j)\n            if (i!=j) G[i][j]=G[i][j]/(1-G[i][j]),G[i][i]+=G[i][j],G[i][j]=-G[i][j];\n    printf(\"%.10lf\",prod*determinant(G,n-1));// BZOJ SPJ\u597d\u50cf\u6302\u4e86\uff0c\u5fc5\u987b\u8f93\u51fa10\u4f4d\u5c0f\u6570\u624d\u80fd\u8fc7...\n}\n```",
        "postTime": 1551950977,
        "uid": 48711,
        "name": "_WA\u81ea\u52a8\u673a",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "# \u9898\u89e3 P3317[SDOI2014] \u91cd\u5efa\n\n## \u3010\u9898\u610f\u7b80\u8ff0\u3011\n\n\u7ed9\u5b9a\u4e00\u4e2a\u56fe\uff0c\u6bcf\u6761\u8fb9\u6709\u4e00\u5b9a\u7684\u6982\u7387\u88ab\u9009\u4e2d\uff0c\u6c42\u9009\u4e2d\u7684\u6240\u6709\u8fb9\u6070\u597d\u7ec4\u6210\u4e00\u4e2a\u539f\u56fe\u7684\u751f\u6210\u6811\u7684\u6982\u7387\u3002\n\n\u7ed3\u70b9\u6570$N\\leq 50$\n\n## \u3010\u5206\u6790\u3011\n\n\u4e3a\u4e86\u505a\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u5e94\u8be5\u5148\u4e86\u89e3\u65e0\u5411\u56fe\u7684\u77e9\u9635\u6811\u5b9a\u7406\n\n\u53ef\u4ee5\u79fb\u6b65\u6211\u7684\u535a\u5ba2 [\u77e9\u9635\u6811\u5b9a\u7406](https://www.luogu.com.cn/blog/NashChen/matrix-tree)\n\n\u884c\u5217\u5f0f\u7684\u8ba1\u7b97\u53ef\u4ee5\u770b [\u7ebf\u6027\u4ee3\u6570\u603b\u7ed32](https://www.luogu.com.cn/blog/NashChen/linear-algebra-2)\n\n\u9996\u5148\uff0c\u7ecf\u8fc7\u7b80\u5355\u7684\u63a8\u5e7f\uff0c\u77e9\u9635\u6811\u5b9a\u7406\u63cf\u8ff0\u7684\u662f\u8fd9\u6837\u7684\u7ed3\u8bba\n\n\u8bbe\u65e0\u5411\u56fe$G$\u7684\u90bb\u63a5\u77e9\u9635\u4e3a$E$\uff0c\u57fa\u5c14\u970d\u592b\u77e9\u9635\u4e3a$K_G$\uff0c\u56fe$G$\u7684\u6240\u6709\u751f\u6210\u6811\u4e3a$\\{Tree_i\\}$\n\n$$|K_G|=\\sum\\limits_i(\\prod\\limits_{e\\in Tree_i}e)$$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c$K_G$\u63cf\u8ff0\u4e86$G$\u751f\u6210\u56fe\u6709\u751f\u6210\u6811\u7684\u6982\u7387\u3002\u4e5f\u5c31\u662f\u8bf4\u63cf\u8ff0\u4e86\u751f\u6210\u56fe\u81f3\u5c11\u662f\u4e00\u68f5\u6811\u7684\u6982\u7387\u3002\n\n\u4f46\u9898\u76ee\u95ee\u7684\u662f\u751f\u6210\u56fe\u6070\u597d\u662f\u751f\u6210\u6811\u7684\u6982\u7387\u3002\u8fd9\u8981\u6c42\u591a\u4f59\u7684\u8fb9\u4e0d\u751f\u6210\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u7b54\u6848\u5f0f\u5b50\u662f\u8fd9\u6837\u7684\n\n$$Ans=\\sum\\limits_i[\\prod\\limits_{e_1\\in Tree_i}e_1\\prod\\limits_{e_2\\in\\complement_G Tree_i}(1-e_2)]$$\n\n\u7136\u800c\u77e9\u9635\u6811\u5b9a\u7406\u5e76\u4e0d\u80fd\u5904\u7406\u751f\u6210\u6811\u4e4b\u5916\u7684\u8fb9\n\n\u4e8e\u662f\u6211\u4eec\u60f3\u5230\u4e86\u4e00\u4e2a\u529e\u6cd5\n\n$$Ans=\\sum\\limits_i\\{[\\prod\\limits_{e\\in Tree_i}e]\\frac{\\prod\\limits_{e\\in G}(1-e)}{\\prod\\limits_{e\\in Tree_i}(1-e)}\\}$$\n\n$$=\\prod\\limits_{e\\in G}(1-e)\\sum\\limits_i\\frac{\\prod\\limits_{e\\in Tree_i}e}{\\prod\\limits_{e\\in Tree_i}(1-e)}$$\n\n$$=\\prod\\limits_{e\\in G}(1-e)[\\sum\\limits_i(\\prod\\limits_{e\\in Tree_i}\\frac{e}{1-e})]$$\n\n\u53ea\u8981\u5c06\u6bcf\u6761\u8fb9\u7684\u6743\u503c\u4fee\u6539\u4e3a$\\frac{e}{1-e}$\uff0c\u8ba1\u7b97\u65b0\u56fe\u7684\u57fa\u5c14\u970d\u592b\u77e9\u9635\u7684\u884c\u5217\u5f0f$|K_{G'}|$,\u7b54\u6848\u5c31\u662f$|K_{G'}|\\prod\\limits_{e\\in G}(1-e)$\uff0c\u6ce8\u610f$\\prod\\limits_{e\\in G}(1-e)$\u5e94\u8be5\u63d0\u524d\u7b97\u51fa\u6765\n\n## \u3010\u4ee3\u7801\u3011\n\n\u4ee3\u7801\u5b9e\u73b0\u91cc\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\uff0c\u5c31\u662f\u5982\u679c\u4e00\u6761\u8fb9\u5fc5\u5b9a\u4f1a\u751f\u6210\uff0c\u90a3\u4e48$1-e=0$\uff0c\u4e0d\u80fd\u4f5c\u9664\u6570\u3002\u8fd9\u91cc\u53ea\u9700\u8981\u5c06\u5fc5\u5b9a\u751f\u6210\u5f53\u4f5c\u65e0\u9650\u63a5\u8fd1$1$\uff0c\u5373$1-eps$\u7684\u6982\u7387\u751f\u6210\uff0c\u5fc5\u5b9a\u4e0d\u751f\u6210\u6539\u4e3a\u65e0\u9650\u5c0f\u6982\u7387$eps$\u751f\u6210\u3002\u8fd9\u6837\u5c31\u80fd\u7ee7\u7eed\u8fd0\u7b97\u5e76\u4e14\u5728\u7cbe\u5ea6\u5185\u4e0d\u5f71\u54cd\u7ed3\u679c\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\nusing namespace std;\n\nconst double eps=1e-8;\nconst int MAXN=105;\nint N;\ndouble edge[MAXN][MAXN],ans=1.0;\n\nvoid rowswap(int i,int j){\n\tif(i==j) return;\n\tfor(int k=1;k<=N;k++)\n\t\tswap(edge[i][k],edge[j][k]);\n\treturn;\n}\n\nvoid rowcomb(int i,int j,double c){\n\tif(i==j) return;\n\tfor(int k=1;k<=N;k++)\n\t\tedge[i][k]-=c*edge[j][k];\n\treturn;\n}\n\ndouble calcdet(){\n\tdouble res=1.0,tag=1.0;\n\tfor(int i=1;i<=N;i++){\n\t\tint maxr=i;\n\t\tfor(int j=i+1;j<=N;j++)\n\t\t\tif(fabs(edge[j][i])-fabs(edge[maxr][i])>eps)\n\t\t\t\tmaxr=j;\n\t\tif(i!=maxr) tag=-tag;\n\t\trowswap(i,maxr);\n\t\tif(fabs(edge[i][i])<eps) return 0.0;\n\t\tfor(int j=1;j<=N;j++)\n\t\t\tif(i!=j) rowcomb(j,i,edge[j][i]/edge[i][i]);\n\t}\n\tfor(int i=1;i<=N;i++)\n\t\tres*=edge[i][i];\n\treturn tag*res;\n}\n\nvoid Input(){\n\tscanf(\"%d\",&N);\n\tfor(int i=1;i<=N;i++)\n\t\tfor(int j=1;j<=N;j++){\n\t\t\tscanf(\"%lf\",&edge[i][j]);\n\t\t\tif(i<j) ans*=(1-edge[i][j]+eps);\n\t\t}\n\tfor(int i=1;i<=N;i++)\n\t\tfor(int j=1;j<=N;j++)\n\t\t\tedge[i][j]/=(1-edge[i][j]+eps);\n\tfor(int i=1;i<=N;i++)\n\t\tfor(int j=1;j<=N;j++)\n\t\t\tif(i!=j)\n\t\t\t\tedge[i][i]-=edge[i][j];\n\tfor(int i=1;i<=N;i++)\n\t\tfor(int j=1;j<=N;j++)\n\t\t\tedge[i][j]=-edge[i][j];\n\treturn;\n}\nint main(){\n\tInput();\n\tN--;\n\tans*=calcdet();\n\tprintf(\"%lf\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1596685920,
        "uid": 102091,
        "name": "NashChen",
        "ccfLevel": 7,
        "title": "\u65e0\u5411\u56fe\u751f\u6210\u6811\u671f\u671b\u6570\u95ee\u9898"
    },
    {
        "content": "## \u601d\u8def\n\n\u751f\u6210\u6811\u76f8\u5173\u8ba1\u6570\uff0c\u8003\u8651\u77e9\u9635\u6811\u5b9a\u7406\uff0e\n\n\u77e9\u9635\u6811\u5b9a\u7406\u662f\u7528\u4e8e\u6c42\u89e3\u5f62\u5982\u4e0b\u5f0f\u7684\u95ee\u9898\u7684\uff1a\n\n$$\n\\sum_{T} \\prod_{e \\in T} w_e\n$$\n\n\u5176\u4e2d $T$ \u53d6\u904d\u56fe\u4e2d\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u96c6\uff0c$w_e$ \u662f $e$ \u8fd9\u6761\u8fb9\u7684\u8fb9\u6743\uff0e\n\n\u8bbe $p_{e}$ \u4e3a $e$ \u8fd9\u6761\u8fb9\u5b58\u5728\u7684\u6982\u7387\uff0c\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\uff1a\n\n$$\n\\sum_{T} \\left(\\prod_{e \\in T} p_e\\right) \\times \\left(\\prod_{e \\not\\in T} 1 - p_e\\right)\n$$\n\n\u53d1\u73b0\u53f3\u8fb9\u7684 $\\prod$ \u5f88\u70e6\u4eba\uff0c\u5b83\u963b\u6b62\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u77e9\u9635\u6811\u5b9a\u7406\uff0e\u8003\u8651\u600e\u4e48\u8ba9\u5b83\u4e0e $\\sum$ \u65e0\u5173\uff0e\u63d0\u4e00\u4e2a $\\prod\\limits_e 1 - p_e$ \u51fa\u6765\uff0c\u5f0f\u5b50\u53ef\u5316\u4e3a\uff1a\n\n$$\n\\left(\\prod_e 1 - p_e\\right) \\times \\sum_{T} \\prod_{e \\in T} \\frac{p_e}{1 - p_e}\n$$\n\n\u5de6\u8fb9\u7684 $\\prod$ \u53ef\u4ee5\u76f4\u63a5\u7b97\uff0c\u53f3\u8fb9\u7684 $\\sum$ \u4f7f\u7528\u77e9\u9635\u6811\u5b9a\u7406\uff0e\n\n\u6ce8\u610f\u5230\u5b58\u5728 $p_e = 1$ \u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u505a\u9664\u6cd5\u4f1a\u9664\u51fa\u6765 inf\uff0c\u7ed9\u5206\u6bcd\u52a0\u4e2a\u5fae\u5c0f\u6270\u52a8\u5373\u53ef\uff0e\n\n## \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\n\nusing f64 = double;\n\nconst int N = 50;\nconst f64 eps = 1e-9;\n\nint n; f64 a[N + 5][N + 5];\nint ct[N + 5];\n\nint d;\nf64 det() {\n\tint sgn = 1;\n\tfor(int i = 1; i <= d; i++) {\n\t\tint p = i;\n\t\tfor(int j = i + 1; j <= d; j++) {\n\t\t\tif(a[j][i] > a[p][i]) p = j;\n\t\t}\n\t\tif(p != i) sgn *= -1, std::swap(a[i], a[p]);\n\t\tfor(int j = 1; j <= d; j++) {\n\t\t\tif(i == j) continue;\n\t\t\tf64 x = a[j][i] / a[i][i];\n\t\t\tfor(int k = 1; k <= d; k++) {\n\t\t\t\ta[j][k] -= x * a[i][k];\n\t\t\t}\n\t\t}\n\t}\n\tf64 res = 1;\n\tfor(int i = 1; i <= d; i++) res *= a[i][i];\n\treturn res * sgn;\n}\n\nint main() {\n\tscanf(\"%d\", &n);\n\tf64 rev = 1;\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = 1; j <= n; j++) {\n\t\t\tscanf(\"%lf\", &a[i][j]);\n\t\t}\n\t}\n\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = i + 1; j <= n; j++) {\n\t\t\trev *= (1 - a[i][j] + eps);\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = 1; j <= n; j++) {\n\t\t\ta[i][j] /= (1 - a[i][j] + eps);\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = 1; j <= n; j++) {\n\t\t\tif(i == j) continue;\n\t\t\ta[i][i] += a[i][j];\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = 1; j <= n; j++) {\n\t\t\tif(i == j) continue;\n\t\t\ta[i][j] = -a[i][j];\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = 1; j <= n; j++) {\n\t\t\ta[i][j] = a[i + 1][j + 1];\n\t\t}\n\t}\n\n\td = n - 1;\n\tprintf(\"%.15lf\\n\", det() * rev);\n\treturn 0;\n}\n```\n",
        "postTime": 1684560885,
        "uid": 329316,
        "name": "kernel_panic",
        "ccfLevel": 0,
        "title": "P3317 \u9898\u89e3"
    },
    {
        "content": "\u4e00\u9053\u8003\u9a8c\u5bf9\u77e9\u9635\u6811\u5b9a\u7406\u7406\u89e3\u7684\u9898\u76ee\u3002\n\n## \u9898\u76ee\u5927\u610f\n\u4e00\u5f20 $N$ \u4e2a\u8282\u70b9\u7684\u65e0\u5411\u56fe $G=(V,E)$\uff0c\u7ed9\u5b9a\u6bcf\u6761\u9053\u8def\u5728\u6d2a\u6c34\u540e\u4ecd\u80fd\u901a\u884c\u7684\u6982\u7387\uff0c\u8bf7\u8ba1\u7b97\u4ecd\u80fd\u901a\u884c\u7684\u9053\u8def\u6070\u6709 $N-1$ \u6761\uff0c\u4e14\u80fd\u8054\u901a\u6240\u6709\u57ce\u5e02\u7684\u6982\u7387\u3002\n\n## \u5927\u4f53\u601d\u8def\n\u8bbe $T$ \u8868\u793a\u751f\u6210\u6811\uff0c\u5219\u672c\u9898\u8981\u6c42\u7684\u662f $N-1$ \u6761\u9053\u8def\u8fde\u901a\uff0c**\u5269\u4f59\u9053\u8def\u4e0d\u8fde\u901a**\u7684\u6982\u7387\u4e4b\u548c\uff0c\u5373\n\n$$\\sum_T\\left(\\prod_{e\\in T}p_e\\cdot\\prod_{e\\notin T}(1-p_e)\\right)$$\n\n\u7528\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u51fa\u7684\u662f\u751f\u6210\u6811\u8fb9\u6743\u4e58\u79ef\u4e4b\u548c\uff0c\u5373\n\n$$\\sum_T\\prod_{e\\in T}p_e$$\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u5982\u4e0b\u7684\u8f6c\u6362\u65b9\u5f0f\uff0c\u4f7f\u5f97\u5176\u79f0\u4e3a\u80fd\u591f\u7528\u77e9\u9635\u6811\u5b9a\u7406\u8ba1\u7b97\u7684\u5f62\u5f0f\u3002\u6ce8\u610f\u5230 $\\{e|e\\in T\\}\\cup \\{e|e\\notin T\\}=E$\uff0c\u6709\n\n$$\\prod_{e\\notin T}(1-p_e)\\cdot\\prod_{e\\in T}(1-p_e)=\\prod_{e\\in E}(1-p_e)$$\n\n$$\\sum_T\\left(\\prod_{e\\in T}p_e\\cdot\\prod_{e\\notin T}(1-p_e)\\right)=\\sum_T\\left(\\prod_{e\\in T}p_e\\cdot\\dfrac{\\prod_{e\\in E}(1-p_e)}{\\prod_{e\\in T}(1-p_e)}\\right)$$\n$$=\\prod_{e\\in E}(1-p_e)\\left(\\sum_T\\prod_{e\\in T}\\dfrac{p_e}{1-p_e}\\right)$$\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5148\u8ba1\u7b97\u51fa $\\prod_{e\\in E}(1-p_e)$\uff0c\u5e76\u5c06 $w_e=\\dfrac{p_e}{1-p_e}$ \u4f5c\u4e3a\u8fb9\u6743\u5efa\u7acb\u57fa\u5c14\u970d\u592b\u77e9\u9635\uff0c\u7528\u9ad8\u65af\u6d88\u5143\u8ba1\u7b97\u884c\u5217\u5f0f\u7684\u503c\u5373\u53ef\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u76f4\u63a5\u8fd9\u6837\u4ea4\u4e0a\u53bb\u4f1a\u83b7\u5f97 $30$ \u5206\u7684\u597d\u6210\u7ee9\uff0c\u5e76\u4e14\u4f60\u4f1a\u53d1\u73b0\u4e00\u4e2a\u719f\u6089\u7684 `nan`\u3002\u8fd9\u662f\u56e0\u4e3a\u5f53 $p=1$ \u65f6\uff0c$1-p=0$ \u4e0d\u80fd\u4f5c\u4e3a\u5206\u6bcd\u3002\n\n\u8003\u8651\u5230 $p=1$ \u65f6\uff0c$1-p=0$\uff0c$\\dfrac{1}{1-p}\\to \\infty$\uff0c\u800c $\\epsilon\\to 0,\\epsilon^{-1}\\to \\infty$\uff0c\u53ea\u9700\u4ee4 $1-p=\\epsilon$\uff0c$p'=1-\\epsilon=p-\\epsilon$ \u5373\u53ef\u3002\n\n## \u5b8c\u6574\u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define rep(ii,aa,bb) for(re int ii = aa; ii <= bb; ii++)\n#define Rep(ii,aa,bb) for(re int ii = aa; ii >= bb; ii--)\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef double db;\ntypedef pair<int, int> PII;\nconst int maxn = 55;\nconst db eps = 1e-8;\nnamespace IO_ReadWrite {\n\t#define re register\n\t#define gg (p1 == p2 && (p2 = (p1 = _buf) + fread(_buf, 1, 1<<21, stdin), p1 == p2) ? EOF :*p1++)\n\tchar _buf[1<<21], *p1 = _buf, *p2 = _buf;\n\ttemplate <typename T>\n\tinline void read(T &x){\n\t\tx = 0; re T f=1; re char c = gg;\n\t\twhile(c > 57 || c < 48){if(c == '-') f = -1;c = gg;}\n\t\twhile(c >= 48 &&c <= 57){x = (x<<1) + (x<<3) + (c^48);c = gg;}\n\t\tx *= f;return;\n\t}\n\tinline void ReadChar(char &c){\n\t\tc = gg;\n\t\twhile(!isalpha(c)) c = gg;\n\t}\n\ttemplate <typename T>\n\tinline void write(T x){\n\t\tif(x < 0) putchar('-'), x = -x;\n\t\tif(x > 9) write(x/10);\n\t\tputchar('0' + x % 10);\n\t}\n\ttemplate <typename T>\n\tinline void writeln(T x){write(x); putchar('\\n');}\n}\nusing namespace IO_ReadWrite;\nint n;\ndb a[maxn][maxn], base;\ninline void Guass() {\n\tdb ans = base; ll w = 1;\n\trep(i, 2, n)\n\t\trep(j, i + 1, n) {\n\t\t\twhile(fabs(a[i][i]) > eps) {\n\t\t\t\tdb factor = a[j][i] / a[i][i];\n\t\t\t\trep(k, i, n)\n\t\t\t\t\ta[j][k] -= a[i][k] * factor;\n\t\t\t\tswap(a[i], a[j]), w = -w;\n\t\t\t}\n\t\t\tswap(a[i], a[j]), w = -w;\n\t\t}\n\trep(i, 2, n) ans *= a[i][i];\n\tprintf(\"%.5lf\", ans * w);\n}\nint main () {\n\tscanf(\"%d\", &n);\n\tbase = 1.0;\n\trep(i, 1, n)\n\t\trep(j, 1, n) {\n\t\t\tdb w;\n\t\t\tscanf(\"%lf\", &w);\n\t\t\tif(fabs(1.0 - w) < eps) w -= eps;\n\t\t\tif(i <= j) base *= (1.0 - w);\n\t\t\tif(w > eps) {\n\t\t\t\ta[i][i] += (w / (1.0 - w));\n\t\t\t\ta[i][j] -= (w / (1.0 - w));\n\t\t\t}\n\t\t}\n\tGuass();\n\treturn 0;\n}\n```",
        "postTime": 1647747275,
        "uid": 279197,
        "name": "Mars_Dingdang",
        "ccfLevel": 6,
        "title": "P3317"
    },
    {
        "content": "## $\\rm{Description}$\n\n\u7ed9\u5b9a\u65e0\u5411\u56fe\uff0c\u6bcf\u6761\u8fb9\u4ee5 $p_i$ \u7684\u6982\u7387\u5b58\u5728\u3002\u6c42\u5b58\u5728\u7684\u8fb9\u6784\u6210\u4e00\u68f5\u751f\u6210\u6811\u7684\u6982\u7387\u3002\n\n\u70b9\u6570 $2\\leq N\\leq 50$\uff0c\u65e0\u91cd\u8fb9\u3002\n\n## $\\rm{Solution}$\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a[\u77e9\u9635\u6811\u5b9a\u7406 - OI Wiki](http://oi-wiki.com/graph/matrix-tree/)\uff0c[\u884c\u5217\u5f0f\u8ba1\u7b97 - OI Wiki](http://oi-wiki.com/math/gauss/#_12)\uff0c\u9898\u89e3\u540c\u6b65\u53d1\u8868\u4e8e [TonyYin's Blog](https://www.tonyyin.top/2021/08/luogu-p3317/)\u3002\n\n\u770b\u5230 $N\\leq 50$ \u7684\u8303\u56f4\u548c\u751f\u6210\u6811\uff0c\u5bb9\u6613\u60f3\u5230**\u77e9\u9635\u6811\u5b9a\u7406**\u3002\n\n### \u77e9\u9635\u6811\u5b9a\u7406\n\n\u5bf9\u4e8e\u4e00\u4e2a\u65e0\u5411\u56fe $G$\uff0c\u8bbe\u8fb9 $e_i=(u_i, v_i)$\uff0c\u5176\u8fb9\u6743\u4e3a $v_i = w(u_i, v_i)$.\n\n\u5b9a\u4e49\u90bb\u63a5\u77e9\u9635 $A$\uff0c$A_{i, j}=w(i, j)$.\n\n\u5b9a\u4e49\u5ea6\u6570\u77e9\u9635 $D$\uff0c$D_{i, i}=\\operatorname{deg}_{i}$\uff0c\u5b58\u50a8\u6bcf\u4e2a\u70b9\u7684\u5ea6\u6570\u3002\n\n\u5b9a\u4e49\u57fa\u5c14\u970d\u592b\u77e9\u9635 $L$ \uff0c$L=D-A$.\n\n\u4efb\u53d6 $i\\in[1, N]$\uff0c\u5c06\u57fa\u5c14\u970d\u592b\u77e9\u9635\u5220\u53bb\u7b2c $i$ \u884c\u548c\u7b2c $i$ \u5217\uff0c\u6784\u6210\u4e00\u4e2a $(N-1)\\times (N-1)$ \u7684\u5b50\u77e9\u9635\uff0c\u4e0d\u59a8\u8bb0\u4e3a $L'$.\n\n\u6839\u636e\u65e0\u5411\u56fe\u7684\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u6709\uff1a\n$$\n\\det L' = \\sum_{T}{\\prod_{e\\in T}v_e}\n$$\n\u5bf9\u77e9\u9635 $L'$ \u8ba1\u7b97\u884c\u5217\u5f0f\uff0c\u5f97\u5230\u7684**\u7ed3\u679c\u5373\u4e3a\uff1a\u6bcf\u68f5\u751f\u6210\u6811\u4e2d\uff0c\u6240\u6709\u8fb9\u6743\u4e58\u79ef\u7684\u548c**\u3002\n\n### \u5206\u6790\n\n\u7531\u6982\u7387\u7684\u6027\u8d28\uff0c\u6211\u4eec\u6700\u7ec8\u6c42\u7684\u7b54\u6848\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n$$\n\\operatorname{Ans}=\\sum_T[{\\prod_{e\\in T}p_e \\prod_{e\\notin T}(1-p_e)}]\n$$\n\u8fd9\u91cc\u4e00\u5b9a\u4e0d\u8981\u5fd8\u8bb0\u4e58\u4e0a\uff1a$\\prod_{e\\notin T}(1-p_e)$.\n\n\u6ce8\u610f\u5230 $\\operatorname{Ans}$ \u7684\u8868\u793a\u5f0f\u4e0e\u77e9\u9635\u6811\u5b9a\u7406\u5f88\u50cf\uff0c\u8003\u8651\u5982\u4f55\u5c06\u5176\u8f6c\u5316\u6210\u77e9\u9635\u6811\u5b9a\u7406\u7684\u6807\u51c6\u5f62\u5f0f\u3002\n\n\u8981\u8f6c\u5316\u4e3a\u6807\u51c6\u5f62\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u53bb\u6389 $\\prod_{e\\notin T}$ \u8fd9\u4e2a\u90e8\u5206\uff0c\u5177\u4f53\u8f6c\u5316\u6b65\u9aa4\uff1a\n\n$$\n\\begin{aligned}\n\\operatorname{Ans}&=\n\\sum_T[{\\prod_{e\\in T}p_e \\prod_{e\\notin T}(1-p_e)}]\\\\\n&=\\sum_T[{\\prod_{e\\in T}p_e \\frac{\\prod_{e}{(1-p_e)}}{\\prod_{e\\in T}(1-p_e)}}]\\\\\n\\end{aligned}\n$$\n\n\u6ce8\u610f\u5230\u5206\u5b50\u90e8\u5206\u4e3a\u5e38\u6570\uff0c\u4e8e\u662f\uff1a\n\n$$\n\\begin{aligned}\n\\operatorname{Ans}&=\n\\sum_T[{\\prod_{e\\in T}p_e \\frac{\\prod_{e}{(1-p_e)}}{\\prod_{e\\in T}(1-p_e)}}]\\\\\n&=\\prod_{e}{(1-p_e)}\\sum_T{\\prod_{e\\in T}\\frac{p_e}{1-p_e}}\\\\\n\\end{aligned}\n$$\n\n\u8fd9\u6837\uff0c\u53ea\u9700\u8981\u5c06\u8fb9\u6743\u5b9a\u4e3a $\\dfrac{p_e}{1-p_e}$\uff0c\u4e4b\u540e\u5229\u7528\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u89e3\u5373\u53ef\u3002\n\n## $\\rm{Code}$\n\n\u5b9e\u73b0\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u8fb9\u6743\u7684\u5206\u6bcd\u4e3a $0$\uff0c\u82e5 $p_e=1$\uff0c\u5c06 $p_e\\leftarrow p_e+\\varepsilon$ \u5373\u53ef\u907f\u514d\u95ee\u9898\u53d1\u751f\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAXN = 100;\nconst double eps = 1e-10;\nint n;\ndouble g[MAXN][MAXN], A[MAXN][MAXN];\ndouble det() {\n\tfor(int col = 2; col <= n; col++) {\n\t\tint max_row = col;\n\t\tfor(int i = col + 1; i <= n; i++)\n\t\t\tif(A[i][col] > A[max_row][col]) max_row = i;\n\t\tif(max_row != col) swap(A[col], A[max_row]);\n\t\tfor(int row = col + 1; row <= n; row++) {\n\t\t\tdouble t = A[row][col] / A[col][col];\n\t\t\tfor(int i = 2; i <= n; i++) {\n\t\t\t\tA[row][i] -= A[col][i] * t;\n\t\t\t}\n\t\t}\n\t}\n\tdouble ans = 1.0;\n\tfor(int i = 2; i <= n; i++) ans *= A[i][i];\n\treturn ans;\n}\nint main() {\n\tscanf(\"%d\", &n);\n\tdouble prod = 1.0;\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = 1; j <= n; j++) {\n\t\t\tscanf(\"%lf\", &g[i][j]); g[i][j] -= eps;\n\t\t\tA[i][j] -= g[i][j] / (1.0 - g[i][j]);\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tfor(int j = i + 1; j <= n; j++) {\n\t\t\tA[i][i] += g[i][j] / (1.0 - g[i][j]);\n\t\t\tA[j][j] += g[i][j] / (1.0 - g[i][j]);\n\t\t\tprod *= (1.0 - g[i][j]);\n\t\t}\n\t}\n\tcout << prod * det() << endl;\n\treturn 0;\n}\n```",
        "postTime": 1629894184,
        "uid": 166535,
        "name": "TonyYin",
        "ccfLevel": 0,
        "title": "P3317 [SDOI2014]\u91cd\u5efa"
    },
    {
        "content": "## \u9898\u89e3\n**\u524d\u7f6e\u829d\u58eb**\uff1a\u6df1\u5ea6\u7406\u89e3\u7684\u77e9\u9635\u6811\u5b9a\u7406\n\n\u77e9\u9635\u6811\u5b9a\u7406\u80fd\u6c42\u751f\u6210\u6811\u4e2a\u6570\u7684\u539f\u56e0\u662f\uff0c\u5b83\u672c\u8d28\u4e0a\u6c42\u7684\u662f\uff1a\n$$\n\\sum_T \\prod_{e\\in T} w_e\n$$\n\u5176\u4e2d $w_e$ \u662f\u8fb9\u6743\uff0c\u90a3\u4e48\u6211\u4eec\u4f1a\u53d1\u73b0\u5176\u5b9e\u5f53\u8fb9\u6743\u662f $1$ \u65f6\uff0c\u672c\u5f0f\u6240\u6c42\u5373\u4e3a\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u56de\u5230\u8fd9\u9898\u6765\uff0c\u8fd9\u9898\u8ba9\u6c42\u7684\u662f\n$$\n\\sum_{T}\\prod_{e\\in T}w_e\\prod_{e\\notin T}(1-w_e)\n$$\n\u5f88\u5bb9\u6613\u770b\u51fa\u6765\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u548c\u4e0a\u9762\u77e9\u9635\u6811\u7684\u5f0f\u5b50\u5f88\u50cf\u3002\u8ba9\u6211\u4eec\u6765\u63a8\u4e00\u6ce2\u3002\n$$\n(\\sum_T \\prod_{e\\in T} w_e) \u00d7 \\prod_{e}w_e=\\sum_T\\prod_{e\\in T}w_e(1-w_e)\\prod_{e\\notin T}(1-w_e)\n$$\n\u6b64\u5f0f\u548c\u4e0a\u9762\u7b54\u6848\u66f4\u8fd1\u4e86\u4e00\u6b65\uff0c\u6211\u4eec\u53ea\u9700\u628a $\\prod_{e\\in T}(1-w_e)$ \u6d88\u6389\u5373\u53ef\u3002\n\n\u663e\u7136\n$$\nw_e=(1-w_e)\u00d7\\frac{w_e}{1-w_e}\n$$\n\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f $\\sum_{T}\\prod_{e\\in T}\\frac{w_e}{1-w_e}$\u3000\n\n\u4e8e\u662f\u6211\u4eec\u5728\u521d\u59cb\u5316 $Laplace$ \u77e9\u9635\u65f6\u76f4\u63a5\u4ee5 $\\frac{w_e}{1-w_e}$ \u4e3a\u8fb9\u6743\u3002\n\n\u6709\u4e00\u4e2a\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u56e0\u4e3a $w_e\\in [0,1]$\uff0c\u800c $w_e$ \u4e3a\u5206\u5b50\uff0c\u5f53 $w_e=0$ \u662f\uff0c\u539f\u5f0f\u8d8b\u4e8e\u65e0\u7a77\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u8d4b\u4e3a $eps$ \uff0c\u5728\u5206\u6bcd\u4e0a\u7684 $1-w_e$ \u5219\u53cd\u8fc7\u6765\uff0c\u82e5 $w_e=1$ \u5219\u539f\u5f0f\u8d8b\u4e8e\u65e0\u7a77\u5927\uff0c\u6240\u4ee5\u53ef\u4ee5\u8d4b\u5176\u4e3a $1-eps$ \u3002\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8fd9\u6837\uff0c\u662f\u4e3a\u4e86\u9632\u6b62\u5f0f\u5b50\u5728\u8ba1\u7b97\u673a\u4e2d\u6d6e\u70b9\u6570\u4f8b\u5916\u3002\n\n$AC\\kern 0.5emCODE:$\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\n#define ri register signed\n#define p(i) ++i\nusing namespace std;\nnamespace IO{\n    char buf[1<<21],*p1=buf,*p2=buf;\n    #define gc() p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++\n    inline int read() {\n        ri x=0,f=1;char ch=getchar();\n        while(ch<'0'||ch>'9') {if (ch=='-') f=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9') {x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n        return x*f; \n    }\n}\nusing IO::read;\nnamespace nanfeng{\n    #define cmax(x,y) ((x)>(y)?(x):(y))\n    #define cmin(x,y) ((x)>(y)?(y):(x))\n    #define FI FILE *IN\n    #define FO FILE *OUT\n    typedef double db;\n    static const int N=55;\n    static const db eps=1e-8;\n    db G[N][N],ans=1.0,tmp=1.0;\n    int n;\n    inline void Gauss() {\n        int tr=0;\n        for (ri i(1);i<=n;p(i)) {\n            int k=i;\n            for (ri j(i+1);j<=n;p(j)) if (fabs(G[j][i])>fabs(G[k][i])) k=j;\n            if (k!=i) swap(G[i],G[k]),tr^=1;\n            // for (ri j(1);j<=n;p(j)) printf(\"%.8lf \",G[i][j]);\n            // puts(\"\");\n            for (ri j(i+1);j<=n;p(j)) {\n                db tmp=G[j][i]/G[i][i];\n                for (ri l(i);l<=n;p(l)) G[j][l]-=tmp*G[i][l];\n            }\n            if (fabs(G[i][i])<eps) {ans=0;return;} \n            ans=ans*G[i][i];\n            // printf(\"ans=%.10lf G[i][i]=%.10lf\\n\",ans,G[i][i]);\n        } \n        if (tr) ans=-ans;\n    }\n    inline int main() {\n        // FI=freopen(\"nanfeng.in\",\"r\",stdin);\n        // FO=freopen(\"nanfeng.out\",\"w\",stdout);\n        n=read();\n        for (ri i(1);i<=n;p(i)) {\n            for (ri j(1);j<=n;p(j)) scanf(\"%lf\",&G[i][j]); \n        }\n        for (ri i(1);i<=n;p(i)) {\n            for (ri j(1);j<=n;p(j)) {\n                if (G[i][j]<eps) G[i][j]=eps;\n                if ((1.0-G[i][j])<eps) G[i][j]=1.0-eps;\n                if (i<j) tmp*=(1.0-G[i][j]);\n                G[i][j]/=(1.0-G[i][j]);\n            }\n        }\n        // printf(\"tmp=%.10lf\\n\",tmp);\n        for (ri i(1);i<=n;p(i)) {\n            G[i][i]=0.0;\n            for (ri j(1);j<=n;p(j)) {\n                if (i!=j) G[i][i]+=G[i][j],G[i][j]=-G[i][j];\n            }\n        }\n        n-=1;\n        Gauss();\n        printf(\"%.10lf\\n\",ans*tmp);\n        return 0;\n    }\n}\nint main() {return nanfeng::main();}\n\n```",
        "postTime": 1623580812,
        "uid": 141958,
        "name": "\u6960\u67ab",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3317 [SDOI2014]\u91cd\u5efa"
    },
    {
        "content": "\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u56fe\uff0c\u56fe\u4e0a\u7684\u8fb9\u6743\u6709\u51fa\u73b0\u7684\u6982\u7387\u3002\u95ee\u51fa\u73b0\u7684\u8fb9\u6070\u597d\u6784\u6210\u4e00\u68f5\u6811\u7684\u6982\u7387\u662f\u591a\u5c11\u3002\n\n\u8003\u8651\u6bcf\u4e00\u68f5\u5408\u6cd5\u7684\u6811\u7684\u8d21\u732e\u3002\u5047\u8bbe\u5408\u6cd5\u7684\u6811\u7684\u96c6\u5408\u662f $S$\uff0c\u8bbe\u4e00\u68f5\u6811 $\\text{Tree} \\in S$ \u51fa\u73b0\u7684\u6982\u7387\u662f $p_{\\text{Tree}}$\uff0c\u6982\u7387\u53ef\u52a0\u663e\u7136\u7b54\u6848\u662f $\\sum_{\\text{Tree} \\in S}p_{\\text{Tree}}$\u3002\n\n\u8003\u8651\u6bcf\u4e00\u68f5\u6811\u7684\u8d21\u732e\u3002\u56e0\u4e3a\u662f\u4e00\u68f5\u6811\uff0c\u6240\u4ee5\u8fb9\u6709\u9009\u548c\u4e0d\u9009\u4e24\u79cd\u72b6\u6001\u3002\u5bf9\u4e8e\u4e00\u68f5\u5408\u6cd5\u751f\u6210\u6811 $\\text{Tree}$ \u6765\u8bf4\uff0c\u5b83\u7684\u51fa\u73b0\u6982\u7387\u4e3a\uff1a\n\n$$\n\\prod_{E \\in \\text{Tree}} p_E \\prod_{E \\not \\in \\text{Tree}} (1-p_E)\n$$\n\n\u8003\u8651\u5c06\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u8fdb\u884c\u53d8\u6362\uff0c\u4f7f\u5176\u5c3d\u91cf\u7684\u597d\u8ba1\u7b97\u6216\u8005\u5355\u5355\u4e0e $\\text{Tree}$ \u6709\u5173\u3002\n\n$$\n\\prod_{E \\in \\text{Tree}} p_E  \\dfrac{\\prod_{E \\in \\text{Graph}} (1-p_E)}{\\prod_{E \\in \\text{Tree}}(1-p_E)}\n$$\n\n\u663e\u7136\u5206\u6bcd\u4e0a\u9762\u7684\u4e1c\u897f\u662f\u4e2a\u5b9a\u503c\u3002\u63d0\u51fa\u6765\u3002\n\n$$\n\\prod_{E\\in \\text{Tree}}  \\dfrac{p_E}{1-p_E}\n$$\n\n\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u662f\u8fd9\u4e2a\u4e86\u3002\n\n\u8003\u8651\u5230\u6570\u636e\u8303\u56f4\u5f88\u5c0f\u7ed9\u4e88\u6211\u4eec\u63d0\u793a\uff0c\u5e76\u4e14\u4f17\u6240\u5468\u77e5\u6c42\u56fe\u4e2d\u6240\u6709\u751f\u6210\u6811\u8fb9\u6743\u4e58\u79ef\u4e4b\u548c\u5df2\u7ecf\u88ab\u51fa\u70c2\u4e86\u3002\u8bbe\u51fa\u73b0\u6982\u7387\u4e3a $p_E$ \u7684\u8fb9\u8fb9\u6743\u4e3a $\\dfrac{p_E}{1-p_E}$\uff0c\u505a Matrix-Tree \u5b9a\u7406\u7684\u6a21\u677f\u5373\u53ef\u3002\u6ce8\u610f\u4e58\u4e0a\u63d0\u51fa\u6765\u7684\u5b9a\u503c\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fb9\u6743\u5b58\u5728 $1$ \u6216\u8005 $0$\u3002\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u9700\u8981\u5c06\u5176\u5206\u522b\u53d8\u4e3a\u4e00\u4e2a\u4e0d\u662f $1$ \u548c $0$ \u4f46\u662f\u975e\u5e38\u63a5\u8fd1\u7684\u5c0f\u6570\u3002\u5177\u4f53\u64cd\u4f5c\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst double eps=1e-7;\nint n;\ndouble sp[55][55],a[55][55];\ndouble Gauss()\n{\n\tdouble ans=1;\n\t--n;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tint maxn=i;\n\t\tfor(int j=i+1;j<=n;++j)\tif(fabs(a[j][i])>fabs(a[maxn][i]))\tmaxn=j;\n\t\tswap(a[i],a[maxn]);\n\t\tif(fabs(a[i][i])<eps)\treturn 0;\n\t\tfor(int j=1;j<=n;++j)\n\t\t{\n\t\t\tif(i==j)\tcontinue;\n\t\t\tdouble del=a[j][i]/a[i][i];\n\t\t\tfor(int k=i+1;k<=n+1;++k)\ta[j][k]-=a[i][k]*del;\n\t\t}\n\t\tans*=fabs(a[i][i]);\n\t}\n\treturn ans;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tdouble ans=1;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tfor(int j=1;j<=n;++j)\n\t\t{\n\t\t\tscanf(\"%lf\",&sp[i][j]);\n\t\t\tif(sp[i][j]<eps)\tsp[i][j]=eps;\n\t\t\tif(1-sp[i][j]<eps)\tsp[i][j]=1-eps;\n\t\t\tif(i<j)\tans*=(1-sp[i][j]);\n\t\t\tsp[i][j]=sp[i][j]/(1-sp[i][j]);\n\t\t}\n\t}\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tfor(int j=1;j<=i-1;++j)\n\t\t{\n\t\t\tint u=i,v=j;\n\t\t\ta[u][u]+=sp[i][j];\n\t\t\ta[v][v]+=sp[i][j];\n\t\t\ta[u][v]-=sp[i][j];\n\t\t\ta[v][u]-=sp[i][j];\n\t\t}\n\t}\n\tprintf(\"%.10f\",ans*Gauss());\n\treturn 0;\n}\n```",
        "postTime": 1612574282,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "\u77e9\u9635\u6811\u5b9a\u7406\u3002\n\n\u5b9a\u4e49 $e_p$ \u4e3a\u8fd9\u6761\u8fb9\u7684\u51fa\u73b0\u6982\u7387\n\n\u7b54\u6848\u662f $\\sum_T \\prod e_p [e\\in T] \\times \\prod (1-e_p) [e \\notin T]$\u3002\n\n$\\sum_T \\prod e_p [e\\in T] \\times \\prod (1-e_p) [e \\notin T]$\n\n$=\\sum_T \\left(\\prod e_p [e\\in T] \\times \\frac{\\prod (1-e_p) }{\\prod (1-e_p) [e \\in T]}\\right)$\n\n\u7136\u540e\u628a $\\prod (1-e_p)$ \u63d0\u51fa\u6765\u5c31\u662f\u4e2a\u6a21\u677f\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nint N;\ndouble g[55][55];\nconst double eps = 1e-7;\ndouble det() {\n\t--N; bool rev = false;\n\tfor (int i = 0; i < N; i++) {\n\t\tint now = i;\n\t\tfor (int j = i + 1; j < N; j++) {\n\t\t\tif (abs(g[j][i]) > abs(g[now][i])) { now = j; }\n\t\t}\n\t\tif (now != i) { std::swap(g[now], g[i]); rev ^= 1; }\n\t\tif (g[i][i] > -eps && g[i][i] < eps) { return 0.0; }\n\t\tfor (int j = i + 1; j < N; j++) {\n\t\t\tdouble t = g[j][i] / g[i][i];\n\t\t\tfor (int k = i; k < N; k++) { g[j][k] -= 1. * g[i][k] * t; }\n\t\t}\n\t}\n\tdouble answer = 1;\n\tfor (int i = 0; i < N; i++) { answer = 1. * answer * g[i][i]; }\n\tif (rev) { answer = -answer; }\n\treturn answer;\n}\nint main() {\n\tstd::ios::sync_with_stdio(false);\n\tstd::cin.tie(NULL);\n\tstd::cin >> N;\n\tdouble answer = 1;\n\tfor (int i = 0; i < N; i++) {\n\t\tfor (int j = 0; j < N; j++) {\n\t\t\tstd::cin >> g[i][j];\n\t\t\tif (g[i][j] == 1) { g[i][j] = 1 - eps; }\n\t\t\tif (g[i][j] < eps) { g[i][j] = eps; }\n\t\t\tif (i < j) { answer = 1. * answer * (1 - g[i][j]); }\n\t\t\tg[i][j] = 1. * g[i][j] / (1 - g[i][j]);\n\t\t}\n\t}\n\tfor (int i = 0; i < N; i++) {\n\t\tg[i][i] = 0;\n\t\tfor (int j = 0; j < N; j++) {\n\t\t\tif (i != j) { g[i][i] += g[i][j]; g[i][j] = -g[i][j]; }\n\t\t}\n\t}\n\tstd::cout << std::fixed << std::setprecision(10) << answer * det() << '\\n';\n\treturn 0;\n}\n\n```",
        "postTime": 1593087803,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "\u6211\u4eec\u77e5\u9053\uff0cMatrix-Tree \u5b9a\u7406\u53ef\u4ee5\u6c42 $\\sum\\limits_T\\prod\\limits_{e \\in T}w_e$\n\n\u800c\u8fd9\u9898\uff0c\u6bcf\u4e00\u79cd\u5f62\u6001\u7684\u6811\u7684\u671f\u671b\u662f\u6bcf\u6761\u6811\u4e2d\u7684\u8fb9\u7684\u671f\u671b*(1-\u4e0d\u5728\u6811\u4e2d\u7684\u8fb9\u7684\u671f\u671b)\uff0c\u4e5f\u5c31\u662f $\\sum\\limits_T\\prod\\limits_{e \\in T}p_e\\prod\\limits_{e \\not \\in T}(1-p_e)$\n\n\u800c $\\prod\\limits_{e \\not \\in T}(1-p_e)=\\dfrac{\\prod\\limits_e(1-p_e)}{\\prod\\limits_{e \\in T}(1-p_e)}$\n\n\u6240\u4ee5\u539f\u5f0f\u5316\u4e3a $\\prod\\limits_e(1-p_e)\\sum\\limits_T\\prod\\limits_{e \\in T}\\dfrac{p_e}{1-p_e}$\n\n\u5c31\u53ef\u4ee5\u7528 Matrix-Tree \u5b9a\u7406\u6c42\u89e3\u4e86\n\n\u7136\u9e45......nan?\n\n$p_e=1$ \u65f6\uff0c\u5efa\u8bae $p_e-=eps$ \u4ee5\u907f\u514d nan\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u628a\u90a3\u6761\u5fc5\u5b9a\u51fa\u73b0\u7684\u8fb9\u7f29\u70b9\u4ec0\u4e48\u7684\uff0c\u4e0d\u8fc7\u592a\u9ebb\u70e6\u4e86\u3002\n\n\u540e\u8bb0\uff1a\u5199\u8fd9\u7bc7\u9898\u89e3\u4e5f\u662f\u4e3a\u4e86\u63d0\u9192\u6211\u81ea\u5df1\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u7684\uff0c\u6211\u505a\u671f\u671b\u9898\u8001\u662f\u4f1a\u5fd8\u8bb0\u4e58\u4e0a(1-\u4e0d\u8be5\u51fa\u73b0\u5728\u8fd9\u79cd\u60c5\u51b5\u4e2d\u7684\u90e8\u5206\u51fa\u73b0\u7684\u6982\u7387)\n```cpp\n#include<cstdio>\n#include<algorithm>\nusing std::swap;\ntypedef long double ld;\nnamespace QiFeng233{\n\tconst int maxn=60;\n\tconst ld eps=1e-8;\n\tld A[maxn][maxn];\n\tint n;\n\tld fabs(ld x){\n\t\treturn x<0.0?-x:x;\n\t}\n\tld gauss(){//\u9ed8\u8ba4\u53bb\u6389\u7b2c\u4e00\u884c \n\t\tld ret=1.0;\n\t\tfor(int i=2;i<=n;++i){\n\t\t\tint raw=i;\n\t\t\tfor(int j=i+1;j<=n;++j)if(fabs(A[j][i])-fabs(A[raw][i])>eps)raw=j;\n\t\t\tif(raw!=i)swap(A[raw],A[i]),ret*=-1;\n\t\t\tif(fabs(A[i][i])<eps)return 0;\n\t\t\tfor(int j=i+1;j<=n;++j){\n\t\t\t\tld div=A[j][i]/A[i][i];\n\t\t\t\tfor(int k=i;k<=n;++k)A[j][k]-=A[i][k]*div;\n\t\t\t}\n\t\t}\n\t\tfor(int i=2;i<=n;++i)ret*=A[i][i];\n\t\treturn ret;\n\t}\n\tvoid solve(){\n\t\tld ans=1.0;\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tfor(int j=1;j<=n;++j){\n\t\t\t\tld x;\n\t\t\t\tscanf(\"%Lf\",&x);\n\t\t\t\tif(fabs(x)<eps)x=eps;\n\t\t\t\tif(fabs(1.0-x)<eps)x=1.0-eps;\n\t\t\t\tif(i<j)ans*=(1.0-x);\n\t\t\t\tA[i][j]=-x/(1.0-x);\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tA[i][i]=0;\n\t\t\tfor(int j=1;j<=n;++j){\n\t\t\t\tif(i!=j)A[i][i]-=A[i][j];\n\t\t\t}\n\t\t}\n\t\tprintf(\"%Lf\",ans*gauss());\n\t}\n}\nsigned main(){\n\tQiFeng233::solve();\n\treturn 0;\n}\n```",
        "postTime": 1590669960,
        "uid": 233357,
        "name": "QiFeng233",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3317 \u3010[SDOI2014]\u91cd\u5efa\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.org/problem/P3317)\u770b\u9898\u76ee\u3002\n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u663e\u7136\uff0c\u9898\u76ee\u8981\u6c42\u8fd9\u6837\u4e00\u4e2a\u4e1c\u897f\uff1a    \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![\u793a\u4f8b1.PNG](https://i.loli.net/2019/08/21/RIiFnd7SN1KYJGM.png)    \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4f46\u662f\uff0c\u6211\u4eec\u7684\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u6700\u591a\u53ef\u4ee5\u6c42\u51fa\u5982\u4e0b\u7684\u4e1c\u897f\u3002    \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![\u793a\u4f8b2.PNG](https://i.loli.net/2019/08/21/8dK5z9bkg7XecML.png)  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u8fc7\uff0c\u6211\u4eec\u53d1\u73b0\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![\u793a\u4f8b3.PNG](https://i.loli.net/2019/08/21/Ju25qca8GIFQSje.png)  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7136\u540e\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u62c6\u5f0f\u5b50\u4e86\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![\u793a\u4f8b4.PNG](https://i.loli.net/2019/08/21/vI7tP85NUKrfeBE.png)  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u628a\u8fb9\u6743\u6539\u6210$\\frac{p_e}{(1-p_e)}$\u7136\u540e\u8dd1\u53d8\u5143\u77e9\u9635\u6811\u5b9a\u7406\u5373\u53ef\u3002 \u6ce8\u610f$p=1$\u7684\u65f6\u5019\u9700\u8981\u7279\u6b8a\u5904\u7406\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f$p=1-eps$\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u64cd\u4f5c\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <iostream>\n\nconst double eps = 1e-10;\nconst int MAXN = 55;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n    x = 0;char s = getchar();int f = 1;\n    while( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n    while( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n    x *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n    if( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n    if( 9 < x ){ write( x / 10 ); }\n    putchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T ABS( const _T a )\n{\n\treturn a < 0 ? -a : a;\n}\n\ndouble K[MAXN][MAXN];\ndouble D[MAXN][MAXN], G[MAXN][MAXN];\ndouble res;\nint N;\n\ndouble Gauss( const int n )\n{\n\tdouble tmp;\n\tint opt = 1, indx, coe = 1;\n\tfor( int i = 1 ; i <= n && opt <= n ; i ++, opt ++ )\n\t{\n\t\tindx = -1;\n\t\tfor( int j = i ; j <= n ; j ++ )\n\t\t{\n\t\t\tif( K[j][opt] && ( indx == -1 || ABS( K[indx][opt] ) < ABS( K[j][opt] ) ) )\n\t\t\t{\n\t\t\t\tindx = j;\n\t\t\t}\n\t\t}\n\t\tif( indx == -1 )\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tif( indx ^ i ) coe = -coe;\n\t\tstd :: swap( K[i], K[indx] );\n\t\tfor( int j = i + 1 ; j <= n ; j ++ )\n\t\t{\n\t\t\ttmp = K[j][opt] / K[i][opt];\n\t\t\tfor( int k = 1 ; k <= n ; k ++ )\n\t\t\t{\n\t\t\t\tK[j][k] -= K[i][k] * tmp;\n\t\t\t}\n\t\t}\n\t}\n\tdouble ans = coe;\n\tfor( int i = 1 ; i <= n ; i ++ )\n\t{\n\t\tans = ans * K[i][i];\n\t}\n\treturn ans;\n}\n\nvoid solve()\n{\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t{\n\t\t\tD[i][i] += G[i][j];\n\t\t}\n\t}\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t{\n\t\t\tK[i][j] = D[i][j] - G[i][j];\n\t\t}\n\t}\n\tres = Gauss( N - 1 );\n}\n\nint main()\n{\n\tread( N );\n\tdouble c = 1;\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t{\n\t\t\tscanf( \"%lf\", &G[i][j] );\n\t\t\tif( G[i][j] == 1 ) G[i][j] -= eps;\n\t\t\tif( i < j && G[i][j] ) c *= ( 1 - G[i][j] );\n\t\t\tG[i][j] = G[i][j] / ( 1 - G[i][j] );\n\t\t}\n\t}\n\tsolve();\n\tprintf( \"%.12lf\\n\", c * res );\n\treturn 0;\n}\n```",
        "postTime": 1566393487,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[P3317][SDOI2014]\u91cd\u5efa"
    }
]