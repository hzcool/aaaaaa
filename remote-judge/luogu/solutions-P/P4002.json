[
    {
        "content": "\u6211\u6765\u80e1\u4e00\u4e2a $O(n\\log^2n)$ \u505a\u6cd5\u3002\n\n\u8003\u8651\u7528 Prufer \u5e8f\u5217\u53bb\u5bf9\u5e94\u6811\uff0c\u8bbe $d_i$ \u8868\u793a $i$ \u5728 Prufer \u5e8f\u5217\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5219\u6709 $\\sum d_i = n - 2$\u3002\n\n\u8003\u8651\u5ea6\u6570\u5e8f\u5217 $d$ \u9020\u6210\u7684\u8d21\u732e\u662f\uff1a\n\n$$\\frac{(n-2)!}{\\prod d_i!}\\prod(d_i+1)^ma_i^{d_i+1}\\sum (d_i+1)^m$$\n\n$$=(n-2)!\\prod a_i \\sum_j \\frac{1}{\\prod d_i!} \\prod a_i^{d_i}\\prod_{i\\ne j}(d_i+1)^m (d_j+1)^{2m}$$\n\n\u8fd9\u524d\u9762\u7684 $(n-2)!\\prod a_i$ \u662f\u5e38\u6570\uff0c\u53ea\u8003\u8651\u540e\u9762\u7684\u8fd9\u4e2a $\\sum$\u3002\n\n\u8bbe\u540e\u9762\u8fd9\u4e2a $\\sum$ \u5173\u4e8e $\\sum d_i$ \u7684\u751f\u6210\u51fd\u6570\u662f $F(x)$\u3002\n\n\u6211\u4eec\u770b\u5230\u6bcf\u4e00\u4e2a $d_i$ \u9020\u6210\u7684\u8d21\u732e\u662f $\\frac{1}{d_i!} a_i^{d_i}(d_i+1)^m$ \u6216\u8005\u6700\u540e\u4e00\u4e2a\u5e42\u6b21\u662f$2m$\u3002\n\n\u81ea\u7136\u800c\u7136\u60f3\u5230 $F(x)$ \u4f1a\u662f\u5f88\u591a\u5173\u4e8e $a_ix$ \u7684\u591a\u9879\u5f0f\u7684\u79ef\uff0c\u5373\u8bbe\uff1a\n\n$$A(x)=\\sum_{k} \\frac{1}{k!} (k+1)^m x^k$$\n\n$$B(x)=\\sum_{k} \\frac{1}{k!} (k+1)^{2m} x^k$$\n\n\u90a3\u4e48\u6709\uff1a\n\n$$F(x)=\\sum_i B(a_ix) \\prod_{j\\ne i} A(a_j x)$$\n\n$$=\\sum_i \\frac{B(a_i x)}{A(a_i x)} \\prod_i A(a_ix)$$\n\n$$=\\sum_i \\frac{B(a_i x)}{A(a_i x)} \\cdot \\exp {\\sum_i \\ln A(a_ix)}$$\n\n\u6c42\u51fa $\\frac{B(x)}{A(x)}$ \u548c $\\ln A(x)$ \u540e\uff0c\u9700\u8981\u4ee3\u5165 $a_ix$ \u5e76\u6c42\u548c\uff0c\u5373\u7b2c $t$ \u9879\u7cfb\u6570\u9700\u8981\u4e58 $\\sum a_i^t$\n\n\u4e8e\u662f\u8fd8\u8981\u5bf9 $0\\le k < n-1$ \u9884\u5904\u7406\u4e00\u4e2a $\\sum_i a_i^k$\u3002\n\n\n\u6ce8\u610f\u5230$\\sum_{k\\ge 0}a^kx^k=\\frac{1}{1-ax}$\n\n\u5219\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570\u4e3a\n\n$$\\sum_{i=1}^n\\frac{1}{1-a_ix}=\\frac{\\sum\\limits_{i=1}^n\\prod\\limits_{j\\neq i}(1-a_jx)}{\\prod\\limits_{i=1}^n(1-a_ix)}$$\n\n\u5176\u4e2d\uff0c\n\n$$Q(x)=\\prod_{i=1}^n(1-a_ix)$$\n\n\u53ef\u4ee5\u7528\u5206\u6cbb FFT \u6c42\u51fa\u3002\n\n\u5bf9\u6bd4\u5206\u5b50\u548c\u5206\u6bcd\u7684\u7cfb\u6570\uff08\u6216\u662f\u628a\u5206\u6bcd\u53cd\u8f6c\uff0c\u6c42\u5bfc\uff0c\u518d\u53cd\u8f6c\uff09\u5f97\u5230\uff1a\n\n$$P(x)=\\sum_{i=1}^n\\prod_{j\\neq i}(1-a_jx)=\\sum_{k=0}^{n-1}x^k(n-k)[x^k]Q(x)$$",
        "postTime": 1540132727,
        "uid": 50882,
        "name": "OwenOwl",
        "ccfLevel": 10,
        "title": "4002 \u9898\u89e3"
    },
    {
        "content": "\u200b\t\u5173\u4e8e\u672c\u9898\u7684\u5404\u79cd\u505a\u6cd5...\n\n##### \u7b2c\u4e00\u6b65\n\n\u200b\t\u9996\u5148\uff0c\u5982\u679c\u4e00\u4e2a\u5927\u5c0f\u4e3a $a_i$ \u7684\u8fde\u901a\u5757\u8fde\u51fa\u4e86 $d_i$ \u6761\u8fb9\uff0c\u90a3\u4e48\u8fd9 $d_i$ \u6761\u8fb9\u5728\u8fde\u901a\u5757\u5185\u90e8\u7684\u51fa\u53d1\u70b9\u5c31\u603b\u5171\u6709 $a_i^{d_i}$ \u79cd\u7ec4\u5408\uff0c\u5373\uff0c\u8fd9\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f $a_i^{d_i}$ \u7684\u8d21\u732e\u3002\u4e8e\u662f\uff0c\u5bf9\u4e8e\u4e00\u79cd\u6240\u6709\u70b9\u7684\u5ea6\u6570\u5206\u522b\u4e3a $d_1,\\cdots,d_n$ \u7684\u60c5\u51b5\uff0c\u5b83\u4eec\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $\\prod_i a_i^{d_i}d_i^m(\\sum_id_i^m)$\u3002\n\n\u200b\t\u8003\u8651\u4f7f\u56fe\u7684\u751f\u6210\u6811\u548c **Prufer \u5e8f\u5217**\u4e00\u4e00\u5bf9\u5e94\u3002\u5bf9\u4e8e\u4e00\u4e2a\u5ea6\u6570\u4e3a $d_i$ \u7684\u8fde\u901a\u5757\uff08\u4ee5\u4e0b\u7b80\u79f0 \u201c \u70b9 \u201d\uff09$i$\uff0c\u5176\u5728 Prufer \u5e8f\u5217\u4e2d\u4f1a\u51fa\u73b0 $d_i-1$ \u6b21\u3002\u6211\u4eec\u73b0\u5728\u5c1d\u8bd5\u628a\u4e00\u4e2a\u4e2a\u70b9\u586b\u5165 Prufer \u5e8f\u5217\u3002\n\n\u200b\t\u8bbe $f_{i,j}$ \u8868\u793a\u5f53\u524d\u5df2\u7ecf\u628a\u524d $i$ \u4e2a\u70b9\u586b\u5165\u4e86 Prufer \u5e8f\u5217\uff0c\u5360\u4e86 $j$ \u4e2a\u4f4d\u7f6e\u7684 $\\prod_i a_i^{d_i}d_i^m$ \u603b\u548c\uff0c$g_{i,j}$ \u8868\u793a\u5bf9\u5e94\u60c5\u51b5\u4e0b\u7684 $\\prod_i a_i^{d_i}d_i^m(\\sum_id_i^m)$ \u603b\u548c\u3002\u679a\u4e3e\u7b2c $i$ \u4e2a\u70b9\u5360\u4e86\u591a\u5c11\u4e2a\u4f4d\u7f6e\uff0c\u5bb9\u6613\u5f97\u51fa\uff1a\n$$\nf_{i,j}=\\sum_{k\\leq j}f_{i-1,k}\\dbinom{j}{k}a_i^{j-k+1}(j-k+1)^m\n$$\n\n$$\ng_{i,j}=\\sum_{k\\leq j}g_{i-1,k}\\dbinom{j}{k}a_i^{j-k+1}(j-k+1)^m+\\sum_{k\\leq j}f_{i-1,k}\\dbinom{j}{k}a_i^{j-k+1}(j-k+1)^{2m}\n$$\n\n\u200b\t\u5f97\u5230\u4e00\u4e2a $O(n^3)$ \u7684\u66b4\u529b\u3002\n\n\u200b\t\u4ee5\u540e\u7684\u8ba8\u8bba\u90fd\u4ee5\u6b64\u4e3a\u57fa\u7840\u3002\n\n##### \u7b2c\u4e8c\u6b65\n\n\u200b\t\u53d1\u73b0 $f_{i,j}$ \u53ef\u4ee5\u5377\u79ef\u5730\u8f6c\u79fb\u3002\n\n\u200b\t\u4f7f\u7528**\u6307\u6570\u751f\u6210\u51fd\u6570**\uff0c\u8bb0 $F_i(x)=\\sum_j\\dfrac{f_{i,j}}{j!}x^j$\uff0c$G_i(x)$ \u7c7b\u4f3c\uff0c\u6211\u4eec\u628a\u4e0a\u8ff0\u8f6c\u79fb\u6539\u5199\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a\n$$\nF_i(x)=F_{i-1}(x)*P_i(x)\n$$\n\n$$\nG_i(x)=G_{i-1}(x)*P_i(x)+F_{i-1}(x)*Q_i(x)\n$$\n\n\u200b\t\uff08\u867d\u7136\u76f8\u5f53\u4e0d\u4e25\u8c28\uff0c\u82e5\u65e0\u7279\u6b8a\u9700\u8981\u8fd9\u91cc\u4e0d\u518d\u533a\u5206\u591a\u9879\u5f0f $F(x)$ \u548c $F$\u3002\uff09\n\n\u200b\t\u5176\u4e2d\n$$\nP_i(x)=\\sum_j\\frac{a_i^{j+1}(j+1)^m}{j!}x_j\n$$\n\n$$\nQ_i(x)=\\sum_j\\frac{a_i^{j+1}(j+1)^{2m}}{j!}x_j\n$$\n\n\u200b\t\uff08$P_i$ \u548c $Q_i$ \u957f\u5f97\u8fd9\u4e48\u50cf\uff1f\uff09\n\n\u200b\t\u8fdb\u4e00\u6b65\u5730\uff0c\u53ef\u4ee5\u7528**\u77e9\u9635**\u6539\u5199\u6210\u5982\u4e0b\u5f62\u5f0f\n$$\n\\begin{pmatrix}\nP_i & 0\\\\\nQ_i & P_i\n\\end{pmatrix}*\n\\begin{pmatrix}\nF_{i-1}\\\\\nG_{i-1}\n\\end{pmatrix}=\n\\begin{pmatrix}\nF_i\\\\\nG_i\n\\end{pmatrix}\n$$\n\u200b\t\u4e8e\u662f\u53ea\u8981\u6c42 $\\prod_i\\begin{pmatrix}P_i & 0\\\\Q_i & P_i\\end{pmatrix}$ \u5373\u53ef\u3002\n\n\u200b\t\u518d\u5316 $P_i$\uff0c\u6709\n$$\nP_i(x)=\\sum_j\\frac{a_i^{j+1}(j+1)^m}{j!}x_j\\\\\n=\\sum_j\\frac{a_i^{j+1}}{j!}x^j\\sum_{k\\leq m}\\begin{Bmatrix}m\\\\k\\end{Bmatrix}\\dbinom{j+1}{k}k!\\\\\n=\\sum_{k\\leq m}\\begin{Bmatrix}m\\\\k\\end{Bmatrix}k!\\sum_j\\frac{a_i^{j+1}(j+1)}{(j+1-k)!}x^j\\\\\n$$\n\u200b\t\u524d\u9762\u7684\u5148\u4e0d\u7ba1\uff0c\u770b\u5230\u540e\u9762\u7684\u548c\u5f0f\u6709\u70b9\u50cf **exp** \u7684\u5f62\u5f0f\u3002\u5177\u4f53\u5730\uff0c\u82e5\u5b83\u771f\u7684\u6709\u4e00\u4e2a\u7c7b\u4f3c\u5f62\u5f0f\u7684\u8bdd\uff0c$(j+1)$ \u610f\u5473\u7740\u53ef\u80fd\u9700\u8981\u6c42\u5bfc\uff0c\u4e0b\u9762\u7684\u9636\u4e58\u5e73\u79fb\u4e86 $k$ \u610f\u5473\u7740\u9700\u8981\u591a\u9879\u5f0f\u5e73\u79fb\uff0c\u800c\u4e0a\u9762\u7684 $a_i^{j+1}$ \u610f\u5473\u7740\u6709\u7c7b\u4f3c $e^{a_ix}$ \u7684\u5f0f\u5b50\u51fa\u73b0\u3002\n\n\u200b\t\u7efc\u5408\u4e0a\u9762\u51e0\u70b9\u4e0d\u96be\u5f97\u51fa\u540e\u9762\u548c\u5f0f\u5c31\u662f\n$$\n(a_i^kx^ke^{a_ix})'\n=a_i^kx^{k-1}(k+a_ix)e^{a_ix}\n$$\n\u200b\t\u7ee7\u7eed\u5316\n$$\nP_i(x)=\\sum_{k\\leq m}\\begin{Bmatrix}m\\\\k\\end{Bmatrix}k!a_i^kx^{k-1}(k+a_ix)e^{a_ix}\\\\\n=e^{a_ix}\\sum_{k\\leq m}\\begin{Bmatrix}m+1\\\\k+1\\end{Bmatrix}a_i^{k+1}x^k\n$$\n\u200b\t\u6700\u540e\u4e00\u6b65\u7528\u5230\u4e86 $\\begin{Bmatrix}m\\\\k\\end{Bmatrix}=k\\begin{Bmatrix}m-1\\\\k\\end{Bmatrix}+\\begin{Bmatrix}m-1\\\\k-1\\end{Bmatrix}$\u3002\u5bf9 $Q_i$ \u7684\u63a8\u5bfc\u540c\u7406\u3002\n\n\u200b\t\u518d\u8bb0 $A_i(x)=\\sum_{k\\leq m}\\begin{Bmatrix}m+1\\\\k+1\\end{Bmatrix}a_i^{k+1}x^k,B_i(x)=\\sum_{k\\leq 2m}\\begin{Bmatrix}2m+1\\\\k+1\\end{Bmatrix}a_i^{k+1}x^k$\u3002\n\n\u200b\t\u6ce8\u610f\u5230 $A_i,B_i$ \u90fd\u662f\u6b21\u6570\u5c0f\u4e8e\u7b49\u4e8e $2m$ \u7684\u591a\u9879\u5f0f\u3002\n\n\u200b\t\u56de\u5934\u770b\u539f\u6765\u7684\u77e9\u9635\u4e58\u79ef\uff0c\u628a\u6240\u6709 exp \u63d0\u51fa\u6765\uff0c\u5f97\u5230\u6240\u6c42\u7684\u5f0f\u5b50\u4e3a\n$$\ne^{Sx}\\prod_i\\begin{pmatrix}A_i & 0\\\\B_i & A_i\\end{pmatrix}\n$$\n\u200b\t**FFT \u5206\u6cbb**\u3002\u590d\u6742\u5ea6 $O(nm\\log^2 n)$\uff08\u7cbe\u7ec6\u7684\u5b9e\u73b0\u53ef\u4ee5\u6709 $O(nm\\log n\\log m)$\uff1f\uff09\u3002\n\n\u200b\t\u6ce8\u610f\u7684\u662f\uff0c\u76f4\u63a5\u505a\u77e9\u9635\u4e58\u6cd5\u7684\u5e38\u6570\u663e\u7136\u5de8\u5927\uff0c\u4f46\u8fd9\u4e2a\u77e9\u9635\u7684\u7279\u6b8a\u5f62\u5f0f\u6709\n$$\n\\begin{pmatrix}A_i & 0\\\\B_i & A_i\\end{pmatrix}\\begin{pmatrix}A_j & 0\\\\B_j & A_j\\end{pmatrix}=\\begin{pmatrix}A_iA_j & 0\\\\B_iA_j+A_iB_j & A_iA_j\\end{pmatrix}\n$$\n\u200b\t\u524d\u540e\u5f62\u5f0f\u76f8\u540c\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8f6c\u79fb\u3002**\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002**\n\n\u200b\t\u7ee7\u7eed\u4f18\u5316\uff1f\n\n##### \u7b2c\u4e09\u6b65\n\n\u200b\t\u4e0a\u9762\u7684\u5c0f\u4f18\u5316\u53ef\u4ee5\u63a8\u5e7f\u3002\u53ef\u4ee5\u5f52\u7eb3\u5730\u8bc1\u660e\u6240\u6709\u8fd9\u4e9b\u77e9\u9635\u4e58\u8d77\u6765\u540e\u5de6\u4e0b\u89d2\u591a\u9879\u5f0f\u4e3a\n$$\n\\sum_iB_i\\prod_{j\\ne i}A_j=\\prod_iA_i(\\sum_jB_j*A_j^{-1})\n$$\n\u200b\t\u8bbe $\\{a_j\\}$ **\u5e42\u548c**\u7684\u751f\u6210\u51fd\u6570 $T(x)=\\sum_i(\\sum_ja_j^i)x^i$\u3002\n\n\u200b\t\u6ce8\u610f\u5230 $A_i(x)$ \u7684\u5f62\u5f0f\u90fd\u5f88\u63a5\u8fd1\u3002\u8bbe $A(x)=\\sum_{k\\leq m}\\begin{Bmatrix}m+1\\\\k+1\\end{Bmatrix}x^k$\uff0c\u90a3\u4e48 $A_i(x)=a_iA(a_ix)$\u3002 $B_i(x)$ \u540c\u7406\u3002\n\n\u200b\t\u7136\u540e\n$$\n\\sum_j{B_j}*{A_j}^{-1}=\\sum_j{B(a_jx)}*{A(a_jx)}^{-1}=\\sum_j(B*A^{-1})(a_jx)=T\\cdot(B*A^{-1})\n$$\n\u200b\t\u8fd9\u91cc $\\cdot$ \u662f**\u70b9\u4e58**\uff0c\u5373\u5bf9\u5e94\u4f4d\u7f6e\u76f8\u4e58\u3002\n\n\u200b\t\u7ee7\u7eed\n$$\n\\prod_i A_i=\\exp \\sum_i \\ln A_i=\\exp \\sum_i \\ln a_iA(a_ix)=\\exp(T\\cdot\\ln A)\n$$\n\u200b\t\u5982\u679c\u6c42\u51fa $T$ \u7684\u8bdd\uff0c\u8fd9\u4e24\u4e2a\u5f0f\u5b50\u90fd\u53ef\u4ee5\u5feb\u901f\u6c42\u89e3\u3002\u6c42 $T$ \u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\uff0c\u6709\n$$\nT(x)=\\sum_i(\\sum_ja_j^i)x^i=\\sum_j\\sum_i (a_jx)^i=\\sum_j\\frac{1}{1-a_jx}=\\frac{\\sum_i\\prod_{j\\ne i}(1-a_jx)}{\\prod_i(1-a_ix)}\n$$\n\u200b\tFFT \u5206\u6cbb\u89e3\u51b3\uff0c\u590d\u6742\u5ea6 $O(n\\log^2 n)$\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u200b\t\u6700\u540e\u653e\u51fa\u539f\u95ee\u9898\u5b8c\u6574\u7684\u6c42\u89e3\u5f0f\uff08\u4f3c\u4e4e\u4e24\u4e2a exp\u200b \u53ef\u4ee5\u5408\u5e76\uff1f\uff09\uff1a\n$$\nAns=(n-2)![x^{n-2}]\\exp(Sx)*(T\\cdot(B*A^{-1}))*\\exp(T\\cdot\\ln A)\n$$\n\u200b\t\u4e8e\u662f\u6700\u7ec8\u6211\u4eec\u5728 $O(n\\log^2 n)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u4e86\u95ee\u9898\u3002\n\n\u200b\t\u56e0\u4e3a\u662f\u591a\u9879\u5f0f\u9898\uff0c\u672c\u849f\u84bb\u4ee3\u7801\u8f83\u957f\u800c\u4e14\u7801\u98ce\u5947\u4e11\uff0c\u5c31\u4e0d\u653e\u4ee3\u7801\u4e86\u3002",
        "postTime": 1616063860,
        "uid": 259028,
        "name": "Aly_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4002 \u3010[\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.com.cn/problemnew/solution/P4002)\n\n\u4e00\u4e2a\u7528\u65af\u7279\u6797\u6570\u7684$O(nm\\log^2n)$\u505a\u6cd5\n\n\u8003\u8651\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u5373\n\n$$\\sum_{T}(\\prod_{i=1}^n d_i^{m})(\\sum_{i=1}^nd_{i}^m)(\\prod_{i=1}^na_i^{d_i})$$\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u6709\u8fd9\u4e2a$\\prod_{i=1}^na_i^{d_i}$\uff0c\u662f\u56e0\u4e3a\u5728\u7b2c$i$\u4e2a\u8054\u901a\u5757\u91cc\u8fde\u7684\u8fd9$d_i$\u6761\u8fb9\u7684\u7aef\u70b9\u53ef\u4ee5\u662f$a_i$\u4e2a\u70b9\u4e2d\u968f\u4fbf\u9009\uff0c\u4e8e\u662f\u5c31\u662f$a_i^{d_i}$\n\n\u8003\u8651\u66b4\u529b\u5316\u67ff\u5b50\n\n$$Ans=\\sum_T\\sum_{i=1}^nd_i^{m}\\prod_{j=1}^nd_j^ma_j^{d_j}=\\sum_T\\sum_{i=1}^nd_i^{2m}\\times a_i^{d_i}\\prod_{i\\neq j}d_j^ma_j^{d_j}$$\n\n\u5176\u5b9e\u5c31\u662f\u4ece\u540e\u9762\u90a3\u4e2a$\\prod$\u91cc\u62c6\u4e86\u4e2a$d_i^ma_i^{d_i}$\u51fa\u6765\n\n\u8fd9\u8001\u5199$\\sum_T$\u591a\u96be\u770b\uff0c\u628a\u751f\u6210\u6811\u8f6c\u5316\u6210$\\rm prufer$\u5e8f\u5217\uff0c\u8bbe$c_i$\u8868\u793a\u7b2c$i$\u4e2a\u70b9\u5728$\\rm prufer$\u5e8f\u5217\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u663e\u7136\u6709$d_i=c_i+1$\uff0c\u6709\n\n$$Ans=\\sum_{\\sum c=n-2}\\sum_{i=1}^n(c_i+1)^{2m}a_i^{c_i+1}\\prod_{i\\neq j}(c_j+1)^ma_j^{c_j+1}$$\n\n$\\{c_i\\}$\u5bf9\u5e94\u7684$\\rm prufer$\u5e8f\u5217\u5171\u6709$\\frac{(n-2)!}{\\prod c_i!}$\uff0c\u4e8e\u662f\u6211\u4eec\u80fd\u8fdb\u4e00\u6b65\u5199\u6210\n\n$$\\frac{(n-2)!}{\\prod c_i!}\\sum_{i=1}^n(c_i+1)^{2m}a_i^{c_i+1}\\prod_{i\\neq j}(c_j+1)^ma_j^{c_j+1}$$\n\n\u4e0d\u59a8\u5c06$\\frac{1}{\\prod c_i!}$\u5206\u914d\u8fdb\u53bb\uff0c\u5219\u6709\n\n$$(n-2)!\\sum_{i=1}^n\\frac{(c_i+1)^{2m}a_i^{c_i+1}}{c_i!}\\prod_{i\\neq j}\\frac{(c_j+1)^ma_j^{c_j+1}}{c_j!}$$\n\n\u4e0d\u96be\u8bbe\u4e24\u4e2a$\\rm EGF$\uff0c${\\rm A}_i(x)=\\sum_{j=0}^{\\infty}\\frac{(j+1)^{2m}a_i^{j+1}}{j!}x^j,{\\rm B}_i(x)=\\sum_{j=0}^{\\infty}\\frac{(j+1)^{m}a_i^{j+1}}{j!}x^j$\n\n\u8fd9\u6837\u6211\u4eec\u7684\u7b54\u6848\u5c31\u80fd\u5199\u6210\n\n$$(n-2)![n-2](\\sum_{i=1}^n{\\rm A}_i(x)\\times \\prod_{i\\neq j}{\\rm B}_j(x))$$\n\n\u5373\u90a3\u4e9b\u4e2a$\\rm EGF$\u5377\u8d77\u6765\u7684\u7b2c$n-2$\u6b21\u9879\u7cfb\u6570\n\n\u73b0\u5728\u5c31\u662f\u795e\u5947\u7684\u9b54\u6cd5\u4e86\uff0c\u4ee5${\\rm B}_i(x)$\u4e3a\u4f8b\uff0c\u6211\u4eec\u5148\u79ef\u5206\u4e00\u4e0b\uff0c\u5f97\u5230\u7684\u662f\n\n$$\\sum_{j=0}^{\\infty}\\frac{(j+1)^ma_i^{j+1}}{(j+1)!}x^{j+1}=\\sum_{j=1}^{\\infty}\\frac{j^ma_i^{j}}{j!}x^{j}$$\n\n\u7528\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u5c06$j^m$\u5c55\u5f00\n\n$$\\sum_{j=1}^{\\infty}\\frac{a_i^{j}}{j!}x^{j}\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}j^{\\underline k}=\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}\\sum_{j=1}^{\\infty}\\frac{a_i^{j}j^{\\underline k}}{j!}x^{j}$$\n\n\u6ce8\u610f\u5230$\\frac{j^{\\underline k}}{j!}$\u5176\u5b9e\u5c31\u662f$\\frac{!}{(j-k)!}$\uff0c\u4e8e\u662f\u6211\u4eec\u4ece\u540e\u9762\u63d0\u4e00\u4e2a$a_i^{k}x_k$\u51fa\u6765\uff0c\u5e76\u5c06\u540e\u9762\u7684\u67ff\u5b50\u6cf0\u52d2\u5c55\u5f00\u4e00\u4e0b\n\n$$\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}a_i^{k}x^k\\sum_{j=1}^{\\infty}\\frac{a_i^{j-k}}{(j-k)!}x^{j-k}=\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}a_i^{k}x^ke^{a_ix}$$\n\n\u6211\u4eec\u5bf9\u4e8e$\\int {\\rm B}_i(x)\\rm dx$\u5f97\u5230\u4e86\u4e00\u4e2a\u4f18\u7f8e\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u6211\u4eec\u518d\u6c42\u5bfc\u56de\u53bb\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u6210\u662f$\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}a_i^{k}x^k$\u4e58$e^{a_ix}$\u8fd9\u4e24\u4e2a\u51fd\u6570\u76f8\u4e58\u6c42\u5bfc\uff0c\u90a3\u4e48\u6839\u636e\u6c42\u5bfc\u7684\u6cd5\u5219$[f(x)g(x)]'=f(x)g'(x)+f'(x)g(x)$\uff0c\u5c31\u6709\n\n$$\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}a_i^{k}kx^{k-1}e^{a_ix}+\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}a_i^{k}x^ka_ie^{a_ix}$$\n\n\u6574\u7406\u4e00\u4e0b\u5c31\u6709\n\n$$e^{a_ix}(\\sum_{k=1}^m(k+1)\\begin{Bmatrix}m\\\\k+1\\end{Bmatrix}a_i^{k+1}x^k+\\sum_{k=0}^m\\begin{Bmatrix}m\\\\k\\end{Bmatrix}a_i^{k+1}x^k)$$\n\n\u6839\u636e\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u9012\u63a8\u5f0f\uff0c\u6211\u4eec\u60ca\u5947\u7684\u53d1\u73b0$(k+1)\\begin{Bmatrix}m\\\\k+1\\end{Bmatrix}+\\begin{Bmatrix}m\\\\k\\end{Bmatrix}=\\begin{Bmatrix}m+1\\\\k+1\\end{Bmatrix}$\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e00\u4e2a\u6781\u5176\u4f18\u7f8e\u7684\u5f62\u5f0f\n\n$${\\rm B}_i(x)=e^{a_ix}\\sum_{k=0}^m\\begin{Bmatrix}m+1\\\\k+1\\end{Bmatrix}a_i^{k+1}x^k$$\n\n\u7c7b\u4f3c\u7684\n\n$${\\rm A}_i(x)=e^{a_ix}\\sum_{k=0}^{2m}\\begin{Bmatrix}2m+1\\\\k+1\\end{Bmatrix}a_i^{k+1}x^k$$\n\n\u518d\u8bbe${\\alpha_i(x)}=\\frac{{\\rm A}_i(x)}{e^{a_ix}},{\\beta _i(x)}=\\frac{{\\rm B}_i(x)}{e^{a_ix}}$\n\n\u56de\u5230\u6700\u5f00\u59cb\u7684\u5f0f\u5b50\uff0c\u4e0d\u59a8\u5c06$\\sum_{i=1}^n{\\rm A}_i(x)\\times \\prod_{i\\neq j}{\\rm B}_j(x)$\u5199\u6210$e^{x\\sum a}\\sum_{i=1}^n{\\alpha}_i(x)\\times \\prod_{i\\neq j}{\\beta}_j(x)$\uff0c\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5199\u6210\n\n\n$$\\prod_{i=1}^n{\\beta}_i(x)\\times \\sum_{i=1}^n\\frac{{\\alpha}_i(x)}{{\\beta}_i(x)}$$\n\n$\\sum_{i=1}^n\\frac{{\\alpha}_i(x)}{{\\beta}_i(x)}$\u5e76\u6ca1\u6709\u60f3\u5230\u4ec0\u4e48\u597d\u505a\u6cd5\uff0c\u90a3\u5c31\u4e00\u8fb9\u5206\u6cbb\u4e00\u8fb9\u901a\u5206\u5427\uff0c\u4e4b\u540e\u5206\u6cbb\u901a\u5206\u5230\u6700\u540e\u53d1\u73b0\u5206\u6bcd\u5c31\u662f$\\prod_{i=1}^n{\\beta}_i(x)$\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u5206\u5b50\u5c31\u597d\u4e86\n\n\u4ee3\u7801\u9e3d\u4e86\uff0c\u6709\u7a7a\u6765\u8865\n\nUPD on 2019.12.28 \u539f\u6765\u7684\u5f0f\u5b50\u6700\u540e\u4e00\u6b65\u94a6\u5b9a\u9519\u4e86\uff0c\u597d\u50cf\u5bfc\u81f4\u4e00\u4f4d\u8001\u9e3d\u8c03\u4e86\u4e00\u5929\uff0c\u624b\u52a8\u8c22\u7f6a\n\n\u6765\u8865\u4e0a\u4ee3\u7801\u4e86\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\nconst int mod=998244353;\nconst int G[2]={3,(mod+1)/3};\ninline int read() {\n\tchar c=getchar();int x=0;while(c<'0'||c>'9')c=getchar();\n\twhile(c>='0'&&c<='9')x=(x<<3)+(x<<1)+c-48,c=getchar();return x;\n}\nconst int Maxlen=65539;\nconst int maxn=3e4+5;\nstd::vector<int> p[maxn*3],q[maxn*3];\nint n,m,a[maxn],S[105][105],sum,len,inv[maxn],__og[2][50];\nint rev[Maxlen],A[Maxlen],C[Maxlen],B[Maxlen],D[Maxlen];\ninline int dqm(int x) {return x<0?x+mod:x;}\ninline int qm(int x) {return x>=mod?x-mod:x;}\ninline int ksm(int a,int b) {\n\tint S=1;for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)S=1ll*S*a%mod;return S;\n}\ninline void NTT(int *f,int o) {\n\tfor(re int i=0;i<len;i++)if(i<rev[i])std::swap(f[i],f[rev[i]]);\n\tfor(re int w=0,i=2;i<=len;i<<=1,++w) {\n\t\tint ln=i>>1,og1;\n\t\tif(!__og[o][w])og1=__og[o][w]=ksm(G[o],(mod-1)/i);else og1=__og[o][w];\n\t\tfor(re int t,og=1,l=0;l<len;l+=i,og=1)\n\t\t\tfor(re int x=l;x<l+ln;++x) {\n\t\t\t\tt=1ll*f[x+ln]*og%mod,og=1ll*og1*og%mod;\n\t\t\t\tf[x+ln]=dqm(f[x]-t);f[x]=qm(f[x]+t);\n\t\t\t}\n\t}\n\tif(!o)return;int Inv=ksm(len,mod-2);for(re int i=0;i<len;i++)f[i]=1ll*f[i]*Inv%mod;\n}\nvoid cdq(int l,int r,int k) {\n\tif(l==r) {\n\t\tint nw=a[l];\n\t\tfor(re int i=0;i<=m+m;i++)p[k].push_back(1ll*nw*S[m+m+1][i+1]%mod),nw=1ll*nw*a[l]%mod;\n\t\tnw=a[l];for(re int i=0;i<=m;i++)q[k].push_back(1ll*nw*S[m+1][i+1]%mod),nw=1ll*nw*a[l]%mod;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tcdq(l,mid,k<<1),cdq(mid+1,r,k<<1|1);\n\tint lenl=p[k<<1].size(),lenr=p[k<<1|1].size();\n\tlen=1;while(len<=lenl+lenr+1) len<<=1;\n\tfor(re int i=0;i<len;i++)rev[i]=rev[i>>1]>>1|((i&1)?len>>1:0);\n\tfor(re int i=0;i<p[k<<1].size();++i) A[i]=p[k<<1][i];\n\tfor(re int i=0;i<p[k<<1|1].size();++i) B[i]=p[k<<1|1][i];\n\tfor(re int i=0;i<q[k<<1].size();++i) C[i]=q[k<<1][i];\n\tfor(re int i=0;i<q[k<<1|1].size();++i) D[i]=q[k<<1|1][i];\n\tNTT(A,0),NTT(B,0),NTT(C,0),NTT(D,0);\n\tfor(re int i=0;i<len;i++) A[i]=qm(1ll*A[i]*D[i]%mod+1ll*B[i]*C[i]%mod),C[i]=1ll*C[i]*D[i]%mod;\n\tNTT(A,1),NTT(C,1);\n\tfor(re int i=0;i<len;i++) {\n\t\tif(i>n-2) break;\n\t\tp[k].push_back(A[i]);\n\t\tq[k].push_back(C[i]);\n\t}\n\tfor(re int i=0;i<len;i++) A[i]=B[i]=C[i]=D[i]=0;\n\tint lp=p[k].size(),lq=q[k].size();lp--;lq--;\n\tfor(re int i=lp;i>=0;--i) \n\t\tif(!p[k][i]) p[k].pop_back();else break;\n\tfor(re int i=lq;i>=0;--i)\n\t\tif(!q[k][i]) q[k].pop_back();else break;\n}\nsigned main() {\n\tn=read(),m=read();S[0][0]=1;inv[0]=1;\n\tfor(re int i=1;i<=m+m+1;i++)\n\t\tfor(re int j=1;j<=i;++j) S[i][j]=qm(S[i-1][j-1]+1ll*S[i-1][j]*j%mod);\n\tfor(re int i=1;i<=n;i++) a[i]=read(),sum=qm(sum+a[i]);\n\tif(n==1) return puts(\"1\"),0;\n\tinv[1]=1;for(re int i=2;i<=n;i++) inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n\tcdq(1,n,1);for(re int i=0;i<p[1].size();++i) A[i]=p[1][i];int ans=0;\n\tfor(re int i=1;i<=n-2;i++) inv[i]=1ll*inv[i]*inv[i-1]%mod;\n\tfor(re int nw=1,i=0;i<=n-2;i++,nw=1ll*nw*sum%mod)B[i]=1ll*inv[i]*nw%mod;\n\tfor(re int i=0;i<=n-2;i++)ans=qm(ans+1ll*A[i]*B[n-2-i]%mod);\n\tfor(re int i=1;i<=n-2;i++)ans=1ll*ans*i%mod;\n\tstd::cout<<ans<<std::endl;return 0;\n}\n//g++ lg4002.cpp -o lg4002\n```",
        "postTime": 1576408113,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4002 \u3010[\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "$\\mathrm{GF}$ \u83dc\u9e21\u6765\u80e1\u4e00\u53d1\u3002~~\u611f\u8c22\u8fd9\u6bb5\u65f6\u95f4 $\\color{red}\\rm{GuidingStar}$ \u7684\u5927\u529bpy~~\n\n\u55b5\u55b5\u55b5~\n\n\u5bb9\u6613\u60f3\u5230\u76f4\u63a5\u679a\u4e3e\u6811\n\n$$\n\\sum_T\\left(\\prod_{i=1}^na_i^{d_i}d_i^m\\right)\\left(\\sum_{i=1}^nd_i^m\\right)\n$$\n\n$$\n\\sum_T\\sum_{i=1}^n a_i^{d_i}d_i^{2m}\\prod_{j\\neq i}a_j^{d_j}d_j^m\n$$\n\n\u8fd0\u7528 $\\mathrm{Prufer}$ \u5e8f\u5217\u8fd9\u4e00\u5de5\u5177\n\n$$\n\\sum_{i=1}^n\\sum_{\\sum k_j=n-2}\\frac{(n-2)!}{\\prod k_j!}a_i^{k_i+1}(k_i+1)^{2m}\\prod_{j\\neq i}(a_j^{k_j+1}(k_j+1)^m)\n$$\n\n$$\n(n-2)!\\left(\\prod_{j=1}^n a_j\\right)\\sum_{i=1}^n\\sum_{\\sum k_j=n-2}\\frac{a_i^{k_i}(k_i+1)^{2m}}{k_i!}\\prod_{j\\neq i}\\frac{a_j^{k_j}(k_j+1)^m}{k_j!}\n$$\n\n\u8bbe \n\n$$\n\\begin{aligned}\n\\left[{z^n}\\right]F_i(z)&=\\frac{a_i^n(n+1)^{2m}}{n!}\n\\\\\n\\left[{z^n}\\right]G_i(z)&=\\frac{a_i^n(n+1)^m}{n!}\n\\end{aligned}\n$$\n\n\u5c06\u975e\u5e38\u6570\u9879\u5199\u6210\u5377\u79ef\u5f62\u5f0f\n\n$$\n\\left[{z^{n-2}}\\right]\\sum_{i=1}^n\\frac{F_i(z)}{G_i(z)}\\left(\\prod_{i=1}^nG_i(z)\\right)\n$$\n\n\u95ee\u9898\u53d8\u4e3a\u5feb\u901f\u6c42\u89e3\u8fd9\u4e2a\u5377\u79ef\u3002\u8bbe \n\n$$\nF(z)=\\sum_{n=0} \\frac{(n+1)^{2m}}{n!}z^n,G(z)=\\sum_{n=0}\\frac{(n+1)^m}{n!}z^n\n$$\n\n\u5219\u6709\n\n$$\nF_i(z)=F(a_iz),G_i(z)=G(a_iz)\n$$\n\n\n\u73b0\u5728\u9700\u8981\u8003\u8651\u5bf9\u4e8e\u4efb\u610f \n\n$$\nH_i(z)=\\sum_{n=0}a_i^nh_nz^n=\\frac{1}{1-a_iz}\n$$\n\n\u6c42\u89e3\n\n$$\n\\begin{aligned}\n\\sum_{i=1}^n H_i(z)=\\sum_{i=1}^n\\frac{1}{1-a_iz}\n\\end{aligned}\n$$\n\n\u56e0\u4e3a\u8fde\u4e58\u9879\u662f $H_i(z)=\\ln G(a_iz)$ \u5e76\u4e14 $\\exp$ \u56de\u539f\u5f0f\uff0c\u800c\u8fde\u52a0\u9879\u5176\u5b9e\u662f $H_i(z)=\\frac{F(a_iz)}{G(a_iz)}$\u3002\u5bf9\u4e8e\u8fd9\u4e24\u90e8\u5206\u90fd\u53ea\u9700\u8981\u6c42\u4e00\u904d $\\ln G(z)$ \u548c $\\frac{F(z)}{G(z)}$\u3002\n\n\u8bbe \n\n$$\nu=\\prod_{i=1}^n (1-a_iz)\n$$\n\n\u5219\u6240\u6c42\u53d8\u4e3a \n\n$$\n\\frac{u'}{u}\n$$\n\n\u4f7f\u7528\u5206\u6cbb $\\mathrm{NTT}$ \u6c42\u51fa $u$ \u7684\u503c\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log^2 n)$\n\n\n\n\n\n\n",
        "postTime": 1626316061,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "[\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570 \u9898\u89e3"
    },
    {
        "content": "\u4ece\u4e00\u4e2a\u8fde\u901a\u5757\u8fde\u51fa\u53bb\u4e00\u6761\u8fb9\u6709 $a_i$ \u79cd\u65b9\u6848\uff0c\u90a3\u4e48\u8fde\u51fa\u53bb $n$ \u6761\u4e92\u4e0d\u76f8\u540c\u7684\u8fb9\u7684\u65b9\u6848\u6570\u5c31\u662f $a_i^n$\n\n\u7531\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u8fde\u901a\u5757\u770b\u6210\u4e00\u4e2a\u70b9\n\n\u6211\u4eec\u53d1\u73b0\u6700\u7ec8\u8981\u6c42\u7684\u4e1c\u897f\u53ea\u4e0e\u6bcf\u4e2a\u70b9\u7684\u5ea6\u6570\u6709\u5173\u7cfb\uff0c\u7528 prufer \u5e8f\u5217\u6765\u8003\u8651\n\nprufer \u5e8f\u5217\u4e3a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n-2$ \u7684\u5e8f\u5217\uff0c\u5982\u679c $i$ \u5728\u91cc\u9762\u51fa\u73b0\u4e86 $d_i$ \u6b21\uff0c\u90a3\u4e48 $i$ \u7684\u5ea6\u6570\u4e3a $d_i+1$\n\n\u5bb9\u6613\u5199\u51fa\u7b54\u6848\u7684\u5f0f\u5b50\uff1a\n\n$$\\begin{aligned}\n\nans&=\\sum\\limits_{\\sum d=n-2}\\dbinom{n-2}{d_1,d_2,\\dots,d_n}\\left(\\prod\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\sum\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\prod\\limits_{i=1}^{n}a_i^{d_i+1}\\right)\\\\\n\n&=\\sum\\limits_{\\sum d=n-2}\\dfrac{(n-2)!}{\\prod_{i=1}^n d_i!}\\left(\\prod\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\sum\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\prod\\limits_{i=1}^{n}a_i^{d_i+1}\\right)\\\\\n\n&=(n-2)!\\prod\\limits_{i=1}^na_i\\sum\\limits_{\\sum d=n-2}\\left(\\sum\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\prod\\limits_{i=1}^{n}\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^m\\right)\n\n\\end{aligned}$$\n\n\u524d\u9762\u7684\u4e00\u70b9\u70b9\u662f\u5b9a\u503c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u540e\u9762\u7684\u90e8\u5206\uff1a\n\n$$ans'=\\sum\\limits_{\\sum d=n-2}\\left(\\sum\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\prod\\limits_{i=1}^{n}\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^m\\right)$$\n\n$\\sum d=n-2$ \u63d0\u793a\u6211\u4eec\u4f7f\u7528\u591a\u9879\u5f0f\uff0c\u5373\u8bbe\u82e5\u5e72\u4e2a\u751f\u6210\u51fd\u6570 $F_i(x)=\\sum\\limits_{j=0}^{\\inf}f(i,j)x^j$\uff0c\u5176\u4e2d $f(i,j)$ \u8868\u793a $d_i=j$ \u65f6\u5f0f\u5b50\u4e2d\u7684\u503c\n\n\u7136\u800c\u6211\u4eec\u5982\u679c\u6839\u636e\u4e0a\u9762\u7684\u591a\u9879\u5f0f\u662f\u8bbe\u4e0d\u51fa\u5408\u7406\u7684\u591a\u9879\u5f0f\u7684\uff0c\u56e0\u4e3a\u53f3\u4fa7 $\\prod\\limits_{i=1}^{n}\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^m$ \u7684\u6b21\u6570\u5c31\u5df2\u7ecf\u662f $\\sum d$ \u4e86\uff0c\u4e14\u5de6\u4fa7 $\\sum\\limits_{i=1}^{n}(d_i+1)$ \u7684\u6b21\u6570\u662f\u4e0d\u786e\u5b9a\u7684\n\n\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5bf9\u5f0f\u5b50\u8fdb\u884c\u53d8\u5f62\uff1a\n\n$$\\begin{aligned}\nans'&=\\sum\\limits_{\\sum d=n-2}\\left(\\sum\\limits_{i=1}^{n}(d_i+1)^m\\right)\\left(\\prod\\limits_{i=1}^{n}\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^m\\right)\\\\\n\n&=\\sum\\limits_{\\sum d=n-2}\\sum\\limits_{i=1}^n\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^{2m}\\prod\\limits_{j\\neq i}\\dfrac{a_j^{d_j}}{d_j!}(d_j+1)^m\n\\end{aligned}$$\n\n\u5373\u6211\u4eec\u5c06 $\\prod\\limits_{i=1}^{n}\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^m$ \u4e2d\u7684\u4e00\u9879\u63d0\u5230\u4e86\u524d\u9762\n\n\u73b0\u5728\u6211\u4eec\u89c2\u5bdf\u5f0f\u5b50\uff0c\u53ef\u4ee5\u53d1\u73b0\u5de6\u4fa7\u7684\u6b21\u6570\u4e3a $d_i$\uff0c\u800c\u53f3\u4fa7\u7684\u6b21\u6570\u4e3a $\\sum\\limits_{j\\neq i}$\uff0c\u5219\u6211\u4eec\u5de6\u53f3\u4fa7\u76f8\u4e58\u7684\u6b21\u6570\u5c31\u4e3a $\\sum d$ \u4e86\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe $F_i(x)=\\sum\\limits_{j=0}^{\\inf}\\dfrac{a_i^j}{j!}(j+1)^{2m}x^j$\uff0c$G_i(x)=\\sum\\limits_{j=0}^{\\inf}\\dfrac{a_i^j}{j!}(j+1)^{m}x^j$\n\n$$\\begin{aligned}\nans'&=[x^{n-2}]\\sum\\limits_{i=1}^nF_i(x)\\prod_{j\\neq i}G_j(x)\\\\\n\n&=[x^{n-2}]\\left(\\sum\\limits_{i=1}^n\\dfrac{F_i(x)}{G_i(x)}\\right)\\left(\\prod\\limits_{i=1}^nG_i(x)\\right)\n\\end{aligned}$$\n\n\u770b\u4e0a\u53bb\u8fd8\u662f\u4e0d\u592a\u884c\u7684\u6837\u5b50\uff0c\u6211\u4eec\u53d1\u73b0 $F_i(x)$ \u548c $G_i(x)$ \u4e2d\u4e0e $i$ \u76f8\u5173\u7684\u53ea\u6709 $a_i$\uff0c\u5c1d\u8bd5\u6d88\u9664 $a_i$ \u5728\u591a\u9879\u5f0f\u4e2d\u7684\u5f71\u54cd\uff0c\u4e3e\u51fd\u6570 $F(x)=\\sum\\limits_{i=1}^{\\inf}f(i)x^i$ \u4e3a\u4f8b\uff1a\n\n$$\\begin{aligned}\n\n&\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{\\inf}f(j)a_i^jx^j\\\\\n\n=&\\sum\\limits_{j=1}^{\\inf}f(j)\\left(\\sum\\limits_{i=1}^na_i^j\\right)x^j\n\n\\end{aligned}$$\n\n\u8bbe $S(k)=\\sum\\limits_{i=1}^na_i^k$\n\n\u5219 $\\sum\\limits_{i=1}^nF_i(x)=\\sum\\limits_{i=1}^{\\inf}f(j)S(j)x^j$\n\n\u5982\u679c\u6211\u4eec\u80fd\u5feb\u901f\u6c42\u51fa $S(k)(k\\in[0,n])$ \u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa $\\sum\\limits_{i=1}^nF_i(x)$\uff0c\u5373\u4e0d\u8003\u8651 $i$ \u7684\u5f71\u54cd\uff0c\u6700\u540e\u7b2c $i$ \u9879\u4e58 $S(i)$\n\n\u53f3\u4fa7\u7684 $\\prod$ \u4e5f\u6709\u5957\u8def\u7684\u65b9\u6cd5\u5316\u6210 $\\sum$\uff1a\n\n$$\\begin{aligned}\nans'=[x^{n-2}]\\left(\\sum\\limits_{i=1}^n\\dfrac{F_i(x)}{G_i(x)}\\right)\\exp\\left(\\sum\\limits_{i=1}^n\\ln\\left(G_i(x)\\right)\\right)\n\\end{aligned}$$\n\n---\n\n\u73b0\u5728\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6240\u6709\u7684 $k\\in[0,n]$ \u6c42\u51fa $\\sum\\limits_{i=1}^na_i^k$\n\n\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\n\n\n$$\\begin{aligned}\nF(x)&=\\sum\\limits_{j=0}^{\\inf} S(j+1) x^j\\\\\n\n&=\\sum\\limits_{i=1}^na_i\\sum\\limits_{j=0}^{\\inf}(a_ix)^j\\\\\n\n&=\\sum\\limits_{i=1}^n\\dfrac{a_i}{1-a_ix}\\\\\n\n&=-\\sum\\limits_{i=1}^n\\ln'(1-a_ix)\\\\\n\n&=-\\left(\\ln\\left(\\prod\\limits_{i=1}^n(1-a_ix)\\right)\\right)'\n\\end{aligned}$$\n\n\n\u7136\u540e\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u591a\u9879\u5f0f\u5206\u6cbb\u6c42\uff0c\u5c31\u6ca1\u4e86\n\n---\n\n\u4ee3\u7801\u633a\u77ed\u7684\n\n```cpp\nint qpow(int a,int b)\n{\n    int ans = 1;\n    for(;b;b >>= 1,a = (ll)a * a % mod) if(b & 1) ans = (ll)ans * a % mod;\n    return ans;\n}\nconst int N = 800010;\nvoid Mul(C int *a,C int *b,int *c,C int m1,C int m2);//\u591a\u9879\u5f0f\u4e58\u6cd5\nvoid Inv(C int *a,int *b,C int len);//\u591a\u9879\u5f0f\u6c42\u9006\nvoid Der(C int *a,int *b,C int len);//\u591a\u9879\u5f0f\u6c42\u5bfc\nvoid Ln(C int *a,int *b,C int len);//\u591a\u9879\u5f0f\u5bf9\u6570\nvoid Exp(C int *a,int *b,C int len);//\u591a\u9879\u5f0f\u6307\u6570\nint n,m,a[N];\nint L[N],R[N],M[N];\nvector<int> solve(int l,int r)\n{\n\tif(l == r) { return {1,mod - a[l]}; }\n\tint mid = l + r >> 1;vector<int> x = solve(l,mid),y = solve(mid + 1,r);\n\tfor(int i = 0;i < x.size();i++) L[i] = x[i];\n\tfor(int i = 0;i < y.size();i++) R[i] = y[i];\n\tMul(L,R,M,x.size(),y.size());\n\tvector<int> z;z.clear();for(int i = 0;i < x.size() + y.size() - 1;i++) z.push_back(M[i]);\n\treturn z;\n}\nint fac[N],ifac[N],sum[N],tmp[N];\nint A[N],B[N],f[N],g[N];\nint main()\n{\n\tn = read(),m = read();for(int i = 1;i <= n;i++) a[i] = read();\n\tfac[0] = 1;for(int i = 1;i <= n;i++) fac[i] = (ll)fac[i - 1] * i % mod;\n\tifac[n] = qpow(fac[n],mod - 2);for(int i = n;i;i--) ifac[i - 1] = (ll)ifac[i] * i % mod;\n\n\tvector<int> v = solve(1,n);for(int i = 0;i <= n;i++) tmp[i] = v[i];\n\tLn(tmp,sum,n + 1);Der(sum,sum,n + 1);memset(tmp,0,sizeof(tmp));\n\tfor(int i = n - 1;~i;i--) sum[i + 1] = mod - sum[i];sum[0] = n;\n\n\tfor(int i = 0;i < n;i++)\n\t{\n\t\tA[i] = (ll)qpow(i + 1,2 * m) * ifac[i] % mod;\n\t\tB[i] = (ll)qpow(i + 1,m) * ifac[i] % mod;\n\t}\n\tInv(B,tmp,n);Mul(A,tmp,f,n,n);Ln(B,g,n);memset(tmp,0,sizeof(tmp));\n\tfor(int i = 0;i < n;i++) f[i] = (ll)f[i] * sum[i] % mod,g[i] = (ll)g[i] * sum[i] % mod;\n\tExp(g,tmp,n);Mul(f,tmp,f,n,n);\n\tint ans = (ll)f[n - 2] * fac[n - 2] % mod;\n\tfor(int i = 1;i <= n;i++) ans = (ll)ans * a[i] % mod;\n\tfprint(ans);\n}\n```",
        "postTime": 1624117002,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4002 [\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570"
    },
    {
        "content": "[\u4f20\u9001\u95e8](http://uoj.ac/problem/335?locale=zh-cn)\n\n\u597d\u795e\u4ed9\u7684\u9898\u76ee\u2026\u2026\u53c8\u4e00\u6b21\u6709\u4e86\u505a\u4e00\u9898\u5b66\u4e00\u5806\u7684\u7f8e\u597d\u4f53\u9a8c\n\n\u636e\u8bf4\u672c\u9898\u6709\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570+\u5206\u6cbb$FFT$\u7684\u505a\u6cd5\uff0c\u7136\u800c\u54b1\u5b9e\u5728\u770b\u4e0d\u61c2\u5199\u7684\u662f\u5565\uff0c[\u9898\u89e3](https://blog.csdn.net/qq_39972971/article/details/80786441)\u8d34\u8fd9\u91cc\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb\u7785\u7785~~\uff0c\u770b\u61c2\u4e86\u8bb0\u5f97\u56de\u6765\u8ddf\u54b1\u8bb2\u8bb2~~\n\n# \u524d\u7f6e\u829d\u58eb\n\n## $prufer$\u5e8f\u5217\n\n$prufer$\u5e8f\u5217\u662f\u4e2a\u5565\uff1f\n\n\u5bf9\u4e8e\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u6211\u4eec\u627e\u5230\u5b83\u7684\u6807\u53f7\u6700\u5c0f\u7684\u53f6\u5b50\uff0c\u5220\u53bb\u5b83\uff0c\u5e76\u8bb0\u4e0b\u4e0e\u5b83\u76f8\u90bb\u7684\u8282\u70b9\u7684\u6807\u53f7\u3002\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u76f4\u5230\u6811\u4e0a\u7684\u8282\u70b9\u6570\u4e3a$2$\u4e3a\u6b62\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u957f\u5ea6\u4e3a$n-2$\u7684\u5e8f\u5217\u5c31\u662f\u8fd9\u68f5\u65e0\u6839\u6811\u7684$prufer$\u5e8f\u5217\n\n\u5f88\u660e\u663e\uff0c\u6bcf\u4e00\u68f5\u65e0\u6839\u6811\u552f\u4e00\u5bf9\u5e94\u4e00\u4e2a$prufer$\u5e8f\u5217\uff0c\u6211\u4eec\u53ea\u8981\u80fd\u8bc1\u660e\u6bcf\u4e00\u4e2a$prufer$\u5e8f\u5217\u90fd\u552f\u4e00\u5bf9\u5e94\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u8fd9\u4e24\u8005\u4e4b\u95f4\u5c31\u80fd\u6709\u4e00\u4e2a\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb\u4e86\n\n\u8003\u8651\u4e00\u4e2a$prufer$\u5e8f\u5217\uff0c\u5bf9\u4e8e\u56fe\u4e2d\u67d0\u4e2a\u8282\u70b9$u$\uff0c\u5982\u679c\u5b83\u5728\u539f\u56fe\u4e2d\u4e0d\u662f\u53f6\u5b50\uff0c\u90a3\u4e48\u4e0e\u5b83\u76f8\u90bb\u7684\u8fb9\u81f3\u5c11\u6709\u4e24\u6761\u3002\u53ef\u64cd\u4f5c\u5b8c\u4e4b\u540e\u6574\u4e2a\u56fe\u4e2d\u7684\u8fb9\u53ea\u5269\u4e0b\u4e86\u4e00\u6761\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a\u4e0d\u662f\u53f6\u5b50\u7684\u8282\u70b9\u90fd\u4f1a\u5728$prufer$\u5e8f\u5217\u4e2d\u51fa\u73b0\n\n\u6211\u4eec\u628a\u6ca1\u6709\u51fa\u73b0\u5728\u5e8f\u5217\u4e2d\u7684\u6570\u5b57\u6392\u5e8f\uff0c\u90a3\u4e48\u6700\u5c0f\u7684\u6570\u5b57\u80af\u5b9a\u662f\u548c\u5e8f\u5217\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6570\u5b57\u914d\u5bf9\uff0c\u90a3\u4e48\u539f\u56fe\u4e2d\u5b83\u4eec\u4e4b\u95f4\u80af\u5b9a\u8fde\u8fb9\n\n\u7136\u540e\u6211\u4eec\u9012\u5f52\u8003\u8651\u5e8f\u5217\u7684\u540e\u9762\u51e0\u4f4d\uff0c\u4e0d\u96be\u53d1\u73b0\u6bcf\u4e00\u6b21\u7684\u8fde\u8fb9\u60c5\u51b5\u90fd\u552f\u4e00\u3002\u4e8e\u662f\u6211\u4eec\u77e5\u9053\u6bcf\u4e00\u4e2a$prufer$\u5e8f\u5217\u552f\u4e00\u7684\u5bf9\u5e94\u4e00\u68f5\u65e0\u6839\u6811\n\n\u7efc\u4e0a\uff0c\u65e0\u6839\u6811\u548c$prufer$\u5e8f\u5217\u6709\u7740\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb\n\n\u4ece\u4e2d\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u65e0\u5411\u5b8c\u5168\u56fe\u7684\u751f\u6210\u6811\uff0c\u5b83\u7684$prufer$\u5e8f\u5217\u6709$n-2$\u4e2a\u503c\uff0c\u6bcf\u4e2a\u503c\u7684\u53d6\u503c\u8303\u56f4\u662f$[1,n]$\uff0c\u6240\u4ee5\u4e00\u4e2a\u65e0\u5411\u5b8c\u5168\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\u662f$n^{n-2}$\n\n## \u5feb\u901f\u6c42\u6570\u5217\u524d$k$\u6b21\u65b9\u548c\n\n~~\u54b1\u4f1a\u5dee\u503c~~\n\n~~\u54b1\u4f1a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570~~\n\n\u7136\u800c\u6211\u4eec\u73b0\u5728\u9700\u8981\u7684\u662f\u5bf9\u4e8e\u4efb\u610f$0\\leq j\\leq k$\uff0c\u6c42\u51fa$\\sum_{i=1}^n {a_i}^j$\n\n~~\u54b1\u521a\u521a\u5565\u90fd\u6ca1\u8bf4\u60a8\u7ee7\u7eed~~\n\n\u8003\u8651\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570$$F(x)=\\sum_{j=0}^k\\sum_{i=1}^n{a_i}^jx^j=\\sum_{i=1}^n\\sum_{j=0}^k(a_ix)^j=\\sum_{i=1}^n\\frac{1}{1-a_ix}$$\n\n\u56e0\u4e3a\u6709$$\\ln'(\\frac{1}{1-a_ix})=\\frac{-a_i}{1-a_ix}=\\sum_{j=0}^\\infty (a_ix)^j\\times (-a_i)$$\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u8ba1\u7b97\u51fa$G(x)=\\sum_{i=1}^n\\sum_{j=0}^k (a_ix)^j\\times (-a_i)$\uff0c\u5219$F(x)=-x\\times G(x)+n$\n\n\u800c$G(x)$\u5c31\u543c\u7b97\u5566\n\n$$G(x)=\\sum_{i=1}^n \\ln'(\\frac{1}{1-a_ix})=(\\sum_{i=1}^n \\ln\\frac{1}{1-a_ix})'=\\ln'(\\prod_{i=1}^n \\frac{1}{1-a_ix})$$\n\n\u62ec\u53f7\u91cc\u7684\u53ef\u4ee5\u7528\u5206\u6cbb$FFT$\u8ba1\u7b97\u4e86\n\n# \u672c\u9898\u9898\u89e3\n\n\u9996\u5148\u5bf9\u4e8e\u6bcf\u4e00\u68f5\u751f\u6210\u6811$T$\uff0c\u5b83\u7684\u8d21\u732e\u4e3a$\\prod_{i=1}^n{a_i}^{d_i}{d_i}^m\\sum_{i=1}^n{d_i}^m$\n\n\u90a3\u4e48\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u4e2a$prufer$\u5e8f\u5217\u6765\u7edf\u8ba1\u603b\u8d21\u732e\n\n$$Ans=(n-2)!\\sum_{\\sum d_i=n-2}\\prod_{i=1}^n \\frac{{a_i}^{d_i+1}}{d_i!}(d_i+1)^m\\sum_{i=1}^m(d_i+1)^m$$\n$$Ans=(n-2)!\\prod_{i=1}^na_i\\sum_{\\sum d_i=n-2}\\prod_{i=1}^n \\frac{{a_i}^{d_i}}{d_i!}(d_i+1)^m\\sum_{i=1}^m(d_i+1)^m$$\n\u524d\u9762\u7684$(n-2)!\\prod_{i=1}^na_i$\u662f\u5e38\u91cf\uff0c\u4e0d\u7528\u53bb\u7ba1\uff0c\u8003\u8651\u540e\u9762\u7684$\\prod_{i=1}^n \\frac{{a_i}^{d_i}}{d_i!}(d_i+1)^m\\sum_{i=1}^m(d_i+1)^m$\uff0c\u5b83\u7b49\u4ef7\u4e8e\n$$\\sum_{i=1}^n \\frac{{a_i}^{d_i}}{d_i!}(d_i+1)^{2m}\\prod_{j=1,j\\neq i}^m\\frac{{a_j}^{d_j}}{d_j!}(d_j+1)^{m}$$\n\n\u56e0\u4e3a\u9700\u8981$\\sum d_i=n-2$\uff0c\u6211\u4eec\u6784\u9020\u5173\u4e8e$d$\u7684\u751f\u6210\u51fd\u6570\n$$A(x)=\\sum_{i}\\frac{x^i(i+1)^{2m}}{i!}$$\n$$B(x)=\\sum_{i}\\frac{x^i(i+1)^{m}}{i!}$$\n\u90a3\u4e48\u539f\u5f0f\u5c31\u7b49\u4e8e$$F(x)=\\sum_{i=1}^n A(a_ix)\\prod_{j=1,j\\neq i}^nB(a_jx)$$\n$$F(x)=\\sum_{i=1}^n \\frac{A(a_ix)}{B(a_ix)}\\prod_{j=1}^nB(a_jx)$$\n$$F(x)=\\sum\\frac{A(a_ix)}{B(a_ix)}\\exp(\\sum\\ln B(a_jx))$$\n\u6211\u4eec\u6c42\u51fa$\\frac{A(x)}{B(x)}$\u548c$\\ln B(x)$\u4e4b\u540e\uff0c\u8981\u628a$a_ix$\u4ee3\u5165\u5e76\u6c42\u548c\uff0c\u90a3\u4e48\u7b2c$k$\u9879\u7684\u7cfb\u6570\u8981\u4e58\u4e0a$\\sum_{i=1}^n{a_i}^k$\uff0c\u8fd9\u4e2a\u5c31\u662f\u524d\u9762\u8bf4\u7684\u53ef\u4ee5\u5feb\u901f\u6c42\u7684\u4e1c\u897f\n\n\u4e8e\u662f\u590d\u6742\u5ea6\u5c31\u4e3a$O(n\\log^2 n)$\n```cpp\n//minamoto\n#include<bits/stdc++.h>\n#define R register\n#define fp(i,a,b) for(R int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(R int i=a,I=b-1;i>I;--i)\n#define go(u) for(int i=head[u],v=e[i].v;i;i=e[i].nx,v=e[i].v)\nusing namespace std;\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline char getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\nint read(){\n    R int res,f=1;R char ch;\n    while((ch=getc())>'9'||ch<'0')(ch=='-')&&(f=-1);\n    for(res=ch-'0';(ch=getc())>='0'&&ch<='9';res=res*10+ch-'0');\n    return res*f;\n}\nconst int N=1e5+5,P=998244353,Gi=332748118;\ninline int add(R int x,R int y){return x+y>=P?x+y-P:x+y;}\ninline int dec(R int x,R int y){return x-y<0?x-y+P:x-y;}\ninline int mul(R int x,R int y){return 1ll*x*y-1ll*x*y/P*P;}\nint ksm(R int x,R int y){\n\tR int res=1;\n\tfor(;y;y>>=1,x=mul(x,x))if(y&1)res=mul(res,x);\n\treturn res;\n}\nint E[N],B[N],F[N],C[N],D[N],O[N],r[N],G[N];\nvoid NTT(int *A,int ty,int len){\n\tint lim=1,l=0;while(lim<len)lim<<=1,++l;\n\tfp(i,0,lim-1)r[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n\tfp(i,0,lim-1)if(i<r[i])swap(A[i],A[r[i]]);\n\tfor(R int mid=1;mid<lim;mid<<=1){\n\t\tint I=(mid<<1),Wn=ksm(ty==1?3:Gi,(P-1)/I);O[0]=1;\n\t\tfp(i,1,mid-1)O[i]=mul(O[i-1],Wn);\n\t\tfor(R int j=0;j<lim;j+=I)fp(k,0,mid-1){\n\t\t\tint x=A[j+k],y=mul(O[k],A[j+k+mid]);\n\t\t\tA[j+k]=add(x,y),A[j+k+mid]=dec(x,y);\n\t\t}\n\t}\n\tif(ty==-1)for(R int i=0,inv=ksm(lim,P-2);i<lim;++i)A[i]=mul(A[i],inv);\n}\nvoid Inv(int *a,int *b,int len){\n\tif(len==1)return b[0]=ksm(a[0],P-2),void();\n\tInv(a,b,len>>1);fp(i,0,len-1)C[i]=a[i],D[i]=b[i];\n\tNTT(C,1,len<<1),NTT(D,1,len<<1);\n\tfp(i,0,(len<<1)-1)C[i]=mul(mul(C[i],D[i]),D[i]);\n\tNTT(C,-1,len<<1);\n\tfp(i,0,len-1)b[i]=dec(add(b[i],b[i]),C[i]);\n\tfp(i,0,(len<<1)-1)C[i]=D[i]=0;\n}\nvoid Direv(int *A,int *B,int len){\n\tfp(i,1,len-1)B[i-1]=mul(A[i],i);B[len-1]=0;\n}\nvoid Inter(int *A,int *B,int len){\n\tfp(i,1,len-1)B[i]=mul(A[i-1],ksm(i,P-2));B[0]=0;\n}\nvoid Ln(int *a,int *b,int len){\n\tInv(a,E,len),Direv(a,F,len);\n\tNTT(E,1,len<<1),NTT(F,1,len<<1);\n\tfp(i,0,(len<<1)-1)E[i]=mul(E[i],F[i]);\n\tNTT(E,-1,len<<1),Inter(E,b,len);\n\tfp(i,0,(len<<1)-1)E[i]=F[i]=0;\n}\nvoid Exp(int *a,int *b,int len){\n    if(len==1)return b[0]=1,void();\n    Exp(a,b,len>>1),Ln(b,B,len);\n    B[0]=dec(a[0]+1,B[0]);fp(i,1,len-1)B[i]=dec(a[i],B[i]);\n    NTT(B,1,len<<1),NTT(b,1,len<<1);\n    fp(i,0,(len<<1)-1)b[i]=mul(b[i],B[i]);\n    NTT(b,-1,len<<1);fp(i,len,(len<<1)-1)b[i]=B[i]=0;\n}\nint sz[N],A[19][N],TA[N],TB[N],TC[N],sum[N],ta[N],tb[N],tc[N];\nvoid solve(int ql,int qr,int d){\n\tif(ql==qr)return A[d][0]=1,A[d][1]=P-sz[ql],void();\n\tint mid=(ql+qr)>>1;\n\tsolve(ql,mid,d),solve(mid+1,qr,d+1);\n\tint lim=1;while(lim<=qr-ql+1)lim<<=1;\n\tfp(i,mid-ql+2,lim-1)A[d][i]=0;\n\tfp(i,qr-mid+1,lim-1)A[d+1][i]=0;\n\tNTT(A[d],1,lim),NTT(A[d+1],1,lim);\n\tfp(i,0,lim-1)A[d][i]=mul(A[d][i],A[d+1][i]);\n\tNTT(A[d],-1,lim);\n}\nint n,m,res,fac[N],inv[N];\nint main(){\n//\tfreopen(\"testdata.in\",\"r\",stdin);\n\tn=read(),m=read();if(n==1)return puts(\"1\"),0;\n\tfac[0]=inv[0]=1;fp(i,1,n)fac[i]=mul(fac[i-1],i);\n\tinv[n]=ksm(fac[n],P-2);fd(i,n-1,1)inv[i]=mul(inv[i+1],i+1);\n\tfp(i,1,n)sz[i]=read();\n\tsolve(1,n,0);\n\tfp(i,0,n)tc[i]=A[0][i];\n\tint len=1;while(len<=n)len<<=1;\n\tLn(tc,sum,len);\n\tfp(i,1,n)sum[i]=P-mul(sum[i],i);\n\tsum[0]=n;\n\tfp(i,0,n-1)TA[i]=mul(ksm(i+1,m),inv[i]),TB[i]=mul(ksm(i+1,m<<1),inv[i]);\n\tLn(TA,tc,len),Inv(TA,TC,len);\n\tNTT(TC,1,len<<1),NTT(TB,1,len<<1);\n\tfp(i,0,(len<<1)-1)TB[i]=mul(TB[i],TC[i]);\n\tNTT(TB,-1,len<<1);\n\tmemset(TA,0,sizeof(TA));\n\tmemset(TC,0,sizeof(TC));\n\tfp(i,0,n-1)TB[i]=mul(TB[i],sum[i]),TA[i]=mul(tc[i],sum[i]);\n\tExp(TA,TC,len);\n//\tfp(i,0,(len<<1)-1)printf(\"%d %d\\n\",i,TC[i]);\n\tfp(i,n,(len<<1)-1)TB[i]=0;\n\tNTT(TB,1,len<<1),NTT(TC,1,len<<1);\n\tfp(i,0,(len<<1)-1)TB[i]=mul(TB[i],TC[i]);\n\tNTT(TB,-1,len<<1);\n\tres=mul(TB[n-2],fac[n-2]);\n\tfp(i,1,n)res=mul(res,sz[i]);\n\tprintf(\"%d\\n\",res);\n\treturn 0;\n}\n```",
        "postTime": 1547612921,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4002 \u3010\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "#### \u524d\u7f6e\u77e5\u8bc6\uff1a\u6c42\u6570\u5217\u5e42\u548c\n\n\u7ed9\u5b9a\u6570\u5217 $\\{a_n\\}$\uff0c\u5bf9 $0\\leqslant t \\leqslant k$\uff0c\u6c42 $\\sum\\limits_{i=1}^na_i^t$\uff0c$n,t\\leqslant 10^5$\u3002\n\n\u6211\u4eec\u5199\u51fa\u5e42\u6b21\u548c\u5bf9\u5e94\u7684\u751f\u6210\u51fd\u6570 $F(x)$\n$$\n\\begin{aligned}\nF(x)=&\\sum\\limits_{t=0}\\left(\\sum\\limits_{i=1}^na_i^t\\right)x^t\\\\\n=&\\sum\\limits_{i=1}^n\\sum\\limits_{t=0}a_i^tx^t\\\\\n=&\\sum\\limits_{i=1}^n\\frac{1}{1-a_ix}\n\\end{aligned}\n$$\n\u7136\u540e\u6211\u4eec\u8003\u8651 $G(x)=\\sum\\limits_{i=1}^n\\left(\\ln(1-a_ix)\\right)'$\uff0c\u5316\u7b80\u5219\u6709\n$$\n\\begin{aligned}\nG(x)=&\\sum\\limits_{i=1}^n\\left(\\ln(1-a_ix)\\right)'\\\\\n=&-\\sum\\limits_{i=1}^n\\frac{a_i}{1-a_ix}\\\\\n=&-\\sum\\limits_{t=0}\\sum\\limits_{i=1}^na_i^{t+1}x^t\n\\end{aligned}\n$$\n\u5982\u679c\u6211\u4eec\u80fd\u6c42\u5f97 $G(x)$\uff0c\u5219\u5f88\u597d\u5c31\u80fd\u6c42\u51fa $F(x)$\u3002\u540c\u65f6\u53d1\u73b0\n$$\n\\begin{aligned}\nG(x)=&\\sum\\limits_{i=1}^n\\left(\\ln(1-a_ix)\\right)'\\\\\n=&\\left(\\sum\\limits_{i=1}^n\\ln(1-a_ix)\\right)'\\\\\n=&\\left(\\ln(\\prod\\limits_{i=1}^n(1-a_ix))\\right)'\n\\end{aligned}\n$$\n$\\prod\\limits_{i=1}^n(1-a_ix)$ \u53ef\u4ee5\u901a\u8fc7\u5206\u6cbb FFT \u8ba1\u7b97\uff0c\u7136\u540e\u6c42\u4e2a $\\ln$ \u518d\u6c42\u5bfc\u5c31\u597d\u4e86\u3002\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\n\n\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u8fd9\u9053\u9898\u3002\n\n\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u4e2a\u8fde\u901a\u5757\u770b\u6210\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u53ea\u9700\u8981\u8003\u8651\u8fde\u901a\u5757\u7684\u8fde\u63a5\u65b9\u5f0f\uff0c\u6bcf\u8fde\u63a5\u4e00\u6761\u8fb9\u989d\u5916\u4e58\u4e0a\u8fde\u901a\u5757\u5927\u5c0f\u5373\u53ef\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e prufer \u5e8f\u5217\uff0c\u5982\u679c\u4e00\u4e2a\u6570\u5728 prufer \u5e8f\u5217\u4e2d\u51fa\u73b0\u4e86 $d$ \u6b21\uff0c\u5219\u5176\u7684\u5ea6\u6570\u4e3a $d+1$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6bcf\u4e2a\u70b9\u5728 prufer \u5e8f\u5217\u4e2d\u51fa\u73b0\u7684\u6b21\u6570 $d_i$\uff0c\u5219\u6211\u4eec\u6709\n$$\n\\begin{aligned}\nans=&\\sum\\limits_{\\sum d=n-2}(n-2)!\\left(\\prod_{i=1}^n(d_i+1)^m\\right)\\left(\\sum_{i=1}^n(d_i+1)^m\\right)\\left(\\prod_{i=1}^n\\frac{a_i^{d_i+1}}{d_i!}\\right)\\\\\n=&(n-2)!\\prod_{i=1}^na_i\\sum\\limits_{\\sum d=n-2}\\left(\\prod_{i=1}^n\\frac{a_i^{d_i}}{d_i!}(d_i+1)^m\\right)\\left(\\sum_{i=1}^n(d_i+1)^m\\right)\n\\end{aligned}\n$$\n\u524d\u9762\u4e24\u9879\u662f\u5b9a\u503c\uff0c\u6211\u4eec\u5148\u4e0d\u7ba1\u3002\u6211\u4eec\u8003\u8651\u540e\u9762\u90a3\u4e2a\u4e1c\u897f\uff0c\u5b83\u7b49\u4ef7\u4e8e\n$$\n\\sum\\limits_{\\sum d=n-2}\\sum\\limits_{i=1}^n\\frac{a_i^{d_i}}{d_i!}(d_i+1)^{2m}\\prod\\limits_{j\\not=i}\\frac{a_j^{d_j}}{d_j!}(d_j+1)^m\n$$\n\u6211\u4eec\u8003\u8651\u6784\u9020\u4e24\u4e2a\u591a\u9879\u5f0f $A(x)=\\sum\\limits_{i}\\dfrac{(i+1)^{2m}x^i}{i!},B(x)=\\sum\\limits_{i}\\dfrac{(i+1)^mx^i}{i!}$\uff0c\u8bbe\u7b54\u6848\u5173\u4e8e $\\sum d$ \u7684\u751f\u6210\u51fd\u6570\u4e3a $F(x)$\uff0c\u5219\u6709\n$$\n\\begin{aligned}\nF(x)&=\\sum\\limits_{i=1}^nA(a_ix)\\prod\\limits_{j\\not=i}B(a_jx)\\\\\n&=\\sum\\limits_{i=1}^n\\frac{A(a_ix)}{B(a_ix)}\\prod_{j=1}^n\nB(a_jx)\\\\\n&=\\sum\\limits_{i=1}^n\\frac{A(a_ix)}{B(a_ix)}\\exp\\left(\\sum\\limits_{j=1}^n\\ln(B(a_jx))\\right)\n\\end{aligned}\n$$\n\u5982\u679c\u6211\u4eec\u6c42\u51fa\u4e86 $\\dfrac{A(x)}{B(x)}$ \u4e0e $\\ln(B(x))$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6bcf\u4e00\u9879\u7684\u7cfb\u6570\u4e58\u4e0a $\\sum\\limits_{i=1}^na_i^t$ \u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define pb push_back\nusing namespace std;\nnamespace polynomials\n{\n    int const p=998244353,g=3;\n    int const N=(1<<18)+1;\n    int w[N],iv[N],r[N],last;\n    typedef vector<int> vec;\n    int mod(int x){return x>=p?x-p:x;}\n    int pw(int x,int y)\n    {\n        int res=1;\n        while(y)\n        {\n            if(y&1)res=1ll*res*x%p;\n            x=1ll*x*x%p;\n            y>>=1;\n        }\n        return res;\n    }\n    void init(int n)\n    {\n        int lim=1;\n        while(lim<n)lim<<=1;\n        iv[1]=1;\n        for(int i=2;i<=lim;i++)iv[i]=mod(p-1ll*(p/i)*iv[p%i]%p);\n        for(int i=1;i<lim;i<<=1)\n        {\n            int wn=pw(g,(p-1)/(i<<1));\n            for(int j=0,ww=1;j<i;j++,ww=1ll*ww*wn%p)w[i+j]=ww;\n        }\n    }\n    void ntt(vec &f,int n,int op)\n    {\n        f.resize(n);\n        for(int i=1;i<n;i++)r[i]=(r[i>>1]>>1)|((i&1)?(n>>1):0);\n        for(int i=1;i<n;i++)if(i<r[i])swap(f[i],f[r[i]]);\n        for(int i=1;i<n;i<<=1)\n        for(int j=0;j<n;j+=i<<1)\n            for(int k=0;k<i;k++)\n            {\n                int x=f[j+k],y=1ll*f[i+j+k]*w[i+k]%p;\n                f[j+k]=mod(x+y);f[i+j+k]=mod(x-y+p);\n            }\n        if(op==-1)\n        {\n            reverse(&f[1],&f[n]);\n            for(int i=0;i<n;i++)f[i]=1ll*f[i]*iv[n]%p;\n        }\n    }\n    void getinv(vec f,vec &g,int n)\n    {\n        static vec x;\n        g.resize(n);\n        if(n==1){g[0]=pw(f[0],p-2);return;}\n        getinv(f,g,(n+1)>>1);\n        int lim=1;\n        while(lim<(n<<1))lim<<=1;\n        x.resize(lim);\n        for(int i=0;i<n;i++)x[i]=f[i];\n        for(int i=n;i<lim;i++)x[i]=0;\n        g.resize(lim);\n        ntt(x,lim,1),ntt(g,lim,1);\n        for(int i=0;i<lim;i++)g[i]=1ll*g[i]*(2-1ll*g[i]*x[i]%p+p)%p;\n        ntt(g,lim,-1);\n        g.resize(n);\n    }\n    void getln(vec f,vec &g,int n)\n    {\n        static vec x;\n        getinv(f,x,n);\n        for(int i=0;i<n-1;i++)f[i]=1ll*f[i+1]*(i+1)%p;\n        f[n-1]=0;\n        int lim=1;\n        while(lim<((n<<1)-1))lim<<=1;\n        ntt(f,lim,1),ntt(x,lim,1);\n        for(int i=0;i<lim;i++)x[i]=1ll*x[i]*f[i]%p;\n        ntt(x,lim,-1);\n        g.resize(n);\n        g[0]=0;\n        for(int i=1;i<n;i++)g[i]=1ll*x[i-1]*iv[i]%p;\n    }\n    void getln(vec f,vec &g,vec &h,int n)\n    {\n        static vec x;\n        getinv(f,x,n);h=x;\n        for(int i=0;i<n-1;i++)f[i]=1ll*f[i+1]*(i+1)%p;\n        f[n-1]=0;\n        int lim=1;\n        while(lim<((n<<1)-1))lim<<=1;\n        ntt(f,lim,1),ntt(x,lim,1);\n        for(int i=0;i<lim;i++)x[i]=1ll*x[i]*f[i]%p;\n        ntt(x,lim,-1);\n        g.resize(n);\n        g[0]=0;\n        for(int i=1;i<n;i++)g[i]=1ll*x[i-1]*iv[i]%p;\n    }\n    void getexp(vec f,vec &g,int n)\n    {\n        static vec x;\n        g.resize(n);\n        if(n==1){g[0]=1;return;}\n        int m,lim=1;\n        getexp(f,g,m=((n+1)>>1));\n        while(lim<(n<<1))lim<<=1;\n        g.resize(lim);\n        getln(g,x,n);\n        x.resize(lim);\n        for(int i=0;i<n;i++)x[i]=mod(f[i]-x[i]+p);\n        for(int i=n;i<lim;i++)x[i]=0;\n        x[0]=mod(x[0]+1);\n        ntt(g,lim,1),ntt(x,lim,1);\n        for(int i=0;i<lim;i++)g[i]=1ll*g[i]*x[i]%p;\n        ntt(g,lim,-1);\n        g.resize(n);\n    }\n}\nusing namespace polynomials;\nint n,m,a[30005];\nvec solve(int l,int r)\n{\n    if(l==r){vec res;res.pb(1);res.pb(p-a[l]);return res;}\n    int mid=(l+r)>>1,lim=1;\n    vec x=solve(l,mid),y=solve(mid+1,r);\n    while(lim<(r-l+2))lim<<=1;\n    ntt(x,lim,1),ntt(y,lim,1);\n    for(int i=0;i<lim;i++)x[i]=1ll*x[i]*y[i]%p;\n    ntt(x,lim,-1);x.resize(r-l+2);\n    return x;\n}\nint fac[30005],inv[30005];\nint main()\n{\n    int prod=1;\n    init(131071);\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),prod=1ll*prod*a[i]%p;\n    vec t=solve(1,n+1),res;\n    getln(t,res,n+1);\n    for(int i=0;i<n;i++)res[i]=1ll*res[i+1]*(i+1)%p;\n    for(int i=0;i<n;i++)\n        if(res[i])res[i]=p-res[i];\n    for(int i=n-1;i>=1;i--)res[i]=res[i-1];\n    res[0]=n;\n    vec a,b,c,d;\n    a.resize(n),b.resize(n);\n    fac[0]=inv[0]=1;\n    for(int i=1;i<n;i++)fac[i]=1ll*fac[i-1]*i%p;\n    inv[n-1]=pw(fac[n-1],p-2);\n    for(int i=n-2;i>=1;i--)inv[i]=1ll*inv[i+1]*(i+1)%p;\n    for(int i=0;i<n;i++)\n    {\n        int t=pw(i+1,m);\n        b[i]=1ll*t*inv[i]%p;\n        a[i]=1ll*b[i]*t%p;\n    }\n    getln(b,d,c,n);\n    int lim=1;\n    while(lim<(n<<1))lim<<=1;\n    ntt(a,lim,1),ntt(c,lim,1);\n    for(int i=0;i<lim;i++)a[i]=1ll*a[i]*c[i]%p;\n    ntt(a,lim,-1),a.resize(n);\n    for(int i=0;i<n;i++)a[i]=1ll*a[i]*res[i]%p,d[i]=1ll*d[i]*res[i]%p;\n    c.clear();\n    getexp(d,c,n);\n    ntt(a,lim,1),ntt(c,lim,1);\n    for(int i=0;i<lim;i++)a[i]=1ll*a[i]*c[i]%p;\n    ntt(a,lim,-1);\n    printf(\"%lld\",1ll*a[n-2]*fac[n-2]%p*prod%p);\n    return 0;\n}\n```",
        "postTime": 1601209328,
        "uid": 96912,
        "name": "AzusaCat",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4002 \u3010[\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "\u8003\u8651\u5c06\u4e00\u5f00\u59cb\u5c31\u8fde\u901a\u7684\u70b9\u7f29\u8d77\u6765\uff0c\u7136\u540e\u679a\u4e3e\u7f29\u70b9\u540e\u7684\u751f\u6210\u6811 $T$\u3002\n\n\u90a3\u4e48\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n$\\sum_{T}\\sum_{i=1}^n d_i^m \\prod_{j=1}^n d_j^m a_j^{d_j}$\n\n\u4e4b\u6240\u4ee5\u8981\u4e58\u4e0a $\\prod_{j=1}^n a_j^{d_j}$\uff0c\u662f\u56e0\u4e3a\u6bcf\u4e2a\u8fde\u901a\u5757\u8fde\u51fa\u7684\u6bcf\u4e00\u6761\u8fb9\u90fd\u53ef\u4ee5\u9009\u62e9\u8be5\u8fde\u901a\u5757\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u70b9\u8fde\u51fa\u53bb\uff0c\u56e0\u6b64\u65b9\u6848\u6570\u4e3a $a_j^{d_j}$\u3002\n\n\u5c06 $\\prod$ \u4e2d $i=j$ \u7684\u9879\u63d0\u524d\uff0c\u6211\u4eec\u6709\n\n$\\sum_T\\sum_{i=1}^{n} d_i^{2m} a_i^{d_i} \\prod_{j\\neq i} d_j^ma_j^{d_j}$\n\n\u8003\u8651\u7528\u4e00\u79cd\u56fa\u5b9a\u7684\u65b9\u6cd5\u679a\u4e3e\u6811\u3002\n\n\u4e0d\u59a8\u679a\u4e3e\u751f\u6210\u6811\u7684 Prufer \u5e8f\uff0c\u8003\u8651\u679a\u4e3e\u6bcf\u4e2a\u70b9\u5728 Prufer \u5e8f\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u4e3a $c_i$\uff0c\u90a3\u4e48\u6709 $d_i=c_i+1$\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u957f\u5ea6\u4e3a $n-2$ \u7684 Prufer \u5e8f\uff0c\u6211\u4eec\u5df2\u7ecf\u679a\u4e3e\u4e86\u6bcf\u4e2a\u70b9\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684 Prufer \u5e8f\u5217\u603b\u5171\u6709 $\\frac{(n-2)!}{\\prod c_i!}$ \u79cd\u3002\n\n\u73b0\u5728\u5f0f\u5b50\u53d8\u6210\u4e86\uff1a\n\n$\\sum_{\\sum c_i=n-2}\\frac{(n-2)!}{\\prod c_i!}\\sum_{i=1}^n (c_i+1)^{2m}a_i^{c_i+1}\\prod_{j \\neq i} (c_j+1)^m a_j^{c_j+1}$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u770b\u8d77\u6765\u5f88\u68d8\u624b\u3002\n\n\u8003\u8651\u7531\u4e8e\u6211\u4eec\u8981\u6c42 $\\sum c_i = n-2$\uff0c\u4e0d\u59a8\u7528 $c_i$ \u4f5c\u4e3a\u6307\u6570\u3002\n\n\u7531\u4e8e\u4f60\u9700\u8981\u8ba1\u7b97\u53ef\u91cd\u6392\u5217\uff0c\u9700\u8981\u9664\u4ee5 $\\prod c_i!$\uff0c\u8003\u8651\u6784\u9020 EGF\u3002\n\n\u4ee4 $\\hat A_i(x)=\\sum_k (k+1)^{2m}a_i^{k+1}\\frac{x^k}{k!}$\n\n$\\hat B_i(x)=\\sum_k (k+1)^m a_i^{k+1} \\frac{x^k}{k!}$\n\n\u73b0\u5728\u7684\u7b54\u6848\u5f0f\u5b50\u4e3a\n\n$(n-2)![x^{n-2}]\\sum_{i=1}^n \\hat A_i(x)\\prod_{j\\neq i}\\hat B_j(x)$\n\n\u89c2\u5bdf\u5230 $a_i$ \u7684\u6b21\u6570\u662f $k+1$\uff0c$x$ \u7684\u6b21\u6570\u662f $k$\uff0c\u8fd9\u975e\u5e38\u4ee4\u4eba\u8ba8\u538c\u3002\n\n\u8003\u8651\u7ed9 $A$ \u548c $B$ \u540c\u65f6\u63d0\u51fa\u4e00\u4e2a $a_i$ \u51fa\u53bb\u3002\n\n\u6211\u4eec\u6709 $\\hat A_i'(x)=\\sum_k (k+1)^{2m}a_i^k\\frac{x^k}{k!}$\uff0c$\\hat B_i'(x)=\\sum_k(k+1)^ma_i^k\\frac{x^k}{k!}$\n\n\n\u5e26\u56de\u7b54\u6848\u5f0f\u5b50\u91cc\u53ef\u4ee5\u5f97\u5230\n\n$(n-2)![x^{n-2}]\\sum_{i=1}^n a_i\\hat A_i'(x)\\prod_{j\\neq i} a_j\\hat B_j'(x)$\n\n$(n-2)![x^{n-2}]\\sum_{i=1}^n (\\prod_{k=1}^n a_k)\\hat A_i'(x)\\prod_{j\\neq i}\\hat B_j'(x)$\n\n$(n-2)!(\\prod_{i=1}^n a_i)[x^{n-2}]\\sum_{i=1}^n a_i\\hat A_i'(x)\\prod_{j\\neq i} a_j\\hat B_j'(x)$\n\n\u89c2\u5bdf\u5230\u6b64\u65f6 $\\hat A_i'(x)$ \u4e0e $\\hat B_i'(x)$ \u5185 $x$ \u548c $a_i$ \u7684\u6b21\u5e42\u90fd\u662f $k$\uff0c\u4e0d\u59a8\u5c06\u5b83\u4eec\u5408\u5e76\uff0c\u8bbe\uff1a\n\n$\\hat A(x)=\\frac{x^k(k+1)^{2m}}{k!}$\n\n$\\hat B(x)=\\frac{x^k(k+1)^m}{k!}$\n\n\u90a3\u4e48\u539f\u5f0f\u53d8\u6210\u4e86\n\n$(n-2)!(\\prod_{i=1}^n a_i) [x^{n-2}] \\sum_{i=1}^n \\hat A(a_ix) \\prod_{j \\neq i} \\hat B(a_jx)$\n\n\u524d\u9762\u90a3\u4e00\u5768\u4e1c\u897f\u53cd\u6b63\u662f\u4e2a\u5b9a\u503c\uff0c\u6211\u4eec\u76ef\u7740\u540e\u9762\u90a3\u4e00\u534a\u770b\u3002\n\n\u540e\u9762\u90a3\u4e00\u534a\u53ef\u4ee5\u5316\u4e3a\n\n$\\prod_{j=1}^n \\hat B(a_jx) \\sum_{i=1}^n \\frac{\\hat A(a_ix)}{\\hat B(a_ix)}$\n\n\u524d\u9762\u7684 $\\prod$ \u5f88\u6076\u5fc3\uff0c\u4f46\u662f\u89c2\u5bdf\u5230\u5982\u679c\u6211\u4eec\u7b97\u51fa\u4e86 $\\hat B(x)$\uff0c\u6211\u4eec\u80fd\u8f83\u4e3a\u65b9\u4fbf\u5730\u6c42\u51fa\u6bcf\u4e2a $\\hat B(a_ix)$\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u5316 $\\prod$ \u4e3a $\\sum$\uff0c\u5148 ln \u518d exp \u6709\uff1a\n\n$exp(\\sum_{j=1}^n ln (\\hat B(a_jx))) \\sum_{i=1}^{n} \\frac{\\hat A(a_ix)}{\\hat B(a_ix)}$\n\n\u5f53\u6c42\u51fa\u4e86 $ln \\hat B(x)$ \u4ee5\u53ca $\\frac{\\hat A(x)}{\\hat B(x)}$ \u4ee5\u540e\uff0c\u6211\u4eec\u53ea\u8981\u4e3a\u7b2c $k$ \u9879\u4e58\u4e0a $\\sum a_i^k$ \u5c31\u80fd\u5f97\u51fa $\\sum ln \\hat B(a_jx)$ \u548c $\\sum\\frac{\\hat A(a_ix)}{\\hat B(a_ix)}$\u3002\n\n\u6700\u540e\u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u4efb\u610f\u7684 $k$\uff0c\u6c42 $\\sum a_i^k$\u3002\n\n\u8bb0\u8fd9\u4e2a\u4e1c\u897f\u7684 OGF \u4e3a $G(x)$\u3002\n\n\u6211\u4eec\u6709 $G(x)=\\sum_{k\\geq 0}\\sum_{i=1}^n a_i^kx^k$\n\n\u4ea4\u6362\u524d\u540e\u4e24\u4e2a $\\sum$\uff0c\u4e0d\u96be\u53d1\u73b0\u540e\u9762\u90a3\u4e00\u5768\u4e0d\u4f1a\u53d8\u5316\uff0c\u56e0\u6b64\u6211\u4eec\u6709\n\n$G(x)=\\sum_{i=1}^n\\sum_{k\\geq 0}(a_ix)^k$\u3002\n\n\u540e\u9762\u90a3\u4e2a\u4e1c\u897f\u5c31\u662f $\\frac{1}{1-a_ix}$\u3002\n\n\u4e8e\u662f $G(x)=\\sum_{i=1}^n \\frac{1}{1-a_ix}$\u3002\n\n\u4f46\u662f\u73b0\u5728\u8fd9\u4e2a $G(x)$ \u5f88\u4e0d\u65b9\u4fbf\u7b97\u3002\n\n\u5982\u679c\u6211\u4eec\u80fd\u901a\u8fc7\u67d0\u79cd\u7279\u522b\u7684\u65b9\u5f0f\u5c06\u76f8\u52a0\u53d8\u4e3a\u76f8\u4e58\uff0c\u90a3\u770b\u8d77\u6765\u5c31\u5f88\u6f02\u4eae\uff0c\u56e0\u4e3a\u4e0b\u9762\u7684\u6bcf\u4e2a\u591a\u9879\u5f0f\u6b21\u6570\u90fd\u662f $1$\uff0c\u8fd9\u662f\u4e00\u4e2a\u7279\u522b\u7b80\u5355\u7684\u5206\u6cbb $NTT$\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u60f3\u8d77\u4e86\u5bf9\u6570\u51fd\u6570\uff0c\u5bf9\u6570\u51fd\u6570\u6709\u4e00\u70b9\u5c31\u662f $lnA + lnB = ln AB$\u3002\n\n\u53ef\u60dc\u5982\u679c\u76f4\u63a5\u6362\u6210 $ln$\uff0c\u5916\u5c42\u4f1a\u5957\u4e0a\u4e00\u4e2a $exp$\uff0c\u800c $\\sum exp(ln(x))$ \u662f\u6ca1\u6709\u4ec0\u4e48\u597d\u65b9\u6cd5\u5feb\u901f\u8ba1\u7b97\u7684\u3002\n\n\u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u4ec0\u4e48\u65b9\u6cd5\uff0c\u80fd\u591f\u8df3\u8fc7\u8fd9\u4e2a $exp$\uff0c\u76f4\u63a5\u6362\u6210 $ln$ \u5462\uff1f\n\n\u8fd9\u4ee4\u6211\u4eec\u60f3\u5230\u4e86\u6c42\u5bfc\uff0c\u56e0\u4e3a\u6c42\u5bfc\u6ee1\u8db3\u6211\u4eec\u60f3\u8981\u7684\u91cd\u8981\u7684\u4e24\u4e2a\u6761\u4ef6\uff1a\n\n\u7b2c\u4e00\u662f $f'(x)+g'(x)=(f(x)+g(x))'$\uff0c\u4e5f\u5c31\u662f\u6c42\u5bfc\u7b26\u53f7\u53ef\u4ee5\u4efb\u610f\u6362\u5230\u91cc\u5916\uff0c\u8fd9\u8ba9\u6211\u4eec\u53ef\u4ee5\u4f7f\u5f97\u82e5\u5e72\u4e2a $ln$ \u7684\u5bfc\u6570\u76f8\u52a0\u53d8\u4e3a\u82e5\u5e72\u4e2a $ln$ \u76f8\u52a0\u518d\u6c42\u5bfc\u3002\n\n\u7b2c\u4e8c\u662f\u5bf9 $ln F$ \u6c42\u5bfc\u7ed3\u679c\u662f $\\frac{F'}{F}$\uff0c\u8fd9\u4e2a\u5206\u6570\u5f62\u5f0f\u770b\u8d77\u6765\u5df2\u7ecf\u5f88\u63a5\u8fd1\u6211\u4eec\u9700\u8981\u7684\u4e86\u3002\n\n\u5bf9 $ln(1-a_ix)$ \u6c42\u5bfc\uff0c\u7ed3\u679c\u662f $-\\frac{a_i}{1-a_ix}$\u3002\n\n\u6211\u4eec\u539f\u6765\u7684\u5f0f\u5b50\u4e0a\u9762\u662f\u6ca1\u6709\u90a3\u4e2a $a_i$ \u7684\uff0c\u6211\u4eec\u5f97\u60f3\u4e2a\u529e\u6cd5\u51d1\u51fa\u4e00\u4e2a $\\frac{a_i}{1-a_ix}$ \u51fa\u6765\u3002\n\n\u89c2\u5bdf\u5230 $\\frac{1}{1-a_ix}=1+\\frac{a_ix}{1-a_ix}$\uff0c\u539f\u5f0f\u5b50\u5c31\u80fd\u53d8\u6210\uff1a\n\n$\\sum_{i=1}^n(1+\\frac{a_ix}{1-a_ix})$\u3002\n\n\u63d0\u51fa $n$ \u4e2a $1$ \u4ee5\u540e\uff0c\u6211\u4eec\u60ca\u559c\u5730\u53d1\u73b0\u539f\u5f0f\u53ef\u4ee5\u5316\u4e3a $n-x\\sum_{i=1}^{n}(-\\frac{a_i}{1-a_ix})$\uff0c\u8fd9\u548c\u5bf9 $ln$ \u6c42\u5bfc\u51fa\u6765\u7684\u5f62\u5f0f\u76f8\u540c\u3002\n\n\u4e8e\u662f\u539f\u5f0f\u5b50\u53d8\u6210\u4e86\n\n$n-x\\sum_{i=1}^n(ln(1-a_ix))'$\n\n\u7531\u6c42\u5bfc\u6cd5\u5219\uff0c$f'(x)+g'(x)=(f(x)+g(x))'$\uff0c\u4e8e\u662f\u540e\u534a\u6bb5\u53ef\u4ee5\u53d8\u6210 $n-x(ln(\\prod_{i=1}^n(1-a_ix)))'$\u3002\n\n\u8fd9\u663e\u7136\u53ef\u4ee5\u4f7f\u7528\u5206\u6cbb NTT \u89e3\u51b3\u3002\u4e8e\u662f\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log^2 n)$\n\n\u5b9e\u9645\u4e0a\uff0c\u672c\u9898\u8fd8\u5b58\u5728\u4e00\u79cd $O(nm\\log n)$ \u7684\u65af\u7279\u6797\u6570\u505a\u6cd5\uff0c\u4f46\u662f\u7b14\u8005\u4e0d\u592a\u4f1a\u3002",
        "postTime": 1587088165,
        "uid": 25308,
        "name": "Wen_kr",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4002 \u3010[\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "\u4e3a\u4e86\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff0c\u540c\u65f6\u7531\u4e8e\u4e0d\u77e5\u9053\u516c\u5f0f\u4f1a\u4e0d\u4f1a\u6302\uff0c\u5efa\u8bae\u5230 luogu \u535a\u5ba2\u6216\u8005 [\u8fd9\u91cc](https://www.yijan.co/qing-hua-ji-xun-2017-sheng-cheng-shu-ji-shu/) \u9605\u8bfb\u3002\n\n\u7ed9\u5b9a\u4e00\u5f20 $s$ \u4e2a\u70b9\u7684\u56fe\uff0c\u5b58\u5728 $s-n$ \u4e2a\u8fb9\uff0c\u4f7f\u5f97\u56fe\u4e2d\u5f62\u6210\u4e86 $n$ \u4e2a\u8054\u901a\u5757\uff0c\u7b2c $i$ \u4e2a\u8054\u901a\u5757\u5185\u90e8\u6709 $a_i$ \u4e2a\u70b9\u3002\n\n\u6211\u4eec\u73b0\u5728\u8981\u518d\u8fde $n-1$ \u4e2a\u8fb9\uff0c\u4f7f\u5f97\u8be5\u56fe\u6210\u4e3a\u4e00\u4e2a\u6811\u3002\u5bf9\u4e8e\u67d0\u4e00\u79cd\u8fde\u8fb9\u65b9\u5f0f\uff0c\u6211\u4eec\u8bbe\u539f\u9898\u7b2c $i$ \u4e2a\u8054\u901a\u5757\u8fde\u51fa\u4e86 $d_i$ \u6761\u8fb9\uff0c\u90a3\u4e48\u5f53\u524d\u6811\u7684\u6743\u503c\u4e3a\n$$\nval(T) = \\left(\\prod_{i=1}^n d_i^m\\right) \\left(\\sum_{i=1}^n d_i^m\\right)\n$$\n\u6c42\u6240\u6709\u751f\u6210\u6811\u7684\u6743\u503c\u548c\u3002\n$$\nn \\le 3\\times 10^4 , m\\le 30\n$$\n\n---\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u5f00\u59cb\u5c31\u8fde\u901a\u7684\u70b9\u7f29\u8d77\u6765\uff0c\u679a\u4e3e\u4e00\u4e2a\u8054\u901a\u5757\u7684\u751f\u6210\u6811 $T$ \uff0c\u90a3\u4e48\n$$\nans = \\sum_{T} \\sum_{i=1}^n d_i^m \\prod_{j=1}^n d_j^m a_j^{d_j}\n$$\n\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u8054\u901a\u5757\u5411\u5916\u8fde\uff0c\u53ef\u80fd\u662f\u8fd9\u4e2a\u8054\u901a\u5757\u7684\u4efb\u4f55\u4e00\u4e2a\u70b9\u5f80\u5916\u8fde\uff0c\u5e76\u4e14\u4e00\u4e2a\u70b9\u53ef\u4ee5\u8fde\u591a\u4e2a\u8fb9\u51fa\u53bb\u3002\n\n\u6211\u4eec\u628a $d_i^ma_i^{d_i}$ \u63d0\u51fa\u5230\u524d\u9762\u53bb\uff0c\u90a3\u4e48\n$$\nans = \\sum_{T} \\sum_{i=1}^n d_i^{2m}a_i^{d_i} \\prod_{j\\neq i} d_j^m a_j^{d_j}\n$$\n\u4f46\u662f\u751f\u6210\u6811 $T$ \u65e0\u7591\u662f\u4e0d\u5bb9\u6613\u679a\u4e3e\u7684\uff0c\u53ef\u4ee5\u8f6c\u800c\u679a\u4e3e prufer \u5e8f\u3002\u590d\u4e60\u4e00\u4e0b\n\n> prufer \u5e8f\u5217\u7684\u6784\u9020\u662f\uff0c\u6bcf\u6b21\u5220\u9664\u6700\u5c0f\u7684\u53f6\u5b50\uff0c\u628a\u5b83\u7684\u7236\u4eb2\u52a0\u5165\u5e8f\u5217\u3002\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u76f4\u5230\u53ea\u5269\u4e0b\u4e24\u4e2a\u70b9\uff0c\u5219\u6784\u9020\u51fa\u4e86\u4e00\u4e2a\u957f\u5ea6\u4e3a $n-2$ \u7684\u5e8f\u5217\u3002\u4e00\u4e2a prufer \u5e8f\u5bf9\u5e94\u552f\u4e00\u4e00\u4e2a\u65e0\u6839\u6811\u3002\n\nprufer \u5e8f\u6709\u4e2a\u5f88\u597d\u7684\u6027\u8d28\uff0c\u4e00\u4e2a\u6570\u5728 prufer \u5e8f\u5217\u7684\u51fa\u73b0\u6b21\u6570\u5c31\u662f\u5b83\u7684\u5ea6\u6570\u51cf\u4e00\u3002\n\n\u5982\u679c\u6211\u4eec\u94a6\u5b9a\u4e86\u6bcf\u4e2a\u70b9\u7684\u51fa\u73b0\u6b21\u6570 $c_i$ \uff0c\u90a3\u4e48\u8fd9\u6837\u7684 prufer \u5e8f\u5217\u6709\u6b63\u597d $\\frac{(n-2)!}{\\prod c_i!}$ \u79cd\u3002\n\n\u6211\u4eec\u8003\u8651\u7528\u679a\u4e3e\u8fd9\u6837\u7684\u51fa\u73b0\u6b21\u6570 $c_i$ \u5e8f\u5217\u66ff\u4ee3\u679a\u4e3e $T$ \uff0c\u90a3\u4e48\n$$\nans = \\sum_{\\sum c_i = n-2} \\frac{(n-2)!}{\\prod c_i!} \\sum_{i=1}^n(c_i+1)^{2m}a_i^{c_i+1} \\prod_{j\\neq i} (c_j+1)^m a_j^{c_j+1}\n$$\n\u8003\u8651\u8fd9\u4e2a $\\sum c_i = n - 2$ \u7684\u9650\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 $c_i$ \u4f5c\u4e3a\u6307\u6570\u6765\u6784\u9020 EGF\u3002\u5199\u51fa\u6765\u5c31\u662f\n$$\n\\hat A_i(x) = \\sum_{k} (k+1)^{2m} a_i^{k+1} \\frac {x^k}{k!}\n$$\n$$\n\\hat B_i(x) = \\sum_{k} (k+1)^{m} a_i^{k+1} \\frac{x^k}{k!}\n$$\n\n$$\nans = (n-2)![x^{n-2}]\\sum_{i=1}^n A_i(x)\\prod_{j\\neq i} B_j(x)\n$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u770b\u8d77\u6765\u5b8c\u5168\u4e0d\u53ef\u4f18\u5316\uff1f\n\n\u6211\u4eec\u7684\u76ee\u6807\u662f\uff0c\u8ba9 $A,B$ \u80fd\u5426\u4ece $n$ \u9879\u5316\u7b80\u5230\u53ea\u9700\u8981 $m$ \u9879\uff0c\u4e58\u4e0a\u4e00\u4e2a\u53ef\u4ee5\u63d0\u51fa\u53bb\u7684\u7cfb\u6570\u3002\n\n\u53d1\u73b0\u5bf9\u4e8e $A,B$\uff0c $x$ \u7684\u6307\u6570\u90fd\u662f $k$ \uff0c\u800c\u524d\u9762\u7adf\u7136\u662f $k+1$ \uff0c\u6240\u4ee5\u8003\u8651\u5148\u79ef\u5206\u4e00\u4e0b\uff0c\u63d0\u5347 $x$ \u7684\u6307\u6570\uff0c\u5316\u7b80\u540e\u518d\u6c42\u5bfc\n$$\n\\begin{aligned}\\int A(x) &= \\sum_{k} (k+1)^{2m} a_i^{k+1} \\frac{x^{k+1}}{(k+1)!}\\\\&= \\sum_k k^{2m} a_i^k \\frac{x^k}{k!}\\end{aligned}\n$$\n\u8fd9\u4e2a\u5f0f\u5b50\u770b\u8d77\u6765\u53c8\u5316\u7b80\u4e0d\u52a8\u4e86\uff0c\u8003\u8651\u540e\u9762\u90a3\u5757 $a_i^k \\frac{x^k}{k!}$ \u770b\u8d77\u6765\u5c31\u975e\u5e38 $\\exp$ \u3002\u4f46\u662f\u5982\u679c\u76f4\u63a5\u628a $\\exp$ \u63d0\u51fa\u53bb\u4f1a\u53d1\u73b0\u53c8\u4e00\u6b21\u5316\u4e0d\u52a8\u4e86\uff0c\u6240\u4ee5\u8003\u8651\u5148\u628a $k^{2m}$ \u7528\u65af\u7279\u6797\u6570\u5c55\u5f00\uff0c\u4ea4\u6362\u5faa\u73af\u6b21\u5e8f\u540e\u770b\u770b\u80fd\u5426\u5316\u7b80\u53bb\u6389\u540e\u9762\u7684 $\\sum$\n$$\n\\begin{aligned}\\int A(x) &= \\sum_k a_i^k\\frac{1}{k!} \\sum_{j=0}^{2m} \\begin{Bmatrix}2m \\\\ j\\end{Bmatrix} \\frac{k!}{(k-j)!} x^k\\\\&=\\sum_{j=0}^{2m} \\begin{Bmatrix}2m \\\\ j\\end{Bmatrix}  \\sum_{k} \\frac{a_i^kx^k}{(k-j)!}\\end{aligned}\n$$\n\u6211\u4eec\u8003\u8651\u63d0\u51fa\u4e00\u4e2a $a_i^jx^j$  \u5c31\u53ef\u4ee5\u628a\u540e\u9762\u8f6c\u5316\u6210 $\\exp$ \u4e86\uff01\n$$\n\\begin{aligned}\\int A(x) &= \\sum_{j=0}^{2m} \\begin{Bmatrix}2m \\\\ j\\end{Bmatrix} a_i^jx^j \\sum_{k} \\frac{a_i^{k-j}x^{k-j}}{(k-j)!}\\\\&= \\sum_{j=0}^{2m} \\begin{Bmatrix}2m \\\\ j\\end{Bmatrix} a_i^jx^j \\exp(a_ix)\\\\\\end{aligned}\n$$\n\u522b\u5fd8\u4e86\uff0c\u6211\u4eec\u8fd8\u5f97\u7ed9\u5b83\u6c42\u5bfc\u56de\u53bb\u3002\u63d0\u51fa $\\exp(a_ix)$ \u540e\u5229\u7528 $(uv)' = u'v + uv'$\uff0c\u6709\n$$\nA(x) = a_ie^{a_ix}\\sum_{j=0}^{2m} \\begin{Bmatrix}2m \\\\ j\\end{Bmatrix} a_i^jx^j + \\sum_{j=0}^{2m} \\begin{Bmatrix}2m \\\\ j+1\\end{Bmatrix} a_i^{j+1} (j+1) x^{j} e^{a_ix}\n$$\n\u63d0\u51fa $e^{a_ix}$ \u5408\u5e76\u4e00\u4e0b\u6c42\u548c\uff0c\u90a3\u4e48\u6709\n$$\nA(x) = e^{a_ix}\\left(\\sum_{j=0}^{2m}a_i^{j+1} x^j \\left(\\begin{Bmatrix}2m \\\\ j\\end{Bmatrix} + (j+1)\\begin{Bmatrix}2m \\\\ j+1\\end{Bmatrix}\\right)\\right)\n$$\n\u540e\u9762\u7adf\u7136\u6b63\u597d\u662f\u65af\u7279\u6797\u6570\u7684\u9012\u63a8\u516c\u5f0f\u3002\u3002\u3002\n$$\nA(x) = e^{a_ix}\\left(\\sum_{j=0}^{2m}a_i^{j+1} x^j \\begin{Bmatrix}2m+1 \\\\ j+1\\end{Bmatrix} \\right)\n$$\n\u5bf9\u4e8e $B$ \uff0c\u4e0d\u96be\u53d1\u73b0\u5b83\u548c $A$ \u5f62\u5f0f\u51e0\u4e4e\u662f\u4e00\u6478\u4e00\u6837\uff0c\u53ea\u662f\u628a $2m$ \u53d8\u6210\u4e86 $m$ \uff0c\u6240\u4ee5\n$$\nB(x) = e^{a_ix}\\left(\\sum_{j=0}^{m}a_i^{j+1} x^j \\begin{Bmatrix}m+1 \\\\ j+1\\end{Bmatrix} \\right)\n$$\n\u7136\u540e\u8bb0 $A_i(x) = e^{a_ix} A_i^1 (x) , B_i(x) = e^{a_ix}B_i^1(x)$\n$$\n\\begin{aligned}ans &= (n-2)![x^{n-2}]\\sum_{i=1}^n A_i(x)\\prod_{j\\neq i} B_j(x)\\\\&= (n-2)![x^{n-2}]e^{\\sum a_ix}\\sum_{i=1}^nA_i^1(x) \\prod_{j\\neq i} B_j^1(x) \\end{aligned}\n$$\n\u6211\u4eec\u8ba9\u540e\u9762\u7684\u4e24\u4e2a\u5f0f\u5b50\u90fd\u53d8\u6210\u4e86 $O(m)$ \u9879\u4e86\uff01\n\n\u4e8e\u662f\u540e\u9762\u4e58\u79ef\u90e8\u5206\u53ef\u4ee5\u5206\u6cbb NTT \u4e58\u51fa\u6765\u9664\u5f00\u67d0\u4e00\u9879\u7684 $B$ \u7684\u79ef\u518d\u4e58\u4e0a $A$ \u52a0\u8fdb\u53bb\uff0c\u603b\u5171\u4e5f\u624d $O(nm)$ \u9879\uff0c\u4e8e\u662f\u590d\u6742\u5ea6\u662f $O(nm\\log^2 (nm))$\u3002\u524d\u9762\u7684 $\\exp$ \u76f4\u63a5\u7b97\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u7ed3 \u675f \u4e86 \u5417 \uff1f\n\n\u5982\u679c\u76f4\u63a5\u4ea4\u4e0a\u53bb\uff0c\u6216\u8bb8\u5728 LOJ 5s \u53ef\u4ee5\u8dd1\u8fc7\u53bb\uff0c\u4f46\u662f\u5728 luogu \u4f1a\u5f97\u5230\u4e00\u4e2a TLE\u3002\n\n---\n\n\u6709\u6ca1\u6709\u66f4\u52a0\u4f18\u79c0\u7684\u4f18\u5316\u5462\uff1f\n\n\u56de\u5230\u6700\u521d\u7684\u5f0f\u5b50\uff0c\u4ee4\n$$\n\\hat A'_i(x) = \\sum_{k} (k+1)^{2m} \\frac {x^k}{k!}\n$$\n$$\n\\hat B'_i(x) = \\sum_{k} (k+1)^{m} \\frac{x^k}{k!}\n$$\n\u6ce8\u610f\u6b64\u5904\u975e\u6c42\u5bfc\u3002\n\n\u5bf9\u6bd4\u4e4b\u524d\u7684\u5f0f\u5b50\uff0c\n$$\nans = (n-2)![x^{n-2}]\\sum_{i=1}^n A_i(x)\\prod_{j\\neq i} B_j(x)\n$$\n\u6211\u4eec\u53ea\u8981\u63d0\u51fa\u53bb\u4e00\u4e2a $\\prod a_i$ \u5c31\u53ef\u4ee5\u628a $A_i,B_j$ \u6362\u6210 $A',B'$ \uff0c\u4e5f\u5c31\u662f\n$$\nans = (n-2)![x^{n-2}]\\left(\\prod a_i\\right)\\sum_{i=1}^n A'(a_ix)\\prod_{j\\neq i} B'(a_jx)\n$$\n\u6211\u4eec\u8003\u8651\u4ea4\u6362 $\\prod$ \u548c $\\sum$ \u7684\u987a\u5e8f\uff0c\n$$\nans = (n-2)![x^{n-2}]\\left(\\prod a_i\\right)\\prod_{j=1}^n B'(a_jx)\\sum_{i=1}^n \\frac{A'(a_ix)}{B'(a_ix)}\n$$\n\u7136\u540e\u628a\u4e58\u79ef\u901a\u8fc7 $\\ln,\\exp$ \u62c6\u6210\u6c42\u548c\u7684\u5f62\u5f0f\n$$\nans = (n-2)![x^{n-2}]\\left(\\prod a_i\\right)\\exp\\left(\\sum_{j=1}^n \\ln(B'(a_jx))\\right)\\sum_{i=1}^n \\frac{A'(a_ix)}{B'(a_ix)}\n$$\n\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u9884\u5904\u7406\u51fa \n$$\nF(x) = \\frac{A'(x)}{B'(x)}\n$$\n$$\nG(x) = \\ln(B'(x))\n$$\n\u8003\u8651 $[x^t]f(a_ix) = a_i^t[x^t]f(x)$ \uff0c\u6240\u4ee5\n$$\n[x^t]\\sum_{i=1}^n F(a_ix)\n$$\n$$\n= \\sum_{i=1}^n a_i^t[x^t]F(x)\n$$\n$$\n=[x^t]F(x) \\sum_{i=1}^n a_i^t\n$$\n\u6240\u4ee5\u73b0\u5728\u6211\u4eec\u9700\u8981\u5bf9\u4e8e $k\\in [1,n]$ \u5feb\u901f\u6c42\u51fa $\\sum a_i^k$\u3002\n\n\u6211\u4eec\u6784\u9020\u5b83\u7684 OGF \n$$\n\\begin{aligned}T(x) &= \\sum_{k\\ge 0} \\sum_{i=1}^n a_i^kx^k\\\\&= \\sum_{i=1}^n \\sum_{k\\ge 0} (a_ix)^k \\\\&= \\sum_{i=1}^n \\frac 1 {1-a_ix}\\\\&= \\sum_{i=1}^n 1+\\frac {a_i x} {1-a_ix}\\\\&= n + x\\sum_{i=1}^n \\frac {a_i} {1-a_ix}\\\\&= n - x\\sum_{i=1}^n \\left(\\ln(1-a_ix)\\right)'\\\\&= n - x\\left(\\ln\\prod_{i=1}^n (1-a_ix)\\right)'\\\\\\end{aligned}\n$$\n\u6240\u4ee5\u505a\u4e00\u6b21 \u5206\u6cbb FFT \u5c31\u6c42\u51fa\u4e86 $T$ \uff0c\u4ece\u800c\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848\u4e86\u3002\n\n\u603b\u590d\u6742\u5ea6\u662f\u5206\u6cbb FFT \u7684 $O(n\\log^2 n)$ \u3002\n\n\u5199\u8fd9\u9898\u987a\u4fbf\u53ef\u4ee5\u987a\u4fbf\u590d\u4e60 $\\ln,\\exp$ \u6c42\u9006\u4ee5\u53ca\u5206\u6cbb2333\n\n\u65e0\u5361\u5e38\u60c5\u51b5\u4e0b LOJ Rank 7\u3002\u3002\u590d\u6742\u5ea6\u5f88\u4f18\u79c0\n\n```cpp\n#include \"iostream\"\n#include \"algorithm\"\n#include \"cstring\"\n#include \"cstdio\"\n#include \"cmath\"\n#include \"vector\"\n#include \"map\"\n#include \"set\"\n#include \"queue\"\nusing namespace std;\n#define MAXN 100006\n//#define int long long\n#define rep(i, a, b) for (int i = (a), i##end = (b); i <= i##end; ++i)\n#define per(i, a, b) for (int i = (a), i##end = (b); i >= i##end; --i)\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define eb emplace_back\n#define vi vector<int>\n#define all(x) (x).begin() , (x).end()\n#define mem( a ) memset( a , 0 , sizeof a )\ntypedef long long ll;\nint n , m;\nint A[MAXN];\n#define P 998244353\nint Pow( int x , int a ) {\n    int ret = 1;\n    while( a ) {\n        if( a & 1 ) ret = 1ll * ret * x % P;\n        x = 1ll * x * x % P , a >>= 1;\n    }\n    return ret;\n}\nint wn[2][MAXN];\nvoid getwn( int len ) {\n    int w0 , w1;\n    for( int mid = 1 ; mid < len ; mid <<= 1 ) {\n        w0 = Pow( 3 , ( P - 1 ) / ( mid << 1 ) ) , w1 = Pow( 3 , P - 1 - ( P - 1 ) / ( mid << 1 ) );\n        wn[0][mid] = wn[1][mid] = 1;\n        for( int i = 1 ; i < mid ; ++ i )\n            wn[0][mid + i] = wn[0][mid + i - 1] * 1ll * w0 % P,\n            wn[1][mid + i] = wn[1][mid + i - 1] * 1ll * w1 % P;\n    }\n}\nint rev[MAXN];\nvoid getr( int len ) {\n    int t = __builtin_ctz( len ) - 1;\n    for( int i = 1 ; i < len ; ++ i ) rev[i] = ( rev[i >> 1] >> 1 ) | ( ( i & 1 ) << t );\n}\nvoid NTT( int A[] , int len , int f ) {\n    for( int i = 0 ; i < len ; ++ i ) if( i < rev[i] ) A[i] ^= A[rev[i]] , A[rev[i]] ^= A[i] , A[i] ^= A[rev[i]];\n    int t0 , t1;\n    for( int mid = 1 ; mid < len ; mid <<= 1 )\n        for( int i = 0 ; i < len ; i += ( mid << 1 ) )\n            for( int j = 0 ; j < mid ; ++ j ) {\n                t0 = A[i + j] , t1 = A[i + mid + j] * 1ll * wn[f][mid + j] % P;\n                A[i + j] = ( t0 + t1 ) % P , A[i + mid + j] = ( t0 + P - t1 ) % P;\n            }\n    if( f ) for( int inv = Pow( len , P - 2 ) , i = 0 ; i < len ; ++ i ) A[i] = 1ll * A[i] * inv % P;\n}\nvoid NTT( vi& A , int len , int f ) {\n    for( int i = 0 ; i < len ; ++ i ) if( i < rev[i] ) A[i] ^= A[rev[i]] , A[rev[i]] ^= A[i] , A[i] ^= A[rev[i]];\n    int t0 , t1;\n    for( int mid = 1 ; mid < len ; mid <<= 1 )\n        for( int i = 0 ; i < len ; i += ( mid << 1 ) )\n            for( int j = 0 ; j < mid ; ++ j ) {\n                t0 = A[i + j] , t1 = A[i + mid + j] * 1ll * wn[f][mid + j] % P;\n                A[i + j] = ( t0 + t1 ) % P , A[i + mid + j] = ( t0 + P - t1 ) % P;\n            }\n    if( f ) for( int inv = Pow( len , P - 2 ) , i = 0 ; i < len ; ++ i ) A[i] = 1ll * A[i] * inv % P;\n}\nint tmpa[MAXN];\nvoid Inv( const int A[] , int B[] , int n ) { // B = Inv A (mod x^n)\n    if( n == 1 ) { B[0] = Pow( A[0] , P - 2 ); return; }\n    Inv( A , B , ( n + 1 ) >> 1 );\n    rep( i , 0 , n - 1 ) tmpa[i] = A[i];\n    int len = 1;\n    while( len <= n + n ) len <<= 1;\n    rep( i , n , len - 1 ) tmpa[i] = 0;\n    getwn( len ) , getr( len );\n    NTT( B , len , 0 ) , NTT( tmpa , len , 0 );\n    rep( i , 0 , len - 1 ) B[i] = 1ll * B[i] * ( 2 - 1ll * tmpa[i] * B[i] % P + P ) % P;\n    NTT( B , len , 1 );\n    rep( i , n , len - 1 ) B[i] = 0;\n}\nint ta[MAXN];\nvoid Ln( const int A[] , int B[] , int n ) { // B = Ln A (mod x^n)\n    rep( i , 0 , n - 1 ) ta[i] = 1ll * ( i + 1 ) * A[i + 1] % P;\n    int len = 1;\n    Inv( A , B , n );\n    while( len <= n + n ) len <<= 1;\n    rep( i , n , len - 1 ) ta[i] = 0;\n    getr( len ) , getwn( len );\n    NTT( ta , len , 0 ) , NTT( B , len , 0 );\n    rep( i , 0 , len - 1 ) B[i] = 1ll * B[i] * ta[i] % P;\n    NTT( B , len , 1 );\n    per( i , n - 1 , 1 ) B[i] = 1ll * B[i - 1] * Pow( i , P - 2 ) % P;\n    rep( i , n , len ) B[i] = 0;\n    B[0] = 0;\n}\nint tln[MAXN];\nvoid Exp( const int A[] , int B[] , int n ) { // B = Exp A (mod x^n)\n    if( n == 1 ) { B[0] = 1; return; }\n    Exp( A , B , ( n + 1 ) >> 1 );\n    int len = 1;\n    while( len <= n + n ) len <<= 1;\n    rep( i , 0 , len - 1 ) tln[i] = 0;\n    Ln( B , tln , n );\n    rep( i , 0 , n - 1 ) tln[i] = ( A[i] + P - tln[i] ) % P;\n    ++ tln[0];\n    getwn( len ) , getr( len );\n    NTT( B , len , 0 ) , NTT( tln , len , 0 );\n    rep( i , 0 , len - 1 ) B[i] = 1ll * B[i] * tln[i] % P;\n    NTT( B , len , 1 );\n    rep( i , n , len - 1 ) B[i] = 0;\n}\n\nvi& mul( vi& a , vi& b , int f ) { // a = a * b\n    int sa = a.size() , sb = b.size() , len = 1;\n    while( len <= sa + sb - 2 ) len <<= 1;\n    a.resize( len ) , b.resize( len );\n    getwn( len ) , getr( len );\n    NTT( a , len , 0 ) , NTT( b , len , 0 );\n    for( int i = 0 ; i < len ; ++ i ) a[i] = 1ll * a[i] * b[i] % P;\n    NTT( a , len , 1 );\n    if( f ) NTT( b , len , 1 );\n    return a;\n}\nvi S[MAXN];\nvi& solve( int l , int r ) {\n    if( l == r ) return S[l];\n    int m = l + r >> 1;\n    return mul( solve( l , m ) , solve( m + 1 , r ) , 0 );\n}\nint R[MAXN] , T[MAXN];\n\nint J[MAXN] , iJ[MAXN];\nint A1[MAXN] , B1[MAXN] , a[MAXN] , b[MAXN] , rb[MAXN];\nvoid solve() {\n    cin >> n >> m;\n    J[0] = iJ[0] = 1;\n    for( int i = 1 ; i <= n ; ++ i ) J[i] = 1ll * J[i - 1] * i % P , iJ[i] = Pow( J[i] , P - 2 );\n    int pro = 1;\n    rep( i , 0 , n - 1 ) {\n        scanf(\"%d\",A + i) , pro = 1ll * pro * A[i] % P;\n        S[i].pb( 1 ) , S[i].pb( P - A[i] );\n    }\n    vi& re = solve( 0 , n - 1 );\n    rep( i , 0 , re.size() - 1 ) R[i] = re[i];\n    Ln( R , T , n + 1 );\n    for( int i = 0 ; i <= n ; ++ i ) T[i] = 1ll * i * T[i] % P;\n    T[0] = P - n;\n    for( int i = 0 ; i <= n ; ++ i )\n        A1[i] = 1ll * Pow( i + 1 , 2 * m ) * iJ[i] % P , B1[i] = 1ll * Pow( i + 1 , m ) * iJ[i] % P , T[i] = P - T[i];\n    Ln( B1 , b , n + 1 );\n    Inv( B1 , a , n + 1 );\n    int len = 1;\n    while( len <= n + n ) len <<= 1;\n    getwn( len ) , getr( len );\n    NTT( a , len , 0 ) , NTT( A1 , len , 0 );\n    rep( i , 0 , len - 1 ) a[i] = 1ll * a[i] * A1[i] % P;\n    NTT( a , len , 1 );\n    for( int i = 0 ; i <= n ; ++ i ) a[i] = 1ll * a[i] * T[i] % P , b[i] = 1ll * b[i] * T[i] % P;\n    for( int i = n + 1 ; i < len ; ++ i ) a[i] = 0;\n//    printf(\"Before Exp : \"); for( int i = 0 ; i <= n ; ++ i ) printf(\"%d \",b[i]); puts(\"\");\n    Exp( b , rb , n + 1 );\n//    printf(\"After Exp : \"); for( int i = 0 ; i <= n ; ++ i ) printf(\"%d \",rb[i]); puts(\"\");\n    while( len <= n + n ) len <<= 1;\n    getwn( len ) , getr( len );\n    NTT( rb , len , 0 ) , NTT( a , len , 0 );\n    for( int i = 0 ; i < len ; ++ i ) rb[i] = 1ll * rb[i] * a[i] % P;\n    NTT( rb , len , 1 );\n    cout << J[n - 2] * 1ll * pro % P * rb[n - 2] % P << endl;\n}\n\nsigned main() {\n//    freopen(\"6.in\",\"r\",stdin);\n//    freopen(\"fuckout\",\"w\",stdout);\n//    int T;cin >> T;while( T-- ) solve();\n    solve();\n}\n\n```\n\n",
        "postTime": 1586849159,
        "uid": 63398,
        "name": "yijan",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4002 \u3010[\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "\u4e3a\u4ec0\u4e48\u8fd9\u4e9b\u5927\u4f6c\u8bb2\u7528 prufer \u7b97\u8d21\u732e\u7684\u65f6\u5019\u90fd\u4e0d\u5e26\u89e3\u91ca\u7684\u8bf4...\u662f\u592a\u663e\u7136\u4e86\u4e48\uff1f\n\n\u7ed3\u679c\u5c0f\u849f\u84bb\u6211\u4e24\u7bc7\u9898\u89e3\u4e0a\u7ffb\u4e0b\u7ffb\u76ef\u4e86\u4e00\u4e2a\u4e2d\u5348\u624d\u770b\u51fa\u6765\u662f\u4e2a\u4ec0\u4e48\u9b3c...\u6211\u592a\u83dc\u4e86emmm\n\n\u603b\u800c\u8a00\u4e4b\u5c31\u662f\u5217\u51fa\u7b54\u6848\u7684\u5f0f\u5b50\u7136\u540e\u5404\u79cd\u63a8\uff08\u591a\u9879\u5f0f\u9898\u7684\u5957\u8def\uff1f\uff09\n\n### \u4f46\u5728\u6b64\u4e4b\u524d\u5f97\u5148\u4f1a Prufer \u5e8f\u5217\u4e2b\uff01\n\n# Prufer \u5e8f\u5217\n\n\u957f\u8bdd\u77ed\u8bf4\u3001\u7b80\u800c\u8a00\u4e4b\u3001\u8bf4\u5230\u5e95\u5c31\u662f\uff1a\n\n\u4e00\u68f5\u65e0\u6839\u6811\u7684 Prufer \u5e8f\u5217\u6784\u6210\u65b9\u6cd5\u5c31\u662f\u6bcf\u6b21\u53d6\u51fa**\u7f16\u53f7\u6700\u5c0f**\u7684**\u53f6\u5b50**\uff0c\u7136\u540e\u628a\u4e0e\u5176\u76f8\u90bb\u7684\u552f\u4e00\u90a3\u4e2a\u70b9\u7684\u7f16\u53f7\u8bb0\u5f55\u8fdb**\u5e8f\u5217\u5c3e\u90e8**\uff0c\u76f4\u5230\u53ea\u5269\u4e24\u4e2a\u8282\u70b9\uff0c\u8fd9\u6837\u751f\u6210\u7684\u5e8f\u5217\u957f\u5ea6\u4e3a n-2 \n\n\u5bf9\u4e8e\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u5b83\u552f\u4e00\u5bf9\u5e94\u4e86\u4e00\u4e2a Prufer \u5e8f\u5217\uff0c\u4e00\u4e2a Prufer \u5e8f\u5217\u4e5f\u552f\u4e00\u5bf9\u5e94\u4e86\u4e00\u68f5\u6811\uff0c\u4e5f\u5c31\u662f\u8bf4\u6811\u4e0e Prufer \u5e8f\u5217\u4e4b\u95f4\u5448\u53cc\u5c04\uff08\u5c31\u662f\u4e00\u4e00\u5bf9\u5e94\uff09\u7684\u5173\u7cfb\n\n\u6211\u4eec\u53ef\u4ee5\u7528 Prufer \u8bc1\u51fa\u4e00\u4e2a\u5b8c\u5168\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\u4e3a $n^{n-2}$ \n\n\u56e0\u4e3a\u6211\u4eec\u8003\u8651\u6bcf\u4e2a\u751f\u6210\u6811\u90fd\u654c\u8425\u4e00\u4e2a Prufer \u5e8f\u5217\uff0c\u800c n-2 \u957f\u5ea6\u7684 Prufer \u5e8f\u5217\u6bcf\u4e2a\u4f4d\u7f6e\u90fd\u53ef\u4ee5\u653e\u7f6e 1~n \u7684\u6570\uff0c\u4e8e\u662f Prufer \u5e8f\u5217\u7684\u4e2a\u6570\u4e3a $n^{n-2}$ \uff0c\u4e8e\u662f\u5bf9\u5e94\u7684\u751f\u6210\u6811\u4e2a\u6570\u5c31\u662f $n^{n-2} $ \u4e86\n\n\uff08\u4e3a\u4ec0\u4e48\u6211\u7a81\u7136\u60f3\u5230\u4e86\u4e00\u4e2a $n^n$ \u7684\u7b97\u6cd5 \u3010\u6ed1\u7a3d\uff09\n\n![](https://www.cnblogs.com/images/cnblogs_com/Judge/1264714/o_03C080BF92B6752210DE61CE9B0A22AA.png)\n\n\n\n\n------------------\n\n# \u63a8\u5bfc\u8fc7\u7a0b\n\n\n\u6709\u4e86\u524d\u7f6e\u829d\u58eb\u8fd9\u9053\u9898\u5c31\u597d\u505a\u4e00\u70b9\u4e86...\u5427\uff1f\n\n\u6211\u4eec\u8003\u8651\u8ba1\u7b97\u6bcf\u68f5\u6811\u5bf9\u5e94\u7684 Prufer \u5e8f\u5217\u7684\u8d21\u732e...\u6211\u4eec\u4ee4 $d_i$ \u8868\u793a\u5f53\u524d\u8fd9\u68f5\u6811\u7684 Prufer \u5e8f\u5217\u4e2d\u7f16\u53f7 i \u51fa\u73b0\u7684\u6b21\u6570\uff0c\u90a3\u4e48\u6bcf\u4e2a\u8282\u70b9\u7684\u5ea6\u6570\u5c31\u662f $d_i+1$ \uff08\u88ab\u67d0\u72b6\u6001\u4e0b\u7684\u53f6\u5b50\u7ed3\u70b9\u8fde\u63a5\u5230\u7684\u6b21\u6570\u548c\u81ea\u5df1\u8fde\u51fa\u53bb\u7684\u4e00\u6b21\uff09\n\n$$ANS=\\sum_{\\sum d_i=n-2}{(n-2)!\\over \\prod d_i!} \\prod_{i=1}^n {a_i}^{d_i+1}(d_i+1)^m \\sum_{j=1}^n (d_j+1)^m$$\n\n\n\u8fd9\u4e2a\u5f0f\u5b50\u524d\u9762\u7684\u4e00\u5768\u9636\u4e58\u5c31\u662f\u8bf4\uff1a\u5bf9\u4e8e\u4e00\u4e2a Prufer \u5e8f\u5217\uff1a d \uff0c\u6211\u4eec\u8003\u8651 $(n-2)!$ \u6392\u5217\uff0c\u7136\u540e\u4e00\u4e2a\u7f16\u53f7 $i$ \u51fa\u73b0\u4e86 $d_i$ \u6b21\uff0c\u4ed6\u4eec\u7684\u76f8\u5bf9\u987a\u5e8f\u5bf9 Prufer \u5e8f\u5217\u662f\u6ca1\u5f71\u54cd\u7684\uff0c\u8981\u9664\u53bb\u8d21\u732e\n\n\u7136\u540e\u5bf9\u4e8e\u540e\u9762 $d_i+1$  \u5176\u5b9e\u5df2\u7ecf\u89e3\u91ca\u8fc7\u4e86\uff0c\u5c31\u662f\u8003\u8651\u4e00\u4e2a\u70b9\u7684\u5ea6\u6570\u4e3a\u5176\u5728 Prufer \u5e8f\u5217\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u52a0\u4e0a 1 \n\n\u7136\u540e\u6211\u4eec\u5c31\u597d\u5f00\u59cb\u63a8\u5bfc\u4e86\uff1a\n\n\n$$\\begin{aligned}ANS=&\\sum_{\\sum d_i=n-2}{(n-2)!\\over \\prod d_i!} \\prod_{i=1}^n {a_i}^{d_i+1}(d_i+1)^m \\sum_{j=1}^n (d_j+1)^m \\\\ =& (n-2)! \\prod_{i=1}^n a_i \\sum_{\\sum d_i=n-2}  \\prod_{i=1}^{n} {a_i^{d_i}\\over d_i! } (d_i+1)^m \\sum_{j=1}^n (d_j+1)^m\\\\ =& (n-2)! \\prod_{i=1}^n a_i \\sum_{\\sum d_i=n-2}  (d_i+1)^m \\sum_{i=1}^n {a_i^{d_i} \\over d_i!}(d_i+1)^{2m}  \\prod_{j=1,j \\not= i}^{n} {a_j^{d_j}\\over d_j! }(d_i+1)^m                                                                       \\end{aligned}$$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u524d\u9762\u7684\u4e24\u4e2a\u8868\u8fbe\u5f0f\u53ef\u4ee5 $O(n)$ \u6c42\uff0c\u6240\u4ee5\u4e3b\u8981\u4efb\u52a1\u5c31\u662f\u6c42\u51fa\u540e\u9762\u8fd9\u4e2a\u4e1c\u897f\uff1a\n\n$$\\sum_{\\sum d_i=n-2}  (d_i+1)^m \\sum_{i=1}^n {a_i^{d_i} \\over d_i!}(d_i+1)^{2m}  \\prod_{j=1,j \\not= i}^{n} {a_j^{d_j}\\over d_j! }(d_i+1)^m $$\n\n\n\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u80af\u5b9a\u6ca1\u529e\u6cd5\u518d\u76f4\u63a5\u63a8\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u5f15\u5165\u91cd\u5934\u620f\uff1a\u751f\u6210\u51fd\u6570\n\n\u6211\u4eec\u9996\u5148\u6784\u9020\u4e24\u4e2a\u751f\u6210\u51fd\u6570\uff1a\n\n$$\\begin{aligned} A(x)&=\\sum_{i=0}^\\infty{x^i (i+1)^{m}\\over i!}  \t\t                 \\\\B(x)&=\\sum_{i=1}^\\infty{x^i(i+1)^{2m}\\over i!}\\end{aligned}$$\n\n\u7136\u540e\u6211\u4eec\u4ee4\uff1a\n\n$$F(x)=\\sum_{i=1}^nA(a_ix) \\prod_{j=1,j\\not=i}^n B(a_jx)$$\n\n\u90a3\u4e48\u8fd9\u4e2a\u751f\u6210\u51fd\u6570\u7684\u7b2c n-2 \u9879\u5c31\u662f\u6211\u4eec\u8981\u6c42\u7684\u5f0f\u5b50\u7684\u7b54\u6848\u8fa3\uff01\n\n$$\\begin{aligned}F(x)=&\\sum_{i=1}^nB(a_ix) \\prod_{j=1,j\\not=i}^n A(a_jx)  \\\\=& \\sum_{i=1}^n{B(a_ix)\\over A(a_ix)} \\prod_{j=1}^n A(a_jx) \\\\=&\\sum_{i=1}^n {B(a_ix)\\over A(a_ix)} Exp(\\sum_{j=1}^n Ln( A(a_jx)) )                                                     \\end{aligned}$$\n\n\u4e0a\u9762\u8fd9\u4e2a $\\prod$ \u53d6 Ln \u8f6c $\\sum$ \u518d Exp \u56de\u6765\u7b80\u76f4\u662f\u5957\u8def\uff1f\n\n\u90a3\u4e48\u65b0\u7684\u95ee\u9898\u6765\u4e86\uff0c\u6211\u4eec\u6c42\u51fa $Ln~ A$ \u548c ${B\\over A}$ \u7684\u7cfb\u6570\u540e\uff0c\u8fd8\u8981\u5c06\u7b2c k \uff08k=1~n\uff09\u9879\u4e58\u4e0a $\\sum_{i=1}^{n} a_i^k$ \n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5982\u4f55\u5feb\u901f\u6c42\u51fa\u8fd9\u4e2a\u4e1c\u897f...\n\n-----\n\n# \u6570\u5217\u7684\u5e42\u548c\u51fd\u6570\n\n\u8bb2\u9053\u7406\uff0c\u5982\u679c\u8bf4\u53ea\u662f\u5e42\u548c\u51fd\u6570\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u82b1\u6837\u6c42\uff1a\n\n\n>\u62c9\u683c\u6717\u65e5\u63d2\u503c\n\n>\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\n\n>\u4f2f\u52aa\u5229\u6570\n\n\u4f46\u662f\u8fd9\u91cc\u6709\u4e2a\u6570\u5217...\n\n\u5176\u5b9e\u6570\u5217\u7684\u8bdd\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7167\u6837\u53ef\u4ee5\u7528\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u590d\u6742\u5ea6\u561b... \n\n$$k^2,k=n$$\n\n\uff01\uff01\uff01\u73a9\u4e2a\u9e21\u513f...\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u80fd\u8003\u8651\u5947\u6280\u6deb\u5de7\u4e860.0 \uff08\u548c[\u8fd9\u9053\u9898](https://www.luogu.org/blog/yestoday/solution-p4705)\u505a\u6cd5\u86ee\u50cf\u7684\uff09\n\n\u9996\u5148\u6211\u4eec\u6784\u9020\u4e00\u4e0b\u751f\u6210\u51fd\u6570\uff1a\n\n$$f_j(x)= \\sum_{i=1}^k a_j^ix^i $$\n\n\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u6570\u5217\u5e42\u548c\u51fd\u6570\u5c31\u662f\uff1a\n\n$$G(x)=\\sum_{j=1}^{n} f_j(x)$$\n\n\u5176\u4e2d $G(x)$ \u7684\u7b2c k \u9879\u7cfb\u6570\u5c31\u5bf9\u5e94\u4e86 $\\sum_{i=1}^n a_i^k$ \n\n\u90a3\u4e48\u6211\u4eec\u628a $f_j(x)$ \u7684\u4e0a\u754c k \u53d8\u4e3a $\\infty$ \uff0c\u90a3\u4e48\u539f\u6765\u7684\u4e1c\u897f\u53ef\u4ee5\u53d8\u6210\uff1a\n\n\n$$f_j(x)={1\\over 1-a_ix}$$\n\n$$G(x)=\\sum_{i=1}^n{1\\over 1-a_ix}$$\n\n\u7136\u540e\u6211\u4eec\u8003\u8651 $ln(x)'={x'\\over x}$ \uff0c\u90a3\u4e48\u6211\u4eec\u4ee4\uff1a\n\n$$g_i(x)=ln(1-a_ix)'={-a_i\\over 1-a_ix}$$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53d1\u73b0 \uff1a\n\n$$g_i(x)=-\\sum_{i=1}^k a_j^{i+1}x^i=-a_if_i(x)$$\n\n\u4e8e\u662f\uff1a\n\n$$G(x)=\\sum_{i=1}^ng_i(x)x+n$$\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\uff1a\n\n\n$$\\begin{aligned}\\sum_{i=1}^{n}G_i(x)=&\\sum_{i=1}^nln(1-a_ix)' \\\\ =&  ln(\\prod_{i=1}^n1-a_ix)'                             \\end{aligned}$$\n\n\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u7684\u4efb\u52a1\u5c31\u8f7b\u677e\u5f88\u591a\u4e86\uff0c\u53ea\u9700\u8981\u5bf9\u4e8e\u540e\u9762\u7684\u591a\u9879\u5f0f\u6c42\u4e2a\u79ef...\n\n\u7136\u9e45\u66b4\u529b\u5408\u5e76\u662f n^2 \u7684\u8bf4... \u4e8e\u662f\u8003\u8651\u4e00\u79cd\u4e0e\u591a\u70b9\u6c42\u503c\u7c7b\u4f3c\u7684\u505a\u6cd5\uff08\u5206\u6cbb\uff09\uff1f\n\n\uff08\u590d\u6742\u5ea6\u5927\u6982\u662f $n~log~n$ \uff1f \u590d\u6742\u5ea6\u767d\u75f4\u50bb\u50bb\u7b97\u4e0d\u6e05\u695a\uff09\n\n\u90a3\u4e48\u6211\u4eec\u8fd9\u6837\u6c42\u51fa\u7684 $G(x)$ \u7684\u6bcf\u4e00\u9879\u5c31\u662f\u6211\u4eec\u9700\u8981\u7684\u4e1c\u897f\u8fa3~\n\n\n-------\n\n\u7136\u540e\u6109\u5feb\u7684\u6572\u4ee3\u7801\uff1f\uff08\u677f\u5b50\u6284\u8fc7\u6765QWQ\uff09\n\n# code\n\n100 plus \u7684\u4ee3\u7801\uff08\u7136\u9e45\u8fd9\u91cc\u5e76\u6ca1\u6709\u5230 $100^+$ \uff09\n\n```cpp\n//by Judge\n#include<bits/stdc++.h>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(Rg int i=(a),I=(b)-1;i>I;--i)\n#define ll long long\nusing namespace std;\nconst int mod=998244353;\nconst int iG=332748118;\nconst int M=1e5+3;\ntypedef int arr[M];\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int inc(int x,int y){return (x+y)%mod;}\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline int dec(int x,int y){return (x-y+mod)%mod;}\ninline int read(){ int x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} int n,m,res,limit,fac[M],finv[M];\narr siz,D[19],A,B,C,G,sum,r;\ninline int qpow(Rg int x,Rg int p=mod-2,int s=1){\n\tfor(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\ninline void init(int n){ int l=-1;\n\tfor(limit=1;limit<n;limit<<=1)++l;\n\tfp(i,0,limit-1) r[i]=(r[i>>1]>>1)|((i&1)<<l);\n}\ninline void NTT(int* a,int tp){\n\tfp(i,0,limit-1) if(i<r[i]) swap(a[i],a[r[i]]);\n\tfor(Rg int mid=1;mid<limit;mid<<=1){\n\t\tint Gn=qpow(tp?3:iG,(mod-1)/(mid<<1));\n\t\tfor(Rg int j=0,I=mid<<1,x,y;j<limit;j+=I)\n\t\t\tfor(Rg int k=0,g=1;k<mid;++k,g=mul(g,Gn))\n\t\t\t\tx=a[j+k],y=mul(a[j+k+mid],g),\n\t\t\t\ta[j+k]=(x+y)%mod,a[j+k+mid]=(x-y+mod)%mod;\n\t} if(tp) return; int inv=qpow(limit);\n\tfp(i,0,limit-1) a[i]=mul(a[i],inv);\n}\nvoid Inv(int* a,int* b,int n){ static arr C,D;\n\tif(n==1) return b[0]=qpow(a[0]),void();\n\tInv(a,b,n>>1),init(n<<1);\n\tfp(i,0,n-1) C[i]=a[i],D[i]=b[i];\n\tfp(i,n,limit-1) C[i]=D[i]=0; NTT(C,1),NTT(D,1);\n\tfp(i,0,limit-1) C[i]=mul(C[i],mul(D[i],D[i]));\n\tNTT(C,0); fp(i,n,limit-1) b[i]=0;\n\tfp(i,0,n-1) b[i]=dec(inc(b[i],b[i]),C[i]);\n}\ninline void Direv(int* a,int* b,int n){\n\tfp(i,1,n-1) b[i-1]=mul(a[i],i); b[n-1]=0;\n}\ninline void Inter(int* a,int* b,int n){\n\tfp(i,1,n-1) b[i]=mul(a[i-1],qpow(i)); b[0]=0;\n}\ninline void Ln(int* a,int* b,int n){\n\tstatic arr C,D; Inv(a,C,n),Direv(a,D,n),init(n<<1);\n\tfp(i,n,limit-1) C[i]=D[i]=0; NTT(C,1),NTT(D,1);\n\tfp(i,0,limit-1) C[i]=mul(C[i],D[i]); NTT(C,0),Inter(C,b,n);\n}\ninline void Exp(int* a,int* b,int n){\n\tif(n==1) return b[0]=1,void(); static arr B;\n\tExp(a,b,n>>1),Ln(b,B,n),B[0]=dec(a[0]+1,B[0]);\n\tfp(i,1,n-1) B[i]=dec(a[i],B[i]); init(n<<1);\n\tNTT(B,1),NTT(b,1); fp(i,0,limit-1) b[i]=mul(b[i],B[i]);\n\tNTT(b,0); fp(i,n,limit-1) b[i]=B[i]=0;\n}\nvoid solv(int l,int r,int d){\n\tif(l==r) return D[d][0]=1,D[d][1]=mod-siz[l],void();\n\tint mid=(l+r)>>1; solv(l,mid,d),solv(mid+1,r,d+1);\n\tinit(r-l+2); fp(i,mid-l+2,limit-1) D[d][i]=0;\n\tfp(i,r-mid+1,limit-1) D[d+1][i]=0; NTT(D[d],1),NTT(D[d+1],1);\n\tfp(i,0,limit-1) D[d][i]=mul(D[d][i],D[d+1][i]); NTT(D[d],0);\n}\nint main(){ n=read(),m=read(); if(n==1) return !puts(\"1\");\n\t//////////////////// prep fac and ifac \n\tfac[0]=finv[0]=finv[1]=1; fp(i,1,n) fac[i]=mul(fac[i-1],i);\n\tfp(i,2,n) finv[i]=mul(mod-mod/i,finv[mod%i]);\n\tfp(i,2,n) finv[i]=mul(finv[i-1],finv[i]);\n\t/////////////////// prep k=1~n, \u2211ai^k \n\tfp(i,1,n) siz[i]=read(); solv(1,n,0);\n\tfp(i,0,n) G[i]=D[0][i]; int len;\n\tfor(len=1;len<=n;len<<=1); Ln(G,sum,len);\n\tfp(i,1,n) sum[i]=mod-mul(sum[i],i); sum[0]=n;\n\t/////////////////// calc  ANS \n\tfp(i,0,n-1) A[i]=mul(qpow(i+1,m),finv[i]),\n\t\tB[i]=mul(qpow(i+1,m<<1),finv[i]);\n\tLn(A,G,len),Inv(A,C,len),init(len<<1),NTT(C,1),NTT(B,1);\n\tfp(i,0,(len<<1)-1) B[i]=mul(B[i],C[i]); NTT(B,0);\n\tmemset(A,0,sizeof A),memset(C,0,sizeof C);\n\tfp(i,0,n-1) B[i]=mul(B[i],sum[i]),A[i]=mul(G[i],sum[i]); //\u5e26\u5165\u6c42\u503c \n\tExp(A,C,len),init(len<<1); fp(i,n,(len<<1)-1) B[i]=0; // A \u8981 Exp \u56de\u6765 \n\tNTT(B,1),NTT(C,1); fp(i,0,limit-1) B[i]=mul(B[i],C[i]); NTT(B,0);\n\tres=mul(B[n-2],fac[n-2]); fp(i,1,n) res=mul(res,siz[i]); //\u4e58\u5b8c\u4e4b\u540e\u6bcf\u4e00\u9879\u4e58\u5165 res \n\treturn !printf(\"%d\\n\",res);\n}\n```\n\n# UPD AT: 2019.5.9\n\n\n",
        "postTime": 1555926099,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4002 \u3010\u751f\u6210\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4002)\n\n\u795e\u9898\u3002\n\n\u8003\u8651\u5c06\u6240\u6709\u8fde\u901a\u5757\u7f29\u6210\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\u6240\u6709\u8fde\u597d\u8fb9\u7684\u751f\u6210\u6811\u5728\u7f29\u70b9\u4e4b\u540e\u4e00\u5b9a\u662f\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u751f\u6210\u6811\u3002\u6211\u4eec\u8bb0 $d_i$ \u4e3a\u7b2c $i$ \u4e2a\u8fde\u901a\u5757\u7f29\u5b8c\u70b9\u4e4b\u540e\u7684\u5ea6\u6570 $-1$\uff0c\u90a3\u4e48\u5171\u6709 $\\prod\\limits_{i=1}^na_i^{d_i+1}\\times\\dfrac{(n-2)!}{\\prod\\limits_{i=1}^nd_i!}$ \u4e2a\u8fd9\u6837\u7684\u751f\u6210\u6811\uff0c\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e2a\u67ff\u5b50\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8fde\u901a\u5757\u7684\u6bcf\u6761\u8fb9\u90fd\u6709\u53ef\u80fd\u662f\u7531\u5176\u4e2d $a_i$ \u4e2a\u70b9\u4e2d\u4efb\u610f\u4e00\u70b9\u8fde\u51fa\u7684\uff0c\u56e0\u6b64\u6bcf\u4e2a\u8fde\u901a\u5757\u8fde\u8fb9\u7684\u65b9\u6848\u4e3a $a_i^{d_i+1}$\uff0c\u800c\u7531 Prufer \u5e8f\u5217\u90a3\u5957\u7406\u8bba\u53ef\u77e5 $d_i$ \u5373\u4e3a $i$ \u5728 Prufer \u5e8f\u5217\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u4e14 $\\sum\\limits_{i=1}^nd_i=n-2$\uff0c\u53c8\u56e0\u4e3a\u4e00\u4e2a Prufer \u5e8f\u5217\u4e0e\u4e00\u68f5\u751f\u6210\u6811\u5f62\u6210\u53cc\u5c04\uff0c\u6545\u8fd9\u6837\u7684 $n$ \u4e2a\u70b9\u7684\u751f\u6210\u6811\u4e2a\u6570\u4e3a\u6ee1\u8db3 $i$ \u5728\u5e8f\u5217\u4e2d\u51fa\u73b0 $d_i$ \u6b21\u7684\u957f\u5ea6\u4e3a $n-2$ \u7684\u5e8f\u5217\u4e2a\u6570\uff0c\u5373\u591a\u91cd\u7ec4\u5408\u6570 $\\dbinom{n-2}{d_1,d_2,\\cdots,d_n}=\\dfrac{(n-2)!}{\\prod\\limits_{i=1}^nd_i!}$\uff0c\u7528\u4e58\u6cd5\u539f\u7406\u5c06\u5b83\u4eec\u4e58\u8d77\u6765\u5373\u53ef\u3002\n\n\u56e0\u6b64\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u5373\u4e3a $\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}\\prod\\limits_{i=1}^na_i^{d_i+1}\\times\\dfrac{(n-2)!}{\\prod\\limits_{i=1}^nd_i!}\\times(\\prod\\limits_{i=1}^n(d_i+1)^m)(\\sum\\limits_{i=1}^n(d_i+1)^m)$\u3002\u8003\u8651\u5c06\u67ff\u5b50\u7a0d\u5fae\u53d8\u4e2a\u5f62\uff0c\u5c06 $a_i^{d_i+1}$ \u62c6\u6210 $a_i^{d_i}$ \u4e0e $a_i$ \u5e76\u5c06 $a_i$ \u63d0\u5230\u5916\u9762\u6765\uff0c\u518d\u5c06 $(n-2)!$ \u63d0\u5230\u5916\u9762\u6765\uff0c\u5373\u53ef\u5f97\u5230 $(n-2)!\\prod\\limits_{i=1}^na_i\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}\\prod\\limits_{i=1}^n\\dfrac{a_i^{d_i}}{d_i!}\\times(\\prod\\limits_{i=1}^n(d_i+1)^m)(\\sum\\limits_{i=1}^n(d_i+1)^m)$\uff0c\u5c06\u91cc\u9762\u7684\u4e24\u4e2a $\\prod$ \u5408\u5e76\uff0c\u53c8\u6709 $(n-2)!\\prod\\limits_{i=1}^na_i\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}(\\prod\\limits_{i=1}^n\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^m)(\\sum\\limits_{i=1}^n(d_i+1)^m)$\uff0c\u524d\u9762\u7684 $(n-2)!\\prod\\limits_{i=1}^na_i$ \u662f\u5e38\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u7b97\u51fa\u540e\u9762\u7684\u7b54\u6848\u540e\u4e58\u4e0a\u53bb\u5373\u53ef\u3002\u5c06\u91cc\u9762 $\\sum$ \u7684\u62ec\u53f7\u62c6\u5f00\uff0c\u79fb\u5230\u5916\u9762\u53bb\uff0c\u53ef\u5f97 $\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}\\sum\\limits_{i=1}^n(d_i+1)^m(\\prod\\limits_{j=1}^n\\dfrac{a_j^{d_j}}{d_j!}(d_j+1)^m)$\uff0c\u518d\u7a0d\u5fae\u6574\u7406\u4e00\u4e0b\u5373\u53ef\u5f97\u5230 $\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}\\sum\\limits_{i=1}^n\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^{2m}\\prod\\limits_{j\\ne i}^n\\dfrac{a_j^{d_j}}{d_j!}(d_j+1)^m$\u3002\u524d\u9762\u7684\u6211\u4eec $\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}$ \u975e\u5e38\u8ba8\u538c\uff0c\u4e0d\u8fc7\u957f\u5f97\u4e00\u8138\u5e42\u7ea7\u6570\u7684\u6837\u5b50\uff0c\u56e0\u6b64\u8003\u8651\u8bb0 $A(x)=\\sum\\limits_{k\\ge 0}\\dfrac{x^k}{k!}(k+1)^m$\uff0c$B(x)=\\sum\\limits_{k\\ge 0}\\dfrac{x^k}{k!}(k+1)^{2m}$\uff0c\u90a3\u4e48\u663e\u7136 $\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^{2m}=[x^{d_i}]B(a_ix)$\uff0c$\\dfrac{a_j^{d_j}}{d_j!}(d_j+1)^m=[x^{d_j}]A(a_jx)$\uff0c\u6545 $\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}\\sum\\limits_{i=1}^n\\dfrac{a_i^{d_i}}{d_i!}(d_i+1)^{2m}\\prod\\limits_{j\\ne i}^n\\dfrac{a_j^{d_j}}{d_j!}(d_j+1)^m=\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}\\sum\\limits_{i=1}^n[x^{d_i}]B(a_ix)\\prod\\limits_{j\\ne i}^n[x^{d_j}]A(a_jx)$\uff0c\u800c\u663e\u7136\u5b83\u53c8\u7b49\u4e8e $[x^{n-2}]\\sum\\limits_{i=1}^nB(a_ix)\\prod\\limits_{j\\ne i}^nA(a_jx)$\uff0c\u54e6\u543c\uff0c$\\sum\\limits_{d_1+d_2+\\cdots+d_n=n-2}$\uff0c\u8fd9\u4e0b\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u8fd9\u4e24\u4e2a\u5e42\u7ea7\u6570\u5165\u624b\u4e86\u3002\n\n\u7136\u9e45\u76f4\u63a5\u8ba1\u7b97 $\\sum\\limits_{i=1}^nB(a_ix)\\prod\\limits_{j\\ne i}^nA(a_jx)$ \u8fd8\u662f\u4e0d\u592a\u5bb9\u6613\uff0c\u8003\u8651\u6309\u7167 P4389 \u4ed8\u516c\u4e3b\u7684\u80cc\u5305 \u7684\u5957\u8def\u53d6 $\\ln$ \u518d $\\exp$ \u56de\u53bb\uff0c\u5373 $\\sum\\limits_{i=1}^nB(a_ix)\\exp\\sum\\limits_{j\\ne i}\\ln A(a_jx)$\uff0c\u8fd9\u91cc $j\\ne i$ \u4e0d\u592a\u7f8e\u89c2\uff0c\u56e0\u6b64\u8003\u8651\u76f4\u63a5\u628a $j=i$ \u7684\u7b54\u6848\u5148\u7edf\u8ba1\u8fdb\u53bb\uff0c\u524d\u9762\u518d\u9664\u4e2a $A(a_ix)$\uff0c\u5373 $\\sum\\limits_{i=1}^n\\dfrac{B(a_ix)}{A(a_ix)}\\exp\\sum\\limits_{j=1}^n\\ln A(a_jx)$\uff0c\u8fd9\u6837\u4e24\u4e2a $\\sum$ \u5c31\u53ef\u4ee5\u72ec\u7acb\u8ba1\u7b97\u4e86\uff0c\u6545\u6211\u4eec\u53ea\u9700\u7b97\u51fa $\\sum\\limits_{i=1}^n\\dfrac{B(a_ix)}{A(a_ix)}$ \u548c $\\exp\\sum\\limits_{j=1}^n\\ln A(a_jx)$\uff0c\u7136\u540e\u628a\u5b83\u4eec\u5377\u8d77\u6765\u5373\u53ef\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5bf9\u4e8e\u6240\u6709 $i$ \u90fd\u8981\u8ba1\u7b97\u4e00\u904d $\\dfrac{B(a_ix)}{A(a_ix)}$ \u53ca $\\ln A(a_jx)$\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u8fd8\u662f\u5e73\u65b9\u5bf9\u6570\u7684\uff0c\u663e\u7136\u8fc7\u4e0d\u53bb\u3002\u4e0d\u8fc7\u6ce8\u610f\u5230 $[x^n]\\dfrac{B(a_ix)}{A(a_ix)}=a_i^n[x^n]\\dfrac{B(x)}{A(x)}$\uff0c$[x^n]\\ln A(a_jx)=a_j^n[x^n]\\ln A(x)$\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u9884\u5904\u7406\u51fa $\\dfrac{B(x)}{A(x)}$ \u548c $\\ln A(x)$\uff0c\u90a3\u4e48 $\\sum\\limits_{i=1}^n\\dfrac{B(a_ix)}{A(a_ix)}$ \u7684\u7b2c $k$ \u9879\u7cfb\u6570\u5c31\u662f $\\dfrac{B(x)}{A(x)}$ \u7b2c $k$ \u9879\u7cfb\u6570\u7684 $\\sum\\limits_{i=1}^na_i^k$ \u500d\uff0c$\\sum\\limits_{j=1}^n\\ln A(a_jx)$ \u4e5f\u540c\u7406\u3002\n\n\u6700\u540e\u5c31\u662f\u600e\u6837\u5bf9 $k\\in[0,n]$ \u6c42 $\\sum\\limits_{i=1}^na_i^k$\uff0c\u5176\u5b9e\u8fd9\u4e2a\u5957\u8def\u5728 P4705 \u73a9\u6e38\u620f \u91cc\u5c31\u51fa\u73b0\u8fc7\u4e86\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u518d\u8bb2\u89e3\u4e00\u904d\u3002\u7531\u4e8e $a^k=[x^k]\\dfrac{1}{1-ax}$\uff0c\u56e0\u6b64\u8fd9\u4e1c\u897f\u7684\u751f\u6210\u51fd\u6570 $F(x)=\\sum\\limits_{i=1}^n\\dfrac{1}{1-a_ix}$\uff0c\u6ce8\u610f\u5230 $\\ln'(\\dfrac{1}{1-a_ix})=-\\dfrac{a_i}{1-a_ix}$\uff0c\u800c $F(x)=\\sum\\limits_{i=1}^n\\dfrac{1}{1-a_ix}=n-\\sum\\limits_{i=1}^n-\\dfrac{a_i}{1-a_ix}$\uff0c\u6545 $F(x)=n-\\sum\\limits_{i=1}^n\\ln'(\\dfrac{1}{1-a_ix})=n+\\sum\\limits_{i=1}^n\\ln'(1-a_ix)$\uff0c\u6839\u636e\u5bfc\u6570\u7684\u548c\u7b49\u4e8e\u548c\u7684\u5012\u6570\u53ef\u77e5\uff0c$F(x)$ \u53c8\u7b49\u4e8e $n+(\\sum\\limits_{i=1}^n\\ln(1-a_ix))'=n+(\\ln\\prod\\limits_{i=1}^n(1-a_ix))'$\uff0c\u91cc\u9762\u7684 $\\prod$ \u53ef\u4ee5\u5206\u6cbb\u6c42\u51fa\uff0c\u590d\u6742\u5ea6 $n\\log^2n$\uff0c\u6c42\u51fa\u6765\u4e4b\u540e\u518d $\\ln$ \u4e00\u904d\uff0c$\\text{direv}$ \u4e00\u904d\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $n\\log^2n$\u3002\n\n\u6ce8\u610f\u7279\u5224 $n=1$\uff0c\u5426\u5219 UOJ \u4e0a\u8fc7\u4e0d\u53bb\u3002\n\n```cpp\nconst int pr=3;\nconst int MAXN=3e4;\nconst int MAXP=1<<16;\nconst int MOD=998244353;\nconst int ipr=(MOD+1)/3;\nint qpow(int x,int e=MOD-2){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint n,m,a[MAXN+5],fac[MAXN+5],ifac[MAXN+5];\nvoid init_fac(int n){\n\tfac[0]=ifac[0]=ifac[1]=1;\n\tfor(int i=2;i<=n;i++) ifac[i]=1ll*ifac[MOD%i]*(MOD-MOD/i)%MOD;\n\tfor(int i=1;i<=n;i++) fac[i]=1ll*fac[i-1]*i%MOD,ifac[i]=1ll*ifac[i]*ifac[i-1]%MOD;\n}\nint rev[MAXP+5],inv[MAXP+5];\nvoid NTT(vector<int> &a,int len,int type){\n\tint lg=31-__builtin_clz(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=qpow((type<0)?ipr:pr,(MOD-1)/i);\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*w*a[(i>>1)+j+k]%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1) for(int i=0;i<len;i++) a[i]=1ll*a[i]*inv[len]%MOD;\n}\nvector<int> conv(vector<int> a,vector<int> b){\n\tint len=1;while(len<a.size()+b.size()) len<<=1;\n\ta.resize(len,0);b.resize(len,0);NTT(a,len,1);NTT(b,len,1);\n\tfor(int i=0;i<len;i++) a[i]=1ll*a[i]*b[i]%MOD;\n\tNTT(a,len,-1);return a;\n}\nvector<int> conv(vector<int> a,vector<int> b,int lenc){\n\tint len=1;while(len<a.size()+b.size()) len<<=1;\n\ta.resize(len,0);b.resize(len,0);NTT(a,len,1);NTT(b,len,1);\n\tfor(int i=0;i<len;i++) a[i]=1ll*a[i]*b[i]%MOD;\n\tNTT(a,len,-1);if(a.size()>lenc) a.resize(lenc);\n\treturn a;\n}\nvector<int> getinv(vector<int> a,int n){\n\tvector<int> b(n,0);assert(a[0]!=0);b[0]=qpow(a[0]);\n\tfor(int i=2;i<=n;i<<=1){\n\t\tvector<int> c(a.begin(),a.begin()+i);\n\t\tvector<int> d(b.begin(),b.begin()+(i>>1));\n\t\td=conv(d,d);c=conv(c,d);\n\t\tfor(int j=0;j<i;j++) b[j]=(2*b[j]%MOD-c[j]+MOD)%MOD;\n\t} return b;\n}\nvector<int> direv(vector<int> a,int n){\n\tvector<int> b(n,0);\n\tfor(int i=1;i<n;i++) b[i-1]=1ll*a[i]*i%MOD;\n\treturn b;\n}\nvector<int> inter(vector<int> a,int n){\n\tvector<int> b(n,0);\n\tfor(int i=1;i<n;i++) b[i]=1ll*a[i-1]*inv[i]%MOD;\n\treturn b;\n}\nvector<int> getln(vector<int> a,int n){\n\tvector<int> a_=direv(a,n),b=getinv(a,n);\n\tb=conv(a_,b);b=inter(b,n);return b;\n}\nvector<int> getexp(vector<int> a,int n){\n\tvector<int> b(n,0);b[0]=1;\n\tfor(int i=2;i<=n;i<<=1){\n\t\tvector<int> c(b.begin(),b.begin()+i);\n\t\tvector<int> d(b.begin(),b.begin()+(i>>1));\n\t\tc=getln(c,i);for(int j=0;j<i;j++) c[j]=(a[j]-c[j]+MOD)%MOD;\n\t\t(c[0]+=1)%=MOD;d=conv(d,c);\n\t\tfor(int j=0;j<i;j++) b[j]=d[j];\n\t} return b;\n}\nint LEN=1;\nvector<int> solve(int l,int r){\n\tif(l==r){return vector<int>{1,MOD-a[l]};}\n\tint mid=l+r>>1;return conv(solve(l,mid),solve(mid+1,r),LEN);\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);init_fac(n);\n\tif(n==1) return printf(\"%d\\n\",m==0),0;\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\twhile(LEN<=n) LEN<<=1;\n\tfor(int i=1;i<=LEN<<1;i++) inv[i]=qpow(i);\n\tvector<int> A(LEN),B(LEN);\n\tfor(int i=0;i<=n;i++) A[i]=1ll*ifac[i]*qpow(i+1,m)%MOD;\n\tfor(int i=0;i<=n;i++) B[i]=1ll*ifac[i]*qpow(i+1,2*m)%MOD;\n\tvector<int> iA=getinv(A,LEN),lnA=getln(A,LEN);\n\tvector<int> mA=conv(B,iA,LEN);\n\tvector<int> C=solve(1,n);C.resize(LEN,0);\n\tC=getln(C,LEN);C=direv(C,LEN);for(int j=LEN-1;j;j--) C[j]=(MOD-C[j-1])%MOD;\n\tC[0]=n;//for(int i=1;i<=n;i++) printf(\"%d\\n\",C[i]);\n\tfor(int i=0;i<LEN;i++) lnA[i]=1ll*lnA[i]*C[i]%MOD;\n\tfor(int i=0;i<LEN;i++) mA[i]=1ll*mA[i]*C[i]%MOD;\n\tlnA=getexp(lnA,LEN);vector<int> ret=conv(lnA,mA);\n\tint ans=ret[n-2];//printf(\"%d\\n\",ans);\n\tfor(int i=1;i<=n;i++) ans=1ll*ans*a[i]%MOD;\n\tans=1ll*ans*fac[n-2]%MOD;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1617771429,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4002 [\u6e05\u534e\u96c6\u8bad2017]\u751f\u6210\u6811\u8ba1\u6570"
    }
]