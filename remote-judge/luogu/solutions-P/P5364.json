[
    {
        "content": "@Fading \u9996\u5148\u6211\u8981\u544a\u8bc9\u60a8\u60a8\u7684\u505a\u6cd5\u4e0d\u662f\u6700\u4f18...\n\n$O(k+\\log n)$\uff01\uff08\u5982\u679c\u8c01\u6709\u66f4\u4f18\u7684\u505a\u6cd5\u7684\u8bdd\u8bf7\u544a\u77e5\u6211...\uff09\n\n\u9996\u5148\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u5199\u6210\u77e9\u9635\u4e58\u6cd5\u7684\u5f62\u5f0f...\uff08\u5982\u679c\u4f60\u6ca1\u6709\u53d1\u73b0\uff0c\u8bf7\u770b\u6700\u65e9\u90a3\u7bc7\u9898\u89e3\uff09...\u7136\u540e\u53ef\u4ee5\u60ca\u5947\u7684\u53d1\u73b0\uff0c\u77e9\u9635\u662f\u4e0a\u4e09\u89d2\u77e9\u9635\uff0c\u5e76\u4e14\u5bf9\u89d2\u7ebf\u4e0a\u6709\u4e00\u4e2a $2$ \u548c $k+1$ \u4e2a $1$\uff01\n\n\u56e0\u4e3a\u77e9\u9635\u662f\u4e0a\u4e09\u89d2\uff0c\u6240\u4ee5\u663e\u7136\u5176\u7279\u5f81\u503c\u5c31\u662f\u4e3b\u5bf9\u89d2\u7ebf\u4e0a\u7684\u5143\u7d20\uff0c\u6240\u4ee5\u6839\u636e\u9012\u63a8\u901a\u9879\u516c\u5f0f\u4e4b\u7c7b\u7684\u6027\u8d28\uff0c\u53ef\u4ee5\u53d1\u73b0\u7b54\u6848\u4e00\u5b9a\u662f\u8fd9\u79cd\u5f62\u5f0f\uff1a\n\n$$c_k2^n+\\sum_{i=0}^ka_{k,i}n^i$$\n\n\u5373\u4e00\u4e2a $2^n$ \u7684\u9879\u52a0\u4e0a\u4e00\u4e2a $k$ \u6b21\u591a\u9879\u5f0f\u3002\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86 $c_k$ \u7684\u503c\uff0c\u90a3\u4e48\u901a\u8fc7\u9884\u5904\u7406 $[1, k+1]$ \u9879\u5c31\u53ef\u4ee5\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5f97\u5230 $n$ \u7684\u503c\u3002\uff08\u62c9\u683c\u6717\u65e5\u63d2\u503c\u53ef\u4ee5\u505a\u5230 $O(k)$\uff09\n\n\u4f17\u6240\u5468\u77e5 $c_k2^n$ \u7684\u5dee\u5206\u4ecd\u7136\u662f $c_k2^n$\uff0c\u4f46\u662f $k$ \u6b21\u591a\u9879\u5f0f\u7684\u5dee\u5206\u662f $k-1$ \u9636\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u628a\u524d $k+1$ \u9879\u8fdb\u884c $k$ \u9636\u5dee\u5206\uff08\u8fd9\u4e2a\u53ef\u4ee5\u76f4\u63a5\u7528\u7ec4\u5408\u6570 $O(k)$ \u5f97\u5230\uff09\u5c31\u53ef\u4ee5\u5f97\u5230 $c_k$ \u7684\u503c\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u590d\u6742\u5ea6\u74f6\u9888\u8fd8\u5269\u4e0b\u9884\u5904\u7406\u524d $k+1$ \u9879\u3002\u800c\u53ef\u4ee5\u53d1\u73b0\u53ea\u9700\u8981\u6c42\u51fa $1^k\\dots (k+1)^k$\uff0c\u800c\u8fd9\u53ef\u4ee5\u901a\u8fc7\u6b27\u62c9\u7b5b\u53ea\u6c42\u5176\u4e2d\u7d20\u6570\u7684\u5e42\uff0c\u4ece\u800c\u505a\u5230 $O(\\pi(k)\\log k+k)=O(k)$\u3002\n\n\u4e8e\u662f\u603b\u590d\u6742\u5ea6\u5c31\u662f $O(k+\\log n)$\u3002\uff08$O(\\log n)$\u662f\u8ba1\u7b97 $2^n$ ~~\u548c\u8f93\u5165n~~\uff09\uff08$n$ \u66f4\u5927\u4e5f\u4e0d\u7528\u9ad8\u7cbe\u5ea6\uff0c\u53ea\u9700\u8981\u5bf9 $10^9+7$ \u53d6\u6a21\u7b97\u63d2\u503c\uff0c$10^9+6$ \u53d6\u6a21\u7b97 $2$ \u7684\u5e42\u5373\u53ef\uff09\n\n\u4ee3\u7801\n\n```cpp\n// luogu-judger-enable-o2\n#include <algorithm>\n#include <cctype>\n#include <cstdio>\n#include <cstring>\n\ntypedef long long LL;\n\nconst int K = 15;\nconst int mod = 1000000007;\n\nLL pow_mod(LL a, LL b) {\n  LL ans = 1;\n  for (; b; b >>= 1, a = a * a % mod)\n    if (b & 1) ans = ans * a % mod;\n  return ans;\n}\n\nLL pK[K], f[K], inv[K];\nint pr[K], cnt;\n\nvoid Sieve(int k) {\n  pK[1] = 1;\n  for (int i = 2; i <= k + 1; ++i) {\n    if (!pK[i]) pK[pr[cnt++] = i] = pow_mod(i, k);\n    for (int j = 0; pr[j] * i <= k + 1; ++j) {\n      pK[i * pr[j]] = pK[i] * pK[pr[j]] % mod;\n      if (i % pr[j] == 0) break;\n    }\n  }\n}\n\nint main() {\n  int k; LL n;\n  scanf(\"%lld%d\", &n, &k); --n;\n\n  LL s = 0, tn = n % mod;\n  Sieve(k);\n  for (int i = 0; i <= k; ++i) {\n    if ((f[i] = s + pK[i + 1]) >= mod) f[i] -= mod;\n    if ((s += f[i]) >= mod) s -= mod;\n  }\n  if (n <= k) return printf(\"%lld\\n\", f[n]) & 0;\n\n  LL g = -1; inv[1] = 1;\n  for (int i = 2; i <= k; ++i) {\n    inv[i] = -(mod / i) * inv[mod % i] % mod;\n    g = g * -inv[i] % mod;\n  }\n\n  LL c = 1, p = 0;\n  for (int i = 0; i <= k; ++i) {\n    // sum_{i=0}^k (-1)^(k-i) C(k, i) f[i+1]\n    LL _t = c * f[i] % mod;\n    c = c * inv[i + 1] % mod * (k - i) % mod;\n    if ((k - i) & 1) p -= _t;\n    else p += _t;\n  }\n\n  LL ans = 0, p2 = p, t = 1;\n  for (int i = 0; i <= k; ++i) {\n    LL _y = (f[i] - p2) * g % mod;\n    ans = (ans * (tn - i) + _y * t) % mod;\n\n    t = t * (tn - i) % mod;\n    p2 = p2 * 2 % mod;\n    g = g * (i - k) % mod * inv[i + 1] % mod;\n  }\n  ans = (ans + p * pow_mod(2, n % (mod - 1))) % mod;\n  printf(\"%lld\\n\", (ans + mod) % mod);\n}\n```",
        "postTime": 1558750032,
        "uid": 7868,
        "name": "_rqy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u662f\u4e00\u9053~~\u5f88\u7b80\u5355\u7684~~~~\u7701\u9009~~\u9898\n\n\u76f8\u4fe1\u8fd9\u9053\u9898\u7684\u9012\u63a8\u5f0f\u662f\u5f88\u597d\u63a8\u7684\n\n\u8bbe$f[i]$\u8868\u793a\u7b2c$i$\u4e2a\u6570\u662f\u591a\u5c11\uff0c$s[i]$\u8868\u793a$f$\u7684\u524d\u7f00\u548c\uff0c\u5373$s[i]=\\sum_{j=1}^if[j]$\n\n\u5219\u80fd\u5217\u51fa\u4e0b\u5217\u9012\u63a8\u5f0f\n\n$f[i]=s[i-1]+i^k$\n\n$s[i]=s[i-1]+f[i]=2s[i-1]+i^k$\n\n\u90a3\u6211\u4eec\u53ea\u8981\u6c42\u51fa$s[n-1]$\u5c31\u80fd\u6c42\u51fa$f[n]$\u7684\u503c\u3002\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u9012\u63a8\u5f0f\u3002\u8fd9\u6837\u5b50\u57fa\u672c\u90fd\u662f\u4e00\u773c\u77e9\u4e58\u7684\u5427\u3002\u4f46\u662f\u5982\u4f55\u6784\u5efa\u8fd9\u4e2a\u77e9\u9635\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0$(n+1)^k=C_k^0n^k+C_k^1n^{k-1}+\u2026\u2026+C_k^kn^0$\uff0c\u7136\u540e\u6211\u4eec\u5c31\u80fd\u6784\u9020\u8fd9\u6837\u7684\u77e9\u4e58\uff1a\n$\\begin{bmatrix} 2&C_k^0&C_k^1&C_k^2 &\\cdots&C_k^k\\\\ 0&C_k^0&C_k^1&C_k^2 &\\cdots&C_k^k\\\\ 0&0&C_{k-1}^0&C_{k-1}^1&\\cdots&C_{k-1}^{k-1}\\\\ 0&0&0&C_{k-2}^0&\\cdots&C_{k-2}^{k-2}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ 0&0&0&0&0&C_0^0\\\\ \\end{bmatrix}\u00d7\\begin{bmatrix} s[i]\\\\ i^k\\\\ i^{k-1}\\\\ i^{k-2}\\\\ \\vdots\\\\ i^0\\\\ \\end{bmatrix} = \\begin{bmatrix} s[i+1]\\\\ (i+1)^k\\\\ (i+1)^{k-1}\\\\ (i+1)^{k-2}\\\\ \\vdots\\\\ (i+1)^0\\\\ \\end{bmatrix}$\n\n\uff08\u6ce8\uff1a\u5b9a\u4e49$C_0^0=1$\uff09\n\n\u7136\u540e\u66b4\u529b\u4e0a\u77e9\u4e58\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(k^3log_n)$\n\n\uff08\u4e8b\u5b9e\u4e0a\u6211\u7684\u7a0b\u5e8f\u518d$n\u22642$\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u51fa\u9519\u56e0\u4e3a\u6211\u6ca1\u6709\u7279\u5224\uff0c\u5e0c\u671b\u5927\u5bb6\u5199\u7684\u65f6\u5019\u628a\u7279\u5224\u52a0\u4e0a\u53bb$Q\\omega Q$\uff09\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int mo=1e9+7;\n\nll n,k;\n\nstruct Matrix\n{\n\tstruct tmp\n\t{\n\t\tint a[13];\n\t\tint& operator [] (int x)\n\t\t{\n\t\t\treturn a[x];\n\t\t}\n\t} a[13];\n\ttmp& operator [] (int x)\n\t{\n\t\treturn a[x];\n\t}\n};//\u6211\u4eec\u673a\u623f\u5927\u4f6c\u6559\u7684\u4e00\u79cd\u795e\u5947\u5b9a\u4e49\u6cd5\uff0c\u53ef\u4ee5\u628a\u7ed3\u6784\u4f53\u76f4\u63a5\u5f53\u4e8c\u7ef4\u6570\u7ec4\u7528\nMatrix mat,C,e,s,P,Q;\n\nvoid cheng(Matrix A,Matrix B,Matrix &C)\n{\n\tfor (int i=1;i<=k+2;i++)\n\t\tfor (int j=1;j<=k+2;j++)\n\t\t\tC[i][j]=0;\n\tfor (int i=1;i<=k+2;i++)\n\t\tfor (int j=1;j<=k+2;j++)\n\t\t\tfor (int l=1;l<=k+2;l++)\n\t\t\t\tC[i][j]=((ll)C[i][j]+(ll)A[i][l]*B[l][j])%mo;\n}\n\nll ksm(int x,int y)\n{\n\tif (!y) return 1;\n\tll d=ksm(x,y/2);\n\tif (y&1) return d*d%mo*x%mo;\n\treturn d*d%mo;\n}\n\nint main()\n{\n\tcin>>n>>k;\n\tC[0][0]=1;\n\tfor (int i=1;i<=k;i++)\n\t{\n\t\tC[i][0]=1;\n\t\tfor (int j=1;j<=i;j++) C[i][j]=C[i-1][j-1]+C[i-1][j];\n\t}\n\tmat[1][1]=2;\n\tfor (int i=2;i<=k+2;i++) mat[1][i]=C[k][i-2];\n\tfor (int i=2;i<=k+2;i++)\n\t\tfor (int j=i;j<=k+2;j++)\n\t\t\tmat[i][j]=C[k-i+2][j-i];\n\tll Pow=n-2;\n\tfor (int i=1;i<=k+2;i++) e[i][i]=1;\n\twhile (Pow)\n\t{\n\t\tif (Pow&1) {P=e;cheng(P,mat,e);}\n\t\tP=mat;Q=mat;cheng(P,Q,mat);\n\t\tPow>>=1;\n\t}\n\tfor (int i=1;i<=k+2;i++) s[i][1]=1;\n\tcheng(e,s,e);\n\tcout<<(e[1][1]+ksm(n%mo,k))%mo<<endl;\n}\n```",
        "postTime": 1557491195,
        "uid": 29575,
        "name": "Holy_Push",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "[\u597d\u5f97\u4e0d\u5f97\u4e86\u7684\u9605\u8bfb\u4f53\u9a8c\uff08cnblogs\uff09](https://www.cnblogs.com/whale-at-cola/p/solution-p5364.html)\n\n\u63d0\u4f9b\u4e00\u4e2a[\u8ba8\u8bba\u533a\u6709\u4eba\u63d0\u51fa](https://www.luogu.com.cn/discuss/120323)\u4f46\u6ca1\u7ec6\u8bb2\u7684\u65af\u7279\u6797\u6570\u505a\u6cd5\uff0c\u590d\u6742\u5ea6 $O(k^2)$ \u4e14\u53ef\u4f18\u5316\u5230 $O(k \\log k)$\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u5e38\u7528\u6027\u8d28\u3002\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5364)\n\n\u4e0b\u6587\u4e2d\u4e3a\u4e86\u65b9\u4fbf\u8bbe $m=n-1$\u3002\n\n\u9996\u5148\u53d1\u73b0\u9898\u76ee\u8ba9\u6211\u4eec\u6c42 $\\sum_{i=1}^m 2^{m-i} \\times i^k +n^k$\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u7684\u63a8\u5bfc\u522b\u7684\u9898\u89e3\u90fd\u6709\u5199\u6211\u5c31\u4e0d\u5199\u4e86\u3002\n\n\u4e3a\u65b9\u4fbf\uff0c\u8003\u8651\u6c42 $\\sum_{i=0}^m 2^{m-i} \\times i^k$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u5b83\u548c\u5e38\u89c1\u7684\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u5e94\u7528\u4e2d\u7684\u6c42\u81ea\u7136\u6570 $k$ \u6b21\u5e42\u548c\u5f88\u50cf\uff0c\u6240\u4ee5\u8003\u8651\u7528\u540c\u6837\u7684\u65b9\u6cd5\u505a\u3002\n\n\u4ee3\u5165\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u6027\u8d28\u5f0f\u5b50 $i^k = \\sum_{j=0}^k{k \\brace j}j!{i \\choose j}$\uff0c\u63a8\u4e00\u6ce2\u5f0f\u5b50\uff1a\n\n$$\n\\begin{aligned}\nans\n&=\\sum_{i=0}^m 2^{m-i} \\times i^k \\\\\n&=\\sum_{i=0}^m 2^{m-i} \\sum_{j=0}^k{k \\brace j}j!{i \\choose j} \\\\\n&=\\sum_{j=0}^k {k \\brace j}j! \\sum_{i=0}^m 2^{m-i} {i \\choose j} \\\\\n&=\\sum_{j=0}^k {k \\brace j}j! \\sum_{i=j}^m 2^{m-i} {i \\choose j} \\\\\n\\end{aligned}\n$$\n\n\n\u8bbe $g(p)=\\sum_{i=p}^m 2^{m-i} {i \\choose p}$\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u600e\u4e48\u6c42\u5462\uff1f\u8003\u8651\u9012\u63a8\u641e\u51fa\u4e0b\u4e00\u9879\uff1a\n$$\n\\begin{aligned}\ng(p)\n&=\\sum_{i=p}^m 2^{m-i} {i \\choose p} \\\\\n&=\\sum_{i=p+1}^m 2^{m-i} {i \\choose p}+2^{m-p}\\\\\n&=\\sum_{i=p+1}^m 2^{m-i} \\times ({i+1 \\choose p+1}-{i \\choose p+1})+2^{m-p}\\\\\n&=\\sum_{i=p+1}^m 2^{m-i} \\times {i+1 \\choose p+1}-\\sum_{i=p+1}^m 2^{m-i}{i \\choose p+1}+2^{m-p}\\\\\n&=\\sum_{i=p+2}^{m+1} 2^{m-i+1} {i \\choose p+1}-g(p+1) +2^{m-p}\\\\\n&={m+1 \\choose p+1}-g(p+1) +2\\sum_{i=p+2}^{m} 2^{m-i} {i \\choose p+1} +2 \\times 2^{m-(p+1)}\\\\\n&={m+1 \\choose p+1}-g(p+1) +2\\sum_{i=p+1}^{m} 2^{m-i} {i \\choose p+1}\\\\\n&={m+1 \\choose p+1} +g(p+1)\n\\end{aligned}\n$$\n\u53cd\u8fc7\u6765\uff0c\u6709 $g(p)=g(p-1)-{m+1 \\choose p} =g(p-1)-{n \\choose p}$\u3002\n\n\u4e8e\u662f\u6c42\u51fa\u8fb9\u754c $g(0)=\\sum_{i=0}^m 2^{m-i} {i \\choose 0}=\\sum_{i=0}^m 2^i=2^{m+1}-1=2^n-1$ \u7136\u540e\u9012\u63a8\u5373\u53ef\u6c42\u51fa $g$\u3002\n\n\u6240\u4ee5\u53ea\u8981\u679a\u4e3e $j$\uff0c\u7b97\u51fa $\\sum_{j=0}^k {k \\brace j}j!g(j)$ \u5373\u53ef\u7b97\u51fa\u7b54\u6848\u3002\n\n\u590d\u6742\u5ea6 $O(k^2)$\uff0c\u74f6\u9888\u5728\u4e8e\u9884\u5904\u7406\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u7528 NTT \u5377\u79ef\u6c42\u4e00\u884c\u7684\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u53ef\u4f18\u5316\u5230 $O(k \\log k)$\u3002\n\n\u4e3b\u8981\u90e8\u5206\u4ee3\u7801\uff08\u9a6c\u8702\u8f83\u8be1\u5f02\uff0c\u52ff\u55b7\uff09\uff1a\n\n```cpp\ninline ll md(ll x){return x<0?x+mod:x;}\ninline ll qpow(ll d,ll z){\n\tll res=1ll;\n\tfor(;z;z>>=1ll,d=d*d%mod) if(z&1ll) res=res*d%mod;\n\treturn res;\n}\n\nsigned main(){\n\tll n=read();int k=read();\n\tinv[0]=inv[1]=stl[1][1]=1ll;\n\tfor(re int i=2;i<=k;++i) inv[i]=(mod-mod/i)*inv[mod%i]%mod;\n\tfor(re int i=2;i<=k;++i) for(re int j=1;j<=i;++j) stl[i][j]=(stl[i-1][j-1]+j*stl[i-1][j])%mod;\n\tll f=1ll,g=md(qpow(2ll,n)-1),c=1ll,ans=qpow(n%=mod,k);\n\tfor(re int j=0;j<=k;++j,f=f*j%mod,g=md(g-(c=c*(n-j+1ll)%mod*inv[j]%mod))) ans=(ans+stl[k][j]*f%mod*g)%mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1643548115,
        "uid": 232349,
        "name": "WhaleAtCola",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011P5364 [SNOI2017]\u793c\u7269"
    },
    {
        "content": "\u8fd9\u9053\u9898\u662f\u4e00\u9053\u5341\u5206\u6807\u51c6\u7684\u77e9\u9635\u5feb\u901f\u5e42\u9898\u76ee\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0b\u4e24\u4e2a\u77e9\u9635\u662f\u600e\u4e48\u76f8\u4e58\u7684\u3002\n\n\u9996\u5148\uff0c\u4e24\u4e2a\u77e9\u9635 $ A $ \u4e0e $ B $ \u76f8\u4e58\u7684\u5fc5\u8981\u6761\u4ef6\u4e3a $ A $ \u7684\u5217\u7b49\u4e8e $ B $ \u7684\u884c\u6570\uff0c\u76f8\u4e58\u7684\u7ed3\u679c\u77e9\u9635 $ C $ \u7684\u884c\u6570\u7b49\u4e8e $ A $ \u7684\u884c\u6570\uff0c$ C $ \u7684\u5217\u6570\u7b49\u4e8e $ B $ \u7684\u5217\u6570\u3002\n\n\u5728\u505a\u8fd9\u9053\u9898\u65f6\u6211\u4eec\u53ef\u4ee5\u5148\u6784\u9020\u4e00\u4e2a\u5173\u4e8e\u77e9\u9635\u7684\u7ed3\u6784\u4f53\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```\nstruct mat\n{\n    long long m,n;\n    long long a[30][30]; \n    mat operator * (mat& b)  //\u91cd\u6784\u4e58\u6cd5\u8fd0\u7b97\u7b26\n    {\n        mat c;\n        memset(c.a,0,sizeof(c.a));\n        c.m=m;\n        c.n=b.n;\n        for(int i=1;i<=m;i++)\n            for(int j=1;j<=b.n;j++)\n                for(int p=1;p<=n;p++)\n                {\n                    c.a[i][j]+=(a[i][p]*b.a[p][j])%1000000007;\n                    c.a[i][j]%=1000000007;\n        }\n        return c;\n    }\n};\n```\n\u4f46\u662f\u6211\u4eec\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u77e9\u9635\u91cc\u9762\u5e94\u8be5\u653e\u4ec0\u4e48\u53d8\u91cf\u5462\uff1f\n\n\u9996\u5148\u6211\u4eec\u4f1a\u60f3\u5230\u653e\u5165\u7b2c $ i $ \u4e2a\u4eba\u7684\u793c\u7269\u6570\u91cf\uff0c\n\n\u5176\u6b21\u6211\u4eec\u4f1a\u7528\u5230\u4e4b\u524d\u6240\u6709\u4eba\u7684\u793c\u7269\u6570\u91cf\u4e4b\u548c\uff0c\u56e0\u4e3a\u8ba1\u7b97\u7b2c $ i $ \u4e2a\u4eba\u793c\u7269\u6570\u91cf\u4f1a\u7528\u5230\u3002\n\n\u6211\u4eec\u5728\u8ba1\u7b97\u7b2c $ i $ \u4e2a\u4eba\u7684\u793c\u7269\u6570\u91cf\u9700\u8981\u7528\u5230 $ i^{k} $,\u6240\u4ee5\u5728\u77e9\u9635\u4e2d\u8fd8\u8981\u6709 $ i^{k} $ \u3002\n\n\u540c\u65f6\u9700\u8981\u8ba1\u7b97 $ i^{k} $ \u8fd8\u9700\u8981 $ i^{k-1} $ \uff0c\u800c $ i^{k-1} $ \u8fd8\u9700\u8981 $ i^{k-2} $\u3002\n\n\u6240\u4ee5\u6211\u4eec\u627e\u5230\u4e86\u77e9\u9635\u4e2d\u9700\u8981\u653e\u5165\u7684\u53d8\u91cf\uff1a\u5f53\u524d\u670b\u53cb\u7684\u793c\u7269\u3001$ i^{k} $\u3001$ i^{k-1} \\cdots i $\u3001$ 1 $ \u3002\n\n\u6211\u6784\u9020\u7684\u77e9\u9635\u662f\u8fd9\u6837\u7684\uff1a\n\n$\\begin{vmatrix}\nnum_{i}  &i^{k}  &i^{k-1}  &\\cdots  &i  &1   &S_{i}\n\\end{vmatrix}$\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u4e00\u6b65\u5c31\u53d8\u6210\u77e9\u9635\u5feb\u901f\u5e42\u4e86\uff0c\n\n\u90a3\u4e48\u8fd9\u79cd\u77e9\u9635\u5e94\u8be5\u4e58\u4e00\u4e2a\u600e\u6837\u7684\u77e9\u9635\u624d\u80fd\u53d8\u5316\u5230\u4e0b\u4e00\u6b65\u5462\uff1f\n\n\u8fd9\u4e2a\u77e9\u9635\u7684\u4e0b\u4e00\u6b65\u662f\u8fd9\u6837\u7684\uff1a\n\n$\\begin{vmatrix}\nnum_{i+1}  &\\left(i+1\\right)^{k}  &\\left(i+1\\right)^{k-1}  &\\cdots  &\\left(i+1\\right)  &1   &S_{i+1}\n\\end{vmatrix}$\n\n\u6211\u4eec\u6765\u4e00\u6b65\u4e00\u6b65\u5730\u770b\uff1a\n\n$ num_{i+1}=S_{i}+\\left(i+1\\right)^{k} $,\n\n$ S_{i+1}=S_{i}+num_{i} $\n\n\u90a3\u4e48 $ \\left(i+1\\right)^{k} $\u3001$ \\left(i+1\\right)^{k-1} $ \u7b49\u53c8\u5e94\u8be5\u5982\u4f55\u6784\u9020\u5462\uff1f\n\n$ \\because $ \u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5730\u65b9\u5e94\u8be5\u662f\u4e00\u4e2a\u6768\u8f89\u4e09\u89d2\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u51fd\u6570\u6765\u6c42\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\nlong long yh[20][20];\nlong long yhsj(long long x,long long y)\n{\n    if(!yh[x][y])\n    {\n        if(y==1||y==x)\n            yh[x][y]=1;\n        else\n            yh[x][y]=yh[x-1][y-1]+yh[x-1][y];\n    }\n    return yh[x][y];\n}\nvoid nb(mat& a,long long k)\n{\n    a.m=a.n=k+3;\n    memset(a.a,0,sizeof(a.a));\n    a.a[k+3][1]=1;\n    a.a[k+3][k+3]=2;\n    for(int i=1;i<=k+1;i++)\n        for(int j=1;j<=i;j++)\n             a.a[k+3-j][k+3-i]=yhsj(i,j);\n    for(int i=2;i<=k+2;i++)\n        a.a[i][1]=a.a[i][k+3]=a.a[i][2];\n}\n```\n\u5176\u4e2d $ \\operatorname{yhsj} $ \u51fd\u6570\u7528\u4e8e\u8ba1\u7b97\u6768\u8f89\u4e09\u89d2\uff0c\u6570\u7ec4 $ yh $ \u7528\u4e8e\u8bb0\u5fc6\u5316\u641c\u7d22\u6768\u8f89\u4e09\u89d2\u7684\u67d0\u4e00\u9879\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5feb\u901f\u5e42\u7684\u90e8\u5206\u4e86\u3002\n\n\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u8fd9\u8981\u628a\u6574\u6570\u7684\u5feb\u901f\u5e42\u7a0d\u5fae\u4fee\u4fee\u6539\u53ef\u4ee5\u4e86\u3002\n\n\u9012\u5f52\u5f62\u5f0f\uff1a\n```\nmat mut(mat a,long long t)\n{\n    if(t==1)\n        return a;\n    if(t==0)\n    {\n        mat b;\n        b.m=b.n=k+3;\n        memset(b.a,0,sizeof(b.a));\n        for(int i=1;i<=k+3;i++)\n            b.a[i][i]=1;\n        return b;\n    }\n    mat ans;\n    ans.m=ans.n=3;\n    memset(ans.a,0,sizeof(ans.a));\n    ans=mut(a,t/2);\n    ans=ans*ans;\n    if(t%2==1)\n        ans=ans*a;\n    return ans;\n}\n```\n$ while $ \u5faa\u73af\u5f62\u5f0f\uff1a\n```\nmat mut(mat a,long long t)\n{\n    mat ans;\n    memset(ans.a,0,sizeof(ans.a));\n    ans.m=ans.n=k+3;\n    for(int i=1;i<=k+3;i++)\n    \tans.a[i][i]=1;\n    while(t)\n    {\n        if(t&1)\n        \tans=ans*a;\n        a=a*a;\n        t=t/2;\n    }\n    return ans;\n}\n```\n\u4e0b\u9762\u7ed9\u51fa\u6700\u7ec8\u4ee3\u7801\uff1a\n```\n#include<cstring>\n#include<cstdio>\nusing namespace std;\nlong long yh[20][20];\nlong long n,k;\nstruct mat\n{\n\tlong long m,n;\n\tlong long a[101][101];\n\tmat operator * (mat& b)\n\t{\n\t\tmat c;\n\t\tmemset(c.a,0,sizeof(c.a));\n\t\tc.m=m;\n\t\tc.n=b.n;\n\t\tfor(int i=1;i<=m;i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tfor(int p=1;p<=n;p++)\n\t\t\t\t{\n\t\t\t\t\tc.a[i][j]+=(a[i][p]*b.a[p][j])%1000000007;\n\t\t\t\t\tc.a[i][j]%=1000000007;\n\t\t\t\t}\n\t\treturn c;\n\t}\n\tmat operator + (mat& b)\n\t{\n\t\tmat c;\n\t\tc.n=b.n;\n\t\tc.m=b.m;\n\t\tfor(int i=1;i<=m;i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tc.a[i][j]=a[i][j]+b.a[i][j];\n\t\treturn c;\n\t}\n};\nlong long yhsj(long long x,long long y)\n{\n\tif(!yh[x][y])\n\t{\n\t\tif(y==1||y==x)\n\t\t\tyh[x][y]=1;\n\t\telse\n\t\t\tyh[x][y]=yh[x-1][y-1]+yh[x-1][y];\n\t}\n\treturn yh[x][y];\n}\nvoid nb(mat& a,long long k)\n{\n\ta.m=a.n=k+3;\n\tmemset(a.a,0,sizeof(a.a));\n\ta.a[k+3][1]=1;\n\ta.a[k+3][k+3]=2;\n\tfor(int i=1;i<=k+1;i++)\n\t\tfor(int j=1;j<=i;j++)\n\t\t\ta.a[k+3-j][k+3-i]=yhsj(i,j);\n\tfor(int i=2;i<=k+2;i++)\n\t\ta.a[i][1]=a.a[i][k+3]=a.a[i][2];\n}\nvoid nbnb(mat& a,long long k)\n{\n\tmemset(a.a,0,sizeof(a.a));\n\ta.m=1;\n\ta.n=k+3;\n\tfor(int i=1;i<=k+3;i++)\n\t\ta.a[1][i]=1;\n}\nmat mut(mat a,long long t)\n{\n\tif(t==1)\n\t\treturn a;\n\tif(t==0)\n\t{\n\t\tmat b;\n\t\tb.m=b.n=k+3;\n\t\tmemset(b.a,0,sizeof(b.a));\n\t\tfor(int i=1;i<=k+3;i++)\n\t\t\tb.a[i][i]=1;\n\t\treturn b;\n\t}\n\tmat ans;\n\tans.m=ans.n=3;\n\tmemset(ans.a,0,sizeof(ans.a));\n\tans=mut(a,t/2);\n\tans=ans*ans;\n\tif(t%2==1)\n\t\tans=ans*a;\n\treturn ans;\n}\nint main()\n{\n\tscanf(\"%lld%lld\",&n,&k);\n\tmat ans;\n\tnb(ans,k);\n\tmat op;\n\tnbnb(op,k);\n\tmat num=mut(ans,n-1);\n\tnum=op*num;\n\tprintf(\"%lld\",num.a[1][1]);\n\treturn 0;\n}\n```\n~~\u4e0d\u6127\u662f\u6211\uff0c\u6700\u7ec8\u4ee3\u7801\u6b63\u597d\u6253\u4e86100\u884c\u3002~~\n\n\u672c\u4eba\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\uff0c\u6b22\u8fce\u5404\u4f4d\u5927\u4f6c\u6307\u51fa\u6211\u7684\u9519\u8bef\u3002",
        "postTime": 1614306052,
        "uid": 400201,
        "name": "Wuyanru",
        "ccfLevel": 7,
        "title": "P5364 [SNOI2017]\u793c\u7269"
    },
    {
        "content": "\u5168\u4e16\u754c\u90fd\u662f\u77e9\u9635\u5feb\u901f\u5e42\u3002\u3002\u3002\n\n\u6211\u6839\u672c\u5c31\u6ca1\u5f80\u8fd9\u4e2a\u5730\u65b9\u60f3\uff0c\u7ed3\u679c\u8fd8\u60f3\u51fa\u6765\u4e86\uff0c\u800c\u4e14\u78be\u4e86\u6807\u7b97\u3002\u3002\u3002\n\n\u5176\u5b9e$k$\u53ef\u4ee5\u52a0\u5f3a\u5230$5\\times 10^3,$\uff08rqy\u52a0\u5f3a\u5230\u4e86$2\\times10^7$...\uff09\n\n\n\u76f4\u63a5\u9012\u63a8\u4e0d\u5c31\u7ed3\u675f\u4e86\u5417\uff1f\u4e3a\u4ec0\u4e48\u8981\u77e9\u9635\u3002\u3002\u3002\n\n\u8bbe\u6570\u5217\u4e3a$c$,$\\text{sum}_i=\\sum_{i=1}^nc_i$\n\n$$\\therefore \\text{sum}_i=2\\text{sum}_{i-1}+i^k$$\n\n$$\\frac {\\text{sum}_i}{2^i}=\\frac {\\text{sum}_{i-1}}{2^{i-1}}+\\frac {i^k}{2^i}$$\n\n\u8bbe\n\n$$a_i=\\frac {\\text{sum}_i}{2^i}$$\n\n$$\\therefore a_i=a_{i-1}+\\frac {i^k}{2^i}$$\n\n$$a_i=\\sum_{j=1}^i\\frac {j^k}{2^j}$$\n\n\u8bbe\n\n$$F_i=\\sum_{j=1}^n\\frac {j^i}{2^j}$$\n\n$$F_i-\\frac 12F_i=\\sum_{j=1}^n\\frac {j^i}{2^j}\\ -\\sum_{j=1}^n\\frac {j^{i}}{2^{j+1}}$$\n\n$$F_i-\\frac 12F_i=\\sum_{j=0}^{n-1}\\frac {(j+1)^i}{2^{j+1}}\\ -\\sum_{j=1}^n\\frac {j^{i}}{2^{j+1}}$$\n\n$$\\frac 12F_i=\\frac 12+\\sum_{j=1}^{n-1}\\frac {(j+1)^i-j^i}{2^{j+1}}\\ -\\frac{n^i}{2^{n+1}}$$\n\n\u7531\u4e8c\u9879\u5f0f\u5b9a\u7406\n\n$$\\frac 12F_i=\\frac 12+\\sum_{j=1}^{n-1}\\frac{\\sum_{d=1}^{i}C_i^{d}j^{i-d}}{2^{j+1}}\\ -\\frac{n^i}{2^{n+1}}$$\n\n$$\\frac 12F_i=\\frac 12+\\sum_{d=1}^{i}C_i^{d}\\sum_{j=1}^{n-1}\\frac {j^{i-d}}{2^{j+1}}\\ -\\frac{n^i}{2^{n+1}}$$\n\n$$F_i=1+\\sum_{d=1}^{i}C_i^{d}\\sum_{j=1}^{n-1}\\frac {j^{i-d}}{2^{j}}\\ -\\frac{n^i}{2^{n}}$$\n\n$$F_i=1+\\sum_{d=1}^{i}C_i^{d}(F_{i-d}-\\frac {n^{i-d}}{2^{n}})\\ -\\frac{n^i}{2^{n}}$$\n\n$O(k^2\\log_2n)$\u6216\u8005$O(k^2)$\u9012\u63a8\u5c31\u597d\u4e86\uff0c\u521d\u59cb\u6761\u4ef6\n\n$$F_0=\\sum_{j=1}^n\\frac 1{2^j}={1-(\\frac 12)^n}$$\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n$O(k^2\\log_2n)$\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ljc 1000000007\nusing namespace std; \ninline ll read(){\n    ll x=0,f=1;char ch=getchar();\n    while (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}\n    while (isdigit(ch)){x=(x<<1)+(x<<3)+ch-48;ch=getchar();}\n    return x*f;\n}\ninline ll fast_pow(ll a,ll b,ll p){\n    ll t=1;a%=p;\n    while (b){\n        if (b&1) t=t*a%p;\n        b>>=1;a=a*a%p;\n    }\n    return t;\n}\nll n,k,F[12],C[12][12];\nsigned main(){\n\tn=read(),k=read();\n\tC[0][0]=1;\n\tll inv2=fast_pow(2,ljc-2,ljc);\n\tfor (int i=1;i<=k;i++){\n\t\tC[i][0]=1;\n\t\tfor (int j=1;j<=k;j++){\n\t\t\tC[i][j]=(C[i-1][j]+C[i-1][j-1])%ljc;\n\t\t}\n\t}\n\tF[0]=(1-fast_pow(inv2,n,ljc)+ljc)%ljc;\n\tfor (int i=1;i<=k;i++){\n\t\tF[i]=(1-fast_pow(n,i,ljc)*fast_pow(inv2,n,ljc)%ljc+ljc)%ljc;\n\t\tfor (int d=1;d<=i;d++){\n\t\t\tF[i]=(F[i]+C[i][d]*(F[i-d]-fast_pow(n,i-d,ljc)*fast_pow(inv2,n,ljc)%ljc+ljc)%ljc)%ljc;\n\t\t}\n\t}\n\tll An=fast_pow(2,n,ljc)*(F[k])%ljc;\n\tF[0]=(1-fast_pow(inv2,n-1,ljc)+ljc)%ljc;\n\tfor (int i=1;i<=k;i++){\n\t\tF[i]=(1-fast_pow(n-1,i,ljc)*fast_pow(inv2,n-1,ljc)%ljc+ljc)%ljc;\n\t\tfor (int d=1;d<=i;d++){\n\t\t\tF[i]=(F[i]+C[i][d]*(F[i-d]-fast_pow(n-1,i-d,ljc)*fast_pow(inv2,n-1,ljc)%ljc+ljc)%ljc)%ljc;\n\t\t}\n\t}\n\tll An1=fast_pow(2,n-1,ljc)*(F[k])%ljc;\n\tprintf(\"%lld\",(An-An1+ljc)%ljc);\n\treturn 0;\n}\n```\n\n$O(k^2)$\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ljc 1000000007\nusing namespace std; \ninline ll read(){\n    ll x=0,f=1;char ch=getchar();\n    while (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}\n    while (isdigit(ch)){x=(x<<1)+(x<<3)+ch-48;ch=getchar();}\n    return x*f;\n}\ninline ll fast_pow(ll a,ll b,ll p){\n    ll t=1;a%=p;\n    while (b){\n        if (b&1) t=t*a%p;\n        b>>=1;a=a*a%p;\n    }\n    return t;\n}\nll n,k,F[12],C[12][12],N[13];\nsigned main(){\n\tn=read(),k=read();\n\tC[0][0]=1;\n\tll inv2=fast_pow(2,ljc-2,ljc);\n\tll inv2n=fast_pow(inv2,n,ljc),inv2n1=fast_pow(inv2,n-1,ljc);\n\tfor (int i=1;i<=k;i++){\n\t\tC[i][0]=1;\n\t\tfor (int j=1;j<=k;j++){\n\t\t\tC[i][j]=(C[i-1][j]+C[i-1][j-1])%ljc;\n\t\t}\n\t}\n\tF[0]=(1-fast_pow(inv2,n,ljc)+ljc)%ljc;\n\tN[0]=1;\n\tfor (int i=1;i<=k;i++) N[i]=N[i-1]*(n%ljc)%ljc;\n\tfor (int i=1;i<=k;i++){\n\t\tF[i]=(1-fast_pow(n,i,ljc)*fast_pow(inv2,n,ljc)%ljc+ljc)%ljc;\n\t\tfor (int d=1;d<=i;d++){\n\t\t\tF[i]=(F[i]+C[i][d]*(F[i-d]-N[i-d]*inv2n%ljc+ljc)%ljc)%ljc;\n\t\t}\n\t}\n\tll An=fast_pow(2,n,ljc)*(F[k])%ljc;\n\tF[0]=(1-fast_pow(inv2,n-1,ljc)+ljc)%ljc;\n\tfor (int i=1;i<=k;i++) N[i]=N[i-1]*((n-1+ljc)%ljc)%ljc;\n\tfor (int i=1;i<=k;i++){\n\t\tF[i]=(1-fast_pow(n-1,i,ljc)*fast_pow(inv2,n-1,ljc)%ljc+ljc)%ljc;\n\t\tfor (int d=1;d<=i;d++){\n\t\t\tF[i]=(F[i]+C[i][d]*(F[i-d]-N[i-d]*inv2n1%ljc+ljc)%ljc)%ljc;\n\t\t}\n\t}\n\tll An1=fast_pow(2,n-1,ljc)*(F[k])%ljc;\n\tprintf(\"%lld\",(An-An1+ljc)%ljc);\n\treturn 0;\n}\n```",
        "postTime": 1557719232,
        "uid": 20309,
        "name": "Fading",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "Upd:\u56e0\u4e3a\u6392\u7248\u4e0d\u6574\u9f50\u88ab\u9000\u4e86\uff0c\u6240\u4ee5\u91cd\u65b0\u6392\u7248\u4e00\u4e0b\n\n\u4eca\u5929\u96c6\u8bad\u7684\u65f6\u5019\uff0c\u795e\u4ed9\u6559\u7ec3\u7ed9\u6211\u4eec\u8bb2\u4e86\u8fd9\u9053\u9898\uff0c\u7136\u540e\u81ea\u5df1\u8bfe\u540e\u770b\u7740PPT\u624b\u63a8\u4e86\u4e00\u4e0b\u5f0f\u5b50\uff0c\u7136\u540e\u5c31~~\u6284~~\u505a\u51fa\u6765\u4e86QwQ\n\n\u9996\u5148\u5206\u6790\uff0c\u8fd9\u4e00\u9898\u795e\u4ed9\u8bb2\u9898\u4eba\u544a\u8bc9\u6211\u4eec\u7528\u500d\u589e\u505a= =\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u6837\u4f8b\uff0c\uff08k=2\uff09\uff0c\u6709\n\n$1=1^2$\n\n$5=1+2^2$\n\n$15=2\\times1^2+1\\times2^2+3^2$\n\n$37=4\\times1^2+2\\times2^2+1\\times3^2+4^2$\n\n$83=8\\times1^2+4\\times2^2+2\\times3^2+1\\times4^2+5^2$\n\n\u89c2\u5bdf\u6bcf\u4e00\u4e2a\u5e73\u65b9\u9879\u524d\u9762\u7684\u7cfb\u6570\uff0c\u6709\u6ca1\u6709\u53d1\u73b0\u4ec0\u4e48\u89c4\u5f8b\uff1f\n\n\u4e8e\u662f\uff0c\u5bf9\u4e8e\u4efb\u610f\u7684ans\uff0c\u6211\u4eec\u6709\n\n$$ans=n^k+\\sum_{i=1}^{n-1}2^{n-1-i}i^k$$\n\n\u628a\u91cc\u9762\u7684$2^{n-1}$\u63d0\u51fa\u6765\uff0c\u5c31\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\n\n$$ans=n^k+2^{n-1}\\sum_{i=1}^{n-1}(\\frac{1}{2})^ii^k$$\n\n\u4e3a\u4e86\u5f0f\u5b50\u770b\u8d77\u6765\u7b80\u6d01\uff0c\u597d\u770b\uff0c\u6211\u4eec\u4ee4R=$\\frac{1}{2}$\uff0c\u6709\n\n$$ans=n^k+2^{n-1}\\sum_{i=1}^{n-1}R^ii^k$$\n\n\u7136\u540e\u53c8\u662f\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u5206\u6790\u7ed3\u8bba\uff0c\u6211\u4eec\u4ee4\n\n$$f(n,k)=\\sum_{i=1}^{n}R^ii^k$$\n\n\u4e8e\u662f\u6709\n\n$$\\begin{aligned}f(n+1,k)&=\\sum_{i=1}^{n+1}R^ii^k\\\\ &=\\sum_{i=1}^{n}R^ii^k+R^{n+1}(n+1)^k\\end{aligned} $$\n\n\n\u7136\u540e\u6211\u4eec\u518d\u6765\u8003\u8651\u600e\u4e48\u500d\u589e\uff0c\u9996\u5148\uff0c\u500d\u589e\u4e00\u5b9a\u8981\u8003\u8651$f(2n,k)$\u4e0e$f(n)$\u4e4b\u95f4\u7684\u5173\u7cfb,\u6709\n\n\n$$\\begin{aligned}f(2n,k)&=\\sum^{2n}_{i=1}R^ii^k\\\\ &=\\sum^n_{i=1}R^ii^k+\\sum_{i=n+1}^{2n}R^ii^k\\\\ &=f(n,k)\\ \\ +\\sum_{i=n+1}^{2n}R^ii^k\\\\ &=f(n,k)\\ \\ +\\ \\sum_{i=1}^{n}R^{n+i}(n+i)^k\\end{aligned}$$\n\n\u6839\u636e\u795e\u5947\u7684\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u53ef\u4ee5\u628a$(n+i)^k$\u62c6\u5f00\n\n\u5373\n\n$$\\begin{aligned}f(2n,k)&=f(n,k)+\\sum_{i=1}^{n}R^{n+i}(n+i)^k\\\\ &=f(n,k)+\\sum_{i=1}^{n}R^{n+i}\\sum^k_{j=0}(^k_j)n^{k-j}i^j\\end{aligned}$$\n\n(\u8fd9\u91cc\u4e0d\u61c2\u7684\u8bf7\u81ea\u884c\u767e\u5ea6\uff0c\u6211\u4e5f\u662f\u767e\u5ea6\u5957\u516c\u5f0f23333)\n\n\u968f\u540e\uff0c\u6211\u4eec\u628a\u7b2c\u4e00\u4e2a$\\sum$\u91cc\u7684\u5f0f\u5b50\u5316\u7b80\uff0c\u5e76\u4e14\u4e3a\u4e86\u53d1\u73b0\u89c4\u5f8b\uff0c\u6211\u4eec\u4ea4\u6362\u4e24\u4e2a$\\sum$\u7684\u987a\u5e8f,\u6709\n\n$$\\begin{aligned}f(2n,k)&=f(n,k)+\\sum_{i=1}^{n}R^{n+i}\\sum^k_{j=0}(^k_j)n^{k-j}i^j\\\\ &=f(n,k)+R^n\\sum_{i=1}^{n}R^{i}\\sum^k_{j=0}(^k_j)n^{k-j}i^j\\\\ &=f(n,k)+R^n\\sum^k_{j=0}(^k_j)n^{k-j}\\sum_{i=1}^{n}R^{i}i^j\\end{aligned}$$\n\n\u53d1\u73b0\u6ca1\u6709\uff0c\u540e\u9762\u7684$\\sum_{i=1}^nR^ii^j$\u6709\u6ca1\u6709\u5f88\u773c\u719f\u7684\u611f\u89c9\uff1f\u6ca1\u6709\uff1f\u90a3\u4e48\u8bf7\u770b\u770b\u4e0a\u6587\u4e2d\u5bf9$f(n,k)$\u7684\u5b9a\u4e49\n\n---\n\n$$\u2234f(2n,k)=f(n,k)+R^n\\sum_{j=0}^k(^k_j)n^{k-j}f(n,j)$$\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u628a$f(n,k)$\u548c$f(2n,k)$\u626f\u4e0a\u4e86\u5173\u7cfb\uff0c\u518d\u4e71\u641e\u4e00\u901a\uff0c\u5c31\u53ef\u4ee5A\u6389\u8fd9\u4e00\u9898\u4e86\uff01\n\n\u4ee3\u7801(\u4ee3\u7801\u4e2d\u7684\u5b9a\u4e49\u4e0e\u4e0a\u6587\u7684\u89e3\u91ca\u4e0d\u5b8c\u5168\u76f8\u540c)\n```\n#include<bits/stdc++.h>\n#define pii pair<int,int>\n#define int long long\n#define rep(a,b,c) for(register int a=b;a<=c;a++)\nusing namespace std;\nconst int Mod=1e9+7;\nint read()\n{\n\tint x=0,f=0;\n\tchar ch=0;\n\twhile(!isdigit(ch))f|=(ch=='-'),ch=getchar();\n\twhile(isdigit(ch))(x*=10)+=(ch^48),ch=getchar();\n\treturn f?-x:x;\n}\nconst int R=(Mod+1)>>1;\ninline int ksm(int x,int y)//\u5feb\u901f\u5e42\n{\n\tint res=1;\n\tx%=Mod;\n\twhile(y)\n\t{\n\t\tif(y&1)res=res*x%Mod;\n\t\ty>>=1,x=x*x%Mod;\n\t}\n\treturn res;\n}\nmap<pii,int> M;//\u8bb0\u5fc6\u5316\nint fac[22],inv[22];//\u5feb\u901f\u6c42\u7ec4\u5408\u6570\ninline int C(int x,int y)//\u6c42\u7ec4\u5408\u6570\u516c\u5f0f\n{\n\treturn fac[x]*inv[y]%Mod*inv[x-y]%Mod;\n}\nint f(int n,int k)\n{\n\tif(n==0) return 0;\n\tif(n==1) return R;\n\tif(M.count(pii(n,k))) return M[pii(n,k)];//\u8bb0\u5fc6\u5316\u4f18\u5316\n\tif(n&1)\n\t{\n\t\tint res=f(n-1,k);\n\t\tres=(res+1LL*ksm(R,n)*ksm(n,k))%Mod;\n\t\treturn M[pii(n,k)]=res;\n\t}\n\tn>>=1;//\u500d\u589e\n\tint res=f(n,k),cur=0;//\u500d\u589e\u52a0\u901f\n\trep(j,0,k)\n\t\tcur=(cur+1LL*C(k,j)*ksm(n,k-j)%Mod*f(n,j))%Mod;\n\tres=(res+1LL*cur*ksm(R,n))%Mod;\n\treturn M[pii(n<<1,k)]=res;\n}\n\ninline void Init()//\u9884\u5904\u7406\n{\n\tfac[0]=1;\n\trep(i,1,20) fac[i]=1LL*fac[i-1]*i%Mod;\n\tinv[1]=1;\n\trep(i,2,20) inv[i]=1LL*(Mod-Mod/i)*inv[Mod%i]%Mod;\n\tinv[0]=1;\n\trep(i,1,20) inv[i]=1LL*inv[i]*inv[i-1]%Mod;\n}\nsigned main()\n{\n\tint n,k;\n\tInit();\n\tn=read(),k=read();\n\tint ans=(ksm(n,k)+1LL*ksm(2,n-1)*f(n-1,k))%Mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;//QwQ\u5c31\u8fd9\u6837\u5b50\u5566\n}\n```\n\n$\\LaTeX$\u771f\u597d\u7528233333\n",
        "postTime": 1562921682,
        "uid": 58399,
        "name": "\u72f8\u72f8\u517b\u7684\u654f\u654f",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "# P5364 [SNOI2017]\u793c\u7269\n\n\u3010\u9898\u76ee\u5927\u610f\u3011\n\n\u6570\u5217 $\\{a\\}$ \u6ee1\u8db3\n$$\na_i=\n\\begin{cases}\n1 & i=1\\\\\na_i+s_{i-1}+i^K&\\text{otherwise}\n\\end{cases}\n$$\n\u5176\u4e2d\uff0c$s_i$ \u662f $\\{a\\}$ \u7684\u524d $i$ \u9879\u548c\uff0c$K$ \u662f\u7ed9\u5b9a\u5e38\u6570\uff0c\u6c42 $\\{a\\}$ \u7684\u7b2c $N$ \u9879\u3002\n\n\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\uff0c$N\\le10^{18},K\\le10$\u3002\n\n---\n\n\u6ce8\u610f\u5230\u6570\u636e\u8303\u56f4\u4e2d $N\\le10^{18}$\uff0c\u53ef\u4ee5\u731c\u6d4b\u672c\u9898\u53ef\u80fd\u662f\u4f7f\u7528\u77e9\u9635\u4e58\u6cd5\u4f18\u5316\u6570\u5217\u7684\u9012\u63a8\u3002\u4f46\u89c2\u5bdf\u9012\u63a8\u5f0f\u53ef\u4ee5\u53d1\u73b0\uff0c\u672c\u9898\u7684\u9012\u63a8\u548c\u9879\u6570\u6709\u5173\uff0c\u4e0d\u662f\u4e00\u4e2a\u7ebf\u6027\u9012\u63a8\u3002\u7136\u800c\u6570\u636e\u8303\u56f4\u6446\u5728\u8fd9\uff0c\u5982\u679c\u4e0d\u662f\u77e9\u9635\u4f18\u5316\u9012\u63a8\u7684\u8bdd\uff0c\u90a3\u4e48\u5e76\u4e0d\u662f\u5f88\u597d\u505a\uff0c\u6240\u4ee5\u7ee7\u7eed\u89c2\u5bdf\u9012\u63a8\u7684\u6027\u8d28\u3002\n\n\u53ef\u4ee5\u6ce8\u610f\u5230 $K\\le10$\uff0c\u6240\u4ee5\u4e0d\u59a8\u628a $i^0,i^1,\\ldots,i^K$ \u8fde\u540c $s_i,a_i$ \u4e00\u8d77\u653e\u8fdb\u77e9\u9635\u91cc\uff0c\u518d\u901a\u8fc7\u4e00\u4e9b\u6570\u5b66\u65b9\u6cd5\u4f7f\u5f97\u9012\u63a8\u53d8\u6210\u7ebf\u6027\u9012\u63a8\u3002\u5b9e\u9645\u4e0a\uff0c\u4ece\u7b2c $i$ \u9879\u9012\u63a8\u5230\u7b2c $i+1$ \u9879\u65f6\uff0c\u6709\n$$\na_{i+1}=a_i+s_i+(i+1)^K\n$$\n\u6700\u540e\u4e00\u9879\u53ef\u4ee5\u8ba9\u6211\u4eec\u8054\u60f3\u5230\u4e00\u4e2a\u7ec4\u5408\u6570\u5b66\u7684\u5b9a\u7406\uff0c\u4e8c\u9879\u5f0f\u5b9a\u7406\u3002\u5373\u5bf9\u4e8e\u4e00\u4e2a\u591a\u9879\u5f0f $(ax+by)^n$\uff0c\u5b83 $x^p y^q$ \u9879\u7684\u7cfb\u6570\u4e3a $C_n^pa^pb^q$\u3002\u5728\u6b64\u4e0d\u518d\u5c55\u5f00\u8bf4\u660e\uff0c\u6709\u7591\u95ee\u53ef\u4ee5\u53c2\u8003 [P1313](https://www.luogu.com.cn/problem/P1313)\u3002\u8fd9\u6837\u7684\u8bdd\uff0c$(i+1)^K$ \u5c31\u53ef\u4ee5\u901a\u8fc7\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u5c06\u9012\u63a8\u65f6\u5404\u9879\u7684\u7cfb\u6570\u90fd\u6c42\u51fa\u6765\u653e\u8fdb\u8f6c\u79fb\u77e9\u9635\u91cc\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u6027\u9012\u63a8\u3002\u8fd9\u5c31\u662f\u672c\u9898\u7684\u4e3b\u8981\u601d\u8def\u3002\n\n\u5373\u4f7f\u6709\u4e86\u4e3b\u8981\u601d\u8def\uff0c\u4f46\u5728\u5b9e\u73b0\u65f6\u53ef\u80fd\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f $a_i$ \u548c $s_i$ \u4e0d\u80fd\u540c\u65f6\u8f6c\u79fb\uff0c\u4e5f\u5c31\u4e0d\u80fd\u76f4\u63a5\u6309\u5b9a\u4e49\u5f0f\u9012\u63a8\u3002\u90a3\u4e48\u4e0d\u59a8\u6539\u53d8\u4e00\u4e0b $s_i$ \u7684\u5b9a\u4e49\uff0c\u628a\u5b83\u6539\u4e3a $\\{a\\}$ \u7684\u524d $i-1$ \u9879\u548c\uff0c\u8fd9\u6837\u5728\u8ba1\u7b97 $a_i$ \u65f6\uff0c\u8ba1\u7b97 $s_{i-1}$ \uff08\u524d $i-2$ \u9879\u548c\uff09\u52a0\u4e0a $a_{i-1}$ \u518d\u52a0\u4e0a\u9879\u6570\u5e73\u65b9\u5373\u53ef\u3002\u5c06 $s_i$ \u5b9a\u4e49\u6539\u53d8\u540e\uff0c\u5c31\u80fd\u907f\u514d $s_i$ \u548c $a_i$ \u4e0d\u540c\u65f6\u66f4\u65b0\u4ece\u800c\u5bfc\u81f4\u65e0\u6cd5\u8ba1\u7b97\u7684\u95ee\u9898\u3002\u540c\u6837\u7684\u539f\u56e0\uff0c\u5728\u77e9\u9635\u4e2d\u8bb0\u5f55 $(i+1)^K$\uff0c\u65b9\u4fbf $a_i$ \u7684\u8f6c\u79fb\u3002\u5982\u679c\u4e0d\u592a\u597d\u7406\u89e3\u53ef\u4ee5\u624b\u52a8\u6a21\u62df\u4e00\u4e0b\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u6709\u4e86\u521d\u59cb\u77e9\u9635\n$$\n\\begin{bmatrix}\n0&0&1&1&\\cdots&1\n\\end{bmatrix}\n$$\n\u7136\u540e\u901a\u8fc7\u751f\u6210\u8f6c\u79fb\u77e9\u9635\uff0c\u5bf9\u8f6c\u79fb\u77e9\u9635\u8fdb\u884c\u5feb\u901f\u5e42\u5373\u53ef\u5f97\u5230\u7b54\u6848\u3002\u9644\u4e0a\u4e3b\u7a0b\u5e8f\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=1e9+7;\nstruct matrix{\n\tint a[20][20],h,w;\n\tint* operator [](int i){\n\t\treturn a[i];\n\t}\n\tmatrix(int hei, int wid){\n\t\tmemset(a,0,sizeof(a));\n\t\th=hei;w=wid;\n\t}\n};\nmatrix operator *(matrix a, matrix b){\n\tmatrix ret(a.h,b.w);\n\tfor (int i=0;i<=ret.h;i++){\n\t\tfor (int j=0;j<=ret.w;j++){\n\t\t\tfor (int k=0;k<=a.w;k++){\n\t\t\t\t(ret[i][j]+=a[i][k]*b[k][j])%=mod;\n\t\t\t}\n\t\t} \n\t}\n\treturn ret;\n}\nmatrix m_qpow(matrix a, int k){\n\tmatrix ret=a;k--;\n\twhile (k){\n\t\tif (k%2) ret=ret*a;\n\t\ta=a*a;k/=2;\n\t}\n\treturn ret;\n} \n// \u8fd9\u91cc\u7684\u8f6c\u79fb\u77e9\u9635\u5199\u4e86\u4e00\u4e2a\u751f\u6210\u5668\nint zy[15][15]={\n{0,0,0,0,0,0,0,0,0,0,0,0,0,0},\n{0,1,1,0,0,0,0,0,0,0,0,0,0,0},\n{0,1,1,0,0,0,0,0,0,0,0,0,0,0},\n{0,0,0,1,1,1,1,1,1,1,1,1,1,1},\n{0,0,0,0,1,2,3,4,5,6,7,8,9,10},\n{0,0,0,0,0,1,3,6,10,15,21,28,36,45},\n{0,0,0,0,0,0,1,4,10,20,35,56,84,120},\n{0,0,0,0,0,0,0,1,5,15,35,70,126,210},\n{0,0,0,0,0,0,0,0,1,6,21,56,126,252},\n{0,0,0,0,0,0,0,0,0,1,7,28,84,210},\n{0,0,0,0,0,0,0,0,0,0,1,8,36,120},\n{0,0,0,0,0,0,0,0,0,0,0,1,9,45},\n{0,0,0,0,0,0,0,0,0,0,0,0,1,10},\n{0,0,0,0,0,0,0,0,0,0,0,0,0,1}};\nsigned main(){\n\tint n,k;cin>>n>>k;\n\tmatrix tmp(13,13);\n\tfor (int i=0;i<=13;i++){\n\t\tfor (int j=0;j<=13;j++){\n\t\t\ttmp[i][j]=zy[i][j];\n\t\t}\n\t}\n\ttmp[k+3][2]=1;\n\tmatrix ans(1,13);\n\tans[1][1]=ans[1][2]=0;\n\tfor (int i=3;i<=13;i++) ans[1][i]=1;\n\tans=ans*m_qpow(tmp,n);\n\tcout<<ans[1][2];\n\treturn 0;\n}\n```\n\n\u751f\u6210\u8f6c\u79fb\u77e9\u9635\u7684\u751f\u6210\u5668\u5982\u4e0b\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=1e9+7;\nint frac[11],inv[11];\nint qpow(int a, int k){\n\tif (k==1) return a;\n\tif (k==0) return 1;\n\tint ret=qpow(a,k/2);\n\tif (k%2) (ret*=ret*a%mod)%=mod;\n\telse (ret*=ret)%=mod;\n\treturn ret;\n}\nint C(int n, int m){\n\tint tmp=inv[m]*inv[n-m]%mod;\n\tint ans=frac[n]*tmp%mod;\n\treturn ans;\n} // \u4e8b\u5b9e\u4e0a\uff0c\u672c\u9898\u6570\u636e\u8303\u56f4\u5f88\u5c0f\uff0c\u4e0d\u9700\u8981\u9006\u5143\nint a[20][20];\nsigned main(){\n\ta[1][1]=1;a[2][1]=1;frac[0]=1;\n\ta[2][2]=1;a[1][2]=1;a[3][3]=1;\n\tfor (int i=1;i<=10;i++){\n\t\tfrac[i]=frac[i-1]*i%mod; \n\t}\n\tfor (int i=0;i<=10;i++){\n\t\tinv[i]=qpow(frac[i],mod-2);\n\t} \n\tfor (int i=4;i<=13;i++){\n\t\tint n=i-3;\n\t\tfor (int j=0;j<=n;j++){\n\t\t\tint tmp=C(n,j);\n\t\t\ta[j+3][i]=tmp; \n\t\t}\n\t}\n\tcout<<\"int zy[15][15]={\";\n\tfor (int i=0;i<=13;i++){\n\t\tif (i>0) cout<<\",\";\n\t\tcout<<\"\\n{\";\n\t\tfor (int j=0;j<=13;j++){\n\t\t\tif (j>0) cout<<\",\";\n\t\t\tcout<<a[i][j];\n\t\t}\n\t\tcout<<\"}\";\n\t}\n\tcout<<\"};\";\n\treturn 0;\n}\n```\n\n",
        "postTime": 1653471673,
        "uid": 574568,
        "name": "Dr_Gilbert",
        "ccfLevel": 7,
        "title": "P5364 [SNOI2017]\u793c\u7269"
    },
    {
        "content": "\u76f4\u63a5\u5f00\u95e8\u89c1\u5c71\u3002\n\n\u5173\u6ce8$N$\u8303\u56f4\u9ad8\u8fbe$10^{18}$\uff0c\u53c8\u7c7b\u4f3c\u6570\u5b66\u9012\u63a8\uff0c\u8003\u8651\u77e9\u9635\u5feb\u901f\u5e42\u6c42\u89e3\u3002\n\n\u6240\u4ee5\u600e\u4e48\u6c42\uff1f\n\n\u6211\u4eec\u5173\u6ce8$N$\u7684\u6bcf\u4e2a\u53d6\u503c\u7684\u7ed3\u679c\u7684\u6570\u5b66\u8868\u793a\u3002\n\n$N=1$\u65f6\uff0c$ans=1*1^K$\n\n$N=2$\u65f6\uff0c$ans=1*1^K+1*2^K$\n\n$N=3$\u65f6\uff0c$ans=2*1^K+1*2^K+1*3^K$\n\n$N=4$\u65f6\uff0c$ans=4*1^K+2*2^K+1*3^K+1*4^K$\n\n\u2026\u2026\n\n\u867d\u7136\u6709\u89c4\u5f8b\uff0c\u53ef\u4ee5\u5199\u51fa\u901a\u9879\uff0c\u4f46\u77e9\u9635\u9012\u63a8\u7684\u65b9\u6cd5\u4e0d\u660e\u663e\u3002\n\n\u8003\u8651\u524d\u7f00\u548c\u3002\n\n$N=1$\u65f6\uff0c$sum=1*1^K$\n\n$N=2$\u65f6\uff0c$sum=2*1^K+1*2^K$\n\n$N=3$\u65f6\uff0c$sum=4*1^K+2*2^K+1*3^K$\n\n$N=4$\u65f6\uff0c$sum=8*1^K+4*2^K+2*3^K+1*4^K$\n\n\u63d0\u51fa\u7cfb\u6570\uff1a\n\n\t1\n\t2 1\n\t4 2 1\n\t8 4 2 1\n\t\u2026\u2026\n\n\u53ef\u4ee5\u53d1\u73b0\u9012\u63a8\u7684\u6570\u5b66\u5f0f\uff1a\n\n$sum[N]=2sum[N-1]+N^K$\n\n\u6b63\u786e\u6027\u53ef\u8bc1\u660e\uff0c\u6b64\u5904\u4e0d\u52a0\u8d58\u8ff0\u3002\n\n\u627e\u51fa\u9012\u63a8\u5f0f\u4e4b\u540e\uff0c\u6211\u4eec\u601d\u8003\u5982\u4f55\u8f6c\u5316\u4e3a\u77e9\u9635\u3002\n\n\u53d1\u73b0$2sum[N-1]$\u8f83\u4e3a\u597d\u89e3\u51b3\uff0c\u96be\u70b9\u5728$(N-1)^K$\u8f6c\u79fb\u5230$N^K$\u3002\n\n\u5148\u8f6c\u6362\u4e3a$N^K$\u8f6c\u79fb\u5230$(N+1)^K$\n\n\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00$(N+1)^K$\u3002\n\n\u6709\n\n$$\n(N+1)^K = \\tbinom{K}{0} N^K+ \\tbinom{K}{1} N^{K-1}+ \\tbinom{K}{2} N^{K-2}+...+ \\tbinom{K}{K} N^0\n$$\n\n\u8003\u8651\u5b58\u50a8\u5f53\u524d$N$\u4ece$0$\u5230$K$\u6b21\u65b9\u7684\u503c\uff0c\u7136\u540e\u5728\u8f6c\u79fb\u65f6\u6839\u636e$sum[N]=2sum[N-1]+N^K$\u5bfc\u5165$N^K$\n\n\u540c\u65f6\u5229\u7528\u63d0\u524d\u5b58\u50a8\u597d\u7684\u6768\u8f89\u4e09\u89d2\u8fdb\u884c\u6b21\u65b9\u7684\u8f6c\u79fb\u3002\n\n\u4e3e\u51fa$K=3$\u65f6\u7684\u8f6c\u79fb\u77e9\u9635\uff1a\n\n\t1 1 1 1 0\n    0 1 2 3 0\n    0 0 1 3 0\n    0 0 0 1 1\n    0 0 0 0 2\n    \n\u6bcf\u6b21\u76f8\u4e58\u65f6\uff0c\u5de6\u4fa7\u77e9\u9635\n\n$[N^0,N^1,N^2,N^3,sum[N-1]]$\n\n\u76f8\u4e58\u7ed3\u679c\n\n$[N^0,N^0+N^1,N^0+2N^1+N^2,N^0+3N^1+3N^2+N^3,2sum[N-1]+N^3]$\n\n\u5f97\n\n$[(N+1)^0,(N+1)^1,(N+1)^2,(N+1)^3,sum[N]]$\n\n\u9012\u63a8\u5f97\u5230\u5b8c\u7f8e\u89e3\u51b3\u3002\n\n\u77e9\u9635\u5feb\u901f\u5e42\u5373\u53ef\u3002",
        "postTime": 1562586401,
        "uid": 103732,
        "name": "smarthehe",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 [SNOI2017]\u793c\u7269"
    },
    {
        "content": "\u9898\u610f\u7b80\u5316\n\n\u6c42\u6570\u5217 $f(x)=\\sum_{i=1}^{x-1}f(i)+x^k$ \u7684\u7b2c $n$ \u9879\u3002\n\n\u5316\u7b80\u67ff\u5b50\u5f97 $f(x)=2 \\times f(x-1)+x^k-(x-1)^k$\n\n\u89c2\u5bdf\u9898\u76ee\u53d1\u73b0\uff0c$n$ \u7684\u8303\u56f4\u9650\u5236\u4e86 $O(n^2)$ \u6a21\u62df\u548c $O(n)$ \u7ebf\u6027\u9012\u63a8\u7684\u505a\u6cd5\u3002\n\n\u8003\u8651\u77e9\u9635\u4e58\u6cd5\u3002\n\n\u6211\u4eec\u8bbe\u72b6\u6001\u77e9\u9635\u4e3a\uff1a\n\n$\\begin{bmatrix} \n\tf_x \n\\\\  x^k\n\\\\  x^{k-1}\n\\\\  x^{k-2}\n\\\\  ...\n\\\\  x^2\n\\\\  x\n\\\\  1\n\\end{bmatrix}\\quad$\n\n\u76ee\u6807\u72b6\u6001\u662f\uff1a\n\n$\\begin{bmatrix} \n\tf_{x+1} \n\\\\  (x+1)^k\n\\\\  (x+1)^{k-1}\n\\\\  (x+1)^{k-2}\n\\\\  ...\n\\\\  (x+1)^2\n\\\\  x+1\n\\\\  1\n\\end{bmatrix}\\quad$\n\n\u8003\u8651\u8f6c\u79fb\n\n\u6211\u4eec\u53d1\u73b0\n\n$x^k$ \u8f6c\u79fb\u5230 $(x+1)^k$ \u662f\u5173\u952e\u4e00\u6b65\uff0c\u8981\u7528\u5230\u4e8c\u9879\u5f0f\u7cfb\u6570\u3002\n\n\u4e8e\u662f\u6211\u4eec\u901a\u8fc7\u6768\u8f89\u4e09\u89d2\u9884\u5904\u7406\u51fa\u6240\u6709\u8981\u7528\u5230\u7684\u4e8c\u9879\u5f0f\u7cfb\u6570\u3002\n\n```cpp\nyh[0][0]=1;\nfor(int i=0;i<k+1;i++){\n\tyh[i][0]=1;\n\tfor(int j=1;j<=i;j++)yh[i][j]=(yh[i-1][j-1]+yh[i-1][j])%md;\n}\n```\n\u6ce8\u610f\uff1a$yh[i][j] = C_{i}^j$\n\n\u6700\u540e\u6211\u4eec\u901a\u8fc7\u63a8\u5bfc\u5f97\u51fa\u4e86\u72b6\u6001\u8f6c\u79fb\u77e9\u9635\uff1a\n\n$\\begin{bmatrix} \n\t2 & 0 & C_k^{k-1} & ... & C_k^0\n\\\\\t0 & C_k^k & C_k^{k-1} & ... & C_k^0\n\\\\  0 & 0 & C_{k-1}^{k-1} & ... & C_{k-1}^0\n \\\\  ...& ...&...&...&...\n \\\\\t0&0&0&...&1\n\\end{bmatrix}\\quad$\n\n\u8fd9\u91cc\u7ed9\u51fa\u5173\u952e\u6784\u9020\u77e9\u9635\u7684\u4ee3\u7801\uff0c\u65b9\u4fbf\u5404\u4f4d\u8bfb\u8005\u8c03\u8bd5\uff1a\n\n```cpp\nm[1][1]=2;\nfor(int i=2;i<=k+2;i++)m[1][i]=yh[k][i-2];\nfor(int i=1;i<=k;i++){\n\tfor(int j=i;j<=k+1;j++)m[i+1][j+1]=yh[k-i+1][k-j+1];\t\n}\nm[1][2]=0;\nm[k+2][k+2]=1;\n```\n\u5b8c\u7ed3\u6492\u82b1\n\n\u7ba1\u7406\u5458\u540c\u5fd7\u5ba1\u6838\u9898\u89e3\u8f9b\u82e6\u4e86\n",
        "postTime": 1657782697,
        "uid": 285617,
        "name": "\u9ed1\u5f71\u6d1e\u4eba",
        "ccfLevel": 5,
        "title": "P5364 [SNOI2017]\u793c\u7269 \u9898\u89e3"
    },
    {
        "content": "\u6211\u4eec\u5982\u679c\u8bbe\u7acb $s_n$ \u8868\u793a\u524d $n$ \u4e2a\u4eba\u9001\u7684\u793c\u7269\u603b\u6570\uff0c\u4e14 $s_1 = 1$ \uff0c\u56e0\u4e3a\u7b2c $i$ \u4e2a\u4eba\u7684\u9001\u7684\u793c\u7269\u4e2a\u6570\u4e3a $s_{i-1} +i ^k$ \u90a3\u4e48\u5f88\u5feb\u53ef\u4ee5\u5199\u51fa\u50cf\u4e0b\u9762\u4e00\u6837\u7684\u5f0f\u5b50\uff1a\n\n$$ s_i=2\\times s_{i-1} + i^k$$\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u4e0a\u8ff0\u5f0f\u5b50\u4e2d $s_i $ \u4e0e $s_{i-1}$ \u5982\u679c\u60f3\u8981\u8fdb\u884c\u77e9\u9635\u4e58\u6cd5\u7684\u8bdd\uff0c\u662f\u5f88\u5bb9\u6613\u7684\uff0c\u4f46\u5173\u952e\u5728\u4e8e $i^k$ \u7684\u9012\u63a8\u3002\u6211\u4eec\u662f\u8981\u4ece $i^k$ \u63a8\u5230 $(i+1)^k$ \u3002\n\n\u90a3\u4e48\u6211\u4eec\u53c8\u60f3\u5230\u4e86\u4e8c\u9879\u5f0f\u5b9a\u7406\uff1a\n\n$$(i+1)^k=\\sum_{j=0}^k\\binom{k}{j}x^j$$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u6765\u63a8\u51fa\u5f0f\u5b50\uff0c\u4fdd\u5b58\u4e0b\u4e8c\u9879\u5f0f\u7cfb\u6570\u7684\u503c\uff0c\u6c42\u6cd5\u53ef\u4ee5\u4f7f\u7528\u6768\u8f89\u4e09\u89d2\uff0c\u7136\u540e\u5728\u505a\u4e24\u6b21\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u7b54\u6848\u5373\u4e3a $s_n-s_{n-1}$\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int  M = 20;\nint mod = 1e9+7;\nint m;\nstruct Martix{\n\tint a[M][M];\n\tMartix(){memset(a,0,sizeof(a));}\n\tMartix operator *(const Martix &b){\n\t\tMartix res;\n\t\tfor(int i=1;i<=m;i++){\n\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\tfor(int k=1;k<=m;k++){\n\t\t\t\t\tres.a[i][j]= (res.a[i][j]+a[i][k]*b.a[k][j])%mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n};\nMartix ans,b,e;\nMartix power(int n,Martix ans,Martix bit){\n\twhile(n){\n\t\tif(n&1){\n\t\t\tans=(ans*bit);\n\t\t}\n\t\tbit=(bit*bit);\n\t\tn>>=1;\n\t}\n\treturn ans;\n}\nint n,kt;\nsigned main(){\n\tcin>>n>>kt;\n\tm=kt+2;\n\tfor(int i=1;i<=m;i++) ans.a[1][i]=1;\n\tfor(int j=2;j<=m;j++){\n\t\tb.a[2][j]=b.a[j][j]=1;\n\t\tfor(int i=3;i<j;i++){\n\t\t\tb.a[i][j]=(b.a[i][j-1]+b.a[i-1][j-1])%mod;\n\t\t}\n\t}\n\tb.a[1][1]=2;\n\tfor(int i=2;i<=m;i++) b.a[i][1]=b.a[i][m];\n\tMartix s1=power(n-1,ans,b);\n\tint ans1=0;\n\tfor(int i=1;i<=m;i++) ans1=(ans1+s1.a[i][1])%mod;\n\tMartix s2=power(n-2,ans,b);\n\tint ans2=0;\n\tfor(int i=1;i<=m;i++) ans2=(ans2+s2.a[i][1])%mod;\n\tcout<<((ans1-ans2)%mod+mod)%mod;\n    return 0;\n}\n````",
        "postTime": 1622383353,
        "uid": 206021,
        "name": "Pitiless0514",
        "ccfLevel": 7,
        "title": "\u793c\u7269\u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u8ba1\u7b97\u6bcf\u4e2a\u7334\u5b50\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u6253\u4e2a\u8868\uff1a\n```\n1 1 2 4 8 16 32 ...\n```\n\u53ef\u4ee5\u770b\u51fa\u7b2c $ i $ \u4e2a\u7334\u5b50\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f $ i^k \\times 2^{n-i-1} $\uff0c\u7279\u522b\u5730\uff0c\u6700\u540e\u4e00\u53ea\u7334\u5b50\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f $ n^k $\u3002\n\n\u5199\u6210\u67ff\u5b50\uff1a\n$$ n^k+\\sum_{i=1}^{n-1}i^k \\times 2^{n-i-1} $$\n$$ n^k+2^{n-1} \\times (\\sum_{i=1}^{n-1}i^k \\times (2^{-1})^i) $$\n\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u51fa $ \\sum_{i=1}^{n-1}i^k \\times (2^{-1})^i $ \u5373\u53ef\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u67ff\u5b50\u662f CODECHEF qpolysum\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n~~\u8fd8\u662f\u628a\u505a\u6cd5\u5199\u4e00\u904d\u5427~~\n\nqpolysum \u548c\u672c\u9898\u6709\u4e0d\u540c\u4e4b\u5904\uff0c\u5373 $ i $ \u4ece $ 0 $ \u5f00\u59cb\uff0c\u8bb0\u5f97\u51cf\u6389\u3002~~\u4e0d\u8fc7\u8981\u51cf\u6389\u7684\u662f\u4e00\u4e2a0\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e\u6ca1\u51cf~~\n$$ S(n)=\\sum_{i=0}^{n-1}i^k \\times m^i $$\n\u5728\u672c\u9898\u4e2d\u76f8\u5f53\u4e8e $ m=2^{-1} $\u3002\n\n\u4e0d\u8fc7\u8fd9\u4e2a\u505a\u6cd5\u662f\u731c\u4e86\u4e00\u4e2a\u5f88\u5947\u602a\u7684\u7ed3\u8bba\uff0c\u5e76\u4e14\u505a\u6cd5\u6765\u81ea\u6821OJ\u8ba8\u8bba\u533a\uff08\n\n\u6211\u4eec\u731c $ S(n)=m^n G(n) - G(0) $\uff0c\u5176\u4e2d $ G(x) $ \u662f\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $ k $ \u6b21\u7684\u591a\u9879\u5f0f\u3002\n\n\u8bc1\u660e\u53ef\u4ee5\u770b[\u8fd9\u4e2ablog](https://blog.csdn.net/qq_35649707/article/details/79595192) ~~\u6211\u624d\u4e0d\u544a\u8bc9\u4f60\u662f\u6211\u770b\u4e0d\u61c2~~\n\n\u7136\u540e\u5dee\u5206\u4e00\u4e0b\uff1a\n$$ S(n)-S(n-1)=m^n G(n) - m^{n-1} G(n-1) = (n-1)^k \\times m^{n-1} $$\n$$ G(n) = \\frac {(n-1)^k + G(n-1)} m $$\n\u8bbe $ G(0)=x $\uff0c\u90a3\u4e48\u6211\u4eec\u5728 $ n $ \u4e3a\u4efb\u4f55\u503c\u7684\u65f6\u5019\u7528 $ x $ \u8868\u793a $ G(n) $\u3002\n\n\u56e0\u4e3a\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u6b21\u6570\u6700\u9ad8\u4e3a $ k $\uff0c\u800c\u5bf9\u4e00\u4e2a $ k $ \u6b21\u591a\u9879\u5f0f\u5dee\u5206 $ k+1 $ \u6b21\u540e\u4e3a $ 0 $\uff0c\u6240\u4ee5\u6211\u4eec\u628a $ G(x) $ \u5dee\u5206 $ k+1 $ \u6b21\u540e\u5f97\u5230\uff1a\n$$ \\sum_{i=0}^{k+1} (-1)^{i+1} \\binom {k+1} i G(k+1-i) = 0 $$\n\u6211\u4eec\u53ef\u4ee5\u7528 $ x $ \u8868\u793a $ G(0) \\sim G(k+1) $\uff0c\u7136\u540e\u89e3\u4e00\u4e2a\u4e00\u5143\u4e00\u6b21\u65b9\u7a0b\u5373\u53ef\u5f97\u5230 $ x $\uff0c\u5e26\u5165\u53ef\u5f97\u5230 $ G(1) \\sim G(k+1) $ \u7684\u503c\u3002\n\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u8ba1\u7b97 $ G(n) $ \u4e86\uff0c\u7b54\u6848\u5c31\u662f $ m^nG(n)-G(0) $\u3002\n\n$ i^k $ \u53ef\u4ee5\u4f7f\u7528\u7ebf\u6027\u7b5b\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u662f $ O(k+\\log n) $\u3002\n\ncode:\n```cpp\n#include<cstdio>\nconst int M=15,mod=1e9+7;\nint k,n1,n2,top,x[M],y[M],idk[M],pri[M],pos[M],fac[M],ifac[M];long long n;\nint q[M],p[M],G[M];\ninline int Add(const int&a,const int&b){\n\treturn a+b>=mod?a+b-mod:a+b;\n}\ninline int Del(const int&a,const int&b){\n\treturn b>a?a-b+mod:a-b;\n}\ninline int C(const int&n,const int&m){\n\treturn 1ll*fac[n]*ifac[m]%mod*ifac[n-m]%mod;\n}\ninline int pow(int a,int b){\n\tint ans=1;\n\tfor(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;\n\treturn ans;\n}\ninline void sieve(const int&M){\n\tregister int i,j,x;idk[1]=1;\n\tfor(i=2;i<=M;++i){\n\t\tif(!pos[i])pri[++top]=i,pos[i]=top,idk[i]=pow(i,k);\n\t\tfor(j=1;j<=top&&(x=i*pri[j])<=M;++j){\n\t\t\tidk[x]=1ll*idk[i]*idk[pri[j]]%mod;\n\t\t\tif((pos[x]=j)==pos[i])break;\n\t\t}\n\t}\n}\ninline int Inter(const int&n){\n\tregister int i,tmp,ans=0;\n\tq[0]=p[k+2]=1;\n\tfor(i=1;i<=k+1;++i)q[i]=1ll*q[i-1]*Del(n,i)%mod;\n\tfor(i=k+1;i>=1;--i)p[i]=1ll*p[i+1]*Del(n,i)%mod;\n\tfor(i=1;i<=k+1;++i){\n\t\tif(k+1-i&1)ans=Del(ans,1ll*1ll*q[i-1]*p[i+1]%mod*G[i]%mod*ifac[i-1]%mod*ifac[k+1-i]%mod);\n\t\telse ans=Add(ans,1ll*1ll*q[i-1]*p[i+1]%mod*G[i]%mod*ifac[i-1]%mod*ifac[k+1-i]%mod);\n\t}\n\treturn ans;\n}\nsigned main(){\n\tregister int i,X=0,Y=0;\n\tfac[0]=fac[1]=ifac[0]=ifac[1]=1;\n\tscanf(\"%lld%d\",&n,&k);sieve(k+1);x[0]=1;y[0]=0;n1=n%mod;n2=n%(mod-1);\n\tfor(i=1;i<=k+1;++i)x[i]=Add(x[i-1],x[i-1]),y[i]=Add(y[i-1],idk[i-1]),y[i]=Add(y[i],y[i]);\n\tfor(i=2;i<=k+1;++i)fac[i]=1ll*fac[i-1]*i%mod,ifac[i]=1ll*(mod-mod/i)*ifac[mod%i]%mod;\n\tfor(i=2;i<=k+1;++i)ifac[i]=1ll*ifac[i-1]*ifac[i]%mod;\n\tfor(i=0;i<=k+1;++i){\n\t\tif(i&1){\n\t\t\tX=Add(X,1ll*C(k+1,i)*x[k+1-i]%mod);\n\t\t\tY=Add(Y,1ll*C(k+1,i)*y[k+1-i]%mod);\n\t\t}\n\t\telse{\n\t\t\tX=Del(X,1ll*C(k+1,i)*x[k+1-i]%mod);\n\t\t\tY=Del(Y,1ll*C(k+1,i)*y[k+1-i]%mod);\n\t\t}\n\t}\n\tG[0]=mod-1ll*Y*pow(X,mod-2)%mod;\n\tfor(i=1;i<=k+1;++i)G[i]=Add(1ll*x[i]*G[0]%mod,y[i]);\n\tprintf(\"%d\",Add(1ll*Del(1ll*pow(500000004,n2)*Inter(n1)%mod,G[0])*pow(2,n2-1)%mod,pow(n1,k)));\n}\n```",
        "postTime": 1628148422,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u8bba \u5dee\u5206+\u62c9\u683c\u6717\u65e5\u63d2\u503c P5364\u9898\u89e3"
    },
    {
        "content": "### Description\n\n$ A_n=(\\sum_{i=1}^{n-1} A_i)+n^k,A_1=1 $\uff0c\u6c42\u51fa $ A_n \\bmod MOD $ \u3002\n\n### Solution\n\n\u6211\u4eec\u8bb0 $ B_i=\\sum_{i=1}^{n} A_i $\u200b ,\u6240\u4ee5 $ A_n=B_{n-1}+n^k $\u200b , $ B_n=B_{n-1}+An=2\\times B_{n-1}+n^k $\u200b \u3002\n\n\u770b\u5230\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u6211\u4eec\u53ea\u8981\u6c42\u51fa $ B_n $ \u4e0e $ B_{n-1} $\u200b \u540e\u518d\u76f8\u51cf\u5c31\u53ef\u4ee5\u4e86\uff0c\u95ee\u9898\u662f $ B_n $ \u5982\u4f55\u5feb\u901f\u6c42\u3002\n\n\u9996\u5148\u4ece $ k=1 $ \u5f00\u59cb\n$$\nf(i)-2\\times f(i-1)=i\n$$\n\n$$\nf(i-1)-2\\times f(i-2)=i-1\n$$\n\n\u4e24\u4e2a\u5f0f\u5b50\u76f8\u51cf\u53ef\u5f97 $ f(i)-3\\times f(i-1)+2\\times f(i-2)=1 $\n\n\u6240\u4ee5 $ f(i)=3\\times f(i-1)-2\\times f(i-2)+1 $ \n\n\u7136\u540e\u5b9e\u8d28\u662f $ i=(i-1)+1 $\n\n\u7136\u540e\u8303\u56f4\u6269\u5927\u5c31\u662f\u8981\u6c42 $ n^k=x_1\\times (n-1)^k+x_2\\times (n-2)^k...x_{k} \\times (n-k)^k+x_{k+1} $\u200b\u200b\n\n\u90a3\u4e48\u6709 \n\n$ x_1+x_2+...+x_k=1 $\u200b\n\n$ x_1+2\\times x_2+...k\\times x_k=0 $\u200b\n\n$ x_1+2^2\\times x_2+...+k^2\\times x_k=0 $\u200b\u200b \n\n$ ... $\n\n$ x_1+2^{k-1} \\times x_2+...+k^{k-1} \\times x_k=0 $\u200b\n\n$ (-1)^k\\times x_1+(-2)^k \\times x_2+...+(-k)^k \\times x_k+x_{k+1}=0 $\u200b\n\n\u7136\u540e\u4f60\u53ef\u4ee5\u7528\u9ad8\u65af\u6d88\u5143\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u66b4\u529b\u7b97\u51fa\u524d\u51e0\u7ec4\u89e3\uff0c\u53d1\u73b0\u5982\u679c\u662f $ n^k $ \uff0c\u5219 $ x_i=C_{k}^{i}\\times (-1)^{i-1} $,\u6211\u4eec\u63a8\u51fa\u4e86 $ x_i $ \uff0c\u5c31\u53ef\u4ee5\u77e5\u9053 $ f(n-1) $ \u7684\u7cfb\u6570\u662f $ 2+x_1 $ \uff0c\u56e0\u4e3a $ (n-1)^k $ \u53ef\u4ee5\u7528 $ f(i-1)-2f(i-2) $ \u4ee3\u66ff\uff0c\u800c $ f(n-i) (i>1) $ \u7684\u7cfb\u6570\u4e3a $ x_i-2\\times x_{i-1} $ ,\u56e0\u4e3a\u542b$ (n-i)^k=f(n-i)-2f(n-i-1) $\u200b\u200b , $ (n-i+1)^{k}=f(n-i+1)-2f(n-i) $\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5c06\u8fd9\u4e24\u6570\u4e4b\u548c\u8f6c\u5316\u6210\uff1a\n$$\nx_i\\times (n-i)^k+x_{i-1}\\times(n-i+1)^k=x_1\\times f(n-i)-x_1\\times 2\\times f(n-i-1)+x_{i-1}\\times f(n-i+1)-2\\times x_{i-1} \\times f(n-i)\n$$\n\u6240\u4ee5\u7cfb\u6570\u662f $ x_i-2\\times x_{i-1} $ \uff0c\u77e5\u9053\u4e86\u7cfb\u6570\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u77e9\u9635\u5feb\u901f\u5e42\u52a0\u901f\u9012\u63a8\u4e86\uff0c\u6784\u5efa\u77e9\u9635\u5c31\u4e0d\u7528\u8bf4\u4e86\u5427\u3002\n\n### Code\n\n```c++\n#include<bits/stdc++.h>\nusing namespace std;\ninline long long read()\n{\n  long long x=0,f=1;char ch=getchar();\n  while(!isdigit(ch)&&ch!='-')ch=getchar();\n  if(ch=='-')f=-1,ch=getchar();\n  while(isdigit(ch))x=(x<<1)+(x<<3)+ch-'0',ch=getchar();\n  return x*f;\n}\nlong long pow(long long x,long long y,long long p)\n{\n\tlong long ans=1;\n\tfor (;y;y>>=1,x=x*x % p)\n\t\tif (y&1) ans=ans*x % p;\n\treturn ans;\n}\nlong long gcd(long long x,long long y)\n{\n\tif (y==0) return x;\n\tlong long ans=gcd(y,x % y);return ans;\n}\nlong long N,x,y,X[101000],A[1010][1010],B[1010][1010],c[1010][1010],C[1010][1010],a[10100],f[10100],n,K,MOD,i,j;\nvoid MulB()\n{\n\tint i,j,k;\n\tfor (i=1;i<=K;i++)\n\t   for (j=1;j<=K;j++)\n\t       c[i][j]=0;\n\tfor (k=1;k<=K;k++)\n\t    for (i=1;i<=K;i++)\n\t       for (j=1;j<=K;j++)\n\t           c[i][j]=(c[i][j]+B[i][k]*B[k][j]) % MOD;\n\tfor (i=1;i<=K;i++)\n\t   for (j=1;j<=K;j++)\n\t        B[i][j]=c[i][j];\n}\nvoid MulA()\n{\n\tint i,j,k;\n\tfor (i=1;i<=K;i++)\n\t   for (j=1;j<=K;j++)\n\t       c[i][j]=0;\n\tfor (k=1;k<=K;k++)\n\t    for (i=1;i<=1;i++)\n\t       for (j=1;j<=K;j++) \n\t            {\n\t            //\tcout<<i<<\" \"<<j<<\" \"<<\" \"<<i<<\" \"<<k<<\" \"<<k<<\" \"<<j<<endl;\n\t           c[i][j]=(c[i][j]+B[k][j]*A[i][k]) % MOD;\n\t          }\n\tfor (i=1;i<=1;i++)\n\t   for (j=1;j<=K;j++)\n\t        A[i][j]=c[i][j];\n}\nint main()\n{\n\t//ios::sync_with_stdio(0);cin.tie();cout.tie();\n\tn=read();K=read();MOD=1e9+7;\n\t//\u9884\u5904\u7406 \n\tC[0][0]=1;\n\tfor (i=1;i<=11;i++)\n\t      {\n\t      \t C[i][0]=1;C[i][i]=1;\n\t      \t for (j=1;j<i;j++)\n\t      \t    C[i][j]=C[i-1][j]+C[i-1][j-1];\n\t      }\n\tfor (i=1;i<=K;i++) if (i % 2==1) X[i]=C[K][i];else X[i]=-C[K][i];\n\tfor (i=1;i<=K;i++) X[K+1]=(X[K+1]+pow(i,K,MOD)*X[i]) % MOD;\n\tif (K % 2==0) X[K+1]=-X[K+1];\n\ta[1]=2+X[1];\n\tfor (i=2;i<=K;i++) a[i]=-2*X[i-1]+X[i];\n\ta[K+1]=-2*X[K];a[K+2]=X[K+1];\n//\tfor (i=1;i<=K+2;i++) cout<<X[i]<<\" \";\n//\tcout<<endl;\n\tfor (i=2;i<=K+2;i++) a[i]=a[i] % MOD;\n\t//\u6784\u9020\u77e9\u9635\n\tf[1]=1;\n\tfor (i=2;i<=K+2;i++) f[i]=(2*f[i-1]+pow(i,K,MOD)) % MOD;\n\tfor (i=1;i<=K+1;i++) A[1][i]=f[K+1-i+1];\n\tA[1][K+2]=1;\n\tfor (i=1;i<=K+1;i++) B[i][1]=a[i];\n\tB[K+2][1]=a[K+2];\n\tfor (i=2;i<=K+1;i++) B[i-1][i]=1;\n\tB[K+2][K+2]=1;\n\t//\u77e9\u9635\u5feb\u901f\u5e42\n\tK+=2;\n/*2\tfor (i=1;i<=K;i++)\n\t     {\n\t     \tfor (j=1;j<=K;j++)\n\t     \t   cout<<B[i][j]<<\" \";\n\t     \tcout<<endl;\n\t\t }*/\n\tif (n<=K-1)\n\t    {\n\t    \tprintf(\"%lld\\n\",f[n]-f[n-1]);return 0;\n\t\t }\n\tN=n;\n\tn--;\n\tn-=(K-1);\n\tfor (;n;n>>=1,MulB())\n\t       if (n&1) MulA();\n\tx=A[1][1] % MOD;/*cout<<x<<endl;*/y=pow(N % MOD,K-2,MOD);\n\tprintf(\"%lld\\n\",((x+y) % MOD+MOD) % MOD);\nreturn 0;\n}\n```\n",
        "postTime": 1627444720,
        "uid": 508480,
        "name": "Albedo",
        "ccfLevel": 0,
        "title": "SNOI2017\u793c\u7269\u9898\u89e3"
    },
    {
        "content": "**\uff08\u6ce8\uff1a\u672c\u9898\u89e3\u5e9f\u8bdd\u6709\u70b9\u591a\uff0c\u56e0\u4e3a\u6211\u53ea\u662f\u60f3\u8bb2\u5f97\u80fd\u8ba9\u6211\u8fd9\u79cd\u5c0f\u83dc\u9e21\u90fd\u80fd\u660e\u767d\uff0c\u6240\u4ee5\u5927\u4f6c\u53ef\u4ee5\u8df3\u8fc7\uff0c\u56e0\u4e3a\u4e0a\u9762\u6709\u8bb8\u591a\u66f4\u7b80\u6d01\u7684\u9898\u89e3\uff09**\n\n### \u9898\u76ee\u63cf\u8ff0\n\u7ed9\u5b9a\u6574\u6570 $n$ \u548c $k$ \uff0c\u5df2\u77e5\u6bcf\u4e2a\u4eba\u90fd\u4f1a\u7ed9\u6559\u7ec3\u4e0a\u8d21\u4e4b\u524d\u6240\u6709\u4eba\u5e26\u6765\u7684\u4e2a\u6570\u518d\u52a0\u4ed6\u7f16\u53f7\u7684 $k$ \u6b21\u65b9\u4e2a\u793c\u7269\uff0c\u6c42\u7b2c $n$ \u4e2a\u4eba\u8981\u7ed9\u6559\u7ec3\u591a\u5c11\u793c\u7269\u3002\n\n$n\\leq 10^{18}\\ \\ \\ k\\leq 10$\n\n### solution\n\u8bbe\u7b54\u6848\u4e3a $ans_n$ \uff0c**\u7a0d\u5fae\u6253\u6253\u8868**\uff0c\u5c31\u4f1a\u5f88\u5feb\u5199\u51fa20\u5206\u7684\u9012\u63a8\u5f0f\u4e86\u3002\n\n\u90a3\u5e72\u8106\u76f4\u63a5\u4ece20\u5206\u7684\u9012\u63a8\u5f0f\u5f00\u59cb\u8d70\u3002\uff08\u5e94\u8be5\u6ca1\u4eba\u4e0d\u4f1a20\u5206\u5427\u3002\u3002\uff09\n\n$$ans_n=2\\cdot ans_{n-1}+n^k$$\n\n\u4f46\u8fd9\u5e76\u4e0d\u597d\u770b\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u90a3\u4e2a\u7cfb\u65702\uff0c\u6240\u4ee5\uff1a\n\n$$\\frac{ans_n}{2^n}=\\frac{2\\cdot ans_{n-1}}{2^i}+\\frac{n^k}{2^n}$$\n\n\u7cfb\u6570\u4e00\u6d88\uff0c\u6f02\u6f02\u4eae\u4eae\u5730\u6362\u4e2a\u5143\uff1a\n\n$$num_n=num_{n-1}+\\frac{n^k}{2^n}$$\n\n$$\\Rightarrow num_n=\\sum_{i=1}^{n}\\frac{i^k}{2^i}$$\n\n\u4f46\u4e00\u770b $n$ \u7684\u8303\u56f4\uff0c\u7b97\u4e86\uff0c\u66f4\u6362\u4e00\u4e0b $num$ \u7684\u4e0b\u6807\uff1a\n\n$$\\Rightarrow num_k=\\sum_{i=1}^{n}\\frac{i^k}{2^i}$$\n\n\u5982\u679c\u60f3\u6c42\u548c\u5faa\u73af\u6362\u4e0b\u6765\u6210\u9012\u63a8\u5f0f\uff0c\u53c8\u770b\u5230 $i$ \u4e0a\u662f\u4e00\u4e2a\u56fa\u5b9a\u7684\u9ad8\u6b21\u5e42\uff08\u867d\u7136\u6700\u9ad8\u5c3110\uff09\uff0c\u5c31\u80fd\u7528\u4e8c\u6b21\u9879\u5b9a\u7406\uff0c\u4ece $i$ \u6574\u5230 $i+1$ \u3002\n\n$$\\Rightarrow num_k=\\sum_{i=0}^{n-1}\\frac{(i+1)^k}{2^{i+1}}$$\n\n$$\\Rightarrow num_k=\\frac{1}{2}+\\sum_{i=1}^{n-1}\\frac{(i+1)^k}{2^{i+1}}$$\n\n$$\\Rightarrow num_k=\\frac{1}{2}+\\sum_{i=1}^{n-1}\\frac{\\sum_{j=0}^{k}C_k^j\\cdot i^j}{2^{i+1}}$$\n\n$$\\Rightarrow num_k=\\frac{1}{2}+\\sum_{j=0}^{k}C_k^j\\sum_{i=1}^{n-1}\\frac{i^j}{2^{i+1}}$$\n\n$$\\Rightarrow num_k=\\frac{1}{2}+\\sum_{j=0}^{k}C_k^j(\\frac{num_j}{2}-\\frac{n^j}{2^{n+1}})$$\n\n\u6269\u5927\u4e24\u500d\uff0c\u7136\u540e\u53ef\u4ee5\u6d88\u53bb\u4e00\u4e2a $num_k$ \u3002\n\n$$\\Rightarrow 2\\cdot num_k=1+\\sum_{j=0}^{k}C_k^j(num_j-\\frac{n^j}{2^n})$$\n\n$$\\Rightarrow num_k=1-\\frac{n^k}{2^n}+\\sum_{j=0}^{k-1}C_k^j(num_j-\\frac{n^j}{2^n})$$\n\n\u6b64\u65f6\u5c31\u80fd\u9012\u63a8\u5566\uff08\u6ce8\uff1a\u6309\u539f\u5b9a\u4e49\u9884\u5904\u7406 $num_0$ \uff09\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(k^2\\log_2 n)$ \uff08\u6ce8\uff1a\u90a3\u4e00\u4e2a\u6570\u7ec4\u5b58\u4e00\u4e0b\u90a3\u4e9b\u6b21\u5e42\u5c31\u80fd $O(k^2+\\log_2 n)$ \u4e86\uff09\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int mod=1e9+7;\nll n,k,m,ans,c[12][12];\nll inv2,in,in_1,g[12],f[12];\ninline ll ksm(ll a,ll b){\n\tll tmp=1;\n\twhile(b){\n\t\tif(b&1)tmp=tmp*a%mod;\n\t\ta=a*a%mod;b>>=1;\n\t}\n\treturn tmp;\n}\nint main()\n{\n\tcin>>n>>k;m=n%mod;\n\tc[0][0]=1;inv2=ksm(2,mod-2);\n\tin_1=ksm(inv2,n-1),in=in_1*inv2%mod;\n\tf[0]=(mod+1-in)%mod;g[0]=1;\n\tfor(int i=1;i<=k;++i){\n\t\tc[i][0]=1;\n\t\tfor(int j=1;j<=k;++j)\n\t\tc[i][j]=(c[i-1][j]+c[i-1][j-1])%mod;\n\t\t\n\t\tg[i]=(g[i-1]*m)%mod;\n\t\tf[i]=(mod+1-in*g[i]%mod)%mod;\n\t\tfor(int j=1;j<=i;++j)\n\t\tf[i]=(f[i]+c[i][j]*(mod+f[i-j]-g[i-j]*in%mod)%mod)%mod;\n\t}\n\tans=ksm(2,n)*f[k]%mod;\n\tf[0]=(mod+1-in_1)%mod;m=(n-1)%mod;\n\tfor(int i=1;i<=k;++i)g[i]=(g[i-1]*m)%mod;\n\tfor(int i=1;i<=k;++i){\n\t\tf[i]=(mod+1-in_1*g[i]%mod)%mod;\n\t\tfor(int j=1;j<=i;++j)\n\t\tf[i]=(f[i]+c[i][j]*(mod+f[i-j]-g[i-j]*in_1%mod)%mod)%mod;\n\t}\n\tans=(mod+ans-ksm(2,n-1)*f[k]%mod)%mod;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n\u53ea\u6c42\u80fd\u5e2e\u52a9\u5230\u51e0\u4e2a\u4eba\u7f62\u3002\u3002",
        "postTime": 1622888153,
        "uid": 206024,
        "name": "Illusory_dimes",
        "ccfLevel": 7,
        "title": "P5364 [SNOI2017]\u793c\u7269 \u9898\u89e3"
    },
    {
        "content": "\u603b\u611f\u89c9\u6211\u7ed5\u4e86\u4e00\u5927\u5708\u5f2f\u8def......\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5364)\n\n---\n\n**\u3010\u5206\u6790\u3011**\n--\n\n\u8bbe $f_n$ \u8868\u793a\u7b2c $n$ \u4e2a\u670b\u53cb\u5e26\u6765\u7684\u793c\u7269\u4e2a\u6570\uff0c\u5219\u4e0d\u96be\u5199\u51fa\uff1a\uff08\u5b9a\u4e49 $f_0=0$ \uff09\n\n$\\displaystyle f_n=\\sum_{i=0}^{n-1}f_i+n^k$\n\n\u8bb0 $g_n=n^k$ \u4e0d\u96be\u5199\u51fa\u751f\u6210\u51fd\u6570\uff1a$F(x)={1\\over 1-x}\\cdot xF(x)+G(x)$\n\n$\\therefore 2F(x)={1\\over 1-2x}G(x)+G(x)$\n\n\u8bb0 $H(x)={1\\over 1-2x}G(x)$ \u5219 $2f_n=h_n+g_n$\n\n\u7531\u4e8e ${1\\over 1-2x}$ \u662f $\\{2^n\\}$ \u7684\u751f\u6210\u51fd\u6570\uff0c\u56e0\u6b64 $\\displaystyle h_n=\\sum_{i=0}^n g_i2^{n-i}=\\sum_{i=0}^n i^k2^{n-i}$\n\n\u8bb0 $\\displaystyle T_{n,k}=\\sum_{i=0}^n i^k2^{n-i}$\n\n\u5219 $\\displaystyle T_{n,k}=2T_{n,k}-T_{n,k}=\\sum_{i=0}^n i^k2^{n+1-i}-\\sum_{i=0}^n i^k2^{n-i}=2\\sum_{i=0}^{k-1}\\dbinom k i T_{n-1,i}-n^k$\n\n\u7531\u4e8e $k\\leq 10$ \u5f88\u5c0f\uff0c\u66b4\u529b\u9012\u5f52\u6c42\u89e3 $T_{n,k}$ \uff0c\u8fb9\u754c\u6761\u4ef6\u662f $\\displaystyle T_{n,0}=\\sum_{i=0}^n 2^{n-i}=2^{n+1}-1,T_{0,k}=0(k>0)$\n\n\u6c42\u89e3\u4e4b\u540e\uff0c\u5373\u53ef\u7b97\u51fa $f_n=2^{-1}\\cdot (h_n+g_n)=2^{-1}\\cdot (T_{n,k}+n^k)$\n\n---\n\n**\u3010\u4ee3\u7801\u3011**\n---\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int MOD=1e9+7,inv2=(MOD+1>>1);\nll C[16][16];\ninline ll fpow(ll a,ll x) { ll ans=1; for(a%=MOD;x;x>>=1,a=a*a%MOD) if(x&1) ans=ans*a%MOD; return ans; }\ninline ll T(ll n,ll k){\n    if(n==0) return 0;\n    if(k==0) return fpow(2,n+1)-1+MOD;\n    ll res=0;\n    for(int j=0;j<k;++j) res+=C[k][j]*T(n-1,j)%MOD;\n    res=res+res+MOD-fpow(n,k);\n    return res%MOD;\n}\ninline void pre(){\n    for(int i=0;i<=10;++i){\n        for(int j=i-1;j>=1;--j) C[i][j]=C[i-1][j-1]+C[i-1][j];\n        C[i][0]=C[i][i]=1;\n    }\n}\nint main(){\n    pre();\n    ll n,k;\n    cin>>n>>k;\n    cout<<inv2*(fpow(n,k)+T(n,k))%MOD;\n    return 0;\n}\n```",
        "postTime": 1615033861,
        "uid": 36031,
        "name": "JustinRochester",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P5364 [SNOI2017]\u793c\u7269"
    },
    {
        "content": "\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u6cd5\u8001\uff1a\u8fd9\u9898\u500d\u589e\uff1b\u6211\uff1a\uff1f\uff1f\uff1f\n\n\u83dc\u5230\u4e0d\u4f1a\u500d\u589e\uff0c\u7a9d\u89c9\u5f97\u77e9\u9635\u5feb\u901f\u5e42\u662f\u53ef\u4ee5\u505a\u7684\uff0c\u800c\u6cd5\u8001\u7684\u505a\u6cd5\u5341\u5206\u5de7\u5999\u5e76\u4e0d\u4f1aemm\n\n\u9996\u5148\u8003\u8651\u9012\u63a8\u5f0f\uff0c\u4ee4 $f_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u4eba\u7684\u793c\u7269\u6570\uff0c$a_i$ \u8868\u793a $i^k$\uff0c\u6613\u5f97\u67ff\u5b50\uff1a\n\n$$f_i=2\\times f_{i-1}+a_i$$\n\n\u90a3\u4e48\u8fd9\u4e2a\u4e1c\u897f\u600e\u4e48\u77e9\u9635\u5feb\u901f\u5e42\u5462\uff1f\u6709\u4e8c\u9879\u5f0f\u5b9a\u7406\u5982\u4e0b\uff1a\n\n$$(n+1)^k=\\sum_{i=0}^{k}\\binom{k}{i}n^{k-i}$$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u4e09\u89d2\u77e9\u9635\uff0c\u76f4\u63a5\u5feb\u901f\u5e42\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 1000005\n#define reg register\n#define inl inline\n#define ll long long\nusing namespace std;\nconst int Mod=1e9+7;\nll n;\nint K,C[15][15];\ninl int Add(reg int x,reg int y)\n{\n\treturn x+y>Mod?x+y-Mod:x+y;\n}\ninl int Del(reg int x,reg int y)\n{\n\treturn x-y<0?x-y+Mod:x-y;\n}\ninl int Mul(reg int x,reg int y)\n{\n\treturn 1ll*x*y%Mod;\n}\nstruct Matrix\n{\n\tint a[15][15];\n\tinl void Init()\n\t{\n\t\tmemset(a,0,sizeof(a));\n\t}\n\tfriend Matrix operator * (const Matrix &x,const Matrix &y)\n\t{\n\t\treg Matrix cnt;\n\t\tcnt.Init();\n\t\tfor(reg int i=0;i<K+3;i++)\n\t\t{\n\t\t\tfor(reg int j=0;j<K+3;j++)\n\t\t\t{\n\t\t\t\tfor(reg int k=0;k<K+3;k++) cnt.a[i][j]=Add(cnt.a[i][j],Mul(x.a[i][k],y.a[k][j]));\n\t\t\t}\n\t\t}\n\t\treturn cnt;\n\t}\n}T,ans;\ninl void Pow(reg ll x)\n{\n\tans=T;\n\tx--;\n\tfor(;x;x>>=1,T=T*T) if(x&1) ans=ans*T;\n}\nint main()\n{\n\tscanf(\"%lld %d\",&n,&K);\n\tC[0][0]=1;\n\tfor(reg int i=1;i<=K;i++)\n\t{\n\t\tC[i][0]=1;\n\t\tfor(reg int j=1;j<=i;j++) C[i][j]=Add(C[i-1][j-1],C[i-1][j]);\n\t}\n\tfor(reg int i=0;i<=K;i++)\n\t{\n\t\tfor(reg int j=0;j<=i;j++) T.a[i][j]=C[i][j];\n\t}\n\tfor(reg int i=0;i<=K;i++) T.a[K+1][i]=T.a[K+2][i]=C[K][i];\n\tT.a[K+1][K+2]=1;\n\tT.a[K+2][K+2]=2;\n\tPow(n);\n\tprintf(\"%d\\n\",ans.a[K+1][0]);\n\treturn 0;\n}\n```",
        "postTime": 1562837929,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "### 2020/02/11 upd\n\n\u6709\u51e0\u4e2a\u5f0f\u5b50\u5199\u9519\u4e86\u4fee\u4e86\u4e00\u4e0b\n\n\uff08\u597d\u50cf\u9898\u89e3\u754c\u9762\u7684\u5f0f\u5b50\u4f1a\u6302\uff0c\u5982\u679c\u9047\u5230\u4e86\u8bf7\u5728 [\u8fd9\u91cc](https://www.cnblogs.com/sun123zxy/p/luogu5364.html) \u6216\u8005 [\u5728Ta\u7684\u535a\u5ba2\u67e5\u770b](https://www.luogu.com.cn/blog/sun123zxy/solution-p5364) \uff09\n\n---\n\n### \u66b4\u641e\u901a\u9879\u516c\u5f0f\n\n\u849f\u84bb\u60f3\u4e86\u4e00\u4e0a\u5348\u5f04\u51fa\u6765\u4e2a$O(k^2)$\u7684\u7b97\u6cd5\n\n\u8fd9\u9053\u9898\u6bd4\u8f83\u88f8\uff0c\u5c31\u662f\u7529\u7ed9\u4f60\u4e2a\u9012\u63a8\u5f0f\u8ba9\u4f60\u6c42\u7b2c$n$\u9879\n$$\nA_1 = 1,A_n = \\sum_{i=1}^{n-1} A_i + n^k\n$$\n\n\u90a3\u9996\u5148\u6211\u4eec\u6765\u624b\u52a8\u6253\u4e2a\u8868qwq\n\n| $A_i$ \\ $i^k$ | $1^k$ | $2^k$ | $3^k$ | $4^k$ | $5^k$ | $6^k$ |\n| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |\n| $A_1$ | 1 |  |  |  |  |  | |\n| $A_2$ | 1 | 1 |  |  |  |  | |\n| $A_3$ | 2 | 1 | 1 |  |  |  | |\n| $A_4$ | 4 | 2 | 1 | 1 |  |  | |\n| $A_5$ | 8 | 4 | 2 | 1 | 1 |  | |\n| $A_6$ | 16 | 8 | 4 | 2 | 1 | 1 | |\n\n\u8868\u4e2d\u7b2c$i$\u884c\u7684\u7cfb\u6570\u4e58\u4e0a\u5bf9\u5e94\u5217\u6807\u540e\u7684\u548c\u5c31\u662f$A_i$\n\n\u4e8e\u662f\u6211\u4eec\u53d1\u73b0\u4e86\u8fd9\u4e00\u663e\u7136\u7684\u89c4\u5f8b\n\n$$\nA_1 = 1,A_n = 2 A_{n-1} + n^k - (n-1)^k\n$$\n\n\u6211\u4eec\u5c31\u975e\u5e38\u4f18\u79c0\u7684\u628a\u8fd9\u4e2a\u9012\u63a8\u5f0f\u5316\u7b80\u4e86:p\n\n~~\u7136\u800c\u8fd9\u5e76\u6ca1\u6709\u4ec0\u4e48\u5375\u7528~~\n\n\u4e0d\u8fc7\u770b\u5230\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u5c31\u603b\u611f\u89c9\u5b83\u6709\u4e2a\u901a\u9879\u516c\u5f0f\u4ec0\u4e48\u7684\u5427\uff0c\u6211\u4eec\u6765\u80e1\u4e71\u778e\u63a8\u4e00\u6ce2\n\n\u89c2\u5bdf\u9012\u63a8\u5f0f\uff0c\u53f3\u5f0f\u90a3\u5768$n^k - (n-1)^k$\u770b\u7740\u5c31\u6076\u5fc3\uff0c\u6211\u4eec\u60f3\u627e\u4e2a\u529e\u6cd5\u628a\u5b83\u6d88\u6389\uff0c\u4f7f\u5b83\u7684\u5f62\u5f0f\u53d8\u6210\u4e00\u4e2a\u7b49\u6bd4\u6570\u5217\uff0c\u8fd9\u6837\u901a\u9879\u516c\u5f0f\u5c31\u5bb9\u6613\u5f97\u5230\u4e86\n\n\u663e\u7136$n^k - (n-1)^k$\u662f\u4e00\u4e2a$k-1$\u6b21\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u6784\u9020\u6570\u5217$U$\u548c$k-1$\u6b21\u591a\u9879\u5f0f$B$\n\n$$\n\\begin{aligned}\nU_n = A_n + B(n) \\\\\nB(n) = \\sum_{i=0}^{k-1} b_i n^i\n\\end{aligned}\n$$\n\n\u5bf9\u6570\u5217$U$\u7684\u5b9a\u4e49\u5f0f\u79fb\u9879\u5f97\n\n$$\nA_n = U_n - B(n)\n$$\n\n\u5e26\u56de$A$\u7684\u9012\u63a8\u5f0f\uff0c\u5f97\n$$\n\\begin{aligned}\nU_n - B(n) = 2(U_{n-1} - B(n-1)) + n^k - (n-1)^k \\\\\nU_n = 2U_{n-1} + B(n) - 2B(n-1) + n^k - (n-1)^k\n\\end{aligned}\n$$\n\n\u6211\u4eec\u60f3\u8ba9$U_n=2U_{n-1}$\uff0c\u53ea\u9700\u4f7f\n\n$$\nB(n) - 2B(n-1) + n^k - (n-1)^k = 0\n$$\n\n\u5373\n$$\n- B(n) + 2B(n-1) = n^k - (n-1)^k\n$$\n\n\u73b0\u5728\u6211\u4eec\u8981\u6c42\u89e3\u591a\u9879\u5f0f$B$\uff0c\u8bd5\u7740\u5c06\u591a\u9879\u5f0f\u7684\u6bcf\u4e00\u9879\uff0c\u4e5f\u5c31\u662f$b_i$\uff0c\u90fd\u8868\u793a\u51fa\u6765\n\n\u5148\u770b\u53f3\u5f0f\uff0c\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00$(n-1)^k$\uff0c\u53f3\u5f0f\u53d8\u4e3a\n\n$$\n\\quad  n^k - \\sum_{i=0}^{k} C_k^i (-1)^{k-i} n^i\n$$\n\n\u63d0\u51fa\u548c\u5f0f\u4e2d\u7684$k$\u6b21\u9879\u4e0e$n^k$\u6d88\u6389\n\n$$\n= - \\sum_{i=0}^{k-1} C_k^i (-1)^{k-i} n^i\n$$\n\n\u518d\u6765\u770b\u5de6\u5f0f\uff0c\u5c06\u591a\u9879\u5f0f\u5c55\u5f00\u5f97\n\n$$\n- \\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{i=0}^{k-1} b_i (n-1)^i\n$$\n\n\u4e5f\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00$(n-1)^i$\n\n$$\n= - \\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{i=0}^{k-1} b_i \\sum_{j=0}^i C_i^j (-1)^{i-j} n^j\n$$\n\n\u8f6c\u6362\u679a\u4e3e\n\n$$\n\\begin{aligned}\n&= - \\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{i=0}^{k-1} \\sum_{j=0}^i  b_iC_i^j (-1)^{i-j} n^j \\\\\n&= - \\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{j=0}^{k-1} \\sum_{i=j}^{k-1}  b_iC_i^j (-1)^{i-j} n^j \\\\\n&= - \\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{i=0}^{k-1} \\{ \\sum_{j=i}^{k-1}  b_j C_j^i (-1)^{j-i} \\} n^i\n\\end{aligned}\n$$\n\n\uff08\u8fd9\u91cc\u5927\u62ec\u53f7\u53ea\u662f\u4e3a\u4e86\u6807\u660e\u7cfb\u6570\uff0c\u6ca1\u6709\u5b9e\u9645\u610f\u4e49\uff09\n\n\u73b0\u5728\u628a\u5de6\u53f3\u5f0f\u5408\u5728\u4e00\u8d77\u5199\n\n$$\n- \\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{i=0}^{k-1} \\{ \\sum_{j=i}^{k-1}  b_j C_j^i (-1)^{j-i} \\} n^i = - \\sum_{i=0}^{k-1} C_k^i (-1)^{k-i} n^i\n$$\n\n\u6d88\u6389\u8d1f\u53f7\n\n$$\n\\sum_{i=0}^{k-1} b_i n^i + 2 \\sum_{i=0}^{k-1} \\{ \\sum_{j=i}^{k-1}  b_j C_j^i (-1)^{j-i} \\} n^i = \\sum_{i=0}^{k-1} C_k^i (-1)^{k-i} n^i\n$$\n\n\u6240\u4ee5\n\n$$\nb_i + 2 \\sum_{j=i}^{k-1}  b_j C_j^i (-1)^{j-i} = C_k^i (-1)^{k-i}\n$$\n\n\u4e8e\u662f\u6211\u4eec\u975e\u5e38~~\u6109\u5feb~~\u8270\u96be\u7684\u5f97\u5230\u4e86$b_i$\u7684\u8868\u793a\uff0c\u9ad8\u65af\u6d88\u5143\u5373\u53ef\u5f97\u5230$b_i$\u3002\n\n\u4ed4\u7ec6\u89c2\u5bdf\u53d1\u73b0\u8fd9\u662f\u4e2a\u4e0a\u4e09\u89d2\u77e9\u9635\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5$O(k^2)$\u6c42\u89e3\uff01\n\n\u4e8e\u662f\u6211\u4eec\u89e3\u51fa\u4e86\u591a\u9879\u5f0f$B$\u3002\n\n\u56de\u8fc7\u5934\u6765\u770b\u6570\u5217$U$\u7684\u5b9a\u4e49\uff0c$U_n = A_n + B(n)$\n\n\u73b0\u5728\u89e3\u51fa\u4e86$B$\uff0c\u6211\u4eec\u53c8\u77e5\u9053$A_1 = 1$\uff0c\u5c31\u80fd\u77e5\u9053\n\n$$\nU_1 = A_1 + B(1) = B(1) +1\n$$\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86\u6570\u5217$U$\u7684\u5b8c\u6574\u9012\u63a8\u5f0f\n\n$$\nU_1=B(1) + 1,U_n=2U_{n-1}\n$$\n\n\u73b0\u5728\u5c31\u5bb9\u6613\u77e5\u9053$U$\u7684\u901a\u9879\u516c\u5f0f\u4e86\uff0c\u5b83\u662f\n\n$$\nU_n = ( B(1) + 1 )2^{n-1}\n$$\n\n\u53c8\u56e0\u4e3a$A_n = U_n - B(n)$\uff0c$A$\u7684\u901a\u9879\u516c\u5f0f\u5c31\u51fa\u6765\u4e86\uff01\n\n$$\nA_n = ( B(1) + 1 )2^{n-1} - B(n)\n$$\n\n\u5b8c\u4e86\n\n```cpp\n//\u6d1b\u8c37P5364 [SNOI2017]\u793c\u7269\n//Author:sun123zxy\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#include<ctime>\n#include<cstdlib>\n#include<queue>\nusing namespace std;\ntypedef long long ll;\nconst ll MOD=1E9+7;\n\nll QPow(ll x,ll up){//\u5feb\u901f\u5e42 \n    x%=MOD;\n    ll ans=1;\n    while(up){\n        if(up%2==0){\n            x=x*x%MOD;\n            up/=2;\n        }else{\n            ans=ans*x%MOD;\n            up--;\n        }\n    }\n    return ans;\n}\nll Inv(ll x){//\u9006\u5143 \n    return QPow(x,MOD-2);\n}\n\nconst ll MXK=2005;\nll fac[MXK],facInv[MXK];\nvoid FacInit(ll n){\n\tfac[0]=1;for(ll i=1;i<=n;i++) fac[i]=fac[i-1]*i%MOD;//\u6c42\u9636\u4e58 \n\tfacInv[n]=Inv(fac[n]);\n\tfor(ll i=n-1;i>=1;i--) facInv[i]=facInv[i+1]*(i+1)%MOD;//\u7ebf\u6027\u6c42\u9636\u4e58\u9006\u5143 \n\tfacInv[0]=1;\n}\nll C(ll n,ll k){//\u7ec4\u5408\u6570 \n\tif(n<k) return 0;\n\treturn fac[n]*facInv[n-k]%MOD*facInv[k]%MOD;\n}\n\nll N,K;\nll c,B[MXK];//2^(n-1)\u7684\u7cfb\u6570c\u548c\u591a\u9879\u5f0fB \nll GetY(ll x){//\u83b7\u53d6B(x)\n\tx%=MOD;\n\tll y=0;\n\tll xPow=1;\n\tfor(int i=0;i<=K-1;i++){\n\t\ty=(y+B[i]*xPow)%MOD;\n\t\txPow=xPow*x%MOD;\n\t}\n\treturn y;\n}\nll mtx[MXK][MXK];\nvoid GetFormula(){\n\tfor(ll i=0;i<=K-1;i++) for(ll j=0;j<=K;j++) mtx[i][j]=0;\n\tfor(ll i=0;i<=K-1;i++){//\u521d\u59cb\u5316\u65b9\u7a0b\u7ec4 \n    \tmtx[i][i]=1;\n    \tfor(ll j=i;j<=K-1;j++){\n    \t\tll p=-1;if((j-i)%2==0) p=1;\n    \t\tmtx[i][j]+=(-2*C(j,i)%MOD*p+MOD)%MOD;\n\t\t}\n\t\tll p=-1;if((K-i)%2==0) p=1;\n\t\tmtx[i][K]=(C(K,i)*p+MOD)%MOD;\n\t}\n\tfor(ll i=K-1;i>=0;i--){//\u4e0a\u4e09\u89d2\u9ad8\u65af\u6d88\u5143\n\t\tB[i]=mtx[i][K]*Inv(mtx[i][i])%MOD;\n\t\tfor(ll j=i-1;j>=0;j--){\n\t\t\tmtx[j][K]=(mtx[j][K]-B[i]*mtx[j][i]%MOD+MOD)%MOD;\n\t\t\tmtx[j][i]=0;\n\t\t}\n\t}\n\tc=(GetY(1)+1)+MOD%MOD;\n}\nint main(){\n    cin>>N>>K;\n    FacInit(K);\n    GetFormula();\n    cout<<(c*QPow(2,N-1)%MOD-GetY(N)+MOD)%MOD;\n    return 0;\n}\n```\n\n\u548c\u6d1b\u8c37\u9898\u89e3\u91cc[rqy\u805a\u805a\u7684\u89e3\u6cd5](https://www.luogu.com.cn/blog/rqy/solution-p5364)\u4f3c\u4e4e\u6709\u4e00\u4e9b\u5173\u8054\uff08",
        "postTime": 1561909786,
        "uid": 23632,
        "name": "sun123zxy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u73ed\u4e3b\u4efb\u5750\u5bf9\u9762\uff0c\u5f00\u4e0d\u4e86\u8eca\uff0c\u53ea\u80fd\u5199\u6570\u5b66\u9898\n\n\u9898\u610f\uff1a\n\n$$a_1=1,a_n=S_{n-1}+i^k$$\n\n\u6c42 $a_n\\bmod (10^9+7)$\uff0c$n\\le 10^{18},k\\le 10$\n\n\u89e3\u5b83\uff01\n\n$$a_n=S_{n-1}+n^k$$\n\n$$a_{n-1}=S_{n-2}+(n-1)^k$$\n\n\u76f8\u51cf\u5f97\u5230\n\n$$a_n=2a_{n-1}+n^k-(n-1)^k$$\n\n$$\\frac{a_n}{2^n}=\\frac{a_{n-1}}{2^{n-1}}+\\frac{n^k-(n-1)^k}{2^n}$$\n\n\u4ee4 $b_n=\\dfrac{a_n}{2^n}$\uff0c\u90a3\u4e48 \n\n$$b_n=0.5+\\sum_{i=2}^n\\frac{i^k-(i-1)^k}{2^i}=\\sum_{i=1}^n\\frac{i^k-(i-1)^k}{2^i}$$\n\n$$=\\frac{n^k}{2^n}-\\frac{(n-1)^k}{2^{n}}+\\frac{(n-1)^k}{2^{n-1}}-\\frac{(n-2)^k}{2^{n-1}}$$\n\n$$=\\frac{n^k}{2^n}+\\sum_{i=1}^{n-1}\\frac{i^k}{2^{i+1}}$$\n\n\u8003\u8651\u6c42\u4e00\u4e2a $G(n)=\\sum_{i=1}^{n-1}i^k/2^i$\n\n\u8fd9\u662f[P4948 \u6570\u5217\u6c42\u548c](https://www.luogu.com.cn/problem/P4948)\uff0c\u4e8e\u662f\u76f4\u63a5\u5957[\u6a21\u677f\u7c7b](https://www.luogu.com.cn/paste/y0f9e3gu)\u5c31\u884c\u4e86\u3002\n\n```cpp\nconst int p=1e9+7;\ntemplate<class _Tp,class _tp>void add(_Tp&x,const _tp& y){((x+=y)>=p)&&(x-=p);}template<class _Tp,class _tp>_Tp Add(_Tp x,const _tp y){add(x,y);return x;}\ntemplate<class _Tp,class _tp>void sub(_Tp&x,const _tp&y){((x-=y)<0)&&(x+=p);}template<class _Tp,class _tp>_Tp Sub(_Tp x,const _tp y){sub(x,y);return x;}\ntemplate<class _Tp,class _tp>void mul(_Tp&x,const _tp&y){x=1ll*x*y%p;}template<class _Tp,class _tp>_Tp Mul(const _Tp x,const _tp y){return 1ll*x*y%p;}\ntemplate<class _Tp,class _tp>_Tp ksm(_Tp a,_tp b){_Tp ans(1);for(;b;b>>=1,mul(a,a))if(b&1)mul(ans,a);return ans;} \ntemplate<class _Tp>_Tp div2(_Tp a){if(a&1)a+=p;return a>>1;}\nusing i64 = long long;\nint calc(const i64 nn,const int a,const int k){\n  assert(a!=1);\n  const int n=nn%p,_n=nn%(p-1);\n  vector<int>jc(k+6),jcinv(k+6),pri,idk(k+6);\n  vector<bool>v(k+6);idk[1]=1;\n  jc[0]=1;rep(i,1,k+5)jc[i]=Mul(jc[i-1],i);jcinv[k+5]=ksm(jc[k+5],p-2);\n  per(i,k+4,0)jcinv[i]=Mul(jcinv[i+1],i+1);rep(i,2,k+5){\n    if(!v[i])pri.push_back(i),idk[i]=ksm(i,k);\n    for(int j:pri){\n      if(i*j>k+5)break;\n      v[i*j]=1;idk[i*j]=Mul(idk[i],idk[j]);\n      if(i%j==0)break;\n    }\n  }\n  auto C=[&](int n,int m){return Mul(jc[n],Mul(jcinv[m],jcinv[n-m]));};\n  vector<int>lk(k+6),lt(k+6);int uu=ksm(a,p-2);\n  lk[0]=1;rep(i,1,k+1){\n    lk[i]=Mul(lk[i-1],uu);\n    lt[i]=Mul(lt[i-1],uu);\n    add(lt[i],idk[i]);\n  }\n  int rek=0,ret=0;\n  rep(i,0,k+1){\n    int dk=Mul(C(k+1,i),lk[k+1-i]);\n    int dt=Mul(C(k+1,i),lt[k+1-i]);\n    if(i&1)sub(rek,dk),sub(ret,dt);\n    else add(rek,dk),add(ret,dt);\n  }\n  vector<int>g(k+6);g[0]=Sub(0,Mul(ret,ksm(rek,p-2)));\n  rep(i,1,k+5)g[i]=Add(Mul(g[i-1],uu),idk[i]);\n  int CC=0;\n  if(n<=k+1)CC=g[n];\n  else{\n    int GG=1;\n    rep(i,1,k+1)mul(GG,n-i);\n    rep(i,1,k+1){\n      int tmp=Mul(jcinv[i-1],jcinv[k+1-i]);\n      mul(tmp,Mul(g[i],ksm(n-i,p-2)));\n      if((k+1-i)&1)mul(tmp,Sub(0,GG));\n      else mul(tmp,GG);\n      add(CC,tmp);\n    }\n  }\n  return Sub(Mul(CC,ksm(a,_n)),g[0]);\n}\nsigned main(){\n  i64 n;int k;\n  cin>>n>>k;\n  int ans=ksm(n%p,k);\n  add(ans,Mul(ksm(2,n-1),calc(n-1,(p+1)>>1,k)));\n  cout<<ans<<endl;\n}\n```",
        "postTime": 1643076701,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P5364 [SNOI2017]\u793c\u7269 \u8bb0\u5f55"
    },
    {
        "content": "\u9996\u5148\u7b2c\u4e00\u4e2a\u4eba\u7684\u65f6\u5019\u7684\u7b54\u6848\u4e3a$1$\n\n\u53ef\u4ee5\u8003\u8651\u8bbe$f_i$\u8868\u793a\u7b2c$i$\u4e2a\u4eba\u7684\u793c\u7269\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$f_i=\\sum_{j=1}^{i-1}f_j+i^k$$\n\n\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8e\u8be2\u95ee\u7684$n$\u67d0\u4e00\u4e2a$i^k$\u88ab\u8ba1\u7b97\u4e86\u591a\u5c11\u6b21\n\n$f_i$\u4e2d\u88ab\u8ba1\u7b97\u4e86\u4e00\u6b21\uff0c$f_{i+1}$\u4e2d\u662f\u4e00\u6b21\uff0c$f_{i+2}$\u4e2d\u5219\u662f\u4e8c\u6b21\uff0c$f_{i+3}$\u4e2d\u662f$4$\u6b21\uff0c\u5f80\u540e\u662f$8$\u6b21\uff0c$16$\u6b21...\n\n\u4e8e\u662f\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a$i^k< n$\u5b83\u4f1a\u88ab\u8ba1\u7b97\uff1a\n\n$$2^{n-i-1}$$\n\n\u6b21\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u5c31\u662f\uff1a\n\n$$n^{k}+\\sum_{i=1}^{n-1}i^k*2^{n-1-k}$$\n\n\u8bbe$x=n-1$\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f\uff1a\n\n$$n^k+\\sum_{i=1}^{x}i^k*2^{x-i}$$\n\n~~\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\uff08\u96fe~~\n\n\u4ed4\u7ec6\u601d\u8003\u540e\u4f1a\u53d1\u73b0\u4e00\u4e2a\u4ee4\u4eba\u500d\u611f\u4f18\u7f8e\u7684\u6027\u8d28\n\n\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u5c45\u7136\u662f\u53ef\u4ee5\u901a\u8fc7\u77e9\u9635\u9012\u63a8\u7684\n\n\u8bbe\n\n$$ h(x)=\\sum_{i=1}^xi^k*2^{x-i}$$\n\n$$h(x)=h(x-1)*2+x^k$$\n\n\u8c8c\u4f3c\u5bf9\u4e8e\u6bcf\u4e2a$x$\u8fd9\u4e2a\u4e1c\u897f\u662f\u72ec\u7acb\u7684\u554a\u5582...\n\n\u7136\u800c\u6709\u8da3\u7684\u662f$x^k$\u53ef\u4ee5\u7531$x^{k-1}$\u9012\u63a8\u5f97\u5230\uff0c\u5047\u8bbe$k=t$\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u4e2a\u5927\u5c0f\u4e3a$t$\u7684\u77e9\u9635\u9012\u63a8\u5f97\u5230\n\n\u5982\u4f55\u9012\u63a8\uff1f\n\n\u4e8c\u9879\u5f0f\u5b9a\u7406\u66b4\u529b\u5c55\u5f00\u5373\u53ef\uff0c\u590d\u6742\u5ea6$O(k^3\\log n)$",
        "postTime": 1570275803,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5364 \u3010[SNOI2017]\u793c\u7269\u3011"
    }
]