[
    {
        "content": "\u8fd9\u4e48\u4e00\u9053\u9898\u6ca1\u4eba\u5199\u9898\u89e3.\n\n\u90a3\u4e48\u4e00\u8840\u662f\u6211\u7684\u4e86.\n\n> \u7ed9\u4f60\u4e00\u4e2a\u5e8f\u5217,\u8981\u6c42\u652f\u6301\u533a\u95f4\u5e73\u65b9(\u5bf9$P$\u53d6\u6a21)\u548c\u533a\u95f4\u6c42\u548c\n\n> \u6570\u636e\u8303\u56f4\u4e2d\u7ed9\u51fa\u4e86\u6240\u6709\u53ef\u80fd\u7684$P$\n\n\u4e00\u770b\u5c31\u77e5\u9053\u8fd9\u4e2a\u6a21\u6570\u80af\u5b9a\u6709\u4e00\u4e9b\u7279\u6b8a\u6027\u8d28.\n\n\u6a21\u610f\u4e49\u4e0b\u7684\u5e73\u65b9\u8fd0\u7b97\u663e\u7136\u662f\u5177\u6709\u5faa\u73af\u8282\u7684.\n\n\u7136\u540e\u6211\u4eec\u6253\u4e2a\u8868,\u53d1\u73b0\u6240\u6709\u5faa\u73af\u8282\u957f\u5ea6\u7684$LCM \\le 60$,\u5e76\u4e14\u6bcf\u4e2a\u6570\u5e73\u65b9\u4e0d\u8d85\u8fc7$11$\u6b21\u5c31\u4f1a\u8fdb\u5165\u4e00\u4e2a\u5faa\u73af\u8282.\n\n\u7136\u540e\u6211\u4eec\u5bf9\u4e8e\u6ca1\u6709\u8fdb\u5165\u5faa\u73af\u8282\u7684\u6570\u66b4\u529b\u4fee\u6539\uff0c\u8fdb\u5165\u5faa\u73af\u8282\u4e4b\u540e\u5c31\u76f4\u63a5\u8df3,\u590d\u6742\u5ea6$O(\\omega nlogn)$\n\n``` cpp\n#include<bits/stdc++.h>\n#define read() Read<int>()\nnamespace pb_ds{   \n    namespace io{\n        const int MaxBuff=1<<15;\n        const int Output=1<<23;\n        char B[MaxBuff],*S=B,*T=B;\n\t\t#define getc() ((S==T)&&(T=(S=B)+fread(B,1,MaxBuff,stdin),S==T)?0:*S++)\n        char Out[Output],*iter=Out;\n        inline void flush(){\n            fwrite(Out,1,iter-Out,stdout);\n            iter=Out;\n        }\n    }\n    template<class Type> inline Type Read(){\n        using namespace io;\n        register char ch;\n        register Type ans=0; \n        register bool neg=0;\n        while(ch=getc(),(ch<'0' || ch>'9') && ch!='-');\n        ch=='-'?neg=1:ans=ch-'0';\n        while(ch=getc(),'0'<= ch && ch<='9') ans=ans*10+ch-'0';\n        return neg?-ans:ans;\n    }\n    template<class Type> inline void Print(register Type x,register char ch='\\n'){\n        using namespace io;\n        if(!x) *iter++='0';\n        else{\n            if(x<0) *iter++='-',x=-x;\n            static int s[100]; \n            register int t=0;\n            while(x) s[++t]=x%10,x/=10;\n            while(t) *iter++='0'+s[t--];\n        }\n        *iter++=ch;\n    }\n}\nusing namespace pb_ds;\nusing namespace std;\ntypedef long long ll;\nconst int N=1e5+5;\nconst int M=1e4+5;\nint n,m,q,Mod;\nint vis[M],p[M];\nint gcd(int x,int y){\n\tif (!y) return x;\n\treturn gcd(y,x%y);\n}\ninline int lcm(int x,int y){\n\treturn (x*y)/gcd(x,y);\n}\nnamespace seg{\n\t#define ls (x<<1)\n\t#define rs (ls|1)\n\t#define mid ((l+r)>>1)\n\tbool lp[N<<2];\n\tint now[N<<2],tag[N<<2];\n\tll sum[N<<2][60];\n\tinline void chk(int x){\n\t\tif (p[sum[x][0]]){\n\t\t\tfor (int i=1;i<m;++i)\n\t\t\t\tsum[x][i]=sum[x][i-1]*sum[x][i-1]%Mod;\n\t\t\tnow[x]=0,lp[x]=1;\n\t\t}else now[x]=lp[x]=0;\n\t}\n\tinline void Add(int x,int k){\n\t\ttag[x]=(tag[x]+k)%m;\n\t\tnow[x]=(now[x]+k)%m;\n\t}\n\tinline void pushup(int x){\n\t\tlp[x]=lp[ls]&lp[rs],now[x]=0;\n\t\tif (!lp[x]) sum[x][0]=sum[ls][now[ls]]+sum[rs][now[rs]];\n\t\telse{\n\t\t\tint lx=now[ls],rx=now[rs];\n\t\t\tfor (int i=0;i<m;++i){\n\t\t\t\tsum[x][i]=sum[ls][lx]+sum[rs][rx];\n\t\t\t\tlx=(lx+1)%m,rx=(rx+1)%m;\n\t\t\t}\n\t\t}\n\t}\n\tinline void pushdown(int x){\n\t\tif (tag[x]){\n\t\t\tAdd(ls,tag[x]);\n\t\t\tAdd(rs,tag[x]);\n\t\t\ttag[x]=0;\n\t\t}\n\t}\n\tvoid build(int x,int l,int r){\n\t\tif (l==r){\n\t\t\tsum[x][0]=read();\n\t\t\ttag[x]=0,chk(x);\n\t\t\treturn;\n\t\t}\n\t\tbuild(ls,l,mid);\n\t\tbuild(rs,mid+1,r);\n\t\tpushup(x);\n\t}\n\tvoid update(int x,int l,int r,int L,int R){\n\t\tif (L<=l && r<=R && lp[x]){\n\t\t\tAdd(x,1);\n\t\t\treturn;\n\t\t}\n\t\tif (l==r){\n\t\t\tsum[x][0]=sum[x][0]*sum[x][0]%Mod;\n\t\t\tchk(x);\n\t\t\treturn;\n\t\t}\n\t\tpushdown(x);\n\t\tif (L<=mid) update(ls,l,mid,L,R);\n\t\tif (R>mid) update(rs,mid+1,r,L,R);\n\t\tpushup(x);\n\t}\n\tll query(int x,int l,int r,int L,int R){\n\t\tif (L<=l && r<=R) return sum[x][now[x]];\n\t\tll res=0;\n\t\tpushdown(x);\n\t\tif (L<=mid) res+=query(ls,l,mid,L,R);\n\t\tif (R>mid) res+=query(rs,mid+1,r,L,R);\n\t\treturn res;\n\t}\n}\nusing namespace seg;\ninline void get_loop(int x){\n\tfor (int i=1,y=x;;++i,y=y*y%Mod){\n\t\tif (vis[y]){\n\t\t\tp[y]=i-vis[y];\n\t\t\tbreak;\n\t\t}else vis[y]=i;\n\t}\n\tfor (int y=x;vis[y];y=y*y%Mod) vis[y]=0;\n}\nint main(){\n\tn=read(),q=read(),Mod=read(),m=1;\n\tfor (int i=0;i<Mod;++i) get_loop(i);\n\tfor (int i=0;i<Mod;++i)\n\t\tif (p[i]) m=lcm(p[i],m);\n\tbuild(1,1,n);\n\twhile (q--){\n\t\tint opt=read(),l=read(),r=read();\n\t\tif (opt&1) update(1,1,n,l,r);\n\t\telse Print(query(1,1,n,l,r));\n\t}\n\tio::flush();\n\treturn 0;\n}",
        "postTime": 1553083994,
        "uid": 8601,
        "name": "disposrestfully",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4681 \u3010[THUSC2015]\u5e73\u65b9\u8fd0\u7b97\u3011"
    },
    {
        "content": "### P.S.\n\u9ad8\u8d28\u91cf\u597d\u6570\u636e\u7ed3\u6784\u3002  \n\u4e00\u76f4\u62cd\u6302 ![](//xn--9zr.tk/px)  \n\u5bf9\u62cd\u5efa\u8bae $n=2,m=100000$ \u8fd9\u6837\u8c03\u8bd5\u96be\u5ea6\u4f4e\u4e00\u70b9 qwq\u3002  \n\u76ee\u524d\u6700\u4f18\u89e3\u770b\u4eba\u5934 rank2\uff0c\u4e0d\u8fc7\u6211\u8fd9\u79cd\u5199\u6cd5\u5e94\u8be5\u4f1a\u81ea\u5e26\u5927\u5e38\u6570\u3002  \n\n### Description.\n\u7ef4\u62a4\u5e8f\u5217\uff0c\u8981\u6c42\u652f\u6301\uff1a\u533a\u95f4\u5e73\u65b9\u4fee\u6539\u4e3a\u6a21 $P$\uff0c\u67e5\u5bfb\u533a\u95f4\u548c\u3002  \n\n### Solution.\n\u9996\u5148\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5e73\u65b9\u8fd0\u7b97\u5177\u6709\u5faa\u73af\u8282\u3002  \n\u6253\u4e2a\u8868\u4f1a\u53d1\u73b0\u9898\u76ee\u4e2d\u6240\u6709\u6a21\u4e0b\uff0c\u5faa\u73af\u8282\u957f\u5ea6 $\\text{lcm}$ \u6700\u5927\u503c\u4e3a $60$\u3002  \n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u76f4\u63a5\u66b4\u529b\uff0c\u5982\u679c\u8fdb\u5165\u5faa\u73af\u8282\u4e86\u5c31\u76f4\u63a5\u5f00\u6876\u4fee\u6539\u3002  \n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u6b38\u3002  \n\u6ce8\u610f\u662f\u533a\u95f4\u4fee\u6539\uff0c\u5fc5\u987b\u8981\u6253 lazetag\u3002  \n\u6ce8\u610f\u65e0\u6cd5\u9884\u5904\u7406\u4e00\u4e2a\u533a\u95f4\u7684\u7b54\u6848\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u533a\u95f4\u7684\u5b50\u533a\u95f4\u53ef\u80fd\u4f1a\u88ab\u64cd\u4f5c\u3002  \n\u5177\u4f53\u770b\u4ee3\u7801\u53ca\u5176\u6ce8\u91ca\u5427 ![](//xn--9zr.tk/ts)  \n\n### Coding.\n```cpp\n//\u662f\u554a\u2026\u2026\u4f60\u5c31\u662f\u90a3\u53ea\u9b3c\u4e86\u2026\u2026\u6240\u4ee5\u88ab\u4f60\u78b0\u5230\u4ee5\u540e\uff0c\u5c31\u8f6e\u5230\u6211\u53d8\u6210\u9b3c\u4e86{{{\n#include<bits/stdc++.h>\nusing namespace std;typedef long long ll;\ntemplate<typename T>inline void read(T &x)\n{\n\tx=0;char c=getchar(),f=0;\n\tfor(;c<48||c>57;c=getchar()) if(!(c^45)) f=1;\n\tfor(;c>=48&&c<=57;c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\tf?x=-x:x;\n}/*}}}*/\nint n,m,P,a[100005],deg[10005];char v[10005];\nstruct segm{int smt,nw,sm[61],lz;char tag;}T[400005];\n//tag\u4ee3\u8868\u5f53\u524d\u533a\u95f4\u662f\u5426\u5168\u90e8\u8fdb\u5165\u5faa\u73af\u8282\n//smt\u4ee3\u8868\u5f53\u524d\u533a\u95f4\u6876\u7684\u5faa\u73af\u8282\uff08\u4e3a0\u4ee3\u8868\u672a\u8fdb\u5165\u5faa\u73af\u8282\n//sm\u8868\u793a\u6876\uff0cnw\u8868\u793a\u5f53\u524d\u5728\u6876\u4e2d\u4f4d\u7f6e\n//lz\u8868\u793alazetag\n//\u5982\u679c\u672a\u8fdb\u5165\u5faa\u73af\u8282 sm[0] \u8868\u793a\u5f53\u524d\u8fd9\u4e2a\u70b9\u7684\u6743\u503c\ninline int gcd(int a,int b) {return b?gcd(b,a%b):a;}\ninline int sqr(int x) {return x*x%P;}\ninline void pushup(int x)\n{\n\tT[x].tag=T[x<<1].tag&T[x<<1|1].tag;\n\tif(!T[x].smt) T[x].sm[0]=T[x<<1].sm[T[x<<1].nw]+T[x<<1|1].sm[T[x<<1|1].nw];\n\tif(T[x<<1].smt&&T[x<<1|1].smt)\n\t{\n\t\tint nl=T[x<<1].smt,nr=T[x<<1|1].smt,lw=T[x<<1].nw,rw=T[x<<1|1].nw;\n\t\tT[x].smt=nl/gcd(nl,nr)*nr,T[x].nw=0;//\u516c\u5171\u5faa\u73af\u8282\u957f\u5ea6\u662f lcm\n\t\tfor(int i=0;i<T[x].smt;i++) T[x].sm[i]=T[x<<1].sm[(i+lw)%nl]+T[x<<1|1].sm[(i+rw)%nr];\n\t\t//\u628a\u4e24\u4e2a\u6876\u5408\u5e76\uff0c\u6ce8\u610f\u4e24\u8fb9\u4e0d\u4e00\u5b9a\u4ece\u8d77\u70b9\u5f00\u59cb\uff0c\u53ef\u80fd\u5df2\u7ecf\u79fb\u52a8\u8fc7\u4e86\u3002  \n\t}\n}\ninline void allc(int x,int c) {T[x].nw=(T[x].nw+c)%T[x].smt,T[x].lz+=c;}\ninline void pushdw(int x) {if(T[x].lz) allc(x<<1,T[x].lz),allc(x<<1|1,T[x].lz),T[x].lz=0;}\ninline void INIT(int x)\n{//\u9884\u5904\u7406\u4e00\u4e2a\u7ed3\u70b9\u7684\u6876\u4fe1\u606f\n\tfor(int i=1;i<=60;i++)\n\t{\n\t\tT[x].sm[i]=sqr(T[x].sm[i-1]);//\u627e\u5230\u5faa\u73af\u8282\n\t\tif(T[x].sm[i]==T[x].sm[0]) {T[x].smt=i;break;}\n\t}\n}\ninline void build(int x,int l,int r)\n{//\u65e0\u96be\u70b9\uff0c\u4e0d\u89e3\u91ca\n\tif(l==r) return T[x].sm[T[x].smt=0]=a[l],void();\n\tbuild(x<<1,l,(l+r)>>1),build(x<<1|1,((l+r)>>1)+1,r),pushup(x);\n}\ninline void modif(int x,int l,int r,int dl,int dr)\n{\n\tif(l>dr||dl>r) return;else if(dl>l||r>dr)\n\t\treturn pushdw(x),modif(x<<1,l,(l+r)>>1,dl,dr),modif(x<<1|1,((l+r)>>1)+1,r,dl,dr),pushup(x);\n\t//\u5982\u679c\u5c0f\u533a\u95f4\u548c\u5927\u533a\u95f4\u65e0\u5305\u542b\u5173\u7cfb\uff0c\u90a3\u5c31\u6b63\u5e38\u7ebf\u6bb5\u6811\u5904\u7406\u3002  \n\tif(T[x].tag) return allc(x,1),void();//\u5982\u679c\u5df2\u7ecf\u8fdb\u5165\u5faa\u73af\u8282\uff0c\u76f4\u63a5\u6253lazetag\n\tif(l^r) return pushdw(x),modif(x<<1,l,(l+r)>>1,dl,dr),modif(x<<1|1,((l+r)>>1)+1,r,dl,dr),pushup(x);\n\t//\u6ca1\u8fdb\u5165\u5faa\u73af\u8282\u8fd8\u4e0d\u662f\u53f6\u7ed3\u70b9\uff0c\u53ea\u80fd\u66b4\u529b\u5411\u4e0b\n\tif(v[T[x].sm[0]]) return T[x].sm[0]=sqr(T[x].sm[0]),void();\n\t//\u5982\u679c\u8fd8\u5728\u5faa\u73af\u8282\u5916\u9762\uff0c\u90a3\u5c31\u66b4\u8df3\uff0c\u5426\u5219\u5c31\u9884\u5904\u7406\u4e86\n\tif(!T[x].tag) INIT(x),T[x].tag=1,T[x].nw=1%T[x].smt;else T[x].nw=(T[x].nw+1)%T[x].smt;\n}\ninline int query(int x,int l,int r,int dl,int dr)\n{//\u65e0\u96be\u70b9\uff0c\u4e0d\u89e3\u91ca\n\tif(dl>r||l>dr) return 0;else if(dl<=l&&r<=dr) return T[x].sm[T[x].nw];else pushdw(x);\n\treturn query(x<<1,l,(l+r)>>1,dl,dr)+query(x<<1|1,((l+r)>>1)+1,r,dl,dr);\n}\nint main()\n{\n\tread(n),read(m),read(P);queue<int>q;\n\tfor(int i=0;i<P;i++) deg[sqr(i)]++;\n\tfor(int i=0;i<P;i++) if(!deg[i]) q.push(i);\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();q.pop(),v[x]=1;\n\t\tif(!--deg[sqr(x)]) q.push(sqr(x));\n\t}//topo\u627e\u73af\n\tfor(int i=1;i<=n;i++) read(a[i]);\n\tfor(build(1,1,n);m--;)\n\t{\n\t\tint op,l,r;read(op),read(l),read(r);\n\t\tif(op&1) modif(1,1,n,l,r);else printf(\"%d\\n\",query(1,1,n,l,r));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1618273127,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "P4681 [THUSC2015]\u5e73\u65b9\u8fd0\u7b97\uff08\u9898\u89e3\uff09"
    }
]