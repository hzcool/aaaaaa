[
    {
        "content": "### \u601d\u8def\n\n\u6211\u4eec\u4e0d\u59a8\u4ece\u6700\u66b4\u529b\u7684\u65b9\u6cd5\u60f3\u4e00\u60f3\uff0c\u603b\u5171\u6709 $q$ \u4e2a\u8be2\u95ee\u9700\u8981 $O(q)$\uff0c\u679a\u4e3e $[a,b]$ \u7684 $L$ \u503c\u9700\u8981 $O(n)$\uff0c\u679a\u4e3e $[c,d]$ \u4e2d\u7684\u503c\u9700\u8981 $O(n)$\uff0c\u66b4\u529b\u8ba1\u7b97 $F$ \u51fd\u6570\u7684\u503c\u8fd8\u8981 $O(n)$\uff0c\u603b\u5171 $O(n^3q)$\uff0c\u94c1\u5b9a\u8d85\u65f6\u3002\n\n\u663e\u7136\u90a3\u4e2a $O(q)$ \u662f\u4e0d\u80fd\u591f\u6d88\u9664\u7684\uff0c\u90a3\u6211\u4eec\u8003\u8651\u4f18\u5316\u90a3\u4e09\u4e2a $O(n)$\u3002\n\n\u9996\u5148 **\u5728\u7ebf** \u8ba1\u7b97 $F$ \u51fd\u6570\u53ef\u4ee5\u7528\u5206\u5757 $O(\\sqrt{n})$ \u6216 $O(\\sqrt{n}\\log n)$\uff0c\u4f46\u662f\u524d\u4e00\u79cd\u505a\u6cd5\u9700\u8981\u9884\u5904\u7406\u524d\u7f00\u5757\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt{n})$ \u4f1a\u88ab\u5361\u3002\u800c\u7b2c\u4e8c\u79cd\u505a\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u592a\u9ad8\uff0c\u4e5f\u4f1a\u88ab\u5361\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e3b\u5e2d\u6811\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(40n)$\uff0c\u521a\u521a\u597d\u3002\u73b0\u5728\u65f6\u95f4\u590d\u6742\u5ea6\u88ab\u4f18\u5316\u5230\u4e86 $O(n^2q\\log n)$\u3002\n\n\u63a5\u7740\uff0c\u6211\u4eec\u53d1\u73b0 $F(l,r)$ \u4e0e $F(l,r+1)$ \u4e4b\u95f4\u53ea\u5dee\u4e86 $s_{r+1}$ \u5bf9\u51fd\u6570\u7684\u8d21\u732e\uff0c\u800c\u5b83\u4e0d\u5c0f\u4e8e 0\uff0c\u6700\u591a\u4e3a 1\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c$F(L,c)$ \u5230 $F(L,d)$ \u4e4b\u95f4\u7684\u503c\u5fc5\u7136 **\u4e0d\u4e0b\u964d**\uff0c\u800c\u4e14\u6bcf\u76f8\u90bb\u4e24\u4e2a\u6570\u76f8\u5dee **\u81f3\u591a\u4e3a 1**\u3002\u6240\u4ee5\uff0c$G(F(L,c),F(L,c+1),\\cdots,F(L,d))=F(L,d)-F(L,c)+1$ \uff0c\u53c8\u4f18\u5316\u6389\u4e86\u4e00\u4e2a $O(n)$\uff0c\u6b64\u65f6\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u4e3a $O(nq\\log n)$\u3002\n\n\u73b0\u5728\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5c31\u53d8\u6210\u4e86\u679a\u4e3e $L$ \u4e0a\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8bd5\u7740\u731c\u4e00\u731c\u6c42\u548c\u7b26\u53f7\u53f3\u8fb9\u7684\u5f0f\u5b50\u6709\u4ec0\u4e48\u89c4\u5f8b\u4e86\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6c42\u548c\u7b26\u53f7\u53f3\u8fb9\u7684\u5f0f\u5b50\u662f **\u968f\u7740 $L$ \u7684\u589e\u5927\u800c\u589e\u5927** \u7684\u3002\u6211\u4eec\u6765\u8bc1\u660e\u4e00\u4e0b\uff1a\n\n\u5f53 $L=k$ \u65f6\uff0c\u53f3\u8fb9\u7684\u503c\u4e3a $F(k,d)-F(k,c)+1$\uff0c\u800c\u5f53 $L=k+1$ \u65f6\uff0c\u53f3\u8fb9\u4e3a $F(k+1,d)-F(k+1,c)$\u3002\u4e24\u8005\u7684\u533a\u522b\u4ec5\u4ec5\u5728\u4e8e $s_k$ \u4ea7\u751f\u7684\u8d21\u732e\u3002\n\n- \u5f53 $s_k$ \u5728 $[k+1,d]$ \u4e0d\u51fa\u73b0\u65f6\uff0c$F(k,d)$ \u548c $F(k,c)$ \u5206\u522b\u4f1a\u6bd4 $F(k+1,d)$ \u548c $F(k+1,c)$ \u5927 1\uff0c\u76f8\u5f53\u4e8e\u6ca1\u8d77\u5230\u4f5c\u7528\u3002\n- \u5f53 $s_k$ \u5728 $[k+1,c]$ \u51fa\u73b0\u65f6\uff0c$F(k,d)$ \u548c $F(k,c)$ \u548c\u540e\u9762\u76f8\u6bd4\u6ca1\u6709\u4efb\u4f55\u53d8\u5316\uff0c\u76f8\u5f53\u4e8e\u4e0d\u8d77\u4f5c\u7528\u3002\n- \u5f53 $s_k$ \u4ec5\u5728 $[c+1,d]$ \u51fa\u73b0\u65f6\uff0c$F(k,d)$ \u76f8\u8f83\u540e\u9762\u6ca1\u6709\u53d8\u5316\uff0c\u800c $F(k,c)$ \u52a0\u4e0a\u4e86 1\uff0c\u603b\u5171 **\u51cf\u53bb\u4e86 1**\u3002\n\n\u7efc\u4e0a\uff0c\u8bc1\u660e\u6210\u7acb\uff0c\u4e14 $L=k+1$ \u76f8\u8f83 $L=k$ \u65f6\uff0c**\u503c\u81f3\u591a\u4f1a\u589e\u52a0 1**\u3002\u4e8e\u662f\u6211\u4eec\u4fbf\u53ef\u4ee5\u6109\u5feb\u5730\u4e8c\u5206\u4e86\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u6210\u4e86 $O(q\\log^2 n)$\uff0c\u5728\u6709 O2 \u4f18\u5316\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8dd1\u8fc7\u53bb\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int Maxn=3e5;\n\ninline int read()\n{\n    char ch=getchar();\n    int f=1,x=0;\n    while(ch>'9' || ch<'0')\n    {\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9')\n    {\n        x=x*10+ch-'0';\n        ch=getchar();\n    }\n    return x*f;\n}\n\nstruct Node{int l,r,siz;} t[Maxn*40+5];\nint tot,rt[Maxn+5];\n#define ls(x) t[x].l\n#define rs(x) t[x].r\n\nint n,m,lst,h[Maxn+5],cnt[Maxn+5],nxt[Maxn+5],Q[10];\nvector<int> v;\n\ninline void Insert(int l,int r,int L,int &R,int val)\n{\n    t[++tot]=t[L],R=tot,t[R].siz++;\n    if(l==r) return;\n    int mid=(l+r)>>1;\n    if(val<=mid) Insert(l,mid,ls(L),ls(R),val);\n    else Insert(mid+1,r,rs(L),rs(R),val);\n}\ninline int Find(int l,int r,int L,int R,int val)\n{\n    if(l==r) return t[R].siz-t[L].siz;\n    int mid=(l+r)>>1;\n    if(val<=mid) return t[rs(R)].siz-t[rs(L)].siz+Find(l,mid,ls(L),ls(R),val);\n    else return Find(mid+1,r,rs(L),rs(R),val);\n}\ninline int F(int l,int r) {return Find(1,n+1,rt[l-1],rt[r],r+1);}\ninline void Solve()\n{\n    while(m--)\n    {\n        int a,b,c,d,e,f,l,r,siz=-1;\n        for(int i=1;i<=4;++i) Q[i]=(read()+lst)%n+1;\n        sort(Q+1,Q+5),a=Q[1],b=Q[2],c=Q[3],d=Q[4],e=read(),f=read(),l=a-1,r=b;\n        while(l<r)\n        {\n            int mid=(l+r+1)/2;\n            if(mid==a-1 || F(mid,d)-F(mid,c)+1<e) l=mid;\n            else r=mid-1;\n        }\n        siz-=l,l=a,r=b+1;\n        while(l<r)\n        {\n            int mid=(l+r)/2;\n            if(mid==b+1 || F(mid,d)-F(mid,c)+1>f) r=mid;\n            else l=mid+1;\n        }\n        siz+=l,lst=siz; printf(\"%d\\n\",siz);\n    }\n}\ninline void Init()\n{\n    n=read(),m=read();\n    for(int i=1;i<=n;++i) v.push_back(h[i]=read()),cnt[i]=n+1;\n    sort(v.begin(),v.end()),v.erase(unique(v.begin(),v.end()),v.end());\n    for(int i=1;i<=n;++i) h[i]=lower_bound(v.begin(),v.end(),h[i])-v.begin()+1;\n    for(int i=n;i>=1;--i) nxt[i]=cnt[h[i]],cnt[h[i]]=i;\n    for(int i=1;i<=n;++i) Insert(1,n+1,rt[i-1],rt[i],nxt[i]);\n}\n\nint main()\n{\n    Init(),Solve();\n    return 0;\n}\n```\n\n",
        "postTime": 1620472750,
        "uid": 148913,
        "name": "Graphcity",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P7577\u3010\u300cPMOI-3\u300d\u7b80\u5355\u6a21\u62df\u9898\u3011"
    },
    {
        "content": "## P7577 \u300cPMOI-3\u300d\u7b80\u5355\u6a21\u62df\u9898\n\n### \u601d\u8def\n\n\u4ed4\u7ec6\u8bfb\u9898\u53d1\u73b0\uff0c\u9898\u610f\u7b49\u4ef7\u4e8e\u5bf9\u4e8e $\\forall l|l\\in[a,b]$\uff0c$F(l,c),F(l,c+1),\\cdots F(l,d)$ \u5728\u503c\u57df\u4e0a\u8fde\u7eed\uff0c\u5219 $G(F(l,c),F(l,c+1),\\cdots F(l,d))$ \u7b49\u4ef7\u4e8e\u6c42 $[c,d]$ \u4e2d\u5728 $[l,c-1]$ \u4e2d\u6ca1\u6709\u51fa\u73b0\u7684\u989c\u8272\u7684\u4e2a\u6570\u3002\n\n\u518d\u4ed4\u7ec6\u5206\u6790\u53ef\u5f97\uff0c\u5728 $[l,c-1]$ \u4e2d\u968f\u7740 $l$ \u7684\u589e\u52a0\uff0c$[l,c-1]$ \u5185\u90e8\u7684\u989c\u8272\u6570\u4f1a\u51cf\u5c11\uff0c\u800c $[c,d]$ \u4e2d\u5728 $[l,c-1]$ \u4e2d\u6ca1\u6709\u51fa\u73b0\u7684\u989c\u8272\u6570\u4e2a\u6570\u5c31\u4f1a\u589e\u52a0\uff0c\u5373\u524d\u8005\u5728 $l$ \u4e2d\u5177\u6709\u5355\u8c03\u6027\uff0c\u7531\u6b64\u53ef\u4ee5\u4e8c\u5206\u51fa\u533a\u95f4 $[L,R]$ \u6ee1\u8db3\u5f53 $l\\in[L,R]$ \u65f6\u5fc5\u6709 $e\\leq G(F(l,c),F(l,c+1),\\cdots F(l,d))\\leq f$\u3002\n\n\u7531\u6b64\u5c31\u53ef\u4ee5\u884d\u751f\u51fa $\\mathcal O(n\\log^2 n)$ \u505a\u6cd5\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u8bb0 $pre_i$ \u8868\u793a\u6570 $a_i$ \u4e0a\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5e76\u5bf9 $pre$ \u5efa\u4e3b\u5e2d\u6811\uff0c\u95ee\u9898\u8f6c\u6362\u4e3a\u4e86\u533a\u95f4\u4e2d $< l$ \u7684\u6570\u7684\u4e2a\u6570\uff0c\u5e76\u4e8c\u5206 $[a,b]$ \u4e2d\u7684\u533a\u95f4 $[L,R]$ \u6bcf\u6b21\u4e8c\u5206\u90fd\u9700\u8981\u91cd\u65b0\u5728\u4e3b\u5e2d\u6811\u4e0a\u67e5\u8be2\u4e00\u6b21\uff0c\u590d\u6742\u5ea6 $\\mathcal O(\\log ^2n)$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u79cd\u7b97\u6cd5\u7684\u74f6\u9888\u5728\u4e8e\u6bcf\u6b21\u4e8c\u5206\u90fd\u9700\u8981\u91cd\u65b0\u67e5\u8be2\uff0c\u8fd9\u6837\u7684\u4ee3\u4ef7\u592a\u9ad8\uff0c\u4f46\u6211\u4eec\u53d1\u73b0\u6bcf\u6b21\u4e3b\u5e2d\u6811\u67e5\u8be2\u7684\u90fd\u662f\u503c\u57df\u4e0a\u7684\u4e00\u6bb5\u524d\u7f00\uff0c\u8fd9\u5c31\u7ed9\u4f18\u5316\u5e26\u6765\u4e86\u53ef\u80fd\uff0c\u6211\u4eec\u53d1\u73b0\u6bcf\u6b21\u8ba1\u7b97\u524d\u7f00\u7684\u65f6\u5019\u5fc5\u5b9a\u5305\u62ec\u533a\u95f4 $[1,a-1]$\uff0c\u8003\u8651\u5148\u628a\u8fd9\u90e8\u5206\u7684\u8d21\u732e\u5728 $e,f$ \u4e0a\u6d88\u6389\uff0c\u540c\u65f6\u628a $[c,d]$ \u4ee3\u8868**\u503c\u57df**\u533a\u95f4\u5728\u4e3b\u5e2d\u6811\u4e0a\u7684 $\\log$ \u6bb5\u90fd\u53d6\u51fa\u6765\uff0c\u4ece\u5934\u5230\u5c3e\u6c42\u524d\u7f00\u548c\uff0c\u5982\u679c\u5f53\u524d\u524d\u7f00\u548c $\\geq e(\\leq f)$\uff0c\u90a3\u4e48\u5c31\u5728\u8fd9\u4e2a\u533a\u95f4\u4e0a\u4e8c\u5206\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5feb\u901f\u627e\u5230\u533a\u95f4 $[L,R]$\uff0c\u7b54\u6848\u7edf\u8ba1\u5c31\u662f $R-L+1$\u3002\n\n\u8fd9\u6837\u6700\u591a\u904d\u5386 $\\log n$ \u4e2a\u533a\u95f4\uff0c\u540c\u65f6\u6700\u591a\u8fdb\u884c\u4e24\u6b21\u4e3b\u5e2d\u6811\u4e0a\u4e8c\u5206\uff0c\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n\n\u7ec6\u8282\u8f83\u591a\u3002\n\n------\n\n### code\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std; \nconst int N = 3e5 + 10;\nconst int INF = 0x3f3f3f3f;\nconst int mods = 1e9 + 7;\ntypedef pair <int, int> pii;\ninline int read ()\n{\n    int x = 0, f = 1;\n    char ch = getchar ();\n    while (ch < '0' || ch > '9') { if (ch == '-') f = -1; ch = getchar (); }\n    while (ch >= '0' && ch <= '9') { x = (x << 1) + (x << 3) + (ch ^ 48); ch = getchar (); }\n    return x * f;\n}\nint n, q;\nint a, b, c, d, e, f;\nint sub[N], pre[N];\nint ls[N], pos[N];\nint root[N];\nint l1[N], r1[N], l2[N], r2[N], s[N], cnt;\nstruct president_tree {\n\tint node;\n\tstruct Tree {\n\t\tint ls, rs, sum;\n\t\t#define ls(x) t[x].ls\n\t\t#define rs(x) t[x].rs\n\t\t#define sum(x) t[x].sum\n\t}t[N << 5];\n\tvoid build (int &x) { x = ++node; ls(x) = rs(x) = sum(x) = 0; }\n\tinline void pushup (int x) { sum(x) = sum(ls(x)) + sum(rs(x)); }\n\tvoid modify (int &x, int pre, int l, int r, int val)\n\t{\n\t\tx = ++node;\n\t\tif (l == r)\n\t\t{\n\t\t\tsum(x) = sum(pre) + 1;\n\t\t\treturn ;\n\t\t}\n\t\tls(x) = ls(pre); rs(x) = rs(pre);\n\t\tint mid = (l + r) >> 1;\n\t\tif (val <= mid) modify (ls(x), ls(pre), l, mid, val);\n\t\telse modify (rs(x), rs(pre), mid + 1, r, val);\n\t\tpushup (x);\n\t}\n\tint query (int x, int y, int l, int r, int L, int R)\n\t{\n\t\tint s = sum(y) - sum(x);\n\t\tif (L <= l && r <= R) return s;\n\t\tint mid = (l + r) >> 1, res = 0;\n\t\tif (L <= mid) res += query (ls(x), ls(y), l, mid, L, R);\n\t\tif (R > mid) res += query (rs(x), rs(y), mid + 1, r, L, R);\n\t\treturn res;\n\t}\n\tvoid abstract (int x, int y, int l, int r, int L, int R)\n\t{\n\t\tif (L <= l && r <= R)\n\t\t{\n\t\t\tl1[++cnt] = x; l2[cnt] = l;\n\t\t\tr1[cnt] = y; r2[cnt] = r;\n\t\t\ts[cnt] = sum(y) - sum(x);\n\t\t\treturn ;\n\t\t}\n\t\tint mid = (l + r) >> 1;\n\t\tif (L <= mid) abstract (ls(x), ls(y), l, mid, L, R);\n\t\tif (R > mid) abstract (rs(x), rs(y), mid + 1, r, L, R);\n\t}\n\tint bs (int x, int y, int l, int r, int val)\n\t{\n\t\tif (l == r) return l;\n\t\tint mid = (l + r) >> 1;\n\t\tif (val + (sum(ls(y)) - sum(ls(x))) >= e) return bs (ls(x), ls(y), l, mid, val);\n\t\telse return bs (rs(x), rs(y), mid + 1, r, val + (sum(ls(y)) - sum(ls(x))));\n\t}\n\tint bs2 (int x, int y, int l, int r, int val)\n\t{\n\t\tif (l == r) return l;\n\t\tint mid = (l + r) >> 1;\n\t\tif (val + (sum(ls(y)) - sum(ls(x))) > f) return bs2 (ls(x), ls(y), l, mid, val);\n\t\telse return bs2 (rs(x), rs(y), mid + 1, r, val + (sum(ls(y)) - sum(ls(x))));\n\t}\n} T;\nint lans, rans;\nint query ()\n{\n\tint k = T.query (root[c], root[d], 0, n, 0, a - 1);\n\te -= k; f -= k;\n\tcnt = 0; T.abstract (root[c], root[d], 0, n, a, b - 1);\n\tfor (int i = 1; i <= cnt; i++) s[i] += s[i - 1];\n\tif (s[cnt] < e || f < 0) return 0;\n\tif (e <= 0) lans = a;\n\telse\n\t{\n\t\tfor (int i = 1; i <= cnt; i++)\n\t\t\tif (s[i] >= e)\n\t\t\t\t{ lans = T.bs (l1[i], r1[i], l2[i], r2[i], s[i - 1]) + 1; break; }\n\t}\n\tif (s[cnt] <= f) rans = b;\n\telse\n\t{\n\t\tfor (int i = 1; i <= cnt; i++)\n\t\t\tif (s[i] > f)\n\t\t\t\t{ rans = T.bs2 (l1[i], r1[i], l2[i], r2[i], s[i - 1]); break; }\n\t}\n\treturn max (0, rans - lans + 1);\n}\nsigned main()\n{\n\tn = read (), q = read ();\n\tfor (int i = 1; i <= n; i++) sub[i] = ls[i] = read ();\n\tsort (ls + 1, ls + n + 1);\n\tint len = unique (ls + 1, ls + n + 1) - ls - 1;\n\tfor (int i = 1; i <= n; i++) sub[i] = lower_bound (ls + 1, ls + len + 1, sub[i]) - ls;\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tpre[i] = pos[sub[i]];\n\t\tpos[sub[i]] = i;\n\t}\n\tT.build (root[0]);\n\tfor (int i = 1; i <= n; i++) T.modify (root[i], root[i - 1], 0, n, pre[i]);\n\tint lst = 0;\n\twhile (q--)\n\t{\n\t\tint g[5];\n\t\ta = (read () + lst) % n + 1;\n\t\tb = (read () + lst) % n + 1;\n\t\tc = (read () + lst) % n + 1;\n\t\td = (read () + lst) % n + 1;\n\t\tg[1] = a, g[2] = b, g[3] = c, g[4] = d;\n\t\tsort(g + 1, g + 5);\n\t\ta = g[1], b = g[2], c = g[3], d = g[4];\n\t\te = read () - 1; f = read () - 1;\n\t\tprintf (\"%d\\n\", lst = query ());\n\t}\n    return 0;\n}\n```",
        "postTime": 1659142325,
        "uid": 177837,
        "name": "violin_wyl",
        "ccfLevel": 6,
        "title": "P7577 \u300cPMOI-3\u300d\u7b80\u5355\u6a21\u62df\u9898"
    },
    {
        "content": "\u8bc4\u7d2b\u5c31\u8bc4\u7d2b\u5427\uff0c\u8fd8\u662f\u5f88\u6709\u8da3\u7684\u4e00\u9053\u9898\u3002             \n\n\u521a\u5f00\u59cb\u505a\u5f88\u6109\u5feb\u7684\u8bfb\u9519\u4e86\u9898\uff0c\u5927\u6982\u60f3\u5230\u4e86\u7c7b\u4f3c\u9879\u94fe\u7684\u7ecf\u5178\u8001\u505a\u6cd5\uff0c\u540e\u6765\u5728\u540c\u5b66\u63d0\u9192\u4e0b\u624d\u53d1\u73b0\u9898\u76ee\u8bfb\u9519\u4e86\uff0c\u8ba4\u771f\u91cd\u65b0\u8bfb\u5b8c\u9898\u76ee\u540e\u5927\u6982\u5c31\u77e5\u9053\u600e\u4e48\u505a\u4e86\u3002                  \n            \nPS:\u795e\u4ed9\u540c\u5b66\u6bd4\u6211\u665a 20min \u5f00\u59cb\u60f3\u9898\uff0c\u57fa\u672c\u4e0a 10min \u5c31\u60f3\u51fa\u6765\u4e86\u4e00\u53ea $log$ \u7684\u4e3b\u5e2d\u6811\u4e8c\u5206~~\u7136\u540e\u5c31\u5f00\u59cb\u9a82\u8fd9\u9053\u9898\u4e86~~\u3002       \n\n\u521a\u5f00\u59cb\u62ff\u5230\u8fd9\u9053\u9898\u76ee\u5c31\u5f00\u59cb\u5f80 $O(n \\log ^ 3 n)$ \u4e0a\u9762\u60f3\uff0c\u540e\u6765\u53d1\u73b0\u601d\u8def\u6bd4\u8f83\u4e71\u8fd8\u662f\u8003\u8651\u4e00\u5c42\u5c42\u5f80\u5916\u9762\u62c6\u3002                           \n\n\u9996\u5148\u6211\u4eec\u4e0d\u96be\u60f3\u5230\uff0c$G$ \u51fd\u6570\u53cd\u5e94\u7684\u662f\u53d8\u91cf\u4e2d\u6709\u51e0\u4e2a\u4e0d\u540c\u7684\u6570\uff0c\u5e76\u4e14\u6211\u4eec\u7684 $F$ \u51fd\u6570\u662f\u5f62\u5982 $F(L , c) , F(L , c + 1) ......$ \u8fd9\u79cd\u5f62\u5f0f\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u968f\u7740 c \u7684\u5411\u540e\u63a8\u8fdb\u4e00\u4f4d\uff0c\u6211\u4eec $F$ \u7684\u503c\u6bcf\u6b21\u90fd\u81f3\u591a\u52a0\u4e0a 1 \uff0c\u800c\u8fd9\u6837\u5c31\u4f1a\u9020\u6210\u4e00\u6b21\u4e0d\u540c\u7684\u6570\u7684\u51fa\u73b0\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u8f6c\u5316\u6210\u4e86\u7edf\u8ba1\u533a\u95f4\u4e2d\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u7684\u6570\u3002                   \n\n\u7ee7\u7eed\u8f6c\u5316\uff0c\u628a\u9879\u94fe\u7684\u5957\u8def\u5f80\u4e0a\u9762\u4e00\u5957\uff0c\u8fd9\u9053\u9898\u5c31\u81ea\u7136\u53d8\u6210\u4e86\u7edf\u8ba1\u4e00\u4e2a\u6570\u7684 lst \u662f\u5426\u5728\u533a\u95f4 $[L , d]$ \u4e4b\u95f4\u51fa\u73b0\u8fc7\u3002     \n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u73b0\u5728\u7684 $G$ \u51fd\u6570\u53cd\u6620\u7684\u5c31\u662f\u533a\u95f4 $c + 1 \\sim d$ \u8fd9\u4e00\u6bb5\u6570\u7684 lst \u4e0d\u5728\u533a\u95f4 $[L , d]$ \u7684\u4e2a\u6570\uff0c\u8fd9\u4e2a\u76f4\u63a5\u4e3b\u5e2d\u6811\u7ef4\u62a4\u5c31\u597d\u4e86\u3002               \n\n\u63a5\u7740\u6211\u4eec\u53d1\u73b0\u968f\u7740 $L$ \u7684\u63a8\u8fdb\uff0c$G$ \u51fd\u6570\u7684\u503c\u80af\u5b9a\u662f\u5355\u8c03\u4e0d\u9012\u51cf\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e8c\u5206\u4e00\u4e0b $G$ \u51fd\u6570\u7b2c\u4e00\u6b21\u7b49\u4e8e e \u7684\u65f6\u5019 L \u5728\u54ea\u91cc\uff0c\u4ee5\u53ca\u4e8c\u5206\u4e00\u4e0b $G$ \u51fd\u6570\u6700\u540e\u4e00\u6b21\u7b49\u4e8e f \u7684\u65f6\u5019 L \u5728\u54ea\u91cc\uff0c\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u4e3b\u5e2d\u6811\u505a\uff0c\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u53ef\u4ee5 $O(n \\log ^ 2 n)$ \u89e3\u51b3\uff0c\u5f53\u7136\u4f60\u76f4\u63a5 $O(n \\log n)$ \u4e3b\u5e2d\u6811\u4e8c\u5206\u4e5f\u53ef\u4ee5\u3002                  \n           \n\u6ce8\u610f\u51e0\u4e2a\u7ec6\u8282\uff1a             \n\n- 1.\u522b\u8bfb\u9519\u9898\u2026\u2026              \n- 2.\u6ce8\u610f\u4e00\u4e0b\u5b9e\u73b0\u7684\u4e00\u4e9b\u7ec6\u8282\uff0c\u8fd9\u4e9b\u6211\u4ee3\u7801\u91cc\u90fd\u6709\u6ce8\u91ca\uff1b\n- 3.\u6ce8\u610f\u4e00\u5b9a\u8981\u5224\u65ad\u4e00\u4e0b\u7b54\u6848\u662f\u5426\u5408\u6cd5\uff0c\u8d5b\u65f6\u56e0\u4e3a\u8fd9\u4e2a\u95ee\u9898\u597d\u50cf\u88ab\u5361\u4e862h\u2026\u2026\u5f88\u4e22\u4eba\uff08            \n\n\u7a0d\u5fae\u8bc4\u4ef7\u4e00\u4e0b\u8fd9\u9053\u9898\uff0c\u5176\u5b9e\u6709\u96be\u5ea6\uff0c\u4f46\u662f\u56e0\u4e3a trick \u592a\u5e38\u89c1\u5e76\u4e14\u62fc\u51d1\u75d5\u8ff9\u592a\u660e\u663e\uff0c\u6240\u4ee5\u6574\u9053\u9898\u5c31\u663e\u5f97\u6709\u70b9\u62c9\u8de8\u4e86\uff0c\u4e0d\u8fc7\u8fd8\u662f\u5f88\u597d\u7684\u4e00\u4e2aidea\uff0c\u81f3\u5c11\u6211\u53ea\u80fd\u819c\u62dc\u51fa\u9898\u4eba\u3002         \n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int Len = 3e5 + 5;//\u4e3b\u5e2d\u6811 + \u4e8c\u5206 \nint n,m,top,rt[Len],lsh[Len],cnt,lst[Len],nxt[Len],a[Len],num[Len];\nstruct node\n{\n\tint l,r,sum;\t\n}tree[Len * 32];\nint clone(int p)\n{\n\ttop ++;\n\ttree[top] = tree[p];\n\ttree[top].sum ++;\n\treturn top;\n}\nint build(int p,int l,int r)\n{\n\tp = ++ top;\n\tif(l == r) return p;\n\tint mid = (l + r) >> 1;\n\ttree[p].l = build(tree[p].l , l , mid);\n\ttree[p].r = build(tree[p].r , mid + 1 , r);\n\treturn p;\n}\nint update(int p,int l,int r,int wh)\n{\n\tp = clone(p);\n\tif(l == r) return p;\n\tint mid = (l + r) >> 1;\n\tif(wh <= mid) tree[p].l = update(tree[p].l , l , mid , wh);\n\telse tree[p].r = update(tree[p].r , mid + 1 , r , wh);\n\treturn p;\n}\nint query(int l,int r,int nl,int nr,int k)\n{\n\tif(l == r) return tree[nr].sum - tree[nl].sum;\n\tint mid = (l + r) >> 1 , res = 0;\n\tif(mid < k) \n\t{\n\t\tres += tree[tree[nr].l].sum - tree[tree[nl].l].sum;\n\t\tres += query(mid + 1 , r , tree[nl].r , tree[nr].r , k);\n\t\treturn res;\n\t}\n\treturn query(l , mid , tree[nl].l , tree[nr].l , k);\n}\ninline int check(int a,int c,int d,int num)\n{\n\treturn query(0 , n , rt[c] , rt[d] , num - 1) - query(0 , n , rt[c] , rt[d] , a - 1); \n}\nint Sort[15],lens = 0;\ninline void SORT(int &x,int &y,int &c,int &d){Sort[1] = x , Sort[2] = y , Sort[3] = c , Sort[4] = d;sort(Sort + 1 , Sort + 1 + 4);x = Sort[1] , y = Sort[2] , c = Sort[3] , d = Sort[4];}\ninline int read() {\n    char ch = getchar();\n    int x = 0, f = 1;\n    while (ch < '0' || ch > '9') {\n        if (ch == '-')\n            f = -1;\n        ch = getchar();\n    }\n    while ('0' <= ch && ch <= '9') {\n        x = x * 10 + ch - '0';\n        ch = getchar();\n    }\n    return x * f;\n}\ninline void write(int x) {\n    if (x < 0)\n        putchar('-'), x = -x;\n    if (x > 9)\n        write(x / 10);\n    putchar(x % 10 + '0');\n}\nint main()\n{\n\t\n\tn = read() , m = read();\n\tfor(int i = 1 ; i <= n ; i ++) \n\t{\n\t\ta[i] = read();\t\n\t\tlsh[i] = a[i];\n\t}\n\tsort(lsh + 1 , lsh + 1 + n);\n\tcnt = unique(lsh + 1 , lsh + 1 + n) - lsh - 1;\n\tfor(int i = 1 ; i <= n ; i ++) a[i] = lower_bound(lsh + 1 , lsh + 1 + cnt , a[i]) - lsh;\n\trt[0] = build(0 , 0 , n);\n\t//for(int i = 1 ; i <= cnt ; i ++) lsh[i] = n + 1;\n\tfor(int i = 1 ; i <= n ; i ++){num[i] = lst[a[i]] ; lst[a[i]] = i;}\n\tfor(int i = 1 ; i <= n ; i ++) {rt[i] = update(rt[i - 1] , 0 , n , num[i]);}\n\tint lstans = 0;\n\tfor(int i = 1 ; i <= m ; i ++)\n\t{\n\t\tint a,b,c,d,e,f;a = read() , b = read() , c = read() , d = read() , e = read() , f = read();\n\t\ta = (a + lstans) % n + 1 , b = (b + lstans) % n + 1 , c = (c + lstans) % n + 1 , d = (d + lstans) % n + 1;\n\t\t//\u5148\u67e5\u8be2[c , d]\u4e2d\u591a\u5c11\u4e2alst\u5728[a , d]\u4e4b\u95f4  \n\t\tSORT(a , b , c , d);//printf(\"%d %d %d %d\\n\",a,b,c,d);       \n\t\t//printf(\"%d %d\\n\",d,a - 1);\n\t\tint ssb = query(0 , n , rt[c] , rt[d] , a - 1);//[c + 1 , d]\u4e2d\u7684lst\u6709\u591a\u5c11\u4e2a\u4e0d\u5728[a , d]\u4e2d \n\t\tint num = ssb + 1;//\u521d\u59cb\u7b54\u6848\n\t\t//printf(\"%d\\n\",num);\n\t\t//\u63a5\u7740\u4e8c\u5206\u627e\u5230\u7b2c\u4e00\u4e2a\u4e3a e \u7684\u4f4d\u7f6e\n\t\tint l = a , r = b , anss = 1e9;\n\t\twhile(l <= r)\n\t\t{\n\t\t\tint mid = (l + r) >> 1;\n\t\t\tif(check(a , c , d , mid) + num >= e) r = mid - 1 , anss = mid;//\u67e5\u8be2[c + 1 , d]\u4e2d\u6709\u591a\u5c11\u4e2alst\u5728[a , mid - 1]\u4e2d\n\t\t\telse l = mid + 1;\n\t\t} \n\t\tif(anss == 1e9) \n\t\t{\n\t\t\tlstans = 0;\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\t//printf(\"%d\\n\",anss);\n\t\tl = a , r = b;//\u5728\u4e8c\u5206\u627e\u5230\u7b2c\u4e00\u4e2a\u4e3a f \u7684\u4f4d\u7f6e\n\t\tint ansss = 1e9;\n\t\twhile(l <= r)\n\t\t{\n\t\t\tint mid = (l + r) >> 1;\n\t\t\tif(check(a , c , d , mid) + num <= f) l = mid + 1 , ansss = mid;//\u67e5\u8be2[c + 1 , d]\u4e2d\u6709\u591a\u5c11\u4e2alst\u5728[a , mid - 1]\u4e2d \n\t\t\telse r = mid - 1;\n\t\t} \n\t\tif(ansss == 1e9)\n\t\t{\n\t\t\tlstans = 0;\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\tlstans = ansss - anss + 1;\n\t\twrite(lstans) , putchar('\\n');\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1620143502,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7577 \u300cPMOI-3\u300d\u7b80\u5355\u6a21\u62df\u9898"
    }
]