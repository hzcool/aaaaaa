[
    {
        "content": "upd:\u9898\u89e3\u533a\u7684 $\\LaTeX$ \u597d\u50cf\u6709 `bug`\uff0c\u6539\u5b8c\u4e4b\u540e\u5982\u679c\u8fd8\u662fgg\u8bf7\u79fb\u6b65 [$Link$](https://www.cnblogs.com/pks-t/p/12165213.html)\n\n_____\n\n$\\rm SNOI2019$ \u7eb8\u724c\n\n\u9996\u5148\u6211\u89c9\u5f97\u51fa\u9898\u4eba\u80af\u5b9a\u6253\u8fc7 `CF Global Round 1` ~~\u5e76\u4e14\u5f88\u53ef\u80fd\u5728\u90a3\u573a\u6389\u5206\u4e86~~\uff0c\u53ef\u4ee5[\u6233\u8fd9\u91cc](https://codeforces.com/problemset/problem/1110/D) \u53bb\u5eb7\u4e00\u4e0b\u3002\n\n## $\\rm Algorithm \u00b7 1$\n\n\u9996\u5148\u5b9a\u4e49\u72b6\u6001\uff0c$f_{i,j,k}$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u5927\u7684\uff0c\u5176\u4e2d $[i-1,i,i+1]$ \u7c7b\u578b\u6709 $j$ \u4e2a\uff0c $[i,i+1,i+2]$ \u7c7b\u578b\u6709 $k$ \u4e2a\u7684\u65b9\u6848\u6570\u3002\u53d1\u73b0\u8fd9\u4e24\u7c7b\u8fd8\u662f\u6700\u591a\u53ea\u4f1a\u5404\u6709 $2$ \u4e2a\u3002\n\n\u7136\u540e\u5c31\u662f\u8003\u8651\u8f6c\u79fb\u3002\u53d1\u73b0\u8fd8\u662f\u8981\u8f6c\u79fb\u5230 $[i+1,i+2,i+3]$ \u53bb\uff0c\u90a3\u6362\u8a00\u4e4b\u5c31\u662f\u679a\u4e3e $i+3$ \u7684\u4e2a\u6570\u3002\u4f46\u662f\u9898\u76ee\u91cc\u9762\u6709\u9650\u5236 **$k_i$ \u81f3\u5c11\u8981\u62ff $a_i$ \u4e2a**\uff0c\u6240\u4ee5\u8003\u8651\u8fd9\u4e48\u8f6c\u79fb\uff0c\u4ee4 $s=j+k+l$\uff0c\u5373\u987a\u5b50\u91cc\u9762 $i+1$ \u7684\u4e2a\u6570 \uff1a\n\n$$f_{i+1,k,l} = \\begin{cases}f_{i,j,k}\\cdot (\\lfloor \\frac{c-s}{3}\\rfloor + 1) , s\\geq a_{i+1} \\\\ f_{i,j,k}\\cdot (\\lfloor \\frac{c -(s+3\\cdot \\lceil \\frac{a_{i+1}-s}{3}\\rceil )}{3}\\rfloor+1) , s< a_{i+1}\\end{cases}$$\n\n\u5176\u4e2d $+1$ \u4ee3\u8868\u9898\u76ee\u4e2d\u7684 \u201c\u7a7a\u4e5f\u7b97\u662f\u4e00\u79cd\u65b9\u6848\u201d\u3002\u7b2c\u4e8c\u4e2a\u8f6c\u79fb\u4e2d\uff0c\u7531\u4e8e\u679a\u4e3e\u7684\u987a\u5b50\u4e2a\u6570\u5c0f\u4e8e\u5fc5\u9009\u7684\uff0c\u90a3\u4e48\u5c31\u8981\u628a\u5269\u4e0b\u7684\u4e5f\u9009\u6210\u523b\u5b50\u624d\u884c\uff0c\u6240\u4ee5\u5c31\u662f $3\\cdot \\lceil \\frac{a_{i+1}-s}{3}\\rceil $ \uff0c\u5373\u5982\u679c\u4e0d\u8db3\u8fd8\u8981\u591a\u9009\u70b9\u3002\n\n\u5199\u51fa\u4ee3\u7801\u6765\u5927\u6982\u662f\u8fd9\u6837\uff1a\n\n```cpp\ninline int get_v(int x){\n\tx %= 3 ; \n\tif (x == 2) return 1 ; \n\telse if (x == 1) return 2 ; return 0 ; \n}\nsigned main(){\n    cin >> N >> M >> T, dp[0][0][0] = 1 ;\n    for (i = 1 ; i <= T ; ++ i) scanf(\"%lld%lld\", &j, &k), Num[j] = k ;\n    for (i = 1 ; i <= N ; ++ i)\n        for (j = 0 ; j < 3 ; ++ j)\n            for (k = 0 ; k < 3 ; ++ k)\n                for (l = 0 ; l < 3 ; ++ l){\n                    int now = j + k + l, dis ;\n\t\t\t\t\tif (M < now) continue ;\n\t\t\t\t\tif (Num[i] > now) dis = Num[i] + get_v(Num[i] - now) ; else dis = now ;\n      \t\t\t\tif (dis <= M) dp[i][k][l] = (dp[i][k][l] + dp[i - 1][j][k] * ((M - dis) / 3 + 1)) % Mod ;\n\t\t\t\t}\n    cout << dp[N][0][0] << endl ; return 0 ;\n}\n```\n\n\u53ef\u4ee5\u8fc7 $\\rm Subtask~1,2,5$\uff0c\u5171\u8ba1 $55$ \u5206\u3002\n\n## $\\rm Algorithm \u00b72$\n\n\u53d1\u73b0\u8fd9\u4e1c\u897f\u8f6c\u79fb\u53ea\u8ddf\u540e\u4e24\u7ef4\u6709\u5173\uff0c\u5e76\u4e14\u4ece $i$ \u8f6c\u79fb\u5230 $i+1$ \u5e76\u6ca1\u6709\u4ec0\u4e48\u969c\u788d\uff0c\u4e8e\u662f\u8003\u8651\u77e9\u4e58\u3002\n\n\u53d1\u73b0\u7531\u4e8e\u662f $i,j$ \u8f6c\u79fb\u5230 $j,k$ \uff0c\u6545\u9700\u8981 $9\\times 9$ \u7684\u77e9\u9635\u6765\u8f6c\u79fb\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u72b6\u6001\u8003\u8651\u76f4\u63a5\u6309\u884c\u6309\u5217\u7f16\u53f7\uff0c\u8f6c\u79fb\u5c31\u5f88\u7b80\u5355\u4e86\u3002\n\n\u4f46\u95ee\u9898\u5728\u4e8e\u8981\u8003\u8651\u7ea6\u675f\uff0c\u5373\u6bcf\u4e00\u4f4d\u81f3\u5c11\u8981\u9009\u591a\u5c11\u3002\u8fd9\u4e1c\u897f\u7279\u5224\u4e00\u4e0b\u5c31\u53ef\u4e86\u3002\u590d\u6742\u5ea6 $m\\cdot 9^3+9^3\\cdot \\log n$. \n\n\u7136\u800c\u4f3c\u4e4e\u8fd9\u4e1c\u897f\u53ef\u4ee5\u4e00\u5f00\u59cb\u500d\u589e\u51fa\u6765\u8f6c\u79fb\u77e9\u9635\u2026\u2026$\\rm Anyhow$\uff0c\u5e76\u4e0d\u4f1a\u5feb\u591a\u5c11\uff0c\u6bd5\u7adf\u6700\u540e\u538b\u529b\u5c31\u5728 $m$ \u8fd9\u8fb9\u4e86\u3002\n\n```cpp\nLL n, m, c, x, y, lx, ly ;\nstruct matrix{\n    int b[12][12] ;\n    void clear(){ memset(b, 0, sizeof(b)) ; }\n    void reset(){\n        clear() ;\n        for (int i = 0 ; i < 10 ; ++ i)\n            b[i][i] = 1 ;\n    }\n    matrix friend operator * (const matrix &a, const matrix &b){\n        matrix c ; c.clear() ;\n        for (int i = 0 ; i < 10 ; ++ i)\n            for (int j = 0 ; j < 10 ; ++ j)\n                for (int k = 0 ; k < 10 ; ++ k)\n                    c.b[i][j] = (c.b[i][j] + 1ll * a.b[i][k] * b.b[k][j] % Mod) % Mod ;\n        return c ;\n    }\n}ans, unit, tmp ;\n\nmatrix expow(matrix a, LL b){\n    matrix res ; res.reset() ;\n    while (b){\n        if (b & 1)\n            res = res * a ;\n        a = a * a ; b >>= 1 ;\n    }\n    return res ;\n}\nsigned main(){\n    cin >> n >> c >> m ; LL q ; //cout << n << endl ;\n    ans.b[0][0] = 1 ; int i, j, k, l ;\n    for (i = 0 ; i < 3 ; ++ i)\n        for (j = 0 ; j < 3 ; ++ j)\n            for (k = 0 ; k < 3 ; ++ k)\n                if (i + j + k <= c)\n                    unit.b[i * 3 + j][j * 3 + k] = (c - (i + j + k)) / 3ll + 1ll ;\n    for (i = 1 ; i <= m ; ++ i){\n        scanf(\"%lld%lld\", &x, &y), tmp.clear() ;\n        ans = ans * expow(unit, x - lx - 1) ;\n        for (j = 0 ; j < 3 ; ++ j)\n            for (k = 0 ; k < 3 ; ++ k)\n                for (l = 0 ; l < 3 ; ++ l){\n                    int s = j + k + l ;\n                    if (s < y) s = y + ((s - y) % 3 + 3) % 3 ;\n                    if (s <= c) tmp.b[j * 3 + k][k * 3 + l] = (c - s) / 3ll + 1ll ;\n                }\n        lx = x, ly = y, ans = ans * tmp ;\n    }\n    ans = ans * expow(unit, n - (LL)lx), cout << ans.b[0][0] << endl ; return 0 ;\n}\n```\n\n\n",
        "postTime": 1577266330,
        "uid": 28313,
        "name": "\u768e\u6708\u534a\u6d12\u82b1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5371 \u3010[SNOI2019]\u7eb8\u724c\u3011"
    },
    {
        "content": "```ZJOI2019```\u548c```SNOI2019```\u5f88\u795e\u5947\uff0c\u51fa\u9898\u4eba\u4e0d\u7ea6\u800c\u540c\u5730\u559c\u6b22\u6253\u9ebb\u5c06\u3002\n\n\u611f\u89c9\u82b1\u59d0\u59d0\u7684\u9898\u89e3\u5199\u5f97\u5f88\u6e05\u695a\u5566\uff0c\u4e0d\u8fc7\u6211\u4fe9\u89e3\u91ca\u601d\u8def\u7684\u65b9\u5f0f\u80af\u5b9a\u8fd8\u662f\u4f1a\u6709\u6240\u4e0d\u540c\u7684\uff0c\u8bf7\u4e0d\u8981\u56e0\u4e3a\u4ed6\u5199\u5f97\u592a\u597d\u800c\u55b7\u6211\u3002\n\n\u7b97\u6cd5\u4e00\uff1a\u8fd9\u4e2a\u9898\u7684\u66b4\u529b\u548c\u9ebb\u5c06\u6709\u70b9\u50cf\uff0c\u66b4\u529b\u8f6e\u5ed3\u7ebf```dp```, ```dp[i][j][k]```\u8868\u793a\u679a\u4e3e\u5230\u7b2ci\u79cd\u724c\uff0c\u540e\u4e24\u4f4d\u6709j\u5bf9\u5f62\u540c```i - 2, i - 1```\u7684\u4e1c\u897f\uff0c\u989d\u5916\u8fd8\u6709k\u4e2a\u5f62\u540c```i - 1```\u7684\u4e1c\u897f\u7684\u65b9\u6848\u6570\uff0c\u4e0d\u96be\u53d1\u73b0j\u548ck\u6709\u610f\u4e49\u7684\u53d6\u503c\u53ea\u6709```0,1,2```,\u5982\u679c```j,k```\u53d6\u503c\u662f3\u4ee5\u4e0a\u7684\uff0c\u540e\u6765\u5fc5\u7136\u4f1a\u51fa\u73b0\u4e09\u4e2a\u4e00\u6837\u7684\u5f62\u5982```i, i + 1, i + 2```\u7684\u4e1c\u897f\uff0c\u4ed6\u4eec\u4e09\u4e2a\u5c31\u53ef\u4ee5\u7406\u89e3\u4e09\u4e2a\u5f62\u5982```i, i, i```\u7684\u4e1c\u897f\uff0c\u8fd9\u4e2a\u6211\u4eec\u53ef\u4ee5\u7edf\u8ba1\u5230\u65b9\u6848\u6570\u91cc\uff0c\u4e0d\u9700\u8981\u989d\u5916\u518d\u5728\u8f6e\u5ed3\u7ebf\u4e0a\u8bb0\u5f55\u4e86\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8f6e\u5ed3\u7ebfdp\u7684\u590d\u6742\u5ea6\u662fO(n)\u7684\uff0c\u671f\u671b\u5f97\u5206```20 + 15 + 20 = 55```\u3002\n\n\u672c\u6765\u5230\u8fd9\u4e2a\u65f6\u5019\u6211\u5df2\u7ecf\u4e0d\u60f3\u60f3\u4e86\uff0c\u4e0d\u8fc7\u770b\u4e00\u773cD2T2\uff0c\u53d1\u73b0\u5b8c\u5168\u4e0d\u4f1a\uff0c\u53ea\u80fd\u5bc4\u5e0c\u671b\u4e8e\u8fd9\u4e2aT1\u4e86\u3002\n\n\u8fd9\u4e2a\u9898X\u5f88\u5c0f\uff0c\u6478\u7684\u5404\u79cd\u724c\u4e4b\u95f4\u6709\u5f88\u591a\u7a7a\u6321\uff0c\u518d\u770b\u4e00\u773c\u90e8\u5206\u5206\uff0c\u6709X = 0\u8fd9\u4e00\u6863\u7684\uff0c\u4e0d\u96be\u60f3\u5230\u7a7a\u6321\u7684\u89e3\u51b3\u529e\u6cd5\u5c31\u662fX = 0\u8fd9\u4e00\u6863\u5206\u7684\u529e\u6cd5\u3002\n\n\u7b97\u6cd5\u4e8c\uff1a\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8eX = 0\u7684\u60c5\u51b5\uff0c\u8f6c\u79fb\u65b9\u7a0b\u662f\u76f8\u4f3c\u7684\u3002\u5bf9\u4e8e\u76f8\u4f3c\u7684\u8fd0\u7b97\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4ed6\u8fdb\u884c\u5408\u5e76\uff0c\u6bd4\u5982\u52a0\u4e0a\u4e00\u4e2a\u6570,\u52a0\u5f88\u591a\u6b21\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4e58\u6cd5\uff0c\u4e58\u4e00\u4e2a\u6570\uff0c\u4e58\u597d\u591a\u6b21\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4e58\u65b9\uff0c\u4f46\u662f\u540c\u6837\u7684dp\u8f6c\u79fb\u65b9\u5f0f\u8f6c\u79fb\u597d\u591a\u6b21\uff0c\u6211\u4eec\u5f88\u96be\u7528\u4e00\u4e2a\u8fd0\u7b97\u6765\u505a\uff0c\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u5316\u8f6c\u79fb\u4e3a\u77e9\u9635\u8fd0\u7b97\uff0c\u7528\u77e9\u9635\u5feb\u901f\u5e42\u6765\u52a0\u901f\u3002\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u77e9\u9635\u4e58\u6cd5\uff0c\u77e9\u9635\u8fd8\u662f\u5f88\u5bb9\u6613\u6784\u9020\uff0c\u624b\u73a9\u5373\u53ef\u3002\u590d\u6742\u5ea6O(```729logn```)\uff0c\u671f\u671b\u5f97\u520610\u5206\u3002\n\n\u878d\u5408\u7b97\u6cd5\u4e00\u4e0e\u7b97\u6cd5\u4e8c\uff0c\u4e0d\u96be\u5f97\u5230\u7b97\u6cd5\u4e09\uff0c\u5bf9\u4e8e\u6709\u6478\u5230\u7684\u724c\u7684\u5730\u65b9\u76f4\u63a5\u66b4\u529bdp\uff0c\u7a7a\u6321\u505a\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u590d\u6742\u5ea6O\uff08```729Xlogn```\uff09\uff0c\u671f\u671b\u5f97\u5206100\u3002\n\n\u6b63\u597d\u8fd9\u51e0\u5929\u6709\u70b9\u65e0\u804a\uff0c\u770b\u4e86\u51e0\u773c\u82b1\u59d0\u59d0\u7684\u4ee3\u7801\uff0c\u611f\u89c9\u8fd8\u633a\u597d\u5199\u7684\uff0c\u4e5f\u5c31updaet\u4e86\u4e00\u4efd\u4ee3\u7801\uff0c\u672c\u6765\u60f3\u5bf9\u6709\u6478\u5230\u7684\u724c\u7684\u5730\u65b9\u8fdb\u884c\u66b4\u529bdp\u7684\uff0c\u4e0d\u8fc7\u4e3a\u4e86\u65b9\u4fbf\u81ea\u5df1\u8c03\u8bd5\uff0c\u8fd8\u662f\u7528\u77e9\u9635\u6765\u8fdb\u884c\u8f6c\u79fb\u4e86\u3002\n\n```ccp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define mod 998244353\n#define For(i, j, n) for(register int i = j ; i <= n ; ++i)\nint n, m, x, y, C, lx;\n\nstruct materix{\n\tint a[10][10];\n\tfriend materix operator * (materix x, materix y){\n\t\tmaterix z; memset(z.a, 0, sizeof(z.a));\n\t\tFor(i, 0, 8) For(j, 0, 8) For(k, 0, 8) z.a[i][j] = (z.a[i][j] + x.a[i][k] * y.a[k][j]) % mod;\n\t\treturn z;\n\t}\n}b, ans, tmp;\ninline materix quickpow(materix x, int y){\n\tmaterix sum; memset(sum.a, 0, sizeof(sum.a));//\u4e0dmemset,\u4f60\u4f1a\u5feb\u4e50RE\u7684\n\tFor(i, 0, 8) sum.a[i][i] = 1;//\u6784\u9020\u5355\u4f4d\u77e9\u9635 \n\tfor( ; y ; x = x * x, y >>= 1) if(y & 1) sum = sum * x;\n\treturn sum;\n}\n\nsigned main(){\n\tscanf(\"%lld %lld %lld\", &n, &C, &m), ans.a[0][0] = 1;\n\t//i\u4ee3\u8868\u5f62\u5982i - 2,i - 1\u7684\u4e1c\u897f\u6709i\u5f20\uff0cj\u4ee3\u8868\u5f62\u5982i - 1\u7684\u4e1c\u897f\u6709j\u5f20 \uff0ck\u6478\u4e86k\u5f20i \uff0c\u72b6\u6001\u7f16\u53f7\u4e3ai * 3 + j \n\tFor(i, 0, 2) For(j, 0, 2) For(k, 0, 2) if(i + j + k <= C) b.a[i * 3 + j][j * 3 + k] = (C - i - j - k) / 3 + 1;\n\tFor(i, 1, m){\n\t\tscanf(\"%lld %lld\", &x, &y), memset(tmp.a, 0, sizeof(tmp.a)), ans = ans * quickpow(b, x - lx - 1);\n\t\t//\u6784\u9020\u4e00\u4e2a\u7279\u6b8a\u7684\u77e9\u9635\u6570\u7ec4tmp\uff0c\u8fdb\u884cdp\u8f6c\u79fb\uff0cj, k, l\u4e0e\u4e0a\u6587\u542b\u4e49\u7c7b\u4f3c\uff0c\u4e0d\u518d\u8d58\u8ff0 \n\t\tFor(j, 0, 2){\n\t\t\tFor(k, 0, 2){\n\t\t\t\tFor(l, 0, 2){\n\t\t\t\t\tint s = j + k + l;\n\t\t\t\t\tif(s < y) s = s + ((y - s - 1) / 3 * 3 + 3);//\u6700\u5c11\u6478y\u5f20\u561b\uff0cs\u8865\u5230s + 3k(s + 3k >= y)\t\t\t \n\t\t\t\t\tif(s <= C) tmp.a[j * 3 + k][k * 3 + l] = (C - s) / 3 + 1;\n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t\tlx = x, ans = ans * tmp;\n\t}\n\tans = ans * quickpow(b, n - lx), printf(\"%lld\", ans.a[0][0]); //\u522b\u5fd8\u4e86\u6700\u540e\u8fd8\u6709\u4e00\u6bb5\u7a7a\u6321 \n\treturn 0;\n}\n```",
        "postTime": 1585814401,
        "uid": 163980,
        "name": "\u884c\u541f\u5578\u4e5d\u5dde",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5371 \u3010[SNOI2019]\u7eb8\u724c\u3011"
    },
    {
        "content": "### Update\n\n\u62b1\u6b49\u6807\u9898\u5199\u9519\u4e86\uff0c\u91cd\u65b0\u4ea4\u4e00\u4e0b\u3002\n\n\u540c\u65f6\u8865\u5145\u8bf4\u660e\u4e00\u4e0b\uff0c\u5173\u4e8e\u540e\u9762 $B$ \u7684\u5927\u5c0f\uff0c\u53d6 $8$ \u662f\u56e0\u4e3a\u8fd9\u4e2a\u4e1c\u897f\u672c\u8eab\u5c31\u975e\u5e38\u8dd1\u4e0d\u6ee1\uff0c\u4ee5\u53ca\u53ef\u4ee5\u7528\u4e8c\u8fdb\u5236\u4f18\u5316\u5e38\u6570\u3002\n\n### \u524d\u8a00\n\n\u611f\u89c9\u8fd9\u79cd\u8ba1\u6570\uff0c\u4e00\u770b\u5230\uff0c\u5c31\u5f88 dp \u5957 dp \u554a\uff01\n\n\u5c31\uff0c\u611f\u89c9\u5c31\u662f\u300cZJOI2019\u300d\u9ebb\u5c06\uff0c\u7684\u9ad8\u6e05\u91cd\u5236\u7248\u5450\uff01\n\n### \u601d\u8def\n\n\u4ee5\u4e0b\u79f0 $(i,i,i)$ \u4e3a\u523b\u5b50\uff0c$(i,i+1,i+2)$ \u4e3a\u987a\u5b50\uff0c\u5408\u6cd5\u60c5\u5f62\u79f0\u4e3a\u80e1\u724c\u3002\n\n\u9996\u5148\uff0c\u4e00\u4e2a\u724c\u53d6 $v>6$ \u7684\u53ef\u884c\u6027\uff0c\u4e0e $v-3$ \u76f8\u540c\uff1b\u4e5f\u5373\uff0c\u4e0e $(v-4)\\bmod3+4$ \u76f8\u540c\u3002\n\n\u56e0\u4e3a\uff0c\u5982\u679c\u5176\u6709\u523b\u5b50\uff0c\u53ef\u4ee5\u6316\u6389\uff1b\u5982\u679c\u6ca1\u6709\uff0c\u5219\u7531\u62bd\u5c49\u539f\u7406\uff0c\u6709\u81f3\u5c11 $3$ \u4e2a\u5b8c\u5168\u76f8\u540c\u7684\u987a\u5b50\u7ed3\u6784\u7ecf\u8fc7\u4e4b\uff0c\u53ef\u4ee5\u8f6c\u5316\u6210\u523b\u5b50\u7684\u60c5\u5f62\u7136\u540e\u4ecd\u7136\u5408\u6cd5\u3002\n\n\u53cd\u8fc7\u6765\uff0c\u4ece $v-3$ \u5408\u6cd5\u5230 $v$ \u5408\u6cd5\u7684\u63a8\u5bfc\uff0c\u53ef\u4ee5\u591a\u52a0\u4e00\u4e2a\u523b\u5b50\u3002\n\n\u56e0\u6b64\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u5176\u6709 $a_i$ \u79cd\u53d6 $i$ \u5f20\u724c\u7684\u65b9\u6848\uff0c\u5176\u4e2d $i\\in\\{0,1,2,3,4,5,6\\}$\u3002\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u5efa\u201c\u80e1\u724c\u81ea\u52a8\u673a\u201d\u4e86\u3002\n\n\u5373\uff0c\u6211\u4eec\u8bb0\u5f55\u5176\u524d\u9762\u4e24\u79cd\u987a\u5b50\u5206\u522b\u6709\u591a\u5c11\u4e2a\uff08\u5747\u4e3a $0\\sim2$ \u4e2a\uff09\uff0c\u7ecf\u8fc7\u67d0\u79cd\u65f6\u5148\u9664\u53bb\u524d\u9762\u4e24\u79cd\u987a\u5b50\u7684\u8d21\u732e\uff0c\u7136\u540e\u628a\u523b\u5b50\u5c3d\u53ef\u80fd\u591a\u53d6\uff0c\u5269\u4e0b\u7684\u518d\u4f5c\u4e3a\u987a\u5b50\u7684\u8d77\u70b9\uff1b\u5bb9\u6613\u8bc1\u660e\uff0c\u4efb\u4f55\u4e00\u4e2a\u724c\u7684\u80e1\u6001\u90fd\u53ef\u4ee5\u8fd9\u4e48\u8868\u8ff0\uff0c\u4e14\u552f\u4e00\u8868\u8ff0\u3002\uff08\u611f\u89c9\u8fd9\u4e48\u63cf\u8ff0\u597d\u62bd\u8c61\u554a\uff0c\u4f46\u662f\u60f3\u4e0d\u51fa\u66f4\u597d\u7684\u63cf\u8ff0\u4e86\uff09\n\n\u8fd9\u6837\uff0c\u6bcf\u4e2a\u724c\u7684\u9009\u6cd5\u603b\u6570\u53ef\u4ee5\u63cf\u8ff0\u4e3a\u4e00\u4e2a**\u7ebf\u6027\u53d8\u6362**\uff0c\u4e8e\u662f\u53ef\u4ee5\u7528\u77e9\u9635\u4e58\u6cd5\u63cf\u8ff0\u3002\n\n\u7136\u540e\u8fd9\u6837\u5b50\uff0c\u5bf9\u76f8\u90bb\u7684\u724c\u4e4b\u95f4\u7684\u90e8\u5206\u4e0a**\u77e9\u9635\u5feb\u901f\u5e42**\uff0c\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u53d1\u73b0\u6bcf\u4e2a $i$ \u5904 DP \u7684\u72b6\u6001\u662f $3\\times3=9$ \u79cd\u7684\uff0c\u6240\u4ee5\u77e9\u9635\u90fd\u662f $9\\times9$ \u7684\uff0c\u505a $O(X)$ \u8f6e\u5feb\u901f\u5e42\u80af\u5b9a\u6ca1\u95ee\u9898\u3002\n\n\u7136\u540e\u6ce8\u610f\u5230 `unsigned long long` \u5141\u8bb8\u6211\u4eec\u5f00\u4e0b $9\\times998244352\\times998244352$ \u7684\u5927\u5c0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u5148\u6c42\u548c\u518d\u53d6\u6a21\uff0c\u5927\u5927\u51cf\u5c0f\u4e86\u5e38\u6570\u3002\n\n\u8bbe $a=9$\uff0c\u603b\u590d\u6742\u5ea6\u5373\u4e3a $O(a^3X\\log n)$\u3002\n\n\u7136\u540e\u8fd9\u4e2a\u8fd8\u662f\u592a\u900a\u4e86\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u8003\u8651**\u500d\u589e\u9884\u5904\u7406** $n$ \u4ee5\u5185\u7684\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u7136\u540e\u6bcf\u6b21**\u4e58\u5411\u91cf**\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(a^3\\log n+a^2X\\log n)$\uff0c\u53ef\u4ee5\u8f7b\u677e\u901a\u8fc7\u3002\n\n\u7136\u540e\u5c31\u662f\u8003\u8651\u628a\u666e\u901a\u500d\u589e\u6539\u4e3a\u6539\u4e3a**\u9ad8\u8fdb\u5236\u5feb\u901f\u5e42**\uff0c\u5047\u8bbe\u662f $B$ \u8fdb\u5236\uff0c\u5219\u4e3a $O((a^3B+{a^2X})\\log_Bn)$\u3002\n\n\u53d6 $B=\\Theta(\\frac Xa)$\uff0c\u590d\u6742\u5ea6\u5373\u4e3a $O(a^2X\\log_{\\frac Xa}n)$\u3002\n\n### Code\n\n\u6211\u53d6\u4e86 $B=8$\u3002\n\n\u8dd1\u5f97\u5f88\u5feb\uff0c\u76ee\u524d\u662f [loj \u6700\u4f18\u89e3](https://loj.ac/s/1689531)\u3002\n\n```cpp\nconst ullt Mod=998244353;\nconst uint Lim=9;\nusing Vec = ullt[Lim];\nusing Mat = Vec[Lim];\ninline voi copy(Mat a,Mat b){\n    for(uint i=0;i<Lim;i++)for(uint j=0;j<Lim;j++)b[i][j]=a[i][j];\n}\ninline voi mul(Mat a,Mat b,Mat c){\n    for(uint i=0;i<Lim;i++)for(uint j=0;j<Lim;j++)\n        for(uint k=0;k<Lim;k++)c[i][k]+=a[i][j]*b[j][k];\n    for(uint i=0;i<Lim;i++)for(uint j=0;j<Lim;j++)c[i][j]%=Mod;\n}\ninline voi muleq(Vec a,Mat b){\n    static Vec c;\n    for(uint i=0;i<Lim;i++)c[i]=0;\n    for(uint i=0;i<Lim;i++)for(uint j=0;j<Lim;j++)c[j]+=a[i]*b[i][j];\n    for(uint i=0;i<Lim;i++)a[i]=c[i]%Mod;\n}\nMat Base[25][8],M;Vec Ans;\nullt A[7];\nvoi update(uint n){\n    if(!~n)A[0]=A[1]=A[2]=A[3]=A[4]=A[5]=A[6]=0;\n    else if(n<=6)for(uint i=0;i<=6;i++)A[i]=n>=i;\n    else A[0]=A[1]=A[2]=A[3]=1,A[4]=(n-1)/3,A[5]=(n-2)/3,A[6]=n/3-1;\n}\nint main()\n{\n#ifdef MYEE\n    freopen(\"QAQ.in\",\"r\",stdin);\n    // freopen(\"QAQ.out\",\"w\",stdout);\n#endif\n    ullt n;uint c,x;scanf(\"%llu%u%u\",&n,&c,&x),update(c);\n    for(uint i=0;i<=6;i++)for(uint j=0;j<=2;j++)for(uint k=0;k<=2;k++)if(j+k<=i)\n        Base[0][1][j*3+k][k*3+(i-j-k)%3]+=A[i];\n    for(uint i=0;;i++){\n        static ullt v=1;\n        mul(Base[i][1],Base[i][1],Base[i][2]);\n        mul(Base[i][2],Base[i][1],Base[i][3]);\n        mul(Base[i][3],Base[i][1],Base[i][4]);\n        mul(Base[i][4],Base[i][1],Base[i][5]);\n        mul(Base[i][5],Base[i][1],Base[i][6]);\n        mul(Base[i][6],Base[i][1],Base[i][7]);\n        if((v<<=3)>n)break;\n        mul(Base[i][7],Base[i][1],Base[i+1][1]);\n    }\n    std::vector<std::pair<ullt,uint> >V(x);\n    for(auto&s:V)scanf(\"%llu%u\",&s.first,&s.second);\n    std::sort(V.begin(),V.end());\n    Ans[0]=1;\n    ullt a=0;\n    for(auto s:V){\n        a=s.first-a-1;for(uint i=0;a;i++,a>>=3)if(a&7)muleq(Ans,Base[i][a&7]);\n        a=s.first,copy(Base[0][1],M),update(s.second-1);\n        for(uint i=0;i<=6;i++)for(uint j=0;j<=2;j++)for(uint k=0;k<=2;k++)if(j+k<=i)\n            M[j*3+k][k*3+(i-j-k)%3]-=A[i];\n        muleq(Ans,M);\n    }\n    a=n-a;for(uint i=0;a;i++,a>>=3)if(a&7)muleq(Ans,Base[i][a&7]);\n    printf(\"%llu\\n\",Ans[0]);\n    return 0;\n}\n```\n",
        "postTime": 1675220422,
        "uid": 105050,
        "name": "myee",
        "ccfLevel": 7,
        "title": "5371"
    },
    {
        "content": "#### \u9898\u610f\u7b80\u8ff0\n\n\u6709\u4e00\u526f\u7eb8\u724c\uff0c\u724c\u4e00\u5171\u6709 $n$ \u79cd\uff0c\u5206\u522b\u4e3a $1,2,\\cdots,n$\uff0c\u6bcf\u79cd\u6709 $C$ \u5f20\u3002\n\n\u4e09\u5f20\u5f62\u5982 $(i,i+1,i+2)$ \u6216 $(i,i,i)$ \u7684\u724c\u53ef\u4ee5\u7ec4\u6210\u4e00\u53e0\uff0c\u73b0\u5728\u7ed9\u5b9a\u4e00\u724c\u96c6\uff0c\u7531 $X$ \u79cd\u724c\u7ec4\u6210\uff0c\u5176\u4e2d\u7b2c $i$ \u79cd\u724c\u4e3a $k_i$\uff0c\u51fa\u73b0\u4e86 $a_i$ \u6b21\uff0c\u6c42\u7ed9\u5b9a\u724c\u96c6\u7684\u8d85\u96c6\u4e2d\u6709\u591a\u5c11\u4e2a\u53ef\u4ee5\u88ab\u5206\u4e3a\u82e5\u5e72\u53e0\u724c\uff0c\u5bf9 $P=998244353$ \u53d6\u6a21\uff0c\u5176\u4e2d\u4e24\u7ec4\u724c\u76f8\u540c\u5f53\u4e14\u4ec5\u5f53\u5b83\u4eec\u542b\u6709\u7684\u6bcf\u4e00\u79cd\u724c\u6570\u91cf\u90fd\u76f8\u540c\u3002\n\n\u5bf9\u4e8e $20\\%$ \u7684\u6570\u636e\uff0c$n=9$\uff0c$C=4$\uff1b  \n\u5bf9\u4e8e\u53e6\u5916 $15\\%$ \u7684\u6570\u636e\uff0c$n\\le10^5$\uff0c$C=2$\uff1b   \n\u5bf9\u4e8e\u53e6\u5916 $15\\%$ \u7684\u6570\u636e\uff0c$X\\le5$\uff0c$C\\le10$\uff1b  \n\u5bf9\u4e8e\u53e6\u5916 $10\\%$ \u7684\u6570\u636e\uff0c$X=0$\uff1b  \n\u5bf9\u4e8e\u53e6\u5916 $20\\%$ \u7684\u6570\u636e\uff0c$n\\le10^5$\uff1b  \n\u5bf9\u4e8e\u6240\u6709\u6570\u636e\uff0c$n\\le10^{18}$\uff0c$a_i,C,X\\le1000$\u3002   \nBonus\uff1a$n\\le10^{18}$\uff0c$X\\le 60000$\u3002\n\n#### \u9898\u76ee\u89e3\u6cd5\n\n\u5148\u6765\u8003\u8651\u5f53\u7ed9\u5b9a\u724c\u96c6\u786e\u5b9a\u65f6\uff0c\u5982\u4f55\u5224\u65ad\u5176\u662f\u5426\u53ef\u4ee5\u88ab\u5206\u4e3a\u82e5\u5e72\u53e0\u724c\u3002\n\n\u8d2a\u5fc3\u5339\u914d\u663e\u7136\u662f\u6b63\u786e\u7684\uff0c\u4f46\u662f\u8fd9\u4e0d\u5177\u6709\u6269\u5c55\u6027\u3002\n\n\u5ef6\u7eed\u8d2a\u5fc3\u7684\u601d\u60f3\uff0c\u9010\u79cd\u724c\u52a0\u5165\uff0c\u8003\u8651\u5982\u4f55\u7528\u4e00\u4e2a\u7b80\u5c0f\u7684\u72b6\u6001\u6765\u523b\u753b\u5f53\u524d\u60c5\u51b5\u6765\u5408\u5e76\u7b49\u4ef7\u7c7b\uff0c\u5bb9\u6613\u53d1\u73b0\uff0c\u6211\u4eec**\u53ea\u5173\u5fc3\u5f53\u524d\u60c5\u51b5\u4e0b\u63d2\u5165\u540e\u7684\u7684 $(i-1,i,i+1)$ \u4ee5\u53ca $(i,i+1,i+2)$ \u5bf9\u6570**\u3002\n\n\u8003\u8651\u6269\u5c55\u5230\u8ba1\u6570\u4e0a\uff0c\u8bb0 $f_{i,j,k}$ \u8868\u793a\u5f53\u524d\u63d2\u5165\u4e86\u7b2c $i$ \u79cd\u724c\uff0c$(i-1,i,i+1)$ \u7684\u5bf9\u6570\u4e3a $j$\uff0c$(i,i+1,i+2)$ \u7684\u5bf9\u6570\u4e3a $k$ \u7684\u65b9\u6848\u6570\u3002\n\n\u4f46\u662f\u4ee5\u4e0a\u65b9\u6848\u53ef\u80fd\u4f1a\u5728\u4e00\u4e2a\u724c\u96c6\u6709\u591a\u79cd\u5212\u5206\u65b9\u5f0f\u65f6\u91cd\u590d\u8ba1\u6570\uff0c\u4e14\u65f6\u95f4\u590d\u6742\u5ea6\u8fc7\u52a3\uff0c\u8003\u8651\u5982\u4f55\u9650\u5236 $\\texttt{DP}$ \u72b6\u6001\u6216\u8f6c\u79fb\u3002\n\n\u4e00\u4e2a\u5728\u9ebb\u5c06\u9898\u7ecf\u5e38\u51fa\u73b0\u7684\u5957\u8def\u662f\uff1a**\u4e09\u5bf9\u4e00\u6837\u7684\u9762\u5b50 $(i,i+1,i+2)$ \u53ef\u4ee5\u8f6c\u5316\u4e3a\u4e09\u5bf9\u523b\u5b50 $(i,i,i)$\uff0c\u4e14\u5728\u6b64\u79cd\u9650\u5236\u4e0b\uff08\u5373\u4e0d\u5b58\u5728\u8d85\u8fc7\u4e24\u5bf9\u4e00\u6837\u7684\u9762\u5b50\uff09\u7684\u65b9\u6848\u662f\u552f\u4e00\u7684**\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06 $j,k$ \u7684\u503c\u57df\u9650\u5b9a\u4e3a $0,1,2$\uff0c\u6b64\u65f6\u66b4\u529b\u8ba1\u7b97\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(nC)$\u3002\n\n\u89c2\u5bdf $f$ \u7684\u8f6c\u79fb\u65b9\u7a0b\uff08\u8bb0 $s=j+k+l$\uff0c\u4e14\u5047\u8bbe $s\\le C$\uff0c\u56e0\u4e3a\u53ea\u6709\u6b64\u65f6 $f_{i,j,k}$ \u624d\u6709\u8d21\u732e\uff09\uff1a\n$$\nf_{i+1,k,l}=\\begin{cases}f_{i,j,k}\\times\\left(\\left\\lfloor\\dfrac{C-s}{3}\\right\\rfloor\\right)+1&s\\ge a_{i+1}\\\\f_{i,j,k}\\times\\left(\\left\\lfloor\\dfrac{C-s-3\\times\\left\\lfloor\\frac{a_{i+1}-s}{3}\\right\\rfloor}{3}\\right\\rfloor+1\\right)&s<a_{i+1}\\end{cases}\n$$\n\u53d1\u73b0**\u8fd9\u662f\u4e00\u4e2a\u77e9\u9635\u4e58\u6cd5\u7684\u5f62\u5f0f**\uff01\n\n\u5177\u4f53\u7684\uff0c\u5c06 $f_{i,j,k}\\small(0\\le j,k<3)$ \u7684\u72b6\u6001\u6539\u4e3a $f_{i,3j+k}$\uff0c\u5219\u6b64\u65f6\u77e9\u9635\u4e58\u6cd5\u7684\u5f62\u5f0f\u4fbf\u6e05\u6670\u4e86\u3002\n\n\u4e4b\u540e\u53ef\u4ee5\u76f4\u63a5\u91c7\u7528**\u77e9\u9635\u5feb\u901f\u5e42**\u8fdb\u884c\u4f18\u5316\uff0c\u8bbe\u5f53 $a_{i+1}=x$ \u65f6\u5bf9\u5e94\u7684\u8f6c\u79fb\u77e9\u9635\u4e3a $g(x)$\uff0c\u90a3\u4e48\u7531\u4e8e\u521d\u59cb\u724c\u96c6\u7684\u5b58\u5728\uff0c\u7b54\u6848\u5373\u4e3a $g(0)^{k_1-1}g(a_1)g(0)^{k_2-k_1-1}g(a_2)\\cdots g(a_X)g(0)^{n-k_X}$\uff0c\u66b4\u529b\u8ba1\u7b97\u5373\u53ef\u505a\u5230 $\\mathcal{O}(Xc^3\\log n)$\uff0c\u5176\u4e2d $c=9$ \u4e3a\u8f6c\u79fb\u77e9\u9635\u5927\u5c0f\u3002\n\n\u66f4\u4f18\u79c0\u7684\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6240\u6709\u5f62\u5982 $g(0)^{2^x}$ \u7684\u77e9\u9635\u5e42\u7ed3\u679c\uff0c\u4e4b\u540e\u91c7\u7528\u5411\u91cf\u4e58\u77e9\u9635\u5373\u53ef\u5feb\u901f\u8ba1\u7b97\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(c^3\\log n+c^2X\\log n)$\u3002\n\n#### \u603b\u7ed3\n\n\u5148\u8003\u8651\u539f\u95ee\u9898\u7684\u5177\u6709\u63a8\u5e7f\u6027\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u518d\u5bf9\u8ba1\u6570\u95ee\u9898\u8fdb\u884c $\\texttt{DP}$\uff0c\u5e76\u5bf9\u539f\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\u4e2d\u67d0\u5207\u9762\u7684\u7b49\u4ef7\u7c7b\u8fdb\u884c\u5408\u5e76\uff0c\u5e38\u5e38\u5728\u6b64\u7c7b $\\texttt{DP}$ \u5957 $\\texttt{DP}$ \u7684\u95ee\u9898\u4e2d\uff0c\u8f6c\u79fb\u5177\u6709\u4e00\u822c\u6027\uff08\u5373\u6bcf\u6b21\u8f6c\u79fb\u7684\u65b9\u5f0f\u4e00\u6837\uff09\uff0c\u6b64\u65f6\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8fdb\u884c\u4f18\u5316\u3002",
        "postTime": 1680947293,
        "uid": 183609,
        "name": "hhoppitree",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5371"
    }
]