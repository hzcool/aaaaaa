[
    {
        "content": ">  \u9898\u76ee\u96be\u5ea6\uff1aUSACO P/\u7701\u9009\n\n\u5148\u60f3\u66b4\u529b\u505a\u6cd5\u3002\u6ce8\u610f\u5230\u4e00\u4e2a\u4eba\u4e0d\u4f1a\u91cd\u590d\u4e70\u7968\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u79cd\u7968\u770b\u4f5c\u865a\u62df\u8282\u70b9\uff0c\u4e70\u7968\u770b\u4f5c\u4ece $c_i$ \u5230 $i$ \u53f7\u7968\u8fb9\u6743\u4e3a $p_i$ \u7684\u8fb9\uff0c\u540c\u65f6 $i$ \u53f7\u7968\u5411\u533a\u95f4 $[a_i,b_i]$ \u4e2d\u7684\u6240\u6709\u70b9\u8fde\u8fb9\u6743\u4e3a $0$ \u7684\u8fb9\u3002\u9898\u76ee\u5e0c\u671b\u6c42\u51fa\u6bcf\u4e2a\u70b9\u5230\u8fbe $1$ \u548c $n$ \u6240\u9700\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u4e0d\u59a8\u5efa\u53cd\u56fe\u4ee5 $1$ \u548c $n$ \u4e3a\u539f\u70b9\u5206\u522b\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u3002\n\n\u7136\u800c\u8fd9\u6837\u4f1a\u559c\u63d0 WA \u3002\u56e0\u4e3a\u4ecd\u7136\u6ca1\u6709\u89e3\u51b3\u91cd\u590d\u4e70\u7968\u7684\u95ee\u9898\uff0c\u4e24\u6761\u6700\u77ed\u8def\u7684\u4ea4\u96c6\u4e2d\u7684\u6240\u6709\u8fb9\u88ab\u7b97\u4e86\u4e24\u904d\u3002\u600e\u4e48\u89e3\u51b3\uff1f\u5148\u8bb0\u5f53\u524d\u7b54\u6848\u4e3a $dis_i=d1_i+dn_i$ \uff0c\u82e5\u8282\u70b9 $u$ \u7684\u4e24\u6761\u6700\u77ed\u8def\u5747\u7ecf\u8fc7\u5b83\u7684\u90bb\u5c45 $v$ \uff0c\u4e0d\u96be\u53d1\u73b0 $dis_u=dis_v+w$ \u3002\u8fd9\u548c\u5355\u6e90\u6700\u77ed\u8def\u7684\u677e\u5f1b\u672c\u8d28\u76f8\u540c\uff0c\u6211\u4eec\u5bf9\u7b54\u6848\u6570\u7ec4\u91cd\u65b0\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(NK\\log(NK))$\n\n\u4e0b\u9762\u63d0\u4f9b\u4e24\u79cd\u4f18\u5316\u7684\u601d\u8def\uff0c\u7b2c\u4e00\u79cd\u662f\u8003\u573a\u7b2c\u4e00\u773c\u770b\u51fa\u7684\u7ebf\u6bb5\u6811\u4f18\u5316\u5efa\u56fe\uff0c\u5177\u4f53\u77e5\u8bc6\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u535a\u5ba2 [DS\u4f18\u5316\u5efa\u56fe](https://www.luogu.com.cn/blog/forever-captain/DS-optimize-graph) \u3002\n\n\u5bf9\u533a\u95f4\u4e2d\u7684\u6bcf\u4e2a\u70b9\u66b4\u529b\u8fde\u8fb9\u662f\u4e0d\u597d\u7684\uff01\u6211\u4eec\u7528\u7ebf\u6bb5\u6811\u5efa\u56fe\u7684\u65b9\u5f0f\u8fde\u8fb9\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N\\log^2 N)$ \u3002USACO\u8bc4\u6d4b\u673a\u6216\u6d1b\u8c37\u5f00 O2 \u5747\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define ll long long\nusing namespace std;\ninline ll read(){\n    ll x=0,f=1;char ch=getchar();\n    while (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}\n    while (isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n    return x*f;\n}\nconst int N=1e6+5,M=7e6+5;\nconst ll inf=1e16;\nint head[N],cnt;\nstruct Edge{\n    int to,nxt,w;\n}e[M];\ninline void add(int u,int v,int w){e[++cnt]={v,head[u],w};head[u]=cnt;}\nint n,q,s;\nstruct Node{int l,r;}t[N];\n#define ls (p<<1)\n#define rs (ls|1)\ninline void build(int p,int l,int r){\n    t[p].l=l,t[p].r=r;\n    if(l==r){//\u53f6\u5b50\u8282\u70b9\u4e0e\u539f\u56fe\u52a0\u8fb9\n        add(l+8*n,p,0);add(p+4*n,l+8*n,0);\n        add(p,l+8*n,0);add(l+8*n,p+4*n,0);\n        return;\n    }\n    //\u5411\u513f\u5b50\u8fde\u8fb9\n    add(p,ls,0);add((ls)+4*n,p+4*n,0);\n    add(p,rs,0);add((rs)+4*n,p+4*n,0);\n    int mid=(l+r)>>1;\n    build(ls,l,mid);\n    build(rs,mid+1,r);\n}\ninline void upd(int p,int L,int R,int u,int w){\n    int l=t[p].l,r=t[p].r,mid=(l+r)>>1;\n    if(l==L&&r==R){//\u5f53\u524d\u8282\u70b9\u8986\u76d6\u533a\u95f4\n        add(p+4*n,u+8*n,w);\n        return;\n    }\n    if(R<=mid)upd(ls,L,R,u,w);\n    else if(L>mid)upd(rs,L,R,u,w);\n    else{\n        upd(ls,L,mid,u,w);upd(rs,mid+1,R,u,w);\n    }\n}\nll dis[N],d[N];\nstruct node{\n    ll dis;int pos;\n    bool operator <( const node &x )const{\n        return x.dis < dis;\n    }\n};\nbool vis[N];\npriority_queue <node> pq;\ninline void dijkstra(bool op=0){\n    if(!op){\n        memset(dis,0x3f,sizeof(dis));\n        dis[s]=0;pq.push({0,s});\n    }else{\n        rep(i,1,9*n+q)pq.push({dis[i],i});\n    }\n    memset(vis,0,sizeof(vis));\n    while(!pq.empty()){\n        node tmp=pq.top();pq.pop();\n        int x=tmp.pos;\n        if(vis[x])continue;\n        vis[x]=1;\n        for(int i=head[x];i;i=e[i].nxt){\n            int y=e[i].to;\n            if(dis[y]>dis[x]+e[i].w){\n                dis[y]=dis[x]+e[i].w;\n                pq.push({dis[y],y});\n            }\n        }\n    }\n}\nint main(){\n    n=read(),q=read();\n    build(1,1,n);\n    rep(i,1,q){\n        int a=read(),w=read(),b=read(),c=read();\n        upd(1,b,c,i+n,0);\n        add(9*n+i,a+8*n,w);\n    }\n    s=8*n+1;\n    dijkstra();\n    memcpy(d,dis,sizeof(d));\n    //rep(i,1,n)cout<<dis[i+8*n]<<' ';\n    s=9*n;\n    dijkstra();\n    rep(i,1,9*n+q)dis[i]+=d[i];\n    dijkstra(1);\n    rep(i,1,n){\n        if(dis[i+8*n]>inf)puts(\"-1\");\n        else printf(\"%lld\\n\",dis[i+8*n]);\n    }\n    return 0;\n}\n```\n\n\u5982\u4f55\u4f18\u5316\uff1f\u8003\u8651 dijkstra \u65f6\u5b9e\u9645\u4e0a\u5728\u505a\u4ec0\u4e48\u3002\u539f\u56fe\u4e2d\u7684\u8282\u70b9\u4f1a\u5f71\u54cd\u5c06\u5b83\u5305\u542b\u7684\u7968\u7684\u865a\u62df\u8282\u70b9\uff0c\u7136\u540e\u8fd9\u4e2a\u865a\u62df\u8282\u70b9\u4ec5\u5f71\u54cd\u5176\u6240\u5bf9\u5e94\u7684\u4e00\u4e2a\u539f\u56fe\u8282\u70b9 $(i\\to c_i)$ \u3002\u5176\u6b21\uff0c\u6211\u4eec\u77e5\u9053\u5806\u4f18\u5316 dijkstra \u540e\u6bcf\u4e2a\u7968\u4ec5\u4f1a\u88ab\u66f4\u65b0\u4e00\u6b21\u3002\u4e8e\u662f\u5e76\u4e0d\u9700\u8981\u5efa\u51fa\u56fe\uff0c\u5728\u7ebf\u6bb5\u6811\u4e0a\u8f6c\u79fb\u5e76\u4e14\u5bf9\u66f4\u65b0\u5b8c\u7684\u533a\u95f4\u6253\u4e0a\u6807\u8bb0\u5c31\u53ef\u4ee5\u505a\u5230 $O(N\\log N)$ \uff08\u4ee3\u7801\u5495\u5495\u5495\uff09\u3002\n\n\u7b2c\u4e8c\u79cd\u505a\u6cd5\u6765\u81ea Benq \u7684\u9898\u89e3\u3002\u540c\u6837\u5229\u7528\u4e0a\u9762\u7684\u6027\u8d28\uff0c\u5bf9\u6240\u6709\u7968\u6309\u5de6\u7aef\u70b9\u5347\u5e8f\u6392\u5217\uff0c\u6ce8\u610f\u5230\u6bcf\u4e2a\u95e8\u7968\u6700\u591a\u5165\u961f\u4e00\u6b21\uff0c\u5efa\u4e00\u68f5\u52bf\u80fd\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u6bb5\u533a\u95f4\u7684\u6240\u6709\u7968\u53f3\u7aef\u70b9\u7684\u6700\u5927\u503c\u5373\u53ef\u3002\u5728\u6bcf\u4e2a\u7968\u5165\u961f\u540e\u6253\u4e0a\u6807\u8bb0\uff0c\u5747\u644a\u5206\u6790\u53ef\u4ee5\u5f97\u51fa\u590d\u6742\u5ea6\u4e3a $O(N\\log N)$ \u3002\u76ee\u524d\u5728\u6d1b\u8c37\u4e0a\u662f\u6700\u4f18\u89e3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(N\\log N)$\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define per(i,a,b) for(int i=(a);i>=(b);--i)\n#define pii pair<int,int>\n#define vi vector<int>\n#define fi first\n#define se second\n#define pb push_back\n#define ALL(x) x.begin(),x.end()\n#define sz(x) int(x.size())\n#define ll long long\nusing namespace std;\ninline ll read(){\n    ll x=0,f=1;char ch=getchar();\n    while (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}\n    while (isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n    return x*f;\n}\nconst int N=2e5+5;\nconst ll inf = 1e18;\nstruct ticket{int c,p,a,b;};\nbool cmp(ticket x,ticket y){return x.a<y.a;}\nstruct SegTree{\n    int n,sz;\n    vector <int> mx;\n    vector <ticket> tickets;\n#define ls (p<<1)\n#define rs (ls|1)\n    void pushup(int p){mx[p]=max(mx[ls],mx[rs]);}\n    SegTree(vector <ticket> tickets) : tickets(tickets){//\u521d\u59cb\u5316\n        n = 1;\n        sz = sz(tickets);\n        while(n < sz)n<<=1;\n        mx.assign(2*n,0);\n        rep(i,0,n-1){\n            if(i < sz){\n                mx[i+n] = tickets[i].b;\n            }else mx[i+n] = -1;\n        }\n        per(i,n-1,1)pushup(i);\n    }\n    //\u627e\u5230\u6240\u6709\u53ef\u80fd\u8f6c\u79fb\u7684\u95e8\u7968\u5e76\u79fb\u9664\n    void remove(vector <int> &v,int x,int p=1,int L=0,int R=-1){\n        if(R==-1)R+=n;\n        if(L>=sz||tickets[L].a>x||mx[p]<x)return;\n        if(L==R){\n            mx[p] = -1;\n            v.pb(L);\n            return;\n        }\n        int mid = (L+R)>>1;\n        remove(v,x,ls,L,mid),remove(v,x,rs,mid+1,R);\n        pushup(p);\n    }\n};\nvoid Min(ll &a,const ll b){if(a>b)a=b;}\nint main(){\n    int n=read(),k=read();\n    vector <ticket> tickets(k);\n    for(auto &t: tickets){\n        t.c=read()-1,t.p=read(),t.a=read()-1,t.b=read()-1;\n    }\n    sort(ALL(tickets),cmp);\n    auto Dij = [&](vector<ll> &dis){//Dijkstra\n        priority_queue <pair<ll,int>> pq;\n        rep(i,0,k-1){\n            Min(dis[tickets[i].c],dis[i+n]+tickets[i].p);\n        }\n        rep(i,0,n-1){\n            if(dis[i]<inf)pq.push({-dis[i],i});\n        }\n        SegTree seg(tickets);\n        while(!pq.empty()){\n            pii x = pq.top();\n            pq.pop();\n            if(-x.fi>dis[x.se])continue;\n            vector <int> vec;\n            seg.remove(vec,x.se);//\u627e\u5230\u8f6c\u79fb\u7684\u95e8\u7968\n            for(int t : vec){\n                if(dis[t+n] > dis[x.se]){\n                    dis[t+n] = dis[x.se];\n                    if(dis[tickets[t].c] > dis[x.se] + tickets[t].p){\n                        dis[tickets[t].c] = dis[x.se] + tickets[t].p;\n                        pq.push({-dis[tickets[t].c],tickets[t].c});\n                    }\n                }\n            }\n        }\n    };\n    //\u4e09\u6b21\u6700\u77ed\u8def\n    vector <ll> L(n+k,inf),R(n+k,inf),dis(n+k);\n    L[0]=0,R[n-1]=0;\n    Dij(L),Dij(R);\n    rep(i,0,n+k-1)dis[i] = L[i] + R[i];\n    Dij(dis);\n    rep(i,0,n-1){\n        if(dis[i]<inf)printf(\"%lld\\n\",dis[i]);\n        else puts(\"-1\");\n    }\n    return 0;\n}\n```\n\n## ",
        "postTime": 1640484940,
        "uid": 218501,
        "name": "ETHANK",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7984 [USACO21DEC] Tickets P"
    },
    {
        "content": "\u4ee4 $f_i$ \u8868\u793a\u4ece $i$ \u51fa\u53d1\u7684\u7b54\u6848\uff0c\u5219 $f_i=\\min_{i\\to j}(f_j+val(i\\to j))$ \u3002\u521d\u59cb\u503c $f_i=dis_{i,1}+dis_{i,n}$\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u5c31\u662f\u4e00\u4e2a\u6700\u77ed\u8def\u66f4\u65b0 dp \u7684\u5f62\u5f0f\uff0c\u7ebf\u6bb5\u6811\u4f18\u5316\u5efa\u51fa\u53cd\u56fe\u540e\u8dd1 dijkstra \u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n//author:\u671b\u8fdc\u661f\n#include<bits/stdc++.h>\n#define pii pair<ll,int>\n#define fi first\n#define se second\n#define pb push_back\n#define mk make_pair\n#define sml(x,y) (x=min(x,y))\n#define big(x,y) (x=max(x,y))\n#define ll long long\n#define db double\n#define fo(i,x,y) for(int i=x;i<=y;++i)\n#define go(i,x,y) for(int i=x;i>=y;--i)\nusing namespace std;\ninline int read(){int x=0,fh=1; char ch=getchar(); while(!isdigit(ch)){if(ch=='-') fh=-1; ch=getchar();} while(isdigit(ch)){x=(x<<1)+(x<<3)+ch-'0'; ch=getchar();} return x*fh;}\ninline void out(int *a,int l,int r){fo(i,l,r) printf(\"%d \",*(a+i));puts(\"\");}\n\nconst int N=2.5e6+5;\nconst ll inf=1e17;\nstruct Edge{\n\tint to,next,val;\n}e[N];\nll dis[N],a[N];\nint vis[N],ti,tot,head[N],n,m,qwq;\n\nstruct Node{\n\tint l,r,lt=0,rt=0;\n}tree[N];\nint num,root;\n\nvoid connect(int x,int y,int v){\n\t//printf(\"connect(%d,%d,%d)\\n\",x,y,v);\n\te[++tot]=(Edge){y,head[x],v};\n\thead[x]=tot;\n}\n\nvoid dij(int s,int o){\n\t//printf(\"dij(%d)\\n\",s);\n\tpriority_queue<pii> q;\n\tif(o){\n\t\tfo(i,1,num+qwq) dis[i]=inf;\n\t\tdis[s]=0;q.push(mk(0,s));\t\t\n\t}else fo(i,1,num+qwq) dis[i]=a[i],q.push(mk(-dis[i],i));\n\t++ti;\n\twhile(!q.empty()){\n\t\twhile(!q.empty()&&vis[q.top().se]==ti) q.pop();\n\t\tif(q.empty()) break;\n\t\tint x=q.top().se;q.pop();\n\t\tvis[x]=ti;\n\t\tfor(int i=head[x];i;i=e[i].next){\n\t\t\tint p=e[i].to;\n\t\t\tif(dis[p]>dis[x]+e[i].val){\n\t\t\t\tdis[p]=dis[x]+e[i].val;\n\t\t\t\tq.push(mk(-dis[p],p));\n\t\t\t}\n\t\t}\n\t}\n//\tfo(i,1,n) cout<<dis[i]<<\" \";puts(\"\");\n}\n//\u7ebf\u6bb5\u6811\u4f18\u5316\uff0c\u5efa\u53cd\u56fe\uff0c\u5148\u4ee5 1 \u4e3a\u6e90\u70b9\u8dd1\u6700\u77ed\u8def\uff0c\u518d\u4ee5 n \u4e3a\u6e90\u70b9\u8dd1\u6700\u77ed\u8def\uff0c\u7136\u540e\u628a\u6bcf\u4e2a\u7ed3\u70b9\u7684\u521d\u59cb dis \u8d4b\u4e3a (1,i)+(n,i)\uff0c\u5168\u6254\u8fdb\u5806\u91cc\u8dd1 dij \n\n\n#define ls(x) x<<1\n#define rs(x) x<<1|1\n\nint build(int l,int r){\n\t//printf(\"build(%d,%d)\\n\",l,r);\n\tif(l==r){\n\t\ttree[l].l=l,tree[l].r=r;\n\t\treturn l;\n\t}\n\tint mid=l+r>>1;int x=++num;\n\t//printf(\"num=%d,[%d,%d]\\n\",num,l,r);\n\ttree[x].l=l,tree[x].r=r;\n\ttree[x].lt=build(l,mid);\n\ttree[x].rt=build(mid+1,r);\n\tconnect(tree[x].lt,x,0);\n\tconnect(tree[x].rt,x,0);\n\treturn x;\n}\n\nvoid update(int x,int l,int r,int aim){\n\t//printf(\"update(%d,%d,%d,%d,%d)\\n\",x,l,r,aim,val);//system(\"Pause\");\n\tif(tree[x].l>=l&&tree[x].r<=r){\n\t\tconnect(x,aim,0);//\u5efa\u53cd\u8fb9 \n\t\treturn;\n\t}\n\tint mid=(tree[x].l+tree[x].r)>>1;//,lt=tree[x].lt,rt=tree[x].rt;\n\tif(l<=mid) update(tree[x].lt,l,r,aim);\n\tif(r>mid) update(tree[x].rt,l,r,aim);\n}\n\nsigned main(){\n\tcin>>n>>m;num=n;\n\troot=build(1,n);\n\tfo(i,1,m){\n\t\tint c=read(),p=read(),l=read(),r=read();\n\t\t++qwq;\n\t\tupdate(root,l,r,qwq+num);\n\t\tconnect(qwq+num,c,p);\n\t}\n\tdij(1,1);fo(i,1,num+qwq) a[i]+=dis[i];\n\tdij(n,1);fo(i,1,num+qwq) a[i]+=dis[i];\n\tdij(0,0);\n\tfo(i,1,n){\n\t\tif(dis[i]<=inf/2) cout<<dis[i]<<'\\n';\n\t\telse cout<<\"-1\\n\";\n\t}\n\treturn 0;\n}\n/*\n7 6\n4 1 2 3\n4 10 5 6\n2 100 7 7\n6 1000 1 1\n5 10000 1 4\n6 100000 5 6\n-------------------------------------------------\n-1\n-1\n-1\n1111\n10100\n110100\n-1\n*/\n```\n\n",
        "postTime": 1640314541,
        "uid": 238408,
        "name": "vectorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P7984 [USACO21DEC] Tickets P"
    },
    {
        "content": "\u9996\u5148\u8003\u8651\u5982\u4f55\u5efa\u56fe\u3002\n\n\u5bf9\u4e8e\u66b4\u529b\u7684\u5efa\u56fe\u65b9\u5f0f\uff0c\u5f88\u660e\u663e\u7a7a\u95f4\u590d\u6742\u5ea6\u4f1a\u8fbe\u5230 $O(n^2)$\uff0c\u660e\u663e\u4f1a\u8d85\u65f6\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u5efa\u56fe\u4f18\u5316\u7684\u5efa\u56fe\u65b9\u5f0f\u5c06\u7a7a\u95f4\u590d\u6742\u5ea6\u964d\u4f4e\u4e3a $O(n\\log n)$\uff0c\u5177\u4f53\u4e0d\u4f1a\u7684\u8bdd\u8bf7\u53f3\u8f6c [CF786B Legacy](https://www.luogu.com.cn/problem/CF786B) \u5b66\u4e60\u3002\n\n\u597d\u7684\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u5efa\u51fa\u4e86\u56fe\uff0c\u90a3\u6211\u4eec\u53c8\u5982\u4f55\u7edf\u8ba1\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\u5462\uff1f\n\n\u66b4\u529b\u7684\u505a\u6cd5\u663e\u7136\u662f\u6bcf\u4e2a\u70b9\u90fd\u8fdb\u884c\u679a\u4e3e\uff0c\u4e0d\u8fc7\u5f88\u660e\u663e\u4f1a\u8d85\u65f6\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4ece $1$ \u548c $n$ \u5206\u522b\u8dd1\u4e00\u6b21\u6700\u77ed\u8def\uff0c\u7edf\u8ba1\u51fa\u6240\u6709\u70b9\u5230\u8fbe\u8fd9\u4e24\u4e2a\u70b9\u7684\u8ddd\u79bb\uff08\u6ce8\u610f\u8981\u5efa\u53cd\u56fe\uff09\u3002\n\n\u4f46\u662f\u73b0\u5728\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5047\u8bbe $n=4$\uff0c\u6211\u4eec\u4ece $3$ \u51fa\u53d1\uff0c\u7ecf\u8fc7 $2$ \u5230\u8fbe\u4e86 $1$ \uff0c\u53c8\u4ece $3$ \u51fa\u53d1\uff0c\u7ecf\u8fc7 $2$ \u5230\u8fbe\u4e86 $4$ \uff0c\u5f88\u660e\u663e $2$ \u7ecf\u8fc7\u4e86\u4e24\u6b21\uff0c\u5728\u7edf\u8ba1\u7b54\u6848\u65f6\u4f1a\u88ab\u91cd\u590d\u8ba1\u7b97\u3002\n\n\u90a3\u6211\u4eec\u53c8\u5982\u4f55\u89e3\u51b3\u7b2c\u4e8c\u6b21\u5230\u8fbe\u4e0d\u9700\u8981\u91cd\u590d\u8ba1\u7b97\u7684\u95ee\u9898\u5462\uff1f\n\n\u7edf\u8ba1\u6bcf\u4e2a\u70b9\u5206\u522b\u5230 $1$ \u548c\u5230 $n$ \u70b9\u7684\u8ddd\u79bb\u548c\uff0c\u7136\u540e\u5c06\u6240\u6709\u70b9\u538b\u5165\u961f\u5217\u4e2d\u518d\u8dd1\u4e00\u6b21\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u4e3a\u4ec0\u4e48\u662f\u6b63\u786e\u7684\u5462\uff1f\n\n\u7531\u6700\u77ed\u8def\u7684\u4e09\u89d2\u5f62\u4e0d\u7b49\u5f0f $dist_u \\ge dist_x +v$ \u53ef\u77e5\uff0c\u5982\u679c\u8fd9\u6761\u8fb9\u88ab\u91cd\u590d\u8d70\uff0c\u65b0\u7684 $dist_u$ \u662f\u7531\u539f\u6765 $x$ \u70b9\u5230\u8fbe $1$ \u548c $n$ \u7684\u8def\u5f84\u548c\u52a0\u4e0a\u8fde\u63a5\u4e24\u70b9\u7684\u8fb9\u6743\u5f97\u5230\uff0c\u56fe\u4e2d\u5e76\u4e0d\u5b58\u5728\u8d1f\u73af\uff0c**\u6240\u4ee5\u67d0\u4e2a\u70b9\u4e0d\u4f1a\u88ab\u8fde\u51fa\u53bb\u7684\u540c\u4e00\u6761\u8fb9\u66f4\u65b0\u4e24\u6b21**\uff0c\u5373\u91cd\u590d\u8ba1\u7b97\u95ee\u9898\u88ab\u89e3\u51b3\u3002\n\nCode\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ninline int read(){\n\tint sss=0;\n\tchar chh=getchar();\n\twhile(chh<'0'||chh>'9') chh=getchar();\n\twhile(chh>='0'&&chh<='9'){\n\t\tsss=sss*10+chh-'0';\n\t\tchh=getchar();\n\t}\n\treturn sss;\n}\nint n,m,N,root,tmp;\nstruct Tree{\n\tint l,r,lson,rson;\n}tree[3000005];\nint dist[3000005],vis[3000005];\nint anss[3000005];\nint head[3000005],to[3000005],val[3000005],nxt[3000005],tot=0;\nstruct node{\n\tint dis,pos;\n\tbool operator<(const node& x)const{\n\t\treturn x.dis<dis;\n\t} \n};\nvoid add(int u,int v,int w){\n\tto[++tot]=v;\n\tval[tot]=w;\n\tnxt[tot]=head[u];\n\thead[u]=tot;\n}\nint build(int l,int r){\n\tif(l==r){\n\t\ttree[l].l=l;\n\t\ttree[l].r=r;\n\t\treturn l;\n\t}\n\tint mid=(l+r)>>1;\n\tint tmp_pos=++N;\n\ttree[tmp_pos].l=l;\n\ttree[tmp_pos].r=r;\n\ttree[tmp_pos].lson=build(l,mid);\n\ttree[tmp_pos].rson=build(mid+1,r);\n\tadd(tree[tmp_pos].lson,tmp_pos,0);\n\tadd(tree[tmp_pos].rson,tmp_pos,0);\n\treturn tmp_pos;//\u8fd4\u56de\u7f16\u53f7 \n}\nvoid update(int now,int l,int r,int pos){\n\tif(tree[now].l>=l&&tree[now].r<=r){\n\t\tadd(now,pos,0);\n\t\treturn;\n\t}\n\tint mid=(tree[now].l+tree[now].r)>>1;\n\tif(l<=mid) update(tree[now].lson,l,r,pos);\n\tif(r>mid) update(tree[now].rson,l,r,pos);\n}\nvoid Dijkstra(int sta){//\u6b63\u5e38\u7684\u6700\u77ed\u8def \n\tpriority_queue<node> q;\n\tmemset(dist,0x3f,sizeof dist);\n\tmemset(vis,false,sizeof vis);\n\tdist[sta]=0;\n\tq.push((node){0,sta});\t\t\n\twhile(!q.empty()){\n\t\tint x=q.top().pos; q.pop();\n\t\tif(vis[x]) continue;\n\t\tvis[x]=true;\n\t\tfor(register int i=head[x];i;i=nxt[i]){\n\t\t\tint u=to[i],v=val[i];\n\t\t\tif(dist[u]>dist[x]+v){\n\t\t\t\tdist[u]=dist[x]+v;\n\t\t\t\tif(!vis[u]) q.push((node){dist[u],u});\n\t\t\t}\n\t\t}\n\t}\n}\nvoid DP(){\n\tpriority_queue<node> q;\n\tmemset(vis,false,sizeof vis);\n\tint len=tmp+N;\n\tfor(register int i=1;i<=len;i++){\n\t\tdist[i]=anss[i];\n\t\tq.push((node){dist[i],i});//\u73b0\u5c06\u6240\u6709\u70b9\u538b\u5165\u4f18\u5148\u961f\u5217\u4e2d\uff0c\u7136\u540e\u8dd1\u6700\u77ed\u8def \n\t}\n\twhile(!q.empty()){\n\t\tint x=q.top().pos; q.pop();\n\t\tif(vis[x]) continue;\n\t\tvis[x]=true;\n\t\tfor(register int i=head[x];i;i=nxt[i]){\n\t\t\tint u=to[i],v=val[i];\n\t\t\tif(dist[u]>dist[x]+v){\n\t\t\t\tdist[u]=dist[x]+v;\n\t\t\t\tif(!vis[u]) q.push((node){dist[u],u});\n\t\t\t}\n\t\t}\n\t}\n}\nsigned main(){\n\tN=n=read(),m=read();\n\troot=build(1,n);\n\tint from,value,l,r;\n\tfor(register int i=1;i<=m;i++){\n\t\tfrom=read(),value=read(),l=read(),r=read();\n\t\ttmp++;\n\t\tupdate(root,l,r,tmp+N);\n\t\tadd(tmp+N,from,value);\n\t}\n\tDijkstra(1);\n\tint len=N+tmp;\n\tfor(register int i=1;i<=len;i++){\n\t\tanss[i]+=dist[i];\n\t}\n\tDijkstra(n);\n\tlen=N+tmp;\n\tfor(register int i=1;i<=len;i++){\n\t\tanss[i]+=dist[i];//\u7edf\u8ba1\u51fa\u6240\u6709\u70b9\u5206\u522b\u52301\u548cn\u7684\u6700\u77ed\u8def\u548c \n\t}\n\tDP();//\u8fdb\u884cDP\u5904\u7406 \n\tfor(register int i=1;i<=n;i++){\n\t\tif(dist[i]<=1e15) printf(\"%lld\\n\",dist[i]);\n\t\telse puts(\"-1\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1644468247,
        "uid": 367316,
        "name": "Foreverxxx",
        "ccfLevel": 0,
        "title": "P7984 [USACO21DEC] Tickets P \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u4e2a\u4e1c\u897f\u4e00\u8138\u53ef\u4ee5 DS \u4f18\u5316\u5efa\u56fe\u3002\n\n\u5bf9\u4e8e\u4e00\u5f20\u7968\uff0c\u8fde\u8fb9 $(u,ticket,w),(ticket,P,0)$\uff0c$P$ \u662f\u7ebf\u6bb5\u6811\u4e0a\u6240\u6709\u5bf9\u5e94\u7684\u533a\u95f4\u3002\n\n\u8003\u8651\u5012\u7740\u8dd1\uff0c\u5206\u522b\u6c42\u51fa $1,n$ \u5230\u6bcf\u4e2a\u70b9\u7684\u6700\u77ed\u8def\u3002\n\n\u90a3\u73b0\u5728\u8981\u540c\u65f6\u8bbf\u95ee\u5230 $1,n$\u3002\u3002\n\n\u5bf9\u6bcf\u4e2a\u70b9\uff08\u5305\u62ec\u7ebf\u6bb5\u6811\u7684\u90a3\u4e9b\u865a\u70b9\u548c\u8868\u793a\u7968\u7684\u70b9\uff09\u6267\u884c\u52a0\u8fb9 $(S,i,dis1_i+disn_i)$\uff0c\n\n\u7136\u540e\u518d\u8dd1 $S$ \u5f00\u59cb\u7684\u6700\u77ed\u8def\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u4e3a\u4ec0\u4e48\u662f\u5bf9\u7684\uff1f\u5176\u5b9e\u5c31\u7c7b\u4f3c\u4e8e\u6700\u77ed\u8def\u3002\n\n\u76f8\u5f53\u4e8e $1$ \u548c $n$ \u540c\u65f6\u5148\u8d70\u5230\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u5269\u4e0b\u7684\u8def\u7a0b\u53ef\u4ee5\u5408\u8d70\u3002\n\n\u540c\u65f6\u5230\u4e00\u4e2a\u70b9\u5c31\u662f\u8ddd\u79bb\u76f8\u52a0\uff0c\u5408\u8d70\u5c31\u662f\u5728\u539f\u6765\u7684\u56fe\u4e0a\u8f6c\u79fb\u3002",
        "postTime": 1640322804,
        "uid": 171487,
        "name": "cmll02",
        "ccfLevel": 8,
        "title": "QAQ"
    },
    {
        "content": "\u6a21\u62df\u8d5b\u8003\u7684\u4e00\u9053\u9898\uff0c\u611f\u89c9\u633a\u6709\u8da3\u3002\n\n\u6700\u6734\u7d20\u7684\u60f3\u6cd5\u662f\u5bf9\u4e8e\u6bcf\u4e00\u6761\u9650\u5236\u90fd\u53bb\u8fde $r-l+1$ \u6761\u8fb9\uff0c\u7136\u540e\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u3002\n\n\u4f46\u8fd9\u6837\u7684\u8fb9\u6570\u4f1a\u8fbe\u5230 $O(n^2)$ \u7ea7\u522b\uff0c\u8fd9\u662f\u4e0d\u597d\u7684\u3002\n\n\u89c2\u5bdf\u5230\u52a0\u7684\u8fb9\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u81ea\u7136\u60f3\u5230\u7ebf\u6bb5\u6811\u4f18\u5316\u5efa\u8fb9\u3002\n\n\u5c06\u6bcf\u4e00\u6b21\u7684\u5bf9\u591a\u4e2a\u5355\u70b9\u52a0\u8fb9\u6539\u4e3a\u5bf9\u51e0\u4e2a\u533a\u95f4\u8fdb\u884c\u52a0\u8fb9\uff0c\u4f7f\u7528\u7c7b\u4f3c\u7ebf\u6bb5\u6811\u7684\u65b9\u6cd5\u5212\u5206\u533a\u95f4\u3002\n\n\u4e0d\u96be\u8bc1\u660e\u8fb9\u6570\u662f\u5728 $n\\log n$ \u7ea7\u522b\u7684\u3002\n\n\u5efa\u56fe\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u600e\u4e48\u6c42\u51fa\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u90fd\u8dd1\u4e24\u904d\u6700\u77ed\u8def\u663e\u7136\u662f\u4e0d\u73b0\u5b9e\u7684\u3002\u4f46\u662f\u9898\u76ee\u53ea\u8981\u6c42\u6211\u4eec\u6c42\u51fa\u5230 $1,n$ \u7684\u8ddd\u79bb\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u5efa\u53cd\u8fb9\uff0c\u7136\u540e\u5728\u5206\u522b\u5728 $1,n$ \u8dd1\u4e00\u904d\u6700\u77ed\u8def\uff0c\u7b54\u6848\u5373\u4e3a\u4e24\u4e2a\u8ddd\u79bb\u7684\u548c\u3002\n\n\u4f46\u771f\u7684\u662f\u8fd9\u6837\u5417\uff1f\n\n\u5982\u679c\u6211\u4eec\u91c7\u7528\u5982\u4e0a\u5199\u6cd5\uff0c\u4f1a\u53d1\u73b0\u65e0\u6cd5\u901a\u8fc7\u6837\u4f8b\uff0c\u624b\u73a9\u53d1\u73b0\u6709\u53ef\u80fd\u4e24\u6761\u6700\u77ed\u8def\u6709\u4ea4\uff0c\u8fd9\u6837\u7b54\u6848\u5c31\u4e0d\u662f\u4e24\u6761\u6700\u77ed\u8def\u7684\u548c\u4e86\u3002\n\n\u8fd9\u65f6\u5019\u4f60\u53c8\u60f3\u5230\uff1a\u90a3\u662f\u4e0d\u662f\u76f4\u63a5\u5c06\u4e24\u6761\u6700\u77ed\u8def\u52a0\u8d77\u6765\u53bb\u91cd\u5c31\u53ef\u4ee5\u4e86\uff1f\n\n\u663e\u7136\u4e0d\u662f\u7684\u3002\u56e0\u4e3a\u6709\u53ef\u80fd\u5f53\u524d\u6700\u4f18\u7684\u4e24\u6761\u5e76\u65e0\u4ea4\u96c6\uff0c\u4f46\u662f\u6709\u53ef\u80fd\u6709\u522b\u7684\u4e24\u6761\u8def\u5f84\u6709\u4ea4\uff0c\u5e76\u4e14\u52a0\u8d77\u6765\u6bd4\u5f53\u524d\u7684\u4e24\u6761\u8981\u5c0f\uff0c\u8fd9\u6837\u5c31\u9519\u4e86\u3002\n\n\u8bb0\u5f53\u524d\u7b54\u6848\u4e3a\u4e24\u6761\u6700\u77ed\u8def\u7684\u548c\u3002\n\n\u7406\u6027\u8003\u8651\u4e00\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u5bf9\u6211\u4eec\u7684\u7b54\u6848\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u53bb\u66f4\u65b0\u7b54\u6848\u3002\n\n\u56e0\u4e3a\u91cd\u590d\u8def\u5f84\u7b49\u4ef7\u4e8e\u5148\u8d70\u5230\u67d0\u4e00\u4e2a\u516c\u5171\u70b9\uff0c\u7136\u540e\u540e\u9762\u53ea\u52a0\u4e00\u904d\u8d21\u732e\uff0c\u8fd9\u4e0e\u5355\u5143\u6700\u77ed\u8def\u7684\u5b9e\u73b0\u663e\u7136\u662f\u7b49\u4ef7\u7684\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((m+n)\\log m)$ \u5176\u4e2d $m = n\\log n$\u3002\n\n\u6211\u7684\u5199\u6cd5\u4e0d\u592a\u597d\uff0c\u8981\u5438\u6c27\u624d\u80fd\u8dd1\u8fc7\u53bb\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define int long long\n#define vi vector<int>\n#define pii pair<int,int>\n#define pb(x) push_back(x)\n#define lowbit(x) x&-x\nusing namespace std;\nconst int N=1e5+10;\nconst int inf=1e18;\nconst int M=5e5+10;\nstruct node{\n\tint to,nxt,w;\n}a[M<<2];\nbool vist[M];\nll dist[M],f[M];\npriority_queue<pii> q;\nint n,m,T,head[M],tl[N<<2],tr[N<<2],id[N],x,p,u,v,cnt,maxn;\ninline int read(){\n\tint s=0,f=0;\n\tchar ch=getchar();\n\twhile(ch>'9'||ch<'0') f|=(ch=='-'),ch=getchar();\n\twhile(ch<='9'&&ch>='0') s=(s<<3)+(s<<1)+(ch^48),ch=getchar();\n\treturn f?-s:s;\n}\ninline void add(int from,int to,int w){\n\ta[++cnt]=(node){to,head[from],w};\n\thead[from]=cnt;\n}\ninline void build(int i,int l,int r){\n\ttl[i]=l,tr[i]=r;\n\tif(l<r){\n\t\tint mid=(l+r)>>1;\n\t\tbuild(i<<1,l,mid);\n\t\tbuild(i<<1|1,mid+1,r);\n\t\tadd(i<<1,i,0);\n\t\tadd(i<<1|1,i,0);\n\t}else id[l]=i;\n}\ninline void upd(int i,int l,int r){\n\tif(tl[i]==l&&tr[i]==r){\n\t\tadd(i,maxn,0);\n\t\treturn ;\n\t}\n\tint mid=(tl[i]+tr[i])>>1;\n\tif(r<=mid) upd(i<<1,l,r);\n\telse if(l>mid) upd(i<<1|1,l,r);\n\telse upd(i<<1,l,mid),upd(i<<1|1,mid+1,r);\n}\ninline void dij(int s){\n\tfor(register int i=1;i<=maxn;++i) dist[i]=inf,vist[i]=0;\n\tdist[s]=0;\n\tq.push((pii){0,s});\n\twhile(!q.empty()){\n\t\tint f=q.top().second;q.pop();\n\t\tif(vist[f]) continue;\n\t\tvist[f]=1;\n\t\tfor(register int i=head[f];i;i=a[i].nxt){\n\t\t\tint to=a[i].to;\n\t\t\tif(dist[to]>dist[f]+a[i].w){\n\t\t\t\tdist[to]=dist[f]+a[i].w;\n\t\t\t\tq.push((pii){-dist[to],to});\n\t\t\t}\n\t\t}\n\t}\n}\ninline void calc(){\n\tfor(register int i=1;i<=maxn;++i) q.push((pii){-f[i],i}),vist[i]=0;\n\twhile(!q.empty()){\n\t\tint x=q.top().second;q.pop();\n\t\tif(vist[x]) continue;\n\t\tvist[x]=1;\n\t\tfor(register int i=head[x];i;i=a[i].nxt){\n\t\t\tint to=a[i].to;\n\t\t\tif(f[to]>f[x]+a[i].w){\n\t\t\t\tf[to]=f[x]+a[i].w;\n\t\t\t\tq.push((pii){-f[to],to});\n\t\t\t}\n\t\t}\n\t}\n}\nsigned main(){\n\tn=read(),m=read();\n\tbuild(1,1,n);maxn=(n<<2);\n\tfor(register int i=1;i<=m;++i){\n\t\tx=id[read()],p=read(),u=read(),v=read();\n\t\t++maxn;\n\t\tadd(maxn,x,p);\n\t\tupd(1,u,v);\n\t}\n\tdij(id[1]);\n\tfor(register int i=1;i<=maxn;++i) f[i]=dist[i];\n\tdij(id[n]);\n\tfor(register int i=1;i<=maxn;++i) f[i]+=dist[i];\n\tcalc();\n\tfor(register int i=1;i<=n;++i){\n\t\tif(f[id[i]]>=inf) printf(\"-1\\n\");\n\t\telse printf(\"%lld\\n\",f[id[i]]);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1667371230,
        "uid": 428089,
        "name": "HMZHMZHMZ",
        "ccfLevel": 7,
        "title": "P7984"
    }
]