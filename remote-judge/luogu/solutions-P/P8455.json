[
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\u8bf4\uff1a$n \\le 500$\uff0c$m\\le 500$\uff0c\u4fdd\u8bc1\u5468\u56f4\u65e0\u96f7\u7684\u683c\u5b50\u5f62\u6210 $d\\le 37$ \u4e2a\u8fde\u901a\u5757\uff0c\n\n$n\\times m$ \u7684\u7f51\u683c\uff0c\u6bcf\u4e2a\u683c\u5b50\u662f `*` \u6216\u8005 `.` \u3002\n\n\u95ee\uff1a\u6709\u591a\u5c11\u79cd\u53ef\u80fd\u7684\u6700\u7ec8\u72b6\u6001\uff0c\u72b6\u6001\u5b9a\u4e49\u4e3a\u626b\u96f7\u70b9\u65b9\u5757\u53ef\u8fbe\u7684\u72b6\u6001\uff0c\n\n\u5177\u4f53\u7684\uff0c\u6bcf\u4e2a\u65e0\u96f7\u683c\u5b50\u6709\u5f00/\u4e0d\u5f00\u72b6\u6001\uff0c\u96f7\u683c\u5b50\u6709\u7206/\u4e0d\u7206\u72b6\u6001\uff0c\u96f7\u5982\u679c\u7206\u4e00\u4e2a\uff0c\u5219\u6240\u6709\u90fd\u7206\uff0c\u82e5\u70b9\u51fb\u4e00\u4e2a\u7a7a\u683c\u5b50\u4e14\u5468\u56f4 8 \u4e2a\u4e0d\u5b58\u5728\u96f7\uff0c\u90a3\u4e48\u9012\u5f52\u6253\u5f00\u5468\u56f4 8 \u4e2a\u3002\n\n## solution\n\n\u6ce8\u610f\uff0c\u8fd9\u7bc7\u9898\u89e3\u6ca1\u6709\u4e25\u683c\u7684\u590d\u6742\u5ea6\u8bc1\u660e\uff0c\u662f\u9760\u641c\u7d22\u5f97\u5230\u7684\u6b63\u786e\u7ed3\u679c\u3002\n\n\u9996\u5148\u4e00\u4e2a\u663e\u7136\u7684\u60f3\u6cd5\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u683c\u5b50\u4e0e\u76f8\u5173\u7684\u7a7a\u5730\u8fde\u901a\u5757\u653e\u5728\u4e00\u8d77\u8003\u8651\uff0c\u5373\u7a7a\u5730\u8fde\u901a\u5757\u6253\u5f00\uff0c\u5219\u76f8\u5173\u7684\u90fd\u4f1a\u6253\u5f00\uff0c\u53ea\u8981\u76f8\u5173\u6709\u4e00\u4e2a\u6ca1\u6253\u5f00\uff0c\u7a7a\u5730\u5c31\u4e0d\u80fd\u6253\u5f00\u3002\n\n\u4f46\u662f\u76f4\u63a5\u5199 wa \u4e86\uff0c\u8003\u8651\u4e3a\u4ec0\u4e48\uff0c\u6837\u4f8b\u7ed9\u4e86\u4e2a\u5f88\u597d\u7684\u60c5\u51b5\uff0c\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u683c\u5b50\u53ef\u80fd\u4e0e\u591a\u4e2a\u7a7a\u5730\u8fde\u901a\u5757\u76f8\u5173\uff0c\u89c2\u5bdf\u5230\u4e0e\u81f3\u591a\u4e24\u4e2a\u7a7a\u5730\u8fde\u901a\u5757\u76f8\u5173\uff0c\u90a3\u4e48\u60f3\u5230\u5efa\u8fb9\u3002\n\n\u7136\u540e\u70b9\u6570\u91cf\u662f 37 \uff0c\u7531\u4e8e\u8fde\u901a\u5757\u7c7b\u4f3c\u5e73\u9762\u8868\u793a\uff0c\u8054\u60f3\u5230\u5e73\u9762\u56fe\u3002\n\n\n\u672c\u8d28\u662f\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u586b\u5165 `0/1` \uff0c\u586b `0/1` \u6709\u4e0d\u540c\u65b9\u6848\uff0c\n\n\u7136\u540e\u8fb9\u586b\u5165 `0/1` \u4e5f\u5206\u522b\u6709\u4e0d\u540c\u65b9\u6848\uff0c\u8981\u6c42\u70b9\u586b `1` \u5219\u5468\u56f4\u8fb9\u4e00\u5b9a\u586b `1`\uff0c\n\n\u95ee\uff1a$\\sum_{\\text {\u586b\u6570\u65b9\u6848}} \\prod _{\\text{\u70b9/\u8fb9\u65b9\u6848}}$ \n\n\u8003\u8651\u51b3\u5b9a\u6bcf\u4e2a\u70b9\uff0c\u53d1\u73b0\u51b3\u5b9a\u4e86\u4e00\u4e2a\u70b9\u53ef\u4ee5\u5220\u53bb\u5468\u56f4\u4e00\u5708\u7684\u8fb9\uff0c\u5bf9\u4e8e\u4e24\u4e2a\u72ec\u7acb\u7684\u8fde\u901a\u5757\u5b9e\u9645\u4e0a\u53ef\u4ee5\u72ec\u7acb\u5904\u7406\uff0c\u7531\u4e8e\u662f\u5e73\u9762\u56fe\uff0c\u641c\u7d22\u4e0d\u597d\u5361\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define LL __int128\n#define dd double\nusing namespace std;\nchar gc(){static char buf[1<<16],*s,*t;if(s==t){t=(s=buf)+fread(buf,1,1<<16,stdin);if(s==t)return EOF;}return *s++;}\n//#define getchar gc\nll read()\n{\n\tchar c;\n\tll w=1;\n\twhile((c=getchar())>'9'||c<'0')if(c=='-')w=-1;\n\tll ans=c-'0';\n\twhile((c=getchar())>='0'&&c<='9')ans=(ans<<1)+(ans<<3)+c-'0';\n\treturn ans*w;\n}\nvoid pc(char c,int op)\n{\n\tstatic char buf[1<<16],*s=buf,*t=buf+(1<<16);\n\t(op||((*s++=c)&&s==t))&&(fwrite(buf,1,s-buf,stdout),s=buf);\n}\nvoid wt(int x)\n{\n\tif(x>9)wt(x/10);\n\tpc('0'+x%10,0);\n}\nvoid wts(int x,char op)\n{\n\tif(x<0)pc('-',0),x=-x;\n\twt(x);pc(op,0);\n}\nnamespace ppprrr{const int xx=2,mod=2;ll ksm(ll a,ll b){ll ans=1;while(b){if(b&1)ans*=a,ans%=mod;a*=a,a%=mod,b>>=1;}return ans;}\n\nll jiec[xx],ni[xx];\nll C(ll n,ll m){return jiec[n]*ni[m]%mod*ni[n-m]%mod;}\nvoid pre()\n{\n\tjiec[0]=1;\n\tfor(int i=1;i<xx;i++)jiec[i]=jiec[i-1]*i%mod;\n\tni[xx-1]=ksm(jiec[xx-1],mod-2);\n\tfor(int i=xx-2;i>=0;i--)ni[i]=ni[i+1]*(i+1)%mod;\n}\n\t\nint prim[xx],mn[xx],Cnt;\nvoid pre(int n)\n{\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tif(!mn[i])mn[i]=i,prim[++Cnt]=i;\n\t\tfor(int j=1;j<=Cnt;j++)\n\t\t{\n\t\t\tif(prim[j]*i>n)break;\n\t\t\tmn[i*prim[j]]=prim[j];\n\t\t\tif(i%prim[j]==0)break;\n\t\t}\n\t}\n}\n\n\nint lb(int x){return x&-x;}\nll sum[xx];\nvoid Add(int x,int y){for(;x<xx;x+=lb(x))sum[x]+=y;}\nll ask(int x){ll ans=0;for(;x;x-=lb(x))ans+=sum[x];return ans;}\n\nstruct nod{int next,to;}e[xx<<1];\nint cnt,h[xx];\nvoid add(int x,int y){cnt++,e[cnt]={h[x],y},h[x]=cnt;}\n\n\n}\nint gcd(int a,int b){return !b?a:gcd(b,a%b);}\nconst int xx=1e6+5,mod=998244353;\nvoid ad(int &a,int b){(a+=b)>=mod?a-=mod:0;}\nll ksm(ll a,ll b)\n{\n\tll ans=1;\n\twhile(b)\n\t{\n\t\tif(b&1)ans*=a,ans%=mod;\n\t\ta*=a,a%=mod,b>>=1;\n\t}\n\treturn ans;\n}\nstruct pr{int x,y;bool operator<(const pr&w)const{return x==w.x?y<w.y:x<w.x;};};\nint n,m,k,q,a[xx],b[xx];\nchar s[505][505];\nchar is[505][505];\nchar Is[505][505];\nint dx[]={1,1,1,-1,-1,-1,0,0},dy[]={1,0,-1,1,0,-1,1,-1};\nint bel[505][505],tt,sz;\nvector<pr>v;\nset<int> A[505][505];\nvoid dfs(int x,int y)\n{\n\tif(x<1||y<1||x>n||y>m)return;\n//\tcerr<<x<<\" \"<<y<<\"%%\\n\";\n\tif(is[x][y])bel[x][y]=tt,A[x][y].insert(tt);\n//\t,cerr<<x<<\" \"<<y<<\"%%\\n\";\n\tsz+=is[x][y];\n\tint cr=is[x][y];\n\tis[x][y]=-1;\n\tif(!cr)\n\t{\n\t\tfor(int k=0;k<8;k++)\n\t\t\tif(is[x+dx[k]][y+dy[k]]!=-1)dfs(x+dx[k],y+dy[k]);\n\t\t\telse if(bel[x+dx[k]][y+dy[k]]!=tt&&Is[x+dx[k]][y+dy[k]]==1)\n\t\t\t{\n\t\t\t\tv.push_back({min(tt,bel[x+dx[k]][y+dy[k]]),max(tt,bel[x+dx[k]][y+dy[k]])});\n//\t\t\t\tv.push_back({x+dx[k],y+dy[k]});\n\t\t\t\tA[x+dx[k]][y+dy[k]].insert(tt);\n\t\t\t}\n\t}\n}\nbool operator==(const pr&a,const pr&b)\n{\n\treturn !(a<b)&&!(b<a);\n}\nnamespace sou\n{\n\t#define ull unsigned ll\n\tconst int xx=305;\n\tstruct nod{int next,to,v;}e[xx<<1];\n\tint cnt,h[xx];\n\tint d[xx];\n\tvoid add(int x,int y,int z){/*cerr<<x<<\" \"<<y<<\"%%\\n\"*/d[y]++;cnt++,e[cnt]={h[x],y,z},h[x]=cnt;}\n\tmt19937 G(218);\n\tint is[xx];\n\tvoid D(ull &S,int x,vector<int>&v)\n\t{\n\t\tS|=(1ull<<x),v.push_back(x);\n\t\tfor(int i=h[x];i;i=e[i].next)if(!is[e[i].to]&&!(S>>e[i].to&1))D(S,e[i].to,v);\n\t}\n\tll sum[xx];\n\tint ct=0;\n\tull dfs(ull S)\n\t{\n\t\t++ct;\n\t\tull tt=0;\n\t\tint x=__builtin_ctzll(S&-S);\n//\t\tcerr<<x<<\" \"<<sum[x]<<\"$%$\\n\";\n\t\tif(__builtin_popcountll(S)==1)\n\t\t\treturn 1+ksm(2,sum[x]);\n\t\t\n\t\tvector<int>lin;\n\t\tD(tt,x,lin);\n\t\tif(tt!=S)return dfs(tt)*dfs(tt^S)%mod;\n\t\t\n\t\tint mx=0;\n\t\tfor(auto it:lin)if(d[it]>mx)mx=d[it],x=it;\n\t\t\n\t\tif(d[x]<2)shuffle(lin.begin(),lin.end(),G),x=*lin.begin();\n\t\t\n\t\tull ans=0;\n\t\t//\u586b 1  \n\t\t\n\t\tis[x]=1;\n\t\tfor(int i=h[x];i;i=e[i].next)\n\t\t\tif(!is[e[i].to])d[e[i].to]--;\n\t\tans+=dfs(S^(1ull<<x));\n\t\tis[x]=0;\n\t\tfor(int i=h[x];i;i=e[i].next)\n\t\t\tif(!is[e[i].to])d[e[i].to]++;\n\t\t\t\n\t\t//\u586b 0  \n\t\tis[x]=1;\n\t\tfor(int i=h[x];i;i=e[i].next)\n\t\t\tif(!is[e[i].to])d[e[i].to]--,sum[e[i].to]+=e[i].v;\n\t\t\t\n\t\tans+=dfs(S^(1ull<<x))*ksm(2,sum[x])%mod;\n\t\t\n\t\tis[x]=0;\n\t\tfor(int i=h[x];i;i=e[i].next)\n\t\t\tif(!is[e[i].to])d[e[i].to]++,sum[e[i].to]-=e[i].v;\n//\t\tcerr<<ans<<\"qqweqe\\n\";\n\t\treturn ans;\n\t}\n\tmap<pair<int,int>,int>mp;\n\tvoid solve(int ct2)\n\t{\n//\t\tfor(int i=1;i<=n;i++)\n//\t\t\tfor(int j=1;j<=m;j++)\n//\t\t\t{\n//\t\t\t\tassert(A[i][j].size()<=2);\n//\t\t\t\tif(A[i][j].size())cerr<<A[i][j].size()<<\"$$\\n\";\n//\t\t\t}\n//\t\tcerr<<n<<\" \"<<m<<\"$$\\n\";\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tfor(int j=1;j<=m;j++)\n\t\t\t{\n\t\t\t\tassert(A[i][j].size()<=2);\n//\t\t\t\tif(A[i][j].size())cerr<<A[i][j].size()<<\"$$\\n\";\n//\t\t\t\tcerr<<i<<\" \"<<j<<\"$%$%\\n\";\n\t\t\t\tif(A[i][j].size()==1)\n\t\t\t\t{\n\t\t\t\t\tsum[*A[i][j].begin() -1]++;\n\t\t\t\t}\n\t\t\t\telse if(A[i][j].size()==2)\n\t\t\t\t{\n\t\t\t\t\tmp[make_pair(*A[i][j].begin() -1,*--A[i][j].end() -1)]++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(auto it:mp)\n\t\t{\n\t\t\tadd(it.first.first,it.first.second,it.second);\n\t\t\tadd(it.first.second,it.first.first,it.second);\n\t\t}\n\t\tll ans=dfs((1ull<<tt) -1);\n//\t\tfor(int i=0;i<tt;i++)cout<<i<<\" \"<<d[i]<<\" \"<<sum[i]<<\"##\\n\";\n//\t\tcerr<<ans<<\"$$\\n\";\n\t\tcout<<ans*ksm(2,ct2)%mod<<\"\\n\";\n\t}\n}\nint main(){\n\tread();\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tchar c;\n\t\t\twhile((c=getchar())!='.'&&c!='*');\n\t\t\ts[i][j]=c;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tif(s[i][j]=='*')\n\t\t\t{\n\t\t\t\tfor(int k=0;k<8;k++)\n\t\t\t\t\tis[i+dx[k]][j+dy[k]]=Is[i+dx[k]][j+dy[k]]=1;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)if(s[i][j]=='*')is[i][j]=Is[i][j]=2;\n\tll ans=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tif(!is[i][j])\n\t\t\t{\n\t\t\t\t++tt,sz=0;\n\t\t\t\tdfs(i,j);\n\t\t\t\tans*=(ksm(2,sz)+1);\n\t\t\t\tans%=mod;\n\t\t\t}\n\t\t}\n\t}\n\tsort(v.begin(),v.end());\n\tll mx=0,cE=0;\n\tpr lst={0,0};\n\tfor(auto it:v)\n\t{\n\t\tif(it==lst)++cE;\n\t\telse cE=1;\n\t\tlst=it;\n\t\tmx=max(mx,cE);\n\t}\n//\tfor(auto it:v)cout<<it\n\tint te=v.size();\n\tv.resize(unique(v.begin(),v.end(),[&](pr a,pr b){return !(a<b)&&!(b<a);})-v.begin());\n\t\n//\tassert(te==v.size());\n//\tif(v.size())assert(0);\n//\tassert(cE<=2);\n//\tassert(v.size()<=70);\n\t\n\t\tint ct2=0;//\u662f\u5426\u6709\u96f7 \n\t\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)if(is[i][j]==2)ct2=1;\n\t\t\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int j=1;j<=m;j++)\n\t\t\t\tif(is[i][j]==1)++ct2;\n\t\t\n\tif(!v.size())\n\t{\n\t\tcout<<ans*ksm(2,ct2)%mod<<\"\\n\";\n\t\texit(0);\n\t}\n\telse \n//\tif(v.size()<=60)\n\t{\n\t\t\n\t\tsou::solve(ct2);\n\t\texit(0);\n\t}\n\t\n\tpc('1',1);\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1648683631,
        "uid": 371852,
        "name": "\u4e00\u5ff5\u4e4b\u95f4\u3001\u3001",
        "ccfLevel": 0,
        "title": "minesweeper"
    },
    {
        "content": "## \u524d\u8a00\n\u6700\u4f18\u89e3\u3002\u591a\u5934\u8bf4\u8bdd\u3002\n## \u9898\u89e3\n\u8003\u8651\u5c06\u683c\u5b50\u5206\u7c7b\u3002\n\n\u9996\u5148\u7b2c\u4e00\u79cd\u662f\u5468\u56f4\u6ca1\u6709\u96f7\u7684\u683c\u5b50\uff0c\u8fd9\u4e9b\u683c\u5b50\u663e\u7136\u5bf9\u4e8e\u6bcf\u4e2a\u6781\u5927\u8fde\u901a\u5757\u8003\u8651\u5373\u53ef\u3002\n\n\u7b2c\u4e8c\u79cd\u662f\u672c\u8eab\u662f\u96f7\u7684\u683c\u5b50\uff0c\u8fd9\u90e8\u5206\u8d21\u732e\u662f\u72ec\u7acb\u7684\uff0c\u5728\u6709\u96f7\u7684\u65f6\u5019\u5c06\u7b54\u6848 $\\times 2$ \u5373\u53ef\u3002\n\n\u7b2c\u4e09\u79cd\u662f\u5468\u56f4\u6709\u96f7\u7684\u683c\u5b50\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e09\u7c7b\uff1a\n\n- \u5468\u56f4\u6ca1\u6709\u7b2c\u4e00\u79cd\u683c\u5b50\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u8d21\u732e\u4e5f\u662f\u72ec\u7acb\u7684\uff0c\u5c06\u7b54\u6848 $\\times 2$\u3002\n- \u5468\u56f4\u6709\u7b2c\u4e00\u79cd\u683c\u5b50\uff0c\u4e14\u8fd9\u4e9b\u7b2c\u4e00\u79cd\u683c\u5b50\u90fd\u5728\u540c\u4e00\u4e2a\u8fde\u901a\u5757\u5185\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u4e0d\u9009\u8be5\u8fde\u901a\u5757\u65f6\u5c06\u7b54\u6848 $\\times 2$\u3002\n- \u5468\u56f4\u6709\u7b2c\u4e00\u79cd\u683c\u5b50\uff0c\u4e14\u8fd9\u4e9b\u7b2c\u4e00\u79cd\u683c\u5b50\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u8fde\u901a\u5757\u91cc\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u4e0d\u9009\u8fd9\u4e24\u4e2a\u8fde\u901a\u5757\u65f6\u5c06\u7b54\u6848 $\\times 2$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u4e00\u4e2a\u5468\u56f4\u6709\u96f7\u7684\u683c\u5b50\u7684\u5468\u56f4\u81f3\u591a\u53ea\u6709\u4e24\u4e2a\u7b2c\u4e00\u79cd\u683c\u5b50\uff0c\u56e0\u6b64\u6240\u6709\u683c\u5b50\u5df2\u7ecf\u88ab\u5206\u7c7b\u5b8c\u6210\u3002\n\n\u95ee\u9898\u8f6c\u5316\u6210\u4e0b\u9762\u8fd9\u4e2a\u7ecf\u5178\u7684\u5f62\u5f0f\uff1a\n\n- \u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u70b9\u7684\u5e73\u9762\u65e0\u5411\u56fe $G$\u3002\n- \u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u6709\u70b9\u6743 $a_i$\uff0c\u5bf9\u4e8e\u6bcf\u6761\u8fb9\u6709\u8fb9\u6743 $b_i$\u3002\n- \u5bf9\u4e8e\u6bcf\u4e00\u5f20\u5bfc\u51fa\u5b50\u56fe $G'$\uff0c\u5176\u6743\u91cd\u4e3a\u6240\u6709\u70b9\u7684\u70b9\u6743\u548c\u6240\u6709\u8fb9\u7684\u8fb9\u6743\u7684\u4e58\u79ef\u3002\n- \u8ba1\u7b97 $2^n$ \u4e2a\u5bfc\u51fa\u5b50\u56fe\u7684\u6743\u503c\u548c\u3002\n- $n\\leq 37$\u3002\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\u8fd9\u9898\u94c1 NPC\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0 $n$ \u4e2a\u70b9\u7684\u5e73\u9762\u56fe\u8fb9\u6570\u81f3\u591a\u4e3a $3n$\uff0c\u8003\u8651\u4f7f\u7528\u590d\u6742\u5ea6\u8f83\u5c0f\u7684\u6307\u6570\u7ea7\u7b97\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u8003\u8651\u5c06\u6240\u6709\u70b9\u6309\u7167\u70b9\u5ea6\u6392\u5e8f\uff0c\u8bb0\u5f55\u6240\u6709\u8fb9\u7684\u9009\u62e9\u60c5\u51b5\u8f6c\u79fb\uff0c\u5728\u56fe\u4e0d\u8fde\u901a\u65f6\u5c06\u95ee\u9898\u5206\u89e3\u4e3a\u82e5\u5e72\u5b50\u95ee\u9898\u7ee7\u7eed\u641c\u7d22\uff0c\u53ef\u4ee5\u901a\u8fc7\uff0c\u6700\u6162\u70b9 $25$ \u6beb\u79d2\u3002\n## \u4ee3\u7801\n\u5f81\u96c6\u65b0\u6ce8\u91ca\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nconstexpr bitset<160> Z=(unsigned ll)-1;\n#define bs bitset<160>\nstruct custom_hash {\n\tstatic inline uint64_t splitmix64(uint64_t x) {\n\t    x += 0x9e3779b97f4a7c15;\n\t    x = (x ^ (x >> 30)) * 0xbf58476d1ce4e5b9;\n\t    x = (x ^ (x >> 27)) * 0x94d049bb133111eb;\n\t    return x ^ (x >> 31);\n\t}\n\tinline size_t operator()(const bs&x) const {\n\t    static const uint64_t FIXED_RANDOM =\n\t    chrono::steady_clock::now().time_since_epoch().count();\n\t    return splitmix64((x&Z).to_ullong()\n\t    +((x>>64)&Z).to_ullong()+FIXED_RANDOM);\n\t}\n};\nconst int p=998244353;\nunordered_map<bs,int,custom_hash> mp[63];\nint to[63][63],emul[63][63];\nint mul[63],rk[63],id[63];\nvector<int> e[63];\nvector<int> ee[63];\nint n,m;\nvector<bs> sg[63];\ninline int dfs(int x,const bs&s)\n{\n\tif(x==n) return 1;\n\tif(s[id[x]]) return dfs(x+1,s);\n\tif(mp[x].count(s)) return mp[x][s];\n\tbs g=s;\n\tint u=id[x],ex=1;\n\tg[u]=1;\n\tfor(int v:e[u])\n\t\tif(rk[v]<rk[u]&&!g[to[u][v]])\n\t\t\tex=1ll*ex*emul[u][v]%p,\n\t\t\tg[to[u][v]]=1;\n\tint res=0;\n\tif(sg[x].size()>1)\n\t{\n\t\tint z=1;\n\t\tfor(bs &i:sg[x]) z=1ll*z*dfs(x+1,g|i)%p;\n\t\tres=(res+z)%p;\n\t}\n\telse res=dfs(x+1,g);\n\tres=1ll*mul[u]*ex%p*res%p;\n\tfor(int v:ee[u]) g[to[u][v]]=1;\n\tif(sg[x].size()>1)\n\t{\n\t\tint z=1;\n\t\tfor(bs &i:sg[x]) z=1ll*z*dfs(x+1,g|i)%p;\n\t\tres=(res+z)%p;\n\t}\n\telse res=(res+dfs(x+1,g))%p;\n\treturn mp[x][s]=res;\n}\nbs tmp;\nbool tv[63];\nvoid pre(int x,int lim)\n{\n\ttv[x]=1,tmp[x]=0;\n\tfor(int y:e[x]) if(rk[y]>=lim)\n\t{\n\t\ttmp[to[x][y]]=0;\n\t\tif(!tv[y]) pre(y,lim);\n\t}\n\telse tmp[to[x][y]]=0;\n}\nchar str[503][503];\nint num[503][503];\nint bel[503][503];\nvoid dfs(int x,int y,int v)\n{\n\tbel[x][y]=v;\n\tfor(int dx=-1; dx<=1; ++dx)\n\t\tfor(int dy=-1; dy<=1; ++dy)\n\t\t\tif(bel[x+dx][y+dy]==-1&&!num[x+dx][y+dy]&&str[x+dx][y+dy]=='.')\n\t\t\t\tdfs(x+dx,y+dy,v);\n\treturn ;\n}\nsigned main()\n{\n\tread();\n\tint N=read(),M=read(),qwq=0;\n\tfor(int i=1; i<=N; ++i) scanf(\"%s\",str[i]+1);\n\tfor(int i=1; i<=N; ++i)\n\t\tfor(int j=1; j<=M; ++j)\n\t\t\tfor(int di=-1; di<=1; ++di)\n\t\t\t\tfor(int dj=-1; dj<=1; ++dj)\n\t\t\t\t\tnum[i][j]+=(str[i+di][j+dj]=='*');\n\tfor(int i=1; i<=N; ++i)\n\t\tfor(int j=1; j<=M; ++j) \n\t\t\tqwq|=(str[i][j]=='*');\n\tmemset(bel,-1,sizeof(bel)),\n\tmemset(to,-1,sizeof(to)),++qwq;\n\tfor(int i=1; i<=N; ++i)\n\t\tfor(int j=1; j<=M; ++j)\n\t\t\tif(!num[i][j]&&bel[i][j]==-1)\n\t\t\t\tmul[n]=1,dfs(i,j,n++);\n\tm=n;\n\tfor(int i=1; i<=N; ++i)\n\t\tfor(int j=1; j<=M; ++j) if(str[i][j]=='.'&&num[i][j])\n\t\t{\n\t\t\tint fi=-1,se=-1;\n\t\t\tfor(int di=-1; di<=1; ++di)\n\t\t\t\tfor(int dj=-1; dj<=1; ++dj)\n\t\t\t\t\tif(bel[i+di][j+dj]!=-1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif(fi==-1) fi=bel[i+di][j+dj];\n\t\t\t\t\t\telse if(fi!=bel[i+di][j+dj]) se=bel[i+di][j+dj];\n\t\t\t\t\t}\n\t\t\tif(fi==-1&&se==-1) qwq=(qwq<<1)%p;\n\t\t\telse if(se==-1||fi==se) mul[fi]=(mul[fi]<<1)%p;\n\t\t\telse \n\t\t\t{\n\t\t\t\tif(to[fi][se]==-1)\n\t\t\t\t\te[fi].push_back(se),\n\t\t\t\t\te[se].push_back(fi),\n\t\t\t\t\tto[fi][se]=to[se][fi]=m++,\n\t\t\t\t\temul[fi][se]=emul[se][fi]=1;\n\t\t\t\temul[fi][se]=emul[se][fi]=(emul[se][fi]<<1)%p;\n\t\t\t}\n\t\t}\n\tfor(int i=0; i<n; ++i) id[i]=i;\n\tsort(id,id+n,[&](int x,int y){return e[x].size()>e[y].size();});\n\tfor(int i=0; i<n; ++i) rk[id[i]]=i;\n\tfor(int u=0; u<n; ++u)\n\t\tfor(int v:e[u])\n\t\t\tif(rk[v]>rk[u])\n\t\t\t\tee[u].push_back(v);\n\tbs emp;\n\tfor(int i=0; i<n; ++i)\n\t{\n\t\tmemset(tv,0,sizeof(tv));\n\t\tfor(int j=i+1; j<n; ++j)\n\t\t\tif(!tv[id[j]])\n\t\t\t{\n\t\t\t\ttmp.set(),pre(id[j],i);\n\t\t\t\tsg[i].push_back(tmp);\n\t\t\t}\n\t}\n\tprintf(\"%lld\\n\",1ll*qwq*dfs(0,emp)%p);\n\t// for(int i=0; i<n; ++i) printf(\"%d\\n\",mp[i].size());\n\treturn 0;\n}\n```",
        "postTime": 1679579184,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8455"
    }
]