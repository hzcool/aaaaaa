[
    {
        "content": "\u70b9\u6b64\u98df\u7528\u66f4\u4f73\uff1a[$\\huge\\texttt{My Blog}$](https://www.lu-anlai.com/oi/solution/tjoi2017-d2t2/)\u3002\n\n$\\texttt{Pollard Rho}$ \u7684\u7b80\u5355\u9898\u76ee\u3002\n\n\u9898\u76ee\u94fe\u63a5\uff1a[Luogu P3762](https://www.luogu.com.cn/problem/P3762)/[BZOJ 4891](http://www.lydsy.com/JudgeOnline/problem.php?id=4891)/TJOI2017 D2T2\u3002\n\n# \u9898\u76ee\n\n## \u9898\u76ee\u63cf\u8ff0\n\n\u4e00\u53e5\u8bdd\u9898\u610f\uff1a\u6709\u957f\u5ea6\u4e3a $m$ \u7684\u6b63\u6574\u6570\u6570\u5217 $\\{b _ m\\},\\{a _ m\\} _ 1,\\{a _ m\\} _ 2,\\cdots,\\{a _ m\\} _ n$\uff0c$k$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u51fa $x,M$\uff0c\u6c42\uff1a\n\n$$(\\dfrac{\\prod^m _ {i=1}b _ i}{\\prod^m _ {i=1}a _ {x,i}})^{-1}\\pmod M$$\n\n## \u6570\u636e\u8303\u56f4\n\n|\u53d8\u91cf|\u6570\u636e\u8303\u56f4|\n|:-:|:-:|\n|$n$|$\\leq 20$|\n|$m$|$\\leq 10000$|\n|$k$|$\\leq 50$|\n|$M,a,b$|$\\leq 2\\times 10^{18}$|\n\n## \u65f6\u7a7a\u9650\u5236\n\n|\u9898\u76ee\u7f16\u53f7|\u65f6\u95f4\u9650\u5236|\u7a7a\u95f4\u9650\u5236|\n|:-:|:-:|:-:|\n|[Luogu P3762](https://www.luogu.com.cn/problem/P3762)|$1\\to 5\\text{s}$|$125\\text{MiB}$|\n|[BZOJ 4891](http://www.lydsy.com/JudgeOnline/problem.php?id=4891)|$?\\text{s}$|$?\\text{MiB}$|\n|TJOI2017 D2T2|$1\\to 5\\text{s}$|$128\\text{MiB}$|\n\n# \u9898\u89e3\n\n## \u601d\u8def\n\n\u76f4\u63a5\u4e58\u663e\u7136\u662f\u4e0d\u884c\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4e0a\u4e0b\u5206\u89e3\u8d28\u56e0\u5b50\u3001\u7ea6\u5206\u540e\u518d\u6c42\u503c\u3002\n\n\u4f46\u662f\u8003\u8651\u6700\u5feb\u7684\u8d28\u56e0\u5b50\u5206\u89e3\u7b97\u6cd5 $\\texttt{Pollard Rho}$\uff0c\u8fd9\u6837\u505a\u7684\u5355\u6b21\u8be2\u95ee\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u4e3a $O(m\\times\\max\\{M,a,b\\}^\\frac{1}{4})$\uff0c\u663e\u7136\u8fc7\u4e0d\u6389\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u6362\u4e00\u79cd\u601d\u8def\uff0c\u8003\u8651**\u5206\u89e3\u6a21\u6570** $M$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u6240\u6709\u7684 $a,b$ \u63d0\u524d\u7ea6\u6389 $M$ \u7684\u8d28\u56e0\u5b50\uff0c**\u5269\u4f59\u90e8\u5206\u4e0e $M$ \u663e\u7136\u4e92\u8d28\uff0c**\u5c31\u53ef\u4ee5**\u76f4\u63a5\u6c42\u9006\u5143**\u4e86\u3002\n\n\u6ce8\u610f\uff0c\u5982\u679c\u5206\u89e3\u540e\u5f97\u51fa\u67d0\u4e2a\u8d28\u56e0\u5b50\u6709\u8d1f\u6570\u6b21\u65b9\uff0c\u90a3\u4e48\u663e\u7136\u65e0\u89e3\u3002\n\n\u6700\u540e\u6c42\u9006\u5143\u8bb0\u5f97\u7528**\u6b27\u62c9\u5b9a\u7406**\u800c\u4e0d\u662f\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6c42\u9006\u5143\u3002\n\n\u8fd9\u79cd\u505a\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(k(M^\\frac{1}{4}+m+\\log _ 2\\varphi(M)))$\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define reg register\ntypedef long long ll;\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++)\nstatic char buf[100000],*p1=buf,*p2=buf;\ninline ll read(void){\n\treg char ch=getchar();\n\treg ll res=0;\n\twhile(ch<'0'||'9'<ch)ch=getchar();\n\twhile('0'<=ch&&ch<='9')res=10*res+ch-'0',ch=getchar();\n\treturn res;\n}\n\nconst int MAXN=20+5;\nconst int MAXM=10000+5;\n\nint n,m,K;\nll b[MAXM];\nll a[MAXN][MAXM];\n\ninline ll add(reg ll a,reg ll b,reg ll mod){\n\treg ll sum=a+b;\n\treturn sum>=mod?sum-mod:sum;\n}\n\ninline ll mul(reg ll a,reg ll b,reg ll mod){\n\treg ll res=0;\n\twhile(b){\n\t\tif(b&1)\n\t\t\tres=add(res,a,mod);\n\t\ta=add(a,a,mod);\n\t\tb>>=1;\n\t}\n\treturn res;\n}\n\ninline ll pow(reg ll x,reg ll exp,reg ll mod){\n\treg ll res=1;\n\twhile(exp){\n\t\tif(exp&1)\n\t\t\tres=mul(res,x,mod);\n\t\tx=mul(x,x,mod);\n\t\texp>>=1;\n\t}\n\treturn res;\n}\n\n\nconst int MAXSIZE=10000+5;\n\ninline bool Miller_Rabin(reg ll n){\n\tif(n==2)\n\t\treturn true;\n\tconst int TEST_TIME=10;\n\tfor(reg int i=TEST_TIME;i;--i){\n\t\treg ll a=rand()%(n-2)+1;\n\t\treg ll p=n-1;\n\t\tif(pow(a,n-1,n)!=1)\n\t\t\treturn false;\n\t\twhile(!(p&1)){\n\t\t\tp>>=1;\n\t\t\treg ll temp=pow(a,p,n);\n\t\t\tif(mul(temp,temp,n)==1&&temp!=1&&temp!=n-1)\n\t\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\ninline ll gcd(reg ll a,reg ll b){\n\treturn b==0?a:gcd(b,a%b);\n}\n\ninline ll Pollard_Rho(reg ll n){\n\treg ll i=0,k=2,x=rand()%(n-1)+1,y=x;\n\treg int c=rand();\n\twhile(true){\n\t\t++i;x=(mul(x,x,n)+c)%n;\n\t\treg ll Gcd=gcd((y-x+n)%n,n);\n\t\tif(Gcd!=1&&Gcd!=n)\n\t\t\treturn Gcd;\n\t\tif(x==y)\n\t\t\treturn n;\n\t\tif(i==k)\n\t\t\tk<<=1,y=x;\n\t}\n\treturn n;\n}\n\nint tot;\nll fac[MAXSIZE],T[MAXSIZE];\n\ninline void Div(reg ll n){\n\tif(n==1)\n\t\treturn;\n\tif(Miller_Rabin(n)){\n\t\tfac[++tot]=n;\n\t\treturn;\n\t}\n\treg ll p=n;\n\twhile(p>=n)\n\t\tp=Pollard_Rho(n);\n\tDiv(p),Div(n/p);\n\treturn;\n}\n\nll ta[MAXM];\nll tb[MAXM];\n\ninline void Solve(reg int id,reg ll M){\n\ttot=0;\n\tmemset(T,0,sizeof(T));\n\n\tDiv(M);\n\tsort(fac+1,fac+tot+1);\n\ttot=unique(fac+1,fac+tot+1)-(fac+1);\n\n\treg ll phi=M;\n\tfor(reg int i=1;i<=tot;++i)\n\t\tphi=phi/fac[i]*(fac[i]-1);\n\n\tfor(reg int i=1;i<=m;++i){\n\t\ttb[i]=b[i];\n\t\tfor(reg int j=1;j<=tot;++j)\n\t\t\tif(tb[i]%fac[j]==0)\n\t\t\t\twhile(tb[i]%fac[j]==0){\n\t\t\t\t\t++T[j];\n\t\t\t\t\ttb[i]/=fac[j];\n\t\t\t\t}\n\t}\n\tfor(reg int i=1;i<=m;++i){\n\t\tta[i]=a[id][i];\n\t\tfor(reg int j=1;j<=tot;++j)\n\t\t\tif(ta[i]%fac[j]==0)\n\t\t\t\twhile(ta[i]%fac[j]==0){\n\t\t\t\t\t--T[j];\n\t\t\t\t\tta[i]/=fac[j];\n\t\t\t\t}\n\t}\n\treg ll ans1=1,ans2=1;\n\tfor(reg int i=1;i<=tot;++i)\n\t\tif(T[i]<0){\n\t\t\tputs(\"-1\");\n\t\t\treturn;\n\t\t}\n\t\telse if(T[i])\n\t\t\tans1=mul(ans1,pow(fac[i],T[i],M),M);\n\tfor(reg int i=1;i<=m;++i)\n\t\tans1=mul(ans1,tb[i],M),ans2=mul(ans2,ta[i],M);\n\tprintf(\"%lld\\n\",mul(ans1,pow(ans2,phi-1,M),M));\n\treturn;\n}\n\nint main(void){\n\tsrand(time(0));\n\tn=read(),m=read(),K=read();\n\tfor(reg int i=1;i<=m;++i)\n\t\tb[i]=read();\n\tfor(reg int i=1;i<=n;++i)\n\t\tfor(reg int j=1;j<=m;++j)\n\t\t\ta[i][j]=read();\n\tfor(reg int i=1;i<=K;++i){\n\t\tstatic ll x,M;\n\t\tx=read(),M=read();\n\t\tSolve(x,M);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1592056425,
        "uid": 38502,
        "name": "agicy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3762 \u3010[TJOI2017]\u9f99\u821f\u3011"
    }
]