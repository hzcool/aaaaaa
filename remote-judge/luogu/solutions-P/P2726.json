[
    {
        "content": "$\\text{\u543e\u89c2\u6b64\u9898\u65e0\u9898\u89e3\uff0c\u6545\u8865\u4e4b\u3002}$\n\n[\u535a\u5ba2](https://www.cnblogs.com/Qihoo360/p/9871320.html)\u98df\u7528\u6548\u679c\u66f4\u4f73\n\n\u5148\u8003\u8651\u4e00\u4e2a$O(N^2)$\u505a\u6cd5\u3002\n\n\u8bbe\u9009\u7684\u4e24\u4e2a\u70b9\u4e3a$x,y$\uff0c\u5219\u4e00\u5b9a\u53ef\u4ee5\u5c06\u6811\u5206\u6210\u4e24\u4e2a\u96c6\u5408$A,B$\uff0c\u4f7f\u5f97$A$\u96c6\u5408\u6240\u6709\u70b9\u90fd\u53bb$x$\uff0c$B$\u96c6\u5408\u6240\u6709\u70b9\u90fd\u53bb$y$\uff0c\u800c\u8fd9\u4e24\u4e2a\u96c6\u5408\u7684\u5206\u754c\u70b9\u5c31\u662f\u6811\u4e0a\u7684\u4e00\u6761\u8fb9\u3002\u4e8e\u662f\u8003\u8651\u679a\u4e3e\u65ad\u54ea\u6761\u8fb9\uff0c\u7136\u540e\u5bf9\u4e24\u8fb9\u5206\u522b\u8dd1\u4e00\u904d\u5e26\u6743\u6811\u7684\u91cd\u5fc3\uff0c\u7edf\u8ba1\u7b54\u6848\u52a0\u8d77\u6765\u53d6\u6700\u5c0f\u503c\u5c31\u884c\u4e86\u3002\n\n\u73b0\u5728\u8fdb\u884c\u4f18\u5316\uff0c\u6c42\u6811\u7684\u91cd\u5fc3\u7684\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003[\u533b\u9662\u8bbe\u7f6e](https://www.luogu.org/problemnew/solution/P1364)\u3002\n\u4ee5$1$\u4e3a\u6839\u5efa\u6811\uff0c$f[u]$\u8868\u793a\u6240\u6709\u70b9\u5230$u$\u7684\u603b\u8ddd\u79bb\u3002\uff08\u4eba\u6570\u4e58\u4ee5\u8ddd\u79bb\uff09\n\n\u8f6c\u79fb\u65b9\u7a0b\u662f\uff1a\n$$f[v]=f[u]+size[1]-size[v]-size[v]$$\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ea\u6709\u5f53$size[v]*2>size[1]$\u65f6$v$\u6bd4$u$\u66f4\u4f18\uff0c\u800c\u4e14\u6ee1\u8db3$size[v]*2>size[1]$\u7684$v$\u6570\u91cf$<=1$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u6700\u5927\u7684\u513f\u5b50\u548c\u6b21\u5927\u7684\u513f\u5b50\uff0c\u6bcf\u6b21\u65ad\u8fb9\u65f6\u81ea\u4e0b\u800c\u4e0a\u4fee\u6539\u5176\u6240\u6709\u7956\u5148\u7684$size$\u5927\u5c0f\uff0c\u8fd9\u65f6\u6700\u5927\u513f\u5b50\u53ef\u80fd\u53d8\u5c0f\uff0c\u8fdb\u800c\u88ab\u6b21\u5927\u513f\u5b50\u66ff\u4ee3\uff0c\u76f4\u63a5\u5224\u65ad\u4e00\u4e0b\u7136\u540e\u8d70\u6b64\u65f6\u7684\u5927\u513f\u5b50\u5c31\u884c\u3002\u6613\u5f97\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(NH)$\uff0c\u8fd9\u4e5f\u5c31\u662f\u9898\u4e2d\u63d0\u5230\u6811\u7684\u9ad8\u5ea6\u4e0d\u8d85\u8fc7$100$\u7684\u539f\u56e0\u5427\u3002\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#define INF 2147483647\nusing namespace std;\n#define Open(s) freopen(s\".in\",\"r\",stdin);freopen(s\".out\",\"w\",stdout);\n#define Close fclose(stdin);fclose(stdout);\nint s, w; char ch;\ninline int read(){\n\ts = 0; ch = getchar();\n\twhile(ch < '0' || ch > '9') ch = getchar(); \n\twhile(ch >= '0' && ch <= '9'){ s = s * 10 + ch - '0'; ch = getchar();}\n\treturn s;\n}\nconst int MAXN = 100010;\nstruct Edge{\n\tint next, to;\n}e[MAXN << 1];\nint head[MAXN], num, a[MAXN], size[MAXN], f[MAXN], val[MAXN], dep[MAXN], son[MAXN], Sson[MAXN], A, B, n, root, ans = INF, cut;\ninline void Add(int from, int to){\n\te[++num].to = to; e[num].next = head[from]; head[from] = num;\n\te[++num].to = from; e[num].next = head[to]; head[to] = num;\n}\nint getsize(int u, int fa){\n\tsize[u] = a[u]; f[u] = fa; dep[u] = dep[fa] + 1;\n\tfor(int i = head[u]; i; i = e[i].next)\n\t\tif(e[i].to != fa){\n\t\t\tgetsize(e[i].to, u);\n\t\t\tsize[u] += size[e[i].to];\n\t\t\tval[u] += val[e[i].to] + size[e[i].to];\n\t\t\tif(size[e[i].to] > size[son[u]]){\n              Sson[u] = son[u];\n              son[u] = e[i].to;\n            }\n            else if(size[e[i].to] > size[Sson[u]])\n              Sson[u] = e[i].to;\n\t\t}\n}\nvoid getans(int u, int now, int all, int &res){\n    res = min(res, now);\n    int v = son[u];\n    if(v == cut || size[Sson[u]] > size[son[u]]) v = Sson[u];   //\u5982\u679csize\u53d8\u5316\u540e\u6b21\u5927\u5927\u4e8e\u6700\u5927\n    if(!v) return;\n    if(size[v] * 2 > all) getans(v, now + all - size[v] - size[v], all, res);  //\u5982\u679csize[v]*2<=all\u5c31\u6ca1\u6709\u7ee7\u7eed\u5f80\u4e0b\u8d70\u7684\u610f\u4e49\u4e86\uff0c\u56e0\u4e3a\u6b64\u65f6u\u4e00\u5b9a\u6700\u4f18\n}\nint solve(int u){\n    for(int i = head[u]; i; i = e[i].next)\n       if(e[i].to != f[u]){\n         cut = e[i].to;  //\u65ad\u8fb9\n         A = B = INF;\n         for(int now = u; now; now = f[now]) size[now] -= size[e[i].to];  //\u81ea\u4e0b\u800c\u4e0a\u4fee\u6539\u5176\u7236\u4eb2size\n         getans(1, val[1] - val[e[i].to] - dep[e[i].to] * size[e[i].to], size[1], A);\n         getans(e[i].to, val[e[i].to], size[e[i].to], B);    //\u6c42\u4e24\u4e2a\u96c6\u5408\u7684\u7b54\u6848\n         ans = min(ans, A + B);\n         for(int now = u; now; now = f[now]) size[now] += size[e[i].to];   //\u56de\u6eaf\n         solve(e[i].to);\n       }\n}\nint main(){\n\t//Open(\"practice\");\n\tn = read(); dep[0] = -1;\n\tfor(int i = 1; i < n; ++i) Add(read(), read());\n\tfor(int i = 1; i <= n; ++i) a[i] = read();\n\tgetsize(1, 0);\n\tsolve(1);\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1540801392,
        "uid": 61834,
        "name": "Huami360",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2726 \u3010[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3\u3011"
    },
    {
        "content": "[$\\Huge\\color{#ff33aa}{\\tt My~Cnblogs}$](https://www.cnblogs.com/Wendigo/p/13043587.html)\n\n---\n> [SHOI2005 \u6811\u7684\u53cc\u4e2d\u5fc3](https://www.luogu.com.cn/problem/P2726)\n\n> \u7ed9\u6811 $T=(V,E)(|V|=n)$\uff0c\u6811\u9ad8\u4e3a $h$\uff0c$w_u(u\\in V)$\u3002\u6c42 $x\\in V,y\\in V:\\left(\\sum_{u\\in V}w_u\\cdot \\min(dis_{u,x},dis_{u,y})\\right)_{\\min}$\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$1\\le n\\le 50000$\uff0c$1\\le h\\le 100$\u3002\n\n---\n**\u4e00\u773c\u601d\u8def\uff1a\u628a $T$ \u7531\u4e00\u6761\u8fb9\u780d\u6210 $T_1,T_2$\uff0c$x$ \u4e3a $T_1$ \u91cd\u5fc3\uff0c$y$ \u4e3a $T_2$ \u91cd\u5fc3\u3002**\n\n\u6240\u4ee5\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e\u90a3\u6761\u65ad\u8fb9\uff0c\u7136\u540e\u627e\u4e24\u68f5\u6811\u91cd\u5fc3\uff0c\u5408\u5e76\u7b54\u6848\u3002\n\n---\n**\u5148\u95ee\u4e2a\u95ee\u9898\uff1a\u4e00\u68f5\u5e26\u70b9\u6743\u7684\u6811\u600e\u4e48\u627e\u91cd\u5fc3\uff1f**\n\n\u5373 [\u6d1b\u8c37P1364 \u533b\u9662\u8bbe\u7f6e](https://www.luogu.com.cn/problem/P1364)\u3002\n\n\u5e26\u70b9\u6743\u6811\u7684\u91cd\u5fc3 $x$ \u6ee1\u8db3 $f_x=\\sum_{u\\in V}w_u\\cdot dis_{u,x}$ **\u6700\u5c0f\u3002**\n\n\u6682\u5b9a $1$ \u4e3a\u6839\uff0c\u8bb0\u5f55 $sz_i$ \u8868\u793a\u8282\u70b9 $i$ \u7684\u5b50\u6811\u7684\u6743\u503c $w$ \u548c\u3002\n\n\u6240\u4ee5 $f_1=\\sum_{u\\in V}w_u\\cdot (dep_u-dep_1)$\u3002\n\n$$v\\in son_u:f_v=f_u+(sz_1-sz_v)-sz_v$$\n\n> \u8fd9\u662f\u6362\u6839 $\\tt dp$\u3002\u201c\u91cd\u5fc3\u201d\u5f80\u4e0b\u632a\uff0c**\u4e0a\u9762\u7684\u8282\u70b9\u8981\u591a\u8d70\u4e00\u6b65\uff0c\u4e0b\u9762\u7684\u8282\u70b9\u5c11\u8d70\u4e00\u6b65\u3002**\n\n\u7136\u540e $f_i$ \u6700\u5c0f\u7684 $i$ \u5c31\u662f\u91cd\u5fc3\u3002\n\n---\n**\u8fd9\u9898\u4e5f\u7528\u5230\u4e86\u7c7b\u4f3c\u7684\u601d\u60f3\uff1a**\n\n\u4ee4 $g_i=\\sum_{u\\in subtree_i}w_u\\cdot dis_{u,i}$\uff0c\u5f88\u660e\u663e\u4e0a\u6587\u7684 $f_1=g_1$\u3002\n\n$$\\therefore g_u=\\sum_{v\\in son_u}g_v+sz_v$$\n\n> \u5f88\u660e\u663e\u5427\uff0c\u6bcf\u4e2a\u5b50\u8282\u70b9\u7b54\u6848\u52a0\u518d\u8d70\u4e00\u6761\u8fb9\u7684\u8d21\u732e\u3002\n\n\u4ee4 $sf_i$ \u4e3a $i$ \u7684**\u5b50\u6811\u6700\u5927\u5b50\u8282\u70b9**\uff0c$sc_i$ \u4e3a $i$ \u7684**\u5b50\u6811\u6b21\u5927\u5b50\u8282\u70b9**\u3002\n\n\u8bbe\u65ad\u8fb9\u4e3a $(a,b)$\uff0c\u5176\u4e2d $dep_b>dep_a$\u3002\n\n\u540c\u6837\u4ee4 $1$ \u4e3a\u6839\uff0c\u540c\u6837\u7ef4\u62a4 $sz_i$\u3002\n\n\u6240\u4ee5 $T_1$ \u7684\u6839\u4e3a $1$\uff0c$T_2$ \u7684\u6839\u4e3a $b$\u3002\n\n$\\Theta(h)$ \u8ba9 $sz_i$ \u53d8\u4e3a $T_1,T_2$ \u5185\u7684\u5b50\u6811\u6743\u503c\u548c\uff1a\n\n$\\forall p\\in ancestor_b:sz_p-=sz_b$\n\n\u8bbe $now_1=\\sum_{u\\in V_1}w_u\\cdot dis_{u,1}=g_1-g_b-sz_b(dep_b-dep_1),now_2=\\sum_{u\\in V_2}w_u\\cdot dis_{u,b}=g_b$\n\n$T_1,T_2$ \u4e2d\u7684\u8282\u70b9 $i$ **\u5b50\u6811\u6700\u5927\u5b50\u8282\u70b9**\u5fc5\u4e3a\u539f $sf_i,sc_i$ \u4e2d\u7684\u4e00\u4e2a\u3002\n\n\u518d\u770b\u770b\u4e0a\u9762\u7684\u5f0f\u5b50\uff1a\n\n$$v\\in son_u:f_v=f_u+(sz_{rt}-sz_v)-sz_v$$\n\n\u6240\u4ee5 $f_v<f_u$ \u5f53 $sz_{rt}<2sz_v$\u3002\n\n\u53ef\u4ee5\u4ece\u5404\u81ea\u7684\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u6478\u7740**\u6700\u5927\u5b50\u6811\u5b50\u8282\u70b9**\u627e $T_1,T_2$ \u7684\u91cd\u5fc3\uff0c\u7b54\u6848\u53ef\u4ee5\u7531\u4e0a\u9762\u7684 $now$ \u9012\u63a8\u3002\n\n---\n**\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(nh)$\u3002**\n\n---\n- **\u4ee3\u7801**\n\n\u4e0a\u9762\u7684\u5185\u5bb9\u770b\u4e0d\u61c2\u5c31\u7b97\u4e86\uff0c\u8bfb\u8bfb\u8fd9\u4ee3\u7801\u5427\u3002\u3002\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n//Start\ntypedef long long ll;\ntypedef double db;\n#define mp(a,b) make_pair(a,b)\n#define x first\n#define y second\n#define b(a) a.begin()\n#define e(a) a.end()\n#define sz(a) int((a).size())\n#define pb(a) push_back(a)\nconst int inf=0x3f3f3f3f;\nconst ll INF=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=5e4;\nint n,w[N+7];\nvector<int> e[N+7];\n\n//TreeDP\nint dep[N+7],sz[N+7],fa[N+7],f[N+7],sf[N+7],sc[N+7];\nvoid Dfs1(int u){\n\tsz[u]=w[u],dep[u]=dep[fa[u]]+1;\n\tfor(int&v:e[u])if(v!=fa[u]){\n\t\tfa[v]=u,Dfs1(v),sz[u]+=sz[v],f[u]+=f[v]+sz[v]; //f\u5c31\u662fg\n\t\tif(sz[v]>sz[sf[u]]) sc[u]=sf[u],sf[u]=v;\n\t\telse if(sz[v]>sz[sc[u]]) sc[u]=v;\n\t}\n}\nint cut;\nvoid Dfs2(int u,int now,int sm,int&res){\n\tres=min(res,now);\n\tint v=(sf[u]==cut||sz[sc[u]]>sz[sf[u]])?sc[u]:sf[u]; //v\u4e3au\u6700\u5927\u5b50\u6811\u5b50\u8282\u70b9\n\tif(v&&2*sz[v]>sm) Dfs2(v,now+sm-2*sz[v],sm,res);\n}\nvoid Dfs3(int u,int&res){\n\tfor(int&v:e[u])if(v!=fa[u]){\n\t\tcut=v;\n\t\tint up=inf,down=inf;\n\t\tfor(int p=u;p;p=fa[p]) sz[p]-=sz[v];\n\t\tDfs2(1,f[1]-f[v]-(dep[v]-dep[1])*sz[v],sz[1],up);\n\t\tDfs2(v,f[v],sz[v],down);\n\t\tres=min(res,up+down);\n\t\tfor(int p=u;p;p=fa[p]) sz[p]+=sz[v]; //\u56de\u6eaf\n\t\tDfs3(v,res);\n\t}\n}\n\n//Main\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1,u,v;i<=n-1;i++) scanf(\"%d%d\",&u,&v),e[u].pb(v),e[v].pb(u);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&w[i]);\n\tint ans=inf; Dfs1(1),Dfs3(1,ans),printf(\"%d\\n\",ans);\n\treturn 0;\n} \n```\n---\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1591332711,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2726 \u3010[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3\u3011"
    },
    {
        "content": "# \u5173\u4e8e $O(n^{2})$ \u505a\u6cd5\u7684\u8bc1\u660e\n\n\u524d\u9762\u7684\u9898\u89e3\u5173\u4e8e $O(n^{2})$ \u505a\u6cd5\u7684\u4f18\u5316\u8bb2\u7684\u5df2\u7ecf\u975e\u5e38\u6e05\u695a\u4e86\uff0c\u4f46\u662f $O(n^{2})$ \u7684\u505a\u6cd5\u57fa\u672c\u90fd\u662f\u4e00\u53e5\u8bdd\u3002\u7136\u800c $O(n^{2})$ \u7684\u505a\u6cd5\u4f3c\u4e4e\u5e76\u4e0d\u663e\u7136\uff0c\u56e0\u4e3a\u901a\u8fc7\u5272\u8fb9\u7b97\u51fa\u6765\u7684\u7b54\u6848\u5e76\u4e0d\u662f\u4e00\u5b9a\u5408\u6cd5\u3002\u5c31\u6bd4\u5982\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/g8tercao.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u5f53\u62c6\u7ea2\u8fb9\u65f6\uff0c\u5047\u5982\u4e24\u68f5\u6811\u7684\u91cd\u5fc3\u5206\u522b\u4e3a1\u548c6\uff0c\u90a3\u4e48\u5bf9\u4e8e3\uff0c\u5b83\u79bb1\u66f4\u8fd1\uff0c\u4f46\u662f\u8ba1\u7b97\u65f6\u4f1a\u5c063\u4e0e6\u8fde\u6765\u8ba1\u7b97\u7b54\u6848\uff0c\u663e\u7136\u7b54\u6848\u4f1a\u504f\u5927\u3002\u8be5\u5982\u4f55\u8bc1\u660e\u7b54\u6848\u4e00\u5b9a\u80fd\u901a\u8fc7\u679a\u4e3e\u8fb9\u6765\u8ba1\u7b97\u51fa\u6b63\u786e\u7b54\u6848\uff1f\n\n## \u5f15\u7406\uff1a\n\u5bf9\u4e8e\u4efb\u610f\u6811\u4e0a\u4e24\u70b9x\uff0cy\uff0c\u6ee1\u8db3 $d(v,x) \\geq d(v,y)$ \u7684\u70b9\u96c6 $V_1$ \u4e00\u5b9a\u662f\u8fde\u901a\u7684\uff0c\u6ee1\u8db3 $d(v,x) > d(v,y)$ \u7684\u70b9\u96c6 $V_2$ \u4e5f\u662f\u8fde\u901a\u7684\u3002\u5176\u4e2d $d(a,b)$ \u8868\u793aa\u5230b\u7684\u8ddd\u79bb\n\n\u8fd9\u4e2a\u5f88\u597d\u8bc1\uff0c\u9996\u5148 $x$ \u5230 $y$ \u4e2d\u95f4\u53ea\u6709\u4e00\u6761\u7b80\u5355\u8def\u5f84\uff0c\u627e\u51fa\u5728\u8fd9\u6761\u8def\u5f84\u4e0a\u7684\u70b9\u6ee1\u8db3 $d(v,x) \\leq d(v,y)$ \uff0c\u4e0e\u8fd9\u4e9b\u70b9\u76f8\u8fde\u901a\u7684\u70b9\u663e\u7136\u6ee1\u8db3\u6b64\u5f0f\uff0c\u800c\u4e0e\u8fd9\u6761\u8def\u5f84\u7684\u5176\u4f59\u70b9\u76f8\u8fde\u901a\u7684\u70b9\u663e\u7136\u4e0d\u6ee1\u8db3\u3002\n\n\u6211\u4eec\u5c06\u8fd9\u6761\u8def\u5f84\u4e0a\u8fde\u63a5 $v_1$ \u4e0e $v_2(v_1\\in V_1,v_2\\in V_2)$ \u7684\u8fb9\u79f0\u4e3a**\u5173\u5efa\u8fb9**\uff0c\u73b0\u5728\u8003\u8651\u5207\u8fd9\u6761\u8fb9\u3002\n\n\u8bbe $x_0,y_0$ \u4e3a\u4e24\u68f5\u6811\u540e\u7684\u91cd\u5fc3\u3002\n\n$$\\sum_{v \\in V_1}{w(v) \\cdot d(x,v)} \\geq \\sum _{v \\in V_1}{w(v)\\cdot d(x_0,v)}$$\n\n$$\\sum_{v \\in V_2}{w(v) \\cdot d(y,v)} \\geq \\sum _{v \\in V_2}{w(v)\\cdot d(y_0,v)}$$\n\n\u4e24\u5f0f\u76f8\u52a0\uff0c\u5f97\n\n$$S(x,y) = \\sum_{v \\in V_1}{w(v) \\cdot d(x,v)}+ \\sum_{v \\in V_2}{w(v) \\cdot d(y,v)}$$\n\n$$\\geq \\sum _{v \\in V_1}{w(v)\\cdot d(x_0,v)} + \\sum _{v \\in V_2}{w(v)\\cdot d(y_0,v)}$$\n\n$$\\geq \\sum_{v \\in V_1}{w(v)\\cdot min\\{d(x_0,v),d(y_0,v)\\}} + \\sum_{v\\in V_1}{w(v)\\cdot min\\{d(x_0,v),d(y_0,v)\\}}$$\n\n$$=S(x_0,y_0)$$\n\n\u56e0\u6b64\n$$min\\{S(x,y)\\} \\geq \\{S(x_0,y_0)\\}$$\n\n\u53c8\u663e\u7136 $\\{(x_0,y_0)\\} \\subseteq \\{(x,y)\\}$ ,\u6240\u4ee5\n\n$$min\\{S(x_0,y_0)\\} \\geq min\\{S(x,y)\\}$$\n\n\u6240\u4ee5\n$$min\\{S(x_0,y_0)\\} = min\\{S(x,y)\\}$$\n\n\u5373\u6b64\u89e3\u6cd5\u7b97\u51fa\u7684\u6700\u5c0f\u503c=\u7b54\u6848\n\n\u6700\u540e\u611f\u8c22 [@abs001](https://www.luogu.com.cn/user/98468)\u63d0\u4f9b\u7684\u8bc1\u660e\uff0c\u7531\u4e8e~~\u6b64\u4eba\u592a\u5de8~~\u6b64\u4eba\u4e0d\u60f3\u6253\u9898\u89e3\uff0c\u6240\u4ee5\u8ba9\u6211\u6765\u6253\u8bc1\u660e\n\n\uff08\u6807\u7a0b\u5c31\u4e0d\u653e\u4e86\uff0c\u770b\u4e0a\u9762\u7684\u9898\u89e3\uff09",
        "postTime": 1625558692,
        "uid": 119124,
        "name": "iamzq",
        "ccfLevel": 7,
        "title": "P2726 \u6811\u7684\u53cc\u4e2d\u5fc3 \u9898\u89e3"
    },
    {
        "content": "\u6211\u4eec\u53ef\u4ee5\u5148\u770b\u4e00\u4e0b\u8fd9\u9053\u9898\uff1a[CSP2019\u6811\u7684\u91cd\u5fc3](https://www.luogu.com.cn/problem/P5666)\n\n\u6211\u4eec\u8003\u8651 $O(n\\log n)$ \u7684\u505a\u6cd5\u3002\n\n\u6211\u4eec\u5148\u6362\u4e00\u4e2a\u91cd\u5fc3\u4e3a\u6839\u3002\n\n\u6211\u4eec\u5b9a\u4e49\uff1a\n\n- $a_i$ \u8868\u793a\u70b9 $i$ \u7684\u975e\u6839\u6700\u8fdc\u7956\u5148\n- $d_i$ \u8868\u793a\u70b9 $i$ \u7684\u6df1\u5ea6\n- $T_i$ \u8868\u793a\u70b9 $i$ \u7684\u5b50\u6811\uff0c$\\overline{T_i}$ \u8868\u793a\u6811\u9664\u4e86$T_i$\u7684\u90e8\u5206\n- $G_i$ \u8868\u793a $T_i$ \u7684\u91cd\u5fc3\uff0c$\\overline{G_i}$\u8868\u793a $\\overline{T_i}$ \u7684\u91cd\u5fc3\n- $s_i$ \u8868\u793a\u70b9 $i$ \u5b50\u6811\u7684\u6743\u503c\u548c\n- $t_i$ \u8868\u793a $\\sum\\limits_{j\\in T_i}dis(i, j)\\cdot w_i$\n- $T_i-T_j$ \u8868\u793a $\\{i\\ |\\ i\\in T_i\\land i\\not\\in T_j \\}$\n\n- $f_i$ \u8868\u793a $i$ \u7684\u7236\u8282\u70b9\n\n\u9884\u5904\u7406\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$(\u53c2\u8003\u6811\u7684\u91cd\u5fc3)\u3002\n\n\u9996\u5148\uff0c\u539f\u5f0f=\n\n$\\min\\limits_{rt\\in T,x\\in T_{rt},y\\in\\overline{T}_{rt}}(\\sum\\limits_{i\\in T_{rt}}dis(x,i)\\cdot w_i+\\sum\\limits_{i\\in \\overline{T}_{rt}}dis(y,i)\\cdot w_i)$\n\n\u4ee4\uff1a$F(x,rt)=\\begin{cases}\\sum\\limits_{i\\in T_i}dis(x,i)\\cdot w_i&x\\in T_{rt}\\\\\\sum\\limits_{i\\in \\overline{T}_{rt}}dis(x,i)\\cdot w_i&x\\in \\overline{T}_{rt}\\end{cases}$\n\n\u5219\u4e0a\u5f0f=$\\min(F(x,rt)+F(y,rt))$.\n\n\u6211\u4eec\u5148\u89c2\u5bdf $F(x,rt)\\ \\ (x\\in T_{rt})$\uff1a\n\n\u8be5\u5f0f  \n  $=\\sum\\limits_{i\\in T_x}dis(i,x)\\cdot w_i+\\sum\\limits_{i\\in(T_{f_x}-T_x)}dis(i, x)\\cdot w_i$\n\n $=\\sum\\limits_{i\\in T_x}(dis(i,f_x)-1)\\cdot w_i+\\sum\\limits_{i\\in(T_{f_x}-T_x)}(dis(i, f_x)+1)\\cdot w_i$\n \n $= F(f_x,rt)+s_{rt}-2s_x$\n \n \u53ef\u77e5\u82e5\u5728 $x$ \u5904\u53d6\u5230\u6700\u503c\uff0c\u5219 $2s_x\\ge s_{rt}$.\n \n \u4e14$\\forall f_i=x,2s_i\\le s_{rt}$.\n \n \u6545 $x$ \u4e3a $G_{rt}$\u3002\n \n\u4e14 $F(x,rt)$\n\n$=F(x,f_{rt})-\\sum\\limits_{i\\in (T_{f_{rt}}-T_{rt})}dis(i, x)\\cdot w_i$\n\n$=F(x,f_{rt})-t_{f_{rt}}+t_{rt}+(d_x-d_{rt}+2)s_{rt}-(d_x-d_{rt}+1)s_{f_{rt}}$\n\n\u540c\u7406\uff0c$x\\not\\in T_{rt}$ \u65f6\uff0c\u6709\uff1a\n\n$F(x,rt)=F(f_x,rt)+s_G-s_{rt}-2s_x$\n\n$F(x,rt)=F(x,f_{rt})+\\sum\\limits_{i\\in (T_{f_{rt}}-T_{rt})}dis(i, x)\\cdot w_i$\n\n$=F(x,f_{rt})+t_{f_{rt}}-t_{rt}-(d_x-d_{rt}+2)s_{rt}+(d_x-d_{rt}+1)s_{f_{rt}}$\n\n\u53ef\u77e5\u6b64\u65f6 $x$ \u4e5f\u662f $\\overline{T}_{rt}$ \u7684\u91cd\u5fc3\u3002\n\n\u82e5\u6bcf\u6b21\u9009 $F(rt,rt)$ \u548c $F(G,rt)$ \u4e3a\u521d\u59cb\u6761\u4ef6\uff0c\u590d\u6742\u5ea6 $O(n(\\log n+H))$\u3002\n\n\u56e0\u4e3a\u91cd\u5fc3\u5fc5\u5728\u91cd\u94fe\u4e0a\uff0c\u6211\u4eec\u53d1\u73b0\uff1a\u5f53 $rt$ \u5728\u8f7b\u94fe\u4e0a\u5411\u4e0b\u8fd0\u52a8\u65f6\uff0c$G_{rt}$ \u5411\u4e0b\u8fd0\u52a8\uff0c$\\overline G_{f_{rt}}$\u6cbf\u91cd\u94fe\u5411\u4e0a\u8fd0\u52a8\u3002\n\n\u5f53 $rt$ \u5728\u91cd\u94fe\u4e0a\u5411\u4e0b\u8fd0\u52a8\u65f6\uff0c$G_{rt}$\u5411\u4e0b\u8fd0\u52a8\uff0c$\\overline G_{f_{rt}}$ \u6cbf $G$ \u7684\u6b21\u91cd\u513f\u5b50\u7684\u91cd\u94fe(\u5305\u62ec$G$)\u5411\u4e0a\u8fd0\u52a8\u3002\n\n\u91cd\u94fe\u5256\u5206+\u62d3\u6251\u6392\u5e8f\u540e\uff0c\u6bcf\u4e00\u6761\u94fe $L$\uff0c\u82e5 $rt\\in L$\uff0c$G_{rt}\\in L\\land d_{G_{rt}}\\ge d_{rt}$.\n\n\u5bf9\u6bcf\u6761\u94fe\uff0c\u53cc\u6307\u9488\u626b\u4e00\u626b\u5373\u53ef\u5f97 $F(G_{rt},rt)$\u3002\n\n\u5bf9\u4e8e $F(\\overline G_{rt},rt)$ \u56e0\u4e3a $\\overline G_{rt}$ \u5fc5\u5728\u91cd\u94fe\u6216 $G$ \u6b21\u91cd\u513f\u5b50\u91cd\u94fe\u4e0a\uff0c\u6545\u6211\u4eec\u9884\u5904\u7406\u51fa $F(\\overline G_{rt},a_{\\overline G_{rt}})$.\n\n$F(\\overline G_{rt},rt)=F(\\overline G_{rt},a_{\\overline G_{rt}})+t_G-t_{rt}-(d_{rt}-1)s_{rt}+(d_{\\overline G_{rt}}-1)(s_G-s_{rt}-s_{a_{\\overline G_{rt}}})-t_{a_{\\overline G_{rt}}}-s_{a_{\\overline G_{rt}}}$.\n\n\u5219\u539f\u5f0f\u53ef $O(n\\log n)$ \u6c42\u51fa(\u7528map)\uff0c\u4e14\u9884\u5904\u7406\u590d\u6742\u5ea6 $O(n\\log n)$\uff0c\u603b\u590d\u6742\u5ea6 $O(n\\log n)$ ~~\u4f46\u5e38\u6570\u5de8\u5927~~\u3002\n\n\u6211\u4eec\u8003\u8651 $O(n)$\n\n\u6211\u4eec\u7528\u53cc\u6307\u9488\u626b\u51fa $G_i$\uff0c\u590d\u6742\u5ea6 $O(n)$\n\n\u4f46\u5982\u6b64\u65b9\u6cd5\u5bf9\u5e26\u6743\u6811\uff0c\u590d\u6742\u5ea6\u4f1a\u9000\u5316\u4e3a $O(n^2)$\n\n\u53d1\u73b0\uff1a\u82e5 $x=\\overline G_i$\uff0c\u53ea\u9700\u6ee1\u8db3 $2s_{h_x}\\le s_G-s_i \\le 2s_x$\n\n\u6545 $\\overline G_i$ \u4e0e $s_i$ \u6709\u5173\uff0c\u4e0e $i$ \u5177\u4f53\u662f\u90a3\u4e2a\u70b9\u65e0\u5173\u3002\n\n\u6545\u5c06 $i$ \u6309 $s_i$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c$e_i$ \u8868\u793a\u6392\u5e8f\u540e\u7b2c $i$ \u4e2a\u70b9\uff0c\u4f7f\u7528\u57fa\u6392\u5373\u53ef\u4f18\u5316\u6210 $O(n)$ \uff0c\u518d\u53cc\u6307\u9488\u626b\u5373\u53ef, \u6b64\u65f6\u4ee4$j\\in L_2$\uff0c$k\\in L_1$\uff0c\u5747\u5355\u8c03\u4ece $G$ \u5411\u4e0b\u8d70\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n$O(n(\\log n+H))$\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\ninline ll fcin() {\n\tll r=0;\n\tbool s=0;\n\tchar c=getchar();\n\tfor(; c<48||c>57; c=getchar()) s^=c=='-';\n\tfor(; c>47&&c<58; c=getchar()) r=r*10+c-48;\n\treturn s? -r: r;\n}\nchar out[20];\nint otop;\ninline void fcout(ll x, char c) {\n\tif (x<0) putchar('-'), x=-x;\n\tif (!x) putchar('0');\n\tfor(otop=0; x; x/=10, ++otop)\n\t\tout[otop]=x%10+48;\n\tfor(--otop; otop>=0; --otop)\n\t\tputchar(out[otop]);\n\tputchar(c);\n}\nconst int N=50001;\nconst ll inf=1e18;\nint n, G, _h, ans;\nll sum, tmp, pos, sol=inf, s[N], t[N], F[N], w[N];\nint he[N<<1], ne[N<<1], te[N<<1], cnt, tar;\nint a[N], b[N], d[N], f[N], g[N][5], h[20][N], l2[N];\ninline void con(int x, int y) {\n\tne[++cnt]=he[x], te[he[x]=cnt]=y;\n\tne[++cnt]=he[y], te[he[y]=cnt]=x;\n}\ninline void walk(int x) {\n\ts[x]=w[x];\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x])\n\t\t\tf[te[i]]=x, walk(te[i]), s[x]+=s[te[i]];\n}\ninline void dfs(int x) {\n\ts[x]=w[x], b[x]=d[x]=d[f[x]]+1, a[x]=f[x]==G? x: a[f[x]];\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x]) {\n\t\t\tf[te[i]]=x, dfs(te[i]), s[x]+=s[te[i]], t[x]+=t[te[i]]+s[te[i]];\n\t\t\tif (b[x]<b[te[i]]) b[x]=b[te[i]];\n\t\t\tif (s[te[i]]>s[h[0][x]])\n\t\t\t\th[0][x]=te[i];\n\t\t}\n}\ninline int acc(int x, int y) {\n\treturn max(s[x]-s[y], s[h[0][y]]);\n}\ninline int cal(int x, int y) {\n\tif (y==G) return a[x]==h[0][G]? max(s[h[0][G]]-s[x], s[_h]): s[h[0][G]];\n\treturn a[x]==a[y]? s[G]-s[y]: max(s[G]-s[x]-s[y], s[h[0][y]]);\n}\ninline void ins(int x, int y) {\n\tif (y&&acc(x, y)<=s[x]>>1)\n\t\tg[x][++g[x][0]]=y;\n}\ninline void add(int x, int y) {\n\tif (y&&cal(x, y)<=(s[G]-s[x])>>1)\n\t\tg[x][++g[x][0]]=y;\n}\ninline void dp(int x) {\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x])\n\t\t\tdp(te[i]);\n\tif (x==G) return;\n\tans=x;\n\tfor(int i=l2[h[0][x]? d[g[h[0][x]][1]]-d[x]: 1]; i>=0; i--)\n\t\tif (h[i][ans]&&acc(x, f[h[i][ans]])>=acc(x, h[i][ans])&&h[i][ans])\n\t\t\tans=h[i][ans];\n\tins(x, f[ans]), ins(x, ans), ins(x, h[0][ans]), ins(x, h[1][ans]), g[x][0]=2;\n\tif (cal(x, G)<=(s[G]-s[x])>>1)\n\t\tadd(x, G), add(x, h[0][G]), add(x, _h);\n\telse {\n\t\tans=h[0][x]&&g[h[0][x]][g[h[0][x]][0]]!=G? g[h[0][x]][g[h[0][x]][0]]: a[x]==h[0][G]? _h: h[0][G];\n\t\tfor(int i=l2[b[ans]-d[ans]]; i>=0; i--)\n\t\t\tif (h[i][ans]&&cal(x, f[h[i][ans]])>=cal(x, h[i][ans]))\n\t\t\t\tans=h[i][ans];\n\t\tadd(x, f[ans]), add(x, ans), add(x, h[0][ans]), add(x, h[1][ans]);\n\t}\n}\ninline void solve1(int rt, int x) {\n\tF[x]=x==rt? t[x]: F[f[x]]+s[rt]-2*s[x];\n\tif (x!=g[rt][1]) solve1(rt, h[0][x]);\n}\ninline void solve2(int rt, int x) {\n\tF[x]=x==G? t[G]-t[rt]-(d[rt]-1)*s[rt]: F[f[x]]+s[G]-s[rt]-2*s[x];\n\tif (x!=g[rt][3]) solve2(rt, x==G&&a[rt]==h[0][x]? _h: h[0][x]);\n}\nint main() {\n\tcnt=sum=G=_h=0, tmp=inf, n=fcin();\n\tfor(int i=2; i<=n; i++)\n\t\tl2[i]=l2[i>>1]+1, con(fcin(), fcin());\n\tfor(int i=1; i<=n; i++)\n\t\tw[i]=fcin();\n\twalk(1);\n\tfor(int x=1; x<=n; x++) {\n\t\tpos=s[1]-s[x];\n\t\tfor(int i=he[x]; i; i=ne[i])\n\t\t\tif (te[i]!=f[x]&&pos<s[te[i]])\n\t\t\t\tpos=s[te[i]];\n\t\tif (tmp>pos)\n\t\t\ttmp=pos, G=x;\n\t}\n\tf[G]=0, dfs(G);\n\tfor(int i=1; i<=l2[n]; i++)\n\t\tfor(int j=1; j<=n; j++)\n\t\t\th[i][j]=h[i-1][h[i-1][j]];\n\tfor(int i=he[G]; i; i=ne[i])\n\t\tif (s[te[i]]>s[_h]&&te[i]!=h[0][G])\n\t\t\t_h=te[i];\n\tdp(G);\n\tfor(int i=1; i<=n; i++)\n\t\tif (i!=G) {\n\t\t\tsolve1(i, i), solve2(i, G);\n\t\t\tif (sol>F[g[i][1]]+F[g[i][3]])\n\t\t\t\tsol=F[g[i][1]]+F[g[i][3]], tar=i;\n\t\t}\n\tfcout(sol, '\\n');\n\treturn 0;\n}\n```\n$O(n\\log n)$\uff1a\uff08\u5404\u90e8\u5206\u590d\u6742\u5ea6\u89c1\u4ee3\u7801\uff09\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\ninline ll fcin() {\n\tll r=0;\n\tbool s=0;\n\tchar c=getchar();\n\tfor(; c<48||c>57; c=getchar()) s^=c=='-';\n\tfor(; c>47&&c<58; c=getchar()) r=r*10+c-48;\n\treturn s? -r: r;\n}\nchar out[20];\nint otop;\ninline void fcout(ll x, char c) {\n\tif (x<0) putchar('-'), x=-x;\n\tif (!x) putchar('0');\n\tfor(otop=0; x; x/=10, ++otop)\n\t\tout[otop]=x%10+48;\n\tfor(--otop; otop>=0; --otop)\n\t\tputchar(out[otop]);\n\tputchar(c);\n}\nconst int N=100001;\nconst ll inf=1e18;\nint n, G, _h, ans;\nll sum, tmp, pos, sol=inf, s[N], t[N], w[N];\nint he[N], ne[N<<1], te[N<<1], cnt, tar;\nint a[N], b[N], c[N], d[N], f[N], g[N][5], h[20][N], l2[N];\ninline void con(int x, int y) {\n\tne[++cnt]=he[x], te[he[x]=cnt]=y;\n\tne[++cnt]=he[y], te[he[y]=cnt]=x;\n}\ninline void walk(int x) {\n\tif (x==32504)\n\t\t++sol;\n\ts[x]=w[x];\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x])\n\t\t\tf[te[i]]=x, walk(te[i]), s[x]+=s[te[i]];\n}\ninline void dfs(int x) {\n\ts[x]=w[x], b[x]=d[x]=d[f[x]]+1, a[x]=f[x]==G? x: a[f[x]];\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x]) {\n\t\t\tf[te[i]]=x, dfs(te[i]), s[x]+=s[te[i]], t[x]+=t[te[i]]+s[te[i]];\n\t\t\tif (b[x]<b[te[i]]) b[x]=b[te[i]];\n\t\t\tif (s[te[i]]>s[h[0][x]])\n\t\t\t\th[0][x]=te[i];\n\t\t}\n}\ninline int acc(int x, int y) {\n\treturn max(s[x]-s[y], s[h[0][y]]);\n}\ninline int cal(int x, int y) {\n\tif (y==G) return a[x]==h[0][G]? max(s[h[0][G]]-s[x], s[_h]): s[h[0][G]];\n\treturn a[x]==a[y]? s[G]-s[y]: max(s[G]-s[x]-s[y], s[h[0][y]]);\n}\ninline void ins(int x, int y) {\n\tif (y&&acc(x, y)<=s[x]>>1)\n\t\tg[x][++g[x][0]]=y;\n}\ninline void add(int x, int y) {\n\tif (y&&cal(x, y)<=(s[G]-s[x])>>1)\n\t\tg[x][++g[x][0]]=y;\n}\ninline void dp(int x) {\n\tc[++c[0]]=x;\n\tif (h[0][x]) dp(h[0][x]);\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x]&&te[i]!=h[0][x])\n\t\t\tdp(te[i]);\n\tif (x==G) return;\n\tans=x;\n\tfor(int i=l2[h[0][x]? d[g[h[0][x]][1]]-d[x]: 1]; i>=0; i--)\n\t\tif (h[i][ans]&&acc(x, f[h[i][ans]])>=acc(x, h[i][ans])&&h[i][ans])\n\t\t\tans=h[i][ans];\n\tins(x, f[ans]), ins(x, ans), ins(x, h[0][ans]), ins(x, h[1][ans]), g[x][0]=2;\n\tif (cal(x, G)<=(s[G]-s[x])>>1)\n\t\tadd(x, G), add(x, h[0][G]), add(x, _h);\n\telse {\n\t\tans=h[0][x]&&g[h[0][x]][g[h[0][x]][0]]!=G? g[h[0][x]][g[h[0][x]][0]]: a[x]==h[0][G]? _h: h[0][G];\n\t\tfor(int i=l2[b[ans]-d[ans]]; i>=0; i--)\n\t\t\tif (h[i][ans]&&cal(x, f[h[i][ans]])>=cal(x, h[i][ans]))\n\t\t\t\tans=h[i][ans];\n\t\tadd(x, f[ans]), add(x, ans), add(x, h[0][ans]), add(x, h[1][ans]);\n\t}\n}\nstruct cpl{\n\tint x, rt;\n\tbool operator < (const cpl& g) const {\n\t\treturn x<g.x||(x==g.x&&rt<g.rt);\n\t}\n} ;\nmap<cpl, ll>F;\nvoid ff(int x0, int rt0, int x, int rt) {//(x0, rt0)->(x, rt)\n\tif (x0!=x)\n\t\tfor(int _x=h[0][x0]; ; _x=h[0][_x]) {\n\t\t\tF[{_x, rt0}]=F[{f[_x], rt0}]+s[rt0]-2*s[_x];\n\t\t\tif (_x==x) break;\n\t\t}\n\tif (rt0!=rt) F[{x, rt}]=F[{x, rt0}]-t[rt0]+t[rt]+(d[x]-d[rt]+2)*s[rt]-(d[x]-d[rt]+1)*s[rt0];\n}\nint main() {\n\tcnt=sum=G=_h=0, tmp=inf, n=fcin();\n\tfor(int i=2; i<=n; i++)//n\n\t\tl2[i]=l2[i>>1]+1, con(fcin(), fcin());\n\tfor(int i=1; i<=n; i++)//n\n\t\tw[i]=fcin();\n\twalk(1);//n\n\tfor(int x=1; x<=n; x++) {//n\n\t\tpos=s[1]-s[x];\n\t\tfor(int i=he[x]; i; i=ne[i])\n\t\t\tif (te[i]!=f[x]&&pos<s[te[i]])\n\t\t\t\tpos=s[te[i]];\n\t\tif (tmp>pos)\n\t\t\ttmp=pos, G=x;\n\t}\n\tf[G]=0, dfs(G);//n\n\tfor(int i=1; i<=l2[n]; i++)//nlogn\n\t\tfor(int j=1; j<=n; j++)\n\t\t\th[i][j]=h[i-1][h[i-1][j]];\n\tfor(int i=he[G]; i; i=ne[i])//n\n\t\tif (s[te[i]]>s[_h]&&te[i]!=h[0][G])\n\t\t\t_h=te[i];\n\tdp(G);//nlogn\n\tfor(int i=1; i<=n; i++)//n\n\t\tif (i!=G) F[{i, i}]=t[i];\n\tfor(int x=h[1][G]; x; x=h[0][x])//n\n\t\tF[{x, h[0][G]}]=F[{f[x], h[0][G]}]+s[h[0][G]]-2*s[x];\n\tfor(int x=h[0][_h]; x; x=h[0][x])//n\n\t\tF[{x, _h}]=F[{f[x], _h}]+s[_h]-2*s[x];\n\tfor(int i=2; i<=n; i++)//nlogn\n\t\tif (a[c[i]]==c[i]) ff(c[i], c[i], g[c[i]][1], c[i]);\n\t\telse if (f[c[i]]!=c[i-1]) ff(c[i], c[i], g[c[i]][1], c[i]);\n\t\telse ff(g[c[i-1]][1], c[i-1], g[c[i]][1], c[i]);\n\tfor(int i=1; i<=n; i++) {//nlogn\n\t\tll pre=F[{g[i][3], a[g[i][3]]}]+t[G]-t[i]-t[a[g[i][3]]]-s[a[g[i][3]]]-(d[i]-1)*s[i]+(d[g[i][3]]-1)*(s[G]-s[i]-s[a[g[i][3]]]);\n\t\tif (i!=G&&sol>F[{g[i][1], i}]+pre)\n\t\t\tsol=F[{g[i][1], i}]+pre, tar=i;\n\t}\n\tfcout(sol, '\\n');\n\treturn 0;\n}\n```\n$O(n)$\uff1a\n```\n#include<bits/stdc++.h>\n#define enter putchar('\\n')\n#define ll long long\nusing namespace std;\ninline ll fcin() {\n\tll r=0;\n\tbool s=0;\n\tchar c=getchar();\n\tfor(; c<48||c>57; c=getchar()) s^=c=='-';\n\tfor(; c>47&&c<58; c=getchar()) r=r*10+c-48;\n\treturn s? -r: r;\n}\nchar out[20];\nint otop;\ninline void fcout(ll x, char c) {\n\tif (x<0) putchar('-'), x=-x;\n\tif (!x) putchar('0');\n\tfor(otop=0; x; x/=10, ++otop)\n\t\tout[otop]=x%10+48;\n\tfor(--otop; otop>=0; --otop)\n\t\tputchar(out[otop]);\n\tputchar(c);\n}//0.5K\nnamespace Rsort {//\u57fa\u6570\u6392\u5e8f\uff0csigned long long(luogu\u4e0a\u666e\u901a\u57fa\u6392\u6bd4\u677e\u57fa\u6392\u5feb)\n\tconst int K=65536, N=50001, lll=65535;\n\tint he[K], le[K], ne[N], re[N];\n\tvoid rsort(ll e[], int r[], int n) {//the element_array, the rank_array(the return array)\n\t\tfor(int i=0; i<n; i++)\n\t\t\te[i]+=1ull<<63, r[i]=i;\n\t\tfor(int j=0; j<K; j++)\n\t\t\the[j]=-1;\n\t\tfor(int i=0; i<n; i++)\n\t\t\tif (he[e[r[i]]&lll]==-1)\n\t\t\t\tre[le[e[r[i]]&lll]=he[e[r[i]]&lll]=i]=r[i], ne[i]=-1;\n\t\t\telse\n\t\t\t\tre[ne[le[e[r[i]]&lll]]=i]=r[i], ne[le[e[r[i]]&lll]=i]=-1;\n\t\tfor(int i=0, j=0; j<K; j++)\n\t\t\tfor(int l=he[j]; l!=-1; l=ne[l])\n\t\t\t\tr[i++]=re[l];\n\t\tfor(int j=0; j<K; j++)\n\t\t\the[j]=-1;\n\t\tfor(int i=0; i<n; i++)\n\t\t\tif (he[e[r[i]]>>16&lll]==-1)\n\t\t\t\tre[le[e[r[i]]>>16&lll]=he[e[r[i]]>>16&lll]=i]=r[i], ne[i]=-1;\n\t\t\telse\n\t\t\t\tre[ne[le[e[r[i]]>>16&lll]]=i]=r[i], ne[le[e[r[i]]>>16&lll]=i]=-1;\n\t\tfor(int i=0, j=0; j<K; j++)\n\t\t\tfor(int l=he[j]; l!=-1; l=ne[l])\n\t\t\t\tr[i++]=re[l];\n\t\tfor(int j=0; j<K; j++)\n\t\t\the[j]=-1;\n\t\tfor(int i=0; i<n; i++)\n\t\t\tif (he[e[r[i]]>>32&lll]==-1)\n\t\t\t\tre[le[e[r[i]]>>32&lll]=he[e[r[i]]>>32&lll]=i]=r[i], ne[i]=-1;\n\t\t\telse\n\t\t\t\tre[ne[le[e[r[i]]>>32&lll]]=i]=r[i], ne[le[e[r[i]]>>32&lll]=i]=-1;\n\t\tfor(int i=0, j=0; j<K; j++)\n\t\t\tfor(int l=he[j]; l!=-1; l=ne[l])\n\t\t\t\tr[i++]=re[l];\n\t\tfor(int j=0; j<K; j++)\n\t\t\the[j]=-1;\n\t\tfor(int i=0; i<n; i++)\n\t\t\tif (he[e[r[i]]>>48&lll]==-1)\n\t\t\t\tre[le[e[r[i]]>>48&lll]=he[e[r[i]]>>48&lll]=i]=r[i], ne[i]=-1;\n\t\t\telse\n\t\t\t\tre[ne[le[e[r[i]]>>48&lll]]=i]=r[i], ne[le[e[r[i]]>>48&lll]=i]=-1;\n\t\tfor(int i=0, j=0; j<K; j++)\n\t\t\tfor(int l=he[j]; l!=-1; l=ne[l])\n\t\t\t\tr[i++]=re[l];//\u5faa\u73af\u5c55\u5f00 4\u6b21 \n\t\tfor(int i=0; i<n; i++)\n\t\t\te[i]+=1ull<<63;\n\t}\n}//1.7K\n//========================================================================================\nconst int N=50001;\nint n, _h, _c, G;\nint a[N], c[N], d[N], e[N], f[N], g[N][5], h[N];\nll s[N], t[N], w[N], F[N], E[N], ans=1e18, sum, tmp, pos;//\u5341\u5e74OI\u4e00\u573a\u7a7a\uff0c\u4e0d\u5f00longlong\u89c1\u7956\u5b97\n//E[g[i][3]]=F[g[i][3], a[g[i][3]]], F[i]=F[g[i][1], i]\nint cnt, he[N], ne[N<<1], te[N<<1];\nvoid con(int x, int y) {\n\tne[++cnt]=he[x], te[he[x]=cnt]=y;\n\tne[++cnt]=he[y], te[he[y]=cnt]=x;\n}\nvoid dfs0(int x) {//init\n\ts[x]=w[x], t[x]=0, d[x]=d[f[x]]+1;\n   \tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x]) {\n\t\t\tf[te[i]]=x;\n\t\t\tdfs0(te[i]);\n\t\t\ts[x]+=s[te[i]];\n\t\t\tt[x]+=t[te[i]]+s[te[i]];\n\t\t\tif (s[h[x]]<s[te[i]]) h[x]=te[i];\n\t\t}\n}\nvoid dfs1(int x) {//\u62d3\u6251\u6392\u5e8f \n\tc[++c[0]]=x;\n\tif (h[x]) a[h[x]]=x==G? h[x]: a[x], dfs1(h[x]);\n\tfor(int i=he[x]; i; i=ne[i])\n\t\tif (te[i]!=f[x]&&te[i]!=h[x])\n\t\t\ta[te[i]]=x==G? te[i]: a[x], dfs1(te[i]);\n}\nvoid ff(int xx, int rtt, int x, int rt, ll pre) {//(xx, rtt)->(x, rt)\n\tif (xx!=x)\n\t\tfor(int _x=h[xx]; ; _x=h[_x]) {\n\t\t\tpre+=s[rtt]-2*s[_x];\n\t\t\tif (_x==x) break;\n\t\t}\n\tF[rt]=pre;\n\tif (rtt!=rt)\n\t\tF[rt]+=t[rt]-t[rtt]+(d[x]-d[rt]+2)*s[rt]-(d[x]-d[rt]+1)*s[rtt];\n}//1.0K\nint main() {\n\tn=fcin();\n\tfor(int i=2; i<=n; i++)//n\n\t\tcon(fcin(), fcin());\n\tfor(int i=1; i<=n; i++)//n\n\t\tw[i]=fcin();\n\tdfs0(1);//n\n\tif (s[h[1]]*2<=s[1]) G=1;\n\telse {\n\t\tfor(int i=2; i<=n; i++)//n\n\t\t\tif (s[h[i]]*2<=s[1]&&s[i]*2>=s[1]) {\n\t\t\t\tG=i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tf[G]=0, memset(h, 0, sizeof h), dfs0(G);//n\n\t}\n\tfor(int pos=0, i=he[G]; i; i=ne[i])//\u5bfb\u627e\u6b21\u91cd\u513f\u5b50//n\n\t\tif (s[te[i]]>pos&&te[i]!=h[G])\n\t\t\t_h=te[i], pos=s[te[i]];\n\tdfs1(G), _c=2+s[h[G]];//c[_c]=_h//n\n\tfor(int i=2, j=1; i<=n; i++) {//n\n\t\tif (f[c[i]]!=c[i-1]) j=i;\n\t\twhile(s[h[c[j]]]*2>s[c[i]]) ++j;\n\t\tg[c[i]][1]=c[j];\n\t\tif (s[h[c[j]]]*2==s[c[i]])\n\t\t\tg[c[i]][2]=h[c[j]];\n\t\tif (a[c[i]]==c[i])\n\t\t\tff(c[i], c[i], g[c[i]][1], c[i], t[c[i]]);\n\t\telse if\n\t\t\t(f[c[i]]!=c[i-1]) ff(c[i], c[i], g[c[i]][1], c[i], t[c[i]]);\n\t\telse\n\t\t\tff(g[c[i-1]][1], c[i-1], g[c[i]][1], c[i], F[c[i-1]]);\n\t}\n\tRsort::rsort(s+1, e+1, n);//n\n\tfor(int i=1; i<=n; i++)\n\t\t++e[i];\n\tfor(int i=1, j=G, k=G; i<n; i++)//e[n]=G//n\n\t\tif (a[e[i]]==h[G]) {\n\t\t\tif (s[_h]*2<=s[G]-s[e[i]])\n\t\t\t\tg[e[i]][3]=G;\n\t\t\telse {\n\t\t\t\tif (j==G) j=_h;\n\t\t\t\twhile(s[h[j]]*2>s[G]-s[e[i]]) j=h[j];\n\t\t\t\tg[e[i]][3]=j;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\twhile(s[h[k]]*2>s[G]-s[e[i]]) k=h[k];\n\t\t\tg[e[i]][3]=k;\n\t\t}\n\tE[h[G]]=t[h[G]], E[_h]=t[_h];\n\tfor(int x=h[h[G]]; x; x=h[x])\n\t\tE[x]=E[f[x]]+s[h[G]]-2*s[x];\n\tfor(int x=h[_h]; x; x=h[x])\n\t\tE[x]=E[f[x]]+s[_h]-2*s[x];\n\tfor(int i=1; i<=n; i++) {\n\t\tll pre=E[g[i][3]]+t[G]-t[i]-t[a[g[i][3]]]-(d[i]-1)*s[i]+(d[g[i][3]]-1)*(s[G]-s[i]-s[a[g[i][3]]])-s[a[g[i][3]]];\n\t\tif (i!=G&&ans>F[i]+pre)\n\t\t\tans=F[i]+pre;\n\t}\n\tfcout(ans, '\\n');\n\treturn 0;\n}//1.8K\n```",
        "postTime": 1626228144,
        "uid": 368859,
        "name": "1234567_scp",
        "ccfLevel": 7,
        "title": "P2726 \u6811\u7684\u53cc\u4e2d\u5fc3"
    },
    {
        "content": "\n# \u9898\u76ee\u5927\u610f\n\u7ed9\u5b9a\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u51fd\u6570$S(x,y)=\\sum\\limits_{v\\in V}(W(v)*min(d(x,v),d(y,v)))$,\u5176\u4e2d$V$\u662f\u70b9\u96c6\uff0c$W(v)$\u662f$v$\u70b9\u7684\u6743\u503c\uff0c$d(x,y)$\u8868\u793a\u6811\u4e0a\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\n\u6c42\u5f53$x$\u548c$y$\u53d6\u591a\u5c11\u65f6\uff0c$S(x,y)$\u80fd\u53d6\u5230\u6700\u5c0f\u503c\uff0c\u5e76\u8f93\u51fa\u8fd9\u4e2a\u6700\u5c0f\u503c\u3002\n# Solution\n\u9996\u5148\u9700\u8981\u7edf\u4e00\u7684\u662f\uff0c$W(v)$\u662f\u4e00\u5b9a\u7684\uff0c\u6240\u4ee5\u5982\u679c\u53ea\u6709$1$\u4e2a\u70b9\u65f6\uff0c\u5c31\u5fc5\u5b9a\u53d6\u91cd\u5fc3\u3002\n\n\n\u7136\u800c\u9898\u76ee\u4e2d\u662f$2$\u4e2a\u70b9\uff0c\u4f46\u662f$S(x,y)$\u7684\u542b\u4e49\u8fd8\u662f\u548c\u91cd\u5fc3\u6240\u5dee\u65e0\u51e0\u3002\u4e00\u65e6\u9009\u4e2d\u4e86$x,y$\uff0c\u90a3\u4e48\u6574\u68f5\u6811\u7684\u70b9\u96c6\u5c31\u5206\u6210\u4e86\u5230$x$\u70b9\u548c\u5230$y$\u70b9\u4e24\u90e8\u5206\uff0c\u800c\u8fd9\u4e24\u90e8\u5206\u4e00\u5b9a\u662f\u5185\u90e8\u4e92\u76f8\u8fde\u901a\u7684\uff0c\u6240\u4ee5\u5f00\u59cb\u7684\u65f6\u5019\u4e0d\u59a8\u628a\u5b83\u770b\u505a\u662f\u5207\u6210$2$\u68f5\u5b50\u6811\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u68f5\u5b50\u6811\u90fd\u6c42\u4e00\u4e0b\u91cd\u5fc3\uff0c\u4f5c\u4e3a$x,y$\u3002\n\n\n\u8bfb\u9898\u540e\u53d1\u73b0\uff0c\u6811\u7684\u9ad8\u5ea6\u6700\u5927\u662f$100$\uff0c\u5229\u7528\u8fd9\u4e00\u7279\u6027\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u5728$O(h)$\u7684\u8303\u56f4\u5185\u6c42\u89e3\u4efb\u610f\u5b50\u6811\u7684\u91cd\u5fc3\uff0c\u90a3\u4e48\u8fd9\u9898\u5c31\u5f97\u89e3\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u65ad\u8fb9\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u6b21\u65ad\u8fb9\uff0c\u5206\u522b\u6c42\u51fa\u4e24\u68f5\u5b50\u6811\u7684\u91cd\u5fc3\uff0c\u7136\u540e\u66f4\u65b0\u7b54\u6848\u3002\n\n- **\u90a3\u4e48\u53ef\u4ee5\u5728$O(h)$\u5185\u6c42\u89e3\u91cd\u5fc3\u5417\uff1f**\n\n- **\u53ef\u4ee5\u7684\uff01**\n\n\u9996\u5148\u8bbe$f(u)$\u8868\u793a\u6574\u68f5\u6811\u4e2d**\u6240\u6709\u8282\u70b9**\u5230$u$\u7684\u8ddd\u79bb\u548c(\u5f53\u7136\u8981\u4e58\u4e0a\u70b9\u6743)\uff0c$siz[u]$\u8868\u793a$u$\u7684**\u5b50\u6811**\u5927\u5c0f\uff0c$v$\u4e3a$u$\u7684\u4e00\u4e2a\u513f\u5b50\uff0c\u5219\u53ef\u4ee5\u9012\u63a8\uff1a\n$$f(v)=f(u)+siz[root]-siz[v]-siz[v]$$\n\u89e3\u91ca\uff1a\u5f53\u70b9\u4e0b\u79fb\u4e86\u4e00\u683c\u540e\uff0c\u9664\u4e86$v$\u7684\u5b50\u6811\u5185\u7684\u70b9\uff0c\u5176\u5b83\u90fd\u591a\u8d70\u4e86\u4e00\u683c\uff0c\u6240\u4ee5\u8981\u52a0\u4e0a$siz[root]-siz[v]$\uff0c\u4f46\u662f$v$\u4e3a\u6839\u7684\u5b50\u6811\u5185\u6240\u6709\u70b9\u53ef\u4ee5\u5c11\u8d70\u4e00\u683c\uff0c\u6240\u4ee5\u51cf\u53bb$siz[v]$\u3002\n\n\u90a3\u4e48\u6839\u636e\u91cd\u5fc3\u7684\u6027\u8d28\uff0c\u5982\u679c$v$\u6bd4$u$\u66f4\u9002\u5408\u5f53\u91cd\u5fc3\uff0c\u90a3\u4e48\u6709$f(v)<f(u)$\n\u5373\n\n$$f(u)+siz[root]-2*siz[v]<f(u)$$\n\n\u53ef\u77e5\uff0c\u5f53\n\n$$siz[root]<2*siz[v]$$\n\n\u65f6\uff0c\u624d\u6709\u5411\u4e0b\u8d70\u7684\u5fc5\u8981\u3002\n\n\u53c8\u7531\u4e8e\uff0c\u91cd\u5fc3\u4e2d\u6700\u5927\u7684\u5b50\u6811\u4e0d\u4f1a\u8d85\u8fc7\u603b\u8282\u70b9\u6570\u7684\u4e00\u534a\uff0c\u6240\u4ee5\u6ee1\u8db3$siz[root]<2*siz[v]$\u7684\u8282\u70b9\u6570\u4e0d\u4f1a\u8d85\u8fc7$1$\u4e2a\uff0c\u6240\u4ee5\u4ece\u6839\u5f00\u59cb\uff0c\u6bcf\u6b21\u8d70\u5b50\u6811\u6700\u5927\u7684\u513f\u5b50\uff0c\u76f4\u5230\u4e0d\u6ee1\u8db3\u4e0d\u7b49\u5f0f\uff0c\u4e4b\u524d$f(u)$\u6700\u5927\u7684\u90a3\u4e2a\u70b9\u5c31\u662f\u91cd\u5fc3\u3002\n\n\u7efc\u4e0a\uff0c\u53ef\u4ee5\u5f97\u51fa\u8fd9\u9898\u7684\u89e3\u6cd5\uff1a\n\n- $stp1\\quad$ \u5148$dfs$\u9884\u5904\u7406\u51fa\u4ee5\u4e0b\u4fe1\u606f\uff1a\n\u5b50\u6811\u5927\u5c0f$siz[u]$\uff0c\u6df1\u5ea6$dep[u]$\uff0c\u5b50\u6811\u4e2d\u6240\u6709\u70b9\u5230\u5f53\u524d\u70b9\u7684\u8ddd\u79bb\u548c$dp[u]$\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u7236\u4eb2$fa[u]$\u3002\n\u6bcf\u4e2a\u8282\u70b9\u6240\u6709\u513f\u5b50\u4e2d\u5b50\u6811\u6700\u5927\u7684\u7f16\u53f7$id1[u]$\u4e0e\u6b21\u5927\u7684\u7f16\u53f7$id2[u]$\u3002(\u4e3a\u4ec0\u4e48\u8981\u6b21\u5927\uff0c\u540e\u9762\u4f1a\u8bb2)\u3002\n- $stp2\\quad$ \u7136\u540e\u679a\u4e3e\u5207\u65ad\u7684\u8fb9\uff0c\u8bb0\u65ad\u8fb9\u76f8\u8fde\u7684\u6df1\u5ea6\u5927\u7684\u90a3\u4e2a\u70b9\u662f$cut$\uff0c\u7136\u540e\u4ece$cut$\u5f00\u59cb\uff0c\u5411\u7236\u4eb2\u8fed\u4ee3\uff0c\u5e76\u66f4\u65b0\u7236\u4eb2\u7684$siz[u]$\u7684\u503c\u3002\n- $stp3\\quad$ \u7136\u540e\u8ba1\u7b97\u7b54\u6848\uff0c\u53ef\u4ee5\u7528\u9012\u5f52\u8bb0\u5f55\u4fe1\u606f\u3002\n\n```cpp\nint ret=inf,ct;\nvoid dfs1(int x,int cur,int S){//x\uff1a\u5f53\u524d\u8282\u70b9\t\tcur\uff1a\u5f53\u524d\u7b54\u6848\tS\uff1a\u5207\u65ad\u540ex\u6240\u5728\u6811\u7684\u603b\u7684\u5927\u5c0f\n\tret=min(ret,cur);\n\tint s=id1[x];\n\tif(s==ct||siz[s]<siz[id2[x]]) s=id2[x];//\u5982\u679c\u6700\u5927\u7684\u513f\u5b50\u88ab\u7834\u574f\u6216\u8005\u88ab\u5207\u65ad\uff0c\u5219\u9000\u53d6\u6b21\u5927\u7684\u513f\u5b50\n\tif(!s) return;\n\tif(S<2*siz[s])\n\t\tdfs1(s,cur+S-2*siz[s],S);//\u53ea\u6709\u6ee1\u8db3\u6761\u4ef6\u624d\u6709\u5fc5\u8981\u9012\u5f52\uff0c\u5e76\u5229\u7528\u4e0a\u9762\u7684\u9012\u63a8\u5f0f\u5f97\u51fa\u7b54\u6848\n}\n\nret=inf;dfs1(1,dp[1]-dp[i]-siz[i]*dep[i],siz[1]);A=ret;\n//\u5904\u7406\u4e0a\u65b9\u7684\u90a3\u68f5\u6811\uff0c\u6b64\u65f6f[1]=dp[1]-dp[i]-siz[i]*dep[i],\u4e0d\u7406\u89e3\u7684\u5148\u770b\u7740\nret=inf;dfs1(i,dp[i],siz[i]);B=ret;\n//\u5904\u7406\u4e0b\u65b9\u7684\n```\n- $stp4\\quad$ \u66f4\u65b0\u5386\u53f2\u6700\u4f18\u503c\uff0c\u518d\u6b21\u4ece\u5207\u70b9\u5f00\u59cb\u5411\u7236\u4eb2\u8fed\u4ee3\uff0c\u56de\u6eaf\uff0c\u8c03\u5230$stp2$\n- $stp5\\quad$ \u8f93\u51fa\u7b54\u6848\uff0c\u7ed3\u675f\u3002\n\n\u5bf9\u4e8e\u5f0f\u5b50$f[1]=dp[1]-dp[i]-siz[i]*dep[i]$\uff0c\u5c31\u662f\u5982\u679c\u53ea\u6709$f[1]=dp[1]-dp[i]$\u5bb9\u6613\u7406\u89e3\u5c11\u8003\u8651\u4e86\u5b50\u6811$i$\u7684\u6df1\u5ea6\uff0c\u90a3\u4e48\u5168\u4f53\u4e58\u4e0a\u6df1\u5ea6\u5373\u53ef\u3002\n# Code\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define inf 1<<30\nusing namespace std;\nconst int MAXN=5e4+10;\nvector<int> e[MAXN];\nint w[MAXN];\nint dp[MAXN],f[MAXN],dep[MAXN];\nint siz[MAXN],id1[MAXN],id2[MAXN];\nvoid dfs(int x,int fa){\n\tf[x]=fa;\n\tsiz[x]=w[x];int s1=0,s2=0;\n\tfor(int i=0;i<e[x].size();i++){\n\t\tint s=e[x][i];\n\t\tif(s==fa) continue;\n\t\tdep[s]=dep[x]+1;\n\t\tdfs(s,x);\n\t\tsiz[x]+=siz[s];\n\t\tdp[x]+=dp[s]+siz[s];\n\t\tif(siz[s]>s1){\n\t\t\ts2=s1,s1=siz[s];\n\t\t\tid2[x]=id1[x],id1[x]=s;\n\t\t}\n\t\telse if(siz[s]>s2)\n\t\t\ts2=siz[s],id2[x]=s;\n\t}\n}\nint ret=inf,ct;\nvoid dfs1(int x,int cur,int S){\n\tret=min(ret,cur);\n\tint s=id1[x];\n\tif(s==ct||siz[s]<siz[id2[x]]) s=id2[x];\n\tif(!s) return;\n\tif(S<2*siz[s])\n\t\tdfs1(s,cur+S-2*siz[s],S);\n}\nint main()\n{\n\tint n,x,y;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\te[x].push_back(y);\n\t\te[y].push_back(x);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d\",&w[i]);\n\tdfs(1,-1);\n\tint ans=inf;\n\tfor(int i=2;i<=n;i++){\n\t\tfor(int j=f[i];j!=-1;j=f[j]) siz[j]-=siz[i];\n\t\tint A,B;ct=i;\n\t\tret=inf;dfs1(1,dp[1]-dp[i]-siz[i]*dep[i],siz[1]);A=ret;\n\t\tret=inf;dfs1(i,dp[i],siz[i]);B=ret;\n\t\tans=min(ans,A+B);\n\t\tfor(int j=f[i];j!=-1;j=f[j]) siz[j]+=siz[i];\n\t}printf(\"%d\\n\",ans);\n}\n```\n",
        "postTime": 1615339856,
        "uid": 292315,
        "name": "ZCETHAN",
        "ccfLevel": 7,
        "title": "[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3"
    },
    {
        "content": "\u9996\u5148\uff0c\u6211\u4eec\u4f1a\u6709\u4e00\u4e2a\u5f88\u7b80\u5355\u7684\u60f3\u6cd5\uff0c\u679a\u4e3e\u65ad\u8fb9\uff0c\u4ea7\u751f\u4e24\u68f5\u5b50\u6811\uff0c\u7136\u540e\u5728\u4e24\u68f5\u6811\u5185\u5206\u522b\u6c42\u5e26\u6743\u91cd\u5fc3\uff0c\u8ba1\u7b97\u8d21\u732e\uff0c\u8fd9\u6837\u7684\u8bdd\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8981\u597d\u597d\u5229\u7528 $h \\leq 100 $ \u7684\u6027\u8d28\u3002\n\n\u8003\u8651 $sze[u]$ \u4e3a\u5e26\u6743\u91cd\u91cf\uff0c$g[u]$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\u7684\u6811\uff0c\u6240\u6709\u70b9\u90fd\u5230 $u$ \u7684\u4ee3\u4ef7\u3002\n\n\u6240\u4ee5 $g[u] = \\sum\\limits_{v\\in{son(u)}}{g[v] + sze[v]}$\n\n\u8003\u8651 $f[u]$ \u4e3a $u$ \u5728\u7684\u4e00\u68f5\u6811\u4e2d\uff0c\u6240\u6709\u70b9\u5230 $u$ \u7684\u603b\u4ee3\u4ef7\u3002\n\n\u7531\u4e8e\u8ba1\u7b97\u662f\u52a8\u6001\u7684\uff0c\u6211\u4eec\u8003\u8651\u8f6c\u79fb\u3002\n\n\u5bf9\u4e8e $v \\in son(u)$ \u6709 $f[v] = f[u] + (S - sze[v]) - sze[v]$\n\n\u5982\u679c $v$ \u6bd4 $u$ \u66f4\u4f18\uff0c\u5f53\u4e14\u4ec5\u5f53 $2 * sze[v] > S$\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u6709\u4e24\u4e2a\u5019\u9009\u9879\uff0c\u91cd\u513f\u5b50\u548c\u6b21\u91cd\u513f\u5b50\u3002\u9012\u5f52\u65f6\u987a\u5e26\u7ef4\u62a4\u53d8\u5316\u5373\u53ef\u3002\n\n\u6700\u574f\u60c5\u51b5\u53ef\u80fd\u4f1a\u662f\u4e00\u6761\u5230\u5e95\u7684\u94fe\uff0c\u6240\u4ee5\u590d\u6742\u5ea6 $O(nh)$\n\n### code: ###\n\n```cpp\nconst int Maxn = 5e5 + 5, Maxm = 1e6 + 5;\nint n, cnt = 0, w[Maxn], head[Maxn], ver[Maxm], nxt[Maxm];\ninline void AddEdge(int u, int v) {\n\tver[++cnt] = v, nxt[cnt] = head[u], head[u] = cnt;\n\tver[++cnt] = u, nxt[cnt] = head[v], head[v] = cnt;\n}\n\nint dep[Maxn], fat[Maxn], son[Maxn], son2[Maxn];\nint sze[Maxn], g[Maxn], cut, ans = INT_MAX;\ninline void DfsFir(int u) {\n\tsze[u] = w[u];\n\tfor (int i = head[u]; i; i = nxt[i]) {\n\t\tif (ver[i] == fat[u]) continue;\n\t\tdep[ver[i]] = dep[u] + 1; fat[ver[i]] = u;\n\t\tDfsFir(ver[i]); sze[u] += sze[ver[i]];\n\t\tg[u] += g[ver[i]] + sze[ver[i]];\n\t\tif (sze[ver[i]] > sze[son[u]]) son2[u] = son[u], son[u] = ver[i];\n\t\telse if (sze[ver[i]] > sze[son2[u]]) son2[u] = ver[i];\n\t}\n}\n\ninline void getans(int u, int val, int all, int &ret) {\n\tchkmin(ret, val); int v = son[u];\n\tif (v == cut || sze[son[u]] < sze[son2[u]]) v = son2[u];\n\tif (!v) return;\n\tif (2 * sze[v] > all) getans(v, val + all - 2 * sze[v], all, ret);\n}\n\ninline void DfsSec(int u) {\n\tfor (int i = head[u]; i; i = nxt[i]) {\n\t\tif (ver[i] == fat[u]) continue;\n\t\tcut = ver[i]; int x = INT_MAX, y = INT_MAX;\n\t\tfor (int pos = u; pos; pos = fat[pos]) sze[pos] -= sze[ver[i]];\n\t\tgetans(1, g[1] - g[ver[i]] - dep[ver[i]] * sze[ver[i]], sze[1], x);\n\t\tgetans(ver[i], g[ver[i]], sze[ver[i]], y); chkmin(ans, x + y);\n\t\tfor (int pos = u; pos; pos = fat[pos]) sze[pos] += sze[ver[i]];\n\t\tDfsSec(ver[i]);\n\t}\n}\n\nsigned main(void) {\n//\tfile(\"\");\n\tread(n);\n\tfor (int i = 1, u, v; i < n; i++)\n\t\tread(u), read(v), AddEdge(u, v);\n\tfor (int i = 1; i <= n; i++) read(w[i]);\n\tDfsFir(1); DfsSec(1); writeln(ans);\n//\tfwrite(pf, 1, o1 - pf, stdout);\n\treturn 0;\n}\n```\n",
        "postTime": 1600494500,
        "uid": 50925,
        "name": "EternalEpic",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2726 \u3010[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3\u3011"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811 $T=(V,E)$\uff0c\u5176\u4e2d $V$ \u4e3a\u8282\u70b9\u96c6\u5408\uff0c$E$ \u4e3a\u8fb9\u96c6\u5408\uff0c\u5bf9\u4e8e $V$ \u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9 $v$\uff0c\u6709\u4e00\u4e2a\u6743\u503c\u51fd\u6570 $W(v)$\uff0c\u8be5\u51fd\u6570\u7684\u503c\u5747\u4e3a\u6b63\u6574\u6570\uff0c\u8bb0 $d(u,v)$ \u4e3a\u8282\u70b9 $u$ \u548c $v$ \u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u8868\u793a\u4ed6\u4eec\u4e4b\u95f4\u552f\u4e00\u7684\u4e00\u6761\u8def\u5f84\u7684\u8fb9\u6570\u3002\u82e5 $u$ \u548c $v$ \u4e3a\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u5219 $d(u,v)=0$\u3002\u4f60\u7684\u4efb\u52a1\u662f\u627e\u51fa\u4e24\u4e2a\u4e0d\u540c\u7684\u8282\u70b9 $x,y$\uff0c\u4f7f\u5f97\u4ee5\u4e0b\u8868\u8fbe\u5f0f $S(x,y)$ \u6700\u5c0f\uff1a\n\n$$S(x,y)=\\sum\\limits_{v\\in V}(W(v)\\times min(d(x,v),d(y,v)))$$\n\n\u7528\u4eba\u8bdd\u8bb2\u5c31\u662f\uff1a\u7ed9\u5b9a\u4e00\u9897\u65e0\u6839\u6570\uff0c\u5728\u6811\u4e2d\u53d6\u4e24\u4e2a\u70b9\uff0c\u8ba9\u5176\u4ed6\u6240\u6709\u70b9\u300c\u5230\u8fd9\u4e24\u4e2a\u70b9\u7684\u8f83\u5c0f\u8ddd\u79bb\u300d\u7684\u548c\u6700\u5c0f\u3002\n\n## \u601d\u8def\u5206\u6790\n\n\u770b\u9898\u76ee\u7b2c\u4e00\u773c\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u4f1a\u6709\u4e2a\u5927\u81f4\u601d\u8def\uff1a\n1. \u5c06\u539f\u6811\u5206\u6210\u4e24\u4e2a\u6811\uff1b\n2. \u5206\u522b\u627e\u5230\u4e24\u4e2a\u6811\u7684\u91cd\u5fc3\uff1b\n3. \u6c42\u548c\u3002\n\n\u5206\u6790\u4e00\u4e0b\u590d\u6742\u5ea6\uff0c\u64cd\u4f5c $1$ \u4e3a $O(n)$ \u65e0\u7591\uff0c\u64cd\u4f5c $2,3$ \u5982\u679c\u662f dfs \u7684\u8bdd\u4e5f\u662f $O(n)$\u3002\n\n\u663e\u7136 $O(n^2)$ \u5bf9\u4e8e $1 < N\\le 5\\times 10^4$ \u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u6765\u8bf4\u5b9e\u5728\u662f\u6709\u70b9\u592a\u5927\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528 DP \u6765\u505a\u3002\n\n\u4e8e\u662f\uff0c\u679a\u4e3e $+$ DP\uff0c\u601d\u8def\u901a\u3002\n\n## \u65b9\u6cd5\u89e3\u6790\n\n\u5148\u6765\u590d\u4e60\u4e00\u4e0b\u6811\u7684\u91cd\u5fc3\u7684\u6027\u8d28\uff1a\n> \u91cd\u5fc3\u662f\u6307\u6811\u4e2d\u7684\u4e00\u4e2a\u7ed3\u70b9\uff0c\u5982\u679c\u5c06\u8fd9\u4e2a\u70b9\u5220\u9664\u540e\uff0c\u5269\u4f59\u5404\u4e2a\u8fde\u901a\u5757\u4e2d\u70b9\u6570\u7684\u6700\u5927\u503c\u6700\u5c0f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8282\u70b9\u88ab\u79f0\u4e3a\u6811\u7684\u91cd\u5fc3\u3002\n\n\u663e\u7136\uff0c\u300c\u5c06\u91cd\u5fc3\u5220\u9664\u540e\u5269\u4f59\u5404\u4e2a\u8fde\u901a\u5757\u4e2d\u70b9\u6570\u7684\u6700\u5927\u503c\u300d\u4e00\u5b9a\u5c0f\u4e8e\u300c\u6811\u7684\u603b\u7ed3\u70b9\u4e2a\u6570\u7684\u4e00\u534a\u300d\u3002\n\n----------\n\n\u56e0\u6b64\uff1a\n\n- \u5f53\u6211\u4eec\u5728\u627e\u91cd\u5fc3\u65f6\uff0c\u82e5\u5f53\u524d\u8282\u70b9\u7f16\u53f7\u4e3a $u$\uff0c\u90a3\u4e48\u6211\u4eec\u6bcf\u6b21\u53ea\u8981\u5f80 $u$ \u7684\u6700\u5927\u5b50\u6811\u8d70\u5373\u53ef\uff1b\u5e76\u4e14\uff0c\u53ea\u6709\u5f53 $u$ \u7684\u300c\u6700\u5927\u5b50\u6811\u4e2a\u6570\u300d$>$\u300c\u6b64\u6811\u603b\u7ed3\u70b9\u4e2a\u6570\u7684\u4e00\u534a\u300d\uff0c\u6211\u4eec\u624d\u6709\u7ee7\u7eed\u8d70\u4e0b\u53bb\u7684\u5fc5\u8981\u3002\n\n\u4e8e\u662f\uff0c\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u5927\u5927\u964d\u4f4e\uff0c\u518d\u52a0\u4e0a\u4e00\u70b9\u9884\u5904\u7406\uff0c\u4fbf\u80fd\u591f\u518d\u8db3\u591f\u77ed\u7684\u65f6\u95f4\u5185\u5f97\u51fa\u7b54\u6848\u3002\n\n----------\n\n\u63a5\u4e0b\u6765\u770b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n\u6211\u4eec\u5148\u4eba\u4e3a\u8bbe\u6811\u7684\u6839\u8282\u70b9\u4e3a $root$\u3002\n\n\u8bbe\u300c\u6811\u4e2d\u6240\u6709\u70b9\u5230 $i$ \u7684\u4ef7\u503c\u4e4b\u548c\u300d\u4e3a $dp_i$\u3002\n\n\u5373\u300c\u6811\u4e2d\u6bcf\u4e00\u4e2a\u70b9\u7684\u70b9\u6743 $\\times$ \u6b64\u70b9\u5230 $i$ \u7684\u8ddd\u79bb\u300d \u4e3a $dp_i$\u3002\n\n------------\n\n\u82e5 $t$ \u662f $u$ \u7684\u5b50\u8282\u70b9\u3002\n\n\u8003\u8651\uff1a\u5982\u4f55\u5728\u5df2\u77e5 $dp_u$ \u7684\u60c5\u51b5\u4e0b\u5f97\u51fa $dp_t$\u3002\n\n\u901a\u8fc7\u601d\u8003\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c$t$ \u76f8\u6bd4 $u$\uff0c\u6240\u6709\u5728 $u$ \u8fd9\u4e00\u8fb9\u7684\u8282\u70b9\u90fd\u591a\u8d70\u4e86\u4e00\u6b65\uff0c\u6240\u6709\u5728 $t$ \u8fd9\u4e00\u8fb9\u7684\u8282\u70b9\u90fd\u5c11\u8d70\u4e86\u4e00\u6b65\u3002\n\n\u8bbe\u6811\u4e2d\u8282\u70b9 $i$ \u7684\u5b50\u6811\u7684\u70b9\u6743\u548c\uff08\u5305\u62ec $i$\uff09\u4e3a $siz_i$\uff0c\u6b64\u6811\u7684\u603b\u8282\u70b9\u7684\u70b9\u6743\u548c\u4e3a $cnt$\u3002\n\n\u90a3\u4e48\uff1a\n- \u6240\u6709\u5728 $t$ \u8fd9\u4e00\u8fb9\u7684\u8282\u70b9\u7684\u70b9\u6743\u548c\u4fbf\u4e3a $siz_t$\uff1b  \n  \u6240\u6709\u5728 $u$ \u8fd9\u4e00\u8fb9\u7684\u8282\u70b9\u7684\u70b9\u6743\u548c\u4fbf\u4e3a $cnt - siz_t$\u3002\n\n\u4e8e\u662f\u4fbf\u53ef\u5f97\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$siz_t = siz_u + (cnt - siz_t) - siz_t$$\n\u5373\u4e3a\uff1a\n$$siz_t = siz_u + cnt - 2 \\times siz_t$$\n\n---------------------\n\n\u6211\u4eec\u518d\u6765\u8003\u8651\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff1a\u4e00\u4e2a\u70b9\u7684\u6700\u5927\u5b50\u6811\u88ab\u5207\uff0c\u5bfc\u81f4\u5176\u4e0d\u518d\u662f\u6700\u5927\u5b50\u6811\u3002\n\u8fd9\u4e2a\u5176\u5b9e\u5f88\u597d\u8003\u8651\uff0c\u53ea\u8981\u518d\u5b58\u50a8\u4e00\u4e2a\u6b21\u5927\u5b50\u6811\u505a\u300c\u5907\u80ce\u300d\u5373\u53ef\u3002\n\n\u7136\u540e\u8003\u8651\uff0c\u5f53\u4e00\u6761\u8fb9\u88ab\u780d\u6389\u4e4b\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002\n\n\u8bbe\u5728\u4e0a\u9762\u7684\u6811\u4e3a $A$\uff0c\u5728\u4e0b\u9762\u7684\u4e3a $B$\u3002\n\n\u6613\u5f97\uff1a$A$ \u4e2d\u7684 $siz$\u3001$dp$ \u5747\u4f1a\u53d1\u751f\u53d8\u5316\u3002\n\n\u6211\u4eec\u8fd8\u662f\u8bbe\u300c\u65ad\u8fb9\u300d\u4e0a\u9762\u7684\u8282\u70b9\u4e3a $u$\uff0c\u4e0b\u9762\u7684\u8282\u70b9\u4e3a $t$\u3002\n\n\u5bf9\u4e8e $siz$ \u6765\u8bf4\uff0c$u$ \u7684\u6240\u6709\u300c\u7956\u5148\u8282\u70b9\u300d\u90fd\u5931\u53bb\u4e86\u4ee5 $t$ \u4e3a\u6839\u7684\u5b50\u6811\u3002\n\n\u5bf9\u4e8e $dp$ \u6765\u8bf4\uff0c\u7531\u4e8e\u6211\u4eec\u603b\u662f\u4ece\u4e00\u4e2a\u6839\u8282\u70b9\u5f00\u59cb\u9012\u5f52\u627e\u91cd\u5fc3\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u8981\u77e5\u9053 $dp[1]$ \u7684\u53d8\u5316\u503c\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $dp[1]$\uff0c\u5148\u524d\u6709 $siz_t$ \u4e2a\u8282\u70b9\u4f1a\u8d70\u5230 $root$\uff0c\u800c\u73b0\u5728\u6ca1\u6709\u4e86\u3002\n\n\u56e0\u6b64\u6211\u4eec\u8bbe $i$ \u8282\u70b9\u7684\u6df1\u5ea6\u4e3a $dep_i$\uff08$root$ \u7684\u6df1\u5ea6\u4e3a0\uff09\uff0c\u5219\u6709\uff1a\n\n$$dp[1] = dp[1] - siz_t \\times dep_t$$\n\n------------------------\n\n**\u6700\u540e\uff0c\u6211\u4eec\u8981\u9884\u5904\u7406\u7684\u6570\u7ec4\u4e3a**\uff1a\n\n- $dep_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u6df1\u5ea6\uff1b\n- $fa_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u7236\u4eb2\u8282\u70b9\uff1b\n- $maxs_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u6700\u5927\u5b50\u6811\u5927\u5c0f\uff1b\n- $maxnum_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u6700\u5927\u5b50\u6811\u7f16\u53f7\uff1b\n- $remax_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u6b21\u5927\u5b50\u6811\u5927\u5c0f\uff1b\n- $remaxnum_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u6b21\u5927\u5b50\u6811\u7f16\u53f7\uff1b\n- $siz_i$ \u2014\u2014 $i$ \u53f7\u8282\u70b9\u7684\u6240\u6709\u5b50\u8282\u70b9\u7684\u6743\u503c\u4e4b\u548c\uff1b\n- $dp_i$ \u2014\u2014 \u6240\u6709\u70b9\u5230 $i$ \u7684\u4ef7\u503c\u4e4b\u548c\u3002\n\n## AC\u4ee3\u7801\n\n```cpp\n/* Code by Rosmarinus */\n\n#include<iostream>\n#include<vector>\n#include<cstdio>\nusing namespace std;\n\nconst int N = 51000;\nconst int inf = 0x7f7f7f7f;\n\nvector<int>side[N];\nint val[N], dep[N], fa[N], maxs[N], maxnum[N], remax[N], remaxnum[N];\nint siz[N], dp[N], d, ret;\n\nvoid pre(int u, int father, int depth) // \u9884\u5904\u7406\n{\n    int S = side[u].size();\n    fa[u] = father, siz[u] = val[u], dep[u] = depth;\n    for(int i = 0; i < S; i ++)\n    {\n        int t = side[u][i];\n        if(t == father) continue;\n\n        pre(t, u, depth + 1);\n\n        siz[u] += siz[t];\n        dp[u] += dp[t] + siz[t];\n\n        if(siz[t] > maxs[u])\n        {\n            remax[u] = maxs[u];\n            remaxnum[u] = maxnum[u];\n            maxs[u] = siz[t];\n            maxnum[u] = t;\n        }\n        else if(siz[t] > remax[u])\n        {\n            remax[u] = siz[t];\n            remaxnum[u] = t;\n        }\n    }\n}\n\nvoid dfs(int u, int s, int cnt)\n{\n    d = min(d, s);\n    int t = maxnum[u];\n    if(t == ret || siz[t] < siz[remaxnum[u]]) t = remaxnum[u]; // \u4e4b\u524d\u7684\u6700\u5927\u5b50\u6811\u53ef\u80fd\u4e0d\u518d\u662f\u73b0\u5728\u7684\u6700\u5927\u5b50\u6811\u4e86\n    if(t && 2 * siz[t] > cnt) dfs(t, s + cnt - 2 * siz[t], cnt);\n}\n\nint main()\n{\n    int n, x, y, ans = inf;\n\n    scanf(\"%d\", &n);\n\n    for(int i = 1; i < n; i ++)\n    {\n        scanf(\"%d %d\", &x, &y);\n        side[x].push_back(y), side[y].push_back(x);\n    }\n    for(int i = 1; i <= n; i ++) scanf(\"%d\", &val[i]);\n    \n    pre(1, 0, 0);\n    \n    for(int i = 2; i <= n; i ++)\n    {\n        for(int p = fa[i]; p > 0; p = fa[p]) siz[p] -= siz[i];\n        d = inf, ret = i;\n\n        dfs(1, dp[1] - dp[i] - siz[i] * dep[i], siz[1]);\n\n        int a = d;\n        d = inf;\n\n        dfs(i, dp[i], siz[i]);\n        ans = min(ans, a + d);\n\n        for(int p = fa[i]; p > 0; p = fa[p]) siz[p] += siz[i];\n    }\n\n    cout << ans << endl;\n    return 0;\n}\n```",
        "postTime": 1618192400,
        "uid": 509083,
        "name": "Rosmarinus",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2726 \u6811\u7684\u53cc\u4e2d\u5fc3"
    },
    {
        "content": "\u601d\u8def\u524d\u51e0\u7bc7\u9898\u89e3\u5df2\u7ecf\u8bb2\u5f97\u975e\u5e38\u6e05\u695a\u4e86\uff0c\u5c31\u662f\u679a\u4e3e\u5220\u8fb9\uff0c\u5728\u518d\u4e24\u9897\u6811\u5185\u5206\u522b\u5bfb\u627e\u91cd\u5fc3\uff0c\u53c8\u56e0\u4e3a\u4ee3\u4ef7\u7684\u9012\u63a8\u516c\u793a\u4e3a$f[v]=size[1]-size[v]*2+f[u]$\uff08u\u4e3av\u7684\u7236\u4eb2\uff09\uff0c\u6240\u4ee5\u4e00\u5b9a\u662f\u5728$size[1]-size[v]*2<0$\u65f6$f[y]$\u4f1a\u66f4\u4f18\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u4e0e\u6df1\u5ea6\u6709\u5173\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7b97\u51fa\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u6211\u53d1\u8fd9\u7bc7\u9898\u89e3\u4e3b\u8981\u662f\u56e0\u4e3a\u522b\u7684\u9898\u89e3\u5bf9\u4ee3\u7801\u7684\u89e3\u91ca\u592a\u5c11\u4e86\uff0c\u800c\u77e5\u9053\u4e86\u601d\u8def\u540e\u4e0d\u4e00\u5b9a\u5199\u7684\u51fa\u4ee3\u7801\uff08\u6bd4\u5982\u6211\uff09\uff0c\u6240\u4ee5\u5199\u4e86\u4efd\u6ce8\u91ca\u6bd4\u8f83\u591a\u7684\u4ee3\u7801\u3002\n\n```\n#include<cstdio>\n#define inf 0x7f7f7f7f\nusing namespace std;\nconst int maxn=1e5;\nint head[maxn],k=1,n,w[maxn],cur;\nint size[maxn],f[maxn],fa[maxn],ans=inf;\nint son1[maxn],son2[maxn],d[maxn];\n//size\u8bb0\u5f55\u6743\u503c\u548c\uff0cfa\u8bb0\u5f55\u7236\u4eb2\u8282\u70b9\uff0cson1\u8bb0\u5f55\u6df1\u5ea6\u6700\u5927\u7684\u513f\u5b50\n//son2\u8bb0\u5f55\u6df1\u5ea6\u7b2c\u4e8c\u5927\u7684\u513f\u5b50\uff0cd\u8bb0\u5f55\u6df1\u5ea6 \n//cur\u8bb0\u5f55\u65ad\u8fb9\uff0c\u5c31\u662f\u8bb0\u5f55\u65ad\u8fb9\u7684\u4e00\u4e2a\u7aef\u70b9 \nstruct node{\n\tint next,to,fr;\n}e[maxn];\nvoid add(int u,int v)//\u5b58\u56fe \n{\n\tk++;\n\te[k].to=v;\n\te[k].fr=u;\n\te[k].next=head[u];\n\thead[u]=k;\n}\nint max(int a,int b)\n{\n\treturn a>b?a:b;\n}\nint min(int a,int b)\n{\n\treturn a<b?a:b;\n}\nvoid dfs(int x,int ff)\n{\n\tsize[x]=w[x];fa[x]=ff;d[x]=d[ff]+1;//\u8bb0\u5f55\u6df1\u5ea6\uff0c\u7236\u4eb2\u8282\u70b9\uff0csize\u5927\u5c0f\u3002 \n\tfor (int i=head[x];i;i=e[i].next)\n\t{\n\t\tint y=e[i].to;\n\t\tif (y==ff)continue;\n\t\tdfs(y,x);\n\t\tsize[x]+=size[y];\n\t\tf[x]+=size[y]+f[y];//f\u6570\u7ec4\u8868\u793ax\u7684\u5b50\u6811\u5230x\u7684\u4ee3\u4ef7 \u770b\u533b\u9662\u8bbe\u7f6e \n\t\tif (size[y]>size[son1[x]])//son1\u5b58\u6df1\u5ea6\u6700\u5927\u7684\u513f\u5b50\uff0cson2\u5b58\u6df1\u5ea6\u7b2c\u4e8c\u5927\u7684\u513f\u5b50 \n\t\t{\n\t\t\tson2[x]=son1[x];//\u6ce8\u610f\u8fd9\u91cc\u8981\u6539\u53d8 son2\u7684\u503c \n\t\t\tson1[x]=y;\n\t\t}\n\t\telse if (size[y]>size[son2[x]])son2[x]=y;//\u5199else if\u56e0\u4e3a\u4e0a\u4e00\u4e2aif\u5df2\u7ecf\u6539\u8fc7\u4e86 \n\t}\n}\nint find_ans(int x,int now,int sz,int &res)\n{\n\tres=min(res,now);\n\tint v=son1[x];\n\tif (size[son1[x]]<size[son2[x]]||v==cur)v=son2[x];\n\tif (size[v]*2>size[x]&&v)find_ans(v,now+sz-2*size[v],sz,res);\n\t//now+sz-2*size[v]\u8868\u793av\u9009\u8fd9\u4e2a\u70b9\u7684\u4ee3\u4ef7\u3002\n\t//v\u4e3au\u7684\u513f\u5b50 \n\t//\u5982\u679c\u6211\u4eec\u77e5\u9053\u9009u\u7684\u4ee3\u4ef7\u4e3ax\uff0c\u90a3\u4e48\u9009v\u7684\u4ee3\u4ef7\u4e3ax+size[1]-size[v]-size[v];(size[1]\u8868\u793a\u6811\u7684\u603b\u4ee3\u4ef7) \n\t//size[1]-size[v]\u8868\u793av\u4ee5\u4e0a\u7684\u6240\u6709\u70b9\u5230v\u7684\u4ee3\u4ef7\u6bd4\u5230u\u591a\u4e86\u4e00 \uff08\u8fb9\u6743\u4e3a\u4e00\uff09\n\t//-size[v]\u8868\u793av\u7684\u5b50\u6811\u5230v\u7684\u4ee3\u4ef7\u6bd4\u5230u\u5c11\u4e86\u4e00\u3002 \n\t//\u53ef\u770b\u533b\u9662\u8bbe\u7f6e\u90a3\u9053\u9898 \n}\nvoid find(int x)\n{\n\tfor (int i=head[x];i;i=e[i].next)\n\t{\n\t\tint y=e[i].to;\n\t\tif (y==fa[x])continue;\n\t\tcur=y;//\u65ad\u6389\u8fd9\u6761\u8fb9 \n\t\tfor (int i=x;i;i=fa[i])size[i]-=size[y];//\u5df2\u7ecf\u65ad\u6389\u4e86\uff0csize\u6539\u53d8 \n\t\tint a=inf,b=inf;//a,b\u8bb0\u5f55\u7b54\u6848 \n\t\tfind_ans(1,f[1]-f[y]-(d[y]-d[1])*size[y],size[1],a);\n\t\t//\u6211\u4eec\u9996\u5148\u679a\u4e3e\u90091\u65f6\u7684\u4ee3\u4ef7 \n\t\t//f[1]-f[y]-(d[y]-d[1])*size[y]\n\t\t//\u9996\u5148f[1]\u8868\u793a\u6240\u6709\u70b9\u52301\u7684\u4ee3\u4ef7\uff0c\n\t\t//f[y]\u4e3a\u5230y\u7684\u4ee3\u4ef7\uff0c(d[y]-d[1])*size[y]\u4e3av\u8fd9\u9897\u5b50\u6811\u52301\u7684\u4ee3\u4ef7 \n\t\t//-f[y]-(d[y]-d[1])*size[y]\u540e\u8868\u793a\u9664\u4e86v\u8fd9\u4e2a\u5b50\u6811\u7684\u6240\u6709\u70b9\u52301\u7684\u4ee3\u4ef7\u3002 \n\t\tfind_ans(y,f[y],size[y],b);\n\t\tans=min(ans,a+b);//\u8bb0\u5f55\u7b54\u6848 \n\t\tfor (int i=x;i;i=fa[i])size[i]+=size[y];//\u56de\u6eaf\u52a0\u4e0a \n\t\tfind(y);//\u7ee7\u7eed\u9012\u5f52\u679a\u4e3e\u5220\u8fb9 \n\t}\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor (int i=1,x,y;i<n;i++)\n\t{\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);add(y,x);//\u53cc\u5411\u8fb9 \n\t}\n\tfor (int i=1;i<=n;i++)scanf(\"%d\",&w[i]);\n\tdfs(1,0);//\u9996\u5148\u8981\u9884\u5904\u7406\u51fasize,f,son1,son2,d\u6570\u7ec4 \n\tfind(1);\n\tprintf(\"%d\",ans);\n\treturn 0;\n} \n```\n",
        "postTime": 1600764691,
        "uid": 227436,
        "name": "\u5e74\u534e\u5929\u5730",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P2726 \u3010[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3\u3011"
    },
    {
        "content": "# \u9898\u89e3\uff1a\n\n\u89c2\u5bdf\u8868\u8fbe\u5f0f\uff0c\u53d1\u73b0\u8981\u6c42\u7684\u662f\u4e24\u4e2a\u70b9\uff0c\u6ee1\u8db3\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u4e4b\u548c\u4e58\u4ee5\u8be5\u70b9\u5230\u8fd9\u4e24\u70b9\u7684\u8ddd\u79bb\u7684\u8f83\u5c0f\u503c\u4e4b\u548c\u6700\u5c0f\u3002\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6811\u4e0a\u7684\u4e24\u4e2a\u70b9\uff0c\u5230\u4e00\u4e2a\u70b9\u4e3a\u6700\u5c0f\u8ddd\u79bb\u7684\u96c6\u5408\u548c\u5230\u53e6\u5916\u4e00\u4e2a\u70b9\u4e3a\u6700\u5c0f\u8ddd\u79bb\u7684\u70b9\u7684\u96c6\u5408\u4e4b\u95f4\u662f\u6ca1\u6709\u4ea4\u96c6\u7684\u3002\u6545\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u8fb9\uff0c\u5bf9\u4e24\u9897\u5b50\u6811\u5206\u522b\u6c42\u5e26\u6743\u503c\u7684\u6811\u7684\u91cd\u5fc3\uff0c\u5219\u6c42\u5f97\u7684\u6b63\u597d\u662f\u8868\u8fbe\u5f0f\u7684\u503c\u3002\u4f46\u662f\u8fd9\u4efb\u7136\u662f$O(n^2)$\u7684\uff0c\u89c2\u5bdf\u65b9\u7a0b:$f_v=f_u+size_u-size_v$\uff0c\u82e5$v$\u6bd4$u$\u66f4\u4f18\uff0c\u5f53\u4e14\u4ec5\u5f53$2size_v>size_1$\uff0c\u4e14\u6ee1\u8db3$2size_v>size_1$\u7684$v$\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\uff0c\u6545\u53ef\u4ee5\u5904\u7406\u51fa\u6700\u5927\u513f\u5b50\u548c\u6b21\u5927\u513f\u5b50\uff0c\u5f53\u8fde\u63a5\u6700\u5927\u513f\u5b50\u7684\u8fb9\u65ad\u88c2\u65f6\uff0c\u4f7f\u7528\u6b21\u5927\u513f\u5b50\u8ba1\u7b97\uff0c\u6b64\u65f6\u65f6\u95f4\u590d\u6742\u5ea6\u5373\u4e3a$O(nh)$\u7684\u3002\n\n# \u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\n#include<algorithm>\n#define int long long\nusing namespace std;\nconst int maxn=1e6+10;\nint n,k,cut,ans=0x7f7f7f7f7f7f7f7fll;\nstruct node{\n\tint to,next;\n}edge[maxn];\nint head[maxn],fa[maxn];\nint w[maxn],son1[maxn],son2[maxn],size[maxn],a[maxn],deep[maxn];\nvoid add(int u,int v)\n{\n\tedge[++k].to=v;\n\tedge[k].next=head[u];\n\thead[u]=k;\n}\nvoid dfs(int u,int f)\n{\n\tfa[u]=f;\n\tsize[u]=w[u];\n\ta[u]=w[u]*deep[u];\n\tfor(int i=head[u];i;i=edge[i].next)\n\t{\n\t\tint v=edge[i].to;\n\t\tif(v!=f)\n\t\t{\n\t\t\tdeep[v]=deep[u]+1;\n\t\t\tdfs(v,u);\n\t\t\tsize[u]+=size[v];\n\t\t\ta[u]+=a[v];\n\t\t\tif(size[son1[u]]<=size[v]){\n\t\t\t\tson2[u]=son1[u];\n\t\t\t\tson1[u]=v;\n\t\t\t}else if(size[son2[u]]<=size[v]){\n\t\t\t\tson2[u]=v;\n\t\t\t}\n\t\t}\n\t}\n}\nvoid get_ans(int u,int sz,int num,int &cnt)\n{\n\tcnt=min(cnt,num);\n\tint v=son1[u];\n\tif(size[son1[u]]<size[son2[u]]||v==cut)v=son2[u];\n\tif(v&&size[v]*2>size[u])get_ans(v,sz,num+sz-2*size[v],cnt);\n}\nvoid solve(int u)\n{\n\tfor(int j=head[u];j;j=edge[j].next)\n\t{\n\t\tint v=edge[j].to;\n\t\tif(v!=fa[u])\n\t\t{\n\t\t\tint _a=0x7f7f7f7f7f7f7f7fll,b=0x7f7f7f7f7f7f7f7fll;\n\t\t\tcut=v;\n\t\t\tfor(int i=u;i;i=fa[i])\n\t\t\tsize[i]-=size[v];\n\t\t\tget_ans(1,size[1],a[1]-a[v],_a);\n\t\t\tget_ans(v,size[v],a[v]-size[v]*deep[v],b);\n\t\t\tans=min(ans,_a+b);\n\t\t\tfor(int i=u;i;i=fa[i])\n\t\t\tsize[i]+=size[v];\n\t\t\tsolve(v);\n\t\t}\n\t}\n}\nmain(){\n\t//freopen(\"center.in\",\"r\",stdin);\n\t//freopen(\"center.out\",\"w\",stdout);\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%lld%lld\",&u,&v);\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lld\",&w[i]);\n\tdfs(1,0);\n\tsolve(1);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1601125365,
        "uid": 231120,
        "name": "YinyuDream",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P2726 \u3010[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3\u3011"
    },
    {
        "content": "\u7ea6\u5b9a\uff1a\u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0\uff0c\u5b9a\u4e49 $f(x,S)=\\sum_{v\\in S} w(v)\\times dis(v,x)$\uff0c$dep_x$ \u4e3a $x$ \u70b9\u7684\u6df1\u5ea6\uff0c$dis(x,y)$ \u4e3a $x,y$ \u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c$size_v$ \u4e3a\u4ee5 $v$ \u4e3a\u6839\u7684\u5b50\u6811\u70b9\u6743\u4e4b\u548c\u3002\n\n\u62ff\u5230\u8fd9\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u7ecf\u5178\u6a21\u578b\uff1a\n$$\n\\min\\{\\ \\sum_{x \\in S} f_x+\\sum_{x\\notin S} g_x \\}\n$$\n\u5373\u5c06\u4e00\u4e2a\u96c6\u5408\u5212\u5206\u6210\u4e24\u4e2a\uff0c\u5bf9\u4e24\u4e2a\u96c6\u5408\u5206\u522b\u6c42\u548c\uff0c\u5176\u603b\u548c\u6700\u5c0f\u3002\n\n\u8fd9\u9898\u6211\u4eec\u4e5f\u53ef\u4ee5\u501f\u7528\u8fd9\u6837\u7684\u601d\u60f3\uff0c\u5c06\u4e00\u90e8\u5206\u70b9\u5212\u5165\u4e00\u4e2a\u96c6\u5408\uff0c\u5269\u4e0b\u7684\u5212\u5165\u53e6\u4e00\u4e2a\u96c6\u5408\u3002\u5177\u4f53\u600e\u4e48\u5212\u5206\u5462\uff1f\u53ef\u4ee5\u60f3\u5230\u679a\u4e3e\u5272\u53bb\u6811\u4e0a\u4e00\u6761\u8fb9 $(u,v)$\uff0c\u539f\u6811\u5c31\u4f1a\u53d8\u4e3a\u4e24\u68f5\u5b50\u6811 $T_u,T_v$\uff0c\u5bf9\u8fd9\u4e24\u68f5\u5b50\u6811\u5206\u522b\u6c42\u91cd\u5fc3\uff0c\u8bb0 $T_u,T_v$ \u7684\u91cd\u5fc3\u5206\u522b\u4e3a $x_u,x_v$\u3002\u7b54\u6848\u5373\u4e3a $ans=\\min\\limits_{(u,v)\\in E} f(x_u,T_u)+f(x_v,T_v)$\u3002\n\n\u4e3a\u4ec0\u4e48\u5bf9\u4e24\u68f5\u5b50\u6811\u6c42\u91cd\u5fc3\u5c31\u53ef\u4ee5\u4e86\u5462\uff1f\u8fd9\u91cc\u9700\u8981\u7528\u5230\u4e00\u4e2a\u6027\u8d28\uff1a\u4e00\u68f5\u6811\u4e0a\u6240\u6709\u8282\u70b9\u5230\u5b83\u7684\u91cd\u5fc3\u7684\u8ddd\u79bb\u548c\u6700\u5c0f\u3002\u5f62\u5f0f\u5316\u7684\u63cf\u8ff0\uff1a$x$ \u4e3a\u6811 $T$ \u7684\u91cd\u5fc3\uff0c\u5f53\u4e14\u4ec5\u5f53 $f(x,T)=\\min\\limits_{y\\in T} f(y,T)$\u3002\n\n\u4f46\u662f\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\uff0c\u89c2\u5bdf\u4e00\u4e0b\u6570\u636e\u8303\u56f4\u53d1\u73b0 $maxhigh\\leq 100$\uff0c\u662f\u4e0d\u662f\u5b58\u5728\u4e00\u4e2a\u57fa\u4e8e\u9ad8\u5ea6\u7684\u505a\u6cd5\u5462\uff1f\n\n\u8bbe $f_x$ \u4e3a $f(x,SubTree)$ \u7684\u503c\uff0c$SubTree$ \u4e3a $x$ \u5f53\u524d\u6240\u5728\u7684\u5b50\u6811\u3002$g_x$ \u4e3a $f(x,T)$ \u7684\u503c\uff0c$T$ \u4e3a\u6574\u68f5\u6811\u3002\u90a3\u4e48\u663e\u7136\u6709 $f_1=g_1-g_v-(dep_v-dep_1)\\times size_v,f_v=g_v$\uff0c\u5e76\u4e14\u5bf9\u4e8e $T_u$\uff0c\u6709 $f_y=f_x+size_1-2\\times size_y$\uff0c\u5bf9\u4e8e $T_v$\uff0c\u6709 $f_y=f_x+size_v-2\\times size_y$\uff0c\u5176\u4e2d $y$ \u662f $x$ \u7684\u513f\u5b50\u3002\n\u5728\u8ba1\u7b97 $T_u$ \u5185\u7684 $f$ \u65f6\uff0c\u5bf9\u4e8e\u6240\u6709 $x$ \u662f $v$ \u7684\u7956\u5148\u7684 $size_x$ \u5168\u90e8\u9700\u51cf\u53bb $size_v$\u3002\n\n\u4ed4\u7ec6\u89c2\u5bdf\u4e0a\u5f0f\u3002\u5bf9\u4e8e $T_u$\uff0c\u53d1\u73b0\u4ec5\u5f53 $size_1-2\\times size_y<0$ \u65f6\uff0c\u7b54\u6848\u624d\u53ef\u80fd\u66f4\u5c0f\u3002\u5bf9\u4e8e $T_v$\uff0c\u53d1\u73b0\u4ec5\u5f53 $size_v-2\\times size_y<0$ \u65f6\uff0c\u7b54\u6848\u624d\u53ef\u80fd\u66f4\u5c0f\u3002\u5e76\u4e14\u6240\u6709\u70b9\u6743\u4e3a\u6b63\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5b50\u6811 $y$ \u7684\u70b9\u6743\u5927\u4e8e\u5b50\u6811 $x$ \u7684\u70b9\u6743\u7684\u60c5\u51b5\uff08$y$ \u662f $x$ \u7684\u7236\u4eb2\uff09\u3002\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $x$\uff0c\u8bb0\u5f55\u4e0b $size_y$ \u6700\u5927\u7684\u70b9\u4e0e $size_y$ \u6b21\u5927\u7684 $y$\u3002\u56e0\u4e3a\u4fee\u6539 $size_x$ \u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6700\u5927\u70b9\u53d8\u4e3a\u6b21\u5927\u70b9\u3002\u6bcf\u6b21\u5411\u4e0b\u66f4\u65b0 $f$ \u7684\u65f6\u5019\u53ea\u66f4\u65b0\u6700\u5927\u70b9\u5373\u53ef\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\times h)$\uff0c\u7531\u4e8e $\\max \\{h\\}\\leq 100$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n**Show the Code**\n```cpp\n#include<cstdio>\n#define int ll\ntypedef long long ll;\nint cnt=0,u,v;\nint h[50005],to[100005],ver[100005];\nint size[50005],dep[50005],w[50005],g[50005],son[50005],sonSecond[50005],f[50005],skip[50005];\nstruct edge {int x,y;} e[50005];\ninline int read() {\n\tregister int x=0,f=1;register char s=getchar();\n\twhile(s>'9'||s<'0') {if(s=='-') f=-1;s=getchar();}\n\twhile(s>='0'&&s<='9') {x=x*10+s-'0';s=getchar();}\n\treturn x*f;\n}\ninline int min(const int &x,const int &y) {return x<y? x:y;}\ninline void swap(int &x,int &y) {int tmp=y;y=x;x=tmp;}\ninline void add(int x,int y) {to[++cnt]=y;ver[cnt]=h[x];h[x]=cnt;}\ninline void prework(int x,int fa) {\n\tsize[x]=w[x];sonSecond[x]=son[x]=0;\n\tfor(register int i=h[x];i;i=ver[i]) {\n\t\tint y=to[i]; if(y==fa) continue;\n\t\tdep[y]=dep[x]+1; skip[y]=x; prework(y,x);  \n\t\tg[x]+=g[y]+size[y]; size[x]+=size[y];\n\t\tif(size[son[x]]<=size[y]) {sonSecond[x]=son[x];son[x]=y;}\n\t\telse if(size[sonSecond[x]]<size[y]) {sonSecond[x]=y;}\n\t}\n}\ninline void modify(int x,int val) {\n\tsize[x]+=val; int fa=skip[x];\n\tif(fa) {\n\t\tif(sonSecond[fa]&&son[fa]==x&&size[x]<size[sonSecond[fa]]) swap(sonSecond[fa],son[fa]);  \n\t\telse if(sonSecond[fa]==x&&size[x]>size[son[fa]]) swap(son[fa],sonSecond[fa]);\n\t\tmodify(fa,val);\n\t}\n}\ninline void AskTree1(int x,int &res) {\n\tres=min(res,f[x]);\n\tif(son[x]&&son[x]!=v&&size[1]<2*size[son[x]]) {f[son[x]]=f[x]+size[1]-2*size[son[x]];AskTree1(son[x],res);}\n}\ninline void AskTree2(int x,int &res) {\n\tres=min(res,f[x]);\n\tif(son[x]&&size[v]<2*size[son[x]]) {f[son[x]]=f[x]+size[v]-2*size[son[x]];AskTree2(son[x],res);}\n}\nsigned main() {\n\tint n=read(),ans=1e10;\n\tfor(register int i=1;i<n;++i) {e[i].x=read();e[i].y=read();add(e[i].x,e[i].y);add(e[i].y,e[i].x);}\n\tfor(register int i=1;i<=n;++i) w[i]=read();\n\tdep[1]=1;prework(1,-1);\n\tfor(register int i=1;i<n;++i) {\n\t\tu=e[i].x;v=e[i].y;\n\t\tif(dep[u]>dep[v]) swap(u,v);//dep[u]<=dep[v]\n\t\tf[1]=g[1]-g[v]-size[v]*(dep[v]-1); f[v]=g[v];\n\t\tint res1=1e10,res2=1e10; \n\t\tmodify(u,-size[v]);\n\t\tAskTree1(1,res1); AskTree2(v,res2);\n\t\tmodify(u,size[v]);\n\t\tans=min(ans,res1+res2);\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n\n\n\n\n",
        "postTime": 1600932529,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2726 \u3010[SHOI2005]\u6811\u7684\u53cc\u4e2d\u5fc3\u3011"
    }
]