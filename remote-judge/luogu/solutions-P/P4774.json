[
    {
        "content": "## \u80cc\u666f\n\n>\u611f\u89c9\u8fd9\u9898\u8fd8\u662f\u6bd4\u8f83\u6e05\u6670\u7684\u3002\n\n## \u601d\u8def\n\n### Part I\n\n\u5f88\u660e\u663e\u6bcf\u6761\u9f99\u5bf9\u5e94\u7684\u5251\u662f\u786e\u5b9a\u7684\uff0c\u7528\u5e73\u8861\u6811\u5904\u7406\u51fa\u7b2c $i$ \u6761\u9f99\u5bf9\u5e94\u7684\u5251\u7684\u653b\u51fb\u529b\u662f $b_i$\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5c55\u793a\uff0c\u6211\u5c31\u5077\u61d2\u7528 `multiset<long long>` \u5b9e\u73b0\u4e86\u3002\n\n\u90a3\u4e48\u73b0\u5728\u9898\u610f\u5c31\u8f6c\u5316\u4e3a\uff0c\u5bf9\u540c\u4f59\u65b9\u7a0b\u7ec4\n\n$$\\begin{cases}b_1x\\equiv a_1\\pmod {p_1}\\\\b_2x\\equiv a_2\\pmod {p_2}\\\\\\qquad\\cdots\\\\b_nx\\equiv a_n\\pmod {p_n}\\end{cases}$$\n\n\u6c42\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8981\u4fdd\u8bc1\u53ef\u4ee5\u628a\u9f99\u8840\u780d\u6210\u8d1f\u7684\uff0c\u5373 $x$ \u4e0d\u80fd\u5c0f\u4e8e**\u5c06\u6bcf\u6761\u9f99\u780d\u6210\u8d1f\u8840\u7684\u6700\u5c0f\u5200\u6570**\u3002\n\n### Part II\n\n\u5728\u6b64\u4e4b\u524d\uff0c\u4e0d\u59a8\u5148\u60f3\u60f3\u666e\u901a\u7684\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u662f\u600e\u4e48\u505a\u7684\uff0c\u5373\u6240\u6709 $b_i=1$ \u7684\u60c5\u51b5\u3002\n\n1. \u5047\u8bbe\u5df2\u7ecf\u5f97\u5230\u4e86\u524d $i-1$ \u7ec4\u540c\u4f59\u65b9\u7a0b\u7684\u89e3\uff0c\u8bb0\u4e3a $ans$\uff1b\n2. \u8bbe $M=\\operatorname{lcm}(p_1,p_2,\\ldots,p_{i-1})$\uff0c\u5219\u5bf9\u4e8e\u4efb\u610f\u7684\u6574\u6570 $x$\uff0c$ans+Mx$ \u662f\u524d $i-1$ \u7ec4\u540c\u4f59\u65b9\u7a0b\u7684\u901a\u89e3\uff1b\n3. \u6211\u4eec\u60f3\u5f97\u5230\u524d $i$ \u7ec4\u540c\u4f59\u65b9\u7a0b\u7684\u89e3\uff0c\u5c31\u662f\u60f3\u627e\u5230\u4e00\u4e2a $x$\uff0c\u6ee1\u8db3 $ans+Mx\\equiv a_i\\pmod {p_i}$\uff1b\n4. \u79fb\u9879\u5f97 $Mx\\equiv a_i-ans\\pmod{p_i}$\uff1b\n5. \u8fd9\u7c7b\u5f0f\u5b50\u4e00\u770b\u5c31\u662f\u8001\u6269\u6b27\u4e86\uff0c\u8f6c\u5316\u6210 $Ax+By=C$ \u7684\u5f62\u5f0f\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u89e3\uff0c\u5373\uff1a\n\n$$(M)x+(p_i)y=(a_i-ans)$$\n\n### Part III\n\n\u90a3\u4e48\u6709\u7cfb\u6570 $b_i$ \u600e\u4e48\u641e\u5462\uff1f\u9006\u5143\u662f\u4e0d\u53ef\u80fd\u9006\u5143\u7684\uff0c\u53c8\u4e0d\u4e92\u8d28\uff0c\u5728\u6a21 $p_i$ \u610f\u4e49\u4e0b $b_i$ \u672a\u5fc5\u6709\u9006\u5143\u3002\n\n\u5bb3\uff0c\u5176\u5b9e\u8fd8\u662f\u6362\u6c64\u4e0d\u6362\u836f\u5457\u3002\n\n1. \u5047\u8bbe\u5df2\u7ecf\u5f97\u5230\u4e86\u524d $i-1$ \u7ec4\u540c\u4f59\u65b9\u7a0b\u7684\u89e3\uff0c\u8bb0\u4e3a $ans$\uff1b\n2. \u8bbe $M=\\operatorname{lcm}(p_1,p_2,\\ldots,p_{i-1})$\uff0c\u5219\u5bf9\u4e8e\u4efb\u610f\u7684\u6574\u6570 $x$\uff0c$ans+Mx$ \u662f\u524d $i-1$ \u7ec4\u540c\u4f59\u65b9\u7a0b\u7684\u901a\u89e3\uff1b\n3. \u60f3\u5f97\u5230\u524d $i$ \u7ec4\u540c\u4f59\u65b9\u7a0b\u7684\u89e3\uff0c\u5c31\u662f\u60f3\u627e\u5230\u4e00\u4e2a $x$\uff0c\u6ee1\u8db3 $b_i(ans+Mx)\\equiv a_i\\pmod {p_i}$\uff1b\n4. \u79fb\u9879\u5f97 $b_iMx\\equiv a_i-b_ians\\pmod{p_i}$\uff1b\n5. \u8fd9\u7c7b\u5f0f\u5b50\u4e00\u770b\u5c31\u662f\u8001\u6269\u6b27\u4e86\uff0c\u8f6c\u5316\u6210 $Ax+By=C$ \u7684\u5f62\u5f0f\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u89e3\uff0c\u5373\uff1a\n\n$$(b_iM)x+(p_i)y=(a_i-b_ians)$$\n\n### Part IV\n\n\u51e0\u70b9\u6ce8\u610f\u4e8b\u9879\uff1a\n\n1. \u5224\u65e0\u89e3\u5c31\u8ddf\u5e73\u5e38\u6269\u6b27\u7684\u5224\u89e3\u4e00\u6837\uff0c\u82e5 $C$ \u4e0d\u662f $\\gcd(A,B)$ \u7684\u500d\u6570\uff0c\u5219\u65e0\u89e3\uff0c\u5373\u82e5 $a_i-b_ians$ \u4e0d\u662f $\\gcd(b_iM,p_i)$ \u7684\u500d\u6570\uff0c\u5219\u65e0\u89e3\uff1b\n2. \u770b\u4e0b\u6570\u636e\u8303\u56f4\uff0c\u660e\u663e\u6709\u4e24\u5904\u9700\u8981\u9f9f\u901f\u4e58\u7684\uff0c\u9274\u4e8e\u5927\u5bb6\u90fd\u4f1a\uff0c\u6211\u5c31\u5077\u61d2\u7528 `__int128` \u5b9e\u73b0\u4e86\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <set>\n#include <cstdio>\n#include <iostream>\nusing namespace std;\nconst int maxn = 100005;\nint T, n, m, b[maxn], t[maxn];\nlong long a[maxn], p[maxn], mx;\nmultiset<long long> s;\nvoid exgcd(long long A, long long B, long long &x, long long &y, long long &gcd) {\n\tif(!B) x = 1, y = 0, gcd = A;\n\telse exgcd(B, A%B, y, x, gcd), y -= (A/B) * x;\n}\nlong long ExCRT() {\n\tlong long ans = 0, lcm = 1, x, y, gcd, A, B, C;\n\tfor(int i = 1; i <= n; ++i) {\n\t\tA = (__int128)b[i] * lcm % p[i];\n\t\tB = p[i];\n\t\tC = (a[i]-b[i]*ans%p[i]+p[i]) % p[i];\n\t\texgcd(A, B, x, y, gcd), x = (x%B+B) % B;\n\t\tif(C % gcd) return -1;\n\t\tans += (__int128)(C/gcd) * x % (B/gcd) * lcm % (lcm*=B/gcd);\n\t\tans %= lcm;\n\t}\n\tif(ans < mx) ans += ((mx-ans-1)/lcm+1) * lcm;\n\treturn ans;\n}\nint main() {\n\tscanf(\"%d\", &T);\n\twhile(T--) {\n\t\ts.clear(), mx = 0;\n\t\tscanf(\"%d %d\", &n, &m);\n\t\tfor(int i = 1; i <= n; ++i) scanf(\"%lld\", &a[i]);\n\t\tfor(int i = 1; i <= n; ++i) scanf(\"%lld\", &p[i]);\n\t\tfor(int i = 1; i <= n; ++i) scanf(\"%d\", &t[i]);\n\t\tfor(int i = 1, x; i <= m; ++i) scanf(\"%d\", &x), s.insert(x);\n\t\tfor(int i = 1; i <= n; ++i) {\n\t\t\tauto u = s.upper_bound(a[i]);\n\t\t\tif(u != s.begin()) u--;\n\t\t\tb[i] = *u, s.erase(u), s.insert(t[i]);\n\t\t\tmx = max(mx, (a[i]-1)/b[i]+1);\n\t\t}\n\t\tprintf(\"%lld\\n\", ExCRT());\n\t}\n}\n```\n\n## P.S.\n\n\u5176\u5b9e emptyset \u4e0d\u61d2\uff0c\u53ea\u662f\u8fd9\u6837\u6bd4\u8f83\u65b9\u4fbf\u5728\u9898\u89e3\u533a\u5c55\u793a\u5566\u3002\n\nemptyset \u81ea\u5df1 yy \u7684\u505a\u6cd5\uff0c\u6709 hack \u6570\u636e\u53ef\u4ee5\u53eb\u5979\uff08\u6709\u70b9\u62c5\u5fc3\u6ea2\u51fa\u7684\u95ee\u9898\uff09\u3002\n\n\u89c9\u5f97\u8fd8\u4e0d\u9519\u7684\u8bdd\u70b9\u4e2a\u8d5e\u5427\u3002",
        "postTime": 1559992788,
        "uid": 135658,
        "name": "emptysetvvvv",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u573a\u5916\u9009\u624b\u4f11\u95f2\u505a\u9898\u2026\u2026\n\n\u62d3\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u677f\u5b50\u9898\n_______________\n\n## \u672c\u9898\u9898\u89e3\n\n### \u4e00\u4e9b\u6027\u8d28\n\n\u9996\u5148\u6211\u4eec\u4f1a\u53d1\u73b0\u5bb0\u7b2ci\u6761\u9f99\u65f6\u73a9\u5bb6\u7684\u653b\u51fb\u529b\u662f\u4e00\u5b9a\u7684\uff0c\u56e0\u4e3a\u6bcf\u6b21\u4f7f\u7528\u7684\u5251\u662f\u786e\u5b9a\u7684\uff0c\u6bcf\u6b21\u5f97\u5230\u7684\u5251\u4e5f\u662f\u4e00\u5b9a\u7684\u3002\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528$std::multiset$\u624b\u52a8\u6a21\u62df\u5bb0\u9f99\u7684\u8fc7\u7a0b\u6bcf\u6b21upper_bound\u51fa\u5f53\u524d\u8f6e\u6b21\u7684\u653b\u51fb\u529b\n\n\u63a5\u4e0b\u6765\u662f\u6c42\u89e3\u6700\u5c0f\u7684\u653b\u51fb\u6b21\u6570\u7684\u8fc7\u7a0b\n\n\u6211\u4eec\u53d1\u73b0\u9f99\u5728\u8840\u91cf\u6210\u4e3a\u8d1f\u6570\u4e4b\u540e\u4f1a\u81ea\u52a8\u5b9a\u91cf\u56de\u8840\u8fd9\u4e2a\u8bbe\u5b9a\u5341\u5206\u50cf\u5bf9\u8d1f\u6570\u53d6\u6a21\n\n\u90a3\u4e48\u6211\u4eec\u662f\u5426\u53ef\u4ee5\u786e\u5b9a\uff0c\u4e00\u6761\u9f99\u88ab\u6740\u6b7b\u5f53\u4e14\u4ec5\u5f53\u5b83\u7684\u53d7\u5230\u7684\u4f24\u5bb3\u503c\u6a21p\u4e3a\u81ea\u5df1\u7684\u8840\u91cf\u5462\uff1f\n\n\u6216\u8005\u8bf4\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u5217\u51fa\u4e00\u4e2a\u50cf\u8fd9\u6837\u7684\u542bn\u4e2a\u540c\u4f59\u65b9\u7a0b\u7684\u540c\u4f59\u65b9\u7a0b\u7ec4\uff0c\u6c42\u51fa\u8fd9\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3x,\u7136\u540e\u8bf4\u8fd9\u5c31\u662f\u6700\u5c0f\u7684\u653b\u51fb\u6b21\u6570\u5462\uff1f\n\n## $C_{i}x \\equiv A_{i}(mod P_{i})$\n\n\u5176\u4e2d$C_{i}$\u662f\u6740\u7b2ci\u6761\u9f99\u65f6\u7684\u653b\u51fb\u529b\uff0c$A_{i}$\u662f\u7b2ci\u6761\u9f99\u521d\u59cb\u7684\u8840\u91cf\uff0c$P_{i}$\u662f\u7b2ci\u6761\u9f99\u7684\u6062\u590d\u80fd\u529b\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5e76\u4e0d\u662f\uff0c\u56e0\u4e3a\u9898\u76ee\u5f53\u4e2d\u5e76\u6ca1\u4fdd\u8bc1$A_{i} \\leq P_{i}$\n\n\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u7684\u540c\u4f59\u9650\u5236\u6761\u4ef6\u53ea\u80fd\u4fdd\u8bc1\u653b\u51fbx\u6b21\u4e4b\u540e\u6240\u6709\u9f99\u7684\u8840\u91cf\u6a21\u81ea\u8eab\u7684\u6062\u590d\u529b\u90fd\u662f0\n\n\u4f46\u662f\u5982\u679c$A_{i} > P_{i}$\u7684\u8bdd\u6211\u4eec\u4f1a\u53d1\u73b0\u6211\u4eec\u653b\u51fb\u4e4b\u540e\u53ef\u80fd\u9f99\u7684\u8840\u91cf\u4ece\u6765\u6ca1\u6709\u5230\u8fc7\u8d1f\u503c\uff0c\u4f46\u662f\u8840\u91cf\u5374\u7684\u786e\u6a21p\u4e3a0\u4e86\n\n~~\u60c5\u51b5\u5f00\u59cb\u53d8\u5f97\u8fa3\u624b~~\n\n\u6b64\u65f6\u662f\u8003\u9a8c\u5927\u5bb6\u9605\u8bfb\u7406\u89e3\u80fd\u529b\u7684\u65f6\u523b\u4e86\uff01\n\n\u4ed4\u7ec6\u9605\u8bfb\u51fa\u9898\u4eba\u7ed9\u51fa\u7684\u6570\u636e\u8868\u683c\uff0c\u5982\u679c\u8fd9\u4e2a\u6d4b\u8bd5\u70b9\u4e0d\u4fdd\u8bc1$A_{i} \\leq P_{i}$\u7684\u8bdd\uff0c\u5b83\u4e00\u5b9a\u4f1a\u6ee1\u8db3\u4e00\u4e2a\u6761\u4ef6\u5c31\u662f$P_{i}=1$\n\n\u8fd9\u610f\u5473\u8fd9\u6211\u4eec\u53ef\u4ee5\u5927\u529b\u7279\u5224\u6389\u8fd9\u79cd\u60c5\u51b5\uff0c\u663e\u7136\uff0c\u5728$P_{i}=1$\u7684\u60c5\u51b5\u4e0b\uff0c\u7b54\u6848\u662f\n\n## $Max_{i=1}^{n}( \\lceil \\frac{A_{i}}{C_{i}} \\rceil )$\n\n\u5c31\u662f\u6240\u6709\u9f99\u8840\u91cf\u4e3a\u8d1f\u7684\u6700\u5c0f\u5200\u6570\u53d6\u4e00\u4e2amax\u5c31\u53ef\u4ee5\u4e86\n\n\u4e0b\u9762\u8ba9\u6211\u4eec\u96c6\u4e2d\u7cbe\u529b\u89e3\u51b3$A_{i} \\leq P_{i}$\u7684\u60c5\u51b5\n___________________\n\n## \u5316\u7b80\u540c\u4f59\u65b9\u7a0b\n\n\u5728$A_{i} \\leq P_{i}$\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5927\u90e8\u5206\u60c5\u51b5(\u9664\u4e86\u51e0\u4e2a\u81ed\u540d\u662d\u8457\u7684\u7279\u4f8b)\uff0c\u6211\u4eec\u7684\u540c\u4f59\u65b9\u7a0b\u90fd\u662f\u751f\u6548\u7684\n\n\u6362\u53e5\u8bdd\u6211\u4eec\u73b0\u5728\u552f\u4e00\u8981\u505a\u7684\u5c31\u662f\u89e3\u4e0b\u9762\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3\n\n## $C_{i}x \\equiv A_{i}(mod P_{i})$\n\n\u4f60\u4f1a\u53d1\u73b0\u8fd9\u548c\u6807\u51c6\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u7684\u65b9\u7a0b\u4e0d\u662f\u975e\u5e38\u4e00\u6837\uff0c\u5373\u4f7f\u662f\u53ef\u4ee5\u5904\u7406\u6a21\u6570\u4e0d\u4e24\u4e24\u4e92\u8d28\u7684\u62d3\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff0c\u4e5f\u53ea\u80fd\u5904\u7406\u8fd9\u6837\u7684\u540c\u4f59\u65b9\u7a0b\n\n## $x \\equiv A_{i}(mod P_{i})$\n\n\u6362\u53e5\u8bdd\u8bf4x\u7684\u7cfb\u6570\u5fc5\u987b\u662f1\n\n\u800c\u4e14\u66f4\u52a0\u8fa3\u624b\u7684\u662f$C_{i}$\u5728\u6a21$P_{i}$\u610f\u4e49\u4e0b\u6781\u6709\u53ef\u80fd\u4e0d\u5b58\u5728\u9006\u5143\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u4e0d\u80fd\u628a$C_{i}$\u9664\u6389\n\n\u90a3\u4e48\u6709\u4ec0\u4e48\u529e\u6cd5\u53ef\u4ee5\u5316\u7b80\u8fd9\u4e2a\u4e1c\u897f\u5417\uff1f\n\n(\u4f5c\u4e3a\u4e00\u540d\u6562\u5199noi2018\u7684\u9009\u624b\uff0c\u7406\u8bba\u4e0a\u5e94\u8be5\u662f\u4f1aexgcd\u89e3\u4e00\u822c\u7684\u4e0d\u5b9a\u65b9\u7a0b\u7684\uff0c\u4f46\u662f\u4e3a\u4e86\u907f\u514d\u4f60\u7684\u5f0f\u5b50\u6709\u4e9b\u90e8\u5206\u63a8\u9519\uff0c\u8fd9\u91cc\u8fd8\u662f\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u89e3\u4e00\u822c\u7684\u4e0d\u5b9a\u65b9\u7a0b)\n\n\u719f\u7ec3\u7684\u8bdd\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u90e8\u5206\n________________________\n\n### \u524d\u7f6e\u77e5\u8bc6:\u4f7f\u7528exgcd\u7b97\u6cd5\u6c42\u89e3\u4e00\u822c\u7684\u4e0d\u5b9a\u65b9\u7a0b\n\n\u6362\u53e5\u8bdd\u8bf4\u8fd9\u91cc\u89e3\u51b3\u7684\u95ee\u9898\u662f\u5982\u4f55\u6c42\u65b9\u7a0b$Ax+By=C (A,B,C >0)$\u7684\u901a\u89e3\n\n\u4f46\u662f\u4f17\u6240\u5468\u77e5\uff0cexgcd\u7b97\u6cd5\u53ea\u80fd\u8ba1\u7b97\u51fa\u65b9\u7a0b$Ax+By=(A,B)$\u7684\u4e00\u7ec4\u7279\u6b8a\u89e3\n\n\u4f46\u662f\u8fd9\u91cc\u6709\u4e00\u4e2a\u7ed3\u8bba\u662f\u8fd9\u4e2a\u65b9\u7a0b\u6709\u89e3\u5f53\u4e14\u4ec5\u5f53 $C|(a,b)$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7a0d\u7a0d\u6362\u4e2a\u5143\n\n\u4ee4 $\\frac{C}{(a,b)}x^{'}=x$,$\\frac{C}{(a,b)}y^{'}=y$\u7684\u8bdd\u6211\u4eec\u4f1a\u53d1\u73b0\u6211\u4eec\u7684\u65b9\u7a0b\u53d8\u6210\u4e86\u8fd9\u6837\n\n## $A\\frac{C}{(a,b)}x^{'} +B \\frac{C}{(a,b)}y^{'}=(a,b)\\frac{C}{(a,b)}$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u9664\u6389\u4e86$\\frac{C}{(a,b)}$\n\n\u4e8e\u662f\u65b9\u7a0b\u5c31\u53d8\u6210\u4e86\u53ef\u7231\u7684$Ax^{'}+By^{'}=(A,B)$\n\n\u4f7f\u7528exgcd\u7b97\u6cd5\u6c42\u51fa\u4ed6\u7684\u4e00\u4e2a\u7279\u89e3$sx^{'}$\u90a3\u4e48\u539f\u65b9\u7a0b\u7684\u7279\u89e3\u5c31\u662f$\\frac{C}{(a,b)}x^{'}$\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u539f\u65b9\u7a0b\u7684\u4e24\u4e2a\u7279\u89e3\uff0c\u53ef\u4ee5\u501f\u6b64\u6784\u9020\u539f\u65b9\u7a0b\u51fa\u6240\u6709\u7684\u901a\u89e3\n\n___________________________\n\n\u8a00\u5f52\u6b63\u4f20\u6211\u4eec\u73b0\u5728\u5316\u7b80\u540c\u4f59\u65b9\u7a0b\u4e86,\u60f3\u529e\u6cd5\u628a\u65b9\u7a0b\n\n## $C_{i}x \\equiv A_{i}(mod P_{i})$\n\n\u53d8\u6210\n\n## $x \\equiv A_{i}(mod P_{i})$\n\n\u7b2c\u4e00\u4e2a\u65b9\u7a0b\u53ef\u4ee5\u5199\u6210\u8fd9\u6837\u7684\u4e0d\u5b9a\u65b9\u7a0b\u7684\u5f62\u5f0f\n\n## $C_{i}x+P_{i}y = A_{i}$\n\n\u4f7f\u7528exgcd\u6c42\u51fa\u4ed6\u7684\u4e00\u7ec4\u7279\u89e3 $Sx,Sy$\n\n\u6839\u636e\u901a\u89e3\u516c\u5f0f\u53ef\u4ee5\u8f7b\u677e\u7684\u5f97\u5230\n\n## $x=sx+k\\frac{P_{i}}{(C_{i},P_{i})}$\n\n\u4e24\u8fb9\u540c\u65f6\u5bf9$\\frac{P_{i}}{(C_{i},P_{i})}$\u53d6\u6a21\n\n## $x \\equiv sx (mod \\frac{P_{i}}{(C_{i},P_{i})})$\n\n\u597d\u4e86\u6211\u4eec\u6109\u5feb\u7684\u5c06\u540c\u4f59\u65b9\u7a0b\u5316\u6210\u4e86\u6807\u51c6\u5f0f\uff0c\u73b0\u5728\u8be5\u8003\u8651\u600e\u4e48\u89e3\u540c\u4f59\u65b9\u7a0b\u7ec4\u4e86\n\n____________________________\n\n## Extended CRT:\u62d3\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\n\n\u6211\u4eec\u73b0\u5728\u8981\u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u6c42\u540c\u4f59\u65b9\u7a0b\u7ec4\n\n## $x \\equiv C{i}(mod P_{i})$\n\n\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3\uff0c\u4e0d\u4fdd\u8bc1\u4e24\u4e24\u4e92\u8d28\n\n\u90a3\u4e48\u6211\u4eec\u7684\u601d\u8def\u4e8b\u5b9e\u4e0a\u4e5f\u662f\u975e\u5e38\u66b4\u529b\u7684\uff0c\u5c06\u8fd9\u4e9b\u540c\u4f59\u65b9\u7a0b\u4e24\u4e24\u5408\u5e76\u6210\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\uff0c\u4f7f\u5f97\u6700\u540e\u53ea\u5269\u4e0b\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\n\n\u6240\u4ee5\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u5408\u5e76\u4e24\u4e2a\u540c\u4f59\u65b9\u7a0b\n\n## $x \\equiv C_{1}(mod P_{1})$\n\n## $x \\equiv C_{2}(mod P_{2})$\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u628a\u540c\u4f59\u65b9\u7a0b\u5199\u6210\u4e0d\u5b9a\u65b9\u7a0b\n\n## $x=C_{1}+ P_{1}y_{1}$\n\n## $x=C_{2}+ P_{2}y_{2}$\n\n\u7531\u4e8e\u4e8b\u5b9e\u4e0ax\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u65b9\u7a0b\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u4e24\u4e2a\u65b9\u7a0b\u8054\u7acb\n\n## $P_{1}y_{1}=P_{2}y_{2}+C_{2}-C_{1}$\n\n\u6839\u636e\u4e0d\u5b9a\u65b9\u7a0b\u7684\u4e00\u4e9b\u57fa\u672c\u77e5\u8bc6\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u6709\u89e3\u5f53\u4e14\u4ec5\u5f53$C_{2}-C_{1}|(P_{1},P_{2})$\n\n\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u4f7f\u7528\u53e4\u8001\u7684\u5957\u8def\u4e24\u8fb9\u540c\u65f6\u9664$(P_{1},P_{2})$\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5f0f\u5b50\u53d8\u6210\u4e86\u8fd9\u6837\n\n## $\\frac{P_{1}}{(P_{1},P_{2})}y_{1}=\\frac{P_{2}}{(P_{1},P_{2})}y_{2}+\\frac{C_{2}-C_{1}}{(P_{1},P_{2})}$\n\n\u6b64\u65f6\u91c7\u7528\u53e6\u4e00\u4e2a\u8001\u5957\u8def\uff0c\u4e24\u8fb9\u540c\u65f6\u5bf9$\\frac{P_{2}}{(P_{1},P_{2})}$\u53d6\u6a21\n\n\u53ef\u4ee5\u5f97\u5230\n\n## $\\frac{P_{1}}{(P_{1},P_{2})}y_{1}\\equiv \\frac{C_{2}-C_{1}}{(P_{1},P_{2})} (mod \\frac{P_{2}}{(P_{1},P_{2})})$\n\n\u597d\u7684\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u6b64\u65f6$\\frac{P_{1}}{(P_{1},P_{2})}$\u548c\u6a21\u6570\u4e00\u5b9a\u4e92\u8d28\u4e86\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u9664\u9006\u5143\u4e86\n\n\u6240\u4ee5\n\n## $y_{1}\\equiv inv(\\frac{P_{1}}{(P_{1},P_{2})},\\frac{P_{2}}{(P_{1},P_{2})})\\frac{C_{2}-C_{1}}{(P_{1},P_{2})} (mod \\frac{P_{2}}{(P_{1},P_{2})})$\n\n\u91cd\u65b0\u628a\u8fd9\u4e2a\u540c\u4f59\u65b9\u7a0b\u5199\u6210\u4e0d\u5b9a\u65b9\u7a0b\n\n## $y_{1}= inv(\\frac{P_{1}}{(P_{1},P_{2})},\\frac{P_{2}}{(P_{1},P_{2})})\\frac{C_{2}-C_{1}}{(P_{1},P_{2})} +k\\frac{P_{2}}{(P_{1},P_{2})}$\n\n\u7136\u540e\u4ee3\u5165\u5230x\u7684\u5f0f\u5b50\u91cc\n\n## $x=C_{1}+ P_{1}y_{1}$\n\n\u5f97\u5230\u7684\u5927\u6982\u662f\u8fd9\u6837\u7684\u5f0f\u5b50\n\n## $x=(inv(\\frac{P_{1}}{(P_{1},P_{2})},\\frac{P_{2}}{(P_{1},P_{2})})\\frac{C_{2}-C_{1}}{(P_{1},P_{2})})\\%\\frac{P_{2}} {(P_{1},P_{2})} \u00d7P_{1}+k\\frac{P_{1}P_{2}}{(P_{1},P_{2})}+C_{1}$\n\n\u4f9d\u65e7\u662f\u8001\u5957\u8def\uff0c\u4e24\u8fb9\u540c\u65f6\u5bf9$\\frac{P_{1}P_{2}}{(P_{1},P_{2})}$\u53d6\u6a21\u6d88\u6389\u70e6\u4eba\u7684k\n\n\n\u6211\u4eec\u5f97\u5230\u4e86\n\n## $x \\equiv (inv(\\frac{P_{1}}{(P_{1},P_{2})},\\frac{P_{2}}{(P_{1},P_{2})})\\frac{C_{2}-C_{1}}{(P_{1},P_{2})})\\%\\frac{P_{2}} {(P_{1},P_{2})} \u00d7P_{1}+C_{1} (mod \\frac{P_{1}P_{2}}{(P_{1},P_{2})})$\n\n\u6b64\u65f6\u6211\u4eec\u53d1\u73b0\u8fd9\u4e24\u4e2a\u540c\u4f59\u65b9\u7a0b\u5408\u5e76\u6210\u4e86\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\uff0c\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u4e0d\u505c\u7684\u5408\u5e76\u540c\u4f59\u65b9\u7a0b\u6765\u6c42\u89e3\u6574\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3\u4e86\n\n\u7136\u540e\u6211\u4eec\u505a\u5b8c\u4e86\u8fd9\u9053\u9898\uff1f\n\n__________________________________\n\n## \u4e00\u4e9b\u5c0f\u7279\u4f8b\n\n\u5982\u679c\u6240\u6709\u7684$P_{i}=A_{i}$\u7684\u8bdd\u6211\u4eec\u89e3\u540c\u4f59\u65b9\u7a0b\u7684\u7ed3\u679c\u5c06\u4f1a\u662f0\n\n\u4f46\u662f\u4e8b\u5b9e\u4e0a\u8fd9\u662f\u4e0d\u5bf9\u7684\n\n\u76f4\u63a5\u6c42\u51fa\u6740\u6b7b\u6bcf\u6761\u9f99\u6240\u9700\u7684\u5200\u6570\u7136\u540e\u6240\u6709\u5200\u6570\u6c42\u4e00\u4e2alcm\u5373\u53ef\n\n\u53e6\u4e00\u4e2a\u5c0f\u7279\u4f8b\u662f\u6211\u4eec\u7684$C_{i}$\u662f$P_{i}$\u7684\u500d\u6570\u65f6\u4e00\u822c\u60c5\u51b5\u65f6\u6740\u4e0d\u6389\u8fd9\u6761\u9f99\u7684\n\n\u4f46\u662f\u5462\uff0c\u5982\u679c$A_{i}=P_{i}$\u5c31\u5f88\u6709\u8da3\u4e86\n\n\u6b64\u65f6\u8fd9\u4e2a\u65b9\u7a0b\u7b49\u4e8e\u6ca1\u7528\uff0c\u9700\u8981\u628a\u5b83\u6254\u6389\uff0c\u6362\u6210\u4e00\u4e2a\u6ca1\u5565\u7528\u7684\u65b9\u7a0b\uff0c\u6bd4\u5982$X\\equiv 0(mod 1)$\u5c31\u884c\u4e86\n\n________________________\n\n## \u6e29\u99a8\u63d0\u793a\n\n\u4f60\u7684\u6a21\u6570\u5168\u90e8\u662flonglong\u8303\u56f4\u7684\uff0c\u76f4\u63a5\u4e58\u4f1a\u7206longlong\uff0c\u8bf7\u4f7f\u7528\u9f9f\u901f\u4e58\u6cd5\u8fdb\u884c\u8fd0\u7b97\n\n\n\u4e0a\u4ee3\u7801~\n\n```C\n#include<cstdio>\n#include<algorithm>\n#include<set>\nusing namespace std;const int N=1e5+10;typedef long long ll;\nmultiset <ll> s;int n;int m;ll mod[N];ll xs[N];ll cs[N];ll st[N];ll gif[N];int T;\ninline void exgcd(ll a,ll& x,ll b,ll& y)//exgcd \n{if(b==0){x=1;y=0;return;}exgcd(b,x,a%b,y);ll t=x;x=y;y=t-(a/b)*y;}\ninline ll gcd(ll a,ll b){if(a<b)swap(a,b);while(b){ll c=a%b;a=b;b=c;}return a;}\ninline ll inv(ll a,ll p){a%=p;ll x;ll y;exgcd(a,x,p,y);return ((x<0)?x+p:x);}\ninline ll mul(ll a,ll b,const ll& md)//\u9f9f\u901f\u4e58 \n{ll ret=0;b=b%md;b=(b>0)?b:b+md;for(;b;b>>=1,a=(a+a)%md)(ret+=a*(b&1))%=md;return ret;}\ninline void cfil(){printf(\"-1\\n\");return;}\ninline void spsolve()//\u7279\u5224 \n{\n\tll res=0;\n\tfor(int i=1;i<=n;i++)res=max(res,((cs[i]+xs[i]-1)/xs[i]));\n\tprintf(\"%lld\\n\",res);\n}\ninline void spsolve2()//\u7279\u5224 \n{\n\tll lc=1;\n    for(int i=1;i<=n;i++)\n        {ll ds=mod[i]/gcd(mod[i],xs[i]);lc=lc/gcd(lc,ds)*ds;}\n    printf(\"%lld\\n\",lc);\n} \ninline void solve()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&cs[i]);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&mod[i]);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&gif[i]);\n\tfor(int i=1;i<=m;i++)scanf(\"%lld\",&st[i]);\n\tfor(int i=1;i<=m;i++)s.insert(st[i]);\n\tmultiset <ll>:: iterator it;\n\tfor(int i=1;i<=n;i++)//\u9884\u5904\u7406\u65b9\u7a0b\u7684\u7cfb\u6570 \n\t{\n\t\tit=(cs[i]<(*s.begin()))?s.begin():(--s.upper_bound(cs[i]));\n\t\txs[i]=*it;s.erase(it);s.insert(gif[i]);\n\t}\n\tfor(int i=1;i<=m;i++)if(mod[i]!=cs[i])goto ski;spsolve2();return;ski:;//\u5224\u4e00\u4e0bp=a\u7684\u60c5\u51b5 \n\tfor(int i=1;i<=n;i++)if(mod[i]!=1)goto skp;spsolve();return;skp:;//\u5224\u4e00\u4e0bp=1\u7684\u60c5\u51b5 \n\tfor(int i=1;i<=n;i++)xs[i]%=mod[i];\n\tfor(int i=1;i<=n;i++)//\u68c0\u6d4b\u662f\u5426\u6709\u65e0\u7528\u7684\u65b9\u7a0b \n\t\tif(xs[i]==0){if(mod[i]==cs[i]){xs[i]=1;mod[i]=1;cs[i]=0;}else {cfil();return;}}\n\tfor(int i=1;i<=n;i++)//\u5316\u7b80\u540c\u4f59\u65b9\u7a0b \n\t{\n\t\tll sx;ll sy;ll g=gcd(xs[i],mod[i]);if(cs[i]%g!=0){cfil();return;}\n\t\texgcd(xs[i],sx,mod[i],sy);\n\t\tmod[i]=mod[i]/g;sx=(sx%mod[i]+mod[i])%mod[i];cs[i]=mul(sx,cs[i]/g,mod[i]);\n\t}\n\tfor(int i=1;i<=n-1;i++)//\u5408\u5e76\u540c\u4f59\u65b9\u7a0b \n\t{\n\t\tll g=gcd(mod[i],mod[i+1]);if((cs[i+1]-cs[i])%g!=0){cfil();return;}\n\t\tll ncs=mul(inv(mod[i]/g,mod[i+1]/g),(cs[i+1]-cs[i])/g,mod[i+1]/g);\n\t\tll nmod=mod[i]/g*mod[i+1];\n\t\tncs=mul(ncs,mod[i],nmod);(ncs+=cs[i])%=nmod;cs[i+1]=ncs;mod[i+1]=nmod;\n\t}printf(\"%lld\\n\",cs[n]);return;\n}\ninline void clear(){s.clear();}\nint main(){scanf(\"%d\",&T);for(int z=1;z<=T;z++)solve(),clear();return 0;}//\u62dc\u62dc\u7a0b\u5e8f~ \n```\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1532139260,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u4e5f\u53ef\u4ee5\u53bb[\u849f\u84bb\u7684blog](https://www.cnblogs.com/flashhu/p/9346078.html)\u4e0a\u770b\n\n### \u524d\u8a00\n\n\u6211\u4eec\u719f\u77e5\u7684\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff0c\u5728\u4f7f\u7528\u6761\u4ef6\u4e0a\u5176\u5b9e\u662f\u5f88\u82db\u523b\u7684\uff0c\u8981\u6c42\u6a21\u7ebf\u6027\u65b9\u7a0b\u7ec4$x\\equiv c(\\mod m)$\u7684\u6a21\u6570\u4e24\u4e24\u4e92\u8d28\u3002\n\n\u4e8e\u662f\u5c31\u6709\u4e86\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff0c\u5176\u5b9e\u73b0\u65b9\u6cd5\u5927\u6982\u662f\u901a\u8fc7\u6269\u5c55\u6b27\u51e0\u91cc\u5fb7\u628a\u4e24\u4e2a\u540c\u4f59\u65b9\u7a0b\u5408\u5e76\uff0c\u5177\u4f53\u4f1a\u5728\u4e0b\u9762\u63d0\u5230\u3002\n\n\u4f46\u662f\uff0c\u4f7f\u7528\u4ecd\u6709\u9650\u5236\uff0c\u90a3\u5c31\u662f$x$\u7684\u7cfb\u6570\u5fc5\u987b\u4e3a$1$\u3002\n\n~~\u6ca1\u5173\u7cfb\uff0c\u628a\u5b83\u518d\u6269\u5c55\u4e00\u4e0b~~\n\n## \u9898\u76ee\u53ca\u5b9e\u73b0\n\n### \u9898\u610f\u5206\u6790\n\n\u663e\u7136\uff0c\u5982\u679c\u6211\u4eec\u80fd\u5e72\u6389\u6240\u6709\u9f99\uff0c\u90a3\u4e48\u6bcf\u4e00\u6b21\u4f7f\u7528\u7684\u5251\u7684\u653b\u51fb\u529b\u662f\u5df2\u77e5\u7684\uff0c\u8bbe\u4e3a$k$\u3002\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u6761\u9f99\uff0c\u653b\u51fb\u6b21\u6570$x$\u5fc5\u987b\u6ee1\u8db3$kx\\equiv a(\\mod p)$\uff08\u53d8\u91cf\u540d\u90fd\u662f\u539f\u9898\u4e2d\u7684\uff09\uff1b\u5f53\u7136\u522b\u5fd8\u8bb0\u8981\u5148\u628a\u751f\u547d\u503c\u964d\u5230\u975e\u6b63\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd8\u8981\u6ee1\u8db3$kx\\geq a$\u5373$x\\geq\\lceil\\frac a k\\rceil$\u3002\n\n\u53ef\u4ee5\u770b\u51fa\u4e0d\u80fd\u76f4\u63a5\u7528\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff0c\u4f46\u4e0d\u59a8\u788d\u5148\u4ecb\u7ecd\u4e00\u4e0b\u5b83\u3002\n\n### \u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\n\n\u5982\u679c\u6709\u4e00\u4e2a\u6a21\u7ebf\u6027\u65b9\u7a0b\u7ec4\uff0c\u6bcf\u4e2a\u5f62\u5982$x\\equiv c(\\mod m)$\uff0c\u800c\u4e14\u4e0d\u4fdd\u8bc1$m$\u4e24\u4e24\u4e92\u8d28\uff0c\u5c31\u7528\u4e0d\u4e86\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u4e86\u3002\n\n\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u662f\u8fd9\u6837\u505a\u7684\u3002\n\n\u6211\u4eec\u5148\u628a\u95ee\u9898\u7b80\u5316\u5230\u4e00\u4e2a\u65b9\u7a0b\u7ec4\u53ea\u6709\u4e24\u4e2a\u65b9\u7a0b\u7684\u60c5\u51b5\uff0c\u5f62\u5982\n\n$$\\begin{cases}x\\equiv c_1(\\mod m_1)\\\\x\\equiv c_2(\\mod m_2)\\end{cases}$$\n\n\u628a\u5b83\u5199\u6210\u4e0d\u5b9a\u65b9\u7a0b\u7684\u5f62\u5f0f\n\n$$\\begin{cases}x=c_1+m_1x_1\\\\x=c_2+m_2x_2\\end{cases}$$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5408\u5e76\u4e86\uff0c\u89e3\u4e00\u4e0b$x_1$\uff0c\u6240\u4ee5$x_2$\u53ef\u53d8\u53f7\n\n$$c_1+m_1x_1=c_2+m_2x_2$$\n\n$$m_1x_1+m_2x_2=c_1-c_2$$\n\n\u53d1\u73b0\u53d8\u6210\u4e86\u4e00\u4e2a\u4e8c\u5143\u4e00\u6b21\u4e0d\u5b9a\u65b9\u7a0b\u7684\u6837\u5b50\uff0c\u8bbe$g=gcd(m_1,m_2)$\uff0c\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5fb7\u6c42$m_1x_1+m_2x_2=g$\u4e2d$x_1$\u7684\u4e00\u4e2a\u89e3$x'$\uff0c\u4e8e\u662f\u7528$\\frac{c_1-c_2}gx'+\\frac{m_2}gt(t\\in\\mathbb Z)$\u53ef\u4ee5\u8868\u793a$x_1$\u7684\u89e3\u96c6\uff08\u5173\u4e8e\u4e00\u822c\u4e8c\u5143\u4e00\u6b21\u4e0d\u5b9a\u65b9\u7a0b\u7684\u89e3\u6cd5\u548c\u89e3\u7684\u5468\u671f\u6027\u8bc1\u660e\u53ef\u4ee5\u770b\u770b\u849f\u84bb\u4e4b\u524d\u5199\u7684\u4e00\u7bc7[\u9898\u89e3](https://www.cnblogs.com/flashhu/p/9149119.html)\uff09\n\n\u628a\u89e3\u96c6\u5e26\u56de$x=c_1+m_1x_1$\u5f97\u5230\n\n$$x=c_1+\\frac{m_1(c_1-c_2)}gx'+\\frac{m_1m_2}gt$$\n\n$$x\\equiv c_1+\\frac{m_1(c_1-c_2)}gx'(\\mod {\\frac{m_1m_2}gt})$$\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u8bbe\u521d\u59cb\u65b9\u7a0b\u4e3a$x\\equiv 0(\\mod1)$\uff0c\u6bcf\u6b21\u5408\u5e76\u4e24\u4e2a\u65b9\u7a0b\u5f97\u5230\u65b0\u7684\u65b9\u7a0b\u3002\u5f53\u7136\u4e2d\u9014\u5982\u679c\u6709\u4e00\u6b21\u51fa\u73b0$\\frac{c_1-c_2}g$\u4e0d\u4e3a\u6574\u6570\u5219\u6574\u4e2a\u65b9\u7a0b\u7ec4\u65e0\u89e3\u3002\n\n### \u518d\u6269\u5c55\n\n\u90a3\u4e48\u6a21\u7ebf\u6027\u65b9\u7a0b\u7ec4\uff0c\u6bcf\u4e2a\u5f62\u5982$kx\\equiv a(\\mod p)$\u8be5\u600e\u4e48\u89e3\u597d\u5462\uff1f\n\n\u8fd8\u662f\u8981\u5408\u5e76\u65b9\u7a0b\u3002\u4ecd\u7136\u8bbe\u4e00\u4e2a\u603b\u65b9\u7a0b$x\\equiv c(\\mod m)$\uff0c\u5c06\u5b83\u4e0e\u5f53\u524d\u65b9\u7a0b\u5408\u5e76\u3002\n\n~~\u4e0b\u9762\u662f\u540c\u6b65\u8d5b\u4e0a\u624b\u63a8\u7684\u5f0f\u5b50\uff0c\u8bf7\u76f4\u63a5\u8df3\u8fc7\u8fd9\u4e00\u6bb5\uff0c\u56e0\u4e3a\u5f0f\u5b50\u662f\u9519\u7684\uff0c\u53ea\u670945\u5206\u3002\u8bf4\u4e0d\u5b9a\u6709\u4e9bDalao\u548c\u6211\u7684\u60f3\u6cd5\u4e00\u6837\uff1f~~\n\n~~\u76f4\u63a5\u5408\u5e76~~\n\n$$\\begin{cases}x=c+mx_0\\\\kx+py_0=a\\end{cases}$$\n\n$$k(mx_0+c)+py_0=a$$\n$$kmx_0+py_0=a-kc$$\n\n~~\u8bbe$g=gcd(km,p)$\uff0c\u89e3\u4e0d\u5b9a\u65b9\u7a0b\u5f97\u5230\u4e00\u4e2a\u89e3$x'$\uff0c\u6709~~\n\n$$x_0=\\frac{a-kc}gx'+\\frac p gt$$\n$$x=c+\\frac{m(a-kc)}gx'+\\frac{mp}gt$$\n\n$$x=c+\\frac{m(a-kc)}gx'(\\mod\\frac{mp}g)$$\n\n\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u76f4\u63a5\u5408\u5e76\u5462\uff1f\u56e0\u4e3a\u8fde\u5f53\u524d$kx\\equiv a(\\mod p)$\u80fd\u4e0d\u80fd\u89e3\u90fd\u6ca1\u6709\u8003\u8651\u3002\n\n\u6240\u4ee5\u6b63\u786e\u7684\u65b9\u6cd5\u5e94\u8be5\u662f\u5148\u89e3\u5f53\u524d\u65b9\u7a0b$kx+py=a$\u3002\n\n\u8bbe$g=gcd(k,p)$\uff0c\u89e3$x'$\uff0c\u5f97$x=\\frac a gx'+\\frac p gt$\u5373$x\\equiv\\frac a gx'(\\mod\\frac p g)$\n\n\u65b9\u7a0b\u91cc$x$\u7684\u7cfb\u6570\u88ab\u53bb\u6389\u4e86\uff01\u53ef\u4ee5\u4ece\u6c42\u9006\u5143\u7684\u89d2\u5ea6\u6765\u7406\u89e3\u8fd9\u4e00\u4e2a\u8fc7\u7a0b\u3002\n\n\u5f53\u7136\uff0c\u4f1a\u6709\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\u3002\u5982\u679c$p\\mid k$\u4e14$p\\mid a$\uff0c\u65b9\u7a0b\u6052\u6210\u7acb\uff0c\u6211\u4eec\u4e0d\u628a\u5b83\u4e0e\u603b\u65b9\u7a0b\u5408\u5e76\u3002\u5982\u679c$p\\mid k$\u4e14$p\\nmid a$\uff0c\u663e\u7136\u65e0\u89e3\u3002\n\n\u6700\u540e\u5c31\u662f\u7528\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5408\u5e76\u5566\u3002\n\n### \u5177\u4f53\u5b9e\u73b0\n\n\u786e\u5b9a\u6bcf\u6b21\u653b\u51fb\u4f7f\u7528\u7684\u5251\uff0c\u76f4\u63a5\u7528multiset\u89e3\u51b3\uff0c\u4e8c\u5206\u627e\u5230\u6ee1\u8db3\u8981\u6c42\u7684\u5251\uff08\u6bd4\u8f83\u8212\u670d\u7684\u662fupper_bound\u627e\u7b2c\u4e00\u4e2a\u6bd4\u8981\u6c42\u5927\u7684\u5251\uff0c\u5982\u679c\u7b49\u4e8ebegin-iterator\u7684\u8bdd\u5c31\u8bf4\u660e\u6ca1\u6709\u4e0d\u5927\u4e8e\u8981\u6c42\u503c\u7684\uff0c\u76f4\u63a5\u9009\u5b83\uff0c\u5426\u5219--iterator\u5c31\u662f\u6ee1\u8db3\u8981\u6c42\u7684\uff09\uff0c\u628a\u5b83\u5220\u6389\uff0c\u518d\u52a0\u5165\u5f53\u524d\u5956\u52b1\u7684\u5251\u3002\u6ce8\u610f\u5220\u7684\u65f6\u5019\u5220\u7684\u662fiterator\u800c\u4e0d\u662f\u6570\u5b57\u3002\n\n\u518d\u6b21\u63d0\u9192\u8981\u6ce8\u610f$x\\geq\\lceil\\frac a k\\rceil$\u3002\u53ef\u4ee5\u6c42\u51fa$\\max\\{\\lceil\\frac a k\\rceil\\}$\uff0c\u5982\u679c\u6700\u540e\u603b\u65b9\u7a0b\u7684$c$\u5c0f\u4e8e\u5b83\uff0c\u5219\u8981\u8865\u81f3\u6ee1\u8db3\u6761\u4ef6\u7684\u6700\u5c0f\u503c\uff0c\u7528\u5f0f\u5b50\u5199\u4e00\u4e0b\u5927\u6982\u662f$c+m\\lceil\\frac{\\max-c}{m} \\rceil$\u3002\n\n\u6ce8\u610f\u6570\u636e\u8303\u56f4\uff0c\u4f1a\u7206longlong\u7684\u5730\u65b9\u7528\u5feb\u901f\u4e58\u3002\u6ce8\u610f\u5904\u7406\u8d1f\u6570\u3002\n\n\u591a\u7ec4\u6570\u636e\uff0c\u6ce8\u610f\u6e05\u7a7a\u548c\u521d\u59cb\u5316\u3002\n```cpp\n#include<cstdio>\n#include<set>\n#define RG register\n#define R RG LL\n#define GC c=getchar()\nusing namespace std;\ntypedef long long LL;\nconst int N=1e5+9;\nLL a[N],p[N],b[N],X,Y,G;\nmultiset<LL>s;\ninline LL in(){\n\tRG char GC;\n\twhile(c<'-')GC;\n\tR x=c&15;GC;\n\twhile(c>'-')x*=10,x+=c&15,GC;\n\treturn x;\n}\nvoid exgcd(R a,R b){\n\tif(!b){X=1;Y=0;G=a;return;}\n\texgcd(b,a%b);\n\t(Y^=X^=Y^=X)-=a/b*X;\n}\ninline LL mul(R b,R k,R m){//\u5feb\u901f\u4e58\n\tR a=0;\n\tfor(;k;k>>=1,b=(b<<1)%m)\n\t\tif(k&1)a=(a+b)%m;\n\treturn a;\n}\nint main(){\n\tfreopen(\"dragon.in\",\"r\",stdin);\n\tfreopen(\"dragon.out\",\"w\",stdout);\n\tR T=in(),n,m,i,c,k,mx;\n\tRG multiset<LL>::iterator it;\n\tE:while(T--){\n\t\tn=in();m=in();\n\t\tfor(i=1;i<=n;++i)a[i]=in();\n\t\tfor(i=1;i<=n;++i)p[i]=in();\n\t\tfor(i=1;i<=n;++i)b[i]=in();\n\t\ts.clear();//\u6ce8\u610f\u6e05\u7a7a\n\t\tfor(i=1;i<=m;++i)s.insert(in());\n\t\tmx=c=0;m=1;//\u521d\u59cb\u603b\u65b9\u7a0b\n\t\tfor(i=1;i<=n;++i){\n\t\t\tit=s.upper_bound(a[i]);//\u8c28\u614e\u9009\u62e9lower_bound\u548cupper_bound\n\t\t\tif(it!=s.begin())--it;\n\t\t\tk=*it;s.erase(it);s.insert(b[i]);//\u5c0f\u5fc3\u624b\u4e00\u6ed1erase(*it)(\u5c45\u7136\u8fd8\u670990\u5206)\n\t\t\tmx=max(mx,(a[i]-1)/k+1);//\u66f4\u65b0\u9650\u5236\n\t\t\tk%=p[i];a[i]%=p[i];//\u5f00\u59cb\u89e3\u65b9\u7a0b\uff0c\u53bb\u6389\u7cfb\u6570\n\t\t\tif(!k&&a[i]){puts(\"-1\");goto E;}\n\t\t\tif(!k&&!a[i])continue;//\u8fd9\u4e24\u4e2a\u8981\u7279\u5224\n\t\t\texgcd(k,p[i]);\n\t\t\tif(a[i]%G){puts(\"-1\");goto E;}\n\t\t\tp[i]/=G;\n\t\t\ta[i]=mul(a[i]/G,(X%p[i]+p[i])%p[i],p[i]);\n\t\t\texgcd(m,p[i]);//\u5f00\u59cb\u5408\u5e76\uff0cX\u548ca-c\u90fd\u53ef\u80fd\u662f\u8d1f\u6570\n\t\t\tif((a[i]-c)%G){puts(\"-1\");goto E;}\n\t\t\tm=m/G*p[i];\n\t\t\tc=(c+mul(mul(m/p[i],((a[i]-c)%m+m)%m,m),(X%m+m)%m,m))%m;\n\t\t}\n\t\tprintf(\"%lld\\n\",c>=mx?c:c+m*((mx-c-1)/m+1));//\u6ee1\u8db3\u9650\u5236\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1532145908,
        "uid": 61325,
        "name": "FlashHu",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u7531\u9898\u610f\u53ef\u5f97\u5f0f\u5b50$a_i-AT_i*x\\mod p_i=0$\n\n\u5e76\u5316\u4e3a$ax\\equiv c(\\mod b)$\u7684\u5f62\u5f0f\n\n\u5f97$AT_i*x_i\\equiv a_i(\\mod p_i)$\n\u8bb0$gcd=gcd(a,b)$\n\n\u4e0a\u5f0f\u53ef\u7531**\u6269\u5c55\u6b27\u51e0\u91cc\u5f97**\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3 $x_i$\n\n\u4ee5\u53ca\u901a\u89e3$x_i^{'}=x_i+\\frac{b}{gcd}*k,k\\in Z$\n\n\u9898\u76ee\u6240\u6c42\u7b54\u6848$x$\u4e0e\u4e0a\u8ff0$x_i$\u5173\u7cfb\u4e3a$x=x_i+\\frac{b}{gcd}*k,k\\in Z$\n\n\u5316\u4e3a\u540c\u4f59\u65b9\u7a0b$x\\equiv a(\\mod b)$\u7684\u5f62\u5f0f\n\u5f97$x \\equiv x_i(\\mod \\frac{b}{gcd})$\n\n\u4e5f\u5c31\u662f\u8bf4\u6bcf\u6761\u5de8\u9f99\u90fd\u53ef\u4ee5\u7531\u4e0a\u8ff0\u8f6c\u5316\u5f97\u5230\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\uff0c\n\u6700\u540e\u7ec4\u6210\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\uff0c\n\u76f4\u63a5**\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406 EXCRT**\u6c42\u89e3\n\n\u4e0d\u8fc7\u8981\u7279\u522b\u6ce8\u610f\uff0c\n**EXCRT\u6240\u6c42\u51fa\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\u5e76\u4e0d\u662f\u6211\u4eec\u8981\u7684\u7b54\u6848**\n\n\u7531\u4e8e\u6bcf\u6761\u9f99\u90fd\u6709\u56fa\u5b9a\u7684\u5251\uff0c\n\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u6761\u9f99**\u81f3\u5c11\u8981\u780d\u51e0\u4e0b\u662f\u5df2\u77e5\u7684**\n\n\u6211\u4eec\u8981\u8bb0\u5f55\u4e0b**\u6bcf\u6761\u9f99\u81f3\u5c11\u8981\u780d\u7684\u6b21\u6570\u4e2d\u7684\u6700\u5927\u503cmi**\uff0c\n\u7136\u540eEXCRT\u6c42\u51fa\u7684\u7b54\u6848\u5e94\u8be5\u662f\n**\u901a\u89e3\u4e2d\u5927\u4e8e\u7b49\u4e8emi\u4e14\u6700\u5c0f\u7684\u89e3**\n\n\u53e6\u5916\u7531\u4e8e\u672c\u849f\u84bb\u5b9e\u5728\u592a\u849f\uff0c\n\u6839\u672c\u4e0d\u4f1a\u4ec0\u4e48multiset\uff0c\n\u4e8e\u662f\u624b\u5199\u4e86\u4e00\u4e2atreap\uff0c\u4ee3\u7801\u53ef\u80fd\u7565\u957f=_=\n\n\u8fd8\u6709\u8fd8\u6709\uff0c\u4e00\u5b9a\u8981\u7528**\u9f9f\u901f\u4e58**\uff01\uff01\uff01\n*******************\n\n```\n//niiick\n#include<iostream>\n#include<vector>\n#include<algorithm>\n#include<queue>\n#include<cstring>\n#include<cstdio>\nusing namespace std;\ntypedef long long lt;\n\nlt read()\n{\n    lt f=1,x=0;\n    char ss=getchar();\n    while(ss<'0'||ss>'9'){if(ss=='-')f=-1;ss=getchar();}\n    while(ss>='0'&&ss<='9'){x=x*10+ss-'0';ss=getchar();}\n    return f*x;\n}\n\nconst lt inf=1e12;\nconst int maxn=500010;\nint t,n,m;\nlt ai[maxn],pi[maxn],at[maxn],atk[maxn];\nlt a[maxn],b[maxn],mi;\n\nstruct node\n{\n    node* ch[2];\n    lt v,r,sum,cnt;\n    node(lt v) :v(v) {r=rand();sum=cnt=1;ch[0]=ch[1]=NULL;}\n    int cmp(lt x){if(x==v)return -1;return x<v?0:1;}\n    void update()\n    {\n        sum=cnt;\n        if(ch[0])sum+=ch[0]->sum;\n        if(ch[1])sum+=ch[1]->sum;\n    }\n};\nnode* rt;\n\nvoid rotate(node* &p,int d)\n{\n    node* k=p->ch[d^1];\n    p->ch[d^1]=k->ch[d];\n    k->ch[d]=p;\n    p->update(); k->update();\n    p=k;\n}\n\nvoid ins(node* &p,lt x)\n{\n    if(p==NULL){ p=new node(x); return;}\n    if(x==p->v){ ++p->sum; ++p->cnt; return;}\n    int d=p->cmp(x);\n    ins(p->ch[d],x);\n    if(p->ch[d]->r < p->r)rotate(p,d^1);\n    p->update();\n}\n\nvoid del(node* &p,lt x)\n{\n    if(p==NULL) return;\n    if(x==p->v)\n    {\n        if(p->cnt>1){ p->sum--; p->cnt--; return;}\n        if(p->ch[0]==NULL){node *k=p; p=p->ch[1]; delete(k); }\n        else if(p->ch[1]==NULL){node *k=p; p=p->ch[0]; delete(k); }\n        else\n        {\n            int dd=p->ch[0]->r < p->ch[1]->r ?1 :0;\n            rotate(p,dd); del(p->ch[dd],x);\n        }\n    }\n    else if(x < p->v)del(p->ch[0],x);\n    else del(p->ch[1],x);\n    if(p!=NULL)p->update();\n}\n\nlt pre(node* p,lt x)\n{\n    if(p==NULL)return -inf;\n    if(x==p->v) return p->v;\n    else if(x<p->v) return pre(p->ch[0],x);\n    else return max(p->v,pre(p->ch[1],x));\n}\n\nlt qmin(node* p)\n{\n    if(p->ch[0]) return qmin(p->ch[0]);\n    else return p->v;\n}\n\nlt mul(lt a,lt b,lt mod)\n{\n    lt res=0;\n    while(b>0)\n    {\n        if(b&1) res=(res+a)%mod;\n        a=(a+a)%mod;\n        b>>=1;\n    }\n    return res;\n}\n\nlt exgcd(lt aa,lt bb,lt &x,lt &y)\n{\n    if(bb==0){x=1;y=0;return aa;}\n    lt gcd=exgcd(bb,aa%bb,x,y);\n    lt tp=x;\n    x=y; y=tp-aa/bb*y;\n    return gcd;\n}\n\nlt excrt()\n{\n    lt M=b[1],ans=a[1],x,y;\n    for(int i=2;i<=n;i++)\n    {\n        lt aa=M,bb=b[i],c=(a[i]-ans%bb+bb)%bb;\n        lt gcd=exgcd(aa,bb,x,y),bg=bb/gcd;\n        if(c%gcd!=0) return -1; \n\n        x=mul(x,c/gcd,bg);\n        ans+=x*M;\n        M*=bg;\n        ans=(ans%M+M)%M;\n    }\n    if(ans>=mi) return ans;//\u6ce8\u610f\u7b54\u6848\u4e0d\u4e00\u5b9a\u662f\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\n    else return ans+((mi-ans)/M+((mi-ans)%M ? 1 : 0))*M;\n}\n\nint main()\n{\n    t=read();\n    while(t--)\n    {\n        rt=NULL; mi=0;\n        n=read();m=read(); int judge=0;\n        for(int i=1;i<=n;++i)ai[i]=read();\n        for(int i=1;i<=n;++i)pi[i]=read();\n        for(int i=1;i<=n;++i)at[i]=read();\n        for(int i=1;i<=m;++i)\n        {\n            lt x=read();\n            ins(rt,x);\n        }\n        for(int i=1;i<=n;++i)//\u67e5\u627e\u5bf9\u5e94\u6bcf\u6761\u9f99\u7684\u5251\n        {\n        \tatk[i]=pre(rt,ai[i]);\n        \tif(atk[i]==-inf) atk[i]=qmin(rt); \n        \tdel(rt,atk[i]); ins(rt,at[i]);\n        \tmi=max(mi,ai[i]/atk[i]+(ai[i]%atk[i]?1:0));\n        \t//\u8bb0\u5f55\u6bcf\u5934\u9f99\u6700\u5c11\u8981\u780d\u7684\u6b21\u6570\u7684\u6700\u5927\u503c\n        }\n        for(int i=1;i<=n;++i)//\u6269\u6b27\u6c42ATK*x\u2261ai(mod pi)\n        {\n            lt x,y,c=ai[i];\n            lt gcd=exgcd(atk[i],pi[i],x,y),bg=pi[i]/gcd;\n            \n            if(c%gcd!=0){ judge=1; break;}//\u65e0\u89e3\n            \n            x=(mul(x,c/gcd,bg)+bg)%bg;\n            a[i]=x; b[i]=bg;\n        }\n        if(judge)printf(\"-1\\n\");\n        else printf(\"%lld\\n\",excrt());\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1533353493,
        "uid": 60885,
        "name": "niiick",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "### \u5fc3\u8def\u5386\u7a0b\n\n\u7b2c\u4e00\u773c\u770b\u6b64\u9898\uff1a\n\n\u4e0d\u5c31\u662f\u4e00excrt\u88f8\u9898\u4e48\uff01\u60f3\u4e0d\u5230\u6211\u8fd9\u4e2a\u849f\u84bb\u5c45\u7136\u80fd\u79d2\u5207NOI2018 Day2 T1\uff01\n\n\u7b2c\u4e8c\u773c\u770b\u6b64\u9898\uff1a\n\n\u4ec0\u4e48\u9b3c\u4e1c\u897f\uff0c\u8fd8\u8981\u7528multiset\u3002\u6ca1\u5173\u7cfb\uff0c\u9ebb\u70e6\u4e00\u70b9\u800c\u5df2\u3002\n\n\u5199\u5b8c\u4ee3\u7801\u540e\uff1a\n\n\u8f7b\u677e\u901a\u8fc7\u6837\u4f8b\uff01\u6b64\u9898\u5373\u5c06\u88ab\u6211\u79d2\u5207\uff01\n\n\u7b2c\u4e00\u6b21\u63d0\u4ea4\uff1a\nRE 30 \n\n\u6570\u7ec4\u600e\u4e48\u5f00\u5c0f\u4e86\uff1f\n\n\u7b2c\u4e8c\u6b21\u63d0\u4ea4\uff1aWA 40\n\n\u4ec0\u4e48\uff1f\u6211\u518d\u4ed4\u7ec6\u68c0\u67e5\u4e00\u4e0b\n\n\u7b2c\u4e09\u6b21\u63d0\u4ea4\uff1aWA 40\n\n\u8fd9\u3002\u3002\u3002\u600e\u4e48\u53ef\u80fd\n\n\u7b2c\u56db\u6b21\u63d0\u4ea4\uff1aTLE 0\n\n\u7b2c\u4e94\u6b21\u63d0\u4ea4\uff1aWA 70\n\n\u7b2c\u516d\u6b21\u63d0\u4ea4\uff1aWA 70\n\n\u7b2c\u4e03\u6b21\u63d0\u4ea4\uff1aWA 70\n\n\u7b2c\u516b\u6b21\u63d0\u4ea4\uff1aWA 70\n\n\n\u3002\u3002\u3002\u3002\u3002\n\n\u5728\u4e0b\u8f7d\u4e86\u6570\u636e\u548c\u73a9\u547d\u5730\u8c03\u8bd5\u4e4b\u540e\uff1a\n\n\u7b2c\u5341\u4e09\u6b21\u63d0\u4ea4\uff1aAC 100\n\n\u7231\u6211\u82cf\u8054\n\n----\n### \u8fdb\u5165\u6b63\u9898\n\n\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6bcf\u6b21\u653b\u51fb\u6240\u4f7f\u7528\u7684\u5251\u90fd\u662f\u56fa\u5b9a\u7684\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2amultiset\u6765\u7ef4\u62a4\u6bcf\u4e00\u6b21\u653b\u51fb\u6240\u4f7f\u7528\u7684\u5251\u3002\uff08\u5f53\u7136\u5de8\u4f6c\u53ef\u4ee5\u624b\u5199\u5e73\u8861\u6811\uff09\n\n\u6ce8\u610f\u9898\u76ee\u91cc\u662f\u201c\u4e0d\u9ad8\u4e8e\u5de8\u9f99\u521d\u59cb\u751f\u547d\u503c\u201d\uff0c\u800c\u4e0d\u662f\u201c\u4f4e\u4e8e\u5de8\u9f99\u521d\u59cb\u751f\u547d\u503c\u201d\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u5f53\u4f7f\u7528upper_bound\u6765\u67e5\u627e\u5143\u7d20\u800c\u4e0d\u662flower_bound\u3002\uff08\u771f \u00b7 noi\u6bd2\u7624\uff09\n\n\u7136\u540e\u6211\u4eec\u6765\u6253\u9f99\u3002\n\n\u5982\u679c\u53ea\u6709\u4e00\u53ea\u9f99\uff0c\u5047\u8bbe\u6211\u4eec\u653b\u51fb\u7684\u6b21\u6570\u4e3aA\uff0c\u5f53\u524d\u4f7f\u7528\u7684\u5251\u7684\u653b\u51fb\u529b\u4e3aatk[i],\u90a3\u4e48\u6211\u4eec\u6c42\u89e3\u7684\u65b9\u7a0b\u5373\u4e3a\uff1a\n$$A\u00d7atk[i]-a[i]\\equiv 0\\pmod{p[i]}$$\n\u79fb\u9879\uff1a\n$$A\u00d7atk[i]\\equiv a[i]\\pmod{p[i]}$$\n\u53d8\u5f62\uff1a\n$$atk[i]*A+p[i]*y=a[i]$$\n\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\uff08exgcd\uff09\uff0c\u6765\u6c42\u51faA\u7684\u6700\u5c0f\u503c\uff0c\u6216\u8bc1\u660e\u65e0\u89e3$(a[i]\\ mod \\gcd(atk[i],p[i])!=0)$\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u6253\u5f88\u591a\u6761\u9f99\u3002\n\n\u76f8\u5f53\u4e8e\u6211\u4eec\u8981\u89e3\u4e00\u4e2a\u65b9\u7a0b\u7ec4\u3002\n\n\u90a3\u4e48\u8fd9\u5c31\u9700\u8981\u7528\u5230\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff08excrt\uff09\u4e86\u3002\n\n\u6211\u4eec\u77e5\u9053\uff0c\u6839\u636e\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u539f\u7406\uff0cA\u7684\u901a\u89e3\u4e3a\uff1a\n\nA\u7684\u7279\u89e3$+i\u00d7(p[i]\\div \\gcd(atk[i],p[i]))(i\\in$\u6574\u6570$)$\n\n\u6211\u4eec\u8bbe$q[i]=p[i]\u00f7gcd(atk[i],p[i])$\n\n\u5982\u679c\u6211\u4eec\u5f53\u524d\u5df2\u7ecf\u6c42\u51fa\u4e86\u524d$k-1$\u4e2a\u65b9\u7a0b\u7684\u89e3$A=x$\uff0c\u6211\u4eec\u5f53\u524d\u8981\u6c42\u7b2c$k$\u4e2a\u65b9\u7a0b\u7684\u89e3\u3002\n\n\u6211\u4eec\u53ef\u8bbe$e=\\operatorname{lcm}(p[1],p[2]...p[k-1])$\n\n\u90a3\u4e48\u6839\u636e\u62d3\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u539f\u7406\uff0c\u7b2c$k$\u4e2a\u65b9\u7a0b\u7684\u89e3\u4e3a\uff1a$x+i\u00d7e(i\\in$\u6574\u6570$)$\n\n\u628a\u8fd9\u4e2a\u5e26\u5165\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$(x+i\u00d7e)\u00d7atk[i]\\equiv a[i]\\pmod{p[i]}$$\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5316\u7b80\u4e3a\uff1a\n\n$$e*atk[i]*i\\equiv a[i]-x\u00d7atk[i] \\pmod{p[i]}$$\n\n\u6211\u4eec\u7ee7\u7eed\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u51fa$i$\u7684\u6700\u5c0f\u89e3\u5373\u53ef\u3002\n\n\u4e00\u6b65\u6b65\u8fd9\u6837\u4e0b\u53bb\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u6574\u4e2a\u65b9\u7a0b\u7684\u6700\u4f18\u89e3\u4e86\u3002\n\n----\n\n### \u4e00\u4e2a\u68d8\u624b\u7684\u4e1c\u897f\n\n\u4e3a\u4ec0\u4e48WA\u4e86\uff1f\n\n\u5982\u679c\u4f60\u4ed4\u7ec6\u8bfb\u9898\uff0c\u4f60\u4f1a\u60ca\u8bb6\u5730\u53d1\u73b0\uff1a\u6570\u636e\u4e2d\u5e76\u4e0d\u4fdd\u8bc1$a[i] \\le p[i] $\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u7684excrt\u5c31\u4f1a\u840e\u6389\u3002\n\n\u4f46\u662f\u4f60\u53c8\u4f1a\u53d1\u73b0\uff0c\u6570\u636e\u4e2d\u867d\u7136\u6709$a[i] \\le p[i] $\u7684\u70b9\uff0c\u4f46\u662f\u6240\u6709$a[i] \\le p[i] $\u7684\u70b9\u90fd\u4fdd\u8bc1$p[i]=1$\u3002\n\np[i]=1?\u90a3\u4e0d\u662f\u5f88\u597d\u7b97\uff1f\u6240\u6709\u9f99\u6c42\u4e00\u4e0b$\\left\\lceil\\dfrac{a[i]}{atk[i]}\\right\\rceil$\u7136\u540e\u53d6\u4e2a\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u6240\u4ee5\uff0c\u5982\u679c\u9047\u5230$a[i] \\le p[i] $\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u7279\u6b8a\u5904\u7406\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\uff0c\u8981\u7206long long\uff0c\u8bf7\u4f7f\u7528\u5feb\u901f\u4e58\u3002\n\n----\n\n### \u4ee3\u7801\n\n```cpp\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\n#define x0 xx0//\u9632\u6b62\u548c\u5934\u6587\u4ef6\u91cd\u540d\n#define y0 yy0\n#define int long long\nusing namespace std;\ninline int read(){\n    int sum=0;\n    char c=getchar();\n    while(!isdigit(c)) c=getchar();\n    while(isdigit(c)){\n        sum=(sum<<1)+(sum<<3)+(c^48);\n        c=getchar();\n    }\n    return sum;\n}\nint const maxn=1e5+5;\nint n,m,x,e,x0,y0,d,a[maxn],p[maxn],atk[maxn],new_atk[maxn];\nmultiset<int> s;\nvoid exgcd(int a,int b,int &d,int &x0,int &y0){//\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\n    if(b==0){\n        d=a,x0=1,y0=0;\n        return;\n    }\n    else{\n        exgcd(b,a%b,d,x0,y0);\n        int t=x0;\n        x0=y0,y0=t-a/b*x0;\n    }\n}\nint gcd(int a,int b){//\u666e\u901a\u7684\u6c42\u516c\u7ea6\u6570\n    return a%b==0?b:gcd(b,a%b);\n}\ninline void spsolve(){//\u7279\u5224\uff08\u6211\u7edd\u5bf9\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u8fd8\u770b\u4e86\u9898\u89e3\uff09\n    int res=0;\n    for(int i=1;i<=n;i++){\n        int x=(a[i]+atk[i]-1)/atk[i];//\u4e0a\u53d6\u6574\n        res=max(res,x);\n    }\n    printf(\"%lld\\n\",res);\n}\ninline int ksc(int a,int b,int p){//\u5feb\u901f\u4e58\n    int res=0;\n    while(b>0){\n        if(b&1) res=(res+a)%p;\n        b>>=1;\n        a=(a+a)%p;\n    }\n    return res;\n}\nsigned main(){\n    int T=read();\n    while(T--){\n        n=read(),m=read();\n        for(int i=1;i<=n;i++)\n          a[i]=read();\n        for(int i=1;i<=n;i++)\n          p[i]=read();\n        for(int i=1;i<=n;i++)\n          new_atk[i]=read();\n        s.clear();//\u8bb0\u5f97\u6e05\u7a7a\n        for(int i=1;i<=m;i++){\n            int aattkk=read();\n            s.insert(aattkk);//\u5148\u628a\u6240\u6709\u521d\u59cb\u62e5\u6709\u7684\u5251\u52a0\u5165\u96c6\u5408\n        }\n        for(int i=1;i<=n;i++){\n            if(a[i]<(*s.begin())){//\u5982\u679c\u6ca1\u6709\u653b\u51fb\u529b\u4e0d\u5927\u4e8e\u81ea\u5df1\u7684\u5251\uff0c\u53d6\u653b\u51fb\u529b\u6700\u5c0f\u7684\n                atk[i]=*s.begin();\n                s.erase(s.begin());//\u8fd9\u628a\u5251\u6d88\u5931\u4e86\n            }\n            else{\n                multiset<int>::iterator it=s.upper_bound(a[i]);\n                //\u5bfb\u627e\u4e0d\u5927\u4e8e\u81ea\u5df1\u7684\u5251\u4e2d\u653b\u51fb\u529b\u6700\u5927\u7684\n                it--;\n                atk[i]=*it;\n                s.erase(it);\n            }\n            s.insert(new_atk[i]);\n        }\n        for(int i=1;i<=n;i++){//\u7279\u5224\n            if(p[i]!=1) break;\n            if(i==n){\n                spsolve();\n                goto wangzhijian;\n            }\n        }\n        //\u6c42\u51fa\u7b2c\u4e00\u4e2a\u65b9\u7a0b\u7684\u89e3\n        exgcd(atk[1],p[1],d,x0,y0);\n        if(a[1]%d!=0){//\u65e0\u89e3\n            printf(\"-1\\n\");\n            goto wangzhijian;\n        }\n        x=(ksc(x0,a[1]/d,p[1]/d)+p[1]/d)%(p[1]/d);\n        //\u6a21\u4e0a\u5269\u4f59\u7c7b\u7684\u6a21\u6570\uff0c\u4f7f\u5176\u5927\u5c0f\u63a7\u5236\u5728\u6a21\u6570\u4ee5\u5185\uff0c\u4ece\u800c\u53d6\u51fa\u5269\u4f59\u7c7b\u4e2d\u7684\u6700\u5c0f\u975e\u8d1f\u5143\n        e=p[1]/gcd(atk[1],p[1]);\n        for(int i=2;i<=n;i++){\n            int A=ksc(e,atk[i],p[i]),B=p[i],C=((a[i]-ksc(x,atk[i],p[i]))%p[i]+p[i])%p[i];\n            exgcd(A,B,d,x0,y0);\n            if(C%d!=0){\n                printf(\"-1\\n\");\n                goto wangzhijian;\n            }\n            x0=(ksc(x0,C/d,B/d)+B/d)%(B/d);\n            //\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u57fa\u672c\u64cd\u4f5c\n            int temp=e;\n            e=e/gcd(e,p[i]/gcd(atk[i],p[i]))*(p[i]/gcd(atk[i],p[i]));//\u66f4\u65b0\u6700\u5c0f\u516c\u500d\u6570\n            x=((x+ksc(x0,temp,e))%e+e)%e;\n            //\u66f4\u65b0\u5f53\u524d\u7684\u89e3\n        }\n        printf(\"%lld\\n\",x); \n        //\u641e\u5b9a\uff0c\u8f93\u51fa\u7b54\u6848\n        wangzhijian:;\n    }\n    return 0;\n}\n```\n\n----\n\n### \u7ecf\u9a8c\u4e0e\u6559\u8bad\n\n1. \u6211\u8fd8\u662f\u592a\u83dc\u4e86\uff1b\n\n2. noi\u7684\u9898\u76ee\u90fd\u5f88\u6bd2\u7624\uff1b\n\n3. \u5f88\u591a\u9898\u76ee\u770b\u8d77\u6765\u662f\u88f8\u9898\uff0c\u5176\u5b9e\u662f\u795e\u9898\uff0c\u4e0d\u8981\u4e00\u773c\u770b\u89c1\u5c31\u4e3b\u89c2\u81c6\u65ad\uff1b\n\n4. \u5982\u679c\u4f60WA\u7684\u90fd\u662f\u5927\u6570\u636e\uff0c\u8bf7\u4e0d\u8981\u7d27\u5f20\uff0c\u8d76\u5feb\u53bb\u770b\u9898\u89e3\uff1b\n\n5. \u5728\u5199\u4e0d\u51fa\u6765\uff0c\u5fc3\u6001\u5d29\u6e83\u65f6\uff0c\u8bf7\u4e0d\u8981\u653e\u5f03\u3002\u4f60\u8981\u575a\u4fe1\uff0c\u5e0c\u671b\u7684\u66d9\u5149\uff0c\u5c31\u5728\u4e0d\u8fdc\u4e4b\u5904\u3002",
        "postTime": 1554819180,
        "uid": 115351,
        "name": "\u03c9\u03b1\u03b7g",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6839\u636e\u9898\u610f\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u9884\u5904\u7406\u51fa\u9762\u5bf9\u7b2c $i$ \u6761\u9f99\u65f6\u4f7f\u7528\u7684\u5251\uff0c\u8bb0\u5176\u4f24\u5bb3\u503c\u4e3a $c_i$\u3002\n\n\u505a\u5b8c\u4e86\u8fd9\u6837\u4e00\u6b65\u9884\u5904\u7406\u8fc7\u540e\uff0c\u4f1a\u53d1\u73b0\u6211\u4eec\u5b9e\u9645\u4e0a\u8981\u89e3\u82e5\u5e72\u4e2a\u5f62\u5982 $c_ix\\equiv a_i \\pmod{p_i}$ \u8fd9\u6837\u7684\u540c\u4f59\u65b9\u7a0b\u7ec4\u8054\u7acb\u540e\u7684\u6700\u5c0f\u89e3\u3002\n\n\u89e3\u8fd9\u6837\u7684\u65b9\u7a0b\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u524d\u63d0\u6761\u4ef6\u662f $a_i \\leq p_i$\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u9f99\u7684\u8840\u91cf\u5728 $\\bmod\\ p_i$ \u610f\u4e49\u4e0b\u4e3a\u96f6\uff0c\u4f46\u5b9e\u9645\u8840\u91cf\u4e0d\u4e3a\u96f6\u7684\u95ee\u9898\u3002\n\n\u4e0d\u8fc7\u597d\u5728\u4e0d\u6ee1\u8db3 $a_i \\leq p_i$ \u7684\u6d4b\u8bd5\u6570\u636e\u90fd\u6ee1\u8db3 $p_i=1$\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u7b54\u6848\u5c06\u76f4\u63a5\u4e3a $\\max \\left \\lceil \\dfrac{a_i}{c_i} \\right \\rceil $\u3002\n\n\u6392\u9664\u8fd9\u79cd\u60c5\u51b5\u540e\uff0c\u6211\u4eec\u4e0b\u9762\u7684\u8ba8\u8bba\u5747\u5728 $a_i \\leq p_i$ \u7684\u524d\u63d0\u4e0b\u8fdb\u884c\u3002\n\n\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\u770b\u8d77\u6765\u50cf\u662f\u53ef\u4ee5\u5e94\u7528\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\uff08EXCRT\uff09\u7684\u6837\u5b50\u3002\u4f46\u662f EXCRT \u8981\u6c42 $x$ \u524d\u9762\u7684\u7cfb\u6570\u5fc5\u987b\u4e3a $1$\u3002\n\n\u5c06\u65b9\u7a0b\u7ec4\u4e24\u8fb9\u540c\u65f6\u9664 $c_i$\uff1f\u4e0d\u884c\uff0c\u6a21 $p_i$ \u610f\u4e49\u4e0b $c_i$ \u7684\u9006\u5143\u4e0d\u4e00\u5b9a\u5b58\u5728\u3002\n\n\u8003\u8651\u5c06\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b\u6539\u5199\u6210\u4e0d\u5b9a\u65b9\u7a0b\u7684\u5f62\u5f0f\u3002\n\n\u50cf $c_ix\\equiv a_i \\pmod{p_i}$ \u5c31\u53ef\u4ee5\u6539\u5199\u4e3a\uff1a$c_ix+p_iy=a_i$\u3002\n\n\u63a5\u4e0b\u6765\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u6765\u89e3\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\u5373\u53ef\u3002\n\n\u7b49\u7b49\uff01\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u89e3\u7684\u662f\u5f62\u5982 $ax+by=\\gcd(a,b)$ \u5f62\u5f0f\u7684\u4e0d\u5b9a\u65b9\u7a0b\uff0c\u4e0a\u9762\u7684\u65b9\u7a0b\u663e\u7136\u4e0d\u6ee1\u8db3\u8fd9\u4e2a\u5f62\u5f0f\uff0c\u4e0d\u80fd\u76f4\u63a5\u7528 exgcd \u6765\u89e3\u3002\n\n\u6362\u4e2a\u5143\u540e\u7a0d\u5fae\u63a8\u4e00\u4e0b\uff1a\n\n\u6211\u4eec\u8bbe $x=\\dfrac{a_i}{\\gcd(c_i,p_i)}x'$\uff0c$y=\\dfrac{a_i}{\\gcd(c_i,p_i)}y'$\u3002\n\n\u5219\u539f\u6765\u7684\u65b9\u7a0b\u53ef\u4ee5\u6539\u5199\u4e3a\uff1a\n\n$$\nc_ix'+p_iy'=\\gcd(c_i,p_i)\n$$\n\n\u73b0\u5728\u65b9\u7a0b\u53d8\u6210\u4e86\u6807\u51c6\u5f62\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u89e3\u4e86\u3002\n\n\u8bbe\u4e0a\u9762\u65b9\u7a0b\u7684\u4e00\u7ec4\u89e3\u662f $x'=x'_0$\uff0c$y'=y'_0$\uff0c\u5219\u539f\u65b9\u7a0b\u4e0e\u4e4b\u5bf9\u5e94\u7684\u89e3\u4e3a $x_0=\\dfrac{a_i}{\\gcd(c_i,p_i)}x'_0$\uff0c$y_0=\\dfrac{a_i}{\\gcd(c_i,p_i)}y'_0$\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u65b9\u7a0b\u7ec4\u7684\u89e3\uff0c\u5bf9\u4e8e\u591a\u4e2a\u65b9\u7a0b\u7ec4\uff0c\u6211\u4eec\u9700\u8981\u7528 ExCRT\uff08\u672c\u8d28\u4e0a\u8fd8\u662f\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\uff09\u6765\u5408\u5e76\u5b83\u4eec\u3002\n\n\u7b80\u5355\u6765\u8bf4\uff0c\u5bf9\u4e8e\u4e24\u4e2a\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b\uff1a\n\n$$\n\\begin{cases}\nx \\equiv a_1 \\pmod {p_1}\\\\\nx \\equiv a_2 \\pmod {p_2}\\\\\n\\end{cases}\n$$\n\n\u6211\u4eec\u8fd8\u662f\u628a\u5b83\u4eec\u6539\u5199\u6210\u4e0d\u5b9a\u65b9\u7a0b\u7684\u5f62\u5f0f\uff1a\n\n$$\n\\begin{cases}\nx = a_1 +p_1y_1\\\\\nx = a_2 +p_2y_2\\\\\n\\end{cases}\n$$\n\n\u8054\u7acb\u540e\u6d88\u53bb $x$\uff0c\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u89e3 $y_1,y_2$ \u5373\u53ef\u5408\u5e76\u4e24\u4e2a\u65b9\u7a0b\u3002\n\n## \u51e0\u4e2a\u7279\u6b8a\u60c5\u51b5\n\n1. \u6052\u6210\u7acb\u7684\u65b9\u7a0b\u3002\u5f53 $a_i \\equiv c_i \\equiv 0 \\pmod{p_i}$ \u65f6\uff0c\u65b9\u7a0b\u6052\u6210\u7acb\u3002\n2. \u65e0\u89e3\u7684\u65b9\u7a0b\u3002\u5f53 $c_i \\equiv 0\\pmod{p_i}$ \u800c $a_i \\not \\equiv 0\\pmod{p_i}$ \u65f6\uff0c\u65b9\u7a0b\u662f\u65e0\u89e3\u7684\u3002\n\n```cpp\n// Problem : P4774 [NOI2018]\u5c60\u9f99\u52c7\u58eb\n// Contest : Luogu\n// URL : https://www.luogu.com.cn/problem/P4774\n// Memory Limit : 500 MB\n// Time Limit : 2000 ms\n// Powered by CP Editor (https://github.com/cpeditor/cpeditor)\n\n#include <iostream>\n#include <set>\n#include <algorithm>\nusing namespace std;\nlong long a[100005],p[100005];\nlong long nswd[100005],c[100005];\nmultiset<long long> swd;\nint n,m;\nlong long exgcd(long long a,long long b,long long&x,long long&y)\n{\n if(b==0)\n {\n  x=1,y=0;\n  return a;\n }\n long long g=exgcd(b,a%b,x,y);\n int t=x;\n x=y;\n y=t-a/b*y;\n return g;\n}\nlong long mul(long long x,long long y,long long p)\n{\n long long ans=0;\n while(y)\n {\n  if(y&1)ans=(ans+x)%p;\n  x=(x+x)%p;\n  y>>=1;\n }\n return ans;\n}\nnamespace sub1//p_i maybe greater than a_i, but guaranteed p_i=1\n{\n bool check()\n {\n  bool flag=true;\n  for(int i=1;i<=n;i++)\n   flag&=(p[i]==1);\n  return flag;\n }\n void solve()\n {\n  long long ans=0;\n  for(int i=1;i<=n;i++)\n   ans=max(ans,(long long)((a[i]/c[i])+(a[i]%c[i]!=0)));\n  cout<<ans<<endl;\n }\n}\nint main()\n{\n int t;\n cin>>t;\n while(t--)\n {\n  bool flag=true;\n  cin>>n>>m;\n  for(int i=1;i<=n;i++)\n   cin>>a[i];\n  for(int i=1;i<=n;i++)\n   cin>>p[i];\n  for(int i=1;i<=n;i++)\n   cin>>nswd[i];\n  swd.clear();\n  for(int i=1;i<=m;i++)\n  {\n   long long x;\n   cin>>x;\n   swd.insert(x);\n  }\n  for(int i=1;i<=n;i++)\n  {\n   auto it=swd.upper_bound(a[i]);\n   if(it!=swd.begin())it--;\n   c[i]=*it;\n   swd.erase(it);\n   swd.insert(nswd[i]);\n  }\n  long long ans=0,z=1;\n  if(sub1::check())\n  {\n   sub1::solve();\n   continue;\n  }\n  for(int i=1;i<=n;i++)\n  {\n   c[i]%=p[i],a[i]%=p[i];\n   if(!c[i]&&a[i])\n   {\n    cout<<-1<<endl;\n    flag=false;break;\n   }\n   if(!c[i]&&!a[i])continue;\n   long long x,y;\n   long long g=exgcd(c[i],p[i],x,y);\n   if(a[i]%g)\n   {\n    cout<<-1<<endl;\n    flag=false;break;\n   }\n   p[i]/=g;\n   a[i]=mul(a[i]/g,(x%p[i]+p[i])%p[i],p[i]);\n   g=exgcd(z,p[i],x,y);\n   if((a[i]-ans)%g)\n   {\n    cout<<-1<<endl;\n    flag=false;break;\n   }\n   z=z/g*p[i];\n   ans=(ans+mul(mul(z/p[i],((a[i]-ans)%z+z)%z,z),(x%z+z)%z,z))%z;\n  }\n  if(flag)cout<<ans<<endl;\n }\n return 0;\n}\n```",
        "postTime": 1591538635,
        "uid": 22030,
        "name": "StudyingFather",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P4774)\n# \u96f6.\u524d\u8bb0\n\u4e00\u4e2aupper_bound\u548clower_bound\u7684\u95ee\u9898\u5361\u4e86\u6211\u4e00\u5929\uff0c\u5927\u5bb6\u8981\u5f15\u4ee5\u4e3a\u6212\n# \u4e00.\u5927\u4f53\u601d\u8def\n\u5047\u8bbe\u6211\u4eec\u780d\u7b2ci\u6761\u9f99\u7684\u653b\u51fb\u529b\u4e3a$atk_i$\uff0c\u7b2ci\u6761\u9f99\u7684\u8840\u91cf\u4e3a$a_i$\uff0c\u4e00\u6b21\u6062\u590d\u7684\u8840\u91cf\u4e3a$p_i$\uff0c\u4e0d\u96be\u53d1\u73b0\u9898\u76ee\u5c31\u662f\u8ba9\u6211\u4eec\u6c42\u6700\u5c0f\u7684\u6b63\u6574\u6570$x$\uff0c\u4f7f\u5f97\u5b83\u540c\u65f6\u6ee1\u8db3n\u6761\u4e0b\u9762\u7684\u7b49\u5f0f\uff1a\n$$atk_i\\times x \\equiv a_i(\\bmod p_i)$$\n\u56e0\u6b64\u4e0d\u96be\u60f3\u5230\u8981\u7528excrt\n# \u4e8c.\u5b9e\u73b0\u65b9\u6cd5\n## 1.$atk_i$\n\u5728\u9898\u76ee\u4e2d\u51fa\u73b0\u4e86\u9009\u62e9\u5251\u7684\u60c5\u51b5\n\n\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2amultiset\u7ef4\u62a4\u5f53\u524d\u6240\u6709\u7684\u5251\uff0c\u6309\u7167\u9898\u76ee\u8981\u6c42\u518d\u7528upper_bound\u5f97\u5230\u6240\u9700\u7684\u5251\n\n\u5b9e\u73b0\u4ee3\u7801\uff1a\n```cpp\nfor(register int i=1;i<=m;i++){//\u4e00\u5f00\u59cb\u5c31\u6709\u7684m\u628a\u5251\n\tint q=R();s.insert(q);\n}\nmultiset<ll>::iterator it;\nfor(register int i=1;i<=n;i++){//\u6309\u7167\u9898\u76ee\u8981\u6c42\u53d6\u6ee1\u8db3\u6761\u4ef6\u7684\u5251\n\tit=*s.begin()>a[i] ? s.begin():--s.upper_bound(a[i]);\n\tatk[i]=*it;s.erase(it);s.insert(c[i]);//\u5373\u4e3aatk_i\uff0c\u5220\u5251\u518d\u5f97\u65b0\u5251\n}\n```\n~~\u5f53\u7136\u4e5f\u53ef\u4ee5\u624b\u6253\u5e73\u8861\u6811\u7ef4\u62a4\uff0c\u4e0d\u8fc7\u7801\u91cf\u672c\u6765\u5c31\u5927\u4f55\u5fc5\u5462~~\n## 2.\u8f6c\u5316\u4e00\u822c\u5f0f\n\u6211\u4eec\u5f97\u5230\u7684\u5f0f\u5b50\u662f:\n$$atk_i \\times x \\equiv a_i(\\bmod p_i)$$\n\u53ef\u662f\u6211\u4eec\u60f3\u8981\u7684\u5f0f\u5b50\u662fexcrt\u7684\u4e00\u822c\u5f0f:$x\\equiv na(\\bmod nb)$\n\n\u9047\u5230\u8fd9\u6837\u7684\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u5229\u7528exgcd\u7684\u901a\u89e3\u516c\u5f0f\u6765\u8f6c\u5316\n\n\u6211\u4eec\u628a\u539f\u6765\u7684\u5f0f\u5b50\u8f6c\u6210:\n$$atk_i\\times x+p_i\\times y=a_i$$\n\u901a\u8fc7exgcd\u89e3\u7684x\u7684\u7279\u89e3$x_0$\n\n\u6211\u4eec\u53ef\u4ee5\u7531\u901a\u9879\u516c\u5f0f\u53ef\u77e5\uff1a\n$$x=x_0+k\\times \\dfrac{p_i}{gcd(atk_i,p_i)}$$\n\u56e0\u6b64\u53ef\u4ee5\u5f97\u5230:\n$$x \\equiv x_0(\\bmod \\dfrac {p_i}{gcd(atk_i,p_i)})$$\n\u8fd9\u6837\u5c31\u53d8\u5f97\u53efexcrt\u4e86\n\n\u5b9e\u73b0\u4ee3\u7801:\n```\nfor(register int i=1;i<=n;i++){//\u5c06\u540c\u4f59\u65b9\u7a0b\u53d8\u5f97\u53efexcrt\n\tll gc=gcd(atk[i],p[i]);//atk_i\u548cp_i\u7684gcd\n\tif(a[i]%gc!=0) return -1;\n\texgcd(atk[i],p[i],x,y);\n\tnb[i]=p[i]/gc;\n\tx=(x%nb[i]+nb[i])%nb[i];//\u628ax0\u53d8\u6210\u6b63\u6570\n\tna[i]=ksc(a[i]/gc,x,nb[i]);//x=na(mod nb)\n}\n```\n## 3.excrt\n\u6211\u4eec\u5df2\u7ecf\u5c06\u9898\u76ee\u8f6c\u5316\u4e3a\u975e\u5e38\u6807\u51c6\u7684excrt\u7684\u9898\u76ee\n\n\u5373\u6709$n$\u6761\u5f62\u5982\u8fd9\u6837\u7684\u5f0f\u5b50:\n$$x \\equiv na_i(\\bmod nb_i)$$\n\u6211\u4eec\u8981\u6c42\u6700\u5c0f\u7684\u6b63\u6574\u6570x\n\n\u6211\u4eec\u8003\u8651\u628a\u4e24\u4e2a\u5f0f\u5b50\u5408\u5e76:\n$$\n\\begin{cases}\nx \\equiv na_1(\\bmod nb_1)\\\\\nx \\equiv na_2(\\bmod nb_2)\n\\end{cases}\n$$\n\u8f6c\u5316\u6210\u7b49\u5f0f\u4e3a\n$$\n\\begin{cases}\nx=na_1-nb_1\\times k_1\\\\\nx=na_2-nb_2\\times k_2\n\\end{cases}\n$$\n\u56e0\u6b64\u5c06\u4e24\u4e2a\u5f0f\u5b50\u5408\u5728\u4e00\u8d77\u5c31\u662f:\n$$na_1-nb_1\\times k_1=na_2-nb_2\\times k_2$$\n$$nb_1\\times k_1-nb_2\\times k_2=na_1-na_2$$\n\u5176\u4e2d$k_1$\u548c$k_2$\u662f\u8981\u6c42\u7684\u672a\u77e5\u91cf\uff0c\u5176\u4f59\u90fd\u662f\u5e38\u6570\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u518d\u7528\u4e00\u6b21exgcd\u628a\u6700\u5c0f\u7684$k_1$\u6c42\u51fa\u6765\uff0c\u503c\u4e3a$k_0$\n\n\u6211\u4eec\u56e0\u6b64\u5f97\u5230\u4e86$x$\u6700\u5c0f\u503c\u4e3a$x_0=na_1-nb_1\\times k_0$\n\n\u800c\u901a\u89e3\u516c\u5f0f\u5e94\u8be5\u4e3a:\n$$x=x_0+lcm(nb_1,nb_2)$$\n\n\u56e0\u6b64\u6ee1\u8db3\u4e24\u6761\u5f0f\u5b50\u7684\u5f0f\u5b50\u662f:\n$$x\\equiv x_0 (\\bmod lcm(nb_1,nb_2))$$\n\u7136\u540e\u4e00\u76f4\u8fd9\u6837\u5408\u5e76\u4e0b\u53bb\u5c31\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\n\n\u5b9e\u73b0\u4ee3\u7801:\n```\nfor(register int i=1;i<n;i++){//excrt\u6a21\u677f\uff0c\u5408\u5e76i\u548ci+1\u6761\u5f0f\u5b50 \n\tll gc=gcd(nb[i],nb[i+1]);\n\tif((na[i+1]-na[i])%gc!=0) return -1;//\u65e0\u89e3\u7684\u60c5\u51b5 \n\texgcd(nb[i]/gc,nb[i+1]/gc,x,y);//\u8dd1\u4e00\u904dexgcd \n\tll nna=ksc(x,(na[i+1]-na[i])/gc,nb[i+1]/gc);//\u65b0\u7684na \n\tll nmod=lcm(nb[i],nb[i+1]);//\u65b0\u7684nb \n\tnna=ksc(nna,nb[i],nmod);nna=(nna+na[i])%nmod;\n\tna[i+1]=nna;nb[i+1]=nmod;\n}\n```\n\n# \u4e09.\u7279\u6b8a\u60c5\u51b5&\u7ec6\u8282\n## 1.p=1\n\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e0d\u96be\u53d1\u73b0\u53ea\u8981\u628a\u9f99\u780d\u5230\u975e\u6b63\u8840\u5c31\u8d62\u5b9a\u4e86\n\n\u56e0\u6b64\u7b54\u6848\u4e3a:\n## $Max_{i=1}^n \\lceil \\frac {a_i}{atk_i} \\rceil$\n\n## 2.\u65e0\u89e3\n\u5728\u4efb\u4f55\u4e00\u6b21exgcd\u4e2d\uff0c\u82e5\u5b58\u5728\u65e0\u89e3\u7684\u60c5\u51b5\uff0c\u6b64\u9898\u65e0\u89e3\n## 3.\u5feb\u901f\u4e58\n\u672c\u9898\u4e2d\u5b58\u5728\u7206long long\u7684\u98ce\u9669\uff0c\u56e0\u6b64\u8981\u7528\u5feb\u901f\u4e58\n\n# \u56db.\u4ee3\u7801\u6c47\u603b\n```\n#include<cstdio>\n#include<cctype>\n#include<set>\nusing namespace std;\n#define ll long long\ninline ll max(ll a,ll b){return a>b? a:b;}\ninline ll abs(ll a){return a<0? -a:a;}\nconst int maxn=1e5+5;\ninline ll gcd(ll a,ll b){\n\tif(a%b==0) return b;\n\treturn gcd(b,a%b);\n}\ninline ll lcm(ll a,ll b){return a/gcd(a,b)*b;}\ninline ll R(){\n\tll r=0;char c=getchar();\n\twhile(!isdigit(c)) c=getchar();\n\twhile(isdigit(c)) r=(r<<1)+(r<<3)+(c^48),c=getchar();\n\treturn r;\n}\nint t,n,m,flag;//n:\u9f99 m:\u5251 \ninline void exgcd(ll a,ll b,ll &x,ll &y){//\u6269\u5c55\u6b27\u51e0\u91cc\u5f97 \n\tif(b==0){x=1;y=0;return ;}\n\texgcd(b,a%b,x,y);\n\tll t=y;y=x-a/b*y;x=t;//\u7528x1,y1\u66f4\u65b0x,y,\u6ce8\u610f\u5f04\u4e00\u4e2a\u65b0\u53d8\u91cft \n    return ;\n}\nmultiset <ll> s;\nll a[maxn],p[maxn],c[maxn],atk[maxn],ans;//c[i]:i\u9f99\u6b7b\u540e\u6389\u5251\u653b\u51fb\u529b,atk[i]\u653b\u51fbi\u53f7\u9f99\u7684\u5251\u7684\u653b\u51fb\u529b \nll na[maxn],nb[maxn],x,y;//\u65b0\u7684x \u540c\u4f59\u4e8ena(mod nb) \ninline ll solve1(){\n\tans=0;\n\tfor(register int i=1;i<=n;i++){\n\t\tans=max(ans,(a[i]-1)/atk[i]+1);\n\t}\n\treturn ans;\n}\ninline ll ksc(ll x,ll y,ll mod){//\u5feb\u901f\u4e58 \n    x=x%mod,y=y%mod;\n    return ((x*y-(ll)(((long double)x*y+0.5)/mod)*mod)%mod+mod)%mod;\n}\ninline ll work(){\n\ts.clear();flag=0;\n\tn=R();m=R();\n\tfor(register int i=1;i<=n;i++) a[i]=R();\n\tfor(register int i=1;i<=n;i++) p[i]=R();\n\tfor(register int i=1;i<=n;i++) c[i]=R();\n\tfor(register int i=1;i<=m;i++){//\u4e00\u5f00\u59cb\u5c31\u6709\u7684m\u628a\u5251\n\t\tint q=R();s.insert(q);\n\t}\n\tmultiset<ll>::iterator it;\n\tfor(register int i=1;i<=n;i++){//\u6309\u7167\u9898\u76ee\u8981\u6c42\u53d6\u6ee1\u8db3\u6761\u4ef6\u7684\u5251\n\t\tit=*s.begin()>a[i] ? s.begin():--s.upper_bound(a[i]);\n\t\tatk[i]=*it;s.erase(it);s.insert(c[i]);//\u5373\u4e3aatk_i\uff0c\u5220\u5251\u518d\u5f97\u65b0\u5251\n\t}\n\tfor(register int i=1;i<=n;i++) if(p[i]!=1) flag=1;//\u7279\u6b8a\u60c5\u51b5 \n\tif(!flag) return solve1();\n\tfor(register int i=1;i<=n;i++){//\u5c06\u540c\u4f59\u65b9\u7a0b\u53d8\u5f97\u53efexcrt\n\t\tll gc=gcd(atk[i],p[i]);//atk_i\u548cp_i\u7684gcd\n\t\tif(a[i]%gc!=0) return -1;\n\t\texgcd(atk[i],p[i],x,y);\n\t\tnb[i]=p[i]/gc;\n\t\tx=(x%nb[i]+nb[i])%nb[i];//\u628ax0\u53d8\u6210\u6b63\u6570\n\t\tna[i]=ksc(a[i]/gc,x,nb[i]);//x=na(mod nb)\n\t}\n\tfor(register int i=1;i<n;i++){//excrt\u6a21\u677f\uff0c\u5408\u5e76i\u548ci+1\u6761\u5f0f\u5b50 \n\t\tll gc=gcd(nb[i],nb[i+1]);\n\t\tif((na[i+1]-na[i])%gc!=0) return -1;//\u65e0\u89e3\u7684\u60c5\u51b5 \n\t\texgcd(nb[i]/gc,nb[i+1]/gc,x,y);//\u8dd1\u4e00\u904dexgcd \n\t\tll nna=ksc(x,(na[i+1]-na[i])/gc,nb[i+1]/gc);//\u65b0\u7684na \n\t\tll nmod=lcm(nb[i],nb[i+1]);//\u65b0\u7684nb \n\t\tnna=ksc(nna,nb[i],nmod);nna=(nna+na[i])%nmod;\n\t\tna[i+1]=nna;nb[i+1]=nmod;\n\t}\n\treturn na[n];//\u7b54\u6848\u5c31\u662f\u6700\u540e\u7684na \n} \nint main(){\n\tt=R();\n\tfor(register int qwq=1;qwq<=t;qwq++){\n\t\tprintf(\"%lld\\n\",work());\n\t}\n\treturn 0;\n}\n```\n# \u4e94.\u540e\u8bb0\n\u672c\u9898\u8003\u67e5\u4e86\u5927\u5bb6\u5bf9\u4e8e\u6784\u9020excrt\u7684\u65b9\u6cd5\u662f\u5426\u719f\u6089\n\n\u6211\u4eec\u8981\u5584\u4e8e\u5c06\u9898\u76ee\u4e00\u6b65\u6b65\u8f6c\u5316\u4e3a\u6211\u4eec\u53ef\u4ee5\u89e3\u7684\u60c5\u51b5\n\n\u5bf9\u4e8e\u53ef\u4ee5\u5077\u61d2\u7684\u5730\u65b9\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e9b\u7279\u5224\u5077\u61d2\uff0c\u4e5f\u8bb8\u4f1a\u56e0\u6b64\u591aa\u51e0\u4e2a\u70b9\n\nFinally\uff0c\u8c22\u8c22\u5927\u5bb6\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.luogu.com.cn/blog/HongseFox/solution-p4774)",
        "postTime": 1576308415,
        "uid": 93838,
        "name": "Hongse_Fox",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "##### \u94fe\u63a5\uff1a\n\n[P4774](https://www.luogu.com.cn/problem/P4774)\n\n---\n\n##### \u524d\u8a00\uff1a\n\n\u4ea4\u4e8618\u904d\u6700\u540e\u53d1\u73b0\u662f\u591a\u7ec4\u6570\u636e\u6ca1\u6e05\u7a7a/ll\n\n---\n\n##### \u9898\u610f\uff1a\n\n\u5176\u5b9e\u5c31\u662f\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u7ec4\u6c42\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\u3002\n\n---\n##### \u5206\u6790\u8fc7\u7a0b\uff1a\n\n\u9996\u5148\u53d1\u73b0\u6839\u636e\u9898\u76ee\u63cf\u8ff0\u7684\u9009\u62e9\u5251\u7684\u65b9\u5f0f\uff0c\u6bcf\u6761\u9f99\u5bf9\u5e94\u7684\u5251\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u6709\u67e5\u8be2\u524d\u9a71\uff0c\u540e\u7ee7\uff08\u5728\u8be5\u6570\u4e0d\u5b58\u5728\u524d\u9a71\u65f6\uff0c\u6700\u5c0f\u503c\u5373\u4e3a\u540e\u7ee7\uff09\uff0c\u548c\u63d2\u5165\uff0c\u5220\u9664\u64cd\u4f5c\uff0c\u6240\u4ee5\u60f3\u5230\u5e73\u8861\u6811\u7ef4\u62a4\u6bcf\u6761\u9f99\u7684\u5251\u7684\u653b\u51fb\u529b\uff0c\u8bb0\u4e3a `b[i]`\u3002\u5efa\u8bae\u4f7f\u7528\u975e\u65cb treap\uff0c\u975e\u5e38\u4e4b\u597d\u5199\u3002\n\n\n\n\u6839\u636e\u9898\u76ee\u63cf\u8ff0\uff0c`a[i]` \u4e3a\u6bcf\u6761\u9f99\u751f\u547d\u503c\uff0c`p[i]` \u4e3a\u6bcf\u6761\u9f99\u56de\u590d\u91cf\u3002\u53d1\u73b0\u80fd\u591f\u51fb\u6740\u8fd9\u6761\u9f99\u7684\u6761\u4ef6\u53ef\u4ee5\u5217\u6210\u4e00\u4e2a\u65b9\u7a0b\uff1a\n\n$xb[i]-yp[i]=a[i]$\n\n$x$ \u4e3a\u653b\u51fb\u6b21\u6570\uff0c$y$ \u4e3a\u56de\u590d\u6b21\u6570\uff0c\u8f6c\u5316\u4e3a\u540c\u4f59\u65b9\u7a0b\u7684\u5f62\u5f0f\u4e3a\uff1a\n\n$xb[i]\\equiv a[i]\\pmod {p[i]}$\n\n\u6240\u4ee5\u9898\u76ee\u5c31\u88ab\u6211\u4eec\u8f6c\u5316\u6210\u4e86\u4e00\u4e2a\u4e00\u5143 $n$ \u6b21\u7684\u4e0d\u5b9a\u65b9\u7a0b\u7ec4\uff1a\n\n$\\begin{cases}xb[1]\\equiv a[1]\\pmod {p[1]} \\\\ xb[2]\\equiv a[2]\\pmod {p[2]}\\\\ \\cdots\\\\ xb[n]\\equiv a[n]\\pmod {p[n]}\\end{cases}$\n\n\u6c42 $x$ \u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\u3002\n\n\u8fd9\u6837\u7684\u5f62\u5f0f\u867d\u7136\u4e0d\u6ee1\u8db3 CRT \u548c exCRT \u7684\u5f62\u5f0f\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u4eceexCRT\u7684\u601d\u60f3\u5f97\u5230\u542f\u53d1\u3002\u6211\u4eec\u8bb0\u5f55\u4e0b\u524d $m-1$ \u4e2a\u65b9\u7a0b\u7684\u901a\u89e3 $x=x_0+t*M$\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5df2\u77e5 $x_0$ \u548c $M$\u3002\n\n\u5bf9\u4e8e\u7b2c $m$ \u4e2a\u65b9\u7a0b $xb[m]-yp[m]=a[m]$ \uff0c\u5c06\u4e0a\u8ff0 $x$ \u5e26\u5165\uff0c\u6709\n\n$(x_0+t*M)b[i]-yp[i]=a[i]$  \n\n\u5373 $x_0b[i]+t*M*b[i]-yp[i]=a[i]$   \n\n\u7531\u4e8e $x_0,b[i],M,p[i],a[i]$ \u5168\u90e8\u90fd\u5df2\u77e5\uff0c\u6240\u4ee5\u5316\u4e3a\n\n$t*Mb[i]-y*p[i]=a[i]-x_0b[i]$\n\n\u8bbe $ta=Mb[i],tb=p[i],tc=a[i]-x_0b[i]$\n\n\u5c31\u6709 $t*ta-y*tb=tc$\n\n\u53ef\u4ee5\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u89e3 $t=t_0+q*\\dfrac{tb}{\\gcd(ta,tb)}$\u3002\n\n\u5982\u679c $t$ \u65e0\u89e3\u90a3\u663e\u7136\u6b64\u9898\u5c31\u65e0\u89e3\u3002\n\n\u4e3a\u4e86\u8fd9\u91cc\u770b\u8d77\u6765\u7b80\u6d01\u4e00\u4e9b\uff0c\u8bbe $r=\\dfrac{tb}{\\gcd(ta,tb)}$\u3002\n\n\u5219 $t=t_0+q*r$\n\n\u53d1\u73b0\u6211\u4eec\u4e0d\u505c\u5e26\u5165\u5316\u7b80\u6c42\u51fa\u4e86\u524d $m-1$ \u4e2a\u65b9\u7a0b\u7684\u89e3 $x=x_0+t*M$  \u4e2d $t$\u7684\u8303\u56f4\uff0c\u6240\u4ee5\u518d\u5c06 $t$ \u5e26\u5165\u8be5\u5f0f\uff0c\u6709\uff1a\n\n$x=x_0+(t_0+q*r)*M$  \n\n\u5373 $x=x_0+t_0*M+q*r*M$\n\n\u8fd8\u770b\u4e0d\u51fa\u6765\u5417\uff1f\u90a3\u5c31\u518d\u62ec\u8d77\u6765\uff1a\n\n$x=(x_0+t_0*M)+q*(r*M)$\n\n\u8fd9\u4e2a\u5199\u6cd5\u662f\u4e0d\u662f\u548c $x=x_0+t*M$ \u6709\u70b9\u50cf\uff1f\u6ca1\u9519\uff0c\u8fd9\u5c31\u662f\u5408\u5e76\u4e86\u4e24\u4e2a\u65b9\u7a0b\u4e4b\u540e\u7684\u89e3\u3002\n\n\u53d1\u73b0\u6211\u4eec\u5b8c\u5168\u901a\u8fc7\u67ff\u5b50\u548c\u63a8\u5bfc\u5f97\u51fa\u4e86\u5408\u5e76\u65b9\u7a0b\u7684\u65b9\u6cd5\uff0c\u53ea\u9700\u8981\u505a\u4e00\u6b21\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u3002\u90a3\u4e48\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u65b9\u7a0b\u600e\u4e48\u529e\u5462\uff0c\u6211\u4eec\u5f53\u7136\u53ef\u4ee5\u7279\u6b8a\u5904\u7406\u7b2c\u4e00\u4e2a\u65b9\u7a0b\uff0c\u6c42\u51fa\u5b83\u7684\u89e3\u3002\u8fd8\u6709\u53e6\u4e00\u79cd\u5de7\u5999\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u5c06 $x$ \u4e00\u5f00\u59cb\u7684\u53d6\u503c\u8303\u56f4\u8bbe\u4e3a  $\\mathbb{Z}$\uff0c\u53ea\u9700\u5c06 $M$ \u8bbe\u4e3a $1$\uff0c\u5373 $x=x_0+t*1$  ,\u8fd9\u91cc\u7684 $x_0$ \u5bf9\u7ed3\u679c~~\u5e94\u8be5~~\u6ca1\u6709\u5f71\u54cd\uff0c\u6211\u6d4b\u8bd5\u4e86\u51e0\u4e2a\u4e0d\u540c\u7684\u521d\u503c\u90fd\u80fd\u8fc7\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u5355\u72ec\u5904\u7406\u7b2c\u4e00\u4e2a\u65b9\u7a0b\u4e86\u3002\n\n\n\n**\u57511\uff1a**\n\n\u6ce8\u610f\u6211\u4eec\u8f6c\u5316\u65b9\u7a0b $xb[i]-yp[i]=a[i]$ \u7684\u8fc7\u7a0b\u662f\u6709\u7f3a\u9677\u7684\uff0c\u6839\u636e\u9898\u610f\uff0c\u8fd9\u91cc\u7684 \u653b\u51fb\u6b21\u6570 $x$ \u548c\u56de\u590d\u6b21\u6570 $y$ \u663e\u7136\u90fd\u5e94\u8be5\u662f\u975e\u8d1f\u6570\u800c\u4e14\u6709\u4e00\u5b9a\u9650\u5236\uff0c\u7ffb\u8bd1\u6210\u4eba\u8bdd\u5c31\u662f\u8bf4\u4f60\u780d\u51fa\u6765\u7684\u4f24\u5bb3\u81f3\u5c11\u8981\u5927\u4e8e\u8fd9\u6761\u9f99\u7684\u8840\u91cf\u3002\u518d\u7ffb\u8bd1\u6210\u6570\u5b66\u8bed\u8a00\u5c31\u662f\uff1a\n\n$\\forall i\\ (i\\in \\left [ 1,n \\right ]),xb[i]\\geq a[i]$\n\n\u8f6c\u5316\u4e0d\u7b49\u5f0f\uff1a$x\\geq \\dfrac{a[i]}{b[i]}$\n\n\u6240\u4ee5\u7528`double`\u7c7b\u578b\u8bb0\u5f55\u6700\u5927\u7684 $\\dfrac{a[i]}{b[i]}$\uff0c\u628a\u6700\u540e\u7684\u89e3\u5904\u7406\u4e00\u4e0b\u5373\u53ef\u3002\n\n**\u57512\uff1a**\n\n\u56e0\u4e3a\u6b64\u9898\u6570\u636e\u8303\u56f4\u8f83\u5927\uff0c`long long` \u4f1a\u6ea2\u51fa\uff0c\u6240\u4ee5\u9700\u8981\u5728\u5404\u79cd\u5730\u65b9\u53d6\u6a21\u5e76\u4f7f\u7528\u9f9f\u901f\u4e58\u9632\u6b62\u6ea2\u51fa\u3002\u7531\u4e8e\u6211\u4eec\u8bb0\u5f55\u7684\u4e00\u76f4\u662f\u901a\u89e3\uff0c\u6240\u4ee5 $x_0$ \u7684\u503c\u5e76\u4e0d\u8981\u6c42\u6700\u5c0f\uff0c\u53ea\u662f\u4e3a\u4e86\u907f\u514d\u6ea2\u51fa\u6240\u4ee5\u8ba9 $x_0$ \u6bcf\u6b21\u5bf9 $M$ \u53d6\u6a21\u3002\n\n\n**\u57513\uff1a**\n\n~~\u5c31\u662f\u6211\u4eb2\u8eab\u8e29\u4e8617\u6b21\u7684~~\u6ce8\u610f\u5e73\u8861\u6811\u6bcf\u6b21\u4f1a\u6709\u5269\u4e0b\u7684\u5251\u8fd8\u5728\u6811\u4e2d\uff0c\u6ce8\u610f\u6e05\u7a7a\u3002\n\n---\n\n##### \u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int maxn=1e5+5;\n\nint read(){//\u5feb\u8bfb\n\tint p=0,f=1;\n\tchar c=getchar();\n\twhile(c>'9'||c<'0'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){p=p*10+c-'0';c=getchar();}\n\treturn p*f;\n}\n\n//\u8fd9\u91cc\u6211\u5199\u7684\u662f\u5e73\u8861\u6811\uff0c\u4e5f\u53ef\u4ee5\u7528STL\n//treap-------------------\n#define v(x) kin[x].v\n#define lc(x) kin[x].lc\n#define rc(x) kin[x].rc\n#define siz(x) kin[x].siz\n#define rnd(x) kin[x].rnd\nstruct k{\n\tint v,lc,rc,siz,rnd;\n}kin[2*maxn];\nint rt,cnt;\nint newnode(int x){\n\trnd(++cnt)=rand();\n\tsiz(cnt)=1;\n\tv(cnt)=x;\n\tlc(cnt)=rc(cnt)=0;\n\treturn cnt;\n}\nvoid pushup(int x){\n\tsiz(x)=siz(lc(x))+siz(rc(x))+1;\n}\nint merge(int x,int y){\n\tif(!x||!y)return x|y;\n\tif(rnd(x)<rnd(y)){\n\t\trc(x)=merge(rc(x),y);\n\t\tpushup(x);\n\t\treturn x;\n\t}\n\telse{\n\t\tlc(y)=merge(x,lc(y));\n\t\tpushup(y);\n\t\treturn y;\t\n\t}\n}\nvoid split(int p,int k,int &x,int &y){\n\tif(!p){x=y=0;return ;}\n\tif(v(p)<=k){\n\t\tx=p;\n\t\tsplit(rc(p),k,rc(p),y);\n\t\tpushup(p);\n\t}\n\telse{\n\t\ty=p;\n\t\tsplit(lc(p),k,x,lc(y));\n\t\tpushup(p);\n\t}\n}\nvoid insert(int v){\n\tint x,y,z;\n\tx=y=z=0;\n\tsplit(rt,v,x,z);\n\ty=newnode(v);\n\trt=merge(merge(x,y),z);\n}\nvoid del(int v){\n\tint x,y,z;\n\tx=y=z=0;\n\tsplit(rt,v,x,z);\n\tsplit(x,v-1,x,y);\n\ty=merge(lc(y),rc(y));\n\trt=merge(merge(x,y),z);\t\n}\nint getb(int a){//\u6839\u636e\u9898\u610f\uff0c\u6709\u524d\u9a71\u6c42\u524d\u9a71\uff0c\u6ca1\u6709\u524d\u9a71\u6c42\u540e\u7ee7\n\tint x,y;\n\tx=y=0;\n\tsplit(rt,a,x,y);\n\tif(x){\n\t\tint now=x;\n\t\twhile(rc(now))now=rc(now);\n\t\tnow=v(now);\n\t\trt=merge(x,y);\n\t\tdel(now);\n\t\treturn now;\t\t\n\t}\n\telse{\n\t\tint now=y;\n\t\twhile(lc(now))now=lc(now);\n\t\tnow=v(now);\n\t\trt=merge(x,y);\n\t\tdel(now);\n\t\treturn now;\n\t}\n}\n//treap----------------------------\n\nint exgcd(int a,int b,int &x,int &y){//\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\n\tif(a<b)return exgcd(b,a,y,x);\n\tif(a%b==0){\n\t\tx=0;y=1;\n\t\treturn b;\n\t}\n\telse{\n\t\tint tx,ty;\n\t\tint d=exgcd(b,a%b,tx,ty);\n\t\tx=ty;\n\t\ty=tx-a/b*ty;\n\t\treturn d;\n\t}\n}\nint gsc(int ta,int tb,int mod){//\u9f9f\u901f\u4e58\n\tif(!ta||!tb)return 0;\n\tint ans=0,f=1;\n\tif(ta<0)ta=-ta,f*=-1;\n\tif(tb<0)tb=-tb,f*=-1;\n\tta%=mod;\n\ttb%=mod;\n\twhile(tb){\n\t\tif(tb&1)ans=(ans+ta)%mod;\n\t\tta=(ta+ta)%mod;\n\t\ttb>>=1;\n\t}\n\treturn ans*f;\n}\nint T;\nint n,m;\nint a[maxn],p[maxn],q[maxn],b[maxn];\nint x0,M;\nsigned main(){\n\tT=read();\n\twhile(T--){\n\t\tcnt=0,rt=0;//\u6e05\u7a7a\u5e73\u8861\u6811\n\t\tn=read(),m=read();\n\t\tfor(int i=1;i<=n;i++)\n\t\t\ta[i]=read();\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tp[i]=read();\t\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tq[i]=read();\n\t\tfor(int i=1;i<=m;i++){\n\t\t\tint temp=read();\n\t\t\tinsert(temp);\n\t\t}\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tb[i]=getb(a[i]);\n\t\t\tinsert(q[i]);\n\t\t}//\u9884\u5904\u7406\u6bcf\u6761\u9f99\u7684\u5251\n\t\tx0=0,M=1;\n\t\tint ta,tb,tc,t,y,d,flag=1;\n\t\tdouble mx=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tta=M*b[i],tb=p[i],tc=a[i]-x0*b[i];\n\t\t\td=exgcd(ta,tb,t,y);\n\t\t\tif(tc%d!=0){//\u5224\u65ad\u65e0\u89e3\n\t\t\t\tprintf(\"-1\\n\");\n\t\t\t\tflag=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tta/=d,tb/=d,tc/=d;\n\t\t\tt=(t%tb+tb)%tb;\n\t\t\tx0+=gsc(gsc(tc,t,M*tb),M,M*tb);\n\t\t\tM*=tb;\n\t\t\tx0=(x0%M+M)%M;//\u8fd9\u91cc\u591a\u6b21\u53d6\u6a21\u4e3b\u8981\u4e3a\u4e86\u9632\u6b62\u6ea2\u51fa\n\t\t\tif(double(a[i])/b[i]>mx)\n\t\t\t\tmx=double(a[i])/b[i];\n\t\t}\n\t\twhile(x0<mx)x0+=M;//\u6700\u540e\u5904\u7406\u57511\n\t\tif(flag)\n\t\t\tprintf(\"%lld\\n\",x0);\n\t}\n\treturn 0;\n}\n```\n\n\n---\n\n##### \u9898\u5916\u8bdd\uff1a\n\n~~\u505a\u5b8c\u611f\u89c9\u81ea\u5df1\u5c31\u662f\u5c60\u9f99\u52c7\u58eb\uff0c\u53e6\u5916\u611f\u89c9\u8fd9\u9053\u9898\u5f88\u597d\u7684\u63ed\u793a\u4e86\u5e73\u8861\u6811\u8fd9\u4e00\u5de5\u5177\u4eba\u7684\u4f5c\u7528~~\n\n",
        "postTime": 1621948230,
        "uid": 189496,
        "name": "llmmkk",
        "ccfLevel": 7,
        "title": "P4774 [NOI2018] \u5c60\u9f99\u52c7\u58eb"
    },
    {
        "content": "## \u524d\u7f6e\u77e5\u8bc6\n\n\u5e73\u8861\u6811(\u6216\u8005```multiset<long long>```)\n\n\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\n\n\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\n\n## \u5f00\u59cb\n\n\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e00\u6761\u9f99,\u90fd\u8981\u6740,\u5e76\u4e14\u5168\u90e8\u6309\u987a\u5e8f\u6740\n\n\u6240\u4ee5\u5bf9\u4e8e\u4e00\u6761\u9f99\u7528\u7684\u5251\u53ef\u4ee5O(nlogn)\u5e73\u8861\u6811\u641e\u51fa\u6765(~~STL\u4e0d\u9999??~~)\n\n\u90a3\u4e48\u6211\u4eec\u4fbf\u53ef\u4ee5\u5217\u4e3e\u51fa\u4e00\u5806\u65b9\u7a0b\u7ec4\n\n$\\begin{cases} A_1x\\equiv a_1\\pmod{m_1} \\\\ A_2x\\equiv a_2\\pmod{m_2} \\\\ \\dots \\\\ A_nx\\equiv a_n\\pmod{m_n}\\end{cases} $\n\n\u662f\u4e0d\u662f\u6709\u70b9\u4f3c\u66fe\u76f8\u8bc6?\n\n\u8fd9\u5c31\u662f\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406!!!\n\n\u4f46\u662f\u4ed6\u5e26\u4e86\u7cfb\u6570,\u548b\u529e?\n\n\u6211\u4eec\u5f97\u628a\u5de6\u8fb9$A_i$\u5f04\u65e0\n\n\u90a3\u4e48\n\n$\\because A_ix \\equiv a_i \\pmod{m_n}$\n\n$\\therefore A_ix=a_i-m_nk$\n\n$\\therefore A_ix+m_nk=a_i$\n\n\u8fd9\u5c31\u662f\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\u6a21\u677f\u5457\n\n\u5982\u679c\u65e0\u89e3\u8f93\u51fa ``-1``\n\n\u6211\u4eec\u641e\u51fa$x,k$\u7684\u503c\n\n\u5b9a\u4e49\n$ \\begin{cases} lcm_1=m_1 \\\\ lcm_i=\\operatorname lcm(lcm_{i-1},m_i) \\end{cases} $\n\n\u5f88\u663e\u7136\n$ x $ \u53ef\u4ee5\u52a0\u4e0a\u6216\u51cf\u53bb\u4efb\u610f $ lcm_{i-1} $\n\n\u4e8e\u662f\u6709\u4e86$ x\\equiv x_0+k'lcm_{i-1},k'\\in Z $\n\n\u5373$x\\equiv x_0 \\pmod{lcm_{i-1}} $\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u641e\u51fa\u6765\u4e86\n\n\u8d34\u4e0a\u4ee3\u7801\n\n```\n#include<bits/stdc++.h>\n#define N 100011\n#define ll long long\nusing namespace std;\nmultiset<ll>q;\nint n,m;\ninline ll mul(ll a,ll b,ll mod){\n\tif(b<0)a=-a,b=-b;\n\tll ans(0);\n\twhile(!!b){\n\t\tif(b&1)ans=(ans+a)%mod;\n\t\ta=(a<<1)%mod;\n\t\tb>>=1;\n\t}\n\treturn (ans%mod+mod)%mod;\n}\ninline void exgcd(ll a,ll b,ll &x,ll &y,ll &d){\n\tif(!b){d=a;x=1;y=0;return;}\n\texgcd(b,a%b,y,x,d);\n\ty-=a/b*x;\n}\nll a[N],p[N],c[N];\ninline void init( ){\n\tq.clear( );\n\tscanf(\"%d%d\",&n,&m);\n\tint i;\n\tint op(0);\n\tll g;\n\tfor(i=1;i<=n;++i)\n\tscanf(\"%lld\",&a[i]);\n\tfor(i=1;i<=n;++i)scanf(\"%lld\",&p[i]);\n\tfor(i=1;i<=n;++i)\n\tscanf(\"%lld\",&c[i]);\n\twhile(m--){scanf(\"%lld\",&g);q.insert(g);}\n}\ninline multiset<ll>::iterator find(ll k){\n\tmultiset<ll>::iterator op;\n\top=q.upper_bound(k);\n\tif(op!=q.begin( ))--op;\n\treturn op;\n}\ninline ll gcd(ll a,ll b){\n\treturn !b?a:gcd(b,a%b);\n}\ninline ll ceil(ll a,ll b){\n\treturn (a+b-1)/b;\n}\ninline ll maxx(ll a,ll b){\n\treturn a>b?a:b;\n}\nll X,lcm;\ninline void work( ){\n\tinit( );\n\tint i;\n\tmultiset<ll>::iterator k;\n\tll x,y,d,QWQ(0);\n\tll P,A;\n\tfor(i=1;i<=n;++i){\n\t\tk=find(a[i]);\n\t\texgcd(*k,p[i],x,y,d);\n\t\tif(a[i]%d!=0){puts(\"-1\");return;}\n\t\tQWQ=maxx(QWQ,ceil(a[i],*k));\n\t\tA=mul(x,a[i]/d,p[i]/d);\n\t\tP=p[i]/d;\n\t\tif(i==1){\n\t\t\tlcm=P;\n\t\t\tX=A;\n\t\t}else{\n\t\t\texgcd(lcm,P,x,y,d);\n\t\t\tif((A-X)%d!=0){puts(\"-1\");return;}\n\t\t\tx=mul((A-X)/d,x,P/d);\n\t\t\tll qwq(lcm);\n\t\t\tlcm=lcm/d*P;\n\t\t\tX=(X+(mul(x,qwq,lcm)%lcm+lcm)%lcm)%lcm;\n\t\t}\n\t\tq.erase(k);\n\t\tq.insert(c[i]);\n\t}\n\tif(!X)X=QWQ;\n\tprintf(\"%lld\\n\",X);\n}\nint main( ){\n\tint t;\n//\tfreopen(\"dragon2.in\",\"r\",stdin);\n//\tfreopen(\"ans.out\",\"w\",stdout);\n\tscanf(\"%d\",&t);\n\twhile(t--)work( );\n} \n```",
        "postTime": 1601943579,
        "uid": 117658,
        "name": "Space_Gold_Trash",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "# NOI 2018 \u5c60\u9f99\u52c7\u58eb\n\n*(\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406+exgcd)*\n\n*\u9898\u76ee\u5927\u610f\uff1a\u7565*\n\n\u628a\u53d6\u51fa\u7684\u5b9d\u5251\u653b\u51fb\u529b\u8bbe\u4e3aT\uff0c\u53ef\u5f97\nTi*x=ai(mod pi)\uff0c\u8fd9\u663e\u7136\u662fax=c(mod\nb)\u7684\u5f62\u5f0f\u8fd9\u90e8\u5206\u7528exgcd\u6c42\u89e3x\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3\u5148\u628aa,b,c\u9664\u4ee5gcd(a,b)\uff0c\u5982\u679cc\u4e0d\u80fd\u6574\n\u9664gcd(a,b)\u90a3\u4e48\u65e0\u89e3\u3002\u6b64\u65f6a,b\u4e92\u8d28\uff0c\u7528\nexgcd\u6c42\u5f97a\u7684\u9006\u5143\uff0c\u9006\u5143\u4e58\u56de\u6765gcd(a,b)\u5c31\u662fx\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3\uff0c\u6ce8\u610f\u53ef\n\u80fd\u7206long long\u8981\u7528\u9f9f\u901f\u4e58\u90a3\u4e48\u6b64\u65f6\u6c42\u5f97x\u662f\u4ec5\u4ec5\u5bf9\u4e8e\u8fd9\u4e00\u4e2a\u65b9\u7a0b\u7684\uff0c\u6211\u4eec\u8981\u628a\u5b83\u5e26\u5230excrt\u7684\u677f\u5b50\u4e2d\u6c42\u5f97x\u5173\u4e8e\u6240\u6709\u65b9\u7a0b\u90fd\u6210\u7acb\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3\u5373\u53ef\n\n```cpp\n#include<iostream>  \n#include<cstdio>\n#include<cmath>\n#include<cstring>  \n#include<algorithm>\n#include<set>\nusing namespace std;\ntypedef long long ll;\nconst int maxn = 100005;\nint T, n, m;\nll a[maxn], p[maxn], atk[maxn], sword[maxn];\nvoid upd(ll &x, ll y, ll mod) {\n    if ((x += y) >= mod) {\n        x -= mod;\n    }\n}\nll mult(ll a, ll b, ll mod) {\n    a = (a % mod + mod) % mod;\n    b = (b % mod + mod) % mod;\n    ll res = 0;\n    for (; b; b >>= 1, upd(a, a, mod)) {\n        if (b & 1) {\n            upd(res, a, mod);\n        }\n    }\n    return res;\n}\nll gcd(ll a, ll b) {\n    return b ? gcd(b, a % b) : a;\n}\nvoid exgcd(ll a, ll b, ll &x, ll &y) {\n    if (b == 0) {\n        x = 1, y = 0;\n        return;\n    }\n    exgcd(b, a % b, y, x);\n    y -= a / b * x;\n}\nll inverse(ll a, ll mod) {\n    ll x, y;\n    exgcd(a, mod, x, y);\n    return (x % mod + mod) % mod;\n}\nll excrt(ll *A, ll *B, ll *M, ll &res) {\n    res = 0;\n    ll lcm = 1;\n    for (int i = 1; i <= n; i++) {\n        ll a = mult(A[i], lcm, M[i]);\n        ll b = B[i] - mult(A[i], res, M[i]);\n        ll d = gcd(a, M[i]);\n        if (b % d != 0) {\n            res = -1;\n            return 0;\n        }\n        ll x = mult(b / d, inverse(a / d, M[i] / d), M[i] / d);\n        res += lcm * x, lcm *= M[i] / d;\n    }\n    res = (res % lcm + lcm) % lcm;\n    return lcm;\n}\nint main() {\n    for (scanf(\"%d\", &T); T--; ) {\n        multiset<ll> S;\n        scanf(\"%d %d\", &n, &m);\n        for (int i = 1; i <= n; i++) {\n            scanf(\"%lld\", a + i);\n        }\n        for (int i = 1; i <= n; i++) {\n            scanf(\"%lld\", p + i);\n        }\n        for (int i = 1; i <= n; i++) {\n            scanf(\"%lld\", atk + i);\n        }\n        for (int i = 1; i <= m; i++) {\n            ll x;\n            scanf(\"%lld\", &x);\n            S.insert(x);\n        }\n        ll mx = 0;\n        for (int i = 1; i <= n; i++) {\n            multiset<ll>::iterator it = S.upper_bound(a[i]);\n            if (it != S.begin()) {\n                it--;\n            }\n            sword[i] = (*it), S.erase(it), S.insert(atk[i]);\n            mx = max(mx, (a[i] + sword[i] - 1) / sword[i]);\n        }\n        ll x, lcm = excrt(sword, a, p, x);\n        if (x != -1 && x < mx) {\n            x += lcm * ((mx - x + lcm - 1) / lcm);\n        }\n        printf(\"%lld\\n\", x);\n    }\n    return 0;\n}\n```",
        "postTime": 1538830238,
        "uid": 81176,
        "name": "\u68a6\u90a3\u8fb9\u7684\u7f8e\u597dET",
        "ccfLevel": 8,
        "title": "[NOI2018]\u5c60\u9f99\u52c7\u58eb\u9898\u89e3"
    },
    {
        "content": "\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u3002\n\n\u9996\u5148\uff0c\u53ef\u4ee5\u5148\u9884\u5904\u7406\u51fa\u6740\u6bcf\u6761\u9f99\u65f6\u6240\u7528\u7684\u5251\u3002\u8bbe\u4e3a$q_i$\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5176\u5b9e\u662f\u8fd9\u4e2a\u4e1c\u897f:\n\n$$\\min x(xq_i\\equiv a_i\\pmod{p_i},x\\ge\\lceil\\frac{a_i}{q_i}\\rceil)$$\n\n\u540e\u534a\u90e8\u5206\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7$Chkmax$\u6765\u89e3\u51b3\u3002\u8003\u8651\u6c42\u89e3\u524d\u534a\u90e8\u5206\u3002\n\n\u901a\u8fc7\u7b80\u5355\u7684\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u5b9a\u7406\uff0c\u53ef\u4ee5\u5bf9\u6bcf\u5934\u9f99\u89e3\u51fa$x\\equiv x_i\\pmod{p_i}$\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86$n$\u4e2a\u7ebf\u5f62\u65b9\u7a0b\u7ec4\u3002\u6211\u4eec\u9700\u8981\u5c06\u5b83\u4eec\u5168\u90e8\u5408\u5e76\u3002\n\n\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528$exCRT$\u6765\u89e3\u51b3\uff0c\u4f46\u662f\u5176\u5b9e$exGCD$\u5c31\u53ef\u4ee5\u5408\u5e76\u4e86\u3002\n\n\u5177\u4f53\u65b9\u6cd5:\n\n\u8bbe\u8981\u5408\u5e76\u7684\u4e24\u4e2a\u65b9\u7a0b\u4e3a:\n\n$$x=X+k_1P$$\n\n$$x=x_i+k_2p_i$$\n\n\u90a3\u4e48\uff0c\u76f8\u51cf\u5e76\u79fb\u9879\u5f97:\n\n$$Pk_1-p_ik_2=x_i-X$$\n\n\u901a\u8fc7$exGCD$\u89e3\u51fa$k_1=k_0+z*\\displaystyle\\frac{p_i}{gcd(P,p_i)}$\u3002\n\n\u90a3\u4e48\u56de\u4ee3\u5f97\n\n$$x=X+k_0P+z*\\displaystyle\\frac{Pp_i}{gcd(P,p_i)}$$\n\n\u5373\n\n$$x=X+k_0P+z lcm(P,p_i)$$\n\n\u5176\u4e2d$z$\u4e3a\u4efb\u610f\u6574\u6570\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u6210\u529f\u5c06\u4e24\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\u5408\u5e76\u6210\u4e86\u4e00\u4e2a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\log n)$,\u4f46\u662f\u5927\u90e8\u5206\u60c5\u51b5\u90fd\u8dd1\u4e0d\u6ee1\u3002\u6ce8\u610f\u5224\u65ad\u51fa\u5404\u79cd\u65e0\u89e3\u548c\u7206$long\\ long$\u7684\u60c5\u51b5\u3002\n\n\u4ee3\u7801:\n```cpp\n#include<bits/stdc++.h>\n#include<ext/pb_ds/assoc_container.hpp>\n#define Rep(i,a,b) for(register int i=(a),i##end=(b);i<=i##end;++i)\n#define Repe(i,a,b) for(register int i=(a),i##end=(b);i>=i##end;--i)\n#define For(i,a,b) for(i=(a),i<=(b);++i)\n#define Forward(i,a,b) for(i=(a),i>=(b);--i)\n#define Chkmax(a,b) a=a>b?a:b\ntemplate<typename T>inline void read(T &x)\n{\n\tT f=1;x=0;char c;\n\tfor(c=getchar();!isdigit(c);c=getchar())if(c=='-')f=-1;\n\tfor(;isdigit(c);c=getchar())x=x*10+(c^48);\n\tx*=f;\n}\nusing namespace std;\nvoid file()\n{\n#ifndef ONLINE_JUDGE\n\tfreopen(\"dragon.in\",\"r\",stdin);\n\tfreopen(\"dragon.out\",\"w\",stdout);\n#endif\n}\n\nconst int MAXN=1e5+7;\n\nstatic int n,m;\n\ntypedef long long uint64;\n\nstatic uint64 a[MAXN],p[MAXN],w[MAXN],q[MAXN];\n\nmultiset<uint64>G;\n\ninline void init()\n{\n\tread(n);read(m);\n\tRep(i,1,n)read(a[i]);\n\tRep(i,1,n)read(p[i]);\n\tRep(i,1,n)read(w[i]);\n\tstatic uint64 x;\n\tG.clear();\n\tRep(i,1,m)read(x),G.insert(x);\n\tRep(i,1,n)\n\t{\n\t\tif(*G.begin()>a[i])q[i]=*G.begin(),G.erase(G.begin());\n\t\telse q[i]=*(--G.upper_bound(a[i])),G.erase(G.lower_bound(q[i]));\n\t\tG.insert(w[i]);\n\t}\n}\n\ninline uint64 gcd(uint64 a,uint64 b){return b?gcd(b,a%b):a;}\n\ninline void exGCD(uint64 a,uint64 b,uint64 &x,uint64 &y)\n{\n\tif(!b){x=1,y=0;return;}\n\texGCD(b,a%b,x,y);\n\tswap(x,y),y-=(a/b)*x;\n}\n\nstatic uint64 ans,mx;\n\ninline uint64 ad(uint64 a,uint64 b,uint64 mod){return (a+=b)>=mod?a-mod:a;}\n\ninline uint64 mul(uint64 a,uint64 b,uint64 mod)\n{\n\tuint64 sm;b%=mod;b=ad(b,mod,mod);a%=mod;\n\tfor(sm=0;b;b>>=1,a=ad(a,a,mod))if(b&1)\n\t\tsm=ad(sm,a,mod);\n\treturn sm;\n}\n\ninline void solve()\n{\n\tstatic uint64 c,x,y,P,lcm;mx=0;\n\tRep(i,1,n)\n\t{\n\t\tc=gcd(q[i],p[i]);\n\t\tif(a[i]%c)return (void)puts(\"-1\");\n\t\tp[i]/=c;\n\t\texGCD(q[i]/c,p[i],x,y);\n\t\tx=x%p[i]+p[i];x%=p[i];\n\t\tw[i]=mul(x,a[i]/c,p[i]);\n\t\tChkmax(mx,(a[i]+q[i]-1)/q[i]);\n\t}\n\tP=p[1];ans=w[1];\n\tRep(i,2,n)\n\t{\n\t\tc=gcd(P,p[i]);\n\t\tif((w[i]-ans)%c)return (void)puts(\"-1\");\n\t\tp[i]/=c;\n\t\texGCD(P/c,p[i],x,y);\n\t\tx=x%p[i]+p[i];x%=p[i];\n\t\tx=mul(x,(w[i]-ans)/c%p[i],p[i]);\n\t\tx=x%p[i]+p[i];x%=p[i];\n\t\tlcm=P*p[i];\n\t\tans=(mul(x,P,lcm)+ans)%lcm;\n\t\tP=lcm;\n\t}\n\tif(ans<mx)ans+=P*((mx-ans+P-1)/P);\n\tprintf(\"%lld\\n\",ans);\n}\n\nint main()\n{\n\tfile();\n\tstatic int _;\n\tread(_);\n\twhile(_--)\n\tinit(),\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1532132598,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "### \u3010NOI2018\u3011\u5c60\u9f99\u52c7\u58eb\n\n\u770b\u5230\u5f88\u591a\u5927\u4f6c\u90fd\u662f\u628a\u5e26\u7cfb\u6570\u540c\u4f59\u65b9\u7a0b\u8f6c\u5316\u6210\u4e00\u822c\u5f0f\u518d\u5408\u5e76\u65b9\u7a0b\u7ec4\u554a\u3001\u3001\u9274\u4e8e\u767e\u82b1\u9f50\u653e\u7684\u7cbe\u795e\uff0c\u653e\u4e00\u4e2a\u76f4\u63a5\u5408\u5e76\u6a21\u65b9\u7a0b\u7ec4\u7684\u505a\u6cd5\u3002\n\n\u5173\u4e8e\u7b2c$i$\u5c40\u62ff\u4ec0\u4e48\u5251\u5176\u4ed6\u5927\u4f6c\u8bb2\u7684\u6bd4\u8f83\u6e05\u695a\u4e86\uff0c\u8fd9\u91cc\u4e0d\u8bb2\u7ec6\u8282\u3002\u9884\u5904\u7406\u7b2c$i$\u5c40\u4f1a\u4f7f\u7528\u7684\u5251\u7684\u653b\u51fb\u529b$Atk[i]$,\u89e3\u51b3\u6a21\u7ebf\u6027\u65b9\u7a0b\uff1a\n\n$\\left\\{\\begin{aligned}\nAtk[1]x & \\equiv a[1]\\left(\\bmod n[1]\\right) \\\\\nAtk[1]x & \\equiv a[2]\\left(\\bmod n[2]\\right) \\\\\n& \\vdots \\\\\nAtk[1]x & \\equiv a[k]\\left(\\bmod n[k]\\right)\n\\end{aligned}\\right.$\n\n\u8003\u8651\u4e24\u4e2a\u65b9\u7a0b\u7684\u5408\u5e76\uff1a\n\n$Atk[1]x = a[1] + p*n[1]\\Rightarrow x = \\frac{a[1]+p*n[1]}{Atk[1]}$\n$Atk[2]x = a[2] + q*n[2]\\Rightarrow x = \\frac{a[2]+q*n[2]}{Atk[2]}$\n\n\u5373\u89e3\u5173\u4e8e$(q,p)$\u7684\u4e0d\u5b9a\u65b9\u7a0b$n[1]*Atk[2]*p - n[2]*Atk[1]*q = a[2]*Atk[1] - a[1]*Atk[2]$\n\n\u4ee4$a = n[1]*Atk[2],b = - n[2]*Atk[1],c = a[2]*Atk[1] - a[1]*Atk[2]$\n\n$ap+bq = c$\u89e3\u5f97\u4e00\u7ec4\u7279\u89e3$(q',p')$\uff0c\uff08\u5f53\u7136\u524d\u63d0$d=gcd(a,b)|c$\uff09\n\n\u5c06$p'$\u5e26\u56de\u539f\u5f0f\uff0c$Atk[1]x = a[1] + p'* n[1]$\uff0c\u7531\u4e8e$p'$\u7684\u901a\u89e3\u6700\u5c0f\u6b63\u95f4\u8ddd\u4e3a$b/d$\uff0c\u6545$Atk[1]x$\u6700\u5c0f\u6b63\u95f4\u8ddd\u4e3a$n[1]*b/d\u3002$\n\n\u5f97$Atk[1]x\\equiv a[1]+p'*n[1](\\%(n[1]*b/d))$\n\n\u82e5\u5e72\u5f0f\u5b50\u5408\u5e76n-1\u6b21\u5373\u53ef\u3001\u3001\n\n\u6700\u540e\u5f97\u5230$Atk[1]x\\equiv a[1](\\%n[1])$\uff08\u7a0b\u5e8f\u4e2d\u4e60\u60ef\u5c06$j\\in[2,n]$\u7684\u5f0f\u5b50\u4e0e\u5f0f\u5b501\u5408\u5e76\uff0c\u7ed3\u679c\u5b58\u5728$a[1]$\u4e0e$n[1]$\uff09\uff0c\u540c\u4f59\u65b9\u7a0b\u8f6c\u5316\u4e3a$Atk[1]*x+n[1]*y = a[1]$,\u5957\u4e00\u4e2aexgcd\u6c42\u4e00\u4e2a\u975e\u8d1f\u7279\u89e3\uff08\u4e25\u683c\u610f\u4e49\u4e0a\u662f$x\\geq mi,mi = max(\\left\\lceil \\frac{a[1]}{Atk[1]}\\right\\rceil$,\u4f46\u6570\u636e\u80fd\u6c34\u8fc7\uff09\u3001\u3001\n\n\u5bf9\u4e86\uff0c\u8fd8\u6709\u7279\u5224\u3001\u3001\u5355\u770b\u4e00\u6761\u65b9\u7a0b\uff0c\u8fd9\u9053\u9898\u5728\u53d6\u6a21\u524d\u5148\u60f3\u6e05\u695a\u6761\u4ef6\uff0c$Atk[1]*x - k*n[1] = a[1]\\Rightarrow Atk[1] * x\\equiv a[1](\\%n[1])$\uff0c\u5982\u679c\u4e0d\u4fdd\u8bc1$a[1]\\leq n[1],$\u5219\u4f1a\u51fa\u73b0\u653b\u51fbx\u6b21\u540e\u8840\u6761\u5e76\u65e0\u53d8\u975e\u6b63\uff0c\u800c\u5b58\u5728\u6062\u590d\u81f30\u7684\u60c5\u51b5\uff0c\u6545\u6570\u636e\u5f97\u4fdd\u8bc1$a[1]\\leq n[1]$\u3002\u597d\u5728$a[1]>n[1]$\u7684\u60c5\u51b5\u7684\u6570\u636e\u90fd\u6709$n[1]=1$,\u5219\u7b54\u6848\u4e3a$x = max(\\left\\lceil \\frac{a[1]}{Atk[1]}\\right\\rceil)$\n\n\u6700\u540e\u653e\u4e2a\u4ee3\u7801\u3001\u3001\n\n```cpp\n//code sourced from kinesis\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define _REP(i,a,b) for(int i = (a) ; i >= (int)(b) ; --i )\n#define REP(i,a,b) for(int i = (a) ; i <= (int)(b) ; ++i )\n#define UREP(i,u) for(int i = p[(u)] ; i + 1 ; i = edge[i].next)\n//iterator: for(int u:x),x is container\n#define x(p) (p).first\n#define y(p) (p).second\n#define pii pair<int,int>\n#define mp(x,y) make_pair((x), (y))\n#define ll long long\n#define ull unsigned long long\nconst int inf = 0x3f3f3f3f;\nconst ll inff = 0x3f3f3f3f3f3f3f3f;\nconst int mod = 998244353;\nconst double eps = 1e-9;\n#define mem(x,v) memset((x), (v), sizeof (x))\n#define ri1(x) scanf(\"%d\", &(x))\n#define ri2(x,y) scanf(\"%d%d\", &(x), &(y))\n#define ri3(x,y,z) scanf(\"%d%d%d\", &(x), &(y), &(z))\n#define ri4(a,b,c,d) scanf(\"%d%d%d%d\", &(a), &(b), &(c), &(d))\n#define pi1(a) printf(\"%d\\n\", (a))\n#define pi2(a,b) printf(\"%d%d\\n\", (a), (b))\n//#define Debug\n#ifdef Debug\n#endif // debug\nconst int maxn = 1e5 + 5;\n\nnamespace ExCRT\n{\n    __int128 ex_gcd(__int128 a, __int128 b, __int128& x, __int128& y)\n    {\n        if (b == 0) {\n            x = 1;\n            y = 0;\n            return a;\n        }\n        __int128 d = ex_gcd(b, a % b, x, y);\n        __int128 temp = x;\n        x = y;\n        y = temp - a / b * y;\n        return d;\n    }\n    bool liEu(__int128 a, __int128 b, __int128 c, __int128& x, __int128& y)\n    {\n        __int128 d = ex_gcd(a, b, x, y);\n        if (c % d != 0) return 0;\n        __int128 k = c / d;\n        x *= k;//\u5f97\u5230\u7ec4\u7279\u89e3\uff0c\u6c42\u6700\u5c0f\u975e\u8d1f\u6574\u6570\uff0c\u5219$x = (x % (b / d) + b / d) % (b / d)$\n        x = (x % (b / d) + b / d) % (b / d);\n        y *= k;\n        return 1;\n    }\n    __int128 a[maxn],n[maxn],N,Atk[maxn];\n    __int128 ex_CRT()\n    {\n        REP(i,2,N){\n            __int128 x,y;\n            if(!liEu(n[1]*Atk[i],-(n[i]*Atk[1]),Atk[1]*a[i]-Atk[i]*a[1],x,y)) return -1;\n            __int128 lcm = n[1] * n[i] * Atk[1] / __gcd(n[1] * Atk[i],n[i] * Atk[1]);\n            (a[1] = a[1] + n[1] * x) %= lcm;\n            n[1] = lcm;\n        }\n        __int128 x,y;\n        if(!liEu(Atk[1],n[1],a[1],x,y)) return -1;\n        return x;\n    }\n}\n\n__int128 read()\n{\n   __int128 X=0,w=0; char ch=0;\n   while(!isdigit(ch)) {w|=ch=='-';ch=getchar();}\n   while(isdigit(ch)) X=(X<<3)+(X<<1)+(ch^48),ch=getchar();\n   return w?-X:X;\n}\n\nvoid print(__int128 x)\n{\n   if(x<0){putchar('-');x=-x;}\n   if(x>9) print(x/10);\n   putchar(x%10+'0');\n}\n\n__int128 mi;\nll wp[maxn];\nmultiset<ll> S;\n\nint main()\n{\n    #ifndef ONLINE_JUDGE\n    freopen(\"in.txt\",\"r\",stdin);//cf needn't delete this\n    #endif // ONLINE_JUDGE\n    int T;\n    ri1(T);\n    while(T--){\n        S.clear();\n        mi = 0;//mi\u662f\u6700\u5c0f\u9700\u653b\u51fb\u7684\u6b21\u6570\n        int N,m,flag = 0;\n        ri2(N,m);\n        ExCRT::N = N;\n        REP(i,1,N) ExCRT::a[i] = read();\n        REP(i,1,N) ExCRT::n[i] = read(),flag |= (ExCRT::n[i] != 1);\n        REP(i,1,N) wp[i] = read();\n        ll x;\n        REP(i,1,m) scanf(\"%lld\",&x),S.insert(x);\n        REP(i,1,N){//\u9884\u5904\u7406Atk[]\n            multiset<ll>::iterator it = S.upper_bound(ExCRT::a[i]);\n            if(it!=S.begin()) it--;\n            ExCRT::Atk[i] = *it;\n            S.erase(it);\n            mi = max(mi,ExCRT::a[i] / ExCRT::Atk[i] + (ExCRT::a[i] % ExCRT::Atk[i] > 0));\n            S.insert(wp[i]);\n        }\n        if(!flag){print(mi),printf(\"\\n\");continue;}\n        REP(i,1,N) if(ExCRT::a[i]==ExCRT::n[i]) ExCRT::Atk[i] = 1,ExCRT::a[i] = 0,ExCRT::n[i] = 1;\n        __int128 ans = ExCRT::ex_CRT();\n        print(ans),printf(\"\\n\");\n    }\n    return 0;\n}\n```\n\n\u90e8\u5206\u601d\u8def\u53c2\u8003\u6d1b\u8c37\u5927\u4f6c\uff0c\u5728\u6b64%%%",
        "postTime": 1593441173,
        "uid": 132396,
        "name": "Kinesis",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u6628\u5929\u665a\u4e0a\u5feb\u8d70\u65f6\u770b\u4e86\u8fd9\u9898\uff1a\u4e0d\u662fexgcd+excrt\u5417\uff1f  \n\u65c1\u8fb9\u5f20\u5927\u4f6c\u9ed8\u9ed8\u770b\u4e86\u6211\u4e00\u773c(\u89c9\u5f97\u6211\u4f1a\u6b7b)  \n\u7136\u540e\u4e8e\u662f\u6211\u4eca\u5929\u4e2d\u5348\u624d\u8c03\u51fa\u6765Orz\n\n ***\n\n### \u601d\u8def\uff1aexgcd+excrt\n### \u63d0\u4ea4\uff1a5\u6b21\n#### \u9519\u56e0\uff1a\u9f9f\u901f\u4e58\u4f20\u8fdb\u53bb\u4e86\u8d1f\u6570\uff0c\u5e76\u4e14\u7528\u7684int\uff1b\u4e4b\u524d\u5199\u8fc7\u7684excrt\u7684\u677f\u5b50\u6709\u95ee\u9898\n### \u9898\u89e3\uff1a\n\u5148\u8981\u7279\u5224\u4e00\u79cd\u60c5\u51b5\uff1a\u82e5 $p[i]=1$ \uff0c\u7b54\u6848\u663e\u7136\u5c31\u662f $\\max(\\lceil\\frac{a[i]}{stk[i]}\\rceil)$ \uff0c\u53ea\u9700\u8981\u628a\u9f99\u6253\u6210\u8d1f\u8840\u4ed6\u5c31\u6b7b\u4e86\u3002\n\n\u5148\u662f\u8fd9\u6837\u7684\u4e00\u4e9b\u65b9\u7a0b\uff1a\u8bbe $atk[i]$ \u8868\u793a\u5bf9\u4e8e\u7b2c $i$ \u53ea\u9f99\u4f7f\u7528\u653b\u51fb\u529b\u4e3a $atk[i]$ \u7684\u5251\n$$atk[i]*x_i \\equiv a[i] \\mod p[i] $$\n\u597d\u7684\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5 exgcd \u89e3\u51fa $X_i=x_i*\\frac{a[i]}{gcd(atk[i],p[i])}$  \n\n\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u4e0a\u9762\u7684\u65b9\u7a0b\u6765\u8bf4\uff0c$X_i+k*\\frac{p[i]}{gcd(atk[i],p[i])},k\\in Z$  \n\n\u8bbe $b[i]=\\frac{p[i]}{gcd(atk[i],p[i])}$ ,\u6240\u4ee5\u5bf9\u4e8e\u6700\u7ec8\u7b54\u6848$ans$\u6709\uff1a\n$$ans\\equiv X_i \\mod b[i]$$\n\u8fd9\u4e2a $ans$ \u662f\u53ef\u4ee5\u7528 excrt \u5408\u5e76\u7684\u3002\n## \u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define R register int\nusing namespace std;\nnamespace Luitaryi {\ntemplate<class I> inline I g(I& x) { x=0; register I f=1;\n\tregister char ch; while(!isdigit(ch=getchar())) f=ch=='-'?-1:f;\n\tdo x=x*10+(ch^48); while(isdigit(ch=getchar())); return x*=f;\n} \ntemplate<class I> inline I ps(I x) { if(x<0) putchar('-'),x=-x;\n\tstatic char s[40]; register int sz=0; \n\twhile(x!=0) s[++sz]=x%10,x/=10; \n\twhile(sz) putchar(s[sz]+'0'),--sz;\n}\nconst int N=100010;\ninline ll exgcd(ll& x,ll& y,ll a,ll b) {\n\tif(!b) {x=1,y=0; return a;} \n\tregister ll d=exgcd(y,x,b,a%b); y-=a/b*x; \n\treturn d;\n}\nint T,n,m;\nll s[N],b[N],c[N],a[N],mx;\nmultiset<ll> ss; bool flg;\nmultiset<ll>::iterator it;\ninline ll mul(ll a,ll b,ll p) { register ll ret=0; \n\tfor(;b;b>>=1,a=(a+a)%p) if(b&1) ret=(ret+a)%p; \n\tret=(ret+p)%p; return ret;\n}\ninline void main() { \n\tg(T); while(T--) { mx=0,flg=true;\n    register ll ans=0,sum=1,x,y;\n\t\tg(n),g(m); for(R i=1;i<=n;++i) g(s[i]);\n\t\tfor(R i=1;i<=n;++i) g(b[i]),flg&=b[i]==1;\n\t\tfor(R i=1;i<=n;++i) g(c[i]);\n\t\tfor(R i=1;i<=m;++i) g(x),ss.insert(x);\n\t\tfor(R i=1;i<=n;++i) {\n\t\t\tit=ss.upper_bound(s[i]);\n\t\t\tif(it!=ss.begin()) --it; \n\t\t\ta[i]=*it,ss.erase(it),ss.insert(c[i]);\n\t\t\tmx=max((s[i]+a[i]-1)/a[i],mx);\n\t\t} if(flg) { \n\t\t\tprintf(\"%lld\\n\",mx);\n\t\t\tgoto end;\n\t\t}\n\t\tfor(R i=1;i<=n;++i) { register ll x,y;\n\t\t\tregister ll d=exgcd(x,y,a[i],b[i]);\n\t\t\tif(s[i]%d) {puts(\"-1\"); goto end;}\n\t\t\tb[i]/=d,x=(x%b[i]+b[i])%b[i]; \n\t\t\ts[i]=mul(x,((s[i]/d)%b[i]+b[i])%b[i],b[i]);\n\t\t}\n\t\tfor(R i=1;i<=n;++i) {\n\t\t\tregister ll d=exgcd(x,y,sum,b[i]);\n\t\t\tif((s[i]-ans)%d) {puts(\"-1\"); goto end;}\n\t\t\tb[i]/=d; \n\t\t\tx=mul(x,((s[i]-ans)/d%b[i]+b[i])%b[i],b[i]);\n\t\t\tans+=x*sum,sum=sum*b[i];\n\t\t} printf(\"%lld\\n\",(ans%sum+sum)%sum);\n\t\tend:ss.clear();\n\t}\n}\n} signed main() {Luitaryi::main(); return 0;}\n```\n***\n2019.09.03  \n66",
        "postTime": 1567487961,
        "uid": 115086,
        "name": "Tari",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "### excrt\u6a21\u677f\u9898\n\n\u4f7f\u7528$multset$\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u6bcf\u6b21\u780d\u9f99\u7684\u5251\u662f\u54ea\u4e00\u628a\u3002\n\n\u8fd9\u6837\u95ee\u9898\u5c31\u6bd4\u8f83\u8f6c\u5316\u6210\u4e86\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\uff1a\n\n$$a_i \u2261 b_i (mod\\ c_i)$$\n\n\u6c42\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3$x$\u3002\n\n\u6ce8\u610f\u5230\u5b58\u5728$a_i>c_i$\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u6c42\u51fa\u6765\u7684\u89e3\u53ef\u80fd\u4e0d\u7b26\u5408\u9898\u610f\u3002\n\n\u89c2\u5bdf\u4e00\u6ce2\u6570\u636e\u8303\u56f4\uff0c\u53d1\u73b0\u53ea\u6709$c_i=1$\u65f6\uff0c\u624d\u5b58\u5728$a_i>c_i$\u7684\u60c5\u51b5\u3002\u7b54\u6848\u5373\u4e3a\uff1a\n\n$$max_{1\u2264i\u2264n}\\{\\lceil \\frac{b_i}{a_i} \\rceil\\}$$\n\n\u7ecf\u8fc7\u4e0a\u8ff0\u5904\u7406\u540e\uff0c\u6b64\u9898\u5c31\u6210\u4e3a\u4e86\u4e00\u4e2a\u677f\u5b50\u9898\u3002\n\n\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6b63\u5728\u5904\u7406\u7b2c$i$\u4e2a\u65b9\u7a0b\uff0c\u5e76\u4e14\u5df2\u7ecf\u6c42\u51fa\u524d$i-1$\u4e2a\u65b9\u7a0b\u7684\u901a\u89e3\u4e3a\uff1a$x+km$\u3002\uff08\u6700\u5f00\u59cb\u7684$x,m$\u53ef\u4ee5\u8bbe\u4e3a$0,1$\uff09\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u662f\u8981\u6c42\uff1a$a_i(x+km) \u2261 b_i (mod\\ c_i)$\n\n\u62c6\u5f00\u540e\u79fb\u9879\uff1a$a_im * k \u2261 b_i - a_ix (mod\\ c_i)$\n\n\u5f0f\u5b50\u4e2d\u552f\u4e00\u7684\u672a\u77e5\u9879\u5c31\u662f$k$\uff0c\u4ee4\uff1a$A=a_im,\\ B = b_i-a_ix,\\ C = c_i$\n\n\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u662f\u6c42\u540c\u4f59\u65b9\u7a0b\uff1a$Ak \u2261 B (mod\\ C)$\n\n\u5373\u4e0d\u5b9a\u65b9\u7a0b\uff1a$Ak = B + Cy\\  =>\\  Ak - Cy = B$\n\n\u7528$exgcd$\u6c42\u89e3\u5373\u53ef\uff08\u505a\u8fd9\u9898\u7684\u4eba\u5e94\u8be5\u90fd\u4f1a\u5427\uff09\n\n\u5982\u679c\u6b64\u4e0d\u5b9a\u65b9\u7a0b\u65e0\u89e3\uff0c\u5219\u8bf4\u660e\u6574\u4e2a\u65b9\u7a0b\u7ec4\u65e0\u89e3\u3002\n\n\u663e\u7136\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(nlogn)$\u7684\u3002\n\n#### \u51e0\u4e2a\u5751\u70b9\uff1a\n\n\u4e58\u6cd5\u53ef\u80fd\u4f1a\u7206$long\\ long$\uff0c\u5199\u4e00\u4e2a\u9f9f\u901f\u4e58\u5373\u53ef\u3002\n\n\u6211\u4eec\u89e3\u51fa\u6765\u7684$x$\u662f\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3\uff0c\u6240\u4ee5\u8981\u7279\u5224\u4e00\u4e0b$x$\u662f\u5426\u4e3a0\n\n#### \u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\nconst int MAXN = 100010;\n\nint T, n, m;\nint val[MAXN], atk[MAXN];\nint a[MAXN], b[MAXN], c[MAXN];\nmultiset<int> S;\n\nvoid init()\n{\n    S.clear(); multiset<int>:: iterator it;\n    for(int i = 1; i <= m; ++i) S.insert(atk[i]);\n    for(int i = 1; i <= n; ++i)\n    {\n        it = S.upper_bound(b[i]);\n        if(it != S.begin()) --it;\n        a[i] = *it; S.erase(it); S.insert(val[i]);\n    }\n}\n\nint mul(int a, int b, int p)\n{\n    a = (a % p + p) % p, b = (b % p + p) % p;\n    int ans = 0;\n    for(; b; b >>= 1)\n    {\n        if(b & 1) ans = (ans + a) % p;\n        a = (a + a) % p; \n    }\n    return ans;\n}\n\nint exgcd(int a, int b, int &x, int &y)\n{\n    int d;\n    if(b) d = exgcd(b, a % b, y, x), y -= a / b * x;\n    else x = 1, y = 0, d = a;\n    return d;\n}\n\nint solve()\n{\n    int x = 0, m = 1, A, B, C, D, X, Y;\n    for(int i = 1; i <= n; ++i)\n    {\n        if(c[i] == 1) {x = max(x, (b[i] % a[i] ? b[i] / a[i] + 1 : b[i] / a[i])); continue;}\n        A = a[i] * m % c[i], B = ((b[i] - a[i] * x) % c[i] + c[i]) % c[i], C = c[i];\n        D = exgcd(A, C, X, Y); if(B % D) return -1; C /= D;\n        X = mul(X, B / D, C); x += X * m; m *= C; x %= m;\n    }\n    return (x ? x : m);\n}\n\nsigned main()\n{\n    scanf(\"%lld\", &T);\n    while(T--)\n    {\n        scanf(\"%lld %lld\", &n, &m);\n        for(int i = 1; i <= n; ++i) scanf(\"%lld\", &b[i]);\n        for(int i = 1; i <= n; ++i) scanf(\"%lld\", &c[i]);\n        for(int i = 1; i <= n; ++i) scanf(\"%lld\", &val[i]);\n        for(int i = 1; i <= m; ++i) scanf(\"%lld\", &atk[i]);\n        init(); printf(\"%lld\\n\", solve());\n    }\n    return 0;\n}\n```",
        "postTime": 1561431902,
        "uid": 70076,
        "name": "Aegir",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u53d1\u73b0\u597d\u50cf\u90fd\u662f\u5316\u6389\u7cfb\u6570\u4e4b\u540e\u5957\u4e0a$ExCrt$\u7684\u677f\u5b50\n\n\u8fd9\u597d\u50cf\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u6269\u5c55\u6269\u5c55\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\n\n\u6211\u4eec\u8981\u5904\u7406\u7684\u65b9\u7a0b\u662f\u8fd9\u6837\u7684\u5f62\u5f0f\n\n$$c_ix\\equiv b_i(mod\\ a_i)$$\n\n\u5176\u4e2d$c$\u7528\u4e00\u4e2a$std::multiset$\u5904\u7406\u5c31\u597d\u4e86\n\n\u597d\u50cf\u4e0d\u662f\u666e\u901a$excrt$\u53ef\u4ee5\u5904\u7406\u7684\u5f62\u5f0f\u554a\n\n\u601d\u8003\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u7a0b\u7684\u672c\u8d28\u662f\u4ec0\u4e48\uff0c$c_ix=k_ia_i+b_i$\n\n\u6240\u4ee5\u5982\u679c\u6211\u4eec\u6709\u4e24\u4e2a\u65b9\u7a0b\n\n$$c_1x\\equiv b_1(mod\\ a_1)$$\n\n$$c_2x\\equiv b_2(mod\\ a_2)$$\n\n\u6211\u4eec\u9700\u8981\u50cf$crt$\u90a3\u6837\u5408\u5e76\u8d77\u6765\n\n\u6211\u4eec\u5f00\u59cb\u5316\u67ff\u5b50\u4e86\n\n$$x=\\frac{k_1a_1+b_1}{c_1}=\\frac{k_2a_2+b_2}{c_2}$$\n\n\u6240\u4ee5\u5c31\u6709\n\n$$a_2c_1k_2+b_2c_1=a_1c_2k_1+b_1c_2$$\n\n$$a_2c_1k_2=a_1c_2k_1+b_1c_2-b_2c_1$$\n\n\u6839\u636e\u8d1d\u7956\u5b9a\u7406\uff0c\u8fd9\u4e2a\u65b9\u7a0b\u6709\u89e3\u6761\u4ef6\u662f$gcd(a_2c_1,a_1c_2)|(b_1c_2-b_2c_1)$\n\n\u5982\u679c\u6709\u89e3\u7684\u8bdd\uff0c\u6211\u4eec\u8bbe$t=gcd(a_2c_1,a_1c_2)$\uff0c\u4e24\u8fb9\u9664\u4ee5$t$\n\n$$\\frac{a_2c_1k_2}{t}=\\frac{a_1c_2k_1}{t}+\\frac{b_1c_2-b_2c_1}{t}$$\n\n\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u5199\u6210\u4e00\u4e2a\u540c\u4f59\u5f0f\n\n$$\\frac{a_2c_1k_2}{t}\\equiv \\frac{b_1c_2-b_2c_1}{t}\\ (mod\\ \\frac{a_1c_2}{t})$$\n\n\u4e4b\u540e\u8bbe$inv=(\\frac{a_2c_1}{t},\\frac{a_1c_2}{t})$\uff0c\u5373$\\frac{a_2c_1}{t}$\u5728$mod$ $\\frac{a_1c_2}{t}$\u610f\u4e49\u4e0b\u7684\u4e58\u6cd5\u9006\u5143\n\n\u4e24\u8fb9\u4e58\u4ee5$inv$\n\n$$k_2\\equiv inv*\\frac{b_1c_2-b_2c_1}{t}\\ (mod\\ \\frac{a_1c_2}{t})$$\n\n\u6539\u5199\u6210\u7b49\u5f0f\n\n$$k_2= inv*\\frac{b_1c_2-b_2c_1}{t}+y\\times\\frac{a_1c_2}{t}$$\n\n\u6211\u4eec\u628a$k_2$\u56de\u5e26\u5230$c_2x=k_2a_2+b_2$\n\n$$c_2x=inv*\\frac{b_1c_2-b_2c_1}{t}*a_2+y\\times\\frac{a_1c_2a_2}{t}+b_2$$\n\n\u518d\u6539\u5199\u6210\u540c\u4f59\u5f0f\n\n$$c_2x\\equiv inv*\\frac{b_1c_2-b_2c_1}{t}\\%(\\frac{a_1c_2}{t})*a_2+b_2(mod\\ \\frac{a_1c_2a_2}{t})$$\n\n\u6211\u4eec\u53ea\u9700\u8981\u987a\u6b21\u5408\u5e76\u8fd9\u4e9b\u65b9\u7a0b\u5c31\u597d\u4e86\uff0c\u4e00\u65e6\u51fa\u73b0\u65e0\u89e3\u5c31\u8f93\u51fa$-1$\u597d\u4e86\n\n\u4e00\u4e2a\u5751\u70b9\u662f$a=1$\u65f6\u89e3\u51fa\u6765\u4f1a\u662f$0$\uff0c\u597d\u50cf\u548c\u5b9e\u9645\u8981\u6c42\u4e0d\u592a\u4e00\u6837\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u6837\u60c5\u51b5\u76f4\u63a5\u6a21\u62df\u7279\u5224\u5c31\u597d\u4e86\n\n\u4e4b\u540e\u56e0\u4e3a\u975e\u5e38\u7684\u61d2\u6ca1\u7528\u5feb\u901f\u4e58\uff0c\u7528\u4e86__int128\n\n\u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<set>\n#define re register\n#define maxn 100005\n#define LL __int128\n#define min(a,b) ((a)<(b)?(a):(b))\n#define INF 9999999999999\n#define max(a,b) ((a)>(b)?(a):(b))\n#define set_it std::multiset<LL>::iterator\nstd::multiset<LL> s;\nint n,m;\nLL a[maxn],b[maxn],c[maxn],res[maxn];\nLL gcd(LL a,LL b){ return !b?a:gcd(b,a%b);}\nLL exgcd(LL a,LL b,LL &x,LL &y)\n{\n\tif(!b) return x=1,y=0,a;\n\tLL r=exgcd(b,a%b,y,x);\n\ty-=a/b*x;\n\treturn r;\n}\ninline LL pre(LL x)\n{\n\ts.insert(x);\n\tset_it i=s.find(x);\n\tif(i==s.begin()) return -INF;\n\t--i;return *i;\n}\ninline void del(LL x)\n{\n\tset_it i=s.find(x);\n\ts.erase(i);\n}\ninline int check(LL x)\n{\n\tif(s.find(x)!=s.end()) return 1;\n\treturn 0;\n}\ninline LL read()\n{\n\tchar c=getchar();\n\tLL x=0;\n\twhile(c<'0'||c>'9') c=getchar();\n\twhile(c>='0'&&c<='9')\n\t\tx=(x<<3)+(x<<1)+c-48,c=getchar();\n\treturn x;\n}\ninline LL inv(LL a,LL b)\n{\n\tLL x,y;\n\tLL r=exgcd(a,b,x,y);\n\treturn (x%b+b)%b;\n}\nvoid write(LL x)\n{\n    if(x>9) write(x/10);\n    putchar(x%10+48);\n}\ninline LL did(LL a,LL b)\n{\n\tif(a%b==0) return a/b;\n\treturn a/b+1;\n}\ninline void tepan()\n{\n\tLL ans=0;\n\tfor(re int i=1;i<=n;i++)\n\t\tans=max(ans,did(b[i],c[i]));\n\twrite(ans),puts(\"\");\n}\ninline void solve()\n{\n\ts.clear();\n\tLL x;\n\tint flag=0;\n\tn=read(),m=read();\n\tfor(re int i=1;i<=n;i++) b[i]=read();\n\tfor(re int i=1;i<=n;i++) a[i]=read(),flag|=(a[i]!=1);\n\tfor(re int i=1;i<=n;i++) res[i]=read();\n\tfor(re int i=1;i<=m;i++) x=read(),s.insert(x);\n\tfor(re int i=1;i<=n;i++)\n\t{\n\t\tif(check(b[i])) c[i]=b[i],del(b[i]);\n\t\telse\n\t\t{\n\t\t\tLL now=pre(b[i]);\n\t\t\tdel(b[i]);\n\t\t\tif(now==-INF)\n\t\t\t{\n\t\t\t\tset_it it=s.begin();\n\t\t\t\tc[i]=*it;\n\t\t\t\ts.erase(it);\n\t\t\t}\n\t\t\telse c[i]=now,del(now);\n\t\t}\n\t\ts.insert(res[i]);\n\t}\n\tif(!flag)\n\t{\n\t\ttepan();\n\t\treturn;\n\t}\n\tLL a1=a[1],b1=b[1],c1=c[1];\n\tfor(re int i=2;i<=n;i++)\n\t{\n\t\tLL a2=a[i],b2=b[i],c2=c[i];\n\t\tLL r=gcd(c2*a1,c1*a2);\n\t\tif((b1*c2-b2*c1)%r) \n\t\t{\n\t\t\tputs(\"-1\");\n\t\t\treturn;\n\t\t}\n\t\tif((c2*a1/r)<(c1*a2/r)) std::swap(a1,a2),std::swap(b1,b2),std::swap(c1,c2);\n\t\tLL P=a1*c2/r,Inv=inv(c1*a2/r,a1*c2/r);\n\t\tb1=((Inv*(((b1*c2-b2*c1)/r)%P+P)%P*a2))+b2;\n\t\ta1=a1*a2*c2/r;\n\t\tc1=c2;\n\t}\n\tLL y;\n\tif(b1%gcd(a1,c1))\n\t{\n\t\tputs(\"-1\");\n\t\treturn;\n\t}\n\tLL r=exgcd(c1,a1,x,y);\n\tLL t=a1/r;\n\tx=(x*(b1/r)%t+t)%t;\n\twrite(x);\n\tputs(\"\");\n}\nint main()\n{\n\tint T;\n\tT=read();\n\twhile(T--) solve();\n\treturn 0;\n}\n```",
        "postTime": 1542617282,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "[\u53ef\u4ee5\u5230\u6211\u7684blog\u4e2d\u9605\u8bfb](https://www.cnblogs.com/suxxsfe/p/12683280.html)  \n\n[P4774 [NOI2018]\u5c60\u9f99\u52c7\u58eb](https://www.luogu.com.cn/problem/P4774)  \n**exCRT**  \n\n# \u9898\u76ee\u63cf\u8ff0  \n\u5c0f D \u6700\u8fd1\u5728\u7f51\u4e0a\u53d1\u73b0\u4e86\u4e00\u6b3e\u5c0f\u6e38\u620f\u3002\u6e38\u620f\u7684\u89c4\u5219\u5982\u4e0b\uff1a  \n\n- \u6e38\u620f\u7684\u76ee\u6807\u662f\u6309\u7167\u7f16\u53f7 $1 \\rightarrow n$ \u987a\u5e8f\u6740\u6389 $n$ \u6761\u5de8\u9f99\uff0c\u6bcf\u6761\u5de8\u9f99\u62e5\u6709\u4e00\u4e2a\u521d\u59cb\u7684\u751f\u547d\u503c $a_i$\u3002\u540c\u65f6\u6bcf\u6761\u5de8\u9f99\u62e5\u6709\u6062\u590d\u80fd\u529b\uff0c\u5f53\u5176\u4f7f\u7528\u6062\u590d\u80fd\u529b\u65f6\uff0c\u5b83\u7684\u751f\u547d\u503c\u5c31\u4f1a\u6bcf\u6b21\u589e\u52a0 $p_i$\uff0c\u76f4\u81f3\u751f\u547d\u503c\u975e\u8d1f\u3002\u53ea\u6709\u5728\u653b\u51fb\u7ed3\u675f\u540e\u4e14\u5f53\u751f\u547d\u503c**\u6070\u597d**\u4e3a $0$ \u65f6\u5b83\u624d\u4f1a\u6b7b\u53bb\u3002  \n\n- \u6e38\u620f\u5f00\u59cb\u65f6\u73a9\u5bb6\u62e5\u6709 $m$ \u628a\u653b\u51fb\u529b\u5df2\u77e5\u7684\u5251\uff0c\u6bcf\u6b21\u9762\u5bf9\u5de8\u9f99\u65f6\uff0c\u73a9\u5bb6\u53ea\u80fd\u9009\u62e9\u4e00\u628a\u5251\uff0c\u5f53\u6740\u6b7b\u5de8\u9f99\u540e\u8fd9\u628a\u5251\u5c31\u4f1a\u6d88\u5931\uff0c\u4f46\u4f5c\u4e3a\u5956\u52b1\uff0c\u73a9\u5bb6\u4f1a\u83b7\u5f97\u5168\u65b0\u7684\u4e00\u628a\u5251\u3002\u5c0f D \u89c9\u5f97\u8fd9\u6b3e\u6e38\u620f\u5341\u5206\u65e0\u804a\uff0c\u4f46\u6700\u5feb\u901a\u5173\u7684\u73a9\u5bb6\u53ef\u4ee5\u83b7\u5f97 ION2018 \u7684\u53c2\u8d5b\u8d44\u683c\uff0c \u4e8e\u662f\u5c0f D \u51b3\u5b9a\u5199\u4e00\u4e2a\u7b28\u7b28\u7684\u673a\u5668\u4eba\u5e2e\u5979\u901a\u5173\u8fd9\u6b3e\u6e38\u620f\uff0c\u5979\u5199\u7684\u673a\u5668\u4eba\u9075\u5faa\u4ee5\u4e0b\u89c4\u5219\uff1a  \n\n- \u6bcf\u6b21\u9762\u5bf9\u5de8\u9f99\u65f6\uff0c\u673a\u5668\u4eba\u4f1a\u9009\u62e9\u5f53\u524d\u62e5\u6709\u7684\uff0c\u653b\u51fb\u529b**\u4e0d\u9ad8\u4e8e**\u5de8\u9f99\u521d\u59cb\u751f\u547d\u503c\u4e2d\u653b\u51fb\u529b\u6700\u5927\u7684\u4e00\u628a\u5251\u4f5c\u4e3a\u6b66\u5668\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u5251\uff0c\u5219\u9009\u62e9**\u653b\u51fb\u529b\u6700\u4f4e**\u7684\u4e00\u628a\u5251\u4f5c\u4e3a\u6b66\u5668\u3002  \n\n- \u673a\u5668\u4eba\u9762\u5bf9\u6bcf\u6761\u5de8\u9f99\uff0c\u5b83\u90fd\u4f1a\u4f7f\u7528\u4e0a\u4e00\u6b65\u4e2d\u9009\u62e9\u7684\u5251\u653b\u51fb\u5de8\u9f99\u56fa\u5b9a\u7684 $x$ \u6b21\uff0c\u4f7f\u5de8\u9f99\u7684\u751f\u547d\u503c\u51cf\u5c11$x \\times ATK$\u3002  \n\n- \u4e4b\u540e\uff0c\u5de8\u9f99\u4f1a\u4e0d\u65ad\u4f7f\u7528\u6062\u590d\u80fd\u529b\uff0c\u6bcf\u6b21\u6062\u590d $p_i$\u751f\u547d\u503c\u3002\u82e5\u5728\u4f7f\u7528\u6062\u590d\u80fd\u529b\u524d\u6216\u67d0\u4e00\u6b21\u6062\u590d\u540e\u5176\u751f\u547d\u503c\u4e3a$0$\uff0c\u5219\u5de8\u9f99\u6b7b\u4ea1\uff0c\u73a9\u5bb6\u901a\u8fc7\u672c\u5173\u3002  \n\n\u90a3\u4e48\u663e\u7136\u673a\u5668\u4eba\u7684\u653b\u51fb\u6b21\u6570\u662f\u51b3\u5b9a\u80fd\u5426\u6700\u5feb\u901a\u5173\u8fd9\u6b3e\u6e38\u620f\u7684\u5173\u952e\u3002  \n\u5c0f D \u73b0\u5728\u5f97\u77e5\u4e86\u6bcf\u6761\u5de8\u9f99\u7684\u6240\u6709\u5c5e\u6027\uff0c\u5979\u60f3\u8003\u8003\u4f60\uff0c\u4f60\u77e5\u9053\u5e94\u8be5\u5c06\u673a\u5668\u4eba\u7684\u653b\u51fb\u6b21\u6570 $x$ \u8bbe\u7f6e\u4e3a\u591a\u5c11\uff0c\u624d\u80fd\u7528\u6700\u5c11\u7684\u653b\u51fb\u6b21\u6570\u901a\u5173\u6e38\u620f\u5417\uff1f  \n\n\u5f53\u7136\u5982\u679c\u65e0\u8bba\u8bbe\u7f6e\u6210\u591a\u5c11\u90fd\u65e0\u6cd5\u901a\u5173\u6e38\u620f\uff0c\u8f93\u51fa $-1$ \u5373\u53ef\u3002  \n\n\u591a\u6d4b\uff0c$T\\le 5$  \n$n,m\\le 10^5,\\operatorname{lcm}(p_i)\\le 10^{12},a_i\\le 10^{12},a_i\\le p_i,\\text{\u653b\u51fb\u529b}\\le 10^6$  \n\u4f46\u6709\u4e24\u4e2a\u6d4b\u8bd5\u70b9\uff0c$p_i=1$ \uff0c\u4e0d\u4fdd\u8bc1 $a_i\\le p_i$  \n\n--------------  \n\n\u5c06\u9898\u76ee\u5206\u6210\u591a\u4e2a\u6b65\u9aa4\u53bb\u505a  \n\n# \u8ba1\u7b97\u6bcf\u6b21\u9009\u62e9\u7684\u5251\u7684\u653b\u51fb\u529b  \n\n\u5f88\u663e\u7136\uff0c\u6bcf\u6b21\u7528\u7684\u5251\u662f\u786e\u5b9a\u7684  \n\u6211\u76f4\u63a5\u7528\u7684\u7ebf\u6bb5\u6811\uff0c\u6240\u4ee5\u5e38\u6570\u4e0a\u53ef\u80fd\u6709\u4e9b\u5dee  \n\u56e0\u4e3a\u653b\u51fb\u529b\u662f\u5f88\u5c0f\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u8ba9\u653b\u51fb\u529b\u5f53\u7ebf\u6bb5\u6811\u53f6\u5b50\u8282\u70b9\u7684\u4e0b\u6807  \n\u7136\u540e\u6bcf\u4e2a\u533a\u95f4\u7ef4\u62a4\u5f53\u524d\u6700\u5c0f\u548c\u6700\u5927\u7684\uff0c**\u6709\u5bf9\u5e94\u7684\u5251**\u7684\u653b\u51fb\u529b  \n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u5904\u7406\u53f6\u5b50\u8282\u70b9\u7684\u65f6\u5019\uff0c\u5982\u679c\u5f53\u524d\u653b\u51fb\u529b\u6ca1\u6709\u5bf9\u5e94\u7684\u5251\uff0c\u90a3\u4e48\u6b64\u8282\u70b9\u7684\u6700\u5c0f\u653b\u51fb\u529b\u8bbe\u4e3a\u6781\u5927\u503c\uff0c\u6700\u5927\u653b\u51fb\u529b\u8bbe\u4e3a\u6781\u5c0f\u503c  \n\n\u67e5\u8be2\u65f6\uff0c\u5982\u679c\u80fd\u67e5\u5230$[1,\\min(a_i,10^6)]$\u4e2d\u6700\u5927\u7684\u653b\u51fb\u529b\u7684\u5251\uff0c\u90a3\u80af\u5b9a\u5c31\u9009\u8fd9\u4e2a\u5251  \n\u5982\u679c\u4e0d\u80fd\uff0c\u90a3\u4e48\u5c31\u67e5\u8be2$[1,10^6]$\u4e2d\u7684\u6700\u5c0f\u653b\u51fb\u529b\u7684\u5251  \n\u7136\u540e\u5355\u70b9\u4fee\u6539\uff0c\u7528\u53bb\u7684\u5251\u7684\u5bf9\u5e94\u653b\u51fb\u529b\u51cf\u4e00\uff0c\u5f97\u5230\u7684\u5251\u7684\u653b\u51fb\u529b\u52a0\u4e00  \n\n# \u6574\u7406\u540c\u4f59\u65b9\u7a0b  \n\n\u8bbe\u6211\u4eec\u5bf9\u6bcf\u6b21\u653b\u51fb\u9009\u51fa\u7684\u5251\u7684\u653b\u51fb\u529b\u5206\u522b\u662f$ATK_i$  \n\u5219\u6839\u636e\u9898\u76ee\u4e2d\u6740\u6b7b\u9f99\u7684\u6761\u4ef6\uff0c\u5e76\u5c06\u8fd9$n$\u4e2a\u5f0f\u5b50\u90fd\u653e\u5728$\\bmod p_i$\u7684\u610f\u4e49\u4e0b\u6784\u6210\u540c\u4f59\u65b9\u7a0b\uff1a  \n\n$$x\\cdot ATK_i-a_i=kp_i$$  \n$$x\\cdot ATK_i-a_i\\equiv 0\\pmod {p_i}$$\n$$x\\cdot ATK_i\\equiv a_i\\pmod{p_i}$$  \n\n\u5982\u679c\u6211\u4eec\u60f3\u7528 exCRT \u53bb\u89e3\u51b3\u8fd9\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\uff0c$x$\u7684\u7cfb\u6570\u8981\u4e3a $1$  \n\u7531 exgcd \u7684\u539f\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230$x',y'\\in Z$\uff0c\u4f7f\u5f97\uff1a  \n\n$$x'\\cdot ATK_i+y'p_i=\\gcd(ATK_i,p_i)$$  \n\n\u90a3\u4e48\u53ef\u4ee5\u4ee5\u6b64\u505a\u53d8\u5f62  \n\n$$\\frac{x'\\cdot ATK_i}{\\gcd(ATK_i,p_i)}+\\frac{y'\\cdot p_i}{\\gcd(ATK_i,p_i)}=1$$  \n\n\u6b64\u65f6\uff0c\u5df2\u7ecf\u53ef\u4ee5\u7528 exgcd \u6c42\u5f97$x',y'$\u7684\u503c  \n\n$$\\frac{x'\\cdot ATK_i}{\\gcd(ATK_i,p_i)}\\equiv 1\\pmod{\\frac{p_i}{\\gcd(ATK_i,p_i)}}$$  \n\n\u90a3\u4e48\uff0c\u5219\u53ef\u4ee5\u5f97\u77e5\uff1a  \n\n$$x\\equiv a_i\\frac{x'}{\\gcd(ATK_i,p_i)}\\pmod {\\frac{p_i}{\\gcd(ATK_i,p_i)}}$$  \n\n\u76f8\u5f53\u4e8e\u6c42\u4e86\u4e2a\u9006\u5143  \n\u4ee5\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u7528 exgcd \u6c42$ax+by=c$\u7684\u4e00\u7ec4\u89e3\u7684\u8fc7\u7a0b\uff0c\u5728\u8fd9\u91cc\u5176\u5b9e\u5c31\u662f$x\\cdot ATK_i+y\\cdot p_i=a_i$  \n\u5f88\u663e\u7136\uff0c\u8fd9\u8981\u6c42$\\gcd(ATK_i,p_i)\\mid a_i$\uff0c\u5bf9\u4e8e\u4e0a\u4e00\u884c\u90a3\u4e2a\u5f0f\u5b50\u4e5f\u5c31\u662f$\\gcd(a,b)\\mid c$\uff0c\u8fd9\u662f\u6709\u89e3\u7684\u5145\u8981\u6761\u4ef6\uff08\u6590\u8700\u5b9a\u7406\uff09  \n\n\u90a3\u4e48\u6b64\u65f6\u7cfb\u6570\u5c31\u5316\u4e3a $1$ \u4e86  \n\u8981\u6ce8\u610f\u5728\u6b64\u8fc7\u7a0b\u4e2d\u8981\u8ba9$p_i=\\dfrac{p_i}{\\gcd(ATK_i,p_i)}$\n\n# exCRT \u6c42\u89e3  \n\n[\u770b\u8fd9\u91cc\uff0c\u5e94\u8be5\u6bd4\u8f83\u8be6\u7ec6\u4e86](https://www.cnblogs.com/suxxsfe/p/12527101.html)  \n\n# \u7279\u5224  \n\n\u4e2a\u4eba\u611f\u89c9\u7279\u5224\u5728\u6570\u8bba\u9898\u91cc\u4e5f\u6bd4\u8f83\u6076\u5fc3  \n~~\u800c\u4e14\u4f60\u7279\u5224\u5b8c\u4e00\u4e2a\u5730\u65b9\u4ee5\u540e\u6c38\u8fdc\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u5176\u5b83\u9700\u8981\u7279\u5224\u7684\u5730\u65b9~~  \n\n- $p_i=1$\uff0c\u8fd9\u4e24\u4e2a\u70b9\u8981\u7279\u5224\u6389\uff0c\u6bcf\u6b21\u6062\u590d\u4e00\u4e2a\u751f\u547d\uff0c\u90a3\u4e48\u53ea\u8981\u5c06\u4ed6\u6253\u5230\u751f\u547d\u4e3a\u975e\u6b63\u5c31\u884c\u4e86\uff0c\u7b54\u6848\u662f\uff1a$\\max(\\lceil\\dfrac{a_i}{ATK_i}\\rceil)$  \n- $p_i=a_i$\uff0c\u76f4\u63a5\u89e3\u540c\u4f59\u65b9\u7a0b\u7ed3\u679c\u662f$0$\uff0c\u4e0d\u5bf9  \n\u521d\u59cb\u751f\u547d\u548c\u6062\u590d\u751f\u547d\u76f8\u7b49\uff0c\u90a3\u4e48\u5e94\u8be5\u628a\u5b83\u6253\u5230\u751f\u547d\u4e3a$ka_i$\u5c31\u884c\uff0c$k$\u4e3a\u975e\u6b63\u6574\u6570\uff0c\u5177\u4f53\u7528$\\gcd$\u5b9e\u73b0\uff0c\u89c1 `work_p_a` \u51fd\u6570  \n- \u5982\u679c\u653b\u51fb\u529b$\\bmod p_i$\u4ee5\u540e\u4e3a $0$\uff0c\u5219\u65e0\u89e3  \n\u7279\u522b\u7684\uff0c\u5982\u679c\u6b64\u65f6\u521d\u59cb\u751f\u547d\u5c31\u7b49\u4e8e\u6062\u590d\u80fd\u529b$(a_i=p_i)$\uff0c\u90a3\u4e48\u663e\u7136\u6709\u89e3\uff0c\u4e14\u6b64\u65f6 $x$ \u53ef\u4ee5\u4e3a\u4efb\u610f\u5927\u4e8e $0$ \u7684\u6574\u6570\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u968f\u4fbf\u6253\u4e00\u4e0b\u5c31\u884c\u4e86\uff09\uff0c\u6b64\u65f6\u8fd9\u4e2a\u65b9\u7a0b\u5c31\u6ca1\u7528\u4e86\uff0c\u8981\u6807\u8bb0\u4e00\u4e0b\uff0cexCRT \u7684\u65f6\u5019\u8df3\u8fc7  \n\n# \u7ec6\u8282\n\n- \u7528\u5feb\u901f\u4e58  \n- \u7ebf\u6bb5\u6811\u4e00\u5b9a\u8981\u628a$a_i$\u548c$10^6$\u53d6$\\min$  \n~~\u6211\u56e0\u4e3a\u8fd9\u4e2aRE\u4e86~~  \n\n------------  \n\n$\\texttt{code.}$  \n\n```cpp  \n#include<cstdio>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#include<map>\n#include<iomanip>\n#include<cstring>\n#define reg register\n#define EN std::puts(\"\")\n#define LL long long\ninline LL read(){\n\tregister LL x=0;register int y=1;\n\tregister char c=std::getchar();\n\twhile(c<'0'||c>'9'){if(c=='-') y=0;c=std::getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=std::getchar();}\n\treturn y?x:-x;\n}\ninline int max(int x,int y){return x>y?x:y;}\ninline int min(int x,int y){return x<y?x:y;}\nstruct tr{\n\ttr *ls,*rs;\n\tint maxatk,minatk;\n}dizhi[2000006],*root=&dizhi[0];\nint tot;\nint sword[1000006],extra[100006];\nLL a[100006],p[100006],ATK[100006];\nint no[100006];//\u6807\u8bb0\u4e00\u4e2a\u65b9\u7a0b\u662f\u5426\u6709\u7528 \ninline void pushup(tr *tree){\n\ttree->maxatk=max(tree->ls->maxatk,tree->rs->maxatk);\n\ttree->minatk=min(tree->ls->minatk,tree->rs->minatk);\n}\nvoid build(tr *tree,int l,int r){\n\tif(l==r){\n\t\tif(sword[l]) tree->maxatk=tree->minatk=l;\n\t\telse tree->maxatk=0,tree->minatk=1e9;\n\t\treturn;\n\t}\n\ttree->ls=&dizhi[++tot];tree->rs=&dizhi[++tot];\n\tint mid=(l+r)>>1;\n\tbuild(tree->ls,l,mid);build(tree->rs,mid+1,r);\n\tpushup(tree);\n}\nvoid change(tr *tree,int l,int r,int pos){\n//\t\tstd::printf(\"change : %d %d\\n\",l,r);\n\tif(l==r){\n//\t\t\tstd::puts(\"return !\");\n\t\tif(sword[l]) tree->maxatk=tree->minatk=l;\n\t\telse tree->maxatk=0,tree->minatk=1e9;\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif(pos<=mid) change(tree->ls,l,mid,pos);\n\telse change(tree->rs,mid+1,r,pos);\n\tpushup(tree);\n}\nint findmax(tr *tree,int l,int r,int ql,int qr){\n//\t\tstd::printf(\"find_max : %d %d %d %d\\n\",l,r,ql,qr);\n\tif(ql<=l&&r<=qr) return tree->maxatk;\n\tint mid=(l+r)>>1;\n\tif(qr<=mid) return findmax(tree->ls,l,mid,ql,qr);\n\tif(ql>mid) return findmax(tree->rs,mid+1,r,ql,qr);\n\treturn max(findmax(tree->ls,l,mid,ql,qr),findmax(tree->rs,mid+1,r,ql,qr));\n}\nint findmin(tr *tree,int l,int r,int ql,int qr){\n\tif(ql<=l&&r<=qr) return tree->minatk;\n\tint mid=(l+r)>>1;\n\tif(qr<=mid) return findmin(tree->ls,l,mid,ql,qr);\n\tif(ql>mid) return findmin(tree->rs,mid+1,r,ql,qr);\n\treturn min(findmin(tree->ls,l,mid,ql,qr),findmin(tree->rs,mid+1,r,ql,qr));\n}\ninline LL mul(LL a,LL b,LL p){\n\treg LL ans=0;\n\twhile(b){\n\t\tif(b&1) ans=(ans+a)%p;\n\t\tb>>=1;a=(a+a)%p;\n\t}\n\treturn ans;\n}\nLL exgcd(LL a,LL b,LL &x,LL &y){\n\tif(!b) return x=1,y=0,a;\n\tLL gcd=exgcd(b,a%b,x,y);\n\tLL xx=x;x=y;\n\ty=xx-(a/b)*y;\n\treturn gcd;\n}\ninline void get_atk(int n){//calc ATK\n//\t\tstd::puts(\"begin to get_atk\");\n\tbuild(root,1,1000000);\n\tfor(reg int i=1;i<=n;i++){\n\t\tif(a[i]==1) ATK[i]=findmin(root,1,1000000,1,1000000);\n\t\telse{\n\t\t\tATK[i]=findmax(root,1,1000000,1,std::min(a[i],1000000ll));\n\t\t\tif(!ATK[i]) ATK[i]=findmin(root,1,1000000,1,1000000);\n\t\t}\n\t\tsword[ATK[i]]--;change(root,1,1000000,ATK[i]);\n\t\tsword[extra[i]]++;change(root,1,1000000,extra[i]);\n\t}\n//\t\tstd::printf(\"ATK :  \");for(reg int i=1;i<=n;i++) std::printf(\"%lld \",ATK[i]);EN;\n//\t\tstd::puts(\"finish getint_atk\");\n}\ninline int pre(int n){//\u5904\u7406\u540c\u4f59\u65b9\u7a0b\u7cfb\u6570\u5316\u4e3a 1 \n//\t\tstd::puts(\"begin to pre\");\n\tLL x,y;\n//\t\tEN;EN;EN;\n\tfor(reg int i=1;i<=n;i++){\n\t\tATK[i]%=p[i];\n\t\tif(!ATK[i]){\n\t\t\t//\u7279\u5224\uff0c\u5982\u679c\u653b\u51fb\u529b\u6a21\u5b8c\u4ee5\u540e\u4e3a 0\uff0c\u5219\u65e0\u89e3\n\t\t\t//\u7279\u522b\u7684\uff0c\u5982\u679c\u6b64\u65f6\u521d\u59cb\u751f\u547d\u5c31\u7b49\u4e8e\u6062\u590d\u80fd\u529b\uff0c\u90a3\u4e48\u663e\u7136\u6709\u89e3\uff0c\u4e14\u6b64\u65f6 x \u53ef\u4ee5\u4e3a\u4efb\u610f\u5927\u4e8e 0 \u7684\u6574\u6570 \n\t\t\tif(a[i]==p[i]) no[i]=1;\n\t\t\telse{\n//\t\t\t\tstd::puts(\"!ATK[i] & a[i]!=p[i]\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tLL gcd=exgcd(ATK[i],p[i],x,y);\n//\t\t\t\tstd::printf(\"(%lld %lld->%lld) \",ATK[i],p[i],gcd);\n\t\t\tif(a[i]%gcd){\n//\t\t\t\tstd::puts(\"! a[i]%gcd\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\t//\u6b64\u5904\u5e94\u653e\u5728 mod p[i]/gcd \u610f\u4e49\u4e0b\u8fdb\u884c \n\t\t\tp[i]/=gcd;\n\t\t\tx=(x+p[i])%p[i];\n\t\t\ta[i]=mul(x,a[i]/gcd,p[i]);\n\t\t}\n\t}\n\treturn 1;\n}\ninline int p_1(int n){\n\tfor(reg int i=1;i<=n;i++)if(p[i]!=1) return 0;\n\treturn 1;\n}\ninline int p_a(int n){\n\tfor(reg int i=1;i<=n;i++)if(p[i]!=a[i]) return 0;\n\treturn 1;\n}\ninline void work_p_1(int n){\n\tLL ans=0;\n\tfor(reg int i=1;i<=n;i++) ans=max(ans,std::ceil((double)a[i]/ATK[i]));\n\tstd::printf(\"%lld\\n\",ans);\n}\ninline void work_p_a(int n){\n\tLL ans=0;\n\tfor(reg int i=1;i<=n;i++){\n\t\tLL tmp=a[i]/std::__gcd(a[i],ATK[i]);\n\t\tans=(ans/std::__gcd(tmp,ans))*tmp;\n\t}\n\tstd::printf(\"%lld\\n\",ans);\n}\nint main(){\n//\tstd::freopen(\"dragon18.in\", \"r\", stdin);\n//\tstd::freopen(\"dragon.out\", \"w\", stdout);\nint T=read();while(T--){\n\tint n=read(),m=read();\n\tfor(reg int i=1;i<=n;i++) a[i]=read();\n\tfor(reg int i=1;i<=n;i++) p[i]=read();\n\tfor(reg int i=1;i<=n;i++) extra[i]=read();\n\tstd::memset(sword,0,sizeof sword);tot=0;\n\tfor(reg int i=1;i<=m;i++) sword[read()]++;\n\tget_atk(n);\n\tif(p_a(n)){work_p_a(n);continue;}\n\tif(p_1(n)){work_p_1(n);continue;}\n\tLL ans=1,x,y,M;\n\tif(!pre(n)) goto FAIL;\n\t{\n\treg int i=1;\n\tfor(;i<=n;i++)if(!no[i]){//\u627e\u7b2c\u4e00\u4e2a\u6709\u6548\u65b9\u7a0b \n\t\tans=a[i];M=p[i];break;\n\t}\n\tfor(i++;i<=n;i++){\n\t\tif(no[i]) continue;\n\t\tLL b=((a[i]-ans)%p[i]+p[i])%p[i];\n\t\tLL gcd=exgcd(M,p[i],x,y);\n//\t\t\tgcd=std::__gcd(M,p[i]);\n\t\tif(b%gcd){\n//\t\t\tstd::puts(\"! b%gcd\");\n\t\t\tgoto FAIL;\n\t\t}\n\t\tx=mul(x,b/gcd,p[i]);\n\t\tans+=mul(x,M,M/gcd*p[i]);\n\t\tM=M/gcd*p[i];\n\t\tans=(ans+M)%M;\n\t}\n\t}\n\tstd::printf(\"%lld\\n\",ans);continue;\n\tFAIL:;\n\tstd::puts(\"-1\");\n}\n\treturn 0;\n}\n```",
        "postTime": 1586621834,
        "uid": 164432,
        "name": "suxxsfe",
        "ccfLevel": 9,
        "title": "P4774 [NOI2018]\u5c60\u9f99\u52c7\u58eb"
    },
    {
        "content": " \u6211\u4eec\u5148\u5047\u8bbe\u6240\u6709\u7684\u5de8\u9f99\u90fd\u88ab\u6740\u6389\u3002\u7531\u9898\u610f\u53ef\u77e5\u6740\u6389\u5de8\u9f99\u6240\u7528\u7684\u5251\u7684\u6740\u4f24\u529b\u662f\u56fa\u5b9a\u7684\uff0c\u548c$x$\u65e0\u5173\u3002\n \n \u6211\u4eec\u53d1\u73b0\uff0c\u6740\u6389\u4e00\u6761\u9f99\u7b49\u4ef7\u4e8e$x \\cdot ATK \\ge a_i$\u4e14$a_i-x \\cdot ATK \\equiv 0 \\pmod{p_i}$\n \n \u5373$x \\ge \\lceil \\frac{a_i}{ATK} \\rceil$\u4e14$x \\cdot ATK \\equiv a_i \\pmod{p_i}$\n \n \u5bf9\u4e8e\u6240\u6709$p_i$\uff0c\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u6784\u6210\u4e86\u4e00\u4e2a\u7ebf\u6027\u540c\u4f59\u65b9\u7a0b\u7ec4\u3002\u89e3\u51fa\u4e00\u4e2a$x$\u5e76\u5bfb\u627e\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u7684\u6700\u5c0f\u7684$x$\u5373\u53ef\u3002\n \n \u6ce8\u610f\uff1a\u8fd9\u91cc\u7684\u6570\u53ef\u80fd\u8fbe\u5230$10^{12}$\u7ea7\u522b\uff0c\u89e3\u65b9\u7a0b\u7ec4\u65f6\u9700\u8981\u7528\u5230\u5feb\u901f\u4e58\u3002\n \n ```cpp\n#include <stdio.h>\n#include <vector>\n#include <set>\n#include <algorithm>\nusing namespace std;\nlong long gcd(long long a,long long b)\n{\n    return b?gcd(b,a%b):a;\n}\nlong long extgcd(long long a,long long b,long long &x,long long &y)\n{\n    long long d=a;\n    if (b)\n    {\n        d=extgcd(b,a%b,y,x);\n        y-=(a/b)*x;\n    }\n    else\n    {\n        x=1;\n        y=0;\n    }\n    return d;\n}\nlong long mod_inverse(long long a,long long m)\n{\n    long long x,y;\n    extgcd(a,m,x,y);\n    return (m+x%m)%m;\n}\nlong long qmul(long long a,long long b,long long mod)\n{\n    long long ret=0;\n    for (;b;a=(a+a)%mod,b>>=1)\n        if (b&1)\n            (ret+=a)%=mod;\n    return ret;\n}\npair<long long,long long> linear_congruence(const vector<long long> &A,const vector<long long> &B,const vector<long long> &M)\n{\n    long long x=0,m=1;\n    for (size_t i=0;i<A.size();++i)\n    {\n        long long a=A[i]*m,b=B[i]-qmul(A[i],x,M[i]),d=gcd(M[i],a);\n        if (b<0)\n            b+=M[i];\n        if (b%d)\n            return make_pair(0,-1);\n        long long t=qmul(b/d,mod_inverse(a/d,M[i]/d),M[i]/d);\n        x+=m*t;\n        m*=M[i]/d;\n        x%=m;\n    }\n    return make_pair(x,m);\n}\nlong long bonus[100001];\nint main()\n{\n    int T;\n    freopen(\"dragon.in\",\"r\",stdin);\n    freopen(\"dragon.out\",\"w\",stdout);\n    scanf(\"%d\",&T);\n    while (T--)\n    {\n        int n,m;\n        scanf(\"%d%d\",&n,&m);\n        vector<long long> a(n);\n        for (int i=0;i<n;++i)\n            scanf(\"%lld\",&a[i]);\n        vector<long long> p(n);\n        for (int i=0;i<n;++i)\n            scanf(\"%lld\",&p[i]);\n        for (int i=0;i<n;++i)\n            scanf(\"%lld\",bonus+i);\n        multiset<long long> swords;\n        for (int i=1;i<=m;++i)\n        {\n            long long x;\n            scanf(\"%lld\",&x);\n            swords.insert(x);\n        }\n        vector<long long> atk(n);\n        long long maxa=0;\n        for (int i=0;i<n;++i)\n        {\n            multiset<long long>::iterator it=swords.upper_bound(a[i]);\n            if (it!=swords.begin())\n                --it;\n            atk[i]=*it;\n            maxa=max(maxa,a[i]/atk[i]+(a[i]%atk[i]?1:0));\n            swords.erase(it);\n            swords.insert(bonus[i]);\n            a[i]%=p[i];\n            atk[i]%=p[i];\n        }\n        pair<long long,long long> res=linear_congruence(atk,a,p);\n        if (res.second==-1)\n            printf(\"-1\\n\");\n        else\n        {\n            long long tmp=(maxa-res.first)/res.second;\n            if (tmp>0)\n                res.first+=tmp*res.second;\n            if (res.first<maxa)\n                res.first+=res.second;\n            printf(\"%lld\\n\",res.first);\n        }\n    }\n    return 0;\n}\n\n```",
        "postTime": 1532101973,
        "uid": 30614,
        "name": "ascchrvalstr",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u56e0\u4e3a\u6ca1a\u6389\u6b64\u9898\u800ccu\u6eda\u7c97\u7684\u83dc\u9e21\u6765\u62a5\u4e2a\u5230\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u663e\u7136\u5730\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u6761\u9f99\uff0c\u653b\u51fb\u5b83\u7528\u5230\u7684\u5251\u662f\u552f\u4e00\u786e\u5b9a\u7684\uff0c\u7528\u4e00\u4e2amultiset\u9884\u5904\u7406\u5373\u53ef\uff0c\u8bb0\u4f5cdi\u3002\n\n\u9700\u8981\u5f3a\u8c03\u4e24\u70b9\uff1a\u7b2c\u4e00\u662f\u4e0d\u8981\u7528\u6210set\uff0c\u7b2c\u4e8c\u662f\u867d\u7136\u91cc\u9762\u5b58\u7684\u5143\u7d20\u662fint\u4f46\u662f\u4f60\u4f1a\u7528ll\u53bb\u67e5\u8be2\u6240\u4ee5\u8fd8\u662f\u8981\u5f00ll\uff0c\u6ca1\u9519\u6211\u768425\u5206\u5c31\u662f\u8fd9\u4e48\u4e22\u7684\u2026\u2026\n\n\u9996\u5148pi=1\u7684\u70b9\u5f88\u597d\u5904\u7406\uff0c\u56e0\u4e3a\u6b64\u65f6\u53ea\u8981\u6253\u5230\u8840\u91cf<=0\u5c31\u6b7b\u5b9a\u4e86\uff0c\u6240\u4ee5\u7b54\u6848\u5c31\u662fmax((ai / di)\u4e0a\u53d6\u6574)\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6700\u540e\u7684\u7b54\u6848x\uff0c\u4e00\u5b9a\u6ee1\u8db3\u5982\u4e0b\u9650\u5236\uff1a\n\n\u5bf9\u4e8e\u4efb\u610fi\uff0c\u5747\u6709 di * x % pi == ai\n\n\u4e5f\u5c31\u662fn\u4e2a\u540c\u4f59\u65b9\u7a0b\u7684\u5f62\u5f0f\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u540c\u4f59\u65b9\u7a0b\uff0c\u7528exgcd\u89e3\u51fa\u4e00\u4e2ax\u7684\u901a\u89e3\u3002\n\n\u6ce8\u610f\u5f97\u5230x\u7684\u6700\u5c0f\u975e\u8d1f\u6574\u6570\u89e3qi\u540e\uff0c\u52a0\u4e0a\u4efb\u610f\u6574\u6570\u500d\u7684ki =\uff08pi / gcd(di,pi)\uff09\u4e5f\u4e00\u5b9a\u662f\u4e00\u4e2a\u5408\u6cd5\u89e3\n\n\u56e0\u6b64\u6211\u4eec\u7684\u540c\u4f59\u65b9\u7a0b\u53ef\u4ee5\u5316\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a\n\n\u5bf9\u4e8e\u4efb\u610fi\uff0c\u6ee1\u8db3x % pi == qi\n\n\u7136\u540e\u5408\u5e76\u8fd9n\u4e2a\u540c\u4f59\u65b9\u7a0b\u7ec4\u5c31\u662f\u7ecf\u5178\u7684\u6269\u5c55crt\u5566\n\n\u7b49\u7b49\u2026\u2026\u6211\u4e0d\u4f1a\u6269\u5c55crt\uff01\n\n\u4e8e\u662f\u6211\u5728\u8003\u573a\u4e0a\u63a8\u4e86\u4e24\u4e2a\u591a\u5c0f\u65f6\u7684\u5f0f\u5b50\uff0c\u6700\u540e\u5f97\u51fa\u4e86\u4e00\u4e2a\u7384\u5b66\u505a\u6cd5\uff1a\n\n\u5047\u8bbe\u6211\u4eec\u6709\u4e24\u4e2a\u540c\u4f59\u65b9\u7a0b\uff1a\n\nx % a1 == b1\n\nx % a2 == b2\n\n\u6211\u4eec\u8981\u5c06\u5176\u5408\u5e76\u4e3a\n\nx % lcm(a1,a2) == b3\n\nb3\u5373\u4e3a\u6211\u4eec\u7684\u6240\u6c42\u3002\n\n\u6211\u4eec\u8003\u8651\u5199\u6210\u4e0d\u5b9a\u65b9\u7a0b\u7684\u5f62\u5f0f\n\nx == b1 + k1 * a1\n\nx == b2 + k2 * a2\n\n\u5148\u201c\u94a6\u5b9a\u201dk1 = 0\uff0c\u770b\u4e00\u4e0b\u5e26\u5165\u7b2c\u4e8c\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u7684\u7ed3\u679c\u4e0ea1\u76f8\u5dee\u591a\u5c11\uff0c\u8bb0\u4f5cq1\u3002\n\n\u7136\u540e\u8003\u8651k1++\uff0c\u4f1a\u4f7f\u5f97\u7b2c\u4e8c\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u7684\u7ed3\u679c\u53d8\u5316\u591a\u5c11\uff0c\u8bb0\u4f5cq2\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u6709\n\nk1 * q2 % a2 == q1\n\n\u53ef\u4ee5exgcd\u89e3\u51fak1\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8fd8\u539f\u56deb3\u7684\u503c\u5566\u3002\n\n\uff08\u5e76\u4e0d\u77e5\u9053\u6b63\u7ecf\u7684\u6269\u5c55crt\u662f\u600e\u4e48\u5199\u7684\uff0c\u4e5f\u8bb8\u8ddf\u8fd9\u4e2a\u601d\u8def\u7c7b\u4f3c\uff1f\uff09\n\n\u5982\u679c\u4e0a\u9762\u4efb\u610f\u4e00\u4e2aexgcd\u6216\u6269\u5c55crt\u7684\u6b65\u9aa4\u65e0\u89e3\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u65e0\u89e3\u5373\u53ef\u3002\n\n\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6O\uff08n log n\uff09\uff0c\u662f\u4e0d\u662f\u5f88\u4f11\u95f2\uff1f\uff08\u9003\uff09\n\n\u54e6\u5bf9\u4e86\uff0c\u7531\u4e8e1e12\u76f4\u63a5\u76f8\u4e58\u4f1a\u7206ll\uff0c\u56e0\u6b64\u9700\u8981\u5199\u5feb\u901f\u4e58\u3002 \n\n\u7531\u4e8e\u662f\u81ea\u5df1\u4e00\u8fb9\u63a8\u4e00\u8fb9\u5199\u7684\uff0c\u4ee3\u7801\u6781\u4e11\u8bf7\u539f\u8c05~\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cmath>\n#include<algorithm>\n#include<cstring>\n#include<cstdlib>\n#include<ctime>\n#include<set>\nusing namespace std;\n#define li long long\n#define gc getchar()\n#define pc putchar\nli read(){\n\tli x = 0,c = gc;\n\twhile(!isdigit(c)) c = gc;\n\twhile(isdigit(c)){\n\t\tx = x * 10 + (c ^ '0');\n\t\tc = gc;\n\t}\n\treturn x;\n}\nvoid print(li x){\n\tif(x >= 10) print(x / 10);\n\tpc(x % 10 + '0');\n}\nint t,n,m;\nli a[100010],b[100010],c[100010];\nint d[100010];\nmultiset<li> s;\nli gcd(li x,li y){\n\treturn !y ? x : gcd(y,x % y);\n}\nli lcm(li x,li y){\n\treturn x / gcd(x,y) * y;\n}\nli exgcd(li a,li b,li &x,li &y){\n\tif(!b){\n\t\tx = 1;y = 0;return a;\n\t}\n\tli p = exgcd(b,a % b,x,y);\n\tli t = x;x = y;y = t - a / b * y;\n\treturn p;\n}\nli ksc(li q,li w,li p){\n\tq %= p;w %= p;\n\tif(q < w) swap(q,w);\n\tif(p <= 10000000000000ll){\n\t\tli as = 0;\n\t\twhile(w){\n\t\t\t(as += w % 100000 * q) %= p;\n\t\t\tq = q * 100000 % p;\n\t\t\tw /= 100000;\n\t\t}\n\t\treturn as;\n\t}\n\tli as = 0;\n\twhile(w){\n\t\tif(w & 1) (as += q) %= p;\n\t\t(q += q) %= p;\n\t\tw >>= 1;\n\t}\n\treturn as;\n}\nint main(){\n\tint i,j,k,l;\n\tli x,y,p,q,r,a1,a2,b1,b2,c1,c2,tp;\n\tt = read();\n\twhile(t--){\n\t\ts.clear();\n\t\tli mx = 0;\n\t\tn = read();m = read();\n\t\tfor(i = 1;i <= n;++i) a[i] = read();\n\t\tfor(i = 1;i <= n;++i) b[i] = read(),mx = max(mx,b[i]);\n\t\tfor(i = 1;i <= n;++i) c[i] = read();\n\t\tfor(i = 1;i <= m;++i){\n\t\t\tj = read();\n\t\t\ts.insert(j);\n\t\t}\n\t\tfor(i = 1;i <= n;++i){\n\t\t\tmultiset<li>::iterator it = s.upper_bound(a[i]);\n\t\t\tif(it != s.begin()) --it;\n\t\t\td[i] = *it;\n\t\t\ts.erase(it);\n\t\t\ts.insert(c[i]); \n\t\t}\n\t\tif(mx == 1){\n\t\t\tli as = 0;\n\t\t\tfor(i = 1;i <= n;++i) as = max(as,(a[i] - 1) / d[i] + 1);\n\t\t\tprint(as);pc('\\n');continue;\n\t\t}\n\t\tp = exgcd(d[1],b[1],x,y);\n\t\tif(a[1] % p){\n\t\t\tputs(\"-1\");continue;\n\t\t}\n\t\tq = b[1] / p;r = a[1] / p % q;\n\t\tif(x < 0) x += q;\n\t\tb1 = q;b2 = ksc(r,x,q);\n\t\tbool fg = 0;\n\t\tfor(i = 2;i <= n;++i){\n\t\t\tp = exgcd(d[i],b[i],x,y);\n\t\t\tif(a[i] % p){\n\t\t\t\tputs(\"-1\");fg = 1;break;\n\t\t\t}\n\t\t\tq = b[i] / p;r = a[i] / p % q;\n\t\t\tif(x < 0) x += q;\n\t\t\ta1 = q;a2 = ksc(r,x,q);\n\t\t\ttp = ((b2 - a2) % b1 + b1) % b1;\n\t\t\tp = exgcd(a1 % b1,b1,x,y);\n\t\t\tif(tp % p || a2 % p != b2 % p){\n\t\t\t\tfg = 1;puts(\"-1\");break;\n\t\t\t}\n\t\t\tc1 = a1 / p * b1;\n\t\t\tq = b1 / p;r = tp / p % q;\n\t\t\tif(x < 0) x += q;\n\t\t\tx = ksc(r,x,q);\n\t\t\tc2 = (a2 + ksc(x,a1,c1)) % c1;\n\t\t\tb1 = c1;b2 = c2;\n\t\t}\n\t\tif(fg) continue;\n\t\tprint(!b2 ? b1 : b2);pc('\\n');\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1532084834,
        "uid": 45775,
        "name": "liuzhangfeiabc",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018]\u5c60\u9f99\u52c7\u58eb\u3011"
    },
    {
        "content": "\u9996\u5148\u5f88\u5bb9\u6613\u5c06\u9898\u610f\u8f6c\u5316\u4e3a\n\n> \u7ed9\u5b9a\u82e5\u5e72\u4e2a\u5982\u4e0b\u5f0f\u7684\u4e0d\u5b9a\u65b9\u7a0b\uff0c\u89e3\u51fa\u6700\u5c0f\u89e3 $x$\n> $$ATK_i\\times x\\equiv a_i \\mod p_i$$\n\n\u5bf9\u4e8e\u5355\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u5316\u7b80\u4e00\u4e0b\n\n\u4e3a\u4ec0\u4e48\u5316\u7b80\uff1f\n\n\u5982\u679c $\\gcd (ATK_i,p_i) \\neq 1$\uff0c\u4f1a\u53d1\u73b0\uff0c\u53ef\u4ee5\u89e3\u51fa $\\gcd (ATK_i,p_i)$ \u4e2a\u89e3\u4f7f\u5f97\u8fd9\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u6210\u7acb\n\n\u4f46\u662f\u6211\u4eec\u6700\u540e\u8981\u6c42\u89e3\u7684\u662f\u4e00\u4e2a\u4e0d\u5b9a\u65b9\u7a0b\u7ec4\uff0c\u65e0\u6cd5\u5f97\u77e5\u53d6\u90a3\u4e2a\u89e3\u662f\u6b63\u786e\u7684\uff0c\u6240\u4ee5\u4e24\u8fb9\u540c\u9664 $\\gcd (ATK_i,p_i)$\uff0c\u4f7f\u5f97\u4e0d\u5b9a\u65b9\u7a0b\u89e3\u51fa\u4e00\u4e2a\u89e3\uff0c\u4ece\u800c\u5229\u4e8e\u4e0d\u5b9a\u65b9\u7a0b\u7ec4\u7684\u6c42\u89e3\n\n\u7136\u540e\u7528 $ExGCD$ \u6765\u6c42\u89e3\uff0c\u5316\u6210\u82e5\u5e72\u4e2a\u540c\u4f59\u65b9\u7a0b\u7684\u5f62\u5f0f\uff0c\u6700\u540e $ExCRT$ \u5408\u5e76\u4e00\u4e0b\u5c31\u597d\u4e86\n\n\u4f46\u662f\u4e0a\u8ff0\u505a\u6cd5\u5e76\u4e0d\u80fd\u5904\u7406 $p_i=1$ \u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u8981\u7279\u5224\u4e00\u4e0b\uff0c\u5176\u5b9e\u5c31\u662f $\\max \\{\\frac{a_i}{ATK_i}\\}$\uff0c\u6ce8\u610f\u4e0a\u53d6\u6574\n\n\u4f5c\u4e3a $NOI\\; 2018$ \u7684\u7b7e\u5230\u9898\uff0c~~\u8fd8\u662f\u633a\u6c34\u7684\u5427~~\n\n```c++\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#include <vector>\n#include <cmath>\n\ntypedef long long ll;\ntypedef unsigned long long ull;\n\nusing namespace std;\n\nconst int maxn = 1e5 + 50, INF = 0x3f3f3f3f;\n\ninline ll read () {\n\tregister ll x = 0, w = 1;\n\tregister char ch = getchar ();\n\tfor (; ch < '0' || ch > '9'; ch = getchar ()) if (ch == '-') w = -1;\n\tfor (; ch >= '0' && ch <= '9'; ch = getchar ()) x = x * 10 + ch - '0';\n\treturn x * w;\n}\n\ninline void write (register int x) {\n\tif (x / 10) write (x / 10);\n\tputchar (x % 10 + '0');\n}\n\nint T, n, m;\nbool ALLONE = 1;\nvector <int> vec;\nll maxx, a[maxn], b[maxn], c[maxn], p[maxn], atk[maxn];\n\ninline ll Mul (register ll a, register ll b, register ll mod) {\n\tregister ll tmp = (long double) a / mod * b, res = (ull) a * b - (ull) tmp * mod;\n\treturn (res % mod + mod) % mod;\n}\n\ninline ll ExGCD (register ll a, register ll b, register ll &x, register ll &y) {\n\tif (! b) return x = 1, y = 0, a;\n\tregister ll d = ExGCD (b, a % b, x, y), tmp = x;\n\treturn x = y, y = tmp - a / b * y, d;\n}\n\ninline ll ExCRT () {\n\tregister ll ans = c[1], lcm = p[1], maxx = 0;\n\tfor (register int i = 2; i <= n; i ++) {\n\t\tregister ll res = ((c[i] - ans) % p[i] + p[i]) % p[i], x = 0, y = 0, gcd = ExGCD (lcm, p[i], x, y), tmp = p[i] / gcd;\n\t\tif (res % gcd) return -1;\n\t\tx = Mul (x, res / gcd, tmp), ans += x * lcm, lcm *= tmp, ans = (ans % lcm + lcm) % lcm, maxx = max (maxx, p[i]);\n\t} \n\treturn (ans % lcm + lcm) % lcm;\n}\n\nint main () {\n\tT = read();\n\twhile (T --) {\n\t\tn = read(), m = read(), vec.clear (), ALLONE = 1, maxx = 0;\n\t\tfor (register int i = 1; i <= n; i ++) a[i] = read();\n\t\tfor (register int i = 1; i <= n; i ++) {\n\t\t\tp[i] = read();\n\t\t\tif (p[i] != 1) ALLONE = 0;\n\t\t}\n\t\tfor (register int i = 1; i <= n; i ++) atk[i] = read();\n\t\tfor (register int i = 1; i <= m; i ++) vec.push_back (read ());\n\t\tsort (vec.begin (), vec.end ());\n\t\tfor (register int i = 1, res; i <= n; i ++) {\n\t\t\tres = upper_bound (vec.begin (), vec.end (), a[i]) - vec.begin ();\n\t\t\tif (res) res --;\n\t\t\tb[i] = vec[res], vec.erase (vec.begin () + res);\n\t\t\tres = lower_bound (vec.begin (), vec.end (), atk[i]) - vec.begin ();\n\t\t\tvec.insert (vec.begin () + res, atk[i]);\n\t\t}\n\t\tif (ALLONE) {\n\t\t\tfor (register int i = 1; i <= n; i ++) maxx = max (maxx, (ll) ceil (1.0 * a[i] / b[i]));\n\t\t\tprintf (\"%lld\\n\", maxx);\n\t\t} else {\n\t\t\tfor (register int i = 1; i <= n; i ++) {\n\t\t\t\tregister ll x = 0, y = 0, res = ExGCD (b[i], p[i], x, y);\n\t\t\t\tx = 0, y = 0, res = ExGCD (res, a[i], x, y), b[i] /= res, p[i] /= res, a[i] /= res, x = 0, y = 0;\n\t\t\t\tregister ll gcd = ExGCD (b[i], p[i], x, y), tmp = p[i] / gcd;\n\t\t\t\tif (a[i] % gcd) { puts (\"-1\"); goto end; }\n\t\t\t\telse x = (x % tmp + tmp) % tmp, c[i] = Mul (x, a[i] / gcd, tmp);\n\t\t\t}\n\t\t\tprintf (\"%lld\\n\", ExCRT ()); end:;\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1611149873,
        "uid": 335193,
        "name": "Rubyonly",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4774 \u3010[NOI2018] \u5c60\u9f99\u52c7\u58eb\u3011"
    }
]