[
    {
        "content": "[Link](https://www.luogu.com.cn/problem/P9194)\n\n\u7531\u4e8e\u6bcf\u6b21\u5220\u70b9\u4e4b\u540e\u65b0\u589e\u7684\u8fb9\u6570\u592a\u591a\uff0c\u6240\u4ee5\u8003\u8651\u62c6\u8fb9\u3002\u7528\u4e00\u4e2a\u767d\u70b9\u8868\u793a\u4e00\u6761\u8fb9\uff0c\u5e76\u5c06\u539f\u6765\u6811\u4e2d\u7684\u70b9\u79f0\u4e3a\u9ed1\u70b9\uff0c\u7f16\u53f7\u4e0d\u53d8\u3002\u5bf9\u4e8e\u7b2c $i$ \u6761\u8fb9 $(u_i,v_i)$\uff0c\u5728 $(u_i,n+i),(v_i,n+i)$ \u95f4\u8fde\u8fb9\uff0c\u5f97\u5230\u4e00\u68f5\u6811 $T$\u3002\n\n\u5220\u9664\u70b9 $i$ \u65f6\uff0c\u6211\u4eec\u5c06\u70b9 $i$ \u76f8\u90bb\u7684\u6240\u6709\u767d\u70b9\u5408\u5e76\u4e3a\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u5220\u9664 $i$\u3002\u5bb9\u6613\u5f52\u7eb3\u8bc1\u660e\uff1a\u6bcf\u6b21\u5220\u9664\u540e $T$ \u4ecd\u7136\u662f\u6811\uff1b\u771f\u5b9e\u7684 $u,v$ \u95f4\u6709\u8fb9\u7b49\u4ef7\u4e8e\u6811 $T$ \u4e2d\u5b58\u5728\u4e00\u4e2a\u767d\u70b9\u4e0e $u,v$ \u5747\u76f8\u90bb\u3002\n\n\u56e0\u4e3a\u4f9d\u6b21\u5220\u9664 $1,2,...,n$\uff0c\u6240\u4ee5\u5728\u6811 $T$ \u4e2d\uff0c\u53ef\u4ee5\u628a\u70b9 $n$ \u4f5c\u4e3a\u6839\u3002\u8fd9\u6837\u6bcf\u6b21\u5220\u9664\u65f6\uff0c\u5c31\u53ef\u4ee5\u628a $i$ \u7684\u6240\u6709\u76f8\u90bb\u767d\u70b9\u5408\u5e76\u5230 $i$ \u7684\u7236\u4eb2\u767d\u70b9\u4e0a\u53bb\u3002\u7136\u540e\uff0c\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u6bcf\u4e2a\u767d\u70b9\u88ab\u5408\u5e76\u5230\u4e86\u54ea\u4e2a\u70b9\u3002\n\n\u7528 $fa_u$ \u8868\u793a\u5728\u521d\u59cb\u7684 $T$ \u4e2d $u$ \u7684\u7236\u4eb2\u7ed3\u70b9\uff0c$p_u$ \u8868\u793a\u67d0\u4e2a\u65f6\u523b\u767d\u70b9 $u$ \u88ab\u5408\u5e76\u5230\u7684\u70b9\u3002\u90a3\u4e48\uff0c\u5728\u8fd9\u4e00\u65f6\u523b\uff0c\u9ed1\u70b9 $u$ \u7684\u7236\u4eb2\u7ed3\u70b9\u662f $p_{fa_u}$\uff0c\u767d\u70b9 $u$ \u7684\u7236\u4eb2\u8282\u70b9\u662f $fa_{p_u}$\u3002\n\n\u4e0b\u9762\u6765\u8003\u8651\u5982\u4f55\u7edf\u8ba1\u7b54\u6848\u3002\u5bf9\u767d\u70b9 $u$\uff0c\u8bb0 $s_u$ \u4e3a $u$ \u7684\u513f\u5b50\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7b26\u5408\u8981\u6c42\u7684 $(a,b,c)$\uff0c\u8bbe $a,b$ \u901a\u8fc7\u767d\u70b9 $x$ \u76f8\u8fde\uff0c$b,c$ \u901a\u8fc7\u767d\u70b9 $y$ \u76f8\u8fde\u3002\n\n1. \u5982\u679c $x=y$\uff1a\u56fa\u5b9a $x$\uff0c\u5728 $x$ \u7684\u90bb\u70b9\u4e2d\u4efb\u9009 $3$ \u4e2a\uff0c\u5219\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a\n\t$$\\sum_{x} (s_x+1)s_x(s_x-1)$$\n\t\u6c42\u548c\u7684\u6761\u4ef6\u662f $x$ \u662f\u767d\u70b9\u3002\n2. \u5982\u679c $x\\not=y$\uff0c\u4e14 $x,y$ \u90fd\u662f $b$ \u7684\u5b50\u8282\u70b9\uff1a\u56fa\u5b9a $b$\uff0c\u5148\u4efb\u53d6 $b$ \u7684\u4e24\u4e2a\u5b50\u7ed3\u70b9 $x,y$\uff0c\u6b64\u65f6\u8d21\u732e $s_xs_y$\u3002\u5219\u603b\u7684\u8d21\u732e\u4e3a\n\t$$\\sum_{b} (\\sum_{x} s_x) ^2 - \\sum_{x} s_x^2$$\n\t\u7b2c\u4e00\u4e2a\u6c42\u548c\u7684\u6761\u4ef6\u662f $b$ \u662f\u9ed1\u70b9\uff0c\u540e\u4e24\u4e2a\u6c42\u548c\u7684\u6761\u4ef6\u662f $x$ \u662f $b$ \u7684\u513f\u5b50\u3002\n\t\u6ce8\u610f\u5230\u540e\u4e00\u9879\u62c6\u51fa\u6765\u5c31\u662f\u5bf9\u6240\u6709\u767d\u70b9 $x$ \u6c42 $s_x^2$ \u7684\u548c\uff0c\u90a3\u5c31\u62c6\u51fa\u6765\u5427\u3002\n3. \u5982\u679c $x\\not=y$\uff0c\u4e14 $x,y$ \u4e00\u4e2a\u662f $b$ \u7684\u5b50\u7ed3\u70b9\uff0c\u53e6\u4e00\u4e2a\u662f $b$ \u7684\u7236\u4eb2\u7ed3\u70b9\uff1a\u4e0d\u59a8 $x$ \u662f $b$ \u7684\u7236\u4eb2\u7ed3\u70b9\uff0c\u56fa\u5b9a $x$\uff0c$b$ \u662f $x$ \u7684\u4e00\u4e2a\u5b50\u7ed3\u70b9\uff0c$y$ \u53c8\u662f $b$ \u7684\u4e00\u4e2a\u5b50\u7ed3\u70b9\uff0c\u5219\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a\n\t$$\\sum_{x} 2\\times s_x \\times \\sum_{b} \\sum_{y} s_y$$\n\t\u4e09\u4e2a\u6c42\u548c\u7684\u6761\u4ef6\u5206\u522b\u4e3a $x$ \u662f\u767d\u70b9\uff0c$b$ \u662f $x$ \u7684\u5b50\u7ed3\u70b9\uff0c$y$ \u662f $b$ \u7684\u7ed3\u70b9\u3002\n\n\u5217\u51fa\u5f0f\u5b50\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u9700\u8981\u7ef4\u62a4\u4ee5\u4e0b\u6570\u636e\uff1a\n1. \u767d\u70b9 $u$ \u7684\u513f\u5b50\u6570\u76ee $s_u$\n2. \u9ed1\u70b9 $u$ \u7684\u513f\u5b50\u7684 $s$ \u503c\u4e4b\u548c\uff0c\u4e5f\u53ef\u4ee5\u5b58\u5230\u6570\u7ec4 $s$ \u91cc\n3. \u767d\u70b9 $u$ \u7684\u513f\u5b50\u7684 $s$ \u503c\u4e4b\u548c $t_u$\n\n\u7b54\u6848\u662f $\\sum_{x}(f(s_x)+2s_xt_x)+\\sum_{y} s_y^2$\uff0c\u5176\u4e2d $f(x)=x^3-x^2-x$\uff0c\u4e24\u4e2a\u6c42\u548c\u7684\u6761\u4ef6\u5206\u522b\u662f $x$ \u662f\u9ed1\u70b9\uff0c$y$ \u662f\u767d\u70b9\u3002\n\n\u5220\u9664\u70b9 $u$ \u65f6\uff0c\u679a\u4e3e\u5b83\u521d\u59cb\u7684\u7684\u513f\u5b50\uff08\u4e00\u5b9a\u6ca1\u6709\u88ab\u5408\u5e76\u8fc7\uff09\uff0c\u5728\u5e76\u67e5\u96c6\u4e2d\u5c06\u5176\u5408\u5e76\u5230 $u$ \u7684\u7236\u4eb2\u4e2d\u3002\u7136\u540e\u6e05\u96f6 $u$ \u548c $u$ \u7684\u513f\u5b50\u7684\u503c\uff0c\u66f4\u65b0 $u$ \u7684\u4e09\u5c42\u7956\u5148\u7684\u503c\uff0c\u5e76\u66f4\u65b0\u7b54\u6848\u3002\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=4e5+5;\nint n,fa[N],p[N];ll s[N],t[N],ans;\nint head[N],ver[N<<1],nxt[N<<1],tot;\nvoid add(int u,int v){ver[++tot]=v;nxt[tot]=head[u];head[u]=tot;}\nvoid dfs(int u){\n\tfor(int i=head[u],v;i;i=nxt[i])\n\t\tif((v=ver[i])!=fa[u]){\n\t\t\tfa[v]=u;dfs(v);\n\t\t\tif(u<=n)s[u]+=s[v];\n\t\t\telse ++s[u],t[u]+=s[v];\n\t\t}\n}\nint find(int x){return (x==p[x]?x:(p[x]=find(p[x])));}\nll f(ll x){return x*x*x-x*x-x;}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1,u,v;i<n;i++){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,n+i);add(v,n+i);add(n+i,u);add(n+i,v);\n\t}\n\tdfs(n);\n\tfor(int i=1;i<2*n;i++)p[i]=i;\n\tfor(int i=1;i<=n;i++)ans+=s[i]*s[i];\n\tfor(int i=n+1;i<2*n;i++)ans+=f(s[i])+2*s[i]*t[i];\n\tfor(int u=1;u<=n;u++){\n\t\tprintf(\"%lld\\n\",ans);\n\t\tint g=find(fa[u]),w=fa[g];ll del=-1;\n\t\tans-=f(s[g])+2*s[g]*t[g]+s[w]*s[w];s[w]-=s[g];--s[g];\n\t\tt[g]-=s[u];ans-=s[u]*s[u];s[u]=0;\n\t\tfor(int i=head[u],v;i;i=nxt[i])\n\t\t\tif((v=ver[i])!=fa[u]){\n\t\t\t\tp[v]=g;s[g]+=s[v];t[g]+=t[v];del+=s[v];\n\t\t\t\tans-=f(s[v])+2*s[v]*t[v];s[v]=t[v]=0;\n\t\t\t}\n\t\ts[w]+=s[g];ans+=f(s[g])+2*s[g]*t[g]+s[w]*s[w];\n\t\tt[w=find(fa[fa[g]])]+=del;ans+=2*s[w]*del;\n\t}\n\treturn 0;\n}\n```\n\nUpd\uff1a\u4fee\u6539\u4e86\u683c\u5f0f\u3002",
        "postTime": 1684850301,
        "uid": 87504,
        "name": "by_chance",
        "ccfLevel": 7,
        "title": "P9194 [USACO23OPEN] Triples of Cows P \u9898\u89e3"
    }
]