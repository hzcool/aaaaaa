[
    {
        "content": "\u5199\u4e00\u4e2a\u6bd4\u8f83\u81ea\u7136\u7684\u9898\u89e3\uff0c\u4e0d\u9700\u8981\u5229\u7528\u4ec0\u4e48\u6027\u8d28\u3002\u5206\u522b\u7ed9\u51fa\u4e86\u7528\u6811\u72b6\u6570\u7ec4\u3001\u7ebf\u6bb5\u6811\u5b9e\u73b0\u7684\u65b9\u6cd5\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u7686\u4e3a $O(n\\log n)$\u3002\n\n\u7531\u6570\u636e\u8303\u56f4 $0\\le A_i\\le n-1$\uff0c\u6211\u4eec\u60f3\u5230\u679a\u4e3e\u6bcf\u4e2a\u79cd\u7c7b\u7684\u6570\uff0c\u5206\u522b\u8ba1\u7b97\u8d21\u732e\u3002\n\n\u5bf9\u5f53\u524d\u9009\u4e2d\u7684\u6570 $w$\uff0c\u8bbe $S_i$ \u4e3a\u524d $i$ \u4e2a\u6570\u4e2d $w$ \u7684\u4e2a\u6570 \uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u6bb5\u533a\u95f4 $[l+1,r]$ \uff0c$w$ \u80fd\u6210\u4e3a\u7edd\u5bf9\u4f17\u6570\uff08\u6570\u91cf\u4e25\u683c\u8d85\u8fc7\u4e00\u534a\u7684\u4f17\u6570\uff09\u7684\u6761\u4ef6\u662f $S_r-S_l>r-l-(S_r-S_l)$\u3002\n\n\u79fb\u9879\u5f97\u5230 $2S_r-r>2S_l-l$\uff0c\u90a3\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5bf9\u6bcf\u4e2a $r$ \uff0c\u7edf\u8ba1 $l\\in[0,r-1]$ \u7684\u8303\u56f4\u5185\u6709\u591a\u5c11\u6ee1\u8db3 $2S_r-r>2S_l-l$\u3002\uff08\u53ef\u4ee5\u53d1\u73b0\uff0c $2S_i-i$ \u5176\u4e2d\u5c31\u662f\u524d\u7f00\u91cc $w$ \u7684\u4e2a\u6570\u51cf\u53bb\u975e $w$ \u7684\u4e2a\u6570\uff09\u5982\u679c\u7528\u6811\u72b6\u6570\u7ec4\u6765\u7ef4\u62a4\u6bcf\u4e2a $2S_i-i$ \u7684\u4e2a\u6570\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5ea6 $O(n^2log(n))$ \uff0c\u53ea\u80fd\u9a97\u90e8\u5206\u5206\u3002\u5f53\u7136\u6709\u4e9b\u7ec6\u8282\u8981\u6ce8\u610f\uff0c\u6bd4\u5982 $2S_i-i$ \u7684\u503c\u57df\u8303\u56f4\u662f $[-n,n]$ \uff0c\u4f60\u9700\u8981\u52a0\u4e2a $n+1$ \u7684\u504f\u79fb\u91cf\u624d\u80fd\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0\uff0c\u8bb0 $P_i=2S_i-i$\u3002\n\n\u7136\u540e\u89c2\u5bdf\u5bf9\u67d0\u4e2a\u9009\u4e2d\u7684\u6570 $w$\uff0c\u5176 $P_i$ \u7684\u53d8\u5316\u60c5\u51b5\u3002\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u6709 $k$ \u4e2a $w$\uff0c\u90a3\u4e48\u53ef\u4ee5\u5206\u6210 $k+1$ \u4e2a\u533a\u95f4\uff08\u4ee5 $0$ \u4f4d\u7f6e\u53ca\u6bcf\u4e2a $w$ \u4e3a\u5f00\u5934\u5230\u4e0b\u4e2a $w$ \u4e4b\u524d\u7684\u6570\u4e3a\u6b62\uff09\uff0c\u6bcf\u4e2a\u533a\u95f4\u5185\u90e8\u7684 $P_i$ \u503c\u90fd\u662f\u516c\u5dee\u4e3a $-1$ \u7684\u7b49\u5dee\u6570\u5217\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/da2aj13d.png)\n\n\u8fd9\u6837\u5982\u679c\u6211\u4eec\u80fd\u7528\u67d0\u79cd\u65b9\u6cd5\u628a\u6bcf\u6bb5\u91cc\u7684\u6570**\u540c\u65f6\u5904\u7406**\uff0c\u90a3\u4e48\u603b\u5171\u9700\u8981\u5904\u7406\u7684\u6bb5\u6570\u5c31\u662f $O(n)$ \u7684\u4e86\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u5047\u8bbe\u5f53\u524d\u8fd9\u6bb5\u7684\u7b49\u5dee\u6570\u5217\u662f $y,y-1,y-2,\\dots ,x$ \uff0c\u7528\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4\u6743\u503c $c_i$\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u5bf9\u533a\u95f4 $[x,y]$ \u52a0 $1$\u3002\n\n\u5e76\u4e14\u53ef\u4ee5\u53d1\u73b0\u540c\u4e00\u6bb5\u662f\u4e0d\u4f1a\u6709\u4efb\u4f55\u8d21\u732e\u7684\uff08\u56e0\u4e3a\u662f\u9012\u51cf\u7684\uff09\uff0c\u53ea\u9700\u67e5\u8be2\u524d\u9762\u6240\u6709\u6bb5\u7684 $P_i$ \u503c\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u6240\u4ee5\u5728\u66f4\u65b0\u64cd\u4f5c\u4e4b\u524d\uff0c\u6211\u4eec\u5e94\u8be5\u5148\u505a\u67e5\u8be2\uff0c\n\n\u8bb0 $T_i$ \u8868\u793a\u6743\u503c\u7684\u524d\u7f00\u548c\uff0c\u5373 $T_i=\\sum\\limits_{j=1}^{i}c_j$\u3002\u5bf9\u6bb5\u5185\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $P_i$ \uff0c\u6211\u4eec\u5f97\u5230\u7684\u8d21\u732e\u662f $T_{P_i-1}$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u6574\u4e2a\u6bb5\u5185 $[x,y]$ \u8fd9\u4e9b\u6570\uff0c\u603b\u8d21\u732e\u662f $\\sum\\limits_{i=x-1}^{y-1}T_i$\u3002\u8bb0 $G_i$ \u8868\u793a\u6743\u503c\u7684\u524d\u7f00\u548c\u7684\u524d\u7f00\u548c\uff0c\u5373 $G_i=\\sum\\limits_{j=1}^{i}T_j$\uff0c\u90a3\u4e48\u603b\u8d21\u732e\u53ef\u4ee5\u8868\u793a\u4e3a $G_{y-1}-G_{x-1}$\u3002\n\n\u73b0\u5728\u95ee\u9898\u7b80\u5316\u4e3a\u533a\u95f4\u52a0\u4e00\u4e2a\u6570\u548c\u6c42\u4e8c\u9636\u524d\u7f00\u548c\uff0c\u4e0b\u9762\u5206\u522b\u7528\u6811\u72b6\u6570\u7ec4\u548c\u7ebf\u6bb5\u6811\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1a\n\n---\n\n### \u6811\u72b6\u6570\u7ec4\n\n\u60f3\u5fc5\u4f60\u7528\u6811\u72b6\u6570\u7ec4\u505a\u8fc7 \u201c\u533a\u95f4\u52a0\u4e00\u4e2a\u6570\uff0c\u533a\u95f4\u6c42\u548c\u201d\u7684\u95ee\u9898\uff0c\u672c\u8d28\u5355\u70b9\u66f4\u65b0\uff0c\u662f\u6c42\u4e8c\u9636\u524d\u7f00\u548c\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u4f7f\u7528 $n$ \u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5355\u70b9\u66f4\u65b0\uff0c\u67e5\u8be2 $n$ \u9636\u524d\u7f00\u548c\uff1a\n\n\u6bd4\u5982 $n=3$ \u65f6\uff0c\n\n\u8bbe $c$ \u662f $b$ \u7684\u524d\u7f00\u548c\uff0c $b$ \u662f $a$ \u7684\u524d\u7f00\u548c\uff0c$a$ \u662f $d$ \u7684\u524d\u7f00\u548c\uff0c\u5373 $c$ \u662f $d$ \u7684\u4e09\u9636\u524d\u7f00\u548c\uff0c\u90a3\u4e48\u6709\n\n\n$$\n\\begin{aligned}\n&c_x=\\sum\\limits_{i=1}^{x} b_i\\\\\n&=\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=1}^{i} a_j\\\\\n&=\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=1}^{i}\\sum\\limits_{k=1}^{j}d_k\\\\\n&=\\sum\\limits_{k=1}^{x}\\frac{(x+2-k)(x+1-k)}{2}d_k\\\\\n&=\\frac{(x+2)(x+1)}{2}\\sum\\limits_{k=1}^{x}d_k-\\frac{2x+3}{2}\\sum\\limits_{k=1}^{x}d_k\\cdot k+\\frac{1}{2}\\sum\\limits_{k=1}^{x}d_k\\cdot k^2\n\\end{aligned}\n$$\n\n\u5bf9\u8fd9\u9898\u800c\u8a00\uff0c\u73b0\u5728\u533a\u95f4\u66f4\u65b0\u53ef\u4ee5\u8f6c\u6362\u4e3a\u5dee\u5206\u6570\u7ec4 $d$ \u7684\u4e24\u4e2a\u5355\u70b9\u66f4\u65b0\uff0c\u539f\u6570\u7ec4\u7684\u4e8c\u9636\u524d\u7f00\u548c\u53d8\u4e3a\u5dee\u5206\u6570\u7ec4 $d$ \u7684\u4e09\u9636\u524d\u7f00\u548c\u3002\n\n\u90a3\u4e48\u53ea\u8981\u7528\u4e09\u4e2a\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4 $d_i,d_i\\times i,d_i\\times i^2$ \u5373\u53ef\uff0c\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst int INF = 0x3f3f3f3f;\nconst LL mod = 1e9 + 7;\nconst int N = 500005;\n// \u4fee\u6539\u5dee\u5206 \u6765\u7ef4\u62a4\u524d\u7f00\u548c\u7684\u524d\u7f00\u548c\n// c1 \u4e3a\u5dee\u5206d c2\u4e3ad*i  c3 \u4e3ad*i*i\nLL c1[N * 2], c2[N * 2], c3[N * 2];\nLL sum(int x) {\n    LL res = 0;\n    for (int i = x; i > 0; i -= i & -i) {\n        res += c1[i] * (x + 2) * (x + 1) - c2[i] * (2 * x + 3) + c3[i];\n    }\n    return res / 2;\n}\nvoid add(int x, LL d, int n) {\n    for (int i = x; i <= n; i += i & -i) {\n        c1[i] += d;\n        c2[i] += d * x;\n        c3[i] += d * x * x;\n    }\n}\nint a[N];\nvector<int> b[N];\nint main() {\n    int n;\n    scanf(\"%d%*d\", &n);\n    for (int i = 1; i <= n; i++) {\n        scanf(\"%d\", &a[i]);\n        b[a[i]].push_back(i);\n    }\n    const int wc = n + 1;  // \u504f\u79fb\u91cf\uff0c\u628a[-n,n] \u5e73\u79fb\u5230 [1,2n+1]\n    LL ans = 0;\n    for (int i = 0; i < n; i++) {\n        b[i].push_back(n + 1);\n        int last = 0;\n        for (int j = 0; j < b[i].size(); j++) {\n            int y = 2 * j - last + wc, x = 2 * j - (b[i][j] - 1) + wc;\n            // \u67e5\u8be2 sum([1,t-1] \u7684\u6743\u503c\u548c), \u5176\u4e2dt\u5728[x,y]\u8303\u56f4\u5185\uff0c\n            ans += sum(y - 1) - (x >= 3 ? sum(x - 2) : 0);\n            // [x,y] \u8fd9\u4e9b\u6570\u7684\u6743\u503c+1\n            add(x, 1, 2 * n + 1);\n            add(y + 1, -1, 2 * n + 1);\n            last = b[i][j];\n        }\n        last = 0;\n        for (int j = 0; j < b[i].size(); j++) {\n            int y = 2 * j - last + wc, x = 2 * j - (b[i][j] - 1) + wc;\n            add(x, -1, 2 * n + 1);\n            add(y + 1, 1, 2 * n + 1);\n            last = b[i][j];\n        }\n    }\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```\n\n---\n\n### \u7ebf\u6bb5\u6811\n\n\u5176\u5b9e\u4e5f\u53ef\u4ee5\u7528\u4e24\u68f5\u7ebf\u6bb5\u6811\u6765\u6c42\u4e8c\u9636\u524d\u7f00\u548c\uff0c\u4f46\u8fd9\u5c31\u6ca1\u6709\u610f\u601d\u4e86\uff0c\u548c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u4e09\u9636\u524d\u7f00\u548c\u6ca1\u533a\u522b\u3002\n\n\u6211\u7684\u65b9\u6cd5\u662f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6743\u503c\u7684\u524d\u7f00\u548c $T_i$ \uff0c\u8fd9\u6837\u5728 $[x,y]$ \u4e0a\u7684\u533a\u95f4\u52a0 $1$ \u5c31\u53d8\u6210\u4e86\uff1a\u5728 $[x,y]$ \u4e0a\u52a0\u7b49\u5dee\u6570\u5217 $1,2,3,\\ldots,y-x+1$\uff0c\u5728 $[y+1,2n+1]$ \u4e0a\u52a0\u4e0a $y-x+1$\u3002\u540e\u8005\u4e5f\u53ef\u770b\u6210\u662f\u516c\u5dee\u4e3a $0$ \u7684\u7b49\u5dee\u6570\u5217\u3002\n\n\u90a3\u4e48\u7ebf\u6bb5\u6811\u600e\u4e48\u7ef4\u62a4\u7b49\u5dee\u6570\u5217\u5462\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4efb\u610f\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u548c\u90fd\u662f\u7b49\u5dee\u6570\u5217\uff0c\u53ea\u662f\u516c\u5dee\u548c\u9996\u9879\u53d1\u751f\u4e86\u53d8\u5316\u3002\n\n\u90a3\u4e48\u53ea\u8981\u628a\u516c\u5dee\u548c\u9996\u9879\u4f5c\u4e3a\u5ef6\u8fdf\u6807\u8bb0\uff0c\u6765\u7ef4\u62a4\u533a\u95f4\u548c\u5c31\u597d\u4e86\uff0c\u5177\u4f53\u5b9e\u73b0\u89c1\u4ee3\u7801\u3002\n\n\u56e0\u4e3a\u7ef4\u62a4\u7684\u662f $T_i$ \uff0c\u67e5\u8be2\u4e5f\u53ea\u662f\u7b80\u5355\u7684\u533a\u95f4\u67e5\u8be2\u4e86\uff0c\u6ce8\u610f\u4e00\u4e9b\u8fb9\u754c\u95ee\u9898\u5c31OK\u4e86\u3002\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst int INF = 0x3f3f3f3f;\nconst LL mod = 1e9 + 7;\nconst int N = 500005;\n\n// sx,gc \u8868\u793a\u9996\u9879\u548c\u516c\u5dee\nLL val[N << 3], sx[N << 3], gc[N << 3];\ninline void push_up(int u) {\n    val[u] = val[u << 1] + val[u << 1 | 1];\n}\ninline void gx(int u, LL v, LL d, int len) {\n    val[u] += (v + v + (len - 1) * d) * len / 2;\n    sx[u] += v;\n    gc[u] += d;\n}\ninline void push_down(int u, int len1, int len2) {\n    if (sx[u] || gc[u]) {\n        gx(u << 1, sx[u], gc[u], len1);\n        gx(u << 1 | 1, sx[u] + gc[u] * len1, gc[u], len2);\n        sx[u] = gc[u] = 0;\n    }\n}\nvoid update(int u, int l, int r, int x, int y, int v, int d) {\n    if (x <= l && r <= y) {\n        gx(u, v + (l - x) * d, d, r - l + 1);\n        return;\n    }\n    int mid = l + r >> 1;\n    push_down(u, mid - l + 1, r - mid);\n    if (x <= mid) update(u << 1, l, mid, x, y, v, d);\n    if (y > mid) update(u << 1 | 1, mid + 1, r, x, y, v, d);\n    push_up(u);\n}\nLL query(int u, int l, int r, int x, int y) {\n    if (x <= l && r <= y) {\n        return val[u];\n    }\n    int mid = l + r >> 1;\n    push_down(u, mid - l + 1, r - mid);\n    LL res = 0;\n    if (x <= mid) res += query(u << 1, l, mid, x, y);\n    if (y > mid) res += query(u << 1 | 1, mid + 1, r, x, y);\n    return res;\n}\nint a[N];\nvector<int> b[N];\nint main() {\n    int n;\n    scanf(\"%d%*d\", &n);\n    for (int i = 1; i <= n; i++) {\n        scanf(\"%d\", &a[i]);\n        b[a[i]].push_back(i);\n    }\n    const int wc = n + 1;  // \u504f\u79fb\u91cf\uff0c\u628a[-n,n] \u5e73\u79fb\u5230 [1,2n+1]\n    LL ans = 0;\n    for (int i = 0; i < n; i++) {\n        b[i].push_back(n + 1);\n        int last = 0;\n        for (int j = 0; j < b[i].size(); j++) {\n            int y = 2 * j - last + wc, x = 2 * j - (b[i][j] - 1) + wc;\n            // \u67e5\u8be2 sum([1,t-1] \u7684\u6743\u503c\u548c), \u5176\u4e2dt\u5728[x,y]\u8303\u56f4\u5185\n            ans += query(1, 1, 2 * n + 1, max(x - 1, 1), y - 1);\n            // [x,y] \u8fd9\u4e9b\u6570\u7684\u6743\u503c+1\uff0c\u771f\u6b63\u8981\u7ef4\u62a4\u7684\u662f\u5b83\u4eec\u7684\u524d\u7f00\u548c\uff0c\n            // \u5728[x,y] \u4e0a\u662f\u52a0\u4e0a\u4e00\u6bb5\u7b49\u5dee\u6570\u5217 1,2,3,...,y-x+1\uff0c[y+1,2n+1] \u4e0a\u6bcf\u4e2a\u6570+y-x+1\n            update(1, 1, 2 * n + 1, x, y, 1, 1);\n            if (x + 1 <= 2 * n + 1) update(1, 1, 2 * n + 1, y + 1, 2 * n + 1, y - x + 1, 0);\n            last = b[i][j];\n        }\n        last = 0;\n        for (int j = 0; j < b[i].size(); j++) {\n            int y = 2 * j - last + wc, x = 2 * j - (b[i][j] - 1) + wc;\n            update(1, 1, 2 * n + 1, x, y, -1, -1);\n            if (x + 1 <= 2 * n + 1) update(1, 1, 2 * n + 1, y + 1, 2 * n + 1, -(y - x + 1), 0);\n            last = b[i][j];\n        }\n    }\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```\n\n\u6700\u540e\uff0c\u540c\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log n)$\uff0c\u4f46\u662f\u7ebf\u6bb5\u6811\u8dd1\u7684\u65f6\u95f4\u662f\u6811\u72b6\u6570\u7ec4\u7684\u4e09\u500d\u3002",
        "postTime": 1597304349,
        "uid": 54357,
        "name": "OMG_wc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "> ### [Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\n>\n> \u7ecf\u5178\u8001\u9898\uff0c\u6d1b\u8c37\u539f\u9898\u94fe\u63a5\uff1ahttps://www.luogu.com.cn/problem/P4062\u3002\n\n**\u7ebf\u6027\u505a\u6cd5\uff01**\n\n---\n\n\u7531\u4e8e\u51fa\u73b0\u6b21\u6570\u4e25\u683c\u5927\u4e8e $\\dfrac{r-l+1}2$\uff0c\u6240\u4ee5\u4e00\u4e2a\u533a\u95f4\u6700\u591a\u88ab\u4e00\u4e2a\u4f17\u6570\u8d21\u732e\u3002\u56e0\u6b64\u8003\u8651\u6c42\u51fa\u6bcf\u4e2a\u6570\u4f5c\u4e3a\u7b26\u5408\u9898\u610f\u7684\u4f17\u6570\u51fa\u73b0\u7684\u533a\u95f4\u4e2a\u6570\u4e4b\u548c\u5373\u7b54\u6848\u3002\n\n\u6211\u4eec\u8bbe\u5e8f\u5217 $s_k$ \u8868\u793a $k$ \u7684\u51fa\u73b0\u6b21\u6570\u524d\u7f00\u548c\uff0c\u5373 $s_{k,i}=\\sum_{j=1}^i[a_j=k]$\u3002\u6839\u636e\u9898\u610f\uff0c\u4e00\u4e2a\u533a\u95f4 $[l+1,r]$ \u88ab $k$ \u8d21\u732e\u5f53\u4e14\u4ec5\u5f53 $s_{k,r}-s_{k,l}>\\dfrac{r-l}2$\u3002\u7a0d\u4f5c\u53d8\u5f62\u5f97 $2s_{k,r}-r>2s_{k,l}-l$\u3002\u8fd9\u5c31\u5f88\u663e\u7136\u4e86\uff0c\u5373\u6c42 $2s_{k,i}-i$ \u7684\u9006\u5e8f\u5bf9\u6570\u3002\n\n\u4f46\u662f\u6211\u4eec\u4e0d\u80fd\u5bf9\u6bcf\u4e2a $k$ \u90fd $n\\log n$ \u6c42\u4e00\u904d\u9006\u5e8f\u5bf9\u3002\u6ce8\u610f\u5230\u51fa\u73b0\u6b21\u6570\u603b\u6570\u4e3a $n$\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u56fa\u5b9a\u7684 $k$ \u53ef\u80fd\u6709\u4e00\u5927\u4e32 $s_k$\uff08$s_{k,p}\\sim s_{k,q}$\uff09\u90fd\u76f8\u540c\uff0c\u6ce8\u610f\u5230\u8ba1\u7b97\u8d21\u732e\u5176\u5b9e\u5c31\u662f\u8be2\u95ee $q-p+1$ \u6bb5\u524d\u7f00\u548c\uff0c\u4e14\u53f3\u7aef\u70b9\u9012\u51cf\uff0c\u5373\u77e9\u5f62 + \u7b49\u8170\u76f4\u89d2\u4e09\u89d2\u5f62\u3002\u8fd9\u4e2a\u663e\u7136\u53ef\u4ee5\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4 $\\sum v_i$\uff08\u77e9\u5f62\uff09\u4ee5\u53ca $\\sum i\\times v_i$\uff08\u7528\u68af\u5f62\u51cf\u53bb\u77e9\u5f62\u5c31\u5f97\u5230\u4e86\u7b49\u8170\u76f4\u89d2\u4e09\u89d2\u5f62\uff09\u3002\u5728\u7ebf\u6bb5\u6811\u4e2d\u52a0\u5165\u8fd9\u4e9b\u503c\uff08$s_{k,p}-p\\sim s_{k,q}-q$\uff09\u5c31\u662f\u533a\u95f4\u52a0\u4e86\u3002\n\n\u6b64\u5916\u6e05\u7a7a\u4e0d\u80fd\u76f4\u63a5 memset \u5426\u5219\u590d\u6742\u5ea6\u4f1a\u9000\u5316\u4e3a $n^2$\uff0c\u9700\u8981\u8bb0\u5f55\u505a\u8fc7\u7684\u64cd\u4f5c\u7136\u540e\u64a4\u9500\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n\u7528\u7ebf\u6bb5\u6811\u88ab\u5361\u5e38\u4e86\u600e\u4e48\u529e\uff1f\u8fd8\u6709\u6811\u72b6\u6570\u7ec4\u3002\u6ce8\u610f\u5230\u4e00\u6b21\u4fee\u6539\u5b9e\u9645\u4e0a\u662f\u5728\u5dee\u5206\u6570\u7ec4\u4e0a\u533a\u95f4\u52a0\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e2a $i\\in [p,q]$\uff0c\u90fd\u7ed9 $s_{k,p}-i\\sim \\mathrm{upperbound}$ \u52a0\u4e0a $1$\uff0c\u4e00\u6b21\u4fee\u6539\u662f\u5dee\u5206\u6570\u7ec4\u5355\u70b9\u52a0\uff0c\u4e24\u6b21\u5c31\u662f\u533a\u95f4\u52a0\u3002\u8003\u8651\u7ef4\u62a4\u5dee\u5206\u6570\u7ec4\u7684\u5dee\u5206\u6570\u7ec4\uff0c\u90a3\u4e48\u533a\u95f4\u6c42\u548c\u5c31\u662f\u6c42**\u4e09\u6b21\u524d\u7f00\u548c**\uff1a\u6211\u4eec\u7ef4\u62a4\u7684\u4e1c\u897f\u7684\u524d\u7f00\u548c\u662f\u5dee\u5206\u6570\u7ec4\uff0c\u5dee\u5206\u6570\u7ec4\u7684\u524d\u7f00\u548c\u662f\u539f\u6570\u7ec4\uff0c\u539f\u6570\u7ec4\u7684\u524d\u7f00\u548c\u5c31\u662f\u6211\u4eec\u8981\u5355\u70b9\u6c42\u7684\u4e1c\u897f\u3002\n\n\u5bf9\u4e8e\u8fd9\u79cd**\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u9ad8\u9636\u524d\u7f00\u548c**\u7684\u95ee\u9898\uff0c\u4e00\u822c\u8003\u8651\u5728 $p$ \u5904\u52a0\u4e0a $1$ \u5bf9 $q$ \u7684\u8d21\u732e\uff1a$\\sum_{i=p}^{q}i-p+1$\uff1a\u4e00\u9636\u5dee\u5206\u6570\u7ec4\u5728 $p$ \u5904 $+1$ \u4f1a\u5728\u539f\u6570\u7ec4\u524d\u7f00\u548c\u7684 $q$ \u5904\u8d21\u732e $q-p+1$\uff0c\u800c\u4e8c\u9636\u5dee\u5206\u6570\u7ec4\u5728 $p$ \u5904 $+1$ \u4f1a\u5728\u4e00\u9636\u5dee\u5206\u6570\u7ec4\u7684 $p\\sim q$ \u5904\u90fd\u52a0\u4e0a $1$\uff0c\u6545\u6709\u6b64\u5f0f\u3002\u5148\u4e58\u4ee5 $2$\uff08\u56e0\u4e3a\u6709\u7b49\u5dee\u6570\u5217\u6c42\u548c\uff0c\u8ba1\u7b97\u9664\u4ee5 $2$ \u4e0d\u65b9\u4fbf\uff09\u7a0d\u4f5c\u5316\u7b80\u5f97\u5230 $(p+q)(q-p+1)+2(1-p)(q-p+1)$\uff0c\u8fd9\u91cc\u51fa\u73b0\u4e86 $q$ \u7684 $0,1,2$ \u6b21\u9879\uff0c\u5206\u522b\u7ef4\u62a4\u5176\u7cfb\u6570\u5373 $(p^2-3p+2)q^0+(-2p+3)q+q^2$\uff0c\u6700\u540e\u7b54\u6848\u9664\u4ee5 $2$ \u5373\u53ef\u3002\n\n```cpp\nconst int N = 5e5 + 5;\n\nll n, type, ans;\nvint buc[N];\nstruct BIT {\n\tll a0[N << 1], a1[N << 1], a2[N << 1];\n\tvoid add(ll x, int v) {\n\t\tll c0 = (x * x - 3 * x + 2) * v, c1 = (3 - 2 * x) * v;\n\t\twhile(x <= n * 2 + 1) a0[x] += c0, a1[x] += c1, a2[x] += v, x += x & -x;\n\t}\n\tvoid add(int l, int r, int v) {add(l + n + 1, v), add(r + n + 2, -v);}\n\tll query(int x) {\n\t\tll t = x, c0 = 0, c1 = 0, c2 = 0;\n\t\twhile(x) c0 += a0[x], c1 += a1[x], c2 += a2[x], x -= x & -x;\n\t\treturn c0 + c1 * t + c2 * t * t;\n\t}\n\tll query(int l, int r) {return query(r + n + 1) - query(l + n);}\n} tr;\n\nvpii d;\nvoid doit(int l, int r) {tr.add(l, r, 1), d.pb(l, r);}\nvoid discard() {for(pii it : d) tr.add(it.fi, it.se, -1); d.clear();}\nvoid solve(vint &cur) {\n\tfor(int i = 1; i < cur.size(); i++) {\n\t\tint pre = cur[i - 1], now = cur[i], s = i - 1 << 1;\n\t\tif(pre + 1 < now) {\n\t\t\tint l = s - now + 1, r = s - pre - 1;\n\t\t\tif(i > 1) ans += tr.query(l - 1, r - 1);\n\t\t\tdoit(l, r);\n\t\t}\n\t\tif(i < cur.size() - 1) {\n\t\t\tint p = i * 2 - now;\n\t\t\tans += tr.query(p - 1, p - 1), doit(p, p);\n\t\t}\n\t}\n\tdiscard();\n}\n\nint main(){\n\tcin >> n >> type;\n\tfor(int i = 0; i < n; i++) buc[i].pb(0);\n\tfor(int i = 1; i <= n; i++) buc[read()].pb(i);\n\ttr.add(0, 0, 1);\n\tfor(int i = 0; i < n; i++) buc[i].pb(n + 1), solve(buc[i]);\n\tcout << ans / 2 << endl;\n    return 0;\n}\n```\n\n**\u80fd\u4e0d\u80fd\u518d\u7ed9\u529b\u4e00\u70b9\u554a**\uff1f\u53ef\u4ee5\u3002\n\n\u4e0d\u59a8\u8bbe $d_i$ \u8868\u793a $2s_{k,i}-i$\u3002\n\n**observation 1**\uff1a\u5bf9\u4e8e\u56fa\u5b9a\u7684\u4f17\u6570 $k$\uff0c\u6700\u591a\u6709 $2s_{k,n}$ \u4e2a\u4f4d\u7f6e\u5bf9\u7b54\u6848\u6709\u8d21\u732e\u3002\u5373\u5bf9\u4e8e\u6240\u6709 $k$\uff0c\u4f7f\u5f97 $d_p>\\min_{i=1}^{p-1}d_i$ \u7684 $p$ \u4e2a\u6570\u4e4b\u548c\u662f $\\mathcal{O}(n)$ \u7684\u3002\u611f\u6027\u7406\u89e3\u5373\u82e5\u51fa\u73b0\u7684 $0\\ (a_i\\neq k)$ \u8db3\u591f\u591a\uff0c\u65e0\u8bba\u5de6\u7aef\u70b9\u600e\u4e48\u5f80\u5de6\u6269\u5c55\u90fd\u65e0\u6cd5\u4f7f $k$ \u7b26\u5408\u6761\u4ef6\u3002\n\n\u4e0a\u8ff0\u7ed3\u8bba\u4f7f\u6211\u4eec\u4e0d\u9700\u8981\u6c42\u539f\u6570\u7ec4\u7684\u533a\u95f4\u548c\uff0c\u53ea\u9700\u8981\u5bf9\u4e8e\u8fde\u7eed\u9012\u51cf\u7684\u4e00\u6bb5 $d_i$\uff0c\u67e5\u8be2\u5355\u70b9\u5373\u6c42\u51fa\u4e8c\u9636\u5dee\u5206\u6570\u7ec4\u7684\u4e8c\u9636\u524d\u7f00\u548c\uff0c\u76f4\u5230\u5f53\u524d\u7684 $d_i$ **\u5c0f\u4e8e $d_i$ \u7684\u524d\u7f00\u6700\u5c0f\u503c**\uff0c\u56e0\u4e3a\u518d\u679a\u4e3e\u4e0b\u53bb\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $0$\uff08\u6ce8\u610f\u5230\u6211\u4eec\u662f\u7ed9 $[d_i+1,\\infty]$ \u533a\u95f4\u52a0 $1$ \uff09\uff0c\u76f4\u63a5\u5ffd\u7565\u3002\u53ef\u4ee5\u663e\u8457\u51cf\u5c0f\u5e38\u6570\u3002\u4f46\u95ee\u9898\u4ecd\u4e0d\u5f31\u4e8e\u6c42\u9006\u5e8f\u5bf9\u4e2a\u6570\u3002\n\n**observation 2**\uff1a$|d_i-d_{i-1}|\\leq 1$\u3002 \n\n\u4e0a\u8ff0\u7ed3\u8bba\u4fdd\u8bc1\u4e86\u6bcf\u6b21\u67e5\u8be2\u7684\u95f4\u9694\u4e0d\u8d85\u8fc7 $1$\uff0c\u9664\u4e86\u5bf9\u4e8e\u8fde\u7eed\u9012\u51cf\u7684\u4e00\u6bb5 $d_{l\\sim r}$ \u7684\u6700\u540e\u4e00\u6b21\u67e5\u8be2\uff08\u4e0d\u59a8\u8bbe\u4e3a\u4f4d\u7f6e $p$\uff09\u4e0e $d_{r+1}$ \u4e4b\u95f4\u4f1a\u6709\u4e00\u4e2a\u95f4\u9694\uff0c\u4f46\u662f\u5ffd\u7565\u8fd9\u4e2a\u95f4\u9694\u8fd9\u5e76\u4e0d\u5f71\u54cd\u7ed3\u679c\uff0c\u56e0\u4e3a $d_{r+1}-1\\sim d_p-1$ \u8fd9\u4e00\u6bb5\u5e76\u6ca1\u6709\u8fdb\u884c\u4efb\u4f55\u4fee\u6539\uff1a\u5b83\u5c0f\u4e8e $d_l$ \u7684\u524d\u7f00\u6700\u5c0f\u503c\uff0c\u81ea\u7136\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u8d21\u732e\u3002\u90a3\u4e48\u7531\u4e8e\u6307\u9488\u7684\u79fb\u52a8\u8ddd\u79bb\u4e4b\u548c\u662f $\\mathcal{O}(n)$ \u7684\uff0c\u56e0\u6b64\u76f4\u63a5\u7ef4\u62a4\u4e8c\u9636\u5dee\u5206\u6570\u7ec4\uff0c\u4e00\u9636\u5dee\u5206\uff08\u57fa\u4e8e\u4e8c\u9636\u5dee\u5206\u6570\u7ec4\u4fee\u6539\uff09\u548c\u5f53\u524d\u4f4d\u7f6e\u7684\u503c\uff08\u57fa\u4e8e\u4e00\u9636\u5dee\u5206\u4fee\u6539\uff09\u5373\u53ef\u505a\u5230\u7ebf\u6027\u3002\n\n```cpp\nconst int N = 5e5 + 5;\n\nint n, type, add[N << 1], del[N << 1], s[N];\nint cnt, hd[N], nxt[N << 1], val[N << 1];\nvoid link(int u, int v) {nxt[++cnt] = hd[u], hd[u] = cnt, val[cnt] = v;}\nvoid modify(int l, int r, int v) {add[l + N] += v, del[r + N + 1] += v;}\nll ans;\n\nint main(){\n\tcin >> n >> type, modify(1, 1, 1);\n\tfor(int i = 1; i <= n; i++) link(read(), i);\n\tfor(int p = 0; p < n; p++) {\n\t\tif(!hd[p]) continue;\n\t\tint minp = 0, id = 1;\n\t\tstatic int tmp[N]; tmp[0] = 0, tmp[1] = n + 1;\n\t\tfor(int i = hd[p]; i; i = nxt[i]) tmp[++id] = val[i];\n\t\treverse(tmp + 1, tmp + id + 1);\n\t\tll dc = 0, c = 0;\n\t\tfor(int i = 1; i <= id; i++) {\n\t\t\tint pre = tmp[i - 1], cur = tmp[i];\n\t\t\tint r = s[i - 1] - 1, l = r - (cur - pre) + 2;\n\t\t\tif(l <= r && pre) {\n\t\t\t\tint lim = max(minp, l);\n\t\t\t\tfor(int j = r; j >= lim; j--) {\n\t\t\t\t\tc -= dc, ans += c;\n\t\t\t\t\tdc += del[j + N + 1] - add[j + N + 1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(i == id) break;\n\t\t\tmodify(l + 1, r + 1, 1);\n\t\t\tdc += add[l + N + 1] - del[l + N + 1];\n\t\t\tc += dc, ans += c, s[i] = l + 1;\n\t\t\tmodify(s[i] + 1, s[i] + 1, 1), cmin(minp, l);\n\t\t}\n\t\tfor(int i = 1; i < id; i++)\n\t\t\tmodify(s[i], s[i - 1], -1),\n\t\t\tmodify(s[i] + 1, s[i] + 1, -1);\n\t}\n\tcout << ans << endl;\n    return cerr << clock() << endl, flush(), 0;\n}\n```",
        "postTime": 1634619512,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P4062 [Code+#1] Yazid \u7684\u65b0\u751f\u821e\u4f1a"
    },
    {
        "content": "Update on 7.7\n\n\u88ab\u4e24\u4e2a $\\log$ \u7684\u505a\u6cd5\u540a\u6253\u5462,\u88ab [$\\sf \\color{black}{e}\\color{red}{xz\\alpha ng}$](https://www.luogu.com.cn/blog/id-exzang/solution-p4062) \u7684\u4e09 $\\log$ \u505a\u6cd5\u540a\u6253\u5462,\u81ea\u95ed\u4e86/kk.\n\n#  \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217,\u8be2\u95ee\u53c8\u591a\u5c11\u5b50\u4e32 $[l,r]$ \u6ee1\u8db3\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684\u6570\u51fa\u73b0\u4e86**\u5927\u4e8e** $\\lfloor\\frac{r-l+1}{2}\\rfloor$ \u6b21(\u5176\u5b9e\u5c31\u662f\u95ee\u53c8\u591a\u5c11\u5b50\u4e32\u6709[\u7edd\u5bf9\u4f17\u6570]([https://www.baidu.com/s?ie=UTF-8&wd=%E7%BB%9D%E5%AF%B9%E4%BC%97%E6%95%B0](https://www.baidu.com/s?ie=UTF-8&wd=\u7edd\u5bf9\u4f17\u6570))).\n\n# \u5206\u6790\n\n\u597d\u50cf\u6709\u4e00\u79cd\u9ad8\u5927\u4e0a\u7684\u5206\u6cbb\u505a\u6cd5,\u4f46\u662f\u6211\u4e0d\u4f1a.\n\n\u8003\u8651 $a_i\\in[0,1]$ \u600e\u4e48\u505a,\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u4e32\u6700\u591a\u53ea\u4f1a\u6709\u4e00\u4e2a\u7edd\u5bf9\u4f17\u6570,\u6240\u4ee5\u8003\u8651\u8ba1\u7b97 $0$ \u548c $1$ \u5206\u522b\u4e3a\u7edd\u5bf9\u4f17\u6570\u65f6\u7684\u7b54\u6848,\u76f8\u52a0\u5c31\u597d\u4e86.\n\n\u5982\u679c\u4e00\u4e2a\u5b50\u4e32\u62e5\u6709\u7edd\u5bf9\u4f17\u6570,\u90a3\u4e48\u5fc5\u5b9a\u6709\u4e00\u4e2a\u6570\u51fa\u73b0\u7684\u6b21\u6570\u5927\u4e8e\u5176\u4ed6\u6240\u6709\u6570\u51fa\u73b0\u7684\u6b21\u6570\u4e4b\u548c,\u90a3\u4e48\u5c06 $a_i=p$ \u7684\u4f4d\u7f6e\u4e3a $1$,$a_i\\not=p$ \u7684\u4f4d\u7f6e\u4e3a $-1$($p$ \u4e3a\u8170\u8ba1\u7b97\u8d21\u732e\u7684\u6570),\u5c31\u662f\u8981\u8ba1\u7b97\u6709\u591a\u5c11\u5b50\u4e32\u7684\u548c\u5927\u4e8e $0$.\u8003\u8651\u518d\u524d\u7f00\u548c\u4e00\u4e0b,\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u627e\u987a\u5e8f\u5bf9($i<j\\land sum_i<sum_j$)\u4e2a\u6570,\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4(\u6743\u503c\u7ebf\u6bb5\u6811,\u5e73\u8861\u6811\u7b49\u6570\u636e\u7ed3\u6784\u8f7b\u677e\u89e3\u51b3),\u7136\u540e\u60a8\u53d1\u73b0 $a_i\\leq 7$ \u7684\u90e8\u5206\u4e5f\u5199\u5b8c\u4e86.\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(kn\\log n)$(\u5176\u4e2d $k$ \u4e3a\u5e8f\u5217\u4e2d\u4e0d\u540c\u6570\u4e2a\u6570).\n\n\u4f46\u662f\u5bf9\u4e8e\u6700\u5927\u7684\u6570\u636e\u5176\u4e2d\u4e0d\u540c\u6570\u7684\u4e2a\u6570\u6709 $n$ \u79cd,\u663e\u7136\u4e0d\u80fd\u8fd9\u6837\u641e\u4e86,\u8003\u8651\u53bb\u4f18\u5316\u8fd9\u4e2a\u65b9\u6cd5.\n\n\u5047\u8bbe\u5e8f\u5217 $a$ \u4e3a $[1,1,2,3,2,1,3]$.\n\n\u5148\u679a\u4e3e\u5230 $1$,\u5c06\u7b49\u4e8e $1$ \u7684\u4f4d\u7f6e\u5728\u5e8f\u5217 $b$ \u4e2d\u6539\u4e3a $1$,\u5176\u4ed6\u5730\u65b9\u6539\u4e3a $-1$.\n\n\u90a3\u4e48 $b$ \u4e3a $[1,1,-1,-1,-1,1,-1]$.\n\n\u8ba1\u7b97\u4e00\u4e0b\u524d\u7f00\u548c.\n\n$sum=[0,1,2,1,0,-1,0,-1]$(\u4e0d\u8981\u5fd8\u8bb0\u5728\u5f00\u5934\u6709\u4e00\u4e2a $0$).\n\n\u8ba1\u7b97\u987a\u5e8f\u5bf9\u4e2a\u6570\u4e3a $5$.\n\n\u518d\u679a\u4e3e\u5230 $2\\dots$\n\n\u4e0d\u96be\u53d1\u73b0\u5728\u5e8f\u5217 $b$ \u4e2d\u4f1a\u6709\u5f88\u591a\u8fde\u7eed\u7684 $-1$,\u800c\u4e14\u8fd9\u4e9b\u8fde\u7eed\u7684 $-1$ \u7684\u6bb5\u6570\u6700\u591a\u4e3a $2n-2$(\u548c $n$ \u540c\u9636),\u5e76\u4e14\u5728 $b$ \u4e2d\u4e3a $1$ \u7684\u4f4d\u7f6e\u7684\u6570\u91cf\u6070\u597d\u4e3a $n$.\n\n\u800c\u4e14\u8fd9\u4e9b\u8fde\u7eed\u7684 $-1$ \u5728\u524d\u7f00\u548c\u4e2d\u4e3a\u4e00\u6bb5\u516c\u5dee\u4e3a $-1$ \u7684\u7b49\u5dee\u6570\u5217,\u65e2\u7136\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u6570\u52a0\u5165,\u90a3\u4e48\u81ea\u7136\u53ef\u4ee5\u60f3\u5230\u5728\u6743\u503c\u7ebf\u6bb5\u6811\u4e0a\u6253\u6807\u8bb0.\n\n\u90a3\u4e48\u6bd4\u8f83\u9ebb\u70e6\u7684\u662f\u8fd9\u6bb5\u6570\u8ba1\u7b97\u8d21\u732e.\n\n\u5047\u8bbe\u4e2d\u95f4\u8fd9\u6bb5\u6570\u7684\u524d\u7f00\u548c\u4e3a $sum_l,sum_{l+1},\\dots,sum_{r-1},sum_r$,\u90a3\u4e48\u5bf9\u4e8e \u8fd9\u6bb5\u6570\u7684\u8d21\u732e\u4e3a $\\sum\\limits_{i=l}^{r}\\sum\\limits_{j=0}^{l-1}(sum_j<sum_i)$,\u5176\u4e2d\u628a\u8fd9\u6bb5\u6570\u4e3a\u516c\u5dee\u4e3a $-1$ \u7684\u7b49\u5dee\u6570\u5217\u8fd9\u4e2a\u7ed3\u8bba\u5e26\u5165\u5c31\u53d8\u6210\u4e86 $\\sum\\limits_{i=0}^{r-l}\\sum\\limits_{j=0}^{l-1}(sum_j<sum_l-i)$,\u5047\u8bbe\u7528\u4e00\u4e2a $s$ \u6570\u7ec4\u6765\u8bb0\u5f55 $sum_{i\\in[0,l-1]}$ \u4e2d\u6bcf\u4e2a\u6570\u51fa\u73b0\u7684\u6b21\u6570,\u90a3\u4e48\u8fd9\u4e2a\u516c\u5f0f\u5c31\u53d8\u6210\u4e86 $\\sum\\limits_{i=0}^{r-l}[(r-l-i)s_{sum_l-1-i}]+(r-l+1)\\sum\\limits_{i=-\\infty}^{sum_r-1}s_i$.\u90a3\u4e48\u53ea\u9700\u8981\u5728\u6743\u503c\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u4e00\u4e2a $\\sum\\limits_{i=l}^{r}(r-i+1)s_i$,\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8ba1\u7b97\u4e86.\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$.\n\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REP(i,first,last) for(int i=first;i<=last;++i)\n#define DOW(i,first,last) for(int i=first;i>=last;--i)\nusing namespace std;\nconst int MAXN=5e5+5;\nint n,m;\ninline int Read()\n{\n\tint x(0),f(1);\n\tchar c(getchar());\n\twhile(c<'0'||'9'<c)\n\t{\n\t\tif(c=='-')\n\t\t{\n\t\t\tf=-1;\n\t\t}\n\t\tc=getchar();\n\t}\n\twhile('0'<=c&&c<='9')\n\t{\n\t\tx=(x<<1)+(x<<3)+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f*x;\n}\nvector<int>place[MAXN];\nstruct LazyTag\n{\n\tbool clean;//\u56e0\u4e3a\u4e0d\u53ef\u80fd\u6bcf\u6b21\u90fd\u66b4\u529b\u6e05\u7a7a\u6574\u9897\u7ebf\u6bb5\u6811,\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u6e05\u7a7a\u6807\u8bb0\n\tint add;\n\tinline void Clean()\n\t{\n\t\tclean=0;\n\t\tadd=0;\n\t}\n}for_make;\ninline LazyTag MakeTag(int opt,int add=0)\n{\n\tfor_make.Clean();\n\tif(opt==0)\n\t{\n\t\tfor_make.clean=1;\n\t}\n\tif(opt==1)\n\t{\n\t\tfor_make.add=add;\n\t}\n\treturn for_make;\n}\nstruct SegmentTree\n{\n\tint len;\n\tlong long sum,sum_;//\u6743\u503c\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u6743\u503c\u548c\u4ee5\u53ca\u53d6\u7684\u6570\u91cf\u4ece len \u4f9d\u6b21\u51cf\u4e00\u7684\u548c\n\tLazyTag tag;\n}sgt[MAXN*8];\n#define LSON (now<<1)\n#define RSON (now<<1|1)\n#define MIDDLE ((left+right)>>1)\n#define LEFT LSON,left,MIDDLE\n#define RIGHT RSON,MIDDLE+1,right\n#define NOW now_left,now_right\ninline void PushUp(int now)\n{\n\tsgt[now].sum=sgt[LSON].sum+sgt[RSON].sum;\n\tsgt[now].sum_=sgt[LSON].sum_+sgt[LSON].sum*sgt[RSON].len+sgt[RSON].sum_;//\u8ba1\u7b97 sum_ \u5efa\u8bae\u81ea\u5df1\u63a8\u4e00\u4e0b\u5f0f\u5b50\n}\nvoid Build(int now=1,int left=1,int right=n*2+10)\n{\n\tsgt[now].len=right-left+1;\n\tif(left==right)\n\t{\n\t\treturn;\n\t}\n\tBuild(LEFT);\n\tBuild(RIGHT);\n}\ninline void Down(LazyTag tag,int now)\n{\n\tif(tag.clean)\n\t{\n\t\tsgt[now].sum=sgt[now].sum_=0;\n\t\tsgt[now].tag.Clean();//\u9700\u8981\u628a\u61d2\u6807\u8bb0\u4e5f\u6e05\u7a7a\n\t\tsgt[now].tag.clean=1;\n\t}\n\tif(tag.add)\n\t{\n\t\tsgt[now].tag.add+=tag.add;\n\t\tsgt[now].sum+=1ll*sgt[now].len*tag.add;\n\t\tsgt[now].sum_+=1ll*(sgt[now].len+1)*sgt[now].len/2*tag.add;//\u76f4\u63a5\u7528\u7b49\u5dee\u6570\u5217\u6c42\u548c\u516c\u5f0f\u5373\u53ef\n\t}\n}\ninline void PushDown(int now)\n{\n\tDown(sgt[now].tag,LSON);\n\tDown(sgt[now].tag,RSON);\n\tsgt[now].tag.Clean();\n}\ninline void CleanTree()\n{\n\tDown(MakeTag(0),1);\n}\nvoid UpdataAdd(int now_left,int now_right,int add,int now=1,int left=1,int right=n*2+10)\n{\n\tif(now_left<=left&&right<=now_right)\n\t{\n\t\tDown(MakeTag(1,add),now);\n\t\treturn;\n\t}\n\tPushDown(now);\n\tif(now_left<=MIDDLE)\n\t{\n\t\tUpdataAdd(NOW,add,LEFT);\n\t}\n\tif(MIDDLE+1<=now_right)\n\t{\n\t\tUpdataAdd(NOW,add,RIGHT);\n\t}\n\tPushUp(now);\n}\nlong long QuerySum(int now_left,int now_right,int now=1,int left=1,int right=n*2+10)\n{\n\tif(now_left<=left&&right<=now_right)\n\t{\n\t\treturn sgt[now].sum;\n\t}\n\tPushDown(now);\n\tlong long result=0;\n\tif(now_left<=MIDDLE)\n\t{\n\t\tresult=QuerySum(NOW,LEFT);\n\t}\n\tif(MIDDLE+1<=now_right)\n\t{\n\t\tresult+=QuerySum(NOW,RIGHT);\n\t}\n\treturn result;\n}\nlong long QuerySum_(int now_left,int now_right,int now=1,int left=1,int right=n*2+10)\n{\n\tif(now_left<=left&&right<=now_right)\n\t{\n\t\t\n\t\treturn sgt[now].sum_+sgt[now].sum*(now_right-right);//\u5728\u8ba1\u7b97 sum_ \u7684\u65f6\u5019\u9700\u8981\u9002\u5f53\u52a0\u4e0a\u4e00\u4e9b sum,\u5efa\u8bae\u81ea\u5df1\u753b\u56fe\u63a8\u5f0f\u5b50\n\t}\n\tPushDown(now);\n\tlong long result=0;\n\tif(now_left<=MIDDLE)\n\t{\n\t\tresult=QuerySum_(NOW,LEFT);\n\t}\n\tif(MIDDLE+1<=now_right)\n\t{\n\t\tresult+=QuerySum_(NOW,RIGHT);\n\t}\n\treturn result;\n}\n#undef LSON\n#undef RSON\n#undef MIDDLE\n#undef LEFT\n#undef RIGHT\n#undef NOW\nint main()\n{\n\tint opt;\n\tscanf(\"%d%d\",&n,&opt);\n\tREP(i,0,n-1)\n\t{\n\t\tplace[i].push_back(0);\n\t}\n\tREP(i,1,n)\n\t{\n\t\tplace[Read()].push_back(i);\n\t}\n\tREP(i,0,n-1)\n\t{\n\t\tplace[i].push_back(n+1);\n\t}\n\tBuild();\n\tint add_num=n+3;//\u5efa\u8bae\u5728\u7ebf\u6bb5\u6811\u4e2d\u4e0d\u8981\u4f7f\u7528\u8d1f\u4e0b\u6807,\u5982\u679c\u8981\u4f7f\u7528\u5728\u8ba1\u7b97 middle \u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528 (left+right)>>1,\u800c\u662f\u5e94\u8be5\u4e00\u76f4\u5411\u4e0b\u53d6\u6574,\u5373 left=-5,right=-2 \u65f6 middle \u5e94\u8be5\u4e3a -4,\u800c\u4e0d\u662f -3\n\tlong long answer=0;\n\tREP(i,0,n-1)\n\t{\n\t\tCleanTree();//\u6e05\u7a7a\u6743\u503c\u7ebf\u6bb5\u6811\n\t\tUpdataAdd(add_num+0,add_num+0,1);//\u4e0d\u8981\u5fd8\u8bb0\u628a 0 \u653e\u5165\u6743\u503c\u7ebf\u6bb5\u6811\n\t\tint now=0;\n\t\tREP(j,1,place[i].size()-1)\n\t\t{\n\t\t\tif(place[i][j-1]+1!=place[i][j])\n\t\t\t{\n\t\t\t\tanswer+=QuerySum_(add_num+now-(place[i][j]-place[i][j-1]-1),add_num+now-2)+1ll*(place[i][j]-place[i][j-1]-1)*QuerySum(1,add_num+now-(place[i][j]-place[i][j-1]-1)-1);//\u6309\u4e0a\u9762\u7ed9\u51fa\u7684\u8ba1\u7b97\u7b49\u5dee\u6570\u5217\u8d21\u732e\u7684\u65b9\u6cd5\u8ba1\u7b97\n\t\t\t\tUpdataAdd(add_num+now-(place[i][j]-place[i][j-1]-1),add_num+now-1,1);//\u5c06\u8fd9\u4e00\u6574\u6bb5\u6570\u90fd\u653e\u5165\u6743\u503c\u7ebf\u6bb5\u6811\n\t\t\t\tnow-=(place[i][j]-place[i][j-1]-1);\n\t\t\t}\n\t\t\tif(place[i][j]!=n+1)\n\t\t\t{\n                //\u5728\u7b49\u4e8e\u679a\u4e3e\u7684\u6570\u7684\u4f4d\u7f6e\u5c31\u76f4\u63a5\u8ba1\u7b97\u8d21\u732e\n\t\t\t\tnow++;\n\t\t\t\tanswer+=QuerySum(1,add_num+now-1);\n\t\t\t\tUpdataAdd(add_num+now,add_num+now,1);\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",answer);\n\treturn 0;\n}\n```\n",
        "postTime": 1593948216,
        "uid": 86625,
        "name": "Limit",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "**\u9898\u76ee\u5927\u610f\uff1a**\n\n\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a$n(n\\leq 5\\times 10^5)$\u7684\u5e8f\u5217$A_{1\\sim n}$\u3002\u6c42\u6ee1\u8db3\u533a\u95f4\u4f17\u6570\u5728\u533a\u95f4\u5185\u51fa\u73b0\u6b21\u6570\u4e25\u683c\u5927\u4e8e$\\lfloor\\frac{r-l+1}{2}\\rfloor$\u7684\u533a\u95f4$[l,r]$\u7684\u4e2a\u6570\u3002\n\n\n**\u601d\u8def\uff1a**\n\n\u5206\u6cbb\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4$[l,r]$\uff0c\u8bbe$mid=\\lfloor\\frac{l+r}{2}\\rfloor$\uff0c\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa\u6240\u6709\u7ecf\u8fc7$mid$\u7684\u533a\u95f4\u5185\u80fd\u591f\u6210\u4e3a\u4f17\u6570\u7684\u6240\u6709\u6570\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u6240\u6709\u7684\u533a\u95f4\u4f17\u6570\u6ee1\u8db3\u5982\u4e0b\u4e00\u4e2a\u6027\u8d28\uff1a\u5982\u679c$x$\u662f\u533a\u95f4$[l,r]$\u7684\u4f17\u6570\uff0c\u90a3\u4e48\u5bf9\u4e8e$l\\leq k\\leq r$\uff0c$x$\u4e00\u5b9a\u662f\u533a\u95f4$[l,k]$\u6216\u533a\u95f4$(k,r]$\u7684\u4f17\u6570\u3002\n\n\u5229\u7528\u8fd9\u4e00\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee4$k=mid$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5$O(n)$\u4ece$mid$\u51fa\u53d1\u5f80\u5de6\u53f3\u4e24\u8fb9\u626b\uff0c\u6c42\u51fa\u80fd\u591f\u6210\u4e3a\u4f17\u6570\u7684\u6240\u6709\u6570\u3002\n\n\u63a5\u4e0b\u6765\u679a\u4e3e\u6bcf\u4e2a\u4f17\u6570$x$\uff0c\u6c42\u4e00\u4e0b\u5f53\u524d$[l,r]$\u533a\u95f4\u4e2d\uff0c\u4ee5$x$\u4f5c\u4e3a\u4f17\u6570\u7684\u5b50\u533a\u95f4\u4e2a\u6570\u3002\n\n\u5177\u4f53\u6211\u4eec\u53ef\u4ee5\u5148\u4ece$mid$\u5f80\u5de6\u626b\uff0c\u8bbe\u5f80\u5de6\u626b\u5230\u7684\u7aef\u70b9\u4e3a$b$\uff0c\u8bb0\u5f55\u4e00\u4e0b\u5bf9\u4e8e\u4e0d\u540c\u7684$b$\uff0c$mid-b+1-cnt[x]$\u4e0d\u540c\u53d6\u503c\u7684\u51fa\u73b0\u6b21\u6570\u3002\u7136\u540e\u518d\u5f80\u53f3\u626b\uff0c\u6c42\u51fa\u5bf9\u4e8e\u5f53\u524d\u53f3\u7aef\u70b9$e$\uff0c\u6c42\u51fa\u6ee1\u8db3$e-b+1-cnt[x]>\\lfloor\\frac{e-b+1}{2}\\rfloor$\u7684\u533a\u95f4$[b,e]$\u7684\u4e2a\u6570\uff0c\u8fd9\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u5feb\u901f\u6c42\u51fa\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u7edf\u8ba1\u4e86\u533a\u95f4$[l,r]$\uff0c\u7ecf\u8fc7$mid$\u7684\u6240\u6709\u5b50\u533a\u95f4\u3002\n\n\u5bf9\u4e8e\u4e0d\u7ecf\u8fc7$mid$\u7684\u5b50\u533a\u95f4\u53ef\u4ee5\u9012\u5f52\u6c42\u89e3\u3002\n\n\u9012\u5f52\u6811\u4e2d\uff0c\u6bcf\u4e00\u5c42\u533a\u95f4\u957f\u5ea6\u52a0\u8d77\u6765\u662f$n$\uff0c\u53ef\u80fd\u7684\u4f17\u6570\u4e2a\u6570\u6709$\\log n$\u4e2a\uff0c\u6bcf\u4e00\u5c42\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(n\\log n)$\u3002\u603b\u5171\u6709$\\log n$\u5c42\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(n\\log^2 n)$\u3002\n\n\n**\u4ee3\u7801\uff1a**\n\n```cpp\n#include<cstdio>\n#include<cctype>\n#include<algorithm>\ntypedef long long int64;\ninline int getint() {\n    register char ch;\n    while(!isdigit(ch=getchar()));\n    register int x=ch^'0';\n    while(isdigit(ch=getchar())) x=(((x<<2)+x)<<1)+(ch^'0');\n    return x;\n}\nconst int N=500001;\nint a[N],pos[N],num[N],cnt[N*2];\nint64 ans;\nvoid solve(const int &l,const int &r) {\n    if(l==r) {\n        ans++;\n        return;\n    }\n    const int mid=(l+r)/2;\n    solve(l,mid);\n    solve(mid+1,r);\n    for(register int i=mid;i>=l;i--) {\n        if(++cnt[a[i]]>(mid-i+1)/2) {\n            if(!pos[a[i]]) {\n                num[pos[a[i]]=++num[0]]=a[i];\n            }\n        }\n    }\n    for(register int i=mid+1;i<=r;i++) {\n        if(++cnt[a[i]]>(i-mid)/2) {\n            if(!pos[a[i]]) {\n                num[pos[a[i]]=++num[0]]=a[i];\n            }\n        }\n    }\n    for(register int i=l;i<=r;i++) {\n        pos[a[i]]=cnt[a[i]]=0;\n    }\n    for(register int i=1;i<=num[0];i++) {\n        int sum=r-l+1,max=sum,min=sum;\n        cnt[sum]=1;\n        for(register int j=l;j<mid;j++) {\n            if(a[j]==num[i]) {\n                sum++;\n            } else {\n                sum--;\n            }\n            max=std::max(max,sum);\n            min=std::min(min,sum);\n            cnt[sum]++;\n        }\n        if(a[mid]==num[i]) {\n            sum++;\n        } else {\n            sum--;\n        }\n        for(register int i=min;i<=max;i++) {\n            cnt[i]+=cnt[i-1];\n        }\n        for(register int j=mid+1;j<=r;j++) {\n            if(a[j]==num[i]) {\n                sum++;\n            } else {\n                sum--;\n            }\n            ans+=cnt[std::min(max,sum-1)];\n        }\n        for(register int i=min;i<=max;i++) {\n            cnt[i]=0;\n        }\n    }\n    num[0]=0;\n}\nint main() {\n    const int n=getint(); getint();\n    for(register int i=1;i<=n;i++) {\n        a[i]=getint();\n    }\n    solve(1,n);\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1515415206,
        "uid": 10086,
        "name": "skylee",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4062 \u3010\u300cCodePlus 2017 11 \u6708\u8d5b\u300dYazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "\u849f\u84bb\u63d0\u4f9b\u4e00\u79cd $n \\sqrt n$ \u7684\u7b97\u6cd5\u3002\n\n\u5148\u8003\u8651\u90e8\u5206\u5206\u600e\u4e48\u505a\u3002\n\n\u5bf9\u4e8e $type=1$ \uff0c\u5148\u8ba1\u7b97\u4f17\u6570\u4e3a $1$ \u7684\u6709\u591a\u5c11\u533a\u95f4\uff0c\u5982\u679c\u505a\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u5c31\u662f\u5728\u95ee\u6709\u591a\u5c11\u5bf9 $(L,R)$ \u6ee1\u8db3\uff1a $L<=R$ \u4e14 $sum_R-sum_{L-1}> \\frac {R-L+1}{2}$\u3002\n\n\u53d8\u4e00\u4e0b\u67ff\u5b50\u4e3a\uff1a$2*sum_R-R>2*sum_{L-1}-(L-1)$\u3002\n\n\u679a\u4e3e $R$ \uff0c\u7528\u6811\u72b6\u6570\u7ec4\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5c31\u597d\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$ \u3002\n\n\u4e0d\u8fc7\u4e3a\u4e86\u540e\u9762\u7684\u6839\u53f7\u7b97\u6cd5\u80fd\u8fc7\uff0c\u8fd8\u5f97\u4f18\u5316\u4e00\u4e0b\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u60f3\u529e\u6cd5\u4e22\u6389\u4e00\u4e2a $\\log$ \u3002\n\n\u8003\u8651\u5230 $R-1$ \u5f80\u540e\u79fb\u4e00\u4f4d\uff0c$sum_R$ \u8981\u4e48\u7b49\u4e8e $sum_{R-1}+1$ \uff0c\u8981\u4e48\u7b49\u4e8e$sum_{R-1}$ \uff0c\u90a3\u4e48 $2*sum_R-R$ \u7684\u503c\u76f8\u5bf9\u4e8e $2*sum_{R-1}-(R-1)$ \u5c31\u4f1a $+1$ \u6216\u8005 $-1$\uff0c\u5c31\u53ef\u4ee5\u6839\u636e**\u5df2\u7ecf\u8ba1\u7b97\u597d\u7684 $R-1$ \u7684\u8d21\u732e\u6765\u4fee\u6539**\u8fdb\u800c\u5f97\u5230 $R$ \u7684\u8d21\u732e\u3002\n\n\u600e\u4e48\u4fee\u6539\uff1f\n\n\u8fd9\u6837\u4e00\u6765\u67e5\u8be2\u7684\u533a\u95f4\u53ea\u4f1a\u5f80\u5de6\u6216\u5f80\u53f3\u79fb\u4e00\u4f4d\uff0c\u90a3\u4e48\u5c31\u5f97\u77e5\u9053\u591a\u51fa\u6765\u7684\u4e00\u4f4d\u6216\u5c11\u4e86\u7684\u4e00\u4f4d\u8d21\u732e\u662f\u591a\u5c11\uff0c\u5f97\u5230\u5bf9\u5e94\u7684\u53d8\u5316\u91cf\uff0c\u5f00\u4e2a\u6876\u8bb0\u5f55\u4e00\u4e0b\u6240\u6709\u7684 $2*sum_x-x$ \u7684\u76f8\u540c\u7684\u6709\u591a\u5c11\u4e2a\uff08$x<R$\uff09\u5c31\u80fd\u8fdb\u884c\u4fee\u6539\u4e86\u3002\uff08\u770b\u6587\u5b57\u6ca1\u660e\u767d\u7684\u753b\u4e2a\u56fe\u5c31\u61c2\u5566\uff09\n\n\u8fd9\u6837\u5c31\u80fd\u505a\u5230 $O(n)$ \u6c42\u89e3\u3002\n\n\u5bf9\u4e8e $type=3$ \uff0c\u6700\u591a\u53ea\u6709 $8$ \u4e2a\u6570\u5b57\uff0c\u540c\u6837\u679a\u4e3e\u4f17\u6570\uff0c\u628a\u679a\u4e3e\u7684\u6570\u6240\u5728\u7684\u4f4d\u7f6e\u6539\u6210 $1$ \uff0c\u5176\u4f59\u4e3a $0$ \uff0c\u89e3\u6cd5\u540c $type=1$ \u7684\u60c5\u51b5\u3002\n\n\u5bf9\u4e8e $type=2$ \uff0c\u610f\u5473\u7740\u6ee1\u8db3\u6761\u4ef6\u7684\u533a\u95f4\u957f\u5ea6\u6700\u957f\u4e0d\u8d85\u8fc7 $30$ \uff0c\u53ef\u4ee5\u66b4\u529b\u626b\u8fd9\u4e9b\u533a\u95f4\u7b97\u7b54\u6848\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(30n)$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u6839\u53f7\u7b97\u6cd5\u5566\uff01\n\n\u4e0a\u9762\u7684\u4e24\u79cd\u505a\u6cd5\u533a\u522b\u5728\u4e8e\u4e00\u4e2a\u662f\u9488\u5bf9\u6570\u5b57\u79cd\u7c7b\uff0c\u4e00\u4e2a\u662f\u9488\u5bf9\u6570\u5b57\u51fa\u73b0\u6b21\u6570\u3002\n\n\u4e0d\u59a8\u5bf9\u6bcf\u4e2a\u6570\u5b57\u51fa\u73b0\u7684\u51fa\u73b0\u6b21\u6570\u5206\u4e2a\u7c7b\u3002\n\n\u5bf9\u4e8e\u6240\u6709 $ cnt_x \\le \\sqrt n $ \u7684\u6570\u5b57 $x$\uff0c\u6211\u4eec\u5c31\u66b4\u529b\u626b\u957f\u5ea6\u4e3a $2 \\sqrt n $ \u7684\u533a\u95f4\uff0c\u6240\u6709\u8fd9\u4e9b\u6570\u5b57\u7684\u8d21\u732e\u90fd\u4f1a\u88ab\u7b97\u5230\u3002\uff08\u6ce8\u610f\u4e0d\u8981\u7b97\u4e86\u51fa\u73b0\u6b21\u6570\u5927\u4e8e $\\sqrt n$ \u7684\u6570\u5b57\u7684\u8d21\u732e \uff09\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\sqrt n)$ \u3002\n\n\u5bf9\u4e8e $ cnt_x \\geq \\sqrt n $ \u7684\uff0c\u7528 $type=1$ \u7684\u505a\u6cd5\u505a\uff0c\u8fd9\u4e9b\u4e0d\u540c\u7684\u6570\u5b57\u6700\u591a\u4e0d\u4f1a\u8d85\u8fc7 $\\sqrt n$ \u4e2a\uff0c\u65f6\u95f4\u4e5f\u662f $O(n \\sqrt n)$ \u3002\n\n\u5982\u679c\u4f60\u4e0d\u60f3\u7528 $type=1$ \u7684\u4f18\u5316\u800c\u662f\u76f4\u63a5\u7528\u6811\u72b6\u6570\u7ec4\uff0c\u4f3c\u4e4e\u4e5f\u80fd\u8fc7 ... ...\n\n$code:$\n\n```\n#include <cstdio>\n#include <cmath>\nusing namespace std;\ntypedef long long LL;\nint read() {\n\tchar ch=getchar();int x=0,pd=0;\n\twhile(ch<'0'||ch>'9') pd|=ch=='-',ch=getchar();\n\twhile('0'<=ch&&ch<='9') x=(x<<3)+(x<<1)+(ch^48),ch=getchar();\n\treturn pd?-x:x;\n}\nconst int maxn=505005;\nint _max(int a,int b) { return a<b?b:a; }\nint _min(int a,int b) { return a<b?a:b; }\nint n,type;\nint a[maxn];\nint cnt[maxn],vis[maxn],cnt2[maxn];\nint s1[maxn];\nLL ans;\nint main() {\n\tn=read(),type=read();\n\tfor(int i=1;i<=n;i++) ++vis[a[i]=read()];\n\tint size=sqrt(n),limit=size*2;\n\tfor(int i=1;i<=n;i++) {\n\t\tint maxx=0;\n\t\tfor(int j=i;j<i+limit&&j<=n;j++) {\n\t\t\tif(vis[a[j]]<=size) maxx=_max(maxx,++cnt[a[j]]);\n\t\t\tif(maxx>(j-i+1)/2) ++ans;\n\t\t}\n\t\tfor(int j=i;j<i+limit&&j<=n;j++)\n\t\t\tif(vis[a[j]]<=size) --cnt[a[j]];\n\t}\n\tfor(int num=0;num<n;num++)\n\t\tif(vis[num]>size) {\n\t\t\tfor(int i=0;i<=n+15;i++) cnt2[i]=0;\n\t\t\tint minn=0x3f3f3f3f;\n\t\t\tfor(int i=1;i<=n;i++) {\n\t\t\t\ts1[i]=s1[i-1]+(a[i]==num);\n\t\t\t\tminn=_min(minn,2*s1[i]-i);\n\t\t\t}\n\t\t\tint p=1-minn+1,sum=0;\n\t\t\tcnt2[p]=1; // \u6709\u8d1f\u6570\uff0c\u52a0\u4e2a\u504f\u79fb\u91cf \n\t\t\tfor(int i=1;i<=n;i++) {\n\t\t\t\tif(s1[i]==s1[i-1]) sum-=cnt2[ 2*s1[i-1]-(i-1)-1+p ];\n\t\t\t\telse sum+=cnt2[ 2*s1[i-1]-(i-1)+p ];\n\t\t\t\t++cnt2[2*s1[i]-i+p];\n\t\t\t\tans+=sum;\n\t\t\t}\n\t\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1596806708,
        "uid": 52881,
        "name": "super\u849f\u84bb",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "\u4eba\u50bb\u5e38\u6570\u5927\u2026\u2026\n\n\u53ea\u662f\u7406\u8bba\u590d\u6742\u5ea6$O(nlogn)$\u5b9e\u9645\u4e0a\u88ab$O(nlog^2n)$\u7684\u89e3\u6cd5\u7206\u8e29\n\n_________________\n\n## \u672c\u9898\u9898\u89e3\n\n\u9898\u610f\u7b80\u5355\u660e\u4e86\uff0c\u6c42\u533a\u95f4\u4f17\u6570\u51fa\u73b0\u6b21\u6570\u8fc7\u534a\u7684\u5b50\u533a\u95f4\u6570\u76ee\n\n\u90a3\u4e48\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u5947\u602a\u7684\u9650\u5236\uff0c\u4e3a\u4ec0\u4e48\u4e00\u5b9a\u8981\u8fc7\u534a\u5462?\n\n\u7b54\u6848\u662f\u8fd9\u4e2a\u6761\u4ef6\u4fdd\u8bc1\u4e86\u201c\u65b0\u751f\u821e\u4f1a\u201d\u7684\u533a\u95f4\u7684\u4f17\u6570\u662f\u552f\u4e00\u7684~~(\u90a3\u4e2a\u76f8\u540c\u5c31\u53d6\u6700\u5c0f\u7684\u9650\u5236\u662f\u552c\u4f60\u7684)~~\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u679a\u4e3e\u6240\u6709\u53ef\u80fd\u7684\u4f17\u6570\u503ck\uff0c\u7136\u540e\u7edf\u8ba1\u4f17\u6570\u4e3ak\u7684\u65b0\u751f\u821e\u4f1a\u7684\u533a\u95f4\u6709\u591a\u5c11\u4e2a\uff0c\u6700\u540e\u5c06\u8fd9\u4e9b\u6570\u52a0\u8d77\u6765\u5c31\u662f\u6211\u4eec\u8981\u6c42\u7684\u201c\u65b0\u751f\u821e\u4f1a\u201d\u7684\u533a\u95f4\u7684\u603b\u6570\u76ee\u4e86\n\n\u597d\u4e86\u90a3\u4e48\u95ee\u9898\u6765\u4e86\u6211\u4eec\u600e\u4e48\u6c42\u5462\uff1f\n\n\u4e00\u4e2a\u7b80\u660e\u6613\u61c2\u7684\u60f3\u6cd5\u662f\u6211\u4eec\u5c06\u6240\u6709\u7b49\u4e8ek\u7684\u6570\u8bbe\u62101\uff0c\u6240\u6709\u4e0d\u662fk\u7684\u6570\u5b57\u8bbe\u6210-1\uff0c\u7136\u540e\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u5e8f\u5217\u53d8\u6210\u4e86\u4e00\u4e2a+1,-1\u5e8f\u5217\uff0c\u6b64\u65f6\u4f17\u6570\u4e3ak\u7684\u4e00\u4e2a\u201c\u65b0\u751f\u821e\u4f1a\u201d\u7684\u533a\u95f4\uff0c\u548c\u8fd9\u4e2a\u8f6c\u5316\u540e\u7684\u5e8f\u5217\u4e0a\u4e00\u4e2a\u533a\u95f4\u548c\u5927\u4e8e0\u7684\u533a\u95f4\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u6c42\u51fa\u8fd9\u4e2a\u5e8f\u5217\u6709\u591a\u5c11\u5b50\u533a\u95f4\u548c\u4e3a0\u5373\u53ef\u4e86\n\n\u53d1\u73b0\u8fd8\u662f\u4e0d\u597d\u505a\uff0c\u90a3\u4e48\u8ba9\u6211\u4eec\u63a5\u7740\u8f6c\u5316\n\n\u6211\u4eec\u91c7\u53d6\u6c42\u533a\u95f4\u548c\u7684\u7ecf\u5178\u5957\u8def\uff0c\u5c06\u533a\u95f4\u548c\u8868\u793a\u6210\u4e24\u4e2a\u524d\u7f00\u548c\u76f8\u51cf\u7684\u5f62\u5f0f\n\n\u90a3\u4e48\u6211\u4eec\u8981\u505a\u7684\u662f\u5bf9\u4e8e\u6bcf\u4e2ai\u6c42\u51fa\u6709\u591a\u5c11j\u6ee1\u8db3$sum_{i}>sum_{j}$\u4e14$i>j$\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u6ee1\u8db3$[j+1,i]$\u8fd9\u4e2a\u533a\u95f4\u548c\u5927\u4e8e0\u4e86\n\n\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u6c42\u524d\u7f00\u548c\u5e8f\u5217\u7684\u987a\u5e8f\u5bf9\u4e2a\u6570\u54af\n\n\u90a3\u4e48\u6b64\u65f6\u90a3\u4e2a$A_{i}<=7$\u7684\u90e8\u5206\u5206\u5c31\u975e\u5e38\u53ef\u505a\u4e86\n\n**\u6bcf\u6b21\u66b4\u529b\u626b\u4e00\u904d\u6574\u4e2a\u5e8f\u5217\uff0c\u6811\u72b6\u6570\u7ec4\u6c42\u4e00\u904d\u987a\u5e8f\u5bf9\u5373\u53ef\u4e86**\n\n\u597d\u4e86\u4f46\u662f\u8fd9\u4e2a\u4e1c\u897f\u653e\u5230$A_{i}$\u65e0\u9650\u5236\u8fd9\u4e2a\u4e1c\u897f\u4e0a\u9762\u5c31\u7acb\u9a6c\u70b8\u4e86\n\n\u8003\u8651\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u4f1a\u70b8\n\n\u5047\u8bbe\u6211\u4eec\u5728\u505a\u4e00\u4e2a1\u5f88\u5c11-1\u5f88\u591a\u7684\u5e8f\u5217\n\n\u90a3\u4e48\u4f60\u4f1a\u53d1\u73b0\u524d\u7f00\u548c\u6570\u7ec4\u5f88\u591a\u5730\u65b9\u662f\u4e00\u4e2a\u516c\u5dee\u4e3a-1\u7684\u7b49\u5dee\u6570\u5217\n\n\u56e0\u4e3a\u6211\u4eec\u6c42\u7684\u662f\u987a\u5e8f\u5bf9\uff0c\u6240\u4ee5\u4f60\u4f1a\u53d1\u73b0\u8fd9\u6bb5\u533a\u95f4\u7684\u987a\u5e8f\u5bf9\u663e\u7136\u662f0\n\n\u8fd9\u6837\u5c31\u975e\u5e38\u7684\u4e0d\u597d\u4e86\u2026\u2026\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u4f60\u7ebf\u6bb5\u6811\u6c42\u9006\u5e8f\u5bf9\u7684\u8fc7\u7a0b\n\n**foreach i**\n\n _1.ans+=\u7ebf\u6bb5\u6811\u4e0a$0,sum_{i}-1$\u7684\u533a\u95f4\u548c_ \n\n _2.\u5728\u7ebf\u6bb5\u6811$sum_{i}$\u7684\u4f4d\u7f6e\u52a0\u4e0a1_ \n\n\u7136\u540e\u6211\u4eec\u73b0\u5728\u5c1d\u8bd5\u8fd9\u5c06\u6bcf\u4e00\u6bb5\u7b49\u5dee\u6570\u5217\u4e00\u53e3\u6c14\u52a0\u5230\u7ebf\u6bb5\u6811\u91cc\u9762\n\n\u53ef\u4ee5\u53d1\u73b0\u7684\u662f\u5bf9\u5e94\u7684\u4fee\u6539\u5e94\u8be5\u662f\u7ebf\u6bb5\u6811\u4e0a\u4e00\u6bb5\u533a\u95f4+1\n\n\u5e76\u4e14\u53d1\u73b0\u53e6\u4e00\u4e2a\u66f4\u4e3a\u6709\u8da3\u7684\u4e8b\u5b9e\u662f\u7531\u4e8e\u6bcf\u6b21\u63d2\u5165\u7684\u6570\u521a\u597d\u6bd4\u524d\u4e00\u4e2a\u6570\u5c111\uff0c\u6240\u4ee5\u524d\u9762\u7684\u6570\u5b57\u6709\u6ca1\u6709\u88ab\u63d2\u5165\u6839\u672c\u4e0d\u5f71\u54cd\u6c42\u533a\u95f4\u548c\u7684\u8fc7\u7a0b\n\n\u7136\u540e\u6211\u4eec\u5c1d\u8bd5\u7740\u6c42\u51fa\u8fd9\u4e2a\u7b49\u5dee\u6570\u5217(\u4ecest\u5230ed)\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\uff0c\u5176\u4e2d$cnt_{j}$\n\u662f\u7ebf\u6bb5\u6811\u6240\u7ef4\u62a4\u7684\u6570\u7ec4\n\n\n\u53ef\u4ee5\u53d1\u73b0\u662f\u8fd9\u4e2a\u5f0f\u5b50\n\n$$\\sum_{i=st}^{ed}\\sum_{j=- \\infty}^{i-1}cnt_{j}$$\n\n\u7b80\u5355\u7684\u4ea4\u6362\u4e00\u53d1\u6c42\u548c\u53f7\u5c31\u662f\n\n$$(ed-st+1)\\sum_{i= -\\infty}^{st-1}cnt_{i}+\\sum_{i=st}^{ed}(ed-i)cnt_{i}$$\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4$cnt_{i}$\u4ee5\u53ca$i\u00d7cnt_{i}$\u7684\u548c\u5c31\u884c\u4e86,\u7ebf\u6bb5\u6811\u6240\u8d44\u74f7\u7684\u64cd\u4f5c\u662f\u533a\u95f4\u52a0\n\n\u5f53\u7136\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u4e0d\u5c5e\u4e8e\u7b49\u5dee\u6570\u5217\u7684\u524d\u7f00\u548c\u70b9\uff0c\u6211\u4eec\u6c42\u7ebf\u6bb5\u6811\u7684\u533a\u95f4\u548c\uff0c\u7136\u540e\u5355\u70b9\u52a0\u5c31\u884c\u4e86\n\n\u8fd9\u6837\u7684\u8bdd,\u6211\u4eec\u4f1a\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4f17\u6570\u7684\u503c\u590d\u6742\u5ea6\u4e3a$O(mlogn)$m\u4e3a\u8fd9\u4e2a\u503c\u5728\u5e8f\u5217\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\n\n\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u662f$O(nlogn)$\u5e38\u6570\u5947\u5927\u65e0\u6bd4\uff0c\u53c8\u52a0\u4e0a\u6211\u4eba\u61d2\u76f4\u63a5\u5427\u7ebf\u6bb5\u6811\u7684\u503c\u57df\u5f00\u6210\u4e862n\u5e38\u6570\u5c31\u66f4\u5927\u4e86\u2026\u2026\n\n\u4e0a\u4ee3\u7801\n\n```C\n#include<cstdio>\n#include<algorithm>\n#include<vector>\nusing namespace std;const int N=5*1e5+10;typedef long long ll;\nvector <int> po[N];int n;ll ans;int t;\nstruct linetree//\u7ebf\u6bb5\u6811\n{\n\tll sum[8*N];ll isum[8*N];ll add[8*N];\n\tinline void pd(int p,int l,int r)\n\t{\n\t\tif(add[p]==0)return;int mid=(l+r)/2;int l1=mid-l;int l2=r-mid;\n\t\tsum[p<<1]+=add[p]*l1;add[p<<1]+=add[p];isum[p<<1]+=(add[p]*(l+1)+add[p]*mid)*l1/2;\n\t\tsum[p<<1|1]+=add[p]*l2;add[p<<1|1]+=add[p];isum[p<<1|1]+=(add[p]*(mid+1)+add[p]*r)*l2/2;add[p]=0;\n\t} \n\tinline void ud(int p){sum[p]=sum[p<<1]+sum[p<<1|1];isum[p]=isum[p<<1]+isum[p<<1|1];}\n\tinline void setadd(int p,int l,int r,int dl,int dr,ll ad)\n\t{\n\t\tif(dl==l&&dr==r){sum[p]+=ad*(r-l);isum[p]+=(ad*(l+1)+ad*r)*(r-l)/2;add[p]+=ad;return;}\t\n\t\tpd(p,l,r);int mid=(l+r)/2;\n\t\tif(dl<mid)setadd(p<<1,l,mid,dl,min(dr,mid),ad);\n\t\tif(mid<dr)setadd(p<<1|1,mid,r,max(dl,mid),dr,ad);ud(p);\n\t}\n\tinline ll gsum(int p,int l,int r,int dl,int dr,ll* val)\n\t{\n\t\tif(dl==l&&dr==r)return val[p];pd(p,l,r);int mid=(l+r)/2;ll res=0;\n\t\tif(dl<mid)res+=gsum(p<<1,l,mid,dl,min(dr,mid),val);\n\t\tif(mid<dr)res+=gsum(p<<1|1,mid,r,max(dl,mid),dr,val);return res;\n\t}\n\tinline void ins(int l,int r){setadd(1,0,2*n,n+l,n+r,1);}\n\tinline void ins(int x){setadd(1,0,2*n,n+x-1,n+x,1);}\n\tinline void del(int l,int r){setadd(1,0,2*n,n+l,n+r,-1);}\n\tinline void del(int x){setadd(1,0,2*n,n+x-1,n+x,-1);}\n\tinline ll csum(int l,int r,ll* val){return gsum(1,0,2*n,n+l,n+r,val);}\n}lt;\ninline void calc(ll st,ll ed)\n{ans+=(ed-st+1)*lt.csum(-n,st-1,lt.sum)+(ed+n)*lt.csum(st-1,ed,lt.sum)-lt.csum(st-1,ed,lt.isum);}\nint main()\n{\n\tscanf(\"%d%d\",&n,&t);\n\tfor(int i=1,t;i<=n;i++)scanf(\"%d\",&t),po[t].push_back(i);lt.ins(0);\n\tfor(int i=0;i<n;i++)//\u5927\u529b\u5206\u60c5\u51b5\u8ba8\u8bba\u4e00\u4e0b\u63d2\u5165\u7684\u7b49\u5dee\u5e8f\u5217\u5c31\u884c\u4e86\n\t{\t\n\t\tif(po[i].empty())continue;int up=po[i].size();\n\t\tif(po[i][0]!=1)lt.ins(-po[i][0],-1);ans++;lt.ins(-po[i][0]+2);\n\t\tfor(int j=1,st,ed;j<up;j++)\n\t\t{\n\t\t\tst=2*j-po[i][j]+1;ed=2*j-po[i][j-1]-1;\n\t\t\tif(st<=ed)calc(st,ed),lt.ins(st-1,ed);ans+=lt.csum(-n,st,lt.sum);lt.ins(st+1);\n\t\t}int ed=2*up-po[i][up-1]-1;int st=2*up-n;if(st<=ed)calc(st,ed);\n\t\tif(po[i][0]!=1)lt.del(-po[i][0],-1);lt.del(-po[i][0]+2);\n\t\tfor(int j=1,st,ed;j<up;j++)\n\t\t{st=2*j-po[i][j]+1;ed=2*j-po[i][j-1]-1;if(st<=ed)lt.del(st-1,ed);lt.del(st+1);}\n\t}printf(\"%lld\",ans);return 0;\n}\n```\n\n\n\n\n \n \n\n\n",
        "postTime": 1533819892,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "\u4e25\u683c\u7ebf\u6027\uff0c\u4e0d\u7528\u5e76\u67e5\u96c6\uff0c\u4e0d\u7528\u5dee\u5206\u3002\n\n\u8003\u8651\u679a\u4e3e\u7edd\u5bf9\u4f17\u6570 $x$\uff0c\u5b9a\u4e49\u65b0\u5e8f\u5217 $b_i=\\begin{cases}1&a_i=x\\\\-1& a_i\\not=x \\end{cases}$\u3002\u95ee\u9898\u53d8\u4e3a\u6c42 $b$ \u5e8f\u5217\u4e2d\u548c\u4e3a\u6b63\u7684\u5b50\u6bb5\u6570\u3002\n\n\u66b4\u529b\u7684\u60f3\u6cd5\u662f\u626b\u4e00\u904d $b$\uff0c\u8f6c\u6210\u6c42\u524d\u7f00\u548c\u5e8f\u5217\u7684\u201c\u987a\u5e8f\u5bf9\u201d\u6570\uff0c\u4f46\u8fd9\u6837\u4f1a\u8d85\u65f6\u3002\u6839\u636e\u7ecf\u9a8c\uff0c\u6211\u4eec\u5e0c\u671b\u53ea\u4fdd\u7559\u6709\u53ef\u80fd\u4ea7\u751f\u8d21\u732e\u7684\u4f4d\u7f6e\uff0c\u5bf9\u8fd9\u4e9b\u4f4d\u7f6e\u7ec4\u6210\u7684\u82e5\u5e72\u8fde\u7eed\u6bb5\u8fdb\u884c\u8ba1\u7b97\u3002\u4ec0\u4e48\u6837\u7684\u4f4d\u7f6e\u53ef\u80fd\u4ea7\u751f\u8d21\u732e\u5462\uff1f\u8003\u8651\u628a\u6240\u6709 $+1$ \u7ec4\u6210\u7684\u8fde\u7eed\u6bb5\u548c $-1$ \u7ec4\u6210\u7684\u8fde\u7eed\u6bb5\u7f29\u8d77\u6765\uff0cdp \u6c42\u51fa\u4ee5\u7b2c $i$ \u4e2a $+1$ \u8fde\u7eed\u6bb5\u4e3a\u7ed3\u5c3e\u7684\u6700\u5927\u5b50\u6bb5\u548c $f_i$ \u4ee5\u53ca\u4ee5\u7b2c $i$ \u4e2a $+1$ \u8fde\u7eed\u6bb5\u4e3a\u5f00\u5934\u7684\u6700\u5927\u5b50\u6bb5\u548c $F_i$\uff08\u5141\u8bb8\u7a7a\u5b50\u6bb5\uff0c\u5373 $f_i,F_i\\ge 0$\uff09\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u957f\u4e3a $\\mathit{len}$ \u7684 $-1$ \u8fde\u7eed\u6bb5\uff0c\u5982\u679c\u5b83\u4e24\u8fb9\u7684 $+1$ \u8fde\u7eed\u6bb5 $i,i+1$ \u6ee1\u8db3 $f_i+F_{i+1}>\\mathit{len}$\uff0c\u8fd9\u4e2a $-1$ \u8fde\u7eed\u6bb5\u4e2d\u7684\u6240\u6709\u4f4d\u7f6e\u90fd\u662f\u6709\u610f\u4e49\u7684\uff0c\u76f4\u63a5\u628a\u5b83\u548c\u4e24\u8fb9\u7684 $+1$ \u8fde\u7eed\u6bb5\u7f29\u5728\u4e00\u8d77\u3002\u5426\u5219\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u4e2d\u4e00\u5b9a\u6709\u65e0\u610f\u4e49\u7684\u4f4d\u7f6e\uff0c\u5b83\u4f1a\u9694\u65ad\u4e24\u4e2a $+1$ \u8fde\u7eed\u6bb5\u3002\u8bb0 $c_x$ \u4e3a $x$ \u7684\u51fa\u73b0\u6b21\u6570\uff0c\u6b64\u8fc7\u7a0b\u7684\u590d\u6742\u5ea6\u4e3a $O(c_x)$\u3002\n\n\u5269\u4e0b\u7684\u4efb\u52a1\u5c31\u662f\u5bf9\u7f29\u51fa\u6765\u7684\u8fde\u7eed\u6bb5\u5206\u522b\u8ba1\u7b97\u5b83\u4eec\u524d\u7f00\u548c\u5e8f\u5217\u7684\u201c\u987a\u5e8f\u5bf9\u201d\u6570\uff0c\u7531\u4e8e\u524d\u7f00\u548c\u7684\u53d8\u5316\u53ea\u6709 $\\pm 1$\uff0c\u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u6876\u7531\u524d\u4e00\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u63a8\u51fa\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u3002\u590d\u6742\u5ea6 $O(\\mathit{len})$\u3002\u63a5\u4e0b\u6765\u53ea\u9700\u8bc1\u660e\u5bf9\u4e8e\u6bcf\u4e2a $x$\uff0c\u88ab\u989d\u5916\u7f29\u8fdb\u6765\u7684 $-1$ \u7684\u6570\u91cf\u4e3a $O(c_x)$\u3002\n\n\u8bc1\u660e\uff1a\u8bb0\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u52bf\u80fd\u4e3a\u4ee5\u5b83\u4e3a\u5f00\u5934\u7684\u6700\u5927\u5b50\u6bb5\u548c\u52a0\u4e0a\u4ee5\u5b83\u4e3a\u7ed3\u5c3e\u7684\u6700\u5927\u5b50\u6bb5\u548c\u3002\u90a3\u4e48\u521d\u59cb\u65f6\u6240\u6709 $+1$ \u8fde\u7eed\u6bb5\u7684\u52bf\u80fd\u5747\u4e3a $2\\mathit{len}$\uff0c\u540c\u65f6\uff0c\u5bf9\u4e8e\u4e24\u4e2a\u9996\u5c3e\u76f8\u90bb\u7684\u8fde\u7eed\u6bb5\uff0c\u5b83\u4eec\u5e76\u8d77\u6765\u7684\u8fde\u7eed\u6bb5\u7684\u52bf\u80fd\u662f\u5404\u81ea\u7684\u52bf\u80fd\u76f8\u52a0\u3002\u8003\u8651\u5408\u5e76\u4e24\u4e2a $+1$ \u8fde\u7eed\u6bb5\u7684\u8fc7\u7a0b\uff0c\u76f8\u5f53\u4e8e\u5728\u7b2c\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u540e\u9762\u4e0d\u65ad\u63d2\u5165 $-1$\uff0c\u5728\u7b2c\u4e8c\u4e2a\u8fde\u7eed\u6bb5\u7684\u524d\u9762\u4e0d\u65ad\u63d2\u5165 $-1$\uff0c\u7136\u540e\u5728\u4e2d\u95f4\u67d0\u4e2a\u4f4d\u7f6e\u6c47\u5408\u3002\u800c\u5982\u679c\u5f00\u5934\u7684\u6700\u5927\u5b50\u6bb5\u548c\u5927\u4e8e $0$\uff0c\u5728\u5f00\u5934\u63d2\u5165\u4e00\u4e2a $-1$ \u5bf9\u52bf\u80fd\u5e26\u6765\u7684\u5f71\u54cd\u662f $-1$\uff0c\u5426\u5219\u4e3a $0$\u3002\u7ed3\u5c3e\u63d2\u5165 $-1$ \u540c\u7406\u3002\u7531\u524d\u6587\u63d0\u5230\u7684\u9650\u5236\uff0c\u603b\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u6c47\u5408\u70b9\u4f7f\u5f97\u4e24\u4e2a\u8fde\u7eed\u6bb5\u5728\u63d2\u5165 $-1$ \u7684\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u52bf\u80fd\u4e0d\u53d8\u7684\u60c5\u51b5\u3002\u4e8e\u662f\u628a\u4e24\u4e2a\u8fde\u7eed\u6bb5\u7f29\u8d77\u6765\u65f6\uff0c\u6bcf\u6709\u4e00\u4e2a $-1$ \u88ab\u989d\u5916\u7f29\u8d77\u6765\u603b\u52bf\u80fd\u5c31\u4f1a $-1$\uff0c\u800c\u521d\u59cb\u65f6\u6240\u6709\u8fde\u7eed\u6bb5\u7684\u52bf\u80fd\u4e3a $2c_x$\uff0c\u6240\u4ee5\u7f29\u8fdb\u6765\u7684 $-1$ \u6570\u91cf\u4e3a $O(c_x)$\u3002\n\n\u4e8e\u662f\u603b\u590d\u6742\u5ea6\u4e3a $O(\\sum c_x)=O(n)$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff08\u7801\u5b57\u4e0d\u6613\uff0c\u7ed9\u4e2a\u8d5e\u518d\u8d70\u597d\u4e0d\u597dQAQ\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nnamespace vectorwyx{\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define pb push_back\n#define eb emplace_back\n#define mk make_pair\n#define sml(x,y) (x=min(x,y))\n#define big(x,y) (x=max(x,y))\n#define ll long long\n#define uint unsigned\n#define ull unsigned long long\n#define umap unordered_map\n#define db double\n#define fo(i,x,y) for(int i=(x);i<=(y);++i)\n#define go(i,x,y) for(int i=(x);i>=(y);--i)\n#define ptc putchar\n#define emp emplace\n#define re return\n#define co continue\n#define brk break\n#define HH (ptc('\\n'))\n#define bctz __builtin_ctz\n#define bclz __builtin_clz\n#define bppc __builtin_popcount\nusing namespace std;\nll seed=chrono::system_clock::now().time_since_epoch().count();\nmt19937 rnd(seed);\ninline int rm(int x,int y){return (int)(rnd()%(y-x+1ll)+x);}\ninline int read(){signed ch=getchar();int x=0,f=1;while(!isdigit(ch)){if(ch==(int)('-'))f=-1;ch=getchar();}while(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}return x*f;}\ninline void out(int *a,int l,int r){fo(i,l,r) cout<<*(a+i)<<' ';puts(\"\");}\n\n//20:40~20:57,20:57~21:00\n\nconst int N=5e5+5;\nint a[N],n,f[N],F[N],cnt[N],cnt_[N];\nll ans;\nvector<int> g[N];\n\nll calc(int l,int r,int X){\n\t#define cnt(x) (x<0?cnt_[-(x)]:cnt[x])\n//\tprintf(\"calc(%d,%d,%d)\\n\",l,r,X);\n\tll ret=0,S=0;\n\tcnt[0]=1;\n\tint sum=0;\n\tfo(i,l,r){\n\t\tif(a[i]==X) sum++,S+=cnt(sum-1);\n\t\telse sum--,S-=cnt(sum);\n\t\tcnt(sum)++;\n\t\tret+=S;\n\t}\n\tsum=0;\n\tfo(i,l,r){\n\t\tif(a[i]==X) sum++;else sum--;\n\t\tcnt(sum)=0;\n\t}\n//\tprintf(\"ret=%lld\\n\",ret);\n\tre ret;\n\t#undef cnt\n}\n\nsigned main(){\n\tcin>>n;read();\n\tfo(i,1,n) g[i].eb(0);\n\tfo(i,1,n) a[i]=read()+1,g[a[i]].eb(i);\n//\tcout<<\"a:\";out(a,1,n);\n\tfo(i,1,n){\n\t\tint m=(int)g[i].size()-1;\n\t\tif(m==0) co;\n\t\tf[1]=1;fo(j,2,m) f[j]=max(1,f[j-1]-(g[i][j]-g[i][j-1]-1)+1);\n\t\tF[m]=1;go(j,m-1,1) F[j]=max(1,F[j+1]-(g[i][j+1]-g[i][j]-1)+1);\n//\t\tprintf(\"%d!!!!!\\n\",i);cout<<\"f:\";out(f,1,m);cout<<\"F:\";out(F,1,m);\n\t\tint lst=1;\n\t\tfo(j,1,m-1) if(g[i][j+1]-g[i][j]-1>=f[j]+F[j+1]){\n\t\t\tans+=calc(max(1,g[i][lst]-F[lst]),min(n,g[i][j]+f[j]),i);\n\t\t\tlst=j+1;\n\t\t}\n\t\tans+=calc(max(1,g[i][lst]-F[lst]),min(n,g[i][m]+f[m]),i);\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n}\n/*\n-------------------------------------------------\n*/\n\n\n\n\n\n\n\n\n\n\nsigned main(){re vectorwyx::main();}\n```\n\n\n\n",
        "postTime": 1671072280,
        "uid": 238408,
        "name": "vectorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4062 [Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a"
    },
    {
        "content": "### P4062 [Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a \u7ef4\u62a4\u4e09\u9636\u524d\u7f00\u548c\n\n\n[P4062 [Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a](https://www.luogu.com.cn/problem/P4062)\n\n#### \u53d1\u73b0\u504f\u5e8f\u6027\u8d28\n\n\u6211\u4eec\u5e0c\u671b\u7edf\u8ba1\u201c\u65b0\u751f\u821e\u4f1a\u201d\u5b50\u533a\u95f4\uff0c\u5148\u8981\u53d1\u73b0\u5b83\u7684\u6027\u8d28\u3002\n\n\u4ece\u7b80\u5355\u7684\u60c5\u51b5\u5165\u624b\uff0c\u4f8b\u5982\u8003\u8651\u53ea\u6709 0 \u548c 1 \u7684\u5e8f\u5217\uff0c\u5982\u679c\u7edf\u8ba1 1 \u7684\u201c\u65b0\u751f\u821e\u4f1a\u201d\u5b50\u533a\u95f4\uff0c\u90a3\u4e48\u6761\u4ef6\u662f $cnt(l,r)>\\lfloor\\dfrac{r-l+1}{2}\\rfloor$ . \u81ea\u7136\u5730\uff0c\u6211\u4eec\u60f3\u5230\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c\u5feb\u901f\u6c42\u5f97 $cnt(l,r)$ \uff0c\u8bb0 $S_i$ \u8868\u793a $[1,i]$ \u4e2d 1 \u7684\u4e2a\u6570\uff0c\u90a3\u4e48\u4e0a\u5f0f\u6539\u5199\u4e3a\uff1a\n$$\n\\begin{aligned}\nS_r-S_{l-1}&>\\dfrac{r-l+1}{2}\\\\[2ex]\n2S_r-r &> 2S_{l-1}-(l-1)\n\\end{aligned}\n$$\n\u4e8e\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u8981\u7edf\u8ba1\u6ee1\u8db3\u4ee5\u4e0a\u504f\u5e8f\u5173\u7cfb\u7684\u504f\u5e8f\u5bf9\u7684\u4e2a\u6570\u5c31\u80fd\u5f97\u5230 1 \u7684\u201c\u65b0\u751f\u821e\u4f1a\u201d\u5b50\u533a\u95f4\u4e2a\u6570\u3002\n\n#### \u5229\u7528\u7b49\u5dee\u6570\u5217\u6027\u8d28\u6539\u8fdb\u7b97\u6cd5\n\n\u4f46\u662f\u5982\u679c\u5bf9\u6bcf\u4e00\u4e2a\u6570\u90fd\u505a\u4e00\u904d\u7edf\u8ba1\uff0c\u4e0d\u96be\u53d1\u73b0\u5176\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\uff0c\u6211\u4eec\u9700\u8981\u6539\u8fdb\u590d\u6742\u5ea6\u3002\n\n\u7ee7\u7eed\u4ece\u7b80\u5355\u60c5\u51b5\u5165\u624b\uff0c\u6211\u4eec\u89c2\u5bdf $2S_i-i$ \u7684\u6027\u8d28\uff1a\n\n|   $i$    |  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |\n| :------: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  $a_i$   |  0   |  0   |  1   |  0   |  1   |  1   |  0   |  0   |\n| $2S_i-i$ |  -1  |  -2  |  -1  |  -2  |  -1  |  0   |  -1  |  -2  |\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u91cd\u8981\u6027\u8d28\uff1a**$2S_i-i$ \u603b\u662f\u4ee5 $a_i=1$ \u7684\u4f4d\u7f6e\u4e3a\u5f00\u5934\u6216\u8005\u7ed3\u5c3e\u7ec4\u6210\u4e00\u6bb5\u516c\u5dee\u4e3a $-1$ \u7684\u7b49\u5dee\u5e8f\u5217\u3002**\n\n\u53ef\u4ee5\u53d1\u73b0 $[1,2]$\uff0c$[3,4]$\uff0c$[5,5]$\uff0c$[6,8]$ \u7684 $2S_i-i$ \u90fd\u7ec4\u6210\u4e86\u7b49\u5dee\u5e8f\u5217\uff0c\u90a3\u4e48\u5982\u4f55\u5229\u7528\u8fd9\u4e2a\u6027\u8d28\uff1f\u9996\u5148\u4e00\u4e2a\u663e\u7136\u7684\u7ed3\u8bba\u662f\u7b49\u5dee\u5e8f\u5217\u5185\u90e8\u4e0d\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\uff0c\u56e0\u4e3a\u5185\u90e8\u603b\u662f\u9012\u51cf\uff0c\u4e00\u5b9a\u4e0d\u6ee1\u8db3\u4e4b\u524d\u63a8\u51fa\u7684\u504f\u5e8f\u5173\u7cfb\uff0c\u6240\u4ee5\u6211\u4eec\u5982\u679c\u8003\u8651\u63d2\u5165\u7b49\u5dee\u5e8f\u5217\uff08\u6bcf\u4e00\u4e2a\u6570\u90fd\u4f5c\u4e3a\u4e00\u6bb5\u7b49\u5dee\u5e8f\u5217\u7684\u5f00\u5934\u6216\u8005\u7ed3\u5c3e $O(n)$\uff09 \u5e76\u67e5\u8be2\u7b49\u5dee\u5e8f\u5217\u4e0e\u524d\u9762\u7684\u7b49\u5dee\u5e8f\u5217\u4ea7\u751f\u7684\u8d21\u732e\uff08\u671f\u671b $O(n\\log n)$\uff09\uff0c\u5c31\u53ef\u80fd\u89e3\u51b3\u6b64\u9898\u3002\n\n#### \u601d\u8003\u63d2\u5165\u7b49\u5dee\u5e8f\u5217\u548c\u67e5\u8be2\u7b54\u6848\u7684\u5b9e\u73b0\u7ec6\u8282\n\n\u73b0\u5728\u505a\u4e00\u4e2a\u5c0f\u63a8\u5e7f\uff0c\u5047\u8bbe\u7edf\u8ba1\u4ee5\u4e0b\u5e8f\u5217\u4e2d\uff0c5 \u7684\u201c\u65b0\u751f\u821e\u4f1a\u201d\u5b50\u533a\u95f4\n\n|  $i$  |  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |\n| :---: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n| $a_i$ |  1   |  2   |  5   |  3   |  5   |  5   |  4   |  2   |\n\n\u663e\u7136\u5c06 5 \u770b\u4f5c 1\uff0c\u5176\u5b83\u6570\u770b\u4f5c 0 \u5c31\u662f\u4e0a\u4e00\u4e2a\u8868\u683c\u7684\u60c5\u51b5\u3002\u63d2\u5165\u4e00\u6bb5\u7531 $a_i$ \u4e2d $[3,4]$ \u5bf9\u5e94\u7684 $2S_i-i$ \u7ec4\u6210\u7684\u7b49\u5dee\u5e8f\u5217 \u7b49\u4ef7\u4e8e\u7ed9 $2S_i-i$ \u7684\u503c\u57df\u533a\u95f4 $[-1,-2]$ \u52a0\u4e0a\u6743\u503c 1 \uff0c\u4e5f\u5c31\u662f\u533a\u95f4\u52a0\u3002\u67e5\u8be2\u7b49\u5dee\u5e8f\u5217 $[3,4]$ \u4e0e\u524d\u9762\u4ea7\u751f\u7684\u8d21\u732e\u5c31\u662f\uff1a\u6c42\u7b49\u5dee\u5e8f\u5217\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u6570\u4e0e\u524d\u9762\u6ee1\u8db3\u504f\u5e8f\u5173\u7cfb\u7684\u6570\u7684\u4e2a\u6570\u4e4b\u548c\u3002\u4f8b\u5982\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u5c31\u662f\u7edf\u8ba1\u524d\u9762\u4e0e $-1$ \u6ee1\u8db3\u504f\u5e8f\u5173\u7cfb\u7684 $2S_i-i$ \u7684\u4e2a\u6570\u52a0\u4e0a\u524d\u9762\u4e0e $-2$ \u6ee1\u8db3\u504f\u5e8f\u5173\u7cfb\u7684 $2S_i-i$ \u7684\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u7528\u7b80\u6d01\u7684\u8868\u8fbe\u5f0f\u8868\u8fbe\uff0c\u5c31\u662f\uff1a\n\n\u8bb0 $v(x)$ \u4e3a $2S_i-i = x$ \u7684 $i$ \u4e2a\u6570\uff0c\u4e5f\u5c31\u662f $x$ \u7684\u6743\u503c\uff1b\u4ee4 $p=2S_l-l$ \u4e3a\u7b49\u5dee\u5e8f\u5217\u5f00\u5934\u7684\u90a3\u4e2a\u6570 ,\u4ee4 $q=2S_r-r$ \u4e3a\u7b49\u5dee\u5e8f\u5217\u7ed3\u5c3e\u7684\u90a3\u4e2a\u6570\uff0c\u90a3\u4e48\u7531 $[l,r]$ \u4e2d\u7684 $ 2S_i-i$ \u7ec4\u6210\u7684\u7b49\u5dee\u5e8f\u5217\u4e0e\u524d\u9762\u7684\u7b49\u5dee\u5e8f\u5217\u4ea7\u751f\u7684\u8d21\u732e\u5c31\u662f\uff1a\n$$\n\\sum_{q\\leqslant k\\leqslant p}\\sum_{t < k} v(t)\n$$\n\u4e3a\u4e86\u63d0\u9ad8\u8fd0\u7b97\u901f\u5ea6\uff0c\u8003\u8651\u7528\u524d\u7f00\u548c\u4f18\u5316\uff0c\u5e76\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u524d\u7f00\u548c\u3002\u8bb0 $g(x)=\\sum_{k\\leqslant x} v(k)$ \uff0c\u662f $2S_i-i\\leqslant x$ \u7684 $i$ \u7684\u4e2a\u6570\uff0c\u4e5f\u5c31\u662f $v(x)$ \u7684\u524d\u7f00\u548c\uff1b\u8bb0 $h(x) = \\sum_{k\\leqslant x} g(k)$ \uff0c\u8868\u793a\u5bf9\u4e8e\u6240\u6709 $2S_i-i\\leqslant x$ \u7684 $2S_i-i$ \uff0c\u6ee1\u8db3 $2S_j-j\\leqslant 2S_i-i$ \u7684 $j$ \u7684\u4e2a\u6570\u4e4b\u548c\uff0c\u4e5f\u5c31\u662f $g(x)$ \u7684\u524d\u7f00\u548c\uff1b\u7528\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u77e5\u9053\u67e5\u8be2 $[3,4]$ \u7ec4\u6210\u7684\u7b49\u5dee\u5e8f\u5217\u4e0e\u524d\u9762\u7684\u8d21\u732e\u5c31\u662f $h((-1)-1)-h((-2)-2)$ \u3002\u666e\u904d\u610f\u4e49\u4e0b\uff0c\u67e5\u8be2\u5f00\u5934\u4e3a $p=2S_l-l$ \uff0c\u7ed3\u5c3e\u4e3a $q=2S_r-r$ \u7684\u7b49\u5dee\u5e8f\u5217\u4e0e\u524d\u9762\u7684\u8d21\u732e\u662f $h(p-1)-h(q-2)$ \uff0c\u8fd9\u6837\u5c31\u80fd\u6c42\u5f97\u7b54\u6848\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5236\u4f5c\u4e0b\u8868\uff1a\n\n| $x=S_i-i$ |  -3  |  -2  |  -1  |  0   |  1   |\n| :-------: | :--: | :--: | :--: | :--: | :--: |\n|  $v(x)$   |  0   |  1   |  1   |  0   |  0   |\n|  $g(x)$   |  0   |  1   |  2   |  2   |  2   |\n|  $h(x)$   |  0   |  1   |  3   |  5   |  7   |\n\n#### \u7ef4\u62a4\u4e09\u9636\u524d\u7f00\u548c\n\n\u7136\u540e\u8003\u8651\u52a0\u5165\u4e00\u6bb5\u7b49\u5dee\u5e8f\u5217\u7684\u95ee\u9898\uff1a\u4e0a\u9762\u4e5f\u5df2\u7ecf\u8bf4\u4e86\uff0c\u63d2\u5165\u4e00\u6bb5\u4ee5 $[l,r]$ \u4e2d\u7684 $ 2S_i-i$ \u7ec4\u6210\u7684\u7b49\u5dee\u5e8f\u5217\u7b49\u4ef7\u4e8e\u5728 $2S_i-i$ \u7684\u6743\u503c\u57df $v$ \u4e2d\u5bf9\u533a\u95f4 $[2S_r-r,2S_l-l]$ \u533a\u95f4\u52a0 1.\u4e8e\u662f\u6211\u4eec\u8003\u8651\u5bf9 $v$ \u533a\u95f4\u52a0 1 \u540e\uff0c\u5bf9 $h$ \u6709\u4ec0\u4e48\u5f71\u54cd\u5c31\u597d\u4e86\uff0c\u8fd9\u91cc\u7684\u601d\u8003\u601d\u8def\u53c2\u8003\u300a\u6311\u6218\u7a0b\u5e8f\u8bbe\u8ba1\u7ade\u8d5b\u300b\u4e2d\u5904\u7406\u6811\u72b6\u6570\u7ec4\u533a\u95f4\u52a0\u548c\u533a\u95f4\u67e5\u8be2\u7684\u601d\u8def\u3002\n\n\u73b0\u5728\u6211\u4eec\u5c06\u76ee\u5149\u8f6c\u5411 $v,g,h$ \u4e09\u4e2a\u51fd\u6570\uff0c\u4ee5\u4e0b\u7684 $[l,r]$ \u90fd\u662f\u6307\u4e09\u4e2a\u51fd\u6570\u7684\u5b9a\u4e49\u57df $x = S_i-i$ \u4e0a\u7684\u533a\u95f4\uff08\u524d\u9762\u7684\u662f\u6307 $a_i$\uff09\n\n\u8003\u8651\u4ee4\u6ee1\u8db3 $l\\leqslant x\\leqslant r$ \u7684 $v(x)$ \u5168\u90e8\u52a0 1.\n\n\u8bb0\u64cd\u4f5c\u524d\u7684 $x$ \u5bf9\u5e94\u7684 $g$ \u51fd\u6570\u4e3a $g(x)$ \uff0c\u64cd\u4f5c\u540e\u4e3a $g'(x)$ \uff0c$h$ \u51fd\u6570\u540c\u7406\u3002\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- $x<l$ \uff0c\u5219 $g(x)$ \u548c $h(x)$ \u4e0d\u53d7\u5f71\u54cd\uff0c\u5373 $g'(x)=g(x),h'(x)=h(x)$\n\n- $l\\leqslant x\\leqslant r$ \uff0c\u5219\n  $$\n  \\begin{aligned}\n  g'(x) &= g(x)+x-l+1\\\\[2ex]\n  h'(x) &= h(x)+\\sum_{k = l}^{x} (k-l+1)\\\\[1ex]\n  &=h(x)+\\dfrac{(x-l+1)(x-l+2)}{2}\\\\[1ex]\n  &= h(x) + \\dfrac{1}{2}\\left(x^2+(3-2l)x+l^2-3l+2\\right)\n  \\end{aligned}\n  $$\n  \u53ef\u4ee5\u501f\u7528\u4e0a\u9762\u7ed9\u51fa\u7684\u8868\u683c\u4e0e\u4f8b\u5b50\u63a8\u4e00\u63a8\u3002\n\n- $r<x$ \uff0c\u5219\n  $$\n  \\begin{aligned}\n  g'(x) &= g(x) + r-l+1\\\\[2ex]\n  h'(x)&=h(x) + \\sum_{k=l}^r(k-l+1)+(x-r)(r-l+1)\\\\[1ex]\n  &=h(x) + \\dfrac{(r-l+2)(r-l+1)}{2}+(x-r)(r-l+1)\\\\[1ex]\n  &= h(x) + \\dfrac{1}{2}\\left(2(r-l+1)x+(r-l+2)(r-l+1)-2r(r-l+1)\\right)\n  \\end{aligned}\n  $$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u53d8\u5316\u91cf\u4e0e $x^2$ \uff0c$x$ \u548c\u5e38\u6570\u9879\uff08$x^0$\uff09\u6709\u5173\uff0c\u4e8e\u662f\u7528\u4e09\u4e2a\u6811\u72b6\u6570\u7ec4 $\\rm{bit0}$\uff0c$\\rm{bit1}$\uff0c$\\rm{bit2}$ \u5206\u522b\u7ef4\u62a4\u8fd9\u4e09\u9879\uff0c\u5177\u4f53\u505a\u6cd5\u662f\uff1a\n\n\u5bf9\u4e8e $[l,r]$ \u533a\u95f4\u52a0 1\uff1a\n\n- \u4ee4 ${\\rm{bit0}}(l)$ \u52a0\u4e0a $l^2-3l+2$\uff1b\u4ee4 ${\\rm bit1}(l)$ \u52a0\u4e0a $3-2l$ \uff1b\u4ee4 ${\\rm bit2}(l)$ \u52a0\u4e0a $1$\n- \u4ee4 ${\\rm bit0}(r + 1)$ \u52a0\u4e0a $(r-l+2)(r-l+1)-2r(r-l+1)-(l^2-3l+2)$ \uff1b\u4ee4 ${\\rm bit1(r + 1)}$ \u52a0\u4e0a $2(r-l+1)-(3-2l)$ \uff1b\u4ee4 ${\\rm bit2}(r + 1)$ \u52a0\u4e0a $-1$\n\n\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u4f8b\u5982\u67e5 $h(x)$ \u5c31\u662f \n$$\nh(x)=\\dfrac{\\operatorname{Query}({\\rm bit0},x)+\\operatorname{Query}({\\rm bit1},x)\\times x+\\operatorname{Query}({\\rm bit2},x)\\times x^2}{2}\n$$\n\u8fd9\u91cc\u4e58\u4e0a $\\dfrac{1}{2}$ \u662f\u56e0\u4e3a\u6211\u4eec\u521a\u521a\u4fee\u6539\u7684\u65f6\u5019\u6ca1\u6709\u4e58\u4e0a $\\dfrac{1}{2}$ .\n\n\u4ee5\u4e0a\u5f0f\u5b50\u8fd8\u8981\u6162\u6162\u7406\u89e3\u3002\u8fd9\u91cc\u518d\u653e\u51fa\u4e00\u5f20\u56fe\uff0c\u7528\u4e8e\u7406\u89e3\u4e8c\u9636\u524d\u7f00\u548c\u7684\u53d8\u5316\uff0c\u4e5f\u5c31\u662f $g(x)$ \u7684\u53d8\u5316\uff0c\u81f3\u4e8e $h(x)$ \u7684\u53d8\u5316\uff0c\u786e\u5b9e\u9700\u8981\u4e00\u5b9a\u7684\u6570\u5b66\u529f\u5e95\u4e0e\u601d\u7ef4\u80fd\u529b\u7406\u89e3\uff08\u8fd9\u51e0\u6761\u5f0f\u5b50\u6211\u4e5f\u63a8\u4e86\u5f88\u4e45\uff0c\u63a8\u4e86 2h \uff0c\u800c\u4e14\u6709\u51e0\u6b21\u63a8\u9519\u4e86\uff0c\u751a\u81f3\u6709\u51e0\u6b21\u591a\u9879\u5f0f\u76f8\u4e58\u5c55\u5f00\u90fd\u7b97\u9519\u4e86\uff0c\u6211\u6570\u5b66\u592a\u83dc\u4e86...\uff09\n\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/lelejeyr.png)\n\n\n#### \u6574\u7406\u601d\u8def\uff0c\u89e3\u51b3\u95ee\u9898\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u8bb0\u5f55\u4e00\u79cd\u6570\u51fa\u73b0\u7684\u6240\u6709\u4f4d\u7f6e\uff0c\u7136\u540e\u5c06\u539f\u5e8f\u5217\u7b80\u5316\u4e3a\u4ec5\u5305\u542b 0 \u548c 1 \u7684\u5e8f\u5217\uff0c\u7ef4\u62a4\u4e00\u4e0b $h(x)$ \u5e76\u7edf\u8ba1\u7b54\u6848\uff0c\u9010\u4e2a\u51fb\u7834\u5373\u53ef\u3002\u6700\u540e\u8981\u6ce8\u610f\u7684\u5c31\u662f\u4e0d\u8981\u50bb\u50bb\u5730\u5c06\u8d1f\u6570\u4f5c\u4e3a\u4e0b\u6807\u4e86\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u504f\u79fb\u91cf $\\Delta$ \u5c31\u53ef\u4ee5\u907f\u514d\u6570\u7ec4\u8d8a\u754c\u5730\u60c5\u51b5\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\n\n#### \u53c2\u8003\u7a0b\u5e8f\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector> \n\nusing namespace std;\ntypedef long long ll;\nconst ll dlt = 500003;\nll ans,t[5][1000010];\nint n,type,x;\nvector<ll > a[500005];\n\nint lowbit(int num)\n{\n\treturn num&(-num);\n}\n\nvoid bitadd(int ty,int i,ll val)\n{\n\tfor(;i <= n + dlt;i += lowbit(i)) t[ty][i] += val;\n\treturn ;\n}\n\nll bitq(int ty,int i)\n{\n\tll res = 0;\n\tfor(;i;i -= lowbit(i)) res += t[ty][i];\n\treturn res;\n}\n\nll BIT_Query(ll num)\n{\n\tll res = 0;\n\tres = ((bitq(0,num) + bitq(1,num)*num + bitq(2,num)*num*num)/2);\n\treturn res;\n}\n\nvoid BIT_Add(ll l,ll r,ll val)//\u7ef4\u62a4\u4e09\u4e2a\u6811\u72b6\u6570\u7ec4\n{\n\tll tmp0 = l*l - (ll)3*l + (ll)2;\n\tll tmp1 = (ll)3 - l - l;\n\tll tmp2 = (ll)1;\n\tbitadd(0,l,tmp0*val);\n\tbitadd(1,l,tmp1*val);\n\tbitadd(2,l,tmp2*val);\n\ttmp0 = -tmp0 + (r - l + (ll)1)*(r - l + (ll)2) - (ll)2*r*(r - l + (ll)1) ;\n\ttmp1 = -tmp1 + (ll)2*(r - l + (ll)1);\n\ttmp2 = -tmp2;\n\tbitadd(0,r + 1,tmp0*val);\n\tbitadd(1,r + 1,tmp1*val);\n\tbitadd(2,r + 1,tmp2*val);\n\treturn ;\n}\n\nvoid solve(ll num)\n{\n\tll cnt = 0;ll lt = 0;ll rt = 0;\n\tBIT_Add(dlt,dlt,1);\\\\dlt \u662f\u504f\u79fb\u91cf\n\tif(a[num][0] > 1) lt = -a[num][0] + 1 ,rt = -1,BIT_Add(lt + dlt,rt + dlt,1); \n\tfor(int i = 0;i < a[num].size() - 1;i ++)//\u63d2\u5165\uff0c\u67e5\u8be2\uff0c\u7edf\u8ba1\u7b54\u6848\n\t{\n\t\tcnt ++;rt = cnt + cnt - a[num][i];lt = cnt + cnt - a[num][i + 1] + 1;\n\t\tans += BIT_Query(rt - 1 + dlt) - BIT_Query(lt - 2 + dlt);\n\t\tBIT_Add(lt + dlt,rt + dlt,1);\n\t}\n\tcnt = 0;\n\tBIT_Add(dlt,dlt,-1);\n\tif(a[num][0] > 1) lt = - a[num][0] + 1,rt = -1,BIT_Add(lt + dlt,rt + dlt,-1);\n\tfor(int i = 0;i < a[num].size() - 1;i ++)//\u6e05\u7a7a\u6811\u72b6\u6570\u7ec4\n\t{\n\t\tcnt ++;lt = cnt + cnt - a[num][i + 1] + 1;rt = cnt + cnt - a[num][i];\n\t\tBIT_Add(lt + dlt,rt + dlt,-1);\n\t}\n\treturn ;\n}\n\nint main()\n{\n\tscanf(\"%d%d\",&n,&type);\n\tfor(int i = 1;i <= n;i ++)\n\t{\n\t\tscanf(\"%d\",&x);\n\t\ta[x].push_back(i);//\u8bb0\u5f55\u4f4d\u7f6e\n\t}\n\tfor(int i = 0;i <= n;i ++)//\u9010\u4e2a\u51fb\u7834\n\t\tif(!a[i].empty())\n\t\t{\n\t\t\ta[i].push_back(n + 1);\n\t\t\tsolve(i);\n\t\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n } \n```\n\n",
        "postTime": 1635474126,
        "uid": 80822,
        "name": "zhongqijun",
        "ccfLevel": 6,
        "title": "P4062 [Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a \u9898\u89e3"
    },
    {
        "content": "\u6709\u4eba\u6b64\u9898 5min \u80e1\u5355 log\uff0c\u5374\u8c03\u4e86 2h\uff0c\u6211\u4e0d\u8bf4\u662f\u8c01\u3002\n\n\u6709\u7684\u4eba\u9000\u5f79\u662f\u987a\u5176\u81ea\u7136\u7684\u4e8b\uff0c\u56e0\u4e3a\u4ed6\u4e27\u5931\u7684\u662f\u4ee3\u7801\u80fd\u529b\uff0c\u800c\u4e14\u662f\u5199\u50bb\u5375\u9898\u7684\u4ee3\u7801\u80fd\u529b\u3002\n\n-------------------------------------------------------\n\n\u8003\u8651\u5bf9\u4e8e\u4e25\u683c\u4f17\u6570\u7684 trick\uff0c\u50cf\u6469\u5c14\u6295\u7968\uff0c\u6982\u7387\u9009\u70b9\u505a\u533a\u95f4\u6570\u989c\u8272\u8fd9\u4e9b trick \u7f3a\u5c11\u5bf9\u4e8e\u5177\u8c61\u95ee\u9898\u7684\u523b\u753b\uff0c\u53ea\u80fd\u5355\u7eaf\u7ef4\u62a4\u533a\u95f4\u7684\u5408\u6cd5\u6027\uff0c\u6240\u4ee5\u81ea\u7136\u800c\u7136\u5730\u60f3\u5230\u679a\u4e3e\u7edd\u5bf9\u4f17\u6570\uff0c\u7528\u533a\u95f4\u548c\u6765\u5224\u65ad\u533a\u95f4\u5408\u6cd5\u6027\u8fd9\u4e00\u5e38\u89c1 trick\u3002\n\n\u679a\u4e3e\u4e25\u683c\u4f17\u6570\uff0c\u5c06\u5f53\u524d\u679a\u4e3e\u7684\u989c\u8272\u8bbe\u4e3a $+1$\uff0c\u5176\u5b83\u989c\u8272\u8bbe\u4e3a $-1$\uff0c\u7528\u524d\u7f00\u548c\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u82e5 $[l,r]$ \u5408\u6cd5\u5728\u5f53\u524d\u7684\u5145\u8981\u6761\u4ef6\u662f $sum_{r} - sum_{l - 1} > 0$\u3002\n\n\u5373\uff0c\u95ee\u9898\u53d8\u6210\u4e86\u6c42\u5f53\u524d\u5e8f\u5217\u7684\u5168\u5c40\u6b63\u5e8f\u5bf9\u3002\n\n\u4e00\u4e2a\u81ea\u7136\u7684\u60f3\u6cd5\u662f\u6839\u53f7\u5206\u6cbb\u540e\u5927\u4e8e\u9608\u503c\u7684\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5168\u5c40\u6b63\u5e8f\u5bf9\uff0c\u5c0f\u4e8e\u9608\u503c\u7684\u66b4\u529b\u679a\u4e3e\u533a\u95f4\uff0c\u4f46\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u5e76\u4e0d\u4f18\u79c0\uff0c\u8003\u8651 polylog \u505a\u6cd5\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u4e8b\u5b9e\u4e0a\u5bf9\u4e8e\u6bcf\u79cd\u989c\u8272\uff0c\u5176\u5c06\u5e8f\u5217\u5212\u5206\u6210\u4e86\u82e5\u5e72\u4e2a\u6bb5\uff0c\u6bcf\u4e00\u6bb5\u7684\u524d\u7f00\u548c\u5f62\u5982\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u4e8e\u662f\u5c31\u5f88\u597d\u505a\u4e86\uff0c\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6bcf\u4e2a\u4f4d\u7f6e\uff0c\u5f53\u524d\u52a0\u5165\u4e00\u4e2a\u6570\u65f6\u524d\u9762\u6709\u591a\u5c11\u4e2a\u6570\u5c0f\u4e8e\u5b83\uff0c\u95ee\u9898\u8f6c\u5316\u6210\u4e86\u533a\u95f4\u7b49\u5dee\u6570\u5217\u52a0\uff0c\u533a\u95f4\u548c\uff0c\u8be5\u534a\u7fa4\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u7ebf\u6bb5\u6811 lazytag \u5f62\u5f0f\u7ef4\u62a4\u3002\n\n\u518d\u7a0d\u5fae\u63a8\u4e00\u4e0b\u5c31\u6709 $O(n)$ \u7684\u505a\u6cd5\u4e86\uff0c\u4f46\u662f\u4e2a\u4eba\u611f\u89c9\u6ca1\u4ec0\u4e48\u5fc5\u8981\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n```cpp\n/*\n\u8003\u8651\u76f4\u63a5\u679a\u4e3e\u989c\u8272\uff0c\u5c1d\u8bd5\u53bb\u7edf\u8ba1\u4e00\u4e0b\u3002\n\u90a3\u4e48\u5c31\u662f\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u533a\u95f4\u548c\u662f > 0\u3002\n\u5982\u679c\u8981\u6839\u53f7\u5206\u6cbb\u7684\u8bdd\u96be\u70b9\u5c31\u662f\u7ebf\u6027\u626b\uff0c\u8003\u8651\u5148\u6eda\u4e2a\u524d\u7f00\u548c\uff0c\u7136\u540e\u5c31\u662f\u5168\u5c40\u7684\u987a\u5e8f\u5bf9\u4e2a\u6570\uff0c\u90a3\u5c31\u5fc5\u987b\u5e26 log \u4e86\u3002\n\u8003\u8651\u6b63\u5e38\u4e00\u70b9\u7684\u505a\u6cd5\u3002\u4e0d\u59a8\u4ece > B \u7684\u89d2\u5ea6\u51fa\u53d1\u3002\n\u4e0d\u59a8\u91cd\u65b0\u8003\u8651\u4e00\u4e0b\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5bf9\u6bcf\u79cd\u989c\u8272\u5355\u72ec\u8003\u8651\u6211\u4eec\u53d1\u73b0\uff0c\u95f4\u9699\u4e4b\u95f4\u7684 sum \u662f\u9012\u51cf\u7684\uff0c\u6240\u4ee5\u4e00\u5b9a\u53ef\u4ee5\u7ef4\u62a4\u6210\u4e00\u4e2a\u5408\u5e76\u4fe1\u606f\n\u4e0d\u59a8\u5012\u7f6e\u4e00\u4e0b\u4fe1\u606f\uff0c\u4ea4\u6362\u7ef4\u62a4\u4e0e\u67e5\u8be2\u4fe1\u606f\uff0c\u5199\u6210\u533a\u95f4\u52a0\u52a0\u7b49\u5dee\u6570\u5217\u7684\u5f62\u5f0f\u3002\n\u8fd8\u8981\u533a\u95f4\u6c42\u548c\u3002\nO(n \\log n)\n*/\n#include \"bits/stdc++.h\"\nusing namespace std;\nconst int Len = 1e6 + 5;\n#define int ll\n#define ll long long\n#define ls(p) (p << 1)\n#define rs(p) (p << 1 | 1)\nint n,m,a[Len],tp;\nll sum[Len << 2],tag[Len << 2],tagd[Len << 2],gat[Len << 2];\n//i < j,sum_i < sum_j\ninline void push_up(int p){sum[p] = sum[ls(p)] + sum[rs(p)];}\ninline void cgd(int p,int w,int d,int len){sum[p] += 1ll * (w + w + 1ll * (len - 1) * d) * len / 2;tag[p] += w , tagd[p] += d;}\ninline void cg(int p,int w,int len){sum[p] += 1ll * len * w;gat[p] += w;}\ninline void push_down(int p,int l,int r)\n{\n    if(tag[p] || tagd[p])\n    {\n        int mid = (l + r) >> 1;\n        cgd(ls(p) , tag[p] , tagd[p] , mid - l + 1) , cgd(rs(p) , tag[p] + (mid - l + 1) * tagd[p] , tagd[p] , r - mid);\n        tag[p] = 0;tagd[p] = 0;\n    }\n    if(gat[p])\n    {\n        int mid = (l + r) >> 1;\n        cg(ls(p) , gat[p] , mid - l + 1) , cg(rs(p) , gat[p] , r - mid);\n        gat[p] = 0;\n    }\n}\n//3 + 3 = 6\nvoid update_d(int p,int l,int r,int nl,int nr,int w,int d)\n{\n    if(nl <= l && nr >= r)\n    {\n        cgd(p , w + 1ll * (l - nl) * d , d , r - l + 1);\n        return;\n    }\n    push_down(p , l , r);\n    int mid = (l + r) >> 1;\n    if(nl <= mid) update_d(ls(p) , l , mid , nl , nr , w , d);\n    if(nr > mid) update_d(rs(p) , mid + 1 , r , nl , nr , w , d);\n    push_up(p);\n}\nvoid update(int p,int l,int r,int nl,int nr,int w)\n{\n    if(nl <= l && nr >= r){cg(p , w , r - l + 1);return;}\n    push_down(p , l , r);\n    int mid = (l + r) >> 1;\n    if(nl <= mid) update(ls(p) , l , mid , nl , nr , w);\n    if(nr > mid) update(rs(p) , mid + 1 , r , nl , nr , w);\n    push_up(p);\n}\nll query(int p,int l,int r,int nl,int nr)\n{\n    if(nl <= l && nr >= r) return sum[p];\n    push_down(p , l , r);\n    int mid = (l + r) >> 1;ll res = 0;\n    if(nl <= mid) res += query(ls(p) , l , mid , nl , nr);\n    if(nr > mid) res += query(rs(p) , mid + 1 , r , nl , nr);\n    return res;\n}\ninline ll Q(int l,int r){return query(1 , 0 , (n * 2) , l , r);}\nstruct Node\n{\n    int op,l,r,w,d;\n    Node(){op = l = r = w = d = 0;}\n    Node(int OP,int L,int R,int W,int D){op = OP , l = L , r = R , w = W , d = D;}\n};\nvoid build(int p,int l,int r)\n{\n\ttag[p] = sum[p] = gat[p] = 0;\n\tif(l == r) return;\n\tint mid = (l + r) >> 1;\n\tbuild(ls(p) , l , mid);\n\tbuild(rs(p) , mid + 1 , r);\n}\nvector<int> vec[Len];\nsigned main()\n{\n    scanf(\"%lld %lld\",&n,&tp);\n    for(int i = 1 ; i <= n ; i ++) \n    {   \n        scanf(\"%lld\",&a[i]);\n        vec[a[i]].push_back(i);\n    }\n    ll as = 0;update(1 , 0 , n * 2 , n + 1 , (n * 2) , 1);\n    for(int i = 0 ; i <= n ; i ++)\n    {\n        vector<Node> vc;int suf = 0;\n        //if(i != 2) continue;\n        for(int j = 0 ; j < (int)vec[i].size() ; j ++)\n        {\n            int x = vec[i][j];\n            if(!j && x != 1) \n            {\n            \tint len = x - 1;\n            \t//[n - len , n - 1]\n            \t//\u5bf9\u4e8e [n , n * 2] \u8d21\u732e\u4e3a len\n            \t//\u5bf9\u4e8e [n - len + 1 , n - 1] \u8d21\u732e\u4e3a 1 \u5f00\u59cb\u7684\u7b49\u5dee\u6570\u5217\n\t\t\t\tupdate(1 , 0 , n * 2 , n , n * 2 , len) , vc.push_back(Node(0 , n , n * 2 , len , 0));\n\t\t\t\tif(n - len + 1 <= n - 1) update_d(1 , 0 , n * 2 , n - len + 1 , n - 1 , 1 , 1) ,  vc.push_back(Node(1 , n - len + 1 , n - 1 , 1 , 1));\n\t\t\t}\n            if(j == (int)vec[i].size() - 1) suf = n;\n            else suf = vec[i][j + 1] - 1;\n            //[sm - len + 1,sm]\n            int len = suf - x + 1 , sm = n + j + 1 - (x - (j + 1));\n            //printf(\"!!!%d %d\\n\",sm - len + 1,sm);\n    \t\t//\u5bf9\u4e8e [sm + 1 , n * 2] \u8d21\u732e\u4e3a len\n\t\t\t//\u5bf9\u4e8e [sm - len + 2 , sm] \u8d21\u732e\u4e3a\u4ece 1 \u5f00\u59cb\u7684\u7b49\u5dee\u6570\u5217\n\t\t\tas += Q(sm - len + 1 , sm);\n\t\t\tupdate(1 , 0 , n * 2 , sm + 1 , n * 2 , len) , vc.push_back(Node(0 , sm + 1 , n * 2 , len , 0));\n\t\t\tif(sm - len + 2 <= sm) update_d(1 , 0 , n * 2 , sm - len + 2 , sm , 1 , 1) ,  vc.push_back(Node(1 , sm - len + 2 , sm , 1 , 1));\n        }\n        for(int j = 0 ; j < (int)vc.size() ; j ++)\n        {\n            if(!vc[j].op) update(1 , 0 , n * 2 , vc[j].l , vc[j].r , -vc[j].w);\n            else update_d(1 , 0 , n * 2 , vc[j].l , vc[j].r , -vc[j].w , -vc[j].d);\n        }\n    }\n    printf(\"%lld\\n\",as);\n    return 0;\n}\n//[3,4,5]\n```",
        "postTime": 1672243562,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u6211\u90a3\u5d07\u9ad8\u65e0\u5c1a\u7684\u5e0c\u671b\u706f\u706b\uff0c\u6df1\u85cf\u7684\u79d8\u5bc6\u662f\u5728\u4e45\u8fdc\u7684\u4ece\u524d"
    },
    {
        "content": "\u8bb2\u4e00\u4e2a\u66b4\u529b\u70b9\u7684\u505a\u6cd5\u3002\n\n\u9996\u5148\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u6570\u5b57\u662f $[l,r]$ \u4e4b\u95f4\u7684\u4f17\u6570\u7684\u8bdd\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u5b57\u80af\u5b9a\u662f $[l,mid]$ \u4e4b\u95f4\u7684\u4f17\u6570\u6216\u8005\u662f $[mid+1,r]$ \u4e4b\u95f4\u7684\u4f17\u6570\u3002\uff08\u5176\u4e2d $mid=\\left\\lfloor\\frac{l+r}{2}\\right\\rfloor$\uff09 \n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u5206\u6cbb\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u8ba1\u7b97\u51fa\u7ecf\u8fc7 $mid$ \u7684\u6ee1\u8db3\u9898\u610f\u7684\u533a\u95f4\u6570\u3002\n\n\u76f4\u63a5\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u5b57\u66b4\u529b\u8ba1\u7b97\u662f $\\mathcal{O}(n^2 \\operatorname{log}^2 n)$ \u7684\uff0c\u80af\u5b9a\u8fc7\u4e0d\u53bb\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u53ef\u4ee5\u8003\u8651\u76f4\u63a5\u6311\u51fa\u53ef\u80fd\u6210\u4e3a\u7ecf\u8fc7 $mid$ \u7684\u533a\u95f4\u7684\u4f17\u6570\u7684\u6570\u5b57\u3002\u53d1\u73b0\u8fd9\u4e2a\u6570\u5b57\u6570\u91cf\u662f $\\log n$ \u7ea7\u522b\u7684\uff0c\u4e8e\u662f\u4f18\u5316\u5230 $\\mathcal{O}(n\\operatorname{log}^3n)$\n\n\u4f60\u53ef\u80fd\u89c9\u5f973\u53ealog\u4e0d\u53ef\u80fd\u8fc75e5\uff0c\u4f46\u56e0\u4e3a\u5b9e\u9645\u4e0a\u538b\u6839\u8dd1\u4e0d\u6ee1\uff0c\u4e8e\u662f\u5b83\u8fc7\u4e86\uff0c\u800c\u4e14\u8fd8\u8dd1\u5f97\u98de\u5feb\uff0c\u8fd8\u8dd1\u5f97\u6bd4 $\\sf\\color{black}{L}\\color{red}{imit}$ \u7684\u7ebf\u6bb5\u6811\u505a\u6cd5\u5feb...\n\n\u81f3\u4e8e\u63a5\u4e0b\u6765\u600e\u4e48\u53bb\u505a\uff0c\u76f8\u4fe1\u5f88\u591a\u9898\u89e3\u91cc\u5df2\u7ecf\u8bb2\u8fc7\u4e86\uff0c\u6211\u8fd9\u91cc\u518d\u590d\u8ff0\u4e00\u904d\u3002\n\n\u6311\u51fa\u8fd9\u4e9b\u6570\u5b57\u4ee5\u540e\uff0c\u6211\u4eec\u628a\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u6570\u5b57 $x$\uff0c\u6c42\u533a\u95f4 $[l,r]$ \u4e2d\u6709\u591a\u5c11\u5b50\u533a\u95f4\u7ecf\u8fc7 $mid$\uff0c\u800c\u4e14\u6ee1\u8db3\u533a\u95f4\u4f17\u6570\u662f $x$ \u4e14\u533a\u95f4\u6ee1\u8db3\u9898\u610f\u3002\n\n\u6839\u636e\u6469\u5c14\u6295\u7968\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u4e2a\u7b49\u4e8e $x$ \u7684\u5730\u65b9\u8f6c\u4e3a 1\uff0c\u5426\u5219\u5c31\u662f -1\uff0c\u95ee\u9898\u53d8\u6210\u4e86\u6c42\u6709\u591a\u5c11\u5b50\u533a\u95f4\u7ecf\u8fc7 $mid$\uff0c\u800c\u4e14\u6ee1\u8db3\u533a\u95f4\u548c\u5927\u4e8e0\u3002\n\n\u8003\u8651\u628a\u533a\u95f4 $[l,r]$ \u524d\u7f00\u548c\u4e00\u4e0b\uff0c\u8bbe\u524d\u7f00\u548c\u540e\u7b2c $i$ \u4e2a\u70b9\u7684\u7ed3\u679c\u4e3a $sum_i$\uff0c\u95ee\u9898\u53d8\u6210\u4e86\u6c42\n\n$$\n\\sum_{i=mid}^r \\sum_{j=l}^{mid-1} [sum_i>sum_j]\n$$\n\n\u5176\u4e2d $[p]$ \u8868\u793a\u5e03\u5c14\u8868\u8fbe\u5f0f\uff0c\u5373 $p$ \u662f\u5426\u4e3a\u771f\u3002\n\n\n\u8fd9\u5768\u4e1c\u897f\u53d1\u73b0\u53ef\u4ee5\u8f7b\u677e\u7528\u6811\u72b6\u6570\u7ec4\u641e\u5b9a\u3002\u7136\u540e\u5c31\u6ca1\u6709\u7136\u540e\u4e86\u3002\n\n\n\u4e0d\u8fc7\u53d1\u73b0\u533a\u95f4\u5927\u5c0f\u4e3a 1 \u7684\u65f6\u5019\u5bb9\u6613\u91cd\u590d\u8ba1\u7b97\uff0c\u90a3\u4e48\u5c31\u76f4\u63a5\u52a0\u4e2a\u533a\u95f4\u5927\u5c0f\u5927\u4e8e 1 \u7684\u9650\u5236\u5373\u53ef\uff0c\u5373\u6c42\uff1a\n\n$$\n\\sum_{i=mid+1}^r \\sum_{j=l}^{mid-1} [sum_i>sum_j]\n$$\n\n\u6700\u540e\u52a0\u4e0a\u5927\u5c0f\u4e3a 1 \u7684\u533a\u95f4\u6570\u91cf\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\operatorname{log}^3n)$\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=500000+5;\nint n,tree[N<<2];\nint limit;\nvoid add(int x,int c){\n\tx+=n+1;\n\twhile(x<=limit) tree[x]+=c,x+=(x&-x);  \n}\nint query(int x){\n\tint res=0;x+=n+1;\n\twhile(x>0) res+=tree[x],x-=(x&-x);\n\treturn res;\n}\nlong long ans;\nint cnt[N],a[N];\nset<int>::iterator it;\nvoid calc(int x,int l,int mid,int r){\n\tint sum=0;\n\tadd(0,1);\n\tfor(int i=l;i<=mid;++i){\n\t\tsum+=(a[i]==x?1:-1);\n\t\tif(i!=mid) add(sum,1);\n\t\t//cout<<sum<<\" A\"<<endl;\n\t}\n\tfor(int i=mid+1;i<=r;++i)\n\t\tsum+=(a[i]==x?1:-1),\n\t\t//cout<<sum<<\" B\\n\",\n\t\tans+=query(sum-1);\n\tsum=0;\n\tfor(int i=l;i<mid;++i){\n\t\tsum+=(a[i]==x?1:-1);\n\t\tadd(sum,-1);\n\t}\n\tadd(0,-1);\n}\nvoid query(int l,int r){\n\tif(l==r) return ++ans,void(0);\n\tint mid=(l+r)>>1;\n\tquery(l,mid);query(mid+1,r);\n\tset<int> s;\n\tfor(int i=mid+1,mx=0;i<=r;++i){\n\t\t++cnt[a[i]];\n\t\tif(cnt[a[i]]>cnt[mx]) mx=a[i],s.insert(mx);\n\t}\n\tfor(int i=mid+1;i<=r;++i) --cnt[a[i]];\n\tfor(int i=mid,mx=0;i>=l;--i){\n\t\t++cnt[a[i]];\n\t\tif(cnt[a[i]]>cnt[mx]) mx=a[i],s.insert(mx);\n\t}\n\t//out<<l<<\" \"<<r<<\" seg\\n\";\n\t//for(int i=l;i<=r;++i)cout<<a[i]<<\" \";cout<<endl;\n\tfor(int i=mid;i>=l;--i) --cnt[a[i]];\n\tfor(it=s.begin();it!=s.end();++it)\n\t\t//cout<<l<<\" \"<<r<<\" \"<<(*it)<<\" \"<<ans<<endl,\n\t\tcalc(*it,l,mid,r);\n}\nint main(){\n\tint type;\n\tscanf(\"%d%d\",&n,&type);limit=n+n+1;\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%d\",&a[i]),a[i]=a[i]+1;\n\tquery(1,n);\n\tcout<<ans;\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1594034499,
        "uid": 344016,
        "name": "wurzang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4062)\n\n\u9898\u610f\uff1a\n\n\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217 $a$\uff0c\u6c42 $a$ \u6709\u591a\u5c11\u4e2a\u5b50\u533a\u95f4 $[l,r]$\uff0c\u6ee1\u8db3\u8fd9\u4e2a\u533a\u95f4\u4e2d\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684\u6570\u51fa\u73b0\u6b21\u6570 $>\\dfrac{r-l+1}{2}$\n\n$1 \\leq n \\leq 5\\times 10^5$\n\n\u9996\u5148\u80af\u5b9a\u8981\u679a\u4e3e\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684\u6570\u662f\u4ec0\u4e48\uff0c\u5047\u8bbe\u4e3a $x$\u3002\n\n\u8bb0\u5e8f\u5217\u4e2d\u4e3a $x$ \u7684\u6570\u4e3a $+1$\uff0c\u6570\u5217\u4e2d\u4e0d\u4e3a $x$ \u7684\u6570\u4e3a $-1$\uff0c\u90a3\u4e48 $x$ \u51fa\u73b0\u6b21\u6570 $>\\dfrac{r-l+1}{2}$ \u7b49\u4ef7\u4e8e\u8be5\u533a\u95f4\u4e2d\u5bf9\u5e94\u7684\u6570\u7684\u548c $>0$\u3002\n\n\u8003\u8651\u5bf9\u8fd9\u4e2a $+1,-1$ \u7684\u5e8f\u5217\u505a\u4e00\u904d\u524d\u7f00\u548c\u5f97\u5230 $s_i$\uff0c\u90a3\u4e48\u6ee1\u8db3\u6761\u4ef6\u7684\u533a\u95f4\u4e2a\u6570\u5373\u4e3a $s_i$ \u7684**\u987a\u5e8f\u5bf9\u4e2a\u6570**\u3002\n\n\u5bf9\u4e8e $type=1,3$ \u7684\u60c5\u51b5\uff0c\u505a $8$ \u6b21\u6811\u72b6\u6570\u7ec4\u6c42\u987a\u5e8f\u5bf9\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u800c\u5bf9\u4e8e\u539f\u9898\u6765\u8bf4\u8fd9\u6837\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u4e0d\u8fc7\u53d1\u73b0\u5bf9\u4e8e $x$ \u53d6\u4ec0\u4e48\u503c\uff0c$1$ \u7684\u4e2a\u6570\u52a0\u8d77\u6765\u53ea\u6709 $n$ \u4e2a\uff0c\u8fd9\u610f\u5473\u7740\u5927\u90e8\u5206\u6570\u90fd\u662f $-1$\uff0c\u90a3\u4e48\u6211\u4eec\u601d\u8003\u80fd\u4e0d\u80fd\u62ff\u8fd9\u4e2a\u6027\u8d28\u505a\u6587\u7ae0\u5462\uff1f\n\n\u8003\u8651\u4ece\u5de6\u5230\u53f3\u4f9d\u6b21\u63d2\u5165\u4e00\u6bb5\u8fde\u7eed\u7684 $-1$\uff0c\u663e\u7136\u8fd9\u4e9b\u4f4d\u7f6e\u7684 $s$ \u503c\u53ef\u4ee5\u5f62\u6210\u4e00\u6bb5\u8fde\u7eed\u7684\u533a\u95f4\uff08\u516c\u5dee\u4e3a $-1$ \u7684\u7b49\u5dee\u6570\u5217\uff09\uff0c\u4e0d\u59a8\u8bbe\u5176\u4e3a $[L,R]$\u3002\n\n\u5047\u8bbe $cnt_j$ \u4e3a\u5f53\u524d $s_i=j$ \u7684 $i$ \u7684\u4e2a\u6570\uff0c\u90a3\u4e48\u8fd9\u6bb5\u533a\u95f4\u7684\u8d21\u732e\u5c31\u662f\n\n$$\\sum\\limits_{i=L}^{R}\\sum\\limits_{j=-\\infty}^{i-1}cnt_j$$\n\n\u628a\u8fd9\u4e2a\u5f0f\u5b50\u7a0d\u5fae\u8c03\u6574\u4e00\u4e0b\u5c31\u53ef\u4ee5\u5f97\u5230\n\n$$(R-L+1)\\times\\sum\\limits_{j=-\\infty}^{L-1}cnt_j+\\sum\\limits_{j=L}^Rcnt_j\\times(R-j)$$\n\n\u662f\u4e0d\u662f\u611f\u89c9\u6709\u4ebf\u70b9\u70b9\u53ef\u7ef4\u62a4\uff1f\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4 $cnt_j$ \u7684\u503c\uff0c\u652f\u6301\u533a\u95f4\u52a0\u3001\u6c42\u533a\u95f4 $cnt_i$ \u7684\u548c\uff0c\u4ee5\u53ca\u533a\u95f4 $i \\times cnt_i$ \u7684\u548c\uff0c\u5c31\u53ef\u4ee5\u5728 $\\mathcal O(\\log n)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u7684\u503c\u3002\n\n\u7531\u4e8e $s_j$ \u53ef\u80fd $<0$\uff0c\u6240\u4ee5\u4e0b\u6807\u8981\u6574\u4f53\u52a0\u4e0a\u4e00\u4e2a\u503c\u3002\n\n\u867d\u7136 $-1$ \u7684\u4e2a\u6570\u5f88\u591a\uff0c\u4f46\u662f\u8fde\u7eed\u7684 $-1$ \u6bb5\u7684\u4e2a\u6570\u662f $\\mathcal O(n)$ \u7ea7\u522b\u7684\uff0c\u800c\u6211\u4eec\u6070\u597d\u5229\u7528\u4e86\u8fd9\u4e2a\u6027\u8d28\u5c06\u590d\u6742\u5ea6\u964d\u4e86\u4e0b\u6765\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntypedef pair<int,int> pii;\ntypedef long long ll;\nconst int MAXN=5e5+5;\nint n,a[MAXN];\nvector<int> v[MAXN];\nstruct node{\n\tint l,r;\n\tll val,mul,lz,sumi;\n} s[MAXN<<4];\nvoid build(int k,int l,int r){\n\ts[k].l=l;s[k].r=r;s[k].val=s[k].lz=s[k].mul=0;if(l==r){s[k].sumi=l-MAXN;return;}\n\tint mid=(l+r)>>1;build(k<<1,l,mid);build(k<<1|1,mid+1,r);\n\ts[k].sumi=s[k<<1].sumi+s[k<<1|1].sumi;\n}\nvoid pushdown(int k){\n\tif(s[k].lz){\n\t\ts[k<<1].val+=(s[k<<1].r-s[k<<1].l+1)*s[k].lz;\n\t\ts[k<<1].mul+=s[k<<1].sumi*s[k].lz;s[k<<1].lz+=s[k].lz;\n\t\ts[k<<1|1].val+=(s[k<<1|1].r-s[k<<1|1].l+1)*s[k].lz;\n\t\ts[k<<1|1].mul+=s[k<<1|1].sumi*s[k].lz;s[k<<1|1].lz+=s[k].lz;\n\t\ts[k].lz=0;\n\t}\n}\nvoid modify(int k,int l,int r,int x){\n\tif(l<=s[k].l&&s[k].r<=r){\n\t\ts[k].val+=(s[k].r-s[k].l+1)*x;\n\t\ts[k].mul+=s[k].sumi*x;s[k].lz+=x;\n\t\treturn;\n\t} pushdown(k);\n\tint mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) modify(k<<1,l,r,x);\n\telse if(l>mid) modify(k<<1|1,l,r,x);\n\telse modify(k<<1,l,mid,x),modify(k<<1|1,mid+1,r,x);\n\ts[k].val=s[k<<1].val+s[k<<1|1].val;\n\ts[k].mul=s[k<<1].mul+s[k<<1|1].mul;\n}\nll query(int k,int l,int r){\n//\tprintf(\"%d %d %d\\n\",k,l,r);\n\tif(l<=s[k].l&&s[k].r<=r) return s[k].val;\n\tpushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) return query(k<<1,l,r);\n\telse if(l>mid) return query(k<<1|1,l,r);\n\telse return query(k<<1,l,mid)+query(k<<1|1,mid+1,r);\n}\nll queryi(int k,int l,int r){\n\tif(l<=s[k].l&&s[k].r<=r) return s[k].mul;\n\tpushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) return queryi(k<<1,l,r);\n\telse if(l>mid) return queryi(k<<1|1,l,r);\n\telse return queryi(k<<1,l,mid)+queryi(k<<1|1,mid+1,r);\n}\nint main(){\n\tint qwq;scanf(\"%d%d\",&n,&qwq);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]),v[a[i]].pb(i);\n\tbuild(1,0,MAXN<<1);ll ret=0;\n\tfor(int i=0;i<n;i++){\n//\t\tprintf(\"%d\\n\",i);\n\t\tint pre=0,sum=0;modify(1,MAXN,MAXN,1);\n\t\tfor(int j=0;j<v[i].size();j++){\n\t\t\tint cur=v[i][j];\n\t\t\tif(pre+1!=cur){\n\t\t\t\tint r=sum-1,l=sum-(cur-pre-1);\n\t\t\t\tret+=r*query(1,l+MAXN,r+MAXN)-queryi(1,l+MAXN,r+MAXN);\n\t\t\t\tret+=(r-l+1)*query(1,0,l-1+MAXN);modify(1,l+MAXN,r+MAXN,1);\n\t\t\t\tsum-=(cur-pre-1);\n\t\t\t}\n\t\t\tsum++;ret+=query(1,0,sum-1+MAXN);modify(1,sum+MAXN,sum+MAXN,1);\n\t\t\tpre=cur;\n\t\t}\n\t\tif(pre!=n){\n\t\t\tint r=sum-1,l=sum-(n-pre);\n\t\t\tret+=r*query(1,l+MAXN,r+MAXN)-queryi(1,l+MAXN,r+MAXN);\n\t\t\tret+=(r-l+1)*query(1,0,l-1+MAXN);modify(1,l+MAXN,r+MAXN,1);\n\t\t\tsum-=(n-pre);\n\t\t}\n\t\tpre=0,sum=0;modify(1,MAXN,MAXN,-1);\n\t\tfor(int j=0;j<v[i].size();j++){\n\t\t\tint cur=v[i][j];\n\t\t\tif(pre+1!=cur){\n\t\t\t\tint r=sum-1,l=sum-(cur-pre-1);\n\t\t\t\tmodify(1,l+MAXN,r+MAXN,-1);\n\t\t\t\tsum-=(cur-pre-1);\n\t\t\t}\n\t\t\tsum++;modify(1,sum+MAXN,sum+MAXN,-1);\n\t\t\tpre=cur;\n\t\t}\n\t\tif(pre!=n){\n\t\t\tint r=sum-1,l=sum-(n-pre);\n\t\t\tmodify(1,l+MAXN,r+MAXN,-1);\n\t\t\tsum-=(n-pre);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ret);\n\treturn 0;\n}\n```\n\nupd on 2020.12.4\uff1a\n\n\u8003\u573a\u4e0a\u60f3\u7684\u505a\u6cd5\u7adf\u7136\u8fc7\u4e86\uff01incredible\uff01\u6211\u8fd8\u4ee5\u4e3a\u5b83\u8fc7\u4e0d\u4e86\u5462/xyx\n\n\u8bb2\u4e00\u4e2a $n\\sqrt{n\\log n}$ \u7684\u505a\u6cd5\u3002\n\n\u8003\u8651\u5206\u5757\uff0c\u8bbe\u4e00\u4e2a\u4e34\u754c\u503c $B$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u51fa\u73b0\u6b21\u6570 $\\leq B$ \u7684\u6570\uff0c\u663e\u7136\u5b83\u53ea\u80fd\u5bf9\u957f\u5ea6 $<2B$ \u7684\u533a\u95f4\u4ea7\u751f\u8d21\u732e\uff0c\u679a\u4e3e\u6bcf\u4e2a\u957f\u5ea6 $<2B$ \u7684\u533a\u95f4\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u51fa\u73b0\u6b21\u6570 $>B$ \u7684\u6570\uff0c\u8fd9\u6837\u7684\u6570\u9876\u591a $\\dfrac{n}{B}$ \u4e2a\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8fd9\u6837\u7684\u6570\u641e\u4e00\u904d\u6811\u72b6\u6570\u7ec4\u6c42\u987a\u5e8f\u5bf9\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $2nB+\\dfrac{n^2\\log n}{B}$\u3002\n\n~~woc \u8fd9\u73a9\u610f\u513f\u771f\u7684 nb $10^9$ \u5de6\u53f3\u7ed9\u6211\u8dd1\u8fc7\u53bb\u4e86\u3002~~\n\n\u987a\u4fbf\u63d0\u4e00\u53e5\uff1a\u8003\u573a\u4e0a\u6211\u5728\u6c42 $<2B$ \u7684\u533a\u95f4\u7684\u8d21\u732e\u7684\u65f6\u5019\u7528\u4e86 memset \u6240\u4ee5 T \u6389\u4e86\u8fd8\u4ee5\u4e3a\u662f\u7a0b\u5e8f\u672c\u8eab\u7684\u9505\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAXN=5e5+5;\ntypedef long long ll;\nint n,sub,a[MAXN];\nconst int BLK=800;\nint cnt[MAXN],f[MAXN];\nint sum[MAXN];\nint bit[MAXN<<1];\nvoid add(int x,int v){for(int i=x;i<MAXN+MAXN;i+=(i&(-i))) bit[i]+=v;}\nint query(int x){int ret=0;for(int i=x;i;i-=(i&(-i))) ret+=bit[i];return ret;}\nint solve(){\n\tfor(int i=1;i<=n;i++) f[a[i]]++;\n\tll ret=0;\n\tfor(int i=1;i<=n;i++){\n\t\tint mx=0,pos=0;\n\t\tfor(int j=i;j<=n&&j<=i+BLK*2;j++){\n\t\t\tcnt[a[j]]++;if(cnt[a[j]]>mx) mx=cnt[a[j]],pos=a[j];\n\t\t\tif(mx>(j-i+1)/2&&f[pos]<BLK) ret++;\n        }\n        for(int j=i;j<=n&&j<=i+BLK*2;j++){\n\t\t\tcnt[a[j]]--;\n\t\t}\n\t}\n\tfor(int i=0;i<n;i++){\n\t\tif(f[i]<BLK) continue;\n\t\tmemset(sum,0,sizeof(sum));\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tif(a[j]==i) sum[j]=sum[j-1]+1;\n\t\t\telse sum[j]=sum[j-1]-1;\n\t\t}\n\t\tmemset(bit,0,sizeof(bit));\n\t\tadd(MAXN,1);\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tret+=query(sum[j]-1+MAXN);\n\t\t\tadd(sum[j]+MAXN,1);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ret);\n\treturn 0;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&sub);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\treturn solve();\n}\n```",
        "postTime": 1606996136,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "\n[P4062 Yazid \u7684\u65b0\u751f\u821e\u4f1a](https://www.luogu.com.cn/problem/P4062)\n\n> \u7ed9\u5b9a\u4e00\u957f\u5ea6\u4e3a$n$\u7684\u5e8f\u5217\uff0c\u6c42\u6709\u591a\u5c11\u5b50\u5e8f\u5217$[l,r]$\u7684\u4f17\u6570\u51fa\u73b0$\\frac{r-l+1}{2}$\u6b21\n\n- \u7b97\u6cd5\u4e00\uff08\u9488\u5bf9$n\\leq 300$\uff09\n\n\u8003\u8651\u679a\u4e3e\u6240\u6709\u533a\u95f4\uff0c\u7136\u540e\u6c42\u5176\u4f17\u6570\u53ca\u51fa\u73b0\u6b21\u6570\uff0c\u5e76\u5224\u65ad\u662f\u5426\u8d85\u8fc7\u533a\u95f4\u603b\u957f\u7684\u4e00\u534a\uff0c\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O\\left( n^3\\right)$\n\n- \u7b97\u6cd5\u4e8c\uff08$n\\leq 2,000$\uff09\n\n\u8003\u8651\u5148\u679a\u4e3e\u533a\u95f4\u7684\u5de6\u7aef\u70b9$l$\uff0c\u518d\u4ece\u5de6\u5230\u53f3\u679a\u4e3e\u53f3\u7aef\u70b9$r$\u5e76\u7528\u6570\u7ec4\u7ef4\u62a4\u6bcf\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u540c\u65f6\u4f7f\u7528\u53d8\u91cf\u7ef4\u62a4\u5f53\u524d\u4f17\u6570\u3001\u4f17\u6570\u7684\u51fa\u73b0\u6b21\u6570\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u5f53\u53f3\u7aef\u70b9\u5411\u53f3\u79fb\u52a8\u65f6\uff0c\u8fd9\u4e9b\u4fe1\u606f\u90fd\u662f\u975e\u5e38\u65b9\u4fbf\u7ef4\u62a4\u7684\u3002\u4e8e\u662f\u6211\u4eec\u4fbf\u53ef\u4ee5\u5728$O\\left( n^2\\right)$\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7edf\u8ba1\u6240\u6709\u7b54\u6848\u3002\n\n- \u7b97\u6cd5\u4e09\uff08$type=1$\uff09\n\n\u5bf9\u4e8e$01$\u5e8f\u5217\uff0c\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c\u4f17\u6570\u51fa\u73b0\u6b21\u6570\u4e25\u683c\u5927\u4e8e\u5b50\u533a\u95f4\u957f\u5ea6\u5f53\u4e14\u4ec5\u5f53\u5b50\u533a\u95f4\u5185$0,1$\u51fa\u73b0\u6b21\u6570\u4e0d\u540c\uff08\u90a3\u4e48\u90a3\u4e2a\u51fa\u73b0\u6b21\u6570\u8f83\u591a\u7684\u5c31\u662f\u4f17\u6570\uff09\u3002\u4e8e\u662f\u6211\u4eec\u5c06\u539f\u5e8f\u5217\u4e2d\u7684$0$\u89c6\u4f5c$-1$\uff0c\u5e76\u5bf9\u8be5\u5e8f\u5217\u6c42\u524d\u7f00\u548c$S$\uff0c\u5219\u5b50\u533a\u95f4$[l,r]$\u4e3a\u201c\u65b0\u751f\u821e\u4f1a\u7684\u201d\uff0c\u5f53\u4e14\u4ec5\u5f53$S_r-S_{l-1}\\not= 0$\n\n\u6709\u4e86\u8fd9\u4e2a\u6027\u8d28\u6211\u4eec\u5c31\u53ef\u4ee5$O(1)$\u6765\u6c42\u89e3\u5b50\u533a\u95f4$[l,r]$\u662f\u4e0d\u662f\u7b26\u5408\u8981\u6c42\u4e86\uff0c\u4f46\u662f\u4e0d\u5e78\u7684\u662f\u8fd9\u6837\u4ecd\u9700\u8981\u679a\u4e3e$l,r$\uff0c\u590d\u6742\u5ea6\u4ecd\u662f$O(n^2)$\u3002\n\n\u6211\u4eec\u4e0d\u59a8**\u53cd\u7740\u6765\u60f3**\uff0c\u5b50\u533a\u95f4$[l,r]$**\u4e0d\u662f**\u201c\u65b0\u751f\u821e\u4f1a\u7684\u201d\uff0c\u5f53\u4e14\u4ec5\u5f53$S_r-S_{l-1}=0$\u5373$S_r=S_{l-1}$\u56e0\u6b64\u5bf9$S$\u8fdb\u884c\u6392\u5e8f\u5e76\u4ece\u5c0f\u5230\u5927\u7edf\u8ba1\u76f8\u7b49\u7684\u4e2a\u6570\u7136\u540e\u7528\u603b\u7684\u5b50\u533a\u95f4\u6570\u91cf$\\frac{n\\cdot(n+1)}{2}$\u51cf\u53bb\u76f8\u7b49\u7684\u4e2a\u6570\u5373\u4e3a\u7b54\u6848\n\n- \u7b97\u6cd5\u56db\uff08$type=2$\uff09\n\n\u5bf9\u4e8e\u6240\u6709\u6570\u7684\u51fa\u73b0\u6b21\u6570\u90fd\u8f83\u5c0f\uff08\u4e0d\u8d85\u8fc7$15$\uff09\u7684\u60c5\u51b5\uff0c\u4e0d\u96be\u53d1\u73b0\u6240\u6709\u201c\u65b0\u751f\u821e\u4f1a\u7684\u533a\u95f4\u201d\u7684\u957f\u5ea6\u4e5f\u4f1a\u8f83\u5c0f\uff08\u4e0d\u8d85\u8fc7$2\\times 15-1=29$\uff09\u3002\u4e8e\u662f\u4f7f\u7528\u7b97\u6cd5\u4e8c\uff0c\u679a\u4e3e\u6240\u6709\u957f\u5ea6\u5c11\u4e8e$30$\u7684\u533a\u95f4\u5e76\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\n\n- \u7b97\u6cd5\u4e94\uff08$type=3$\uff09\n\n\u5bf9\u4e8e$A_i\\leq 7$\u7684\u6d4b\u8bd5\u70b9\uff0c\u6211\u4eec\u4e0d\u59a8\u679a\u4e3e\u6240\u6709\u503c\u4f5c\u4e3a\u4f17\u6570\u7684\u60c5\u51b5\u3002\u8003\u8651\u7edf\u8ba1\u6240\u6709\u4f17\u6570\u4e3a$k$\u7684\u201c\u65b0\u751f\u821e\u4f1a\u7684\u201d\u533a\u95f4\uff0c\u5c06\u6240\u6709\u7b49\u4e8e$k$\u7684\u4f4d\u7f6e\u53d6\u4e3a$1$\uff0c\u4e0d\u7b49\u4e8e$k$\u7684\u4f4d\u7f6e\u53d6\u4e3a$-1$\uff0c\u5f97\u5230\u65b0\u5e8f\u5217$B$\u5e76\u6c42\u524d\u7f00\u548c\u5f97\u5230\u5e8f\u5217$S$\uff0c\u5219\u533a\u95f4$[l,r]$\u9700\u8981\u88ab\u7edf\u8ba1\uff0c\u5f53\u4e14\u4ec5\u5f53$S_r-S_{l-1}\\geq 1$\u3002\u4ece\u5de6\u5230\u53f3\u679a\u4e3e\u53f3\u7aef\u70b9\uff0c\u5e76\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5f53\u524d\u53f3\u7aef\u70b9\u5de6\u8fb9\u6bcf\u79cd\u524d\u7f00\u548c\u51fa\u73b0\u7684\u6b21\u6570\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O\\left( 8nlogn\\right)$\n\n- \u7b97\u6cd5\u516d\uff08$100pts$\uff09\n\n\u8003\u8651\u6539\u8fdb\u7b97\u6cd5\u4e94\u3002\u6211\u4eec\u8003\u8651\u53d6\u51fa\u6240\u6709$B$\u4e2d\u7684\u6781\u957f$-1$\u5b50\u533a\u95f4\uff0c\u89c2\u5bdf\u8fd9\u4e9b\u533a\u95f4\u4e2d\u7684\u6240\u6709\u70b9\u4f5c\u4e3a\u53f3\u7aef\u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\u4e0d\u96be\u53d1\u73b0\u6781\u957f$-1$\u5b50\u533a\u95f4$[l,r]$\u4e2d\u7684\u6240\u6709\u70b9\u4f5c\u4e3a\u53f3\u7aef\u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a$\\sum_{i=1}^{r-l+1}\\sum_{j=-\\infty}^{S_{l-1}-i-1}cnt[j]$\uff0c\u5176\u4e2d$cnt[j]$\u8868\u793a\u5728\u533a\u95f4$[0,l-1]$\u4e4b\u95f4\u524d\u7f00\u548c\u4e3a$j$\u7684\u7aef\u70b9\u6570\u76ee\uff1b\u5728\u7edf\u8ba1\u8fd9\u6bb5\u533a\u95f4\u7684\u7b54\u6848\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5bf9\u533a\u95f4$[S_{i-1}-(r-l+1),S_{i-1}-1]$\u4e2d\u7684\u6240\u6709$cnt$\u5747\u8fdb\u884c$+1$\u64cd\u4f5c\u3002\u663e\u7136\u5730\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u7ef4\u62a4$B_i$\u548c$C_i=i\\times B_i$\u7684\u7ebf\u6bb5\u6811\u5c31\u53ef\u4ee5\u652f\u6301\u8fd9\u4e9b\u67e5\u8be2\u3001\u4fee\u6539\u64cd\u4f5c\u3002\u4e8e\u662f\u6211\u4eec\u4f7f\u7528\u8fd9\u68f5\u7ebf\u6bb5\u6811\u7ef4\u62a4\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u4ece\u5de6\u5230\u53f3\u679a\u4e3e\u53f3\u7aef\u70b9\uff0c\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u6781\u957f$-1$\u5b50\u533a\u95f4\u7684\u6570\u76ee\u4e0e\u5e8f\u5217\u4e2d$k$\u7684\u6570\u76ee\u540c\u9636\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u7edf\u8ba1\u4f17\u6570\u4e3a$k$\u7684\u201c\u65b0\u751f\u821e\u4f1a\u7684\u201d\u533a\u95f4\u7684\u65f6\u95f4\u5f00\u9500\uff0c\u4e0d\u96be\u53d1\u73b0\u6211\u4eec\u901a\u8fc7\u4e0a\u8ff0\u4f18\u5316\u5c06\u65f6\u95f4\u5f00\u9500\u7f29\u77ed\u5230\u4e86$O\\left( number_k\\log{n}\\right)$\n\n\u4e8e\u662f\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5373\u4e3a$O\\left(\\sum_{k} number_k\\log{n}\\right)$\uff0c\u5373$O\\left(n\\log{n}\\right)$\u3002",
        "postTime": 1594087942,
        "uid": 122557,
        "name": "pyyyyyy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "\u5047\u5982\u6211\u4eec\u5148\u4e0d\u53bb\u60f3\u8fd9\u9053\u9898\u6b63\u89e3\uff0c\u800c\u53bb\u60f3\u66b4\u529b\u548c\u7279\u6b8a\u6027\u8d28\u5206\uff0c\u5728\u6253\u6ee1\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u62ff\u5230 $70$ \u5206\u7684\u597d\u6210\u7ee9\u3002\n\n\u7136\u800c $type=1$ \u6216 $3$ \u7684\u6570\u636e\u5374\u662f\u901a\u5411\u6b63\u89e3\u7684\u5173\u952e\u3002\n\n\u663e\u7136\u5bf9\u4e8e\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e\u6bcf\u4e2a\u503c\uff0c\u628a\u662f\u8fd9\u4e2a\u503c\u7684\u4f4d\u7f6e\u6807\u4e3a $+1$\uff0c\u5426\u5219\u6807\u4e3a $-1$\uff0c\u7136\u540e\u6211\u4eec\u5c31\u8f6c\u5316\u6210\u4e86\u7ed9\u4f60\u4e00\u4e2a\u6570\u5217\uff0c\u6c42\u5b50\u6bb5\u548c\u5927\u4e8e $0$ \u7684\u4e2a\u6570\uff0c\u663e\u7136\u53ef\u4ee5\u7528 map \u76f4\u63a5\u505a\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5b50\u6bb5\u7684\u4f17\u6570\u5360\u4e86\u6574\u4e2a\u5b50\u6bb5\u7684\u4e00\u5927\u534a\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5b50\u6bb5\u6700\u591a\u53ea\u4f1a\u88ab\u8ba1\u7b97\u4e00\u6b21\uff0c\u6545\u8be5\u505a\u6cd5\u6b63\u786e\u6027\u80fd\u4fdd\u8bc1\u3002\n\n\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(nA_i\\log n)$ \u7684\uff0c\u74f6\u9888\u5728\u4e8e\u679a\u4e3e\u4e86\u6bcf\u4e2a\u503c\u6765\u6784\u9020\u65b0\u7684 $\\pm1$ \u6570\u5217\u3002\n\n\u4f46\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u6570\u5217\u7684\u6bcf\u4e2a\u5143\u7d20\u53ea\u4f1a\u51fa\u73b0\u4e00\u6b21 $+1$\uff0c\u5176\u4f59\u7684\u5168\u662f $-1$\uff0c\u6211\u4eec\u4f9d\u65e7\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e2a\u503c\uff0c\u628a\u8be5\u53d8\u6210 $+1$ \u7684\u53d8\u6210 $+1$\uff0c\u8fd9\u6837\u6700\u591a\u4fee\u6539 $O(n)$ \u6b21\uff0c\u7136\u540e\u5c31\u9700\u8981\u5feb\u901f\u7b97\u51fa\u5b50\u6bb5\u548c\u5927\u4e8e $0$ \u7684\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u95ee\u9898\u662f\uff0c\u5982\u4f55\u5feb\u901f\u7b97\u51fa\u5b50\u6bb5\u548c\u5927\u4e8e $0$ \u7684\u4e2a\u6570\u5462\uff1f\n\n\u5047\u8bbe\u73b0\u5728\u7684 $\\pm1$ \u6570\u5217\u662f\u8fd9\u6837\u7684\uff1a\n\n$-1,-1,+1,-1,-1,-1,+1,-1,-1,-1,+1,+1,-1,-1\u2026\u2026$\n\n\u8bbe $sum_i$ \u4e3a\u5230\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u7684\u524d\u7f00\u548c\uff0c$cnt_i$ \u4e3a\u524d\u7f00\u548c\u4e3a $i$ \u7684\u4e2a\u6570\uff0c\u4e00\u5f00\u59cb $cnt_0=1$\uff0c\u5176\u4f59\u7684\u90fd\u4e3a $0$\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6bcf\u4e2a $+1$\uff0c\u8fd9\u6837\u7684\u8bdd\u4e2d\u95f4\u4f1a\u9694\u51fa\u4e00\u6bb5 $-1$\uff0c\u90a3\u4e48\u8bbe\u4e0a\u4e00\u4e2a$+1$ \u7684\u524d\u7f00\u548c\u662f $x$\uff0c\u8fd9\u4e2a $+1$ \u7684\u524d\u7f00\u548c\u662f $y$\uff0c\u90a3\u4e48\u663e\u7136\u4f1a\u5c06 $cnt_{y-1,y,\u2026\u2026,x-1,x}$ \u52a0\u4e00\u518d\u5c06 $cnt_y$ \u52a0\u4e00\uff08\u4e3a\u4e86\u65b9\u4fbf\u8ba1\u7b97\uff0c\u5728\u8fd9\u91cc\u5148\u4e0d\u5c06 $cnt_y$ \u52a0\u4e00\uff0c\u53ea\u52a0\u524d\u9762\u7684\u90a3\u90e8\u5206\uff0c\u7b49\u8ba1\u7b97\u5b8c\u4e86\u4e4b\u540e\u518d\u5c06 $cnt_y$ \u52a0\u4e00\uff09\u3002\u90a3\u4e48\u4e3a\u4e86\u5feb\u901f\u8ba1\u7b97\u5b50\u6bb5\u548c\u5927\u4e8e $0$ \u7684\u4e2a\u6570\uff0c\u6211\u4eec\u8003\u8651\u76f4\u63a5\u7b97\u51fa\u4ee5\u8fd9\u4e2a $+1$ \u4e3a\u7ed3\u5c3e\u7684\u4e2a\u6570\u548c\u4ee5\u4e4b\u540e\u90a3\u4e00\u6bb5 $-1$ \u4e3a\u7ed3\u5c3e\u7684\u4e2a\u6570\u4e4b\u548c\uff0c\u8fd9\u6837\u603b\u8ba1\u7b97\u6b21\u6570\u5c31\u662f $O(n)$ \u7684\u3002\n\n\u8bbe\u540e\u9762\u7684 $-1$ \u6bb5\u957f\u5ea6\u4e3a $len$\uff0c\u90a3\u4e48\u5f88\u663e\u7136\u7b54\u6848\u662f $\\sum\\limits_{j=0}^{len}\\sum\\limits_{i=-n}^{y-j}cnt_i=(len+1)\\sum\\limits_{i=-n}^{y-len-1}cnt_i+\\sum\\limits_{i=y-len}^y(y-i)cnt_i$\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u663e\u7136\u5c31\u9700\u8981\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u6743\u503c\u548c\uff0c\u533a\u95f4\u6743\u503c $\\times$ \u4e0b\u6807\u548c\uff0c\u5168\u5c40\u6e05\u7a7a\u64cd\u4f5c\uff08\u56e0\u4e3a\u6700\u591a\u8981\u7528 $n$ \u6b21\u7ebf\u6bb5\u6811\uff0c\u6240\u4ee5\u4e0d\u80fd $O(n)$ \u6e05\u7a7a\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log n)$\u3002\n\n# AC code\uff1a\n```cpp\n#define sz(x) (int)x.size()\nll sumval[2000005],sumcnt[2000005];\nint ls[2000005],rs[2000005],tot,a[500005],lazy[2000005];\nbool clear[2000005];\nvoid build(int &x,int l,int r){\n\tx=++tot;if(l==r) return ;\n\tint mid=l+r>>1;build(ls[x],l,mid),build(rs[x],mid+1,r);\n}\ninline ll calc(int l,int r){return 1ll*(l+r)*(r-l+1)>>1;}\ninline void pushdown(int x,int l,int r){\n\tif(clear[x]) clear[ls[x]]=clear[rs[x]]=1,sumval[ls[x]]=sumcnt[ls[x]]=sumcnt[rs[x]]=sumval[rs[x]]=lazy[ls[x]]=lazy[rs[x]]=clear[x]=0;\n\tint mid=l+r>>1;\n\tsumcnt[ls[x]]+=lazy[x]*(mid-l+1),sumval[ls[x]]-=lazy[x]*calc(l,mid);\n\tsumcnt[rs[x]]+=lazy[x]*(r-mid),sumval[rs[x]]-=lazy[x]*calc(mid+1,r);\n\tlazy[ls[x]]+=lazy[x],lazy[rs[x]]+=lazy[x],lazy[x]=0;\n}\ninline void pushup(int x){sumcnt[x]=sumcnt[ls[x]]+sumcnt[rs[x]],sumval[x]=sumval[ls[x]]+sumval[rs[x]];}\nvoid modify(int x,int l,int r,int l1,int r1){\n\tif(l>r) return ;\n\tif(l<=l1&&r1<=r){sumcnt[x]+=(r1-l1+1),sumval[x]-=calc(l1,r1),lazy[x]++;return ;}\n\tpushdown(x,l1,r1);int mid=l1+r1>>1;\n\tif(l<=mid) modify(ls[x],l,r,l1,mid);if(mid<r) modify(rs[x],l,r,mid+1,r1);\n\tpushup(x);\n}\nll queryval(int x,int l,int r,int l1,int r1){\n\tif(l>r) return 0;\n\tif(l<=l1&&r1<=r) return sumval[x];\n\tpushdown(x,l1,r1);int mid=l1+r1>>1;ll res=0;\n\tif(l<=mid) res=queryval(ls[x],l,r,l1,mid);if(mid<r) res+=queryval(rs[x],l,r,mid+1,r1);\n\treturn res;\n}\nll querycnt(int x,int l,int r,int l1,int r1){\n\tif(l>r) return 0;\n\tif(l<=l1&&r1<=r) return sumcnt[x];\n\tpushdown(x,l1,r1);int mid=l1+r1>>1;ll res=0;\n\tif(l<=mid) res=querycnt(ls[x],l,r,l1,mid);if(mid<r) res+=querycnt(rs[x],l,r,mid+1,r1);\n\treturn res;\n}\nvector<int> v[500005];\nint main(){\n\tint n=read(n),type=read(type),i,j,rt;ll ans=0;\n\tfor(i=0;i<n;i++) v[i].eb(0);\n\tfor(i=1;i<=n;i++) read(a[i]),v[a[i]].eb(i);\n\tfor(i=0;i<n;i++) v[i].eb(n+1);\n\tbuild(rt,0,n<<1);\n\tfor(i=0;i<n;i++){\n\t\tint sum=n;modify(1,n,n,0,n<<1);\n\t\tfor(j=1;j<sz(v[i])-1;j++){\n\t\t\tint diff1=v[i][j]-v[i][j-1],diff2=v[i][j+1]-v[i][j];\n\t\t\tmodify(1,sum-diff1+1,sum-1,0,n<<1);\n\t\t\tsum-=diff1-2;\n\t\t\tans+=queryval(1,sum-diff2,sum-1,0,n<<1)+querycnt(1,sum-diff2,sum-1,0,n<<1)*sum+querycnt(1,0,sum-diff2-1,0,n<<1)*diff2;\n\t\t\tmodify(1,sum,sum,0,n<<1);\n\t\t}\n\t\tsumcnt[1]=sumval[1]=lazy[1]=0,clear[1]=1;\n\t}print(ans);\n\treturn 0;\n}\n```",
        "postTime": 1639195265,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4062"
    },
    {
        "content": "\u4e3a\u4ec0\u4e48\u6700\u52a3\u89e3\u9009\u624b\u8fd8\u6709\u8138\u6765\u5199\u9898\u89e3\u554a\u2026\u2026\n\n\u8fd9\u9898\u9996\u5148\u8003\u8651\u6bcf\u4e2a\u6570 $x(1\\leq x\\leq n)$\u200b\u200b\u200b\u200b \u5206\u5f00\u7b97\u8d21\u732e\u3002\u8bbe $B_1,B_2,\\cdots,B_{m_x}(A_{B_i}=x)$\u200b\u200b\u200b\u200b\u3002\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u5206\u5f00\u8ba1\u7b97\u662f\uff0c$A_1,A_2,\\cdots,A_n$\u200b\u200b\u200b\u200b \u53ea\u6709\u4e24\u79cd\u6570\uff0c\u4e00\u79cd\u662f\u7b49\u4e8e $x$\u200b\u200b\u200b\uff0c\u53e6\u4e00\u79cd\u662f\u4e0d\u7b49\u4e8e $x$\u200b\u200b\u200b\u200b\u3002\u8003\u8651\u4e00\u4e2a\u7b54\u6848\u533a\u95f4 $l' \\sim r'$\u200b\u200b\u200b\uff0c\u4e00\u5b9a\u662f\u7531\u4e00\u4e2a\u6211\u4eec\u79f0\u4e3a\u201c\u6839\u533a\u95f4\u201d $l\\sim r(l'\\leq l,r\\leq r')$\u200b \u7684\u4e1c\u897f\u6269\u5c55\u51fa\u6765\u7684\u3002\u6240\u8c13\u7684\u201c\u6839\u533a\u95f4\u201d\u5c31\u662f\u6307 $A_l=A_r=x$\u200b\uff0c\u5373\u533a\u95f4\u5de6\u53f3\u4e24\u4e2a\u7aef\u70b9\u90fd\u662f\u8fd9\u4e2a\u6570\uff0c~~\u4e8e\u662f\u5c31\u6709\u4e86\u4e00\u4e2a $O(n^2)$\u200b \u7684\u66b4\u529b\u505a\u6cd5\u3002~~\u6211\u4eec\u53d1\u73b0\u201c\u6839\u533a\u95f4\u201d\u80fd\u591f\u884d\u751f\u3001\u62d3\u5c55\u51fa\u6765\u7684\u533a\u95f4\u6570\uff0c\u4e0e\u201c\u6839\u533a\u95f4\u201d\u5185\u7b49\u4e8e $x$\u200b \u7684\u6570\u7684\u4e2a\u6570 $-$\u200b \u4e0d\u7b49\u4e8e $x$\u200b \u7684\u6570\u7684\u4e2a\u6570\u4ee5\u53ca $l$\u200b \u5de6\u8fb9\u8fde\u7eed\u4e0d\u4e3a $x$\u200b \u7684\u4e2a\u6570\u548c $r$\u200b \u53f3\u8fb9\u8fde\u7eed\u4e0d\u4e3a $r$\u200b \u7684\u4e2a\u6570\u6709\u5173\uff08\u4e0d\u7136\u6839\u533a\u95f4\u5c31\u4e0d\u662f $l\\sim r$\u200b\u200b\u200b\u200b \u4e86\uff09\u3002\n\n\u65e2\u7136\u65e0\u6cd5\u76f4\u63a5\u679a\u4e3e\u6839\u533a\u95f4\uff0c\u6211\u4eec\u5c31\u8981\u53e6\u5916\u60f3\u529e\u6cd5\u3002\u5176\u5b9e\u63d0\u5230\u8ba1\u7b97\u533a\u95f4\u8d21\u732e\u8fd9\u4e2a\u4e1c\u897f\uff0c\u663e\u7136\u4f1a\u60f3\u5230\u5206\u6cbb\u3002\u4e8e\u662f\u5c31\u662f\u6109\u5feb\u7684\u8ba8\u8bba\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4 $l\\sim r$\uff0c\u4e2d\u70b9\u4e3a $mid$\uff0c\u201c\u6839\u533a\u95f4\u201d $l'\\sim r'(l\\leq l'\\leq r'\\leq r)$\u4e00\u5171\u5206\u4e3a $3$ \u79cd\uff1a\n\n1. $l'\\leq r'\\leq mid$\n2. $l'\\leq mid < r'$\n3. $mid< l' \\leq r'$\n\n\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u548c\u7b2c\u4e09\u79cd\u5206\u522b\u5c5e\u4e8e $l\\sim mid$\u200b\u200b \u548c $mid+1\\sim r$\u200b\u200b \u533a\u95f4\u5185\u7684\uff0c\u5982\u5b9e\u6211\u4eec\u5c31\u53ea\u8981\u60f3\u529e\u6cd5\u8ba1\u7b97\u8de8\u8d8a $mid$\u200b\u200b \u7684\u6839\u533a\u95f4\u5373\u7b2c\u4e8c\u79cd $l'\\leq mid\\leq r'\\leq r$\u200b\u200b \u7684\u8d21\u732e\u4e86\u3002\u6211\u4eec\u8003\u8651\u7528\u4e00\u68f5\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5bf9\u4e8e\u6bcf\u4e2a $y$\u200b\u200b \u6709\u591a\u4e2a\u4e2a $l'$\u200b\u200b \u6ee1\u8db3 $l'\\sim mid$\u200b\u200b \u4e2d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $=$\u200b\u200b $y$\u200b\u200b\u3002\u8003\u8651 $B_{i}+1\\sim B_i$\u200b\u200b \u8fd9\u4e00\u6bb5\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u5f62\u6210\u4e86\u4e00\u4e2a\u516c\u5dee\u4e3a $1$\u200b\u200b \u7684\u7b49\u5dee\u6570\u5217\u3002\u6211\u4eec\u5148\u770b\u4e00\u4e0b\u6211\u4eec\u4f1a\u6709\u4ec0\u4e48\u5f62\u5f0f\u7684\u8be2\u95ee\uff1a\u5bf9\u4e8e $B_{i}\\sim B_{i+1}-1$\u200b\u200b \u8fd9\u4e00\u6bb5\u4e2d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u5f62\u6210\u4e86\u4e00\u4e2a\u516c\u5dee\u4e3a $-1$\u200b\u200b \u7684\u7b49\u5dee\u6570\u5217\uff0c\u5bf9\u4e8e\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $=$\u200b\u200b $y$\u200b\u200b \u7684\u6570\uff0c\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\u4e3a\u5de6\u8fb9\u6bb5\u4e2d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u53ef\u4ee5\u4e3a $-y+1\\sim n$\u200b\u200b\uff0c\u4e8e\u662f\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\u5de6\u533a\u95f4\u4e2d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u4e3a $-y+1\\sim n$\u200b\u200b \u7684\u65b9\u6848\u6570\u548c\u3002\u6bd4\u5982\u8bf4 $n=6,A=\\{1,0,0,0,0,1\\}$\u200b\u200b \u5bf9\u4e8e $x=1$\u200b\u200b ,$B={1,6}$\u200b\u200b\uff0c$l=1,r=2,mid=1$\u200b\u200b\uff0c$2\\sim 3$\u200b\u200b \u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u5f62\u6210\u4e86\u4e00\u4e2a\u516c\u5dee\u4e3a $1$\u200b\u200b \u7684\u7b49\u5dee\u6570\u5217 $-2,-1$\u200b\u200b\uff0c\u5f53\u7136\u8fd8\u6709 $1$\u200b\u200b \u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $= -1$\u200b\u200b\u3002\u53f3\u533a\u95f4 $4\\sim 5$\u200b\u200b \u4e2d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u5f62\u6210\u4e86\u4e00\u4e2a\u516c\u5dee\u4e3a $-1$\u200b\u200b \u7684\u7b49\u5dee\u6570\u5217 $-1,-2$\u200b\u200b\uff0c\u9700\u8981\u67e5\u8be2\u7684\u662f\u5de6\u8fb9\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570 $-$\u200b\u200b \u4e0d\u7b49\u4e8e $x$\u200b\u200b \u7684\u4e2a\u6570\u4e3a $-(-1)+1=2 \\sim n$\u200b\u200b \u548c $-(-2)+1=3 \\sim n$\u200b\u200b\uff0c\u5f53\u7136\u8fd8\u6709\u6700\u540e\u7684\u4e00\u9879 $-1$\u200b\u200b\u200b\u200b \u8981\u67e5\u8be2\u3002\u6211\u4eec\u611f\u5174\u8da3\u7684\u662f $4\\sim5$\u200b \u8fd9\u4e00\u6bb5\uff1a\u89c2\u5bdf\u9879\u7684\u7cfb\u6570\u503c\u4e3a $2$  \u7684\u6570\u4e3a $1$\uff0c\u503c\u4e3a $3\\sim n$ \u7684\u6570\u4e3a $2$\u3002\u53d1\u73b0\u4e00\u5b9a\u662f\u4e00\u4e2a\u7b49\u5dee\u6570\u5217 $+$\u200b\u200b \u4e00\u4e2a\u6240\u6709\u6570\u76f8\u540c\u7684\u6570\u5217\uff0c\u5206\u522b\u7ef4\u62a4\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u200b/kk\u3002\n\n\u5b9e\u73b0\uff1a\n\n \u7b49\u4e8e $x$ \u7684\u4e2a\u6570 $-$ \u4e0d\u7b49\u4e8e $x$ \u7684\u4e2a\u6570\u7684\u8303\u56f4\u662f $-n \\sim n$ \u7684\uff0c\u4f46\u662f\u771f\u6b63\u6709\u7528\u7684\u533a\u95f4\u6ca1\u6709\u90a3\u4e48\u591a\uff0c\u6240\u4ee5\u8003\u8651\u52a8\u6001\u5f00\u70b9\u3002\n\n\u6bcf\u4e00\u6b21\u90fd\u8981\u6ce8\u610f\u5c06\u6811\u6e05\u7a7a\u6216\u5c06\u6e05\u9664\u4e4b\u524d\u7684\u6240\u6709\u4fee\u6539\u64cd\u4f5c\u3002\n\n\u6ce8\uff1a\u7ec6\u8282\u5f88\u591a\uff0c\u6bd4\u8f83\u96be\u5199\u96be\u8c03/kk\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n// #define ls (num<<1)\n// #define rs (num<<1|1)\n#define log(a) cerr<<\"\\033[32m[DEBUG] \"<<#a<<'='<<(a)<<\" @ line \"<<__LINE__<<\"\\033[0m\"<<endl\n#define LL long long\n#define SZ(x) ((int)x.size()-1)\n#define ms(a,b) memset(a,b,sizeof a)\n#define F(i,a,b) for(int i=(a);i<=(b);++i)\n#define DF(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\ninline int read(){char ch=getchar(); int w=1,c=0;\n\tfor(;!isdigit(ch);ch=getchar()) if (ch=='-') w=-1;\n\tfor(;isdigit(ch);ch=getchar()) c=(c<<1)+(c<<3)+(ch^48);\n\treturn w*c;\n}\nconst int N=5e5+10;\nvector<int>v[N];\nint cnt,n,ls[N<<2],rs[N<<2],rt;\nbool cl[N<<2];\nLL ans,tag[N<<2],sum[N<<2],sum2[N<<2],len[N<<2],len2[N<<2];\ninline void down(int&num,int x,int l,int r){\n\tif(!num){\n\t\tnum=++cnt;\n\t\tlen2[num]=r-l+1;\n\t\tlen[num]=len2[num]*(l+r)/2;\n\t}\n\ttag[num]+=x;\n\tsum[num]+=len[num]*x;\n\tsum2[num]+=len2[num]*x;\n}\ninline void down2(int&num,int l,int r){\n\tif(!num){\n\t\tnum=++cnt;\n\t\tlen2[num]=r-l+1;\n\t\tlen[num]=len2[num]*(l+r)/2;\n\t}\n\tcl[num]=true;\n\tsum[num]=sum2[num]=tag[num]=0;\n}\ninline void pushdown(int num,int l,int r){\n\tif(cl[num]){\n\t\tint mid=(l+r)>>1;\n\t\tdown2(ls[num],l,mid);\n\t\tdown2(rs[num],mid+1,r);\n\t\tcl[num]=false;\n\t}\n\tif(tag[num]){\n\t\tint mid=(l+r)>>1;\n\t\tdown(ls[num],tag[num],l,mid);\n\t\tdown(rs[num],tag[num],mid+1,r);\n\t\ttag[num]=0;\n\t}\n}\ninline void pushup(int num){\n\tsum[num]=sum[ls[num]]+sum[rs[num]];\n\tsum2[num]=sum2[ls[num]]+sum2[rs[num]];\n}\ninline void change(int&num,int l,int r,int L,int R,int x){\n\tif(!num){\n\t\tnum=++cnt;\n\t\tlen2[num]=r-l+1;\n\t\tlen[num]=len2[num]*(l+r)/2;\n\t}\n\tif(L<=l&&r<=R){\n\t\tdown(num,x,l,r);\n\t\treturn;\n\t}\n\tpushdown(num,l,r);\n\tint mid=(l+r)>>1;\n\tif(mid>=L)change(ls[num],l,mid,L,R,x);\n\tif(mid<R)change(rs[num],mid+1,r,L,R,x);\n\tpushup(num);\n}\ninline int query(int&num,int l,int r,int L,int R){\n\tif(!num){\n\t\tnum=++cnt;\n\t\tlen2[num]=r-l+1;\n\t\tlen[num]=len2[num]*(l+r)/2;\n\t\treturn 0;\n\t}\n\tif(L<=l&&r<=R)return sum[num];\n\tpushdown(num,l,r);\n\tint mid=(l+r)>>1;\n\tif(mid<L)return query(rs[num],mid+1,r,L,R);\n\tif(mid>=R)return query(ls[num],l,mid,L,R);\n\treturn query(ls[num],l,mid,L,R)+query(rs[num],mid+1,r,L,R);\n}\ninline int query2(int&num,int l,int r,int L,int R){\n\tif(!num){\n\t\tnum=++cnt;\n\t\tlen2[num]=r-l+1;\n\t\tlen[num]=len2[num]*(l+r)/2;\n\t\treturn 0;\n\t}\n\tif(L<=l&&r<=R)return sum2[num];\n\tpushdown(num,l,r);\n\tint mid=(l+r)>>1;\n\tif(mid<L)return query2(rs[num],mid+1,r,L,R);\n\tif(mid>=R)return query2(ls[num],l,mid,L,R);\n\treturn query2(ls[num],l,mid,L,R)+query2(rs[num],mid+1,r,L,R);\n}\ninline void solve(int num,int l,int r){\n\tif(l==r){\n\t\tans++;\n\t\treturn;\n\t}int mid=(l+r)>>1;\n\tsolve(num,l,mid);solve(num,mid+1,r);\n\tint s=0;\n\tdown2(rt,-n,n);\n\tDF(i,mid,l){\n\t\tint r=s-(i==mid?1:0);\n\t\ts-=v[num][i+1]-v[num][i]-1;\n\t\tint l=s;\n\t\ts++;\n\t\tif(l<=r)change(rt,-n,n,l,r,1);\n\t}\n\tif(!l)change(rt,-n,n,s-(v[num][l]-(l?v[num][l-1]:0)-1),s,1);\n\telse change(rt,-n,n,s,s,1);\n\ts=0;\n\tF(i,mid+1,r){\n\t\ts++;\n\t\tint l=s;\n\t\ts-=(i==SZ(v[num])?n+1:v[num][i+1])-v[num][i]-1;\n\t\tint r=s;\n\t\tl=(-l)+1;\n\t\tr=(-r)+1;\n\t\tans+=query(rt,-n,n,l,r);\n\t\tif(l!=1)ans-=(l-1)*query2(rt,-n,n,l,r);\n\t\tif(r!=n)ans+=(r-l+1)*query2(rt,-n,n,r+1,n);\n\t}\n}\nsigned main(){\n\tn=read();int type;type=read();\n\tF(i,1,n){\n\t\tint x=read();\n\t\tv[x].push_back(i);\n\t}\n\tF(i,0,n-1)\n\t\tif(v[i].size())solve(i,0,SZ(v[i]));\n\tcout<<ans;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1627786721,
        "uid": 180242,
        "name": "orzdevinwang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    },
    {
        "content": "\u6765\u53e3\u80e1\u4e00\u4e2a\u7b80\u5355\u6613\u61c2\u7684\u7ebf\u6027\u505a\u6cd5\u3002\n\n\u9996\u5148\u679a\u4e3e\u7edd\u5bf9\u4f17\u6570 $x$\uff0c\u7136\u540e\u628a $a_i=x$ \u7684\u770b\u4f5c $+1$\uff0c\u5176\u5b83\u7684\u770b\u6210 $-1$\u3002\n\n\u7136\u540e\u770b\u8fd9\u4e2a\u5e8f\u5217\u7684\u524d\u7f00\u548c $s$\uff0c\u5bf9\u4e8e $i<j$\uff0c\u5982\u679c\u6709 $s_i<s_j$\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bf9\u7b54\u6848\u9020\u6210 $+1$ \u7684\u8d21\u732e\u3002\n\n\u76f4\u63a5\u505a\u663e\u7136\u4e0d\u884c\uff0c\u8003\u8651\u5982\u4f55\u4f18\u5316\u3002\n\n\u4e0d\u96be\u89c2\u5bdf\u53d1\u73b0\uff1a\n\n> \u5982\u679c $s_i$ \u540c\u65f6\u662f\u524d\u7f00\u6700\u5c0f\u503c\u548c\u540e\u7f00\u6700\u5927\u503c\uff0c\u90a3\u4e48 $s_i$ \u4e0d\u4f1a\u5bf9\u7b54\u6848\u9020\u6210\u4efb\u4f55\u8d21\u732e\u3002\n\n\u8bc1\u660e\u663e\u7136\u3002\n\n\u518d\u8003\u8651\u5047\u8bbe $=x$ \u7684\u6570\u6709 $k$ \u4e2a\uff0c\u90a3\u4e48\u5e8f\u5217\u5143\u7d20\u548c\u4e3a $2k-n$\uff0c\u90a3\u4e48\u672c\u8d28\u4e0d\u540c\u7684\u524d\u7f00\u6700\u5c0f\u503c\u548c\u540e\u7f00\u6700\u5927\u503c\u7684\u6570\u91cf\u5747\u4e3a $\\max(n-2k,0)$\u3002\n\n\u6240\u4ee5\u6709\u7528\u7684\u6570\u91cf\u53ea\u6709 $O(k)$ \u4e2a\uff0c\u4e8e\u662f\u603b\u5171\u6709\u7528\u7684\u6570\u91cf\u5c31\u53ea\u6709 $O(n)$ \u4e2a\u3002\n\n\u663e\u7136\u5bf9\u4e8e\u56fa\u5b9a\u7684 $x$\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6709\u7528\u7684\u6570\u6784\u6210\u7684\u6781\u957f\u8fde\u7eed\u6bb5\u62c9\u51fa\u6765\u5206\u522b\u4f5c\u5c31\u884c\u4e86\u3002\n\n\u73b0\u5728\u8003\u8651\u5bf9\u4e8e\u4e00\u6bb5 $+1,-1$ \u7684\u6bb5\u8ba1\u7b97\u4e4b\u524d\u7684\u8d21\u732e\u3002\u4e4d\u4e00\u770b\uff0c\u9700\u8981\u5355\u70b9\u4fee\u6539\uff0c\u67e5\u8be2\u524d\u7f00\u548c\uff0c\u597d\u50cf\u81f3\u5c11\u8981\u4e00\u4e2a $\\log$\u3002\n\n\u4f46\u89c2\u5bdf\u53d1\u73b0\u4e24\u6b21\u67e5\u524d\u7f00\u7684\u4f4d\u7f6e\u5206\u522b\u4e3a $x,y$\uff0c\u6709 $|x-y|\\le 1$\uff0c\u4e8e\u662f\u76f4\u63a5\u5f00\u6876\u8bb0\u5f55\u5373\u53ef\u3002\n\n\u4e8e\u662f\u5c31 $O(n)$ \u4e86\u3002",
        "postTime": 1679838932,
        "uid": 99506,
        "name": "_LHF_",
        "ccfLevel": 0,
        "title": "Yazid \u7684\u65b0\u751f\u821e\u4f1a \u7ebf\u6027\u505a\u6cd5"
    },
    {
        "content": "- \u6b64\u9898\u4e3a\u5f00\u6446\u8ba1\u5212 T1\u3002\n- \u67d0\u4e9b\u7ed9\u6211\u70b9\u8e29\u7684~~\u597d\u81ea\u4e3a\u4e4b~~\u3002\n\n**[\u9898\u610f](https://www.luogu.com.cn/problem/P4062)**\n- \u7ed9\u51fa\u4e00\u4e2a\u6570\u5217\uff0c\u627e\u51fa\u6240\u6709\u5b58\u5728\u5e03\u5c14\u4ec0\u7ef4\u514b\u6570\uff08\u5927\u4e8e $n/2$\uff09\u7684\u533a\u95f4\u3002\n\n**\u505a\u6cd5 1**\n- $O(n^2)$ \u505a\u6cd5\u8fc7\u4e8e\u900a\uff0c\u4e0d\u8bb2\u3002\n- \u4e0b\u9762\u7684\u5176\u5b83\u505a\u6cd5\u90fd\u4ee5\u679a\u4e3e\u989c\u8272\u800c\u975e\u679a\u4e3e\u533a\u95f4\uff0c\u8fd9\u544a\u8bc9\u6211\u4eec\u591a\u89d2\u5ea6\u601d\u8003\u7684\u91cd\u8981\u6027\u3002\n\n**\u505a\u6cd5 2**\n- \u9996\u5148\uff0c\u5e03\u5c14\u4ec0\u7ef4\u514b\u6570\u5b83\u662f\u4e00\u4e2a\u6570\uff01\u6240\u4ee5\u6211\u4eec\u5c1d\u8bd5\u679a\u4e3e\u5b83\u3002\n- \u51fa\u73b0\u6b21\u6570\u5927\u4e8e $\\sqrt n$ \u7684\u6211\u4eec\u79f0\u4e3a\u5e03\u6570\uff0c\u5426\u5219\u79f0\u4e3a\u5b5f\u6570\u3002\n- \u5bf9\u4e8e\u5e03\u6570\uff0c$O(n)$ \u6c42\u524d\u7f00\u548c\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u5224\u5b9a\u5c31\u662f\uff1a\n$$2(S(r)-S(l))> r-l$$\n$$2S(r)-r> 2S(l)-l$$\n- \u770b\u4f3c\u662f\u4e8c\u7ef4\u504f\u5e8f\u4e0d\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\uff0c\u4f46\u662f\u4f60\u53d1\u73b0\uff0c\u6211\u4eec\u6bcf\u6b21\u67e5\u8be2\u7684\u4f4d\u7f6e\u53d8\u6362\u5e45\u5ea6\u5f88\u5c0f\uff1a\u52a0\u4e00\u6216\u51cf\u4e00\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u91cc\u52a8\u6001\u7ef4\u62a4\u524d\u7f00\u548c\u66f4\u65b0\uff0c\u8fd9\u91cc\u7684\u590d\u6742\u5ea6\u662f $O(n)$ \u7684\u3002\n- \u63a5\u4e0b\u6765\u662f\u5bf9\u4e8e\u5b5f\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5e73\u65b9\u679a\u4e3e\u4ee5\u4efb\u610f\u4e24\u4e2a\u70b9\u4e3a\u91cd\u5fc3\u5411\u5916\u62d3\u5c55\u7684\u65b9\u6848\u6570\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9700\u8981\u7528\u5230\u4e00\u5f00\u59cb\u7684\u5f0f\u5b50\u3002\n$$2(S(r)-S(l))> r-l$$\n- \u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u533a\u95f4\u7684\u6700\u5927\u957f\u5ea6\uff0c\u7136\u540e\u63a5\u4e0b\u6765\u53d8\u6210\u4e00\u4e2a\u7ecf\u5178\u7684\u95ee\u9898\uff08\u53ef\u4ee5 $O(1)$ \u8ba1\u7b97\uff09\uff1a\n$$\\sum_{i=1}^n\\sum_{j=1}^m[i+j\\le k]$$\n- \u7efc\u4e0a\uff0c\u603b\u7684\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt n)$\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/inixjoyw)\u3002\n- \u6709\u66f4\u4f18\u7684\u89e3\u6cd5\u5417\uff1f\u663e\u7136\u6709\u3002\n\n**\u505a\u6cd5 3**\n- \u771f\u7684\u5c31\u4e0d\u53ef\u4ee5\u6709\u5173\u4e8e\u989c\u8272\u6570\u7684\u66f4\u597d\u7684\u505a\u6cd5\u4e86\u5417\uff1f\n- \u8ba9\u6211\u4eec\u770b\u770b\u4e00\u5f00\u59cb\u90a3\u4e2a\u505a\u6cd5\uff0c\u5f53\u6ca1\u6709\u989c\u8272\u7684\u65f6\u5019\uff0c\u6570\u5217\u4e00\u5b9a\u662f\u4e00\u4e2a\u9012\u964d\u5e8f\u5217\uff0c\u6240\u4ee5\u54b1\u4eec\u76f8\u5f53\u4e8e\u533a\u95f4\u52a0\uff0c\u67e5\u8be2\u533a\u95f4\u524d\u7f00\u67e5\u8be2\u7684\u548c\u3002\n- \u8fd9\u73a9\u610f\u5f53\u7136\u53ef\u4ee5\u9b54\u6539\uff0c\u7531\u53ef\u5dee\u5206\u6027\u76f4\u63a5\u9b54\u6539\u6210\u5355\u70b9\u52a0\uff0c$3$ \u9636\u524d\u7f00\u548c\u67e5\u8be2\uff0c\u8fd0\u7528[\u8fd9\u91cc](https://www.luogu.com.cn/blog/luo1gu1zui1bang1/ci-fen-yu-qian-zhui-hu-di-jian-dan-ji-lu)\u7684\u7b80\u5355\u77e5\u8bc6\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $O(n\\log n)$ \u7684\u7b97\u6cd5\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/sw772uwv)\u3002",
        "postTime": 1658227626,
        "uid": 260884,
        "name": "WeLikeStudying",
        "ccfLevel": 0,
        "title": "\u3010\u5f00\u6446\u8ba1\u5212 #1\u3011\u9e2d\u5b50\u7684\u8165\u7272\u6c61\u79fd"
    },
    {
        "content": "\u8fd8\u662f\u8003\u8651\u90a3\u4e2a\u4f17\u6570\u7684\u5957\u8def\uff0c\u8003\u8651\u4e00\u4e2a\u6570 $c$ \u7684\u8d21\u732e\uff0c\u5c06 $c$ \u7f6e\u4e3a $1$\uff0c\u4e0d\u662f $c$ \u7684\u7f6e\u4e3a $-1$\uff0c\u90a3\u4e48\u4e00\u4e2a\u533a\u95f4\u548c $>0$ \u7684\u7edd\u5bf9\u4f17\u6570\u662f $c$\uff0e\n\n\u4ece\u5de6\u5f80\u53f3\u548c\u4ece\u53f3\u5f80\u5de6\u5404\u8dd1\u4e00\u8fb9\uff0c\u6bcf\u6b21\u8ba9\u4e00\u4e2a $+1$ \u5339\u914d\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u6ca1\u5339\u914d\u7684 $-1$ \uff08\u6ca1\u6709\u7684\u8bdd\u5c31\u5339\u914d\u5230\u865a\u7a7a\uff09\uff0c\u5982\u679c\u4e00\u4e2a\u4f4d\u7f6e\u4ece\u524d\u5f80\u540e\u6216\u8005\u4ece\u540e\u5f80\u524d\u90fd\u6ca1\u5339\u914d\u5230\uff0c\u610f\u5473\u7740\u5b83\u4e0d\u53ef\u80fd\u548c\u5176\u4ed6\u4f4d\u7f6e\u7ec4\u6210\u9006\u5e8f\u5bf9\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u5c31\u4f1a\u5bc4\u6389\uff0c\u7528\u5e76\u67e5\u96c6\u5373\u53ef\u5b8c\u6210\u5339\u914d\u3002\n\n\u8dd1\u51fa\u4e86\u8fd9\u4e9b\u7edd\u5bf9\u4f17\u6570\u53ef\u80fd\u4e3a $c$ \u7684\u8fde\u7eed\u6bb5\uff0c\u8fd9\u4e9b\u8fde\u7eed\u6bb5\u7684\u603b\u957f\u5ea6\u81f3\u591a\u662f $c$ \u51fa\u73b0\u6b21\u6570\u7684\u4e24\u500d\uff0c\u6240\u4ee5\u6240\u6709 $c$ \u7684\u82e5\u5e72\u8fde\u7eed\u6bb5\u7684\u603b\u957f\u662f $\\mathcal{O}(n)$ \u7684\u3002\n\n\u90a3\u4e48\u4f5c\u524d\u7f00\u548c\uff0c\u5728\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u5185\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\u4e00\u4e2a\u4e8c\u7ef4\u6570\u70b9\u7684\u5f62\u5f0f\u3002\n\n\u6ce8\u610f\u5230\u76f8\u90bb\u6570\u53ea\u4f1a\u6709 $\\pm 1$ \u7684\u6539\u53d8\uff0c\u90a3\u4e48\u626b\u63cf\u7ebf\u7684\u65f6\u5019\uff0c\u8003\u8651\u8ba1\u7b97\u8fd9\u4e00\u4e2a\u4f4d\u7f6e\u7edf\u8ba1\u7684\u7b54\u6848\u548c\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\u7684\u5dee\u503c\u662f\u591a\u5c11\u5373\u53ef\uff0c\u53ea\u9700\u8981\u5f00\u4e2a\u6876\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u503c\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u5982\u679c\u4f7f\u7528\u7ebf\u6027\u5e8f\u5217\u5e76\u67e5\u96c6\u7b97\u6cd5\uff0c\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n)$ \u7684\uff0c\u4e0d\u8fc7\u5199\u8fd9\u7bc7\u9898\u89e3\u7684\u65f6\u5019\u7528\u7eaf\u8def\u5f84\u538b\u7f29\u8dd1\u5230\u4e86\u6d1b\u8c37\u4e0a\u7b2c\u4e00\u3002\n\n\u627e\u51fa\u6781\u957f\u8fde\u7eed\u6bb5\u7684\u5b9e\u73b0\u4e0a\u9700\u8981\u7cbe\u7ec6\u4e00\u70b9\uff0c\u53ef\u80fd\u8981\u53cc\u6307\u9488\u4ec0\u4e48\u7684\uff08\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#define pb emplace_back\n#define mp std::make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ninline void cmax(int &x, int y){x=x>y?x:y;}\ninline void cmin(int &x, int y){x=x<y?x:y;}\n#define getchar()(p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline void read(int &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\tr=w?-r:r;\n}\nconst int N=500100;\nint n,type;\nint a[N],L[N],R[N],visbuf[N<<1],*vis=visbuf+N;\nvi vec[N];\nll ans;\nint f[N],p[N];\nint st[N],top;\nint getfa1(int x){\n\treturn f[x]==x?x:f[x]=getfa1(f[x]);\n}\nvoid merge1(int x,int y){\n\tint fx=getfa1(x),fy=getfa1(y);\n\tf[fy]=fx;\n}\nint getfa2(int x){\n\treturn p[x]==x?x:p[x]=getfa2(p[x]);\n}\nvoid merge2(int x,int y){\n\tint fx=getfa2(x),fy=getfa2(y);\n\tp[fy]=fx;\n}\nsigned main(){\n\tread(n);read(type);\n\tfor(int i=1;i<=n;i++)read(a[i]),p[i]=f[i]=i,vec[a[i]].pb(i);\n\tp[n+1]=f[n+1]=n+1;\n\tfor(int o=0;o<n;o++){\n\t\tint mn=n+1;top=0;\n\t\tfor(auto i:vec[o]){\n\t\t\tint fa=getfa1(i-1);\n\t\t\tmerge1(fa,i);\n\t\t\tif(fa)merge1(fa-1,fa);\n\t\t\tL[i]=fa;\n\t\t\twhile(top&&st[top]>fa)--top;\n\t\t\tst[++top]=fa;\n\t\t}\n\t\treverse(vec[o].begin(),vec[o].end());\n\t\tfor(auto i:vec[o]){\n\t\t\tint fa=getfa2(i+1);\n\t\t\tmerge2(fa,i);\n\t\t\tif(fa<=n)merge2(fa+1,fa);\n\t\t\tcmax(R[L[i]],fa);\n\t\t}\n\t\treverse(vec[o].begin(),vec[o].end());\n\t\tfor(int k=1;k<=top;k++){\n\t\t\tint l=st[k],r=R[l];\n\t\t\twhile(l<=r){\n\t\t\t\t++l;cmax(r,R[l]);\n\t\t\t}\n\t\t\tl=st[k];cmin(r,n);\n\t\t\tint cnt=0,s=0;\n\t\t\tfor(int i=l;i<=r;i++){\n\t\t\t\tL[i]=R[i]=0;f[i]=p[i]=i;\n\t\t\t\tif(i){\n\t\t\t\t\tif(a[i]==o)cnt+=vis[s++];\n\t\t\t\t\tif(a[i]!=o)cnt-=vis[--s];\n\t\t\t\t}\n\t\t\t\t++vis[s];\n\t\t\t\tans+=cnt;\n\t\t\t}\n\t\t\ts=0;\n\t\t\tfor(int i=l;i<=r;i++){\n\t\t\t\tif(i){\n\t\t\t\t\tif(a[i]==o)++s;\n\t\t\t\t\tif(a[i]!=o)--s;\n\t\t\t\t}\n\t\t\t\tvis[s]=0;\n\t\t\t}\n\t\t\twhile(k<=top&&st[k]<=r)\n\t\t\t\t++k;\n\t\t\t--k;\n\t\t}\n\t\t#undef now\n\t}\n\tcout << ans << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1656571230,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300d\u6d1b\u8c37 P4062 [Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a \u7ebf\u6027\u505a\u6cd5"
    },
    {
        "content": "\n\u6bcf\u4e2a\u5408\u6cd5\u533a\u95f4\u80af\u5b9a\u53ea\u6709\u4e00\u4e2a\u4f17\u6570\u3002\n\n\u6240\u4ee5\u5bf9\u6bcf\u4e2a\u989c\u8272\u53ef\u4ee5\u5355\u72ec\u8003\u8651\uff0c\u4e0d\u4f1a\u7b97\u91cd\u3002\n\n\u770b\u5230\u4f17\u6570\u8fd8\u662f\u8d85\u8fc7\u4e00\u534a\u53ef\u80fd\u4f1a\u60f3\u5230[P3524](https://www.luogu.com.cn/problem/P3524)\u548c[P2397](https://www.luogu.com.cn/problem/P2397)\u7684 trick\u3002\n\n\u4f46\u662f\u8fd9\u4e2a trick \u592a\u62bd\u8c61\u4e86\u8981\u5177\u4f53\u5316\u4e00\u4e0b\u3002\n\n\u5728\u5355\u72ec\u8003\u8651\u4e00\u4e2a\u989c\u8272\u7684\u65f6\u5019\u53ef\u4ee5\u628a\u8fd9\u4e2a\u989c\u8272\u6240\u5728\u4f4d\u7f6e\u6807\u4e3a 1\uff0c\u4e0d\u662f\u8fd9\u4e2a\u989c\u8272\u7684\u6807\u4e3a -1\u3002\n\n\u7136\u540e\u4f1a\u53d1\u73b0\u4e00\u4e2a\u533a\u95f4\u4e2d\u7684\u6807\u53f7\u7684\u548c\u662f\u6b63\u7684\u90a3\u4e48\u5b83\u5c31\u662f\u5408\u6cd5\u7684\u3002\n\n\u6240\u4ee5\u505a\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u95ee\u9898\u5c31\u6f14\u5316\u6210\u4e86\u4e00\u4e2a\u524d\u7f00\u548c\u524d\u9762\u6709\u591a\u5c11\u4e2a\u524d\u7f00\u548c\u6bd4\u5b83\u5c0f\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u6807\u4e3a\u524d\u7f00\u548c\u7684\u6743\u503c\u6811\u72b6\u6570\u7ec4\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u989c\u8272\u4ece\u524d\u5230\u540e\u626b\u4e00\u904d\uff0c\u590d\u6742\u5ea6\u662f $O(n^2\\log n)$ \u7684\u3002\n\n\u597d\u50cf\u6bd4\u66b4\u529b\u8fd8\u6162\u554a\u3002\n\n\u6162\u5c31\u6162\u5728\u6bcf\u4e2a\u989c\u8272\u90fd\u8981\u904d\u5386\u4e00\u904d\u6570\u7ec4\u3002\n\n\u4f46\u662f\u4f1a\u6bcf\u4e2a\u989c\u8272\u5728\u6bcf\u4e2a\u4f4d\u7f6e\u53ea\u51fa\u73b0\u4e00\u6b21\uff0c\u6240\u4ee5\u6bcf\u4e2a\u989c\u8272\u7684\u51fa\u73b0\u6b21\u6570\u7684\u548c\u5c31\u662f $n$\u3002\n\n\u6240\u4ee5\u8981\u4e00\u6b21\u6027\u5904\u7406\u4e00\u6bb5\u8fde\u7eed\u7684\u6781\u5927\u7684\u6807\u4e3a -1 \u7684\u533a\u95f4\u3002\n\n\u9996\u5148\u8fd9\u4e00\u6bb5\u533a\u95f4\u7684\u524d\u7f00\u548c\u662f\u8fde\u7eed\u7684\uff0c\u505a\u4e00\u4e2a\u533a\u95f4\u4fee\u6539\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n\uff08\u6ce8\u610f\u8fd9\u4e2a\u533a\u95f4\u4fee\u6539\u6307\u7684\u662f\u5728\u524d\u7f00\u548c\u7684\u503c\u57df\u610f\u4e49\u4e0a\u7684\u533a\u95f4\u52a0 1\uff09\n\n\u4f46\u662f\u8fd9\u4e00\u6bb5\u533a\u95f4\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5462\uff1f\n\n\u5982\u679c\u8bb0 $S_i$ \u4e3a\u524d\u7f00\u548c $i$ \u5728\u524d\u9762\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c$l$ \u548c $r$ \u4e3a\u5f53\u524d\u5904\u7406\u7684\u8fd9\u6bb5\u533a\u95f4\u5185\u7684\u524d\u7f00\u548c\u7684\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u3002\n\n\u90a3\u4e48\u8fd9\u6bb5\u533a\u95f4\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a\uff1a\n\n$$\\sum\\limits_{i=l}^r\\sum\\limits_{j=-n}^{i-1}S_j$$\n\n\u5206\u4e2a\u7c7b\uff1a\n\n$$=(\\sum\\limits_{i=l}^r(r-i)S_i)+(r-l+1)\\sum\\limits_{i=-n}^{l-1}S_i$$\n\n\u518d\u62c6\uff1a\n\n$$=r(\\sum\\limits_{i=l}^rS_i)-(\\sum\\limits_{i=l}^riS_i)+(r-l+1)\\sum\\limits_{i=-n}^{l-1}S_i$$\n\n\u8fd9\u5c31\u597d\u533a\u95f4\u8be2\u95ee\u4e86\uff0c\u5206\u522b\u5904\u7406 $\\sum\\limits_{i=l}^rS_i$ \u5373\u533a\u95f4\u548c\u4e0e $\\sum\\limits_{i=l}^riS_i$\u3002\n\n\u533a\u95f4\u8be2\u95ee\u548c\u533a\u95f4\u67e5\u8be2\u8fd8\u662f\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u65b9\u4fbf\u4e00\u70b9\u5427\u3002\n\n\u6ce8\u610f\u4e00\u4e0b\u524d\u7f00\u548c\u6709\u8d1f\u6570\u6240\u4ee5\u7ebf\u6bb5\u6811\u7a7a\u95f4\u8bb0\u5f97\u5f00\u5927\u4e00\u70b9\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u7684\u65f6\u5019\u53ef\u4ee5\u987a\u5e26\u548c\u533a\u95f4\u524d\u9762\u90a3\u4e2a 1 \u4e00\u8d77\u8ba1\u7b97\uff0c\u53cd\u6b63\u524d\u7f00\u548c\u8fd8\u662f\u8fde\u7eed\u7684\u3002\n\n~~\u4e0b\u9762\u662f\u559c\u63d0\u6700\u52a3\u89e3\u7684\u4ee3\u7801\u3002~~\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define reg register\n#define inl inline\n#define rep(i, d, u) for(reg int i = d; i <= u; ++i)\n#define dep(i, u, d) for(reg int i = u; i >= d; --i)\n#define cep(n) while(n--)\n#define gep(i, a) for(reg int i = firs[a]; i; i = neig[i])\nint ured() {\n\treg int re = 0, ch;\n\tdo {\n\t\tch = getchar();\n\t} while('9' < ch || ch < '0');\n\tdo {\n\t\tre = re * 10 + (ch ^ '0');\n\t}\twhile('0' <= (ch = getchar()) && ch <= '9');\n\treturn re;\n}\nvoid uwit(reg long long da) {\n\treg int cn = 0, ch[21];\n\tdo {\n\t\tch[++cn] = da - da / 10 * 10;\n\t} while(da /= 10);\n\tdo {\n\t\tputchar('0' ^ ch[cn]);\n\t} while(--cn);\n}\nconst int _maxn = 500011;\nint n, t, a[_maxn], lazy[_maxn << 3], firs[_maxn], neig[_maxn], lasp, plef, prig;\nlong long data[_maxn << 3], dats[_maxn << 3], rans;\ninl void push(reg int at, reg int le, reg int ri) {\n\tif(lazy[at]) {\n\t\tdata[at] += 1ll * lazy[at] * (ri - le + 1);\n\t\tdats[at] += 1ll * lazy[at] * (le + ri) * (ri - le + 1) / 2;\n\t\tif(le != ri) {\n\t\t\tlazy[at << 1] += lazy[at];\n\t\t\tlazy[at << 1 | 1] += lazy[at];\n\t\t}\n\t\tlazy[at] = 0;\n\t}\n}\nvoid modi(reg int at, reg int le, reg int ri, reg int ql, reg int qr, reg int da) {\n\tif(ql <= le && ri <= qr) {\n\t\tlazy[at] += da;\n\t}\telse {\n\t\tpush(at, le, ri);\n\t\tif(ql <= (le + ri) >> 1) {\n\t\t\tmodi(at << 1, le, (le + ri) >> 1, ql, qr, da);\n\t\t}\n\t\tif(qr > (le + ri) >> 1) {\n\t\t\tmodi(at << 1 | 1, ((le + ri) >> 1) + 1, ri, ql, qr, da);\n\t\t}\n\t\tpush(at << 1, le, (le + ri) >> 1);\n\t\tpush(at << 1 | 1, ((le + ri) >> 1) + 1, ri);\n\t\tdata[at] = data[at << 1] + data[at << 1 | 1];\n\t\tdats[at] = dats[at << 1] + dats[at << 1 | 1];\n\t}\n}\nlong long quer(reg int at, reg int le, reg int ri, reg int ql, reg int qr) {\n\tpush(at, le, ri);\n\tif(ql <= le && ri <= qr) {\n\t\treturn data[at];\n\t}\telse {\n\t\treg long long re = 0;\n\t\tif(ql <= (le + ri) >> 1) {\n\t\t\tre += quer(at << 1, le, (le + ri) >> 1, ql, qr);\n\t\t}\n\t\tif(qr > (le + ri) >> 1) {\n\t\t\tre += quer(at << 1 | 1, ((le + ri) >> 1) + 1, ri, ql, qr);\n\t\t}\n\t\treturn re;\n\t}\n}\nlong long ques(reg int at, reg int le, reg int ri, reg int ql, reg int qr) {\n\tpush(at, le, ri);\n\tif(ql <= le && ri <= qr) {\n\t\treturn dats[at];\n\t}\telse {\n\t\treg long long re = 0;\n\t\tif(ql <= (le + ri) >> 1) {\n\t\t\tre += ques(at << 1, le, (le + ri) >> 1, ql, qr);\n\t\t}\n\t\tif(qr > (le + ri) >> 1) {\n\t\t\tre += ques(at << 1 | 1, ((le + ri) >> 1) + 1, ri, ql, qr);\n\t\t}\n\t\treturn re;\n\t}\n}\nint main() {\n\tn = ured();\n\tt = ured();\n\trep(i, 1, n) {\n\t\ta[i] = ured();\n\t\tfirs[i - 1] = n + 1;\n\t}\n\tdep(i, n, 1) {\n\t\tneig[i] = firs[a[i]];\n\t\tfirs[a[i]] = i;\n\t}\n\trep(i, 0, n - 1) {\n\t\tlasp = 0;\n\t\tplef = -1;\n\t\tgep(j, i) {\n\t\t\tprig = plef + 1;\n\t\t\tplef = prig - (j - lasp - 1);\n\t\t\trans += quer(1, -n - 1, n + 1, plef, prig) * prig - ques(1, -n - 1, n + 1, plef, prig) + quer(1, -n - 1, n + 1, -n - 1, plef - 1) * (prig - plef + 1);\n\t\t\tmodi(1, -n - 1, n + 1, plef, prig, 1);\n\t\t\tlasp = j;\n\t\t}\n\t\tlasp = 0;\n\t\tplef = -1;\n\t\tgep(j, i) {\n\t\t\tprig = plef + 1;\n\t\t\tplef = prig - (j - lasp - 1);\n\t\t\tmodi(1, -n - 1, n + 1, plef, prig, -1);\n\t\t\tlasp = j;\n\t\t}\n\t}\n\tuwit(rans);\n\tputchar('\\n');\n  return 0;\n}\n```",
        "postTime": 1624167412,
        "uid": 336630,
        "name": "dcmfqw",
        "ccfLevel": 0,
        "title": "P4062 \u9898\u89e3"
    },
    {
        "content": "**[Portal]( https://www.luogu.com.cn/problem/P4062 )**\n\n\u9996\u5148\u8003\u8651\u7528\u4f17\u6570\u800c\u975e\u533a\u95f4\u6765\u8d21\u732e\u7b54\u6848\u3002\u6211\u4eec\u8003\u8651\u5bf9\u6bcf\u4e2a\u6570\u90fd\u5904\u7406\u51fa\u5b83\u6240\u5728\u7684\u4f4d\u7f6e list\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a list \u72ec\u7acb\u641e\u3002\n\n\u4e00\u4e2a\u7b80\u5355\u7c97\u66b4\u7684\u60f3\u6cd5\u662f\uff0c\u5217\u51fa\u4e24\u4e2a\u4f4d\u7f6e\u6784\u6210\u7684\u533a\u95f4\u6ee1\u8db3\u6761\u4ef6\u7684\u5145\u8981\u6761\u4ef6\uff0c\u7136\u540e\u53d1\u73b0\u662f\u4e00\u4e2a\u5173\u4e8e $i$ \u7684\u5f0f\u5b50\u548c\u5173\u4e8e $j$ \u7684\u5f0f\u5b50\u7684\u4e0d\u7b49\u5f0f\uff0cBIT \u7ef4\u62a4\u4e00\u4e0b\u5c31\u884c\u4e86\uff0c\u4f46\u8fd9\u6837\u6bcf\u4e2a\u662f $\\mathrm O(n\\log)$\uff0c\u6700\u574f\u80fd\u88ab\u5361\u5230 $\\Omega\\!\\left(n^2\\right)$\u3002\u4e8e\u662f\u6211\u4eec\u8981\u52aa\u529b\u8ba9\u590d\u6742\u5ea6\u4e0d\u5173\u4e8e $n$\uff0c\u53ea\u5173\u4e8e\u5f53\u524d\u6570\u7684\u4e2a\u6570\u3002\n\n\u4e8e\u662f\u6211\u4eec\u4e00\u6b65\u6b65\u6765\u628a $n$ \u7ed9\u53bb\u6389\u3002\u9996\u5148\u80af\u5b9a\u4e0d\u80fd\u679a\u4e3e\u53f3\u7aef\u70b9 $j$ \u4e86\u3002\u8bbe\u5f53\u524d\u6570\u7684\u4f4d\u7f6e list \u4e3a $a$\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u679a\u4e3e $a_j\\sim a_{j+1}-1$ \u7684\u8fd9\u4e2a gap\uff0c\u8fd9\u6837\u81f3\u5c11\u679a\u4e3e\u91cf\u4e0d\u5173\u4e8e $n$ \u4e86\u3002\u6211\u4eec\u770b\u5bf9\u4e8e\u5de6\u7aef\u70b9 $i$\uff0c\u5b83\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u4e3a $a_i'$\uff0c\u90a3\u4e48\u5b83\u4e0e $j$ \u7684\u5171\u540c\u8d21\u732e\uff0c\u5c31\u770b\u4e00\u4e0b\u5b83\u81f3\u5c11\u8981\u4f38\u591a\u8fdc\uff0c\u548c  $a_{j+1}-1$ \u53d6\u4e2a $\\min$\uff0c\u7136\u540e\u7b97\u4e00\u4e0b\u5230 $a_j$ \u7684\u8ddd\u79bb\u4e0e $0$ \u53d6\u4e2a $\\max$\u3002\u5f0f\u5b50\u5217\u51fa\u6765\uff1a\n$$\n\\max\\!\\left(0,\\min\\!\\left(a_{j+1}-1,a_i'+2(j-i+1)-1-1\\right)-a_j+1\\right)\n$$\n\u6bd4\u8f83\u957f\u7684\u90a3\u4e32\u6574\u7406\u4e00\u4e0b\u662f $a_i'+2j-2i$\u3002\u7136\u540e\u6709\u4e24\u4e2a $\\min/\\max$\uff0c\u8003\u8651\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $a_i'+2j-2i<a_{j+1}-1$ \u5373 $a_i'-2i+1<a_{j+1}-2j$\u3002\u8fd9\u6837\u91cc\u9762\u90a3\u4e2a $\\min$ \u7684\u503c\u5c31\u662f $a'_i+2j-2i$\u3002\u7136\u540e\u8fd8\u8981\u4f7f\u5b83 $\\leq a_j-1$\uff0c\u4e0d\u7136\u4f1a\u503c\u4e3a $0$\uff0c\u5373 $a'_i-2i+1\\geq a_j-2j$\uff0c\u7136\u540e\u503c\u662f $a'_i+2j-2i-a_j+1=\\left(a'_i-2i+1\\right)+(2j-a_j)$\u3002\u4e8e\u662f\u8fd9\u4e2a\u6211\u4eec\u6bcf\u6b21\u5c06 $a'_i-2i+1$ \u52a0\u5165 BIT\uff0c\u7136\u540e\u6570\u4e00\u4e0b $[a_j-2j,a_{j+1}-2j)$ \u5185\u7684\u8ba1\u6570\u4e0e\u548c\uff0c\u5c31\u53ef\u4ee5\u7b97\u4e86\uff1b\n2. $a'_i+2j-2i\\geq a_{j+1}-1$ \u5373 $a'_i-2i+1\\geq a_{j+1}-2j$\u3002\u8fd9\u6837\u503c\u5c31\u662f $a_{j+1}-1-a_j+1=a_{j+1}-a_j$\uff0c\u8fd9\u4e2a\u53ea\u8ddf $j$ \u6709\u5173\uff0c\u4e8e\u662f\u540e\u7f00\u8ba1\u6570\u4e00\u4e0b\u4e58\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u4f46\u662f\u8fd9\u6837\u7edf\u8ba1\u7b54\u6848\u7684\u6b21\u6570\u662f\u4e0d\u8ddf $n$ \u6709\u5173\u4e86\uff0c\u4f46\u662f\u52a0\u5165 BIT \u7684\u6b21\u6570\u8fd8\u8ddf $n$ \u6709\u5173\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e00\u4e2a gap \u6574\u4f53\u52a0\u5165\uff0c\u90a3\u8fd9\u663e\u7136\u8ba1\u6570\u662f\u533a\u95f4\u52a0\uff0c\u800c\u548c\u7684\u5931\u804c\uff0c\u5176\u5b9e\u662f\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217\u3002\u6211\u4eec\u8003\u8651\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u52a0\u7b49\u5dee\u6570\u5217\u3001\u533a\u95f4\u6c42\u548c\u5176\u5b9e\u662f\u4e2a\u7ecf\u5178\u95ee\u9898\uff0c\u53ea\u9700\u8981\u7ef4\u62a4\u61d2\u6807\u8bb0\uff0c\u7136\u540e\u4e0b\u4f20\u7684\u65f6\u5019\u5c31\u7528\u4e00\u4e0b\u7b49\u5dee\u6570\u5217\u6c42\u548c\u516c\u5f0f\u5c31\u53ef\u4ee5\u4e86\uff0c\u53ef\u4ee5 $\\mathrm O(\\log)$ \u7ef4\u62a4\u3002\u8fd9\u6837\u603b\u590d\u6742\u5ea6\u5c31\u662f\u7ebf\u5bf9\u4e86\u3002\n\n\u7136\u540e\u6bcf\u6b21\u4e0d\u80fd\u91cd\u65b0\u5efa\u6811\uff0c\u4f1a T\uff0c\u5fc5\u987b\u6bcf\u6b21\u64a4\u9500\u3002\n\n**_[code]( https://www.luogu.com.cn/paste/61y8s1x7 )_**",
        "postTime": 1607045693,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4062 \u3010[Code+#1]Yazid \u7684\u65b0\u751f\u821e\u4f1a\u3011"
    }
]