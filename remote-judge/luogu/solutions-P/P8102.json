[
    {
        "content": "[\u540c\u6b65\u53d1\u8868\u5728\u6211\u7684\u535a\u5ba2](https://www.cnblogs.com/Silymtics/p/solution-P8102.html)\n\n[\u9898\u76ee\u4f20\u9001ww](https://www.luogu.com.cn/problem/P8102)\n\n\u770b\u5230\u8fd9\u4e2a\u725b\u68da\u7684\u5f00\u5fc3\u503c\u7684\u8ba1\u7b97\u65b9\u6cd5\uff0c\u663e\u7136\u8981\u7528\u5355\u8c03\u961f\u5217\u53bb\u5904\u7406\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u77e5\u7684\u725b\u68da\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 $\\mathcal O(n)$ \u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u51fa\u6574\u4e2a\u725b\u68da\u7684\u5f00\u5fc3\u503c\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u80fd\u63d2\u7684\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u3002\n\n\u501f\u52a9\u5355\u8c03\u961f\u5217\u6a21\u62df\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u8bdd\u53ef\u4ee5\u505a\u5230 $\\mathcal O(n^2)$\uff0c\u671f\u671b\u5f97\u5206 $30$\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u53d1\u73b0\u5728\u653e $i$ \u4f4d\u7f6e\u548c $i+1$ \u4f4d\u7f6e\u7684\u65f6\u5019\u5f88\u591a\u4f4d\u7f6e\u7684\u8d21\u732e\u662f\u4e0d\u4f1a\u53d8\u5316\u7684\uff0c\u90a3\u6211\u4eec\u53ea\u8003\u8651\u53d8\u5316\u4e86\u7684\u3002\n\n\u6211\u4eec\u8003\u8651\u5728\u7b2c $x$ \u548c\u7b2c $x+1$ \u4e2a\u725b\u4e4b\u95f4\u63d2\u5165\u4e00\u4e2a\u725b\u3002\n\n\u4ee5 $n = 6, m = 3, x = 3$ \u4e3a\u4f8b\u3002\n\n\u63d2\u4e4b\u524d\uff1a `######` \uff1b\u63d2\u4e4b\u540e\uff1a`###x###`\u3002\n\n`#` \u4ece\u5de6\u5230\u53f3\u7f16\u53f7 $1 \\sim 6$\u3002\n\n\u6211\u4eec\u53d1\u73b0 $[2,4], [3,5]$ \u7684\u8d21\u732e\u53d8\u6210\u4e86 $[2,x], [3,4], [x, 5]$ \u8fd9\u4e09\u4e2a\u533a\u95f4\u3002\n\n\u540e\u9762\u8fd9\u4e09\u4e2a\u533a\u95f4\u7684\u8d21\u732e\u53ef\u4ee5\u8868\u793a\u6210\u539f\u5e8f\u5217\u4e2d\u4e09\u4e2a\u957f\u5ea6\u4e3a $2$ \u7684\u533a\u95f4\u548c\u63d2\u5165\u7684 $x$ \u53bb $\\max$ \u6c42\u548c\u8d21\u732e\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u4e24\u6b21\u5206\u522b\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u957f\u5ea6\u4e3a $m$ \u7684\u533a\u95f4\u7684\u8d21\u732e\u548c\u6bcf\u4e2a\u957f\u5ea6\u4e3a $m-1$ \u7684\u533a\u95f4\u7684\u8d21\u732e\u3002 \n\n\u7136\u540e\uff0c\u6211\u4eec\u4ece\u524d\u5230\u540e\u679a\u4e3e\u63d2\u5165\u7684\u4f4d\u7f6e $x$ \uff08\u5e8f\u5217\u4e2d\u7b2c $x$ \u4e2a\u5143\u7d20\u7684\u540e\u9762\uff09\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u8fd9\u4e9b\u6709\u8d21\u732e\u7684\u533a\u95f4\u7684\u8303\u56f4\u662f\u4e0d\u65ad\u53f3\u79fb\u7684\uff0c\u6839\u636e $x,m$ \u5c31\u53ef\u4ee5\u786e\u5b9a\u51fa\u8fd9\u4e2a\u8303\u56f4\uff0c\u7136\u540e\u7528\u7c7b\u4f3c\u53cc\u6307\u9488\u7684\u5199\u6cd5\u66f4\u65b0\u5373\u53ef\u3002\n\n\u56e0\u4e3a\u6240\u6709\u9884\u5904\u7406\u5305\u62ec\u540e\u9762\u7684\u679a\u4e3e\u63d2\u5165\u4f4d\u7f6e\u90fd\u662f $\\mathcal O(n)$ \u7684\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n)$\uff0c\u671f\u671b\u5f97\u5206 $100$\u3002\n\n\u66f4\u591a\u7ec6\u8282\u770b\u4ee3\u7801\u5427\u3002\n\n```cpp\n/*\nWork by: Suzt_ilymtics\nProblem: \u4e0d\u77e5\u540d\u5c51\u9898\nKnowledge: \u5783\u573e\u7b97\u6cd5\nTime: O(\u80fd\u8fc7)\n*/\n#include<bits/stdc++.h>\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<queue>\n#define int long long\n#define orz cout<<\"lkp AK IOI!\"<<endl\n\nusing namespace std;\nconst int MAXN = 5e6+5;\nconst int INF = 1e9+7;\nconst int mod = 1e9+7;\n\nint n, m, A;\nint res = 0, Ans = 0, ans = 0;\nint a[MAXN];\nint b[MAXN], c[MAXN];\nint q[MAXN], head = 1, tail = 0;\n\nint read() {\n    int s = 0, f = 0;\n    char ch = getchar();\n    while(!isdigit(ch)) f |= (ch == '-'), ch = getchar();\n    while(isdigit(ch)) s = (s << 1) + (s << 3) + ch - '0', ch = getchar();\n    return f ? -s : s;\n}\n\nsigned main()\n{\n    n = read(), m = read(), A = read();\n    for(int i = 1; i <= n; ++i) a[i] = read();\n    for(int i = 1; i < m; ++i) {\n        while(head <= tail && a[q[tail]] < a[i]) tail --;\n        q[++tail] = i;\n    }\n    for(int i = m; i <= n; ++i) {\n        while(head <= tail && q[head] < i - m + 1) head ++;\n        while(head <= tail && a[q[tail]] < a[i]) tail --;\n        q[++tail] = i;\n        b[i - m + 1] = a[q[head]];\n    }\n    head = 1, tail = 0;\n    int p = m - 1;\n    for(int i = 1; i < p; ++i) {\n        while(head <= tail && a[q[tail]] < a[i]) tail --;\n        q[++tail] = i;\n    }\n    for(int i = p; i <= n; ++i) {\n        while(head <= tail && q[head] < i - p + 1) head ++;\n        while(head <= tail && a[q[tail]] < a[i]) tail --;\n        q[++tail] = i;\n        c[i - p + 1] = a[q[head]];\n    }\n    for(int i = 1; i <= n - p + 1; ++i) {\n        c[i] = max(c[i], A);\n    }\n    for(int i = 1; i <= n - m + 1; ++i) ans += b[i];\n    // \u77ed\u533a\u95f4\u957f\u5ea6\u4e3a m-1\uff0c\u4e2a\u6570\u4e3a m\n    // \u957f\u533a\u95f4\u957f\u5ea6\u4e3a m\uff0c\u4e2a\u6570\u4e3a m - 1\n    // \u82e5\uff0c\u63d2 i, i + 1 \u4e4b\u95f4\uff0c\u6240\u6d89\u77ed\u533a\u95f4\u4e3a [i - m + 2, i + 1]\uff0c\u6240\u6d89\u957f\u533a\u95f4\u4e3a [i - m + 2, i] \n    for(int i = 0; i <= n; ++i) {\n        res -= b[i], res += c[i + 1];\n        if(i - m + 1 >= 1) res += b[i - m + 1] - c[i - m + 1];\n        Ans = max(Ans, ans + res);\n    }\n    printf(\"%lld\\n\", Ans);\n    return 0;\n}\n```\n\n",
        "postTime": 1644147550,
        "uid": 230580,
        "name": "Suzt_ilymtics",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P8102 [LCOI RI]Cow Insertion"
    },
    {
        "content": "\u5b98\u65b9\u9898\u89e3\u6765\u4e86\uff0c\u6c42\u7ba1\u7406\u5458\u7ed9\u8fc7qwq\u3002\n## \u601d\u8def\n### $\\mathbf{\\mathsf{10}}$ \u5206\n\n\u8fd9 $10$ \u5206\u4f60\u8981\u662f\u6ca1\u62ff\u5230\u5c31\u57fa\u672c\u53ef\u4ee5\u9000\u5f79\u4e86\uff08\n\n\u7b2c\u4e00\u5c42\u5faa\u73af\uff1a\u679a\u4e3e\u63d2\u5165\u4f4d\u7f6e\uff0c\u5e76\u6c42\u6700\u5927\u503c\n\n\u7b2c\u4e8c\u5c42\u5faa\u73af\uff1a\u679a\u4e3e\u8d77\u70b9\u4f4d\u7f6e\uff0c\u5e76\u6c42\u548c\n\n\u7b2c\u4e09\u5c42\u5faa\u73af\uff1a\u679a\u4e3e\u5f53\u524d\u70b9\uff0c\u5e76\u6c42\u6700\u5927\u503c\n\n\u4f2a\u4ee3\u7801\uff1a\n\n```cpp\nfor \u63d2\u5165\u70b9ins\n    \u63d2\u5165(ins)\n    for \u8d77\u70b9i\n        for \u5f53\u524d\u70b9j\n            cnt=max(a[i])\n        tot+cnt\n\tans=max(tot)\n```\n\n\u6211\u4eec\u5148\u8003\u8651\u63d2\u5165\u51fd\u6570\u662f\u4e0d\u662f\u6d6a\u8d39\u65f6\u95f4\u3002\n\n\u7b54\u6848\u662f\u5426\u5b9a\u7684\u2014\u2014\u4f60\u91cc\u9762\u7684\u4e24\u91cd\u5faa\u73af\u66f4\u6162\uff0c\u800c\u63d2\u5165\u51fd\u6570\u4e0d\u5f71\u54cd\u6574\u4f53\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u9876\u591a\u52a0\u4e00\u4e2a\u5e38\u6570\u3002\n\n\u5206\u6790\u5b8c\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u5199\u51fd\u6570\u4e86\u3002\n\n\u51fd\u6570\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u66b4\u529b\u201c\u79fb\u52a8\u201d $ins$ \u540e\u9762\u7684\u503c\u5c31\u884c\u4e86\n\n\u63d2\u5165\u51fd\u6570\uff1a\n```cpp\nvoid insert(int x){\n\tb[x]=A;\n\tfor(int i=1;i<=n;i++){\n\t\tif(i>=x){\n\t\t\tb[i+1]=a[i];\n\t\t}\n\t\telse{\n\t\t\tb[i]=a[i];\n\t\t}\n\t}\n}\n```\n\n\u51fd\u6570\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\u0398(n)$\u3002\n\n\u4f2a\u4ee3\u7801\u76f4\u63a5\u6539\u6210\u771f\u4ee3\u7801\u5c31\u597d\u4e86\uff0c\u968f\u4fbf\u5199\u5199\u5c31\u597d\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,A,a[5000005],b[5000005],ans=0;\nvoid insert(int x){\n\tb[x]=A;\n\tfor(int i=1;i<=n;i++){\n\t\tif(i>=x){\n\t\t\tb[i+1]=a[i];\n\t\t}\n\t\telse{\n\t\t\tb[i]=a[i];\n\t\t}\n\t}\n}\nint main() {\n\tcin>>n>>m>>A;\n\tfor(int i=1;i<=n;i++){\n\t\tcin>>a[i];\n\t}\n\tfor(int ins=1;ins<=n;ins++){\n\t\tint tot=0,cnt=0;\n\t\tinsert(ins);\n\t\tn++;\n\t\tfor(int i=1;i<=n-m+1;i++){\n\t\t\tcnt=0;\n\t\t\tfor(int j=i;j<=i+m-1;j++){\n\t\t\t\tcnt=max(b[j],cnt);\n\t\t\t}\n\t\t\ttot+=cnt;\n\t\t}\n\t\tn--;\n\t\tans=max(ans,tot);\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\u0398(n^3)$\u3002\n\n\u8bf4\u53e5\u95f2\u8bdd\uff0c\u5176\u5b9e subtask$2$ \u53ef\u4ee5\u8fc7\u4e00\u4e2a\u70b9\uff0c\u4f46\u662f\u662f\u6346\u7ed1\u6570\u636e\u3002\n\n### $\\mathbf{\\mathsf{30}}$ \u5206\n\n\u8fd9\u4e2a\u65b9\u6cd5\u672c\u6765\u662f\u53ef\u4ee5\u5f97\u6ee1\u5206\u7684\uff0c\u4f46\u662f\u88ab\u6211\u6539\u4e86\u6570\u636e\u8303\u56f4\uff08\u5149\u901f\u9003\n\n\u679a\u4e3e\u63d2\u5165\u70b9\uff0c\u6bcf\u6b21\u6ed1\u52a8\u7a97\u53e3\u5c31\u597d\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAXN = 5000000 + 5;\nint n, m, A, Apos;\nint a[MAXN];\ndeque<int> q;\nint dat(int i) {\n\tif (i < Apos)\n\t\treturn a[i];\n\tif (i > Apos)\n\t\treturn a[i - 1];\n\treturn A;\n}\nint main() {\n\tcin >> n >> m >> A;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i];\n\tn++;\n\tint ans = 0;\n\tfor (Apos = 1; Apos <= n - m + 1; Apos++) {\n\t\twhile (!q.empty())\n\t\t\tq.pop_back();\n\t\tint now = 0;\n\t\tfor (int i = 1, j = 1; i <= n - m + 1; i++) {\n\t\t\twhile (j - i + 1 <= m) {\n\t\t\t\twhile (!q.empty() && dat(q.back()) <= dat(j))\n\t\t\t\t\tq.pop_back();\n\t\t\t\tq.push_back(j++);\n\t\t\t}\n\t\t\twhile (!q.empty() && q.front() < i)\n\t\t\t\tq.pop_front();\n\t\t\tnow += dat(q.front());\n\t\t}\n\t\tans = max(ans, now);\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n```\n\n### $\\mathbf{\\mathsf{100}}$ \u5206\n\n\u7b80\u5355\u601d\u8003\u4e00\u4e0b\uff0c\u53ef\u4ee5\u5f97\u51fa\u4e00\u4e2a\u7ed3\u8bba\u2014\u2014\u5bf9\u4e8e\u6bcf\u6b21\u4fee\u6539 $A$ \u53ea\u4f1a\u5f71\u54cd\u5230\u63d2\u5165\u4f4d\u7f6e\u7684\u524d $m-1$ \u4e2a\u533a\u95f4\uff0c\u6ca1\u5fc5\u8981\u5168\u90e8\u4f9d\u6b21\u4fee\u6539\u3002\n\n\u9996\u5148\uff0c\u5982\u679c $m=1$\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u7edf\u8ba1\u548c\u5373\u53ef\u3002\n\n\u6211\u4eec\u5b9a\u4e49 $7$ \u4e2a\u6570\u7ec4\uff1a\n- $f_i=\\sum\\limits^{i+m-1}_{j=i}a_j$\n- $g_i=\\sum\\limits^{i+m-2}_{j=i}a_j$\n- $sumf_i=\\sum\\limits^{i}_{j=1}f_j$\uff08$f_i$ \u7684\u524d\u7f00\u548c\uff09\n- $sumF_i=\\sum\\limits^{i}_{j=1}\\begin{cases}f_j(f_j>A)\\\\0(f_j\\le A)\\end{cases}$\uff08$f_i$ \u4e2d\u5927\u4e8e $A$ \u7684\u524d\u7f00\u548c\uff09\n- $sumg_i=\\sum\\limits^{i}_{j=1}g_j$\uff08$g_i$ \u7684\u524d\u7f00\u548c\uff09\n- $sumG_i=\\sum\\limits^{i}_{j=1}\\begin{cases}g_j(g_j>A)\\\\0(g_j\\le A)\\end{cases}$\uff08$g_i$ \u4e2d\u5927\u4e8e $A$ \u7684\u524d\u7f00\u548c\uff09\n- $cntg_i=\\sum\\limits^{i}_{j=1}g_j<A$\uff08$g_i$ \u4e2d\u5c0f\u4e8e $A$ \u7684\u4e2a\u6570\uff09\n\n\u5728\u5b9a\u4e49\u4e00\u4e2a\u6570 $base$ \u63d2\u5165 $A$ \u4e4b\u524d\u7684\u7b54\u6848\u3002\n\n\u9996\u5148\u505a\u4e24\u6b21\u4f18\u5148\u961f\u5217\u9884\u5904\u7406\u5b8c\u6210\u4e0a\u8ff0\u7684\u51e0\u4e2a\u6570\u7ec4\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5904\u7406\u5305\u542b $A$ \u7684\u51e0\u4e2a\u533a\u95f4\u3002\n\n\u5982\u679c\u628a $A$ \u653e\u5728\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u4e4b\u540e\uff1a\n\n\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u5904\u7406\u597d\u4e86\u4e0d\u52a0\u5165 $A$ \u65f6\u6240\u6709\u7684\u548c\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053\u52a0\u5165 $A$ \u540e\u7684\u589e\u91cf\u3002\n\n\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5904\u7406\u5305\u542b $A$ \u7684\u533a\u95f4\u3002\u8fd9\u6837\u7684\u533a\u95f4\u4e00\u5171\u6709 $m$ \u4e2a\u2014\u2014\u4ee5 $A$ \u5f00\u59cb\u7684\u4e00\u4e2a\u7684\u548c\u4e0d\u4ee5 $A$ \u5f00\u59cb\u7684 $m-1$ \u4e2a\u3002\n\n\u4ee5 $A$ \u5f00\u59cb\u7684\u533a\u95f4\u6700\u503c\u4fbf\u5f88\u663e\u7136\u662f $A$ \u548c\u540e\u9762\u7684 $m-1$ \u4e2a\u6570\u7684\u6700\u5927\u503c\u53d6\u4e00\u4e2a\u6700\u5927\u503c\uff0c\u8fd9\u540e\u9762\u7684 $m-1$ \u4e2a\u6570\u7684\u6700\u5927\u503c\u6211\u4eec\u5df2\u7ecf\u5904\u7406\u51fa\u6765\u4e86\uff0c\u5373 $g$ \u6570\u7ec4\u3002\u6240\u4ee5\u8fd9\u90e8\u5206\u7684\u7b54\u6848 $now$ \u662f $\\max\\{\nA,\ng_{i+1}\n\\}$\u3002\n\n\u5f71\u54cd\u4e86\u90a3\u4e9b\u533a\u95f4\u5462\uff1f\n\n\u7b80\u5355\u63a8\u4e00\u4e0b\uff0c\u5f71\u54cd\u7684\u7b2c\u4e00\u4e2a\u533a\u95f4\u7684\u7f16\u53f7 $l$ \u4e3a $\\max\n\\{\n1,\ni-m+2\n\\}$\uff0c\u5f71\u54cd\u6700\u540e\u4e00\u4e2a\u533a\u95f4\u7684\u7f16\u53f7 $r$ \u4e3a $i$\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7684\u51fa\u63d2\u5165\u540e\u7684\u7b54\u6848\u4e4b\u548c $nxt$ \u4e3a $A\\times(cntg_r-cntg_{l-1})+sumG_r-sumG_{l-1}$\u3002\n\n\u4f46\u662f\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f**\u589e\u91cf**\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8fd8\u8981\u51cf\u53bb\u539f\u6765\u7684\u548c\u3002\u7531\u4e8e\u4ee5 $A$ \u5f00\u59cb\u7684\u533a\u95f4\u662f\u65b0\u751f\u513f\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u51cf\u3002\u800c\u524d $m-1$ \u4e2a\u533a\u95f4\u4e0d\u540c\uff0c\u6211\u4eec\u8fd8\u8981\u51cf\u53bb\u5b83\u539f\u6765\u7684\u548c $pre=sumf_r-sumf_{l-1}$\u3002\n\n\n\u6240\u4ee5\u8fd9\u90e8\u5206\u7684\u589e\u91cf\u4fbf\u662f\uff1a\n$$\nnow+nxt-pre\n$$\n\n\u90a3\u6240\u6709\u600e\u4e48\u7edf\u8ba1\u5462?\n\n\u5f88\u7b80\u5355\uff0c\u7528\u4e00\u4e2a\u53d8\u91cf $ans$ \u53d6\u4e2a\u60c5\u51b5\u7684\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u5230\u4e86\u8fd9\u91cc\uff0c\u4f60\u4ee5\u4e3a\u5b8c\u4e86\uff1f\n\n\u4e0d\u4e0d\u4e0d\uff0c\u8fd8\u6ca1\u5b8c\u3002\n\n\u4e0a\u9762\u7edf\u8ba1\u7684\u53ea\u662f\u628a $A$ \u653e\u5728\u7b2c $i$ \u4e2a\u4f4d\u7f6e**\u4e4b\u540e**\u7684\u60c5\u51b5\uff0c\u628a $A$ \u653e\u5728\u7b2c $1$ \u4e2a\u4f4d\u7f6e\u4e4b\u540e\u4e5f\u662f\u53ef\u884c\u7684\u4e00\u79cd\u7b54\u6848\u3002\u6240\u4ee5\u5e94\u5f53\u5148\u628a $ans$ \u521d\u59cb\u5316\u4e3a $\\max\\begin{cases}A\\\\g_1\\end{cases}$\u3002\n\n\u6700\u540e\u8f93\u51fa $ans$\uff0c\u4f60\u5c31\u53ef\u4ee5\u8fc7\u4e86\u3002\n\n## code\n```cpp\n#include <bits/stdc++.h>\ntemplate <typename T> inline void read(T& x);\ntemplate <typename T,typename ...Arg> inline void read(T& x,Arg& ...arg);\ntemplate <typename T>inline void write(T x);\ntemplate <typename T,typename ...Arg> inline void write(T x,Arg ...arg);\nusing namespace std;\nconst int MAXN = 5000000 + 5;\nint n, m, A;\nint a[MAXN];\nint base = 0;   //\u63d2\u5165A\u4e4b\u524d\u7684\u548c\nint f[MAXN];    // f[i]: max(a[i] ~ a[i+m-1])\nint g[MAXN];    // g[i]: max(a[i] ~ a[i+(m-1)-1])\nint sumf[MAXN]; // f[i]\u7684\u524d\u7f00\u548c\nint sumF[MAXN]; // f[i]\u4e2d\u5927\u4e8eA\u7684\u524d\u7f00\u548c\nint sumg[MAXN]; // g[i]\u7684\u524d\u7f00\u548c\nint sumG[MAXN]; // g[i]\u4e2d\u5927\u4e8eA\u7684\u524d\u7f00\u548c\nint cntg[MAXN]; // g[i]\u4e2d\u5c0f\u4e8e\u7b49\u4e8eA\u7684\u5143\u7d20\u6570\u91cf\u7684\u524d\u7f00\u548c\ndeque<int> qf, qg;\nint main() {\n\tread(n,m,A);\n\tfor (int i = 1; i <= n; i++)\n\t\tread(a[i]);\n\tif (m == 1) {\n\t\tint ans = A;\n\t\tfor (int i = 1; i <= n; i++)\n\t\t\tans += a[i];\n\t\twrite(ans);\n\t\tputs(\"\");\n\t\treturn 0;\n\t}\n\t//\u8ba1\u7b97 f, sumf, sumF, base\n\tsumf[0] = sumF[0] = 0;\n\tfor (int i = 1, j = 1; i <= n - m + 1; i++) {\n\t\twhile (j - i + 1 <= m) {\n\t\t\twhile (!qf.empty() && a[qf.back()] <= a[j])\n\t\t\t\tqf.pop_back();\n\t\t\tqf.push_back(j++);\n\t\t}\n\t\twhile (!qf.empty() && qf.front() < i)\n\t\t\tqf.pop_front();\n\t\tf[i] = a[qf.front()];\n\t\tbase += f[i];\n\t\tsumf[i] = sumf[i - 1] + f[i];\n\t\tsumF[i] = sumF[i - 1] + (f[i] > A ? f[i] : 0);\n\t}\n\t//\u8ba1\u7b97 g,sumg,sumG\n\tsumg[0] = sumG[0] = cntg[0] = 0;\n\tfor (int i = 1, j = 1; i <= n - (m - 1) + 1; i++) {\n\t\twhile (j - i + 1 <= (m - 1)) {\n\t\t\twhile (!qg.empty() && a[qg.back()] <= a[j])\n\t\t\t\tqg.pop_back();\n\t\t\tqg.push_back(j++);\n\t\t}\n\t\twhile (!qg.empty() && qg.front() < i)\n\t\t\tqg.pop_front();\n\t\tg[i] = a[qg.front()];\n\t\tsumg[i] = sumg[i - 1] + g[i];\n\t\tsumG[i] = sumG[i - 1] + (g[i] > A ? g[i] : 0);\n\t\tcntg[i] = cntg[i - 1] + (g[i] <= A);\n\t}\n\t//\u8ba1\u7b97\u63d2\u5165 A \u540e\u7684\u6700\u5927\u589e\u91cf\n\tint ans = max(g[1], A); //\u653e\u5728\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u65f6\u7684\u589e\u91cf\n\tfor (int i = 1; i <= n - m + 1; i++) {\n\t\tint now = max(g[i + 1], A); // A \u5f00\u59cb\u5f80\u540e\u7684\u533a\u95f4\u6700\u503c\n\t\t//\u63d2\u5728i\u540e\u9762\u65f6\uff0c\u4f1a\u5f71\u54cd\u524dm-1\u4e2a\u5143\u7d20\n\t\tint l = max(1, i - (m - 1) + 1);\n\t\tint r = i;\n\t\tint pre = sumf[r] - sumf[l - 1]; //\u63d2\u5165A\u4e4b\u524d\u7684\u8fd9\u4e9b\u5143\u7d20\u7684\u6700\u503c\u7b54\u6848\u4e4b\u548c\n\t\tint nxt = (cntg[r] - cntg[l - 1]) * A +\n\t\t          (sumG[r] - sumG[l - 1]); //\u63d2\u5165A\u4e4b\u540e\u7684\u8fd9\u4e9b\u5143\u7d20\u7684\u6700\u503c\u7b54\u6848\u4e4b\u548c\n\t\tnow += nxt - pre;\n\t\tans = max(ans, now);\n\t\t// cout << i << \":\" << l << \"~\" << r << \" \" << pre << \" \" << nxt << endl;\n\t}\n\twrite(base+ans);\n\tputs(\"\");\n\treturn 0;\n}\ntemplate <typename T> inline void read(T& x) {\n\tx=0;\n\tT f=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9') {\n\t\tif(ch=='-') {\n\t\t\tf=-1;\n\t\t}\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9') {\n\t\tx=(x<<1)+(x<<3)+(ch^48);\n\t\tch=getchar();\n\t}\n\tx=x*f;\n\treturn;\n}\ntemplate <typename T,typename ...Arg> inline void read(T& x,Arg& ...arg){\n\tread(x);\n\tread(arg...);\n}\ntemplate <typename T>inline void write(T x) {\n\tif(x<0) {\n\t\tputchar('-');\n\t\tx=-x;\n\t}\n\tif(x<10) {\n\t\tputchar(x+'0');\n\t} else {\n\t\twrite(x/10);\n\t\tputchar(x%10+'0');\n\t}\n}\ntemplate <typename T,typename ...Arg> inline void write(T x,Arg ...arg){\n\twrite(x);\n\tputchar(' ');\n\twrite(arg...);\n}\n```",
        "postTime": 1643973069,
        "uid": 357311,
        "name": "little_cindy",
        "ccfLevel": 6,
        "title": "P8102 [LCOI RI]Cow Insertion \u9898\u89e3"
    },
    {
        "content": "\u672c\u9898\u4e00\u773c\u5355\u8c03\u961f\u5217\uff0c\u4f46\u5f97\u77e5\u505a\u6cd5\u4e0d\u662f\u96be\u70b9\u3002\n\n\u6211\u4eec\u5148\u628a\u5355\u8c03\u961f\u5217\u6a21\u677f\u6253\u5b8c\uff0c\u5b9a\u4e49 $b_i$ \u4e3a $[i,i+m-1]$ \u4e2d\u7684\u6700\u5927\u503c\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u653e $A$\u3002\n\n### \u5206\u6790\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/kbztfiio.png)\n\n\u5982\u4e0a\u56fe\uff08\u5b57\u6bcd\u7684\u503c\u4e3a\u5b83\u662f\u7b2c\u51e0\u4e2a\u5b57\u6bcd\uff09\uff0c$A$ \u53ef\u4ee5\u653e\u5728 $0 \\sim 8$ \u7684\u4f4d\u7f6e\uff0c\u5047\u8bbe $m=3$\uff0c\u5728\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u82e5\u6211\u4eec\u5c06 $A$ \u653e\u5728 $4$ \u7684\u4f4d\u7f6e\uff0c\u672c\u8eab\u6211\u4eec\u4ee5 $d$ \u4e3a\u8d77\u70b9\u7684 $b_d=\\max(a_d,a_e,a_f)$\uff0c\u800c\u73b0\u5728\u53d8\u6210\u4e86 $\\max(a_d,A,a_e)$\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e0e $a_f$ \u65e0\u5173\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5047\u8bbe\u6211\u4eec\u653e\u5728\u4f4d\u7f6e $i$,\u90a3\u4e48\u8d77\u70b9\u4e3a $i-m+2 \\sim i-1$ \u7684\u533a\u95f4\u7684\u6700\u540e\u4e00\u4e2a\u503c\u90fd\u4f1a\u88ab $A$ \u4ece\u533a\u95f4\u6324\u51fa\u53bb\u3002\n\n### \u5b9e\u73b0\n\n\u6545\u6211\u4eec\u518d\u8fdb\u884c\u7b2c\u4e8c\u6b21\u5355\u8c03\u961f\u5217\uff0c\u5b9a\u4e49 $c_i$ \u4e3a $[i,i+m-2]$ \u4e2d\u7684\u6700\u5927\u503c\uff08\u533a\u95f4\u957f\u5ea6\u51cf\u4e00\uff09\uff0c\u56e0\u4e3a $A$ \u4e0d\u7ba1\u5728\u54ea\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u6bcf\u4e2a $c_i=\\max(c_i,A)$\uff0c\u610f\u601d\u662f\u5f53 $A$ \u52a0\u5165\u8fd9\u4e00\u6bb5\u5185\u7684\u6700\u5927\u503c \u3002\u5728\u679a\u4e3e $A$ \u7684\u4f4d\u7f6e $i$ \u65f6\uff0c\u6211\u4eec\u5c06\u672c\u6b21\u603b\u91cf\u8f83\u539f\u59cb\u5f00\u5fc3\u503c\u7684\u53d8\u52a8\u8bbe\u4e3a $ret$\uff0c\u90a3\u4e48\u6211\u4eec\u5c06 $ret$ \u521d\u59cb\u5316\u4e3a $c_{i+1}$\uff0c\u610f\u601d\u662f\u4ee5 $i$ \u4e3a\u8d77\u70b9\u7684\u533a\u95f4\u6700\u5927\u503c\uff0c\u63a5\u7740\u6211\u4eec\u5c06\u6536\u5230 $A$ \u5f71\u54cd\u7684\u533a\u95f4\u6700\u5927\u503c\u51cf\u53bb\uff0c\u52a0\u4e0a\u65b0\u7684\u533a\u95f4\u6700\u5927\u503c\uff0c\u800c\u5176\u5b83\u7684\u5730\u65b9\u90fd\u662f\u8ddf\u539f\u59cb\u7684\u4e00\u6837\u6240\u4ee5\u4e0d\u7528\u7ba1\uff0c\u5269\u4e0b\u7684\u4ea4\u7ed9\u524d\u7f00\u548c\uff0c\u6545\u5f0f\u5b50\u4e3a\uff1a\n\n$ret=c_{i+1}-\\sum\\limits_{j=i-m+2}^i{b_j-c_j}$\n\n$maxn=\\max(maxn,ret)$\n\n\u521d\u59cb\u5f00\u5fc3\u503c\u4e3a $sum$\n\n\u6700\u540e\u8f93\u51fa$sum+maxn$ \u5c31\u597d\u5566\u3002 \n\n### \u4ee3\u7801\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=5e6+5;\nint n,m,A,tail,head=1,maxn,sum;\nint q1[N],a[N],b[N],c[N],q2[N],s1[N],s2[N];\ninline int rd(){\n\tint x=0,f=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+ch-48;ch=getchar();}\n\treturn x*f;\n}\nint main(){\n\tn=rd(),m=rd(),A=rd();\n\tfor(int i=1;i<=n;i++)a[i]=rd();\n\tfor(int i=1;i<=n;i++){\n\t\twhile(tail>=head&&i-q1[head]>=m)head++;\n\t\twhile(tail>=head&&a[q1[tail]]<=a[i])tail--;\n\t\tq1[++tail]=i;\n\t\tif(i>=m)\n\t\tsum+=a[q1[head]],b[i-m+1]=a[q1[head]];\n\t}\n\tm--;\n\ttail=0,head=1;\n\tfor(int i=1;i<=n;i++){\n\t\twhile(tail>=head&&i-q2[head]>=m)head++;\n\t\twhile(tail>=head&&a[q2[tail]]<=a[i])tail--;\n\t\tq2[++tail]=i;\n\t\tif(i>=m)\n\t\tc[i-m+1]=a[q2[head]];\n\t}\n\tfor(int i=1;i<=n-m+1;i++)c[i]=max(c[i],A);\n\tfor(int i=1;i<=n;i++)s2[i]=s2[i-1]+c[i];\n\tm++;\n\tfor(int i=1;i<=n;i++)s1[i]=s1[i-1]+b[i];\n\tfor(int i=0;i<=n;i++){\n\t\tint ret=c[i+1];\n\t\tret-=s1[i];ret+=s1[max(0,i-m+1)];\n\t\tret+=(s2[i]-s2[max(0,i-m+1)]);\n\t\tmaxn=max(maxn,ret);\n\t}\n\tcout<<sum+maxn<<endl;\n\treturn 0;\n} \n```\n",
        "postTime": 1670671098,
        "uid": 431289,
        "name": "lalaouye123",
        "ccfLevel": 0,
        "title": "P8102\u9898\u89e3"
    },
    {
        "content": "### \u4e0d\u5f97\u4e0d\u8bf4\u8fd9\u662f\u9053\u5355\u8c03\u961f\u5217\u7684\u597d\u9898\n## 1. \u601d\u8def\n\u9996\u5148\u770b\u6570\u636e\u8303\u56f4 \uff1a  \n$n \\in [\\ 1 ,5\\times10^6\\ ]$ \u3002   \n\u8fd9\u5c31\u6ce8\u5b9a\u4e86\u6211\u4eec\u4e0d\u53ef\u4ee5\u7528\u66b4\u529b\u63d2\u5165\u518d\u8fdb\u884c\u5355\u8c03\u961f\u5217\u7b97\u6cd5 \u3002  \n\u6ce8\u610f\u5230\u63d2\u5165\u961f\u5217\u7684 **John \u5f71\u54cd\u8303\u56f4\u6709\u9650** \u3002  \n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7531\u6b64\u5165\u624b \u3002  \n## 2. \u89e3\u6cd5  \n\u5047\u8bbe\u6211\u4eec\u6709\u5e8f\u5217\uff1a$1\\ 2\\ 3\\ 4\\ 5\\ 6\\ 7$ \u3002  \n\u611f\u67d3\u8303\u56f4 $len$ \u4e3a $3$ \u3002  \n\u63d2\u5165\u7684\u4f4d\u70b9\u4e3a $4$ \u548c $5$ \u4e4b\u95f4 \u3002  \n\u5219\u5e8f\u5217\u5c31\u53d8\u4e3a\u4e86 $1\\ 2\\ 3\\ 4\\ x\\ 5\\ 6\\ 7$ \u3002   \n\u6211\u4eec\u53d1\u73b0\u5f71\u54cd\u5230\u7684\u533a\u95f4\u6709 $[3,x]\\ [4,5]\\ [x,6]$ \u3002  \n\u53ef\u4ee5\u770b\u4f5c $\\textbf{len-1=2}$ \u7684\u533a\u95f4\u63d2\u5165 $x$ \u540e\u5f97\u5230 \u3002 \n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5 **\u9884\u5904\u7406** \u4e24\u6761:  \n- $pre1$ \u4ee3\u8868 \u957f\u5ea6\u4e3a $len$ \u533a\u95f4\u5185\u5143\u7d20\u7684\u6700\u5927\u503c\u7684 **\u524d\u7f00\u548c** \u3002  \n- $pre2$ \u4ee3\u8868 \u957f\u5ea6\u4e3a $len-1$ \u533a\u95f4\u5185\u5143\u7d20\u7684\u6700\u5927\u503c\u7684 **\u524d\u7f00\u548c** \u3002  \n\n\u800c\u5728\u6c42 $pre2$ \u7684\u65f6\u5019\u53ef\u4ee5 **\u4e0e John \u7684\u503c\u4f5c\u6bd4\u8f83** \u9009\u51fa\u8f83\u5927\u503c \u3002  \n\n\u63d2\u5165\u7684\u4f4d\u70b9\u4e3a $4$ \u548c $5$ \u4e4b\u95f4\u65f6\uff0c\u7b54\u6848\u4e3a\uff1a     \n$max\\{1,2,3\\}+max\\{2,3,4\\}+max\\{3,4,x\\}$   \n$+max\\{4,x,5\\}+max\\{x,5,6\\}+max\\{5,6,7\\}$ \u3002\n\n\u5373\uff1a $pre1[4]+(\\ pre2[6]-pre2 [4-1]\\ )+(\\ pre1[7]-pre1[6]\\ )$ \u3002  \n\u63d2\u5165 $i$ \u548c $i+1$ \u4e4b\u95f4\u65f6 \uff0c\u4ee4:  \n- $l=i$ \u3002\n- $r=i+len-1$ \u3002  \n\n\u8fdb\u800c\u5f97\u51fa\u901a\u9879\uff1a \n- $pre1[l]+(\\ pre2[r]-pre2[l-1]\\ )+(\\ pre1[n]-pre1[r]\\ )$ \u3002  \n\n\u5199\u7684\u65f6\u5019\u6ce8\u610f\u5224\u65ad $l$ \u548c $r$ **\u662f\u5426\u8d8a\u754c** \u5373\u53ef \u3002\n## 3. Code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=5e6+5;\nint n,len,A;\nint a[maxn];\nint pre1[maxn],pre2[maxn];\nstruct Node{\n\tint val;\n\tint id;\n}q[maxn];\nvoid solve1(){//\u624b\u5199\u5355\u8c03\u961f\u5217 \n\tmemset(q,0,sizeof(q));\n\tint head=1,tail=0;\n\tfor(int i=1;i<=n;i++){\n\t\twhile(head<=tail&&a[i]>=q[tail].val) tail--;\n\t\tq[++tail].val=a[i];\n\t\tq[tail].id=i;\n\t\twhile(q[head].id<=i-len)head++;\n\t\tif(i>=len) pre1[i]=pre1[i-1]+q[head].val;\n\t}\n}\nvoid solve2(){//\u624b\u5199\u5355\u8c03\u961f\u5217 \n\tmemset(q,0,sizeof(q));\n\tint head=1,tail=0;\n\tfor(int i=1;i<=n;i++){\n\t\twhile(head<=tail&&a[i]>=q[tail].val) tail--;\n\t\tq[++tail].val=a[i];\n\t\tq[tail].id=i;\n\t\twhile(q[head].id<=i-len+1)head++;\n\t\tif(i>=len-1) pre2[i]=pre2[i-1]+max(q[head].val,A);//\u4e0e John \u7684\u503c\u4f5c\u6bd4\u8f83\u9009\u51fa\u8f83\u5927\u503c\n\t}\n}\nint influ(int i){\n\tint l=i,r=i+len-1;\n\tif(l<1) l=1;\n\tif(r>n) r=n;//\u5224\u65ad\u8d8a\u754c \n\treturn pre1[l]+(pre2[r]-pre2[l-1])+(pre1[n]-pre1[r]);//\u901a\u9879 \n}\nint main(){\n\tscanf(\"%d%d%d\",&n,&len,&A);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tsolve1();solve2();\n\tint ans=-1;\n\tfor(int i=0;i<=n;i++) ans=max(ans,influ(i));//\u679a\u4e3e\u63d2\u5165\u70b9 \n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n\u6700\u540e~~\u5410\u69fd\u4e00\u4e0b~~\uff0c\u8fd9\u9053\u9898\u4ec5\u4ec5\u5c06 John \u63d2\u5165\u5934\u5c3e\u5c31\u53ef\u4ee5\u5f97\u5230 $90$ pts",
        "postTime": 1649514809,
        "uid": 392796,
        "name": "Think",
        "ccfLevel": 4,
        "title": "P8102 \u300cLCOI2022\u300d Cow Insertion \u9898\u89e3"
    },
    {
        "content": "~~\u542c\u7740\u300a\u6253\u4e0a\u82b1\u706b\u300b\uff0c\u4e0d\u77e5\u4e0d\u89c9\u63a8\u51fa\u4e86\u5f0f\u5b50~~\n\n\u521d\u78b0\u6b64\u9898\uff0c\u770b\u89c1 $n \\le 5 \\times 10^6$\uff0c\u611f\u89c9 $n \\lg n$ \u80fd\u8fc7\u554a  \n\uff08$5\\times 10^6 \\times \\lg5\\times10^6 \\approx 5\\times10^6 \\times 22.2534 \\approx 1.1126 \\times 10^8$\uff09\n\n\u5fc3\u60f3\u53ef\u80fd\u5f97\u5361\u4e2a\u5e38\u6570\u4e86\uff08~~\u4e8b\u5b9e\u540e\u6765\u6211\u662f\u5927\u5e38\u6570\u9009\u624b~~\uff09\n\n---\n\n\u770b\u5230\u9898\u9762\u7acb\u9a6c\u60f3\u5230\u63d2\u5165 $A$ \u7684\u5f71\u54cd\u662f\u6709\u9650\u7684\uff0c\u5927\u6982\u662f\u5411\u5de6\u5411\u53f3 $m$ \u4e2a\u6570\u3002\n\n\u6574\u4e2a\u9898\u76ee\u90fd\u5728\u6c42 $\\max_x^y$\uff0c\u5e72\u8106\u5c06\u6240\u6709 $\\max$ \u5f97\u5230\u7684\u6570\u5355\u72ec\u7b97\u51fa\u6765\u3002\u60f3\u5230\u7b97\u5b9a\u957f\u6700\u503c\uff0c\u53ef\u4ee5\u7528 [\u6ed1\u52a8\u7a97\u53e3](/problem/P1886) $O(n)$ \u89e3\u51b3\uff0c\u6240\u4ee5\u5c06\u503c\u8bbe\u51fa\u6765\uff1a\n$$\ns_i = \\max _ {j = i} ^ {i + m - 1} a_j \\ (1 \\le i \\le n - m + 1)\n$$\n\u90a3\u4e48\u672a\u63d2\u5165 $A$ \u7684\u7b54\u6848\u5373\u4e3a\uff1a\n$$\nans_1 = \\sum _ {i = 1} ^ {n - m + 1} s_i\n$$\n\u73b0\u5728\u8003\u8651\u63d2\u5165 $A$ \u4e4b\u540e\u7b54\u6848\u5c06\u4f1a\u53d8\u6210\u4ec0\u4e48\u3002\n\n\u5982\u679c\u5c06 $A$ \u63d2\u5165\u5230 $a_k$ \u540e\u9762\uff0c\u5e8f\u5217\u957f\u8fd9\u4e2a\u6837\u5b50\uff1a\n$$\n\\cdots, a_k, A, a_k +1, \\cdots\n$$\n\u90a3\u4e48\u5de6\u7aef\u6ca1\u6709\u8986\u76d6\u5230 $A$ \u7684\u5730\u65b9\u662f\u4e0d\u4f1a\u53d7 $A$ \u7684\u5f71\u54cd\u7684\u3002\n\n\u6709**\u53f3\u8fb9\u754c** $i + m - 1 = k$\uff08$s_i$ \u7684\u53f3\u7aef\u70b9\u521a\u597d\u4e0e $a_k$ \u91cd\u5408\uff09\n\n\u6240\u4ee5**\u53f3\u8fb9\u754c**\u4e3a $i = k - m + 1$\u3002\n\n\u6240\u4ee5\u5de6\u7aef\u672a\u53d7\u5f71\u54cd\u7684\u7b54\u6848\u4e3a\n$$\nans_2 = \\sum _ {i = 1} ^ {k - m + 1} s_i\n$$\n\u540c\u7406\uff0c\n\n\u53f3\u7aef**\u5de6\u8fb9\u754c** $i = k + 1$\uff0c\n\n\u5219\u53f3\u7aef\u672a\u53d7\u5f71\u54cd\u7684\u7b54\u6848\u4e3a\n$$\nans_3 = \\sum _ {i = k + 1} ^ {n - m + 1} s_i\n$$\n\u73b0\u5728\u9700\u8981\u5904\u7406\u4e2d\u95f4\u53d7\u5f71\u54cd\u7684\u90e8\u5206\u3002\n\n\u89c2\u5bdf\u5230\u8986\u76d6 $A$ \u7684\u5730\u65b9\u6709\u4e2a\u5171\u540c\u70b9\uff0c\u5c31\u662f\u4ed6\u4eec\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a\u539f\u957f\u5ea6\u4e3a $m - 1$ \u7684\u8d21\u732e\u4e0e $A$ \u53d6 $\\max$\u3002\n\n\u5c06\u957f\u5ea6\u4e3a $m - 1$ \u7684 $\\max$ \u7ed3\u679c\u5217\u51fa\u6765\uff1a\n$$\nu_i = \\max _ {j = i} ^ {i + m - 2} a_j \\  (1 \\le i \\le n - m + 2)\n$$\n $u_i$ \u4e0e $s_i$ \u76f8\u4f3c\u3002\n\n\u90a3\u4e48\uff0c$a_i, \\cdots, a_k, A, a_{k + 1}, \\cdots, a_{i + m - 2}$ \u7684\u6700\u7ec8\u8d21\u732e\u4e3a\n$$\n\\max\\{A, u_i\\}\n$$\n\u5de6\u8fb9\u754c\u4e3a $i + m - 2 = k$\uff08\u521a\u597d $A$ \u8e29\u5230\u539f\u6765 $k + 1$ \u7684\u4f4d\u7f6e\uff09\n\n\u6240\u4ee5 $i = k - m + 2$\u3002\n\n\u53f3\u8fb9\u754c\u540c\u7406\uff0c$i = k + 1$\u3002\n\n\u6240\u4ee5\u8d21\u732e\u4e3a\uff1a\n$$\nans_4 = \\sum _ {i = k - m + 2} ^ {k + 1} \\max\\{A, u _ i\\}\n$$\n \u6240\u4ee5\u52a0\u5165 $A$ \u7684\u6700\u7ec8\u7b54\u6848\u4e3a\uff1a\n$$\nans' = ans _ 2 + ans _ 4 + ans _3\n$$\n\u5373\n$$\nans' = \\sum _ {i = 1} ^ {k - m + 1} s_i + \\sum _ {i = k - m + 2} ^ {k + 1} \\max\\{A, u _ i\\} + \\sum _ {i = k + 1} ^ {n - m + 1} s_i\n$$\n\u6b64\u65f6\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u6c42\u51fa $s$ \u5373 $u$\uff08\u9700\u8981\u5148\u8fdb\u884c $\\max$ \u64cd\u4f5c\uff09\u7684\u524d\u7f00\u548c\uff0c$O(n) \\times O(1)$ \u679a\u4e3e\u6c42\u89e3 $ans'$\u3002\n\n\u4f46\u662f\uff0c\u5f0f\u5b50\u6709\u70b9\u4e71\u3002\n\n\u5c06 $ans' - ans$\uff0c\u5f97\u5230\u52a0\u5165 $A$ \u7684\u8d21\u732e\uff1a\n$$\nans'' = ans' - ans = \\sum _ {i = k - m + 2} ^ {k + 1} \\max\\{A, u _ i\\} - \\sum _ {i = k - m + 2} ^ {k} s _ i\n$$\n\u4e8e\u662f\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7528 `std::vector` \u5b9e\u73b0\u7684\u8d85\u5927\u5e38\u6570 code\uff1a\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <deque>\n\n// monotony_queue \u5373 \u5355\u8c03\u961f\u5217\nstd::deque<std::pair<int, int> > dq;\nint push_back(int id, int x, int m) {\n    while (!dq.empty() && dq.back().second <= x) dq.pop_back();\n    dq.push_back({id, x});\n    while (!dq.empty() && dq.front().first <= id - m) dq.pop_front();\n    return dq.front().second;\n}\nstd::vector<int> monotony_queue(std::vector<int> v, int m) {\n    // init\n    dq.clear();\n    std::vector<int> ans;\n\n    // main\n    for (int i = 0; i < m - 1; i++) push_back(i, v[i], m);\n    for (int i = m - 1; i < v.size(); i++) {\n        ans.push_back(push_back(i, v[i], m));\n    }\n    return ans;\n}\n\n#define max(a, b) ((a) > (b) ? (a) : (b))\n#define min(a, b) ((a) < (b) ? (a) : (b))\n\nint main() {\n    static std::vector<int> v, s, u;\n    int n, m, A, x;\n\n    // input\n    scanf(\"%d%d%d\", &n, &m, &A);\n    for (int i = 0; i < n; i++) {\n        scanf(\"%d\", &x);\n        v.push_back(x);\n    }\n\n    // init s, u\n    s = monotony_queue(v, m);\n    u = monotony_queue(v, m - 1);\n\n    u[0] = max(u[0], A);\n    for (int i = 1; i < u.size(); i++) {\n        u[i] = max(u[i], A);\n        u[i] += u[i - 1];\n    }\n    u.insert(u.begin(), 0);\n\n    for (int i = 1; i < s.size(); i++) {\n        s[i] += s[i - 1];\n    }\n    s.insert(s.begin(), 0);\n\n    int maxn = -998244353; // ans''\n    for (int k = 1; k <= n; k++) { // \u8fd9\u91cc\u8bb0\u5f97\u7b97\u5168 k\uff0c\u5426\u5219\u4f1a WA\n        int l = max(0, k - m + 1);\n        int r = min(n - m + 1, k);\n        maxn = max(maxn, u[r + 1] - u[l] - s[r] + s[l]);\n    }\n    maxn += *s.rbegin(); // Don't forget add ans\n    printf(\"%d\\n\", maxn); // ans'\n    return 0;\n}\n```\n\n",
        "postTime": 1655295018,
        "uid": 414231,
        "name": "Lotuses",
        "ccfLevel": 0,
        "title": "P8102 Cow Insertion Solution"
    }
]