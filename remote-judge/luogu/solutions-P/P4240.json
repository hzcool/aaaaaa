[
    {
        "content": "$\\Longrightarrow\\Longrightarrow\\Longrightarrow$**[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/y2823774827y/p/10235949.html)**\n\n## \u9898\u76ee\n[P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.org/problemnew/show/P4240)\n\n\u795e\u4ed9\u9898$emmm$\n\n## \u524d\u7f6e\n\n\u9996\u5148\u6709\u4e00\u4e2a\u5f88\u795e\u5947\u7684\u6027\u8d28\uff1a\n\n$\\varphi(ij)=\\dfrac{\\varphi(i)\\varphi(j)gcd(i,j)}{\\varphi(gcd(i,j))}$\n\n\u8bc1\u660e\uff1a\n\n$$\\varphi(i)\\varphi(j) =i\\prod\\limits_{p|i}\\frac{p-1}{p}j\\prod\\limits_{p|j}\\frac{p-1}{p}$$\n\n\n$$~~~~~~~~~~~~~~~~~~~~~= ij\\prod\\limits_{p|ij}\\frac{p-1}{p}\\prod\\limits_{q|gcd(i,j)}\\frac{p-1}{p}$$\n\n$$\\therefore \\varphi(i)\\varphi(j)gcd(i,j)=\\varphi(ij)\\varphi(gcd(i,j))$$\n\n## \u5177\u4f53\u505a\u6cd5\n\n\u6c42$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m\\varphi(i,j)$\n\n\u6211\u4eec\u6700\u7ec8\u662f\u80fd\u5f97\u5230\uff1a$$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m}\\varphi(ij)=\\sum\\limits_{T=1}^n\\sum\\limits_{k|T}\\mu(\\frac{T}{k})\\frac{k}{\\varphi(k)}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\varphi(iT)\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor}\\varphi(jT)$$\n\n\u7f51\u4e0a\u597d\u50cf\u5f88\u591a\u4eba\u7684\u8bc1\u660e\u90fd\u6709\u4e9b\u9519\u8bef\n\n\u8bc1\u660e\uff1a\n\n$$Ans=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m}\\varphi(ij)$$\n\n$$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\sum\\limits_{i=1}^n \\sum\\limits_{j=1}^m \\varphi(i)\\varphi(j)\\frac{gcd(i,j)}{\\varphi(gcd(i,j))}$$\n$$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m\\varphi(i)\\varphi(j)\\frac{d}{\\varphi(d)}[gcd(i,j)=d]$$\n\n$$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(id)\\varphi(jd)\\frac{d}{\\varphi(d)}[gcd(i,j)=1]$$\n$$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(id)\\varphi(jd)\\frac{d}{\\varphi(d)}\\sum\\limits_{k|i,k|j}\\mu(k)$$\n$$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\sum\\limits_{d=1}^n\\frac{d}{\\varphi(d)}\\sum\\limits_{k=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(k)\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{dk}\\rfloor}\\varphi(idk)\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{dk}\\rfloor}\\varphi(jdk)$$\n$$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=\\sum\\limits_{T=1}^n\\sum\\limits_{k|T}\\mu(\\frac{T}{k})\\frac{k}{\\varphi(k)}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\varphi(iT)\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor}\\varphi(jT)$$\n\n\u770b\u6211\u4eec\u6700\u7ec8\u5f97\u5230\u7684\u5f0f\u5b50\uff0c\u591a\u6b21\u67e5\u8be2\u5b8c\u5168\u5728\u7ebf\u505a\uff0c\u53c2\u6570\u8fd9\u4e48\u591a\u65f6\u95f4\u80af\u5b9a\u627f\u53d7\u4e0d\u4f4f\n\n$\\sum\\limits_{k|T}\\mu(\\frac{T}{k})\\frac{k}{\\varphi(k)}$\u8bbe\u6709\u51fd\u6570$F(x)=\\sum\\limits_{k|x}\\mu(\\frac{x}{k})\\frac{k}{\\varphi(k)}$\u518d\u666e\u901a\u4e0d\u8fc7\u5c31\u4e0d\u591a\u8bb2\u4e86\n\n$\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\varphi(iT)$\u53c2\u6570\u6709\u4e24\u4e2a\uff0c\u8bbe\u6709\u51fd\u6570$G(y,x)=\\sum\\limits_{i=1}^{x}\\varphi(iy)$\n\n\u663e\u7136$G(y,x)=G(y,x-1)+\\varphi(xy)$\n\n\u6574\u4e2a\u5f0f\u5b50\u8bbe\u4e3a\u51fd\u6570$S(y,z,x)=\\sum\\limits_{T=1}^x\\sum\\limits_{k|T}\\mu(\\frac{T}{k})\\frac{k}{\\varphi(k)}\\sum\\limits_{i=1}^{y}\\varphi(iT)\\sum\\limits_{j=1}^{z}\\varphi(jT)$\n\n\u663e\u7136$S(y,z,x)=S(y,z,x-1)+F[x]*G(x,y)*G(x,z)$\n\n$F(x)(x<=n),G(y,x)(x<=n,y<=B),S(y,z,x)(x<=n,y,z<=B)$\n\nB\u662f\u81ea\u5df1\u53d6\u7684\u4efb\u610f\u53c2\u6570\uff0c\u6216\u8bb8\u4f60\u4f1a\u60f3$\\frac{n}{T}>B$\u600e\u4e48\u529e\uff0c$\\Rightarrow T<\\frac{n}{B}$\uff0c\u8fd9\u90e8\u5206\u66b4\u529b\u7b97\uff0c\u540e\u9762\u5206\u5757\n\n```cpp\n#include<cstring>\n#include<iostream>\n#include<cstdio>\n#include<string>\n#include<algorithm>\n#include<vector>\nusing namespace std;\ntypedef long long LL;\nconst int B=35;\nconst int maxn=1e5+9;\nconst LL p=998244353;\ninline int Read(){\n    int x(0),f(1); char c=getchar();\n    while(c<'0'||c>'9'){\n        if(c=='-') f=-1; c=getchar();\n    }\n    while(c>='0'&&c<='9')\n        x=(x<<3)+(x<<1)+c-'0',c=getchar();\n    return x*f;\n}\nbool visit[maxn];\nint mu[maxn],phi[maxn],prime[maxn];\nint *G[maxn],*S[B+1][B+1],F[maxn];\nint inv[maxn];\n\ninline void First(LL N){\n    mu[1]=phi[1]=inv[1]=1;\n    int tot(0);\n    for(int i=2;i<=N;++i){\n        if(!visit[i]){\n            prime[++tot]=i,\n            mu[i]=-1,\n            phi[i]=i-1;\n        }\n        for(int j=1;j<=tot&&i*prime[j]<=N;++j){\n            visit[i*prime[j]]=true;\n            if(i%prime[j]==0){\n                phi[i*prime[j]]=phi[i]*prime[j];\n                break;\n            }else{\n                phi[i*prime[j]]=phi[i]*phi[prime[j]],\n                mu[i*prime[j]]=-mu[i];\n            }\n        }\n    }\n    for(int i=2;i<=N;++i)\n        inv[i]=p-1ll*p/i*inv[p%i]%p;\n    for(int i=1;i<=N;++i)\n        for(int j=1;j*i<=N;++j)\n            F[i*j]=1ll*(1ll*F[i*j]+1ll*i*inv[phi[i]]%p*mu[j]%p)%p;\n    for(int i=1;i<=N;++i){\n        G[i]=new int [N/i+1];\n        G[i][0]=0;\n        for(int j=1;j<=N/i;++j)\n            G[i][j]=1ll*(1ll*G[i][j-1]+1ll*phi[j*i])%p;\n    }\n    for(int j=1;j<=B;++j)\n        for(int k=1;k<=B;++k){\n        \tint len(N/(max(j,k)));\n        \tS[j][k]=new int [len+1];\n        \tS[j][k][0]=0;\n        \tfor(int i=1;i<=len;++i)\n        \t\tS[j][k][i]=1ll*(1ll*S[j][k][i-1]+1ll*F[i]*G[i][j]%p*G[i][k]%p)%p;\n        }\n}\ninline LL Solve(int n,int m){\n    if(n>m)\n        swap(n,m);\n    LL ans(0);\n    for(int i=1;i<=m/B;++i)\n        ans=(ans+1ll*F[i]*G[i][n/i]%p*G[i][m/i]%p)%p;\n    for(int l=m/B+1,r;l<=n;l=r+1){\n        r=min(n/(n/l),m/(m/l));\n        ans=(ans+1ll*(S[n/l][m/l][r]-S[n/l][m/l][l-1]+p)%p)%p;\n    }\n    return ans;\n}\nint main(){\n    int T=Read();\n    First(100000);\n    while(T--){\n        int n(Read()),m(Read());\n        printf(\"%lld\\n\",Solve(n,m));\n    }\n    return 0;\n}/*\n3\n1 1\n2 2\n3 3\n\n1 5 19\n*/\n```",
        "postTime": 1546920358,
        "uid": 88804,
        "name": "y2823774827y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "## \u8bf7\u52a1\u5fc5\u5728\u535a\u5ba2\u4e2d\u67e5\u770b\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u4e0e\u675c\u6559\u7b5b\u8be6\u89e3\u53ef\u4ee5\u89c1[\u6211\u7684\u535a\u5ba2](https://www.luogu.com.cn/blog/YLWang/post-xue-xi-bi-ji-mu-bi-wu-si-fan-yan)\u3002\u975e\u5e38\u8be6\u7ec6\uff0c\u5927\u5bb6\u53ef\u4ee5\u6765\u56f4\u89c2\u56f4\u89c2\u3002\n\n--- \n## [P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240)\n\n$$\n\\begin{aligned} \n\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m} \\varphi(ij)\n\n&= \\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m} \\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}\n\n\\\\&= \\sum\\limits_{d=1}^{n}\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m} \\frac{\\varphi(i)\\varphi(j)d[\\gcd(i,j)=d]}{\\varphi(d)}\n\n\\\\&= \\sum\\limits_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m }\\varphi(i)\\varphi(j)[\\gcd(i,j)=d]\n\n\\\\&= \\sum\\limits_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum_{t=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(t)\\cdot \\sum\\limits_{i=1}^{\\lfloor\\frac{n}{dt}\\rfloor }\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{dt}\\rfloor }\\varphi(idt)\\varphi(jdt)\n\n\\\\&= \\sum\\limits_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum_{t=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(t)\\cdot \\sum\\limits_{i=1}^{\\lfloor\\frac{n}{dt}\\rfloor }\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{dt}\\rfloor }\\varphi(idt)\\varphi(jdt)\n\n\\\\&= \\sum\\limits_{k=1}^{n}\\sum\\limits_{d|k} \\frac{d\\cdot\\mu(\\frac{k}{d})}{\\varphi(d)} \\sum\\limits_{i=1}^{\\lfloor\\frac{n}{k}\\rfloor }\\varphi(ik)\\sum\\limits_{j=1}^{\\lfloor\\frac{m}{k}\\rfloor }\\varphi(jk) \n\n\\end{aligned}\n$$\n\n\u4ee4 \n$$\n\\begin{aligned}\nf(n) = \\sum\\limits_{d|n} \\frac{d\\cdot\\mu(\\frac{k}{d})}{\\varphi(d)}\n\\end{aligned}\n$$\n\n\u5219\u53ef\u4ee5\u5957\u8def\u5730\u679a\u4e3e\u500d\u6570\u9884\u5904\u7406\u51fa\u6765\u3002\u8fd9\u4e00\u90e8\u5206\u7684\u590d\u6742\u5ea6\u662f $O(n \\operatorname{ln} n)$.\n\n\u518d\u4ee4\n$$\n\\begin{aligned}\ng(k, n) = \\sum\\limits_{i=1}^{n}\\varphi(ik)\n\\end{aligned}\n$$\n\n\u6211\u4eec\u6709\u9012\u63a8\u5f0f\n$$\n\\begin{aligned}\ng(i, j) = g(i, j-1) +\\varphi(ij)\n\\end{aligned}\n$$\n\n\u56e0\u4e3a$k\\cdot n \\leqslant 10^5$, \u6240\u4ee5\u8fd9\u4e00\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e3a $O(n \\operatorname{ln} n)$.\n\n\u6211\u4eec\u628a\u539f\u5f0f\u7528 $f$ \u4e0e $g$ \u4ee3\u5165\u3002\n\n$$\n\\begin{aligned} \n\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m} \\varphi(ij)\n\n&=\\sum\\limits_{k=1}^{n}f(k)\\cdot g(k, \\lfloor\\frac{n}{k}\\rfloor )\\cdot g(k,\\lfloor\\frac{m}{k}\\rfloor )\n\n\\end{aligned}\n$$\n\n\u7136\u540e\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u65f6\u5019 $g$ \u91cc\u9762\u662f\u5e26 $k$ \u7684\u4e0d\u80fd\u6574\u9664\u5206\u5757\u3002\n\n\u8fd8\u662f\u5f88\u5957\u8def\u7684\u628a\u6574\u4e2a\u5f0f\u5b50\u7528\u53c2\u6570\u8868\u793a\u51fa\u6765\u3002\u4ee4\uff1a\n$$\n\\begin{aligned} \n\nt(a, b,n) = \\sum\\limits_{k=1}^{n}f(k)\\cdot g(k, a)\\cdot g(k, b)\n\n\\end{aligned}\n$$\n\n\u90a3\u4e48\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u4e00\u4e2a\u5dee\u5206\u5f62\u5f0f\uff08\u5176\u5b9e $l$ \u548c $r$ \u662f\u6574\u9664\u5206\u5757\u7684\u4e24\u7aef\u3002\uff09\n$$\n\\begin{aligned} \n\n\\sum\\limits_{\\lfloor\\frac{n}{l}\\rfloor = \\lfloor\\frac{n}{r}\\rfloor \\& \\lfloor\\frac{m}{l}\\rfloor = \\lfloor\\frac{m}{r}\\rfloor} t(\\lfloor\\frac{n}{r}\\rfloor, \\lfloor\\frac{m}{r}\\rfloor,r) - t(\\lfloor\\frac{n}{r}\\rfloor, \\lfloor\\frac{m}{r}\\rfloor,l)\n\n\\end{aligned}\n$$\n\u90a3\u4e48\u95ee\u9898\u5c31\u662f\u5982\u4f55\u6c42\u51fa $t$ \u6570\u7ec4\u4e86\u3002\u5bb9\u6613\u53d1\u73b0\u76f4\u63a5\u5168\u90e8\u9884\u5904\u7406\u4f1a T \u5230\u539f\u5730\u5347\u5929\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u9884\u5904\u7406\u548c\u67e5\u8be2\u7684\u5e73\u8861\uff0c\u6240\u4ee5\u5f15\u51fa\u6839\u53f7\u5206\u6cbb\u90a3\u4e00\u5957\u7406\u8bba\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u53d1\u73b0\uff0c$l$ \u548c $r$ \u8d8a\u5927\uff0c\u76f8\u540c\u4e00\u6bb5\u957f\u5ea6\u5c31\u8d8a\u5927\uff0c\u66b4\u529b\u7684\u590d\u6742\u5ea6\u5c31\u76f8\u5bf9\u8d8a\u52a3\uff08\u610f\u601d\u5c31\u662f\u7528\u6574\u9664\u5206\u5757\u5904\u7406\u8d8a\u5feb\uff09\u3002\u6211\u4eec\u8003\u8651\u5728 $l$ \u548c $r$ \u8f83\u5c0f\u7684\u65f6\u5019\u66b4\u529b\uff0c\u5426\u5219\u9884\u5904\u7406\u3002\n\n\n\u6211\u4eec\u8bbe\u4e00\u4e2a\u9608\u503c $S$\uff0c\u5c06\u6240\u6709 $t(1,1,1) - t(S,S,n)$ \u7684 $t$ \u503c\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u9884\u5904\u7406\u7684\u5f0f\u5b50\u5c31\u662f \n\n$$ \nt(j,k,i)=t(j,k,i-1) + f(i)\\cdot g(i, j)\\cdot g(i, k)\n$$\n\n\n\u7136\u540e\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5bf9\u4e8e\u6240\u6709 $\\lfloor\\dfrac{n}{r}\\rfloor \\leqslant S$ \u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2\u3002\u5426\u5219\uff0c\u53ef\u5f97\u77e5 $ r \\leqslant \\lfloor\\dfrac{n}{S}\\rfloor$\u3002 \u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u66b4\u529b\u8ba1\u7b97\u4e86.\n\n\u603b\u7684\u590d\u6742\u5ea6 $O(n \\ln n + nB^2 + T(\\sqrt{n} +\\dfrac{n}{B}))$\u3002 \u81f3\u4e8e\u5982\u4f55\u8c03\u6574 $B$ \u53c2\u7167 Ynoi\u3002\n\n\n\u8fd9\u4e2a\u9898\u771f\u7684\u662f\u4e00\u4e2a\u597d\u9898\uff0c\u53ef\u8c13\u662f\u63a8\u5f0f\u5b50\u4e0e\u5e73\u8861\u601d\u60f3\u7ed3\u5408\u7684\u6781\u81f4\u3002\n\n\u4ee3\u7801\u94fe\u63a5\uff1ahttps://www.luogu.com.cn/paste/fk563xya",
        "postTime": 1584757616,
        "uid": 55078,
        "name": "YLWang",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "\u795e\u4ed9\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u3002\n\n\u6709\u4e2a\u7ed3\u8bba\u3002\n\n$\\varphi(i\\times j) = \\huge{\\left(\\frac{\\varphi(i) \\times \\varphi(j) \\times \\gcd(i,j)}{\\varphi(\\gcd(i,j))}\\right)}$\n\n\u9996\u5148\u5047\u8bbe $n\\leq m$\n\n$\\sum_i \\sum_j \\varphi(i\\times j) = \\sum_i \\sum_j {\\large \\left(\\frac{\\varphi(i) \\times \\varphi(j) \\times \\gcd(i,j)}{\\varphi(\\gcd(i,j))}\\right)}$\n\n\u679a\u4e3e$\\gcd$\uff01\n\n$\\sum_d  \\sum_i \\sum_j \\frac{\\varphi(i) \\times \\varphi(j) \\times \\gcd(i,j)}{\\varphi(\\gcd(i,j))}[\\gcd(i,j) = d]$\n\n\u7136\u540e\n$\\sum_d {\\left(\\frac{d}{\\varphi(d)}\\right)} \\sum_i^{\\frac{n}{d}} \\sum_j^{\\frac{m}{d}}\\varphi(i\\times d) \\varphi(j\\times d)[\\gcd(i,j) = 1]$\n\n\u53d1\u73b0 $\\gcd$ \u53ef\u4ee5\u7528 $\\mu$ \u641e\n\n$\\sum_{d|x} \\mu(d) = [x=1]$\n\n$\\sum_d {\\left(\\frac{d}{\\varphi(d)}\\right)}\\sum_i^{\\frac{n}{d}} \\sum_j^{\\frac{m}{d}}\\varphi(i\\times d) \\varphi(j\\times d){\\left(\\sum_{k|\\gcd(i,j)} \\mu(k)\\right)}$\n\n\n\u7136\u540e\u987a\u624b\u679a\u4e3e\u4e00\u6ce2 $k$\uff01\n\n$\\sum_d {\\left(\\frac{d}{\\varphi(d)}\\right)} \\sum_{k}^{\\frac{n}{d}}\\mu(k) \\sum_{i}^{\\frac{n}{kd}}\\sum_j^{\\frac{m}{kd}}\\varphi(i\\times  kd) \\times \\varphi(j \\times kd)$\n\n\u6539\u53d8\u679a\u4e3e\u987a\u5e8f\uff0c\u4ee4 $T=k\\times d$\n\n$\\sum_T \\sum_{d|T} \\mu(\\frac{T}{d}) \\frac{d}{\\varphi(d)} \\sum_i^{\\frac{n}{T}} \\sum_j^{\\frac{m}{T}} \\varphi(i\\times T) \\times \\varphi(j\\times T)$\n\n\n\u7136\u540e\u6211\u4eec\u641e\u641e $F(T) = \\sum_T \\sum_{d|T} \\mu(\\frac{T}{d}) \\frac{d}{\\varphi(d)}$\n\n$(T, n, m) = \\sum_i^{\\frac{n}{T}} \\sum_j^{\\frac{m}{T}} \\varphi(i\\times T) \\times \\varphi(j\\times T)$\n\n\u53d1\u73b0\u5176\u5b9e\u53ef\u4ee5\u4ee4 $G(x, y) = \\sum_i^x \\varphi(i\\times y)$\n\n$G(x, y) = G(x - 1, y) +  \\varphi(xy)$\n\n\u7136\u540e\u6574\u4e2a\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86 $\\sum_T F(T)\\times G(\\frac{n}{T},T) \\times G(\\frac{m}{T},T)$\n\n$G$ \u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u7b97\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u73a9\u610f\u662f\u8c03\u548c\u7ea7\u6570\u7684\u3002\n\n\u4f46\u662f\u53d1\u73b0\u8fd9\u4e2a\u7b54\u6848\u6570\u7ec4\u4e0d\u80fd\u641e\u5f97\u592a\u5927\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u6839\u53f7\u5206\u6cbb\uff0c$\\leq B$ \u7684\u90e8\u5206\u66b4\u529b\uff0c$\\geq B+1$ \u7684\u6574\u9664\u5206\u5757\u3002\n\n",
        "postTime": 1590930595,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "[\u5b89\u5229\u4e00\u6ce2cnblogs](https://www.cnblogs.com/oier/p/10307241.html)\n\n\u9898\u610f\uff1a\u6c42\u51fa$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)$\uff0c\u5bf9998244353\u53d6\u6a21\n\n\u591a\u7ec4\u6570\u636e\uff0c$T\\le 10^4,n,m\\le 10^5$\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a$\\varphi(ij)=\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$\n\n\u8bc1\u660e\uff1a~~\u6211\u662f\u53e3\u80e1\u5462\u8fd8\u662f\u597d\u597d\u8bc1\u5462~~\u8fd8\u662f\u53e3\u80e1\u5427\n\n\u6309\u7167\u6b27\u62c9\u51fd\u6570\u7684\u8ba1\u7b97\u5f0f\u5c55\u5f00\uff0c\u4f1a\u53d1\u73b0\uff0c\u5de6\u8fb9\u662f$ij\\prod_{p|i \\mathrm{\\color{red}or}p|j}\\frac{p-1}p$\n\n\u53f3\u8fb9\u662f$\\frac{i\\prod_{p|i}\\frac{p-1}pj\\prod_{p|j}\\frac{p-1}p\\gcd(i,j)}{\\gcd(i,j)\\prod_{p|i\\mathrm{\\color{red}and}p|j}\\frac{p-1}p}$\n\n\u663e\u7136\uff0c\u6839\u636e\u5bb9\u65a5\u539f\u7406\uff0c\u4e24\u8fb9\u662f\u76f8\u7b49\u7684\n\n\u7136\u540e\u63a8\u5f0f\u5b50\n\n$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)$\n\n$=\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(ij))}$\n\n$=\\sum_{p=1}^n\\frac p{\\varphi(p)}\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)[\\gcd(i,j)=p]$\n\n$=\\sum_{p=1}^n\\frac p{\\varphi(p)}\\sum_{i=1}^{n/p}\\sum_{j=1}^{m/p}\\varphi(ip)\\varphi(jp)[\\gcd(i,j)=1]$\n\n$=\\sum_{p=1}^n\\frac p{\\varphi(p)}\\sum_{i=1}^{n/p}\\sum_{j=1}^{m/p}\\varphi(ip)\\varphi(jp)\\sum_{d|i,d|j}\\mu(d)$\n\n$=\\sum_{p=1}^n\\frac p{\\varphi(p)}\\sum_{d=1}^n\\mu(d)\\sum_{i=1}^{n/dp}\\sum_{j=1}^{m/dp}\\varphi(idp)\\varphi(jdp)$\n\n$=\\sum_{q=1}^n\\sum_{p|q}\\frac{p\\mu(\\frac qp)}{\\varphi(p)}\\sum_{i=1}^{n/q}\\sum_{j=1}^{m/q}\\varphi(iq)\\varphi(jq)$\n\n$=\\sum_{q=1}^n\\left(\\sum_{p|q}\\frac{p\\mu(\\frac qp)}{\\varphi(p)}\\right)\\left(\\sum_{i=1}^{n/q}\\varphi(iq)\\right)\\left(\\sum_{i=1}^{m/q}\\varphi(iq)\\right)$\n\n\u524d\u9762\u8fd9\u4e00\u90e8\u5206\u597d\u5904\u7406--$O(n\\log n)$\u679a\u4e3e\u500d\u6570\u3002\u540e\u9762\uff1f\u6309\u7167\u5957\u8def\uff1f\u6570\u8bba\u5206\u5757\uff1f\u600e\u4e48\u5206\uff1f\uff1f\uff1f\uff1f\n\n~~\u89c2\u5bdf\u4e86\u4f60\u8c37\u9898\u89e3\u540e\uff0c\u7ec8\u4e8e\u61c2\u4e86~~\n\n\u8bbe$sum(q)=\\sum_{p|q}\\frac{p\\mu(\\frac qp)}{\\varphi(p)}$\uff0c\u663e\u7136\u53ef\u4ee5\u5728$O(n\\log n)$\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5904\u7406\u51fa\u6765\u3002\n\n\u8bbe$g(x,y)=\\sum_{i=1}^x\\varphi(iy)$\uff0c\u663e\u7136\u6709\u9012\u63a8\u5f0f$g(x,y)=g(x-1,y)+\\varphi(xy)$\u3002\n\n\u7531\u4e8e$xy<=n$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a$x$\uff0c\u6709$\\frac nx$\u7684\u6570\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u7533\u8bf7\u5185\u5b58\uff0c\u5728$O(n\\log n)$\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u7a7a\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa$g$\u6570\u7ec4\u3002\n\n\u8bbe$T(n,a,b)=\\sum_{q=1}^n\\left(\\sum_{p|q}\\frac{p\\mu(\\frac qp)}{\\varphi(p)}\\right)\\left(\\sum_{i=1}^{a}\\varphi(iq)\\right)\\left(\\sum_{i=1}^{b}\\varphi(iq)\\right)=\\sum_{q=1}^nsum(q)g(a,q)g(b,q)$\n\n\u663e\u7136T\u7684\u9012\u63a8\u5f0f\u4e3a$T(n,a,b)=T(n-1,a,b)+sum(n)g(a,n)g(b,n)$\n\n\u6839\u636e\u6570\u8bba\u5206\u5757\u90a3\u5957\u7406\u8bba\uff0c\u5bf9\u4e8e\u4e00\u4e2a$n/q$\u548c$m/q$\u76f8\u540c\u7684$q$\u7684\u533a\u95f4\uff0c\u5f53$n/q=a,m/q=b$\u65f6\uff0c\u8fd9\u4e00\u533a\u95f4\u7684$ans=T(r,a,b)-T(l-1,a,b)$\uff0cr\u548cl\u662f\u8fd9\u4e00\u533a\u95f4\u5185\u7684\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\n\n\u6211\u4eec\u8003\u8651\u9884\u5904\u7406$n*B*B$\u8303\u56f4\u7684\u7b54\u6848\uff0cB\u662f\u6211\u4eec\u94a6\u5b9a\u7684\u4e00\u4e2a\u6570\u5b57\uff0cT\u6570\u7ec4\u5f00\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a$O(nB^2)$\uff08\u5b9e\u9645\u4e0a\u7531\u4e8e$a*n,b*n\\le 10^5$\u7684\u9650\u5236\uff0c\u5e94\u8be5\u5f00\u4e0d\u5230$O(nB^2)$\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u6211\u4eec\u53ea\u80fd\u5728$n/q\\le B$\u65f6\u5019\u8fdb\u884c\u6570\u8bba\u5206\u5757\u64cd\u4f5c\u901a\u8fc7$T$\u6570\u7ec4\u8ba1\u7b97\u7b54\u6848\uff0c\u590d\u6742\u5ea6\u6839\u636e\u6570\u8bba\u5206\u5757\u90a3\u5957\u7406\u8bba\u4e3a$O(\\sqrt n)$\u3002\n\n\u5bf9\u4e8e$n/q>B$\u7684\u90e8\u5206\uff0c\u6709$q<n/B$\uff0c\u66b4\u529b\u679a\u4e3e$q$\uff0c\u901a\u8fc7$g$\u6570\u7ec4\u8ba1\u7b97\u7b54\u6848\uff0c\u8fd9\u4e00\u90e8\u5206\u5355\u6b21\u8ba1\u7b97\u7684\u590d\u6742\u5ea6\u4e3a$O(n/B)$\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a$O(n\\log n+nB^2+T(\\sqrt n+n/B))$\u3002\u5b9e\u6d4b\uff0cB\u5f00\u523050\u5de6\u53f3\u8dd1\u7684\u5feb\u4e00\u70b9\uff0c\u4e14\u5185\u5b58\u5360\u7528\u8d85\u5c0f\u3002\n\n\u4e0b\u9762\u662f\u4e71\u4e03\u516b\u7cdf\u7684\u4ee3\u7801= =\n\n\u6ce8\u610f\u8bb2\u6587\u660e\uff0cnew\u6765\u7684\u5185\u5b58\u8981\u4e3b\u52a8\u56de\u6536\u5783\u573e\n\n\u6ce8\u610f\u53d6\u6a21\uff08\u8fd9\u9898\u5982\u679c\u5199\u7684\u590d\u6742\u5ea6\u6ca1\u9519\u7684\u8bdd\u4e0d\u5361\u5e38\uff0c\u5f00#define int long long\u4e5f\u662f\u6ca1\u95ee\u9898\u7684\n\n```cpp\n#include <cstdio>\n#include <functional>\nusing namespace std;\n\nconst int p = 998244353;\nconst int b = 50;\nbool vis[100010];\nint prime[100010], tot, fuck = 100000;\nint mu[100010], phi[100010], invphi[100010];\nint sum[100010];\nint *g[100010], *t[100][100]; //\u6ce8\u610f\u8fd9\u91cct\u6570\u7ec4\u4e0b\u6807\u662f[2][3][1]\n\nint qpow(int x, int y)\n{\n\tint res = 1;\n\tfor (x %= p; y > 0; x = x * (long long)x % p, y >>= 1) if (y & 1) res = res * (long long)x % p;\n\treturn res;\n}\n\nint main()\n{\n\t//\u7ebf\u6027\u7b5bphi,mu\uff0c\u9884\u5904\u7406\u524d\u9762\u7684\u90e8\u5206\n\tphi[1] = mu[1] = invphi[1] = 1;\n\tfor (int i = 2; i <= fuck; i++)\n\t{\n\t\tif (vis[i] == false) prime[++tot] = i, phi[i] = i + (mu[i] = -1);\n\t\tfor (int j = 1; j <= tot && i * prime[j] <= fuck; j++)\n\t\t{\n\t\t\tvis[i * prime[j]] = true;\n\t\t\tif (i % prime[j] == 0) { phi[i * prime[j]] = phi[i] * prime[j]; break; }\n\t\t\tphi[i * prime[j]] = phi[i] * (prime[j] - 1);\n\t\t\tmu[i * prime[j]] = -mu[i];\n\t\t}\n\t\tinvphi[i] = qpow(phi[i], p - 2);\n\t\tif (phi[i] * (long long)invphi[i] % p != 1) { return -233; printf(\"cnm\\n\"); }\n\t}\n\tfor (int pp = 1; pp <= fuck; pp++)\n\t\tfor (int q = pp, d = 1; q <= fuck; q += pp, d++)\n\t\t\tsum[q] = (sum[q] + pp * (long long)invphi[pp] % p * mu[d]) % p, sum[q] += (sum[q] < 0 ? p : 0);\n\n\t//\u5904\u7406g\u6570\u7ec4\n\tfor (int i = 1; i <= fuck; i++)\n\t{\n\t\tg[i] = new int[(fuck / i) + 1], g[i][0] = 0;\n\t\tfor (int j = 1, sb = fuck / i; j <= sb; j++)\n\t\t\tg[i][j] = (g[i][j - 1] + phi[i * j]) % p;\n\t}\n\t\n\t//\u5904\u7406t\u6570\u7ec4 \u6ce8\u610f\u6709\u7b2c\u4e00\u7ef4<=\u7b2c\u4e8c\u7ef4\uff0c\u56e0\u4e3a\u4e0b\u9762\u6211\u4eec\u5f3a\u5236n<=m\u4e86\n\tfor (int j = 1; j <= b; j++)\n\t\tfor (int k = j; k <= b; k++)\n\t\t{\n\t\t\tint len = fuck / max(j, k);\n\t\t\tt[j][k] = new int[len + 1], t[j][k][0] = 0;\n\t\t\tfor (int i = 1; i <= len; i++)\n\t\t\t\tt[j][k][i] = (t[j][k][i - 1] + sum[i] * (long long)g[i][j] % p * g[i][k] % p) % p;\n\t\t}\n\t\n\t//\u5904\u7406\u8be2\u95ee\n\tint tat;\n\tscanf(\"%d\", &tat);\n\twhile (tat --> 0)\n\t{\n\t\tint n, m, res = 0;\n\t\tscanf(\"%d%d\", &n, &m);\n\t\tif (n > m) swap(n, m);\n\t\t//\u5bf9\u4e8en/q>b\u7684\u90e8\u5206\uff0c\u66b4\u529b\uff0c\u901a\u8fc7g\u6570\u7ec4\u548csum\u6570\u7ec4\u8ba1\u7b97\u8ba1\u7b97\n\t\tfor (int i = 1, sb = m / b; i <= sb; i++)\n\t\t\tres = (res + sum[i] * (long long)g[i][n / i] % p * g[i][m / i] % p) % p;\n\t\t//\u5bf9\u4e8en/q<b\u7684\u90e8\u5206\uff0c\u6570\u8bba\u5206\u5757\uff0c\u901a\u8fc7b\u6570\u7ec4\u8ba1\u7b97\n\t\tfor (int i = m / b + 1, j; i <= n; i = j + 1)\n\t\t{\n\t\t\tj = min(n / (n / i), m / (m / i));\n\t\t\tres = (res + t[n / i][m / i][j] - t[n / i][m / i][i - 1]) % p, res += (res < 0 ? p : 0);\n\t\t}\n\t\tprintf(\"%d\\n\", res);\n\t}\n\t\n\t//\u5783\u573e\u56de\u6536\n\tfor (int i = 1; i <= fuck; i++)\n\t\tdelete []g[i], g[i] = 0;\n\tfor (int i = 1; i <= b; i++)\n\t\tfor (int j = i; j <= b; j++)\n\t\t\tdelete[] t[i][j], t[i][j] = 0;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1548207422,
        "uid": 13091,
        "name": "ghj1222",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "\u5927\u610f\uff1a\u6c42$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)\\ mod\\ 998244353$\u3002\n\n\u6bd4\u8f83\u96be\u60f3\u5230\u7684\u6570\u5b66\u9898\u3002\n\n\u6ce8\u610f\u5230\u672c\u9898\u4e3a\u591a\u7ec4\u8be2\u95ee\uff0c\u5e76\u4e14$n$\u3001$m$\u4e0d\u7b97\u5927\uff0c\u6240\u4ee5\u53ef\u4ee5\u60f3\u5230\u7528\u5206\u5757\u6253\u8868\u7684\u65b9\u5f0f\u4f18\u5316\u3002\n\n(\u4e0b\u9762\u7684\u8bf4\u660e\u4e2d$n$\u548c$m$\u7684\u5927\u5c0f\u5173\u7cfb\u4e0d\u91cd\u8981\uff0c\u53ef\u4ee5\u9ed8\u8ba4$n\\leq m$)\n\n\u9996\u5148\u63a8\u516c\u5f0f\uff1a\n\n\u4ee4$gcd(i,j)=\\xi(i,j)$\uff0c\n\u90a3\u4e48\n$\\displaystyle{\\varphi(ij)=\\frac{\\varphi(i)\\varphi(j)\\xi(i,j)}{\\varphi(\\xi(i,j))}}$\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u90a3\u4e48\u539f\u5f0f=$\\displaystyle{\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)=\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\varphi(j)\\xi(i,j)}{\\varphi(\\xi(i,j))}}$\n\n$\\displaystyle=\\sum_{z=1}^n\\frac{z}{\\varphi(z)}\\sum_{z|d}\\mu\\left(\\frac{d}{z}\\right)\\left(\\sum_{d|k}^n\\varphi(k)\\right)\\left(\\sum_{d|k}^m\\varphi(k)\\right)$\n\n$\\displaystyle=\\sum_{d=1}^n\\left(\\sum_{z|d}\\frac{z}{\\varphi(z)}\\mu\\left(\\frac{d}{z}\\right)\\right)\\left(\\sum_{k=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\varphi(dk)\\right)\\left(\\sum_{k=1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor}\\varphi(dk)\\right)$\n\n\u4e0d\u59a8\u8bb0$\\displaystyle G(i,j)=\\sum_{k=1}^i\\varphi(jk)\\ \\ \\ \\ \\ (ij\\leq n)$\n\n\u90a3\u4e48\u539f\u5f0f\u8f6c\u5316\u4e3a\n\n$\\displaystyle\\sum_{d=1}^n\\left(\\sum_{z|d}\\frac{z}{\\varphi(z)}\\mu\\left(\\frac{d}{z}\\right)\\right)G(\\lfloor\\frac{n}{d}\\rfloor,d)G(\\lfloor\\frac{m}{d}\\rfloor,d)$\n\n\u6ce8\u610f\u5230$G$\u6570\u7ec4\u7531\u4e8e$ij\\leq n$\u6240\u4ee5\u5b9e\u9645\u6709\u7528\u7684\u7a7a\u95f4\u53ea\u9700\u8981$O(n)$\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u52a8\u6001\u6570\u7ec4\u7684\u65b9\u5f0f\u5c06$10^5$\u4ee5\u5185\u7684$G$\u6570\u7ec4\u9884\u5904\u7406\u7136\u540e\u5b58\u4e0b\u6765\uff0c\u9884\u5904\u7406\u590d\u6742\u5ea6$O(n\\log n)$\u3002\n\n\u540c\u6837\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684$d$\uff0c$\\displaystyle\\sum_{z|d}\\frac{z}{\\varphi(z)}\\mu\\left(\\frac{d}{z}\\right)$\u4e5f\u662f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u7684\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u600e\u4e48\u8be2\u95ee\u3002\n\n\u719f\u6089\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u9898\u76ee\u7684\u4eba\u5e94\u8be5\u77e5\u9053\uff0c$\\lfloor\\frac{n}{d}\\rfloor$\u8fd9\u6837\u7684\u4e1c\u897f\u7684\u4e0d\u540c\u53d6\u503c\u4e3a$O(\\sqrt n)$\u79cd\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u4e00\u90e8\u5206\u7b54\u6848\uff1a\n\n\u4ee4\n\n$\\displaystyle T(n,i,j)=\\sum_{d=1}^n\\left(\\sum_{z|d}\\frac{z}{\\varphi(z)}\\mu\\left(\\frac{d}{z}\\right)\\right)G(i,d)G(j,d)\\ \\ \\ \\ \\ (i,j\\leq B)$\n\n$B$\u4e3a\u6211\u4eec\u9884\u5904\u7406\u7b54\u6848\u7684\u4e0a\u754c\uff0c\u662f\u5f85\u5b9a\u7684\uff0c\u4e4b\u540e\u6839\u636e\u590d\u6742\u5ea6\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6700\u4f18\u503c\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5728$\\lfloor\\frac{n}{d}\\rfloor=i,\\lfloor\\frac{m}{d}\\rfloor=j$\u65f6\u7684\u7b54\u6848\u5c31\u662f$T(up,i,j)-T(down-1,i,j)$\uff0c$up$\u8868\u793a$\\lfloor\\frac{n}{d}\\rfloor=i,\\lfloor\\frac{m}{d}\\rfloor=j$\u65f6$d$\u7684\u6700\u5927\u503c\uff0c$down$\u8868\u793a$\\lfloor\\frac{n}{d}\\rfloor=i,\\lfloor\\frac{m}{d}\\rfloor=j$\u65f6$d$\u7684\u6700\u5c0f\u503c\uff0c\u8ddf\u90a3\u79cd\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u6a21\u677f\u9898\u7684\u8ba1\u7b97\u524d\u7f00\u548c\u7136\u540e\u5dee\u5206\u5f88\u50cf\u3002\n\n\u4f46\u662f\u7531\u4e8e$T$\u6570\u7ec4\u4e0d\u80fd\u5f00\u592a\u5927\uff0c$T$\u7684\u7a7a\u95f4\u4e3a$O(nB^2)$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u5728$\\lfloor\\frac{n}{d}\\rfloor,\\lfloor\\frac{m}{d}\\rfloor\\leq B$\u65f6\u76f4\u63a5\u8c03\u7528$T$\u6570\u7ec4\uff0c\u6bcf\u6b21\u8be2\u95ee\u5728\u8fd9\u4e00\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e3a$O(\\sqrt n)$\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e$\\lfloor\\frac{n}{d}\\rfloor,\\lfloor\\frac{m}{d}\\rfloor>B$\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u4e00\u5b9a\u6709$d\\leq\\lfloor\\frac{n}{B}\\rfloor$\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u7b97\u51fa\u8fd9\u4e00\u90e8\u5206\u7684\u7b54\u6848\uff0c\u6bcf\u6b21\u8be2\u95ee\u590d\u6742\u5ea6\u4e3a$O(\\lfloor\\frac{n}{B}\\rfloor)$\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u6700\u7ec8\u7684\u590d\u6742\u5ea6\u4e3a$O(n\\log n+nB^2+T(\\sqrt n+\\lfloor\\frac{n}{B}\\rfloor))$\u3002\n\n\u8ba1\u7b97\u4e00\u4e0b\uff0c\u53d1\u73b0$B=T^{\\frac{1}{3}}$\u5de6\u53f3\u7684\u65f6\u5019\u80fd\u53d6\u5230\u8f83\u4f18\u7684\u590d\u6742\u5ea6\uff0c\u7a0d\u5fae\u504f\u5927\u4e00\u70b9\u597d\u50cf\u6bd4\u8f83\u5feb\u4e00\u70b9\u3002\n\n\u4ee3\u7801\u8fd8\u662f\u6bd4\u8f83\u597d\u5199\u7684\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n\n#define M(x) ((x)>=mod?((x)-mod):(x))\n#define For(i,_beg,_end) for(int i=(_beg),i##end=(_end);i<=i##end;++i)\n#define Rep(i,_beg,_end) for(int i=(_beg),i##end=(_end);i>=i##end;--i)\n\ntemplate<typename T>T Max(const T &x,const T &y){return x<y?y:x;}\ntemplate<typename T>T Min(const T &x,const T &y){return x<y?x:y;}\ntemplate<typename T>int chkmax(T &x,const T &y){return x<y?(x=y,1):0;}\ntemplate<typename T>int chkmin(T &x,const T &y){return x>y?(x=y,1):0;}\ntemplate<typename T>void read(T &x){\n    T f=1;char ch=getchar();\n    for(;ch<'0'||ch>'9';ch=getchar())if(ch=='-')f=-1;\n    for(x=0;ch>='0'&&ch<='9';ch=getchar())x=x*10+ch-'0';\n    x*=f;\n}\n\ntypedef long long LL;\nconst int maxn=100010,B=35,mod=998244353;\nint Test,n,m,phi[maxn],mu[maxn],prime[maxn],cnt;\nint *G[maxn],F[maxn],*T[B+1][B+1],inv[maxn];\nbool ok[maxn];\n\nvoid Init(int n){\n    mu[1]=phi[1]=inv[1]=1;\n    For(i,2,n){\n        if(!ok[i]){\n            prime[++cnt]=i;\n            mu[i]=-1;phi[i]=i-1;\n        }\n        for(int j=1;j<=cnt&&i*prime[j]<=n;j++){\n            ok[i*prime[j]]=true;\n            if(i%prime[j]){\n                mu[i*prime[j]]=-mu[i];\n                phi[i*prime[j]]=phi[i]*(prime[j]-1);\n            }\n            else{\n                mu[i*prime[j]]=0;\n                phi[i*prime[j]]=phi[i]*prime[j];\n                break;\n            }\n        }\n    }\n    For(i,2,n) inv[i]=mod-1LL*(mod/i)*inv[mod%i]%mod;\n    For(i,1,n) for(int j=i;j<=n;j+=i)\n        F[j]=M(F[j]+M(1LL*mu[j/i]*i*inv[phi[i]]%mod+mod));\n    For(i,1,n){\n        G[i]=new int [(n/i)+1];G[i][0]=0;\n        For(j,1,n/i) G[i][j]=M(G[i][j-1]+phi[i*j]);\n    }\n    For(j,1,B) For(k,j,B){\n        int len=n/Max(j,k);\n        T[j][k]=new int [len+1];T[j][k][0]=0;\n        For(i,1,len) T[j][k][i]=M(T[j][k][i-1]+1LL*F[i]*G[i][j]%mod*G[i][k]%mod);\n    }\n}\nLL Solve(int n,int m){\n    if(n>m)swap(n,m);\n    LL res=0;\n    For(i,1,m/B) res=M(res+1LL*F[i]*G[i][n/i]%mod*G[i][m/i]%mod);\n    for(int i=m/B+1,nxt;i<=n;i=nxt+1){\n        nxt=Min(n/(n/i),m/(m/i));\n        res=M(res+M(T[n/i][m/i][nxt]-T[n/i][m/i][i-1]+mod));\n    }\n    return res;\n}\n\nint main(){\n    read(Test);Init(100000);\n    while(Test--){\n        read(n);read(m);\n        printf(\"%lld\\n\",Solve(n,m));\n    }\n    return 0;\n}\n```\n",
        "postTime": 1519192999,
        "uid": 20176,
        "name": "Salamander",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "$T$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa $n,m$\u3002\n\n\u6c42 \n$$\n\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)\n$$\n\u8fd9\u4e2a $\\varphi(ij)$ \u4e0d\u662f\u5f88\u597d\u505a\uff0c\u8003\u8651\u62c6\u5f00\u3002\n\n\u8fd9\u91cc\u6709\u4e24\u79cd\u5904\u7406\u65b9\u5f0f\uff1a\n\n1.\u76f4\u63a5\u62c6\u6210 $\\varphi(i)\\varphi(j)$\uff0c\u7136\u540e\u5229\u7528\u6027\u8d28 $\\varphi(n)=n\\prod_{d|n}[d\\in\\operatorname{Prime}](1-\\dfrac{1}{d})$ \u8865\u4e0a $\\varphi(i),\\varphi(j)$  \u90fd\u6709\u7684\u8d28\u56e0\u5b50\u3002\n\n\u5373 \n$$\n\\varphi(ij)=\\varphi(i)\\varphi(j)\\prod_{k=1}^{\\min(i,j)}[k\\in\\operatorname{Prime}][k|i][k|j]\\dfrac{k}{k-1}\n$$\n2.\u6709\u4e00\u4e2a\u516c\u5f0f\uff1a\n$$\n\\varphi(ij)=\\dfrac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}\n$$\n\u6211\u7528\u7684\u662f\u7b2c\u4e00\u79cd\uff0c\u4ee3\u56de\u539f\u5f0f\u53ef\u5f97\uff1a\n$$\n\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)\\prod_{k=1}^{\\min(i,j)}[k\\in\\operatorname{Prime}][k|i][k|j]\\dfrac{k}{k-1}\n$$\n\n$$\n\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)\\prod_{k=1}^{\\min(i,j)}[k\\in\\operatorname{Prime}][k|\\gcd(i,j)]\\dfrac{k}{k-1}\n$$\n\n$$\n\\sum_{d=1}^{\\min(n,m)}\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1}\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)[\\gcd(i,j)=d]\n$$\n\n$$\n\\sum_{d=1}^{\\min(n,m)}\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1}\\sum_{i=1}^{\\frac{n}{d}}\\sum_{j=1}^{\\frac{m}{d}}\\varphi(id)\\varphi(jd)[\\gcd(i,j)=1]\n$$\n\n\u76f4\u63a5\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u3002\n$$\n\\sum_{d=1}^{\\min(n,m)}\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1}\\sum_{i=1}^{\\frac{n}{d}}\\sum_{j=1}^{\\frac{m}{d}}\\varphi(id)\\varphi(jd)\\sum_{D|\\gcd(i,j)}\\mu(D)\n$$\n\n$$\n\\sum_{d=1}^{\\min(n,m)}\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1}\\sum_{D=1}^{\\min(\\frac{n}{d},\\frac{m}{d})}\\mu(D)\\sum_{i=1}^{\\frac{n}{d}}\\sum_{j=1}^{\\frac{m}{d}}\\varphi(id)\\varphi(jd)[D|i][D|j]\n$$\n\n$$\n\\sum_{d=1}^{\\min(n,m)}\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1}\\sum_{D=1}^{\\min(\\frac{n}{d},\\frac{m}{d})}\\mu(D)\\sum_{i=1}^{\\frac{n}{dD}}\\sum_{j=1}^{\\frac{m}{dD}}\\varphi(idD)\\varphi(jdD)\n$$\n\n$$\n\\sum_{T=1}^{\\min(n,m)}\\sum_{d|T}((\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1})\\mu(\\dfrac{T}{d}))\\sum_{i=1}^{\\frac{n}{T}}\\varphi(iT)\\sum_{j=1}^{\\frac{m}{T}}\\varphi(jT)\n$$\n\n$\\sum_{d|T}((\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1})\\mu(\\dfrac{T}{d}))$ \u8fd9\u4e00\u5768\u76f4\u63a5 $\\mathcal{O(n\\log n)}$ \u7684\u7b5b\u6cd5\u9884\u5904\u7406\u3002\n\n\u7136\u540e\u5bf9 $T$ \u8fdb\u884c\u6570\u8bba\u5206\u5757\uff0c\u53f3\u8fb9\u90a3\u5768 $\\varphi$ \u6c42\u548c\u76f4\u63a5\u66b4\u529b\u7b97\uff0c\u81f3\u6b64\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u5355\u6b21\u8be2\u95ee $\\mathcal{O(n+m)}$ \u7684\u7b97\u6cd5\u3002\n\n\u600e\u4e48\u4f18\u5316\u5462\uff1f\u663e\u7136\u74f6\u9888\u5728\u540e\u9762\u90a3\u4e00\u5768 $\\varphi$ \u6c42\u548c\u91cc\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u4e71\u641e\u4e86\u3002\n\n\u8bbe\u4e00\u4e2a\u9608\u503c $B$\uff0c\u51fd\u6570 $F(x),G(x,y),S(x,y,z)$\u3002\n$$\nF(x)=\\sum_{d|x}((\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1})\\mu(\\dfrac{x}{d}))\n$$\n\n$$\nG(x,y)=\\sum_{i=1}^x\\varphi(iy)\n$$\n\n$$\nS(x,y,z)=\\sum_{T=1}^{z}\\sum_{d|T}((\\prod_{k|d}[k\\in\\operatorname{Prime}]\\dfrac{k}{k-1})\\mu(\\dfrac{T}{d}))\\sum_{i=1}^{y}\\varphi(iT)\\sum_{j=1}^{x}\\varphi(jT)\n$$\n\n\u663e\u7136\u6709\n$$\nG(x,y)=G(x,y-1)+\\varphi(xy)\n$$\n\n$$\nS(x,y,z)=S(x,y,z-1)+F(z)G(z,x)G(z,y)\n$$\n\n\u7136\u540e\u5bf9\u4e8e $\\dfrac{m}{B}$ \u7684\u90e8\u5206\u76f4\u63a5\u7528 $G$ \u51fd\u6570\u66b4\u529b\u7b97\uff0c\u540e\u9762\u7684\u90e8\u5206\u6574\u9664\u5206\u5757\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(n+n\\log n+nB^2+T(\\sqrt{n}+\\dfrac{n}{B}))}$\u3002\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\n#define LL long long\nconst int MAXN = 1e5 + 5;\nbool vis[MAXN];\nint len, mu[MAXN], prime[MAXN], B = 100;\nconst LL mod = 998244353;\nLL qkpow(LL x, LL power, LL mod) {\n    x %= mod;\n    LL ans = 1;\n    for (; power; power >>= 1, (x *= x) %= mod)\n        if (power & 1)\n            (ans *= x) %= mod;\n    return ans;\n}\nLL Prime[MAXN], f[MAXN], phi[MAXN];\nvector<int> G[MAXN], S[105][105];\nvoid Getmu() {\n    mu[1] = 1, phi[1] = 1;\n    Prime[1] = 1;\n    for (int i = 2; i <= MAXN - 5; i++) {\n        Prime[i] = 1;\n        if (!vis[i])\n            prime[++len] = i, mu[i] = -1, phi[i] = i - 1;\n        for (int j = 1; j <= len && i * prime[j] <= MAXN - 5; j++) {\n            vis[i * prime[j]] = 1;\n            if (i % prime[j] == 0) {\n                mu[i * prime[j]] = 0;\n                phi[i * prime[j]] = phi[i] * prime[j];\n                break;\n            }\n            mu[i * prime[j]] = -mu[i];\n            phi[i * prime[j]] = phi[i] * (prime[j] - 1);\n        }\n    }\n    for (int i = 1; i <= len; i++)\n        for (int j = prime[i]; j <= MAXN - 5; j += prime[i])\n            Prime[j] = (Prime[j] * prime[i] % mod * qkpow(prime[i] - 1, mod - 2, mod) % mod) % mod;\n    for (int i = 1; i <= MAXN - 5; i++)\n        for (int j = i; j <= MAXN - 5; j += i)\n            f[j] = (f[j] + Prime[i] * mu[j / i]) % mod, f[j] = (f[j] + mod) % mod;\n    for (int i = 1; i <= MAXN - 5; i++) {\n        G[i].push_back(0);\n        for (int j = 1; j <= (MAXN - 5) / i; j++) G[i].push_back((G[i][j - 1] + phi[i * j]) % mod);\n    }\n    for (int i = 1; i <= B; i++) {\n        for (int j = 1; j <= B; j++) {\n            S[i][j].push_back(0);\n            for (int k = 1; k <= (MAXN - 5) / max(i, j); k++) {\n                S[i][j].push_back((S[i][j][k - 1] + f[k] * G[k][i] % mod * G[k][j]) % mod);\n            }\n        }\n    }\n}\nint T;\nLL n, m;\nLL calc(LL n, LL m) {\n    LL ans = 0;\n    for (int i = 1; i <= max(n, m) / B; i++) ans = (ans + f[i] * G[i][n / i] % mod * G[i][m / i] % mod) % mod;\n    for (int i = max(n, m) / B + 1, j; i <= min(n, m); i = j + 1) {\n        j = min(n / (n / i), m / (m / i));\n        ans = (ans + (S[n / i][m / i][j] - S[n / i][m / i][i - 1]) % mod) % mod;\n    }\n    return (ans + mod) % mod;\n}\nint main() {\n    Getmu();\n    scanf(\"%d\", &T);\n    while (T--) {\n        scanf(\"%lld %lld\", &n, &m);\n        printf(\"%lld\\n\", calc(n, m));\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1595382195,
        "uid": 154560,
        "name": "Silver187",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "\u611f\u89c9\u8fd9\u9898\u771f\u7684\u7279\u522b\u6709\u610f\u601d\uff0c\u6d89\u53ca\u4e86 OI \u4e2d\u5f88\u591a\u975e\u5e38\u6709\u610f\u601d\u3001\u975e\u5e38\u7f8e\u7684\u624b\u6cd5\uff0c\u6bd4\u5982\u2014\u2014\u5e73\u8861\u4e24\u90e8\u5206\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3001$n \\ln n$ \u7684\u90a3\u4e2a Trick\u7b49\u7b49\uff0c\u771f\u7684\u4e00\u79cd\u66b4\u529b\u7684\u7f8e\u5b66\u3002\n\n![\u6ca1\u9519\uff0c\u5c31\u662f\u8fd9\u79cd\u7f8e](https://cdn.luogu.com.cn/upload/pic/11191.png)\n\n\u9898\u76ee\u5927\u610f\uff1a\n\n\u591a\u7ec4\u8be2\u95ee\uff0c\u6c42 $f_{n,m}=\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m \\varphi(i\\cdot j)$\uff0c$1 \\le n,m \\le 1e5$\uff0c$T \\le 1e4$.\n\n\u89e3\u6cd5\uff1a\n\n\u8fd9\u91cc\u7528\u4e00\u4e2a\u5957\u8def\u4e00\u70b9\u7684\u5f0f\u5b50\uff1a$\\varphi(i\\cdot j)=\\frac{\\varphi(i)\\cdot \\varphi(j)\\cdot \\gcd(i,j)}{\\varphi(\\gcd(i,j))}$\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$f_{n,m}=\\sum_{i=1}^n\\sum_{j=1}^m \\frac{\\varphi(i)\\cdot \\varphi(j)\\cdot \\gcd(i,j)}{\\varphi(\\gcd(i,j))}$$\n\n\u8fd0\u7528\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u7684\u610f\u4e49\u5728\u4e8e\u73b0\u5728\u6240\u6709\u7684\u53c2\u6570\u90fd\u5728\u503c\u57df $[1,\\min(n,m)]$ \u4e4b\u5185\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5c06\u76f8\u540c\u7684\u4e1c\u897f\u63d0\u51fa\u6765\uff0c\u4e5f\u5c31\u662f\u6211\u4e0a\u4e00\u7bc7\u535a\u5ba2\u4e2d\u63d0\u5230\u7684\u90a3\u79cd\u65b9\u6cd5\uff0c\u5f97\u5230\uff1a\n\n$$f_{n,m}=\\sum_{d=1}^{\\min(n,m)} \\frac{d}{\\varphi(d)} \\sum_{i=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\sum_{j=1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor}\\varepsilon\\left(\\gcd(i,j)\\right)\\varphi(id)\\varphi(jd)$$\n\n\u8fd0\u7528\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u5f97\u7684\u610f\u4e49\u5728\u4e8e\uff0c\u5b83\u628a\u6761\u4ef6\u5f0f\u53c8\u8f6c\u5316\u4e3a\u4e86\u8d21\u732e\u5f0f\uff0c\u4f7f\u5b83\u53ef\u4ee5\u5feb\u901f\u7403\u548c\uff0c\u4e8e\u662f\u6211\u4eec\u8fd0\u7528\u83ab\u53cd\uff0c\u5e76\u5c06 $\\mu$ \u63d0\u51fa\u6765\uff1a\n\n$$f_{n,m}=\\sum_{x=1}^{\\min(n,m)}\\frac{x}{\\varphi(x)}\\sum_{y=1}^{\\left\\lfloor \\frac{\\min(n,m)}{x}\\right\\rfloor}\\mu(y)\\sum_{i=1}^{\\left \\lfloor \\frac{n}{xy} \\right \\rfloor}\\sum_{j=1}^{\\left \\lfloor \\frac{m}{xy} \\right \\rfloor} \\varphi(ixy)\\varphi(jxy)$$\n\n\u9047\u5230\u8fd9\u6837\u633a\u6781\u81f4\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u51fa\u4e00\u4e2a $T=xy$\uff0c\u7136\u540e\u679a\u4e3e $T$ \u7684\u56e0\u6570\uff0c\u4ee5\u671f\u5b9e\u73b0\u83ab\u53cd/\u8c03\u548c\u7ea7\u6570\u7684\u6548\u679c\u3002\u5f97\u5230\uff1a\n\n$$f_{n,m}=\\sum_{T=1}^{\\min(n,m)} \\left(\\sum_{x|T} \\frac{x}{\\varphi(x)} \\mu\\left(\\frac{T}{x}\\right)\\right)\\cdot \\left(\\sum_{i=1}^{\\left \\lfloor \\frac{n}{T} \\right \\rfloor}\\varphi(iT)\\right)\\cdot \\left(\\sum_{j=1}^{\\left \\lfloor \\frac{m}{T} \\right \\rfloor}\\varphi(jT)\\right)$$\n\n\u6211\u4eec\u8bbe $g(T)=\\sum_{x|T} \\frac{x}{\\varphi(x)} \\mu(\\frac{T}{x})$\uff0c$h(n,T)=\\sum_{i=1}^{\\left \\lfloor n \\right \\rfloor}\\varphi(iT)$\uff0c\u4e8e\u662f\uff1a\n\n$$f_{n,m}=\\sum_{T=1}^{\\min(n,m)}g(T)\\cdot h(\\left\\lfloor \\frac{n}{T} \\right\\rfloor,T)\\cdot h(\\left\\lfloor \\frac{m}{T} \\right\\rfloor,T)$$\n\n\u6ce8\u610f\u5230 $g$ \u4e2d\uff0c$\\sum\\limits x \\le n \\ln n$\uff1b$h$ \u4e2d\uff0c$nT \\le n \\ln n$\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u4e1c\u897f\u90fd\u53ef\u4ee5\u7528\u8c03\u548c\u7ea7\u6570\u9884\u5904\u7406\u51fa\u6765\uff0c\u4e8e\u662f\u6211\u4eec\u6709\u4e86\u4e00\u4e2a $\\Theta(nT)$ \u7684\u505a\u6cd5\uff0c\u8fd9\u662f\u8c03\u548c\u7ea7\u6570\u7684\u7f8e\u3002\n\n\u8003\u8651\u7ee7\u7eed\u4f18\u5316\u3002\u56e0\u4e3a\u53f3\u624b\u8fb9\u7684\u4e1c\u897f\u542b\u6709\u4e0b\u53d6\u6574\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u6574\u9664\u5206\u5757\uff1b\u4f46\u662f\u8fd9\u4e2a\u6574\u9664\u5206\u5757\u4e2d $h$ \u51fd\u6570\u540c\u65f6\u542b\u6709\u8fd9\u4e24\u79cd\u53c2\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u524d\u7f00\u548c\u4f18\u5316\uff1a\n\n$$t_{n,m,d}=\\sum_{i=1}^d g(i)\\cdot g(n,i) \\cdot g(m,i)$$\n\n\u8fd9\u4e2a\u663e\u7136\u8fc7\u4e8e\u5e9e\u5927\u65e0\u6cd5\u9884\u5904\u7406\uff0c\u5e76\u4e14\u6ca1\u4ec0\u4e48\u529e\u6cd5\u5feb\u901f\u6c42\u503c\uff1b\u4e00\u65e6\u9884\u5904\u7406\uff0c\u8be2\u95ee\u53ea\u8981 $\\Theta(\\sqrt n)$\uff0c\u4f46\u662f\u9884\u5904\u7406\u4f1a\u8d85\u65f6\uff1b\u4e00\u65e6\u4e0d\u9884\u5904\u7406\uff0c\u90a3\u4e48\u8be2\u95ee\u4f1a\u8d85\u65f6\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651 **\u5e73\u8861\u4e24\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6**\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u9884\u5904\u7406 $n\\le S$ \u4e14 $m \\le S$\uff0c\u7684\u90e8\u5206\uff0c\u590d\u6742\u5ea6 $nS^2$\uff1b\u67e5\u8be2\u7684\u65f6\u5019\u6211\u4eec\u66b4\u529b\u67e5\u8be2 $\\left[ 1, \\left\\lceil \\frac{\\min(n,m)}{S}\\right\\rceil \\right]$ \u7684\u90e8\u5206\uff1b\u5176\u4f59\u7684\u56e0\u4e3a $\\left \\lfloor \\frac{n}{T} \\right \\rfloor$ \u90fd\u5c0f\u4e8e\u7b49\u4e8e $S$\uff0c\u6240\u4ee5\u53ef\u4ee5\u6574\u9664\u5206\u5757\u4e86\u67e5\u8be2\u3002\n\n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u7b49\u4e8e $\\gamma = n \\ln n + nS^2+T\\cdot\\left( \\sqrt S + \\frac{n}{S}\\right)$\uff0c\u5f53 $\\frac{\\partial \\gamma}{\\partial S}=2nS-\\frac{Tn}{S^2}+\\frac{T}{2\\sqrt S}=0$ \u65f6\u6700\u4f18\uff0c\u5927\u6982\u662f $S=50$\uff0c\u5e76\u4e14\u603b\u7684\u53ef\u4ee5\u5728 $0.5s$ \u4e4b\u5185\u8dd1\u51fa\u6765\uff0c\u8fd9\u662f **\u5e73\u8861\u4e4b\u7f8e**\u3002\n\n\u4ee3\u7801\uff1a[https://www.luogu.com.cn/paste/hxjugkts](https://www.luogu.com.cn/paste/hxjugkts).\n",
        "postTime": 1609081262,
        "uid": 148438,
        "name": "Linshey",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "[P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240)\uff1a\n\n\u53cd\u6b63\u53cd\u6f14\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u6bd4\u8f83\u6c34\u7684\u9ed1\u9898\u3002\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)$$\n\n\u6709 $\\varphi(ij)=\\dfrac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$\n\n\u6240\u4ee5\u6709\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\dfrac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$$\n\n\u679a\u4e3e $\\gcd(i,j)$\n\n$$\\sum_{k=1}^n\\sum_{i=1}^n\\sum_{j=1}^m\\dfrac{\\varphi(i)\\varphi(j)k}{\\varphi(k)}[\\gcd(i,j)=k]$$\n\n\u679a\u4e3e $ik,jk$\n\n$$\\sum_{k=1}^n\\sum_{i=1}^{\\lfloor \\frac{n}{k}\\rfloor}\\sum_{j=1}^{\\lfloor \\frac{m}{k}\\rfloor}\\dfrac{\\varphi(ik)\\varphi(jk)k}{\\varphi(k)}[\\gcd(i,j)=1]$$\n\n$$\\sum_{k=1}^n\\sum_{i=1}^{\\lfloor \\frac{n}{k}\\rfloor}\\sum_{j=1}^{\\lfloor \\frac{m}{k}\\rfloor}\\dfrac{\\varphi(ik)\\varphi(jk)k}{\\varphi(k)}\\sum_{d|\\gcd(i,j)}\\mu(d)$$\n\n\u79fb\u9879\u5f97\u5230\n\n$$\\sum_{k=1}^n\\dfrac{k}{\\varphi(k)}\\sum_{i=1}^{\\lfloor \\frac{n}{k}\\rfloor}\\varphi(ik)\\sum_{j=1}^{\\lfloor \\frac{m}{k}\\rfloor}\\varphi(jk)\\sum_{d|\\gcd(i,j)}\\mu(d)$$\n\n$$\\sum_{k=1}^n\\dfrac{k}{\\varphi(k)}\\sum_{d=1}^{\\lfloor \\frac{n}{k}\\rfloor}\\mu(d)\\sum_{i=1}^{\\lfloor \\frac{n}{kd}\\rfloor}\\varphi(ikd)\\sum_{j=1}^{\\lfloor \\frac{m}{kd}\\rfloor}\\varphi(jkd)$$\n\n\u8003\u8651\u679a\u4e3e $P=kd$\u3002\n\n$$\\sum_{P=1}^n\\sum_{k|P}\\frac{k}{\\varphi(k)}\\mu(\\frac{P}{k})\\sum_{i=1}^{\\lfloor \\frac{n}{P}\\rfloor}\\varphi(iP)\\sum_{j=1}^{\\lfloor \\frac{m}{P}\\rfloor}\\varphi(jP)$$\n\n\u4f3c\u4e4e\u4e0d\u80fd\u518d\u5316\u7b80\u4e86\uff0c\u4ee4\n\n$$f(x)=\\sum_{k|x}\\frac{k}{\\varphi(k)}\\mu(\\frac{x}{k})$$\n\n\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\uff0c\u63a5\u4e0b\u6765\u4ee4\n\n$$g(x,y)=\\sum_{i=1}^{x}\\varphi(iy)$$\n\n$$g(x,y)=g(x-1,y)+\\varphi(xy)$$\n\n$$q_i=\\sum_{P=1}^n f(P)g(\\frac{n}{P},P)g(\\frac{m}{P},P)$$\n\n\u66b4\u529b\u83ab\u961f\u53ef\u4ee5\u8fc7\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\ln n + q\\sqrt n\\ln n)$\u3002\n\n#### CODe\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst ll Maxn=1e5+7,Mod=998244353;\nll f[Maxn],Q,sq,phi[Maxn],mu[Maxn],ans[Maxn],res,prime[Maxn],cnt,inv[Maxn];\nvector<ll>g[Maxn],d[Maxn];\nbool isprime[Maxn];\nstruct ques{\n    ll n,m,id;\n}q[Maxn];\ninline bool cmp(ques x,ques y){\n    return x.n/sq==y.n/sq?((x.n/sq)&1)?y.m<x.m:x.m<y.m:x.n<y.n;\n}\nvoid init(ll N){\n    phi[1]=1;isprime[1]=isprime[0]=1;\n    mu[1]=1,phi[1]=1;\n    for(ll i=2;i<=N;i++){\n        if(!isprime[i]) prime[++cnt]=i,phi[i]=i-1,mu[i]=-1;\n        for(ll j=1;j<=cnt&&prime[j]*i<=N;j++){\n            isprime[i*prime[j]]=1;\n            if(!(i%prime[j])){\n                phi[i*prime[j]]=phi[i]*prime[j];\n                break;\n            }\n            phi[i*prime[j]]=phi[i]*(prime[j]-1);\n            mu[i*prime[j]]=-mu[i];\n        }\n    }\n    inv[1]=1;\n    for(ll i=2;i<=N;i++)\n    \tinv[i]=(Mod-Mod/i)*inv[Mod%i]%Mod;\n    for(ll i=1;i<=N;i++){\n        g[i].resize(N/i+2);\n        for(ll j=1;j<=N/i;j++)\n            g[i][j]=(g[i][j-1]+phi[i*j])%Mod;    \n    }\n    for(ll i=1;i<=N;i++)\n        for(ll j=i;j<=N;j+=i)\n            f[j]=f[j]%Mod+i*inv[phi[i]]%Mod*mu[j/i]%Mod,d[j].push_back(i);\n\n}\ninline void add(ll a,ll b,ll w){\n    for(ll i=0;i<d[a].size();++i)\n        res=(res+1ll*w%Mod*phi[a]%Mod*g[d[a][i]][b/d[a][i]]%Mod*f[d[a][i]]%Mod)%Mod;\n    res=(res+Mod)%Mod; \n}\nint main(){\n    scanf(\"%lld\",&Q);\n    init(Maxn-7);\n    for(ll i=1;i<=Q;i++){\n        scanf(\"%lld%lld\",&q[i].n,&q[i].m);\n        if(q[i].m<q[i].n) swap(q[i].n,q[i].m);\n        q[i].id=i;\n    }\n    sq=sqrt(Q);\n    sort(q+1,q+Q+1,cmp);\n    ll l=0,r=0;\n    for(ll i=1;i<=Q;i++){\n        while(l<q[i].n) add(++l,r,1);\n        while(r<q[i].m) add(++r,l,1);\n        while(l>q[i].n) add(l--,r,-1);\n        while(r>q[i].m) add(r--,l,-1);\n        ans[q[i].id]=res%Mod;\n    }\n    for(ll i=1;i<=Q;i++) printf(\"%lld\\n\",ans[i]);\n    return 0;\n}\n```\n",
        "postTime": 1680176565,
        "uid": 590600,
        "name": "MoriyaSuwako",
        "ccfLevel": 0,
        "title": "P4240 \u9898\u89e3"
    },
    {
        "content": "\u9898\u610f\uff1a\u6c42 $\\sum_{i=1}^{n}\\sum_{j=1}^{m} \\varphi(ij)$ \uff0c\u591a\u7ec4\u8be2\u95ee\u3002\n\n\u9996\u5148\u6709\u4e2a\u6027\u8d28 \uff1a\n$\\varphi(ab)\\varphi(\\gcd(ab))=\\varphi(a)\\varphi(b)\\gcd(a,b)$\n\n\u7136\u800c\u8fd9\u5f88\u597d\u8bc1\u660e\uff1a\n\n$$\\varphi(ab)=ab\\prod_{p|ab} \\dfrac{p-1}{p}=\\dfrac{a\\prod_{p|a} \\dfrac{p-1}{p} b\\prod_{p|b} \\dfrac{p-1}{p}}{\\prod_{p|\\gcd(a,b)} \\dfrac{p-1}{p}}$$\n\n\u4e0a\u4e0b\u4e24\u8fb9\u540c\u4e58 $\\gcd(a,b)$ \u3002\n\n$$\\varphi(ab)=\\dfrac{\\varphi(a)\\varphi(b)\\gcd(a,b)}{\\varphi(\\gcd(a,b))}$$\n\n\u90a3\u597d\uff0c\u6211\u4eec\u5e26\u56de\u539f\u6765\u7684\u5f0f\u5b50\uff1a\n\n\u6ce8\uff1a $n>m$\n\n$$\\sum_{i=1}^{n}\\sum_{j=1}^{m} \\varphi(ij)=\\sum_{i=1}^{n}\\sum_{j=1}^{m} \\dfrac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$$\n\n$$=\\sum_{T=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor} \\dfrac{\\varphi(iT)\\varphi(jT)T}{\\varphi(T)}[\\gcd(i,j)=1]$$\n\n$$=\\sum_{T=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor} \\dfrac{\\varphi(iT)\\varphi(jT)T}{\\varphi(T)}\\sum_{k|i,k|j} \\mu(k)$$\n\n$$=\\sum_{T=1}^{n}\\sum_{k=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\mu(k) \\sum_{i|k}\\sum_{j|k}\\dfrac{\\varphi(iT)\\varphi(jT)T}{\\varphi(T)} $$\n\n\n$$=\\sum_{T=1}^{n}\\sum_{k=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\mu(k) \\sum_{i=1}^{\\lfloor\\frac{n}{kT}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{m}{kT}\\rfloor} \\dfrac{\\varphi(ikT)\\varphi(jkT)T}{\\varphi(T)} $$\n\n$$=\\sum_{T=1}^{n}\\dfrac{T}{\\varphi(T)}\\sum_{k=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\mu(k) \\sum_{i=1}^{\\lfloor\\frac{n}{kT}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{m}{kT}\\rfloor} \\varphi(ikT)\\varphi(jkT)$$\n\n$$=\\sum_{T=1}^{n}\\dfrac{T}{\\varphi(T)}\\sum_{k=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\mu(k) \\left[ \\sum_{i=1}^{\\lfloor\\frac{n}{kT}\\rfloor} \\varphi(ikT) \\right] \\left[\\sum_{j=1}^{\\lfloor\\frac{m}{kT}\\rfloor} \\varphi(jkT)\\right]$$\n\n\u53d1\u73b0\u5f0f\u5b50\u6781\u5176\u4e11\u964b\uff0c\u8bbe\uff1a $g(x,y)=\\sum_{i=1}^{x} \\varphi(iy)$ \u3002\n\n\u539f\u5f0f\u5c31\u53ef\u4ee5\u5199\u6210\uff1a\n\n$$\\sum_{T=1}^{n}\\dfrac{T}{\\varphi(T)}\\sum_{k=1}^{\\lfloor\\frac{n}{T}\\rfloor} \\mu(k) g(\\left\\lfloor\\frac{n}{kT}\\right\\rfloor,kT)g(\\left\\lfloor\\frac{m}{kT}\\right\\rfloor,kT)$$\n\n\u53d1\u73b0\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u5728\u8fd9\u4e2a\u5f0f\u5b50\u4e0d\u597d\u641e\uff0c\u679c\u65ad\u72ec\u7acb\uff1a\n\n\u8bbe \uff1a $d=kT$\n\n$$=\\sum_{d=1}^{n}g(\\left\\lfloor\\frac{n}{kT}\\right\\rfloor,kT)g(\\left\\lfloor\\frac{m}{kT}\\right\\rfloor,kT)\\sum_{k|d} \\dfrac{\\mu(\\dfrac{d}{k})d}{\\varphi(d)}$$\n\n\u8bbe\uff1a $f(x)=\\sum_{k|x} \\dfrac{\\mu(\\frac{x}{k})x}{\\varphi(x)}$\n\n\u8bbe\uff1a $h(x,y,z)=\\sum_{T=1}^{x}f(T)g(\\frac{y}{T},T)g(\\frac{z}{T},T)$\n\n\u6211\u4eec\u53d1\u73b0 $h$ \u4e0d\u597d\u5904\u7406\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u5dee\u5206\u3002\n\n\u8bbe\uff1a $F(x,y,z)=\\sum_{i=1}^{x} f(i)g(y,i)g(z,i)$\n\n\u7136\u540e\u6211\u4eec\u5728\u7528\u6574\u9664\u5206\u5757\u7b97 $h$ \u65f6\u8003\u8651 $l,r$ \u4e3a\u5757\u5de6\u53f3\u7aef\u70b9\uff1a\n\n$$h(x,y,z)=F(r,\\left\\lfloor\\frac{n}{r}\\right\\rfloor,\\left\\lfloor\\frac{m}{r}\\right\\rfloor)-F(l-1,\\left\\lfloor\\frac{n}{l}\\right\\rfloor,\\left\\lfloor\\frac{m}{l}\\right\\rfloor)$$\n\n\u7136\u800c $t$ \u6b21\u8be2\u95ee\uff0c\u663e\u7136\u5168\u90e8\u9884\u5904\u7406\u590d\u6742\u5ea6\u5403\u4e0d\u6d88\u3002\n\n\u8003\u8651\u5206\u6cbb\uff1a\u8bbe\u4e2a $B$ \uff0c\u5c0f\u4e8e $\\left\\lfloor\\frac{n}{B}\\right\\rfloor$ \u66b4\u529b\u505a\uff0c\u5927\u4e8e\u5219\u6574\u9664\u5206\u5757\u3002\n\n\u590d\u6742\u5ea6\uff1a $O(n\\log n+B^2n+q(\\sqrt n+\\dfrac{n}{B}))$ \u3002\n\n\u5bf9\u4e8e $B$ \u7684\u53d6\u503c\uff0c\u6211\u9009\u53d6\u4e86 $\\sqrt[3]{n}$ \u3002\n\n\u7b97\u51fa\u6765\u590d\u6742\u5ea6\u4e3a\uff1a $O(n\\log n+n^{\\frac{5}{3}}+qn^{\\frac{2}{3}})$ \u3002\n\n\u7136\u540e\u8fd9\u662f\u53ef\u8fc7\u7684\u3002\n\n~~\u4ee3\u7801\u5c31\u4e0d\u653e\u4e86\uff0c\u5b9e\u73b0\u8f83\u77ed\u3002~~",
        "postTime": 1658190156,
        "uid": 436389,
        "name": "Vidoliga",
        "ccfLevel": 6,
        "title": "P4240"
    },
    {
        "content": "- QwQ\u3002\n\n**[\u9898\u610f](https://www.luogu.com.cn/problem/P4240)**\n- \u67e5\u8be2\uff1a\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i\\cdot j)$$\n- \u6d4b\u8bd5\u7ec4\u6570 $T$ \u4e0d\u5927\u4e8e $10^4$\uff0c$n,m\\le 10^5$\u3002\n\n**\u5206\u6790**\n- \u7ecf\u8fc7[\u5957\u8def](https://www.luogu.com.cn/blog/luo1gu1zui1bang1/solution-p4240)\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff1a\n$$g(n)=\\sum_{d|n}\\frac{d\\mu(n/d)}{\\varphi(d)}$$\n$$G(n,k)=\\sum_{i=1}^n\\varphi(i\\cdot k)$$\n- \u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\uff1a\n$$H(n,m)=\\sum_{i=1}^{+\\infty}g(i)G(\\lfloor n/i\\rfloor,i)G(\\lfloor m/i\\rfloor,i)$$\n- \u6ce8\u610f\u4e0a\u9762\u90a3\u4e2a\u6c42\u548c\u53f7\u4e0a\u6807\u5176\u5b9e\u53ef\u4ee5\u7f29\u5c0f\u5230 $\\min(n,m)$\uff0c\u4f46\u662f\u4e3a\u4e86\u4e0b\u9762\u63a8\u5bfc\u65b9\u4fbf\u3002\n- \u7136\u540e\u6211\u4eec\u53d1\u73b0\uff1a$H(n-1,m)$ \u8f6c\u79fb\u5230 $H(n,m)$ \u53ea\u9700\u8981 $O(\\sigma_0(n))$ \u7684\u65f6\u95f4\uff08\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e48\u591a\u4e2a\u9879\u4e0d\u4e00\u6837\uff09\u3002\n- \u4e8e\u662f\u66b4\u529b\u8dd1\u83ab\u961f\uff0c\u590d\u6742\u5ea6\u7ecf\u5206\u6790\u53ef\u5f97\u662f $O(n\\sqrt T\\log n)$\uff0c\u5229\u7528\u5408\u7406\u7684\u5206\u5757\u6216\u8bb8\u53ef\u4ee5\u8ba9\u590d\u6742\u5ea6\u4e25\u683c\u4e00\u70b9\uff0c\u4f46\u662f\u76f4\u63a5\u5206\u5757\u4e5f\u4e0d\u81f3\u4e8e\u88ab\u5361\uff0c\u5e38\u6570\u5e94\u8be5\u8f83\u5c0f\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/almivd07)\u3002\n- \u8fd8\u6709\u4e2a\u6709\u8da3\u7684\u4e8b\u60c5\uff0c\u8fd9\u91cc\u53e6\u5916\u4e71\u5165\u4e00\u4e2a\u4e1c\u897f\uff1a$n\\le 10^5,m\\le 10^9$ \u4e0d\u591a\u6d4b\u600e\u4e48\u641e\uff1f\n- \u8bbe\uff1a\n$$F(n,m)=\\sum_{i=1}^m\\varphi(n\\cdot i)$$\n- \u8003\u8651\u8d28\u6570 $p|n$\uff0c\u6839\u636e\u6027\u8d28\u5206\u7c7b\u8ba8\u8bba\uff0c\u53ef\u4ee5\u5f97\u5230\u516c\u5f0f\uff1a\n$$F(n,m)=\\begin{cases}F(n/p,m)\\cdot p&p^2|n\\\\F(n/p,m)\\cdot (p-1)+F(n,\\lfloor m/p\\rfloor)&\\text{otherwise}\\end{cases}$$\n- \u8fb9\u754c\u662f $n=1$ \u65f6\u9700\u8981\u4f7f\u7528\u675c\u6559\u7b5b\u3002\n- \u72b6\u6001\u6570\u76ee\u524d\u590d\u6742\u5ea6\u672a\u77e5\uff0c\u4f46\u662f\u5b83\u53ef\u8fc7\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/9mwx5idd)\uff0c\u8dd1\u5f97\u8fd8\u633a\u5feb\u3002\n- \u6709\u8c01\u80fd\u544a\u8bc9\u6211 $f(n,m)$\uff08\u968f\u4fbf\u6311 $[1,n]$ \u7684\u8d28\u56e0\u5b50\uff0c\u53ef\u91cd\u590d\uff0c\u6ee1\u8db3\u79ef\u4e0d\u5927\u4e8e $m$ \u7684\u65b9\u6848\u6570\uff09\u7684\u6e10\u8fdb\u754c\uff0c\u6211\u5c31\u53ef\u4ee5\u544a\u8bc9\u4f60\u51c6\u786e\u590d\u6742\u5ea6\u62c9\u3002",
        "postTime": 1655972750,
        "uid": 260884,
        "name": "WeLikeStudying",
        "ccfLevel": 0,
        "title": "\u3010\u83ab\u961f\uff0c\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u3011\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\n\u6c42 $\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m \\varphi(ij)(mod\\ 998244353)$\n\n$T$ \u7ec4\u8be2\u95ee\n\n$1 \\leq n,m,T \\leq 10^5$\n\n## \u5206\u6790\n\u4ee4 $n<m$\n\n\u9996\u5148\uff0c\u6211\u4eec\u628a $\\varphi(ij)$ \u62c6\u6210 $\\varphi(i)\\varphi(j)\\frac{gcd(i,j)}{\\varphi(gcd(i,j))}$\n\n\u8003\u8651\u6c42\u5355\u4e2a\u6b27\u62c9\u51fd\u6570\u7684\u65b9\u6cd5\n\n$\\varphi(i)=i\\prod\\limits_{d \\in prime,d|i}\\frac{d-1}{d}$\n\n$\\varphi(i)\\varphi(j)$ \u6bd4 $\\varphi(ij)$ \u591a\u4e58\u4e86 $i,j$ \u5171\u6709\u7684\u8d28\u56e0\u5b50\n\n\u6240\u4ee5\u6211\u4eec\u8981\u628a\u8fd9\u4e9b\u5171\u6709\u7684\u8d28\u56e0\u5b50\u505a\u51fa\u7684\u8d21\u732e\u6d88\u9664\n\n\u5373\u4e58\u4e0a\u4e00\u4e2a $\\frac{gcd(i,j)}{\\varphi(gcd(i,j))}$\n\n\u90a3\u4e48\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\n\n$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m\\varphi(i)\\varphi(j)\\frac{gcd(i,j)}{\\varphi(gcd(i,j))}$\n\n\u6309\u7167\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u5957\u8def\uff0c\u679a\u4e3e $gcd(i,j)$\n\n$\\sum\\limits_{d=1}^n\\frac{d}{\\varphi(d)}\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{m/d}\\varphi(id)\\varphi(jd)[gcd(i,j)=1]$\n\n$\\sum\\limits_{d=1}^n\\frac{d}{\\varphi(d)}\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{m/d}\\varphi(id)\\varphi(jd)\\sum\\limits_{k|gcd(i,j)}\\mu(k)$\n\n$\\sum\\limits_{d=1}^n\\frac{d}{\\varphi(d)}\\sum\\limits_{k=1}^{n/d}\\mu(k)\\sum\\limits_{i=1}^{n/dk}\\sum\\limits_{j=1}^{m/dk}\\varphi(idk)\\varphi(jdk)$\n\n$\\sum\\limits_{T=1}^n\\sum\\limits_{d|T}\\frac{d}{\\varphi(d) }\\mu(\\frac{T}{d})\\sum\\limits_{i=1}^{n/T}\\sum\\limits_{j=1}^{m/T}\\varphi(iT)\\varphi(jT)$\n\n\u8bbe $g(T)=\\sum\\limits_{d|T}\\frac{d}{\\varphi(d) }\\mu(\\frac{T}{d}),s(n,m)=\\sum\\limits_{i=1}^n\\varphi(mi)$\n\n\u539f\u5f0f\u53d8\u6210\n\n$\\sum\\limits_{T=1}^ng(T)s(n/T,T)s(m/T,T)$\n\n$g$ \u6570\u7ec4\u548c $s$ \u6570\u7ec4\u53ef\u4ee5 $nlogn$ \u9884\u5904\u7406\u51fa\u6765\n\n\u7136\u540e\u5c31\u53ef\u4ee5 $O(n)$ \u8ba1\u7b97\u6bcf\u4e00\u6b21\u7684\u7b54\u6848\n\n\u603b\u590d\u6742\u5ea6\u5c31\u662f $O(nT)$\uff0c\u8fd8\u662f\u4e0d\u591f\u4f18\u79c0\n\n\u6211\u4eec\u53ef\u4ee5\u4eba\u4e3a\u5730\u8bbe\u4e00\u4e2a\u503c $top$\n\n\u5f53 $T<\\frac{m}{top}$ \u65f6\u66b4\u529b\u8ba1\u7b97\n\n\u5426\u5219 $\\frac{n}{T},\\frac{m}{T}$ \u4e00\u5b9a\u662f\u5c0f\u4e8e $top$ \u7684\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u4e00\u4e2a\u6570\u7ec4\u628a\u5c0f\u4e8e $top$ \u7684\u8fd9\u4e00\u90e8\u5206\u9884\u5904\u7406\u51fa\u6765\n\n\u67e5\u8be2\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\n## \u4ee3\u7801\n``` cpp\n#include<cstdio>\n#include<cmath>\n#include<vector>\n#define rg register\nconst int maxn=1e5+5,maxm=55,mod=998244353,tp=52;\ninline int addmod(rg int now1,rg int now2){\n\treturn now1+=now2,now1>=mod?now1-mod:now1;\n}\ninline int delmod(rg int now1,rg int now2){\n\treturn now1-=now2,now1<0?now1+mod:now1;\n}\ninline int mulmod(rg long long now1,rg int now2){\n\treturn now1*=now2,now1>=mod?now1%mod:now1;\n}\nint pri[maxn],mmax,phi[maxn],mu[maxn],g[maxn],*f[maxm][maxm],buf[maxn*160],*o=buf,*s[maxn];\nint ksm(rg int ds,rg int zs){\n\trg int nans=1;\n\twhile(zs){\n\t\tif(zs&1) nans=mulmod(nans,ds);\n\t\tds=mulmod(ds,ds);\n\t\tzs>>=1;\n\t}\n\treturn nans;\n}\nbool not_pri[maxn];\nvoid pre(){\n\tnot_pri[0]=not_pri[1]=1;\n\tphi[1]=mu[1]=1;\n\tfor(rg int i=2;i<=mmax;i++){\n\t\tif(!not_pri[i]){\n\t\t\tpri[++pri[0]]=i;\n\t\t\tphi[i]=i-1;\n\t\t\tmu[i]=mod-1;\n\t\t}\n\t\tfor(rg int j=1;j<=pri[0] && 1LL*i*pri[j]<=mmax;j++){\n\t\t\tnot_pri[i*pri[j]]=1;\n\t\t\tif(i%pri[j]==0){\n\t\t\t\tphi[i*pri[j]]=mulmod(pri[j],phi[i]);\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tphi[i*pri[j]]=mulmod(phi[pri[j]],phi[i]);\n\t\t\t\tmu[i*pri[j]]=mulmod(mu[pri[j]],mu[i]);\n\t\t\t}\n\t\t}\n\t}\n\trg int cs;\n\tfor(rg int i=1;i<=mmax;i++){\n\t\tcs=mulmod(i,ksm(phi[i],mod-2));\n\t\tfor(rg int j=i,now=1;j<=mmax;j+=i,now++){\n\t\t\tg[j]=addmod(g[j],mulmod(cs,mu[now]));\n\t\t}\n\t}\n\tfor(rg int i=1;i<=mmax;i++){\n\t\tcs=mmax/i;\n\t\ts[i]=o;\n\t\to+=(cs+1);\n\t\tfor(rg int j=1;j<=cs;j++){\n\t\t\ts[i][j]=addmod(s[i][j-1],phi[i*j]);\n\t\t}\n\t}\n\tfor(rg int i=1;i<=tp;i++){\n\t\tfor(rg int j=1;j<=tp;j++){\n\t\t\tf[i][j]=o;\n\t\t\tf[i][j][0]=0;\n\t\t\tcs=std::min(mmax/i,mmax/j);\n\t\t\to+=(cs+1);\n\t\t\tfor(rg int k=1;k<=cs;k++){\n\t\t\t\tf[i][j][k]=(addmod(f[i][j][k-1],mulmod(g[k],mulmod(s[k][i],s[k][j]))));\n\t\t\t}\n\t\t}\n\t}\n}\nint t,n,m;\nint main(){\n\tmmax=1e5;\n\tpre();\n\tscanf(\"%d\",&t);\n\twhile(t--){\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tif(n>m) std::swap(n,m);\n\t\trg int nans=0,mmax=m/tp,orz1,orz2;\n\t\tfor(rg int i=1;i<=mmax;i++){\n\t\t\tnans=addmod(nans,mulmod(g[i],mulmod(s[i][n/i],s[i][m/i])));\n\t\t}\n\t\tfor(rg int l=mmax+1,r;l<=n;l=r+1){\n\t\t\tr=std::min((n/(n/l)),m/(m/l)),orz1=n/l,orz2=m/l;\n\t\t\tnans=addmod(nans,delmod(f[orz1][orz2][r],f[orz1][orz2][l-1]));\n\t\t}\n\t\tprintf(\"%d\\n\",nans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1610335732,
        "uid": 316322,
        "name": "hzoi_liuchang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "### \u53e6\u4e00\u79cd\u505a\u6cd5\uff1a\u83ab\u53cd+\u83ab\u961f\n\n\u4e5f\u5f88\u5957\u8def\uff0c\u6211\u4eec\u4f7f\u7528\u4e8c\u7ef4\u83ab\u961f\uff0c\u95ee\u9898\u53d8\u6210\u4e86\u5982\u4f55\u5feb\u901f\u8ba1\u7b97 $\\sum_{i=1}^n\\varphi(ix)$\u3002\n\n\u4e00\u79cd\u60f3\u6cd5\u662f\u76f4\u63a5\u4e0a\u83ab\u53cd\uff0c\u6700\u540e\u53d8\u6210\u4e86 $\\varphi(x)\\sum_{d|x}f(d)\\sum_{d|i}^n\\varphi(i)$\u3002\n\n\u5176\u4e2d $f(n)=\\sum_{d|n}\\frac{\\mu(n/d)d}{\\varphi(d)}$\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u7684\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u8ba1\u7b97\u5f97\u51fa\u3002\n\n\u4f46\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u505a\u4f1a\u51c9\u51c9\u2026\u2026\u6bd5\u7adf $10^5$ \u7ea7\u522b\u5185\u7ea6\u6570\u6700\u5927\u4e3a $128$\uff0c\u600e\u4e48\u529e\u5462\uff1f\n\n\u4e00\u79cd\u795e\u5947\u7684\u65b9\u6cd5\uff1a\u627e\u5230\u4e00\u5bf9 $(a,b)$ \u6ee1\u8db3 $a\\times b=x$\uff0c\u5219\u539f\u5f0f\u53ef\u4ee5\u6539\u5199\u6210 $\\sum_{i=1}^{n\\times a}\\varphi(ib)[a|i]=\\varphi(b)\\sum_{d|b}f(d)\\sum_{d|i,a|i}^n\\varphi(i)$\u3002\n\n\u800c $d|i,a|i$ \u7b49\u4ef7\u4e8e $\\text{lcm}(d,a)|i$\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684 $a$\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u9884\u5904\u7406\u8fd9\u4e9b\u3002\n\n\u6240\u4ee5\u8bf4\u6211\u4eec\u5982\u679c\u80fd\u627e\u5230\u7ea6\u6570\u5c3d\u91cf\u5c11 $b$\uff0c\u4e3a\u4e86\u51cf\u5c11\u9884\u5904\u7406\u91cf\uff0c\u6211\u4eec\u8fd8\u5e0c\u671b\u4e0d\u540c\u7684 $a$ \u4e5f\u5c3d\u91cf\u7684\u5c11\u3002\n\n\u4e00\u79cd\u505a\u6cd5\u662f\u4ee4 $B=2^2\\times 3\\times 5$\uff0c\u7136\u540e\u6211\u4eec\u4ee4 $a=\\gcd(x,B),b=x/\\gcd(x,B)$\uff0c\u8fd9\u6837\u4e0d\u96be\u53d1\u73b0 $b$ \u7684\u7ea6\u6570\u4e2a\u6570\u6700\u5927\u4e3a $16$\uff08\u5f53\u7136\u8fd8\u6709\u5c11\u91cf\u7684\u51e0\u4e2a\u4e3a $32$\uff0c\u5982 $2^3\\times3^2\\times7\\times11\\times13$\uff0c\u4f46\u8fd9\u6837\u7684\u6570\u8fd8\u662f\u975e\u5e38\u5c11\u7684\uff09\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u8c03\u6574 $B$ \u7684\u8d28\u56e0\u6570\u7ec4\u5408\uff08\u4e0d\u8fc7\u6211\u61d2\u5f97\u641e\u4e86\uff09\uff0c\u4e0d\u8fc7\u6574\u4f53\u4e0a\u6765\u8bf4\u8fd8\u662f\u4e0d\u9519\u7684\u3002\n\n\u9884\u5904\u7406\u590d\u6742\u5ea6\u4e3a $O(n\\ln n\\times d(B))$\uff0c\u8be2\u95ee\u590d\u6742\u5ea6\u7ea6\u4e3a $O(16\\times n\\sqrt T)$\u3002",
        "postTime": 1646914505,
        "uid": 99506,
        "name": "_LHF_",
        "ccfLevel": 0,
        "title": "\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c \u83ab\u961f\u505a\u6cd5"
    },
    {
        "content": "[P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240)\n\n## Description\n\n- \u591a\u6d4b\uff0c$t$ \u7ec4\u6570\u636e\u3002\n\n- \u6bcf\u6b21\u7ed9\u5b9a\u4e24\u4e2a\u6574\u6570 $n, m$\uff0c\u8bf7\u6c42\u51fa\n  $$\n  \\left[ \\sum_{i = 1}^n \\sum_{j = 1}^m \\varphi(ij) \\right] \\bmod 998244353\n  $$\n\n- $1\\le t\\le 10^4$\uff0c$1\\le n, m\\le 10^5$\u3002\n\n## Solution\n\n\u5f15\u7406\uff1a\n$$\n\\varphi(ij) = \\dfrac{\\varphi(i) \\varphi(j) \\gcd(i, j)}{\\varphi(\\gcd(i, j))}\n$$\n\n> \u8bc1\u660e\uff1a\n $$\n \\begin{aligned}\n \\varphi(i) \\varphi(j) \\gcd(i, j)\n & = i \\prod_{p_1\\in \\mathbb{P}, p_1\\mid i} \\dfrac{p_1 - 1}{p_1} \\cdot j \\prod_{p_2\\in \\mathbb{P}, p_2\\mid j} \\dfrac{p_2 - 1}{p_2} \\cdot \\gcd(i, j) \\\\\n & = ij \\gcd(i, j) \\left(\\prod_{p_1\\in \\mathbb{P}, p_1\\mid i} \\dfrac{p_1 - 1}{p_1} \\prod_{p_2\\in \\mathbb{P}, p_2\\mid j} \\dfrac{p_2 - 1}{p_@} \\right)\n \\end{aligned}\n $$\n> \u4f60\u4f1a\u53d1\u73b0\u6240\u6709 $\\gcd(i, j)$ \u7684\u8d28\u56e0\u6570\u90fd\u88ab\u7b97\u4e86 $2$ \u6b21\u3002\n $$\n \\begin{aligned}\n & = \\left(ij\\prod_{p_1\\in \\mathbb{P}, p_1\\mid ij} \\dfrac{p_1 - 1}{p_1} \\right) \\cdot \\left(\\gcd(i, j) \\prod_{p_2\\in \\mathbb{P}, p_2\\mid \\gcd(i, j)} \\dfrac{p_2 - 1}{p_2} \\right) \\\\\n & = \\varphi(ij) \\varphi(\\gcd(i, j))\n \\end{aligned}\n $$\n> \u628a $\\varphi(\\gcd(i, j))$ \u9664\u8fc7\u53bb\u5373\u53ef\u3002\n\n\u4e0d\u59a8\u8bbe $n\\le m$\uff0c\u6839\u636e\u5f15\u7406\uff0c\u6709\n$$\n\\begin{aligned}\nans\n& = \\sum_{i = 1}^n \\sum_{j = 1}^m \\dfrac{\\varphi(i) \\varphi(j) \\gcd(i, j)}{\\varphi(\\gcd(i, j))} \\\\\n& = \\sum_{d = 1}^n \\sum_{i = 1}^n \\sum_{j = 1}^m \\dfrac{\\varphi(i) \\varphi(j) d}{\\varphi(d)} [\\gcd(i, j) = d] \\\\\n& = \\sum_{d = 1}^n \\dfrac{d}{\\varphi(d)} \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} \\varphi(id) \\varphi(jd) [\\gcd(i, j) = 1] \\\\\n& = \\sum_{d = 1}^n \\dfrac{d}{\\varphi(d)} \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\varphi(id) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} \\varphi(jd) [\\gcd(i, j) = 1] \\\\\n& = \\sum_{d = 1}^n \\dfrac{d}{\\varphi(d)} \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\varphi(id) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} \\varphi(jd) \\sum_{k\\mid \\gcd(i, j)} \\mu(k) \\\\\n& = \\sum_{d = 1}^n \\dfrac{d}{\\varphi(d)} \\sum_{k = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\mu(k) \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{dk}\\right\\rfloor} \\varphi(idk) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{dk}\\right\\rfloor} \\varphi(jdk) \\\\\n& = \\sum_{T = 1}^n \\sum_{d\\mid T} \\dfrac{d}{\\varphi(d)} \\mu\\left(\\dfrac{T}{d}\\right) \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\varphi(iT) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} \\varphi(jT)\n\\end{aligned}\n$$\n\u5176\u4e2d\n$$\nf(n) = \\sum_{d\\mid n} \\dfrac{d\\, \\mu\\left(\\dfrac{n}{d}\\right)}{\\varphi(d)}\n$$\n\u4e0d\u662f\u79ef\u6027\u51fd\u6570\uff08\u5b83\u751a\u81f3\u4e0d\u4e00\u5b9a\u662f\u6574\u6570\uff09\uff0c\u76f4\u63a5\u9884\u5904\u7406\u9006\u5143 $\\Theta(n\\ln n)$ \u8ba1\u7b97\u3002\n\n\u5bf9\u4e8e\n$$\n\\sum_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\varphi(iT) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} \\varphi(jT)\n$$\n\u53d1\u73b0\u8fd9\u4e1c\u897f\u5e26\u4e24\u4e2a\u53c2\u6570\uff0c\u4ee4\n$$\ng(k, n) = \\sum_{i = 1}^n \\varphi(ik)\n$$\n\u4f60\u6709\u9012\u63a8\u5f0f\n$$\ng(k, n) = g(k, n - 1) + \\varphi(nk)\n$$\n\u800c\u6b64\u5904\u7684 $nk\\le n\\textsf{(\u9898\u76ee\u4e2d\u7684 } n \\textsf{)}$\uff0c\u4e5f\u53ef\u4ee5 $\\Theta(n\\ln n)$ \u9884\u5904\u7406\uff0c$g$ \u6570\u7ec4\u7528 `vector` \u5b58\u3002\n\n\u4ee3\u56de\u53bb\n$$\nans = \\sum_{T = 1}^n f(T) g\\left(T, \\left\\lfloor\\dfrac{n}{T}\\right\\rfloor \\right) g\\left(T, \\left\\lfloor\\dfrac{m}{T}\\right\\rfloor \\right)\n$$\n\u8fd9\u4e2a $g$ \u5e26\u4e00\u4e2a $T$\uff0c\u65e0\u6cd5\u6574\u9664\u5206\u5757\uff0c\u53ea\u80fd\u66b4\u529b\u7b97\u3002\n\n\u6b64\u65f6\u662f $\\Omicron(n\\ln n)$ \u7684\u9884\u5904\u7406\uff0c$\\Omicron(n)$ \u7684\u5355\u6b21\u56de\u7b54\uff0c\u8fc7\u4e0d\u53bb\u3002\n\n------\n\n\u8bbe\n$$\nh(n, m, l) = \\sum_{T = 1}^l f(T) g\\left(T, n \\right) g\\left(T, m \\right)\n$$\n\u8fd9\u6837\u5728\u6574\u9664\u5206\u5757\u4e2d\n$$\nh\\left(\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{l}\\right\\rfloor, r \\right) - h\\left(\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{l}\\right\\rfloor, l - 1 \\right)\n$$\n\u53c8\u6709\u9012\u63a8\u5f0f\n$$\nh(n, m, l) = h(n, m, l - 1) + f(l) g(l, n) g(l, m)\n$$\n\u6709 $\\max(n, m) l\\le n \\textsf{(\u9898\u76ee\u4e2d\u7684 } n \\textsf{)}$\u3002\n\n$h$ \u6570\u7ec4\u540c\u6837\u7528 `vector` \u5b58\u3002\n\n\u6b64\u65f6\u662f\n$$\n\\begin{aligned}\n\\Omicron\\left(k \\sum_{i = 1}^k \\dfrac{n}{i} \\right)\n& = \\Omicron\\left(k \\cdot \\int_1^k \\dfrac{n}{x} \\, dx \\right) \\\\\n& = \\Omicron(k\\cdot n \\ln k) \\\\\n& = \\Omicron(nk \\ln k)\n\\end{aligned}\n$$\n\u7684\u9884\u5904\u7406\uff0c$\\Omicron(\\sqrt{n})$ \u7684\u5355\u6b21\u56de\u7b54\uff0c\u9884\u5904\u7406\u4f1a $\\text{MLE} + \\text{TLE}$\u3002\n\n------\n\n\u65e2\u7136\u4e24\u79cd\u65b9\u6cd5\u90fd\u4e0d\u884c\uff0c\u90a3\u4e48\u81ea\u7136\u60f3\u5230 **\u7528\u6839\u53f7\u5206\u6cbb\u6765\u5e73\u8861\u65f6\u95f4**\u3002\n\n\u8bbe\u9608\u503c\u4e3a $k$\uff0c\u8868\u793a\u5bf9\u4e8e $\\le k$ \u7684\u90e8\u5206\u9884\u5904\u7406\u3002\n\n\u4e8e\u662f\u5f53 $\\left\\lfloor\\dfrac{m}{l}\\right\\rfloor \\le k$\uff0c\u5373 $l > \\left\\lfloor\\dfrac{m}{k}\\right\\rfloor$ \u7684\u90e8\u5206\u7528\u5df2\u7ecf\u9884\u5904\u7406\u8fc7\u7684 $h$ \u6574\u9664\u5206\u5757\u7b97\uff0c\u5f53 $l \\le \\left\\lfloor\\dfrac{m}{k}\\right\\rfloor$ \u65f6\u76f4\u63a5\u66b4\u529b\u7b97\u3002\n\n- \u66b4\u529b\uff1a$\\Omicron(n\\ln n) + \\Omicron\\left(\\dfrac{tn}{k} \\right)$\n- \u5206\u5757\uff1a$\\Omicron(nk \\ln k) + \\Omicron(t\\sqrt{n})$\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Omicron\\left(nk \\ln k + t\\left(\\dfrac{n}{k} + \\sqrt{n} \\right) \\right)$\uff0c\u63d0\u4e2a\u516c\u56e0\u6570\u5c31\u662f $k\\ln k + \\dfrac{t}{k}$ \u6700\u5c0f\u3002\n\n\u5199\u4e2a\u7a0b\u5e8f\u53bb\u7b97\n\n```cpp\n\tint t = 1e4;\n\tint ans = 0x3f3f3f3f, pos = 0;\n\tfor (int k = 1; k <= t; k++)\n\t{\n\t\tint res = k * log(k) + t / k;\n\t\tif (res < ans)\n\t\t{\n\t\t\tans = res, pos = k;\n\t\t}\n\t}\n\tprintf(\"%d %d\\n\", ans, pos);\n```\n\n\u8f93\u51fa\n\n```cpp\n392 47\n```\n\n\u6240\u4ee5\u53d6 $k = 47$\u3002\n\n\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $\\Omicron(nk\\ln k)$\u3002\n\n\u7136\u800c\u5b9e\u6d4b $k$ \u53d6 $60\\sim 70$ \u66f4\u5feb\uff08\n\n## Code\n\n```cpp\n// 18 = 9 + 9 = 18.\n#include <iostream>\n#include <cstdio>\n#include <vector>\n#define Debug(x) cout << #x << \"=\" << x << endl\ntypedef long long ll;\nusing namespace std;\n\nconst int MAXN = 1e5 + 5;\nconst int N = 1e5;\nconst int MAXK = 47 + 5;\nconst int K = 47;\nconst int MOD = 998244353;\n\ntypedef int arr[MAXN];\n\nint add(int a, int b)\n{\n\treturn (a + b) % MOD;\n}\n\nint sub(int a, int b)\n{\n\treturn (a - b + MOD) % MOD;\n}\n\nint mul(int a, int b)\n{\n\treturn (ll)a * b % MOD;\n}\n\nint qpow(int a, int b)\n{\n\tint base = a, ans = 1;\n\twhile (b)\n\t{\n\t\tif (b & 1)\n\t\t{\n\t\t\tans = (ll)ans * base % MOD;\n\t\t}\n\t\tbase = (ll)base * base % MOD;\n\t\tb >>= 1;\n\t}\n\treturn ans;\n}\n\nint inv(int a)\n{\n\treturn qpow(a, MOD - 2);\n}\n\narr p, mu, phi, phi_pro, phi_pro_inv, phi_inv, f;\nbool vis[MAXN];\nvector<int> g[MAXN], h[MAXK][MAXK];\n\nvoid pre()\n{\n\tmu[1] = phi[1] = 1;\n\tfor (int i = 2; i <= N; i++)\n\t{\n\t\tif (!vis[i])\n\t\t{\n\t\t\tp[++p[0]] = i;\n\t\t\tmu[i] = MOD - 1;\n\t\t\tphi[i] = i - 1;\n\t\t}\n\t\tfor (int j = 1; j <= p[0] && i * p[j] <= N; j++)\n\t\t{\n\t\t\tvis[i * p[j]] = true;\n\t\t\tif (i % p[j] == 0)\n\t\t\t{\n\t\t\t\tmu[i * p[j]] = 0;\n\t\t\t\tphi[i * p[j]] = phi[i] * p[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i * p[j]] = MOD - mu[i];\n\t\t\tphi[i * p[j]] = phi[i] * phi[p[j]];\n\t\t}\n\t}\n\t\n\tphi_pro[0] = phi_inv[1] = 1;\n\tfor (int i = 1; i <= N; i++)\n\t{\n\t\tphi_pro[i] = mul(phi_pro[i - 1], phi[i]);\n\t}\n\tphi_pro_inv[N] = inv(phi_pro[N]);\n\tfor (int i = N - 1; i >= 1; i--)\n\t{\n\t\tphi_pro_inv[i] = mul(phi_pro_inv[i + 1], phi[i + 1]);\n\t\tphi_inv[i + 1] = mul(phi_pro_inv[i + 1], phi_pro[i]);\n\t}\n\t\n\tfor (int i = 1; i <= N; i++)\n\t{\n\t\tfor (int j = 1; i * j <= N; j++)\n\t\t{\n\t\t\tf[i * j] = add(f[i * j], mul(mul(i, mu[j]), phi_inv[i]));\n\t\t}\n\t}\n\t\n\tfor (int k = 1; k <= N; k++)\n\t{\n\t\tg[k].resize(N / k + 5);\n\t\tfor (int n = 1; n * k <= N; n++)\n\t\t{\n\t\t\tg[k][n] = add(g[k][n - 1], phi[n * k]);\n\t\t}\n\t}\n\t\n\tfor (int n = 1; n <= K; n++)\n\t{\n\t\tfor (int m = n; m <= K; m++)\n\t\t{\n\t\t\th[n][m].resize(N / m + 5);\n\t\t\tfor (int l = 1; m * l <= N; l++)\n\t\t\t{\n\t\t\t\th[n][m][l] = add(h[n][m][l - 1], mul(f[l], mul(g[l][n], g[l][m])));\n\t\t\t}\n\t\t}\n\t}\n}\n\nint block(int n, int m)\n{\n\tint res = 0;\n\tfor (int i = 1; i <= m / K; i++)\n\t{\n\t\tres = add(res, mul(f[i], mul(g[i][n / i], g[i][m / i])));\n\t}\n\tfor (int l = m / K + 1, r; l <= n; l = r + 1)\n\t{\n\t\tint k1 = n / l, k2 = m / l;\n\t\tr = min(n / k1, m / k2);\n\t\tres = add(res, sub(h[k1][k2][r], h[k1][k2][l - 1]));\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tpre();\n\tint t;\n\tscanf(\"%d\", &t);\n\twhile (t--)\n\t{\n\t\tint n, m;\n\t\tscanf(\"%d%d\", &n, &m);\n\t\tif (n > m)\n\t\t{\n\t\t\tswap(n, m);\n\t\t}\n\t\tprintf(\"%d\\n\", block(n, m));\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1643031131,
        "uid": 305532,
        "name": "mango09",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011Luogu-P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c"
    },
    {
        "content": "### \u9898\u610f\n\n- \u7ed9\u5b9a $n,m$\uff0c\u6c42 $\\displaystyle \\sum_{i=1}^n\\sum_{j=1}^m \\varphi(ij)$\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\u591a\u7ec4\u6d4b\u8bd5\u6570\u636e\u3002\n- $1\\le T\\le 10^4,1\\le n,m\\le 10^5$\n\n### \u505a\u6cd5\n\n**\u83ab\u53cd+\u6839\u53f7\u5206\u6cbb** \u795e\u4ed9\u9898\n\n$\\varphi$ \u91cc\u9762\u662f $i\\cdot j$\uff0c\u611f\u89c9\u4e0d\u592a\u597d\u505a\uff0c\u8003\u8651\u5c06\u5176\u62c6\u5f00\u6765\u3002\n\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u795e\u5947\u7684\u6027\u8d28\uff1a $\\varphi(ij)=\\dfrac {\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$\u3002\n\n\u8bc1\u660e\u7684\u8bdd\uff0c\u6839\u636e $\\varphi(x)=x\\prod\\limits_{p\\mid x}\\frac{p-1}p$ \u4e00\u5c55\u5f00\u5c31\u6ca1\u4e86\u3002\u7a0d\u5fae\u5199\u4e00\u4e0b\uff1a\n\n$$\\begin{aligned}\\varphi(ij)\\varphi(\\gcd(i,j))&=ij\\prod_{p\\mid ij}\\frac{p-1}p\\gcd(i,j)\\prod_{p\\mid \\gcd(i,j)}\\frac{p-1}p\\\\&=i\\prod_{p\\mid i}\\frac{p-1}pj\\prod_{p\\mid j}\\frac{p-1}p\\gcd(i,j)\\\\&=\\varphi(i)\\varphi(j)\\gcd(i,j) \\end{aligned}$$\n\n\u7136\u540e\u66b4\u529b\u63a8\u5f0f\u5b50\uff1a\n\n$$\\begin{aligned}\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)&=\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}\\\\&=\\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^m\\dfrac{\\varphi(i)\\varphi(j)d\\left[\\gcd(i,j)=d\\right]}{\\varphi(d)}&\\color{pink}\\text{\u679a\u4e3e gcd}\\\\&=\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)\\left[\\gcd(i,j)=d\\right]\\\\&=\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)\\left[\\gcd\\left(\\frac{i}{d},\\frac{j}d\\right)=1\\right]\\\\&=\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\sum_{j=1}^{\\left\\lfloor\\frac{m}d\\right\\rfloor}\\varphi(id)\\varphi(jd)\\left[\\gcd(i,j)=1\\right]&\\color{pink}\\text{\u679a\u4e3e }\\frac{i}d,\\frac{j}d\\\\&=\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\sum_{j=1}^{\\left\\lfloor\\frac{m}d\\right\\rfloor}\\varphi(id)\\varphi(jd)\\sum_{k\\mid \\gcd(i,j)}\\mu(k)&\\color{pink}\\text{Mobius inversion!}\\\\&=\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{k=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\mu(k)\\sum_{i=1}^{\\left\\lfloor\\frac{n}{dk}\\right\\rfloor}\\sum_{j=1}^{\\left\\lfloor\\frac{m}{dk}\\right\\rfloor}\\varphi(idk)\\varphi(jdk)&\\color{pink}\\text{\u679a\u4e3e }k\\\\&=\\sum_{t=1}^n\\sum_{d\\mid t}\\dfrac{d\\cdot\\mu\\left(\\frac{t}{d}\\right)}{\\varphi(d)}\\sum_{i=1}^{\\left\\lfloor\\frac{n}{t}\\right\\rfloor}\\varphi(it)\\sum_{j=1}^{\\left\\lfloor\\frac{m}{t}\\right\\rfloor}\\varphi(jt)&\\color{pink}\\text{\u679a\u4e3e }t=dk \\end{aligned}$$\n\n\u4ee4 $\\displaystyle f(n)=\\sum_{d\\mid n}\\frac{d\\cdot \\mu\\left(\\frac{n}d\\right)}{\\varphi(d)}$\uff0c\u5219\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e $1$ \u5230 $n$\uff0c\u7136\u540e\u679a\u4e3e\u5176\u500d\u6570\u53ef\u4ee5 $O(n\\ln n)$ \u6c42\u5f97\u3002\n\n\u4ee4 $\\displaystyle g(k,n)=\\sum_{i=1}^n \\varphi(ik)$\uff0c\u6709\u9012\u63a8\u5f0f $g(i,j)=g(i,j-1)+\\varphi(ij)$\uff0c\u8fd9\u4e00\u90e8\u5206\u590d\u6742\u5ea6\u540c\u6837\u662f $O(n\\ln n)$\u3002\n\n\u628a $f,g$ \u5e26\u56de\u539f\u5f0f\uff0c\u5f97\uff1a\n\n$$\\displaystyle \\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)=\\sum_{t=1}^nf(t)\\cdot{g}\\left(t,\\left\\lfloor\\frac{n}{t}\\right\\rfloor\\right)\\cdot{g\\left(t,\\left\\lfloor{\\frac{m}{t}}\\right\\rfloor\\right)}$$\n\n\u53ef\u60dc\u7684\u662f\uff0c$g$ \u4e2d\u6709 $t$ \u6574\u51fa\u5206\u5757\u4e0d\u4e86\u3002\u628a\u6574\u4e2a\u5f0f\u5b50\u8bbe\u51fa\u6765\uff0c\u4ee4\uff1a\n\n$$\\displaystyle h(a,b,n)=\\sum_{t=1}^n f(t)\\cdot{g(t,a)}\\cdot{g(t,b)}$$\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u8fd9\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6574\u9664\u5206\u5757\u7684\u9996\u5c3e\u4e24\u7aef\u7684\u5dee\u5206\u5f62\u5f0f\uff1a\n\n$$\\displaystyle h(a,b,n)=\\sum_{\\left\\lfloor{\\frac{n}{l}}\\right\\rfloor=\\left\\lfloor{\\frac{n}{r}}\\right\\rfloor \\text{and} \\left\\lfloor{\\frac{m}{l}}\\right\\rfloor=\\left\\lfloor{\\frac{m}{r}}\\right\\rfloor}h\\left({\\left\\lfloor{\\frac{n}{r}}\\right\\rfloor},{\\left\\lfloor{\\frac{m}{r}}\\right\\rfloor},r\\right)-h\\left({\\left\\lfloor{\\frac{n}{l}}\\right\\rfloor},{\\left\\lfloor{\\frac{m}{l}}\\right\\rfloor},l\\right)$$\n\n\u5982\u4eca\u7684\u95ee\u9898\u5c31\u5728\u4e8e\u600e\u4e48\u6c42 $h$ \u4e86\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5982\u679c\u5168\u90e8\u9884\u5904\u7406\uff0c\u4f1a $\\color{MidNightBlue}\\text{TLE}$ \u98de\u3002\u600e\u4e48\u529e\uff1f\u6211\u4eec\u8003\u8651 **\u6839\u53f7\u5206\u6cbb**\uff0c\u4f18\u7f8e\u5730\u5c06\u9884\u5904\u7406\u548c\u67e5\u8be2\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5e73\u8861\u4e00\u4e0b\u3002\n\n$l,r$ \u8d8a\u5927\uff0c\u6574\u9664\u5206\u5757\u7684\u90a3\u4e00\u5757\u5c31\u66f4\u5927\uff0c\u76f8\u5bf9\u66f4\u5177\u4f18\u52bf\u3002\u6240\u4ee5\u8003\u8651\u5728 $l,r$ \u8f83\u5c0f\u65f6\u66b4\u529b\u3002\n\n\u8bbe\u9608\u503c\u4e3a $B$\uff0c\u9884\u5904\u7406 $h\\left({1,1,1}\\right)$ \u81f3 $h\\left(B,B,n\\right)$\u3002\n\n\u600e\u4e48\u9884\u5904\u7406\uff1f $h\\left(j,k,i\\right)=h\\left(j,k,i-1\\right)+f(i)\\cdot{g(i,j)}\\cdot{g(i,k)}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(nB^2)$ \u7684\u3002\n\n\u9884\u5904\u7406\u89e3\u51b3\u4e86\uff0c\u67e5\u8be2\u5462\uff1f\n\n\u5bf9\u4e8e\u6240\u6709\u7684 $\\left\\lfloor{\\dfrac{n}{r}}\\right\\rfloor\\le B$ \u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2\uff0c\u5426\u5219 $r\\le \\left\\lfloor{\\dfrac{n}{B}}\\right\\rfloor$\uff0c\u66b4\u529b\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a $O\\left(n\\ln n+nB^2+T\\left(\\sqrt n+\\frac{n}B\\right)\\right)$\u3002\n\n\u5f53 $B$ \u53d6 $50$ \u5de6\u53f3\uff0c\u8dd1\u5f97\u6bd4\u8f83\u5feb\u3002\u76ee\u524d\u662f rk2\uff1f\n\n### \u4ee3\u7801\n\n```c++\n#include<bits/stdc++.h>\n#define mod 998244353\nusing namespace std;\nconst int B=50;\nvector<int> g[100005];\nvector<int> t[60][60];\nint f[100005],mu[100005],cnt;\nint phi[100005],inv[100005],prime[100005];\nbitset<100005>used;\ninline int read()\n{\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-f;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n\treturn x*f;\n}\ninline int ksm(int a,int b)\n{\n\tint res=1,p=a;\n\twhile(b)\n\t{\n\t\tif(b&1)\tres=1ll*res*p%mod;\n\t\tp=1ll*p*p%mod;b>>=1;\n\t}\n\treturn res;\n}\ninline void add(int &a,int b){int t=a+b;a=t>=mod?t-mod:t;}\ninline void init(int n)\n{\n\tmu[1]=1,phi[1]=1;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tif(!used[i])\tprime[++cnt]=i,mu[i]=-1,phi[i]=i-1;\n\t\tfor(int j=1;j<=cnt&&i*prime[j]<=n;j++)\n\t\t{\n\t\t\tint t=i*prime[j];used[t]=1;\n\t\t\tif(i%prime[j])\tmu[t]=-mu[i],phi[t]=phi[i]*(prime[j]-1);\n\t\t\telse{phi[t]=phi[i]*prime[j];break;}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\tinv[i]=ksm(phi[i],mod-2);\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n/i;j++)\n\t\t\tadd(f[i*j],(1ll*i*mu[j]*inv[i]%mod+mod)%mod);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tg[i].resize(n/i+10);g[i][0]=0;\n\t\tfor(int j=1;j<=n/i;j++)\n\t\t\tg[i][j]=(g[i][j-1]+phi[i*j])%mod;\n\t}\n\tfor(int j=1;j<=B;j++)\n\t\tfor(int k=j;k<=B;k++)\n\t\t{\n\t\t\tt[j][k].resize(n/k+10);t[j][k][0]=0;\n\t\t\tfor(int i=1;i<=n/k;i++)\n\t\t\t\tt[j][k][i]=(t[j][k][i-1]+1ll*f[i]*g[i][j]%mod*g[i][k]%mod)%mod;\n\t\t}\n}\ninline int solve(int n,int m)\n{\n\tint res=0;\n\tfor(int i=1;i<=m/B;i++)\tadd(res,1ll*f[i]*g[i][n/i]%mod*g[i][m/i]%mod);\n\tfor(int l=m/B+1,r;l<=n;l=r+1)\n\t{\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tadd(res,(t[n/l][m/l][r]-t[n/l][m/l][l-1]+mod)%mod);\n\t}\n\treturn res;\n}\nint main()\n{\n\tint tc=read();\n\tinit(100000);\n\twhile(tc--)\n\t{\n\t\tint n=read(),m=read();\n\t\tif(n>m)\tswap(n,m);\n\t\tprintf(\"%d\\n\",solve(n,m));\n\t}\n\treturn 0;\n}\n```\n\n\n\n\n\n",
        "postTime": 1638590480,
        "uid": 181775,
        "name": "_Fontainebleau_",
        "ccfLevel": 0,
        "title": "\u300cP4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u300d"
    },
    {
        "content": "\u6027\u8d28\uff1a$\\varphi(ij)=\\dfrac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$\n\n\u6211\u4eec\u5047\u8bbe $n\\leq m$\uff0c\u53ef\u5c06\u539f\u5f0f\u5316\u7b80\uff1a\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)$$\n$$=\\sum_{i=1}^n\\sum_{j=1}^m\\dfrac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$$\n$$=\\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^m\\dfrac{\\varphi(i)\\varphi(j)d[\\gcd(i,j)=d]}{\\varphi(d)}$$\n$$=\\sum_{d=1}^n\\dfrac{d}{\\varphi(d)}\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i)\\varphi(j)[\\gcd(i,j)=d]$$\n$$=\\sum_{d=1}^n\\dfrac{d}{\\varphi(d)}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(id)\\varphi(jd)[\\gcd(i,j)=1]$$\n$$=\\sum_{d=1}^n\\dfrac{d}{\\varphi(d)}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(id)\\varphi(jd)\\epsilon(\\gcd(i,j))$$\n\u53c8\u56e0\u4e3a $\\mu\\ast\\operatorname{I}=\\epsilon$\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u539f\u5f0f\u8f6c\u5316\u4e3a\uff1a\n$$=\\sum_{d=1}^n\\dfrac{d}{\\varphi(d)}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(id)\\varphi(jd)\\sum_{t|\\gcd(i,j)}\\mu(t)$$\n$$=\\sum_{d=1}^n\\dfrac{d}{\\varphi(d)}\\sum_{t=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(t)\\sum_{i=1}^{\\lfloor\\frac{n}{dt}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{dt}\\rfloor}\\varphi(idt)\\varphi(jdt)$$\n\u8bbe $k=dt$\uff0c\u5219\u53ef\u4ee5\u7ee7\u7eed\u5316\u7b80\uff1a\n$$=\\sum_{k=1}^n\\sum_{d|k}\\dfrac{d\\mu(\\frac{k}{d})}{\\varphi(d)}\\sum_{i=1}^{\\lfloor\\frac{n}{dt}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{dt}\\rfloor}\\varphi(ik)\\varphi(jk)$$\n$$=\\sum_{k=1}^n\\sum_{d|k}\\dfrac{d\\mu(\\frac{k}{d})}{\\varphi(d)}\\sum_{i=1}^{\\lfloor\\frac{n}{k}\\rfloor}\\varphi(ik)\\sum_{j=1}^{\\lfloor\\frac{m}{k}\\rfloor}\\varphi(jk)$$\n\u8bbe\uff1a \n$$f(n)=\\sum_{d|n}\\dfrac{d\\mu(\\frac{n}{d})}{\\varphi(d)}$$\n$$g(k,n)=\\sum_{i=1}^n\\varphi(ik)$$\n\u6240\u4ee5\u539f\u5f0f\u53ef\u4ee5\u5316\u7b80\u4e3a\uff1a\n$$=\\sum_{k=1}^nf(k)g(k,\\lfloor\\frac{n}{k}\\rfloor)g(k,\\lfloor\\frac{m}{k}\\rfloor)$$\n\u73b0\u5728\u6211\u4eec\u5c31\u9700\u8981\u77e5\u9053\u5982\u4f55\u6c42\u51fa $f(n)$ \u548c $g(k,n)$\u3002\n\n\u6c42 $f(n)$\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\uff0c\u679a\u4e3e\u6bcf\u4e00\u4e2a\u9664\u6570\uff0c\u7136\u540e\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4ed6\u7684\u500d\u6570\u5c31\u884c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n\\ln n)$\u3002\n\n\u6c42 $g(k,n)$\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u51fa $g(k,n)$ \u7684\u9012\u63a8\u5f0f\u4e3a \n$$g(k,n)=g(k,n-1)+\\varphi(nk)$$\n\u56e0\u4e3a $k\\times n\\leq10^5$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u7528\u4e00\u4e2a ```std::vector``` \u9012\u63a8\u5c31\u884c\u4e86\uff0c\u8fd9\u5757\u9884\u5904\u7406\u7684\u590d\u6742\u5ea6\u4e5f\u4e3a $O(n\\ln n)$\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u5df2\u7ecf\u9884\u5904\u7406\u51fa\u4e86 $f(n)$ \u548c $g(k,n)$\uff0c\u6c42\u7b54\u6848\u65f6\u53ea\u8981\u6574\u9664\u5206\u5757\u5c31\u884c\u4e86\u3002\n\n\u6211\u4eec\u4ee4\uff1a\n$$t(a,b,n)=\\sum_{k=1}^nf(k)g(k,a)g(k,b)$$\n\u6240\u4ee5\uff1a\n$$t(a,b,n)=t(a,b,n-1)+f(n)g(n,a)g(n,b)$$\n\u9884\u5904\u7406\u51fa $t(a,b,n)$ \u8fd9\u4e2a\u524d\u7f00\u548c\uff0c\u5c31\u53ef\u4ee5 $\\mathcal{O}(n\\sqrt n)$ \u7684\u6c42\u89e3\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u9884\u5904\u7406 $t(a,b,n)$ \u4e0d\u5149\u4f1a $\\texttt{TLE}$\uff0c\u8fd8\u4f1a $\\texttt{MLE}$\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u4f7f\u7528\u6839\u53f7\u5206\u6cbb\uff0c\u5373\u90e8\u5206\u9884\u5904\u7406\uff0c\u90e8\u5206\u66b4\u529b\u3002\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u5757\u957f $S$\uff0c\u5bf9\u4e8e $a\\leq b\\leq S$ \u7684\u60c5\u51b5\u9884\u5904\u7406\uff0c\u8fdb\u884c\u6574\u9664\u5206\u5757\uff0c\u5269\u4e0b\u7684\u60c5\u51b5\u76f4\u63a5\u66b4\u529b\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u4e3a\uff1a\n$$\\mathcal{O}(n\\ln n+S\\sum_{i=1}^{S}\\frac{n}{i}+T(\\sqrt n+\\frac{n}{S}))$$\n$$=\\mathcal{O}(n\\ln n+S\\cdot\\frac{n}{S}\\sum_{i=1}^{S}\\frac{S}{i}+T(\\sqrt n+\\frac{n}{S}))$$\n$$=\\mathcal{O}(n\\ln n+nS\\ln S+T(\\sqrt n+\\frac{n}{S}))$$\n\u5757\u957f $S$ \u4f1a\u5f71\u54cd\u590d\u6742\u5ea6\u7684\u90e8\u4f4d\u53ea\u6709 $nS\\ln S+\\dfrac{Tn}{S}$\uff0c\u9664\u4ee5 $n$\uff0c\u5f71\u54cd\u590d\u6742\u5ea6\u7684\u90e8\u5206\u4e3a $S\\ln S+\\dfrac{T}{S}$\u3002\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u679a\u4e3e $S$ \u4ece $1$ \u5230 $n$\uff0c\u5f97\u51fa\u4e00\u4e2a\u590d\u6742\u5ea6\u6700\u5c0f\u503c\uff0c\u8be5\u590d\u6742\u5ea6\u65f6\u7684 $S$ \u5373\u4e3a\u5757\u957f\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ndouble S,T,n=1e5,Omin=1e9;\nint pos;\n\nint main()\n{\n\tT=1e4;\n\tfor(S=1;S<=100000;S++)\n\t{\n\t\tdouble t=S*log(S)+T/S;\n\t\tif(t<Omin) Omin=t,pos=S;\n\t}\n\tprintf(\"S = %d\\n\",pos);\n\tdouble O=n*log(n)+n*pos*log(pos)+T*(sqrt(n)+n/pos);\n\tprintf(\"time = %lf\\n\",O);\n\treturn 0;\n}\n```\n\u8dd1\u4e86\u4e0b\u7a0b\u5e8f\uff0c\u5f97\u51fa\u5757\u957f\u4e3a $46$\uff0c\u65f6\u95f4\u5927\u7ea6\u4e3a $0.44s$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n$\\mathcal{View\\ Code}$\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5,P=998244353,S=46;\nint phi[N],mu[N],pr[N],cnt,f[N],iphi[N];bool flg[N];\nvector<int>g[N],t[S+5][S+5];\ninline void add(int &x,int y) {x=x+y>=P?x+y-P:x+y;}\ninline void mul(int &x,int y) {x=1ll*x*y%P;}\ninline int ksm(int x,int y) \n{\n\tint res=1;\n\twhile(y)\n\t{\n\t\tif(y&1) mul(res,x);\n\t\tmul(x,x),y>>=1;\n\t}\n\treturn res;\n}\nvoid init(int n)\n{\n\tphi[1]=mu[1]=flg[1]=1;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tif(!flg[i]) pr[++cnt]=i,phi[i]=i-1,mu[i]=-1;\n\t\tfor(int j=1;j<=cnt && i*pr[j]<=n;j++) \n\t\t{\n\t\t\tflg[i*pr[j]]=1;\n\t\t\tif(i%pr[j]==0) {phi[i*pr[j]]=phi[i]*pr[j],mu[i*pr[j]]=0;break;}\n\t\t\tphi[i*pr[j]]=phi[i]*phi[pr[j]],mu[i*pr[j]]=-mu[i];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) iphi[i]=ksm(phi[i],P-2);\n\tfor(int i=1;i<=n;i++)\t\n\t\tfor(int j=1;j<=n/i;j++)\n\t\t\tadd(f[i*j],(1ll*i*mu[j]*iphi[i]%P+P)%P);\n\tfor(int i=1;i<=n;i++)\t\n\t{\n\t\tg[i].resize(n/i+2);\n\t\tfor(int j=1;j<=n/i;j++)\n\t\t\tg[i][j]=(g[i][j-1]+phi[i*j])%P;\n\t}\n\tfor(int a=1;a<=S;a++)\n\t\tfor(int b=a;b<=S;b++)\n\t\t{\n\t\t\tt[a][b].resize(n/b+2);\n\t\t\tfor(int i=1;i<=n/b;i++)\n\t\t\t\tt[a][b][i]=(t[a][b][i-1]+1ll*f[i]*g[i][a]%P*g[i][b]%P)%P;\n\t\t}\n}\nint solve(int n,int m)\n{\n\tint ans=0;\n\tfor(int i=1;i<=m/S;i++) add(ans,1ll*f[i]*g[i][n/i]%P*g[i][m/i]%P);\n\tfor(int l=m/S+1,r;l<=n;l=r+1)\n\t{\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tadd(ans,(t[n/l][m/l][r]-t[n/l][m/l][l-1]+P)%P);\n\t}\n\treturn ans;\n}\n\nint main()\n{\n\tinit(1e5);\n\tint T,n,m;\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tif(n>m) swap(n,m);\n\t\tprintf(\"%d\\n\",solve(n,m));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1613361414,
        "uid": 108610,
        "name": "Dzhao",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)$$\n\n$$=\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\varphi(j)(i,j)}{\\varphi((i,j))}$$\n\n$$=\\sum_{g=1}^n\\frac{g}{\\varphi(g)}\\sum_{i=1}^{n/g}\\sum_{j=1}^{m/g}\\varphi(gi)\\varphi(gj)[i\\perp j]$$\n$$=\\sum_{g=1}^n\\frac{g}{\\varphi(g)}\\sum_k\\mu(k)\\sum_{i=1}^{\\frac{n}{gk}}\\sum_{j=1}^{\\frac{n}{gk}}\\varphi(gki)\\varphi(gkj)$$\n$$=\\sum_{T=1}^n\\left(\\sum_{g|T}\\frac{g}{\\varphi(g)}\\mu(\\frac Tg)\\right)\\left(\\sum_{i=1}^{n/T}\\varphi(Ti)\\right)\\left(\\sum_{j=1}^{m/T}\\varphi(Tj)\\right)$$\n\n\u5b9a\uff1a\n\n$$S(x,T)=\\sum_{i=1}^x\\varphi(Ti)$$\n$$H(T)=\\sum_{g|T}\\frac{g}{\\varphi(g)}$$\n\n\u5219\uff1a\n\n$$=\\sum_{T=1}^nH(T)S(\\lfloor\\frac nT\\rfloor,T)S(\\lfloor\\frac mT\\rfloor,T)$$\n\n\u5bf9 $x,T$ \u5fc5\u987b\u6709 $xT\\le\\max(n,m)$\uff0c\u5219\u6709 $O(n\\ln n)$ \u7ec4\u53ef\u80fd\u7684 $(x,T)$ \u5bf9\uff0c\u7528\u524d\u7f00\u548c\u9884\u5904\u7406 $S$ \u5373\u53ef\u505a\u5230 $O(n)$ \u8be2\u95ee\u3002\u8003\u8651\u8bbe\u8d4b\u4e88\u7ebf $B$\uff1a\n\n$$=\\sum_{T=1}^{B-1}H(T)S(\\lfloor\\frac nT\\rfloor,T)S(\\lfloor\\frac mT\\rfloor,T)+\\sum_{T=B}^nH(T)S(\\lfloor\\frac nT\\rfloor,T)S(\\lfloor\\frac mT\\rfloor,T)$$\n\n\u5bf9\u53f3\u8fb9\u6709 $\\lfloor\\frac nT\\rfloor,\\lfloor\\frac mT\\rfloor\\le \\lfloor\\frac{\\max n}{B}\\rfloor$\u3002\u8003\u8651\u6570\u8bba\u5206\u5757\u65f6\u5019\uff0c$x=\\lfloor\\frac nT\\rfloor,y=\\lfloor\\frac mt\\rfloor$\u3002\n\n\u6211\u4eec\u9700\u8981\u9ad8\u901f\u6c42\uff08\u9884\u5904\u7406\uff09\u8fd9\u4e1c\u897f\uff1a\n\n$$f(x,y,R)=\\sum_{T=1}^RH(T)S(x,T)S(y,T)$$\n\n\u5bf9\u6240\u6709 $x,y$ \u66b4\u529b\u524d\u7f00\u548c\u5373\u53ef\u3002\u6ce8\u610f\u5bf9\u67d0\u4e2a\u56fa\u5b9a $x,y$ \u53ea\u9700\u8981\u5904\u7406\u5230 $R=\\lfloor\\frac{\\max n}{\\max(x,y)}\\rfloor$\u3002\n\n\u63a5\u4e0b\u6765\u6109\u5feb\u5206\u6790\u590d\u6742\u5ea6\u3002\n\n\u9884\u5904\u7406 $S$ \u8017\u65f6\uff1a$O(n\\ln n)$\u3002  \n\u6570\u8bba\u5206\u5757\uff1a$O(T\\sqrt n)$\u3002  \n\u9884\u5904\u7406 $f$\uff1a$O(\\frac{n^3}{B^2})$\u3002  \n\u5f0f\u5b50\u8d4b\u4e88\u7ebf\u4e4b\u524d\u66b4\u529b\uff1a$O(TB)$\u3002\n\n\u8003\u8651\u5e73\u8861 $\\frac{n^3}{B^2}+TB$\uff0c\u5f97\n\n$$\\frac{d}{dB}\\left(\\frac{n^3}{B^2}+TB\\right)=T-2\\frac{n^3}{B^3}=0$$\n$$B=O(\\frac{n}{\\sqrt[3]{T}})$$\n\n\u6574\u4f53\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\ln n+Tn^{1/2}+nT^{2/3})$\u3002\n\n~~\u559c\u63d0\u6700\u4f18\u89e3~~",
        "postTime": 1612355138,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "\u6ce8\uff1a\u96c6\u5408$\\mathbb{P}$\u4e3a\u8d28\u6570\u96c6\u3002\n\n[P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240)\u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://zybuluo.com/xiaoziyao/note/1710296)\n\n## \u9898\u610f\n- \u7ed9\u5b9a$n,m$\uff0c\u6c42$\\sum_{i=1}^n\\sum_{j=1}^m \\varphi(i\\cdot j)$\uff1b\n- \u591a\u7ec4\u6570\u636e\uff0c\u6570\u636e\u7ec4\u6570$T\\leqslant 10^4$\u3002\n- \u6570\u636e\u8303\u56f4\uff1a$1\\leqslant n,m\\leqslant 10^5$\u3002\n\n## \u5206\u6790\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7ed3\u5408\u6839\u53f7\u5206\u6cbb\u597d\u9898\u3002\n\n\u9996\u5148\uff0c\u6b27\u62c9\u51fd\u6570\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\n$$\\varphi(n\\cdot m)\\cdot\\varphi(\\gcd(n,m))=\\varphi(n)\\cdot\\varphi(m)\\cdot\\gcd(n,m)$$\n\n\u8bc1\u660e\u5982\u4e0b\uff1a\n\n\u7531\u6b27\u62c9\u51fd\u6570\u7684\u516c\u5f0f\u6709\uff1a\n\n$$\\varphi(n\\cdot m)\\cdot\\varphi(\\gcd(n,m))$$\n\n$$=n\\cdot m\\cdot\\prod_{p\\mid n\\cdot m,p\\in\\mathbb{P}}\\frac{p-1}{p}\\cdot\\gcd(n,m)\\cdot\\prod_{q\\mid\\gcd(n,m),q\\in\\mathbb{P}}\\frac{q-1}{q}=n\\cdot m\\cdot\\prod_{p\\mid lcm(n,m),p\\in\\mathbb{P}}\\frac{p-1}{p}\\cdot\\prod_{q\\mid\\gcd(n,m),q\\in\\mathbb{P}}\\frac{q-1}{q}\\cdot\\gcd(n,m)$$\n\n$$=n\\cdot m\\cdot\\prod_{p\\mid n\\ and\\ p\\mid m,p\\in\\mathbb{P}}\\frac{p-1}{p}\\cdot\\prod_{q\\mid n\\ or\\ q\\mid m,q\\in\\mathbb{P}}\\frac{q-1}{q}\\cdot\\gcd(n,m)$$\n\n\u6211\u4eec\u6839\u636e\u5bb9\u65a5\u7684\u601d\u60f3\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\\varphi(n\\cdot m)\\cdot\\varphi(\\gcd(n,m))=n\\cdot\\prod_{p\\mid n,p\\in\\mathbb{P}}\\frac{p-1}{p}\\cdot m\\cdot\\prod_{q\\mid m,q\\in\\mathbb{P}}\\frac{q-1}{q}\\cdot\\gcd(n,m)$$\n\n$$=\\varphi(n)\\cdot\\varphi(m)\\cdot\\gcd(n,m)$$\n\n\u8bbe$n\\geqslant m$\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5e26\u5165\u6700\u5f00\u59cb\u7684\u5f0f\u5b50\u63a8\u4e00\u4e0b\uff1a\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i\\cdot j)=\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\cdot\\varphi(j)\\cdot\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$$\n\n\u7136\u540e\u679a\u4e3e$\\gcd$\uff08\u4e0d\u59a8\u8bbe$n\\leqslant m$\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(i\\cdot j)=\\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^m[\\gcd(i,j)==d]\\frac{\\varphi(i)\\cdot\\varphi(j)\\cdot d}{\\varphi(d)}$$\n$$=\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}[\\gcd(i,j)==1]\\frac{\\varphi(i\\cdot d)\\cdot\\varphi(j\\cdot d)\\cdot d}{\\varphi(d)}$$\n$$=\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\sum_{k\\mid\\gcd(i,j)}\\mu(k)\\cdot\\frac{\\varphi(i\\cdot d)\\cdot\\varphi(j\\cdot d)\\cdot d}{\\varphi(d)}$$\n$$=\\sum_{d=1}^n\\sum_{k=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{i=1}^{\\lfloor\\frac{n}{d\\cdot k}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d\\cdot k}\\rfloor}\\mu(k)\\cdot\\frac{\\varphi(i\\cdot d\\cdot k)\\cdot\\varphi(j\\cdot d\\cdot k)\\cdot d}{\\varphi(d)}$$\n$$=\\sum_{t=1}^n\\sum_{d\\mid t}\\frac{d}{\\varphi(d)}\\cdot\\mu(\\frac{t}{d})\\cdot\\sum_{i=1}^{\\lfloor\\frac{n}{t}\\rfloor}\\varphi(i\\cdot t)\\cdot\\sum_{j=1}^{\\lfloor\\frac{m}{t}\\rfloor}\\varphi(j\\cdot t)$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u5e76\u4e0d\u597d\u5904\u7406\uff0c\u53ef\u4ee5\u5148\u8bbe$f(x)=\\sum_{d\\mid x}\\frac{d}{\\varphi(d)}\\cdot\\mu(\\frac{x}{d})$\uff0c$g(x,y)=\\sum_{i=1}^y\\varphi(i\\cdot x)$\uff0c\u7136\u540e\u539f\u5f0f\u5316\u4e3a\uff1a\n$$\\sum_{t=1}^n f(t)\\cdot g(t,\\lfloor\\frac{n}{t}\\rfloor)\\cdot g(t,\\lfloor\\frac{m}{t}\\rfloor)$$\n\n$f(x)$\u5f88\u5bb9\u6613\u5904\u7406\uff0c\u76f4\u63a5\u679a\u4e3e\u56e0\u6570\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u603b\u4f53$O(n\\log n)$\u7684\u590d\u6742\u5ea6\u89e3\u51b3\u3002\n\n\u5173\u4e8e$g(x,y)$\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u9012\u63a8\u5f0f\uff1a$g(x,y)=g(x,y-1)+\\varphi(x\\cdot y)$\u3002\n\n\u4e0d\u59a8\u518d\u8bbe$S(x,y,z)=\\sum_{t=1}^z f(t)\\cdot g(t,x)\\cdot g(t,y)$\uff0c\u540c\u6837$S(x,y,z)=S(x,y,z-1)+f(t)\\cdot g(t,x)\\cdot g(t,y)$\n\n\u4f46\u662f$x$\u548c$y$\u7684\u5927\u5c0f\u5747\u53ef\u4ee5\u5230\u8fbe$n$\uff0c\u56e0\u6b64\u9884\u5904\u7406$g$\u662f\u4e0d\u53ef\u884c\u7684\uff0c\u90a3\u4e48\u9884\u5904\u7406$S$\u66f4\u4e0d\u884c\u4e86\u3002\n\n\u8003\u8651\u6839\u53f7\u5206\u6cbb\uff0c\u6211\u4eec\u8bbe\u4e00\u4e2a\u9608\u503c$t$\uff0c\u90a3\u4e48\u628a\u7b54\u6848\u5206\u6210\u4e24\u90e8\u5206\u8003\u8651\uff1a\n\n- \u5bf9\u4e8e\u5927\u4e8e$\\lfloor\\frac{n}{t}\\rfloor$\u7684\u7b54\u6848\u90e8\u5206\uff0c\u53ef\u4ee5\u4f7f\u7528\u6574\u9664\u5206\u5757\u52a0$S$\u7684\u9884\u5904\u7406\u6765\u89e3\u51b3\u95ee\u9898\uff0c\u5bf9\u4e8e\u6574\u9664\u5206\u5757\u4e2d\u7684\u533a\u95f4$[l,r]$\uff0c\u6211\u4eec\u7b54\u6848\u4e3a$S(\\lfloor\\frac{n}{l}\\rfloor,\\lfloor\\frac{m}{l}\\rfloor,r)-S(\\lfloor\\frac{n}{l}\\rfloor,\\lfloor\\frac{m}{l}\\rfloor,l-1)$\uff0c\u56e0\u4e3a$l,r$\u5747\u5927\u4e8e$t$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u9884\u5904\u7406$x\\leqslant t,y\\leqslant t,z\\leqslant n$\u7684\u6240\u6709$S(x,y,z)$\uff0c\u9884\u5904\u7406\u590d\u6742\u5ea6$O(n\\cdot t^2)$\uff0c\u67e5\u8be2\u590d\u6742\u5ea6$O(\\sqrt{n})$\u3002\uff08\u6ce8\u610f\uff1a\u5982\u679c\u76f4\u63a5\u5f00\u6570\u7ec4\u7a7a\u95f4\u4f1a\u70b8\uff0c\u6211\u4eec\u53ef\u4ee5\u7528$\\text{vector}$\u6765\u5b9e\u73b0\u52a8\u6001\u7533\u8bf7$S$\u7684\u7a7a\u95f4\uff09\n- \u5bf9\u4e8e\u5c0f\u4e8e\u7b49\u4e8e$\\lfloor\\frac{n}{t}\\rfloor$\u7684\u7b54\u6848\u90e8\u5206\uff0c\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u7b97\u7b54\u6848\uff0c\u5373\u66b4\u529b\u6c42$\\sum_{i=1}^{\\lfloor\\frac{n}{t}\\rfloor}f(i)\\cdot g(i,\\lfloor\\frac{n}{i}\\rfloor)\\cdot g(i,\\lfloor\\frac{m}{i}\\rfloor)$\uff0c\u56e0\u4e3a\u91cc\u9762\u9700\u8981\u7528\u5230\u7684$g(x,y)$\u6ee1\u8db3$x\\leqslant \\lfloor\\frac{n}{t}\\rfloor,y\\leqslant t$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u540c\u6837\u9884\u5904\u7406\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u6240\u6709$g$\uff0c\u9884\u5904\u7406\u590d\u6742\u5ea6\u4e3a$O(n)$\uff0c\u67e5\u8be2\u4e3a$O(\\lfloor\\frac{n}{t}\\rfloor)$\uff0c\u540c\u6837\u4e5f\u8981\u52a8\u6001\u7533\u8bf7\u7a7a\u95f4\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a$O(n\\log n+n\\cdot t^2+T\\cdot(\\sqrt{n}+\\lfloor\\frac{n}{t}\\rfloor))$\uff0c$t$\u53d6$50$\u5de6\u53f3\u53ef\u8fc7\u3002\n\n## \u4ee3\u7801\n\n```\n#include<stdio.h>\n#include<vector>\n#define int long long\nusing namespace std;\nconst int maxn=100005,mod=998244353,maxt=55;\nint T,n,m,cnt,t;\nint a[maxn],p[maxn],miu[maxn],phi[maxn],nphi[maxn],f[maxn];\nvector<int>g[maxn],S[maxt][maxt];\nint ksm(int a,int b){\n\tint res=1;\n\twhile(b){\n\t\tif(b&1)\n\t\t\tres=res*a%mod;\n\t\ta=a*a%mod,b>>=1;\n\t}\n\treturn res;\n}\nvoid init(){\n\tt=50;\n\tp[1]=miu[1]=phi[1]=1;\n\tfor(int i=2;i<maxn;i++){\n\t\tif(p[i]==0)\n\t\t\ta[++cnt]=i,miu[i]=-1,phi[i]=i-1;\n\t\tfor(int j=1;j<=cnt;j++){\n\t\t\tif(i*a[j]>=maxn)\n\t\t\t\tbreak;\n\t\t\tp[i*a[j]]=1;\n\t\t\tif(i%a[j]==0){\n\t\t\t\tmiu[i*a[j]]=0;\n\t\t\t\tphi[i*a[j]]=phi[i]*a[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmiu[i*a[j]]=-miu[i];\n\t\t\tphi[i*a[j]]=phi[i]*(a[j]-1);\n\t\t}\n\t}\n\tfor(int i=1;i<maxn;i++)\n\t\tnphi[i]=ksm(phi[i],mod-2);\n\tfor(int i=1;i<maxn;i++)\n\t\tfor(int j=1;i*j<maxn;j++)\n\t\t\tf[i*j]=(f[i*j]+i*nphi[i]%mod*miu[j])%mod;\n\tfor(int i=1;i<maxn;i++){\n\t\tg[i].push_back(0);\n\t\tfor(int j=1;i*j<maxn;j++)\n\t\t\tg[i].push_back((g[i][j-1]+phi[i*j])%mod);\n\t}\n\tfor(int i=1;i<=t;i++)\n\t\tfor(int j=1;j<=t;j++){\n\t\t\tS[i][j].push_back(0);\n\t\t\tfor(int k=1;k*max(i,j)<maxn;k++)\n\t\t\t\tS[i][j].push_back((S[i][j][k-1]+f[k]*g[k][i]%mod*g[k][j]%mod)%mod);\n\t\t}\n}\nint solve(int n,int m){\n\tint res=0,l,r;\n\tfor(int i=1;i<=max(n,m)/t;i++)\n\t\tres=(res+f[i]*g[i][n/i]%mod*g[i][m/i]%mod)%mod;\n\tl=max(n,m)/t+1;\n\twhile(l<=min(n,m)){\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tres=(res+(S[n/l][m/l][r]-S[n/l][m/l][l-1]+mod)%mod)%mod;\n\t\tl=r+1;\n\t}\n\treturn res;\n}\nsigned main(){\n\tinit();\n\tscanf(\"%lld\",&T);\n\twhile(T--){\n\t\tscanf(\"%lld%lld\",&n,&m);\n\t\tprintf(\"%lld\\n\",solve(n,m));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1602584580,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4240 \u3010\u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c\u3011"
    },
    {
        "content": "\u795e\u4ed9\u9898\u3002\n\n\u4ee5\u4e0b\u8bbe $n\\le m$\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u7ecf\u5178\u7ed3\u8bba\uff1a\n\n$$\n\\varphi(ij)\\varphi(\\gcd(i,j))=\\varphi(i)\\varphi(j)\\gcd(i,j)\n$$\n\n\u8bc1\u660e\uff1a\n\n\u6211\u4eec\u6709\n\n$$\n\\begin{aligned}\n  \\varphi(ij)\\varphi(\\gcd(i,j))\n  &=ij\\prod_{p\\mid i\\lor p\\mid j} p^{-1}\\cdot\\gcd(i,j)\\prod_{p\\mid i\\land p\\mid j} p^{-1}\\\\\n  &=\\gcd(i,j)i\\prod_{p\\mid i} p^{-1}\\cdot j\\prod_{p\\mid j} p^{-1}\\\\\n  &=\\gcd(i,j)\\varphi(i)\\varphi(j)\n\\end{aligned}\n$$\n\n\uff08\u7b2c\u4e8c\u6b65\u7531\u5bb9\u65a5\u539f\u7406\u53ef\u5f97\uff09\n\n\u56e0\u6b64\u6709\n\n$$\n\\begin{aligned}\n  &\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)\\\\\n  =&\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}\\\\\n  =&\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^n\\sum_{j=1}^m[\\gcd(i,j)=d]\\varphi(i)\\varphi(j)\\\\\n  =&\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^{\\lfloor n/d\\rfloor}\\sum_{j=1}^{\\lfloor m/d\\rfloor}[\\gcd(i,j)=1]\\varphi(id)\\varphi(jd)\\\\\n  =&\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^{\\lfloor n/d\\rfloor}\\sum_{j=1}^{\\lfloor m/d\\rfloor}\\varphi(id)\\varphi(jd)\\sum_{p\\mid i,p\\mid j}\\mu(p)\\\\\n  =&\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{p=1}^{\\lfloor n/d\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor n/dp\\rfloor}\\sum_{j=1}^{\\lfloor m/dp\\rfloor}\\varphi(idp)\\varphi(jdp)\\\\\n  =&\\sum_{t=1}^n\\sum_{d\\mid t}\\frac{d}{\\varphi(d)}\\mu(t/d)\\sum_{i=1}^{\\lfloor n/t\\rfloor}\\varphi(it)\\sum_{j=1}^{\\lfloor m/t\\rfloor}\\varphi(jt) & t=dp\\\\\n\\end{aligned}\n$$\n\n\u8bbe $f(n)=\\displaystyle\\sum_{d\\mid n}\\frac{d}{\\varphi(d)}\\mu(n/d)$\uff0c\u9884\u5904\u7406\u662f\u7b80\u5355\u7684\uff0c\u53ef\u4ee5\u505a\u5230 $O(n\\log n)$\u3002\n\n\u8bbe $g(k,n)=\\displaystyle\\sum_{i=1}^{n}\\varphi(ik)$\uff0c\u7531\u4e8e $ik\\le m$\uff0c\u663e\u7136\u6b64\u5f0f\u53ea\u6709 $O(n\\log n)$ \u79cd\u53d6\u503c\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u9884\u5904\u7406\u3002\n\n\u90a3\u4e48\u539f\u5f0f\u5c31\u6210\u4e86\n\n$$\n\\begin{aligned}\n  &\\sum_{t=1}^n\\sum_{d\\mid t}\\frac{d}{\\varphi(d)}\\mu(t/d)\\sum_{i=1}^{\\lfloor n/t\\rfloor}\\varphi(it)\\sum_{j=1}^{\\lfloor m/t\\rfloor}\\varphi(jt)\\\\\n  =&\\sum_{t=1}^nf(t)g(t,\\lfloor n/t\\rfloor)g(t,\\lfloor m/t\\rfloor)\n\\end{aligned}\n$$\n\n\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u4e0d\u592a\u597d\u6570\u8bba\u5206\u5757\uff0c\u8003\u8651\u8bbe $h(a,b,n)=\\displaystyle\\sum_{i=1}^nf(i)g(i,a)g(i,b)$\uff0c\u90a3\u4e48\u539f\u5f0f\u5373\u53ef\u6570\u8bba\u5206\u5757\uff0c\u5373\n\n$$\n\\begin{aligned}\n  &\\sum_{t=1}^nf(t)g(t,\\lfloor n/t\\rfloor)g(t,\\lfloor m/t\\rfloor)\\\\\n  =&\\sum_{\\lfloor n/l\\rfloor=\\lfloor n/r\\rfloor,\\lfloor m/l\\rfloor=\\lfloor m/r\\rfloor}h(\\lfloor n/r\\rfloor,\\lfloor m/r\\rfloor,r)-h(\\lfloor n/r\\rfloor,\\lfloor m/r\\rfloor,l-1)\\\\\n\\end{aligned}\n$$\n\n\uff08\u53ef\u4ee5\u770b\u6210\u662f\u76f4\u63a5\u5bf9 $f(t)g(t,\\lfloor n/t\\rfloor)g(t,\\lfloor m/t\\rfloor)$ \u6c42\u524d\u7f00\u548c\uff09\n\n\u4f46\u662f $h$ \u7684\u53d6\u503c\u6570\u91cf\u5f88\u591a\uff0c\u9884\u5904\u7406\u4e0d\u8bba\u662f\u65f6\u95f4\u8fd8\u662f\u7a7a\u95f4\u5f00\u9500\u90fd\u662f\u6781\u5927\u7684\u3002\n\n\u8003\u8651\u6839\u53f7\u5206\u6cbb\uff0c\u8bbe\u4e00\u4e2a\u9608\u503c $B$\uff0c\u5bf9\u4e8e $\\lfloor m/r\\rfloor\\le B$ \u7684\u6570\u9884\u5904\u7406\uff0c\u5bf9\u4e8e $\\lfloor m/r\\rfloor >B$ \u7684\u6570\uff0c\u6211\u4eec\u6709 $r<\\lfloor m/B\\rfloor$\uff0c\u8fd9\u4e00\u6bb5\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u8003\u8651 $h$ \u7684\u53d6\u503c\u6570\u91cf\u91cf\u7ea7\u3002\u5bf9\u4e8e $h(a,b,k)$\uff0c\u4e0d\u59a8\u8bbe $a\\le b$\uff0c\u6211\u4eec\u6709 $bk\\le n$\uff0c\u6545\u53d6\u503c\u6570\u91cf\u4e3a $\\displaystyle B\\sum_{i=1}^Bn/i=Bn\\sum_{i=1}^B 1/i=Bn\\log B$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n+Bn\\log B+T\\cdot(\\dfrac{n}{B}+\\sqrt{n}))$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n+Bn\\log B)$\u3002\u82e5\u8981\u6700\u5c0f\u5316\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6ee1\u8db3 $B^2\\log B=T$\uff0c\u8fd1\u4f3c\u89e3\u4e3a $B=50$\u3002\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\nusing LL = long long;\n\nconst LL kM = 998244353;\nconst int kN = 1e5 + 1, kB = 51;\n\nint t, n, m, phi[kN], mu[kN];\nLL f[kN];\nvector<LL> g[kN], h[kB][kB];\nbool v[kN];\nvector<int> pri;\n\nLL P(LL b, int e) {\n  LL s = 1;\n  for (; e; e >>= 1, b = b * b % kM) {\n    (e & 1) && (s = s * b % kM);\n  }\n  return s;\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0);\n  mu[1] = phi[1] = 1;\n  for (int i = 2; i < kN; ++i) {\n    if (!v[i]) {\n      pri.push_back(i), phi[i] = i - 1, mu[i] = -1;\n    }\n    for (int j : pri) {\n      int k = i * j;\n      if (k >= kN) {\n        break;\n      }\n      v[k] = 1;\n      if (i % j) {\n        mu[k] = -mu[i], phi[k] = phi[i] * (j - 1);\n      } else {\n        mu[k] = 0, phi[k] = phi[i] * j;\n        break;\n      }\n    }\n  }\n  for (int d = 1; d < kN; ++d) {\n    LL x = d * P(phi[d], kM - 2) % kM;\n    for (int i = 1; i * d < kN; ++i) {\n      f[i * d] = (f[i * d] + x * mu[i] % kM + kM) % kM;\n    }\n  }\n  for (int k = 1; k < kN; ++k) {\n    g[k].push_back(0);\n    for (int i = 1; i * k < kN; ++i) {\n      g[k].push_back((g[k].back() + phi[i * k]) % kM);\n    }\n  }\n  for (int i = 1; i < kB; ++i) {\n    for (int j = i; j < kB; ++j) {\n      h[i][j].push_back(0);\n      for (int k = 1; j * k < kN; ++k) {\n        h[i][j].push_back((h[i][j].back() + f[k] * g[k][i] % kM * g[k][j] % kM) % kM);\n      }\n    }\n  }\n  for (cin >> t; t--; ) {\n    cin >> n >> m;\n    if (n > m) {\n      swap(n, m);\n    }\n    LL ans = 0;\n    for (int l = 1; l <= m / kB; ++l) {\n      ans = (ans + f[l] * g[l][n / l] % kM * g[l][m / l] % kM) % kM;\n    }\n    for (int l = m / kB + 1, r; l <= n; l = r + 1) {\n      r = min(n / (n / l), m / (m / l));\n      ans = (ans + (h[n / l][m / l][r] - h[n / l][m / l][l - 1] + kM)) % kM;\n    }\n    cout << ans << '\\n';\n  }\n  return 0;\n}\n```\n",
        "postTime": 1676550162,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9898\u76f8\u5f53\u7684\u795e\u5947\uff0c\u5e76\u6ca1\u6709\u7528\u5230\u7b5b\u6cd5\u3002  \r\n\r\n\u4ee4 $d=\\gcd(x,y)$\uff0c\u5219 $\\varphi(xy)=\\frac{\\varphi (x)\\varphi(y)d}{\\varphi(d)}$\u3002  \r\n\u8bc1\u660e\uff1a  \r\n\u4e0d\u59a8\u8bbe $x=p^a,y=p^b,0<a\\le b$\u3002\u5219 $d=p^x$\u3002  \r\n\u56e0\u6b64\u6709 $\\varphi(xy)=p^{a+b-1}(p-1),\\varphi(x)\\varphi(y)=p^{a+b-2}(p-1)^2$\uff0c\u800c $\\frac{d}{\\varphi(d)}=\\frac{p}{p-1}$\uff0c\u628a\u989d\u5916\u4ea7\u751f\u7684\u4e00\u4e2a $p-1$ \u53d8\u56de $p$\u3002  \r\n\u5bf9\u4e8e $b=0$ \u7684\u60c5\u51b5 $d=1,\\varphi(d)=1$\uff0c\u4f9d\u65e7\u6210\u7acb\u3002\u53c8\u56e0\u4e3a $\\varphi$ \u662f\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e00\u822c\u60c5\u51b5\u4e0b\u4e5f\u6210\u7acb\u3002  \r\n\r\n\u4e0d\u59a8\u8bbe $n \\ge m$\uff0c\u5219\u5957\u8def\u83ab\u53cd\uff1a  \r\n$$\\begin{aligned}  \r\n&\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{m}\\varphi(ij)\\\\  \r\n=&\\sum\\limits_{d=1}^{n}\\sum\\limits_{i=1}^{\\lfloor \\frac n d\\rfloor}\\sum\\limits_{j=1}^{\\lfloor \\frac m d\\rfloor}\\frac{\\varphi(i)\\varphi(j)d}{\\varphi(d)}\\cdot[i \\bot j]\\\\  \r\n=&\\sum\\limits_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum\\limits_{k=1}^{\\lfloor \\frac n d\\rfloor }\\mu(k)\\sum\\limits_{i=1}^{\\lfloor \\frac{n}{dk}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor \\frac{m}{dk}\\rfloor}\\varphi(idk)\\varphi(jdk)\\\\  \r\n=&\\sum\\limits_{T=1}^{n}(\\sum\\limits_{d \\mid T}\\frac{d}{\\varphi(d)}\\mu(\\frac T d))(\\sum\\limits_{i=1}^{\\lfloor \\frac n T \\rfloor}\\varphi(iT))(\\sum\\limits_{i=1}^{\\lfloor \\frac m T \\rfloor}\\varphi(iT))\\\\  \r\n\\end{aligned}$$\r\n\r\n\u4ee4 $f(T)=\\sum\\limits_{d \\mid T}\\frac{d}{\\varphi(d)}\\mu(\\frac T d),g(x,y)=\\sum\\limits_{i=1}^{y}\\varphi(ix)$\uff0c\u5219\u7b54\u6848\u4e3a $\\sum\\limits_{T=1}^{n}f(T)g(T,\\lfloor\\frac n T\\rfloor)g(T,\\lfloor\\frac m T\\rfloor)$\u3002  \r\n\u8003\u8651 $f$\uff0c\u6211\u4eec\u53ef\u4ee5\u7b5b\u51fa $\\varphi,\\mu$\uff0c\u7136\u540e\u679a\u4e3e\u500d\u6570 $O(n\\ln n)$ \u505a\u3002\u5bf9\u4e8e $g$\uff0c\u6709\u6027\u8d28 $xy \\le n$\uff0c\u6240\u4ee5\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e\u5408\u6cd5\u7684 $x,y$\uff0c\u590d\u6742\u5ea6 $O(\\log n\\cdot\\sum\\limits_{i=1}^{n}\\lfloor\\frac n i\\rfloor)=O(n \\log^2 n)$\u3002\u56e0\u4e3a\u5229\u7528\u6700\u5f00\u59cb\u7684\u6027\u8d28\uff0c\u5bf9\u4e8e $1 \\le x,y \\le n$ \u53ef\u4ee5 $O(\\log n)$ \u590d\u6742\u5ea6\u6c42\u51fa $\\gcd$\uff0c\u5e76\u6c42\u51fa $\\varphi(xy)$\u3002  \r\n\r\n\u53d1\u73b0\u5377\u79ef\u5f88\u96be\u505a\u3002\u5177\u4f53\u7684\uff0c\u4e0d\u53ef\u80fd\u9884\u5904\u7406\u51fa\u6240\u6709 $T,n,m$\u3002\u6240\u4ee5\u53ea\u8003\u8651\u9884\u5904\u7406\u4e00\u90e8\u5206\u3002  \r\n\u9009\u53d6\u4e00\u4e2a $B$\uff0c\u5bf9\u4e8e $1 \\le t \\le n,1 \\le x,y \\le B$\uff0c\u6c42\u51fa $s(t,x,y)=\\sum\\limits_{i=1}^{t}f(i)g(i,x)g(i,y)$\u3002\u8fd9\u6837\u7684\u8bdd\u53ef\u4ee5\u4ee3\u5165 $T,n,m$ \u5e76\u89e3\u51b3 $\\lfloor\\frac{n}{T}\\rfloor \\le B$ \u7684\u6c42\u503c\u3002\u8fd9\u90e8\u5206\u8981\u6c42 $T \\ge \\lfloor \\frac n B \\rfloor$\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u6b64\u5904\u5f00\u59cb\u8fdb\u884c\u6574\u9664\u5206\u5757\uff0c\u6bcf\u6b21\u5dee\u5206\u7b97\u8d21\u732e $s(r,\\lfloor \\frac n l \\rfloor,\\lfloor \\frac m l \\rfloor)-s(l-1,\\lfloor \\frac n l \\rfloor,\\lfloor \\frac m l \\rfloor)$\u3002\u5bf9\u4e8e $T \\le \\lfloor \\frac n B \\rfloor$\uff0c\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u6c42\u3002  \r\n\u6982\u62ec\u7684\u8bf4\uff0c\u539f\u672c\u53ef\u4ee5\u90fd\u6574\u9664\u5206\u5757\uff0c\u4f46\u662f\u4e3a\u4e86\u5e73\u8861\u590d\u6742\u5ea6\uff0c\u53ea\u9884\u5904\u7406\u51fa\u56fa\u5b9a $n,m$ \u7684\u4e0a\u754c\u548c $T$ \u7684\u4e0b\u754c\u7684\u4e00\u90e8\u5206\uff0c\u5269\u4e0b\u7684\u679a\u4e3e $T$ \u66b4\u529b\u8ba1\u7b97\u3002  \r\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n+n\\log^2 n+nB^2+q(\\frac n B +\\sqrt n))=O(n(\\log^2 n+B^2+\\frac n B+\\sqrt n))$\u3002  \r\n\u7531\u4e8e $n,q$ \u5927\u81f4\u540c\u9636\uff0c$B$ \u5e94\u5f53\u53d6 $n^{\\frac 1 3}$\uff0c\u7136\u800c\u7a7a\u95f4\u662f $O(n+n\\log n+nB^2)=O(n\\log n+nB^2)$ \u7684\uff0c\u627f\u53d7\u4e0d\u4f4f\uff0c\u6240\u4ee5\u4ee3\u7801\u4e2d $B$ \u53d6\u7684\u662f $30$\u3002  \r\n\r\n\u7406\u8bba\u4e0a\u80fd\u8fc7\uff0c\u5b9e\u9645\u4e5f\u80fd\uff0c\u4f46\u662f\u89c9\u5f97\u5e38\u6570\u5f88\u5927\u6240\u4ee5\u5728 $nB^2$ \u7684\u5730\u65b9\u5faa\u73af\u5c55\u5f00\u4e86\u4e00\u4e0b\u3002  \r\n$g$ \u7684\u5b9a\u4e49\u91cc\u5148\u56e0\u5b50\u518d\u6b21\u6570\uff0c\u662f\u56e0\u4e3a\u957f\u5ea6\u4e0d\u5b9a\u4f7f\u7528 `vector` \u8f83\u4e3a\u65b9\u4fbf\u8fdb\u884c\u5b9e\u73b0\u3002  \r\n\r\n\r\n```cpp\r\n//g++ c.cpp -o c -g -std=c++14 -O0 -Wall -fsanitize=undefined\r\n#include<iostream>\r\n#include<cstdio>\r\n#include<vector>\r\n#include<algorithm>\r\n#include<chrono>\r\n#define LL long long\r\nusing namespace std;\r\nconst int maxr=1e6+10,maxn=1e5+10,_maxn=1e5,mod=998244353,maxsqn=33,_maxsqn=32;\r\nint N,sqn,prime[maxn],ptop=0,vis[maxn],phi[maxn],mu[maxn],s[maxn][maxsqn][maxsqn];LL ni[maxn],f[maxn];\r\nvector<int>g[maxn];\r\nint stime(){return chrono::steady_clock::now().time_since_epoch().count()/1000;}\r\nnamespace rdin{\r\n\tchar buf[maxr],*l,*r;\r\n\tinline char gtc(){if(l==r){r=(l=buf)+fread(buf,1,maxr,stdin);}return l==r?EOF:*l++;}\r\n\tinline int qd(){\r\n\t\tint rt=0;char c=gtc();\r\n\t\twhile(c<'0'||c>'9')  c=gtc();\r\n\t\twhile('0'<=c&&c<='9')  rt=(rt<<3)+(rt<<1)+(c^48),c=gtc();\r\n\t\treturn rt;\r\n\t}\r\n}\r\nusing rdin::qd;\r\nLL piphi(int x,int y){int t=__gcd(x,y);return (LL)phi[x]*phi[y]%mod*t%mod*ni[phi[t]]%mod;}\r\nint main(){\r\n\tfreopen(\"in.txt\",\"r\",stdin);int cntt=stime();\r\n\tphi[1]=mu[1]=ni[0]=ni[1]=1;for(int i=2;i<=_maxn;i++)  ni[i]=mod-mod/i*ni[mod%i]%mod;\r\n\tfor(int i=2;i<=_maxn;i++){\r\n\t\tif(!vis[i])  prime[++ptop]=i,mu[i]=-1,phi[i]=i-1;\r\n\t\tfor(int j=1;j<=ptop&&i*prime[j]<=_maxn;j++){\r\n\t\t\tvis[i*prime[j]]=1;\r\n\t\t\tif(i%prime[j])  phi[i*prime[j]]=phi[i]*phi[prime[j]],mu[i*prime[j]]=-mu[i];\r\n\t\t\telse{phi[i*prime[j]]=phi[i]*prime[j];break;}\r\n\t\t}\r\n\t}\r\n//\tprintf(\"%d us\\n\",stime()-cntt);cntt=stime();\r\n\tfor(int i=1;i<=_maxn;i++)  for(int j=i;j<=_maxn;j+=i)  (f[j]+=i*ni[phi[i]]*mu[j/i])%=mod;\r\n//\tprintf(\"%d us\\n\",stime()-cntt);cntt=stime();\r\n\tfor(int i=1;i<=_maxn;i++){//i:fac,j:times;\r\n\t\tLL sum=0;g[i].push_back(0);\r\n\t\tfor(int j=1;i*j<=_maxn;j++)  g[i].push_back((sum+=piphi(i,j))%=mod);\r\n\t}\r\n//\tprintf(\"%d us\\n\",stime()-cntt);cntt=stime();\r\n\t/*\r\n\tfor(int i=1;i<=_maxn;i++){\r\n\t\tfor(int j=1;j<=_maxsqn&&i*j<=_maxn;j++){\r\n\t\t\tLL pi=f[i]*g[i][j]%mod;\r\n\t\t\tfor(int k=1;k<=_maxsqn&&i*k<=_maxn;k++)  s[i][j][k]=(s[i-1][j][k]+pi*g[i][k])%mod;\r\n\t\t}\r\n\t}*/\r\n\tfor(int i=1;i<=_maxn;i++){\r\n\t\tfor(int j=min(_maxsqn,_maxn/i);j;j--){\r\n\t\t\tint k=min(_maxsqn,_maxn/i);LL pi=f[i]*g[i][j]%mod;\r\n\t\t\tfor(;k&7;k--)  s[i][j][k]=(s[i-1][j][k]+pi*g[i][k])%mod;\r\n//\t\t\tfor(;k;k-=8){\r\n//\t\t\t\ts[i][j][k]=(s[i-1][j][k]+pi*g[i][k])%mod;s[i][j][k-1]=(s[i-1][j][k-1]+pi*g[i][k-1])%mod;\r\n//\t\t\t\ts[i][j][k-2]=(s[i-1][j][k-2]+pi*g[i][k-2])%mod;s[i][j][k-3]=(s[i-1][j][k-3]+pi*g[i][k-3])%mod;\r\n//\t\t\t\ts[i][j][k-4]=(s[i-1][j][k-4]+pi*g[i][k-4])%mod;s[i][j][k-5]=(s[i-1][j][k-5]+pi*g[i][k-5])%mod;\r\n//\t\t\t\ts[i][j][k-6]=(s[i-1][j][k-6]+pi*g[i][k-6])%mod;s[i][j][k-7]=(s[i-1][j][k-7]+pi*g[i][k-7])%mod;\r\n//\t\t\t}\r\n\t\t\tint *p1=&s[i][j][k],*p2=&s[i-1][j][k],*p3=&g[i][k];//we can find that when only use both will be fast\r\n//\t\t\tfor(;k;k--,p1--,p2--,p3--)  p1[0]=(p2[0]+pi*p3[0])%mod;\r\n\t\t\tfor(;k;k-=8,p1-=8,p2-=8,p3-=8){\r\n\t\t\t\tp1[0]=(p2[0]+pi*p3[0])%mod;p1[-1]=(p2[-1]+pi*p3[-1])%mod;p1[-2]=(p2[-2]+pi*p3[-2])%mod;p1[-3]=(p2[-3]+pi*p3[-3])%mod;\r\n\t\t\t\tp1[-4]=(p2[-4]+pi*p3[-4])%mod;p1[-5]=(p2[-5]+pi*p3[-5])%mod;p1[-6]=(p2[-6]+pi*p3[-6])%mod;p1[-7]=(p2[-7]+pi*p3[-7])%mod;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n//\tprintf(\"%d us\\n\",stime()-cntt);cntt=stime();\r\n\tint T=qd();\r\n\twhile(T--){\r\n\t\tint N=qd(),M=qd(),i=1;LL ans=0;if(N<M)  swap(N,M);\r\n\t\tfor(;i<=N/_maxsqn;i++)  (ans+=f[i]*g[i][N/i]%mod*g[i][M/i]%mod)%=mod;\r\n\t\tfor(int l=i,r;l<=M;l=r+1){r=min(N/(N/l),M/(M/l));(ans+=s[r][N/l][M/l]-s[l-1][N/l][M/l])%=mod;}\r\n\t\tprintf(\"%lld\\n\",(ans+mod)%mod);\r\n\t}\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1676462242,
        "uid": 142549,
        "name": "hbhz_zcy",
        "ccfLevel": 0,
        "title": "solution-P4240"
    },
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a $n$ \u548c $m$\uff0c\u6c42 $\\sum\\limits_{i = 1}^n\\sum\\limits_{j=1}^m\\varphi(ij)\\bmod{998244353}$\uff08$n \\le 10^5$\uff0c$m \\le 10^5$\uff09\n\n## \u524d\u7f6e\u77e5\u8bc6\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u675c\u6559\u7b5b\n\n## \u5206\u6790\n\n\u4e3a\u4e86\u53d8\u5f62\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u6211\u4eec\u9700\u8981\u5229\u7528\u6b27\u62c9\u51fd\u6570\u7684\u4e00\u4e2a\u6027\u8d28\uff1a$\\varphi(ij) = \\dfrac{\\varphi(i)\\varphi(j)\\gcd(i, j)}{\\varphi(\\gcd(i, j))}$\n\n\u8fd9\u4e2a\u6027\u8d28\u7684\u8bc1\u660e\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u8d28\u56e0\u6570\u5206\u89e3\u5c55\u5f00\u6b27\u62c9\u51fd\u6570\u548c\u6700\u5927\u516c\u56e0\u6570\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u7528\u6027\u8d28\u540e\u6309\u5957\u8def\u63a8\u5f0f\u5b50\u3002\n\n$$\n\\begin{aligned}\n\\sum\\limits_{i = 1}^n\\sum\\limits_{j = 1}^m\\varphi(ij) &= \\sum\\limits_{i = 1}^n\\sum\\limits_{j = 1}^{m}\\dfrac{\\varphi(i)\\varphi(j)\\gcd(i, j)}{\\varphi(\\gcd(i, j))}\\\\\n&= \\sum\\limits_{d = 1}^n\\dfrac{d}{\\varphi(d)}\\sum\\limits_{i = 1}^n\\sum\\limits_{j = 1}^{m}\\varphi(i)\\varphi(j)[\\gcd(i, j) = d]\\\\\n&= \\sum\\limits_{d = 1}^n\\dfrac{d}{\\varphi(d)}\\sum\\limits_{k = 1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(k)\\sum\\limits_{i = 1}^{\\lfloor\\frac{n}{dk}\\rfloor}\\sum\\limits_{j = 1}^{\\lfloor\\frac{n}{dk}\\rfloor}\\varphi(idk)\\varphi(jdk)\\\\\n&= \\sum\\limits_{k = 1}^n\\sum\\limits_{d \\mid k}\\dfrac{d\\mu(\\frac{k}{d})}{\\varphi(d)}\\sum\\limits_{i = 1}^{\\lfloor\\frac{n}{k}\\rfloor}\\varphi(ik)\\sum\\limits_{j = 1}^{\\lfloor\\frac{m}{k}\\rfloor}\\varphi(jk)\n\\end{aligned}\n$$\n\n\u5bb9\u6613\u53d1\u73b0\u56e0\u5b50\u90e8\u5206 $\\sum\\limits_{d \\mid k}\\dfrac{d\\mu(\\frac{k}{d})}{\\varphi(d)}$ \u53ef\u4ee5\u9884\u5904\u7406\uff0c\u628a\u5b83\u8bb0\u4f5c $f(k)$\n\n\u63a5\u4e0b\u6765\u53e6\u4e00\u4e2a\u90e8\u5206 $\\sum\\limits_{i = 1}^{\\lfloor\\frac{n}{k}\\rfloor}\\varphi(ik)$ \u4e5f\u8bbe\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\uff0c\u4ee4 $g(x, y) = \\sum\\limits_{i = 1}^y\\varphi(ix)$\n\n\u663e\u7136 $g(x, y) = g(x, y - 1) + \\varphi(xy)$\n\n\u518d\u8bbe\u4e00\u4e2a\u51fd\u6570 $T(n, a, b) = \\sum\\limits_{k = 1}^n f(k) g(a, k) g(b, k)$\n\n\u663e\u7136 $T(n, a, b) = T(n - 1, a, b) + f(n)g(a, n)g(b, n)$\n\n\u4e8e\u662f\u53ef\u4ee5\u51c6\u5907\u6570\u8bba\u5206\u5757\u4e86\uff1a\u5bf9\u4e8e $\\lfloor\\frac{n}{q}\\rfloor$ \u548c $\\lfloor\\frac{m}{q}\\rfloor$ \u76f8\u7b49\u7684\u533a\u95f4\uff0c\u7b54\u6848\u5c31\u662f $T(r, a, b) - T(l - 1, a, b)$\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u9884\u5904\u7406 $nB^2$ \u8303\u56f4\u5185\u7684\u7b54\u6848\uff0c$B$ \u662f\u968f\u4fbf\u53d6\u7684\u4e00\u4e2a\u5e38\u6570\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5728$n / k$ \u5c0f\u4e8e\u7b49\u4e8e $B$ \u7684\u90e8\u5206\u7528 $T$ \u6570\u7ec4\u6570\u8bba\u5206\u5757 $O(\\sqrt n)$ \u5730\u8ba1\u7b97\u7b54\u6848\uff0c\u5927\u4e8e $B$ \u7684\u90e8\u5206\u679a\u4e3e $k$ \u5728 $O(n / B)$ \u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u6700\u540e\u590d\u6742\u5ea6 $O(n \\log n + nB^2 + T(\\sqrt n + n / B))$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <stdio.h>\n#include <math.h>\n#include <vector>\n#include <algorithm>\n#define lld long long\nusing namespace std;\nconst lld mod = 998244353;\nconst int B = 50;\nconst int maxn = 100000;\nint pr[100010];\nbool sve[100010];\nint mu[100010];\nint phi[100010];\nint inv[100010];\nint f[100010];\nint * g[100010]; // \u52a8\u6001\u7533\u8bf7\u5185\u5b58 \nint * t[110][110]; // \u52a8\u6001\u7533\u8bf7\u5185\u5b58 \nvoid sieve() {\n\tmu[1] = phi[1] = inv[1] = sve[1] = 1;\n\tint cnt = 0;\n\tfor (int i = 2, j, t; i <= maxn; ++ i) {\n\t\tif (!sve[i]) {\n\t\t\tpr[++ cnt] = i;\n\t\t\tmu[i] = -1;\n\t\t\tphi[i] = i - 1;\n\t\t}\n\t\tfor (j = 1; j <= cnt && (t = pr[j] * i) <= maxn; ++ j) {\n\t\t\tsve[t] = 1;\n\t\t\tif (!(i % pr[j])) {\n\t\t\t\tphi[t] = phi[i] * pr[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[t] = phi[i] * (pr[j] - 1);\n\t\t\tmu[t] = -mu[i];\n\t\t}\n\t}\n\tfor (int i = 2; i <= maxn; ++ i)\n        inv[i] = mod - 1ll * mod / i * inv[mod % i] % mod;\n\tfor (int i = 1, j, d; i <= maxn; ++ i)\n\t\tfor (j = i, d = 1; j <= maxn; j += i, ++ d)\n\t\t\tf[j] = 1ll * (1ll * f[j] + 1ll * i * inv[phi[i]] % mod * mu[d] % mod) % mod;\n\t// \u5904\u7406 f \n\tfor (int i = 1, mx; i <= maxn; ++ i) {\n\t\tg[i] = new int[(mx = maxn / i) + 1];\n\t\tg[i][0] = 0;\n\t\tfor (int j = 1; j <= mx; ++ j)\n\t\t\tg[i][j] = 1ll * (1ll * g[i][j - 1] + 1ll * phi[i * j]) % mod;\n\t}\n\t// \u5904\u7406 g\n\tfor (int j = 1, i, k, mx; j <= B; ++ j)\n\t\tfor (k = 1; k <= B; ++ k) {\n\t\t\tt[j][k] = new int[(mx = maxn / max(j, k)) + 1];\n\t\t\tt[j][k][0] = 0;\n\t\t\tfor (i = 1; i <= mx; ++ i)\n\t\t\t\tt[j][k][i] = 1ll * (1ll * t[j][k][i - 1] + 1ll * f[i] * g[i][j] % mod * g[i][k] % mod) % mod;\n\t\t}\n\t// \u5904\u7406 t \n}\nint main() {\n\tsieve();\n\tint T, n, m;\n\tscanf(\"%d\", &T);\n\twhile (T --) {\n\t\tscanf(\"%d%d\", &n, &m);\n\t\tif (n > m) swap(n, m);\n\t\tlld ans = 0;\n\t\tfor (int i = 1, mx = m / B; i <= mx; ++ i)\n\t\t\tans = (ans + 1ll * f[i] * g[i][n / i] % mod * g[i][m / i] % mod) % mod;\n\t\tfor (int i = m / B + 1, j; i <= n; i = j + 1) {\n\t\t\tj = min(n / (n / i), m / (m / i));\n\t\t\tans = (ans + 1ll * (t[n / i][m / i][j] - t[n / i][m / i][i - 1] + mod) % mod) % mod;\n\t\t}\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n}\n```",
        "postTime": 1643264909,
        "uid": 228486,
        "name": "SunsetSamsara",
        "ccfLevel": 7,
        "title": "P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c \u9898\u89e3"
    },
    {
        "content": "### [P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240)\n\n\u6c42\uff1a\n\n$$\n\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(ij)\n$$\n\n\u5148\u8981\u8003\u8651\u600e\u4e48\u628a $\\varphi$ \u8f6c\u6210\u5e26\u6709 $\\gcd$ \u6216 $\\operatorname{lcm}$ \u7684\u5f62\u5f0f\u3002\n\n\u6027\u8d28\uff1a$\\varphi(ij)=\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$\u3002\n\n\u8bc1\u660e\uff1a\n$$\n\\begin{aligned}\n\\varphi(i)\\varphi(j)&=i\\prod_{p|i}\\frac{p-1}{p}j\\prod_{p|j}\\frac{p-1}{p} &p\\in \\text{primes}\\\\\n&=ij\\prod_{p|ij}\\frac{p-1}{p}\\prod_{p|\\gcd(i,j)}\\frac{p-1}{p}\n\\end{aligned}\n$$\n\u6240\u4ee5\u6709\uff1a\n$$\n\\begin{aligned}\n\\varphi(i)\\varphi(j)\\gcd(i,j)&=ij\\prod_{p|ij}\\frac{p-1}{p}\\gcd(i,j)\\prod_{p|\\gcd(i,j)}\\frac{p-1}{p}\\\\\n&=\\varphi(ij)\\varphi(\\gcd(i,j))\n\\end{aligned}\n$$\n\n\n\u5316\u7b80\u5f0f\u5b50\uff0c\u6709\uff1a\n$$\n\\begin{aligned}\n&\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(ij)\\\\\n&=\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}\\\\\n&=\\sum_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(i)\\varphi(j)[gcd(i,j)=d]\\\\\n&=\\sum_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(id)\\varphi(jd)[gcd(i,j)=1]\\\\\n&= \\sum_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\varphi(id)[p|i]\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(jd)[p|j]\\\\\n&=\\sum_{d=1}^{n}\\frac{d}{\\varphi(d)}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{kd}\\rfloor}\\varphi(ikd)\\sum_{j=1}^{\\lfloor\\frac{m}{kd}\\rfloor}\\varphi(jkd)\\\\\n&=\\sum_{T=1}^{n}\\left(\\sum_{d|T}\\frac{d}{\\varphi(d)}\\mu(\\frac{T}{p})\\right)\\left(\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\varphi(iT)\\right)\\left(\\sum_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor}\\varphi(jT)\\right)& \u8bbe \\ T=dp \\\\\n\\end{aligned}\\\\\n$$\n\u8bbe $f(n)=\\sum\\limits_{d|n}\\frac{d}{\\varphi(d)}\\mu(\\frac{n}{p})$\uff0c\u7ebf\u6027\u7b5b\u9884\u5904\u7406\u5373\u53ef\uff0c$\\mathcal{O}(n \\ln n)$\u3002\n\n\u8bbe $g(k,n)=\\sum\\limits_{i=1}^{n}\\varphi(i,k)$\uff0c\u663e\u7136 $g(k,n)=g(k,n-1)+\\varphi(nk)$\u3002\n\n\u5219\u539f\u5f0f\u7b49\u4e8e\uff1a\n$$\n\\begin{aligned}\n\\sum_{T=1}^{n}f(T)\\times g(T,\\lfloor\\frac{n}{T}\\rfloor)\\times g(T,\\lfloor\\frac{m}{T}\\rfloor)\n\\end{aligned}\n$$\n\u53d1\u73b0\u6574\u9664\u5206\u5757\u4e0d\u4e86\uff0c\u8003\u8651\u628a\u6574\u4e2a\u5f0f\u5b50\u8bbe\u51fa\u6765\uff1a\n$$\nh(a,b,n)=\\sum_{t=1}^{n}f(t)\\times g(t,a) \\times g(t,b)\n$$\n\u5bb9\u6613\u53d1\u73b0\uff0c\u8fd9\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5dee\u5206\uff1a\n$$\nh(a,b,n)=\\sum_{\\lfloor\\frac{n}{l}\\rfloor=\\lfloor\\frac{n}{r}\\rfloor \\operatorname{and} \\lfloor\\frac{m}{l}\\rfloor=\\lfloor\\frac{m}{r}\\rfloor}h(\\lfloor\\frac{n}{r}\\rfloor,\\lfloor\\frac{m}{r}\\rfloor,r)-h(\\lfloor\\frac{n}{r}\\rfloor,\\lfloor\\frac{m}{r}\\rfloor,l)\n$$\n\u518d\u8003\u8651\u6839\u53f7\u5206\u6cbb\uff0c\u6211\u4eec\u8bbe\u4e00\u4e2a\u9608\u503c $S$\uff0c\u5c06\u6240\u6709 $h(1,1,1) \\sim h(S,S,n)$ \u7684 $h$ \u503c\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u9884\u5904\u7406\u5f0f\u5b50\u5c31\u662f\uff1a\n$$\nh(j,k,i)=h(j,k,i-1)+f(i)\\times g(i,j)\\times g(i,k)\n$$\n\u5bf9\u4e8e $\\lfloor\\frac{n}{r}\\rfloor \\leq S$ \u53ef\u76f4\u63a5\u67e5\u8be2\u3002\n\n\u5426\u5219\uff0c\u53ef\u77e5 $r \\leq \\lfloor\\frac{n}{S}\\rfloor$\uff0c\u6570\u8bba\u5206\u5757\u8ba1\u7b97\u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int mod = 998244353;\n\nconst int S = 50;\n\nconst int maxn = 1e5;\n\nbool vis[maxn + 7];\n\nint tot, prime[maxn + 7];\n\nint mu[maxn + 7], phi[maxn + 7], invphi[maxn + 7];\n\nint sum[maxn + 7];\n\nint *g[maxn + 7], *t[100][100];\n\nint qpow(int x, int y)\n{\n    int res = 1;\n    while (y)\n    {\n        if (y & 1)\n            res = res * (long long)x % mod;\n        x = x * (long long)x % mod;\n        y >>= 1;\n    }\n    return res;\n}\n\nvoid init()\n{\n    phi[1] = mu[1] = invphi[1] = 1;\n    for (int i = 2; i <= maxn; i++)\n    {\n        if (!vis[i])\n            prime[++tot] = i, phi[i] = i + (mu[i] = -1);\n        for (int j = 1; j <= tot && i * prime[j] <= maxn; j++)\n        {\n            vis[i * prime[j]] = true;\n            if (i % prime[j] == 0)\n            {\n                phi[i * prime[j]] = phi[i] * prime[j];\n                break;\n            }\n            phi[i * prime[j]] = phi[i] * (prime[j] - 1);\n            mu[i * prime[j]] = -mu[i];\n        }\n        invphi[i] = qpow(phi[i], mod - 2);\n    }\n    for (int pp = 1; pp <= maxn; pp++)\n        for (int q = pp, d = 1; q <= maxn; q += pp, d++)\n            sum[q] = (sum[q] + pp * (long long)invphi[pp] % mod * mu[d]) % mod, sum[q] += (sum[q] < 0 ? mod : 0);\n    for (int i = 1; i <= maxn; i++)\n    {\n        g[i] = new int[(maxn / i) + 1], g[i][0] = 0;\n        for (int j = 1, sb = maxn / i; j <= sb; j++)\n            g[i][j] = (g[i][j - 1] + phi[i * j]) % mod;\n    }\n    for (int j = 1; j <= S; j++)\n        for (int k = j; k <= S; k++)\n        {\n            int len = maxn / max(j, k);\n            t[j][k] = new int[len + 1], t[j][k][0] = 0;\n            for (int i = 1; i <= len; i++)\n                t[j][k][i] = (t[j][k][i - 1] + sum[i] * (long long)g[i][j] % mod * g[i][k] % mod) % mod;\n        }\n}\n\nsigned main()\n{\n\tinit();\n    int T;\n    scanf(\"%d\", &T);\n    while (T--)\n    {\n        int n, m, res = 0;\n        scanf(\"%d%d\", &n, &m);\n        if (n > m)\n            swap(n, m);\n        for (int i = 1, kkk = m / S; i <= kkk; i++)\n            res = (res + sum[i] * (long long)g[i][n / i] % mod * g[i][m / i] % mod) % mod;\n        for (int i = m / S + 1, j; i <= n; i = j + 1)\n        {\n            j = min(n / (n / i), m / (m / i));\n            res = (res + t[n / i][m / i][j] - t[n / i][m / i][i - 1]) % mod, res += (res < 0 ? mod : 0);\n        }\n        printf(\"%d\\n\", res);\n    }\n    return 0;\n}\n```",
        "postTime": 1641966882,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c"
    },
    {
        "content": "\u591a\u6d4b\uff0c\u7ec4\u6570\u5c0f\u4e8e\u7b49\u4e8e $10^4$ \u6c42\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(ij)$$\n\n\u6211\u4eec\u5148\u638f\u51fa\u4e00\u4e2a\u6027\u8d28\u3002\n\n![](https://i.loli.net/2021/09/14/7wU3hpL5lBuKTJG.png)\n\n\u9ed8\u8ba4 $n\\le m,x/y\\rightarrow\\lfloor\\frac{x}{y}\\rfloor$\uff0c\u7136\u540e\u4f60\u4e00\u6f14\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\frac{\\varphi(i)\\varphi(j)\\gcd(i,j)}{\\varphi(\\gcd(i,j))}$$\n\n$$\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{i=1}^{n/d}\\sum_{j=1}^{m/d}\\varphi(id)\\varphi(jd)[\\gcd(i,j)=1]$$\n\n$$\\sum_{d=1}^n\\frac{d}{\\varphi(d)}\\sum_{k=1}^{n/d}\\mu(k)\\sum_{i=1}^{n/dk}\\sum_{j=1}^{m/dk}\\varphi(idk)\\varphi(jdk)$$\n\n$$dk\\rightarrow T,\\sum_{T=1}^n\\sum_{d|T}\\frac{d}{\\varphi(d)}\\mu(\\frac{T}{d})\\sum_{i=1}^{n/T}\\varphi(iT)\\sum_{j=1}^{m/T}\\varphi(jT)$$\n\n\u4f60\u8bbe $\\sum_{d|T}\\frac{d}{\\varphi(d)}\\mu(\\frac{T}{d})$ \u4e3a $F$ \u51fd\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\uff0c\u53ef\u4ee5\u7ebf\u6027\u7b5b\u3002\u4e8e\u662f\u6211\u638f\u51fa\u4e00\u4e2a\u7ebf\u6027\u7b5b\u7684\u67ff\u5b50\u3002\n\n![](https://i.loli.net/2021/09/14/M4iVhPeKsW7u12j.png)\n\n\u7136\u540e\u5c31\u662f\u53d1\u626c\u4eba\u7c7b\u667a\u6167\u7684\u65f6\u5019\u4e86\uff01\n\n\u4f60\u53d1\u73b0\u53d8\u5316\u540e\u7684\u67ff\u5b50\u53ea\u8981\u6c42 $\\varphi$ \u5728 $\\text{maxn}$ \u4ee5\u5185\u7684\u503c\uff0c\u4e8e\u662f\u4f60\u5c31\u638f\u51fa\u6765\u4e00\u4e2a $G$\uff0c\u8868\u793a\uff1a\n\n$$G(x,y)=\\sum_{i=1}^x\\varphi(yi)$$\n\n\u663e\u7136 $G$ \u4e0d\u8d85\u8fc7\u8c03\u548c\u5927\u5c0f\u4e2a\uff0c\u66b4\u529b\u9884\u5904\u7406\u5373\u53ef\u3002\n\n\u7136\u540e\u4f60\u53c8\u638f\u51fa\u4e00\u4e2a $H$ \uff0c\u8868\u793a\uff1a\n\n$$H(x,y,z)=\\sum_{T=1}^z\\sum_{d|T}\\frac{d}{\\varphi(d)}\\mu(\\frac{T}{d})\\sum_{i=1}^{x}\\varphi(iT)\\sum_{j=1}^{y}\\varphi(jT)$$\n\n$$=\\sum_{T=1}^zF(T)G(x,T)G(y,T)$$\n\n\u5dee\u5206\u4e00\u4e0b\uff0c\u5c31\u662f $H(x,y,z)=H(x,y,z-1)+F(z)G(x,z)G(y,z)$\n\n\u5982\u679c\u4f60\u80fd\u628a\u7b54\u6848\u9884\u5904\u7406\u51fa\u6765\uff0c\u90a3\u5c06\u662f\u975e\u5e38\u7f8e\u5999\u7684\u4e8b\uff0c\u4f46\u662f\u4f1a $\\text{MTLE}$\uff0c\u6240\u4ee5\u6211\u4eec\u638f\u51fa\u4e00\u4e2a\u4eba\u7c7b\u667a\u6167\uff0c\u8003\u8651\u9884\u5904\u7406\u4e00\u4e9b\u4e1c\u897f\u51fa\u6765\uff0c\u5269\u4e0b\u66b4\u529b\u3002\n\n\u5f04\u51fa\u6765\u4e00\u4e2a\u503c\u57df $B$\uff0c\u5bf9\u4e8e $m/B$ \u4ee5\u5185\u7684 $z$ \u66b4\u529b\u7528 $G$ \u7b97\uff0c\u5176\u4ed6\u6ce8\u610f\u5230 $H(x,y,z)$ \u4e2d\u7684 $x,y$ \u5b9e\u8d28\u5c31\u662f $n/T,m/T$\uff0c\u4f7f\u7528\u6574\u9664\u5206\u5757\u6765\u4f18\u5316\u5373\u53ef\u3002\n\n\u73b0\u5728\u662f $11:33$\uff0c\u6211\u5634\u5df4\u5b8c\u4e86\uff0c\u770b\u6211\u4ec0\u4e48\u65f6\u5019\u5199\u5b8c\u3002\n\n\u73b0\u5728\u662f $11:45$\uff0c\u6211\u5199\u5b8c\u4e86\u3002\n\n```cpp\n#define int long long\n#define maxn 100010\nconst int p=998244353;\nint pri[maxn],f[maxn],phi[maxn],tot;\nbitset<maxn>v;\nconst int B=100;\nvector<int>G[maxn],H[B+10][B+10];\nint ksm(int a,int b){\n\tint ans=1;\n\tfor(;b;b>>=1,a=a*a%p)\n\tif(b&1)ans=ans*a%p;\n\treturn ans;\n}\nvoid shai(int n){\n\tf[1]=phi[1]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tif(v[i]==0)pri[++tot]=i,phi[i]=i-1,f[i]=ksm(i-1,p-2);\n\t\tfor(int j=1;j<=tot&&i*pri[j]<=n;j++){\n\t\t\tv[i*pri[j]]=1;\n\t\t\tif(i%pri[j]==0){\n\t\t\t\tphi[i*pri[j]]=phi[i]*pri[j];\n\t\t\t\tif(i/pri[j]%pri[j])f[i*pri[j]]=(p+f[i]-f[pri[j]]*f[i/pri[j]])%p;\n\t\t\t\telse f[i*pri[j]]=f[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*pri[j]]=phi[i]*(pri[j]-1);\n\t\t\tf[i*pri[j]]=f[i]*f[pri[j]]%p;\n\t\t}\n\t}\n\tfor(int i=1;G[i].push_back(0),i<=n;i++)//\u4e0b\u6807\u72d7\u624d\u4ece\u96f6\u5f00\u59cb \n\tfor(int j=1;j*i<=n;j++)\n\tG[i].push_back((G[i][j-1]+phi[i*j])%p);\n\tfor(int i=1;i<=B;i++)for(int j=1;j<=B;j++){\n\t\tH[i][j].push_back(0);\n\t\tfor(int k=1;k<=n/max(i,j);k++)\n\t\tH[i][j].push_back((H[i][j][k-1]+f[k]*G[k][i]%p*G[k][j])%p);\n\t}\n}\nint T,n,m,ans;\nsigned main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"testdata.in\",\"r\",stdin);\n#endif\n\tshai(100000);\n\tfor(cin>>T;T;T--){\n\t\tcin>>n>>m;\n\t\tif(n>m)swap(n,m);\n\t\tans=0;\n\t\tfor(int i=1;i<=m/B;i++)ans=(ans+f[i]*G[i][n/i]%p*G[i][m/i])%p;\n\t\tfor(int L=m/B+1,R;L<=n;L=R+1){\n\t\t\tR=min(n/(n/L),m/(m/L));\n\t\t\tans=(ans+H[n/L][m/L][R]-H[n/L][m/L][L-1]+p)%p;\n\t\t}\n\t\tcout<<ans<<endl;\n\t}\n#ifndef ONLINE_JUDGE\n\tcerr<<endl<<(double)clock()/CLOCKS_PER_SEC;\n#endif\n}\n```\n\u4e3a\u4e86\u5f00\u5185\u5b58\u65b9\u4fbf\uff0c\u6211\u628a $G$ \u7684\u8868\u793a\u4e2d\u4e00\u4e8c\u7ef4\u6362\u4e86\u4e00\u4e0b\u3002\n\n\u7b11\u6b7b\uff0c\u6839\u672c\u4e0d\u5361\u5e38\u3002\n\n\u5410\u69fd\u4e00\u53e5\uff0c\u8ddf\u6211\u4e4b\u524d\u51fa\u7684[\u4e00\u9053\u9898](https://www.luogu.com.cn/problem/U154979)\u91cd\u4e86\uff0cbut\u5168\u65b9\u4f4d\u540a\u6253\u6211\u7684\u9898\u3002",
        "postTime": 1631590406,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c \u8bb0\u5f55"
    }
]