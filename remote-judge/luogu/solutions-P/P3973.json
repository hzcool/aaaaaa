[
    {
        "content": "\u770b\u5230\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u5148\u6765\u753b\u4e00\u4e0b\u67ff\u5b50\u3002\n\n$D=(A*B-C)*A^T$\n\n$D=\\sum_{i=1}^n(\\sum_{j=1}^na_j*b_{j,i}-c_i)*a_i$ \n\n$D=\\sum_{i=1}^n\\sum_{j=1}^na_i*a_j*b_{i,j}-\\sum_{i=1}^na_i*c_i$\n\n\u67ff\u5b50\u753b\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u5bf9\u4e8e\u6bcf\u4e2a$a_i$\uff0c\u90090\u7684\u65f6\u5019\u6ca1\u6709\u8d21\u732e\uff0c\u90091\u7684\u65f6\u5019\u4f1a\u5e26\u6765$c_i$\u7684\u635f\u5931\uff0c\u4f46\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u540c\u6837\u90091\u7684$a_j$,\u4f1a\u5e26\u6765$b_{j,i}+b_{i,j}$\u7684\u8d21\u732e\u3002\n\n\u7ed3\u5408\u6570\u636e\u8303\u56f4$n\\leq500$,\u53ef\u4ee5\u8054\u60f3\u5230\u6700\u5c0f\u5272\u3002\n\n![](https://cdn.luogu.com.cn/upload/pic/18121.png)\n\n\u8fd9\u91cc\u6211\u4eec\u5047\u8bbeS\u96c6\u662f$a_i$\u90090\uff0cT\u96c6\u662f$a_i$\u90091\u3002\u4e00\u5f00\u59cb\u6211\u4eec\u83b7\u5f97\u4e86\u6240\u6709$b$\u7684\u6536\u76ca\uff0c\u6211\u4eec\u8981\u8ba9\u635f\u5931\u6700\u5c0f\u5316\u3002\n\n\u5217\u5f0f\u5b50 \n\n$(1)bx+by=c_x+c_y$ (\u90fd\u90091\u7684\u65f6\u5019\u53ea\u6709$c$\u7684\u635f\u5931)\n\n$(2)ax+ay=b_{x,x}+b_{x,y}+b_{y,x}+b_{y,y}$ (\u90fd\u90090\u7684\u65f6\u5019\u635f\u5931\u4e3a$b$\u6570\u7ec4)\n\n$(3)ax+by+v=b_{x,x}+b_{x,y}+b_{y,x}+c_y$\n\n$(4)ay+bx+v=b_{y,y}+b_{x,y}+b_{y,x}+c_x$ (\u4e00\u4e2a\u90091\u4e00\u4e2a\u90090\u65f6\u635f\u5931\u4e3a$b$\u6570\u7ec4\u4e24\u6570\u4e4b\u95f4\u7684\u6536\u76ca\u548c\u5bf9\u5e94$c$\u6570\u7ec4\u6536\u76ca)\n\n\u53ef\u4ee5\u89e3\u51fa\u5bf9\u4e8e\u6bcf\u4e00\u7ec4$(x,y)$\n\n$ax=b_{x,x}+\\frac{b_{x,y}+b_{y,x}}{2}$\n\n$ay=b_{y,y}+\\frac{b_{x,y}+b_{y,x}}{2}$\n\n$bx=c_x$\n\n$by=c_y$\n\n$v=\\frac{b_{x,y}+b_{y,x}}{2}$\n\n\u5bf9\u4e8e\u6bcf\u4e00\u7ec4$(x,y)$,\u6211\u4eec\u9700\u8981\u628a\u5272$ax$\u548c$ay$\u7684\u635f\u5931\u7d2f\u52a0\u8d77\u6765\u3002\n\n$ax=b_{x,x}+\\frac{\\sum_{i=1}^n(i!=x)b_{x,i}+b_{i,x}}{2}=\\frac{\\sum_{i=1}^nb_{x,i}+b_{i,x}}{2}$\n\n\u8fd9\u6837\u5efa\u56fe\u5c31\u975e\u5e38\u660e\u663e\u4e86\uff0c\u4e3a\u4e86\u907f\u514d\u6709\u5c0f\u6570\u7684\u51fa\u73b0\uff0c\u6211\u4eec\u5c06\u6d41\u91cf\u7ffb\u500d\u3002\n\n\u4ece\u6e90\u70b9$S$\u5f80\u6bcf\u4e2a\u70b9$i$\u8fde\u63a5\u6d41\u91cf\u4e3a$b$\u6570\u7ec4\u7b2c$i$\u884c\u548c\u7b2c$i$\u5217\u7684\u6743\u503c\u603b\u548c\u7684\u8fb9\u3002\n\n\u6bcf\u4e2a\u70b9$i$\u5f80\u6c47\u70b9$T$\u8fde\u63a5\u6d41\u91cf\u4e3a$c_i*2$\u7684\u8fb9\u3002\n\n\u6bcf\u4e00\u5bf9\u70b9$(i,j)$\u4e4b\u95f4\u8fde\u6d41\u91cf\u4e3a$b_{i,j}+b_{j,i}$\u7684\u53cc\u5411\u8fb9\u3002\n\n\u6700\u540e\u7b54\u6848\u4e3a$\\sum_{i=1}^n\\sum_{j=1}^nb_{i,j}-\\frac{Maxflow(S,T)}{2}$\n\n\u65f6\u95f4\u590d\u6742\u5ea6O($Maxflow(n,n^2)$)\n",
        "postTime": 1524738871,
        "uid": 17828,
        "name": "revenger",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    },
    {
        "content": "\u505a\u6cd5$1:$\u5148\u628a$A$\u77e9\u9635\u7f6e\u4e3a$1,$ \u7136\u540e\u968f\u673a\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u628a\u5176\u53d6\u53cd\uff0c\u91cd\u590d$1500$\u6b21\uff0c\u9009\u4e00\u4e2a\u597d\u7684\u79cd\u5b50\uff0c\u5c31\u80fd\u8fc7\u4e86\u3002\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nint read(){\n    char cc = getchar(); int cn = 0, flus = 1;\n    while(cc > '9' || cc < '0'){\n        if(cc == '-') flus = -flus;\n        cc = getchar();\n    }\n    while(cc >= '0' && cc <= '9') cn = cn * 10 + cc - '0', cc = getchar();\n    return cn * flus;\n}\nconst int N = 500 + 5;\nconst int M = 1e5 + 5;\nconst int inf = 99999999;\nint n;\nint a[N], b[N], c[N][N], d[N];\nint p[N], q[N];\nvoid input(){\n    for(int i = 1; i <= n; i++){\n        for(int j = 1; j <= n; j++){\n            c[i][j] = read();\n        }\n    }\n    for(int i = 1; i <= n; i++) b[i] = read();\n}\nnamespace Work3{\n    int maxans = 0;\n    int ans = 0;\n    int check(){\n        memset(d, 0, sizeof(d));\n        int nowans = 0;\n        for(int i = 1; i <= n; i++){\n            for(int j = 1; j <= n; j++){\n                d[i] += a[j] * c[i][j];\n            }\n        }\n        for(int i = 1; i <= n; i++){\n            nowans += (d[i] - b[i]) * a[i];\n        }\n        maxans = max(maxans, nowans);\n        return maxans;\n    }\n    void output3(){\n        for(int i = 1; i <= n; i++)  a[i] = 1;\n        check();\n        int time = 1500;\n        ans = maxans;\n        int lastwh = 0;\n        while(time){\n            int wh = rand() % n + 1;\n            a[wh] = a[wh] ^ 1;\n            check();\n            time--;\n        }\n        printf(\"%d\\n\", maxans);\n        return ;\n    }\n}\nint main(){\n    srand(10007);\n    n = read();\n    input();\n    Work3::output3();\n    return 0;\n}\n```\n\n\u5f53\u7136\uff0c\u6b63\u786e\u7684\u5199\u6cd5\u8fd8\u662f\u5199\u6700\u5c0f\u5272\u5efa\u56fe......\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u9009\u4e86\u4e00\u4e2a\u70b9\u4e3a$1$\uff0c\u8981\u82b1\u8d39$C_i$\u7684\u4ee3\u4ef7\u3002\u5982\u679c$i,j$\u4e24\u70b9\u540c\u65f6\u9009\uff0c\u4f1a\u4ea7\u751f$B_{i,j}$\u7684\u8d21\u732e\u3002\u6240\u4ee5\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u989d\u5916\u7684\u70b9$(i,j)$\u8868\u793a\u8fd9\u4e2a\u8d21\u732e\uff0c\u7136\u540e\u5206\u522b\u5411$i,j$\u8fde\u4e00\u6761\u65e0\u7a77\u5927\u7684\u8fb9\u3002\u3002\u3002\u7136\u540e\u8dd1\u6700\u5c0f\u5272\u5373\u53ef\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nint read(){\n    char cc = getchar(); int cn = 0, flus = 1;\n    while(cc > '9' || cc < '0') {\n        if(cc == '-') flus = -flus;\n        cc = getchar();\n    }\n    while(cc >= '0' && cc <= '9') cn = cn * 10 + cc - '0', cc = getchar();\n    return cn * flus;\n}\nconst int M = 1e6 + 5;\nconst int N = 500 + 5;\nconst int inf = 99999999;\nint n, m, s, t, head[M], cur[M];\nint dep[M], cnt;\nint c[N][N], b[N], ans;\nstruct E{\n    int to, next, w;\n}e[M * 2];\nvoid ins(int x, int y, int z){\n\te[++cnt].w = z; e[cnt].to = y;\n    e[cnt].next = head[x]; head[x] = cnt;\n}\nvoid add(int x, int y, int z){\n    ins(x, y, z); ins(y, x, 0);\n}\nbool bfs(int x){\n    memset(dep, 0, sizeof(dep));\n    queue<int> q;\n    while(!q.empty()) q.pop();\n    dep[x] = 1; q.push(x);\n    while(!q.empty()){\n        int u = q.front();\n        q.pop();\n        for(int i = head[u]; i; i = e[i].next){\n            int v = e[i].to;\n            if(e[i].w > 0 && dep[v] == 0){\n                dep[v] = dep[u] + 1;\n                q.push(v);\n            }\n        }\n    }\n    return dep[t] > 0;\n}\nint dfs(int x, int dist){\n    if(x == t) return dist;\n    for(int &i = cur[x]; i; i = e[i].next){\n        int v = e[i].to;\n        if((dep[v] == dep[x] + 1) && (e[i].w > 0)){\n            int d = dfs(v, min(dist, e[i].w));\n            if(d > 0){\n                e[i].w -= d;\n                e[i ^ 1].w += d;\n                return d;\n            }\n        }\n    }\n    return 0;\n}\nint dinic(){\n    int ans = 0;\n    while(bfs(s)){\n        int di;\n        for(int i = s; i <= t; i++)\tcur[i] = head[i];\n        while(di = dfs(s, inf)){\n\t\t    ans += di;\n        }\n    }\n    return ans;\n}\nvoid input(){\n\tn = read();\n    for(int i = 1; i <= n; i++){\n        for(int j = 1; j <= n; j++){\n            c[i][j] = read();\n        }\n    }\n    for(int i = 1; i <= n; i++) b[i] = read();\n}\nvoid build(){\n\ts = 0, t = n * (n + 1) + 1;\n\tcnt = 1;\n\tfor(int i = 1; i <= n; i++){\n\t\tfor(int j = 1; j <= n; j++){\n\t\t\tadd(s, i * n + j, c[i][j]);\n\t\t\tadd(i * n + j, i, inf);\n\t\t\tadd(i * n + j, j, inf);\n\t\t\tans += c[i][j];\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++){\n\t\tadd(i, t, b[i]);\n\t}\n}\nint main(){\n    input();\n    build();\n    printf(\"%d\\n\", ans - dinic());//\u6700\u5c0f\u5272\n    return 0;\n}\n\n```",
        "postTime": 1548663362,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "P3973\u7ebf\u6027\u4ee3\u6570"
    },
    {
        "content": "\u5148\u6839\u636e\u77e9\u9635\u4e58\u6cd5\u6cd5\u5219\u63a8\u4e00\u6ce2\u67ff\u5b50\uff1a\n\n$$D = (A \\times B -C)\\times A^T $$\n$$=\\sum_{i=1}^n(\\sum_{j=1}^n(a_j \\times b_{i,j} - c_i) \\times a_i)$$\n\n\u4e3a\u4e86\u80fd\u8ba1\u7b97\u6bcf\u4e2a $a$ \u7684\u8d21\u732e\uff0c\u6211\u4eec\u628a\u542b $a$ \u7684\u9879\u5206\u79bb\u51fa\u6765\n\n$$=\\sum_{i=1}^n(\\sum_{j=1}^n(a_i \\times a_j \\times b_{i,j})-c_i \\times a_i)$$\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\n\n**\u5bf9\u4e8e\u6bcf\u4e00\u4e2aB\u77e9\u9635\u4e2d\u7684\u5143\u7d20 $b[i][j]$\uff0c**\n\n**\u5982\u679c\u4e0d\u8981\u4ed6\uff08\u5373 $a_i$ \u548c $a_j$ \u4e2d\u6709\u81f3\u5c11\u4e00\u4e2a\u4e3a0\uff09\uff0c\u5c31\u635f\u5931 $b[i][j]$ ,**\n\n**\u5426\u5219\u5c31\u5fc5\u987b\u635f\u5931 $c[i]$ \u548c $c[j]$\uff08\u56e0\u4e3a\u6b64\u65f6 $a_i$ \u548c $a_j$ \u7686\u4e3a1\uff09**\n\n\u8fd9\u4fc3\u4f7f\u6211\u4eec\u60f3\u5230\u4e86**\u6700\u5c0f\u5272**\u3002\n\n### \u5efa\u7f51\u7edc\n\n- \u6bcf\u4e2a $b_{i,j}$ \u548c\u6bcf\u4e2a $c_{i,j}$ \u90fd\u5bf9\u5e94\u4e00\u4e2a\u8282\u70b9\n\n- \u6e90\u70b9\u5411\u6bcf\u4e2a B \u4e2d\u8282\u70b9\u8fde\u6d41\u91cf $b_{i,j}$ \u7684\u8fb9\uff0c\u6bcf\u4e2a C \u4e2d\u8282\u70b9\u5411\u6c47\u70b9\u8fde\u6d41\u91cf $c_i$ \u7684\u8fb9\n\n- \u6bcf\u4e2a $b_{i,j}$ \u5411 $c_i$ \u548c $c_j$ \u8fde\u6d41\u91cf\u4e3ainf\u7684\u8fb9\n\n\u8fd9\u65f6\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $b_{i,j}$\uff0c\u5982\u679c\u6211\u4eec\u8981\u5207\u65ad\u4ece\u6e90\u70b9\u7ecf\u8fc7\u5b83\u5230\u6c47\u70b9\u7684\u8def\uff0c\u8981\u4e48\u5207\u65ad\u4ece\u6e90\u70b9\u5230\u5b83\u7684 $b_{i,j}$ \u7684\u8fb9\uff0c\u8981\u4e48\u5207\u65ad\u4ece $c_i$ \u548c $c_j$ \u5230\u6c47\u70b9\u7684\u4e24\u6761\u8fb9\uff0c\u4e0e\u524d\u9762\u6240\u8bb2\u76f8\u540c\u3002\n\n\u7136\u540e\u6109\u5feb\u5730\u8dd1\u7f51\u7edc\u6d41\uff0c\u518d\u7528 $\\sum b_{i,j}$ \u51cf\u6389\u6700\u5c0f\u5272\u5373\u53ef\u5207\u6389\u6b64\u9898\n\n```cpp\n//coder: Feliks-GM-YB\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\n//\u6ce8\u610f\u8fde\u8fb9\u6709\u7ea62e6\u6761\uff0c\u5c0f\u5fc3\u6570\u7ec4\u5f00\u5c0f\u89c1\u7956\u5b97 \nconst int N=1e6+100;\nconst int M=502;\nconst int inf=(1<<30);\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)&&ch!='-')ch=getchar();\n\tif(ch=='-')f=-1,ch=getchar();\n\twhile(isdigit(ch))x=(x<<1)+(x<<3)+ch-'0',ch=getchar();\n\treturn x*f;\n}int n;\nint v[N<<1],nex[N<<1],first[N],w[N<<1],tot=1;\ninline void add(int x,int y,int z){\n\tv[++tot]=y;w[tot]=z;\n\tnex[tot]=first[x];\n\tfirst[x]=tot;\n}namespace Dinic{\n\tint s=0,t=1e6,maxf,flow;\n\t//s,t\u5206\u522b\u4e3a\u6e90\u70b9\u548c\u6c47\u70b9\n\tint d[N];queue<int> q;\n\tinline bool bfs(){\n\t\twhile(!q.empty())q.pop();\n\t\tmemset(d,0,sizeof(d));\n\t\tq.push(s);d[s]=1;\n\t\twhile(!q.empty()){\n\t\t\tint x=q.front();q.pop();\n\t\t\tfor(int i=first[x];i;i=nex[i]){\n\t\t\t\tint y=v[i];\n\t\t\t\tif(!w[i] || d[y])continue;\n\t\t\t\tq.push(y);\n\t\t\t\td[y]=d[x]+1;\n\t\t\t\tif(y==t)return 1;\n\t\t\t}\n\t\t}return 0;\n\t}int dinic(int x,int f){\n\t\tif(x==t)return f;\n\t\tint res=f,k;\n\t\tfor(int i=first[x];i && res;i=nex[i]){\n\t\t\tint y=v[i];\n\t\t\tif(!w[i] || d[y]!=d[x]+1)continue;\n\t\t\tk=dinic(y,min(res,w[i]));\n\t\t\tif(!k)d[y]=0;\n\t\t\tw[i]-=k;w[i^1]+=k;\n\t\t\tres-=k;\n\t\t}return f-res;\n\t}\n}using namespace Dinic;\nint b[M][M],c[M],ans;\nint main(){\n\tn=read();\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tb[i][j]=read();\n\t\t\tans+=b[i][j];//ans\u5148\u8d4b\u4e3a B \u77e9\u9635\u5143\u7d20\u4e4b\u548c \n\t\t\t//b[i][j]\u5bf9\u5e94\u8282\u70b9 (i - 1) * n + j, \u53ef\u4ee3\u5165\u6570\u503c\u7406\u89e3\n\t\t\tadd(s,(i-1)*n+j,b[i][j]);\n\t\t\tadd((i-1)*n+j,s,0);\n\t\t}\n\t}for(int i=1;i<=n;i++){\n\t\tc[i]=read();\n\t\tadd(n*n+i,t,c[i]);\n\t\tadd(t,n*n+i,0);\n\t}for(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tint x=(i-1)*n+j;\n\t\t\tadd(x,n*n+i,inf);add(n*n+i,x,0);\n\t\t\tadd(x,n*n+j,inf);add(n*n+j,x,0);\n\t\t}\n\t}//\u8dd1 Dinic \u6700\u5927\u6d41\u6c42\u6700\u5c0f\u5272 \n\twhile(bfs())\n\t\twhile(flow=dinic(s,inf))maxf+=flow;\n\tprintf(\"%d\\n\",ans-maxf);\n\treturn 0;\n}\n```\n\n\n\n\n",
        "postTime": 1581742857,
        "uid": 104292,
        "name": "YellowBean_Elsa",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    },
    {
        "content": "\u663e\u7136\uff0c\u53ea\u6709 $a_i$ \u548c $a_j$ \u540c\u65f6\u4e3a1\u7684\u65f6\u5019\uff0c\u624d\u5bf9\u7b54\u6848\u6709 $b_{ij}$  \u7684\u8d21\u732e\u3002\u4f7f $a_i$ \u4e3a $1$ \u7684\u4ee3\u4ef7\u4e3a $c_i$ \u3002\u4e8e\u662f\u8fd9\u5c31\u662f\u4e2a\u6700\u5c0f\u5272\u6a21\u578b\u4e86\u3002\n\n\u9996\u5148\u5de6\u90e8\u6709 $n^2$ \u4e2a\u70b9\uff0cS\u5411\u6bcf\u4e2a\u70b9$(i,j)$\u8fde\u6d41\u91cf\u4e3a $b_{ij}$ \u7684\u8fb9\u3002\u5982\u679c\u8fd9\u6761\u8fb9\u88ab\u5272\u6389\u4e86\uff0c\u4ee3\u8868 $b_{ij}$\u5bf9\u7b54\u6848**\u6ca1\u6709\u8d21\u732e**\u3002\n\n\u53f3\u90e8\u6709 $n$ \u4e2a\u70b9\uff0c\u6bcf\u4e2a\u5411T\u8fde\u6d41\u91cf\u4e3a $c_i$ \u7684\u8fb9\uff0c\u5982\u679c\u8fd9\u6761\u8fb9\u88ab\u5272\u6389\u4e86\uff0c\u4ee3\u8868 $a_i$ \u4e3a $1$\uff0c\u82b1\u8d39\u4e86 $c_i$ \u7684\u4ee3\u4ef7\u3002\n\n\u6bcf\u4e2a\u70b9$(i,j)$\u5411\u53f3\u90e8\u7684 $i$ \u548c $j$ \u70b9\u8fde\u6d41\u91cf$INF$\u7684\u8fb9\uff0c\u4ee3\u8868\u53ea\u6709\u53f3\u8fb9 $i$ \u548c $j$\u5168\u90fd\u88ab\u5272\u6389\uff0c$b_{ij}$ \u624d\u80fd\u6709\u8d21\u732e\u3002\n\n\u7136\u540e\u7b54\u6848\u5c31\u662f $\\sum b_{ij}-$\u6700\u5c0f\u5272\n\n```cpp\n#include<bits/stdc++.h>\n#define N 3000005\n#define INF 1<<29\n#define num ((i-1)*n+j)\nusing namespace std;\n\ninline void rd(int &X){\n    X=0;int w=0;char ch=0;\n    while(!isdigit(ch))w|=ch=='-',ch=getchar();\n    while(isdigit(ch))X=(X<<3)+(X<<1)+(ch^48),ch=getchar();\n    X=w?-X:X;\n}\n\nint n,s=N-5,t=N-4,ans,f,k;\nint head[N],cnt=1,d[N];\nstruct nd{int nxt,to,v;}e[N<<1];\n#define For(x) for(int y,i=head[x];(y=e[i].to);i=e[i].nxt)\n\nvoid add(int x,int y,int w){\n    e[++cnt]=(nd){head[x],y,w};head[x]=cnt;\n    e[++cnt]=(nd){head[y],x,0};head[y]=cnt;\n}\nvoid build()\n{\n\trd(n);\n\tfor(int x,i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\trd(x),ans+=x,add(s,num,x),add(num,i+n*n,INF),add(num,j+n*n,INF);\n\tfor(int x,i=1;i<=n;i++)\n\t\trd(x),add(i+n*n,t,x);\n}\n\nbool bfs()\n{\n    queue<int> q; q.push(s);\n    memset(d,0,sizeof d); d[s]=1;\n    while(!q.empty()){\n        int x=q.front();q.pop();\n        For(x) if(e[i].v&&!d[y]){\n            q.push(y); d[y]=d[x]+1;\n            if(y==t) return 1;\n        }\n    } return 0;\n}\n\nint dinic(int x,int flow)\n{\n    if(x==t) return flow; int re=flow;\n    for(int y,i=head[x];(y=e[i].to)&&re;i=e[i].nxt)\n        if(e[i].v&&d[y]==d[x]+1)\n        {\n            k=dinic(y,min(re,e[i].v));\n            if(!k) d[y]=0;\n            e[i].v-=k;e[i^1].v+=k;re-=k; \n        }\n    return flow-re;\n}\n\nint main()\n{\n    build(); \n    while(bfs())\n        while(f=dinic(s,INF))\n            ans-=f;\n    cout<<ans;\n}\n```",
        "postTime": 1544752687,
        "uid": 56659,
        "name": "AubRain",
        "ccfLevel": 0,
        "title": "[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u2014\u2014\u6700\u5c0f\u5272"
    },
    {
        "content": "\u4e3a\u4ec0\u4e48\u6ca1\u6709\u6700\u5927\u5bc6\u5ea6\u5b50\u56fe\u505a\u6cd5\u554a /fn /fn /fn\n\n[\u66f4\u5dee\u7684\u9605\u8bfb\u4f53\u9a8c](https://cx330-oier.top/2023/01/12/TJOI2015-%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0-%E9%A2%98%E8%A7%A3/)\n\n> \u7ed9\u51fa\u4e00\u4e2a $N \\times N$  \u7684\u77e9\u9635 $\\mathbf{B}$ \u548c\u4e00\u4e2a $1 \\times N$ \u7684\u77e9\u9635 $\\mathbf{C}$\u3002\u6c42\u51fa\u4e00\u4e2a $1 \\times N$ \u7684 $0 / 1$ \u77e9\u9635 $\\mathbf{A}$\uff0c\u4f7f\u5f97 $\\mathbf{D} = (\\mathbf{A} \\times \\mathbf{B} - \\mathbf{C}) - \\mathbf{A}^T$ \u6700\u5927\u3002\u5176\u4e2d $\\mathbf{A}^T$ \u4e3a $\\mathbf{A}$ \u7684\u8f6c\u7f6e\u3002\u8f93\u51fa $\\mathbf{D}$\u3002\n\n\u9996\u5148\u63a8\u4e00\u6ce2\u5f0f\u5b50\uff0c\u53d1\u73b0\u9898\u76ee\u8981\u6c42\u6700\u5927\u5316\u4e0b\u5f0f\uff1a\n$$\n\\sum_{i = 1}^n \\sum_{j = 1}^n A_i A_j B_{i, j} - \\sum_{i = 1}^n C_i A_i\n$$\n\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\uff0c$\\mathbf{A}, \\mathbf{C}$ \u6211\u4eec\u90fd\u8bb0\u4e3a\u5411\u91cf\u5f62\u5f0f\u3002\n\n\u7531\u4e8e $\\forall i, A_i \\in \\{0, 1\\}$\uff0c\u4e0d\u96be\u8054\u60f3\u5230\u6700\u5c0f\u5272\u6a21\u578b\uff1b\u800c\u8fd9\u4e2a\u5f0f\u5b50\u7b2c\u4e00\u9879\u5b58\u5728 $i, j$\uff0c\u7b2c\u4e8c\u9879\u53ea\u5b58\u5728 $i$\uff0c\u5982\u679c\u5206\u522b\u5f53\u4f5c\u8fb9\u6743 / \u70b9\u6743\u5c31\u80fd\u76f4\u63a5\u7528\u7c7b\u4f3c\u6700\u5927\u5bc6\u5ea6\u5b50\u56fe\u7684\u505a\u6cd5\u6c42\u3002\n$$\n\\mathrm{maximize} \\sum_{i = 1}^n \\sum_{j = 1}^n A_i A_j B_{i, j} - \\sum_{i = 1}^n C_i A_i\n$$\n$$\n\\iff \\mathrm{minimize} \\sum_{i = 1}^n C_i A_i - \\sum_{i = 1}^n \\sum_{j = 1}^n A_i A_j B_{i, j}\n$$\n\u5c06\u539f\u70b9\u96c6 $V$ \u5212\u5206\u4e3a\u4e24\u4e2a\u96c6\u5408 $V^{'}, \\bar{V^{'}}$\uff0c\u5176\u4e2d $V^{'} \\cap \\bar{V^{'}} = \\emptyset, V^{'} \\cup \\bar{V^{'}} = V$\uff1b\u8bbe $A_i = 1$ \u8868\u793a $i \\in V^{'}$ \uff0c$A_i = 0$ \u8868\u793a $i \\in \\bar{V^{'}}$ \uff0c\u6709\uff1a\n$$\n\\begin{aligned}\n  &= \\sum_{u \\in V^{'}} C_u - \\sum_{u \\in V^{'}} \\sum_{v \\in V^{'}} B_{u, v} \\\\\n  &= \\sum_{u \\in V^{'}} (C_u - B_{u, u}) - \\sum_{u \\in V^{'}} \\sum_{v \\in V^{'}} [u \\neq v] B_{u, v} \\\\\n  &= \\sum_{u \\in V^{'}} (C_u - B_{u, u}) - \\sum\\limits_{u \\in V^{'}} \\mathrm{Deg}(u) + \\sum\\limits_{u \\in V^{'}} \\sum\\limits_{v \\in \\bar{V^{'}}} B_{u, v} \\\\\n\\end{aligned}\n$$\n\u5176\u4e2d $\\mathrm{Deg}(u) = \\sum\\limits_{v = 1}^{n} B_{u, v}$\u3002\u4e8e\u662f\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u957f\u6210\u4e86\u6700\u5927\u5bc6\u5ea6\u5b50\u56fe\u7684\u6837\u5b50\uff0c\u4e0d\u96be\u53d1\u73b0\u70b9\u6743 $w_u = C_u - B_{u, u}$\uff0c\u8fb9\u6743 $\\mathrm{cost}(u, v) = B_{u, v}$\uff0c\u518d\u6b21\u53d8\u5f62\u6709\uff1a\n$$\n\\sum_{u \\in V^{'}} w_u - \\sum\\limits_{u \\in V^{'}} \\mathrm{Deg}(u) + \\sum\\limits_{u \\in V^{'}} \\sum\\limits_{v \\in \\bar{V^{'}}} \\mathrm{cost}(u, v)\n$$\n\u4e8e\u662f\u5957\u677f\u5b50\uff0c\u641e\u4e00\u4e2a\u8db3\u591f\u5927\u7684\u6570 $U$\uff0c$S \\to u$ \u52a0\u8fb9\u6743\u4e3a $U$ \u7684\u8fb9\uff0c$u \\to T$ \u52a0\u8fb9\u6743\u4e3a $w_u - \\mathrm{Deg}(u) + U$ \u7684\u8fb9\uff0c$\\forall (u, v), u \\neq v$ \u4e4b\u95f4\u52a0 $\\mathrm{cost}(u, v)$ \u7684\u8fb9\u3002\u4e00\u904d Dinic \u5373\u53ef\u3002\n\n**Code**\n\n```cpp\n# include <cstdio>\n# include <cstring>\n# include <algorithm>\n\nconstexpr int n_max(600), inf(0x3f3f3f3f);\n\nint b[n_max][n_max], c[n_max], w[n_max];\nint deg[n_max];\nint n, base;\n\ntemplate <typename T, int v_max, int e_max>\nclass flow_network {\n  struct edge { T c; int to, nxt; } e[e_max << 1];\n  int head[v_max], idx = 1, cur[v_max], dis[v_max];\n  inline bool search0() {\n    static int q[v_max], *hh, *tt;\n    memset(dis, 0x00, sizeof dis);\n    hh = tt = q, *tt++ = s, dis[s] = 1, cur[s] = head[s];\n    while (hh < tt) {\n      const int u(*hh++);\n      for (int i(head[u]); i; i = e[i].nxt) {\n        const int v(e[i].to);\n        if (!dis[v] && e[i].c)\n        { dis[v] = dis[u] + 1, cur[v] = head[v], *tt++ = v; }\n      }\n    }\n    return dis[t];\n  }\n  T search1(const int u, const T cap) {\n    if (u == t) return cap;\n    T flow(0);\n    for (int i(cur[u]); i && flow < cap; i = e[i].nxt) {\n      cur[u] = i; const int v(e[i].to);\n      if (dis[v] == dis[u] + 1 && e[i].c) {\n        T f(search1(v, std::min(cap - flow, e[i].c)));\n        if (!f) { dis[v] = 0; }\n        else { flow += f, e[i].c -= f, e[i ^ 1].c += f; }\n      }\n    }\n    return flow;\n  }\npublic:\n  int s, t;\n  inline void add(const int u, const int v, const T c) {\n    e[++idx].to = v, e[idx].c = c, e[idx].nxt = head[u], head[u] = idx;\n    e[++idx].to = u, e[idx].c = 0, e[idx].nxt = head[v], head[v] = idx;\n  }\n  inline T dinic() {\n    T res(0), flow;\n    while (search0()) { while ((flow = search1(s, inf))) { res += flow; } }\n    return res;\n  }\n};\nflow_network<int, n_max, n_max * n_max> net;\n\nint main() {\n  scanf(\"%d\", &n), net.s = 0, net.t = n + 1;\n  for (int i(1); i <= n; ++i) for (int j(1); j <= n; ++j) {\n    scanf(\"%d\", &b[i][j]);\n    if (i != j) deg[i] += b[i][j];\n  }\n  for (int i(1); i <= n; ++i) {\n    scanf(\"%d\", &c[i]);\n    w[i] = c[i] - b[i][i];\n    base = std::max(base, deg[i] - w[i]);\n  }\n  for (int i(1); i <= n; ++i) {\n    net.add(net.s, i, base);\n    net.add(i, net.t, w[i] - deg[i] + base);\n  }\n  for (int i(1); i <= n; ++i) for (int j(1); j <= n; ++j)\n  { net.add(i, j, b[i][j]); }\n  printf(\"%d\\n\", n * base - net.dinic());\n  return 0;\n}\n```\n",
        "postTime": 1675140821,
        "uid": 482605,
        "name": "_Cx330",
        "ccfLevel": 6,
        "title": "P3973 [TJOI2015]\u7ebf\u6027\u4ee3\u6570 \u9898\u89e3"
    },
    {
        "content": "### \u9898\u76ee\u94fe\u63a5\n[\u6233\u6211](https://www.luogu.org/problemnew/show/P3973)\n\n### $Solution$\n\n\u9996\u5148\u6765\u5316\u7b80\u4e00\u4e0b\u5f0f\u5b50  \n\n$$D=(A*B-C)*A^T$$  \n$$=\\sum_{i=1}^{n}(\\sum_{j=1}^{n}A_j*B_{j,i}-C_i)*A_i$$   \n$$=\\sum_{i=1}^{n}\\sum_{j=1}^{n}A_i*A_j*B_{i,j}-\\sum_{i=1}^{n}C_i*A_i$$  \n\n\n\u56e0\u4e3a\u9898\u76ee\u5df2\u7ecf\u8bf4\u660e\u4e86$A$\u662f\u4e00\u4e2a$01$\u4e32,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5f53$A_i$\u4e3a$0$\u7684\u65f6\u5019\u5bf9\u7b54\u6848\u5e76\u6ca1\u6709\u4efb\u4f55\u8d21\u732e\uff0c\u4e0d\u7528\u8ba1\u7b97\u3002\u5f53$A_i$\u4e3a$1$\u65f6\uff0c\u4f1a\u6709$C_i$\u7684\u82b1\u8d39\u3002\u4f46\u5982\u679c\u540c\u65f6\u9009$j$\u4f1a\u6709$B_{i,j}$\u7684\u82b1\u8d39.\u6240\u4ee5\u8fd9\u663e\u7136\u662f\u4e00\u4e2a\u6700\u5c0f\u5272\u6a21\u578b\u4e86\u3002\u8bb21\u770b\u4e3a\u9009\uff0c0\u4e3a\u4e0d\u9009\n\n\u5efa\u56fe\uff1a\n- \u5c06\u6bcf\u4e2a$B_{ij}$\u770b\u505a\u4e00\u4e2a\u70b9,\u603b\u5171\u6709$n*n$\u4e2a\u70b9\u3002\u5c06\u8fd9$S$\u548c\u8fd9$n*n$\u4e2a\u70b9\u76f8\u8fde\uff0c\u6d41\u91cf\u4e3a$B_{i,j}$\n- \u65b0\u5efa$n$\u4e2a\u70b9\u3002\u5c06\u8fd9\u4e9b\u70b9\u548c$T$\u76f8\u8fde\uff0c\u6d41\u91cf\u4e3a$C_i$\n- \u5c06$n*n$\u4e2a\u70b9\u548c\u65b0\u5efa\u8282\u70b9\u4e2d\u7684$i,j$\u76f8\u8fde\uff0c\u6d41\u91cf\u4e3a$inf$\n\n\u7b54\u6848\u5c31\u662f$B$\u77e9\u9635\u5185\u7684\u548c-\u6700\u5c0f\u5272\n\n### $Code$\n\n\u7f51\u7edc\u6d41\u4ee3\u7801\u8fc7\u4e8e\u957f\uff0c\u4ee3\u7801\u89c1\u535a\u5ba2[\u8fd9\u513f](https://www.cnblogs.com/hbxblog/p/10280551.html)",
        "postTime": 1547689295,
        "uid": 19805,
        "name": "\u64a4\u4e91",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    },
    {
        "content": "\u4e4b\u524d\u5c45\u7136\u4e0d\u77e5\u9053\u77e9\u9635\u7684\u8f6c\u7f6e\u662f\u4ec0\u4e48/qd\uff0c\u767e\u5ea6\u4e00\u4e0b\u53d1\u73b0\u8fd9\u5c31\u662f\u628a\u77e9\u9635\u7684\u6a2a\u7ad6\u98a0\u5012\u4e00\u4e0b\u3002\n\n\u7136\u540e\u8fdb\u884c\u4e00\u4e2a\u67ff\u5b50\u7684\u63a8\uff0c\u53d1\u73b0 $D=\\sum\\limits_{i=1}^n a_i\\ (\\sum\\limits_{j=1}^na_j\\times b_{j,i}-c_i)$\uff0c\u7531\u4e8e $c_i$ \u8fd9\u4e2a\u4e1c\u897f\u7684\u5b58\u5728\uff0c\u4e14 $a$ \u662f $01$ \u77e9\u9635\uff0c\u6240\u4ee5\u8003\u8651\u6700\u5c0f\u5272\u3002\n\n\u4ee4 $a_i=1$ \u7684\u70b9 $i$ \u5c5e\u4e8e\u96c6\u5408 $S$\uff0c$a_i=0$ \u7684\u70b9 $i$ \u5c5e\u4e8e\u96c6\u5408 $T$\uff0c\u5957\u8def\u6027\u5730\u628a\u6bcf\u4e2a\u70b9 $i$ \u62c6\u6210\u6a2a\u7ad6\u4e24\u4e2a\u70b9 $x_i$ \u548c $y_i$\uff0c\u6839\u636e\u5f0f\u5b50\u5efa\u56fe\uff1a\n\n- $a_i=0$ \u635f\u5931\u7684\u8d21\u732e\u4e3a $sum_i=\\sum\\limits_{j=1}^n b_{j,i}$\uff0c\u53ef\u4ee5\u8868\u793a\u4e3a\u8fde\u8fb9 $(s,x_i,sum_i)$\uff1b\n- $a_i=1$ \u4e14 $a_j=0$ \u635f\u5931\u7684\u8d21\u732e\u4e3a $b_{j,i}$\uff0c\u8868\u793a\u4e3a\u8fde\u8fb9 $(x_i,y_j,b_{j,i})\\ (j\\ne i)$\uff0c$i=j$ \u65f6\u4e0d\u53ef\u80fd\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0c\u5373\u8fde\u8fb9 $(x_i,y_i,+\\infty)$\uff1b\n- $a_i=1$ \u8981\u989d\u5916\u635f\u5931\u8d21\u732e $c_i$\uff0c\u5373\u8fde\u8fb9 $(y_i,t,c_i)$\uff0c\u5f53 $i\\in S$ \u65f6\u5f3a\u5236\u5207\u65ad\u8fd9\u6761\u8fb9\u3002\n\n\u8dd1 Dinic \u5373\u53ef\uff0c\u7b54\u6848\u5373 $ans=\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n b_{i,j}-$ \u6700\u5c0f\u5272\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define rep(i,s,e) for(int i=(s);i<=(e);++i)\n#define Rep(i,s,e) for(int i=(e);i>=(s);--i)\nusing namespace std;\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch>'9'||ch<'0'){if(ch=='-') f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n    return x*f;\n}\nconst int N=1010,M=1e6+5;\nint n,s,t,b[N>>1][N>>1],c[N],sum[N];\nint head[N],rad[N],cnt=1;\nstruct qwq{\n    int v,w,nxt;\n}e[M];\ninline void add(int u,int v,int w){\n    e[++cnt]={v,w,head[u]},head[u]=cnt;\n    e[++cnt]={u,0,head[v]},head[v]=cnt;\n}\nint dep[N];\ninline bool bfs(){\n    queue<int> q;\n    rep(i,1,t) dep[i]=0;\n    dep[s]=1,q.push(s);\n    while(!q.empty()){\n        int x=q.front();q.pop();\n        rad[x]=head[x];\n        for(int i=head[x];i;i=e[i].nxt){\n            int v=e[i].v,w=e[i].w;\n            if(w&&!dep[v]) dep[v]=dep[x]+1,q.push(v);\n        }\n    }\n    return dep[t]!=0;\n}\nint dfs(int x,int flow){\n    if(x==t) return flow;\n    int out=0;\n    for(int &i=rad[x];i;i=e[i].nxt){\n        int v=e[i].v,&w=e[i].w;\n        if(w&&dep[v]==dep[x]+1){\n            int res=dfs(v,min(flow,w));\n            out+=res,flow-=res,w-=res,e[i^1].w+=res;\n        }\n        if(!flow) break;\n    }\n    if(flow) dep[x]=-1;\n    return out;\n}\nsigned main(){\n    n=read(),s=n<<1|1,t=s+1;\n    int ans=0,tmp;\n    rep(i,1,n) rep(j,1,n) b[i][j]=read(),sum[j]+=b[i][j];\n    rep(i,1,n) c[i]=read(),ans+=sum[i];\n    rep(i,1,n){\n        add(s,i,sum[i]),add(i+n,t,c[i]),add(i,i+n,1e9);\n        rep(j,1,n) if(j!=i) add(i,j+n,b[j][i]);\n    }\n    while(bfs()) while(tmp=dfs(s,1e9)) ans-=tmp;\n    // rep(i,1,t) cerr<<dep[i]<<' ';cerr<<endl;\n    printf(\"%d\\n\",ans);\n}\n```\n",
        "postTime": 1676771731,
        "uid": 613616,
        "name": "zcxxn",
        "ccfLevel": 7,
        "title": "P3973 [TJOI2015]\u7ebf\u6027\u4ee3\u6570 \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u4e0d\u8981\u8bfb\u9519\u9898\uff0c\u6ce8\u610f $A$ \u662f\u4e00\u4e2a $01$ \u77e9\u9635\n\n\u5316\u7b80\u4e00\u4e0b\u5f0f\u5b50\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$ans=\\sum_{i=1}^{n}\\sum_{j=1}^{n}a_ia_jb_{i,j}-\\sum_{i=1}^{n}a_ic_i$$\n\n\u610f\u601d\u5c31\u662f\u6709 $n$ \u4e2a\u7269\u54c1\uff0c\u5982\u679c $i,j$ \u540c\u65f6\u9009\u62e9\u4e86\uff0c\u90a3\u4e48\u5f97\u5230 $b_{i,j}$ \u7684\u6536\u76ca\uff1b\u5982\u679c $i$ \u9009\u62e9\u4e86\uff0c\u90a3\u4e48\u4f1a\u82b1\u8d39 $c_i$\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u5c31\u662f\u4e2a\u6700\u5927\u6743\u95ed\u5408\u5b50\u56fe\u554a\u2026\u2026\n\n\u5982\u679c\u9009\u62e9\u6536\u76ca $b_{i,j}$\uff0c\u90a3\u4e48\u4f1a\u5fc5\u987b\u9009\u62e9 $i,j$\uff1b\u5982\u679c\u9009\u62e9 $i$\uff0c\u90a3\u4e48\u5fc5\u987b\u9009\u62e9\u4ee3\u4ef7 $c_i$\n\n\u7136\u540e $S \\to b_{i,j} \\to i,j \\to c_i,c_j \\to T$\n\n\u6b63\u6743\u52a0\u8d77\u6765\u540e\u51cf\u53bb\u6700\u5927\u6d41\u5373\u53ef\n\n``` cpp\n// luogu-judger-enable-o2\n#include \"bits/stdc++.h\"\nusing namespace std;\ntypedef long long ll;\n\nconst int N = 5e6 + 10;\n\nint b[510][510], c[510];\n\nint head[N], rest[N], to[N], flow[N], tot = 1;\n\nvoid ins(int u, int v, int w) {\n    to[++ tot] = v, flow[tot] = w, rest[tot] = head[u], head[u] = tot;\n}\nvoid add(int u, int v, int w) {\n    ins(u, v, w), ins(v, u, 0);\n}\n\nint dis[N], s, t, cnt;\n\nint bfs() {\n    for(int i = 1 ; i <= cnt ; ++ i) dis[i] = -1;\n    dis[s] = 1; queue<int> q; q.push(s);\n    while(q.size()) {\n        int u = q.front(); q.pop();\n        for(int i = head[u] ; i ; i = rest[i]) {\n            int v = to[i];\n            if(dis[v] == -1 && flow[i]) {\n                dis[v] = dis[u] + 1;\n                q.push(v);\n            }\n        }\n    }\n    return dis[t] != -1;\n}\n\nint dfs(int u, int f) {\n    int use = 0;\n    if(u == t || !f) return f;\n    for(int i = head[u] ; i ; i = rest[i]) {\n        int v = to[i];\n        if(dis[v] == dis[u] + 1 && flow[i]) {\n            int a = dfs(v, min(flow[i], f - use));\n            flow[i] -= a, flow[i ^ 1] += a, use += a;\n            if(use == f) break;\n        }\n    }\n    if(!use) dis[u] = -1;\n    return use;\n}\n\nconst int inf = 0x3f3f3f3f;\n\nint sol() {\n    int res = 0;\n    while(bfs()) {\n        res += dfs(s, inf);\n    }\n    return res;\n}\nint n, idA[510], idB[510][510], idC[510];\nint main() {\n    scanf(\"%d\", &n);\n    for(int i = 1 ; i <= n ; ++ i)\n        for(int j = 1 ; j <= n ; ++ j)\n            scanf(\"%d\", &b[i][j]);\n    for(int i = 1 ; i <= n ; ++ i)\n        scanf(\"%d\", &c[i]);\n    for(int i = 1 ; i <= n ; ++ i) idA[i] = ++ cnt;\n    for(int i = 1 ; i <= n ; ++ i)\n        for(int j = 1 ; j <= n ; ++ j)\n            idB[i][j] = ++ cnt;\n    for(int i = 1 ; i <= n ; ++ i) idC[i] = ++ cnt;\n    s = ++ cnt, t = ++ cnt;\n    int ans = 0;\n    for(int i = 1 ; i <= n ; ++ i) {\n        for(int j = 1 ; j <= n ; ++ j) {\n            ans += b[i][j];\n            add(s, idB[i][j], b[i][j]);\n            add(idB[i][j], idA[i], inf);\n            add(idB[i][j], idA[j], inf);\n        }\n    }\n    for(int i = 1 ; i <= n ; ++ i) {\n        add(idA[i], idC[i], inf);\n        add(idC[i], t, c[i]);\n    }\n\n    printf(\"%d\\n\", ans - sol());\n}\n```",
        "postTime": 1547739460,
        "uid": 47111,
        "name": "nekko",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\u77e9\u9635\u4e58\u6cd5\u5b9a\u4e49\uff0c\u6700\u5927\u6d41\u6700\u5c0f\u5272\n\n\u5148\u6765\u8f6c\u5316\u4e00\u4e0b\u9898\u610f\uff0c\u7531\u4e8e $A$ \u662f $01$ \u7684\u884c\u5411\u91cf\uff0c\u9898\u76ee\u5b9e\u9645\u4e0a\u662f\u6309\u7167\u89c4\u5219\uff0c\u9009\u62e9\u4e00\u4e9b\u6570\u4f7f\u5f97\u6743\u503c\u548c\u6700\u5927\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u7684\u662f $AB-C$ \u662f\u6307\u5728\u77e9\u5f62\u4e2d\u6bcf\u4e00\u5217\u56fa\u5b9a\u9009\u51e0\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u6570\uff08$A$ \u4e2d\u4e3a $1$\uff09\uff0c\u52a0\u548c\u51cf\u53bb $C$ \u4e2d\u7684\u6570\uff0c\u4ece\u800c\u5f97\u5230\u4e00\u4e2a\u65b0\u7684\u884c\u5411\u91cf\u3002\n\n\u63a5\u4e0b\u6765\u518d\u4e58\u4e0a $A$ \u7684\u8f6c\u7f6e\u4e5f\u5c31\u662f\u5728\u884c\u5411\u91cf\u4e2d\u9009\u62e9\u521a\u624d\u9009\u62e9\u4f4d\u7f6e\u4e0a\u7684\u6570\u52a0\u548c\u3002\n\n\u753b\u56fe\u7406\u89e3\u5b9e\u9645\u4e0a\u662f\u5728\u65b9\u9635\u4e0a\u5212\u53bb\u884c\u4ee5\u53ca\u5bf9\u5e94\u7684\u5217\uff0c\u6ca1\u6709\u88ab\u5212\u53bb\u7684\u6570\u6c42\u548c\uff0c\u540c\u65f6\u6ca1\u6709\u5212\u53bb\u7684\u5217\u8981\u51cf\u53bb\u5bf9\u5e94\u4f4d\u7f6e\u7684 $C$ \u503c\u3002\n\n\u653e\u5728\u4e00\u8d77\u5c31\u662f\u4e00\u4e2a $(n+1)\\times n$ \u7684\u77e9\u9635\u5212\u53bb\u4e00\u4e9b\u5217\u4ee5\u53ca\u5bf9\u5e94\u7684\u884c\uff0c\u6c42\u548c\u7684\u6700\u5927\u503c\uff0c\u5176\u4e2d\u9664\u6700\u540e\u4e00\u884c\u4ee5\u5916\u90fd\u662f\u6b63\u8d21\u732e\u3002\n\n\u53ef\u4ee5\u60f3\u5230\u7684\u4e00\u4e2a\u7f51\u7edc\u6d41\u7ecf\u5178\u6a21\u578b\u662f\u8ba9\u6bcf\u4e2a\u8282\u70b9\u8868\u793a\u5212\u53bb\u7684\u4e00\u884c\uff08\u5217\uff09\uff0c\u70b9\u4e0e\u70b9\u4e4b\u95f4\u7684\u5bb9\u91cf\u88ab\u6743\u503c\u9650\u5236\uff0c\u94a6\u5b9a\u4e0e\u6e90\u70b9\u76f8\u8fde\u8868\u793a\u4e0d\u5212\u53bb\uff0c\u4e0e\u6c47\u70b9\u76f8\u8fde\u8868\u793a\u5212\u53bb\u3002\n\n\u8003\u8651 $(i,j)$\uff0c\u9ed8\u8ba4 $i,j$ \u4e0d\u540c\u3002\n\n\u8bbe\u5bb9\u91cf $c(s,i)=a,c(s,j)=b,c(i,t)=c,c(j,t)=d,c(i,j)=e,c(i,j)=f$\uff0c\u6839\u636e\u4e00\u4e9b\u60c5\u51b5\u53ef\u4ee5\u5217\u51fa\u65b9\u7a0b\uff1a\n\n\u5f53 $i,j$ \u90fd\u4e0d\u88ab\u5212\u53bb\u65f6\uff0c\u5272\u53bb $c,d$\uff0c\u4ee3\u4ef7 $0$\uff0c\u5373\uff1a\n$$c+d=0$$\n\u5f53 $i,j$ \u90fd\u88ab\u5212\u53bb\u65f6\uff0c\u540c\u7406\u6709\uff1a\n$$a+b=B_{i,j}+B{j,i}$$\n\u5f53 $i$ \u88ab\u5212\u53bb\u65f6\uff1a\n$$a+c+e=B_{i,j}+B_{j,i}$$\n\u5f53 $j$ \u88ab\u5212\u53bb\u65f6\uff1a\n$$b+d+f=B_{i,j}+B_{j,i}$$\n\n\u800c $i=j$ \u65f6\uff0c\u8981\u8003\u8651 $C$ \u7684\u8d1f\u8d21\u732e\uff0c\u4e5f\u5c31\u662f\uff1a\n$$c(s,i)=B_{i,i}-C_i,c(i,t)=0$$\n\n\u5176\u5b9e\u8bf4\u5230\u8fd9\u91cc\uff0c\u4e0d\u96be\u770b\u51fa\u89e3\u51fa\u5bb9\u91cf\u8dd1\u6700\u5c0f\u5272\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u5bb9\u91cf\u53ef\u80fd\u4e3a\u8d1f\u6570\u6216\u96f6\uff0c\u8fd9\u662f\u6211\u4eec\u4e0d\u60f3\u770b\u5230\u7684\u3002\n\n\u7136\u800c\u51fa\u73b0\u8fd9\u79cd\u6743\u503c\u4e00\u5b9a\u5728\u4e0e\u6e90\u70b9\u548c\u6c47\u70b9\u7684\u8fb9\u4e0a\uff0c\u800c\u6bcf\u4e2a\u70b9\u4e0e\u6e90\u70b9\u6c47\u70b9\u7684\u8fb9\u4e00\u5b9a\u4f1a\u5272\u6389\u4e00\u6761\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u7ed9\u5b83\u589e\u52a0\u4e00\u4e2a\u9644\u52a0\u6743\u503c\u800c\u4e0d\u5f71\u54cd\u7b54\u6848\uff0c\u8bbe\u9644\u52a0\u6743\u503c\u4e3a $bs$\uff0c\u8fd9\u6837\u89e3\u4e0a\u9762\u7684\u65b9\u7a0b\u5f97\u5230\uff1a\n$$\\begin{cases}\na=b=bs+\\dfrac{B_{i,j}+B_{j,i}}{2}\\\\\nc=d=bs\\\\\ne=f=\\dfrac{B_{i,j}+B_{j,i}}{2}\n\\end{cases}$$\n\n\u4e8e\u662f\u7b54\u6848\u5c31\u662f\uff1a\n$$\\sum b-\\sum c+bs\\times n-\\operatorname{maxf}()$$\n\n\u5176\u5b9e\u6700\u5c0f\u5272\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u5c31\u662f\u6d88\u53bb\u4e0d\u9700\u8981\u7684\u8d21\u732e\u3002\n\n```cpp\nint n;\nint b[505][505],c[505]; \nint S,T;\nstruct Graph{\n    struct edge{\n        int to,nxt,lim;\n    }e[maxm<<1];\n    int head[maxn],cnt=1;\n    inline void add_edge(int u,int v,int w){\n        e[++cnt].to=v,e[cnt].nxt=head[u],e[cnt].lim=w,head[u]=cnt;\n        e[++cnt].to=u,e[cnt].nxt=head[v],e[cnt].lim=0,head[v]=cnt;\n    }\n    int cur[maxn],dis[maxn];\n    ll dfs(int u,ll rest){\n        if(u==T) return rest;\n        ll flow=0;\n        for(int i=cur[u];i&&rest;i=e[i].nxt){\n            cur[u]=i;\n            int v=e[i].to,C=min(rest,(ll)e[i].lim);\n            if(dis[u]+1==dis[v]&&C){\n                ll k=dfs(v,C);\n                flow+=k,rest-=k;\n                e[i].lim-=k,e[i^1].lim+=k;\n            }\n        }\n        if(!flow) dis[u]=-1;\n        return flow;\n    }\n    inline ll max_flow(){\n        ll flow=0;\n        while(1){\n            queue<int> q;\n            memcpy(cur,head,sizeof(head));\n            memset(dis,-1,sizeof(dis));\n            dis[S]=0;\n            q.push(S);\n            while(!q.empty()){\n                int u=q.front();\n                q.pop();\n                for(int i=head[u];i;i=e[i].nxt){\n                    int v=e[i].to;\n                    if(dis[v]==-1&&e[i].lim){\n                        dis[v]=dis[u]+1;\n                        q.push(v);\n                    }\n                }\n            }\n            if(dis[T]==-1) return flow;\n            flow+=dfs(S,1e18);\n        }\n    }\n}G;\nll sum[505],ans;\nint main(){\n    // freopen(\"test.in\",\"r\",stdin);\n    // freopen(\"test.out\",\"w\",stdout);\n    n=read();\n    for(int i=1;i<=n;++i){\n        for(int j=1;j<=n;++j){\n            b[i][j]=read();\n            ans+=b[i][j];\n        }\n    }\n    for(int i=1;i<=n;++i){\n        c[i]=read();\n        ans-=c[i];\n    }\n    ans+=bs*n;\n    S=n+1,T=n+2;\n    for(int i=1;i<=n;++i){\n        sum[i]=bs+b[i][i]-c[i];\n        G.add_edge(i,T,bs*2);\n        sum[i]*=2;\n        // printf(\"sum: %d %lld\\n\",i,sum[i]);\n    }\n    for(int i=1;i<=n;++i){\n        for(int j=1;j<=n;++j){\n            if(i==j) continue;\n            G.add_edge(i,j,b[i][j]+b[j][i]);\n            sum[i]+=b[i][j]+b[j][i];\n        }\n    }\n    for(int i=1;i<=n;++i){\n        G.add_edge(S,i,sum[i]);\n    }\n    printf(\"%lld\\n\",ans-G.max_flow()/2);\n    return 0;\n}\n```",
        "postTime": 1670491825,
        "uid": 321177,
        "name": "SoyTony",
        "ccfLevel": 6,
        "title": "P3973 \u9898\u89e3"
    },
    {
        "content": "# P3973 [TJOI2015]\u7ebf\u6027\u4ee3\u6570\n\n\u849f\u84bb\u4e00\u904d\u8fc7\uff0c\u53d1\u9898\u89e3\u796d\u4e4b\u3002\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P3973)\n[\u66f4\u597d\u4f53\u9a8c](https://codewasp942.github.io/Kn-Blog/solution/P3973)\n\n\u4e00\u9053\u770b\u8d77\u6765\u4e0d\u50cf\u8d39\u7528\u6d41\u7684\u8d39\u7528\u6d41\n\n## \u5206\u6790\n\n\u5148\u5c55\u5f00\u67ff\u5b50\n\n$$\n\\begin{aligned}\nD&=(A\\times B-C)\\times A^T\\\\\n&=\\sum_{i=1}^n{a_i\\left(\\sum_{j=1}^n{a_j\\cdot b_{j,i}}-c_i\\right)}\\\\\n&=\\sum_{i=1}^n\\sum_{j=1}^n{a_ia_jb_{j,i}}-\\sum_{i=1}^n{a_ic_i}\\\\\n&=\\sum_{i=1}^n\\sum_{j=1}^n{a_ia_jb_{i,j}}-\\sum_{i=1}^n{a_ic_i}\n\\end{aligned}\n$$\n\n$A$ \u662f **01 \u77e9\u9635**\uff0c\u6240\u4ee5 $a_i$ \u548c $a_j$ \u90fd\u4e3a $1$ \u65f6\uff0c$a_i a_j$ \u7684\u53d6\u503c\u624d\u80fd\u662f $1$\u3002\n\n\u8bbe\u5c55\u5f00\u5f0f\u51cf\u53f7\u524d\u7684\u90e8\u5206\u4e3a $X$\uff0c\u51cf\u53f7\u540e\u7684\u90e8\u5206\uff08\u542b\u51cf\u53f7\uff09\u4e3a $Y$\uff0c\u5219 $D=X+Y$\u3002\n\n\u5148\u8003\u8651 $X$\u3002\u5047\u8bbe\u6240\u6709 $a_i$ \u5168\u90e8\u662f $1$\uff0c\u8fd9\u65f6\uff0c$X=\\sum b_{i,j}$\u3002\u5bf9\u4e8e\u6bcf\u4e00\u5bf9 $(i,j)$\uff0c\u5982\u679c $a_i$ \u548c $a_j$ \u4e2d\u6709\u4e00\u4e2a\u4e3a $0$\uff0c\u5c31\u4f1a\u4f7f\u51cf\u53f7\u524d\u7684\u90e8\u5206\u51cf\u5c11 $b_{i,j}$\uff0c\u4e5f\u5c31\u662f\u4ea7\u751f $b_{i,j}$ \u7684\u635f\u5931\u3002\n\n\u518d\u8003\u8651 $Y$\u3002\u5047\u8bbe\u6240\u6709 $a_i$ \u5168\u90e8\u662f $0$\uff0c\u8fd9\u65f6\uff0c$Y=0$\u3002\u5982\u679c $a_i$ \u53d8\u4e3a $1$\uff0c\u5219\u4f1a\u4f7f $Y$ \u589e\u52a0 $-c_i$\uff0c\u4e5f\u5c31\u662f\u4ea7\u751f $c_i$ \u7684\u635f\u5931\u3002\n\n\u5982\u679c\u6211\u4eec\u4e0d\u60f3\u4ea7\u751f $b_{i,j}$ \u7684\u635f\u5931\uff0c\u90a3\u4e48 $a_i$ \u548c $a_j$ \u5c31\u4e00\u5b9a\u90fd\u4e3a $1$\u3002 \n\n\u7531\u4e8e $b_{i,j}$ \u548c $c_i$ \u90fd\u975e\u8d1f\uff0c\u8fd9\u663e\u7136\u662f\u975e\u5e38\u7ecf\u5178\u7684\u6700\u5c0f\u5272\u6a21\u578b\u3002\u628a\u56fe\u5206\u6210\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u8868\u793a\u53d6\uff0c\u4e00\u90e8\u5206\u8868\u793a\u4e0d\u53d6\uff0c\u4e24\u90e8\u5206\u4e4b\u95f4\u8fb9\u8868\u793a\u5173\u7cfb\u3002\n\n**\u5efa\u56fe\u65b9\u6cd5**\uff1a\u628a\u6bcf\u4e2a $b_{i,j}$ \u770b\u4f5c\u70b9 $(i,j)$\uff0c\u6e90\u70b9\u5411 $(i,j)$ \u8fde\u8fb9\u6743\u4e3a $b_{i,j}$ \u7684\u8fb9\uff0c\u5272\u6389\u8fb9\u8868\u793a $a_i$ \u4e0e $a_j$ \u81f3\u5c11\u6709\u4e00\u4e2a\u662f $0$\uff0c\u628a\u6bcf\u4e2a $c_i$ \u770b\u4f5c\u70b9 $i$\uff0c$(i,j)$ \u5411 $i$ \u548c $j$ \u8fde\u8fb9\u6743\u4e3a $\\infty$ \u7684\u8fb9\uff0c$i$ \u5411\u6c47\u70b9\u8fde\u8fb9\u6743\u4e3a $c_i$ \u7684\u8fb9\uff0c\u5272\u6389\u8fb9\u8868\u793a $a_i=1$\uff0c\u8dd1**\u6700\u5c0f\u5272**\u3002\n\n\u5272\u6389\u6e90\u70b9\u5230 $(i,j)$ \u7684\u8fb9\u8868\u793a $a_i$ \u4e0e $a_j$ \u81f3\u5c11\u6709\u4e00\u4e2a\u4e3a $0$\uff0c\u4e5f\u5c31\u662f\u5272\u6389\u6216\u8005\u4e0d\u5272\u6389\u4e00\u6761\u8fb9\u90fd\u8868\u793a\u5bf9 $a_i$ \u7684\u7ea6\u675f\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7ea6\u675f\u4f1a\u4e0d\u4f1a\u51b2\u7a81\u5462\uff1f\u7b54\u6848\u662f\u4e0d\u4f1a\u7684\u3002\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u9a8c\u8bc1\u3002\n\n## Code\n\n```cpp\n#include <iostream>\n#include <cstring>\n#include <cstdio>\n#include <algorithm>\n#include <queue>\nusing namespace std;\n\ntypedef long long ll;\nconst ll inf=1145141919810000;\n\nnamespace Flow{\n\n\tconst int maxn=251005,maxm=750600;\n\tstruct Edge { int v;ll w;int nxt; } E[maxm*2];\n\tint Fst[maxn],tp=1;\n\tvoid add(int u,int v,ll w){ E[++tp]=Edge{v,w,Fst[u]}; Fst[u]=tp; }\n\tvoid addEdge(int u,int v,ll w){ add(u,v,w);add(v,u,0); }\n\n\tint s,t,h[maxn],g[maxn];\n\tvoid bfs(){\n\t\tqueue<int> Q; g[h[t]=1]++; Q.push(t);\n\t\twhile(!Q.empty()){\n\t\t\tint u=Q.front(); Q.pop();\n\t\t\tfor(int e=Fst[u];e;e=E[e].nxt){\n\t\t\t\tint v=E[e].v; if(h[v]) continue;\n\t\t\t\tg[h[v]=h[u]+1]++; Q.push(v);\n\t\t\t}\n\t\t}\n\t}\n\tll aug(int u,ll F){\n\t\tif(u==t || F==0) return F;\n\t\tll tot=0;\n\t\tfor(int e=Fst[u];e;e=E[e].nxt){\n\t\t\tint v=E[e].v; if(E[e].w==0 || h[v]+1!=h[u]) continue;\n\t\t\tll f=aug(v,min(F,E[e].w));\n\t\t\tF-=f;tot+=f;E[e].w-=f;E[e^1].w+=f;\n\t\t\tif(F==0){ return tot; }\n\t\t}\n\t\tif((--g[h[u]])==0) h[s]=maxn-1;\n\t\tg[++h[u]]++;\n\t\treturn tot;\n\t}\n\tll flow(){\n\t\tbfs(); ll ans=0;\n\t\twhile(h[s]<maxn-1) ans+=aug(s,inf);\n\t\treturn ans;\n\t}\n\n}\n\nint n;\nll b[505][505],c[505],su;\n\nint main(){\n\n\tios::sync_with_stdio(0); cin.tie(0); cout.tie(0);\n\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n;j++) cin>>b[i][j],su+=b[i][j];\n\tfor(int i=1;i<=n;i++) cin>>c[i];\n\n\tFlow::s=1; Flow::t=2;\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n;j++) Flow::addEdge(1,n*(i-1)+j+2,b[i][j]);\n\tfor(int i=1;i<=n;i++) Flow::addEdge(2+n*n+i,2,c[i]);\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tFlow::addEdge(n*(i-1)+j+2,2+n*n+i,inf);\n\t\t\tFlow::addEdge(n*(i-1)+j+2,2+n*n+j,inf);\n\t\t}\n\n\tcout<<su-Flow::flow()<<endl;\n\n\treturn 0;\n}\n```",
        "postTime": 1657866609,
        "uid": 371818,
        "name": "juruo999",
        "ccfLevel": 7,
        "title": "P3973 [TJOI2015]\u7ebf\u6027\u4ee3\u6570 \u9898\u89e3"
    },
    {
        "content": "### P.S.\n\u524d\u7f6e\u77e5\u8bc6\uff1a\n1. \u77e9\u9635\u77e5\u8bc6\uff08\u4fdd\u8bc1\u80fd\u770b\u61c2\u9898\u9762  \n2. \u6700\u5927\u6743\u95ed\u5408\u5b50\u56fe\uff08\u7f51\u7edc\u6d41\n\n### Description.\n\u7ed9\u5b9a $B_{[1...n][1...n]}$ \u548c $C_{[1...n]}$  \n\u6784\u9020 $A_{[1...n]}$ \u4e3a 01 \u77e9\u9635  \n\u4f7f\u5f97 $(A\\times B-C)\\times A^T$ \u6700\u5927\n### Solution.\n$$\\sum_{i=1}^na_i\\times\\left(\\left(\\sum_{j=1}^na_j\\times b_{j,i}\\right)-c_i\\right)$$  \n$$\\sum_{i=1}^na_i\\times\\left(\\sum_{j=1}^na_j\\times b_{j,i}\\right)-\\sum_{i=1}^na_ic_i$$  \n$$\\sum_{i=1}^n\\sum_{j=1}^na_ia_jb_{j,i}-\\sum_{i=1}^na_ic_i$$\n\u7531\u4e8e $\\{a_i\\}$ \u662f 01 \u6570\u7ec4\uff08\u8fd9\u4e2a\u7b14\u8005\u521a\u5f00\u59cb\u6ca1\u770b\u5230\u3002  \n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u60f3\u8c61\u6210\u6709 $n$ \u4e2a\u70b9\uff0c$\\{a_i\\}$ \u8868\u793a\u7b2c $i$ \u4e2a\u70b9\u662f\u5426\u9009\u62e9\u3002  \n\u7136\u540e\u4e0a\u9762\u7684\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\u9009\u7b2c $i$ \u4e2a\u70b9\u4f1a\u6709 $c_i$ \u7684\u4ee3\u4ef7\u3002  \n\u800c\u9009 $i$ \u548c $j$ \u4e24\u4e2a\u70b9\u6709 $b_{i,j}$ \u7684\u6536\u76ca\u3002  \n\u7136\u540e\u663e\u7136\u662f\u4e00\u4e2a\u6700\u5927\u5168\u95ed\u5408\u5b50\u56fe\u7684\u677f\u5b50\u3002  \n\u76f4\u63a5\u4e0a\u6700\u5c0f\u5272\u5c31\u597d\u4e86\u3002  \n### Coding.\n```cpp\n//\u613f\u4f60\u548c\u4f60\u91cd\u8981\u7684\u4eba\u80fd\u591f\u91cd\u9022\uff01\n#include<bits/stdc++.h>\nusing namespace std;typedef long long ll;\ntemplate<typename T>inline void read(T &x)\n{\n\tx=0;char c=getchar(),f=0;\n\tfor(;c<'0'||c>'9';c=getchar()) if(!(c^45)) f=1;\n\tfor(;c>='0'&&c<='9';c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\tf?x=-x,1:1;\n}\nconst ll INF=1e9+5;struct edge{int to;ll w;int nxt;}e[7505005];\nint n,s,t,et,head[250505],cur[250505],d[250505];\ninline void ADDE(int x,int y,ll w) {e[++et]=(edge){y,w,head[x]},head[x]=et;}\ninline void adde(int x,int y,ll w) {ADDE(x,y,w),ADDE(y,x,0);}\ninline char bfs(int s,int t)\n{\n\tqueue<int>q;q.push(s),memset(d,0,sizeof(d)),d[s]=1;\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();q.pop();\n\t\tfor(int i=head[x];i;i=e[i].nxt) if(!d[e[i].to]&&e[i].w) q.push(e[i].to),d[e[i].to]=d[x]+1;\n\t}\n\treturn !!d[t];\n}\n#define rev(x) ((((x)&1)?1:-1)+(x))\ninline ll dfs(int x,int t,ll lim=INF)\n{\n\tll f=lim;if(x==t) return lim;\n\tfor(int &i=cur[x];i;i=e[i].nxt) if(d[e[i].to]==d[x]+1&&e[i].w)\n\t\t{ll g=dfs(e[i].to,t,min(f,e[i].w));e[i].w-=g,e[rev(i)].w+=g,f-=g;if(!f) break;}\n\treturn lim-f;\n}\ninline ll dinic(int s,int t) {ll r=0;while(bfs(s,t)) memcpy(cur,head,sizeof(cur)),r+=dfs(s,t);return r;}\nint main()\n{\n\tread(n),s=n*n+n+1,t=s+1;ll cnt=0;\n\tfor(int i=1,id,x;i<=n;i++) for(int j=1;j<=n;j++) read(x),cnt+=x,adde(s,id=(i-1)*n+j,x),adde(id,n*n+i,INF),adde(id,n*n+j,INF);\n\tfor(int i=1,x;i<=n;i++) read(x),adde(n*n+i,t,x);\n\treturn printf(\"%lld\\n\",cnt-dinic(s,t)),0;\n}\n```",
        "postTime": 1610091025,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "P3973 [TJOI2015]\u7ebf\u6027\u4ee3\u6570\uff08\u9898\u89e3\uff09"
    },
    {
        "content": "\u9898\u76ee\u6240\u7ed9\u7684\u5f0f\u5b50\u53ef\u4ee5\u8f6c\u5316\u4e3a\n$$\\sum_{i=1}^n\\sum_{j=1}^nA_iA_jB_{ij}-\\sum_{i=1}^nA_iC_i$$  \n(\u987a\u4fbf\u4e00\u63d0\uff0c\u77e9\u9635$A$\u7684\u8f6c\u7f6e$A^T$\uff0c\u5373\u539f$A_{ij}=A^T_{ji}$  \n\u4ee4A\u4e2d1\u7684\u4f4d\u7f6e\u96c6\u5408\u4e3aS \u5219\n$$\\sum_{i\\in S}\\sum_{j\\in S}B_{ij}-\\sum_{i\\in S}C_i$$  \n\u663e\u7136\u4e3a\u6700\u5927\u6743\u95ed\u5408\u5b50\u56fe\u6a21\u578b\uff0c\u5957\u8def\u5efa\u56fe\u6c42\u6700\u5c0f\u5272\u5373\u53ef  \ncode:\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int M=1e6+6,inf=0x3f3f3f3f;\n\ninline int read(){\n\tint s=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)) s=s*10+ch-'0',ch=getchar();\n\treturn s;\n}\nint n;\nint b[505][505],c[505],id[505][505];\nstruct edge{\n\tint to,w,rev;\n};\nint d[M],cur[M];vector<edge> G[M];\nint s,t,tot=0;\nqueue<int> q;\ninline int bfs(){\n\tmemset(d,-1,sizeof(d));\n\td[s]=0,q.push(s);\n\twhile(!q.empty()){\n\t\tint u=q.front();q.pop();\n\t\tfor(edge e:G[u]){\n\t\t\tif(e.w>0&&d[e.to]<0){\n\t\t\t\td[e.to]=d[u]+1;\n\t\t\t\tq.push(e.to);\n\t\t\t}\n\t\t}\n\t}\n\treturn d[t]!=-1;\n}\nint dfs(int u,int f){\n\tif(u==t) return f;\n\tint w,tot=0;\n\tfor(int &i=cur[u];i<G[u].size();i++){\n\t\tedge &e=G[u][i];\n\t\tif(e.w>0&&d[e.to]==d[u]+1&&(w=dfs(e.to,min(e.w,f)))){\n\t\t\te.w-=w;G[e.to][e.rev].w+=w;\n\t\t\tf-=w,tot+=w;\n\t\t\tif(f<=0) break;\n\t\t} \n\t}\n\treturn tot;\n}\ninline void add_edge(int u,int v,int c){\n\tG[u].push_back({v,c,G[v].size()});\n\tG[v].push_back({u,0,G[u].size()-1});\n}\ninline int dinic(){\n\tint flow=0;\n\twhile(bfs()){\n\t\tmemset(cur,0,sizeof(cur));\n\t\tflow+=dfs(s,inf);\n\t}\n\treturn flow;\n}\nint main(){\n\tn=read();\n\tfor(int i=1;i<=n;i++) \n\t\tfor(int j=1;j<=n;j++)\n\t\t\tb[i][j]=read(),id[i][j]=++tot;\n\tfor(int i=1;i<=n;i++) c[i]=read();\n\ts=0,t=M-6;int ans=0;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tadd_edge(s,id[i][j],b[i][j]);\n\t\t\tadd_edge(id[i][j],tot+i,inf);\n\t\t\tans+=b[i][j];\n\t\t\tif(i!=j) add_edge(id[i][j],tot+j,inf);\n\t\t}\n\tfor(int i=1;i<=n;i++) add_edge(tot+i,t,c[i]);\n\tprintf(\"%d\",ans-dinic());\n\treturn 0;\n}\n\n```",
        "postTime": 1561978565,
        "uid": 27030,
        "name": "ustze",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    },
    {
        "content": "\u5206\u6790\uff1a\n\n\u7531\u4e8eA\u53ea\u67090\u548c1,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a0\u770b\u4f5c\u4e0d\u53d6\uff0c1\u770b\u4f5c\u53d6\u3002\n\u90a3\u9898\u76ee\u5c31\u53d8\u6210\u4e86\uff1a\n\n\u6709n\u4e2a\u70b9\uff0c\u53d6i\u8981\u6263\u9664ci\u7684\u6536\u76ca\uff0c\u4f46\u540c\u65f6\u53d6i\u548cj\u5219\u53ef\u4ee5\u83b7\u5f97b[i][j]+b[j][i]\u7684\u6536\u76ca\u3002\n\n\u8fd9\u5c31\u662f\u5f88\u7ecf\u5178\u7684\u6700\u5c0f\u5272\u5efa\u6a21\uff0c\u56e0\u4e3a\u628a\u4e00\u5f20\u7f51\u7edc\u5206\u6210\u4e24\u90e8\u5206\uff0c\n\n\u4e00\u90e8\u5206\u8868\u793a\u53d6\uff0c\u53e6\u4e00\u90e8\u5206\u8868\u793a\u4e0d\u53d6\uff0c\u6700\u5c0f\u5272\u5c31\u662f\u8fd9\u4e2a\u65b9\u6848\u7684\u6536\u76ca\u3002\n\n\u8bbe\u6e90\u70b9S\uff0c\u6c47\u70b9T\u3002\n\n\u7528(i,j)\u8868\u793a\u540c\u65f6\u9009i\u548cj\uff0cS\u5411(i,j)\u8fde\u5bb9\u91cf\u4e3ab[i][j]+b[j][i]\u7684\u8fb9\u3002\n\n\u7528i\u8868\u793a\u4e0d\u9009i\uff0ci\u5411T\u8fde\u5bb9\u91cf\u4e3ac[i]\u7684\u8fb9\u3002\n\n\u4e3a\u4e86\u4fdd\u8bc1(i,j)\u548ci\uff0cj\u540c\u65f6\u9009\u62e9\uff0c(i,j)\u5206\u522b\u5411i\u548cj\u8fde\u5bb9\u91cf\u4e3a\u65e0\u9650\u5927\u7684\u8fb9\u3002\n\n\u8fd9\u6837\uff0c\u8dd1\u4e00\u904d\u6700\u5927\u6d41\uff0cB\u77e9\u9635\u4e2d\u6240\u6709\u6570\u7684\u548c-\u6700\u5c0f\u5272\u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n#include<cstdio>\n\nusing namespace std;\n\nconst int inf=1e9;\n\nint e1,to[1000001],w[1000001],next[1000001],first[1000001];\nint e[1000001],f[1000001],d[1000001],b[501][501];\nint cur[1000001],N,ans=0,sum=0,n1,S,T,x,n,mi=inf;\n\nvoid insert(int o,int p,int q)\n{\n    to[e1]=p;w[e1]=q;next[e1]=first[o];first[o]=e1++;\n    to[e1]=o;w[e1]=0;next[e1]=first[p];first[p]=e1++;\n}\n\nint main()\n{\n    memset(first,-1,sizeof(first));\n    memset(cur,-1,sizeof(cur));\n    memset(e,-1,sizeof(e));\n    scanf(\"%d\",&n);\n    N=n*(n+1)/2;\n    S=N+n+1;T=S+1;\n    for(int i1=1;i1<=n;i1++)\n        for(int j1=1;j1<=n;j1++) {scanf(\"%d\",&b[i1][j1]);sum+=b[i1][j1];}\n    for(int i=1;i<=n;i++)\n        for(int j=i;j<=n;j++)\n        {\n            int x=(i==j)?b[i][j]:(b[i][j]+b[j][i]),yu=(i-1)*(2*n-i+2)/2+(j-i+1);\n            insert(S,yu,x);\n            insert(yu,N+i,inf);\n            if(i!=j) insert(yu,N+j,inf);\n        }\n    for(int i=1;i<=n;i++)\n    {\n        scanf(\"%d\",&x);\n        insert(N+i,T,x);\n    }\n    memset(f,0,sizeof(f));\n    memset(d,0,sizeof(d));\n    e[S]=S;f[0]=n1=N+n+2;\n    int now=S;ans=0;\n    for(int i=0;i<=n1;i++) cur[i]=first[i];\n    while(d[S]<n1)\n    {\n        int bo=false;\n        for(int i=cur[now];i!=-1;i=next[i])\n            if((d[now]==(d[to[i]]+1))&&(w[i]>0))\n            {      \n                cur[now]=i;          \n                mi=min(mi,w[i]);e[to[i]]=now;now=to[i];\n                if(now==T)\n                {\n                    ans+=mi;\n                    while(now!=S)\n                    {\t\n                        w[cur[e[now]]]-=mi;\n                        w[cur[e[now]]^1]+=mi;\n                        now=e[now];   \n                    }\n                    mi=inf;\n                }\n                bo=true;break;\n            }\n        if(bo) continue;int mmi=n1;\n        for(int i=first[now];i!=-1;i=next[i])\n            if((w[i]>0)&&(mmi>d[to[i]])) {mmi=d[to[i]];cur[now]=i;}\n        if(!(--f[d[now]])) break;\n        f[(d[now]=(mmi+1))]++;now=e[now];\n    }\n    cout<<sum-ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1527078364,
        "uid": 79044,
        "name": "\u7834\u58c1\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    },
    {
        "content": "# \u610f\u5916\u53d1\u73b0\n\u6b64\u9898\u7684\u6b63\u89e3\u5982\u5927\u4f6c\u4eec\u6240\u8bf4\u7684\u90a3\u6837\uff0c\u5e94\u8be5\u662f\u7528\u6700\u5c0f\u5272\u3002\n  \n\u4f46\u662f\u672c\u9898\u6709\u4e2a\u7279\u6b8a\u4e4b\u5904\uff1a\u5047\u8bbeA\u5168\u4e3a1\uff0c\u5219B\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u6d3e\u4e0a\u7528\u573a\u3002\u6309\u9898\u7ed9\u6837\u4f8b\uff0c\u5982\u679c\u6b64\u65f6\u6211\u4eec\u8ba9A\u7684\u7b2c3\u4e2a\uff08\u968f\u610f\u9009\u7684\uff09\u5143\u7d20\u4e3a0\uff08A[3]=0\uff09\uff0c\u5373A=[1 1 0]\u3002\u6211\u4eec\u518d\u5e26\u5165D\u516c\u5f0f\u8ba1\u7b97\u4e00\u904d\u5c31\u80fd\u53d1\u73b0\u6b64\u65f6B\u7684\u7b2c3\u884c\u548c\u7b2c3\u5217\u5143\u7d20\u5931\u6548\uff08\u5bf9\u4e8e\u7ed3\u679c\u503c\u6ca1\u6709\u8d21\u732e\uff09\uff0c\u800c\u4e14C\u7684\u7b2c3\u5217\u5143\u7d20\uff08\u7b2c3\u4e2a\u5143\u7d20\uff09\u4e5f\u5931\u6548\u3002\u76f4\u89c2\u70b9\u8bf4\uff0c\u5c31\u662f\u5212\u53bb\u4e86\u8fd9\u4e9b\u884c\u548c\u5217\u7684\u5143\u7d20\u3002  \n\u4e5f\u5c31\u662f\u8bf4A\u7684\u7b2ci\u4f4d\u662f\u5426\u4e3a1\uff0c\u8868\u793a\u662f\u5426\u542f\u7528B\u7684\u7b2ci\u884c\u548c\u7b2ci\u5217\uff0c\u4ee5\u53caC\u7684\u7b2ci\u5217\u3002\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u5224\u65ad\uff0c\u8be5\u4f4d\u5e94\u8be5\u5728\u4f55\u65f6\u542f\u7528\u5373\u53ef\u3002  \n\u540c\u6837\u7528A[3]\u4e3a\u4f8b\uff0c\u6211\u4eec\u518d\u6b21\u5e26\u5165D\u7684\u516c\u5f0f\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0cA[3]\u4ece1\u52300\u5bf9\u6700\u7ec8\u7ed3\u679c\u503c\u6d88\u9664\u7684\u589e\u76ca\u4e3aB[3][1] + B[3][2] + B[1][3] + B[2][3] + B[3][3] - C[3] = 1 + 2 + 1 + 0 + 3 - 7 = 0\u3002\u4f9d\u6b21\u5206\u6790A[1]\u3001A[2]\u4ece1\u52300\u5e26\u6765\u7684\u589e\u76ca\u6d88\u9664\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0cA[1]=0\u548cA[2]=0\u5e26\u6765\u7684\u662f\u6b63\u6570\u589e\u76ca\u6d88\u9664\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f1a\u8ba9\u7ed3\u679c\u503c\u53d8\u5c0f\uff0c\u6240\u4ee5\u8fd9\u79cd\u6d88\u9664\u4e0d\u53ef\u53d6\uff0c\u4e8e\u662fA[1]\u548cA[2]\u4fdd\u6301\u4e3a\u539f\u6765\u76841\u3002\u800cA[3]\u5e26\u6765\u7684\u589e\u76ca\u6d88\u9664\u6548\u679c\u4e3a0\uff0c\u4e5f\u5c31\u662f\u8bf4A[3]=0/1\u90fd\u53ef\u4ee5\u3002  \n\u901a\u8fc7\u4e0a\u8ff0\u5206\u6790\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5224\u65adA\u4e2d\u6bcf\u4e00\u4f4d\u4ece1\u52300\u4ea7\u751f\u7684\u6548\u679c\u662f\u5426\u6709\u76ca\u5373\u53ef\uff08\u5373\u589e\u76ca\u6d88\u9664\u6548\u679c < 0\uff09\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u53ea\u8981\u9a8c\u8bc1\u4e00\u4e0b\uff0c\u5212\u53bbB\u7684\u7b2ci\u884c\u548c\u7b2ci\u5217\uff0c\u4ee5\u53caC\u7684\u7b2ci\u5217\u662f\u5426\u4f1a\u6709\u6b63\u5411\u589e\u76ca\u5373\u53ef\u3002  \n  \nTalk is cheap. Show me the code.\n```cpp\n#pragma GCC optimize(2)\n#include<cstdio>\n#include<iostream>\n#include<vector>\n\nusing namespace std;\nconst int maxn=505;\nint num[maxn][maxn];\nint n, res;\nvector<int> a; //\u8868\u793aA\u7684\u54ea\u4e9b\u4f4d\u7f6e\u4e3a1\n\nint main()\n{\n    //freopen(\"input.in\", \"r\", stdin);\n    ios::sync_with_stdio(0);\n    cin>>n;\n    for(int i=1; i<=n+1; ++i){ //C\u653e\u5728num\u4e2d\u7684n+1\u884c\u4e86\n        for(int j=1; j<=n; ++j){\n            cin>>num[i][j];\n        }\n    }\n    for(int i=1; i<=n; ++i){\n        int row=0, col=0;\n        for(int j=1; j<=n; ++j){\n            row+=num[i][j];\n            col+=num[j][i];\n        }\n        if(col+row-num[i][i]-num[n+1][i] > 0) a.push_back(i); //\u8fd9\u91cc\u5224\u65ad\u589e\u76ca\u662f\u5426\u6709\u6548\n    }\n    //\u6709\u4e86A\u540e\uff0c\u53ea\u9700\u8981\u8fdb\u884c\u77e9\u9635\u8fd0\u7b97\u5373\u53ef\n    for(int i=0; i<a.size(); ++i){\n        for(int j=1; j<=n; ++j){\n            num[0][j]+=num[a[i]][j]; //\u7559\u4e86num\u7684\u7b2c0\u884c\u7528\u4f5c\u4e34\u65f6\u5b58\u50a8\n        }\n    }\n    for(int i=0; i<a.size(); ++i){\n        res+=num[0][a[i]]-num[n+1][a[i]];\n    }\n    printf(\"%d\", res);\n}\n\n```\n\u7b2c\u4e00\u6b21\u5199\u535a\u5ba2\uff0c\u611f\u8c22\u5927\u5bb6\u9605\u8bfb\uff01",
        "postTime": 1584431570,
        "uid": 330123,
        "name": "deovc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3973 \u3010[TJOI2015]\u7ebf\u6027\u4ee3\u6570\u3011"
    }
]