[
    {
        "content": "\u671f\u671b\u5165\u95e8\u9898\u3002\n\n\u8fd9\u9898\u975e\u5e38\u7684\u597d\uff0c\u8003\u5bdf\u4e86\u671f\u671b\u7684\u7ebf\u6027\u6027\u8d28\u548c\u9009\u624b\u7684\u63a8\u67ff\u5b50\u80fd\u529b\uff0c\u7ed9\u826f\u5fc3\u51fa\u9898\u4eba\u70b9\u8d5e\uff08~~\u7136\u800c\u6211\u6708\u8d5b\u65f6\u5e76\u6ca1\u6709\u505a\u51fa\u6765~~\n\n\u6ce8\uff1a\u671f\u671b\u7684\u7ebf\u6027\u6027\u8d28\uff1a\u5728\u672c\u9898\u4e2d\u4f53\u73b0\u4e3a\u4ece $x$ \u70b9\u5230 $y$ \u70b9\u7684\u671f\u671b\u6b65\u6570 $E_{x\\to y}=E_{x\\to x+1}+...+E_{y-1 \\to y}=\\sum\\limits_{i=x}^{y-1}E_{i\\to i+1}$\u3002\n\n\u5bf9\u4e8e\u8fd9\u7c7b\u5728\u56fe\u4e0a\u968f\u673a\u6e38\u8d70\u7684\u95ee\u9898\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u8bbe $E_{x\\to x+1}$ \u8868\u793a\u4ece $x$ \u70b9\u5230 $x+1$ \u70b9\u7684\u671f\u671b\u6b65\u6570\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f $\\sum\\limits_{x=0}^n E_{x\\to x+1}$ \u7684\u503c\u3002\n\n\u4e0d\u59a8\u5148\u6839\u636e\u671f\u671b\u7684\u5b9a\u4e49\u5217\u51fa $E_{x\\to x+1}$ \u7684\u8f6c\u79fb\u5f0f\uff08\u5176\u4e2d $du_x$ \u8868\u793a $x$ \u7684**\u8fd4\u7956\u8fb9**\u7684\u6761\u6570\uff0c\u800c $E$ \u8868\u793a $x$ \u7684**\u8fd4\u7956\u8fb9**\u7684\u8fb9\u96c6\uff09\uff1a\n\n$$\nE_{x\\to x+1}=\\frac{1}{du_x+1}\\times1+\\frac{1}{du_x+1}\\sum_{(x,y)\\in E} (E_{y\\to x+1}+1)\n$$\n\n\u5c06 $E_{y\\to x+1}=\\sum\\limits_{i=y}^{x}E_{i\\to i+1}$ \u4ee3\u5165\u4e0a\u5f0f\u5e76\u5bf9\u4e0a\u5f0f\u8fdb\u884c\u5316\u7b80\uff1a\n\n$$\nE_{x\\to x+1}=1+\\frac{1}{du_x+1}\\sum_{(x,y)\\in E}\\sum_{i=y}^xE_{i\\to i+1}\n$$\n\n\u6b64\u65f6\u8bb0 $E_{x\\to x+1}$ \u4e3a $f_x$\uff0c\u8bb0 $sum_x=\\sum\\limits_{i=0}^x f_i$\uff0c\u5219\u4e0a\u5f0f\u53ef\u5199\u4f5c\uff1a\n\n$$\nf_x=1+\\frac{1}{du_x+1}\\sum_{(x,y)\\in E}sum_x-sum_{y-1}\n$$\n\n\u53d1\u73b0\u7b49\u5f0f\u4e24\u8fb9\u90fd\u542b\u6709 $E_{x\\to x+1}$ \uff0c\u628a $E_{x\\to x+1}$ \u5168\u90e8\u63d0\u5230\u5de6\u8fb9\uff08\u4e3a\u4e86\u8ba9 $f_x$ \u80fd\u591f\u8f6c\u79fb\uff09\uff0c\u5e76\u6d88\u53bb\u548c\u5f0f\u7cfb\u6570 $\\frac{1}{du_x+1}$\uff0c\u5f97\uff1a\n\n$$\nf_x=(du_x+1)+\\sum_{(x,y)\\in E}sum_{x-1}-sum_{y-1}\n$$\n\n\u5230\u8fd9\u91cc\u7ef4\u62a4\u4e00\u4e0b\u524d\u7f00\u548c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8f6c\u79fb\u4e86\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n\u4e0a\u5f0f\u7684\u5316\u7b80\u6b65\u9aa4\u90fd\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u7684 $\\text{Dirty Work}$\uff0c\u672c\u6765\u4e0d\u60f3\u5199\u51fa\u6765\u7684\uff08\n\n**Show the Code**\n```cpp\n#include<cstdio>\n#define int ll\ntypedef long long ll;\nconst int mod=998244353;\nint cnt=0;\nint h[1000005],to[2000005],ver[2000005];\nint f[1000005],sum[1000005],du[1000005];\ninline int read() {\n\tregister int x=0,f=1;register char s=getchar();\n\twhile(s>'9'||s<'0') {if(s=='-') f=-1;s=getchar();}\n\twhile(s>='0'&&s<='9') {x=x*10+s-'0';s=getchar();}\n\treturn x*f;\n}\ninline void add(int x,int y) {to[++cnt]=y;ver[cnt]=h[x];h[x]=cnt;}\nsigned main() {\n\tint id=read(),n=read(),m=read();\n\tfor(register int i=1;i<=m;++i) {int x=read(),y=read();add(x,y);++du[x];}\n\tfor(register int x=1;x<=n;++x) {\n\t\tf[x]=du[x]+1;\n\t\tfor(register int i=h[x];i;i=ver[i]) {\n\t\t\tint y=to[i];\n\t\t\tf[x]=((f[x]+(sum[x-1]-sum[y-1])%mod)%mod+mod);\n\t\t}\n\t\tsum[x]=(sum[x-1]+f[x])%mod;\n\t}\n\tprintf(\"%lld\\n\",sum[n]); \n\treturn 0;\n}\n```",
        "postTime": 1601346153,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "# \u524d\u8a00\n\n\u8fd9\u9053\u9898\u5b9e\u9645\u4e0a\u4e0d\u9700\u8981\u590d\u6742\u7684\u6570\u5b66\u63a8\u5bfc\uff0c\u53ea\u9700\u8981\u5229\u7528\u671f\u671b\u7684\u7ebf\u6027\u6027\u5c31\u80fd\u8f7b\u677e\u63a8\u51fa\u7b54\u6848\u3002\n\n# \u5206\u6790\n\n\u8bbe $E_{x\\to y}\\left(1\\le x\\le y\\le n+1\\right)$ \u8868\u793a\u4ece $x$ \u53f7\u53f0\u9636\u5230 $y$ \u53f7\u53f0\u9636\u7684\u671f\u671b\u6b65\u6570\uff0c\u8bbe $S$ \u8868\u793a\u8fd4\u7956\u8fb9\u96c6\uff0c\u8bbe $k_x$ \u8868\u793a\u4ece $x$ \u53f7\u53f0\u9636\u51fa\u53d1\u7684\u8fd4\u7956\u8fb9\u6570\u3002\u6839\u636e\u9898\u610f\u4ee5\u53ca\u671f\u671b\u7684\u5b9a\u4e49\uff0c\u6709\n$$\nE_{x\\to x+1}=\\frac{1}{k_x+1}\\cdot1+\\frac{1}{k_x+1}\\sum_{\\left(x,y\\right)\\in S}\\left(E_{y\\to x+1}+1\\right).\n$$\n\n\u671f\u671b\u5177\u6709\u7ebf\u6027\u6027\uff0c\u4e8e\u662f\u5bf9\u4e8e\u4efb\u610f $1\\le x\\le y\\le n+1$ \u6709\n$$\nE_{1\\to x}+E_{x\\to y}=E_{1\\to y}.\n$$\n\n\u4e8c\u8005\u7ed3\u5408\uff0c\u53ef\u4ee5\u5f97\u5230\n$$\n\\begin{aligned}\nE_{x\\to x+1}&=\\frac{1}{k_x+1}\\cdot1+\\frac{1}{k_x+1}\\sum_{\\left(x,y\\right)\\in S}\\left(E_{1\\to x}+E_{x\\to  x+1}-E_{1\\to y}+1\\right)\\\\\n&=\\frac{1}{k_x+1}\\cdot1+\\frac{1}{k_x+1}\\sum_{\\left(x,y\\right)\\in S}\\left(E_{1\\to x}-E_{1\\to y}+1\\right)+\\frac{k_x}{k_x+1}E_{x\\to  x+1}.\n\\end{aligned}\n$$\n\n\u79fb\u9879\u5316\u7b80\u5f97\n\n$$\nE_{x\\to x+1}=1+\\sum_{\\left(x,y\\right)\\in S}\\left(E_{1\\to x}-E_{1\\to y}+1\\right).\n$$\n\u518d\u6b21\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\u6709\n$$\nE_{1\\to x+1}=E_{1\\to x}+1+\\sum_{\\left(x,y\\right)\\in S}\\left(E_{1\\to x}-E_{1\\to y}+1\\right).\n$$\n\u6709\u660e\u663e\u521d\u59cb\u72b6\u6001 $E_{1\\to1}=0$\uff0c\u6240\u4ee5\u76f4\u63a5\u9012\u63a8 $E_{1\\to x}$ \u5373\u53ef\uff0c\u7b54\u6848\u5373\u4e3a $E_{1\\to n+1}$\u3002\u8fd9\u4e2a\u7b97\u6cd5\u7684\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $\\mathcal O\\left(n+m\\right)$\u3002\n\n# \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include <cstdio>\n\nint read() {\n  static int ch, x;\n  while ((ch = getchar()) < 48) {}\n  x = ch ^ 48;\n  while ((ch = getchar()) >= 48) x = (((x << 2) + x) << 1) + (ch ^ 48);\n  return x;\n}\n\n#define MAXN 1000010\nconst int P = 998244353;\n\n// e[x] \u8868\u793a\u6587\u4e2d\u7684 E_{1 \\to x}\u3002\nint e[MAXN], head[MAXN], nxt[MAXN], to[MAXN];\n\nint main() {\n  read();\n  const int n = read(), m = read();\n  for (int i = 1; i <= m; ++i) {\n    const int x = read(), y = read();\n    nxt[i] = head[x];\n    to[i] = y;\n    head[x] = i;\n  }\n  int ans = 0;\n  for (int i = 1; i <= n; ++i) {\n    e[i] = ans;\n    long long d = 0;\n    // \u6ce8\u610f\u4e0d\u80fd\u76f4\u63a5\u7d2f\u52a0 ans\uff0c\u56e0\u4e3a\u53ef\u80fd\u51fa\u73b0 x = y \u7684\u60c5\u51b5\u3002\n    for (int j = head[i]; j; j = nxt[j]) d += ans - e[to[j]] + 1;\n    ans = (ans + 1 + d) % P;\n  }\n  printf(\"%d\\n\", ans + (ans >> 31 & P));\n  return 0;\n}\n\n```\n\n",
        "postTime": 1600577586,
        "uid": 55251,
        "name": "Daniel13265",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020] \u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "\u611f\u89c9\u8fd9\u9053\u9898\u597d\u50cf\u51fa\u7684\u6c34\u4e86\u70b9\uff0c\u50cf\u6211\u8fd9\u79cd\u5bf9\u671f\u671b\u4e00\u7a8d\u4e0d\u901a\u7684\u83dc\u9e21\u4e5f\u53ef\u4ee5\u63a8\u51fa\u6765\u3002\u6211\u7684\u601d\u8def\u597d\u50cf\u548c\u5927\u5bb6\u4e0d\u592a\u4e00\u6837\uff08\u66f4\u7b80\u5355\u4e00\u70b9\u5427\uff09\u2026\u2026\u4f46\u662f\u597d\u6b79\u8fc7\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u4e00\u4e0b\u3002\n\n\u6211\u4eec\u8bbe\u8981\u901a\u8fc7\u7b2c $x$ \u4e2a\u70b9\u9700\u8981\u7684\u671f\u671b\u6b65\u6570\u4e3a $E(x)$\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u5b9a\u4e49\u63a8\u51fa $E(x)$ \u7684\u8868\u8fbe\u5f0f\uff1a\n\n$$E(x)=\\dfrac{n+\\sum \\sum_{i=t_x}^{x}E(i)}{n}$$\n\n\u5728\u8fd9\u91cc\uff0c$t_x$ \u8868\u793a\u6240\u6709 $x$ \u7684\u8fd4\u7956\u70b9\u3002\u7b2c\u4e00\u4e2a\u6c42\u548c\u7b26\u53f7\u679a\u4e3e\u7684\u662f\u5b83\u7684\u6240\u6709\u8fd4\u7956\u8fb9\uff0c\u7b2c\u4e8c\u4e2a\u6c42\u548c\u662f\u8981\u6c42\u4ece $t_x$ \u8d70\u5230 $x$ \u7684\u671f\u671b\u6b65\u6570\u3002\u663e\u800c\u6613\u89c1\uff0c\u7b2c\u4e8c\u4e2a\u6c42\u548c\u53ef\u4ee5\u524d\u7f00\u548c\u4f18\u5316\u3002\n\n\u6211\u4eec\u4ee4 $S(x)=\\sum_{i=1}^{x}E(i)$\u3002\u90a3\u4e48\u539f\u5f0f\u53ef\u4ee5\u5199\u4e3a\uff1a\n\n$$E(x)=\\dfrac{n+(n-1)\\times S(x)-\\sum S(t_x-1)}{n}$$\n\n\u628a $S(x)$ \u6539\u4e3a $E(x)+S(x-1)$\uff0c\u518d\u79fb\u9879\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230 $E(x)$ \u7684\u516c\u5f0f\uff1a\n\n$$E(x)=n+(n-1)\\times S(x-1)-\\sum S(t_x-1)$$\n\n\u81f3\u6b64\u53ef\u4ee5 $O(n+m)$ \u8ba1\u7b97\u4e86\u3002\u7ef4\u62a4\u4e00\u4e0b $E$ \u548c $S$\uff0c\u4ece $1$ \u5f00\u59cb\u679a\u4e3e\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u732e\u4e0a\u4e11\u964b\u7684\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint x,y;\nlong long g[1000001],ans;\nconst long long mod=998244353;\nint h[1000001],t[1000001],nxt[1000001],cnt;\nlong long E[1000001],S[1000001];\ninline int read()\n{\n\tchar C;\n\tint F=1,ANS=0;\n\twhile (C<'0'||C>'9')\n\t{\n\t\tif (C=='-') F=-1;\n\t\tC=getchar();\n\t}\n\twhile (C>='0'&&C<='9')\n\t{\n\t\tANS=ANS*10+C-'0';\n\t\tC=getchar();\n\t}\n\treturn F*ANS;\n}\ninline void add(int x,int y)\n{\n\tt[++cnt]=y;\n\tnxt[cnt]=h[x];\n\th[x]=cnt;\n}\nint main()\n{\n\tint id,n,m;\n\tcin >> id >> n >> m;\n\tfor (int i=1;i<=m;i++) \n\t{\n\t\tint x,y;\n\t\tx=read(),y=read();\n\t\tg[x]++;\n\t\tadd(x,y);\n\t}\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tE[i]=(g[i]+1+g[i]*(S[i-1]))%mod;\n\t\tlong long res=0;\n\t\tfor (int j=h[i];j;j=nxt[j]) \n\t\t{\n\t\t\tres=(res+S[t[j]-1])%mod;\n\t\t}\n\t\tE[i]-=res;\n\t\tE[i]=(E[i]+mod)%mod;\n\t\tS[i]=(S[i-1]+E[i])%mod;\n\t}\n\tcout << S[n];\n\treturn 0;\n}\n```\n",
        "postTime": 1600609883,
        "uid": 151475,
        "name": "Little09",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6835 [Cnoi2020]\u7ebf\u5f62\u751f\u7269"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u6709 `N+1` \u4e2a\u70b9\uff0c\u4ece `i` \u6307\u5411 `i+1` \u5f62\u6210\u4e00\u4e2a\u94fe\uff0c\u5176\u4e2d\u8fd8\u6709\u4e00\u4e9b\u8fd4\u7956\u8fb9\u3002\n\n\u4e00\u4e2a\u751f\u7269\u5728 `1` \u53f7\u70b9\uff0c\u6bcf\u6b21\u5c06\u968f\u673a\u9009\u62e9\u4e00\u6761\u8fb9\u901a\u8fc7\uff0c\u6c42\u51fa\u8d70\u5230 `N+1` \u7684\u6b65\u6570\u671f\u671b\u3002\n\n## \u5206\u6790\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0yk8iqz5.png)\u795e\u5947\u505a\u6cd5\u6ce8\u610f\uff01\n\n\u5148\u63a8\u5f0f\u5b50\u3002\u5047\u8bbe $f_x$ \u8868\u793a `x` \u8d70\u5230 `N+1`\u7684\u671f\u671b\u6b65\u6570\u3002\n\n$$f_x=\\dfrac{\\sum\\limits_{(x,u)\\in E}f_u+1}{\\sum\\limits_{(x,u)\\in E}1}=\\dfrac{\\sum\\limits_{(x,u)\\in E}f_u}{\\operatorname{outDegree}(x)}+1$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u7684\u5206\u5b50\u4e2d\u53ea\u6709 `x+1` \u4e00\u4e2a\u6570\u5927\u4e8e `x`\uff0c\u53ef\u4ee5\u4ee3\u5165 $f_{x+1}$ \u7684\u8868\u8fbe\u5f0f\u7b97 $f_x$\u3002\n\n$$f_x=\\dfrac{\\sum\\limits_{(x,u)\\in E}f_u}{\\operatorname{outDegree}(x)}+1=\\dfrac{f_{x+1}}{\\operatorname{outDegree}(x)}+\\dfrac{\\sum\\limits_{(x,u)\\in E \\operatorname{and} u \\leq x}f_u}{\\operatorname{outDegree}(x)}+1$$\n\n\u90a3\u5c31\u53ef\u4ee5\u628a $f_{x+1}$ \u7684\u8868\u8fbe\u5f0f\u5199\u6210\u4e00\u4e2a\u6570\u7ec4 `g`\uff0c\u6ee1\u8db3$f_{x+1}=g_{const}+\\sum f_i \\times g_i$\uff0c\u7136\u540e\u6bcf\u6b21\u628a\u8fd9\u4e2a\u6570\u7ec4\u9664\u4e0a $\\operatorname{outDegree}(x)$\uff0c\u7136\u540e\u628a\u8fd4\u7956\u8fb9\u5bf9\u5e94\u4f4d\u7f6e\u52a0\u4e0a $\\dfrac{1}{\\operatorname{outDegree}(x)}$\uff0c\u7136\u540e\u5e38\u6570\u9879\u52a0\u4e0a 1\u3002\u4f46\u662f\u7b97\u5b8c\u4e4b\u540e\u8981\u628a\u503c\u7b97\u51fa\u6765\u4e86\uff0c\u90a3\u5c31\u53ea\u80fd\u7b97\u7684\u65f6\u5019\u6d88\u5143\u4e86\u3002\n\n$f_{x+1}=g_{const}+\\sum f_i \\times g_i=g_{const}+\\sum\\limits_{i \\in [1,x]}f_i \\times g*i+f_{i+1}*g_{i+1}$\n\n$(1-g_{x+1})f_{x+1}=g_{const}+\\sum\\limits_{i \\in [1,x]}f_i \\times g_i$\n\n$f_{x+1}=\\dfrac{g_{const}+\\sum\\limits_{i \\in [1,x]}f_i \\times g_i}{1-g_{x+1}}$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u628a\u5f53\u524d\u70b9\u7684\u7cfb\u6570\u6d88\u6389\u4e86\uff01\n\n\u4f46\u662f\u8fd9\u4e48\u7b97\u8d85\u65f6\u662f\u65e0\u6cd5\u907f\u514d\u7684\uff0c\u90a3\u600e\u4e48\u529e\u5462\uff1f\n\n\u60f3\u5230\u8d85\u65f6\u7684\u771f\u6b63\u539f\u56e0\u662f\u533a\u95f4\u9664\u7684\u65f6\u5019\u4f7f\u7528\u66b4\u529b\u65b9\u6cd5\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u4e8e `tag` \u7684\u601d\u60f3\u3002\u5bf9\u4e8e\u4e00\u4e2a\u6570\u7ec4 `s` \uff0c\u53ef\u4ee5\u5c06\u4fee\u6539\u53d8\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a\n\n```\ntag=1;\ndivideBy(a) -> tag*=a;\naddNumber(a,x) -> s[a]+=x*tag;\ngetValue(a) -> return a/tag;\n```\n\n\u7136\u540e\u8fd9\u9053\u9898\u5c31\u53ef\u4ee5\u5728 $O(n+m)$ \u7684\u590d\u6742\u5ea6\u5185\u4f5c\u5b8c\uff0c\u5c31\u662f\u7b97\u9006\u5143\u5e38\u6570\u6709\u70b9\u5927\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <cmath>\n#include <vector>\nusing namespace std;\ninline int read(){\n\tregister int ret=0;\n    char ch=getchar();\n    while(ch<'0') ch=getchar();\n    while(ch>='0') ret=(ret<<3)+(ret<<1)+ch-'0',ch=getchar();\n    return ret;\n}\nvector<int> To[1000010];\nconst long long Md=998244353;\nint N,M;\ninline long long ksm(int x,int y){\n\tregister long long ret=1,bas=x;\n\twhile(y){\n\t\tif(y&1)\t(ret*=bas)%=Md;\n\t\t(bas*=bas)%=Md;y>>=1;\n\t}\n\treturn ret;\n}\nlong long SZ[1000010],MUL=1,DIV=1;\ninline void add(int x,long long a){\n\t(SZ[x]+=a*DIV%Md)%=Md;\n}\nint main(){\n\tread();N=read();M=read();\n\tfor(int i=1,u,v;i<=M;i++){\n\t\tu=read();v=read();\n\t\tTo[u].push_back(v);\n\t}\n\tSZ[0]=0;\n\tregister long long L,P,Q;\n\tfor(int i=N;i;i--){\n\t\tL=To[i].size()+1;\n\t\tP=ksm(L,Md-2);\n\t\t(MUL*=P)%=Md;(DIV*=L)%=Md;\n\t\tfor(int j=0;j<To[i].size();j++)\n\t\t\tadd(To[i][j],P);\n\t\tadd(0,1);\n\t\tQ=(1+Md-SZ[i]*MUL%Md)%Md;\n\t\t(MUL*=ksm(Q,Md-2))%=Md;(DIV*=Q)%=Md;\n\t\tSZ[i]=0;\n\t}\n\tprintf(\"%lld\",(SZ[0]*MUL)%Md);\n}\n```",
        "postTime": 1601196432,
        "uid": 60864,
        "name": "tiger2005",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "~~\u8981\u662f\u77e5\u9053\u8fd9\u9898\u8fd9\u4e48\u597d\u505a\u6253\u6708\u8d5b\u7684\u65f6\u5019\u6211\u5c31\u4e0d\u770b\u5230\u671f\u671b\u5c31\u81ea\u52a8\u56de\u9000\u4e86~~\n\n\n------------\n\u86ee\u597d\u7684\u671f\u671b\u5165\u95e8\u9898\uff0c\u81f3\u5c11\u6211\u8fd9\u4e2a\u4e00\u9053\u671f\u671b\u9898\u90fd\u6ca1\u505a\u8fc7\u7684\u849f\u84bb\u90fd\u80fd10min\u63a8\u51fa\u5f0f\u5b50\uff08\u3002\n\n\u6700\u539f\u59cb\u76f4\u63a5\u7684\u60f3\u6cd5\u662f\u4ee4 $f_{i,j}$ \u8868\u793a\u4ece\u70b9 $i$ \u8d70\u5230\u70b9 $i+j$ \u6240\u7528\u7684\u671f\u671b\u6b65\u6570\u3002\u90a3\u4e48\u5982\u679c\u6211\u4eec\u901a\u8fc7\u4e00\u6761\u8fd4\u7956\u8fb9\u7531\u70b9 $i$ \u56de\u5230\u4e86\u70b9 $w$\uff0c\u5b83\u5bf9\u4e8e$f_{i,j}$\u7684\u8d21\u732e\u5c31\u662f $\\frac{1+f_{w,i-w}+f_{i,j}}{k+1}$ \uff08 $k$ \u4e3a\u8fd4\u7956\u8fb9\u7684\u6761\u6570\uff09\uff0c\u76f4\u63a5\u6839\u636e\u671f\u671b\u7684\u5b9a\u4e49\u6c42\u548c\u5373\u53ef\u8f6c\u79fb\u3002\n\n\u4f46\u662f\u5f88\u663e\u7136\u8fd9\u6837\u5199\u6211\u4eec\u7684\u65f6\u7a7a\u590d\u6742\u5ea6\u4f1a\u7206\u70b8\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u7528\u5230\u671f\u671b\u7684\u7ebf\u6027\u6027\u6765\u4f18\u5316\u3002\n\n\u4f55\u4e3a\u671f\u671b\u7684\u7ebf\u6027\u6027\uff1f\u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f\u628a\u4e00\u4e2a\u4e8b\u4ef6\u62c6\u6210\u82e5\u5e72\u4e2a\u5b50\u4e8b\u4ef6\u4e4b\u540e\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u7684\u671f\u671b\u4e0e\u8fd9\u4e9b\u5b50\u4e8b\u4ef6\u7684\u671f\u671b\u4e4b\u548c\u662f\u76f8\u540c\u7684\u3002\u653e\u5230\u8fd9\u9898\u4e2d\uff0c\u4ece\u70b9 $i$ \u8d70\u5230\u70b9 $i+j$ \u53ef\u4ee5\u62c6\u5206\u4e3a\u4ece\u70b9 $i$ \u8d70\u5230\u70b9 $i+1$\u3001\u4ece\u70b9 $i+1$ \u8d70\u5230\u70b9 $i+2$\u3001\u2026\u2026\u3001\u4ece\u70b9 $i+j-1$ \u8d70\u5230\u70b9 $i+j$\uff0c\u56e0\u6b64\u4ece\u70b9 $i$ \u8d70\u5230\u70b9 $i+j$ \u6240\u7528\u7684\u671f\u671b\u6b65\u6570\u5c31\u7b49\u4e8e\u4ece\u70b9 $i$ \u8d70\u5230\u70b9 $i+1$\u7684\u671f\u671b\u6b65\u6570+\u4ece\u70b9 $i+1$ \u8d70\u5230\u70b9 $i+2$\u7684\u671f\u671b\u6b65\u6570+\u2026\u2026+\u4ece\u70b9 $i+j-1$ \u8d70\u5230\u70b9 $i+j$ \u7684\u671f\u671b\u6b65\u6570\u3002\u4e5f\u5c31\u662f $f_{i,j}=\\sum_{k=i}^{i+j-1}f_{k,1}$\u3002\n\n\u56e0\u6b64\uff0c\u5bf9\u4e8e\u4efb\u4f55\u7684 $f_{i,j}(j>1)$\uff0c\u90fd\u80fd\u7528 $f_{x,1}$ \u8868\u793a\uff0c\u539f\u5148\u72b6\u6001\u7684\u7b2c\u4e8c\u7ef4\u5c31\u6ca1\u6709\u4efb\u4f55\u7528\u5904\u4e86\u3002\u4fee\u6539\u4e00\u4e0b\u72b6\u6001\u5b9a\u4e49\uff1a\u4ee4 $f_{i}$ \u8868\u793a\u4ece\u70b9 $i$ \u8d70\u5411\u70b9 $i+1$ \u6240\u7528\u7684\u671f\u671b\u6b65\u6570\u3002\u8f6c\u79fb\u65b9\u7a0b\u5c31\u662f  $f_{i}=\\frac{(\\sum_{j=1}^{k}\\sum_{l=w_{j}}^{i-1}f(l))+k+1+k\\times f_{i}}{k+1}$\uff0c\u5176\u4e2d $k$ \u4e3a\u70b9 $i$ \u7684\u8fd4\u7956\u8fb9\u7684\u6570\u91cf\uff0c$w$ \u4e3a\u70b9 $i$ \u7684\u8fd4\u7956\u8fb9\u7684\u7ec8\u70b9\u7684\u96c6\u5408\u3002\n\n\u628a\u5206\u5b50\u4e2d\u62ec\u53f7\u62ec\u8d77\u6765\u7684\u90a3\u4e00\u5768\u4e1c\u897f\u62ff\u524d\u7f00\u548c\u4f18\u5316\u4e00\u4e0b\uff0c\u4ee4 $S_{i}=\\sum_{j=1}^{i}f_{j}$\uff0c\u5219 $f_{i}=\\frac{(\\sum_{j=1}^{k}S_{i-1}-S_{w_{j}-1})+k+1+k\\times f_{i}}{k+1}$\n\n\u4ee4$a=\\sum_{j=1}^{k}S_{i-1}-S_{w_{j}-1}$\u5316\u7b80\u4e00\u4e0b\uff0c\u5f97 $f_{i}=a+k+1$\u3002\u975e\u5e38\u7b80\u6d01\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n+m)$\n\n\uff08~~\u4e0d\u4f1a\u6709\u4eba\u53ea\u770b\u8fd9\u4e2a\u5f0f\u5b50\u5427\uff0c\u4e0d\u4f1a\u5427\u4e0d\u4f1a\u5427~~\uff09\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\n#define ll long long\n#define fo(i,x,y) for(register int i=x;i<=y;++i)\n#define go(i,x,y) for(register int i=x;i>=y;--i)\nusing namespace std;\ninline int read(){ int x=0,fh=1; char ch=getchar(); while(!isdigit(ch)){ if(ch=='-') fh=-1; ch=getchar(); } while(isdigit(ch)){ x=(x<<1)+(x<<3)+ch-'0'; ch=getchar(); } return x*fh; }\n\nconst int maxn=1e6+5,yrz=998244353;\nint f[maxn],S[maxn];\nvector<int> w[maxn];\n\nint main(){\n\tint id=read(),n=read(),m=read();\n\tfo(i,1,m){\n\t\tint x=read(),y=read();\n\t\tw[x].push_back(y);//\u8bb0\u5f55\u8fd4\u7956\u8fb9 \n\t}\n\tfo(i,1,n){\n\t\tint k=w[i].size(),a=0;//k,a\u610f\u4e49\u4e0e\u6587\u4e2d\u76f8\u540c \n\t\tfo(j,0,k-1) a+=(S[i-1]+yrz-S[w[i][j]-1])%yrz,a%=yrz;\n\t\tf[i]=a+k+1;//\u8f6c\u79fb \n\t\tf[i]%=yrz;\n\t\tS[i]=(S[i-1]+f[i])%yrz;\n\t}\n\tcout<<S[n];\n\treturn 0;\n}\n```\n",
        "postTime": 1601909673,
        "uid": 238408,
        "name": "vectorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "[Link](https://www.luogu.com.cn/problem/P6835)\n\n-----------------\n\n### \u9898\u76ee\u63cf\u8ff0\n\n\u6709 $n$ \u4e2a\u70b9\uff0c\u6700\u5f00\u59cb\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $i \\in [1,n]$ \u90fd\u6709\u4e00\u6761\u8fde\u5411 $i+1$ \u7684\u6709\u5411\u8fb9\u3002\n\n\u73b0\u5728\u6709\u989d\u5916\u7684 $m$ \u6761\u8fb9 $u\\to v$\uff0c\u6709 $v \\leq u$ \u3002\n\n\u6c42\u4ece $1$ \u53f7\u8282\u70b9\u5f00\u59cb\uff0c\u8d70\u5230 $n+1$ \u53f7\u8282\u70b9\u7684\u671f\u671b\u6b65\u6570\u3002\n\n### \u89e3\u6cd5\n\n\u5bb9\u6613\u60f3\u5230\u7528 $f_i$ \u8868\u793a\u4ece $i$ \u53f7\u8282\u70b9\u8d70\u5230 $i+1$ \u53f7\u8282\u70b9\u7684\u671f\u671b\u6b65\u6570\uff0c\u7528 $d_i$ \u8868\u793a\u70b9 $i$ \u7684\u51fa\u5ea6\u3002\n\n\u90a3\u4e48\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. \u76f4\u63a5\u4ece $i$ \u53f7\u8282\u70b9\u8d70\u5230 $i+1$ \u53f7\u8282\u70b9\n\n$$E_1=\\frac{1}{d_i}\\times 1=\\frac{1}{d_i}$$\n\n2. \u4ece $i$ \u53f7\u8282\u70b9\u8d70\u5230\u524d\u9762\u7684\u67d0\u4e2a\u70b9\uff0c\u7136\u540e\u518d\u8d70\u56de\u6765\n\n$$E_2=\\frac{1}{d_i}\\times\\sum_{v\\in son(i)} (1+\\sum_{j=v}^{u} f_i)$$\n\n\u5219\n\n$$f_i=E_1+E_2=1+\\frac{1}{d_i}\\times\\sum_{v\\in son(i)} \\sum_{j=v}^{u} f_i$$\n\n\u540e\u9762\u90e8\u5206\u663e\u7136\u53ef\u4ee5\u524d\u7f00\u548c\u505a\u5dee\u5904\u7406\n\n\u4ee4 $s_n=\\sum_{i=1}^{n} f_i$\n\n\u6240\u4ee5\n\n$$f_i=1+\\frac{1}{d_i}\\times\\sum_{v\\in son(i)}(s_{i}-s_{v-1})=1+\\frac{1}{d_i}\\times\\sum_{v\\in son(i)}(f_i+s_{i-1}-s_{v-1})$$\n\n\u8003\u8651\u628a $f_i$ \u79fb\u5230\u4e00\u8fb9\n\n$$f_i=1+\\frac{d_i-1}{d_i}\\times f_i+\\frac{1}{d_i}\\times\\sum_{v\\in son(i)}(s_{i-1}-s_{v-1})$$\n\n$$\\frac{1}{d_i}\\times f_i=1+\\frac{1}{d_i}\\times\\sum_{v\\in son(i)}(s_{i-1}-s_{v-1})$$\n\n$$f_i=d_i+\\sum_{v\\in son(i)}(s_{i-1}-s_{v-1})$$\n\n\u53ef\u4ee5\u7ebf\u6027\u5904\u7406\u4e86\uff0c\u6700\u7ec8\u7b54\u6848\u662f $s_n$\n\n```cpp\n\n#include<stdio.h>\n#define Mod 998244353\n#define N 1000007\n\ninline int read(){\n\tint x=0,flag=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')flag=0;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-48;c=getchar();}\n\treturn flag? x:-x;\n}\n\nstruct E{\n\tint next,to;\n}e[N];\nint head[N],cnt,s[N],f[N];\n\ninline void add(int id,int to){\n\te[++cnt]=(E){head[id],to};\n\thead[id]=cnt;\n}\n\nint id,n,m;\nint main(){\n\tid=read(),n=read(),m=read();\n\tfor(int i=1;i<=m;i++){\n\t\tint u=read(),v=read();\n\t\tadd(u,v);\n\t}\n\tf[0]=0,s[0]=0;\n\tfor(int i=1;i<=n;i++){\n\t\tf[i]=1;\n\t\tfor(int j=head[i];j;j=e[j].next){\n\t\t\tint k=e[j].to;\n\t\t\tf[i]=((f[i]+s[i-1]-s[k-1]+1)%Mod+Mod)%Mod;\n\t\t}\n\t\ts[i]=(s[i-1]+f[i])%Mod;\n\t//\tprintf(\"%d %d\\n\",f[i],s[i]);\n\t}\n\tprintf(\"%d\",s[n]);\n}\n\n```",
        "postTime": 1601090045,
        "uid": 83337,
        "name": "wwlw",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "# \u6d1b\u8c37 P6835 \u9898\u89e3\n\n\u679c\u7136\u72b6\u6001\u5bf9\u4e86 DP \u5c31\u5bf9\u4e00\u534a\u554a\uff01\n\n## \u9898\u76ee\u5206\u6790\n\n\u671f\u671bDP\uff0c\u8bbe $f_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u70b9\u5230\u7b2c $i+1$ \u4e2a\u70b9\u7684\u671f\u671b\u6b65\u6570\u3002\n\n\u5982\u679c\u67d0\u4e2a\u70b9\u5982\u679c\u8fd4\u7956\u7684\u8bdd\uff0c\u5c31\u8981\u518d\u8d70\u4e00\u904d\u7956\u5148\u5230\u8fd9\u4e2a\u70b9\u7684\u8def\uff0c\u5916\u52a0\u8fd4\u7956\u8fb9\u7684\u8d21\u732e\uff0c\u5373 $1+\\sum_{i=v}^{u}f[i]$\uff0c\u6c42\u548c\u7684\u90e8\u5206\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u4f18\u5316\u3002\u8bbe $g_i=\\sum_{j=1}^{i}f[i]$\u3002\n\n\u6700\u540e\u8fd8\u8981\u52a0\u4e0a\u76f4\u63a5\u5f80\u540e\u8d70\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u65b9\u7a0b\u5c31\u4e3a\uff1a\n\n$$f_i=\\frac{\\sum_{i\\rightarrow v}(g_i-g_{v-1}+1)+1}{out_i+1}$$\n\n$$(out_i+1)\\times f_i=out_i\\times g_i-\\sum_{i\\rightarrow v}g_{v-1}+out_i+1$$\n\n$$\\texttt{\u53c8\u56e0\u4e3a}g_i=g_{i-1}+f_i,\\texttt{\u6240\u4ee5},$$\n\n$$(out_i+1)\\times f_i=out_i\\times g_{i-1}+out_i\\times f_i-\\sum_{i\\rightarrow v}g_{v-1}+out_i+1$$\n\n$$f_i=out_i\\times g_{i-1}-\\sum_{i\\rightarrow v}g_{v-1}+out_i+1$$\n\n\u5f0f\u5b50\u53ef\u7ec8\u4e8e\u63a8\u5b8c\u4e86~~\u53ef\u6015\u7684 LaTeX \u53ef\u7ec8\u4e8e\u5199\u5b8c\u4e86~~\n\n\u4f1a\u679a\u4e3e\u4e00\u904d\u70b9\u548c\u8fb9\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n+m)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<cstdio>\nusing namespace std;\nconst int mod=998244353;\nstruct edge\n{\n\tint to,next;\n}g[1000001];\nint cnt,head[1000001];\nlong long dp[1000001],sum[1000001];\nvoid add(int u,int v)\n{\n\tg[++cnt]=(edge){v,head[u]};\n\thead[u]=cnt;\n}\nint main()\n{\n\tint n,m;\n\tscanf(\"%*d%d%d\",&n,&m);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tdp[i]=1;\n\t\tfor(int j=head[i];j;j=g[j].next)\n\t\t{\n\t\t\tint v=g[j].to;\n\t\t\tdp[i]=(dp[i]+sum[i-1]-sum[v-1]+1+mod)%mod;\n\t\t}\n\t\tsum[i]=(sum[i-1]+dp[i])%mod;\n\t}\n\tprintf(\"%lld\",sum[n]);\n    return 0;\n}\n```\n\n\u8c22\u8c22\u89c2\u770b\uff01",
        "postTime": 1600861102,
        "uid": 241520,
        "name": "fanglong",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "### [\u9898\u76ee](https://www.luogu.com.cn/problem/P6835)\u63cf\u8ff0\n\n\u7ebf\u5f62\u751f\u7269\u8981\u4ece $1$ \u53f7\u53f0\u9636\u8d70\u5230 $n+1$ \u53f7\u53f0\u9636\u3002\u6700\u5f00\u59cb\uff0c$1,2,3,...,n$ \u53f7\u53f0\u9636\u90fd\u6709\u4e00\u6761\u8fde\u5411\u4e0b\u4e00\u53f0\u9636\u7684\u6709\u5411\u8fb9 $i\u2192i+1$\uff0c\u4e4b\u540e\u52a0\u5165 $m$ \u6761\u300c\u8fd4\u7956\u8fb9\u300d$u_i\u2192v_i(u_i\u2265v_i)$\uff0c\u6784\u6210\u4e00\u4e2a\u8fd4\u7956\u56fe\u3002\u7ebf\u5f62\u751f\u7269\u6bcf\u6b65\u4f1a\u7b49\u6982\u7387\u5730\u9009\u53d6\u5f53\u524d\u53f0\u9636\u7684\u4e00\u6761\u51fa\u8fb9\u5e76\u8d70\u5411\u5bf9\u5e94\u7684\u53f0\u9636\uff0c\u8d70\u5230 $n+1$ \u53f7\u53f0\u9636\u4fbf\u4f1a\u505c\u6b62\u884c\u8d70\u3002\u6c42\u7ebf\u6027\u751f\u7269\u603b\u5171\u8d70\u7684\u6b65\u6570\u7684\u6570\u5b66\u671f\u671b\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n### \u601d\u8def\u4eec\n\n#### \u601d\u8def\u4e00\n\n\u8bbe $f_i$ \u4e3a\u4ece $i$ \u53f7\u53f0\u9636\u8d70\u5230 $i+1$ \u53f7\u53f0\u9636\u7684\u671f\u671b\u6b65\u6570\uff0c\u5f53\u8d70\u5230 $i$ \u53f7\u53f0\u9636\u65f6\uff0c\u5047\u8bbe\u5b83\u6709 $k_i$ \u6761\u51fa\u8fb9\uff0c\u90a3\u4e48\u4fbf\u6709 $\\frac{1}{k_i}$ \u7684\u6982\u7387\u8d70\u5411\u4e0b\u4e00\u4e2a\u53f0\u9636\uff0c\u6709 $\\frac{k_i-1}{k}$ \u7684\u6982\u7387\u8d70\u8fd4\u7956\u8fb9\u56de\u5230\u524d\u9762\u7684\u53f0\u9636\u3002\u524d\u8005\u9700\u8981\u7684\u6b65\u6570\u4ee3\u4ef7\u4e3a $1$\uff0c\u540e\u8005\u9700\u8981\u7684\u6b65\u6570\u4ee3\u4ef7\u662f\u8d70\u8fd4\u7956\u8fb9\u540e\u5230\u4e0b\u4e00\u4e2a\u53f0\u9636\u7684\u671f\u671b\u6b65\u6570\u3002\u8bb0 $sum$ \u4e3a\u8d70\u6bcf\u4e00\u6761\u8fd4\u7956\u8fb9\u56de\u5230 $i$ \u70b9\u7684\u671f\u671b\u6b65\u6570\u603b\u548c\uff0c\u5177\u4f53\u6765\u8bb2\uff0c\u8bb0 $E$ \u4e3a $i$ \u53f7\u53f0\u9636\u7684\u8fd4\u7956\u8fb9\u96c6\uff0c\u6709 $sum=\\sum_{e(i,j)\\in E} (\\sum_{j}^{i-1}f_j+1)$\uff0c\u52a0\u4e00\u662f\u56e0\u4e3a\u8fd4\u7956\u8fb9\u672c\u8eab\u9700\u8981\u4e00\u6b65\u3002\u4e00\u5171\u6709 $k_i-1$ \u6761\u8fd4\u7956\u8fb9\uff0c\u6bcf\u6761\u8fb9\u8d70\u7684\u6982\u7387\u5747\u7b49\uff0c\u8d70\u4e00\u6b21\u8fd4\u7956\u8fb9\u56de\u5230 $i$ \u7684\u671f\u671b\u6b65\u6570\u5c31\u662f $\\frac{sum}{k_i-1}$\u3002\u4f46\u662f\u73b0\u5728\u53ea\u56de\u5230\u4e86 $i$ \uff0c\u8981\u60f3\u8d70\u5230\u4e0b\u4e00\u4e2a\u53f0\u9636\uff0c\u8fd8\u9700\u8981\u52a0\u4e0a\u4ece $i$ \u8d70\u5230\u4e0b\u4e00\u4e2a\u53f0\u9636\u7684\u671f\u671b\u6b65\u6570\uff0c\u4e5f\u5c31\u662f $f_i$\u3002\u5bf9\u521a\u624d\u63a8\u51fa\u7684\u5f0f\u5b50\u8fdb\u884c\u5316\u7b80\uff1a\n$$\n\\begin{aligned}\n\nf_i&=\\frac{1}{k}\u00b71+\\frac{k-1}{k}(\\frac{sum}{k-1}+f_i) \\\\\n\nk\\ f_i&=1+sum+(k-1)f_i \\\\\n\nf_i&=sum+1\n\n\\end{aligned}\n$$\n\u8fd9\u91cc\u7684 $sum$ \u53ef\u4ee5\u4f7f\u7528\u524d\u7f00\u548c\u7ef4\u62a4\n\n#### \u601d\u8def\u4e8c\n\n\u9996\u5148\u6211\u4eec\u9700\u8981\u77e5\u9053\u4e00\u4e2a\u7ed3\u8bba\uff1a$\\sum_{i=1}^{\\infty}p(1-p)^{i-1}\u00b7i=\\frac{1}{p}$ \uff08\u5f53\u7136\u5982\u679c\u60a8\u53ef\u4ee5\u73b0\u63a8\u5c31\u4e0d\u8bf4\u4e86\uff09\n\n\u4ecd\u7136\u8bbe $f_i$ \u4e3a\u4ece $i$ \u53f7\u53f0\u9636\u8d70\u5230 $i+1$ \u53f7\u53f0\u9636\u7684\u671f\u671b\u6b65\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u671f\u671b\u5212\u5206\u6210\uff1a\u6ca1\u6709\u8d70\u8fc7\u8fd4\u7956\u8fb9\u7684\u671f\u671b\uff0c\u8d70\u4e86\u4e00\u6b21\u8fd4\u7956\u8fb9\u7684\u671f\u671b\uff0c\u8d70\u4e86\u4e24\u6b21\u8fd4\u7956\u8fb9\u7684\u671f\u671b\u2026\u2026 \u5047\u8bbe $i$ \u53f7\u53f0\u9636\u6709 $k_i$ \u6761\u51fa\u8fb9\uff0c\u8d70\u4e00\u6b21\u8fd4\u7956\u8fb9\u56de\u5230 $i$ \u7684\u671f\u671b\u6b65\u6570\u5c31\u662f $\\frac{sum}{k_i-1}$\uff08\u4e0a\u9762\u8bf4\u4e86\uff09\uff0c\u8d70 $t$ \u6b21\u8fd4\u7956\u8fb9\u7684\u671f\u671b\u6b65\u6570\u5c31\u662f $t\u00b7\\frac{sum}{k_i-1}$\u3002\u90a3\u4e48\u6709\uff1a\n\n$$\n\\begin{aligned}\nf_i&=1+\\sum_{t=0}^{\\infty}\\frac{1}{k}(1-\\frac{1}{k})^{t}\u00b7t\u00b7\\frac{sum}{k-1} \\\\\n\t &=1+\\sum_{t=1}^{\\infty}\\frac{1}{k}(1-\\frac{1}{k})^{t}\u00b7t\u00b7\\frac{sum}{k-1} \\\\\n\t &=1+(1-\\frac{1}{k})\\sum_{t=1}^{\\infty}\\frac{1}{k}\u00b7(1-\\frac{1}{k})^{t-1}\u00b7t\u00b7\\frac{sum}{k-1} \\\\\n\t &=1+(1-\\frac{1}{k})\u00b7k\u00b7\\frac{sum}{k-1} \\\\\n\t &=1+sum\n\\end{aligned}\n$$\n\n### Code\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cmath>\n#include<climits>\n#include<algorithm>\n#include<vector>\n#define int long long\nusing namespace std;\nconst int MaxN = 1000006, Mod = 998244353;\nint degree[MaxN], f[MaxN], sum[MaxN]; // \u6ce8\u610f\u8fd9\u91cc\u7684sum\u548c\u4e0a\u9762\u6240\u8bf4\u7684sum\u610f\u4e49\u4e0d\u540c\nvector<int> to[MaxN];\n\ninline int Read(){\n\tint num = 0, op = 1;\n\tchar ch = getchar();\n\twhile(!isdigit(ch)){\n\t\tif(ch == '-') op = -1;\n\t\tch = getchar();\n\t}\n\twhile(isdigit(ch)){\n\t\tnum = num * 10 + ch - '0';\n\t\tch = getchar();\n\t}\n\treturn num * op;\n}\n\ninline int Get(int x){\n\tint ans = 0;\n\tfor(int i=0; i<to[x].size(); i++){\n\t\tif(to[x][i] == x) ans = (ans + 1) % Mod;\n\t\telse ans = (ans + sum[x-1] - sum[to[x][i]-1] + 1 + Mod) % Mod;\n\t}\n\treturn ans;\n}\n\nsigned main(){\n\tint id = Read(), n = Read(), m = Read();\n\tfor(int i=1; i<=m; i++){\n\t\tint u = Read(), v = Read();\n\t\tdegree[u]++;\n\t\tto[u].push_back(v);\n\t}\n\tfor(int i=1; i<=n; i++){\n\t\tf[i] = (Get(i) + 1) % Mod;\n\t\tsum[i] = (sum[i-1] + f[i]) % Mod;\n\t}\n\tprintf(\"%lld\", sum[n]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1600567766,
        "uid": 235832,
        "name": "potatoler",
        "ccfLevel": 4,
        "title": "P6835 \u7ebf\u5f62\u751f\u7269"
    },
    {
        "content": "\u840c\u65b0\u7b2c\u4e00\u6b21\u505a\u671f\u671b\u9898\uff0c\u4e5f\u662f\u7b2c\u4e00\u6b21\u81ea\u5df1\u63a8\u5f0f\u5b50\uff0c\u4e0d\u77e5\u9053\u54ea\u4e9b\u53ef\u4ee5\u7701\u7565\uff0c\u5199\u5f97\u6709\u70b9\u7e41\u7410\u8bf7\u5927\u5bb6\u5305\u542b ~\n\n\u660e\u786e\u4e00\u70b9\uff0c$E_{x\\to y}+E_{y\\to z}=E_{x\\to z}$\uff0c\u611f\u6027\u7406\u89e3\u5373\u53ef\uff0c\u8981\u7ecf\u5e38\u7528\u5230\u3002\n\n\u5bf9\u4e8e\u70b9 $x$\uff0c\u8bbe\u6709 $d_x$ \u6761\u8fd4\u7956\u8fb9\uff0c\u8fd4\u7956\u8fb9\u96c6\u8bbe\u4e3a $S$\u3002\n\n\u5219\u5b83\u6709 $\\dfrac 1{d_x+1}$ \u7684\u6982\u7387\u76f4\u63a5\u5230\u8fbe $x+1$\uff0c\u6709 $\\dfrac {d_x}{d_x+1}$ \u7684\u6982\u7387\u8fd4\u7956\u3002\n\n\u53ef\u4ee5\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$E_{x\\to x+1}=\\dfrac 1{d_x+1}\\times 1+\\dfrac 1{d_x+1}\\sum_{x,y\\in S}(1+E_{y\\to x+1})$$\n\n\u73b0\u5728\u5c31\u6765\u9893\u8fd9\u4e2a\u5f0f\u5b50\u5427\uff01\n\n$$E_{x\\to x+1}=\\dfrac 1{d_x+1}\\times 1+\\dfrac 1{d_x+1}\\sum_{x,y\\in S}(1+E_{y\\to x+1})$$\n\n$$E_{x\\to x+1}=1+\\dfrac 1{d_x+1}\\sum_{x,y\\in S}E_{y\\to x+1}$$\n\n$$E_{x\\to x+1}=1+\\dfrac 1{d_x+1}\\sum_{x,y\\in S}(E_{1\\to x}+E_{x\\to x+1}-E_{1\\to y})$$\n\n$$(d_x+1)E_{x\\to x+1}=d_x+1+\\sum_{x,y\\in S}(E_{1\\to x}+E_{x\\to x+1}-E_{1\\to y})$$\n\n$$(d_x+1)E_{x\\to x+1}=d_x+1+d_x(E_{1\\to x}+E_{x\\to x+1})-\\sum_{x,y\\in S}E_{1\\to y}$$\n\n$$E_{x\\to x+1}=d_x+1+d_xE_{1\\to x}-\\sum_{x,y\\in S}E_{1\\to y}$$\n\n$$E_{1\\to x+1}=(d_x+1)(E_{1\\to x}+1)-\\sum_{x,y\\in S}E_{1\\to y}$$\n\n\u5c31\u53ef\u4ee5 $\\mathcal O(n+m)$ \u9012\u63a8\u5566 ~\\(\u2267\u25bd\u2266)/~\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<iostream>\n#include<vector>\nusing namespace std;\nconst int maxn=1e6+10;\nconst int mod=998244353;\nstruct Node{\n\tint size;vector<int> v;\n\tvoid adde(int x){v.push_back(x);size++;}\n\tNode():size(0){}\n};\nNode node[maxn];\nlong long E[maxn];\nint main(){\n\tcin.tie(0);ios::sync_with_stdio(false);\n\tint id,n,m,x,y;\n\tcin>>id>>n>>m;\n\tfor(int i=0;i<m;i++){cin>>x>>y;node[x].adde(y);}\n\tfor(int i=1;i<n+5;i++)E[i]=0;\n\tfor(int i=1;i<=n;i++){\n\t\tE[i+1]=(node[i].size+1)%mod*(E[i]+1)%mod;\n\t\tfor(int j=0;j<node[i].size;j++) E[i+1]+=(mod-E[node[i].v[j]]),E[i+1]%=mod;\n\t}\n\tcout<<E[n+1];\n} \n```",
        "postTime": 1602050362,
        "uid": 182691,
        "name": "hepta_lhd",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "### \u663e\u7136\u662f\u671f\u671b $\\texttt{dp}$\u3002\n\n\u8bbe $f_i$ \u4e3a $i$ \u5230 $i+1$ \u7684\u671f\u671b\u6b65\u6570\uff0c$s_i=\\sum\\limits_{j=0}^{i}f_j$\uff0c$f_0=0$\uff0c$d_i$ \u4e3a $i$ \u70b9\u51fa\u5ea6\u3002\n\u5219\u6709\uff1a\n$$f_{i}=\\frac{1+\\sum\\limits_{i\\rightarrow j}(f_{i}+s_{i-1}-s_{j-1}+1)}{d_{i}}$$\n\u6ce8\uff1a $j \\ne i+1$\n\n\u5176\u5b9e\u5c31\u662f\u5206\u7c7b\u8ba8\u8bba\uff0c $\\dfrac {1} {d_i}$ \u4e3a\u76f4\u63a5\u524d\u8fdb\u4e0d\u56de\u5934\u7684\u8d21\u732e\u3002$\\dfrac{f_{i}+s_{i-1}-s_{j-1}+1}{d_i}$ \u4e3a\u5148\u5f80\u56de\u8d70\u7684\u8d21\u732e\uff0c\u5373\u56de\u5230 $j$\uff08$1$\uff09\uff0c\u518d\u4ece $j$ \u8d70\u56de $i$\uff08$s_{i-1}-s_{j-1}$\uff09\uff0c\u518d\u7ee7\u7eed\u5411 $i+1$ \u524d\u8fdb\uff08$f_i$\uff09\u3002\n\n\u5316\u7b80\u5f97\uff1a\n\n$$f_id_i=(d_i-1)f_i+(d_i-1)s_{i-1}+d_i-\\sum\\limits_{i\\rightarrow j} s_{j-1}$$\n$$f_i=(d_i-1)s_{i-1}+d_i-\\sum\\limits_{i\\rightarrow j} s_{j-1}$$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u662f\u65e0\u540e\u6548\u6027\u7684\uff0c\u53ef\u4ee5\u9012\u63a8\u3002\n\n### \u65f6\u95f4\u590d\u6742\u5ea6\n\n$\\mathrm{O(n+m)}$\uff0c\u5bb9\u6613\u8bc1\u660e\uff0c\u6211\u4eec\u4f1a\u8bbf\u95ee\u6bcf\u6761\u8fb9\u6070\u597d\u4e00\u6b21\uff0c\u5e76\u6c42\u51fa\u6240\u6709 $f_i\\ (i\\le n)$ \u7684\u503c\u3002\n\n### \u4ee3\u7801\n```cpp\n#include<cstdio>\nint const mod=998244353;\nint id,n,m,head[1000010],to[1000010],nxt[1000010],cnt,d[1000010];\nlong long f[1000010],s[1000010];\nvoid add(int const &x,int const &y){\n\tto[++cnt]=y,nxt[cnt]=head[x],head[x]=cnt,++d[x];\n}\nint main(){\n\tscanf(\"%d%d%d\",&id,&n,&m);\n\tfor(int i=1,x,y;i<=m;i++)scanf(\"%d%d\",&x,&y),add(x,y);\n\tfor(int i=1;i<=n;i++){\n\t\tf[i]=d[i]*s[i-1]+d[i]+1;\n\t\tfor(int j=head[i];j;j=nxt[j])f[i]-=s[to[j]-1];\n\t\tf[i]=(f[i]%mod+mod)%mod;\n\t\ts[i]=(s[i-1]+f[i])%mod;\n\t}\n\tprintf(\"%lld\",s[n]);\n\treturn 0;\n}\n```",
        "postTime": 1600511125,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6835 [Cnoi2020]\u7ebf\u5f62\u751f\u7269"
    },
    {
        "content": "\u4e00\u773c\u9ad8\u65af\u6d88\u5143\uff0c\u7136\u540e\u53d1\u73b0\u4e86$n\\leq 1e6$\u77ac\u95f4\u66b4\u6bd9\uff0c~~\u5176\u5b9e\u6211\u5e76\u6ca1\u6709\u5199\u8fc7\u9ad8\u65af\u6d88\u5143~~\n\n\u8003\u8651\u4f7f\u7528$f_i$\u4ee3\u8868\u4ece$i$\u8d70\u5230$i+1$\u7684\u671f\u671b\u6b65\u6570\n\n\u4ee4$s_i=\\sum\\limits_{j=1}^if_j$\n\n\u90a3\u4e48\u5bf9\u4e8e\u4efb\u610f\u4e24\u70b9$i<j$\u90fd\u6709\u4ece$i$\u5230$j$\u671f\u671b\u6b65\u6570\u4e3a$s_{j-1}-s_{i-1}$\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u70b9$i$\uff0c\u8bbe\u5176\u8fd4\u7956\u8fb9\u96c6\u5408\u4e3a$S$\n\n$f_i=\\dfrac {1} {d+1}(1+\\sum\\limits_{j\\in S}(s_{i-1}-s_{j-1}+f_i+1))=1+\\dfrac {1} {d+1}\\sum\\limits_{j\\in S}(s_{i-1}-s_{j-1}+f_i)$\n\n\u79fb\u9879\u540e\u5f97\u5230$f_i=1+\\sum\\limits_{j\\in S}(s_{i-1}-s_{j-1}+1)$\n\n\u7b54\u6848\u5c31\u662f$s_n$\n\n\u8c8c\u4f3c\u4e5f\u53ef\u4ee5\u8bbe$f_i$\u4e3a\u4ece\u7b2c$i$\u4e2a\u70b9\u5230\u6700\u540e$n+1$\u7684\u671f\u671b\u6b65\u6570\n\n\u7136\u540e\u901a\u8fc7\u6709\u5173$f_1$\u548c\u5e38\u6570\u9879\u7684\u7cfb\u6570\u9012\u63a8\u4ec0\u4e48\u7684\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n#include<cstring>\n#include<cstdlib>\n#include<cctype>\n#include<set>\n#include<queue>\n#define M 1010000\n#define inf 0x3f3f3f3f\n#define LL long long\n#define int long long\nconst int mod=998244353;\nusing namespace std;\ninline int read(){\n\tint f=1,x=0;char s=getchar();\n\twhile (!isdigit(s)){if(s=='-')f=-1;s=getchar();}\n\twhile (isdigit(s)){x=(x<<1)+(x<<3)+(s^48),s=getchar();}\n\treturn x*f;\n}\nint id,n,m,s[M],f[M];vector<int>g[M];\nsigned main(void){\n\tid=read(),n=read(),m=read();\n\tfor (int i=1;i<=m;i++){\n\t\tint u=read(),v=read();\n\t\tg[u].push_back(v);\t\n\t}\n\tfor (int i=1;i<=n;i++){\n\t\tf[i]=1;\n\t\tfor (int j=0;j<g[i].size();j++)\n\t\t\tf[i]=(f[i]+(s[i-1]-s[(int)(g[i][j])-1]+mod)%mod+1)%mod;\n\t\ts[i]=(s[i-1]+f[i])%mod;\t\n\t}printf(\"%lld\",s[n]);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1600844400,
        "uid": 78290,
        "name": "Polaris_Dane",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6835 \u3010[Cnoi2020]\u7ebf\u5f62\u751f\u7269\u3011"
    },
    {
        "content": "\u8bc4\u4ef7\uff1a\u5f88\u597d\u7684\u4e00\u9053\u671f\u671bDP\uff0c\u9632\u6b62\u4e86\u671f\u671bDP\u201c\u8bbe\u4ece\u5f53\u524d\u5230\u7ec8\u70b9\u671f\u671b\u4e3a\u72b6\u6001\u201d\u7684\u60ef\u6027\u601d\u7ef4\n\n---\n\n[\u9898\u9762](https://www.luogu.com.cn/problem/P6835)\n\n\u601d\u8def\uff1a\n\n\u6211\u4eec\u53d1\u73b0\u6309\u7167\u4e0a\u9762\u63d0\u5230\u7684\u60ef\u6027\u601d\u7ef4\u8bbe$f(i)$\u4e3a\u4ece$i$\u5230$n+1$\u671f\u671b\u6b65\u6570\u4e3a\u72b6\u6001\u6839\u672c\u65e0\u6cd5\u8f6c\u79fb\uff0c\u56e0\u4e3a\u6709\u540e\u6548\u6027\n\n\u90a3\u4e48\u600e\u4e48\u6837\u6ca1\u6709\u540e\u6548\u6027\u5462\uff1f\n\n\u6211\u4eec\u8bbe$f(i)$\u4e3a\u4ece$i$\u5230$i+1$\u671f\u671b\u6b65\u6570\n\n\u90a3\u4e48\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$f(i)=\\frac{\\sum^{du}_{j=1} ((\\sum^{i}_{k=pre(i,j)}f(k))+1)}{du}$\n\n\u5176\u4e2d$du$\u4e3a\u5f53\u524d\u70b9\u51fa\u8fb9\u6570+1\n\n\u89e3\u91ca\u4e00\u4e0b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$\\sum^{i}_{k=pre(i,j)}f(k)$\u662f\u56e0\u4e3a\u6709\u53ef\u80fd\u8fd4\u7956\uff0c\u7136\u540e\u8981\u4ece\u8fd4\u7956\u8fb9\u7684\u76ee\u6807\u70b9\u56de\u6765\uff0c$+1$\u662f\u56e0\u4e3a\u5f53\u524d\u70b9\u5230\u4e0b\u4e00\u4e2a\u70b9\u8981\u8d70\u4e00\u6b65\n\n\u5f53$j=du$\u65f6$\\sum^{i}_{k=pre(i,j)}f(k)=0$\n\n\u5316\u7b80\u4e00\u4e0b\u4e0a\u9762\u7684\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$f(i)=\\frac{(\\sum^{du}_{j=1} \\sum^{i-1}_{k=pre(i,j)}f(k))+(du-1)*f(i)}{du}+1$\n\n$(1-\\frac{du-1}{du})f(i)=\\frac{\\sum^{du}_{j=1} \\sum^{i-1}_{k=pre(i,j)}f(k)}{du}+1$\n\n$f(i)=\\sum^{du}_{j=1} \\sum^{i-1}_{k=pre(i,j)}f(k)+du$\n\n$\\sum^{i-1}_{k=pre(i,j)}$\u53ef\u4ee5\u524d\u7f00\u548c\u4f18\u5316\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n+m)$\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=998244353;\nint id,n,m,f[1000005],sum[1000005];\nvector<int> e[1000005];\nint read(){\n\tint f=0,w=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){\n\t\tif(ch=='-') w=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9'){\n\t\tf=f*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn f*w;\n}\nsigned main(){\n\tid=read(),n=read(),m=read();\n\tfor(int i=1;i<=m;i++){\n\t\tint u=read(),v=read();\n\t\te[u].push_back(v);\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=0;j<e[i].size();j++){\n\t\t\tf[i]=((f[i]+sum[i-1]-sum[e[i][j]-1])%mod+mod)%mod;\n\t\t}\n\t\tf[i]=(f[i]+e[i].size()+1)%mod;\n\t\tsum[i]=(sum[i-1]+f[i])%mod;\n\t}\n\tprintf(\"%lld\\n\",sum[n]);\n\treturn 0;\n}\n\n```",
        "postTime": 1600517570,
        "uid": 247540,
        "name": "tongyf",
        "ccfLevel": 6,
        "title": "P6835 [Cnoi2020]\u7ebf\u5f62\u751f\u7269"
    }
]