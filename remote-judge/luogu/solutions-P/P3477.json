[
    {
        "content": "~~\u8fd9\u9053\u9898\u5982\u679c\u4e0d\u662f\u4efb\u610f\u6a21\u6570\u7684\u8bdd\u8fd8\u662f\u6bd4\u8f83\u5e73\u51e1\u7684\uff08~~\n\n\u8fd9\u9053\u9898\u7684\u5f0f\u5b50\u5176\u5b9e\u5f88\u597d\u63a8\uff0c\u6839\u636e\u5eb7\u6258\u5c55\u5f00\u7684\u601d\u8def\uff0c\u4e00\u4f4d\u4e00\u4f4d\u8003\u8651\uff0c\u53ea\u4e0d\u8fc7\u662f\u591a\u91cd\u96c6\uff0c\u53ef\u80fd\u6709\u91cd\u590d\u60c5\u51b5\uff0c\u6392\u9664\u5373\u53ef\uff0c\u6bcf\u4e00\u4f4d\u7684\u5f0f\u5b50\u4e3a\uff1a\n\n$$ ans_i=\\dfrac{(n-i)!}{\\prod cnt_j}\\times\\sum^n_{k=i+1}[ a_k<a_i] $$\n\uff08$cnt_j$ \u4e3a $i-n$ \u4e4b\u95f4 $j$ \u7684\u4e2a\u6570\uff0c$a_i$ \u4e3a\u7b2c $i$ \u4f4d\u7684\u503c\uff09\n\n\u540e\u9762\u7684\u548c\u5f0f\u4e3a $i-n$ \u4e4b\u95f4\u503c\u5927\u4e8e\u7b2c $i$ \u4f4d\u7684\u503c\u7684\u6570\u91cf\uff0c\u540c\u5eb7\u6258\u5c55\u5f00\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u5904\u7406\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u5904\u7406\u4efb\u610f\u6a21\u6570\u3002\n\n$cnt_j$ \u4e2d\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0e $p$ \u4e0d\u4e92\u8d28\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u6761\u4ef6\u4e0b\u4e0d\u5b58\u5728\u9006\u5143\uff0c\u6240\u4ee5\u53ef\u4ee5\u501f\u9274\u6269\u5c55\u5362\u5361\u65af\u7684\u601d\u8def\uff0c\u628a\u5206\u5b50\u548c\u5206\u6bcd\u4e2d $p$ \u7684\u8d28\u56e0\u5b50\u62c6\u5206\u51fa\u6765\uff0c\u518d\u6765\u8ba1\u7b97\u5206\u6bcd\u9006\u5143\uff0c\u6700\u540e\u7d2f\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u518d\u628a $p$ \u5206\u79bb\u51fa\u6765\u7684\u8d28\u56e0\u5b50\u4e58\u8fdb\u53bb\u5373\u53ef\u3002\n\n\u53e6\u5916\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4f4d\u7684\u7b54\u6848\u80af\u5b9a\u4e0d\u80fd\u5355\u72ec\u8ba1\u7b97\uff0c\u5426\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u7206\u6389\uff0c\u6240\u4ee5\u8003\u8651\u7b54\u6848\u9012\u63a8\uff0c\u9996\u5148\u4ece\u540e\u5411\u524d\u63a8\u80af\u5b9a\u76f8\u5bf9\u7b80\u5355\uff0c\u8003\u8651\u6bcf\u5f80\u524d\u8d70\u4e00\u6b65\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\uff0c\u5047\u8bbe\u4ece $t+1$ \u8d70\u5230 $t$ \u5206\u5b50\uff0c\u5206\u5b50\u4ece $(n-t-1)!$ \u53d8\u4e3a $(n-t)!$ \u4e58\u4e0a\u4e86 $n-t$\uff0c$cnt_{a_t}$ \u589e\u52a0\u4e861\uff0c\u76f8\u5f53\u4e8e\u4e58\u4e0a\u4e86 $\\dfrac{cnt_{a_t}-1}{cnt_{a_t}}$\uff0c\u628a\u4e0a\u9762\u4e24\u5f0f\u5206\u79bb\u8d28\u56e0\u5b50\u6c42\u9006\u5143\u4e58\u8fdb\u7b54\u6848\u9012\u63a8\u5373\u53ef\uff0c\u521d\u59cb\u72b6\u6001 $ans_n=0$\n\n\u6700\u540e\u9644\u4e0a\u672c\u849f\u84bb\u70b8\u88c2\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define N 300005ll\n#define int long long\nusing namespace std;\n\nint n,m,s[N],ans=1,buk[N],cnt[100];\nint x,y,fac[100][N],base[100],tot;\nstruct Fenwick{\n    int c[N];\n    inline int lowbit(int X) {return X&(-X);}\n    inline void update(int pos,int val){\n        for(int i=pos;i<=N-5;i+=lowbit(i))\n            c[i]+=val;\n    }\n    inline int sum(int pos){\n        int temp=0;\n        for(int i=pos;i;i-=lowbit(i))\n            temp+=c[i];\n        return temp;\n    }\n}T;\nvoid exgcd(int a,int b);\nint inv(int a,int p);\nvoid factor(int a);\nvoid change(int &a,int type);\nint prod();\n\nsigned main(){\n    cin>>n>>m;\n    for(int i=1;i<=n;i++)\n        scanf(\"%lld\",s+i);\n    factor(m);\n    buk[s[n]]++;T.update(s[n],1);\n    int tmpans=1,tmp;\n    for(int i=n-1;i>=1;i--){\n        T.update(s[i],1);\n        change(tmp,1);\n        tmpans=tmpans*tmp%m;\n        tmp=++buk[s[i]];\n        change(tmp,-1);\n        tmpans=tmpans*inv(tmp,m)%m;\n        ans=(ans+tmpans*T.sum(s[i]-1)%m*prod()%m)%m;\n    }\n    cout<<ans;\n}\n\nvoid exgcd(int a,int b){\n    if(!b){\n        x=1,y=0;\n        return;\n    }\n    exgcd(b,a%b);\n    int tmp=x;\n    x=y,y=tmp-a/b*y;\n}\n\nint inv(int a,int p){\n    exgcd(a,p);\n    return (x%p+p)%p;\n}\n\nvoid factor(int a){\n    for(int i=2;a!=1;i++)\n        if(!(a%i)){\n            base[++tot]=i;\n            fac[tot][0]=1;\n            while(!(a%i)) a/=i;\n            for(int j=1;j<=N-5;j++)\n                fac[tot][j]=fac[tot][j-1]*i%m;\n        }\n}\n\nvoid change(int &a,int type){\n    for(int i=1;i<=tot;i++)\n        while(!(a%base[i])){\n            a/=base[i];\n            cnt[i]+=type;\n        }\n}\n\nint prod(){\n    int Tmp=1;\n    for(int i=1;i<=tot;i++)\n        Tmp=Tmp*fac[i][cnt[i]]%m;\n    return Tmp;\n}\n```",
        "postTime": 1660871790,
        "uid": 510649,
        "name": "Rolling_star",
        "ccfLevel": 0,
        "title": "\u89e3\u9898\u62a5\u544a\u2014\u2014P3477 [POI2008]PER-Permutation"
    },
    {
        "content": "# \u300c\u9898\u89e3\u62a5\u544a\u300d[[POI2008]PER-Permutation](https://www.luogu.com.cn/problem/P3477)\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Keven-He/p/solution-P3477.html)\n\n\u4e0d\u7406\u89e3\u54ea\u91cc\u96be\u4e86\uff0c\u5b66\u8fc7\u6269\u5362\u5e76\u4e14\u63a8\u4e00\u4e0b\u5f0f\u5b50\u57fa\u672c\u5c31\u662f\u4e24\u773c\u5207\u5427\u3002\n\n\u4e2a\u4eba\u611f\u89c9\u9876\u591a\u4e0a\u4f4d\u7d2b\u3002\n\n## \u601d\u8def\n\n\u9996\u5148\u8bbe $f_i$ \u8868\u793a\u524d $i-1$ \u4f4d\u56fa\u5b9a\uff0c\u7b2c $i$ \u4f4d\u9009\u4e00\u4e2a\u6bd4\u539f\u6765\u5c0f\u7684\uff0c\u540e\u9762\u968f\u4fbf\u6392\u7684\u65b9\u6848\u6570\u3002\n\n\u663e\u7136 $(\\sum_{i=1}^{n}f_i)+1$ \u4e3a\u7b54\u6848\uff0c\u90a3\u4e48\u8003\u8651\u5982\u4f55\u5feb\u901f\u6c42\u51fa $f_i$\u3002\n\n\u8003\u8651\u7528\u201c\u4ea4\u6362\u201d\u7684\u601d\u60f3\uff0c\u5373\u5728\u540e $n-i$ \u4e2a\u6570\u4e2d\u627e\u5230\u6bd4 $a_i$ \u5c0f\u7684\u6570\u548c\u5b83\u6362\u4e00\u4e0b\uff0c\u7136\u540e\u518d\u968f\u4fbf\u6392\u3002\n\n\u7136\u800c\u8fd9\u91cc\u662f\u53ef\u91cd\u96c6\uff0c\u6240\u4ee5\u8fd8\u8981\u53bb\u91cd\u4e58\u4e0a $\\dfrac{1}{\\prod_{j}(A_{cnt_j}^{cnt_j})}=\\dfrac{1}{\\prod_{j}(cnt_j!)}$\u3002\uff08$cnt_j$ \u8868\u793a\u5728 $i\\sim n$ \u4e2d $j$ \u51fa\u73b0\u4e86\u51e0\u6b21\uff09\n\n\u90a3\u4e48\u53ef\u5199\u51fa\u5f0f\u5b50\uff1a\n\n$$\nf_i=\\frac{(n-i)!}{\\prod(cnt_j!)}\\sum_{j=1}^{n}[a_i>a_j]\\bmod M\n$$\n\n\u4f46\u662f $M$ \u4e0d\u662f\u8d28\u6570\uff0c\u6ca1\u6cd5\u76f4\u63a5\u6c42\u9006\u5143\uff0c\u600e\u4e48\u529e\u5462\uff1f\n\n**\u7528\u6269\u5c55\u5362\u5361\u65af\u7684\u601d\u60f3**\u3002\n\n[\u6269\u5362\u662f\u5565\uff1f](https://www.cnblogs.com/Keven-He/p/CombinationAndCRT.html#exlucas)\n\n\u9996\u5148\u628a $M$ \u5206\u89e3\u6210 $p_1^{k_1}p_2^{k_2}\\cdots p_t^{k_t}(p_i\\in\\mathbb{P})$\uff0c\u89e3\u51b3\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\uff1a\n\n$$\n\\begin{cases}\nx \\equiv \\frac{(n-i)!}{\\prod(cnt_j!)}\\sum_{j=1}^{n}[a_i>a_j] \\pmod{p_1^{k_1}}\\\\\nx \\equiv \\frac{(n-i)!}{\\prod(cnt_j!)}\\sum_{j=1}^{n}[a_i>a_j] \\pmod{p_2^{k_2}}\\\\\n\\dots\\\\\nx \\equiv \\frac{(n-i)!}{\\prod(cnt_j!)}\\sum_{j=1}^{n}[a_i>a_j] \\pmod{p_t^{k_t}}\\\\\n\\end{cases}\n$$\n\n\u8fd9\u4e9b\u5185\u5bb9\u53ef\u7528 CRT \u5408\u5e76\uff0c\u7136\u540e\u6ce8\u610f\u8fd9\u4e2a\u65b9\u7a0b\uff1a\n\n$$\nx \\equiv \\frac{(n-i)!}{\\prod(cnt_j!)}\\sum_{j=1}^{n}[a_i>a_j] \\pmod{p^k}\\\\\n$$\n\n$\\sum_{j=1}^{n}[a_i>a_j]$ \u7b80\u5355\u6811\u72b6\u6570\u7ec4\u89e3\u51b3\uff0c\u95ee\u9898\u5c31\u53ea\u5269\u4e0b\u4e86\u5982\u4f55\u6c42 $\\dfrac{(n-i)!}{\\prod(cnt_j!)}\\bmod{p^k}$\u3002\n\n\u7ee7\u7eed\u7528\u6269\u5362\u7684\u601d\u60f3\uff0c**\u628a\u5206\u5b50\u548c\u5206\u6bcd\u4e2d\u7684 $p$ \u63d0\u53d6\u51fa\u6765**\uff1a\n\n$$\n\\large\\dfrac{\\frac{(n-i)!}{p^{x}}}{\\frac{\\prod(cnt_j!)}{p^{y}}}*p^{x-y}\\bmod{p^k}\n$$\n\n\u76f4\u63a5\u63d0\u663e\u7136\u4f1a TLE\uff0c\u6240\u4ee5\u6211\u4eec\u5145\u5206\u53d1\u6325\u4eba\u7c7b\u667a\u6167\uff1a\u6c42 $f_i$ \u65f6\u5012\u5e8f\u8dd1\uff0c\u8fd9\u6837**\u6bcf\u6b21\u53ea\u7528\u989d\u5916\u63d0\u51fa $(n-i)$ \u548c $cnt_{a_i}$ \u7684 $p$\uff0c\u7136\u540e\u4e0e\u4e0a\u4e00\u6b21\u7684\u5206\u5b50\u4e0e\u5206\u6bcd\u5408\u5e76\u5373\u53ef**\u3002\n\n\u7136\u540e\u6709\u4e2a\u5c0f\u7ec6\u8282\uff1a$x-y$ \u53ef\u80fd\u4e3a\u8d1f\uff0c\u6b64\u65f6\u8981\u53d1\u6325\u4eba\u7c7b\u667a\u6167\u7528\u9006\u5143\u6de6\u3002\n\n\u7136\u540e\u5c31\u5207\u6389\u4e86\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define lowb(a, r, x) lower_bound(a + 1, a + r + 1, x) - a\n#define uppb(a, r, x) upper_bound(a + 1, a + r + 1, x) - a\n#define _for(i, a, b) for (ll i = a; i <= b; ++i)\n#define for_(i, a, b) for (ll i = a; i >= b; --i)\n#define far(i, vec) for (auto i : vec)\n#define bdmd int mid = (l + r) >> 1\n#define NO nullptr\ntypedef long double ldb;\ntypedef long long ll;\ntypedef double db;\nconst ll N = 3e5 + 10, INF = 1ll << 40;\n\nclass TreeArray {\npublic:\n\tll b[N], mx;\n\tinline ll lowbit (ll x) { return x & -x; }\n\tinline void Update (ll x) {\n\t\twhile (x <= mx) ++b[x], x += lowbit (x);\n\t\treturn;\n\t}\n\tinline ll Query (ll x) {\n\t\tll ans = 0;\n\t\twhile (x > 0) ans += b[x], x -= lowbit (x);\n\t\treturn ans;\n\t}\n} ta;\n\nnamespace MathBasic {\n\tinline void GetFactor (ll x, std::vector <ll>& p, std::vector <ll>& k) {\n\t\tp.push_back (0), k.push_back (0);\n\t\tfor (ll i = 2; i * i <= x; ++i) {\n\t\t\tif (!(x % i)) {\n\t\t\t\tp.push_back (i), k.push_back (0);\n\t\t\t\twhile (!(x % i)) x /= i, ++k[k.size () - 1];\n\t\t\t}\n\t\t}\n\t\tif (x != 1) p.push_back (x), k.push_back (1);\n\t\treturn;\n\t}\n\tinline ll ExGcd (ll a, ll b, ll& x, ll& y) {\n\t\tif (!b) { x = 1, y = 0; return a; }\n\t\tll g = ExGcd (b, a % b, x, y), _x = x;\n\t\tx = y, y = _x - (a / b) * y;\n\t\treturn g;\n\t}\n\tinline ll Inv (ll a, ll P) {\n\t\tll x, y;\n\t\tExGcd (a, P, x, y);\n\t\treturn (x % P + P) % P;\n\t}\n\tinline ll FastPow (ll a, ll b, ll Mod = INF) {\n\t\tll ans = 1;\n\t\tif (b < 0) a = Inv (a, Mod), b = -b;\n\t\twhile (b) {\n\t\t\tif (b & 1) ans = ans * a % Mod;\n\t\t\ta = a * a % Mod, b >>= 1;\n\t\t}\n\t\treturn ans;\n\t}\n}\n\nnamespace CRT {\n\tusing namespace MathBasic;\n\tll a[N], m[N], fac[N], fm[N], in[N], cnt[N];\n\tstd::vector <ll> p, k;\n\tinline void Pre (ll P) {\n\t\tGetFactor (P, p, k);\n\t\tll len = p.size () - 1;\n\t\t_for (i, 1, len) fac[i] = fm[i] = 1;\n\t\treturn;\n\t}\n\tinline ll Idx (ll x, ll P) {\n\t\tll idx = 0;\n\t\twhile (!(x % P)) x /= P, ++idx;\n\t\treturn idx;\n\t}\n\tinline ll DelP (ll x, ll P) {\n\t\twhile (!(x % P)) x /= P;\n\t\treturn x;\n\t}\n\tinline ll CRT (ll n, ll j, ll ai, ll P) {\n\t\tll ans = 0, len = p.size () - 1;\n\t\t++cnt[ai];\n\t\t_for (i, 1, len) {\n\t\t\tm[i] = FastPow (p[i], k[i]);\n\t\t\tin[i] += Idx ((n - j) ? (n - j) : 1, p[i]) - Idx (cnt[ai], p[i]);\n\t\t\tfac[i] = fac[i] * DelP ((n - j) ? (n - j) : 1, p[i]) % m[i];\n\t\t\tfm[i] = fm[i] * DelP (cnt[ai], p[i]) % m[i];\n\t\t\ta[i] = FastPow (p[i], in[i], m[i]) * fac[i] % m[i] * Inv (fm[i], m[i]) % m[i];\n\t\t\tll q = P / m[i];\n\t\t\tans = (ans + a[i] * q % P * Inv (q, m[i]) % P) % P;\n\t\t}\n\t\treturn ans;\n\t}\n}\n\nnamespace SOLVE {\n\tll n, P, a[N], ans = 1;\n\tinline ll rnt () {\n\t\tll x = 0, w = 1; char c = getchar ();\n\t\twhile (!isdigit (c)) { if (c == '-') w = -1; c = getchar (); }\n\t\twhile (isdigit (c)) x = (x << 3) + (x << 1) + (c ^ 48), c = getchar ();\n\t\treturn x * w;\n\t}\n\tinline void In () {\n\t\tn = rnt (), P = rnt ();\n\t\t_for (i, 1, n) a[i] = rnt (), ta.mx = std::max (ta.mx, a[i]);\n\t\treturn;\n\t}\n\tinline void Solve () {\n\t\tCRT::Pre (P);\n\t\tfor_ (i, n, 1) {\n\t\t\tll crt = CRT::CRT (n, i, a[i], P);\n\t\t\tans = (ans + ta.Query (a[i] - 1) % P * crt % P) % P;\n\t\t\tta.Update (a[i]);\n\t\t}\n\t\treturn;\n\t}\n\tinline void Out () {\n\t\tprintf (\"%lld\\n\", ans);\n\t\treturn;\n\t}\n}\nint main () {\n#ifndef ONLINE_JUDGE\n\tfreopen (\"date.in\", \"r\", stdin);\n#endif\n\tSOLVE::In ();\n\tSOLVE::Solve ();\n\tSOLVE::Out ();\n\treturn 0;\n} /*\n\n\n\n*/\n```",
        "postTime": 1667650543,
        "uid": 306045,
        "name": "K8He",
        "ccfLevel": 5,
        "title": "\u300c\u9898\u89e3\u62a5\u544a\u300d[POI2008]PER-Permutation"
    },
    {
        "content": "## \u5f88\u6709\u601d\u7ef4\u7684\u4e00\u9053\u9898\n\n\u8fd9\u4e2a\u9898\u7684\u9898\u9762\u975e\u5e38\u7b80\u5355\uff0c\u51fa\u9898\u4eba\u5f88 ~~\u53cb\u597d~~ \uff0c\u6ca1\u6709\u641e\u4ec0\u4e48\u5947\u602a\u7684\u80cc\u666f\uff0c~~\uff08\u5361\u519c\uff08P3214\uff09\u7684\u4f5c\u8005\u770b\u770b\u4eba\u5bb6\uff09~~\uff0c\u6240\u4ee5\u7406\u89e3\u9898\u9762\u5c31\u662f\uff1a\n\n**\u4e00\u53e5\u8bdd\u9898\u610f\uff1a**\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u5217\uff0c\u6c42\u8fd9\u4e2a\u6570\u5217\u662f\u5728\u5176\u5168\u6392\u5217\u4e2d\u7684\u6392\u540d\u662f\u591a\u5c11\uff0c\u8f93\u51fa\u6392\u540d\u6a21 $m$ \u7684\u7ed3\u679c\u3002\n\n\u8d75\u5c0f\u5175\u540c\u5b66\uff1a\u8fd9\u4e0d\u5c31\u662f\u4e2a\u5eb7\u6258\u5c55\u5f00\u561b\uff0c\u770b\u6211 A \u6389\u8fd9\u4e2a\u5927\u6c34\u9898\u3002\n\n\u4e8e\u662f\uff0c\u4ed6\u6253\u51fa\u4e86\u4e0b\u9762\u8fd9\u4e2a\u7a0b\u5e8f\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define INF 0x7f7f7f7f7f\nconst int one = 1e7+10;\ninline void openfile()\n{freopen(\"t.txt\",\"r\",stdin);}\nnamespace zxb\n{\n\tint tree[1000005];\n\tint n;\n\tinline int lowbit(int x)\n\t{\n\t\treturn x&-x;\n\t}\n\tinline void update(int x,int y)\n\t{\n\t\twhile(x<=n){\n\t\t\ttree[x]+=y;\n\t\t\tx+=lowbit(x);\n\t\t}\n\t}\n\tinline int query(int x)\n\t{\n\t\tint sum=0;\n\t\twhile(x)\n\t\t{\n\t\t\tsum+=tree[x];\n\t\t\tx-=lowbit(x);\n\t\t}\n\t\treturn sum;\n\t}\n\tint mod;\n\tint jc[1000005];\n\tint a[1000005];\n\tinline short main()\n\t{\n\t\t//openfile();\n\t\tjc[0] = jc[1] = 1;\n\t\tcin >> n >> mod;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tjc[i]=(jc[i-1]*i)%mod;\n\t\t\tupdate(i,1);\n\t\t}\n\t\tint ans = 0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tscanf(\"%lld\",&a[i]);\n\t\t\tans=(ans+((query(a[i])-1)*jc[n-i]) % mod) % mod;\n\t\t\tupdate(a[i],-1);\n\t\t}\n\t\tcout<<ans +1<<endl;\n\t   \treturn 0;\n\t  }\n}\nsigned main() { return zxb::main();}\n```\n\u7136\u540e\u3002\u3002\u3002[\u8d75\u5c0f\u5175\u540c\u5b66\u7ffb\u8f66\u8bb0\u5f55](https://www.luogu.com.cn/record/49927140)\n\n\u65c1\u8fb9\u7684 $C$ \u541b\u770b\u4e0d\u4e0b\u53bb\u4e86\uff0c\u8f6c\u773c\u5c31\u6253\u4e86\u4e00\u4e2a\u66b4\u529b\u7b97\u6cd5\uff0c\u5e76\u5bf9\u8d75\u5c0f\u5175\u540c\u5b66\u53d1\u6765\u4e86\u9119\u89c6\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define INF 0x7f7f7f7f7f\nconst int one = 1e7+10;\ninline void openfile()\n{freopen(\"t.txt\",\"r\",stdin);}\ninline int get()\n{\n\tint s = 0,f = 1;\n\tregister char ch = getchar();\n\twhile(!isdigit(ch))\n\t{\n\t\tif(ch == '-') f= -1;\n\t\tch = getchar();\n\t}\n\twhile(isdigit(ch))\n\t{\n\t\ts = s* 10 + ch - '0';\n\t\tch = getchar();\n\t}\n\treturn s * f;\n}\nnamespace xin\n{\n\tint a[one],b[one];\n\tint mod,n;\n\tinline bool comp()\n\t{\n\t\tfor(register int i=1;i<=n;++i)\n\t\t\tif(a[i] != b[i])\n\t\t\t\treturn false;\n\t\treturn true;\n\t}\n\tinline short main()\n\t{\n\t//\topenfile();\n\t\tn = get(); mod = get();\n\t\tfor(register int i=1;i<=n;++i) a[i] = get(),b[i] = a[i];\n\t\tsort(a+1,a+1+n);\n\t\tint cnt = 1;\n\t\twhile(next_permutation(a+1,a+n+1))\n\t\t{\n\t\t\tcnt++;\n\t\t\tif(comp() == 1) \n\t\t\t{\n\t\t\t\tcout<<cnt % mod<<endl;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n}\nsigned main() { return xin::main();}\n```\n $C$ \u541b\u7684\u66b4\u529b\u8bb0\u5f55[$C$ \u541b\u7684\u66b4\u529b\u8bb0\u5f55](https://www.luogu.com.cn/record/49927309)\n $C$ \u541b\u6574\u6574\u6bd4\u8d75\u5c0f\u5175\u540c\u5b66\u591a\u4e86\u4e00\u500d\u7684\u5206\u6570\uff0c\u8fd9\u65f6\u5019\uff0c\u5750\u5728\u4e00\u65c1\u7684 $XIN$ \u540c\u5b66\u770b\u4e0d\u4e0b\u53bb\u4e86\uff0c\u4f46 $XIN$ \u540c\u5b66\u4e00\u65f6\u95f4\u4e5f\u65e0\u6cd5\u60f3\u51fa\u6b63\u89e3\uff0c\u4f46\u662f\u7ecf\u8fc7 $XIN$ \u540c\u5b66\u4e3a\u671f $3$ \u5929\u7684\u4e0d\u61c8\u594b\u6597\uff0c\u7ec8\u4e8e $A$ \u6389\u4e86\u8fd9\u4e2a\u9898\u76ee\uff1a\n \u8d75\u5c0f\u51b0\u548c $C$ \u541b\u90fd\u60f3\u8981\u77e5\u9053\u4ed6\u7684\u601d\u8def\uff0c $XIN$ \u540c\u5b66\u5f00\u59cb\u8bb2\u5230\uff1a\n \n \u9996\u5148\uff0c\u8981\u8003\u8651\u6bcf\u4e00\u4e2a\u6570\u4f4d\u7684\u8d21\u732e\u503c\uff0c\u5176\u5b9e\u8d75\u5c0f\u5175\u540c\u5b66\u7684\u7b2c\u4e00\u60f3\u6cd5\u662f\u4e0d\u9519\u7684\uff0c\u4f46\u662f\u53ea\u80fd\u8bf4\u662f\u4e0d\u5bf9\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9898\u76ee\u5b58\u5728\u91cd\u590d\uff0c\u4e5f\u5b58\u5728\u6a21\u6570\u4e3a\u5408\u6570\u7684\u65f6\u5019\uff0c\u6240\u4ee5\u5eb7\u6258\u5c55\u5f00\u5c31\u4e0d\u7ba1\u7528\u4e86\uff0c\u6240\u4ee5\u8981\u8003\u8651\u522b\u7684\u60f3\u6cd5\uff0c\u53d1\u73b0\u5168\u6392\u5217\u5c31\u548c\u672c\u8eab\u7684\u5b57\u5178\u5e8f\u6709\u5173\uff0c\u4e4b\u540e\u5f97\u51fa\u8ba1\u7b97\u5f0f\uff1a\n $$\n w \\cdot \\frac{(n-i)!}{\\Pi \\ {cnt[j]!}} \n $$\n $cnt $ \u5c31\u662f\u4ece $i$ \u5230 $n $ \u4e2d $j$ \u6240\u51fa\u73b0\u7684\u4e2a\u6570\n \n \u4f46\u662f\u95ee\u9898\u5c31\u53c8\u6765\u4e86\uff0c\u5408\u6570\u5e94\u8be5\u600e\u4e48\u5904\u7406\u5462\uff1f\uff1f\uff1f\n \n \u6700\u5148\u8003\u8651\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff1a\n $$\n a^{p-1}\u22611 (mod\\ p)\n $$\n \u53ef\u662f\uff0c\u6a21\u6570\u4e3a\u5408\u6570\u554a\uff0c\u6240\u4ee5\u8003\u8651\u6269\u5c55\u6b27\u51e0\u91cc\u7684\u6c42\u51fa\u9006\u5143\uff1a\n ```cpp\ninline void exgcd(int a,int b,int &x,int &y)\n{\n    if(!b) { x = 1; y = 0; return;}\n    exgcd(b,a%b,y,x);\n    y -= a / b * x;\n}\ninline int get_inv(int x,int p)\n{\n    int a,b;\n    exgcd(x,p,a,b);\n    return (a % p + p) % p;\n}\n ```\n \u4e4b\u540e\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5728 $log$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u60c5\u51b5\u4e0b\u6c42\u51fa\u533a\u95f4\u6700\u5c0f\u503c\uff1a\n ```cpp\n namespace xin_bit\n{\n    int s[maxn];\n    inline int lowbit(int x)\n    {return x & -x;}\n    inline void add(int x,int val)\n    {\n        while(x <= maxn)\n        {\n            s[x] += val;\n            x += lowbit(x);\n        }\n    }\n    inline int query(int x)\n    {\n        register int ret = 0;\n        while(x)\n        {\n            ret += s[x];\n            x -= lowbit(x);\n        }\n        return ret;\n    }\n}\n ```\n \u4e4b\u540e\u6765\u4e00\u70b9\u5c0f\u5c0f\u7684\u8f6c\u79fb\uff0c\u5c06\u56e0\u5b50\u5206\u89e3\uff0c\u4e4b\u540e\u518d\u5408\u5e76\uff0c\u6700\u540e\u5c31\u53ef\u4ee5\u6309\u7167\u8ba1\u7b97\u5f0f\u6c42\u51fa\u672c\u9898\u7684\u7b54\u6848\u4e86\u3002\n \u6177\u6168\u7684 $XIN$ \u8fd8\u653e\u51fa\u4e86\u4ee3\u7801\uff1a\n ```cpp\n #include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int maxn = 1e6+10;\nnamespace xin_io\n{\n    inline int get()\n    {\n        int s =0 ,f = 1;\n        register char ch = getchar();\n        while(!isdigit(ch))\n        {\n            if(ch == '-') f= -1;\n            ch = getchar();\n        }   \n        while(isdigit(ch))\n        {\n            s = s *10 + ch - '0';\n            ch = getchar();\n        }\n        return s * f;\n    }\n    inline void write(int x)\n    {\n        if(x < 0) putchar('-'),x = -x;\n        if(x > 9) write(x/10);\n        putchar(x % 10 + '0');\n    }\n}\nusing xin_io::get; using xin_io::write;\ninline void openfile()\n{freopen(\"t.txt\",\"r\",stdin);}\nnamespace xin_bit\n{\n    int s[maxn];\n    inline int lowbit(int x)\n    {return x & -x;}\n    inline void add(int x,int val)\n    {\n        while(x <= maxn)\n        {\n            s[x] += val;\n            x += lowbit(x);\n        }\n    }\n    inline int query(int x)\n    {\n        register int ret = 0;\n        while(x)\n        {\n            ret += s[x];\n            x -= lowbit(x);\n        }\n        return ret;\n    }\n}\nnamespace xin\n{\n    #define m(c) cout<<sizeof(c) / (1 << 20) << \"MB\"<<endl\n    #define min(a,b) (a) < (b) ? (a) : (b)\n    #define max(a,b) (a) > (b) ? (a) : (b)\n    int mod;\n    int n,m;\n    bool number[maxn];\n    int prime[maxn];\n    int i,j,count=0;\n    inline void xin_shai(int N)\n    {\n        memset(number,true,sizeof(number));\n        for(i=2;i<=N;i++)\n        {\n            if(number[i])\n                prime[count++]=i;\n            for(j=0;j<count and prime[j]*i<=N;j++)\n            {\n                number[prime[j]*i]=false;\n                if(i%prime[j]==0)\n                    break;\n            }\n        }\n    }\n    inline void exgcd(int a,int b,int &x,int &y)\n    {\n        if(!b) { x = 1; y = 0; return;}\n        exgcd(b,a%b,y,x);\n        y -= a / b * x;\n    }\n    inline int get_inv(int x,int p)\n    {\n        int a,b;\n        exgcd(x,p,a,b);\n        return (a % p + p) % p;\n    }\n    int cnt[110],link[110][maxn];\n    int rec1[maxn],rec2[maxn];\n    int temp,a[maxn],fac[maxn],num_fac = 0;\n    inline void cont(int &x,int val)\n    {\n        for(register int i=1;i<=num_fac;++i)\n        {\n            register int zhuan = fac[i];\n            while(!(x % zhuan))\n                x/=zhuan,cnt[i] += val;\n        }\n    }\n    inline int get_num()\n    {\n        int ret = 1;\n        for(register int i=1;i<=num_fac;++i)\n            ret = (ret * link[i][min(rec2[i],cnt[i])] ) % m;\n        return ret;\n    }\n    inline int work()\n    {\n        int ans = 0,ret = 1;\n        rec1[a[n]] = 1; xin_bit::add(a[n],1);\n        for(register int i=n-1;i>=1;--i)\n        {\n            int zhuan  = n - i;\n            cont(zhuan,1);\n            ret *= zhuan; ret %= m;\n            zhuan = ++rec1[a[i]];\n            cont(zhuan,-1);\n            ret = (ret * get_inv(zhuan,m) + m) % m;\n            xin_bit::add(a[i],1);\n            zhuan = get_num();\n            ans += (ret % m * xin_bit::query(a[i] - 1) % m * zhuan % m + m ) % m;\n            ans %= m;\n        }\n        return ++ans;\n    }\n    inline short main()\n    {\n        openfile();\n        n = get(); m = get(); temp = m;\n        for(register int i=1;i<=n;++i) a[i] = get();\n        for(register int i=2;i<=sqrt(temp);++i)\n        if(temp % i == 0)\n        {\n            fac[++num_fac] = i;\n            link[num_fac][0] = 1;\n            for(register int j=1;j<=maxn;++j)\n                link[num_fac][j] = link[num_fac][j-1] * i % m,rec2[num_fac] ++;\n            while(temp % i == 0)temp /= i;\n        }\n        if(temp > 1)\n        {\n            fac[++num_fac] = temp;\n            link[num_fac][0] = 1;\n            for(register int j=1;j<=maxn;++j)\n                link[num_fac][j] = link[num_fac][j-1] * temp % m,rec2[num_fac]++;\n        }\n        int ans = work() % m;\n        write(ans);\n        putchar('\\n');\n        return 0;\n    } \n}\nsigned main() {return xin::main();}\n ```\n \u4fee\u6539\u4e86 $\\LaTeX$ \uff0c\u671b\u901a\u8fc7\u3002",
        "postTime": 1619270180,
        "uid": 431943,
        "name": "\u5218\u8363\u4fe1",
        "ccfLevel": 4,
        "title": "[POI2008]PER"
    },
    {
        "content": "### P.S.\nwoc \u600e\u4e48\u5176\u4ed6\u4e09\u7bc7\u9898\u89e3\u5168\u90e8 UB ![](//xn--9zr.tk/fad)  \n\u5e38\u6570\u88ab\u540a\u6253\u3010\u60b2\u3011  \n\n### Description.\n\u6c42\u53ef\u91cd\u6392\u5217\u7684[\u5eb7\u6258\u5c55\u5f00](https://baike.baidu.com/item/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80/7968428?fr=aladdin)  \n\n### Solution.\n\u9996\u5148\uff0c\u8003\u8651\u6bd4\u8f83\u5b57\u5178\u5e8f\u7684\u8fc7\u7a0b\u3002  \n\u80af\u5b9a\u6709\u4e00\u4e2a\u524d\u7f00\u662f\u76f8\u540c\u7684\uff0c\u7136\u540e\u6709\u4e00\u4f4d\u4e0d\u540c\uff0c\u540e\u9762\u968f\u4fbf\u4e71\u6392\u3002  \n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u679a\u4e3e\u4e24\u6392\u5217\u7b2c\u4e00\u4f4d\u4e0d\u540c\u7684\u4f4d\u7f6e\u3002  \n\u56e0\u4e3a\u9700\u8981\u7edf\u8ba1\u7684\u6392\u5217\u5b57\u5178\u5e8f\u6bd4\u7ed9\u5b9a\u6392\u5217\u5c0f\uff0c\u6240\u4ee5\u5f53\u524d\u8fd9\u4f4d\u6709 $\\sum_{i=w+1}^n[a_i<a_w]$ \u79cd\u65b9\u6848\u6570\u3002  \n\u5305\u62ec\u5f53\u524d\u8fd9\u4e2a\u5143\u7d20\u968f\u673a\u4e71\u6392\u7684\u65b9\u6848\u6570\u4e3a $\\frac{(n-w+1)!}{\\prod cnt!}$\uff0c\u8fd9\u4e2a\u516c\u5f0f\u662f `\u6709\u91cd\u590d\u5143\u7d20\u7684\u6392\u5217\u95ee\u9898` \u7684\u7ed3\u8bba\u3002  \n\u53ef\u60dc\u5f53\u524d\u8fd9\u4e2a\u5143\u7d20\u53d6\u503c\u6709\u9650\u5236\uff0c\u53ea\u6709 $\\sum_{i=w+1}^n[a_i<a_w]$ \u79cd\u53d6\u503c\u53ef\u4ee5\u53d6\u3002  \n\u6240\u4ee5\u5f53\u524d\u8fd9\u4f4d\u7b54\u6848\u5373\u4e3a $\\frac{(n-w+1)!}{\\prod cnt!}\\times\\frac{\\sum_{i=w+1}^n[a_i<a_w]}{n-w+1}=\\frac{(n-w)!}{\\prod cnt!}\\times\\left(\\sum_{i=w+1}^n[a_i<a_w]\\right)$  \n\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\uff0c\u6ce8\u610f\u503c\u57df\u4e0d\u5927\uff0c$\\sum_{i=w+1}^n[a_i<a_w]$ \u53ef\u4ee5\u76f4\u63a5\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002  \n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002  \n\n\u6ce8\u610f\u8fd9\u9898\u6a21\u6570\u4e0d\u4e00\u5b9a\u662f\u8d28\u6570\uff0c\u4e0d\u4e00\u5b9a\u6709\u9006\u5143\u3002  \n\u6240\u4ee5\u6211\u4eec\u9700\u8981\u53c2\u8003[\u8fd9\u9898](https://www.luogu.com.cn/problem/CF1109E)\u7684\u601d\u8def\uff0c\u6c42\u51fa $P$ \u7684\u6240\u6709\u8d28\u56e0\u6570\uff0c\u7136\u540e\u5f00\u6876\u7edf\u8ba1\u4ed6\u4eec\u3002  \n\u5176\u4ed6\u7684\u56e0\u6570\u548c $P$ \u4e92\u8d28\uff0c\u6240\u4ee5\u53ef\u4ee5 excrt \u6216\u8005 \u6b27\u62c9\u5b9a\u7406 \u5373\u53ef\u3002  \n\u672c\u7bc7\u9898\u89e3\u7528\u7684 \u6b27\u62c9\u5b9a\u7406\u3002  \n\n### Attention.\n[\u5176\u4ed6\u9898\u89e3\u5168\u90e8 UB](https://www.luogu.com.cn/discuss/show/311351?page=2) \u662f\u600e\u4e48\u56de\u4e8b\u5462\uff1f\u4e0b\u9762\u5c31\u8ba9\u5c0f\u7f16\u5e26\u5927\u5bb6\u4e00\u8d77\u4e86\u89e3\u5427\u3002  \n\u6b38\uff0c\u53ef\u4ee5\u8bc1\u660e\u8fd9\u4e2a $\\frac{(n-w)!}{\\prod cnt!}\\times\\left(\\sum_{i=w+1}^n[a_i<a_w]\\right)$ \u80af\u5b9a\u662f\u6574\u6570\u3002  \n\u4f46\u662f\u8fd9\u4e0d\u7b49\u4e8e $\\frac{(n-w)!}{\\prod cnt!}$ \u5c31\u4e00\u5b9a\u662f\u6574\u6570\u4e86\uff0c\u5176\u4ed6\u9898\u89e3\u5c31\u9ed8\u8ba4\u6709\u4fdd\u8bc1\u8fd9\u70b9\u7136\u540e\u5c31\u4f1a\u8ba1\u7b97\u8d1f\u6307\u6570\u3002  \n\u6240\u4ee5\u4ed6\u4eec\u7684\u4e0b\u6807\u76f4\u63a5\u8d8a\u754c\uff0c\u7136\u540e\u5c31 ![](//xn--9zr.tk/xk) \u4e86\u3002  \n\u5176\u5b9e\u5c0f\u7f16\u521a\u5f00\u59cb\u5199\u8fd9\u9898\u65f6\u4e5f\u5ffd\u7565\u4e86\u8fd9\u70b9\uff0c\u4e0d\u8fc7\u5c0f\u7f16\u5199\u5730\u5feb\u901f\u5e42\u6240\u4ee5\u4f1a TLE \u7136\u540e\u770b\u4e86\u534a\u5929 ![](//xn--9zr.tk/xk)  \n\u5927\u5bb6\u53ef\u80fd\u4f1a\u5f88\u60ca\u8bb6\u6240\u6709\u9898\u89e3\u4e3a\u4ec0\u4e48\u5168\u90fd UB \u4e86\u5462\uff1f\u5c0f\u7f16\u4e5f\u5f88\u60ca\u8bb6\uff0c\u4f46\u4e8b\u5b9e\u5c31\u662f\u8fd9\u6837\u3002  \n\u8fd9\u5c31\u662f\u5173\u4e8e\u8fd9\u9053\u9898\u7684\u4e8b\u60c5\u4e86\uff0c\u5927\u5bb6\u6709\u4ec0\u4e48\u60f3\u6cd5\u5462\uff0c\u6b22\u8fce\u5728\u8bc4\u8bba\u533a\u544a\u8bc9\u5c0f\u7f16\u4e00\u8d77\u8ba8\u8bba\u54e6\uff01  \n\n### Coding.\n\u611f\u89c9\u6ca1\u5565\u597d\u89e3\u91ca\u7684\uff0cAttention \u4e2d\u7684\u4e1c\u897f\u653e\u5230\u6ce8\u91ca\u91cc\u53bb\u4e86\n```cpp\n//\u662f\u554a\u2026\u2026\u4f60\u5c31\u662f\u90a3\u53ea\u9b3c\u4e86\u2026\u2026\u6240\u4ee5\u88ab\u4f60\u78b0\u5230\u4ee5\u540e\uff0c\u5c31\u8f6e\u5230\u6211\u53d8\u6210\u9b3c\u4e86{{{\n#include<bits/stdc++.h>\nusing namespace std;typedef long long ll;\ntemplate<typename T>inline void read(T &x)\n{\n\tx=0;char c=getchar(),f=0;\n\tfor(;c<'0'||c>'9';c=getchar()) if(c=='-') f=1;\n\tfor(;c>='0'&&c<='9';c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\tif(f) x=-x;\n}/*}}}*/\nint n,P,a[300005],T[300005],mx,p[15],pc,ph,rs[300005],tp[15],tc=1,cnt[300005],iv[300005];\ninline int ksm(int x,int q=ph-1) {int r=1;for(;q;q>>=1,x=1ll*x*x%P) if(q&1) r=1ll*r*x%P;return r;}\ninline void add(int x) {for(;x<=mx;x+=x&(-x)) ++T[x];}\ninline int qry(int x) {int r=0;for(;x;x-=x&(-x)) r+=T[x];return r;}\ninline void TIM(int w,int &tc,int *tp) {for(int i=1;i<=pc;i++) while(w%p[i]==0) w/=p[i],tp[i]++;tc=1ll*tc*w%P;}\ninline void DIV(int w,int &tc,int *tp) {for(int i=1;i<=pc;i++) while(w%p[i]==0) w/=p[i],tp[i]--;tc=1ll*tc*iv[w]%P;}\ninline int CAL(int tc,int *tp) {int r=tc;for(int i=1;i<=pc;i++) r=1ll*r*ksm(p[i],tp[i])%P;return r;}\nint main()\n{\n\tread(n),read(P);int nt=ph=P;for(int i=1;i<=n;i++) read(a[i]),mx=max(mx,a[i]);\n\tfor(int i=2;i*i<=nt;i++) if(nt%i==0) {p[++pc]=i,ph=ph/i*(i-1);while(nt%i==0) nt/=i;}\n\tint rs=0;add(a[n]),iv[1]=1,cnt[a[n]]++;if(nt^1) p[++pc]=nt,ph=ph/nt*(nt-1);\n\tfor(int i=n-1;i;i--)\n\t{\n\t\tint w=qry(a[i]-1);TIM(n-i,tc,tp),add(a[i]),iv[n-i+1]=ksm(n-i+1);\n\t\tDIV(++cnt[a[i]],tc,tp);if(!w) continue;\n\t\t//\u8fd9\u91cc\u5c31\u662f\u4e0a\u9762 Attention \u4e2d\u7684\u5185\u5bb9\uff0c\u5fc5\u987b\u5148\u628a w \u4e58\u4e0a\u540e\u518d\u8ba1\u7b97\u7b54\u6848\n\t\tTIM(w,tc,tp),rs=(rs+1ll*CAL(tc,tp))%P,DIV(w,tc,tp);\n\t}\n\t//cerr<<clock()*1.0/CLOCKS_PER_SEC<<endl;\n\treturn printf(\"%d\\n\",(rs+1)%P),0;\n}\n```",
        "postTime": 1618541712,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "P3477 [POI2008]PER-Permutation \uff08\u9898\u89e3\uff09"
    },
    {
        "content": "\u9898\u610f\u662f\u6c42\u51fa\u4e00\u4e2a\u591a\u91cd\u96c6\u4e0b\u4e00\u4e2a\u6392\u5217\u7684\u6392\u540d\u3002  \n\u5bb9\u6613\u60f3\u5230\u679a\u4e3e\u5168\u6392\u5217\uff0c\u4f46\u662f\u663e\u7136\u4e0d\u591f\u4f18\u79c0\u3002  \n\u53d1\u73b0\u6240\u6c42\u7b49\u4ef7\u4e8e\u591a\u91cd\u96c6\u4e0b\u7684\u5eb7\u6258\u5c55\u5f00\uff0c\u6545\u8003\u8651\u5bf9\u539f\u5f0f\u5b50\u8fdb\u884c\u53d8\u5f62\uff1a  \n$$1+\\sum_{i=1}^N{(n-i)!\\cdot \\sum_{j=i+1}^Na[j]<a[i]}$$  \n\u4e0a\u9762\u7684\u610f\u601d\u662f\u679a\u4e3e $i$\uff0c\u8868\u793a\u524d\u9762\u4f4d\u7f6e\u6cbf\u7528\uff0c\u5f53\u524d\u4f4d\u7f6e\u5bfb\u627e\u66f4\u5c0f\u7684\u53bb\u66ff\u4ee3\uff0c\u518d\u540e\u9762\u968f\u4fbf\u4e71\u586b\u3002  \n\u4e3a\u4e86\u5e94\u5bf9\u4ea7\u751f\u7684\u6539\u53d8\uff0c\u53ef\u4ee5\u9664\u6389\u4e00\u4e2a\u6570\u8fdb\u884c\u53bb\u91cd\uff1a  \n\u53d1\u73b0\u76f8\u540c\u7684\u6570 $x$ \u5171\u6709 $cnt[x]!$ \u79cd\u6392\u5217\u65b9\u6cd5\uff0c\u4f46\u662f\u53ea\u7b97\u6210\u4e00\u79cd\u6392\u5217\u3002  \n\u4f46\u76f8\u540c\u6570\u5728\u524d\u9762\u7684\u4e0d\u7b97\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u52a8\u6001\u7ef4\u62a4\u4e00\u4e2a $cnt$  \n\u56e0\u6b64\u7b54\u6848\u4e3a\uff1a  \n$$1+\\sum_{i=1}^N\\frac{(n-i)!\\sum_{j=i+1}^Na[j]<a[i]}{enum_{i+1}^N:\\sum cnt[x]!}$$  \n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u6a21\u6570\u53ef\u80fd\u662f\u5408\u6570\uff0c\u9700\u8981\u7279\u6b8a\u7684\u64cd\u4f5c\uff1a  \n\u6211\u4eec\u53d1\u73b0\u8f83\u5927\u7684\u6570\u53ef\u4ee5\u7528\u51e0\u4e2a\u6570\u7684\u8d28\u56e0\u5b50\u552f\u4e00\u8868\u793a\uff0c\u4f46\u662f\u8d28\u56e0\u5b50\u6570\u592a\u591a\uff0c\u7136\u800c\u6a21\u6570\u56fa\u5b9a\u4e14\u8d28\u56e0\u5b50\u6570\u5c11\uff0c\u6545\u8f83\u5927\u7684\u6570\u53ef\u4ee5\u5206\u89e3\u6210\u6a21\u6570\u6240\u5305\u542b\u7684\u8d28\u56e0\u5b50\u4e0e\u4f59\u9879\u7684\u4e58\u79ef\u3002  \n\u6240\u4ee5\uff1a  \n1. \u7ef4\u62a4\u4e00\u4e2a\u957f\u5ea6 $10$ \u7684\u6570\u7ec4\uff0c\u6a21\u6570\u5206\u89e3\u8d28\u56e0\u5b50\u3002\n2. \u4ee5\u4e0b\u7684\u6570\u540c\u6837\u5206\u89e3\u8d28\u56e0\u5b50\uff0c\u7528\u957f $10$ \u7684\u6570\u7ec4\u8868\u793a\uff0c$0$ \u4e0b\u6807\u4e3a\u4f59\u9879\u79ef\uff08\u53ef\u4ee5\u53d6\u6a21\uff09\u521d\u59cb\u5316\u4e3a $1$\uff0c\u5176\u5b83\u4e0b\u6807\u4e3a\u8be5\u8d28\u56e0\u5b50\u7684\u4e2a\u6570\uff08\u8fd9\u4e2a\u53d6\u6a21\u5f53\u4e14\u4ec5\u5f53\u80fd\u591f\u8986\u76d6\u6574\u4e2a\u6a21\u6570\uff0c\u56e0\u6b64\u201c\u5206\u89e3\u6a21\u6570\u65f6\u8bb0\u5f55\u4e2a\u6570\uff0c\u6c42\u503c\u65f6\u5206\u522b\u7528\u4e2a\u6570\u53d6\u6a21\u201d\u7684\u601d\u8def\u662f\u9519\u8bef\u7684-\uff09\u3002  \n3. \u5b9a\u4e49\u4e58\u9664\u64cd\u4f5c\uff0c\u975e $0$ \u4e0b\u6807\u76f4\u63a5\u52a0\u51cf\uff0c\u4f59\u9879\u76f4\u63a5\u4e58\uff0c\u9664\u6cd5\u7528exgcd\u9006\u5143\u3002  \n4. \u5b9a\u4e49\u6c42\u503c\u64cd\u4f5c\uff1a\u5feb\u901f\u5e42\u6389\u975e\u96f6\u9879\uff0c\u6700\u540e\u4e58\u4e0a\u4f59\u9879\u5c31\u53ef\u4ee5\u4e86\uff08\u4e2d\u95f4\u5141\u8bb8\u53d6\u6a21-\uff09\u3002  \n\n\u5173\u4e8e\u4e3b\u51fd\u6570\u91cc\u600e\u4e48\u5199\uff1a  \n\u9884\u5904\u7406\u51fa $1$ \u81f3 $maxn$ \u9636\u4e58\uff0c\u8ba1\u7b97cnt\u6570\u7ec4\u548c $\\frac{1}{\\sum cnt[x]!}$\uff0c\u4ee5\u53ca\u5b58\u50a8\u8f93\u5165\u5e8f\u5217\u7684\u6743\u503c\u6811\u72b6\u6570\u7ec4\u3002  \n\u987a\u5e8f\u626b\u63cf\u6bcf\u4e2a\u6570\uff0c\u7528\u524d\u9762\u63d0\u5230\u7684\u4e58\u9664\u64cd\u4f5c\u66f4\u65b0cnt\u548c\u6811\u72b6\u6570\u7ec4\uff0c\u8fdb\u800c\u8ba1\u7b97\u51fa\u7b54\u6848\uff08\u5982\u679c\u4e0d\u9010\u6b65\u5730\u63a8\u4f1a\u8d85\u65f6\uff09\u3002  \n\u4ee3\u7801\u91cc\u6709\u5f88\u591a\u5197\u4f59\u64cd\u4f5c\uff0c\u671b\u8c05\u89e3\u3002  \n```cpp\n//g++ -g k.cpp -o k -std=c++14 -O0 -Wall\n#include<iostream>\n#include<cstdio>\n#define LL long long\nusing namespace std;\nconst int maxn=3e5+10,maxm=15;\nint N,mod,jc[maxn][maxm],fm[maxm][2],mtop=0,a[maxn],ft[maxn],cnt[maxn],ans=0;\nint qd(){\n\tint rt=0;char c=getchar();\n\twhile(c<'0'||c>'9')  c=getchar();\n\twhile('0'<=c&&c<='9')  rt=(rt<<3)+(rt<<1)+c-48,c=getchar();\n\treturn rt;\n}\n#define lowbit(t) (t&-(t))\nvoid change(int t,int v){for(;t<maxn;t+=lowbit(t))  ft[t]+=v;}\nint ask(int t){int rt=0;for(;t;t-=lowbit(t))  rt+=ft[t];return rt;}\nLL qsm(LL x,int y){\n\tLL rt=1;\n\tfor(;y;y>>=1,x=x*x%mod)  if(y&1)  rt=rt*x%mod;\n\treturn rt;\n}\nvoid exgcd(LL a,LL b,LL &x,LL &y){\n\tif(!b){x=1,y=0;return;}\n\texgcd(b,a%b,x,y);LL _x=x;\n\tx=y,y=_x-a/b*y;\n}\nLL ni(int t){LL x,y;exgcd(t,mod,x,y);/*printf(\"ni %d = %lld\\n\",t,x);*/return (x%mod+mod)%mod;}\nvoid calc1(int _a[],int _b[]){_a[0]=1LL*_a[0]*_b[0]%mod;for(int i=1;i<=mtop;i++)  _a[i]+=_b[i];}\nvoid calc1(int _a[],int x){\n\tfor(int i=1;i<=mtop;i++)  while(x&&x%fm[i][0]==0)  x/=fm[i][0],_a[i]++;\n\t_a[0]=1LL*_a[0]*x%mod;\n}\nvoid calc2(int _a[],int _b[]){\n\tfor(int i=1;i<=mtop;i++)  _a[i]-=_b[i];\n\t_a[0]=_a[0]*ni(_b[0])%mod;\n}\nvoid calc2(int _a[],int x){\n\tfor(int i=1;i<=mtop;i++)  while(x&&x%fm[i][0]==0)  x/=fm[i][0],_a[i]--;\n\t_a[0]=_a[0]*ni(x)%mod;\n}\nLL calc0(int _a[]){\n\tLL rt=_a[0];\n\tfor(int i=1;i<=mtop;i++)  rt=rt*qsm(fm[i][0],_a[i])%mod;\n\treturn rt;\n}\nint main(){\n//\tfreopen(\"in.txt\",\"r\",stdin);\n\tN=qd(),mod=qd();int _x=mod;\n\tfor(int i=2;i*i<=_x;i++){\n\t\tif(_x%i==0)  fm[++mtop][0]=i;\n\t\twhile(_x%i==0)  fm[mtop][1]++,_x/=i;\n\t}if(_x-1)  fm[++mtop][0]=_x,fm[mtop][1]=1;\n\tjc[0][0]=1;for(int i=1;i<=N;i++){for(int j=0;j<=mtop;j++)  jc[i][j]=jc[i-1][j];calc1(jc[i],i);}\n\tfor(int i=1;i<=N;i++)  change(a[i]=qd(),1),cnt[a[i]]++;\n\tint prod[10]={1};calc1(prod,jc[N-1]);\n\tfor(int i=1;i<maxn;i++)  if(cnt[i]>1)  calc2(prod,jc[cnt[i]]);\n\tfor(int i=1;i<=N;i++){\n\t\tchange(a[i],-1);int x=ask(a[i]-1);\n\t\tif(x){/*printf(\"i=%d x=%d prod=%lld \\n\",i,x,calc0(prod));*/calc1(prod,x);ans=(ans+calc0(prod))%mod;calc2(prod,x);}\n\t\tcalc1(prod,cnt[a[i]]--);calc2(prod,N-i);\n\t}\n\tprintf(\"%d\\n\",(ans+1)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1661324266,
        "uid": 142549,
        "name": "hbhz_zcy",
        "ccfLevel": 0,
        "title": "solution-p3477"
    },
    {
        "content": "## \u603b\u4f53\u601d\u8def\n\n\u4ece1\u5f00\u59cb\u5411\u540e\u679a\u4e3e\uff0c\u4f9d\u6b21\u56fa\u5b9a\u4f4f\u6bcf\u4e00\u4f4d\u770b\u540e\u9762\u7684\u80fd\u7ec4\u5408\u51fa\u591a\u5c11\u79cd\u65b9\u6848\uff08\u56e0\u4e3a $2xxxx$ \u4e00\u5b9a\u6bd4 $1xxxx$ \u5927\uff09\uff0c\u518d\u4e58\u4e0a\u540e\u9762\u5c0f\u4e8e\u5b83\u7684\u6570\u7684\u6570\u91cf\uff0c\u6700\u540e\u518d\u9664\u4ee5\u5176\u540e\u6240\u6709\u6570\u5b57\u6570\u91cf\u7684\u9636\u4e58\u7684\u8fde\u4e58\u5c31\u884c\u4e86\uff08\u6211\u4e0d\u77e5\u9053\u5565\u53eb\u5eb7\u6258\u5c55\u5f00\uff09\u3002\n\n\u7531\u6b64\u5f97\u5230\u5f0f\u5b50\uff1a$\\frac{fac[n-i]\\times xs}{s}$\n\n\u5176\u4e2d $s=\u220f ^{i}_{n} fac[\\ num[a[j]\\ ]\\ ]$\n\n\u800c\u5176\u4e2d $xs$ \u662f\u4ece $n-i+1$ \u5230 $n$ \u4e2d\u5c0f\u4e8e $a[i]$ \u7684\u4e2a\u6570\u3002\n\n\u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0b $s$ \u7684\u542b\u4e49\uff1a\n\n\u56e0\u4e3a\u9898\u610f\u662f\u4e0d\u91cd\u590d\u7684\u6392\u5217\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u53bb\u91cd\uff0c**\u800c $i$ \u53ca\u5176\u4e4b\u540e\u6240\u6709\u91cd\u590d\u6570\u5b57\u7684\u6570\u91cf\u5168\u6392\u5217\u4e4b\u79ef\uff0c\u5c31\u662f\u53bb\u91cd\u6240\u9700\u9664\u53bb\u7684**\uff0c\u8fd9\u5f88\u597d\u89e3\u91ca\uff0c\u56e0\u4e3a\u6211\u4eec\u5728\u76f4\u63a5\u7b97\u5168\u6392\u5217\u7684\u65f6\u5019\uff0c\u628a\u8fd9\u4e9b\u91cd\u590d\u6570\u5b57\u81ea\u5df1\u7684\u6392\u5217\u4e5f\u7b97\u8fdb\u53bb\u4e86\uff0c\u56e0\u6b64\u6211\u4eec\u4f9d\u7167\u5206\u6b65\u6c42\u65b9\u6848\u6570\u7684\u539f\u5219\u628a\u5b83\u4eec\u7684\u79ef\u9664\u53bb\u5c31\u884c\u4e86\u3002\u800c $xs$ \u4e2d\u53ef\u80fd\u4e5f\u6709\u91cd\u590d\u51e0\u4e2a\u6570\u5b57\u7684\uff0c\u4ed6\u4eec\u4f1a\u4e0e $s$ \u4e2d\u91cd\u590d\u7684\u76f8\u540c\u6570\u5b57\u6d88\u6389\uff0c\u4f7f\u4e4b\u53bb\u91cd\u3002\u800c\u5728\u505a\u9898\u4e2d\u4e3a\u4e86\u65b9\u4fbf\uff0c$s$ \u5b58\u50a8\u7684\u662f\u9006\u5143\u5f62\u5f0f\u3002\n\n\u81f3\u4e8e $xs$ \u5c31\u53ef\u4ee5\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u6765\u7ef4\u62a4\u3002\n\n$m$ \u672a\u5fc5\u4e3a\u8d28\u6570\uff0c\u4e5f\u672a\u5fc5\u4e0e\u5206\u6bcd\u4e92\u8d28\uff0c\u672a\u5fc5\u6709\u9006\u5143\u3002\n\n\u800c\u4e00\u5207\u6574\u6570\u90fd\u80fd\u62c6\u6210 $p_1^{k_1}\\times p_2^{k_2}\u2026\u2026p_x^{k_x}$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u628a $m$ \u4e5f\u5982\u6b64\u62c6\u5f00\uff0c\u5206\u522b\u8ba9\u539f\u7b54\u6848\u5bf9 $p_1^{k_1},p_2^{k_2}\u2026\u2026,p_x^{k_x}$ \u53d6\u6a21\uff0c\u7531\u6b64\u6784\u5efa\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u7684\u65b9\u7a0b\u7ec4\uff0c\u4e4b\u540e\u5408\u5e76\u6c42\u89e3\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u800c\u5728\u53d6\u6a21\u7684\u65f6\u5019\u6709\u53ef\u80fd\u56e0\u4e3a\u5206\u6bcd\u548c\u6a21\u6570\u4ecd\u7136\u4e0d\u4e92\u8d28\u800c\u5bfc\u81f4\u6c42\u4e0d\u51fa\u9664\u6570\u7684\u9006\u5143\uff0c\u6240\u4ee5\u53c2\u8003\u6269\u5c55\u5362\u5361\u65af\u5b9a\u7406\u7684\u5e94\u5bf9\u65b9\u6cd5\uff0c\n\n**\u5c31\u662f\u9762\u5bf9 $n! \\mod p^k$  \uff0c\u7528 $n!$  \u9664\u5c3d $p$ \u518d\u53d6\u6a21\u5f97\u5230$\\frac{n!}{p^a} \\mod p^k$ \u6700\u540e\u518d\u628a\u63d0\u51fa\u6765\u7684 $p$ \u4e58\u8fdb\u53bb(\u5373\u4e58$Pow(p,cnt)$)\u5c31\u884c\u4e86\u3002**\n\n\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u770b\u770b[\u8fd9\u7bc7\u535a\u5ba2](https://blog.csdn.net/hqddm1253679098/article/details/82897638)\u3002\n\n\u4e3a\u4e86\u9632\u6b62 $TLE$\uff0c\u53ef\u4ee5\u76f4\u63a5\u7ebf\u6027\u9884\u5904\u7406\uff0c\u5229\u7528\u9012\u63a8\u5173\u7cfb\u6c42\u51fa\u5bf9\u4e8e\u6240\u6709\u9636\u4e58\u7684\u5e94\u5bf9\u65b9\u5f0f\uff08\u5373\u6240\u6709 $n$ \u7684 $\\frac{n!}{p^a} \\mod p^k$\uff09,\u5177\u4f53\u89c1\u4ee3\u7801\u3002\n\n\n\u53e6\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u4ece $s$ \u4e2d\u6d88\u9664\u672c\u4f4d\u5f71\u54cd\u7684\u95ee\u9898\uff0c\u5f53\u6211\u4eec\u8fd9\u4e00\u4f4d\u7684\u95ee\u9898\u89e3\u51b3\u4e86\u800c\u524d\u5f80\u4e0b\u4e00\u4f4d\u7684\u65f6\u5019\uff0c\u90a3\u91cd\u590d\u7684\u672c\u4f4d\u6570\u5b57\u5c31\u4f1a\u5c11 $1$ \uff0c\u5982\u679c $num[i]>=2$ \u5e94\u5f53\u4ece $s$ \u4e2d\u5148\u628a $inv[\\ fac[\\ num[i]\\ ]\\ ]$ \u7684\u5f71\u54cd\u6d88\u9664\uff0c\u518d\u4e58\u4e0a $inv[\\ fac[\\ num[i]-1\\ ]\\ ]$ \u3002\u800c\u6d88\u9664\u81ea\u7136\u8981\u9664\u4ee5 $inv[\\ fac[\\ num[i]\\ ]\\ ]$ \uff0c\u8fd9\u65f6\u5019\u6211\u53d1\u73b0\u4e86\u67d0\u6570\u9006\u5143\u7684\u9006\u5143\u662f\u5176\u672c\u8eab\u7684\u9053\u7406\uff0c$So$\u6d88\u9664\u65f6\u76f4\u63a5\u4e58\u4e0a $fac[num[i]]$ \u5c31\u884c\u4e86\u3002\n\n\u53e6\u5916\u5c31\u6700\u540e\u4e58 $Pow(p,cnt)$ \u65f6\uff0c\u4e0d\u80fd\u4ece\u5934\u518d\u6765\u7b97\uff0c$cnt$ \u5728\u672c\u4f4d\u7ed3\u675f\u540e\u4e5f\u8981\u6d88\u9664 $num[i]$ \u5f71\u54cd\u5e76\u4ea7\u751f\u65b0\u7684 $num[i]-1$ \u4e0b\u7684 $cnt$ \uff0c\u8fd9\u6837\u6bcf\u6b21\u53ea\u8981\u91cd\u65b0\u8ba1\u7b97 $fac[n-i]$ \u7684 $cnt$ \u5c31\u53ef\u4ee5\u4e86\u3002\u4f46\u662f\u6211\u53d1\u73b0\u8fd9\u4e2a\u8fc7\u7a0b\u8fd8\u4f1a TLE\uff0c\u56e0\u6b64\u6211\u5c31\u628a $Pow(p,cnt)$ \u4e2d\u4ece\u4e00\u5230\u4e09\u5343\u7684 $cnt$ \u90fd\u7ebf\u6027\u9012\u63a8\u9884\u5904\u7406\u51fa\u6765\u4e86\uff0c\u6bd5\u7adf $cnt$ \u4e0d\u592a\u53ef\u80fd\u5230 $3000$ \uff0c\u7136\u540e\u5c31 AC \u4e86\uff01\n\n## \u4ee3\u7801\n\n```cpp\n\n\n#include<bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nll c[500000];\nll a[500000];\nll as[500000];\nll b[500000];\nll d[500000];\nll num[500000];\nll f[500000];\nll m[500000];//pk\nll mo[500000];//p\nll fu[500000];\nll n,mk;\nll maxn;\nll tot;\nll phi[500000];\nll s; \nll cnt;\nll mu[500000];\nll Pows[500000];\nll Pow(ll a,ll b,const ll p=LLONG_MAX)\n{\n\tll ans=1;\n\twhile(b)\n\t{\n\t\tif(b&1)\n\t\t\tans=ans*a%p;\n\t\ta=a*a%p;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nll di=1;\nll div(ll n)\n{\n\tll tmp=mk; tot=0;\n    for (ll i=2;1ll*i*i<=tmp;i++) if (tmp%i==0)\n    {\n        mo[++tot]=i; m[tot]=1;\n        while (tmp%i==0) tmp/=i,m[tot]*=i;\n    }\n    if (tmp>1) mo[++tot]=tmp,m[tot]=tmp;\n    for (ll i=1;i<=tot;i++) phi[i]=m[i]-m[i]/mo[i];\n}\nll lowbit(ll x)\n{\n\treturn x&(-x);\n}\nvoid update(ll x,ll val)\n{\n\twhile(x<=maxn)\n\t{\n\t\tc[x]+=val;\n\t\tx+=lowbit(x);\n\t}\n}\nll query(ll x)\n{\n\tll ans=0;\n\twhile(x>0)\n\t{\n\t\tans+=c[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn ans;\n} \nll fac(ll n,ll p,ll pk)\n{\n\tif(!n)return 1;\n\tll ans=1;\n\tfor(ll i=1;i<pk;i++)\n\t\tif(i%p)\n\t\t\tans=ans*i%pk;\n\tans=Pow(ans,n/pk,pk);\n\tfor(ll i=1;i<=n%pk;i++)\n\t\tif(i%p)\n\t\t\tans=ans*i%pk;\n\treturn ans*fac(n/p,p,pk)%pk;\n}\nll inv(ll x,ll p)\n{\n\treturn Pow(x,phi[p]-1,m[p]);\n}\nvoid exgcd(ll a,ll b,ll &x,ll &y)\n{\n\tif(!b)\n\t\tx=1,y=0;\n\telse\n\t{\n\t\texgcd(b,a%b,y,x);\n\t\ty-=x*(a/b);\n\t}\n}\nll CRT(ll k)\n{\n\tll ANS=0,lcm=1,x,y;\n\tfor(ll i=1;i<=k;++i)\n\t\tlcm*=m[i];\n\tfor(ll i=1;i<=k;++i)\n\t{\n\t\tll M=lcm/m[i];\n\t\texgcd(M,m[i],x,y);\n\t\tx=(x%m[i]+m[i])%m[i];\n\t\tANS=(ANS+M*x*as[i])%lcm;\n\t}\n\treturn (ANS+lcm)%lcm;\n}\nint main()\n{\n\tscanf(\"%lld%lld\",&n,&mk);\n\tdiv(mk);\n\tfor(ll i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld\",&a[i]);\n\t\tb[i]=a[i];\n\t}\n\tsort(b+1,b+n+1);\n\tll len=unique(b+1,b+n+1)-b-1;\n\tfor(ll i=1;i<=n;i++)\n\t\t{\n\t\t\ta[i]=lower_bound(b+1,b+len+1,a[i])-b;\n\t\t\tmaxn=max(maxn,a[i]);\n\t\t\tnum[a[i]]++;\t\n\t\t}\n\tfor(ll i=1;i<=n;i++)update(a[i],1);\n\tfor(ll i=1;i<=maxn;i++)\n\t{\n\t\tmu[i]=c[i];\n\t\tfu[i]=num[i];\n\t}\n\tll TJ=0;\n\tfor(ll k=1;k<=tot;k++)\n\t{\n\t\tll bnum=0;\n\t\tfor(ll i=1;i<=maxn;i++)\n\t\t{\n\t\t\tc[i]=mu[i];\n\t\t\tnum[i]=fu[i];\n\t\t\tbnum=max(num[i],bnum);\n\t\t}\n\t\ts=1;\n\t\tcnt=0;\n\t\tf[0]=1;\n\t\tfor(ll i=1;i<=n;i++)\n\t\t{\n\t\t\tll x=i;\n\t\t\twhile(x%mo[k]==0)x/=mo[k];\n\t\t\tf[i]=(f[i-1]%m[k])*(x%m[k])%m[k];\n\t\t}\n\t\tfor(ll i=1;i<=maxn;i++)\n\t\t{\n\t\t\ts=s*inv(f[num[i]],k)%m[k];\n\t\t\tfor(ll j=num[i];j;j/=mo[k])\n\t\t\t\tcnt-=j/mo[k];\n\t\t}\n\t\tPows[0]=1;\n\t\tfor(int i=1;i<=3000;i++)\n\t\t{\n\t\t\tPows[i]=ll((Pows[i-1]%m[k])*(mo[k]%m[k]))%m[k];\n\t\t}\n\t\tll ans=0;\n\t\tfor(ll i=1;i<=n;i++)\n\t\t{\n\t\t\tll xs=query(a[i]-1);\n\t\t\tll ys=f[n-i];\n\t\t\tfor(ll j=n-i;j;j/=mo[k])\n\t\t\t\tcnt+=j/mo[k];\n\t\t\tll res=ll((ys%m[k])*(s%m[k]))%m[k];\n\t\t\tres=ll((res%m[k])*(Pows[cnt]%m[k]))%m[k];\n\t\t\tres=ll((res%m[k])*(xs%m[k]))%m[k];\n\t\t\tas[k]=(as[k]%m[k] + res%m[k])%m[k];\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t              update(a[i],-1);\n\t\t\tfor(ll j=n-i;j;j/=mo[k])\n\t\t\t\tcnt-=j/mo[k];\t\n\t\t\tif(num[a[i]]>=2)\n\t\t\t{\n\t\t\t\ts=s*f[num[a[i]]];\n\t\t\t\tfor(ll j=num[a[i]];j;j/=mo[k])\n\t\t\t\t\tcnt+=j/mo[k];\n\t\t\t\ts=(s%m[k])*(inv(f[num[a[i]]-1],k)%m[k])%m[k];\n\t\t\t\tnum[a[i]]--;\n\t\t\t\tfor(ll j=num[a[i]];j;j/=mo[k])\n\t\t\t\t\tcnt-=j/mo[k];\n\t\t\t}\n\t\t}\n \t}\n \tll ANS=CRT(tot)+1;\n\tcout<<ANS%mk<<endl;\n}\n```\n",
        "postTime": 1661001783,
        "uid": 578261,
        "name": "liangchenming",
        "ccfLevel": 0,
        "title": "P3477\u9898\u89e3"
    },
    {
        "content": "\u5bf9$O(nlogn)$\u7684\u505a\u6cd5\u594b\u6218\u6700\u540e\u987a\u5229bzoj\u548c\u6d1b\u8c37rk1\uff0c\u505a\u6cd5\u548ccls\u7684\u57fa\u672c\u4e00\u6837\n\n\u9996\u5148\u5982\u679cm\u4e3a\u8d28\u6570\u5c31\u662f\u9053\u7b80\u5355\u9898\uff0c\u9010\u4f4d\u8003\u8651\uff0c\u8bbe$now_j$\u4e3a\u540e\u7f00\u4e2dj\u7684\u6b21\u6570\n\n$$\nans(k)=ans(k+1)+\\frac{(n-k)!}{\\prod_j now_j!}(\\sum_j now_j)\n$$\n\n\u4e00\u5f00\u59cb\u7528\u6811\u72b6\u6570\u7ec4\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u6570\u540e\u9762\u66f4\u5c0f\u7684\u6570\u5b57\u548c\uff0c\u8fd9\u6837\u5c31\u662f$O(nlogn)$\u7684\n\n\u73b0\u5728m\u6bd4\u8f83\u4e00\u822c\uff0c\u53ef\u4ee5\u6709\u5f88\u591a\u79cd\u5904\u7406\u65b9\u6cd5\uff0c\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u6700\u76f4\u63a5\u81ea\u7136\u7684CRT\uff0c\u8bbe\u5f53\u524d\u6a21\u6570\u4e3a$d^k$\uff0c\u90a3\u4e48\u56e0\u4e3a\u6709\u9636\u4e58\u9664\u6cd5\u9700\u8981\u628ad\u63d0\u51fa\u6765\u7b97\n\n\u4e0d\u59a8\u641e\u4e2a\u4e8c\u5143\u7ec4$(a,b)=a+d^b$\uff0c\u628a\u9636\u4e58\u4e4b\u7c7b\u7684\u7528\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u641e\uff0c\u5b9a\u4e49\u4e00\u4e0b\u4e58\u9664\u6cd5\u5c31\u597d\u4e86\uff0c\u7f51\u4e0a\u4e5f\u57fa\u672c\u4e0a\u662f\u8fd9\u6837\uff0c\u7136\u800c\u590d\u6742\u5ea6\u8fd8\u662flog\u65b9\uff0c\u4e3b\u8981\u662f\u6c42\u9006\u5143\u7684\u95ee\u9898\u3002\n\ncls\u7528\u7684\u662f\u7ebf\u6027\u9012\u63a8\u9006\u5143\uff0c\u8fd9\u6211\u4e0d\u662f\u5f88\u7406\u89e3\u5728$p^k$\u7684k>1\u7684\u65f6\u5019\u4e3a\u4ec0\u4e48\u80fd\u7528\uff0c\u6545\u6211\u91c7\u7528\u7684\u662f\u7ebf\u7b5b+\u6b27\u62c9\u5b9a\u7406\uff0c\u56e0\u4e3a\u7d20\u6570\u4e3a\u5206\u5e03\u7ea6\u4e3an/ln\uff0c\u7136\u540e\u6ce8\u610f\u5230$p^k$\u53ea\u4f1a\u8d85\u8fc7$\\sqrt m$\u6700\u591a\u4e00\u6b21\uff0c\u53ef\u4ee5\u7528exgcd\u6c42\u9006\u5143\uff1b\n\n\u7efc\u5408\u590d\u6742\u5ea6\u4e3a$O(nlogn)$\n\n[code](https://www.luogu.org/paste/wune6kr6)\n\n",
        "postTime": 1568097212,
        "uid": 30058,
        "name": "Zory",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3477 \u3010[POI2008]PER-Permutation\u3011"
    }
]