[
    {
        "content": "\u9898\u610f\u5199\u7684\u6bd4\u8f83\u6e05\u695a\u3002\n\n\u8003\u8651 DP\uff0c\u4ee4 $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a A \u7c7b\u5976\u725b\u548c\u524d $j$ \u4e2a B \u7c7b\u5976\u725b\u5339\u914d\u7684\u6700\u5927\u6536\u76ca\u3002\n\n\u5f53\u524d\u4e24\u4e2a\u5976\u725b\u524d\u9762\u53ef\u4ee5\u4e00\u5bf9\u5339\u914d\u7684\u4e5f\u6ca1\u6709\uff0c\u90a3\u4e48\u6709 $f_{i,j}=a_ib_j-(\\sum_{x=1}^{i-1}a_x)^2-(\\sum_{x=1}^{j-1}b_x)^2$\uff0c\u53ef\u4ee5\u4ece\u524d\u9762\u5df2\u7ecf\u5339\u914d\u597d\u7684\u4e00\u7ec4\u8f6c\u79fb\u8fc7\u6765\uff0c\u90a3\u4e48\u6709 $f_{i,j} = \\max \\limits_{k=1} \\limits^{i-1} \\max\\limits_{l=1}^{j-1}f_{k,l}+a_ib_j-(\\sum^{i-1}_{x=k+1}a_x)^2-(\\sum^{j-1}_{x=l+1}b_x)^2$\u3002\n\u7531\u4e8e $i,j$ \u540e\u9762\u53ef\u80fd\u8fd8\u6709\u5976\u725b\u6ca1\u6709\u5339\u914d\uff0c\u6240\u4ee5\u7b54\u6848\u662f $\\max\\limits_{i=1}\\limits ^n \\max\\limits_{j=1}\\limits^n f_{i,j}-(\\sum^n_{x=i+1}a_x)^2-(\\sum^n_{x=j+1}b_x)^2$\u3002\n\n\u7528\u524d\u7f00\u548c\u4f18\u5316\u4e00\u4e0b\uff0c\u53ef\u4ee5\u505a\u5230 $O(n^4)$ \u7684 DP\uff0c\u6bd4\u8f83\u8f7b\u677e\u7684\u62ff\u4e0b\u4e86 40 \u5206\uff0c\u4e0b\u9762\u9644\u4e0a\u4ee3\u7801\u3002\n\n\n```cpp\n#include <bits/stdc++.h>\nconst int N = 1005;\ntypedef long long ll;\nusing namespace std;\nll a[N], b[N], sa[N], sb[N];\nll f[N][N], ans = LLONG_MIN, n;\nint main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(NULL);\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i], sa[i] = sa[i - 1] + a[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> b[i], sb[i] = sb[i - 1] + b[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tf[i][0] = -sa[i] * sa[i], f[0][i] = -sb[i] * sb[i];\n\tfor (int i = 1; i <= n; i++) \n\t\tfor (int j = 1; j <= n; j++) {\n\t\t\tf[i][j] = a[i] * b[j] - sa[i - 1] * sa[i - 1] - sb[j - 1] * sb[j - 1];\n\t\t\tfor (int k = 1; k < i; k++) \n\t\t\t\tfor (int l = 1; l < j; l++) \n\t\t\t\t\tf[i][j] = max(f[i][j], f[k][l] + a[i] * b[j] - (sa[i - 1] - sa[k]) * (sa[i - 1] - sa[k]) - (sb[j - 1] - sb[l]) * (sb[j - 1] - sb[l]));\n\t\t\tans = max(ans, f[i][j] - (sa[n] - sa[i]) * (sa[n] - sa[i]) - (sb[n] - sb[j]) * (sb[n] - sb[j]));\n\t\t}\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n\n\u8003\u8651\u4f18\u5316\uff0c\u731c\u60f3\u4e00\u4e0b\u8f6c\u79fb\u6709\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u6027\u8d28\u3002\n\n\u968f\u673a\u51e0\u7ec4\u6570\u636e\uff0c\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u70b9\u7684\u51b3\u7b56\u70b9\u7136\u540e\u6253\u5370\u3002\n\n\u4e00\u6279\u51b3\u7b56\u70b9\u6ee1\u8db3 $k=i-1$\uff0c\u53e6\u4e00\u6279\u6ee1\u8db3 $l=j-1$\u3002\n\n\u6211\u4eec\u611f\u6027\u7406\u89e3\u4e00\u4e0b\uff1a\u533a\u95f4\u548c\u90fd\u662f\u975e\u8d1f\u7684\uff0c\u56e0\u4e3a $\\forall x,y\\geq 0,(x+y)^2\\geq x^2+y^2$\uff0c\u800c\u4e14\u5c06\u8fd9\u4e2a\u533a\u95f4\u65ad\u5f00\u8fd8\u6709\u989d\u5916\u7684\u8d21\u732e\uff0c\u6240\u4ee5\u5728\u4e2d\u95f4\uff08$[k+1,i-1],[l+1,j-1]$\uff09\u6dfb\u52a0\u4e00\u7ec4\u5339\u914d\u7684\u5976\u725b\u4e0d\u4f1a\u66f4\u574f\u3002\u90a3\u4e48\u6700\u540e\u5c31\u53ea\u5269\u4e0b $k=i-1$ \u548c $l=j-1$ \u8fd9\u4e24\u4e2a\u51b3\u7b56\u70b9\u8fde\u4e86\u3002\n\n\u590d\u6742\u5ea6\u964d\u4e3a $O(n^3)$\uff0c\u5361\u5361\u5e38\u6570\u5e94\u8be5\u662f\u80fd\u62ff\u5230 56 \u5206\u7684\uff0c\u4e0b\u9762\u9644\u4e0a\u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\nconst int N = 1005;\ntypedef long long ll;\nusing namespace std;\nll a[N], b[N], sa[N], sb[N];\nll f[N][N], ans = LLONG_MIN, n;\nint main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(NULL);\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i], sa[i] = sa[i - 1] + a[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> b[i], sb[i] = sb[i - 1] + b[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tf[i][0] = -sa[i] * sa[i], f[0][i] = -sb[i] * sb[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= n; j++) {\n\t\t\tf[i][j] = a[i] * b[j] - sa[i - 1] * sa[i - 1] - sb[j - 1] * sb[j - 1];\n\t\t\tif (i > 1) for (int l = 1; l < j; l++)\n\t\t\t\t\tf[i][j] = max(f[i][j], f[i - 1][l] + a[i] * b[j] - (sb[j - 1] - sb[l]) * (sb[j - 1] - sb[l]));\n\t\t\tif (j > 1) for (int k = 1; k < i; k++)\n\t\t\t\t\tf[i][j] = max(f[i][j], f[k][j - 1] + a[i] * b[j] - (sa[i - 1] - sa[k]) * (sa[i - 1] - sa[k]));\n\t\t\tans = max(ans, f[i][j] - (sa[n] - sa[i]) * (sa[n] - sa[i]) - (sb[n] - sb[j]) * (sb[n] - sb[j]));\n\t\t}\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n\n\u7136\u540e\u8fd9\u4e2a\u5f62\u5f0f\u662f\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u7684\u3002\u5bf9\u4e24\u4e2a\u8f6c\u79fb\u5206\u522b\u5f00\u4e24\u4e2a\u961f\u5217\u53bb\u659c\u7387\u4f18\u5316\u3002\u4e0d\u4f1a\u7684\u770b[\u8fd9\u91cc](https://www.luogu.com.cn/blog/ningago-lsh/xie-lv-you-hua-dp)\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define X1(k) (sb[k])\n#define Y1(k) (sb[k] * sb[k] - f[i - 1][k])\n#define X2(k) (sa[k])\n#define Y2(k) (sa[k] * sa[k] - f[k][j - 1])\nconst int N = 1005;\ntypedef long long ll;\nusing namespace std;\nll a[N], b[N], q1[N][N], q2[N][N], sa[N], sb[N], h1[N], h2[N], t1[N], t2[N];\nll f[N][N], ans = LLONG_MIN, n;\nint main() {\n    ios::sync_with_stdio(false);\n    cin.tie(NULL);\n    cin >> n;\n\n    for (int i = 1; i <= n; i++)\n        cin >> a[i], sa[i] = sa[i - 1] + a[i];\n\n    for (int i = 1; i <= n; i++)\n        cin >> b[i], sb[i] = sb[i - 1] + b[i];\n\n    for (int i = 1; i <= n; i++)\n        h1[i] = h2[i] = 1, f[i][0] = -sa[i] * sa[i], f[0][i] = -sb[i] * sb[i];\n\n    for (int i = 1; i <= n; i++) {\n        for (int j = 1; j <= n; j++) {\n            f[i][j] = a[i] * b[j] - sa[i - 1] * sa[i - 1] - sb[j - 1] * sb[j - 1];\n\n            while (h1[i] < t1[i] &&\n                    (Y1(q1[h1[i] + 1][i]) - Y1(q1[h1[i]][i])) <= (X1(q1[h1[i] + 1][i]) - X1(q1[h1[i]][i])) * 2 * sb[j - 1])\n                h1[i]++;\n\n            if (i > 1)\n                f[i][j] = max(f[i][j], f[i - 1][q1[h1[i]][i]] + a[i] * b[j] - (sb[j - 1] - sb[q1[h1[i]][i]]) * (sb[j - 1] - sb[q1[h1[i]][i]]));\n\n            while (h1[i] < t1[i] &&\n                    (Y1(q1[t1[i]][i]) - Y1(q1[t1[i] - 1][i])) * (X1(j) - X1(q1[t1[i]][i])) >= (Y1(j) - Y1(q1[t1[i]][i])) * (X1(q1[t1[i]][i]) - X1(q1[t1[i] - 1][i])))\n                t1[i]--;\n\n            q1[++t1[i]][i] = j;\n\n            while (h2[j] < t2[j] &&\n                    (Y2(q2[h2[j] + 1][j]) - Y2(q2[h2[j]][j])) <= (X2(q2[h2[j] + 1][j]) - X2(q2[h2[j]][j])) * 2 * sa[i - 1])\n                h2[j]++;\n\n            if (j > 1)\n                f[i][j] = max(f[i][j], f[q2[h2[j]][j]][j - 1] + a[i] * b[j] - (sa[i - 1] - sa[q2[h2[j]][j]]) * (sa[i - 1] - sa[q2[h2[j]][j]]));\n\n            while (h2[j] < t2[j] &&\n                    (Y2(q2[t2[j]][j]) - Y2(q2[t2[j] - 1][j])) * (X2(i) - X2(q2[t2[j]][j])) >= (Y2(i) - Y2(q2[t2[j]][j])) * (X2(q2[t2[j]][j]) - X2(q2[t2[j] - 1][j])))\n                t2[j]--;\n\n            q2[++t2[j]][j] = i;\n            ans = max(ans, f[i][j] - (sa[n] - sa[i]) * (sa[n] - sa[i]) - (sb[n] - sb[j]) * (sb[n] - sb[j]));\n        }\n    }\n\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```\n",
        "postTime": 1662121756,
        "uid": 434929,
        "name": "Usada_Pekora",
        "ccfLevel": 7,
        "title": "P6203 \u4e8c\u7ef4\u659c\u7387\u4f18\u5316"
    }
]