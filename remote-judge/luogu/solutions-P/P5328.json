[
    {
        "content": "[\u63a8\u9500\u535a\u5ba2](https://foreverlasting1202.github.io/)\n\n\u534a\u5e73\u9762\u4ea4\u3002\n\n\u8bf4\u4e2a\u5fc3\u9178\u7ecf\u5386\uff0c\u8003\u573a\u4e0a\u534a\u5e73\u9762\u4ea4\u677f\u5b50\u4e0d\u4f1a\u4e86\uff0c\u7136\u540e\u5c31\u6ca1\u6709\u7136\u540e\u4e86\u3002\n\n\u8fd9\u9053\u9898\u5176\u5b9e\u7684\u786e\u6ca1\u6709\u601d\u7ef4\u542b\u91cf\u5427\uff08\uff1f\uff09\u9996\u5148\u7b2c\u4e00\u540d\u663e\u7136\u5c31\u662f\u7b80\u5355\u7684\u534a\u5e73\u9762\u4ea4\uff0c\u7136\u540e\u53bb\u6389\u7b2c\u4e00\u540d\u540e\uff0c\u5269\u4e0b\u7684\u65b0\u51fa\u73b0\u7684\u7b2c\u4e00\u540d\u5c31\u662f\u7b2c\u4e8c\u540d\u3002\u7136\u800c\u4e0d\u80fd\u4e00\u4e2a\u4e2a\u5220\u53bb\uff0c\u80af\u5b9a\u8981\u628a\u6240\u6709\u7b2c\u4e00\u540d\u5220\u53bb\u3002\u63a5\u7740\u62ff\u7b2c\u4e00\u540d\u4eec\u4f1a\u4f7f\u54ea\u4e00\u6bb5$x$\u5750\u6807\u8303\u56f4\u7684\u540d\u6b21$+1$\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u4e8c\u5206\u4e2a\u4f4d\u7f6e\uff0c\u7136\u540e\u626b\u63cf\u7ebf\u4e00\u4e0b\u3002\u5f53\u67d0\u4eba\u5728\u8fb9\u754c\u4e0a\u800c\u4e14\u6700\u591a\u53ea\u88ab\u4e00\u4e2a\u4eba\u8986\u76d6\u7684\u8bdd\uff0c\u4ed6\u7684\u6392\u540d\u5c31\u53ef\u4ee5\u4e0a\u5347\u4e86\u3002\n\n\u6240\u4ee5\u8fd8\u662f\u633a\u7b80\u5355\u7684\u3002\n\ncode:\n```cpp\n//2019.5.6 by ljz\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register LL\n#define LL long long\n#define inf 0x3f3f3f3f3f3f3f\n#define eps 1e-10\n#define RG register\ninline LL read() {\n    res s=0,ch=getchar();\n    while(ch<'0'||ch>'9')ch=getchar();\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return s;\n}\ninline LL Read() {\n    RG LL s=0;\n    res ch=getchar();\n    while(ch<'0'||ch>'9')ch=getchar();\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return s;\n}\nconst LL N=1e5+10;\nnamespace MAIN {\n    LL n,m;\n    struct P{\n        LL k,id;\n        LL b;\n        P() {}\n        P(res k,RG LL b,res id):k(k),b(b),id(id) {}\n        inline bool operator < (const P &B) const {\n            return k!=B.k?k<B.k:b>B.b;\n        }\n    }a[N];\n    LL ans[N];\n    P st[N];\n    struct A{\n        LL a;\n        LL b,c;\n        A() {a=b=0,c=1;}\n        A(RG LL x,res y){\n            if(y<0)x=-x,y=-y;\n            a=x/y,b=int(x%y),c=y;\n            if(b<0)b+=c,a--;\n        }\n        inline bool operator < (const A &x) const {\n            return a==x.a?b*x.c<x.b*c:a<x.a;\n        }\n        inline bool operator <=(const A &x) const {\n            return a==x.a?b*x.c<=x.b*c:a<x.a;\n        }\n        inline LL floor(){\n            return a;\n        }\n        inline LL ceil(){\n            return a+(b>0);\n        }\n    }St[N];\n    inline A cross(const RG P &a,const RG P &b){\n        return A(b.b-a.b,a.k-b.k);\n    }\n    typedef pair<LL,LL> Pair;\n#define mp make_pair\n#define fi first\n#define se second\n    Pair sT[N<<1];\n    inline void solve(const res &rnk){\n        res tot=0,top=0;\n        St[0]=A(0,1);\n        for(res i=1;i<=n;i++)\n            if(ans[a[i].id]==-1&&a[i].k>st[top].k){\n                while(top&&cross(a[i],st[top]).floor()<St[top].ceil())top--;\n                st[++top]=a[i];\n                if(top>1)St[top]=cross(st[top-1],a[i]);\n            }\n        St[top+1]=A(inf,1);\n        for(res i=1;i<=n;i++)\n            if(ans[a[i].id]!=-1){\n                res l=1,r=top,ret=0;\n                while(l<=r){\n                    res mid=(l+r)>>1;\n                    if(st[mid].k>=a[i].k||cross(st[mid],a[i])<=St[mid+1])ret=mid,r=mid-1;\n                    else l=mid+1;\n                }\n                sT[++tot]=mp(st[ret].k>=a[i].k?0:cross(st[ret],a[i]).floor()+1,1);\n                l=1,r=top,ret=0;\n                while(l<=r){\n                    res mid=(l+r)>>1;\n                    if(st[mid].k<=a[i].k||St[mid]<=cross(st[mid],a[i]))ret=mid,l=mid+1;\n                    else r=mid-1;\n                }\n                if(st[ret].k>a[i].k)sT[++tot]=mp(cross(st[ret],a[i]).ceil(),-1);\n            }\n        sort(sT+1,sT+tot+1);\n        for(res i=1,j=1,x=0;i<=top;i++){\n            while(j<=tot&&sT[j].fi<=St[i].ceil())x+=sT[j++].se;\n            if(x==rnk-1)ans[st[i].id]=rnk;\n            while(j<=tot&&sT[j].fi<=St[i+1].floor()){\n                res p=j;\n                while(p<=tot&&sT[p].fi==sT[j].fi)x+=sT[p++].se;\n                if(x==rnk-1)ans[st[i].id]=rnk;\n                j=p;\n            }\n        }\n    }\n    inline void MAIN(){\n        n=read(),m=read();\n        for(res i=1;i<=n;i++){\n            res k=read();\n            RG LL b=Read();\n            a[i]=P(k,b,i),ans[i]=-1;\n        }\n        sort(a+1,a+n+1);\n        for(res i=1;i<=m;i++)solve(i);\n        for(res i=1;i<=n;i++)printf(\"%lld \",ans[i]);\n    }\n}\nint main() {\n//    freopen(\"graph.in\",\"r\",stdin);\n//    freopen(\"graph.out\",\"w\",stdout);\n    MAIN::MAIN();\n    return 0;\n}\n```",
        "postTime": 1557128810,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010ZJOI2019\u3011\u6d59\u6c5f\u7701\u9009"
    },
    {
        "content": "### \u9898\u9762\n[\u5728\u8fd9\u91cc](https://www.luogu.com.cn/problem/P5328)\n### \u9898\u610f\u7b80\u8ff0\n\u7ed9\u5b9a $n$ \u6761\u5f62\u5982$y=k_ix+b_i$\u7684\u76f4\u7ebf\uff0c\u6c42\u6bcf\u6761\u76f4\u7ebf\u7684\u6700\u597d\u6392\u540d\n\n\n### \u9898\u89e3\n\u6392\u540d\u4e3a$1$\u7684\u76f4\u7ebf\u663e\u7136\u6784\u6210\u4e00\u4e2a\u4e0b\u51f8\u58f3,\u76f4\u63a5\u534a\u5e73\u9762\u4ea4\n\n\u6392\u540d\u4e3a$2$\u7684\u76f4\u7ebf\u663e\u7136\u4e5f\u6784\u6210\u4e00\u4e2a\u4e0b\u51f8\u58f3\uff0c\u4f46\u4e0d\u80fd\u76f4\u63a5\u6c42\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u4e0b\u51f8\u58f3\u4e0a\u7684\u67d0\u6761\u76f4\u7ebf\u88ab\u5b8c\u5168\u8986\u76d6\u4e86\u4e0d\u6b62\u4e00\u6b21\uff0c\u8fd9\u6837\u5b83\u7684\u6392\u540d\u663e\u7136\u4e0d\u80fd\u4e3a$2$\n\n\u4e8e\u662f\u6709\u8fd9\u6837\u4e00\u4e2a\u7b97\u6cd5\uff1a\u5220\u53bb\u6392\u540d\u4e3a$1$\u7684\u6240\u6709\u76f4\u7ebf\uff0c\u5bf9\u4e8e\u6392\u540d\u4e3a$1$\u7684\u6240\u6709\u76f4\u7ebf\uff0c\u4e8c\u5206\u51fa\u5b83\u4f5c\u4e3a$rank1$\u5b58\u5728\u7684\u533a\u95f4$[l,r]$\uff0c\u8fd9\u663e\u7136\u662f\u4e00\u4e2a\u8fde\u7eed\u7684\u533a\u95f4\u3002\u5c06\u533a\u95f4$(l,r)+1$,\u8868\u793a\u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u6570\u90fd\u88ab\u5b83\u8986\u76d6\u4e86\u4e00\u6b21\uff0c\u6700\u540e\u5bf9\u4e8e\u53bb\u6389$rank1$\u76f4\u7ebf\u7684\u96c6\u5408\u7684\u4e0b\u51f8\u58f3\u4e2d\u7684\u6bcf\u6761\u76f4\u7ebf\u8fdb\u884c\u8003\u8651\uff0c\u82e5\u5b83\u4f5c\u4e3a\u6700\u5927\u503c\u5b58\u5728\u7684\u533a\u95f4\u5185\u5b58\u5728\u4e00\u4e2a\u6574\u6570\u6ee1\u8db3\u5b83\u53ea\u88ab\u8986\u76d6\u4e86\u4e00\u6b21\uff0c\u90a3\u4e48\u8fd9\u6761\u76f4\u7ebf\u5c31\u53ef\u4ee5\u4f5c\u4e3a$rank2$\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\u4f9d\u6b21\u8003\u8651$1\\leq i\\leq m$\u7684\u6240\u6709\u6392\u540d\uff0c\u5220\u53bb\u96c6\u5408\u4e2d$1\\leq rank\\leq i-1$\u7684\u6240\u6709\u76f4\u7ebf\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u70b9\u88ab\u8986\u76d6\u7684\u6b21\u6570\uff0c\u626b\u63cf\u5f53\u524d\u51f8\u58f3\u4e0a\u7684\u6bcf\u4e00\u6761\u76f4\u7ebf\uff0c\u82e5\u5b58\u5728\u4e00\u4e2a$x$\uff0c\u4f7f\u8fd9\u6761\u76f4\u7ebf\u5728$x$\u5904\u53d6\u503c\u5927\u4e8e\u7b49\u4e8e\u96c6\u5408\u4e2d\u5269\u4e0b\u7684\u76f4\u7ebf(\u5373\u5728\u51f8\u58f3\u4e0a)\uff0c\u4e14$x$\u53ea\u88ab\u8986\u76d6$i-1$\u6b21\uff0c\u90a3\u4e48\u8fd9\u6761\u76f4\u7ebf\u7684\u6392\u540d\u4e3a$i$\n\n\u6700\u540e\u4ecd\u7136\u6ca1\u6709\u6c42\u51fa\u6392\u540d\u7684\u7ebf\u6bb5\u663e\u7136\u4e0d\u80fd*\u8fdb\u5165\u7701\u961f*(\u60b2)\uff0c\u8f93\u51fa\u4e3a$-1$\n\n### \u7ec6\u8282\n\n1. \u4e0d\u80fd\u7528`double`,\u8981\u624b\u5199\u5e26\u5206\u6570\n2. \u8bb0\u5f97\u5f00`long long`,`1e18`\n3. \u82e5\u4e24\u6761\u76f4\u7ebf\u7684\u4ea4\u70b9\u6a2a\u5750\u6807\u4e3a\u6574\u6570\uff0c\u90a3\u4e48\u5b83\u540c\u65f6\u88ab\u8fd9\u4e24\u6761\u76f4\u7ebf\u8986\u76d6\n4. \u53ef\u4ee5\u7528\u89e3\u6790\u5f0f\u5b58\u76f4\u7ebf\n\n### \u4ee3\u7801\n```\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>inline void read(T& t)\n{T f=1;char ch=getchar();t=0;\nwhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\nwhile(ch>='0'&&ch<='9')t=t*10+ch-'0',ch=getchar();t*=f;}\ntemplate <typename T,typename... Args>\ninline void read(T& t, Args&... args)\n{read(t);read(args...);}\n#define DEBUG if(0)\n#define JUDGE if(0)\nint n,m;\nstruct Double\n{\n\tlong long a,b,c;\n\tDouble(){a=b=0;c=1;}\n\tDouble(long long A){a=A;b=0;c=1;}\n\tDouble(long long A,long long B)\n\t{\n\t\tif(B<0)A=-A,B=-B;\n\t\ta=A/B;b=A%B;c=B;\n\t\tif(b<0)b+=B,a--;\n\t}\n\tbool operator < (const Double & B)\n\t{\n\t\tif(a==B.a)return b*B.c<B.b*c;\n\t\treturn a<B.a;\n\t}\n\tbool operator <=(const Double & B)\n\t{\n\t\tif(a==B.a)return b*B.c<=B.b*c;\n\t\treturn a<B.a;\n\t}\n\tinline long long floor(){return a;}\n\tinline long long ceil(){return a+(b>0);}\n\tinline void print(){printf(\"Double:this=%u %lld+%lld/%lld\\n\",this,a,b,c);}\n};\nstruct Person\n{\n\tlong long k,b;int id;\n\tPerson(){}\n\tPerson(long long K,long long B,int ID){k=K;b=B;id=ID;}\n\tinline bool operator < (const Person & B)const{return k==B.k?b>B.b:k<B.k;}\n\tinline void print(){printf(\"Person:this=%u k=%lld b=%lld id=%d\\n\",this,k,b,id);}\n};\nPerson person[1000005];\nint ans[1000005];\nDouble cross(const Person & A,const Person & B)//\u8fd4\u56de\u4ea4\u70b9\u7684\u6a2a\u5750\u6807 \n{return Double(A.b-B.b,B.k-A.k);}\nPerson ST[1000005];\nint ST_top=0;\nDouble var[1000005],var_top;\nint over[1000005];\nbool in_ST[1000005];\nvoid solve(int rank)\n{\n\tST_top=0;\n\tvar[0]=Double(0,1);\n\tfor(int i=1;i<=n;i++)\n\t\tif(ans[person[i].id]==-1&&person[i].k>ST[ST_top].k)\n\t\t{\n\t\t\twhile(ST_top&&cross(person[i],ST[ST_top]).floor()<var[ST_top].ceil())ST_top--;\n\t\t\t//ST[ST_top]\u7684\u8303\u56f4\uff1a[ var[ST_top].ceil(),cross(person[i],ST[ST_top]).floor()]\n\t\t\tST[++ST_top]=person[i];\n\t\t\tif(ST_top>1)var[ST_top]=cross(ST[ST_top-1],ST[ST_top]);\n\t\t}\n\tmemset(in_ST,0,sizeof(in_ST));\n\tfor(int i=1;i<=ST_top;i++)in_ST[ST[i].id]=1;\nDEBUG\tprintf(\"ST_top=%d\\n\",ST_top);\n\tvar[1]=Double(0,1);//\n\tvar[ST_top+1]=Double(1e18,1);\nDEBUG\tfor(int i=1;i<=ST_top;i++)var[i].print();\nDEBUG\tfor(int i=1;i<=ST_top;i++)ST[i].print();\n\tmemset(over,0,sizeof(over));\n\tvector<pair<long long,int> > pos;\n\tfor(int i=1;i<=n;i++)\n\t\tif(ans[person[i].id]!=-1)\n\t\t{\n\t\t\tint L,R;\n\t\t\tint l,r,mid;\n\t\t\tl=1;r=ST_top;\n\t\t\twhile(l<r)\n\t\t\t{\n\t\t\t\tmid=(l+r+1)>>1;\n\t\t\t\tif(ST[mid].k>=person[i].k||cross(ST[mid],person[i])<=var[mid])r=mid-1;\n\t\t\t\telse l=mid;\n\t\t\t}\n\t\t\tL=l;\n\t\t\tl=1;r=ST_top;\n\t\t\twhile(l<r)\n\t\t\t{\n\t\t\t\tmid=(l+r)>>1;\n\t\t\t\tif(ST[mid].k<=person[i].k||var[mid+1]<=cross(ST[mid],person[i]))l=mid+1;\n\t\t\t\telse r=mid;\n\t\t\t}\n\t\t\tR=l;\n\t\t\tif(ST[L].k>=person[i].k||cross(person[i],ST[L]).floor()+1<0)pos.push_back(make_pair(0,1));//\n\t\t\telse pos.push_back(make_pair(cross(person[i],ST[L]).floor()+1,1));//\u5982\u679c\u4ea4\u70b9\u6070\u597d\u662f\u6574\u70b9\uff0c\u4e5f\u4e0d\u7b97\u88ab\u8986\u76d6\uff0c\u6240\u4ee5\u662ffloor+1; \n\t\t\tif(ST[R].k>person[i].k&&cross(person[i],ST[R]).ceil()>=0)pos.push_back(make_pair(cross(person[i],ST[R]).ceil(),-1));//\u540c\u4e0a \n\t\t}\n\tint mp_tot=0;\n\tmap<long long,int>mp;\n\tfor(auto i:pos)\n\t\tif(mp.count(i.first)==0)\n\t\t\tmp[i.first];\n\tfor(int i=1;i<=ST_top+1;i++)\n\t\tif(mp.count(var[i].floor())==0)\n\t\t\tmp[var[i].floor()];\n\tfor(int i=1;i<=ST_top+1;i++)\n\t\tif(mp.count(var[i].ceil())==0)\n\t\t\tmp[var[i].ceil()];\n\tmp_tot=0;\n\tfor(map<long long,int>::iterator i=mp.begin();i!=mp.end();i++)i->second=++mp_tot;\n\tfor(vector<pair<long long,int> >::iterator i=pos.begin();i!=pos.end();i++)i->first=mp[i->first];\nDEBUG\tfor(auto i:pos)printf(\"pos %d,add %d\\n\",i.first,i.second);\t\n\tfor(auto i:pos)over[i.first]+=i.second;\n\tfor(int i=1;i<=mp_tot;i++)over[i]+=over[i-1];\nDEBUG\tfor(auto i:mp)printf(\"first=%lld second=%d\\n\",i.first,i.second);\nDEBUG {for(int i=1;i<=mp_tot;i++)printf(\"%d \",over[i]);printf(\"\\n\");}\n\tfor(int i=1;i<=ST_top;i++)\n\t{\nDEBUG\t\tprintf(\"id=%d [%d,%d]\\n\",ST[i].id,mp[var[i].ceil()],mp[var[i+1].floor()]);\n\t\tfor(int j=mp[var[i].ceil()];j<=mp[var[i+1].floor()];j++)\n\t\t\tif(over[j]==rank-1)\n\t\t\t\tans[ST[i].id]=rank;\n\t}\t\n}\nint main()\n{\nJUDGE\tfreopen(\"data.in\",\"r\",stdin);\nJUDGE\tfreopen(\"sol.out\",\"w\",stdout);\n\tread(n,m);\n\tfor(int i=1;i<=n;i++)read(person[i].k,person[i].b),person[i].id=i;\n\tmemset(ans,-1,sizeof(ans));\n\tsort(person+1,person+n+1);\nDEBUG\tfor(int i=1;i<=n;i++)person[i].print();\n\tfor(int i=1;i<=m;i++)solve(i);\n\tfor(int i=1;i<=n;i++)printf(\"%d \",ans[i]);\n\treturn 0;\n}\n```\n#### \u53e6\u9644\u6570\u636e\u751f\u6210\u5668\n```\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>inline void read(T& t)\n{T f=1;char ch=getchar();t=0;\nwhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\nwhile(ch>='0'&&ch<='9')t=t*10+ch-'0',ch=getchar();t*=f;}\ntemplate <typename T,typename... Args>\ninline void read(T& t, Args&... args)\n{read(t);read(args...);}\nlong long random()\n{\n\treturn abs((unsigned long long)rand()*rand()*rand()*rand());\n}\nint main()\n{\n\tsrand((unsigned long long)time(0));\n\tfreopen(\"data.in\",\"w\",stdout);\n\tprintf(\"3 100\\n\");\n\tfor(int i=1;i<=3;i++)\n\t\tprintf(\"%lld %lld\\n\",random()%1000000000,random()%1000000000000000000);\n\treturn 0;\n}\n```",
        "postTime": 1592953393,
        "uid": 114409,
        "name": "9AC8E2",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5328 \u3010[ZJOI2019]\u6d59\u6c5f\u7701\u9009\u3011"
    },
    {
        "content": "# Address\n[Luogu P5328](https://www.luogu.org/problemnew/show/P5328)\n\n# Solution\n - ~~\u8fd9\u662f\u4ec0\u4e48\u795e\u4ed9\u9898~~ \n - ~~\u849f\u84bb\u7f16\u4e86\u4e00\u4e2a\u8fa3\u9e21\u505a\u6cd5\u641e\u4e86\u4e00\u5929\u624d\u8fc7~~\n - \u628a\u6bcf\u4e2a\u4eba\u770b\u4f5c\u76f4\u7ebf : $y=a_ix+b_i$\uff0c\u679a\u4e3e$i=1\u2192m$\uff0c\u5e76\u5206\u522b\u6c42\u51fa\u6700\u597d\u6392\u540d\u4e3a $i$ \u7684\u76f4\u7ebf\u96c6\u5408\u3002\n - \u663e\u7136\u80fd\u62ff $rank1$ \u7684\u76f4\u7ebf\u5fc5\u987b\u4f4d\u4e8e\u4e0b\u51f8\u58f3\u4e0a\u3002\n - \u6ce8\u610f\u7531\u4e8e $x$ \u5fc5\u987b\u4e3a**\u975e\u8d1f\u6574\u6570**\uff0c\u8fd9\u4e2a\u4e0b\u51f8\u58f3\u4e0a\u7684\u70b9\u5fc5\u987b\u90fd\u662f\u6574\u6570\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u67d0\u6761\u76f4\u7ebf\u5728 $0.5\u2264x\u22640.8$ \u7684\u65f6\u5019\u80fd\u62ff $rank1$\uff0c\u90a3\u4e48\u8fd9\u6761\u76f4\u7ebf\u4e0d\u5728\u4e0b\u51f8\u58f3\u4e0a\u3002\n - \u7531\u4e8e$x\u2208(0,+\u221e)$\uff0c\u4e0b\u51f8\u58f3\u7531**\u4e00\u4e9b\u7ebf\u6bb5\u548c\u6700\u53f3\u7684\u4e00\u6761\u5c04\u7ebf**\u7ec4\u6210\n - \u80fd\u62ff $rank2$ \u7684\u76f4\u7ebf\u5fc5\u987b\u6ee1\u8db3\uff1a\n   $1.$ \u9664\u6389\u80fd\u62ff $rank1$ \u7684\u76f4\u7ebf\u4e4b\u540e\uff0c\u4f4d\u4e8e\u4e0b\u51f8\u58f3\u4e0a\u3002\n   $2.$ \u5b58\u5728\u4e00\u4e2a**\u975e\u8d1f\u6574\u6570** $x$\uff0c\u4f7f\u5f97\u6700\u591a\u4e00\u6761 $rank1$ \u76f4\u7ebf\u5728\u5b83\u4e4b\u4e0a\u3002\n - \u6761\u4ef6 $1$ \u5341\u5206\u7b80\u5355\uff0c\u8ddf\u6c42\u80fd\u62ff $rank1$ \u7684\u76f4\u7ebf\u7684\u65b9\u6cd5\u4e00\u6837\u3002\n - \u5bf9\u4e8e\u6761\u4ef6 $2$\uff1a\u679a\u4e3e\u6bcf\u4e00\u6761\u80fd\u62ff $rank1$ \u7684\u76f4\u7ebf $y=cx+d$\uff0c\u4e8c\u5206\u51fa\u4e24\u4e2a**\u975e\u8d1f\u6574\u6570**$l,r$\uff0c\u82e5\u51f8\u58f3\u7528 $y=f(x)$ \u8868\u793a\uff0c\u5219\u5f53 $x\u2208[l,r]$ \u65f6\uff0c$cx+d>f(x)$\u3002\n - \u4e3a\u964d\u4f4e\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u4e0d\u7528\u4e8c\u5206 $l,r$ \u7684\u503c\uff0c\u800c\u662f\u4e8c\u5206\u76f4\u7ebf\u548c\u51f8\u58f3\u201c\u76f8\u4ea4\u201d\u4e8e\u54ea\u4e00\u6761\u7ebf\u6bb5\u6216\u5c04\u7ebf\u3002\n - \u6ce8\u610f\u8fd9\u4e2a $r$ \u53ef\u80fd\u65e0\u9650\u5927\u3002\n - \u7136\u540e\u628a\u6bcf\u6761\u76f4\u7ebf\u7684 $l,r$\uff0c\u4ee5\u53ca\u6bcf\u6761\u7ebf\u6bb5\uff08\u6216\u5c04\u7ebf\uff09\u7684\u7aef\u70b9\uff08\u7aef\u70b9\u4e5f\u5e94\u662f**\u975e\u8d1f\u6574\u6570**\uff0c\u82e5\u7aef\u70b9\u4e3a $u,v$\uff0c\u5219\u8868\u793a $x\u2208[u,v]$ \u65f6\uff0c\u8fd9\u6761\u7ebf\u6bb5\uff08\u6216\u5c04\u7ebf\uff09\u5728\u51f8\u58f3\u4e0a\u662f $rank1$\u3002\u7279\u522b\u5730\uff0c\u5c04\u7ebf\u7684\u53f3\u7aef\u70b9\u53ef\u4ee5\u8bbe\u4e3a\u4e00\u4e2a\u5f88\u5927\u7684\u6570\u3002\uff09\u653e\u5165\u4e00\u4e2a\u6570\u7ec4 $h$ \u8fdb\u884c\u6392\u5e8f\u79bb\u6563\u5316\u3002\n - \u79bb\u6563\u5316\u540e\uff0c\u5982\u679c\u6709 $h[i]+1<h[i+1]$\uff0c\u518d\u5f80 $h$ \u4e2d\u52a0\u5165 $h[i]+1$\u3002\n - \u518d\u6b21\u6392\u5e8f\uff0c\u79bb\u6563\u5316\u3002\n - \u628a\u6bcf\u6761\u76f4\u7ebf\u7684 $l,r$ \u5728\u79bb\u6563\u5316\u540e\u7684\u6570\u7ec4\u4e0a\u505a\u5dee\u5206\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e2a $h[i]$\uff0c\u7b97\u51fa $x=h[i]$ \u65f6\uff0c\u6709\u51e0\u6761 $rank1$ \u7684\u76f4\u7ebf\u5728\u51f8\u58f3\u4e4b\u4e0a\uff08\u5373\u70b9\u7684\u88ab\u8986\u76d6\u6b21\u6570\uff09\u3002\n - \u7136\u540e\u679a\u4e3e\u51f8\u58f3\u4e0a\u7684\u6240\u6709\u7ebf\u6bb5\uff08\u6216\u5c04\u7ebf\uff09\uff0c\u5982\u679c$h$ \u4e2d\u6240\u6709\u4f4d\u4e8e\u6b64\u7ebf\u6bb5\u4e0a\u7684\u70b9\u4e2d\uff0c\u88ab\u8986\u76d6\u6b21\u6570\u7684\u6700\u5c0f\u503c $<2$\uff0c\u5219\u8fd9\u6761\u7ebf\u6bb5\u7684\u6700\u597d\u6392\u540d\u4e3a $rank2$\u3002\n - \u5bf9\u4e8e $rank3,rank4$\uff0c\u4f9d\u6b64\u7c7b\u63a8\u5373\u53ef\u3002\n - \u8fd8\u6ca1\u7ed3\u675f\uff01\n - \u7531 $a_i\u226410^{9},b_i\u226410^{18}$ \u53ef\u77e5\uff0c\u6b64\u9898\u6211\u4eec\u4e0d\u53ef\u4ee5\u7528 $double$ \u8868\u793a\u5b9e\u6570\uff08\u6bd2\u7624\u7cbe\u5ea6\u8bef\u5dee\uff09\uff0c\u8981\u7528\u5206\u6570\u8868\u793a\u5b9e\u6570\uff0c\u800c\u4e14\u4e0d\u80fd\u7528\u5047\u5206\u6570\uff0c\u8981\u7528\u5e26\u5206\u6570\uff08\u8868\u793a\u4e3a $a+\\frac{b}{c}$\uff0c\u5176\u4e2d $0\u2264b<c$\uff09\u3002$QAQ$\n \n # Code\n - ~~\u6211\u7684\u505a\u6cd5\u662f\u4e0d\u662f\u592a\u9ebb\u70e6\u4e86~~ \n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define ll long long\n\nconst int e = 1e6 + 5;\nconst ll inf = 2e18;\nconst double eps = 1e-12;\nint id[e], stk[e], top, n, st[e][20], m, ans[e], cnt, rk, s[e], p[e], w, logn[e], tot;\nll a[e], b[e], h[e], g[e];\nstruct frac\n{\n    ll a, b, c;\n    frac() {a = b = 0; c = 1;}\n    frac(ll x, ll y)\n    {\n        if (y < 0) x = -x, y = -y;\n        a = x / y; c = y; b = x % y;\n        if (b < 0) b += y, a--;\n    }\n    inline ll floor() \n    {\n        return a; \n    }\n    inline ll ceil()\n    {\n        return b % c ? a + 1 : a;\n    }\n}c[e];\nstruct work\n{\n    ll l, r;\n}q[e];\n\ntemplate <class t>\ninline void read(t & res)\n{\n    char ch;\n    while (ch = getchar(), !isdigit(ch));\n    res = ch ^ 48;\n    while (ch = getchar(), isdigit(ch))\n    res = res * 10 + (ch ^ 48);\n}\n\ninline bool operator > (frac a, frac b)\n{\n    return a.a != b.a ? a.a > b.a : a.b * b.c > a.c * b.b;\n}\n\ninline bool cmp(int x, int y)\n{\n    return a[x] != a[y] ? a[x] < a[y] : b[x] > b[y];\n}\n\ninline bool check(int p1, int p2, int p3)\n{\n    ll k1 = ceil(1.0 * (b[p1] - b[p2]) / (a[p2] - a[p1])), \n        k2 = floor(1.0 * (b[p2] - b[p3]) / (a[p3] - a[p2]));\n    return k1 > k2;\n}\n\ninline double cross(ll a1, ll b1, ll a2, ll b2)\n{\n    return 1.0 * (b1 - b2) / (a2 - a1);\n}\n\ninline void rmq()\n{\n    int i, j;\n    logn[0] = -1;\n    for (i = 1; i <= w; i++) logn[i] = logn[i >> 1] + 1, st[i][0] = s[i];\n    for (j = 1; (1 << j) <= w; j++)\n    for (i = 1; i + (1 << j) - 1 <= w; i++)\n    st[i][j] = min(st[i][j - 1], st[i + (1 << j - 1)][j - 1]);\n}\n\ninline int ask(int l, int r)\n{\n    int k = logn[r - l + 1];\n    return min(st[l][k], st[r - (1 << k) + 1][k]);\n}\n\ninline bool judge(ll x, ll y, frac z)\n{\n    if (x > 0) return z > frac(y, x);\n    else return frac(-y, -x) > z;\n}\n\ninline void solve(int k)\n{\n    int i; cnt = m = 0; top = 0;\n    for (i = 1; i <= n; i++)\n    if (ans[i] == -1) p[++m] = i;\n    sort(p + 1, p + m + 1, cmp);\n    for (i = 1; i <= m; i++)\n    if (i == 1 || a[p[i]] != a[p[i - 1]]) id[++cnt] = p[i];\n    for (i = 1; i <= cnt; i++)\n    {\n        while (top > 0 && b[stk[top]] < b[id[i]]) top--; \n        while (top > 1 && check(stk[top - 1], stk[top], id[i])) top--;\t\n        stk[++top] = id[i];\n    }\n    m = cnt = 0;\n    for (i = 1; i <= top; i++) id[++m] = stk[i];\n    if (k == 1)\n    {\n        for (i = 1; i <= top; i++) ans[stk[i]] = 1;\n        return;\n    }\n    for (i = 1; i <= m; i++) \n    {\n        if (i == 1) c[i] = frac(0, 1);\n        else c[i] = frac(b[id[i]] - b[id[i - 1]], a[id[i - 1]] - a[id[i]]);\n    }\n    c[m + 1] = frac(inf, 1);\n    for (i = 1; i <= n; i++)\n    if (ans[i] != -1)\n    {\n        ll c1 = a[i], d1 = b[i]; \n        int p1 = m + 2, p2 = 0, l = 1, r = m + 1;\n        while (l <= r)\n        {\n            int mid = l + r >> 1;\n            if (mid == m + 1)\n            {\n                if (c1 > a[id[m]] || (c1 == a[id[m]] && d1 > b[id[m]])) p1 = mid;\n                r = mid - 1;\n                continue;\n            } \n            if (c1 == a[id[mid]] || judge(c1 - a[id[mid]], b[id[mid]] - d1, c[mid]))\n            {\n                p1 = mid;\n                r = mid - 1;\n            }\n            else if (a[id[mid]] < c1) l = mid + 1;\n            else r = mid - 1;\n        }\n        l = 1; r = m + 1;\n        while (l <= r)\n        {\n            int mid = l + r >> 1;\n            if (mid == m + 1)\n            {\n                if (c1 > a[id[m]] || (c1 == a[id[m]] && d1 > b[id[m]])) p2 = mid;\n                l = mid + 1;\n                continue;\n            }\n            if (c1 == a[id[mid]] || judge(c1 - a[id[mid]], b[id[mid]] - d1, c[mid]))\n            {\n                p2 = mid;\n                l = mid + 1;\n            }\n            else if (a[id[mid]] < c1) l = mid + 1;\n            else r = mid - 1;\n        }\n        cnt++;\n        if (p1 == 1) q[cnt].l = 0;\n        else \n        {\n            q[cnt].l = ceil(cross(a[id[p1 - 1]], b[id[p1 - 1]], c1, d1));\n            if ((d1 - b[id[p1 - 1]]) % (a[id[p1 - 1]] - c1) == 0) q[cnt].l++;\n        }\n        if (p2 == m + 1) q[cnt].r = inf;\n        else \n        {\n            q[cnt].r = floor(cross(a[id[p2]], b[id[p2]], c1, d1));\n            if ((d1 - b[id[p2]]) % (a[id[p2]] - c1) == 0) q[cnt].r--;\n        }\n        if (q[cnt].l > q[cnt].r) cnt--;\n    }\n    tot = 0;\n    for (i = 1; i <= cnt; i++) h[++tot] = q[i].l, h[++tot] = q[i].r;\n    for (i = 1; i <= m; i++) h[++tot] = c[i].ceil(), h[++tot] = c[i + 1].floor(); \n    sort(h + 1, h + tot + 1);\n    w = 0;\n    for (i = 1; i <= tot; i++)\n    if (i == 1 || h[i] != h[i - 1]) g[++w] = h[i];\n    sort(g + 1, g + w + 1);\n    int w0 = w;\n    for (i = 1; i < w0; i++)\n    if (g[i] + 1 != g[i + 1]) g[++w] = g[i] + 1;\n    sort(g + 1, g + w + 1);\n    memset(s, 0, sizeof(s));\n    for (i = 1; i <= cnt; i++)\n    {\n        int x = lower_bound(g + 1, g + w + 1, q[i].l) - g,\n            y = lower_bound(g + 1, g + w + 1, q[i].r) - g;\n        s[x]++;\n        s[y + 1]--;\n    }\n    for (i = 1; i <= w; i++) s[i] += s[i - 1];\n    rmq();\n    for (i = 1; i <= m; i++)\n    {\n        ll x = c[i].ceil(), y = c[i + 1].floor(); \n        int px = lower_bound(g + 1, g + w + 1, x) - g,\n            py = upper_bound(g + 1, g + w + 1, y) - g - 1;\n        if (ask(px, py) < k) ans[id[i]] = k;\n    }\n}\n\nint main()\n{\n    read(n); read(rk);\n    int i;\n    for (i = 1; i <= n; i++) read(a[i]), read(b[i]), ans[i] = -1;\n    for (i = 1; i <= rk; i++) solve(i);\n    for (i = 1; i <= n; i++) printf(\"%d \", ans[i]);\n    putchar('\\n');\n    return 0;\n}\n ```",
        "postTime": 1566744760,
        "uid": 15268,
        "name": "\u82b1\u6dc7\u6dcb",
        "ccfLevel": 9,
        "title": "[ZJOI2019]\u6d59\u6c5f\u7701\u9009"
    }
]