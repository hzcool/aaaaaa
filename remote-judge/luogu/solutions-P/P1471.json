[
    {
        "content": "\n\u6211\u4eec\u628a\u65b9\u5dee\u516c\u5f0f\u5c55\u5f00\n\n ![](https://cdn.luogu.com.cn/upload/pic/3825.png) \n\n\u6240\u4ee5\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u533a\u95f4\u5e73\u65b9\u548c\u548c\u533a\u95f4\u548c\n\n\u5f53\u6211\u4eec\u66f4\u65b0\u4e00\u4e2a\u533a\u95f4\u52a0\u65f6\n\n ![](https://cdn.luogu.com.cn/upload/pic/3826.png) \n\n\u6240\u4ee5pushdown\u5c31\u5f88\u597d\u5199\u4e86\n\n\u5177\u4f53\u89c1\u4ee3\u7801\n\n\u60f3\u8981\u8fdb\u4e00\u6b65\u5b66\u4e60\u7684\u53ef\u4ee5\u770b[\u8fd9\u91cc](http://www.yhzq-blog.cc/\u7ebf\u6bb5\u6811\u9ad8\u9636\u603b\u7ed3/)\n\n\n        \n    \n    \n```cpp\n#include <cstdio>\n#include <iostream>\n#define lson rt<<1,l,mid\n#define rson rt<<1|1,mid+1,r\n#define Maxn 300010\nusing namespace std;\ndouble sega[Maxn],segb[Maxn];\ndouble mark[Maxn];\nvoid pushup(int x)\n{\n    sega[x]=sega[x<<1]+sega[x<<1|1];\n    segb[x]=segb[x<<1]+segb[x<<1|1];\n}\nvoid pushdown(int rt,int x)\n{\n    if (mark[rt])\n    {\n        segb[rt<<1]+=2*mark[rt]*sega[rt<<1]+(x-x/2)*mark[rt]*mark[rt];\n        segb[rt<<1|1]+=2*mark[rt]*sega[rt<<1|1]+(x/2)*mark[rt]*mark[rt];\n        sega[rt<<1]+=(x-x/2)*mark[rt];\n        sega[rt<<1|1]+=(x/2)*mark[rt];\n        mark[rt<<1]+=mark[rt];\n        mark[rt<<1|1]+=mark[rt];\n        mark[rt]=0;\n    }\n}\nvoid build(int rt,int l,int r)\n{\n    if (l==r)\n        cin>>sega[rt],segb[rt]=sega[rt]*sega[rt];\n    else\n    {\n        int mid=(l+r)/2;\n        build(lson);\n        build(rson);\n        pushup(rt);\n    }\n}\ndouble query_a(int rt,int l,int r,int L,int R)\n{\n    //--L--l--r--R--\n    if (l>=L && r<=R)\n        return sega[rt];\n    else\n    {\n        pushdown(rt,r-l+1);\n        int mid=(r+l)/2;\n        double ret=0;\n        if (mid>=L)\n            ret+=query_a(lson,L,R);\n        if (mid<R)\n            ret+=query_a(rson,L,R);\n        return ret;\n    }\n}\ndouble query_b(int rt,int l,int r,int L,int R)\n{\n    //--L--l--r--R--\n    if (l>=L && r<=R)\n        return segb[rt];\n    else\n    {\n        pushdown(rt,r-l+1);\n        int mid=(r+l)/2;\n        double ret=0;\n        if (mid>=L)\n            ret+=query_b(lson,L,R);\n        if (mid<R)\n            ret+=query_b(rson,L,R);\n        return ret;\n    }\n}\nvoid update(int rt,int l,int r,int L,int R,double x)\n{\n    if (l>=L && r<=R)\n        mark[rt]+=x,segb[rt]+=2*x*sega[rt]+x*x*(r-l+1),sega[rt]+=(r-l+1)*x;\n    else\n    {\n        pushdown(rt,r-l+1);\n        int mid=(r+l)/2;\n        if (mid>=L)\n            update(lson,L,R,x);\n        if (mid<R)\n            update(rson,L,R,x);\n        pushup(rt);\n    }\n}\ndouble sqr(double x)\n{\n    return x*x;\n}\nmain()\n{\n    int n,m,x,y,c;\n    double z;\n    scanf(\"%d %d\",&n,&m);\n    build(1,1,n);\n    for (int i=1;i<=m;i++)\n    {\n        scanf(\"%d\",&c);\n        if (c==2)\n            scanf(\"%d%d\",&x,&y),printf(\"%.4lf\\n\",query_a(1,1,n,x,y)/(y-x+1));\n        if (c==1)\n            scanf(\"%d%d\",&x,&y),cin>>z,update(1,1,n,x,y,z);\n        if (c==3)\n        {\n            scanf(\"%d%d\",&x,&y);\n            double sum1=query_b(1,1,n,x,y)/(y-x+1),sum2=query_a(1,1,n,x,y)/(y-x+1);\n            double ans=sum1-sum2*sum2;\n            printf(\"%.4lf\\n\",ans);\n        }\n    }\n}\n```",
        "postTime": 1482754030,
        "uid": 17689,
        "name": "\u8fdc\u822a\u4e4b\u66f2",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "//update 2019/11/07 \u4fee\u6539Q4\u516c\u5f0f\u7ed3\u8bba\u9519\u8bef\uff08\u611f\u8c22\u7528\u6237@Jomoo\uff09\n\n`\u5f31\u5f31\u7684\u8bf4\u4e00\u53e5\uff0c\u611f\u89c9\u8fd9\u9053\u9898\u7edd\u5bf9\u8bc4\u5206\u4f4e\u4e86\u3002\u3002\u3002`\n\n## \u3010\u601d\u8def\u3011\n### Q1\uff1a\u5e73\u5747\u6570\u600e\u4e48\u505a\uff1f\n\u6839\u636e\u9898\u9762\u7684\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u6c42\u503c\uff0c\u53ef\u4ee5\u60f3\u5230\u7528\u7ebf\u6bb5\u6811\u533a\u95f4\u6c42\u548c\u3002\uff08\u5e73\u5747\u6570\u5c31\u662f\u8fd9\u4e48\u505a\u7684\uff09\n\n### Q2\uff1a\u90a3\u4e48\u65b9\u5dee\u600e\u4e48\u505a\uff1f\n\u6570\u5b66\u8001\u5e08\u66fe\u7ecf\u8bb2\u8fc7\uff0c\u65b9\u5dee\u53ef\u4ee5\u63a8\u51fa\u6765\u4e00\u4e2a\u516c\u5f0f\u3002\n### \u4e0b\u9762\u5c55\u793a\u5b8c\u6574\u63a8\u5bfc\u8fc7\u7a0b\u3002\n$$ S^2 = \\frac{1}{n} * [(x_1 - \\overline{x})^2 + (x_2 - \\overline{x})^2 + ...+(x_n - \\overline{x})^2 ]$$\n\u6839\u636e\u5b8c\u5168\u5e73\u65b9\u516c\u5f0f\uff1a\n$$(a + b)^2 = a^2 + 2ab + b^2$$\n\u5c55\u5f00\u5bfc\u51fa\uff1a\n$$S^2 = \\frac{1}{n} * ({x_1}^2 - 2{x_1}\\overline{x} + {\\overline{x}^2} + {x_2}^2 - 2{x_2}\\overline{x} + {\\overline{x}^2} + ... + {x_n}^2 - 2{x_n}\\overline{x} + {\\overline{x}^2})$$\n\u6574\u7406\u5f97\uff1a\n$$S^2 = \\frac{1}{n} * [({x_1}^2 + {x_2}^2 + ... + {x_n}^2)-2\\overline{x}(x_1 + x_2 + ...+x_n) + n\\overline{x}^2]$$\n\u56e0\u4e3a\uff1a\n$$n\\overline{x} = x_1 + x_2 + ... + x_n$$\n\u6240\u4ee5\uff0c\u539f\u5f0f\u5f97\uff1a\n$$S^2 = \\frac{1}{n} * [({x_1}^2 + {x_2}^2 + ... + {x_n}^2)-2n\\overline{x}^2 + n\\overline{x}^2]$$\n\u5373\uff1a\n$$S^2 = \\frac{1}{n} * [({x_1}^2 + {x_2}^2 + ... + {x_n}^2)-n\\overline{x}^2]$$\n\u6240\u4ee5\u5f97\u5230\uff1a\n$$S^2 = \\frac{({x_1}^2 + {x_2}^2 + ... + {x_n}^2)}{n} - \\overline{x}^2$$\n\n### Q3\uff1a\u5f97\u51fa\u516c\u5f0f\u540e\u600e\u4e48\u505a\uff1f\n\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u6c42\u51fa\u5e73\u5747\u6570$\\overline{x}$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u516c\u5f0f\u524d\u9762\u90a3\u4e00\u90e8\u5206\uff0c\u4e0d\u96be\u770b\u51fa\uff0c\u6211\u4eec\u53ea\u9700\u5199\u51fa\u53ef\u4ee5\u6c42\u5f97\u533a\u95f4\u5e73\u65b9\u548c\u7684\u7ebf\u6bb5\u6811\u5373\u53efAC\u3002\n\n\u5bf9\u4e8e\u8fd9\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u6211\u4eec\u9009\u62e9\u4e0e\u4e00\u822c\u7ebf\u6bb5\u6811\u4e00\u6837\u76f4\u63a5\u6c42\u548c\uff0c\u4e0d\u96be\u53d1\u73b0**\u4fee\u6539\u64cd\u4f5c\u4e0epushdown\u64cd\u4f5c**\u8981\u505a\u51fa\u6539\u53d8\u3002\n### Q4\uff1a\u600e\u4e48\u53d8\u5316\u4ee5\u6c42\u51fa\u533a\u95f4\u5e73\u65b9\u548c\uff1f\n\u5f88\u7b80\u5355\uff0c\u7531\u4e8e\u6211\u4eec\u533a\u95f4\u52a0\u4e00\u4e2a\u6570$k$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e32\u6570\uff0c\u8bbe\n$$sum1 = {x_1 + x_2 + ...+ x_n}$$\n$$sum2 = {x_1}^2 + {x_2}^2 + ... + {x_n} ^ 2$$\n\u800c\u4e14$sum1$\u4e0e$sum2$\u90fd\u662f\u5df2\u77e5\u91cf\u3002\n\n\u6211\u4eec\u8981\u628a\u533a\u95f4\u548c\u4e00\u6b21\u6027\u6539\u53d8\u4e3a\n$${(x_1 + k)}^2 +  {(x_2 + k)}^2 + ... +{(x_n + k)}^2$$\n\u4e5f\u662f\u5b8c\u5168\u5e73\u65b9\u5c55\u5f00\uff0c\u5f97\u5230\uff1a\n$${(x_1 + k)}^2 +  {(x_2 + k)}^2 + ... +{(x_n + k)}^2 = ({x_1}^2 + 2kx_1 + k^2) + ({x_2}^2 + 2kx_2 + k^2) + ... +({x_n}^2 + 2kx_n + k^2)$$\n$$=({x_1}^2 + {x_2}^2 +...+{x_n}^2) + 2k(x_1 + x_2 + ... + x_n)+nk^2$$\n$$=sum2 + 2k * sum1 + nk^2$$\n\u5c31\u53ef\u4ee5\u6539\u53d8\u4e86\uff0c$pushdown$\u4e5f\u662f\u540c\u7406\u3002\n\n### \u7136\u540e\u5176\u4ed6\u7684\u7167\u7ebf\u6bb5\u6811\u5199\u5c31AC\u4e86\n\n## \u3010\u4ee3\u7801\u3011\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ndouble a[100010];\n\nstruct node{\n    double sum, lazy;\n};\n\nnode t1[400010], t2[400010];\n\ninline void pushup(int rt)\n{\n    t1[rt].sum = t1[rt << 1].sum + t1[rt << 1 | 1].sum;\t\n    t2[rt].sum = t2[rt << 1].sum + t2[rt << 1 | 1].sum;\t\n}\n\ninline void pushdown(int rt, int l, int r)\n{\n    int mid = (l + r) >> 1;\n    t2[rt << 1].lazy += t2[rt].lazy;\n    t2[rt << 1].sum += t1[rt << 1].sum * (t2[rt].lazy * 2) + (mid - l + 1) * (t2[rt].lazy * t2[rt].lazy);\n    t2[rt << 1 | 1].lazy += t2[rt].lazy;\n    t2[rt << 1 | 1].sum += t1[rt << 1 | 1].sum * (t2[rt].lazy * 2) + (r - mid) * (t2[rt].lazy * t2[rt].lazy);\n    t2[rt].lazy = 0;\n    t1[rt << 1].lazy += t1[rt].lazy;\n    t1[rt << 1].sum += (mid - l + 1) * t1[rt].lazy;\n    t1[rt << 1 | 1].lazy += t1[rt].lazy;\n    t1[rt << 1 | 1].sum += (r - mid) * t1[rt].lazy;\t\n    t1[rt].lazy = 0;\n}\n\nvoid build(int rt, int l, int r)\n{\n    if (l == r) //\u53f6\u5b50\u8282\u70b9 \n    {\n        t1[rt].sum = a[l];\n        t2[rt].sum = a[l] * a[l];\n        return;\t\n    }\n    int mid = (l + r) >> 1;\n    build(rt << 1, l, mid);\n    build(rt << 1 | 1, mid + 1, r);\n    pushup(rt);\n}\n\ndouble query(node tree[], int rt, int l, int r, int x, int y)\n//\u5f53\u524d\u8282\u70b9\u4e3art,\u533a\u95f4\u4e3al\u5230r,\u6211\u4eec\u8981\u67e5\u8be2x\u5230y\n{\n    if (x <= l && r <= y) return tree[rt].sum;\n    int mid = (l + r) >> 1;\n    if (tree[rt].lazy) pushdown(rt, l, r);\n    double ans = 0;\n    if (x <= mid) ans = ans + query(tree, rt << 1, l, mid, x, y);\n    if (y > mid) ans = ans + query(tree, rt << 1 | 1, mid + 1, r, x, y);\n    pushup(rt);\n    return ans;\n}\n\nvoid modify(int rt, int l, int r, int x, int y , double z)\n//\u5f53\u524d\u8282\u70b9\u4e3art,\u533a\u95f4\u4e3al\u5230r\uff0c\u6211\u4eec\u628a\u533a\u95f4x\u5230y\u7684\u6bcf\u4e2a\u503c\u90fd\u4e0az \n{\n    if (x <= l && r <= y)\n    {\n        t2[rt].lazy += z;\n        t2[rt].sum += t1[rt].sum * (z * 2) + (r - l + 1) * (z * z);\n        t1[rt].lazy += z;\n        t1[rt].sum += (r - l + 1) * z;\n        return;\n    }\n    if (t1[rt].lazy || t2[rt].lazy) pushdown(rt, l, r); \n    int mid = (l + r) >> 1; \n    if (x <= mid) modify(rt << 1, l, mid, x, y, z);\n    if (y > mid) modify(rt << 1 | 1, mid + 1, r, x, y, z);\n    pushup(rt);\n}\nint n, m, opt;\nint main()\n{\n    scanf(\"%d%d\", &n, &m);\n    for (register int i = 1;i <= n;i ++)\n    {\n        scanf(\"%lf\", &a[i]);\n    }\n    build(1, 1, n);\n    while(m --)\n    {\n        scanf(\"%d\", &opt);\n        if(opt == 1)\n        {\n            int x, y;\n            double z;\n            scanf(\"%d%d%lf\", &x, &y, &z);\n            modify(1, 1, n, x, y, z);\n        }\n        if(opt == 2)\n        {\n            int x, y;\n            scanf(\"%d%d\", &x, &y);\n            printf(\"%.4lf\\n\", query(t1, 1, 1, n, x, y) / ((y - x + 1) * 1.0));\n        }\n        if(opt == 3)\n        {\n            int x, y;\n            scanf(\"%d%d\", &x, &y);\n            printf(\"%.4lf\\n\", (query(t2, 1, 1, n, x, y) / ((y - x + 1) * 1.0)) - (query(t1, 1, 1, n, x, y) / ((y - x + 1) * 1.0)) * (query(t1, 1, 1, n, x, y) / ((y - x + 1) * 1.0)));\n        }\n    }\n}\n```\n## \u3010\u6ce8\u610f\u3011\n\u4f18\u5148\u8003\u8651\u4e0a\u6587\u4e2d$sum2$\u5373\u5e73\u65b9\u548c\uff0c\u56e0\u4e3a\u6c42\u5e73\u65b9\u548c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u533a\u95f4\u548c\u662f\u6ca1\u6709\u4fee\u6539\u524d\u7684\u533a\u95f4\u548c\u3002\u7136\u540e\u518d\u8ba1\u7b97\u533a\u95f4\u548c\u3002\u4e0d\u7136\u5f88\u5bb9\u6613\u51fa\u9505\u3002",
        "postTime": 1555395723,
        "uid": 66511,
        "name": "DPair",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "# \u4e3a\u5206\u5757\u52a9\u5a01\uff0c\u628a\u8fd9\u9898\u8d34\u4e0a\u5206\u5757\u6807\u7b7e\uff01\n\n#### $Solution$\n\u5148\u5316\u7b80\u65b9\u5dee\u516c\u5f0f,$ave$\u4e3a\u5e73\u5747\u6570\n$$\\frac{(x_1-ave)^2+(x_2-ave)^2+\u2026+(x_{n-1}-ave)^2+(x_n-ave)^2}{n}$$\n\u5206\u914d\u5f8b\n$$\\frac{(x_1-ave)^2}{n}+\\frac{(x_2-ave)^2}{n}+\u2026+\\frac{(x_{n-1}-ave)^2}{n}+\\frac{(x_n-ave)^2}{n}$$\n\u7528\u6c42\u548c\u7b26\u53f7\u6846\u8d77\u6765\n$$\\frac{\\sum_{i\\in N}[(x_i-\\frac{\\sum x}{n})^2]}{n}$$\n\u5b8c\u5168\u5e73\u65b9\u548c\u516c\u5f0f\n$$\\frac{\\sum_{i\\in N}[(x_i)^2-\\frac{2x_i\\sum x}{n}+\\frac{(\\sum x)^2}{n^2}]}{n}$$\n\u5206\u914d\u5f8b\u518d\u62c9\n$$\\sum_{i\\in N}(\\frac{(x_i)^2}{n}-\\frac{2x_i\\sum x}{n^2}+\\frac{(\\sum x)^2}{n^3})$$\n\u5206\u914d\u5f8b\u518d\u62d6\n$$\\frac{(\\sum x)^2}{n^2}+\\sum_{i\\in N}(\\frac{(x_i)^2}{n}-\\frac{2x_i\\sum x}{n^2})$$\n\u8bbek\u4e3a$x$\u7684\u5e73\u65b9\u548c\uff0c\u5f97\u5230\n$$\\frac{(\\sum x)^2}{n^2}+(\\frac{k}{n}-\\frac{2(\\sum x)^2}{n^2})$$\n\u53bb\u62ec\u53f7+\u5408\u5e76\u540c\u7c7b\u9879\uff0c\u5f97\n$$\\frac{k}{n}-\\frac{(\\sum x)^2}{n^2}$$\n\u6570\u636e\u8303\u56f4\u662f$n\\leq 100000$\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u5206\u5757\u5206\u522b\u7ef4\u62a4\u533a\u95f4\u5e73\u65b9\u548c\u53ca\u533a\u95f4\u548c\uff0c\u7136\u540e\u56de\u7b54\u5373\u53ef\u3002\n\n***\n\n#### $Code$\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<cctype>\n#include<iostream>\n#include<algorithm>\nusing namespace std;typedef long long LL;\nint L[401],R[401],n,q,l,r,opt,x,pos[100010],t;\ndouble d,a[100010],sum[401],add[401],sumaf[401];\ninline long long read()\n{\n    char c;int d=1;long long f=0;\n    while(c=getchar(),!isdigit(c))if(c==45)d=-1;f=(f<<3)+(f<<1)+c-48;\n    while(c=getchar(),isdigit(c)) f=(f<<3)+(f<<1)+c-48;\n    return d*f;\n}\ninline void write(register long long x)\n{\n    if(x<0)putchar(45),x=-x;\n    if(x>9)write(x/10);\n    putchar(x%10+48);\n    return;\n}\ndouble sqr(double x){return x*x;}\nvoid Add(register int l,register int r,double x)//\u533a\u95f4\u4fee\u6539\n{\n    int pl=pos[l],pr=pos[r];\n    if(pl==pr)//\u540c\u5757\u5185\u66b4\u529b\u6539\n    {\n        for(register int i=l;i<=r;i++) sumaf[pl]+=2*a[i]*x+sqr(x),a[i]+=x,sum[pl]+=x;\n        return;\n    }\n    for(register int i=l;i<=R[pl];i++) sumaf[pl]+=2*a[i]*x+sqr(x),a[i]+=x,sum[pl]+=x;\n    for(register int i=L[pr];i<=r;i++) sumaf[pr]+=2*a[i]*x+sqr(x),a[i]+=x,sum[pr]+=x;//\u4e24\u8fb9\u66b4\u529b\u6539\n    for(register int i=pl+1;i<pr;i++) add[i]+=x;//\u4e2d\u95f4+lazy\n    return;\n}\ndouble ask(register int l,register int r)//\u67e5\u8be2\u533a\u95f4\u548c/\u533a\u95f4\u957f\u5ea6=\u5e73\u5747\u6570\n{\n    int pl=pos[l],pr=pos[r],len=r-l+1;\n    double ans=0;\n    if(pl==pr)//\u540c\u5757\u5185\u66b4\u529b\u6c42\n    {\n        for(register int i=l;i<=r;i++) ans+=a[i]+add[pl];\n        return ans/1.0/len;\n    }\n    else\n    {\n        for(register int i=l;i<=R[pl];i++) ans+=a[i]+add[pl];\n        for(register int i=L[pr];i<=r;i++) ans+=a[i]+add[pr];//\u4e24\u8fb9\u66b4\u529b\u6539\n        for(register int i=pl+1;i<pr;i++) ans+=sum[i]+add[i]*t;//\u4e2d\u95f4+lazy\u548csum\n        return ans/1.0/len;\n    }\n}\ndouble askfc(register int l,register int r)\n{\n    int len=r-l+1,pl=pos[l],pr=pos[r];double ave=0,ans=0,answer=0;\n    if(pl==pr)//\u540c\u4e00\u5757\u66b4\u529b\u6539\n    {\n        for(register int i=l;i<=r;i++) ave+=a[i]+add[pl],ans+=sqr(a[i]+add[pl]);\n        return ans/len-sqr(ave/len);\n    }\n    for(register int i=l;i<=R[pl];i++) ave+=a[i]+add[pl],ans+=sqr(a[i]+add[pl]);\n    for(register int i=L[pr];i<=r;i++) ave+=a[i]+add[pr],ans+=sqr(a[i]+add[pr]);//\u4e24\u8fb9\u66b4\u529b\u6539\n    for(register int i=pl+1;i<pr;i++) ave+=sum[i]+add[i]*t,ans+=sumaf[i]+2*sum[i]*add[i]+t*sqr(add[i]);//\u4e2d\u95f4lazy+sum\u6539\n    answer=ans/len-sqr(ave/len);\n    return answer;\n}\nsigned main()\n{\n\tfreopen(\"1.txt\",\"r\",stdin);\n    n=read();q=read();t=(int)sqrt(n)+1;\n    for(register int i=1;i<=n;i++) scanf(\"%lf\",a+i);\n    for(register int i=1;i<=t;i++) \n    {\n        L[i]=R[i-1]+1,R[i]=min(R[i-1]+t,n);\n        for(register int j=L[i];j<=R[i];j++) pos[j]=i,sum[i]+=a[j],sumaf[i]+=sqr(a[j]);//\u9884\u5904\u7406\n    }\n    while(q--)\n    {\n        opt=read();\n        if(opt==1)\n        {\n            l=read();r=read();scanf(\"%lf\",&d);\n            Add(l,r,d);\n        }\n        if(opt==2)\n        {\n            l=read();r=read();\n            printf(\"%.4lf\\n\",ask(l,r));\n        }\n        if(opt==3)\n        {\n            l=read();r=read();\n            printf(\"%.4lf\\n\",askfc(l,r));\n        }\n    }\n}\n```",
        "postTime": 1548076829,
        "uid": 52915,
        "name": "Ajwallet",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u770b\u4e86\u5404\u5927\u9898\u89e3\uff0c\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e2a\u533a\u95f4\uff0c\u90fd\u8981\u7ef4\u62a4\u4e94\u4e2a\u503c\uff1a\r\n\r\n\u533a\u95f4\u5e73\u65b9\u548c\uff0c\u533a\u95f4\u548c\uff0c\u533a\u95f4\u5e73\u5747\uff0c\u533a\u95f4\u65b9\u5dee\uff0c\u533a\u95f4\u957f\u5ea6\r\n\r\n\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u8fce\u63a5\u4e0d\u4e00\u6837\u7684\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6cd5\uff01\r\n\r\n\u5148\u63d0\u4e94\u4e2a\u95ee\u9898\uff1a\r\n\r\n1. \u8981\u7ef4\u62a4\u4ec0\u4e48\u4fe1\u606f\uff1f\r\n\r\n\t\u533a\u95f4\u548c\uff0c\u533a\u95f4\u5e73\u5747\uff0c\u533a\u95f4\u65b9\u5dee\uff0c\u533a\u95f4\u957f\u5ea6\r\n2. \u9700\u8981\u4ec0\u4e48\u6807\u8bb0\uff1f\r\n\r\n\t\u533a\u95f4\u52a0\u6807\u8bb0\r\n    \r\n3. \u5982\u4f55\u53e0\u52a0\u6807\u8bb0\uff1f\r\n\r\n\t\u5728\u539f\u6709\u6807\u8bb0\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u65b0\u6807\u8bb0\r\n    \r\n4. \u5982\u4f55\u5bf9\u533a\u95f4\u8fdb\u884c\u6574\u4f53\u4fee\u6539\uff1f\r\n\t\r\n    \u8bbe\u6574\u4e2a\u533a\u95f4\u4e2d\u7684\u6bcf\u4e2a\u6570\u52a0\u4e0a $v$\r\n    \r\n    \u5219\u533a\u95f4\u548c\u52a0\u4e0a\u533a\u95f4\u957f\u5ea6\u4e58 $v$\r\n    \r\n\t\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u6bcf\u4e2a\u6570\u52a0\u4e0a $v$ \u5e73\u5747\u6570\u4e5f\u52a0\u4e0a $v$\uff08\u52a0\u4e0a\u7684 $len$ \u4e2a v \u518d\u9664\u4ee5 $len$\uff0c\u76f8\u5f53\u4e8e\u52a0 $v$ ($len$ \u8868\u793a\u533a\u95f4\u957f\u5ea6\uff09\r\n    \r\n    \u800c\u65b9\u5dee\u4e0d\u4f1a\u6539\u53d8\u3002\uff08\u56e0\u4e3a\u4f5c\u5dee\u540e $v$ \u88ab\u6d88\u6389\uff09\r\n    \r\n5. \u5982\u4f55\u8fdb\u884c\u533a\u95f4\u5408\u5e76\uff1f\r\n\r\n\t\u8fd9\u662f\u672c\u9898\u7684\u91cd\u70b9\u3002\r\n    \r\n    \u533a\u95f4\u548c\u4ee5\u53ca\u533a\u95f4\u957f\u5ea6\u8f83\u597d\u7ef4\u62a4\uff0c\u76f4\u63a5\u52a0\u5373\u53ef\u3002\r\n    \r\n    \u533a\u95f4\u5e73\u5747\u6570\u5219\u53ef\u4ee5\u5229\u7528\u5df2\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u7528\u548c\u9664\u4ee5\u957f\u5ea6\u3002\r\n    \r\n    \u533a\u95f4\u65b9\u5dee\u662f\u6700\u96be\u7684\u3002\r\n    \r\n    \u8bbe\u5de6\u513f\u5b50\u533a\u95f4\u4e3a $a[1],a[2],\\dots a[n]$\uff0c\u8fd9\u4e9b\u6570\u7684\u5e73\u5747\u6570\u4e3a $aver_a$\uff0c\u65b9\u5dee\u4e3a $fang_a$\uff0c\u548c\u4e3a $sum_a$\r\n    \r\n    \u53f3\u513f\u5b50\u533a\u95f4\u4e3a $b[1],b[2],\\dots b[m]$\uff0c\u8fd9\u4e9b\u6570\u7684\u5e73\u5747\u6570\u4e3a $aver_b$\uff0c\u65b9\u5dee\u4e3a $fang_b$\uff0c\u548c\u4e3a $sum_b$\r\n    \r\n    \u5408\u5e76\u540e\u7684\u533a\u95f4\u5e73\u5747\u6570\u4e3a $aver$\r\n    \r\n    \u5219\u65b9\u5dee\u4e3a $\\frac{\\sum_{j=1}^n (a[j]-aver)^2+\\sum_{j=1}^m (b[j]-aver)^2}{n+m}$\r\n    \r\n    \u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4ece$\\sum (a[j]-aver_a)^2$ \u5230 $\\sum (a[j]-aver)^2$ \u4ea7\u751f\u7684\u53d8\u5316\uff0c\u4ece\u800c\u5c06\u52a0\u53f7\u7684\u5de6\u53f3\u4e24\u90e8\u5206\u90fd\u53d8\u4e3a\u53ef\u4ee5\u7528$\\Theta(1)$ \u7684\u65f6\u95f4\u5f97\u5230\u7684\u7ed3\u679c\u3002\r\n    \r\n    \u8bbe$decrease=aver_a-aver$\r\n    \r\n    \u5219 $\\sum (a[j]-aver)^2 = \\sum (a[j]-aver_a+decrease)^2$\r\n    \r\n    $=\\sum((a[j]-aver_a)^2+2 \\times (a[j]-aver_a) \\times decrease +decrease^2)$\r\n    \r\n    $=n \\times fang_a + \\sum (2 \\times a[j] \\times decrease-2 \\times aver_a \\times decrease+decrease^2)$\r\n    \r\n    $=n\\times fang_a+sum_a\\times 2\\times decrease-2\\times aver_a \\times n \\times decrease+n\\times decrease^2$\r\n    \r\n    \u662f\u4e0d\u662f\u5f88\u590d\u6742\uff1f\u4e0d\u6025\uff0c\u6211\u4eec\u53d1\u73b0\uff1a$sum_a=aver_a \\times n$\r\n    \r\n    \u4e8e\u662f\u4e0a\u5f0f\u6210\u529f\u5730\u88ab\u5316\u7b80\u4e3a $n\\times fang_a+n\\times decrease^2$\r\n    \r\n    \u53f3\u513f\u5b50\u533a\u95f4\u53ef\u8fdb\u884c\u7c7b\u4f3c\u53d8\u6362\u3002\r\n    \r\n    \u4e8e\u662f\u6211\u4eec\u5c31\u6c42\u51fa\u4e86\u533a\u95f4\u65b9\u5dee\u3002\r\n    \r\n    \r\n\u5b8c\u6574\u4ee3\u7801\uff1a\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\n/*\r\nsigma (a[i]-(a-increase))^2  //\u63a8\u5bfc\u8fc7\u7a0b\uff0c\u5176\u4e2d\u7684increase \u5c31\u662f\u9898\u89e3\u4e2d\u7684 decrease \r\nsigma (a[i]-a+increase)^2\r\nsigma (a[i]-a)^2+increase^2+2*(a[i]-a)*increase\r\n fang*len+ sigma increase^2+2*a[i]*increase-2*a*increase\r\nfang*len+2*sum*increase+len*increase^2 -2*a*len*increase\r\n*/\r\ntypedef double ld;\r\nconst int N=1e5+5; \r\nstruct node{  //\u8868\u793a\u533a\u95f4\u7684\u7ed3\u6784\u4f53 \r\n\tld tag,sum,fang,l,r,aver,len;  //fang \u8868\u793a\u65b9\u5dee \r\n\tnode() { tag=sum=fang=l=r=0;}\r\n}tr[N<<2];\r\nnode none;   //\u5229\u7528\u6784\u9020\u51fd\u6570\u6784\u9020\u4e00\u4e2a\u7a7a\u533a\u95f4 \r\nld Plus(node a,ld increase)   //\u5c06 sigma (a[j]-aver_a)^2 \u53d8\u4e3a sigma (a[j]-aver)^2 \r\n{\r\n\t\r\n\treturn a.fang*a.len+a.len*increase*increase;\r\n}\r\nnode operator +(const node &a,const node &b)  //\u533a\u95f4\u5408\u5e76 \r\n{\r\n\tnode c;\r\n\tc.l=a.l;\r\n\tc.r=b.r;  //\u533a\u95f4\u5de6\u53f3\u7aef\u70b9\r\n\t\t\t  //\u4ece\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5e76\u4e0d\u6ee1\u8db3\u4ea4\u6362\u5f8b\uff0c\u6253\u4ee3\u7801\u65f6\u5343\u4e07\u522b\u5199\u53cd \r\n\tc.sum=a.sum+b.sum;\r\n\tc.len=a.len+b.len;    //\u533a\u95f4\u548c\u4ee5\u53ca\u533a\u95f4\u957f\u5ea6 \r\n\tc.aver=c.sum/c.len;   //\u533a\u95f4\u5e73\u5747 \r\n\tld increase1=a.aver-c.aver,increase2=b.aver-c.aver;  //\u5de6\u53f3\u4e24\u8fb9\u7684decrease \r\n\tc.fang=Plus(a,increase1)+Plus(b,increase2);  //\u5408\u5e76\u65b9\u5dee \r\n\tc.fang/=c.len;   //\u8bb0\u5f97\u9664 \r\n\tc.tag=0;\r\n\treturn c;\r\n}\r\nint n,m;\r\nld val[N];\r\n#define ls (k<<1)\r\n#define rs (k<<1|1)   //\u5b8f\u5b9a\u4e49\u4f7f\u7801\u98ce\u66f4\u52a0\u7b80\u6d01 \r\nvoid build(int k,int l,int r)  //\u5efa\u6811 \r\n{\r\n\ttr[k].l=l;\r\n\ttr[k].r=r;\r\n\tif(l==r)\r\n\t{\r\n\t\ttr[k].len=1;\r\n\t\ttr[k].sum=tr[k].aver=val[l];   //\u521d\u59cb\u7684\u5e73\u5747\u503c\u5f53\u7136\u662f\u81ea\u5df1\u4e86 \r\n\t\ttr[k].tag=0;\r\n\t\ttr[k].fang=0;  //\u65b9\u5dee\u663e\u7136\u4e3a0 \r\n\t\treturn;\r\n\t}\r\n\tint mid=l+r>>1;\r\n\tbuild(ls,l,mid);\r\n\tbuild(rs,mid+1,r);\r\n\ttr[k]=tr[ls]+tr[rs];  //\u533a\u95f4\u5408\u5e76 \r\n}\r\ninline void Add(int k,ld v)  //\u533a\u95f4\u6574\u4f53\u52a0\uff0c\u65b9\u5dee\u4e0d\u53d8 \r\n{\r\n\ttr[k].tag+=v;  //\u53e0\u52a0\u6807\u8bb0 \r\n\ttr[k].sum+=tr[k].len*v;\r\n\ttr[k].aver+=v;    //\u5e73\u5747\u6570\u52a0\u4e0av\r\n}\r\ninline void pushdown(int k)  //\u4e0b\u4f20\u6807\u8bb0 \r\n{\r\n\tif(tr[k].tag==0) return;\r\n\tAdd(ls,tr[k].tag);\r\n\tAdd(rs,tr[k].tag);\r\n\ttr[k].tag=0;\r\n}\r\ninline void modify(int k,int x,int y,ld v)  //\u533a\u95f4\u4fee\u6539 \r\n{\r\n\tif(tr[k].l>y||tr[k].r<x) return;\r\n\tif(x<=tr[k].l&&tr[k].r<=y)\r\n\treturn Add(k,v);\r\n\tpushdown(k);   //\u8bb0\u5f97\u4e0b\u4f20\u6807\u8bb0 \r\n\tmodify(ls,x,y,v);\r\n\tmodify(rs,x,y,v);\r\n\ttr[k]=tr[ls]+tr[rs];\r\n}\r\ninline node query(int k,int x,int y)\r\n{\r\n\tif(tr[k].l>y||tr[k].r<x) return none;  //\u8fd4\u56de\u4e00\u4e2a\u7a7a\u533a\u95f4 \r\n\tif(x<=tr[k].l&&tr[k].r<=y)\r\n\treturn tr[k];  //\u8fd4\u56de\u7ef4\u62a4\u597d\u7684\u533a\u95f4 \r\n\tpushdown(k);\r\n\treturn query(ls,x,y)+query(rs,x,y);   //\u5408\u5e76\u7ed3\u679c \r\n}\r\nint main(){\r\n\tscanf(\"%d%d\",&n,&m);\r\n\tfor(int i=1;i<=n;i++) scanf(\"%lf\",&val[i]);\r\n\tbuild(1,1,n);\r\n\tfor(int i=1;i<=m;i++)\r\n\t{\r\n\t\tint opt,x,y;ld v;\r\n\t\tscanf(\"%d\",&opt);\r\n\t\tif(opt==1)   //\u6700\u597d\u4e0d\u8981\u7528 switch,\u6709\u70b9\u5371\u9669 \r\n\t\t{\r\n\t\t\tscanf(\"%d%d%lf\",&x,&y,&v);\r\n\t\t\tmodify(1,x,y,v);\r\n\t\t}\r\n\t\tif(opt==2)\r\n\t\tscanf(\"%d%d\",&x,&y),printf(\"%.4lf\\n\",query(1,x,y).aver);\r\n\t\tif(opt==3) scanf(\"%d%d\",&x,&y),printf(\"%.4lf\\n\",query(1,x,y).fang);\r\n\t}\r\n}\r\n```\r\n    ",
        "postTime": 1593844382,
        "uid": 226435,
        "name": "\u5929\u547d\u4e4b\u8def",
        "ccfLevel": 0,
        "title": "P1471\u2014\u2014\u4e0d\u4e00\u6837\u7684\u7ebf\u6bb5\u6811\u505a\u6cd5"
    },
    {
        "content": "\n\n\u6211\u4eec\u53ef\u4ee5\u8bbe   \n$ sum1[n]=a[1]+a[2]+\\cdots+a[n] $    \n$ sum2[n]=a[1]^{2}+a[2]^{2}+\\cdots+a[n]^{2} $\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8868\u793a\u51fa\u65b9\u5dee\u4e86\n\n#### \u65b9\u5dee\u516c\u5f0f\u5c55\u5f00\uff1a\n\n$ \\frac {\\sum_{i=1}^{n} (a[i]-\\overline{a})^{2} } {n}  $\n\n$ = \\frac {(a[1]-\\overline{a})^{2} + (a[2]-\\overline{a})^{2} + \\cdots +(a[n]-\\overline{a})^{2} } {n} $\n\n$ = \\frac{a[1]^{2} + a[2]^{2} + \\cdots +a[n]^{2}- 2 \\overline{a}(a[1] + a[2] + \\cdots +a[n] ) +n\\overline{a}^{2} }{n} $\n\n$ = \\frac{a[1]^{2} + a[2]^{2} + \\cdots +a[n]^{2} }{n} - 2\\overline{a}  \\frac{a[1]+a[2]+\\cdots+a[n]}{n}+\\overline{a}^{2} $\n\n$ = \\frac{a[1]^{2} + a[2]^{2} + \\cdots +a[n]^{2} }{n} - 2\\overline{a}^{2}+\\overline{a}^{2} $\n\n$ = \\frac{a[1]^{2} + a[2]^{2} + \\cdots +a[n]^{2} }{n} - \\overline{a}^{2} $\n\n$ = \\frac{sum2[n]}{n} - \\overline{a}^{2} $\n\n\u81f3\u4e8e\u4fee\u6539\u4e5f\u5f88\u7b80\u5355\u4e86\n\n#### \u533a\u95f4\u52a0\u5c55\u5f00\uff1a\n\n$ \\sum_{i=1}^{n} (a[i]+x)^{2}  $\n\n$ = (a[1]+x)^{2} + (a[2]+x)^{2} + \\cdots +(a[n]+x)^{2}  $\n\n$ = a[1]^{2} + a[2]^{2} + \\cdots +a[n]^{2}+ 2 x(a[1] + a[2] + \\cdots +a[n] ) +nx^{2}  $\n\n$ = sum2[n]+ 2 x $ $sum1[n] +nx^{2}  $\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u7528\u5e26lazy\u7684\u7ebf\u6bb5\u6811\u6765\u89e3\u51b3\n\n###### *\u6ce8\u610f\uff1a\u4f18\u5148\u7ea7\u5e94\u8be5\u662f\u8981\u5148\u5904\u7406sum2\uff0c\u518d\u5904\u7406sum1\n\n\u4e11\u964b\u7684\u4ee3\u7801\u5982\u4e0b:\n```\n#include<cstdio>\n\n#define ll long long\n#define lc(x) (x<<1)\n#define rc(x) (x<<1|1)\n\nconst ll maxn=100000;\n\ndouble sum1[(maxn<<2)+5],sum2[(maxn)<<2+5];\ndouble lazy[(maxn<<2)+5];\n\ninline void pushup(ll v){\n    sum1[v]=sum1[lc(v)]+sum1[rc(v)];\n    sum2[v]=sum2[lc(v)]+sum2[rc(v)];\n}\n\ninline void pushdown(ll v,ll l,ll r){\n    if(lazy[v]){\n        ll mid=l+r>>1;\n        lazy[lc(v)]+=lazy[v];\n        lazy[rc(v)]+=lazy[v];\n        sum2[lc(v)]+=2.0*lazy[v]*sum1[lc(v)]+(mid-l+1)*lazy[v]*lazy[v];\n        sum2[rc(v)]+=2.0*lazy[v]*sum1[rc(v)]+(r-mid)*lazy[v]*lazy[v];\n        sum1[lc(v)]+=lazy[v]*(mid-l+1);\n        sum1[rc(v)]+=lazy[v]*(r-mid);\n        lazy[v]=0;\n    }\n}\n\nvoid update(ll v,ll l,ll r,ll left,ll right,double add){\n    if(left<=l&&r<=right){lazy[v]+=add,sum2[v]+=2.0*sum1[v]*add+(r-l+1)*add*add,sum1[v]+=add*(r-l+1);return;}\n    ll mid=l+r>>1;\n    pushdown(v,l,r);\n    if(left<=mid)update(lc(v),l,mid,left,right,add);\n    if(right>mid)update(rc(v),mid+1,r,left,right,add);\n    pushup(v);\n}\n\ndouble query_a(ll v,ll l,ll r,ll left,ll right){\n    if(left<=l&&r<=right){return sum1[v];}\n    ll mid=l+r>>1;double ans=0;\n    pushdown(v,l,r);\n    if(left<=mid)ans+=query_a(lc(v),l,mid,left,right);\n    if(right>mid)ans+=query_a(rc(v),mid+1,r,left,right);\n    return ans;\n}\n\ndouble query_b(ll v,ll l,ll r,ll left,ll right){\n    if(left<=l&&r<=right){return sum2[v];}\n    ll mid=l+r>>1;double ans=0;\n    pushdown(v,l,r);\n    if(left<=mid)ans+=query_b(lc(v),l,mid,left,right);\n    if(right>mid)ans+=query_b(rc(v),mid+1,r,left,right);\n    return ans;\n}\n\nll n,m;\nint main(){\n    scanf(\"%lld%lld\",&n,&m);\n    for(ll i=1;i<=n;i++){\n        double p;scanf(\"%lf\",&p);\n        update(1,1,n,i,i,p);\n    }\n    for(ll i=1;i<=m;i++){\n        ll op,l,r;scanf(\"%lld%lld%lld\",&op,&l,&r);\n        if(op==1){\n            double k;scanf(\"%lf\",&k);\n            update(1,1,n,l,r,k);\n        }\n        if(op==2){\n            double ans=(double)query_a(1,1,n,l,r)/(r-l+1);\n            printf(\"%.4lf\\n\",(double)ans);\n        }\n        if(op==3){\n            double ans=(double)query_a(1,1,n,l,r)/(r-l+1);\n            double ans1=(double)query_b(1,1,n,l,r)/(r-l+1);\n            double ans2=(double)ans1-(double)ans*ans;\n            printf(\"%.4lf\\n\",(double)ans2);\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1542281366,
        "uid": 24685,
        "name": "IzumiSagiri",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "**\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5e73\u5747\u6570\u548c\u65b9\u5dee**\n\n\u5e73\u5747\u6570\u5f88\u597d\u641e\uff0c\u7ef4\u62a4\u533a\u95f4\u548c\uff0c\u7136\u540e\u9664\u4ee5\u533a\u95f4\u957f\u5ea6\u5c31\u884c\u4e86\n\n\u90a3\u65b9\u5dee\u5982\u4f55\u7ef4\u62a4\u5462\uff1f\n\n\u5148\u5f97\u63a8\u4e00\u6ce2\u5f0f\u5b50\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/xtzvd8lw.png)\n\n\u7136\u540e\u53d1\u73b0\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u533a\u95f4\u548c\u8fd8\u6709\u4e00\u4e2a\u533a\u95f4\u5e73\u65b9\u548c\u5c31\u53ef\u4ee5\u4e86\n\n\u4fee\u6539\u7684\u65f6\u5019\u5148\u4fee\u6539\u533a\u95f4\u5e73\u65b9\u548c\uff0c\u518d\u4fee\u6539\u533a\u95f4\u548c\u3002\n\n\u7279\u522b\u6ce8\u610f\u7684\uff1a\u9898\u76ee\u4e2d\u8bf4\u662f\u5b9e\u6570\uff0c\u6240\u4ee5\u539f\u5e8f\u5217\u4e2d\u7684\u6570\uff0c\u548c\u533a\u95f4\u52a0\u7684\u6570\u90fd\u4e3a\u5c0f\u6570\uff0c\u90fd\u8981\u5f00double\u50a8\u5b58\n\nprintf\u8f93\u51fadouble\u578b\u4e3a%f\u3002\n\n\u8fd9\u9898\u4e5f\u5c31\u6ca1\u4ec0\u4e48\u4e86\n\n\u9644\u4e0a\u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#define R register\n#define LL long long\n#define lson k<<1,l,mid    //\u65e5\u5e38\u4e3a\u4e86\u7701\u7801\u91cf\u548c\u597d\u770b\n#define rson k<<1|1,mid+1,r\n#define mid ((l+r)>>1)\n#define ls k<<1\n#define rs k<<1|1\n#define sum(rt) tr[rt].sum\n#define pf(rt) tr[rt].pf\n#define laz(rt) tr[rt].laz\nusing namespace std;\nconst int maxn=100005;\nint n,m;\ndouble a[maxn];\nstruct node{\n\tdouble sum,pf,laz;\n}tr[maxn<<2];\ninline int read(){\n    R int s=0,w=1;\n    R char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){s=s*10+ch-'0';ch=getchar();}\n    return s*w;\n}\ninline void update(R int k){\n\tsum(k)=sum(ls)+sum(rs);\n\tpf(k)=pf(ls)+pf(rs);\n}\nvoid build(R int k,R int l,R int r){\n\tif(l==r){\n\t\tsum(k)=a[l];\n\t\tpf(k)=a[l]*a[l];\n\t\treturn ;\n\t}\n\tbuild(lson);build(rson);\n\tupdate(k);\n}\ninline void down(R int k,R int l,R int r){\n\tpf(ls)=pf(ls)+2*laz(k)*sum(ls)+(mid-l+1)*laz(k)*laz(k);\n\tsum(ls)=sum(ls)+laz(k)*(mid-l+1);\n\tlaz(ls)+=laz(k);\n\tpf(rs)=pf(rs)+2*laz(k)*sum(rs)+(r-mid)*laz(k)*laz(k);\n\tsum(rs)=sum(rs)+laz(k)*(r-mid);\n\tlaz(rs)+=laz(k);\n\tlaz(k)=0;\n}\nvoid change(R int k,R int l,R int r,R int x,R int y,double z){\n\tif(l==x&&y==r){\n\t\tpf(k)=pf(k)+2*z*sum(k)+(r-l+1)*z*z;\n\t\tsum(k)=sum(k)+z*(r-l+1);\n\t\tlaz(k)+=z;\n\t\treturn ;\n\t}\n\tif(laz(k))down(k,l,r);\n\tif(y<=mid)change(lson,x,y,z);\n\telse if(x>mid)change(rson,x,y,z);\n\telse change(lson,x,mid,z),change(rson,mid+1,y,z);\n\tupdate(k);\n}\ndouble ask1(R int k,R int l,R int r,R int x,R int y){\n\tif(l==x&&y==r){\n\t\treturn sum(k);\n\t}\n\tif(laz(k))down(k,l,r);\n\tif(y<=mid)return ask1(lson,x,y);\n\telse if(x>mid)return ask1(rson,x,y);\n\telse return ask1(lson,x,mid)+ask1(rson,mid+1,y);\n}\ndouble ask2(R int k,R int l,R int r,R int x,R int y){\n\tif(l==x&&y==r){\n\t\treturn pf(k);\n\t}\n\tif(laz(k))down(k,l,r);\n\tif(y<=mid)return ask2(lson,x,y);\n\telse if(x>mid)return ask2(rson,x,y);\n\telse return ask2(lson,x,mid)+ask2(rson,mid+1,y);\n}\nint main(){\n\tn=read();m=read();\n\tfor(R int i=1;i<=n;++i)\n\t\tscanf(\"%lf\",&a[i]);\n\tbuild(1,1,n);\n\tR int opt,x,y;\n\tdouble tot,ans,ans2,z;\n\twhile(m--){\n\t\topt=read();\n\t\tif(opt==1){\n\t\t\tx=read();y=read();\n\t\t\tscanf(\"%lf\",&z);\n\t\t\tchange(1,1,n,x,y,z);\n\t\t}\n\t\telse if(opt==2){\n\t\t\tx=read();y=read();\n\t\t\ttot=ask1(1,1,n,x,y)/(y-x+1);\n\t\t\tprintf(\"%.4f\\n\",tot);\n\t\t}\n\t\telse if(opt==3){\n\t\t\tx=read();y=read();\n\t\t\tans=ask1(1,1,n,x,y)/(y-x+1);\n\t\t\tans2=ask2(1,1,n,x,y);\n\t\t\ttot=ans2/(y-x+1)-ans*ans;\n\t\t\tprintf(\"%.4f\\n\",tot);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1568815083,
        "uid": 151768,
        "name": "\u6d41\u901d\u4e36",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u770b\u5230\u533a\u95f4\u64cd\u4f5c\uff0c\u6beb\u65e0\u7591\u95ee\u60f3\u5230\u7ebf\u6bb5\u6811\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c1\uff0c\u61d2\u6807\u8bb0\u5c31\u53ef\u4ee5\u505a\u5230\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c2\uff0c\u6c42\u548c\u7136\u540e\u9664\u4ee5\u533a\u95f4\u957f\u5ea6\u5c31\u53ef\u4ee5\u505a\u5230\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c3\uff0c\u5c1d\u8bd5\u5c55\u5f00\u65b9\u5dee\u7684\u8868\u8fbe\u5f0f\uff1a\n\n\u5148\u4e0d\u7ba1\u9898\u76ee\u6240\u7ed9\u7684$\\frac{1}{n}$\n\n$$\\sum_{i=1}^{n}(A_i-\\overline A)^2=\\sum_{i=1}^{n} {A_i}^2-2Ai+{\\overline A}^2$$\n\n\u89c2\u5bdf\u5f0f\u5b50\uff0c\u53d1\u73b0\u5171\u6709n\u4e2a$\\overline A$\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u5c06$n\\overline A$\u8ba1\u5165\u7b54\u6848\uff0c\u7136\u540e\u5269\u4f59\u7684\u7b54\u6848\u5c31\u662f$$\\sum_{i=1}^{n}{A_i}^2+\\sum_{i=1}^{n}-2A_i$$\n\n\u4e5f\u5c31\u662f\u533a\u95f4\u7684\u5e73\u65b9\u548c\u52a0\u4e0a\u533a\u95f4\u7684\u548c\u4e58\u4ee5-2\u3002\n\n\u8fd9\u6837\u6c42\u65b9\u5dee\u7684\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002\n\n\n\u90a3\u4e48\u4e0b\u4f20\u6807\u8bb0\u65f6\u5462\uff1f\n\n\u8bbe\u5f53\u524d\u548c\u7684\u6807\u8bb0\u4e3a$inc[rt]$\uff0c\u663e\u7136\u66f4\u65b0$sum[rt]+=inc[rt]*(r-l+1)$\uff0c$sqrsum[rt]$\u5373\u5e73\u65b9\u548c\u5982\u4f55\u66f4\u65b0\u5462\uff1f\n\n\u8bbe\u539f\u6765\u7684\u5e73\u65b9\u548c\u4e3a$$\\sum_{i=l}^{r}{A_i}^2$$\uff0c\u90a3\u4e48\u73b0\u5728\u7684\u5e73\u65b9\u548c\u5373\u4e3a\uff1a$$\\sum_{i=l}^{r}(A_i+k)^2$$\uff0c\u5c55\u5f00\u5f97\uff1a$$\\sum_{i=l}^{r}{A_i}^2+2kA_i+k^2$$\u4e5f\u5373\u662f\u539f\u6765\u7684\u5e73\u65b9\u548csqrsum[rt]\u52a0\u4e0ak\u4e0esum[rt]\u7684\u4e58\u79ef\u7684\u4e24\u500d\uff0c\u518d\u52a0\u4e0a(r-l+1)\\*k^2\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86sqrsum\u4e0b\u4f20\u7684\u95ee\u9898\u3002\n\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <cstring>\n\nconst int N = 100007;\nint n, q, d, x, y;\ndouble t;\nstruct SegmentTree\n{\n    double sum[N * 4], sqr_sum[N * 4], inc[N * 4]; //sum\u4e3a\u5404\u6570\u4e4b\u548c\uff0csqr_sum\u4e3a\u5404\u6570\u5e73\u65b9\u4e4b\u548c\uff0cinc\u4e3a\u589e\u52a0\u7684\u6570\n\n    void down(int rt, int l, int r) //\u6807\u8bb0\u4e0b\u4f20\n    {\n        if (inc[rt] == 0.0) return; //\u7b49\u4e8e0\u65f6\u65e0\u9700\u4e0b\u4f20\n        if (l != r) //\u975e\u53f6\u5b50\u8282\u70b9\n        {\n            inc[rt << 1] += inc[rt]; //\u4e0b\u4f20\u6807\u8bb0\n            inc[rt << 1 | 1] += inc[rt]; //\u4e0b\u4f20\u6807\u8bb0\n        }\n        sqr_sum[rt] += 2 * inc[rt] * sum[rt] + inc[rt] * inc[rt] * (r - l + 1); //\u6ce8\u610f\u987a\u5e8f\uff0c\u66f4\u65b0sqr_sum\u9700\u8981\u539f\u6765\u7684sum\uff0c\u56e0\u6b64\u5148\u66f4\u65b0sqr_sum\uff0c\u6211\u539f\u6765\u5c31\u662f\u56e0\u4e3a\u8fd9\u4e2aWA\u7684\n        sum[rt] += inc[rt] * (r - l + 1); //\u66f4\u65b0sum\n        inc[rt] = 0.0; //\u6e05\u7a7a\u6807\u8bb0\n    }\n\n    void _add(int rt, int l, int r, int po, double val)\n    {\n        if (l == r) //\u53f6\u5b50\u8282\u70b9\n        {\n            sum[rt] = val;\n            sqr_sum[rt] = val * val;\n            return;\n        }\n        int mid = (l + r) >> 1;\n        if (po <= mid)\n            _add(rt << 1, l, mid, po, val);\n        if (mid + 1 <= po)\n            _add(rt << 1 | 1, mid + 1, r, po, val);\n        sum[rt] = sum[rt << 1] + sum[rt << 1 | 1];\n        sqr_sum[rt] = sqr_sum[rt << 1] + sqr_sum[rt << 1 | 1];\n    }\n    inline void add(int po, double val) { _add(1, 1, n, po, val); } //\u4e3a\u4e86\u65b9\u4fbf\u8c03\u7528\u6253\u7684\u51fd\u6570\n\n    double _qry_sum(int rt, int l, int r, int ql, int qr) //\u533a\u95f4\u6c42\u548c\n    {\n        down(rt, l, r);\n        double ret = 0.0;\n        if (ql <= l && qr >= r)\n            return sum[rt];\n        int mid = (l + r) >> 1;\n        if (ql <= mid)\n            ret += _qry_sum(rt << 1, l, mid, ql, qr);\n        if (mid + 1 <= qr)\n            ret += _qry_sum(rt << 1 | 1, mid + 1, r, ql, qr);\n        return ret;\n    }\n    inline double qry_sum(int ql, int qr) { return _qry_sum(1, 1, n, ql, qr); }\n\n    double _qry_sqr_sum(int rt, int l, int r, int ql, int qr) //\u533a\u95f4\u6c42\u5e73\u65b9\u548c\n    {\n        down(rt, l, r);\n        double ret = 0.0;\n        if (ql <= l && qr >= r)\n            return sqr_sum[rt];\n        int mid = (l + r) >> 1;\n        if (ql <= mid)\n            ret += _qry_sqr_sum(rt << 1, l, mid, ql, qr);\n        if (mid + 1 <= qr)\n            ret += _qry_sqr_sum(rt << 1 | 1, mid + 1, r, ql, qr);\n        return ret;\n    }\n    inline double qry_sqr_sum(int ql, int qr) { return _qry_sqr_sum(1, 1, n, ql, qr); }\n    \n    void _change(int rt, int l, int r, int ql, int qr, double val) //\u533a\u95f4\u4fee\u6539\n    {\n        down(rt, l, r);\n        if (ql <= l && qr >= r)\n        {\n            inc[rt] += val;\n            return;\n        }\n        int mid = (l + r) >> 1;\n        if (ql <= mid)\n            _change(rt << 1, l, mid, ql, qr, val);\n        if (mid + 1 <= qr)\n            _change(rt << 1 | 1, mid + 1, r, ql, qr, val);\n        down(rt << 1, l, mid);\n        down(rt << 1 | 1, mid + 1, r);\n        sum[rt] = sum[rt << 1] + sum[rt << 1 | 1];\n        sqr_sum[rt] = sqr_sum[rt << 1] + sqr_sum[rt << 1 | 1];\n    }\n    inline void change(int ql, int qr, double val) { _change(1, 1, n, ql, qr, val); }\n} ST;\n\nint main()\n{\n    scanf(\"%d%d\", &n, &q);\n    for (int i = 1; i <= n; i++)\n    {\n        scanf(\"%lf\", &t);\n        ST.add(i, t);\n    }\n    while (q--)\n    {\n        scanf(\"%d%d%d\", &d, &x, &y);\n        if (d == 1)\n        {\n            scanf(\"%lf\", &t);\n            ST.change(x, y, t);\n        }\n        else if (d == 2)\n        {\n            double ans = ST.qry_sum(x, y) / (y - x + 1); //\u6c42\u548c\u5e76\u9664\u4ee5\u957f\u5ea6\n            printf(\"%.4lf\\n\", ans);\n        }\n        else if (d == 3)\n        {\n            double ave = ST.qry_sum(x, y) / (y - x + 1),\n            ans = (ST.qry_sqr_sum(x, y)\n                   - 2 * ave * ST.qry_sum(x, y)\n                   + (y - x + 1) * ave * ave)\n                   / (y - x + 1); //\u8fd9\u53e5\u6709\u70b9\u957f\uff0c\u7ec6\u5fc3\u770b\uff0c\u5bf9\u7167\u9898\u89e3\u4e2d\u6240\u62c6\u7684\u516c\u5f0f\n            printf(\"%.4lf\\n\", ans);\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1512193981,
        "uid": 37598,
        "name": "GaryZhong",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "```cpp\n#include<iostream>\n#include<iomanip>\nusing namespace std;\nconst int N = 100005, INF = 0x7fffffff;\ndouble a[N], sum[4*N], sum2[4*N];\ndouble tag[4*N];\n\nvoid pushup(int k) {\n\tsum[k] = sum[k * 2] + sum[k * 2 + 1]; //\u533a\u95f4\u548c\n\tsum2[k] = sum2[k * 2] + sum2[k * 2 + 1]; //\u533a\u95f4\u5e73\u65b9\u548c\n\treturn ;\n}\n\nvoid build(int k, int lt, int rt) { //\u7b2ck\u4e2a\u7ed3\u70b9\uff0c lt rt\u4e3a\u8981\u8be2\u95ee\u7684\u533a\u95f4\u8303\u56f4\n\tif(lt == rt) {\n\t\tsum[k] = a[lt]; //a\u4e3a\u539f\u59cb\u6570\u7ec4\uff0csum[k]\u4e3a\u7b2ck\u4e2a\u7ed3\u70b9\u7684\u533a\u95f4\u548c\n\t\tsum2[k] = a[lt] * a[lt]; //\u5e73\u65b9\n\t\treturn ;\n\t}\n\tint mid = lt + (rt - lt) / 2; // mid = (lt + rt) >> 1\n\tbuild(k * 2, lt, mid);\n\tbuild(k * 2 + 1, mid + 1, rt);\n\tpushup(k);\n\treturn ;\n}\n\nvoid Add(int k, int lt, int rt, double val) { //\u6253\u61d2\u6807\u8bb0\n\ttag[k] += val; //\u6807\u8bb0K\u7ed3\u70b9\u5bf9\u5e94\u7684\u533a\u95f4\u8981\u52a0\u7684\u503c\n\tsum2[k] += 2 * val * sum[k] + val * val * (rt - lt + 1); //\u56e0\u4e3a\u5e73\u65b9\u548c\u8981\u7528\u5230 \u533a\u95f4\u548c\uff0c \u6240\u4ee5\u8981\u5148\u66f4\u65b0\uff01\n\tsum[k] += (rt - lt + 1) * val;\n\treturn ;\n}\n\nvoid pushdown(int k, int lt, int rt) {\n\tif(tag[k] == 0)\n\t\treturn ;\n\tint mid = lt + (rt - lt) / 2;\n\tAdd(k*2, lt, mid, tag[k]);\n\tAdd(k*2+1, mid+1, rt, tag[k]);\n\ttag[k] = 0; //\u5c06\u6807\u8bb0\u4f20\u7ed9\u5b50\u8282\u70b9\u540e\uff0c\u7236\u8282\u70b9\u7684\u6807\u8bb0\u8981\u6e05\u96f6\uff0c\u5426\u5219\u4f1a\u52a0\u91cd\u590d\n\treturn ;\n}\n\n//\u5728qx, qy\u533a\u95f4\u6bcf\u4e2a\u6570\u52a0\u4e0aval\nvoid modify(int k, int lt, int rt, int qx, int qy, double val) {\n\tif(lt > qy || rt < qx)\n\t\treturn ;\n\telse if(lt >= qx && rt <= qy) {\n\t\tAdd(k, lt, rt, val);\n\t\treturn ;\n\t}\n\tint mid = lt + (rt - lt) / 2;\n\tpushdown(k, lt, rt);\n\tmodify(k * 2, lt, mid, qx, qy, val);\n\tmodify(k * 2 + 1 , mid + 1, rt, qx, qy, val);\n\tpushup(k);\n\treturn ;\n}\n\ndouble query(int k, int lt, int rt, int qx, int qy) {\n\tif(lt > qy || rt < qx)\n\t\treturn 0;\n\telse if(lt >= qx && rt <= qy)\n\t\treturn sum[k];\n\tint mid = lt + (rt - lt) / 2;\n\tpushdown(k, lt, rt); //\u8be2\u95ee\u65f6\u624d\u4e0b\u4f20\u6807\u8bb0\uff0c\u56e0\u4e3a\u9700\u8981\u77e5\u9053\u5b50\u533a\u95f4\u8981\u52a0\u7684\u503c\n\treturn query(k * 2, lt, mid, qx, qy) + query(k * 2 + 1, mid + 1, rt, qx, qy);\n}\n\ndouble query2(int k, int lt, int rt, int qx, int qy) {\n\tif(lt > qy || rt < qx)\n\t\treturn 0;\n\telse if(lt >= qx && rt <= qy)\n\t\treturn sum2[k];\n\tint mid = lt + (rt - lt) / 2;\n\tpushdown(k, lt, rt); //\u8be2\u95ee\u65f6\u624d\u4e0b\u4f20\u6807\u8bb0\uff0c\u56e0\u4e3a\u9700\u8981\u77e5\u9053\u5b50\u533a\u95f4\u8981\u52a0\u7684\u503c\n\treturn query2(k * 2, lt, mid, qx, qy) + query2(k * 2 + 1, mid + 1, rt, qx, qy);\n}\n\n\nint main() {\n\tint n, m;\n\tcin >> n >> m;\n\tfor(int i = 1; i <= n; i++) {\n\t\tcin >> a[i];\n\t}\n\tbuild(1, 1, n); //\u5efa\u6811\n\tfor(int i = 1; i <= m; i++) {\n\t\tint option, x, y;\n\t\tdouble v;\n\t\tcin >> option;\n\t\tif(option == 1) {\n\t\t\tcin >> x >> y >> v;\n\t\t\tmodify(1, 1, n, x, y, v);\n\t\t} else if(option == 2) {\n\t\t\tcin >> x >> y;\n\t\t\tcout << fixed << setprecision(4) << query(1, 1, n, x, y) / (y-x+1) << \"\\n\";\n\t\t} else {\n\t\t\tcin >> x >> y;\n\t\t\tdouble avg = query(1, 1, n, x, y) / (y-x+1);\n\t\t\tcout << fixed << setprecision(4) << -avg * avg + query2(1, 1, n, x, y) / (y-x+1) << \"\\n\";\n\t\t}\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1582630047,
        "uid": 195616,
        "name": "\u9ad8\u5929",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "$$\\color{cornflowerblue}{\\mathcal{Treaker}}$$\n# \u7ebf\u6bb5\u6811 + \u6570\u5b66\n\n\u8fd9\u9053\u9898\u5982\u679c\u4e0d\u8003\u8651\u64cd\u4f5c\u4e09\u7684\u8bdd\uff0c~~\u90a3\u8fd9\u9898\u8fd8\u6709\u610f\u4e49\u5417~~\uff0c\u5f88\u7b80\u5355\uff0c\u7ef4\u62a4\u4e00\u4e2a\u533a\u95f4\u548c\u5373\u53ef\uff0c\u6253\u4e00\u4e2a\u533a\u95f4\u6807\u8bb0\u5373\u53ef\u3002\n\n\u90a3\u4e48\u8003\u8651\u65b9\u5dee\u600e\u4e48\u7ef4\u62a4\u3002\u76f4\u63a5\u7ef4\u62a4\uff1f\u597d\u50cf\u4e0d\u592a\u597d\u7ef4\u62a4\u3002\u3002\u3002~~\u522b\u95ee\u6211\u600e\u4e48\u77e5\u9053\u7684~~\n\n**\u80af\u5b9a\u8981\u63a8\u5f0f\u5b50\u5566**\n\n\u8003\u8651\uff1a\u65b9\u5dee\u7684\u8bdd\uff0c\u6211\u4eec\u77e5\u9053$l$\u548c$r$,\u5c31\u5148\u4e0d\u8003\u8651\u9664\u4ee5\u533a\u95f4\u957f\u5ea6(\u53ef\u4ee5\u8f7b\u6613\u6c42\u51fa)\u8fd9\u4e00\u6b65\u3002\u90a3\u4e48\u5269\u4e0b\uff1a\n$$\\sum_{i = l}^r(A_i - \\overline{A})^2$$\n\u5c55\u5f00\u7684\u8bdd\u5c31\u662f\uff1a\n$$\\sum_{i = l}^rA_i^2-2A_i\\overline{A}+\\overline{A}^2$$\n$$\\sum_{i = l}^rA_i^2-2\\overline{A}\\sum_{i = l}^rA_i+\\overline{A}^2$$\n\n$\\overline{A}^2$\u53ef\u4ee5\u901a\u8fc7\u533a\u95f4\u548c\u6765\u6c42\u51fa\u3002$\\sum_{i = l}^r$\u5c31\u662f\u533a\u95f4\u548c\u3002\n\u53ea\u5dee\u4e00\u4e2a$\\sum_{i = l}^rA_i^2$\uff0c\u540c\u6837\u901a\u8fc7\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u732e\u4e0a~~\u6307\u9488~~\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\ninline int read()\n{\n\tint x = 0 , f = 1; char ch = getchar();\n\twhile(ch < '0' || ch > '9') {if(ch == '-') f = -1; ch = getchar();}\n\twhile(ch >= '0' && ch <= '9') {x = (x << 3) + (x << 1) + ch - '0'; ch = getchar();}\n\treturn x * f;\n}\nint n , m;\nstruct Segment_Tree\n{\n\tstruct node\n\t{\n\t\tnode *ls , *rs; int l , r;  double sum , Sum  , tag;\n\t\tnode(int l,int r) : l(l) , r(r) {ls = rs = NULL; Sum = sum = tag = 0;}\n\t\tinline int len() {return r - l + 1;}\n\t\t#define len len()\n\t\tinline void up() {sum = ls -> sum + rs -> sum; Sum = ls -> Sum + rs -> Sum;}\n\t\tinline void down()\n\t\t{\n\t\t\tif(tag == 0) return;\n\t\t\tls -> tag += tag; rs -> tag += tag;\n\t\t\tls -> Sum += ls -> sum * tag * 2 + tag * tag * ls -> len; rs -> Sum += rs -> sum * tag * 2 + tag * tag * rs -> len;\n\t\t\tls -> sum += tag * ls -> len; rs -> sum += tag * rs -> len; tag = 0;\n\t\t}\n\t}*root;\n\t#define mid ((o -> l + o -> r) >> 1)\n\tvoid build(node *&o,int l,int r)\n\t{\n\t\to = new node(l,r); if(l == r) return (void)(scanf(\"%lf\",& o -> sum) , o -> Sum = o -> sum * o -> sum);\n\t\tbuild(o -> ls,l,mid); build(o -> rs,mid + 1,r); o -> up();\n\t}\n\tvoid chenge(node *o,int x,int y,double val)\n\t{\n\t\tif(x <= o -> l && o -> r <= y) return (void)(o -> tag += val , o -> Sum +=  o -> sum * val * 2 + val * val * o -> len , o -> sum += val * o -> len); o -> down();\n\t\tif(x <= mid) chenge(o -> ls,x,y,val);\n\t\tif(y > mid) chenge(o -> rs,x,y,val); o -> up();\n\t}\n\tdouble query_sum(node *o,int x,int y)\n\t{\n\t\tif(x <= o -> l && o -> r <= y) return o -> sum; double res = 0; o -> down();\n\t\tif(x <= mid) res += query_sum(o -> ls,x,y);\n\t\tif(y > mid) res += query_sum(o -> rs,x,y);  return res;\n\t}\n\tdouble query_Sum(node *o,int x,int y)\n\t{\n\t\tif(x <= o -> l && o -> r <= y) return o -> Sum; double res = 0; o -> down();\n\t\tif(x <= mid) res += query_Sum(o -> ls,x,y);\n\t\tif(y > mid) res += query_Sum(o -> rs,x,y); return res;\n\t}\n\tinline void LOL()\n\t{\n\t\tn = read(); m = read();\n\t\tbuild(root,1,n);\n\t\tfor(int i = 1 , opt , l , r;i <= m;i ++)\n\t\t{\n\t\t\topt = read(); l = read(); r = read(); double res;\n\t\t\tif(opt == 1) scanf(\"%lf\",&res) , chenge(root,l,r,res);\n\t\t\tif(opt == 2) printf(\"%.4f\\n\",query_sum(root,l,r) / (r - l + 1));\n\t\t\tif(opt == 3) res = query_sum(root,l,r) , printf(\"%.4f\\n\",(query_Sum(root,l,r) - 2 * res * res / (r - l + 1) + res / (r - l + 1) * res) / (r - l + 1));\n\t\t}\n\t}\n}DNF;\nint main(){return DNF.LOL() , 0;}\n```\n",
        "postTime": 1572511461,
        "uid": 153898,
        "name": "Treaker",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "### \u8fd9\u9053\u9898\u662f\u4e00\u9053\u6709\u4e00\u5b9a~~\u5927\u529b\u63a8\u5f0f\u5b50~~\u601d\u8003\u96be\u5ea6\u7684\u88f8\u7ebf\u6bb5\u6811\u9898\n\n\u9996\u5148\u6211\u4eec\u5c06\u6c42\u65b9\u5dee\u7684\u5f0f\u5b50\u5c55\u5f00($S^2$\u4ee3\u8868\u65b9\u5dee\uff0c$x_i$\u4ee3\u8868\u6570\u5217\u7684\u7b2ci\u9879\uff0c$n$\u4ee3\u8868\u9879\u6570\uff0c$\\bar{x}$\u4ee3\u8868\u6570\u5217\u7684\u5e73\u5747\u503c)\uff1a\n\n### $S^2=\\frac{1}{n}\\sum_{i=1}^n(x_i-\\bar{x})^2$\n\n\u5c06\u6bcf\u4e2a\u5e73\u65b9\u5c55\u5f00\uff0c\u5f97\uff1a\n\n### $S^2=\\frac{{\\sum_{i=1}^n(x^2)}-{2*\\sum_{i=1}^n(x_i*\\bar{x})}+n*\\bar{x}^2}{n}$\n\n## $S^2=\\frac{\\sum_{i=1}^n({x_i}^{2})}{n}-\\bar{x}^2$\n\n\u597d\u4e86\uff0c\u5c55\u5f00\u5b8c\u6210\uff01\n\n\u89c2\u5bdf\u7b97\u5f0f\uff0c\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4$\\sum_{i=1}^n{x_i}^{2}$\u548c$\\sum_{i=1}^nx_i$\u5373\u53ef\u3002\u5728\u67e5\u8be2\u65f6\u6211\u4eec\u901a\u8fc7\u7ebf\u6bb5\u6811\u7b97\u51fa$\\sum_{i=1}^n{x_i}^{2}$\u548c$\\sum_{i=1}^nx_i$\uff0c\u5e76\u5957\u65b9\u5dee\u516c\u5f0f\u5c31\u884c\u4e86\uff08\u5e73\u5747\u503c\u540c\u7406\uff09\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5728\u6253tag\u7684\u65f6\u5019\uff0c\u5982\u4f55\u5feb\u901f\u66f4\u65b0$\\sum_{i=1}^n{x_i}^{2}$?\n\n\u5927\u529b\u63a8\u7b97\u5f0f\uff08\u5047\u8bbe\u589e\u52a0\u7684\u6570\u662f$x$\uff09\uff1a\n\n### $\\sum_{i=1}^n{(a_i+x)}^2$\n\n### $=\\sum_{i=1}^n{a_i}^2+2*a_i*x+x^2*n$\n\n\u51cf\u53bb$\\sum_{i=1}^n{x_i}^{2}$\u540e\uff1a\n\n## $2*(\\sum_{i=1}^na_i*x)+x^2*n$\n\n\u95ee\u9898\u89e3\u51b3\uff01\n\n\u8fd9\u4e0b\u5c31\u80fd\u6109\u5feb\u5730\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e86~\u6ce8\u610f\u8981\u7528double\u5b58\u50a8~\n\n\u559c\u95fb\u4e50\u89c1\u7684\u653e\u4ee3\u7801\u65f6\u95f4\uff1a\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\n#define db double\n#define ls (root<<1)\n#define rs ((root<<1)+1)\n#define mid ((l+r)>>1)//\u849f\u84bb\u559c\u6b22\u7528\u5b8f\u5b9a\u4e49\nstruct node{\n\tdb sum;\n\tdb pfsum;//\u5e73\u65b9\u548c\n\tdb tag;\n} a[400005];\ndb data[100005];\ninline void pushup(int root){\n\ta[root].sum=a[ls].sum+a[rs].sum;\n\ta[root].pfsum=a[ls].pfsum+a[rs].pfsum;\n}\nvoid build(int root,int l,int r){\n\ta[root].tag=0;\n\tif(l==r){\n\t\ta[root].sum=data[l];\n\t\ta[root].pfsum=data[l]*data[l];\n\t\treturn;\n\t}\n\tbuild(ls,l,mid);\n\tbuild(rs,mid+1,r);\n\tpushup(root);\n}//\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\ninline void pd(int root,int l,int r){\n\tif(a[root].tag==0)return;\n\ta[ls].tag+=a[root].tag;\n\ta[rs].tag+=a[root].tag;\n\ta[ls].pfsum+=(2*a[ls].sum*a[root].tag+a[root].tag*a[root].tag*(mid-l+1));\n\ta[rs].pfsum+=(2*a[rs].sum*a[root].tag+a[root].tag*a[root].tag*(r-mid));\n\ta[ls].sum+=a[root].tag*(mid-l+1);\n\ta[rs].sum+=a[root].tag*(r-mid);\n\ta[root].tag=0;\n}//push_down \u5957\u516c\u5f0f\u5373\u53ef\nvoid add(int root,int l,int r,int ql,int qr,db x){\n\tif(ql<=l&&qr>=r){\n\t\ta[root].tag+=x;\n\t\ta[root].pfsum+=(2*a[root].sum*x+x*x*(r-l+1));//\u8fd9\u91cc\u4e5f\u662f\u5957\u516c\u5f0f\n\t\ta[root].sum+=(r-l+1)*x;\n\t\treturn;\n\t}\n\tif(ql>r||qr<l)\n\t\treturn;\n\tpd(root,l,r);\n\tif(ql<=mid)\n\t\tadd(ls,l,mid,ql,qr,x);\n\tif(qr>mid)\n\t\tadd(rs,mid+1,r,ql,qr,x);\n\tpushup(root);\n\treturn;\n}\ndb qsum(int root,int l,int r,int ql,int qr){\n\tif(ql<=l&&qr>=r){\n\t\treturn a[root].sum;\n\t}\n\tif(ql>r||qr<l)\n\t\treturn 0.0;\n\tpd(root,l,r);\n\tdb ret=0;\n\tif(ql<=mid)\n\t\tret+=qsum(ls,l,mid,ql,qr);\n\tif(qr>mid)\n\t\tret+=qsum(rs,mid+1,r,ql,qr);\n\treturn ret;\n}\ndb qpfsum(int root,int l,int r,int ql,int qr){\n\tif(ql<=l&&qr>=r){\n\t\treturn a[root].pfsum;\n\t}\n\tif(ql>r||qr<l)\n\t\treturn 0.0;\n\tpd(root,l,r);\n\tdb ret=0;\n\tif(ql<=mid)\n\t\tret+=qpfsum(ls,l,mid,ql,qr);\n\tif(qr>mid)\n\t\tret+=qpfsum(rs,mid+1,r,ql,qr);\n\treturn ret;\n}\nint main()\n{\n\tios::sync_with_stdio(false);\n\tint n,m,x,y,z;\n\tdb t;\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>data[i];\n\tbuild(1,1,n);\n\tfor(int i=0;i<m;i++){\n\t\tcin>>x>>y>>z;\n\t\tif(x==1){\n\t\t\tcin>>t;\n\t\t\tadd(1,1,n,y,z,t);\n\t\t}\n\t\telse if(x==2)\n\t\t\tprintf(\"%.4lf\\n\",qsum(1,1,n,y,z)*1.0/(z-y+1.0));//\u5957\u516c\u5f0f\uff0c\u6ce8\u610f\u8f93\u51fa\u683c\u5f0f\n\t\telse if(x==3){\n\t\t\tdb pj=qsum(1,1,n,y,z)*1.0/(z-y+1.0);\n\t\t\tprintf(\"%.4lf\\n\",(qpfsum(1,1,n,y,z)*1.0)/(z-y+1.0)-pj*pj);//\u8fd8\u662f\u5957\u516c\u5f0f\t\n\t\t}\n\t}\n\treturn 0;\n}//\u5b8c\u7ed3\u6492\u82b1\uff01\n```",
        "postTime": 1552226076,
        "uid": 55959,
        "name": "AC_Automation",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u6b64\u9898\u4e0d\u96be\uff0c\u522b\u88ab\u5413\u5230\n\n\u5148\u5047\u88c5\u6ca1\u6709\u533a\u95f4\u4fee\u6539\uff0c\u770b\u7ebf\u6bb5\u6811\u600e\u4e48\u505a\u3002\n\n\u6211\u4eec\u77e5\u9053\u7ebf\u6bb5\u6811\u53ef\u4ee5\u6c42\u533a\u95f4\u548c\uff0c\u90a3\u5148\u6c42\u5e73\u5747\u3002\n\n\u8bb0$Sum(l,r)$\u4e3a$l$\u5230$r$\u7684\u533a\u95f4\u548c\uff0c$Average(l,r)$\u4e3a$l$\u5230$r$\u7684\u5e73\u5747\u503c\uff0c\u5219\n$$Average(l,r)=\\frac{Sum(l,r)}{r-l+1}$$\n\n\u7ebf\u6bb5\u6811\u6c42\u51fa$Sum(i,j)$\u5373\u53ef\u3002\n\n\u4e0b\u9762\u8003\u8651\u65b9\u5dee\u3002\n\n\u5148\u8981\u77e5\u9053\u7ebf\u6bb5\u6811\u662f\u53ef\u4ee5\u6c42\u533a\u95f4\u5e73\u65b9\u548c\uff0c\u8f6c\u79fb\u662f\u4e00\u6837\u7684\u3002\u6211\u4eec\u8bb0$Sum2(i,j)$\u4e3a$i$\u5230$j$\u7684\u5e73\u65b9\u548c\u3002\n\n\u628a\u65b9\u5dee\u66b4\u529b\u6253\u5f00\n\n$$\\sigma^2=\\frac{1}{n}\\sum_{i=1}^n(x_i-\\overline x)^2=\\frac{1}{n}\\sum_{i=1}^n{\\overline x^2+x_i^2-2\\overline x x_i}$$\n$$=\\frac{1}{n}(n\\overline x^2+\\sum_{i=1}^nx_i^2-2\\overline x\\sum_{i=1}^nx_i)$$\n$$=\\frac{((r-l+1)\\overline x^2+Sum2(l,r)-2\\overline xSum(l,r))}{r-l+1}$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u7528$Sum$\u548c$Sum2$\u6c42\u51fa\u65b9\u5dee\u4e86\u3002\n\n\u73b0\u5728\u6709\u4e00\u4e2a\u64cd\u4f5c\u5c31\u662f\u533a\u95f4\u52a0\u4e0a\u4e00\u4e2a\u503c$d$\uff0c\u5bf9\u4e8e$Sum$\u4e0d\u7528\u8bf4\u76f4\u63a5\u61d2\u6807\u8bb0\u5c31\u53ef\u4ee5\u4e86\uff0c\u90a3\u4e48$Sum2$\u5462\uff1f\n\n\u7531$Sum2$\u7684\u5b9a\u4e49\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa$Sum2'-Sum2$\u7684\u503c\uff08$Sum2'$\u8868\u793a\u4fee\u6539\u540e\u7684$Sum2$\uff09\u3002\n\n$$Sum2'-Sum2=\\sum_{i=l}^r(x_i+d)^2-\\sum_{i=l}^rx_i^2$$\n$$=\\sum_{i=l}^r(x_i+d)^2-x_i^2=\\sum_{i=l}^rd(2x_i+d)$$\n$$=(r-l+1)d^2+2d\\sum_{i=l}^rx_i$$\n$$=(r-l+1)d^2+2dSum(l,r)$$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0$Sum2$\u7684\u533a\u95f4\u66f4\u6539\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\uff1a\n```cpp\n#include<iostream>\n#include<cstdio>\n\nusing namespace std;\n\nint N,M,op,x,y;\ndouble sum[400001],sum2[400001],add[400001],a,k;\nbool tag[400001];\n\ninline void change(int o,int l,int r,double d){sum2[o]+=d*(d*(r-l+1)+2.*sum[o]),sum[o]+=(r-l+1)*d;}\n\ninline void pushdown(int o,int l,int r){\n\ttag[o<<1]=tag[o<<1|1]=true,tag[o]=false;\n\tint m=l+r>>1;change(o<<1,l,m,add[o]),change(o<<1|1,m+1,r,add[o]),add[o<<1]+=add[o],add[o<<1|1]+=add[o],add[o]=0.;\n}\n\nvoid update(int o,int l,int r,int k,double x){\n\tif(l==r){sum[o]=x,sum2[o]=x*x;return;}\n\tint m=l+r>>1;if(m>=k)update(o<<1,l,m,k,x);else update(o<<1|1,m+1,r,k,x);\n\tsum[o]=sum[o<<1]+sum[o<<1|1];\n\tsum2[o]=sum2[o<<1]+sum2[o<<1|1];\n}\n\nvoid update(int o,int l,int r,int a,int b,double d){\n\tif(l==a&&r==b){tag[o]=true,add[o]+=d,change(o,l,r,d);return;}\n\tif(tag[o])pushdown(o,l,r);\n\tint m=l+r>>1;if(m>=b)update(o<<1,l,m,a,b,d);else if(m<a)update(o<<1|1,m+1,r,a,b,d);else update(o<<1,l,m,a,m,d),update(o<<1|1,m+1,r,m+1,b,d);\n\tsum[o]=sum[o<<1]+sum[o<<1|1];\n\tsum2[o]=sum2[o<<1]+sum2[o<<1|1];\n}\n\ndouble query1(int o,int l,int r,int a,int b){\n\tif(l==a&&r==b)return sum[o];\n\tif(tag[o])pushdown(o,l,r);\n\tint m=l+r>>1;\n\tif(m>=b)return query1(o<<1,l,m,a,b);else if(m<a)return query1(o<<1|1,m+1,r,a,b);else return query1(o<<1,l,m,a,m)+query1(o<<1|1,m+1,r,m+1,b);\n}\n\ndouble query2(int o,int l,int r,int a,int b){\n\tif(l==a&&r==b)return sum2[o];\n\tif(tag[o])pushdown(o,l,r);\n\tint m=l+r>>1;\n\tif(m>=b)return query2(o<<1,l,m,a,b);else if(m<a)return query2(o<<1|1,m+1,r,a,b);else return query2(o<<1,l,m,a,m)+query2(o<<1|1,m+1,r,m+1,b);\n}\n\nvoid solve1(int x,int y){printf(\"%.4lf\\n\",query1(1,1,N,x,y)/(double)(y-x+1));}\n\nvoid solve2(int x,int y){\n\tdouble A=query1(1,1,N,x,y)/(double)(y-x+1),s2=query2(1,1,N,x,y),s=query1(1,1,N,x,y);\n\tprintf(\"%.4lf\\n\",(s2+(double)(y-x+1)*A*A-2.*s*A)/(double)(y-x+1));\n}\n\nint main(){\n\tscanf(\"%d%d\",&N,&M);\n\tfor(int i=1;i<=N;++i)scanf(\"%lf\",&a),update(1,1,N,i,a);\n\tfor(int i=1;i<=M;++i){\n\t\tscanf(\"%d%d%d\",&op,&x,&y);\n\t\tif(op==1)scanf(\"%lf\",&k),update(1,1,N,x,y,k);else if(op==2)solve1(x,y);else solve2(x,y);\n\t}\n}\n```",
        "postTime": 1547281728,
        "uid": 30719,
        "name": "ezoixx174",
        "ccfLevel": 0,
        "title": "P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "[\u535a\u5ba2\u4f20\u9001\u95e8](https://www.cnblogs.com/hbxblog/p/9350649.html)\n\n\u8fd9\u9053\u9898\u8981\u6c42\u4e24\u4e2a\u503c\uff0c\u4e00\u4e2a\u662f\u5e73\u5747\u503c\uff0c\u4e00\u4e2a\u662f\u65b9\u5dee\uff0c\u5e73\u5747\u503c\u5f88\u5bb9\u6613\uff0c\u5c31\u662f\u533a\u95f4\u548c/\u4e2a\u6570\u5c31\u53ef\u4ee5\u4e86\u3002\u4f46\u662f\u600e\u4e48\u6c42\u65b9\u5dee\u5462\uff1f\u770b\u4e0a\u53bb\u5341\u5206\u56f0\u96be,\u4e0d\u77e5\u9053\u5982\u4f55\u4e0b\u624b,\u4e0d\u77e5\u9053\u600e\u4e48\u7ef4\u62a4\uff1f\u4f46\u662f\u4e0d\u59a8\u628a\u65b9\u5dee\u7684\u516c\u5f0f\u62c6\u5f00\uff1a\n\n&#160;&#160;&#160;&#160;\u8bbe\u5e73\u5747\u6570\u4e3ak\n\n&#160;&#160;&#160;&#160;\u5219S\u00b2=((a1-k)\u00b2+(a2-k)\u00b2+(a3-k)\u00b2+...+(an-k)\u00b2)/n(\u5c06\u4ed6\u62c6\u5f00)\n&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; =(a1\u00b2+a2\u00b2+a3\u00b2+...+an\u00b2+nk\u00b2-2k(a1+a2+a3+...+an)(/n\n&#160;&#160;&#160;&#160;\u2235 (a1+a2+a3+...+an)/n=k\n&#160;&#160;&#160;&#160;\n\n&#160;&#160;&#160;&#160;\u2234 S\u00b2=(a1\u00b2+a2\u00b2+a3\u00b2+...+an\u00b2)/n-k\u00b2\n\n&#160;&#160;&#160;&#160;\u6240\u4ee5\u73b0\u5728\u663e\u800c\u6613\u89c1\u8981\u7ef4\u62a4\u65b9\u5dee\u53ea\u8981\u7ef4\u62a4\u5e73\u65b9\u7684\u548c\u5c31\u53ef\u4ee5\u4e86\n&#160;&#160;&#160;&#160;\u90a3\u4e48\u600e\u4e48\u7ef4\u62a4\u5e73\u65b9\u548c\u5462\uff1f\n\n&#160;&#160;&#160;&#160;\u5728\u62c6\u5f00\u4e00\u4e0b\uff1a\n\n&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\u8bbe\u6bcf\u4e2a\u6570\u52a0\u4e0a\u4e86x\n\n&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;    (a1+x)\u00b2+(a2+x)\u00b2+(a3+x)\u00b2+...+(an+x)\u00b2\n\n&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;    =a1\u00b2+a2\u00b2+a3\u00b2+...+an\u00b2+nx\u00b2+2x(a1+a2+a3+...+an)\n\n&#160;&#160;&#160;&#160;\u6240\u4ee5\u73b0\u5728\u5c31\u5f88\u5bb9\u6613\u4e86\uff0c\u63a5\u4e0b\u6765\u4e0a\u4ee3\u7801\n```\n#include<cstdio>\n#include<cstdlib>\n#include<iostream>\nusing namespace std;\nstruct node {\n    double lazy,v,sqr;\n} a[400001];\ndouble b[400001];\nvoid pushup(int k) {\n    a[k].v=a[k<<1].v+a[k<<1|1].v;\n    a[k].sqr=a[k<<1].sqr+a[k<<1|1].sqr;\n}\nvoid add(int k,int l,int r,double v) {\n    a[k].lazy+=v;\n    a[k].sqr+=((r-l+1)*v*v+2*v*a[k].v);\n    a[k].v+=(r-l+1)*v;\n}\nvoid pushdown(int k,int l,int r) {\n    if(a[k].lazy) {\n        int mid=(l+r)>>1;\n        add(k<<1,l,mid,a[k].lazy);\n        add(k<<1|1,mid+1,r,a[k].lazy);\n    }\n    a[k].lazy=0;\n}\nvoid update(int k,int l,int r,int begin,int end,double c) {\n    if(r<begin||l>end)\n        return ;\n    if(l>=begin&&r<=end) {\n        add(k,l,r,c);\n        return;\n    }\n    pushdown(k,l,r);\n    int mid=(l+r)>>1;\n    update(k<<1,l,mid,begin,end,c);\n    update(k<<1|1,mid+1,r,begin,end,c);\n    pushup(k);\n}\ndouble find(int k,int l,int r,int begin,int end) {\n    if(r<begin||l>end)\n        return 0;\n    if(l>=begin&&r<=end)\n        return a[k].v;\n    pushdown(k,l,r);\n    int mid=(l+r)>>1;\n    if(end<=mid)\n        return find(k<<1,l,mid,begin,end);\n    else if(begin>mid)\n        return find(k<<1|1,mid+1,r,begin,end);\n    else\n        return find(k<<1,l,mid,begin,mid)+find(k<<1|1,mid+1,r,mid+1,end);\n}\ndouble find1(int k,int l,int r,int begin,int end) {\n    if(r<begin||l>end)\n        return 0;\n    if(l>=begin&&r<=end)\n        return a[k].sqr;\n    pushdown(k,l,r);\n    int mid=(l+r)>>1;\n    if(end<=mid)\n        return find1(k<<1,l,mid,begin,end);\n    else if(begin>mid)\n        return find1(k<<1|1,mid+1,r,begin,end);\n    else\n        return find1(k<<1,l,mid,begin,mid)+find1(k<<1|1,mid+1,r,mid+1,end);\n}\nvoid build(int k,int l,int r) {\n    a[k].lazy=0;\n    if(l==r) {\n        a[k].v=b[l];\n        a[k].sqr=b[l]*b[l];\n        return ;\n    }\n    int mid=(l+r)>>1;\n    build(k<<1,l,mid);\n    build(k<<1|1,mid+1,r);\n    pushup(k);\n}\nint main() {\n    int n,m,L,x,y;\n    double c;\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1; i<=n; i++)\n        scanf(\"%lf\",&b[i]);\n    build(1,1,n);\n    for(int i=1; i<=m; i++) {\n        scanf(\"%d%d%d\",&L,&x,&y);\n        if(L==1) {\n            scanf(\"%lf\",&c);\n            update(1,1,n,x,y,c);\n        }\n        if(L==2)\n            printf(\"%0.4lf\\n\",find(1,1,n,x,y)*1.0/(y-x+1));\n        if(L==3) {\n            double ans=find(1,1,n,x,y)*1.0/(y-x+1);\n            ans*=ans;\n            printf(\"%0.4lf\\n\",(find1(1,1,n,x,y)*1.0/(y-x+1))-ans);\n        }\n    }\n}\n```egin,int end,double c) {\n    if(r<begin||l>end)\n        return ;\n    if(l>=begin&&r<=end) {\n        add(k,l,r,c);\n        return;\n    }\n    pushdown(k,l,r);\n    int mid=(l+r)>>1;\n    update(k<<1,l,mid,begin,end,c);\n    update(k<<1|1,mid+1,r,begin,end,c);\n    pushup(k);\n}\ndouble find(int k,int l,int r,int begin,int end) {\n    if(r<begin||l>end)\n        return 0;\n    if(l>=begin&&r<=end)\n        return a[k].v;\n    pushdown(k,l,r);\n    int mid=(l+r)>>1;\n    if(end<=mid)\n        return find(k<<1,l,mid,begin,end);\n    else if(begin>mid)\n        return find(k<<1|1,mid+1,r,begin,end);\n    else\n        return find(k<<1,l,mid,begin,mid)+find(k<<1|1,mid+1,r,mid+1,end);\n}\ndouble find1(int k,int l,int r,int begin,int end) {\n    if(r<begin||l>end)\n        return 0;\n    if(l>=begin&&r<=end)\n        return a[k].sqr;\n    pushdown(k,l,r);\n    int mid=(l+r)>>1;\n    if(end<=mid)\n        return find1(k<<1,l,mid,begin,end);\n    else if(begin>mid)\n        return find1(k<<1|1,mid+1,r,begin,end);\n    else\n        return find1(k<<1,l,mid,begin,mid)+find1(k<<1|1,mid+1,r,mid+1,end);\n}\nvoid build(int k,int l,int r) {\n    a[k].lazy=0;\n    if(l==r) {\n        a[k].v=b[l];\n        a[k].sqr=b[l]*b[l];\n        return ;\n    }\n    int mid=(l+r)>>1;\n    build(k<<1,l,mid);\n    build(k<<1|1,mid+1,r);\n    pushup(k);\n}\nint main() {\n    int n,m,L,x,y;\n    double c;\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1; i<=n; i++)\n        scanf(\"%lf\",&b[i]);\n    build(1,1,n);\n    for(int i=1; i<=m; i++) {\n        scanf(\"%d%d%d\",&L,&x,&y);\n        if(L==1) {\n            scanf(\"%lf\",&c);\n            update(1,1,n,x,y,c);\n        }\n        if(L==2)\n            printf(\"%0.4lf\\n\",find(1,1,n,x,y)*1.0/(y-x+1));\n        if(L==3) {\n            double ans=find(1,1,n,x,y)*1.0/(y-x+1);\n            ans*=ans;\n            printf(\"%0.4lf\\n\",(find1(1,1,n,x,y)*1.0/(y-x+1))-ans);\n        }\n    }\n}\n```",
        "postTime": 1532249491,
        "uid": 19805,
        "name": "\u64a4\u4e91",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u5e73\u5747\u6570\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\uff0c\u7ef4\u62a4\u533a\u95f4\u548c\uff0c\u76f4\u63a5\u7ef4\u62a4\u5e73\u5747\u6570\u4e5f\u884c\uff1b\n\n\n\u7136\u540e\u5bf9\u4e8e\u65b9\u5dee\uff1b\u5979\u6709\u4e2a\u516c\u5f0f\u7684\uff1a\n\n\nS=[(a-Z)\u00b2+(b-Z)\u00b2+(c-Z)\u00b2+(d-Z)\u00b2+(e-Z)\u00b2...]/n(Z\u4e3a\u5e73\u5747\u6570)\n\n\nS=[\u533a\u95f4\u5e73\u65b9\u548c-2\\*n\\*\u5e73\u5747\u6570\u00b2+n\\*\u5e73\u5747\u6570\u00b2]/n;\n\n\nS=[\u533a\u95f4\u5e73\u65b9\u548c-n\\*\u5e73\u5747\u6570\u00b2]/n;\n\n\n\u6240\u4ee5\u7ef4\u62a4\u4e2a\u5e73\u65b9\u548c\u5c31\u597d\u4e86\uff1b\n\n\n\u7136\u540e\uff0c\u5e73\u65b9\u548c\u600e\u4e48\u533a\u95f4\u52a0\u5462\uff1f\n\n\n\u5979\u4e5f\u6709\u4e2a\u516c\u5f0f:\n\n\n(a+z)\u00b2+(b+z)\u00b2+(c+z)\u00b2+(d+z)\u00b2+(e+z)\u00b2\uff08\u4f60\u628a\u5979\u62c6\u5f00\u561b\u3002\u3002\uff09\n\n\n=\u4ee5\u524d\u5e73\u65b9\u548c+\uff082z\\*\uff08Z\\*n\uff09+n\\*z\u00b2\uff09\uff1b\n\n\u7136\u540e\uff0c\u8fd9\u662f\u4ee3\u7801\u7684blog\uff1a\n\n\nhttp://www.cnblogs.com/nietzsche-oier/p/6218468.html\n\n\u6700\u540e\uff0c\u5443\u3002\u3002\u3002\u3002\u4e0a\u4e2a\u9898\u89e3\u4e5f\u662f\u6211\u4ea4\u7684\uff0c\u5bb9\u6613\u770b\u51fa\u5979\u6ca1\u5199\u5b8c\uff0c\u6240\u4ee5\u8bf7\u770b\u8fd9\u4e2a\n",
        "postTime": 1482731858,
        "uid": 17671,
        "name": "djy213",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u5076\u7136\u5728\u8ba8\u8bba\u91cc\u770b\u5230\u8fd9\u9053\u9898\uff0c\u5c31\u8fdb\u6765\u4e86\u3002\n\n\u770b\u4e86\u4e00\u4e0b\u53d1\u73b0\u662f\u6c42\u533a\u95f4\u7684\u5e73\u5747\u6570\u53ca\u65b9\u5dee\uff0c\u6240\u4ee5\u80af\u5b9a\u662f\u8981\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u7684\u3002\u533a\u95f4\u5e73\u5747\u6570\u597d\u6c42\uff0c\u76f4\u63a5\u6c42\u4e00\u904d\u533a\u95f4\u548c\u518d\u9664\u4ee5\u533a\u95f4\u957f\u5ea6\u5c31\u662f\u4e86\u3002\n\n\u5173\u952e\u662f\u533a\u95f4\u65b9\u5dee\u7684\u95ee\u9898\uff0c\u505a\u8fd9\u9898\u7684\u65f6\u5019\u8fd8\u5fd8\u4e86\u65b9\u5dee\u662f\u4ec0\u4e48\u4e1c\u897f\uff0c\u771f\u7684sb\uff0c\u521d\u4e2d\u6570\u5b66\u767d\u5b66\u4e86\u3002\u5176\u5b9e\u8fd9\u6837\u4e5f\u6bd4\u8f83\u53ef\u4ee5\u3002\n\n\u624b\u63a8\u4e00\u4e0b\u5c31\u80fd\u591f\u6bd4\u8f83\u5bb9\u6613\u5730\u53d1\u73b0\uff0c\u7ef4\u62a4\u65b9\u5dee\uff0c\u8fd8\u9700\u8981\u7ef4\u62a4\u533a\u95f4\u5e73\u65b9\u548c\uff0c\u9996\u5148\u6c42\u51fa\u5f53\u524d\u533a\u95f4\u7684\u5e73\u5747\u6570\uff0c\u518d\u64cd\u4f5c\u4e00\u756a\u3002\n\n\u5177\u4f53\u5982\u4e0b\uff0c\u975e\u5e38\u7b80\u5355\uff0c\u7528HF\u7684\u8bdd\u6765\u8bf4\u5c31\u662f\u5c0f\u5b66\u6c34\u5e73\u3002\n\n![](https://cdn.luogu.com.cn/upload/pic/73196.png )\n\n\u5c31\u662f\u4f60\u628a\u90a3\u6c42\u65b9\u5dee\u7684\u8fc7\u7a0b\u770b\u6210\u6574\u4e2a\u533a\u95f4\u90fd\u51cf\u4e00\u4e2a\u6570\uff0c\u7136\u540e\u7ed3\u679c\u5c31\u662f**\u539f\u6765\u533a\u95f4\u7684\u5e73\u65b9\u548c-2*\u5e73\u5747\u6570*\u533a\u95f4\u548c+\u533a\u95f4\u957f\u5ea6*\u5e73\u5747\u6570\u7684\u5e73\u65b9**\uff0c\u540c\u6837\uff0c\u533a\u95f4\u4fee\u6539\u7ef4\u62a4\u5e73\u65b9\u548c\u4e5f\u662f\u8fd9\u6837\u3002\u90a3\u4e48\u6c42\u65b9\u5dee\u7684\u65f6\u5019\uff0c\u5c31\u8981\u5148\u8ba9\u6574\u4e2a\u533a\u95f4\u51cf\u53bb\u5e73\u5747\u6570\uff0c\u6c42\u4e00\u904d**\u5e73\u65b9\u548c/\u533a\u95f4\u957f\u5ea6**\uff0c\u6700\u540e\u52a0\u4e0a\u539f\u6765\u51cf\u53bb\u7684\u5e73\u5747\u6570\u503c\uff0c\u4ee5\u4fbf\u533a\u95f4\u4e2d\u7684\u6570\u503c\u4e0d\u4f1a\u6539\u53d8\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u6211\u4eec\u4e0b\u653e\u6807\u8bb0\u7684\u65f6\u5019\u5fc5\u987b\u5148\u4fee\u6539\u5e73\u65b9\u548c\uff0c\u56e0\u4e3a\u5b83\u8981\u7528\u5230\u4e4b\u524d\u533a\u95f4\u548c\u7684\u503c\uff0c\u987a\u5e8f\u8fd8\u662f\u8981\u6709\u7684\uff0c\u4e0d\u80fdxjb\u4e71\u653e\u3002\n\n$Talk $ $is$  $cheap$  \u4ee3\u7801\u53cc\u624b\u5949\u4e0a\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=1e6+7;\nint n,m;\ndouble a[maxn];\nint opt,l,r;\ndouble v;\nstruct node{\n\tint l,r;\n\tdouble lazy;\n\tdouble sum1,sum2;\n}tree[maxn*4];\nvoid build(int now,int l,int r){\n\ttree[now].l=l,tree[now].r=r;\n\tif(l==r){\n\t\ttree[now].sum1=a[l];\n\t\ttree[now].sum2=a[l]*a[l];\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tbuild(now<<1,l,mid);\n\tbuild(now<<1|1,mid+1,r);\n\ttree[now].sum1=tree[now<<1].sum1+tree[now<<1|1].sum1;\n\ttree[now].sum2=tree[now<<1].sum2+tree[now<<1|1].sum2;\n}\nvoid pushdown(int now){\n\tif(tree[now].lazy){\n\t\ttree[now<<1].sum2+=(tree[now<<1].r-tree[now<<1].l+1)*(tree[now].lazy)*(tree[now].lazy)+2*(tree[now].lazy)*(tree[now<<1].sum1);\n\t\ttree[now<<1|1].sum2+=(tree[now<<1|1].r-tree[now<<1|1].l+1)*(tree[now].lazy)*(tree[now].lazy)+2*(tree[now].lazy)*(tree[now<<1|1].sum1);\n\t\ttree[now<<1].sum1+=(tree[now<<1].r-tree[now<<1].l+1)*tree[now].lazy;\n\t\ttree[now<<1|1].sum1+=(tree[now<<1|1].r-tree[now<<1|1].l+1)*tree[now].lazy;\n\t\ttree[now<<1].lazy+=tree[now].lazy;\n\t\ttree[now<<1|1].lazy+=tree[now].lazy;\n\t\ttree[now].lazy=0;\n\t}\n}\nvoid update(int now,int l,int r,double v){\n\tif(tree[now].l>=l&&tree[now].r<=r){\n\t\ttree[now].sum2+=(tree[now].r-tree[now].l+1)*v*v+2*v*(tree[now].sum1);\n\t\ttree[now].sum1+=(tree[now].r-tree[now].l+1)*v;\n\t\ttree[now].lazy+=v;\n\t\treturn;\n\t}\n\tpushdown(now);\n\tint mid=(tree[now].l+tree[now].r)>>1;\n\tif(l<=mid) update(now<<1,l,r,v);\n\tif(r>mid) update(now<<1|1,l,r,v);\n\ttree[now].sum1=tree[now<<1].sum1+tree[now<<1|1].sum1;\n\ttree[now].sum2=tree[now<<1].sum2+tree[now<<1|1].sum2;\n}\ndouble query1(int now,int l,int r){\n\tif(tree[now].l>=l&&tree[now].r<=r) return tree[now].sum1;\n\tpushdown(now);\n\tdouble val=0;\n\tint mid=(tree[now].l+tree[now].r)>>1;\n\tif(l<=mid) val+=query1(now<<1,l,r);\n\tif(r>mid) val+=query1(now<<1|1,l,r);\n\treturn val;\n}\ndouble query2(int now,int l,int r){\n\tif(tree[now].l>=l&&tree[now].r<=r) return tree[now].sum2;\n\tpushdown(now);\n\tdouble val=0;\n\tint mid=(tree[now].l+tree[now].r)>>1;\n\tif(l<=mid) val+=query2(now<<1,l,r);\n\tif(r>mid) val+=query2(now<<1|1,l,r);\n\treturn val;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%lf\",&a[i]);\n\tbuild(1,1,n);\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d\",&opt);\n\t\tif(opt==1){\n\t\t\tscanf(\"%d%d%lf\",&l,&r,&v);\n\t\t\tupdate(1,l,r,v);\n\t\t}\n\t\tif(opt==2){\n\t\t\tscanf(\"%d%d\",&l,&r);\n\t\t\tprintf(\"%.4lf\\n\",query1(1,l,r)/(r-l+1));\n\t\t}\n\t\tif(opt==3){\n\t\t\tscanf(\"%d%d\",&l,&r);\n\t\t\tdouble change=query1(1,l,r)/(r-l+1);\n\t\t\tupdate(1,l,r,-change);\n\t\t\tprintf(\"%.4lf\\n\",query2(1,l,r)/(r-l+1));\n\t\t\tupdate(1,l,r,change);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1566139603,
        "uid": 108746,
        "name": "JBLee",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u770b\u4e0a\u53bb\u5f88\u96be\u7684\u9898\u2026\u2026\uff08\u81f3\u5c11\u6211\u5f00\u59cb\u7684\u65f6\u5019\u662f\u8fd9\u6837\u60f3\u7684\uff09\n\n\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u53ea\u8981\u5b66\u597d\u6570\u5b66\uff0c\u4f1a\u66b4\u529b\u62c6\u5f0f\u5b50\uff0c\u5c31\u53ef\u4ee5\u628a\u539f\u6765\u7684\u65b9\u5dee\u5f0f\u5b50\u53d8\u4e00\u53d8\n\n\u6211\u4eec\u8bbe$n=y-x+1$\u4e3a\u533a\u95f4$[x,y]$\u4e2d\u6570\u7684\u4e2a\u6570\n\n\u90a3\u4e48\u65b9\u5dee\u516c\u5f0f\u662f\n### $$s^{2}=\\frac{1}{n}\\sum_{i=x}^{y}(A_{i}-\\bar{A})^{2}$$\n\u6211\u4eec\u62c6\u4e00\u4e0b\uff0c\u53ef\u4ee5\u5f97\u5230\n### $$s^{2}=\\frac{1}{n}\\sum_{i=x}^{y}(A_{i}^{2}-2A_{i}\\bar{a}+\\bar{A}^{2})$$\n\u5c55\u5f00\u53ef\u5f97\n### $s^{2}=\\frac{1}{n}\\sum_{i=x}^{y}A_{i}^{2}+\\frac{1}{n}\\sum_{i=x}^{y}\\bar{A}^{2}-\\frac{2}{n}\\sum_{i=x}^{y}A_{i}\\bar{A}$\n### $  =\\frac{1}{n}\\sum_{i=x}^{y}A_{i}^{2}+\\bar{A}^{2}-2\\bar{A}^{2}$\n### $  =\\frac{1}{n}\\sum_{i=x}^{y}A_{i}^{2}-\\frac{1}{n^{2}}\\sum_{i=x}^{y}A_{i}$\n\u90a3\u4e48\u62c6\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u770b\u51fa\u6765\u4e86\uff1a\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u533a\u95f4\u5e73\u65b9\u548c\u4e0e\u533a\u95f4\u548c\u5373\u53ef\u3002\n\n\u90a3\u4e48\uff0c\u5728\u66f4\u65b0\u6570\u503c\u4e4b\u540e\uff0c\u533a\u95f4\u52a0\u6cd5\u7684pushdown\u6211\u4eec\u80af\u5b9a\u4f1a\u5199\uff08\u4e0d\u7136\u5c31\u4e0d\u4f1a\u6765\u505a\u8fd9\u9898\u4e86\uff09\uff0c\u4f46\u662f\u533a\u95f4\u5e73\u65b9\u548cpushdown\u600e\u4e48\u5199\u5462\uff1f\n\n\u5176\u5b9e\uff0c\u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u53ea\u8981\u6211\u4eec\u4f1a\u66b4\u529b\u62c6\u5c31\u53ef\u4ee5\u54afQwQ\uff08\u611f\u89c9\u662f\u62c6\u8fc1\u5927\u961f\u957f\uff09\n\n\u6211\u4eec\u77e5\u9053\uff1a\n### $$(A_{i}+k)^{2}=A_{i}^{2}+2A_{i}k+k^{2}$$\n\u4e8e\u662f\u6709\n### $$\\sum_{i=x}^{y}(A_{i}+k)^{2}=\\sum_{i=x}^{y}A_{i}^{2}+2k\\sum_{i=x}^{y}A_i+nk^2$$\n\u7531\u4e8e$\\sum_{i=x}^yA_i^2$\u4e0e$\\sum_{i=x}^{y}A_i$\u90fd\u662f\u6211\u4eec\u5df2\u77e5\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u6109\u5feb\u5730\u6253\u51fapushudown\u5566OvO\n\n\u4f46\u662f\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c\u7531\u4e8e\u533a\u95f4\u5e73\u65b9\u548c\u7684\u4fee\u6539\u662f\u57fa\u4e8e\u539f\u6765\u7684\u533a\u95f4\u548c\u7684\uff0c\u56e0\u6b64\u5728\u4e0b\u4f20\u7684\u65f6\u5019\u6211\u4eec\u53ea\u80fd\u5148\u4fee\u6539\u5e73\u65b9\u548c\u518d\u4fee\u6539\u533a\u95f4\u548c\u5566\uff08\u5426\u5219\u5148\u4fee\u6539\u533a\u95f4\u548c\u7684\u8bdd\uff0c\u5e73\u65b9\u548c\u516c\u5f0f\u4e2d\u533a\u95f4\u548c\u5c31\u4e0d\u662f\u539f\u6765\u7684\u4e86\uff0c\u5e73\u65b9\u548c\u4f1a\u53d8\u5927\u7684\u5462\uff0c\u4e5f\u628a\u6211\u5751\u4e86\u4e00\u4e0b\uff09\n\n\u4e0b\u9762\u4e0a\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define pushup(o) t1[o]=t1[o<<1]+t1[o<<1|1],t2[o]=t2[o<<1]+t2[o<<1|1]\nll n,m,x,y;\ndouble t1[400001],tag[400001],t2[400001],k;//t1\u662f\u548c\uff0ct2\u662f\u5e73\u65b9\u548c\nvoid build(ll o,ll l,ll r){\n    tag[o]=0;\n    if(l==r)scanf(\"%lf\",&t1[o]),t2[o]=t1[o]*t1[o];//\u521d\u59cb\u5316\n    else{\n        ll mid=l+r>>1;\n        build(o<<1,l,mid);\n        build(o<<1|1,mid+1,r);\n        pushup(o);\n    }\n}\nvoid pushdown(ll o,ll l,ll r){\n    if(!tag[o])return;\n    ll mid=l+r>>1;\n    tag[o<<1]+=tag[o];\n    tag[o<<1|1]+=tag[o];\n    t2[o<<1]+=2*tag[o]*t1[o<<1]+tag[o]*tag[o]*(mid-l+1),t2[o<<1|1]+=2*tag[o]*t1[o<<1|1]+tag[o]*tag[o]*(r-mid);//\u4e0b\u4f20\u5e73\u65b9\u548c\u65f6\u8981\u6ce8\u610f\u533a\u95f4\u5185\u6570\u7684\u4e2a\u6570\n    t1[o<<1]+=tag[o]*(mid-l+1),t1[o<<1|1]+=tag[o]*(r-mid);\n    tag[o]=0;\n}\nvoid update(ll o,ll l,ll r){\n    if(x<=l&&r<=y){\n        tag[o]+=k;\n        t2[o]+=2*t1[o]*k+k*k*(r-l+1);//\u516c\u5f0f\u63a8\u51fa\u6765\u7684\n        t1[o]+=k*(r-l+1);\n    }\n    else{\n        pushdown(o,l,r);\n        ll mid=l+r>>1;\n        if(x<=mid)update(o<<1,l,mid);\n        if(mid<y)update(o<<1|1,mid+1,r);\n        pushup(o);\n    }\n}\ndouble query_sum(ll o,ll l,ll r){//\u533a\u95f4\u548c\n    if(x<=l&&r<=y)return t1[o];\n    pushdown(o,l,r);\n    ll mid=l+r>>1;\n    double ans=0;\n    if(x<=mid)ans=query_sum(o<<1,l,mid);\n    if(mid<y)ans+=query_sum(o<<1|1,mid+1,r);\n    return ans;\n}\ndouble query_sqr(ll o,ll l,ll r){//\u533a\u95f4\u5e73\u65b9\u548c\n    if(x<=l&&r<=y)return t2[o];\n    pushdown(o,l,r);\n    ll mid=l+r>>1;\n    double ans=0;\n    if(x<=mid)ans=query_sqr(o<<1,l,mid);\n    if(mid<y)ans+=query_sqr(o<<1|1,mid+1,r);\n    return ans;\n}\nint main(){\n    scanf(\"%lld%lld\",&n,&m);\n    build(1,1,n);\n    while(m--){\n        int s;\n        scanf(\"%d\",&s);\n        if(s==1){\n            scanf(\"%lld%lld%lf\",&x,&y,&k);\n            update(1,1,n);\n        }\n        else if(s==2){\n            scanf(\"%lld%lld\",&x,&y);\n            printf(\"%.4lf\\n\",query_sum(1,1,n)/(y-x+1));\n        }\n        else{\n            scanf(\"%lld%lld\",&x,&y);\n            double ss=y-x+1,ans1=query_sum(1,1,n),ans2=query_sqr(1,1,n);//ss\u662f\u533a\u95f4\u6570\u4e2a\u6570\n            printf(\"%.4lf\\n\",ans2/ss-ans1*ans1/(ss*ss));\n        }\n    }\n}\n```\n\u90fd\u662f\u624b\u6253\u7684\uff08\u5305\u62ec\u516c\u5f0f\uff09\uff0c\u5982\u679c\u6709\u4e0d\u8db3\u4e4b\u5904\u8fd8\u671b\u591a\u591a\u89c1\u8c05\u54e6",
        "postTime": 1547186666,
        "uid": 79711,
        "name": "Sunqi666",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "(\\*@\u03bf@\\*) \u54c7\uff5e \u90fd\u7528\u7684\u7ebf\u6bb5\u6811\u554a\u3002\u3002\u3002\n\n\u6211\u7528\u5206\u5757\u5199\u7684\u3002\u3002\u3002\n\n\u53cd\u6b63\u5f0f\u5b50\u62c6\u5f00\u5c31\u662f\u7ef4\u62a4\u533a\u95f4\u548c\u548c\u533a\u95f4\u5e73\u65b9\u548c\u561b~\n\n\u5927\u4f53\u6765\u8bf4\u533a\u95f4\u4e0a\u7684\u5904\u7406\u697c\u4e0b\u90fd\u8bb2\u4e86\uff0c~~\u4e0d\u8fc7\u5206\u5757\u600e\u4e48\u8bf4\u90fd\u8981\u66b4\u529b\u4e00\u4e9b\uff0c\u5f53\u7136\u5f0f\u5b50\u7a0d\u5fae\u5316\u5316\u5c31\u51fa\u6765\u4e86~~\n\n\u4ee3\u7801\u548c\u8be6\u8bb2\uff08\u6b22\u8fce\u5404\u4f4d\u795e\u7287\u8385\u4e34\u6211\u7684\u8fa3\u9e21blog\uff09\u2193\u2193\n\nhttp://blog.csdn.net/enzymii/article/details/69055585\n",
        "postTime": 1491275381,
        "uid": 18455,
        "name": "Enzymii",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\n# P1471 \u65b9\u5dee\n\n### \u9898\u610f\n\n\u7ed9\u5b9a\u5b9e\u6570\u5e8f\u5217\uff0c\u652f\u6301\u4e09\u79cd\u64cd\u4f5c\uff1a\n- 1 \u533a\u95f4\u52a0\u6cd5\uff1b\n- 2 \u533a\u95f4\u67e5\u8be2\u5e73\u5747\u6570\uff1b\n- 3 \u533a\u95f4\u67e5\u8be2\u65b9\u5dee\u3002 \n\n***\n### \u63d0\u793a\n\n\u65b9\u5dee\u516c\u5f0f\uff1a\u5bf9\u4e8e\u4e00\u4e2a$n$\u9879\u6570\u5217$a$\uff0c\n\n$$s^2=\\frac1n\\sum_{i=1}^n(a_i-\\overline a)^2$$\n\u5176\u4e2d$\\overline a$\u8868\u793a\u6570\u5217$a$\u7684\u5e73\u5747\u6570\uff0c$a_i$\u8868\u793a\u6570\u5217$a$\u7684\u7b2c$i$\u9879\u3002\n***\n\n### \u601d\u8def\n\n\u770b\u5230\u533a\u95f4\u52a0\u6cd5\uff0c\u679c\u65ad\u60f3\u5230\u7ebf\u6bb5\u6811\uff0c~~\u800c\u4e0d\u662f\u5206\u5757~~\u3002\n\n\u672c\u9898\u4e2d\uff0c\u7ebf\u6bb5\u6811\u9700\u8981\u652f\u6301\u64cd\u4f5c$pushup,pushdown,build,update,query$\u3002\n\n\u73b0\u5728\u8981\u8003\u8651\u5982\u4f55\u7ef4\u62a4\u533a\u95f4\u7684\u5e73\u5747\u6570\u548c\u65b9\u5dee\u8fd9\u4e24\u4e2a\u4fe1\u606f\u3002\n- \u5e73\u5747\u6570\n\n\t\u7531\u5e73\u5747\u6570\u7684\u5b9a\u4e49\u53ef\u77e5\uff0c\u533a\u95f4$[l,r]$\u7684\u5e73\u5747\u6570\uff1a\n    $$\\overline a=\\frac1{r-l+1}\\sum_{i=l}^ra_i$$\n    \n    \u5373\n    $$\\frac{a_l+a_{l+1}+\\cdots+a_r}{r-l+1}$$\n    \n    $\\text{\u533a\u95f4\u548c}/\\text{\u533a\u95f4\u957f}$\u3002\u901a\u8fc7\u7ef4\u62a4\u533a\u95f4\u548c\u5373\u53ef\u5b9e\u73b0\u67e5\u8be2\u5e73\u5747\u6570\u3002\n   \n- \u65b9\u5dee\n\n\t\u524d\u7f6e\u77e5\u8bc6~~\u5e9f\u8bdd~~\uff1a\n    \n    \u5b8c\u5168\u5e73\u65b9\u516c\u5f0f\uff1a\n    $$(a\\pm b)^2=a^2\\pm2ab+b^2$$\n    \n    \u63a5\u4e0b\u6765\u63a8\u5bfc\u4e00\u4e0b\u65b9\u5dee\u516c\u5f0f\uff1a\n    \n    \u5bf9\u4e8e\u533a\u95f4$[l,r]$\uff0c\u5176\u65b9\u5dee\uff1a\n    \n    $$s^2=\\displaystyle\\frac1{r-l+1}\\sum_{i=l}^r(a_i-\\overline a)^2$$\n    $$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\displaystyle\\frac1{r-l+1}\\sum_{i=l}^r(a_i^2-2a_i\\overline a+\\overline a^2)$$\n    $$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\displaystyle\\frac1{r-l+1}[(a_l^2+a_{l+1}^2+\\cdots+a_r^2)$$\n    $$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ -2\\overline a(a_l+a_{l+1}+\\cdots+a_r)+(r-l+1)\\overline a^2]$$\n    $$=\\frac{a_l^2+a_{l+1}^2+\\cdots+a_r^2}{r-l+1}$$\n    $$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ -2\\overline a\\cdot\\frac{a_l+a_{l+1}+\\cdots+a_r}{r-l+1}+\\overline a^2$$\n    $$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\frac{a_l^2+a_{l+1}^2+\\cdots+a_r^2}{r-l+1}-2\\overline a^2+\\overline a^2$$\n\t$$\\ \\ \\ \\ \\ \\ \\ \\ =\\frac{a_l^2+a_{l+1}^2+\\cdots+a_r^2}{r-l+1}-\\overline a^2$$\n    \n    \u6240\u4ee5\u65b9\u5dee\u53ef\u4ee5\u7528\u533a\u95f4\u5e73\u65b9\u548c\u4e0e\u533a\u95f4\u5e73\u5747\u6570\u6765\u8868\u793a\uff0c\u800c\u5e73\u5747\u6570\u7528\u533a\u95f4\u548c\u6765\u8868\u793a\u3002\u6240\u4ee5\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7684\u4fe1\u606f\u5c31\u662f\u533a\u95f4\u5e73\u65b9\u548c\u4e0e\u533a\u95f4\u548c\u3002\u8fd9\u4e24\u4e2a\u4fe1\u606f\u90fd\u53ef\u4ee5\u7531\u5de6\u53f3\u4e24\u4e2a\u533a\u95f4\u5408\u5e76\u5f97\u6765\u3002\n***\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u533a\u95f4\u52a0\u6cd5\u4e4b\u540e\uff0c\u5982\u4f55\u7ef4\u62a4\u533a\u95f4\u5185\u4fe1\u606f\uff1f\n\n\u5148\u662f$update$\u51fd\u6570\u628a\u533a\u95f4\u52a0\u6cd5\u8f6c\u5316\u4e3a\u82e5\u5e72\u4e2a$lazy\\ tap$\uff0c\u5728\u9700\u8981\u7684\u65f6\u5019$pushdown$\u4e0b\u53bb\u3002\n\n\u539f\u533a\u95f4\u5e73\u65b9\u548c$sqr=a_l^2+a_{l+1}^2+\\cdots+a_r^2$\u3002\n\n\u4ee4\u8be5\u533a\u95f4\u6bcf\u4e00\u4e2a\u6570\u5b57\u52a0\u4e0a$k$\uff0c\u5219\u4fee\u6539\u540e\u7684\u503c\uff1a\n\n$\\ \\ \\  \\ (a_l+k)^2+(a_{l+1}+k)^2+\\cdots+(a_r+k)^2$\n\n$=a_l^2+2a_lk+k^2+a_{l+1}^2+2a_{l+1}k+k^2+\\cdots+a^2_r+2a_rk+k^2$\n\n$=(a_l^2+a_{l+1}^2+\\cdots+a_r^2)+2k(a_l+a_{l+1}+\\cdots+a_r)+(r-l+1)k^2$\n\n\u53d8\u5316\u91cf\u4e3a\uff1a$2k(a_l+a_{l+1}+\\cdots+a_r)+(r-l+1)k^2$\n\n\u5373\u52a0\u4e0a $2*$\u7236\u8282\u70b9\u7684\u6807\u8bb0$*$\u539f\u533a\u95f4\u548c$+$\u533a\u95f4\u957f$*$\u7236\u8282\u70b9\u7684\u6807\u8bb0$^2$\u3002\u7ffb\u8bd1\u6210\u7a0b\u5e8f\u8bed\u8a00\u5373\u53ef\u3002\n\n\u533a\u95f4\u548c\u3001\u6807\u8bb0\u7684\u4fee\u6539\u8f83\u7b80\u5355\uff0c\u8be6\u89c1\u4ee3\u7801\u90e8\u5206\n\n\n### \u672c\u4eba\u7ffb\u8f66\u7ecf\u5386\n\n- \u5b8f\u5b9a\u4e49\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u7ed9$llen,rlen,len$\u52a0\u4e0a\u5916\u9762\u7684\u62ec\u53f7\uff0c\u5bfc\u81f4\u7206\u70b8\u3002\u6240\u4ee5\u8bb0\u4f4f\uff0c\u5b8f\u5b9a\u4e49\u4e00\u5b9a\u8981\u5e26\u62ec\u53f7\uff0c\u5426\u5219\u7ed3\u679c\u4e0d\u582a\u8bbe\u60f3\uff0c~~\u8c03\u8bd5\u4e86\u597d\u51e0\u5929~~\u3002\n\n### \u6280\u5de7 \n\n- \u7ebf\u6bb5\u6811\u5c01\u88c5\u6210\u4e86\u7c7b\uff0c\u65b9\u4fbf\u8c03\u7528\uff0c\u6bd4\u8f83\u7f8e\u89c2\u3002\n\t\n\t\u8fd9\u6837\u4e3b\u51fd\u6570\u6bd4\u8f83\u77ed\u5c0f\uff0c\u6bcf\u6b21\u64cd\u4f5c\u90fd\u662f\u4f20\u5165\u4e00\u4e2a\u53c2\u6570$opt$\u5373\u53ef\uff0c\u628a\u7ec6\u8282\u5c01\u88c5\u8d77\u6765\u3002\n\n- \u5229\u7528\u4f4d\u8fd0\u7b97\u4e0e\u5b8f\uff0c\u8282\u7ea6\u7801\u91cf\u3002\n\n\t\u8fd9\u4e2a\u662f\u7ebf\u6bb5\u6811\u57fa\u7840\u77e5\u8bc6\u3002\n    \n    \u5de6\u513f\u5b50\u7684\u7f16\u53f7\u662f\u7236\u8282\u70b9\u7684\u4e24\u500d\uff0c\u53f3\u513f\u5b50\u7684\u7f16\u53f7\u662f\u7236\u8282\u70b9\u7684\u4e24\u500d+1\u3002\u8bbe\u7236\u8282\u70b9\u7684\u7f16\u53f7\u4e3a$rt$\uff0c\u5219\u5de6\u513f\u5b50$lson=rt*2=rt<<1$\uff0c\u53f3\u513f\u5b50$rson=rt*2+1=rt<<1|1$\u3002\n    \n    \n    \nAC\u4ee3\u7801\n\n~~~cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n\n#define DEBUG \\\ndo {\\\n  for (int i = 1; i <= n; ++i) {\\\n    printf(\"%d \", st.query_sum(i,i,1,n,1));\\\n  }\\\n  putchar('\\n');\\\n}while(0);\n\n//debug\u7528\u7684\n\nusing namespace std;\n\nconst int N = 1e5, M = 1e5;\n//\u5e38\u91cf\n\ntypedef double db;\n\nint n, m;\n\nclass segmenttree {\n  private:\n    db add[N << 2];//\u6807\u8bb0\n    db sum[N << 2];//\u533a\u95f4\u548c\n    db sqr[N << 2];//\u5e73\u65b9\u548c\n\n\t//\u5b8f\u5b9a\u4e49\u82e5\u5e72\n    #define lson rt<<1\n    #define rson rt<<1|1\n    #define ltree l,m,lson\n    #define rtree m+1,r,rson\n    #define len (r-l+1)\n    #define llen (m-l+1)\n    #define rlen (r-m)\n    #define sq(x) (x)*(x)\n\n\t//\u4e00\u822c\u7528rt\u8868\u793a\u5f53\u524d\u8282\u70b9\n    //\u5408\u5e76\u5de6\u53f3\u513f\u5b50\u7684\u4fe1\u606f\u3002\u76f4\u63a5\u76f8\u52a0\u5373\u53ef\u3002\n    inline void pushup(int rt) {\n      sum[rt] = sum[lson] + sum[rson];\n      sqr[rt] = sqr[lson] + sqr[rson];\n    }\n\n\t//\u4e0b\u653e\uff0c\u5728\u4e0a\u9762\u6709\u8be6\u7ec6\u8bb2\u8fc7\n    inline void pushdown(int l, int r, int rt) {\n      if (add[rt]) {\n        int m = (l + r) >> 1;\n\n        sqr[lson] += 2.0 * sum[lson] * add[rt]\n                   + llen * sq(add[rt]);\n        sqr[rson] += 2.0 * sum[rson] * add[rt]\n                   + rlen * sq(add[rt]);\n                   \n        sum[lson] += llen * add[rt];\n        sum[rson] += rlen * add[rt];\n        \n        add[lson] += add[rt];\n        add[rson] += add[rt];\n        \n        add[rt] = 0;\n      }\n\n    }\n\n\t//\u67e5\u8be2\u51fd\u6570\uff0cL,R\u8868\u793a\u76ee\u6807\u533a\u95f4\uff0cl,r\u8868\u793a\u5f53\u524d\u533a\u95f4\u3002\n    db query_sum(int L, int R, int l, int r, int rt) {\n      if (L <= l && r <= R) {\n        return sum[rt];\n      }\n      pushdown(l, r, rt);\n      int m = (l + r) >> 1;\n      db ans = 0;\n      if (L <= m) {\n        ans += query_sum(L, R, ltree);\n      }\n      if (R > m) {\n        ans += query_sum(L, R, rtree);\n      }\n      return ans;\n    }\n\n    db query_sqr(int L, int R, int l, int r, int rt) {\n      if (L <= l && r <= R) {\n        return sqr[rt];\n      }\n      pushdown(l, r, rt);\n      int m = (l + r) >> 1;\n      db ans = 0;\n      if (L <= m) {\n        ans += query_sqr(L, R, ltree);\n      }\n      if (R > m) {\n        ans += query_sqr(L, R, rtree);\n      }\n      return ans;\n    }\n\t\n    \n    //\u533a\u95f4\u4fee\u6539\n    void update(int L, int R, db C, int l, int r, int rt) {\n      if (L <= l && r <= R) {\n        add[rt] += C;\n        //\u8fd9\u4e00\u6b65\u7684\u539f\u7406\u89c1\u4e0a\u3002\n        sqr[rt] += 2 * C * sum[rt]\n                 + len * sq(C);\n        sum[rt] += len * C;\n        return ;\n      }\n      pushdown(l, r, rt);\n      int m = (l + r) >> 1;\n      if (L <= m) {\n        update(L, R, C, ltree);\n      }\n      if (R > m) {\n        update(L, R, C, rtree);\n      }\n      pushup(rt);\n    }\n\n  public:\n  \n    segmenttree(void){}\n    \n    void build(int l, int r, int rt) {\n      if (l == r) {\n        scanf(\"%lf\", &sum[rt]);\n        sqr[rt] = sq(sum[rt]);\n        return ;\n      }\n      int m = (l + r) >> 1;\n      build(ltree); build(rtree);\n      pushup(rt);\n    }\n\n    inline void f(int opt) {\n      register int l, r;\n      register db k;\n      scanf(\"%d %d\", &l, &r);\n      \n      /*\n      opt\u6709\u4e09\u79cd\u53ef\u80fd\n      1 \u4e8c\u8fdb\u5236\u4e0b\u4e3a1\n      2 \u4e8c\u8fdb\u5236\u4e0b\u4e3a10\n      3 \u4e8c\u8fdb\u5236\u4e0b\u4e3a11\n      \n      1&1 = 1, 2&1 = 0, 3&1 = 1\u3002\n      \n      \u6240\u4ee5&1\u4e4b\u540e\uff0c\u4e3a\u771f\u7684\u662f1\u62163\uff0c\u4e3a\u5047\u7684\u662f2\n      \n      1>>1 = 0, 3 >> 1 = 1\u3002\n      \n      \u6240\u4ee5>>1\u4e4b\u540e\uff0c\u4e3a\u771f\u7684\u662f3\uff0c\u4e3a\u5047\u7684\u662f1\n      */\n      if (opt & 1) {\n        if (opt >> 1) {\n          db s1 = query_sqr(l, r, 1, n, 1) / len,\n             s2 = query_sum(l, r, 1, n, 1) / len;\n\t\t\t//\u65b9\u5dee\u7684\u89e3\u91ca\u5728\u4e0a\u9762\n          printf(\"%.4lf\\n\", s1 - sq(s2));\n        }\n        else {\n          scanf(\"%lf\", &k);\n          update(l, r, k, 1, n, 1);\n        }\n      }\n      else {\n        printf(\"%.4lf\\n\", query_sum(l, r, 1, n, 1) / len);\n      }\n    }\n};\n\nsegmenttree st;\n\n\nint main(void) {\n\n  scanf(\"%d %d\", &n, &m);\n  \n  st.build(1, n, 1);\n  \n  while (m--) {\n    int opt;\n    scanf(\"%d\", &opt);\n    st.f(opt);\n  }\n  \n  return 0;\n}\n~~~",
        "postTime": 1567130185,
        "uid": 104438,
        "name": "\u5403\u7684",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u9700\u8981\u5bf9\u516c\u5f0f\u8fdb\u884c\u4e00\u5b9a\u7684\u5206\u6790\u53d8\u5f62\u80fd\u529b\u5373\u53ef\n\n\u9996\u5148\u5e73\u5747\u6570\u5f88\u597d\u7ef4\u62a4\uff0c\u533a\u95f4\u548c/\u533a\u95f4\u957f\u5373\u53ef\n\n\u96be\u70b9\u5728\u4e8e\u65b9\u5dee\uff0c\u5728\u4e8e\u533a\u95f4\u52a0\u548c\u65f6\u5bf9\u65b9\u5dee\u7684\u5f71\u54cd\n\n\n\u65b9\u5dee\u516c\u5f0f\u770b\u8d77\u6765\u590d\u6742\uff0c\u5176\u5b9e\u5316\u7b80\u5f00\u6765\u53ea\u662f\u4e00\u4e2a\u53c2\u6570\u4e0d\u591a\u7684\u591a\u9879\u6570\n\n\u65b9\u5dee\u7684\u8ba1\u7b97\u5f88\u7b80\u5355\uff0c \u6211\u4eec\u628a\u516c\u5f0f\u62c6\u5f00\uff0c \u628a \u6bcf\u4e2a (Xi- AVE) ^2 \u90fd\u5316\u5f00:\n\n\u5c31\u5f97\u5230\u4e86\u4e00\u6bb5\u533a\u95f4\u7684\u5e73\u65b9\u548c\uff0c\u52a0\u4e0a 2\\* AVE \\* \u4e00\u6bb5\u533a\u95f4\u7684\u548c\uff0c\u52a0\u4e0a AVE^2  , \u6700\u540e\u6574\u4f53\u9664\u4e2a\u533a\u95f4\u957f \uff08\u5177\u4f53\u6570\u5b66\u516c\u5f0f\u770b\u697c\u4e0b\uff09\n\n\n\u4e8e\u662f\u6211\u4eec\u9700\u8981\u7528\u4e00\u68f5\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u548c   \uff0c \u4e00\u68f5\u7ef4\u62a4\u533a\u95f4\u5e73\u65b9\u548c\n\n\u95ee\u9898\u5c31\u5728\u4e8e\u6211\u4eec\u600e\u6837\u5728\u533a\u95f4\u8fdb\u884c\u52a0\u548c\u64cd\u4f5c\u65f6\u5bf9\u8fd9\u4e24\u4e2a\u6570\u7ec4\u8fdb\u884c\u7ef4\u62a4\n\n\u533a\u95f4\u548c\u53ea\u8981\u6b63\u5e38\u7684lazytag\u4e0b\u4f20\u5373\u53ef\n\n\u533a\u95f4\u5e73\u65b9\u548c\u5728lazytag\u4e0b\u4f20\u548cupdate\u66f4\u65b0\u65f6\u987b\u6ce8\u610f\u3002\n\n\u6211\u4eec\u628a\u516c\u5f0f\u62c6\u5f00 \uff08A\u4e3a\u4fee\u6539\u503c\uff09\uff1a\n\n\u628a ( X(l)+A) ^2 + ( X(l+1)+A) ^ 2 + \u2026\u2026+ ( X(r) + A) ^ 2 \uff09 \u5404\u9879\u62c6\u5f00\uff0c \u4fbf\u5f97\u5230\uff1a\n\n\u539f\u533a\u95f4\u5e73\u65b9\u548c+ \u533a\u95f4\u957f \\* A ^2 + 2 \\* A \\* \u533a\u95f4\u548c  \uff08 \u8c03\u7528\u5148\u524d\u90a3\u4e2a\u6570\u7ec4\u5373\u53ef\uff09\n\n\u5269\u4e0b\u7684\u4fbf\u662f\u5e38\u89c1\u7684\u7ebf\u6bb5\u6811\u64cd\u4f5c\u4e86 \uff0c \u7a0d\u7a0d\u6ce8\u610f\u7ec6\u8282\n\n\n\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,j,n) for(int i=j;i<=n;i++)\nusing namespace std;\ntypedef long long ll;\nconst int N=1e5+10;\nint n,m;\ndouble tree1[N<<2] , tree2[N<<2] , addv[N<<2] , c[N] ;  //\u7ef4\u62a42\u68f5\u7ebf\u6bb5\u6811\uff0c \u4e00\u68f5\u4e3a\u5b50\u6811\u548c\uff0c \u4e00\u68f5\u4e3a\u5b50\u6811\u5e73\u65b9\u548c \n#define lson o<<1\n#define rson o<<1|1\n#define mid (l+r>>1)\n#define up(o) tree1[o]=tree1[lson]+tree1[rson] ; tree2[o]=tree2[lson]+tree2[rson] \ninline void build(int o,int l,int r) {\n    if(l==r) { tree1[o]=c[l] ; tree2[o]=c[l]*c[l] ; return ;}\n    build(lson,l,mid) ; build(rson,mid+1,r) ; up(o);\n}\ninline void down(int o,int l,int r,double x) {  //\u6d89\u53ca\u533a\u95f4\u4fee\u6539 \n    addv[lson]+=x ; addv[rson]+=x; \n    tree2[lson]+=x * x * (mid-l+1) + 2 * x * tree1[lson] ; \n    tree2[rson]+=x * x * (r - mid) + 2 * x * tree1[rson] ; \n    tree1[lson]+=x*(mid-l+1) ; tree1[rson]+=x*(r-mid) ;\n}\ninline void update(int o,int l,int r,int L,int R ,double x) {  // \u672c\u9898\u7684\u5173\u952e\u70b9\u5728\u4e8e\u5982\u4f55\u4e0b\u4f20\u6807\u8bb0\u548c\u533a\u95f4\u4fee\u6539\n    if(L<=l && r<=R ) {\n        addv[o]+=x; tree2[o]+=(r-l+1)*x*x + 2*x * tree1[o] ;tree1[o]+=x*(r-l+1) ;  return ;\n    }\n    if(addv[o]) down(o,l,r,addv[o]) , addv[o]=0;\n    if(L<=mid) update(lson,l,mid,L,R,x) ;\n    if(R>mid) update(rson,mid+1,r,L,R,x);\n    up(o); \n}\ninline double query(int o ,int l,int r,int L,int R ,double *tree) { //\u6c42\u5e73\u5747\u503c\uff0c \u7b80\u5355\u7684\u7d2f\u548c \n    if(L<=l && r<=R)  return tree[o];\n    if(addv[o]) down(o,l,r,addv[o]) , addv[o]=0 ;\n    double ret=0 ;\n    if(L<=mid) ret+=query(lson,l,mid,L,R,tree) ;\n    if(R>mid) ret+=query(rson,mid+1,r,L,R,tree);\n    return ret ;\n}\n```\n/\\*\ninline double query2(int o,int l,int r,int L,int R ) { //\u6c42\u65b9\u5dee\u7684\u4e00\u90e8\u5206 \uff0c\u5373\u67e5\u8be2\u7b2c\u4e8c\u68f5\u7ebf\u6bb5\u6811\u4e2d\u7684\u5e73\u65b9\u548c\n\n\n```cpp\n    if(L<=l && r<=R)  return tree2[o];\n    if(addv[o]) down(o,l,r,addv[o]) , addv[o]=0 ;\n    double ret=0 ;\n    if(L<=mid) ret+=query2(lson,l,mid,L,R) ;\n    if(R>mid) ret+=query2(rson,mid+1,r,L,R);\n    return ret ;\n}*/\nint main() {\n    scanf(\"%d%d\",&n,&m);\n    rep(i,1,n) scanf(\"%lf\",&c[i]);\n    build(1,1,n) ;\n    int type, x,y  ; double k ;\n    while(m--) {\n        scanf(\"%d%d%d\",&type,&x,&y) ;   double len=(double) (y-x+1) ;   \n        if(type==1) scanf(\"%lf\",&k) ,update(1,1,n,x,y,k);\n        if(type==2) printf(\"%.4lf\\n\", query(1,1,n,x,y,tree1) / len );\n        if(type==3) {\n            double sum=query(1,1,n,x,y,tree1) ;\n            double ave=sum / len ; \n            printf(\"%.4lf\\n\" , ave*ave + query(1,1,n,x,y,tree2) / len - 2*sum*ave/len ) ;\n        } \n    }\n    return 0;\n}\n\n```",
        "postTime": 1508593087,
        "uid": 27276,
        "name": "\u738b\u5c06\u98de\u626cCliffly",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    },
    {
        "content": "\u6211\u53d1\u73b0\u597d\u50cf\u6ca1\u6709\u4eba\u7279\u522b\u6e05\u6670\u5730\u63cf\u8ff0\u6253\u61d2\u6807\u8bb0\u8fd9\u4e2a\u8fc7\u7a0b, \u6240\u4ee5\u7279\u610f\u6253\u51fa\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u770b\u6ce8\u91ca\u5427~~~\n\n```cpp\n#include<iostream>\n#include<iomanip>\nusing namespace std;\nconst int N = 100005, INF = 0x7fffffff;\ndouble a[N], sum[4*N], sum2[4*N]; \ndouble tag[4*N];\n\nvoid pushup(int k)\n{\n\tsum[k] = sum[k * 2] + sum[k * 2 + 1]; //\u533a\u95f4\u548c\n\tsum2[k] = sum2[k * 2] + sum2[k * 2 + 1]; //\u533a\u95f4\u5e73\u65b9\u548c\n\treturn ; \n} \n\nvoid build(int k, int lt, int rt) //\u7b2ck\u4e2a\u7ed3\u70b9\uff0c lt rt\u4e3a\u8981\u8be2\u95ee\u7684\u533a\u95f4\u8303\u56f4 \n{\n\tif(lt == rt)\n\t{\n\t\tsum[k] = a[lt]; //a\u4e3a\u539f\u59cb\u6570\u7ec4\uff0csum[k]\u4e3a\u7b2ck\u4e2a\u7ed3\u70b9\u7684\u533a\u95f4\u548c \n\t\tsum2[k] = a[lt] * a[lt]; //\u5e73\u65b9 \n\t\treturn ;\n\t}\n\tint mid = lt + (rt - lt) / 2; // mid = (lt + rt) >> 1\n\tbuild(k * 2, lt, mid);\n\tbuild(k * 2 + 1, mid + 1, rt);\n\tpushup(k);\n\treturn ;\n}\n\nvoid Add(int k, int lt, int rt, double val) //\u6253\u61d2\u6807\u8bb0 \n{\n\ttag[k] += val; //\u6807\u8bb0K\u7ed3\u70b9\u5bf9\u5e94\u7684\u533a\u95f4\u8981\u52a0\u7684\u503c\n\tsum2[k] += 2 * val * sum[k] + val * val * (rt - lt + 1); //\u56e0\u4e3a\u5e73\u65b9\u548c\u8981\u7528\u5230 \u533a\u95f4\u548c\uff0c \u6240\u4ee5\u8981\u5148\u66f4\u65b0\uff01 \n\tsum[k] += (rt - lt + 1) * val; \n\treturn ; \n}\n\nvoid pushdown(int k, int lt, int rt)\n{\n\tif(tag[k] == 0)\n\t\treturn ;\n\tint mid = lt + (rt - lt) / 2;\n\tAdd(k*2, lt, mid, tag[k]);\n\tAdd(k*2+1, mid+1, rt, tag[k]);\n\ttag[k] = 0; //\u5c06\u6807\u8bb0\u4f20\u7ed9\u5b50\u8282\u70b9\u540e\uff0c\u7236\u8282\u70b9\u7684\u6807\u8bb0\u8981\u6e05\u96f6\uff0c\u5426\u5219\u4f1a\u52a0\u91cd\u590d\n\treturn ; \n}\n\n//\u5728qx, qy\u533a\u95f4\u6bcf\u4e2a\u6570\u52a0\u4e0aval \nvoid modify(int k, int lt, int rt, int qx, int qy, double val)\n{\n\tif(lt > qy || rt < qx)\n\t\treturn ;\n\telse if(lt >= qx && rt <= qy)\n\t{\n\t\tAdd(k, lt, rt, val);\n\t\treturn ;\n\t}\n\tint mid = lt + (rt - lt) / 2;\n\tpushdown(k, lt, rt); \n\tmodify(k * 2, lt, mid, qx, qy, val);\n\tmodify(k * 2 + 1 , mid + 1, rt, qx, qy, val);\n\tpushup(k);\n\treturn ; \n}\n\ndouble query(int k, int lt, int rt, int qx, int qy)\n{\n\tif(lt > qy || rt < qx)\n\t\treturn 0;\n\telse if(lt >= qx && rt <= qy)\n\t\treturn sum[k];\n\tint mid = lt + (rt - lt) / 2;\n\tpushdown(k, lt, rt); //\u8be2\u95ee\u65f6\u624d\u4e0b\u4f20\u6807\u8bb0\uff0c\u56e0\u4e3a\u9700\u8981\u77e5\u9053\u5b50\u533a\u95f4\u8981\u52a0\u7684\u503c \n\treturn query(k * 2, lt, mid, qx, qy) + query(k * 2 + 1, mid + 1, rt, qx, qy);\n}\n\ndouble query2(int k, int lt, int rt, int qx, int qy)\n{\n\tif(lt > qy || rt < qx)\n\t\treturn 0;\n\telse if(lt >= qx && rt <= qy)\n\t\treturn sum2[k];\n\tint mid = lt + (rt - lt) / 2;\n\tpushdown(k, lt, rt); //\u8be2\u95ee\u65f6\u624d\u4e0b\u4f20\u6807\u8bb0\uff0c\u56e0\u4e3a\u9700\u8981\u77e5\u9053\u5b50\u533a\u95f4\u8981\u52a0\u7684\u503c \n\treturn query2(k * 2, lt, mid, qx, qy) + query2(k * 2 + 1, mid + 1, rt, qx, qy);\n}\n\n\nint main()\n{\n\tint n, m;\n\tcin >> n >> m;\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\tcin >> a[i];\n\t} \n\tbuild(1, 1, n); //\u5efa\u6811 \n\tfor(int i = 1; i <= m; i++)\n\t{\n\t\tint option, x, y;\n\t   \tdouble v;\n\t\tcin >> option;\n\t\tif(option == 1)\n\t\t{\n\t\t\tcin >> x >> y >> v;\n\t\t\tmodify(1, 1, n, x, y, v);\n\t\t}\n\t\telse if(option == 2)\n\t\t{\n\t\t\tcin >> x >> y;\n\t\t\tcout << fixed << setprecision(4) << query(1, 1, n, x, y) / (y-x+1) << \"\\n\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcin >> x >> y;\n\t\t\tdouble avg = query(1, 1, n, x, y) / (y-x+1);\n\t\t\tcout << fixed << setprecision(4) << -avg * avg + query2(1, 1, n, x, y) / (y-x+1) << \"\\n\";\n\t\t}\n\t}\n    return 0;\n}\n\n```\n",
        "postTime": 1583025349,
        "uid": 242701,
        "name": "\u6d6e\u5c18",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P1471 \u3010\u65b9\u5dee\u3011"
    }
]