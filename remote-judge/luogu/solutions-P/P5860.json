[
    {
        "content": "$\\color{blue}\\text{(\u91cd\u5236\u4e8e 2020.11.26)}$\n\n\u7531\u4e8e\u65f6\u95f4\u5173\u7cfb\u6ca1\u6709\u73b0\u573a\u6253\uff0c\u8d5b\u540e\u6765\u809d\u9898\u3002\n\n\u770b\u5230\u6570\u6811\u4ee5\u4e3a\u662f\u5927\u6bd2\u7624\uff0c\u6ca1\u60f3\u5230\u8fd9\u6811\u5c31\u662f\u6765\u5f00\u73a9\u7b11\u7684\u2026\u2026\n\n\u6811\u7684\u5fc5\u8981\u6761\u4ef6 : $\\text{\u5ea6\u6570\u548c}=2(\\text{\u70b9\u6570}-1)$\n\n\u82e5\u5ea6\u6570\u7b26\u5408\u8981\u6c42,\u6839\u636e $\\rm prufer$ \u5e8f\u5217,\u5fc5\u7136\u80fd\u591f\u9020\u51fa\u7b26\u5408\u8981\u6c42\u7684\u6811\u3002\u5219\u4e0a\u9762\u7684\u662f\u5145\u8981\u6761\u4ef6\u3002\n\n\u79fb\u9879\u6574\u7406\u5f97\u5230 $\\text{\u5ea6\u6570\u548c}-2\\text{\u70b9\u6570}=-2$\n\n\u6211\u4eec\u6bcf\u52a0\u4e00\u4e2a\u70b9\u6263\u9664 $2$ \u70b9\u8d21\u732e\uff0c\u6bcf\u6709\u4e00\u4e2a\u5ea6\u6570\u52a0\u4e0a $1$ \u70b9\u8d21\u732e\uff0c\u5177\u4f53\u5904\u7406\u65b9\u5f0f\u5c31\u662f $\\rm OGF$\u3002\n\n\u5168\u90e8\u5377\u79ef\u8d77\u6765\u4e4b\u540e\uff0c$[x^{-2}]$ \u9879\u5c31\u662f\u7b54\u6848\u3002\n\n(\u6211\u5728CSP2019\u66fe\u56e0\u4e3a\u6ca1\u770b\u51fa\u8fd9\u4e2atrick\u767d\u4e22\u4e8616\u5206qwq)\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u9700\u8981\u6c42 $[x^{-2}]\\prod\\limits_{i=1}^n(1+x^{v_i-2})$\n\n\u600e\u4e48\u8fd8\u6709\u8d1f\u6570\u6b21\u9879\u554a\uff0c\u53c8\u6ca1\u6cd5\u5206\u6cbbNTT\uff0c\u4e00\u8138\u4e0d\u53ef\u505a\u7684\u6837\u5b50\u2026\u2026\n\n\u9996\u5148\u5bf9\u4e8e $v_i=2$ \u7684\u70b9\u5355\u72ec\u63d0\u51fa\u6765(\u6b21\u6570\u4e3a0),\u8bbe\u6709 $m$ \u4e2a,\u6700\u540e\u7b54\u6848\u4e58\u4ee5 $2^m$ \u3002\n\n\u9996\u5148\u5bf9\u4e8e $v^i<2$ \u7684\u90e8\u5206\uff0c\u53ea\u53ef\u80fd\u6709 $(1+x^{-1})$ \u3002\u8fd9\u90e8\u5206\u76f4\u63a5\u8bb0\u5f55\u6b21\u6570 $c$ ,\u4e8c\u9879\u5f0f\u5b9a\u7406\u5373\u53ef\u3002\n\n\u5f97\u5230 $F1(x)$ ,\u6700\u4f4e\u6709 $-c$ \u6b21\u9879\uff0c\u6ce8\u610f\u5230\u6b63\u8d1f\u9879\u53ef\u80fd\u76f8\u6d88\uff0c\u6211\u4eec\u540e\u9762\u6b63\u6b21\u6570\u7684\u591a\u9879\u5f0f\u4fdd\u7559 $\\bmod\\ x^{c-1}$ \u7684\u9879\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $v_i>2$ \u7684\u90e8\u5206\uff0c\u65e0\u6cd5\u5206\u6cbbNTT\u3002\n\n\u4ee4 $a_i=v_i-2$ (\u6b64\u65f6\u4f59\u4e0b\u7684\u6240\u6709 $a_i>0$ )\n\n${\\rm Ans}=\\prod\\limits_{i=1}^n(1+x^{a_i})$\n\n\u7c7b\u4f3c `P4389` \u8003\u8651\u5c06\u6bcf\u4e2a\u4e1c\u897f $\\ln$ \u4e4b\u540e\u52a0\u5728\u4e00\u8d77\u518d $\\exp$ \u56de\u6765\u3002\n\n\u4e0d\u96be\u53d1\u73b0 $\\ln(1+x^a)$ \u53ea\u5728 $a$ \u7684\u500d\u6570\u6b21\u6570\u5904\u6709\u503c\u3002\n\n\u5177\u4f53\u800c\u8a00\uff0c\u6839\u636e $-\\ln(1-x)=\\sum\\limits_{i=1}\\dfrac{x^i}{i}$\n\n\u53ef\u63a8\u77e5 $\\ln(1+x^a)=\\sum\\limits_{i=0}\\dfrac{(-x)^{ia}}{i}$\n\n\u9700\u8981\u7d2f\u52a0\u7684\u9879\u662f $O\\Big(\\sum\\limits_{i=1}^nn/i\\Big)=O(n\\log n)$ \u7684\u3002\n\n\u5269\u4e0b\u7684\u5c31\u662f `P4389` \u4e86,\u5f97\u5230\u8fd9\u90e8\u5206\u7684 $F2(x)$\u3002\n\n\u6700\u540e\u628a $F1,F2$ \u5377\u8d77\u6765\u5c31\u662f\u7b54\u6848\uff0c\u8d1f\u6307\u6570\u52a0\u6cd5\u5377\u79ef\u7684\u89c4\u5219\u548c\u6b63\u6307\u6570\u7c7b\u4f3c\u3002\n\n\u672c\u9898\u4e2d\u53ef\u4ee5\u628a $F1$ \u6574\u4f53\u5e73\u79fb\u6765\u5904\u7406\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<ctime>\n#define ll long long\n#define mod 998244353\n#define G 3\n#define Maxn 530000\nusing namespace std;\ninline int read()\n{\n  register int X=0;\n  register char ch=0;\n  while(ch<48||ch>57)ch=getchar();\n  while(ch>=48&&ch<=57)X=X*10+(ch^48),ch=getchar();\n  return X;\n}\nll powM(ll a,ll t=mod-2)\n{\n  ll ans=1;\n  while(t){\n  \tif(t&1)ans=ans*a%mod;\n  \ta=a*a%mod;\n  \tt>>=1;\n  }return ans;\n}\nint tr[Maxn<<1];\nll invG=powM(G);\nvoid NTT(ll *f,short op,int n)\n{\n  for (int i=0;i<n;i++)\n    if (i<tr[i])swap(f[i],f[tr[i]]);\n  for(int p=2;p<=n;p<<=1){\n    int len=p>>1,\n        tG=powM(op==1 ? G:invG,(mod-1)/p);\n    for (int k=0;k<n;k+=p){\n  \t  ll buf=1;\n  \t  for (int i=k;i<k+len;i++){\n  \t  \tint sav=f[len+i]*buf%mod;\n  \t  \tf[len+i]=(f[i]-sav+mod)%mod;\n  \t  \tf[i]=(f[i]+sav)%mod;\n  \t  \tbuf=buf*tG%mod;\n  \t  }\n    }\n  }\n}\nll _g1[Maxn<<1];\nvoid times(ll *f,ll *g,int len1,int len2,int lim)\n{\n  int m=len1+len2-1,n;\n  for(int i=0;i<len2;i++)_g1[i]=g[i];\n  #define g _g1\n  for(n=1;n<m;n<<=1);\n  for(int i=len2;i<n;i++)g[i]=0;\n  ll invn=powM(n);\n  for(int i=0;i<n;i++)\n    tr[i]=(tr[i>>1]>>1)|((i&1)?n>>1:0);\n  NTT(f,1,n);NTT(g,1,n);\n  for(int i=0;i<n;++i)f[i]=f[i]*g[i]%mod;\n  NTT(f,-1,n);\n  for(int i=0;i<lim;++i)\n    f[i]=f[i]*invn%mod;\n  for(int i=lim;i<n;++i)f[i]=0;\n  #undef g\n}\nll _w2[Maxn<<1],_r2[Maxn<<1];\nvoid invp(ll *f,int m)\n{\n  int n;for (n=1;n<m;n<<=1);\n  #define w _w2\n  #define r _r2\n  w[0]=powM(f[0]);\n  for (int len=2;len<=n;len<<=1){\n  \tfor (int i=0;i<(len>>1);i++)\n      r[i]=(w[i]<<1)%mod;\n  \ttimes(w,w,len>>1,len>>1,len);\n  \ttimes(w,f,len,len,len);\n  \tfor (int i=0;i<len;i++)\n      w[i]=(r[i]-w[i]+mod)%mod;\n  }for (int i=0;i<m;i++)f[i]=w[i];\n  for (int i=0;i<n;i++)w[i]=r[i]=0;\n  #undef w\n  #undef r\n}\nll fac[Maxn],inv[Maxn],inp[Maxn];\nll C(int n,int m)\n{return fac[n]*inv[m]%mod*inv[n-m]%mod;}\nvoid Init(int m)\n{\n  int lim=1;\n  for (;lim<m;lim<<=1)\n  fac[0]=1;\n  for (int i=1;i<=lim;i++)\n    fac[i]=fac[i-1]*i%mod;\n  inv[lim]=powM(fac[lim]);\n  for (int i=lim;i;i--){\n    inv[i-1]=inv[i]*i%mod;\n    inp[i]=inv[i]*fac[i-1]%mod;\n  }\n}\nvoid dao(ll *f,int m)\n{\n  for (int i=1;i<m;i++)\n   f[i-1]=f[i]*i%mod;\n  f[m-1]=0;\n}\nvoid jifen(ll *f,int m)\n{\n  for (int i=m;i;i--)\n    f[i]=f[i-1]*powM(i)%mod;\n  f[0]=0;\n}\nll _s3[Maxn<<2];\nvoid lnp(ll *f,int m)\n{\n  ll *sav=_s3;\n  for (int i=0;i<m;i++)sav[i]=f[i];\n  invp(sav,m);dao(f,m);\n  times(f,sav,m-1,m,m);\n  jifen(f,m-1);\n  for (int i=0;i<m;i++)sav[i]=0;\n}\nll _xp[Maxn<<2],_xp2[Maxn<<2];\nvoid exp(ll *f,int m)\n{\n  ll *s=_xp,*s2=_xp2;\n  int n=1;for(;n<m;n<<=1);\n  s2[0]=1;\n  for (int len=2;len<=n;len<<=1){\n  \tfor (int i=0;i<(len>>1);i++)s[i]=s2[i];\n  \tlnp(s,len);\n  \tfor (int i=0;i<len;i++)\n  \t  s[i]=(f[i]-s[i]+mod)%mod;\n  \ts[0]=(s[0]+1)%mod;\n  \ttimes(s2,s,len>>1,len,len);\n  }for (int i=0;i<m;i++)f[i]=s2[i];\n  for (int i=0;i<n;i++)s[i]=s2[i]=0;\n}\nll buf,F1[Maxn],F2[Maxn];\nint n,c[Maxn],m;\nint main()\n{\n  n=read();\n  for (int i=1;i<=n;i++)c[read()]++;\n  m=c[1];\n  if (m<2){printf(\"0\");return 0;}\n  Init(m);\n  for (int i=0;i<m-1;i++)F1[i]=C(m,i);\n  m--;\n  for (int i=3;i<=n;i++){\n    ll a=i-2;\n    for (int j=1;j*a<m;j++)\n      F2[j*a]=(F2[j*a]+1ll*c[i]*((j&1) ? inp[j] : mod-inp[j]))%mod;\n  }\n  exp(F2,m);\n  times(F1,F2,m,m,m);\n  printf(\"%lld\",F1[m-1]*powM(2,c[2])%mod);\n  return 0;\n}\n```\n\n\n",
        "postTime": 1577535962,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5860 \u3010\u300cSWTR-03\u300dCounting Trees\u3011"
    },
    {
        "content": "$\\color{#00008B}\\mathrm{This\\ is\\ Sweet\\ Round\\ 03.}$\n\n[$\\color{#00008B}\\mathrm{Link:T6\\ Counting\\ Trees}$](https://www.luogu.com.cn/problem/T112465)\n\n\u57fa\u7840\u591a\u9879\u5f0f\u4f18\u5316\u80cc\u5305\u3002\n\n---\n\n\u672c\u9898\u7684 $\\mathrm{idea}$ \u6765\u6e90\u4e8e @sunyx\u3002\n\n---\n\n$\\mathrm{Sol\\ 1}:$\n\n$01$ \u679a\u4e3e\u96c6\u5408 $S$ \u4e2d\u7684\u5143\u7d20\uff0c\u5224\u65ad\u9009\u51fa\u7684\u96c6\u5408\u662f\u5426\u5408\u6cd5\u3002\n\n#### \u5982\u4f55\u5224\u65ad\u96c6\u5408 $S$ \u4e2d\u7684\u70b9\u662f\u5426\u53ef\u4ee5\u7ec4\u6210\u4e00\u68f5\u6811\uff1f\n\n\u5047\u5982\u4e00\u68f5\u6811\u6709 $m$ \u4e2a\u8282\u70b9\uff0c\u8282\u70b9 $1$ \u5230\u8282\u70b9 $m$ \u7684\u5ea6\u6570\u5206\u522b\u4e3a $d_1,d_2,\\dots,d_m(d_i>0)$ \uff0c\u90a3\u4e48\u6709 $\\sum_{i=1}^m d_i=2 \\times m-2$\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\n\n\u56e0\u6b64\uff0c\u5c06\u9009\u51fa\u7684\u6240\u6709\u6570\u7684\u6743\u503c\u52a0\u8d77\u6765\uff0c\u5224\u65ad\u662f\u5426\u7b49\u4e8e $2 \\times m-2$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(2^n \\times n)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7 $\\mathrm{Subtask}$ $1$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$8\\%$\u3002\n\n---\n\n$\\mathrm{Sol\\ 2}:$\n\n\u4e0d\u96be\u60f3\u5230 $\\mathrm{DP}$ \u7b97\u6cd5\uff1a$f_{i,j,k}$ \u8868\u793a **\u5728\u524d $i$ \u4e2a\u6570\u4e2d\uff0c\u9009\u4e86 $j$ \u4e2a\u6570\uff0c\u9009\u51fa\u7684\u6570\u548c\u4e3a $k$ \u7684\u65b9\u6848\u6570\u3002**\n\n\u8f6c\u79fb\u65b9\u7a0b\u4e3a $f_{i,j,k}=f_{i-1,j,k}+f_{i-1,j-1,k-v_i}$\u3002\n\n\u6700\u540e\u7684\u7b54\u6848\u4e3a $\\sum_{i=1}^nf_{n,i,i \\times 2-1}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n^4)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7 $\\mathrm{Subtask}$ $1,2$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$23\\%$\u3002\n\n---\n\n$\\mathrm{Sol\\ 3}:$\n\n$\\mathrm{Sol\\ 2}$ \u4e2d $\\mathrm{DP}$ \u7684\u7b2c\u4e09\u7ef4\u53ea\u7528\u679a\u4e3e\u5230 $2 \\times n-1$\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f18\u5316\u5230 $\\mathcal O(n^3)$.\n\n- \u53ef\u4ee5\u901a\u8fc7 $\\mathrm{Subtask}$ $1,2,3$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$33\\%$\u3002\n\n---\n\n$\\mathrm{Sol\\ 4}:$\n\n\u53d1\u73b0 $\\mathrm{Sol\\ 1}$ \u4e2d\u7684\u5f0f\u5b50\u53ef\u4ee5\u53d8\u5f62\u4e3a $\\sum_{i=1}^nd_i-2=-2$ \u3002\u90a3\u4e48\u8fd9\u9053\u9898\u5c31\u53d8\u4e3a\u4e00\u9053\u80cc\u5305\u7684\u9898\u76ee\u3002\n\n\u5148\u5c06\u6bcf\u4e2a $v_i$ \u90fd\u51cf $2$ \u3002\u8bbe$f_{i,j}$\u4e3a\u5728\u524d $i$ \u4e2a\u6570\u4e2d\uff0c\u9009\u51fa\u7684\u6570\u548c\u4e3a $j$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u65b9\u7a0b\uff1a$f_{i,j}=f_{i-1,j}+f_{i-1,j-v_i}$\uff0c\u7b54\u6848\u4e3a $f_{n,-2}$ \u3002\u7531\u4e8e\u4e0b\u6807\u5b58\u5728\u8d1f\u6570\uff0c\u5bf9\u6bcf\u4e2a\u6570 $+2$ \u5373\u53ef\u3002\n\n\u548c $\\mathrm{Sol\\ 3}$ \u4e00\u6837\u3002\u8be5\u7b97\u6cd5\u4e5f\u53ef\u4ee5\u8fdb\u884c\u4f18\u5316\u3002\u4e0a\u8ff0 $\\mathrm{DP}$ \u72b6\u6001\u5927\u4e8e $n$ \u7684\u72b6\u6001\u90fd\u53ef\u4ee5\u4e0d\u7528\u8003\u8651\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a $\\mathcal O(n^2)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7 $\\mathrm{Subtask}$ $1,2,3,4$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$50\\%$\u3002\n\n---\n\n$\\mathrm{Sol\\ 5}:$\n\n\u5f53 $v_i \\leq 3$ \u7684\u65f6\u5019\uff0c\u8bbe $c_1,c_2,c_3$ \u5206\u522b\u4e3a\u9009\u62e9 $1,2,3$ \u7684\u4e2a\u6570\uff0c$t_1,t_2,t_3$ \u5206\u522b\u4e3a $1,2,3$ \u7684\u603b\u6570\u3002\n\n\u7531\u4e4b\u524d\u63a8\u5bfc\u7684\u516c\u5f0f\u53ef\u4ee5\u77e5\u9053\uff1a$c_1-c_3=2$\uff0c\u800c $c_2$ \u53ef\u4ee5\u4e3a\u4efb\u610f\u503c\u3002\u6240\u4ee5\u53ef\u4ee5\u679a\u4e3e $c_1$ \u4f7f\u5f97 $1 \\leq c_1 \\leq t_1,\\ 1 \\leq c_1-2 \\leq t_3$\uff0c\u7136\u540e\u7528\u7ec4\u5408\u6570\u8ba1\u7b97\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u5373 $C^{c_1}_{t_1}\\times C^{c_1-2}_{t_3}\\times 2^{t_2}$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7 $\\mathrm{Subtask}$ $6$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$8\\%$\u3002\n\n\u7ed3\u5408 $\\mathrm{Sol\\ 4}$\uff0c\u53ef\u4ee5\u83b7\u5f97 $58\\%$ \u7684\u5206\u6570\u3002\n\n---\n\n$\\mathrm{Sol\\ 6}:$\n\n\u4ee5\u4e0a\u89e3\u6cd5\u90fd\u662f\u57fa\u4e8e\u5bf9\u80cc\u5305\u72b6\u6001\u8fdb\u884c\u7684\u4f18\u5316\uff0c\u800c\u8be5\u89e3\u6cd5\u662f\u5bf9\u80cc\u5305\u672c\u8eab\u8fdb\u884c\u7684\u4f18\u5316\u3002\n\n- \u524d\u7f6e\u829d\u58eb\uff1a$\\mathrm{NTT}$\uff0c\u591a\u9879\u5f0f $\\mathrm{ln\\ \\&\\ exp}$ \u8fd0\u7b97\u3002\n\n\u5982\u679c\u4e0d\u4f1a\uff0c\u8bf7\u5148\u79fb\u6b65 $\\mathrm{P3803,P4725,P4726}$\u3002\n\n\u5148\u770b\u4ee5\u4e0b\u4e00\u4e2a\u95ee\u9898\uff1a\n\n#### \u6709 $n$ \u4e2a\u6570 $a_1,a_2,\\dots,a_n$\uff0c\u6c42\u9009\u51fa\u4e00\u4e9b\u6570\uff08\u4e0b\u6807\u4e0d\u91cd\u590d\uff09\u4f7f\u5f97\u5b83\u4eec\u548c\u6070\u4e3a $S$ \u7684\u65b9\u6848\u6570\u6a21 $998244353$\uff0c$n,S$ \u5747\u5c0f\u4e8e $10^5$\u3002\n\n\u6784\u9020\u4e00\u4e2a\u751f\u6210\u51fd\u6570\uff0c\u5f62\u5982 $(1+x^{a_1})(1+x^{a_2})(1+x^{a_3})\\dots(1+x^{a_n})$\uff0c\u5c06\u8fd9\u4e2a\u5f0f\u5b50\u5c55\u5f00\u5e76\u5408\u5e76\u540c\u7c7b\u9879\u540e $x^S$ \u524d\u7684\u7cfb\u6570\u5c31\u662f\u7b54\u6848\u3002\n\n\u800c\u8be5\u5f0f\u5b50\u53ef\u4ee5\u5199\u6210 $exp(ln(1 + x^{a_1})+ln(1+ x^{a_2})+\\dots+ln(1 + x^{a_n}))$\n\n\u53c8 $ln(1+x)$ \u7684\u5c55\u5f00\u5f0f\u4e3a $\\sum_{i}^{\\infty}(-1)^{i-1} \\times \\frac{x^i}{i}$\u3002\n\n\u56e0\u6b64 $ln(1+x^n)$ \u7684\u5c55\u5f00\u5f0f\u4e3a $\\sum_{i}^{\\infty}(-1)^{i-1} \\times \\frac{x^{n\\times i}}{i}$\n\n\u800c\u56e0\u4e3a $S$ \u5c0f\u4e8e $10^5$\uff0c\u6240\u4ee5\u53ea\u7528\u8003\u8651\u591a\u9879\u5f0f $mod\\ x^{100000}$ \u7684\u60c5\u5f62\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$a_i$\uff0c\u5728\u591a\u9879\u5f0f $[1,100000]$ \u4e2d\u6240\u6709 $a_i$ \u7684\u500d\u6570\u7684\u9879\u6570 $x$ \u4e0a\u52a0\u4e0a $(-1)^{\\frac{i}{a_i}-1} \\times \\frac{i}{a_i}^{-1}$\uff0c\u518d\u5bf9\u8fd9\u4e2a\u591a\u9879\u5f0f\u53d6\u4e00\u904d $\\mathrm{exp}$ \u5373\u53ef\u3002\n\n#### \u4e0a\u8ff0\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u8fd9\u9053\u9898\u4e5f\u5c31\u8fce\u5203\u800c\u89e3\u4e86\u3002\n\n\u548c $\\mathrm{Sol\\ 4}$ \u4e00\u6837\uff0c\u6211\u4eec\u5c06\u6bcf\u4e2a $v_i$ \u51cf $2$\u3002\u4f46\u662f $v_i$ \u503c\u51fa\u73b0\u4e86\u8d1f\u6570\u548c\u96f6\uff0c\u65e0\u6cd5\u7b80\u5355\u5730\u6309\u7167\u4e0a\u8ff0\u601d\u8def\u6267\u884c\u3002\n\n\u4e0d\u8fc7\u53ea\u53ef\u80fd\u51fa\u73b0\u4e00\u79cd\u8d1f\u6570 $-1$\uff0c\u5e76\u4e14 $0$ \u7684\u4e2a\u6570\u53ef\u4ee5\u4e3a\u4efb\u610f\u503c\uff0c\u90a3\u4e48\u5047\u8bbe $-1$ \u7684\u603b\u4e2a\u6570\u4e3a $t_1$\uff0c$0$ \u7684\u603b\u4e2a\u6570\u4e3a $t_2$\uff0c\u5c06\u503c\u5927\u4e8e $0$ \u7684\u90e8\u5206\u6309\u7167\u4e0a\u8ff0\u601d\u8def\u6c42\u51fa\u6700\u540e\u7684\u591a\u9879\u5f0f\u3002\u7136\u540e\u679a\u4e3e $-1$ \u7684\u4e2a\u6570\uff0c\u8bbe\u4e3a $x$\uff0c\u7528\u4e58\u6cd5\u539f\u7406\u8ba1\u7b97\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff1a$C^{x}_{t_1}\\times 2^{t_2} \\times$ \u591a\u9879\u5f0f $x-2$ \u6b21\u9879\u524d\u7684\u7cfb\u6570\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n\\times \\log n)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7\u6240\u6709\u6d4b\u8bd5\u70b9\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$100\\%$\u3002\n\n---\n\n$\\mathrm{std:}$\n\n\u56e0\u4e3a\u51fa\u9898\u4eba\u592a\u83dc\uff0c\u8fd8\u4e0d\u4f1a\u5199\u591a\u9879\u5f0f $\\mathrm{EXP}$\uff0c\u6240\u4ee5\u4ee3\u7801\u4e2d\u7684 $\\mathrm{EXP}$ \u6765\u81ea\u4e8e @yybyyb \u5728 $\\mathrm{P4389}$ \u4e2d\u7684\u9898\u89e3\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int MOD=998244353;\ninline int read(){\n\tint x=0,neg=1;char c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-')\tneg=-1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c))\tx=x*10+c-'0',c=getchar();\n\treturn x*neg;\n}\ninline void print(int x){\n\tif(x<0){\n\t\tputchar('-');\n\t\tprint(abs(x));\n\t\treturn;\n\t}\n\tif(x<=9)\tputchar(x+'0');\n\telse{\n\t\tprint(x/10);\n\t\tputchar(x%10+'0');\n\t}\n}\nint fpow(int base,int e){\n    int ans=1;\n    while(e){\n\t\tif(e&1)\tans=ans*base%MOD;\n\t\tbase=base*base%MOD;\n\t\te>>=1;\n\t}\n    return ans;\n}\nint n,cnt1=0,cnt2=0;\nint F[1500005],FF[1500005];\nint exgcd(int a,int b,int &x,int &y){\n\tif(b==0){\n\t\tx=1;y=0;\n\t\treturn a;\n\t}\n\tint t=exgcd(b,a%b,x,y);\n\tint temp=x;\n\tx=y;\n\ty=temp-(a/b)*y;\n\treturn t;\n}\nint _inv(int a,int b){\n\tint x,y;\n\texgcd(a,b,x,y);\n\treturn x;\n}\ninline void init(){\n\tF[0]=1;\n\tfor(int i=1;i<=500000;i++)\tF[i]=F[i-1]*i%MOD;\n\tFF[500000]=1ll*(_inv(F[500000],MOD)+MOD*MOD)%MOD;\n\tfor(int i=499999;i>=0;i--)\tFF[i]=FF[i+1]*(i+1)%MOD;\n}\ninline int func_C(int a,int b){\n\treturn 1ll*F[a]*FF[b]%MOD*FF[a-b]%MOD;\n}\nint r[1500005],N,l,M;\nint Og[1500005];\nvoid NTT(int *P,int opt,int n){\n    for(N=1,l=0;N<n;N<<=1)\t++l;\n    for(register int i=0;i<N;++i)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n    for(register int i=0;i<N;++i)\n\t\tif(i<r[i])swap(P[i],P[r[i]]);\n    for(register int i=1;i<N;i<<=1){\n        register int W=fpow(3,(MOD-1)/(i<<1));Og[0]=1;\n        for(register int j=1;j<i;++j)Og[j]=1ll*Og[j-1]*W%MOD;\n        for(register int p=i<<1,j=0;j<N;j+=p)\n            for(register int k=0;k<i;++k){\n                register int X=P[j+k],Y=1ll*Og[k]*P[i+j+k]%MOD;\n                P[j+k]=(X+Y)%MOD;P[i+j+k]=(X+MOD-Y)%MOD;\n            }\n    }\n    if(opt==-1){\n        reverse(&P[1],&P[N]);\n        for(register int i=0,inv=fpow(N,MOD-2);i<N;++i)\n\t\t\tP[i]=1ll*P[i]*inv%MOD;\n    }\n}\nint inv[1500005];\nvoid initinv(int N){\n    inv[0]=inv[1]=1;\n    for(register int i=2;i<N;++i)\n\t\tinv[i]=1ll*inv[MOD%i]*(MOD-MOD/i)%MOD;\n}\nint A[1500005],B[1500005];\nvoid Inv(int *a,int *b,int len){\n    if(len==1){\n\t\tb[0]=fpow(a[0],MOD-2);\n\t\treturn;\n\t}\n    Inv(a,b,len>>1);\n    for(register int i=0;i<len;++i)\n\t\tA[i]=a[i],B[i]=b[i];\n    NTT(A,1,len<<1);\n\tNTT(B,1,len<<1);\n    for(register int i=0;i<(len<<1);++i)\n\t\tA[i]=1ll*A[i]*B[i]%MOD*B[i]%MOD;\n    NTT(A,-1,len<<1);\n    for(register int i=0;i<len;++i)\n\t\tb[i]=(b[i]+b[i])%MOD;\n    for(register int i=0;i<len;++i)\n\t\tb[i]=(b[i]+MOD-A[i])%MOD;\n    for(register int i=0;i<(len<<1);++i)\n\t\tA[i]=B[i]=0;\n}\nint C[1500005],D[1500005];\nvoid Dao(int *a,int *b,int len){\n    for(register int i=1;i<len;++i)\n\t\tb[i-1]=1ll*i*a[i]%MOD;\n    b[len]=b[len-1]=0;\n}\nvoid Jifen(int *a,int *b,int len){\n    for(register int i=1;i<len;++i)\n\t\tb[i]=1ll*a[i-1]*inv[i]%MOD;\n    b[0]=0;\n}\nvoid Getln(int *a,int *b,int len){\n    int A[1500005],B[1500005];\n    memset(A,0,sizeof(A));memset(B,0,sizeof(B));\n    Dao(a,A,len);\n    Inv(a,B,len);\n    NTT(A,1,len<<1);NTT(B,1,len<<1);\n    for(register int i=0;i<(len<<1);++i)\n\t\tA[i]=1ll*A[i]*B[i]%MOD;\n    NTT(A,-1,len<<1);\n    Jifen(A,b,len);\n    for(register int i=0;i<(len<<1);++i)\n\t\tA[i]=B[i]=0;\n}\nint E[1500005];\nvoid Exp(int *a,int *b,int len){\n    if(len==1){\n\t\tb[0]=1;\n\t\treturn;\n\t}\n    Exp(a,b,len>>1);\n    for(register int i=0;i<len;++i)\n\t\tD[i]=b[i];\n    Getln(b,E,len);\n    for(register int i=0;i<len;++i)\n\t\tE[i]=(MOD-E[i]+a[i])%MOD;E[0]=(E[0]+1)%MOD;\n    NTT(E,1,len<<1);\n\tNTT(D,1,len<<1);\n    for(register int i=0;i<(len<<1);++i)\n\t\tD[i]=1ll*D[i]*E[i]%MOD;\n    NTT(D,-1,len<<1);\n    for(register int i=0;i<len;++i)\n\t\tb[i]=D[i];\n    for(register int i=0;i<(len<<1);++i)\n\t\tD[i]=E[i]=0;\n}\nvoid FastPow(int *a,int *b,int K,int len){\n    memset(E,0,sizeof(E));\n    Getln(a,E,len);\n    for(register int i=0;i<len;++i)\n\t\tE[i]=1ll*K*E[i]%MOD;\n    Exp(E,b,len);\n}\nint X[1500005],Y[1500005],TT[1500005],a[1500005],cnt[1500005];\nsigned main(){\n\tinit();\n    n=read();\n    int N;for(N=1;N<=n;N<<=1);\n\tinitinv(N);\n    for(int i=1;i<=n;i++){\n\t\ta[i]=read();\n\t\tif(a[i]>n)\tcontinue;\n\t\tif(a[i]==1)\t\t\tcnt1++;\n\t\telse if(a[i]==2)\tcnt2++;\n\t\telse{\n\t\t\tcnt[a[i]-2]++;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tif(cnt[i]>0){\n\t\t\tfor(int j=i;j<=n;j+=i){\n\t\t\t\tif((j/i)%2==1)\n\t\t\t\t\tX[j]=(X[j]+inv[j/i]*cnt[i]%MOD)%MOD;\n\t\t\t\telse\n\t\t\t\t\tX[j]=(X[j]-inv[j/i]*cnt[i]%MOD+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n    Exp(X,Y,N);\n\tint ans=0;\n\tfor(int i=2;i<=cnt1;i++){\n    \tans=(ans+1ll*func_C(cnt1,i)%MOD*fpow(2,cnt2)%MOD*Y[i-2]%MOD)%MOD;\n\t}\n\tprint(ans);\n    return 0;\n}\n```",
        "postTime": 1576295272,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "\u300cSWTR-03\u300dT6 Counting Trees"
    },
    {
        "content": "## \u9898\u610f\n$n$\u4e2a\u70b9\uff0c\u6bcf\u4e2a\u70b9\u5ea6\u6570\u7ed9\u5b9a\u3002\n\n\u9009\u51fa\u82e5\u5e72\u4e2a\u70b9\u80fd\u7ec4\u6210\u6811\u7684\u65b9\u6848\u6570\u3002\n## \u9898\u89e3\n\u5bf9\u4e8e\u4e00\u68f5\u6811\uff0c\u6709$n$\u4e2a\u70b9\uff0c\u6709$n-1$\u6761\u8fb9\uff0c$\\sum_{i=1}^ndeg_i=2(n-1)$,\u5373$\\sum_{i=1}^ndeg_i-2=-2$\u3002\u6240\u4ee5$\\sum^n_{i=1} v_i-2=-2$\u662f\u4e00\u4e2a\u5fc5\u8981\u6761\u4ef6\u3002\uff08\u5145\u5206\u6761\u4ef6\u7559\u7ed9\u8bfb\u8005\u81ea\u8bc1\uff09\n\n\u770b\u505a\u751f\u6210\u51fd\u6570\uff0c\u5bf9\u4e8e$v_i$\uff0c\u5176\u751f\u6210\u51fd\u6570\u5c31\u662f$1+x^{v_i-2}$\u5373\u9009\u6216\u4e0d\u9009\u3002\n\n$$F(x)=\\prod_{i=1}^n(1-x^{v_i-2}),ans=[x^{-2}]F(x)$$\n\u53ef\u8fd9\u4e2a\u8d1f\u6570\u6b21\u5f88\u8ba8\u538c\uff0c\u6211\u4eec\u65e0\u6cd5\u6109\u5feb\u5730\u8ba1\u7b97\uff0c\u56e0\u6b64\u9700\u8981\u4e71\u641e\u3002\n$$\nF(x)=\\overbrace{\\prod_{v_i=1}(1+x^{-1})}^{m\\text{\u4e2a}}\n\\overbrace{\\prod_{v_i=2}(1+1)}^{k\\text{\u4e2a}}\n\\overbrace{\\prod_{v_i>2}(1+x^{v_i-2})}^{n-m-k\\text{\u4e2a}}\n$$\n\u90a3\u4e48\u7ed9\u6240\u6709$1+x^{-1}$\u4e58\u4e0a$x$\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e$1+x$\uff0c\u8bb0$a=\\{|v_i-2|,v_i=1|v_i>2\\}$\n\n$$\n\\begin{aligned}\nx^mF(x)\n&=2^k\\prod_{i}(1+x^{a_i})\\\\\n&=2^k\\exp(\\sum_{i}\\ln(1+x^a_i))\\\\\n&=2^k\\exp(\\sum_{i}\\int(\\ln(1+x^{a_i}))^\\prime dx)\\\\\n&=2^k\\exp(\\sum_{i}\\int\\frac{a_ix^{a_i-1}}{1+x^{a_i}}dx)\\\\\n&=2^k\\exp(\\sum_{i}a_ix^{a_i-1}\\int\\sum_{j=0}^\\infty (-x^{a_i})^jdx)\\\\\n&=2^k\\exp(\\sum_{i}a_ix^{a_i-1}\\int\\sum_{j=0}^\\infty (-1)^jx^{a_ij}dx)\\\\\n&=2^k\\exp(\\sum_{i}\\int\\sum_{j=0}^\\infty (-1)^ja_ix^{a_i(j+1)-1}dx)\\\\\n&=2^k\\exp(\\sum_{i}\\sum_{j=0}^\\infty (-1)^j\\int a_ix^{a_i(j+1)-1}dx)\\\\\n&=2^k\\exp(\\sum_{i}\\sum_{j=0}^\\infty (-1)^j\\frac{a_ix^{a_i(j+1)}}{a_i(j+1)}dx)\\\\\n&=2^k\\exp(\\sum_{i}\\sum_{j=1}^\\infty (-1)^{j-1}\\frac{x^{a_ij}}{j}dx)\\\\\n\n\\end{aligned}\n$$\n\u5c31\u662f\u4e00\u4e2a\u5c0f\u5957\u8def\u3002\n\n\u6700\u540e$ans=[x^{m-2}]x^mF(x)$\u5c31\u884c\u4e86\u3002\n## \u4ee3\u7801\n\u6700\u540e\u9001\u4e0a\u840c\u65b0\u6162\u7684\u8981\u6b7b\u7684\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n//#define faster\nnamespace in{\n\t#ifdef faster\n\tchar buf[1<<21],*p1=buf,*p2=buf;\n\tinline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n\t#else\n\tinline int getc(){return getchar();}\n\t#endif\n\ttemplate <typename T>inline void read(T& t){\n\t\tt=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n\t    while(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n\t}\n\ttemplate <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n}\nnamespace out{\n\tchar buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n\tinline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n\tinline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n\ttemplate <typename T>void write(T x) {\n\t\tstatic char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n\t\twhile (len>=0)putc(buf[len]),--len;\n\t}\n}\nusing namespace std;\ntemplate<const int mod>\nstruct modint{\n    int x;\n    modint<mod>(int o=0){x=o;}\n    modint<mod> &operator = (int o){return x=o,*this;}\n    modint<mod> &operator +=(modint<mod> o){return x=x+o.x>=mod?x+o.x-mod:x+o.x,*this;}\n    modint<mod> &operator -=(modint<mod> o){return x=x-o.x<0?x-o.x+mod:x-o.x,*this;}\n    modint<mod> &operator *=(modint<mod> o){return x=1ll*x*o.x%mod,*this;}\n    modint<mod> &operator ^=(int b){\n        modint<mod> a=*this,c=1;\n        for(;b;b>>=1,a*=a)if(b&1)c*=a;\n        return x=c.x,*this;\n    }\n    modint<mod> &operator /=(modint<mod> o){return *this *=o^=mod-2;}\n    modint<mod> &operator +=(int o){return x=x+o>=mod?x+o-mod:x+o,*this;}\n    modint<mod> &operator -=(int o){return x=x-o<0?x-o+mod:x-o,*this;}\n    modint<mod> &operator *=(int o){return x=1ll*x*o%mod,*this;}\n    modint<mod> &operator /=(int o){return *this *= ((modint<mod>(o))^=mod-2);}\n\ttemplate<class I>friend modint<mod> operator +(modint<mod> a,I b){return a+=b;}\n    template<class I>friend modint<mod> operator -(modint<mod> a,I b){return a-=b;}\n    template<class I>friend modint<mod> operator *(modint<mod> a,I b){return a*=b;}\n    template<class I>friend modint<mod> operator /(modint<mod> a,I b){return a/=b;}\n    friend modint<mod> operator ^(modint<mod> a,int b){return a^=b;}\n    friend bool operator ==(modint<mod> a,int b){return a.x==b;}\n    friend bool operator !=(modint<mod> a,int b){return a.x!=b;}\n    bool operator ! () {return !x;}\n    modint<mod> operator - () {return x?mod-x:0;}\n\tmodint<mod> &operator++(int){return *this+=1;}\n};\nconst int N=4e6+5;\nconst int mod=998244353;\nconst modint<mod> GG=3,Ginv=modint<mod>(1)/3,I=86583718;\nstruct poly{\n\tvector<modint<mod>>a;\n\tmodint<mod>&operator[](int i){return a[i];}\n\tint size(){return a.size();}\n\tvoid resize(int n){a.resize(n);}\n\tvoid reverse(){std::reverse(a.begin(),a.end());}\n};\nint rev[N];\ninline int ext(int n){int k=0;while((1<<k)<n)k++;return k;}\ninline void init(int k){int n=1<<k;for(int i=0;i<n;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(k-1));}\ninline void ntt(poly&a,int k,int typ){\n\tint n=1<<k;\n\tfor(int i=0;i<n;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\tfor(int mid=1;mid<n;mid<<=1){\n\t\tmodint<mod> wn=(typ>0?GG:Ginv)^((mod-1)/(mid<<1));\n\t\tfor(int r=mid<<1,j=0;j<n;j+=r){\n\t\t\tmodint<mod> w=1;\n\t\t\tfor(int k=0;k<mid;k++,w=w*wn){\n\t\t\t\tmodint<mod> x=a[j+k],y=w*a[j+k+mid];\n\t\t\t\ta[j+k]=x+y,a[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ<0){\n\t\tmodint<mod> inv=modint<mod>(1)/n;\n\t\tfor(int i=0;i<n-1;i++)a[i]*=inv;\n\t}\n}\ninline poly one(){poly a;a.a.push_back(1);return a;}\npoly operator +(poly a,poly b){\n\tint n=max(a.size(),b.size());a.resize(n),b.resize(n);\n\tfor(int i=0;i<n;i++)a[i]+=b[i];return a;\n}\npoly operator -(poly a,poly b){\n\tint n=max(a.size(),b.size());a.resize(n),b.resize(n);\n\tfor(int i=0;i<n;i++)a[i]-=b[i];return a;\n}\ninline poly operator*(poly a,poly b){\n\tint n=a.size()+b.size()-1,k=ext(n);\n\ta.resize(1<<k),b.resize(1<<k),init(k);\n\tntt(a,k,1);ntt(b,k,1);for(int i=0;i<(1<<k);i++)a[i]*=b[i];\n\tntt(a,k,-1),a.resize(n);return a;\n}\ninline poly operator*(poly a,modint<mod> b){for(int i=0;i<a.size();i++)a[i]*=b;return a; }\ninline poly operator/(poly a,modint<mod> b){for(int i=0;i<a.size();i++)a[i]/=b;return a; }\ninline poly operator-(poly a){for(int i=0;i<a.size();i++)a[i]=-a[i];return a; }\npoly inv(poly F,int k){\n\tint n=1<<k;F.resize(n);\n\tif(n==1){F[0]=modint<mod>(1)/F[0];return F;}\n\tpoly G,H=inv(F,k-1);\n\tG.resize(n),H.resize(n<<1),F.resize(n<<1);\n\tfor(int i=0;i<n/2;i++)G[i]=H[i]*2;\n\tinit(k+1),ntt(H,k+1,1),ntt(F,k+1,1);\n\tfor(int i=0;i<(n<<1);i++)H[i]=H[i]*H[i]*F[i];\n\tntt(H,k+1,-1),H.resize(n);\n\tfor(int i=0;i<n;i++)G[i]-=H[i];return G;\n}\ninline poly inv(poly a){\n\tint n=a.size();\n\ta=inv(a,ext(n)),a.resize(n);return a;;\n}\ninline poly deriv(poly a){//\u6c42\u5bfc \n\tint n=a.size()-1;\n\tfor(int i=0;i<n;i++)a[i]=a[i+1]*(i+1);\n\ta.resize(n);return a;\n}\ninline poly inter(poly a){//\u6c42\u539f \n\tint n=a.size()+1;a.resize(n);\n\tfor(int i=n;i>=1;i--)a[i]=a[i-1]/i;\n\ta[0]=0;return a;\n}\ninline poly ln(poly a){\n\tint n=a.size();\n\ta=inter(deriv(a)*inv(a));\n\ta.resize(n);return a;\n}\npoly exp(poly a,int k){\n\tint n=1<<k;a.resize(n);\n\tif(n==1)return one();\n\tpoly f0=exp(a,k-1);f0.resize(n);\n\treturn f0*(one()+a-ln(f0)); \n}\npoly exp(poly a){\n\tint n=a.size();\n\ta=exp(a,ext(n));a.resize(n);return a;\n}\nint n,m,k,v[N],cnt[N];\npoly F;\nsigned main(){\n\tin::read(n);for(int i=1;i<=n;i++)\n\t\tin::read(v[i]),(v[i]==2?k:cnt[abs(v[i]-2)])++,v[i]==1&&(m++);\n\tF.resize(m);\n\tfor(int i=1;i<m;i++)\n\t\tfor(int j=1;i*j<m;j++)\n\t\t\tF[i*j]+=((j&1)?modint<mod>(cnt[i]):-modint<mod>(cnt[i]))/j;\n\tF=exp(F);out::write((F[m-2]*(modint<mod>(2)^k)).x);\n\tout::flush();\n\treturn 0;\n}\n```",
        "postTime": 1610368085,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5860 \u3010\u300cSWTR-03\u300dCounting Trees\u3011"
    },
    {
        "content": "\u4e00\u4e9b\u70b9\u53ef\u4ee5\u7ec4\u6210\u4e00\u68f5\u6811\u5f53\u4e14\u4ec5\u5f53\u8fd9\u4e9b\u70b9\u7684\u5ea6\u6570\u548c $=2n-2$\n\n\u6211\u4eec\u5c06\u6240\u6709\u70b9\u7684\u5ea6\u6570 $-2$\uff0c\u5219\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u548c\u4e3a $-2$ \u7684\u96c6\u5408\u6570\n\n\u5373\u6c42\uff1a$[x^{-2}]\\prod\\limits_{i=1}^n(1+x^{v_i-2})$\n\n\u5982\u679c\u90fd\u662f\u6b63\u6574\u6570\u6b21\u5e42\uff0c\u5f88\u597d\u89e3\u51b3\uff1a\n\n$\\prod\\limits_{i=1}^n(1+x^{a_i})=Exp(\\sum\\limits_{i=1}^nLn(1+x^{a_i}))$\n\n\u7531\u4e8e $Ln(1+x^{a_i})=\\sum\\limits_{j=0}^{\\inf}(-1)^{j-1}\\dfrac{x^{a_ij}}{j}$\uff0c\u800c\u6211\u4eec\u53ea\u5173\u5fc3\u4e0d\u5927\u4e8e $n$ \u6b21\u7684\u9879\uff0c\u6240\u4ee5\u5f88\u5bb9\u6613\u8ba1\u7b97\n\n\u8bbe\u591a\u9879\u5f0f $G=\\prod\\limits_{i=1,v_i>2}^n(1+x^{v_i-2})$\n\n\u95ee\u9898\u5c31\u51fa\u5728\u6709\u975e\u6b63\u6574\u6570\u5e42\uff0c\u5bf9\u4e8e $v_i=0$ \u7684\u9879\uff0c\u663e\u7136\u9009\u4e0d\u9009\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5728\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u4e58\u4e0a $2^{cnt_0}$ \u5373\u53ef\n\n\u5bf9\u4e8e $v_i=-1$ \u7684\u9879\uff0c\u6211\u4eec\u679a\u4e3e\u9009\u4e86 $i$ \u4e2a\uff0c\u5219 $ans+=\\dbinom{cnt_{-1}}{i}G_{i-2}$\n\n```cpp\nconst int mod = 998244353;\nvoid up(int &a) { a += a >> 31 & mod; }\nint qpow(int a,int b) { int ans = 1;for(;b;a = (ll)a * a % mod,b >>= 1) if(b & 1) ans = (ll)ans * a % mod; return ans; }\nconst int N = 2000010,G = 3,Gi = 332748118;\nint rev[N];\nvoid NTT(int *a,int n,int type)\n{\n\tfor(int i = 0;i < n;i++) if(i < rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int l = 2;l <= n;l <<= 1)\n\t{\n\t\tint m = l / 2;ll wn = qpow(~type ? G : Gi,(mod - 1) / l);\n\t\tfor(int *p = a;p != a + n;p += l)\n\t\t\tfor(int i = 0,w = 1;i < m;i++,w = (ll)w * wn % mod)\n\t\t\t{\n\t\t\t\tint t = (ll)w * p[i + m] % mod;\n\t\t\t\tup(p[i + m] = p[i] - t);\n\t\t\t\tup(p[i] = p[i] + t - mod);\n\t\t\t}\n\t}if(~type) return;\n\tint inv = qpow(n,mod - 2);\n\tfor(int i = 0;i < n;i++) a[i] = (ll)a[i] * inv % mod;\n}\nvoid calc_rev(int &n,int &lim,int m)\n{\n\tn = 1,lim = 0;while(n < m) n <<= 1,lim++;\n\tfor(int i = 1;i < n;i++) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << lim - 1);\n}\nvoid Mul(int *a,int *b,int *c,int m1,int m2)\n{\n\tstatic int x[N],y[N];\n\tint n,lim;calc_rev(n,lim,m1 + m2);\n\tfor(int i = 0;i < m1;i++) x[i] = a[i];for(int i = m1;i < n;i++) x[i] = 0;\n\tfor(int i = 0;i < m2;i++) y[i] = b[i];for(int i = m2;i < n;i++) y[i] = 0;\n\tNTT(x,n,1),NTT(y,n,1);for(int i = 0;i < n;i++) c[i] = (ll)x[i] * y[i] % mod;\n\tNTT(c,n,-1);for(int i = m1 + m2 - 1;i < n;i++) c[i] = 0;\n}\nvoid Inv(int *a,int *b,int len)\n{\n\tstatic int c[N];\n\tif(len == 1) { b[0] = qpow(a[0],mod - 2);return; }\n\tInv(a,b,len + 1 >> 1);\n\tint n,lim;calc_rev(n,lim,len << 1);\n\tfor(int i = 0;i < len;i++) c[i] = a[i];for(int i = len;i < n;i++) c[i] = 0;\n\tNTT(c,n,1),NTT(b,n,1);\n\tfor(int i = 0;i < n;i++) b[i] = (ll)(2 - (ll)c[i] * b[i] % mod + mod) * b[i] % mod;\n\tNTT(b,n,-1);for(int i = len;i < n;i++) b[i] = 0;\n}\nvoid Der(int *a,int *b,int len) { for(int i = 1;i < len;i++) b[i - 1] = (ll)a[i] * i % mod;b[len - 1] = 0; }\nvoid Inte(int *a,int *b,int len) { for(int i = len - 1;i;i--) b[i] = (ll)a[i - 1] * qpow(i,mod - 2) % mod;b[0] = 0; }\nvoid Ln(int *a,int *b,int len)\n{\n\tstatic int c[N],inv[N];\n\tmemset(inv,0,sizeof(inv));\n\tDer(a,c,len),Inv(a,inv,len);\n\tMul(c,inv,c,len,len);\n\tInte(c,b,len);\n}\nvoid Exp(int *a,int *b,int len)\n{\n\tstatic int c[N];\n\tif(len == 1) { b[0] = 1;return; }\n\tExp(a,b,len + 1 >> 1);\n\tint n,lim;calc_rev(n,lim,len << 1);\n\tLn(b,c,len);\n\tfor(int i = 0;i < n;i++) up(c[i] = a[i] - c[i]);\n\tc[0]++;for(int i = len;i < n;i++) c[i] = b[i] = 0;\n\tMul(b,c,b,len,len);for(int i = len;i < n;i++) b[i] = 0;\n}\nint n,m,cnt[N];\nint fac[N],ifac[N],inv[N];\nint C(int n,int m) { return (ll)fac[n] * ifac[m] % mod * ifac[n - m] % mod; }\nvoid init()\n{\n\tfac[0] = 1;for(int i = 1;i <= n;i++) fac[i] = (ll)fac[i - 1] * i % mod;\n\tifac[n] = qpow(fac[n],mod - 2);for(int i = n;i;i--) ifac[i - 1] = (ll)ifac[i] * i % mod;\n\tfor(int i = 1;i <= n;i++) inv[i] = (ll)ifac[i] * fac[i - 1] % mod;\n}\nint f[N],g[N],ans;\nint main()\n{\n\tn = read();init();\n\tfor(int i = 1,x;i <= n;i++) if((x = read() - 2) == -1) m++; else cnt[x]++;\n\tfor(int i = 1;i <= n;i++) if(cnt[i])\n\t\tfor(int j = i,k = 1;j <= n;j += i,k++)\n\t\t\tif(k & 1) up(f[j] += (ll)inv[k] * cnt[i] % mod - mod);\n\t\t\telse up(f[j] -= (ll)inv[k] * cnt[i] % mod);\n\tExp(f,g,n + 1);int res = qpow(2,cnt[0]);\n\tfor(int i = 2;i <= m;i++) up(ans += (ll)C(m,i) * res % mod * g[i - 2] % mod - mod);\n\tfprint(ans);\n}\n```",
        "postTime": 1594042528,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5860 \u3010\u300cSWTR-03\u300dCounting Trees\u3011"
    }
]