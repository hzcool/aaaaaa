[
    {
        "content": "## [\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\u70b9\u8fd9\u91cc](http://www.cnblogs.com/zwfymqz/p/8581995.html)\n\n## ST\u8868\n\nST\u8868\u7684\u529f\u80fd\u5f88\u7b80\u5355\n\n\u5b83\u662f\u89e3\u51b3RMQ\u95ee\u9898(\u533a\u95f4\u6700\u503c\u95ee\u9898)\u7684\u4e00\u79cd\u5f3a\u6709\u529b\u7684\u5de5\u5177\n\n\u5b83\u53ef\u4ee5\u505a\u5230$O(nlogn)$\u9884\u5904\u7406\uff0c$O(1)$\u67e5\u8be2\u6700\u503c\n\n## \u7b97\u6cd5\n\nST\u8868\u662f\u5229\u7528\u7684\u662f\u500d\u589e\u7684\u601d\u60f3\n\n\u62ff\u6700\u5927\u503c\u6765\u8bf4\n\n\u6211\u4eec\u7528$Max[i][j]$\u8868\u793a\uff0c\u4ece$i$\u4f4d\u7f6e\u5f00\u59cb\u7684$2^j$\u4e2a\u6570\u4e2d\u7684\u6700\u5927\u503c\uff0c\u4f8b\u5982$Max[i][1]$\u8868\u793a\u7684\u662f$i$\u4f4d\u7f6e\u548c$i+1$\u4f4d\u7f6e\u4e2d\u4e24\u4e2a\u6570\u7684\u6700\u5927\u503c\n\n\u90a3\u4e48\u8f6c\u79fb\u7684\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u628a\u5f53\u524d\u533a\u95f4\u62c6\u6210\u4e24\u4e2a\u533a\u95f4\u5e76\u5206\u522b\u53d6\u6700\u5927\u503c\uff08\u6ce8\u610f\u8fd9\u91cc\u7684\u7f16\u53f7\u662f\u4ece$1$\u5f00\u59cb\u7684\uff09\n\n![](https://ws1.sinaimg.cn/large/005S5cb6ly1fxsalbkxbrj30kd07p0so.jpg)\n\n\u67e5\u8be2\u7684\u65f6\u5019\u4e5f\u6bd4\u8f83\u7b80\u5355\n\n\u6211\u4eec\u8ba1\u7b97\u51fa$log_2{\\text{\u533a\u95f4\u957f\u5ea6}}$\n\n\u7136\u540e\u5bf9\u4e8e\u5de6\u7aef\u70b9\u548c\u53f3\u7aef\u70b9\u5206\u522b\u8fdb\u884c\u67e5\u8be2\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u5b9a\u53ef\u4ee5\u8986\u76d6\u67e5\u8be2\u7684\u533a\u95f4\n\n![](https://ws1.sinaimg.cn/large/005S5cb6ly1fxsalcxncdj30nd0620so.jpg)\n\n\u521a\u5f00\u59cb\u5b66\u7684\u65f6\u5019\u6211\u4e0d\u592a\u7406\u89e3\u4e3a\u4ec0\u4e48\u4ece\u53f3\u7aef\u70b9\u5f00\u59cb\u67e5\u7684\u65f6\u5019\u5de6\u7aef\u70b9\u662f$r-2^k+1$\n\n\u5b9e\u9645\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u4e2a\u70b9$x$\uff0c\u4f7f\u5f97$x+2^k-1=r$\n\n\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u5f97\u5230$x=r-2^k+1$\n\n\u4e0a\u9762\u8bb2\u7684\u53ef\u80fd\u6bd4\u8f83\u62bd\u8c61\uff0c\u5efa\u8bae\u5927\u5bb6\u753b\u4e2a\u56fe\u597d\u597d\u7406\u89e3\u4e00\u4e0b\n\n## \u4ee3\u7801\n\n\u6709\u4e86\u4e0a\u9762\u7684\u77e5\u8bc6\uff0c\u4ee3\u7801\u5c31\u6bd4\u8f83\u597d\u7406\u89e3\u4e86\n\n \n```cpp\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\nusing namespace std;\nconst int MAXN=1e6+10;\ninline int read()\n{\n    char c=getchar();int x=0,f=1;\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n    while(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n    return x*f;\n}\nint Max[MAXN][21];\nint Query(int l,int r)\n{\n    int k=log2(r-l+1); \n    return max(Max[l][k],Max[r-(1<<k)+1][k]);//\u628a\u62c6\u51fa\u6765\u7684\u533a\u95f4\u5206\u522b\u53d6\u6700\u503c \n}\nint main()\n{\n    #ifdef WIN32\n    freopen(\"a.in\",\"r\",stdin);\n    #endif\n    int N=read(),M=read();\n    for(int i=1;i<=N;i++) Max[i][0]=read();\n    for(int j=1;j<=21;j++)\n        for(int i=1;i+(1<<j)-1<=N;i++)//\u6ce8\u610f\u8fd9\u91cc\u8981\u63a7\u5236\u8fb9\u754c \n            Max[i][j]=max(Max[i][j-1],Max[i+(1<<(j-1))][j-1]);//\u5982\u679c\u770b\u4e0d\u61c2\u8fb9\u754c\u7684\u8bdd\u5efa\u8bae\u597d\u597d\u770b\u770b\u56fe \n    for(int i=1;i<=M;i++)\n    {\n        int l=read(),r=read();\n        printf(\"%d\\n\",Query(l,r));\n    }\n    return 0;\n}\n```",
        "postTime": 1521251942,
        "uid": 36984,
        "name": "attack",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "### \u7ffb\u4e86\u5f88\u591a\u9898\u89e3\u6ca1\u627e\u5230\u4e00\u7bc7\u8be6\u7ec6\u56fe\u89e3\uff0c\u4e8e\u662f\u5c31\u6709\u4e86\u8fd9\u7bc7\u3002\n$ST$\u8868\u8fd8\u662f\u5f88\u9700\u8981\u4e00\u7bc7\u5e26\u56fe\u89e3\u7684\u9898\u89e3\u5427\uff0c\n\u5b9a\u4e49\u5565\u7684\u5176\u4ed6\u9898\u89e3\u90fd\u6709\uff0c\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u6211\u4eec\u76f4\u63a5\u7ed3\u5408\u56fe\u4f8b\u6765\u7406\u89e3\u4ee3\u7801\u3002\n\n- ## \u9884\u5904\u7406\u9636\u6bb5\u3002\n\n1. \u9996\u5148\u4f60\u5e94\u8be5\u77e5\u9053\u7684\u662f\uff0cST\u8868\u662f\u5229\u7528\u500d\u589e\u601d\u60f3\u6765\u7f29\u77ed\u65f6\u95f4\u7684\u3002\u800c\u500d\u589e\u5c31\u4f53\u73b0\u5728\u4ed6\u6570\u7ec4\u7684\u5b9a\u4e49\u4e2d\uff1a\u5bf9\u4e8e$f[i][j]$\uff0c\u6307\u7684\u662f\u5728\u5e8f\u5217\u7684\u7b2ci\u9879\uff0c**\u5411\u540e$2^j$\u4e2a\u5143\u7d20\u6240\u5305\u542b\u5e8f\u5217\u95f4\u7684\u6700\u5927\u503c**\u3002\n\n\u5bf9\u4e8e$i=1$\uff0c\u6211\u4eec\u53ef\u4ee5\u753b\u51fa\u8fd9\u4e48\u4e00\u4e2a\u56fe\uff0c\u5176\u4e0b\u6807\u5373\u4e3a$j$\uff1a\n![](https://cdn.luogu.com.cn/upload/image_hosting/digxpwj5.png)\n\n\u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d$i$\u8f6c\u79fb\u5176\u5b9e\u5f88\u660e\u663e\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8003\u8651\u5c06\u4e24\u4e2a\u5c0f\u533a\u95f4\u7684\u7b54\u6848\u5408\u5e76\uff0c\u5373\u4e3a\u8fd9\u4e2a\u5927\u533a\u95f4\u7684\u503c\uff1b\u5982\u56fe\u4e2d$f[1][2]$\u5373\u53ef\u7531$max(f[1][1],f[3][1])$\u8f6c\u79fb\u6765\u3002\n\n$$f[i][j]=max(f[i][j-1],f[i+2^{j-1}][j-1])$$\n\n**\u5176\u4e2d$2^{j-1}$\u4e5f\u53ef\u5199\u4e3a$(1<<(j-1))$**\uff0c\u8fd9\u91cc\u4f4d\u8fd0\u7b97\u4f1a\u66f4\u65b9\u4fbf\u4e5f\u4f1a\u66f4\u5feb\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u544a\u8bc9\u6211\u4eec\uff0cST\u8868\u7c7b\u4f3c\u4e8e\u533a\u95f4DP\uff0c\u662f\u7531\u4e24\u4e2a\u5c0f\u533a\u95f4\u5408\u5e76\u4e0a\u6765\u7684\u3002**\u6240\u4ee5\u5e94\u8be5\u5148\u679a\u4e3e\u533a\u95f4\u957f\u5ea6l\uff08\u8fd9\u91cc\u5373\u4e3a$j$\uff09\uff0c\u518d\u679a\u4e3e$i$.**\n\n2. \u7136\u540e\u4e00\u4e2a\u95ee\u9898\u5e94\u8fd0\u800c\u751f\u4e86\uff1a\u6211\u4eec\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u6709\u6ca1\u6709**\u8fb9\u754c**\u5462\uff1f\n\n\u4e0d\u59a8\u6765\u770b\u4e00\u4e0b$i=6$\u7684\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/75ybmzf5.png)\n\n\u53ef\u4ee5\u770b\u51fa\u5728$i=6$\u65f6\uff0c$j=3$\u7684\u8303\u56f4\u662f$[6,13(6+2^3)]$\uff0c\u5df2\u7ecf\u8d85\u51fa\u4e86\u6211\u4eec\u6570\u636e\u7684\u8303\u7574\u3002\u6240\u4ee5\u5f53$j=3$\u65f6\uff0c$i$\u53ea\u80fd\u53d6\u5230$[1,5(12-2^3+1)]$\n\n**\u7531\u4e0a\u4f8b\u518d\u6839\u636e\u8f6c\u79fb\u65b9\u7a0b\uff0c\u4e0d\u96be\u770b\u51fa\u5f53$j$\u786e\u5b9a\u65f6\uff0ci\u7684\u8303\u56f4\u53d7\u9650\u5728$[1,n-2^j+1]$\u3002**\n\n\n\u90a3\u4e48\u53c8\u6839\u636e$i=1$\u7684\u60c5\u51b5\uff0c\u53ef\u77e5$j$\u5e94\u6ee1\u8db3:\n \n $2^j\\leq n \\Leftrightarrow  j\\leq lg[n] $\uff0c\u5176\u4e2d$lg[n]$\u8868\u793an\u5173\u4e8e\u5e95\u65702\u7684\u5bf9\u6570\u5411\u4e0b\u53d6\u6574\uff0c\u53ef\u4ee5\u9012\u63a8\u6c42\u5f97\u3002\n\n\u6700\u7ec8\u9644\u4e0a\u9884\u5904\u7406\u4ee3\u7801\uff1a\n```cpp\n\tscanf(\"%d%d\",&n,&m); lg[1]=0;\n\tfor (int i=2;i<=n;i++) lg[i]=lg[i>>1]+1;\n    //\u6c42lg[i]\u51fd\u6570\u3002\n\tfor (int i=1;i<=n;i++) scanf(\"%d\",&f[i][0]);\n\tfor (int j=1;j<=lg[n];j++)\n\tfor (int i=1;i<=n-(1<<j)+1;i++){ //\u6ce8\u610f\u4e24\u4e2a\u8fb9\u754c\n\t\tf[i][j]=max(f[i][j-1],f[i+(1<<(j-1))][j-1]);\n\t}\t\n\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(N\u00b7logN)$\n\n---\n\n- ## \u6c42\u6700\u503c\u9636\u6bb5\u3002\n\n\u6211\u4eec\u73b0\u5728\u6765\u6c42\u7ea2\u8272\u6807\u8bb0\u533a\u95f4$[L,R]$\u7684\u6700\u503c\u3002\u5982\u679c\u8981\u6700\u5927\u5316\u5229\u7528ST\u8868\uff0c\u4ecd\u5e94\u8be5\u8003\u8651\u7c7b\u4f3c\u5904\u7406ST\u8868\u7684\u65b9\u6cd5\uff0c**\u5c06\u8be5\u533a\u95f4\u5206\u6210 \u4e24\u4e2aST\u8868\u53ef\u76f4\u63a5\u7ef4\u62a4\u7684\u5c0f\u533a\u95f4\uff0c\u7136\u540e\u4e8c\u8005\u6c42\u6700\u503c\u5373\u53ef\u3002**\n\n- \u90a3\u5bf9\u4e8e\u8d77\u59cb\u70b9\uff0c\u6211\u4eec\u627e\u4e00\u6bb5**ST\u8868\u5728\u8be5\u533a\u95f4\u5185\u53ef\u8986\u76d6\u7684\uff0c\u6700\u5927\u7684\u5b50\u533a\u95f4**\uff0c\u7531\u6570\u5b66\u8bed\u8a00\u53ef\u63cf\u8ff0\u4e3a\uff1a\n\n$(L+2^k-1<=R) \\Leftrightarrow (k<=lg[R-L+1])$ \u90a3\u6211\u4eec\u76f4\u63a5\u53d6\u7b49,\u4ee4$j=k$\u5373\u53ef~\n\n\u4e8e\u662f\u5bf9\u4e8e\u8d77\u59cb\u70b9\u70b9\u5728ST\u8868\u91cc\u7684\u53d6\u503c\u5373\u4e3a\uff1a$f[L][k]$\n\n\n- \u5bf9\u4e8e\u7ec8\u6b62\u70b9\uff0c\u6211\u4eec**\u53cd\u5411**\u627e\u4e00\u4e2a\u4e0e\u8d77\u59cb\u70b9\u8981\u6c42\u76f8\u540c\u7684\u5b50\u533a\u95f4\uff0c\u7531\u4e8e\u5bf9\u79f0\u6027\uff0c\u6b64\u65f6k\u4ecd\u4e3a\u8d77\u59cb\u70b9\u6c42\u5f97\u7684$k=lg[R-L+1]$\n\n\u4f46\u662f\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u786e\u5b9a\u8be5\u5b50\u533a\u95f4\u7684\u8d77\u70b9\u5462\uff1f\u7531\u4e8e\u5b50\u533a\u95f4\u957f\u5ea6\u4e3a$2^k$\uff0c\u8bbe\u8d77\u70b9\u5728$D$\u5904\uff0c\u5219\u6ee1\u8db3\uff1a\n\n$(D+2^k-1=R) \\Leftrightarrow (D=R-2^k+1)$ \n\n\u4e8e\u662f\u5bf9\u4e8e\u7ec8\u6b62\u70b9\u5728ST\u8868\u91cc\u7684\u53d6\u503c\u5373\u4e3a\uff1a$f[D][k]$\uff0c\u53ef\u8bc1\u660e\u8fd9\u6837\u4e00\u5b9a\u53ef\u4ee5\u8986\u76d6\u6574\u4e2a\u533a\u95f4\u3002\n\n### \u7efc\u4e0a\uff0c\u5bf9\u4e8e\u533a\u95f4$[L,R]$\u6c42\u5176\u6700\u503c\uff0c\u4e0d\u96be\u53d1\u73b0\u7b54\u6848\u5373\u4e3a\uff1a\n$$\\max(f[L][k],f[R-(1<<k)+1][k])$$\n\n\u63a5\u4e0b\u6765\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7u35alot.png)\n\n\u5bf9\u4e8e\u84dd\u8272\u533a\u95f4\uff0c\u6211\u4eec\u5148\u627e\u5230$k=lg[8-2+1]=lg[7]=2$\uff0c\u5219\u4e24\u4e2a\u5b50\u533a\u95f4\u5373\u4e3a\uff1a$[2,5],[5,8]$\uff0c\u5bf9\u5e94\u4e86$f[2][2],f[5][2]$\uff0c\u4e24\u4e2a\u53d6\u6700\u503c\u5373\u53ef\u3002\n\n\u9644\u4e0a\u6c42\u503c\u90e8\u5206\u4ee3\u7801\uff1a\n```cpp\n\tfor (int i=1;i<=m;i++)\n\t{\n\t\tcin>>x>>y; int l=lg[y-x+1];\n\t\tcout<<max(f[x][l],f[y-(1<<l)+1][l])<<endl;\n\t}\n```\n\n- ## \u540e\u8bb0\n\n\u867d\u8bf4\u662f\u8be6\u7ec6\u56fe\u89e3\uff0c\u4f46\u597d\u50cf\u66f4\u504f\u5411\u4e8e\u4e00\u4e9b\u7b80\u5355\u7684\u6570\u5b66\u8bc1\u660e\u3002\u3002\n\nST\u8868\u5bf9\u4e8eRMQ\u95ee\u9898\u8fd8\u662f\u6709\u5f88\u5927\u7684\u4f7f\u7528\u7a7a\u95f4\uff0c\u5e0c\u671b\u5404\u4f4d\u80fd\u597d\u597d\u638c\u63e1\u3002\n\n\u6700\u540e\u9644\u4e0a\u6211\u4e11\u964b\u7684\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\nusing  namespace std;\n\nint n,m,x,y,a[100010],lg[100010],f[100010][20];\n\nint main()\n{\n\tcin>>n>>m; lg[1]=0;\n\tfor (int i=2;i<=n;i++) lg[i]=lg[i>>1]+1;\n\tfor (int i=1;i<=n;i++) cin>>f[i][0];\n\tfor (int j=1;j<=lg[n];j++)\n\tfor (int i=1;i<=n-(1<<j)+1;i++){\n\t\tf[i][j]=max(f[i][j-1],f[i+(1<<(j-1))][j-1]);\n\t}\n\t\n\t\n\tfor (int i=1;i<=m;i++)\n\t{\n\t\tcin>>x>>y; int l=lg[y-x+1];\n\t\tcout<<max(f[x][l],f[y-(1<<l)+1][l])<<endl;\n\t}\n}\n```\n",
        "postTime": 1569491305,
        "uid": 15984,
        "name": "\u5929\u6cfd\u9f9f",
        "ccfLevel": 6,
        "title": "\u3010\u6a21\u677f\u3011ST\u8868\u56fe\u89e3"
    },
    {
        "content": "P3865 \u3010\u6a21\u677f\u3011ST\u8868\n[P3865 \u3010\u6a21\u677f\u3011ST\u8868](https://www.luogu.org/problemnew/show/P3865)\n\n\u4e4b\u524d\u7684\u9898\u89e3\u591a\u6709\u758f\u6f0f\u3002\u3002\u3002\u671b\u8c05\u89e3\n\n\u8fd9\u4e2a\u9898\u662f\u5f88\u88f8\u7684st\u8868,\u8ba9\u6211\u4eec\u5148\u8bb2\u8bb2st\u8868\u662f\u4e2a\u5565\u4e1c\u897f:\n\nst\u8868\uff08RMQ\uff09--- O(nlogn+Q)\u7b97\u6cd5:\n\n#### \u539f\u7406:\u628a\u7ed9\u5b9a\u533a\u95f4\u5206\u6210\u957f\u5ea6\u662f2\u7684\u5e42\u6b21\u7684\u5c0f\u533a\u95f4\u3002\u5148\u9884\u5904\u7406\u51fa\u5b83\u4eec\u4e2d\u7684\u6700\u5c0f\u503c\u662f\u591a\u5c11,\u7136\u540e\u7528\u4e00\u79cd\u7c7b\u4f3c\u4e8c\u5206\u7684\u601d\u60f3\u7531\u5c0f\u533a\u95f4\u5230\u5927\u533a\u95f4\u6bd4\u8f83\u4e24\u4e2a\u533a\u95f4\u7684\u6700\u5c0f\u503c\u3002 \n\n##### \u4e3b\u8981\u53d8\u91cf: \n1.f[i][j] : \u8bb0\u5f55\u7ed9\u5b9a\u5e8f\u5217\u4e2d\u533a\u95f4[i,i+pow(2,j)-1]\u4e2d\u7684\u6700\u5927\u503c\u3002\n\n\u8d77\u59cb\u6761\u4ef6:f[i][0]=a[i];\n\n(\u6839\u636e\u4e0a\u9762\u7684\u5b9a\u4e49\uff0cf[i][0]\u4ee3\u8868[i,i]\u533a\u95f4\u6700\u5c0f\u503c(\u5373a[i]:\u663e\u7136\u533a\u95f4[i,i]\u91cc\u53ea\u6709\u5b83\u4e00\u4e2a\u6570))\u3002\n\n2.bit[i] :  bit[i]=pow(2,i)(\u8bb0\u5f552\u7684i\u6b21\u65b9)\u3002  \n\n\u8d77\u59cb\u6761\u4ef6:bit[0]=1,\u4e4b\u540efor\u5faa\u73af\u751f\u6210\u5373\u53ef\u3002\n\n3.a[i]:\u5b58\u7ed9\u5b9a\u5e8f\u5217\u3002 \n\n4.LC:\u5728\u751f\u6210st\u8868\u65f6\u4f5c\u4e3af[i][j]\u4e2dj\u7684\u5faa\u73af\u4e0a\u754c\u3002 \n\n\u5728\u6b63\u5f0f\u8bb2st\u8868\u4e4b\u524d\u5148\u770b\u4e2a\u6a21\u62df\u52a0\u6df1\u4e00\u4e0b\u7406\u89e3\uff1a\n\n\u6839\u636ef[i][j]\u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u9488\u5bf9[1,5]\u6a21\u62df\u5904\u7406\u51fa\u6240\u6709\u957f\u5ea6\u4e3a1,2,4\u7684\u533a\u95f4\u7684\u6700\u5c0f\u503c\n\n\u957f\u5ea6\u4e3a1\u7684\u533a\u95f4[1,1],[2,2],[3,3],[4,4],[5,5]\n\n\u957f\u5ea6\u4e3a2\u7684\u533a\u95f4[1,2],[2,3],[3,4],[4,5]\n\n\u957f\u5ea6\u4e3a4\u7684\u533a\u95f4[1,4],[2,5]\n\n\u7528f[i][j]\u8868\u793a\uff1a \n\nE:\u957f\u5ea6\u4e3a1\u7684\u533a\u95f4: \nf[1][0]  <=>[1,1]\n\nf[2][0]  <=>[2,2]\n\nE:\u957f\u5ea6\u4e3a2\u7684\u533a\u95f4\uff1a \nf[1][1]  <=>[1,2]  \n\nf[2][1]  <=>[2,3]\n\nf[1][2]  <=>[1,4]\n\nf[2][2]  <=>[2,5]\n\n\u603b\u7ed3\u4e00\u4e0b\uff1a\n\n1.\u5728f[i][j]\u4e2d\uff0ci\u4e3a\u533a\u95f4\u5de6\u7aef\u70b9\uff0cj\u51b3\u5b9a\u4e86f[i][j]\u5305\u62ec\u7684\u6bd4\u8f83\u8fc7\u7684\u7684\u5143\u7d20\u4e2a\u6570\u4e3a2^j\uff0c\u533a\u95f4\u53f3\u7aef\u70b9\u4e0b\u6807\u4e3ai+pow(2,j)-1\uff08\u6ce8\u610f\u8fd9\u91cc\u6709\u4e2a-1\uff09;\n\n2.\u7531\u4e8e\u6211\u4eec\u5faa\u73af\u751f\u6210st\u8868\u65f6\u6309\u533a\u95f4\u957f\u5ea6\u7531\u5c0f\u5230\u5927\uff0c\u6545\u5148\u5faa\u73afj\uff081~(int)log2(n)\uff09------ \uff08\u6b64\u5904\u7684j\u662ff[i][j]\u4e2d\u7684j\uff09\u3002\n\n\n\u4e0b\u9762\u8fdb\u5165\u6b63\u9898\uff1a\n\n*  ### \u5982\u4f55\u6c42\u51faf\u6570\u7ec4\n\nf[i][j]:\u4ecei\u51fa\u53d1\u7b97\u4e0ai\u8fde\u7eedpow(2,j)\u4e2a\u6570\u7684\u6700\u5927\u503c  \n\n<=>\u4ecei\u51fa\u53d1\u8fde\u7eedpow(2,j-1) \u4e0e \u4ecei+pow(2,j-1)\u51fa\u53d1\u8fde\u7eedpow(2,j-1)\u8fd9\u4e24\u4e2a\u6700\u5927\u503c\u7684\u6700\u5927\u503c\uff08\u5206\u6210\u4e24\u534a\uff09\n\n\u65b9\u7a0b:       \n            \n            f[i][j]=max(f[i][j-1],f[i+pow(2,j-1)][j-1]);\n   \n   \n   ```cpp\n//1.\u751f\u6210st\u8868(nlogn): \n\n```cpp\nLG=(int)(log(n)/log(2));//\u81ea\u52a8\u5411\u4e0b\u53d6\u6574\uff08\u663e\u7136\u5411\u4e0a\u53d6\u6574\u641est\u8868\u65f6\u6bd4\u8f83\u6700\u5927\u503c\u65f6\u5bb9\u6613\u628a\u7ed9\u5b9a\u5e8f\u5217\u5916\u5934\u7684\u5143\u7d20\u4e5f\u5305\u62ec\u5728\u5185\uff0c\u4e0d\u8fc7\u8fd9\u5bf9\u4e8e\u6700\u5927\u503c\u4e48\u4ec0\u4e48\u5927\u788d\uff0c\u5982\u679c\u662f\u67e5\u627e\u6700\u5c0f\u503c\u3002\u3002\u3002\u4f60\u5c31\u676f\u5177\u4e86\uff09 \n//log(n)/log(2)<=>log2(n)---\u6362\u5e95\u516c\u5f0f\n//\u6362\u5e95\u516c\u5f0f\uff1aloga b=lg b/lg a\nfor (i=1; i<=LG; i++) \n\tbit[i]=bit[i-1]*2;//\u521d\u59cb\u5316bit[i] \nbit[0]=1;\nfor (i=1; i<=n; i++) \n\tf[i][0]=a[i];//\u8d77\u59cb\u5316 \nfor (j=1; j<=LG; j++)//\u7531\u4e8e2^j\u4e3a\u533a\u95f4\u957f\u5ea6,\u6545\u5faa\u73afj\u5176\u5b9e\u5c31\u662f\u628a\u533a\u95f4\u957f\u5ea6\u4ece1\u679a\u4e3e\u5230n\uff08\u6709\u53ef\u80fd<\uff09 \n\tfor (i=1; i<=n-bit[j]+1; i++)//\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u533a\u95f4\u957f\u5ea6\u679a\u4e3e\u6240\u6709\u53ef\u884c\u7684\u5de6\u7aef\u70b9\n\t//i<=n-bit[j]+1------n-bit[j]+1+2^j-1=n\n    \t\tf[i][j]=max(f[i][j-1],f[i+bit[j-1]][j-1]);//\u65b9\u7a0b \n``` \n\n\u8bb2\u5b8c\u4e86\u751f\u6210\uff0c\u518d\u6765\u4e2a\u6a21\u62df\u5927\u6982\u7406\u89e3\u4e00\u4e0bst\u8868\u7684\u751f\u6210: \n\n\u7ed9\u5b9a\u4e00\u4e2a\u6570\u52172 4 3 5 1:\n\n\u6b64\u65f6LC=2\uff0cn=5\uff1b\n\nf[1][0]=2  f[2][0]=4  f[3][0]=3  f[4][0]=5  f[5][0]=1\n\n\u5f53j=1\u65f6\uff0c i = 1 to 4\n\nf[1][1]=max(f[1][0],f[2][0])=4;[1,2]\n\nf[2][1]=4\n\nf[3][1]=5\n\nf[4][1]=5\n\n\n\u5f53j=2\u65f6\uff0c i = 1 to n-bit[j]+1=2\n\nf[1][2]=max(f[1][1],f[3][1])=5;\n\nf[2][2]=5\n\n\n\n* ### **\u5982\u4f55\u7ed9\u5b9a\u4efb\u610fl,r,\u8bbf\u95ee[l,r]\u4e2d\u6700\u5c0f\u503c\uff1f**   \n\n\u7531\u4e8e\u6211\u4eec\u4e0d\u80fd\u4fdd\u8bc1r\u5c31=l+2^x-1(x\u4efb\u610f),\u663e\u7136\u6211\u4eec\u5e94\u8be5\u8ba9\u4ee5l\u4e3a\u8d77\u70b9\u7684st\u8868\u6570\u636e\u8986\u76d6[l,r]\u4e2d\u6570\u8db3\u591f\u591a\uff0c \n\n\u89c4\u5b9a\u5728f[i][j]\u4e2d,i=l,j=p,len=r-l+1(\u533a\u95f4\u957f\u5ea6);\n\n\u627e\u6700\u5927\u7684p\u5e94\u6ee1\u8db32^p <= len(\u4ee5l\u4e3a\u8d77\u70b9\u7684st\u8868\u6570\u636e\u8986\u76d6[l,r]\u4e2d\u6570\u8db3\u591f\u591a) \n\n\u5219p=int(log(len)/log(2))\uff08\u518d\u6b21\u63d0\u9192\uff1a\u5411\u4e0a\u53d6\u6574\u4f1a\u8d8a\u754c\uff09;\n\nexample\uff1a\u5bf9\u4e8e\u533a\u95f4[4,8],p=2,\u5206\u5230[4,4+2^2-1],\u5373[4,7];\n\n\u56e0\u4e3af[l][p](\u5206\u7684\u5de6\u533a\u95f4)\u4e2d\u6700\u5927\u7684p\u6ee1\u8db3l+pow(2,p)-1<=r\n\n\u6545\u67e5\u8be2\u65f6\u5206\u7684\u67e5\u8be2\u533a\u95f4[l,r]\u7684\u53f3\u533a\u95f4\u7684\u5de6\u7aef\u70b9x=r+1-pow(2,p)\n\n##### \u5982\u4f55\u6c42\u5f97\u8fd9\u4e2ax\uff1a\n\n\u5bf9\u4e8ef[x][r],\u5e94\u6709\uff1a[x][x+pow(2,p)-1]<=>[x][r]  \n\n\u6240\u4ee5\uff0c x+pow(2,p)-1=r\n\n\u79fb\u9879\uff0c\u5f97\uff1ax=r+1-pow(2,p) \n\n\u663e\u7136\uff0cx>=l\n(l+pow(2,p)-1<=r,x+pow(2,p)-1=r,\u6545x>=l)\n\n\u7efc\u4e0a[l,r]\u7684\u6700\u5927\u503c = max( f[l][p] , f[x][R] );\n\n\u4ee3\u7801:\n```cpp\ncin>>Q;\nfor (i=1;i<=Q;i++) \n{\n\tcin>>L>>R;\n\tint len=R-L+1;\n  \tint p=(int)(log(len)/log(2));\n  \tx=R-bit[p]+1;\n\tcout<<max(f[L][p],f[x][p])<<endl;\n}\n```\n\n\u9488\u5bf9\u8fd9\u4e2a\u677f\u5b50,\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff08\u4e4b\u524d\u7684bit[i]\u7edf\u4e00\u6539\u6210\u4f4d\u8fd0\u7b97<\u6ce8\u610f\u4f4d\u8fd0\u7b97\u4e0e\u52a0\u51cf\u4e58\u9664\u4f18\u5148\u7ea7>\uff09:\n\n\n\n```cpp\n#include<cstdio> \n#include<cmath>\n#include<algorithm>\nusing namespace std;\nint f[100001][40],a,x,LC,n,m,p,len,l,r;\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;i++)\n    {\t\n        scanf(\"%d\",&a);\n        f[i][0]=a;\n    }\n    LC=(int)(log(n)/log(2));\n    for(int j=1;j<=LC;j++)\n        for (int i=1;i<=n-(1<<j)+1;i++)\n    \t\tf[i][j]=max(f[i][j-1],f[i+(1<<(j-1))][j-1]);\n    for(int i=1;i<=m;i++) \n    {\n        scanf(\"%d%d\",&l,&r);\n  \t\tp=(int)(log(r-l+1)/log(2));\n        printf(\"%d\\n\",max(f[l][p],f[r-(1<<p)+1][p]));\n    }\n    return 0;\n}\n```",
        "postTime": 1518316855,
        "uid": 53774,
        "name": "\u5403\u74dc\u7fa4\u4f17syc",
        "ccfLevel": 0,
        "title": "P3865 \u3010\u6a21\u677f\u3011ST\u8868"
    },
    {
        "content": "$magic!$ $O(n)$\u5728\u7ebf$RMQ$\n\n\u524d\u7f6e\u77e5\u8bc6:\u7b1b\u5361\u5c14\u6811\n\n\u4ee5\u4e0b\u6807\u4f5c\u4e3a\u8282\u70b9\u5efa\u7acb\u7684\u4e8c\u53c9\u641c\u7d22\u6811\uff0c\u540c\u65f6\u6743\u503c\u6ee1\u8db3\u5806\u7684\u6027\u8d28.\u8fd9\u9898\u53d6max\u5c31\u662f\u5927\u6839\u5806.\n\n\u5bf9\u5c31\u662f\u4e00\u4e2a$Treap$\n\n\u5bf9\u4e00\u4e2a\u5e8f\u5217\u5efa\u7acb\u7b1b\u5361\u5c14\u6811\n\n\u4f7f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u6700\u53f3\u8fb9\u4e00\u6761\u94fe\u4e0a\u7684\u70b9\uff0c\u5bb9\u6613\u77e5\u9053\u8fd9\u6761\u94fe\u662f\u4ece\u4e0a\u5230\u4e0b\u9012\u51cf\u7684\uff0c\u6bcf\u6b21\u5728\u6700\u53f3\u8fb9\u52a0\u5165\u4e00\u4e2a\u5143\u7d20$w[i]$\uff0c\u5982\u679c\u5b83\u6bd4\u6808\u9876\u5927\u5c31\u5f39\u6808\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u627e\u5230\u5b83\u5e94\u8be5\u63d2\u5165\u7684\u4f4d\u7f6e.\u8bb0\u5f55\u6700\u540e\u4e00\u6b21\u5f39\u6808\u7684\u5143\u7d20$last$\uff0c\u4ee4\u6808\u9876\u7684\u53f3\u513f\u5b50\u662f$w[i]$,$w[i]$\u7684\u5de6\u513f\u5b50\u662f$last$\u5373\u53ef.\u5bb9\u6613\u77e5\u9053\u662f$O(n)$\u7684.\n\n\u5efa\u6811\u4ee3\u7801\n```cpp\nvoid build_tree()\n{\n\tint top=1;stack[1]=1;//\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5355\u8c03\u6808\u53ea\u8bb0\u5f55\u4e0b\u6807\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint lst=0;\n\t\twhile(top&&w[i]>w[stack[top]])lst=stack[top--];//\u5f39\u6808\n\t\tfa[lst]=i;if(top)fa[i]=stack[top];\n\t\tstack[++top]=i;\n\t}\n\tfor(int i=1;i<=n;i++)if(fa[i])ade(fa[i],i);else S=i;\n    //S\u662f\u6839\n}\n```\n\n\u5bb9\u6613\u77e5\u9053\u4e00\u6bb5\u533a\u95f4$[l,r]$\u7684$max$\u5373\u7b1b\u5361\u5c14\u6811\u4e0a$l$\u548c$r$\u7684$LCA$\n\n\u7136\u540e\u5982\u679c\u4f60\u53bb\u7ffb\u4e86\u7ffb\u9876\u4e0a$kcz\\ rank1$\u7684\u4ee3\u7801\uff0c\u4f60\u53d1\u73b0\u4ed6\u505a\u5230\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\uff0c\u5e95\u4e0b\u662f\u4e00\u4e2a\u66b4\u529b\u67e5\u8be2.\n\n\u6211\u4eec\u77e5\u9053\u8fd9\u6837\u5efa\u51fa\u6765\u7684\u6811\u662f\u4e0d\u5e73\u8861\u7684\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u6784\u9020\u4e00\u4e2a\u5355\u8c03\u9012\u51cf\u7684\u6570\u5217\uff0c\u7136\u540e\u6bcf\u6b21\u90fd\u67e5\u5355\u70b9\u5c31\u53ef\u4ee5\u5361\u5230$O(n^2)$\uff0c\u4f46\u662f\u6570\u636e\u968f\u673a...\u968f\u673a...\n\n\u4e0d\u7ba1\u4e86\u8fd8\u662f\u56de\u5230\u89e3\u9898\u4e0a\u6765.\n\n\u8fd9\u9898\u6ca1\u5f3a\u5236\u5728\u7ebf\u6240\u4ee5\u53ef\u4ee5$Tarjan$\u6c42$LCA$\uff0c$O(n+m)$.\n\n\u5f3a\u5236\u5728\u7ebf?\n\n\u8003\u8651\u600e\u4e48\u5728$O(n+m)$\u7684\u65f6\u95f4\u5185\u5728\u7ebf\u6c42\u4e00\u4e2a$LCA$\n\n\u8f6c\u6210$RMQ$\u53bb\u505a~~(\u6240\u4ee5\u7ed5\u4e86\u4e00\u5927\u5708\u53c8\u8f6c\u56de\u6765\u4e86)~~\uff0c\u8003\u8651\u6811\u7684\u6b27\u62c9\u5e8f\u904d\u5386.\n\n\u6b27\u62c9\u5e8f\u5c31\u662f\u7b2c\u4e00\u6b21\u904d\u5386\u7684\u65f6\u5019\u8bb0\u5f55\u4e00\u4e0b$dfs$\u5e8f\uff0c\u6bcf\u6b21\u8bbf\u95ee\u5b8c\u4e00\u4e2a\u513f\u5b50\u4e4b\u540e\u518d\u8bb0\u5f55\u4e00\u4e2a$dfs$\u5e8f.\n\n\u4e0b\u9762\u662f\u4e00\u5f20~~\u7075\u9b42~~\u56fe\u793a\n\n![](https://cdn.luogu.com.cn/upload/pic/52055.png)\n\n\u5b83\u7684\u6b27\u62c9\u5e8f\u662f$1\\ 2\\ 4\\ 2\\ 5\\ 2\\ 1\\ 3\\ 1$\n\n\u957f\u5ea6\u662f\u591a\u5c11\u5462?\u6211\u4eec\u77e5\u9053\u9664\u4e86\u6574\u68f5\u6811\u90fd\u8981\u904d\u5386\u4e00\u904d\u4e4b\u5916\uff0c\u6bcf\u4e2a\u70b9\u90fd\u6709\u5b83\u7684\u513f\u5b50\u4e2a\u6570$son[i]$\u904d\u91cd\u590d\n\n\u6240\u4ee5$len=n+\\sum son[i]=2n-1$\n\n\u8bb0\u70b9$i$\u7684\u6df1\u5ea6\u662f$dep[i]$\uff0c\u5728\u6b27\u62c9\u5e8f\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u662f$first[i]$\uff1b\u6b27\u62c9\u5e8f\u7684\u7b2c$i$\u4e2a\u4f4d\u7f6e\u6240\u5bf9\u5e94\u7684\u70b9\u662f$point[i]$.\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\u5c31\u662f\u4e24\u4e2a\u70b9$l,r$\u7684$lca$\u662f$min\\{dep[point[i]]|first[l]\\leq i\\leq first[r]\\}$\u6240\u5bf9\u5e94\u7684\u70b9\uff0c\u4e5f\u5c31\u662f\u4e24\u70b9\u6b27\u62c9\u5e8f\u4e4b\u95f4\u6df1\u5ea6\u6700\u4f4e\u7684\u90a3\u4e2a\u70b9.\u8fd9\u4e2a\u6027\u8d28\u975e\u5e38\u5bb9\u6613\u8bc1\u660e\uff0c\u56e0\u4e3a\u4e24\u4e2a\u70b9\u6b27\u62c9\u5e8f\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e4b\u95f4\u4e0d\u4f1a\u6709\u6bd4$lca$\u6df1\u5ea6\u66f4\u5c0f\u7684\u70b9\u4e14$lca$\u4e00\u5b9a\u4f1a\u51fa\u73b0.(\u5176\u5b9e\u4e0d\u662f\u7b2c\u4e00\u6b21\u4e5f\u4e00\u6837233)\n\n\u4e8e\u662f\u6211\u4eec\u628a$lca$\u8f6c\u5316\u6210\u4e86$rmq$.\n\n\u5982\u679c\u53ea\u662f\u7b97$rmq$\u6ca1\u4ec0\u4e48\u7528\uff0c\u4f46\u662f\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u4e2armq\u6709\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u6027\u8d28\uff0c\u5373\u76f8\u90bb\u4e24\u4e2a\u5143\u7d20\u4e4b\u95f4\u7684\u5dee\u53ea\u4f1a\u662f$1$\u6216$-1$\n\n\u8fd9\u610f\u5473\u7740\u4ec0\u4e48\u5462?\u5982\u679c\u6211\u4eec\u628a\u957f\u4e3a$n$\u7684\u5e8f\u5217\u5206\u5757\uff0c\u5757\u7684\u5927\u5c0f\u662f$b$\u7684\u8bdd\uff0c\u53ea\u6709$min(2^b,n)$\u4e2a\u672c\u8d28\u4e0d\u540c\u7684\u5757\uff0c\u56e0\u4e3a\u5dee\u5206\u4e4b\u540e\u6bcf\u4e2a\u5143\u7d20\u53ea\u6709\u4e24\u79cd\u53d6\u503c(\u7b2c\u4e00\u4e2a\u5143\u7d20\u53d6\u54ea\u4e2a\u90fd\u884c).\n\n\u4e3a\u4e86$O(1)$\u67e5\u8be2\u533a\u95f4\u7684$rmq$\uff0c\u6211\u4eec\u9700\u8981\u9884\u5904\u7406\u5757\u548c\u5757\u4e4b\u95f4\u7684$rmq$\u548c\u6bcf\u4e2a\u5757\u5185\u7684$rmq$.\u4f7f\u7528$ST$\u8868\u6765\u5904\u7406\u5757\u95f4$rmq$\uff0c\u590d\u6742\u5ea6$O(\\frac{n}{b}\\log\\frac{n}{b})=O(\\frac{n}{b}\\log n)$\uff1b\u9884\u5904\u7406$2^b$\u79cd\u672c\u8d28\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u590d\u6742\u5ea6$O(min(2^b,n)b\\log b)$.\u9700\u8981\u5728\u4e24\u8005\u4e2d\u95f4\u53d6\u4e00\u4e2a\u5e73\u8861.\u4ee4$b=\\left\\lfloor\\frac{\\log n}{2}\\right\\rfloor$\uff0c\u90a3\u4e48\u524d\u4e00\u4e2a\u5f0f\u5b50\u5316\u6210$O(n)$\uff0c\u540e\u4e00\u4e2a\u5f0f\u5b50\u5316\u6210$O(\\sqrt{n}\\ b\\log b)$\u56e0\u4e3a$b=O(\\log n)$\u6e10\u8fdb\u5c0f\u4e8e\u4efb\u4f55\u591a\u9879\u5f0f\u51fd\u6570\uff0c\u6240\u4ee5\u540e\u9762\u8fd9\u4e2a\u4e1c\u897f\u662f\u5c0f\u4e8e$O(n)$\u7684\uff0c\u4ece\u800c\u6574\u4f53\u590d\u6742\u5ea6$O(n)$.\n\n\u53ef\u4ee5\u9884\u6d4b\u5230\u4ee3\u7801\u590d\u6742\u5ea6\u6781\u9ad8\uff0c\u6240\u4ee5\u6ca1\u4ec0\u4e48\u7528.\u4e0d\u8fc7\u7a7a\u95f4\u540c\u6837\u662f$O(n)$\u7684\uff0c\u4e5f\u6bd4$ST$\u8868\u66f4\u52a0\u4f18\u8d8a~~\u5c31\u662f\u5e38\u6570\u4e0d\u77e5\u5927\u5230\u54ea\u91cc\u53bb~~\n\n\u5176\u5b9e\u4e5f\u6ca1\u6709\u591a\u957f\uff0c\u5c31$130$\u884c\uff0c\u548c\u4e00\u4e2a\u8f83\u590d\u6742\u7ebf\u6bb5\u6811\u5dee\u4e0d\u591a.\u538b\u4e00\u538b\u884c\u66f4\u77ed.\n\n\u4ee3\u7801\u4e11\u7684\u4e00\u5339qwq\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int inf=1e9;\nint n,m,w[2000000],lg2[1500000];\nint pos[1500000],lst[1500000],dep[1500000],id,mm,S,ch[1500000][2],stack[1500000];\nstruct LIM_RMQ\n{\n\tint w[1500000],bl[1500000],blo,L[150000],R[150000],pos[10000],val[150000],minn[150000],minpos[150000],t[1000],n_st;\n\tstruct ST_node{int f,id;bool operator <(const ST_node &tmp)const{return f<tmp.f;}};\n\tstruct STable\n\t{\n\t\tST_node a[4][12];//n=1e6\u7684\u8bddlogn/2\u53ea\u67099...\u6240\u4ee5\u653e\u5fc3\u5f00\n\t\tvoid make(int w[],int n)\n\t\t{\n\t\t\tfor(int i=1;i<=n;i++)a[0][i]=(ST_node){w[i],i};\n\t\t\tfor(int i=1;(1<<i)<=n;i++)//st\u8868\uff0c\u4e0d\u8fc7\u8981\u540c\u65f6\u5904\u7406\u51fa\u6700\u5c0f\u503c\u6240\u5728\u7684\u4f4d\u7f6e\n\t\t\t\tfor(int j=1;j+(1<<i)-1<=n;j++)\n\t\t\t\t\ta[i][j]=min(a[i-1][j],a[i-1][j+(1<<(i-1))]);\n\t\t}\n\t\tST_node query(int l,int r)\n\t\t{\n\t\t\tint len=lg2[r-l+1];\n\t\t\treturn min(a[len][l],a[len][r-(1<<len)+1]);\n\t\t}\n\t}st[10000];//\u8fd9\u91cc\u53ea\u6709sqrt(n)\u4e2a\uff0c\u4e5f\u4e0d\u7528\u5f00\u8fd9\u4e48\u5927\n\tstruct STable_block\n\t{\n\t\tST_node a[20][150000];//\u8fd9\u4e2a\u5360\u7a7a\u95f4\u6700\u5927\u4e86\u5427...\u4e0d\u8fc7\u4e5f\u53ea\u662fO(n)\u7684\n\t\tvoid make(int w[],int n)\n\t\t{\n\t\t\tfor(int i=1;i<=n;i++)a[0][i]=(ST_node){w[i],i};\n\t\t\tfor(int i=1;(1<<i)<=n;i++)\n\t\t\t\tfor(int j=1;j+(1<<i)-1<=n;j++)\n\t\t\t\t\ta[i][j]=min(a[i-1][j],a[i-1][j+(1<<(i-1))]);\n\t\t}\n\t\tST_node query(int l,int r)\n\t\t{\n\t\t\tint len=lg2[r-l+1];//\u7ec6\u8282\uff0cmath\u5e93\u7684log2\u51fd\u6570\u4e0d\u80fd\u770b\u505aO(1)\u7684\uff0c\u8981\u63d0\u524d\u5904\u7406\n\t\t\treturn min(a[len][l],a[len][r-(1<<len)+1]);\n\t\t}\n\t}st_block;\n\tvoid make(int a[],int n)\n\t{\n\t\tfor(int i=1;i<=n;i++)w[i]=a[i];\n\t\tlg2[1]=0;for(int i=2;i<=n;i++)lg2[i]=lg2[i>>1]+1;//\u5904\u7406log2\n\t\tblo=max(lg2[n]>>1,1);//\u5206\u5757\n\t\tfor(int i=1;i<=n;i++)bl[i]=(i-1)/blo+1;\n\t\tfor(int i=1;i<=bl[n];i++)L[i]=(i-1)*blo+1,R[i]=min(i*blo,n),minn[i]=inf;\n\t\tw[0]=w[1]-1;\n\t\tfor(int i=1;i<=bl[n];i++)\n\t\t{\n\t\t\tint tmp=0,nn=0;\n\t\t\tfor(int j=L[i];j<=R[i];j++)\n\t\t\t{\n\t\t\t\tt[++nn]=w[j],tmp=tmp<<1|(w[j]-w[j-1]==1?1:0);\n\t\t\t\tif(w[j]<minn[i])minn[i]=w[j],minpos[i]=j;\n                //\u53ef\u4ee5\u7528\u4e00\u4e2a\u72b6\u538b\u6765\u8868\u793a\u672c\u8d28\n\t\t\t}\n\t\t\tif(!pos[tmp])st[pos[tmp]=++n_st].make(t,nn);\n\t\t\tval[i]=pos[tmp];//\u8bb0\u4e0b\u6bcf\u4e2a\u5757\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u672c\u8d28\n\t\t}\n\t\tst_block.make(minn,bl[n]);//\u5757\u95f4rmq\n\t}\n\tST_node query_block(int id,int l,int r){ST_node t=st[val[id]].query(l-L[id]+1,r-L[id]+1);return (ST_node){t.f,t.id+L[id]-1};}\n    //\u5b9e\u9645\u4f4d\u7f6e=\u5757\u5de6\u7aef\u70b9+\u5757\u5185\u67e5\u8be2\u4f4d\u7f6e-1\uff0c\u5982\u679c\u4f60\u628a\u5757\u5185\u67e5\u8be2\u4ece0\u5f00\u59cb\u5199\u5c31\u53ef\u4ee5\u7701\u7565-1\n\tint query(int l,int r)\n\t{\n\t\tint bll=bl[l],blr=bl[r];\n\t\tif(bll==blr)return query_block(bll,l,r).id;//\u4e00\u4e2a\u5757\n\t\tint ml=query_block(bll,l,R[bll]).id,mr=query_block(blr,L[blr],r).id,mm;\n\t\tif(w[ml]<w[mr])mm=ml;else mm=mr;//\u4e24\u7aef\u96f6\u6563\u5757\n\t\tif(bll+1<=blr-1)//\u6574\u5757\n\t\t{\n\t\t\tint mmid=minpos[st_block.query(bll+1,blr-1).id];\n\t\t\tif(w[mmid]<w[mm])mm=mmid;\n\t\t}\n\t\treturn mm;\n\t}\n}a;\nvoid dfs(int u,int depth)\n{\n\tlst[u]=++id,pos[id]=u;dep[id]=depth;//\u5904\u7406\u6b27\u62c9\u5e8f\u5217\n\tfor(int i=0;i<=1;i++)\n\t\tif(ch[u][i])\n\t\t{\n\t\t\tdfs(ch[u][i],depth+1);\n\t\t\tpos[++id]=u,dep[id]=depth;\n\t\t}\n}\nint getin()\n{\n\tint x=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')ch=getchar();\n\twhile(ch>='0'&&ch<='9')x=x*10+ch-48,ch=getchar();\n\treturn x;\n}\nint wt[30];\nvoid putout(int x)\n{\n\tif(!x){putchar('0');return;}\n\tint l=0;\n\twhile(x)wt[++l]=x%10,x/=10;\n\twhile(l)putchar(wt[l--]+48);\n\tputs(\"\");\n}\nvoid build_tree()//\u7b1b\u5361\u5c14\u6811\n{\n\tint top=1;stack[1]=S=1;//\u5f00\u59cb\u6839\u4e3a1\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint lst=0;\n\t\twhile(top&&w[i]>w[stack[top]])lst=stack[top--];\n\t\tif(lst)ch[i][0]=lst;\n\t\tif(top)ch[stack[top]][1]=i;else S=i;\n\t\tstack[++top]=i;\n\t}\n\tdfs(S,1);\n}\nint main()\n{\n\tn=getin(),m=getin();\n\tfor(int i=1;i<=n;i++)w[i]=getin();\n\tbuild_tree();\n\ta.make(dep,id);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint l=lst[getin()],r=lst[getin()];\n\t\tif(l>r)swap(l,r);//\u53ef\u80fd\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u662f\u53cd\u8fc7\u6765\u7684\n\t\tputout(w[pos[a.query(l,r)]]);\n\t}\n} \n```\n\u5176\u5b9e\u4e5f\u6ca1\u90a3\u4e48\u957f\uff0c\u56e0\u4e3a\u6709\u4e24\u4e2aST\u8868\u662f\u91cd\u590d\u7684\u53ef\u4ee5\u590d\u5236\u7c98\u8d34.\u4e3b\u8981\u7684\u4ee3\u7801\u957f\u5ea6\u5c31\u5728\u5206\u5757\u548cST\u8868\u4e0a.\n\n\u6700\u591a\u7528\u6765\u5199\u5199LCA\u5427233 \u7eaflca\u53ea\u6709100\u884c\uff0c\u6bd4\u6811\u5256\u957f\u4e0d\u4e86\u591a\u5c11",
        "postTime": 1550384916,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "\u4f17\u6240\u5468\u77e5\uff0c~~\u65e0\u826f~~ cz \u4eca\u5929\u52a0\u5f3a\u4e86 st \u8868\u677f\u9898\u7684\u6570\u636e\uff0c\u5361\u6389\u4e86\u7ebf\u6bb5\u6811\uff0c\u6811\u72b6\u6570\u7ec4\u7b49\u67e5\u8be2\u5e26 log \u7684\u6570\u636e\u7ed3\u6784\u3002\r\n\r\n\u4f46\u662f st \u8868\u7684\u677f\u9898\u663e\u7136\u662f\u4e0d\u80fd\u7528 st \u8868\u505a\u7684\u5440\uff01\u6240\u4ee5\u6211\u4eec\u9700\u8981\u53e6\u4e00\u4e2a\u67e5\u8be2\u662f\u7ebf\u6027\u7684\u6570\u636e\u7ed3\u6784\u3002\r\n\r\n\u8fd9\u91cc\uff0c\u6211\u4eec\u4f7f\u7528**\u732b\u6811**\u3002\r\n\r\n\u732b\u6811\u662f\u4e00\u79cd\u652f\u6301 $O(n\\log n)+O(1)+O(n\\log n)$ \u67e5\u8be2\u533a\u95f4\u534a\u7fa4\u4fe1\u606f\u7684\u6570\u636e\u7ed3\u6784\uff0cOI \u754c\u9996\u5148\u89c1\u4e8e immortalCO\uff08\u732b\u8001\u5e08\uff09\u7684\u535a\u5ba2\uff0c\u6545\u540d\u732b\u6811\u3002\r\n\r\n\u9996\u5148\u58f0\u660e\u8fd9\u53ea\u662f\u4e3a\u4e86\u5199\u9898\u89e3\u800c\u5199\u7684\u4e00\u4e2a\u6559\u7a0b\uff0c\u5e76\u4e0d\u662f\u4e13\u95e8\u7684\u5b66\u4e60\u7b14\u8bb0\uff0c\u6240\u4ee5\u6709\u4e9b\u5730\u65b9\u53ef\u80fd\u8bb2\u5f97\u5e76\u4e0d\u591f\u8be6\u7ec6\u3002\u5982\u679c\u771f\u7684\u8981\u5b66\u4e60\u732b\u6811\uff0c\u5efa\u8bae\u53bb[\u6d1b\u8c37\u65e5\u62a5](https://www.luogu.com.cn/blog/yestoday/mao-shu)\u6216\u8005\u732b\u8001\u5e08\u7684[\u539f\u59cb\u535a\u5ba2](http://immortalco.blog.uoj.ac/blog/2102)\u3002\r\n\r\n\u8fd9\u4e1c\u897f\u7684\u601d\u60f3\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a\u5efa\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u7ebf\u6bb5\u6811\u4e00\u6837\u7684\u4e1c\u897f\uff0c\u7136\u540e\u5728\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4\u4e2d\u70b9\u5de6\u8fb9\u7684\u6240\u6709\u70b9\u5230\u4e2d\u70b9\u7684\u7b54\u6848\u4ee5\u53ca\u4e2d\u70b9\u5230\u4e2d\u70b9\u53f3\u8fb9\u6240\u6709\u70b9\u7684\u7b54\u6848\u3002\u67e5\u8be2\u7684\u65f6\u5019\u627e\u5230\u67d0\u4e00\u4e2a\u8282\u70b9\u4f7f\u5f97\u5de6\u53f3\u7aef\u70b9\u90fd\u5728\u8fd9\u4e2a\u533a\u95f4\u4e2d\u5e76\u4e14\u4f4d\u4e8e\u4e2d\u70b9\u4e24\u4fa7\uff0c\u7136\u540e\u5408\u5e76\u7b54\u6848\u3002\r\n\r\n\u5982\u679c\u76f4\u63a5\u4ece\u4e0a\u5f80\u4e0b\u53bb\u627e\u7684\u8bdd\u590d\u6742\u5ea6\u5e26\u4e00\u4e2a log\uff0c\u6211\u4eec\u8003\u8651\u4f18\u5316\u6389\u8fd9\u4e2a log\u3002\r\n\r\n\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u533a\u95f4\u5c31\u662f\u5de6\u53f3\u7aef\u70b9\u6240\u5bf9\u5e94\u8282\u70b9\u7684 lca\uff0c\u600e\u4e48\u53bb\u6c42\u4e00\u4e0b lca \u5c31\u884c\u4e86\u3002\r\n\r\n\u4f46\u662f\u6709\u66f4\u7b80\u5355\u7684\u505a\u6cd5\u3002\u6211\u4eec\u628a\u6570\u7ec4\u7684\u957f\u5ea6\u8865\u5230\u4e8c\u7684\u5e42\uff08\u5728\u540e\u9762\u52a0\u96f6\uff09\uff0c\u6211\u4eec\u53d1\u73b0\u4e24\u4e2a\u8282\u70b9\u7684 lca \u5c31\u662f\u4ed6\u4eec\u4e8c\u8fdb\u5236\u8868\u793a\u7684 lcp\u3002\r\n\r\n\u7136\u540e\u5982\u679c\u4e24\u4e2a\u6570\u5f02\u6216\u4e4b\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u4eec\u7684 lcp \u7684\u90e8\u5206\u90fd\u53d8\u6210\u96f6\u4e86\uff0c\u4e5f\u5c31\u662f\u6700\u9ad8\u4f4d\u5f80\u540e\u632a\u4e86 lcp \u8fd9\u4e48\u591a\u3002\r\n\r\n\u8fd9\u6837\u6211\u4eec\u9884\u5904\u7406\u4e00\u4e0b\u6240\u6709\u6570\u7684\u6700\u9ad8\u4f4d\u5c31\u884c\u4e86\u3002\r\n\r\n\u5b9e\u73b0\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u5c42\u7684\u6240\u6709\u8282\u70b9\u7684\u4fe1\u606f\u5b58\u5728\u4e00\u4e2a\u6570\u7ec4\u91cc\uff0c\u7136\u540e\u53ea\u9700\u8981\u77e5\u9053 lca \u7684\u6df1\u5ea6\u5373\u53ef\u3002\r\n\r\n\u53e6\u5916\u6bcf\u4e2a\u6570\u7ec4\u5f00\u51e0\u500d\u8981\u597d\u597d\u6ce8\u610f\u4e00\u4e0b\uff0c\u6211 RE \u4e86\u4e00\u9762\u624d\u8fc7\u2026\u2026\r\n\r\n\u4e0b\u9762\u662f\u6211\u81ea\u5df1\u89c9\u5f97\u6bd4\u8f83\u597d\u770b\u7684\u5b9e\u73b0\uff1a\r\n```cpp\r\n#include<algorithm>\r\n#include<cctype>\r\n#include<cstdio>\r\nusing namespace std;\r\ninline int readint(){\r\n    int x=0;\r\n    bool f=0;\r\n    char c=getchar();\r\n    while(!isdigit(c)&&c!='-') c=getchar();\r\n    if(c=='-'){\r\n        f=1;\r\n        c=getchar();\r\n    }\r\n\twhile(isdigit(c)){\r\n        x=x*10+c-'0';\r\n        c=getchar();\r\n    }\r\n    return f?-x:x;\r\n}\r\nconst int maxn=1e5+5;\r\nint n,m,a[maxn*2];\r\nint f[maxn*2][25],pos[maxn*2];\r\nvoid build(int o,int l,int r,int d){\r\n\tif(l==r){\r\n\t\tpos[r]=o;\r\n\t\treturn;\r\n\t}\r\n\tint mid=l+(r-l)/2;\r\n\tbuild(o*2,l,mid,d+1);\r\n\tbuild(o*2+1,mid+1,r,d+1);\r\n\tf[mid][d]=a[mid];\r\n\tfor(int i=mid-1;i>=l;i--)\r\n\t\tf[i][d]=max(f[i+1][d],a[i]);\r\n\tf[mid+1][d]=a[mid+1];\r\n\tfor(int i=mid+2;i<=r;i++)\r\n\t\tf[i][d]=max(f[i-1][d],a[i]);\r\n}\r\nint lg[maxn*4];\r\nint main(){\r\n    #ifdef LOCAL\r\n    freopen(\"in.txt\",\"r\",stdin);\r\n    freopen(\"out.txt\",\"w\",stdout);\r\n    #endif\r\n    n=readint();\r\n    m=readint();\r\n    for(int i=1;i<=n;i++) a[i]=readint();\r\n    int len=1;\r\n    while(len<n) len*=2;\r\n    build(1,1,len,1);\r\n    lg[0]=lg[1]=0;\r\n    for(int i=2;i<=len*2;i++) lg[i]=lg[i/2]+1;\r\n    while(m--){\r\n    \tint l,r;\r\n    \tl=readint();\r\n    \tr=readint();\r\n    \tif(l==r){\r\n    \t    printf(\"%d\\n\",a[r]);\r\n    \t    continue;\r\n    \t}\r\n    \tint k=lg[pos[r]]-lg[pos[l]^pos[r]];\r\n    \tprintf(\"%d\\n\",max(f[l][k],f[r][k]));\r\n\t}\r\n    return 0;\r\n}\r\n```\r\n\u636e\u8bf4\u732b\u6811\u7684\u672c\u8d28\u662f\u628a\u5206\u6cbb\u7684\u8fc7\u7a0b\u79bb\u7ebf\u4e0b\u6765\u3002\uff08\u6240\u4ee5\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u79bb\u7ebf\u8be2\u95ee\u7136\u540e\u5206\u6cbb\u53ef\u4ee5\u505a\u5230\u7ebf\u6027\u7a7a\u95f4\uff09\r\n\r\n\u53e6\u5916\u8fd8\u6709\u4e00\u79cd\u79d1\u6280\u662f\u5229\u7528\u5206\u5757\u601d\u60f3\uff0c\u6bcf\u5c42\u5206\u6839\u53f7\u4e2a\u5757\uff0c\u53ef\u4ee5\u505a\u5230 $O(n\\log\\log n)+O(1)+O(n\\log\\log n)$\uff0c\u8fd9\u79cd\u79d1\u6280\u53eb\u505a sqrt tree\uff0c\u8ddf\u732b\u6811\u6709\u7c7b\u4f3c\u4e4b\u5904\uff0c\u6211\u6709\u65f6\u95f4\u518d\u8865\u5427\u3002\r\n\r\nlxl \u8fd8\u7ed9\u8fc7\u6211\u4e00\u79cd\u79d1\u6280\uff0c\u4f46\u662f\u2026\u2026\u622a\u56fe\u6211\u5f04\u4e22\u4e86\uff08\u6342\u8138\uff09\u3002\u5927\u6982\u5c31\u662f\u4e5f\u662f\u6309\u7167\u7c7b\u4f3c sqrt tree \u7684\u65b9\u6cd5\u5206\u5757\uff0c\u7136\u540e\u6bcf\u5c42\u5757\u957f\u8bb0\u5f97\u662f $\\log$\uff0c$\\log^{*}$\uff0c$\\log^{**}$ \u8fd9\u6837\u5b50\uff08\u4f3c\u4e4e\uff1f\uff09\uff0c\u5206 $\\alpha(n)$ \u5c42\uff0c\u5c31\u53ef\u4ee5\u505a\u5230 $O(n\\alpha(n))+O(1)+O(n\\alpha(n))$ \u8fd9\u6837\u5b50\uff0c\u662f\u5f88\u5389\u5bb3\u7684\u79d1\u6280\u4e86\u3002\r\n\r\n\u603b\u4e4b\u2026\u2026\u5c31\u8fd9\u6837\u5427\uff0c\u6211\u4eec\u5c31\u7528\u732b\u6811\u6c34\u6389\u4e86 st \u8868\u7684\u6a21\u677f\u9898\uff08\u5927\u96fe\uff09\u3002",
        "postTime": 1584950989,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u5982\u4f55\u7528\u732b\u6811\u6c34\u6389 st \u8868\u6a21\u677f\u9898"
    },
    {
        "content": "## \u9996\u5148\u5949\u4e0aAC\u4ee3\u7801\n\n```cpp\n//ST\u8868 \n#include<cstdio>\n#include<iostream>\nusing namespace std;\nconst int N=100001;\nint i,j,m,n,l,r,lg[N],st[N][22];\n int que(int x,int y)\n {\n \tint z=lg[y-x+1];\n \treturn max(st[x][z],st[y-(1<<z)+1][z]);\n }\nint main()\n{\n    cin>>n>>m;\n    lg[0]=-1;\n    for(i=1;i<=n;++i)\n    {\n        scanf(\"%d\",&st[i][0]);\n        lg[i]=lg[i>>1]+1;\n    }\n    for(j=1;j<22;++j)\n     for(i=1;i+(1<<j)-1<=n;++i)\n      st[i][j]=max(st[i][j-1],st[i+(1<<(j-1))][j-1]);\n    for(i=1;i<=m;++i)\n    {\n        scanf(\"%d%d\",&l,&r);\n        printf(\"%d\\n\",que(l,r));\n    }\n    return 0;\n}\n```\n\n\n------------\u5207\u5165\u6b63\u9898------------\n\n\u6240\u8c13\u7684ST\u8868\uff0c\u5176\u5b9e\u5c31\u662f\u7528\u9012\u5f52~~\uff08\u5176\u5b9e\u6211\u4e5f\u4e0d\u77e5\u9053\u662f\u4ec0\u4e48\uff09~~\u601d\u60f3\u4ee5\u5c3d\u91cf\u5b9e\u73b0O(1)\u7684\u67e5\u8be2\uff08\u6ca1\u9519\u5c31\u662f\u8fd9\u4e48\u795e\u5947\uff09\uff0c\u5f53\u7136\u4e0d\u53ef\u80fd\u76f4\u63a5\u67e5\u8be2\uff0c\u5fc5\u987b\u8981\u5148\u9884\u5904\u7406\u4e00\u4e0b\u3002\n\n#### \u9996\u5148\u58f0\u660e\u51e0\u70b9\uff1a\n\n~~\uff08\u9884\u5907\u533a\uff09~~\n\n1. st[i][j]\u8868\u793a\u8fd9\u6bb5\u533a\u95f4\u4e0a\u4ece\u7b2ci\u4e2a\u4f4d\u7f6e\u81ea\u5df1\u5f00\u59cb\u8d77\uff0c\u5f80\u540e\u65702^i\u4e2a\u6570\u4e4b\u95f4\u7684\u6700\u5927\u503c\n2. lg[i]\u8868\u793a\u4e0d\u8d85\u8fc7i\u7684\u6700\u59272\u6b21\u5e42\u6307\u6570\uff08\u5c31\u662f2\u7684i\u6b21\u65b9\u4e0d\u8d85\u8fc7i\u4e14i\u5c3d\u91cf\u5927\uff09\n3. \u8f93\u51faRMQ\u6700\u503c\u7684\u65f6\u5019\uff0c\u6700\u597d\u7528\u51fd\u6570\u6765\u5199\uff08\u8981\u4e0d\u7136~~\u8d3c\u96be\u5199~~\u8fd8\u4e0d\u597d\u6539\u9519\uff09\n\n## \u7b2c\u4e00\u90e8\u5206\uff1a\u8f93\u5165\u5e76\u9884\u5904\u7406lg\u6570\u7ec4\n\n\u7531\u9884\u5907\u533a1\u53ef\u4ee5\u5f88\u5bb9\u6613\u63a8\u51fa\uff0c\u5bf9\u4e8e\u6211\u4eec\u8f93\u5165\u7684\u6bcf\u4e2a\u6570\uff0c\u5176\u5b9e\u5c31\u662fst[i][0],~~(\u56e0\u4e3a2^0=1 \u5f80\u540e\u65701\u8fd8\u662f\u81ea\u5df1 \u8fd9\u5f88\u663e\u7136\u5427)~~\n\n\u5bf9\u4e8elg\u6570\u7ec4\u5462\uff0c\u56e0\u4e3a\u5b83\u53ea\u6709\u57282\u7684\u6574\u6570\u6b21\u5e42\u7684\u4f4d\u7f6e\u624d\u4f1a\u66f4\u65b0\u51fa\u503c\uff0c\u8fd9\u4e2a\u4e0d\u592a\u597d\u8bb2\uff0c\u5176\u5b9e\u53ef\u4ee5\u4ecelog[0]=-1\u5f00\u59cb\u5f80\u540e\u63a8\u4e00\u4e0b(\u6ce8\uff1ai>>1\uff0ci\u53f3\u79fb1\uff0c\u5373i/2\u3002\u5728\u8fd9\u91cc\u7528\u4f4d\u8fd0\u7b97\u4f1a\u5feb\u5f88\u591a\uff0c\u4eb2\u6d4b)\uff0c\u63a8\u523016\uff0c\u751a\u81f38\u5c31\u80fd\u770b\u51fa\u6765\u4e86\u3002\u8fd9\u4e2alg\u5e38\u6570\u4fbf\u662f\u500d\u589e\u4f18\u5316\u4e86\u3002\n\n\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\uff1a\n```cpp\n    cin>>n>>m;\n    lg[0]=-1;\n    for(i=1;i<=n;++i)\n    {\n        scanf(\"%d\",&st[i][0]);\n        lg[i]=lg[i>>1]+1;\n    }\n```\n\n## \u7b2c\u4e8c\u90e8\u5206\uff1a\u66f4\u65b0\u6700\u503c\n\n\u5927\u5bb6\u53ef\u4ee5\u624b\u753b\u4e2a\u56fe\uff0c\u6ca1\u9519\u5c31\u753b\u4e00\u6761\u7ebf\u6bb5\u3002\u7528\u4e8c\u5206\u7684\u65b9\u6cd5\u628a\u5b83\u8986\u76d6\u4f4f\u3002\u89c2\u5bdf\u6bcf\u6761\u7ebf\u6bb5\u7684\u5de6\u53f3\u7aef\u70b9\u3002\n\nst[i][j]=max(st[i][j-1],st[i+(1<<(j-1))][j-1]);\n\n\u8bf7\u56de\u60f3\u9884\u5907\u533a1\uff0c\u5219\u8fd9\u4e2a\u8f6c\u79fb\u5f0f\u6240\u8868\u8fbe\u7684\u610f\u4e49\u5c31\u662f\uff1a\u4e0d\u59a8\u5047\u8bbe\u4ece\u7b2ci\u4e2a\u4f4d\u7f6e\u5f00\u59cb\uff0c\u5f80\u540e\u65702^(j-1)\u7684\u533a\u95f4\u5185\u7684\u6700\u503c\u4e3am1\uff0c\u5219st[i][j-1]\u8868\u793a\u7684\u5c31\u662fm1\uff1b\u90a3\u7b2c\u4e8c\u6bb5\u533a\u95f4\u7684\u8d77\u70b9\u5373\u4e3a2^(j-1)+1\uff08\u6ce8\u610f\uff01\u8981+1\uff01\uff09\u4f9d\u65e7\u5f80\u540e\u65702^(j-1\uff09\u4e2a\u6570\uff0c\u8be5\u533a\u95f4\u5185\u6700\u503c\u4e3am2\uff0c\u5219st[i][j]\u7684\u503c\u4e3amax(m1,m2)\u3002\n\n\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\uff1a\n```cpp\nfor(j=1;j<22;++j)\n     for(i=1;i+(1<<j)-1<=n;++i)\n      st[i][j]=max(st[i][j-1],st[i+(1<<(j-1))][j-1]);\n```\n\u53c8\u6709\u4eba\u4f1a\u95ee\u4e86\uff0c\u4e3a\u4ec0\u4e48j\u8981\u5728\u5916\u5c42\uff1f\n\n\u89c2\u5bdfst[i][j]\u662f\u600e\u4e48\u5f97\u6765\u7684\uff0c\u8054\u60f3\u4e00\u4e0b\u5b83\u7684\u5177\u4f53\u542b\u4e49\u3002\n\n\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5728for\u5faa\u73af\u751f\u6210st\u8868\u65f6\uff0c\u662f\u6839\u636e\u533a\u95f4\u957f\u5ea6\u7531\u5c0f\u5230\u5927\u9010\u4e2a\u751f\u6210\u7684\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8d77\u59cb\u4f4d\u7f6e\u90fd\u8981\u6c42\u51fa\u80fd\u8986\u76d6\u6574\u6761\u7ebf\u6bb5\u7684\u4e8c\u5206\u65b9\u6cd5\u4e2d\u7684\u6700\u5c0f\u503c\u3002\u53ea\u6709\u524d\u4e00\u4e2a\u4f4d\u7f6e\u7684\u503c\u5168\u90e8\u751f\u6210\u5b8c\u540e\uff0c\u624d\u80fd\u53bb\u5904\u7406\u4e0b\u4e00\u4e2a\u70b9\u3002~~\uff08\u8981\u662f\u5b9e\u5728\u4e0d\u7406\u89e3\u5c31\u6b7b\u8bb0\u4f4f\u5457\uff09~~\n\n\u73b0\u5728\u518d\u56de\u60f3\u4e00\u4e0b\u521a\u624d\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u786e\u5b9e\u80fd\u5b9e\u73b0log\u7ea7\u522b\u7684\u9884\u5904\u7406\u4e86\u3002\n\n## \u7b2c\u4e09\u90e8\u5206\uff1a\u67e5\u8be2\uff08query\uff09\n\n\u67e5\u8be2\u65f6\u53c8\u4f1a\u51fa\u73b0\u5f88\u591a\u95ee\u9898\uff1a\u82e5\u662f\u4ecei^(j-1)+1\u7684\u4f4d\u7f6e\u5f80\u540e\u53d6\u533a\u95f4\u6700\u5c0f\u503c\uff0c\u5f88\u5bb9\u6613\u53d6\u4e0d\u5168\u6216\u8005\u662f\u591a\u53d6\u3002\u6bd4\u5982\u8bf4\u67e5\u8be2\uff081\uff0c7\uff09\uff0c\u8fd4\u56de\u503c\u5e94\u8be5\u662fRMQ([1,4][5,7])\u3002\u95ee\u9898\u6765\u4e86\uff0c\u7b2c\u4e8c\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u662f3\uff0cst\u6570\u7ec4\u7684j\u7a76\u7adf\u8be5\u53d6\u591a\u5c11\uff1f1\uff1f2^1=2\uff0c\u53d6\u4e0d\u5168\uff1b2\uff1f2^2=4\uff0c\u4f1a\u5f80\u540e\u591a\u53d6\u4e86\u4e00\u4e2a\u6570\uff0c\u8fd9\u65f6\u7b54\u6848\u5c31\u4e0d\u5bf9\u4e86\u3002\u600e\u4e48\u89e3\u51b3\u5462\uff1f\n\n\u6211\u4eec\u60f3\u4e00\u4e0b\u521a\u521a\u7684\u95ee\u9898\u6839\u672c\u6240\u5728\uff0c\u662f\u65e0\u6cd5\u786e\u5b9a\u540e\u534a\u533a\u95f4\u5982\u4f55\u8986\u76d6\u3002\u90a3\u4e48\u6211\u4eec~~\u7b80\u5355\u7c97\u66b4\u4e00\u70b9~~\u5e72\u8106\u4ece\u540e\u5f80\u524d\u53d6\uff0c\u8bbe\u53f3\u7aef\u70b9\u4e3ar\uff0c\u90a3st\u6570\u7ec4\u7684\u7b2c\u4e00\u7ef4\u53ef\u4ee5\u5199\u6210r-(2^z)+1\uff0c\u4f9d\u65e7\u8981+1\uff0cz\u5177\u4f53\u4ee3\u8868\u4ec0\u4e48\u540e\u9762\u63ed\u6653\u3002\uff08\u5176\u5b9e\u5f88\u591a\u4eba\u4e5f\u80fd\u770b\u51fa\u6765\u4e86\u5427\uff09\n\n\u4ece\u540e\u5f80\u524d\u53d6\u91cd\u590d\u4e86\u600e\u4e48\u529e\uff1f\u8fd9\u6ca1\u95ee\u9898\uff0c\u53d6\u7684\u662f\u6700\u503c\uff0c\u91cd\u590d\u533a\u95f4\u5e76\u4e0d\u5f71\u54cd\u6700\u503c\u3002\n\n\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\uff1a\n```cpp\nint que(int x,int y)\n {\n \tint z=lg[y-x+1];\n \treturn max(st[x][z],st[y-(1<<z)+1][z]);\n }\n```\nz\u4ee3\u8868\u4ec0\u4e48\u5e94\u8be5\u80fd\u770b\u51fa\u6765\u4e86\u5427\uff0c\u6211\u5c31\u4e0d\u8bb2\u4e86\u3002\n\n\u6700\u540e\u6211\u4eec\u628a\u8fd9\u4e09\u90e8\u5206\u62fc\u8d77\u6765\uff0c~~\u6253\u4e0a\u53d8\u91cf\u548c\u5934\u6587\u4ef6~~\u5c31\u6210\u529fAC\u4e86\uff01\u4e0d\u5438\u6c27\u8fc7\u6700\u5927\u7684\u70b9\u53ea\u9700300+ms\uff01~~300,300,\u53ea\u9700300ms\u5c31\u628aAC\u5e26\u56de\u5bb6\uff0c\u8fd9\u4e48\u5feb\u7684ST\u8868\u7b97\u6cd5\u4f60\u503c\u5f97\u638c\u63e1~~\n\n\n# \u5199\u4e86\u6574\u6574\u4e00\u665a\u4e0a\uff0c\u8dea\u6c42\u7ba1\u7406\u5927\u5927\u901a\u8fc7\uff01",
        "postTime": 1552226376,
        "uid": 183448,
        "name": "Lucaster_",
        "ccfLevel": 0,
        "title": "ST\u8868\u89e3\u6cd5"
    },
    {
        "content": "\u672c\u6587\u4e3b\u8981\u53c2\u8003 https://zhuanlan.zhihu.com/p/79423299\r\n\r\n\u5927\u5bb6\u90fd\u4f1a\u5206\u5757 ST \u8868\u5427\uff1f\r\n\r\n\u5c31\u662f\u628a\u5e8f\u5217\u5206\u5757\uff0c\u6bcf\u5757\u957f\u5ea6 $\\log n$\uff0c\u5bf9\u6bcf\u5757\u7684\u6700\u5927\u503c\u5efa ST \u8868\uff0c\u7ef4\u62a4\u6bcf\u5757\u7684\u524d\u7f00\u540e\u7f00 $\\max$\u3002\u6bcf\u6b21\u8be2\u95ee\u7684\u6563\u5757\u53ef\u4ee5\u524d\u540e\u7f00 $\\max$\uff0c\u6574\u5757\u53ef\u4ee5 ST \u8868\u3002\r\n\r\n\u4f46\u662f\u8fd9\u6837\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5f53 $l,r$ \u843d\u5728\u540c\u4e00\u5757\u7684\u65f6\u5019\u6ca1\u6709\u7ef4\u62a4\u3002\r\n\r\n\u4e8b\u5b9e\u4e0a\u6700\u5e7f\u4e3a\u4eba\u77e5\u7684\u7b97\u6cd5 $\\pm1$ RMQ \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u901a\u8fc7\u5efa\u7acb\u7b1b\u5361\u5c14\u6811\u8f6c\u5316\u4e3a lca \u95ee\u9898\uff0c\u7136\u540e\u901a\u8fc7\u6b27\u62c9\u5e8f\u6c42 lca \u65b9\u6cd5\u8f6c\u5316\u4e3a\u76f8\u90bb\u4e24\u9879\u76f8\u5dee\u4e3a $\\pm1$ \u7684\u7279\u6b8a RMQ\u3002\r\n\r\nupd\uff1a\r\n\r\n\u611f\u8c22\u4e0a\u9762\u77e5\u4e4e\u6587\u7ae0\u4f5c\u8005 hqztrue \u56de\u590d\uff0c\u642c\u8fd0 TA \u7684\u4e00\u53e5\u8bdd\uff08\u5bf9 $\\pm1$ RMQ \u7684\u89e3\u91ca\uff09\uff1a\r\n\r\n>\u79f0\u00b11RMQ\u7684\u4e24\u4e2a\u5757\u672c\u8d28\u4e0d\u540c\uff0c\u5982\u679c\u5b83\u4eec\u76f8\u90bb\u4f5c\u5dee\u540e\u5f62\u6210\u7684\u00b11\u6570\u5217\u4e0d\u540c(\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u6574\u4f53\u5e73\u79fb\u4e00\u4e2a\u6570\uff0ce.g. [1,2,3]\u548c[4,5,6]\u672c\u8d28\u76f8\u540c\uff0c\u56e0\u4e3a\u76f8\u90bb\u4f5c\u5dee\u540e\u7684\u6570\u5217\u4e3a[1,1])\u3002\u672c\u8d28\u76f8\u540c\u7684\u4e24\u4e2a\u5757\u5bf9\u4e8e\u4efb\u610f\u8be2\u95ee\u7684\u7b54\u6848\u6240\u5728\u4f4d\u7f6e\u90fd\u662f\u76f8\u540c\u7684\u3002\r\n\r\n\u7136\u540e\u5757\u957f\u4e3a $\\frac {\\log n} 2$\uff0c\u5219\u5171\u6709 $2^{\\frac {\\log n} 2}=\\sqrt n$ \u4e2a\u672c\u8d28\u4e0d\u540c\u7684\u5757\uff0c\u5bf9\u8fd9\u4e9b\u5757\u7684\u6bcf\u4e2a\u5b50\u6bb5\u5904\u7406\uff0c\u603b\u590d\u6742\u5ea6 $\\sqrt n\\log ^2 n$\u3002\u518d\u628a\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e00\u5757\u6620\u5c04\u5230\u5bf9\u5e94\u7684\u672c\u8d28\u4e0d\u540c\u7684\u5757\u4e0a\u3002\r\n\r\n\u4f46\u662f\u76ee\u6d4b\u8fd9\u6837\u5e38\u6570\u5f88\u5927\uff08\u5757\u957f\u8fc7\u5c0f\u5bfc\u81f4 ST \u8868\u8fc7\u5927\uff0ccache miss \u4e25\u91cd\uff09\u3002\r\n\r\n\u6211\u4eec\u5148\u6765\u56de\u5fc6\u4e00\u4e0b\u5355\u8c03\u6808\uff08\u5355\u8c03\u9012\u51cf\uff09\u7684\u6027\u8d28\uff1a\r\n\r\n\u4e0b\u6807\u5355\u8c03\u9012\u589e\uff0c\u4e0b\u6807\u5bf9\u5e94\u7684\u5143\u7d20\u5355\u8c03\u9012\u51cf\uff08\u5e9f\u8bdd\uff09\r\n\r\n\u8fd8\u5bb9\u6613\u5f97\u5230\uff0c\u8bbe\u5355\u8c03\u6808\uff08\u5bf9\u4e8e\u6574\u4e2a\u5e8f\u5217\u7684\u5355\u8c03\u6808\uff09\u5185\u5143\u7d20\u4e3a $p_1\\dots p_{size}$\uff0c\u5e8f\u5217\u4e3a $a$\uff0c\u5e8f\u5217\u957f\u5ea6\u4e3a $n$\uff0c\u5219 $a_{p_1}$ \u4e3a $[1,n]$ \u7684\u6700\u5927\u503c\uff0c$a_{p_2}$ \u4e3a $[p_1+1,n]$ \u7684\u6700\u5927\u503c\u2026\u2026\u5bf9\u4e8e $p_i(1<i\\le size)$\uff0c$a_{p_i}$ \u4e3a $[p_{i-1}+1,n]$ \u7684\u6700\u5927\u503c\u3002\r\n\r\n\u6bd4\u5982\u4e0b\u9762\u7684\u8868\uff0c\u663e\u793a\u51fa\u4e86 $[1\\dots n]$ \u65f6\u523b\u7684\u5355\u8c03\u6808\u3002\r\n\r\n```\r\na:1 3 5 2 4\r\n1:1\r\n2:2\r\n3:3\r\n4:3 4\r\n5:3 5\r\n```\r\n\u73b0\u5728\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u7528\u4e0a\u9762\u7684\u5355\u8c03\u6808\u6c42\u51fa $[2,4]$ \u7684\u6700\u5927\u503c\uff1f\r\n\r\n\u6211\u4eec\u627e\u5230\u7b2c $4$ \u65f6\u523b\u7684\u5355\u8c03\u6808\uff0c\u7b2c\u4e00\u4e2a $\\ge 2$ \u7684\u6570 $p_i=3$\uff0c$a_{p_i}=5$ \u5373\u4e3a\u7b54\u6848\u3002\r\n\r\n\u4e00\u822c\u7684\uff0c\u5bf9\u4e8e\u533a\u95f4 $[l,r]$\uff0c\u6211\u4eec\u627e\u5230 $r$ \u65f6\u523b\u7684\u5355\u8c03\u6808\u4e2d\u7b2c\u4e00\u4e2a $\\ge l$ \u7684 $p_i$\uff0c$a_{p_i}$ \u5373\u4e3a\u7b54\u6848\u3002\r\n\r\n\u56e0\u4e3a\u8fd9\u4e2a\u6570\u4e00\u5b9a\u5728 $[l,r]$ \u8303\u56f4\u5185\uff0c\u4e14\u5b83\u8868\u793a $[p_{i-1}+1,r]$ \u7684\u6700\u5927\u503c\u3002\u56e0\u4e3a $p_i$ \u662f\u7b2c\u4e00\u4e2a $\\ge l$ \u7684\u6570\uff0c\u6240\u4ee5 $p_{i-1}<l$\uff0c$p_{i-1}+1\\le l$\uff0c\u5373 $[p_{i-1}+1,r]$ \u5305\u542b\u4e86 $[l,r]$\uff0c\u6545\u800c\u7b97\u6cd5\u6b63\u786e\u3002\r\n\r\n\u6211\u4eec\u5728\u5757\u5185\u4f7f\u7528\u8fd9\u4e2a\u7b97\u6cd5\u5373\u53ef\u3002\r\n\r\n\u7b2c\u4e00\u4e2a\u95ee\u9898\uff1a\u65e0\u6cd5\u5b58\u4e0b\u6240\u6709\u7684\u5355\u8c03\u6808\uff0c\u5426\u5219\u4f1a\u9000\u5316\u4e3a $\\log^2 n$ \u7684\u3002\r\n\r\n\u6211\u4eec\u91c7\u53d6**\u72b6\u6001\u538b\u7f29**\u7684 trick\u3002\u4e00\u822c\u8ba4\u4e3a\uff08word-RAM model\uff09\u8ba1\u7b97\u673a\u5b57\u957f $w\\ge \\log n$\uff0cint \u7684\u4f4d\u6570\u4e0e $w$ \u76f8\u540c\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a\u4e0b\u6807\u5728 $\\log n$ \u89c4\u6a21\u7684\u5355\u8c03\u6808\u538b\u7f29\u5728\u4e00\u4e2a int \u5185\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cint \u7684\u4e0a\u754c $\\ge n$\u3002\r\n\r\n\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1a\u72b6\u6001\u538b\u7f29\u540e\uff0c\u5982\u4f55\u6c42\u7b2c\u4e00\u4e2a $\\ge l$ \u7684\u6570\uff1f\r\n\r\n\u6211\u4eec\u4f7f\u7528 `l+__builtin_ctz(st[r]>>l)`\u3002\r\n\r\n\u89e3\u91ca\u4e00\u4e0b\uff0c`__builtin_ctz(x)` \u8868\u793a\u6c42 $x$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4ece\u672b\u5c3e\u5f00\u59cb $0$ \u7684\u4e2a\u6570\uff0c`st` \u8868\u793a\u72b6\u6001\u538b\u7f29\u7684\u5355\u8c03\u6808\u6570\u7ec4\u3002`st[r]>>l` \u5c06 $[0\\dots l-1]$ \u7684\u4e8c\u8fdb\u5236\u4f4d\u53bb\u9664\uff0c\u53ea\u4fdd\u7559 $[l\\dots r]$ \u7684\u4e8c\u8fdb\u5236\u4f4d\u3002\u8bbe\u8981\u6c42\u51fa\u6765\u7684\u6570\u4e3a $v$\uff0c\u5219\u672b\u5c3e\u5e94\u5f53\u6709 $v-l$ \u4e2a $0$\uff0c\u52a0\u4e0a $l$ \u540e\u6b63\u786e\u7684\u6c42\u51fa\u4e86 $v$\u3002\r\n\r\n[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/xynn9r9k)\r\n\r\n\u4ee5\u4e0a\u3002",
        "postTime": 1614477346,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u63a8\u5e7f\u4e00\u79cd\u5e38\u6570\u8f83\u5c0f\uff0c\u7801\u91cf\u4e0d\u5927\u7684 O(n)-O(1) RMQ"
    },
    {
        "content": "\u8981\u8bb2\u7684\u5185\u5bb9\uff1a\u7b1b\u5361\u5c14\u6811\uff0c\u6811\u7684\u6b27\u62c9\u5e8f\uff0cST \u8868\uff0c\u5206\u5757 RMQ\uff0c$\\pm1$RMQ\u3002\n\n## \u7b1b\u5361\u5c14\u6811\n\n\u7b1b\u5361\u5c14\u6811\u662f\u4e8c\u53c9\u6811\u7684\u4e00\u79cd\uff0c\u6bcf\u4e2a\u8282\u70b9\u6709\u4e24\u4e2a\u5173\u952e\u5b57\uff0c\u5206\u522b\u6ee1\u8db3\u5806\u548c\u4e8c\u53c9\u641c\u7d22\u6811\u7684\u6027\u8d28\u3002\u4e00\u4e2a\u5e8f\u5217\u4e0a\u7684\u7b1b\u5361\u5c14\u6811\u7684\u4e24\u4e2a\u5173\u952e\u5b57\u5c31\u662f\u503c\u548c\u4e0b\u6807\uff08\u5176\u5b9e\u53ef\u4ee5\u7528 Treap \u6765\u7406\u89e3\uff09\uff0c\u5982\u4e0b\uff08\u5806\u662f\u5c0f\u6839\u5806\uff09\uff1a\n\n![](https://oi-wiki.org/ds/images/cartesian-tree1.png)\n\n\u56fe\u7247\u5f15\u7528\u81ea OI-wiki\u3002\n\n\u901a\u8fc7\u7b1b\u5361\u5c14\u6811\u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5efa\u6811\u65b9\u5f0f\uff0c\u5bf9\u4e8e $[l,r]$  \u7684\u7b1b\u5361\u5c14\u6811\uff0c\u5148\u627e\u5230\u6700\u503c\u7684\u4f4d\u7f6e $p$\uff0c$p$ \u5373\u4e3a\u8fd9\u68f5\u6811\u7684\u6839\u3002\u5728\u5c06 $[l,p-1]$ \u7684\u7b1b\u5361\u5c14\u6811\u4f5c\u4e3a\u5de6\u5b50\u6811\uff0c$[p+1,r]$ \u7684\u7b1b\u5361\u5c14\u6811\u4f5c\u4e3a\u53f3\u5b50\u6811\u3002\u8fd9\u4e2a\u5efa\u6811\u65b9\u5f0f\u8868\u660e\u4e00\u4e2a\u8282\u70b9\u7684\u5de6/\u53f3\u5b50\u6811\u7684\u4e0b\u6807\u53ea\u80fd\u5728\u8fd9\u4e2a\u8282\u70b9\u7684\u4e0b\u6807\u7684\u5de6 / \u53f3\u3002\n\n\u7b1b\u5361\u5c14\u6811\u6709\u4e00\u4e2a\u7f8e\u5999\u7684\u6027\u8d28\uff0c\u5c31\u662f\u5bf9\u4e8e\u4e24\u4e2a\u4e0b\u6807\u4e3a $l$ \u548c $r$ \u7684\u8282\u70b9\uff0c$[l,r]$ \u7684\u6700\u503c\u5c31\u662f $l$ \u548c $r$ \u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684\u503c\u3002\n\n\u6211\u4eec\u6765\u8bd5\u7740\u8bc1\u660e\u8fd9\u4e2a\u6027\u8d28\uff08\u4e0b\u9762 $l$ \u8282\u70b9\u6307\u7684\u662f\u4e0b\u6807\u4e3a $l$ \u7684\u8282\u70b9\uff09\u3002\n\n\u5b9a\u7406 $1$:$[l,r]$ \u7684\u6700\u503c\u5c31\u662f $l$ \u548c $r$ \u5728\u7b1b\u5361\u5c14\u6811\u4e0a\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684\u503c\u3002\n\n\u8bc1\uff1a\u82e5 $l$ \u8282\u70b9\u548c $r$ \u8282\u70b9\u90fd\u5728\u4ed6\u4eec LCA \u7684\u5de6 / \u53f3\u5b50\u6811\uff0c\u90a3\u4e48\u8fd9\u4e0eLCA\u7684\u5b9a\u4e49\u77db\u76fe\u3002\u663e\u7136\uff0c$l$ \u8282\u70b9\u548c $r$ \u8282\u70b9\u7684 LCA \u662f\u5176\u5b50\u6811\u4e2d\u7684\u6700\u503c\u5e76\u4e14\u6db5\u76d6\u4e86 $[l,r]$ \u8fd9\u4e2a\u533a\u95f4\uff0c\u4e8e\u662f\u8fd9\u4e2a\u6027\u8d28\u5c31\u5f97\u8bc1\u4e86\u3002\u8fd9\u5728 RMQ \u8f6c LCA \u95ee\u9898\u65f6\u6709\u5f88\u5927\u7684\u7528\u5904\u3002\n\n\u5173\u4e8e\u7b1b\u5361\u5c14\u6811\u7684\u6784\u5efa\uff0c\u53ef\u4ee5\u53c2\u8003 [P5854](https://www.luogu.com.cn/problem/P5854)\uff0c\u5177\u4f53\u5c31\u662f\u7ef4\u62a4\u53f3\u94fe\uff0c\u5bf9\u4e8e\u65b0\u63d2\u5165\u7684\u503c\uff0c\u627e\u5230\u53f3\u94fe\u4e0a\u7b2c\u503c\u4e00\u4e2a\u5c0f\u4e8e\u5b83\u7684\u8282\u70b9\uff0c\u53d8\u6210\u5b83\u7684\u53f3\u513f\u5b50\uff0c\u5b83\u539f\u6765\u7684\u53f3\u513f\u5b50\u53d8\u4e3a\u5b83\u7684\u5de6\u513f\u5b50\u3002\u6ca1\u6709\u8fd9\u4e2a\u8282\u70b9\uff0c\u76f4\u63a5\u53d8\u4e3a\u6839\uff0c\u539f\u6765\u7684\u6811\u53d8\u6210\u5b83\u7684\u5de6\u5b50\u6811\u3002\n\n\u6838\u5fc3\u4ee3\u7801\uff1a\n\n```cpp\nfor(int i=1;i<=n;i++){\n\t\tk=top;\n\t\twhile(k>0&&a[s[k]]>a[i])k--;\n\t\tif(k)rs[s[k]]=i;\n\t\tif(k<top)ls[i]=s[k+1];\n\t\ts[++k]=i;\n\t\ttop=k;\n\t}\n```\n\n\u7b1b\u5361\u5c14\u6811\u5176\u5b9e\u53ef\u4ee5\u4ece\u6839\u66b4\u529b\u5f80\u4e0b\u8df3\u76f4\u5230\u627e\u5230\u5728 $[l,r]$ \u4e4b\u95f4\u7684\u8282\u70b9\u3002\u8fd9\u6837\u505a\u662f $O(nm)$ \u7684\uff0c\u4f46\u968f\u673a\u6570\u636e\u4e0b\u6bd4\u8f83\u5feb\u3002\u5982 [P3793](https://www.luogu.com.cn/problem/P3793)\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define N 20000005\nusing namespace std;\nint n,a[N],s[N],top,ls[N],rs[N],k,x,root,m,_s,l,r;\nlong long ans;\nint query(int rt,int l,int r) {\n\twhile(rt<l||rt>r) {\n\t\tif(rt<l)rt=rs[rt];\n\t\telse rt=ls[rt];\n\t}\n\treturn rt;\n}\nnamespace GenHelper {\n\tunsigned z1,z2,z3,z4,b;\n\tunsigned rand_() {\n\t\tb=((z1<<6)^z1)>>13;\n\t\tz1=((z1&4294967294U)<<18)^b;\n\t\tb=((z2<<2)^z2)>>27;\n\t\tz2=((z2&4294967288U)<<2)^b;\n\t\tb=((z3<<13)^z3)>>21;\n\t\tz3=((z3&4294967280U)<<7)^b;\n\t\tb=((z4<<3)^z4)>>12;\n\t\tz4=((z4&4294967168U)<<13)^b;\n\t\treturn (z1^z2^z3^z4);\n\t}\n}\nvoid srand(unsigned x) {\n\tusing namespace GenHelper;\n\tz1=x;\n\tz2=(~x)^0x233333333U;\n\tz3=x^0x1234598766U;\n\tz4=(~x)+51;\n}\nint read() {\n\tusing namespace GenHelper;\n\tint a=rand_()&32767;\n\tint b=rand_()&32767;\n\treturn a*32768+b;\n}\nint main() {\n\tscanf(\"%d%d%d\",&n,&m,&_s);\n\tsrand(_s);\n\tfor(int i=1; i<=n; i++)a[i]=-read();\n\tfor(int i=1; i<=n; i++) {\n\t\tk=top;\n\t\twhile(k>0&&a[s[k]]>a[i])k--;\n\t\tif(k)rs[s[k]]=i;\n\t\tif(k<top)ls[i]=s[k+1];\n\t\ts[++k]=i;\n\t\ttop=k;\n\t}\n\troot=s[1];\n\twhile(m--) {\n\t\tl=read()%n+1,r=read()%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tans-=a[query(root,l,r)];\n\t}\n\tcout<<ans<<endl;\n}\n```\n\n## \u6811\u7684\u6b27\u62c9\u5e8f\n\n\u6811\u7684\u6b27\u62c9\u5e8f\u5c31\u662f\u5728 DFS \u65f6\uff0c\u65e0\u8bba\u662f\u8bbf\u95ee\u5230\u8fd8\u662f\u56de\u6eaf\u65f6\uff0c\u90fd\u8bb0\u5f55\u4e00\u904d\u70b9\u3002\u8fd9\u4e48\u8bf4\u53ef\u80fd\u4e0d\u7406\u89e3\uff0c\u653e\u4ee3\u7801\u66f4\u76f4\u89c2\u4e00\u70b9\u3002\n\n```cpp\nvoid dfs(int now,int fa) {\n\te[++cnt]=now;//e[i]\u8868\u793a\u6b27\u62c9\u5e8f\u91cc\u7b2ci\u4e2a\u8282\u70b9\u662f\u4ec0\u4e48\n\tfi[now]=cnt;//fi[now]\u8868\u793anow\u8282\u70b9\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\n\tfor(int i=ve[now].size()-1; i>=0; i--) {\n\t\tint y=ve[now][i];\n\t\tif(y==fa)continue;\n\t\tdep[y]=dep[now]+1;\n\t\tdfs(y,now);\n\t\te[++cnt]=now;//\u56de\u6eaf\u65f6\u8bb0\u5f55\n\t}\n}\n```\n\n\u4ece\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff0c\u6811\u7684\u6b27\u62c9\u5e8f\u957f\u70b9\u6570\u52a0\u8fb9\u6570 $=2n-1$\u3002\n\n\u7406\u89e3\u4e86\u6811\u7684\u6b27\u62c9\u5e8f\u4e4b\u540e\uff0c\u6211\u4eec\u6765\u770b\u5b83\u6709\u4ec0\u4e48\u6027\u8d28\u53ef\u4ee5\u5229\u7528\u3002\n\n\u5b9a\u7406 $2$\uff1a$i$ \u548c $j$ \u4e24\u4e2a\u8282\u70b9\u7684 LCA \u5c31\u662f $i$ \u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u548c $j$ \u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e4b\u95f4\u6df1\u5ea6\u6700\u5c0f\u7684\u90a3\u4e2a\u70b9\u3002\n\n\u8bc1\uff1a\u5f53 $i=j$ \u65f6\u663e\u7136\u3002\n\n\u82e5 $i$ \u548c $j$ \u4e2d\u6709\u4e00\u4e2a\u662f\u5b83\u4eec\u7684 LCA \uff0c\u90a3\u4e48\u5728\u8fdb\u5165\u4e0d\u662f LCA \u7684\u90a3\u4e2a\u8282\u70b9\u65f6\u5230\u7b2c\u4e00\u6b21\u8fdb\u5165 LCA\uff0c\u53ea\u4f1a\u904d\u5386\u5230 LCA \u5b50\u6811\u4e2d\u7684\u8282\u70b9\u91cc\u3002\u6240\u4ee5\u6df1\u5ea6\u6700\u5c0f\u7684\u70b9\u5c31\u662f LCA\u3002\n\n\u5982\u679c $i$ \u548c $j$ \u4e2d\u6ca1\u6709\u4e00\u4e2a\u662f\u5b83\u4eec\u7684 LCA\uff0c\u90a3\u4e48\u5b83\u4eec\u80af\u5b9a\u5728 LCA\u7684\u4e0d\u540c\u513f\u5b50\u7684\u5b50\u6811\u5185\u3002\u904d\u5386\u5b8c\u4e00\u4e2a\u4f1a\u56de\u6eaf\u5230 LCA\uff0c\u5e76\u4e14\u56e0\u4e3a\u4e0b\u9762\u8fd8\u6709\u8282\u70b9\u8981\u904d\u5386\uff0c\u4e0d\u4f1a\u56de\u5230\u7956\u5148\u3002\u4e8e\u662f\u5b9a\u7406\u5f97\u8bc1\u3002\n\n\u8fd9\u6837\uff0cLCA \u548c RMQ \u8fd9\u4e24\u4e2a\u95ee\u9898\u5c31\u53d8\u5f97\u7b49\u4ef7\u4e86\u3002\n\n\u6b27\u62c9\u5e8f\u8fd8\u6709\u4e00\u4e2a\u6027\u8d28\uff0c\u5c31\u662f\u5e8f\u5217\u4e2d\u76f8\u90bb\u8282\u70b9\u7684\u6df1\u5ea6\u5dee\u4e3a $\\pm1$\uff0c\u8fd9\u4e2a\u5f88\u663e\u7136\uff0c\u4f1a\u5728\u4ee5\u540e\u8bb2\u5230\u3002\n\n## ST \u8868\n\nST\u8868\u7684\u6838\u5fc3\u601d\u60f3\u662f\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e $p$\uff0c\u9884\u5904\u7406 $[p,p+2^0-1]$\uff0c$[p,p+2^1-1]$\uff0c$[p,p+2^2-1]$\uff0c$[p,p+2^3-1]$... \u7684\u6700\u503c\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $[l,r]$ \u7684\u8be2\u95ee\uff0c\u8f93\u51fa $\\max/\\min(ST[l][k],ST[r-2^k+1][k])$ \uff08$ST[p][k]$ \u8868\u793a $\\max\\limits_{l \\le i \\le p+2^k-1}/\\min \\limits_{l \\le i \\le p+2^k-1} a_i$ \uff09\u3002\u8fd9\u91cc  $k=\\log_2 (r-l+1)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,a,b;\nint Max[100005][21];\ninline int query(int l,int r) {\n\tregister int k=log2(r-l+1);\n\treturn max(Max[l][k],Max[r-(1<<k)+1][k]);\n}\ninline int read() {\n\tregister int x=0;\n\tregister char ch=getchar();\n\twhile(ch<'0'||ch>'9')ch=getchar();\n\twhile(ch>='0'&&ch<='9')\n\t\tx=(x<<3)+(x<<1)+(ch-'0'),ch=getchar();\n\treturn x;\n}\nint main() {\n\tscanf(\"%d%d\",&n,&m);\n\tfor(register int i=1; i<=n; i++)Max[i][0]=read();\n\tfor(register int j=1; j<=21; j++)\n\t\tfor(register int i=1; i+(1<<j)-1<=n; i++)\n\t\t\tMax[i][j]=max(Max[i][j-1],Max[i+(1<<(j-1))][j-1]);\n\tfor(register int i=1; i<=m; i++) {\n\t\ta=read(),b=read();\n\t\tprintf(\"%d\\n\",query(a,b));\n\t}\t\n}\n```\n\n## \u5206\u5757 RMQ\n\n\u5206\u5757 RMQ \u662f\u8ba1\u7b97 RMQ \u7684\u4e00\u79cd\u601d\u60f3\uff0c\u5176\u4e00\u822c\u4e0e ST \u8868\u7b49\u6570\u636e\u7ed3\u6784\u914d\u5408\u4f7f\u7528\u3002\u8fd9\u91cc\u5148\u8bb2 $\\log_2n$ \u548c $\\sqrt{n}$ \u4e24\u79cd\u5757\u957f\u3002\u6700\u540e\u7684 +1-1RMQ \u7528\u7684\u5219\u662f $\\frac{\\log_2n}{2}$ \u7684\u5757\u957f\u3002\n\n\u5148\u770b $\\log_2n$\uff08 Four Russian \u7b97\u6cd5\uff0c\u6709\u4eba\u53eb\u5b83\u56db\u6bdb\u5b50\uff09\u3002\u6211\u4eec\u5bf9\u4e8e\u6574\u5757\uff0c\u9884\u5904\u7406\u6574\u5757\u7684\u6700\u503c\u3002\u518d\u76f4\u63a5\u7528 ST \u8868\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\frac{n}{\\log n} \\log(\\frac{n}{\\log n}))=O(n)$\u3002\u5bf9\u4e8e\u5757\u5185\uff0c\u4e5f\u7528 ST \u8868\u9884\u5904\u7406,\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\frac{n}{\\log n} \\log \\log n)=O(n \\log \\log n)$\uff0c\u67e5\u8be2\u65f6\u5bf9\u6574\u5757\u548c\u96f6\u6563\u5feb\u5206\u522b $O(1)$ \u67e5\u8be2\u3002\n\n[P3793](https://www.luogu.com.cn/problem/P3793) \u4ee3\u7801\uff08\u88ab\u5361\u4e86\uff0c\u53ea\u80fd\u8fc7 $n=1.5*10^7$\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define N 20001005\nusing namespace std;\nint n,m,s,a[1000005],l,r,B,ST1[900000][26],ST2[900000][26][5],cnt;\nlong long ans;\nnamespace GenHelper {\n\tunsigned z1,z2,z3,z4,b;\n\tunsigned rand_() {\n\t\tb=((z1<<6)^z1)>>13;\n\t\tz1=((z1&4294967294U)<<18)^b;\n\t\tb=((z2<<2)^z2)>>27;\n\t\tz2=((z2&4294967288U)<<2)^b;\n\t\tb=((z3<<13)^z3)>>21;\n\t\tz3=((z3&4294967280U)<<7)^b;\n\t\tb=((z4<<3)^z4)>>12;\n\t\tz4=((z4&4294967168U)<<13)^b;\n\t\treturn (z1^z2^z3^z4);\n\t}\n}\nvoid srand(unsigned x) {\n\tusing namespace GenHelper;\n\tz1=x;\n\tz2=(~x)^0x233333333U;\n\tz3=x^0x1234598766U;\n\tz4=(~x)+51;\n}\nint read() {\n\tusing namespace GenHelper;\n\tint a=rand_()&32767;\n\tint b=rand_()&32767;\n\treturn a*32768+b;\n}\nint query1(int l,int r) {\n\tif(l>r)return 0;\n\tint k=a[r-l+1];\n\treturn max(ST1[l][k],ST1[r-(1<<k)+1][k]);\n}\nint query2(int p,int l,int r) {\n\tint k=a[r-l+1];\n\treturn max(ST2[p][l][k],ST2[p][r-(1<<k)+1][k]);\n}\nint query(int l,int r) {\n\tint L=(l-1)/B+1,R=(r-1)/B+1,res=0;\n\tif(L==R)return query2(L,((l-1)%B)+1,((r-1)%B)+1);\n\tres=query1(L+1,R-1);\n\tres=max(res,query2(L,((l-1)%B)+1,B));\n\tres=max(res,query2(R,1,((r-1)%B)+1));\n\treturn res;\n}\nint main() {\n\tcin>>n>>m>>s;\n\tB=log2(n);\n\tcnt=(n-1)/B+1;\n\tsrand(s);\n\tfor(int i=1; i<=n; i++) {\n\t\ta[0]=read();\n\t\tint now=(i-1)/B+1;\n\t\tif(a[0]>ST1[now][0])ST1[now][0]=a[0];\n\t\tST2[now][i-now*B+B][0]=a[0];\n\t}\n\tfor(int j=1; (1<<j)<=cnt; j++)\n\t\tfor(int i=1; i<=cnt; i++)\n\t\t\tST1[i][j]=max(ST1[i][j-1],ST1[i+(1<<(j-1))][j-1]);\n\tfor(int i=1; i<=cnt; i++)\n\t\tfor(int j=1; (1<<j)<=B; j++)\n\t\t\tfor(int k=1; k<=B; k++)\n\t\t\t\tST2[i][k][j]=max(ST2[i][k][j-1],ST2[i][k+(1<<(j-1))][j-1]);\n\ta[0]=a[1]=0;\n\tfor(int i=2; i<=1000000; i++)a[i]=a[i>>1]+1;\n\twhile(m--) {\n\t\tl=read()%n+1,r=read()%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tans+=query(l,r);\n\t}\n\tcout<<ans<<endl;\n}\n```\n\n\n\u5176\u5b9e\u8fd9\u79cd\u505a\u6cd5\u53ef\u4ee5\u53cd\u590d\u5206\u5757\uff0c\u4f46\u8fd9\u6837\u6ca1\u6709\u4ec0\u4e48\u7528\uff0c\u5e38\u6570\u8fd8\u5927\u3002\n\n$\\sqrt{n}$ \u5757\u957f\u7684\u5c31\u6bd4\u8f83\u7384\u5b66\u4e86\uff0c\u5bf9\u4e8e\u6574\u5757\uff0c\u76f4\u63a5\u66b4\u529b  $O(\\sqrt{n}^2)$ \u9884\u5904\u7406\uff0c\u5757\u5185\u53ea\u9884\u5904\u7406\u524d\u540e\u7f00\u6700\u503c\uff0c\u8fd9\u6837\uff0c$l$  \u548c $r$ \u4e0d\u5728\u540c\u4e00\u5757\u7684\u60c5\u5f62\u5c31\u5728 $O(1)$ \u7684\u65f6\u95f4\u89e3\u51b3\u4e86\u3002\u5bb9\u6613\u53d1\u73b0\uff0c$l$ \u548c $r$ \u5728\u540c\u4e00\u5757\u7684\u6982\u7387\u5927\u6982\u662f $\\frac{1}{\\sqrt{n}}$ \u7684\uff0c$m$ \u6b21\u8be2\u95ee\u8fd9\u79cd\u60c5\u51b5\u8fd0\u884c $O(\\frac{m}{\\sqrt{n}}\\sqrt{n})=O(m)$\uff0c\u4e8e\u662f\u8fd9\u79cd\u505a\u6cd5\u5728\u968f\u673a\u6570\u636e\u4e0b\u5c31\u662f\u7ebf\u6027\u7684\uff0c\u4f46\u4e0a\u754c\u5176\u5b9e\u662f $O(m \\sqrt{n})$ \u7684\u3002\u8fd9\u6837\u4e5f\u53ef\u4ee5\u901a\u8fc7 [P3793](https://www.luogu.com.cn/problem/P3793)\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define max Max\nusing namespace std;\nint n,m,s,a[20000005],max1[2][5005][5005],max2[5005][5005];\nint block,begin[1000005],end[1000005],l,r,num;\nlong long ans;\nnamespace GenHelper {\n\tunsigned z1,z2,z3,z4,b;\n\tunsigned rand_() {\n\t\tb=((z1<<6)^z1)>>13;\n\t\tz1=((z1&4294967294U)<<18)^b;\n\t\tb=((z2<<2)^z2)>>27;\n\t\tz2=((z2&4294967288U)<<2)^b;\n\t\tb=((z3<<13)^z3)>>21;\n\t\tz3=((z3&4294967280U)<<7)^b;\n\t\tb=((z4<<3)^z4)>>12;\n\t\tz4=((z4&4294967168U)<<13)^b;\n\t\treturn (z1^z2^z3^z4);\n\t}\n}\ninline void srand(unsigned x) {\n\tusing namespace GenHelper;\n\tz1=x;\n\tz2=(~x)^0x233333333U;\n\tz3=x^0x1234598766U;\n\tz4=(~x)+51;\n}\ninline int read() {\n\tusing namespace GenHelper;\n\tint a=rand_()&32767;\n\tint b=rand_()&32767;\n\treturn a*32768+b;\n}\ninline int max(int a,int b) {\n\treturn a>b?a:b;\n}\nvoid build() {\n\tblock=sqrt(n);\n\tfor(int i=1; i<=n; i+=block) {\n\t\tbegin[++num]=i,end[num]=min(n,i+block-1);\n\t\tfor(int j=i; j<=end[num]; j++)\n\t\t\tmax1[0][num][j-i+1]=max(max1[0][num][j-i],a[j]);\n\t\tfor(int j=end[num]; j>=i; j--)\n\t\t\tmax1[1][num][end[num]-j+1]=max(max1[1][num][end[num]-j],a[j]);\n\t}\n\tfor(int i=1; i<=num; i++) {\n\t\tfor(int j=i; j<=num; j++) {\n\t\t\tmax2[i][j]=max2[i][j-1];\n\t\t\tmax2[i][j]=max(max2[i][j],max1[0][j][end[j]-begin[j]+1]);\n\t\t}\n\t}\n}\nint query(int l,int r){\n\tint numl=(l/block)+(l%block!=0);\n\tint numr=(r/block)+(r%block!=0);\n\tint res=0;\n\tif(numl==numr){\n\t\tfor(int i=l;i<=r;i++)res=max(res,a[i]);\n\t\treturn res;\n\t}\n\tres=max(max1[1][numl][end[numl]-l+1],max1[0][numr][r-begin[numr]+1]);\n\treturn max(max2[numl+1][numr-1],res);\n}\nint main() {\n\tscanf(\"%d%d%d\",&n,&m,&s);\n\tsrand(s);\n\tfor(int i=1; i<=n; i++)a[i]=read();\n\tbuild();\n\twhile(m--){\n\t\tl=read()%n+1,r=read()%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tans+=(unsigned long long)query(l,r);\n\t}\n\tcout<<ans;\n}\n```\n## $\\pm1$RMQ\n\n\u91cd\u70b9\u6765\u4e86\u3002\n\n\u4e0a\u6587\u63d0\u5230\uff0c\u6b27\u62c9\u5e8f\u4e2d\u76f8\u90bb\u7684\u4e24\u4e2a\u8282\u70b9\u7684\u6df1\u5ea6\u503c\u5dee\u4e3a $\\pm1$\u3002\u8003\u8651\u5229\u7528\u8fd9\u4e2a\u6027\u8d28\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\u5206\u5757 RMQ \uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5757\uff0c\u53ea\u6709 $2^{B-1}$ \u79cd\u672c\u8d28\u4e0d\u540c\u7684\u53ef\u80fd\uff08 $B$ \u662f\u5757\u957f\uff0c\u6709$B-1$\u4e2a\u76f8\u90bb\u7684\u6570\u5bf9\uff0c\u4e14\u6709$\\pm1$\u4e24\u79cd\u53ef\u80fd\uff09\u3002\u4e8e\u662f\u5757\u5185\u53ef\u4ee5\u5728 $O(2^{B-1}B^2)$ \u5904\u7406\u6bcf\u79cd\u5757\u7684\u6240\u6709\u533a\u95f4\u7684\u6700\u503c\u7684\u4f4d\u7f6e\u3002\u5bb9\u6613\u53d1\u73b0\uff0c$B$ \u53d6 $\\frac{\\log_2n}{2}$ \u65f6\u53ef\u4ee5\u5728\u7ebf\u6027\u65f6\u95f4\u5185\u89e3\u51b3\u3002\u5757\u5185\u662f $O(\\sqrt{n} \\log^2n)$ \u7684\u590d\u6742\u5ea6\u3002\u800c\u6574\u5757\uff0c\u76f4\u63a5\u7528 Four Russian \u7b97\u6cd5\uff0c\u8fd8\u662f\u7ebf\u6027\u7684\uff0c\u4e8e\u662f\u8fd9\u4e2a\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002\n\n\u6700\u7ec8\u4ee3\u7801\uff1a\n\nRMQ\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define N 2000005\nusing namespace std;\nint n,m,a[N],root,s[N],top,e[N],cnt,fi[N],sum[N],dep[N],B=8;\nint M[2000][12][12],pre[2000][12],suf[2000][12],Min[50005],ST[50005][25];\nint typ[N],Sum[N],lg[N];\nstruct T {\n\tint val,l,r;\n} t[N];\nvector<int>ve[N];\nvoid build1() {\n\tfor(int i=1; i<=n; i++) {\n\t\tt[i].val=a[i],s[top+1]=0;\n\t\twhile(top&&t[s[top]].val<a[i])top--;\n\t\tt[i].l=s[top+1];\n\t\tif(top)t[s[top]].r=i;\n\t\ts[++top]=i;\n\t}\n\troot=s[1];\n}\nvoid build2() {\n\tint num[1005];\n\twhile(cnt&7)cnt++;\n\tfor(int i=0; i<(1<<(B-1)); i++) {\n\t\tnum[1]=0;\n\t\tfor(int j=0; j<B-1; j++) {\n\t\t\tif(i&(1<<j))num[j+2]=num[j+1]+1;\n\t\t\telse num[j+2]=num[j+1]-1;\n\t\t}\n\t\tfor(int j=1; j<=B; j++) {\n\t\t\tM[i][j][j]=j;\n\t\t\tfor(int k=j+1; k<=B; k++)\tM[i][j][k]=num[k]<num[M[i][j][k-1]]?k:M[i][j][k-1];\n\t\t}\n\t\tfor(int j=1; j<=B; j++)pre[i][j]=M[i][1][j],suf[i][j]=M[i][j][B];\n\t\tMin[i]=M[i][1][B];\n\t}\n\tfor(int i=1; i<=(cnt>>3); i++) {\n\t\ttyp[i]=0;\n\t\tfor(int j=(i<<3)-B+2,t=0; j<=(i<<3); j++,t++)\n\t\t\tif(sum[j]-sum[j-1]>=0)typ[i]|=(1<<t);\n\t\tSum[i]=sum[Min[typ[i]]+((i-1)<<3)];\n\t}\n\tfor(int i=1; i<=(cnt>>3); i++)ST[i][0]=i;\n\tint len=lg[cnt]-2;\n\tfor(int j=1; j<=len; j++) {\n\t\tfor(int i=1; i<=(cnt>>3)-(1<<j)+1; i++) {\n\t\t\tint k=i+(1<<(j-1));\n\t\t\tST[i][j]=Sum[ST[k][j-1]]<Sum[ST[i][j-1]]?ST[k][j-1]:ST[i][j-1];\n\t\t}\n\t}\n}\nint Brmq(int l,int r) {\n\tint k=lg[r-l+1];\n\tr-=(1<<k)-1;\n\treturn Sum[ST[l][k]]<Sum[ST[r][k]]?ST[l][k]:ST[r][k];\n}\nvoid dfs(int now) {\n\te[++cnt]=now;\n\tfi[now]=cnt;\n\tfor(int i=ve[now].size()-1; i>=0; i--) {\n\t\tint y=ve[now][i];\n\t\tdep[y]=dep[now]+1;\n\t\tdfs(y);\n\t\te[++cnt]=now;\n\t}\n}\nint query(int l,int r) {\n\tif(l>r)swap(l,r);\n\tint L=(l-1)/B+1,R=(r-1)/B+1;\n\tif(L==R) {\n\t\tint pos=(L-1)<<3;\n\t\treturn pos+M[typ[L]][l-pos][r-pos];\n\t} else if(L+1==R) {\n\t\tint pl=(L-1)<<3,pr=(R-1)<<3;\n\t\treturn sum[suf[typ[L]][l-pl]+pl]<sum[pre[typ[R]][r-pr]+pr]?suf[typ[L]][l-pl]+pl:pre[typ[R]][r-pr]+pr;\n\t} else {\n\t\tint pl=(L-1)<<3,pr=(R-1)<<3;\n\t\tint t1=Brmq(L+1,R-1),t2=sum[suf[typ[L]][l-pl]+pl]<sum[pre[typ[R]][r-pr]+pr]?suf[typ[L]][l-pl]+pl:pre[typ[R]][r-pr]+pr;\n\t\tt1=((t1-1)<<3)+Min[typ[t1]];\n\t\treturn sum[t1]<sum[t2]?t1:t2;\n\t}\n}\nint LCA(int x,int y) {\n\treturn e[query(fi[x],fi[y])];\n}\nnamespace IO {\n\tconst int MAXSIZE = 1 << 20;\n\tchar buf[MAXSIZE], *p1, *p2;\n#define gc()                                                               \\\n\t(p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, MAXSIZE, stdin), p1 == p2) \\\n\t ? EOF                                                               \\\n\t : *p1++)\n\tinline int read() {\n\t\tint x = 0, f = 1;\n\t\tchar c = gc();\n\t\twhile (!isdigit(c)) {\n\t\t\tif (c == '-') f = -1;\n\t\t\tc = gc();\n\t\t}\n\t\twhile (isdigit(c)) x = x * 10 + (c ^ 48), c = gc();\n\t\treturn x * f;\n\t}\n\tchar pbuf[1 << 20], *pp = pbuf;\n\tinline void push(const char &c) {\n\t\tif (pp - pbuf == 1 << 20) fwrite(pbuf, 1, pp - pbuf, stdout), pp = pbuf;\n\t\t*pp++ = c;\n\t}\n\tinline void write(int x) {\n\t\tstatic int sta[35];\n\t\tint top=0;\n\t\tdo {\n\t\t\tsta[++top] = x % 10, x /= 10;\n\t\t} while (x);\n\t\twhile (top) push(sta[top--]+'0');\n\t\tpush('\\n');\n\t}\n}\nusing namespace IO;\nint main() {\n\tn=read(),m=read();\n\tfor(int i=2; i<=n*2+1; i++)lg[i]=lg[i>>1]+1;\n\tfor(int i=1; i<=n; i++)a[i]=read();\n\tbuild1();\n\tfor(int i=1; i<=n; i++) {\n\t\tif(t[i].l)ve[i].push_back(t[i].l);\n\t\tif(t[i].r)ve[i].push_back(t[i].r);\n\t}\n\tdfs(root);\n\tfor(int i=1; i<=cnt; i++)sum[i]=dep[e[i]];\n\tbuild2();\n\tint l,r;\n\twhile(m--) {\n\t\tl=read(),r=read();\n\t\twrite(a[LCA(l,r)]);\n\t}\n\tfwrite(pbuf, 1, pp - pbuf, stdout);\n}\n```\n\nLCA:\n\n```cpp\n#include<bits/stdc++.h>\n#define N 2000005\nusing namespace std;\nint n,m,root,s[N],top,e[N],cnt,fi[N],sum[N],dep[N],B;\nint M[10005][12][12],pre[10005][12],suf[10005][12],Min[10005],ST[200005][25];\nint typ[N],Sum[N],lg[N];\nvector<int>ve[N];\nvoid build() {\n\tint num[2005];\n\twhile(cnt%B)cnt++;\n\tfor(int i=0; i<(1<<(B-1)); i++) {\n\t\tnum[1]=0;\n\t\tfor(int j=0; j<B-1; j++) {\n\t\t\tif(i&(1<<j))num[j+2]=num[j+1]+1;\n\t\t\telse num[j+2]=num[j+1]-1;\n\t\t}\n\t\tfor(int j=1; j<=B; j++) {\n\t\t\tM[i][j][j]=j;\n\t\t\tfor(int k=j+1; k<=B; k++)\tM[i][j][k]=num[k]<num[M[i][j][k-1]]?k:M[i][j][k-1];\n\t\t}\n\t\tfor(int j=1; j<=B; j++)pre[i][j]=M[i][1][j],suf[i][j]=M[i][j][B];\n\t\tMin[i]=M[i][1][B];\n\t}\n\tfor(int i=1; i<=cnt/B; i++) {\n\t\ttyp[i]=0;\n\t\tfor(int j=(i*B)-B+2,t=0; j<=(i*B); j++,t++)\n\t\t\tif(sum[j]-sum[j-1]>=0)typ[i]|=(1<<t);\n\t\tSum[i]=sum[Min[typ[i]]+((i-1)*B)];\n\t}\n\tfor(int i=1; i<=(cnt/B); i++)ST[i][0]=i;\n\tint len=lg[cnt]-2;\n\tfor(int j=1; j<=len; j++) {\n\t\tfor(int i=1; i<=(cnt/B)-(1<<j)+1; i++) {\n\t\t\tint k=i+(1<<(j-1));\n\t\t\tST[i][j]=Sum[ST[k][j-1]]<Sum[ST[i][j-1]]?ST[k][j-1]:ST[i][j-1];\n\t\t}\n\t}\n}\nint Brmq(int l,int r) {\n\tint k=lg[r-l+1];\n\tr-=(1<<k)-1;\n\treturn Sum[ST[l][k]]<Sum[ST[r][k]]?ST[l][k]:ST[r][k];\n}\nvoid dfs(int now,int fa) {\n\te[++cnt]=now;\n\tfi[now]=cnt;\n\tfor(int i=ve[now].size()-1; i>=0; i--) {\n\t\tint y=ve[now][i];\n\t\tif(y==fa)continue;\n\t\tdep[y]=dep[now]+1;\n\t\tdfs(y,now);\n\t\te[++cnt]=now;\n\t}\n}\nint query(int l,int r) {\n\tif(l>r)swap(l,r);\n\tint L=(l-1)/B+1,R=(r-1)/B+1;\n\tif(L==R) {\n\t\tint pos=(L-1)*B;\n\t\treturn pos+M[typ[L]][l-pos][r-pos];\n\t} else if(L+1==R) {\n\t\tint pl=(L-1)*B,pr=(R-1)*B;\n\t\treturn sum[suf[typ[L]][l-pl]+pl]<sum[pre[typ[R]][r-pr]+pr]?suf[typ[L]][l-pl]+pl:pre[typ[R]][r-pr]+pr;\n\t} else {\n\t\tint pl=(L-1)*B,pr=(R-1)*B;\n\t\tint t1=Brmq(L+1,R-1),t2=sum[suf[typ[L]][l-pl]+pl]<sum[pre[typ[R]][r-pr]+pr]?suf[typ[L]][l-pl]+pl:pre[typ[R]][r-pr]+pr;\n\t\tt1=((t1-1)*B)+Min[typ[t1]];\n\t\treturn sum[t1]<sum[t2]?t1:t2;\n\t}\n}\nint LCA(int x,int y) {\n\treturn e[query(fi[x],fi[y])];\n}\nnamespace IO {\n\tconst int MAXSIZE = 1 << 20;\n\tchar buf[MAXSIZE], *p1, *p2;\n#define gc()                                                               \\\n\t(p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, MAXSIZE, stdin), p1 == p2) \\\n\t ? EOF                                                               \\\n\t : *p1++)\n\tinline int read() {\n\t\tint x = 0, f = 1;\n\t\tchar c = gc();\n\t\twhile (!isdigit(c)) {\n\t\t\tif (c == '-') f = -1;\n\t\t\tc = gc();\n\t\t}\n\t\twhile (isdigit(c)) x = x * 10 + (c ^ 48), c = gc();\n\t\treturn x * f;\n\t}\n\tchar pbuf[1 << 20], *pp = pbuf;\n\tinline void push(const char &c) {\n\t\tif (pp - pbuf == 1 << 20) fwrite(pbuf, 1, pp - pbuf, stdout), pp = pbuf;\n\t\t*pp++ = c;\n\t}\n\tinline void write(int x) {\n\t\tstatic int sta[35];\n\t\tint top=0;\n\t\tdo {\n\t\t\tsta[++top] = x % 10, x /= 10;\n\t\t} while (x);\n\t\twhile (top) push(sta[top--]+'0');\n\t\tpush('\\n');\n\t}\n}\nusing namespace IO;\nint main() {\n\tn=read(),m=read(),root=read();\n\tB=log2(2.0*n)/2.0;\n\tfor(int i=2; i<=n*2+1; i++)lg[i]=lg[i>>1]+1;\n\tfor(int i=1; i<n; i++) {\n\t\tint u,v;\n\t\tu=read(),v=read();\n\t\tve[u].push_back(v);\n\t\tve[v].push_back(u);\n\t}\n\tdfs(root,0);\n\tfor(int i=1; i<=cnt; i++)sum[i]=dep[e[i]];\n\tbuild();\n\tint l,r;\n\twhile(m--) {\n\t\tl=read(),r=read();\n\t\twrite(LCA(l,r));\n\t}\n\tfwrite(pbuf, 1, pp - pbuf, stdout);\n}\n```\n\n### UPD:\u6539\u6b63\u4e86\u4e00\u4e2a\u4ee3\u7801\u9519\u8bef\u3002",
        "postTime": 1614004270,
        "uid": 200044,
        "name": "JS_TZ_ZHR",
        "ccfLevel": 7,
        "title": "RMQ&LCA\u5b66\u4e60\u7b14\u8bb0"
    },
    {
        "content": "# ST\u8868 / Sparse Table\n\nST\u8868\u662f\u4e00\u4e2a\u57fa\u4e8e\u500d\u589e\u601d\u60f3\u7684RMQ\u7b97\u6cd5\uff0c\u82f1\u6587\u4e3aSparse Table\u3002\n\nST\u8868\u4e3b\u8981\u7528\u6765\u5904\u7406\u5bf9\u5217\u8868\u4efb\u610f\u533a\u95f4\u6700\u503c\u7684\u67e5\u8be2\uff0c\u5206\u4e3a\u9884\u5904\u7406\u548c\u67e5\u8be2\u4e24\u6b65\u64cd\u4f5c\u3002\n\n## I. \u9884\u5904\u7406\n\n\u6ce8\uff1a**\u4e0b\u6587\u5747\u89c6\u4e3a\u6c42\u6700\u5927\u503c\uff0c\u6c42\u6700\u5c0f\u503c\u540c\u7406\u3002**\n\n\u6211\u4eec\u8bb0 $a$ \u4e3a\u8981\u64cd\u4f5c\u7684\u5e8f\u5217\uff08\u4e00\u7ef4\uff09\uff0c $st$ \u4e3aST\u8868\uff08\u4e8c\u7ef4\uff09\u3002\n\n\u5219\u6211\u4eec\u89c4\u5b9a $st_{i,j}$ \u4e3a\u4ee5 $i$ \u4e3a\u5de6\u7aef\u70b9\u957f\u5ea6\u4e3a $2^j$ \u7684\u5e8f\u5217\u6240\u6c42\u7684\u6700\u503c\uff0c\u5373 $st_{i,j}=\\max\\{a_x|x\\in[i,i+2^j-1]\\}$ \u3002\n\n**\u7279\u522b\u5730\uff0c $st_{i,0}=\\max\\{a_x|x\\in[i,i+2^0-1]\\}=\\max\\{a_x|x\\in[i,i]\\}=a_i$ \u3002**\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u7b2c\u4e00\u6b65\u53ef\u4ee5\u7528 $st_{i,0}$ \u50a8\u5b58 $a_i$ \u3002\n\n\u56e0\u4e3a $2^j=2\\times2^{j-1}$ \uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u6bb5\u533a\u95f4\u62c6\u5206\u4e3a\u957f\u4e3a $2^{j-1}$ \u7684\u4e24\u6bb5\u533a\u95f4\uff0c\u7136\u540e\u6574\u6bb5\u533a\u95f4\u7684\u6700\u503c\u5373\u4e3a\u4e24\u7aef\u533a\u95f4\u5206\u522b\u7684\u6700\u503c\u7684\u6700\u503c\u3002\n\n\u6574\u6bb5\u533a\u95f4\u6700\u503c\u5c31\u7528 $st_{i,j}$ \u8868\u793a\uff0c\u4ee3\u8868\u533a\u95f4 $[i,i+2^j-1]$ \u3002\n\n\u5219\u6839\u636e\u4e0a\u8ff0\u89c4\u5219\uff0c\u524d\u534a\u6bb5\u533a\u95f4\u6700\u503c\u5e94\u8bb0\u4e3a $st_{i,j-1}$ \uff0c\u53ef\u6839\u636e\u5b9a\u4e49\u6c42\u51fa\u533a\u95f4\u4e3a $[i,i+2^{j-1}-1]$ \u3002\n\n\u5219\u540e\u534a\u6bb5\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u4e3a\u524d\u534a\u6bb5\u533a\u95f4\u7684\u53f3\u7aef\u70b9\u52a0 $1$ \uff0c\u5373 $i+2^{j-1}$ \uff0c\u7531\u4e8e\u540e\u534a\u6bb5\u533a\u95f4\u957f\u5ea6\u4e3a $2^{j-1}$ \uff0c\u6240\u4ee5\u540e\u534a\u6bb5\u533a\u95f4\u6700\u503c\u8868\u793a\u4e3a $st_{i+2^{j-1},j-1}$ \u3002\n\n\u53ef\u4ee5\u7531\u4e0a\u5f0f\u5f97\u51fa\uff0c\u540e\u534a\u6bb5\u533a\u95f4\u7684\u53f3\u7aef\u70b9\u4e3a $i+2^{j-1}+2^{j-1}-1=i+2\\times2^{j-1}-1=i+2^j-1$ \uff0c\u5373\u4e3a\u6574\u6bb5\u533a\u95f4\u53f3\u7aef\u70b9\u3002\n\n\u5982\u56fe\u6240\u793a\uff08**\u4e0b\u56fe\u6587\u5b57\u5e76\u975e\u6700\u7ec8\u4ee3\u7801\u90e8\u5206\uff0c\"^\"\u4ee3\u8868\u5e42\u7b26\u53f7\u800c\u975e\u5f02\u6216\u7b26\u53f7**\uff09\uff1a\n\n![](https://jaanai-blog.oss-cn-shanghai.aliyuncs.com/png/ST%E8%A1%A8/ST%E8%A1%A8%E9%A2%84%E5%A4%84%E7%90%86%E6%8B%86%E5%88%86%E7%A4%BA%E6%84%8F.png)\n\n\u56e0\u4e3a\u6d89\u53ca\u5230 $2$ \u7684\u5e42\uff0c\u56e0\u6b64\u53ef\u4ee5\u7528\u4f4d\u8fd0\u7b97\u4e2d\u7684\u5de6\u79fb\u64cd\u4f5c\u51cf\u5c11\u8fd0\u884c\u5e38\u6570\uff0c\u4f18\u5316\u7a0b\u5e8f\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nfor (int i = 1; i <= n; ++i)\n  st[i][0] = a[i];\nfor (int j = 1; (1 << j) <= n; ++k)\n  for (int i = 1; i + (1 << j) - 1 <= n; ++i)\n    st[i][j] = max(st[i][j - 1], st[i + (1 << (j - 1))][j - 1]);\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log_2n)$ \u3002\n\n## II. \u67e5\u8be2\n\n\u90a3\u4e48\uff0c\u5982\u4f55\u67e5\u8be2 $[l,r]$ \u7684\u6700\u503c\u5462\uff1f\n\n\u7531\u4e8e\u533a\u95f4\u957f\u5ea6 $r-l+1$ \u4e0d\u4e00\u5b9a\u4e3a $2$ \u7684\u6574\u6570\u5e42\uff0c\u5373\u4e0d\u4e00\u5b9a\u6ee1\u8db3 $\\log_2(r-l+1)\\in N$ \u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u5206\u6b65\u6c42\uff1a\n\n\u9996\u5148\u6211\u4eec\u8bbe $k$ \u4e3a $\\lfloor log_2(r-l+1)\\rfloor$ \uff0c\u7136\u540e\u5c06\u533a\u95f4\u5206\u4e3a $[l,l+2^k-1]$ \u548c $[r-2^k+1,r]$ \u4e24\u6bb5\uff0c\u663e\u7136\u8fd9\u4e24\u6bb5\u5fc5\u5b9a\u6709\u91cd\u590d\u533a\u57df $[r-2^k+1,l+2^k-1]$ \u3002\n\n**\u4f46\u662f\u6211\u4eec\u5904\u7406\u7684\u662f\u533a\u95f4\u6700\u503c\u95ee\u9898\uff0c\u56e0\u6b64\u6709\u91cd\u590d\u4e0d\u4f1a\u5f71\u54cd\u6211\u4eec\u7684\u7ed3\u679c\u3002**\n\n\u5bf9\u4e8e\u533a\u95f4 $[l,l+2^k-1]$ \uff0c\u7531\u4e8e\u5176\u957f\u5ea6\u4e3a $2^k$ \uff0c\u56e0\u6b64\u5176\u6700\u503c\u53ef\u4ee5\u8868\u793a\u4e3a $st_{l,k}$ \u3002\n\n\u5bf9\u4e8e\u533a\u95f4 $[r-2^k+1,r]$ \uff0c\u7531\u4e8e\u5176\u957f\u5ea6\u4e5f\u4e3a $2^k$ \uff0c\u56e0\u6b64\u5176\u6700\u503c\u53ef\u4ee5\u8868\u793a\u4e3a $st_{r-2^k+1,k}$ \u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u5f97\u51fa $\\max\\{a_x|x\\in[l,r]\\}=\\max\\{st_{l,k},st_{r-2^k+1,k}\\}$ \u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nint Query(int l, int r) {\n  int k = log2(r - l + 1);\n  return max(st[l][k], st[r - (1 << k) + 1][k]);\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(1)$ \u3002\n\n\n\n\u56e0\u6b64ST\u8868\u603b\u590d\u6742\u5ea6\u4e3a $O(n\\log_2n)$ \u3002\n\n\u7ed3\u5408\u6d1b\u8c37\u4f8b\u9898\uff1a\n\n## [P3865 \u3010\u6a21\u677f\u3011ST\u8868](https://www.luogu.org/problem/P3865)\n\n\u56e0\u4e3a\u8fd9\u662f\u6a21\u677f\u9898\uff0c\u8be6\u7ec6\u8fc7\u7a0b\u4e0a\u9762\u5df2\u5206\u6790\uff0c\u8fd9\u91cc\u76f4\u63a5\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define MAX_N 100010\nint st[MAX_N][20];\ninline int Query(int l, int r) {\n  int k = log2(r - l + 1);\n  return max(st[l][k], st[r - (1 << k) + 1][k]);\n}\nint main() {\n  int n, m;\n  scanf(\"%d%d\", &n, &m);\n  for (int i = 1; i <= n; ++i)\n    scanf(\"%d\", &st[i][0]);\n  for (int k = 1; (1 << k) <= n; ++k)\n    for (int i = 1; i + (1 << k) - 1 <= n; ++i)\n      st[i][k] = max(st[i][k - 1], st[i + (1 << (k - 1))][k - 1]);\n  for (int i = 1; i <= m; ++i) {\n    int l, r;\n    scanf(\"%d%d\", &l, &r);\n    printf(\"%d\\n\", Query(l, r));\n  }\n  return 0;\n}\n```",
        "postTime": 1564365007,
        "uid": 102080,
        "name": "Jaanai",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "##\u65e2\u7136\u662f**\u6a21\u677f**\uff0c\u90a3\u5c31\u4ecb\u7ecd\u4e0b**ST\u8868**\u5427\n\n- ST\u8868\u4e3b\u8981\u7528\u4e8e\u5904\u7406**\u4e0d\u5e26\u4fee\u6539**\u7684\u533a\u95f4\u6700\u5927\u6700\u5c0f\u503c\uff0c\u5b83\u80fd\u505a\u5230\u9884\u5904\u7406$O(nlogn)$\uff0c\u8be2\u95ee$O(1)$\u7684\u65f6\u95f4\u590d\u6742\u5ea6\n\n- ST\u8868\u7684\u9884\u5904\u7406\u7c7b\u4f3c\u4e8e\u4e00\u79cd\u52a8\u6001\u89c4\u5212\uff0c\u8fd9\u91cc\u6211\u4eec\u8bbe$f[i][j]$\u8868\u793a\u533a\u95f4$[i, i + 2^j - 1]$\u7684\u6700\u5927\u503c\uff0c\u5219\u521d\u503c\u4e3a$f[i][0] = a[i]$\uff0c\u8868\u793a\u7b2c$i$\u4e2a\u4f4d\u7f6e\u7684\u6700\u5927\u503c\u5373\u4e3a$a[i]$\uff0c\u90a3\u4e48\u8f6c\u79fb\u5c31\u4e3a$f[i][j] = Max(f[i][j - 1], f[i + 2^j][j - 1])$\uff0c\u8868\u793a\u533a\u95f4$[i, i + 2^j - 1]$\u7684\u6700\u5927\u503c\u5c31\u662f\u7531\u4e24\u6bb5\u533a\u95f4$[i, i + 2^{j - 1} - 1]$\u548c$[i + 2^{j - 1}, i + 2^j - 1]$\u7684\u6700\u5927\u503c\u5408\u5e76\u8fc7\u6765\uff0c\u8fd9\u91cc$j$\u6700\u591a\u53ea\u80fd\u679a\u4e3e\u5230$logn$\uff0c\u56e0\u6b64\u590d\u6742\u5ea6\u4e3a$O(nlogn)$\n\n- \u90a3\u4e48\u73b0\u5728\uff0c\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u4e86\u6240\u6709\u957f\u5ea6\u4e3a$2^k$\u7684\u533a\u95f4\u6700\u5927\u503c\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u8be2\u95ee\u7684\u533a\u95f4$[l, r]$\uff0c\u6211\u4eec\u8003\u8651\u628a\u5b83\u62c6\u6210\u4e24\u6bb5\u957f\u5ea6\u4e3a$2^k$\u7684\u533a\u95f4\u518d\u53d6\u4e2a\u6700\u5927\u503c\uff08\u8fd9\u91cc\u7684\u4e24\u4e2a\u533a\u95f4\u662f**\u53ef\u4ee5\u6709\u4ea4\u96c6**\u7684\uff0c\u663e\u7136\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u6b63\u786e\u6027\uff09\uff0c\u8fd9\u91cc\u7684$k$\u5c31\u6ee1\u8db3$2^k \\le r - l + 1$\u4e14$k$\u7684\u503c\u6700\u5927\uff0c\u90a3\u4e48$k$\u5176\u5b9e\u5c31\u662f$\\lfloor log(r - l + 1) \\rfloor$\uff0c\u6211\u4eec$O(n)$\u9884\u5904\u7406\u51fa$\\lfloor log(1...n) \\rfloor$\uff0c\u4e5f\u5c31\u505a\u5230\u4e86\u8be2\u95ee$O(1)$\n\n##\u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <cstdio>\n\nusing namespace std;\nconst int N = 1e5 + 5, LogN = 16;\nint f[N][LogN + 5], Log[N], n, m;\n\ninline int get()\n{\n    char ch; int res = 0;\n    while ((ch = getchar()) < '0' || ch > '9');\n    res = ch ^ 48;\n    while ((ch = getchar()) >= '0' && ch <= '9')\n     res = (res << 3) + (res << 1) + ch - '0';\n    return res;\n} \n\ninline void put(int x)\n{\n    if (x > 9) put(x / 10);\n    putchar(x % 10 + 48);\n}\n\ninline int Max(const int &x, const int &y) {return x > y ? x : y;}\n \nint main()\n{\n    n = get(); m = get(); int x, y, k; Log[0] = -1;\n    for (int i = 1; i <= n; ++i) f[i][0] = get(), Log[i] = Log[i >> 1] + 1;\n    for (int j = 1; j <= LogN; ++j)\n     for (int i = 1; i + (1 << j) - 1 <= n; ++i)\n      f[i][j] = Max(f[i][j - 1], f[i + (1 << j - 1)][j - 1]);\n    while (m--)\n    {\n        x = get(); y = get(); k = Log[y - x + 1]; \n        put(Max(f[x][k], f[y - (1 << k) + 1][k])), putchar('\\n');\n    }\n}\n```",
        "postTime": 1502179081,
        "uid": 17952,
        "name": "Log_x",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "## \u66b4\u529b\u7b97\u6cd5\n\n\u76f4\u63a5\u6309\u7167\u9898\u610f\u6a21\u62df\uff0c\u590d\u6742\u5ea6$O(n^2)$\u3002\u671f\u671b\u5f97\u5206$30$\u5206\u3002\u8fd9\u91cc\u4e0d\u518d\u591a\u8bf4\u3002\n\n## \u7ebf\u6bb5\u6811\u7b97\u6cd5\n\n\u8fd9\u9053\u9898\u76ee\u867d\u7136\u6570\u636e\u5f3a\uff0c\u4f46\u662f\u7ebf\u6bb5\u6811\u662f\u53ef\u4ee5\u8fc7\u7684\u3002\u5f53\u7136\uff0c\u4e00\u822c\u7684\u7ebf\u6bb5\u6811\u53ef\u80fd\u4f1a\u88ab\u5361\u5e38\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u7528zkw\u7ebf\u6bb5\u6811\u3002\n\nzkw\u7ebf\u6bb5\u6811\uff0c\u662f\u4e00\u4e2a\u5e38\u6570\u5c0f\u7684\u201c\u5faa\u73af\u7248\u201d\u7ebf\u6bb5\u6811\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\u8fd9\u91cc\u63a8\u8350[\u6211\u7684\u535a\u5ba2](http://www.cnblogs.com/frankchenfu/p/7132445.html)\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n log_2 n)$\u3002\u671f\u671b\u5f97\u5206$70$\u5206\uff0c\u5b9e\u9645\u53ef\u4ee5AC\u3002cpp\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<cstdio>\n#define max(x,y) (x>y?x:y)\nconst int MAXN=400001;\n\nint d[MAXN];\nint n,q,bit;\n\nvoid build(int n)\n{\n    for(bit=1;bit<=n+1;bit<<=1);\n    for(int i=bit+1;i<=bit+n;i++)\n        scanf(\"%d\",&d[i]);\n    for(int i=bit-1;i;i--)\n        d[i]=max(d[i<<1],d[i<<1|1]);//i<<1|1=(i<<1)+1\n}\nvoid update(int x,int y)\n{\n    for(d[x+=bit]=y,x>>=1;x;x>>=1)\n        d[x]=max(d[x<<1],d[x<<1|1]);\n}\nint query(int s,int t)\n{\n    int ans=-1;\n    for(s+=bit-1,t+=bit+1;s^t^1;s>>=1,t>>=1)\n    {\n        if(~s&1)\n            ans=max(ans,d[s^1]);\n        if(t&1)\n            ans=max(ans,d[t^1]);\n    }\n    return ans;\n}\n\nint main()\n{\n    scanf(\"%d%d\",&n,&q);\n    build(n);\n    while(q--)\n    {\n        int y,z;\n        scanf(\"%d%d\",&y,&z);\n        printf(\"%d\\n\",query(y,z));\n    }\n}\n```\n\u5f53\u7136\uff0c\u4f5c\u4e3aST\u8868\u7684\u6a21\u677f\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u500d\u589e\u7684$RMQ$\u7b97\u6cd5\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O(n log_2 n)$\uff0c\u4f46\u662f\u6bcf\u6b21\u67e5\u8be2\u590d\u6742\u5ea6\u4e3a$O(1)$\u3002\n\n\u8fd9\u4e2a\u7b97\u6cd5\u5c31\u662f\u57fa\u4e8eDP\u548c\u4f4d\u8fd0\u7b97\uff0c\u6211\u4eec\u7528$p_{i,j}$\u8868\u793a\u4ece\u7b2ci\u4f4d\u5f00\u59cb\uff0c\n\n\u5230\u7b2c$i+2^j-1$\u4f4d\u7684\u6700\u5927\u503c\u6216\u8005\u6700\u5c0f\u503c\u3002\n\n\u90a3\u4e48\u6211\u6c42$p_{i,j}$\u7684\u65f6\u5019\u53ef\u4ee5\u628a\u5b83\u5206\u6210\u4e24\u90e8\u5206\uff0c\n\n\u7b2c\u4e00\u90e8\u5206\u4ece$i$\u5230$i+2^{j-1}-1$\uff0c\u7b2c\u4e8c\u90e8\u5206\u4ece$i+2^{j-1}$\n\n\u5230$i+2^j-1$\u6b21\u65b9\uff0c\u5176\u5b9e\u6211\u4eec\u77e5\u9053\u4e8c\u8fdb\u5236\u6570\u540e\u4e00\u4e2a\u662f\u524d\u4e00\u4e2a\u7684\u4e8c\u500d\uff0c\n\n\u90a3\u4e48\u53ef\u4ee5\u628a$[i,i+2^j]$\u8fd9\u4e2a\u533a\u95f4\uff0c\u901a\u8fc7$2^{j-1}$\u5206\u6210\u76f8\u7b49\u7684\u4e24\u90e8\u5206\uff0c\u90a3\u8f6c\u79fb\u65b9\u7a0b\u5f88\u5bb9\u6613\u5c31\u5199\u51fa\u6765\u4e86\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n## $p_{i,j}=max(p_{i,j-1},p_{i+2^{j-1},j-1})$\n\ncpp\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#define max(x,y) (x>y?x:y)\n#define min(x,y) (x<y?x:y)\nconst int MAXN=100010;\nint a[MAXN];\nint p[MAXN][32];\nint n,q;\n\nvoid init()\n{\n    for(int i=1;i<=n;i++)\n        p[i][0]=a[i];\n    for(int j=1;(1<<j)<=n;j++)\n        for(int i=1;i+(1<<j)-1<=n;i++)\n            p[i][j]=max(p[i][j-1],p[i+(1<<j-1)][j-1]);\n}\nint query(int l,int r)\n{\n    int k=0;\n    while((1<<k+1)<=r-l+1)\n        k++;\n    return max(p[l][k],p[r-(1<<k)+1][k]);  \n}\n\nint main()\n{\n    scanf(\"%d%d\",&n,&q);\n    for(int i=1;i<=n;i++)\n        scanf(\"%d\",&a[i]);\n    init();\n    while(q--)\n    {\n        int l,r;scanf(\"%d%d\",&l,&r);\n        printf(\"%d\\n\",query(l,r));\n    }\n    return 0;\n}\n```",
        "postTime": 1510285664,
        "uid": 23398,
        "name": "frankchenfu",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "# \u524d\u8a00\n\n~~\u4f17\u6240\u5468\u77e5\uff0c\u6a21\u677f\u9898\u4e0d\u7528\u6a21\u677f\u505a\u6cd5\u624d\u662f\u597d\u505a\u6cd5\u3002~~\n\n\u672c\u6587\u4e0e\u5176\u5b83\u9898\u89e3\u505a\u6cd5\u4e0d\u540c\uff0c\u4f7f\u7528\u4e86 $O(n\\sqrt{n})$ \u9884\u5904\u7406\uff0c$O(1)$ \u67e5\u8be2\u7684\u5206\u5757\u505a\u6cd5\u3002\n\n# \u9898\u76ee\n\n[\u6d1b\u8c37](https://www.luogu.com.cn/problem/P3865)\n\n# \u8bb2\u89e3\n\n\u9996\u5148\u6211\u4eec\u76f4\u63a5\u6309 $\\sqrt{n}$ \u7684\u5927\u5c0f\u5206\u5757\uff0c\u7136\u540e\u8003\u8651\u5982\u4f55\u9884\u5904\u7406\u624d\u80fd\u5b9e\u73b0 $O(1)$ \u67e5\u8be2\u3002\n\n\u4e3a\u65b9\u4fbf\u63cf\u8ff0\uff0c\u6211\u5c06\u4e00\u4e2a\u5b8c\u6574\u7684\u5757\u79f0\u4e3a**\u6574\u5757**\uff0c\u5c06\u4e0d\u5b8c\u6574\u7684\u5757\u79f0\u4e3a**\u6563\u5757**\u3002\n\n\u6211\u4eec\u901a\u8fc7\u8be2\u95ee\u6765\u770b\u770b\u6211\u4eec\u9700\u8981\u5904\u7406\u54ea\u4e9b\u4e1c\u897f\uff1a\n\n## part1 \u8be2\u95ee\u8de8\u5757\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/xojjupvt.png)\n\n\u5982\u56fe\uff0c\u7ea2\u8272\u90e8\u5206\u4e3a\u8be2\u95ee\u533a\u95f4\uff0c\u9ed1\u8272\u90e8\u5206\u4e3a\u6211\u4eec\u5206\u7684\u5757\u3002\n\n\u663e\u7136\u6211\u4eec\u9700\u8981\u9884\u5904\u7406\u6574\u5757\u4e0e\u6574\u5757\u4e4b\u95f4\u7684\u6700\u5927\u503c\u3002\n\n\u800c\u5bf9\u4e8e\u4e24\u8fb9\u7684\u6563\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u6bcf\u4e2a\u6574\u5757\u7684\u524d\u7f00\u548c\u540e\u7f00\u6700\u5927\u503c\uff0c\u4ece\u800c\u5f97\u5230\u4e24\u8fb9\u6563\u5757\u7684\u6700\u5927\u503c\u3002\n\n\u9884\u5904\u7406\u65f6\u95f4\u90fd\u662f $O(n)$ \u7684\u3002\n\n## part2 \u8be2\u95ee\u4e0d\u8de8\u5757\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/j0ids7ob.png)\n\n\u770b\u4f3c\u5f88\u56f0\u96be\uff0c\u5176\u5b9e\u6211\u4eec\u53ea\u9700\u5c06\u6bcf\u4e2a**\u6574\u5757\u5185\u7684\u533a\u95f4**\u7684\u6700\u5927\u503c\u9884\u5904\u7406\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u65f6\u95f4\u662f $O(n\\sqrt{n})$ \u7684\u3002\n\n\u641e\u5b9a\u4e86\u5417\uff1f\u5e76\u6ca1\u6709\u3002\n\n\u6211\u4eec\u7b97\u4e00\u7b97\u7a7a\u95f4\uff1a$\\sqrt{100000}\\approx320,\\dfrac{4\\times 320^3}{1024^2}\\approx 125\\tt MB$\u3002\n\n\u672c\u9898\u7a7a\u95f4\u9650\u5236\uff1a$125\\tt MB$\u3002\n\n\u4f46\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ef\u4ee5\u5c06\u65e0\u7528\u7a7a\u95f4\u7701\u4e0b\u6765\uff0c\u6bd4\u5982\u533a\u95f4 $[r,l],(r>l)$ \u7684\u7a7a\u95f4\u5b8c\u5168\u5c31\u662f\u6d6a\u8d39\uff0c\u6240\u4ee5\u6211\u4eec\u6254\u6389\u8fd9\u4e9b\u7a7a\u95f4\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba9\u7a7a\u95f4\u51cf\u534a\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u5757\u7684\u5927\u5c0f\u6765\u5b9e\u73b0\u65f6\u95f4\u6362\u7a7a\u95f4\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt{n}+q)$\u3002\n\n# \u4ee3\u7801\n\n```cpp\n//12252024832524\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#define TT template<typename T>\nusing namespace std; \n\ntypedef long long LL;\nconst int MAXN = 100005;\nconst int MAXB = 318;\nint n,Q,B;\n\nLL Read()\n{\n\tLL x = 0,f = 1;char c = getchar();\n\twhile(c > '9' || c < '0'){if(c == '-')f = -1;c = getchar();}\n\twhile(c >= '0' && c <= '9'){x = (x*10) + (c^48);c = getchar();}\n\treturn x * f;\n}\nTT void Put1(T x)\n{\n\tif(x > 9) Put1(x/10);\n\tputchar(x%10^48);\n}\nTT void Put(T x,char c = -1)\n{\n\tif(x < 0) putchar('-'),x = -x;\n\tPut1(x); if(c >= 0) putchar(c);\n}\nTT T Max(T x,T y){return x > y ? x : y;}\nTT T Min(T x,T y){return x < y ? x : y;}\nTT T Abs(T x){return x < 0 ? -x : x;}\n\nint pre[MAXB][MAXB],suf[MAXB][MAXB],MAX[MAXB][MAXB],in[MAXB][MAXB*MAXB/2];\n//\u5206\u522b\u4e3a\u6bcf\u4e2a\u5757\u7684\u524d\u7f00\u6700\u5927\u503c\uff0c\u540e\u7f00\u6700\u5927\u503c\uff0c\u6574\u5757\u4e4b\u95f4\u7684\u6700\u5927\u503c\uff0c\u6574\u5757\u5185\u90e8\u7684\u6700\u5927\u503c\nint ID[MAXN],BID[MAXN],ka[MAXB][MAXB];\n\nint main()\n{\n//\tfreopen(\".in\",\"r\",stdin);\n//\tfreopen(\".out\",\"w\",stdout);\n\tn = Read(); Q = Read();\n\tB = ceil(sqrt(n));\n\tfor(int i = 0;i < n;++ i) ID[i] = i % B,BID[i] = i / B;\n\tint tot = 0;\n\tfor(int i = 0;i < B;++ i)//ka=\u5361\uff0c\u56e0\u4e3a\u8fd9\u9053\u9898\u5361\u7a7a\u95f4= =\n\t\tfor(int j = i;j < B;++ j)\n\t\t\tka[i][j] = tot++; \n\tfor(int i = 0;i < n;++ i) in[BID[i]][ka[ID[i]][ID[i]]] = Read();\n\tfor(int i = 0;i*B < n;++ i) \n\t{\n\t\tpre[i][0] = in[i][ka[0][0]];\n\t\tsuf[i][B-1] = in[i][ka[B-1][B-1]];\n\t\tfor(int j = 1;j < B;++ j) pre[i][j] = Max(pre[i][j-1],in[i][ka[j][j]]);\n\t\tfor(int j = B-2;j >= 0;-- j) suf[i][j] = Max(suf[i][j+1],in[i][ka[j][j]]);\n\t\tMAX[i][i] = pre[i][B-1];\n\t}\n\tfor(int i = 0;i*B < n;++ i)\n\t{\n\t\tfor(int j = i+1;j*B < n;++ j)\n\t\t\tMAX[i][j] = Max(MAX[i][j-1],MAX[j][j]);\n\t\tfor(int j = 0;j < B;++ j)\n\t\t\tfor(int k = j+1;k < B;++ k)\n\t\t\t\tin[i][ka[j][k]] = Max(in[i][ka[j][k-1]],in[i][ka[k][k]]);\n\t}\n\twhile(Q --> 0)\n\t{\n\t\tint l = Read()-1,r = Read()-1;\n\t\tint L = BID[l],R = BID[r];\n\t\tif(L == R) Put(in[L][ka[ID[l]][ID[r]]],'\\n');\n\t\telse if(L+1 == R) Put(Max(suf[L][ID[l]],pre[R][ID[r]]),'\\n');\n\t\telse Put(Max(MAX[L+1][R-1],Max(suf[L][ID[l]],pre[R][ID[r]])),'\\n');\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1628688942,
        "uid": 137437,
        "name": "PPL_",
        "ccfLevel": 0,
        "title": "P3865 \u3010\u6a21\u677f\u3011ST \u8868 \u9898\u89e3"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\u524d\u7f00\u8ba1\u7b97\u3002\n## \u6982\u5ff5\uff1a\n\u5728\u524d\u7f00\u8ba1\u7b97\u4e2d\uff0c\u4efb\u610f\u5b50\u533a\u95f4\u90fd\u53ef\u4ee5\u8868\u793a\u6210\u4e24\u4e2a\u524d\u7f00\u533a\u95f4\u76f8\u51cf\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u9884\u5904\u7406\u6240\u6709\u524d\u7f00\u533a\u95f4\u7684\u503c\u3002\n\n\u5b50\u533a\u95f4\u7684\u503c\u5c31\u662f\u4e24\u4e2a\u524d\u7f00\u533a\u95f4\u503c\u8fdb\u884c\u9006\u8fd0\u7b97\u7684\u7ed3\u679c\u3002\n\n\u4f46\u662f\uff0c\u8fd0\u7b97\u4e0d\u53ef\u9006\u65f6\u65e0\u6cd5\u7528\u524d\u7f00\u8ba1\u7b97\u5904\u7406\u3002\n\n\u53ea\u80fd\u8003\u8651\u5c06\u76ee\u6807\u533a\u95f4\u8fde\u7eed\u5206\u6210\u51e0\u4e2a\u533a\u95f4\uff0c\u7528\u6b63\u5411\u8ba1\u7b97\u6765\u6c42\u89e3\u3002\n\n\u4ee4\u8fde\u7eed\u7684\u533a\u95f4 A \u548c B \u5408\u5e76\u540e\u5f97\u5230\u533a\u95f4 C \u3002\n\n\u90a3\u4e48\uff0c\u5bf9\u533a\u95f4 A \u548c B \u7684\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u533a\u95f4 C \u7684\u503c\u3002\n\n\u9700\u8981\u8fd0\u7b97\u6ee1\u8db3\u7ed3\u5408\u5f8b\u3002\n\n## ST\u8868\uff1a\u9884\u5904\u7406\u6240\u6709\u957f\u5ea6\u4e3a $2$ \u7684\u5e42\u7684\u533a\u95f4\u7684\u503c\n\u901a\u5e38\u7528\u533a\u95f4\u5de6\u754c $i$ \u548c\u8868\u793a\u957f\u5ea6\u7684\u5e42 $j$ \u8868\u793a\u533a\u95f4 $[i, i + 2^j - 1]$ \u3002\n\n\u6c42\u89e3\u65b9\u5f0f\u6309\u7167\u5e42\u7531\u5c0f\u5230\u5927\u9012\u63a8\u6c42\u89e3\u3002\n\n\u6bcf\u4e2a\u5e42\u4e3a $j$ \u7684\u533a\u95f4\u53ef\u4ee5\u7531\u4e24\u4e2a\u5e42\u4e3a $j - 1$ \u7684\u533a\u95f4\u5408\u5e76\u800c\u6210\u3002\n\n\u9012\u63a8\u8fb9\u754c\u662f\u5355\u4f4d\u533a\u95f4\uff0c\u5373 $j$ \u4e3a $0$ \u7684\u533a\u95f4\u3002\n### \u5b9e\u73b0\u601d\u8def\n1. \u521d\u59cb\u5316\u5355\u4f4d\u533a\u95f4\u7684\u503c\u3002\n2. \u7531\u5c0f\u5230\u5927\u679a\u4e3e\u533a\u95f4\u957f\u5ea6\n3. \u679a\u4e3e\u533a\u95f4\u5de6\u8fb9\u754c\uff0c\u5e76\u8ba1\u7b97\u5f53\u524d\u533a\u95f4\u7684\u503c\u3002\n\n## \u65f6\u7a7a\u590d\u6742\u5ea6\n\u4ee4\u533a\u95f4\u7684\u5168\u957f\u4e3a $n$ \u3002\n\n\u6bcf\u4e2a\u957f\u5ea6\u7684\u533a\u95f4\u6570\u91cf $n$ \uff0c\u957f\u5ea6\u6570\u91cf $\\log n$ \uff0c\u533a\u95f4\u603b\u6570 $n \\log n$ \u3002\n\n### \u65f6\u95f4\u590d\u6742\u5ea6\n\u8ba1\u7b97\u533a\u95f4\u503c $O(1)$ \uff0c\u603b\u5171 $O(n \\log n)$ \u3002\n### \u7a7a\u95f4\u590d\u6742\u5ea6\n\u8bb0\u5f55\u6bcf\u4e2a\u533a\u95f4\u7684\u503c $O(n \\log n)$ \u3002\n## \u5e94\u7528\n\u76f8\u6bd4\u4e8e\u524d\u7f00\u8ba1\u7b97\u63d0\u9ad8\u4e86\u590d\u6742\u5ea6\uff0c\u4f46\u662f\u6269\u5927\u4e86\u5e94\u7528\u573a\u666f\u3002\n\n\u7528 ST\u8868 \u7684\u533a\u95f4\u53ef\u4ee5\u5408\u5e76\u51fa\u4efb\u610f\u5b50\u533a\u95f4\u3002\n\n\u5bf9\u4e8e\u957f\u5ea6\u4e3a $l$ \u7684\u533a\u95f4 $[i, i + l - 1]$ \uff0c\u4ee4 $l = 2^{p_1} + 2^{p_2} + \u2026\u2026 2^{p_k}$ \u3002\n\n\u53ef\u4ee5\u5c06\u533a\u95f4\u5212\u5206\u6210\u957f\u5ea6\u4e3a\u76f8\u5e94 $2$ \u7684\u5e42\u7684\u533a\u95f4\uff1a\n\n$[i, i + 2^{p_1} - 1]$\u3001 $[i + 2^{p_1} , i + 2^{p_1} + 2^{p_2} - 1]$\u3001\u2026\u2026 \u3002\n\n\u6700\u591a\u5212\u5206\u6210 $\\log l$ \u4e2a\u533a\u95f4\u3002\n## \u9898\u76ee\u5206\u6790\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u4e3a $n$ \u7684\u6574\u6570\u5e8f\u5217 $a$ \u3002\n\n\u8fdb\u884c $m$ \u6b21\u67e5\u8be2\uff0c\u6bcf\u6b21\u67e5\u8be2\u6307\u5b9a\u533a\u95f4\u4e2d\u7684\u6700\u5927\u503c\u3002\n\n## \u601d\u8def\n\u5148\u9884\u5904\u7406\u51fa ST\u8868 \u4e2d\u6bcf\u4e2a\u533a\u95f4\u7684\u6700\u5927\u503c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u67e5\u8be2\uff0c\u5bf9\u533a\u95f4\u8fdb\u884c\u5212\u5206\uff0c\u627e\u5230\u6240\u6709\u533a\u95f4\u4e2d\u7684\u6700\u5927\u503c\u3002\n## $code$\n~~~cpp\n#include <algorithm>\n#include <iostream>\n\nusing namespace std;\n\nconst int kMaxN = 1e5 + 1;\nconst int kMaxL = 20;\n\nint f[kMaxN][kMaxL];\nint n, m, l, r, ans;\n\nint main() {\n  ios::sync_with_stdio(0);\n  cin.tie(0), cout.tie(0);\n  cin >> n >> m;\n  for (int i = 1; i <= n; i++) {\n    cin >> f[i][0];  // \u8bfb\u5165\u5355\u4f4d\u533a\u95f4\u7684\u6700\u5927\u503c\n  }\n  for (int j = 1; j < kMaxL; j++) {                            // \u679a\u4e3e\u5e42\n    for (int i = 1; i + (1 << j) <= n + 1; i++) {              // \u679a\u4e3e\u5de6\u754c\n      f[i][j] = max(f[i][j - 1], f[i + (1 << j - 1)][j - 1]);  // \u8ba1\u7b97\u76f8\u5e94\u533a\u95f4\u7684\u6700\u503c\n    }\n  }\n  while (m--) {\n    cin >> l >> r;\n    ans = 0;\n    r = r - l + 1;                     // \u8ba1\u7b97\u533a\u95f4\u957f\u5ea6\n    for (int j = 0; j < kMaxL; j++) {  // \u679a\u4e3e\u5e42\n      if (r >> j & 1) {                // \u9700\u8981\u5f53\u524d\u5e42\n        ans = max(ans, f[l][j]);       // \u66f4\u65b0\u6700\u503c\n        l += 1 << j;                   // \u79fb\u52a8\u5de6\u754c\n      }\n    }\n    cout << ans << '\\n';\n  }\n  return 0;\n}\n~~~",
        "postTime": 1628304783,
        "uid": 392856,
        "name": "\u4fe1\u5b88\u5929\u4e0b",
        "ccfLevel": 5,
        "title": "\u9898\u89e3P3865\u3010\u3010\u6a21\u677f\u3011ST \u8868\u3011"
    },
    {
        "content": "\u697c\u4e0a\u697c\u4e0b\u7684st\u8868\u5199\u7684\u597d\u6e9c\u554a\u3002\u3002\u3002\n\n\u8fd8\u6df7\u8fdb\u4e86\u4ec0\u4e48\u56de\u6eda\u83ab\u961f\uff0c\u5206\u5757\uff0c\u7ebf\u6bb5\u6811\u7b49\u7b49\u795e\u4ed9\u505a\u6cd5\u3002\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cd\u7ebf\u6027\u7684\u505a\u6cd5-\u7b1b\u5361\u5c14\u6811\n\n\u7b1b\u5361\u5c14\u6811\u662f\u4e00\u9897\u4e8c\u53c9\u641c\u7d22\u5806\u3002\n\u56e0\u4e3a\u5b83\u540c\u65f6\u5177\u6709\u4e8c\u53c9\u641c\u7d22\u6811\u548c\u5806\u7684\u6027\u8d28\u3002\n\n\u5177\u4f53\u5730\uff0c\u5176\u4e2d\u5e8f\u904d\u5386\u662f\u539f\u5e8f\u5217\uff0c\u540c\u65f6\u6ee1\u8db3\u5f53\u524d\u8282\u70b9\u662f\u5b50\u6811\u6700\u503c\u3002\n\n\u6784\u9020\u7684\u65b9\u6cd5\u662f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u6700\u53f3\u94fe\uff0c\u63d2\u5165\u4e4b\u540e\u5176\u4f59\u8282\u70b9\u6362\u5230\u5de6\u5b50\u6811\u3002\n\n\u6027\u8d28\u662f\u4e24\u70b9\u7684Lca\u5c31\u662f\u533a\u95f4\u6700\u503c\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u7528Tarjan\u52a0\u5e76\u67e5\u96c6\u641e\u3002\n\n\u590d\u6742\u5ea6$O(n+m)$\n\n\u88abrmq\u540a\u6253\u3002\n\n```cpp\n#include<bits/stdc++.h>\nint ri() {\n    char c = getchar(); int x = 0, f = 1; for(;c < '0' || c > '9'; c = getchar()) if(c == '-') f = -1;\n    for(;c >= '0' && c <= '9'; c = getchar()) x = (x << 1) + (x << 3) - '0' + c; return x * f;\n}\nconst int N = 1e5 + 10, M = 2e6 + 10;\nint n, m, tp, rt, st[N], ls[N], rs[N], a[N], pr[N], g[N], A[M], to[M], nx[M], id[M]; bool vis[N];\nint F(int x) {return !g[x] ? x : g[x] = F(g[x]);}\nvoid adds(int u, int v, int i) {to[++tp] = v; nx[tp] = pr[u]; pr[u] = tp; id[tp] = i;}\nvoid Tarjan(int u) {\n    vis[u] = true;\n    if(ls[u]) Tarjan(ls[u]), g[F(ls[u])] = u;\n    if(rs[u]) Tarjan(rs[u]), g[F(rs[u])] = u;\n    for(int i = pr[u]; i; i = nx[i]) \n        if(vis[to[i]] && !A[id[i]]) \n            A[id[i]] = F(to[i]);\n}\nint main() {\n    n = ri(); m = ri();\n    for(int i = 1;i <= n; ++i) {\n        a[i] = ri();\n        for(;tp && a[i] > a[st[tp]];) ls[i] = st[tp--];\n        tp ? rs[st[tp]] = i : rt = i;\n        st[++tp] = i;\n    }\n    for(int i = 1;i <= m; ++i) adds(ri(), ri(), i);\n    Tarjan(rt);\n    for(int i = 1;i <= m; ++i) printf(\"%d\\n\", a[A[i]]);\n    return 0;\n}\n```",
        "postTime": 1540992245,
        "uid": 2218,
        "name": "2014\u5415\u6cfd\u9f99",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "\u6ca1\u653e\u56fe\u8b66\u544a  \n\n## 0.\u524d\u8a00  \n\u4e2a\u4eba\u8ba4\u4e3a ST\u8868\u50cf\u662f\u4e00\u79cd\u57fa\u4e8edp(\u500d\u589e?)\u7b97\u6cd5\u7684\u6570\u636e\u7ed3\u6784  \n## 1.\u6982\u5ff5\u4e0e\u5e94\u7528  \nST\u8868\u793a\u7528\u6765\u89e3\u51b3\u533a\u95f4\u6700\u503c(RMQ)\u95ee\u9898\u7684  \nST\u8868\u7684\u5b9e\u73b0\u65b9\u5f0f\u548c\u7ebf\u6bb5\u6811\u4e0d\u540c \u7ebf\u6bb5\u6811\u662f\u628a\u5f85\u67e5\u8be2\u533a\u95f4**\u62c6\u6210$logn$\u7ea7\u522b\u4e2a\u4e0d\u76f8\u4ea4\u533a\u95f4** \u800cST\u8868\u5219\u662f\u901a\u8fc7\u628a\u4e00\u4e2a\u533a\u95f4\u6700\u5927\u503c\u7528**\u4e24\u4e2a\u533a\u95f4 \u6700\u5927\u503c \u7684\u6700\u5927\u503c**\u4ee3\u66ff \u5e76\u4e14\u9009\u53d6\u7684\u4e24\u4e2a\u533a\u95f4\u7684\u5e76\u96c6\u5219\u662f\u5e26\u67e5\u8be2\u533a\u95f4  \n\n\u8fd9\u6837\u4f7f\u5f97ST\u8868\u80fd\u591f\u5728$O(1)$\u65f6\u95f4\u5185\u67e5\u8be2\u533a\u95f4\u6700\u5927/\u6700\u5c0f\u503c \u4f46\u662f\u7531\u4e8e\u4e24\u4e2a\u533a\u95f4\u7684\u4ea4\u96c6\u672a\u5fc5\u4e3a\u7a7a \u6240\u4ee5ST\u8868\u4e0d\u80fd\u5b9e\u73b0\u533a\u95f4\u6c42\u548c(\u4ee5\u53ca\u5176\u4ed6\u7c7b\u4f3c\u7684\u4e8b\u60c5)  \n## 2.\u5b9e\u73b0\u65b9\u5f0f  \n\u5b9e\u73b0\u7684\u5173\u952e\u5728\u4e8e**\u62c6\u6210\u7684\u533a\u95f4\u7684\u9009\u53d6**  \n\u6211\u4eec\u9700\u8981\u9884\u5904\u7406\u51fa\u6765\u4e00\u5b9a\u6570\u91cf\u4e2a\u533a\u95f4\u7684\u6700\u503c \u7136\u540e\u6bcf\u6b21\u8be2\u95ee\u6839\u636e\u8be2\u95ee\u533a\u95f4\u9009\u53d6\u4e24\u4e2a\n\u6211\u4eec\u9700\u8981\u5728\u80fd\u4fdd\u8bc1**\u4efb\u610f\u4e00\u4e2a\u533a\u95f4\u67e5\u8be2\u90fd\u80fd\u591f\u6b63\u786e\u5b9e\u73b0**\u7684\u60c5\u51b5\u4e0b\u4f7f\u5f97**\u603b\u533a\u95f4\u6570\u91cf\u5c3d\u91cf\u5c0f**  \n\n\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u7684\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9$l$\u9884\u5904\u7406\u533a\u95f4$[l,l+2^k-1]$  \n\u5c31\u662f\u4ece$l$\u5f00\u59cb\u5f80\u540e$2^k$\u4e2a\u6570\u7684\u6700\u503c  \n\u8fd9\u6837\u4e00\u5b9a\u53ef\u4ee5\u6ee1\u8db3\u4efb\u610f\u4e00\u4e2a\u533a\u95f4\u67e5\u8be2  \n\n\u8bc1\u660e: $2^k <= (2^k+2^k-x) <= 2^{k+1}$ $(0<=x<=2^k)$  \n~~\u662f\u4e0d\u662f\u592a\u62bd\u8c61\u4e86~~  \n\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee\u533a\u95f4\u957f\u5ea6\u5728$[2^k,2^{k+1}]$\u7684\u8be2\u95ee \u4e00\u5b9a\u5b58\u5728\u4e24\u4e2a\u957f\u5ea6\u4e3a$2^k$\u7684\u533a\u95f4 \u5b83\u4eec\u7684\u5e76\u96c6\u7b49\u4e8e\u8be2\u95ee\u533a\u95f4  \n\n\u5bf9\u4e8e\u533a\u95f4\u67e5\u8be2$[l,r]$ \u9009\u62e9**\u5de6\u7aef\u70b9\u4e3al**\u7684\u533a\u95f4\u548c**\u53f3\u7aef\u70b9\u4e3ar**\u5e76\u4e14 **\u533a\u95f4\u957f\u5ea6\u4e3a$2^k$**\u7684\u4e24\u4e2a\u533a\u95f4  \n\n$2^k$\u53ef\u4ee5\u901a\u8fc7\u533a\u95f4\u957f\u5ea6\u8ba1\u7b97\u51fa\u6765  \n\n~~\u53ef\u4ee5\u76f4\u63a5\u4e0a\u4ee3\u7801\u4e86~~  \n## 3.\u4ee3\u7801\u5b9e\u73b0  \n### 1.\u9884\u5904\u7406  \n\u500d\u589e\u601d\u60f3  \n$[1,2]=max([1,1],[2,2])$ $[1,4]=max([1,2],[3,4])$ ...  \n\u8bb0\u5f97\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u533a\u95f4\u957f\u5ea6 \u7136\u540e\u533a\u95f4\u6700\u5927\u503c\u7b49\u4e8e\u5de6\u534a\u8fb9\u53f3\u534a\u8fb9\u7684\u6700\u5927\u503c  \n\u8bb0$dp[x][i]$\u8868\u793a\u533a\u95f4$[i,i+2^x-1]$  \nx\u53ea\u8981\u679a\u4e3e\u5230$logn$\u5373\u53ef  \n\n\u9884\u5904\u7406log:  \n```cpp\nLOG[0] = -1;\nfor(int i = 1;i <= 100000;i ++) LOG[i] = LOG[i >> 1] + 1;\n```\n\u9884\u5904\u7406:  \n```cpp\nfor(int j = 1;j <= LOG[n];j ++){\n\tfor(int i = 1;i <= n;i ++){\n\t\tdp[j][i] = max(dp[j - 1][i],dp[j - 1][i + (1 << (j - 1))]);\n\t}\n}\n```  \n### 2.\u67e5\u8be2  \n\u5148\u6839\u636e\u533a\u95f4\u957f\u5ea6\u7b97\u51fa\u4e0a\u6587\u6240\u8bf4$k$  \n\u7531\u4e8e\u9884\u5904\u7406\u65f6\u6bcf\u4e2a\u533a\u95f4\u5bf9\u5e94\u7684\u662f\u5de6\u7aef\u70b9 \u6240\u4ee5\u8981\u8ba1\u7b97\u53f3\u7aef\u70b9\u4e3ar\u7684\u533a\u95f4\u7684\u5de6\u7aef\u70b9  \n\u7531\u4e8e\u662f\u95ed\u533a\u95f4 \u8ba1\u7b97\u957f\u5ea6\u662f$r - l + 1$  \n\u5de6\u7aef\u70b9\u8ba1\u7b97\u65b9\u5f0f:$r - l + 1 = 2^k$  \n$l = (r - 2^k + 1)$  \n\u8fd9\u5f88\u7b80\u5355 \u4f46\u662f\u6211\u89c9\u5f97\u5fc5\u987b\u7ed9\u51fa\u6765\n```cpp\nscanf(\"%d %d\",&l,&r);\nk = LOG[r - l + 1];\nprintf(\"%d\\n\",max(dp[k][l],dp[k][r - (1 << k) + 1]));\n```  \n\n\u5b8c\u6574\u4ee3\u7801:  \n~~\u8fd9\u662f\u6211\u8fdc\u53e4\u65f6\u671f\u5199\u7684\u4e86~~  \n```cpp\n#include <cstdio>\n#include <iostream>\n#include <algorithm>\n#include <cstring>\n#include <cmath>\nusing namespace std;\nint n,m,b,c,k;\nint a[100005] = {0};\nint dp[55][100005] = {0};\nint LOG[100005] = {0};\nint main(){\n\tcin >> n >> m;\n\tfor(int i = 1;i <= n;i ++){\n\t\tscanf(\"%d\",&dp[0][i]);\n\t}\n\tLOG[0] = -1;\n\tfor(int i = 1;i <= 100000;i ++){\n\t\tLOG[i] = LOG[i >> 1] + 1;\n\t}\n\tfor(int j = 1;j <= LOG[n];j ++){\n\t\tfor(int i = 1;i <= n;i ++){\n\t\t\tdp[j][i] = max(dp[j - 1][i],dp[j - 1][i + (1 << (j - 1))]);\n\t\t}\n\t}\n\tfor(int i = 1;i <= m;i ++){\n\t\tscanf(\"%d %d\",&b,&c);\n\t\tk = LOG[c - b + 1];\n\t\tprintf(\"%d\\n\",max(dp[k][b],dp[k][c - (1 << k) + 1]));\n\t}\n\treturn 0;\n}\n```\n\n## 4.\u66f4\u591a\u5e94\u7528\nST\u8868\u540c\u65f6\u4e5f\u662f\u53ef\u4ee5\u8f93\u51fa\u533a\u95f4\u6700\u503c\u6240\u5728\u4f4d\u7f6e  \n\u6539\u53d8\u5224\u65ad\u6761\u4ef6 dp\u6570\u7ec4\u4fdd\u5b58\u4e0b\u6807  \n## 5.\u603b\u7ed3  \n$nlogn$\u9884\u5904\u7406 $O(1)$\u67e5\u8be2\u6700\u503c  \n\u4ee3\u7801\u5b9e\u73b0\u590d\u6742\u5ea6\u4e5f\u4e0d\u9ad8  \n\u5e94\u7528\u8303\u56f4\u867d\u7136\u6ca1\u6709\u7ebf\u6bb5\u6811\u5927 \u4f46\u662fST\u8868\u8fd8\u662f\u503c\u7684\u4e00\u5b66\u7684",
        "postTime": 1558752866,
        "uid": 31440,
        "name": "installb",
        "ccfLevel": 8,
        "title": "[\u7b97\u6cd5\u7b14\u8bb0] ST\u8868"
    },
    {
        "content": "[\u98df\u7528\u6548\u679c\u66f4\u4f73](https://www.cnblogs.com/hbxblog/p/9873469.html)\n\n#### \u9898\u9762\n\n> \u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a$N$\u7684\u6570\u5217\uff0c\u548c$M$\u6b21\u8be2\u95ee\uff0c\u6c42\u51fa\u6bcf\u4e00\u6b21\u8be2\u95ee\u7684\u533a\u95f4\u5185\u6570\u5b57\u7684\u6700\u5927\u503c\u3002  \n\n>\u5bf9\u4e8e30%\u7684\u6570\u636e\uff0c\u6ee1\u8db3\uff1a $1\u2264N,M\u226410$  \n\u5bf9\u4e8e70%\u7684\u6570\u636e\uff0c\u6ee1\u8db3\uff1a $1\u2264N,M\u226410^5$  \n\u5bf9\u4e8e100%\u7684\u6570\u636e\uff0c\u6ee1\u8db3\uff1a $1\u2264N\u226410^5,1\u2264M\u226410^6,a_i\u2208[0,10^9],1\u2264li\u2264ri\u2264N$   \n\n\u7ebf\u6bb5\u6811\u88f8\u4f53\u554a\u3002\n\u4f46\u662f\u8fd9\u9053\u9898\u76ee\u7ebf\u6bb5\u6811\u660e\u663e\u8fc7\u4e0d\u53bb\u8fd9\u9053\u9898\u3002\u6240\u4ee5\u6211\u4eec\u8981\u53e6\u8f9f\u8e4a\u5f84\u6211\u4eec\u89c2\u5bdf\u9898\u76ee\uff0c\u9898\u76ee\u5e76\u6ca1\u6709\u8981\u6c42\u6211\u4eec\u8fdb\u884c\u66f4\u6539\u64cd\u4f5c\uff0c\u6240\u4ee5st\u8868\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002\n\n#### \u524d\u7f6e\u8981\u6c42\n\n1. \u500d\u589e(\u5982\u679c\u4e0d\u4f1a[\u6233\u8fd9](https://www.cnblogs.com/hbxblog/p/9852387.html))\n2. dp(\u5982\u679c\u4e0d\u4f1a[\u6233\u8fd9](http://baidu.physton.com/?q=\u600e\u4e48\u62ef\u6551\u81ea\u5df1\u7684\u4fe1\u7ade\u9053\u8def))\n\n####\u6b63\u6587\n\n\u5982\u679c\u4f60\u4f1a\u4e0a\u9762\u7684\u5185\u5bb9\u4e86,\u90a3\u4e48\u4f60\u53ef\u4ee5\u5f00\u59cb\u5b66st\u8868\u4e86  \nst\u8868\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u500d\u589e+dp  \n\u6211\u4eec\u4ee4$f[i][j]$\u4e3a$[i,i+2^j-1]$\u5185\u7684\u6700\u5927\u503c  \n\u6211\u4eec\u53ef\u4ee5\u5c06$[i,i+2^j-1]$\u5206\u6210\u4e24\u534a\uff0c\u5373$[i,i+2^{j-1}-1]$\u548c$[i+2^{j-1},i+2^j-1]$  \n\u4e24\u6bb5\u7684\u957f\u5ea6\u90fd\u4e3a$2^j$  \n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b`f[i][j]=min(f[i][j-1],f[i+1<<(j-1)-1][j-1])`  \n**\u6ce8\u610f\u9700\u8981\u9884\u5904\u7406\u4e00\u4e0b$f[i][0]$\u7684\u503c**\n\n\u90a3\u4e48\u8be2\u95ee\u600e\u4e48\u529e\uff1f  \n\u5bf9\u4e8e\u4e00\u6bb5\u8be2\u95ee\u7684\u533a\u95f4$[l,r]$  \n\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa\u4ecel\u5230r\u6700\u5c11\u9700\u8981\u52a0\u4e0a2\u7684\u591a\u5c11\u6b21\u65b9,\u5373`k=log(r-l+1)/log(2)`  \n\u8fd9\u91cc\u8fd0\u7528\u5230\u4e86\u6362\u5e95\u516c\u5f0f,\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199\u6210`k=log2(r-l+1)`  \n\n#### code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint read(){\n    int x=0,f=1;char c=getchar();\n    while(c<'0'||c>'9') c=='-'?f=-1,c=getchar():c=getchar();\n    while(c>='0'&&c<='9') x=x*10+c-'0',c=getchar();\n    return x*f;\n}\nint f[100001][21],a[100001],n=read(),m=read(),x,y;\nvoid init(){\n    for(int i=1;i<=n;i++)\n        f[i][0]=a[i];\n    for(int j=1;j<19;j++)\n        for(int i=1;i+(1<<j)-1<=n;i++)\n            f[i][j]=max(f[i][j-1],f[i+(1<<(j-1))][j-1]);\n}\nint find(int x,int y){\n    int k=log(y-x+1)/log(2);\n    return max(f[x][k],f[y-(1<<k)+1][k]);\n}\nint main(){\n    for(int i=1;i<=n;i++)\n        a[i]=read();\n    init();\n    while(m--)\n        x=read(),y=read(),printf(\"%d\\n\",find(x,y));\n    return 0;\n}\n```",
        "postTime": 1540820394,
        "uid": 19805,
        "name": "\u64a4\u4e91",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "$RMQ$\u8fd9\u79cd\u7b97\u6cd5\uff0c\u6709\u597d\u5904\u4e5f\u6709\u574f\u5904\u3002\n\n\u597d\u5904\u662f\u4ee3\u7801\u91cf\u6bd4\u5176\u4ed6\u7b97\u6cd5\uff08\u7ebf\u6bb5\u6811\uff0c\u6811\u72b6\u6570\u7ec4\u7b49\uff09\u7a0d\u77ed\uff0c\u574f\u5904\u662f\u5c40\u9650\u6027\u592a\u5927\uff0c\u4e0d\u5982\u7ebf\u6bb5\u6811\u7075\u6d3b\u3002\n\n\u5b83\u7684\u76ee\u7684\u662f\u6c42\u533a\u95f4\u6700\u503c\u3002\n\n\u6211\u4eec\u5148\u770b\u4e00\u9053\u7b80\u5355\u9898\u3002\n\n\u6709\u4e00\u4e2a\u5e8f\u5217\uff0c\u4ee5\u53ca\u4e00\u4e9b\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u7ed9\u51fa\u4e00\u4e2a\u533a\u95f4$[l,r]$,\u6c42\u8fd9\u4e2a\u533a\u95f4\u7684\u6700\u5927\u503c\u3002\n\n\u5f53\u6211\u4eec\u6446\u8131\u7ebf\u6bb5\u6811\uff0c\u4ece\u53e6\u4e00\u4e2a\u89c6\u89d2\u770b\u8fd9\u9898\u3002\n\n\u6211\u4eec\u628a\u5b83\u60f3\u6210\u4e00\u9053\u533a\u95f4$DP$,\u7528$dp[i][j]$\u8868\u793a\u533a\u95f4$[i,j]$\u7684\u6700\u5927\u503c\u3002\n\n\u663e\u800c\u6613\u89c1\uff0c\u6709$dp[i][j]=max(dp[i][j-1],a[i])$(\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2)$)\n\n\u6211\u4eec\u91c7\u7528\u500d\u589e\u601d\u60f3\uff0c\u7528$dp[i][j]$\u8868\u793a\u4ee5i\u4e3a\u8d77\u70b9\uff0c\u957f\u5ea6\u4e3a2j\u7684\u533a\u95f4\u6700\u5927\u503c\uff0c\u6c42\u89e3\u65f6\u5206\u6210\u4e24\u4e2a\u533a\u95f4$[i,i+2j-1-1],[i+2j-1,i+2j+1]$\n\n\u6709$dp[i][j]=max(dp[i][j-1],dp[i+2j-1][j-1])$\n\n\u7531\u4e8e\u957f\u5ea6\u4e3a$2j$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(nlogn)$\n\n\u4ee5\u4e0a\u662f\u9884\u5904\u7406\u90e8\u5206\u3002\n\n\u5b9e\u9645\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u9700\u8981\u6c42\u89e3\u4e00\u4e2a\u4efb\u610f\u7684\u533a\u95f4\uff0c\u800c\u4e0a\u9762\u7684\u9884\u5904\u7406\u53ea\n\u80fd\u6c42\u51fa\u957f\u5ea6\u4e3a$2j$\u7684\u533a\u95f4\u6700\u5927\u503c\u3002\n\n\u6211\u4eec\u5229\u7528\u4e00\u4e0b\u4e00\u4e2a\u5c0f\u6027\u8d28\uff1a\n\n\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u8981\u628a\u5f85\u67e5\u8be2\u7684\u533a\u95f4\uff0c\u8f6c\u5316\u6210\u4e24\u4e2a\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u7684\u533a\u95f4\u3002\n\n\u627e\u51fa\u6700\u5927\u7684$2k<=len$\u7684$k$\uff0c\u5176\u4e2d$len=r-l+1$\u4e3a\u533a\u95f4\u957f\u5ea6\uff0c\u53d6\u533a\u95f4$[l,l+2k-1],[r-2k+1,r]$\u4e3a\u4e24\u4e2a\u5c0f\u533a\u95f4\uff0c\u663e\u7136\u6ee1\u8db3\u4e14\u80fd\u627e\u5230\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(1)$\n\n\u6a21\u677f\u9898\u4ee3\u7801\uff1a\n\n```\n#include<bits/stdc++.h>\n\n#define rd(x) x=read()\n#define N 100005 \n\nusing namespace std;\n\nint n,m;\nint a[N][25];\n\ninline int read()\n{\n    int f=1,x=0;char s=getchar();\n    while(s<'0'||s>'9'){if(s=='-')f=-1;s=getchar();}\n    while(s>='0'&&s<='9'){x=x*10+s-'0';s=getchar();}\n    return x*f;\n}\n\nint query(int l,int r)\n{\n    int k=log2(r-l+1);\n    return max(a[l][k],a[r-(1<<k)+1][k]);\n}\n\nint main()\n{\n    rd(n);\n    for(int i=1;i<=n;i++)rd(a[i][0]);\n    for(int j=1;j<=21;j++)\n        for(int i=1;i+(1<<j)-1<=n;i++)\n            a[i][j]=max(a[i][j-1],a[i+(1<<(j-1))][j-1]);\n    rd(m);\n    while(m--)\n    {\n        int l,r;\n        rd(l),rd(r);\n        printf(\"%d\\n\",query(l,r));\n    }\n    \n    return 0;\n}\n```\n\u662f\u4e0d\u662f\u611f\u89c9$RMQ$\u5f88\u65b9\u4fbf\u5462\uff0c$RMQ$\u8fd8\u6709\u8bb8\u8bb8\u591a\u591a\u7684\u62d3\u5c55\uff0c\u4e0b\u671f\u518d\u89c1\uff01\n ",
        "postTime": 1562981898,
        "uid": 53807,
        "name": "Erusel",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "@[toc]\n## \u5199\u5728\u524d\u9762\n- \u5728\u5199\u9898\u65f6\u6211\u4eec\u5e38\u5e38\u4f1a\u9047\u89c1$RMQ$\u95ee\u9898\uff08\u533a\u95f4\u6700\u503c\uff09\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6c42\u89e3$RMQ$\u95ee\u9898\uff0c\u6211\u4eec\u6709\u591a\u79cd\u89e3\u6cd5\uff0c\u5982\u7ebf\u6bb5\u6811\uff0c\u5355\u8c03\u961f\u5217\u7b49\u7b49\uff0c\u73b0\u5728\u6211\u8981\u8bb2\u7684\u662f\u4e00\u79cd\u500d\u589e\u89e3\u6cd5\u5373$ST$\u7b97\u6cd5\u3002\n\n## ST\u8bb2\u89e3\n- \u7ed9\u5b9a\u4e00\u6bb5\u5e8f\u5217$A$\uff0c$ST$\u7b97\u6cd5\u80fd\u5728$O(NlogN)$\u7684\u65f6\u95f4\u9884\u5904\u7406\u540e\uff0c\u4ee5$O(1)$\u7684\u590d\u6742\u5ea6\u67e5\u8be2\uff0c\u5728\u7ebf\u56de\u7b54\u5728\u4e00\u6bb5\u533a\u95f4$l, r$\u4e2d\u6700\u5927\uff08\u5c0f\uff09\u503c\u662f\u591a\u5c11\u3002\n- \u5bf9\u4e8e\u4e00\u6bb5\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u53d6\u4e00\u4e9b$2$\u7684\u6574\u6570\u6b21\u5e42\u6765\u4f5c\u4e3a\u4ee3\u8868\u503c\u4ece\u800c\u5212\u5206\u6574\u4e2a\u533a\u57df\u3002\n- \u8bbe$F[i, j]$\u8868\u793a\u5e8f\u5217$A$\u5728\u5b50\u533a\u95f4$[i, i + 2^j-1]$\u5185\u53d6\u5f97\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u663e\u7136\u4e00\u6bb5\u533a\u95f4\u7684\u6700\u5927\u503c\u7b49\u4e8e\u5b83\u5de6\u53f3\u6bb5\u5b50\u533a\u95f4\u7684\u6700\u5927\u503c\u4e2d\u7684\u6700\u5927\u503c\uff0c\u5373$$F[i][j] = max( F[i][j-1], F[i + 2^{j-1} - 1][j - 1])$$\n- \u9012\u63a8\u8fb9\u754c\u4e3a$F[i,0] = A[i]$\n- \u5f53\u6211\u4eec\u67e5\u8be2\u7684\u65f6\u5019\u5ef6\u7528\u521a\u624d\u7684\u601d\u8def\uff0c\u4e00\u4e2a\u533a\u95f4\u7684\u6700\u5927\u503c\u7b49\u4e8e\u5b83\u4e24\u4e2a\u5de6\u53f3\u5b50\u533a\u95f4\u7684\u6700\u5927\u503c\u3002\u8be2\u95ee\u533a\u95f4$[l,r]$\u65f6\uff0c\u6211\u4eec\u9009\u51fa\u4e00\u4e2a\u6570$t$\uff0c\u6ee1\u8db3$2^t <r-l+1 \\leqslant 2^{t+1}$\uff0c\u90a3\u4e48\u4ece$l$\u5f00\u59cb\u7684$2^t$\u4e2a\u6570\u5230\u4ee5$r$\u7ed3\u5c3e\u7684$2^t$\u4e2a\u6570\uff0c\u4e00\u5b9a\u8986\u76d6\u6574\u4e2a\u533a\u95f4$[l,r]$\uff0c\u8fd9\u4e24\u6bb5\u533a\u95f4\u7684\u6700\u5927\u503c\u5206\u522b\u4e3a$F[l,t]$\uff0c$F[r-2^k+1,t]$\uff0c\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n### \u9884\u5904\u7406\n```cpp\nvoid ST_prework() {\n\tfor (int i = 1; i <= n; ++i) f[i][0] = a[i];\n\tfor (int j = 1; j <= 20; ++j) {\n\t\tfor (int i = 1; i <= n - (1 << j) + 1; ++i) {\n\t\t\tf[i][j] = max(f[i][j - 1], f[i + (1 << (j - 1))][j - 1]);\n\t\t}\n\t}\n}\n```\n### \u67e5\u8be2\n```cpp\nint ST_query(int l, int r) {\n\tint _t = log(r - l + 1) / log(2);\n\treturn max(f[l][_t], f[r - (1 << _t) + 1][_t]);\n} \n```\n## \u4f8b\u9898\n[luogu P2251](https://www.luogu.org/problemnew/show/P2251)\n\t\u5728\u6c42\u89e3\u8fc7\u7a0b\u4e2d\u628a$max$\uff0c\u6539\u6210$min$\u5373\u53ef",
        "postTime": 1562626609,
        "uid": 145352,
        "name": "MILLOPE",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "### [\u3010\u6a21\u677f\u3011ST\u8868](https://www.luogu.org/problemnew/show/P3865)\n\n--------\n\nST\u8868\u7684\u529f\u80fd\u5927\u5bb6\u90fd\u5df2\u7ecf\u77e5\u9053\u4e86\uff0c\u90a3\u5c31\u662f\u53ef\u4ee5\u5feb\u901f\u5730\u8fdb\u884c\u533a\u95f4\u67e5\u8be2\u3002\n\n\u5176\u5b9eST\u8868\u5c31\u662f\u4e00\u4e2a\u9012\u63a8\u7684\u8fc7\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u770b\u6210\u662f\u533a\u95f4DP\u7684\u4e00\u79cd\n\n\u6211\u4eec\u5b9a\u4e49 st [ i ] [ j ] \u4e3a\uff1a\u4ece\u7b2c i \u4e2a\u6570\u8d77\uff0c\u957f\u5ea6\u4e3a 2 ^ j \u7684\u533a\u95f4\u7684\u6700\u5927\u503c \n\n\u5343\u4e07\u522b\u5fd8\u8bb0\u8f93\u5165\u8f93\u51fa\u7528 scanf / printf !!!\n\n\u770b\u7740\u4ee3\u7801\uff0c\u81ea\u5df1\u753b\u56fe\u8ba1\u7b97\u4e00\u4e0b\uff0c\u8fd8\u662f\u5f88\u597d\u7406\u89e3\u7684\n\n\u65f6\u523b\u7262\u8bb0\u957f\u5ea6\u662f 2 ^ j\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cmath>\n#include <algorithm>\nusing namespace std;\n\nint n,m;\nint a[100004],st[112345][30];\nint l,r;\n\nvoid start()\n{\n\tfor(int i=1; i<=n; i++)\n\t{\n\t\tst[i][0] = a[i];\n\t}\n\t\n\tfor(int j=1; (1<<j) <= n; j++)\n\t{\n\t\tfor(int i=1; i + ( 1 << (j-1) ) <= n; i++)\n\t\t{\n\t\t\tst[i][j] = max( st[i][j-1] , st[ i + ( 1<<(j-1) ) ][j-1] );\n\t\t}\n\t}\n}\n\nint find_max( int l , int r )\n{\n\tint tem = (int)( log2( r-l+1 ) );\n\t\n\treturn max( st[l][tem] , st[ r - (1<<tem) + 1 ][tem] );\n}\n\nint main()\n{\n\tcin >> n >> m;\n\t\n\tfor(int i=1; i<=n; i++) scanf( \"%d\" , &a[i] );\n\t\n\tstart();\n\t\n\tfor(int i=1; i<=m; i++)\n\t{\n\t\tscanf( \"%d%d\" , &l,&r );\n\t\t\n\t\tprintf( \"%d\\n\" , find_max( l , r ) ); \n\t}\n\nreturn 0;\t\n}\n\n\n\n\n```\n\n\n\n\n",
        "postTime": 1559116572,
        "uid": 99403,
        "name": "\u4fe1\u8d56\u6ef4\u661f\u8fb0",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "\u4e4b\u524d\u542c\u5b8c\u8bfe\u521a\u597d\u770b\u5230\u5e94\u8be5\u662f\u521a\u51fa\u6765\u7684st\u8868\u6a21\u677f\u9898\u5c31\u5199\u4e86\u4e00\u53d1\u3002\uff08QwQ\u6211\u60f3\u6211\u4e0d\u4f1a\u7528Markdown\n\n- st\u8868\uff08\u7a00\u758f\u8868\uff09\u662f\u89e3\u51b3RMQ\u95ee\u9898\u4e00\u4e2a\u5e38\u7528\u7684\u65b9\u6cd5\uff08\u5199\u8d77\u6765\u65b9\u4fbf\u8dd1\u7684\u4e5f\u4e0d\u6162.\n\n-  \u4e3b\u8981\u601d\u60f3\u5e94\u8be5\u662f\u500d\u589e\u4ee5\u53ca\u533a\u95f4$dp$ .\n\n- \u4ee5\u6a21\u677f\u91cc\u6c42\u533a\u95f4\u6700\u5927\u503c\u4e3a\u4f8b\uff0c\u8bb0$a[i]$ \u4e3a\u539f\u6570\u7ec4\uff0c$f[i][j]$ \u8868\u793a\u533a\u95f4 [i,i+${2^j}$-1] \u7684\u7b54\u6848.\n\n- \u8003\u8651\u628a\u533a\u95f4\u5206\u6210\u4e24\u90e8\u5206\uff0c\u4e8e\u662f$dp[i][j]$ =max($dp[i][j-1]$,$dp[i+2^{j-1}][j-1]$).\n\n- $dp[i][0]=a[i]$.\n\n- \u67e5\u8be2\u533a\u95f4 $[l,r]$ \u65f6\u53ea\u8981\u627e\u4e00\u4e2a$k=floor(log_2 (r-l+1))$\uff0c\u7136\u540e\u5bf9$f[l][k]$ \u548c $f[r-2^k+1][k]$ \u53d6\u6700\u503c\u5c31\u597d\u5566\uff0c\u8fd9\u4e24\u4e2a\u8868\u793a\u7684\u6070\u597d\u5c31\u662f\u533a\u95f4 $[l,l+2^k-1]$ \u548c $[r-2^k+1,r]$.\n\n- \u9884\u5904\u7406$O(nlogn)$ \uff0c\u5355\u6b21\u67e5\u8be2$O(1)$ \uff0c\u603b\u590d\u6742\u5ea6$O(nlogn+m)$.\n\n- ~~\u4e0d\u559c\u6b22\u7528\u81ea\u5e26\u7684log\u6240\u4ee5\u5c31\u81ea\u5df1\u5199\u4e00\u4e2a\u597d\u5566=w=~~\n\n\n\n```cpp\n#include<cstdio>\nconst int N=100005;\nint n,m,L,R;\nint Log[N],f[N][20];\ninline int read()\n{\n    int s=0,f=1;char c=getchar();\n    while(c<'0'||c>'9'){if(c=='0')f=-1;c=getchar();}\n    while(c>='0'&&c<='9'){s=s*10+c-'0';c=getchar();}\n    return s*f;\n}\ninline int max(int x,int y){return x>y?x:y;}\ninline int query(int l,int r)\n{\n    int k=Log[r-l+1];\n    return max(f[l][k],f[r-(1<<k)+1][k]);\n}\nint main()\n{\n    n=read();m=read();\n    for(int i=1;i<=n;i++)f[i][0]=read();\n    Log[0]=-1;for(int i=1;i<=n;i++)Log[i]=Log[i>>1]+1;////log_2(2i)=log_2(i)+log_2(2)=log_2(i)+1\n    for(int i=1;i<=20;i++)\n        for(int j=1;j+(1<<i)-1<=n;j++)\n            f[j][i]=max(f[j][i-1],f[j+(1<<(i-1))][i-1]);///\u9884\u5904\u7406f\u6570\u7ec4 \n    while(m--)\n    {\n        scanf(\"%d%d\",&L,&R);\n        printf(\"%d\\n\",query(L,R)); \n    }\n    return 0;\n}\n*\uff08\u5982\u6709\u95ee\u9898\u8fd8\u8bf7\u6307\u51faqwq.*\n```",
        "postTime": 1502362166,
        "uid": 22380,
        "name": "Yoshinow2001",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "\u611f\u89c9\u81ea\u5df1\u5199\u6cd5\u8ddf\u9898\u89e3\u91cc\u7684\u4e0d\u592a\u4e00\u6837\u6240\u4ee5\u6765\u53d1\u4e00\u7bc7\u9898\u89e3\n\n\u8003\u8651\u500d\u589e, \u6211\u4eec\u8bbe$f(i, t)$\u4e3a$a$\u6570\u7ec4\u4e2d\u4e0b\u6807\u5728\u533a\u95f4$[i, i+2^t]$\u4e2d\u7684\u6570\u7684\u6700\u5927\u503c, \u5fc5\u6709$a$\u6570\u7ec4\u4e2d\u4e0b\u6807\u5728\u533a\u95f4$[i, i+2^t]$\u4e2d\u7684\u6570\u7684\u6700\u5927\u503c\u7b49\u4e8e$a$\u6570\u7ec4\u4e2d\u4e0b\u6807\u5728\u533a\u95f4$[i, i+\\lambda]$\u53ca$[i+\\lambda, i+2^t]$\u4e2d\u6570\u7684\u6700\u5927\u503c, \u53d6$\\lambda = 2^{t-1}$\u53ef\u5f97\n\n$$\nf(i,t) = max\\{f(i, t-1), f(i+2^{t-1}, t-1)\\}\n$$\n\n\u5c1d\u8bd5\u8868\u793a$a$\u6570\u7ec4\u4e2d\u4e0b\u6807\u5728\u533a\u95f4$[i, i+t]$\u4e2d\u7684\u6570\u7684\u6700\u5927\u503c, \u4e3a\u6b64\u8bbe$0 < \\lambda < t$, \u53ea\u9700\u6c42\u51fa$a$\u6570\u7ec4\u4e2d\u4e0b\u6807\u5728\u533a\u95f4$[i, i+\\lambda]$\u4ee5\u53ca$[i+t-\\lambda, i+t]$\u4e2d\u6570\u7684\u6700\u5927\u503c, \u4e3a\u4e86\u5229\u7528\u8bbe\u51fa\u7684$f$\u4ee4$\\lambda = 2^p$, \u5f97\u51fa\u5982\u4e0b\u4e0d\u7b49\u5f0f\n\n1. $t-i+1 \\leq 2 \\times 2^p$\n2. $i+2^p \\leq t$\n3. $i \\leq i+t- 2^p$\n\n\u7531$2,3$\u6709$2^p \\leq t-i$, \u76f4\u63a5\u53d6$p = \\lfloor log_2(t-i)\\rfloor$\u5373\u53ef\u6ee1\u8db3\u6761\u4ef6, \u5c06$p$\u5e26\u51651, \u5f971\u7b49\u4ef7\u4e8e$(t-i) + 1 \\leq 2 \\times (t-i)$, \u5728$t-i>0$(\u5373$t \\not= i$)\u65f6\u6210\u7acb, \u800c$t=i$\u65f6\u76f4\u63a5\u56de\u7b54\u8be2\u95ee\u5373\u53ef\n\n```cpp\n#include<bits/stdc++.h>\n#include<cmath>\nusing namespace std;\nint Mx[100005][20], n, m, a[100005], mx1;\nint query(int l, int r){\n\tif(l == r) return a[l];\n\tint len = r-l; int k = log(len) / log(2);\n\treturn max(Mx[l][k], Mx[r-(1<<k)][k]);\n} \nint main(){\n\tscanf(\"%d\", &n); scanf(\"%d\", &m);\n\tfor(int i=1;i<=n;++i) scanf(\"%d\", &a[i]);\n\tfor(int i=1;i+1<=n;++i){\n\t\tMx[i][0] = max(a[i], a[i+1]); \n\t}\n\tfor(int k=1;(1<<k)<n;++k){\n\t\tfor(int i=1;i+(1<<k)<=n;++i){\n\t\t\tMx[i][k] = max(Mx[i][k-1], Mx[i+(1<<(k-1))][k-1]) ;\n\t\t}\n\t}\n\tfor(int i=1;i<=m;++i){\n\t\tint l,r; scanf(\"%d%d\", &l, &r);\n\t\tprintf(\"%d\\n\", query(l,r)) ;\n\t}\n}\n```",
        "postTime": 1573461415,
        "uid": 133345,
        "name": "lightup37",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    },
    {
        "content": "43\u7bc7\u9898\u89e3\uff0c\u8fc7\u4e0d\u4e86\u5c31\u5f53\u505a\u4e00\u7bc7\u7b14\u8bb0\u597d\u4e86\u3002\n\nST\u8868\u662f\u4e00\u79cd\u9884\u5904\u7406nlog\uff08n\uff09\uff0c\u67e5\u8be2O\uff081\uff09\u7684\u7b97\u6cd5\uff0c\u7528\u4e8e\u5904\u7406**\u65e0\u4fee\u6539**\u7684\u533a\u95f4\u6700\u503c\u95ee\u9898\u3002\n\n* \u7b80\u4ecbST\u8868\n\n\u5176\u5b9e\u6211\u662f\u5148\u5b66\u500d\u589eLCA\u518d\u5b66ST\u8868\u7684\uff0c~~\u522b\u95ee\u4e3a\u4ec0\u4e48\u987a\u5e8f\u8fd9\u4e48\u5947\u602a~~\uff0c\u6240\u4ee5\u770b\u5230ST\u8868\u7684\u505a\u6cd5\u5c31\u89c9\u5f97\u975e\u5e38\u719f\u6089.**\u5b83\u662f\u7528ans[i][j]\u8868\u793a\u4ecej\u5f00\u59cb\u7684$2 ^ i$\u4e2a\u6570\u7684\u6700\u503c**\uff0c\u4e5f\u5c31\u662fj ~ j + $2 ^ i$ - 1 \u7684\u6700\u503c\u3002\n\n* \u5982\u4f55\u6c42\u8fd9\u4e2a\u6570\u7ec4\u7684\u503c\n\n\u660e\u663e\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u533a\u95f4\u4e8c\u5206\uff0c\u5206\u4e3aj ~ j + $2 ^ {i - 1} $ - 1\u548cj +$2 ^ {i - 1}$ ~ j + $2 ^ i$ - 1\uff0c\u53ef\u4ee5\u770b\u56fe\u7406\u89e3\u4e00\u4e0b\u3002\uff08\u4e0a\u9762\u662f\u6570\u7ec4\u4e0b\u8868\uff0c\u4e0b\u9762\u662fa\u6570\u7ec4\u7684\u503c\uff09\n\n![](https://cdn.luogu.com.cn/upload/pic/75118.png)\n\n\u8fd9\u6837\u5c31\u5c06\u5927\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\u5c0f\u95ee\u9898\uff0c\u6bcf\u6b21\u8ba1\u7b97ans[i][j]\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u4ece**ans[i-1][j]\u548cans[i-1][j + pow(2,i)]\u53d6\u6700\u5927\u503c\u3002**\n\n\u7531\u4e8ei\u7684\u95ee\u9898\u53ea\u4e0ei-1\u7684\u5b50\u95ee\u9898\u76f8\u5173\u3002\u76f4\u63a5i\u4ece1~n\u5faa\u73af\u4e00\u904d\uff0c\u6bcf\u4e00\u904d\u5faa\u73af\u8ba1\u7b97\u6bcf\u4e2aj\u7684ans[i][j]\u7684\u503c\uff0c\u5c31\u53ef\u4ee5O\uff08nlog\uff08n\uff09\uff09\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u4e2aans[i][j]\u3002**\u8bb0\u5f97\u8981\u7ed9ans[0][j]\u8d4b\u4e0aa[j]**\uff08\u56e0\u4e3a\u957f\u5ea6\u4e3a$2 ^ 0$\u7684\u533a\u95f4\u53ea\u6709\u4e00\u4e2a\u6570\uff0c\u5c31\u662f\u81ea\u5df1\uff09\n\n* \u67e5\u8be2\uff1a\n\n\u6bcf\u4e00\u6b21\u9700\u8981\u67e5\u8be2\u533a\u95f4\uff08x\uff0cy\uff09\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u600e\u4e48\u67e5\u8be2\u5462\uff1f\n\n~~\u5f53\u7136\u662f\u5c06i\u4ecelog\uff08n\uff09\u5f00\u59cb\u52300\u5faa\u73af\uff0c\u4e00\u5f00\u59cb\u7ad9\u5728x\u70b9\uff0c\u6bcf\u6b21\u80fd\u8df3\u5219\u8df3\uff0c\u7136\u540e\u53d6\u4e00\u4e2a\u6700\u5927\u503c\u5566~~\n\n\u54b3\u54b3\uff0c\u6240\u4ee5\u500d\u589eLCA\u8fd8\u662f\u548cST\u8868\u6709\u4e0d\u540c\u4e4b\u5904\u7684\uff0cST\u8868\u7684\u67e5\u8be2\u548c\u8fd9\u4e2a\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u7b80\u5355\u4e00\u70b9\uff0c\u6765\u770b\u8fd9\u4e2a\u533a\u95f4\u3002\n\n![](https://cdn.luogu.com.cn/upload/pic/75119.png)\n\n\u5176\u5b9e\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u76f4\u63a5\u8f93\u51famax\uff08ans[2][3]\uff0cans[2][5]\uff09\u7684\u503c\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u6837\u5c31\u8986\u76d6\u4e86\u6574\u4e2a\u533a\u95f4\uff0c\u800c\u91cd\u590d\u90e8\u5206\u7531\u4e8e\u662f\u6700\u5927\u503c\uff0c\u6240\u4ee5\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u68b3\u7406\u4e00\u4e0b\u4e00\u822c\u60c5\u51b5\uff0c\u5982\u4f55\u7528ST\u8868\u67e5\u8be2\u533a\u95f4\uff08x\uff0cy\uff09\u7684\u6700\u5927\u503c\uff1a\n\n\u8bbek = log\uff08y - x + 1\uff09\uff08\u5176\u5b9e\u5c31\u662f\u6c42x ~ y\u6240\u5305\u542b\u7684\u70b9\u7684\u6570\u91cf\u7684log\uff09\uff0c\u7b54\u6848\u662f**max\uff08ans[k][x]\uff0cans[k][y-pow\uff082\uff0ck\uff09+ 1]\uff09**\n\n\uff08\u4e5f\u5c31\u662f\u4ecex\u5411\u53f3\u4f38\u5c55$2 ^ k$\u4e2a\u6570\u4e2d\u7684\u6700\u5927\u503c\uff0c\u548c\u4ecey\u5411\u5de6\u4f38\u5c55$2 ^ k$\u4e2a\u6570\u4e2d\u7684\u6700\u5927\u503c\uff0c\u53d6\u4e00\u4e2a\u6700\u5927\u503c\u4f5c\u4e3a\u7b54\u6848\uff09\n\n* \u4e3a\u4ec0\u4e48\u8fd9\u6837\u4e00\u5b9a\u8986\u76d6\u6574\u4e2a\u533a\u95f4\n\n\u6211\u4fdd\u8bc1\u4e2d\u5b66\u751f\u90fd\u53ef\u4ee5\u770b\u61c2\u3002~~\u4f60\u6b67\u89c6\u5c0f\u5b66\u5b66\u5386\u7684\u4eba\uff1f~~\n\n\u8fd9\u91cc\u53ef\u4ee5\u7528\u53cd\u8bc1\u6cd5\u8bc1\u660e\uff1a\n\n\u5047\u8bbe\u5728\u533a\u95f4\uff08x\uff0cy\uff09\u4e2d\u6709\u4e00\u6bb5\uff08a\uff0cb\uff09\uff0c\u662f\u4e0d\u88ab\uff08x\uff0cx + $2 ^ k$\uff09\u548c\uff08y - $2 ^ k$ + 1 \uff0c y\uff09\u6240\u8986\u76d6\u7684\u3002\u90a3\u4e48\uff08x\uff0cx + $2 ^ k$\uff09\u548c\uff08y - $2 ^ k$ + 1 \uff0c y\uff09\u4e00\u5b9a\u4e0d\u76f8\u4ea4\uff08\u5982\u679c\u76f8\u4ea4\u5c31\u5b8c\u5168\u8986\u76d6\u4e86\uff09\uff0c\u5373y - x + 1>= 2 * $2 ^ k$\u3002\n\n\u56de\u987e\u4e00\u4e0bk\u7684\u5b9a\u4e49\uff0clog(y - x + 1\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4y - x + 1 >= 2 * \uff08y - x + 1\uff09\uff0c\u663e\u7136\u4e0d\u53ef\u80fd\uff0c\u6240\u4ee5\u8fd9\u4e24\u6bb5\u4e00\u5b9a\u8986\u76d6\u6574\u4e2a\u533a\u95f4\u3002\n\n\u653e\u4e0a\u672c\u9898AC\u4ee3\u7801\uff08\u4ec5\u4f9b\u53c2\u8003\uff0c\u4f18\u5316\u770b\u4e0d\u61c2\u5c31\u522b\u770b\u4e86\uff09\uff1a\n\n```\n#include <cstdio>\n#define max(a,b) a>b?a:b\nint n,m;\nint ans[20][100005],p[20],lo[200005];\n\nint read(){\n\tint x = 0;\n\tchar ch = getchar();\n\twhile(ch < '0' || ch > '9'){\n\t\tch = getchar();\n\t}\n\twhile(ch >= '0' && ch <= '9'){\n\t\tx = x * 10 + ch - '0';\n\t\tch = getchar();\n\t}\n\treturn x;\n}\n\nint main(){\n    n = read(),m = read();\n\tp[0] = 1; \n    for(int i = 1;i <= 17;i++){\n    \tp[i] = p[i - 1] * 2;\n    \tlo[p[i]] = i;\n    }\n    for(int i = 1;i <= n;i++){\n    \tans[0][i] = read();\n    \tif(!lo[i]){\n    \t\tlo[i] = lo[i - 1];\n    \t}\n    }\n    for(int i = 1;i <= 17;i++){\n    \tfor(int j = 1;j + p[i] - 1 <= n;j++){\n    \t\tans[i][j] = max(ans[i - 1][j],ans[i - 1][j + p[i - 1]]);\n    \t}\n    }\n    int x,y;\n    for(int i = 1;i <= m;i++){\n    \tx = read(),y = read();\n    \tint k = lo[y - x + 1];\n    \tprintf(\"%d\\n\",max(ans[k][x],ans[k][y - p[k] + 1]));\n    }\n\treturn 0;\n}\n```\n\n\u6700\u540e\u8bf4\u4e00\u53e5\uff0c\u672c\u9898\u96be\u5ea6\u5e94\u8be5\u4e0d\u6b62\u9ec4\u5427\uff0c\u601d\u7ef4\u96be\u5ea6\u8fd8\u662f\u633a\u5927\u7684\u3002\n",
        "postTime": 1566831148,
        "uid": 49776,
        "name": "chenxinyang2006",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3865 \u3010\u3010\u6a21\u677f\u3011ST\u8868\u3011"
    }
]