[
    {
        "content": "\u5bf9\u4e8e\u4e00\u6bb5 $p$ \u76f8\u540c\u7684\u533a\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u91cc\u9762\u7684\u74f7\u7816\u968f\u610f\u8c03\u6362\u3002\n\n\u8003\u8651\u5982\u4f55\u8d2a\u5fc3\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u7684\u76ee\u7684\u4e0d\u540c\uff1a\n\n![](https://pufanyi.pages.dev/WF2019A/case1.png)\n\n\u6b64\u65f6\u6211\u4eec\u662f\u60f3\u8ba9\u5339\u914d\u5b8c $a$ \u4e2d $p=2$ \u60c5\u51b5\u540e\uff0c$b$ \u4e2d\u5269\u4f59\u7684 $p=3$ \u7684\u74f7\u7816\u7684 $h$ \u5c3d\u91cf\u5c0f\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5c06 $a$ \u4e2d $p=2$ \u7684\u6bcf\u5757\u74f7\u7816\u90fd\u627e\u5230 $b$ \u4e2d\u4e00\u4e2a\u6070\u597d\u6bd4\u5b83\u5c0f\u7684\u74f7\u7816\u8fdb\u884c\u5339\u914d\u3002\n\n![](https://pufanyi.pages.dev/WF2019A/case2.png)\n\n\u6b64\u65f6\u6211\u4eec\u662f\u60f3\u8ba9\u5339\u914d\u5b8c $b$ \u4e2d $p=2$ \u7684\u60c5\u51b5\u540e $a$ \u4e2d\u5269\u4f59\u7684 $p=3$ \u7684\u74f7\u7816\u7684 $h$ \u5c3d\u91cf\u5927\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5c06 $b$ \u4e2d $p=2$ \u7684\u6bcf\u5757\u74f7\u7816\u90fd\u627e\u5230 $a$ \u4e2d\u4e00\u4e2a\u6070\u597d\u6bd4\u5b83\u5927\u7684\u74f7\u7816\u8fdb\u884c\u5339\u914d\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u76ee\u524d\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u53ef\u4ee5\u586b\u54ea\u4e9b\u6570\uff0c\u5982\u679c $a$ \u4e2d\u53ef\u586b\u7684\u6570\u6bd4 $b$ \u4e2d\u5c11\uff0c\u90a3\u4e48\u662f\u60c5\u51b5\u4e00\uff0c\u5426\u5219\u5c31\u662f\u60c5\u51b5\u4e8c\u3002\n\n```cpp\n#include <cstdio>\n#include <set>\n#include <iostream>\n#include <algorithm>\n\nusing namespace std;\n\nconst int inf = 0x3f3f3f3f;\nconst int maxn = 500005;\n\nstruct sxd\n{\n\tint p, h, id;\n\tfriend bool operator < (sxd a, sxd b) { return a.p < b.p; }\n};\n\nstruct pii\n{\n\tint x, y;\n\tfriend bool operator < (pii a, pii b) { return a.x < b.x; }\n\tpii (int x = 0, int y = 0) { this->x = x, this->y = y; }\n};\n\nmultiset<pii> sta, stb;\n\nint n;\n\nsxd aa[maxn];\nsxd bb[maxn];\n\nint ansa[maxn];\nint ansb[maxn];\n\nint main()\n{\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i <= n; ++i)\n\t{\n\t\tscanf(\"%d\", &aa[i].p);\n\t\taa[i].id = i;\n\t}\n\tfor(int i = 1; i <= n; ++i)\n\t\tscanf(\"%d\", &aa[i].h);\n\tfor(int i = 1; i <= n; ++i)\n\t{\n\t\tscanf(\"%d\", &bb[i].p);\n\t\tbb[i].id = i;\n\t}\n\tfor(int i = 1; i <= n; ++i)\n\t\tscanf(\"%d\", &bb[i].h);\n\tsort(aa + 1, aa + n + 1);\n\tsort(bb + 1, bb + n + 1);\n\tfor(int i = 1, nowa = 0, nowb = 0; i <= n; ++i)\n\t{\n\t\tif(sta.empty())\n\t\t{\n\t\t\tnowa++;\n\t\t\tsta.insert(pii(aa[nowa].h, aa[nowa].id));\n\t\t\twhile(nowa + 1 <= n && aa[nowa].p == aa[nowa + 1].p)\n\t\t\t{\n\t\t\t\tnowa++;\n\t\t\t\tsta.insert(pii(aa[nowa].h, aa[nowa].id));\n\t\t\t}\n\t\t}\n\t\tif(stb.empty())\n\t\t{\n\t\t\tnowb++;\n\t\t\tstb.insert(pii(bb[nowb].h, bb[nowb].id));\n\t\t\twhile(nowb + 1 <= n && bb[nowb].p == bb[nowb + 1].p)\n\t\t\t{\n\t\t\t\tnowb++;\n\t\t\t\tstb.insert(pii(bb[nowb].h, bb[nowb].id));\n\t\t\t}\n\t\t}\n\t\tif(sta.size() < stb.size())\n\t\t{\n\t\t\tset<pii>::iterator it = stb.lower_bound(pii((sta.rbegin())->x, 0));\n\t\t\tif(it == stb.begin())\n\t\t\t{\n\t\t\t\tputs(\"impossible\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\t--it;\n\t\t\tansa[i] = (sta.rbegin())->y;\n\t\t\tansb[i] = it->y;\n\t\t\tsta.erase(--sta.end());\n\t\t\tstb.erase(it);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tset<pii>::iterator it = sta.upper_bound(pii((stb.begin())->x, 0));\n\t\t\tif(it == sta.end())\n\t\t\t{\n\t\t\t\tputs(\"impossible\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tansa[i] = it->y;\n\t\t\tansb[i] = (stb.begin())->y;\n\t\t\tsta.erase(it);\n\t\t\tstb.erase(stb.begin());\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; ++i)\n\t\tprintf(\"%d \", ansa[i]);\n\tputs(\"\");\n\tfor(int i = 1; i <= n; ++i)\n\t\tprintf(\"%d \", ansb[i]);\n\treturn 0;\n}\n```",
        "postTime": 1585529018,
        "uid": 84088,
        "name": "pufanyi",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6251 \u3010[ICPC2019 WF] A.Azulejos\u3011"
    },
    {
        "content": "\u7ec6\u8282\u9898\n\n - \u53eb\u7b2c\u4e00\u4e2a\u74f7\u7816\u5e8f\u5217\uff08\u540e\u9762\uff09 $A$\uff0c\u7b2c\u4e8c\u4e2a\u74f7\u7816\u5e8f\u5217\uff08\u524d\u9762\uff09$B$\u3002\n - \u53eb\u7b2c $i$ \u4e2a\u74f7\u7816 $(A|B)_i$\u3002\n - \u53eb\u4e00\u4e2a\u74f7\u7816\u7684\u4ef7\u503c $(A|B)_i^P$\u3002\n - \u53eb\u4e00\u4e2a\u74f7\u7816\u7684\u5927\u5c0f $(A|B)_i^S$\u3002\n\n\u6ce8\u610f\u5230\u5bf9\u4e8e\u7b54\u6848\u4e24\u4e2a\u74f7\u7816\u5e8f\u5217\uff0c\u8fd9\u4e9b\u74f7\u7816\u7684\u4ef7\u94b1\u5e8f\u5217\u552f\u4e00\uff0c\u56e0\u4e3a\u4ef7\u94b1\u5fc5\u987b\u4e0a\u5347\u3002\u56e0\u6b64\u6211\u4eec\u5148\u4ffa\u4ef7\u94b1\u6392\u5e8f\uff0c\u8003\u8651\u600e\u4e48\u5728\u4ef7\u94b1\u76f8\u540c\u7684\u4e00\u6bb5\u74f7\u7816\u91cd\u65b0\u6392\u5217\u4f7f\u5f97\u5408\u6cd5\u3002\n\n\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u6392\u597d\u5e8f\u4e86\uff1a\n\n$$A_0^P\\le A_1^P\\le A_2^P\\le\\dots\\le A_{n-1}^P$$\n$$B_0^P\\le B_1^P\\le B_2^P\\le\\dots\\le B_{n-1}^P$$\n\n\u6700\u540e\u628a\u7b54\u6848\u6570\u7ec4\u8fdb\u884c\u91cd\u65b0\u6807\u53f7\u3002\n\n\u5982\u679c\u6211\u4eec\u6c42\u5230\u4e86\u7b54\u6848\u6570\u7ec4\u7684 $[0,i-1]$ \u4f4d\u7f6e\u4e86\uff0c\u600e\u4e48\u6392\u5217\u540e\u9762\uff1f\n\n\u5047\u8bbe\u6709 $p_{S=(A|B)}=max(j:S_i^P=S_{i+1}^P=\\dots=S_j^P)+1$\n\n\u6700\u957f\u7684\u4e00\u76f4\u4ef7\u503c\u4e00\u6837\u7684\u5757\uff08\u56e0\u6b64\u4e5f\u662f\u53ef\u4ee5\u968f\u610f\u91cd\u62cd\u7684\u5feb\uff09\u4e3a $\\min(p_A,p_B)-1$\n\n\u6211\u4eec\u60f3\u628a\u95ee\u9898\u4ece\n>\u505a\u597d $[0,i-1]$ \u4f4d\u7f6e\u4e86\uff0c\u600e\u4e48\u505a\u540e\u9762\n\n\u53d8\u6210  \n>\u505a\u597d $[0,\\min(p_A,p_B)-1]$ \u4f4d\u7f6e\u4e86\uff0c\u600e\u4e48\u505a\u540e\u9762\n\n\u6709\u4e24\u4e2a\u60c5\u51b5\uff1a\n\n1. $p_A<p_B$\uff0c\u8fd9\u4e2a\u65f6\u5019 $B$ \u4f1a\u6709\u5269\u4f59\uff0c\u60f3\u8ba9\u5269\u4f59\u5c3d\u91cf\u5c0f\u6765\u8ba9\u540e\u9762\u5339\u914d\u66f4\u591a\u53ef\u80fd\u6027\n2. $p_A\\ge p_B$\uff0c\u8fd9\u4e2a\u65f6\u5019 $A$ \u53ef\u80fd\u4f1a\u6709\u5269\u4f59\uff0c\u60f3\u8ba9\u5269\u4f59\u5c3d\u91cf\u5927\u6765\u8ba9\u540e\u9762\u5339\u914d\u66f4\u591a\u53ef\u80fd\u6027\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u60c5\u51b5\uff0c\u679a\u4e3e $i\\le idx<p_A$\uff0c\u5bf9 $A_{idx}$ \u627e\u4e00\u4e2a $i\\le j<p_B$ \u4f7f\u5f97 $A_{idx}^S>B_j^S$ \u5e76\u4e14 $B_j^S$ \u6700\u5927\uff08\u6765\u8ba9\u66f4\u5c0f\u7684\u5269\u4e0b\uff09\n\n\u5bf9\u60c5\u51b5 2 \u505a\u7c7b\u4f3c\u7684\u679a\u4e3e\uff0c\u552f\u4e00\u533a\u522b\u662f\u5728 $A$ \u91cc\u9762\u641c\u6700\u5c0f $B_j^S$ \u4f7f\u5f97 $B_j^S>A_{idx}^S$\u3002\n\n\u8fd9\u4e9b\u663e\u7136\u53ef\u4ee5\u7528 $set$ \u7b49\u652f\u6301\u5220\u9664\uff0c\u4e8c\u5206\u7684\u65e0\u5e8f\u6570\u636e\u7ed3\u6784\u3002\n\n\u9884\u5904\u7406 $p_S$ \u5c31\u53ef\u4ee5\u8fc7\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n// writer: w33z8kqrqk8zzzx33\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define iter(i, a, b) for(int i=(a); i<(b); i++)\n#define rep(i, a) iter(i, 0, a)\n#define rep1(i, a) iter(i, 1, (a)+1)\n#define fi first\n#define se second\n#define pb push_back\n \n#define ll long long\n#define pii pair<int, int>\n//#define int ll\nconst int MOD = 1000000007;\n\nmap<int, set<pii>> A, B;\nint Aend[500005], Bend[500005];\nint Tmp1[500005], Tmp2[500005];\nint pr1[500005], pr2[500005];\nint r1[500005], r2[500005];\n\nvoid halt() {\n    cout << \"impossible\" << endl;\n    exit(0);\n}\n\nint n;\n\nvoid solve(int idx) {\n    if(idx == n) return;\n    int pa = pr1[idx], pb = pr2[idx];\n    if(Aend[idx] > Bend[idx]) {\n        for(auto& dx:B[pb]) {\n            int ht = dx.fi;\n            // find one taller than this in A[pa] but is shortest\n            auto k = A[pa].lower_bound({ht+1, -1});\n            if(k == A[pa].end()) halt();\n            r1[idx] = k->se; r2[idx] = dx.se;\n            idx++;\n            A[pa].erase(k);\n        }\n        B.erase(pb);\n        solve(idx);\n    } else {\n        for(auto& dx:A[pa]) {\n            int ht = dx.fi;\n            // find one shorter than this in A[pa] but is tallest\n            auto k = B[pb].lower_bound({ht, -1});\n            if(k == B[pb].begin()) halt();\n            k = prev(k);\n            r1[idx] = dx.se; r2[idx] = k->se;\n            idx++;\n            B[pb].erase(k);\n        }\n        A.erase(pa);\n        solve(idx);\n    }\n}\n\nsigned main() {\n    ios_base::sync_with_stdio(false); cin.tie(0);\n    cin >> n;\n    rep(i, n) cin >> Tmp1[i];\n    rep(i, n) cin >> Tmp2[i];\n    rep(i, n) A[Tmp1[i]].insert({Tmp2[i], i});\n    rep(i, n) cin >> Tmp1[i];\n    rep(i, n) cin >> Tmp2[i];\n    rep(i, n) B[Tmp1[i]].insert({Tmp2[i], i});\n    int idx;\n    idx = 0;\n    for(auto& p:A) {\n        int bbBB = idx + p.se.size();\n        for(auto& _p:p.se) {\n            Aend[idx] = bbBB;\n            pr1[idx] = p.fi;\n            idx++;\n        }\n    }\n    assert(idx == n);\n    idx = 0;\n    for(auto& p:B) {\n        int bbBB = idx + p.se.size();\n        for(auto& _p:p.se) {\n            Bend[idx] = bbBB;\n            pr2[idx] = p.fi;\n            idx++;\n        }\n    }\n    assert(idx == n);\n    solve(0);\n    rep(i, n) cout << r1[i]+1 << ' ';\n    cout << endl; rep(i, n) cout << r2[i]+1 << ' ';\n}\n```",
        "postTime": 1594273114,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6251 \u3010[ICPC2019 WF]Azulejos\u3011"
    }
]