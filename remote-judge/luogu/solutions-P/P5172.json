[
    {
        "content": "\u7b80\u5355\u7c7b\u6b27\u9898\uff0c\u7ed9\u5b9a $n,r$ \u6c42\uff1a\n\n$$\\sum_{d=1}^{n}(-1)^{\\left\\lfloor d\\sqrt{r} \\right\\rfloor}$$\n\n\u5982\u679c $r$ \u80fd\u5f00\u51fa\u6765\u5c31\u592a\u597d\u4e86\uff0c\u53ef\u60dc\u4e0d\u4e00\u5b9a\u53ef\u4ee5\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u63a8\u5f0f\u5b50\u3002\n\n## \u7b80\u5355\u5904\u7406\n\n\u5f53 $\\sqrt r\\equiv 0\\pmod 2$ \u90a3\u4e48\u7b54\u6848\u5c31\u662f $n$\uff0c\u56e0\u4e3a\u4e00\u5171\u662f $n$ \u4e2a $1$ \u76f8\u52a0\uff0c\u5982\u679c $\\sqrt r\\equiv 1\\pmod 2$\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u8981\u8003\u8651 $n$ \u7684\u5947\u5076\u6027\uff0c\u5982\u679c $n$ \u662f\u5076\u6570\u5c31\u8f93\u51fa $0$ \u5426\u5219\u8f93\u51fa $-1$\u3002\n\n\u90a3\u5982\u679c $\\sqrt r$ \u5f00\u51fa\u6765\u662f\u4e00\u4e2a\u65e0\u7406\u6570\u600e\u4e48\u529e\u5462\uff1f\n\n\u8003\u8651 $-1$ \u6b21\u5e42\u7684\u6700\u57fa\u672c\u63a8\u5bfc\uff1a$(-1)^{2n}=1$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5199\u51fa\u5f0f\u5b50 $(-1)^x=1-2(x\\bmod 2)$\u3002\u800c\u8003\u8651\u53d6\u4f59\u8fd0\u7b97\u7684\u57fa\u672c\u5b9a\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\uff1a\n\n$$(-1)^x=1-2\\left(x-2\\left\\lfloor\\dfrac{x}{2}\\right\\rfloor\\right)=1-2x+4\\left\\lfloor\\dfrac{x}{2}\\right\\rfloor$$\n\n\u5c06\u8fd9\u4e2a\u5f0f\u5b50\u4ee3\u5165\u5230\u539f\u5f0f\u4e4b\u4e2d\uff0c\u5c31\u5f97\u5230\uff1a\n\n$$\\sum_{d=1}^{n}1-2\\left\\lfloor d\\sqrt{r} \\right\\rfloor+4\\left\\lfloor\\dfrac{\\left\\lfloor d\\sqrt{r} \\right\\rfloor}{2}\\right\\rfloor$$\n\n\u5c06\u5176\u4e2d\u65e0\u5173\u7d27\u8981\u7684\u90e8\u5206\u5199\u5f00\u6765\uff0c\u5c31\u662f\uff1a\n\n$$n+2\\sum_{d=1}^{n}\\left\\lfloor d\\sqrt{r} \\right\\rfloor+4\\sum_{d=1}^{n}\\left\\lfloor\\dfrac{d\\sqrt{r}}{2}\\right\\rfloor$$\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u7c7b\u6b27\u7684\u91cd\u5934\u620f\u4e86\u3002\n\n## \u7c7b\u6b27\u5316\u7b80\n\n\u8bbe $f(a,b,c,n)=\\sum\\limits_{i=1}^{n}\\left\\lfloor\\dfrac{a\\sqrt r+b}{c}\\cdot i\\right\\rfloor$\uff0c\u90a3\u4e48\u9898\u76ee\u6240\u6c42\u5c31\u662f\uff1a\n\n$$n-2f(1,0,1,n)+4f(1,0,2,n)$$\n\n\u4e0d\u59a8\u4ee4 $x=\\sqrt r$\uff0c$t=\\dfrac{ax+b}{c}$\uff0c\u66f4\u65b9\u4fbf\u5730\u8868\u793a\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n$$f(a,b,c,n)=\\sum\\limits_{i=1}^{n}\\left\\lfloor ti\\right\\rfloor$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5206\u7c7b\u8ba8\u8bba\u3002\n\n## \u5206\u7c7b\u8ba8\u8bba\n\n\u6211\u4eec\u5bf9\u4e8e $t$ \u7684\u5927\u5c0f\u8fdb\u884c\u7b80\u5355\u7684\u8003\u8651\u3002\n\n### \u82e5 $t\\ge 1$\uff1a\n\n\u8bb0 $\\lfloor t\\rfloor$ \u4e3a $\\alpha$ \u90a3\u4e48\u5c31\u53ef\u4ee5\u5199\u51fa\uff1a\n\n$$f(a,b,c,n)=\\sum\\limits_{i=1}^{n}\\left\\lfloor ti\\right\\rfloor=\\sum\\limits_{i=1}^{n}\\left\\lfloor ti-\\alpha i+\\alpha i\\right\\rfloor$$\n\n\u5c06 $t$ \u503c\u4ee3\u5165\u8fdb\u53bb\u5c31\u5f97\u5230\uff1a\n\n$$\\dfrac{(n+1)n}{2}\\alpha+\\sum\\limits_{i=1}^{n}\\left\\lfloor\\left(\\dfrac{ax+b}{c}-\\alpha\\right)i\\right\\rfloor$$\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5f0f\u5b50\u4e2d $\\alpha$ \u79fb\u5230\u5206\u6bcd\u4e0a\u4e4b\u540e\u5c31\u5f97\u5230\u4e86\u8be5\u5f0f\u5b50\u7684\u9012\u5f52\u5316\u7b80\u5f0f\uff1a\n\n$$f(a,b-c\\alpha,c,n)+\\dfrac{(n+1)n}{2}\\alpha$$\n\n### \u82e5 $t<1$\uff1a\n\n\u90a3\u4e48\uff0c\u7531\u4e8e $t$ \u7684\u6b63\u8d1f\u6027\uff0c\u4e0d\u96be\u53d1\u73b0 $\\alpha$ \u5c31\u5e94\u8be5\u4e3a $0$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5229\u7528**\u8d21\u732e\u601d\u60f3**\u8fdb\u884c\u4e00\u4e2a\u7b80\u5355\u7684\u63a8\u8bba\uff1a\n\n$$f(a,b,c,n)=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left[j<ki\\right]$$\n\n\u7136\u540e\u5728\u8c13\u8bcd\u51fd\u6570\u91cc\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u4ee3\u6570\u53d8\u6362\uff1a\n\n$$f(a,b,c,n)=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left[\\dfrac{j}{t}<i\\right]$$\n\n\u7136\u540e\u8c03\u6362\u6c42\u548c\u987a\u5e8f\uff1a\n\n$$\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\sum\\limits_{i=1}^{n}\\left[i>\\dfrac{j}{t}\\right]$$\n\n\u8fd9\u6837\u610f\u4e49\u662f\u5c06\u9650\u5236\u6761\u4ef6\u8f6c\u6362\u5230\u5185\u90e8\u7684\u548c\u5f0f\u4e4b\u4e2d\uff0c\u4ece\u800c\u8fbe\u5230\u5316\u7b80\u7684\u76ee\u7684\uff1a\n\n$$\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left(n-\\left\\lfloor\\dfrac{j}{t}\\right\\rfloor\\right)$$\n\n\u8fd9\u65f6\u5019\u5982\u679c\u5c06 $t$ \u503c\u4ee3\u5165\uff0c\u5f88\u6709\u610f\u601d\u7684\u60c5\u51b5\u5c31\u4f1a\u51fa\u73b0\uff1a\n\n\n$$\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left(n-\\left\\lfloor\\dfrac{j}{\\dfrac{ax+b}{c}}\\right\\rfloor\\right)$$\n\n\u5316\u4e3a\u6b63\u5e38\u5f62\u5f0f\uff1a\n\n$$\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left(n-\\left\\lfloor\\dfrac{j}{ax+b}\\cdot c\\right\\rfloor\\right)$$\n\n\u5c06 $j$ \u548c $c$ \u7684\u4f4d\u7f6e\u4e92\u6362\uff0c\u7136\u540e\u628a $n$ \u63d0\u51fa\u6765\uff1a\n\n$$n\\cdot \\left\\lfloor{nt}\\right\\rfloor-\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left\\lfloor\\dfrac{c}{ax+b}\\cdot j\\right\\rfloor$$\n\n\u53f3\u8fb9\u662f\u4ec0\u4e48\uff1f\u662f\u975e\u5e38\u63a5\u8fd1\u6700\u521d\u5f62\u5f0f\u7684\u4e00\u4e2a\u5f0f\u5b50\uff0c\u8003\u8651\u5c06\u4ed6\u5316\u6210\u6700\u521d\u5f62\u5f0f\uff0c\u4e58\u4e0a\u5206\u6bcd\u7684\u5171\u8f6d\uff1a\n\n$$n\\cdot \\left\\lfloor{nt}\\right\\rfloor-\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left\\lfloor\\dfrac{c(ax-b)}{(ax+b)(ax-b)}\\cdot j\\right\\rfloor$$\n\n$$n\\cdot \\left\\lfloor{nt}\\right\\rfloor-\\sum\\limits_{j=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left\\lfloor\\dfrac{cax-cb}{a^2x^2-b^2}\\cdot j\\right\\rfloor$$\n\n\u8fd9\u5df2\u7ecf\u5f88\u63a5\u8fd1\u7ed3\u679c\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u8003\u8651\u5230 $x^2$ \u662f\u7b49\u540c\u4e8e $r$ \u7684\uff0c\u4e8e\u662f\u5199\u4f5c\uff1a\n\n$$n\\cdot \\left\\lfloor{nt}\\right\\rfloor-\\sum\\limits_{i=1}^{\\left\\lfloor{nt}\\right\\rfloor}\\left\\lfloor\\dfrac{cax-cb}{a^2r-b^2}\\cdot i\\right\\rfloor$$\n\n\u5199\u6210\u4e00\u822c\u5f62\u5f0f\uff1a\n\n$$f(a,b,c,n)=n\\cdot \\left\\lfloor{nt}\\right\\rfloor-f(ca,-cb,a^2r-b^2,\\left\\lfloor{nt}\\right\\rfloor)$$\n\n\u6240\u4ee5\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u7b54\u6848\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u80fd\u591f\u5f88\u5bb9\u6613\u5199\u51fa\u4ee3\u7801\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\u4ee3\u7801\u5b9e\u73b0\u7684\u4e00\u4e9b\u7ec6\u8282\u5728\u4e8e\uff0c\u6211\u4eec\u5e94\u5f53\u8981\u628a\u4e0b\u53d6\u6574\u90e8\u5206\u63d0\u524d\u7b97\u51fa\uff0c\u5426\u5219\u5728\u5f0f\u5b50\u7684\u8fd0\u7b97\u4e2d\u4f1a\u5230\u6700\u540e\u624d\u8fdb\u884c\u4e0b\u53d6\u6574\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ndouble x;\nint T,n,r;\nint f(int a,int b,int c,int n){\n\tif(n==0)return 0;\n\tint gcd=__gcd(a,__gcd(b,c));\n\ta/=gcd,b/=gcd,c/=gcd;\n\tint t=(a*x+b)/c;\n\tif(t!=0)return n*(n+1)/2*t+f(a,b-c*t,c,n);\n\telse{\n\t\tint kn=(a*x+b)*n/c;\n\t\treturn n*kn-f(a*c,-b*c,a*a*r-b*b,kn);\n\t}\n}signed main(){\n\tscanf(\"%lld\",&T);\n\twhile(T--){\n\t\tscanf(\"%lld%lld\",&n,&r);\n\t\tx=sqrt(r);\n\t\tint s=(int)x;\n\t\tif(s*s==r){\n\t\t\tif(s%2==0)printf(\"%lld\\n\",n);\n\t\t\telse if(n%2==0)puts(\"0\");\n\t\t\telse puts(\"-1\");\n\t\t}else printf(\"%lld\\n\",n-2*f(1,0,1,n)+4*f(1,0,2,n));\n\t}return 0;\n}\n```",
        "postTime": 1631601391,
        "uid": 212283,
        "name": "Aw\u987f\u987f",
        "ccfLevel": 5,
        "title": "\u3010\u9898\u89e3\u3011P5172 Sum"
    },
    {
        "content": "\u4e00\u770b\u8fd9\u79cd\u9898\u5c31\u5f88\u5bb9\u6613\u60f3\u5230\u7c7b\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff08\u8fd9\u91cc\u5176\u5b9e\u662f\u4e00\u4e2a\u534a\u9053\u9898\u7684\u9898\u89e3\uff09\uff0c\u867d\u7136\u5e76\u4e0d\u662f\u7eaf\u6b63\u7684\uff08\u4f5c\u8005\u8ba4\u4e3a\uff0c\u4e0d\u662f\u6c42\u8f7b\u55b7\uff09\uff0c\u4f46\u662f\u548c\u7eaf\u6b63\u7684\u7c7b\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u4e4b\u95f4\u6709\u5f02\u66f2\u540c\u5de5\u4e4b\u5999\u3002\n\n\u4ee5\u4e0b\u5706\u62ec\u53f7\u662f**\u5411\u4e0b\u53d6\u6574**\u7684\u610f\u601d\u3002\n\n\u5047\u5982\u8bf4\u6211\u4eec\u8981\u6c42\u7684\u662f $f(a,b,c,n)=\\sum\\limits_{i=0}^n (\\frac{ai+b}{c})$\uff0c\u5982\u679c $a=0$ \u90a3\u4e48\u5b83\u4ed6\u522b\u597d\u6c42\uff0c\u5c31\u662f $(\\frac{b}{c})\\times (n+1)$\uff0c\u5426\u5219\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u8f6c\u6362\u4e3a\uff1a\n\n$$\\sum\\limits_{i=0}^n (\\frac{a}{c})i+(\\frac{b}{c})+\\frac{a\\!\\mod c+b\\!\\mod c}{c}$$\n\n\u628a\u6c42\u548c\u7b26\u53f7\u5185\u524d\u4e24\u9879\u63d0\u5230\u5916\u9762\uff0c\u5373\u4e3a\n\n$$(\\frac{a}{c})\\times\\frac{n(n+1)}{2}+(\\frac{b}{c})\\times (n+1)+f(a\\!\\mod c,b\\!\\mod c,c,n)$$\n\n\u8fd9\u6837\u5c31\u628a $a$ \u548c $b$ \u9650\u5236\u5230\u4e86 $c$ \u4e0b\u9762\u3002\u5728\u8003\u8651 $a,b<c$ \u7684\u60c5\u51b5\uff1a\n\n$$\\sum\\limits_{i=0}^n\\sum\\limits_{j=1}^{(\\frac{an+b}{c})}[j\\le \\frac{ai+b}{c}]$$\n\n\u8bbe $m=(\\frac{an+b}{c})$\uff0c\u90a3\u4e48\u4e0a\u5f0f\u5c31\u662f\n\n$$\\sum\\limits_{i=0}^n\\sum\\limits_{j=1}^m\\ [jc\\le ai+b]$$\n\n\u5c06 $j$ \u7684\u533a\u95f4\u5f80\u4e0b\u79fb\uff1a\n\n$$\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^{m-1}\\ [jc+c\\le ai+b]$$\n\n\u5c06\u5c0f\u4e8e\u7b49\u4e8e\u53f7\u53d8\u6210\u5c0f\u4e8e\u53f7\uff1a\n\n$$\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^{m-1}\\ [jc+c-b-1<ai]$$\n\n\u4ea4\u6362\u4e24\u4e2a\u6c42\u548c\u7b26\u53f7\uff0c\u5e76\u4ea4\u6362\u5c0f\u4e8e\u53f7\u4e24\u8fb9\uff1a\n\n$$\\sum\\limits_{j=0}^{m-1}\\sum\\limits_{i=0}^n\\ [ai>jc+c-b-1]$$\n\n\u5bb9\u6613\u77e5\u9053\u5f53 $i=0$ \u7684\u65f6\u5019\uff0c\u5185\u90e8\u6761\u4ef6\u5fc5\u7136\u4e0d\u6210\u7acb\uff0c\u6545\u820d\u53bb $i=0$\u3002\u7136\u540e\u5c06\u5927\u4e8e\u53f7\u8f6c\u6210\u5c0f\u4e8e\u7b49\u4e8e\u53f7\uff1a\n\n$$\\sum\\limits_{j=0}^{m-1}\\sum\\limits_{i=1}^n\\ 1-[ai\\le jc+c-b-1]$$\n\n\u5373\u4e3a\n\n$$\\sum\\limits_{j=0}^{m-1}n-\\sum\\limits_{i=1}^n\\ [ai\\le jc+c-b-1]$$\n\n\u4e5f\u5c31\u662f\n\n$$nm-\\sum\\limits_{j=0}^{m-1}(\\frac{jc+c-b-1}{a})$$\n\n\u4e5f\u5c31\u662f\n\n$$nm-f(c,c-b-1,a,m-1)$$\n\n\u9012\u5f52\u4e0b\u53bb\u5c31\u884c\u4e86\uff0c\u56e0\u4e3a\u8fc7\u7a0b\u7c7b\u4f3c\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff08\u5373\u8f97\u8f6c\u76f8\u9664\u6cd5\uff09\uff0c\u6545\u5f97\u540d\u7c7b\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u3002\n\n---\n\n\u63a5\u4e0b\u6765\u56de\u5230\u672c\u9898\uff0c\u9996\u5148\u5bb9\u6613\u77e5\u9053 $(-1)^a=1-2(a\\!\\mod 2)=1-2a+4(\\frac{a}{2})$\u3002\u8bbe $x=\\sqrt{r}$\uff0c\u662f $r$ \u5f00\u6839\u53f7\uff08\u6211\u53ef\u6ca1\u8bf4\u8fc7\u8fd9\u4e2a\u8981\u5411\u4e0b\u53d6\u6574\uff09\uff0c\u9898\u76ee\u4e2d\u7684\u503c\u5373\u4e3a $\\sum\\limits_{i=1}^n 1-2(ix)+4(\\frac{ix}{2})$\uff0c\u518d\u8bbe $f(a,b,c,n)=\\sum\\limits_{i=1}^n (\\frac{ax+b}{c}i)$\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f $n-2f(1,0,1,n)+4f(1,0,2,n)$\u3002\n\n\u5982\u679c $x$ \u4e3a\u6574\u6570\uff0c\u90a3\u4e48\u8fd9\u4e00\u4e2a\u503c\u7092\u9e21\u597d\u6c42\uff0c\u5148\u7279\u5224\u6389\u3002\n\n\u56de\u5230\u5f0f\u5b50\uff0c\u9996\u5148\u5982\u679c $n=0$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u503c\u80af\u5b9a\u4e5f\u662f $0$\u3002\u6211\u4eec\u8bbe $t=\\frac{ax+b}{c}$\uff08\u6211\u6ca1\u6709\u8bf4\u8fc7\u8981\u5411\u4e0b\u53d6\u6574\u5440\uff09\uff0c\u90a3\u4e48 $f(a,b,c,n)=\\sum\\limits_{i=1}^n (ti)$\uff0c\u5982\u679c $t\\ge 1$\uff0c\u8bbe $\\alpha$ \u4e3a $t$ \u7684\u5c0f\u6570\u90e8\u5206\uff0c\u90a3\u4e48\u8fd9\u4e2a\u503c\u5c31\u662f $\\sum\\limits_{i=1}^n (t)i+(\\alpha i)=(t)\\frac{n(n+1)}{2}+\\sum\\limits_{i=1}^n \\alpha i$\u3002\u5bb9\u6613\u77e5\u9053 $\\alpha=t-(t)=\\frac{ax+b}{c}-(t)=\\frac{ax+b-c(t)}{c}$\uff0c\u90a3\u4e48\u5f0f\u5b50\u7684\u503c\u5c31\u662f $(t)\\frac{n(n+1)}{2}+f(a,b-(t)c,c,n)$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u628a $t$ \u9650\u5236\u5230\u4e86 $(0,1)$ \u4e4b\u95f4\uff08\u800c\u4e14\u662f\u4e2a\u65e0\u7406\u6570\uff09\u3002\n\n\u6211\u4eec\u628a\u5f0f\u5b50\u8f6c\u6210\u548c\u4e4b\u524d\u5f88\u76f8\u4f3c\u7684\u6837\u5b50\uff1a\n\n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{(tn)}[j<ti]$$\n\n\u79fb\u9879\uff1a\n\n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{(tn)}[\\frac{j}{\\frac{ax+b}{c}}<i]$$\n\n\u53d8\u6362\uff1a\n\n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{(tn)}[\\frac{jc}{ax+b}<i]$$\n\n\u518d\u53d8\u6362\uff08\u8bf7\u8bfb\u8005\u60f3\u4e00\u4e0b\u600e\u4e48\u53d8\u7684\uff09\uff1a\n\n$$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{(tn)}[\\frac{jacx-jbc}{a^2r-b^2}<i]$$\n\n\u518d\u518d\u53d8\u6362\uff1a\n\n$$\\sum\\limits_{j=1}^{(tn)}\\sum\\limits_{i=1}^n 1-[i\\le \\frac{acx-bc}{a^2r-b^2}j]$$\n\n\u51c6\u5907\u6536\u5b98\u5566\uff01\n\n$$n(tn)-\\sum\\limits_{j=1}^{(tn)}(\\frac{acx-bc}{a^2r-b^2}j)$$\n\n\u8fd8\u5269\u4e00\u6b65\uff01\n\n$$n(tn)-f(ac,-bc,a^2r-b^2,(tn))$$\n\n\u5c31\u8fd9\u4e48\u9012\u5f52\u4e0b\u53bb\u5c31\u884c\u5566\uff01\u5b8c\u7ed3\u6492\u82b1\uff01\n\n\u4e0d\u60f3 $\\texttt{ctj}$ \u7684\u522b\u8d70\uff0c\u8fd8\u6709\u51e0\u4e2a\u5751\uff1a\n\n- \u6ce8\u610f\u5148\u7279\u5224\uff0c\u5426\u5219 $t$ \u662f\u4e0d\u662f\u65e0\u7406\u6570\u6211\u4e0d\u4fdd\u8bc1\u3002\n\n- \u7531\u4e8e\u53ef\u80fd $a$ \u548c $b$ \u4e58\u7206\uff0c\u6240\u4ee5\u8fd8\u662f\u628a $a,b,c$ \u4e09\u6570\u9664\u4ee5\u4ed6\u4eec\u7684\u6700\u5927\u516c\u56e0\u6570\u4e3a\u597d\u3002\n\n- \u6211\u61d2\u5f97\u7ed9\u4ee3\u7801\u4e86\u3002\u3002\u3002\u5b8c\u7ed3\u6492\u82b1\uff01",
        "postTime": 1650684504,
        "uid": 472950,
        "name": "Mr_Terminator",
        "ccfLevel": 4,
        "title": "\u592a\u7a7a\u4ec1\u80dc\u5229\u5728\u671b\uff0c\u65e0\u7406\u6570\u6a2a\u63d2\u4e00\u68d2\uff0c\u7edd\u671b\uff01"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u6b63\u6574\u6570 $n,r$\uff0c\u6c42\n\n$$\\sum_{d=1}^{n}(-1)^{\\lfloor d\\sqrt r\\rfloor}$$\n\n## \u601d\u8def\u5206\u6790\n\n$n\\le 10^9$\uff0c\u66b4\u529b\u6c42\u548c\u7684 $O(n)$ \u7b97\u6cd5\u80af\u5b9a\u8fc7\u4e0d\u4e86\u3002\u9700\u8981**\u7c7b\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5**\u3002\n\n\u8bdd\u8bf4\u7c7b\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff0c\u8ddf\u6b27\u51e0\u91cc\u5f97\u548c\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u534a\u6bdb\u94b1\u5173\u7cfb\u6ca1\u6709\uff0c\u53ea\u662f\u590d\u6742\u5ea6\u8bc1\u660e\u5dee\u4e0d\u591a\u7f62\u4e86\u3002\n\n\u5e9f\u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u59cb\u63a8\u72ee\u5b50\u3002\n\n\u5f53 $r$ \u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u65f6\uff0c$\\sqrt r$ \u5f00\u51fa\u6765\u5c31\u662f\u4e00\u6b63\u6574\u6570\uff0c\u8fd9\u65f6\u5f0f\u5b50\u7684\u7ed3\u679c\u5f88\u597d\u5224\u5b9a\uff1a\u5f53 $\\sqrt r$ \u4e3a\u5076\u6570\u65f6\uff0c\u6307\u6570 $\\lfloor d\\sqrt r\\rfloor$ \u5fc5\u662f\u5076\u6570\uff0c$-1$ \u7684\u5076\u6570\u500d\u6052\u4e3a $1$\uff0c\u7b54\u6848\u5c31\u662f $n\\times 1 = n$\uff1b\u5f53 $\\sqrt r$ \u662f\u5947\u6570\u65f6\uff0c\u4e0d\u96be\u770b\u51fa\u5982\u679c $n$ \u4e3a\u5076\u6570\u7ed3\u679c\u4e3a $0$ \u5426\u5219\u4e3a $-1$\u3002\n\n\u90a3\u4e48\u5f53 $\\sqrt r$ \u662f\u65e0\u7406\u6570\u65f6\uff0c\u600e\u4e48\u529e\u5462\uff1f\n\n\u6211\u4eec\u77e5\u9053\uff0c$-1$ \u7684\u5e42\u6709\u5f88\u7279\u6b8a\u7684\u6027\u8d28\uff1a\n\n$$ (-1)^k = \\begin{cases} \n1 & (k\\ \\bmod\\ 2 = 0)  \\\\\n-1  &(k\\ \\bmod\\ 2 = 1)\n \\end{cases}$$\n \n\u7efc\u5408\u4e0a\u8ff0\u5f0f\u5b50\uff0c\u5f97\u5230\n\n$$(-1)^k = 1-2(k \\bmod 2)$$\n\n\u4f17\u6240\u5468\u77e5\uff0c$a \\bmod b$ \u53ef\u4ee5\u8868\u793a\u6210 $a - b\\times\\lfloor\\frac{a}{b}\\rfloor$\uff0c\u5f97\u5230\n\n$$(-1)^k = 1-2(k - 2\\times \\lfloor\\frac{1}{2}k\\rfloor)$$\n\n\u5c55\u5f00\uff0c\u5f97\u5230\n\n$$(-1)^k = 1- 2k + 4\\times \\lfloor\\frac{1}{2}k\\rfloor)$$\n\n\u4ee3\u5165\u9898\u76ee\u4e2d\u7ed9\u5b9a\u7684\u5f0f\u5b50\uff0c\u5f97\u5230\n\n$$\\sum_{d=1}^{n}(-1)^{\\lfloor d\\sqrt r\\rfloor} = \\sum_{d=1}^{n}1- 2\\times \\lfloor d\\sqrt r\\rfloor + 4\\times \\lfloor\\frac{1}{2}\\times d\\sqrt r\\rfloor = n - 2\\times \\sum_{d=1}^{n}\\lfloor d\\sqrt r\\rfloor + 4\\times \\sum_{d=1}^{n}\\lfloor\\frac{1}{2}\\times d\\sqrt r\\rfloor$$\n\n\u7136\u540e\u5c31\u8981\u7528\u5230\u7c7b\u6b27\u7b97\u6cd5\u91cc\u7684\u91cd\u5934\u620f\u4e86\u2014\u2014\u51fd\u6570\n\n\u8bbe $x=\\sqrt r,\\ t=\\frac{a\\sqrt r+b}{c}$\u3002\n\n\u5b9a\u4e49\u51fd\u6570 $f(a,b,c,n) = \\sum_{i=1}^{n}\\lfloor ti \\rfloor$\n\n\u4ee3\u5165\u539f\u6709\u5f0f\u5b50\uff0c\u5f97\n\n$$\\sum_{d=1}^{n}(-1)^{\\lfloor d\\sqrt r\\rfloor} = n-2\\times f(1,0,1,n) + 4\\times f(1,0,2,n)$$\n\n\u73b0\u5728\u6211\u4eec\u63a8\u51fa\u6765\u4e86\u5f0f\u5b50\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u6c42\u51fd\u6570\u503c\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u8fd9\u91cc\u8bbe $p = \\lfloor t\\rfloor$\u3002\n\n- \u5f53 $n=0$ \u65f6\uff0c\u7ed3\u679c\u4e3a $0$\u3002\n\n- \u5f53 $t\\ge 1$ \u65f6\uff1a\n\n$$\\begin{aligned}\nf(a,b,c,n)&=\\sum_{i=1}^{n}\\lfloor ti \\rfloor\\\\\n&=\\sum_{i=1}^{n}\\lfloor ti - pi + pi \\rfloor\\\\\n&=\\frac12n(n+1)p + \\sum_{i=1}^{n}\\lfloor ti - pi\\rfloor\\\\\n&=\\frac12n(n+1)p + \\sum_{i=1}^{n}\\lfloor (t-p)i\\rfloor\\\\\n&=\\frac12n(n+1)p + \\sum_{i=1}^{n}\\lfloor (\\frac{ax+b}{c}-p)i\\rfloor\\\\\n&=\\frac12n(n+1)p + \\sum_{i=1}^{n}\\lfloor (\\frac{ax+b - cp}{c})i\\rfloor\\\\\n&=\\frac12n(n+1)p + f(a,b-cp,c,n)\\\\\n\\end{aligned}$$\n\n- \u5f53 $t\\lt 1$ \u65f6\uff1a\n\n$$\\begin{aligned}\n&\\because 0 \\lt t \\lt 1\\\\\n&\\therefore \\lfloor t \\rfloor = 0\n\\end{aligned}$$\n\n$$\n\\begin{aligned}\nf(a,b,c,n)&=\\sum_{i=1}^{n}\\lfloor ti \\rfloor\\\\\n&=\\sum_{i=1}^{n}\\sum_{j=1}^{\\lfloor tn \\rfloor}[j<ti]\\\\\n&=\\sum_{i=1}^{n}\\sum_{j=1}^{\\lfloor tn \\rfloor}[i>\\frac{j}{t}]\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}\\sum_{i=1}^{n}[i>\\frac{j}{t}]\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{j}{t}\\rfloor)\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{j}{\\frac{ax+b}{c}}\\rfloor)\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{jc}{ax+b}\\rfloor)\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{c}{ax+b}\\rfloor\\times j)\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{c\\times {(ax-b)}}{(ax+b)\\times {(ax-b)}}\\rfloor\\times j)\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{acx-bc}{a^2x^2-b^2}\\rfloor\\times j)\\\\\n&=\\sum_{j=1}^{\\lfloor tn \\rfloor}(n-\\lfloor \\frac{acx-bc}{a^2r-b^2}\\rfloor\\times j)\\\\\n&=n\\times \\lfloor tn \\rfloor - \\sum_{j=1}^{\\lfloor tn \\rfloor}\\lfloor \\frac{acx-bc}{a^2r-b^2}\\rfloor\\times j\\\\\n&=n\\times \\lfloor tn \\rfloor - f(ac,-bc,a^2r-b^2, \\lfloor tn \\rfloor)\\\\\n\\end{aligned}\n$$\n\n\u8fd9\u6837\uff0c\u51fd\u6570\u7684\u9012\u5f52\u5c31\u5b8c\u6210\u4e86\uff0c\u7ecf\u8fc7\u8bc1\u660e\uff0c\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u9012\u5f52\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log n)$\uff0c\u4e0e\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\u76f8\u540c\u3002\n\n## \u5b8c\u6574\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n#define double long double\n\nusing namespace std;\n\nint t, n, r;\ndouble x;\n\nint gcd(int a, int b) {\n    return b == 0 ? a : gcd(b, a % b);\n}\n\nint f(int a, int b, int c, int n) {\n    if (n == 0) return 0;\n    int g = gcd(gcd(a, b), c);\n    a /= g;\n    b /= g;\n    c /= g;\n    int t = (a * x + b) / c;\n    if (t != 0) {\n        return n * (n + 1) / 2 * t + f(a, b - c * t, c, n);\n    } \n    int k = (a * x + b) * n / c;\n    return n * k - f(a * c, 0 - b * c, a * a * r - b * b, k);\n}\n\nsigned main() {\n    cin >> t;\n    while (t--) {\n        cin >> n >> r;\n        x = sqrt(r);\n        int tmp = floor(x);\n        if (tmp * tmp == r) {\n            if (tmp % 2 == 0) {\n                cout << n << endl;\n            } else if (n % 2 == 0) {\n                cout << 0 << endl;\n            } else {\n                cout << -1 << endl;\n            }\n        } else {\n            cout << n - 2 * f(1, 0, 1, n) + 4 * f(1, 0, 2, n) << endl;\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1644883561,
        "uid": 362750,
        "name": "TernaryTree",
        "ccfLevel": 0,
        "title": "P5172 Sum"
    },
    {
        "content": "## $Description$\n\u6c42:    \n$$\\sum\\limits_{i=1}^n(-1)^{\\lfloor d\\sqrt{r}\\rfloor}$$\n## $Solution$\n\n\u5bf9\u4e8e$\\sqrt{r}$\u4e3a\u6709\u7406\u6570\uff0c\u5f88\u5bb9\u6613\u6c42\u89e3\u3002    \n\u5f53$\\sqrt{r}$\u4e3a\u5076\u6570\u65f6\uff0c\u7b54\u6848\u4e3a$n$\u3002     \n\u5f53$\\sqrt{r}$\u4e3a\u5947\u6570\u65f6\uff0c\u82e5$n$\u4e3a\u5076\u6570\uff0c\u8f93\u51fa$0$\uff0c\u5426\u5219\u8f93\u51fa$-1$\u3002    \n\n\u5bf9\u4e8e$\\sqrt{r}$\u4e3a\u65e0\u7406\u6570\u3002      \n\u8003\u8651$(-1)^x=\\begin{cases}1&x\\mod{2}=0\\\\ -1&x\\mod{2}=1\\end{cases}$    \n\u6574\u7406\u5f97\uff1a   \n$\\begin{aligned}\n(-1)^x\n&=1-2(x\\mod{2})\\\\\n&=1-2(x-2\\lfloor\\dfrac{x}{2}\\rfloor)\\\\\n&=1-2x+4\\lfloor\\dfrac{x}{2}\\rfloor\n\\end{aligned}$  \n$\\therefore\n\\begin{aligned}\n\\sum\\limits_{i=1}^n(-1)^{\\lfloor d\\sqrt{r}\\rfloor}\n&=n-2\\sum\\limits_{i=1}^n\\lfloor d\\sqrt{r}\\rfloor+4\\sum\n\\limits_{i=1}^n\\lfloor\\dfrac{d\\sqrt{r}}{2}\\rfloor\n\\end{aligned}$  \n\u4e0d\u59a8\u8bbe$f(a,b,c,n)=\\sum\\limits_{i=1}^n\\lfloor\\dfrac{a\\sqrt{r}+b}{c}i\\rfloor$    \n\u8bb0  \n$x=\\sqrt{r}$    \n$k=\\dfrac{ax+b}{c}$      \n$f(a,b,c,n)=\\sum\\limits_{i=1}^n\\lfloor\\dfrac{ax+b}{c}i\\rfloor=\\sum\\limits_{i=1}^n\\lfloor ki\\rfloor$   \n\u5219$Ans=n-2f(1,0,1,n)+4f(1,0,2,n)$      \n\u63a5\u4e0b\u6765\u8003\u8651\u6c42$f$\n\n- $k\\ge1,\\lfloor k\\rfloor\\neq0$  \n$\\begin{aligned}\nf(a,b,c,n)&=\\sum\\limits_{i=1}^n\\lfloor ki\\rfloor\\\\\n&=\\sum\\limits_{i=1}^n\\lfloor ki-\\lfloor k\\rfloor i+\\lfloor k\\rfloor i\\rfloor\\\\\n&=\\sum\\limits_{i=1}^n\\lfloor(\\dfrac{ax+b}{c}-\\lfloor k\\rfloor) i\\rfloor+\\dfrac{n(n+1)}{2}\\lfloor k\\rfloor\\\\\n&=\\sum\\limits_{i=1}^n\\lfloor\\dfrac{ax+b-c\\lfloor k\\rfloor}{c}i\\rfloor+\\dfrac{n(n+1)}{2}\\lfloor k\\rfloor\\\\\n&=f(a,b-c\\lfloor k\\rfloor,c,n)+\\dfrac{n(n+1)}{2}\\lfloor k\\rfloor\n\\end{aligned}$\n\n- $k<1,\\lfloor k\\rfloor=0$\u8bb0   \n$\\begin{aligned}\nf(a,b,c,n)&=\\sum\\limits_{i=1}^n\\lfloor ki\\rfloor\\\\\n&=\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}[j<ki]\\\\\n&=\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}[i>\\dfrac{j}{k}]\\\\\n&=\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}\\sum\\limits_{i=0}^n[i>\\dfrac{j}{k}]\\\\\n&=\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}(n-\\lfloor\\dfrac{j}{k}\\rfloor)\\\\\n&=n-\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}\\lfloor\\dfrac{c}{ax+b}j\\rfloor\\\\\n&=n-\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}\\lfloor\\dfrac{c(ax-b)}{(ax+b)(ax-b)}j\\rfloor\\\\\n&=n-\\sum\\limits_{j=1}^{\\lfloor kn\\rfloor}\\lfloor\\dfrac{acx-bc}{a^2r-b^2}j\\rfloor\\\\  \n&=n-f(ac,-bc,a^2r-b^2,\\lfloor kn\\rfloor)\n\\end{aligned}$   \n\u8fd0\u7528\u4e86\u7c7b\u6b27\u7684\u63a8\u72ee\u5b50\u5957\u8def\uff0c\u6700\u540e\u4e00\u6b65\u56e0\u4e3a\u5206\u6bcd\u662f\u65e0\u7406\u6570\uff0c\u6240\u4ee5\u505a\u4e00\u4e2a\u6709\u7406\u5316\u3002    \n\u6700\u540e\uff0c\u5728\u9012\u5f52\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u6570\u5b57\u592a\u5927\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0a\u4e0b\u540c\u65f6\u9664\u4ee5\u6700\u5927\u516c\u7ea6\u6570\u4ee5\u63a7\u5236\u5728\u6570\u636e\u8303\u56f4\u5185\u3002     \n## $Code$   \n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ndouble x;int n,r;\nint gcd(int a,int b)\n{\n\treturn b?gcd(b,a%b):a;\n}\nint f(int a,int b,int c,int n)\n{\n\tif(n==0)return 0;\n\tint g=gcd(a,gcd(b,c));\n\ta/=g,b/=g,c/=g;\n\tint k=(a*x+b)/c;\n\tif(k!=0)return n*(n+1)/2*k+f(a,b-c*k,c,n);\n\telse\n\t{\n\t\tint kn=(a*x+b)/c*n;\n\t\treturn n*kn-f(a*c,-b*c,a*a*r-b*b,kn);\n\t}\n}\nsigned main()\n{\n\tint t;scanf(\"%lld\",&t);\n\twhile(t--)\n\t{\n\t\tscanf(\"%lld%lld\",&n,&r);\n\t\tx=sqrt(r);int rr=(int)x;\n\t\tif(rr*rr==r)\n\t\t{\n\t\t\tif(rr&1)printf(\"%lld\",n-2*((n+1)>>1));\n\t\t\telse printf(\"%lld\",n);\n\t\t}\n\t\telse printf(\"%lld\",n-2*f(1,0,1,n)+4*f(1,0,2,n));\n\t\tputs(\"\");\n\t}\n\treturn 0;\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1597331132,
        "uid": 115855,
        "name": "Yyxxxxx",
        "ccfLevel": 4,
        "title": "P5172 Sum \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\uff0c\u7279\u5224$\\sqrt{r}$\u662f\u6709\u7406\u6570\u7684\u60c5\u51b5\u3002\n\n\u7136\u540e\uff0c\u56e0\u4e3a$(-1)^x=\\begin{cases}-1&,x\\bmod 2=1\\\\1&,otherwise\\end{cases}$\n\n\u6240\u4ee5$(-1)^x=1-2(x\\bmod 2)=1-2(x-2\\lfloor\\frac{x}{2}\\rfloor)$\n\n\u56e0\u6b64\uff0c\u7b54\u6848\u53ef\u5316\u4e3a\n$$n-2\\sum_{d=1}^n \\lfloor d\\sqrt r\\rfloor +4\\sum_{d=1}^n \\lfloor\\frac{d\\sqrt r}{2}\\rfloor$$\n\n\u8bbe$f(a,b,c,n)=\\sum_{i=1}^n \\lfloor i*\\frac{a\\sqrt r+b}{c}\\rfloor$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u8fdb\u884c\u4ee5\u4e0b\u6b65\u9aa4:\n\n1. \u53bb\u6389\u540e\u9762\u65e0\u7406\u6570\u6574\u6570\u90e8\u5206\u4ea7\u751f\u7684\u8d21\u732e\u3002\n2. \u5c06\u51fd\u6570\u5173\u4e8e\u6a2a\u7eb5\u5750\u6807\u7ffb\u8f6c\uff0c\u7136\u540e\u7edf\u8ba1\u65b0\u51fd\u6570\u4ee5\u4e0b\u7684\u70b9\u6570\uff0c\u5bb9\u65a5\u6c42\u89e3\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5148\u5c06\u7b54\u6848\u52a0\u4e0a\n$$\\frac{n(n+1)\\lfloor\\frac{a\\sqrt{r}+b}{c}\\rfloor}{2}$$\n\n\u7136\u540e\uff0c\u51fd\u6570\u53d8\u4e3a:\n\n$$f(a,b-\\lfloor\\frac{a\\sqrt{r}+b}{c}\\rfloor*c,c,n)$$\n\n\u56e0\u4e3a\u659c\u7387\u53ea\u6709\u5c0f\u6570\u90e8\u5206\uff0c\u56e0\u6b64\u660e\u663e\u5728$(0,1)$\u5185\u3002\u56e0\u6b64\uff0c\u8fd9\u4e2a\u51fd\u6570\u7684\u503c\u57df\u6bd4\u5b9a\u4e49\u57df\u8981\u5c0f\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u53d6\u8fd9\u4e2a\u51fd\u6570\u7684\u53cd\u51fd\u6570\u3002\u53ef\u4ee5\u77e5\u9053\uff0c\u6b64\u65f6\u9700\u8981\u7edf\u8ba1\u7684\u7b54\u6848\u4e3a\u53cd\u51fd\u6570\u4ee5\u5de6\u90e8\u5206\u7684\u70b9\u6570\u3002\u4ee5\u5de6\u4e0d\u597d\u7edf\u8ba1\uff0c\u6211\u4eec\u7edf\u8ba1\u4ee5\u4e0b\u7684\uff0c\u7136\u540e\u5bb9\u65a5\u51cf\u6389\u3002\n\n\u6bcf\u64cd\u4f5c\u4e00\u6b21\u5b9a\u4e49\u57df\u4f1a\u4e58\u4e0a\u5f53\u524d\u659c\u7387\u7684\u5c0f\u6570\u90e8\u5206\u3002\u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u4f1a\u8fc7\u591a\uff0c\u53ef\u4ee5\u89c6\u4e3a$O(\\log n)$\u3002\u56e0\u4e3a\u7ffb\u8f6c\u8fc7\u7a0b$a,b,c$\u53ef\u80fd\u53d8\u4e3a\u5e73\u65b9\u7ea7\uff0c\u56e0\u6b64\u6bcf\u6b21\u9700\u8981\u4e0a\u4e0b\u540c\u65f6\u53d6gcd\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(\\log n\\log \\omega)$($\\omega$\u4e3a\u503c\u57df\uff0c$\\le 10^{18}$)\u3002\n\n\u4ee3\u7801:\n```cpp\n\nstatic int n,r;\n\nstatic double R;\n\nll gcd(ll a,ll b){return b?gcd(b,a%b):a;}\n\nll getans(ll a,ll b,ll c,int n)\n{\n\tif(!n)return 0;\n\tll cur=gcd(a,gcd(b,c));\n\ta/=cur,b/=cur,c/=cur;\n\tcur=(a*R+b)/c;\n\tll sm=cur*n*(n+1)/2;\n\tb-=c*cur,cur=(a*R+b)/c*n;\n\treturn sm+n*cur-getans(a*c,-b*c,a*a*r-b*b,cur);\n}\n\ninline void work()\n{\n\tread(n),read(r);\n\tR=sqrt(r);\n\tint rr=(int)R;\n\tif(rr*rr==r){write(rr&1?(n&1?-1:0):n);return;}\n\twrite(n-2*getans(1,0,1,n)+4*getans(1,0,2,n));\n}\n```",
        "postTime": 1546676567,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5172 \u3010Sum\u3011"
    },
    {
        "content": "\u63a8\u5f0f\u5b50\u524d\u9762\u7684\u9898\u89e3\u90fd\u63a8\u4e86\uff0c\u7c7b\u6b27\u524d\u9762\u7684\u9898\u89e3\u4e5f\u90fd\u6559\u4e86\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u4f1a\u3002\u56e0\u6b64\u672c\u7bc7\u9898\u89e3\u4fa7\u91cd\u4e8e\u5982\u4f55\u5bfb\u627e\u4e00\u4e2a\u8fd1\u4f3c $\\sqrt r$ \u7684\u6570\u3002\n\n---\n\n$$\nx\\bmod 2=x-2\\lfloor\\frac x2\\rfloor\n$$\n$$\n(-1)^x=1-2(x\\bmod 2)=1-2x+4\\lfloor\\frac x2\\rfloor\n$$\n\n$$\n\\sum_{d=1}^n(-1)^{\\lfloor d\\sqrt r\\rfloor}\n$$\n$$\n=n-2\\sum_{d=1}^n\\lfloor d\\sqrt r\\rfloor+4\\sum_{d=1}^n\\lfloor\\frac{d\\sqrt r}2\\rfloor\n$$\n\n\u5373\u6c42 $\\sum_{d=1}^n\\lfloor d\\sqrt p\\rfloor$ \u3002\u7c7b\u6b27\u5373\u53ef\u3002\n\n---\n\n\u7528 [Stern-Brocot-Tree](https://www.baidu.com/s?ie=UTF-8&wd=Stern-Brocot-Tree) **\u4e8c\u5206**\u903c\u8fd1\u6c42\u4e00\u4e2a\u8ddd\u79bb $\\sqrt r$ \u6700\u8fd1\u7684\u5206\u6570\u4ee5\u65b9\u4fbf\u7c7b\u6b27\uff0c\u9632\u6b62\u7cbe\u5ea6\u4e22\u5931\u3002\n\n\u5177\u4f53\u5b9e\u73b0\uff1a\u6211\u4eec\u6709\u56db\u4e2a\u53d8\u91cf $a,b,c,d$ \u8868\u793a $\\frac ab\\leq \\sqrt r\\leq\\frac cd$ \uff0c\u521d\u59cb\u65f6\u53ef\u4ee5\u4ee4 $a=0,b=1,c=1,d=0$ \u3002\u6bcf\u6b21\u64cd\u4f5c\u65f6\u4ee4 $mid1=a+c,mid2=b+d$ \uff0c\u7136\u540e\u5224\u65ad $\\sqrt r$ \u4e0e $\\frac{mid1}{mid2}$ \u7684\u5173\u7cfb\uff0c\u5982\u679c $\\sqrt r$ \u6bd4\u8f83\u5c0f\uff0c\u5c31\u8ba9 $c=mid1,d=mid2$ \uff0c\u5426\u5219 $a=mid1,b=mid2$ \u3002\u5f53 $b>n$ \u6216 $d>n$ \u65f6\u9000\u51fa\u3002\n\n\u56e0\u4e3a Stern-Brocot-Tree \u4e0a\u5305\u542b\u4e86\u6240\u6709\u5206\u6570\uff0c\u4e14\u6bcf\u4e2a\u5206\u6570\u53ea\u80fd\u7531\u5206\u5b50\u5206\u6bcd\u90fd\u6bd4\u5b83\u5c0f\u7684\u6570\u5f97\u6765\uff0c\u56e0\u6b64\u6240\u6709\u53ef\u80fd\u7684\u6570\u90fd\u53ef\u4ee5\u88ab\u679a\u4e3e\u5230\u3002\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u6709\u9057\u6f0f\uff0c\u5728\u300a\u5177\u4f53\u6570\u5b66\u300b\u4e2d\u7ed9\u51fa\u4e86\u4e00\u79cd\u8bc1\u660e~~\u4f46\u662f\u6211\u4e0d\u4f1a~~\u3002\n\n---\n\n\u6c42\u51fa\u7684\u503c\u80fd\u591f\u7b49\u4ef7\u4e8e $\\sqrt r$ \u7684\u8bc1\u660e\uff1a\n\n\u5df2\u77e5 $\\frac pq$ \u662f\u6240\u6709 $<\\sqrt r$ \u4e14\u5206\u6bcd\u5c0f\u4e8e $2n$ \u7684\u5206\u6570\u4e2d\u6700\u5927\u7684\u3002\n\n\u5982\u679c\u5b58\u5728 $i$ \u4f7f\u5f97 $\\lfloor\\frac{ip}q\\rfloor<\\lfloor i\\sqrt r\\rfloor$\n\n\u90a3\u4e48 $\\frac pq<\\frac{\\lfloor i\\sqrt r\\rfloor}i<\\sqrt r$\n\n\u56e0\u6b64 $\\frac pq$ \u4e0d\u4f1a\u662f\u6700\u5927\u7684\uff0c\u4e0e\u6761\u4ef6\u4e0d\u7b26\u3002\n\n---\n\n\u5b9e\u73b0\u65f6\u9700\u8981\u6ce8\u610f\uff0c\u56e0\u4e3a\u5bb9\u6613\u51fa\u73b0 $\\frac 1n$ \u8fd9\u79cd\u5361\u70c2\u590d\u6742\u5ea6\u7684\u6570\u636e\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528\u500d\u589e\u3002\u8981\u4e48\u53ef\u4ee5\u76f4\u63a5\u4ece $\\log n$ \u5f00\u59cb\u679a\u4e3e\uff1b\u8981\u4e48\u53ef\u4ee5\u50cf\u6211\u7684\u5b9e\u73b0\u4e00\u6837\uff0c\u5148\u4ece\u5c0f\u5411\u5927\u679a\u4e3e\u5230\u6700\u5927\u3002\n\n```cpp\nvoid find(ll&a,ll&b,ll&c,ll&d,int p)\n{\n\twhile(b<=n&&d<=n)\n\t{\n\t\tll mid1=a+c,mid2=b+d;\n\t\tif(check(mid1,mid2,p)) // mid1/mid2*p<=sqrt(r)\n\t\t{\n\t\t\ta=mid1,b=mid2;\n\t\t\tint k=1;\n\t\t\twhile(k>=0)\n\t\t\t{\n\t\t\t\tmid1=a+(c<<(ll)k),mid2=b+(d<<(ll)k);\n\t\t\t\tif(check(mid1,mid2,p)) a=mid1,b=mid2,k++;\n\t\t\t\telse k--;\n\t\t\t\tif(b>n) break;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tc=mid1,d=mid2;\n\t\t\tint k=1;\n\t\t\twhile(k>=0)\n\t\t\t{\n\t\t\t\tmid1=(a<<(ll)k)+c,mid2=(b<<(ll)k)+d;\n\t\t\t\tif(!check(mid1,mid2,p)) c=mid1,d=mid2,k++;\n\t\t\t\telse k--;\n\t\t\t\tif(d>n) break;\n\t\t\t}\n\t\t}\n\t}\n}\n```",
        "postTime": 1649822513,
        "uid": 146070,
        "name": "Pekemetier",
        "ccfLevel": 8,
        "title": "P5172 Sum \u9898\u89e3"
    },
    {
        "content": "- \u7531\u4e8e\u770b\u5230\u6b63\u89e3\u7684\u590d\u6742\u5ea6\u5e76\u4e0d\u53ef\u89c2\u4e8e\u662f\u6211\u5f00\u59cb\u5c1d\u8bd5\u4e71\u641e**\u4ee5\u83b7\u5f97\u66f4\u4f18\u79c0\u590d\u6742\u5ea6\u7684~~\u6b63\u786e\u7387\u7a0d\u4f4e~~\u7b97\u6cd5**\uff0c\u5728\u6ca1\u6253\u8bfb\u5165\u4f18\u5316\u6ca1\u5f00 O2 \u4e0b\u60c5\u51b5\u4e0b\u83b7\u5f97~~\u6682\u65f6~~\u699c1\u3002\n- \u663e\u7136\u6211\u8fd9\u4e2a\u7b97\u6cd5\u4f1a\u6709\u4e0d\u5c11\u6f0f\u6d1e\uff0c\u6240\u4ee5\u6b22\u8fce hack\u3002~~\uff08\u5176\u5b9e\u5e76\u4e0d\u60f3\u6b22\u8fce\uff09~~\n- [\u4e71\u641e\u8bb0\u5f55](https://www.luogu.com.cn/record/57168233)\u3002\n\n**\u9898\u610f**\n- \u6c42\uff1a\n$$F(n,r)=\\sum_{d=1}^n{(-1)}^{\\lfloor d\\sqrt r\\rfloor}$$\n\n**\u57fa\u7840\u6027\u8d28\u7684\u53d1\u73b0**\uff1a\n- \u663e\u7136\u9700\u8981\u5229\u7528 $(-1)^n=(-1)^{n\\bmod 2}$ \u8fd9\u4e2a\u6027\u8d28\u3002\n- \u5176\u5b9e\u8fd9\u4e2a\u9b3c\u4e1c\u897f\u53ef\u4ee5\u53d8\u6362\u4e00\u4e0b\uff0c\u53d8\u6210\uff1a\n$$(-1)^n=(-1)^{n\\bmod 2}=1-2\\cdot{(n\\bmod2)}$$\n- \u770b\u8d77\u6765\u5c31\u53ef\u505a\u5f88\u591a\u3002\n- \u6211\u4eec\u8fd8\u662f\u628a\u5b83\u8f6c\u5316\u6210\u6211\u4eec\u719f\u6089\u7684\u6574\u9664\u5f62\u5f0f\uff1a\n$$(-1)^n=1-2\\cdot{\\bigg(n-2\\cdot\\bigg\\lfloor\\frac n2\\bigg\\rfloor\\bigg)}=1-2n+4\\cdot\\bigg\\lfloor\\frac n2\\bigg\\rfloor$$\n- \u90a3\u4e48\uff1a\n$$F(n,r)=\\sum_{d=1}^n\\bigg(1-2\\lfloor d\\sqrt r\\rfloor+4\\cdot\\bigg\\lfloor\\frac {d\\sqrt r}2\\bigg\\rfloor\\bigg)=n-2\\cdot\\sum_{i=1}^n\\lfloor d\\sqrt r\\rfloor+4\\cdot\\sum_{i=1}^n\\bigg\\lfloor\\frac {\\sqrt{r}}2\\bigg\\rfloor\\bigg)$$\n- \u6211\u4eec\u53ef\u4ee5\u8bbe\uff1a\n$$G(n,r)=\\sum_{d=1}^n\\lfloor d\\sqrt r\\rfloor$$\n- \u4e0b\u9762\u89e3\u6cd5\u5f00\u59cb\u671d\u7740\u5947\u602a\u7684\u65b9\u5411\u53d1\u5c55\u3002\n- \u4e8e\u662f\u6211\u4eec\u6709\u4e00\u4e2a\u5947\u602a\u7684\u60f3\u6cd5\uff0c\u8981\u662f $\\sqrt r$ \u662f\u6709\u7406\u6570\u5c31\u597d\u4e86\u3002\n- \u4e8e\u662f\u4e0b\u9762\u6211\u4eec\u5c31\u5f00\u59cb\u5bfb\u627e\u63a5\u8fd1 $\\sqrt r$ \u7684\u6709\u7406\u6570\u3002\n\n**\u725b\u987f\u8fed\u4ee3**\n- \u8bbe\u8981\u6c42\u51fd\u6570 $f(x)$ \u7684\u96f6\u70b9\u3002\n- \u53ef\u4ee5\u8bc1\u660e\u8bbe $x_0$ \u4e3a\u96f6\u70b9\u9644\u8fd1\u7684\u4e00\u4e2a\u503c\uff0c\u6570\u5217 ${\\lbrace x_n\\rbrace}$ \u6ee1\u8db3 $x_{i+1}=x_{i}-\\frac{f(x)}{f'(x)}$ \uff0c\u5219\u6570\u5217\u4f1a\u6e10\u6e10\u903c\u8fd1 $f(x)$ \u7684\u67d0\u4e2a\u96f6\u70b9\u3002\n- \u4e8b\u5b9e\u4e0a\uff0c\u5f97\u5230\u6ee1\u8db3\u8981\u6c42\u7684\u7cbe\u5ea6\u6240\u7528\u8fed\u4ee3\u6b21\u6570\u4e0d\u8d85\u8fc7 6 \u6b21~~\u8fd8\u4f1a\u7206 long long~~\u3002\n- \u4e3a\u4ec0\u4e48\u4e0d\u7528\u4e8c\u5206\uff1f~~\u6015\u540e\u9762\u5927\u5e38\u6570\u8dd1\u4e0d\u8fc7\uff0c\u6bd5\u7adf gcd \u7684\u5e38\u6570\u5c0f\u5f97\u79bb\u8c31\u3002~~\n- \u6240\u4ee5\u7ed9\u8fed\u4ee3\u8bbe\u4e86\u4e00\u4e2a\u4e0a\u9650\u5728 $2^{-60}$ \u5de6\u53f3\u3002\n- \u540c\u65f6\u7528 $\\text{sqrt(x)}$ \u51fd\u6570\u9009\u53d6\u6bd4\u8f83\u7cbe\u786e\u7684\u521d\u503c\u3002\uff08\u7cbe\u786e\u5230\u7ea6 8 \u4f4d\uff09\n- \u540c\u65f6\u5f00\u4e86 $\\text{\\_\\_int128}$ \u3002\n\n**\u7c7b\u6b27\u51e0\u91cc\u5f97**\n- \u63a5\u4e0b\u6765\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u7ecf\u5178\u7684\u90e8\u5206\u5566\u3002\n- \u6c42\uff1a\n$$\\sum_{i=1}^n\\bigg\\lfloor\\frac{ai}c\\bigg\\rfloor$$\n- \u76f4\u63a5\u7528\u7c7b\u6b27\u51e0\u91cc\u5f97\u6a21\u677f\uff0c\u53ef\u4ee5\u770b[\u8fd9\u91cc](https://www.luogu.com.cn/blog/luo1gu1zui1bang1/solution-p5170)\u3002\n- \u590d\u6742\u5ea6\u662f $O(\\log a)$ \u7684\u3002\n\n**\u590d\u6742\u5ea6\u5206\u6790**\n- \u503c\u57df\u5728\u6211\u7684\u4e0a\u754c\u4e4b\u4e0b\u5927\u6982\u662f $[0,2^{72}]$ \uff0c\u8bbe\u503c\u57df\u4e3a $w$\uff0c\u725b\u987f\u6cd5\u7684\u590d\u6742\u5ea6\u5b8c\u5168\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u662f $O(T\\log{w})$ \u7684\uff0c\u7565\u4f18\u4e8e\u6b63\u89e3\u7684\u590d\u6742\u5ea6\u3002\n- \u7f3a\u70b9\u662f\u5bf9\u7cbe\u5ea6\u7684\u8981\u6c42\u9ad8\uff0c\u800c\u4e14\u6570\u636e\u8303\u56f4\u8fc7\u5927\u65f6\u5fc5\u987b\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\u589e\u5927\u7cbe\u5ea6\uff0c\u5e38\u6570\u8fc7\u5927\uff0c\u5f97\u4e0d\u507f\u5931\u3002\n- \u53e6\u5916\u53d1\u73b0\u5982\u679c\u6b63\u89e3\u5f00\u5927\u503c\u57df\u4e0d\u53d6 $\\gcd$ \u4f3c\u4e4e\u53ef\u4ee5\u8fbe\u5230\u66f4\u4f18\u7684\u60c5\u51b5\uff0c\u6240\u4ee5**\u89e3\u6cd5\u4ec5\u4f9b\u53c2\u8003**\u3002\n\n**\u4ee3\u7801\u5b9e\u73b0**\n- [\u5728\u4e91\u526a\u8d34\u677f](https://www.luogu.com.cn/paste/f2f10bym)\u3002",
        "postTime": 1629977824,
        "uid": 260884,
        "name": "WeLikeStudying",
        "ccfLevel": 0,
        "title": "P5172"
    },
    {
        "content": "\u9996\u5148\u8fd9\u4e2a\u5e42\u6b21\u4e0d\u597d\u5904\u7406\uff0c\u8bbe $r=x^2$\uff0c\u5148\u5224\u6389 $x$ \u662f\u6574\u6570\u7684\u60c5\u51b5\u3002\u8003\u8651\u8f6c\u5316\u4e00\u4e0b\uff0c\u6839\u636e $(-1)^k$ \u7684\u6027\u8d28\uff0c$k$ \u4e3a\u5076\u6570\u65f6\u7b49\u4e8e $1$\uff0c$k$ \u4e3a\u5947\u6570\u65f6\u7b49\u4e8e $0$\uff0c\u90a3\u4e48\r\n$$\r\n\\begin{aligned}\r\n(-1)^k&=1-2\\times(k\\ \\text{and}\\ 1)\\\\\r\n&=1-2(k-2\\lfloor\\dfrac k2\\rfloor)\\\\\r\n&=1-2k+4\\lfloor\\dfrac k2\\rfloor\\\\\r\n\\end{aligned}\r\n$$\r\n\u90a3\u4e48\u5c06\u539f\u5f0f\u62c6\u6210\u4e09\u4e2a\u90e8\u5206\uff1a\r\n$$\\sum^n_{d=1}(-1)^{\\lfloor dx\\rfloor}=n-\\sum^n_{d=1}\\lfloor dx\\rfloor+4\\sum^n_{d=1}\\lfloor\\dfrac{\\lfloor dx\\rfloor}2\\rfloor$$\r\n\u7c7b\u6b27\u5957\u8def\uff0c\u8bbe $f(a,b,c,n)=\\sum^n_{i=1}\\lfloor\\dfrac{ax+b}c\\times i\\rfloor,p=\\dfrac{ax+b}c$\uff0c\u63a5\u7740\u5f00\u59cb\u5316\u7b80\u3002  \r\n\u5f53 $p\\ge1$ \u65f6\uff1a\r\n$$\r\n\\begin{aligned}\r\nf(a,b,c,n)&=\\sum^n_{i=1}\\lfloor pi-\\lfloor p\\rfloor i+\\lfloor p\\rfloor i\\rfloor\\\\\r\n&=\\binom{n + 1}2\\lfloor p\\rfloor+\\sum^n_{i=1}\\lfloor\\dfrac{ax+b-c\\lfloor p\\rfloor}c\\times i\\rfloor\\\\\r\n&=\\binom{n + 1}2\\lfloor p\\rfloor+f(a, b-c\\lfloor p\\rfloor,c,n)\\\\\r\n\\end{aligned}\r\n$$\r\n\u5f53 $p<1$ \u65f6\uff1a\r\n$$\r\n\\begin{aligned}\r\nf(a,b,c,n)&=\\sum^n_{i=1}\\sum^{\\lfloor np\\rfloor}_{j=1}[j<pi]\\\\\r\n&=\\sum^n_{i=1}\\sum^{\\lfloor np\\rfloor}_{j=1}[\\dfrac jp<i]\\\\\r\n&=\\sum^n_{i=1}\\sum^{\\lfloor np\\rfloor}_{j=1}[\\dfrac{jc}{ax+b}<i]\\\\\r\n&=\\sum^{\\lfloor np\\rfloor}_{j=1}\\sum^n_{i=1}[\\dfrac{jc}{ax+b}<i]\\\\\r\n&=\\sum^{\\lfloor np\\rfloor}_{j=1}(n-\\lfloor\\dfrac{jc}{ax+b}\\rfloor)\\\\\r\n&=\\sum^{\\lfloor np\\rfloor}_{j=1}(n-\\lfloor\\dfrac{c}{ax+b}\\times j\\rfloor)\\\\\r\n&=n\\lfloor np\\rfloor-\\sum^{\\lfloor np\\rfloor}_{j=1}\\lfloor\\dfrac c{ax+b}\\times j\\rfloor\\\\\r\n&=n\\lfloor np\\rfloor-\\sum^{\\lfloor np\\rfloor}_{j=1}\\lfloor\\dfrac{acx-bc}{a^2r-b^2}\\times j\\rfloor\\\\\r\n&=n\\lfloor np\\rfloor-f(ac,-bc,a^2r-b^2,\\lfloor np\\rfloor)\\\\\r\n\\end{aligned}\r\n$$\r\n\u6700\u540e\u7ed3\u679c\u5373\u4e3a $n-2f(1,0,1,n)+4f(1,0,1,2)$\uff0c\u5b8c\u7ed3\u6492\u82b1\u3002  \r\n# AC \u4ee3\u7801\r\n```cpp\r\n#include <bits/stdc++.h>\r\n\r\nusing namespace std;\r\n\r\ntypedef long long ll;\r\ntypedef double db;\r\n\r\nint t;\r\n\r\nll n, r, k;\r\n\r\ndb x;\r\n\r\nll gcd(ll a, ll b) {\r\n\treturn b ? gcd(b, a % b) : a;\r\n}\r\n\r\ninline \r\nll c2(ll n) {\r\n\treturn n * (n - 1) >> 1;\r\n}\r\n\r\nll f(ll a, ll b, ll c, ll n) {\r\n\tif (!n) return 0;\r\n\tll d = gcd(gcd(a, b), c);\r\n\ta /= d, b /= d, c /= d;\r\n\tll p1 = (a * x + b) / c, p2 = (a * x + b) * n / c;\r\n\tif (p1) return c2(n + 1) * p1 + f(a, b - c * p1, c, n);\r\n\treturn n * p2 - f(a * c, -b * c, a * a * r - b * b, p2);\r\n}\r\n\r\nint main() {\r\n\tfor (scanf(\"%d\", &t); t--;) {\r\n\t\tscanf(\"%lld%lld\", &n, &r), x = sqrt((db)r), k = x;\r\n\t\tif (k * k == r) { printf(\"%lld\\n\", k & 1 ? n & 1 ? -1 : 0 : n); }\r\n\t\telse printf(\"%lld\\n\", n - 2 * f(1, 0, 1, n) + 4 * f(1, 0, 2, n));\r\n\t}\r\n}\r\n```",
        "postTime": 1665753009,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "P5172 \u9898\u89e3"
    }
]