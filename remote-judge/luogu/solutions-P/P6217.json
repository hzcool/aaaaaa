[
    {
        "content": "$\\text{Upd. 2020/03/15}$\uff1a\u91cd\u5199\u4e86\u90e8\u5206\u5185\u5bb9\u4f7f\u5176\u66f4\u52a0\u6613\u61c2\uff1b\u4fee\u6539\u4e86\u5c11\u91cf\u9519\u522b\u5b57\uff1b\u4fee\u6b63\u4e86\u5c11\u91cf\u516c\u5f0f\u9519\u8bef\u3002\n\n# \u9898\u610f\n\n\u7ed9\u51fa\u6b63\u6574\u6570\u5e8f\u5217 $a$\uff0c\u591a\u6b21\u7ed9\u51fa $l,r,x$ \u8be2\u95ee $\\prod_{i=l}^r\\operatorname{lcm}(a_i,x)$\u3002\n\n# \u5206\u6790\n\n\u89c2\u5bdf\u5230\n\n$$\\prod_{i=l}^r\\operatorname{lcm}(a_i,x)=\\frac{x^{r-l+1}\\prod_{i=l}^ra_i}{\\prod_{i=l}^r\\gcd(a_i,x)}$$\n\n\u660e\u663e $x^{r-l+1}\\prod_{i=l}^ra_i$ \u53ef\u4ee5\u7ef4\u62a4\u524d\u7f00\u79ef\u5e76\u4f7f\u7528\u5feb\u901f\u5e42\u6c42\u51fa\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u6c42 $\\prod_{i=l}^r\\gcd(a_i,x)$ \u7684\u503c\u5373\u53ef\u3002\n\n\u5982\u679c\u5c06 $a_i$ \u548c $x$ \u5206\u522b\u4f5c\u8d28\u56e0\u6570\u5206\u89e3\uff1a\n\n$$\\begin{aligned}a_i&=\\prod_{j=1}^kp_j^{q_{ij}}\\\\x&=\\prod_{j=1}^kp_j^{q_{xj}}\\end{aligned}$$\n\n\u5176\u4e2d $p_j$ \u8868\u793a\u7b2c $j$ \u4e2a\u8d28\u6570\uff0c$q\\in\\mathbb N$\u3002\u90a3\u4e48\u6709\n\n$$\\begin{aligned}\\prod_{i=l}^r\\gcd(a_i,x)&=\\prod_{i=l}^r\\prod_{j=1}^kp_j^{\\min(q_{ij},q_{xj})}\\\\&=\\prod_{i=1}^kp_i^{\\sum_{j=l}^r\\min(q_{ji},q_{xi})}\\\\&=\\prod_{i=1}^kp_i^{\\sum_{t=1}^{q_{xi}}\\sum_{j=l}^r[t\\le q_{ji}]}\\\\&=\\prod_{i=1}^kp_i^{\\sum_{t=1}^{q_{xi}}\\sum_{j=l}^r\\left[p_i^t\\small|\\scriptsize p_i^{q_{ji}}\\right]}\\\\&=\\prod_{i=1}^kp_i^{\\sum_{t=1}^{q_{xi}}\\sum_{j=l}^r\\left[p_i^t\\small|\\scriptsize a_j\\right]}\\end{aligned}$$\n\n\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5206\u522b\u5bf9\u6bcf\u4e00\u4e2a\u80fd\u591f\u6574\u9664 $x$ \u7684\u8d28\u6570\u6b63\u6574\u6570\u5e42\uff0c\u6c42\u51fa\u5b83\u80fd\u591f\u6574\u9664 $a_l,a_{l+1},\\ldots,a_r$ \u4e2d\u7684\u591a\u5c11\u4e2a\u6570\uff0c\u5c06\u5e95\u6570\u76f8\u540c\u7684\u5e42\u7684\u4e2a\u6570\u76f8\u52a0\u540e\u5feb\u901f\u5e42\u6c42\u79ef\u5373\u4e3a\u9700\u8981\u6c42\u7684\u90e8\u5206\u3002\n\n\u5982\u679c\u7ebf\u6027\u7b5b\u9884\u5904\u7406\u5c0f\u4e8e $\\sqrt x$ \u7684\u8d28\u6570\uff0c\u90a3\u4e48\u679a\u4e3e $p_i$ \u7684\u590d\u6742\u5ea6\u4e3a\n\n$$\\mathcal O\\left(\\pi\\left(\\sqrt x\\right)\\right)\\leq\\Theta\\left(\\frac{\\sqrt x}{\\log\\sqrt x}\\right)=\\Theta\\left(\\frac{\\sqrt x}{\\log x}\\right)$$\n\n\u8bbe\u80fd\u6574\u9664\u4e00\u4e2a\u6570 $x$ \u7684\u6240\u6709\u8d28\u6570\u6b63\u6574\u6570\u5e42\u5f62\u6210\u7684\u96c6\u5408\u4e3a $\\operatorname{PP}(x)$\u3002\u8003\u8651\u5230\u5bf9\u4e8e\u4efb\u610f\u8d28\u6570 $p\\ge2$\uff0c\u6709\n\n$$\\big|\\operatorname{PP}(x\\times p)\\big|=\\big|\\operatorname{PP}(x)\\big|+1$$\n\n\u56e0\u800c\n\n$$\\mathcal O\\left(\\big|\\operatorname{PP}(x)\\big|\\right)=\\mathcal O(\\log x)$$\n\n\u56e0\u6b64\u6c42\u51fa $\\operatorname{PP}(x)$ \u7684\u603b\u590d\u6742\u5ea6\u4e3a\n\n$$\\Theta\\left(\\frac{\\sqrt x}{\\log x}\\right)+\\mathcal O(\\log x)=\\Theta\\left(\\frac{\\sqrt x}{\\log x}\\right)$$\n\n\u53ef\u4ee5\u5148\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $a_i$ \u6c42\u51fa $\\operatorname{PP}(a_i)$\uff0c\u4e4b\u540e\u5c06\u6bcf\u4e00\u4e2a\u8d28\u6570\u7684\u6b63\u6574\u6570\u5e42\u4e0e\u5305\u542b\u5b83\u7684\u96c6\u5408\u5bf9\u5e94\u3002\u8fd9\u6837\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\u7684 $x$\uff0c\u53ef\u4ee5\u5728 $\\mathcal O(\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u4e8c\u5206\u67e5\u627e\u5230 $l,r$ \u5728\u80fd\u591f\u88ab\u6574\u9664 $x$ \u7684\u4e00\u4e2a\u8d28\u6570\u6b63\u6574\u6570\u5e42\u6574\u9664\u7684 $a_i$ \u7684\u4e0b\u6807 $i$ \u7684\u96c6\u5408\u4e2d\u7684\u4f4d\u7f6e\uff0c\u8fdb\u4e00\u6b65\u8ba1\u7b97\u51fa\u8be5\u8d28\u6570\u6b63\u6574\u6570\u5e42\u5728 $\\operatorname{PP}(a_l),\\operatorname{PP}(a_{l+1}),\\ldots,\\operatorname{PP}(a_r)$ \u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u5bf9\u6bcf\u4e00\u4e2a\u8d28\u6570\u7684\u6b63\u6574\u6570\u5e42\u4f5c\u4e8c\u5206\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f $\\mathcal O(\\log n)$\uff0c\u5171\u6709 $\\mathcal O(\\log x)$ \u4e2a\u8fd9\u6837\u7684\u8d28\u6570\u6b63\u6574\u6570\u5e42\uff0c\u6545\u6b64\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e3a $\\mathcal O\\left(\\log x\\log n\\right)$\u3002\u4ece\u800c\u5f97\u5230\u8fd9\u4e2a\u505a\u6cd5\u7684\u603b\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(\\sqrt a+n\\log a)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\n\n$$\\Theta\\left(n\\frac{\\sqrt a}{\\log a}\\right)+\\mathcal O\\left(q\\pi\\left(\\sqrt a\\right)\\right)+\\mathcal O\\left(q\\log x\\log n\\right)\\leq\\Theta\\left(n\\frac{\\sqrt a}{\\log a}+q\\frac{\\sqrt a}{\\log a}+q\\log x\\log n\\right)$$\n\n\u5982\u679c\u8ba4\u4e3a $n,q,a_i,x\\sim N$\uff0c\u5219\u603b\u590d\u6742\u5ea6\u4e3a $\\Theta\\left(\\frac{N\\sqrt N}{\\log N}\\right)\\sim\\Theta\\left(\\frac{\\sqrt N}{\\log N}\\right)\\sim\\mathcal O(N\\log N)$\u3002\n\n\u66f4\u4f18\u7684\u505a\u6cd5\u662f\u5728\u7ebf\u6027\u7b5b\u7684\u65f6\u5019\u8bb0\u5f55\u7b5b\u53bb\u6bcf\u4e00\u4e2a\u6570\u7684\u8d28\u6570\uff0c\u8fd9\u4e2a\u8d28\u6570\u5c31\u4e00\u5b9a\u662f\u8be5\u6570\u7684\u6700\u5c0f\u8d28\u56e0\u5b50\u3002\u4e8e\u662f\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0d\u65ad\u9664\u4ee5\u5b83\u7684\u6700\u5c0f\u8d28\u56e0\u5b50\u6765\u5f97\u5230\u5b83\u7684\u6240\u6709\u7684\u8d28\u56e0\u5b50\u3002\u7531\u4e8e\u6bcf\u4e00\u6b21\u9664\u90fd\u8fd9\u4e2a\u6570\u90fd\u8981\u81f3\u5c11\u51cf\u5c11\u4e00\u534a\uff0c\u6240\u4ee5\u5229\u7528\u8fd9\u4e2a\u65b9\u6cd5\u6c42 $\\operatorname{PP}(x)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(\\log x)$\u3002\u603b\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(\\max(a,x)+n\\log a)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\n\n$$\\mathcal O\\left(\\max(a,x)+n\\log a\\right)+\\mathcal O\\left(q\\log x\\right)+\\mathcal O\\left(q\\log x\\log n\\right)=\\mathcal O\\left(\\max(a,x)+n\\log a+q\\log x\\log n\\right)$$\n\n\n\n\u5982\u679c\u8ba4\u4e3a $n,q,a_i,x\\sim N$\uff0c\u5219\u603b\u590d\u6742\u5ea6\u4e3a $\\mathcal O\\left(N\\log N\\right)\\sim\\mathcal O\\left(\\log^2N\\right)\\sim\\mathcal O(N\\log N)$\u3002\n\n# \u53c2\u8003\u4ee3\u7801\n\n```cpp\n  mul[0] = 1;\n  for (int i = 1; i <= n; ++i) {\n    int t = read();\n    mul[i] = mul[i - 1] * t % P;\n    while (~-t) {\n      const int &p = fir[t];\n      int tmp = 1;\n      while (!(t % p)) {\n        t /= p;\n        tmp *= p;\n        vc[tmp].push_back(i);\n      }\n    }\n  }\n  while (q--) {\n    const int &l = read(), &r = read(), &x = read();\n    int t = x;\n    long long res = 1ll;\n    while (~-t) {\n      const int &p = fir[t];\n      int tmp = 1, tot = 0;\n      while (!(t % p)) {\n        t /= p;\n        tmp *= p;\n        tot += upper_bound(vc[tmp].begin(), vc[tmp].end(), r) - lower_bound(vc[tmp].begin(), vc[tmp].end(), l);\n      }\n      res = res * qpow(p, tot) % P;\n    }\n    cout << (mul[r] * qpow(mul[l - 1] * res % P, P - 2) % P * qpow(x, r - l + 1) % P) << '\\n';\n  }\n```",
        "postTime": 1584184030,
        "uid": 55251,
        "name": "Daniel13265",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6217\u3010\u7b80\u5355\u6570\u8bba\u9898\u3011"
    },
    {
        "content": "\u597d\u9898\uff01\uff01\uff01\uff01\uff08\u6bd4\u6211\u51fa\u7684\u597d\u591a\u4e86\uff09\uff08\u6bd4\u8d5b\u65f6sb\u5199\u4e86\u4e2a $O(n)$ \u7684\u8d28\u56e0\u6570\u5206\u89e3\uff09\n\n\u6c42 $\\prod\\limits_{i=l}^{r}\\operatorname{lcm}(x,a_i)$\n\n\u505a\u9898\u505a\u591a\u4e86\uff0c\u5c31\u4f1a\u53d1\u73b0\uff0c$\\operatorname{lcm}$ \u8fd9\u79cd\u4e1c\u897f\u4e00\u822c\u90fd\u662f\u8f6c\u4e3a $\\gcd$ \u6765\u6c42\u3002\u5c1d\u8bd5\u8f6c\u6362\u4e00\u4e0b\uff1a\n$\\prod\\limits_{i=l}^{r}\\operatorname{lcm}(x,a_i)=\\prod\\limits_{i=l}^{r}\\dfrac{x\\times a_i}{\\gcd(x,a_i)}$\n\n\u800c\u4e0a\u9762\u7684\u4e1c\u897f\u660e\u663e\u53ef\u4ee5\u9884\u5904\u7406\u3002\n\n\u73b0\u5728\u5c31\u8f6c\u4e3a\u6c42 $\\prod\\limits_{i=l}^r\\gcd(x,a_i)$\n\n\u8fd9\u4e2a\u4e1c\u897f\u4f3c\u4e4e\u4e0d\u597d\u53cd\u6f14\uff1f\uff08\u53cd\u6b63\u6211\u4e0d\u4f1a\uff09\n\n\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u4e2a $\\gcd$ \u7684\u503c\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u5c06\u6bcf\u4e00\u4e2a\u6570\u5206\u89e3\u8d28\u56e0\u6570\uff0c\u90a3\u4e48 $\\gcd$ \u5c31\u662f\u8fd9\u4e9b\u6570\u4e2d\u51fa\u73b0\u6b21\u6570\u76f8\u540c\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff1a\n\n\u5047\u8bbe\u4e00\u4e2a\u6570 $x$ \u80fd\u5206\u89e3\u4e3a $p_1^{a_1}p_2^{a_2}\\dots p_k^{a_k}$\n\n\u90a3\u4e48\u8d21\u732e\u4e3a $\\sum\\limits_{i=1}^ka_i\\sum\\limits_{j=1}^{a_i}cnt_{a_i^j}$\n\n\u5176\u4e2d $cnt_x$ \u8868\u793a\u4ece $l \\sim r$ \u4e2d $x$ \u7684\u500d\u6570\u7684\u4e2a\u6570\u3002\n\n\u7531\u4e8e $\\sum a_i$ \u4e0d\u8d85\u8fc7 $\\log x$\uff0c\u53ef\u4ee5\u66b4\u529b\u6c42\uff0c\u73b0\u5728\u8003\u8651\u600e\u6837\u5feb\u901f\u6c42 $cnt$\u3002\uff08\u6570\u5b66 $->$ \u6570\u636e\u7ed3\u6784\uff09\n\n\u53ef\u4ee5\u5c06\u6240\u6709\u7684 $a_i$ \u8d28\u56e0\u6570\u5206\u89e3\uff0c\u7136\u540e\u63d2\u5165\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u679a\u4e3e\u6bcf\u4e00\u4e2a\u8d28\u6570\u548c\u5b83\u7684\u500d\u6570\uff0c\u5982\u679c\u80fd\u88ab $a_i$ \u6574\u9664\uff0c\u5219\u63d2\u5165\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\uff0c\u8be2\u95ee\u65f6\u5dee\u5206\u4e00\u4e0b\uff0c\u67e5\u8be2 $1\\sim r$ \u4e2d\u67d0\u4e2a\u8d28\u6570\u6216\u5176\u5e42\u6b21\u65b9\u51fa\u73b0\u7684\u6b21\u6570 $-  1\\sim l$ \u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u53ef\u4ee5\u63d0\u524d\u9884\u5904\u7406\u51fa\u6240\u6709\u8d28\u6570\uff08\u7ebf\u6027\u7b5b\uff09\uff0c\u6765\u964d\u4f4e\u5206\u89e3\u8d28\u56e0\u6570\u590d\u6742\u5ea6\u3002\n\n\u603b\u590d\u6742\u5ea6\uff1a\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\dfrac{n\\sqrt n}{\\ln n})$\uff08\u7ebf\u6027\u7b5b $max_{a_i}$\n\uff0c\u5206\u89e3\u6240\u6709 $a_i$ \u662f $\\dfrac{n\\sqrt a_i}{\\ln a_i}$\uff0c\u63d2\u5165\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u662f $n\\log^2 a_i$\uff0c\u5206\u89e3\u6240\u6709 $x$ \u662f $\\dfrac{q\\sqrt x}{\\ln x}$\uff0c\u5728\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u8be2\u95ee\u662f $q\\log^2 x$\uff09\n\n~~\u5982\u679c\u4f60\u5acc\u8fd9\u4e2a\u505a\u6cd5\u6162\uff0cPollard-Rho \u4e86\u89e3\u4e00\u4e0b~~\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#define re register\n#define M 1000000007\nusing namespace std;\nint a[200002],n,p[200002],b[200002],siz[80000002],tot,ls[80000002],rs[80000002],rt[200002],cnt,pos[1000002];\nbool ip[200012];\nconst int Mxdt=200000;\ninline char gc(){\n\tstatic char buf[Mxdt],*p1=buf,*p2=buf;\n\treturn p1==p2&&(p2=(p1=buf)+fread(buf,1,Mxdt,stdin),p1==p2)?EOF:*p1++;\n}\ninline int read() {\n\tre int t=0;\n\tre char v=gc();\n\twhile(v<'0')v=gc();\n\twhile(v>='0') {\n\t\tt=(t<<3)+(t<<1)+v-48;\n\t\tv=gc();\n\t}\n\treturn t;\n}\ninline void insert(re int &x,re int y,re int l,re int r,re int v){\n\tbool nw=0;\n\tif(!x){\n\tx=++cnt;nw=1;\n\tsiz[x]=siz[y]+1;\t}\n\telse ++siz[x];\n\tif(l==r){return;}\n\tre int mid=l+r>>1;\n\tif(v<=mid){\n\t\tif(nw)rs[x]=rs[y];\n\t\tinsert(ls[x],ls[y],l,mid,v);\n\t}\n\telse{\n\t\tif(nw)ls[x]=ls[y];\n\t\tinsert(rs[x],rs[y],mid+1,r,v);\n\t}\n}\ninline int count(re int x,re int l,re int r,re int v){\n\tif(!x)return 0;\n\tif(l==r){return siz[x];}\n\tre int mid=l+r>>1;\n\tif(v<=mid)return count(ls[x],l,mid,v);\n\telse return count(rs[x],mid+1,r,v);\n}\ninline int gcd(re int x,re int y){\n\treturn y?gcd(y,x%y):x;\n}\ninline int ksm(re int x,re int y){\n\tre int ans=1;\n\twhile(y){\n\t\tif(y&1)ans=1ll*ans*x%M;\n\t\tx=1ll*x*x%M;\n\t\ty>>=1;\n\t}\n\treturn ans;\n}\ninline int max(re int x,re int y) {\n\treturn x>y?x:y;\n}\nint l,r,q,x;\nint main() {\n\tn=read();\n\tq=read();\n\tfor (int i=2; i<=200010; i++) {\n\t\tif (!ip[i]) {\n\t\t\tp[++tot]=i;\n\t\t\tpos[i]=tot;\n\t\t}\n\t\tfor (int j=1; j<=tot&&1ll*i*p[j]<=200010; j++) {\n\t\t\tip[i*p[j]]=1;\n\t\t\tif (i%p[j]==0)break;\n\t\t}\n\t}\n\ta[0]=1;\n\tfor(re int i=1; i<=n; ++i) {\n\t\tre int x=b[i]=read(),num=0;\n\t\ta[i]=1ll*a[i-1]*x%M;\n\t\tre int nw=0,lst=rt[i-1];\n\t\tre int k=sqrt(x);\n\t\tfor(re int j=1;p[j]<=k;++j){\n\t\t\tnum=1;\n\t\twhile(x%p[j]==0)x/=p[j],num*=p[j],insert(nw,lst,1,200000,num),lst=nw,nw=0;\n\t\t}\n\t\tif(x!=1)insert(nw,lst,1,200000,x),lst=nw,nw=0;\n\t\tif(b[i]==1){\n\t\t\trt[i]=rt[i-1];\n\t\t}\n\t\telse rt[i]=lst;\n\t}\n\twhile(q--){\n\t\tl=read();r=read();re int x1=x=read(),ans=1;\n\t\tre int k=sqrt(x);\n\t\tfor(re int i=1;p[i]<=k;++i){\n\t\t\tre int num=1;\n\t\t\twhile(x1%p[i]==0){\n\t\t\t\tx1/=p[i];\n\t\t\t\tnum*=p[i]\uff1b\n\t\t\t\tans=1ll*ans*ksm(p[i],(count(rt[r],1,200000,num)-count(rt[l-1],1,200000,num)))%M;\n\t\t\t}\n\t\t}\n\t\tif(x1!=1){\n\t\t\tans=1ll*ans*ksm(x1,(count(rt[r],1,200000,x1)-count(rt[l-1],1,200000,x1)))%M;\n\t\t}\n\t\tprintf(\"%d\\n\",1ll*a[r]*ksm(a[l-1],M-2)%M*ksm(x,r-l+1)%M*ksm(ans,M-2)%M);\n\t}\n\n}\n```\n\n\n",
        "postTime": 1584246884,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6217 \u3010\u7b80\u5355\u6570\u8bba\u9898\u3011"
    },
    {
        "content": "$subtask\\ 1$ \u8fc7\u4e8e\u7b80\u5355\u5c31\u4e0d\u5199\u4e86\uff0c\u5c31\u662f\u66b4\u529b\u800c\u5df2\n\n- $subtask\\ 2$\n   \n   \u672c $subtask$ \u524d\u7f6e\u77e5\u8bc6\uff1a[\u9006\u5143](https://www.luogu.com.cn/problem/P3811) + [\u5feb\u901f\u5e42](https://www.luogu.com.cn/problem/P1226)\n   \n   \u9996\u5148\u89c2\u5bdf\u5230\u4e00\u4e2a\u663e\u800c\u6613\u89c1\u7684\u4e8b\u5b9e\uff1a\n   \n   $\\prod_{i=l}^r lcm(a_i,x) = \\frac{(\\prod_{i=l}^r a_i) \\times (\\prod_{i=l}^r x)}{\\prod_{i=l}^r gcd(a_i,x)}$\n   \n   $\\prod_{i=l}^r a_i$ \u662f\u4e0d\u53ef\u51cf\u7684\uff0c\u53ef\u4ee5\u7528\u524d\u7f00\u79ef\u7b97\u51fa\u6765\n   \n   $\\prod_{i=l}^r x = x ^ {r - l + 1}$\uff0c\u53ef\u4ee5\u5feb\u901f\u5e42\u89e3\u51b3\n   \n   \u7136\u540e\u4f60\u4f1a\u53d1\u73b0\uff0c\u6240\u6709 $a_i,x$ \u4e3a\u4e92\u4e0d\u76f8\u540c\u7684\u8d28\u6570\u610f\u5473\u7740\u6240\u6709\u6570\u4e92\u8d28\uff0c\u6240\u4ee5 $\\prod_{i=l}^r gcd(a_i,x) = 1$\n   \n   \u7136\u540e\u8fd9\u4e2a $subtask$ \u5c31\u505a\u5b8c\u4e86\n\n- $subtask\\ 3$\n\n   \u672c $subtask$ \u524d\u7f6e\u77e5\u8bc6\uff1a[\u4e3b\u5e2d\u6811](https://www.luogu.com.cn/problem/P3834)\u3001[\u9006\u5143](https://www.luogu.com.cn/problem/P3811)\n   \n   \u672c $subtask$ \u6709\u4e2a\u5f88\u597d\u7684\u6027\u8d28\uff1a\u6240\u6709 $a_i$ \u4e3a\u8d28\u6570\n   \n   \u6240\u4ee5 $gcd(a_i,x)$ \u53ea\u53ef\u80fd\u4e3a $a_i$ \u6216 $1$ \uff0c\u800c\u5f53  $gcd(a_i,x) = a_i$ \u65f6\uff0c$a_i$ \u662f $x$ \u7684\u56e0\u5b50\n   \n   \u53ef\u4ee5\u5206\u89e3 $x$ \uff0c\u6c42\u51fa\u6bcf\u4e2a\u8d28\u56e0\u5b50\u5728 $[l,r]$ \u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u4ee5\u6b64\u8ba1\u7b97 $\\prod_{i=l}^r gcd(a_i,x)$\uff0c\u5b83\u5c31\u4e3a$\\prod_{i=1}^n i ^ {cnt_i}$\uff08$cnt_i$\u8868\u793a$i$\u51fa\u73b0\u6b21\u6570\uff09\n   \n   \u7136\u540e\u5c31\u8f6c\u53d8\u4e3a\u4e86\u4e00\u4e2a\u6bd4\u8f83\u597d\u89e3\u51b3\u7684\u95ee\u9898\uff1a\u4e0d\u5e26\u4fee\uff0c\u67e5\u8be2 $x$ \u6570\u5728 $[l,r]$ \u51fa\u73b0\u6b21\u6570\n   \n   \u6700\u7ecf\u5178\u7684\u505a\u6cd5\u5c31\u662f\u4e3b\u5e2d\u6811\u7ef4\u62a4\u6743\u503c\uff08\u5f53\u7136\u4f60\u5206\u5757\u4e4b\u7c7b\u4e5f\u884c\uff09\n   \n   \u6ce8\u610f\u6211\u4eec\u8ba1\u7b97\u5b8c\u662f\u8981\u9664\u4ee5 $\\prod_{i=l}^r gcd(a_i,x)$\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u6211\u4eec\u7ed9\u7b54\u6848\u4e58\u4e0a $inv[i] ^ {cnt_i}$\n   \n- $subtask\\ 4$\n\n   \u8fd9\u4e2a$subtask$\u548c$subtask\\ 3$\u6ca1\u4ec0\u4e48\u533a\u522b\n   \n   $\u03bc(a_i) \\neq 0$ \u4ee3\u8868 $a_i$ \u6bcf\u4e2a\u8d28\u56e0\u5b50\u6b21\u6570 $\\le 1$\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u7528\u8003\u8651\u4e00\u4e2a\u6bd2\u7624\u7684\u95ee\u9898\uff1a\n\n   $x$ \u8d28\u56e0\u5b50\u6b21\u6570\u6bd4 $a_i$ \u4f4e\uff0c\u5b83\u7528\u4e0d\u4e86\u5168\u90e8\u7684\u6b21\u65b9\u2026\u2026\n   \n   \u521a\u624d\u7684\u505a\u6cd5\u5b8c\u5168\u5904\u7406\u4e0d\u4e86\u8fd9\u6837\u7684\u95ee\u9898\n   \n   \u5176\u5b9e\u8fd9\u4e2a $subtask$ \u53ea\u8981\u5206\u89e3\u4e00\u4e0b $a_i$ \u5c31\u5b8c\u4e8b\u4e86\n   \n- $subtask\\ 5$\n\n   \u73b0\u5728\u6211\u4eec\u8981\u76f4\u9762\u4e00\u4e2a\u6bd2\u7624\u96be\u9898\uff1a$x$\u8d28\u56e0\u5b50\u6b21\u6570\u6bd4$a_i$\u4f4e\uff0c\u5b83\u7528\u4e0d\u4e86\u5168\u90e8\u7684\u6b21\u65b9\n   \n   \u9996\u5148\u80af\u5b9a\u8fd8\u662f\u8981\u8d28\u56e0\u6570\u5206\u89e3\n   \n   \u5047\u8bbe\u73b0\u5728\u6b63\u5728\u6c42\u89e3\u95ee\u9898 $[l,r,x]$ \uff0c\u5f53\u524d\u8003\u8651\u5230\u8d28\u56e0\u5b50 $p$ \uff0c\u51fd\u6570 $v(x,y)$ \u8868\u793a $x$ \u4e2d\u8d28\u56e0\u5b50 $y$ \u7684\u4e2a\u6570\n   \n   \u90a3\u4e48\u6211\u4eec\u8981\u6c42\u8fd9\u4e2a\u4e1c\u897f\uff1a\n   \n   $\\sum\\limits_{i = l} ^ r\\ min(v(a_i,p),v(x,p))$\n   \n   $v(a_i,p)$ \u4e0e $v(x,p)$ \u662f\u5df2\u77e5\u7684\uff0c\u4f46\u662f\u4e00\u7ef4\u8fd8\u662f\u4e0d\u592a\u597d\u505a\n   \n   \u6240\u4ee5\u8003\u8651\u770b\u6210\u4e00\u4e2a $n \\times 20$ \u7684\u77e9\u9635 $M$\n   \n   $M_{i,j} = \\begin{cases}1&\\text{ai\u4e2d\u542b\u6709\u81f3\u5c11j\u4e2ap}\\\\0&\\text{otherwise}\\end{cases}$\n   \n   \u8fd9\u5c31\u5f88\u8212\u670d\u4e86\uff0c\u6bcf\u6b21\u6c42\u7684\u662f$\\sum\\limits_{i = l} ^ r \\sum\\limits_{j = 1} ^ {v(p)} M_{i,j}$\n   \n   \u8fd9\u660e\u663e\u5c31\u662f\u4e00\u4e2a\u4e8c\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u6392\u5e8f + \u6811\u72b6\u6570\u7ec4\u76f4\u63a5\u4e0a\n   \n   \u5f53\u7136\uff0c\u4f60\u5199\u4e2a $log^3\\ n$ \u4e5f\u80fd\u901a\u8fc7\u672c $subtask$\n\n- $subtask\\ 6$\n\n   \u5982\u679c\u4f60 $sort$ + \u6811\u72b6\u6570\u7ec4\u76f4\u63a5\u83bd\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u70b8\u6210 $75$\n   \n   \u56e0\u4e3a\u4e00\u4e2a\u77e9\u9635\u5185\u6700\u591a\u6709 $n\\ log\\ a_i$ \u4e2a\u70b9\uff0c$sort$ \u4e00\u904d\u590d\u6742\u5ea6\u4f1a\u53d8\u6210 $O(q\\ (log\\ n) ^ 2\\ log\\ log\\ n)$\uff0c\u591a\u4e86\u4e00\u4e2a $log\\ log\\ n$\n   \n   \u6b63\u786e\u7684\u505a\u6cd5\u662f\uff1a\u7528\u7c7b\u4f3c\u94fe\u5f0f\u524d\u5411\u661f\u7684\u65b9\u6cd5\uff0c\u5b9e\u73b0$O(n\\ log\\ n)$\u7684\u5bf9 $M$ \u77e9\u9635\u4e2d\u7684\u70b9\u6392\u5e8f\uff0c\u5c06\u8be2\u95ee\u4e22\u5230\u4e0d\u540c\u7684 $vector$ \u91cc\u89e3\u51b3\n   \n   \u5982\u679c\u4f60\u66b4\u529b\u5206\u89e3\u8d28\u56e0\u6570\uff0c\u53ef\u80fd\u4e5f\u4f1a\u70b8\u6210 $75$\n   \n   \u6b63\u786e\u7684\u505a\u6cd5\u662f\u7528\u57c3\u6c0f\u7b5b\u7b5b\u51fa\u6765\n   \n   \u53cd\u6b63\u8fd9\u4e9b\u90fd\u662f\u5b9e\u73b0\u95ee\u9898\uff0c\u770b\u4ee3\u7801\u5c31\u884c\n   \n[code](https://www.luogu.com.cn/paste/m5nqfsg6)",
        "postTime": 1578728281,
        "uid": 49776,
        "name": "chenxinyang2006",
        "ccfLevel": 0,
        "title": "\u7b80\u5355\u6570\u8bba\u9898 \u89e3\u6790"
    },
    {
        "content": "**Upd**\uff1a\u4fee\u590d\u4e86\u90e8\u5206\u6570\u5b66\u516c\u5f0f\u9519\u8bef\n\n------\n\n\u5148\u63a8\u63a8\u5f0f\u5b50\n\n$Ans=\\prod_{i=l}^rlcm(a_i,x)$\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ =\\frac{x^{r-l+1}\\prod_{i=l}^ra_i}{\\prod_{i=l}^rgcd(a_i,x)}$\n\n$x^{r-l+1}\\prod_{i=l}^ra_i$ \u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u9884\u5904\u7406\u7b97\u51fa\uff0c\u4e0b\u9762\u53ea\u8003\u8651 $\\prod_{i=l}^rgcd(a_i,x)$\n\n$\\prod_{i=l}^rgcd(a_i,x)=\\prod_{g}g^{\\sum_{i=l}^r[gcd(a_i,x)=g]}$\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\prod_{g|x}g^{\\sum_{i=l}^r[g|a_i]*[gcd({a_i\\over g},{x\\over g})=1]}$\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\prod_{g|x}g^{\\sum_{d|\\frac xg} \\mu(d)*\\sum_{i=l}^r[dg|a_i]}$\n\n\n\u8bbe $T=d*g$\n\n$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ =\\prod_{T|x}(\\prod_{g|T}g^{\\mu(\\frac Tg)})^{\\sum_{i=l}^r[T|a_i]}$\n\n\n\u5bf9\u4e8e $1<=T<=MAXV$ \u9884\u5904\u7406 $val_T=\\prod_{g|T}g^{\\mu(\\frac Tg)}$ \uff0c\u8fd9\u4e00\u90e8\u5206\u662f $O(n \\log n)$ \u7684\u3002\n\n\u9884\u5904\u7406\u6bcf\u4e2a\u6570\u7684\u56e0\u6570\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u679a\u4e3ex\u7684\u56e0\u6570\uff0c\u5c06\u8be2\u95ee\u62c6\u6210 $2*d(x)$ \u4e2a\u5f62\u5982 $val_T^{\\sum_{i=1}^p[T|a_i]}$ \u7684\u4e58\u79ef\uff0c\u6302\u5728 $r$ \u548c $l-1$ \u4f4d\u7f6e\u7684 vector \u4e0a\u3002\n\n\u5c06 $a_i$ \u6309\u987a\u5e8f\u52a0\u5165\uff0c\u52a0\u5165\u65f6\u679a\u4e3e $a_i$ \u7684\u56e0\u5b50\uff0c\u8be2\u95ee\u65f6\u53ef\u4ee5\u505a\u5230 $O(1)$ \u67e5\u8be2\u3002\n\n\u901a\u8fc7\u79bb\u7ebf\u6c42\u9006\u5143\u7684\u65b9\u6cd5\u7cbe\u7ec6\u5730\u5b9e\u73b0\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u505a\u5230 $O(n\\log n+\\sum d(x))$\n\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/ob4wyb53)\n",
        "postTime": 1584415057,
        "uid": 81844,
        "name": "xyr2005",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6217 \u3010\u7b80\u5355\u6570\u8bba\u9898\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6217)\n\n#### \u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u5b9a\u5e8f\u5217 $a$\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u5b9a $l,r,x$\uff0c\u6c42 $\\prod\\limits^r_{i=l}\\operatorname{lcm}(a_i,x)$\u3002\n\n#### \u5927\u81f4\u601d\u8def\uff1a\n\n\u719f\u6089\u7684\u5957\u8def\uff0c\u770b\u5230 $\\operatorname{lcm}$ \u76f4\u63a5\u8f6c\u4e3a $\\gcd$\u3002\n\n$\\prod\\limits^r_{i=l}\\operatorname{lcm}(a_i,x)=\\frac{x^{r-l+1}\\prod\\limits^r_{i=l}a_i}{\\prod\\limits^r_{i=l}\\gcd(a_i,x)}$\n\n\u9884\u5904\u7406+\u5feb\u901f\u5e42\u5b8c\u4e0a\u9762\u7684\u90e8\u5206\u540e\u95ee\u9898\u5373\u53ef\u8f6c\u4e3a\u6c42 $\\prod\\limits^r_{i=l}\\gcd(a_i,x)$\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u600e\u4e48\u6c42\u5462\uff1f\u6ce8\u610f\u5230 $\\gcd$ \u7684\u540e\u9879\u6bcf\u6b21\u67e5\u8be2\u662f\u56fa\u5b9a\u7684\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u628a\u6bcf\u4e00\u9879 $a_i=p_1^{d_1}p_2^{d_2}\\dots p_k^{d_k}$ \u7684\u8d21\u732e\u89c6\u4e3a$\\sum\\limits_{i=1}^k d_i\\sum\\limits_{j=1}^{d_i}\\operatorname{count}(d_i^j)$ \uff0c\u5176\u4e2d $\\operatorname{count}$ \u7684\u533a\u95f4\u4e3a $[l,r]$\u3002\n\n\u90a3\u4e48\u95ee\u9898\u53c8\u6765\u5230\u4e86 $\\operatorname{count}$\uff0c\u600e\u4e48\u6c42\u5462\uff1f\n\n\u5f88\u5bb9\u6613\u60f3\u5230\u4e3b\u5e2d\u6811\u3002\u5148\u7ebf\u6027\u7b5b\u9884\u5904\u7406\u8d28\u6570\uff0c\u518d\u5c06\u6240\u6709 $a$ \u4e2d\u7684\u5143\u7d20\u5206\u89e3\u8d28\u56e0\u6570\u540e\u7684 $p_i$ \u53ca\u5b83\u7684\u500d\u6570\u63d2\u5165\u5230\u6811\u4e2d\uff0c\u4e4b\u540e\u5feb\u901f\u67e5\u8be2\u524d\u7f00\u4e2d $p,p^2,\\dots,p^k$ \u7684\u6570\u91cf\uff0c\u6700\u540e\u8fdb\u884c\u5dee\u5206\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5728 $\\mathcal{O(n\\sqrt n+\\sum \\log^2 a_i+\\sum\\log^2 x)}$ \u5de6\u53f3\u3002",
        "postTime": 1652617840,
        "uid": 557958,
        "name": "danny101",
        "ccfLevel": 0,
        "title": "P6217\u9898\u89e3"
    }
]