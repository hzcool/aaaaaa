[
    {
        "content": "\n\u5927\u5bb6\u597d\u6211\u7cfb\u51fa\u9898\u4eba\uff08\u8fd8\u6709\u4e2a\u80cc\u9505\u4fa0mcfx\uff09\n\n\u9898\u76ee\u80cc\u666f\u662fsummer pockets!\n\n\u5bf9\u4e8e\u6d4b\u8bd5\u70b91,2\uff0c\u4f7f\u7528$O(R^N\\times N^2)$\u7684\u7b97\u6cd5\u5373\u53ef\u901a\u8fc7\n\n\u5bf9\u4e8e\u6d4b\u8bd5\u70b93,4,5,6\uff0c\u53ef\u4ee5\u53d1\u73b0\u53ea\u9700\u8981\u679a\u4e3e\u6392\u5e8f\u540e\u7684\u6570\u5217\u5373\u53ef\u3002\u7136\u540e\u4f7f\u7528\u4e00\u4e9b\u7ec4\u5408\u6570\u5b66\u8ba1\u7b97\u7b54\u6848\u3002\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u53d8\u5f97\u53ef\u4ee5\u63a5\u53d7\u3002\u5927\u7ea6\u53ea\u6709$10^6$\u79cd\u4e0d\u540c\u7684\u6570\u5217\n\n----------------------------\n\n\u88f8\u66b4\u529b\u7684\u90e8\u5206\u5df2\u7ecf\u7ed3\u675f\u3002\u73b0\u5728\u6211\u4eec\u6765\u8bb2\u6b63\u89e3\u3002\u8003\u8651\u5bf9\u6bcf\u4e2a\u6570\u5206\u5f00\u7b97\u8d21\u732e\uff0c\u5373\u5bf9\u4e8e$x\\in[0,P-1]$\uff0c\u7b97\u6709$x$\u51fa\u73b0\u7684\u7f51\u683c\u6570\u3002\n\n\u8003\u8651\u8865\u96c6\u8f6c\u5316\u4e00\u4e0b\uff0c\u5373\u7b97\u6ca1\u6709$x$\u51fa\u73b0\u7684\u7f51\u683c\u6570\u3002\n\n$x=0$\u53ef\u4ee5\u7279\u5224\uff0c\u5373\u5982\u679c\u6ca1\u6709$P$\u7684\u500d\u6570\u51fa\u73b0\u5219\u4e0d\u4f1a\u51fa\u73b0$0$\n\n\u73b0\u5728\u53ea\u8003\u8651$x\\in[1,P-1]$\u3002\u6ca1\u6709$x$\u51fa\u73b0\uff0c\u76f8\u5f53\u4e8e\u6709\u82e5\u5e72\u5bf9$(s,t)(st\\mod P=x)$\u4e0d\u80fd\u540c\u65f6\u51fa\u73b0\u5728\u6570\u5217\u91cc\u3002\u7531\u4e8e$P$\u662f\u8d28\u6570\uff0c\u6240\u4ee5\u8fd9\u6837\u7684\u6709\u5e8f\u5bf9\u4e00\u5b9a\u53ea\u6709$(P-1)$\u5bf9\u3002\n\n\u6bd4\u5982$P=5,x=1$\uff0c\u5c31\u6709\u5982\u4e0b\u5bf9\uff1a$(1,1),(2,3),(3,2),(4,4)$\n\n\u8fd9\u65f6\uff0c\u4f60\u53d1\u73b0\u9664\u53bb$s=t$\u7684\uff0c\u5c31\u76f8\u5f53\u4e8e\u82e5\u5e72\u4e2a\u4e92\u4e0d\u5e72\u6d89\u7684\u9650\u5236\uff1a$s$\u548c$t$\u4e0d\u80fd\u540c\u65f6\u51fa\u73b0\u3002$s=t$\u7684\u60c5\u51b5\u5c31\u662f\u8fd9\u4e2a\u6570\u672c\u8eab\u4e0d\u80fd\u51fa\u73b0\u3002\u8fd9\u610f\u5473\u7740\u8fd9\u4e9b\u9650\u5236\u53ef\u4ee5\u5355\u72ec\u8003\u8651\u65b9\u6848\uff0c\u7136\u540e\u518d\u5168\u90fd\u505a\u5377\u79ef\n\n\u4f60\u53c8\u53d1\u73b0$R\\leq 10^9$\u3002\u8fd9\u5b9e\u5728\u662f\u592a\u5927\u4e86\uff01\u4e0d\u8fc7\u4f60\u53ef\u4ee5\u628a\u4f59\u6570\u76f8\u540c\u7684\u89c6\u4e3a\u4e00\u4f53\uff0c\u5047\u8bbe\u8fd9\u4e2a\u4f59\u6570\u51fa\u73b0\u4e86$A$\u6b21\uff0c\u5c31\u76f8\u5f53\u4e8e\u5982\u679c\u9009\u8fd9\u4e2a\u4f59\u6570\uff0c\u5c31\u6709$A$\u79cd\u65b9\u6cd5\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u6240\u6709\u4f59\u6570\u7684\u51fa\u73b0\u6b21\u6570\u53ea\u6709$A$\u548c$A+1$\u8fd9\u4e24\u79cd\u3002\u6240\u4ee5\u521a\u624d\u90a3\u4e9b\u9650\u5236\u53ef\u4ee5\u53d8\u6210\uff1a\n\na0\u79cd(A,A)(\u5373s,t\u90fd\u51fa\u73b0\u4e86A\u6b21),a1\u79cd(A,A+1),a2\u79cd(A+1,A),a3\u79cd(A+1,A+1)\n\n\u6240\u4ee5\uff0c\u7528\u6307\u6570\u751f\u6210\u51fd\u6570\u8868\u793a\uff0c\u9650\u5236(A,A)\u7684\u6307\u6570\u751f\u6210\u51fd\u6570\u4e3a$e^{Ax}e^{Ax}-(e^{Ax}-1)(e^{Ax}-1)=e^{Ax}+e^{Ax}-1$\n\n\u7b54\u6848\u7684\u6307\u6570\u751f\u6210\u51fd\u6570\u4e3a$(e^{Ax}+e^{Ax}-1)^{a0} (e^{Ax}+e^{(A+1)x}-1)^{a1+a2} (e^{(A+1)x}+e^{(A+1)x}-1)^{a3} e^{(R/P)x}$\uff08\u6700\u540e\u90a3\u4e2a\u662f\u8003\u8651$0$\u7684\u60c5\u51b5\uff09\n\n\u8fd9\u5df2\u7ecf\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u4e3a$O(n^2P+P^2)$\uff08$P^2$\u662f\u5904\u7406a0,a1,a2,a3\uff09\n\n\u6253\u8868\u53ef\u4ee5\u53d1\u73b0\uff0c\u672c\u8d28\u4e0d\u540c\u7684$(a0,a1,a2,a3)$\u53ea\u6709$O(\\sqrt{P})$\u79cd\uff01\u8fd9\u4e0d\u597d\u8bc1\u660e\uff0c\u4f46\u662f\u5728\u6570\u636e\u8303\u56f4\u4e0b\u662f\u6210\u7acb\u7684\u3002\uff08mcfx\uff1a\u53ef\u4ee5\u628a\u8fd9\u4e2a\u5e8f\u5217\u5f53\u505a\u662f\u968f\u673a\u7684\uff0c\u611f\u6027\u7406\u89e3\u4e00\u4e0b\uff09\n\n$O(n^2\\sqrt{P}+P^2)$\u548c$O(n^2\\sqrt{P}\\log P+P^2)$\u5747\u53ef\u901a\u8fc7\u8be5\u9898\u3002\n\n\u6765\u81ea\u51fa\u9898\u4eba\u7684\u8fa3\u9e21\u6807\u7a0b\uff08\u8be5\u6807\u7a0b\u53ef\u4ee5\u5927\u5e45\u4f18\u5316\uff0c\u4f46\u662f\u61d2\u5f97\u5199\u4e86\uff09\n\n```cpp\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\n#define maxP 5010\n#define maxn 5010\nusing namespace std;\nconst int mod=1e9+7;\nstruct data{\n    int a,b,c;\n    data(){}\n    data(int a,int b,int c):a(a),b(b),c(c){}\n    bool operator<(const data& d)const{\n        if(a!=d.a)return a<d.a;\n        if(b!=d.b)return b<d.b;\n        return c<d.c;\n    }\n};\nmap<data,int>st;\nint sP,tg[maxP];\nint ans,n,P,R,fac[maxn],inv[maxn],cnt[maxP][2];\nint f[maxn],g[maxn],A,lim,tmp[maxn],dp0[250][maxn],dp1[250][maxn],dp2[250][maxn];\nint sdp0[250][maxn],sdp1[250][maxn],sdp2[250][maxn];\nvoid mul(int a[],int b[],int c[]){\n    for(int i=0;i<=n;++i)tmp[i]=0;\n    for(int i=0;i<=n;++i)\n        for(int j=0;i+j<=n;++j)\n            tmp[i+j]=(tmp[i+j]+1ll*a[i]*b[j])%mod;\n    for(int i=0;i<=n;++i)c[i]=tmp[i];\n}\nint qpow(int a,int b){\n    int ans=1;\n    for(;b;b>>=1,a=1ll*a*a%mod)\n        if(b&1)ans=1ll*ans*a%mod;\n    return ans;\n}\nint C(int x,int y){\n    if(y<0||x<y)return 0;\n    return 1ll*fac[x]*inv[y]%mod*inv[x-y]%mod;\n}\nvoid cp(int fr[],int to[]){\n    for(int i=0;i<=n;++i)to[i]=fr[i];\n}\nvoid get(int dp[250][maxn],int sdp[250][maxn],int a,int g[]){\n    cp(dp[a%sP],g);\n    mul(sdp[a/sP],g,g);\n}\nvoid init(int dp[250][maxn],int sdp[250][maxn]){\n    dp[0][0]=sdp[0][0]=1;\n    for(int i=2;i<=sP;++i)mul(dp[i-1],dp[1],dp[i]);\n    cp(dp[sP],sdp[1]);\n    for(int i=2;i<=sP;++i)mul(sdp[i-1],sdp[1],sdp[i]);\n}\nint main(){\n    scanf(\"%d%d%d\",&n,&P,&R);\n//\tfprintf(stderr,\"[R%P=%d]\",R%P);\n    fac[0]=inv[0]=1;\n    for(int i=1;i<=n;++i)fac[i]=1ll*fac[i-1]*i%mod;\n    inv[n]=qpow(fac[n],mod-2);\n    for(int i=n-1;i>=1;--i)inv[i]=1ll*inv[i+1]*(i+1)%mod;\n    A=R/P,lim=R%P;\n    for(int i=1;i<P;++i)\n        for(int j=i+1;j<P;++j){\n//\t\t\tif(i*j%P!=2)continue;\n            if(i>lim&&j>lim)cnt[i*j%P][0]++; // 0: A\n            else if(i<=lim&&j<=lim)cnt[i*j%P][1]++; //1:A+1\n        }\n    for(int i=1;i<P;++i)tg[i*i%P]++;\n    \n    for(int i=1;i<P;++i)\n//\t\tif(i==2)\n            st[data(cnt[i][0],cnt[i][1],tg[i])]++;\n    sP=sqrt(P);\n    for(int i=0;i<=n;++i)dp0[1][i]=2ll*qpow(A,i)*inv[i]%mod;\n    dp0[1][0]--,init(dp0,sdp0);\n    \n    for(int i=0;i<=n;++i)dp1[1][i]=1ll*(qpow(A,i)+qpow(A+1,i))*inv[i]%mod;\n    dp1[1][0]--,init(dp1,sdp1);\n    \n    for(int i=0;i<=n;++i)dp2[1][i]=2ll*qpow(A+1,i)*inv[i]%mod;\n    dp2[1][0]--,init(dp2,sdp2);\n    \n    \n    for(map<data,int>::iterator it=st.begin();it!=st.end();++it){\n        int a0=it->first.a,a3=it->first.b,tg=it->first.c;\n        for(int i=0;i<=n;++i)f[i]=g[i]=0;\n        f[0]=1;\n        get(dp0,sdp0,a0,g),mul(f,g,f);\n        get(dp1,sdp1,(P-1-tg)/2-a0-a3,g),mul(f,g,f);\n        get(dp2,sdp2,a3,g),mul(f,g,f);\n        for(int i=0;i<=n;++i)g[i]=1ll*inv[i]*qpow(A,i)%mod;\n        mul(f,g,f);\n        ans=(ans-1ll*it->second*(f[n]))%mod;\n    }\n    ans=(1ll*fac[n]*ans+1ll*P*qpow(R,n)-qpow(R-A,n))%mod;\n    ans=(ans%mod+mod)%mod;\n    printf(\"%d\",ans);\n}\n```",
        "postTime": 1540127214,
        "uid": 11751,
        "name": "ComeIntoPower",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4935 \u3010\u53e3\u888b\u91cc\u7684\u7eb8\u98de\u673a\u3011"
    },
    {
        "content": "\u51fa\u9898\u4eba\u7684\u6bd2\u7624\u751f\u6210\u51fd\u6570\u6ca1\u770b\u61c2,\u63d0\u4f9b\u53e6\u4e00\u79cd\u65b9\u6cd5qwq\n\n\u5982\u679c\u60f3\u901a\u8fc7\u679a\u4e3e\u6bcf\u4e2a\u77e9\u9635,\u7b97\u51fa\u5b83\u7684\u6cd5\u6cd5\u503c\u6765\u505a\u7684\u8bdd,\u53ea\u80fd\u901a\u8fc7\u66b4\u529b\u5206,\u65e0\u6cd5\u8fdb\u884c\u8fdb\u4e00\u6b65\u4f18\u5316.\n\n\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u6bcf\u4e00\u4e2a\u6570\u5b57 $x$ \u5728\u591a\u5c11\u77e9\u9635\u91cc\u51fa\u73b0\u8fc7,\u5206\u5f00\u7b97\u8d21\u732e.\n\u4f46\u662f\u53d1\u73b0,\u8fd9\u6837\u7684\u8d21\u732e\u4ecd\u7136\u4e0d\u597d\u7b97,\u90a3\u6b63\u96be\u5219\u53cd,\u7b97\u51fa\u5b83\u6ca1\u6709\u5728\u54ea\u4e9b\u77e9\u9635\u4e2d\u51fa\u73b0\u8fc7.\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a $x$, $1\\leq x\\leq P$ , \u5982\u679c\u5b83\u4e0d\u80fd\u51fa\u73b0,\u90a3\u4e48\u80af\u5b9a\u4f1a\u51fa\u73b0\u4e00\u4e9b\u4e8c\u5143\u7ec4 $(A_i,B_i)$ \u4f7f\u5f97 $A_i*B_i\\%P=x$, \u6240\u4ee5 $(A_i,B_i)$ \u8fd9\u4e24\u4e2a\u6570\u5b57\u4e4b\u95f4\u5c31\u53ea\u80fd\u9009\u4e00\u4e2a, \u5426\u5219\u5c31\u4f1a\u51fa\u73b0 $x$.\n\n\u7279\u522b\u7684,\u5f53 $A_i=B_i$, \u8fd9\u4e2a\u6570\u5b57\u672c\u8eab\u5c31\u4e0d\u80fd\u9009.\n\n\u56e0\u4e3a $R$ \u7279\u522b\u5927,\u6240\u4ee5\u8fd9\u6837\u7684\u4e8c\u5143\u7ec4\u4f1a\u6709\u5f88\u591a\u4e2a, \u65e0\u6cd5\u5904\u7406. \u5bb9\u6613\u53d1\u73b0 $A_i,A_i+P,A_i+2*P$ \u662f\u5b8c\u5168\u7b49\u4ef7\u7684, \u6240\u4ee5\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u628a\u5728\u6a21 $P$ \u610f\u4e49\u4e0b\u76f8\u7b49\u7684\u6570\u5b57\u5206\u5230\u4e00\u7c7b\u53bb. \n\n\u56e0\u4e3a $P$ \u662f\u8d28\u6570, \u6240\u4ee5\u5bf9\u4e8e $\\forall x \\in [1,P-1]$, \u8fd9\u4e9b\u4e8c\u5143\u7ec4\u4e4b\u95f4\u4e24\u4e24\u6ca1\u6709\u4ea4. \n\n\u5148\u7279\u5224\u4e00\u4e0b $0$, \u53ea\u8981\u9009\u62e9\u4e86 $P$ \u7684\u500d\u6570\u5c31\u4e00\u5b9a\u4f1a\u51fa\u73b0 $0$, \u76f4\u63a5\u51cf\u53bb\u5c31\u884c\u4e86.\n\n\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb DP \u4e86. \u5bf9\u4e8e\u6bcf\u4e2a $x$, \u6211\u4eec\u5904\u7406\u51fa\u5b83\u7684\u6240\u6709\u4e8c\u5143\u7ec4, \u8bbe\u72b6\u6001 $f_{i,j}$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u4e2a\u4e8c\u5143\u7ec4,\u653e\u4e86 $j$ \u4e2a\u6570\u5b57\u7684\u65b9\u6848\u6570. \u90a3\u4e48:\n$$f_{i,j}*(cnt_{A_{i+1}}^t+cnt_{B_{i+1}}^t)*C_{j+t}^t \\to f_{i+1,j+t}$$\n\n$cnt_x$ \u8868\u793a $x$ \u8fd9\u4e00\u7c7b\u6570\u4e00\u5171\u6709\u591a\u5c11\u4e2a.\n\n\u610f\u4e49\u5c31\u662f\u4ece $A_{i+1}$ \u6216 $B_{i+1}$ \u4e2d\u6709\u5e8f\u5730\u9009\u51fa $t$ \u4e2a\u6570, \u518d\u63d2\u5165\u5230\u5f53\u524d\u7684 $j$ \u4e2a\u6570\u5f53\u4e2d\u53bb.\n\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(P^2n^2)$\u7684.\n\n\u4e0d\u96be\u53d1\u73b0,\u6bcf\u79cd\u7b49\u4ef7\u7c7b\u7684 $cnt$ \u53ea\u53ef\u80fd\u662f $\\lfloor \\frac{R}{P} \\rfloor$ \u6216 $\\lfloor \\frac{R}{P} \\rfloor +1$, \u6240\u4ee5\u672c\u8d28\u4e0d\u540c\u7684\u4e8c\u5143\u7ec4\u53ea\u4f1a\u67093\u79cd, \u4e5f\u5c31\u662f $(\\lfloor \\frac{R}{P} \\rfloor,\\lfloor \\frac{R}{P} \\rfloor),(\\lfloor \\frac{R}{P} \\rfloor \\lfloor \\frac{R}{P} \\rfloor+1),(\\lfloor \\frac{R}{P} \\rfloor+1 \\lfloor \\frac{R}{P} \\rfloor+1)$\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u5206\u5f00\u8ba8\u8bba\u4e86.\u628a\u8fd9\u4e09\u79cd\u4e8c\u5143\u7ec4\u7f16\u53f7\u4e3a $0,1,2$, \u7ed9 $f$ \u6570\u7ec4\u65b0\u5f00\u4e00\u7ef4\u53d8\u6210 $f_{0/1/2,i,j}$ \u8868\u793a\u8003\u8651\u4e86 $i$ \u4e2a $0/1/2$ \u7c7b\u4e8c\u5143\u7ec4,\u4e14\u653e\u5165\u4e86 $j$ \u4e2a\u6570\u7684\u65b9\u6848\u6570.\n\n\u5148\u9884\u5904\u7406\u51fa\u8fd9\u4e2a\u6570\u7ec4, \u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $x \\in [1,P-1]$ , \u5904\u7406\u51fa\u5b83\u6709\u591a\u5c11\u4e2a $0/1/2$ \u7c7b\u4e8c\u5143\u7ec4, \u7136\u540e\u5408\u5e76\u4e00\u4e0b\u5c31\u597d\u4e86.\n\u8fd9\u6837\u590d\u6742\u5ea6\u662f $O(Pn^2)$\n\n\u518d\u8003\u8651\u5206\u5757\u4e71\u641e. \u5bf9\u4e8e $f_{0/1/2,i,j}$ \u6211\u4eec\u53ea\u5904\u7406\u51fa $i\\leq \\sqrt{P}$ \u7684\u6240\u6709 $f$ \u503c, \u518d\u5f00\u4e00\u4e2a\u6570\u7ec4 $g_{0/1/2,i,j}$ \u8868\u793a\u8003\u8651\u4e86 $i*\\sqrt{P}$ \u4e2a $0/1/2$ \u7c7b\u4e8c\u5143\u7ec4, \u653e\u4e86 $j$ \u4e2a\u6570\u5b57\u7684\u65b9\u6848\u6570. \u5bf9\u4e8e $g$ ,\u6211\u4eec\u4ecd\u7136\u53ea\u7528\u5904\u7406\u51fa $i \\leq \\sqrt{P}$ \u7684\u6240\u6709\u503c.\n\n\u6211\u4eec\u73b0\u5728\u5c31\u53ef\u4ee5\u5229\u7528 $f$ \u548c $g$ ,\u5728 $O(n^2)$ \u5185\u5377\u51fa\u8003\u8651\u4efb\u610f\u4e2a\u4e8c\u5143\u7ec4\u7684 $dp$ \u6570\u7ec4.\n\n\u5bf9\u4e8e\u8fd9\u91cc\u7684 \"\u5377\u79ef\" \u548c\u4e0a\u9762 $g$ \u6570\u7ec4\u7684\u9884\u5904\u7406, \u5b9e\u9645\u4e0a\u8fd8\u662f\u65b0\u63d2\u5165\u6709\u5e8f\u7684 $t$ \u4e2a\u6570.\u6240\u4ee5\u8ddfdp\u7684\u65f6\u5019\u6ca1\u6709\u4ec0\u4e48\u5dee\u522b.\n\u5927\u6982\u957f\u8fd9\u6837:\n```\nvoid MergeDp(int id,int cc)\n{\n\tint vF=cc%lim,vG=cc/lim;\n\tfor(int i=0;i<=n;++i)\n\t\tfor(int j=0;j+i<=n;++j)\n\t\t\tinc(dp[id][i+j],mul(G[id][vG][i],mul(F[id][vF][j],C[i+j][j])));\n            //C\u662f\u7ec4\u5408\u6570\n}\n```\n\n\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u795e\u4ed9\u7ed3\u8bba. \u5bf9\u4e8e\u6240\u6709 $x\\in [1,P-1]$, \u4e09\u79cd\u4e8c\u5143\u7ec4\u4e2a\u6570\u6709\u5dee\u522b\u7684 $x$ \u4e0d\u4f1a\u8d85\u8fc7 $\\sqrt{P}$ \u4e2a. \u6240\u4ee5\u8bb0\u5fc6\u5316\u4e00\u4e0b\u5c31\u597d\u4e86. (\u8bc1\u660e?\u4e0d\u4f1a)\n\n----------\n\u8d34\u4e0a\u5e38\u6570\u6781\u5927\u7684\u4ee3\u7801:\n```\n#include<cstdio>\n#include<cstring>\n#include<cstdlib>\n#include<cmath>\n#include<map>\n#define mod 1000000007\nusing namespace std;\ninline int add(int a,int b){a+=b; return a>=mod?a-mod:a;}\ninline void inc(int &a,int b){a=add(a,b);}\ninline int mul(int a,int b){return 1ll*a*b%mod;}\nint ksm(int a,int b)\n{\n\tint s=1;\n\tfor(;b;b>>=1,a=mul(a,a))\n\t\tif(b&1) s=mul(s,a);\n\treturn s;\n}\nint ksm_P(int a,int b,int p)\n{\n\tint s=1;\n\tfor(;b;b>>=1,a=1ll*a*a%p)\n\t\tif(b&1) s=1ll*s*a%p;\n\treturn s;\n}\nint C[512][512],F[3][128][512],G[3][128][512],inv[5005],n,P,R,lim;\nint pw[505],pw1[505];\nvoid Pre()\n{\n\tfor(int i=0;i<=500;++i)\n\t{\n\t\tC[i][0]=1;\n\t\tfor(int j=1;j<=i;++j)\n\t\t\tC[i][j]=add(C[i-1][j-1],C[i-1][j]);\n\t}\n\tint cnt=R/P; lim=sqrt(P);\n\tF[0][0][0]=F[1][0][0]=F[2][0][0]=1;\n\tG[0][0][0]=G[1][0][0]=G[2][0][0]=1;\n\tfor(int i=0;i<=n;++i) pw[i]=ksm(cnt,i),pw1[i]=ksm(cnt+1,i);\n\tpw[0]=pw1[0]=(mod+1)/2;\n\tfor(int i=0;i<lim;++i)\n\t{\n\t\tfor(int j=0;j<=n;++j)\n\t\t{\n\t\t\tfor(int t=0;t+j<=n;++t)\n\t\t\t{\n\t\t\t\tinc(F[0][i+1][j+t],mul(F[0][i][j],mul(add(pw[t],pw[t]),C[j+t][t])));\n\t\t\t\tinc(F[1][i+1][j+t],mul(F[1][i][j],mul(add(pw1[t],pw[t]),C[j+t][t])));\n\t\t\t\tinc(F[2][i+1][j+t],mul(F[2][i][j],mul(add(pw1[t],pw1[t]),C[j+t][t])));\n\t\t\t}\n\t\t}\n\t}\n\tpw[0]=pw1[0]=1;\n\tfor(int i=0;i<lim;++i)\n\t{\n\t\tfor(int j=0;j<=n;++j)\n\t\t{\n\t\t\tfor(int t=0;t+j<=n;++t)\n\t\t\t{\n\t\t\t\tinc(G[0][i+1][j+t],mul(G[0][i][j],mul(F[0][lim][t],C[j+t][t])));\n\t\t\t\tinc(G[1][i+1][j+t],mul(G[1][i][j],mul(F[1][lim][t],C[j+t][t])));\n\t\t\t\tinc(G[2][i+1][j+t],mul(G[2][i][j],mul(F[2][lim][t],C[j+t][t])));\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=P;++i) inv[i]=ksm_P(i,P-2,P);\n}\nint ans=0;\nstruct node\n{\n\tint c0,c1,c2;\n\tbool operator <(node rhs) const\n\t{\n\t\treturn c0==rhs.c0?c1==rhs.c1?c2<rhs.c2:c1<rhs.c1:c0<rhs.c0;\n\t}\n};\nint dp[3][505],las[505];\nvoid MergeDp(int id,int cc)\n{\n\tint vF=cc%lim,vG=cc/lim;\n\tfor(int i=0;i<=n;++i)\n\t\tfor(int j=0;j+i<=n;++j)\n\t\t\tinc(dp[id][i+j],mul(G[id][vG][i],mul(F[id][vF][j],C[i+j][j])));\n}\nvoid GetLas()\n{\n\tint tmp[505]={0};\n\tmemset(las,0,sizeof(las));\n\tfor(int i=0;i<=n;++i)\n\t\tfor(int j=0;j+i<=n;++j)\n\t\t\tinc(las[i+j],mul(dp[0][i],mul(dp[1][j],C[i+j][j])));\n\tmemcpy(tmp,las,sizeof(tmp));\n\tmemset(las,0,sizeof(las));\n\tfor(int i=0;i<=n;++i)\n\t\tfor(int j=0;j+i<=n;++j)\n\t\t\tinc(las[i+j],mul(tmp[i],mul(dp[2][j],C[i+j][j])));\n\tmemcpy(tmp,las,sizeof(tmp));\n\tmemset(las,0,sizeof(las));\n\tfor(int i=0;i<=n;++i)\n\t\tfor(int j=0;j+i<=n;++j)\n\t\t\tinc(las[i+j],mul(tmp[i],mul(pw[j],C[i+j][j])));\n}\nmap<node,int> mem;\nvoid Solve(int x)\n{\n\tif(!x) return (void)inc(ans,add(ksm(R,n),mod-ksm(R-(R/P),n)));\t\n\tint t0=0,t1=0,t2=0,vis[5005]={0};\n\tfor(int i=1,j,cc;i<P;++i)\n\t{\n\t\tj=1ll*x*inv[i]%P;\n\t\tif(vis[i]||vis[j]) continue;\n\t\tvis[i]=vis[j]=1;\n\t\tif(i==j) continue;\n\t\tcc=((R-i)/P+(R>=i)==R/P)+((R-j)/P+(R>=j)==R/P);\n\t\tif(cc==2) t0++;\n\t\telse if(cc==1) t1++;\n\t\telse t2++;\n\t}\n\tif(mem[(node){t0,t1,t2}])\n\t\treturn (void)(inc(ans,add(ksm(R,n),mod-mem[(node){t0,t1,t2}])));\n\tmemset(dp,0,sizeof(dp));\n\tMergeDp(0,t0),MergeDp(1,t1),MergeDp(2,t2),GetLas();\n\tinc(ans,add(ksm(R,n),mod-(mem[(node){t0,t1,t2}]=las[n])));\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&P,&R),Pre();\n\tfor(int x=0;x<P;x++)\n\t\tSolve(x);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1553398457,
        "uid": 20815,
        "name": "PhantasmDragon",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4935 \u3010\u53e3\u888b\u91cc\u7684\u7eb8\u98de\u673a\u3011"
    }
]