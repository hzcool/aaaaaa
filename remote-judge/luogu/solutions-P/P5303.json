[
    {
        "content": "\u4ee4$f_i$\u8868\u793a$N=i$\u65f6\u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u6700\u53f3\u4fa7\u591a\u51fa\u4e86\u4e00\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u653e\u4e00\u4e2a$1\\times 2$\u7684\u65b9\u5757\uff0c\u4e5f\u53ef\u4ee5\u6a2a\u7740\u653e\u4e24\u4e2a$1\\times 2$\u7684\u65b9\u5757\u8986\u76d6$2\\times 2$\u7684\u533a\u57df\u3002\n\n\u8fd9\u662f\u6700\u53f3\u8fb9\u4e0d\u653e$1\\times 1$\u7684\u65b9\u5757\u7684\u60c5\u51b5\u3002\n\n\u8003\u8651\u6700\u53f3\u4fa7\u653e\u4e86$1\\times 1$\u7684\u65b9\u5757\u3002\n\n\u53d1\u73b0\u53e6\u4e00\u4e2a\u8fd9\u4e2a\u65b9\u5757\u80fd\u653e\u5728$1\\sim i-2$\u5217\u4e0a\uff0c\u4e14\u6bcf\u5217\u6070\u53ea\u6709\u4e00\u4e2a\u4f4d\u7f6e\u53ef\u884c\uff08\u540c\u884c\u8fd8\u662f\u5f02\u884c\u4e0e\u5217\u6570\u5dee\u7684\u5947\u5076\u6027\u6709\u5173\uff09\u3002\n\n\u7136\u540e\u8fd9\u4e2a$1\\times 1$\u7684\u65b9\u5757\u5de6\u8fb9\u7684\u533a\u57df\u53ef\u4ee5\u4efb\u610f\u6446\u653e\uff0c\u53f3\u8fb9\u7684\u533a\u57df\u53ea\u6709\u4e00\u79cd\u65b9\u6848\u3002\n\n\u8bbe$g_i$\u8868\u793a$2\\times i$\u7684\u533a\u57df\u53ea\u7528$1\\times 2$\u7684\u65b9\u5757\u8986\u76d6\u7684\u65b9\u6848\u6570\uff0c$h_i$\u8868\u793a$g_i$\u7684\u524d\u7f00\u548c\uff08\u7279\u522b\u5730\uff0c$g_0$=1\\\\\uff09\u3002\n\n\u90a3\u4e48\u6709$f_i=f_{i-1}+f_{i-2}+2h_{i-3}$\u3002\n\n\u53d1\u73b0$g$\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u800c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u524d\u7f00\u548c\u6ee1\u8db3$h_i=g_{i+2}-1$\u3002\n\n\u6240\u4ee5$f_i=f_{i-1}+f_{i-2}+2g_{i-1}-2$\u3002\n\n\u7528\u77e9\u9635\u5feb\u901f\u5e42\u7ef4\u62a4\u5373\u53ef\u3002\u9700\u8981\u7ef4\u62a4$5\\times 5$\u7684\u77e9\u9635\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(125T\\log n)$\u3002\n\n## Code\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\nconst int md=1e9+7;\ntypedef long long LL;\nstruct mat{\n    int a[5][5];\n    inline mat(){memset(a,0,sizeof a);}\n    inline mat operator*(const mat&b)const{\n        mat c;\n        for(int i=0;i<5;++i)\n            for(int k=0;k<5;++k)\n                for(int j=0;j<5;++j)\n                    c.a[i][j]=(c.a[i][j]+(LL)a[i][k]*b.a[k][j])%md;\n        return c;\n    }\n}s;\nmat pow(mat a,int b){\n    mat ret;\n    ret.a[0][0]=ret.a[1][1]=ret.a[2][2]=ret.a[3][3]=ret.a[4][4]=1;\n    for(;b;b>>=1,a=a*a)\n        if(b&1)ret=ret*a;\n    return ret;\n}\nint main(){\n    s.a[0][1]=s.a[1][0]=s.a[1][1]=s.a[2][3]=s.a[3][2]=s.a[3][3]=s.a[4][4]=1;\n    s.a[3][1]=2,s.a[4][1]=md-1;\n    int T;\n    for(scanf(\"%d\",&T);T--;){\n        int n;\n        scanf(\"%d\",&n);\n        if(n<3)\n            puts(\"0\");\n        else{\n            mat ans;\n            ans.a[0][2]=1,ans.a[0][3]=ans.a[0][4]=2;\n            printf(\"%d\\n\",(ans*pow(s,n-2)).a[0][1]);\n        }\n    }\n    return 0;\n\n}\n```",
        "postTime": 1555475521,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "\u63a8\u5f0f\u5b50\u9898\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u8003\u8651\u7b97\u51fa\u4e0d\u5305\u542b $1\\times 1$ \u7684\u5757\u7684\u7b54\u6848\u3002\n\n\u56e0\u4e3a\u6bcf\u4e2a $1\\times 2$ \u7684\u5757\u8981\u4e48\u6a2a\u7740\u653e\uff0c\u8981\u4e48\u4e24\u4e2a\u4e00\u8d77\u7ad6\u7740\u653e\uff0c\u56e0\u6b64\u5b58\u5728\u5173\u7cfb\u5f0f $F_n=F_{n-1}+F_{n-2}$ \uff0c\u5c31\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u7136\u540e\u8003\u8651\u5305\u542b $1\\times 1$ \u7684\u5757\u7684\u7b54\u6848\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e24\u4e2a\u5757\u653e\u5b8c\u540e\uff0c\u4e2d\u95f4\u7684\u5757\u5c31\u6700\u591a\u53ea\u6709 $1$ \u79cd\u653e\u6cd5\u3002\u800c\u8fd9\u4e24\u4e2a\u5757\u7684\u6574\u4f53\u6700\u5c0f\u662f $2\\times 3$ \u7684\u5757\u3002\u518d\u7b97\u4e0a\u4e24\u4e2a\u5757\u4e0a\u4e0b\u6446\u653e\uff0c\u4e24\u4e2a\u5757\u6784\u6210 $2\\times n(n\\ge 3)$ \u5927\u5c0f\u7684\u65b9\u6848\u6570\u90fd\u662f $2$ \u3002\u56e0\u6b64\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u5f0f\u5b50:\n\n$$ans=2\\sum_{i=3}^n\\sum_{j=0}^{n-i} F_j*F_{n-i-j}$$\n\n\u63a8\u4e00\u4e0b:\n\n$$ans=2\\sum_{i=3}^n\\sum_{j=0}^{n-i} F_j*F_{n-i-j}$$\n\n$$=2\\sum_{i=0}^{n-3} F_i\\sum_{j=0}^{n-3-i} F_j$$\n\n$$=2\\sum_{i=0}^{n-3}F_i*(F_{n-1-i}-1)$$\n\n$$=2-2F_{n-1}+2\\sum_{i=0}^{n-3}F_i*F_{n-1-i}$$\n\n\u6211\u4eec\u8bbe $S_n=\\sum_{i=0}^n F_i*F_{n-i}$ \uff0c\u5219:\n\n\u7b54\u6848\u5c31\u662f $2-2F_{n-1}+2(S_{n-1}-F_{n-2}*F_1-F_{n-1}*F_{0})$ \uff0c\u5373 $2(1+S_{n-1}-2F_{n-1}-F_{n-2})$ \u3002\n\n$$S_n=\\sum_{i=0}^n F_i*F_{n-i}$$\n\n$$=F_n+F_{n-1}+\\sum_{i=0}^{n-2} F_i*(F_{n-i-1}+F_{n-i-2})$$\n$$=F_n+F_{n-1}+\\sum_{i=0}^{n-2}F_i*F_{n-1-i}+\\sum_{i=0}^{n-2} F_i*F_{n-2-i}$$\n$$=F_n+\\sum_{i=0}^{n-1}F_i*F_{n-1-i}+\\sum_{i=0}^{n-2} F_i*F_{n-2-i}$$\n$$=F_n+S_{n-1}+S_{n-2}$$\n\n\u8003\u8651\u5229\u7528\u77e9\u9635\u5feb\u901f\u5e42\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u53ef\u4ee5\u5217\u51fa\u8f6c\u79fb\u77e9\u9635:\n\n$$\\begin{bmatrix}F_{n-2}\\\\F_{n-1}\\\\S_{n-2}\\\\S_{n-1}\\end{bmatrix}\\begin{bmatrix}0&1&0&0\\\\1&1&0&0\\\\0&0&0&1\\\\1&1&1&1\\end{bmatrix}=\\begin{bmatrix}F_{n-1}\\\\F_n\\\\S_{n-1}\\\\S_n\\end{bmatrix}$$\n\n\u5982\u679c\u9884\u5904\u7406\u51fa $2^k$ \u7684\u77e9\u9635\uff0c\u603b\u590d\u6742\u5ea6\u4e3a $O(64\\log W+\\sum 16\\log n)$ \u3002\n\n\u4ee3\u7801:\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cctype>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cassert>\n#include<queue>\n#include<iostream>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mx(a,b) (a>b?a:b)\n#define mn(a,b) (a<b?a:b)\ntypedef unsigned long long uint64;\ntypedef unsigned int uint32;\ntypedef long long ll;\nusing namespace std;\n\nnamespace IO\n{\n\tconst uint32 Buffsize=1<<15,Output=1<<24;\n\tstatic char Ch[Buffsize],*S=Ch,*T=Ch;\n\tinline char getc()\n\t{\n\t\treturn((S==T)&&(T=(S=Ch)+fread(Ch,1,Buffsize,stdin),S==T)?0:*S++);\n\t}\n\tstatic char Out[Output],*nowps=Out;\n\t\n\tinline void flush(){fwrite(Out,1,nowps-Out,stdout);nowps=Out;}\n\n\ttemplate<typename T>inline void read(T&x)\n\t{\n\t\tx=0;static char ch;T f=1;\n\t\tfor(ch=getc();!isdigit(ch);ch=getc())if(ch=='-')f=-1;\n\t\tfor(;isdigit(ch);ch=getc())x=x*10+(ch^48);\n\t\tx*=f;\n\t}\n\n\ttemplate<typename T>inline void write(T x,char ch='\\n')\n\t{\n\t\tif(!x)*nowps++='0';\n\t\tif(x<0)*nowps++='-',x=-x;\n\t\tstatic uint32 sta[111],tp;\n\t\tfor(tp=0;x;x/=10)sta[++tp]=x%10;\n\t\tfor(;tp;*nowps++=sta[tp--]^48);\n\t\t*nowps++=ch;\n\t}\n}\nusing namespace IO;\n\nvoid file()\n{\n#ifndef ONLINE_JUDGE\n\tFILE*DSD=freopen(\"water.in\",\"r\",stdin);\n\tFILE*CSC=freopen(\"water.out\",\"w\",stdout);\n#endif\n}\n\nconst int mod=1e9+7;\n\nstatic struct matrix\n{\n\tint c[4][4];\n\n\tmatrix operator*(const matrix&a)const\n\t{\n\t\tmatrix x;\n\t\tRep(i,0,3)Rep(j,0,3)\n\t\t\tx.c[i][j]=((ll)c[i][0]*a.c[0][j]+(ll)c[i][1]*a.c[1][j]+\n\t\t\t\t(ll)c[i][2]*a.c[2][j]+(ll)c[i][3]*a.c[3][j])%mod;\n\t\treturn x;\n\t}\n}bs[35];\n\nstatic int n;\n\ninline void init(){read(n);}\n\nstatic int vec[4],as[4];\n\ninline void solve()\n{\n\tif(n<=3){write(n==3?2:0);return;}\n\tn-=2;\n\tvec[0]=vec[1]=vec[2]=1,vec[3]=2;\n\tRep(i,0,30)if(n>>i&1)\n\t{\n\t\tRep(j,0,3)\n\t\tas[j]=((ll)vec[0]*bs[i].c[j][0]+(ll)vec[1]*bs[i].c[j][1]\n\t\t+(ll)vec[2]*bs[i].c[j][2]+(ll)vec[3]*bs[i].c[j][3])%mod;\n\t\tRep(j,0,3)vec[j]=as[j];\n\t}\n\twrite((((vec[3]-vec[0]-2ll*vec[1]+mod+mod+mod)%mod<<1)%mod+2)%mod);\n}\n\nint main()\n{\n\tfile();\n\tbs[0].c[0][1]=bs[0].c[1][0]=bs[0].c[1][1]=bs[0].c[2][3]=bs[0].c[3][0]=bs[0].c[3][1]=bs[0].c[3][2]=bs[0].c[3][3]=1;\n\tRep(i,1,30)bs[i]=bs[i-1]*bs[i-1];\n\tstatic int _;\n\tread(_);\n\twhile(_--)init(),solve();\n\tflush();\n\treturn 0;\n}\n```",
        "postTime": 1555418424,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "\u597d\u7684\u8ba1\u6570\u539f\u7406\u4e0e\u77e9\u9635\u5feb\u901f\u5e42\u7ec3\u4e60\u9898\u3002\n\n\u5f3a\u8c03\u9012\u63a8\u5f0f\u7684\u9002\u7528\u8303\u56f4\uff0c\u5feb\u901f\u63a8\u5f0f\u5b50\u3002\n\n---\n\n\u624b\u73a9\u53ef\u4ee5\u5f97\u5230\uff0c\u82e5\u786e\u5b9a\u7b2c\u4e00\u4e2a $1\\times 1$ \u7684\u4f4d\u7f6e\u4e0e\u4e24\u4e2a $1\\times 1$ \u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u8fd9\u90e8\u5206\u8d21\u732e\u4e3a $2$\uff08\u7ffb\u8f6c\u540e\u4e5f\u7b97\u4e00\u79cd\uff09\u3002\u800c\u8003\u8651\u8fd9\u90e8\u5206\u4ee5\u5916\u7684\u8d21\u732e\uff0c\u5373\u6b63\u5e38\u94fa\u6ee1\u7684\u8ba1\u6570\u3002\n\n\u8bb0 $f_i$ \u4e3a\u957f\u5ea6\u662f $2\\times i$ \u7684\u8def\u94fa\u6ee1\u7684\u65b9\u6848\u6570\uff0c\u53ef\u4ee5\u5728 $2\\times (i-1)$ \u7684\u57fa\u7840\u4e0a\u653e\u4e00\u4e2a\u7ad6\u7740\u7684\uff0c\u4e5f\u53ef\u4ee5\u5728 $2\\times(i-2)$ \u7684\u57fa\u7840\u4e0a\u653e\u4e24\u4e2a\u6a2a\u7740\u7684\uff0c\u5219\u6709 $f_i=f_{i-1}+f_{i-2},(i\\ge 2)$\uff0c\u521d\u59cb\u503c\u4e3a $f_0=1,f_1=1$\uff08\u6216\u8005\u53ef\u4ee5\u8ba4\u4e3a\u662f $f_1=1,f_2=2$\uff09\uff0c\u8fd9\u662f\u4e00\u4e2a\u4ece $0$ \u5f00\u59cb\u7684\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u5148\u679a\u4e3e\u4e24\u4e2a $1\\times 1$ \u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u518d\u679a\u4e3e\u7b2c\u4e00\u4e2a $1\\times 1$ \u7684\u4f4d\u7f6e\uff0c\u5219\u6709\uff08\u5206\u79bb\u5e38\u9879\uff0c\u63d0\u53d6\u516c\u56e0\u5f0f\uff0c\u5c06\u590d\u6742\u7684\u5f0f\u5b50\u53d8\u7b80\u5355\uff09\uff1a\n$$\n\\begin{aligned}\n\nans&=\\sum_{i=3}^n\\sum_{j=1}^{n-i+1}f_{j-1}\\times 2\\times f_{n-j-i+1}\\\\\n&=2\\sum_{i=0}^{n-3}\\sum_{j=0}^{n-i-3}f_jf_{n-j-i-3}\\\\\n&=2\\sum_{i=0}^{n-3}f_i\\sum_{j=0}^{n-3-i}f_j\n\n\\end{aligned}\n$$\n\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6709\u524d\u7f00\u548c\u516c\u5f0f\uff0c\u6b64\u5904\u4ece $0$ \u5f00\u59cb\uff0c$\\sum\\limits_{i=0}^{n}f_i=f_{n+2}-1$\n\n\u8bc1\u660e\u5982\u4e0b\uff08\u540c\u6837\u662f\u4ece $0$ \u5f00\u59cb\uff09\uff1a\n\n\u5206\u79bb\u5947\u5076\u9879\uff0c\u4e0d\u59a8\u8bbe $n$ \u4e3a\u5947\u6570\uff0c\u5076\u6570\u4e5f\u5dee\u4e0d\u591a\u3002\n$$\n\\begin{aligned}\nf_0+f_1+\\cdots+f_{n-1}+f_n&=(f_0+f_2+f_4+\\cdots+f_{n-1})+(f_1+f_3+f_5+\\cdots +f_n)\\\\\n\n&=(f_1+f_2+f_4+\\cdots+f_{n-1})+(f_0+f_1+f_3+f_5+\\cdots +f_n)-f_0\\\\\n\n&=(f_3+f_4+\\cdots+f_{n-1})+(f_2+f_3+f_5+\\cdots +f_n)-f_0\\\\\n\n&=(f_5+\\cdots+f_{n-1})+(f_4+f_5+\\cdots +f_n)-f_0\\\\\n\n&=f_{n}+f_{n+1}-1\\\\\n\n&=f_{n+2}-1\n\n\\end{aligned}\n$$\n\u7531\u6b64\u53ef\u5f97\uff1a\n$$\n\\begin{aligned}\n\n2\\sum_{i=0}^{n-3}f_i\\sum_{j=0}^{n-3-i}f_j&=2\\sum_{i=0}^{n-3}f_i(f_{n-1-i}-1)\\\\\n\n&=2\\Bigg(\\sum_{i=0}^{n-3}f_if_{n-1-i}-\\sum_{i=0}^{n-3}f_i\\Bigg)\\\\\n\n&=2\\Bigg(\\sum_{i=0}^{n-3}f_if_{n-1-i}-f_{n-1}+1\\Bigg)\\\\\n\n\\end{aligned}\n$$\n\u5982\u4f55\u5feb\u901f\u6c42\u4e58\u79ef\u548c\u90a3\u4e00\u9879\uff0c\u8bb0 $S_{n}=\\sum\\limits_{i=0}^{n}f_if_{n-i}$\uff0c\u89c2\u5bdf\u5230\u6709 $f_{(n-1)-i}$\uff0c\u5219\u6709\uff1a\n$$\n\\begin{aligned}\n\nans&=2\\Bigg(\\sum_{i=0}^{n-3}f_if_{n-1-i}-f_{n-1}+1\\Bigg)\\\\\n\n&=2\\Bigg(S_{n-1}-(f_{n-1}+f_{n-2})-f_{n-1}+1\\Bigg)\\\\\n\n&=2\\Bigg(S_{n-1}-2f_{n-1}-f_{n-2}+1\\Bigg)\\\\\n\n\\end{aligned}\n$$\n\u5982\u4f55\u6c42\u51fa $S_{n}$\uff0c\u6839\u636e $n\\leq 2\\times 10^9$ \u5f88\u5feb\u53ef\u4ee5\u60f3\u5230\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u6709\u9012\u63a8\u5f0f\uff1a\n$$\n\\begin{aligned}\n\nS_n&=\\sum_{i=0}^nf_if_{n-i}\\\\\n\n&=f_n+\\sum_{i=0}^{n-1}f_i(f_{n-1-i}+f_{n-2-i})\\\\\n\n&=f_n+\\sum_{i=0}^{n-1}f_if_{n-1-i}+\\sum_{i=0}^{n-2}f_if_{n-2-\ni}\\\\\n\n&=f_n+S_{n-1}+S_{n-2},(n\\ge 2)\n\n\\end{aligned}\n$$\n\u5176\u4e2d\uff0c\u521d\u59cb\u503c $S_0=1,S_1=2$\u3002\n\n\u53ef\u5f97\u51fa\u8f6c\u79fb\u77e9\u9635\uff1a\n$$\n\\begin{gathered}\n\n\\begin{pmatrix} S_{n-1}&S_{n-2}&f_{n-1}&f_{n-2} \\end{pmatrix}\n\\times\n\n\\begin{pmatrix} 1&1&0&0\\\\1&0&0&0\\\\1&0&1&1\\\\1&0&1&0 \\end{pmatrix}\n\n=\n\n\\begin{pmatrix} S_{n}&S_{n-1}&f_{n}&f_{n-1} \\end{pmatrix}\n\n\\end{gathered}\n$$\n\u5982\u4f55\u53c8\u5feb\u53c8\u51c6\u5730\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u662f\u5173\u952e\uff0c\u9700\u8981\u6709\u4e30\u5bcc\u7684\u63a8\u5f0f\u5b50\u7ecf\u9a8c\u4ee5\u53ca\u5316\u7b80\u7684\u80fd\u529b\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\ninline int read(){\n\tint x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c<='9'&&c>='0'){\n\t\tx=(x<<1)+(x<<3)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\n\nvoid print(int x){\n\tif(x<0)putchar('-'),x=-x;\n\tif(x>9)print(x/10);\n\tputchar(x%10^48);\n}\n\nconst int mod=1e9+7;\nstruct Matrix{\n\tint n,m,f[5][5];\n\tMatrix(){\n\t\tmemset(f,0,sizeof(f));\n\t}\n}base,tmp;\n\nMatrix mul(Matrix a,Matrix b){\n\tMatrix ans;\n\tans.n=a.n,ans.m=b.m;\n\tfor(int i=1;i<=a.n;++i){\n\t\tfor(int j=1;j<=b.m;++j){\n\t\t\tfor(int k=1;k<=a.m;++k){\n\t\t\t\tans.f[i][j]=(ans.f[i][j]+a.f[i][k]*b.f[k][j]%mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn ans;\n}\n\nMatrix qpow(Matrix a,int b){\n\tMatrix ans;\n\tans.n=ans.m=a.n;\n\tfor(int i=1;i<=ans.n;++i)ans.f[i][i]=1;\n\twhile(b){\n\t\tif(b&1)ans=mul(ans,a);\n\t\ta=mul(a,a);\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\n \nvoid solve(){\n\tint n=read();\n\tif(n==1||n==2){puts(\"0\");return;}\n\tbase.n=base.m=4;\n\tbase.f[1][1]=base.f[2][1]=base.f[3][1]=base.f[4][1]=base.f[1][2]=base.f[3][3]=base.f[4][3]=base.f[3][4]=1;\n\ttmp.n=1,tmp.m=4;\n\ttmp.f[1][1]=2,tmp.f[1][2]=tmp.f[1][3]=tmp.f[1][4]=1;\n\ttmp=mul(tmp,qpow(base,n-2));\n\tprint((2*(tmp.f[1][1]-2*tmp.f[1][3]%mod-tmp.f[1][4]+1ll)%mod+mod)%mod),puts(\"\");\n}\n\nsigned main(){\n\tint tt=read();\n\twhile(tt--)solve();\t\n\treturn 0;\n}\n```\n\n\u5982\u679c\u6709\u5e2e\u52a9\u5c31\u70b9\u4e2a\u8d5e\u5427\u3002",
        "postTime": 1671507866,
        "uid": 271736,
        "name": "Daidly",
        "ccfLevel": 6,
        "title": "P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7 \u9898\u89e3"
    },
    {
        "content": "\u53ef\u4ee5\u5148\u53bb\u8003\u8651\u6ca1\u6709$1 \\times 1$\u7684\u7816\u5757\u7684\u60c5\u51b5\uff0c\u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u4e2a\u662f\u7ad6\u7740\u7528\u4e00\u5757\u7816\u94fa\u8bbe$2 \\times 1$\uff0c\u53e6\u4e00\u4e2a\u4e3a\u6a2a\u7740\u7528\u4e24\u5757\u7816\u94fa\u8bbe$2 \\times 2$\u3002\n\n\u8bbe\u6ca1\u6709$1 \\times 1$\u7684\u7816\u5757\u7684\u60c5\u51b5\u94fa$2 \\times n$\u7684\u8def\u7684\u65b9\u6848\u6570\u4e3a$F_n$\uff0c\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\u5f97$F_n=F_{n-1}+F_{n-2}$\uff0c\u53d1\u73b0\u5176\u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u7528\u540c\u6837\u7684\u65b9\u6cd5\u8003\u8651\u6709$1 \\times 1$\u7684\u7816\u5757\u7684\u60c5\u51b5\uff0c\u8bbe$f_n$\u8868\u793a\u6309\u9898\u610f\u94fa$2 \\times n$\u7684\u8def\u7684\u65b9\u6848\u6570\uff0c\u5f53\u6700\u540e\u7684\u4f4d\u7f6e\u6ca1\u6709$1 \\times 1$\u7684\u7816\u5757\u7684\u5f71\u54cd\u65f6\uff0c\u5176\u4e5f\u662f\u6709\u4e24\u79cd\u653e\u7f6e\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u8bf4$f_{i-1}$\u548c$f_{i-2}$\u5bf9$f_i$\u90fd\u6709\u8d21\u732e\u3002\n\n\u5f53\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u9700\u8981\u94fa\u8bbe\u4e3a$1 \\times 1$\u7684\u7816\u5757\u65f6\uff0c\u53ef\u4ee5\u53d1\u73b0\u8be5\u7816\u5757\u5230\u53e6\u4e00\u4e2a\u7816\u5757\u7684\u533a\u95f4\u7684\u94fa\u8bbe\u60c5\u51b5\u662f\u552f\u4e00\u7684\uff0c\u6240\u4ee5\u8fd9\u79cd\u60c5\u51b5\u51b3\u5b9a\u65b9\u6848\u6570\u7684\u662f\u8fd9\u4e24\u4e2a$1 \\times 1$\u7684\u7816\u5757\u5f62\u6210\u7684\u533a\u95f4\u4e4b\u524d\u7684$2 \\times 1$\u7816\u5757\u94fa\u8bbe\u60c5\u51b5\u3002\u56e0\u6b64\u6211\u4eec\u5f97\uff1a\n\n$$f_i=f_{i-1}+f_{i-2}+2\\sum_{j=0}^{i-3}F_j$$\n\n\u8bbe$S_i=\\sum\\limits_ {j=0}^{i}F_j$\uff0c\u5f97$f_i=f_{i-1}+f_{i-2}+2S_{i-3}$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u9012\u63a8\u6765\u6c42\u89e3\u4e86\uff0c\u4f46\u662f\u53d1\u73b0$n$\u5f88\u5927\uff0c\u6240\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u6765\u52a0\u901f\u9012\u63a8\u3002\n\n\u8bbe\u77e9\u9635$\\begin{bmatrix} f_i&f_{i-1}&F_{i-2}&F_{i-3}&S_{i-3}\\end{bmatrix}\n\\quad$\uff0c\u7ecf\u8fc7\u5206\u6790\u5f97\uff0c\u5c06\u5176\u8f6c\u79fb\u5230$\\begin{bmatrix} f_{i+1}&f_i&F_{i-1}&F_{i-2}&S_{i-2}\\end{bmatrix}\n\\quad$\u7684\u8f6c\u79fb\u77e9\u9635\u4e3a\uff1a\n\n$$\n\n\t\\begin{bmatrix} \n\t\t\n        1&1&0&0&0\\\\\n\t\t1&0&0&0&0\\\\\n\t\t2&0&1&1&1\\\\\n\t\t0&0&1&0&0\\\\\n\t\t2&0&0&0&1\\\\\n        \n    \\end{bmatrix}\n\t\\quad\n$$\n\n\u7136\u540e\u6bcf\u6b21\u8be2\u95ee\u77e9\u9635\u5feb\u901f\u5e42\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n$code:$\n\n```cpp\n#include<bits/stdc++.h>\n#define p 1000000007\nusing namespace std;\ntypedef long long ll;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nll T,n;\nstruct matrix\n{\n    ll a[6][6];\n    matrix()\n    {\n        memset(a,0,sizeof(a));\n    }\n}m,ans;\nmatrix operator *(const matrix &a,const matrix &b)\n{\n    matrix c;\n    for(int i=0;i<5;++i)\n        for(int j=0;j<5;++j)\n            for(int k=0;k<5;++k)\n                c.a[i][j]=(c.a[i][j]+a.a[i][k]*b.a[k][j]%p+p)%p;\n    return c;\n}\nmatrix qp(matrix x,ll y)\n{\n    matrix e;\n    for(int i=0;i<5;++i) e.a[i][i]=1;\n    while(y)\n    {\n        if(y&1) e=e*x;\n        x=x*x,y>>=1;\n    }\n    return e;\n}\nll m1[6][6]=\n{\n    {2,0,1,1,1}\n};\nll m2[6][6]=\n{\n    {1,1,0,0,0},\n    {1,0,0,0,0},\n    {2,0,1,1,1},\n    {0,0,1,0,0},\n    {2,0,0,0,1}\n};\nint main()\n{\n    read(T);\n    memcpy(ans.a,m1,sizeof(ans.a));\n    memcpy(m.a,m2,sizeof(m.a));\n    while(T--)\n    {\n        read(n);\n        if(n<3) puts(\"0\");\n        else printf(\"%lld\\n\",(ans*qp(m,n-3)).a[0][0]);\n    }\n    return 0;\n}\n```",
        "postTime": 1590849372,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "\u9677\u5165\u4e86\u6570\u6570\u9898\u7684\u6df1\u6e0a\n\n\u9898\u610f\uff1a\u7ed9\u4f60 $2$ \u4e2a $1\\times1$ \u677f\uff0c$n-1$ \u4e2a $1\\times2$ \u677f\uff0c\u94fa\u6210\u4e00\u6761 $2\\times n$ \u7684\u8def\uff0c\u4e24\u4e2a $1\\times1$ \u677f\u4e0d\u80fd\u76f8\u90bb\uff0c\u6c42\u51fa\u94fa\u6cd5\u6570\u91cf $\\bmod\\ 10^9+7$\u3002\u591a\u6d4b\uff0c$T\\le500,n\\le 2\\times10^9$\u3002\n\n\u5f15\u7406\uff1a$n$ \u4e2a $1\\times2$ \u7684\u677f\uff0c\u94fa\u6210 $2\\times n$ \u7684\u8def\uff0c\u6709 $Fib_n$ \u79cd\u94fa\u6cd5\u3002\n\n\u8bc1\u660e\uff1a\u4f60\u8003\u8651\u7528\u4efb\u610f\u591a\u4e2a $1\\times1$ \u677f\u548c $1\\times2$ \u677f\u94fa\u51fa\u7b2c\u4e00\u884c\uff0c\u90a3\u4e48\u4e0b\u9762\u5fc5\u7136\u662f\u5bf9\u5e94\u7684\u3002\u7136\u540e\u94fa\u7b2c\u4e00\u884c\u5c31\u6709\u4e00\u4e2a\u663e\u7136\u7684 $dp$\uff0c$f_i=f_{i-1}+f_{i-2}$\u3002\n\n\u7136\u540e\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u679a\u4e3e\u4e24\u4e2a $1\\times1$ \u677f\u51fa\u73b0\u7684\u5730\u65b9\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a $1\\times1$ \u677f\u5305\u542b\u4f4f\u7684\u533a\u95f4**\u5df2\u7ecf\u56fa\u5b9a\u4e86**\uff01\u6839\u636e\u9ed1\u767d\u67d3\u8272\uff0c\u4ec5\u6709\u4e24\u79cd\u662f\u5408\u6cd5\u7684\u653e\u7f6e\uff0c\u4e8e\u662f\u67ff\u5b50\u5c31\u662f\uff1a\n\n\u8fd9\u91cc\u6302\u4e00\u4e2a\u6211\u63a8\u5230\u4e00\u534a\u7684\u67ff\u5b50\n\n$$2\\sum_{len=3}^n\\sum_{l=1}^{n-len+1}Fib_{l-1}Fib_{n-(l-1)-len}$$\n\n$$2\\sum_{len=3}^n\\sum_{l=0}^{n-len}Fib_{l}Fib_{n-l-len}$$\n\n\u6211\u8d85\uff0c\u5377\u79ef\uff01\n\n\u4f60\u8bbe\u4e00\u4e2a\u725b\u903c\u7684\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u5373 $\\texttt{Myee}$ \u6570\u5217\uff1a${Myee}_n=\\sum_{i=0}^nFib_iFib_{n-i}$\u3002\n\n\u90a3\u4e48 $\\texttt{Myee}$ \u6570\u5217\u7684\u751f\u6210\u51fd\u6570\u4e3a $(\\dfrac{x}{1-x-x^2})^2$\n\n\u7136\u540e\u8fd9\u73a9\u610f\u513f\u524d\u7f00\u548c\u5c31\u662f\u4e58\u4e0a\u4e00\u4e2a $1+x+x^2+\\ldots$ \u5373 $(1-x)^{-1}$\uff0c\u524d\u7f00\u548c\u7684\u751f\u6210\u51fd\u6570\u5c31\u662f\n\n$$\\frac{x^2}{(1-x-x^2)^2(1-x)}$$\n\n\u8bbe\u901a\u9879\u4e3a $F_n=A+(Bn+C)(\\dfrac{1+\\sqrt5}2)^n+(Dn+E)(\\dfrac{1-\\sqrt5}2)^n$\n\n\u5199\u4e2a\u591a\u9879\u5f0f\u677f\u5b50\u8dd1\u51fa\u524d\u51e0\u9879\uff0c\n\n```\nG=(1+sqrt(5))/2,\nH=(1-sqrt(5))/2,\nA+C+E=0,\nA+(B*1+C)*G^1+(D*1+E)*H^1=0,\nA+(B*2+C)*G^2+(D*2+E)*H^2=0,\nA+(B*3+C)*G^3+(D*3+E)*H^3=2,\nA+(B*4+C)*G^4+(D*4+E)*H^4=6\n```\n\u653e\u5230\u6570\u5b57\u5e1d\u56fd\u4e0a\u4e00\u8dd1\n$$A = 2,B = \\frac{\\sqrt5+1}5,C = -\\frac{11\\sqrt5+25}{25},D = \\frac{-\\sqrt5+1}5,E = \\frac{11\\sqrt5-25}{25}$$\n\n\u725b\u4e86\uff0c\u5199\u5c31\u884c\u4e86\u3002\n\n```cpp\n#define maxn 100010\nconst int p=1e9+7;\ntemplate<class _Tp,class _tp>void add(_Tp&x,const _tp& y){((x+=y)>=p)&&(x-=p);}template<class _Tp,class _tp>_Tp Add(_Tp x,const _tp y){add(x,y);return x;}\ntemplate<class _Tp,class _tp>void sub(_Tp&x,const _tp&y){((x-=y)<0)&&(x+=p);}template<class _Tp,class _tp>_Tp Sub(_Tp x,const _tp y){sub(x,y);return x;}\ntemplate<class _Tp,class _tp>void mul(_Tp&x,const _tp&y){x=1ll*x*y%p;}template<class _Tp,class _tp>_Tp Mul(const _Tp x,const _tp y){return 1ll*x*y%p;}\ntemplate<class _Tp,class _tp>_Tp ksm(_Tp a,_tp b){_Tp ans(1);for(;b;b>>=1,mul(a,a))if(b&1)mul(ans,a);return ans;} \ntemplate<class _Tp>_Tp div2(_Tp a){if(a&1)a+=p;return a>>1;}\nconst int inv5=ksm(5,p-2);\nconst int inv2=(p+1)>>1;\nstruct Cp{\n\tint a,b;\n\tCp(int A=0,int B=0):a(A),b(B){}\n\tinline Cp operator+(Cp x)const{return Cp(Add(a,x.a),Add(b,x.b));}\n\tinline Cp operator-(Cp x)const{return Cp(Sub(a,x.a),Sub(b,x.b));}\n\tinline Cp operator*(Cp x)const{return Cp(Add(Mul(a,x.a),Mul(5,Mul(b,x.b))),Add(Mul(a,x.b),Mul(b,x.a)));}\n\tinline Cp operator~()const{return Cp(a,p-b);}\n}A(2,0),B(inv5,inv5),C(p-1,Mul(p-11,Mul(inv5,inv5))),D(inv5,p-inv5),E(p-1,Mul(11,Mul(inv5,inv5))),G(inv2,inv2),H(inv2,p-inv2);\nCp ksm(Cp a,int b){\n\tCp ans(1,0);\n\tfor(;b;b>>=1,a=a*a)\n\tif(b&1)ans=ans*a;\n\treturn ans;\n}\nint n,T;\nsigned main(){\n\tfor(cin>>T;T;T--){\n\t\tcin>>n;\n\t\tCp ans=A+(B*Cp(n,0)+C)*ksm(G,n)+(D*Cp(n,0)+E)*ksm(H,n);\n\t\tcout<<ans.a<<endl;\n\t}\n}\n```\n\u8bf4\u53e5\u95f2\u8bdd\uff0c\u6211\u4e4b\u524d\u76f4\u63a5\u628a $\\dfrac{1+\\sqrt5}2$ \u5e26\u5165\u6570\u5b57\u5e1d\u56fd\uff0c\u7ed3\u679c\u592a\u957f\u4e86\uff01\u4e8e\u662f\u6211\u53ea\u80fd\u7528\u5b57\u6bcd\u8868\u793a\u6570\u3002",
        "postTime": 1635918756,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7 \u8bb0\u5f55"
    },
    {
        "content": "\u5927\u4f6c\u4eec\u7684\u505a\u6cd5\u90fd\u592a\u795e\u5566\uff0c\u6211\u8fd9\u4e2a\u83dc\u9e21\u53ea\u4f1a\u66b4\u529b dp\u3002\n\n\u9996\u5148\u6211\u4eec\u53d1\u73b0\u9898\u76ee\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u597d\u8bbe\u72b6\u6001\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u5bb9\u65a5\uff0c\u5c06\u6240\u6709\u65b9\u6848\u6570\u91cf\u51cf\u53bb\u4e0d\u5408\u6cd5\uff08\u5373\u4e24\u5757\u5355\u7816\u6328\u5728\u4e00\u8d77\u4e86\uff09\u7684\u6570\u91cf\u3002\n\n\u4e0d\u5408\u6cd5\u7684\u6570\u91cf\u662f\u591a\u5c11\u5462\uff1f\u6211\u4eec\u53d1\u73b0\u4e24\u5757\u7816\u65e2\u7136\u6328\u5728\u4e00\u8d77\u4e86\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u770b\u4f5c\u662f\u4e00\u5757\u5927\u7684\u7816\uff0c\u6240\u4ee5\u5c31\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\u4f46\u662f\u8fd9\u91cc\u7531\u4e8e\u6bcf\u4e00\u5757\u5927\u7816\u90fd\u53ef\u4ee5\u53d8\u6210\u4e24\u5757\u5c0f\u7816\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u8981\u4e58\u4e0a $n$\u3002\n\n\u5bf9\u4e8e\u6240\u6709\u65b9\u6848\u7684\u6211\u4eec\u66b4\u529b dp\u3002\u8bbe $f_{i,j,k}$ \u4e3a\u5f53\u524d\u8003\u8651\u5230\u7b2c $i$ \u884c\uff0c\u8be5\u884c\u5df2\u7ecf\u88ab\u653e\u7f6e\u4e86 $k$ \u5757\uff0c\u8fd8\u6709 $j$ \u5757\u5c0f\u7816\u6ca1\u6709\u7528\u7684\u65b9\u6848\u6570\uff0c\u5219\u4e0d\u96be\u5199\u51fa\u72b6\u6001\u8f6c\u79fb\u3002\u7136\u540e\u6211\u4eec\u53d1\u73b0 $j$ \u548c $k$ \u7684\u53d6\u503c\u662f $0$ \u5230 $2$\uff0c\u6211\u4eec\u5c06\u5176\u5408\u4e3a\u4e00\u7ef4\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u4e0a\u77e9\u4e58\u4e86\u3002\n\n\u8fd9\u4e2a\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(9^3\\log n)$\u3002~~\u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u56e0\u4e3a $9$ \u662f\u5e38\u6570\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u662f $O(\\log n)$\u3002~~\n\n\u4e0b\u9762\u662f~~\u5947\u4e11\u65e0\u6bd4\u7684~~\u4ee3\u7801\uff0c\u4f7f\u7528\u4e86 C++11 \u7684\u5199\u6cd5\u51cf\u5c11\u7801\u91cf\uff0c\u5728\u63d0\u4ea4\u540e\u6210\u529f\u62ff\u5230[\u5168\u8c37\u6700\u52a3\u89e3](https://www.luogu.com.cn/record/list?pid=P5303&orderBy=1&status=&page=13)\u3002\n```cpp\n#include<vector>\n#include<cctype>\n#include<cstdio>\nusing namespace std;\ninline int readint(){\n    int x=0;\n    bool f=0;\n    char c=getchar();\n    while(!isdigit(c)&&c!='-') c=getchar();\n    if(c=='-'){\n        f=1;\n        c=getchar();\n    }\n\twhile(isdigit(c)){\n        x=x*10+c-'0';\n        c=getchar();\n    }\n    return f?-x:x;\n}\ntypedef long long ll;\nconst ll mod=1e9+7;\ntypedef vector<ll> col;\ntypedef vector<col> matrix;\nmatrix operator *(matrix a,matrix b){\n\tint n=a.size();\n\tmatrix c;\n\tfor(int i=0;i<n;i++){\n\t\tc.push_back(col());\n\t\tfor(int j=0;j<n;j++) c[i].push_back(0);\n\t}\n\tfor(int i=0;i<n;i++) for(int j=0;j<n;j++)\n\t\tfor(int k=0;k<n;k++) c[i][j]=(c[i][j]+a[i][k]*b[k][j]%mod)%mod;\n\treturn c;\n}\nmatrix ksm(matrix a,ll b){\n\tmatrix ans;\n\tint n=a.size();\n\tfor(int i=0;i<n;i++){\n\t\tans.push_back(col());\n\t\tfor(int j=0;j<n;j++) ans[i].push_back(0);\n\t}\n\tfor(int i=0;i<n;i++) ans[i][i]=1;\n\twhile(b>0){\n\t\tif(b%2==1) ans=ans*a;\n\t\ta=a*a;\n\t\tb/=2;\n\t}\n\treturn ans;\n}\nconst matrix m1={{0,1},{1,1}},\n             m2={\n                \t{1,0,1,0,0,0,0,0,0},\n                \t{0,1,0,0,0,0,0,0,0},\n                \t{1,0,0,0,0,0,0,0,0},\n                \t{0,2,0,1,0,1,0,0,0},\n                \t{1,0,0,0,1,0,0,0,0},\n                \t{0,0,0,1,0,0,0,0,0},\n                \t{1,0,0,0,2,0,1,0,1},\n                \t{0,0,0,1,0,0,0,1,0},\n                \t{0,0,0,0,0,0,1,0,0}\n\t\t\t    };\nint main(){\n    #ifdef LOCAL\n    freopen(\"in.txt\",\"r\",stdin);\n    freopen(\"out.txt\",\"w\",stdout);\n    #endif  \n    int t=readint();\n    while(t--){\n    \tint n=readint();\n    \tll ans=ksm(m2,n)[6][0];\n    \tmatrix res=ksm(m1,n);\n    \tans=(ans+mod-(res[0][0]+res[0][1])%mod*n%mod)%mod;\n    \tprintf(\"%d\\n\",(int)ans);\n\t}\n    return 0;\n}\n```\n\u8fd9\u4e2a\u7b97\u6cd5\u5176\u5b9e\u662f\u6709\u4f18\u5316\u7684\u4f59\u5730\u7684\uff0c\u6bd4\u5982 $j=0,k=1$ \u7684\u72b6\u6001\u5c31\u5b8c\u5168\u6ca1\u6709\u5fc5\u8981\u4fdd\u7559\u3002\u4f46\u662f\u6211\u61d2\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199\u4e86\u3002",
        "postTime": 1582864944,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "**\u5982\u679c\u516c\u5f0f\u70b8\u4e86\u7684\u8bdd\uff0c\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\u53ef\u4ee5\u70b9 [\u8fd9\u91cc](https://studyingfather.com/archives/2935)\u3002**\n\n\u795e\u4ed9\u63a8\u5f0f\u5b50\u9898\uff0c\u63a8\u4e86\u5feb\u4e00\u4e0b\u5348 /kk\n\n\u5bb9\u6613\u53d1\u73b0\u6574\u4e2a\u533a\u57df\u53ef\u4ee5\u5206\u4e3a\u4e09\u90e8\u5206\uff1a\u7b2c\u4e00\u4e2a $1 \\times 1$ \u65b9\u5757\u5de6\u8fb9\uff0c\u4e24\u4e2a $1 \\times 1$ \u65b9\u5757\u4e2d\u95f4\u90e8\u5206\uff08\u81f3\u5c11 $2 \\times 3$ \u7684\u533a\u57df\uff09\uff0c\u7b2c\u4e8c\u4e2a $1 \\times 1$ \u65b9\u5757\u53f3\u8fb9\u90e8\u5206\u3002\n\n\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/3gzn31qa.png)\n\n\u5176\u4e2d\u4e24\u4e2a $1 \\times 1$ \u65b9\u5757\u662f\u540c\u884c\u8fd8\u662f\u5f02\u884c\u53d6\u51b3\u4e8e\u4e2d\u95f4\u5217\u6570\u7684\u5947\u5076\u6027\uff08\u5947\u6570\u4e3a\u5f02\u884c\uff0c\u5076\u6570\u4e3a\u540c\u884c\uff09\u3002\n\n\u5982\u679c\u4e24\u4e2a $1 \\times 1$ \u65b9\u5757\u7684\u4f4d\u7f6e\u5b9a\u4e0b\u6765\u4e86\uff0c\u4e0a\u56fe\u4e2d\u95f4\u7684\u7ea2\u8272\u533a\u57df\u5c31\u53ea\u6709\u4e00\u79cd\u6446\u6cd5\u3002\n\n\u800c\u5de6\u8fb9\u9ed1\u8272\u533a\u57df\u548c\u53f3\u8fb9\u7eff\u8272\u533a\u57df\uff0c\u663e\u7136\u5206\u522b\u6709 $F_x,F_y$ \u79cd\u6446\u6cd5\uff08$F_x$ \u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u6ee1\u8db3 $F_0=F_1=1$\uff0c$F_i=F_{i-1}+F_{i-2}$\uff09\u3002\n\n\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u7b54\u6848\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n\n$$\n2 \\sum_{x=0}^{n-3} \\sum_{y=0}^{n-x-3}F_x \\times F_y\n$$\n\n\uff08\u4e2d\u95f4\u7684\u7ea2\u8272\u533a\u57df\u8003\u8651\u4e0a\u4e0b\u884c\u4ea4\u6362\uff0c\u6240\u4ee5\u7b54\u6848\u4e58\u4e8c\uff09\n\n\u8fd0\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff1a\n\n$$\n2 \\sum_{x=0}^{n-3}F_x \\sum_{y=0}^{n-x-3}F_y\n$$\n\n\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6ee1\u8db3 $\\sum_{i=0}^x F_i=F_{x+2}-1$\uff0c\u6240\u4ee5\u628a\u540e\u9762\u7684 $\\sum F_y$ \u6362\u6389\uff1a\n\n$$\n2 \\sum_{x=0}^{n-3}F_x \\times (F_{n-x-1}-1)\n$$\n\n\u6574\u7406\u540e\u5f97\u5230\uff1a\n\n$$\n2 (\\sum_{x=0}^{n-3}F_x \\times F_{n-x-1}-F_{n-1}+1)\n$$\n\n\u73b0\u5728\u91cd\u70b9\u653e\u5230 $\\sum_{x=0}^{n-3}F_x \\times F_{n-x-1}$ \u4e0a\u3002\n\n\u6211\u4eec\u8bbe\uff1a\n\n$$\nG_n=\\sum_{x=0}^{n}F_x \\times F_{n-x}\n$$\n\n\u5c06 $x=n$ \u548c $x=n-1$ \u63d0\u51fa\u6765\uff1a\n\n$$\nG_n=\\sum_{x=0}^{n-2}F_x \\times F_{n-x} + F_n+F_{n-1}\n$$\n\n\u628a $F_{n-x}$ \u4e5f\u62c6\u5f00\uff1a\n\n$$\nG_n=\\sum_{x=0}^{n-2}F_x \\times (F_{n-x-1}+F_{n-x-2})+F_n+F_{n-1}\n$$\n\n\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff1a\n\n$$\nG_n=\\sum_{x=0}^{n-2}F_x \\times F_{n-x-1}+\\sum_{x=0}^{n-2}F_x \\times F_{n-x-2}+F_n+F_{n-1}\n$$\n\n\u628a $F_{n-1}$ \u653e\u56de\u5230\u5f0f\u5b50\u7684\u7b2c\u4e00\u5757\uff1a\n\n$$\nG_n=\\sum_{x=0}^{n-1}F_x \\times F_{n-x-1}+\\sum_{x=0}^{n-2}F_x \\times F_{n-x-2}+F_n\n$$\n\n\u5230\u8fd9\u91cc\u7ec8\u4e8e\u8c41\u7136\u5f00\u6717\u5566\u3002\n\n$$\nG_n=G_{n-1}+G_{n-2}+F_n\n$$\n\n\u628a $G_n$ \u4ee3\u5165\u5230\u7b54\u6848\u4e2d\uff0c\u53ef\u5f97\u7b54\u6848\u4e3a\uff1a\n\n$$\n2(1+G_{n-1}-2 \\times F_{n-1}-F_{n-2})\n$$\n\n\u6700\u540e\u7684\u95ee\u9898\u5c31\u662f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u6765\u9012\u63a8 $F_n,G_n$ \u4e86\u3002\n\n\u7a0d\u5fae\u63a8\u4e00\u4e0b\u5c31\u80fd\u5f97\u5230\uff1a\n\n$$\n\\begin{bmatrix}\nF_{n-1} & F_{n-2} & F_{n-3} & G_{n-1} & G_{n-2} & G_{n-3}\n\\end{bmatrix}\n\\begin{bmatrix}\n1 & 1 & 0 & 1 & 0 & 0\\\\ \n1 & 0 & 1 & 1 & 0 & 0\\\\ \n0 & 0 & 0 & 0 & 0 & 0\\\\ \n0 & 0 & 0 & 1 & 1 & 0\\\\ \n0 & 0 & 0 & 1 & 0 & 1\\\\ \n0 & 0 & 0 & 0 & 0 & 0\n\\end{bmatrix}=\n\\begin{bmatrix}\nF_n & F_{n-1} & F_{n-2} & G_n & G_{n-1} & G_{n-2}\n\\end{bmatrix}\n$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(6^3 T \\log n)$\u3002\n\n```cpp\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#define MOD 1000000007\nusing namespace std;\nstruct mat\n{\n long long a[15][15];\n mat(int x=0)\n {\n  memset(a,0,sizeof(a));\n  for(int i=1;i<=6;i++)\n   a[i][i]=x;\n }\n mat operator*(const mat&A)const\n {\n  mat ans;\n  for(int k=1;k<=6;k++)\n   for(int i=1;i<=6;i++)\n    for(int j=1;j<=6;j++)\n     ans.a[i][j]=(ans.a[i][j]+a[i][k]*A.a[k][j])%MOD;\n  return ans;\n }\n}f,g;\nvoid init()\n{\n //[f_3,f_2,f_1,g_3,g_2,g_1]\n f.a[1][1]=3,f.a[1][2]=2,f.a[1][3]=1,f.a[1][4]=10,f.a[1][5]=5,f.a[1][6]=2;\n /*\n 1 1 0 1 0 0\n 1 0 1 1 0 0\n 0 0 0 0 0 0\n 0 0 0 1 1 0\n 0 0 0 1 0 1\n 0 0 0 0 0 0\n */\n g.a[1][1]=1,g.a[1][2]=1,g.a[1][3]=0,g.a[1][4]=1,g.a[1][5]=0,g.a[1][6]=0;\n g.a[2][1]=1,g.a[2][2]=0,g.a[2][3]=1,g.a[2][4]=1,g.a[2][5]=0,g.a[2][6]=0;\n g.a[3][1]=0,g.a[3][2]=0,g.a[3][3]=0,g.a[3][4]=0,g.a[3][5]=0,g.a[3][6]=0;\n g.a[4][1]=0,g.a[4][2]=0,g.a[4][3]=0,g.a[4][4]=1,g.a[4][5]=1,g.a[4][6]=0;\n g.a[5][1]=0,g.a[5][2]=0,g.a[5][3]=0,g.a[5][4]=1,g.a[5][5]=0,g.a[5][6]=1;\n g.a[6][1]=0,g.a[6][2]=0,g.a[6][3]=0,g.a[6][4]=0,g.a[6][5]=0,g.a[6][6]=0;\n}\nmat fpow(mat x,int y)\n{\n mat ans(1);\n while(y)\n {\n  if(y&1)ans=ans*x;\n  x=x*x;\n  y>>=1;\n }\n return ans;\n}\nint main()\n{\n int t;\n cin>>t;\n init();\n while(t--)\n {\n  int n;\n  cin>>n;\n  if(n<=2)cout<<0<<endl;\n  else\n  {\n   mat res=f*fpow(g,n-3);\n   cout<<(2*(-2*res.a[1][2]-res.a[1][3]+res.a[1][5]+1)%MOD+MOD)%MOD<<endl;\n  }\n }\n return 0;\n}\n```\n",
        "postTime": 1582371958,
        "uid": 22030,
        "name": "StudyingFather",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P5303)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u9053\u9898......\u597d\u50cf\u672c\u6765\u5e94\u8be5\u5f88\u6c34\u7684\u6837\u5b50......  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u6211\u5c31\u662f\u505a\u4e0d\u6765~~  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u597d\u5427\u3002\u8fd9\u9053\u9898\u4e0d\u96be\u8ba9\u6211\u4eec\u8054\u60f3\u5230\u4e00\u4e2a\u7ecf\u5178\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u788e\u7816\u7684\u95ee\u9898\u3002\u8003\u8651\u6309\u7167\u76f8\u540c\u7684\u65b9\u6cd5\u6765\u5c1d\u8bd5\u63a8\u51fa\u8fd9\u4e2a\u95ee\u9898\u7684\u9012\u63a8\u5f0f\u5b50\uff1a    \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$f(i)$\uff1a$2\\times i$\u7684\u683c\u5b50\u94fa\u6ee1\u7684\u65b9\u6848\u6570\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e09\u79cd\u8f6c\u79fb\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$1.$\u6700\u540e\u4e00\u5217\u76f4\u63a5\u94fa\u4e00\u5757$1\\times 2$\u7684\u7816\uff1a  \n$$f(i)=f(i-1)+...$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.$\u5012\u6570\u4e24\u5217\u94fa\u4e24\u5757$1\\times 2$\u7684\u7816\uff1a  \n$$f(i)=f(i-1)+f(i-2)+...$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$3.$\u8003\u8651\u5728\u6700\u540e\u4e00\u5217\u94fa\u4e0a$1\\times 1$\u7684\u7816\u3002\u4e24\u5757\u7816\u5fc5\u987b\u540c\u65f6\u94fa\u4e0a\u624d\u53ef\u4ee5\u4fdd\u8bc1\u53ef\u4ee5\u94fa\u6ee1\u3002\u5982\u679c\u4e00\u5757$1\\times 1$\u7684\u7816\u94fa\u5728\u4e86\u6700\u540e\u4e00\u5217\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u5757\u53ea\u80fd\u94fa\u5728$1\\sim i-2$\u7684\u4f4d\u7f6e\u3002\u8bbe\u4e0d\u7528\u788e\u7816\u7684\u94fa\u6ee1\u524d$i$\u5217\u7684\u65b9\u6848\u6570\u4e3a$g(i)$\uff0c\u5219\u6709\uff1a  \n$$f(i)=f(i-1)+f(i-2)+2\\sum_{j=0}^{i-3}g(j)$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u96be\u53d1\u73b0$g$\u5c31\u662f$Fibonacci$\u6570\u5217\uff08$g(0)=1,g(1)=1$\uff09\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u770b\u5230$n$\u8fd9\u4e48\u5927\uff0c\u8f6c\u79fb\u53c8\u8fd9\u4e48\u7b80\u6d01\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u60f3\u5230\u77e9\u9635\u52a0\u901f\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe\u8ba1\u4e00\u4e2a$1\\times 5$\u7684\u521d\u59cb\u77e9\u9635\u548c$5\\times5$\u7684\u8f6c\u79fb\u77e9\u9635\uff0c\u5177\u4f53\u7ec6\u8282\u7565\u3002\u7136\u540e\u5c31\u53ef\u4ee5$O(5^3T\\log_2n)$\u4e86\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cstring>\n\nconst int mod = 1e9 + 7;\nconst int MAXN = 1e5 + 5, MAXSIZ = 10;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0; char s = getchar();int f = 1;\n\twhile( s < '0' || '9' < s ) { f = 1; if( s == '-' ) f = -1; s = getchar(); }\n\twhile( '0' <= s && s <= '9' ) { x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar(); }\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ) { putchar( '-' ), x = -x; }\n\tif( 9 < x ) { write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n   \treturn a > b ? a : b;\n}\n\ntemplate<typename _T>\n_T MIN( const _T a, const _T b )\n{\n\treturn a < b ? a : b;\n}\n\nstruct matrix\n{\n\tint mat[MAXSIZ][MAXSIZ];\n\tint n, m;\n\tmatrix(){ memset( mat, 0, sizeof mat ); }\n\tmatrix( const int N, const int M ) { n = N, m = M, memset( mat, 0, sizeof mat ); }\n\tint* operator [] ( const int indx ) { return mat[indx]; }\n\tmatrix operator * ( matrix other ) const\n\t{\n\t\tmatrix ret = matrix( n, other.m );\n\t\tfor( int i = 1 ; i <= ret.n ; i ++ )\n\t\t\tfor( int j = 1 ; j <= ret.m ; j ++ )\n\t\t\t\tfor( int k = 1 ; k <= m ; k ++ )\n\t\t\t\t\tret[i][k] = ( ret[i][k] + 1ll * mat[i][j] * other[j][k] % mod ) % mod;\n\t\treturn ret;\n\t}\n}A, B;\n\nint N;\n\nmatrix I( const int n )\n{\n\tmatrix ret = matrix( n, n );\n\tfor( int i = 1 ; i <= n ; i ++ ) ret[i][i] = 1;\n\treturn ret;\n}\n\nmatrix qkpow( matrix base, int indx )\n{\n\tmatrix ret = I( base.n );\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret = ret * base;\n\t\tbase = base * base, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nvoid init()\n{\n\tA = matrix( 1, 6 );\n\tA[1][1] = A[1][2] = 0, A[1][3] = A[1][4] = A[1][5] = 1;\n    //\u524d\u4e24\u4e2a\u4e3af(i)\u548cf(i-1)\uff0c\u7b2c\u4e09\u4e2a\u4e3a\u2211g(0~i-3)\uff0c\u540e\u4e24\u4e2a\u4e3ag(i-2)\u548cg(i-3)\n\tB = matrix( 5, 5 );\n\tB[1][1] = 1, B[1][2] = 1;\n\tB[2][1] = 1;\n\tB[3][1] = 2, B[3][3] = 1;\n\tB[4][3] = 1, B[4][4] = 1, B[4][5] = 1;\n\tB[5][4] = 1;\n}\n\nint cal( const int n )\n{\n\tif( n < 3 ) return 0;\n\tmatrix part = qkpow( B, n - 2 );\n\treturn ( A * part )[1][1];\n}\n\nint main()\n{\n\tinit();\n\tint T;\n\tread( T );\n\twhile( T -- )\n\t{\n\t\tread( N );\n\t\twrite( cal( N ) ), putchar( '\\n' );\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1576496236,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7"
    },
    {
        "content": "[P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7](https://www.luogu.com.cn/problem/P5303)\n\n## Preface\n\n\u77e9\u9635\u9898\u7684\u767b\u5cf0\u9020\u6781\u4e4b\u4f5c\u3002\n\n## Description\n\n\u6709 $T$ \u7ec4\u6570\u636e\u3002\n\n\u5bf9\u4e8e\u6bcf\u7ec4\u6570\u636e\uff0c\u7ed9\u5b9a\u6b63\u6574\u6570 $N$\uff0c\u8bf7\u6c42\u51fa\u7528 $(N-1)$ \u4e2a $2\\times 1$ \u7684\u65b9\u683c\u548c $2$ \u4e2a $1\\times 1$ \u7684\u65b9\u683c\u94fa\u6ee1 $2\\times N$ \u7684\u5927\u65b9\u683c\u7684\u65b9\u6848\u6570\uff0c**\u5176\u4e2d $2$ \u4e2a $1\\times 1$ \u7684\u65b9\u683c\u4e0d\u80fd\u6709\u76f8\u90bb\u7684\u8fb9**\u3002\n\n- \u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n- \u5bf9\u4e8e $100\\%$ \u7684\u6570\u636e\uff0c$N\\le 2\\times 10^9,T\\le 500$\u3002\n\n## Solution\n\n**\u524d\u7f6e\u829d\u58eb\uff1a**\n\n- \u4e00\u5b9a\u7684\u5c0f\u5965\u57fa\u7840\n- \u77e9\u9635\u5feb\u901f\u5e42\n\n### \u7b2c\u4e00\u90e8\u5206\uff1a\u4f55\u4e3a\u6240\u6c42\n\n\u8fd9\u4e24\u4e2a $1\\times 1$ \u4e00\u5b9a\u80fd\u6846\u51fa\u4e00\u4e2a $2\\times m$ \u7684\u957f\u65b9\u5f62\uff0c\u5176\u4e2d\u56e0\u4e3a\u4e0d\u80fd\u76f8\u90bb\uff0c\u6240\u4ee5 $m\\ge 3$\u3002\n\n\u8003\u8651\u8fd9 $2$ \u4e2a $1\\times 1$ \u7684\u6446\u653e\u4f4d\u7f6e\uff1a\u540c\u884c\u6216\u5f02\u884c\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\n\n\u5f53 $m$ \u4e3a\u5076\u6570\u65f6\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/v9if19e5.png)\n\n\u540c\u884c\u662f\u53ef\u4ee5\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u957f\u65b9\u5f62\u5185\u53ea\u6709 $1$ \u79cd\u65b9\u6cd5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/jkivdx16.png)\n\n\u5f02\u884c\u662f\u4e0d\u884c\u7684\u3002\n\n\u5f53 $m$ \u4e3a\u5947\u6570\u65f6\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/tzr5l954.png)\n\n\u5f02\u884c\u662f\u53ef\u4ee5\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u957f\u65b9\u5f62\u5185\u53ea\u6709 $1$ \u79cd\u65b9\u6cd5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/u77u4bdx.png)\n\n\u540c\u884c\u662f\u4e0d\u884c\u7684\u3002\n\n\u7efc\u4e0a\u53ef\u4ee5\u53d1\u73b0\u65e0\u8bba $m$ \u7684\u5947\u5076\u6027\uff0c\u6846\u51fa\u7684 $2\\times m$ \u6709\u4e14\u4ec5\u6709\u4e00\u79cd\u65b9\u6cd5\u3002\n\n\u662f\u5417\uff1f\n\n\u56e0\u4e3a $2$ \u4e2a\u5c0f\u6b63\u65b9\u5f62\u7684\u4f4d\u7f6e\u53ef\u4ee5\u4e0a\u4e0b\u8c03\u6362\uff0c\u6240\u4ee5\u8fd9\u4e24\u79cd\u90fd\u9700\u8981\u4e58 $2$\u3002\n\n\u518d\u8003\u8651\u5168\u90e8\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/21yyk8ro.png)\n\n\u5de6\u53f3\u4e24\u8fb9\u90fd\u662f\u5f62\u5982 $2\\times k$ \u7684\u957f\u65b9\u5f62\uff0c\u6839\u636e\u5c0f\u5b66\u5965\u6570\u53ef\u77e5\u7528 $k$ \u4e2a $2\\times 1$ \u7684\u8986\u76d6 $2\\times k(k\\in\\mathbf{N})$ \u7684\u6709 $F_k$ \u79cd\uff08\u5176\u4e2d $\\{F_k\\}$ \u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u4e0b\u6807\u4ece $0$ \u5f00\u59cb\uff09\u3002\n\n\u786e\u5b9a\u4e86\u4e24\u8fb9\u7684 $i,j$\uff0c\u4e2d\u95f4\u7684 $m$ \u5c31\u81ea\u52a8\u786e\u5b9a\u4e86\u3002\n\n\u4e2d\u95f4\u662f $2$ \u4e2a $1\\times 1$ \u7684\u6846\u51fa\u7684\u957f\u65b9\u5f62\uff0c\u6709 $2$ \u79cd\u65b9\u6cd5\uff0c\u53c8 $m\\ge 3$\uff0c\u6240\u4ee5\n$$\n\\begin{aligned}\nans\n&=2\\sum\\limits_{i=0}^{n-3}\\sum\\limits_{j=0}^{n-i-3} F_i\\cdot F_j\\\\\n&=2\\sum\\limits_{i=0}^{n-3}F_i\\sum\\limits_{j=0}^{n-i-3}F_j\n\\end{aligned}\n$$\n### \u4e8c\u3001\u63a8\u5f0f\u5b50\n\n\u6839\u636e\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u524d\u7f00\u548c $\\sum\\limits_{i=0}^n F_i=F_{n+2}-1$\uff0c\u6709\n$$\n\\begin{aligned}\nans\n&=2\\sum\\limits_{i=0}^{n-3}F_i\\sum\\limits_{j=0}^{n-i-3}F_j\\\\\n&=2\\sum\\limits_{i=0}^{n-3}F_i\\cdot (F_{n-i-1}-1)\\\\\n&=2\\sum\\limits_{i=0}^{n-3}(F_i\\cdot F_{n-i-1}-F_i)\\\\\n&=2(\\sum\\limits_{i=0}^{n-3}F_i\\cdot F_{n-i-1}-\\sum\\limits_{i=0}^{n-3}F_i)\\\\\n&=2(\\sum\\limits_{i=0}^{n-3}F_i\\cdot F_{n-i-1}-(F_{n-1}-1))\\\\\n&=2(1-F_{n-1}+\\sum\\limits_{i=0}^{n-3}F_i\\cdot F_{n-i-1})\n\\end{aligned}\n$$\n\u4ee4 $S_n=\\sum\\limits_{i=0}^n F_n\\cdot F_{n-i}$\uff0c\u5219\n$$\n\\begin{aligned}\nans\n&=2(1-F_{n-1}+\\sum\\limits_{i=0}^{n-3}F_i\\cdot F_{n-i-1})\\\\\n&=2[1-F_{n-1}+(\\sum\\limits_{i=0}^{n-1}F_i\\cdot F_{n-i-1}-F_{n-2}\\cdot F_1-F_{n-1}\\cdot F_0)]\\\\\n&=2(1+S_{n-1}-2F_{n-1}-F_{n-2})\n\\end{aligned}\n$$\n\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u6c42\u51fa $S_n$\u3002\n$$\n\\begin{aligned}\nS_n\n&=\\sum\\limits_{i=0}^n F_n\\cdot F_{n-i}\\\\\n&=F_n\\cdot F_0+F_{n-1}\\cdot F_1+\\sum\\limits_{i=0}^{n-2}F_i\\cdot F_{n-i}\\\\\n&=F_n+F_{n-1}+\\sum\\limits_{i=0}^{n-2}F_i\\cdot (F_{n-i-1}+F_{n-i-2})\\\\\n&=F_n+(F_{n-1}\\cdot F_0+\\sum\\limits_{i=0}^{n-2}F_i\\cdot F_{n-i-1})+\\sum\\limits_{i=0}^{n-2}F_i\\cdot F_{n-i-2}\\\\\n&=F_n+\\sum\\limits_{i=0}^{n-1}F_i\\cdot F_{n-i-1}+\\sum\\limits_{i=0}^{n-2}F_i\\cdot F_{n-i-2}\\\\\n&=F_{n-1}+F_{n-2}+S_{n-1}+S_{n-2}\n\\end{aligned}\n$$\n\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u89e3\u51b3\uff1a\n$$\n\\begin{cases}\nS_n&=1\\cdot S_{n-1}+1\\cdot S_{n-2}+1\\cdot F_{n-1}+1\\cdot F_{n-2}\\\\\nS_{n-1}&=1\\cdot S_{n-1}+0\\cdot S_{n-2}+0\\cdot F_{n-1}+0\\cdot F_{n-2}\\\\\nF_{n}&=0\\cdot S_{n-1}+0\\cdot S_{n-2}+1\\cdot F_{n-1}+1\\cdot F_{n-2}\\\\\nF_{n-1}&=0\\cdot S_{n-1}+0\\cdot S_{n-2}+1\\cdot F_{n-1}+0\\cdot F_{n-2}\n\\end{cases}\n$$\n\u90a3\u4e48\u77e9\u9635\u5c31\u662f\n$$\n\\begin{bmatrix}\n1 & 1 & 1 & 1\\\\\n1 & 0 & 0 & 0\\\\\n0 & 0 & 1 & 1\\\\\n0 & 0 & 1 & 0\n\\end{bmatrix}\n\\times\n\\begin{bmatrix}\nS_{n-1}\\\\\nS_{n-2}\\\\\nF_{n-1}\\\\\nF_{n-2}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nS_n\\\\\nS_{n-1}\\\\\nF_n\\\\\nF_{n-1}\n\\end{bmatrix}\n$$\n\u521d\u59cb\u503c\u4e3a\n$$\n\\begin{bmatrix}\nS_1\\\\\nS_0\\\\\nF_1\\\\\nF_0\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n2\\\\\n1\\\\\n1\\\\\n1\n\\end{bmatrix}\n$$\n$ans=2(1+S_{n-1}-2F_{n-1}-F_{n-2})$\uff0c\u6240\u4ee5\u6c42 $S_{n-1}$ \u4e58 $(n-2)$ \u6b21\u8f6c\u79fb\u77e9\u9635\u5373\u53ef\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T\\cdot 64\\log n)$\u3002**\n\n## Code\n\n```cpp\n//18 = 9 + 9 = 18.\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#define Debug(x) cout << #x << \"=\" << x << endl\n#define int long long\nusing namespace std;\n\nstruct matrix\n{\n\tint a[5][5];\n\tmatrix()\n\t{\n\t\tmemset(a, 0, sizeof(a));\n\t}\n\tvoid build()\n\t{\n\t\tfor (int i = 1; i <= 4; i++)\n\t\t{\n\t\t\ta[i][i] = 1;\n\t\t}\n\t}\n};\n\nconst int MOD = 1e9 + 7;\n\nmatrix operator *(matrix x, matrix y)\n{\n\tmatrix res;\n\tfor (int k = 1; k <= 4; k++)\n\t{\n\t\tfor (int i = 1; i <= 4; i++)\n\t\t{\n\t\t\tif (!x.a[i][k])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (int j = 1; j <= 4; j++)\n\t\t\t{\n\t\t\t\tres.a[i][j] = (res.a[i][j] + x.a[i][k] * y.a[k][j] % MOD) % MOD;\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n}\n\nmatrix qpow(matrix a, int b)\n{\n\tmatrix base = a, ans;\n\tans.build();\n\twhile (b)\n\t{\n\t\tif (b & 1)\n\t\t{\n\t\t\tans = ans * base;\n\t\t}\n\t\tbase = base * base;\n\t\tb >>= 1;\n\t}\n\treturn ans;\n}\n\nsigned main()\n{\n\tint t;\n\tscanf(\"%lld\", &t);\n\tmatrix base;\n\tbase.a[1][1] = base.a[1][2] = base.a[1][3] = base.a[1][4] = base.a[2][1] = base.a[3][3] = base.a[3][4] = base.a[4][3] = 1; //\u8f6c\u79fb\u77e9\u9635\n\tmatrix fst;\n\tfst.a[1][1] = 2, fst.a[2][1] = fst.a[3][1] = fst.a[4][1] = 1; //\u521d\u59cb\u77e9\u9635\n\twhile (t--)\n\t{\n\t\tint n;\n\t\tscanf(\"%lld\", &n);\n\t\tif (n == 1)\n\t\t{\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\tmatrix res = qpow(base, n - 2) * fst;\n\t\tint S = res.a[1][1], F1 = res.a[3][1], F2 = res.a[4][1]; //S : S_{n-1}, F1 : F_{n-1}, F2 : F_{n-2}\n\t\tprintf(\"%lld\\n\", (((1 + S - (F1 << 1) - F2) << 1) % MOD + MOD) % MOD);\n\t}\n\treturn 0;\n}\n```\n\n## Reference\n\n- [1] Great_Influence\uff1a[\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011](https://www.luogu.com.cn/blog/user7035/solution-p5303)\n- [2] StudyingFather\uff1a[[\u6d1b\u8c37 5303,loj 3086][GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7](https://studyingfather.com/archives/2935)",
        "postTime": 1640237873,
        "uid": 305532,
        "name": "mango09",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011Luogu-P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7"
    },
    {
        "content": "~~\u600e\u4e48\u8fd8\u6709\u8fd9\u4e48SB\u7684\u7701\u9009\u9898\u554a~~\n\n\u9996\u5148\u5bb9\u6613\u60f3\u5230\u679a\u4e3e\u53f3\u8fb9\u7684\u4e00\u4e2a$1\\times 1$\u7684\u5c0f\u65b9\u5757\u6240\u5728\u7684\u5217$i$\uff0c\u7136\u540e\u66b4\u679a\u5de6\u8fb9\u5c0f\u65b9\u5757\u6240\u5728\u7684\u5217$j$\u5728\u54ea\u91cc\uff0c\u7136\u540e\u6211\u4eec\u53d1\u73b0\u6240\u6709$j\\in [1,i-1)$\u7684\u5217\u90fd**\u6709\u4e14\u4ec5\u6709**\u4e00\u79cd\u9009\u62e9\uff0c\u5177\u4f53\u548c\u4e24\u8005\u7eb5\u5750\u6807\u7684\u5dee\u503c\u6709\u5173\uff0c\u753b\u4e2a\u56fe\u5c31\u77e5\u9053\u4e86\n\n\u7136\u540e\u6bcf\u4e00\u5bf9$i,j$\u7684\u8d21\u732e\u662f\u591a\u5c11\u5462\uff0c\u5f88\u7b80\u5355\uff0c\u663e\u7136\u5728$[i,j]$\u4e4b\u95f4\u7684\u5217\u53ea\u6709\u552f\u4e00\u7684\u653e\u7f6e\u65b9\u6848\uff0c\u90a3\u4e48\u8981\u4e58\u4e0a\u7684\u7cfb\u6570\u5c31\u662f\u4e24\u8fb9$2\\times (i-1)$\u548c$2\\times (n-j)$\u5927\u5c0f\u7684\u653e\u6cd5\u4e86\n\n\u6211\u4eec\u4ee4$2\\times i$\u5927\u5c0f\u7684\u653e\u7f6e\u65b9\u6848\u4e3a$f_i$\uff0c\u8003\u8651\u6bcf\u6b21\u5728\u53f3\u8fb9\u653e\uff0c\u8981\u4e48\u662f\u7ad6\u7740\u4ece$f_{i-1}$\u8f6c\u79fb\u800c\u6765\uff0c\u8981\u4e48\u662f\u6a2a\u7740\u653e\u4e24\u4e2a\u4ece$f_{i-2}$\u8f6c\u79fb\u6765\uff0c\u56e0\u6b64\u8fd9\u5c31\u662f\u4e00\u4e2a**\u6590\u6ce2\u90a3\u5951\u6570\u5217**\n\n\u7136\u540e\u8003\u8651\u524d\u9762\u90a3\u4e2a\u66b4\u529b\u7684\u601d\u8def\uff0c\u6211\u4eec\u9884\u5904\u7406\u51fa$f_i$\u548c$f_i$\u7684\u524d\u7f00\u548c$s_i$\u5373\u53ef\u62ff\u523050pts\uff08\u6ce8\u610f\u53f3\u8fb9\u7684\u6709\u4e0a\u4e0b\u4e24\u79cd\u65b9\u6cd5\u4e92\u76f8\u7b49\u4ef7\uff0c\u56e0\u6b64\u8981$\\times 2$\uff09\n\n50pts\u66b4\u529b\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#define RI register int\nusing namespace std;\nconst int N=1e5+5,mod=1e9+7;\nint t,n,ans,fib[N],sum[N];\ninline void init(void)\n{\n\tsum[0]=fib[0]=fib[1]=1; for (RI i=sum[1]=2;i<N;++i)\n\tfib[i]=(fib[i-2]+fib[i-1])%mod,sum[i]=(sum[i-1]+fib[i])%mod;\n}\nint main()\n{\n\tfor (scanf(\"%d\",&t),init();t;--t)\n\t{\n\t\tRI i; for (scanf(\"%d\",&n),ans=0,i=3;i<=n;++i)\n\t\t(ans+=2LL*sum[i-3]*fib[n-i]%mod)%=mod; printf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\n\u7136\u540e\u6211\u4eec\u518d\u7528\u7c7b\u4f3c$f_i$\u7684\u63a8\u5bfc\u65b9\u5f0f\u63a8\u5bfc\u7b54\u6848$F_i$\uff0c\u8003\u8651\u5982\u4f55\u4ece\u4e4b\u524d\u7684\u72b6\u6001\u8f6c\u79fb\u800c\u6765\n\n\u5f88\u5bb9\u6613\u7528\u4e00\u6837\u7684\u601d\u8def\u5f97\u5230\uff0c\u5982\u679c\u4e4b\u524d$i-1$\u5217\u6ca1\u6709\u653e$1\\times 1$\u7684\u5c0f\u65b9\u5757\uff0c\u90a3\u4e48$F_i$\u53ef\u4ee5\u4ece$F_{i-1}$\u548c$F_{i-2}$\u8f6c\u79fb\u6765\n\n\u5982\u679c\u653e\u4e86\u5462\uff0c\u90a3\u4e48\u5176\u5b9e\u5c31\u662f\u4e0a\u9762\u66b4\u529b\u7684\u8f6c\u79fb\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u6211\u4eec\u6b64\u65f6\u5728\u7b2c$i$\u5217\u7684\u653e\u6cd5\u552f\u4e00\uff0c\u56e0\u6b64\u7cfb\u6570\u5c31\u662f$1$\n\n\u6240\u4ee5\u7efc\u5408\u4e00\u4e0b\u5c31\u6709$F_i=F_{i-2}+F_{i-1}+2\\times s_{i-3}$\uff0c\u7136\u540e\u7528\u6590\u6ce2\u90a3\u5951\u6570\u5217\u524d\u7f00\u548c\u7684\u6027\u8d28$s_i=f_{i+2}-1$\u5373\u53ef\u63a8\u51fa$F_i=F_{i-2}+F_{i-1}+2\\times f_{i-1}-2$\n\n\u76f4\u63a5\u77e9\u9635\u5feb\u901f\u5e42\u7ef4\u62a4\u8f6c\u79fb\u7684$5$\u4e2a\u503c\uff08\u6709\u4e00\u4e2a\u662f\u5e38\u6570\u9879\uff09\uff0c\u590d\u6742\u5ea6$O(T\\times 5^3\\times \\log n)$\n\n100pts\u77e9\u4e58CODE\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#define RI register int\n#define CI const int&\nusing namespace std;\nconst int N=5,mod=1e9+7;\nstruct Matrix\n{\n    int n,m; long long mat[N][N];\n    inline Matrix(CI N=0,CI M=0) { n=N; m=M; memset(mat,0,sizeof(mat)); }\n    inline long long* operator [] (CI x) { return mat[x]; }\n    friend inline Matrix operator * (Matrix A,Matrix B)\n    {\n        Matrix C(A.n,B.m); for (RI i=0;i<C.n;++i)\n        for (RI j=0;j<C.m;++j) for (RI k=0;k<A.m;++k)\n        (C[i][j]+=A[i][k]*B[k][j])%=mod; return C;\n    }\n    friend inline Matrix operator ^ (Matrix A,long long p)\n    {\n        Matrix T(A.n,A.m); for (RI i=0;i<A.n;++i) T[i][i]=1;\n        for (;p;p>>=1LL,A=A*A) if (p&1) T=T*A; return T;\n    }\n}; int t,n;\nint main()\n{\n    for (scanf(\"%d\",&t);t;--t)\n    {\n        scanf(\"%d\",&n); if (n<=2) { puts(\"0\"); continue; }\n        Matrix S(5,1),D(5,5); S[2][0]=S[3][0]=1; S[4][0]=2;\n        D[0][0]=D[0][1]=D[1][0]=D[2][2]=D[2][3]=D[3][2]=D[4][4]=1;\n        D[0][2]=2; D[0][4]=mod-1; S=(D^(n-1))*S; printf(\"%d\\n\",S[0][0]);\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1559395221,
        "uid": 41698,
        "name": "hl666",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "\n\u9898\u76ee\u5730\u5740\uff1a[P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7](https://www.luogu.org/problemnew/show/P5303)\n\n\u8fd9\u91cc\u662f\u5b98\u65b9\u9898\u89e3\n\n## \u521d\u6b65\u5206\u6790\n\n\u4ece\u9898\u76ee\u548c\u6570\u636e\u8303\u56f4\u5f88\u5bb9\u6613\u770b\u51fa\u6765\u8fd9\u662f\u4e00\u4e2a\u9012\u63a8 + \u77e9\u9635\u5feb\u901f\u5e42\uff0c\u90a3\u4e48\u4e3b\u8981\u95ee\u9898\u5728\u4e8e\u9012\u63a8\u7684\u8fc7\u7a0b\u3002\n\n\u6ee1\u8db3\u6761\u4ef6\u7684\u7b54\u6848\u4e00\u5b9a\u662f\u4ee5\u4e0b\u7684\u5f62\u5f0f\uff0c\u8bbe $k = n - 1$ \uff0c\u5de6\u53f3\u4e24\u8fb9\u4e3a\u6574\u9f50\u7684\u9053\u8def\uff0c\u4e2d\u95f4\u4e3a\u957f\u5ea6 $p(p \\geq 3)$ \u7684\u7ec4\u5408\u5757\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/56828.png)\n\n\u7531 $p$ \u7684\u5947\u5076\u6027\uff0c\u53ef\u4ee5\u5f97\u5230\u4e24\u79cd\u4e0d\u540c\u7684\u57fa\u672c\u56fe\u5f62\uff0c\u5373 $1 \\times 1$ \u7684\u5c0f\u5757\u5728\u540c\u4e00\u884c\uff08 $p$ \u662f\u5076\u6570\uff09\u548c\u5404\u5360\u4e00\u884c\uff08 $p$ \u662f\u5947\u6570\uff09\u3002\n\n## \u6570\u5b66\u65b9\u6cd5\n\n\u5de6\u53f3\u5747\u4e3a\u666e\u901a\u7684\u94fa\u5730\u677f\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u6590\u6ce2\u90a3\u5951\u6570\u5217\u8868\u793a\uff0c\u901a\u8fc7\u4e0a\u4e0b\u7ffb\u8f6c\u53ef\u4ee5\u5f97\u5230\u4e24\u79cd\u4e0d\u540c\u7684\u4e2d\u95f4\u5757\u65b9\u6848\uff0c\u4e8e\u662f\u7b54\u6848\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n\n$$F_k = 2 \\sum_{p=3}^{n}\\ \\sum_{m=p}^{n}\\ f_{k-m}\\ f_{m-p+1}$$\n\n\u5176\u4e2d $f$ \u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u8f6c\u5316\u4e3a\u6bcd\u51fd\u6570\u53ef\u5f97\uff1a\n\n$$\\sum_{k=0}^{\\infty}\\ x^n\\ F_k = \\frac{2x^3}{(1-x)(1-x-x^2)^2}$$\n\n## DP\u65b9\u6cd5\n\n\u601d\u8003\u5982\u4f55\u6784\u9020\u65b9\u6848\uff0c\u5728 $p = 3$ \u65f6\uff0c\u6709\u4e24\u4e2a\u65e0\u6cd5\u5206\u5272\u7684\u6392\u5217\uff08\u60f3\u4e00\u60f3\uff0c\u54ea\u4e24\u4e2a\uff1f\uff09\uff0c\u5176\u4f59\u65b9\u6848\u53ef\u4ee5\u901a\u8fc7\u5728\u4e2d\u5fc3\u5757\u4e00\u4fa7\u52a0\u5165\u4e00\u4e2a\u7ad6\u5411\u7684 $1 \\times 2$ \u5730\u7816\u6216\u8005\u4e24\u4e2a\u6a2a\u5411\u7684 $1 \\times 2$ \u5730\u7816\u7ec4\u6210\u7684\u65b9\u5f62\u83b7\u5f97\u3002\u7b54\u6848\u5c31\u662f\u4e0a\u8ff0\u65b9\u6848\u7684\u6240\u6709\u6392\u5217\u6570\u4e4b\u548c\u3002\n\n### \u95ee\u9898\u8f6c\u5316\n\n\u4e3a\u4e86\u66f4\u597d\u7684\u6c42\u89e3\u95ee\u9898\uff0c\u5c06\u6240\u6709\u65b9\u6848\u653e\u5728\u4e00\u68f5\u6811\u4e0a\uff0c\u79f0\u4e4b\u4e3a\u201c\u65b9\u6848\u6811\u201d\uff0c\u7528 $T$ \u8868\u793a\u3002\u5177\u4f53\u800c\u8a00\uff0c\u5728\u6811\u4e0a **level** $q$ \u7684\u6bcf\u4e2a\u8282\u70b9\u653e\u5165 $q$ \u4e2a\u914d\u7f6e\uff0c\u8fd9\u4e9b\u914d\u7f6e\u53ef\u4ee5\u628a\u65b9\u6848\u62c6\u89e3\u4e3a $q$ \u5757\u53ef\u4ee5\u5faa\u73af\u6392\u5217\u7684\u7ed3\u6784\u3002\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684 **level** \u6570\u5c31\u4ee3\u8868\u8be5\u5c42\u8282\u70b9\u7684\u6574\u4f53\u91cd\u590d\u6b21\u6570\u3002\u90a3\u4e48\u6211\u4eec\u7684\u76ee\u7684\u5c31\u662f\u6784\u9020\u8fd9\u6837\u4e00\u68f5\u6811\uff0c\u7136\u540e\u6c42\u6bcf\u4e2a\u8282\u70b9\u5230\u8fbe\u6839\u8282\u70b9\u7684\u8ddd\u79bb\u548c\u3002\n\n![](https://cdn.luogu.com.cn/upload/pic/56829.png)\n\n### \u6784\u5efa\u65b9\u6848\u6811\n\n\u65b9\u6848\u6811\u672c\u8eab\u7684\u9012\u63a8\u5173\u7cfb\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u7684\u65b9\u5f0f\u83b7\u5f97\uff1a\n\n1. \u5728 $T_{k-1}$ \u7684 **level** $(q - 1)$ \u7684\u6bcf\u4e2a\u8282\u70b9\u672b\u7aef\u653e\u4e00\u4e2a\u7ad6\u5411\u7684 $1 \\times 2$ \u5730\u7816\u3002\u6309\u8fd9\u6837\u7684\u89c4\u5219\u628a\u65b0\u7684\u8282\u70b9\u4ece\u5de6\u5230\u53f3\u653e\u5230 $T_n$ \u7684 **level** $q$ \u7684\u8282\u70b9\u4e0a\u3002\n2. \u5728 $T_{k-2}$ \u7684 **level** $(q - 1)$ \u7684\u6bcf\u4e2a\u8282\u70b9\u672b\u7aef\u653e\u4e24\u4e2a\u6a2a\u5411\u7684 $1 \\times 2$ \u5730\u7816\u7ec4\u6210\u7684\u65b9\u5f62\u3002\u6309\u8fd9\u6837\u7684\u89c4\u5219\u628a\u65b0\u7684\u8282\u70b9\u4ece\u5de6\u5230\u53f3\u653e\u5165 $T_n$ \u7684 **level** $q$ \u7684\u5176\u4f59\u8282\u70b9\u4e0a\u3002\n\n### \u6590\u6ce2\u90a3\u5951\u6811\n\n\u8fd9\u6837\u62bd\u8c61\u4e4b\u540e\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u68f5\u201c\u6590\u6ce2\u90a3\u5951\u6811\u201d\uff1a\u521d\u59cb $T_0$ \u548c $T_1$ \u662f\u4e24\u68f5\u5355\u70b9\u6811\uff0c\u5bf9\u4e8e\u6240\u6709\u7684 $k(k \\geq 2)$ \uff0c $T_k$ \u7684\u5de6\u5b50\u6811\u662f $T_{k-1}$ \uff0c\u53f3\u5b50\u6811\u662f $T_{k-2}$ \u3002\u6211\u4eec\u7684\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $n$\uff0c\u6c42 $T_k$ \u4e0a\u6240\u6709\u8282\u70b9\u5230\u6839\u8282\u70b9\u7684\u8ddd\u79bb\u4e4b\u548c\u3002\n\n\u5c06 $T_{k-1}$ \u653e\u5165 $T_k$ \u7684\u5de6\u5b50\u6811\u4e2d\u65f6\uff0c $T_{k-1}$ \u7684\u6240\u6709\u8282\u70b9\u6df1\u5ea6\u52a0\u6df1\u4e00\u5c42\uff0c\u90a3\u4e48\u5de6\u5b50\u6811\u7684\u7b54\u6848\u5c31\u662f\u539f\u672c\u7684\u89e3 $F_{k-1}$ \u4e0e $T_{k-1}$ \u7684\u8282\u70b9\u4e2a\u6570 $N_{k-1}$ \u4e4b\u548c\u3002\u540c\u7406\uff0c\u53f3\u5b50\u6811\u7684\u7b54\u6848\u5c31\u662f\u539f\u672c\u7684\u89e3 $F_{k-2}$ \u4e0e $T_{k-2}$ \u7684\u8282\u70b9\u4e2a\u6570 $N_{k-2}$ \u4e4b\u548c\u3002\u5f97\u5230 **DP** \u65b9\u7a0b\u5982\u4e0b\uff1a\n\n$$N_0 = N_1 = 1, N_k = N_{k-1} +N_{k-2} + 1(k \\geq 2)$$\n\n$$F_0 = F_1 = 0, F_k = F_{k-1} + F_{k-2} + N_{k-1} +N_{k-2}(k \\geq 2)$$\n\n\u5176\u5bf9\u5e94\u7684\u77e9\u9635\u5982\u4e0b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/56817.png)\n\n\u628a\u8fd9\u4e2a\u77e9\u9635\u62ff\u53bb\u5c31\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u76f4\u63a5\u5f97\u5230\u7b54\u6848\u4e86\u3002\n\n### Further more\n\n\u9012\u63a8\u65b9\u7a0b\u5982\u679c\u8fdb\u4e00\u6b65\u5316\u7b80\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$F_0 = F_1 = 0, F_k = F_{k - 1} + F_{k - 2} + 2f_n - 2 (k \\geq 2)$$\n\n\u5176\u4e2d $f$ \u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u540c\u6837\u53ef\u4ee5\u7528\u4e8e\u672c\u95ee\u9898\u7684\u6c42\u89e3\u3002\n\n## std\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e24\u4efd\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\nusing namespace std;\n\nconst int MAXN = 5;\nconst int MOD = 1e9 + 7;\n\nstruct Matrix {\n\tint n, m;\n\tlong long a[MAXN][MAXN];\n\tMatrix(int _n, int _m) : n(_n), m(_m) {\n\t\tmemset(a, 0, sizeof(a));\n\t}\n\n\tfriend Matrix operator*(const Matrix &x, const Matrix &y) {\n\t\tMatrix ans = Matrix(x.n, y.m);\n\t\tfor (int i = 0; i < ans.n; ++i) {\n\t\t\tfor (int j = 0; j < ans.m; ++j) {\n\t\t\t\tfor (int k = 0; k < x.m; ++k) {\n\t\t\t\t\tans.a[i][j] += x.a[i][k] * y.a[k][j] % MOD;\n\t\t\t\t\tans.a[i][j] %= MOD;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ans;\n\t}\n};\n\nMatrix qpow(Matrix a, int pow) {\n\tMatrix ans = Matrix(a.n, a.m);\n\tfor (int i = 0; i < ans.n; i++) {\n\t\tans.a[i][i] = 1;\n\t}\n\tfor (; pow; pow >>= 1) {\n\t\tif (pow & 1) {\n\t\t\tans = ans * a;\n\t\t}\n\t\ta = a * a;\n\t}\n\treturn ans;\n}\n\nint main() {\n\tstd::ios::sync_with_stdio(false);\n\tint T;\n\tcin>>T;\n\twhile (T--) {\n\t\tint n;\n\t\tcin >> n;\n\t\tif (n == 1 || n == 2) {\n\t\t\tcout << 0 << endl;\n\t\t\tcontinue;\n\t\t}\n\t\tn--;\n\t\tMatrix f = Matrix(1, 5);\n\t\tf.a[0][2] = f.a[0][3] = f.a[0][4] = 1;\n\t\tMatrix fuck = Matrix(5, 5);\n\t\tfuck.a[0][0] = fuck.a[1][0] = fuck.a[2][0] = fuck.a[3][0] = 1;\n\t\tfuck.a[0][1] = fuck.a[2][2] = fuck.a[3][2] = fuck.a[4][2] = 1;\n\t\tfuck.a[2][3] = fuck.a[4][4] = 1;\n\t\tMatrix ans = f * qpow(fuck, n - 1);\n\t\tcout << ans.a[0][0] << endl;\n\t}\n\treturn 0;\n}\n```\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<string>\nusing namespace std;\nint a[27][27], f[27][27];\nint n, mod = 1000000007;\n\nint num(int x, int y, int z) {\n\treturn x * 9 + y * 3 + z;\n}\n\nvoid mul(int a[27][27], int b[27][27]) {\n\tint c[27][27];\n\tmemset(c, 0, sizeof(c));\n\tfor (int i = 0; i < 27; i++)\n\t\tfor (int j = 0; j < 27; j++)\n\t\t\tfor (int k = 0; k < 27; k++)\n\t\t\t\tc[i][j] = (c[i][j] + (long long)a[i][k] * b[k][j]) % mod;\n\tmemcpy(a, c, sizeof(c));\n}\n\nint main() {\n\tfor (int z = 0; z < 3; z++) {\n\t\ta[num(0, 0, z)][num(0, 0, z)] = 1;\n\t\ta[num(0, 0, z)][num(1, 1, z)] = 1;\n\t\tif (z < 2) a[num(0, 0, z)][num(1, 2, z + 1)] = 1;\n\t\tif (z < 2) a[num(0, 0, z)][num(2, 1, z + 1)] = 1;\n\n\t\ta[num(0, 1, z)][num(1, 0, z)] = 1;\n\t\tif (z < 2) a[num(0, 1, z)][num(2, 0, z + 1)] = 1;\n\n\t\ta[num(0, 2, z)][num(0, 0, z)] = 1;\n\t\ta[num(0, 2, z)][num(1, 1, z)] = 1;\n\t\tif (z < 2) a[num(0, 2, z)][num(2, 1, z + 1)] = 1;\n\n\t\ta[num(1, 0, z)][num(0, 1, z)] = 1;\n\t\tif (z < 2) a[num(1, 0, z)][num(0, 2, z + 1)] = 1;\n\n\t\ta[num(1, 1, z)][num(0, 0, z)] = 1;\n\n\t\ta[num(1, 2, z)][num(0, 1, z)] = 1;\n\n\t\ta[num(2, 0, z)][num(0, 0, z)] = 1;\n\t\ta[num(2, 0, z)][num(1, 1, z)] = 1;\n\t\tif (z < 2) a[num(2, 0, z)][num(1, 2, z + 1)] = 1;\n\n\t\ta[num(2, 1, z)][num(1, 0, z)] = 1;\n\t}\n\tf[0][num(0, 0, 0)] = 1;\n\n\tcin >> n;\n\tfor (; n; n >>= 1) {\n\t\tif (n & 1) mul(f, a);\n\t\tmul(a, a);\n\t}\n\tcout << ((f[0][num(0, 0, 2)] + f[0][num(0, 2, 2)]) % mod + f[0][num(2, 0, 2)]) % mod << endl;\n}\n```",
        "postTime": 1555503121,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7"
    },
    {
        "content": "\u770b\u5230 $N\\leq 2\\times 10^9$ \u7684\u8303\u56f4\uff0c\u4e00\u773c**\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316 DP**\u3002\n\n\u9996\u5148\u8003\u8651\u6734\u7d20 DP \u600e\u4e48\u5199\u3002\u6839\u636e\u9898\u76ee\u6240\u7ed9\u4fe1\u606f\uff0c\u6211\u4eec\u8bbe $dp_{i,0}$ \u8868\u793a\u524d\u9762 $i$ \u4e2a\u65b9\u7816\uff0c\u5e76\u4e14\u5df2\u7ecf\u4f7f\u7528\u4e86 $2$ \u4e2a $1\\times 1$ \u7684\u65b9\u7816\uff0c$dp_{i,1}$ \u5219\u8868\u793a\u524d\u9762 $i$ \u4e2a\u65b9\u7816\uff0c**\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u4e00\u4e2a** $1\\times 1$ \u7684\u65b9\u7816\u3002\n\n\u4e3a\u4e86\u8f6c\u79fb\u81f3 $dp_{i,0}$\uff0c\u65e2\u7136\u5df2\u7ecf\u4f7f\u7528\u8fc7\u4e86 $2$ \u4e2a $1\\times 1$ \u7684\u65b9\u7816\uff0c\u90a3\u4e48\u6211\u4eec\u5269\u4e0b\u7684\u90fd\u662f $1\\times 2$ \u7684\u65b9\u7816\uff0c\u5bf9\u4e8e\u8fd9\u6837\u7684\u65b9\u7816\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u53ef\u884c\u7684\u6446\u653e\uff0c\u4e00\u79cd\u662f\u76f4\u63a5**\u7ad6\u7740\u653e**\uff0c\u53ef\u4ee5\u7531 $dp_{i-1,0}$ \u8f6c\u79fb\u5f97\u5230\uff1b\u53e6\u4e00\u79cd\u662f**\u4e24\u4e2a\u6a2a\u7740\u653e**\uff0c\u53ef\u4ee5\u7531 $dp_{i-2,0}$ \u5f97\u5230\u3002\u800c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728 $[1,i-3]$ \u9009\u62e9\u4e00\u4e2a $j$\uff0c\u7136\u540e\u5229\u7528\u540e\u9762\u7684\u533a\u95f4 $[j+1,i]$ \u653e\u7f6e\u4e24\u4e2a $1\\times 1$ \u7684\u65b9\u7816\uff0c\u4e14\u4e24\u4e2a\u65b9\u7816\u653e\u7f6e\u7684\u4f4d\u7f6e\u5206\u522b\u5728\u7b2c $j+1$ \u5217\u548c\u7b2c $i$ \u5217\u3002\u800c\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u8fd9\u4e2a\u533a\u95f4\u957f\u5ea6\u4e3a\u5947\u6570\uff0c\u53e6\u4e00\u79cd\u662f\u533a\u95f4\u957f\u5ea6\u4e3a\u5076\u6570\u3002\n\n\u5bf9\u4e8e\u5947\u6570\u957f\u5ea6\u7684\u533a\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u4e24\u4e2a\u65b9\u7816\u653e\u5728**\u4e0d\u540c\u7684\u884c**\uff0c\u8fd9\u91cc\u5404\u81ea\u7684\u884c\u5269\u4e0b\u7684\u957f\u5ea6\u5c31\u662f\u5076\u6570\uff08\u5947\u6570\u51cf\u4e00\u662f\u5076\u6570\uff09\uff0c\u6211\u4eec\u5c31\u6bcf\u884c\u6a2a\u7740\u653e $1\\times 2$ \u7684\u65b9\u7816\u5c31\u53ef\u4ee5\u4e86\u3002\u800c\u5982\u679c\u653e\u5728\u540c\u4e00\u884c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u65e0\u6cd5\u586b\u6ee1\u91cc\u9762\u7684\u7a7a\u7f3a\uff08\u53ef\u4ee5\u81ea\u5df1\u753b\u56fe\u7406\u89e3\u4e00\u4e0b\uff09\u3002\u5bf9\u4e8e\u5076\u6570\u957f\u5ea6\u7684\u533a\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u4e24\u4e2a\u65b9\u7816\u5728**\u540c\u4e00\u884c**\uff0c\u8fd9\u6837\u4e0a\u4e0b\u4e24\u884c\u5269\u4f59\u7684\u957f\u5ea6\u5c31\u90fd\u662f\u5076\u6570\u4e86\uff0c\u5c31\u53ef\u4ee5\u6a2a\u7740\u653e $1\\times 2$ \u7684\u65b9\u7816\u6765\u586b\u6ee1\u7a7a\u7f3a\uff0c\u53cd\u4e4b\u5982\u679c\u662f\u5728\u4e0d\u540c\u7684\u884c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u53ef\u4ee5\u5b8c\u6210\u3002\n\n\u5982\u679c\u5b9e\u5728\u7406\u89e3\u4e0d\u4e86\uff0c\u6211\u53ef\u4ee5\u7ed9\u4e00\u70b9\u63d0\u793a\uff0c\u5c31\u662f\u5f53\u533a\u95f4\u4e24\u8fb9\u586b\u4e86 $1\\times 1$ \u7684\u65b9\u7816\u540e\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6240\u586b\u65b9\u7816\u7684\u53e6\u5916\u4e00\u884c\uff0c\u6211\u4eec\u53ea\u53ef\u80fd\u4f7f\u7528 $1\\times 2$ \u7684\u65b9\u7816\u586b\u6ee1\u90a3\u4e2a $1\\times 1$ \u7684\u7a7a\u7f3a\uff0c\u800c\u6b64\u65f6\u53c8\u4f1a\u4ea7\u751f\u65b0\u7684 $1\\times 1$ \u7684\u7a7a\u7f3a\u2026\u2026\u4ee5\u6b64\u7c7b\u63a8\u3002\uff08\u8fd9\u6837\u63d0\u793a\u8fd8\u4e0d\u591f\uff0c\u90a3\u6211\u53ef\u80fd\u5c31\u5e2e\u4e0d\u4e86\u4f60\u4e86\u3002\u3002\uff09\n\n\u603b\u4e4b\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e0d\u7ba1\u662f\u653e\u5728**\u4e0d\u540c\u7684\u884c\u6216\u8005\u76f8\u540c\u7684\u884c**\uff0c\u90fd\u4f1a\u5f97\u5230 $2$ \u79cd\u7b54\u6848\u3002\u800c\u4e14\u6b64\u65f6\u6211\u4eec\u8f6c\u79fb\u7684\u662f $dp_{j,1}$\uff0c\u56e0\u4e3a\u5982\u679c\u5728 $[j+1,i]$ \u653e\u7f6e\u4e24\u4e2a\u88c2\u5f00\u7684\u7816\u5757\uff0c\u90a3\u4e48 $[1,j]$ \u80af\u5b9a\u5c31\u662f\u6ca1\u6709\u88c2\u5f00\u7684\u7816\u5757\u7684\u3002\n\n\u800c\u6211\u4eec\u7684 $dp_{i,1}$ \u5c31\u975e\u5e38\u597d\u8f6c\u79fb\u4e86\uff0c\u5c31\u662f\u8981\u4e48\u7ad6\u7740\u653e\uff0c\u8981\u4e48\u4e24\u4e2a\u6a2a\u7740\u653e\uff0c\u5373 $dp_{i,1}=dp_{i-1,1}+dp_{i-2,1}$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5217\u51fa\u65b9\u7a0b\uff1a\n\n$$\\begin{cases} dp_{i,0}=dp_{i-1,0}+dp_{i-2,0}+2\\times \\sum _{j=1}^{i-3}dp_{j,1}\\\\ dp_{i,1}=dp_{i-1,1}+dp_{i-2,1} \\\\\\end{cases}$$\n\n\u4f46\u662f\u8fd9\u6837\u80af\u5b9a\u662f\u4f1a\u8d85\u65f6\u7684\uff0c\u6240\u4ee5\u5c31\u4f1a\u60f3\u5230\u4f7f\u7528**\u77e9\u9635**\u3002\n\n\u4f46\u662f\u6211\u4eec\u53c8\u53d1\u73b0\u8fd9\u4e2a $dp_{i,0}$ \u7684\u8f6c\u79fb\u4e0d\u662f $O(1)$ \u7684\uff0c\u6240\u4ee5\u8003\u8651\u5c06\u65b9\u7a0b\u8fdb\u884c\u6539\u9020\u3002\u5bf9\u4e8e $\\sum _{j=1}^{i-3}dp_{j,1}$\uff0c\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\u6bcf\u6b21 $i$ \u589e\u52a0 $1$\uff0c\u6211\u4eec\u539f\u6765\u7684\u503c\u5c31\u4f1a\u589e\u52a0\u4e00\u4e2a $dp_{j,1}$ \u7684\u503c\u3002\u6839\u636e\u8fd9\u4e2a\u5f62\u5f0f\uff0c\u6211\u4eec\u5c31\u60f3\u5230\u4f7f\u7528**\u524d\u7f00\u548c**\u50a8\u5b58\u8fd9\u4e2a\u533a\u95f4\u503c\u3002\u8bbe $sum_i$ \u8868\u793a $\\sum_{j=1}^i dp_{j,1}$ \u7684\u503c\u3002\u539f\u65b9\u7a0b\u53d8\u4e3a\uff1a\n\n$$dp_{i,0}=dp_{i-1,0}+dp_{i-2,0}+2\\times sum_{i-3}$$\n\n\u6211\u4eec\u5c06\u4e00\u6b21\u8f6c\u79fb\u4f7f\u7528\u5230\u7684\u503c\u63d0\u51fa\u6765\uff1a$dp_{i-1,0}$\uff0c$dp_{i-2,0}$\uff0c$sum_{i-3}$\uff0c$dp_{i-1,1}$\uff0c$dp_{i-2,1}$\u3002\u7136\u540e\u5229\u7528\u8fd9\u4e9b\u503c\u6784\u9020\u521d\u59cb\u77e9\u9635\uff1a\n\n$$\n\\left(\n\\begin{matrix}\ndp_{i-1,0} & dp_{i-2,0} & dp_{i-1,1} & dp_{i-2,1} & sum_{i-3}\n\\end{matrix}\n\\right)\n$$\n\n\u6362\u6210\u5177\u4f53\u7684\u6570\u503c\uff0c\u771f\u6b63\u7684\u521d\u59cb\u77e9\u9635\u662f\uff1a\n\n$$\n\\left(\n\\begin{matrix}\n0 & 0 & 2 & 1 & 1\n\\end{matrix}\n\\right)\n$$\n\n\u6ce8\u610f\u8fd9\u4e2a $sum_0$ \u662f $1$\uff0c\u56e0\u4e3a\u653e\u7f6e $0$ \u4e2a\u65b9\u7816\u4e5f\u662f\u4e00\u79cd\u7b54\u6848\u3002\n\n\u6bcf\u6b21\u8f6c\u79fb\u6309\u7167\u4e0a\u8ff0\u65b9\u7a0b\u8fdb\u884c\u8f6c\u79fb\uff0c\u5f97\u5230\u8f6c\u79fb\u77e9\u9635\uff1a\n\n$$\n\\left(\n\\begin{matrix}\n1 & 1 & 0 & 0 & 0\\\\\n1 & 0 & 0 & 0 & 0\\\\\n0 & 0 & 1 & 1 & 0\\\\\n0 & 0 & 1 & 0 & 1\\\\\n2 & 0 & 0 & 0 & 1\n\\end{matrix}\n\\right)\n$$\n\n\u6240\u4ee5\u5f97\u5230\u7b54\u6848\u4e3a\uff1a\n\n$$\n\\left(\n\\begin{matrix}\n0 & 0 & 2 & 1 & 1\n\\end{matrix}\n\\right)\n\\times\n\\left(\n\\begin{matrix}\n1 & 1 & 0 & 0 & 0\\\\\n1 & 0 & 0 & 0 & 0\\\\\n0 & 0 & 1 & 1 & 0\\\\\n0 & 0 & 1 & 0 & 1\\\\\n2 & 0 & 0 & 0 & 1\n\\end{matrix}\n\\right)\n^{n-2}\n$$\n\n\u8fd9\u6837\u4ee3\u7801\u5c31\u975e\u5e38\u7b80\u5355\u4e86\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int MOD=1e9+7;\nlong long n,p,q;\nvoid mul(long long f[5],long long a[5][5])\n{\n    long long c[5];\n    memset(c,0,sizeof(c));\n    for(int j=0;j<5;j++)\n    {\n    \tfor(int k=0;k<5;k++)\tc[j]=(c[j]+f[k]*a[k][j])%MOD;\n\t}\n    memcpy(f,c,sizeof(c));\n}\nvoid mulself(long long a[5][5])\n{\n    long long c[5][5];\n    memset(c,0,sizeof(c));\n    for(int i=0;i<5;i++)\n    {\n        for(int j=0;j<5;j++)\n        {\n            for(int k=0;k<5;k++)    c[i][j]=(c[i][j]+(long long)a[i][k]*a[k][j])%MOD;\n        }\n    }\n    memcpy(a,c,sizeof(c));\n}\nsigned main()\n{\n\tlong long T;\n\tcin>>T;\n\twhile(T--)\n\t{\n\t\tcin>>n;\n\t\tlong long f[5]={0,0,2,1,1};\n\t\tlong long a[5][5]={0};\n\t\ta[0][0]=a[0][1]=a[1][0]=a[2][2]=a[2][3]=a[3][2]=a[3][4]=a[4][4]=1,a[4][0]=2;\n\t\tif(n==1||n==2||!n)\n\t\t{\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\tn-=2;\n\t\twhile(n)\n\t\t{\n\t\t\tif(n&1)\tmul(f,a);\n\t\t\tmulself(a);\n\t\t\tn>>=1;\n\t\t}\n\t\tcout<<f[0]<<endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1677562834,
        "uid": 439177,
        "name": "Super_Sheep",
        "ccfLevel": 0,
        "title": "P5303\u9898\u89e3"
    },
    {
        "content": "## \u524d\u7f6e\u77e5\u8bc6\n\n\u6590\u6ce2\u90a3\u5951\u6570\u5217\n\n## \u5206\u6790\n\n\u9996\u5148\uff0c\u5148\u653e\u5b8c\u4e24\u4e2a $1 \\times 1$ \u7684\u5757\u4e4b\u540e\uff0c\u4e2d\u95f4\u7684\u5757\u5c31\u6ca1\u6709\u65b9\u6cd5\u53ef\u4ee5\u9009\u4e86\u3002\u7136\u540e\uff0c\u8fd9\u4e24\u4e2a\u5757\u52a0\u8d77\u6765\u7684\u957f\u5ea6\u6700\u5c11\u662f $3$\uff0c\u5916\u9762\u968f\u4fbf\u4e71\u6446\u5c31\u53ef\u4ee5\u4e86\u3002\u7136\u540e\u5c31\u518d\u628a\u7ffb\u8f6c\u7684\u53ef\u80fd\u6027\u52a0\u8fdb\u53bb\uff0c\u5c31\u63a8\u51fa\u4e86\u5f0f\u5b50\uff1a\n\n$$ans = 2\\sum\\limits_{i = 0}^{n-3}F_i\\sum\\limits_{j=0}^{n-3-i}F_j$$\n\n\u4e3a\u4e86\u5316\u7b80\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u7684\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\u524d\u7f00\u548c\u516c\u5f0f\u3002\u524d\u7f00\u548c\u516c\u5f0f\u5f88\u7b80\u6d01\uff0c\u662f\uff1a\n\n$$\\sum\\limits_{i=0}^nF_i=F_{n+2}-1$$\n\n\u8bc1\u660e\u53ef\u4ee5\u627e\u89c4\u5f8b\u540e\u6570\u5b66\u5f52\u7eb3\u8bc1\u660e\u3002\n\n\u8fd9\u4e1c\u897f\u5c31\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5316\u7b80\u4e0a\u5f0f\n\n$$\n\\begin{aligned}\nans &= 2\\sum\\limits_{i = 0}^{n-3}F_i(F_{n-i-1}-1)\\\\\n&= 2(\\sum\\limits_{i = 0}^{n-3}F_iF_{n-i-1}-\\sum\\limits_{i = 0}^{n-3}F_i)\\\\\n&= 2(\\sum\\limits_{i = 0}^{n-3}F_iF_{n-i-1}-F_{n-1}+1)\\\\\n\\end{aligned}\n$$\n\n\u4e0b\u4e00\u6b65\uff0c\u6211\u4eec\u5c31\u9700\u8981\u627e\u5230\u5316\u7b80 $\\sum\\limits_{i = 0}^{n-3}F_iF_{n-i-1}$ \u7684\u65b9\u6cd5\u3002\n\n\u6211\u4eec\u4ee4 $S_n = \\sum\\limits_{i = 0}^nF_iF_{n-i}$\u3002\n\n$$\n\\begin{aligned}\nS_n &= \\sum\\limits_{i = 0}^nF_iF_{n-i}\\\\\n&= \\sum\\limits_{i = 2}^n(F_{i-1}+F_{i-2})F_{n-i}+F_1F_{n-1}+F_0F_n\\\\\n&= \\sum\\limits_{i = 2}^nF_{i-1}F_{n-i}+\\sum\\limits_{i = 2}^nF_{i-2}F_{n-i}+F_1F_{n-1}+F_0F_n\\\\\n&= S_{n-1}-F_0F_{n-1}+S_{n-2}+F_1F_{n-1}+F_0F_n\\\\\n&= S_{n-1}+S_{n-2}+F_0F_n\\\\\n&= S_{n-1}+S_{n-2}+F_n\n\\end{aligned}\n$$\n\n\u770b\u4e0a\u53bb\u5f88\u96be\u641e\u3002\n\n\u4f46\u662f\u53d1\u73b0\u8fd9\u4e2a\u5f62\u5f0f\uff0c\u53ef\u4ee5\u4eff\u7167\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u77e9\u9635\u5feb\u901f\u5e42\u505a\u6cd5\u3002\n\n\u4e8e\u662f\u627e\u5230\u4e00\u4e2a\u77e9\u9635\uff1a\n\n$$\n\\left[\n\\begin{matrix}\n0&1&0&0\\\\\n1&1&0&0\\\\\n0&0&0&1\\\\\n1&1&1&1\\\\\n\\end{matrix}\n\\right]\n$$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u77e9\u9635\u53ef\u4ee5\u7528\u6765\u9012\u63a8 $S_n$\uff1a\n\n$$\n\\left[\n\\begin{matrix}\nF_{n-2}\\\\\nF_{n-1}\\\\\nS_{n-2}\\\\\nS_{n-1}\\\\\n\\end{matrix}\n\\right]\n\\left[\n\\begin{matrix}\n0&1&0&0\\\\\n1&1&0&0\\\\\n0&0&0&1\\\\\n1&1&1&1\\\\\n\\end{matrix}\n\\right]\n=\n\\left[\n\\begin{matrix}\nF_{n-1}\\\\\nF_{n}\\\\\nS_{n-1}\\\\\nS_{n}\\\\\n\\end{matrix}\n\\right]\n$$\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u521d\u59cb\u503c\u77e9\u9635\u5feb\u901f\u5e42\u540e\u5f97\u51fa $S_n$ \u4e86\uff0c\u4e5f\u53ef\u4ee5\u7b97\u51fa\u7b54\u6848\u4e86\uff1a\n\n\n$$\n\\begin{aligned}\nans &= 2(\\sum\\limits_{i = 0}^{n-3}F_iF_{n-i-1}-F_{n-1}+1)\\\\\n&= 2(S_{n-1}-F_{n-2}F_{1}-F_{n-1}F_0-F_{n-1}+1)\\\\\n&= 2(S_{n-1}-F_{n-2}-F_{n-1}-F_{n-1}+1)\\\\\n&= 2(S_{n-1}-2F_{n-2}-F_{n-2})\\\\\n\\end{aligned}\n$$\n\n\u7136\u540e\u5c31\u89e3\u51b3\u4e86\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h> \n#define lld long long \nusing namespace std;\nconst lld mod = 1e9 + 7;\nstruct matrix {\n\tlld a[5][5];\n\tmatrix() { memset(a, 0, sizeof(a)); }\n\tlld * operator [] (lld x) { return a[x]; }\n};\nmatrix _unit;\nmatrix unit() {\n\tif (!_unit[1][1]) for (int i = 1; i <= 4; ++ i) _unit[i][i] = 1;\n\treturn _unit;\n}\nmatrix operator * (const matrix & a, const matrix & b) {\n\tmatrix ret;\n\tfor (int k = 1; k <= 4; ++ k)\n\t\tfor (int i = 1; i <= 4; ++ i)\n\t\t\tfor (int j = 1; j <= 4; ++ j)\n\t\t\t\tret[i][j] = (ret[i][j] + a.a[i][k] * b.a[k][j]) % mod;\n\treturn ret;\n}\nmatrix qpow(matrix a, lld b) {\n\tmatrix ret = unit();\n\tfor (; b; b >>= 1, a = a * a)\n\t\tif (b & 1) ret = ret * a;\n\treturn ret;\n}\nint t;\nlld n;\nint main() {\n\tscanf(\"%d\", &t);\n\tmatrix base;\n\t/* \u62ff\u6765\u4e58\u7684\u77e9\u9635 */\n    base[1][1] = base[1][2] = base[1][3] = base[1][4] = 1;\n\tbase[2][1]\t\t\t\t\t\t\t\t\t\t  = 1;\n\t\t\t\t\t\t\t  base[3][3] = base[3][4] = 1;\n\t\t\t\t\t\t\t  base[4][3]\t\t\t  = 1;\n\tmatrix init;\n\t/* \u521d\u59cb\u77e9\u9635 */\n\tinit[1][1] = 2;\n\tinit[2][1] = 1;\n\tinit[3][1] = 1;\n\tinit[4][1] = 1;\n\twhile (t --) {\n\t\tscanf(\"%lld\", &n);\n\t\tif (n <= 2) {\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\tmatrix res = qpow(base, n - 2) * init;\n\t\tlld Sn = res[1][1], Fn = res[3][1], Fn_1 = res[4][1]; // \u987a\u4fbf\u4e58\u51fa\u7ed3\u679c \n        printf(\"%lld\\n\", (((1 + Sn - (Fn << 1) - Fn_1) << 1) + mod * 114514) % mod);\n\t}\n}\n```\n\n",
        "postTime": 1640254635,
        "uid": 228486,
        "name": "SunsetSamsara",
        "ccfLevel": 7,
        "title": "P5303 [GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7 \u9898\u89e3"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[$luogu$](https://www.luogu.com.cn/problem/P5303).\n# \u9898\u89e3\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u96be\u60f3\u5230$50pts$\u7684\u66b4\u529b.\n## $50pts$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5173\u952e\u5728\u4e8e\u4e24\u4e2a$1\\times1$\u7816\u4e2d\u95f4\u7684\u4f4d\u7f6e, \u663e\u7136, \u4e2d\u95f4\u7684$1\\times2$\u7816\u662f\u4e0d\u80fd\u7ad6\u7740\u9632\u6b62\u7684. \u5426\u5219, \u5c31\u4f1a\u4f7f\u5de6\u53f3\u90e8\u5206\u90fd\u53ea\u5269\u4e0b\u5947\u6570\u4e2a\u7a7a\u4f4d, \u4e0d\u53ef\u80fd\u5b8c\u6210\u4efb\u52a1.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u90a3\u4e48, \u88ab\u5939\u5728\u8fd9\u4e24\u5757\u7816\u4e2d\u95f4\u7684\u90e8\u5206\u5c31\u53ea\u6709\u4e24\u79cd\u65b9\u6848, \u5de6\u53f3\u5c31\u90fd\u662f\u666e\u901a\u7684\u60c5\u51b5. \u6240\u4ee5\u53ef\u4ee5\u5148\u6c42\u51fa\u6590\u6ce2\u90a3\u5951\u6570\u5217$F_n$\u53ca\u5176\u524d\u7f00\u548c$S_n$, \u679a\u4e3e\u5de6\u4fa7\u7816\u7684\u4f4d\u7f6e, \u6c42\u5f97\u7b54\u6848:\n$$\nAns=\\sum_{i=1}^{n-2}F_{i-1}S_{n-i-2}\n$$\n## $100pts$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6211\u4eec\u628a$50pts$\u7684\u601d\u8def\u5411\u77e9\u9635\u52a0\u901f\u9760\u62e2. \u8bb0$f(i)$\u4e3a$n=i$\u65f6\u7684\u7b54\u6848, \u90a3\u4e48:\n$$\nf(i)=f(i-1)+f(i-2)+2S_{i-3}\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u63a8\u4e00\u4e0b\u5f0f\u5b50, \u5c31\u53ef\u4ee5\u53d1\u73b0\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u524d\u7f00\u548c$S_n=F_{n+2}-1$. \u6240\u4ee5\u5c06\u4e0a\u5f0f\u53d8\u6210:\n$$\nf(i)=f(i-1)+f(i-2)+2F_{i-1}-2\n$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u77e9\u9635\u52a0\u901f. ( \u53ef\u4ee5, \u8fd9\u9898\u5f88\u9ed1$qwq$. )\n## \u4ee3\u7801 ( $100pts$ )\n```cpp\n#include <cstdio>\n#include <assert.h>\n\n#define Int register int\n\nconst int MOD = 1e9 + 7;\n\nclass Matrix {\nprivate:\n\tint n, m, mat[10][10];\n\npublic:\n\tMatrix ( const int tn, const int tm ): n ( tn ), m ( tm ) {\n\t\tfor ( Int i = 1; i <= n; ++ i ) for ( Int j = 1; j <= m; ++ j ) mat[i][j] = 0;\n\t}\n\tinline int Getn () { return n; }\n\tinline int Getm () { return m; }\n\tinline int* operator [] ( const int Key ) { return mat[Key]; }\n\tinline void SetUnit () {\n\t\tassert ( n == m );\n\t\tfor ( Int i = 1; i <= n; ++ i ) for ( Int j = 1; j <= n; ++ j ) mat[i][j] = i == j;\n\t}\n\tfriend inline Matrix operator * ( Matrix a, Matrix b ) {\n\t\tassert ( a.m == b.n );\n\t\tMatrix ret ( a.n, b.m );\n\t\tfor ( Int i = 1; i <= ret.n; ++ i ) {\n\t\t\tfor ( Int k = 1; k <= a.m; ++ k ) {\n\t\t\t\tfor ( Int j = 1; j <= ret.m; ++ j ) {\n\t\t\t\t\tret[i][j] = ( ret[i][j] + 1LL * a[i][k] * b[k][j] % MOD ) % MOD;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n} S ( 5, 5 );\n\ninline Matrix MatPower ( Matrix A, int k ) {\n\tMatrix ret ( A.Getn (), A.Getm () ); ret.SetUnit ();\n\tfor ( ; k; A = A * A, k >>= 1 ) if ( k & 1 ) ret = ret * A;\n\treturn ret;\n}\n\ninline void Work () {\n\tS[1][1] = S[1][2] = S[2][1] = S[3][3] = S[3][4] = S[4][3] = S[5][5] = 1;\n\tS[3][1] = 2, S[5][1] = MOD - 2;\n\tint T; scanf ( \"%d\", &T );\n\tfor ( int n; T --; ) {\n\t\tscanf ( \"%d\", &n );\n\t\tif ( n < 3 ) { puts ( \"0\" ); continue; }\n\t\tMatrix A ( 1, 5 );\n\t\tA[1][3] = 2, A[1][4] = A[1][5] = 1;\n\t\tprintf ( \"%d\\n\", ( A * MatPower ( S, n - 2 ) )[1][1] );\n\t}\n}\n\nint main () {\n\tWork ();\n\treturn 0;\n}\n```",
        "postTime": 1576496251,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "## \u4f20\u9001\u95e8\n[Loj](https://loj.ac/problem/3086)\n\n## Solution\n\u6bd4\u8f83\u7b80\u5355.\n\u8003\u8651\u8bbe$f_i$\u8868\u793a\u5f53$N$\u4e3a$i$\u7684\u65f6\u5019\u7684\u7b54\u6848,$g_i$\u8868\u793a\u53ea\u75281\\*2\u7684\u94fa\u6ee1$2*i$\u683c\u5b50\u7684\u65b9\u6848\u6570.\n\u6709:$f_i=f_{i-1}+f_{i-2}+2*\\sum_{j=1}^{i-3}g_j$\n\u7136\u540e\u6211\u4eec\u53c8\u77e5\u9053\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u524d\u7f00\u548c$s_i$=$g_i+2$,\u76f4\u63a5\u77e9\u9635\u5feb\u901f\u5e42\u5c31\u597d\u4e86.\n\n## \u4ee3\u7801\u5b9e\u73b0\n```cpp\n/*\n  mail: mleautomaton@foxmail.com\n  author: MLEAutoMaton\n  This Code is made by MLEAutoMaton\n*/\n#include<stdio.h>\n#include<stdlib.h>\n#include<string.h>\n#include<math.h>\n#include<algorithm>\n#include<queue>\n#include<set>\n#include<map>\n#include<iostream>\nusing namespace std;\n#define ll long long\n#define re register\n#define file(a) freopen(a\".in\",\"r\",stdin);freopen(a\".out\",\"w\",stdout)\ninline int gi()\n{\n\tint f=1,sum=0;char ch=getchar();\n\twhile(ch>'9' || ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0' && ch<='9'){sum=(sum<<3)+(sum<<1)+ch-'0';ch=getchar();}\n\treturn f*sum;\n}\nconst int Mod=1e9+7;\nstruct matrix\n{\n\tint a[5][5];\n}S,T;\nmatrix cheng(matrix a,matrix b)\n{\n\tmatrix c;\n\tfor(int i=0;i<5;i++)\n\t\tfor(int j=0;j<5;j++)\n\t\t{\n\t\t\tc.a[i][j]=0;\n\t\t\tfor(int k=0;k<5;k++)\n\t\t\t\tc.a[i][j]=(c.a[i][j]+1ll*a.a[i][k]*b.a[k][j]%Mod)%Mod;\n\t\t}\n\treturn c;\n}\nint main()\n{\n\tfreopen(\"obsession.in\",\"r\",stdin);\n\tfreopen(\"obsession.out\",\"w\",stdout);\n\tint Case=gi();\n\twhile(Case--)\n\t{\n\t\tint n=gi();\n\t\tS.a[0][0]=0;S.a[0][1]=0;S.a[0][2]=1;S.a[0][3]=2;S.a[0][4]=2;\n\t\t\n\t\tT.a[0][0]=0;T.a[0][1]=1;T.a[0][2]=0;T.a[0][3]=0;T.a[0][4]=0;\n\t\tT.a[1][0]=1;T.a[1][1]=1;T.a[1][2]=0;T.a[1][3]=0;T.a[1][4]=0;\n\t\tT.a[2][0]=0;T.a[2][1]=0;T.a[2][2]=0;T.a[2][3]=1;T.a[2][4]=0;\n\t\tT.a[3][0]=0;T.a[3][1]=2;T.a[3][2]=1;T.a[3][3]=1;T.a[3][4]=0;\n\t\tT.a[4][0]=0;T.a[4][1]=Mod-1;T.a[4][2]=0;T.a[4][3]=0;T.a[4][4]=1;\n\t\tif(n==1){puts(\"0\");continue;}\n\t\tn-=2;\n\t\twhile(n)\n\t\t{\n\t\t\tif(n&1)S=cheng(S,T);\n\t\t\tT=cheng(T,T);n>>=1;\n\t\t}\n\t\tprintf(\"%d\\n\",S.a[0][1]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1556616041,
        "uid": 51343,
        "name": "MLEAutoMaton",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "### \u9898\u76ee\u5206\u6790\uff1a\n\n\u9996\u5148\uff0c\u6211\u4eec\u5148\u8003\u8651\u6ca1\u6709\u7816\u88c2\u6389\u7684\u60c5\u51b5\uff0c\u5373\u7528 $n$ \u5757 $2\\times 1$ \u7684\u8f6c\u586b\u6ee1 $2\\times n$ \u7684\u9053\u8def\u3002\u8bb0 $f_i$ \u4e3a\u8003\u8651\u5230\u7b2c $i$ \u5217\u7684\u65b9\u6848\u6570\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u6700\u540e\u4e00\u5217\u5730\u65b9\u653e\u4e0a $2\\times 1$ \u7684\u7816\u5757\uff08\u7ad6\u7740\u653e\uff09\uff0c\u53ef\u4ee5\u4ece $f_{i-1}$ \u8f6c\u79fb\u8fc7\u6765\u3002\u5728\u6700\u540e\u4e24\u5217\u5730\u65b9\u653e\u4e0a\u4e24\u4e2a $1\\times2$ \u7684\u7816\u5757\uff08\u6a2a\u7740\u653e\uff09\uff0c\u53ef\u4ee5\u4ece $f_{i-2}$ \u8f6c\u79fb\u8fc7\u6765\u3002\u6240\u4ee5 $f_i=f_{i-1}+f_{i-2}$\uff0c\u663e\u7136 $f_{0}=1,f_{1}=1$\uff0c\u4f9d\u6b21\u5f80\u540e\uff0c$f_i$ \u4e3a\u4e00\u4e2a\u83f2\u6ce2\u90a3\u5207\u6570\u5217\u3002\n\n\u597d\u4e86\uff0c\u8003\u8651\u6709\u4e00\u5757\u7816\u7834\u788e\u7684\u72b6\u6001\u3002\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u7684\u662f\uff0c\u5047\u5982\u4e24\u5757 $1\\times 1$ \u7684\u7816\u5757\u4f4d\u7f6e\u5df2\u7ecf\u786e\u5b9a\u7684\u8bdd\uff0c\u8bb0\u5de6\u8fb9 $1\\times1$ \u7684\u5217\u6570\u4e3a $l$\uff0c\u53f3\u8fb9\u4e3a $r$\uff0c\u5219 $[l,r]$ \u5185\u6240\u6709\u7684\u7816\u5757\u4f4d\u7f6e\u786e\u5b9a\u4e0b\u6765\u3002\u5373 $[l,r]$ \u5185\u975e $1\\times 1$ \u7684\u7816\u5757\u53ea\u80fd\u6a2a\u7740\u653e\uff0c\u4e14\u653e\u7f6e\u65b9\u6848\u552f\u4e00\u3002\u6240\u4ee5\u6211\u4eec\u8bb0 $g_i$ \u4e3a\u8003\u8651\u5230\u7b2c $i$ \u5217\u7684\u65b9\u6848\u6570\u3002\u9996\u5148\uff0c\u6211\u4eec\u540c\u7406\u53ef\u4ee5\u4ece $g_{i-2}$ \u548c $g_{i-1}$ \u8f6c\u79fb\u8fc7\u6765\u3002\u5176\u6b21\uff0c\u82e5\u8fd9\u4e00\u5217\u653e\u7f6e\u4e86\u53f3\u7aef $1\\times 1$ \u7684\u7816\u5757\uff0c\u6211\u4eec\u679a\u4e3e\u5de6\u7aef $1\\times 1$ \u7684\u7816\u5757\uff0c\u663e\u7136\u53ef\u4ee5\u4ece $f_{1\\sim i-3}$ \u8f6c\u79fb\u8fc7\u6765\u3002\u6240\u4ee5 $\\begin{aligned}g_i=g_{i-1}+g_{i-2}+2\\sum_{j=0}^{i-3}\\end{aligned}f_{j}$\uff0c\u5176\u4e2d\u8bb0 $\\begin{aligned}\\sum_{j=0}^{i-3}f_j=S_{i-3}\\end{aligned}$\u3002\u800c $S_i$ \u7684\u8f6c\u79fb\u5c31\u662f $S_i=S_{i-1}+f_i$\u3002\n\n\u56e0\u4e3a\u8fd9\u4e9b\u8f6c\u79fb\u90fd\u662f\u7ebf\u6027\u7684\uff0c\u6211\u4eec\u8003\u8651\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $\\begin{bmatrix}g_i\\\\g_{i-1}\\\\f_{i-1}\\\\f_{i-2}\\\\S_{i-3}\\end{bmatrix}$ \u8f6c\u79fb\u77e9\u9635\u4e3a\uff1a$\\begin{bmatrix}1&1&2&0&2\\\\1&0&0&0&0\\\\0&0&1&1&0\\\\0&0&1&0&0\\\\0&0&1&0&1\\end{bmatrix}$\u3002\n\n\u521d\u59cb\u77e9\u9635\u4e3a\uff1a$\\begin{bmatrix}2\\\\0\\\\1\\\\1\\\\1\\end{bmatrix}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(k^3\\log n)$\uff0c\u5176\u4e2d $k$ \u4e3a\u77e9\u9635\u5927\u5c0f\uff0c\u8fd9\u91cc\u8bb0\u4f5c $k=5$\u3002\n\n### \u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define pd push_back\n#define all(x) x.begin(),x.end()\n#define Clear(x,n) for(int i=0;i<=n;i++)x[i]=0;\n//==============================================================================\nll QP(ll x,ll y,ll mod){ll ans=1;for(;y;y>>=1,x=x*x%mod)if(y&1)ans=ans*x%mod;return ans;}\n//==============================================================================\nnamespace IO{\n\tint readInt(){\n\t\tint x=0,y=0;char c=0;\n\t\twhile(!isdigit(c))y|=c=='-',c=getchar();\n\t\twhile(isdigit(c))x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\t\treturn !y?x:-x;\n\t}\n\tvoid write(int x){if(!x)return;write(x/10);putchar(x%10+'0');}\n\tvoid Output(int x){if(x<0)putchar('-'),x=-x;if(!x)putchar('0');else write(x);}\n\tvoid WL(int x){Output(x);putchar('\\n');}\n\tvoid WS(int x){Output(x);putchar(' ');}\n}\nnamespace Debug{\n\tvoid DeVec(vector<int> c){for(auto y:c)printf(\"%d \",y);puts(\"\");}\n\tvoid DeNum(int x){printf(\"%d\\n\",x);}\n}\n//==============================================================================\nconst int N=1e5+10;\nconst int mod=1e9+7;\nstruct Matrix{\n\tll a[6][6];\n\tint n,m;\n\tvoid init1(int c){memset(a,0,sizeof(a));n=m=c;for(int i=1;i<=n;i++)a[i][i]=1;}\n\tvoid init2(int _n,int _m,vector<int> c){\n\t\tassert(c.size()==_n*_m);\n\t\tn=_n,m=_m;\n\t\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)a[i][j]=c[(i-1)*m+j-1];\n\t}\n\tvoid init3(int _n,int _m){memset(a,0,sizeof(a));n=_n;m=_m;}\n\tMatrix operator *(const Matrix B){\n\t\tMatrix ans;ans.init3(n,B.m);\n\t\tassert(m==B.n);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int j=1;j<=B.m;j++)\n\t\t\t\tfor(int k=1;k<=m;k++)\n\t\t\t\t\tans.a[i][j]=(ans.a[i][j]+a[i][k]*B.a[k][j])%mod;\n\t\treturn ans;\n\t}Matrix operator ^(int y){\n\t\tMatrix ans;assert(n==m);ans.init1(n);\n\t\tMatrix x=(*this);\n\t\tfor(;y;y>>=1,x=x*x)if(y&1)ans=ans*x;\n\t\treturn ans;\n\t}\n};\nMatrix Bas1,Bas2;\nint T;\nint main(){\n\t//freopen(\".in\",\"r\",stdin);\n\t//freopen(\".out\",\"w\",stdout);\n\t//std::ios::sync_with_stdio(false);\n    //std::cin.tie(nullptr);\n    scanf(\"%d\",&T);\n    while(T--){\n    \tll n;scanf(\"%lld\",&n);\n    \tBas1.init2(5,5,{1,1,2,0,2,\n\t\t\t\t\t\t1,0,0,0,0,\n\t\t\t\t\t\t0,0,1,1,0,\n\t\t\t\t\t\t0,0,1,0,0,\n\t\t\t\t\t\t0,0,1,0,1});\n\t\tBas2.init2(5,1,{2,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t1});\n\t\tif(n<=2){puts(\"0\");continue;}\n\t\tMatrix ans=(Bas1^(n-3))*Bas2;\n\t\tprintf(\"%lld\\n\",ans.a[1][1]);\n\t}return 0;\n}\n\n\n```\n",
        "postTime": 1684199522,
        "uid": 511271,
        "name": "\u30c0\u6708",
        "ccfLevel": 5,
        "title": "\u903c\u6b7b\u5f3a\u8feb\u75c7"
    },
    {
        "content": "## \u524d\u8a00\n\n\u4e00\u9053\u4e0d\u9519\u7684\u77e9\u9635\u4f18\u5316\u9898\u3002\n\n## \u601d\u8def\n\n\u8bbe $f[i]$ \u8868\u793a\u6709 $i$ \u5217\u65f6\u5019\u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u51e0\u79cd\u60c5\u51b5\uff1a\n\n- $i-1$ \u5217\u662f\u5e73\u7684\u3002\n   \n  \u53ef\u4ee5\u76f4\u63a5\u5728\u540e\u9762\u52a0\u4e00\u4e2a\u4e24\u884c\u4e00\u5217\u7684\u74f7\u7816\uff0c\u5373\uff08\u84dd\u8272\u4ee3\u8868\u65b0\u589e\u90e8\u5206\uff09\uff1a\n   \n  ![](https://cdn.luogu.com.cn/upload/image_hosting/k19ffcyf.png)\n   \n  \u8f6c\u79fb\u5f0f\uff1a$f[i]+=f[i-1]$\u3002\n\n- $i-2$ \u5217\u662f\u5e73\u7684\u3002\n\n  \u591a\u4e86\u4e00\u79cd\u65b9\u6cd5\uff1a\u6a2a\u94fa\u3002\u5373\uff1a\n  \n  ![](https://cdn.luogu.com.cn/upload/image_hosting/dvoc6bau.png)\n  \n  \u8f6c\u79fb\u5f0f\uff1a$f[i]+=f[i-2]$\u3002\n  \n- \u653e\u4e86 $1\\times1$ \u7684\u65b9\u5757\uff1a\n\n  \u7a0d\u5fae\u9ebb\u70e6\u4e00\u70b9\u3002\n  \n  \u9996\u5148\uff0c\u65b9\u5757\u53ea\u80fd\u5728 $[1,i-2]$ \u653e\uff0c\u56e0\u4e3a\u5982\u679c\u5728 $i-1$ \u653e\u7684\u8bdd\uff0c\u5b83\u53f3\u9762\u90a3\u4e2a\u683c\u5b50\u4e5f\u53ea\u80fd\u653e $1\\times1$ \u7684\u65b9\u5757\uff0c\u8fde\u8d77\u6765\u4e0d\u7b26\u5408\u9898\u76ee\u8981\u6c42\u3002\u5982\u679c\u4e0d\u653e\u53ea\u80fd\u653e\u5728\u4e0a\u9762\uff0c\u53f3\u9762\u7528 $1\\times2$\uff0c\u4f46\u662f\u548c\u4e0a\u9762\u8fde\u8d77\u6765\u4e5f\u4e0d\u7b26\u5408\u8981\u6c42\u3002\n  \n  \u5176\u6b21\uff0c\u56e0\u4e3a\u8ddd\u79bb\u539f\u56e0\uff0c\u6bcf\u5217\u7684 $1\\times1$ \u65b9\u683c\u53ea\u6709\u4e00\u79cd\u653e\u6cd5\u3002\u5177\u4f53\u539f\u56e0\u53c2\u8003\u4e0b\u56fe\uff1a\n  \n  \u5076\u6570\u5dee\uff08\u4e0d\u540c\u884c\uff09\uff1a\n  \n  ![](https://cdn.luogu.com.cn/upload/image_hosting/j3if31bf.png)\n  \n  \u5947\u6570\u5dee\uff08\u540c\u884c\uff09\uff1a\n  \n  ![](https://cdn.luogu.com.cn/upload/image_hosting/7navddvv.png)\n  \n\u7136\u540e\u4f60\u53c8\u4f1a\u53d1\u73b0\u4e00\u4e2a\u4e8b\u60c5\uff1a\n\n\u524d\u4e24\u79cd\u60c5\u51b5\uff0c$1\\times1$ \u65b9\u683c\u5728\u524d\u9762\uff08\u5df2\u7ecf\u8003\u8651\u8fc7\uff09\uff1b\n\n\u6700\u540e\u4e00\u79cd\u60c5\u51b5\uff0c\u524d\u9762\u6ca1\u6709 $1\\times1$ \u65b9\u683c\uff08\u53ea\u6709\u4e24\u5757\uff09\u3002\n\n\u4e8e\u662f\uff0c\u524d\u9762\u4e24\u79cd\u60c5\u51b5\u76f4\u63a5\u7528 $f$ \u5373\u53ef\uff0c\u6700\u540e\u4e00\u79cd\u8981\u7528\u4e00\u4e2a\u4e0d\u5305\u542b $1\\times1$ \u65b9\u683c\u7684\u65b9\u6848\u6570\uff0c\u6211\u4eec\u5047\u8bbe\u662f $g$\u3002\n\n\u4e8e\u662f\u5c31\u6709\uff1a\n\n$f[i]=f[i-1]+f[i-2]+2\\times\\displaystyle\\sum_{j=1}^{i-3}g[i]$\u3002\n\n\uff08\u4e3a\u4ec0\u4e48\u6709\u4e2a $2$ \u5462\uff0c\u867d\u7136\u53ea\u6709\u4e00\u79cd\u653e\u6cd5\uff08\u540c\u884c\u6216\u4e0d\u540c\u884c\uff09\uff0c\u4f46\u662f\u4f60\u53ef\u4ee5\u9009\u62e9\u7b2c\u4e00\u4e2a $1\\times1$ \u74f7\u7816\u662f\u54ea\u4e00\u884c\u7684\uff09\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(Tn^2)$\n\n\u5b8c\u4e86\u5417\uff1f\u600e\u4e48\u53ef\u80fd\u554a\uff0c\u6570\u636e\u8303\u56f4\u8fd9\u4e48\u5927\u5462\uff08\n\n\u53d1\u73b0 $g$ \u5176\u5b9e\u5c31\u662f\u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff08\u5176\u5b9e $g$ \u5c31\u662f\u4e0d\u8003\u8651\u7b2c\u4e09\u79cd\u60c5\u51b5\u7684 $f$\uff09\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u62ff $g[i-1]-1$ \u4ee3\u66ff $\\displaystyle\\sum_{j=1}^{i-3}g[i]$\uff08\u6590\u6ce2\u90a3\u5951\u6570\u5217\u57fa\u672c\u6027\u8d28\uff09\u3002\n\n\u4e8e\u662f\uff0c\u5f0f\u5b50\u4f18\u5316\u4e3a\uff1a\n\n$f[i]=f[i-1]+f[i-2]+2\\times (g[i-1]-1)$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(Tn)$\u3002\n\n\u7136\u540e\u770b\u4e86\u773c\u6050\u6016\u7684\u8303\u56f4\u2026\u2026\n\n\u60f3\u5230\u4e86\u4ec0\u4e48\uff1f\n\n$O(\\log n)$\n\n\u7136\u540e\u5462\uff1f\n\n\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u3002~~\uff08\u60f3\u4e0d\u5230\u5efa\u8bae\u5148\u591a\u505a\u51e0\u9053\uff09~~\n\n\u6700\u7ec8\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(T\\log n)$\uff0c\u77e9\u9635\u5927\u5c0f $5$\uff0c\u4e58\u6cd5\u5e38\u6570 $5^3=125$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int mod = 1e9 + 7;\ntypedef long long ll;\nint n;\nstruct Matrix\n{\n    ll a[5][5], r, c;\n    inline Matrix()\n    {\n        memset(a, 0, sizeof(a));\n    }\n    inline Matrix(int x, int y)\n    {\n        r = x, c = y;\n        memset(a, 0, sizeof(a));\n    }\n    inline Matrix(int x)\n    {\n        r = c = x;\n        memset(a, 0, sizeof(a));\n        for (int i = 0; i < 5; i++)\n            a[i][i] = 1;\n    }\n    inline Matrix operator*(const Matrix &t) const\n    {\n        Matrix res(r, t.c);\n        for (int i = 0; i < res.r; i++)\n            for (int j = 0; j < res.c; j++)\n                for (int k = 0; k < c; k++)\n                    (res.a[i][j] += a[i][k] * t.a[k][j]) %= mod;\n        return res;\n    }\n    inline Matrix operator^(ll k)\n    {\n        Matrix res(r), base = *this;\n        while (k)\n        {\n            if (k & 1)\n                res = res * base;\n            base = base * base;\n            k >>= 1;\n        }\n        return res;\n    }\n};\nint main()\n{\n    ios::sync_with_stdio(false);\n    cin.tie(nullptr);\n    Matrix A(5, 5);\n    A.a[0][1] = A.a[1][0] = A.a[1][1] = A.a[2][3] = A.a[3][2] = A.a[3][3] = A.a[4][4] = 1;\n    A.a[3][1] = 2;\n    A.a[4][1] = mod - 1;\n    int T;\n    cin >> T;\n    while (T--)\n    {\n        cin >> n;\n        if (n <= 2)\n        {\n            cout << \"0\\n\";\n            continue;\n        }\n        Matrix B(1, 5);\n        B.a[0][2] = 1;\n        B.a[0][3] = B.a[0][4] = 2;\n        Matrix tmp = A ^ (n - 2);\n        B = B * tmp;\n        cout << B.a[0][1] << '\\n';\n    }\n    return 0;\n}\n```",
        "postTime": 1671825742,
        "uid": 576378,
        "name": "creation_hy",
        "ccfLevel": 5,
        "title": "P5303 \u9898\u89e3"
    },
    {
        "content": "\u62ff\u5230\u8fd9\u9898\uff0c\u7b2c\u4e00\u60f3\u6cd5\u662f\u72b6\u538b\uff0c\u7528 $F_{i,j}$ \u8868\u793a\u586b\u6ee1 $2\\times i$ \u7684\u65b9\u683c\u56fe\u7684\u65b9\u6848\u6570\uff0c\u5bf9\u4e8e\u6700\u540e\u4e00\u5217\uff08\u7b2c $i$ \u5217\uff09\uff0c$j=0,1,2,3,4$ \u5206\u522b\u8868\u793a\uff1a\u4e0d\u586b\uff0c\u5de6\u8fb9\u586b\u4e00\u4e2a\uff0c\u53f3\u8fb9\u586b\u4e00\u4e2a\uff0c\u4e24\u8fb9\u5404\u586b\u4e00\u4e2a\uff0c\u7ad6\u7740\u653e\u4e00\u4e2a\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6c42\u51fa\u6ca1\u6709 $1\\times 1$ \u7684\u7816\u5757\u65f6\u586b\u6ee1\u7684\u65b9\u6848\u6570\u4e3a $F_{n,0}+F_{n,4}$\u3002\u90a3\u73b0\u5728\u6709\u5206\u88c2\u7684\u7816\u554a\uff01\u6211\u4eec\u7528 $dp_i$ \u8868\u793a\u5c06\u5176\u4e2d\u4e00\u5757 $1\\times 1$ \u7684\u7816\u653e\u5728\u7b2c $i$ \u5217\uff0c\u53e6\u5916\u4e00\u5757\u653e\u5728 $1\\sim i$ \u5217\u4e4b\u95f4\uff0c\u6070\u597d\u94fa\u6ee1 $2\\times i$ \u7684\u533a\u57df\u7684\u65b9\u6848\u6570\u3002\u6211\u4eec\u53d1\u73b0 $dp_{i-1}$ \u5df2\u7ecf\u5e2e $dp_i$ \u505a\u4e86\u5f88\u5927\u4e00\u90e8\u5206\u5de5\u4f5c\uff0c\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8003\u8651\u5982\u4f55\u8f6c\u79fb\u3002\\\n![\u56fe\u7247.png](https://i.loli.net/2021/02/03/ewb9IZgyvz2OScH.png)\\\n\u6211\u4eec\u53d1\u73b0\u5f53 $i-1$ \u65f6\u586b\u4e0a\u68d5\u8272\u90a3\u5757\u65f6\uff0c\u2460\u2461\u2462\u4e09\u4e2a\u5757\u5757\u6211\u4eec\u662f\u4e0d\u4f1a\u9009\u62e9\u53bb\u7528\u53e6\u4e00\u4e2a $1\\times 1$ \u586b\u5b83\u7684\uff1b\u90a3 $i$ \u65f6\u662f\u5426\u53ef\u4ee5\u586b\u5462\uff1f\u6211\u4eec\u53d1\u73b0 $i$ \u65f6\u2461\u5757\u662f\u53ef\u4ee5\u586b\u7684\uff0c\u586b\u4e0a\u540e\u589e\u52a0\u7684\u65b9\u6848\u6570\u4e3a $F_{i-3,0}+F_{i-3,4}$\u3002\u56e0\u6b64\u8f6c\u79fb\u65b9\u7a0b\u4e3a\n$dp_{i}=dp_{i-1}+2(F_{n,0}+F_{n,4})$\uff08\u4e582\u662f\u56e0\u4e3a\u7ffb\u8fc7\u6765\u53c8\u6709\u4e00\u79cd\u60c5\u51b5\uff09\u3002\u591a\u5634\u4e00\u4e0b\uff0c\u521d\u59cb\u6709 $dp_1=dp_2=0,dp_3=2,G_0=1$\u3002\u6211\u4eec\u5947\u5999\u5730\u53d1\u73b0\uff0c$F_{n,0}+F_{n,4}=fib_{n+1}$\uff0c\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff01\u800c\u6839\u636e\u7ec4\u5408\u6570\u5b66\uff0c\u6211\u4eec\u6700\u7ec8\u7684\u7b54\u6848\u5e94\u8be5\u662f $\\sum _{i=1}^n dp_i\\times (F_{n-i,0}+F_{n-i,4})$\u3002\u4ee3\u78011\uff1a\uff08\u7528\u7684\u662f\u72b6\u538b\u6c42 $F_0+F_4$\uff09\n[link](https://paste.ubuntu.com/p/jX33D6bCn6/)\nResult: 50pts, TLE/RE.\n\n\u7136\u540e\u6211\u4eec\u628a $G_i=fib_{i+1}$ \u4ee3\u5165\u5f97\u5230\u4e86\u66f4\u7cdf\u7684\u7ed3\u679c\uff0820pts+3TLE+4RE\uff09\uff0c\u8fd9\u91cc\u4e0d\u5c55\u793a\u4ee3\u7801\u4e86\u3002\n\n\u7b2c\u4e8c\u6b65\uff0c\n$$dp_n=dp_{n-1}+2fib_{n-2}=dp_{n-2}+2fib_{n-3}+2fib_{n-2}=\\cdots=2\\sum_{i=1}^{n-2}fib_i=2(fib_n-1)$$\n$$ ans=\\sum _{i=1}^n dp_i\\times fib_{n-i+1}=2 \\sum_{i=1}^n (fib_i-1)\\times fib_{n-i+1}=2\\cdot(1+\\sum_{i=1}^n fib_i\\times fib_{n-i+1}-\\sum_{i=1}^n fib_{n-i+1})=2\\cdot(1-fib_{n+2}+\\sum_{i=1}^n fib_i\\times fib_{n-i+1})$$\n\u4ee3\u78012\uff1a[link](https://paste.ubuntu.com/p/2RbWR9cyDj/)\n\n\u7b2c\u4e09\u6b65\uff0c\n\u4ee4 $G_i=\\sum_{i=1}^n fib_i\\times fib_{n-i+1}$\uff0c\u5219 $G_i=\\sum_{i=1}^n fib_i\\times fib_{n-i+1}=fib_n+\\sum_{i=1}^{n-1} fib_i\\times (fib_{n-i}+fib_{n-i+1}-fib_{n-i})=fib_n+\\sum_{i=1}^{n-1} fib_i\\times (fib_{n-i}+fib_{n-i-1})=fib_n+\\sum_{i=1}^{n-1} fib_i\\times fib_{n-i}+\\sum_{i=1}^{n-2}fib_{(n-2)-i+1}=G_{n-1}+G_{n-2}+fib_n$\u3002\u771f\u662f\u6709\u79cd\u62e8\u4e91\u89c1\u65e5\u7684\u611f\u89c9\uff01\n\n\u6709\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u5f0f\uff0c\u5f97\u5230\u77e9\u9635\u7684\u8f6c\u79fb\u5f0f\uff1a\n$$\\begin{bmatrix}fib_{n-1} fib_n G_{n-1} G_n\\end{bmatrix}$$\n$$\\times \\begin{bmatrix}0&1&0&1\\\\1&1&0&1\\\\0&0&0&1\\\\0&0&1&1\\end{bmatrix}$$\n$$=\\begin{bmatrix}fib_n fib_{n+1} G_n G_{n+1}\\end{bmatrix}$$\n\n\u4ee3\u78013(Final)\uff1a\uff08\u590d\u6742\u5ea6 $O(4^3\\log n)$\uff09\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int Mod=1e9+7;\nvoid mul(int a[4],int b[4][4]){\n    int c[4]; memset(c,0ll,sizeof(c));\n    for(int i=0;i<4;i++)\n        for(int j=0;j<4;j++)\n            c[i]=(c[i]+a[j]*b[j][i]%Mod)%Mod;\n    memcpy(a,c,sizeof(c));\n}\nvoid mulself(int a[4][4]){\n    int c[4][4]; memset(c,0ll,sizeof(c));\n    for(int i=0;i<4;i++)\n        for(int j=0;j<4;j++)\n            for(int k=0;k<4;k++)\n                c[i][j]=(c[i][j]+a[i][k]*a[k][j]%Mod)%Mod;\n    memcpy(a,c,sizeof(c));\n}\nvoid PowerMod(int b){\n    int ans[4]={0,1,0,1};\n    int a[4][4]={{0,1,0,1},{1,1,0,1},{0,0,0,1},{0,0,1,1}};\n    while(b){\n        if(b%2ll) mul(ans,a);\n        b/=2ll,mulself(a);\n    }\n    int Ans=2ll*((ans[3]+Mod-(ans[0]+ans[1]*2ll%Mod)%Mod+1ll)%Mod)%Mod;\n    //\u4e00\u5b9a\u6ce8\u610f\u8fd9\u91cc\u7684\"+Mod\"\uff0c\u56e0\u4e3aans[3]\u548c\u540e\u9762\u90a3\u5806\u90fd\u662f%\u8fc7Mod\u7684\uff0c\u4f5c\u5dee\u540e\u4e0d\u518d\u4e00\u5b9a\u4e3a\u6b63\u6570\n\tcout<<Ans<<endl;\n}\nvoid solve()\n{\n\tint n;\n\tcin>>n;\n\tif(n<3){\n\t\tcout<<0<<endl; return;\n\t}\n\tPowerMod(n-1);\n}\nsigned main(){\n\tint T; cin>>T;\n\twhile(T--) solve();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1612351535,
        "uid": 300078,
        "name": "pengyule",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u6570\u5b66\u5fc5\u4fee\u4e94\u7684\u597d\u9898\uff08\n\n\u5927\u5bb6\u90fd\u662f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u505a\u7684\uff0c\u8fd9\u91cc\u6709\u4e00\u79cd\u6bd4\u8f83\u6e05\u771f\u800c\u7eaf\u7cb9\u7684\u6570\u5b66\u505a\u6cd5\u3002\n\n---\n\n\u9996\u5148\uff0c\u6211\u4eec\u77e5\u9053\uff0c**\u7528$2*1$\u7684\u9aa8\u724c\u8d34\u6ee1$2*N$\u7684\u65b9\u683c\uff0c\u65b9\u6848\u6570\u662f$fib_{N+1}$** ,\u5176\u4e2d$fib$\u8868\u793a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u7531\u6bd4\u8f83\u76f8\u5e94\u7684\u9012\u63a8\u5f0f\u5f97\u5230\u3002\n\n----\n\n\u82e5\u6211\u4eec\u5728\u7b2c$i$\u5217\u653e\u4e86\u4e00\u4e2a$1*1$\u7684\u65b9\u5757\uff0c\u6211\u4eec\u679a\u4e3e\u53e6\u4e00\u4e2a$1*1$\u65b9\u5757\u653e\u5728$j$\u5904\u3002\u5bb9\u6613\u53d1\u73b0\uff1a(\u4e0d\u59a8\u8bbe$j>i$)\n\n- $j\\ge i+2$(\u5426\u5219\u4e0d\u5408\u6cd5)\n\n- \u5f53$j-i\\equiv 0 \\mod2$\u65f6\uff0c$j$\u9700\u8981\u548c$i$\u653e\u5728\u4e0d\u540c\u884c\uff1b\u53cd\u4e4b\u5e94\u8be5\u653e\u5728\u540c\u4e00\u884c\u3002(\u5426\u5219$[i,j]$\u4e4b\u95f4\u6ca1\u6709\u65b9\u6848)\n\n- $[i,j]$\u7684\u5217\u4e4b\u95f4\u6709\u552f\u4e00\u7684\u8d34\u74f7\u7816\u65b9\u6cd5\uff0c$i$\u5de6\u4fa7\uff0c$j$\u53f3\u4fa7\u65b9\u6848\u72ec\u7acb\uff0c\u5373\u201c\u7528$2*1$\u7684\u9aa8\u724c\u8d34\u6ee1$2*N$\u7684\u65b9\u683c\u201d\u7684\u60c5\u51b5\uff0c\u5206\u522b\u662f$fib_i$\u548c$fib_{n-j+1}$.\n\n\u6211\u4eec\u7acb\u523b\u5f97\u5230\uff1a\n\n$$ans=2\\sum\\limits_{i=1}^{n-2}fib_i\\sum\\limits_{j=1}^{n-i-1}fib_j$$\n\n\u770b\u4f5c\u662f\u679a\u4e3e\u4e24\u4e2a\u7279\u6b8a\u74f7\u7816\u94fa\u5728\u54ea\u4e24\u5217\uff08\u5f53\u7136\u6ce8\u610f\u884c\u4e0a\u7684\u60c5\u51b5\u6709\u4e24\u79cd\uff0c\u6240\u4ee5\u6700\u540e\u7b54\u6848\u8981*2\uff09\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5$O(T*n)$\u5f9750\u5206\u4e86\u3002\n\n\u6211\u4eec\u5229\u7528\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u6027\u8d28\u7ee7\u7eed\u5f80\u4e0b\u63a8\uff1a\n\n$$\\sum_{i=1}^n fib_{i}=fib_{n+2}-1$$\n$$fib_i=\\frac{1}{\\sqrt{5}}((\\frac{1+\\sqrt{5}}{2})^i-(\\frac{1-\\sqrt{5}}{2})^i)$$\n\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\uff0c\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u7528\u751f\u6210\u51fd\u6570/\u5f85\u5b9a\u7cfb\u6570\u7b49\u4e00\u4e9b\u5217\u65b9\u6cd5\u8bc1\u660e\uff08\u4f60\u53ef\u4ee5\u7528\u641c\u7d22\u5f15\u64ce\u641c\u7d22\u4e00\u4e0b\u8fd9\u4e24\u4e2a\u6027\u8d28\uff09\u3002\n\n\u628a\u8fd9\u4e24\u4e2a\u5f0f\u5b50\u66b4\u529b\u5e26\u8fdb\u53bb\uff0c\u53d1\u73b0\u7b54\u6848\u4ec5\u4ec5\u662f\u7531**\u7b49\u6bd4\u6570\u5217\u6c42\u548c** \u548c **\u5e38\u6570\u9879** \u7684\u5f62\u5f0f\u7ec4\u6210\u3002\u4f7f\u7528**\u62d3\u57df**\uff0c\u7528$a+b\\sqrt{5}$\u8868\u793a\u4e00\u4e2a\u6570\uff0c\u5b9e\u73b0\u57fa\u672c\u8fd0\u7b97\u5373\u53ef\uff08\u8fd9\u662f\u56e0\u4e3a5\u5728\u6a21\u610f\u4e49\u4e0b\u6ca1\u6709\u4e8c\u6b21\u5269\u4f59\uff09\u3002$O(T\\log n)$\n\n```cpp\n#include <iostream>\nusing namespace std;\n\nconst int mod = 1e9 + 7;\ntypedef long long i64;\n\ni64 qpow(i64 x , i64 y = mod - 2) {\n    i64 z = 1;\n    for( ; y ; y >>= 1 , x = x * x % mod) if(y & 1) z = z * x % mod;\n    return z;\n}\n\ntemplate<int T> struct Comp {\n    int x , y;\n    Comp(int x = 0, int y = 0) : x(x) , y(y) {}\n};\n\ntemplate<int T> Comp<T> operator+ (Comp<T> a , Comp<T> b) {return Comp<T>((a.x+b.x)%mod , (a.y+b.y)% mod);}\ntemplate<int T> Comp<T> operator- (Comp<T> a , Comp<T> b) {return Comp<T>((a.x-b.x+mod)%mod , (a.y-b.y+mod)%mod);}\ntemplate<int T> Comp<T> operator* (Comp<T> a , Comp<T> b) {return Comp<T>((1ll*a.x*b.x+1ll*T*a.y%mod*b.y)%mod , (1ll*a.x*b.y+1ll*a.y*b.x)%mod);}\ntemplate<int T> Comp<T> operator* (Comp<T> a , i64 b) {return Comp<T>(a.x*b%mod ,a.y*b%mod);}\ntemplate<int T> Comp<T> operator~ (Comp<T> a) {return Comp<T>(a.x , (mod-a.y)%mod) * qpow(((1ll*a.x*a.x-1ll*T*a.y%mod*a.y)%mod+mod)%mod); }\ntemplate<int T> Comp<T> operator/ (Comp<T> a , Comp<T> b) {return a*(~b);}\ntemplate<int T> Comp<T> operator^ (Comp<T> a , i64 b) {\n    Comp<T> x(1);\n    for( ; b ; b >>= 1 , a = a * a) if(b & 1) x = x * a;\n    return x;\n}\ntemplate<int T> bool operator== (Comp<T> a , Comp<T> b) {return a.x==b.x&&a.y==b.y;}\ntemplate<int T> Comp<T> sum(Comp<T> a1 , Comp<T> q , i64 n) {\n\tComp<T> _1(1);\n    if(q == _1) return a1 * n;\n    return a1 * (_1 - (q^n)) / (_1 - q);\n}\n\nconst int Inv2 = mod - mod/2 , T = 800000006;\nconst Comp<5> a(Inv2 , Inv2) , b(Inv2 , mod - Inv2);\nconst Comp<5> ab = a/b , ba = b/a;\n\nint solve(int n) {\n    if(n < 3) return 0;\n    Comp<5> an1 = a^(n+1) , bn1 = b^(n+1);\n    return (((an1+bn1)*(n-2)-bn1*sum(ab,ab,n-2)-an1*sum(ba,ba,n-2))*T\n            - (sum(a,a,n-2)-sum(b,b,n-2))*Comp<5>(0,T)).x;\n}\n\nint main() {\n    int t , n;\n    for(cin >> t ; t ; t--) cin >> n , cout << solve(n) << endl;\n}\n```",
        "postTime": 1591521388,
        "uid": 138511,
        "name": "GreenDay",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5303 \u3010[GXOI/GZOI2019]\u903c\u6b7b\u5f3a\u8feb\u75c7\u3011"
    }
]