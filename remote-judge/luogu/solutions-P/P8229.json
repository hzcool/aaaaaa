[
    {
        "content": "## \u601d\u8def\n\n\u8003\u8651 dp\u3002\u8bbe $r_i$ \u8868\u793a $i$ \u6b21\u4e4b\u540e\u671f\u671b\u5269\u591a\u5c11\u3002\u8bbe $f_i$ \u8868\u793a $i$ \u6b21\u4e4b\u540e\u671f\u671b\u5403\u4e86\u591a\u5c11\u3002\n$$\n\\begin{cases}\nr_i=r_{i-1}\\times kp+1-p\\\\\nf_i=f_{i-1}+r_{i-1}\\times(1-p)\n\\end{cases}\n$$\n\u89e3\u91ca\u4e00\u4e0b\uff1a\u6bcf\u6b21\u6709 $p$ \u7684\u6982\u7387\u5c06 $r_{i-1}$ \u7684 $k$ \u500d\u8d21\u732e\u7ed9 $r_i$\uff0c\u6709 $1-p$ \u7684\u6982\u7387\u5427 $r_{i-1}$ \u8d21\u732e\u7ed9 $f_i$ \u5e76\u5427 $1$ \u8d21\u732e\u7ed9 $r_i$\u3002\u6240\u4ee5\u957f\u9171\u7d2b\u3002\n\n\u76f4\u63a5\u77e9\u9635\u52a0\u901f\u3002\n\n## code\n\n```cpp\n#include<stdio.h>\n#define mod 998244353\n#define int long long\ninline char nc()\n{\n\tstatic char buf[99999],*l,*r;\n\treturn l==r&&(r=(l=buf)+fread(buf,1,99999,stdin),l==r)?EOF:*l++;\n}\ninline void read(int&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\nint t,n,k,p;\nstruct __readt__{inline __readt__(){read(t);}}_readt___;\nstruct matrix\n{\n\tint a[3][3];\n\tinline void reset(){for(int i=0;i<3;++i)for(int j=0;j<3;a[i][j++]=0);}\n\tinline void operator*=(const matrix&kkk)\n\t{\n\t\tint ans0=a[0][0]*kkk.a[0][0]+a[0][1]*kkk.a[1][0]+a[0][2]*kkk.a[2][0];\n\t\tint ans1=a[0][0]*kkk.a[0][1]+a[0][1]*kkk.a[1][1]+a[0][2]*kkk.a[2][1];\n\t\tint ans2=a[0][0]*kkk.a[0][2]+a[0][1]*kkk.a[1][2]+a[0][2]*kkk.a[2][2];\n\t\tint ans3=a[1][0]*kkk.a[0][0]+a[1][1]*kkk.a[1][0]+a[1][2]*kkk.a[2][0];\n\t\tint ans4=a[1][0]*kkk.a[0][1]+a[1][1]*kkk.a[1][1]+a[1][2]*kkk.a[2][1];\n\t\tint ans5=a[1][0]*kkk.a[0][2]+a[1][1]*kkk.a[1][2]+a[1][2]*kkk.a[2][2];\n\t\tint ans6=a[2][0]*kkk.a[0][0]+a[2][1]*kkk.a[1][0]+a[2][2]*kkk.a[2][0];\n\t\tint ans7=a[2][0]*kkk.a[0][1]+a[2][1]*kkk.a[1][1]+a[2][2]*kkk.a[2][1];\n\t\tint ans8=a[2][0]*kkk.a[0][2]+a[2][1]*kkk.a[1][2]+a[2][2]*kkk.a[2][2];\n\t\ta[0][0]=ans0%mod;a[0][1]=ans1%mod;a[0][2]=ans2%mod;\n\t\ta[1][0]=ans3%mod;a[1][1]=ans4%mod;a[1][2]=ans5%mod;\n\t\ta[2][0]=ans6%mod;a[2][1]=ans7%mod;a[2][2]=ans8%mod;\n\t}\n}a,ans;\nmain()\n{\n\tread(n);read(k);read(p);ans.reset();a.reset();\n\tans.a[0][1]=ans.a[0][2]=1;\n\ta.a[0][0]=a.a[2][2]=1;\n\ta.a[1][0]=a.a[2][1]=1+mod-p;\n\ta.a[1][1]=k*p%mod;\n\tfor(;n;n>>=1,a*=a)if(n&1)ans*=a;\n\tprintf(\"%lld\\n\",ans.a[0][0]);\n\tif(--t)main();\n}\n/*    F   R   1\n *f   1   0   0\n *r  1-p  kp  0\n *1   0  1-p  1\n */\n```\n\n",
        "postTime": 1667915271,
        "uid": 90693,
        "name": "_\u2022\u0301\u3078\u2022\u0301\u256c_",
        "ccfLevel": 7,
        "title": "P8229 [AGM 2022 \u8d44\u683c\u8d5b] \u629b\u786c\u5e01"
    },
    {
        "content": "[2022.3.31] \u66f4\u6b63\u4e86\u4e00\u4e9b\u516c\u5f0f\u9519\u8bef\u3002\n\n[2022.10.11] \u56de\u6765\u4fee\u9505+\u7b80\u5316\u9898\u89e3\u3002\n\n[2023.1.14] \u4fee\u590d\u90e8\u5206\u4ee3\u7801\u9519\u8bef\u3002\n\n### \u9898\u610f\u7b80\u8ff0\n\n$x$ \u521d\u59cb\u4e3a $1$\u3002\u4e00\u6b21\u64cd\u4f5c\u540e $x$ \u6709 $P_1$ \u7684\u6982\u7387\u4e58\u4e0a $k$\uff1b\u5426\u5219\u6709 $x$ \u7684\u8d21\u732e\uff0c\u518d\u8ba9 $x=1$\u3002\u6c42\u671f\u671b\u8d21\u732e\u503c\u3002\n\n### \u601d\u8def\n\n\u5bf9\u4e8e\u6bcf\u6b21\u64cd\u4f5c\uff0c$x$ \u7684\u8d21\u732e\u4e3a $xP_2$\uff0c\u5176\u4e2d $P_2$ \u8868\u793a\u53d8\u6210 $1$ \u7684\u6982\u7387\u3002\u521d\u59cb\u65f6 $x=1$\uff0c\u4e00\u6b21\u64cd\u4f5c\u540e\uff0c$x=kP_1+P_2$\u3002\n\n***\n\n\u7531\u4e8e $x$ \u662f\u7531\u81ea\u8eab\u8f6c\u79fb\u800c\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u5217\u51fa\u9012\u63a8\u5f0f\uff1a\n\n$$\nx_i=kP_1\\times x_{i-1}+P_2\n$$\n\n\u4ee4 $a=kP_1$\uff0c\u5c06\u9012\u63a8\u5f0f\u5316\u7b80\uff1a\n\n$$\nx_i=a^i+P_2\\sum_{j=0}^{i-1}a^j\n$$\n$$\n\\left\\{\n\\begin{aligned}\n& x_i=a^i+\\frac{a^i-1}{a-1}P_2,&a\\neq1 \\\\\n& x_i=1+iP_2,&a=1\n\\end{aligned}\n\\right.\n$$\n\n***\n\n\u6211\u4eec\u8fd8\u8981\u60f3\u529e\u6cd5\u5c06\u8fd9\u4e2a $n$ \u7684\u590d\u6742\u5ea6\u7ed9\u5316\u6389\u3002\n\n\u5c06 $x$ \u4ee3\u5165\uff0c\u6211\u4eec\u8981\u6c42\u7684\u4fbf\u662f\uff1a\n\n$$\n\\left\\{\n\\begin{aligned}\n& P_2(\\sum_{i=1}^na^{i-1}+\\frac{a^{i-1}-1}{a-1}P_2),& a\\neq1\\\\\n& P_2(\\sum_{i=1}^n1+(i-1)P_2),& a=1\n\\end{aligned}\n\\right.\n$$\n\n\u6ce8\u610f\u662f $i-1$ \u4e0d\u662f $i$\uff0c\u6b64\u5904 $x_0=1$\u3002\n\n***\n\n\u5f53 $a\\neq1$ \u65f6\uff1a\n\n$$\nP_2(\\sum_{i=0}^{n-1}a^i+P_2\\sum_{i=0}^{n-1}\\frac{a^i-1}{a-1})\n$$\n$$\nP_2(\\sum_{i=0}^{n-1}a^i+P_2\\frac{\\sum_{i=0}^{n-1}a^i-n}{a-1})\n$$\n\n\u4ee4 $S_n=\\sum_{i=0}^{n-1}a^i=\\frac{a^n-1}{a-1}$\uff0c\n\n$$\nP_2(S_n+P_2\\frac{S_n-n}{a-1})\n$$\n\n***\n\n\u518d\u770b $a=1$ \u7684\u60c5\u51b5\uff1a\n$$\nP_2\\sum_{i=1}^n(1+(i-1)\\times P_2)\n$$\n$$\nP_2(n+P_2\\sum_{i=0}^{n-1}i)\n$$\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u7b54\u6848 $Ans$\uff1a\n$$\n\\left\\{\n\\begin{aligned}\n& Ans=P_2(S_n+P_2\\frac{S_n-n}{a-1}),& a\\neq1\\\\\n& Ans=P_2(n+P_2\\sum_{i=0}^{n-1}i),& a=1\n\\end{aligned}\n\\right.\n$$\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(T\\log n)$\u3002\n\n### \u4ee3\u7801\n\n\u9047\u4e0a\u5927\u6570\u4e58\u9664\u6a21\u603b\u62c5\u5fc3\u7206\u7cbe\u5ea6\uff0c\u6240\u4ee5\u8bb0\u5f97\u52e4\u53d6\u6a21\u3002\u8fd8\u8981\u8bb0\u5f97\u5224\u65ad\u8d1f\u6570\u53d6\u6a21\u7684\u60c5\u51b5\u3002\n\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=998244353;\nint t,n,k,p1,p2,ans;\nint ksm(int x,int y)\n{\n\tint res=1;\n\twhile(y)\n\t{\n\t\tif(y&1) res=res*x%mod;\n\t\tx=x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn res;\n}\nsigned main()\n{\n\tscanf(\"%lld\",&t);\n\twhile(t--)\n\t{\n\t\tscanf(\"%lld%lld%lld\",&n,&k,&p1);\n\t\tp2=(1-p1+mod)%mod;\n\t\tint a=k*p1%mod,inv=ksm((a-1+mod)%mod,mod-2),Sn=(ksm(a,n)-1+mod)*inv%mod;\n        n%=mod;\n\t\tif(a==1) ans=(n*p2%mod+n*(n-1)/2%mod*p2%mod*p2%mod)%mod;\n\t\telse ans=(Sn+p2*(Sn-n+mod)%mod*inv%mod)%mod*p2%mod;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\n***\n\n\u5b8c\u7ed3\u6492\u82b1owo\u3002",
        "postTime": 1648474147,
        "uid": 485780,
        "name": "Perta",
        "ccfLevel": 7,
        "title": "P8229 [AGM 2022 \u8d44\u683c\u8d5b] \u629b\u786c\u5e01"
    },
    {
        "content": "[Link](https://www.luogu.com.cn/problem/P8229)\n\n\u76f4\u63a5\u63a8\u5f0f\u5b50\u3002\n\n\u679a\u4e3e\u7b2c\u4e00\u6b21\u786c\u5e01\u53cd\u9762\u671d\u4e0b\u7684\u4f4d\u7f6e\u3002\n\n$$\\begin{aligned}\nE(n)&=\\sum_{i=0}^{n-1} p^i(1-p)(k^i+E(n-i-1)) \\\\\n\t\t&=\\sum_{i=0}^{n-1} (pk)^i(1-p)+\\sum_{i=0}^{n-1} p^i(1-p)E(n-i-1)\\\\\n\\end{aligned}$$\n\n\u4ee4 $f(n)=\\sum\\limits_{i=0}^{n-1} (pk)^i(1-p),g(n)=\\sum\\limits_{i=0}^{n-1} p^i(1-p)E(n-i-1)$\n\n\u53ef\u5f97\uff1a\n\n$$\\begin{aligned}f(n)&=p\\cdot k\\cdot f(n-1)+(1-p)\\\\\ng(n)&=(1-p)f(n-1)+g(n-1)\\end{aligned}$$\n\n\u7136\u540e\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u77e9\u9635\u52a0\u901f\u3002\u590d\u6742\u5ea6 $\\mathcal O(\\log n)$\u3002\u53ef\u80fd\u9700\u8981\u5361\u5e38\u3002\n\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n#define getchar getchar_unlocked\nstruct Ios{}io;\ntemplate <typename _tp>\nIos &operator >>(Ios &in,_tp &x){\n    x=0;int w=0;char c=getchar();\n    for(;!isdigit(c);w|=c=='-',c=getchar());\n    for(;isdigit(c);x=x*10+(c^'0'),c=getchar());\n    if(w) x=-x;\n    return in;\n}\ntypedef long long ll;\nconst int mod=998244353;\nstruct Matrix{\n    int a[4][4];\n    void clear(){\n        a[1][1]=0;a[1][2]=0;a[1][3]=0;\n        a[2][1]=0;a[2][2]=0;a[2][3]=0;\n        a[3][1]=0;a[3][2]=0;a[3][3]=0;\n    }\n    void init(){\n        a[1][1]=1;a[1][2]=0;a[1][3]=0;\n        a[2][1]=0;a[2][2]=1;a[2][3]=0;\n        a[3][1]=0;a[3][2]=0;a[3][3]=1;\n    }\n};\nMatrix operator *(Matrix a,Matrix b){\n    Matrix ans;ans.clear();\n    ans.a[1][1]=(1ll*a.a[1][1]*b.a[1][1]+1ll*a.a[1][2]*b.a[2][1]+1ll*a.a[1][3]*b.a[3][1])%mod;\n    ans.a[1][2]=(1ll*a.a[1][1]*b.a[1][2]+1ll*a.a[1][2]*b.a[2][2]+1ll*a.a[1][3]*b.a[3][2])%mod;\n    ans.a[1][3]=(1ll*a.a[1][1]*b.a[1][3]+1ll*a.a[1][2]*b.a[2][3]+1ll*a.a[1][3]*b.a[3][3])%mod;\n    ans.a[2][1]=(1ll*a.a[2][1]*b.a[1][1]+1ll*a.a[2][2]*b.a[2][1]+1ll*a.a[2][3]*b.a[3][1])%mod;\n    ans.a[2][2]=(1ll*a.a[2][1]*b.a[1][2]+1ll*a.a[2][2]*b.a[2][2]+1ll*a.a[2][3]*b.a[3][2])%mod;\n    ans.a[2][3]=(1ll*a.a[2][1]*b.a[1][3]+1ll*a.a[2][2]*b.a[2][3]+1ll*a.a[2][3]*b.a[3][3])%mod;\n    ans.a[3][1]=(1ll*a.a[3][1]*b.a[1][1]+1ll*a.a[3][2]*b.a[2][1]+1ll*a.a[3][3]*b.a[3][1])%mod;\n    ans.a[3][2]=(1ll*a.a[3][1]*b.a[1][2]+1ll*a.a[3][2]*b.a[2][2]+1ll*a.a[3][3]*b.a[3][2])%mod;\n    ans.a[3][3]=(1ll*a.a[3][1]*b.a[1][3]+1ll*a.a[3][2]*b.a[2][3]+1ll*a.a[3][3]*b.a[3][3])%mod;\n    return ans;\n}\nMatrix ans;\nint main(){\n    int T;io>>T;\n    while(T--){\n        ll n,k,p;io>>n>>k>>p;\n        ans.init();\n        Matrix tmp;tmp.clear();\n        tmp.a[1][1]=p*k%mod;tmp.a[1][2]=(1-p+mod)%mod;\n        tmp.a[2][2]=1;\n        tmp.a[3][1]=(1-p+mod)%mod;tmp.a[3][3]=1;\n        while(n){\n            if(n&1) ans=ans*tmp;\n            n>>=1;tmp=tmp*tmp;\n        }\n        Matrix x;x.clear();\n        x.a[1][3]=1;\n        ans=x*ans;\n        printf(\"%d\\n\",(ans.a[1][1]+ans.a[1][2])%mod);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1667958803,
        "uid": 206875,
        "name": "pref_ctrl27",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011P8229 [AGM 2022 \u8d44\u683c\u8d5b] \u629b\u786c\u5e01"
    },
    {
        "content": "\u9996\u5148\u6211\u4eec\u8bbe $f_i$ \u4e3a\u629b\u4e86 $i$ \u6b21\u786c\u5e01\u671f\u671b\u5403\u5230\u591a\u5c11\u9897\u8349\u8393\uff0c\u5219\u663e\u7136\u6709\u8f6c\u79fb\u65b9\u7a0b\u5f0f\uff1a\n\n$$f_i=\\sum_{j=0}^{i-1}\\left(f_j+(1-p)\\times p^{i-j-1}\\times k^{i-j-1}\\right)$$\n\n\u5316\u7b80\u5f97\uff1a\n\n$$f_i=(1-p)\\times \\left(\\sum_{j=0}^{i-1} f_jp^{i-j-1}+\\sum_{j=0}^{i-1}(kp)^j\\right)$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u8fd8\u662f\u4e0d\u597d\u770b\u51fa\u89c4\u5f8b\uff0c\u4e14\u66b4\u529b\u7b97\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7ea7\u522b\u7684\u3002\n\n\u96be\u9053\u771f\u7684\u5c31\u675f\u624b\u65e0\u7b56\u4e86\u5417\uff1f\n\n\u4e0d\u662f\u7684\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\u7684\u662f\u53f3\u8fb9\u7684\u5f0f\u5b50\uff0c\u5982\u679c\u6211\u4eec\u80fd\u77e5\u9053\u6bcf\u4e2a\u53f3\u5f0f\u7684\u8d21\u732e\u7cfb\u6570\uff0c\u518d\u627e\u51fa\u89c4\u5f8b\u6765\uff0c\u90a3\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u8bbe $w_i=\\sum\\limits_{j=0}^{i-1}(kp)^j$\u3002\n\n\u90a3\u4e48 $f_i$ \u7684\u8f6c\u79fb\u7cfb\u6570\u5c31\u662f $1-p$\uff0c$f_{i+1}$ \u662f $(1-p)(1-p)=(1-p)^2$\uff0c$f_{i+2}=(1-p)((1-p)^2+(1-p)p)=(1-p)^2$\u2026\u2026\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u9664 $f_{i}$ \u7684\u8f6c\u79fb\u7cfb\u6570\u662f $1-p$ \u4e4b\u5916\uff0c\u5176\u4f59\u7684\u8f6c\u79fb\u7cfb\u6570\u90fd\u662f $(1-p)^2$\uff0c\u8bc1\u660e\u4e5f\u5f88\u597d\u8bc1\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u51fa $f_n$ \u7684\u901a\u9879\u516c\u5f0f\u4e86\uff1a\n\n$$f_n=(1-p)^2\\sum_{j=1}^{i-1}\\sum_{l=0}^{j-1}(kp)^l+(1-p)\\sum_{j=0}^{i-1}(kp)^j$$\n\n\u5728\u5c0f\u5b66\u5965\u6570\u91cc\uff0c\u6211\u4eec\u6709\u8fd9\u6837\u4e00\u4e2a\u516c\u5f0f\uff1a\n\n$$\\sum_{i=0}^nx^i=\\dfrac{x^{n+1}-1}{x-1}\\quad(x\\ne1)$$\n\n\u5bf9\u4e8e $kp=1$ \u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u76f4\u63a5\u7b97\u3002\n\n\u800c\u5bf9\u4e8e $kp\\ne 1$ \u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u5957\u7528\u8fd9\u4e2a\u516c\u5f0f\u53ea\u80fd\u89e3\u51b3\u53f3\u5f0f\uff0c\u5bf9\u4e8e\u5de6\u5f0f\uff0c\u6211\u4eec\u7a0d\u5fae\u53d8\u4e00\u4e0b\u5f62\u5c31\u53ef\u4ee5\u5f97\u5230\u53e6\u4e00\u4e2a\u7c7b\u578b\u7684\u5f0f\u5b50\uff1a\n\n$$\\sum_{i=0}^n x^i(n-i)$$\n\n\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5c0f\u5b66\u5965\u6570\u7684\u65b9\u6cd5\u89e3\u51b3\u3002\n\n\u8bbe $ans=\\sum\\limits_{i=0}^nx^i(n-i),x\\times ans=\\sum\\limits_{i=1}^{n+1}x^i(n-i+1)$\u3002\n\n\u4e24\u5f0f\u76f8\u51cf\uff0c\u53ef\u5f97\uff1a\n\n$$(x-1)ans=\\sum_{i=1}^{n+1}x^i-n+1=\\sum_{i=0}^{n+1}x^i-n$$\n\n$$ans=\\dfrac{\\sum\\limits_{i=0}^{n+1}x^i-n}{x-1}$$\n\n\u7167\u846b\u82a6\u753b\u74e2\uff0c\u6211\u4eec\u53ef\u5f97\u5168\u65b0\u7684 $f_n$ \u7684\u901a\u9879\u516c\u5f0f\uff1a\n\n$$f_n=(1-p)^2\\dfrac{\\sum\\limits_{i=0}^{n-1}(kp)^i-n}{kp-1}+(1-p)\\sum_{i=0}^{n-1}(kp)^i$$\n\n\u7136\u540e\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(T(\\log n+\\log\\bmod))$",
        "postTime": 1648571876,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8229"
    }
]