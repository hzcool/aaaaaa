[
    {
        "content": "- \u539f\u7248 : [P5617 [MtOI2019]\u4e0d\u53ef\u89c6\u5883\u754c\u7ebf](https://www.luogu.com.cn/problem/P5617)\n\n\u5efa\u8bae\u53bb\u770b\u770b\u6211\u7684\u9898\u89e3,\u53ef\u4ee5\u5e2e\u52a9\u7406\u89e3\u672c\u6587\u3002\u5173\u4e8e\u9762\u79ef\u8ba1\u7b97\u548c\u9884\u5904\u7406\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002\n\n\u9996\u5148\u8fd9\u662f\u6709\u51b3\u7b56\u5355\u8c03\u6027\u7684\u3002\u524d\u7f6e\u829d\u58eb : [DP\u7684\u51b3\u7b56\u5355\u8c03\u6027\u4f18\u5316\u603b\u7ed3](https://www.luogu.com.cn/blog/command-block/dp-di-jue-ce-dan-diao-xing-you-hua-zong-jie)\n\n- \u65b9\u6cd50\n\n  \u8003\u8651\u679a\u4e3e\u8d77\u70b9,\u65ad\u73af\u4e3a\u94fe,\u5c31\u53d8\u6210\u4e86\u539f\u7248\u95ee\u9898\u3002\n  \n  \u90a3\u4e48\u663e\u7136\u6709$O(n^2k)$\u7684\u80cc\u5305\u505a\u6cd5,\u603b\u590d\u6742\u5ea6\u5c31\u662f$O(n^3k)$.\n\n  \u4e3a\u4e86\u65b9\u4fbf\u5bf9\u62cd\u8fd9\u91cc\u7ed9\u51fa\u4ee3\u7801:\n  \n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<cmath>\n#include<ctime>\n#define db long double\nusing namespace std;\nconst db Pi=acos(-1);\ninline int read(){\n  register int X=0;\n  register char ch=0;\n  while(ch<48||ch>57)ch=getchar();\n  while(ch>=48&&ch<=57)X=X*10+(ch^48),ch=getchar();\n  return X;\n}\nint n,k,R,L,x[2050],s[1050],tp[1050][1050];\ndb cir,f[1050][1050],ts[40500];\ninline db c(int b,int a){\n  if (x[b]-x[a]>=R+R)return cir+(x[b]-x[a])*1e-10;\n  return ts[x[b]-x[a]];\n}\nint st[1050];\ndb ans;\nvoid calc(int bg)\n{\n  f[1][1]=cir;\n  for (int i=2;i<=n+1;i++)\n    for (int j=2;j<=k+1;j++){\n      f[i][j]=0;\n      for (int p=1;p<i;p++){\n        db sav=f[p][j-1]+c(i,p);\n        if (sav>f[i][j]){\n          f[i][j]=sav;\n          tp[i][j]=p;\n        }\n      }\n    }\n  db tmp=f[n+1][k+1]-cir;\n  if (tmp>ans){\n    ans=tmp;\n    for (int p=tp[n+1][k+1],c=k;p;p=tp[p][c--])\n      st[c]=p;\n    for (int i=1;i<=k;i++)st[i]=(st[i]+bg-2+n)%n+1;\n    sort(st+1,st+k+1);\n  }\n}\nint main()\n{\n  if (n>1000)return 0;\n  n=read();k=read();R=read();L=read();\n  cir=Pi*R*R;\n  for (int i=1;i<=R+R;i++)\n    ts[i]=(Pi-acos(0.5*i/R)*2)*R*R+sqrt(R*R-i*i*0.25)*i;\n  for (int i=1;i<=n;i++)\n    s[i+n]=(s[i]=read())+L;\n  x[0]=-100000;\n  db ans=0;\n  for (int i=0;i<n;i++){\n    for (int j=1;j<=n+1;j++)\n      x[j]=s[i+j];\n    calc(i+1);\n  }\n  for (int i=1;i<=k;i++)\n    printf(\"%d \",st[i]);\n  return 0;\n}\n```\n\n- \u65b9\u6cd5\u2460\n\n  \u66f4\u5feb\u5730\u89e3\u51b3\u539f\u95ee\u9898,\u5c42\u5355\u8c03\u6027\u5206\u6cbb\u5206\u6cbb\u5373\u53ef$O(nklogn)$,\u6216\u8005\u539f\u95ee\u9898\u7684`WQS`+\u4e8c\u5206\u961f\u5217\u505a\u5230$O(n\\log S\\log n)$\n  \n  \u603b\u590d\u6742\u5ea6\u662f$O(n^2k\\log n)$\u6216\u8005$O(n^2\\log S\\log n)$.\n\n- \u65b9\u6cd5\u2461\n\n\t\u8003\u8651\u8def\u5f84\u4ea4\u9519,\u5148$O(nk\\log n)$\u5355\u8c03\u6027\u5206\u6cbb\u6c42\u51fa\u4efb\u610f\u4e00\u79cd\u65b9\u6848,\u7136\u540e\u5269\u4f59\u7684\u6240\u6709\u65b9\u6848\u5c31\u90fd\u662f\u4ea4\u9519\u7684\u3002\n\n\t\u9009\u53d6\u6700\u77ed\u7684(\u51b3\u7b56\u70b9\u6700\u5c11)\u4e00\u6bb5,\u8fd9\u4e00\u6bb5\u7684\u957f\u5ea6\u662f$O(n/k)$\u7684,\u5728\u8fd9\u4e00\u6bb5\u91cc\u9762\u679a\u4e3e\u8d77\u70b9\u5373\u53ef\u3002\n    \n   \u8fd9\u6837\u662f$O(n/k)$\u4e2a\u539f\u95ee\u9898,\u6bcf\u4e2a\u7684\u590d\u6742\u5ea6\u662f$O(nk\\log n)$,\u603b\u590d\u6742\u5ea6\u662f$O(n^2\\log n)$.\n\n\u63a5\u4e0b\u6765\u662f$O(n\\log S\\log n+n\\log^2n)$\u7684\u9b54\u6cd5\u3002\n\n\u5148\u8003\u8651\u5982\u4f55\u5feb\u901f\u6c42\u51fa\u4efb\u610f\u4e00\u79cd\u94a6\u5b9a\u8d77\u70b9\u7684\u65b9\u6848\u3002\u5f53\u7136\u76f4\u63a5\u5927\u529b\u5206\u6cbb\u5c31\u53ef\u4ee5$O(nk\\log n)$\u3002\n\n\u6839\u636e\u539f\u9898\u8fd9\u662f\u51f8\u7684,\u4f7f\u7528`WQS`\u4e8c\u5206+\u4e8c\u5206\u961f\u5217\u5373\u53ef\u505a\u5230$O(n\\log n\\log S)$\u3002\n\n\u4f46\u662f\u53ef\u80fd\u5728\u6784\u9020\u65b9\u6848\u4e0a\u9047\u5230\u4e00\u70b9\u9ebb\u70e6\u2026\u2026\n\n\u53ef\u4ee5\u5bf9\u5706\u7684\u4f4d\u7f6e\u7384\u5b66\u6270\u52a8\u907f\u514d\u7b54\u6848\u51f8\u5305\u4e09\u70b9\u5171\u7ebf,\u8fd9\u6837\u4f1a\u5bfc\u81f4\u9884\u5904\u7406\u5931\u6548\u5f15\u6765\u5de8\u5927\u7684\u65f6\u95f4\u5e38\u6570\u3002\n\n\u8003\u8651\u4ed4\u7ec6\u5206\u6790\u3002\n\n\u8ba1\u7b97\u6270\u52a8\u5bf9\u9762\u79ef\u7684\u5f71\u54cd\u65f6,\u53ef\u4ee5\u5148\u7b97\u51fa\u63a5\u89e6\u5f27\u957f,\u518d\u8ba1\u7b97\u6270\u52a8\u8ddd\u79bb\u3002\n\n\u7531\u4e8e\u6270\u52a8\u8ddd\u79bb\u5f88\u5c0f,\u6270\u52a8\u540e\u63a5\u89e6\u5f27\u957f\u53d8\u5316\u4e0d\u5927,\u6240\u4ee5\u4e24\u8005\u76f8\u4e58\u5373\u4e3a\u8bef\u5dee\u6781\u5c0f\u7684\u7b54\u6848\u3002\n\n\u7136\u540e\u5f04\u4e2a`pair`,\u5982\u679c\u4e24\u79cd\u8f6c\u79fb\u539f\u503c\u5dee\u8ddd\u4e0d\u8d85\u8fc7 $eps$ ,\u5219\u6bd4\u8f83\u6270\u52a8\u635f\u5931\u3002\n\n\u591a\u968f\u673a\u51e0\u6b21\u5e94\u8be5\u5c31\u80fd\u5f97\u5230\u6070\u4e3a$k$\u4e2a\u7684\u65b9\u6848\u4e86\u3002\n\n\u6ce8\u610f,\u5982\u679c\u80fd\u591f\u9009\u51fa\u4e0d\u76f8\u4ea4\u7684$k$\u4e2a\u5706,\u6270\u52a8\u4e5f\u5c31\u5931\u6548\u4e86,\u6b64\u65f6\u9700\u8981\u7279\u5224\u3002\n\n\u4f3c\u4e4e\u6709\u6bd4\u8f83\u7cfb\u7edf\u7684\u6784\u9020\u65b9\u6cd5\u2026\u2026\u6539\u65e5\u518d\u5b66\u5427\u3002\n\n\u7531\u4e8e\u8fd9\u662f\u4e71\u641e,\u7cbe\u5ea6\u6bd4\u8f83\u7384\u5b66,\u9700\u8981`long double`\u548c\u7384\u5b66\u8c03 $eps$,\u5177\u4f53\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n\u5f97\u5230\u4e86\u4e00\u79cd\u65b9\u6848\u4e4b\u540e,\u7531\u4e8e\u8def\u5f84\u4ea4\u9519,\u53ef\u4ee5\u628a\u6bcf\u4e2a\u70b9\u7684\u51b3\u7b56\u533a\u95f4\u5212\u5206\u51fa\u6765,\u5176\u957f\u5ea6\u603b\u548c\u662f$O(n)$\u7684\u3002\n\n\u6ce8\u610f,\u4e24\u4e2a\u7aef\u70b9\u90fd\u8981\u5305\u542b,\u6240\u4ee5\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e00\u4e9b\u8fb9\u754c\u60c5\u51b5\u3002\n\n\u8003\u8651\u628a\u4e00\u6bb5\u6bb5\u7684\u51b3\u7b56\u533a\u95f4\u62c6\u4e0b\u6765\u5206\u5c42\u6392\u6210\u4e00\u6392,\u5219\u6709\u8fd9\u6837\u7684\u6a21\u5f0f:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/65qaunah.png)\n\n\u4e00\u6761\u6298\u7ebf\u5219\u8868\u793a\u67d0\u79cd\u94a6\u5b9a\u8d77\u59cb\u70b9\u7684\u6700\u4f18\u51b3\u7b56,\u4e0d\u96be\u53d1\u73b0\u6298\u7ebf\u76f8\u4ea4\u5c31\u4ee3\u8868\u7740\u8def\u5f84\u4e0d\u4ea4\u9519,\u6240\u4ee5\u6240\u6709\u6298\u7ebf\u90fd\u662f\u4e0d\u4ea4\u7684\u3002\n\n\u73b0\u5728\u91cd\u5934\u620f\u6765\u4e86,\u6211\u4eec\u5bf9\u8d77\u59cb\u70b9\u5206\u6cbb,\u5bf9\u4e8e\u540e\u9762\u7684\u70b9\u91c7\u7528\u4e00\u822c\u7684\u51b3\u7b56\u5355\u8c03\u6027\u5206\u6cbb\u3002\n\n\u6211\u4eec\u4f1a\u5f97\u5230\u4e00\u6761\u6298\u7ebf,\u628a\u6240\u6709\u7684\u5c42\u5206\u6210\u4e86\u4e24\u90e8\u5206,\u5927\u5c0f\u548c\u4e3a$O(n)$,\u4e8e\u662f\u5206\u6cbb\u4e0b\u53bb\u627e\u6298\u7ebf,\u51b3\u7b56\u533a\u95f4\u957f\u5ea6\u603b\u548c\u662f$O(n\\log n)$\u7684\u3002\n\n\u6ce8\u610f,\u6b63\u597d\u5728\u5206\u754c\u7ebf\u4e0a\u7684\u70b9\u662f\u5206\u4e0d\u6e05\u5728\u54ea\u4e00\u8fb9\u7684,\u6240\u4ee5\u6709$O(k)$\u7684\u989d\u5916\u82b1\u8d39\u3002\n\n\u6211\u4eec\u628a\u8d77\u70b9\u9009\u5728\u6700\u77ed\u7684\u4e00\u6bb5,\u8fd9\u90e8\u5206\u82b1\u8d39\u5c31\u662f\u6700\u574f$O(n/k*k)=O(n)$\u7684\u4e86\u3002\n\n\u5f53\u7136\u5185\u5c42\u8fd8\u6709\u666e\u901a\u7684\u51b3\u7b56\u5355\u8c03\u6027\u5206\u6cbb,\u6240\u4ee5\u590d\u6742\u5ea6\u662f$O(n\\log^2n)$\n\n\u7531\u4e8e\u6211\u4eec\u771f\u6b63\u505a`DP`\u7684\u65f6\u5019\u4f1a\u62c6\u73af\u4e3a\u94fe,\u6709\u53ef\u80fd\u6700\u540e\u4e00\u5757\u7684\u51b3\u7b56\u6070\u4e3a\u7b2c\u4e00\u4e2a\u5706,\u6b64\u65f6\u9700\u8981\u7279\u5224\u3002\n\n\u6298\u817e\u4e86\u4e24\u5929\u7ec8\u4e8e\u5199\u5b8c\u4e86\u2026\u2026\n\n\u603b\u7ed3\u4e00\u4e0b\u5751\u70b9\u5427:\n\n- \u9700\u8981\u9884\u5904\u7406\u51e0\u4f55\u90e8\u5206\u8eb2\u6389\u5927\u5e38\u6570\u3002\n\n- \u7384\u5b66\u7684 $eps$.\n\n- \u627e\u5230\u6700\u77ed\u7684\u4e00\u6bb5\u4e4b\u540e,\u8981\u628a\u5750\u6807\u548c\u4e0b\u6807\u65cb\u8f6c\u4e00\u4e0b\u65b9\u4fbf\u5904\u7406\u3002\n\n- \u51b3\u7b56\u533a\u95f4\u540c\u65f6\u5305\u542b\u4e24\u4e2a\u7aef\u70b9,\u6240\u4ee5\u662f\u4f1a\u7565\u5fae\u91cd\u5408\u7684,`DP`\u7684\u65f6\u5019\u9700\u8981\u6eda\u52a8\u6570\u7ec4\u3002\n\n- \u53ef\u80fd\u6700\u540e\u4e00\u6bb5\u5305\u542b\u4e86\u7b2c\u4e00\u4e2a\u5706,\u8fd9\u662f\u9700\u8981\u7279\u5224\u7684\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<cmath>\n#define db long double\n#define MaxN 100500\nusing namespace std;\nconst db Pi=acos(-1);\ninline int read(){\n  register int X=0;\n  register char ch=0;\n  while(ch<48||ch>57)ch=getchar();\n  while(ch>=48&&ch<=57)X=X*10+(ch^48),ch=getchar();\n  return X;\n}\nint n,cnt,R,x[MaxN];\ndb f[MaxN],fl[MaxN],ts[MaxN],tl[MaxN],cir;\n//a -> b\ninline db c(int b,int a){\n  // \u5b9e\u9645\u9762\u79ef \n  if (x[b]-x[a]>=R+R)return f[a]+cir;\n  return f[a]+ts[x[b]-x[a]];\n}\nint tp[MaxN];\ninline db rc(int b,int a){\n  // \u6270\u52a8\u6743\u503c \n  if (x[b]-x[a]>=R+R)return fl[a];\n  return fl[a]+tl[x[b]-x[a]]*(tp[b]-tp[a]);\n}\nbool flag;//\u662f\u5426\u8ba1\u5165\u6270\u52a8 \ndb eps;\nbool cmp(int p,int x,int y){\n  db cx=c(p,x),cy=c(p,y);\n  if (flag||cx-cy>eps||cy-cx>eps)\n    return cx>cy;\n  return rc(p,x)>rc(p,y)+eps;\n}\nint query(int i,int j)\n{\n  int l=max(i,j),r=min(n,l+R),mid;\n  while(l<r){\n  \tmid=(l+r)>>1;\n  \tif (cmp(mid,i,j))r=mid;\n  \telse l=mid+1;\n  }if (r==n)return n+cmp(n,j,i);\n  return r;\n}\nint k[MaxN],stk[MaxN],p[MaxN],tot;\ndb ans,mid,mid2;\nvoid check()\n{\n  int l=1,r=1;stk[1]=0;\n  for (int i=1;i<=n;i++){\n  \twhile(l<r&&k[l+1]<=i)l++;\n  \tf[i]=c(i,p[i]=stk[l])+mid;\n  \tfl[i]=rc(i,p[i])+mid2;\n  \twhile(l<r&&k[r]>=query(i,stk[r]))r--;\n    stk[++r]=i;k[r]=query(i,stk[r-1]);\n  }int tp=n;tot=0;\n  while(tp){tp=p[tp];tot++;}\n  ans=f[n];\n}\nint L;\nvoid adjust()\n{\n  for (int i=1;i<=n;i++)\n    tp[i]=(rand()<<12^rand())%10000000;\n  //\u968f\u673a\u6270\u52a8\u5e76\u518d\u6b21WQS\n  double l=-R*1e8,r=R*1e8;\n  for (int qt=0;qt<=45&&tot!=cnt;qt++){\n    mid2=(l+r)/2;check();\n    //printf(\"%d %.8lf\\n\",tot,(double)mid2);\n    if (tot>cnt)r=mid2;\n    if (tot<cnt)l=mid2;\n  }\n}\nint st[MaxN];\nbool getone()\n{\n  tot=0;\n  db l=-cir,r=0;flag=1;\n  while(r-l>eps*1e-4&&tot!=cnt){\n    mid=(l+r)/2;check();\n    if (tot>cnt)r=mid;\n    if (tot<cnt)l=mid;\n  }\n  /*printf(\"%.9lf %.9lf\\n\",(double)((ans-mid*cnt)-cir),(double)ans);\n  printf(\"%.6lf %.18lf\\n\",(double)cir,(double)mid);\n  printf(\"%d %d\\n\",tot,cnt);*/\n  // \u67e5\u770b\u521d\u59cbWQS \n\n  if (cir+mid>eps){//\u53ef\u4ee5\u9009\u51fak\u4e2a\u6574\u5706,\u5219\u6270\u52a8\u65e0\u6548\n    flag=0;//\u5f00\u59cb\u6270\u52a8 \n    while(tot!=cnt)adjust();\n  }//else printf(\"       Error  %.9lf\",(double)(cir*(cnt-1)));\n  ans=0;cnt--;\n  for (int i=cnt,tp=p[n];i;i--,tp=p[tp])st[i]=tp;\n  return cir+mid>eps;\n}\nvoid sol(int l,int r,int tl,int tr,db *f,int *p)\n{\n  int mid=(l+r)>>1;\n  f[mid]=0;p[mid]=tl;\n  for (int i=tl;i<=min(tr,mid-1);i++){\n    db sav=c(mid,i);\n    if (sav>f[mid]){\n      f[mid]=sav;p[mid]=i;\n    }\n  }\n  if (l<mid)sol(l,mid-1,tl,p[mid],f,p);\n  if (mid<r)sol(mid+1,r,p[mid],tr,f,p);  \n}\ndb ff[2][MaxN];\nint pp[2][MaxN];\nvoid calc(int bp,int *l,int *r,int *sp)\n{\n  f[bp]=cir;\n  if (bp==1&&r[cnt]==n+1)r[cnt]--;\n  /*for (int i=2;i<=cnt;i++)\n    printf(\"  [%d,%d]\\n\",l[i],r[i]);*/\n  //\u67e5\u770b\u51b3\u7b56\u533a\u95f4\n  sol(l[2],r[2],bp,bp,ff[0],pp[0]);\n  for (int i=l[2];i<=r[2];i++)f[i]=ff[0][i];\n  for (int i=3;i<=cnt;i++){\n    sol(l[i],r[i],l[i-1],r[i-1],ff[i&1],pp[i&1]);\n    for (int j=l[i];j<=r[i];j++)f[j]=ff[i&1][j];\n  }\n  int tp;x[n+2]=L+x[bp];\n  db ret=0;\n  for (int i=l[cnt];i<=r[cnt];i++){\n    db sav=c(n+2,i);\n    if (sav>ret){ret=sav;tp=i;}\n  }\n  ret-=cir;\n  for (int i=cnt;i;i--){\n    sp[i]=tp;\n    tp=pp[i&1][tp];\n  }\n  /*for (int i=1;i<=cnt;i++){\n    printf(\"%d \",sp[i]);\n    //if (sp[i]<=sp[i-1])puts(\"!\");\n  }puts(\"\");\n  printf(\"  %d %.9lf\\n\",bp,(double)ret);*/\n\n  if (ret+eps>ans){\n    ans=ret;\n    for (int i=1;i<=cnt;i++)\n      st[i]=sp[i];\n  }if (bp==1&&r[cnt]==n)r[cnt]++;\n}\nint sl[MaxN<<1],sr[MaxN<<1],sp[MaxN<<1];\nvoid solve(int *l,int *r,int *sp)\n{\n  if (l[1]>r[1])return ;\n  //printf(\"Solve [%d,%d]\\n\",l[1],r[1]);\n  int mid=(l[1]+r[1])>>1,*tl=l+cnt+1,*tr=r+cnt+1,*tp=sp+cnt+1;\n  calc(mid,l,r,sp);\n  tl[1]=l[1];tr[1]=mid-1;\n  for (int i=2;i<=cnt;i++)\n    {tl[i]=l[i];tr[i]=sp[i];}\n  solve(tl,tr,tp);\n  tl[1]=mid+1;tr[1]=r[1];\n  for (int i=2;i<=cnt;i++)\n    {tl[i]=sp[i];tr[i]=r[i];}\n  solve(tl,tr,tp);\n}\nint getall()\n{\n  int ml=1<<30,pos=0,sav=1;n--;\n  for (int i=1;i<cnt;i++)\n    if (st[i+1]-st[i]<ml){\n      ml=st[i+1]-st[i];\n      pos=i;\n    }//\u5bfb\u627e\u6700\u77ed\u7684\u4e00\u6bb5\u5e76\u4f4d\u79fb\n  //for (int i=1;i<=cnt;i++)printf(\"%d \",st[i]);puts(\"\");\n  ml=x[st[pos]];\n  for (int i=1;i<=n;i++)x[i]=(x[i]-ml+L)%L;\n  sav=ml=st[pos];\n  for (int i=1;i<=cnt;i++)st[i]=(st[i]-ml+n)%n+1;\n  sort(st+1,st+cnt+1);sort(x+1,x+n+1);\n  x[st[cnt+1]=n+1]=x[1]+L;\n  for (int i=1;i<=cnt;i++){ \n    sl[i]=st[i];sr[i]=st[i+1];\n    //\u6ce8\u610f\u4fdd\u7559\u7aef\u70b9\n  }solve(sl,sr,sp);\n  return sav;\n}\nint main()\n{\n  n=read();cnt=read();R=read();L=read();\n  cir=Pi*R*R;eps=1e-10*sqrt(R);\n  for (int i=1;i<=R+R;i++){\n    tl[i]=acos(0.5*i/R)*2*R;\n    ts[i]=(Pi-acos(0.5*i/R)*2)*R*R+sqrt(R*R-i*i*0.25)*i;\n  }x[0]=-1000000;\n  for (int i=1;i<=n;i++)\n    x[i]=read();\n  x[++n]=L+x[1];cnt++;\n  int sav=1;\n  if (getone())sav=getall();\n  for (int i=1;i<=cnt;i++)st[i]=(st[i]+sav-2)%n+1;\n  sort(st+1,st+cnt+1);\n  for (int i=1;i<=cnt;i++)printf(\"%d \",st[i]);\n  return 0;\n}\n```\n\n",
        "postTime": 1587341700,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6455 \u3010\u4e0d\u53ef\u89c6\u5883\u754c\u7ebf[\u73af\u7248\u672c]\u3011"
    }
]