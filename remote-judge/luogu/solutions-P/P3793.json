[
    {
        "content": "\u7279\u6280\u5361\u5e38\u6570\u9898\n\n\u5176\u5b9e\u8fd9\u4e2a\u9898\u8003\u7684\u4e0d\u662f\u5e38\u6570\u4f18\u5316\n\n\u662f\u819c\u6cd5\n\n\u8fd9\u6837\u7684\n\n\u4f60\u4eec\u90fd\u4f1a+1-1rmq\u5427\uff1f\n\n\u4e0d\u4f1a\u6709\u5173\u7cfb\uff0c\u56e0\u4e3a\u4f60\u542c\u4e0d\u61c2\u540e\u9762\u6211\u8981\u8bf4\u5565\n\n\u4f46\u662f\u5176\u5b9e\u4e5f\u6ca1\u5173\u7cfb\uff0c\u56e0\u4e3a\u6211\u90fd\u6ca1\u5199\u8fc7\n\n\u4ed4\u7ec6\u60f3\u60f3+1-1rmq\uff0c\u90a3\u4e2a\u56db\u6bdb\u5b50\u7684\u7528\u9014\uff1f\n\n\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u4e00\u4e2a\u6539\u826f\u7b97\u6cd5\n\n\u5206\u5757\uff0c\u5927\u5c0f\u8bbe\u4e3ax\n\n\u9884\u5904\u7406\u6bcf\u4e2a\u5757\u4e24\u7aef\u5230\u5757\u5185\u6bcf\u4e2a\u70b9\u7684\u524d\u7f00max\u548c\u540e\u7f00max\n\n\u9884\u5904\u7406\u5757\u95f4ST\u8868\n\n\u7136\u540e\u67e5\u8be2\u7684\u65f6\u5019\n\n\u6bd4\u5982\u8bf4\u6211\u67e5l\uff0cr\uff0c\u8fd9\u4e24\u4e2a\u5206\u522b\u5728\u5757a\uff0cb\u4e2d\n\n\u7136\u540e\u5c31\u662f\u67e5\u5757a\uff0cb\u4e4b\u95f4\u7684rmq\uff0c\u4ee5\u53cal\u5728a\u5757\u7684\u540e\u7f00max\u548cr\u5728b\u5757\u7684\u524d\u7f00max\n\n\u5757\u5927\u5c0f\u4e3alogn\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u662fO( 1 )\u7684\n\n\u4f46\u662f\n\u8981\u771f\u7684\u662f\u8fd9\u6837\u7684\n\n\u90a3\u53d1\u660e+1-1rmq\u7684\u4eba\u5c82\u4e0d\u662fnaive\uff1f\n\n ![](https://cdn.luogu.com.cn/upload/pic/5789.png) \n\n\u80af\u5b9a\u4e0d\u662f\n\n\u90a3\u4e2a\u7b97\u6cd5\u6709\u4e00\u4e2a\u95ee\u9898\n\n\u5c31\u662f\u67e5\u8be2\u7684\u4e24\u4e2a\u70b9\u90fd\u5728\u540c\u4e00\u4e2a\u5757\u4e2d\u4f1a\u51fa\u504f\u5dee\n\n\u4f46\u662f\n\u5757\u5927\u5c0flogn\u554a\n\n\u6240\u4ee5\u590d\u6742\u5ea6\u6700\u574f\u662fnlogn\n\n\u7136\u800c\u6211\u53ef\u4ee5\u5fae\u8c03\u5757\u5927\u5c0f\u8ba9\u4f60\u6839\u672c\u6ca1\u6cd5\u5361\n\n\u7136\u540e\u8fd9\u4e2a\u9898\u6570\u636e\u968f\u673a\u662f\u4e0d\u662f\n\n\u8bbe\u5757\u5927\u5c0f\u4e3ax\n\n\u5219\u4e24\u4e2a\u7aef\u70b9\u540c\u4e00\u4e2a\u5757\u6982\u7387\u4e3a1/x\uff0c\u4ee3\u4ef7\u4e3aO( x )\n\n\u6240\u4ee5\u53ef\u4ee5\u8ba9x = sqrt( n )\u56e0\u4e3a\u9884\u5904\u7406ST\u8868\u633a\u6162\u7684\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u51b3\u4e86\n\n\u671f\u671b\u4e0bO( n )\u7684rmq\n\n\u800c\u4e14\u4e0d\u7528\u7b1b\u5361\u5c14\u6811\u4ec0\u4e48\u7684\uff0c\u5e38\u6570\u8d85\u7ea7\u5c0f\u54e6~\n\n\u8fd9\u4e2a\u5927\u6982\u662f\u4e00\u4e2a\u4e0d\u9519\u7684rmq\u7b97\u6cd5\uff0c\u8dd1\u5f97\u53c8\u5feb\uff0c\u5e38\u6570\u53c8\u5c0f\uff0c\u8fd8\u597d\u5199\n\n\u91cd\u70b9\u662f\u6ca1\u4eba\u5361\u4f60\uff0c\u5361\u8fd8\u4e0d\u4e00\u5b9a\u5361\u7684\u4f4f\uff0c\u8fd8\u8981\u5192\u7740\u88ab\u66b4\u529bAC\u7684\u98ce\u9669\n\n\u6700\u540e\u653e\u4e0a183\u70b8\u9c7c\u56fe\n\n![](https://cdn.luogu.com.cn/upload/pic/5788.png)\n",
        "postTime": 1496156477,
        "uid": 3296,
        "name": "noip",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "**\u8fd9\u662f\u4e00\u4e2a\u4e71\u641e\u505a\u6cd5\uff0c\u4e5f\u662f\u5230\u73b0\u5728\u8fd9\u9053\u9898\u7684\u7b2c\u4e09\u79cd\u505a\u6cd5\u3002**\n\n\u9996\u5148\u5bf9\u5e8f\u5217\u6392\u5e8f\uff0c\u6ce8\u610f\u8981\u7528\u7ed3\u6784\u4f53\u7ef4\u62a4\u6bcf\u4e2a\u6570\u7684\u4f4d\u7f6e\uff0c\u5927\u6982\u662f\u8fd9\u6837\uff1a\n\n```cpp\nstruct num\n{\n\tint s,w;\n\tfriend bool operator <(const num& qwq,const num& qaq)\n\t{\n\t\treturn qwq.s>qaq.s;\n\t}\n}a[20000005];\nfor(i=0;i<n;i++)\n\ta[i]=num({read(),i});\nsort(a,a+n);\n```\n\u7136\u540e\u6bcf\u6b21\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u6309\u987a\u5e8f\u66b4\u529b\u679a\u4e3e\u6bcf\u4e2a\u6570\u662f\u5426\u5728\u533a\u95f4\u5185\uff0c\u5982\u679c\u662f\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\uff0c\uff0c\n\n\u5c31\u6ca1\u4e86\n\n\u6b63\u786e\u6027\u663e\u800c\u6613\u89c1\uff1a\u4e00\u65e6\u641c\u5230\u7b2c\u4e00\u4e2a\u5728\u533a\u95f4\u5185\u7684\uff0c\u90a3\u4e48\u4e00\u5b9a\u662f\u6700\u5927\u503c\u3002\n\n\u5927\u6982\u957f\u8fd9\u4e2a\u6837\uff1a\n\n```cpp\nint ask(int l,int r)\n{\n\tint i;\n\tfor(i=0;a[i].w>r||a[i].w<l;i++);\n\treturn a[i].s;\n}\n```\n\u4e0b\u9762\u662f\u5bf9\u671f\u671b\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u8bc1\u660e\uff1a\n\n**\u672c\u9898\u6570\u636e\u968f\u673a**\n\n\u7531\u4e8e\u6570\u636e\u968f\u673a\uff0c\u6240\u4ee5\u8ba1\u7b97\u4e00\u4e2a\u957f\u5ea6\u4e3a $k$ \u7684\u533a\u95f4\u7684\u6700\u5927\u503c\u7684\u671f\u671b\u590d\u6742\u5ea6\u4e3a $\\dfrac n k$\u3002\n\n\u5148\u770b\u770b\u6240\u6709\u7684\u8fde\u7eed\u6bb5\u7684\u957f\u5ea6\uff1a\n\n\u957f\u5ea6\u4e3a $1$\uff1a$n$ \u4e2a\u3002\n\n\u957f\u5ea6\u4e3a $2$\uff1a$n-1$ \u4e2a\u3002\n\n\u2026\u2026\n\n\u957f\u5ea6\u4e3a $n$\uff1a$1$ \u4e2a\u3002\n\n\u603b\u5171\u6709 $\\dfrac {n\\times (n+1)} 2$ \u4e2a\u8fde\u7eed\u533a\u95f4\uff0c\u53bb\u6389\u5e38\u6570\u4e3a $n^2$\u3002\n\n\u8ba1\u7b97\u4e0a\u9762\u8fd9\u4e9b\u533a\u95f4\u7684\u603b\u5e73\u5747\u6b21\u6570\u4e3a\uff1a\n\n$$t=n\\times \\dfrac n 1+(n-1)\\times \\dfrac n 2+\\dots + 1 \\times \\dfrac n n$$\n\n\u6bcf\u4e2a\u533a\u95f4\u5e73\u5747\u4e3a\uff1a\n\n$$\\dfrac t {n^2}$$\n\n\u5316\u7b80\u4e00\u4e0b\uff0c\u628a\u4e0a\u9762\u5f0f\u5b50\u7684 $n$ \u548c\u4e0b\u9762\u7684 $n$ \u62b5\u6d88\uff1a\n\n$$t=\\dfrac {n\\times \\dfrac 1 1+(n-1)\\times \\dfrac 1 2+\\dots + 1 \\times \\dfrac 1 n} n$$\n\n\u53d8\u6210\uff1a\n\n$$t=\\dfrac {\\dfrac n 1+ \\dfrac {(n-1)} 2+\\dots + \\dfrac 1 n} n$$\n\n$$t\\le {\\dfrac n 1+ \\dfrac n 2+\\dots + \\dfrac n n}$$\n\n\u5f97\n\n$$t\\le n \\log n$$\n\n\u6240\u4ee5\n\n$$\\dfrac t n \\le \\log n$$\n\n\u6700\u7ec8\u7684\u671f\u671b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\log n$\u3002\u6700\u91cd\u8981\u7684\u662f\uff0c\u5e38\u6570\u6781\u5c0f\u3002\n\n\u6545\u800c\u591a\u63d0\u4ea4\u51e0\u6b21\u53ef\u8fc7\u3002",
        "postTime": 1591515566,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "[\u5b89\u5229\u535a\u5ba2-\u5404\u79cd RMQ \u7684\u603b\u7ed3](https://kewth.github.io/2019/10/11/RMQ)\n\n\u8be2\u95ee\u533a\u95f4\u968f\u673a\u7684\u524d\u63d0\u4e0b\u6709\u4e2a $O(n + q)$ \u7684\u5728\u7ebf\u505a\u6cd5\u3002\n\n\u8003\u8651\u5206\u5757\uff0c\u8bbe\u5757\u7684\u5927\u5c0f\u4e3a $b$ \uff0c $O(n)$ \u9884\u5904\u7406\u6bcf\u4e2a\u5757\u7684\u6700\u5927\u503c\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u8be2\u95ee $[l, r]$ \uff0c\u82e5\u8be5\u533a\u95f4\u8de8\u8fc7\u4e86\u591a\u4e2a\u5757\uff0c\u95ee\u9898\u5c31\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\n\n1. \u6c42\u8de8\u8fc7\u7684\u5757\u533a\u95f4\u7684\u6700\u5927\u503c\u3002\n2. \u6c42\u4e24\u7aef\u70b9\u6240\u5728\u96f6\u6563\u7684\u5757\u7684\u6700\u5927\u503c\u3002\n\n\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u4e2a\u5b50\u95ee\u9898\uff0c\u5e76\u4e14\u6570\u636e\u89c4\u6a21\u51cf\u5c0f\u5230\u4e86 $O(\\frac{n}{b})$ \uff0c  \n\u4e3a\u4e86\u4fdd\u8bc1\u8be2\u95ee $O(1)$ \uff0c\u53ef\u4ee5\u4f7f\u7528 ST \u8868\uff0c  \n\u5c31\u53ef\u4ee5 $O(\\frac{n}{b} log\\frac{n}{b})$ \u8fdb\u884c\u9884\u5904\u7406\u7136\u540e $O(1)$ \u8be2\u95ee\u3002\n\n\u7b2c\u4e8c\u4e2a\u95ee\u9898\u7aef\u70b9\u6240\u5728\u96f6\u6563\u7684\u5757\u662f\u8be5\u5757\u7684\u4e00\u6bb5\u524d\u7f00\u6216\u8005\u540e\u7f00\uff0c  \n\u53ea\u9700 $O(n)$ \u5bf9\u4e8e\u6bcf\u4e2a\u5757\u9884\u5904\u7406\u524d\u7f00\u6700\u5927\u503c\u548c\u540e\u7f00\u6700\u5927\u503c\u5373\u53ef $O(1)$ \u8be2\u95ee\u3002\n\n\u90a3\u4e48\u82e5\u8be2\u95ee\u533a\u95f4\u5728\u540c\u4e00\u4e2a\u5757\u5185\u5462\uff1f  \n\u81ea\u7136\u662f\u66b4\u529b\u626b\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u662f $O(b)$ \u7684\u3002  \n\u4f46\u8be2\u95ee\u533a\u95f4\u968f\u673a\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u96be\u5f97\u51fa\u4e24\u4e2a\u7aef\u70b9\u5728\u540c\u4e00\u4e2a\u5757\u5185\u7684\u6982\u7387\u662f $\\frac{b}{n}$ \u3002  \n\u90a3\u4e48\u8fd9\u79cd\u60c5\u51b5\u8be2\u95ee\u7684\u671f\u671b\u590d\u6742\u5ea6\u662f $O(\\frac{b^2}{n})$ \u7684\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n + \\frac{n}{b} log\\frac{n}{b} + q + q \\frac{b^2}{n})$ \u3002  \n\u5f53 $b$ \u81f3\u5c11\u4e3a $O(logn)$ \u65f6\uff0c\u9884\u5904\u7406\u7684 $O(\\frac{n}{b} log\\frac{n}{b})$ \u4e0d\u8d85\u8fc7 $O(n)$ \u3002  \n\u5f53 $b$ \u81f3\u591a\u4e3a $O(\\sqrt{n})$ \u65f6\uff0c\u8be2\u95ee\u7684 $O(q \\frac{b^2}{n})$ \u4e0d\u8d85\u8fc7 $O(q)$ \u3002  \n\u56e0\u6b64 $b$ \u7684\u5927\u5c0f\u53d6 $O(logn)$ \u5230 $O(\\sqrt{n})$ \u4e4b\u95f4\u5373\u53ef\u3002\n\n### \u6bd2\u7624\u6d3b\u52a8-\u975e\u968f\u673a\u7684\u6269\u5c55\n\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u8fd9\u4e2a\u505a\u6cd5\u7684\u590d\u6742\u5ea6\u4ec5\u9002\u7528\u4e8e\u8be2\u95ee\u533a\u95f4\u968f\u673a\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u4e00\u822c\u4e0d\u4f1a\u5361\u3002\n\n\u6765\u70b9\u6709\u610f\u601d\u7684\u5a31\u4e50\u6d3b\u52a8\uff0c\u8003\u8651\u600e\u4e48\u5361\u6389\u5b83\uff0c\u4ee5\u53ca\u600e\u4e48\u9632\u6b62\u88ab\u51fa\u9898\u4eba\u5361\u3002\n\n\u60f3\u8981\u5361\u8fd9\u4e2a\u505a\u6cd5\u5c31\u8981\u5c3d\u91cf\u8ba9\u8be2\u95ee\u533a\u95f4\u5728\u4e00\u4e2a\u5757\u5185\uff0c\u5361\u6210 $O(b)$ \u7684\u8be2\u95ee\u590d\u6742\u5ea6\u3002  \n\u4f46\u5728\u4e0d\u77e5\u9053\u5757\u7684\u5927\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u5047\u8bbe\u7ed9\u4e00\u4e2a\u533a\u95f4\u957f $len$ \u7684\u8be2\u95ee\uff0c\u5b9e\u9645\u5757\u7684\u5927\u5c0f\u4e3a $b$ \uff0c  \n\u90a3\u4e48\u4e24\u4e2a\u7aef\u70b9\u5728\u540c\u4e00\u4e2a\u5757\u5185\u7684\u6982\u7387\u5927\u6982\u662f $\\frac{b-len+1}{b}$ \uff0c\u671f\u671b\u590d\u6742\u5ea6\u5c31\u662f $O(\\frac{(b-len+1)len}{b})$ \u3002\n\n\u73b0\u5728\u51fa\u9898\u4eba\u8981\u5728\u4e0d\u77e5\u9053 $b$ \u7684\u60c5\u51b5\u4e0b\u5e0c\u671b\u4e0a\u9762\u7684\u590d\u6742\u5ea6\u5c3d\u91cf\u5927\uff0c\u9009\u624b\u8981\u5728\u4e0d\u77e5\u9053 $len$ \u7684\u60c5\u51b5\u4e0b\u5e0c\u671b\u4e0a\u9762\u590d\u6742\u5ea6\u5c3d\u91cf\u5c0f\u3002  \n~~\u600e\u4e48\u611f\u89c9\u50cf\u535a\u5f08\u8bba~~\n\n\u6700\u574f\u7684\u60c5\u51b5\u662f $len = \\frac{b}{2}$ \u7684\u65f6\u5019\uff0c\u6b64\u65f6\u8be2\u95ee\u7684\u671f\u671b\u590d\u6742\u5ea6\u4e3a $O(\\frac{b}{4})$ \u3002  \n\u9009\u624b\u5e0c\u671b\u9884\u5904\u7406\u548c\u8be2\u95ee\u7684\u590d\u6742\u5ea6\u6700\u5927\u503c\u6700\u5c0f\uff0c\u4e5f\u5c31\u662f\u8ba9\u5b83\u4eec\u76f8\u7b49\uff0c\u6b64\u65f6 $b$ \u7684\u6700\u4f18\u53d6\u503c\u5927\u81f4\u4e3a $2\\sqrt{\\frac{n}{q} logn}$ \uff0c  \n\u8fd9\u91cc\u8bf4\u662f\u201c\u5927\u81f4\u201d\uff0c\u662f\u56e0\u4e3a\u4e3a\u4e86\u65b9\u4fbf\u8ba1\u7b97\u5c06 $O(log \\frac{n}{b})$ \u770b\u505a\u4e86 $O(logn)$ \u3002  \n\u5c06 $n, q$ \u770b\u505a\u540c\u9636\u7684\u8bdd\uff0c\u4e0a\u8ff0\u53d6\u503c\u4e3a $2\\sqrt{logn}$ \uff0c\u6b64\u65f6\u590d\u6742\u5ea6\u4e3a $O(\\frac{n\\sqrt{logn}}{2})$ \uff0c  \n\u4e5f\u5c31\u662f $O(n\\sqrt{logn})$ \uff0c\u5f97\u51fa\u7ed3\u8bba\uff0c\u5728\u8be2\u95ee\u533a\u95f4\u975e\u968f\u673a\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u7b97\u6cd5\u6700\u4f18\u53ef\u4ee5\u505a\u5230\u4e25\u683c $O(n\\sqrt{logn})$ \u3002\n\n\u5173\u952e\u8fd9\u7b97\u6cd5\u5e38\u6570\u5c0f\uff0c\u8fd8\u597d\u5199\uff0c\u53d6 b \u4e3a $O(\\sqrt{logn})$ \u7684\u8bdd\uff0c\u590d\u6742\u5ea6 $O((n + q)\\sqrt{logn})$ \u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u90fd\u8db3\u591f\u4e86\u3002\n\n\u6700\u540e\uff0c\u9644\u672c\u9898\u4ee3\u7801\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u5b9e\u8df5\u4e2d\u53d6 $b$ \u4e3a $\\sqrt{n}$ \u65f6\u8dd1\u5f97\u6bd4\u8f83\u5feb\u3002\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\n#define debug(...) fprintf(stderr, __VA_ARGS__)\n\nnamespace GenHelper {\n\tunsigned z1, z2, z3, z4, b;\n\tunsigned rand_() {\n\t\tb = ((z1 << 6) ^ z1) >> 13;\n\t\tz1 = ((z1 & 4294967294U) << 18) ^ b;\n\t\tb = ((z2 << 2) ^ z2) >> 27;\n\t\tz2 = ((z2 & 4294967288U) << 2) ^ b;\n\t\tb = ((z3 << 13) ^ z3) >> 21;\n\t\tz3 = ((z3 & 4294967280U) << 7) ^ b;\n\t\tb = ((z4 << 3) ^ z4) >> 12;\n\t\tz4 = ((z4 & 4294967168U) << 13) ^ b;\n\t\treturn (z1 ^ z2 ^ z3 ^ z4);\n\t}\n}; // namespace GenHelper\n\nvoid ssrand(unsigned x) {\n    using namespace GenHelper;\n    z1 = x;\n    z2 = unsigned((~x) ^ 0x233333333U);\n    z3 = unsigned(x ^ 0x1234598766U);\n    z4 = (~x) + 51;\n}\n\nint read() {\n    using namespace GenHelper;\n    int A = rand_() & 32767;\n    int B = rand_() & 32767;\n    return A * 32768 + B;\n}\n\ninline int input() { int x; scanf(\"%d\", &x); return x; }\n\nconst int maxn = 20000005, minb = 4400, maxb = 4475;\nint a[maxn + maxb];\nint highbit[maxn + maxb];\nint st[maxn / minb][maxb];\nint pre[maxn / minb][maxb];\nint suf[maxn / minb][maxb];\n\ninline void chkmax(int &x, int y) {\n\tif(y > x) x = y;\n}\n\nint main() {\n\tint n = input(), q = input(), s = input();\n\tssrand(unsigned(s));\n\tint b = int(sqrt(n));\n\tint B = (n - 1) / b;\n\n\tfor(int i = 0; i < n; i ++) {\n\t\ta[i] = read();\n\t\tchkmax(st[i / b][0], a[i]);\n\t}\n\n\tfor(int i = B; i >= 0; i --)\n\t\tfor(int k = 1; i + (1 << k) - 1 <= B; k ++)\n\t\t\tst[i][k] = std::max(st[i][k - 1], st[i + (1 << (k - 1))][k - 1]);\n\n\tfor(int i = 0; i <= B; i ++) {\n\t\tint be = i * b;\n\t\tpre[i][0] = a[be];\n\t\tfor(int k = 1; k < b; k ++)\n\t\t\tpre[i][k] = std::max(pre[i][k - 1], a[be + k]);\n\t\tsuf[i][b - 1] = a[be + b - 1];\n\t\tfor(int k = b - 2; k >= 0; k --)\n\t\t\tsuf[i][k] = std::max(suf[i][k + 1], a[be + k]);\n\t}\n\n\tfor(int k = 0; (1 << k) <= n << 1; k ++)\n\t\tfor(int i = 1 << k; i < (1 << (k + 1)); i ++) {\n\t\t\tif(i > n) break;\n\t\t\thighbit[i] = k;\n\t\t}\n\tunsigned long long ans = 0;\n\twhile(q --) {\n\t\tint l = read() % n;\n\t\tint r = read() % n;\n\t\tif(l > r)\n\t\t\tstd::swap(l, r);\n\t\tint L = l / b, R = r / b;\n\n\t\tint now = 0;\n\t\tif(L == R)\n\t\t\tfor(int i = l; i <= r; i ++)\n\t\t\t\tchkmax(now, a[i]);\n\t\telse {\n\t\t\tchkmax(now, suf[L][l % b]);\n\t\t\tchkmax(now, pre[R][r % b]);\n\t\t\tint len = R - L - 1;\n\t\t\tint k = highbit[len];\n\t\t\tif(len) {\n\t\t\t\tchkmax(now, st[L + 1][k]);\n\t\t\t\tchkmax(now, st[R - (1 << k)][k]);\n\t\t\t}\n\t\t}\n\n\t\tans += unsigned(now);\n\t}\n\n\tprintf(\"%llu\\n\", ans);\n}\n```\n\u5982\u6709\u758f\u6f0f\u7684\u5730\u65b9\uff0c\u6b22\u8fce\u6307\u6b63\u3002",
        "postTime": 1570798095,
        "uid": 52232,
        "name": "Kewth",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "\u6709\u4e00\u79cd\u505a\u6cd5\uff1a\u6784\u7b1b\u5361\u5c14\u6811\uff0c\u6bcf\u6b21\u8be2\u95ee\u66b4\u529b\u5728\u7b1b\u5361\u5c14\u6811\u4e2d\u4ece\u4e0a\u5f80\u4e0b\u627e\u6700\u5927\u503c\uff0c\u5b9e\u6d4b\u968f\u673a\u6570\u636e\u4e0b1.6s\u5de6\u53f3\u8dd1\u51fa\u3002\n\n\u6784\u7b1b\u5361\u5c14\u6811\u7684\u5355\u8c03\u6808\u4e5f\u53ea\u8981\u5f00\u51e0\u5341\u5c31\u591f\u4e86\uff0c\u7a7a\u95f4\u5728256MB\u4ee5\u5185\u3002\n\n```cpp\n#include<cstdio>\n\nconst int maxn=20000010,maxs=100;\nint N,*val,ls[maxn],rs[maxn],stk[maxs],top,root;\nvoid init(int n, int m, int*a)\n{\n    // initialize the program\n    N=n;val=a;\n    for(int i=0;i<n;i++){\n        while(top&&a[stk[top]]<=a[i])ls[i]=stk[top--];\n        rs[stk[top]]=i;stk[++top]=i;\n    }\n    root=stk[1];\n}\n\nint query(int l, int r)\n{\n    // return the maximum value in a[l, r]\n    int x=root;\n    for(;;x=(r<x?ls:rs)[x])if(l<=x&&x<=r)return val[x];\n}\n\n// -----\n\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n        b=((z1<<6)^z1)>>13;\n        z1=((z1&4294967294U)<<18)^b;\n        b=((z2<<2)^z2)>>27;\n        z2=((z2&4294967288U)<<2)^b;\n        b=((z3<<13)^z3)>>21;\n        z3=((z3&4294967280U)<<7)^b;\n        b=((z4<<3)^z4)>>12;\n        z4=((z4&4294967168U)<<13)^b;\n        return (z1^z2^z3^z4);\n    }\n}\nvoid srand(unsigned x)\n{\n    using namespace GenHelper;\n    z1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;\n}\nint read()\n{\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return a*32768+b;\n}\nint a_[20000001];\nint main(){\n    int n,m,s;\n    unsigned long long ans=0;\n    scanf(\"%d%d%d\",&n,&m,&s);\n    srand(s);\n    for(int i=0;i<n;i++)a_[i]=read();\n    init(n,m,a_);\n    for(int i=0,l,r;i<m;i++)l=read()%n,r=read()%n,ans+=query(l<r?l:r,l>r?l:r);\n    printf(\"%lld\\n\",ans);\n}\n```",
        "postTime": 1496412467,
        "uid": 8147,
        "name": "t0vd",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "\u5361\u4e2a\u9524\u5b50\u7684\u5e38\u554a\uff0c\u8fd9\u660e\u660e\u662f\u6570\u5b66\u9898\uff08\u5927\u96fe\n\n\u9996\u5148\uff0c\u89c2\u5bdf\u5230\u6570\u636e\u968f\u673a\u3002\u6570\u636e\u968f\u673a = \u7528\u811a\u9020\u6570\u636e\uff0c\u6240\u4ee5\u8003\u8651\u6982\u7387\u6027\u4e71\u641e\u3002\n\n\u5047\u8bbe\u7ed9\u5b9a\u7684\u5e8f\u5217\u662f\u4e00\u4e2a\u6392\u5217\uff0c\u90a3\u4e48\u5982\u679c\u6211\u4eec\u5bf9\u6392\u5217\u6c42\u9006\uff0c\u90a3\u4e48 $[l,r]$ \u7684 rmq \u4f4d\u7f6e\u5c31\u662f\u9006\u6392\u5217\u91cc\u7684\u7b2c\u4e00\u4e2a\u5728 $[l,r]$ \u91cc\u9762\u7684\u5143\u7d20\u3002\u76f4\u63a5\u6a21\u62df\u5373\u53ef\u3002\n\n\u4e0b\u9762\u6765\u8bc1\u660e\u65f6\u95f4\u590d\u6742\u5ea6\u3002\u5bf9\u4e8e\u4e00\u4e2a\u968f\u673a\u6392\u5217\uff0c\u4efb\u610f\u4e00\u4e2a\u5143\u7d20\u5728 $[l,r]$ \u91cc\u9762\u7684\u53ef\u80fd\u6027\u662f $\\frac{r-l+1}{n}$\u3002\u6211\u4eec\u6c42\u4e00\u6b21 rmq \u671f\u671b\u9700\u8981\u7684\u65f6\u95f4\u7b49\u4e8e\u671f\u671b\u7b2c\u4e00\u4e2a\u5728 $[l,r]$ \u91cc\u7684\u4f4d\u7f6e\u5728\u54ea\u91cc\u3002\u7136\u540e\u6c42\u8fd9\u4e2a\u671f\u671b\u5f88\u7b80\u5355\uff0c\u628a\u8fd9\u4e2a\u53ef\u80fd\u6027\u770b\u4f5c\u5b8c\u5168\u968f\u673a\uff1a\n\n$$E=1+(1-\\frac{r-l+1}{n})E$$\n$$E=\\frac{n}{r-l+1}$$\n\n\u90a3\u4e48\u73b0\u5728\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u5c31\u9000\u5316\u6210\n\n$$\\sum\\frac{n}{r_i-l_i+1}$$\n\n\u663e\u7136 $r_i-l_i$ \u7b49\u4e8e $x$ \u7684\u6982\u7387\u5c31\u662f $\\frac{n-x}{\\binom{n}{2}}=2(\\frac{1}{n-1}-\\frac{x}{n(n-1)})$\u3002\u5c55\u5f00\u4e0a\u9762\u6765\u6c42\u671f\u671b\uff1a\n\n$$2\\sum_{x=0}^{n-1}\\frac{n}{x+1}(\\frac{1}{n-1}-\\frac{x}{n(n-1)})$$\n$$2\\sum_{x=0}^{n-1}\\frac{\\frac{n}{n-1}}{x+1}-\\frac{\\frac{x}{n-1}}{x+1}$$\n\n\u6ce8\u610f $n$ \u5f88\u5927\u7684\u65f6\u5019 $\\frac{n}{n-1}$ \u53ef\u4ee5\u770b\u4f5c\u4e3a $1$\u3002\n\n$$2\\sum_{x=0}^{n-1}\\frac{1-\\frac{x}{n-1}}{x+1}$$\n\n\u778e\u505a\u4e00\u4e9b\u201c\u5927\u6982\u201d\u6765\u7b80\u5316\u3002\n\n$$2\\sum_{x=1}^{n}\\frac{1-\\frac{x}{n}}{x}$$\n$$2\\sum_{x=1}^{n}\\frac{1}{x}-\\frac{1}{n}$$\n$$-2+2\\sum_{x=1}^{n}\\frac{1}{x}$$\n$$\\approx-2+2(\\ln n+\\gamma)$$\n$$=O(\\log n)$$\n\n\u4e8e\u662f\u5f97\u5230 $O(n\\log n)$ \u65f6\u95f4\uff0c$O(n)$ \u7a7a\u95f4\u7684\u4e00\u4e2a~~\u5e9f\u7269~~\uff0c\u4f46\u662f\u53ef\u4ee5\u8fc7\u3002\n\n```cpp\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n    b=((z1<<6)^z1)>>13;\n    z1=((z1&4294967294U)<<18)^b;\n    b=((z2<<2)^z2)>>27;\n    z2=((z2&4294967288U)<<2)^b;\n    b=((z3<<13)^z3)>>21;\n    z3=((z3&4294967280U)<<7)^b;\n    b=((z4<<3)^z4)>>12;\n    z4=((z4&4294967168U)<<13)^b;\n    return (z1^z2^z3^z4);\n    }\n}\nvoid Srand(unsigned x)\n{using namespace GenHelper;\nz1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}\nint read()\n{\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return a*32768+b;\n}\n\nint n;\nint ar[20000007];\npii cp[20000007];\nint iv[20000007];\n\nint rmq(int l, int r) {\n\tif(l > r) swap(l, r);\n\trep(i, n) if(l <= iv[i] && iv[i] <= r) return ar[iv[i]];\n\treturn 0;\n}\n\nsigned main() {\n    int m, s; cin >> n >> m >> s;\n    Srand(s);\n    rep(i, n) ar[i] = read(), cp[i].fi = -ar[i], cp[i].se = i;\n    sort(cp, cp+n);\n    rep(i, n) iv[i] = cp[i].se;\n    unsigned long long ans = 0;\n    rep(i, m) ans += rmq(read() % n, read() % n);\n    cout << ans << endl;\n}\n```",
        "postTime": 1600586253,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "[\u6211\u7684\u535a\u5ba2](https://www.cnblogs.com/Memory-of-winter/p/10228757.html)\n\n**\u9898\u76ee\u5927\u610f\uff1a**\u6709$n(n\\leqslant2\\times10^7)$\u4e2a\u6570\uff0c$m(m\\leqslant2\\times10^7)$\u4e2a\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u95ee\u533a\u95f4$[l,r]$\u4e2d\u7684\u6700\u5927\u503c\u3002\u4fdd\u8bc1\u6570\u636e\u968f\u673a\n\n**\u9898\u89e3\uff1a**\u5206\u5757\uff0c\u5904\u7406\u51fa\u6bcf\u4e2a\u5143\u7d20\u5757\u4e2d\u524d\u7f00\u6700\u5927\u503c\u548c\u540e\u7f00\u6700\u5927\u503c\uff0c\u5e76\u4e14\u5904\u7406\u51fa\u6574\u5757\u7684\u533a\u95f4\u6700\u5927\u503c\uff08\u7528$ST$\u8868\uff09\uff0c\u7136\u540e\u4f3c\u4e4e\u5c31\u53ef\u4ee5$O(1)$\u6c42\u533a\u95f4\u6700\u5927\u503c\u5566\uff01\n\n\u7136\u800c\u53d1\u73b0\u82e5$l,r$\u5728\u540c\u4e00\u5757\u4e2d\u5c31\u4f1a\u51fa\u9505\uff0c\u90a3\u5c31\u76f4\u63a5\u66b4\u529b\u67e5\u8be2\uff08\u6570\u636e\u968f\u673a\uff09\n\n\u6211\u7684\u4ee3\u7801\u8dd1\u7684\u6781\u6162\uff0c\u5927\u6982\u662f\u5199\u7684\u4e11\u5427\n\n\n\n**C++ Code\uff1a**\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n    b=((z1<<6)^z1)>>13;\n    z1=((z1&4294967294U)<<18)^b;\n    b=((z2<<2)^z2)>>27;\n    z2=((z2&4294967288U)<<2)^b;\n    b=((z3<<13)^z3)>>21;\n    z3=((z3&4294967280U)<<7)^b;\n    b=((z4<<3)^z4)>>12;\n    z4=((z4&4294967168U)<<13)^b;\n    return (z1^z2^z3^z4);\n    }\n}\nunsigned RAND;\nvoid srand(unsigned x)\n{using namespace GenHelper;\nz1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}\nint read()\n{\n    using namespace GenHelper;\n\tstatic int a, b;\n    a=rand_()&32767;\n    b=rand_()&32767;\n    return a << 15 | b;\n}\n\n#define maxn 20000010\n#define M 13\nconst int BSZ = 4480, BNUM = maxn / BSZ + 10;\nint n, m, s[maxn];\nunsigned long long ans;\n\nint Lmax[maxn], Rmax[maxn];\nint L[BNUM], R[BNUM], bel[maxn];\n\nint ST[M + 1][BNUM], LG[BNUM];\ninline int query(int l, int r) {\n\tif (l >= r) return 0;\n\tstatic int t; t = LG[r - l];\n\treturn std::max(ST[t][l], ST[t][r - (1 << t)]);\n}\n\nint main() {\n\tscanf(\"%d%d%u\", &n, &m, &RAND); srand(RAND);\n\tfor (int i = 1; i <= n; ++i) {\n\t\ts[i] = read();\n\t\tbel[i] = i / BSZ + 1;\n\t}\n\n\tconst int B = bel[n];\n\tLG[0] = -1; for (int i = 1; i <= B; ++i) LG[i] = LG[i >> 1] + 1;\n\tfor (int i = 1; i <= B; ++i) {\n\t\tL[i] = (i - 1) * BSZ;\n\t\tR[i] = L[i] + BSZ - 1;\n\t}\n\tL[1] = 1, R[B] = n;\n\tfor (int i = 1, now = 1, last = 0; i <= n; ++i) {\n\t\tLmax[i] = last = std::max(s[i], last);\n\t\tif (i >= R[now]) ST[0][now] = Lmax[i], last = 0, ++now;\n\t}\n\tfor (int i = n, now = B, last = 0; i; --i) {\n\t\tRmax[i] = last = std::max(s[i], last);\n\t\tif (i <= L[now]) last = 0, --now;\n\t}\n\tfor (int i = 1, pw = 1; i <= M; ++i, pw <<= 1) {\n\t\tfor (int j = 1; j <= B; ++j) ST[i][j] = std::max(ST[i - 1][j], ST[i - 1][std::min(j + pw, B)]);\n\t}\n\n\twhile (m --> 0) {\n\t\tint l = read() % n + 1, r = read() % n + 1;\n\t\tif (l > r) std::swap(l, r);\n\t\tconst int lb = bel[l], rb = bel[r];\n\t\tif (lb != rb) {\n\t\t\tans += std::max(std::max(Rmax[l], Lmax[r]), query(lb + 1, rb));\n\t\t} else {\n\t\t\tstatic int res; res = 0;\n\t\t\tfor (int i = l; i <= r; ++i) res = std::max(res, s[i]);\n\t\t\tans += res;\n\t\t}\n\t}\n\tprintf(\"%llu\\n\", ans);\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1546755127,
        "uid": 22072,
        "name": "Memory_of_winter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "###### \u849f\u84bb\u6211\u4e0d\u4f1a\u4ec0\u4e48\u9ad8\u7ea7\u73a9\u610f\u513f\uff08~~\u5b66\u4e0d\u61c2~~\uff09\n\u5c31\u8bd5\u7740\u5199\u4e86\u4e00\u4e0b\u5206\u5757\uff08~~\u7b2c\u4e00\u6b21~~\uff09\n\nemmmmmmmmmmmmm\n\n\u5927\u6982\u601d\u8def\u5462\u5c31\u662f\u628a\u4e00\u5b9a\u8303\u56f4\u7684\u6570\u770b\u6210\u4e00\u4e2a\u5757\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/4bn2icp6.png)\n\u50cf\u8fd9\u4e2a\u6837\u5b50\n\n\u5bf9\u4e8e\u8de8\u5757\u7684\u8be2\u95ee\u5c31\u7528ST\u8868\u7ef4\u62a4\u5373\u53ef\n\n\u4f46\u662f\u603b\u6709L, R\u4e0d\u80fd\u8de8\u8d8a\u5b8c\u6574\u7684\u5757\n\n\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u7ef4\u62a4\u6bcf\u4e2a\u5757\u5185\u6bcf\u4e00\u4e2a\u70b9\u7684\u524d\u7f00\u4e0e\u540e\u7f00\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7cwm8i2c.png)\n\n\u5c31\u50cfl\u5230a,b\u5230r\uff0c\u5c31\u8981\u7528\u540e\u7f00\u548c\u524d\u7f00\uff1b\n\n\u90a3\u4e48l\u5230r\u7684\u7b54\u6848\u5c31\u662fmax(ST[l][log2(r - 1)], ST[r - log2(r - l)][log2(r - l)], front[r], back[l]), \u4e5f\u5c31\u662f\u4e00\u4e2aO(1)\u7684\u67e5\u8be2\u4e86\uff1b\n\n\u4f46\u662f\n### \u4f46\u662f\n## \u4f46\u662f\n\u5982\u679cl\u548cr\u5728\u4e00\u4e2a\u5757\u5185\n![](https://cdn.luogu.com.cn/upload/image_hosting/rkkvqt9v.png)\n\u50cf\u8fd9\u6837\uff0c\u90a3\u5c82\u4e0d\u662f\u5c31\u5e9f\u4e86\uff01\n\n\u56e0\u4e3a\u6211\u4eec\u53ea\u7ef4\u62a4\u4e86\u4ee5\u5757\u4e3a\u5355\u4f4d\u7684\u6700\u503c\n\n\u90a3\u600e\u4e48\u529e\u5450\uff1f\n\n\u4e0d\u8981\u770b\u6211\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u554a\uff08~~\u66b4\u529b~~\uff09\n\n\u4e8e\u662f\n\n1.\u6c42\u5757\u7684\u7f16\u53f7\n```cpp\ninline Ull Ceil(Ull X)\n{\n    return (X + KUAI - 1) / KUAI;\n}\n```\n\n2.ST\u521d\u59cb\u5316\uff0c \u524d\u7f00\u540e\u7f00\u521d\u59cb\u5316\n```cpp\ninline void init()\n{\n    int New = Ceil(N);\n    int LC = log2(New);\n    for (int j = 1; j <= LC; ++j)\n        for (int i = 1; i <= New - (1 << j) + 1; ++i)\n            ST[i][j] = max(ST[i][j - 1], ST[i + (1 << (j - 1))][j - 1]);//ST\u8868\u5e38\u89c4\u64cd\u4f5c\n    \n    for (int i = 1; i <= N; ++i)\n        if (i % KUAI != 1)F[i] = max(F[i - 1], A[i]);\n        else F[i] = A[i];//F[]\u662f\u524d\u7f00\u6570\u7ec4\uff0c\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u6765\u4e00\u4e2a\u5757\u662f\u4e00\u4e2a\u8fd9\u6837\u7684\u533a\u95f4[1 + 7500K, 7500(K + 1)),K\u5c5e\u4e8e\u6574\u6570\u96c6\n    for (int i = N; i >= 1; --i)\n        if (i % KUAI)B[i] = max(B[i + 1], A[i]);\n        else B[i] = A[i];\n}\n```\n3.\u67e5\u8be2\u64cd\u4f5c\n```cpp\n//\u5199\u5f97\u6709\u70b9\u5197\u6742\uff0cemm  \u53ef\u4ee5\u4f18\u5316\u4e00\u4e0b\u7684\uff08\u61d2\uff5e\uff5e\uff09\n        Ull X = read() % N + 1, Y = read() % N + 1;\n        Ull L = min(X, Y), R = max(X, Y);\n        Ull L2 = Ceil(L), R2 = Ceil(R);//L2\uff0cR2\u5206\u522b\u662fL\uff0cR\u6240\u5728\u7684\u5757\n        Ull MAXX = max(B[L], F[R]);\n        if (R2 == L2)Ans += Work(L, R);//\u5982\u679c\u662f\u4e00\u4e2a\u5757\u5c31\u66b4\u529b\uff0c\u66b4\u529b\uff0c\u66b4\u529b\n        else if (R2 - L2 == 1)Ans += MAXX;//\u4e0b\u9762\u6709\u56fe\u89e3\u7684\n        else\n        {\n            Ull C = log2(R2 - L2 - 1);\n            Ull MAX = max(ST[L2 + 1][C], ST[R2 - (1 << C)][C]);//\u7528ST\u8868\u6c42\u5757\u7684\u7f16\u53f7\u4e3aL2 + 1 \u5230 R2 - 1\u7684\u503c\n            Ans += max(MAX, MAXX);\n        }\n```\n\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\uff0c\u90a3\u5c31\u662fl,r\u76f8\u90bb\u7684\u4e24\u5757\n![](https://cdn.luogu.com.cn/upload/image_hosting/qtfm991w.png)\n\u5c31\u76f4\u63a5\u67e5\u8be2l\u7684\u540e\u7f00\u548cr\u7684\u524d\u7f00\u5566\n\n\u55ef\u8fd8\u6709\u5c31\u662fcmath\u7684\u5934\u6587\u4ef6\u5e94\u8be5\u662f\u6709\u4e00\u4e2a\u51fd\u6570\u53eb log2() \u7684\uff0c\n\u7528\u4e0d\u4e86\u7684\u8bdd\u7528\u6362\u5e95\u516c\u5f0f\u5904\u7406\u4e00\u4e0b\uff0c\u4ee5\u4e0b\u4ee3\u7801\u662f\u7528\u6362\u5e95\u516c\u5f0f\u5904\u7406\u7684\n# CODETIME\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <cstring>\n#define KUAI 7500\n\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n        b = ((z1 << 6) ^ z1) >> 13;\n        z1 = ((z1 & 4294967294U) << 18) ^ b;\n        b = ((z2 << 2) ^ z2) >> 27;\n        z2 = ((z2 & 4294967288U) << 2) ^ b;\n        b = ((z3 << 13) ^ z3) >> 21;\n        z3 = ((z3 & 4294967280U) << 7) ^ b;\n        b = ((z4 << 3) ^ z4) >> 12;\n        z4 = ((z4 & 4294967168U) << 13) ^ b;\n        return (z1 ^ z2 ^ z3 ^ z4);\n    }\n}\n\nvoid srand(unsigned x)\n{\n    using namespace GenHelper;\n    z1 = x;\n    z2 = (~x) ^ 0x233333333U;\n    z3 = x ^ 0x1234598766U;\n    z4 = (~x) + 51;\n}\n\nint read()\n{\n    using namespace GenHelper;\n    int a = rand_() & 32767;\n    int b = rand_() & 32767;\n    return a * 32768 + b;\n}\n\ntypedef long long ll;\ntypedef unsigned long long  Ull;\n\nconst int Maxn = 2e5 + 5000;\nint N, M, S;\nUll A[Maxn * 100], ST[Maxn][20], Ans;\nUll F[Maxn * 100], B[Maxn * 100];\n\ninline Ull min(Ull X, Ull Y){return X < Y ? X : Y;}\ninline Ull max(Ull X, Ull Y){return X > Y ? X : Y;}\n\ninline Ull Ceil(Ull X)\n{\n    return (X + KUAI - 1) / KUAI;\n}\n\ninline void init()\n{\n    int New = Ceil(N);\n    int LC = log(New)/log(2);\n    for (int j = 1; j <= LC; ++j)\n        for (int i = 1; i <= New - (1 << j) + 1; ++i)\n            ST[i][j] = max(ST[i][j - 1], ST[i + (1 << (j - 1))][j - 1]);\n    \n    for (int i = 1; i <= N; ++i)\n        if (i % KUAI != 1)F[i] = max(F[i - 1], A[i]);\n        else F[i] = A[i];\n    for (int i = N; i >= 1; --i)\n        if (i % KUAI)B[i] = max(B[i + 1], A[i]);\n        else B[i] = A[i];\n}\n\ninline Ull Work(Ull L, Ull R)\n{\n    Ull Maxn(A[L]);\n    for (Ull i = L; i <= R; ++i)Maxn = max(Maxn, A[i]);\n    return Maxn;\n}\n\nint main()\n{\n    scanf(\"%d %d %d\", &N, &M, &S);\n    srand(S);\n    for (int i = 1, j(1); i <= N; ++i, j = Ceil(i))\n    {\n        A[i] = read();\n        ST[j][0] = max(A[i], ST[j][0]);\n    }\n    init();\n    while (M--)\n    {\n        Ull X = read() % N + 1, Y = read() % N + 1;\n        Ull L = min(X, Y), R = max(X, Y);\n        Ull L2 = Ceil(L), R2 = Ceil(R);\n        Ull MAXX = max(B[L], F[R]);\n        if (R2 == L2)Ans += Work(L, R);\n        else if (R2 - L2 == 1)Ans += MAXX;\n        else\n        {\n            Ull C = log(R2 - L2 - 1) / log(2);\n            Ull MAX = max(ST[L2 + 1][C], ST[R2 - (1 << C)][C]);\n            Ans += max(MAX, MAXX);\n        }\n        \n    }\n    printf(\"%lld\\n\", Ans);\n}\n```\n\n\u5982\u679c\u6211\u6709\u54ea\u91cc\u5199\u7684\u4e0d\u5bf9\u6216\u8005\u8bf4\u7684\u4e0d\u5bf9\u7684\uff0c\u6b22\u8fce\u5927\u5bb6\u79c1\u4fe1\u54e6\n\n#### \u518d\u89c1li\u00e3o",
        "postTime": 1569933050,
        "uid": 57896,
        "name": "STPGUY",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "\u663e\u800c\u6613\u89c1\n\n\u88f8st\u8868\u4e0dmle\u624d\u9b3c\n\n\u90a3\u4e48\u6211\u4eec\u81ea\u7136\u60f3\u5230\u4e00\u79cd\u5947\u5999\u7684\u7b97\u6cd5\u2014\u7b1b\u5361\u5c14\u6811\n\n\u597d\n\n\u6ca1\u4e86\n\n\u7b1b\u5361\u5c14\u6811\u677f\u5b50\u9898\n\nps\uff1a\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u7f8e\u5999\u7684\u968f\u673a\u6570\u636e\u76f4\u63a5\u4ece\u6839\u5f80\u4e0b\u904d\u5386\u5de8\u5feb\u65e0\u6bd4\uff0c\u538b\u6839\u4e0d\u7528\u6c42lca\uff0c~~\u5206\u5206\u949f\u540a\u6253\u4ec0\u4e48\u5206\u5757rmq~~\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n    b=((z1<<6)^z1)>>13;\n    z1=((z1&4294967294U)<<18)^b;\n    b=((z2<<2)^z2)>>27;\n    z2=((z2&4294967288U)<<2)^b;\n    b=((z3<<13)^z3)>>21;\n    z3=((z3&4294967280U)<<7)^b;\n    b=((z4<<3)^z4)>>12;\n    z4=((z4&4294967168U)<<13)^b;\n    return (z1^z2^z3^z4);\n    }\n}\nvoid srand(unsigned x)\n{using namespace GenHelper;\nz1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}\nint read()\n{\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return a*32768+b;\n}\nint n,m,s;\nunsigned long long sum;\nconst int maxn=20000005;\nint a[maxn];\nint fa[maxn],ls[maxn],rs[maxn];\nint build()\n{\n\tstack<int> st;\n\tint rt,last;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tlast=0;\n\t\twhile(!st.empty())\n\t\t{\n\t\t\tif(a[st.top()]>a[i])\n\t\t\t{\n\t\t\t\trt=st.top();\n\t\t\t\tif(rs[rt])\n\t\t\t\t{\n\t\t\t\t\tfa[rs[rt]]=i;\n\t\t\t\t\tls[i]=rs[rt];\n\t\t\t\t}\n\t\t\t\trs[rt]=i;\n\t\t\t\tfa[i]=rt;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlast=st.top(); st.pop();\n\t\t}\n\t\tif(st.empty()&&last)\n\t\t{\n\t\t\tfa[last]=i;\n\t\t\tls[i]=last;\n\t\t}\n\t\tst.push(i);\n\t}\n\twhile(!st.empty())\trt=st.top(), st.pop();\n\treturn rt;\n}\n\nint query(int root,int l,int r)\n{\n\twhile(root<l||root>r)\n\t\troot= root<l? rs[root]:ls[root];\n\treturn root;\n}\nint main()\n{\n\tcin>>n>>m>>s;\n\tsrand(s);\n\tfor(int i=1;i<=n;i++)\n\ta[i]=read();\n\tint root=build();\n\tint l,r;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tl=read()%n+1,r=read()%n+1;\n\t\tif(l>r)\n\t\tswap(l,r);\n\t\tsum+=a[query(root,l,r)];\n\t}\n\tcout<<sum;\n\treturn 0;\n}\n```\n",
        "postTime": 1576314185,
        "uid": 258332,
        "name": "fly_me_2_the_moon",
        "ccfLevel": 3,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u5e8f\u5217\uff0c\u6c42\u6bcf\u6b21\u8be2\u95ee\u533a\u95f4\u7684RMQ\u3002\n\n## \u9898\u89e3\n\n\u4e0d\u5e26\u4fee\u7684RMQ\u6211\u4eec\u4e00\u822c\u4f7f\u7528\u7684\u662fST\u8868\u6c42\u3002\u4f46\u8fd9\u9053\u9898ST\u8868 $\\Theta(n\\log n)$ \u7684\u7a7a\u95f4\u5f53\u573a\u53bb\u4e16\u3002\n\n\u6211\u4eec\u8003\u8651\u628a\u5e8f\u5217\u5206\u4e2a\u5757\u513f\u3002\u7531\u4e8e\u67e5\u8be2\u7684\u533a\u95f4\u4e0d\u4e00\u5b9a\u4f1a\u5b8c\u5168\u8986\u76d6\u5b8c\u4e00\u4e2a\u5757\u513f\uff0c\u6240\u4ee5\u6211\u4e48\u9700\u8981\u6c42\u51fa\u6bcf\u4e2a\u5757\u513f\u4e2d\u7684\u524d/\u540e\u7f00\u6700\u5927\u503c\uff0c\u7136\u540e\u7528ST\u8868\u641e\u51fa\u6574\u4e2a\u5757\u513f\u7684\u6700\u5927\u503c\u3002\n\n\u4f46\u662f\u5982\u679c $l,r$ \u5728\u540c\u4e00\u4e2a\u5757\u513f\u5185\u7684\u8bdd\u5c31\u4f1a\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u5f53\u67e5\u8be2\u533a\u95f4\u7684\u4e24\u7aef\u70b9\u5728\u540c\u4e00\u4e2a\u5757\u513f\u5185\u7684\u65f6\u5019\u6211\u4eec\u5c31\u76f4\u63a5\u66b4\u529b\u67e5\u8be2\u3002\n\n```cpp\nconst int N = 2e7 + 5;\nconst int SQN = 4500 + 5;\nconst int LGSQN = 10 + 5;\nint n, m, s, block = 7500;\n__uint64 f[SQN][LGSQN], a[N];\n__uint64 ans, cpy[N], pas[N];\n\n__uint64 get(__uint64 x) {\n\treturn (x + block - 1) / block;\n}\n\n__uint64 ret(__uint64 l, __uint64 r) {\n\t__uint64 res = a[l];\n\tfor (__uint64 i = l; i <= r; ++i) res = max(res, a[i]);\n\treturn res;\n}\n\nsigned main() {\n\tread(n, m, s);\n\t_srand(s);\n\tfor (int i = 1, j = 1; i <= n; ++i, j = get(i)) {\n\t\ta[i] = _read();\n\t\tf[j][0] = max(a[i], f[j][0]);\n\t}\n\tint mot = get(n);\n\tint fck  = log2(mot);\n\tfor (int j = 1; j <= fck; ++j)\n\t\tfor (int i = 1; i <= mot - (1 << j) + 1; ++i)\n\t\t\tf[i][j] = max(f[i][j - 1], f[i + (1 << (j - 1))][j - 1]);\n\tfor (int i = 1; i <= n; ++i)\n\t\tif (i % block != 1) pas[i] = max(pas[i - 1], a[i]);\n\t\telse pas[i] = a[i];\n\tfor (int i = n; i >= 1; --i)\n\t\tif (i % block) cpy[i] = max(cpy[i + 1], a[i]);\n\t\telse cpy[i] = a[i];\n\tfor (int i = 0; i < m; ++i) {\n\t\t__uint64 x = _read() % n + 1;\n\t\t__uint64 y = _read() % n + 1;\n\t\tif (x > y) swap(x, y);\n\t\t__uint64 l = get(x), r = get(y);\n\t\t__uint64 MAX = max(cpy[x], pas[y]);\n\t\tif (l == r) ans += ret(x, y);\n\t\telse if (r - l == 1) ans += MAX;\n\t\telse {\n\t\t\t__uint64 k = log2(r - l - 1);\n\t\t\t__uint64 t = max(f[l + 1][k], f[r - (1 << k)][k]);\n\t\t\tans += max(MAX, t);\n\t\t}\n\t}\n\twrite(io_l, ans);\n}\n```",
        "postTime": 1590909806,
        "uid": 161849,
        "name": "cirnovsky",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "**~~\u5185\u5b58\u80fd\u5f001G\u5417~~**\n\n\u6211\u63d0\u4f9b\u4e00\u79cd\u5185\u5b58$\\geqslant 1G$\u4f46\u65f6\u95f4\u6bd4\u8f83\u4f18\u7684\u65b9\u6cd5\n\n\u4e5f\u5c31\u662f\u6240\u8c13\u7684$O(n)$\u9884\u5904\u7406\uff0c$O(1)$\u5355\u6b21\u67e5\u8be2\u7684$rmq$\n\n\u697c\u4e0a\u5df2\u7ecf\u63d0\u5230\u4e86$Fast$\u7684\u7b1b\u5361\u5c14\u6811\n\n\u6211\u6765\u89e3\u91ca\u4e00\u4e0b\uff1a**\u7b1b\u5361\u5c14\u6811**\u662f\u4e00\u79cd\u7279\u5b9a\u7684\u4e8c\u53c9\u6811\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u5177\u6709\u5806\u7684\u6709\u5e8f\u6027\uff0c\u4e2d\u5e8f\u904d\u5386\u53ef\u4ee5\u8f93\u51fa\u539f\u6570\u5217\u3002\n\n[\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u8f6c\u95e8\u627e\u5ea6\u5a18](https://baike.baidu.com/item/%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91/7579802?fr=aladdin)\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u975e\u5e38\u4f18\u7f8e\u7684\u6027\u8d28\uff0c\u5373\u5efa\u4e00\u73c2\u5982\u4e0b\u7684\u7b1b\u5361\u5c14\u6811\uff1a\u5f53$N=0$\uff0c\u5b83\u662f\u4e00\u68f5\u7a7a\u6811\uff0c\u5426\u5219\u5b83\u7684\u6839\u8282\u70b9\u662f$A$\u4e2d\u7684\u4e00\u4e2a\u6700\u5c0f\u5143\u7d20$A_i$\uff08\u5e76\u4ee5\u8fd9\u4e2a\u6700\u5c0f\u5143\u7d20\u7684\u4e0b\u6807i\u6807\u8bb0\uff09\uff0c\u800c\u5de6\u53f3\u5b50\u6811\u5206\u522b\u662f$A_1-A_{i-1}$\u548c$A_{i+1}-A_{n}$\u7684\u4e00\u68f5\u7b1b\u5361\u5c14\u6811\u3002\n\n\u6b64\u65f6\u8be2\u95ee$L$\u5230$R$\u7684\u533a\u95f4\u6700\u5c0f\u503c\uff0c\u7b49\u540c\u4e8e\u8be2\u95ee$A$\u4e2d\u7f16\u53f7\u4e3a$lca(L,R)$\u7684\u6570\uff08\u8fd9\u91cc\u6211\u4eec\u94a6\u5b9a$lca$\u6307\u7b1b\u5361\u5c14\u6811\u91cc\u7684$lca$\uff09\n\n\u6c42$lca$\u7b97\u6cd5\u6709\uff1a\u6811\u5256\u3001$Tarjan$\u3001$\\pm1rmq$\u3001\u500d\u589e$\\ldots \\ldots$\n\n\u6211\u8fd9\u91cc\u9009\u7528$O(n)$\u9884\u5904\u7406\uff0c\u79bb\u7ebf$O(q)$\u67e5\u8be2\u7684$Tarjan$\uff0c\u9898\u89e3\u4e00\u5927\u5806\uff0c\u4e5f\u8bf7\u8f6c\u95e8\u627e\u5ea6\u5a18\n\n\u8fd9\u6837\u5c31\u80fd\u5728$O(n+q)$\u91cc\u6c42\u51fa$LCA$\uff0c\u518d\u7d2f\u52a0\u5373\u53ef\n\n~~\u4e0d\u8fc7Tarjan\u548crmq\u5185\u5b58\u592a\u5927\u4e86~~\n\n\u8bdd\u8bb2\u5230\u8fd9\u91cc\uff0c\u5982\u4f55\u6c42\u533a\u95f4\u6700\u5927\u503c\n\n\u7528$2\\times 10^9$\u53bb\u51cf\u5c31\u53ef\u4ee5\u4e86\uff01~~\uff08\u4f60\u5f53\u6211\u50bb\u5417\uff1f\uff09~~\n\n\u7531\u6b64\uff0c\u6211\u4eec\u5f97\u5230\u4e86$O(n+q)$\u5b8c\u6210\u533a\u95f4\u6700\u5927\u503c\u7684\u79bb\u7ebf\u7b97\u6cd5\u3002\uff08\u4e0d\u8fc7luogu\u5185\u5b58\u5c0f\uff0c\u8fd8\u662f\u8fc7\u4e0d\u4e86\uff0cMLE\uff09\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define un unsigned\n#define ull un ll\n#define re register\n#define rt re int\ntemplate<typename T>inline void read(T&x) {\n    char ch=getchar();\n    x=0;\n    bool f=0;\n    for(; ch<'0'||ch>'9'; ch=getchar())if(ch=='-')f=1;\n    for(; ch>='0'&&ch<='9'; x=(x<<1)+(x<<3)+(ch^48),ch=getchar());\n    if(f)x=-x;\n}\ntemplate<typename T>inline void write(T x) {\n    if(x<0)x=-x,putchar('-');\n    if(x>9)write(x/10);\n    putchar(x%10+48);\n}\ntemplate<typename T>inline void writeln(T x) {\n    write(x),putchar('\\n');\n}\nconst int N=2e6+5;\nstruct node {\n    int to,next;\n} e[N<<1];\nint fa[N],sta[N>>7],top=0,root,Ecnt,Enum;\nint head[N],vis[N],qhead[N];\null a[N],an[N],ans;\nint n,m,s;\n// Tarjan + LCA\nstruct Que {\n    int to,next,lca;\n} q[N<<1];\n// build the tree\ninline void build() {\n    memset(fa,0,sizeof(fa));\n    memset(vis,0,sizeof(vis));\n    top=0;\n    for(int i=1; i<=n; i++) {\n        int k=top;\n        for(; k&&a[sta[k]]>a[i]; k--);\n        if(k)fa[i]=sta[k];\n        if(k<top)fa[sta[k+1]]=i;\n        sta[++k]=i;\n        top=k;\n    }\n    root=sta[1];\n}\ninline void add(int u,int v) {\n    e[++Ecnt]=(node) {v,head[u]},head[u]=Ecnt;\n}\ninline void addq(int u,int v) {\n    q[++Enum]=(Que) {v,qhead[u]},qhead[u]=Enum;\n}\ninline int get(register int x){return fa[x]==x?x:fa[x]=get(fa[x]);}\n//Tarjan LCA\ninline void dfs(int x) {\n    fa[x]=x;\n    vis[x]=1;\n    for(int k=head[x]; k; k=e[k].next)\n        if(!vis[e[k].to]) {\n            dfs(e[k].to);\n            fa[e[k].to]=x;\n        }\n    for(int k=qhead[x]; k; k=q[k].next)\n        if(vis[q[k].to]) {\n            q[k].lca=get(q[k].to);\n            if(k&1)\n                q[k+1].lca=q[k].lca;\n            else\n                q[k-1].lca=q[k].lca;\n        }\n}\nnamespace GenHelper {\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_() {\n        b=((z1<<6)^z1)>>13;\n        z1=((z1&4294967294U)<<18)^b;\n        b=((z2<<2)^z2)>>27;\n        z2=((z2&4294967288U)<<2)^b;\n        b=((z3<<13)^z3)>>21;\n        z3=((z3&4294967280U)<<7)^b;\n        b=((z4<<3)^z4)>>12;\n        z4=((z4&4294967168U)<<13)^b;\n        return (z1^z2^z3^z4);\n    }\n}\ninline void sran(unsigned x) {\n    using namespace GenHelper;\n    z1=x;\n    z2=(~x)^0x233333333U;\n    z3=x^0x1234598766U;\n    z4=(~x)+51;\n}\ninline int rd() {\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return a*32768+b;\n}\n//function main\nint main() {\n    int cas=1;\n    for(; cas--;) {\n        read(n);\n        read(m);\n        read(s);\n        sran(s);\n        Ecnt=Enum=0;\n        memset(head,0,sizeof(head));\n        memset(qhead,0,sizeof(qhead));\n        for(int i=1; i<=n; i++)a[i]=2e9-rd();\n        build();\n        for(int i=1; i<=n; i++) {\n            if(fa[i])add(fa[i],i),add(i,fa[i]);\n            fa[i]=i;\n        }\n        for(int i=1,x,y; i<=m; i++) {\n            x=rd()%n+1;\n            y=rd()%n+1;\n            if(x>y)swap(x,y);\n            //if(x==y)an[i]=a[x];\n            addq(x,y);\n            addq(y,x);\n        }\n        dfs(root);\n        ans=0;\n        for(int i=1; i<=m; i++) {\n            ans+=(2e9-a[q[i<<1].lca]);\n        }\n        writeln(ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1563602417,
        "uid": 101891,
        "name": "cyn2006",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    },
    {
        "content": "# \u8b66\u544a\uff01\u5361\u5e38\u8b66\u544a\uff01\uff01\uff01\n\u6781\u5ea6\u5361\u5e38\u7684\u4e00\u9053\u9898\u3002\u5c31\u662f\u6570\u636e\u8303\u56f4\u6781\u5927\u7684RMQ\uff0c\u6570\u636e\u968f\u673a\uff0c~~\u51fa\u9898\u4eba\u592a\u61d2\u4e86\u8ba9\u6211\u4eec\u81ea\u5df1\u9020\u6570\u636e~~\n\n\u9996\u5148st\u8868\u548c\u7ebf\u6bb5\u6811\u80af\u5b9a\u90fd\u8fc7\u4e0d\u53bb\uff0c$ nlogn $\u7684\u65f6\u95f4\u5728$ n=2e7 $\u7684\u60c5\u51b5\u4e0b\u867d\u7136\u4e0d\u4f1aTLE\uff08\u5047\u5982\u5e38\u6570\u5927\u4e86\u8fd8\u662f\u4f1aTLE\u7684\uff09\uff0c\u4f46\u662f\u7a7a\u95f4\u80af\u5b9a\u7206\u4e86\uff0c\u4e8e\u662f\u5c1d\u8bd5\u4f18\u5316\u3002\n\n\u7528\u4ec0\u4e48\u4f18\u5316\u5462\uff1f\u7ebf\u6bb5\u6811\uff1f\u4e0d\u884c\uff0c\u7a7a\u95f4\u5927\uff0c\u65f6\u95f4\u5927\uff0c\u5e38\u6570\u8fd8\u5927\u3002\u5e73\u8861\u6811\uff1f\u4f3c\u4e4e\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u5e38\u6570\u5927\u4e86\u5c31\u4f1aTLE\u3002\u90a3\u600e\u4e48\u529e\u5462\uff1f\u8981\u628a\u9636\u7ea7\u964d\u4f4e\u624d\u884c\u3002\u8bf4\u5230\u8fd9\u4e2a\u7684\u8bdd\uff0c\u4e00\u5b9a\u80fd\u591f\u60f3\u5230\u8fd9\u4e2a\u4e1c\u897f\uff1a\n# \u5206\u5757\n\u6ca1\u9519\u662f\u7684\u3002\n\n\u5206\u6210$ \\sqrt n $\u4e2a\u5757\uff0c\u6bcf\u4e00\u4e2a\u5757\u7684\u5927\u5c0f\u662f$ \\sqrt n $\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728\u5757\u4e0aRMQ\uff0c\u9884\u5904\u7406\u7684\u65f6\u95f4\u662f$ O( \\sqrt nlog \\sqrt n) $\u3002\n\n\u56e0\u4e3aC++\u81ea\u5e26\u7684$ log $\u51fd\u6570\u592a\u6162\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u521d\u59cb\u5316\uff1a\n```cpp\nint log[20000005]={-1};\nfor(register int i=1;i<=n;++i)\n{\n\tlog[i]=log[i>>1]+1;\n}\n```\n\u8fd9\u6837\u521d\u59cb\u5316\u5bf9\u4e8eLCA\u7684\u500d\u589e\u7b97\u6cd5\u4e5f\u6709\u6548\u3002\u4e0d\u8fc7\u8981\u6ce8\u610f\u7684\u662f\u5982\u679c\u662fLCA\u7684\u8bddlog\u6570\u7ec4\u4e0d\u7528\u521d\u59cb\u5316\u3002\n\n\u7136\u540e\u5c31\u662f\u5206\u7c7b\u8ba8\u8bba\u3002\n# 1. L\u548cR\u5728\u4e00\u4e2a\u5757\u5185\u3002\n\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u66b4\u529b\u5c31\u884c\u4e86\u3002\n# What\uff1f\u4f60\u4e0d\u6015\u8d85\u65f6\u5417\uff1f\n\u771f\u7684\u4e0d\u6015\u3002\u56e0\u4e3a\u6570\u636e\u968f\u673a\uff0c\u6240\u4ee5L\u548cR\u5728\u540c\u4e00\u4e2a\u5757\u5185\u7684\u6982\u7387\u662f$ \\frac 1 n $\uff0c\u6240\u4ee5\u65f6\u95f4\u4e5f\u4e0d\u4f1a\u5927\u5230\u54ea\u513f\u53bb\u3002\u5c31\u7b97\u662f$ \\frac {1} {\\sqrt n} $\u5427\uff0c\u65f6\u95f4\u4e5f\u662f$ \\sqrt n \\times \\sqrt n$\uff0c\u4e0d\u4f1a\u8d85\u65f6\u3002\n# 2. \u4e0d\u5728\u540c\u4e00\u4e2a\u5757\u5185\u5e76\u4e14\u6240\u5728\u5757\u4e0d\u76f8\u90bb\n\u4e0d\u591a\u8bf4\uff0c\u5c31\u662f\u76f4\u63a5ST\u8868\u3002\u4f46\u662fL\u548cR\u4e0d\u4e00\u5b9a\u662f\u5404\u81ea\u6240\u5728\u7684\u5757\u7684\u5206\u754c\u7ebf\u3002\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u8bb0\u4e00\u4e2a\u524d\u7f00\u6700\u5927\u548c\u540e\u7f00\u6700\u5927\uff0c\u8fd9\u6837\u7b97\u6cd5\u5c31\u4e0d\u4f1a\u9000\u5316\u6210$ O( n^{ \\frac 3 2 } ) $\u4e86\u3002\n# 3. \u4e0d\u5728\u540c\u4e00\u4e2a\u5757\u5185\u5e76\u4e14\u6240\u5728\u5757\u76f8\u90bb\n\u8fd9\u6837\u7684\u8bddST\u8868\u5c31\u5931\u6548\u4e86\uff0c\u56e0\u4e3a\u8981\u67e5\u8be2\u7684\u533a\u95f4\u91cc\u9762\u6ca1\u6709\u5728ST\u8868\u5185\u7684\u5143\u7d20\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u53ea\u8981\u627e\u5230L\u6240\u5728\u5757\u7684\u540e\u7f00\u6700\u5927\u548cR\u6240\u5728\u5757\u7684\u524d\u7f00\u6700\u5927\uff0c\u53d6\u4e24\u4e2a\u6700\u5927\u7684\u5c31\u884c\u4e86\u3002\n\n\u8fd9\u6837\u5c31\u641e\u5b9a\u8fa3\uff01\n\n\u4e0d\u8fc7\u672c\u9898\u6781\u5ea6\u5361\u5e38\uff0c\u8d34\u4e0a\u81ea\u5df1\u88ab\u5361\u5e38\u7684\u4ee3\u7801\uff1a\n```cpp\n#include<iostream>\nconst int M=2e7+5;unsigned long long ans;\nint st[4505][15],mL[M],mR[M],a[M];\nint n,m,s,t,p=4480,l[4505],x[4505],y[4505],bl[M];\ninline int max(int a,int b){return a>b?a:b;}\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n    b=((z1<<6)^z1)>>13;\n    z1=((z1&4294967294U)<<18)^b;\n    b=((z2<<2)^z2)>>27;\n    z2=((z2&4294967288U)<<2)^b;\n    b=((z3<<13)^z3)>>21;\n    z3=((z3&4294967280U)<<7)^b;\n    b=((z4<<3)^z4)>>12;\n    z4=((z4&4294967168U)<<13)^b;\n    return (z1^z2^z3^z4);\n    }\n}\nvoid srand(unsigned x)\n{using namespace GenHelper;\nz1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}\nint read()\n{\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return a*32768+b;\n}\ninline void ask(int L,int R)\n{\n\tif(L>R)std::swap(L,R);int res=0;\n\tif(bl[L]==bl[R])\n\t{\n\t\tfor(int i=L;i<=R;++i)res=max(res,a[i]);\n\t\tans+=res;return;\n\t}if(bl[R]-bl[L]==1){ans+=max(mR[L],mL[R]);return;}\n\tint k=l[bl[R]-bl[L]-1];\n\tres=max(st[bl[L]+1][k],st[bl[R]-(1<<k)][k]);\n\tres=max(res,max(mR[L],mL[R]));ans+=res;\n}\nsigned main()\n{\n\tint i,j;std::cin>>n>>m>>s;srand(s);\n\tfor(i=1;i<=n;++i)\n\t{\n\t\ta[i]=read();bl[i]=i/p+1;\n\t\tst[bl[i]][0]=max(st[bl[i]][0],a[i]);\n\t}t=bl[n];l[0]=-1;\n\tfor(i=1;i<=t;++i)\n\t{\n\t\tl[i]=l[i-1]+((1<<l[i-1]+1)==i);\n\t\tx[i]=(i-1)*p;y[i]=x[i]+p-1;\n\t}x[1]=1;y[t]=n;\n\tfor(i=1;i<=n;++i)mL[i]=max(a[i],i^x[bl[i]]?mL[i-1]:0);\n\tfor(i=n;i>=1;--i)mR[i]=max(a[i],i^y[bl[i]]?mR[i+1]:0);\n\tfor(j=1;(1<<j)<=t;++j)for(i=1;i+(1<<j)-1<=t;++i)\n\tst[i][j]=max(st[i][j-1],st[i+(1<<j-1)][j-1]);\n\tfor(;m;--m)ask(read()%n+1,read()%n+1);std::cout<<ans;\n}\n```",
        "postTime": 1585223324,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u636e\u7ed3\u6784 \u5206\u5757+ST\u8868 P3793\u9898\u89e3"
    },
    {
        "content": "\u849f\u84bb\u9996A\u7684\u9ed1\u9898\uff0c~~\u5176\u5b9e\u662f\u5f88\u5361\u5e38\u7684\u666e\u53ca\u7ec4\u77e5\u8bc6\u70b9\u9898\u76ee\uff08\u96fe\uff09~~\n\n\u540c\u65f6\u5c0f\u58f0\u5410\u69fd\uff1a~~\u8bc4\u6d4b\u673a\u8bc4\u6d4b\u8d77\u8fd9\u79cd\u5361\u5e38\u9898\u6765\u662f\u771f\u7684\u4e0d\u9760\u8c31\u554a\uff08\u6342\u8138\uff09~~\n\n\u8a00\u5f52\u6b63\u4f20\uff0c\u672c\u840c\u65b0\u65e2\u7136\u662f\u9996A\u9ed1\u9898\uff0c\u663e\u7136\u662f\u4e0d\u4f1a\u7b1b\u5361\u5c14\u6811+\u4f18\u5148\u6808\u7684\u9ad8\u7ea7\u7b97\u6cd5\u7684\uff0c\u81ea\u7136\u53ea\u80fd\u9009\u7528\u5e38\u7528\u7684\u5206\u5757+ST\u8868\n\n\u770b\u7740$O(n)$\u7684\u590d\u6742\u5ea6\uff0c\u548c\u4ece\u9898\u89e3\u5b66\u4e60\u6765\u7684\u5168\u65b0ST\u8868\u8f85\u52a9\u5206\u5757RMQ(\u8bf7\u653e\u5fc3\uff0c\u672c\u4eba\u771f\u7684\u662f\u5b66\u4e60\u6765\u7684\uff0c\u5206\u5757\u548cST\u7684\u6a21\u677f\u672c\u4eba\u603b\u80cc\u5f97\u4e0b\u6765\uff0c\u4e3e\u62a5\u6284\u9898\u89e3\u7684\u8bf7\u505c\u4e0b)\uff0c\u672c\u849f\u84bb\u5174\u51b2\u51b2\u5730\u4ea4\u4e86\u4e0a\u53bb----60\uff0cMLE\uff01\n\n\u7136\u540e\u53bb\u518d\u5b9a\u775b\u770b\u4e86\u4e00\u773c\u9898\u89e3----\u4eba\u5bb6\u5168\u90e8\u7528\u7684\u90fd\u662f`int`\uff0c\u81ea\u5df1\u5374\u5f00\u4e86`long long`\uff08\u6342\u8138+1\uff09\u3002\u5bf9\u8fd9\u79cd\u6bd2\u7624\u4e4b\u751a\u7684\u5565\u90fd\u5361\u9898\uff0c\u6ee5\u5f00`long long`\u80fd\u70b8\u5f97\u4e94\u5f69\u6591\u6593\u554a\uff01\n\n\u6539\u4e86\u4e00\u770b----70\uff0cTLE\u2026\u2026\u4e0d\u8fc7\u561b\uff0c\u597d\u6b79\u7a7a\u95f4\u662f\u591f\u7528\u4e86(300MB+/500MB)\n\n\u5728\u6570\u6b21\u65e0\u679c\u800c\u7ec8\u7684\u5c1d\u8bd5\u540e\uff0c\u6211\u8be2\u95ee\u4e86\u4e4b\u524d\u7684\u4e00\u4f4d\u540c\u5b66\uff0c\u5c06ST\u8868\u90e8\u5206\u7684`temp=log(rr-ll+1)/log(2)`\u6539\u4e3a\u9884\u5148\u5904\u7406\uff0c\u662f\u4e3a\u201c\u4ee5\u7a7a\u95f4\u6362\u5e38\u6570\u201d\u4e5f\uff0c\u597d\u751f\u63a8\u4e0a80\u5206\u3002\n\n\u56e0\u4e3a\u6700\u7ec8\u5b9e\u5728\u662f\u60f3\u4e0d\u51fa\u7ed9#2/#10\u538b\u69a8\u51fa30%\u5e38\u6570\u7684\u65b9\u6cd5\uff0c\u672c\u4eba\u5f53\u65f6\u9009\u62e9\u4e86~~\u9762\u5411\u6570\u636e\u7f16\u7a0b~~\uff0c\u5728\u6298\u817e\u4e86\u4e00\u5929\u540e\u603b\u7b97\u662f\u8fc7\u4e86\u8fd9\u9053~~\u6bd2\u7624\u9898~~\n\n\u53ef\u662f----\u5361\u5e38\u591a\u597d\u73a9\u554a\uff01~~\uff08\u96fe\uff09~~\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u4fbf\u8bf7\u6765\u4e86\u6211\u4eec\u719f\u6089\u7684\u597d\u670b\u53cb\uff0c`zkw`\u7ebf\u6bb5\u6811\uff0c\u6d4b\u8bd5\u5b83\u7684\u901f\u5ea6\uff01\n\n\u6d4b\u8bc4\u7ed3\u679c\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2vji8ev4.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u8003\u8651\u5230$2\\times10^7\\times(\\log_{2}{2\\times10^7})=4.85\\times10^8$\uff0c\u800c\u4e00\u822c\u7535\u8111\u7a0b\u5e8f\u6bcf\u79d2\u5e73\u5747\u80fd\u652f\u6491\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u7b97\u529b\u7ea6\u5728$10^8/s$\uff0c\u672c\u9898\u5bf9$O(nlogn)$\u7a0b\u5e8f\u7684\u5e38\u6570\u8981\u6c42\u53ef\u8c13\u662f\u53ef\u6016\u7684----\u5c24\u5176\u662f\u7ebf\u6bb5\u6811\u8fd9\u79cd\u5927\u91cf\u8fd0\u7528\u4f4d\u8fd0\u7b97\u7684\u7a0b\u5e8f\u3002\n\n\u4ee5\u4e0b\u653e\u672c\u4eba\u5927\u91cf\u53c2\u8003\u4e86\u6d1b\u8c37\u65e5\u62a5#35\u7684zkw\u7ebf\u6bb5\u6811\u4ee3\u7801\uff1a\n\n```cpp\n//\u706b\u8f66\u5934\u7565\n#define max(a,b) ((a)>(b))?(a):(b)//\u8fd9\u4e1c\u897f\u5bf9\u5e38\u6570\u4f18\u5316\u4f3c\u4e4e\u5927\u6709\u597d\u5904\n#include<bits/stdc++.h>\n#define maxn 20000005\nusing namespace std;\n\nint N,n,m,s,l,r,tree[maxn<<2];\n\nunsigned long long cnt;\n\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n    b=((z1<<6)^z1)>>13;\n    z1=((z1&4294967294U)<<18)^b;\n    b=((z2<<2)^z2)>>27;\n    z2=((z2&4294967288U)<<2)^b;\n    b=((z3<<13)^z3)>>21;\n    z3=((z3&4294967280U)<<7)^b;\n    b=((z4<<3)^z4)>>12;\n    z4=((z4&4294967168U)<<13)^b;\n    return (z1^z2^z3^z4);\n    }\n}\nvoid srand(unsigned x)\n{using namespace GenHelper;\nz1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}\nint read()\n{\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return (a<<15)+b;\n}\n\ninline void build(int n){\n    for(N=1;N<=n;N<<=1);\n    for(register int i=N+1;i<=N+n;++i) tree[i]=read();\n    for(register int i=N-1;i;--i) tree[i]=max(tree[i<<1],tree[i<<1|1]);\n} \n\ninline int query(int s, int t) {\n    int ans = 0;\n    for(s = N + s - 1, r = N + r + 1; s ^ r ^ 1; s >>= 1, r >>= 1) {\n        if(~s&1) ans = max(ans,tree[s^1]);\n        if(r&1) ans = max(ans,tree[r^1]);\n    }\n    return ans;\n}\n\nint main(){\n    scanf(\"%d%d%d\",&n,&m,&s);\n    srand(s);\n    build(n);\n    for(;m;m--){\n    \tl=read()%n+1,r=read()%n+1;\n        if(l>r)swap(l,r);\n        cnt+=query(l,r); \n    }\n    printf(\"%lld\\n\",cnt);\n}\n```\n\n\u5728\u6b64\uff0c\u672c\u4eba\u8bda\u631a\u6b22\u8fce\u5404\u4f4d\u5361\u5e38\u795e\u4ed9\u4eec\u80fd\u63d0\u4f9b\u67d0\u79cd\u624b\u6bb5\uff0c\u4f7f\u5f97\u4e0d\u7ecf\u8fc7\u9762\u5411\u6570\u636e\u7f16\u7a0b\u7684zkw\u7ebf\u6bb5\u6811\u80fd\u901a\u8fc7\u672c\u9898\uff0c\u5148\u97a0\u8eac~\n\n\u597d\u5427\uff0c\u56de\u5230\u91cd\u70b9----\u5206\u5757+ST\uff01\n\n\u8be5\u7b97\u6cd5\u539f\u7406\u5176\u4ed6\u9898\u89e3\u5df2\u7ecf\u8bb2\u5f97\u8f83\u6e05\u695a\u4e86\uff0c\u672c\u4eba\u5c31\u653e\u4e00\u4e2a\u51d1\u5408\u80fd\u770b\u8138\u5361\u8fc7\u7684\u4ee3\u7801\u5427qwq\uff1a\n\n```cpp\n//\u706b\u8f66\u5934\u7565\n#include<bits/stdc++.h>\n\n//#include<Windows.h>\n\n#define maxn 20000001\n#define maxs 4500\nusing namespace std;\n\nint n,m,s,len,cnt,l,r,ll,rr,temp,a[maxn],be[maxn],dp[maxs][14],rm[maxn],lm[maxn];\n\nunsigned long long ans=0;\n\n//dp for Sparse-table based O(1) cross-chunk queries\n//rm and lm for the prefix and suffix max for the specific chunk\n//be for the chunk where the chunk was located in\n\nnamespace GenHelper\n{\n    unsigned z1,z2,z3,z4,b;\n    unsigned rand_()\n    {\n    b=((z1<<6)^z1)>>13;\n    z1=((z1&4294967294U)<<18)^b;\n    b=((z2<<2)^z2)>>27;\n    z2=((z2&4294967288U)<<2)^b;\n    b=((z3<<13)^z3)>>21;\n    z3=((z3&4294967280U)<<7)^b;\n    b=((z4<<3)^z4)>>12;\n    z4=((z4&4294967168U)<<13)^b;\n    return (z1^z2^z3^z4);\n    }\n}\nvoid srand(unsigned x)\n{using namespace GenHelper;\nz1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}\nint read()\n{\n    using namespace GenHelper;\n    int a=rand_()&32767;\n    int b=rand_()&32767;\n    return a*32768+b;\n}\n\nlong long query(long long from,long long to){\n    cnt=0;\n    \n    if(to<from) swap(to,from);\n    \n    ll=be[from],rr=be[to];\n    \n//\tprintf(\"%d %d %d %d \",from,to,ll,rr);\n    \n    if(ll==rr){\n    \tfor(int i=from;i<=to;i++) cnt=max(cnt,a[i]);\n    }\n    \n/*\tif(rr-ll==1){\n    \tcnt=max(cnt,max(lm[from],rm[to]));\n    }*/\n    \n    if(rr-ll>=1){\n    \tcnt=max(cnt,max(lm[from],rm[to]));\n    \tif(rr-ll==1){\n    \t\treturn cnt;\n    \t}\n    \trr--,ll++;\n    \ttemp=log(rr-ll+1)/log(2);\n    \tcnt=max(cnt,max(dp[ll][temp],dp[rr-(1<<temp)+1][temp]));\n    }\n    \n/*\tfor(long long i=from;i<=min(to,be[from]*len);i++) cnt=min(cnt,a[i]);\n    if(be[from]!=be[to]){\n        for(long long i=(be[to]-1)*len+1;i<=to;i++) cnt=min(cnt,a[i]);\n    }\n    for(long long i=be[from]+1;i<=be[to]-1;i++) cnt=min(cnt,val[i]);*/\n    return cnt;\n}\n\nint main(){\n    scanf(\"%d%d%d\",&n,&m,&s);\n//    DWORD start_time = GetTickCount();\n    srand(s);\n    len=sqrt(n);\n    \n    for(int i=1;i<=n;i++){\n    \tbe[i]=(i-1)/len+1;\n    \ta[i]=read();\n\t\tdp[be[i]][0]=max(dp[be[i]][0],a[i]);\n    \trm[i]=(be[i]==be[i-1])?(a[i]>=rm[i-1]?a[i]:rm[i-1]):a[i];\n    }\n    \n    for(int i=n;i>=1;i--){\n    \tlm[i]=(be[i]==be[i+1])?(a[i]>=lm[i+1]?a[i]:lm[i+1]):a[i];\n    }\n/*\tfor(int i=1;i<=n;i++) printf(\"%d \",lm[i]);\n//\tprintf(\"\\n\");\n    \n//\tfor(int i=1;i<=be[n];i++) printf(\"%d \",val[i]);\n//\tprintf(\"\\n\");\n    \n    for(int i=1;i<=be[n];i++) dp[i][0]=val[i];*/\n    for(int j=1;(1<<j)<=be[n];j++)for(int i=1;i+(1<<j)<=be[n]+1;i++)dp[i][j]=max(dp[i][j-1],dp[i+(1<<j-1)][j-1]);\n    \n    for(;m;m--){\n    \tl=read()%n+1,r=read()%n+1;\n        ans+=query(l,r); \n    }\n    printf(\"%lld\\n\",ans);\n//    DWORD end_time = GetTickCount();\n//    cout << \"The run time is:\" << (end_time - start_time) << \"ms!\" << endl;\n}\n```\n\n\u90e8\u5206\u6570\u7ec4\u7684\u610f\u4e49\u53ef\u80fd\u4e0d\u751a\u660e\u4e86\uff0c\u6b22\u8fce\u5229\u7528\u5404\u79cd\u6ce8\u91ca\u6389\u7684\u8f93\u51fa\u8bed\u53e5\u5206\u6790qwq\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/riln6xi3.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\uff08\u9644\u8d60\u5206\u5757\u7528\u65f6----$n,m=2\\times10^7$\u7684\u70b9\u65e5\u5e38\u5361\u5230\u6ee1\uff0c\u5f3a\u70c8\u8bf7\u6c42\u7ed9#2/#10\u5f00\u5927\u65f6\u9650\uff09\n\n\u611f\u8c22\u7ba1\u7406\u5927\u4f6c\u5ba1\u6838\uff0c\u6b22\u8fce\u70b9\u8d5eqwq",
        "postTime": 1594349839,
        "uid": 62562,
        "name": "B_1168",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P3793 \u3010\u7531\u4e43\u6551\u7237\u7237\u3011"
    }
]