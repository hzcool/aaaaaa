[
    {
        "content": "## CTSC2016 NOIP\u5341\u5408\u4e00 \u9898\u89e3\n\n##### $\\text{Description}$\n\n\u7ed9\u5b9a\u4e00\u5f20\u8fb9\u5e26\u6743\u6709\u5411\u56fe\u4e0e\u6a21\u6570\uff0c\u591a\u6b21\u8be2\u95ee\u4e00\u4e2a\u70b9\u5230\u53e6\u4e00\u4e2a\u70b9\u95f4\u8ddd\u79bb\u4e3a\u67d0\u4e2a\u503c\u7684\u8def\u5f84\u7684\u6761\u6570\u5bf9\u7ed9\u5b9a\u6a21\u6570\u53d6\u6a21\u7684\u503c\u3002\n\n\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282\uff0c\u5373\u4efb\u610f\u70b9\u5230\u5176\u81ea\u8eab\u5b58\u5728\u4e00\u6761\u957f\u5ea6\u4e3a $0$ \u7684\u201c\u9053\u8def\u201d\u3002\n\n\u63d0\u4ea4\u7b54\u6848\u9898\u3002\n\n<!--more-->\n\n##### $\\text{Solution}$\n\n### C1\n\n#### \u6027\u8d28\n\n\u5f62\u5982\u4e0b\u56fe\uff1a\n\n![graph _7_.png](https://i.loli.net/2020/05/16/L7SzBR4wJXuQjHs.png)\n\n\u6a21\u6570\u4e3a $2^{12}\\times 3^8$\u3002\n\n~~\u4ec0\u4e48\uff0c\u4f60\u8bf4\u61d2\u5f97\u6253\u8d28\u56e0\u6570\u5206\u89e3\uff1f\u767e\u5ea6\u8d28\u56e0\u6570\u5206\u89e3\u4e0d\u8c22\u3002~~\n\n#### \u505a\u6cd5\n\n\u8bbe\u5f53\u524d\u8be2\u95ee\u4e3a $u,v,w$\u3002\n\n\u6bcf\u4e00\u4e2a\u5947\u6570\u5230\u4e0b\u4e00\u4e2a\u5076\u6570\u7684\u8def\u5f84\u957f\u4e3a $1$\uff0c\u6bcf\u4e00\u4e2a\u5076\u6570\u5230\u4e0b\u4e00\u4e2a\u5947\u6570\u7684\u8def\u5f84\u957f\u4e3a $0$\u3002\n\n\u82e5 $u$ \u4e3a\u5076\u6570\uff0c\u6211\u4eec\u5f3a\u5236\u5176\u9000\u56de\u4e0a\u4e00\u4e2a\u5947\u6570\uff0c\u7136\u540e\u6267\u884c $w\\gets w-1$\u3002\n\n\u82e5 $v$ \u4e3a\u5076\u6570\uff0c\u6211\u4eec\u5f3a\u5236\u5176\u524d\u5f80\u4e0b\u4e00\u4e2a\u5947\u6570\u3002\n\n\u90a3\u4e48\u73b0\u5728 $u,v$ \u90fd\u4e3a\u5947\u6570\uff0c\u6211\u4eec\u8003\u8651\u4ece\u67d0\u4e2a\u5947\u6570\u8df3\u5f80\u4e0b\u4e00\u4e2a\u5947\u6570\u65f6\uff0c\u6709\u4e24\u79cd\u65b9\u6848\u53ef\u9009\uff0c\u4e00\u79cd\u82b1\u53bb $1$ \u957f\u5ea6\uff0c\u53e6\u4e00\u79cd\u4e0d\u82b1\u53bb\u957f\u5ea6\u3002\n\n\u8bbe $l$ \u8868\u793a\u4ece $u$ \u8df3\u5230 $v$ \u8981\u8df3\u591a\u5c11\u6b21\uff0c\u6ce8\u610f\u6b64\u5904 $w$ \u662f\u66f4\u65b0\u8fc7\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u7684\u662f\uff1a\n$$\n\\binom{w}{l}\\bmod{(2^{12}\\times 3^8)}\n$$\n\u8fd9\u4e2a\u6a21\u6570\u4e0d\u662f\u8d28\u6570\uff0c\u5f97\u60f3\u4e2a\u65b9\u6cd5\u5feb\u901f\u8ba1\u7b97\u7ec4\u5408\u6570\u3002\n\n\u7136\u540e\u4f60\u53d1\u73b0\u4e00\u6ce2\u6269\u5c55\u5362\u5361\u65af\u5b9a\u7406\uff08exLucas\uff09\u89e3\u51b3\u4e86\uff1f\n\n[\u6269\u5c55\u5362\u5361\u65af\u5b9a\u7406](https://www.luogu.com.cn/problem/P4720)\n\n~~\u9012\u5f52\u5207\u9898\u6cd5\uff0c\u542f\u52a8\uff01~~\n\n\u7ec6\u8282\u5224\u4e00\u4e0b\u5c31\u80fd\u8fc7\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 1s \u8dd1\u7684\u5b8c\uff08\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n} \n\nint n,m,q,p;\n\ninline int Pow(int a,int b,int p){\n\tint ans(1);\n\twhile(b){\n\t\tif(b&1) ans=ans*a%p;\n\t\ta=a*a%p,b>>=1;\n\t}\n\treturn ans;\n}\n\ninline void exgcd(int a,int b,int& x,int& y){b?(exgcd(b,a%b,y,x),y-=a/b*x):(x=1,y=0);}\n\nint _InvX,_InvY;\nint Inv(int a,int P){\n\t_InvY=_InvX=0;\n\texgcd(a,P,_InvX,_InvY);\n\treturn (_InvX%P+P)%P;\n}\n\nconst int P1=1<<12,P2=Pow(3,8,100005);\n\nint _2Mul[10005],_3Mul[10005];\nint _2Sig[50005],_3Sig[50005];\nint _2Phi[50005],_3Phi[50005];\n\ninline void Init(){\n\t_2Mul[0]=_3Mul[0]=1;\n\tfor(REG int i=1;i<P1;++i) _2Mul[i]=_2Mul[i-1]*(i%2?i:1)%P1;\n\tfor(REG int i=1;i<P2;++i) _3Mul[i]=_3Mul[i-1]*(i%3?i:1)%P2;\n\t_2Phi[0]=_3Phi[0]=1;\n\tfor(REG int i=1;i<=50000;++i)\n\t\t_2Phi[i]=_2Phi[i/2]*_2Mul[i%P1]%P1*Pow(_2Mul[P1-1],i/P1,P1)%P1,\n\t\t_3Phi[i]=_3Phi[i/3]*_3Mul[i%P2]%P2*Pow(_3Mul[P2-1],i/P2,P2)%P2;\n\t_2Sig[0]=_3Sig[0]=0;\n\tfor(REG int i=1;i<=50000;++i) _2Sig[i]=_2Sig[i/2]+i/2,_3Sig[i]=_3Sig[i/3]+i/3;\t\n}\n\ninline int Binom(int n,int m){\n\tif(n<m) return 0;\n\tint Pw=_2Sig[n]-_2Sig[m]-_2Sig[n-m];\n\tint _2Ans,_3Ans;\n\tif(Pw>=12) _2Ans=0;\n\telse _2Ans=_2Phi[n]*Inv(_2Phi[m],P1)%P1*Inv(_2Phi[n-m],P1)%P1*Pow(2,Pw,P1)%P1;\n\tPw=_3Sig[n]-_3Sig[m]-_3Sig[n-m];\n\tif(Pw>=8) _3Ans=0;\n\telse _3Ans=_3Phi[n]*Inv(_3Phi[m],P2)%P2*Inv(_3Phi[n-m],P2)%P2*Pow(3,Pw,P2)%P2;\n\treturn (1ll*_2Ans*P2%p*Inv(P2,P1)%p+1ll*_3Ans*P1%p*Inv(P1,P2)%p)%p;\n}\n\ninline void Work(){\n\tInit();\n\tread(n),read(m),read(q),read(p);\n\tfor(REG int i=1;i<=m;++i){\n\t\tint u,v,w;\n\t\tread(u),read(v),read(w);\n\t}\n\twhile(q--){\n\t\tint u,v,w;\n\t\tread(u),read(v),read(w);\n\t\tif(u==v){printf(\"%d\\n\",!w);continue;}\n\t\tif(!(v&1)) --w,--v;u|=1;\n\t\tif(w<0){puts(\"0\");continue;}\n\t\tint Len=(v-u)>>1;\n\t\tprintf(\"%d\\n\",Binom(Len,w));\n\t}\n}\n\nint main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u5f3a\u884c\u6269\u5c55\u5362\u5361\u65af\uff0c\u5dee\u8bc4\uff08\n\n### C2\n\n#### \u6027\u8d28\n\n\u4ece\u70b9 $1$ \u5230\u70b9 $100$ \u987a\u6b21\u76f8\u8fde\u5f62\u6210\u4e00\u6761\u94fe\uff0c\u4e14\u6bcf\u4e2a\u70b9\u4e0a\u6709\u4e00\u4e2a\u81ea\u73af\u3002\n\n\u8be2\u95ee\u4e2d\u7684 $u$ \u90fd\u4e3a $1$\uff0c$w$ \u4e0d\u8d85\u8fc7 $50000$\u3002\n\n#### \u505a\u6cd5\n\n\u4ece\u4e00\u4e2a\u6570\u5230\u5176\u540e\u7ee7\u4e0d\u9700\u8981\u82b1\u8d39\u8fb9\u6743\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u6311\u9009\u81ea\u73af\uff08\u53ef\u4ee5\u91cd\u590d\u6311\u9009\u540c\u4e00\u4e2a\u81ea\u73af\uff09\uff0c\u4f7f\u5f97\u6240\u9009\u62e9\u81ea\u73af\u4e0a\u7684\u8fb9\u6743\u548c\u4e3a $w$\uff0c\u7136\u540e\u6c42\u65b9\u6848\u6570\u3002\n\n\u5b8c\u5168\u80cc\u5305\u6c42\u65b9\u6848\u6570\uff1f\n\n\u7531\u4e8e\u6a21\u6570\u7684\u95ee\u9898\uff0c\u6211\u4eec\u8001\u8001\u5b9e\u5b9e\u505a DP \u5c31\u53ef\u4ee5\u4e86\uff0c\u6ce8\u610f\u72b6\u6001\u8bbe\u8ba1\u65f6\u4e0d\u80fd\u538b\u6389\u524d\u9762\u90a3\u4e00\u7ef4\u3002\n\n~~\u90fd\u505a\u8fd9\u9898\u4e86\u8fd8\u4e0d\u4f1a\u5b8c\u5168\u80cc\u5305\uff1f\u4e0d\u4f1a\u5427\u4e0d\u4f1a\u5427\u4e0d\u4f1a\u5427\uff1f\u597d\u5427\u6211\u4e0d\u4f1a\u2026\u2026~~\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n} \n\nconst int Mod=19960928;\n\nint n,m,q,p;\n\nint u,v,w;\n\nint Wht[105];\n\nint DP[105][50005];\n\ninline void Init(){\n\tDP[0][0]=1;\n\tfor(REG int i=1;i<=n;++i)\n\t\tfor(REG int j=0;j<=50000;++j){\n\t\t\tDP[i][j]=DP[i-1][j];\n\t\t\tif(j>=Wht[i]) DP[i][j]=(DP[i][j]+DP[i][j-Wht[i]])%Mod;\n\t\t}\n}\n\ninline void Work(){\n\tread(n),read(m),read(q),read(p);\n\twhile(m--){\n\t\tread(u),read(v),read(w);\n\t\tif(u==v) Wht[u]=w;\n\t}\n\tInit();\n\tfor(REG int i=1;i<=q;++i){\n\t\tread(u),read(v),read(w);\n\t\tprintf(\"%d\\n\",DP[v][w]);\n\t}\n}\n\nint main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u597d\u50cf\u6ca1\u5565\u597d\u8bf4\u7684\u2026\u2026\n\n### C3\n\n#### \u6027\u8d28\n\n\u4ece\u70b9 $1$ \u5230\u70b9 $10^4$ \u987a\u6b21\u76f8\u8fde\u5f62\u6210\u4e00\u6761\u94fe\uff0c\u4e14\u6bcf\u4e2a\u70b9\u4e0a\u6709\u4e00\u4e2a\u81ea\u73af\u3002\n\n\u8be2\u95ee\u4e2d $w$ \u4e0d\u8d85\u8fc7 $1000$\u3002\n\n\u6a21\u6570 $1998585857=953\\times2^{21}+1$\uff0c\u5176\u539f\u6839\u4e3a $3$\u3002\n\n#### \u505a\u6cd5\n\n\u8ddf C2 \u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u6570\u636e\u8303\u56f4\u4e0a\u6709\u4ece\u91cf\u5230\u8d28\u7684\u53d8\u5316\u3002\n\n\u5982\u679c\u76f4\u63a5 DP\uff0c\u90a3\u4e48 C3 \u4f1a\u8dd1\u6b7b\uff0c\u8fd9\u65f6\u5019\u5c31\u8981\u796d\u51fa\u591a\u9879\u5f0f\u4e86\u3002\n\n\u8bbe\u7b2c $i$ \u4e2a\u7269\u54c1\u7684\u751f\u6210\u51fd\u6570\u4e3a $F_i(x)$\uff0c\u5176\u91cd\u91cf\u4e3a $w_i$\uff0c\u90a3\u4e48\u5b83\u7684\u751f\u6210\u51fd\u6570\u662f\u5f88\u5bb9\u6613\u5199\u51fa\u6765\u7684\uff08\u9664\u4e86 $w_i$ \u7684\u500d\u6570\u4e0a\u6709 $1$ \u5176\u5b83\u90fd\u4e3a $0$\uff0c\u6ce8\u610f\u8fd9\u8fb9\u8ba4\u4e3a $0$ \u4e5f\u662f $w_i$ \u7684\u500d\u6570\uff09\u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u6211\u4eec\u53ea\u9700\u6c42\u51fa\u67d0\u4e00\u4e2a\u533a\u95f4\u5185\u6240\u6709\u7269\u54c1\u7684\u751f\u6210\u51fd\u6570\u7684\u4e58\u79ef\u3002\n\n\u6ce8\u610f\u5230\u8be2\u95ee\u4e2d $w$ \u4e0d\u8d85\u8fc7 $1000$\uff0c\u6545\u591a\u9879\u5f0f\u6700\u591a\u53ea\u6709 $1001$ \u9879\u3002\n\n\u9884\u5904\u7406\u524d\u7f00\u751f\u6210\u51fd\u6570\u4e58\u79ef\u4e0e\u5176\u9006\u5373\u53ef\u3002\n\n\u6ce8\u610f $1998585857$ \u52a0\u8d77\u6765\u4f1a\u7206 int\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n}\n\nconst int Mod=1998585857,lim=2048,L=11,G=3,InvG=666195286;\n\nnamespace Polynomial{\n\t#define MAXN 50005\n\t\n\tinline void Swap(int& a,int& b){int t=a;a=b,b=t;}\n\tinline int Add(int a,int b){return (a+=b)>=Mod?a-Mod:a;}\n\tinline int Del(int a,int b){return (a-=b)<0?a+Mod:a;}\n\tinline int Min(int a,int b){return a<b?a:b;}\n\t\n\tinline int Pow(int a,int b){\n\t\tint ans(1);\n\t\twhile(b){\n\t\t\tif(b&1) ans=1ll*ans*a%Mod;\n\t\t\ta=1ll*a*a%Mod,b>>=1;\n\t\t}\n\t\treturn ans;\n\t}\n\t\n\tint NumInv[MAXN];\n\tint PosSt[55],NegSt[55];\n\t\n\tinline void Predone(){\n\t\tNumInv[1]=1;\n\t\tfor(REG int i=2;i<=MAXN-5;++i) NumInv[i]=1ll*(Mod-Mod/i)*NumInv[Mod%i]%Mod;\n\t\tfor(REG int i=1;i<=30;++i) PosSt[i]=Pow(3,(Mod-1)/(1<<i)),NegSt[i]=Pow(PosSt[i],Mod-2);\n\t}\n\t\n\tint Rev[MAXN];\n\t\n\tinline void GetRev(int len,int L){\n\t\tfor(REG int i=1;i<len;++i)\n\t\t\tRev[i]=(Rev[i>>1]>>1)|((i&1)<<(L-1));\n\t}\n\t\n\tinline void NTT(int* A,int len,short op){\n\t\tfor(REG int i=1;i<len;++i)\n\t\t\tif(i<Rev[i]) Swap(A[i],A[Rev[i]]);\n\t\tfor(REG int i=1,j=1;i<len;i<<=1,++j){\n\t\t\tint Stp=op?PosSt[j]:NegSt[j];\n\t\t\tfor(REG int j=0;j<len;j+=(i<<1)){\n\t\t\t\tint Tmp=1;\n\t\t\t\tfor(REG int k=0;k<i;++k,Tmp=1ll*Tmp*Stp%Mod){\n\t\t\t\t\tint x=*(A+j+k),y=1ll*Tmp*(*(A+j+k+i))%Mod;\n\t\t\t\t\t*(A+j+k)=Add(x,y);\n\t\t\t\t\t*(A+j+k+i)=Del(x,y);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(!op){\n\t\t\tint Invlen=NumInv[len];\n\t\t\tfor(REG int i=0;i<len;++i) A[i]=1ll*A[i]*Invlen%Mod;\n\t\t}\n\t}\n\t\n\tint MulA[MAXN],MulB[MAXN];\n\t\n\tinline void Mul(int* A,int* B,int* C,int len){\n\t\tmemset(MulA,0,sizeof(MulA)),memset(MulB,0,sizeof(MulB));\n\t\tfor(REG int i=0;i<(len>>1);++i)\n\t\t\tMulA[i]=A[i],MulB[i]=B[i];\n\t\tNTT(MulA,len,1),NTT(MulB,len,1);\n\t\tfor(REG int i=0;i<len;++i)\n\t\t\tMulA[i]=1ll*MulA[i]*MulB[i]%Mod;\n\t\tNTT(MulA,len,0);\n\t\tfor(REG int i=0;i<len;++i) C[i]=MulA[i];\n\t}\n\t\n\tint InvB[2][MAXN],InvCur;\n\tint InvTmpG[MAXN];\n\t\n\tinline void Inv(int* A,int* B,int len){\n\t\tInvCur=0,memset(InvB,0,sizeof(InvB)),memset(InvTmpG,0,sizeof(InvTmpG));\n\t\tint Now=1,Nxt=2,NxtL=1;\n\t\tInvB[0][0]=Pow(A[0],Mod-2);\n\t\tGetRev(Nxt,NxtL);\n\t\twhile(Now<=(len<<1)){\n\t\t\tInvCur^=1,memset(InvB[InvCur],0,sizeof(InvB[InvCur]));\n\t\t\tfor(REG int i=0;i<Now;++i) InvB[InvCur][i]=Add(InvB[InvCur^1][i]<<1,0);\n\t\t\tfor(REG int i=0;i<Now;++i) InvTmpG[i]=InvB[InvCur^1][i];\n\t\t\tfor(REG int i=0;i<Now;++i) InvB[InvCur^1][i]=A[i];\n\t\t\tNTT(InvTmpG,Nxt,1),NTT(InvB[InvCur^1],Nxt,1);\n\t\t\tfor(REG int i=0;i<Nxt;++i) InvB[InvCur^1][i]=1ll*InvB[InvCur^1][i]*InvTmpG[i]%Mod;\n\t\t\tfor(REG int i=0;i<Nxt;++i) InvB[InvCur^1][i]=1ll*InvB[InvCur^1][i]*InvTmpG[i]%Mod;\n\t\t\tNTT(InvB[InvCur^1],Nxt,0);\n\t\t\tfor(REG int i=0;i<Now;++i) InvB[InvCur][i]=Del(InvB[InvCur][i],InvB[InvCur^1][i]);\n\t\t\tNow<<=1,Nxt<<=1,++NxtL;\n\t\t\tif(Now<=(len<<1)) GetRev(Nxt,NxtL);\n\t\t}\n\t\tfor(REG int i=0;i<=len;++i) B[i]=InvB[InvCur][i];\n\t}\n\t\n\tinline void Int(int* A,int* B,int len){for(REG int i=1;i<=len;++i) B[i]=1ll*A[i-1]*Pow(i,Mod-2)%Mod;B[0]=0;}\n\tinline void Der(int* A,int* B,int len){for(REG int i=1;i<=len;++i) B[i-1]=1ll*i*A[i]%Mod;B[len]=0;}\n\t\n\tint LnDer[MAXN],LnInv[MAXN];\n\t\n\tinline void Ln(int* A,int* B,int len){\n\t\tDer(A,LnDer,len),Inv(A,LnInv,len);\n\t\tint lim=1,L=0;\n\t\twhile(lim<=(len<<1)) lim<<=1,++L;\n\t\tGetRev(lim,L);\n\t\tMul(LnDer,LnInv,LnDer,lim);\n\t\tInt(LnDer,B,len);\n\t}\n\t\n\tint ExpB[2][MAXN],ExpCur,ExpLn[MAXN];\n\t\n\tinline void Exp(int* A,int* B,int len){\n\t\tExpCur=0,memset(ExpB,0,sizeof(ExpB));\n\t\tint Now=1,Nxt=2,NxtL=1;\n\t\tExpB[0][0]=1;\n\t\tGetRev(Nxt,NxtL);\n\t\twhile(Now<=(len<<1)){\n\t\t\tExpCur^=1,memset(ExpB[ExpCur],0,sizeof(ExpB[ExpCur]));\n\t\t\tLn(ExpB[ExpCur^1],ExpLn,Now-1);\n\t\t\tfor(REG int i=0;i<Now;++i) ExpLn[i]=Del(A[i]+(i==0),ExpLn[i]);\n\t\t\tMul(ExpB[ExpCur^1],ExpLn,ExpB[ExpCur],Nxt);\n\t\t\tNow<<=1,Nxt<<=1,++NxtL;\n\t\t\tif(Now<=(len<<1)) GetRev(Nxt,NxtL);\n\t\t}\n\t\tfor(REG int i=0;i<=len;++i) B[i]=ExpB[ExpCur][i];\n\t}\n\t\n\tinline void PolyPow(int* A,int* B,int k,int len){\n\t\tLn(A,B,len);\n\t\tfor(REG int i=0;i<=len;++i) B[i]=1ll*B[i]*k%Mod;\n\t\tExp(B,B,len);\n\t}\n}\n\nusing namespace Polynomial;\n\nint n,m,q,p;\n\nint u,v,w;\n\nint Poly[10005][2505],Ioly[10005][2505];\n\nint Tmpa[3005],Tmpb[3005]; \n\ninline void Work(){\n\tPredone();\n\tfreopen(\"noip3.in\",\"r\",stdin);\n\tfreopen(\"noip3.out\",\"w\",stdout);\n\tread(n),read(m),read(q),read(p);\n\tPoly[0][0]=Ioly[0][0]=1;\n\tfor(REG int i=1;i<=m;++i){\n\t\tread(u),read(v),read(w);\n\t\tif(u==v){\n\t\t\tGetRev(lim,L);\n\t\t\tfor(REG int j=0;j<=1000;j+=w) Poly[u][j]=1;\n\t\t\tfor(REG int j=0;j<lim;++j) Tmpa[j]=Poly[u-1][j];\n\t\t\tNTT(Tmpa,lim,1),NTT(Poly[u],lim,1);\n\t\t\tfor(REG int j=0;j<2048;++j) Poly[u][j]=1ll*Tmpa[j]*Poly[u][j]%Mod;\n\t\t\tNTT(Poly[u],lim,0);\n\t\t\tfor(REG int j=1001;j<=2048;++j) Poly[u][j]=0;\n\t\t\tInv(Poly[u],Ioly[u],1000);\n\t\t}\n\t}\n\tGetRev(lim,L);\n\tfor(REG int i=1;i<=q;++i){\n\t\tread(u),read(v),read(w);\n\t\tmemset(Tmpa,0,sizeof Tmpa);\n\t\tmemset(Tmpb,0,sizeof Tmpb);\n\t\tfor(REG int j=0;j<=1000;++j) Tmpa[j]=Poly[v][j],Tmpb[j]=Ioly[u-1][j];\n\t\tNTT(Tmpa,lim,1),NTT(Tmpb,lim,1);\n\t\tfor(REG int j=0;j<lim;++j) Tmpa[j]=1ll*Tmpa[j]*Tmpb[j]%Mod;\n\t\tNTT(Tmpa,lim,0);\n\t\tprintf(\"%d\\n\",Tmpa[w]);\n\t\tif(i==1) cerr<<Tmpa[w]<<endl;\n\t}\n}\n\nsigned main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u5565\u4e5f\u4e0d\u8bf4\u4e86\uff0c$998244353$ \u5929\u4e0b\u7b2c\u4e00\uff01\uff01\n\n### C4\n\n#### \u6027\u8d28\n\n$n=5$\uff0c\u8fb9\u6743\u8f83\u5c0f\u7684\u8fb9\u91cd\u590d\u51fa\u73b0\u6b21\u6570\u8f83\u591a\uff0c\u8be2\u95ee\u4e2d $w$ \u4e0d\u8d85\u8fc7 $50000$\u3002\n\n#### \u505a\u6cd5\n\n\u8fd9\u4e2a $n$ \u5f88\u5c0f\uff0c\u5f00\u6570\u636e\u65f6\u60f3\u8fd9\u4e2a\u70b9\u5e94\u8be5\u662f\u4e2a\u66b4\u529b\u70b9\uff1f\n\n\u7136\u800c\u8fb9\u6570\u8fc7\u591a\uff0c\u6ca1\u60f3\u5230\u8f83\u597d\u7684\u66b4\u529b\uff0c\u6545\u8003\u8651 DP\u3002\n\n\u8bbe $f(u,v,w)$ \u8868\u793a\u4ece $u$ \u5230 $v$ \u8fb9\u6743\u548c\u4e3a $w$ \u7684\u8def\u5f84\u6570\uff0c\u6613\u6709\u8f6c\u79fb\uff1a\n$$\nf(u,v,w)=\\sum_{k=1}^5\\sum_{Edge=(k,v,w_e)}f(u,k,w-w_e)\n$$\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n^2w+nwm)$\uff08\u8003\u8651\u6bcf\u6761\u8fb9\u5728\u8f6c\u79fb\u65f6\u8d21\u732e\u7684\u6b21\u6570\uff09\uff0c\u66b4\u6bd9\u3002\n\n\u518d\u56de\u987e\u672c\u9898\u6027\u8d28\uff1a\n\n1. **\u53ef\u80fd**\u4f1a\u6709\u90e8\u5206\u72b6\u6001\u662f\u65e0\u7528\u7684\u3002\n2. \u6709\u4e9b\u8fb9\u7684\u51fa\u73b0\u6b21\u6570\u8f83\u591a\u3002\n\n\u6211\u4eec\u8003\u8651\u6362\u4e00\u4e2a DP \u65b9\u5f0f\uff0c\u9996\u5148\u5bf9\u6bcf\u7c7b\u8d77\u59cb\u70b9\u76f8\u540c\u7684\u8fb9\u6309\u8fb9\u6743\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7136\u540e\u6309\u987a\u5e8f\u679a\u4e3e\u72b6\u6001\uff08\u5f53\u7136\u4f60\u9700\u8981\u521d\u59cb\u5316\uff1a\u6bcf\u4e2a\u70b9\u5230\u5b83\u81ea\u8eab\u6709\u4e00\u6761\u8fb9\u6743\u548c\u4e3a $0$ \u7684\u8def\u5f84\uff09\uff0c\u82e5\u5176\u975e\u96f6\uff0c\u5219\u7528 $v$ \u7684\u51fa\u8fb9\u66f4\u65b0\u522b\u7684\u72b6\u6001\uff0c\u5bf9\u4e8e\u6211\u4eec\u6240\u66f4\u65b0\u7684\u8fd9\u4e2a\u72b6\u6001\uff0c\u82e5\u5176 $w$ \u8d85\u8fc7 $50000$\uff0c\u5219\u8df3\u8fc7\uff0c\u987a\u4fbf\u53ef\u4ee5\u8df3\u8fc7\u540c\u4e00\u4e2a\u7ec8\u70b9\u7684\u66f4\u65b0\uff0c\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u8fdb\u884c\u4e86\u6392\u5e8f\u3002\n\n\u6ce8\u610f\u8fd9\u4e2a\u6a21\u6570\u4ecd\u7136\u662f C3 \u7684 $1998585857$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n}\n\nconst int Mod=1998585857;\n\nint n,m,q,p;\nint u,v,w;\n\nvector< pair<int,int> > Tmp[10][10],Edge[10][10];\n\nint DP[10][10][50005];\n\ninline void Init(){\n\tread(n),read(m),read(q),read(p);\n\tfor(REG int i=1;i<=m;++i){\n\t\tread(u),read(v),read(w);\n\t\tTmp[u][v].push_back(make_pair(w,0));\n\t}\n\tfor(REG int i=1;i<=5;++i)\n\t\tfor(REG int j=1;j<=5;++j){\n\t\t\tsort(Tmp[i][j].begin(),Tmp[i][j].end());\n\t\t\tint cnt=1;\n\t\t\tfor(REG int k=1;k<Tmp[i][j].size();++k)\n\t\t\t\tif(Tmp[i][j][k].first^Tmp[i][j][k-1].first) Edge[i][j].push_back(make_pair(Tmp[i][j][k-1].first,cnt)),cnt=1;\n\t\t\t\telse ++cnt;\n\t\t\tEdge[i][j].push_back(make_pair(Tmp[i][j][Tmp[i][j].size()-1].first,cnt));\n\t\t}\n\tfor(REG int i=1;i<=5;++i) DP[i][i][0]=1;\n\tfor(REG int i=0;i<=49999;++i)\n\t\tfor(REG int ui=1;ui<=5;++ui)\n\t\t\tfor(REG int vi=1;vi<=5;++vi){\n\t\t\t\tif(!DP[ui][vi][i]) continue;\n\t\t\t\tfor(REG int ki=1;ki<=5;++ki){\n\t\t\t\t\tfor(REG int mi=0;mi<Edge[vi][ki].size();++mi){\n\t\t\t\t\t\tint wi=Edge[vi][ki][mi].first,ci=Edge[vi][ki][mi].second;\n\t\t\t\t\t\tif(i+wi>50000) break;\n\t\t\t\t\t\tDP[ui][ki][i+wi]=(DP[ui][ki][i+wi]+DP[ui][vi][i]*ci%Mod)%Mod;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n}\n\ninline void Work(){\n\tInit();\n\tfor(REG int i=1;i<=q;++i){\n\t\tread(u),read(v),read(w);\n\t\tprintf(\"%d\\n\",DP[u][v][w]);\n\t}\n}\n\nsigned main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u8dd1\u4e00\u6b21 1 min\uff0c\u9178\u723d\u3002\n\n### C5\n\n#### \u6027\u8d28\n\n\u56fe\u7531\u82e5\u5e72\u4e2a\u4e09\u5143\u94fe\u7ec4\u6210\u3002\u6bcf\u4e2a\u4e09\u5143\u94fe\u7684\u4e2d\u5fc3\u662f $11\\sim50000$ \u8282\u70b9\uff0c\u4e24\u7aef\u662f $1\\sim 10$ \u8282\u70b9\u3002\n\n\u8fb9\u6743\u4e0d\u8d85\u8fc7 $200$\uff0c\u8be2\u95ee\u4e2d\u7684 $w$ \u4e0d\u8d85\u8fc7 $10000$\u3002\n\n#### \u505a\u6cd5\n\n\u5bb9\u6613\u53d1\u73b0\u4efb\u610f $11\\sim 50000$ \u8282\u70b9\u90fd\u53ea\u6709\u4e00\u4e2a\u524d\u9a71\u548c\u4e00\u4e2a\u540e\u7f00\uff0c\u6545\u8be2\u95ee\u65f6\u53ef\u4ee5\u5f3a\u5236\u5176\u8df3\u5230\u5b83\u7684\u524d\u9a71/\u540e\u7f00\uff08$1\\sim 10$ \u8282\u70b9\u8df3\u5230\u5176\u672c\u8eab\u5373\u53ef\uff09\u3002\n\n\u6240\u4ee5\u4e00\u4e2a\u4e09\u5143\u94fe\u53ef\u4ee5\u7b49\u4ef7\u4e3a $1\\sim 10$ \u8282\u70b9\u95f4\u7684\u8fde\u8fb9\uff0c\u53ef\u4ee5\u91c7\u7528 C4 \u7684\u505a\u6cd5\u3002\n\n\u54e6\uff0c\u6ce8\u610f\u8fd9\u4e2a\u6a21\u6570\u4ecd\u7136\u662f C4 \u7684 $1998585857$\uff08\u4e0d\u8fc7\u76f4\u63a5\u642c C4 \u4ee3\u7801\u5e94\u8be5\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff09\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n}\n\nconst int Mod=1998585857;\n\nint n,m,q,p;\nint u,v,w;\n\nvector< pair<int,int> > Tmp[11][11],Edge[11][11];\n\nint DP[11][11][10005];\n\nint Pre[50005],Suf[50005],Pw[50005],Sw[50005];\n\ninline void Init(){\n\tread(n),read(m),read(q),read(p);\n\tfor(REG int i=1;i*2<=m;++i){\n\t\tint sumw,ru,rv;\n\t\tread(u),read(v),read(w);\n\t\tsumw=w,ru=u,Pre[v]=u,Pw[v]=w;\n\t\tread(u),read(v),read(w);\n\t\trv=v,sumw+=w,Suf[u]=v,Sw[u]=w;\n\t\tTmp[ru][rv].push_back(make_pair(sumw,0));\n\t}\n\tfor(REG int i=1;i<=10;++i) Pre[i]=Suf[i]=i;\n\tfor(REG int i=1;i<=10;++i)\n\t\tfor(REG int j=1;j<=10;++j){\n\t\t\tsort(Tmp[i][j].begin(),Tmp[i][j].end());\n\t\t\tint cnt=1;\n\t\t\tfor(REG int k=1;k<Tmp[i][j].size();++k)\n\t\t\t\tif(Tmp[i][j][k].first^Tmp[i][j][k-1].first) Edge[i][j].push_back(make_pair(Tmp[i][j][k-1].first,cnt)),cnt=1;\n\t\t\t\telse ++cnt;\n\t\t\tEdge[i][j].push_back(make_pair(Tmp[i][j][Tmp[i][j].size()-1].first,cnt));\n\t\t}\n\tfor(REG int i=1;i<=10;++i) DP[i][i][0]=1;\n\tfor(REG int i=0;i<=9999;++i)\n\t\tfor(REG int ui=1;ui<=10;++ui)\n\t\t\tfor(REG int vi=1;vi<=10;++vi){\n\t\t\t\tif(!DP[ui][vi][i]) continue;\n\t\t\t\tfor(REG int ki=1;ki<=10;++ki){\n\t\t\t\t\tfor(REG int mi=0;mi<Edge[vi][ki].size();++mi){\n\t\t\t\t\t\tint wi=Edge[vi][ki][mi].first,ci=Edge[vi][ki][mi].second;\n\t\t\t\t\t\tif(i+wi>10000) break;\n\t\t\t\t\t\tDP[ui][ki][i+wi]=(DP[ui][ki][i+wi]+DP[ui][vi][i]*ci%Mod)%Mod;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n}\n\ninline void Work(){\n\tInit();\n\tfor(REG int i=1;i<=q;++i){\n\t\tread(u),read(v),read(w);\n\t\tw-=Sw[u]+Pw[v],u=Suf[u],v=Pre[v];\n\t\tif(w<0) puts(\"0\");\n\t\telse printf(\"%d\\n\",DP[u][v][w]);\n\t}\n}\n\nsigned main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u4ec0\u4e48\u53eb\u505a 10s \u8dd1\u5b8c\u554a\uff1f\uff08\u6218\u672f\u540e\u4ef0\uff09\n\n### C6\n\n#### \u6027\u8d28\n\n$n=200$\uff0c\u8fb9\u6743\u5168\u4e3a $1$\u3002\n\n#### \u505a\u6cd5\n\n\u77e9\u9635\u5feb\u901f\u5e42\uff1f\u4f46\u662f\u8be2\u95ee\u4e2d\u7684 $w$ \u4e92\u4e0d\u76f8\u540c\uff0c\u6734\u7d20\u5730\u505a\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(qn^3\\log w)$\uff0c\u8fd9\u53ef\u4e0d\u80fd\u50cf C4\uff0cC5 \u90a3\u6837\u66b4\u529b\u8dd1 1min/10s \u80fd\u89e3\u51b3\u7684\u3002\n\n\u6ce8\u610f\u5230\u6211\u4eec\u6bcf\u6b21\u53ea\u9700\u8981\u6c42\u51fa\u77e9\u9635\u7684\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u9884\u5904\u7406\u90bb\u63a5\u77e9\u9635\u7684 $2^0,2^1,\\cdots,2^{30}$ \u7684\u5e42\uff0c\u6bcf\u6b21\u8be2\u95ee\u901a\u8fc7\u4e8c\u8fdb\u5236\u5206\u89e3\u4e0d\u65ad\u5c06\u9884\u5904\u7406\u51fa\u6765\u7684\u77e9\u9635\u4e58\u5230\u4ece\u5355\u4f4d\u77e9\u9635\u62ce\u51fa\u6765\u4e00\u5217\u6240\u5f62\u6210\u7684\u5217\u5411\u91cf\u4e0a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n^3\\log w+qn^2\\log w)$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n}\n\nconst int Mod=1998585857;\n\nint n,m,q,p;\nint u,v,w;\n\nint Vec[305],Tmp[305];\n\nstruct Matrix{\n\tint M[305][305];\n\tinline void Init(){memset(M,0,sizeof M);}\n\tinline void GetI(){for(REG int i=1;i<=n;++i)M[i][i]=1;}\n\tMatrix operator*(Matrix x){\n\t\tMatrix R;R.Init();\n\t\tfor(REG int i=1;i<=n;++i)\n\t\t\tfor(REG int k=1;k<=n;++k)\n\t\t\t\tfor(REG int j=1;j<=n;++j)\n\t\t\t\t\tR.M[i][j]=(R.M[i][j]+M[i][k]*x.M[k][j]%Mod)%Mod;\n\t\treturn R;\n\t}\n\tMatrix MulT(){\n\t\tmemset(Tmp,0,sizeof Tmp);\n\t\tfor(REG int j=1;j<=n;++j)\n\t\t\tfor(REG int i=1;i<=n;++i)\n\t\t\t\tTmp[i]=(Tmp[i]+Vec[j]*M[j][i]%Mod)%Mod;\n\t\tfor(REG int i=1;i<=n;++i) Vec[i]=Tmp[i];\n\t}\n}_2PowM[36];\n\ninline void Init(){\n\t_2PowM[0].Init();\n\tfor(REG int i=1;i<=m;++i)\n\t\tread(u),read(v),read(w),_2PowM[0].M[u][v]++;\n\tfor(REG int i=1;i<=29;++i) _2PowM[i]=_2PowM[i-1]*_2PowM[i-1];\n}\n\ninline void Work(){\n\tread(n),read(m),read(q),read(p);\n\tInit();\n\tfor(REG int i=1;i<=q;++i){\n\t\tread(u),read(v),read(w);\n\t\tmemset(Vec,0,sizeof Vec),Vec[u]=1;\n\t\tfor(REG int j=0;j<=29;++j)\n\t\t\tif(w&(1<<j)) _2PowM[j].MulT();\n\t\tprintf(\"%lld\\n\",Vec[v]);\n\t}\n}\n\nsigned main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u7b97\u662f\u77e9\u9635\u5feb\u901f\u5e42\u6bd4\u8f83\u8fdb\u9636\u7684\u5e94\u7528\u59ff\u52bf\uff1f~~\u8dd1\u4e86 300s~~\u3002\n\n### C7\n\n#### \u6027\u8d28\n\n$n=100$\uff0c\u6709 $100$ \u6761\u8fb9\u7684\u8fb9\u6743\u4e3a $2$\uff0c\u5176\u5b83\u8fb9\u6743\u5168\u4e3a $1$\u3002\n\n#### \u505a\u6cd5\n\n\u4e00\u5f00\u59cb\u770b\u5230\u7b2c\u4e00\u6761\u8fb9\u7684\u8fb9\u6743\u8fd8\u4ee5\u4e3a\u6211\u624b\u8d31\u6539\u4e86\u5565\u2026\u2026\u7136\u540e\u53c8\u4e0b\u8f7d\u4e86\u4e00\u6b21\u6570\u636e\u53d1\u73b0\u6ca1\u6709\u9519\u2026\u2026\n\n\u6240\u4ee5\u672c\u9898\u7684\u6838\u5fc3\u5728\u4e8e**\u5904\u7406\u591a\u51fa\u6765\u7684\u8fb9\u6743\u4e3a $2$ \u7684\u8fb9**\u3002\n\n\u7136\u540e\u5bf9\u8fd9\u4e2a\u8fb9\u6743\u4e3a $2$ \u7684\u8fb9\u5efa\u4e00\u4e2a\u65b0\u70b9\uff0c\u53d8\u6210\u4e24\u6761\u8fb9\u6743\u4e3a $1$ \u7684\u8fb9\uff1f\n\n\u5957\u7528 C6 \u7684\u505a\u6cd5\u5373\u53ef\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define REG register\nusing namespace std;\ninline void read(int& x){\n\tstatic char c;\n\twhile(!isdigit(c=getchar()));x=c^48;\n\twhile(isdigit(c=getchar()))x=(x*10)+(c^48);\n}\n\nconst int Mod=1998585857;\n\nint n,m,q,p;\nint u,v,w;\n\nint Vec[305],Tmp[305];\n\nstruct Matrix{\n\tint M[305][305];\n\tinline void Init(){memset(M,0,sizeof M);}\n\tinline void GetI(){for(REG int i=1;i<=n;++i)M[i][i]=1;}\n\tMatrix operator*(Matrix x){\n\t\tMatrix R;R.Init();\n\t\tfor(REG int i=1;i<=n;++i)\n\t\t\tfor(REG int k=1;k<=n;++k)\n\t\t\t\tfor(REG int j=1;j<=n;++j)\n\t\t\t\t\tR.M[i][j]=(R.M[i][j]+M[i][k]*x.M[k][j]%Mod)%Mod;\n\t\treturn R;\n\t}\n\tMatrix MulT(){\n\t\tmemset(Tmp,0,sizeof Tmp);\n\t\tfor(REG int j=1;j<=n;++j)\n\t\t\tfor(REG int i=1;i<=n;++i)\n\t\t\t\tTmp[i]=(Tmp[i]+Vec[j]*M[j][i]%Mod)%Mod;\n\t\tfor(REG int i=1;i<=n;++i) Vec[i]=Tmp[i];\n\t}\n}_2PowM[36];\n\ninline void Init(){\n\t_2PowM[0].Init();\n\tfor(REG int i=1;i<=m;++i){\n\t\tread(u),read(v),read(w);\n\t\tif(w==1){_2PowM[0].M[u][v]++;continue;}\n\t\t_2PowM[0].M[u][++n]++,_2PowM[0].M[n][v]++;\n\t}\n\tfor(REG int i=1;i<=29;++i) _2PowM[i]=_2PowM[i-1]*_2PowM[i-1];\n}\n\ninline void Work(){\n\tread(n),read(m),read(q),read(p);\n\tInit();\n\tfor(REG int i=1;i<=q;++i){\n\t\tread(u),read(v),read(w);\n\t\tmemset(Vec,0,sizeof Vec),Vec[u]=1;\n\t\tfor(REG int j=0;j<=29;++j)\n\t\t\tif(w&(1<<j)) _2PowM[j].MulT();\n\t\tprintf(\"%lld\\n\",Vec[v]);\n\t}\n}\n\nsigned main(){Work();}\n```\n\n#### \u70b9\u8bc4\n\n\u57fa\u64cd\u3002~~\u53c8\u9893\u4e86 6min \u77e5\u4e4e\uff0c\u7136\u540e\u6b21\u65e5\u7684\u8bed\u6587\u5377\u5b50\u6ca1\u5199~~\u3002\n\n### C8\n\n#### \u6027\u8d28\n\n$n=1000$\uff0c\u8fb9\u6743\u5168\u4e3a $1$\uff0c\u8be2\u95ee\u4e2d\u7684 $u$ \u90fd\u4e3a $1$\u3002\n\n#### \u505a\u6cd5\n\n\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u5f88\u68d8\u624b\uff0c\u8981\u4e0d\u5148\u5957 C6 \u7684\u505a\u6cd5\u8bd5\u8bd5\uff1f\n\n\u5f00\u59cb\u8dd1\u2026\u2026\u8dd1\u4e0d\u52a8\u4e86\uff0c\u5173\u6389\uff0c\u867d\u7136\u53ea\u8dd1\u4e86\u4e00\u5c0f\u4f1a\u3002\n\n\u7136\u540e\u53d1\u73b0\u7279\u5f81\u591a\u9879\u5f0f\u90a3\u4e00\u5957\u4e0d\u662f\u5f88\u4f1a\uff0c\u53c8\u770b\u5230\u6709\u4eba\u8bf4\u8dd1\u4e00\u5c0f\u65f6\uff0c\u5fc3\u60f3\uff1a\u4e00\u5c0f\u65f6\u5c31\u4e00\u5c0f\u65f6\u5427\u3002\n\n\u7ed3\u679c 1023s \u51fa\u7ed3\u679c\uff1f\n\n#### \u70b9\u8bc4\n\n\u66b4\u529b\u51fa\u5947\u8ff9\uff01\n\n### C9\n\n#### \u6027\u8d28\n\n$n=10000$\uff0c\u8fb9\u6743\u5168\u4e3a $1$\uff0c\u8fb9 $(u,v)$ \u6ee1\u8db3 $u\\equiv v+1\\pmod{10^3}$\uff0c\u5bf9\u4e8e\u6240\u6709\u8be2\u95ee $(a,b,c)$\uff0c\u6ee1\u8db3 $b-a\\equiv c\\pmod{10^3}$\u3002\n\n#### \u505a\u6cd5\n\n\u7528 C6 \u7684\u505a\u6cd5\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u7a7a\u95f4\u4f1a\u5361\u7206\u3002\n\n\u8003\u8651\u8fb9\u548c\u8be2\u95ee\u7684\u7279\u70b9\uff0c\u5982\u679c\u6211\u4eec\u5c06\u70b9\u5206\u4e3a $10^3$ \u7c7b\uff0c\u7b2c $i$ \u7c7b\u8868\u793a\u7f16\u53f7\u5bf9 $10^3$ \u53d6\u6a21\u540e\u503c\u4e3a $i$ \u7684\u70b9\uff0c\u90a3\u4e48\u8fb9\u76f8\u5f53\u4e8e\u4e00\u4e2a\u7c7b\u5f80\u5176\u540e\u7ee7\u7c7b\u8fde\u8fb9\uff0c\u8be2\u95ee\u5219\u662f\u4e3a\u4e86\u4f7f\u5f97\u5728\u8fb9\u7684\u9650\u5236\u4e0b\u5b58\u5728\u89e3\u800c\u9650\u5236\u7684\uff0c\u4e14\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u5728\u8fd9\u4e9b\u7c7b\u4e2d\u8d70\u4e86\u591a\u5c11\u5708\u3002\n\n\u90a3\u4e48\u8bbe\u51fa\u77e9\u9635 $G_i$ \u8868\u793a\u7b2c $i$ \u7c7b\u70b9\u5230\u7b2c $i+1$ \u7c7b\u70b9\u7684\u90bb\u63a5\u77e9\u9635\uff0c\u90a3\u4e48\u5b9e\u9645\u4e0a\u662f\u5bf9\u5e94\u7684\u884c\u5411\u91cf\u4f9d\u6b21\u4e58\u4e0a $G_{u\\bmod{10^3}},G_{(u\\bmod{10^3})+1},\\cdots,G_{v\\bmod{10^3}}$\u3002\n\n\u9884\u5904\u7406 $G_0\\times G_1\\times\\cdots\\times G_{10^3-1}$\uff0c\u7136\u540e\u4e0a\u5f0f\u5b8c\u6574\u7684\u6240\u6709\u7c7b\u7684\u4e58\u79ef\u53ef\u4ee5\u76f4\u63a5\u5957\u7528 C6 \u7684\u505a\u6cd5\u89e3\u51b3\uff0c\u5176\u5b83\u66b4\u529b\u5373\u53ef\u3002\n\n#### \u70b9\u8bc4\n\n3min \u8dd1\u5b8c\uff0c\u633a\u5feb\u7684\u3002\n\n### C10\n\n#### \u6027\u8d28\n\n$n=3000$\uff0c\u8fb9\u6743\u5168\u4e3a $1$\u3002\n\n#### \u505a\u6cd5\n\n\u4e0d\u80fd #define int long long \u4e86\uff0c\u5426\u5219\u7a7a\u95f4\u5361\u7206\u3002\n\n\u7ee7\u7eed\u5957\u7528 C6 \u7684\u505a\u6cd5\uff0c\u66b4\u529b\u51fa\u5947\u8ff9\u3002\n\n\u7136\u540e\u5f00\u7740\u8dd1\u4e86\u5f88\u4e45\u5f88\u4e45\u2026\u2026\n\n#### \u70b9\u8bc4\n\n\u4ece\u516b\u70b9\u534a\u8dd1\u5230\u4e86\u5341\u70b9\u534a\uff0c\u867d\u7136\u7b49\u5f97\u5f88\u8f9b\u82e6\uff0c\u4f46\u662f\u4e00\u60f3\u5230\u8fd9\u6bb5\u65f6\u95f4\u5212\u4e86\u5f88\u4e45\u6c34\uff0c\u987a\u4fbf\u5199\u4e86 R2A ~~\u8fd9\u7b97\u7ed9 QkOI#R2 \u6253\u5e7f\u544a\u5417~~ \u7684\u76f8\u5173\u5185\u5bb9\uff0c\u751a\u81f3**\u4e0d\u7528\u53bb\u5199\u7279\u5f81\u591a\u9879\u5f0f\u7b49\u795e\u4ed9\u73a9\u610f\u513f**\uff0c\u6211\u4fbf\u611f\u89c9\uff0c\u66b4\u529b\u51fa\u5947\u8ff9\u7684\u751f\u6d3b\uff0c\u662f\u591a\u4e48\u7684\u6734\u5b9e\u65e0\u534e\uff0c\u4e14\u67af\u71e5\u3002 ",
        "postTime": 1590747508,
        "uid": 83547,
        "name": "LCuter",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5418 \u3010[CTSC2016]NOIP\u5341\u5408\u4e00\u3011"
    },
    {
        "content": "### \u829c\u6e56\uff0c\u7ec8\u4e8e\u641e\u5b9a\u4e86\u8fd910\u4e2a\u4efb\u52a1\u3002\u3002\u3002~~\u8fd9\u4e24\u5929\u8981\u6ce8\u610f\u517b\u751f\u4e86~~\u3002\n\n[\u672c\u9898\u5728 UOJ \u4e0a\u901a\u8fc7](https://uoj.ac/submission/446278)\n\n\u6d1b\u8c37\u548c LOJ \u76ee\u524d\u7684\u6570\u636e\u90fd\u6709\u8bef\uff0c\u4e14\u6d1b\u8c37\u4e0d\u652f\u6301\u63d0\u4ea4\u5927\u5bb9\u91cf\u7684 zip \u6587\u4ef6\u3002\n\n- $\\text{data 1}$\n\n$n=100000$\uff0c\u8fb9\u6ee1\u8db3 $(2i-1,2i,1),(2i-1,2i+1,0),(2i,2i+1,0)$ \uff1a\n\n![](https://i.loli.net/2020/05/16/L7SzBR4wJXuQjHs.png)\n\n\u6613\u77e5\u7b54\u6848\u4e3a $\\binom{dist}{w}$ \uff0c\u4f46\u6a21\u6570\u662f\u975e\u8d28\u6570\uff0c\u65e0\u6cd5\u9884\u5904\u7406\u3002\n\n\u53ef\u4ee5\u6269\u5c55\u5362\u5361\u65af\uff0c\u6216\u5f3a\u884c\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u6211\u9009\u62e9\u7684\u662f\u540e\u8005\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\frac {nq}{logn})$ \uff0c\u672c\u673a $4.2s$ \u3002\n\n[\u4ee3\u7801](https://paste.ubuntu.com/p/N4gnG6MvSY/)\n\n- $\\text{data 2}$\n\n$n=100,w\\le 50000$\uff0c\u8fb9\u6ee1\u8db3 $(i,i,*)$ \u6216 $(i,i+1,0)$ \uff1a\n\n\u53ea\u6709\u81ea\u73af\u6709\u8d21\u732e\uff0c\u6545\u76f4\u63a5\u505a $01$ \u80cc\u5305\u5373\u53ef\u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u7684 $u=1$ \uff0c\u56e0\u6b64\u53ef\u4ee5\u9884\u5904\u7406 $dp[i][j]$ \u8868\u793a\u524d $i$ \u4e2a\u70b9\u8def\u5f84\u957f\u5ea6 $=j$ \u7684\u65b9\u6848\u6570\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nw)$  \uff0c\u672c\u673a\u8dd1\u4e86 $0.3s$ \u3002\n\n[\u4ee3\u7801](https://paste.ubuntu.com/p/bwJHrBR2PK/)\n\n- $\\text{data 3}$\n\n$n=10000,w\\le 1000$ \uff0c\u5176\u4f59\u548c $\\text{data 2}$ \u4e00\u81f4\u3002\n\n\u4ee4 $f_i(x)$ \u8868\u793a\u524d $i$ \u4e2a\u70b9\u7684\u751f\u6210\u51fd\u6570\uff0c\u5219\u6709\n\n$$f_i(x)=f_{i-1}(x)(1+x^{a_i}+x^{2a_i}+...)=\\frac{f_{i-1}(x)}{1-x^{a_i}}$$\n\n\u4ee4 $G_i(x)=\\frac{1}{f_i(x)}$ \uff0c\u5219 $G(x)=(1-x^{a_i})G_{i-1}(x)$ \u3002\n\n\u8fb9\u754c $F_0(x)=G_0(x)=1$ \uff0c\u67e5\u8be2\u5373\u6c42 $[x^w](G_{l-1}(x)F_r(x))$ \u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+q)w)$ \uff0c\u672c\u673a\u8dd1\u4e86 $0.8s$ \u3002\n\n[\u4ee3\u7801](https://paste.ubuntu.com/p/ZTWFc4bVWz/)\n\n- $\\text{data 4}$\n\n$n=5,m\\le 100000,w\\le 50000$\uff0c\u70b9\u7a00\u758f\uff0c\u8fb9\u7a20\u5bc6\u3002\n\n\u7528 $f(u,v,d)$ \u8868\u793a\u4ece $u$ \u5230 $v$ \u8def\u5f84\u957f\u5ea6\u4e3a $w$ \u7684\u65b9\u6848\u6570\uff0c\u5219 $f(u,v,d)=\\sum\\limits_{(v',v,w)\\in E}f(u,v',d-w)$ \u3002\n\n\u5c06 $d$ \u4ece\u5c0f\u5f80\u5927 $dp$ \uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nmw)$ \u3002\n\n\u8bb0 $F_{i,j}(x)=\\sum\\limits_{k}f(i,j,k)x^k,G_{i,j}(x)=\\sum\\limits_{(i,j,w)\\in E}x^w$ \uff0c\u5219 $F_{i,j}(x)=[i=j]+\\sum\\limits_{k=1}^{n}F_{i,k}(x)G_{k,j}(x)$\n\n\u8003\u8651\u5206\u6cbb $NTT$ \uff0c$T(k)=T(\\frac{k}{2})+O(n^3\\times k^2)$ \uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3klog^2k)$ \u3002\n\n- $\\text{data 5}$\n\n$n=50000,m=99980,w\\le 8000$\uff0c\u7f16\u53f7\u5927\u4e8e $10$ \u7684\u70b9\u5165\u5ea6\u3001\u51fa\u5ea6\u5747\u4e3a $1$ \u3002\n\n\u8bbe\u7f16\u53f7 $>10$ \u7684\u70b9\u8fde\u5411\u70b9 $x$ \uff0c\u5219\u76f8\u5f53\u4e8e $x$ \u8fde\u81ea\u73af\uff0c\u6743\u503c\u4e3a\u5165\u8fb9\u548c\u51fa\u8fb9\u7684\u8fb9\u6743\u548c\u3002\u7136\u540e\u8dd1 $\\text{data 4}$ \u7684\u66b4\u529b $dp$ \u5373\u53ef\u3002\n\n\u7531\u4e8e\u8fb9\u6743\u6781\u5c0f\uff0c\u5c06\u91cd\u8fb9\u53d8\u6210\u4e00\u6761\uff0c\u4f7f $m$ \u5927\u5927\u7f29\u5c0f\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nmw)$ \uff0c\u8fd9\u91cc $n=10$ \u3002\u5b9e\u6d4b $NTT$ \u65e0\u660e\u663e\u4f18\u52bf\u3002\n\n- $\\text{data 6}$\n\n$n=200,m=100000,q=100000,w\\le 10^9$ \uff0c\u8fb9\u6743\u5747\u4e3a $1$ \u3002\n\n\u4ee4 $f_d(u,v)$ \u8868\u793a\u4ece $u$ \u5230 $v$ \u8def\u5f84\u957f\u5ea6\u4e3a $d$ \u7684\u65b9\u6848\u6570\uff0c$E(i,j)$ \u8868\u793a $i$ \u548c $j$ \u4e4b\u95f4\u7684\u8fb9\u6570\u3002\n\n\u5219 $f_d(u,v)=\\sum\\limits_{k=1}^{n}f_{d-1}(u,k)E(k,v)$ \uff0c\u5c06 $f_d$ \u770b\u6210\u77e9\u9635\uff0c\u5219 $f_0=I,f_k=E^k$ \u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u5b9e\u9645\u4e0a\u6709\u7528\u7684\u53ea\u6709\u77e9\u9635\u7684\u7b2c $u$ \u6392\uff0c\u6545\u9884\u5904\u7406 $E^{2^i}$ \uff0c\u67e5\u8be2\u65f6\u53d8\u6210**\u5411\u91cf\u4e58\u77e9\u9635**\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3logk+qn^2logk)$ \uff0c\u672c\u673a\u8981\u8dd1\u5f88\u4e45\u3002\n\n\u53d1\u73b0 $n,q$ \u5e76\u4e0d\u540c\u9636\uff0c\u8003\u8651\u6839\u53f7\u5206\u6cbb\uff0c\u8bbe\u9608\u503c\u4e3a $T$ \uff0c\u9884\u5904\u7406\u6240\u6709\u7684 $E^{cT^i}\\ (1\\le c<T)$ \uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3Tlog_Tk+qn^2log_Tk)$ \u3002\n\n\u53d6 $T=\\frac{q}{n}$ \u65f6\u53d6\u5f97\u6700\u4f18\u590d\u6742\u5ea6\uff0c\u4e3a $O(n^2qlog_{\\frac{q}{n}}k)$ \uff0c\u8fd1\u4f3c $O(n^2q)$ \u3002\n\n- $\\text{data 7}$\n\n$n=100,m=100000,q=100000,w<10^9$ \uff0c\u8fb9\u6743\u4e3a $1/2$ \u3002\n\n\u628a $2$ \u6743\u8fb9\u4e2d\u95f4\u52a0\u4e00\u4e2a\u865a\u70b9 $k$ \uff0c\u7136\u540e $u$ \u8fde\u5411 $k$ \u8fb9\u6743\u4e3a $1$ \uff0c$k$ \u8fde\u5411 $v$ \u8fb9\u6743\u4e3a $1$ \uff0c\u5957\u7528 $\\text{data 6}$ \u7684\u505a\u6cd5\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2qlog_{\\frac{q}{n}}k)$ \uff0c\u672c\u673a\u8fd0\u884c\u4e86 $25s$ \u3002\n\n- $\\text{data 8}$\n\n$n=1000,m=100000,q=10000,w<10^9$ \uff0c\u8fb9\u6743\u5747\u4e3a $1$ \u3002\n\n\u76f4\u63a5\u6cbf\u7528 $\\text{data 6}$ \u7684\u505a\u6cd5\u5373\u53ef\u3002\n\n- $\\text{data 9}$\n\n$n=10000,m=100000,q=100000,w\\le 10^9$ \uff0c\u8fb9\u6743\u5747\u4e3a $1$ \u3002\n\n\u8fd9\u4e2a $n$ \u9650\u5236\u4e86\u6211\u4eec\u7684\u505a\u6cd5\uff0c\u4f46\u89c2\u5bdf\u53d1\u73b0\uff0c\u5728\u7f16\u53f7 $\\% 1000$ \u610f\u4e49\u4e0b\uff0c\u6240\u6709\u8fde\u8fb9\u5747\u662f $(u,u+1,*)$ \u7684\u5f62\u5f0f\uff0c\u56e0\u6b64\u5c06\u70b9\u6309 $\\% 1000$ \u5212\u5206\u4e3a $1000$ \u7c7b\u3002\n\n\u5b9a\u4e49 $G_i$ \u77e9\u9635\u8868\u793a\u7b2c $i$ \u7c7b\u8f6c\u79fb\u5230\u7b2c $i+1$ \u7c7b\u7684\u90bb\u63a5\u77e9\u9635\uff0c\u6ce8\u610f\u5230\u8be2\u95ee\u7684  $u,v,k$ \u4e5f\u6ee1\u8db3 $v-u\\equiv k (\\mod 1000)$ \uff0c\u6240\u4ee5\u76f4\u63a5\u4ece\u7b2c $u\\% 1000$ \u7c7b\u51fa\u53d1\uff0c\u4f9d\u6b21\u4e58\u4e0a $G_{u\\%1000},G_{u\\%1000+1}...G_{v\\%1000-1}$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((\\frac{n}{1000})^3(1000+\\frac{k}{1000})+1000q(\\frac{n}{1000})^3)$ \uff0c\u672c\u673a\u8fd0\u884c\u4e86 $241s$ \u3002\n\n- $\\text{data 10}$\n\n$n=3000,m=100000,q=10000,w<10^9$ \uff0c\u8fb9\u6743\u5747\u4e3a $1$ \u3002\n\n\u4f9d\u65e7\u6cbf\u7528 $\\text{data 6}$ \u7684\u505a\u6cd5\uff0c\u672c\u673a\u8fd0\u884c\u4e86 $8$ \u5206\u949f\u3002\u65f6\u95f4\u6709\u70b9\u957f\uff0c\u4f46\u63d0\u7b54\u9898\u90fd\u662f\u9700\u8981\u8010\u5fc3\u7684\uff0c\u5bf9\u5427\uff1f",
        "postTime": 1609834268,
        "uid": 112381,
        "name": "wlzhouzhuan",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5418 \u3010[CTSC2016]NOIP\u5341\u5408\u4e00\u3011"
    }
]