[
    {
        "content": "\u9996\u5148\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u77e9\u5f62\uff0c\u82e5 $x_2<0$\uff0c\u5c31\u5c06 $x_1,x_2$ \u5747\u4e58\u4e0a $-1$ \u518d\u4ea4\u6362\uff0c\u5bf9\u4e8e $y_1,y_2$ \u4e5f\u505a\u540c\u6837\u7684\u64cd\u4f5c\u3002\n\n\u6211\u4eec\u5efa\u7acb\u4e00\u4e2a\u64cd\u4f5c\u5e8f\u5217 `a[0~1000]`\uff0c\u548c\u4e00\u4e2a\u6570\u7ec4 $d$\uff0c\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u7528 $(x,y)$ \u8868\u793a\uff0c\u5c31\u662f\u5728 $d$ \u5185\u628a\u6240\u6709 $0$ \u5230 $x$ \u7684\u4f4d\u7f6e\u52a0\u4e0a $y$\u3002\n\n\u6211\u4eec\u518d\u5b9a\u4e49\u4e00\u79cd\u65b0\u7684**\u64cd\u4f5c** $[x,y,z]$\uff0c\u8868\u793a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $0\\le i\\le x$ \u90fd\u5728 `a[i]` \u5904\u63d2\u5165\u4e00\u4e2a\u64cd\u4f5c $(y,z)$\u3002\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u79cd**\u884c\u4e3a** $\\{i,x_1,x_2,z\\}$\uff0c\u8868\u793a\u6267\u884c\uff1a\n\n* \u82e5 $x_1<0$\uff0c\u5c31\u6267\u884c\u4e09\u4e2a\u64cd\u4f5c\u64cd\u4f5c $[i,-x_1,z],[i,x_2,z],[i,0,-z]$\n* \u82e5 $x_1=0$\uff0c\u5c31\u6267\u884c\u64cd\u4f5c $[i,x_2,z]$\n* \u82e5 $x_1>0$\uff0c\u5c31\u6267\u884c\u4e24\u4e2a\u64cd\u4f5c $[i,x_2,z],[i,x_1-1,-z]$\n\n\u4e0b\u9762\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u77e9\u5f62\u7684 $y_1,y_2$ \u8fdb\u884c\u5206\u7c7b\uff1a\n\n* \u82e5 $y_1<0$\uff0c\u6267\u884c\u884c\u4e3a $\\{-y_1,x_1,x_2,1\\},\\{y_2,x_1,x_2,1\\},\\{0,x_1,x_2,-1\\}$\n* \u82e5 $y_1=0$\uff0c\u6267\u884c\u884c\u4e3a $\\{y_2,x_1,x_2,1\\}$\n* \u82e5 $y_1>0$\uff0c\u6267\u884c\u884c\u4e3a $\\{y_2,x_1,x_2,1\\},\\{y_1-1,x_1,x_2,-1\\}$\n\n\u56e0\u4e3a\u8be2\u95ee\u7684\u65f6\u95f4\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u53ef\u4ee5\u8bb0\u5f55\u4e00\u4e2a\u65f6\u95f4 $t$\uff0c\u8868\u793a\u5f53\u524d\u662f $t$ \u65f6\u523b\uff0c\u521d\u59cb\u5316 $t=-1$\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee $k$\uff0c\u91cd\u590d\u4e0b\u9762\u7684\u64cd\u4f5c\u76f4\u5230 $t=k$\uff1a\n\n* \u5c06 $t+1$\uff0c\u7136\u540e\u6267\u884c `a[t]` \u7684\u6240\u6709\u64cd\u4f5c\u3002\n\n\u6700\u540e\u7684\u7b54\u6848\u5c31\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $0\\le i\\le k$\uff0c$d$ \u6570\u7ec4\u5185\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u5bf9\u5e94\u7684\u503c\u7684\u548c\uff0c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4 $d$\u3002\u4f46\u662f\u8fd9\u53ea\u80fd\u8fc7\u6389 $|y_1|,|y_2|\\le 1000$ \u7684\u6570\u636e\u3002\n\n## \u6b63\u89e3\n\n\u6211\u4eec\u53d1\u73b0\u8981\u6267\u884c\u7684\u64cd\u4f5c $[x,y,z]$ \u7684\u6570\u91cf\u662f\u4e0d\u591a\u7684\u3002\n\n\u518d\u7ecf\u8fc7\u4ed4\u7ec6\u601d\u8003\uff0c\u53ef\u4ee5\u53d1\u73b0 $t$ \u65f6\u523b\u7684\u7b54\u6848\u5c31\u662f\u5bf9\u4e8e\u6240\u6709 $[x,y,z]$\uff0c$(\\min(x,t)+1)(\\min(y,t)+1)\\times z$ \u7684\u548c\u3002\u8be6\u7ec6\u7684\u539f\u56e0\u53ef\u4ee5\u770b\u770b\u9898\u89e3\u7684\u672b\u5c3e\u3002\n\n\u6211\u4eec\u5148\u4e0d\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u628a\u8fd9\u4e9b\u64cd\u4f5c\u63d2\u5165\u5230\u4e00\u4e2a\u96c6\u5408 $S$\uff0c\u7136\u540e\u7ef4\u62a4\u56db\u4e2a\u503c `sum,add,ans,addans`\uff1a\n\n* `sum` \u8868\u793a\u6240\u6709 $y>t$ \u7684\u64cd\u4f5c $[x,y,z]$ \u7684 $z\\times(\\min(x,t)+1)$ \u7684\u548c\u3002\n\n* `add` \u8868\u793a $t$ \u6bcf\u600e\u52a0 $1$ \u65f6 `sum` \u8981\u589e\u52a0\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u6240\u6709 $y>t\\land x>t$ \u7684\u64cd\u4f5c $[x,y,z]$ \u7684 $z$ \u7684\u548c\u3002\n\n* `ans` \u8868\u793a\u6240\u6709 $y\\le t$ \u7684\u64cd\u4f5c $[x,y,z]$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n* `addans` \u8868\u793a $t$ \u6bcf\u600e\u52a0 $1$ \u65f6 `ans` \u8981\u589e\u52a0\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u6240\u6709 $y\\le t\\land x>t$ \u7684\u64cd\u4f5c $[x,y,z]$ \u7684 $z\\times(y+1)$ \u7684\u548c\u3002\n\n\u6211\u4eec\u5efa\u7acb\u4e00\u4e2a $dl$ \u6570\u7ec4\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u64cd\u4f5c $[x,y,z]$ \u5728 `dl[x+1]` \u5904\u63d2\u5165\u3002\n\n\u5f53 $t$ \u6bcf\u6b21\u589e\u52a0 $1$ \u65f6\uff0c\u679a\u4e3e\u6240\u6709 `dl[t]` \u5185\u7684\u64cd\u4f5c $[x,y,z]$\uff1a\n\n* \u82e5\u6b64\u64cd\u4f5c\u5df2\u7ecf\u5728\u96c6\u5408 $S$ \u5185\u88ab\u5220\u9664\u4e86\uff08\u4e5f\u5c31\u662f\u5728\u8fd9\u6b21\u8be2\u95ee\u4e4b\u524d $y\\le t$\uff09\uff0c\u5c31\u628a `addans` \u51cf\u53bb $z\\times(y+1)$\u3002\n\n* \u82e5\u6b64\u64cd\u4f5c\u8fd8\u5728\u96c6\u5408 $S$ \u5185\uff08\u4e5f\u5c31\u662f\u5728\u8fd9\u6b21\u8be2\u95ee\u4e4b\u524d $y>t$\uff09\uff0c\u5c31\u628a `add` \u51cf\u53bb $z$\u3002\n\n\u76f4\u5230 $t=k$ \u65f6 $t$ \u624d\u505c\u6b62\u589e\u52a0\uff0c\u4e0b\u9762\u518d\u66f4\u65b0\u96c6\u5408 $S$\u3002\u679a\u4e3e\u6240\u6709\u6ee1\u8db3 $y\\le k$ \u7684\u64cd\u4f5c $[x,y,z]$\uff1a\n\n* \u82e5 $x\\ge k$\uff0c\u8bf4\u660e\u6b64\u64cd\u4f5c\u8fd8\u5728\u672a\u5728\u4e0a\u9762\u7684 `dl` \u6570\u7ec4\u4e2d\u88ab\u8bbf\u95ee\u8fc7\uff0c\u6b64\u65f6 `sum` \u8981\u51cf\u53bb $z\\times(k+1)$\uff0c`add` \u51cf\u53bb $z$\uff0c`ans` \u52a0\u4e0a $z\\times (k+1)(y+1)$\uff0c`addans` \u52a0\u4e0a $z\\times (y+1)$\u3002\n\n* \u82e5 $x<k$\uff0c\u628a `sum` \u51cf\u53bb $z\\times (x+1)$\uff0c`ans` \u52a0\u4e0a $z\\times (x+1)(y+1)$\u3002\n\n\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f $(t+1)\\times sum+ans$\u3002\n\n\u4ee3\u7801\uff1a\n```c++\n#include<bits/stdc++.h>\n#define ll long long\n#define mxn 1000003\n#define md 1000000007\n#define pb push_back\n#define mkp make_pair\n#define rep(i,a,b) for(int i=a;i<=b;++i)\n#define rept(i,a,b) for(int i=a;i<b;++i)\n#define drep(i,a,b) for(int i=a;i>=b;--i)\nusing namespace std;\ninline int read(){\n\tint x=0;bool flag=true;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')flag=false;ch=getchar();}\n\twhile(isdigit(ch))x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn flag?x:-x;\n}\nstruct node{\n\tint x,y,z;\n};\ninline bool operator<(node x,node y){\n\treturn x.y!=y.y?x.y<y.y:x.x!=y.x?x.x<y.x:x.z<y.z;\n}\nint n,m,t=-1;\nvector<node>dl[mxn];\nmultiset<node>s;\nll sum,add,ans,ads;\nvoid puta(int x,int y,int z){\n\tadd+=z;\n\ts.insert({x,y,z});\n\tdl[x+1].pb({x,y,z});\n}\nvoid ins(int x,int l,int r,int y){\n\tif(l<0){\n\t\tputa(x,-l,y);\n\t\tputa(x,r,y);\n\t\tputa(x,0,-y);\n\t}else if(l==0){\n\t\tputa(x,r,y);\n\t}else{\n\t\tputa(x,r,y);\n\t\tputa(x,l-1,-y);\n\t}\n}\nsigned main(){\n\tn=read();\n\tfor(int i=0,x1,x2,y1,y2;i<n;++i){\n\t\tx1=read(),y1=read(),x2=read(),y2=read();\n\t\tif(x1<0&&x2<0){\n\t\t\tswap(x1,x2);\n\t\t\tx1=-x1,x2=-x2;\n\t\t}\n\t\tif(y1<0&&y2<0){\n\t\t\tswap(y1,y2);\n\t\t\ty1=-y1,y2=-y2;\n\t\t}\n\t\tif(y1<0){\n\t\t\tins(-y1,x1,x2,1);\n\t\t\tins(y2,x1,x2,1);\n\t\t\tins(0,x1,x2,-1);\n\t\t}else if(y1==0){\n\t\t\tins(y2,x1,x2,1);\n\t\t}else{\n\t\t\tins(y2,x1,x2,1);\n\t\t\tins(y1-1,x1,x2,-1);\n\t\t} \n\t}\n\tm=read();\n\tint x;\n\twhile(m--){\n\t\tx=read();\n\t\twhile(t<x){\n\t\t\tt++;\n\t\t\tfor(node i:dl[t]){\n\t\t\t\tauto it=s.find(i);\n\t\t\t\tif(it==s.end())ads-=i.z*(i.y+1ll);\n\t\t\t\telse add-=i.z;\n\t\t\t}\n\t\t\tsum+=add;\n\t\t\tans+=ads;\n\t\t}\n\t\twhile(s.size()&&(s.begin()->y)<=x){\n\t\t\tnode i=*s.begin();s.erase(s.begin());\n\t\t\tif(i.x>=x){\n\t\t\t\tsum-=i.z*(x+1ll);\n\t\t\t\tadd-=i.z;\n\t\t\t\tans+=i.z*(i.y+1ll)*(x+1ll);\n\t\t\t\tads+=i.z*(i.y+1ll);\n\t\t\t}else{\n\t\t\t\tsum-=i.z*(i.x+1ll);\n\t\t\t\tans+=(i.x+1ll)*(i.y+1ll)*i.z;\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\",sum*(x+1ll)+ans);\n\t}\n\treturn 0;\n}\n```\n\u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48 $t$ \u65f6\u523b\u7684\u7b54\u6848\u5c31\u662f\u5bf9\u4e8e\u6240\u6709 $[x,y,z]$\uff0c$(\\min(x,t)+1)(\\min(y,t)+1)\\times z$ \u7684\u548c\u3002\n\n\u9898\u76ee\u8981\u6c42\u7684\u5c31\u662f\u4e00\u4e2a\u5de6\u4e0b\u89d2\u4e3a $(-k,-k)$\uff0c\u53f3\u4e0a\u89d2\u4e3a $(k,k)$ \u7684\u5927\u77e9\u5f62\u548c\u4e00\u4e9b\u5176\u4ed6\u7684\u77e9\u5f62\u7684\u4ea4\u7684\u9762\u79ef\u4e4b\u548c\u3002\n\n\u56e0\u4e3a\u6700\u7ec8\u7684\u7b54\u6848\u662f\u6240\u6709 $t\\le k$ \u65f6\u7684 $d$ \u6570\u7ec4\u5185\u7684\u7b2c $0$ \u5230 $i$ \u4e2a\u4f4d\u7f6e\u5bf9\u5e94\u7684\u503c\u7684\u603b\u548c\uff0c\u64cd\u4f5c $[x,y,z]$ \u5c31\u53ef\u4ee5\u8f6c\u5316\u6210\u4e00\u4e2a\u5de6\u4e0b\u89d2\u662f $(0,0)$\uff0c\u53f3\u4e0a\u89d2\u662f $(x,y)$\uff0c\u6743\u503c\u4e3a $z$ \u7684\u77e9\u5f62\u3002\n\n\u7b54\u6848\u5c31\u662f\u4e00\u4e2a\u5de6\u4e0b\u89d2\u662f $(0,0)$\uff0c\u53f3\u4e0a\u89d2\u662f $(k,k)$ \u7684\u5927\u77e9\u5f62\u548c\u6bcf\u4e00\u4e2a $[x,y,z]$ \u5bf9\u5e94\u7684\u77e9\u5f62\u7684\u4ea4\u7684\u9762\u79ef\u4e58\u4ee5 $z$ \u7684\u548c\u3002\n",
        "postTime": 1666877408,
        "uid": 329857,
        "name": "zifanwang",
        "ccfLevel": 7,
        "title": "[COI2009] PLAHTE \u9898\u89e3"
    }
]