[
    {
        "content": "\u5148\u8bf4\u9898\u610f\uff1a\n\t\n   >\u6211\u4eec\u770b\u9898\u53ef\u77e5\uff08\u60e8\u4e0d\u5fcd\u7779\u7684\u82f1\u8bed\uff09\uff0c\u627e\u4eba\u7ffb\u8bd1\uff08\u611f\u8c22\u673a\u623f\u6700\u53ef\u7231\u7684\u6735jm\uff0c\u548c\u966a\u6211\u8fc7\u6837\u4f8b\u7684mhy\uff09\n   \n   >\u9488\u5bf9\u4e8e\u672c\u9898\uff0c\u6211\u4eec\u5df2\u77e5k\u4e2a\u957f\u5ea6\u4e3an\u7684\u62ec\u53f7\u5e8f\u5217\uff0c\u9700\u8981\u6c42\u51fa\u6709\u591a\u5c11\u4e2a\u533a\u95f4\u5728k\u4e2a\u5e8f\u5217\u4e2d\u5bf9\u5e94\u7684\u5b50\u4e32\u5747\u5e73\u8861\u3002\n   \n   \u90a3\u4e48\u4ec0\u4e48\u662f\u5747\u5e73\u8861\uff1f\n   \n   \u6211\u4eec\u9488\u5bf9\u4e8e\u6837\u4f8b\u8fdb\u884c\u89e3\u91ca\uff1a\n   \n   \tS_1 = )()((())))(())\t\t\t\t\t\n    S_2 = ()(()()()((())\n\tS_3 = )))(()()))(())\n    \n    \u6709\u533a\u95f4\u30103\u2026\u20268\u3011\u3001\u301010\u2026\u202613\u3011\u3001\u301011\u2026\u202612\u3011\u7b26\u5408\uff1bwhy\uff1f\n    \n    \u770b\uff1a\n   \tS_1[3...8] = ((()))\n   \tS_2[3...8] = ()()() \n   \tS_3[3...8] = (()())\n    \n    \u6240\u4ee5\u9898\u610f\u5e94\u8be5\u7406\u89e3\u4e86\u5427\uff01\n    \n\u90a3\u4e48\u9898\u4fbf\u53d8\u5f97\u7b80\u5355\u4e86\u8d77\u6765\uff1a\n\n\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u60f3\uff1a\n\n>\u8003\u8651DP\u3002\nf[i]\u8868\u793a\u4ee5ii\u4e3a\u5de6\u7aef\u70b9\u7684\u5408\u6cd5\u533a\u95f4\u4e2a\u6570\u3002\u4ee4pos[i]\u8868\u793a\u4ee5ii\u4e3a\u5de6\u7aef\u70b9\uff0c\u6700\u9760\u5de6\u7684\u5408\u6cd5\u53f3\u7aef\u70b9\u3002\n\u90a3\u4e48\u6709\u5982\u4e0b\u8f6c\u79fb\uff1a\nf[i]=f[pos[i]+1]+1.\n\u540e\u9762\u7684\u201c+1\u201d\u8868\u793a[i\u2026\u2026pos[i]]\u8fd9\u6bb5\u5408\u6cd5\u533a\u95f4\uff0cf[pos[i]+1]\u8868\u793a\u5728\u8fd9\u6bb5\u5408\u6cd5\u533a\u95f4\u7684\u57fa\u7840\u4e0a\uff0c\u8fd8\u53ef\u4ee5\u5728\u540e\u9762\u62fc\u63a5\u66f4\u591a\u5408\u6cd5\u533a\u95f4\u3002\n\n>\u90a3\u4e48\u6211\u4eec\u7684\u76ee\u7684\u5c31\u662f\u6c42pos[i],\n\u8003\u8651\u4e00\u6bb5\u533a\u95f4\u4e3a\u4ec0\u4e48\u5408\u6cd5\uff1f\n\u6211\u4eec\u4ee4\u5de6\u62ec\u53f7\u4e3a1\uff0c\u53f3\u62ec\u53f7\u4e3a-1\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u884c\u5355\u72ec\u6c42\u524d\u7f00\u548c\u3002\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u884c\u5355\u72ec\u8003\u8651\uff0c\u4e00\u4e2a\u533a\u95f4[l,r]\u9700\u8981\u6ee1\u8db32\u4e2a\u9650\u5236\uff1a\n\n\t\t\tsum[r]\u2212sum[l\u22121]=0\n\t\t\t\u533a\u95f4\u4e2d\u4efb\u610f\u4e00\u70b9i\u6ee1\u8db3sum[i]\u2212sum[l\u22121]>=0\n   \n\u6211\u4eec\u8003\u8651\u5206\u5f00\u5904\u7406\u8fd92\u4e2a\u9650\u5236\u3002\n\u5bf9\u4e8e\u6bcf\u4e2a\u5de6\u7aef\u70b9i\uff0c\u5904\u7406\u51fa\u4f7f\u5f97\u533a\u95f4\u524d\u7f00\u4e3a\u8d1f\u7684\u7b2c\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\u53ea\u8981\u53f3\u7aef\u70b9\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u70b9\uff0c\u5c31\u6ee1\u8db3\u7b2c\u4e8c\u70b9\u9650\u5236\u3002\n\n\n\u5bf9\u4e8e\u540c\u4e00\u5217\u7684\u6bcf\u4e00\u884c\u90fd\u6c42\u51fa\u8fd9\u4e2a\u503c\uff0c\u7136\u540e\u53d6min\uff0c\u5f97\u5230\u503ct,\u8868\u793a\u7b2ci\u5217\u7684\u53f3\u7aef\u70b9\u53ea\u8981\u4e0d\u8d85\u8fc7t\u5c31\u53ef\u4ee5\u5bf9k\u884c\u90fd\u6ee1\u8db3\u7b2c\u4e8c\u70b9\u9650\u5236\u3002\n\n\n\u90a3\u4e48\u4ee4\u8fd9\u4e2a\u6700\u5c0f\u7684\uff0c\u4ee4\u5de6\u7aef\u70b9i\u4e0d\u6ee1\u8db3\u7b2c\u4e8c\u70b9\u9650\u5236\u7684\u53f3\u7aef\u70b9\u4e3alim[i]\n\n\u90a3\u4e48\u7ee7\u7eed\u601d\u8def\uff1a\n\n\u7136\u540e\u4ece\u5927\u5230\u5c0f\u679a\u4e3e\u5217i\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u5904\u7406\u7684\u5c31\u662f\u7b2c\u4e00\u70b9\u9650\u5236\u3002\n\n\u53ea\u9700\u8981\u67e5\u8be2\u6700\u8fd1\u7684\u4e00\u4e2a\u53f3\u7aef\u70b9\u6ee1\u8db3\u5f53\u524d\u5217\u7684k\u884c\u4e0e\u7b2ci\u22121\u5217\u7684k\u884c\u76f8\u540c\u5373\u53ef\uff0c\n\n\u5982\u679c\u8fd9\u4e2a\u6700\u8fd1\u7684\u53f3\u7aef\u70b9\u90fd\u5927\u4e8e\u7b49\u4e8elim[i],\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a\u5de6\u7aef\u70b9\u5c31\u6ca1\u6709\u5408\u6cd5\u65b9\u6848\u4e86\u3002\n\n\u5426\u5219\u6211\u4eec\u5c31\u627e\u5230\u4e86pos[i].\n   \n   \u90a3\u4e48\u8fd9\u4e24\u4e2a\u4e1c\u897f\u5e94\u8be5\u5982\u4f55\u6c42\u5462\uff1f\n\n\u6c42lim[i]:\n>\u5148\u5bf9\u6bcf\u4e00\u884c\u6c42\u51fa\u5bf9\u5e94\u7684\u53f3\u7aef\u70b9\uff0c\u7136\u540e\u53d6min\u5373\u53ef\uff0c\u63a5\u4e0b\u6765\u8bb2\u5982\u4f55\u5bf9\u4e8e\u6bcf\u884c\u6c42\u8fd9\u4e2a\u53f3\u7aef\u70b9\u3002\n\u5982\u679c\u6709\u53f3\u7aef\u70b9\u6ee1\u8db3\u4f7f\u5f97\u4ee5i\u4e3a\u5de6\u7aef\u70b9\u7684\u533a\u95f4\u524d\u7f00\u548c\u4e3a\u8d1f\uff0c\u90a3\u4e48\u80af\u5b9a\u4f1a\u6709\u4e00\u4e2a\u53f3\u7aef\u70b9\u6700\u5148\u6ee1\u8db3\u8fd9\u4e2a\u4e1c\u897f\uff0c\u4e5f\u5c31\u662fsum[j]\u2212sum[i\u22121]=\u22121.\u90a3\u4e48\u6211\u4eec\u67e5\u8be2\u6ee1\u8db3sum[j]=sum[i\u22121]\u22121\u7684\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\u8fd9\u4e2a\u6211\u4eec\u4ece\u5927\u5230\u5c0f\u679a\u4e3ei,\u7528minn[i]\u8868\u793a\u5230\u5f53\u524d\u4e3a\u6b62\uff0c\u503c\u4e3ai\u7684\u70b9\u7684\u6700\u5c0f\u4e0b\u6807\u662f\u591a\u5c11\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u4e86\u3002\n\n\u6c42pos[i]:\n>\u7528\u548c\u4e0a\u9762\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u8fd9\u6b21\u662f\u8981\u627e\u4e00\u4e2a\u4f7f\u5f97k\u5143\u7ec4\u76f8\u7b49\u7684\u6700\u5c0fj\u3002\n\u56e0\u4e3ak\u5f88\u5c0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u628ak\u4e2a\u503c\u90fd\u5b58\u5230map\u91cc\u66b4\u529b\u627e\u3002\n\ncode(\u611f\u6027\u7406\u89e3\u2026\u2026\u8c22\u8c22):\n```cpp\n/*\n\tName: luogu P3059 [USACO12NOV]\u540c\u65f6\u5e73\u8861\u7ebfConcurrently Balanced Strings\n\tCopyright: \u7f51\u7edc\u9898\u89e3\u3001ccsc\n\tAuthor: ccsc\n\tDate: 15-10-19 14:45\n\tDescription: \n*/\n#include<bits/stdc++.h>\nusing namespace std;\n#define ri register int\n#define ll long long\n#define inf 2139062143\nll ans,f[100100];\nint lim[100100],minn[100100],n,m;\nchar s[100100];\nmap <signed ll,int> M;\nstruct node{\n    int s[12];signed ll opt;\n    \n    friend bool operator ==(node a,node b)\n    {\n        for(ri i=1;i<=m;i++)if(a.s[i]!=b.s[i]) return false;\n        return true;\n    }\n}sum[100100];\n\ninline void upmax(int &a,int b){if(b>a)a=b;}\ninline void upmin(int &a,int b){if(b<a)a=b;}\n\ninline int read()\n{\n    int x=0;\n    bool f=0;\n    char ch;\n    ch=getchar();\n    while(ch<'0'||ch>'9'){\n    \tif(ch=='-')f=1;\n    \tch=getchar();\n\t}\n\twhile(ch<='9'&&ch>='0'){\n\t\tx=(x<<3)+(x<<1)+(ch^48);\n\t\tch=getchar(); \n\t}\n\treturn f?-x:x;\n}\nint main()\n{\n    m=read();\n\tn=read();\n\tfor(ri i=1;i<=m;i++)\n    {\n        scanf(\"%s\",s+1);\n        for(ri j=1;j<=n;j++) \n            sum[j].s[i]=sum[j-1].s[i]+((s[j]==')')?-1:1);\n    }\n    \n\tfor(ri i=1;i<=n;i++) lim[i]=inf;\n    for(ri i=1;i<=m;i++)\n    {\n        memset(minn,127,sizeof(minn));\n        for(ri j=n;j;j--)//\u5bf9\u4e8e\u6bcf\u884c\u7684\u6bcf\u4e2a\u70b9\u627e\u53f3\u8fb9\u7684\uff0c\u6700\u8fd1\u7684\uff0c\u533a\u95f4\u548c\u4e3a-1\u7684\u70b9(\u6bd4\u5f53\u524d\u524d\u7f00\u5c0f1\n        {\n            upmin(minn[(sum[j].s[i]+50000)],j);//\u5148\u52a0\u5165\uff0c\u9632\u6b62\u7b2c\u4e00\u4e2a\u62ec\u53f7\u662f\u53f3\u62ec\u53f7\n            upmin(lim[j],minn[(sum[j-1].s[i]-1+50000)]);//\u5224\u65ad[l, r]=0,\u9700\u8981\u7528\u5230sum[l - 1]\u548csum[r]\n        }\n    }\n    for(ri i=1;i<=n;i++)\n        for(ri j=1;j<=m;j++)\n            sum[i].opt=sum[i].opt*13+sum[i].s[j];\n    \n\t\n\tfor(ri i=n;i;i--)\n    {\n        int pos=M[sum[i-1].opt];//\u627e\u6700\u5c0f\u7684\u548c\u5f53\u524dl - 1\u524d\u7f00\u76f8\u540c\u7684\u524d\u7f00\n        if(pos&&pos<lim[i]) f[i]=f[pos+1]+1,ans+=f[i];\n        if(M[sum[i].opt]) upmin(M[sum[i].opt],i);\n        else M[sum[i].opt]=i;\n    }\n    printf(\"%lld\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1571137913,
        "uid": 211665,
        "name": "ccsc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3059 \u3010[USACO12NOV]\u540c\u65f6\u5e73\u8861\u7ebfConcurrently Balanced Strings\u3011"
    },
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a $k$ \u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u62ec\u53f7\u4e32 $S_1, S_2\\cdots S_k$\uff0c\u6c42\u8fd9\u6837\u7684\u533a\u95f4 $[l, r]$ \u4e4b\u6570\u91cf\uff0c\u6ee1\u8db3\u5bf9\u4e8e\u4efb\u4e00 $i\\in[1, k], S_{i}[l .. r]$ \u662f\u5408\u6cd5\u7684\u62ec\u53f7\u4e32\u3002\n\n## \u89e3\u6cd5\n\n\u4e0d\u59a8\u8003\u5bdf\u53ea\u6709\u4e00\u4e2a\u4e32 $S$ \u7684\u60c5\u51b5\u5c06\u5982\u4f55\u5904\u7406\u3002\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u6808\u89e3\u51b3\uff1a\u6211\u4eec\u5c06\u6bcf\u4e2a\u62ec\u53f7\u4f9d\u6b21\u8fdb\u5165\u6808\u4e2d\uff0c\u5f39\u51fa\u5339\u914d\u7684\u62ec\u53f7\u5e76\u8bb0\u5f55\u3002\u5bb9\u6613\u8bc1\u660e\u5728\u4efb\u610f\u4e00\u4e2a\u5408\u6cd5\u7684 $S$ \u7684\u5b50\u4e32\u4e2d\uff0c\u6bcf\u4e2a\u62ec\u53f7\u6240\u6240\u5339\u914d\u7684\u62ec\u53f7\u4e0d\u4f1a\u6539\u53d8\u3002\u4e0d\u59a8\u8bb0 $t_i$ \u4e3a\u7b2c $i$ \u4e2a\u62ec\u53f7\u6240\u5339\u914d\u7684\u62ec\u53f7\uff0c\u90a3\u4e48\u4e00\u4e2a\u533a\u95f4 $[l, r]$ \u5408\u6cd5\uff0c\u5f53\u4e14\u4ec5\u5f53\u5bf9\u6240\u6709 $i\\in[l, r]$ \u90fd\u6709 $a_i\\in [l, r]$\u3002\n\n\u591a\u4e2a\u4e32\u7684\u60c5\u51b5\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u6211\u4eec\u8bbe $r_i$ \u662f\u8fd9\u4e9b\u4e32 $i$ \u4f4d\u7f6e\u4e0a\u7684\u6700\u5c0f $t_i$\uff0c$p_i$ \u662f\u8fd9\u4e9b\u4e32 $i$ \u4f4d\u7f6e\u4e0a\u7684\u6700\u5927 $t_i$\u3002\u4e00\u4e2a\u533a\u95f4\u5408\u6cd5\u7684\u6761\u4ef6\u662f\u7c7b\u4f3c\u7684\u3002\n\n\u6240\u6c42\u5373 $\\sum\\limits_{l, r} [\\min\\limits_{j\\in[l, r]}\\{t_i\\}\\ge l] [\\max\\limits_{j\\in[l, r]}\\{p_i\\}\\le r]$\u3002\n\n\u8003\u5bdf\u5230\u56fa\u5b9a $l$\uff0c\u5219\u4f7f\u5f97 $\\min\\limits_{j\\in[l, r]}\\{t_i\\}\\ge l$ \u7684 $r$ \u90fd\u4f4d\u4e8e\u4e00\u4e2a\u5f62\u5982 $(l, goodl_{l}]$ \u7684\u533a\u95f4\u5185\u3002\u5bf9\u56fa\u5b9a\u7684 $r$ \u4e5f\u6709\u7c7b\u4f3c\u6027\u8d28\u3002\n\n\u6240\u6c42\u5373 $\\sum\\limits_{l, r} [l\\in [goodr_r, r)][r\\in (l, goodl_l]] = \\sum\\limits_{l} \\sum\\limits_{r\\le goodl_l} [l\\in [goodr_r, r)]$\u3002\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define f(i,x,y) for(int i=x, i##end=y; i<=i##end; ++i)\n#define d(i,x,y) for(int i=y, i##end=x; i>=i##end; --i)\n#define uf(i,x,y) for(int i=x, i##end=y; i<i##end; ++i)\n#define ll long long\n#define pir pair<int, int>\n#define fir first\n#define sec second\n#define mp make_pair\n#define pb push_back\n#define int ll\nchar ch;\nint rd() {\n\tint f=1, x=0; ch=getchar();\n\twhile(!isdigit(ch)) { f=((ch=='-')?-1:f); ch=getchar(); }\n\twhile(isdigit(ch)) { x=x*10+ch-'0'; ch=getchar(); }\n\treturn x*f;\n}\nvoid rd(int& x) { x=rd(); }\nusing namespace std;\n#define _ 50005\nint ner[15][_], ans, n, k; char str[15][_];\nint r=0; pair<int, char> stk[_];\n\n// sgt\nint s[_<<2], add[_<<2];\nvoid pushup(int p) {\n\ts[p] = s[p<<1] + s[p<<1|1];\n}\nvoid pushdown(int p, int l, int r) {\n\tif(!add[p]) return ;\n\tint mid = l+r>>1;\n\ts[p<<1] += add[p] * (mid-l+1);\n\ts[p<<1|1] += add[p] * (r-mid);\n\tadd[p<<1] += add[p]; add[p<<1|1] += add[p]; add[p]=0;\n}\nvoid modify(int p, int l, int r, int ql, int qr) {\n\tif(ql>qr || qr == 0) return ;\n\tif(ql <= l && r <= qr) {\n\t\ts[p] += r-l+1; add[p] += 1; \n\t\treturn ;\n\t}\n\tpushdown(p, l, r);\n\tint mid=l+r>>1;\n\tif(ql<=mid) modify(p<<1, l, mid, ql, qr);\n\tif(qr>mid) modify(p<<1|1, mid+1, r, ql, qr);\n\tpushup(p);\n}\nint query(int p, int l, int r, int ql, int qr) {\n\tif(ql <= l && r <= qr) return s[p];\n\tpushdown(p, l, r);\n\tint mid=l+r>>1, res=0;\n\tif(ql<=mid) res += query(p<<1, l, mid, ql, qr);\n\tif(qr>mid) res += query(p<<1|1, mid+1, r, ql, qr);\n\treturn res;\n}\n\nint mn[_][20], mx[_][20], lg2[_];\nint querymn(int i, int j) {\n\tif(i>j) return 0x3f3f3f3f;\n\tint ans = lg2[j-i+1];\n\treturn min(mn[i][ans], mn[j-(1<<ans)+1][ans]);\n}\nint querymx(int i, int j) {\n\tif(i>j) return -0x3f3f3f3f;\n\tint ans = lg2[j-i+1];\n\treturn max(mx[i][ans], mx[j-(1<<ans)+1][ans]);\n}\nint min(int x, int y) {\n\treturn x<y ? x : y;\n} \nint max(int x, int y) {\n\treturn x>y ? x : y;\n} \nint gdr[_], gdl[_], p[_];\nsigned main() {\n\trd(k); rd(n); f(i,0,k-1) scanf(\"%s\", str[i]+1);\n\tf(j,0,k-1) {\n\t\tr=0;\n\t\tf(i,1,n) {\n\t\t\tif(r && stk[r].sec=='(' && str[j][i] == ')') {\n\t\t\t\tner[j][i] = stk[r].fir; ner[j][stk[r].fir] = i; --r;\n\t\t\t} else {\n\t\t\t\tstk[++r] = mp(i, str[j][i]);\n\t\t\t}\n\t\t}\n\t}\n\tlg2[1]=0; f(i,2,n) lg2[i] = lg2[i>>1] + 1;\n\tmemset(mn, 0x3f, sizeof(mn));\n\tmemset(mx, -0x3f, sizeof(mx));\n\tf(j,0,k-1) f(i,1,n) if(ner[j][i]) mn[i][0] = min(mn[i][0], ner[j][i]); else mn[i][0] = -0x3f3f3f3f;\n\tf(j,0,k-1) f(i,1,n) if(ner[j][i]) mx[i][0] = max(mx[i][0], ner[j][i]); else mx[i][0] = 0x3f3f3f3f;\n\tf(j,1,19) for(int i=1; i+(1<<j)-1<=n; ++i) mx[i][j] = max(mx[i][j-1], mx[i+(1<<(j-1))][j-1]);\n\tf(j,1,19) for(int i=1; i+(1<<j)-1<=n; ++i) mn[i][j] = min(mn[i][j-1], mn[i+(1<<(j-1))][j-1]);\n\tf(l,1,n) {\n\t\tint r = l;\n\t\td(j,0,19) if((r+(1<<j))<=n && querymn(l, r+(1<<j)) >= l) r += (1<<j);\n\t\tgdl[l] = r;\n\t}\n\tf(r,1,n) {\n\t\tint l = r;\n\t\td(j,0,19) if((l-(1<<j))>=1 && querymx(l-(1<<j), r) <= r) l -= (1<<j);\n\t\tgdr[r] = l;\n\t}\n\tf(i,1,n) p[i]=i; sort(p+1, p+n+1, [](int x, int y){return gdl[x] < gdl[y];});\n\tint q=0;\n\tf(i,1,n) {\n\t\twhile(q<gdl[p[i]] && q<n) { modify(1, 1, n, gdr[q+1], q+1-1); ++q; }\n\t\tans += query(1, 1, n, p[i], p[i]);\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n```",
        "postTime": 1657101800,
        "uid": 133345,
        "name": "lightup37",
        "ccfLevel": 6,
        "title": "\u6d1b\u8c37#3059 USACO12NOV Concurrently Balanced Strings G \u9898\u89e3"
    },
    {
        "content": "\u633a\u795e\u4ed9\u4e00\u9053\u9898......\u4f3c\u4e4e\u80fd\u7ebf\u6027\u4f46\u6211\u592a\u83dc\u4e86\u6700\u540e\u90a3\u5757\u590d\u6742\u5ea6\u6ca1\u538b\u6389\uff08\u4e0d\u8fc7\u5e26\u4e2a\u5c0f $\\log$ \u4f9d\u65e7\u662f\u6700\u4f18\u89e3\uff09\n\n\u9898\u610f\uff1a\u7ed9\u5b9a $k$ \u4e2a\u957f\u4e3a $n$ \u7684\u62ec\u53f7\u5e8f\u5217\uff0c\u95ee\u6709\u591a\u5c11\u4e2a\u533a\u95f4\u5728\u8fd9 $k$ \u4e2a\u4e2d\u5bf9\u5e94\u7684\u62ec\u53f7\u5e8f\u5217\u5747\u5408\u6cd5\u3002\n\n\u9996\u5148\u5229\u7528\u6808\u5bf9\u6bcf\u4e2a\u4e32\u7684\u6bcf\u4e2a\u4f4d\u7f6e\u6c42\u51fa\u4e00\u4e2a $p_{i}$\uff0c\u8868\u793a\u4f4d\u7f6e $i$ \u7684\u62ec\u53f7\u5339\u914d\u6210\u529f\u65f6\uff0c\u53e6\u4e00\u534a\u7684\u62ec\u53f7\u4f4d\u7f6e\u3002\u663e\u7136\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u80fd\u5339\u914d\u7684\u62ec\u53f7\uff0c$p$ \u662f\u552f\u4e00\u7684\u3002\u5bf9\u4e8e\u4e0d\u80fd\u5339\u914d\u7684\u62ec\u53f7\uff0c\u4ee4 $p=0$ \u6216 $p=n+1$ \u5747\u53ef\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u533a\u95f4 $[l,r]$ \u5408\u6cd5\u7684\u5145\u8981\u6761\u4ef6\u662f $k$ \u4e2a\u4e32\u5747\u6ee1\u8db3 $l\\le p_{l...r}\\le r$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e\u6211\u4eec\u5b9e\u9645\u53ea\u7528\u7ef4\u62a4\u8fd9 $k$ \u4e2a\u4e32\u4e2d\u7684 $\\max\\{p\\}$ \u548c $\\min\\{p\\}$ \u5373\u53ef\uff0c\u8bb0\u4e3a $up_i$ \u548c $dn_i$\u3002\n\n\u90a3\u4e48\u533a\u95f4\u5408\u6cd5\u7b49\u4ef7\u4e8e $l\\le \\min\\{dn_i\\}$\uff0c$\\max\\{up_i\\}\\le r$\u3002\n\n\u8003\u8651\u679a\u4e3e $l$\uff0c\u5982\u4f55\u786e\u5b9a $r$\u3002\u5148\u4e0d\u8003\u8651 $dn$ \u7684\u9650\u5236\uff0c\u53ea\u5173\u6ce8 $up$ \u7684\u7ea6\u675f\u3002\u7531\u4e8e $\\max$ \u53ef\u52a0\u4e0d\u53ef\u51cf\uff0c\u6240\u4ee5\u6211\u4eec\u5012\u5e8f\u679a\u4e3e $l$\u3002\n\n\u7ef4\u62a4\u6570\u96c6 $S$ \u8868\u793a\u6240\u6709\u53ef\u80fd\u6210\u4e3a\u53f3\u7aef\u70b9\u7684 $r$\u3002\u5f53\u6211\u4eec\u679a\u4e3e\u5230 $l$ \u65f6\uff0c\u5c06 $l$ \u52a0\u5165\u5230 $S$ \u4e2d\u3002\n\n\u8bbe $w_{l,r}=\\max\\{up_{l\\dots r}\\}$\uff0c\u5f53 $l$ \u53d8\u6210 $l-1$ \u65f6\uff0c$w_{l-1,r}=\\max\\{w_{l,r},up_{l-1}\\}$\u3002\u90a3\u4e48\u6211\u4eec\u9700\u8981\u7ef4\u62a4 $w$ \u5417\uff1f\u4e0d\u9700\u8981\u3002\n\n\u663e\u7136\u5f53 $w_{l,r}>r$ \u65f6\uff0c$r$ \u5c31\u4e0d\u53ef\u80fd\u518d\u4f5c\u4e3a\u53f3\u7aef\u70b9\u51fa\u73b0\u3002\u6240\u4ee5\u6bcf\u6b21\u66f4\u65b0 $l$ \u65f6\uff0c\u6211\u4eec\u5148\u5c06 $l$ \u63d2\u5165\u6570\u96c6\u4e2d\uff0c\u7136\u540e\u5220\u53bb\u6240\u6709 $<up_l$ \u7684\u6570\u5373\u53ef\u3002$S$ \u4e2d\u5269\u4e0b\u7684\u6570\u5373\u4e3a\u4ee5 $l$ \u4e3a\u5de6\u7aef\u70b9\u65f6\uff0c\u53ea\u8003\u8651 $up$ \u7684\u9650\u5236\uff0c\u53ef\u80fd\u7684\u53f3\u7aef\u70b9\u3002\u7531\u4e8e\u6211\u4eec\u63d2\u5165\u662f\u4ece\u5927\u5f80\u5c0f\u63d2\u7684\uff0c\u6240\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6808\u5373\u53ef\u7ef4\u62a4\uff0c\u603b\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u518d\u8003\u8651 $dn$ \u7684\u9650\u5236\u3002\n\n$S$ \u4e2d\u7684\u5143\u7d20\u53ea\u662f\u53ef\u80fd\u7684 $r$\uff0c\u4f46\u6211\u4eec\u8981\u627e\u7684\u662f\u6ee1\u8db3 $\\min\\{dn_{l\\dots r}\\}\\ge l$ \u7684 $r$\u3002\u5173\u6ce8\u5230 $\\min$ \u662f\u5355\u8c03\u7684\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u627e\u5230\u7b2c\u4e00\u4e2a $dn<l$ \u7684\u4f4d\u7f6e\u3002\n\n\u4f9d\u65e7\u7ef4\u62a4\u4e00\u4e2a\u6808 $T$\uff0c\u6bcf\u6b21 $l$ \u53d8\u5c0f\u65f6\uff0c\u5148\u5c06 $l$ \u538b\u5165\u6808\u4e2d\uff0c\u4e4b\u540e\u4e0d\u65ad\u5f39\u51fa\u6808\u9876\u76f4\u81f3\u6ee1\u8db3 $dn_{top}<l$\u3002\u6b64\u65f6\u8bbe $pos=top-1$ \u5c31\u662f\u6211\u4eec $r$ \u7684\u53d6\u503c\u4e0a\u754c\u3002\u6c42\u89e3 $pos$ \u7684\u603b\u590d\u6742\u5ea6\u4e5f\u662f $O(n)$\u3002\n\n\u4e4b\u540e\u5c31\u662f\u5bf9\u4e8e $S$\uff0c\u67e5\u8be2\u5176\u4e2d\u6709\u591a\u5c11\u4e2a\u6570 $\\le pos$ \u7d2f\u52a0\u8fdb\u7b54\u6848\u91cc\u3002\u8fd9\u91cc\u6ca1\u60f3\u5230\u7ebf\u6027\u7684\u505a\u6cd5\uff0c\u4f46\u6808 $S$ \u662f\u5355\u8c03\u9012\u51cf\u7684\uff0c\u76f4\u63a5\u5728 $S$ \u91cc\u4e8c\u5206\u4f4d\u7f6e\u8ba1\u7b97\u5373\u53ef\u3002$S$ \u6808\u5143\u7d20\u4e00\u822c\u4e0d\u4f1a\u5f88\u591a\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206 $O(n\\log n)$ \u4f46\u5e38\u6570\u5f88\u5c0f\u3002\n\n\u603b\u7ed3\u4e00\u4e0b\uff1a\n1. \u7b2c\u4e00\u4e2a\u6808\u6c42\u51fa\u6bcf\u4e2a\u62ec\u53f7\u7684\u5339\u914d\u4f4d $p$\uff0c\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u6c42\u51fa $p$ \u7684\u6700\u5927\u6700\u5c0f\u503c\u3002\n2. \u5012\u5e8f\u679a\u4e3e $l$\uff0c\u7b2c\u4e8c\u4e2a\u6808\u7ef4\u62a4\u53ef\u80fd\u7684\u53f3\u7aef\u70b9\uff0c\u6bcf\u6b21\u5220\u9664\u6240\u6709 $<up_l$ \u7684\u503c\u3002\n3. \u7b2c\u4e09\u4e2a\u6808\u7ef4\u62a4 $dn<l$ \u7684\u4e0b\u6807\uff0c\u6bcf\u6b21\u6e05\u9664\u6808\u9876\u4e0d\u5408\u6cd5\u7684\u5143\u7d20\u786e\u5b9a\u53f3\u7aef\u70b9\u53d6\u503c\u8303\u56f4\u3002\n4. \u6839\u636e\u53d6\u503c\u8303\u56f4\u5728\u7b2c\u4e8c\u4e2a\u6808\u91cc\u4e8c\u5206\u4f4d\u7f6e\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u590d\u6742\u5ea6 $O(nk+n\\log n)$\u3002\n```cpp\n#include<cstdio>\n#include<cstring>\n#define min(x,y) (x<y?x:y)\n#define max(x,y) (x>y?x:y)\nint n,k,dn[50002],up[50002];\nint stk[50001],top,s2[50001],t2;\nchar s[50001];\nlong long ans;\nint main(){\n\tint i,j;\n\tscanf(\"%d%d\",&k,&n);\n\tfor(i=1;i<=n;i++)dn[i]=n+1;\n\twhile(k--){\n\t\ttop=0;\n\t\tscanf(\"%s\",s+1);\n\t\tfor(i=1;i<=n;i++){\n\t\t\tif(s[i]=='(')stk[++top]=i;\n\t\t\telse{\n\t\t\t\tif(!stk[top])dn[i]=0;\n\t\t\t\telse{\n\t\t\t\t\tint p=stk[top--];\n\t\t\t\t\tdn[p]=min(dn[p],i);\n\t\t\t\t\tup[p]=max(up[p],i);\n\t\t\t\t\tdn[i]=min(dn[i],p);\n\t\t\t\t\tup[i]=max(up[i],p);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\twhile(top)up[stk[top--]]=n+1;\n\t}\n\ttop=0;\n\ts2[++t2]=n+1;\n\tfor(i=n;i;i--){\n\t\tstk[++top]=i;\n\t\twhile(top&&stk[top]<up[i])top--;\n\t\ts2[++t2]=i;\n\t\twhile(t2&&dn[s2[t2]]>=i)t2--;\n\t\tint pos=s2[t2]-1;\n\t\tint l=1,r=top,res=top+1;\n\t\twhile(l<=r){\n\t\t\tint mid=l+r>>1;\n\t\t\tif(stk[mid]>pos)l=mid+1;\n\t\t\telse r=mid-1,res=mid;\n\t\t}\n\t\tans+=top-res+1;\n\t}\n\tprintf(\"%lld\",ans);\n}\n```",
        "postTime": 1671946279,
        "uid": 128606,
        "name": "2018ljw",
        "ccfLevel": 7,
        "title": "P3059 \u9898\u89e3"
    }
]