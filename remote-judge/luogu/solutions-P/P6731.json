[
    {
        "content": "\u8fd9\u4e2a\u9898\u5b9e\u9645\u4e0a\u662f\u4e2a$NOIP$\u96be\u5ea6\u7684\u9898$,$\u4e0d\u8fc7\u51fa\u9898\u4eba\u653e\u5230\u4e86$WC$\u7684$T3,$\u9898\u9762\u770b\u8d77\u6765\u5f88\u529d\u9000$,$\u4ee3\u7801\u4e5f\u96be\u5199$,$~~\u6570\u636e\u8303\u56f4\u4e5f\u51fa\u9505\u4e86~~$,$\u6240\u4ee5\u6ca1\u4ec0\u4e48\u4eba\u8fc7$.$\n\n\u4e3a\u4e86\u65b9\u4fbf\u63cf\u8ff0$,$\n\n\u4ee4$L=\\max(T-\\sum\\limits_{i=1}^m s_i,0),$\u5373\u6ee1\u8db3\u6bcf\u7c7b\u5b66\u79d1\u8fbe\u5230\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b\u989d\u5916\u9700\u8981\u7684\u5b66\u5206$,$\u6570\u636e\u8303\u56f4\u4fdd\u8bc1\u4e86$0\\leq L\\leq 40.$\n\n\u4ee4$P$\u4e3a\u6240\u6709\u7684\u9650\u5236\u6d89\u53ca\u5230\u7684\u8bfe\u7a0b\u603b\u6570$,$\u6570\u636e\u8303\u56f4\u4fdd\u8bc1\u4e86$0\\leq P\\leq 12.$\n\n## subtask1 : $P=0$\n\n\u5bf9\u4e8e\u6bcf\u7c7b\u8bfe\u7a0b$,$\u76f8\u5f53\u4e8e\u6211\u4eec\u8981\u5bf9\u4e00\u4e9b\u4f53\u79ef\u4e3a$1,2,3$\u7684\u7269\u54c1\u505a\u80cc\u5305$,$\u67e5\u8be2\u4f53\u79ef\u4e3a$s_i,s_i+1,s_i+2,...s_i+L$\u7684\u6700\u5c0f\u4ef7\u503c$,$\u6700\u540e\u8dd1\u4e00\u4e2a$O(M*L^2)$\u7684\u80cc\u5305\u5408\u5e76$.$\n\n\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u8dd1\u80cc\u5305\u5c31\u53ef\u4ee5\u4ee5$O(N^2)$\u7684\u590d\u6742\u5ea6\u89e3\u51b3$,$\u4f46\u662f\u592a\u6162\u4e86$.$\n\n\u5982\u679c\u4f53\u79ef\u53ea\u6709$1,$\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6392\u5e8f\u8d2a\u5fc3$.$\n\n\u5982\u679c\u4f53\u79ef\u53ea\u6709$\\{1,2\\},$\u90a3\u4e48\u6211\u4eec\u6309\u7167\u5947\u5076\u6027\u5206\u7c7b\u6392\u5e8f\u8d2a\u5fc3\u5373\u53ef$,$\u5177\u4f53\u7684\u5b9e\u73b0\u89c1\u4e0b\u6587$.$\n\n\u4e0a\u8ff0\u8d2a\u5fc3\u53ef\u4ee5$O(n\\log n)$\u7684\u590d\u6742\u5ea6\u9884\u5904\u7406\u5e76$O(1)$\u67e5\u8be2\u67d0\u4e2a\u4f53\u79ef\u7684\u7ed3\u679c$.$\n\n\u7136\u540e\u4f53\u79ef\u96c6\u5408\u53d8\u6210\u4e86$\\{1,2,3\\},$\u6211\u4eec\u5c31\u679a\u4e3e$3$\u7684\u4f7f\u7528\u6b21\u6570$,$\u7136\u540e\u67e5\u8be2\u5bf9$\\{1,2\\}$\u7684\u8d2a\u5fc3\u7ed3\u679c\u5373\u53ef$.$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4ee5$O($ \u67e5\u8be2\u4f53\u79ef $)$\u7684\u590d\u6742\u5ea6\u56de\u7b54\u4e00\u4e2a\u5355\u70b9\u8be2\u95ee$.$\n\n\u8d2a\u5fc3\u8ba1\u7b97\u7684\u590d\u6742\u5ea6\u4e3a$O(N\\log N+NL),$\u603b\u590d\u6742\u5ea6$O(N\\log N+NL+M\\times L^2),$\n\n## subtask2: $P\\leq 12$\n\n\u5bf9\u4e8e\u9650\u5236\u6ca1\u6709\u6d89\u53ca\u5230\u7684\u60c5\u51b5$,$\u628a\u9700\u8981\u7684\u89e3\u90fd\u8d2a\u5fc3\u8ba1\u7b97\u51fa\u5e76\u8bb0\u5f55\u4e0b\u6765$,$\u5e76\u628a\u9650\u5236\u6ca1\u6709\u6d89\u53ca\u5230\u7684\u7c7b\u522b\u7684$dp$\u6570\u7ec4\u5148\u8ba1\u7b97\u51fa\u6765$,$\u590d\u6742\u5ea6$O(N\\log N+NL+M\\times L^2)$\n\n\u5269\u4e0b\u7684\u8fd8\u6ca1\u786e\u5b9a\u7684\u7c7b\u522b\u6709$O(P)$\u4e2a$,$\u628a\u8fd9$O(P)$\u4e2a\u7c7b\u522b**\u9664\u53bb\u9650\u5236\u6d89\u53ca\u5230\u7684\u90e8\u5206**\u62ff\u51fa\u6765\u8d2a\u5fc3\u5e76\u8bb0\u5f55\u7b54\u6848$.$\n\n$O(2^P)$\u679a\u4e3e\u9650\u5236\u6d89\u53ca\u5230\u7684\u8bfe\u7a0b\u7684\u9009\u53d6\u60c5\u51b5$,$\u7136\u540e\u5bf9\u6bcf\u4e2a\u60c5\u51b5$,$\u5408\u5e76$O(P)$\u4e2a$DP$\u6570\u7ec4\u5373\u53ef$,$\u590d\u6742\u5ea6$O(2^PPL^2)$\n\n\u603b\u590d\u6742\u5ea6$O(N\\log N+NL+M\\times L^2+2^PPL^2)$\n\n\u4ee3\u7801 $:$\n\n```cpp\ninline void upd(int &x,int y){ y < x ? x = y : 0; }\nconst int N = 500005,M = 50005,K = 70,INF = 2e8;\nstruct Data{\n\tint v1[N],v3[N],v20[N],v21[N],l1,l3,l12,l123,l20,l21;\n\tinline void init(){ l1 = l20 = l3 = 0; }\n\tinline void Ins(int w,int c){ if (w == 1) v1[++l1] = c; else if (w == 2) v20[++l20] = c; else v3[++l3] = c; }\n\tinline void work(){\n\t\tregister int i;\n\t\tl12 = l1 + (l20<<1),l123 = l12 + l3 * 3,l21 = l20,memcpy(v21,v20,(l20+1)<<2);\n\t\tsort(v1+1,v1+l1+1),sort(v3+1,v3+l3+1);\n\t\tfor (i = 1; i < l1; i += 2) v20[++l20] = v1[i]+v1[i+1]; sort(v20+1,v20+l20+1);\n\t\tv20[0] = 0; for (i = 1; i <= l20; ++i) v20[i] += v20[i-1]; v20[l20+1] = INF; \n\t\tfor (i = 2; i < l1; i += 2) v21[++l21] = v1[i]+v1[i+1]; sort(v21+1,v21+l21+1);\n\t\tv21[0] = l1 ? v1[1] : INF; for (i = 1; i <= l21; ++i) v21[i] += v21[i-1]; v21[l21+1] = INF;\n\t}\n\tinline int ask12(int x){\n\t\tif (x <= 0) return 0; if (x > l12) return INF;\n\t\treturn (x&1) ? min(v21[x>>1],v20[x+1>>1]) : (v20[x>>1]);\n\t}\n\tinline int query(int x){\n\t\tif (x <= 0) return 0; if (x > l123) return INF;\n\t\tstatic int i,now,ans; now = 0,ans = ask12(x);\n\t\tfor (i = 1; i <= l3; ++i) now += v3[i],x -= 3,upd(ans,now+ask12(x));\n\t\treturn ans;\n\t}\n}data;\nint L; struct DPv{ int f[41]; inline void init(){ for (int i = 0; i <= L; ++i) f[i] = INF; } };\ninline void upd(DPv &A,DPv &B){\n\tstatic int f[41]; register int i,j;\n\tfor (i = 0; i <= L; ++i) f[i] = INF;\n\tfor (i = 0; i <= L; ++i) for (j = 0; i+j <= L; ++j) upd(f[i+j],A.f[i]+B.f[j]);\n\tmemcpy(A.f,f,(L+1)<<2);\n}\nvector<int> G,w[M],c[M],ans0[M],ans1[M]; vector<bool>is[M];\nint m,n[M],s[M],len[M],sumw[M],ans;\nint k,tp[K],ax[K],ay[K],bx[K],by[K],vc[K],cnt,px[13],py[13];\nDPv dp1,now,f;\ninline void solve(int S){\n\tregister int i,j; int tt,sumc = 0;\n\tfor (i = 1; i <= cnt; ++i)\n\t\tif (S>>(i-1)&1) sumc += c[px[i]][py[i]],sumw[px[i]] += w[px[i]][py[i]],is[px[i]][py[i]] = 1; else is[px[i]][py[i]] = 0;\n\tfor (i = 1; i <= k; ++i) if (is[ax[i]][ay[i]] && is[bx[i]][by[i]]){\n\t\tif (vc[i] >= INF){ for (i = 1; i <= cnt; ++i) if (S>>(i-1)&1) sumw[px[i]] -= w[px[i]][py[i]]; return; }\n\t\tsumc += tp[i] == 1 ? -vc[i] : vc[i];\n\t}\n\tfor (now = dp1,tt = 0; tt < G.size(); ++tt){\n\t\tfor (i = G[tt],f.init(),j = 0; j <= L-sumw[i]; ++j) f.f[sumw[i]+j] = ans0[i][j];\n\t\tfor (j = 0; j <= sumw[i]; ++j) f.f[sumw[i]-j] = ans1[i][j];\n\t\tupd(now,f);\n\t}\n\tupd(ans,now.f[L]+sumc);\n\tfor (i = 1; i <= cnt; ++i) if (S>>(i-1)&1) sumw[px[i]] -= w[px[i]][py[i]];\n}\nint main(){\n\tregister int i,j;\n\tread(m),read(L),ans = INF;\n\tfor (i = 1; i <= m; ++i){\n\t\tread(n[i]),read(s[i]),L -= s[i],w[i].resize(n[i]),c[i].resize(n[i]),is[i].resize(n[i]);\n\t\tfor (j = 0; j < n[i]; ++j) read(w[i][j]),read(c[i][j]);\n\t}\n\tL = max(L,0),read(k);\n\tfor (i = 1; i <= k; ++i){\n\t\tread(tp[i]),read(ax[i]),read(ay[i]),read(bx[i]),read(by[i]); --ay[i],--by[i],vc[i] = INF; if (tp[i] <= 2) read(vc[i]);\n\t\tif (!is[ax[i]][ay[i]]){ ++cnt; is[ax[i]][ay[i]] = 1,px[cnt] = ax[i],py[cnt] = ay[i]; }\n\t\tif (!is[bx[i]][by[i]]){ ++cnt; is[bx[i]][by[i]] = 1,px[cnt] = bx[i],py[cnt] = by[i]; }\n\t}\n\tfor (dp1.init(),dp1.f[0] = 0,i = 1; i <= m; ++i){\n\t\tdata.init();\n\t\tfor (j = 0; j < n[i]; ++j) if (!is[i][j]) data.Ins(w[i][j],c[i][j]); else len[i] += w[i][j];\n\t\tdata.work();\n\t\tif (!len[i]){ for (j = 0; j <= L; ++j) f.f[j] = data.query(s[i]+j); upd(dp1,f); continue; }\n\t\tG.push_back(i);\tans0[i].resize(L+1); for (j = 0; j <= L; ++j) ans0[i][j] = data.query(s[i]+j);\n\t\tans1[i].resize(len[i]+1); for (ans1[i][0] = ans0[i][0],j = 1; j <= len[i]; ++j) ans1[i][j] = data.query(s[i]-j);\n\t}\n\tfor (i = 0; i < 1<<cnt; ++i) solve(i);\n\tcout << (ans >= INF ? -1 : ans) << '\\n';\n\treturn 0;\n}\n```\n",
        "postTime": 1596798333,
        "uid": 52518,
        "name": "s_r_f",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6731 \u3010[WC2020] \u9009\u8bfe\u3011"
    }
]