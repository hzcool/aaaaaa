[
    {
        "content": "## \u9898\u610f\n\nN\u4e2a\u6570\uff0cM\u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u95ee[l,r]\u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u6b63\u5076\u6570\u6b21\u3002\n\n~~c\u7684\u4f5c\u7528\uff1f\uff1f\uff1f~~\n\n~~\u7eaa\u5ff5\u4e00\u4e0b\u81ea\u5df1YY\u51fa\u7684\u4e00\u9053\u5206\u5757\u6c34\u9898~~\n\n## \u65b9\u6cd5\n\n\u5176\u5b9e\u8fd9\u9898\u5c31\u662f\u5728\u9884\u5904\u7406\u65f6\u96be\u4f4f\u6211\u4e86\uff0c\u5982\u4f55\u4fdd\u8bc1$O(N\\sqrt{N})$\u5185\u9884\u5904\u7406\u5b8c\uff1f\n\n$cnt[i][j]$\u8868\u793a\u7b2ci\u5757\u5f00\u59cb\u5230\u7ed3\u5c3e\uff0cj\u7684\u51fa\u73b0\u6b21\u6570\uff1b\n\n$f[i][j]$\u8868\u793ai\u5757\u5f00\u5934\u5230j\u5757\u672b\u5c3e\u7684\u7b54\u6848\uff1b\n\n\n```\n\tfor (ri i = 1; i <= bl[n]; ++i) {\n\t\tint t = 0;\n\t\tfor (ri j = l[i]; j <= n; ++j) {\n\t\t\tcnt[i][a[j]]++;\n\t\t\tif ((cnt[i][a[j]] & 1) && (cnt[i][a[j]] > 1)) t--;\n\t\t\telse if ((cnt[i][a[j]] & 1) == 0) t++;\n\t\t\tif (bl[j] != bl[j + 1]) {\n\t\t\t\tf[i][bl[j]] = t;\n\t\t\t}\n\t\t}\n\t}\n```\n\n\u91cd\u70b9\u5728\u4e8e\uff0c\u4e0d\u80fd\u5148\u5904\u7406\u597d\u6bcf\u4e2a\u5757\u7684\u7b54\u6848\uff0c\u7136\u540e\u518d\u679a\u4e3e\u5408\u5e76\u6c42\u51fa$f[i][j]$\uff0c\u4e0d\u7136\u590d\u6742\u5ea6\u7206\u70b8\uff0c\u5fc5\u987b\u4e00\u8fb9\u626b\u4e00\u8fb9\u6c42\uff1b\n\n\u7136\u540e\u7edf\u8ba1\u5c31\u5f88\u597d\u8bf4\u4e86\uff0c\u5206\u60c5\u51b5\u8ba8\u8bba\u5373\u53ef\uff1b\n\n\u6ce8\u610fans\u7684\u521d\u503c\u4e3af[bl[ql] + 1][bl[qr] - 1]\uff1b\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cmath>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<vector>\n#include<map>\n#include<set>\n#include<list>\n#include<queue>\n#include<stack>\n#include<bitset>\n#include<deque>\nusing namespace std;\n#define ll long long\n#define inf 0x3f3f3f3f\n#define ri register int\n#define il inline\n#define fi first\n#define se second\n#define mp make_pair\n#define pi pair<int,int>\n#define mem0(x) memset((x),0,sizeof (x))\n#define mem1(x) memset((x),0x3f,sizeof (x))\nil char gc() {\n\tstatic const int BS = 1 << 22;\n\tstatic unsigned char buf[BS], *st, *ed;\n\tif (st == ed) ed = buf + fread(st = buf, 1, BS, stdin);\n\treturn st == ed ? EOF : *st++;\n}\n#define gc getchar\ntemplate<class T>void in(T &x) {\n\tx = 0;\n\tbool f = 0;\n\tchar c = gc();\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = 1;\n\t\tc = gc();\n\t}\n\twhile ('0' <= c && c <= '9') {\n\t\tx = (x << 3) + (x << 1) + (c ^ 48);\n\t\tc = gc();\n\t}\n\tif (f) x = -x;\n}\n#undef gc\n#define pb push_back\n#define N 100010\n#define B 320\nint n, m;\nint a[N];\nint block, bl[N];\nint l[B];\nint f[B][B];\nint cnt[B][N];\nint st[N], top;\nint num[N];\n// bitset<N>h[B][B], tmp;\nsigned main() {\n#ifndef ONLINE_JUDGE\n\tfreopen(\"in.in\", \"r\", stdin);\n#endif\n\tint ans = 0, cc, ql, qr;\n\tin(n), in(cc), in(m);\n\tblock = sqrt(n);\n\tfor (ri i = 1; i <= n; ++i) {\n\t\tin(a[i]);\n\t\tbl[i] = (i - 1) / block + 1;\n\t\tif (bl[i] != bl[i - 1]) l[bl[i]] = i;\n\t}\n\tbl[n + 1] = bl[n] + 1;\n\tl[bl[n + 1]] = n + 1;\n\tfor (ri i = 1; i <= bl[n]; ++i) {\n\t\tint t = 0;\n\t\tfor (ri j = l[i]; j <= n; ++j) {\n\t\t\tcnt[i][a[j]]++;\n\t\t\tif ((cnt[i][a[j]] & 1) && (cnt[i][a[j]] > 1)) t--;\n\t\t\telse if ((cnt[i][a[j]] & 1) == 0) t++;\n\t\t\tif (bl[j] != bl[j + 1]) {\n\t\t\t\tf[i][bl[j]] = t;\n\t\t\t}\n\t\t}\n\t}\n\twhile (m--) {\n\t\tin(ql), in(qr);\n\t\tql = (ql + ans) % n + 1, qr = (qr + ans) % n + 1;\n\t\tif (ql > qr) swap(ql, qr);\n\t\tans = 0;\n\t\tif (bl[ql] == bl[qr]) {\n\t\t\tfor (ri i = ql; i <= qr; ++i) {\n\t\t\t\tnum[a[i]]++;\n\t\t\t\tst[++top] = a[i];\n\t\t\t}\n\t\t\twhile (top) {\n\t\t\t\tif (num[st[top]] != 0) {\n\t\t\t\t\tans += (num[st[top]] & 1) ^ 1;\n\t\t\t\t\tnum[st[top]] = 0;\n\t\t\t\t}\n\t\t\t\ttop--;\n\t\t\t}\n\t\t\tprintf(\"%d\\n\", ans);\n\t\t\tcontinue;\n\t\t}\n\t\tif (bl[ql] + 1 <= bl[qr] - 1) ans = f[bl[ql] + 1][bl[qr] - 1];\n\t\tfor (ri i = ql; i < l[bl[ql] + 1]; ++i) {\n\t\t\tnum[a[i]]++;\n\t\t\tst[++top] = a[i];\n\t\t}\n\t\tfor (ri i = l[bl[qr]]; i <= qr; ++i) {\n\t\t\tnum[a[i]]++;\n\t\t\tst[++top] = a[i];\n\t\t}\n\t\twhile (top) {\n\t\t\tint t = st[top];\n\t\t\tif (num[t] != 0) {\n\t\t\t\tif ((cnt[bl[ql] + 1][t] - cnt[bl[qr]][t] > 0) && ((cnt[bl[ql] + 1][t] - cnt[bl[qr]][t]) & 1) == 0 && (num[st[top]] & 1)) {\n\t\t\t\t\tans--;\n\t\t\t\t}\n\t\t\t\telse if (((cnt[bl[ql] + 1][t] - cnt[bl[qr]][t] > 0) && ((cnt[bl[ql] + 1][t] - cnt[bl[qr]][t]) & 1)) && (num[st[top]] & 1)) {\n\t\t\t\t\tans++;\n\t\t\t\t}\n\t\t\t\telse if ((cnt[bl[ql] + 1][t] - cnt[bl[qr]][t] == 0) && (num[st[top]] & 1) == 0) {\n\t\t\t\t\tans++;\n\t\t\t\t}\n\t\t\t\tnum[st[top]] = 0;\n\t\t\t}\n\t\t\ttop--;\n\t\t}\n\t\tprintf(\"%d\\n\", ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1533047791,
        "uid": 58302,
        "name": "i207M",
        "ccfLevel": 0,
        "title": "\u5206\u5757-\u4f5c\u8bd7-\u89e3\u9898\u62a5\u544a"
    },
    {
        "content": "\u5206\u5757\u5927\u66b4\u529b\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6$n\\sqrt{n}$\n\n\n\u7a7a\u95f4\u590d\u6742\u5ea6$n\\sqrt{n}$\n\n\n\u9884\u5904\u7406\u5757$i$\u5185\u989c\u8272$j$\u7684\u548c$sum[i][j]$\uff0c\u4ee5\u53ca\u7b2c$i$\u5757\u5230\u7b2c$j$\u5757\u7684\u7b54\u6848$ans[i][j]$\n\n\n\u6bcf\u6b21\u8be2\u95ee\u6574\u5757\u76f4\u63a5\u67e5\u8868\uff0c\u4e24\u8fb9$\\sqrt{n}$\u66b4\u529b\u7b97\n\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAX_N = 100010;\nconst int MAX_M = 330;\nint n, m, siz, Ans;\nint a[MAX_N], belong[MAX_N], cnt[MAX_N], sum[MAX_M][MAX_N], ans[MAX_M][MAX_M];\n#ifdef ONLINE_JUDGE\n#define getchar Getchar\nconst int Size = 1 << 16;\nchar buffer[Size], *hed, *tail;\ninline char Getchar()\n{\n    if (hed == tail)\n    {\n        int l = fread(buffer, 1, Size, stdin);\n        tail = (hed = buffer) + l;\n    }\n    if (hed == tail) return -1;\n    return *hed++;\n}\n#endif\nint read()\n{\n    int x = 0, f = 1; char ch = getchar();\n    while (!isdigit(ch)) { if (ch == '-') f = -1; ch = getchar(); }\n    while (isdigit(ch)) { x = x * 10 + ch - '0'; ch = getchar(); }\n    return x * f;\n}\nint query(int x, int y)\n{\n    x = (x + Ans) % n + 1, y = (y + Ans) % n + 1;\n    if (x > y) swap(x, y);\n    int l = belong[x], r = belong[y];\n    Ans = 0;\n    if (r <= l + 1)\n    {\n        for (int i = x; i <= y; ++i)\n        {\n            ++cnt[a[i]];\n            if (!(cnt[a[i]] & 1)) ++Ans;\n            else if (cnt[a[i]] > 2) --Ans;\n        }\n        for (int i = x; i <= y; ++i) --cnt[a[i]];\n        return Ans;\n    }\n    Ans = ans[l + 1][r - 1];\n    for (int i = x; i <= l * siz; ++i)\n    {\n        ++cnt[a[i]];\n        if (!((cnt[a[i]] + sum[r - 1][a[i]] - sum[l][a[i]]) & 1)) ++Ans;\n        else if (cnt[a[i]] + sum[r - 1][a[i]] - sum[l][a[i]] > 2) --Ans;\n    }\n    for (int i = (r - 1) * siz + 1; i <= y; ++i)\n    {\n        ++cnt[a[i]];\n        if (!((cnt[a[i]] + sum[r - 1][a[i]] - sum[l][a[i]]) & 1)) ++Ans;\n        else if (cnt[a[i]] + sum[r - 1][a[i]] - sum[l][a[i]] > 2) --Ans;\n    }\n    for (int i = x; i <= l * siz; ++i) --cnt[a[i]];\n    for (int i = (r - 1) * siz + 1; i <= y; ++i) --cnt[a[i]];\n    return Ans;\n}\nint main()\n{\n    n = read(), read(), m = read();\n    for (int i = 1; i <= n; ++i) a[i] = read();\n    siz = sqrt(n) + 1;\n    for (int i = 1; i <= n; ++i)\n    {\n        belong[i] = (i - 1) / siz + 1;\n        sum[belong[i]][a[i]]++;\n    }\n    for (int i = 1; i < MAX_N; ++i)\n        for (int j = 1; j <= belong[n]; ++j)\n            sum[j][i] += sum[j - 1][i];\n    for (int i = 1; i <= belong[n]; ++i)\n    {\n        int now = 0;\n        for (int j = (i - 1) * siz + 1; j <= n; ++j)\n        {\n            ++cnt[a[j]];\n            if (!(cnt[a[j]] & 1)) ++now;\n            else if (cnt[a[j]] > 2) --now;\n            ans[i][belong[j]] = now;\n        }\n        for (int j = (i - 1) * siz + 1; j <= n; ++j)\n            --cnt[a[j]];\n    }\n    while (m--)\n    {\n        int x = read(), y = read();\n        printf(\"%d\\n\", query(x, y));\n    }\n    return 0;\n}\n\n```",
        "postTime": 1516711086,
        "uid": 37070,
        "name": "Ameyax",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "### \u5206\u5757\n\n **\u9898\u610f**\uff1a\n \n \u7ed9\u5b9a\u6570\u5217\uff0c$m$\u6b21\u8be2\u95ee$[l_i,r_i]$\u4e2d\uff0c\u51fa\u73b0\u6b63\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n**\u601d\u8def**\uff1a\n\n\u60f3\u5230\u5206\u5757\u66b4\u529b\u3002\u9884\u5904\u7406\u51fa\uff1a\n\n**$cnt[i][j]$ \u4e3a\u524d$i$\u5757\u4e2d $j$\u51fa\u73b0\u7684\u6b21\u6570**\uff0c**$ans[i][j]$\u4e3a\u7b2c$i$\u5757\u5230\u7b2c$j$\u5757\u4e2d \u51fa\u73b0\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570**\n\n\u6211\u7684\u53d8\u91cf\uff1a\n\n- $l[i] $\u4e3a\u7b2c$i$\u5757\u7684\u5de6\u7aef\u70b9\uff0c$r[i]$\u4e3a\u7b2c$i$\u5757\u7684\u53f3\u7aef\u70b9\uff0c$pos[i]$\u4e3a$i$\u70b9\u6240\u5728\u7684\u5757\uff0c$len$\u4e3a\u5757\u7684\u957f\u5ea6\uff0c$num$\u4e3a\u5757\u7684\u4e2a\u6570\n- $cnt[i][j]$ \u4e3a\u524d$i$\u5757\u4e2d $j$\u51fa\u73b0\u7684\u6b21\u6570\uff0c$ans[i][j]$\u4e3a\u7b2c$i$\u5757\u5230\u7b2c$j$\u5757\u4e2d \u51fa\u73b0\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570\n- $t[i]$\u4e3a\u6876\uff0c\u6bcf\u6b21\u7528\u5b8c\u6e05\u96f6\n\n\u4ee3\u7801\u91cc\u6709\u8be6\u7ec6\u6ce8\u91ca\uff0c\uff08\u4e2a\u4eba\u89c9\u5f97\u5206\u5757\u9898\u7528\u8fd9\u79cd\u5199\u6cd5\u8f83\u5176\u4ed6\u9898\u89e3\u66f4\u597d\u5199\u4e14\u4e0d\u6613\u9519\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int amou=1e5+90,sqt=1e3+90;\nint l[amou],r[amou],pos[amou],len,num;\nint a[amou],n,m,c,las;\nint cnt[sqt][amou],ans[sqt][sqt];\nint t[amou];\n\nint query(int ll,int rr){\n\tint posl=pos[ll],posr=pos[rr];\n\tif(posl+1>=posr)//\u53ea\u67091\u4e2a\u5757\u6216\u80052\u4e2a\u5757\u90fd\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\n\t{\n\t\tint s=0;//\u7b54\u6848\uff0c\u5373\u51fa\u73b0\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570\n\t\tfor(int i=ll;i<=rr;i++)\n\t\t{\n\t\t\tt[a[i]]++;//\u6876\n\t\t\tif(!(t[a[i]]&1)) s++;//\u8bf4\u660e\u5728t[]\u5728+1\u4e4b\u524d\u662f\u5947\u6570\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u79cd\u65b0\u65b9\u6848\n\t\t\telse if(t[a[i]]>=3) s--;//\u8bf4\u660et[]\u5728+1\u4e4b\u524d\u662f\u5076\u6570\uff0c\u5e76\u4e14\u4e4b\u524d\u7684t[]>=2\uff0c\u6545s\u9700-1\n\t\t}\n\t\tfor(int i=ll;i<=rr;i++) t[a[i]]--;//\u7531\u4e8ememset\u8d85\u65f6\uff0c\u6240\u4ee5\u76f4\u63a5\u64a4\u9500\n\t\treturn s;\n\t}\n\telse\n\t{\n\t\tint s=ans[posl+1][posr-1];\n \t\tfor(int i=ll;i<=r[posl];i++)\n\t\t{\n\t\t\tt[a[i]]++;\n\t\t\tint temp=cnt[posr-1][a[i]]-cnt[posl][a[i]];//a[i]\u5728posl+1~posr-1\u8fd9\u51e0\u4e2a\u5757\u4e2d\u51fa\u73b0\u7684\u6b21\u6570 \n\t\t\tif(!((t[a[i]]+temp)&1))  s++;\n\t\t\telse if(t[a[i]]+temp>=3) s--;\n\t\t}\n\t\tfor(int i=l[posr];i<=rr;i++)\n\t\t{\n\t\t\tt[a[i]]++;\n\t\t\tint temp=cnt[posr-1][a[i]]-cnt[posl][a[i]];\n\t\t\tif(!((t[a[i]]+temp)&1))  s++;\n\t\t\telse if(t[a[i]]+temp>=3) s--;\n\t\t}\n\t\tfor(int i=ll;i<=r[posl];i++) t[a[i]]--;\n\t\tfor(int i=l[posr];i<=rr;i++) t[a[i]]--;\n\t\treturn s;\n\t}\n}\n\nint main(){\n\tscanf(\"%d%d%d\",&n,&c,&m);\n\tlen=sqrt(n);\n\tnum=ceil(n*1.0/len);\n\tfor(int i=1;i<=num;i++)\n\t{\n\t\tl[i]=(i-1)*len+1;\n\t\tr[i]=i*len;\n\t}\n\tr[num]=n;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&a[i]);\n\t\tpos[i]=(i-1)/len+1;\n\t\tcnt[pos[i]][a[i]]++;\n\t}\n\tfor(int i=1;i<=num;i++)\n\t\tfor(int j=0;j<=c;j++)\n\t\t\tcnt[i][j]+=cnt[i-1][j];//\u7d2f\u52a0\u524d\u7f00\u548c \n\tfor(int i=1;i<=num;i++)//\u56fa\u5b9a\u5757i\n\t{\n\t\tfor(int j=i;j<=num;j++)\u679a\u4e3e\u53f3\u7aef\u5757j\n\t\t{\n\t\t\tans[i][j]=ans[i][j-1];//\u4f5c\u4e3a\u521d\u59cb\u503c\n\t\t\tfor(int k=l[j];k<=r[j];k++)//\u679a\u4e3e\u5757j\u7684\u5de6\u53f3\u7aef\u70b9\n\t\t\t{\n\t\t\t\tt[a[k]]++;\n\t\t\t\tif(!(t[a[k]]&1)) ans[i][j]++;\n\t\t\t\telse if(t[a[k]]>=3) ans[i][j]--;\n\t\t\t}\n\t\t}\n\t\tmemset(t,0,sizeof t);//\u6876\u7528\u5b8c\u6e05\u96f6\n\t}\n\twhile(m--)\n\t{\n\t\tint l,r;\n\t\tscanf(\"%d%d\",&l,&r);\n\t\tint L=(l+las)%n+1,R=(r+las)%n+1;\n\t\tif(L>R) swap(L,R);\n\t\tint as=query(L,R);\n\t\tprintf(\"%d\\n\",as);\n\t\tlas=as;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1612183486,
        "uid": 280519,
        "name": "Yaha",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u8dd1\u5f97\u98de\u5feb\u7684\u505a\u6cd5\u3002\n\n\u8003\u8651\u4f7f\u7528 $\\text{bitset}$ \u7ef4\u62a4\u503c\u57df\u8fdb\u884c\u67e5\u8be2\uff0c\u52a0\u5165\u4e00\u4e2a\u6570\u5c31\u76f8\u5f53\u4e8e\u5c06\u67d0\u4e00\u4f4d $\\text{flip}$\u3002\n\n\u53d1\u73b0\u8fd9\u6837\u4e0d\u80fd\u5f88\u597d\u7684\u6c42\u51fa\u5076\u6570\u6570\u91cf\uff0c\u8003\u8651 \u5076\u6570\u6570\u91cf = \u603b\u6570\u91cf - \u5947\u6570\u6570\u91cf\uff0c\u540e\u4e24\u8005\u90fd\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 $\\text{count}$ \u6c42\u51fa\u3002\n\n\u5219\u6bcf\u4e00\u6b21\u8be2\u95ee\u53ef\u4ee5\u8f6c\u6362\u4e3a\uff1a\n\n- \u53d6\u51fa\u4e00\u6bb5\u533a\u95f4\u5185 $\\text{bitset}$ \u7684\u5e76\uff0c\u8ba1\u7b97 $1$ \u7684\u6570\u91cf\uff08\u533a\u95f4\u603b\u6570\u91cf\uff09\n- \u53d6\u51fa\u4e00\u6bb5\u533a\u95f4\u5185 $\\text{bitset}$ \u7684\u5f02\u6216\u548c\uff0c\u8ba1\u7b97 $1$ \u7684\u6570\u91cf\uff08\u533a\u95f4\u5947\u6570\u6570\u91cf\uff09\n\n\u66b4\u529b\u7ef4\u62a4 $n$ \u4e2a $\\text{bitset}$ \u7684\u8bdd\u7a7a\u95f4\u663e\u7136\u5403\u4e0d\u6d88\uff0c\u8003\u8651\u5206\u5757\uff0c\u4e00\u4e2a\u5757\u91cc\u9762\u7ef4\u62a4\u5757\u5185\u6240\u6709 $\\text{bitset}$ \u7684 \u5e76 / \u5f02\u6216\u548c\uff0c\u67e5\u8be2\u65f6\u5757\u5185\u76f4\u63a5\u7d2f\u52a0\uff0c\u5757\u5916\u66b4\u529b\u5c06\u6570\u63d2\u5165 $\\text{bitset}$ \u5185\u3002\n\n\u8fd9\u6837\u505a\u65f6\u95f4\u590d\u6742\u5ea6\u00a0$\\Theta(m \\times \\dfrac{n}{S} \\times \\dfrac{c}{w})$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\Theta(\\dfrac{n}{S} \\times \\dfrac{c}{8})$\uff0c$S$ \u4e3a\u5757\u957f\u3002\n\n\u53d1\u73b0\u7a7a\u95f4\u590d\u6742\u5ea6\u6ca1\u95ee\u9898\u4e86\uff0c\u4f46\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u7206\u70b8\u3002\n\n\u53d1\u73b0\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5728\u53e0\u52a0\u82e5\u5e72\u4e2a\u6574\u5757\u4e0a\uff0c\u7531\u4e8e\u6ca1\u6709\u4fee\u6539\uff0c\u53ef\u4ee5\u8003\u8651\u9884\u5904\u7406\u82e5\u5e72\u4e2a\u5757\u7684\u53e0\u52a0\u8d21\u732e\u3002\n\n**\u5f02\u6216\u548c**\u6ee1\u8db3**\u524d\u7f00\u548c**\u6027\u8d28\uff0c\u53ef\u4ee5 $\\Theta(\\dfrac{n}{S} \\times \\dfrac{c}{w})$ \u9884\u5904\u7406\u524d\u7f00\u548c\uff0c$\\Theta(1)$ \u67e5\u8be2\uff0c**\u6c42\u5e76**\u4e0d\u6ee1\u8db3\u524d\u7f00\u548c\u6027\u8d28\uff0c\u4f46\u5b83\u662f**\u53ef\u91cd\u590d\u8d21\u732e\u95ee\u9898**\uff0c\u53ef\u4ee5\u4f7f\u7528 $\\text{ST}$ \u8868 $\\Theta(\\dfrac{n}{S} \\log \\dfrac{n}{S} \\times \\dfrac{c}{w})$ \u9884\u5904\u7406\uff0c$\\Theta(1)$ \u67e5\u8be2\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(\\dfrac{n}{S} \\times \\dfrac{c}{w} +m \\times \\dfrac{c}{w} + \\dfrac{n}{S} \\log \\dfrac{n}{S} \\times \\dfrac{c}{w})$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\Theta(\\dfrac{n}{S} \\log \\dfrac{n}{S}\\times \\dfrac{c}{8})$\uff0c\u9009\u7528\u5408\u9002\u7684\u5757\u957f\u5373\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n\u4f60\u8bf4\u8fd8\u662f\u4e0d\u591f\u5feb\uff1f\u8fd8\u6709\u8fdb\u4e00\u6b65\u7684\u4f18\u5316\u3002\n\n\u8003\u8651\u5e8f\u5217\u5185\u4ec5\u51fa\u73b0\u4e00\u6b21\u7684\u6570\u4e0d\u53ef\u80fd\u5bf9\u7b54\u6848\u9020\u6210\u8d21\u732e\uff0c\u5c06\u8fd9\u4e00\u7c7b\u6570\u5ffd\u7565\u6389\u4e4b\u540e\u5bf9\u5e8f\u5217\u79bb\u6563\u5316\u518d\u8fdb\u884c\u5904\u7406\uff0c\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u7f29\u5c0f\u4e3a\u5148\u524d\u7684\u4e00\u534a\uff0c\u5b9e\u6d4b\u5728\u672c\u9898\u4e2d\u8dd1\u5230\u4e86[\u6700\u4f18\u89e3](https://www.luogu.com.cn/record/list?pid=P4135&orderBy=1&status=&page=1)\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define getchar() (_S == _T && (_T = (_S = _B) + fread(_B, 1, 1 << 15, stdin), _S == _T) ? EOF : *_S++)\nchar _B[1 << 15], *_S = _B, *_T = _B;\n\ntemplate <class T> inline void fr(register T &a, register bool f = 0, register char ch = getchar()) {\n    for (a = 0; ch < '0' || ch > '9'; ch = getchar()) ch == '-' ? f = 1 : 0;\n    for (; ch >= '0' && ch <= '9'; ch = getchar()) a = a * 10 + (ch - '0');\n    a = f ? -a : a;\n}\ntemplate <class T, class... Y> inline void fr(register T &t, register Y &... a) { fr(t), fr(a...); }\nint fr() { int a; return fr(a), a; }\n\nconst int N = 1e5, B = N >> 6, S = (1 << 16) - 1;\n\nint n, c, m, lstans, blo, btot, tn, tn6, cnt[N + 2], a[N + 2], t[N + 2], lg2[N + 2], id[N + 2], pos[N + 2];\nbool vis[N + 10];\n\nstruct Bitset {\n    unsigned long long A[782];\n    #define set(x) A[(x) >> 6] |= 1ull << ((x) & 63)\n    #define flip(x) A[(x) >> 6] ^= 1ull << ((x) & 63)\n} ansxor, ansor, f[2001], g[11][2001];\n\nstruct OI {\n    int RP, score;\n} NOIP2021, FJOI2022;\n\nsigned main() {\n    NOIP2021.RP++, NOIP2021.score++, FJOI2022.RP++, FJOI2022.score++;\n    register int i, j, k, l, r;\n    fr(n, c, m), blo = 50, btot = n / blo + 1;\n    for (i = 1; i <= n; i++) vis[i] = 1, fr(a[i]), cnt[a[i]]++, id[i] = i / blo + 1;\n    for (i = 1; i <= c; i++) if (cnt[i] > 1) tn++, t[tn] = i, pos[i] = tn;\n    tn6 = tn >> 6, lg2[0] = -1;\n    for (i = 1; i <= n; i++) {\n        if (cnt[a[i]] == 1) vis[i] = 0;\n        else a[i] = pos[a[i]], f[id[i]].flip(a[i]), g[0][id[i]].set(a[i]);\n    }\n    for (i = 1; i <= btot; i++) {\n        lg2[i] = lg2[i >> 1] + 1;\n        for (j = 0; j <= tn6; j++) f[i].A[j] ^= f[i - 1].A[j];\n    }\n    for (j = 1; j <= lg2[btot]; j++) {\n        register auto x = g[j], y = g[j - 1]; \n        for (i = 1; i + (1 << j) - 1 <= btot; i++) \n            for (k = 0; k <= tn6; k++) x[i].A[k] = y[i].A[k] | y[i + (1 << (j - 1))].A[k];\n    }\n    while(m--) {\n        for (i = 0; i <= tn6; i++) ansxor.A[i] = ansor.A[i] = 0;\n        fr(l, r), l = (l + lstans) % n + 1, r = (r + lstans) % n + 1, lstans = 0;\n        if (l > r) l ^= r ^= l ^= r;\n        if (id[l] == id[r]) { for (i = l; i <= r; i++) if (vis[i]) ansor.set(a[i]), ansxor.flip(a[i]); }\n        else {\n            for (i = l; i < id[l] * blo; i++) if (vis[i]) ansor.set(a[i]), ansxor.flip(a[i]);\n            for (i = (id[r] - 1) * blo; i <= r; i++) if (vis[i]) ansor.set(a[i]), ansxor.flip(a[i]);\n            if (id[l] + 1 < id[r]) {\n                register int t = lg2[id[r] - id[l] - 1];\n                register auto x = f[id[l]].A, y = f[id[r] - 1].A;\n                for (i = 0; i <= tn6; i++) ansxor.A[i] ^= x[i] ^ y[i];\n                x = g[t][id[l] + 1].A, y = g[t][id[r] - (1 << t)].A;\n                for (i = 0; i <= tn6; i++) ansor.A[i] |= x[i] | y[i];\n            }\n        }\n\t\tfor (i = 0; i <= tn6; i++) lstans += __builtin_popcountll(ansor.A[i]) - __builtin_popcountll(ansxor.A[i]);\n        printf(\"%d\\n\", lstans);\n    }\n    return 0;\n}\n```",
        "postTime": 1636983196,
        "uid": 128141,
        "name": "Aestas16",
        "ccfLevel": 7,
        "title": "\u300c\u9898\u89e3\u300d[LG4135] \u4f5c\u8bd7"
    },
    {
        "content": "# \u4f5c\u8bd7-\u9898\u89e3\n\n>   \u9898\u76ee\u94fe\u63a5\uff1a[\u6d1b\u8c37-P4135](https://www.luogu.com.cn/problem/P4135)\n\n**\u4e00\u53e5\u8bdd\u9898\u610f**\uff1a\u6c42 $[l,r]$ \u4e2d\u51fa\u73b0\u6b63\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570\uff0c\u5f3a\u5236\u5728\u7ebf\u3002\n\n## \u5206\u6790\n\n### $Part1$ \u9009\u62e9\u7b97\u6cd5&\u6570\u636e\u7ed3\u6784\n\n> \u5bf9\u4e8e $100 \\%$ \u7684\u6570\u636e\uff0c $1\\le n,c,m\\le 10^5$\n\n\u8fd9\u79cd\u6570\u636e\u8303\u56f4\u663e\u7136\u9700\u8981\u5355\u6b21\u8be2\u95ee\u7684\u590d\u6742\u5ea6\u8fbe\u5230 $\\sqrt n$ \u6216\u8005 $\\log n$ \uff0c\u53c8\u770b\u5230\u533a\u95f4\u67e5\u8be2\uff0c\u6211\u4eec\u4f1a\u60f3\u5230\u4ec0\u4e48\uff1f\n\n**\u5206\u5757\uff0c\u7ebf\u6bb5\u6811\uff0c\u6811\u72b6\u6570\u7ec4**\n\n\u6811\u72b6\u6570\u7ec4\u6269\u5c55\u6027\u592a\u5dee\u4e86\uff0c\u9996\u5148\u6392\u9664\u3002\n\n\u518d\u770b\u770b\u6211\u4eec\u8981\u7ef4\u62a4\u4ec0\u4e48\uff0c\u5bb9\u6613\u53d1\u73b0\uff0c\u7b54\u6848\u662f\u4e0d\u53ef\u4ee5\u76f4\u63a5\u53e0\u52a0\u7684\uff0c\u90a3\u4e48\u5728\u5408\u5e76\u4e24\u4e2a\u533a\u95f4\u7684\u7b54\u6848\u65f6\uff0c\u9700\u8981\u77e5\u9053\u533a\u95f4\u4e2d\u6570\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u8fd9\u6837\u624d\u80fd\u6c42\u51fa\u4e0e\u51fa\u73b0\u6b21\u6570\u6709\u5173\u7684\u533a\u95f4\u548c\u3002\u5982\u679c\u4f7f\u7528\u7ebf\u6bb5\u6811\uff0c\u5728\u6bcf\u4e00\u4e2a\u8282\u70b9\u5f00\u6876\u4f1a\u5bfc\u81f4`MLE`\uff08\u4e5f\u4f1a`TLE`\uff09\uff0c\u73b0\u5728\u5c31\u53ea\u80fd\u8003\u8651\u5206\u5757\u4e86\u3002\n\n### $Part2$ \u5b9e\u73b0\n\n##### \u5757\u7ef4\u62a4\u4ec0\u4e48\uff1f\n\n\u5757\u5185\u7684\u7b54\u6848\u5e94\u8be5\u9884\u5904\u7406\u5f97\u5230\uff0c\u907f\u514d\u91cd\u590d\u8ba1\u7b97\u3002 $Part1$ \u4e2d\u4e5f\u63d0\u5230\u4e86\uff0c\u8fd8\u5e94\u7ed9\u6bcf\u4e00\u4e2a\u6574\u4f53\uff08\u5373\u5757\uff09\u914d\u4e00\u4e2a\u6876\u3002\n\n\u4e0b\u9762\uff0c\u91cd\u70b9\u5173\u6ce8\u533a\u95f4\u7b54\u6848\u7684\u6c42\u89e3\u4e0e\u5408\u5e76\u3002\n\n\uff08\u6ce8\uff1a$a_i$ \u8868\u793a\u6574\u4e2a\u5e8f\u5217\u7684\u7b2c $i$ \u4e2a\u6570\uff0c $numi_x$ \u8868\u793a\u533a\u95f4 $i$ \u4e2d $x$ \u7684\u51fa\u73b0\u6b21\u6570\uff0c $ansi$ \u8868\u793a\u533a\u95f4 $i$ \u51fa\u73b0\u6b63\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570\uff0c $leni$ \u8868\u793a\u533a\u95f4 $i$ \u7684\u957f\u5ea6\uff09\n\n1. ##### \u6c42 $ansi$\n\n    \u904d\u5386\u533a\u95f4 $i$ \uff0c $numi_{a_{now}}$ \u52a0 $1$ \u3002\u5982\u679c $numi_{now}$ \u4e3a\u6b63\u5076\u6570\uff0c\u8bf4\u660e\u591a\u4e86\u4e00\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u6570 $ansi$ \u52a0 $1$ \u3002\u5982\u679c $numi_{now}$ \u4e3a\u6b63\u5947\u6570\u6570\u4e14\u4e0d\u7b49\u4e8e $1$\uff0c\u8bf4\u660e\u5c11\u4e86\u4e00\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u6570\uff0c $ansi$ \u51cf $1$ \u3002\n\n    \u5c0f\u4f8b\u5b50\uff1a\n\n    ```\n    a:   1  2  2  3  1  2  3  2  3\n    num1:1  1  1  1  2  2  2  2  2\n    num2:0  1  2  2  2  3  3  4  4\n    num3:0  0  0  1  1  1  2  2  3\n    ans: 0  0  1  1  2  1  2  3  2\n    ```\n\n    $ans$ \u7684\u53d8\u5316\u53ca\u539f\u56e0\uff1a $+1$ \uff08 $2$ \u7684\u4e2a\u6570\u53d8\u6210 $2$ \uff09 $+1$ \uff08 $1$ \u7684\u4e2a\u6570\u53d8\u6210 $2$ \uff09 $-1$ \uff08 $2$ \u7684\u4e2a\u6570\u53d8\u6210 $3$ \uff09 $+1$ \uff08 $3$ \u7684\u4e2a\u6570\u53d8\u6210 $2$ \uff09 $+1$ \uff08 $2$ \u7684\u4e2a\u6570\u53d8\u6210 $4$ \uff09 $-1$ \uff08 $3$ \u7684\u4e2a\u6570\u53d8\u6210 $3$ \uff09\n\n    \u590d\u6742\u5ea6\uff1a $O(leni)$\n\n2. ##### \u6c42 $ans(i+j)$\n   \n    \u53ef\u4ee5\u770b\u4f5c\u6b63\u5e38\u6c42\u533a\u95f4\u65f6\u5df2\u7ecf\u5904\u7406\u4e86\u4e00\u90e8\u5206\uff08 $i$ \uff09\uff0c\u5982\u6b64\u53ef\u4ee5 $i$ \u4e3a\u57fa\u7840\uff0c\u904d\u5386\u533a\u95f4 $j$ \uff0c\u548c\u4e0a\u4e00\u4e2a\u95ee\u9898\u540c\u6837\u589e\u51cf $ans$ \u3002\n    \n    \u590d\u6742\u5ea6\uff1a $O(lenj)$\n\n#### \u9884\u5904\u7406\n\n1. ##### \u5206\u5757\u57fa\u672c\u53d8\u91cf&\u6570\u7ec4\n\n    \u5757\u957f\u53d6 $\\sqrt n$ \u5373\u53ef\u3002\n\n2. ##### $num$ \u6570\u7ec4\n\n    \u66b4\u529b\u6c42\u3002\n\n    \u590d\u6742\u5ea6\uff1a $O(n)$\n\n    ```cpp\n    for(int j=ll[i];j<=rr[i];++j)++num[i][a[j]];\n    ```\n\n3. ##### $ans$ \u6570\u7ec4\n\n    \u7528\u4e0a\u6587\u63d0\u5230\u7684\u65b9\u6cd5\u6c42\u3002\n\n    \u590d\u6742\u5ea6\uff1a $O(n)$\n    \n    ```cpp\n    for(int j=ll[i];j<=rr[i];++j){\n        ++tong[a[j]];\n        if(tong[a[j]]%2==0){\n            ++ans[i];\n        }else if(tong[a[j]]!=1){\n            --ans[i];\n        }\n    }\n    ```\n\n### $Part3$ \u4f18\u5316\n\n> \u8fd9\u5206\u5757\u548c\u6ca1\u5206\u4e00\u6837\u554a\uff0c\u5408\u5e76\u6574\u5757\u8981 $\\sqrt{n}$ \u6b21 $\\sqrt{n}$ \uff0c\u4e0d\u5c31\u662f\u66b4\u529b\u7684\u590d\u6742\u5ea6\u5417\uff1f\t\u2014zsc985246\n\n\u7684\u786e\uff0c\u76ee\u524d\u8fd8\u5e76\u6ca1\u6709\u4f53\u73b0\u51fa\u5206\u5757\u7684\u6839\u53f7\u4f18\u52bf\uff0c\u96f6\u6563\u5757\u5904\u7406\u5df2\u7ecf\u6ca1\u95ee\u9898\u4e86\uff0c\u73b0\u5728\u7684\u76ee\u6807\u662f\u8ba9\u6574\u5757\u7684\u5408\u5e76\u590d\u6742\u5ea6\u8fbe\u5230 $O(\\sqrt{n})$ \u4ee5\u4e0b\u3002\n\n\u52a0\u901f\u7684\u65b9\u5f0f\u4ecd\u7136\u662f\u9884\u5904\u7406\uff0c\u91cd\u65b0\u5b9a\u4e49 $ans_{i,j}$ \u8868\u793a\u4ece\u7b2c $i$ \u4e2a\u5757\u5230\u7b2c $j$ \u4e2a\u5757\u7684\u533a\u95f4\u7b54\u6848\u3002\u4e3a\u4e86\u914d\u5408\u65b0\u7684 $ans$ \u6570\u7ec4\uff0c\u6211\u4eec\u4e5f\u5c06 $num$ \u524d\u7f00\u548c\uff0c\u4ee5\u4fbf\u8fc5\u901f\u5f97\u51fa\u591a\u4e2a\u5757\u8fde\u7ed3\u540e\u7684 $num$ \u3002\n\n\u663e\u7136 $ans_{i,i\\to j}$ \u7684\u503c\u53ef\u4ee5\u7ebf\u6027\u6c42\u51fa\uff0c\u8f7b\u677e\u63a8\u5f97 $ans_{i,j}=ans_{(i,j-1)+j}$ \u3002\n\n```cpp\nfor(int i=1;i<=nb;++i){\n    for(int j=i;j<=nb;++j){\n        ans[i][j]=ans[i][j-1];\n        for(int k=ll[j];k<=rr[j];++k){\n            ++tong[a[k]];\n            if(tong[a[k]]%2==0){\n                ++ans[i][j];\n            }else if(tong[a[k]]!=1){\n                --ans[i][j];\n            }\n        }\n    }\n    for(int j=0;j<=c;++j)tong[j]=0;\n}\n```\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ninline int read_int(){//\u5feb\u8bfb\n\tint x=0;char c=getchar();\n\twhile(c<'0'||c>'9')c=getchar();\n\twhile(c>='0'&&c<='9'){\n\t\tx=(x<<3)+(x<<1)+(c-'0');\n\t\tc=getchar();\n\t}\n\treturn x;\n}\n\nint a[100005];//\u539f\u5e8f\u5217\nint num[350][100005];//\u5757\u7684\u4e13\u7528\u6876\nint ans[350][350];//\u4ecei\u5230j\u7684\u7b54\u6848\nint n,m,c;//\u610f\u4e49\u5982\u9898\nint lb,nb;//\u5757\u957f\u4e0e\u5757\u4e2a\u6570\nint l,r;//\u610f\u4e49\u5982\u9898\nint ll[350],rr[350],mm[100005];//\u5757\u7684\u5de6\u7aef\u70b9\u3001\u53f3\u7aef\u70b9\u53ca\u5355\u70b9\u6240\u5728\u5757\ninline int number(int l,int r,int x){//\u5757l\u5230\u5757r\u4e2dx\u7684\u4e2a\u6570\n\treturn num[r][x]-num[l-1][x];\n}\nint A;//\u7b54\u6848\nint tong[100005];//\u4e34\u65f6\u6876\nvoid solve(){\n\tA=0;\n\tint lb=mm[l],rb=mm[r];\n\tif(rb-lb<=1){//\u6ca1\u6709\u6574\u5757\uff0c\u76f4\u63a5\u66b4\u529b\n\t\tfor(int i=l;i<=r;++i){\n\t\t\t++tong[a[i]];\n\t\t\tif(tong[a[i]]%2==0){\n\t\t\t\t++A;\n\t\t\t}else if(tong[a[i]]!=1){\n\t\t\t\t--A;\n\t\t\t}\n\t\t}\n        //\u4e34\u65f6\u6876\u8fd8\u539f\n\t\tfor(int i=l;i<=r;++i){\n\t\t\t--tong[a[i]];\n\t\t}\n\t}else{//\u4e00\u822c\u60c5\u51b5\n\t\tA=ans[lb+1][rb-1];//\u6574\u5757\u7684\u7b54\u6848\n        //\u5de6\u4fa7\u96f6\u6563\u5757\u66b4\u529b\n\t\tfor(int i=l;i<=rr[lb];++i){\n\t\t\t++tong[a[i]];\n\t\t\tif((tong[a[i]]+number(lb+1,rb-1,a[i]))%2==0){\n\t\t\t\t++A;\n\t\t\t}else if(tong[a[i]]+number(lb+1,rb-1,a[i])!=1){\n\t\t\t\t--A;\n\t\t\t}\n\t\t}\n        //\u53f3\u4fa7\u96f6\u6563\u5757\u66b4\u529b\n\t\tfor(int i=ll[rb];i<=r;++i){\n\t\t\t++tong[a[i]];\n\t\t\tif((tong[a[i]]+number(lb+1,rb-1,a[i]))%2==0){\n\t\t\t\t++A;\n\t\t\t}else if(tong[a[i]]+number(lb+1,rb-1,a[i])!=1){\n\t\t\t\t--A;\n\t\t\t}\n\t\t}\n        //\u4e34\u65f6\u6876\u8fd8\u539f\n\t\tfor(int i=l;i<=rr[lb];++i){\n\t\t\t--tong[a[i]];\n\t\t}\n\t\tfor(int i=ll[rb];i<=r;++i){\n\t\t\t--tong[a[i]];\n\t\t}\n\t}\n}\n\nint main(){\n\tn=read_int();c=read_int();m=read_int();\n\tlb=sqrt(n);nb=n/lb;if(lb*nb<n)++nb;//\u5757\u957f\u4e0e\u5757\u4e2a\u6570\n    //\u9884\u5904\u7406\n\tfor(int i=1;i<=nb;++i){//\u5757\u7aef\u70b9\u9884\u5904\u7406\n\t\tll[i]=(i-1)*lb+1;\n\t\trr[i]=(i<nb)?i*lb:n;\n\t}\n\tfor(int i=1;i<=nb;++i){\n\t\tfor(int j=ll[i];j<=rr[i];++j){\n\t\t\ta[j]=read_int();\n\t\t\tmm[j]=i;//\u70b9\u6240\u5728\u5757\u9884\u5904\u7406\n\t\t\t++num[i][a[j]];//\u6876\u9884\u5904\u7406\n\t\t}\n\t\tfor(int j=0;j<=c;++j){//\u524d\u7f00\u548c\n\t\t\tnum[i][j]+=num[i-1][j];\n\t\t}\n\t}\n\tfor(int i=1;i<=nb;++i){//\u6574\u5757\u7b54\u6848\u9884\u5904\u7406\n\t\tfor(int j=i;j<=nb;++j){\n\t\t\tans[i][j]=ans[i][j-1];\n\t\t\tfor(int k=ll[j];k<=rr[j];++k){\n\t\t\t\t++tong[a[k]];\n\t\t\t\tif(tong[a[k]]%2==0){\n\t\t\t\t\t++ans[i][j];\n\t\t\t\t}else if(tong[a[k]]!=1){\n\t\t\t\t\t--ans[i][j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n        //\u4e34\u65f6\u6876\u8fd8\u539f\n\t\tfor(int j=0;j<=c;++j)tong[j]=0;\n\t}\n\t\n    //\u89e3\u51b3\n\twhile(~--m){\n\t\tl=read_int();r=read_int();\n\t\tl=(l+A)%n+1;r=(r+A)%n+1;\n\t\tif(l>r)swap(l,r);//\u89e3\u5bc6\n\t\tsolve();\n\t\tprintf(\"%d\\n\",A);\n\t}\n\t\n\treturn 0;\n}\n```\n\n## \u603b\u7ed3\n\n\u6b64\u9898\u6709\u5f88\u591a\u6570\u636e\u90fd\u9700\u8981\u901a\u8fc7\u9884\u5904\u7406\u6216\u4fe1\u606f\u590d\u7528\u8ba1\u7b97\uff0c\u8981\u719f\u7ec3\u638c\u63e1\u5e38\u89c1\u7684\u4f18\u5316\u65b9\u6cd5\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u91cd\u590d\u7684\u8fd0\u7b97\u3002\n\n",
        "postTime": 1648043456,
        "uid": 492662,
        "name": "Endt_or_endt",
        "ccfLevel": 5,
        "title": "\u4f5c\u8bd7-\u9898\u89e3"
    },
    {
        "content": "\u5148\u653e\u4e00\u4e9b\u505a\u6cd5\n\n### \u65f6\u95f4 $O(n^2)$ \uff0c\u7a7a\u95f4 $O(\\frac{n^2}{w})$ \u505a\u6cd5\uff0c\u4e0d\u77e5\u9053\u600e\u4e48\u8fc7\u53bb\u7684\n\n[\u7b11\u6b7b\uff0c\u6839\u672c\u4e0d\u4f1abitset](https://www.luogu.com.cn/discuss/show/328696)\n### \u65f6\u95f4 $O(n^{\\frac 5 3})/O(n\\sqrt{n\\log n})$ \uff0c\u7a7a\u95f4 $O(n)$ \u505a\u6cd5\n\n\u53c2\u8003 [\u84b2\u516c\u82f1](https://www.luogu.com.cn/problem/P4168)\n\n\n### \u65f6\u95f4 $O(n^{1.5})$ \uff0c\u7a7a\u95f4 $O(n^{1.5})$ \u505a\u6cd5\n\n\u5f00\u4e00\u4e2a $o_{1-\\sqrt n,1-c} $ \u7684\u6570\u7ec4\uff0c $o_{i,j}$ \u8868\u793a\u524d $i$ \u5757\uff0c $j$ \u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u8fd9\u6837\u5c31\u80fd\u5feb\u901f\u5f97\u5230\u5757\u4e0e\u5757\u4e4b\u95f4 $j$ \u51fa\u73b0\u4e86\u51e0\u6b21\n\n\u5f00\u4e00\u4e2a $s_{1-\\sqrt n,1-\\sqrt n}$ \u7684\u6570\u7ec4\uff0c $s_{i,j}$ \u8868\u793a\u7b2c $i$ \u5757\u5230\u7b2c $j$ \u5757\u7684\u7b54\u6848\u3002\n\n\u4e0a\u9762\u4e24\u4e2a\u663e\u7136\u90fd\u53ef\u4ee5 $O(n\\sqrt n)$ \u9884\u5904\u7406\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee\uff0c\u628a\u6574\u5757\u7684\u63d0\u53d6\u51fa\u6765\uff0c\u518d\u5206\u522b\u7edf\u8ba1\u6563\u5757\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6570\uff0c\u51fa\u73b0\u6b21\u6570\u8bb0\u4e3a $x$ \uff0c\u8981\u5224\u65ad\u52a0\u4e0a $x$ \u4e4b\u540e\u7b54\u6848\u662f\u5426\u53d8\u5316\uff0c\u5219\u82e5 $x$ \u662f\u5947\u6570\uff0c\u7b54\u6848\u5fc5\u7136\u52a0\u4e00\uff0c\u5426\u5219 $x$ \u662f\u5076\u6570\uff0c\u975e $0$ \u65f6\u7b54\u6848\u51cf\u4e00\uff0c\u4e3a $0$ \u65f6\u4e0d\u53d8\n\n### \u65f6\u95f4 $O(n^{1.5})$ \uff0c\u7a7a\u95f4 $O(\\frac{n\\sqrt n}{w})$ \u505a\u6cd5\n\n\u8003\u8651\u4f18\u5316\u4e0a\u4e00\u4e2a\u7b97\u6cd5\uff0c\u89c2\u5bdf\u5230\u8fd9\u4e2a\u51fa\u73b0\u6b21\u6570\u7684\u8be2\u95ee\u53ea\u9700\u8003\u8651**\u5947\u5076**\u4e0e**\u662f\u5426\u5b58\u5728**\uff0c\u5947\u5076\u53ef\u4ee5\u4f7f\u7528bitset\u89e3\u51b3\uff0c\u63a5\u4e0b\u6765\u8981\u89e3\u51b3\u662f\u5426\u5b58\u5728\u7684\u95ee\u9898\n\n\u8003\u8651\u5230\u6563\u5757\u4e0e\u6574\u5757\u7d27\u5bc6\u76f8\u8fde\uff0c\u4ee5\u5de6\u8fb9\u6563\u5757\u4e3a\u4f8b\uff0c\u5148\u628a\u5de6\u8fb9\u6563\u5757\u4e2d\u6bcf\u4e2a\u6570\u6700\u53f3\u51fa\u73b0\u7684\u4f4d\u7f6e\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e00\u5f00\u59cb\u5bf9\u4e8e\u6574\u4e2a\u6570\u5217\u8bb0\u5f55\u6bcf\u4e2a\u6570\u4e0b\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\u90a3\u4e48\u5224\u65ad\u4e00\u4e0b\u8fd9\u4e2a\u6570\u5728\u6563\u5757\u4e2d\u6700\u53f3\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u662f\u5426\u5728\u5757\u5185\u5373\u53ef\uff0c\u53f3\u8fb9\u4e5f\u662f\u5982\u6b64\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define debug(x) cerr<<#x<<' '<<x<<endl\n/* --------------- fast io --------------- */ // begin\nnamespace Fread {\nconst int SIZE = 1 << 26;\nchar buf[SIZE], *S, *T;\ninline char getchar() {\n\tif (S == T) {\n\t\tT = (S = buf) + fread(buf, 1, SIZE, stdin);\n\t\tif (S == T) return '\\n';\n\t}\n\treturn *S++;\n}\n} // namespace Fread\nnamespace Fwrite {\nconst int SIZE = 1 << 26;\nchar buf[SIZE], *S = buf, *T = buf + SIZE;\ninline void flush() {\n\tfwrite(buf, 1, S - buf, stdout);\n\tS = buf;\n}\ninline void putchar(char c) {\n\t*S++ = c;\n\tif (S == T) flush();\n}\nstruct NTR {\n\t~ NTR() { flush(); }\n} ztr;\n} // namespace Fwrite\n#ifdef ONLINE_JUDGE\n\t#define getchar Fread :: getchar\n\t#define putchar Fwrite :: putchar\n#endif\nnamespace Fastio {\nstruct Reader {\n\ttemplate<typename T>\n\tReader& operator >> (T& x) {\n\t\tchar c = getchar();\n\t\tT f = 1;\n\t\twhile (c < '0' || c > '9') {\n\t\t\tif (c == '-') f = -1;\n\t\t\tc = getchar();\n\t\t}\n\t\tx = 0;\n\t\twhile (c >= '0' && c <= '9') {\n\t\t\tx = x * 10 + (c - '0');\n\t\t\tc = getchar();\n\t\t}\n\t\tx *= f;\n\t\treturn *this;\n\t}\n\tReader& operator >> (char& c) {\n\t\tc = getchar();\n\t\twhile (c == '\\n' || c == ' ') c = getchar();\n\t\treturn *this;\n\t}\n\tReader& operator >> (char* str) {\n\t\tint len = 0;\n\t\tchar c = getchar();\n\t\twhile (c == '\\n' || c == ' ') c = getchar();\n\t\twhile (c != '\\n' && c != ' ') {\n\t\t\tstr[len++] = c;\n\t\t\tc = getchar();\n\t\t}\n\t\tstr[len] = '\\0';\n\t\treturn *this;\n\t}\n\tReader(){}\n} cin;\nconst char endl = '\\n';\nstruct Writer {\n\ttemplate<typename T>\n\tWriter& operator << (T x) {\n\t\tif (x == 0) { putchar('0'); return *this; }\n\t\tif (x < 0) { putchar('-'); x = -x; }\n\t\tstatic int sta[45];\n\t\tint top = 0;\n\t\twhile (x) { sta[++top] = x % 10; x /= 10; }\n\t\twhile (top) { putchar(sta[top] + '0'); --top; }\n\t\treturn *this;\n\t}\n\tWriter& operator << (char c) {\n\t\tputchar(c);\n\t\treturn *this;\n\t}\n\tWriter& operator << (char* str) {\n\t\tint cur = 0;\n\t\twhile (str[cur]) putchar(str[cur++]);\n\t\treturn *this;\n\t}\n\tWriter& operator << (const char* str) {\n\t\tint cur = 0;\n\t\twhile (str[cur]) putchar(str[cur++]);\n\t\treturn *this;\n\t}\n\tWriter(){}\n} cout;\n} // namespace Fastio\n#define cin Fastio :: cin\n#define cout Fastio :: cout\n#define endl Fastio :: endl\n/* --------------- fast io --------------- */ // end\n\n#define maxn 100010\n#define B 400\nint n,c,m;\nint a[maxn];\nint blo,tot;\nint L[B],R[B];\nint pos[maxn];\nint s[B][B];\nbitset<maxn>o[B];\nint v[maxn];\nint pre[maxn],nxt[maxn];\nint app[maxn];\nint lft[maxn],rig[maxn];\nint l,r,lstans;\nbool check(int l,int r,int k){\n\tfor(int i=l;i<=r;i++)\n\tif(a[i]==k)return 1;\n\treturn 0;\n}\nsigned main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"testdata.in\",\"r\",stdin);\n\tfreopen(\"testdata.out\",\"w\",stdout);\n#endif\n\tcin>>n>>c>>m;\n\tfor(int i=1;i<=n;i++)cin>>a[i];\n\tfor(int i=1;i<=n;i++)pre[i]=app[a[i]],app[a[i]]=i;\n\tmemset(app,0,sizeof app);\n\tfor(int i=n;i;i--)nxt[i]=app[a[i]],app[a[i]]=i;\n\tfor(int i=1;i<=n;i++)if(nxt[i]==0)nxt[i]=n+1;\n\tmemset(app,0,sizeof app);\n\tblo=sqrt(n);\n\ttot=n/blo;\n\tif(n%blo)tot++;\n\tfor(int i=1;i<=tot;i++){\n\t\tL[i]=R[i-1]+1;\n\t\tR[i]=L[i]+blo-1;\n\t}R[tot]=n;\n\tfor(int i=1;i<=tot;i++)\n\tfor(int j=L[i];j<=R[i];j++)\n\tpos[j]=i;\n\tfor(int i=1;i<=tot;i++){\n\t\tfor(int j=0;j<=c;j++)o[i][j]=o[i-1][j];\n\t\tfor(int j=L[i];j<=R[i];j++)o[i].flip(a[j]);\n\t}\n\tfor(int i=1;i<=tot;i++){\n\t\tfor(int j=i;j<=tot;j++){\n\t\t\ts[i][j]=s[i][j-1];\n\t\t\tfor(int k=L[j];k<=R[j];k++){\n\t\t\t\tif(v[a[k]]&1)s[i][j]++;\n\t\t\t\telse if(v[a[k]]>1)s[i][j]--;\n\t\t\t\tv[a[k]]++;\n\t\t\t}\n\t\t}\n\t\tmemset(v,0,sizeof v);\n\t}\n//\tfor(int i=1;i<=tot;i++,cout<<endl)\n//\tfor(int j=1;j<=tot;j++,cout<<' ')cout<<s[i][j];\n\twhile(m--){\n\t\tcin>>l>>r;\n\t\tl=(l+lstans)%n+1,r=(r+lstans)%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tint p=pos[l],q=pos[r];\n\t\tif(p+1>=q){\n\t\t\tlstans=0;\n\t\t\tfor(int i=l;i<=r;i++){\n\t\t\t\tif(v[a[i]]&1)lstans++;\n\t\t\t\telse if(v[a[i]]>1)lstans--;\n\t\t\t\tv[a[i]]++;\n\t\t\t}\n\t\t\tfor(int i=l;i<=r;i++)v[a[i]]=0;\n\t\t\tcout<<lstans<<endl;\n\t\t\tcontinue;\n\t\t}\n\t\tfor(int i=l;i<=R[p];i++)app[a[i]]=i;\n\t\tfor(int i=l;i<=R[p];i++)rig[i]=app[a[i]];\n\t\tfor(int i=l;i<=R[p];i++)app[a[i]]=0;\n\t\tfor(int i=r;i>=L[q];i--)app[a[i]]=i;\n\t\tfor(int i=r;i>=L[q];i--)lft[i]=app[a[i]];\n\t\tfor(int i=r;i>=L[q];i--)app[a[i]]=0;\n\t\tlstans=s[p+1][q-1];\n\t\tfor(int i=l;i<=R[p];i++){\n\t\t\tint gg=(v[a[i]]&1)^o[q-1][a[i]]^o[p][a[i]];\n\t\t\tif(gg)lstans++;\n\t\t\telse if(nxt[rig[i]]<=R[q-1]||v[a[i]])lstans--;\n\t\t//\tassert((nxt[rig[i]]<=R[q-1])==check(L[p+1],R[q-1],a[i]));\n\t\t\tv[a[i]]++;\n\t\t}\n\t\tfor(int i=L[q];i<=r;i++){\n\t\t\tint gg=(v[a[i]]&1)^o[q-1][a[i]]^o[p][a[i]];\n\t\t\tif(gg)lstans++;\n\t\t\telse if(pre[lft[i]]>=L[p+1]||v[a[i]])lstans--;\n\t\t//\tassert((pre[lft[i]]>=L[p+1])==check(L[p+1],R[q-1],a[i]));\n\t\t\tv[a[i]]++;\n\t\t}\n\t\tfor(int i=l;i<=R[p];i++)v[a[i]]=0;\n\t\tfor(int i=L[q];i<=r;i++)v[a[i]]=0;\n\t\tcout<<lstans<<endl;\n\t}\n#ifndef ONLINE_JUDGE\n\tcerr<<endl<<(double)clock()/CLOCKS_PER_SEC;\n#endif\n}\n\n```\n\n\u611f\u8c22 $Cmd\\ dalao$ \u7684\u6307\u5bfc\uff01\uff01\n\n\u5f69\u86cb\uff1a[\u8270\u8f9b\u5386\u7a0b](https://www.luogu.com.cn/paste/zomq6b1t)",
        "postTime": 1626354435,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P4135 \u4f5c\u8bd7 \u52a0\u5f3a\u7248"
    },
    {
        "content": "## [Link](https://www.luogu.com.cn/problem/P4135)\n\n\u4e00\u773c\u5206\u5757\u3002\n\n\u5148\u5206\u5757\u3002\u9884\u5904\u7406\u51fa\u7b2c $i$ \u5757\u5230\u7b2c $j$ \u5757\u7684\u7b54\u6848\u3002\u7528\u4e00\u4e2a\u6876\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u6570\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u82e5\u53d8\u6210\u6b63\u5076\u6570\u7b54\u6848\u5c31\u52a0\u4e00\uff0c\u5426\u5219\u5c31\u51cf\u4e00\u3002\n\n\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u6574\u5757\u7684\u7b54\u6848\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u5f00\u4e00\u4e2a\u6876\uff0c\u7528\u6765\u5b58\u6563\u5757\u4e2d\u6bcf\u4e2a\u503c\u7684\u4e2a\u6570\u3002\n\n\u5982\u679c\u5f53\u524d\u7684\u4e2a\u6570\u52a0\u4e0a\u6574\u5757\u4e2d\u7684\u4e2a\u6570\u4e3a\u6b63\u5076\u6570\uff0c\u7b54\u6848\u5c31\u52a0\u4e00\uff0c\u5426\u5219\u5c31\u51cf\u4e00\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u8981\u9884\u5904\u7406\u51fa\u7b2c $i$ \u5757\u5230\u7b2c $j$ \u5757\u4e2d\u503c\u4e3a $k$ \u7684\u6570\u7684\u4e2a\u6570 $sum_{i,j}$\u3002\u4f46\u662f\u8fd9\u6837\u7a7a\u95f4\u590d\u6742\u5ea6\u4f1a\u7206\u70b8\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8bbe $sum_{i,j}$ \u8868\u793a\u524d $i$ \u5757\u4e2d\u503c\u4e3a $j$ \u7684\u6570\u7684\u4e2a\u6570\uff0c\u7136\u540e\u67e5\u8be2\u7684\u65f6\u5019\u5dee\u5206\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read()\n{\n\tint s=0,f=1,c=getchar();\n\tfor(;!isdigit(c);c=getchar())\n\t\tif(c=='-')f=-1;\n\tfor(;isdigit(c);c=getchar())\n\t\ts=s*10+c-'0';\n\treturn s*f;\n}\nint n,c,m,last;\nint color[100005];\nint block,len;\nint L[340],R[340],pos[100005];\nint sum[340][100005],ans[340][340],t[100005];\nvoid input()\n{\n\tn=read(),c=read(),m=read();\n\tlen=sqrt(n),block=n/len;\n\tfor(int i=1;i<=n;i++)\n\t\tcolor[i]=read();\n\tfor(int i=1;i<=block;i++)\n\t\tL[i]=R[i-1]+1,R[i]=len*i;\n\tR[block]=n;\n\tfor(int i=1;i<=block;i++)\n\t\tfor(int j=L[i];j<=R[i];j++)\n\t\t\tpos[j]=i,sum[i][color[j]]++;\n\tfor(int i=1;i<=block;i++)\n\t\tfor(int j=0;j<=c;j++)\n\t\t\tsum[i][j]+=sum[i-1][j];\n\tfor(int l=1;l<=block;l++)\n\t{\n\t\tfor(int r=l;r<=block;r++)\n\t\t{\n\t\t\tans[l][r]=ans[l][r-1];\n\t\t\tfor(int i=L[r];i<=R[r];i++)\n\t\t\t{\n\t\t\t\tt[color[i]]++;\n\t\t\t\tif(!(t[color[i]]&1))ans[l][r]++;\n\t\t\t\telse if(t[color[i]]!=1)ans[l][r]--;\n\t\t\t}\n\t\t}\n\t\tmemset(t,0,sizeof(t));\n\t}\t\n}\nint query(int l,int r)\n{\n\tint p=pos[l],q=pos[r];\n\tif(p==q)\n\t{\n\t\tint cnt=0;\n\t\tfor(int i=l;i<=r;i++)\n\t\t{\n\t\t\tt[color[i]]++;\n\t\t\tif(!(t[color[i]]&1))cnt++;\n\t\t\telse if(t[color[i]]!=1)cnt--;\n\t\t}\n\t\tmemset(t,0,sizeof(t));\n\t\treturn cnt;\n\t}\n\tint cnt=ans[p+1][q-1];\n\tfor(int i=l;i<=R[p];i++)\n\t{\n\t\tt[color[i]]++;\n\t\tint temp=sum[q-1][color[i]]-sum[p][color[i]];\n\t\tif(!((t[color[i]]+temp)&1))cnt++;\n\t\telse if(t[color[i]]+temp!=1)cnt--;\n\t}\n\tfor(int i=L[q];i<=r;i++)\n\t{\n\t\tt[color[i]]++;\n\t\tint temp=sum[q-1][color[i]]-sum[p][color[i]];\n\t\tif(!((t[color[i]]+temp)&1))cnt++;\n\t\telse if(t[color[i]]+temp!=1)cnt--;\n\t}\n\tfor(int i=l;i<=R[p];i++)\n\t\tt[color[i]]=0;\n\tfor(int i=L[q];i<=r;i++)\n\t\tt[color[i]]=0;\n\treturn cnt;\n}\nint main()\n{\n\tinput();\n\twhile(m--)\n\t{\n\t\tint l=read(),r=read();\n\t\tl=(l+last)%n+1,r=(r+last)%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tlast=query(l,r);\n\t\tprintf(\"%d\\n\",last);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1644404422,
        "uid": 306049,
        "name": "Utilokasteinn",
        "ccfLevel": 0,
        "title": "P4135 \u4f5c\u8bd7"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P4135)\n> \u9898\u610f\uff1a$n$ \u4e2a\u6570\uff0c\u6bcf\u4e2a\u6570\u90fd\u5728 $[1,c]$ \u4e2d\uff0c$m$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u95ee\u5728 $[l,r]$ \u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u5076\u6570\u6b21\u3002\u5f3a\u5236\u5728\u7ebf\u3002\n\n> $1 \\leq n,m,c \\leq 10^5$\n\n\u5982\u679c\u4e0d\u5f3a\u5236\u5728\u7ebf\u7684\u8bdd\u53ef\u4ee5\u60f3\u5230\u83ab\u961f\uff0c\u5173\u952e\u8fd9\u4e2a\u5f3a\u5236\u5728\u7ebf\u600e\u4e48\u5904\u7406\u3002\n\n\u5f88\u5bb9\u6613\u60f3\u5230\u5bf9\u539f\u6570\u5217\u8fdb\u884c\u6839\u53f7\u5206\u5757\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8868\u793a\uff0c\u5b9a\u4e49 $L_i$ \u4e3a\u7b2c $i$ \u5757\u7684\u5de6\u7aef\u70b9\uff0c$R_i$ \u4e3a\u7b2c $i$ \u5757\u7684\u53f3\u7aef\u70b9\u3002\n\n\u6211\u4eec\u8bb0 $t_{i,j}$ \u8868\u793a\u5728 $[L_i,n]$ \u4e2d $j$ \u8fd9\u4e2a\u6570\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c$f_{i,j}$ \u8868\u793a\u5728 $[L_i,R_j]$ \u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\u3002\n\n\u6211\u8fd8\u662f\u592a naive \u4e86\uff0c\u4e00\u770b\u5230\u8fd9\u4e2a\u201c\u533a\u95f4\u201d\u5c31\u60f3\u7740\u7528\u533a\u95f4 dp \u7684\u65b9\u5f0f\u8fdb\u884c\u8f6c\u79fb\uff0c\u590d\u6742\u5ea6\u7206\u70b8\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6c42\u51fa $t$ \u7684\u540c\u65f6\u6c42\u51fa $f$\u3002\u679a\u4e3e\u8d77\u70b9\u5757 $i$\uff0c\u5b9a\u4e49 $num$ \u8bb0\u5f55\u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u4e86\u5076\u6570\u6b21\uff0c\u4e00\u8fb9\u5f80\u540e\u626b\u4e00\u904d\u66f4\u65b0 $num$\u3002\n\n\u67e5\u8be2\u533a\u95f4 $[l,r]$ \u7684\u65f6\u5019\uff0c\u5982\u679c $l,r$ \u5728\u540c\u4e00\u5757\u4e2d\uff0c\u76f4\u63a5\u66b4\u529b\u67e5\u627e\u5c31\u884c\u4e86\u3002\n\n\u5982\u679c $[l,r]$ \u4e0d\u5728\u540c\u4e00\u5757\u4e2d\uff0c\u8bb0 $l'$ \u4e3a $l$ \u6240\u5728\u7684\u5757\uff0c$r'$ \u4e3a $r$ \u6240\u5728\u7684\u5757\uff0c\u90a3\u4e48\u6211\u4eec\u5148\u5c06 $ans$ \u8d4b\u503c\u4e3a $f_{l'+1,r'-1}$\uff0c\u7136\u540e\u5bf9\u4e8e $[l,R_{l'}] \\cup [L_{r'},r]$ \u4e2d\u6240\u6709**\u4e0d\u540c**\u7684\u6570 $x$\uff0c\u5206\u51fa\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\uff1a\n\n1. $x$ \u5728 $[L_{l'+1},R_{r'-1}]$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u4e0d\u4e3a\u96f6\u7684\u5076\u6570\uff0c\u4f46\u662f\u5728 $[l,r]$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\uff0c\u5219\u8868\u660e\u5b83\u88ab\u7b97\u5728\u4e86 $ans$ \u4e2d\uff0c\u4f46\u5b9e\u9645\u4e0d\u7b26\u5408\u6761\u4ef6\uff0c\u8ba9 $ans$ \u51cf\u4e00\n2. $x$ \u5728 $[L_{l'+1},R_{r'-1}]$ \u4e2d\u51fa\u73b0\u6b21\u6570\u5947\u6570\uff0c\u4f46\u662f\u5728 $[l,r]$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\uff0c\u5219\u8868\u660e\u5b83\u6ca1\u6709\u88ab\u7b97\u5728\u4e86 $ans$ \u4e2d\uff0c\u4f46\u5b9e\u9645\u7b26\u5408\u6761\u4ef6\uff0c\u8ba9 $ans$ \u52a0\u4e00\n3. $x$ \u5728 $[L_{l'+1},R_{r'-1}]$ \u4e2d\u6ca1\u51fa\u73b0\u8fc7\uff0c\u4f46\u662f\u5728 $[l,r]$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\uff0c\u8ba9 $ans$ \u52a0 $1$\u3002\n\n```cpp\n//Coded by tzc_wk\n/*\n\u6570\u636e\u4e0d\u6e05\u7a7a\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u591a\u6d4b\u4e0d\u8bfb\u5b8c\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8fb9\u754c\u4e0d\u7279\u5224\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d2a\u5fc3\u4e0d\u8bc1\u660e\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\nD P \u987a\u5e8f\u9519\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u5927\u5c0f\u5c11\u7b49\u53f7\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u53d8\u91cf\u4e0d\u7edf\u4e00\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8d8a\u754c\u4e0d\u5224\u65ad\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u8c03\u8bd5\u4e0d\u6ce8\u91ca\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n\u6ea2\u51fa\u4e0d l l\uff0c\u7206\u96f6\u4e24\u884c\u6cea\u3002\n*/\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi\t\t\tfirst\n#define se\t\t\tsecond\n#define fz(i,a,b)\tfor(int i=a;i<=b;i++)\n#define fd(i,a,b)\tfor(int i=a;i>=b;i--)\n#define foreach(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define all(a)\t\ta.begin(),a.end()\n#define giveup(...) return printf(__VA_ARGS__),0;\n#define fill0(a)\tmemset(a,0,sizeof(a))\n#define fill1(a)\tmemset(a,-1,sizeof(a))\n#define fillbig(a)\tmemset(a,0x3f,sizeof(a))\n#define fillsmall(a) memset(a,0xcf,sizeof(a))\n#define mask(a)\t\t(1ll<<(a))\n#define maskx(a,x)\t((a)<<(x))\n#define _bit(a,x)\t(((a)>>(x))&1)\n#define _sz(a)\t\t((int)(a).size())\n#define filei(a)\tfreopen(a,\"r\",stdin);\n#define fileo(a)\tfreopen(a,\"w\",stdout);\n#define fileio(a) \tfreopen(a\".in\",\"r\",stdin);freopen(a\".out\",\"w\",stdout)\n#define eprintf(...) fprintf(stderr,__VA_ARGS__)\n#define put(x)\t\tputchar(x)\n#define eoln        put('\\n')\n#define space\t\tput(' ')\n#define y1\t\t\ty_chenxiaoyan_1\n#define y0\t\t\ty_chenxiaoyan_0\ntypedef pair<int,int> pii;\ninline int read(){\n\tint x=0,neg=1;char c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-')\tneg=-1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c))\tx=x*10+c-'0',c=getchar();\n\treturn x*neg;\n}\ninline void print(int x){\n\tif(x<0){\n\t\tputchar('-');\n\t\tprint(abs(x));\n\t\treturn;\n\t}\n\tif(x<=9)\tputchar(x+'0');\n\telse{\n\t\tprint(x/10);\n\t\tputchar(x%10+'0');\n\t}\n}\ninline int qpow(int x,int e,int _MOD){\n\tint ans=1;\n\twhile(e){\n\t\tif(e&1)\tans=ans*x%_MOD;\n\t\tx=x*x%_MOD;\n\t\te>>=1;\n\t}\n\treturn ans;\n}\nconst int BLOCK_SZ=320;\nint n=read(),c=read(),m=read(),a[100005],cnt[322][100005],sum[322][322];\nint blk,L[322],R[322],bel[100005];\nint vis[100005];\ninline void prework(){\n\tblk=(n-1)/BLOCK_SZ+1;\n\tfz(i,1,blk){\n\t\tL[i]=(i-1)*BLOCK_SZ+1;\n\t\tR[i]=min(i*BLOCK_SZ,n);\n\t\tfz(j,L[i],R[i]){\n\t\t\tbel[j]=i;\n\t\t}\n\t}\n\tfz(i,1,blk){\n\t\tint num=0;\n\t\tfill0(vis);\n\t\tfz(j,L[i],n){\n\t\t\tcnt[i][a[j]]++;\n\t\t\tif(!vis[a[j]])\tvis[a[j]]=1,num++;\n\t\t\tif(cnt[i][a[j]]&1)\tnum--;\n\t\t\telse\t\t\t\tnum++;\n\t\t\tif(bel[j]!=bel[j+1])\tsum[i][bel[j]]=num;\n\t\t}\n\t}\n}\nint cntt[100005];\ninline int query(int l,int r){\n\tif(bel[l]==bel[r]){\n\t\tint ans=0;\n\t\tfz(i,l,r)\tcntt[a[i]]++;\n\t\tfz(i,l,r){\n\t\t\tif(!vis[a[i]]){\n\t\t\t\tif(cntt[a[i]]&1^1)\tans++;\n\t\t\t\tvis[a[i]]=1;\n\t\t\t}\n\t\t}\n\t\tfz(i,l,r)\tcntt[a[i]]--,vis[a[i]]=0;\n\t\treturn ans;\n\t}\n\telse{\n\t\tint l0=bel[l],r0=bel[r];\n\t\tfz(i,l,R[l0])\tcntt[a[i]]++;\n\t\tfz(i,L[r0],r)\tcntt[a[i]]++;\n\t\tint ans=sum[l0+1][r0-1];\n\t\tfz(i,l,R[l0]){\n\t\t\tif(!vis[a[i]]){\n\t\t\t\tif((cnt[l0+1][a[i]]-cnt[r0][a[i]])>0){\n\t\t\t\t\tif(((cntt[a[i]]+cnt[l0+1][a[i]]-cnt[r0][a[i]])&1^1)&&(cnt[l0+1][a[i]]-cnt[r0][a[i]])&1)\n\t\t\t\t\t\tans++;\n\t\t\t\t\tif(((cntt[a[i]]+cnt[l0+1][a[i]]-cnt[r0][a[i]])&1)&&(cnt[l0+1][a[i]]-cnt[r0][a[i]])&1^1)\n\t\t\t\t\t\tans--;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif((cntt[a[i]]&1)^1)\tans++;\n\t\t\t\t}\n\t\t\t\tvis[a[i]]=1;\n\t\t\t}\n\t\t}\n\t\tfz(i,L[r0],r){\n\t\t\tif(!vis[a[i]]){\n\t\t\t\tif((cnt[l0+1][a[i]]-cnt[r0][a[i]])>0){\n\t\t\t\t\tif(((cntt[a[i]]+cnt[l0+1][a[i]]-cnt[r0][a[i]])&1^1)&&(cnt[l0+1][a[i]]-cnt[r0][a[i]])&1)\n\t\t\t\t\t\tans++;\n\t\t\t\t\tif(((cntt[a[i]]+cnt[l0+1][a[i]]-cnt[r0][a[i]])&1)&&(cnt[l0+1][a[i]]-cnt[r0][a[i]])&1^1)\n\t\t\t\t\t\tans--;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(cntt[a[i]]&1^1)\tans++;\n\t\t\t\t}\n\t\t\t\tvis[a[i]]=1;\n\t\t\t}\n\t\t}\n\t\tfz(i,l,R[l0])\tcntt[a[i]]--,vis[a[i]]=0;\n\t\tfz(i,L[r0],r)\tcntt[a[i]]--,vis[a[i]]=0;\n\t\treturn ans;\n\t}\n}\nsigned main(){\n\tfz(i,1,n)\ta[i]=read();\n\tprework();\n\tfill0(vis);\n\tint anss=0;\n\twhile(m--){\n\t\tint l=read(),r=read();\n\t\tl=(l+anss)%n+1,r=(r+anss)%n+1;\n\t\tif(l>r)\tswap(l,r);\n\t\tanss=query(l,r);\n\t\tcout<<anss<<endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1587567336,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "### \u9898\u76ee\u5206\u6790\uff1a\n\n\u9996\u5148\u7ed9\u51fa\u4e00\u6bb5\u5e8f\u5217\uff0c\u5171 $m$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u4e00\u6b21\u8be2\u95ee\u6c42\u51fa\u7ed9\u5b9a\u533a\u95f4\u5185\u51fa\u73b0\u6b63\u5076\u6570\u6b21\u6570\u7684\u4e2a\u6570\u3002\n\n### \u7b97\u6cd5\u8bb2\u89e3\uff1a\n\n\u9996\u5148\uff0c\u5982\u679c\u5ffd\u7565\u672c\u9898\u5f3a\u5236\u5728\u7ebf\u7684\u8bdd\uff0c\u53ef\u4ee5\u7528\u83ab\u961f\u6765\u505a\u3002\n\n\u4f46\u662f\uff0c\u9898\u76ee\u4e2d\u5df2\u7ecf\u89c4\u5b9a\u4e86\u9700\u8981\u5f3a\u5236\u5728\u7ebf\u6765\u505a\uff0c\u4e8e\u662f\u53ea\u80fd\u53e6\u6c42\u4ed6\u6cd5\u3002\n\n\u770b\u5230\u6570\u636e\u8303\u56f4\uff0c\u518d\u7ed3\u5408\u4e00\u4e0b\u9898\u610f\uff0c\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u5206\u5757\u6765\u505a\u3002\n\n\u9996\u5148\uff0c\u5b9a\u4e49\u4e24\u4e2a\u6570\u7ec4 $cnt[i][j]$ \u8868\u793a\u524d $i$ \u5757\u4e2d\uff0c$j$ \u51fa\u73b0\u7684\u6b21\u6570\uff0c$ans[i][j] $\u8868\u793a\u7b2c $i$ \u5230\u7b2c $j$ \u4e2a\u5757\u4e2d\uff0c\u51fa\u73b0\u5076\u6570\u6b21\u6570\u7684\u4e2a\u6570\u3002\n\n\u8fd9\u4e24\u4e2a\u6570\u7ec4\u9700\u8981\u5148\u9884\u5904\u7406\u51fa\u6765\uff0c\u5148\u6765\u770b $cnt$ \u6570\u7ec4\u3002\n\n\u76f8\u5f53\u4e8e\u4e00\u4e2a\u524d\u7f00\u548c\u7684\u601d\u60f3\uff0c\u5148\u8f93\u5165\u628a\u6bcf\u4e00\u4e2a\u6570 $+1$\uff0c\u7136\u540e\u4f9d\u6b21\u679a\u4e3e\u5757\uff0c\u628a\u524d\u4e00\u5757\u4e2d\u8fd9\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\u52a0\u8d77\u6765\u3002\n\n```cpp\nfor(re int i(1) ; i<=n ; ++i){\n    a[i] = read();\n    pos[i] = (i-1)/blocksize+1;\n    cnt[pos[i]][a[i]]++;\n}\nfor(re int i(1) ; i<=tot ; ++i){\n    for(re int j(0) ; j<=c ; ++j){\n        cnt[i][j] += cnt[i-1][j];\n    }\n}\n```\n\n\u7136\u540e\u6765\u770b $ans$\u6570\u7ec4\u3002\n\n\u5148\u679a\u4e3e\u6bcf\u4e00\u4e2a\u5757\uff0c\u679a\u4e3e\u53f3\u7aef\u70b9\uff0c\u8ba9 $ans[i][j]=ans[i][j-1]$ \u4f5c\u4e3a\u521d\u59cb\u503c\uff0c\u5f80\u540e\u679a\u4e3e\u5757 $j$ \u7684\u53f3\u7aef\u70b9\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u6876\u6765\u8bb0\u5f55\u51fa\u73b0\u6b21\u6570\uff0c\u5177\u4f53\u770b\u4ee3\u7801\u3002\n\n```cpp\nfor(re int i(1) ; i<=tot ; ++i){\n    for(re int j(i) ; j<=tot ; ++j){\n        ans[i][j] = ans[i][j-1]; //\u8d4b\u503c\n        for(re int k(l[j]) ; k<=r[j] ; ++k){\n            t[a[k]]++; //\u7528\u6876\u6765\u8bb0\u5f55\n            if(!(t[a[k]]&1)) ans[i][j]++; //\u5982\u679c\u73b0\u5728\u53d8\u4e3a\u5076\u6570\u4e2a\n            else if(t[a[k]]!=1) ans[i][j]--; //\u4ece\u5076\u6570\u53d8\u4e3a\u5947\u6570\n        }\n    }\n    memset(t,0,sizeof(t)); //\u522b\u5fd8\u4e86\u6bcf\u4e00\u6b21\u90fd\u8981\u6e05\u7a7a\n}\n```\n\n\u8fd9\u65f6\u9884\u5904\u7406\u4e24\u4e2a\u91cd\u8981\u7684\u6570\u636e\u5df2\u7ecf\u597d\u4e86\uff0c\u6765\u770b\u5982\u4f55\u5206\u5757\u3002\n\n\u5206\u6210 $\\sqrt{n}$ \u5757\uff0c\u628a\u6bcf\u4e00\u4e2a\u5757\u7684\u5de6\u7aef\u70b9\u548c\u53f3\u7aef\u70b9\u5148\u8bb0\u5f55\u4e0b\u6765\u3002\n\n```cpp\ninline void init(){\n    blocksize = sqrt(n); //\u5757\u5927\u5c0f\n    tot = (n-1)/blocksize+1; //\u5757\u4e2a\u6570\n    for(re int i(1) ; i<=tot ; ++i){\n        l[i] = (i-1)*blocksize+1; //\u5de6\u7aef\u70b9\n        r[i] = i*blocksize; //\u53f3\u7aef\u70b9\n    }\n    r[tot] = n; //\u6700\u540e\u4e00\u4e2a\u5757\u7684\u53f3\u7aef\u70b9\u8bbe\u4e3an\n}\n```\n\n\u6700\u540e\u5c31\u662f\u5904\u7406\u8be2\u95ee\u64cd\u4f5c\u4e86\u3002\u6bcf\u6b21\u7ed9\u5b9a\u4e00\u4e2a $l$ \u548c $r$\uff0c\u6c42\u8be5\u533a\u95f4\u5185\u5076\u6570\u6b21\u6570\u7684\u4e2a\u6570\u3002\n\n\u5206\u4e24\u79cd\u60c5\u51b5\u3002\u5982\u679c\u4e24\u4e2a\u7aef\u70b9\u5728\u4e00\u4e2a\u5757\u4e2d\uff0c\u76f4\u63a5\u66b4\u529b\u4fee\u6539\u5c31\u884c\u3002\n\n```cpp\nint idx=pos[ll],idy=pos[rr];\nif(idy-idx<=1){\n    int res=0;\n    for(re int i(ll) ; i<=rr ; ++i){\n        t[a[i]]++;\n        if(!(t[a[i]]&1)) res++;\n        else if(t[a[i]]!=1) res--;\n    }\n    for(re int i(ll) ; i<=rr ; ++i) t[a[i]]--;\n    return res;\n}\n```\n\n\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u5982\u679c\u4e24\u4e2a\u5757\u4e2d\u95f4\u9694\u4e86\u5f88\u8fdc\uff0c\u90a3\u4e48\u4e2d\u95f4\u7684\u5757\u53ef\u4ee5\u76f4\u63a5\u7528\u9884\u5904\u7406\u7684 $ans$ \u6570\u7ec4\uff0c\u65c1\u8fb9\u7684\u4e24\u4e2a\u5c0f\u5757\u66b4\u529b\u8be2\u95ee\u3002\n\n```cpp\nint res = ans[idx+1][idy-1];\nfor(re int i(ll) ; i<=r[idx] ; ++i){\n    t[a[i]]++;\n    int pre=cnt[idy-1][a[i]]-cnt[idx][a[i]]; //\u5927\u5757\u4e2da[i]\u51fa\u73b0\u7684\u6b21\u6570\n    if(!((t[a[i]]+pre)&1)) res++; //\u4ece\u5947\u6570\u53d8\u4e3a\u5076\u6570\n    else if(t[a[i]]+pre!=1) res--; //\u4ece\u5076\u6570\u53d8\u4e3a\u5947\u6570\n}\nfor(re int i(l[idy]) ; i<=rr ; ++i){\n    t[a[i]]++;\n    int pre=cnt[idy-1][a[i]]-cnt[idx][a[i]]; //\u8ddf\u4e0a\u9762\u4e00\u6837\n    if(!((t[a[i]]+pre)&1)) res++;\n    else if(t[a[i]]+pre!=1) res--;\n}\nfor(re int i(ll) ; i<=r[idx] ; ++i) t[a[i]]--; //\u6700\u540e\u522b\u5fd8\u4e86\u6e05\u7a7a\nfor(re int i(l[idy]) ; i<=rr ; ++i) t[a[i]]--; //\u800c\u4e14\u53ea\u8981\u6e05\u7a7a\u8fd9\u4e00\u6bb5\u5c31\u884c\nreturn res;\n```\n\n\u81f3\u6b64\uff0c\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u5566\u3002\n\n### \u603b\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read(){\n    int x=0,f=1;char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch == '-') f=-1 ; ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48) ; ch=getchar();}\n    return x*f;\n}\ninline void print(int x){\n    if(x/10) print(x/10);\n    putchar(x%10+'0');\n}\nconst int M = 1e5+10;\nint n,c,m; \nint blocksize,tot,last=0;\nint a[M],ans[350][350],cnt[350][M],l[M],r[M],pos[M],t[M];\ninline void init(){\n    blocksize = sqrt(n);\n    tot = (n-1)/blocksize+1;\n    for(re int i(1) ; i<=tot ; ++i){\n        l[i] = (i-1)*blocksize+1;\n        r[i] = i*blocksize;\n    }\n    r[tot] = n;\n}\ninline int query(int ll,int rr){\n    int idx=pos[ll],idy=pos[rr];\n    if(idy-idx<=1){\n        int res=0;\n        for(re int i(ll) ; i<=rr ; ++i){\n            t[a[i]]++;\n            if(!(t[a[i]]&1)) res++;\n            else if(t[a[i]]!=1) res--;\n        }\n        for(re int i(ll) ; i<=rr ; ++i) t[a[i]]--;\n        return res;\n    }\n    else{\n        int res = ans[idx+1][idy-1];\n        for(re int i(ll) ; i<=r[idx] ; ++i){\n            t[a[i]]++;\n            int pre=cnt[idy-1][a[i]]-cnt[idx][a[i]];\n            if(!((t[a[i]]+pre)&1)) res++;\n            else if(t[a[i]]+pre!=1) res--;\n        }\n        for(re int i(l[idy]) ; i<=rr ; ++i){\n            t[a[i]]++;\n            int pre=cnt[idy-1][a[i]]-cnt[idx][a[i]];\n            if(!((t[a[i]]+pre)&1)) res++;\n            else if(t[a[i]]+pre!=1) res--;\n        }\n        for(re int i(ll) ; i<=r[idx] ; ++i) t[a[i]]--;\n        for(re int i(l[idy]) ; i<=rr ; ++i) t[a[i]]--;\n        return res;\n    }\n}\nsigned main(){\n    n=read(),c=read(),m=read();\n    init();\n    for(re int i(1) ; i<=n ; ++i){\n        a[i] = read();\n        pos[i] = (i-1)/blocksize+1;\n        cnt[pos[i]][a[i]]++;\n    }\n    for(re int i(1) ; i<=tot ; ++i){\n        for(re int j(0) ; j<=c ; ++j){\n            cnt[i][j] += cnt[i-1][j];\n        }\n    }\n    for(re int i(1) ; i<=tot ; ++i){\n        for(re int j(i) ; j<=tot ; ++j){\n            ans[i][j] = ans[i][j-1];\n            for(re int k(l[j]) ; k<=r[j] ; ++k){\n                t[a[k]]++;\n                if(!(t[a[k]]&1)) ans[i][j]++;\n                else if(t[a[k]]!=1) ans[i][j]--;\n            }\n        }\n        memset(t,0,sizeof(t));\n    }\n    while(m--){\n        int ll,rr;\n        ll=read(),rr=read();\n        int L=(ll+last)%n+1,R=(rr+last)%n+1;\n        if(L > R) swap(L,R);\n        last = query(L,R);\n        printf(\"%d\\n\",last);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1649753756,
        "uid": 226367,
        "name": "glorious_dream",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u76ee\u524d\u4ee5\u849f\u84bb\u7684\u77e5\u8bc6\u6c34\u5e73\uff0c\u6211\u53ea\u60f3\u5230\u4e86\u5206\u5757\uff0c\u5176\u4f59\u6570\u636e\u7ed3\u6784\u4f3c\u4e4e\u5199\u8d77\u6765\u6709\u70b9\u56f0\u96be\u2026\u2026\n\n\u501f\u9274\u4e00\u4e0b\u84b2\u516c\u82f1\u90a3\u9053\u9898\u7684\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u4e00\u4e0b\u7b2c $i$ \u5757\u5230\u7b2c $j$ \u5757\u7684\u7b54\u6848 $dp_{i,j}$\u3002\u663e\u7136\uff0c$dp_{i,j}$ \u53ef\u4ee5\u7528 $dp_{i,j}+cnt(j)$ \u7b97\u51fa\u3002\u8fd9\u91cc $cnt(j)$ \u8868\u793a\u7b2c $j$ \u5757\u65b0\u589e\u52a0\u7684\u7b54\u6848\u3002\n\n\u90a3\u4e48\uff0c$cnt(j)$ \u600e\u4e48\u8ba1\u7b97\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u5757\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u5b57\u6328\u4e2a\u626b\u4e00\u904d\uff0c\u5982\u679c\u8bf4\u5b83\u5728\u8fd9\u4e2a\u6563\u5757\u4e2d\u51fa\u73b0\u7684\u4e2a\u6570\u52a0\u5728 $[i,j]$ \u8fd9\u4e9b\u6574\u5757\u4e2d\u51fa\u73b0\u7684\u4e2a\u6570\u4e3a\u5076\u6570\uff0c\u90a3\u4e48 $cnt(j)$ \u8981\u589e\u52a0\u4e00\uff0c\u5982\u679c\u5b83\u662f\u5927\u4e8e\u4e09\u7684\u5947\u6570\uff0c\u90a3\u4e48\u5c31\u8bf4\u660e\u5b83\u7834\u574f\u4e86\u4e00\u7ec4\u7b54\u6848\uff0c$cnt(j)$ \u8981\u51cf\u4e00\u3002\u5b9e\u9645\u4ee3\u7801\u5374\u6ca1\u6709\u8fd9\u4e48\u9ebb\u70e6\uff1a\n\n```cpp\nfor (int i = 1; i <= num; i++){//\u5de6\u7aef\u70b9\n\tfor (int j = i; j <= num; j++){//\u53f3\u7aef\u70b9\n\t\tdp[i][j] = dp[i][j - 1];//\u7ee7\u627f\n\t\tfor (int k = L[j]; k <= R[j]; k++){\n\t\t\tb[a[k]]++;//b\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u6876\n\t\t\tif (b[a[k]] % 2 == 0){//\u5982\u679c\u4ece\u7b2ci\u5757\u7684\u6700\u5de6\u5230\u5f53\u524d\u4f4d\u7f6ea[k]\u51fa\u73b0\u4e86\u5076\u6570\u6b21\n\t\t\t\tdp[i][j]++;\n\t\t\t}else if (b[a[k]] >= 3){//\u7531\u4e8e\u628ab[a[k]]\u52a0\u4e00\u4e4b\u540e\u5b83\u662f\u4e0d\u5c0f\u4e8e3\u7684\u5947\u6570\uff0c\u8bf4\u660e\u4e4b\u524d\u5b83\u662f\u4e0d\u5c0f\u4e8e2\u7684\u5076\u6570\uff0ca[k]\u7834\u574f\u4e86\u4e00\u7ec4\u7b54\u6848\n\t\t\t\tdp[i][j]--;\n\t\t\t}\n\t\t}\n\t}\n   memset(b, 0, sizeof(b));//\u66f4\u65b0\u5de6\u7aef\u70b9\u65f6\u518d\u628a\u5b83\u6e05\u7a7a\uff01\u8fd9\u6837b\u6570\u7ec4\u5b58\u7684\u5c31\u662f\u7b2ci\u5757\u7684\u5230\u5f53\u524d\u4f4d\u7f6e\u4e0a\u6bcf\u4e2a\u6570\u51fa\u73b0\u7684\u4e2a\u6570\uff01\n}\n```\n\n\u590d\u6742\u5ea6\u7ea6\u4e3a $O(n\\sqrt{n})$\uff0c\u4ee3\u7801\u5e94\u8be5\u8fd8\u7b97\u597d\u61c2\u3002\n\n\u8be2\u95ee\u7684\u505a\u6cd5\u76f8\u540c\uff0c\u7136\u540e\u5c31\u662f\u4e00\u4e9b\u5206\u5757\u7684\u5e38\u89c4\u64cd\u4f5c\uff0c\u6487\u53bb\u9884\u5904\u7406\uff0c\u590d\u6742\u5ea6\u4e3a $O(m\\sqrt{n})$\uff0c\u53ef\u4ee5\u63a5\u53d7\u3002\n\n\u6ce8\u610f\uff1a\u5757\u7684\u6700\u5927\u4e2a\u6570\u4e00\u5b9a\u8981\u591a\u5f00\u4e00\u4e24\u4e2a\uff0c\u4e0d\u7136\u4f1a\u6302\u516b\u5341\u5206\uff01\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cmath>\n#include <cstring>\nusing namespace std;\nint len, num, n, c, m, bl_l, bl_r, last, ask_l, ask_r;\nint L[318], R[318], dp[318][318];\nint a[100001], belong[100001], b[100001];\nint cnt[318][100001];\nvoid pre_dp(){\n\tfor (int i = 1; i <= num; i++){\n\t\tfor (int j = i; j <= num; j++){\n\t\t\tdp[i][j] = dp[i][j - 1];\n\t\t\tfor (int k = L[j]; k <= R[j]; k++){\n\t\t\t\tb[a[k]]++;\n\t\t\t\tif (b[a[k]] % 2 == 0){\n\t\t\t\t\tdp[i][j]++;\n\t\t\t\t}else if (b[a[k]] >= 3){\n\t\t\t\t\tdp[i][j]--;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n        memset(b, 0, sizeof(b));\n\t}\n}\nvoid build_block(){\n\tlen = sqrt(n);\n\tnum = sqrt(n);\n\tfor (int i = 1; i <= num; i++){\n\t\tL[i] = R[i - 1] + 1;\n\t\tR[i] = L[i] + len - 1;\n\t}\n\tif (R[num] < n){\n\t\tnum++;\n\t\tL[num] = R[num - 1] + 1;\n\t\tR[num] = n;\n\t}\n}\nvoid init(){\n\tbuild_block();\n\tfor (int i = 1; i <= num; i++){\n\t\tfor (int j = L[i]; j <= R[i]; j++){\n\t\t\tbelong[j] = i;\n\t\t\tcnt[i][a[j]]++;\n\t\t}\n\t\tfor (int j = 0; j <= c; j++){\n\t\t\tcnt[i][j] += cnt[i - 1][j];\n\t\t}\n\t}\n\tpre_dp();\n}\nint count(int l, int r){\n    bl_l = belong[l];\n    bl_r = belong[r];\n    int ans = dp[bl_l + 1][bl_r - 1];\n    int now_count;\n\tif (bl_l == bl_r){\n        ans = 0;\n\t\tfor (int i = l; i <= r; i++){\n\t\t\tb[a[i]]++;\n\t\t\tif (b[a[i]] % 2 == 0){\n\t\t\t\tans++;\n\t\t\t}else if (b[a[i]] >= 3){\n\t\t\t\tans--;\n\t\t\t}\n\t\t}\n\t\tmemset(b, 0, sizeof(b));\n\t\treturn ans;\n\t}else{\n\t\tfor (int i = l; i <= R[bl_l]; i++){\n\t\t\tb[a[i]]++;\n\t\t\tnow_count = b[a[i]] + cnt[bl_r - 1][a[i]] - cnt[bl_l][a[i]];\n\t\t\tif (now_count % 2 == 0){\n\t\t\t\tans++;\n\t\t\t}else if (now_count >= 3){\n\t\t\t\tans--;\n\t\t\t}\n\t\t}\n\t\tfor (int i = L[bl_r]; i <= r; i++){\n\t\t\tb[a[i]]++;\n\t\t\tnow_count = b[a[i]] + cnt[bl_r - 1][a[i]] - cnt[bl_l][a[i]];\n\t\t\tif (now_count % 2 == 0){\n\t\t\t\tans++;\n\t\t\t}else if (now_count >= 3){\n\t\t\t\tans--;\n\t\t\t}\n\t\t}\n\t\tmemset(b, 0, sizeof(b));\n\t\treturn ans;\n\t}\n}\nint main(){\n\tscanf(\"%d%d%d\", &n, &c, &m);\n\tfor (int i = 1; i <= n; i++){\n\t\tscanf(\"%d\", &a[i]); \n\t}\n\tinit();\n\twhile (m--){\n\t\tscanf(\"%d%d\", &ask_l, &ask_r);\n\t\tif (ask_l > ask_r){\n\t\t\tswap(ask_l, ask_r);\n\t\t}\n\t\tlast = count(ask_l, ask_r);\n\t\tprintf(\"%d\\n\", last);\n\t}\n\treturn 0;\n} \n```\n",
        "postTime": 1639284376,
        "uid": 347839,
        "name": "Daniel_001",
        "ccfLevel": 0,
        "title": "P4135 \u4f5c\u8bd7"
    },
    {
        "content": "\u8fd9\u9053\u9898\u4e00\u773c\u770b\u53bb\u597d\u50cf\u4e0d\u80fd\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u505a\u51fa\uff0c\u6240\u4ee5\u5c31\u53ea\u6709\u6253\u5206\u5757\u66b4\u529b\u4e86\uff0c\u521a\u5f00\u59cb\u60f3\u7684\u65f6\u5019\u6ca1\u6709\u60f3\u5230\u7528\u524d\u7f00\u548c\uff0c\u6240\u4ee5\u5199\u51fa\u6765\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u8fbe\u5230\u4e86$O(n\\sqrt{n}\\log{n})$,\u4ea4\u4e0a\u53bb\u4e0d\u4ec5T\u4e86\u8fd8WA\u4e86\u3002\u540e\u9762\u52a0\u4e0a\u4e86\u524d\u7f00\u548c\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u53ef\u4ee5\u8fc7\u4e86\n\n## \u601d\u8def\n\u5047\u8bbe\u5c06\u6574\u4e2a\u5e8f\u5217\u5206\u4e3aT\u5757\uff0c\u90a3\u4e48\u8003\u8651\u9884\u5904\u7406\u4e00\u4e2a\u6570\u7ec4$tim_{i,j}$\u8868\u793a\u524di\u4e2a\u5757\u4e2d,\u5b57\u7b26j\u51fa\u73b0\u7684\u6b21\u6570,\u8fd9\u6837\u5c31\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u6bcf\u4e00\u6bb5\u5757\u4e2d\u5404\u6570\u5b57\u51fa\u73b0\u7684\u6b21\u6570\u4e86,\u7136\u540e\u518d\u9884\u5904\u7406\u4e00\u4e2a\u6570\u7ec4$num_{i,j}$\u8868\u793a\u7b2c$i$\u4e2a\u5757\u5230\u7b2c$j$\u4e2a\u5757\u4e2d\u51fa\u73b0\u4e86\u6b63\u5076\u6570\u6b21\u7684\u6570\u5b57\u7684\u4e2a\u6570,\u90a3\u4e48\u5bf9\u4e8e\u67e5\u8be2\u7684\u533a\u95f4$[L,R]$,\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\n\n------------\n\n$[L,R]$\u5728\u540c\u4e00\u4e2a\u5757\u4e2d,\u8fd9\u79cd\u60c5\u51b5\u5c31\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u6bcf\u4e2a\u6570\u5b57\u5373\u53ef\n\n\n------------\n$[L,R]$\u4e0d\u5728\u540c\u4e00\u4e2a\u5757\u4e2d,\u8003\u8651\u5206\u4e3a\u4e09\u6bb5$[L,r),[l,r],(r,R]$,\u5176\u4e2d[l,r]\u4e3a\u5b8c\u6574\u7684\u5757,\u90a3\u4e48\u53ea\u9700\u8981\u5728\u679a\u4e3e\u7684\u65f6\u5019\u5224\u65ad\u4e00\u4e0b\u52a0\u4e0a\u5f53\u524d\u8fd9\u4e2a\u5b57\u7b26\u5bf9\u7b54\u6848\u662f\u5426\u6709\u5f71\u54cd,\u8be6\u7ec6\u89e3\u91ca\u89c1\u4ee3\u7801\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<cstring>\n#define get(i) ((i - 1) / len + 1)\nusing namespace std;\nconst int N = 1e5 + 5;\n\nint len;\nint tim[405][N], num[405][405], a[N], temp[N];\n\nint query(int l, int r)\n{\n    int res = 0;\n    if (get(l) == get(r))\n    {\n        for (int i = l; i <= r; i++)\n            temp[a[i]]++;\n        for (int i = l; i <= r; i++)\n        {\n            if (temp[a[i]] > 0 && temp[a[i]] % 2 == 0)//\u6ce8\u610f\u8981\u5927\u4e8e0\n                res++;\n            temp[a[i]] = 0;\n        }\n    }//\u66b4\u529b\u679a\u4e3e\u7684\u60c5\u51b5\n    else \n    {\n        int i = l, j = r;\n        res += num[get(i) + 1][get(j) - 1];\n        while (get(i) == get(l))\n        {\n            temp[a[i]]++;\n            if ((temp[a[i]] + tim[get(j) - 1][a[i]] - tim[get(i)][a[i]]) > 0 \n                && (temp[a[i]] + tim[get(j) - 1][a[i]] - tim[get(i)][a[i]]) % 2 == 0)\n                res++;\n            else if ((temp[a[i]] + tim[get(j) - 1][a[i]] - tim[get(i)][a[i]]) > 1 \n                && (temp[a[i]] + tim[get(j) - 1][a[i]] - tim[get(i)][a[i]]) % 2)//\u5927\u4e8e1\u662f\u4e3a\u4e86\u9632\u6b62\u591a\u51cf\n                res--;\n            i++;\n        }\n        while (get(j) == get(r))\n        {\n            temp[a[j]]++;\n            if ((temp[a[j]] + tim[get(j) - 1][a[j]] - tim[get(i) - 1][a[j]]) > 0 \n                && (temp[a[j]] + tim[get(j) - 1][a[j]] - tim[get(i) - 1][a[j]]) % 2 == 0)\n                res++;\n            else if ((temp[a[j]] + tim[get(j) - 1][a[j]] - tim[get(i) - 1][a[j]]) > 1 \n                && (temp[a[j]] + tim[get(j) - 1][a[j]] - tim[get(i) - 1][a[j]]) % 2)\n                res--;\n            j--;\n        }\n        for (int k = l; k < i; k++)\n            temp[a[k]] = 0;\n        for (int k = j + 1; k <= r; k++)\n            temp[a[k]] = 0;//\u6e05\u7a7a\u6570\u7ec4,\u56e0\u4e3a\u7528memset\u4f1a\u8d85\u65f6\n    }\n    return res;\n}\n\nint main()\n{\n    int n, c, m;\n    scanf(\"%d%d%d\", &n, &c, &m);\n    len = sqrt(n);\n    for (int i = 1; i <= n; i++)\n    {\n        scanf(\"%d\", &a[i]);\n        tim[get(i)][a[i]]++;\n    }\n    for (int i = 1; i <= get(n); i++)\n    {\n        for (int j = 0; j <= c; j++)\n            tim[i][j] += tim[i - 1][j];\n    }//\u9884\u5904\u7406\u524d\u7f00\u548c\n    for (int i = 1; i <= get(n); i++)\n    {\n        memset(temp, 0, sizeof(temp));\n        for (int j = i; j <= get(n); j++)\n        {\n            int r = j * len;\n            num[i][j] = num[i][j - 1];\n            for (int k = (j - 1) * len + 1; k <= r; k++)\n            {\n                temp[a[k]]++;\n                if (temp[a[k]] > 0 && temp[a[k]] % 2 == 0)\n                    num[i][j]++;\n                else if (temp[a[k]] > 1 && temp[a[k]])\n                    num[i][j]--;\n            }\n        }\n    }//\u9884\u5904\u7406\u6bcf\u4e2a\u5b8c\u6574\u7684\u5757\u4e2d\u7684\u7b54\u6848\n    memset(temp, 0, sizeof(temp));\n    int ans = 0;\n    while (m--)\n    {\n        int l, r;\n        scanf(\"%d%d\", &l, &r);\n        l = (l + ans) % n + 1, r = (r + ans) % n + 1;\n        if (l > r)\n            swap(l, r);\n        printf(\"%d\\n\", ans = query(l, r));//\u67e5\u8be2\n    }\n}\n```\n\n",
        "postTime": 1612138404,
        "uid": 277863,
        "name": "BzhH",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "## Legend\n\n\u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a_i$\uff0c\u533a\u95f4\u5728\u7ebf\u8be2\u95ee $m$ \u6b21\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\u7684\u6570\u5b57\u4e2a\u6570\uff080 \u6b21\u4e0d\u7b97\uff09\u3002\n\n\u5f3a\u5236\u5728\u7ebf\u3002$1 \\le n ,a_i,m \\le 10^5$\u3002\n\n## Editorial\n\n\u597d\u50cf\u6211\u7684\u505a\u6cd5\u6bd4\u8f83\u9634\u95f4\u3002\n\n\u8003\u8651\u5206\u5757\u9884\u5904\u7406 $val_{i,j}$ \u8868\u793a\u7b2c $i$ \u4e2a\u5757\u5230\u7b2c $j$ \u4e2a\u5757\u7684\u7b54\u6848\u3002\n\n\u5982\u4f55\u5904\u7406\u6563\u5757\uff1f\u9884\u5904\u7406 $back_{i,v}$ \u8868\u793a\u7b2c $i$ \u4e2a\u5757\u53ca\u4ee5\u540e\u6570\u5b57 $v$ \u4ece\u5de6\u5230\u53f3\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\n\n$front_{i,v}$ \u8868\u793a\u7b2c $i$ \u4e2a\u5757\u53ca\u4ee5\u540e\u6570\u5b57 $v$ \u4ece\u53f3\u5230\u5de6\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\n\n\u518d\u8bb0\u5f55\u4e00\u4e0b $where_i$ \u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u6570\u5b57\u662f\u8fd9\u4e2a\u6570\u5b57\u4ece\u5de6\u5230\u53f3\u7b2c\u51e0\u4e2a\u3002\n\n\u8fd9\u6837\u901a\u8fc7\u67e5\u8be2\u5757\u5185\u6700\u9760\u5de6/\u53f3\u7684\u6570\u5b57\uff0c\u7528 $where$ \u4f5c\u5dee\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u51fa\u6765\u6574\u5757\u5185\u7684\u6570\u5b57\u51fa\u73b0\u7684\u662f\u5076\u6570\u8fd8\u662f\u5947\u6570\u6b21\u4e86\u3002\u6563\u5757\u5c31\u66b4\u529b\u66f4\u65b0\u5c31\u884c\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(n\\sqrt{n})$\u3002\n\n\u7136\u800c\u5728\u5199\u8fd9\u7bc7\u9898\u89e3\u7684\u65f6\u5019\u53d1\u73b0\u597d\u50cf\u53ef\u4ee5\u76f4\u63a5\u524d\u7f00\u548c\u6c42\u51fa\u5947\u5076\u6027\uff08\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\n\nconst int MX = 1e5 + 7;\nconst int SIZE = 400;\n\nint read(){\n\tchar k = getchar(); int x = 0;\n\twhile(k < '0' || k > '9') k = getchar();\n\twhile(k >= '0' && k <= '9') x = x * 10 + k - '0' ,k = getchar();\n\treturn x;\n}\n\nint a[MX] ,buc[MX];\nint VAL[433][433];\nint occb[433][MX];\nint occf[433][MX];\n// occb[i][j] \u8868\u793a\u5728\u5757 i \u53ca\u4ee5\u540e j \u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\n// occf \u5219\u662f\u8868\u793a\u4e4b\u524d\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\nint begin[MX] ,end[MX] ,block[MX] ,where[MX];\n\nstd::vector<int> app[MX];\n\nint Query(int l ,int r){\n\tint ans = 0;\n\tif(block[r] - block[l] <= 1){\n\t\tfor(int i = l ; i <= r ; ++i){\n\t\t\tbuc[a[i]] += 1;\n\t\t\tif((buc[a[i]] & 1) == 0) ++ans;\n\t\t\telse if(buc[a[i]] != 1) --ans;\n\t\t}\n\t\tfor(int i = l ; i <= r ; ++i) buc[a[i]] = 0;\n\t\treturn ans;\n\t}\n\tans = VAL[block[l] + 1][block[r] - 1];\n\tfor(int i = end[block[l]] ; i >= l ; --i){\n\t\tif(buc[a[i]]){\n\t\t\t++buc[a[i]];\n\t\t\tif(buc[a[i]] & 1) --ans;\n\t\t\telse ++ans;\n\t\t}\n\t\telse{\n\t\t\tint now = where[occf[block[r] - 1][a[i]]] - where[i];\n\t\t\tbuc[a[i]] = now + 1;\n\t\t\tif((buc[a[i]] & 1) == 0) ++ans;\n\t\t\telse if(buc[a[i]] != 1) --ans;\n\t\t}\n\t}\n\tfor(int i = begin[block[r]] ; i <= r ; ++i){\n\t\tif(buc[a[i]]){\n\t\t\t++buc[a[i]];\n\t\t\tif(buc[a[i]] & 1) --ans;\n\t\t\telse ++ans;\n\t\t}\n\t\telse{\n\t\t\tint now = where[i] - where[occb[block[l] + 1][a[i]]];\n\t\t\tbuc[a[i]] = now + 1;\n\t\t\tif((buc[a[i]] & 1) == 0) ++ans;\n\t\t\telse if(buc[a[i]] != 1) --ans;\n\t\t}\n\t}\n\tfor(int i = l ; i <= end[block[l]] ; ++i) buc[a[i]] = 0;\n\tfor(int i = begin[block[r]] ; i <= r ; ++i) buc[a[i]] = 0;\n\treturn ans;\n}\n\nint main(){\n\tint n = read() ,c = read() ,m = read();\n\tfor(int i = 1 ; i <= n ; ++i){\n\t\ta[i] = read();\n\t\twhere[i] = app[a[i]].size();\n\t\tapp[a[i]].push_back(i);\n\t\t// printf(\"where[%d] = %d\\n\" ,i ,where[i]);\n\t}\n\tfor(int i = 0 ,bl = 0 ; i <= n ; ++i){\n\t\tblock[i] = bl;\n\t\tif(i % SIZE == 0 || i == n){\n\t\t\tend[bl] = i;\n\t\t\tbegin[++bl] = i + 1;\n\t\t}\n\t}\n\n\tmemset(occb ,0x3f ,sizeof occb);\n\tmemset(occf ,0x3f ,sizeof occf);\n\tfor(int i = n ; i ; --i){\n\t\tif(i == end[block[i]]){\n\t\t\tfor(int j = 0 ; j <= c ; ++j){\n\t\t\t\toccb[block[i]][j] = occb[block[i] + 1][j];\n\t\t\t}\n\t\t}\n\t\toccb[block[i]][a[i]] = i;\n\t}\n\tfor(int i = 1 ; i <= n ; ++i){\n\t\tif(i == begin[block[i]]){\n\t\t\tfor(int j = 0 ; j <= c ; ++j){\n\t\t\t\toccf[block[i]][j] = occf[block[i] - 1][j];\n\t\t\t}\n\t\t}\n\t\toccf[block[i]][a[i]] = i;\n\t}\n\n\tfor(int i = 1 ; i <= n ; i += SIZE){\n\t\tint ans = 0;\n\t\tfor(int j = i ; j <= n ; ++j){\n\t\t\tbuc[a[j]] += 1;\n\t\t\tif((buc[a[j]] & 1) == 0){\n\t\t\t\t++ans;\n\t\t\t}\n\t\t\telse if(buc[a[j]] != 1) --ans;\n\t\t\tVAL[block[i]][block[j]] = ans;\n\t\t}\n\t\tfor(int j = i ; j <= n ; ++j) buc[a[j]] = 0;\n\t}\n\tint Online = 1 ,la = 0;\n\twhile(m--){\n\t\tint l = read() ,r = read();\n\t\tif(Online){\n\t\t\tl = (l + la) % n + 1;\n\t\t\tr = (r + la) % n + 1;\n\t\t\tif(l > r) std::swap(l ,r);\n\t\t}\n\t\tprintf(\"%d\\n\" ,la = Query(l ,r));\n\t}\n}\n```",
        "postTime": 1601899192,
        "uid": 47863,
        "name": "Imakf",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "\u8003\u8651\u5982\u679c$i$\u7684\u6570\u91cf\u591a\u4e86\u4e00\u4e2a\uff0c\u90a3\u4e48\u5982\u679c\u4e4b\u524d$cnt_i$\u4e3a\u6b63\u5076\u6570\uff0c\u5219\u603b\u7b54\u6848\u6570\u4f1a$-1$\uff0c\u5982\u679c\u4e4b\u524d$cnt_i$\u4e3a\u5947\u6570\uff0c\u90a3\u4e48\u7b54\u6848\u4f1a$+1$\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u8fd9\u4e2a\u5e8f\u5217\u5206\u5757\uff0c\u7528$sum_{i,j}$\u8868\u793a\u524d$i$\u4e2a\u5757$j$\u51fa\u73b0\u7684\u4e2a\u6570\u3002\n\n\u540c\u65f6\u63d0\u524d\u9884\u5904\u7406\u51fa$ans_{i,j}$\u8868\u793a\u7b2c$i$\u4e2a\u5757\u5230\u7b2c$j$\u4e2a\u5757\u7684\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u5982\u679c\u9884\u5904\u7406\u51fa\u6765\u8fd9\u4e2a\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ea\u9700\u8981\u5728$ans_{blk_l+1,blk_r-1}$\u7684\u57fa\u7840\u4e0a\u8fb9\u89d2\u66b4\u529b\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8003\u8651$ans$\u7684\u9884\u5904\u7406\uff0c\u9996\u5148\u53ef\u4ee5\u505a\u51fa$ans_{i,i}$\uff0c\u7136\u540e\u4e0d\u6e05\u7a7a\u6876\uff0c\u5728$ans_{i,i}$\u7684\u57fa\u7840\u4e0a\u63a8\u51fa$ans_{i,i+1}$\uff0c\u76f4\u5230\u63a8\u5b8c\uff0c\u90a3\u4e48\u8fd9\u6837\u7684\u65b9\u6cd5\u53ef\u4ee5\u5728$O(n\\sqrt n)$\u7684\u65f6\u95f4\u5185\u63a8\u51fa\u6765\u3002\n\n\u7136\u540e\u8fd9\u9053\u9898\u5c31\u6109\u5feb\u7684\u505a\u5b8c\u5566\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\sqrt n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6$O(n\\sqrt n)$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n# define Rep(i,a,b) for(int i=a;i<=b;i++)\n# define _Rep(i,a,b) for(int i=a;i>=b;i--)\n# define RepG(i,u) for(int i=head[u];~i;i=e[i].next)\n\ntypedef long long ll;\n\nconst int N=1e5+5;\nconst int W=320;\n\ntemplate<typename T> void read(T &x){\n   x=0;int f=1;\n   char c=getchar();\n   for(;!isdigit(c);c=getchar())if(c=='-')f=-1;\n   for(;isdigit(c);c=getchar())x=(x<<1)+(x<<3)+c-'0';\n    x*=f;\n}\n\nint n,c,m,sq,bl;\nint a[N];\nint l[N],r[N],pos[N];\nint sum[W][N],ans[W][W],tot[N];\nint lastans;\n\nvoid init(){\n\tsq=ceil(sqrt(n));\n\tRep(i,1,sq){\n\t\tl[i]=(i-1)*sq+1,r[i]=i*sq;\n\t\tbl++;\n\t\tif(r[i]>n){r[i]=n;break;}\n\t}\n\tRep(i,1,n)pos[i]=(i-1)/sq+1; \n\tRep(i,1,n)sum[pos[i]][a[i]]++;\n\tRep(i,1,bl)\n\t\tRep(j,1,c)\n\t\t\tsum[i][j]+=sum[i-1][j];\n\tRep(i,1,bl){\n\t\tRep(j,l[i],r[i]){\n\t\t\ttot[a[j]]++;\n\t\t\tif(tot[a[j]]>1&&(tot[a[j]]&1))ans[i][i]--;\n\t\t\tif(tot[a[j]]%2==0)ans[i][i]++;\t\n\t\t}\n\t\tRep(j,i+1,bl){\n\t\t\tans[i][j]=ans[i][j-1];\n\t\t\tRep(k,l[j],r[j]){\n\t\t\t\ttot[a[k]]++;\n\t\t\t\tif(tot[a[k]]>1&&(tot[a[k]]&1))ans[i][j]--;\n\t\t\t\tif(tot[a[k]]%2==0)ans[i][j]++;\n\t\t\t}\n\t\t}\n\t\tRep(j,l[i],n)tot[a[j]]=0;\n\t}\n}\n\nint ask(int ql,int qr){\n\tint res=0;\n\tif(pos[ql]==pos[qr]){\n\t\tRep(i,ql,qr)tot[a[i]]++;\n\t\tRep(i,ql,qr){\n\t\t\tif(!tot[a[i]])continue;\n\t\t\tif(tot[a[i]]%2==0)res++;\n\t\t\ttot[a[i]]=0;\n\t\t}\n\t\treturn res;\n\t}\n\tres=ans[pos[ql]+1][pos[qr]-1];\n\tRep(i,ql,r[pos[ql]]){\n\t\ttot[a[i]]++;\n\t\tint s=sum[pos[qr]-1][a[i]]-sum[pos[ql]][a[i]]+tot[a[i]];\n\t\tif(s>1&&(s&1))res--;\n\t\tif(s%2==0)res++;\n\t\t\n\t}\n\tRep(i,l[pos[qr]],qr){\n\t\ttot[a[i]]++;\n\t\tint s=sum[pos[qr]-1][a[i]]-sum[pos[ql]][a[i]]+tot[a[i]];\n\t\tif(s>1&&(s&1))res--;\n\t\tif(s%2==0)res++;\n\t}\n\tRep(i,ql,r[pos[ql]])tot[a[i]]=0;\n\tRep(i,l[pos[qr]],qr)tot[a[i]]=0;\n\treturn res;\n}\n\nint main()\n{\n\tread(n),read(c),read(m);\n\tRep(i,1,n)read(a[i]);\n\tinit();\t\n\tRep(i,1,m){\n\t\tint l,r;\n\t\tread(l),read(r);\n\t\tl=(l+lastans)%n+1,r=(r+lastans)%n+1;\n\t\tif(l>r)swap(l,r);\n\t\tprintf(\"%d\\n\",lastans=ask(l,r));\t\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1597225474,
        "uid": 97344,
        "name": "devout",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "\u9898\u76ee\u94fe\u63a5\uff1a[P4135 \u4f5c\u8bd7](https://www.luogu.com.cn/problem/P4135)\n\n\u9996\u5148\u8003\u8651\u4e00\u4e0b\u4e0d\u8981\u6c42\u5f3a\u5236\u5728\u7ebf\u7684\u60c5\u51b5\uff0c\u7528\u4e00\u4e2a\u666e\u901a\u83ab\u961f\u5c31\u53ef\u4ee5\u4e86\u3002\u7531\u4e8e\u6b64\u9898\u6bd2\u7624\uff0c\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u5982\u4f55\u7528\u5206\u5757\u5728\u7ebf\u89e3\u51b3\u3002\n\n\u56de\u5fc6\u4e00\u4e0b\u83ab\u961f\u9700\u8981\u7ef4\u62a4\u7684\u4e1c\u897f\uff0c\u6211\u4eec\u53d1\u73b0\u53ea\u9700\u8981\u77e5\u9053\u4e24\u5757\u4e4b\u95f4\u7684\u7b54\u6848\u548c\u4e24\u5757\u4e4b\u95f4\u7684\u5404\u6570\u51fa\u73b0\u7684\u4e2a\u6570\uff08\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u7ef4\u62a4\uff09\u5c31\u884c\u4e86\u3002\n\n\u5982\u679c\u4ee4 $\\text{c}$ \u4e3a\u539f\u6570\u7ec4\uff0c$\\text{a[i][j]}$ \u4e3a\u4ece\u7b2c $\\text{1}$ \u5230\u7b2c $\\text{i}$ \u5757j\u51fa\u73b0\u7684\u6b21\u6570\uff0c$\\text{b[i][j]}$ \u4e3a\u7b2c $\\text{i}$ \u5757\u5230\u7b2c $\\text{j}$ \u5757\u7684\u7b54\u6848\u3002\n\n\u5728\u8054\u60f3\u4e00\u4e0b\u83ab\u961f\uff0c\u6211\u4eec\u73b0\u5728\u9996\u5148\u8981\u89e3\u51b3\u4e00\u4e2a\u95ee\u9898\uff0c\n\u82e5\u73b0\u5728\u8981\u8ba9\u5df2\u7ecf\u51fa\u73b0\u4e86 $\\text{k}$ \u6b21\uff0c\u7684\u6c49\u5b57\u518d\u51fa\u73b0\u4e00\u6b21\uff0c\n\u7b54\u6848\u4f1a\u5982\u4f55\u53d8\u5462\uff1f\n\n\u5206\u60c5\u51b5\u8ba8\u8bba\u4e00\u4e0b\uff1a \n\n$1:k=0$ $\\text{return 0;}$\n\n$2:k\\mid2$ $\\text{return -1;}$\n\n$3:k\\nmid2$ $\\text{return 1;}$\n\n\u6b64\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\n```cpp\nint add(int k){\n\tif(k==0) return 0;\n\tif(k%2) return 1;\n\treturn -1;\n}\n```\n\u4e0b\u9762\u4e3a\u5dee\u5206\u8fd8\u539f\u4ee3\u7801\uff1a\n```cpp\nint get(int j,int i,int k){//\u8fd4\u56de\u7b2cj\u5230\u7b2ci\u5757k\u51fa\u73b0\u7684\u4e2a\u6570\u3002\n\treturn a[i][k]-a[j-1][k];\n}\n```\n\n\u4ee5\u4e0b\u4e3a\u9884\u5904\u7406\u4ee3\u7801\uff1a\uff08\u53d8\u91cf\u540d\u8f83\u4e71\uff0c\u8bf7\u539f\u8c05\uff09\n```cpp\nfor(int i=1;i<=q;i++){//q\u4e3a\u5757\u7684\u6570\u91cf\u3002\n\tfor(int j=be[i];j<=en[i];j++) a[i][c[j]]++;//be[i]\u4e3a\u7b2ci\u5757\u7684\n\t//\u8d77\u59cb\uff0cen[i]\u4e3a\u7b2ci\u5757\u7684\u7ec8\u70b9\u3002\n\tfor(int j=1;j<=n;j++) a[i][j]+=a[i-1][j];\n}\nfor(int i=1;i<=q;i++){\n\tfor(int j=i;j<=q;j++){\n\t\tans=b[i][j-1];\n\t\tfor(int k=be[j];k<=en[j];k++){\n\t\t\tif(i!=j) ans+=add(get(i,j-1,c[k])+lx[c[k]]);\n\t\t\telse ans+=add(lx[c[k]]);//\u5206\u60c5\u51b5\u6dfb\u52a0c[k]\u3002\n\t\t\tlx[c[k]]++;//lx\u4e3a\u4e00\u4e2a\u4e34\u65f6\u53d8\u91cf\uff0clx[i]\u4ee3\u8868i\u5728\n            \t\t//\u6b64\u5757\u51fa\u73b0\u7684\u6b21\u6570\u3002\u4e0b\u6587\u7684lx\u53d8\u91cf\u4e0e\u6b64\n                        //\u5904\u610f\u4e49\u76f8\u540c\u3002\n\t\t}\n\t\tb[i][j]=ans;\n\t\tfor(int k=be[j];k<=en[j];k++) lx[c[k]]=0;//\u6e05\u96f6\uff0c\u6ce8\u610f\n        \t//\u4e0d\u80fd\u7528memset\uff0c\u65f6\u95f4\u590d\u6742\u4f1a\u9519\u3002\u4e0b\u6587\u5747\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002\n\t}\n}\n```\n\u6c42\u89e3\u90e8\u5206\uff1a\n```cpp\nans=0;\nif(nq[r]-nq[l]<=1){\n\tfor(int i=l;i<=r;i++){\n\t\tans+=add(lx[c[i]]);\n\t\tlx[c[i]]++;\n\t}\n\tprintf(\"%d\\n\",ans);\n\tfor(int i=l;i<=r;i++) lx[c[i]]=0;\n\tcontinue;//\u6ca1\u6709\u5728\u6574\u5757\u7684\u90e8\u5206\uff0c\u66b4\u529b\u6c42\u89e3\u3002\n}\nint b1=nq[l]+1,e1=nq[r]-1,v=be[b1];//nq[i]\u4ee3\u8868i\u5c5e\u4e8e\u7b2c\u51e0\u4e2a\u5757\u3002\nans=b[b1][e1];\nfor(int i=l;i<v;i++){\n\tans+=add(get(b1,e1,c[i])+lx[c[i]]);\n\tlx[c[i]]++;\n}\nfor(int i=be[nq[r]];i<=r;i++){\n\tans+=add(get(b1,e1,c[i])+lx[c[i]]);\n\tlx[c[i]]++;\n}\nfor(int i=l;i<v;i++) lx[c[i]]=0;\nfor(int i=be[nq[r]];i<=r;i++) lx[c[i]]=0;\nprintf(\"%d\\n\",ans);\n```\n\u6ce8\u610f\u4e8b\u9879:\n\n$\\text{1.ans}$ \u6bcf\u4e00\u6b21\u90fd\u8981\u6e05\u96f6\u3002\n\n$\\text{2.}$ \u4e34\u65f6\u53d8\u91cf\u4e0d\u80fd $\\text{memset}$  \u6e05\u96f6\u3002\n\n$\\text{3.add}$ \u91cc\u9762\u5fc5\u987b\u5224\u4e00\u4e0b $k=0$ \u7684\u60c5\u51b5\u3002",
        "postTime": 1596957399,
        "uid": 166814,
        "name": "c20210623",
        "ccfLevel": 6,
        "title": "P4135 \u4f5c\u8bd7 \u9898\u89e3"
    },
    {
        "content": "\u6bd4\u8f83\u66b4\u529b\u7684\u505a\u6cd5...\n\n\u8003\u8651\u5206\u5757bitset\uff0cbitset\u7684\u4e00\u4f4d\u4ee3\u8868\u67d0\u4e00\u79cd\u51fa\u73b0\u4e86\u5947\u6570\u6b21/\u5076\u6570\u6b21\uff0c\u8fd9\u6837\u5b50\u7684\u8bdd\u51fa\u73b0\u4e00\u6b21\u5c31\u5bf9\u67d0\u4e00\u4f4d\u5f02\u6216\u4e00\u6b21\u5c31\u884c\n\n\u7136\u540e\u9898\u76ee\u8981\u6c42\u6b63\u5076\u6570\u6b21...\n\n\u6211\u4eec\u60f3\u5230\u518d\u7528\u4e00\u4e2abitset\u7ef4\u62a4\u4e00\u4e2a\u6216\uff0c1\u4ee3\u8868\u51fa\u73b0\u4e86\u8be5\u503c...\n\n\u7136\u540ebitset\u4f4d\u8fd0\u7b97\u7684\u590d\u6742\u5ea6\u662f\u63a5\u8fd1$\\sqrt{n}$\u7684\uff08\u7ecf\u8fc7\u5b9e\u9a8c...\uff09\uff0c\u90a3\u4e48\u5982\u679c\u6bcf\u6b21\u67e5\u8be2$\\sqrt{n}$\u4e2a\u5757\u5c31\u4f1agg...\n\n\u90a3\u4e48\u8003\u8651\u5757\u5904\u7406\u51fa\u6765\u4e4b\u540e\u8fdb\u884c\u5f02\u6216\u524d\u7f00\u548c\uff0c\u53ef\u662f\u7b2c\u4e8c\u4e2abitset\u6ca1\u6cd5\u524d\u7f00\u548c\u5440\n\n\u90a3\u4e48\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u7684\u662f\u5728\u4e00\u4e2a\u533a\u95f4\u91cc\u9762\u6ca1\u6709\u51fa\u73b0\u7684\u989c\u8272\u7684\u79cd\u7c7b\u6570\uff0c\u7136\u540e\u7528\u5076\u6570\u6b21\u51cf\u53bb\u8fd9\u4e2a\u6b21\u6570\u5c31\u884c\u3002\n\n\u4e00\u4e2a\u533a\u95f4\u91cc\u9762\u6ca1\u6709\u51fa\u73b0\u7684\u989c\u8272\u7684\u79cd\u7c7b\u6570\u53ef\u4ee5\u7528\u603b\u79cd\u7c7b\u6570\u51cf\u53bb\u51fa\u73b0\u7684\u79cd\u7c7b\u6570\u3002\n\n\u90a3\u4e48\u9700\u8981\u5728\u7ebf\u6c42\u4e00\u4e2a\u533a\u95f4\u91cc\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u7684\u6570...\u8fd9\u9898\u5c31\u53d8\u6210\u4e86[SDOI2009] HH\u7684\u9879\u94fe\uff0c\u8981\u6c42\u5728\u7ebf\u8be2\u95ee\u3002\n\n\u8fd9\u4e2a\u7528\u4e3b\u5e2d\u6811\u5c31\u884c\u4e86\uff0c\u539f\u9898\u7684\u9898\u89e3\u91cc\u4e5f\u6709\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u8d58\u8ff0\u4e86...\n\n\u4e8e\u662f\u603b\u590d\u6742\u5ea6\u5927\u6982\u662f$O(n\\log{n}+q(\\log n+\\sqrt{n}))$\n\n\u5168\u7ad9\u7b2c\u56db\u6162\uff0c\u4e0d\u5f00O2TLEemm\n\n\u4ec5\u4f9b\u53c2\u8003...\n\n```cpp\n// Code by ajcxsu\n// Problem: gou\n\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int N=1e5+10, M=3e6;\ntypedef bitset<N> bs;\nbs blo[320];\nint bl[N], br[N], pos[N];\nint ty[N];\n\nbs resa, resb;\nint query(int l, int r) {\n    resa=bs(), resb=bs();\n    for(int i=l;i<=br[pos[l]] && i<=r; i++)\n        resa[ty[i]]=resa[ty[i]]^1;\n    if(pos[l]!=pos[r])\n        for(int i=r;i>=bl[pos[r]] && i>=l; i--)\n            resa[ty[i]]=resa[ty[i]]^1;\n    if(pos[l]+1<=pos[r]-1) resa^=blo[pos[l]]^blo[pos[r]-1];\n    return N-resa.count();\n}\n\nstruct Node *nil;\nstruct Node {\n    int v;\n    Node *ls, *rs;\n    Node(int v=0):v(v) { ls=rs=nil; }\n} *nd[N], po[M], *pp=po;\nvoid ini() {\n    nil=pp++, nil->ls=nil->rs=nil;\n    nd[0]=nil;\n}\nvoid updata(Node *&x, int l, int r, int d, int w) {\n    Node *nd=pp++; *nd=*x, x=nd, x->v++;\n    if(l==r) return;\n    int mid=(l+r)>>1;\n    if(d<=mid) updata(x->ls, l, mid, d, w);\n    else updata(x->rs, mid+1, r, d, w);\n}\nint query2(Node *x, int l, int r, int xr) {\n    if(r<=xr) return x->v;\n    int mid=(l+r)>>1, ret=query2(x->ls, l, mid, xr);\n    if(xr>mid) ret+=query2(x->rs, mid+1, r, xr);\n    return ret;\n}\n\nint lst[N];\nint main() {\n    ios::sync_with_stdio(false), cin.tie(0), ini();\n    int n, c, m;\n    cin>>n>>c>>m;\n    int size=sqrt(n), cm=(n-1)/size+1;\n    for(int i=1;i<=n;i++) cin>>ty[i], pos[i]=(i-1)/size+1, blo[pos[i]][ty[i]]=blo[pos[i]][ty[i]]^1;\n    for(int i=1;i<=n;i++) nd[i]=nd[i-1], updata(nd[i], 0, n, lst[ty[i]], 1), lst[ty[i]]=i;\n    for(int i=1;i<=cm;i++) bl[i]=br[i-1]+1, br[i]=size*i, blo[i]^=blo[i-1];\n    br[cm]=n;\n    int last=0, l, r;\n    while(m--) {\n        cin>>l>>r, l=(l+last)%n+1, r=(r+last)%n+1;\n        if(l>r) swap(l, r);\n        cout<<(last=query(l, r)-(N-(query2(nd[r], 0, n, l-1)-query2(nd[l-1], 0, n, l-1))))<<endl;\n    }\n    return 0;\n}\n```",
        "postTime": 1536722316,
        "uid": 5554,
        "name": "Sino_E",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "~~\u641e\u4e864\u4e2a\u591a\u5c0f\u65f6\u624d\u597d\u4e0d\u5bb9\u6613\u628a\u8fd9\u9898A\u4e86\uff0c\u867d\u7136luogu\u52a0O2\u8fc7\u7684\uff0c\u4f46bzoj\u662f\u8fc7\u4e86\u7684~~\n\n \u867d\u7136\u8dd1\u7684\u6bd4\u8f83\u6162\u4f46\u89c9\u5f97\u65b9\u6cd5\u5f88\u597d\u7406\u89e3\uff0c\u4e00\u5f00\u59cb\u6709\u4e9b\u7ec6\u8282\u6ca1\u8003\u8651\u4ee5\u53ca\u9884\u5904\u7406\u6bd4\u8f83\u6162\uff0c\u5c31\u6ca1\u8fc7\u3002\u4e4b\u540e\u501f\u9274\u4e86\u9ec4\u5b66\u957f\u7684\u4ee3\u7801\u624d\u5f04\u51fa\u6765\n \n \u4e0d\u5acc\u5f03\u7684\u8bdd\u5c31\u770b\u770b\u5427\n \n ## \u601d\u8def\n \n \u8fd9\u9898\u548c[\u84b2\u516c\u82f1](https://www.luogu.org/problemnew/show/P4168)\u5176\u5b9e\u662f\u5904\u7406\u65b9\u6cd5\u5f88\u76f8\u8fd1\u7684\uff0c~~\u522b\u770b\u662f\u9ed1\u9898\uff0c\u5176\u5b9e\u662f\u677f\u5b50~~\n          \n          \u4e3b\u8981\u662f\u9884\u5904\u7406\u6bcf\u4e2a\u5927\u5757\u4e4b\u95f4\u51fa\u73b0\u5076\u6570\u6b21\u7684\u6570\u7684\u4e2a\u6570\n          \u6ce8\u610fO(n)\u9884\u5904\u7406\uff0cO(n2)\u80af\u5b9a\u4e0d\u884c\n          \u67e5\u8be2\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u5728\u5904\u7406\u96f6\u6563\u5757\u65f6\u4e5f\u8981\u7edf\u8ba1\u4e00\u904d\n          \u8981\u6ce8\u610f\u5206\u5947\u5076\u8003\u8651\uff0c\u5728\u8003\u8651\u96f6\u6563\u5757\u7684\u65f6\u5019\u4e5f\u8981\u8003\u8651\u5927\u5757\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u5947\u5076\u6027\u3002\n          \u4f8b\uff1a\u57281-2\u4e2d\u51fa\u73b02\u6b21\uff0c2-6\u4e2d\u51fa\u73b03\u6b21\uff0c\u6ca1\u6709\u88ab\u7edf\u8ba1\u8fc7\u8981\u52a0\u7b54\u6848\uff1b\n          \u57281-2\u4e2d\u51fa\u73b01\u6b21\uff0c2-6\u51fa\u73b02\u6b21\uff0c\u8fd9\u65f6\u4e00\u5171\u51fa\u73b03\u6b21\u5c31\u4e0d\u7b26\u5408\u4e86\uff0c\u7b54\u6848\u53cd\u800c\u8981\u51cf\n          \u8fd9\u662f\u975e\u5e38\u9700\u8981\u6ce8\u610f\u7684\uff0c\u6240\u4ee5\u7ec6\u8282\u7684\u5904\u7406\u4e5f\u975e\u5e38\u91cd\u8981\n\n\u6240\u4ee5\u76f4\u63a5\u770b\u4ee3\u7801\u5427\n\n\u6211\u7528\u7684vector\u4f30\u8ba1\u6bd4\u8f83\u6162\uff0cquery\u5199\u7684\u4e5f\u5f88\u7e41\u590d\uff0c\u8fd9\u4f30\u8ba1\u5c31\u662fluogu TLE\u7684\u539f\u56e0\u5427\uff0c\u53ea\u6709O2\u624d\u80fd\u6551\u6211\uff0c\u4f46\u53ea\u89c9\u5f97\u8fd9\u6837\u601d\u8def\u5f88\u6e05\u6670\u5c31\u8fd9\u6837\u5199\u4e86\n\n~~\u8fd9\u9898c\u7ed9\u7684\u771f\u7684\u6709\u7528\u5417emmmmmmm~~\n\n## \u4ee3\u7801\n\n```\n#include <bits/stdc++.h>\n#define N 100005\n#define ri register int\nusing namespace std;\nint bl[N],l[N],r[N],n,p,a[N],cnt,val[N],m,num,vis2[N];\nint f[1505][1505];//\u9884\u5904\u7406\u6bcf\u4e2a\u5927\u5757l,r\u4e4b\u95f4\u7684\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\u6b21\u7684\u4e2a\u6570\nvector<int>ve[N];\ninline int read()\n{\n    int x=0,f=1;char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nint vis[N];\ninline void pre()//\u9884\u5904\u7406\n{\n    for(ri i=1;i<=bl[n];i++)\n    {\n        int ans=0;\n        for(ri j=l[i];j<=n;j++)vis[a[j]]=0;\n        for(ri j=l[i];j<=n;j++)\n        {\n            if(!(vis[a[j]]&1)&&vis[a[j]])ans--;//\u5982\u679c\u5728\u4e4b\u524d\u5df2\u7ecf\u51fa\u73b0\u8fc7\u5076\u6570\u6b21\u4e86\uff0c\u8bf4\u660e\u6b64\u65f6\u8fd9\u4e2a\u6570\u5df2\u7ecf\u4e0d\u7b26\u5408\u8981\u6c42\uff0cans--\n            vis[a[j]]++;\n            if(!(vis[a[j]]&1))ans++;//\u6b64\u65f6\u6ee1\u8db3\u5076\u6570\u6b21\uff0cans++\n            f[i][bl[j]]=ans;//\u8fb9\u7b97\u8fb9\u66f4\u65b0\u5c31\u4e0d\u7528n2\u4e86\uff0c\u6211\u4e4b\u524dn2\u5199\u6cd5\u5c31\u5f88\u6162\n        }\n    }\n\n\n}\ninline int two_point(int x,int y,int v)//\u4e8c\u5206\u6c42\u5728x-y\u533a\u95f4\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u4e0d\u77e5\u9053\u624b\u5199\u4e8c\u5206\u4f1a\u4e0d\u4f1a\u5feb\u4e00\u4e9bQWQ\n{\n    int t=upper_bound(ve[v].begin(),ve[v].end(),y)-lower_bound(ve[v].begin(),ve[v].end(),x);\n    return t;\n}\ninline int query(int x,int y)//\u8fd9\u90e8\u5206\u53ef\u80fd\u6211\u5199\u7684\u4e5f\u6bd4\u8f83\u6162\uff0c\u4f46\u8fd8\u662f\u6bd4\u8f83\u597d\u7406\u89e3\u7684\n{\n    int ans=0,mx;\n    int L=bl[x],R=bl[y];\n    if(L==R)//\u5f53\u5728\u540c\u4e00\u4e2a\u5757\u65f6\uff0c\u76f4\u63a5\u66b4\u529b\u7edf\u8ba1\n    {\n        for(ri i=x;i<=y;i++)\n        {\n            int t=two_point(x,y,a[i]);\n            if(!(t&1)&&!vis2[a[i]])ans++,vis2[a[i]]=1;\n        }\n        for(ri i=x;i<=y;i++)vis2[a[i]]=0;//\u6e05\u96f6\n    }\n    else\n    {\n        ans=f[L+1][R-1];//\u5148\u8ba1\u7b97\u51fa\u4e2d\u95f4\u5757\u7684\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u7684\u4e2a\u6570\n        int ll=l[L+1];int rr=r[R-1];\n        for(ri i=x;i<=r[L];i++)\n        {\n            if(vis2[a[i]])continue;\n            int t=two_point(x,y,a[i]),t2=two_point(ll,rr,a[i]);\n            if(!(t&1))//\u5982\u679c\u5728\u6563\u533a\u95f4\u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\u6b21\n                {if((t2&1)||!t2)ans++;}//\u5982\u679c\u5728\u5927\u5757\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u6216\u6ca1\u51fa\u73b0\uff0c\uff08\u4e4b\u524d\u4e5f\u6ca1\u7edf\u8ba1\u8fc7\uff0c\u6b64\u65f6\u6ee1\u8db3\u6761\u4ef6\uff0cans++\n            else if(!(t2&1)&&t2)ans--;//\u5982\u679c\u6563\u533a\u95f4\u51fa\u73b0\u5947\u6570\u6b21\uff0c\u5927\u5757\u4e2d\u51fa\u73b0\u5076\u6570\u6b21\u4e14\u4e4b\u524d\u7edf\u8ba1\u8fc7\uff0c\u6b64\u65f6\u5df2\u7ecf\u4e0d\u6ee1\u8db3\u6761\u4ef6\uff0cans--\n            vis2[a[i]]=1;\n\n        }\n        for(ri i=l[R];i<=y;i++)//\u540c\u4e0a\n        {\n           if(vis2[a[i]])continue;\n            int t=two_point(x,y,a[i]),t2=two_point(ll,rr,a[i]);\n            if(!(t&1))\n                {if((t2&1)||!t2)ans++;}\n            else if(!(t2&1)&&t2)ans--;\n            vis2[a[i]]=1;\n        }\n         for(ri i=x;i<=r[L];i++) vis2[a[i]]=0;\n         for(ri i=l[R];i<=y;i++)vis2[a[i]]=0;\n\n    }\n\n    return ans;\n}\nint main()\n{\n   \n    n=read();num=read();m=read();\n    p=sqrt((double)n/log((double)n)*log(2));\n    for(ri i=1;i<=n;i++)//\u9884\u5904\u7406\n    {\n        a[i]=read();\n        ve[a[i]].push_back(i);//\u7528vector\u5904\u7406\u6bcf\u4e2a\u6570\u5b57\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u662f\u9012\u589e\u7684\u53ef\u4ee5\u76f4\u63a5\u4e8c\u5206\uff0c\u6240\u4ee5\u6211\u9009\u62e9\u4e86vector\u800c\u4e0d\u662f\u6570\u7ec4\n        bl[i]=(i-1)/p+1;\n       if(l[bl[i]]==0)l[bl[i]]=i;\n       r[bl[i]]=i;\n    }\n    pre();\n    int pre_ans=0;\n    for(ri i=1;i<=m;i++)\n    {\n        int x,y;\n        x=read();y=read();\n        x=(x+pre_ans)%n+1;\n        y=(y+pre_ans)%n+1;\n        if(x>y)swap(x,y);\n        pre_ans=query(x,y);\n        printf(\"%d\\n\",pre_ans);\n     \n\n    }\n\n\n\n    return 0;\n}\n\n```\n\n\u611f\u8c22",
        "postTime": 1532422850,
        "uid": 55501,
        "name": "Aoki_\u704f",
        "ccfLevel": 0,
        "title": "\u5206\u5757\u2014\u2014\u66b4\u529b\u7edf\u8ba1"
    },
    {
        "content": "\u5c51\u505a\u6cd5\u3002\u3002\u5c45\u7136\u8fd8\u5361\u8fc7\u53bb\u4e86\n\n\u5206\u5757\u3002\u7136\u800c\u666e\u901a\u7684\u5206\u5757\u96be\u4ee5\u7ef4\u62a4\uff0c\u6240\u4ee5\u8003\u8651\u53e6\u4e00\u79cd\u5957\u8def\uff0c\u5c31\u662f\u7528 $f_{i,j}(i\\le j)$ \u8868\u793a\u5757 $i$ \u7684\u8d77\u70b9\u5230\u5757 $j$ \u7684\u7ec8\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u6b63\u5076\u6570\u6b21\u3002\n\n\u8bbe\u5757\u5927\u5c0f\u4e3a $b$\uff0c\u663e\u7136\u9884\u5904\u7406\u590d\u6742\u5ea6 $\\dfrac {n^2} b$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $b^2$\u3002\n\n\u7136\u540e\uff1f\u7136\u540e\u6211\u5c31\u4e0d\u77e5\u9053\u600e\u4e48\u4f18\u79c0\u7684\u641e\u5757\u8fb9\u4e86\u3002\u65e0\u5948\u4e4b\u4e0b\u53ea\u80fd\u7528\u4e86\u4e00\u4e2a\u7cdf\u7cd5\u7684\u505a\u6cd5\u3002\n\n\u5bf9\u4e8e\u5757\u8fb9\u626b\u8fc7\u53bb\u7684\u6570\u4e3a $x$\uff0c\u4e24\u8fb9\u7684\u5757\u8fb9\u5206\u522b\u4e3a $bl,br$\u3002\n\n* \u5982\u679c\u8fd9\u4e2a\u6570\u503c\u6b64\u524d\u5df2\u7ecf\u88ab\u5904\u7406\u8fc7\u8d21\u732e\u5219\u8df3\u8fc7\uff0c\u7528\u4e00\u4e2a\u6570\u7ec4 vis \u8bb0\u5f55\u3002\n\n* \u5982\u679c\u8fd9\u4e2a\u6570\u5728\u533a\u95f4 $[l,r]$ \u4e2d\u51fa\u73b0\u4e86\u6b63\u5076\u6570\u6b21\uff0c\u4f46\u5728\u533a\u95f4 $[bl,br]$ \u4e2d\u51fa\u73b0\u4e86\u975e\u6b63\u5076\u6570\u6b21\uff0c\u5219\u8d21\u732e\u4e3a $1$\u3002\u5373\u52a0\u4e0a $[l,r]$ \u4e2d\u7684\u8fd9\u4e2a\u6570\u7684\u8d21\u732e\u3002\n\n* \u5982\u679c\u8fd9\u4e2a\u6570\u5728\u533a\u95f4 $[l,r]$ \u4e2d\u51fa\u73b0\u4e86\u6b63\u5076\u6570\u6b21\uff0c\u5728\u533a\u95f4 $[bl,br]$ \u4e2d\u4e5f\u51fa\u73b0\u4e86\u6b63\u5076\u6570\u6b21\uff0c\u5219\u8d21\u732e\u4e3a $0$\u3002\u5373\u8fd9\u4e2a\u6570\u7684\u8d21\u732e\u5df2\u7ecf\u88ab\u7edf\u8ba1\u8fc7\u4e86\u3002\n\n* \u5982\u679c\u8fd9\u4e2a\u6570\u5728\u533a\u95f4 $[l,r]$ \u4e2d\u51fa\u73b0\u4e86\u975e\u6b63\u5076\u6570\u6b21\uff0c\u4f46\u5728\u533a\u95f4 $[bl,br]$ \u4e2d\u51fa\u73b0\u4e86\u6b63\u5076\u6570\u6b21\uff0c\u5219\u8d21\u732e\u4e3a $-1$\u3002\u5373\u51cf\u53bb $[bl,br]$ \u4e2d\u7684\u8fd9\u4e2a\u6570\u7684\u8d21\u732e\u3002\n\n* \u5982\u679c\u8fd9\u4e2a\u6570\u5728\u533a\u95f4 $[l,r]$ \u4e2d\u51fa\u73b0\u4e86\u975e\u6b63\u5076\u6570\u6b21\uff0c\u5728\u533a\u95f4 $[bl,br]$ \u4e2d\u4e5f\u51fa\u73b0\u4e86\u975e\u6b63\u5076\u6570\u6b21\uff0c\u5219\u8d21\u732e\u4e3a $0$\u3002\u540c\u7406\u3002\n\n\u5bf9\u4e8e\u600e\u4e48\u6c42\u4e00\u4e2a\u533a\u95f4\u4e2d\u4e00\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u6211\u7528\u7684\u662f\u7528 vector \u5b58\u4e0b\u6807\u4e8c\u5206\u7684\u53e4\u8001\u65b9\u6cd5\u3002\n\n\u8fd9\u4e2a\u590d\u6742\u5ea6\u548c\u5e38\u6570\u60e8\u4e0d\u5fcd\u7779\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u6574\u4f53\u7684\u8fd0\u884c\u6b21\u6570\u662f $\\dfrac {n^2} b+m\\times i\\times \\log n$ \u7684\u3002\n\n\u7136\u540e\u679a\u4e3e\u5757\u957f\u5373\u53ef\u901a\u8fc7\u672c\u9898\u3002",
        "postTime": 1611459343,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "\u6211\u7684 blog\uff1a[https://www.cnblogs.com/suxxsfe/p/13531824.html](https://www.cnblogs.com/suxxsfe/p/13531824.html)  \n\n[https://www.luogu.com.cn/problem/P4135](https://www.luogu.com.cn/problem/P4135)  \n[https://darkbzoj.tk/problem/2821](https://darkbzoj.tk/problem/2821)  \n\u524d\u7f00\u548c\u5199\u7684\u65f6\u5019\u4e00\u5f00\u59cb\u539f\u6570\u7ec4\u3001\u524d\u7f00\u548c\u6570\u7ec4\u5206\u5f00\u6765\u7684\uff0c\u7ed3\u679c bzoj MLE\uff0c\u548c\u5728\u4e00\u8d77\u624d\u8fc7\u7684\u3002\u3002\u3002  \n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u5217\uff0c$m$ \u4e2a\u8be2\u95ee\uff0c\u6bcf\u6b21\u95ee $[l,r]$ \u4e2d\u6709\u591a\u5c11\u79cd\u6570\u7684\u51fa\u73b0\u6b21\u6570\u4e3a\u5076\u6570\uff0c\u5f3a\u5236\u5728\u7ebf\uff0c$n,m,\\max\\{a_i\\}\\le 10^5$  \n\n\u533a\u95f4\u95ee\u9898\uff0c\u4f46\u7ebf\u6bb5\u6811\u5565\u7684\u53c8\u4e0d\u597d\u7ef4\u62a4\uff0c\u8003\u8651\u5206\u5757  \n\u5355\u72ec\u7ef4\u62a4\u6bcf\u4e2a\u5757\u7684\u4fe1\u606f\u7136\u540e\u4e00\u4e2a\u4e2a\u5408\u5e76\u80af\u5b9a\u6ca1\u620f\uff0c\u6240\u4ee5\u8003\u8651\u6bcf\u6b21\u8be2\u95ee\u53ea\u5408\u5e76\u8fb9\u89d2\u5757\u548c\u4e2d\u95f4\u4e00\u90e8\u5206\u6574\u5757\u7684\u4fe1\u606f  \n\u8fd9\u6837\u9700\u8981\u4e00\u4e2a $f_{l,r}$ \u6765\u8868\u793a $[l,r]$ \u5757\u7684\u7b54\u6848\uff0c\u7136\u540e\u679a\u4e3e\u8fb9\u89d2\u5757\u91cc\u7684\u6ca1\u4e00\u4e2a\u5143\u7d20\uff0c\u8bb0\u5f55\u4e0b\u6bcf\u4e00\u4e2a\u503c\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c\u5bb9\u6613\u77e5\u9053\u53ef\u4ee5\u6309\u7167\u4e0b\u9762\u4e24\u6761\u89c4\u5219\u7edf\u8ba1\u6700\u7ec8\u7b54\u6848  \n\n- \u5982\u679c\u4e00\u4e2a\u503c\u5728\u6574\u5757\u4e2d\u51fa\u73b0\u4e86\u5947\u6570\u6b21\uff0c\u6216\u8005\u6ca1\u51fa\u73b0\uff0c\u90a3\u4e48\u5982\u679c\u5728\u6574\u5757\u51fa\u73b0\u7684\u6b21\u6570\u548c\u5728\u4e24\u4e2a\u8fb9\u89d2\u5757\u51fa\u73b0\u7684\u6b21\u6570\u7684\u5947\u5076\u6027\u76f8\u540c\uff0c\u5219\u8fd9\u4e2a\u503c\u4e00\u5171\u51fa\u73b0\u4e86\u5076\u6570\u6b21\uff0c\u7b54\u6848\u52a0\u4e00\n- \u5982\u679c\u5728\u6574\u5757\u4e2d\u51fa\u73b0\u4e86\u5076\u6570\u6b21\uff0c\u4e14\u4e0d\u4e3a\u96f6\uff0c\u90a3\u4e48\u5982\u679c\u5728\u4e24\u4e2a\u8fb9\u89d2\u5757\u4e2d\u51fa\u73b0\u4e86\u5947\u6570\u6b21\uff0c\u7b54\u6848\u51cf\u4e00\n\n\u90a3\u4e48\u4e5f\u5c31\u9700\u8981\u4e00\u4e2a $sum_{i,k}$ \u8868\u793a\u524d $i$ \u5757\uff0c$k$ \u51fa\u73b0\u4e86\u51e0\u6b21  \n\u6309\u7167\u4e0a\u9762\u7684\u60f3\u6cd5\uff0c\u4e5f\u5c31\u53ef\u4ee5 $O(n\\sqrt n)$ \u7684\u9884\u5904\u7406\u51fa $f$ \u4e86\uff08\u7531 $f_{l,r-1}$ \u63a8\u77e5 $f_{l,r}$\uff09  \n\n```cpp  \n#include<cstdio>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#define reg register\ninline int read(){\n\tint x=0,y=1;\n\tchar c=std::getchar();\n\twhile(c<'0'||c>'9'){if(c=='-') y=-1;c=std::getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=std::getchar();}\n\treturn x*y;\n}\n#define N 100005\n#define SQRTN 320\nint n,m,B,c;\nint block[N],a[N];\nint L[SQRTN],R[SQRTN],sum[SQRTN][N],f[SQRTN][SQRTN];\nint tmp[N];\ninline void pre(){\n\tfor(reg int i=1;i<=block[n];i++)\n\t\tfor(reg int j=1;j<=c;j++) sum[i][j]+=sum[i-1][j];\n\tfor(reg int i=1;i<=block[n];i++){\n\t\tfor(reg int j=L[i];j<=R[i];j++) tmp[a[j]]++;\n\t\tfor(reg int j=L[i];j<=R[i];j++) f[i][i]+=(tmp[a[j]]&&!(tmp[a[j]]&1)),tmp[a[j]]=0;\n\t\tfor(reg int j=i+1;j<=block[n];j++){\n\t\t\tfor(reg int k=L[j];k<=R[j];k++) tmp[a[k]]++;\n\t\t\tf[i][j]=f[i][j-1];\n\t\t\tfor(reg int kk=L[j],k;kk<=R[j];kk++)if(tmp[a[kk]]){\n\t\t\t\tk=a[kk];\n\t\t\t\tif(sum[j-1][k]-sum[i-1][k]>0&&!((sum[j-1][k]-sum[i-1][k])&1)) f[i][j]-=(tmp[k]&1);\n\t\t\t\t//[i,j-1] \u4e0a k \u7684\u4e2a\u6570\u4e3a\u5076\u6570\uff0c\u4e14\u4e0d\u7b49\u4e8e 0\uff0c\u5219 tmp[k] \u4e3a\u5947\u6570\u7b54\u6848\u5c31\u51cf\u4e00\n\t\t\t\telse if((tmp[k]&1)==((sum[j-1][k]-sum[i-1][k])&1)) f[i][j]++;\n\t\t\t\t//\u4e3a\u5947\u6570\uff0c\u6216\u4e3a 0\uff0c\u5219 tmp[k] \u4e0e\u4e4b\u524d k \u7684\u4e2a\u6570\u5947\u5076\u6027\u76f8\u540c\uff0cf[i][j] \u5c31\u52a0\u4e00\n\t\t\t\ttmp[k]=0;\n\t\t\t}\n\t\t}\n\t}\n}\n//inline void print(){\n//\tputs(\"block :\");\n//\tfor(reg int i=1;i<=n;i++) printf(\"%d : %d,left : %d,right : %d\\n\",i,block[i],L[block[i]],R[block[i]]);\n//\tputs(\"\\nsum :\");\n//\tfor(reg int i=1;i<=block[n];i++){\n//\t\tprintf(\"block %d :\\n\",i);\n//\t\tfor(reg int j=1;j<=c;j++) printf(\"%d \",sum[i][j]);\n//\t\tputs(\"\\n\");\n//\t}\n//\tputs(\"\\nf :\");\n//\tfor(reg int i=1;i<=n;i++){\n//\t\tfor(reg int j=i;j<=block[n];j++) printf(\"f[%d][%d]=%d  \",i,j,f[i][j]);\n//\t\tputs(\"\");\n//\t}\n//}\nint main(){\n\tn=read();c=read();m=read();B=std::sqrt(n);\n\tstd::memset(L,0x3f,sizeof L);\n\tfor(reg int i=1;i<=n;i++){\n\t\ta[i]=read();\n\t\tblock[i]=block[i-1]+(!((i-1)%B));\n\t\tsum[block[i]][a[i]]++;\n\t\tR[block[i]]=std::max(R[block[i]],i);L[block[i]]=std::min(L[block[i]],i);\n\t}\n\tpre();\n//\t\tprint();\n\treg int l,r,bl,br;int ans=0;\n\twhile(m--){\n\t\tl=(ans+read())%n+1;r=(ans+read())%n+1;\n\t\tif(l>r) l^=r,r^=l,l^=r;\n\t\tbl=block[l];br=block[r];\n\t\tif(bl==br){\n\t\t\tfor(reg int i=l;i<=r;i++) tmp[a[i]]++;\n\t\t\tans=0;\n\t\t\tfor(reg int i=l;i<=r;i++) ans+=(tmp[a[i]]&&!(tmp[a[i]]&1)),tmp[a[i]]=0;\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t\tcontinue;\n\t\t}\n\t\tfor(reg int i=l;i<=R[bl];i++) tmp[a[i]]++;\n\t\tfor(reg int i=L[br];i<=r;i++) tmp[a[i]]++;\n\t\tans=f[bl+1][br-1];\n\t\tfor(reg int k,i=l;i<=R[bl];i++)if(tmp[a[i]]){\n\t\t\tk=a[i];\n\t\t\tif(sum[br-1][k]-sum[bl][k]>0&&!((sum[br-1][k]-sum[bl][k])&1)) ans-=(tmp[k]&1);\n\t\t\telse if((tmp[k]&1)==((sum[br-1][k]-sum[bl][k])&1)) ans++;\n\t\t\ttmp[k]=0;\n\t\t}\n\t\tfor(reg int k,i=L[br];i<=r;i++)if(tmp[a[i]]){\n\t\t\tk=a[i];\n\t\t\tif(sum[br-1][k]-sum[bl][k]>0&&!((sum[br-1][k]-sum[bl][k])&1)) ans-=(tmp[k]&1);\n\t\t\telse if((tmp[k]&1)==((sum[br-1][k]-sum[bl][k])&1)) ans++;\n\t\t\ttmp[k]=0;\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n}\n```  ",
        "postTime": 1597841525,
        "uid": 164432,
        "name": "suxxsfe",
        "ccfLevel": 9,
        "title": "P4135 \u4f5c\u8bd7"
    },
    {
        "content": "### \u9898\u610f\n\n\u200b\tN\u4e2a\u6570\uff0cM\u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u95ee[l,r]\u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u6b63\u5076\u6570\u6b21\uff0c\u5f3a\u5236\u5728\u7ebf\u3002\n\n\u200b\t\u6709\u6ca1\u6709\u89c9\u5f97\u8fd9\u9898\u5f88\u50cf\u84b2\u516c\u82f1\u90a3\u4e2a\u9898\uff1f\u56e0\u4e3a\u6076\u610f\u7684\u5f3a\u5236\u5728\u7ebf\uff0c\u4f18\u7f8e\u7684\u83ab\u961f\u548c\u5de7\u5999\u7684\u6811\u72b6\u6570\u7ec4\u6216\u4e3b\u5e2d\u6811\u88ab\u5361\u6389\u4e86\uff08\u6211\u53ef\u80fd\u8981\u51fa\u4e2a\u9898\u4e13\u95e8\u8ba9\u6811\u72b6\u6570\u7ec4\u8fc7\uff09\uff0c\u6240\u4ee5\u53ea\u6709\u4e11\u964b\u7684\u5206\u5757\u4e86\u3002\n\n### \u505a\u6cd5\n\n\u200b\t\u9884\u5904\u7406\u4e24\u4e2a\u6570\u7ec4$num$\u548c$o$\uff0c$num[i][j]$\u8868\u793a\u7b2c$i$\u5757\u5230\u7b2c$j$\u5757\u4e2d\u7684\u7b54\u6848\u6570\uff0c$o[i][j]$\u8868\u793a\u524d$i$\u4e2a\u5757\u4e2d\u7b2c$j$\u79cd\u989c\u8272\u7684\u4e2a\u6570\uff0c\u663e\u7136\u8fd9\u9700\u8981$n \\times \\sqrt n$\u7684\u65f6\u95f4\u548c\u7a7a\u95f4\u3002\n\n\u200b\t\u67e5\u8be2\u662f\uff0c\u5982\u679c$l$\u548c$r$\u6240\u5728\u4e00\u4e2a\u5757\u6216\u6240\u5728\u5757\u76f8\u90bb\u7684\u8bdd\uff0c\u5c31\u76f4\u63a5\u66b4\u529b$\\sqrt n$\u67e5\u8be2\uff0c\u5426\u5219\u5c31\u5904\u7406\u6563\u5757\uff0c\u4e2d\u95f4\u7684\u90e8\u5206\u7528$num$\u548c$o$\u505a\u524d\u7f00\u548c\u7edf\u8ba1\u3002\n\n### \u4ee3\u7801\n\n```c++\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\nusing namespace std;\nint lk[501],rk[501],a[100101],m,bl[100201],blo;\nint u[100401],o[501][100101],n,num[501][505],f;\ninline int query(int x,int y){\n\tint ans=0;\n\tmemset(u,0,sizeof(u));\n\tif (bl[y]-bl[x]<=1){\n\t\tfor (int i=x; i<=y; i++){\n\t\t\tif (u[a[i]]){\n\t\t\t\tif (u[a[i]]&1) ans++;\n\t\t\t\telse ans--;\n\t\t\t}\n\t\t\tu[a[i]]++;\n\t\t}\n\t\treturn ans;\n\t}\n\tans=num[bl[x]+1][bl[y]-1];\n\tfor (int i=x; i<=rk[bl[x]]; i++){\n\t\tif (!u[a[i]]){\n\t\t\tu[a[i]]=o[bl[y]-1][a[i]]-o[bl[x]][a[i]];\n\t\t\t// continue;\n\t\t}\n\t\tif (u[a[i]]){\n\t\t\tif (u[a[i]]&1) ans++;\n\t\t\telse ans--;\n\t\t}\n\t\tu[a[i]]++;\n\t}\n\tfor (int i=lk[bl[y]]; i<=y; i++){\n\t\tif (!u[a[i]]){\n\t\t\tu[a[i]]=o[bl[y]-1][a[i]]-o[bl[x]][a[i]];\n\t\t}\n\t\tif (u[a[i]]){\n\t\t\tif (u[a[i]]&1) ans++;\n\t\t\telse ans--;\n\t\t}\n\t\tu[a[i]]++;\n\t}\n\treturn ans;\n}\nint main(){\n\tint x,y,ans;\n\tscanf(\"%d%d%d\",&n,&f,&m);\n\tblo=sqrt(n);\n\tfor (int i=1; i<=n; i++){\n\t\tscanf(\"%d\",&a[i]);\n\t\tbl[i]=(i-1)/blo+1;\n\t}\n\tfor (int i=1; i<=bl[n]; i++)\n\t\tlk[i]=(i-1)*blo+1,rk[i]=min(lk[i]+blo-1,n);\n\tfor (int i=1; i<=bl[n]; i++){\n\t\tans=0; memset(u,0,sizeof(u));\n\t\tfor (int j=1; j<=f; j++) o[i][j]=o[i-1][j];\n\t\tfor (int k=lk[i]; k<=rk[i]; k++){\n\t\t\tif (u[a[k]]){\n\t\t\t\tif (u[a[k]]&1) ans++;\n\t\t\t\telse ans--;\n\t\t\t}\n\t\t\tu[a[k]]++; o[i][a[k]]++;\n\t\t}\n\t\tnum[i][i]=ans;\n\t\tfor (int j=i+1; j<=bl[n]; j++){\n\t\t\tfor (int k=lk[j]; k<=rk[j]; k++){\n\t\t\t\tif (u[a[k]]){\n\t\t\t\t\tif (u[a[k]]&1) ans++;\n\t\t\t\t\telse ans--;\n\t\t\t\t}\n\t\t\t\tu[a[k]]++;\n\t\t\t}\n\t\t\tnum[i][j]=ans;\n\t\t}\n\t}\n\tint last=0;\n\twhile (m--){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tx=(x+last)%n+1; y=(y+last)%n+1;\n\t\tif (x>y) swap(x,y);\n\t\tlast=query(x,y); printf(\"%d %d %d\\n\",x,y,last);\n\t}\n\treturn 0;\n}\n\n```\n\nps:\u5199\u7684\u65f6\u5019\u4ed7\u7740\u590d\u6742\u5ea6\u6b63\u786e\u4ec0\u4e48\u4f18\u5316\u90fd\u6ca1\u52a0\u8fd8\u8086\u65e0\u5fcc\u60ee\u7684memset\uff0c\u6240\u4ee5\u8dd1\u4e8616000\u591ams\uff0c\u5927\u5bb6\u90fd\u662f\u5206\u5757\u5c31\u6211\u50cf\u66b4\u529b\u6c34\u8fc7\u53bb\u7684\u3002",
        "postTime": 1546930833,
        "uid": 63661,
        "name": "Taduro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4135 \u3010\u4f5c\u8bd7\u3011"
    },
    {
        "content": "\u521a\u6253\u5b8c[\u84b2\u516c\u82f1](https://www.luogu.org/problemnew/show/P4168)\u6765\u6253\u8fd9\u9898\uff0c\u611f\u89c9\u6709\u70b9\u50cf\u3002\n\n## \u8fd8\u662f\u5206\u5757\n\n\u5148\u5bf9\u6bcf\u4e00\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\u505a\u4e00\u4e2a\u524d\u7f00\u548c$s$\u3002\n\n\u7136\u540e\u4ee4$f[x][y]$\u8868\u793a\u7b2c$x$\u5757\u5230\u7b2c$y$\u5757\u4e4b\u95f4\u51fa\u73b0\u6b63\u5076\u6570\u6b21\u6570\u503c\u7684\u4e2a\u6570\u3002\n\n\u7136\u540e\u5bf9\u4e8evis\u6570\u7ec4\u7684\u9884\u5904\u7406\uff08\u4e5f\u5c31\u662f\u8f6c\u79fb\uff09\uff1a\u5bf9\u5757\u5185$sqrt(n)$\u4e2a\u6570\u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee\uff1a\u5206\u5757\u8001\u5957\u8def\uff0c\u4e2d\u95f4\u76f4\u63a5\u7528\uff0c\u4e24\u8fb9\u66b4\u529b\uff1a\n\n\u8fc7\u4e86$BZOJ$,~~$lg$\u5f00$O(2)$.~~\n\n\u4ee3\u4e70\u62f1\u624b\u732e\u4e0a\n```\n//\u52a0\u4e86\u4e00\u70b9\u5e38\u6570\u4f18\u5316\uff0c\u53d8\u91cf\u53ef\u80fd\u4f1a\u6709\u70b9\u602a\uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u7406\u89e3\n#include <iostream>\n#include <cstdio>\n#include <cctype>\n#include <vector>\n#include <cmath>\n#define Rint register int\n#define Temp template<typename T>\nusing namespace std; \nTemp inline void read(T &x) {\n\tx=0;T w=1,ch=getchar();\n\twhile(!isdigit(ch)&&ch!='-') ch=getchar();\n\tif(ch=='-') w=-1,ch=getchar();\n\twhile(isdigit(ch)) x=x*10+ch-'0',ch=getchar();\n\tx*=w;\n}\ninline void write_(int x) {\n\tif(x<0) putchar('-'),x=-x;\n\tif(x>=10) write_(x/10);\n\tputchar(x%10+'0');\n}\ninline void writeln(int x) {\n\twrite_(x);putchar('\\n');\n}\nconst int maxn=1e5+10;\nint vis[maxn],a[maxn],sum[320][maxn],f[320][320];\nint low[320],high[320],id[maxn],n,c,m,cnt,siz;\nvector<int> s;\nint main() {\n\tread(n);read(c);read(m);\n\tsiz=sqrt(n);\n\tcnt=(n-1)/siz+1;\n    for(int i=1;i<cnt;++i) {\n    \tlow[i]=(i-1)*siz+1;\n\t\thigh[i]=i*siz;\n\t}\n    low[cnt]=(cnt-1)*siz+1;\n\thigh[cnt]=n;\n    for(int i=1;i<=cnt;++i)\n    \tfor(int j=low[i];j<=high[i];++j) id[j]=i;\n    for(int i=1;i<=n;++i) read(a[i]);\n    for(int i=1;i<=cnt;++i){\n        __builtin_memcpy(sum[i],sum[i-1],sizeof*sum);\n        for(int j=low[i];j<=high[i];++j) ++sum[i][a[j]];\n        for(int j=1;j<=c;++j)\n        \tif(sum[i][j]-sum[i-1][j]>0) f[i][i]+=(sum[i][j]-sum[i-1][j])&1^1;\n    }\n    for(int i=1;i<cnt;++i){\n        for(int j=i+1;j<=cnt;++j){\n            int&res=f[i][j];res=f[i][j-1];\n            s.clear();\n            for(int k=low[j];k<=high[j];++k) {\n\t\t\t\ts.push_back(a[k]);\n\t\t\t\tvis[a[k]]=1;\n\t\t\t}\n            for(int it:s){\n                if(!vis[it]) continue;\n                int l1=sum[j][it],l2=sum[j-1][it],l3=sum[i-1][it];\n                vis[it]=0;\n                if((l1-l2)&1){\n                    if(l2-l3>0){\n                        if((l2-l3)&1) ++res;\n\t\t\t\t\t\telse --res;\n                    }\n                } else{\n                    if((l2-l3)==0)++res;\n                }\n            }\n        }\n    }\n\tint ans=0;\n\twhile(m--) {\n\t\tint l0,r0,l,r;\n\t\tread(l0);read(r0);\n\t\tl=(l0+ans)%n+1;r=(r0+ans)%n+1;\n\t\tif(l>r) std::swap(l,r);\n\t\tint lx=id[l],rx=id[r];\n\t\tif((rx-lx)<=1) {\n\t\t\tans=0;\n\t\t\tfor (Rint i=l;i<=r;++i) ++vis[a[i]];\n\t\t\tfor (Rint i=l;i<=r;++i) {\n\t\t\t\tif(vis[a[i]]) {\n\t\t\t\t\tans+=vis[a[i]]&1^1;\n\t\t\t\t\tvis[a[i]]=0;\n\t\t\t\t}\n\t\t\t} \n\t\t\twriteln(ans);\n\t\t\tcontinue;\n\t\t}\n\t\ts.clear();\n\t\tfor (Rint i=l;i<=high[lx];++i) {\n\t\t\t++vis[a[i]];\n\t\t\ts.push_back(a[i]);\n\t\t}\n\t\tfor (Rint i=low[rx];i<=r;++i) {\n\t\t\t++vis[a[i]];\n\t\t\ts.push_back(a[i]);\n\t\t}\n\t\tans=f[lx+1][rx-1];\n\t\tfor (Rint it:s) {\n\t\t\tif(vis[it]) {\n\t\t\t\tint last=sum[rx-1][it]-sum[lx][it];\n\t\t\t\tif(vis[it]&1) {\n\t\t\t\t\tif(last&1) ++ans;\n\t\t\t\t\telse {\n\t\t\t\t\t\tif(last) --ans;\n\t\t\t\t\t}\n\t\t\t\t}else {\n\t\t\t\t\tif(!last) ++ans;\n\t\t\t\t}\n\t\t\t\tvis[it]=0;\n\t\t\t}\n\t\t}\n\t\twriteln(ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1545142228,
        "uid": 78187,
        "name": "zjjcth330",
        "ccfLevel": 0,
        "title": "4135--\u4f5c\u8bd7"
    },
    {
        "content": "## P4135 \u4f5c\u8bd7 \u9898\u89e3\n\n### \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a $n$ \u4e2a\u4e0d\u5927\u4e8e $c$ \u7684\u6b63\u6574\u6570 $a_1 \\dots a_n$ \u548c $m$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u95ee $[l,r]$ \u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u51fa\u73b0\u6b63\u5076\u6570\u6b21\uff0c\u9898\u76ee**\u5f3a\u5236\u5728\u7ebf**\u3002\n\n### \u9898\u76ee\u5206\u6790\n\n\u8003\u8651\u9898\u76ee\u662f\u4e00\u79cd\u5bf9\u9759\u6001\u5e8f\u5217\u7684\u533a\u95f4\u67e5\u8be2\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u4f7f\u7528\u83ab\u961f\u5904\u7406\uff0c\u4f46\u672c\u9898\u8981\u6c42\u5f3a\u5236\u5728\u7ebf\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5206\u5757\u7684\u505a\u6cd5\u3002\n\n\u672c\u7740\u5927\u6bb5\u7ef4\u62a4\uff0c\u5c40\u90e8\u6734\u7d20\u7684\u539f\u5219\uff0c\u6211\u4eec\u5c06\u6574\u4e2a\u5e8f\u5217\u5206\u6210 $ t $ \u5757\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5757\u8fdb\u884c\u9884\u5904\u7406\u3002\n\n\u8003\u8651\u6bcf\u5757\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f\u5f71\u54cd\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u60f3\u5230\u6bcf\u5757\u5404\u6570\u5b57\u7684\u4e2a\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u7684\u65b9\u5f0f\u7ef4\u62a4\u6570\u7ec4 $ blo[i][j] $ \u8868\u793a\u524d $ i $ \u5757\u7b2c $ j $ \u4e2a\u6570\u7684\u4e2a\u6570\uff0c\u518d\u5728\u5c40\u90e8\u66b4\u529b\u7d2f\u52a0\u4e2a\u6570\uff0c\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u4f46\u8fd9\u79cd\u505a\u6cd5\u5728\u6bcf\u6b21\u7d2f\u52a0\u5b8c\u540e\u90fd\u9700\u8981\u67e5\u627e\u6570\u7ec4\u7edf\u8ba1\u7b54\u6848\uff0c\u7531\u4e8e\u6bcf\u6b21\u7d2f\u52a0\u4e2a\u6570\u65f6\uff0c\u901a\u8fc7\u5947\u5076\u7684\u53d8\u5316\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u77e5\u9053\u7b54\u6848\u7684\u53d8\u5316\u3002\n\n\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u5904\u7406 $ num[i][j] $ \u8868\u793a\u7b2c $ i $ \u5757\u5230\u7b2c $ j $ \u5757\u7684\u7b54\u6848\uff0c\u6bcf\u6b21\u6734\u7d20\u5904\u7406\u65f6\u7ef4\u62a4\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cmath>\n#include<algorithm>\n#include<cstring>\nusing namespace std;\nint val[100001];\nint pos[100001],L[100001],R[100001];\nint blo[400][100001],num[400][400];\nint t;\nint buc[100001];\nint solve(int l,int r){\n\tint q=pos[l],p=pos[r];\n\tif(p-q<=1){\n\t\tint cnt=0;\n\t\tfor(int i=l;i<=r;i++){\n\t\t\tbuc[val[i]]++;\n\t\t\tif(buc[val[i]]%2==0) cnt++;\n\t\t\telse if(buc[val[i]]>2 && buc[val[i]]%2==1) cnt--;\n\t\t}\n\t\tfor(int i=l;i<=r;i++)buc[val[i]]=0;\n\t\treturn cnt;\n\t}\n\telse{\n\t\tint cnt=num[q+1][p-1];\n\t\tfor(int i=l;i<=R[q];i++){\n\t\t\tblo[p-1][val[i]]++;\n\t\t\tif((blo[p-1][val[i]]-blo[q][val[i]])%2==0) cnt++;\n\t\t\telse if((blo[p-1][val[i]]-blo[q][val[i]])>2) cnt--;\n\t\t}\n\t\tfor(int i=L[p];i<=r;i++){\n\t\t\tblo[p-1][val[i]]++;\n\t\t\tif((blo[p-1][val[i]]-blo[q][val[i]])%2==0) cnt++;\n\t\t\telse if((blo[p-1][val[i]]-blo[q][val[i]])>2) cnt--;\n\t\t}\n\t\tfor(int i=l;i<=R[q];i++)blo[p-1][val[i]]--;\n\t\tfor(int i=L[p];i<=r;i++)blo[p-1][val[i]]--;\n\t\treturn cnt;\n\t}\n}\nint main(){\n\tint n,c,m;\n\tcin>>n>>c>>m;\n\tfor(int i=1;i<=n;i++) cin>>val[i];\n\tt=sqrt(n);\n\tfor(int i=1;i<=t;i++){\n\t\tL[i]=(i-1)*t+1;\n\t\tR[i]=i*t;\n\t}\n\tif(R[t]<n){\n\t\tt++;\n\t\tL[t]=R[t-1]+1;\n\t\tR[t]=n; \n\t}\n\tfor(int i=1;i<=t;i++)for(int j=L[i];j<=R[i];j++)pos[j]=i;\n\tfor(int i=1;i<=t;i++){\n\t\tfor(int j=0;j<=c;j++)blo[i][j]=blo[i-1][j];\n\t\tfor(int j=L[i];j<=R[i];j++) blo[i][val[j]]++;\n\t}\n\tfor(int i=1;i<=t;i++){\n\t\tint cnt=0;\n\t\tfor(int j=i;j<=t;j++){\n\t\t\tfor(int k=L[j];k<=R[j];k++){\n\t\t\t\tbuc[val[k]]++;\n\t\t\t\tif(buc[val[k]]%2==0) cnt++;\n\t\t\t\telse if(buc[val[k]]>2) cnt--;\n\t\t\t}\n\t\t\tnum[i][j]=cnt;\n\t\t}\n\t\tmemset(buc,0,sizeof(buc));\n\t}\n\tint l,r,ans=0;\n\tfor(int i=1;i<=m;i++){\n\t\tcin>>l>>r;\n\t\tl=((l+ans)%n)+1;\n\t\tr=((r+ans)%n)+1;\n\t\tif(l>r) swap(l,r);\n\t\tans=solve(l,r);\n\t\tcout<<ans<<endl;\n\t}\n    return 0;\n}\n\n```\n",
        "postTime": 1657430035,
        "uid": 421265,
        "name": "eastcloud",
        "ccfLevel": 4,
        "title": "P4135 \u4f5c\u8bd7 \u9898\u89e3"
    },
    {
        "content": "\u5206\u5757\u7ecf\u5178\u9898\u3002\n\n\u8fd9\u79cd\u9898\u663e\u7136\u662f\u6570\u636e\u7ed3\u6784\uff0c$1 \\leq n \\leq 10^5$\uff0c\u8003\u8651\u6839\u53f7\u590d\u6742\u5ea6\u505a\u6cd5\u3002\u4e8e\u662f\u8003\u8651\u4f7f\u7528\u5206\u5757\u3002\n\n\u6211\u4eec\u5148\u9884\u5904\u7406\u51fa\u4e24\u4e2a\u503c\uff1a$res_{i, j}, cnt_{i, j}$\uff0c$res_{i,j}$ \u8868\u793a\u7b2c $i$ \u5757\u5230\u7b2c $j$ \u5757\u7684\u7b54\u6848\uff0c$cnt_{i, j}$ \u8868\u793a\u4ece\u7b2c $1$ \u5757\u5230\u7b2c $i$ \u5757\u4e2d $j$ \u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u90a3\u4e48\u82e5\u8981\u6c42\u7b2c $l$ \u5757\u5230\u7b2c $r$ \u5757\u4e2d $x$ \u51fa\u73b0\u7684\u6b21\u6570\uff0c\u4fdd\u8bc1 $l \\leq r$\uff0c\u5c31\u662f $cnt_{r, x} - cnt_{l - 1, x}$\u3002\u67e5\u8be2\u540c\u5757\u66b4\u529b\uff0c\u4e0d\u540c\u5757\u7684\u65f6\u5019\u5148\u6c42\u6574\u5757\uff0c\u7136\u540e\u5bf9\u96f6\u6563\u5757\u6c42\u51fa\u4e0e\u6574\u5757\u7684\u7b54\u6848\u7684\u5dee\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n \\sqrt{n})$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <map>\n#include <cstring>\n#include <unordered_map>\nusing namespace std;\n\nconst int N = 1e5 + 5, M = 325;\n\nint n, m, c;\nint a[N], ans = 0, l, r;\n\nint bel[N], block;\n\nint mph[N];\nbool vis[N];\n\nint g[M][N], res[M][M];\n\n#define L(x) ((x - 1) * block)\n\n#define get(l, r, x) (l > r ? 0 : g[r][x] - g[l - 1][x])\n\nint main()\n{\n\tscanf(\"%d%d%d\", &n, &c, &m);\n\tblock = sqrt(n);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]), bel[i] = i / block + 1;\n\tfor (int i = 1; i <= bel[n]; i++)\n\t{\n\t\tfor (int j = 0; j <= c; j++) g[i][j] = g[i - 1][j];\n\t\tint l = L(i), r = L(i + 1) - 1;\n\t\tfor (int j = l; j <= r; j++) g[i][a[j]]++;\n\t}\n\tfor (int i = 1; i <= bel[n]; i++)\n\t{\n\t\tfor (int j = i; j <= bel[n]; j++)\n\t\t{\n\t\t\tres[i][j] = res[i][j - 1];\n\t\t\tint l = L(j), r = L(j + 1) - 1;\n\t\t\tfor (int k = l; k <= r; k++)\n\t\t\t{\n\t\t\t\tif (vis[a[k]]) continue;\n\t\t\t\tint pre = get(i, j - 1, a[k]), now = get(j, j, a[k]);\n\t\t\t\tif (pre == 0)\n\t\t\t\t{\n\t\t\t\t\tif (!(now & 1)) res[i][j]++;\n\t\t\t\t}\n\t\t\t\telse if (pre % 2 != (pre + now) % 2)\n\t\t\t\t{\n\t\t\t\t\tif (pre % 2) res[i][j]++;\n\t\t\t\t\telse res[i][j]--;\n\t\t\t\t}\n\t\t\t\tvis[a[k]] = true;\n\t\t\t}\n\t\t\tfor (int k = l; k <= r; k++) vis[a[k]] = false;\n\t\t}\n\t}\n\twhile (m--)\n\t{\n\t\tint l, r;\n\t\tscanf(\"%d%d\", &l, &r);\n\t\tl = (l + ans) % n + 1, r = (r + ans) % n + 1;\n\t\tif (l > r) swap(l, r);\n\t\tans = 0;\n\t\tif (bel[l] == bel[r])\n\t\t{\n\t\t\tfor (int i = l; i <= r; i++)\n\t\t\t{\n\t\t\t\tmph[a[i]]++;\n\t\t\t}\n\t\t\tfor (int i = l; i <= r; i++)\n\t\t\t{\n\t\t\t\tint x = mph[a[i]];\n\t\t\t\tif (x > 0 && x % 2 == 0) ans++;\n\t\t\t\tmph[a[i]] = 0;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint nl = bel[l] + 1, nr = bel[r] - 1;\n\t\t\tint rl = L(bel[l] + 1) - 1, lr = L(bel[r]);\n\t\t\tans = res[nl][nr];\n\t\t\tfor (int i = l; i <= rl; i++) mph[a[i]]++;\n\t\t\tfor (int i = lr; i <= r; i++) mph[a[i]]++;\n\t\t\tfor (int i = l; i <= rl; i++)\n\t\t\t{\n\t\t\t\tif (vis[a[i]]) continue;\n\t\t\t\tint pre = get(nl, nr, a[i]), now = mph[a[i]];\n\t\t\t\tif (pre == 0)\n\t\t\t\t{\n\t\t\t\t\tif (!(now & 1)) ans++;\n\t\t\t\t}\n\t\t\t\telse if (pre % 2 != (pre + now) % 2)\n\t\t\t\t{\n\t\t\t\t\tif (pre & 1) ans++;\n\t\t\t\t\telse ans--;\n\t\t\t\t}\n\t\t\t\tvis[a[i]] = true;\n\t\t\t\tmph[a[i]] = 0;\n\t\t\t}\n\t\t\tfor (int i = lr; i <= r; i++)\n\t\t\t{\n\t\t\t\tif (vis[a[i]]) continue;\n\t\t\t\tint pre = get(nl, nr, a[i]), now = mph[a[i]];\n\t\t\t\tif (pre == 0)\n\t\t\t\t{\n\t\t\t\t\tif (!(now & 1)) ans++;\n\t\t\t\t}\n\t\t\t\telse if (pre % 2 != (pre + now) % 2)\n\t\t\t\t{\n\t\t\t\t\tif (pre & 1) ans++;\n\t\t\t\t\telse ans--;\n\t\t\t\t}\n\t\t\t\tvis[a[i]] = true;\n\t\t\t\tmph[a[i]] = 0;\n\t\t\t}\n\t\t\tfor (int i = l; i <= rl; i++) vis[a[i]] = false;\n\t\t\tfor (int i = lr; i <= r; i++) vis[a[i]] = false;\n\t\t}\n\t\tprintf(\"%d\\n\", ans);\n\t}\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1656728319,
        "uid": 332914,
        "name": "happybob",
        "ccfLevel": 6,
        "title": "P4135 \u4f5c\u8bd7"
    }
]