[
    {
        "content": "\u5148\u65e0\u826f\u5ba3\u4f20\u4e00\u4e0b\u535a\u5ba2 $wwwwww$    \n[\u6587\u7ae0\u5217\u8868 - \u5730\u9748\u6bbf - \u6d1b\u8c37\u535a\u5ba2](https://www.luogu.org/blog/koishikoishi/)\n\n---\n\n## \u77e5\u8bc6\u70b9: \u7ebf\u6bb5\u6811,\u6a21\u62df  \n\n### [\u539f\u9898\u9762](https://www.luogu.org/problem/P3797)  \n\n\u51fa\u9898\u7684\u795e\u4ed9ob \u5728 $gxs$ \u53d1\u5e03\u5f53\u5929 \u6253\u901a\u4e86 \u2467\u4e2a\u673a\u4f53\u7684 $L$  \n~~ob\u592a\u5f3a\u5566~~  \n\n---\n\n### \u9898\u76ee\u8981\u6c42:   \n\u7ed9\u5b9a \u4e00 \u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u4e32 , \u7531 \"$($\" , \"$X$\" , \"$)$\" \u4e09\u79cd\u5b57\u7b26\u6784\u6210 ,   \u521d\u59cb\u72b6\u6001 \u4e3a  $(XX...XX)$   \n\u9700\u8981\u652f\u6301\u4e0b\u5217\u4e24\u79cd\u64cd\u4f5c:    \n1.  \u4fee\u6539 :   \u5c06\u7b2c $i$ \u4e2a\u5143\u7d20\u66ff\u6362\u4e3a \u4e09\u79cd\u5143\u7d20\u4e2d \u7ed9\u5b9a\u7684\u7684\u4e00\u79cd.   \n2.  \u67e5\u8be2 :  \u67e5\u8be2\u533a\u95f4 $[l,r]$ \u4e2d , \u5f62\u5982 $(X..X)$ \u6216 $()$ \u5b57\u7b26\u4e32\u7684\u4e2a\u6570   \n\t( \u76ee\u6807\u5b57\u4e32 \u9996\u5c3e\u4e3a $(\\ )$  , \u4e14 $(\\ )$ \u4e2d\u95f4 \u53ea\u80fd\u5b58\u5728 $X$ )   \n\n---   \n\n### \u5206\u6790\u9898\u610f:   \n\n\u4e00\u5f00\u59cb\u8d70\u4e86\u8bb8\u591a\u5f2f\u8def = = ,    \n\u5f97\u5230\u4e86\u8bb8\u591a \u770b\u8d77\u6765\u5f88\u6709\u7528 \u5b9e\u9645\u4e0a \u5375\u7528\u6ca1\u6709\u7684\u7ed3\u8bba   \n\u7ecf\u8fc7\u6574\u7406\u540e ,  \u7528\u7684\u53ea\u6709\u4e0b\u5217\u7ed3\u8bba :   \n\n1. \u5bf9\u4e8e\u4e00\u4e2a\u53ea\u7531 \u5b57\u7b26$($ \u4e0e  \u5b57\u7b26$)$ \u6784\u6210\u7684\u5b57\u4e32 ,   \n\t\u5411\u5176\u4e2d \u4efb\u610f\u4f4d\u7f6e \u63d2\u5165 \u4efb\u610f\u6570\u91cf \u7684 $X$ ,     \n\t\u5bf9\u4efb\u610f\u533a\u95f4\u5185 \u76ee\u6807\u5b57\u4e32\u7684\u6570\u91cf\u90fd\u6ca1\u6709\u5f71\u54cd   \n\n\t\u6839\u636e\u6b64\u7ed3\u8bba , \u53ef\u4ee5\u5c06 \u539f\u5b57\u4e32 \u8fdb\u884c \u8f6c\u5316 ,   \n\t\u5ffd\u7565\u6240\u6709 \u7684 $X$ ,  \u4ee5\u4fbf\u4e8e\u4e4b\u540e\u7684\u7684 \u5206\u6790\u53ca\u8c03\u8bd5\t   \n\n2.  \u5047\u8bbe\u73b0 \u6709\u4e24\u76f8\u90bb\u5b57\u4e32 $A$ \u4e0e $B$    \n\t$A$ , $B$ \u4e2d \u76ee\u6807\u5b57\u4e32 \u7684\u6570\u91cf \u5206\u522b\u4e3a $sum_a$ \u4e0e $sum_b$ ,    \n\t \u6c42 \u4e24\u5e8f\u5217 \u5408\u5e76\u540e \u76ee\u6807\u5b57\u4e32\u7684\u6570\u91cf  $sum_{a+b}$    \n\t\n    - \u663e\u7136 , \u5408\u5e76\u540e $sum_{a+b}$ \u81f3\u5c11\u4e3a   $sum_a + sum_b$     \n\t  \u53ef\u4e0d\u53ef\u80fd\u51fa\u73b0\u65b0\u7684\u76ee\u6807\u5b57\u4e32 , \u4f7f\u5408\u5e76\u540e \u76ee\u6807\u5b57\u4e32\u6570\u91cf\u6709\u6240\u589e\u52a0  ?    \n\t  \u7b54\u6848\u662f\u80af\u5b9a\u7684.     \n\n\t    \u5982\u4e0b\u5217\u60c5\u51b5 (\u5ffd\u7565\u4e86\u6240\u6709\u7684 $X$) :   \n\t\n    \t| $...($ | $)...$ | $...()..$ |\n\t\t| -----------: | -----------: | -----------: |\n\t\t| $A$ | $B$ | $A+B$ |\n        \n      \u6b64\u65f6\u6709: $sum_{a+b} = sum_a+sum_b+1$   \n\n    - \u5408\u5e76\u65f6 \u5982\u4f55\u7ef4\u62a4 \u6b64\u7c7b \u6a2a\u8de8\u4e24\u4e2a\u533a\u95f4\u7684 \u76ee\u6807\u5b57\u4e32 $??$   \n\t  \u53ef\u4ee5\u7ef4\u62a4\u6bcf\u4e00\u4e2a\u533a\u95f4\u7684 \u6700\u5de6\u4fa7\u7684\u975e $X$ \u5b57\u7b26\u4e0e \u6700\u53f3\u4fa7\u7684\u975e $X$ \u5b57\u7b26.   \n\t  \n\t  \u5728\u5408\u5e76\u65f6 , \u82e5 \u5de6\u533a\u95f4\u6700\u53f3\u4fa7\u4e3a \"$($\" \u4e14 \u53f3\u533a\u95f4\u6700\u5de6\u4fa7\u4e3a \"$)$\"   \n\t  \u5219\u8bc1\u660e \u51fa\u73b0\u4e0a\u8ff0\u60c5\u51b5  , \u533a\u95f4\u76ee\u6807\u5b57\u4e32\u6570 $+1$   \n\n3. \u7531\u7ed3\u8bba $2$ \u6269\u5c55\u800c\u6765 :   \n\t\u5982\u4f55\u7ef4\u62a4 \u533a\u95f4\u7684 \u6700\u5de6,\u6700\u53f3\u4fa7\u7684 \u975e $X$ \u5b57\u7b26 ?   \n\t\n\t- \u533a\u95f4\u5185\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u65f6: \u4e24 \u975e$X$\u5b57\u7b26 \u5373 \u8be5\u5143\u7d20   \n\t- \u5f53\u533a\u95f4 \u6709\u591a\u4e2a\u5143\u7d20\u65f6, \u53ef\u4ee5\u5c06\u533a\u95f4 \u770b\u505a \u4e24\u4e0d\u76f8\u4ea4\u7684 \u5b50\u533a\u95f4\u5408\u5e76\u800c\u6765 :   \n\t\t1. \u5f53\u4e24\u5b50\u533a\u95f4\u5747\u4e0d\u5168\u4e3a $X$\u65f6  ,     \n\t\t\t\u533a\u95f4\u6700\u5de6\u4fa7 \u975e $X$ \u5b57\u7b26 = **\u5de6**\u5b50\u533a\u95f4 \u6700**\u5de6**\u4fa7\u975e $X$ \u5b57\u7b26,     \n\t\t\t\u533a\u95f4\u6700\u53f3\u4fa7 \u975e $X$ \u5b57\u7b26 = **\u53f3**\u5b50\u533a\u95f4 \u6700**\u53f3**\u4fa7\u975e $X$ \u5b57\u7b26,     \n\t\t\t\n\t\t2. \u5f53\u53f3\u5b50\u533a\u95f4 \u5168\u4e3a $X$\u65f6:   \n\t\t\t\u533a\u95f4\u6700\u5de6\u4fa7 \u975e $X$ \u5b57\u7b26 = **\u5de6**\u5b50\u533a\u95f4 \u6700**\u5de6**\u4fa7\u975e $X$ \u5b57\u7b26,     \n\t\t\t\u533a\u95f4\u6700\u53f3\u4fa7 \u975e $X$ \u5b57\u7b26 = **\u5de6**\u5b50\u533a\u95f4 \u6700**\u53f3**\u4fa7\u975e $X$ \u5b57\u7b26,     \n\t\t3. \u5f53\u5de6\u5b50\u533a\u95f4 \u5168\u4e3a $X$\u65f6:  \u540c $2$    \n\n\t- \u7531\u4e0a , \u53ea\u9700\u8981\u518d\u7ef4\u62a4 \u533a\u95f4\u662f\u5426\u4e3a\u7a7a ,        \n\t  \u8be5\u4fe1\u606f\u5373\u53ef\u7531 \u9012\u5f52\u56de\u4f20 \u6765\u8fdb\u884c\u7ef4\u62a4 .      \n\n4. \u9898\u76ee\u8981\u6c42\u7684 \u533a\u95f4\u67e5\u8be2:    \n\n\t\u672c\u4f53 \u5373 \u7b80\u5355\u7684\u533a\u95f4\u6c42\u548c     \n\t\u4f46\u662f \u5b58\u5728 \u7ed3\u8bba $2$ \u4e2d\u63cf\u8ff0\u7684: \u6a2a\u8de8 \u4e24\u5b50\u533a\u95f4\u7684 \u76ee\u6807\u5b57\u4e32     \n\t\u5219\u9700\u8981\u5bf9 \u7ebf\u6bb5\u6811\u7684\u533a\u95f4\u6c42\u548c\u64cd\u4f5c \u8fdb\u884c\u5fae\u5c0f\u7684\u6539\u9020:     \n\t\n\t\u8bbe\u67e5\u8be2\u533a\u95f4\u4e3a $[L,R]$ , \u53ef\u4ee5\u53d1\u73b0:     \n\t\n\t\u6ee1\u8db3\u4e0b\u5217 $3$ \u4e2a\u6761\u4ef6\u65f6 , \u5b58\u5728 \u6a2a\u8de8 \u4e24\u5b50\u533a\u95f4\u7684 \u76ee\u6807\u5b57\u4e32 , \u67e5\u8be2\u7684\u533a\u95f4\u548c\u9700 $+1$  \n\t- \u5f53 $[L,R]$ \u6a2a\u8de8 \u67d0\u533a\u95f4 \u7684 \u5de6\u53f3\u5b50\u533a\u95f4    \n\t- \u5de6\u5b50\u533a\u95f4 \u6700\u53f3\u4fa7  \u975e $X$ \u5b57\u7b26\u4e3a  \"$($\"  , \u4f4d\u7f6e\u4e3a $pos1$    \n\t  \u53f3\u5b50\u533a\u95f4 \u6700\u5de6\u4fa7  \u975e $X$ \u5b57\u7b26\u4e3a   \"$)$\" , \u4f4d\u7f6e\u4e3a $pos2$    \n\t- $L\\le pos1$ \u4e14 $pos2 \\le R$   \n\t\n\t\u4e3a\u5b9e\u73b0\u4e0a\u8ff0\u64cd\u4f5c , \u8fd8\u9700\u8981\u7ef4\u62a4 \u6700\u5de6 , \u6700\u53f3\u4fa7\u7684 \u975e $X$ \u5b57\u7b26 \u7684\u4f4d\u7f6e       \n\t\n---\n\n### \u7b97\u6cd5\u5b9e\u73b0:\n\n\u6839\u636e \u4e0a\u8ff0\u7ed3\u8bba , \u73b0\u5728\u9700\u8981\u4e00\u79cd\u6570\u636e\u7ed3\u6784 ,    \n\u652f\u6301 \u7ef4\u62a4\u533a\u95f4\u4fe1\u606f , \u9012\u5f52\u56de\u4f20 , \u5355\u70b9\u4fee\u6539   \n\n- \u5efa\u7acb \u4e00\u68f5 \u7ef4\u62a4\u4e0b\u5217 \u533a\u95f4\u4fe1\u606f\u7684\u7ebf\u6bb5\u6811:\n\t- \u6700\u5de6\u4fa7\u7b2c\u4e00\u4e2a \u975e $X$ \u5b57\u7b26 \u662f\u5426\u4e3a \"$)$\"  \n\t  \u6700\u53f3\u4fa7\u7b2c\u4e00\u4e2a \u975e $X$ \u5b57\u7b26 \u662f\u5426\u4e3a \"$($\"  \n    - \u6700\u5de6\u4fa7\u7b2c\u4e00\u4e2a \"$)$\" \u7684\u4f4d\u7f6e , \u6700\u53f3\u4fa7\u7b2c\u4e00\u4e2a \"$($\" \u7684\u4f4d\u7f6e  \n    - \u662f\u5426\u5168\u90e8\u4e3a $X$  \n    - \u76ee\u6807\u5b57\u4e32\u6570\u91cf\n    \n- \u5355\u70b9\u4fee\u6539 \u64cd\u4f5c :  \n   \u5148\u6df1\u5165\u81f3 \u76ee\u6807 \u53f6\u8282\u70b9 , \u66f4\u65b0\u53f6\u8282\u70b9\u7684\u4fe1\u606f  \n   \u4e4b\u540e \u6839\u636e \u7ed3\u8bba $2,3$ , \u9012\u5f52\u66f4\u65b0\u533a\u95f4\u4fe1\u606f   \n   \n- \u533a\u95f4\u67e5\u8be2 \u64cd\u4f5c : \u6839\u636e\u7ed3\u8bba $4$ , \u6c42\u533a\u95f4\u548c\u5373\u53ef\n   \n\n---\n\n\n~~\u5947\u4e11\u7684~~ \u4ee3\u7801:    \n\n```cpp\n//\u77e5\u8bc6\u70b9: \u7ebf\u6bb5\u6811,\u6a21\u62df \n/*\nBy:Luckyblock\nob\u7ed9\u7ed9\u8214\u4e00\u8214\n\u75280\u4ee3\u8868( , \u75281\u4ee3\u8868) ,\u75282\u4ee3\u8868'X' \n*/\n#include<cstdio>\n#include<cstdlib>\n#include<ctype.h>\n#define ls (now<<1)\n#define rs ((now<<1)+1)\nconst int MARX = 2e5+10;\n//=============================================================\nstruct node\n{\n\tint L,R;//\u7ef4\u62a4\u7684\u533a\u95f4,\n\tbool allX,side[3];//\u662f\u5426\u5168\u4e3aX , side[0]:\u6700\u5de6\u4fa7\u662f\u5426\u6709) , side[1]:\u6700\u53f3\u4fa7\u662f\u5426\u6709( ,\n\tint sum,pos[3]; //\u533a\u95f4\u5185\u5b8c\u6574\u6728\u68d2\u6570, \u53ca\u533a\u95f4\u5185 \u6700\u5de6\u4fa7),\u6700\u53f3\u4fa7( \u4f4d\u7f6e \n}tree[MARX<<4];\nint n,m, map[110],map1[3];//map\u5b58\u6620\u5c04\u5173\u7cfb, 0<->( , 1<->) , 2<->X \nchar now_list[MARX];//\u5f53\u524d\u7684 \u5b57\u4e32 \n//=============================================================\ninline int read()\n{\n    int s=1, w=0; char ch=getchar();\n    for(; !isdigit(ch);ch=getchar()) if(ch=='-') s =-1;\n    for(; isdigit(ch);ch=getchar()) w = w*10+ch-'0';\n    return s*w;\n}\nvoid Build(int now,int l,int r)//\u5e38\u89c4\u5efa\u6811\n{\n\ttree[now].L=l,tree[now].R=r;\n\tif(l == r) return ;\n\tint mid = (l+r)>>1;\n\tBuild(ls,l,mid);\n\tBuild(rs,mid+1,r);\n}\nvoid pushup(int now)//\u66f4\u65b0 \u7b2cnow\u4e2a\u8282\u70b9 \u7684\u5404\u4fe1\u606f \n{\n\t//\u7ef4\u62a4 \u533a\u95f4\u6700\u5de6\u4fa7 \u662f\u5426\u6709) \n\tif(tree[ls].side[0]) tree[now].side[0]=1, tree[now].pos[0] = tree[ls].pos[0]; \n\telse if(!tree[ls].allX && tree[rs].side[0]) tree[now].side[0]=1 , tree[now].pos[0]= tree[rs].pos[0];\n\telse tree[now].side[0] = 0;\n\t//\u7ef4\u62a4 \u533a\u95f4\u6700\u53f3\u4fa7 \u662f\u5426\u6709( \n\tif(tree[rs].side[1]) tree[now].side[1]=1 , tree[now].pos[1] = tree[rs].pos[1];\n\telse if(!tree[rs].allX && tree[ls].side[1]) tree[now].side[1]=1 , tree[now].pos[1]= tree[ls].pos[1];\n\telse tree[now].side[1] = 0;\n\t//\u66f4\u65b0\u533a\u95f4 \u5408\u6cd5\u5b57\u4e32\u6570, \u533a\u95f4\u662f\u5426\u5168\u4e3a'X' \n\ttree[now].sum = tree[ls].sum+tree[rs].sum + (tree[ls].side[1] && tree[rs].side[0]);;\n\ttree[now].allX = (tree[ls].allX || tree[rs].allX);\n}\nvoid Change(int now,int pos,int value) //\u5355\u70b9\u4fee\u6539, \u5c06\u7b2cpos\u4e2a\u4f4d\u7f6e\u4fee\u6539\u4e3a value \n{\n\tif(tree[now].L==pos && tree[now].R==pos)//\u5f53\u524d\u533a\u95f4 \u5373\u6307\u5b9a\u4f4d\u7f6e \n\t{\n\t  now_list[pos] = map1[value];//\u66f4\u65b0\u5404\u4fe1\u606f \n\t  tree[now].allX = (value!=2);//\u662f\u5426\u5168\u4e3aX \n\t  tree[now].side[0] = tree[now].side[1] = 0;//\u66f4\u65b0 \u6700\u5de6,\u6700\u53f3\u4fa7\u5143\u7d20 \n\t  tree[now].side[value] = 1, tree[now].pos[value]=pos;\n\t  return ;\n\t}\n\tint mid = (tree[now].L+tree[now].R)>>1;\n\tif(pos <= mid) Change(ls,pos,value);\n\tif(pos > mid) Change(rs,pos,value);\n\tpushup(now);//\u66f4\u65b0\u5f53\u524d\u4f4d\u7f6e \n}\nint Inquiry(int now,int L,int R)//\u67e5\u8be2\u533a\u95f4 L,R \u7684\u76ee\u6807\u5b57\u4e32\u6570 \n{\n\tif(L <= tree[now].L && tree[now].R <= R) return tree[now].sum;\n\tint sum=0,flag=0;//flag \u5224\u65ad\u533a\u95f4 \u662f\u5426\u540c\u65f6\u88ab\u5de6\u53f3\u5b50\u533a\u95f4\u66f4\u65b0\u8fc7   \n\tint mid = (tree[now].L+tree[now].R)>>1;\n\tif(L<=mid) sum += Inquiry(ls,L,R), flag++;\n\tif(R>mid) sum += Inquiry(rs,L,R), flag++;\n\t//\u5b58\u5728 \u5408\u6cd5\u5b57\u4e32 \u6a2a\u8de8\u5de6\u53f3\u5b50\u533a\u95f4  \n\tif(flag == 2) sum += (tree[ls].side[1] && L<=tree[ls].pos[1] && tree[rs].side[0] && R>=tree[rs].pos[0]);\n\treturn sum; \n}\nvoid prepare()//\u9884\u5904\u7406 \n{\n\tn=read() , m=read();\n\tBuild(1,1,n);\n\tChange(1,1,1) , Change(1,n,0);\n\t\n\tnow_list[1]='(' , now_list[n]=')';//\u539f\u59cb\u5b57\u4e32 \n\tfor(int i=2; i<n; i++) now_list[i]='X';\n\t\n\tmap['(']=1, map[')']=0, map['X']=2;//\u5efa\u7acb\u6620\u5c04\u5173\u7cfb \n\tmap1[1]='(',map1[0]=')',map1[2]='X';\n}\n//=============================================================\nsigned main()\n{\n\tprepare();\n\tfor(int i=1; i<=m; i++)\n\t{\n\t  int type=read(),value1,value2;\n\t  char value3;\n\t  if(type == 1) //\u4fee\u6539\u64cd\u4f5c \n\t  {\n\t  \tvalue1=read(); value3 = getchar();//\u8bfb\u5165\u9632\u5361 \n\t  \tgetchar();\n\t  \tif(now_list[value1] == value3) continue;\n\t  \tChange(1,value1,map[(int)(value3)]);\n\t  }\n\t  else //\u67e5\u8be2\u64cd\u4f5c \n\t  {\n\t  \tvalue1=read(), value2=read();\n\t\tprintf(\"%d\\n\",Inquiry(1,value1,value2));\n\t  }\n\t}\n}\n```\n\n\n\u5b8c\u6210\u4e86\u8fd9\u7bc7\u9898\u89e3 , \u8f66\u4e07\u4f17\u4fe1\u4ef0 $++$   \n~~\u4ec0\u4e48\u65f6\u5019\u6211\u4e5f\u80fd \u6210\u4e3aob\u4e00\u6837\u7684 \u795e\u4ed9\u98de\u673a\u4eba~~ \n\n---\n",
        "postTime": 1569759817,
        "uid": 186186,
        "name": "\u7075\u4e4c\u8def\u7a7a",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u4e1c\u65b9Project\u76f8\u5173\u8bd5\u9898\uff08Easy-Normal\uff09[1 / 30]\r\n\r\n\u672c\u9898\u662f\u4e00\u4e2a\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u6c42\u7b54\u6848\u7c7b\u578b\u7684\u9898\u76ee\uff0c\u8fd9\u79cd\u9898\u4e00\u822c\u90fd\u662f\u7528\u7ebf\u6bb5\u6811\u6765\u89e3\u51b3\r\n\r\n\u6240\u4ee5\u4e3b\u8981\u9700\u8981\u8003\u8651\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u54ea\u4e9b\u4fe1\u606f\uff0c\u4ee5\u53ca\u5982\u4f55pushup\r\n\r\n\u533a\u95f4\u6728\u68d2\u6bb5\u6570 $val$ \u662f\u8981\u6c42\u7684\u4e1c\u897f\uff0c\u80af\u5b9a\u8981\u7ef4\u62a4\r\n\r\n\u800c\u5408\u5e76\u4e24\u4e2a\u533a\u95f4\u65f6\uff0c\u4e2d\u95f4\u53ef\u80fd\u53ef\u4ee5\u4ea7\u751f\u4e00\u6bb5\u65b0\u7684\u6728\u68d2\r\n\r\n\u6761\u4ef6\u5c31\u662f\u5de6\u8fb9\u7684\u533a\u95f4\u6709\u4e00\u4e2a\u53ef\u7528\u7684\u5de6\u62ec\u53f7\uff0c\u5e76\u4e14\u5b83\u7684\u53f3\u8fb9\u90fd\u662f X\uff0c\u53f3\u8fb9\u7684\u533a\u95f4\u6709\u4e00\u4e2a\u53ef\u7528\u7684\u53f3\u62ec\u53f7\uff0c\u5b83\u7684\u5de6\u8fb9\u90fd\u662f X\r\n\r\n\u6240\u4ee5\uff0c\u8003\u8651\u8bb0\u5f55\u8fd9\u4e2a\u533a\u95f4\u5de6\u8fb9\u662f\u5426\u6709\u53ef\u7528\u62ec\u53f7 $pre$ \uff0c\u53f3\u8fb9\u662f\u5426\u6709\u53ef\u7528\u62ec\u53f7 $suf$\r\n\r\n\u4f46\u662f\u8fd9\u6837\u8fd8\u662f\u4e0d\u80fd\u76f4\u63a5\u7ef4\u62a4\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff1a\r\n\r\n~~~\r\n[(,X,X,X] \u4e0e [X,X,X,X] \u5408\u5e76\r\n~~~\r\n\r\n\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u533a\u95f4\u53f3\u8fb9\u662f\u5426\u6709\u53ef\u7528\u62ec\u53f7\uff0c\u53ea\u7531\u5b83\u7684\u53f3\u5b50\u533a\u95f4\u51b3\u5b9a\r\n\r\n\u4f46\u662f\u5728\u8fd9\u4e2a\u60c5\u51b5\u4e2d\uff0c\u5b83\u7684\u5de6\u5b50\u533a\u95f4\u6709\u53ef\u7528\u62ec\u53f7\uff0c\u800c\u4e14\u53f3\u5b50\u533a\u95f4\u90fd\u662f X\uff0c\u4f7f\u5f97\u8fd9\u4e2a\u533a\u95f4\u53f3\u8fb9\u4ecd\u7136\u6709\u53ef\u7528\u62ec\u53f7\r\n\r\n\u6240\u4ee5\u8fd8\u8981\u7ef4\u62a4\u8fd9\u4e2a\u533a\u95f4\u662f\u5426\u90fd\u4e3a X\uff0c$pure = 1$ \u8868\u793a\u662f\uff0c$pure = 0$ \u8868\u793a\u4e0d\u662f\r\n\r\n\u4ee3\u7801\uff1a\r\n\r\n```cpp\r\n#include <cstdio>\r\n#define ls (rt << 1)\r\n#define rs (rt << 1 | 1)\r\nint n,m;\r\n\r\nstruct node{\r\n\tint val,pre,suf,pure;//val\u8868\u793a\u8fd9\u4e2a\u533a\u95f4\u4e2d\u95f4\u6709\u591a\u5c11\u4e2a\u6728\u68d2,pure\u8868\u793a\u8fd9\u4e2a\u533a\u95f4\u662f\u5426\u90fd\u662fX \r\n}tree[200005 << 2];//pre\u8868\u793a\u8fd9\u4e2a\u533a\u95f4\u5de6\u8fb9\u662f\u5426\u662fXXXXX),suf\u8868\u793a\u8fd9\u4e2a\u533a\u95f4\u53f3\u8fb9\u662f\u5426\u662f(XXXX \r\n\r\nnode Merge(node x,node y){\r\n\tnode ans;\r\n\tans.pre = x.pre;\r\n\tif(x.pure) ans.pre |= y.pre;\r\n\tans.suf = y.suf;\r\n\tif(y.pure) ans.suf |= x.suf;\r\n\tans.pure = x.pure & y.pure;\r\n\tif(x.suf && y.pre){\r\n\t\tans.val = x.val + y.val + 1;\r\n\t}else{\r\n\t\tans.val = x.val + y.val;\r\n\t}\r\n\treturn ans;\r\n}\r\n\r\nvoid build(int rt,int l,int r){\r\n\tif(l == r){\r\n\t\tif(l == 1) tree[rt].suf = 1;\r\n\t\telse if(r == n) tree[rt].pre = 1;\r\n\t\telse tree[rt].pure = 1;\r\n\t\treturn;\r\n\t}\r\n\tint mid = l + r >> 1;\r\n\tbuild(ls,l,mid);\r\n\tbuild(rs,mid+1,r);\r\n\ttree[rt] = Merge(tree[ls],tree[rs]);\r\n}\r\n\r\nvoid upload(int rt,int l,int r,int id,char C){\r\n\tif(l == r){\r\n\t\ttree[rt] = {0,0,0,0};\r\n\t\tif(C == '(') tree[rt].suf = 1;\r\n\t\telse if(C == ')') tree[rt].pre = 1;\r\n\t\telse tree[rt].pure = 1;\r\n\t\treturn;\r\n\t}\r\n\tint mid = l + r >> 1;\r\n\tif(id <= mid){\r\n\t\tupload(ls,l,mid,id,C);\r\n\t}else{\r\n\t\tupload(rs,mid+1,r,id,C);\r\n    }\r\n\ttree[rt] = Merge(tree[ls],tree[rs]);\r\n}\r\n\r\nnode query(int rt,int l,int r,int L,int R){\r\n\tif(l == L && r == R){\r\n\t\treturn tree[rt];\r\n\t}\r\n\tint mid = l + r >> 1;\r\n\tif(R <= mid){\r\n\t\treturn query(ls,l,mid,L,R);\r\n\t}else if(L > mid){\r\n\t\treturn query(rs,mid+1,r,L,R);\r\n\t}else{\r\n\t\treturn Merge(query(ls,l,mid,L,mid),query(rs,mid+1,r,mid+1,R));\r\n\t}\r\n}\r\n\r\nint main(){\r\n\tscanf(\"%d%d\",&n,&m);\r\n\tbuild(1,1,n); \r\n\tint op;\r\n\tfor(int i = 1;i <= m;i++){\r\n\t\tscanf(\"%d\",&op);\r\n\t\tif(op == 1){\r\n\t\t\tint x;\r\n\t\t\tchar c;\r\n\t\t\tscanf(\"%d %c\",&x,&c);\r\n\t\t\tupload(1,1,n,x,c);\r\n\t\t}else{\r\n\t\t\tint l,r;\r\n\t\t\tscanf(\"%d%d\",&l,&r);\r\n\t\t    node ans = query(1,1,n,l,r);\r\n\t\t    printf(\"%d\\n\",ans.val);\r\n\t\t}\r\n\t}\r\n\treturn 0;\r\n}\r\n```\r\n",
        "postTime": 1586617347,
        "uid": 68344,
        "name": "\u79bb\u6563\u5c0f\u6ce2\u53d8\u6362\u00b0",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "### \u524d\u9762\u6240\u6709\u4eba\u90fd\u5199\u4e86\u7ebf\u6bb5\u6811\u9898\u89e3\uff0c\u6211\u6765\u5199\u4e2a\u5206\u5757\u7684\u3002\n\n\n\n### \u8ddf\u7ebf\u6bb5\u6811\u6bd4\u8d77\u6765\uff0c\u8fd9\u9898\u7528\u5206\u5757\u4f1a\u6162\u4e00\u70b9\uff0c\u4f46\u4ee3\u7801\u5f88\u597d\u7406\u89e3\uff0c\u5728\u7ec6\u8282\u7684\u5904\u7406\u4e0a\u6bd4\u7ebf\u6bb5\u6811\u5bb9\u6613\u7684\u591a\u3002\u6240\u4ee5\u5efa\u8bae\u5b66\u4f1a\u8fd9\u79cd\u89e3\u9898\u601d\u8def\uff0c\u5206\u5757\u53ef\u4ee5\u89e3\u51b3\u5f88\u591a\u7ebf\u6bb5\u6811\u5f88\u96be\u89e3\u51b3\u7684\u4e8b\u3002\n\n\n------------\n\n#### \u628a n \u4e2a\u70b9\u5206\u6210 sqrt(n) \u5757\uff0c\u7ef4\u62a4\u6bcf\u5757\u7684\u5b8c\u6574\u6728\u68d2\u6570\u91cf\uff0c\u662f\u5426\u6709\u5de6\u53f3\u5706\u5934\u3002\n\n#### \u7528\u5206\u5757\u601d\u60f3\u53ef\u4ee5\u5f88\u76f4\u63a5\u5f88\u7b80\u5355\u5730\u4fee\u6539\u6216\u67e5\u8be2\u3002\n\n#### \u5177\u4f53\u8bb2\u89e3\u5728\u4ee3\u7801\u4e2d\u3002\n\n\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<cmath>\n#define QWQ cout<<\"QwQ\"<<endl;\n#include<vector>\n#include<queue>\n#include<stack>\n#include<map>\nusing namespace std;\nconst int qwq=303030;\nconst int N=101010;\nconst int inf=0x3f3f3f3f;\n//\u5197\u957f\u7684\u65e5\u5e38\u7801\u524d\u64cd\u4f5c\uff1b\nint n,m;\nstruct K {\n\tint l,r;         //\u5de6\u53f3\u8fb9\u754c\uff1b\n\tbool zuo,you;    //\u662f\u5426\u6709\u5de6\u53f3\u5706\u5934\u6728\u68d2\uff1b\n\tint sum;         //\u5757\u4e2d\u6574\u4e2a\u7684\u6728\u68d2\u6570\uff1b\n} k[N];\nchar a[qwq];         //\u8bb0\u5f55\u6bcf\u4e00\u5757\u7684\u72b6\u6001\uff1b\nchar cz[3];          //\u7528\u5b57\u7b26\u4e32\u8bfb\u5165\uff0c\u5c31\u907f\u514d\u8bfb\u5165\u7a7a\u884c\u6216\u62ec\u53f7\u4e86\uff1b\nint t;\n\n\ninline K search(int x,int y) { //\u8bbf\u95ee\u5757\u4e2d\u4fe1\u606f\uff1b\n\tK res = (K) { x,y,0,0,0 };\n\tchar now = 0;   //now\u8bb0\u5f55\u6728\u68cd\u72b6\u6001\uff1b\n\tfor(int i=x; i<=y; i++) \n\t{\n\t\tif( a[i]=='(' )\n\t\tnow = '(';\n\t\tif( a[i]==')' ) \n\t\t{\n\t\t\tif(now== 0 ) res.zuo = 1; //\u5224\u65ad\u5411\u5de6\u5706\u5934\uff1b\n\t\t\tif(now=='(') res.sum++; //\u5b8c\u6574\u5757\uff1b\n\t\t\tnow = ')';\n\t\t}\n\t}\n\tif(now=='(')\n\tres.you = 1;   //\u5224\u65ad\u5411\u53f3\u5706\u5934\uff1b \n\treturn res;    //\u8fd4\u56de\u5757\u4e2d\u4fe1\u606f\uff1b\n}\n\ninline void change(int x,char z) {\n\ta[x] = z;\n\tfor(int i=1; i<=t; i++)\n\tif(x>=k[i].l && x<=k[i].r) //\u627e\u5230x\u6240\u5c5e\u5757\uff1b\n\t{ \n\t\tk[i] = search( k[i].l,k[i].r ); //\u4fee\u6539\u5757\u4e2d\u4fe1\u606f\uff1b\n\t\treturn ;\n\t}\n}\n\ninline int query(int x,int y) {\n\tint ans = 0;\n\tbool yuan = 0;     //\u662f\u5426\u6709\u5411\u53f3\u7684\u5706\u5934\uff1b\n\tfor(int i=1; i<=t; i++) \n\t{\n\t\tif(k[i].l<=x && y<=k[i].r)  //\u6574\u4e2a\u5728\u5757\u4e2d\uff1b\n\t\t{\n\t\t\tK res = search( x,y );\n\t\t\treturn res.sum;\n\t\t} \n\t\telse if(x>=k[i].l && x<=k[i].r) //\u5de6\u7aef\u5728\u5757\u4e2d\uff1b\n\t\t{ \n\t\t\tK res = search( x,k[i].r );\n\t\t\tans += res.sum;\n\t\t\tyuan = res.you;\n\t\t} \n\t\telse if(x<k[i].l && k[i].r<y) //\u5757\u5728\u8be2\u95ee\u533a\u95f4\u4e2d\uff1b\n\t\t{ \n\t\t\tans += k[i].sum;\n\t\t\tif( k[i].zuo && yuan ) ans++; //\u5de6\u53f3\u5bf9\u4e0a\uff1b\n\t\t\tif( (!k[i].sum) && (!k[i].you) && (!k[i].zuo) ) continue;\n\t\t\t//\u6ce8\u610f\u8fd9\u91cc\u6709\u4e00\u4e2a\u9677\u9631\uff1a\u5757\u4e2d\u5168\u4e3aX\uff08\u7a7a\u5757\uff09\u3002\n\t\t\t//\u5982\u679c\u4f60\u60f3\u8bb0\u5f55\u662f\u5426\u6709\u5411\u53f3\u5706\u5934,\u4e0d\u80fd\u7528\u8fd9\u4e2a\u7a7a\u5757\u6765\u4fee\u6539\uff1b\n\t\t\t//\u53ef\u4ee5\u8bc1\u660e\uff1a\u4e00\u4e2a\u5757\u5f53\u5b83\u65e2\u65e0\u5b8c\u6574\u6728\u68d2\u53c8\u65e0\u5411\u5de6\u5411\u53f3\u5706\u5934\u65f6\u4e3a\u7a7a\u5757\u3002 \n\t\t\tyuan = k[i].you;\n\t\t} \n\t\telse if(y>=k[i].l && y<=k[i].r) //\u53f3\u7aef\u5728\u5757\u4e2d\uff1b\n\t\t{ \n\t\t\tK res = search( k[i].l,y);\n\t\t\tans += res.sum;\n\t\t\tif( res.zuo && yuan) ans++;\n\t\t\treturn ans;\n\t\t}\n\t}\n\treturn ans;\n}\n\nint main() {\n\tint x,y;\n\tscanf(\"%d%d\",&n,&m);\n\t//\u5f00\u59cb\u5efa\u9020\u5206\u5757\uff1b\n\tt = sqrt(n);\n\tfor(int i=1; i<=t; i++) {\n\t\tk[i].l = k[i-1].r + 1;\n\t\tk[i].r = i * t;\n\t}\n\tif(k[t].r != n) {\n\t\tt++;\n\t\tk[t].l = k[t-1].r + 1;\n\t\tk[t].r = n;\n\t}\n\ta[1] = '(';\tk[1].you = 1;\n\ta[n] = ')';\tk[t].zuo = 1;\n\t//\u5de6\u53f3\u4e00\u6539\uff0c\u5efa\u9020\u5b8c\u6210\uff1b \n\twhile( m-- ) {\n\t\tscanf(\"%d\",&x);\n\t\tif(x==1) {\n\t\t\tscanf(\"%d%s\",&x,cz);\n\t\t\tchange( x,cz[0] );\n\t\t} else {\n\t\t\tscanf(\"%d%d\",&x,&y);\n\t\t\tprintf(\"%d\\n\", query(x,y) );\n\t\t}\n\t}\n\treturn 0;\n}\n\n```\n\n#### \u4ee3\u7801\u770b\u6765\u4f1a\u6709\u70b9\u957f\uff0c\u4e5f\u53ef\u80fd\u662f\u6211\u5199\u7684\u6709\u70b9\u7a00\uff0c\u538b\u538b\u884c\u5c31\u663e\u5f97\u77ed\u4e86\uff1b\n\n\n#### ~~\u5176\u5b9e\u4e5f\u633a\u597d\u5199\u7684\u5bf9\u5427~~\uff0c\u53ea\u8981\u6ce8\u610f\u5230\u4e00\u4e9b\u7ec6\u8282\u3002",
        "postTime": 1553174262,
        "uid": 102726,
        "name": "Flandre_495",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u6211\u7528\u7684\u662f\u4e00\u4e2a\u901a\u4fd7\u6613\u61c2\uff0c\u5bb9\u6613\u7406\u89e3\u7684\u65b9\u6cd5\u3002\n\n\u4e00\u4e2a\u533a\u95f4\uff0c\u8bb0\u5f55\u5b83\u80fd\u5408\u6210\u7684\u6728\u68d2\u6570\uff0c\u6700\u5de6\u8fb9\u7684\u62ec\u53f7\u662f\u4ec0\u4e48\u62ec\u53f7\uff0c\u6700\u53f3\u8fb9\u7684\u62ec\u53f7\u662f\u4ec0\u4e48\u62ec\u53f7\u3002\n\n\u5bb9\u6613\u63a8\u51fa\u3002\n\n\u4e00\u4e2a\u533a\u95f4\u7684\u5408\u6210\u6728\u68d2\u6570\u7b49\u4e8e\u5de6\u8fb9\u7684\u6728\u68d2\u6570 + \u53f3\u8fb9\u7684\u6728\u68d2\u6570\n\n\u5982\u679c\u5b83\u7684\u5de6\u533a\u95f4\u7684\u6700\u53f3\u8fb9\u62ec\u53f7\u662f\u5de6\u62ec\u53f7\u5e76\u4e14\u53f3\u533a\u95f4\u7684\u6700\u5de6\u62ec\u53f7\u662f\u53f3\u62ec\u53f7\uff0c\u5c31\u53ef\u4ee5\u5408\u6210\u4e00\u6839\u65b0\u7684\u6728\u68d2\u3002\n\n\u4e00\u4e2a\u65b0\u7684\u533a\u95f4\u7684\u53f3\u8fb9\u7684\u62ec\u53f7\u662f\u53f3\u8fb9\u533a\u95f4\u7684\u6709\u62ec\u53f7\u6216\u8005\u662f\u5de6\u8fb9\u533a\u95f4\u7684\u53f3\u62ec\u53f7\uff08\u56e0\u4e3a\u53ef\u80fd\u53f3\u8fb9\u533a\u95f4\u5168\u662fX\uff09\u5de6\u8fb9\u62ec\u53f7\u540c\u7406\n\ntalk is cheap,show you the code\n\n```cpp\n#include <cstdio>\n#define lson rt << 1\n#define rson rt << 1 | 1\nusing namespace std;\nconst int M = 200000;\nstruct tree{\n\tint flag;\n\tint flag_1;\n\tint date;\n}st[M << 2];\nint n,m;\nvoid pushup(int rt){\n\tst[rt].date = st[lson].date + st[rson].date;\n\tif(st[lson].flag_1 == 1 && st[rson].flag == 2){\n\t\tst[rt].date ++;\n\t}\n\tif(st[rson].flag_1 != 0){\n\t\tst[rt].flag_1 = st[rson].flag_1;\n\t}\n\telse{\n\t\tif(st[lson].flag_1 != 0)\n\t\t\tst[rt].flag_1 = st[lson].flag_1;\n\t\telse{\n\t\t\tst[rt].flag_1 = 0;\n\t\t}\n\t}\n\tif(st[lson].flag != 0){\n\t\tst[rt].flag = st[lson].flag;\n\t}\n\telse{\n\t\tif(st[rson].flag != 0)\n\t\t\tst[rt].flag = st[rson].flag;\n\t\telse\n\t\t\tst[rt].flag = 0;\n\t}\n}\nvoid build(int rt,int l,int r){\n\tif(l == r){\n\t\tif(l == 1){\n\t\t\tst[rt].flag = 1;\n\t\t\tst[rt].flag_1 = 1;\n\t\t}\n\t\tif(l == n){\n\t\t\tst[rt].flag = 2;\n\t\t\tst[rt].flag_1 = 2;\n\t\t}\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(lson,l,mid);\n\tbuild(rson,mid + 1,r);\n\tpushup(rt);\n}\ntree ask(int l,int r,int l_1,int r_1,int rt){\n\tif(l_1 <= l && r <= r_1){\n\t\treturn st[rt];\n\t}\n\tint mid = (l + r) >> 1;\n\tif(r_1 <= mid) return ask(l,mid,l_1,r_1,lson);\n\tif(l_1 > mid) return ask(mid + 1,r,l_1,r_1,rson);\n\ttree L = ask(l,mid,l_1,r_1,lson),R = ask(mid + 1,r,l_1,r_1,rson),res;\n\tres.date = L.date + R.date;\n\tif(L.flag_1 == 1 && R.flag == 2){\n\t\tres.date ++;\n\t}\n\tif(R.flag_1 != 0){\n\t\tres.flag_1 = R.flag_1;\n\t}\n\telse{\n\t\tif(L.flag_1 != 0)\n\t\t\tres.flag_1 = L.flag_1;\n\t\telse{\n\t\t\tres.flag_1 = 0;\n\t\t}\n\t}\n\tif(L.flag != 0){\n\t\tres.flag = L.flag;\n\t}\n\telse{\n\t\tif(R.flag != 0)\n\t\t\tres.flag = R.flag;\n\t\telse\n\t\t\tres.flag = 0;\n\t}\n\treturn res;\n}\nvoid update(int p,int l,int r,int x,int rt){\n\tif(l == r && l == p){\n\t\tif(x == 1){\n\t\t\tst[rt].flag = st[rt].flag_1 = 1;\n\t\t}\n\t\tif(x == 2){\n\t\t\tst[rt].flag = st[rt].flag_1 = 2;\n\t\t}\n\t\tif(x == 0){\n\t\t\tst[rt].flag = st[rt].flag_1 = 0;\n\t\t}\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tif(p <= mid) update(p,l,mid,x,lson);\n\tif(p > mid) update(p,mid + 1,r,x,rson);\n\tpushup(rt);\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tbuild(1,1,n);\n\t/*for(int i = 1;i <= n << 1;i ++){\n\t\tprintf(\"%d %d |\",st[i].flag,st[i].flag_1);\n\t}*/\n\tfor(int i = 1;i <= m;i ++){\n\t\tint x;\n\t\tscanf(\"%d\",&x);\n\t\tif(x == 2){\n\t\t\tint l,r;\n\t\t\tscanf(\"%d%d\",&l,&r);\n\t\t\tprintf(\"%d\\n\",ask(1,n,l,r,1).date);\n\t\t}\n\t\telse{\n\t\t\tint l;\n\t\t\tchar c;\n\t\t\tscanf(\"%d\",&l);\n\t\t\tc = getchar();\n\t\t\tc = getchar();\n\t\t\tif(c == '('){\n\t\t\t\tupdate(l,1,n,1,1);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(c == ')'){\n\t\t\t\t\tupdate(l,1,n,2,1);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tupdate(l,1,n,0,1);\n\t\t\t\t}\n\t\t\t}\n\t\t/*\tfor(int i = 1;i <= n << 1;i ++){\n\t\t\t\tprintf(\"%d %d |\",st[i].flag,st[i].flag_1);\n\t\t\t}*/\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1567816299,
        "uid": 54135,
        "name": "king_more",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\n\u849f\u84bb\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\uff0c\u8f7b\u55b7\u3002\n\n\u9996\u5148\u611f\u8c22\u6765\u81eaking_more\u7684\u9898\u89e3\u4e2d\u5173\u4e8equery\u51fd\u6570\u4e2d\u4e00\u4e9b\u5c0f\u7ec6\u8282\u7684\u5c0f\u7075\u611f\u3002\n\n\u7136\u800c\u4e0d\u540c\u7684\u662f\uff0c\u6211\u7528\u7684\u662f\u4e00\u79cd\u5341\u5206\u901a\u4fd7\u6613\u61c2\uff0c\u975e\u5e38\u5bb9\u6613\u7406\u89e3\u7684\u65b9\u6cd5\uff0c\u5e76\u4e14\u5728\u7a0b\u5e8f\u4e2d\u52a0\u5165\u4e86\u8bb8\u591a\u8d85\u7ea7\u52a9\u4e8e\u7406\u89e3\u7684\u6ce8\u91ca\u3002\n\n\n**~~\u663e\u7136\uff0c\u8fd9\u662f\u4e00\u9053\u7ebf\u6bb5\u6811~~**\n\n**\u6211\u4eec\u7684\u533a\u95f4\u957f\u8fd9\u6837\uff1a**\n```cpp\nstruct tree{\n\tint sum;\n\tint lx,rx;\n\t//lx=1: )...  lx=0:  ....  lx=-1: (...\n\t//rx=1: ...(  rx=0:  ....  rx=-1: ...)\n}tr[MaxN<<2];\n```\n**\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9\u4e0a\u7684\u533a\u95f4\uff0c\u6211\u4eec\u90fd\u7528sum\u6765\u50a8\u5b58\u8be5\u533a\u95f4\u4e2d\u7684\u5b8c\u6574\u6728\u68d2\u6570\uff0c\u7528lx\u50a8\u5b58\u8be5\u533a\u95f4\u4e2d\u6700\u9760\u5de6\u7684\u6709\u6548\u6728\u68d2\u79cd\u7c7b\uff08rx\u540c\u7406\uff09**\n\n**\u90a3\u4e48~~\u95ee\u9898\u6765\u4e86~~\uff0c\u4ec0\u4e48\u662f\u6709\u6548\u6728\u68d2\u5462\uff1f\u901a\u8fc7\u5206\u6790\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u6211\u4eec\u5728\u8ba1\u7b97\u6728\u68d2\u6570\u91cf\u65f6\uff0c\u2018X\u2019\u578b\u6728\u68d2\u5176\u5b9e\u65f6\u53ef\u4ee5\u5ffd\u7565\u7684\uff0c\u53ea\u6709\u2018\uff08\u2019\u4e0e\u2018\uff09\u2019\u578b\u6728\u68d2\u624d\u80fd\u5bf9\u6211\u4eec\u7684\u7ed3\u679c\u9020\u6210\u5f71\u54cd\u3002\u6240\u4ee5\u6211\u4eec\u5c06\u2018\uff08\u2019\u4e0e\u2018\uff09\u2019\u578b\u6728\u68d2\u6210\u4e3a\u6709\u6548\u6728\u68d2\uff0c\u5177\u4f53\u5982\u4f55\u50a8\u5b58\u8be6\u89c1\u4ee3\u7801\u6ce8\u91ca\u3002**\n\n**\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u56de\u6eaf\u540eupdate\u65f6\u53ef\u4ee5\u6709\u4ee5\u4e0b\u7684\u65b9\u7a0b\uff1a**\n\n```\n tr[k].sum=tr[ls].sum+tr[rs].sum+(tr[ls].rx==1 && tr[rs].lx==1)\n```\n\n\n\u4ee5\u4e0a\u6838\u5fc3\u601d\u60f3\n\nquery\u51fd\u6570\u4e2d\u601d\u60f3\u57fa\u672c\u76f8\u540c\uff0c\u4f46\u8fd8\u6709\u4e00\u4e9b\u975e\u5e38\u91cd\u8981\u7684\u795e\u5947\u5c0f\u7ec6\u8282\u9700\u8981\u6ce8\u610f\n\n\u8fd8\u662f\u8ba9\u6211\u4eec\u7528~~\u795e\u5947\u53c8\u4f1f\u5927\u7684C++~~\u4ee3\u7801\u6765\u89e3\u91ca\u5b83\u5427\n\n\u6d77\u91cf\u6ce8\u91ca\u4efb\u541b\u6d88\u5316\n```cpp\n#include <iostream>\n#define MaxN 200001\n#define fangbian int m=l+r>>1,ls=k<<1,rs=k<<1|1\nusing namespace std;\nstruct tree{\n\tint sum;\n\tint lx,rx;\n\t//lx=1: )...  lx=0:  ....  lx=-1: (...\n\t//rx=1: ...(  rx=0:  ....  rx=-1: ...)\n}tr[MaxN<<2];\nint pos,x,y,n;\nbool lc,rc;\nchar op;\nvoid build(int k,int l,int r){\n\tfangbian;\n\tif(l==1){tr[k].lx=-1;tr[k].rx=1;}\n\telse if(r==n){tr[k].lx=1;tr[k].rx=-1;}\n\tif(l==r)return;\n\tbuild(ls,l,m);\n\tbuild(rs,m+1,r);\n}\nvoid cg(int k,int l,int r){\n\tif(l==r){//\u5355\u70b9\u4fee\u6539\uff0c\u4e0d\u89e3\u91ca \n\t\tif(op=='('){tr[k].lx=-1;tr[k].rx=1;}\n\t\telse if(op==')'){tr[k].lx=1;tr[k].rx=-1;}\n\t\telse{tr[k].lx=0;tr[k].rx=0;}\n\t\treturn;\n\t}\n\tfangbian;\n\t//\u5f80\u4e0b\u627e \n\tif(pos<=m)\n\t\tcg(ls,l,m);\n\telse if(m<pos)\n\t\tcg(rs,m+1,r);\n\t//\u66f4\u65b0\u8be5\u533a\u95f4\u7684sum,\u82e5\u4e24\u533a\u95f4\u4e4b\u95f4\u80fd\u5408\u5e76\u51fa\u4e00\u4e2a\u5b8c\u6574\u6728\u68d2\u5219sum++ \n\ttr[k].sum=tr[ls].sum+tr[rs].sum+(tr[ls].rx==1 && tr[rs].lx==1);\n\t//\u82e5\u5de6\u5b50\u533a\u95f4\u975e\u7a7a,\u5219\u7528\u5de6\u5b50\u533a\u95f4\u7684\u5de6\u7aef\u6728\u68d2\u66f4\u65b0\u8be5\u533a\u95f4\u7684\u5de6\u7aef,\u5426\u5219\u7528\u53f3\u5b50\u533a\u95f4\u7684\u5de6\u7aef.\n\t//\u66f4\u65b0\u8be5\u533a\u95f4\u7684\u53f3\u7aef\u540c\u7406.\n\t//\u82e5\u4e24\u533a\u95f4\u90fd\u662f\u7a7a\u7684\u4e5f\u6ca1\u5173\u7cfb,\u53cd\u6b63\u66f4\u65b0\u5b8c\u4e86\u4e5f\u90fd\u662f\u7a7a\u7684. \n\ttr[k].lx=tr[ls].lx?tr[ls].lx:tr[rs].lx;\n\ttr[k].rx=tr[rs].rx?tr[rs].rx:tr[ls].rx;\n}\ntree query(int k,int l,int r){//\u533a\u95f4\u67e5\u627e \n\tif(x<=l && r<=y)return tr[k];//\u627e\u5230\u533a\u95f4\uff0c\u8fd4\u56de\u8be5\u533a\u95f4 \n\tfangbian;\n\t//\u4e0d\u5206\u53c9\u7684\u60c5\u51b5 \n\tif(m<x)return query(rs,m+1,r);\n\telse if(y<=m)return query(ls,l,m);\n\t\n\t//\u5206\u53c9\u7684\u60c5\u51b5 \n\ttree L=query(ls,l,m);//\u8be5\u5206\u53c9\u4e2d\u7684\u5de6\u534a\u533a\u95f4 \n\ttree R=query(rs,m+1,r);//\u8be5\u5206\u53c9\u4e2d\u7684\u53f3\u534a\u533a\u95f4 \n\ttree finl;//L+R\uff0c\u5373\u5b8c\u6574\u7684\u533a\u95f4\uff0c\u4fdd\u8bc1\u8be5\u533a\u95f4\u7edd\u5bf9\u88ab[x,y](\u5373\u8981\u67e5\u627e\u7684\u7b54\u6848\u533a\u95f4)\u5305\u542b \n\t//\u63a5\u4e0b\u6765\u5373\u4e3a\u5408\u5e76L,R\u4e3afinl\u7684\u64cd\u4f5c\n\tfinl.sum=L.sum+R.sum+(L.rx==1 && R.lx==1);//\u5408\u5e76sum\n   //\u66f4\u65b0lx\u4e0erx\n\tfinl.lx=L.lx?L.lx:R.lx;\n\tfinl.rx=R.rx?R.rx:L.rx;\n\treturn finl;\n}\nint main(){\n\tint m;\n\tcin>>n>>m;\n\tbuild(1,1,n);\n\ttr[1].lx=-1;\n\ttr[1].rx=-1;\n\ttr[1].sum=1;\n\twhile(m--){\n\t\tint mode;\n\t\tcin>>mode;\n\t\tif(mode==1){\n\t\t\tcin>>pos>>op;\n\t\t\tcg(1,1,n);\n\t\t}\n\t\telse{\n\t\t\tcin>>x>>y;\n\t\t\tcout<<query(1,1,n).sum<<endl;\n\t\t}\n\t}\n}\n```\n",
        "postTime": 1569068039,
        "uid": 249736,
        "name": "Seg_Tree",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u9996\u5148\u770b\u52302e5\u7684\u6570\u636e\u89c4\u6a21,\u6beb\u65e0\u7591\u95ee\u6211\u4eec\u9700\u8981\u4e00\u4e2anlogn\u7ea7\u522b\u7684\u7b97\u6cd5~~\u8d70\u5f00!\u5206\u5757\u90aa\u6559\uff01~~     \n\u8fd9\u65f6\u5019\u5f53\u7136\u8981\u8bf7\u51fa\u4e07\u80fd\u7684\u7ebf\u6bb5\u6811\u4e86\uff01  \n\n\u6211\u4eec\u53d1\u73b0\u6bcf\u6839\u6728\u68d2\u53ea\u7531\u5de6\u62ec\u53f7\u548c\u53f3\u62ec\u53f7\u7ec4\u6210   \n\u800c\u663e\u800c\u6613\u89c1\uff0c\u6bcf\u6b21\u5408\u5e76\u53ea\u4f1a\u4ea7\u751f\u4e00\u6839\u6728\u68d2\uff08\u6728\u68d2\u4e0d\u80fd\u5305\u542b\uff09   \n\u63a8\u5bfc\u53ef\u77e5\uff0c**\u6700\u5de6\u8fb9\u7684\u53f3\u62ec\u53f7** \u548c **\u6700\u53f3\u8fb9\u7684\u5de6\u62ec\u53f7** \u6700\u53ef\u80fd\u5408\u5e76\u6210\u4e00\u6839\u6728\u68d2   \n(\u5982\u679c\u4ea7\u751f\u6728\u68d2\uff0c\u4e00\u5b9a\u548c\u8fd9\u4e24\u4e2a\u62ec\u53f7\u6709\u5173)  \n\uff08\u5982\u679c\u8fd9\u4e24\u4e2a\u62ec\u53f7\u90fd\u4e0d\u80fd\u4ea7\u751f\u6728\u68d2\uff0c\u5219\u4e00\u5b9a\u4e0d\u4ea7\u751f\u65b0\u7684\u6728\u68d2\uff09  \n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e09\u4e2a\u503c\uff1a  \nsum\uff08\u672c\u533a\u95f4\u6728\u68cd\u6570\u91cf\uff09  \nlsum\uff08\u6700\u9760\u5de6\u7684\u53f3\u62ec\u53f7 \uff09  \nrsum\uff08\u6700\u9760\u53f3\u7684\u5de6\u62ec\u53f7\uff09   \n\n\u8be6\u7ec6\u5408\u5e76\u8fc7\u7a0b\u89c1\u4ee3\u7801\u6ce8\u91ca    \n\n```cpp\n#include<bits/stdc++.h>\n#define lc (p<<1)\n#define rc (p<<1|1)\nusing namespace std;\nstruct node{\n\tint l,r,sum,lsum,rsum;//rsum:\u6700\u9760\u53f3\u7684\u5de6\u62ec\u53f7      lsum:\u6700\u9760\u5de6\u7684\u53f3\u62ec\u53f7 \n}T[800010];\nint n,m;\nvoid pushup(int p){ \n    if(T[lc].lsum)T[p].lsum=T[lc].lsum;//\u5982\u679c\u6709\u6700\u9760\u5de6\u7684\u53f3\u62ec\u53f7,\u81ea\u7136\u5e94\u8be5\u4fdd\u7559 \n    else if(!T[lc].sum&&!T[lc].rsum)T[p].lsum=T[rc].lsum;//\u5de6\u533a\u95f4\u5168\u662fX,\u4fdd\u8bc1\u53f3\u533a\u95f4\u7684\u53f3\u62ec\u53f7\u80fd\u8fdb\u884c\u5339\u914d(\u4e0d\u4f1a\u88ab\u5176\u4ed6\u62ec\u53f7\u6321\u4f4f) \n\telse T[p].lsum=0;\n    if(T[rc].rsum)T[p].rsum=T[rc].rsum;//\u540c\u4e0a \n    else if(!T[rc].sum&&!T[rc].lsum)T[p].rsum=T[lc].rsum;//\u53f3\u533a\u95f4\u5168\u662fX\n    else T[p].rsum=0;\n    T[p].sum=T[lc].sum+T[rc].sum+(T[lc].rsum&&T[rc].lsum);//\u5982\u679c\u5de6\u533a\u95f4\u6709\u53ef\u5339\u914d\u7684\u5de6\u62ec\u53f7\u5e76\u4e14\u53f3\u533a\u95f4\u540c\u7406\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5408\u5e76\u6210\u65b0\u7684\u6728\u68d2\uff0c\u8868\u8fbe\u5f0f\u8fd4\u56de\u503c1 \n}\nvoid build(int p,int l,int r){\n\tT[p].l=l;T[p].r=r;\n\tif(p==1)T[p].sum=1;//\u521d\u59cb\u6728\u68cd \n\telse{\n\t\tif(l==1)T[p].rsum=1;//\u521d\u59cb\u5316\u5de6\u53f3\u62ec\u53f7 \n\t\tif(r==n)T[p].lsum=n;\n\t}\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tbuild(lc,l,mid);\n\tbuild(rc,mid+1,r);\n\t//\u4e3a\u4ec0\u4e48\u5efa\u6811\u7684\u65f6\u5019\u4e0dpushup?\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u7279\u5224\u8d4b\u4e88\u4e86\u4fe1\u606f \n\t//pushup(p);\n}\nvoid update(int p,int q,int v){\n\tif(T[p].l==T[p].r&&T[p].l==q){//\u4fee\u6539lsum\u4e0ersum\u7684\u4f4d\u7f6e \n\t\tif(v==1)T[p].lsum=0,T[p].rsum=q;\n\t\tif(v==2)T[p].lsum=0,T[p].rsum=0;\n\t\tif(v==3)T[p].lsum=q,T[p].rsum=0;\n\t\treturn;\n\t}\n\tint mid=(T[p].l+T[p].r)>>1;\n\tif(q<=mid)update(lc,q,v);\n\tif(q>mid)update(rc,q,v);\n    pushup(p);\n}\nint query(int p,int ql,int qr){\n\tif(ql<=T[p].l&&T[p].r<=qr)\n\t\treturn T[p].sum;\n    int mid=(T[p].l+T[p].r)>>1,ans=0;\n    if(ql<=mid)ans+=query(lc,ql,qr);\n    if(qr>mid)ans+=query(rc,ql,qr);\n    ans+=(ql<=T[lc].rsum&&T[lc].rsum<=qr)&&(ql<=T[rc].lsum&&T[rc].lsum<=qr);\n    //\u8868\u8fbe\u5f0f\u610f\u4e49:\u5982\u679c\u5de6\u533a\u95f4\u7684\u53f3\u62ec\u53f7\u5728\u533a\u95f4\u5185&&\u53f3\u533a\u95f4\u7684\u5de6\u62ec\u53f7\u5728\u533a\u95f4\u5185,\u5408\u5e76\u65b0\u6728\u68cd,ans+1 \n    return ans;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tbuild(1,1,n);\n\twhile(m--){\n\t\tint t;\n\t\tscanf(\"%d\",&t);\n\t\tif(t==1){\n\t\t\tint q;char ch;\n\t\t\tscanf(\"%d%c\",&q,&ch);\n\t\t\twhile(ch!='('&&ch!=')'&&ch!='X')ch=getchar();//\u9632\u6b62\u8be1\u5f02\u9519\u8bef \n\t\t\tif(ch=='(')update(1,q,1);\n\t\t\tif(ch=='X')update(1,q,2);\n\t\t\tif(ch==')')update(1,q,3);\n\t\t}\n        if(t==2){\n        \tint p,q;\n        \tscanf(\"%d%d\",&p,&q);\n        \tprintf(\"%d\\n\",query(1,p,q));\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1565494601,
        "uid": 138543,
        "name": "\u6597\u795e_\u541b\u83ab\u7b11",
        "ccfLevel": 0,
        "title": "P3797  \u7ebf\u6bb5\u6811-1"
    },
    {
        "content": "\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u6bb5\u533a\u95f4\u5411\u5de6\u6709\u6ca1\u6709\u5f00\u53e3\uff0c\u5411\u53f3\u6709\u6ca1\u6709\u5f00\u53e3\uff0c\u4ee5\u53ca\u662f\u5426\u8d2f\u901a(\u5168\u662fX),\u5305\u542b\u51e0\u6bb5\u5b8c\u6574\u6728\u68d2\n\n\u5982XXX)XXX\uff0c\u5c31\u53ea\u6709\u5411\u5de6\u5f00\u53e3\uff0c\u6ca1\u6709\u5411\u53f3\u5f00\u53e3\n\n\u7136\u540e\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u5373\u53ef\u3002\n\n\u5177\u4f53\u5408\u5e76\u7684\u65b9\u6cd5\u89c1\u4ee3\u7801:\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define lson (rt<<1)\n#define rson (rt<<1|1)\n#define mid (l+r>>1) \nusing namespace std;\nint n,m; \nstruct node\n{\n    bool l,r,p;\n    int num;\n    node(){}\n    node(int l_,int r_,int p_){\n        l=l_,r=r_,p=p_;num=0; \n    }\n}tree[800011];\nnode merge(const node& a,const node& b)\n{\n    node res;\n    res.p=a.p&b.p;\n    res.l=a.p?b.l:a.l;\n    res.r=b.p?a.r:b.r;\n    res.num=a.num+b.num;\n    if(a.r&&b.l&&!a.p&&!b.p)res.num++;\n    return res;\n}\nvoid pushup(int rt)\n{\n    tree[rt]=merge(tree[lson],tree[rson]); \n}\nvoid modify(int rt,int l,int r,int x,int type)\n{\n    if(l==r)\n    {\n        if(type==0)tree[rt]=node(1,0,0);\n        else if(type==1)tree[rt]=node(0,1,0);\n        else tree[rt]=node(1,1,1);\n        return;\n    }\n    if(x<=mid)modify(lson,l,mid,x,type);\n    else modify(rson,mid+1,r,x,type);\n    pushup(rt);\n}\nnode query(int rt,int l,int r,int L,int R)\n{\n    if(L<=l&&r<=R)return tree[rt];\n    if(mid+1>R)return query(lson,l,mid,L,R);\n    if(L>mid)return query(rson,mid+1,r,L,R);\n    return merge(query(lson,l,mid,L,R),query(rson,mid+1,r,L,R));\n}\nvoid build(int rt,int l,int r)\n{\n    if(l==r)\n    {\n        if(l==1)tree[rt]=node(0,1,0);\n        else if(l==n)tree[rt]=node(1,0,0);\n        else tree[rt]=node(1,1,1);\n        tree[rt].num=0;\n        return;\n    }\n    build(lson,l,mid);\n    build(rson,mid+1,r);\n    pushup(rt); \n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    build(1,1,n);\n    while(m--)\n    {\n        int type;\n        scanf(\"%d\",&type);\n        if(type==1)\n        {\n            int x;char c;int t;\n            scanf(\"%d %c\",&x,&c);\n            if(c=='X')t=2;\n            else if(c==')')t=0;\n            else t=1;\n            modify(1,1,n,x,t); \n        }else\n        {\n            int l,r;\n            scanf(\"%d%d\",&l,&r);\n            printf(\"%d\\n\",query(1,1,n,l,r).num);\n        }\n    } \n    return 0;\n}\n```",
        "postTime": 1496932932,
        "uid": 20322,
        "name": "orangebird",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u5206\u7c7b\u8ba8\u8bba\u590d\u5065\u5fc5\u505a\u9898\uff08\u5927\u96fe\u3002\n\n\u7ecf\u5178\u533a\u95f4\u62ec\u53f7\u5339\u914d\u6570\u7684\u5f31\u5316\u7248\uff0c\u4e0d\u8fc7\u5728\u67d0\u79cd\u610f\u4e49\u4e0a\u6709\u52a0\u5f3a\uff0c\u7ec6\u8282\u6709\u70b9\u591a\uff08\n\n\u56e0\u4e3a\u662f\u5f31\u5316\u7248\uff0c\u62ec\u53f7\u4e2d\u5305\u542b\u7684\u62ec\u53f7\u662f\u4e0d\u8ba1\u6570\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u5f53\u524d\u533a\u95f4 $[L,R]$ \u6700\u5de6\u8fb9\u7684\u53f3\u62ec\u53f7\u548c\u6700\u53f3\u8fb9\u7684\u5de6\u62ec\u53f7\uff0c\u4ee5\u53ca\u533a\u95f4\u5185 $X$ \u7684\u4e2a\u6570\uff0c\u8fd8\u6709\u5c31\u662f\u5f53\u524d\u533a\u95f4\u5339\u914d\u7684\u62ec\u53f7\u6570\uff08\u5373\u9898\u76ee\u4e2d\u6240\u79f0\u7684\u6728\u68d2\uff09\u3002\n\n$\\mathrm{pushup}$ \u65f6\u5206\u522b\u5904\u7406\u4e24\u79cd\u60c5\u51b5\u5373\u53ef\u3002\n\n- \u5de6\u533a\u95f4\u6700\u5de6\u62ec\u53f7\u4e3a\u5de6\u62ec\u53f7\uff0c\u53f3\u533a\u95f4\u6700\u5de6\u62ec\u53f7\u4e3a\u53f3\u62ec\u53f7\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u9700\u8981\u8fd9\u4e24\u4e2a\u62ec\u53f7\u95f4\u5168\u90e8\u90fd\u4e3a $X$\u3002\n\n- \u5de6\u533a\u95f4\u6700\u53f3\u62ec\u53f7\u4e3a\u5de6\u62ec\u53f7\uff0c\u53f3\u533a\u95f4\u6700\u5de6\u62ec\u53f7\u4e3a\u53f3\u62ec\u53f7\u3002\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u76f4\u63a5\u5339\u914d\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u65f6\uff0c\u5c06\u5339\u914d\u8fc7\u7684\u6700\u5de6\u3001\u6700\u53f3\u62ec\u53f7\u7f6e\u4e3a\u7a7a\u3002\u5e76\u4e14\u6ce8\u610f\u8fd9\u4e24\u79cd\u60c5\u51b5\u5728\u5f53\u524d\u533a\u95f4\u957f\u5ea6\u4e3a $2$ \u65f6\u53ef\u80fd\u540c\u65f6\u88ab\u8ba1\u6570\uff0c\u56e0\u4e3a\u5b9e\u9645\u4e0d\u5b58\u5728\u8fd9\u79cd\u60c5\u51b5\uff0c\u800c\u53c8\u88ab\u8ba1\u6570\u4e86\u4e24\u904d\uff0c\u6240\u4ee5\u9700\u8981\u53ea\u8ba1\u6570\u5176\u4e2d\u4e00\u79cd\u60c5\u51b5\u3002\n\n```cpp\n#include<cstdio>\n#define ls p<<1\n#define rs p<<1|1\nstruct state {int l,r,res,sum; char lb,rb;}f[800005];\nchar s[2],a[200005];\ninline int max(const int &x,const int &y) {return x>y? x:y;}\ninline int min(const int &x,const int &y) {return x<y? x:y;}\ninline const state& merge(state &des,const state &x,const state &y) {\n\tif(x.lb!='('&&x.lb!=')') {des.lb=y.lb;} else {des.lb=x.lb;}\n\tif(y.rb!='('&&y.rb!=')') {des.rb=x.rb;} else {des.rb=y.rb;} \n\tdes.sum=x.sum+y.sum; des.res=x.res+y.res;\n\tif(x.rb=='('&&y.lb==')') {++des.res;} \n\telse if(des.sum==des.r-des.l-1&&x.lb=='('&&y.rb==')') {des.lb=des.rb='X';++des.res;}\n\treturn des;\n}\ninline void pushup(int p) {merge(f[p],f[ls],f[rs]);}\ninline void build(int p,int l,int r) {f[p].l=l; f[p].r=r; if(l==r) {f[p].sum=(a[l]=='X');f[p].lb=f[p].rb=a[l];return;} int mid=l+r>>1; build(ls,l,mid); build(rs,mid+1,r); pushup(p);}\ninline void change(int p,int l,int r,int x,char op) {if(l==r) {f[p].sum=(op=='X');f[p].lb=f[p].rb=op;return;} int mid=l+r>>1; if(x<=mid) change(ls,l,mid,x,op); else change(rs,mid+1,r,x,op); pushup(p);}\ninline state ask(int p,int l,int r,int L,int R) {\n\tif(L<=l&&r<=R) return f[p];\n\tint mid=l+r>>1; state res=(state){max(l,L),min(R,r),0,0,0,0};\n\tif(L>mid) return ask(rs,mid+1,r,L,R);\n\tif(R<=mid) return ask(ls,l,mid,L,R);\n\treturn merge(res,ask(ls,l,mid,L,mid),ask(rs,mid+1,r,mid+1,R));//L<=mid&&R>mid\n}\nint main() {\n\tint n,m; scanf(\"%d%d\",&n,&m); \n\tfor(register int i=2;i<n;++i) a[i]='X'; a[1]='('; a[n]=')'; build(1,1,n); \n\tfor(register int t=1;t<=m;++t) {\n\t\tint op; scanf(\"%d\",&op);\n\t\tif(op==1) {int x; scanf(\"%d%s\",&x,s); change(1,1,n,x,s[0]);}\n\t\telse {int l,r; scanf(\"%d%d\",&l,&r); printf(\"%d\\n\",ask(1,1,n,l,r).res);}\n\t}\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1603181173,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "**\u535a\u5ba2[\u4f20\u9001\u95e8](http://www.wjyyy.top/798.html)**\n## \u9898\u89e3\uff1a\n\n\u00a0 \u00a0\u8868\u9762\u770b\u4e0a\u53bb\u662f\u4e00\u4e2a**\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2**\u7684\u7ebf\u6bb5\u6811\uff0c\u53ef\u662f\u7ef4\u62a4\u6728\u68cd\u4e2a\u6570\u662f\u4e2a\u95ee\u9898\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u5982\u679c\u628a\u6728\u68cd\u770b\u4f5c\u7ebf\u6bb5\u6811\u7684\u533a\u95f4\uff0c\u800c\u62fc\u51fa\u6765\u7684\u6728\u68cd\u4e2d\u95f4\u4e0d\u80fd\u51fa\u73b0\u591a\u4f59\u7684'('\u6216')'\uff0c\u90a3\u4e48\u6211\u4eec\u8ba1\u7b97\u7ebf\u6bb5\u6811\u533a\u95f4\u548c\u65f6\uff0c\u53ea\u9700\u8981\u628a\u4e24\u8fb9\u539f\u672c\u5c31\u6709\u7684\u6728\u68cd\u6570\u52a0\u8d77\u6765\uff0c\u5e76\u5224\u65ad\u5de6\u533a\u95f4**\u6700\u53f3\u8fb9\u7684\u5de6\u62ec\u53f7**\u548c\u53f3\u533a\u95f4**\u6700\u5de6\u8fb9\u7684\u53f3\u62ec\u53f7**\u4e4b\u95f4\u6709\u6ca1\u6709**\u5176\u4ed6\u62ec\u53f7**\u3002\u5982\u679c\u6709\uff0c\u5219\u4e0d\u589e\u52a0\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u628a\u4e2a\u6570\u589e\u52a01\u3002\n\n\n\n\u00a0  \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u8981\u7ef4\u62a4\u7684\u4fe1\u606f\u662f\uff1a**\u533a\u95f4\u5185\u5b58\u5728\u7684\u5b8c\u6574\u6728\u68cd\u6570v\uff0c\u6700\u53f3\u8fb9\u7684\u5de6\u62ec\u53f7rl\uff0c\u6700\u5de6\u8fb9\u7684\u53f3\u62ec\u53f7lr\uff0c\u6700\u5de6\u8fb9\u7684\u5de6\u62ec\u53f7ll\uff0c\u6700\u53f3\u8fb9\u7684\u53f3\u62ec\u53f7rr**\u3002\u56e0\u4e3a\u6211\u4eec\u7ef4\u62a4\u7684\u662f**\u6700\u503c**\uff0c\u6240\u4ee5\u5f53\u6ca1\u6709\u7684\u65f6\u5019\u5c31\u8bbe\u4e3a\u7f3a\u7701\u503c\u3002\u7ef4\u62a4\u6700\u5de6\u8fb9\u7684\uff0c\u7f3a\u7701\u503c\u4e3a233333\uff08\u5927\u4e8e200000\u5c31\u53ef\u4ee5\uff09\uff1b\u7ef4\u62a4\u6700\u53f3\u8fb9\u7684\uff0c\u7f3a\u7701\u503c\u4e3a0\u3002\u8fd9\u6837\u53d6min\u6216max\u7684\u65f6\u5019\uff0c\u5728\u53e6\u4e00\u4e2a\u53c2\u6570\u6709\u610f\u4e49\u65f6\uff0c\u5c31\u4e0d\u4f1a\u6709\u5f71\u54cd\u3002\n\n\n\n\u00a0 \u00a0##### \u91cd\u6784\u4ee3\u7801\u5927\u6cd5\u597d\u3002\u4e00\u5f00\u59cb\u51c6\u5907\u5728\u539f\u6765\u7684\u4ee3\u7801\u4e0a\u6539\u6539\uff0c\u540e\u6765\u4e00\u4e2a\u5c0f\u65f6\u8fc7\u53bb\u5b9e\u5728\u5f04\u4e0d\u4e0b\u53bb\u4e86\u76f4\u63a5\u91cd\u6784\u3002\u6539\u5b8c\u8bed\u6cd5\u9519\u8bef\u5c31\u8fc7\u4e86= =\n\n## Code\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define ls (k<<1)\n#define rs (k<<1|1)\n#define mid (l+r>>1)\n#define Mid (t[k].l+t[k].r>>1)\nusing std::min;\nusing std::max;\nstruct node\n{\n    int l,r,v,lr,rl,ll,rr;\n    node(int l,int r)\n    {\n        this->l=l;\n        this->r=r;\n        v=0;\n    }\n    node(){v=0;}\n}t[810000];\nvoid maintain(int k)\n{\n    if(t[ls].rl>t[ls].rr&&t[rs].lr<t[rs].ll)//\u5de6\u533a\u95f4\u6700\u53f3\u8fb9\u7684\u5de6\u62ec\u53f7\u548c\u6709\u533a\u95f4\u6700\u5de6\u8fb9\u7684\u53f3\u62ec\u53f7\u4e2d\u95f4\u6ca1\u6709\u5176\u4ed6\u62ec\u53f7\n        t[k].v=t[ls].v+t[rs].v+1;\n    else\n        t[k].v=t[ls].v+t[rs].v;\n    t[k].ll=min(t[ls].ll,t[rs].ll);//\u7ef4\u62a4\u6700\u5927/\u6700\u5c0f\n    t[k].lr=min(t[ls].lr,t[rs].lr);\n    t[k].rr=max(t[ls].rr,t[rs].rr);\n    t[k].rl=max(t[ls].rl,t[rs].rl);\n    return;\n}\nint n;\nvoid build(int k,int l,int r)\n{\n    t[k]=node(l,r);\n    if(l==r)\n    {\n        if(l==1)\n        {\n            t[k].lr=233333;//l\u5f00\u5934\u7684\u7f3a\u7701\u503c\u4e3a233333\n            t[k].rl=1;//r\u5f00\u5934\u7684\u7f3a\u7701\u503c\u4e3a0\n            t[k].ll=1;\n            t[k].rr=0;\n        }\n        else if(l==n)\n        {\n            t[k].lr=n;\n            t[k].rl=0;\n            t[k].ll=233333;\n            t[k].rr=n;\n        }\n        else\n        {\n            t[k].lr=233333;\n            t[k].rl=0;\n            t[k].ll=233333;\n            t[k].rr=0;\n        }\n        return;\n    }\n    build(ls,l,mid);\n    build(rs,mid+1,r);\n    maintain(k);\n}\nvoid change(int k,int x,char c)\n{\n    if(t[k].l==t[k].r)\n    {\n        if(c=='(')\n        {\n            t[k].lr=233333;\n            t[k].rr=0;\n            t[k].ll=x;\n            t[k].rl=x;\n        }\n        else if(c==')')\n        {\n            t[k].lr=x;\n            t[k].rr=x;\n            t[k].ll=233333;\n            t[k].rl=0;\n        }\n        else\n        {\n            t[k].lr=233333;\n            t[k].rr=0;\n            t[k].ll=233333;\n            t[k].rl=0;\n        }\n        return;\n    }\n    if(x<=Mid)\n        change(ls,x,c);\n    else\n        change(rs,x,c);\n    maintain(k);\n    return;\n}\nint ask(int k,int l,int r)\n{\n    if(t[k].l==l&&t[k].r==r)\n        return t[k].v;\n    if(r<=Mid)\n        return ask(ls,l,r);\n    else if(l>Mid)\n        return ask(rs,l,r);\n    if(t[ls].rl>t[ls].rr&&t[rs].lr<t[rs].ll&&l<=t[ls].rl&&r>=t[rs].lr)//\u8bb0\u5f97\u5224\u8303\u56f4\n        return ask(ls,l,Mid)+1+ask(rs,Mid+1,r);\n    else\n        return ask(ls,l,Mid)+ask(rs,Mid+1,r);\n}\nint main()\n{\n    int m,op,l,r;\n    char c;\n    scanf(\"%d%d\",&n,&m);\n    build(1,1,n);\n    while(m--)\n    {\n        scanf(\"%d\",&op);\n        if(op==1)\n        {\n            scanf(\"%d %c\",&l,&c);\n            change(1,l,c);\n        }\n        else\n        {\n            scanf(\"%d%d\",&l,&r);\n            printf(\"%d\\n\",ask(1,l,r));\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1531191004,
        "uid": 63539,
        "name": "wjyyy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011\u7ebf\u6bb5\u6811"
    },
    {
        "content": "\u5148\u9a97\u4e9b\u535a\u5ba2\u8bbf\u95ee\u91cf[Youngsc](https://youngscc.github.io/)\n\n\n\u8fd9\u9053\u9898\u662f\u660e\u663e\u7684\u5355\u70b9\u64cd\u4f5c\u533a\u95f4\u67e5\u8be2\uff0c\u663e\u7136\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u53bb\u641e\u4e9b\u4e8b\u60c5\u3002\n\n**\u6211\u7684\u5efa\u6811\u548c\u522b\u4eba\u6709\u4e9b\u4e0d\u4e00\u6837\uff0c\u5bf9\u4e8e\u4e00\u6bb5\u533a\u95f4$[L,R]$,\u6211\u4eec\u53bb\u8bb0\u5f55\u4e09\u4e2a\u53d8\u91cf\uff0c\u5f53\u524d\u533a\u95f4\u7684\u5b8c\u6574\u6728\u68d2\u4e2a\u6570\uff0c\u5f53\u524d\u533a\u95f4\u80fd\u4f5c\u4e3a\u4e00\u6bb5\u6728\u68d2\u7684\u5de6\u534a\u90e8\u5206\u7684\u6700\u5de6\u7aef\u70b9\u7684\u4e0b\u6807\uff0c\u5f53\u524d\u533a\u95f4\u80fd\u4f5c\u4e3a\u4e00\u6839\u6728\u68d2\u7684\u53f3\u534a\u90e8\u5206\u7684\u6700\u53f3\u7aef\u70b9\u7684\u4e0b\u6807\u3002\u90a3\u4e48\u6bcf\u6b21\u66f4\u65b0\u4e00\u6bb5\u533a\u95f4\u65f6\uff0c\u5f53\u524d\u533a\u95f4\u7684\u5b8c\u6574\u7684\u6728\u68d2\u4e2a\u6570\u5c31\u662f\u5de6\u53f3\u5b50\u533a\u95f4\u5b8c\u6574\u7684\u6728\u68d2\u4e2a\u6570\u4e4b\u548c\uff0c\u5982\u679c\u5de6\u5b50\u533a\u95f4\u5b58\u5728\u80fd\u4f5c\u4e3a\u5de6\u534a\u90e8\u5206\u7684\u70b9\u4e14\u53f3\u5b50\u533a\u95f4\u5b58\u5728\u80fd\u4f5c\u4e3a\u53f3\u534a\u90e8\u5206\u7684\u70b9\uff0c\u90a3\u4e48\u5b8c\u6574\u6728\u68d2\u6570\u8fd8\u9700\u8981++\u3002\u66f4\u65b0\u66f4\u65b0\u5de6\u7aef\u70b9\u65f6\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff0c\u9996\u5148\u770b\u5de6\u5b50\u533a\u95f4\u662f\u5426\u5b58\u5728\u53ef\u4ee5\u4f5c\u4e3a\u5de6\u7aef\u70b9\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u6709\u76f4\u63a5\u8d4b\u8fc7\u53bb\u5c31\u53ef\u4ee5\uff0c\u5426\u5219\u5c31\u662f\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u5982\u679c\u5de6\u5b50\u533a\u95f4\u5168\u90e8\u90fd\u662f'x'\u800c\u4e14\u53f3\u5b50\u533a\u95f4\u5b58\u5728\u53ef\u4ee5\u4f5c\u4e3a\u5de6\u7aef\u70b9\u7684\u70b9,\u90a3\u4e48\u540c\u6837\u53ef\u4ee5\u7528\u8fd9\u4e2a\u4f4d\u7f6e\u6765\u66f4\u65b0\u5f53\u524d\u533a\u95f4\u7684\u4f4d\u7f6e\uff0c\u53f3\u7aef\u70b9\u4f4d\u7f6e\u540c\u7406,\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5f88\u663e\u7136\u662f\u6210\u7acb\u7684\uff0c\u81f3\u4e8e\u600e\u4e48\u5224\u65ad\u5de6\u5b50\u533a\u95f4\u90fd\u662f'x',\u53ef\u4ee5\u5728\u7ebf\u6bb5\u6811\u4e2d\u589e\u52a0\u4e00\u4e2a\u4fe1\u606f\u53bb\u8bb0\u5f55\uff0c\u4e5f\u53ef\u4ee5\u53c2\u8003\u6211\u5728\u4ee3\u7801\u4e2d\u7684\u65b9\u6cd5\u3002\u3002**\n\n\n### \u4ee3\u7801\u5728\u8fd9\u91cc\n\n#### \uff08\u51cf\u5c11\u4ee3\u7801\u590d\u5236\uff0c\u5171\u521b\u7f8e\u597d\u6d1b\u8c37\uff09\n\n\n```cpp\n# include <bits/stdc++.h>\n# define R register\n# define LS o<<1\n# define RS LS|1\n\nusing namespace std;\n\nint n,m,x,y,t[1000010],pos;\nint isl[1000010],isr[1000010];\nchar s[5];\n\ntemplate <typename T> inline void in(R T& a){\n    R char c=getchar();R T x=0,f=1;\n    while(!isdigit(c)){if(c=='-') f=-1; c=getchar();}\n    while(isdigit(c)) x=(x<<1)+(x<<3)+c-'0',c=getchar();\n    a=x*f;\n}\n\ntemplate <typename T> inline void maxx(R T& a,R T b){a<b? a=b:0;}\n\ninline void update(R int o){\n    t[o] = t[LS]+t[RS];\n    if(isl[LS]&&isr[RS]) t[o]++;\n    if(isl[RS]) isl[o] = isl[RS];\n    else if(!t[RS]&&!isr[RS]&&!isl[RS]&&isl[LS]) isl[o] = isl[LS];//!t[RS]&&!isr[RS]&&!isl[RS]\u5982\u679c\u6210\u7acb\uff0c\u90a3\u4e48\u5f53\u524d\u533a\u95f4\u4e00\u5b9a\u90fd\u662fX\uff0c\u81ea\u5df1\u6a21\u62df\u51e0\u4e0b\u5c31\u51fa\u6765\u4e86\u3002\n    else isl[o] = 0;\n    if(isr[LS]) isr[o] = isr[LS];\n    else if(!t[LS]&&!isl[LS]&&!isr[LS]&&isr[RS]) isr[o] = isr[RS];\n    else isr[o] = 0;\n}\n\ninline void build(R int o,R int l,R int r){\n    if(l==r){\n        if(l==1) isl[o]=1; //\u5efa\u6811\u5e76\u4e14\u8bb0\u5f55\u4e0b\u6807\n        if(l==n) isr[o]=n;\n        return;\n    }\n    R int mid = l+r>>1;\n    build(LS,l,mid);\n    build(RS,mid+1,r);\n    update(o);\n}\n\ninline void change(R int o,R int l,R int r,R int x,R int y){\n    if(l==r){\n        if(y==0) isl[o]=isr[o]=0;\n        if(y==1) isl[o]=l,isr[o]=0;\n        if(y==2) isr[o]=l,isl[o]=0;\n        return;\n    }\n    R int mid = l+r>>1;\n    if(x<=mid) change(LS,l,mid,x,y);\n    else change(RS,mid+1,r,x,y);\n    update(o);\n}\n\ninline int qury(R int o,R int l,R int r,R int x,R int y){\n    // printf(\"%d %d %d %d\\n\",l,r,isl[o],isr[o]);\n    if(x<=l&&y>=r) return t[o];\n    R int mid = l+r>>1;\n    R int ret = 0;\n    if(x<=mid) ret += qury(LS,l,mid,x,y);\n    if(y>mid) ret += qury(RS,mid+1,r,x,y);\n    if(isl[LS]>=x&&isr[RS]<=y&&isr[RS]) ret++;//\u5224\u65ad\u5de6\u53f3\u533a\u95f4\u80fd\u5426\u7ec4\u6210\u5b8c\u6574\u6728\u68cd\u4e14\u5728\u8be2\u95ee\u533a\u95f4\u5185\n    return ret;\n}\n\nint main(){\n    // freopen(\"data.in\",\"r\",stdin);\n    // freopen(\"segment.out\",\"w\",stdout);\n    in(n),in(m);\n    build(1,1,n);\n    while(m--)\n    {\n        in(pos);\n        if(pos == 1){\n            in(x),scanf(\"%s\",s);\n            if(s[0]=='(') change(1,1,n,x,1);\n            if(s[0]==')') change(1,1,n,x,2);\n            if(s[0]=='X') change(1,1,n,x,0);\n        }\n        else in(x),in(y),printf(\"%d\\n\",qury(1,1,n,x,y));\n    }\n    return 0;\n}\n```",
        "postTime": 1513518604,
        "uid": 36282,
        "name": "Youngsc",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "###\u8c03\u4e86\u4e00\u4e2a\u665a\u4e0a\uff08\u6454\n\n###\u611f\u8c22\u697c\u4e0a\u7684\u697c\u4e0a\u5927\u4f6c\u7684\u9898\u89e3\uff0c\u62ff\u7740\u60a8\u7684\u4ee3\u7801\u62cd\u4e86\u4e00\u665a\u4e0a\uff08\u9003\n\n\n**\u534e\u4e3d\u4e3d\u7684\u5206\u5272\u7ebf--------------------------------------------------**\n\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e09\u4e2a\u503c\uff0c\u533a\u95f4\u6728\u68cd\u6570(sum)\uff0c\u533a\u95f4\u6700\u9760\u53f3\u7684\u201c\uff08\u201d\u7684\u4f4d\u7f6e(rsum)\uff0c\u533a\u95f4\u6700\u9760\u5de6\u7684\u201c\uff09\u201d\u7684\u4f4d\u7f6e(lsum)\u3002\n\n\n\u7136\u540e\u5c31\u662f\u5355\u70b9\u4fee\u6539\u548c\u533a\u95f4\u67e5\u8be2~~\u5efa\u6811\u592a\u7b80\u5355\u4e86\u6211\u5c31\u4e0d\u8bb2\u4e86\u54c8~~\n\n\n\u4fee\u6539\uff1a\n\n\u5206\u4e09\u79cd\u60c5\u51b5\uff0c\n\n\u5982\u679c\u4fee\u6539\u4e3a\u201c\uff08\u201d\u5219\uff0ca[k].lsum=0,a[k].rsum=1\n\n\u5982\u679c\u4fee\u6539\u4e3a\u201cX\u201d\u5219\uff0ca[k].lsum=0,a[k].rsum=0\n\n\u5982\u679c\u4fee\u6539\u4e3a\u201c)\u201d\u5219\uff0ca[k].lsum=1,a[k].rsum=0\n\n\u7136\u540e\u5c31\u662f\u4e0d\u662f\u4fee\u6539\u7684\u70b9\u7684\u503c\u3002\n\na[k].sum\u5c31\u662f\u5de6\u513f\u5b50\u548c\u53f3\u513f\u5b50\u7684\u533a\u95f4\u6728\u68cd\u6570\u4e4b\u548c\u518d\u52a0\u4e0a\u5de6\u513f\u5b50\u7684\u6700\u9760\u53f3\u7684\u201c\uff08\u201d\u548c\u53f3\u513f\u5b50\u7684\u6700\u9760\u5de6\u7684\u201c\uff09\u201d\u80fd\u5426\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u6728\u68cd\u3002\n\na[k].lsum\u5373\u5982\u679c\u5b83\u7684\u5de6\u513f\u5b50\u7684lsum\u4e0d\u7b49\u4e8e0\uff0c\u90a3\u80af\u5b9a\u662f\u5b83\u5de6\u513f\u5b50\u7684lsum\u6700\u9760\u5de6\uff0c\u4e0d\u7136\u5c31\u662f\u5b83\u5de6\u513f\u5b50\u90a3\u4e2a\u533a\u95f4\u5168\u662f\u201cX\u201d\uff0c\u7136\u540e\u5c31\u662f\u5b83\u53f3\u513f\u5b50\u7684lsum\uff0c\u5f53\u7136a[k].lsum\u4e5f\u53ef\u80fd\u4e3a0.\n\na[k].rsum\u548ca[k].lsum\u5dee\u4e0d\u591a\u3002\u3002\n\n\n\u8be2\u95ee:\n\n\u5373\u8bbf\u95ee\u5de6\u513f\u5b50\u7684\u6728\u68cd\u6570+\u8bbf\u95ee\u53f3\u513f\u5b50\u7684\u6728\u68cd\u6570+\u5de6\u513f\u5b50\u7684\u6700\u9760\u53f3\u7684\u201c\uff08\u201d\u548c\u53f3\u513f\u5b50\u7684\u6700\u9760\u5de6\u7684\u201c\uff09\u201d\u80fd\u5426\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u6728\u68cd\n\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<iostream>\nusing namespace std;\n#define For(i,x,y) for (int i=x;i<=y;i++)\nstruct tree{\n    int l,r,sum,lsum,rsum;    \n}a[2000010];\nint n,m,k,x,y;\nchar c;\nvoid build(int k,int l,int r)\n{\n    if (k==1) a[k].sum=1,a[k].l=l,a[k].r=r;//\u521a\u5f00\u59cb\u6709\u4e00\u6839\u6728\u68cd\n        else {\n            a[k].sum=0,a[k].l=l,a[k].r=r;\n            if (l==1) a[k].rsum=1;\n            if (r==n) a[k].lsum=n;//\u61d2\u5f97\u89e3\u91ca\u4e86\u3002\u3002\u3002\u5176\u5b9e\u633a\u597d\u7406\u89e3\u7684\u5427\n        }\n    if (l==r) return;\n    int mid=l+r >> 1;\n    build(k << 1,l,mid);//\u5de6\u5b50\u6811\n    build(k << 1^1,mid+1,r);//\u53f3\u5b50\u6811\n```\n}//\u5efa\u6811\n```cpp\nvoid ud(int k,int l,int x)\n{\n    if (a[k].l==a[k].r&&a[k].l==l) {\n        if (x==1) a[k].rsum=l,a[k].lsum=0;\n        if (x==2) a[k].rsum=0,a[k].lsum=0;\n        if (x==3) a[k].rsum=0,a[k].lsum=l;\n        return;\n    }\n    int mid=a[k].l+a[k].r >> 1;\n    if (mid>=l) ud(k << 1,l,x);\n    if (mid<l) ud(k << 1^1,l,x);\n    int lson=k << 1,rson=k << 1^1;\n   a[k].sum=a[lson].sum+a[rson].sum+min(1,a[lson].rsum)*min(1,a[rson].lsum);\n    if (a[lson].lsum>0) a[k].lsum=a[lson].lsum;\n        else\n          if (a[lson].rsum==0&&a[lson].sum==0) a[k].lsum=a[rson].lsum;\n              else a[k].lsum=0;\n    if (a[rson].rsum>0) a[k].rsum=a[rson].rsum;\n        else\n          if (a[rson].lsum==0&&a[rson].sum==0) a[k].rsum=a[lson].rsum;\n              else a[k].rsum=0;//\u540c\u4e0a\n```\n}//\u4fee\u6539\n```cpp\nint queryr(int k,int l,int r)\n{\n    if (a[k].rsum>=l&&a[k].rsum<=r) return a[k].rsum;\n      else return 0;\n}\nint queryl(int k,int l,int r)\n{\n    if (a[k].lsum<=r&&a[k].lsum>=l) return a[k].lsum;\n      else return 0;\n}\nint query(int k,int l,int r)\n{\n    //printf(\"%d %d %d\\n\",a[k].l,a[k].r,min(1,queryl(k << 1^1,l,r))*min(1,queryr(k << 1,l,r)));\u4e5f\u662f\u7528\u6765\u8c03\u4ee3\u7801\u7684\n    if (a[k].l>r||l>a[k].r) return 0;\n    if (a[k].l>=l&&a[k].r<=r) return a[k].sum;\n    int ans=query(k << 1,l,r)+query(k << 1^1,l,r);//\u8bbf\u95ee\u5de6\u513f\u5b50\u7684\u6728\u68cd\u6570+\u8bbf\u95ee\u53f3\u513f\u5b50\u7684\u6728\u68cd\u6570\n    ans+=min(1,queryl(k << 1^1,l,r))*min(1,queryr(k << 1,l,r));//\u5de6\u513f\u5b50\u7684\u6700\u9760\u53f3\u7684\u201c\uff08\u201d\u548c\u53f3\u513f\u5b50\u7684\u6700\u9760\u5de6\u7684\u201c\uff09\u201d\u80fd\u5426\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u6728\u68cd\n    return ans;\n```\n}//\u8be2\u95ee\n```cpp\nint main(){\n    freopen(\"1.in\",\"r\",stdin);\n    freopen(\"1.out\",\"w\",stdout); \n    scanf(\"%d%d\",&n,&m);\n    build(1,1,n);\n    For(i,1,m) {\n        scanf(\"%d\",&k);\n        if (k==1) {\n            scanf(\"%d %c\",&x,&c);\n            if (c=='(') y=1;\n            if (c=='X') y=2;\n            if (c==')') y=3;\n            ud(1,x,y);\n        }\n        else {\n            scanf(\"%d%d\",&x,&y);\n            printf(\"%d\\n\",query(1,x,y));\n        }\n        //For(j,1,20) printf(\"%d %d %d %d %d\\n\",a[j].l,a[j].r,a[j].sum,a[j].lsum,a[j].rsum);printf(\"\\n\");\u7528\u6765\u8c03\u8bd5\u4ee3\u7801\u7684\u3002\u3002\u3002\n    }\n    return 0;\n}\n```",
        "postTime": 1513343568,
        "uid": 25355,
        "name": "\u590f\u8272\u796d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "**\u849f\u84bb\u7684\u7b2c\u4e00\u7bc7XXX**\n\n**\u590d\u5065\u7684\u65f6\u5019\u6765\u5207\u4e00\u4e0b\u8fd9\u9053\u9898\uff0c\u505a\u4e86\u5feb\u4e24\u4e2a\u5c0f\u65f6\uff08\u6cea\uff09\uff08\u5176\u5b9e\u4e4b\u524d\u7b2c\u4e00\u904d\u505a\u7684\u65f6\u5019\u6ca1\u590d\u4e60\u7136\u540e\u5c31\u6ca1\u53bb\u7ba1\uff09**\n\n**\u697c\u4e0b\u7684\u610f\u601d\u5f88\u6e05\u695a\uff0c\u7ebf\u6bb5\u6811\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u5173\u952e\u5c31\u662f\u8bb0\u5f55\u6bcf\u6761\u7ebf\u6bb5\u7684\u6781\u5de6\u4ee5\u53ca\u6781\u53f3\u7ebf\u6bb5\u7684\u62ec\u53f7\uff0c\u7136\u540e\u7edf\u8ba1\u7684\u65f6\u5019\u770b\u4e00\u4e0b\u5de6\u53f3\u513f\u5b50**\n\n**left\u8868\u793a\u6781\u5de6\uff0cright\u8868\u793a\u6781\u53f3\uff0cp1\uff0cp2\u8868\u793a\u6781\u5de6\u4ee5\u53ca\u6781\u53f3\u7684\u62ec\u53f7\u4e0b\u6807**\n\n**\u60f3\u53d1\u9898\u89e3\u4e3b\u8981\u662f\u4e3a\u4e86\u7ed9pascal\uff08\u6ce8\u610f\u4fee\u6539\u7684\u65f6\u5019\u4e2d\u95f4\u6709\u7a7a\u683c\uff09**\n\n**\u4ee3\u7801\u4e60\u60ef\u6781\u5dee\uff0c\u6bd4\u8f83\u4e11**\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n```cpp\nvar tree,p1,p2:array[0..800005] of longint;\n      left,right,st:array[0..800005] of char;\n      i,j,m,n,p,q,ll,rr,ans,o,x:longint;\n      c:char;\n   procedure renew(p: longint);\n      begin\n          if left[2*p]<>'X' then\n              begin\n                   left[p]:=left[2*p];\n                   p1[p]:=p1[2*p];\n              end else\n          if right[2*p]<>'X' then\n              begin\n                   left[p]:=right[2*p];\n                   p1[p]:=p2[2*p];\n              end else\n          if left[2*p+1]<>'X' then\n              begin\n                   left[p]:=left[2*p+1];\n                   p1[p]:=p1[2*p+1];\n              end else\n              begin\n                   left[p]:=right[2*p+1];\n                   p1[p]:=p2[2*p+1];\n              end;\n          if right[2*p+1]<>'X' then\n              begin\n                   right[p]:=right[2*p+1];\n                   p2[p]:=p2[2*p+1];\n              end else\n          if left[2*p+1]<>'X' then\n              begin\n                   right[p]:=left[2*p+1];\n                   p2[p]:=p1[2*p+1];\n              end else\n          if right[2*p]<>'X' then\n              begin\n                   right[p]:=right[2*p];\n                   p2[p]:=p2[2*p];\n              end else\n              begin\n                   right[p]:=left[2*p];\n                   p2[p]:=p1[2*p];\n              end;\n        tree[p]:=tree[2*p]+tree[2*p+1];\n        if (right[2*p]='(') and  (left[2*p+1]=')') then inc(tree[p]);\n     end;\n   procedure build(p,l,r:longint);\n      var m:longint;\n          begin\n             if l=r then\n                  begin\n                       left[p]:=st[l]; p1[p]:=l;\n                       right[p]:=st[l];  p2[p]:=r;\n                       exit;\n                 end;\n           m:=(l+r) div 2;\n           build(2*p,l,m); build(2*p+1,m+1,r);\n           renew(p);\n         end;\n  procedure modify(p,l,r:longint);\n      var m:longint;\n       begin\n            if  (l>x) or (r<x) then exit;\n            if  (l=r) then\n               begin\n                     left[p]:=st[l]; p1[p]:=l;\n                     right[p]:=st[l];  p2[p]:=r;\n                     exit;\n              end;\n           m:=(l+r) div 2;\n           modify(2*p,l,m); modify(2*p+1,m+1,r);\n           renew(p);\n       end;\n  procedure query(p,l,r:longint);\n       var m:longint;\n       begin\n          if  (ll>r) or (rr<l)  then exit;\n          if (r<=rr) and (l>=ll) then\n           begin\n              ans:=ans+tree[p];\n              exit;\n           end;\n          m:=(l+r) div 2;\n          query(2*p,l,m); query(2*p+1,m+1,r);\n          if (left[2*p+1]=')') and (p1[2*p+1]<=rr)  and (right[2*p]='(') and (p2[2*p]>=ll) then inc(ans);\n      end;\n  begin\n         readln(n,m);  for i:=1 to n do st[i]:='X';\n         st[1]:='('; st[n]:=')';\n         build(1,1,n);\n         for i:=1 to m do\n            begin\n                read(o);\n                if o=2 then\n                        begin\n                               readln(ll,rr);\n                               ans:=0;\n                               query(1,1,n);\n                               writeln(ans);\n                       end else\n                       begin\n                              read(x); readln(c,st[x]);\n                              modify(1,1,n);\n                       end;\n           end;\n   end.\n\n```",
        "postTime": 1509369170,
        "uid": 60852,
        "name": "\u5317\u65b9\u706b\u67f4",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u5b89\u5229\u535a\u5ba2<https://mk703.cn/%e6%b4%9b%e8%b0%b7%e5%a6%96%e6%a2%a6%e6%96%a9%e6%9c%a8%e6%a3%92%e9%a2%98%e8%a7%a3/>\n\n\u8bf4\u6765\u60ed\u6127\uff0c\u8fd9\u9053\u9898\u5c45\u7136\u7528\u4e86\u4e00\u5929\u624dA\u3002\u56db\u80a2\u65e0\u529b\uff0c\u5934\u8111\u660f\u6c89\uff0c\u5e94\u8be5\u662f\u5df2\u7ecf\u6b65\u5165\u8001\u5e74\u65f6\u671f\u3002\n\n\n\u597d\u5427\uff0c\u8fd9\u9898\u642d\u773c\u4e00\u770bsb\u7ebf\u6bb5\u6811\uff0c\u4f46\u662f\u8bc4\u7ea7\u597d\u9ad8\u3002\u6240\u4ee5\u5c31\u8981\u5207\u8fd9\u9053\u9898\u3002\u4fe1\u5fc3\u6ee1\u6ee1\u5199\u4e00\u53d1\uff0cWA\uff0c\u518d\u6765\uff0c\u53c8WA\u3002\u6700\u540e\u5199\u4e86\u66b4\u529b\u5bf9\u62cd\uff0c\u7528\u4e86\u597d\u957f\u65f6\u95f4\u3002\n\n\n\u9996\u5148\u5b9a\u4e49\u7ebf\u6bb5\u6811\u8282\u70b9\uff1a\n\n\n1. num \u5728\u533a\u95f4\u4e2d\u6709\u591a\u5c11\u6728\u68cd\n\n2. fr \u5728\u533a\u95f4\u6700\u540e\u662f\u5426\u662f\u201c\uff08\u201d\n\n3. en\u5728\u533a\u95f4\u9996\u4f4d\u662f\u5426\u662f\u201c\uff09\u201d\n\n\n\u63a5\u4e0b\u6765\u5f00\u59cb\u63a8\uff1a\u80af\u5b9aseg[i].num += seg[i << 1].num + seg[(i << 1) + 1].num\u3002\u4f46\u662f\u8fd9\u6837\u5c31\u5bf9\u5417\uff1f\uff1f\u5f88\u663e\u7136\u4e0d\u662f\u56e0\u4e3a\u6211\u4eec\u8fd8\u6709fr\u548cen\u6ca1\u6709\u7528\u6240\u4ee5\u8981\u5224\u65adseg[i << 1].fr \u548c seg[(i << 1) + 1].en\u662f\u5426\u4e3a\u771f\uff0c\u771f\u5219num++\u3002\n\n\n\u53c8\u6765\u6d3b\u4e86\uff0cfr\u548cen\u600e\u4e48\u63a8\u3002\u597d\u50cf\u8fd9\u5c31\u662f\u8fd9\u9898\u6700\u96be\u7684\u5730\u65b9\u8fa3\u3002\n\n\n\u4ee5en\u4e3a\u4f8b\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n\n1.     seg[i]\u7684en\u6765\u81ea\u5de6\u513f\u5b50\uff0c\u5219seg[i << 1].en == true\n\n2. \u5426\u5219\uff0cseg[i]\u7684en\u6765\u81ea\u53f3\u513f\u5b50\uff0c\u5219\u53f3\u513f\u5b50seg[(i << 1) + 1].en == true \u5de6\u513f\u5b50\u5565\u4e5f\u6ca1\u6709\u5168\u662f\u201cX\u201d \u2014\u2014!seg[i << 1].fr && !seg[i << 1].num\n\n\n\u540c\u7406\u63a8fr\u3002\n\n\n\u5bf9\u4e8e\u5355\u70b9\u4fee\u6539\u65f6\u4e5f\u5982\u6b64\u3002\n\n\n\u5982\u4f55\u533a\u95f4\u67e5\u8be2\u3002\u597d\u50cf\u8fd9\u5c31\u662f\u8fd9\u9898\u7b2c\u4e8c\u96be\u7684\u5730\u65b9\u8fa3\u3002\n\n\n\u9996\u5148\u8981\u5b9a\u4e49end\u8868\u793a\u5728\u4e0a\u4e00\u6b21t\u9009\u62e9\u65f6\u5de6\u8fb9\u6709\u6ca1\u6709\u591a\u7684\u201c\uff08\u201d\uff0cfro\u8868\u793a\u5728\u4e0a\u4e00\u6b21s\u9009\u62e9\u65f6\u53f3\u8fb9\u6709\u6ca1\u6709\u591a\u7684\u201c\uff09\u201d\u3002\n\n\n\u8fd9\u91ccfro\u548cend\u7684\u63a8\u6cd5\u4e0e\u4e0a\u9762\u7c7b\u4f3c\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\n\u6700\u540e\u662f\u5728s\u548ct\u722c\u5230\u505c\u6b62\u7684\u65f6\u5019\uff0c\u8981\u5224\u65ad\u4e00\u4e0bs\u6240\u4ee3\u8868\u533a\u95f4\u53f3\u7aef\u548ct\u6240\u4ee3\u8868\u533a\u95f4\u5de6\u7aef\u662f\u5426\u662f\u5339\u914d\u3002\u5c31\u662f\u5728\u5faa\u73af\u5916\u52a0\n\nif(fro && end)ans++;\n",
        "postTime": 1497614020,
        "uid": 30220,
        "name": "mk703",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "### \u524d\u7f6e\u829d\u58eb\uff1a\u7ebf\u6bb5\u6811 ~~\uff08\u5e94\u8be5\u4f1a\u7684\u5427\uff09~~\n\u672c\u9898\u53ef\u4ee5\u7b97\u7ebf\u6bb5\u6811\u7684\u57fa\u672c\u64cd\u4f5c\u4e86\uff0c\u8fdb\u5165\u6b63\u9898\u5427\uff1a\n\u6211\u4eec\u7ebf\u6bb5\u6811\u4e2d\u5b58\u50a8\u4e09\u4e2a\u53d8\u91cf\uff1a\n- $sum[x]$ :\u5b8c\u6574\u7684\u6728\u68d2\u7684\u6570\u91cf\n- $ls[x]$ :\u6700\u53f3\u8fb9\u7684\u62ec\u53f7\u662f\u5426\u662f ( \n- $rs[x]$ :\u6700\u5de6\u8fb9\u7684\u62ec\u53f7\u662f\u5426\u662f )\n##### \u505a\u9898\u8fc7\u7a0b\u5206\u4e3a\u5efa\u6811\uff0c\u5355\u70b9\u4fee\u6539\u548c\u67e5\u8be2 ~~\uff08\u5f88\u7ecf\u5178\u4e86\u5427\uff09~~\n\u672c\u9898\u5728\u5efa\u6811\u548c\u5355\u70b9\u4fee\u6539\u65f6\u53ea\u6709\u4e00\u70b9\u4e0e\u5176\u4ed6\u8282\u70b9\u4e0d\u540c\uff0c\u5c31\u662f\u5408\u5e76\u8282\u70b9\u4fe1\u606f\uff0c\u5728\u8fd9\u91cc\u7565\u4f5c\u89e3\u91ca\uff1a\n\u9996\u5148\u662f\u6700\u7b80\u5355\u76f4\u63a5\u8d4b\u503c\uff1a\n$$rs_x=rs_{sonL},ls_x=ls_{sonR}$$\n$$ sum_x=sum_{sonL}+sum_{sonR}+[ls_{sonL}==1\\&\\&rs_{sonR}==1]$$\n#### \u53e6\u5916\u6ce8\u610f\u4e00\u70b9\uff0c\u5f53$sonL$\u7684\u533a\u96c6\u4e2d\u5168\u662f$X$\u65f6\uff0c$rs_x$\u662f\u8981\u7b49\u4e8e$rs_{sonR}$\u7684\uff0c\u800c\u4e14\u6613\u8bc1\u5f97\uff0c\u5982\u679c$sum_{sonL}==0\\&\\&rs_{sonL}==0\\&\\&ls_{sonL}==0$\uff0c\u5219\u53ef\u4ee5\u8bf4\u660e\u5de6\u513f\u5b50\u5168\u662f$X$\uff0c\u56e0\u6b64\u5408\u5e76\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\ninline void update(int x)\n{\n\t\trs[x]=rs[x<<1],ls[x]=ls[x<<1|1];\n\t\tif(sum[x<<1]==0&&ls[x<<1]==0&&rs[x<<1]==0) rs[x]=rs[x<<1|1];\n\t\tif(sum[x<<1|1]==0&&ls[x<<1|1]==0&&rs[x<<1|1]==0) ls[x]=ls[x<<1];\n\t\tsum[x]=sum[x<<1]+sum[x<<1|1]+(ls[x<<1]+rs[x<<1|1]>>1);\n}\n```\n\u518d\u5c31\u662f\u67e5\u8be2\u4e86\uff0c\u8fd9\u91cc\u9700\u8981\u7528\u5230\u4e00\u4e2a\u5c0f\u6280\u5de7\uff0c\u7ebf\u6bb5\u6811\u7684\u904d\u5386\u987a\u5e8f\u662f\u4ece\u5de6\u5f80\u53f3\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u6bcf\u9047\u5230\u4e00\u4e2a\u5408\u6cd5\u533a\u95f4\uff0c\u548c\u524d\u4e00\u4e2a\u9047\u5230\u7684\u5408\u6cd5\u533a\u95f4\u5408\u5e76\u8ba1\u7b97\u7b54\u6848\u5c31\u597d\u4e86\uff0c\u540c\u6837\u9700\u8981\u6ce8\u610f\u5168\u4e3a$X$\u7684\u60c5\u51b5\u3002\n### $OVER$~~\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read()\n{\n\t\tre int x=0,f=1;\n\t\tre char ch=getchar();\n\t\tfor(;ch>'9'||ch<'0';ch=getchar()) if(ch=='-') f*=-1;\n\t\tfor(;ch>='0'&&ch<='9';ch=getchar()) x=(x<<1)+(x<<3)+(ch^48);\n\t\treturn x*f;\n}\nconst int N=200005;\nint n,m,sum[N<<2],ans;\nbool ls[N<<2],rs[N<<2],last;\nchar ch[N],s[1];\ninline void update(int x)\n{\n\t\trs[x]=rs[x<<1],ls[x]=ls[x<<1|1];\n\t\tif(sum[x<<1]==0&&ls[x<<1]==0&&rs[x<<1]==0) rs[x]=rs[x<<1|1];\n\t\tif(sum[x<<1|1]==0&&ls[x<<1|1]==0&&rs[x<<1|1]==0) ls[x]=ls[x<<1];\n\t\tsum[x]=sum[x<<1]+sum[x<<1|1]+(ls[x<<1]+rs[x<<1|1]>>1);\n}\nvoid build(int l,int r,int x)\n{\n\t\tif(l==r) {ls[x]=(ch[l]=='('),rs[x]=(ch[l]==')');return ;}\n\t\tre int mid=l+r>>1;\n\t\tbuild(l,mid,x<<1),build(mid+1,r,x<<1|1);\n\t\tupdate(x);\n}\nvoid change(int l,int r,int x,int p,char a)\n{\n\t\tif(l==r) {ls[x]=(a=='('),rs[x]=(a==')');return ;}\n\t\tre int mid=l+r>>1;\n\t\tif(p<=mid) change(l,mid,x<<1,p,a);\n\t\telse change(mid+1,r,x<<1|1,p,a);\n\t\tupdate(x);\n}\nvoid ask(int l,int r,int x,int L,int R)\n{\n\t\tif(L<=l&&r<=R)\n\t\t{\n\t\t\tif(sum[x]==0&&ls[x]==0&&rs[x]==0) return ;\n\t\t\tans+=sum[x]+(last+rs[x]>>1);\n\t\t\tlast=ls[x];//last\u4e3a\u4e0a\u4e00\u4e2a\u5408\u6cd5\u533a\u95f4\u6700\u53f3\u8fb9\u4e00\u4e2a\u62ec\u53f7\u662f\u5426\u4e3a (\n\t\t\treturn ;\n\t\t}\n\t\tre int mid=l+r>>1;\n\t\tif(L<=mid) ask(l,mid,x<<1,L,R);\n\t\tif(R>mid) ask(mid+1,r,x<<1|1,L,R);\n}\ninline void Fre()\n{\n\t\tfreopen(\"P3797.in\",\"r\",stdin);\n\t\tfreopen(\"P3797.out\",\"w\",stdout);\n}\nint main()\n{\n\t\tFre();\n\t\tn=read(),m=read();\n\t\tfor(re int i=2;i<n;i++) ch[i]='X';ch[1]='(',ch[n]=')';\n\t\tbuild(1,n,1);\n\t\tfor(re int i=1,type,x,y;i<=m;i++)\n\t\t{\n\t\t\ttype=read(),x=read();\n\t\t\tif(type==1)\n\t\t\t{\n\t\t\t\tscanf(\"%s\",s);\n\t\t\t\tchange(1,n,1,x,s[0]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ty=read(),ask(1,n,1,x,y);\n\t\t\t\tprintf(\"%d\\n\",ans);\n\t\t\t\tans=last=0;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n}\n```\n",
        "postTime": 1603183548,
        "uid": 92275,
        "name": "Chester1011",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u82b1\u4e86\u4e00\u4e0b\u5348\u505a\u8fd9\u9898\uff0c\u771f\u662f\u4e00\u9053\u7ebf\u6bb5\u6811\u7684\u597d\u9898\u3002\n\n### \u9898\u610f\n\u6709\u70b9\u50cf\u62ec\u53f7\u5339\u914d\uff0c\u4f46\u53c8\u4e0d\u540c\u3002\u82e5\u6709\u5de6\u8fb9\u2018\uff09\u2019\uff0c\u53f3\u8fb9\u2018\uff08\u2019\uff0c\u4e14\u4e24\u62ec\u53f7\u95f4**\u53ea\u6709**\u2018X\u2019\uff08\u6216\u6ca1\u4e1c\u897f\uff09\uff0c\u5219\u5339\u914d\u6210\u529f\uff0c+1\u3002\n\n\u6bcf\u4e2a\u64cd\u4f5c\u8981\u4e48\u628a\u4e00\u4e2a\u5b57\u7b26\u66ff\u6362\u6210\u53e6\u4e00\u4e2a\uff0c\u8981\u4e48\u7edf\u8ba1\u4e00\u6bb5\u533a\u95f4\u5185\u5339\u914d\u6570\u3002\n\n### \u5206\u6790\n\n\u770b\u5230\u8fd9\u79cd\u5e26\u533a\u95f4\u67e5\u8be2\u4e0e\u4fee\u6539\u7684\u95ee\u9898\uff0c\u80af\u5b9a\u5148\u60f3\u5230\u6811\u72b6\u6570\u7ec4\u6216\u7ebf\u6bb5\u6811\u3002\u4f46\u601d\u8003\u4e00\u4e0b\u53d1\u73b0\u6811\u72b6\u6570\u7ec4\u4f3c\u4e4e\u4e0d\u884c\uff0c\u4e8e\u662f\u9009\u7528\u7ebf\u6bb5\u6811\u3002\n\n\u57fa\u672c\u601d\u8def\uff1aa\u6570\u7ec4\u8bb0\u5f55\u5339\u914d\u6570\u4e0e\u5f53\u524d\u533a\u95f4\u5de6\u53f3\u7684\u60c5\u51b5\uff080,1,2,3\uff09\u3002\n\n- 0\uff1a\u8868\u793a\u65e0\u6cd5\u7528\u4e8e\u5339\u914d\uff0c\u50cf\u2018XX\uff08X)X\u2019\u8fd9\u79cd\u3002\n- 1\uff1a\u8868\u793a\u5339\u914d\u7684\u53f3\u8fb9\uff0c\u50cf\u2018\uff09\u2019\u548c\u2018XXX\uff09\u2019\u3002\n- 2\uff1a\u8868\u793a\u5339\u914d\u7684\u5de6\u8fb9\uff0c\u50cf\u2018\uff08\u2019\u548c\u2018\uff08XXX\u2019\u3002\n- 3\uff1a\u8868\u793a\u5339\u914d\u7684\u4e2d\u95f4\uff0c\u50cf\u2018XXXXXXXXX\u2019\u8fd9\u79cd\u3002\n\nc\u6570\u7ec4\u8bb0\u5f55\u5f53a\u4e3a1,2\u65f6\u5de6\u53f3\u62ec\u53f7\u7684\u4f4d\u7f6e\u3002\n\n\u7136\u540e\u662f\u5efa\u6811\u548c\u66f4\u65b0(\u5176\u5b9e\u4e00\u4e2a\u6837\uff09\uff0c\n\u53f6\u8282\u70b9\uff1a\uff08\u5339\u914d\u6570\u4e3a0\uff0cc\u6570\u7ec4\u4e3a\u533a\u95f4\u4f4d\u7f6e\uff09\n\n- \u2018\uff09\u2019\u5219\u533a\u95f4\u5de6\u4e3a1\uff0c\n- \u2018\uff08\u2019\u5219\u533a\u95f4\u53f3\u4e3a2\uff0c\n- \u2018X\u2019 \u5219\u5de6\u53f3\u90fd\u4e3a3\uff0c\n\n\u975e\u53f6\u8282\u70b9\uff1a\n\n\u5339\u914d\u6570\uff1a\u5de6\u53f3\u533a\u95f4\u548c\uff0c\u82e5\u5de6\u533a\u95f4\u53f3\u4e3a2\uff0c\u53f3\u533a\u95f4\u5de6\u4e3a1\u518d\u52a01\u3002\n\n\u533a\u95f4\u5de6\u53f3\u7684\u60c5\u51b5\uff1a\u5f53\u5de6\u6216\u53f3\u533a\u95f4\u4e3a\uff083,3\uff09\uff0c\u5219\u5927\u533a\u95f4\u5de6\u53f3\u60c5\u51b5\u4e3a\u53e6\u4e00\u533a\u95f4\u60c5\u51b5\u3002\u5426\u5219\uff0c\u5927\u533a\u95f4\u5de6\u8fb9\u4e3a\u5de6\u533a\u95f4\u5de6\uff0c\u53f3\u8fb9\u4e3a\u53f3\u533a\u95f4\u53f3\u3002c\u6570\u7ec4\u4e0e\u533a\u95f4\u5de6\u53f3\u7684\u60c5\u51b5\u5199\u6cd5\u4e00\u6837\uff08\u53ea\u8981\u628aa\u6539\u6210c\u5373\u53ef\uff09\u3002\u5982\u679c\u4e0d\u80fd\u7406\u89e3\uff0c\u53ef\u4ee5\u753b\u51e0\u7ec4\u8bd5\u8bd5\u3002\uff08\u6211\u4e5f\u4e3e\u51e0\u4e2a\u4f8b\u5b50\uff1a3,3|0,2\u2192XX XX|\uff08\uff09\uff08X \u5408\u5e76\u4e3a0,2\uff1b1,0|1,2\u2192\uff09X \uff08\uff09|\uff09X X(\u5408\u5e76\u4e3a1,2\u3002\uff09\n\n\u4f46\u5b9e\u9645\u4e0a\u8fd9\u6837\u662f\u6709\u95ee\u9898\u7684\uff1a3,2|1,3\u5b9e\u9645\u4e0a\u5408\u5e76\u4e3a0,0\u3002\u6240\u4ee5\u8fd8\u8981\u7279\u5224\u4e00\u4e0b\uff1a\u5f53?,2|1,?\u65f6\uff0c\u82e5?\u4e3a3\uff0c\u5219\u628a3\u6539\u4e3a0\u3002\n\n\u6700\u540e\u662f\u7edf\u8ba1\u7b54\u6848\u3002c\u6570\u7ec4\u5728\u8fd9\u91cc\u7ec8\u4e8e\u6709\u7528\u4e86\uff0c\u5f53x<=\u5de6\u533a\u95f4\u53f3\u4f4d\u7f6e\u4e14y<=\u53f3\u533a\u95f4\u5de6\u4f4d\u7f6e\u540c\u65f6\u5de6\u533a\u95f4\u53f3\u4e3a2\uff0c\u53f3\u533a\u95f4\u5de6\u4e3a1\u65f6ans+1\u3002\n\n### \u4ee3\u7801\n\n```pascal\nvar a,c:array[0..800005,0..2] of longint;\n  b:array[0..200005] of char;\n  n,i,j,x,y,z,m:longint;\n  ch:char;\nprocedure build(l,r,k:longint);\nvar mid:longint;\nbegin\n  if l=r then\n    begin\n      c[k,0]:=l;c[k,2]:=l;\n      case b[l] of\n        '(':a[k,2]:=2;\n        ')':a[k,0]:=1;\n        'X':begin a[k,0]:=3;a[k,2]:=3;end;\n      end;\n      exit;\n    end;\n  mid:=(l+r) div 2;\n  build(l,mid,k*2);\n  build(mid+1,r,k*2+1);\n  a[k,1]:=a[k*2,1]+a[k*2+1,1];\n  if(a[k*2,2]=2)and(a[k*2+1,0]=1)then inc(a[k,1]);\n  if(a[k*2,0]=3)and(a[k*2,2]=3)then\n    begin\n      a[k,0]:=a[k*2+1,0];a[k,2]:=a[k*2+1,2];\n      c[k,0]:=c[k*2+1,0];c[k,2]:=c[k*2+1,2];\n    end\n  else\n  if(a[k*2+1,0]=3)and(a[k*2+1,0]=3)then\n    begin\n      a[k,0]:=a[k*2,0];a[k,2]:=a[k*2,2];\n      c[k,0]:=c[k*2,0];c[k,2]:=c[k*2,2];\n    end\n  else\n    begin\n      a[k,0]:=a[k*2,0];a[k,2]:=a[k*2+1,2];\n      if(a[k,0]<>3)and(a[k,2]=3)then a[k,2]:=0;\n      if(a[k,0]=3)and(a[k,2]<>3)then a[k,0]:=0;\n      c[k,0]:=c[k*2,0];c[k,2]:=c[k*2+1,2];\n    end;\nend;\nfunction find(l,r,k:longint):longint;\nvar mid,s1,s2:longint;\nbegin\n  if(x<=l)and(y>=r)then exit(a[k,1]);\n  s1:=0;s2:=0;\n  mid:=(l+r) div 2;\n  if x<=mid then s1:=find(l,mid,k*2);\n  if y>mid then s2:=find(mid+1,r,k*2+1);\n  if(a[k*2,2]=2)and(a[k*2+1,0]=1)and(c[k*2,2]>=x)and(c[k*2+1,0]<=y)then\n    find:=1 else find:=0;\n  find:=find+s1+s2;\nend;\nprocedure update(l,r,k:longint);\nvar mid:longint;\nbegin\n  if(l=x)and(r=x)then\n    begin\n      b[l]:=ch;\n      a[k,0]:=0;a[k,2]:=0;\n      case b[l] of\n       '(':a[k,2]:=2;\n       ')':a[k,0]:=1;\n       'X':begin a[k,0]:=3;a[k,2]:=3;end;\n      end;\n      exit;\n    end;\n  mid:=(l+r) div 2;\n  if x<=mid then update(l,mid,k*2)\n            else update(mid+1,r,k*2+1);\n  a[k,1]:=a[k*2,1]+a[k*2+1,1];\n  if(a[k*2,2]=2)and(a[k*2+1,0]=1)then inc(a[k,1]);\n  if(a[k*2,0]=3)and(a[k*2,2]=3)then\n    begin\n      a[k,0]:=a[k*2+1,0];a[k,2]:=a[k*2+1,2];\n      c[k,0]:=c[k*2+1,0];c[k,2]:=c[k*2+1,2];\n    end\n  else\n  if(a[k*2+1,0]=3)and(a[k*2+1,0]=3)then\n    begin\n      a[k,0]:=a[k*2,0];a[k,2]:=a[k*2,2];\n      c[k,0]:=c[k*2,0];c[k,2]:=c[k*2,2];\n    end\n  else\n    begin\n      a[k,0]:=a[k*2,0];a[k,2]:=a[k*2+1,2];\n      if(a[k,0]<>3)and(a[k,2]=3)then a[k,2]:=0;\n      if(a[k,0]=3)and(a[k,2]<>3)then a[k,0]:=0;\n      c[k,0]:=c[k*2,0];c[k,2]:=c[k*2+1,2];\n    end;\nend;\nbegin\n  readln(n,m);\n  b[1]:='(';b[n]:=')';\n  for i:= 2 to n-1 do b[i]:='X';\n  build(1,n,1);\n  for i:= 1 to m do\n    begin\n      read(z);\n      if z=2 then\n        begin\n          read(x,y);\n          writeln(find(1,n,1));\n        end;\n      if z=1 then\n        begin\n          read(x,ch);read(ch);\n          if b[x]<>ch then update(1,n,1);\n        end;\n    end;\nend.\n```",
        "postTime": 1583038972,
        "uid": 112921,
        "name": "zhimao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u7ebf\u6bb5\u6811\u4e2d\u7684\u4e00\u80a1\u6e05\u6d41\n\n\u6211\u53d1\u73b0\u6211\u7684\u4ee3\u7801\u8dd1\u7684\u8fd8\u633a\u5feb\uff0c\u4e0d\u5438\u6c271200\u591a\u6beb\u79d2\uff0c\u5438\u6c27800\u591a\u6beb\u79d2\n\n\u4f30\u8ba1\u6211\u7ef4\u62a4\u7684\u503c\u662f\u6700\u591a\u7684\u3002\u3002\u3002\n\n\u601d\u8def\u8ddf\u522b\u4eba\u4f3c\u4e4e\u4e0d\u5927\u4e00\u6837\uff0c\u628a\u6211\u7684\u505a\u6cd5\u4e5f\u8be6\u7ec6\u5730\u8bb2\u4e00\u4e0b\n\n#### \u7ef4\u62a4\uff1a\u5f53\u524d\u533a\u95f4\u5185\u53ef\u4ee5\u914d\u5bf9\u7684\u62ec\u53f7\u4e2a\u6570\uff08sum\uff09\n\n#### \u5f53\u524d\u533a\u95f4\u4ece\u5de6\u5f80\u53f3\u7b2c\u4e00\u4e2a\u62ec\u53f7\u7c7b\u578b\uff08lc\uff09\u53ca\u5176\u4f4d\u7f6e\uff08lp\uff091\u4e3a\u5de6\u62ec\u53f7\uff0c2\u4e3a\u53f3\u62ec\u53f7\uff0c0\u4e3aX\uff0c\u82e5\u4e0d\u5b58\u5728\u62ec\u53f7\u5219\u5747\u4e3a0\n\n#### \u5f53\u524d\u533a\u95f4\u4ece\u53f3\u5f80\u5de6\u7b2c\u4e00\u4e2a\u62ec\u53f7\u7c7b\u578b\uff08rc\uff09\u53ca\u5176\u4f4d\u7f6e\uff08rp\uff09\n\n#### \u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bbe\u8ba1\u5462\uff1f\u8981\u770b\u4e0b\u9762\n\n#### \u600e\u4e48\u5408\u5e76\u4fe1\u606f\u5462\uff1f\n\n\u5bf9sum\u800c\u8a00\uff0c\u5de6\u53f3\u7684sum\u76f4\u63a5\u76f8\u52a0\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u8fd8\u5e94\u8003\u8651\u5de6\u53f3\u533a\u95f4\u5728\u5408\u5e76\u65f6\u53ef\u80fd\u4f1a\u9020\u6210\u7684\u65b0\u7684\u8d21\u732e\n\n#### \u8fd9\u4e2a\u8d21\u732e\u53ea\u53ef\u80fd\u7531\u5de6\u533a\u95f4\u6700\u53f3\u7684\u5de6\u62ec\u53f7\u548c\u53f3\u533a\u95f4\u6700\u5de6\u7684\u53f3\u62ec\u53f7\u914d\u5bf9\u9020\u6210\n\n\u56e0\u6b64\u7ef4\u62a4lc,rc\n\nlc,rc\u5728\u7ef4\u62a4\u65f6\uff0c\u4e0d\u5e94\u7b80\u5355\u7684\u628alc\u548crc\u8bbe\u4e3a\u5de6\u513f\u5b50\u7684lc\u548c\u53f3\u513f\u5b50\u7684rc\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u4e3a0\n\n#### \u5982\u679c\u5de6\u513f\u5b50\u7684lc\u4e3a0\uff0c\u8bf4\u660e\u5de6\u513f\u5b50\u5168\u662f0\uff0c\u8fd9\u65f6\u8be5\u533a\u95f4\u7684lc\u53ea\u80fd\u662f\u53f3\u513f\u5b50\u7684lc\uff0crc\u7684\u7ef4\u62a4\u540c\u7406\n\n#### \u4e3a\u4ec0\u4e48\u8981\u7ef4\u62a4\u4f4d\u7f6e\u5462\uff1f\n\n\u5728\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u4e5f\u4e0d\u80fd\u7b80\u5355\u5730\u628a\u7b54\u6848\u76f8\u52a0\uff0c\u800c\u8981\u8003\u8651\u5de6\u533a\u95f4\u548c\u53f3\u533a\u95f4\u7684\u62ec\u53f7\u914d\u5bf9\u7684\u5f71\u54cd\uff0c\u4f46\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8003\u8651\u5de6\u53f3\u533a\u95f4\u7684lc\u548crc\n\n#### \u4e07\u4e00lc\u548crc\u7684\u4f4d\u7f6e\u8d85\u51fa\u4e86\u67e5\u8be2\u7684\u533a\u95f4\u8303\u56f4\u5462\uff1f \n\n#### \u56e0\u6b64\u5e94\u5f53\u8003\u8651\u5728\u67e5\u8be2\u533a\u95f4\u8303\u56f4\u5185\u7684lc\u548crc\uff0c\u5c31\u8981\u7ef4\u62a4\u4e24\u6b21\uff0crc\u7684\u4f4d\u7f6e\uff0c\u5373lp\u548crp\n\n\u8fd9\u4e2a\u8fd8\u6bd4\u8f83\u597d\u7ef4\u62a4\uff0c\u548clc\uff0crc\u4e00\u8d77\u66f4\u65b0\u5c31\u597d\u4e86\n\n\u4e0a\u9762\u5e94\u8be5\u5df2\u7ecf\u8bb2\u5f97\u5f88\u8be6\u7ec6\u4e86\uff0c\u4ee3\u7801\u91cc\u6211\u5c31\u4e0d\u653e\u6ce8\u91ca\u4e86\uff0c\u5982\u679c\u7406\u89e3\u4e86\u7684\u8bdd\uff0c\u4ee3\u7801\u5e94\u5f53\u662f\u80fd\u770b\u61c2\u7684\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=200005;\nint n,m;\nint sum[MAXN<<2],lc[MAXN<<2],rc[MAXN<<2];\nint lp[MAXN<<2],rp[MAXN<<2];\nvoid read(int& x)\n{\n\tchar c=getchar();\n\tx=0;\n\twhile(c<'0'||c>'9')\n\t{\n\t\tif(c=='(')\n\t\t{\n\t\t\tx=1;\n\t\t\treturn ;\n\t\t}\n\t\telse if(c=='X')\n\t\t{\n\t\t\tx=0;\n\t\t\treturn ;\n\t\t}\n\t\telse if(c==')')\n\t\t{\n\t\t\tx=2;\n\t\t\treturn ;\n\t\t}\n\t\telse c=getchar();\n\t}\n\twhile(c>='0'&&c<='9')\n\t{\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n}\nvoid update(int o)\n{\n\tsum[o]=sum[o<<1]+sum[o<<1|1];\n\tif(rc[o<<1]==1&&lc[o<<1|1]==2)sum[o]++;\n\tif(lc[o<<1])\n\t{\n\t\tlc[o]=lc[o<<1];\n\t\tlp[o]=lp[o<<1];\n\t}\n\telse\n\t{\n\t\tlc[o]=lc[o<<1|1];\n\t\tlp[o]=lp[o<<1|1];\n\t}\n\tif(rc[o<<1|1])\n\t{\n\t\trc[o]=rc[o<<1|1];\n\t\trp[o]=rp[o<<1|1];\n\t}\n\telse\n\t{\n\t\trc[o]=rc[o<<1];\n\t\trp[o]=rp[o<<1];\n\t}\n}\nvoid build(int o,int l,int r)\n{\n\tif(l==r)\n\t{\n\t\tsum[o]=0;\n\t\tif(l==1)\n\t\t{\n\t\t\tlc[o]=rc[o]=1;\n\t\t\tlp[o]=rp[o]=l;\n\t\t}\n\t\telse if(l==n)\n\t\t{\n\t\t\tlc[o]=rc[o]=2;\n\t\t\tlp[o]=rp[o]=l;\n\t\t}\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tbuild(o<<1,l,mid);\n\tbuild(o<<1|1,mid+1,r);\n\tupdate(o);\n}\nvoid change(int o,int l,int r,int p,int k)\n{\n\tif(l==r&&l==p)\n\t{\n\t\tsum[o]=0;\n\t\tlc[o]=rc[o]=k;\n\t\tif(!k)lp[o]=rp[o]=0;\n\t\telse lp[o]=rp[o]=l;\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tif(p<=mid)change(o<<1,l,mid,p,k);\n\telse change(o<<1|1,mid+1,r,p,k);\n\tupdate(o);\n}\nint query(int o,int l,int r,int ql,int qr)\n{\n\tif(ql<=l&&qr>=r)\n\t{\n\t\treturn sum[o];\n\t}\n\tint mid=(l+r)>>1,ansl=0,ansr=0;\n\tbool okl=0,okr=0;\n\tif(ql<=mid)\n\t{\n\t\tansl=query(o<<1,l,mid,ql,qr);\n\t\tif(rc[o<<1]==1&&rp[o<<1]>=ql)okl=1;\n\t}\n\tif(qr>mid)\n\t{\n\t\tansr=query(o<<1|1,mid+1,r,ql,qr);\n\t\tif(lc[o<<1|1]==2&&lp[o<<1|1]<=qr)okr=1;\n\t}\n\treturn ansl+ansr+(okl&okr);\n}\nint main()\n{\n\tread(n);\n\tread(m);\n\tbuild(1,1,n);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint op;\n\t\tread(op);\n\t\tif(op==1)\n\t\t{\n\t\t\tint p,k;\n\t\t\tread(p);\n\t\t\tread(k);\n\t\t\tchange(1,1,n,p,k);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint l,r;\n\t\t\tread(l);\n\t\t\tread(r);\n\t\t\tprintf(\"%d\\n\",query(1,1,n,l,r));\n\t\t}\n\t}\n}\n```\n",
        "postTime": 1552647012,
        "uid": 68207,
        "name": "CreeperLordVader",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5b9e\u5728\u662f\u592a\u5751\u4e86\uff0c\u6211\u4e00\u4e2a\u4e0b\u5348\u5c31\u6d6a\u8d39\u5728\u8fd9\u4e0a\u9762\u4e86\uff0c\u7ec8\u4e8e\u8fc7\u4e86\uff0c\u6765\u53d1\u9898\u89e3\n\n\u9898\u76ee\u95ee\u7684\u662f\u3010l\uff0cr\u3011\u4e4b\u4e2d\u62ec\u53f7\u7684\u5339\u914d\u6570\n\n\u6211\u4eec\u53ef\u4ee5\u7528posl\u3010g\u3011\u8868\u793a\u3010l\uff0cr\u3011\u533a\u95f4\u4e2d\u5de6\u62ec\u53f7\u7684\u4f4d\u7f6e\uff0cposr\u3010g\u3011\u3010l\uff0cr\u3011\u533a\u95f4\u4e2d\u53f3\u62ec\u53f7\u7684\u4f4d\u7f6e\n\n\u90a3\u4e48\u62ec\u53f7\u7684\u6570\u91cf\u5c31\u662f\u5de6\u533a\u95f4\u7684\u6570\u91cf\u52a0\u53f3\u533a\u95f4\u7684\u6570\u91cf\u52a0\u4e2d\u95f4\u7684\u6570\u91cf\uff1b\n\n\u96be\u70b9\u5c31\u5728\u7b54\u6848\u7684\u7edf\u8ba1\u548c\u4fee\u6539\uff0c\u8be6\u60c5\u89c1\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n#include<cstring>\n#include<iostream>\nusing namespace std;\nconst int maxn=1000000+10;\nint ls[maxn],rs[maxn],sum[maxn],posl[maxn],posr[maxn];\nint n,m,cnt,ans,root;\nvoid add(int &g,int l,int r,int ll,int rr,int opt)\n{\n    if(!g){g=++cnt;posl[g]=0;posr[g]=n+1;}\n    if(rr<l || r<ll)return;\n    if(ll<=l&&r<=rr){\n        if(opt==1){posl[g]=l;posr[g]=n+1;return;}\n        if(opt==2){posr[g]=l;posl[g]=0;return;}\n        if(opt==3){posl[g]=0;posr[g]=n+1;return;}\n    }int mid=l+r>>1;\n    add(ls[g],l,mid,ll,rr,opt);add(rs[g],mid+1,r,ll,rr,opt);\n    posl[g]=max(posl[ls[g]],posl[rs[g]]);posr[g]=min(posr[ls[g]],posr[rs[g]]);\n    if(sum[rs[g]]!=0)posl[g]=posl[rs[g]];\n    if(sum[ls[g]]!=0)posr[g]=posr[ls[g]];\n    sum[g]=sum[ls[g]]+sum[rs[g]];\n    if(posl[ls[g]]>0 && posr[rs[g]]<n+1)\n    {\n        sum[g]=sum[ls[g]]+sum[rs[g]]+1;\n        posl[g]=posl[rs[g]];posr[g]=posr[ls[g]];\n    }\n}\nvoid get(int &g,int l,int r,int ll,int rr)\n{\n    if(!g){g=++cnt;posl[g]=0;posr[g]=n+1;}\n    if(rr<l || r<ll)return;\n    if(ll<=l&&r<=rr){ans+=sum[g];return;}\n    int mid=l+r>>1;\n    get(ls[g],l,mid,ll,rr);get(rs[g],mid+1,r,ll,rr);\n    if(posl[ls[g]]>=ll && posr[rs[g]]<=rr)ans++;\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    add(root,1,n,1,1,1);add(root,1,n,n,n,2);\n    for(int i=1;i<=m;i++){\n        int opt,x,y;char c;\n        scanf(\"%d%d\",&opt,&x);\n        if(opt==1){\n            cin>>c;\n            if(c=='(')add(root,1,n,x,x,1);\n            if(c==')')add(root,1,n,x,x,2);\n            if(c=='X')add(root,1,n,x,x,3);\n        }\n        if(opt==2){\n            scanf(\"%d\",&y);\n            ans=0;get(root,1,n,x,y);printf(\"%d\\n\",ans);\n        }\n    }\n}\n```",
        "postTime": 1505985775,
        "uid": 25365,
        "name": "zhouenji",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "**\u7ebf\u6bb5\u6811**\n\n\u771f\u662f\u4e0d\u5bb9\u6613\u554a\u3002\u3002\u7ec8\u4e8e\u8fc7\u4e86\n\n\n\u5176\u5b9e\u60f3\u5230\u662f\u7ebf\u6bb5\u6811\u8fd8\u662f\u5f88\u597d\u505a\u7684\n\n\n\u201d\uff08\u201c  \u548c \u201c\uff09\u201d\u53ef\u4ee5\u914d\u5bf9\u6210\u4e00\u6761\u6728\u68d2\uff0c\u5f53\u4e14\u4ec5\u5f53\u4ed6\u4eec\u4e4b\u95f4\u6ca1\u6709\u5176\u4ed6\u7684\u201c\uff08\u201d\u6216\u201c\uff09\u201d\uff0c\u5373\u4e4b\u95f4\u90fd\u4e3aX\n\n\u6240\u4ee5\u5bf9\u4e8e\u533a\u95f4[L,R],\u4ed6\u7684\u5b8c\u6574\u6728\u68d2\u6570=\u5de6\u533a\u95f4\u5b8c\u6574\u6728\u68d2\u6570+\u53f3\u533a\u95f4\u5b8c\u6574\u6728\u68d2\u6570+ 1\u62160\u3010\u5982\u679c\u5de6\u533a\u95f4\u6700\u53f3\u4fa7\u4e3a\u201c\uff08\u201d\uff0c\u53f3\u533a\u95f4\u6700\u5de6\u4e3a\u201c\uff09\u201d\uff0c\u521a\u597d\u53ef\u4ee5\u51d1\u6210\u4e00\u4e2a\u6728\u68d2\uff0c\u5219\u8fd9\u91cc\u662f1\uff0c\u5426\u5219\u662f0\u3011\n\n\n\u7531\u6b64\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u7ebf\u6bb5\u6811\u6709\u4e09\u4e2a\u5c5e\u6027\uff1a\u533a\u95f4\u65b9\u6848\u4e66\uff0c\u533a\u95f4\u6700\u5de6\u7684\u975eX\u6728\u68d2\uff0c\u533a\u95f4\u6700\u53f3\u7684\u975eX\u6728\u68d2\n\n\u533a\u95f4[L,R]\u7684\u6700\u5de6\u975eX\u6728\u68d2=\u5de6\u533a\u95f4\u7684\u6700\u5de6\u975eX\u6728\u68d2\u3010\u82e5\u5de6\u533a\u95f4\u6700\u5de6\u4e5f\u6ca1\u6709\u975eX\u6728\u68d2\uff0c\u90a3\u4e48\u5c31\u7b49\u4e8e\u53f3\u533a\u95f4\u7684\u6700\u5de6\u975eX\u6728\u68d2\u3011\n\n\u6700\u53f3\u975eX\u6728\u68d2\u540c\u7406\n\n\n\u5177\u4f53\u5b9e\u73b0\u5728\u4ee3\u7801\uff1a\n\n\n\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<queue>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int maxn=200005,INF=2000000000;\nint Left[4*maxn],Right[4*maxn],sum[4*maxn],L,R,N; //Left\u5b58\u653e\u6700\u5de6\u975eX\u6728\u68d2,Right\u540c\u7406\uff0csum\u5b58\u653e\u5b8c\u6574\u6728\u68d2\u6570\n//1\u8868\u793a\u201c\uff08\u201d\uff0c2\u8868\u793a\u201c\uff09\u201d\uff0c0\u8868\u793a\u201cX\u201d\nint read()     //\u5feb\u901f\u8bfb\u5165\n{\n    int out=0,flag=1;\n    char c=getchar();\n    while(c<48||c>57) {if(c=='-') flag=-1;c=getchar();}\n    while(c>=48&&c<=57)\n    {\n        out=out*10+c-48;\n        c=getchar();\n    }\n    return out*flag;\n}\nclass node     //\u7528\u6765\u5728\u8be2\u95ee\u65f6\u5b58\u5de6\u53f3\u533a\u95f4\u4fe1\u606f\n{\n```\npublic:\n\n\n\n\n```cpp\n        int l,r,cnt;\n};\nvoid build(int u,int l,int r)       //\u521d\u59cb\u5316\n{\n    if(l==r)\n    {\n        if(l==1) Left[u]=Right[u]=1;\n        else if(r==N) Left[u]=Right[u]=2;\n        else Left[u]=Right[u]=0;\n        sum[u]=0;\n    }\n    else\n    {\n        int mid=(l+r)>>1;\n        build(u<<1,l,mid);\n        build(u<<1|1,mid+1,r);\n        Left[u]=Left[u<<1] ? Left[u<<1]:Left[u<<1|1];\n        Right[u]=Right[u<<1|1] ? Right[u<<1|1]:Right[u<<1];\n        sum[u]=sum[u<<1]+sum[u<<1|1]+(Right[u<<1]==1&&Left[u<<1|1]==2); //\u5982\u4e0a\u6240\u8ff0\u7684\u4ee3\u7801\u5b9e\u73b0\n    }\n}\nvoid change(int u,int l,int r,int cmd)   //\u5355\u70b9\u4fee\u6539\u3010\u867d\u7136\u6211\u8fd8\u662f\u5199\u6210\u533a\u95f4\u4fee\u6539\u7684\u6837\u5b50\u3011\n{\n    if(l>=L&&r<=R)\n    {\n        if(cmd==1) Left[u]=Right[u]=1;\n        else if(cmd==2) Left[u]=Right[u]=2;\n        else Left[u]=Right[u]=0;\n        sum[u]=0;\n    }\n    else\n    {\n        int mid=(l+r)>>1;\n        if(mid>=R) change(u<<1,l,mid,cmd);\n        else change(u<<1|1,mid+1,r,cmd);\n        Left[u]=Left[u<<1] ? Left[u<<1]:Left[u<<1|1];\n        Right[u]=Right[u<<1|1] ? Right[u<<1|1]:Right[u<<1];\n        sum[u]=sum[u<<1]+sum[u<<1|1]+(Right[u<<1]==1&&Left[u<<1|1]==2);\n    }\n}\nnode Query(int u,int l,int r)       //\u8be2\u95ee\n{\n    if(l>=L&&r<=R) return (node){Left[u],Right[u],sum[u]};\n    else\n    {\n        int mid=(l+r)>>1;\n        if(mid>=R) return Query(u<<1,l,mid);\n        else if(mid<L) return Query(u<<1|1,mid+1,r);\n        else\n        {\n            node tl=Query(u<<1,l,mid),tr=Query(u<<1|1,mid+1,r),t;\n            t.cnt=tl.cnt+tr.cnt+(tl.r==1&&tr.l==2);\n            t.l=tl.l ? tl.l:tr.l;\n            t.r=tr.r ? tr.r:tl.r;\n            return t;\n        }\n    }\n}\nint main()\n{\n    N=read();\n    int M=read(),cmd;\n    char c;\n    build(1,1,N);\n    while(M--)\n    {\n        cmd=read();\n        if(cmd==1)\n        {\n            L=R=read();\n            c=getchar();\n            while(c!='X'&&c!='('&&c!=')') c=getchar();\n            if(c==')') change(1,1,N,2);\n            else change(1,1,N,(c=='('));\n        }\n        else\n        {\n            L=read();\n            R=read();\n            printf(\"%d\\n\",Query(1,1,N).cnt);\n        }\n    }\n    return 0;\n}\n\n```",
        "postTime": 1497763348,
        "uid": 32842,
        "name": "Mychael",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    },
    {
        "content": "\u849f\u84bb\u6765\u53d1\u4e00\u4efd\u9898\u89e3\n\u5177\u4f53\u770b\u4ee3\u7801\u5199\u7684\u6bd4\u8f83\u9ebb\u70e6 \n```c\n#include<bits/stdc++.h>\nusing namespace std;\n#define maxn 600000+100//\u7ed3\u6784\u4f53\u6d88\u8017\u5185\u5b58\u597d\u5927 \u6211\u5f00\u4e86\u8fd9\u4e48\u5927\u624d\u53ef\u4ee5 \u5c0f\u7684\u8bdd\u540e\u9762\u7684\u6570\u636e\u5168\u90e8 re\nstruct ac{\n  int s,l,r; //(l=='('  r==')';\n  ac(){\n    s=0;\n    l=0;\n    r=0;\n  }\n  ac(int a,int b,int c){\n     s=a;\n     l=b;\n     r=c;\n  }\n}a[maxn*4];\nint n,m;\nvoid updata(int l,int r,int in,int va,int v){\n   if(r<1|r>n) return ;\n   if(l==r){\n      if(v==1) a[in]=ac(0,1,0);  \n      if(v==2) a[in]=ac(0,0,1);\n      if(v==3) a[in]=ac(0,0,0); //\u66f4\u65b0\u4e0d\u591a\u89e3\u91ca\n      return ;\n   }\n   int mid=(l+r)/2;\n   if(va>mid){\n      updata(mid+1,r,in*2+1,va,v);\n   }else{\n      updata(l,mid,in*2,va,v);\n   }\n   int x=a[in*2].s+a[in*2+1].s;\n   int y=a[in*2].l+a[in*2+1].r;            // \u770b\u5de6\u53f3\u80fd\u5426\u7ec4\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u62ec\u53f7\n   if(y==2){\n     a[in]=ac(x+1,a[in*2+1].l,a[in*2].r); //\u53ef\u4ee5\u7ec4\u6210\u91c7\u7528\u53f3\u513f\u5b50\u7684\u5de6\u62ec\u53f7\uff0c\u5de6\u513f\u5b50\u7684\u53f3\u62ec\u53f7\n   }else{\n     if(x!=0){  //\u5f53\u4ed6\u4eec\u5b58\u5728\u5b8c\u6574\u7684\u62ec\u53f7\u5bf9\u65f6 \n       if(a[in*2].s==0&&a[in*2].r==0){    // \u5b8c\u6574\u7684\u62ec\u53f7\u5bf9\u5728\u53f3\u533a\u95f4\u7684\u65f6\u5019\n          a[in]=ac(x,a[in*2+1].l,a[in*2+1].r);\n       }else if(a[in*2+1].s==0&&a[in*2+1].l==0){  //\u5728\u5de6\u533a\u95f4\u7684\u65f6\u5019\n          a[in]=ac(x,a[in*2].l,a[in*2].r);\n       }\n       else a[in]=ac(x,a[in*2+1].l,a[in*2].r); //\u5de6\u53f3\u533a\u95f4\u90fd\u5b58\u5728\n     }\n     else a[in]=ac(x,a[in*2+1].l|a[in*2].l,a[in*2+1].r|a[in*2].r);//\u5de6\u53f3\u90fd\u4e0d\u5b58\u5728\n   }\n}\nac query(int l,int r,int L,int R,int in){\n   if(l==L&&r==R){\n      return a[in];\n   }\n   int mid=(l+r)/2;\n   if(L>mid){         //\u8fd9\u4e2a\u5730\u65b9\u4e00\u5b9a\u8981\u5904\u7406\u597d \u56e0\u4e3a\u6211\u8fd4\u56de\u7684\u662f\u7ed3\u6784\u4f53\u6240\u4ee5\u8fd4\u56de\u7684\u542b\u6709\u8fd9\u4e2a\u533a\u95f4\u5de6\u53f3\u62ec\u53f7\u7684\u4fe1\u606f\n      return query(mid+1,r,L,R,in*2+1);\n   }else if(R<=mid){\n      return query(l,mid,L,R,in*2);\n   }        \n   //\u4e0b\u9762\u548c\u66f4\u65b0\u64cd\u4f5c\u7684\u4e00\u6837 \n   ac b=query(l,mid,L,mid,in*2);\n   ac c=query(mid+1,r,mid+1,R,in*2+1);\n   int x=b.s+c.s;\n   int y=b.l+c.r;\n   if(y==2){\n     return ac(x+1,c.l,b.r);\n   }\n   if(x!=0){\n       if(b.s==0&&b.r==0){\n          return ac(x,c.l,c.r);\n       }else if(c.s==0&&c.l==0){\n          return ac(x,b.l,b.r);\n       }\n       return ac(x,a[in*2+1].l,a[in*2].r);\n     }\n   return ac(x,c.l|b.l,c.r|b.r);\n}\nint main(){\n // FILE *fp;\n // fp=fopen(\"C://Users//Dcoder//Desktop//1.txt\",\"r+\");\n   cin>>n>>m;\n   //build(1,n,1);\n   updata(1,n,1,1,1);//\u76f8\u5f53\u4e8e\u4e24\u6b21\u66f4\u65b0 \u4e00\u6b21\u5f00\u5934 \u4e00\u6b21\u7ed3\u5c3e\n   updata(1,n,1,n,2);\n   while(m--){\n      int x;\n      cin>>x;\n      if(x==2){\n         int l,r;\n         cin>>l>>r;\n       //  fprintf(fp,\"%d\\n\",query(1,n,l,r,1).s);\n         cout<<query(1,n,l,r,1).s<<endl;\n      }else{\n         char c;\n         int y;\n         cin>>y>>c;\n         if(c=='X'){\n            updata(1,n,1,y,3);\n         }else if(c=='('){\n            updata(1,n,1,y,1);\n         }else{\n            updata(1,n,1,y,2);\n         }\n      }\n   }\n   //fclose(fp);\n   return 0;\n}\n\n```",
        "postTime": 1531194357,
        "uid": 36983,
        "name": "Dvelpro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3797 \u3010\u5996\u68a6\u65a9\u6728\u68d2\u3011"
    }
]