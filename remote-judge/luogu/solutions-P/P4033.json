[
    {
        "content": "\u4e00\u9053\u795e\u5947\u7684Matrix-Tree\u5b9a\u7406\u9898\u2026\u2026\n________________\n\n## \u524d\u7f6e\u829d\u58eb:\u77e9\u9635\u6811\u5b9a\u7406\n\n\u86e4\uff1f\u505acp\u9898\u4e0d\u4f1a\u77e9\u9635\u6811\u5b9a\u7406?\u5982\u679c\u4e0d\u4f1a\u7684\u8bdd\u8bf7\u81ea\u884c\u5ea6\u5a18\n\n### \u672c\u9898\u9898\u89e3\n\n\u5148\u6765\u7b80\u8ff0\u4e00\u4e0b\u9898\u610f\uff0c\u7ed9\u4f60\u4e00\u5f20\u7f51\u683c\u56fe\uff0c\u6bcf\u4e2a\u683c\u5b50\u4e0a\u6709\u4e00\u4e2a\u7bad\u5934\uff0c\u8fd8\u6709\u4e00\u4e9b\u683c\u5b50\u662f\u4e0d\u5b9a\u5411\u7684\uff0c\u73b0\u5728\u5e0c\u671b\u7ed9\u8fd9\u4e9b\u683c\u5b50\u5b9a\u5411\uff0c\u4f7f\u5f97\u8fd9\u5f20\u7f51\u683c\u56fe\u5f53\u4e2d\u4e0d\u5b58\u5728\u73af\uff0c\u6c42\u5408\u6cd5\u7684\u5b9a\u5411\u65b9\u6848\u6570\n\n\u6211\u4eec\u8003\u8651\u5c06\u8fd9\u5f20\u7f51\u683c\u56fe\u8f6c\u5316\u6210\u4e00\u4e2a\u771f\u6b63\u7684\u56fe\u2026\u2026\n\n\u90a3\u4e48\u5efa\u56fe\u65b9\u6cd5\u4f9d\u7136\u5f88\u7b80\u5355\uff0c\u539f\u6765\u7f51\u683c\u56fe\u4e0a\u7684\u70b9\u8fd8\u662f\u539f\u6765\u7684\u70b9\uff0c\u7136\u540e\u5982\u679c\u8fd9\u4e2a\u70b9\u4e0a\u5199\u7740L\u7684\u8bdd\u5c31\u628a\u8fd9\u4e2a\u70b9\u548c\u5b83\u5de6\u8fb9\u7684\u70b9\u8fde\u6709\u5411\u8fb9\uff0c\u5199\u7740R\u7684\u8bdd\u5c31\u628a\u8fd9\u4e2a\u70b9\u548c\u5b83\u53f3\u8fb9\u7684\u70b9\u8fde\u6709\u5411\u8fb9,\u5199\u7740U\u7684\u8bdd\u5c31\u628a\u8fd9\u4e2a\u70b9\u548c\u5b83\u4e0a\u8fb9\u7684\u70b9\u8fde\u6709\u5411\u8fb9\uff0c\u5199\u7740D\u7684\u8bdd\u5c31\u628a\u8fd9\u4e2a\u70b9\u548c\u5b83\u4e0b\u8fb9\u7684\u70b9\u8fde\u6709\u5411\u8fb9\n\n\u7136\u540e\u65b0\u5efa\u4e00\u4e2a\u865a\u70b9\u8868\u793a\"\u5916\u9762\u7684\u533a\u57df\",\u4e5f\u5c31\u662f\u5982\u679c\u5728\u521a\u624d\u7684\u5efa\u56fe\u65b9\u5f0f\u5f53\u4e2d\u4e0a/\u4e0b/\u5de6\u53f3\u8fb9\u7684\u70b9\u4e0d\u5b58\u5728\u7684\u8bdd\u6211\u4eec\u5c31\u5c06\u8fd9\u4e2a\u70b9\u548c\u8fd9\u4e2a\u8868\u793a\u5916\u9762\u7684\u70b9\u8fde\u6709\u5411\u8fb9\n\n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\u5982\u6b64\u8fd9\u822c\u8f6c\u5316\u540e\u7684\u65b0\u56fe\u6ee1\u8db3\u4e24\u4e2a\u6027\u8d28\n\n1.\u5982\u679c\u8fd9\u5f20\u56fe\u5408\u6cd5\u7684\u8bdd\u56fe\u4e2d\u662f\u6ca1\u6709\u73af\u7684\n\n2.\u5982\u679c\u8fd9\u5f20\u56fe\u5408\u6cd5\u7684\u8bdd\uff0c\u56fe\u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u90fd\u5b58\u5728\u4e00\u6761\u5230\u8fbe\u8868\u793a\u5916\u90e8\u7684\u865a\u70b9\u7684\u6709\u5411\u8def\u5f84\n\n~~(\u5176\u5b9e\u4e0a\u8fb9\u4e24\u53e5\u90fd\u662f\u5e9f\u8bdd)~~\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u56fe\u6709\u4e00\u4e2a\u66f4\u52a0\u91cd\u8981\u7684\u6027\u8d28\u662f\u8fd9\u4e2a\u56fe\u53ea\u6709$nm$\u6761\u8fb9\u5374\u6709$nm+1$\u4e2a\u70b9\uff0c\u53e6\u5916\u6240\u6709\u7684\u70b9(\u9664\u4e86\u865a\u70b9\u4f8b\u5916)\u7684\u51fa\u5ea6\u90fd\u4e3a1\n\n\u8fd9\u4e9b\u6027\u8d28\u6307\u5411\u4e86\u4e00\u4e2a\u5171\u540c\u7684\u7ed3\u8bba\uff0c\u5c31\u662f\u4e00\u5f20\u5408\u6cd5\u7684\u56fe\u8f6c\u5316\u4e4b\u540e\u5fc5\u7136\u662f\u4e00\u5f20\u6709\u5411\u7684\u6811\u5f62\u56fe\uff0c\u5e76\u4e14\u4ee5\u6211\u4eec\u65b0\u5efa\u7684\u865a\u70b9\u4e3a\u6839\n\n\u90a3\u4e48\u6b64\u65f6\u7684\u95ee\u9898\u5f00\u59cb\u6e10\u6e10\u53d8\u5f97\u660e\u6717\u8d77\u6765\u4e86\uff0c\u6211\u4eec\u73b0\u5728\u7684\u76ee\u6807\u5c31\u662f\u5bf9\u6811\u5f62\u56fe\u8ba1\u6570\uff0c\u8fd9\u4e2a\u95ee\u9898\u662f\u6709\u660e\u786e\u7684$O(n^3)$\u7b97\u6cd5\u7684\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u77e9\u9635\u6811\u5b9a\u7406\u6765\u6c42\u89e3\n\n\u4f46\u662f\u4f3c\u4e4e\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u5982\u679c\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2a\u65b9\u5411\u672a\u77e5\u7684\u70b9\u5411\u56db\u5468\u8fde4\u6761\u6709\u5411\u8fb9\uff0c\u7136\u540e\u5176\u4f59\u70b9\u6b63\u5e38\u8fde\u8fb9\uff0c\u6700\u540e\u8dd1\u4e00\u8d9f\u77e9\u9635\u6811\u5b9a\u7406\u8fdb\u884c\u6811\u5f62\u56fe\u8ba1\u6570\u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u5f97\u5230\u4e00\u4e2a\u4f18\u79c0\u7684$O(n^3m^3)$\u7684\u66b4\u529b\n\n\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u5b9e\u5728\u662f\u4e0d\u4f18\u79c0\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u60f3\u4e00\u4e9b\u66f4\u52a0\u673a\u667a\u7684\u7b97\u6cd5\n\n\u7a81\u7136\u53d1\u73b0\u65b9\u5411\u672a\u5b9a\u7684\u70b9\u6700\u591a\u53ea\u6709300\u4e2a\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u662f\u4e0d\u662f\u53ef\u4ee5\u628a\u8fd9\u5f20\u56fe\u7f29\u4e00\u7f29\u70b9\uff0c\u53ea\u4fdd\u7559\u5173\u4e8e\u672a\u77e5\u70b9\u7684\u4fe1\u606f\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\u5c31\u662f\uff0c\u6211\u4eec\u4e00\u65e6\u8d70\u5230\u4e86\u67d0\u4e00\u4e2a\u70b9i\uff0cj\u4e4b\u540e\u63a5\u4e0b\u6765\u7684\u8d70\u6cd5\u5b8c\u5168\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u800c\u548c\u6211\u600e\u4e48\u8d70\u5230\u8fd9\u4e2ai\uff0cj\u65e0\u5173\n\n\u56e0\u6b64\u8fd9\u5f20\u56fe\u4e0a\u7684\u4e00\u6761\u8def\u5f84\u662f\u5426\u5b58\u5728\u4ec5\u4ec5\u548c\u8fd9\u6761\u8def\u5f84\u4e0a\u7684\u4e0d\u5b9a\u5411\u70b9\u7684\u51b3\u7b56\u662f\u5426\u6b63\u786e\u6709\u5173\n\n\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u6a21\u62df/dfs\u627e\u51fa\u4e00\u4e2a\u4e0d\u5b9a\u5411\u70b9\u5728\u5b9a\u5411\u4e3a/\u4e0a/\u4e0b/\u5de6/\u53f3\u4e4b\u540e\u7b2c\u4e00\u4e2a\u5230\u8fbe\u7684\u672a\u5b9a\u5411\u70b9(\u6216\u8005\u662f\u90a3\u4e2a\u8868\u793a\u5916\u754c\u7684\u865a\u70b9)\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u70b9\u548c\u8fd9\u4e2a\u70b9\u4e00\u4e2a\u5230\u8fbe\u7684\u70b9\u8fde\u4e00\u6761\u8fb9(\u8fd9\u6837\u7684\u8bdd\u603b\u8ba1\u4e00\u4e2a\u70b9\u4f1a\u8fde4\u6761\u8fb9)\n\n\u90a3\u4e48\u6211\u4eec\u5bf9\u8fd9\u6837\u5efa\u51fa\u7684\u56fe\u8dd1\u77e9\u9635\u6811\u5b9a\u7406\u5f97\u51fa\u7684\u751f\u6210\u6811\u65b9\u6848\u6811\u548c\u539f\u56fe\u4e2d\u7684\u751f\u6210\u6811\u65b9\u6848\u6811\u5c06\u4f1a\u662f\u76f8\u7b49\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd9\u4e48\u505a\u76f8\u5f53\u4e8e\u628a\u539f\u56fe\u4e2d\u5df2\u7ecf\u662f\u6811\u7684\u90e8\u5206\u53bb\u6389\u4e86\u800c\u76f4\u63a5\u5728\u4e0d\u786e\u5b9a\u7684\u70b9\u4e4b\u95f4\u8fde\u8fb9\n\n\u6b64\u65f6\u6211\u4eec\u7684\u590d\u6742\u5ea6\u662f$O(T((n+m)nm+k^3))$\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u4e86\n\n\u4e0d\u8fc7\u5982\u679c\u4f60\u5e38\u6570\u5927\u4e00\u70b9\u7684\u8bdd\u53ef\u80fd\u5c31T\u98de\u4e86\u2026\u2026\n\n\u60f3\u8981\u4f18\u5316\u590d\u6742\u5ea6\u7684\u8bdd\u53ef\u4ee5\u628a\u521a\u624d\u7684\u7206\u641c\u6539\u6210\u8bb0\u5fc6\u5316\u7206\u641c\uff0c\u6b64\u65f6\u7684\u590d\u6742\u5ea6\u5c31\u53d8\u6210\u4e86$O(T(nm+k^3))$\u5c31\u53ef\u4ee5\u8f7b\u677e\u7684\u901a\u8fc7\u672c\u9898\u8fa3~\n\ntips:\u7ed9\u6709\u5411\u56fe\u505a\u6811\u5f62\u56fe\u7edf\u8ba1\u7684\u8bdd\uff0c\u5bf9\u4e8e\u8fd9\u9053\u9898\u7684\u8bdd\u6211\u4eec\u7684\u57fa\u5c14\u970d\u592b\u77e9\u9635\u5e94\u8be5\u662f\u5165\u5ea6\u77e9\u9635-\u4e34\u63a5\u77e9\u9635\uff0c\u800c\u6c42\u884c\u5217\u5f0f\u65f6\u5220\u6389\u7684\u4e00\u884c\u4e00\u5217\u4e5f\u4e0d\u518d\u662f\u968f\u4fbf\u5220\u800c\u662f\u5220\u53bb\u6811\u5f62\u56fe\u7684\u6839(\u672c\u9898\u4e2d\u5c31\u662f\u6211\u4eec\u5efa\u7684\u90a3\u4e2a\u865a\u70b9)\n\ntips:\u8bb0\u5f97\u5728\u8fd9\u5f20\u56fe\u4e2d\u6709\u73af\u7684\u65f6\u5019\u8f93\u51fa0\n\n\u4e0a\u4ee3\u7801~\n\n```C\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=310;typedef long long ll;const ll mod=1e9+7;\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod)if(p&1)r=r*a%mod;return r;}\nint n;int m;int tr[N][N];int ctt;ll kr[N][N];char mde[N][N];int id[N][N];int T;\nint dx[4]={0,0,-1,1};int dy[4]={-1,1,0,0};\ninline ll det()//\u9ad8\u65af\u524a\u5143\u6c42\u884c\u5217\u5f0f \n{\n\tll res=1;int t=0;for(int i=1;i<ctt;i++)for(int j=1;j<ctt;j++)(kr[i][j]+=mod)%=mod;\n\tfor(int i=1;i<ctt;i++)\n\t{\n\t\tif(kr[i][i]==0)for(int j=i+1;j<ctt;j++)\n\t\t\tif(kr[j][i]!=0){for(int k=i;k<ctt;k++)swap(kr[j][k],kr[i][k]);t^=1;break;}\n\t\tif(kr[i][i]==0)return 0;(res*=kr[i][i])%=mod;ll inv=po(kr[i][i],mod-2);\n\t\tfor(int j=i;j<ctt;j++)(kr[i][j]*=inv)%=mod;\n\t\tfor(int j=1;j<ctt;j++)\n\t\t\tif(i!=j)for(int k=ctt-1;k>=i;k--)(kr[j][k]+=mod-kr[i][k]*kr[j][i]%mod)%=mod;\n\t}return t?(mod-res)%mod:res;\n}\ninline void add(int u,int V){kr[u][u]++;kr[u][V]--;}\ninline int dfs(int px,int py)//\u8bb0\u5fc6\u5316\u641c\u7d22\u51fa\u4ece\u6bcf\u4e2a\u70b9\u51fa\u53d1\u540e\u5230\u8fbe\u7684\u7b2c\u4e00\u4e2a\u672a\u5b9a\u5411\u70b9/\u865a\u70b9 \n{\n\tif(px<1||px>n||py<1||py>m)return ctt;if(tr[px][py]!=0)return tr[px][py];\n\tswitch(mde[px][py])\n\t{\n\t\tcase 'L':{tr[px][py]=dfs(px+dx[0],py+dy[0]);break;}\n\t\tcase 'R':{tr[px][py]=dfs(px+dx[1],py+dy[1]);break;}\n\t\tcase 'U':{tr[px][py]=dfs(px+dx[2],py+dy[2]);break;}\n\t\tcase 'D':{tr[px][py]=dfs(px+dx[3],py+dy[3]);break;}\n\t}return tr[px][py];\n}\ninline bool dfs(int px,int py,int col)//dfs\u5224\u73af \n{\n\tif(px<1||px>n||py<1||py>m)return true;\n\tif(id[px][py]==col)return false;if(id[px][py]!=0)return true;id[px][py]=col;\n\tswitch(mde[px][py])\n\t{\n\t\tcase 'L':{return dfs(px+dx[0],py+dy[0],col);break;}\n\t\tcase 'R':{return dfs(px+dx[1],py+dy[1],col);break;}\n\t\tcase 'U':{return dfs(px+dx[2],py+dy[2],col);break;}\n\t\tcase 'D':{return dfs(px+dx[3],py+dy[3],col);break;}\n\t}return true;\n}\ninline void solve()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%s\",mde[i]+1);\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)if(mde[i][j]=='.')tr[i][j]=++ctt;++ctt;\n\tfor(int i=1,c=0;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)if(id[i][j]==0&&dfs(i,j,++c)==false){printf(\"0\\n\");return;}\n\tfor(int i=1;i<=n;i++)//\u5efa\u56fe \n\t\tfor(int j=1;j<=m;j++)if(mde[i][j]=='.')for(int k=0;k<4;k++)add(tr[i][j],dfs(i+dx[k],j+dy[k]));\n\tprintf(\"%lld\\n\",det());//\u8dd1\u77e9\u9635\u6811\u5b9a\u7406 \n}\ninline void clear()\n{\n\tfor(int i=1;i<=ctt;i++)for(int j=1;j<=ctt;j++)kr[i][j]=0;ctt=0;\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)id[i][j]=0;\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)tr[i][j]=0;\n}\nint main(){scanf(\"%d\",&T);for(int z=1;z<=T;z++)solve(),clear();return 0;}//\u62dc\u62dc\u7a0b\u5e8f~ \n\n\n```\n\n\n\n",
        "postTime": 1536838395,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4033 \u3010[Code+#2]\u767d\u91d1\u5143\u9996\u4e0e\u72ec\u821e\u3011"
    },
    {
        "content": "&emsp;&emsp;[\u63a8\u9500\u535a\u5ba2 owo](https://www.cnblogs.com/rainybunny/p/13224064.html)\u3002\n# $\\mathcal{Description}$\n&emsp;&emsp;[link](https://www.luogu.com.cn/problem/P4033).  \n&emsp;&emsp;\u7ed9\u5b9a\u4e00\u4e2a $n\\times m$ \u7684\u7f51\u683c\u56fe\uff0c\u4e00\u4e9b\u683c\u5b50\u6307\u5b9a\u4e86\u8d70\u51fa\u8be5\u683c\u7684\u65b9\u5411\uff08\u4e0a\u4e0b\u5de6\u53f3\uff09\uff0c\u800c\u6709 $k$ \u683c\u53ef\u4ee5\u4efb\u610f\u6307\u5b9a\u8d70\u51fa\u65b9\u5411\u3002\u6c42\u6307\u5b9a\u7684\u65b9\u6848\u6570\uff0c\u4f7f\u5f97\u4ece\u4efb\u610f\u683c\u5b50\u90fd\u53ef\u4ee5\u8d70\u51fa\u7f51\u683c\u56fe\u3002  \n&emsp;&emsp;$n,m\\le200;k\\le300$\u3002\n# $\\mathcal{Solution}$\n&emsp;&emsp;\u4ee4\u201c\u8d70\u51fa\u8fb9\u754c\u201d\u4e3a\u8d70\u5230\u4e00\u4e2a\u7279\u6b8a\u70b9\uff0c\u5efa\u56fe\uff0c\u5176\u4e2d\u672a\u6307\u5b9a\u65b9\u5411\u7684\u70b9\u5411\u56db\u5468\u8fde\u8fb9\uff0c\u76f8\u5f53\u4e8e\u6c42\u4ee5\u7279\u6b8a\u70b9\u4e3a\u6839\u7684**\u5185\u5411\u6811**\u4e2a\u6570\uff0c\u8dd1\u77e9\u9635\u6811\u5b9a\u7406\u5373\u53ef\u3002\u590d\u6742\u5ea6 $\\mathcal O(n^3m^3)$\u3002  \n&emsp;&emsp;\u8003\u8651\u4f18\u5316\uff0c\u751f\u6210\u6811\u4e2a\u6570\u5b9e\u8d28\u4e0a\u53ea\u4e0e\u4e0d\u5b9a\u5411\u7684\u70b9\u6709\u5173\uff0c\u6240\u4ee5\u76f4\u63a5\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u4e0d\u5b9a\u5411\u70b9\u5411\u4e0a/\u4e0b/\u5de6/\u53f3\u8d70\u5230\u7684\u7b2c\u4e00\u4e2a\u4e0d\u5b9a\u5411\u70b9\uff0c\u5411\u5176\u8fde\u8fb9\uff0c\u518d\u8dd1\u77e9\u9635\u6811\u3002\u590d\u6742\u5ea6 $\\mathcal O(k^3)$\u3002\n## $\\mathcal{Code}$\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n\nconst int MOD = 1e9 + 7, MAXN = 200, MAXP = 300;\nint T, N, M, K[MAXP + 5][MAXP + 5], col[MAXN + 5][MAXN + 5], unk[MAXN + 5][MAXN + 5], cnt;\nchar gar[MAXN + 5][MAXN + 5];\n\ninline int qkpow ( int a, int b, const int p = MOD ) {\n\tint ret = 1;\n\tfor ( ; b; a = 1ll * a * a % p, b >>= 1 ) ret = 1ll * ret * ( b & 1 ? a : 1 ) % p;\n\treturn ret;\n}\n\ninline int det ( const int n ) {\n\tint ret = 1, swp = 1;\n\tfor ( int i = 2; i <= n; ++ i ) {\n\t\tfor ( int j = i; j <= n; ++ j ) {\n\t\t\tif ( K[j][i] ) {\n\t\t\t\tif ( i ^ j ) std::swap ( K[i], K[j] ), swp *= -1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif ( ! ( ret = 1ll * ret * K[i][i] % MOD ) ) return 0;\n\t\tfor ( int j = i + 1, inv = qkpow ( K[i][i], MOD - 2 ); j <= n; ++ j ) {\n\t\t\tint d = 1ll * K[j][i] * inv % MOD;\n\t\t\tfor ( int k = i; k <= n; ++ k ) K[j][k] = ( K[j][k] - 1ll * K[i][k] * d % MOD + MOD ) % MOD;\n\t\t}\n\t}\n\treturn ( ret * swp + MOD ) % MOD;\n}\n\ninline bool findLoop ( const int x, const int y, const int cur ) {\n\tif ( x < 1 || x > N || y < 1 || y > M || gar[x][y] == '.' ) return false;\n\tif ( col[x][y] == cur ) return true;\n\tif ( col[x][y] ) return false;\n\tcol[x][y] = cur;\n\tif ( gar[x][y] == 'L' ) return findLoop ( x, y - 1, cur );\n\tif ( gar[x][y] == 'R' ) return findLoop ( x, y + 1, cur );\n\tif ( gar[x][y] == 'U' ) return findLoop ( x - 1, y, cur );\n\tif ( gar[x][y] == 'D' ) return findLoop ( x + 1, y, cur );\n\treturn false;\n}\n\ninline int findUnknown ( const int x, const int y ) {\n\tif ( x < 1 || x > N || y < 1 || y > M ) return 1;\n\tif ( unk[x][y] ) return unk[x][y];\n\tint& ret = unk[x][y];\n\tif ( gar[x][y] == 'L' ) ret = findUnknown ( x, y - 1 );\n\tif ( gar[x][y] == 'R' ) ret = findUnknown ( x, y + 1 );\n\tif ( gar[x][y] == 'U' ) ret = findUnknown ( x - 1, y );\n\tif ( gar[x][y] == 'D' ) ret = findUnknown ( x + 1, y );\n\treturn ret;\n}\n\ninline void add ( const int s, int t ) {\n\tif ( ! t ) t = 1;\n\t++ K[s][s], -- K[s][t];\n\tif ( K[s][t] < 0 ) K[s][t] += MOD;\n}\n\nint main () {\n\tfor ( scanf ( \"%d\", &T ); T --; ) {\n\t\tmemset ( K, 0, sizeof K );\n\t\tmemset ( col, 0, sizeof col );\n\t\tmemset ( unk, 0, sizeof unk );\n\t\tscanf ( \"%d %d\", &N, &M ), cnt = 1;\n\t\tfor ( int i = 1; i <= N; ++ i ) {\n\t\t\tscanf ( \"%s\", gar[i] + 1 );\n\t\t\tfor ( int j = 1; j <= M; ++ j ) {\n\t\t\t\tif ( gar[i][j] == '.' ) {\n\t\t\t\t\tunk[i][j] = ++ cnt;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tbool loop = false;\n\t\tfor ( int i = 1, cur = 1; i <= N && ! loop; ++ i ) {\n\t\t\tfor ( int j = 1; j <= M && ! loop; ++ j ) {\n\t\t\t\tloop |= findLoop ( i, j, cur ++ );\n\t\t\t}\n\t\t}\n\t\tif ( loop ) { puts ( \"0\" ); continue; }\n\t\tfor ( int i = 1; i <= N; ++ i ) {\n\t\t\tfor ( int j = 1; j <= M; ++ j ) {\n\t\t\t\tfindUnknown ( i, j );\n\t\t\t}\n\t\t}\n\t\tfor ( int i = 1; i <= N; ++ i ) {\n\t\t\tfor ( int j = 1; j <= M; ++ j ) {\n\t\t\t\tif ( gar[i][j] == '.' ) {\n\t\t\t\t\tadd ( unk[i][j], unk[i][j - 1] );\n\t\t\t\t\tadd ( unk[i][j], unk[i][j + 1] );\n\t\t\t\t\tadd ( unk[i][j], unk[i - 1][j] );\n\t\t\t\t\tadd ( unk[i][j], unk[i + 1][j] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintf ( \"%d\\n\", det ( cnt ) );\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1593665956,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4033 \u3010[Code+#2]\u767d\u91d1\u5143\u9996\u4e0e\u72ec\u821e\u3011"
    }
]