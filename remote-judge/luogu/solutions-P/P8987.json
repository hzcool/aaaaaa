[
    {
        "content": "[\u9898\u4f20](https://www.luogu.com.cn/problem/P8987)\n\n\u524d\u6392\u819c\u62dc [cp152](https://www.luogu.com.cn/user/171544)\u3002\n\n\u6ca1\u6709 1 \u64cd\u4f5c\u600e\u4e48\u529e\uff1f\u7ebf\u6bb5\u6811\u76f4\u63a5\u6253 tag\uff01\n\n\u6ca1\u6709 2 \u64cd\u4f5c\u600e\u4e48\u529e\uff1f\u6211\u4f1a\u5409\u8001\u5e08\u7ebf\u6bb5\u6811\uff01\n\n\u73b0\u5728\u5c06\u4e24\u79cd\u505a\u6cd5\u5408\u5e76\u8d77\u6765\u3002\n\n\u6ce8\u610f\u5230\u5409\u8001\u5e08\u7ebf\u6bb5\u6811\u5728 2 \u64cd\u4f5c\u7684\u5f71\u54cd\u4e0b\u52bf\u80fd\u5206\u6790\u4f1a\u5047\u6389\uff0c\u56e0\u6b64\u9700\u8981\u8003\u8651\u53e6\u4e00\u4e9b\u5947\u602a\u7684\u505a\u6cd5\u3002\n\n\u5c06\u64cd\u4f5c 1 \u62bd\u8c61\u6210\u628a\u5f88\u591a\u4e2a\u4e0d\u540c\u7684\u989c\u8272\u5f52\u5230\u540c\u4e00\u4e2a\u989c\u8272\u4e2d\u3002\u800c\u64cd\u4f5c 2 \u662f\u6211\u4eec\u5c06\u4e0d\u964d\u5e8f\u5217\u8f6c\u5316\u4e3a\u5355\u589e\u5e8f\u5217\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u8fdb\u800c\u63a8\u51fa\u64cd\u4f5c 2 \u5bf9\u4e8e\u4e00\u4e2a\u6709\u5e8f\u7684\u5e8f\u5217\uff0c\u5176\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5185\u90e8\u6709\u5e8f\u6027\u3002\n\n\u53d1\u73b0\u4e24\u79cd\u64cd\u4f5c\u90fd\u662f\u5168\u5c40\u7684\uff0c\u90a3\u4e48\u989c\u8272\u6bb5\u6570\u91cf\u53ea\u4f1a\u4e0d\u65ad\u51cf\u5c11\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u53bb\u66b4\u529b\u7ef4\u62a4\u8fd9\u4e9b\u6bb5\uff0c\u64cd\u4f5c 1 \u603b\u662f\u5c06**\u6240\u6709**\u5927\u7684\u5408\u5e76\u5230\u5c0f\u7684\uff0c\u53cd\u8fc7\u6765\u8bf4\uff0c\u6211\u4eec\u5c06\u4e00\u4e2a\u540e\u7f00\u82e5\u5e72\u4e2a\u4e0d\u964d\u6bb5\u5408\u5e76\u5230\u4e86\u4e00\u8d77\uff0c\u5e76\u4e14\u8fd9\u4e9b\u6bb5\u4ee5\u540e\u4e0d\u4f1a\u518d\u5206\u88c2\u5f00\uff08\u56e0\u4e3a 2 \u64cd\u4f5c\u4e0d\u4f1a\u5bf9\u4e00\u4e2a\uff09\uff0c\u6216\u8005\u662f\u628a\u540e\u9762\u4e00\u6574\u4e2a\u4e0d\u964d\u7684\u6bb5\u7684\u672b\u5c3e\u201c\u524a\u5e73\u201d\u3002\n\n\u5bf9\u4e8e 1 \u64cd\u4f5c\uff0c\u6211\u4eec\u73c2\u4ee5\u53ea\u7ef4\u62a4\u5176\u5bf9\u6700\u5927\u7684\u90a3\u4e2a\u96c6\u5408 $M$ \u7684\u5f71\u54cd\uff0c\u56e0\u4e3a\u5176\u5355\u8c03\u4e0d\u964d\uff0c\u6240\u4ee5\u76f4\u63a5\u5728\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u7136\u540e\u533a\u95f4\u63a8\u5e73\u5373\u53ef\u3002\n\n\u5bf9\u4e8e 2 \u64cd\u4f5c\uff0c\u5bf9\u4e8e\u5728 $M$ \u5185\u548c\u4e0d\u5728 $M$ \u5185\u7684\u90fd\u6b63\u5e38\u6253 tag \u5c31\u884c\uff08\u6ce8\u610f\u4e24\u4e2a\u7684\u8981\u5206\u5f00\uff0c\u56e0\u4e3a $M$ \u5185\u8fd8\u6709\u4e2a\u63a8\u5e73\u6807\u8bb0\uff09\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651 $a_i$ \u52a0\u5165 $M$ \u7684\u65f6\u95f4\uff0c\u8003\u8651\u4e8c\u5206\uff0c\u8bb0 $b_i$ \u4e3a\u7b2c $i$ \u6b21 1 \u64cd\u4f5c\u524d 2 \u64cd\u4f5c\u7684\u6570\u91cf\uff0c\u5219\u4e8c\u5206\u6761\u4ef6\u4e3a $\\exists j\\in [1, mid], b_j \\times i +a_i \\ge v_j$\uff0c\u6539\u4e00\u4e0b\u53d8\u4e3a $\\min_{j \\in[1, mid]}\\{-b_j \\times i+v_j\\} \\le a_i$\uff0c\u53ef\u6301\u4e45\u5316\u674e\u8d85\u7ebf\u6bb5\u6811\u6216\u8005\u6574\u4f53\u4e8c\u5206\u5957\u674e\u8d85\u7ebf\u6bb5\u6811\u5373\u53ef\u505a\u5230 $O(\\log^2 n)$\u3002\n\n\u7136\u800c\u771f\u7684\u8981\u8fd9\u4e48\u9ebb\u70e6\u5417\uff1f\n\n\u6ce8\u610f\u5230\u659c\u7387 $-b_j$ \u5355\u8c03\u4e0d\u589e\uff0c\u6574\u4f53\u4e8c\u5206\u7684\u65f6\u5019\u76f4\u63a5\u5355\u8c03\u6808\u505a\u51f8\u5305\u5c31\u597d\u3002\n\n\u590d\u6742\u5ea6 $O(n \\log n)$\uff0c\u8dd1\u5f97\u98de\u5feb\u3002~~\u867d\u7136 2log \u8dd1\u5f97\u4e5f\u633a\u5feb\u7684~~\n\n### Code:\n\n```cpp\n#include <stdio.h>\n#include <algorithm>\n#include <string.h>\n#include <cctype>\n#include <vector>\n#include <queue>\n#include <bitset>\n#define vi vector<int>\n#define pb push_back\n#define mp make_pair\n#define st first\n#define nd second\nusing namespace std;\ntypedef long long ll;\ntypedef pair <int, int> Pii;\nconst int cp=998244353;\ninline int mod(int x){if(x>=cp) x-=cp;if(x<0) x+=cp;return x;}\ninline void plust(int &x, int y){x=mod(x+y);return ;}\ninline void minut(int &x, int y){x=mod(x-y);return ;}\ninline int read(){\n\tchar ch=getchar();int x=0, f=1;\n\twhile(!isdigit(ch)){if(ch=='-') f=-1; ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn x*f;\n}\ninline ll readll(){\n\tchar ch=getchar();ll x=0, f=1;\n\twhile(!isdigit(ch)){if(ch=='-') f=-1; ch=getchar();}\n\twhile(isdigit(ch)){x=x*10ll+ch-'0';ch=getchar();}\n\treturn x*f;\n}\ninline void write(int x){\n    if(x<0) putchar('-'), x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\ninline int ksm(int a, int b=cp-2){\n\tint ret=1;\n\tfor(; b; b>>=1, a=1ll*a*a%cp)\n\t\tif(b&1) ret=1ll*ret*a%cp;\n\treturn ret;\n}\nconst int N=2e5+5;\nconst ll INF=1e18;\nint n, Q, cnt, trn[N], id[N];\nint lp[N], rp[N];\nll a[N], b[N], v[N];\nstruct oper{int tp, x, y;}op[N];\nvi G[N];\nstruct seg{ll k, b, lf;ll func(int x){return 1ll*k*x+b;}}sta[N];\nll operator * (seg A, seg B){\n\t//kix+bi=kjx+bj x=(bj-bi)/(ki-kj)\n\treturn (A.b-B.b)/(B.k-A.k);\n}\nnamespace SMT{\n\t#define ls k<<1\n\t#define rs k<<1|1\n\t#define mid (l+r>>1)\n\tstruct node{ll sum[2], cnt[2], num, mx, mxid, mn, mnid, adt[2], cov;}tr[N<<2];\n\tnode operator + (node a, node b){\n\t\tnode c;c.adt[0]=c.adt[1]=0, c.cov=-1;\n\t\tc.sum[0]=a.sum[0]+b.sum[0];\n\t\tc.sum[1]=a.sum[1]+b.sum[1];\n\t\tc.cnt[0]=a.cnt[0]+b.cnt[0];\n\t\tc.cnt[1]=a.cnt[1]+b.cnt[1];\n\t\tc.num=a.num+b.num, c.mx=max(a.mx, b.mx), c.mn=min(a.mn, b.mn);\n\t\tif(a.mx==c.mx) c.mxid=a.mxid;\n\t\tif(b.mx==c.mx) c.mxid=b.mxid;\n\t\tif(b.mn==c.mn) c.mnid=b.mnid;\n\t\tif(a.mn==c.mn) c.mnid=a.mnid;\n\t\treturn c;\n\t}\n\tvoid pushup(int k){tr[k]=tr[ls]+tr[rs];return ;}\n\tvoid build(int k, int l, int r){\n\t\ttr[k].cov=-1, tr[k].mx=-INF, tr[k].mn=INF;\n\t\tif(l==r){tr[k].sum[0]=a[mid], tr[k].cnt[0]=mid;return ;}\n\t\tbuild(ls, l, mid), build(rs, mid+1, r);pushup(k);\n\t}\n\tvoid cover(int k, ll v, int lid, int rid){\n\t\tif(tr[k].num) \n\t\t\ttr[k].sum[1]=v*tr[k].num, tr[k].mx=tr[k].mn=v, \n\t\t\ttr[k].mxid=rid, tr[k].mnid=lid, tr[k].adt[1]=0, tr[k].cov=v;\n\t}\n\tvoid upd(int k, ll v1, ll v2){\n\t\ttr[k].sum[0]+=v1*tr[k].cnt[0];\n\t\ttr[k].sum[1]+=v2*tr[k].cnt[1];\n\t\tif(tr[k].cnt[0]) tr[k].adt[0]+=v1;\n\t\tif(tr[k].cnt[1]) tr[k].mx+=v2*tr[k].mxid, tr[k].mn+=v2*tr[k].mnid, tr[k].adt[1]+=v2;\n\t}\n\tvoid pushdown(int k, int l, int r){\n\t\tif(~tr[k].cov) cover(ls, tr[k].cov, l, mid), cover(rs, tr[k].cov, mid+1, r), tr[k].cov=-1;\n\t\tif(tr[k].adt[0]||tr[k].adt[1]) \n\t\t\tupd(ls, tr[k].adt[0], tr[k].adt[1]), upd(rs, tr[k].adt[0], tr[k].adt[1]), \n\t\t\ttr[k].adt[0]=tr[k].adt[1]=0;\n\t}\n\tvoid bulldoze(int k, int l, int r, ll v){\n\t\tif(tr[k].mx<=v||!tr[k].cnt[1]) return ;\n\t\tif(tr[k].mn>=v) return cover(k, v, l, r);\n\t\tpushdown(k, l, r);bulldoze(ls, l, mid, v), bulldoze(rs, mid+1, r, v);\n\t\tpushup(k);\n\t}\n\tvoid colchange(int k, int l, int r, int x, ll v){\n\t\tif(l==r){\n\t\t\ttr[k].sum[0]=tr[k].cnt[0]=0, tr[k].num=1, tr[k].cnt[1]=tr[k].mxid=tr[k].mnid=mid;\n\t\t\t// printf(\"change %d to %lld\\n\", mid, v);\n\t\t\ttr[k].sum[1]=tr[k].mx=tr[k].mn=v;return ;\n\t\t}\n\t\tpushdown(k, l, r);\n\t\tif(x<=mid) colchange(ls, l, mid, x, v);\n\t\telse colchange(rs, mid+1, r, x, v);\n\t\tpushup(k);\n\t}\n\tll query(int k, int l, int r, int x, int y){\n\t\tif(x>r||y<l) return 0;\n\t\tif(x<=l&&r<=y) return tr[k].sum[0]+tr[k].sum[1];pushdown(k, l, r);\n\t\treturn query(ls, l, mid, x, y)+query(rs, mid+1, r, x, y);\n\t}\n\t#undef ls\n\t#undef rs\n\t#undef mid\n}\nvoid solve(int l, int r, int ql, int qr){\n\tif(ql>qr) return ;int mid=l+r>>1;\n\tif(l==r){for(int i=ql; i<=qr; ++i) trn[id[i]]=mid;return ;}\n\tint top=0;\n\tfor(int i=l, j; i<=mid; i=j+1){\n\t\tseg t=(seg){-b[i], v[i], 1};j=i;\n\t\twhile(j<mid&&b[j]==b[j+1]) ++j, t.b=min(t.b, v[j]);\n\t\twhile(top&&sta[top].func(sta[top].lf)>=t.func(sta[top].lf)) --top;\n\t\tif(top) t.lf=max(1ll, sta[top]*t+1);\n\t\tif(!top||(top&&t.lf<n)) sta[++top]=t;\n\t}\n\tint lt=0, rt=0;sta[top+1].lf=n+1;//printf(\"for [%d %d] :\\n\", l, r);\n\t// for(int i=1; i<=top; ++i) \n\t\t// printf(\"y=%lldx+%lld in [%d, %d)\\n\", sta[i].k, sta[i].b, sta[i].lf, sta[i+1].lf);\n\tfor(int i=ql, j=1; i<=qr; ++i){\n\t\twhile(id[i]>=sta[j+1].lf) ++j;\n\t\tif(sta[j].func(id[i])<=a[id[i]]) lp[++lt]=id[i];// printf(\"%d go left\\n\", id[i]);\n\t\telse rp[++rt]=id[i];// printf(\"%d go right\\n\", id[i]);\n\t}\n\tfor(int i=ql, j=0, k=0; i<=qr; ++i)\n\t\tif(j<lt) id[i]=lp[++j];else id[i]=rp[++k];\n\tsolve(l, mid, ql, ql+lt-1);\n\tsolve(mid+1, r, ql+lt, qr);\n}\nsigned main(){\n\tn=read(), Q=read();\n\tfor(int i=1; i<=n; ++i) a[i]=readll(), id[i]=i;\n\tfor(int i=1, toc=0; i<=Q; ++i){\n\t\tint tp=read();\n\t\tif(tp==1) v[++cnt]=readll(), op[i]=(oper){1, cnt, 0}, b[cnt]=toc;\n\t\tif(tp==2) op[i]=(oper){2, 0, 0}, ++toc;\n\t\tif(tp==3) op[i].tp=3, op[i].x=read(), op[i].y=read();\n\t}\n\t++cnt, b[cnt]=-1, v[cnt]=-INF;\n\tsolve(1, cnt, 1, n);\n\tfor(int i=1; i<=n; ++i) G[trn[i]].pb(i);//printf(\"%d \", trn[i]);puts(\"\");\n\tSMT :: build(1, 1, n);\n\tfor(int i=1; i<=Q; ++i){\n\t\tif(op[i].tp==1){\n\t\t\tint idx=op[i].x;\n\t\t\tSMT :: bulldoze(1, 1, n, v[idx]);\n\t\t\tfor(auto pos:G[idx]) SMT :: colchange(1, 1, n, pos, v[idx]);\n\t\t}\n\t\tif(op[i].tp==2) SMT :: upd(1, 1, 1);\n\t\tif(op[i].tp==3) printf(\"%lld\\n\", SMT :: query(1, 1, n, op[i].x, op[i].y));\n\t}\n\treturn 0;\n}\n// ai+bj*i>=vj\n// min(-bj*x+vj)<=ax\n```\n\n\n",
        "postTime": 1676475733,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "P8987 [\u5317\u5927\u96c6\u8bad 2021] \u7b80\u5355\u6570\u636e\u7ed3\u6784"
    },
    {
        "content": "#### *D2T1. [P8987 [\u5317\u5927\u96c6\u8bad 2021] \u7b80\u5355\u6570\u636e\u7ed3\u6784](https://www.luogu.com.cn/problem/P8987)\n\n\u6ca1\u770b\u5230 $a_i$ \u6709\u521d\u503c\uff0c\u8fd9\u4e0d\u662f\u7b80\u5355\u9898\u5417\uff1f$a$ \u4e00\u76f4\u5177\u6709\u5355\u8c03\u4e0d\u964d\u7684\u6027\u8d28\uff0c\u56e0\u6b64\u64cd\u4f5c 1 \u8f6c\u5316\u4e3a\u7ebf\u6bb5\u6811\u4e8c\u5206 + \u533a\u95f4\u8986\u76d6\uff0c\u64cd\u4f5c 2 \u76f4\u63a5\u6253 tag\u3002\n\n$a_i$ \u6709\u521d\u503c\u600e\u4e48\u529e\u5462\uff1f\u80af\u5b9a\u4e5f\u5f97\u60f3\u529e\u6cd5\u5f80\u4e0a\u8ff0\u505a\u6cd5\u9760\u62e2\uff0c\u5176\u672c\u8d28\u662f **\u5bb9\u6613\u7ef4\u62a4\u5355\u8c03\u4e0d\u964d\u7684\u5e8f\u5217**\u3002\n\n\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u4e24\u4e2a\u64cd\u4f5c\uff0c\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u5143\u7d20\u6ca1\u6709\u88ab\u64cd\u4f5c 2 \u5f71\u54cd\uff0c\u90a3\u4e48\u5b83\u7684\u503c\u4ec5\u548c\u521d\u59cb\u503c\u548c\u64cd\u4f5c 1 \u6267\u884c\u7684\u6b21\u6570\u6709\u5173\u3002\u8fd9\u5c31\u542f\u53d1\u6211\u4eec\u5c06\u5143\u7d20\u5206\u6210\u4e24\u7c7b\uff1a\u6ca1\u6709\u88ab\u64cd\u4f5c 2 \u5f71\u54cd\u7684 $S$\uff0c\u548c\u88ab\u64cd\u4f5c 2 \u5f71\u54cd\u7684 $T$\uff0c\u5206\u522b\u7ef4\u62a4\u3002\n\n\u8003\u8651\u4e00\u4e2a\u5143\u7d20 $a_p$ \u88ab\u64cd\u4f5c 2 \u5f71\u54cd\uff0c\u5c06\u5176\u52a0\u5165 $T$ \u65f6\uff0c$T$ \u4ecd\u7136\u4fdd\u6301\u5355\u8c03\u6027\uff1a\u5728\u8be5\u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20 $a_q$\uff08$p < q$\uff09\u4e5f\u4e00\u5b9a\u88ab\u64cd\u4f5c 2 \u5f71\u54cd\uff0c\u5426\u5219\u5f53\u524d $a_q < v \\leq a_p$\u3002\u53c8\u56e0\u4e3a $a_p$ \u662f\u7b2c\u4e00\u6b21\u88ab\u5f71\u54cd\uff0c\u6240\u4ee5 $a_q$ \u6052\u5c0f\u4e8e $a_p$\uff0c\u5728\u5f53\u524d\u64cd\u4f5c\u4e4b\u524d\u540c\u6837\u6ca1\u6709\u88ab\u5f71\u54cd\uff0c\u8fd9\u4e0e $a_q\\in T$ \u77db\u76fe\u3002\n\n\u56e0\u6b64\uff0c\u53ea\u9700\u6c42\u51fa\u6bcf\u4e2a\u5143\u7d20\u52a0\u5165 $T$ \u7684\u65f6\u95f4\uff0c\u5c31\u53ef\u4ee5\u7528\u4e24\u68f5\u7ebf\u6bb5\u6811\u5206\u522b\u7ef4\u62a4 $S$ \u548c $T$ \u8ba1\u7b97\u7b54\u6848\uff08$S$ \u4e5f\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff09\u3002\n\n\u8003\u8651 $a_i$ \u7684\u5f53\u524d\u503c\u4e3a $a_i + c\\times i$\uff0c\u5176\u4e2d $c$ \u8868\u793a\u64cd\u4f5c 1 \u6b21\u6570\u3002\u5bf9\u4e8e\u6bcf\u6b21\u64cd\u4f5c 2\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u6240\u6709\u4f7f\u5f97 $a_i +c\\times i \\geq v$ \u7684 $a_i$ \u5e76\u5220\u9664\uff0c\u76f8\u5f53\u4e8e\u627e\u5230\u659c\u7387\u4e3a $-c$ \u7684\u76f4\u7ebf\u5728\u6240\u6709\u70b9 $(i, a_i)$ \u5f62\u6210\u7684\u51f8\u5305\u4e0a\u7684\u5207\u70b9\u3002\u5220\u70b9\uff0c\u6c42\u5207\u70b9\uff0c\u659c\u7387\u9012\u589e\uff0c\u5f3a\u5236\u5728\u7ebf\uff0c\u5206\u5757\u51f8\u5305 + \u53cc\u6307\u9488\u7ef4\u62a4\u3002\n\n\u89c6 $n, q$ \u540c\u7ea7\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\sqrt n)$\u3002[\u4ee3\u7801](https://uoj.ac/submission/605739)\u3002\n\n\u80fd\u4e0d\u80fd polylog \u5462\uff1f\u53ef\u4ee5\uff01$a_i + c_j\\times i\\geq v_j$ \u5199\u6210 $a_i\\geq v_j - c_j\\times i$\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u5224\u65ad $a_i$ \u662f\u5426\u88ab\u4e00\u4e9b\u64cd\u4f5c 2 \u5f71\u54cd\uff0c\u674e\u8d85\u7ebf\u6bb5\u6811\u5957\u6574\u4f53\u4e8c\u5206\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log ^ 2n)$\u3002[\u4ee3\u7801](https://uoj.ac/submission/605753)\u3002",
        "postTime": 1676435526,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P8987 [\u5317\u5927\u96c6\u8bad 2021] \u7b80\u5355\u6570\u636e\u7ed3\u6784"
    }
]