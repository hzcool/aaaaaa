[
    {
        "content": "# \u9898\u610f\n\n\u6709 $n$ \u4e2a\u987e\u5ba2\u5728\u901b\u8857\uff0c\u8857\u89c6\u4e3a\u4e00\u4e2a\u6570\u8f74\uff0c\u6bcf\u4e2a\u987e\u5ba2\u5728 $t_i$ \u65f6\u523b\u4ece $a_i$ \u4f4d\u7f6e\u5f00\u59cb\u901b\u8857\uff0c\u4ee5 $1$ \u5355\u4f4d\u6bcf\u79d2\u7684\u901f\u5ea6\u8d70\u5230 $b_i$ \u4f4d\u7f6e\u4e4b\u540e\u79bb\u5f00\u3002\u5982\u679c $a_i<b_i$ \u8868\u793a\u4ed6\u5411\u6b63\u65b9\u5411\u8d70\uff0c\u5426\u5219\u8868\u793a\u4ed6\u5411\u8d1f\u65b9\u5411\u8d70\u3002\u540c\u65f6\u6bcf\u4e2a\u4eba\u6709\u6743\u503c $c_i$ \u8868\u793a\u5355\u4f4d\u65f6\u95f4\u5185\u7684\u5de5\u8d44\u6570\u91cf\u3002\n\n\u4e00\u4e2a\u4fdd\u9556\u4fdd\u62a4\u4e00\u4e2a\u4eba\u9700\u8981\u8ddf\u4e00\u4e2a\u4eba\u4e00\u8d77\u901b\u8857\uff08\u5373\u76f8\u540c\u65f6\u523b\u5728\u76f8\u540c\u4f4d\u7f6e\uff09\uff0c\u8ddf\u7740 $i$ \u901b\u8857 $x$ \u4e2a\u5355\u4f4d\u65f6\u95f4\u83b7\u5f97 $c_i\\times x$ \u7684\u5de5\u8d44\u3002\u4fdd\u9556\u7684\u79fb\u52a8\u901f\u5ea6\u4e0d\u8d85\u8fc7 $1$ \u5355\u4f4d\u6bcf\u79d2\uff0c\u4fdd\u62a4\u4e00\u4e2a\u4eba\u901b\u8857\u7684\u8d77\u6b62\u65f6\u95f4\u5747\u4e0d\u9700\u8981\u662f\u4e00\u4e2a\u6574\u6570\u3002\u4e00\u4e2a\u4fdd\u9556\u5728\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u4fdd\u62a4\u4e00\u4e2a\u4eba\u3002\n\n\u6709 $q$ \u4e2a\u4fdd\u9556\uff0c\u7b2c $x$ \u4e2a\u4fdd\u9556\u5728 $P_x$ \u65f6\u523b\u4e0a\u5c97\uff0c\u521d\u59cb\u4f4d\u7f6e\u65f6 $X_x$\uff0c\u4f60\u9700\u8981\u6c42\u51fa\u6bcf\u4e2a\u4fdd\u9556\u80fd\u591f\u83b7\u5f97\u7684\u5c0f\u8d39\u6700\u591a\u662f\u591a\u5c11\u3002\n\n**\u6570\u636e\u8303\u56f4**\uff1a$n\\le 2800,q\\le 3\\times 10^6,1\\le t_i,a_i,b_i,c_i,P_i,X_i\\le 10^9,a_i\\ne b_i,c_i$ \u4e3a\u5076\u6570\u3002\n\n# solution\n\n\n\u9996\u5148\u8f6c\u5316\u95ee\u9898\uff0c\u628a\u65f6\u95f4\u548c\u4f4d\u7f6e\u4f5c\u4e3a\u4e24\u7ef4\uff0c\u5728\u5750\u6807\u7cfb\u4e2d\u753b\u51fa\u6240\u6709\u901b\u8857\u7684\u4eba\u7684\u56fe\u50cf\uff0c\u5373**\u8d77\u70b9\u4e3a $(t_i,a_i)$ \uff0c\u7ec8\u70b9\u4e3a $(t+|a_i-b_i|,b_i)$ \u7684\u4e00\u4e2a\u7ebf\u6bb5**\u3002\u90a3\u4e48\u4e00\u4e2a\u4fdd\u9556\u5728\u5750\u6807\u7cfb\u4e0a\u8d77\u70b9\u662f $(p_i,x_i)$\uff0c\u6bcf\u4e2a\u65f6\u523b\u53ea\u80fd\u5411\u53f3\u4e0a\u6216\u8005\u53f3\u4e0b\u8d70\uff0c\u4fdd\u9556\u7684\u8def\u5f84\u7684\u56fe\u50cf\u4e0e\u987e\u5ba2\u7684\u56fe\u50cf\u7684\u91cd\u53e0\u90e8\u5206\u7684\u957f\u5ea6\u5c31\u8868\u793a\u4fdd\u62a4\u7684\u65f6\u957f\u3002\u8fd9\u6837\u7ebf\u6bb5\u957f\u5ea6\u53d8\u6210\u4e86\u539f\u6765\u7684 $\\sqrt{2}$ \u500d\u3002\n\n\u73b0\u5728\u6240\u6709\u7684\u7ebf\u6bb5\u90fd\u662f\u4e0e\u76f4\u7ebf $y=x$ \u5e73\u884c\u6216\u5782\u76f4\u7684\uff0c\u4e0d\u662f\u5f88\u597d\u5904\u7406\uff0c**\u628a\u5750\u6807\u7cfb\u987a\u65f6\u9488\u65cb\u8f6c $45^\\circ $**\uff0c\u5373\u4e00\u4e2a\u70b9 $(x,y)$ \u53d8\u4e3a $(x-y,x+y)$\u3002\u7ebf\u6bb5\u957f\u5ea6\u518d $\\times \\sqrt{2}$\uff0c\u73b0\u5728\u7684\u7ebf\u6bb5\u957f\u5ea6\u662f\u539f\u6765\u7684 $2$ \u500d\uff0c\u90a3\u4e48\u5982\u679c\u4fdd\u9556\u4e0e\u987e\u5ba2\u7684\u56fe\u50cf\u91cd\u53e0\u7684\u957f\u5ea6\u4e3a $len$\uff0c\u90a3\u4e48\u5f97\u5230\u7684\u5de5\u8d44\u662f $len\\times \\frac{c_i}{2}$\u3002\u8fd9\u5c31\u662f $c_i$ \u662f\u5076\u6570\u7684\u4f5c\u7528\u3002\n\n\n\u6ce8\u610f\u5230 $n$ \u5f88\u5c0f\uff0c\u628a\u6240\u6709\u987e\u5ba2\u7684\u7ebf\u6bb5\u7684\u7aef\u70b9\u4f5c\u4e3a\u5173\u952e\u70b9\uff0c\u79bb\u6563\u5316\uff0c\u8fd9\u6837\u53d8\u6210\u4e86\u4e00\u4e2a $O(n)\\times O(n)$ \u7684\u7f51\u683c\u56fe\uff0c\u5171 $O(n^2)$ \u4e2a\u683c\u70b9\u3002\u53ef\u4ee5 $O(n^2)$ \u5730**\u9884\u5904\u7406\u51fa\u5982\u679c\u4e00\u4e2a\u4fdd\u9556\u8d70\u5230\u4e86\u4e00\u4e2a\u683c\u70b9\uff0c\u4e4b\u540e\u4ed6\u7684\u6700\u5927\u6536\u76ca $val_{i,j}$ \u662f\u591a\u5c11**\u3002\u8f6c\u79fb\u679a\u4e3e\u4e0b\u4e00\u6b65\u5f80\u4e0a\u8d70\u8fd8\u662f\u53f3\u8d70\uff0c\u8d70\u7684\u65f6\u5019\u9009\u8986\u76d6\u8fd9\u4e2a\u7ebf\u6bb5\u7684 $c_i$ \u6700\u5927\u7684\u987e\u5ba2\u4fdd\u62a4\u3002\n\n\n\u73b0\u5728\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f\u8d70\u5230\u683c\u70b9\u4e4b\u524d\u7684\u90e8\u5206\uff0c\u4e00\u4e2a\u4fdd\u9556\u7684\u7b56\u7565\u662f\uff1a\u8981\u4e48\u4e00\u76f4\u5f80\u4e0a\u8d70\uff0c\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684\u6a2a\u7740\u7684\u7ebf\u6bb5\uff0c\u8ddf\u7740\u8d70\u4e00\u6bb5\uff0c\u5230\u8fbe\u683c\u70b9\uff1b\u8981\u4e48\u4e00\u76f4\u5f80\u53f3\u8d70\uff0c\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684\u7ad6\u7740\u7684\u7ebf\u6bb5\uff0c\u8ddf\u7740\u8d70\u4e00\u6bb5\uff0c\u5230\u8fbe\u683c\u70b9\u3002\u8ddf\u7740\u8d70\u4e00\u6bb5\uff0c\u7136\u540e\u83b7\u5f97\u683c\u70b9\u7684\u8d21\u732e\u662f\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570 $kx+b$ \u7684\u5f62\u5f0f\uff0c$k$ \u662f $\\frac{c_i}{2}$\uff0c$x$ \u662f\u4fdd\u62a4\u7684\u8ddd\u79bb\uff0c$b$ \u662f\u683c\u70b9\u7684\u8d21\u732e\u3002**\u4e00\u4e2a\u4fdd\u9556\u80fd\u8d70\u5230\u7684\u6a2a\u7740\u7684\u7ebf\u6bb5\u548c\u7ad6\u7740\u7684\u7ebf\u6bb5\u662f\u4e00\u6bb5\u524d\u7f00\uff0c\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\u674e\u8d85\u6811\u7ef4\u62a4**\u5373\u53ef\u3002\n\n\u5177\u4f53\u7684\uff0c\u679a\u4e3e\u662f\u5f80\u4e0a\u8d70\u8fd8\u662f\u5f80\u53f3\u8d70\uff0c\u4ee5\u5f80\u4e0a\u8d70\u4e3a\u4f8b\u3002\u627e\u51fa\u521d\u59cb\u4f4d\u7f6e\u5728\u4e24\u4e2a\u683c\u7ebf $i$ \u548c $i+1$ \u4e4b\u95f4\u7684\u6240\u6709\u4fdd\u9556\uff0c\u4ed6\u4eec\u9009\u62e9\u7684\u683c\u70b9\u4e00\u5b9a\u662f $val_{i+1,x}$\u3002\u7136\u540e\u6309\u7167\u7eb5\u5750\u6807\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\uff0c\u628a\u4e00\u6b21\u51fd\u6570\u63d2\u5165\u8fdb\u53bb\u5373\u53ef\u3002\u6bcf\u4e2a\u4fdd\u9556 $j$ \u8be2\u95ee\u4e00\u4e2a\u524d\u7f00\u7684\u4e00\u6b21\u51fd\u6570\u4e2d\uff0c$x=X_{i+1}-P_j$ \u65f6\u7684\u6700\u5927\u503c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O((n^2+q)\\log q)$\u3002\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n^2+q)$\u3002\n\n\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace iobuff{//\u8f93\u5165\u8f93\u51fa\u91cf\u8f83\u5927\uff0c\u8f93\u5165\u8f93\u51fa\u4f18\u5316\n\tconst int LEN=1000000;\n\tchar in[LEN+5],out[LEN+5];\n\tchar *pin=in,*pout=out,*ed=in,*eout=out+LEN;\n\tinline char gc(void){\n\t\treturn pin==ed&&(ed=(pin=in)+fread(in,1,LEN,stdin),ed==in)?EOF:*pin++;\n\t}\n\tinline void pc(char c){\n\t\tpout==eout&&(fwrite(out,1,LEN,stdout),pout=out);\n\t\t(*pout++)=c;\n\t}\n\tinline void flush(){fwrite(out,1,pout-out,stdout),pout=out;}\n\ttemplate<typename T> inline void read(T &x){\n\t\tstatic int f;\n\t\tstatic char c;\n\t\tc=gc(),f=1,x=0;\n\t\twhile(c<'0'||c>'9') f=(c=='-'?-1:1),c=gc();\n\t\twhile(c>='0'&&c<='9') x=10*x+c-'0',c=gc();\n\t\tx*=f;\n\t}\n\ttemplate<typename T> inline void putint(T x,char div='\\n'){\n\t\tstatic char s[20];\n\t\tstatic int top;\n\t\ttop=0;\n\t\tx<0?pc('-'),x=-x:0;\n\t\twhile(x) s[top++]=x%10,x/=10;\n\t\t!top?pc('0'),0:0;\n\t\twhile(top--) pc(s[top]+'0');\n\t\tpc(div);\n\t}\n}\nusing namespace iobuff;\nconst int N=5605,Q=3e6+5;\n#define ll long long\n#define int ll\n#define y1 Yy1\n#define y2 Yy2 \ntemplate<int T> struct lsh{//\u79bb\u6563\u5316\n\tint buc[T],tot;\n\tinline void ins(int x){buc[++tot]=x;}\n\tinline void build(){\n\t\tsort(buc+1,buc+1+tot);\n\t\ttot=unique(buc+1,buc+1+tot)-buc-1;\n\t}\n\tinline int operator ()(int x){return lower_bound(buc+1,buc+1+tot,x)-buc;}\n\tinline int operator [](int x){return buc[x];}\n};\nlsh<N> bx,by;\nlsh<Q> qry;\nint qx[Q],qy[Q];\nnamespace SGT{//\u674e\u8d85\u6811\n\t#define lid (id<<1)\n\t#define rid (id<<1|1)\n\t#define mid ((l+r)>>1)\n\tint k[Q<<2];ll b[Q<<2];\n\tvoid build(int id,int l,int r){\n\t\tk[id]=0;b[id]=-1;\n\t\tif(l==r)return;\n\t\tbuild(lid,l,mid);build(rid,mid+1,r);\n\t}\n\tinline ll calc(int id,int x){return 1ll*k[id]*x+b[id];}\n\tinline ll calc(int _k,ll _b,int x){return 1ll*_k*x+_b;}\n\tvoid insert(int id,int l,int r,int _k,ll _b){\n\t\tif(b[id]==-1){k[id]=_k;b[id]=_b;return;}\n\t\tif(calc(id,qry[mid])<calc(_k,_b,qry[mid]))swap(k[id],_k),swap(b[id],_b);\n\t\tif(l==r)return;\n\t\tif(calc(id,qry[r])<calc(_k,_b,qry[r]))insert(rid,mid+1,r,_k,_b);\n\t\tif(calc(id,qry[l])<calc(_k,_b,qry[l]))insert(lid,l,mid,_k,_b);\n\t}\n\tll query(int id,int l,int r,int pos){\n\t\tif(b[id]==-1)return 0;\n\t\tif(l==r)return calc(id,qry[pos]);\n\t\treturn max(calc(id,qry[pos]),pos<=mid?query(lid,l,mid,pos):query(rid,mid+1,r,pos));\n\t}\n}\nll val[N][N];\nint vx[N][N],vy[N][N];\ntemplate<typename T> inline void Max(T &a,T b){if(a<b)a=b;}\nstruct Line{\n\tint x1,x2,y1,y2,c;\n\tLine(int _x1=0,int _y1=0,int _x2=0,int _y2=0,int _c=0){x1=_x1;y1=_y1;x2=_x2;y2=_y2;c=_c;}\n\tinline void build(){\n\t\tx1=bx(x1);x2=bx(x2);y1=by(y1);y2=by(y2);\n\t}\n}line[N];\nvector<int> bucx[N],bucy[N];\nint n,q;\nvoid init(){\n\tbx.build();by.build();\n\tfor(int i=1;i<=n;++i){\n\t\tline[i].build();//vx,vy \u8868\u793a (i,j) \u5411\u53f3\u8d70\u5230 (i+1,j)/\u5411\u4e0a\u8d70\u5230 (i,j+1) \u7684\u6700\u5927\u7684 c\n\t\tif(line[i].x1==line[i].x2){\n\t\t\tfor(int j=line[i].y1;j<line[i].y2;++j)\n\t\t\t\tMax(vy[line[i].x1][j],line[i].c);\n\t\t}else{\n\t\t\tfor(int j=line[i].x1;j<line[i].x2;++j)\n\t\t\t\tMax(vx[j][line[i].y2],line[i].c);\n\t\t}\n\t}\n\tfor(int i=bx.tot;i;--i)for(int j=by.tot;j;--j)\n\t\tval[i][j]=max(i<bx.tot?val[i+1][j]+1ll*vx[i][j]*(bx[i+1]-bx[i]):0ll,j<by.tot?val[i][j+1]+1ll*vy[i][j]*(by[j+1]-by[j]):0ll);\n}\ninline bool cmpx(int x,int y){return qx[x]>qx[y];}\ninline bool cmpy(int x,int y){return qy[x]>qy[y];}\nll ans[Q];\nsigned main(){\n\tread(n);read(q);\n\tfor(int i=1,a,b,t,c,x1,y1,x2,y2;i<=n;++i){\n\t\tread(t);read(a);read(b);read(c);\n\t\tx1=t;y1=a;\n\t\tx2=t+abs(a-b);y2=b;\n\t\tline[i]=Line(x1-y1,x1+y1,x2-y2,x2+y2,c>>1);\n\t\tbx.ins(x1-y1);bx.ins(x2-y2);\n\t\tby.ins(x1+y1);by.ins(x2+y2);\n\t}\n\tinit();\n\tfor(int i=1,t,a;i<=q;++i){\n\t\tread(t);read(a);\n\t\tqx[i]=t-a;qy[i]=t+a;\n\t\tbucx[bx(qx[i])].push_back(i);\n\t\tbucy[by(qy[i])].push_back(i);\n\t}\n\tfor(int i=1;i<=bx.tot;++i){\n\t\tif(!bucx[i].size())continue;\n\t\tqry.tot=0;\n\t\tsort(bucx[i].begin(),bucx[i].end(),cmpy);\n\t\tfor(int x:bucx[i])qry.ins(bx[i]-qx[x]);\n\t\tqry.build();\n\t\tint R=qry.tot;\n\t\tSGT::build(1,1,R);\n\t\tint flag=by.tot;\n\t\tfor(int id:bucx[i]){\n\t\t\twhile(flag&&by[flag]>=qy[id]){\n\t\t\t\tSGT::insert(1,1,R,vx[i-1][flag],val[i][flag]);\n\t\t\t\t--flag;\n\t\t\t}\n\t\t\tMax(ans[id],SGT::query(1,1,R,qry(bx[i]-qx[id])));\n\t\t}\n\t}\n\tfor(int i=1;i<=by.tot;++i){\n\t\tif(!bucy[i].size())continue;\n\t\tqry.tot=0;\n\t\tsort(bucy[i].begin(),bucy[i].end(),cmpx);\n\t\tfor(int x:bucy[i])qry.ins(by[i]-qy[x]);\n\t\tqry.build();\n\t\tint R=qry.tot;\n\t\tSGT::build(1,1,R);\n\t\tint flag=bx.tot;\n\t\tfor(int id:bucy[i]){\n\t\t\twhile(flag&&bx[flag]>=qx[id]){\n\t\t\t\tSGT::insert(1,1,R,vy[flag][i-1],val[flag][i]);\n\t\t\t\t--flag;\n\t\t\t}\n\t\t\tMax(ans[id],SGT::query(1,1,R,qry(by[i]-qy[id])));\n\t\t}\n\t}\n\tfor(int i=1;i<=q;++i)putint(ans[i]);\n\tflush();\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1644826367,
        "uid": 152128,
        "name": "harryzhr",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7564 \u3010[JOISC 2021 Day3] \u30dc\u30c7\u30a3\u30fc\u30ac\u30fc\u30c9\u3011"
    },
    {
        "content": "\u725b\u903c DP\uff0c\u8054\u6d4b\u78b0\u4e0a\u8fd9\u9898\u76f4\u63a5\u6446\u70c2\u4ea4\u767d\u5377\uff08\n\n\u9996\u5148\u51b3\u7b56\u548c\u65f6\u95f4\u6709\u5173\uff0c\u56e0\u6b64\u95ee\u9898\u672c\u8d28\u4e0a\u662f\u4e8c\u7ef4\u7684\uff0c\u52a0\u4e00\u6761\u65f6\u95f4\u8f74\u3002\n\n\u8fd9\u6837\u5982\u679c\u4e00\u4e2a\u4eba\u672c\u6765\u662f $T$ \u65f6\u523b\u5f00\u59cb\u4ece $u$ \u5230 $v$\uff0c\u5728\u65b0\u7684\u65f6\u95f4-\u4f4d\u7f6e\u5e73\u9762\u4e0a\u5c31\u8f6c\u5316\u6210\u4ece $(T,u)$ \u5230 $(T+|u-v|,v)$ \u7684\u7ebf\u6bb5\u3002\u5f53\u7136\u73b0\u5728\u4ec0\u4e48\u65f6\u5019\u8d70\u8fd9\u6761\u7ebf\u6bb5\u5c31\u6ca1\u5173\u7cfb\u4e86\uff0c\u5565\u65f6\u5019\u8d70\u90fd\u80fd\u6709\u6536\u76ca\u3002\n\n\u89c2\u5bdf\u5230\u4fdd\u9556\u6ca1\u6709\u5fc5\u8981\u505c\uff0c\u56e0\u4e3a\u505c\u80af\u5b9a\u662f\u4e3a\u4e86\u7b49\u51e0\u4e2a\u5355\u4f4d\u65f6\u95f4\u4e4b\u540e\u51fa\u73b0\u7684\u4e00\u4e2a\u4eba\uff0c\u5982\u679c\u6309 $0.5$ \u4e2a\u65f6\u95f4\u5355\u4f4d\u5206\u6bb5\uff0c\u5c31\u53ef\u4ee5\u524d\u534a\u6bb5\u5f80\u524d\u8d70\u540e\u534a\u6bb5\u5f80\u540e\u8d70\uff0c\u6240\u4ee5\u4e00\u76f4\u8d70\u5c31\u4e0d\u52a3\u3002\n\n\u7136\u540e\u4fdd\u9556\u5c31\u53ea\u80fd\u5411\u5de6\u4e0a\u6216\u8005\u53f3\u4e0a\u8d70\u3002\n\n\u89c2\u5bdf\u5230\u6240\u6709\u7ebf\u6bb5\u548c\u4fdd\u9556\u7684\u8d70\u6cd5\u90fd\u5e73\u884c\u4e8e $y=x$ \u548c $y=-x$ \u4e2d\u7684\u4e00\u6761\uff0c\u6240\u4ee5\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\u6574\u4f53\u8f6c $45$ \u5ea6\u3002\n\n\u79bb\u6563\u5316\u4e4b\u540e\u5c31\u53ef\u4ee5\u53d1\u73b0\u6240\u6709\u7684 VIP \u7684\u5bf9\u5e94\u7ebf\u6bb5\u53c9\u8d77\u6765\u4f1a\u5f62\u6210\u4e00\u4e2a\u7f51\u683c\u56fe\uff0c\u800c\u4e14\u5927\u5c0f\u662f $O(n^2)$ \u91cf\u7ea7\u7684\uff0c\u53ef\u4ee5\u63a5\u53d7\uff0c\u56e0\u6b64\u5bf9\u6240\u6709\u683c\u70b9\u7b97\u51fa\u7b54\u6848\u3002\n\n\u7136\u540e\u5269\u4e0b\u7684\u5c31\u662f\u64cd\u4f5c\u8fd9\u4e2a\u4eba\u8ba9\u4ed6\u8d70\u5230\u4e00\u4e2a\u683c\u70b9\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u6700\u4f18\u60c5\u51b5\u4e00\u5b9a\u662f\u5148\u5f80\u4e00\u4e2a\u65b9\u5411\u51b2\uff0c\u7136\u540e\u9047\u5230\u4e00\u4e2a\u683c\u7ebf\u5c31\u5f80\u53e6\u4e00\u4e2a\u65b9\u5411\uff08\u53ea\u6709\u4e24\u4e2a\u53ef\u4ee5\u8d70\u7684\u65b9\u5411\uff09\u8f6c\uff0c\u6cbf\u7740\u90a3\u4e2a\u683c\u7ebf\u5230\u8fbe\u7b2c\u4e00\u4e2a\u683c\u70b9\u3002\n\n\u5bb9\u6613\u89c2\u5bdf\u5230\u8fd9\u4e00\u6bb5\u7684\u8d21\u732e\u662f\u5173\u4e8e\u5750\u6807\u4e2d\u67d0\u4e00\u9879\u7684\u4e00\u6b21\u51fd\u6570\uff0c\u800c\u540e\u9762\u683c\u70b9\u7684\u8d21\u732e\u53ef\u4ee5\u89c6\u4f5c\u5e38\u6570\uff0c\u6240\u4ee5\u6574\u4e2a\u7b97\u4e0b\u6765\u8fd8\u662f\u4e2a\u4e00\u6b21\u51fd\u6570\u3002\n\n\u73b0\u5728\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u7ed9\u5b9a\u4e00\u5806\u4e00\u6b21\u51fd\u6570\u5e8f\u5217\uff0c\u591a\u6b21\u8be2\u95ee\u67d0\u4e00\u4e2a\u5e8f\u5217\u7684\u67d0\u4e00\u4e2a\u524d\u7f00\u7684\u6240\u6709\u4e00\u6b21\u51fd\u6570\u5728\u67d0\u4e00\u4e2a\u4f4d\u7f6e\u7684\u70b9\u503c\u7684\u6700\u5927\u503c\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\uff0c\u7136\u540e\u5c1d\u8bd5\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u3002\n\n\u5f53\u7136\u53ef\u4ee5\u76f4\u63a5\u5e73\u8861\u6811/\u674e\u8d85\u6811\uff0c\u800c\u4e14\u539f\u9898 25s/4GB \u53ef\u80fd\u8db3\u4ee5\u901a\u8fc7\uff0c\u4f46\u662f $O(n^2\\log n)$ \u8fd8\u662f\u4e0d\u591f\u4f18\u79c0\u3002\n\n\u6316\u6398\u4e00\u4e0b\u6027\u8d28\uff0c\u53d1\u73b0\u5982\u679c\u628a $x$ \u53d8\u91cf\u8bbe\u4e3a\u8fd9\u534a\u6761\u683c\u7ebf\u7684\u957f\u5ea6\uff0c\u622a\u8ddd\u5c31\u53ea\u5269\u4e0b DP \u503c\uff0c\u8fd9\u663e\u7136\u662f\u9012\u589e\u7684\uff08\u4e0b\u9762\u7684 DP \u503c\u80af\u5b9a\u5927\u4e8e\u4e0a\u9762\u7684 DP \u503c\uff09\u3002\u56e0\u6b64\u5728\u5c06\u76f4\u7ebf\u63d2\u5165\u51f8\u5305\u7684\u65f6\u5019\uff0c\u659c\u7387\u6bd4\u81ea\u5df1\u5c0f\u7684\u5168\u90fd\u6ca1\u6709\u5fc5\u8981\u7559\u3002\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u62ff\u5355\u8c03\u6808+\u4e8c\u5206\u7ef4\u62a4\u3002\n\n\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\u590d\u6742\u5ea6 $O(n^2+q\\log n)$\u3002\u6d1b\u8c37\u8981\u5f00 O2\u3002\n\n\u5b9e\u9645\u5b9e\u73b0\u7684\u65f6\u5019\u53ef\u80fd\u9700\u8981\u628a\u8fd9\u4e2a\u51f8\u5305\u5173\u4e8e $y$ \u8f74\u7ffb\u8f6c\u8fc7\u6765\u5b58\uff0c\u4e0d\u8fc7\u8fd9\u662f\u5c0f\u95ee\u9898\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1 << 21], *p1 = buf, *p2 = buf;\n\ninline long long qread() {\n\tregister char c = getchar();\n\tregister long long x = 0, f = 1;\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9') {\n\t\tx = (x << 3) + (x << 1) + c - 48;\n\t\tc = getchar();\n\t}\n\treturn x * f;\n}\n\n#define yn sjdfklsneklrn\n\nstruct Line {\n\tlong long k, b;\n\tLine() {}\n\tLine(long long k, long long b) : k(k), b(b) {}\n};\n\nconst int N = 6005, Q = 3000005;\nlong long n, q, xl[N], yl[N], xr[N], yr[N], w[N], xp[N], yp[N], xn, yn, qx[Q], qy[Q], stktop;\nLine stk[N];\nlong long dp[N][N], wu[N][N], wr[N][N], ans[Q];\nvector <int> adj[N][N];\n\ninline void Read() {\n\tn = qread(); q = qread();\n\tfor (int i = 1;i <= n;i++) {\n\t\tlong long t = qread(), a = qread(), b = qread(); w[i] = qread() / 2;\n\t\txl[i] = t + a; yl[i] = t - a; xr[i] = t + abs(a - b) + b; yr[i] = t + abs(a - b) - b;\n\t\txp[i] = xl[i]; xp[i + n] = xr[i]; yp[i] = yl[i]; yp[i + n] = yr[i];\n\t}\n}\n\ninline void Prefix() {\n\tsort(xp + 1, xp + 2 * n + 1);\n\tsort(yp + 1, yp + 2 * n + 1);\n\txn = unique(xp + 1, xp + 2 * n + 1) - xp - 1;\n\tyn = unique(yp + 1, yp + 2 * n + 1) - yp - 1;\n\tfor (int i = 1;i <= n;i++) {\n\t\txl[i] = lower_bound(xp + 1, xp + xn + 1, xl[i]) - xp;\n\t\txr[i] = lower_bound(xp + 1, xp + xn + 1, xr[i]) - xp;\n\t\tyl[i] = lower_bound(yp + 1, yp + yn + 1, yl[i]) - yp;\n\t\tyr[i] = lower_bound(yp + 1, yp + yn + 1, yr[i]) - yp;\n\t}\n\tfor (int i = 1;i <= n;i++) {\n\t\tif (xl[i] == xr[i]) {\n\t\t\tfor (int j = min(yl[i], yr[i]);j < max(yl[i], yr[i]);j++) wu[xl[i]][j] = max(wu[xl[i]][j], 1ll * w[i]);\n\t\t} else {\n\t\t\tfor (int j = min(xl[i], xr[i]);j < max(xl[i], xr[i]);j++) wr[j][yl[i]] = max(wr[j][yl[i]], 1ll * w[i]);\n\t\t}\n\t}\n\t/*\n\tfor (int i = 1;i <= xn;i++) {\n\t\tfor (int j = 1;j <= yn;j++) cout << wu[i][j] << \" \";\n\t\tcout << endl;\n\t}\n\tfor (int i = 1;i <= xn;i++) {\n\t\tfor (int j = 1;j <= yn;j++) cout << wr[i][j] << \" \";\n\t\tcout << endl;\n\t}\n\t*/\n\tfor (int i = xn;i >= 1;i--) {\n\t\tfor (int j = yn;j >= 1;j--) dp[i][j] = max(dp[i][j + 1] + wu[i][j] * (yp[j + 1] - yp[j]), dp[i + 1][j] + wr[i][j] * (xp[i + 1] - xp[i]));\n\t}\n\t/*\n\tfor (int i = 1;i <= xn;i++) {\n\t\tfor (int j = 1;j <= yn;j++) cout << dp[i][j] << \" \";\n\t\tcout << endl;\n\t}\n\t*/\n}\n\ninline void addLine(long long k, long long b) {\n\tk = -k;\n\twhile (stktop && stk[stktop].k >= k) stktop--;\n\twhile (stktop > 1 && (__int128)(stk[stktop].b - b) * (k - stk[stktop - 1].k) <= (__int128)(stk[stktop - 1].b - b) * (k - stk[stktop].k)) stktop--;\n\tstk[++stktop] = Line(k, b);\n}\n\ninline long long qMax(long long x) {\n\tx = -x;\n\tint l = 1, r = stktop + 1;\n\twhile (l < r - 1) {\n\t\tint mid = l + r >> 1;\n\t\tif (stk[mid].b - stk[mid - 1].b <= (__int128)x * (stk[mid - 1].k - stk[mid].k)) r = mid;\n\t\telse l = mid;\n\t}\n\treturn stk[l].k * x + stk[l].b;\n}\n\ninline void Solve() {\n\tfor (int i = 1;i <= q;i++) {\n\t\tlong long p = qread(), x = qread();\n\t\tqx[i] = p + x; qy[i] = p - x;\n\t\tadj[lower_bound(xp + 1, xp + xn + 1, qx[i]) - xp][lower_bound(yp + 1, yp + yn + 1, qy[i]) - yp].push_back(i);\n\t}\n\tfor (int i = 1;i <= xn;i++) {\n\t\tstktop = 0;\n\t\tfor (int j = yn;j >= 1;j--) {\n\t\t\taddLine(wr[i - 1][j], dp[i][j]);\n\t\t\tint siz = adj[i][j].size();\n\t\t\t//for (int k = 1;k <= stktop;k++) cout << stk[k].k << \"x+\" << stk[k].b << \" \"; cout << endl;\n\t\t\tfor (int k = 0;k < siz;k++) {\n\t\t\t\t//cout << \"(\" << i << \",\" << j << \") \" << adj[i][j][k] << endl;\n\t\t\t\tans[adj[i][j][k]] = max(ans[adj[i][j][k]], qMax(xp[i] - qx[adj[i][j][k]]));\n\t\t\t}\n\t\t}\n\t}\n\tfor (int j = 1;j <= yn;j++) {\n\t\tstktop = 0;\n\t\tfor (int i = xn;i >= 1;i--) {\n\t\t\taddLine(wu[i][j - 1], dp[i][j]);\n\t\t\tint siz = adj[i][j].size();\n\t\t\tfor (int k = 0;k < siz;k++) ans[adj[i][j][k]] = max(ans[adj[i][j][k]], qMax(yp[j] - qy[adj[i][j][k]]));\n\t\t}\n\t}\n\tfor (int i = 1;i <= q;i++) cout << ans[i] << '\\n';\n}\n\nint main() {\n\tRead();\n\tPrefix();\n\tSolve();\n\tcout.flush();\n\t#ifdef CFA_44\n\twhile (1);\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1644767155,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7564 \u3010[JOISC 2021 Day3] \u30dc\u30c7\u30a3\u30fc\u30ac\u30fc\u30c9\u3011"
    },
    {
        "content": "\u6211\u4eec\u8003\u8651\u628a\u5b83\u4e8c\u7ef4\u5316\uff0c\u7136\u540e\u518d\u53d8\u6362\u4e00\u4e0b\u5750\u6807\u7cfb\uff08$(t,x)$ \u53d8\u6362\u6210 $(x-t,x+t)$\uff09\uff0c\u6bcf\u4e2a VIP \u7684\u8def\u5f84\u5c31\u53d8\u6210\u4e86\u6709\u4e00\u5806\u6a2a\u5411\u6216\u7eb5\u5411\u7ebf\u6bb5\uff0c\u7136\u540e\u6211\u4eec\u76f8\u5f53\u4e8e\u4ece\u4e00\u4e2a\u8d77\u70b9\u51fa\u53d1\uff0c\u53ef\u4ee5\u5f80\u4e0b\u6216\u5f80\u53f3\u8d70\uff0c\u7136\u540e\u8d70\u5230\u7ebf\u6bb5\u4e0a\u4f1a\u6709\u4e00\u4e2a\u8d21\u732e\u3002\u6211\u4eec\u66b4\u529b\u628a\u5b83\u79bb\u6563\u5316\u540e\u6269\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u7f51\u683c\u56fe\uff0c\u7136\u540e $O(n^2)$ \u505a\u4e00\u6b21 DP\uff0c$f(i,j)$ \u8868\u793a\u4ece $(i,j)$ \u5f00\u59cb\u8d70\u7684\u6700\u5927\u8d21\u732e\u548c \u3002\u89c4\u5b9a\u4e00\u4e0b\uff0c\u8fd9\u91cc\u7684\u5750\u6807\u5728\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e0a\u8003\u8651\uff0c\u5373\u5411\u53f3 $x$ \u589e\u5927\uff0c\u5411\u4e0b $y$ \u51cf\u5c0f\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5982\u4f55\u4ece\u4e00\u4e2a\u4e0d\u5728\u7f51\u683c\u56fe\u4e0a\u7684\u683c\u70b9\u7684\u8d21\u732e\u3002\u5b9e\u9645\u4e0a\uff0c\u5728\u975e\u7f51\u683c\u4e0a\u8d70\u4e00\u5b9a\u4e0d\u4f18\uff0c\u6240\u4ee5\u6211\u4eec\u5b9e\u9645\u4e0a\u4e00\u5b9a\u4f1a\u5148\u7ad6\u76f4\u5730\u5f80\u4e0b\u8d70\uff0c\u7136\u540e\u8d70\u5230\u4e00\u4e2a\u7f51\u683c\u56fe\u4e0a\u7684\u7ebf\uff0c\u7136\u540e\u8d70\u5230\u5411\u53f3\u7684\u90a3\u4e2a\u683c\u70b9\u3002\u6216\u8005\u5148\u6c34\u5e73\u5411\u53f3\uff0c\u8d70\u5230\u4e00\u4e2a\u7f51\u683c\u7ebf\uff0c\u518d\u5411\u4e0b\u3002\n\n\u66b4\u529b $O(qn)$ \u5728\u539f\u9898\u6050\u6016\u7684 25s \u65f6\u9650\u4e0b\u662f\u53ef\u80fd\u662f\u53ef\u8fc7\u7684\u5427\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u663e\u7136\u53ef\u4ee5\u4f18\u5316\u3002\u6211\u4eec\u79bb\u7ebf\u4e0b\u6765\u3002\u5148\u8003\u8651\u5411\u4e0b\u8d70\u5230\u683c\u7ebf\u3002\u5bf9\u4e8e $i,i+1$ \u4e24\u5217\u4e4b\u95f4\u7684\u8be2\u95ee\u70b9\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\u5176\u5b9e\u5c31\u662f\u5bf9\u4e8e $j$ \u6240\u5728\u5217\u7684\u771f\u5b9e\u5750\u6807\u4f4d\u4e8e $(x,y)$ \u4e0b\u9762\u7684 $\\max_{j} f_{i+1,j}+p_{x,y}w_{i,j}$\uff0c\u5176\u4e2d $p$ \u8868\u793a $(x,y)$ \u5230\u7b2c $i$ \u5217\u7684\u8ddd\u79bb\uff0c$w_{i,j}$ \u8868\u793a\u4ece\u79bb\u6563\u5316\u7684\u7f51\u683c\u7684 $(i,j)$ \u8d70\u5230 $(i+1,j)$ \u7684\u5355\u4f4d\u65f6\u95f4\u7684\u6536\u76ca\u3002\u6ce8\u610f\u5230\u76f8\u540c $i$ \u60c5\u51b5\u4e0b $f$ \u968f\u7740 $j$ \u9012\u589e\u800c\u5355\u8c03\u4e0d\u964d\uff0c\u4e8e\u662f\u5b9e\u9645\u4e0a\u5982\u679c\u5b58\u5728\u53d8\u5927\u7684 $w$ \u90a3\u539f\u672c $w$ \u5c0f\u7684\u90a3\u4e2a\u4e00\u5b9a\u4e0d\u4f18\u3002\u6211\u4eec\u5355\u8c03\u6808\u7ef4\u62a4\u51f8\u58f3\uff0c\u7136\u540e\u6bcf\u6b21\u52a0\u5165\u7684\u65f6\u5019\u989d\u5916\u628a $w$ \u66f4\u5c0f\u7684\u6808\u9876\uff08\u6808\u4e2d\u663e\u7136 $w$ \u5355\u8c03\uff09\u7ed9\u5f39\u6389\u5373\u53ef\u3002\u5411\u53f3\u8d70\u5230\u683c\u7ebf\uff0c\u672c\u8d28\u76f8\u540c\uff0c\u4e0d\u518d\u5177\u4f53\u5c55\u5f00\u3002\n\n\u5199\u4e86 4.5k \u4ee3\u7801 /tuu\uff0c\u987a\u4fbf\u52c9\u4e3a\u5176\u96be\u5730\u5728\u6d1b\u8c37\u4e0a\u62ff\u4e86\u6700\u52a3\u89e3\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define rep(i,a,b) for(int i=(a);i<=(b);i++)\n#define per(i,a,b) for(int i=(a);i>=(b);i--)\n#define fi first\n#define se second\n#define eb emplace_back\n#define popc __builtin_popcount\n#define sgn(x) ((x)&1?-1:1)\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int> pii;\ntypedef vector<int> vi;\ntypedef vector<pii> vp;\ntypedef unsigned long long ull;\ntypedef long double ld;\n\nint read() {\n    int x=0,w=1; char c=getchar(); \n    while(!isdigit(c)) {if(c=='-') w=-1; c=getchar();}\n    while(isdigit(c)) {x=x*10+c-'0'; c=getchar();}\n    return x*w;\n}\n\nconst int N=1e5+9,M=5609,inf=0x3f3f3f3f;\nint k,q,n,m,bx[N],by[N],l[N],r[N],x[N],y[N],c[N],f[M][M],qx[3000009],qy[3000009],ans[3000009],fx[N],fy[N],st[N],totx,toty;\nvector<signed> p[M][M];\nsigned wx[M][M],wy[M][M];\n\nbool cmpc(int a,int b,int c) {\n    return __int128(fy[a]-fy[b])*(fx[b]-fx[c])>__int128(fy[b]-fy[c])*(fx[a]-fx[b]);\n}\nbool cmpk(int a,int b,int k) {\n    return fy[a]-fy[b]>__int128(fx[a]-fx[b])*k;\n}\n\nsigned main() {\n    k=read(), q=read();\n    rep(i,1,k) {\n        int t=read(), a=read(), b=read(); c[i]=read()/2;\n        if(a<b) y[i]=a-t, l[i]=a+t, r[i]=2*b-a+t, x[i]=inf;\n        else x[i]=a+t, r[i]=a-t, l[i]=2*b-a-t, y[i]=inf;\n    }\n    rep(i,1,k) {\n        if(x[i]==inf) by[++toty]=y[i], bx[++totx]=l[i], bx[++totx]=r[i];\n        else if(y[i]==inf) bx[++totx]=x[i], by[++toty]=l[i], by[++toty]=r[i];\n    }\n    sort(by+1,by+toty+1); m=unique(by+1,by+toty+1)-by-1;\n    sort(bx+1,bx+totx+1); n=unique(bx+1,bx+totx+1)-bx-1;\n    rep(i,1,k) if(x[i]==inf) {\n        y[i]=lower_bound(by+1,by+m+1,y[i])-by;\n        l[i]=lower_bound(bx+1,bx+n+1,l[i])-bx;\n        r[i]=lower_bound(bx+1,bx+n+1,r[i])-bx;\n        p[y[i]][l[i]].eb(c[i]), p[y[i]][r[i]].eb(-c[i]);\n    }\n    rep(y,1,m) {\n        multiset<int,greater<int>> s;\n        rep(x,1,n) {\n            for(int a:p[y][x]) {\n                if(a>0) s.insert(a);\n                else s.erase(s.find(-a));\n            }\n            if(s.size()) wx[x][y]=*s.begin();\n        }\n    }\n    rep(i,1,m) rep(j,1,n) p[i][j].clear();\n    rep(i,1,k) if(y[i]==inf) {\n        x[i]=lower_bound(bx+1,bx+n+1,x[i])-bx;\n        l[i]=lower_bound(by+1,by+m+1,l[i])-by;\n        r[i]=lower_bound(by+1,by+m+1,r[i])-by;\n        p[x[i]][r[i]].eb(c[i]), p[x[i]][l[i]].eb(-c[i]);\n    }\n    rep(x,1,n) {\n        multiset<int,greater<int>> s;\n        per(y,m,1) {\n            for(int a:p[x][y]) {\n                if(a>0) s.insert(a);\n                else s.erase(s.find(-a));\n            }\n            if(s.size()) wy[x][y]=*s.begin();\n        }\n    }\n    rep(i,1,n) rep(j,1,m) p[i][j].clear();\n    per(x,n,1) rep(y,1,m) f[x][y]=max(wx[x][y]*(bx[x+1]-bx[x])+f[x+1][y],wy[x][y]*(by[y]-by[y-1])+f[x][y-1]);\n    rep(i,1,q) {\n        int t=read(), a=read(); qy[i]=a-t, qx[i]=a+t;\n        int py=upper_bound(by+1,by+m+1,qy[i])-by-1, px=upper_bound(bx+1,bx+n+1,qx[i])-bx-1;\n        p[px][py].eb(i);\n    }\n    per(x,n-1,0) {\n        per(y,m,1) fx[y]=wx[x][y], fy[y]=f[x+1][y];\n        int top=0;\n        rep(y,1,m) {\n            while(top&&fx[st[top]]<=fx[y]) top--;\n            while(top>1&&!cmpc(y,st[top],st[top-1])) top--;\n            st[++top]=y;\n            for(int id:p[x][y]) {\n                int k=qx[id]-bx[x+1]; ans[id]=max(ans[id],fy[st[1]]-fx[st[1]]*k);\n                int l=2, r=top;\n                while(l<=r) {\n                    int mid=l+r>>1; ans[id]=max(ans[id],fy[st[mid]]-fx[st[mid]]*k);\n                    if(cmpk(st[mid],st[mid-1],k)) l=mid+1;\n                    else r=mid-1;\n                }\n            }\n        }\n    }\n    rep(i,1,n) rep(j,1,m) p[i][j].clear();\n    rep(i,1,q) {\n        int px=lower_bound(bx+1,bx+n+1,qx[i])-bx, py=upper_bound(by+1,by+m+1,qy[i])-by-1;\n        p[py][px].eb(i);\n    }\n    rep(y,0,m) {\n        per(x,n,1) fx[x]=wy[x][y+1], fy[x]=f[x][y];\n        int top=0;\n        per(x,n,1) {\n            while(top&&fx[st[top]]<=fx[x]) top--;\n            while(top>1&&!cmpc(x,st[top],st[top-1])) top--;\n            st[++top]=x;\n            for(int id:p[y][x]) {\n                int k=by[y]-qy[id]; ans[id]=max(ans[id],fy[st[1]]-fx[st[1]]*k);\n                int l=2, r=top;\n                while(l<=r) {\n                    int mid=l+r>>1; ans[id]=max(ans[id],fy[st[mid]]-fx[st[mid]]*k);\n                    if(cmpk(st[mid],st[mid-1],k)) l=mid+1;\n                    else r=mid-1;\n                }\n            }\n        }\n    }\n    rep(i,1,q) printf(\"%lld\\n\",ans[i]);\n    return 0;\n}\n```",
        "postTime": 1678286434,
        "uid": 180652,
        "name": "_lgswdn",
        "ccfLevel": 0,
        "title": "\u4ec0\u4e48\u9898\u76ee \u9700\u8981 25s \u7684\u65f6\u9650\uff1f| [JOISC2021 Day3] \u4fdd\u9556 \u9898\u89e3"
    }
]