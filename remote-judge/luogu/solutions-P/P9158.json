[
    {
        "content": "\u5b98\u65b9\u9898\u89e3\u3002\r\n\r\n\u4e2a\u4eba\u8ba4\u4e3a\u662f\u4e00\u9053\u6bd4\u8f83\u7b80\u5355\u7684\u9898\u76ee\u3002\r\n\r\n\u6bd4\u8f83\u8003\u5bdf\u9009\u624b\u5bf9\u4e8e\u5e38\u89c1\u5957\u8def\u7684\u7ed3\u5408\u80fd\u529b\u3002\r\n\r\n\u5e0c\u671b\u5927\u5bb6\u4e0d\u8981\u505a\u524d\u9762\u7684\u9898\u505a\u81ea\u95ed\u4e86\u4e8e\u662f\u6765\u7f13\u548c\u4e00\u4e0b\u96be\u5ea6\u3002\r\n\r\n~~\u5c0f\u5f69\u86cb\uff0c\u8fd9\u9053\u9898\u6b63\u89e3\u5176\u5b9e\u662f zky \u4e00\u5e74\u524d\u63d0\u4f9b\u7684\u3002~~\r\n\r\n**Sub 1**\r\n\r\n\u66b4\u529b\u3002\r\n\r\n**sub 2**\r\n\r\n\u94fe\u95ee\u9898\u3002\r\n\r\n\u7ef4\u62a4\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u672c\u8eab\u662f\u5426\u5927\u4e8e\u540e\u7f00\u548c\uff0c\u79f0\u8fd9\u6837\u7684\u70b9\u4e3a\u7279\u6b8a\u70b9\u3002\r\n\r\n\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u7684\u70b9\u81f3\u591a\u51fa\u73b0 $O(\\log V)$ \u4e2a\uff0c\u90a3\u4e48\u6bcf\u6b21\u4fee\u6539\u540e\u66b4\u529b\u91cd\u6784\u8fd9\u4e9b\u7279\u6b8a\u70b9\uff0c\u5177\u4f53\u6765\u8bf4\u6211\u4eec\u4ee4\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u4e3a $a_{x} - \\sum_{i = x + 1} ^ {n} a_{i}$\u3002\u6bcf\u6b21\u4fee\u6539\u5728\u7ebf\u6bb5\u6811\u4e0a\u5c31\u662f\u533a\u95f4\u52a0\u5355\u70b9\u4fee\u6539\uff0c\u7136\u540e\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\u9012\u5f52\u627e\u5230\u8fd9\u4e9b\u8282\u70b9\u3002\r\n\r\n\u8fd9\u6837\u539f\u5e8f\u5217\u7684\u7b54\u6848\u88ab\u5206\u6210\u4e86 $O(\\log V)$ \u6bb5\uff0c\u76f4\u63a5\u67e5\u8be2\u5373\u53ef\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+q) \\log V)$\u3002\r\n\r\n**sub 3**\r\n\r\n\u7ebf\u6bb5\u6811\u95ee\u9898\u3002\r\n\r\n\u53d1\u73b0\u5f71\u54cd\u7684\u53ea\u4f1a\u6709\u7956\u5148\u7684\u7b54\u6848\uff0c\u533a\u522b\u4e8e\u6734\u7d20\u7684\u91cd\u6784\u66b4\u529b\uff0c\u76f4\u63a5\u66b4\u529b\u722c\u91cd\u65b0\u6a21\u62df\u540e\u5408\u5e76\u5c31\u884c\u4e86\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n + q) \\log^2 n)$\u3002\r\n\r\n**sub 4**\r\n\r\n\u7ee7\u7eed\u5957\u8def\u3002\r\n\r\n\u51ed\u611f\u89c9\uff0c\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u8fc7\u7a0b\u5f88\u7c7b\u4f3c\u6811\u5256\uff0c\u5408\u5e76\u7684\u8fc7\u7a0b\u8ba9\u4f60\u60f3\u8d77\u70b9/\u8fb9\u5206\u6cbb\u4e0a\u7684\u4e09\u5ea6\u5316\u601d\u60f3\uff0c\u76f4\u63a5\u7ec4\u5408\u4e00\u4e0b\u4e24\u4e2a\u5957\u8def\u3002\r\n\r\n\u5982\u679c\u60a8\u4e0d\u4f1a\u6811\u94fe\u5256\u5206\uff0c\u7f51\u4e0a\u6709\u5f88\u591a\u8d44\u6599\u3002\r\n\r\n\u6b64\u9898\u7684\u4e09\u5ea6\u5316\u6307\u7684\u662f\uff0c\u6bcf\u6b21\u5408\u5e76\u5b50\u6811\u65f6\u89c6\u4e3a\u4e00\u4e2a\u5e8f\u5217\uff0c\u5c06\u5b50\u6811\u6839\u653e\u5728\u5e8f\u5217\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u7136\u540e\u5c06\u5269\u4f59\u70b9\u6309\u7167\u7f16\u53f7\u4ece\u5c0f\u5230\u5927\u6392\u5217\uff0c\u6bcf\u6b21\u5408\u5e76\u7684\u65f6\u5019\u65b0\u5efa\u4e00\u4e2a\u8282\u70b9\u4ee3\u8868\u4e24\u4e2a\u5408\u5e76\u7684\u96c6\u5408\u540e\u65b0\u4ea7\u751f\u7684\u96c6\u5408\u3002\r\n\r\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\r\n\r\n![](https://tuchuangs.com/imgs/2023/03/14/d7b29fde29153f8a.png)\r\n\r\n\u5982\u56fe\uff0c$4$ \u8868\u793a\u7236\u4eb2\uff0c\u5bf9\u8be5\u5b50\u6811\u8fdb\u884c\u4e09\u5ea6\u5316\u540e\u7684\u5f62\u6001\u3002\u91cd\u6784\u6811\u7684\u70b9\u6570\u663e\u7136\u4e5f\u662f $O(n)$ \u7ea7\u522b\u7684\u3002\r\n\r\n\u8fd9\u4e2a\u7ed3\u6784\u7684\u4f18\u52bf\u662f\uff0c\u5b83\u5c06\u5408\u5e76\u8fc7\u7a0b\u7684\u7ed3\u6784\u663e\u6027\u8868\u8fbe\u4e86\u3002\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u7ef4\u62a4\u4e00\u4e0b\u6bcf\u4e2a\u8282\u70b9\u7684\u91cd\u513f\u5b50\uff08\u5373\u6743\u503c\u548c\u4e3a\u952e\u503c\u7684\u91cd\u513f\u5b50\uff09\u3002\r\n\r\n\u518d\u7ed3\u5408\u7b2c\u4e8c\u6863\u90e8\u5206\u5206\uff0c\u53d1\u73b0\u4e00\u6b21\u4fee\u6539\u81f3\u591a\u4f1a\u6709 $O(\\log V)$ \u4e2a\u8282\u70b9\u7684\u8f7b\u91cd\u5173\u7cfb\u88ab\u6539\u53d8\uff0c\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5373\u53ef\u3002\r\n\r\n\u6bdb\u4f30\u4f30\u65f6\u95f4\u590d\u6742\u5ea6 $O((n + q) \\log ^ 2 V)$\uff0c\u4e0d\u6e05\u695a\u6709\u6ca1\u6709\u66f4\u7cbe\u786e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\uff0c\u53cd\u6b63\u6211\u4e5f\u4e0d\u77e5\u9053\u6211\u9020\u7684\u6781\u9650\u6570\u636e\u80fd\u4e0d\u80fd\u5361\u6ee1\u4e24\u53ea $\\log$\uff0c\u81f3\u5c11\u8dd1\u51fa\u6765\u662f\u6bd4\u8f83\u5361\u6ee1\u7684\u6837\u5b50\u3002\r\n\r\n\u6807\u7a0b\u91c7\u7528\u7684\u662f LCT \u7ef4\u62a4\uff0c\u4f20\u7edf\u6811\u5256\u4e5f\u53ef\u5728\u540c\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7ef4\u62a4\uff0c\u53ea\u662f\u4e0d\u65b9\u4fbf\u4e66\u5199\u3002\r\n\r\n```cpp\r\n/*+Rainybunny+*/\r\n\r\n#include <bits/stdc++.h>\r\n#define int long long\r\n#define rep(i, l, r) for (int i = l, rep##i = r; i <= rep##i; ++i)\r\n#define per(i, r, l) for (int i = r, per##i = l; i >= per##i; --i)\r\n#ifndef RYBY\r\n#   undef assert\r\n#   define assert(expr) void() /* do nothing */\r\n#endif\r\n\r\ntypedef long long LL;\r\n\r\ninline char fgc() {\r\n    static char buf[1 << 17], *p = buf, *q = buf;\r\n    return p == q && (q = buf + fread(p = buf, 1, 1 << 17, stdin), p == q) ?\r\n      EOF : *p++;\r\n}\r\n\r\ntemplate <typename Tp = int>\r\ninline Tp rint() {\r\n    Tp x = 0, s = fgc(), f = 1;\r\n    for (; s < '0' || '9' < s; s = fgc()) f = s == '-' ? -f : f;\r\n    for (; '0' <= s && s <= '9'; s = fgc()) x = x * 10 + (s ^ '0');\r\n    return x * f;\r\n}\r\n\r\ntemplate <typename Tp>\r\ninline void wint(Tp x) {\r\n    if (x < 0) putchar('-'), x = -x;\r\n    if (9 < x) wint(x / 10);\r\n    putchar(x % 10 ^ '0');\r\n}\r\n\r\nconst int MAXN = 2e5, MAXND = MAXN << 1;\r\nconst LL LINF = 1ll << 60;\r\nint n, q, node, ref[MAXN + 5], adj[MAXND + 5][2];\r\nLL a[MAXN + 5];\r\nstd::vector<int> son[MAXN + 5];\r\n\r\nnamespace LCT {\r\n\r\nint ch[MAXND + 5][2], fa[MAXND + 5], win[MAXND + 5];\r\nLL gap[MAXND + 5], mng[MAXND + 5], tag[MAXND + 5];\r\n\r\ninline bool nroot(const int u) {\r\n    return ch[fa[u]][0] == u || ch[fa[u]][1] == u;\r\n}\r\n\r\ninline void pushad(const int u, const LL k) {\r\n    mng[u] += k, gap[u] += k, tag[u] += k;\r\n}\r\n\r\ninline void pushdn(const int u) {\r\n    if (tag[u]) {\r\n        if (ch[u][0]) pushad(ch[u][0], tag[u]);\r\n        if (ch[u][1]) pushad(ch[u][1], tag[u]);\r\n        tag[u] = 0;\r\n    }\r\n}\r\n\r\ninline void pushup(const int u) {\r\n    mng[u] = gap[u];\r\n    if (ch[u][0]) mng[u] = std::min(mng[u], mng[ch[u][0]]);\r\n    if (ch[u][1]) mng[u] = std::min(mng[u], mng[ch[u][1]]);\r\n}\r\n\r\ninline LL build(const int u) {\r\n    if (u <= n) return gap[u] = LINF, pushup(u), a[u];\r\n    LL s0 = build(adj[u][0]), s1 = build(adj[u][1]);\r\n    fa[adj[u][0]] = fa[adj[u][1]] = u;\r\n    if (s0 >= s1) win[u] = ch[u][1] = adj[u][0], gap[u] = s0 - s1;\r\n    else win[u] = ch[u][1] = adj[u][1], gap[u] = s1 - s0 - 1;\r\n    return pushup(u), s0 + s1;\r\n}\r\n\r\ninline void rotate(const int u) {\r\n    int v = fa[u], w = fa[v], k = ch[v][1] == u;\r\n    fa[u] = w; if (nroot(v)) ch[w][ch[w][1] == v] = u;\r\n    ch[v][k] = ch[u][!k]; if (ch[u][!k]) fa[ch[u][!k]] = v;\r\n    pushup(ch[fa[v] = u][!k] = v), pushup(u);\r\n}\r\n\r\ninline void splay(const int u) {\r\n    static int v, w, stk[MAXND + 5];\r\n    for (stk[w = 1] = v = u; nroot(v); stk[++w] = v = fa[v]);\r\n    while (w) pushdn(stk[w--]);\r\n    for (; nroot(u); rotate(u)) {\r\n        if (nroot(v = fa[u])) {\r\n            rotate((ch[v][0] == u) == (ch[fa[v]][0] == v) ? v : u);\r\n        }\r\n    }\r\n}\r\n\r\ninline int findCut(int u) {\r\n    if (!u || mng[u] >= 0) return 0;\r\n    while (true) {\r\n        pushdn(u);\r\n        if (ch[u][1] && mng[ch[u][1]] < 0) u = ch[u][1];\r\n        else if (gap[u] < 0) return u;\r\n        else u = ch[u][0];\r\n    }\r\n}\r\n\r\ninline void swapWin(const int u) {\r\n    assert(u > n), assert(!nroot(u));\r\n    gap[u] = -gap[u] - 1, pushup(u);\r\n    assert(gap[u] >= 0);\r\n    win[u] = adj[u][0] ^ adj[u][1] ^ win[u];\r\n}\r\n\r\ninline void modify(int u, const int k) {\r\n    for (int v = u; v; v = fa[v]) {\r\n        splay(v), gap[v] -= k;\r\n        if (ch[v][0]) pushad(ch[v][0], k);\r\n        pushup(v);\r\n    }\r\n\r\n    for (int v; u; u = v) {\r\n        if ((v = findCut(u))) {\r\n            splay(v), swapWin(v);\r\n            splay(win[v]), ch[v][1] = win[v], pushup(v);\r\n        } else v = fa[u];\r\n    }\r\n}\r\n\r\ninline int answer(int u) {\r\n    splay(u);\r\n    while (ch[u][1]) u = ch[u][1];\r\n    splay(u);\r\n    return u;\r\n}\r\n\r\n} // namespace LCT\r\n\r\nsigned main() {\r\n    //freopen(\"data36.in\",\"r\",stdin);\r\n    //freopen(\"data36.out\",\"w\",stdout);\r\n    n = node = rint(), q = rint();\r\n    rep (i, 1, n) a[i] = rint<LL>();\r\n    rep (i, 2, n) son[rint()].push_back(i);\r\n\r\n    per (u, n, 1) {\r\n        ref[u] = u, std::sort(son[u].begin(), son[u].end());\r\n        for (int v: son[u]) {\r\n            ++node, adj[node][0] = ref[u], adj[node][1] = ref[v];\r\n            // printf(\"%d %d\\n%d %d\\n\", node, ref[u], node, ref[v]);\r\n            ref[u] = node;\r\n        }\r\n    }\r\n    LCT::build(node);\r\n\r\n    for (int op, x, y; q--;) {\r\n        op = rint(), x = rint();\r\n        if (op == 1) wint(a[LCT::answer(ref[x])]), putchar('\\n');\r\n        else LCT::modify(x, y = rint<LL>()), a[x] += y;\r\n    }\r\n    return 0;\r\n}\r\n```\r\n\r\nupd 2023/3/19 \u88ab\u6307\u51fa\u4ee3\u7801\u65f6\u95f4\u590d\u6742\u5ea6\u6709\u95ee\u9898\uff0c\u5df2\u66f4\u6b63\uff0c\u611f\u8c22\u6770\u8001\u5e08\u3002",
        "postTime": 1678783031,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u300cGLR-R4\u300d\u5c0f\u6691 sol"
    },
    {
        "content": "$2\\log$ \u6811\u5256\u505a\u6cd5\uff0c\u5e38\u6570\u5de8\u5927\u3002\n\n\u6bcf\u6b21\u4fee\u6539\u4e00\u4e2a\u8282\u70b9\uff0c$f$ \u4f1a\u53d8\u5316\u7684\u70b9\u53ea\u80fd\u662f\u5b83\u7684\u7956\u5148\uff0c\u56e0\u6b64\u8003\u8651\u52a8\u6001\u7ef4\u62a4 $f$\u3002\n\n\u6ce8\u610f\u5230\u5411\u4e0a\u679a\u4e3e\u7956\u5148\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c $size_i>\\frac12size_{fa}$\uff0c\u90a3\u4e48 $f_{fa}$ \u4e00\u5b9a\u7b49\u4e8e $f_i$\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u627e\u51fa\u6240\u6709\u7684 $fa$ \u6ee1\u8db3 $size_{fa}\\geq2size_i$\uff0c\u8fd9\u4e9b\u70b9\u663e\u7136\u53ea\u6709\u4e0d\u8d85\u8fc7 $\\log V$ \u4e2a\uff0c\u5bf9\u6bcf\u4e2a\u70b9\u8ba1\u7b97\u7b54\u6848\uff0c\u7136\u540e\u5bf9\u4e8e\u8fd9\u4e9b $fa$ \u4e4b\u95f4\u7684\u70b9\uff0c\u5229\u7528\u6811\u5256\u533a\u95f4\u8d4b\u503c\u3002\n\n\u5982\u4f55\u627e\u5230\u8fd9\u4e9b $fa$ \u5462\uff0c\u6839\u636e\u4e00\u4e9b\u663e\u7136\u7684\u5957\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u5f97\u5230\u5f53\u524d\u8282\u70b9\u7684 $size_x$\uff0c\u7136\u540e\u5411\u4e0a\u627e\u5230\u7b2c\u4e00\u4e2a $size_{fa}\\geq2size_x$\uff0c\u63a5\u7740\u9a8c\u8bc1 $size_{fa}$ \u662f\u5426\u4e3a\u513f\u5b50\u5927\u5c0f\u7684\u4e24\u500d\u3002\u6700\u591a\u627e $\\log V+\\log n$ \u6b21\uff0c\u6bcf\u6b21\u5bfb\u627e\u53ef\u4ee5\u76f4\u63a5\u7528\u7ebf\u6bb5\u6811\u5b8c\u6210\u3002\n\n\u7136\u540e\u8003\u8651\u5bf9\u8fd9 $\\log V$ \u4e2a $fa$ \u8ba1\u7b97\u7b54\u6848\u3002\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u7684\u662f\u6bcf\u4e2a\u513f\u5b50\u7684 $size_i-size_{pre}$\uff0c\u8fd9\u53ef\u4ee5\u7528[\u4e0a\u4e00\u573a](https://www.luogu.com.cn/contest/78024)[\u53e6\u4e00\u9053\u9898](https://www.luogu.com.cn/problem/P8479)\u7684\u65b9\u6cd5\u7ef4\u62a4\u3002\u5177\u4f53\u5730\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u6761\u91cd\u94fe\uff0c\u4ece\u4e0a\u5411\u4e0b\uff08\u53cd\u5411\u4e5f\u53ef\u4ee5\uff09\u4f9d\u6b21\u5c06\u7f16\u53f7\u5927\u4e8e\u91cd\u513f\u5b50\u7684\u8f7b\u513f\u5b50\u6309\u7f16\u53f7\u52a0\u5165 dfn \u5e8f\u3002\u6bcf\u6b21\u4fee\u6539\u65f6\uff0c\u4f1a\u628a\u4e00\u6761\u91cd\u94fe\u4e0a\u6bcf\u4e2a\u70b9\u7f16\u53f7\u6bd4\u5b83\u5927\u7684\u5144\u5f1f\u4fee\u6539\uff0c\u8fd9\u5728 dfn \u5e8f\u4e0a\u6070\u597d\u662f\u4e00\u6bb5\u8fde\u7eed\u533a\u95f4\u3002\u4e4b\u540e\u53ea\u8981\u5904\u7406\u8f7b\u513f\u5b50\u7684\u8fb9\u754c\u60c5\u51b5\uff0c\u8fd9\u90e8\u5206\u8f83\u597d\u7ef4\u62a4\u3002",
        "postTime": 1679198856,
        "uid": 146070,
        "name": "Pekemetier",
        "ccfLevel": 8,
        "title": "P9158 \u300cGLR-R4\u300d\u5c0f\u6691 \u9898\u89e3"
    },
    {
        "content": "\u5173\u4e8e\u6211\u56e0\u4e3a\u9000\u5f79\u51c6\u5907\u628a\u4ee5\u524d\u51fa\u597d\u7684\u9898\u6574\u7406\u5230\u4e00\u8d77\u51c6\u5907\u5927\u5b66\u6070\u7c73\uff0c\u7ed3\u679c\u88ab\u597d\u670b\u53cb\u60f3\u5230\u4e86\u76f8\u540c idea \u6377\u8db3\u5148\u767b\u75db\u5931\u826f\u673a\uff0c\u7136\u540e\u9ad8\u8003\u6a21\u62df\u9519\u8fc7\u6bd4\u8d5b\uff0cTop Tree \u53c8\u88ab\u5361\u5e38\uff0c\u4e0d\u80fd\u590d\u5236\u7c98\u8d34\uff0c\u4e8e\u662f\u91cd\u6784\u4ee3\u7801\u518d\u6765\u5199\u8fd9\u9053\u9898\u8fd9\u4ef6\u4e8b\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c06\u9898\u610f\u8f6c\u5316\u4e3a\u6c42\u4e8c\u53c9\u6811\u4e0a\u5e26\u70b9\u6743\u4fee\u6539\u7684\u91cd\u94fe\u5256\u5206\u3002\n\nQ\uff1a\u6211\u4eec\u5e94\u5f53\u4ee5\u4f55\u79cd\u601d\u60f3\u548c\u65b9\u6cd5\u6765\u7ef4\u62a4\u91cd\u94fe\u5256\u5206\u3002\n\n- \u56e0\u4e3a\u662f\u4e8c\u53c9\u6811\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\uff0c\u5176\u8282\u70b9\u7684\u5ea6\u6570\u6700\u5927\u662f $3$\uff0c\u53ea\u53ef\u80fd\u6307\u5411\u4e24\u4e2a\u513f\u5b50\u4e2d\u7684\u4e00\u4e2a\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4f7f\u7528\u52a8\u6001\u94fe\u5256\u4e5f\u5c31\u662f LCT \u7684\u65b9\u5f0f\u5bf9\u539f\u6709\u6811\u5256\u7ed3\u6784\u8fdb\u884c\u7ef4\u62a4\uff0c\u5e76\u5728 LCT \u4e0a\u5bf9\u6bcf\u4e2a\u8282\u70b9\u52a0\u4e00\u4e2a\u5916\u5411\u8fb9\u8bb0\u5f55\u865a\u513f\u5b50\u3002\n- \u8003\u8651\u4e00\u6b21\u5355\u70b9\u4fee\u6539\u7684\u5f71\u54cd\uff1a\n  - \u5982\u679c\u6539\u5927\uff0c\u5355\u70b9\u5230\u6839\u7684\u6574\u6761\u94fe\u4e0a\uff0c\u6240\u6709\u6307\u5411\u5916\u7684\u5b9e\u8fb9\u6709\u53ef\u80fd\u6307\u5411\u5f53\u524d\u94fe\u3002\n  - \u5982\u679c\u6539\u5c0f\uff0c\u5355\u70b9\u5230\u6839\u7684\u6574\u6761\u94fe\u4e0a\uff0c\u6240\u6709\u6307\u5411\u5f53\u524d\u94fe\u7684\u5b9e\u8fb9\u6709\u53ef\u80fd\u6307\u5411\u5916\u3002\n- \u90a3\u4e48\u6211\u4eec\u9700\u8981\u7684\u5c31\u662f\u4e00\u4e2a\u9608\u503c\u5224\u5b9a\uff0c\u5224\u5b9a\u5176\u662f\u5426\u4f1a\u6709\u8fb9\u7684\u5207\u6362\u3002\u8fd9\u4e2a\u9608\u503c\u5e94\u8be5\u90fd\u80fd\u591f\u60f3\u5230\u5c31\u662f $dlt=sz_{son}-sz_{other}+pri_{son}$\uff0c\u5373\u5b9e\u513f\u5b50\u5927\u5c0f\u51cf\u53bb\u865a\u513f\u5b50\u5927\u5c0f\u518d\u52a0\u4e0a\u5b9e\u513f\u5b50\u662f\u4e0d\u662f\u53f3\u8fb9\u7684\u513f\u5b50\uff08\u662f\u4e00\u4e2a bool \u53d8\u91cf\uff09\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u662f\u987a\u5e8f\u5927\u5230\u5c0f\u3002\n- \u8fd9\u4e2a\u4e1c\u897f\u5f88\u597d\u7ef4\u62a4\uff0c\u751a\u81f3\u4e0d\u9700\u8981\u61d2\u6807\u8bb0\uff0c\u6bcf\u6b21\u7ef4\u62a4\u5f53\u524d\u5b50\u7ed3\u6784\u6700\u5c0f\u7684 $dlt$\uff0c\u4e0a\u4f20\u7684\u65f6\u5019\u628a\u5b9e\u94fe\u53f3\u4fa7\u5bf9\u5de6\u4fa7\u7684\u5f71\u54cd\u52a0\u4e0a\u53bb\u5373\u53ef\u3002\n- \u6bcf\u6b21\u5355\u70b9\u4fee\u6539\u5c31\u771f\u7684\u662f\u5355\u70b9\u4fee\u6539\uff0c\u628a\u4fee\u6539\u70b9 $splay$\uff0c\u7136\u540e\u4e00\u904d\u505a $search$ \u5207\u6362\u8fb9\uff0c\u4e00\u8fb9\u5c06\u65b0\u4fe1\u606f\u4e0a\u4f20\u5230\u6839\u3002\u56e0\u4e3a\u4fe1\u606f\u53ea\u8ddf\u5b50\u7ed3\u6784\u6709\u5173\u7cfb\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u61d2\u6807\u8bb0\u3002\n\nQ\uff1a\u8fd9\u4e2a\u4e1c\u897f\u590d\u6742\u5ea6\u5982\u4f55\u3002\n\nA\uff1a\u53ef\u4ee5\u5bb9\u6613\u7684\u5f97\u51fa\u4e0a\u754c $\\mathcal O(n\\log^2 n)$\uff08\u6000\u7591\u662f $\\mathcal O(n\\log n)$\uff0c\u5df2\u9000\u5f79\u8fc7\u4e00\u5e74\u518d\u586b\u5751\uff09\n\nQ\uff1a\u600e\u4e48\u505a\u8fd9\u6837\u7684\u9898\u3002\n\n- \u524d\u7f6e\u79d1\u6280\u70b9\uff1a[[ZJOI2018]\u5386\u53f2](https://www.luogu.com.cn/problem/P4338)\n- \u540e\u7f6e\u79d1\u6280\u70b9\uff1a[[Ynoi Easy Round 2020] TEST_63](https://www.luogu.com.cn/problem/P8265)\uff08\u5e26 link\u3001cut \u52a8\u6001\u94fe\u5256\uff09\uff0c\u8700\u9053\u96be\uff08\u6362\u6839 DDP\uff09\n\n```\nvoid push_up(int rt){\n\tv[rt].pre=v[rt].ch[0]?v[v[rt].ch[0]].pre:rt;\n\tv[rt].suf=v[rt].ch[1]?v[v[rt].ch[1]].suf:rt;\n\tv[rt].sum=v[v[rt].ch[0]].sum+v[v[rt].ch[1]].sum+v[v[rt].ch[2]].sum+v[rt].val;\n\tv[rt].dlt=v[rt].ch[2]?v[v[rt].ch[1]].sum-v[v[rt].ch[2]].sum+(pri[v[v[rt].ch[1]].pre]):0x3f3f3f3f3f3f3f3fll;\n\tv[rt].midlt=min(v[v[rt].ch[1]].midlt,v[rt].dlt,v[v[rt].ch[0]].midlt+(v[rt].sum-v[v[rt].ch[0]].sum));\n}\nint searchsuf(int x,long long sufval){\n\tif(v[v[x].ch[1]].midlt+sufval<=0)return searchsuf(v[x].ch[1],sufval);\n\tif(v[x].dlt+sufval<=0)return x;\n\treturn searchsuf(v[x].ch[0],sufval+(v[x].sum-v[v[x].ch[0]].sum));\n}\nvoid redirection(int x){splay(x),swap(v[x].ch[1],v[x].ch[2]),push_up(x);}\nvoid modify(int x,long long val){\n\tsplay(x);long long pre=v[x].val;\n\tv[x].val+=val,push_up(x);\n\twhile(x){\n\t\tsplay(x);\n\t\tif(v[x].dlt<=0)redirection(x);\n\t\tif(v[x].ch[0]&&v[v[x].ch[0]].midlt+(v[x].sum-v[v[x].ch[0]].sum)<=0)x=searchsuf(v[x].ch[0],v[x].sum-v[v[x].ch[0]].sum);\n\t\telse x=v[x].fa;\n\t}\n}\n```",
        "postTime": 1679407839,
        "uid": 27338,
        "name": "jerry3128",
        "ccfLevel": 9,
        "title": "\u9898\u89e3\u3010P9158\u300cGLR-R4\u300d\u5c0f\u6691\u3011"
    }
]