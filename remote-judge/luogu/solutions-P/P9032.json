[
    {
        "content": "\u4ee4 $s(l,r)$ \u8868\u793a $[l,r]$ \u533a\u95f4\u548c\uff0c$g(l,r)$ \u8868\u793a $[l,r]$ \u533a\u95f4 $\\gcd$\u3002 \n\n\u611f\u89c9\u8fd9\u4e2a\u51fd\u6570\u662f\u51f8\u7684\uff08\u5bf9\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684 $r$\uff0c$s(l-1,r)>s(l,r)$\uff0c$g(l-1,r)\\leq g(l,r)$\uff09\uff0c\u4e0a\u624b\u5148\u5199\u4e2a\u4e09\u5206\uff0c\u7ed3\u679c\u5047\u4e86\uff0c\u8fd9\u4e2a\u5f88\u597d hack\uff0c\u53ea\u8981\u5728 $x$ \u4f4d\u7f6e\u51fa\u73b0\u4e00\u4e2a $1$\uff0c\u5bb9\u6613\u6784\u9020 $s(x+1,r)g(x+1,r)\\gt s(x-1,r)\\gt s(x,r)$ \u4f7f\u5176\u65e0\u6cd5\u4e09\u5206\u3002\n\n\u8fd9\u4e2a\u51fd\u6570\u5e94\u8be5\u662f \u82e5\u5e72\u4e2a `\\` \u5f62\u7684\u7ec4\u5408\uff0c\u4e00\u4e2a `\\` \u5bf9\u5e94\u4e00\u4e9b\u76f8\u540c\u7684 $g(x,r)$\uff0c\u8003\u8651\u628a\u6240\u6709\u4e0d\u540c $g(x,r)$ \u7684\u53d6\u503c\u6bb5\u627e\u51fa\u6765\uff0c\u7136\u540e\u6bcf\u4e00\u6bb5\u53d6\u6700\u9760\u5de6\u7684\u90a3\u4e2a\u7aef\u70b9\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $g(1,r),g(2,r)...g(r-1,r),g(r,r)$\uff0c\u6700\u591a\u6709 $\\log V$ \u79cd\u4e0d\u540c\u7684\u53d6\u503c\uff0c\u5176\u4e2d $V$ \u662f\u503c\u57df\uff0c\u8fd9\u662f\u5f88\u597d\u8bc1\u660e\u7684\uff1a\u5f53 $g(x-1,r)\\lt g(x,r)$ \u65f6\uff0c\u6709 $g(x,r)=kg(x,r),k\\geq 2$\uff0c\u6240\u4ee5\u6700\u591a $\\log V$ \u6b21\u5c31\u53d8\u6210 $1$ \u4e86\u3002\n\n\u7528 ST \u8868\u5904\u7406\u4e00\u4e0b $g(l,r)$\uff0c\u7136\u540e\u679a\u4e3e $r$\uff0c\u5e76\u5bf9\u4e8e\u6bcf\u4e2a $r$ \u4e8c\u5206\u51fa $\\log V$ \u4e2a\u4e0d\u540c $g$ \u53d6\u503c\u7684\u6700\u9760\u5de6\u7684\u70b9\uff0c\u7136\u540e\u8ba1\u7b97\u5e76\u53d6 $\\max$ \u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(n\\log n\\log^2V)$\uff0c\u53ef\u4ee5\u8fc7\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u4e24\u4e2a $\\log V$ \u5e76\u4e0d\u80fd\u8dd1\u6ee1\uff1a\u5f53\u4f60\u6784\u9020\u51fa $\\log V$ \u4e2a\u4e0d\u540c $\\gcd$ \u53d6\u503c\u65f6\uff0c\u5373 $2$ \u7684 $x$ \u6b21\u5e42\u7684\u5347\u5e8f\u6392\u5217\uff0c\u6c42 $\\gcd$ \u65f6\u8f97\u8f6c\u76f8\u9664\u7684\u6b21\u6570\u4f1a\u5f88\u5c0f\u3002\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nconst int N = 1e6 + 5;\nint n, k, h[N], g[N][21], lg[N];\nll sum[N], ans;\ninline int gcd(int l, int r) {\n\tint k = lg[r - l + 1];\n\treturn __gcd(g[l][k], g[r - (1 << k) + 1][k]);\n}\ninline ll solve(int r) {\n\tint l = 1;\n\tll res = 0;\n\twhile (l <= r - k + 1) {\n\t\tconst int glr = gcd(l, r);\n\t\tres = max(res, glr * (sum[r] - sum[l - 1]));\n//\t\tcout << l << ' ' << r << endl;\n\t\tif (glr == h[r])\n\t\t\tbreak;\n\t\tint L = l + 1, R = r, pos = r;\n\t\twhile (L <= R) {\n\t\t\tint mid = (L + R) >> 1;\n\t\t\tif (gcd(mid, r) > glr)\n\t\t\t\tpos = mid, R = mid - 1;\n\t\t\telse \n\t\t\t\tL = mid + 1;\n\t\t}\n//\t\tassert(gcd(pos, r) != gcd(l, r) && gcd(pos - 1, r) == gcd(l, r));\n\t\tl = pos;\n\t} \n\treturn res;\n}\nsigned main() {\n\tcin.tie(nullptr)->sync_with_stdio(false);\n\tcin >> n >> k;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> h[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tsum[i] = sum[i - 1] + h[i];\n\tfor (int i = 2; i <= n; i++)\n\t\tlg[i] = lg[i >> 1] + 1;\n\tfor (int i = 1; i <= n; i++)\n\t\tg[i][0] = h[i];\n\tfor (int j = 1; j <= lg[n]; j++)\n\t\tfor (int i = 1; i + (1 << j) - 1 <= n; i++)\n\t\t\tg[i][j] = __gcd(g[i][j - 1], g[i + (1 << (j - 1))][j - 1]);\n\tfor (int i = k; i <= n; i++)\n\t\tans = max(ans, solve(i));\n\tcout << ans << endl;\n\treturn 0;\n}\n```\n\n\u8fd8\u80fd\u4f18\u5316\u3002\n\n\u53d1\u73b0\u6bcf\u6b21 $r+1$ \u65f6\u53ea\u9700\u8981\u5bf9\u8fd9 $\\log V$ \u4e2a\u4e0d\u540c\u7684 $g$ \u518d\u5206\u522b\u5bf9 $h_{r+1}$ \u53d6 $\\gcd$ \u5373\u53ef\uff0c\u53bb\u91cd\u540e\u4f9d\u65e7\u662f $\\log V$ \u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u7ef4\u62a4\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6 $O(n\\log^2 V)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nconst int N = 1e6 + 5;\nint n, k, h[N], g[21], pos[21], tot;\nll sum[N], ans;\nsigned main() {\n\tcin.tie(nullptr)->sync_with_stdio(false);\n\tcin >> n >> k;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> h[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tsum[i] = sum[i - 1] + h[i];\n\tfor (int i = 1; i <= n; i++) {\n\t\tfor (int j = 1; j <= tot; j++)\n\t\t\tg[j] = __gcd(g[j], h[i]);\n\t\tif (g[tot] != h[i])\n\t\t\tg[++tot] = h[i], pos[tot] = i;\n\t\tint ntot = 0;\n\t\tfor (int j = 1; j <= tot; j++)\n\t\t\tif (g[j] != g[j - 1])\n\t\t\t\tg[++ntot] = g[j], pos[ntot] = pos[j];\n\t\ttot = ntot;\n\t\tfor (int j = 1; j <= tot; j++)\n\t\t\tif (i - pos[j] + 1 >= k)\n\t\t\t\tans = max(ans, g[j] * (sum[i] - sum[pos[j] - 1]));\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n\n```",
        "postTime": 1675709954,
        "uid": 434929,
        "name": "Usada_Pekora",
        "ccfLevel": 7,
        "title": "P9032 gcd + \u524d\u7f00\u548c"
    },
    {
        "content": "\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u56fa\u5b9a $l$\uff0c\u90a3\u4e48 $\\gcd(a_l, a_{l+1}, \\cdots, a_r)$ \u663e\u7136\u5355\u8c03\u9012\u51cf\u3002\n\n\u63a5\u7740\u53ef\u4ee5\u53d1\u73b0\uff0c$l$ \u56fa\u5b9a\u65f6\uff0c\u968f\u7740 $r$ \u7684\u589e\u5927\uff0c$\\gcd$ \u7684\u4e0d\u540c\u4e2a\u6570\u5e76\u4e0d\u591a\u3002\n\n\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff1a\u5982\u679c $\\gcd$ \u4e0d\u540c\u4e2a\u6570\u5f88\u591a\uff0c\u90a3\u5c31\u610f\u5473\u7740\u6bcf\u6b21\u589e\u5927 $r$ \u7684\u65f6\u5019\uff0c$a_r$ \u5206\u89e3\u8d28\u56e0\u6570\u540e\u90fd\u4f1a\u6709\u4e00\u4e2a\u8d28\u56e0\u6570\u7684\u6b21\u6570\u53d8\u5c0f\u3002\u800c\u8d28\u56e0\u6570\u7684\u6b21\u6570\u53d8\u5c0f\u5f88\u5feb\u5c31\u4f1a\u53d8\u56de $1$\u3002\n\n\u6240\u4ee5\u56fa\u5b9a $l$\uff0c\u4e8c\u5206 $r$ \u7684\u53d8\u5316\u70b9\u5373\u53ef\u5e76\u4e14 ST \u8868\u7ef4\u62a4\u533a\u95f4 $\\gcd$ \u5373\u53ef\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n#include <numeric>\n#include <vector>\nusing namespace std;\n\nconst int N = 1e6 + 5;\n\nint n, k, a[N];\nlong long ans = 0, sum[N];\n\nint f[N][31], LG2[N];\n\nvoid Init()\n{\n\tLG2[1] = 0;\n\tfor (int i = 2; i < N; i++) LG2[i] = LG2[i >> 1] + 1;\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tf[i][0] = a[i];\n\t}\n\tfor (int j = 1; j <= LG2[n]; j++)\n\t{\n\t\tfor (int i = 1; i + (1 << j) - 1 <= n; i++)\n\t\t{\n\t\t\tf[i][j] = gcd(f[i][j - 1], f[i + (1 << (j - 1))][j - 1]);\n\t\t}\n\t}\n}\n\nint query(int l, int r)\n{\n\tint x = LG2[r - l + 1];\n\treturn gcd(f[l][x], f[r - (1 << x) + 1][x]);\n}\n\nint main()\n{\n\tscanf(\"%d%d\", &n, &k);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]), sum[i] = sum[i - 1] + a[i], ans = max(ans, 1LL * a[i]);\n\tInit();\n\tfor (int i = 1; i <= n - k + 1; i++)\n\t{\n\t\tint nowres = a[i], p = i;\n\t\twhile (p <= n)\n\t\t{\n\t\t\tint l = p + 1, r = n, rr = 0;\n\t\t\twhile (l <= r)\n\t\t\t{\n\t\t\t\tint mid = l + r >> 1;\n\t\t\t\tint gc = query(i, mid);\n\t\t\t\tif (gc >= nowres)\n\t\t\t\t{\n\t\t\t\t\tl = mid + 1;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tr = mid - 1;\n\t\t\t\t\trr = mid;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (rr == 0) break;\n\t\t\tnowres = query(i, rr);\n\t\t\tp = rr - 1;\n\t\t\tif (p - i + 1 >= k)\n\t\t\t{\n\t\t\t\tans = max(ans, (sum[p] - sum[i - 1]) * (long long)(query(i, rr - 1)));\n\t\t\t\t//printf(\"%d %d\\n\", i, p);\n\t\t\t}\n\t\t\tp = rr;\n\t\t}\n\t\tans = max(ans, (sum[n] - sum[i - 1]) * query(i, n));\n\t}\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1676457932,
        "uid": 332914,
        "name": "happybob",
        "ccfLevel": 6,
        "title": "P9032 [COCI2022-2023#1] Neboderi"
    }
]