[
    {
        "content": "- **Subtask 2**\n\n\u4f9d\u6b21\u8003\u8651\u5e8f\u5217\u7684\u6bcf\u4e00\u4f4d\u53bb\u6784\u9020 $b$ \u5e8f\u5217\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5f53\u524d\u8fd9\u4e00\u4f4d\u7684\u6289\u62e9\u53ea\u4f1a\u53d7\u4e0a\u4e00\u4f4d $b$ \u7684\u5927\u5c0f\u5f71\u54cd\uff0c\u56e0\u6b64\u5b9a\u4e49 $f_{i,x}$ \u8868\u793a $b_i = x$ \u65f6\u5f53\u524d $b$ \u5e8f\u5217\u5e26\u6765\u7684\u6700\u5c0f\u82b1\u8d39\u3002\n\n\u590d\u6742\u5ea6\u662f $O(nV^2)$ \u7684\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u53d1\u73b0\u7ed9 $f_i$ \u6eda\u4e00\u4e2a\u540e\u7f00\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6bcf\u4e2a\u72b6\u6001 $O(1)$ \u8f6c\u79fb\u3002  \n\n\u590d\u6742\u5ea6\u4e3a $O(nV)$ \u7684\u3002\n\n\u671f\u671b\u5f97\u5206 15pts\u3002\n\n- **Subtask 1**\n\n\u7ee7\u627f Subtask 2 \u7684\u505a\u6cd5\uff0c\u8003\u8651\u8fdb\u4e00\u6b65\u4f18\u5316\u3002\n\n\u53d1\u73b0 $\\forall b_i$ $\\exist \\ \\ b_i = a_j$\u3002\n\n\u56e0\u4e3a\u5982\u679c\u4e0d\u6ee1\u8db3\uff0c\u6211\u4eec\u628a\u8be5\u4f4d $b_i$ \u53d8\u5c0f\uff0c\u76f4\u5230\u6ee1\u8db3\uff0c\u90a3\u4e48\u7b54\u6848\u4e00\u5b9a\u53d8\u5c0f\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u5b9a\u4e49\u4e3a $f_{i,j}$ \uff0c\u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4f4d\uff0c$b_i$ \u662f $a$ \u4e2d\u7b2c $j$ \u5927\u7684\u5143\u7d20\u3002\n\n\u6eda\u4e00\u4e2a\u524d\u7f00\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\u5c06\u590d\u6742\u5ea6\u8fbe\u5230 $n^2$ \u3002\n\n\u7ed3\u5408\u4e4b\u524d\u505a\u6cd5\uff0c\u671f\u671b 40pts\u3002\n\n- **Subtask 3**\n\n\u7531\u4e8e $\\min{C , 0} \\le f(x,y)$\u3002\n\n\u53c8\u56e0\u4e3a $C = 0$ \uff0c\u5c06 $b_i$ \u8bbe\u4e3a\u6781\u5c0f\u503c\uff0c\u76f4\u63a5\u8f93\u51fa $0$ \u5c31\u597d\u4e86\u3002\n\n\u7ed3\u5408\u4e4b\u524d\u7b97\u6cd5\uff0c\u671f\u671b 45pts\u3002\n\n- **Subtask 4**\n\n\u5bb9\u6613\u5f97\u5230 $\\forall b_i = b_1$ \u3002\n\n\u7ed3\u5408 Subtask 2 \u7684\u7ed3\u8bba\u679a\u4e3e $b_1$ \u7684\u503c\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u7ed3\u5408\u4e4b\u524d\u7b97\u6cd5\uff0c\u671f\u671b 60pts\u3002\n\n- **Subtask 5**\n\n\u4e0d\u4f1a\u3002\n\n\u4f46\u53ef\u80fd\u53ef\u4ee5\u7528 $\\log^2$ \u505a\u6cd5\u6216\u5e26\u6839\u53f7\u505a\u6cd5\u7ef4\u62a4\u51f8\u5305\u5565\u7684\uff0c\u611f\u53d7\u8fc7\u4f46\u6ca1\u60f3\u8fc7\uff0c\u6709\u5199\u4e86\u7684\u540c\u5b66\u6216\u8005\u77e5\u9053\u7684\u540c\u5b66\u53ef\u4ee5\u6559\u6559\u6211\u3002\n\n\u4e5f\u7559\u7ed9\u5e38\u6570\u5347\u5929\u7684\u540c\u5b66\u3002\n\n- **Subtask 6**\n\n\u7ee7\u627f **Subtask 1** \u7684\u505a\u6cd5 (~~\u5b50\u4efb\u52a1\u9996\u5c3e\u547c\u5e94~~)\n\n\u53d1\u73b0\u6eda\u8fc7\u524d\u7f00\u6700\u5c0f\u503c\u540e\u6211\u4eec\u7684\u8f6c\u79fb\u662f\u672c\u4f4d\u8f6c\u79fb\u3002\n\n\u56e0\u6b64\u5c06\u6211\u4eec\u6eda\u8fc7\u524d\u7f00\u6700\u5c0f\u503c\u7684 $f$ \u6570\u7ec4\u62cd\u5230\u7ebf\u6bb5\u6811\u4e0a\uff0c\u7ef4\u62a4\u533a\u95f4\u6700\u5c0f\u503c\u3002\n\n\u8003\u8651\u7b2c $i$ \u6b21\u8f6c\u79fb\u5e26\u6765\u7684\u6539\u53d8\u3002\u8bbe $a_i$ \u662f\u7b2c $k$ \u5927\u7684\u5143\u7d20\u3002\n\n\u90a3\u4e48 $\\forall j \\in [k+1,n]$ \uff0c$f_{i,j} = f_{i-1,j} + C$\u3002\n\n\u7ebf\u6bb5\u6811\u76f4\u63a5\u533a\u95f4\u4fee\u6539\u5c31\u53ef\u4ee5\u7ef4\u62a4\u3002\n\n\u90a3\u4e48 $\\forall j \\in [1,k]$ \uff0c$f_{i,j} = f_{i-1,j} + b_j - a_i$\u3002\n\n$-a_i$ \u7684\u90e8\u5206\u7ebf\u6bb5\u6811\u533a\u95f4\u4fee\u6539\u89e3\u51b3\u3002\n\n\u800c $+b_j$ \u5219\u662f\u5bf9\u4e00\u4e2a\u6570\u5217\u52a0\u4e0a\u53e6\u4e00\u4e2a\u6570\u5217\uff0c\u4e0d\u597d\u7ef4\u62a4\u3002\n\n\u5206\u6790\u6027\u8d28\uff0c\u53d1\u73b0\u8fd9\u4e24\u4e2a\u6570\u5217\u90fd\u662f\u5355\u8c03\u4e0d\u589e\u7684\uff0c\u6240\u4ee5\u539f\u6765\u6700\u5c0f\u503c\u662f\u533a\u95f4\u53f3\u7aef\u70b9\u7684\u503c\uff0c\u52a0\u4e0a\u5355\u8c03\u4e0d\u589e\u7684\u5e8f\u5217\u540e\u6700\u5c0f\u503c\u8fd8\u662f\u53f3\u7aef\u70b9\u7684\u503c\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8fd8\u8981\u5b8c\u6210\u6eda\u524d\u7f00\u6700\u5c0f\u503c\u7684\u64cd\u4f5c\u3002\n\n\u4f46\u662f\u6ce8\u610f\u5230\uff0c\u6b64\u65f6\u6211\u4eec\u7684 $f$ \u6570\u7ec4\u662f\u4e24\u4e2a\u5355\u8c03\u4e0d\u589e\u5e8f\u5217\u9996\u5c3e\u76f8\u8fde\u800c\u6210\u7684\u3002\n\n\u56e0\u6b64\uff0c\u7528\u524d\u4e00\u4e2a\u5355\u8c03\u4e0d\u589e\u5e8f\u5217\u7684\u6700\u5c0f\u503c\u5bf9\u540e\u4e00\u4e2a\u5355\u8c03\u4e0d\u589e\u5e8f\u5217\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u6253\u6807\u8bb0\u533a\u95f4\u63a8\u5e73\u5c31\u597d\u4e86\u3002\n\n\u8981\u6ce8\u610f\u5728 `push_down` \u6807\u8bb0\u4e4b\u524d\u8981\u4fdd\u8bc1\u513f\u5b50\u7684\u63a8\u5e73\u6807\u8bb0\u5df2\u7ecf\u4e0b\u4f20\u3002\n\n- **\u96be\u70b9\u5206\u6790**\n\n~~\u51e0\u4e4e\u6ca1\u6709\u96be\u70b9\u3002~~\n\n\u96be\u70b9\u5728\u4e8e\u628a dp \u62cd\u5230\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u7684\u884c\u4e3a\u5e76\u4e0d\u5b58\u5728\u6781\u5f3a\u7684\u52a8\u673a\u3002\n\n\u53e6\u5916\uff0c\u5373\u4f7f\u62cd\u5230\u7ebf\u6bb5\u6811\u4e0a\uff0c\u540e\u7eed\u7ef4\u62a4\u4e5f\u5e76\u4e0d\u90a3\u4e48\u663e\u7136\u3002\n\n\u6240\u4ee5\u9009\u624b\u5982\u679c\u7f3a\u4e4f\u5bf9 dp \u7279\u6027\u548c\u8fd9\u79cd\u601d\u8def\u7684\u53ef\u884c\u6027\u7684\u611f\u77e5\uff0c\u90a3\u4e48\u5f88\u5bb9\u6613\u653e\u5f03\u5bf9\u8fd9\u79cd\u601d\u8def\u7684\u7ee7\u7eed\u63a2\u7d22\u3002\n\n\n- **\u547d\u9898\u60f3\u6cd5**\n\n\u628a `dp` \u6570\u7ec4\u62cd\u5230\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u7684\u9898\u76ee\u5728\u6a21\u62df\u8d5b\u4e2d\u5e76\u4e0d\u7f55\u89c1\uff0c\u4f46\u662f\u5728\u6d1b\u8c37\u9898\u5e93\u548c\u516c\u5f00\u8d5b\u4e2d\u6211\u5e76\u6ca1\u6709\u770b\u89c1\u592a\u591a\uff0c\u56e0\u6b64\u60f3\u8981\u628a\u8fd9\u4e2a\u6280\u5de7\u666e\u53ca\u4e00\u4e0b\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u8fd9\u9053\u9898\u3002\n\n- **\u9884\u6d4b**\n\n\u6bd4\u8d5b\u5f00\u59cb\u540e 1h \u5185\u5e94\u8be5\u6709\u4eba\u80fd\u591f\u5207\u6389\uff08\u53ea\u8003\u8651\u987a\u5e8f\u505a\u9898\u7684\u60c5\u51b5\uff09\u3002\n\n\u901a\u8fc7\u4eba\u6570\u5e94\u8be5\u4e0d\u5c11\u4e8e 30 \u4eba\u3002\n\n\u5e94\u8be5\u6ca1\u6709\u9009\u624b\u4f1a\u88ab\u5361\u5e38\u5427?\n\n~~\u867d\u7136\u6709\u9a8c\u9898\u4eba\u88ab\u5361\u5e38\u4e86\u3002~~\n\n- **\u540e\u7eed**\n\n\u8d5b\u65f6\u8fd8\u771f\u6709\u4eba\u5199\u522b\u7684\u505a\u6cd5\u88ab\u5361\u5e38\u4e86\u554a\u3002/hx\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <map>\n#include <set>\n#include <queue>\n#include <cmath>\n#include <bitset>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#define pii pair <int , int>\n#define mp make_pair\n#define fs first\n#define sc second\nusing namespace std;\ntypedef long long LL;\ntypedef unsigned long long ULL;\n\nconst int Mxdt=100000; \nstatic char buf[Mxdt],*p1=buf,*p2=buf;\n#define getchar() p1==p2&&(p2=(p1=buf)+fread(buf,1,Mxdt,stdin),p1==p2)?EOF:*p1++;\n\ntemplate <typename T>\nvoid read(T &x) {\n\tT f=1;x=0;char s=getchar();\n\twhile(s<'0'||s>'9') {if(s=='-') f=-1;s=getchar();}\n\twhile(s>='0'&&s<='9') {x=(x<<3)+(x<<1)+(s-'0');s=getchar();}\n\tx *= f;\n}\n\ntemplate <typename T>\nvoid write(T x , char s='\\n') {\n\tif(!x) {putchar('0');putchar(s);return;}\n\tif(x<0) {putchar('-');x=-x;}\n\tT tmp[25]={},t=0;\n\twhile(x) tmp[t++]=x%10,x/=10;\n\twhile(t-->0) putchar(tmp[t]+'0');\n\tputchar(s); \n}\n\nconst int MAXN = 2e6 + 5;\n\nint n , k , a[MAXN];\nLL tr[MAXN << 2] , tag1[MAXN << 2] , tag2[MAXN << 2] , C;\nint b[MAXN] , fl[MAXN << 2] , id[MAXN];\n\nvoid push_fl(int now) {\n\tif(!fl[now]) return;\n\ttr[now << 1] = tr[now << 1 | 1] = tr[now];\n\ttag1[now << 1] = tag1[now << 1 | 1] = 0;\n\ttag2[now << 1] = tag2[now << 1 | 1] = 0;\n\tfl[now << 1] = fl[now << 1 | 1] = 1;\n\tfl[now] = 0;\n}\n\nvoid push_down(int mid , int r , int now) {\n\tpush_fl(now);\n\tpush_fl(now << 1) , push_fl(now << 1 | 1);\n\tif(tag1[now]) {\n\t\ttr[now << 1] += tag1[now];tag1[now << 1] += tag1[now];\n\t\ttr[now << 1 | 1] += tag1[now];tag1[now << 1 | 1] += tag1[now];\n\t\ttag1[now] = 0;\n\t}\n\tif(tag2[now]) {\n\t\ttr[now << 1] += b[mid] * tag2[now];tag2[now << 1] += tag2[now];\n\t\ttr[now << 1 | 1] += b[r] * tag2[now];tag2[now << 1 | 1] += tag2[now];\n\t\ttag2[now] = 0; \n\t}\n}\n\nvoid push_up(int now) {tr[now] = min(tr[now << 1] , tr[now << 1 | 1]);}\n\nLL Val;\nvoid update(int l , int r , int now , int x , LL v1 , LL v2) {\n\tint mid = (l + r) >> 1;\n\tif(l != r) push_down(mid , r , now);\n\tif(r <= x) {\n\t\tpush_fl(now);\n\t\ttr[now] += v1 , tag1[now] += v1;\n\t\ttr[now] += b[r] , tag2[now] ++;\n\t\tif(r == x) Val = tr[now];\n\t\treturn;\n\t}\n\tif(l > x) {\n\t\tpush_fl(now);\n\t\ttr[now] += v2 , tag1[now] += v2;\n\t\treturn;\n\t}\n\tupdate(l , mid , now << 1 , x , v1 , v2);\n\tupdate(mid + 1 , r , now << 1 | 1 , x , v1 , v2);\n\tpush_up(now);\n}\n\nbool modify(int l , int r , int now , int x , LL V) {\n\tint mid = (l + r) >> 1;\n\tif(l != r) push_down(mid , r , now);\n\tif(l > x) {\n\t\tif(tr[now] > V) {\n\t\t\ttr[now] = V , tag1[now] = tag2[now] = 0;\n\t\t\tfl[now] = 1;\n\t\t\treturn 1; \n\t\t}\n\t\tif(l != r) {\n\t\t\tif(modify(l , mid , now << 1 , x , V)) modify(mid + 1 , r , now << 1 | 1 , x , V);\n\t\t}\n\t\treturn 0;\n\t}\n\tif(l == r) return 0;\n\tif(x < mid) {\n\t\tif(modify(l , mid , now << 1 , x , V)) return modify(mid + 1 , r , now << 1 | 1 , x , V);\n\t\treturn 0;\n\t}\n\treturn modify(mid + 1 , r , now << 1 | 1 , x , V);\n} \n\nint main() {\n\tread(n),read(C);\n\tfor (int i = 1; i <= n; ++i) read(a[i]) , b[i] = a[i];\n\tsort(b + 1 , b + 1 + n);\n\tint m = unique(b + 1 , b + 1 + n) - b - 1;\n\tfor (int i = 1; i <= n; ++i) id[i] = lower_bound(b + 1 , b + 1 + m , a[i]) - b , id[i] = m - id[i] + 1;\n\treverse(b + 1 , b + 1 + m);\n\t\n\tfor (int i = 1; i <= n; ++i) {\n\t\tupdate(1 , m , 1 , id[i] , -a[i] , C);\n\t\tmodify(1 , m , 1 , id[i] , Val); \n\t}\n\twrite(tr[1]);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1644672034,
        "uid": 171554,
        "name": "Reanap",
        "ccfLevel": 9,
        "title": "\u300cGLR-R3\u300d\u60ca\u86f0"
    },
    {
        "content": "\u8fd9\u9053\u9898\u7684 $O(n^2)$ \u7b97\u6cd5\u597d\u60f3\uff0c\u56e0\u4e3a\u53ef\u4ee5\u8bbe $f_{i,k}$ \u8868\u793a $k\\le b_i$ \u65f6 $\\sum\\limits_{1\\le j\\le i}f(a_j,b_j)$ \u7684\u6700\u5c0f\u503c\uff0c\u5982\u679c $b_i\\ne k$\uff0c\u8fd9\u6837\u7684 $k$ \u663e\u7136\u65e0\u610f\u4e49\uff0c\u79bb\u6563\u5316\u540e\u5c31\u53ef\u4ee5 $O(n^2)$ \u7684\u52a8\u6001\u89c4\u5212\u4e86\uff0c\u6700\u540e\u7684 $f_{n,1}$ \u5c31\u662f\u7b54\u6848\uff0c~~\u663e\u7136\u8fc7\u4e0d\u4e86~~\u3002\n\n\u8003\u8651\u4f18\u5316\u5b83\uff0c\u4e0d\u96be\u53d1\u73b0\u4e00\u4e9b\u6027\u8d28\uff1a\n\n1. \u4e00\u5b9a\u6709 $f_{i,k}\\le f_{i.k+1}$\uff0c~~\u5e9f\u8bdd~~\uff1b\n2. \u8bbe $g_{i,k}$ \u8868\u793a $k=b_i$ \u65f6 $\\sum\\limits_{1\\le j\\le i}f(a_j,b_j)$ \u7684\u6700\u5c0f\u503c\uff0c\u6545\u6709 $g_{i,k}=f_{i-1,k}+f(k,b_i),f_{i,k}=\\min\\limits_{p>k}\\{f_{i,p},g_{i,k}\\}$\uff1b\n3. $\\forall k\\ge b_i,p>k,f(b_i,k)<f(b_i,p)\\Rightarrow f_{i,k}=g_{i,k}$\uff1b\n4. $\\forall k<b_i,k<p<b_i,f(b_i,k)=f(b_i,p)\\Rightarrow f_{i,k}=\\min\\{g_{i,k},f_{i,b_i}\\}$\u3002\n\n\u597d\u4e86\uff0c\u4e3a\u4e86\u4e0d\u8ba9\u8bbe\u72b6\u6001\u53d8\u6210 $O(n^2)$\uff0c\u6211\u4eec\u7528 $f_k$ \u8868\u793a\u5f53\u524d\u7684 $f_{i,k}$\uff0c\u6211\u4eec\u5148\u5c06 $f_k$ \u4fee\u6539\u6210 $g_k$,\u7528\u7ebf\u6bb5\u6811\u533a\u95f4\u52a0\u5373\u53ef\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u5bf9\u4e8e $k\\ge b_i$ \u6709 \u533a\u95f4\u52a0\u81ea\u8eab\u6743\u503c\uff08$k$\uff09\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u8fd9\u6837\u7684\u7684\u7ebf\u6bb5\u6811\u53ea\u652f\u6301\u5355\u70b9\u67e5\u8be2\u3002\n\n\u4fee\u6539\u540e\uff0c\u8003\u8651\u9700\u8981\u5c06 $k<b_i$ \u7684\u6570\u5bf9 $f_{b_i}$ \u53d6\u6700\u5c0f\u503c\uff0c\u56e0\u4e3a\u65e0\u6cd5\u6253\u6700\u5c0f\u503c\u6807\u8bb0\uff08\u524d\u540e\u90fd\u53ef\u80fd\u6709\u533a\u95f4\u52a0\u6743\u503c\u64cd\u4f5c\uff09\uff0c\u6240\u4ee5\u540c\u6837\u662f\u65e0\u6cd5\u76f4\u63a5\u4fee\u6539\u7684\uff0c\u53d1\u73b0 $\\forall k<b_i,g_{k-1}\\le g_k$\uff0c\u4e8e\u662f\u53ea\u6709\u4e00\u4e2a\u533a\u95f4\u9700\u8981\u8fdb\u884c\u533a\u95f4\u8d4b\u503c\uff0c\u76f4\u63a5\u4e8c\u5206\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(n\\log_2^2n)$ \u7684~~\u4f18\u79c0~~\u8d85\u65f6\u7b97\u6cd5\u3002\n\n\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u91cc\u4f7f\u7528\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811\u4ee3\u66ff\u7ebf\u6bb5\u6811\uff0c\u65e2\u51cf\u5c11\u7801\u91cf\uff0c\u53c8\u65b9\u4fbf\u4e8c\u5206\u3002\n\n\u65f6\u95f4 $O(n\\log_2n)$\uff0c\u7a7a\u95f4 $O(n)$\uff0c\u4e0d\u7528\u5f00\u7ebf\u6bb5\u6811\u7684\u56db\u500d\u7a7a\u95f4\uff0c\u7a7a\u95f4\u4e0d\u5230 40MB\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e6+5;\nusing ll=long long;\n#define IV static inline void\nnamespace fast_io{\n    char buf[N+5],*p1,*p2,c;\n    #define gc (p1==p2&&(p2=(p1=buf)+fread(buf,1,N,stdin),p1==p2)?EOF:*p1++)\n    inline int read(){\n        int an=0,f=1;while(!isdigit(c=gc))if(c=='-')f=-f;\n        do an=an*10+(48^c);while(isdigit(c=gc));return an*f;\n    }\n};using fast_io::read;\nll ad1[N],ad2[N],my[N],mk[N];\nint n,C,a[N],mp[N],mt;\nIV Ad1(int l,int r,ll d){ad1[l+r>>1]+=d;}\nIV Ad2(int l,int r,ll d){ad2[l+r>>1]+=d;}\nIV Mk(int l,int r,ll d){mk[l+r>>1]=d;}\nIV pd(int l,int r);\nIV pmk(int l,int r);\nIV pd(int l,int r){\n\tint x=l+r>>1;\n\tif(~mk[x]){\n\t\tmy[x]=mk[x];\n\t\tif(l<x)Mk(l,x-1,mk[x]);\n\t\tif(x<r)Mk(x+1,r,mk[x]);\n\t}else if(ad1[x]||ad2[x]){\n\t\tmy[x]+=ad1[x]+ad2[x]*mp[x];\n\t\tif(l<x)pmk(l,x-1),Ad1(l,x-1,ad1[x]),Ad2(l,x-1,ad2[x]);\n\t\tif(x<r)pmk(x+1,r),Ad1(x+1,r,ad1[x]),Ad2(x+1,r,ad2[x]);\n\t}mk[x]=-1,ad1[x]=ad2[x]=0;\n}\nIV pmk(int l,int r){\n\tif(~mk[l+r>>1])pd(l,r);\n}\nvoid Add(int L,int R,ll d1,ll d2=1,int l=1,int r=mt){\n\tpd(l,r);if(l>=L&&r<=R){Ad1(l,r,d1),Ad2(l,r,d2);return;}\n\tint x=l+r>>1;if(x>=L&&x<=R)my[x]+=d1+d2*mp[x];\n\tif(l<x&&L<x)Add(L,R,d1,d2,l,x-1);\n\tif(x<r&&x<R)Add(L,R,d1,d2,x+1,r);\n}\nvoid Mak(int L,int R,ll d,int l=1,int r=mt){\n\tpd(l,r);if(l>=L&&r<=R){Mk(l,r,d);return;}\n\tint x=l+r>>1;if(x>=L&&x<=R)my[x]=d;\n\tif(l<x&&L<x)Mak(L,R,d,l,x-1);\n\tif(x<r&&x<R)Mak(L,R,d,x+1,r);\n}\nll get(int p,int l=1,int r=mt){\n\tpd(l,r);int x=l+r>>1;\n\treturn p<x?get(p,l,x-1):p>x?get(p,x+1,r):my[x];\n}\nint get(ll d,int L,int R,int l,int r){\n\tif(l>r)return 0;pd(l,r);\n\tint x=l+r>>1,res=0;\n\tif(x<L)return get(d,L,R,x+1,r);\n\tif(x>R)return get(d,L,R,l,x-1);\n\tif(my[x]>=d){\n\t\tif(!(res=get(d,L,R,l,x-1)))res=x;\n\t}else res=get(d,L,R,x+1,r);\n\treturn res;\n}\nll get_ans(int l,int r){\n\tpd(l,r);int x=l+r>>1;ll res=my[x];\n\tif(l<x)res=min(res,get_ans(l,x-1));\n\tif(x<r)res=min(res,get_ans(x+1,r));\n\treturn res;\n}\nint main(){\n\tn=read(),C=read();int i,l,r,md;ll val;\n\tfor(i=1;i<=n;++i)mk[i]=-1,mp[i]=a[i]=read();\n\tstable_sort(mp+1,mp+n+1);\n\tmt=unique(mp+1,mp+n+1)-mp-1;\n\tfor(i=1;i<=n;++i){\n\t\ta[i]=lower_bound(mp+1,mp+mt+1,a[i])-mp;\n\t\tAdd(a[i],mt,-mp[a[i]]);\n\t\tif(a[i]>1){\n\t\t\tAdd(1,a[i]-1,C,0),val=get(a[i]);\n\t\t\tMak(get(val,1,a[i],1,mt),a[i],val);\n\t\t}\n\t}printf(\"%lld\\n\",get_ans(1,mt));\n\treturn 0;\n}\n```",
        "postTime": 1661074054,
        "uid": 502410,
        "name": "EnofTaiPeople",
        "ccfLevel": 0,
        "title": "\u7ebf\u6bb5\u6811\u7b80\u5355\u5e94\u7528"
    },
    {
        "content": "> C. [P8476\u300cGLR-R3\u300d\u60ca\u86f0 ](https://www.luogu.com.cn/problem/P8476)\n\n\u8003\u8651 DP\uff0c\u8bbe $g_{i, j}$ \u8868\u793a\u4f7f\u5f97 $b_i = j$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5219 $g_{i, j} = \\min\\limits_{k \\geq j} g_{i - 1, k} + f(j, a_i)$\u3002\u76f4\u63a5\u505a\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(nV)$\uff0c\u4e0d\u53ef\u63a5\u53d7\u3002\n\n\u8003\u8651\u8f6c\u79fb\u7684\u672c\u8d28\uff0c\u5bf9 $g_{i - 1}$ \u505a\u4e00\u904d\u540e\u7f00 $\\min$\uff0c\u7136\u540e\u4ee4 $g_{i, j} \\gets g_{i - 1, j} + f(j, a_i)$\u3002$f$ \u548c\u540e\u7f00 $\\min$ \u7684\u4f18\u79c0\u6027\u8d28\u4f7f\u5f97\u53ef\u4ee5\u5feb\u901f\u7ef4\u62a4 $g$\u3002\u5177\u4f53\u5730\uff0c\u5bf9 $g_{i - 1}$ \u505a\u540e\u7f00 $\\min$ \u4e4b\u540e $g_{i - 1}$ \u5177\u6709\u5355\u8c03\u6027 $g_{i - 1, j}\\leq g_{i - 1, j + 1}$\uff0c\u800c $f(j, a_i)$ \u662f\u5173\u4e8e $j$ \u7684\u5206\u6bb5\u51fd\u6570\uff0c\u5f53 $j < a_i$ \u65f6\u76f8\u5f53\u4e8e\u4e3a $g_{i - 1, j}$ \u533a\u95f4\u52a0 $C$\uff0c\u5f53 $j \\geq a_i$ \u65f6\u76f8\u5f53\u4e8e\u4e3a $g_{i - 1, j}$ \u52a0\u4e0a $j - a_i$\uff0c\u4e24\u90e8\u5206\u5206\u522b\u5177\u6709\u5355\u8c03\u6027\uff0c\u6240\u4ee5\u64cd\u4f5c\u7ed3\u675f\u540e $g_{i, j}$ \u4ee5 $a_i$ \u4e3a\u5206\u5272\u7ebf\u53d8\u6210\u4e24\u6bb5\u5173\u4e8e $j$ \u5177\u6709\u5355\u8c03\u6027\u7684\u5e8f\u5217\u3002\n\n\u6839\u636e\u4e0a\u8ff0\u5206\u6790\uff0c\u5bf9 $g_{i - 1}$ \u505a\u540e\u7f00 $\\min$ \u65f6\uff0c\u53ea\u9700\u7ebf\u6bb5\u6811\u4e8c\u5206\u51fa $< a_{i - 1}$ \u7684\u4f4d\u7f6e\u4e2d\u6700\u540e\u4e00\u4e2a\u4f7f\u5f97 $g_{i, j} > g_{i, a_{i - 1}}$ \u7684\u4f4d\u7f6e $j$\uff0c\u5219\u8be5\u64cd\u4f5c\u53ef\u89c6\u4e3a\u5bf9 $g_{i - 1, j}\\sim g_{i - 1, a_{i - 1} - 1}$ \u533a\u95f4\u8d4b\u503c $g_{i - 1, a_i - 1}$\u3002\n\n\u5c06 $a$ \u79bb\u6563\u5316\uff0c\u8bbe $g_{i, j}$ \u8868\u793a\u4f7f\u5f97 $b_i = a_j$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5219\u9700\u8981\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\n- \u533a\u95f4\u7ed9\u4f4d\u7f6e $i$ \u52a0\u4e0a $a_i$\u3002\n- \u533a\u95f4\u52a0\u6cd5\u3002\n- \u533a\u95f4\u8d4b\u503c\u3002\n- \u7ebf\u6bb5\u6811\u4e8c\u5206 $< p$ \u7684\u4f4d\u7f6e\u6700\u540e\u4e00\u4e2a $> v$ \u7684\u4f4d\u7f6e $q$\uff0c\u4fdd\u8bc1 $< p$ \u7684\u4f4d\u7f6e\u5177\u6709\u5355\u8c03\u6027\u3002\n\n\u7ef4\u62a4\u533a\u95f4\u6700\u5927\u503c\u548c\u8d4b\u503c\uff0c\u52a0\u6cd5\uff0c\u52a0 $a_i$ \u61d2\u6807\u8bb0\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nusing ll = long long;\nusing pii = pair<int, int>;\n#define TIME 1e3 * clock() / CLOCKS_PER_SEC\nbool Mbe;\nconstexpr int N = 1e6 + 5;\nll val[N << 2], b[N];\nstruct tag {\n  ll ass, add, badd;\n  tag operator + (const tag &x) const {\n    if(x.ass != -1) return x;\n    tag z = *this;\n    z.add += x.add, z.badd += x.badd;\n    return z;\n  }\n} laz[N << 2];\nvoid eff(int l, ll x, tag v) {\n  if(v.ass != -1) val[x] = v.ass;\n  val[x] += v.add + b[l] * v.badd;\n  laz[x] = laz[x] + v;\n}\nvoid down(int l, int r, int x) {\n  int m = l + r >> 1;\n  eff(m, x << 1, laz[x]);\n  eff(r, x << 1 | 1, laz[x]);\n  laz[x] = {-1, 0, 0};\n}\nvoid modify(int l, int r, int ql, int qr, int x, tag v) {\n  if(ql > qr) return;\n  if(ql <= l && r <= qr) return eff(r, x, v);\n  int m = l + r >> 1;\n  down(l, r, x);\n  if(ql <= m) modify(l, m, ql, qr, x << 1, v);\n  if(m < qr) modify(m + 1, r, ql, qr, x << 1 | 1, v);\n  val[x] = max(val[x << 1], val[x << 1 | 1]);\n}\nint binary(int l, int r, int p, int x, ll lim) { // find the first position that val[x] >= lim\n  if(r <= p && val[x] < lim) return -1;\n  if(l == r) return l;\n  int m = l + r >> 1;\n  down(l, r, x);\n  int res = binary(l, m, p, x << 1, lim);\n  if(res != -1) return res;\n  res = m < p ? binary(m + 1, r, p, x << 1 | 1, lim) : -1;\n  return res;\n}\nll query(int l, int r, int p, int x) {\n  if(l == r) return val[x];\n  int m = l + r >> 1;\n  down(l, r, x);\n  if(p <= m) return query(l, m, p, x << 1);\n  return query(m + 1, r, p, x << 1 | 1);\n}\nint n, C, a[N];\nbool Med;\nint main() {\n  fprintf(stderr, \"%.3lf MB\\n\", (&Mbe - &Med) / 1048576.0);\n  #ifdef ALEX_WEI\n    freopen(\"1.in\", \"r\", stdin);\n    freopen(\"1.out\", \"w\", stdout);\n  #endif\n  ios::sync_with_stdio(0);\n  cin >> n >> C;\n  for(int i = 1; i <= n; i++) cin >> a[i], b[i] = a[i];\n  sort(b + 1, b + n + 1);\n  for(int i = 1; i <= n << 2; i++) laz[i].ass = -1;\n  for(int i = 1; i <= n; i++) {\n    int p = lower_bound(b + 1, b + n + 1, a[i]) - b;\n    modify(1, n, p + 1, n, 1, (tag) {-1, -a[i], 1});\n    if(p == 1) continue;\n    modify(1, n, 1, p - 1, 1, (tag) {-1, C, 0});\n    ll v = query(1, n, p, 1);\n    int pos = binary(1, n, p - 1, 1, v);\n    if(pos != -1) modify(1, n, pos, p - 1, 1, (tag) {v, 0, 0});\n  }\n  cout << query(1, n, 1, 1) << \"\\n\";\n  cerr << TIME << \" ms\\n\";\n  return 0;\n}\n/*\n2022/8/14\nAuthor: Alex_Wei\nstart coding at 15:55\nfinish debugging at 16:40\n*/\n```",
        "postTime": 1661057423,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P8476 \u300cGLR-R3\u300d\u60ca\u86f0"
    },
    {
        "content": "# \u524d\u8a00\n\n\u8d5b\u65f6 T3 \u6ca1\u60f3\u51fa\u6765\uff0c\u56de\u6765\u8865\u4e00\u4e0b\u3002\n\n# \u6b63\u6587\n\n\u7206\u641c\u590d\u6742\u5ea6\u8fc7\u9ad8\u4e00\u5206\u6ca1\u6709\uff08\u8bb0\u5fc6\u5316\u641c\u7d22\u9664\u5916\uff09\uff0c\u8003\u8651 DP.\n\n\u53d1\u73b0 Subtask #2 \u7684\u503c\u57df\u5947\u5c0f\u65e0\u6bd4\uff0c\u4e8e\u662f\u8bbe $f_{i, j}$ \u4e3a\u5f53 $b_i = j$ \u65f6\u7684\u7b54\u6848\uff0c\u5c5e\u4e8e 1D/2D \u7684 DP, \u8003\u8651\u505a\u4e00\u4e2a\u540e\u7f00\u6700\u5c0f\u503c\u8fdb\u884c\u4f18\u5316\uff0c\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(NV)$, \u53ef\u4ee5\u62ff 15 pts.\n\n\u53c8\u53d1\u73b0 $\\forall i, b_i = a_j$, \u56e0\u4e3a\u5982\u679c\u4e0d\u7b49\u4e8e\uff0c\u4e00\u5b9a\u6bd4\u5c06 $b_i$ \u7f29\u5c0f\u4e3a $a_j$ \u7684\u7b54\u6848\u52a3\u3002\uff08\u7701\u53bb\u4e00\u4e2a $C$ \u80fd\u4e0d\u4f18\u5417\uff09\n\n\u4fee\u6539\u4e00\u4e0b\u65b9\u7a0b\uff0c\u8bbe $f_{i, j}$ \u8868\u793a $b_i$ \u4e3a $a$ \u4e2d\u7b2c $i$ \u5927\u7684\u6570\u5b57\uff0c\u53ef\u4ee5\u8fbe\u5230 $\\mathcal{O}(N^3)$, \u7a0d\u5fae\u4e00\u60f3\u5c31\u53ef\u4ee5\u53d1\u73b0\u505a\u4e00\u4e2a\u524d\u7f00\u6700\u5c0f\u503c\u5c31\u53ef\u4ee5\u4f18\u5316\u6389\u4e00\u7ef4\u3002\u53ef\u4ee5\u62ff\u4e0b Subtask #1 \u7684 25pts.\n\n\u7136\u540e\u8003\u8651\u4f18\u5316\u5566\u3002\u53d1\u73b0\u503c\u57df\u8def\u7ebf\u96be\u4ee5\u518d\u6b21\u4f18\u5316\uff0c\u8003\u8651\u5c06 Subtask #1 \u7684\u505a\u6cd5\u518d\u6b21\u4f18\u5316\u6210 $\\log_2$ \u7ea7\u3002\n\n\u53d1\u73b0\u65b9\u7a0b\u53ea\u8f6c\u79fb\u81ea\u4e0a\u4e00\u4e2a\u4eba\uff0c\u8003\u8651\u6254\u5230\u7ebf\u6bb5\u6811\u4e0a\u53bb\u7ef4\u62a4\uff0c\u8ba1\u7b97\u6bcf\u4e00\u4e2a\u4eba\u7684\u52a0\u5165\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n$$\nf_{i, j} = \\min \n\\begin{cases} \nf_{i - 1, j} + b_j - a_i \\quad &(1 \\le j \\le k)    \\\\\nf_{i - 1, j} + C \t\t \\quad &(k + 1 \\le j \\le N) \\\\\n\\end{cases}\n$$\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\u53ef\u4ee5\u7b80\u5355\u7684\u533a\u95f4\u52a0\u3002\u800c\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u4e00\u90e8\u5206\u662f $a_i$ \u5bb9\u6613\u7ef4\u62a4\uff0c\u800c $b_j$ \u4e0d\u77e5\u9053\u662f\u8c01\uff0c\u6240\u4ee5\u4e0d\u597d\u505a\u3002\n\n\u53d1\u73b0\u4e24\u4e2a\u5e8f\u5217\u90fd\u5355\u8c03\u4e0d\u589e\uff0c\u6240\u4ee5\u76f8\u52a0\u4ee5\u540e\u540c\u6837\u5355\u8c03\u4e0d\u589e\uff0c\u533a\u95f4\u6700\u5c0f\u503c\u7684\u4f4d\u7f6e\u4ecd\u4e0d\u53d8\u3002\u6240\u4ee5 $b_j$ \u5c31\u662f\u53f3\u7aef\u70b9\u3002 \n\n\u4e0d\u8fc7\u53d1\u73b0 $f$ \u4e3a\u4e24\u4e2a\u5355\u8c03\u4e0d\u589e\u5e8f\u5217\u76f8\u63a5\u7ec4\u6210\uff0c\u4e0d\u6ee1\u8db3\u6027\u8d28\uff0c\u4e8e\u662f\u6700\u540e\u518d\u62ff\u5de6\u8fb9\u7684\u53f3\u7aef\u70b9\u503c\u62ff\u6765\u63a8\u5e73\u53f3\u533a\u95f4\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6\u7ea6\u4e3a $\\mathcal{O}(N \\log_2 N)$. \u53ef\u4ee5\u901a\u8fc7\u3002\n\n# \u4ee3\u7801\n\n\u6ce8\u610f\u4e0b\u4f20\u6807\u8bb0\u65f6\u5148\u628a\u513f\u5b50\u7684\u63a8\u5e73\u6807\u8bb0\u4f20\u4e0b\u53bb\uff01\uff01\uff01\u8bb0\u5f97\u5f00 $8$ \u500d\u7a7a\u95f4\uff01\uff01\uff01\n\n``` cpp\n#include <bits/stdc++.h>\n#define es else \n#define ef es if\nusing namespace std;\n\n#define ll long long\n#define rint register long long\n\nlong long N, C, minn;\nlong long a[1000005], b[1000005], num[1000005];\n\nstruct SegmentTree {\n    bool flag;\n    long long f, u, sum; \n} tree[8000005];\n\n#define lc(p) (p << 1 | 0)\n#define rc(p) (p << 1 | 1)\n\nvoid merge(long long p)\n{\n    tree[p].f = min(tree[p << 1].f, tree[(p << 1) | 1].f);\n}\n\nvoid flush_down(long long p)\n{\n    if(tree[p].flag)\n    {\n        tree[lc(p)].f = tree[rc(p)].f = tree[p].f;\n        tree[lc(p)].u = tree[rc(p)].u = 0;\n        tree[lc(p)].sum = tree[rc(p)].sum = 0;\n        tree[lc(p)].flag = tree[rc(p)].flag = true;\n        tree[p].flag = false;\n    }\n}\n\nvoid push_down(long long l, long long r, long long p)\n{\n    flush_down(p), flush_down(lc(p)), flush_down(rc(p));\n    if(tree[p].sum)\n    {\n        tree[lc(p)].f += tree[p].sum;\n        tree[lc(p)].sum += tree[p].sum;\n        tree[rc(p)].f += tree[p].sum;\n        tree[rc(p)].sum += tree[p].sum;\n        tree[p].sum = 0;\n    }\n    if(tree[p].u)\n    {\n        long long mid = (l + r) >> 1;\n        tree[lc(p)].f += b[mid] * tree[p].u;\n        tree[lc(p)].u += tree[p].u;\n        tree[rc(p)].f += b[r] * tree[p].u;\n        tree[rc(p)].u += tree[p].u;\n        tree[p].u = 0;\n    }\n}\n\nvoid dp1(long long l, long long r, long long p, long long x, long long val1, long long val2)\n{\n    long long mid = (l + r) >> 1;\n    if(l != r)\n        push_down(l, r, p);\n    if(r <= x)\n    {\n        flush_down(p);\n        tree[p].f += val1 + b[r];\n        tree[p].sum += val1;\n        ++ tree[p].u;\n        if(r == x) \n            minn = tree[p].f;\n    }\n    ef(l > x)\n    {\n        flush_down(p);\n        tree[p].f += val2;\n        tree[p].sum += val2;\n    }\n    es\n    {\n        dp1(l, mid, lc(p), x, val1, val2);\n        dp1(mid + 1, r, rc(p), x, val1, val2);\n        merge(p);\n    }\n}\n\nbool dp2(long long l, long long r, long long p, long long x, long long val1)\n{\n    long long mid = (l + r) >> 1;\n    if(l != r)\n        push_down(l, r, p);\n    if(l > x)\n    {\n        if(tree[p].f > val1)\n        {\n            tree[p].f = val1, tree[p].sum = tree[p].u = 0;\n            return (tree[p].flag = true);\n        }\n        if(l != r && dp2(l, mid, lc(p), x, val1)) dp2(mid + 1, r, rc(p), x, val1);\n        return false;\n    }\n    ef(l == r)\n        return false;\n    ef(x < mid)\n    {\n        if(dp2(l, mid, lc(p), x, val1)) return dp2(mid + 1, r, rc(p), x, val1);\n        else return false;\n    }\n    \n    return dp2(mid + 1, r, rc(p), x, val1);\n}\n\nsigned main()\n{\n    cin >> N >> C;\n    for(long long i = 1; i <= N; ++ i)\n        cin >> a[i], b[i] = a[i];\n\n    sort(b + 1, b + N + 1);\n    long long tmp = unique(b + 1, b + N + 1) - (b + 1);\n    for(long long i = 1; i <= N; ++ i) \n        num[i] = tmp + 1 - (lower_bound(b + 1, b + tmp + 1, a[i]) - b);\n\n    reverse(b + 1, b + tmp + 1);\n    for(long long i = 1; i <= N; ++ i)\n    {\n        dp1(1, tmp, 1, num[i], -a[i], C);\n        dp2(1, tmp, 1, num[i], minn);\n    }\n\n    cout << tree[1].f << endl;\n    return 0;\n}\n```\n\n# \u540e\u8a00\n\n\u8fd9 T3 \u4e5f\u592a\u53d8\u6001\u4e86\u3002",
        "postTime": 1660916053,
        "uid": 224558,
        "name": "JackMerryYoung",
        "ccfLevel": 5,
        "title": "P8476 \u300cGLR-R3\u300d\u60ca\u86f0 \u9898\u89e3"
    }
]