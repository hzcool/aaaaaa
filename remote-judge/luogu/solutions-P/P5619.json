[
    {
        "content": "\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6709\u6839\u6811\u53ca\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\uff0c\u591a\u6b21\u8be2\u95ee\u4e00\u4e2a\u70b9\u7684\u5b50\u6811\u4e2d\u6240\u6709\u70b9\u7684\u6743\u503c\u6784\u6210\u7684\u591a\u91cd\u96c6\u4e2d\uff0c\u7b49\u6982\u7387\u968f\u673a\u9009\u4e00\u4e2a\u5b50\u96c6\uff0c\u8fd9\u4e2a\u5b50\u96c6\u4e2d\u6240\u6709\u5143\u7d20\u7684\u4e58\u79ef\u7684\u671f\u671b\u3002\n\n\u7531\u4e8e\u9898\u76ee\u4e2d\u6bcf\u4e2a\u70b9\u88ab\u6253\u4e2d\u7684\u6982\u7387\u90fd\u662f50%\uff0c\u8089\u773c\u53ef\u89c1\u6240\u6709\u5b50\u96c6\u88ab\u9009\u4e2d\u6982\u7387\u90fd\u662f\u76f8\u7b49\u7684\u3002\n\n\u9898\u76ee\u8981\u6c42\u7684\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5982\u679c\u770b\u4e0d\u61c2\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u5728\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7684\u67d0\u4e00\u6bb5\u533a\u95f4\u4e2d\uff0c\u6240\u6709 \u5b50\u5e8f\u5217\u7684\u5143\u7d20\u4e58\u79ef \u4e4b\u548c\u3002\n\n\u6211\u4eec\u5148\u8bbe\u4e00\u4e2a\u70b9\u7684\u5b50\u6811\u4e2d\u7684\u6240\u6709\u70b9\u5728\u4e00\u4e2a\u591a\u91cd\u96c6\u4e2d\uff0c\u4e3a$x_1$,$x_2$,$x_3$,...\n\n\u5c06\u4e00\u4e2a\u96c6\u5408\u4e2d\u6240\u6709\u5143\u7d20\u7684\u4e58\u79ef\u8868\u793avan\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5217\u51fa\u8fd9\u4e2a\u591a\u91cd\u96c6\u7684\u6240\u6709\u5b50\u96c6\u7684van \u4e4b\u548c\u7684\u8ba1\u7b97\u5f0f\uff1a\n\n$$-1+\\sum_{i=1}^n (x_i+1)$$\n\n\u53f3\u8fb9\u7684\u548c\u5f0f\u7684\u610f\u4e49\u662f\uff0c\u6bcf\u4e2a\u70b9\u90fd\u6709\u6982\u7387\u88ab\u9009\u4e2d\u3002\u8fd9\u6837\uff0c\u5b83\u88ab\u9009\u4e2d\u65f6\u5bf9van\u7684\u8d21\u732e\u5c31\u662f\u4e58\u4e0a\u5b83\u672c\u8eab\u7684\u6570\u503c\uff0c\u6ca1\u88ab\u9009\u4e2d\u65f6\u5bf9van\u7684\u8d21\u732e\u5c31\u662f\u4e581\uff0c\u4e5f\u5c31\u662f\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\u3002\n\n\u5de6\u8fb9\u6709\u4e00\u4e2a-1\uff0c\u662f\u56e0\u4e3a\u4e00\u4e2a\u4e5f\u6ca1\u6253\u4e2d\u65f6\u7684\u5f97\u5206\u662f0\u800c\u4e0d\u662f1\uff0c\u4f46\u53f3\u8fb9\u7684\u548c\u5f0f\u591a\u8ba1\u7b97\u4e86\u4e00\u4e2a1\uff0c\u6240\u4ee5\u628a\u5b83\u51cf\u6389\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u4e2d\uff0c\u53ea\u9700\u8981\u4e00\u904ddfs\uff0c\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u7684size\u548cprod\uff0cprod\u4e3a\u5b50\u6811\u4e2d\u6240\u6709\u70b9\u7684\u6743\u503c+1\u4e4b\u79ef\u3002\u6bcf\u6b21\u8be2\u95ee\u65f6\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5O(1)\u56de\u7b54\u3002\n\n\u5bf9\u4e8e\u70b9x\uff0c\u7b54\u6848\u5c31\u662f$\\frac{prod[x]-1}{2^{size[x]}}$\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5206\u6bcd\u4e0d\u80fd\u7b80\u5355\u5730\u7528\u4f4d\u8fd0\u7b97\uff0c\u5426\u5219\u4f1a\u7206long long\u3002\n\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#define N 20000001\n#define ha 19260817\n#define ll long long\nint n,m,num[N], h[N],cnt, size[N],prod[N];\nstruct edge{\n\tint next,to;\n}e[N<<1];\ninline void read(int &out)\n{\n\tout=0;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9')c=getchar();\n\twhile('0'<=c&&c<='9')out=out*10+c-'0',c=getchar();\n\treturn;\n}\ninline void add(int u,int v)\n{\n\te[++cnt].next=h[u];\n\th[u]=cnt;\n\te[cnt].to=v;\n\treturn;\n}\ninline long long div(ll x)\n{\n\tint k=ha-3;\n\tlong long out=x,xx=x;\n\twhile(k)\n\t{\n\t\tif(k&1)out=(out*xx)%ha;\n\t\txx=(xx*xx)%ha;\n\t\tk>>=1;\n\t}\n\treturn out;\n}\ninline long long pow(ll x,int k)\n{\n\tlong long out=x,xx=x;\n\tk--;\n\twhile(k)\n\t{\n\t\tif(k&1)out=(out*xx)%ha;\n\t\txx=(xx*xx)%ha;\n\t\tk>>=1;\n\t}\n\treturn out;\n}\ninline void dfs(int x,int fa)\n{\n\tsize[x]=1,prod[x]=num[x];\n\tfor(int i=h[x],v;i;i=e[i].next)\n\t{\n\t\tv=e[i].to;\n\t\tif(v==fa)continue;\n\t\tdfs(v,x);\n\t\tsize[x]+=size[v],prod[x]=(int)((ll)prod[x]*(ll)prod[v]%ha);\n\t}\n\treturn;\n}\nint main()\n{\n\tread(n),read(m);\n\tfor(int i=1;i<=n;i++)read(num[i]),num[i]=(num[i]+1)%ha;\n\tfor(int i=1,u,v;i<n;i++)\n\t{\n\t\tread(u),read(v);\n\t\tadd(u,v);add(v,u);\n\t}\n\tdfs(1,1);\n\tll out=0;\n\tfor(int i=1,x;i<=m;i++)\n\t{\n\t\tread(x);\n\t\tout=(out+(ll)(prod[x]-1)*(ll)div(pow(2,size[x])))%ha;\n\t}\n\tprintf(\"%d\\n\",out);\n\treturn 0;\n}\n```\n",
        "postTime": 1567084739,
        "uid": 14381,
        "name": "1jia1",
        "ccfLevel": 0,
        "title": "[DBOI2019]\u6301\u77e2 \u9898\u89e3"
    },
    {
        "content": "\u671f\u671b\uff1a\u603b\u6982\u7387\u4e58\u4ee5\u5176\u7ed3\u679c\u603b\u548c\u3002\n\n\u603b\u6982\u7387\uff1a$\\frac{1}{2^{size(i)}}$\uff0c\u5176\u4e2d $size(i)$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u5927\u5c0f\u3002\n\n\u7ed3\u679c\u603b\u548c\uff1a\n\n\u8003\u8651\u4e00\u4e2a\u7b80\u5355\u95ee\u9898\uff1a$n=3,a_1=1,a_2=2,a_3=3$\u3002\n\n\u5171\u6709\u4e00\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a$1\\times2\\times3+1\\times2+1\\times3+2\\times3+1+2+3+0$\n\n\u5171\u516b\u79cd\u60c5\u51b5\uff0c\u5176\u4e2d\u90fd\u4e0d\u9009\u4e3a $0$\u3002\n\n\u53d1\u73b0\u4e0a\u9762\u548c $x_1x_2x_3+x_1x_2+x_1x_3+x_2x_3+x_1+x_2+x_3+1$ \u5f88\u50cf\uff08\u51e0\u4e4e\u4e00\u6837\uff0c\u4f46\u662f\u6709\u4e00\u4e2a $0$ \u548c $1$ \u7684\u533a\u522b\uff09\u3002\n\n$$\\prod_{i=1}^3(x_i+1)=(x_1+1)(x_2+1)(x_3+1)=(x_1x_2+x_1+x_2+1)(x_3+1)=x_1x_2x_3+x_1x_3+x_2x_3+x_3+x_1x_2+x_1+x_2+1=x_1x_2x_3+x_1x_2+x_1x_3+x_2x_3+x_1+x_2+x_3+1$$\n\n\u53ef\u4ee5\u53d1\u73b0\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u6240\u6709\u65b9\u6848\u7684\u7b54\u6848\u4e4b\u548c\u4e3a\uff1a\n\n$$\\prod_{j\\in sontree(i)}(a_j+1)-1$$\n\n\u5176\u4e2d\uff1a\n\n$(a_j+1)$\uff1a\u5b50\u6811\u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u82e5\u662f\u88ab\u9009\u4e2d\u5219\u8d21\u732e\u4e3a $a_i$\uff0c\u82e5\u6ca1\u88ab\u9009\u4e2d\u5219\u8d21\u732e\u4e3a $1$\uff08\u4e58\u79ef\u4e0d\u53d8\uff09\uff0c\u52a0\u548c\u5f97\u5230\u7684\u3002\n\n$-1$\uff1a\u56e0\u4e3a\u591a\u9879\u5f0f\u5e38\u6570\u9879\u4e3a $1$ \u6700\u540e\u6709\u5269\u4f59\uff0c\u800c\u6839\u636e\u9898\u610f\u4e3a $0$\u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u7b54\u6848\u5373\u4e3a\uff1a\n\n$$\\frac{\\prod_{j\\in sontree(i)}(a_j+1)-1}{2^{size(i)}}$$\n\n\u5b50\u6811\u5927\u5c0f\u548c\u8d21\u732e\u53ef\u4ee5\u901a\u8fc7 $O(n)$ dfs \u6c42\u5f97\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){\n        if(ch=='-')\n            f=-1;\n        ch=getchar();\n    }\n    while(ch>='0'&&ch<='9'){\n        x=(x<<1)+(x<<3)+(ch^48);\n        ch=getchar();\n    }\n    return x*f;\n}\n\ninline void print(int x){\n\tif(x<0)putchar('-'),x=-x;\n\tif(x>9)print(x/10);\n\tputchar(x%10^48);\n}\n\nconst int mod=19260817;\n\nint qpow(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1)ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\n\nconst int MAXN=2e6+5;\nint n,m,a[MAXN],f[MAXN],siz[MAXN],ans;\nstruct node{\n\tint next,to;\n}e[MAXN<<1];\nint head[MAXN],num;\n\nvoid add(int u,int v){\n\te[++num].to=v;\n\te[num].next=head[u];\n\thead[u]=num;\n}\n\nvoid dfs(int x,int fa){\n\tf[x]=(a[x]+1)%mod;\n\tsiz[x]=1;\n\tfor(int i=head[x];i;i=e[i].next){\n\t\tif(e[i].to==fa)continue;\n\t\tdfs(e[i].to,x);\n\t\tf[x]=f[x]*f[e[i].to]%mod;\n\t\tsiz[x]+=siz[e[i].to];\n\t}\n}\n\nsigned main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;++i)a[i]=read();\n\tfor(int i=2;i<=n;++i){\n\t\tint u=read(),v=read();\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tdfs(1,1);\n\tfor(int i=1;i<=m;++i){\n\t\tint x=read();\n\t\tans=(ans+(f[x]-1)*qpow(qpow(2,siz[x]),mod-2)%mod)%mod;\n\t}\n\tprint((ans+mod)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1636458844,
        "uid": 271736,
        "name": "Daidly",
        "ccfLevel": 6,
        "title": "P5619 [DBOI2019]\u6301\u77e2 \u9898\u89e3"
    },
    {
        "content": "\t\u4ec0\u4e48\u561b\uff0c\u6211\u6253\u7684\u4e0d\u662f\u633a\u51c6\u7684\u5417\uff1f\n    \u2014\u20141jia1\n    \u4f60 \u6253 \u4e2d \u4e86 \u5417\uff08\u9707\u58f0\n    \u2014\u2014Tommy_clas\n[\u4f20\u9001\u95e8](https://www.luogu.org/problem/P5619)\n\n\u9898\u76ee\u5927\u610f\uff1a\u6709\u4e00\u68f5$n$\u4e2a\u70b9\u7684\u6709\u6839\u6811\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e00\u4e2a\u6743\u503c\uff0c\u6bcf\u6b21\u4ece\u6811\u4e0a\u7684\u67d0\u4e2a\u5b50\u6811\u4e2d\u83b7\u5f97\u5206\u6570\uff0c\u5206\u6570\u7684\u5927\u5c0f\u662f\u8be5\u5b50\u6811\u4e2d\u6240\u6709\u5df2\u7ecf\u9009\u62e9\u7684\u70b9\u7684\u6743\u503c\u7684**\u79ef**\uff0c\u800c\u6bcf\u4e2a\u70b9\u6709$\\frac{1}{2}$\u7684\u6982\u7387\u88ab\u9009\u5230\u3002\u6c42$m$\u6b21\u64cd\u4f5c\u540e\u7684\u5206\u6570\u7684**\u548c**\u7684\u671f\u671b\u503c\u3002\n\n\u7531\u4e8e\u9898\u76ee\u6ca1\u6709\u4fee\u6539\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6811\u4e0a\u6bcf\u4e00\u4e2a\u5b50\u6811\u7684\u7b54\u6848\u63d0\u524d\u6c42\u51fa\uff0c\u7136\u540e\u6c42\u548c\u3002\n\n\u65e2\u7136\u662f\u671f\u671b\uff0c\u90a3\u5c31\u76f4\u63a5\u8d70\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c\u671f\u671b$DP$\u5b8c\u4e8b\u4e86\u3002\n\n\u4f46\u662f\u5728\u6d4b\u8bd5\u6837\u4f8b\u540e\u6211\u4eec\u53d1\u73b0\u7b54\u6848\u662f\u9519\u8bef\u7684\u3002\n\n\u8003\u8651\u539f\u56e0\uff0c\u6211\u4eec\u80fd\u53d1\u73b0\u4e4b\u524d\u7684\u671f\u671b$DP$\u4e00\u822c\u90fd\u662f**\u548c**\u7684\u671f\u671b\u503c\uff0c\u800c\u5f88\u5c11\u662f**\u79ef**\u7684\u671f\u671b\u503c\uff0c\u8fd9\u662f\u56e0\u4e3a\u671f\u671b\u7684\u7ebf\u6027\u6027\u662f\uff1a\n\n$E(a+b)=E(a)+E(b)$\n\n\u800c\u4e0d\u662f\uff1a\n\n$E(a\\times b)=E(a)\\times E(b)$\n\n\u624b\u52a8\u8ba1\u7b97\u4e00\u4e0b\u6837\u4f8b\u4e5f\u53ef\u4ee5\u8bc1\u660e\u8fd9\u79cd\u671f\u671b$DP$\u7684\u505a\u6cd5\u662f\u9519\u8bef\u7684\u3002\n\n\u65e2\u7136\u6c42\u79ef\u4e0d\u884c\uff0c\u6211\u4eec\u5c06\u70b9\u6743$v$\u8f6c\u5316\u5bf9\u6570$logv$\uff0c\u7136\u540e\u6839\u636e\u516c\u5f0f\uff1a\n\n$log(a\\times b)=loga+logb$\n\n\u6c42\u51fa\u603b\u671f\u671b\u540e\u518d\u8f6c\u56de\u53bb\u5982\u4f55\uff1f\n\n\u522b\u5fd8\u4e86\u8fd9\u662f\u53d6\u6a21\u6c42\u7b54\u6848\uff0c\u5c31\u7b97\u4e0d\u53d6\u6a21\uff0c\u7cbe\u5ea6\u4e5f\u5f88\u53ef\u80fd\u6709\u5f88\u5927\u8bef\u5dee\u3002\n\n\u671f\u671b$DP$\u4e0d\u884c\uff0c\u5e72\u8106\u76f4\u63a5\u66b4\u529b\u671f\u671b\uff1f\n\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u5f88\u597d\u7684\u6027\u8d28\uff1a**\u6bcf\u4e2a\u70b9\u9009\u4e0e\u4e0d\u9009\u7684\u6982\u7387\u662f\u4e00\u6837\u7684**\u3002\u7531\u4e8e\u4e00\u68f5\u5b50\u6811\u7684\u6bcf\u4e00\u79cd\u9009\u62e9\u65b9\u6848\u7684\u6982\u7387\u90fd\u662f$\\frac{1}{2^{size}}$\u3002\n\n\u518d\u6839\u636e\uff1a\u671f\u671b$=$\u6982\u7387$\\times$\u7ed3\u679c\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u6c42\u51fa\u8be5\u5b50\u6811\u6240\u6709\u9009\u62e9\u65b9\u6848\u7684\u7b54\u6848\u7684\u548c\uff0c\u7136\u540e\u4e58\u4e0a\u6982\u7387\u5c31\u884c\u4e86\u3002\u4f46\u662f\u5982\u4f55\u6c42\u548c\u5462\uff1f\n\n\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u7684\u72b6\u6001\u662f\u8981\u4e48\u9009\uff0c\u8981\u4e48\u4e0d\u9009\uff0c\u4e14\u6bcf\u4e2a\u65b9\u6848\u7684\u7b54\u6848\u662f\u6240\u6709\u5df2\u9009\u70b9\u7684\u6743\u503c\u7684\u79ef\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u751f\u6210\u51fd\u6570\u3002\n\n\u8bbe$sum_i$\u8868\u793a\u4ee5$i$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u6240\u6709\u9009\u53d6\u65b9\u6848\u7684\u7b54\u6848\u7684\u603b\u548c\u3002\n\n\u5219\u6709$sum_i=(\\prod_{j\u2208T_i}(v_j+1))-1$\n\n\u6839\u636e\u591a\u9879\u5f0f\u4e58\u591a\u9879\u5f0f\u539f\u7406\uff0c\u4e0a\u8ff0\u5f0f\u5b50\u6db5\u76d6\u4e86\u6240\u6709\u7684\u65b9\u6848\u7684\u7b54\u6848\uff0c\u4e4b\u6240\u4ee5\u51cf$1$\uff0c\u662f\u56e0\u4e3a\u5f53\u6240\u6709\u70b9\u90fd\u4e0d\u9009\u65f6\uff0c\u7b54\u6848\u5e94\u5f53\u662f$0$\u3002\n\n\u81f3\u4e8e$sum_i$\u7684\u6c42\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728$dfs$\u6811\u7684\u65f6\u5019\u987a\u4fbf\u6c42\u51fa\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n\u8fd9\u6837\u5c31\u6709$ans_i=\\frac{sum_i}{2^{size_i}}$\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\u5c06\u5bf9\u5e94\u7684$ans_i$\u52a0\u8d77\u6765\uff0c\u7136\u540e\u6c42\u548c\u5373\u53ef\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n```cpp\n//\u8d70\u671f\u671b\u7ebf\u6027\u6027\u5c31\u5931\u8d25\u4e86\n//\u76f4\u63a5\u66b4\u529b\u671f\u671b\u5c31\u53ef\u4ee5\u4e86 \n#include<cstdio>\n#define N 2000005\n#define ll long long\nusing namespace std;\nint n,m,head[N],cnt,siz[N];\nll dp[N],sum[N],ans=0,inv2[N],v[N];\nconst ll mod=19260817;\nstruct edge\n{\n\tint to,nxt;\n}w[2*N];\nll quick_pow(ll base,ll x)\n{\n\tll res=1;\n\twhile(x)\n\t{\n\t\tif(x&1)res=res*base%mod;\n\t\tbase=base*base%mod,x>>=1;\n\t}\n\treturn res;\n}\nvoid add(int x,int y)\n{\n\tw[++cnt]=(edge){y,head[x]};\n\thead[x]=cnt;\n}\nvoid dfs(int x,int last)\n{\n\tsiz[x]=1;\n\tsum[x]=(v[x]+1)%mod;\n\tbool tag=0;\n\tfor(int i=head[x];i;i=w[i].nxt)\n\t{\n\t\tint y=w[i].to;\n\t\tif(y==last)continue;\n\t\tdfs(y,x),tag=1;\n\t\tsiz[x]+=siz[y];\n\t\tsum[x]=sum[x]*sum[y]%mod;\n\t}\n\tdp[x]=((sum[x]-1)*inv2[siz[x]]%mod+mod)%mod;\n}\nvoid init()\n{\n\tinv2[0]=1;\n\tll base=quick_pow(2,mod-2);\n\tfor(int i=1;i<=n;i++)\n\t\tinv2[i]=inv2[i-1]*base%mod;\n}\nint main()\n{\n\tscanf(\"%d %d\",&n,&m);\n\tinit();\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&v[i]);\n\tfor(int i=1,x,y;i<n;i++)\n\t\tscanf(\"%d %d\",&x,&y),add(x,y),add(y,x);\n\tdfs(1,0);\n\tfor(int i=1,x;i<=m;i++)\n\t\tscanf(\"%d\",&x),ans=(ans+dp[x])%mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1572089609,
        "uid": 110471,
        "name": "Tommy_clas",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5619 \u3010[DBOI2019]\u6301\u77e2\u3011"
    }
]