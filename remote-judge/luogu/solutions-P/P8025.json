[
    {
        "content": "# \u6811\u5256\u6c42\u6811\u4e0a\u8282\u70b9\u7684 k \u7ea7\u7956\u5148\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P8025)\n\n## \u95f2\u8bdd\n\n~~\u6211\u53d1\u73b0\u6211\u6709\u4e00\u4e2a\u6ca1 A \u7684\u84dd\u6811\u5256~~\n\n\u5f53\u6811\u5256\u9898\u505a\u5f97\u6bd4\u8f83\u591a\u4e4b\u540e\uff0c\u7b80\u5355\u7684\u6811\u5256\u8fd8\u771f\u80fd\u4e00\u773c\u51fa\u601d\u8def\u3002\n\n## \u53d8\u91cf\u58f0\u660e\n\n- `now`\uff1a\u73b0\u5728\u6240\u5904\u7684\u8282\u70b9\u4f4d\u7f6e\u3002\n- `to`\uff1a\u8981\u5230\u8fbe\u7684\u8282\u70b9\u4f4d\u7f6e\u3002\n- `reach`\uff1a\u4e0d\u80fd\u5230\u8fbe `to` \u65f6\u6700\u540e\u5230\u8fbe\u7684\u8282\u70b9\u3002\n- `lca`\uff1a`now` \u548c `to` \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u3002\n- `step`\uff1a\u80fd\u8d70\u7684\u6b65\u6570\u3002\n- `dis1`\uff1a`now` \u5230 `lca` \u7684\u8ddd\u79bb\u3002\n- `dis2`\uff1a`to` \u5230 `lca` \u7684\u8ddd\u79bb\u3002\n\n## \u601d\u8def\n\n\u849f\u84bb\u5206\u7c7b\u6bd4\u8f83\u591a\uff08\u592a\u83dc\uff0c\u4e0d\u4f1a\u5c06\u60c5\u51b5\u5408\u5e76\uff09\u3002\n\n### \u4e00\u3001\u80fd\u5230\u8fbe\n\n\u76f4\u63a5\u8f93\u51fa `to` \u5e76\u66f4\u65b0 `now`\u3002\n\n```cpp\nif(step>=dis1+dis2)wr(now=to),putchar(' ');\n```\n\n### \u4e8c\u3001\u4e0d\u80fd\u5230\u8fbe\n\n\u849f\u84bb\u6015\u9519\uff0c\u5c06\u4e0d\u80fd\u5230\u8fbe\u7684\u60c5\u51b5\u53c8\u5206\u6210\u4e86\u4e24\u7c7b\uff1a\n\n- \u5411\u4e0b\u8df3\n\n- \u5411\u4e0a\u8df3\n\n1. \u5411\u4e0b\u8df3\n\n\u6b64\u65f6\uff0c\u4ece\u4e0a\u5411\u4e0b\u8df3 `step` \u6b65\u5c31\u76f8\u5f53\u4e8e\u4ece\u4e0b\u5411\u4e0a\u8df3 `dis2-step` \u6b65\u3002\n\n```cpp\nelse if(lca==now)\n{\n\tnow=tiao(to,dis2-step);\n\twr(now),putchar(' ');\n}\n```\n\n2. \u5411\u4e0a\u8df3\n\n\u8fd8\u662f\u4e3a\u4e86\u9632\u6b62\u51fa\u9519\uff0c\u6211\u53c8\u53cc\u53d2\u53d5\u5206\u7c7b\u4e86\u3002\n\n\u2460 \u6b63\u5de7\u8df3\u5230 `lca`\uff1a\n\n\u76f4\u63a5\u8f93\u51fa `lca` \u5e76\u66f4\u65b0 `now`\u3002\n\n```cpp\nelse if(dis1==step)wr(now=lca),putchar(' ');\n```\n\n\u2461 \u5728\u7ecf\u8fc7 `lca` \u524d\u4e0d\u80fd\u8d70\u4e86\uff1a\n\n`now` \u5411\u4e0a\u8df3 `dis1` \u6b65\u3002\n\n```cpp\nelse if(dis1>step)\n{\n\tnow=tiao(now,step);\n\twr(now);putchar(' ');\n}\n```\n\n\u2462 \u7ecf\u8fc7 `lca` \u540e\u505c\u4e0b\uff1a\n\n\u603b\u8def\u7a0b\u4e3a `dis1+dis2`\uff0c\u8d70\u8fc7\u4e86 `step`\uff0c\u5269\u4e0b\u4e86 `dis1+dis2-step` \u6b65\u3002`to` \u5411\u4e0a\u8df3 `dis1+dis2-step` \u6b65\u3002\n\n```cpp\nelse\n{\n\tnow=tiao(to,dis2-(step-dis1));\n\twr(now);putchar(' ');\n}\n```\n\n### \u4e09\u3001\u8df3\n\n\u601d\u8def\u4e2d\u5168\u662f\u8df3\u8df3\u8df3\uff0c\u90a3\u4e48\u5230\u5e95\u600e\u4e48\u8df3\uff1f\n\n\u8fd9\u9898\u662f\u4ec0\u4e48\uff1f\n\n\u5bf9\uff0c\u6811\u5256\uff01\n\n\u8df3\u91cd\u94fe\u5457\u3002\n\n\u6bcf\u6b21\u8df3\u5230\u91cd\u94fe\u7684\u9876\u70b9\u7684\u7236\u8282\u70b9\uff0c\u76f4\u5230\u8ddd\u79bb\u4e0d\u591f\u3002\n\n\u6b64\u65f6\uff0c\u5f53\u524d\u8282\u70b9\u548c\u76ee\u6807\u8282\u70b9\u5728\u4e00\u6761\u91cd\u94fe\u4e0a\u3002\n\n\u7136\u540e\u5462\uff1f\n\n\u66b4\u529b\u8df3\uff1f\n\n~~\u6811\u9000\u5316\u6210\u94fe\u80fd\u8ba9\u4f60\u5f53\u573a\u53bb\u4e16~~\n\n\u6811\u5256\u6709\u4e2a\u7f8e\u5999\u7684\u6027\u8d28\uff0c\u91cd\u94fe\u7684\u65f6\u95f4\u6233\u662f\u8fde\u7eed\u7684\u3002\n\n\u800c\u4e14\u6df1\u5ea6\u4e5f\u662f\u8fde\u7eed\u7684\u3002\n\n\u90a3\u4e48\u5c31\u6709\u4ee5\u4e0b\u7b49\u5f0f\u7684\u63a8\u5bfc\uff1a\n\n$$\\begin{array}{c}\ndep_{now}-dep_{to}=dfn_{now}-dfn_{to}\\\\\n-dep_{now}+dep_{to}+dfn_{now}=dfn_{to}\\\\\nk=dep_{to}-dep_{now}\\\\\ndfn_{to}=dfn_{now}-k\\\\\nto=rnk[dfn_{to}]\n\\end{array}$$\n\n\u6240\u4ee5\u4ee3\u7801\u5c31\u662f\u8fd9\u6837\uff1a\n\n```cpp\nint tiao(int x,int k)\n{\n\twhile(1)\n\t{\n\t\tif(dep[x]-dep[top[x]]+1>k)break;\n\t\tk-=dep[x]-dep[top[x]]+1;\n\t\tx=fa[top[x]];\n\t}\n\treturn rnk[dfn[x]-k];\n}\n```\n\n\u5168\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\nint re()\n{\n\tint s=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0')\n\t{\n\t\tif(ch=='-')f=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9')\n\t\ts=s*10+ch-48,ch=getchar();\n\treturn s*f;\n}\nvoid wr(int s)\n{\n\tif(s<0)putchar('-'),s=-s;\n\tif(s>9)wr(s/10);\n\tputchar(s%10+48);\n}\nconst int inf=1e6+7;\nint n,m;\nint fir[inf],nex[inf<<1],poi[inf<<1],cnt;\nvoid ins(int x,int y)\n{\n\tnex[++cnt]=fir[x];\n\tpoi[cnt]=y;\n\tfir[x]=cnt;\n}\nint fa[inf],dep[inf],siz[inf],son[inf];\nvoid dfs1(int now,int from)\n{\n\tsiz[now]=1;fa[now]=from;\n\tdep[now]=dep[from]+1;\n\tfor(int i=fir[now];i;i=nex[i])\n\t{\n\t\tint p=poi[i];\n\t\tif(p==from)continue;\n\t\tdfs1(p,now);\n\t\tsiz[now]+=siz[p];\n\t\tif(siz[son[now]]<siz[p])\n\t\t\tson[now]=p;\n\t}\n}\nint top[inf],dfn[inf],rnk[inf],sum;\nvoid dfs2(int now,int topn)\n{\n\ttop[now]=topn;\n\tdfn[now]=++sum;rnk[sum]=now;\n\tif(son[now]==0)return;\n\tdfs2(son[now],topn);\n\tfor(int i=fir[now];i;i=nex[i])\n\t{\n\t\tint p=poi[i];\n\t\tif(p==fa[now]||p==son[now])\n\t\t\tcontinue;\n\t\tdfs2(p,p);\n\t}\n}\nint lca_(int x,int y)\n{\n\twhile(top[x]!=top[y])\n\t{\n\t\tif(dep[top[x]]<dep[top[y]])swap(x,y);\n\t\tx=fa[top[x]];\n\t}\n\tif(dep[x]>dep[y])swap(x,y);\n\treturn x;\n}\nint now;\nint tiao(int x,int k)\n{\n\twhile(1)\n\t{\n\t\tif(dep[x]-dep[top[x]]+1>k)break;\n\t\tk-=dep[x]-dep[top[x]]+1;\n\t\tx=fa[top[x]];\n\t}\n\treturn rnk[dfn[x]-k];\n}\nint main()\n{\n\tn=re();now=re();m=re();\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u=re(),v=re();\n\t\tins(u,v),ins(v,u);\n\t}\n\tdfs1(1,1);dfs2(1,1);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint to=re(),step=re();\n\t\tint lca=lca_(now,to);\n\t\tint dis1=dep[now]-dep[lca],dis2=dep[to]-dep[lca];\n\t\tif(step>=dis1+dis2)wr(now=to),putchar(' ');\n\t\telse if(lca==now)\n\t\t{\n\t\t\tnow=tiao(to,dis2-step);\n\t\t\twr(now),putchar(' ');\n\t\t}\n\t\telse if(dis1==step)wr(now=lca),putchar(' ');\n\t\telse if(dis1>step)\n\t\t{\n\t\t\tnow=tiao(now,step);\n\t\t\twr(now);putchar(' ');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnow=tiao(to,dis2-(step-dis1));\n\t\t\twr(now);putchar(' ');\n\t\t}\n\t}\n    return 0;\n}\n\n```\n\n## \u5e7f\u544a\n\n[\u6811\u5256\u76f8\u5173\u77e5\u8bc6](https://www.cnblogs.com/adm-1223/p/15875076.html)\n\n[My blog](https://www.cnblogs.com/adm-1223/)",
        "postTime": 1648990114,
        "uid": 413020,
        "name": "Zvelig1205",
        "ccfLevel": 4,
        "title": "P8025 [ONTAK2015] Zwi\u0105zek Harcerstwa Bajtockiego"
    },
    {
        "content": "## Problem:\n\n- \u7ed9\u5b9a\u4e00\u68f5\u65e0\u6743\u6811\u548c\u4e00\u4e2a\u8d77\u70b9 $m$\uff0c\u64cd\u4f5c $k$ \u6b21\uff0c\u6bcf\u6b21\u8981\u6c42\u5728\u7b80\u5355\u8def\u5f84\u4e0a\u8d70\u6700\u591a $t$ \u6b65\u5230\u65b0\u7684\u70b9 $d$\uff0c\u5982\u679c\u8d70\u4e0d\u5230\u5219\u5728\u8d70 $t$ \u6b65\u540e\u505c\u4e0b\uff0c\u6c42\u6bcf\u6b21\u64cd\u4f5c\u540e\u7684\u70b9\u7684\u7f16\u53f7\u3002\n\n- \u6570\u636e\u8303\u56f4\uff1a$1 \\leq n,k \\leq 10^6$, $0 \\leq t \\leq 10^9$\u3002\n\n## Editorial:\n\n\u8bbe\u5f53\u524d\u64cd\u4f5c\u7684\u8d77\u70b9\u4e3a $u$\uff0c\u5728 $t$ \u6b65\u5185\u8d70\u5230\u7684\u7ec8\u70b9\u4e3a $v$\u3002\n\n\u8003\u8651\u5c06\u6bcf\u4e00\u6b21\u64cd\u4f5c\u7684\u7b80\u5355\u8def\u5f84 $(u,d)$ \u62c6\u4e3a\u4e24\u6761\uff0c\u8bbe $u$ \u548c $d$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u4e3a $p$\uff0c \u90a3\u4e48\u5c06 $(u,d)$ \u62c6\u4e3a $(u,p)$ \u548c $(p,d)$\u3002\u5982\u679c $u$ \u5230 $d$ \u7684\u8ddd\u79bb $\\leq t$\uff0c\u5219\u53ef\u4ee5\u5728 $t$ \u6b65\u5185\u8d70\u5230\uff0c\u6b64\u65f6 $v=d$\uff0c\u8f93\u51fa $d$ \u5373\u53ef\uff1b\n\u5426\u5219\uff0c\u9700\u8981\u5224\u65ad $v$ \u6240\u5728\u7684\u8def\u5f84\u90e8\u5206\u3002\n\n\u8bbe $u$ \u5230 $d$ \u7684\u8ddd\u79bb $= x$\uff0c$u$ \u5230 $p$ \u7684\u8ddd\u79bb $= y$\u3002\n\n\u82e5 $y \\geq t$\uff0c\u5219 $v$ \u5728 $(u,p)$ \u4e0a\uff0c\u8fd9\u6b21\u64cd\u4f5c\u8d70\u8fc7\u7684\u8fb9\u5747\u4e3a\u4ece\u513f\u5b50\u5230\u7236\u4eb2\u7684\u8fb9\uff0c\u800c\u4e14\u8d70\u4e86 $t$ \u6b21\uff0c\u90a3\u4e48 $v$ \u4e3a $u$ \u7684 $t$ \u7ea7\u7956\u5148\u3002\n\n\u82e5 $y \\leq t$\uff0c\u5219 $v$ \u5728 $(p,d)$ \u4e0a\u3002\u5982\u679c\u6309\u7167\u4e0a\u9762\u7684\u601d\u8def\u8003\u8651\uff0c\u9664\u53bb $(u,p)$ \u4e0a\u7684 $y$ \u6761\u8fb9\u540e\uff0c\u5269\u4e0b\u7684 $t-y$ \u6761\u8fb9\u662f\u4ece\u7236\u4eb2\u5230\u513f\u5b50\u7684\u8fb9\uff0c\u4e0d\u597d\u8bb0\u5f55\u3002\n\n\u6b63\u96be\u5219\u53cd\uff0c\u6211\u4eec\u8003\u8651 $t$ \u6b65\u5185\u5728 $(u,d)$ \u4e0a\u6ca1\u6709\u8d70\u5230\u7684\u8fb9\uff0c\u8fd9\u6837\u7684\u8fb9\u6709 $x-t$ \u6761\uff0c\u800c\u4e14\u7ec4\u6210\u4e86\u4ece $v$ \u5230 $d$ \u7684\u7b80\u5355\u8def\u5f84\uff0c\u90a3\u4e48 $v$ \u4e3a $d$ \u7684 $x-t$ \u7ea7\u7956\u5148\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u5730\u628a\u539f\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\u7ef4\u62a4\u6811\u4e0a\u6700\u8fd1\u516c\u5171\u7956\u5148\u548c $k$ \u7ea7\u7956\u5148\u95ee\u9898\uff0c\u4f7f\u7528\u6811\u94fe\u5256\u5206\u7ef4\u62a4\u5373\u53ef\u3002\uff08\u500d\u589e\u8868\u5e38\u6570\u8fc7\u5927\uff0c\u4f1a\u5728\u7b2c $4$ \u4e2a\u6d4b\u8bd5\u70b9\u4e0a\u88ab\u5361\u6389 qnq\uff09\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal {O(n \\log n + k \\log n)}$\n\n\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal {O(n)}$\n\n## Code:\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nint n,u,k;\n\nint h[1000005],e[2000005],ne[2000005],idx;\n\nvoid add(int a,int b) {\n\te[idx]=b;\n\tne[idx]=h[a];\n\th[a]=idx++;\n}\n\nint depth[1000005];\n\nint sub[1000005];\nint heavy[1000005];\nint fa[1000005];\n\nvoid dfs1(int u) {\n\tsub[u]=1;\n\tfor(int i=h[u];i!=-1;i=ne[i]) {\n\t\tint v=e[i];\n\t\tif(depth[v]==0) {\n\t\t\tdepth[v]=depth[u]+1;\n\t\t\tfa[v]=u;\n\t\t\tdfs1(v);\n\t\t\tsub[u]+=sub[v];\n\t\t\tif(heavy[u]==0 || sub[heavy[u]]<sub[v]) {\n\t\t\t\theavy[u]=v;\n\t\t\t}\n\t\t}\n\t}\n}\n\nint dfn[1000005],top[1000005];\nint rk[1000005];\nint timestamp;\n\nvoid dfs2(int u,int topu) {\n\tdfn[u]=++timestamp;\n\trk[dfn[u]]=u;\n\ttop[u]=topu;\n\tif(heavy[u]==0) {\n\t\treturn;\n\t}\n\tdfs2(heavy[u],topu);\n\tfor(int i=h[u];i!=-1;i=ne[i]) {\n\t\tint v=e[i];\n\t\tif(depth[v]==depth[u]+1 && v!=heavy[u]) {\n\t\t\tdfs2(v,v);\n\t\t}\n\t}\n}\n\nint lca(int u,int v) {//\u6700\u8fd1\u516c\u5171\u7956\u5148\n\twhile(top[u]!=top[v]) {\n\t\tif(depth[top[u]]<depth[top[v]]) {\n\t\t\tswap(u,v);\n\t\t}\n\t\tu=fa[top[u]];\n\t}\n\tif(depth[u]>depth[v]) {\n\t\tswap(u,v);\n\t}\n\treturn u;\n}\n\nint kthA(int u,int d) {//k\u7ea7\u7956\u5148\n\td=depth[u]-d;\n\twhile(depth[top[u]]>d) {\n\t\tu=fa[top[u]];\n\t}\n\treturn rk[dfn[u]-(depth[u]-d)];\n}\n\nint read() {\n\tint s=0;\n\tchar ch=getchar();\n\twhile(ch<'0' || ch>'9') {\n\t\tch=getchar();\n\t}\n\twhile(ch>='0' && ch<='9') {\n\t\ts=s*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn s;\n}\n\nint main() {\n\tn=read(),u=read(),k=read();\n\tmemset(h,-1,sizeof(int)*(n+1));\n\tfor(int i=1;i<=n-1;i++) {\n\t\tint u=read(),v=read();\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tdepth[1]=1;\n\tdfs1(1);\n\tdfs2(1,1);//\u6811\u94fe\u5256\u5206\u9884\u5904\u7406\n\tfor(int i=1;i<=k;i++) {\n\t\tint d=read(),t=read();\n\t\tint p=lca(u,d);\n\t\tif(depth[u]+depth[d]-(depth[p]<<1)<=t) {//u\u5230d\u7684\u8ddd\u79bb\u5c0f\u4e8e\u7b49\u4e8et\n\t\t\tprintf(\"%d \",u=d);\n\t\t\tcontinue;\n\t\t}\n\t\tif(t>=depth[u]-depth[p]) {//u\u5230p\u7684\u8ddd\u79bb\u5c0f\u4e8e\u7b49\u4e8et\n\t\t\tt=(depth[u]+depth[d]-(depth[p]<<1))-t;\n\t\t\tu=kthA(d,t);\n\t\t}else {//u\u5230p\u7684\u8ddd\u79bb\u5927\u4e8et\n\t\t\tu=kthA(u,t);\n\t\t}\n\t\tprintf(\"%d \",u);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1643448921,
        "uid": 289547,
        "name": "bruhify",
        "ccfLevel": 7,
        "title": "P8025 [ONTAK2015] Zwi\u0105zek Harcerstwa Bajtockiego"
    },
    {
        "content": "#### \u9898\u76ee\u5927\u610f\n\n\n------------\n\u7ed9\u51fa\u4e00\u68f5\u6811\uff0c\u521d\u59cb\u70b9\u4e3a $m$ \u70b9\uff0c\u6bcf\u6b21\u7ed9\u51fa $d,t$\uff0c\u8be2\u95ee\u80fd\u5426\u4ece $m$ \u70b9\u8d70 $t$ \u6b65\u4e4b\u5185\u5230\u8fbe $d$ \u70b9\uff0c\u8f93\u51fa $m$ \u70b9\u6700\u7ec8\u505c\u7559\u7684\u4f4d\u7f6e\u3002\n\n#### \u601d\u8def\u5206\u6790\n\n\n------------\n\u5206\u7c7b\u8ba8\u8bba\n\n\u5982\u679c\u4e24\u70b9\u95f4\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\u5c0f\u4e8e $t$\uff0c\u90a3\u4e48\u4e00\u5b9a\u53ef\u4ee5\u8d70\u5230 $d$ \u70b9\uff0c\u76f4\u63a5\u8f93\u51fa\u5373\u53ef\u3002\n\n\u5982\u679c\u4e24\u70b9\u95f4\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\u5c0f\u4e8e\u7b49\u4e8e $m$ \u70b9\u5230 $m,d$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\uff0c\u8f93\u51fa $m$ \u7684 $t$ \u7ea7\u7956\u5148\u3002\n\n\u5982\u679c\u4e24\u70b9\u95f4\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\u5927\u4e8e $m$ \u70b9\u5230 $m,d$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\uff0c\u76f8\u5f53\u4e8e\u4ece $d$ \u70b9\u5411\u4e0a\u8d70\u4e24\u70b9\u95f4\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\u51cf\u53bb $t$ \u6b65\uff0c\u5373\u8f93\u51fa $d$ \u70b9\u7684 `depth[m]+depth[d]-2*depth[LCA(m,d)]-t` \u7ea7\u7956\u5148\u3002\n\n\u8003\u8651\u6811\u5256\u6c42\u89e3\u3002\n\n\u6bcf\u6b21\u5411\u4e0a\u8df3\u5230\u94fe\u9876\u4e0e\u76ee\u6807\u70b9\u6bd4\u8f83\uff0c\u5982\u679c\u6240\u5728\u94fe\u7684\u94fe\u9876\u7684\u6df1\u5ea6\u5927\u4e8e\u76ee\u6807\u70b9\u7684\u6df1\u5ea6\uff0c\u5219\u53ef\u4ee5\u7ee7\u7eed\u8df3\u3002\n\n\u82e5\u5f53\u524d\u6240\u5728\u7684\u70b9\u548c\u76ee\u6807\u70b9\u5904\u4e8e\u540c\u4e00\u6761\u94fe\u4e0a\uff0c\u7531\u4e8e\u4e4b\u524d\u6811\u5256\u4e2d\u6c42\u51fa\u4e86\u6bcf\u4e00\u4e2a\u70b9\u7684 dfs \u5e8f\uff0c\u76f4\u63a5\u5411\u4e0a\u8df3\u4e24\u70b9\u7684 dfs \u5e8f\u4e4b\u5dee\u6b65\u5373\u53ef\uff0c\u56e0\u4e3a\u4e00\u6761\u94fe\u4e0a\u7684\u70b9\u7684 dfs \u5e8f\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u4e24\u70b9\u7684\u5c42\u6570\u4e4b\u5dee\u5373\u4e3a\u4e24\u70b9 dfs \u5e8f\u4e4b\u5dee\u3002\n\n#### \u4ee3\u7801\u5b9e\u73b0\n\n\n------------\n```cpp\nvoid dfs1(int u,int fath){\n\tfa[u] = fath , depth[u] = depth[fath] + 1 , siz[u] = 1;\n\tfor(int i=head[u];i;i=edge[i].next){\n\t\tint v = edge[i].to;\n\t\tif(v == fath) continue;\n\t\tdfs1(v,u);\n\t\tsiz[u] += siz[v];\n\t\tif(siz[son[u]] < siz[v]) son[u] = v;\n\t}\n}\nvoid dfs2(int u,int topf){\n\ttop[u] = topf;\n\tdfn[u] = ++cnt;\n\tid[cnt] = u;\n\tif(!son[u]) return;\n\tdfs2(son[u],topf);\n\tfor(int i=head[u];i;i=edge[i].next){\n\t\tint v = edge[i].to;\n\t\tif(v == fa[u] || v == son[u]) continue;\n\t\tdfs2(v,v);\n\t}\n}\nint lca(int x,int y){\n\twhile(top[x] != top[y]){\n\t\tif(depth[top[x]] < depth[top[y]]) swap(x,y);\n\t\tx = fa[top[x]];\n\t}\n\tif(depth[x] > depth[y]) swap(x,y);\n\treturn x;\n}\nint find(int u,int d){\n\td = depth[u] - d;\n\twhile(depth[top[u]] > d){\n\t\tu = fa[top[u]];\n\t}\n\treturn id[dfn[u] - (depth[u] - d)];\n}\n\nint main(){\n\tint n = read() , m = read() , k = read();\n\tfor(int i=1;i<=n-1;i++){\n\t\tint a = read() , b = read();\n\t\tadd(a,b); add(b,a);\n\t}\n\tdfs1(1,0);\n\tdfs2(1,0);\n\tfor(int i=1;i<=k;i++){\n\t\tint d = read() , t = read();\n\t\tint pos = lca(m,d);\n\t\tint dis = depth[m] + depth[d] - 2 * depth[pos];\n\t\tif(dis < t){\n\t\t\tcout<<d<<\" \";\n\t\t\tm = d;\n\t\t\tcontinue;\n\t\t}\n\t\telse if(depth[m] - depth[pos] <= t){\n\t\t\tt = dis - t;\n\t\t\td = find(d,t);\n\t\t}\n\t\telse d = find(m,t);\n\t\tprintf(\"%d \",d);\n\t\tm = d;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1656992744,
        "uid": 335615,
        "name": "0xFF",
        "ccfLevel": 0,
        "title": "P8025"
    },
    {
        "content": "## \u524d\u8a00\uff1a\n\u5176\u5b9e\u8fd9\u9053\u9898\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684...\u53ea\u4e0d\u8fc7\u5b83\u5361\u500d\u589e\n## \u6b63\u6587\u90e8\u5206\n### \u8003\u573a 87 \u5206\u505a\u6cd5\uff08\u500d\u589e\uff09\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\uff0c\u5982\u679c\u60f3\u5728\u6811\u4e0a\u4ece $A$ \u70b9\u5230 $B$ \u70b9\uff0c\u9700\u8981\u5148\u4ece $A$ \u70b9\u8d70\u5230\u5b83\u4eec\u7684 lca\uff0c\u518d\u4ece\u5b83\u4eec\u7684 lca \u8d70\u5230 $B$ \u70b9\u3002\u6211\u4eec\u8fd8\u53ef\u4ee5\u5229\u7528\u6bcf\u4e2a\u8282\u70b9\u7684\u6df1\u5ea6\u8868\u793a\u51fa $A$ \u5230 lca(A,B) \u7684\u8ddd\u79bb\u548c lca(A,B) \u5230 $B$ \u7684\u8ddd\u79bb\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u5b83\u4eec\u7684 lca \u5c31\u53ef\u4ee5\u77e5\u9053\u80fd\u5426\u5728\u6307\u5b9a\u6b65\u6570\u5185\u4ece $A$ \u70b9\u5230\u8fbe $B$ \u70b9\u3002\n\n\u73b0\u5728\u5c31\u53ea\u9700\u8981\u8003\u8651\u4e0d\u80fd\u5230\u7684\u60c5\u51b5\u3002\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u6211\u4eec\u6700\u540e\u4f1a\u843d\u5728\u5728\u90a3\u4e00\u6bb5\u3002\u6211\u4eec\u8bbe $A$ \u5230 lca(A,B) \u7684\u8ddd\u79bb\u4e3a $x$\uff0c\u5982\u679c $x < t$\uff0c\u5219\u6211\u4eec\u6700\u540e\u4f1a\u843d\u5728 $B$ \u548c lca(A,B) \u4e4b\u95f4\uff1b\u5982\u679c $x > t$\uff0c\u5219\u6211\u4eec\u6700\u540e\u4f1a\u843d\u5728 $A$ \u548c lca(A,B) \u4e4b\u95f4\uff1b\u5982\u679c $x = t$\uff0c\u5219\u6211\u4eec\u4f1a\u843d\u5728 lca(A,B) \u4e0a\u3002\n\n\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u786e\u5b9a\u4e86\u4f1a\u5728\u54ea\u4e00\u6bb5\u8def\u4e0a\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ea\u9700\u8981\u786e\u5b9a\u5728\u90a3\u4e2a\u70b9\u4e0a\u4e86\u3002\u6211\u4eec\u8fd9\u6837\u8003\u8651\uff1a\u5982\u679c\u6211\u4eec\u6700\u540e\u843d\u5728\u4e86 $A$ \u548c lca(A,B) \u4e4b\u95f4\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4ece $A$ \u5411\u4e0a\u8df3\uff1b\u5982\u679c\u662f\u843d\u5728\u4e86 $B$ \u548clca(A,B) \u4e4b\u95f4\uff0c\u6211\u4eec\u5c31\u4ece $B$ \u5f80\u4e0a\u8df3\u3002\u8fd9\u4e2a\u5f80\u4e0a\u8df3\u7684\u8fc7\u7a0b\u6211\u4eec\u53ef\u4ee5\u4eff\u7167\u500d\u589e\u6c42 lca \u4e2d\u628a\u4e24\u4e2a\u8282\u70b9\u8df3\u5230\u540c\u4e00\u4e2a\u6df1\u5ea6\u5904\u7684\u505a\u6cd5\uff0c\u53ca\uff1a\n```\nif(dep[x]>dep[y]) swap(x,y);\nfor(int i=0;dep[y]-dep[x]>>i>0;++i) \n\tif(dep[y]-dep[x]>>i&1)\n\t\ty=fa[y][i];\n//lca\n\nint move(int m,int t)\n{\n\tfor(int i=0;t>>i>0;++i) \n\t\tif(t>>i&1)\n\t\t\tm=fa[m][i];\n\treturn m;\n}\n//\u79fb\u52a8\n```\n\u90a3\u4e48\u606d\u559c\u4f60\uff0c\u5982\u679c\u4f60\u8fd9\u6837\u5b9e\u73b0\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u62ff\u5230 87 \u5206\uff08\u6709\u4e00\u4e2a\u70b9 TLE\uff09\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u5982\u4f55\u628a\u8fd9\u4e2a\u4ee3\u7801\u6539\u5bf9\u5462\uff1f\n\n### \u6b63\u89e3\n\n\u4e0a\u8ff0\u505a\u6cd5\u4e2d\uff0c\u6211\u4eec\u7684\u7ed3\u8bba\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528\u7684\uff0c\u53ea\u4e0d\u8fc7\u6c42 lca \u548c move \u8fd9\u4e24\u4e2a\u90e8\u5206\u6162\u4e86\u4e00\u70b9\u3002\u4e8e\u662f\u6211\u4eec\u5f88\u5bb9\u60f3\u5230\u7528\u5e38\u6570\u66f4\u5c0f\u7684[\u6811\u94fe\u5256\u5206](https://oi-wiki.org/graph/hld/)\u3002\u6211\u4eec\u53ea\u9700\u8981\u628a move \u8fc7\u7a0b\u4ece\u6a21\u4eff\u500d\u589e\u53d8\u6210\u5728\u91cd\u94fe\u4e0a\u9762\u8df3\u5373\u53ef\u3002\n\n### \u5b8c\u6574\u4ee3\u7801\n\n\u500d\u589e\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1000005;\nint fa[N][22],n,m,dep[N],head[N],t,k;\nstruct node\n{\n\tint to,next;\n}a[N<<1];\nvoid add(int from,int to)\n{\n\ta[++t].to=to;\n\ta[t].next=head[from];\n\thead[from]=t;\n}\nvoid dfs(int rt,int f)    \u500d\u589e\u6c42 lca \u4e2d\u7684 dfs \n{\n\tdep[rt]=dep[f]+1;\n\tfa[rt][0]=f;\n\tfor(int i=1;i<=20;++i)\n\t\tfa[rt][i]=fa[fa[rt][i-1]][i-1];\n\tfor(int i=head[rt];i!=0;i=a[i].next)\n\t\tif(a[i].to!=f)\n\t\t\tdfs(a[i].to,rt);\n\treturn ;\n}\nint lca(int x,int y)  //\u500d\u589e\u6c42lca\n{\n\tif(dep[x]>dep[y]) swap(x,y);\n\tfor(int i=0;dep[y]-dep[x]>>i>0;++i) \n\t\tif(dep[y]-dep[x]>>i&1)\n\t\t\ty=fa[y][i];\n\tif(x==y) return x;\n\tfor(int i=20;i>=0;--i) \n\t\tif(fa[x][i]!=fa[y][i])\n\t\t\tx=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}\nint move(int m,int t)\n{\n\tfor(int i=0;t>>i>0;++i) \n\t\tif(t>>i&1)\n\t\t\tm=fa[m][i];\n\treturn m;\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tfor(int i=1;i<n;++i)\n\t{\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);\n\t\tadd(y,x);\n\t}\n\tdfs(1,0);\n\tfor(int i=1;i<=k;++i) \n\t{\n\t\tint d,t;\n\t\tscanf(\"%d%d\",&d,&t);\n\t\tint l=lca(m,d);\n\t\tif(dep[m]-dep[l]+dep[d]-dep[l]<=t) m=d;   \u5224\u65ad\u6700\u7ec8\u5230\u5e95\u4f1a\u843d\u5728\u5728\u54ea\u4e00\u6bb5\u4e0a\n\t\telse if(dep[m]-dep[l]>t) m=move(m,t);\n\t\telse if(dep[m]-dep[l]==t) m=l;\n\t\telse if(dep[m]-dep[l]<t) m=move(d,dep[d]-dep[l]-t+dep[m]-dep[l]);\n\t\tprintf(\"%d \",m);\n\t}\n\treturn 0;\n}\n\n```\n\n\u6811\u94fe\u5256\u5206\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-') f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-48;ch=getchar();}\n\treturn x*f;\n}\nconst int N=1000005;\nint t,head[N],m,k,n,fa[N],top[N],son[N],rnk[N],dfn[N],dep[N],siz[N],cnt;\nstruct node\n{\n\tint to,next;\n}a[N<<1];\nvoid add(int x,int y)\n{\n\ta[++t].to=y;\n\ta[t].next=head[x];\n\thead[x]=t;\n}\nvoid dfs1(int rt,int f)\n{\n\tfa[rt]=f;\n\tdep[rt]=dep[f]+1;\n\tsiz[rt]=1;\n\tfor(int i=head[rt];i!=0;i=a[i].next)\n\t{\n\t\tif(dep[a[i].to]!=0) continue;\n\t\tdfs1(a[i].to,rt);\n\t\tsiz[rt]+=siz[a[i].to];\n\t\tif(siz[son[rt]]<siz[a[i].to]) son[rt]=a[i].to;\n\t}\n\treturn ;\n}\nvoid dfs2(int rt,int tp)\n{\n\ttop[rt]=tp;\n\tdfn[rt]=++cnt;\n\trnk[cnt]=rt;\n\tif(son[rt]==0) return ;\n\tdfs2(son[rt],tp);\n\tfor(int i=head[rt];i!=0;i=a[i].next)\n\t\tif(dfn[a[i].to]==0&&a[i].to!=son[rt]) dfs2(a[i].to,a[i].to);\n\treturn ;\n}\nint lca(int x,int y)   //\u6811\u94fe\u5256\u5206\u6c42 lca\n{\n\twhile(top[x]!=top[y])\n\t\tif(dep[top[x]]<dep[top[y]]) y=fa[top[y]];\n\t\telse x=fa[top[x]];\n\treturn dep[x]<dep[y]?x:y;\n}\nint move(int s,int t)   \u79fb\u52a8\n{\n\tint x=s;\n\twhile(dep[x]-dep[top[s]]+1<=t)\n\t\ts=fa[top[s]];\n//\tcout<<dfn[s]-(t-dep[x]-dep[s])<<endl;\n\treturn rnk[dfn[s]-(t-(dep[x]-dep[s]))];\n}\nint main()\n{\n//\tstd::ios::sync_with_stdio(false);\n//\tstd::cin.tie(0),std::cout.tie(0);\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tfor(int i=1;i<n;++i)\n\t{\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);\n\t\tadd(y,x);\n\t}\n\tdfs1(1,0);\n\tdfs2(1,1);\n\tfor(int i=1;i<=k;++i)\n\t{\n\t\tint d,t;\n\t\tscanf(\"%d%d\",&d,&t);\n\t\tint l=lca(m,d);\n\t\tif(dep[m]-dep[l]==t) m=l;     \u5224\u65ad\u843d\u5728\u54ea\u4e00\u6bb5\n\t\telse if(dep[m]-dep[l]+dep[d]-dep[l]<=t) m=d;\n\t\telse if(dep[m]-dep[l]>t) m=move(m,t);\n\t\telse m=move(d,dep[d]-dep[l]-(t-(dep[m]-dep[l])));\n\t\tprintf(\"%d \",m);\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1647939141,
        "uid": 141082,
        "name": "\u849f\u84bb\u4e2d\u7684zzh",
        "ccfLevel": 0,
        "title": "P8025\u9898\u89e3"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6 [\u6811\u94fe\u5256\u5206](https://oi-wiki.org//graph/hld/)\uff08oi-wiki\uff09\n\n# \u601d\u8def\n\u9898\u76ee\u8981\u6c42\u6811\u4e0a\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u7b2c\u4e00\u4e2a\u60f3\u5230\u7684\u5e94\u8be5\u662f\u6c42 LCA\uff08\u6700\u8fd1\u516c\u5171\u7956\u5148\uff09\uff0c\u7136\u540e\u518d\u7b97\u8ddd\u79bb\u3002\n\n\u56e0\u4e3a\u6811\u5256\u540e\u5f97\u5230\u7684\u540c\u4e00\u6761\u91cd\u94fe\u4e0a\u7684 dfs \u5e8f\u90fd\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528 dfs \u5e8f\u6765\u6c42\u540c\u4e00\u6761\u94fe\u4e0a\u4efb\u610f\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\u5e76\u4e14\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u7f16\u53f7\u90fd\u5bf9\u5e94**\u552f\u4e00**\u7684 dfs \u5e8f\u3002\u5229\u7528\u8fd9\u70b9\u5c31\u80fd\u6c42\u51fa\u79fb\u52a8\u540e\u7684\u4f4d\u7f6e\u3002\n\n# \u91cd\u70b9\n\u5bf9\u4e8e\u4e0d\u540c\u7684\u94fe\uff0cdfs \u5e8f\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u8bbe\u5f53\u524d\u6700\u591a\u8d70 $k$ \u6b65\uff0c\u5f53\u524d\u94fe\u7684\u957f\u5ea6\u4e3a $L$\uff0c\u5982\u679c $k>L$\uff0c\u5219 $k=k-L$\uff0c\u7136\u540e\u8df3\u5230\u4e0b\u4e00\u6761\u94fe\u3002\n\n\u91cd\u590d\u6b64\u8fc7\u7a0b\uff0c\u76f4\u5230 $k<L$\uff0c\u8bbe\u5f53\u524d\u8282\u70b9\u4e3a $x$\uff0c\u5219\u7ec8\u70b9\u7684 dfs \u5e8f\u4e3a $dfn[x]\\pm k$\u3002\n\uff08\u5efa\u8bae\u753b\u4e00\u68f5\u6811\u6a21\u62df\u6b64\u8fc7\u7a0b\u65b9\u4fbf\u7406\u89e3\uff09\n\n\u4ee3\u7801\uff08\u6838\u5fc3\u4ee3\u7801\u6709\u6ce8\u91ca\uff09\n```\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<vector>\n\nusing namespace std;\nconst int N=1e6+5;\nstruct Node{\n\tint ver,nxt;\n}List[N<<1];\nint head[N],tot;\nint dep[N],siz[N],son[N],fa[N],dfn[N],top[N],rnk[N],cnt;\n//rnk\u6570\u7ec4\u5b58\u539f\u7f16\u53f7\nint ans[N];\nint n,s,m;\n\nvoid add(int x,int y){\n\tList[++tot].ver=y;\n\tList[tot].nxt=head[x];\n\thead[x]=tot;\n\treturn;\n}//\u5efa\u8fb9\n\nvoid Dfs1(int x){\n\tint i;\n\tsiz[x]=1;\n\tson[x]=-1;\n\tfor(i=head[x];i;i=List[i].nxt){\n\t\tint y=List[i].ver;\n\t\tif(dep[y]<=dep[x]+1) continue;\n\t\tdep[y]=dep[x]+1;\n\t\tfa[y]=x;\n\t\tDfs1(y);\n\t\tsiz[x]+=siz[y];\n\t\tif(son[x]==-1||siz[y]>siz[son[x]]) son[x]=y;\n\t}\n\treturn;\n}\n\nvoid Dfs2(int x,int k){\n\tint i;\n\ttop[x]=k;\n\tdfn[x]=++cnt;\n\trnk[cnt]=x;\n\tif(son[x]==-1) return;\n\tDfs2(son[x],k);\n\tfor(i=head[x];i;i=List[i].nxt){\n\t\tint y=List[i].ver;\n\t\tif(y==fa[x]||y==son[x]) continue;\n\t\tDfs2(y,y);\n\t}\n\treturn;\n}//\u6811\u5256\n\nint lca(int x,int y){\n\twhile(top[x]!=top[y]){\n\t\tif(dep[top[x]]<dep[top[y]]) swap(x,y);\n\t\tx=fa[top[x]];\n\t}\n\treturn dep[x]<dep[y]?x:y;\n}//\u6c42\u6700\u8fd1\u516c\u5171\u7956\u5148\n\nvoid solve(int x,int y){\n\t//x\u662f\u7ec8\u70b9\uff0cs\u662f\u5f53\u524d\u4f4d\u7f6e\n\tint pos=lca(x,s),d1=dep[s]-dep[pos],d2=dep[x]-dep[pos];\n\tif(y>=d1) s=pos,y-=d1;\t\t//\u7279\u5224\n\telse{\t\t//\u5f80\u4e0a\u8d70\n\t\twhile(top[s]!=top[pos]){\t//\u5982\u679c\u4e0d\u5728\u540c\u4e00\u6761\u94fe\n\t\t\tint dis=dfn[s]-dfn[top[s]]+1;\t//\u6c42\u94fe\u957f\uff08\u7b2c\u4e00\u6b21\u4e3as\u5230\u94fe\u9876\u957f\u5ea6\uff09\n\t\t\tif(y<dis){\t\t//\u5982\u679c\u5230\u4e0d\u4e86\u4e0b\u4e00\u6761\u94fe\n\t\t\t\ts=rnk[dfn[s]-y];\t//\u8bb0\u5f55\u539f\u7f16\u53f7\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ty-=dis;\t\t//\u51cf\u6389\u5f53\u524d\u94fe\u957f\n\t\t\ts=fa[top[s]];\t//\u8df3\u5230\u4e0b\u4e00\u6761\u94fe\n\t\t}\n\t\ts=rnk[dfn[s]-y];\n\t\treturn;\n\t}\n\tif(y>=d2){\n\t\ts=x;\n\t\treturn;\n\t}else{\t\t//\u5f80\u4e0b\u8d70\n\t\tvector<pair<int,int> > vec;\t\t\n        //\u56e0\u4e3a\u94fe\u53ea\u80fd\u4e0a\u8df3\uff0c\u7528vector\u50a8\u5b58\u94fe\u7684\u4fe1\u606f\n\t\twhile(top[x]!=top[pos]){\n\t\t\tint dis=dfn[x]-dfn[top[x]]+1;\n\t\t\tvec.push_back(make_pair(top[x],dis));\n\t\t\tx=fa[top[x]];\n\t\t}\n\t\tvec.push_back(make_pair(pos,dep[x]-dep[pos]+1));\t//\u6ce8\u610f\u8bb0\u5f55\u6700\u540e\u4e00\u6bb5\n\t\tint i;\n\t\tfor(i=vec.size()-1;i>=0;i--){\t\t//\u5012\u7740\u641c\u6bcf\u4e00\u6761\u94fe\n\t\t\tint d=vec[i].second;\n\t\t\tif(y<d){\n\t\t\t\ts=rnk[dfn[vec[i].first]+y];\t\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ty-=d;\n\t\t}\n\t}\n\treturn;\n}\n----------\u6c42\u89e3----------\nint main(){\n\tint i;\n\tscanf(\"%d%d%d\",&n,&s,&m);\n\tfor(i=1;i<n;i++){\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);add(y,x);\n\t}\n\tmemset(dep,0x3f,sizeof(dep));\n\tdep[s]=1;\n\tDfs1(s);\n\tDfs2(s,s);\n\tfor(i=1;i<=m;i++){\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tsolve(x,y);\n\t\tans[i]=s;\n\t}\n\tfor(i=1;i<=m;i++) printf(\"%d \",ans[i]);\n\tprintf(\"\\n\");\n\treturn 0;\n}\n```\n",
        "postTime": 1653643880,
        "uid": 209541,
        "name": "huayt",
        "ccfLevel": 0,
        "title": "P8025 \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u5f53\u76ee\u524d\u6240\u5728\u7684\u4f4d\u7f6e\u548c\u76ee\u6807\u70b9 $d$ \u7684\u6811\u4e0a\u8ddd\u79bb\u5c0f\u4e8e $t$ \u65f6\uff0c\u90a3\u4e48\u7b54\u6848\u80af\u5b9a\u662f\u76ee\u6807\u70b9\u3002\u800c\u6811\u4e0a\u8ddd\u79bb\u53ef\u4ee5\u901a\u8fc7\u6c42 $lca$ \u540e $lca$ \u548c\u8d77\u59cb\u70b9\u3001\u76ee\u6807\u70b9\u7684\u6df1\u5ea6\u4e4b\u5dee\u7684\u548c\u5f97\u51fa\u3002\n\n\u5f53\u6811\u4e0a\u8ddd\u79bb\u5927\u4e8e $t$ \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u7c7b\u8ba8\u8bba\uff0c\u8bbe\u8d77\u59cb\u70b9\u4e0e $lca$ \u7684\u8ddd\u79bb\u4e3a $dis1$\uff0c\u76ee\u6807\u70b9\u4e0e $lca$ \u7684\u8ddd\u79bb\u4e3a $dis2$\uff0c\u5219\uff1a\n\n1. $dis1=t$\uff0c\u6b64\u65f6\u4e0d\u5fc5\u591a\u8bf4\uff0c\u7b54\u6848\u5c31\u662f $lca$\u3002\n\n2. $dis1>t$\uff0c\u5927\u4e8e $t$ \u5c31\u8bf4\u660e\u65e0\u6cd5\u8d70\u5230 $lca$ \u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u8d77\u59cb\u70b9\u5411\u4e0a\u8df3 $t$ \u6b65\uff0c\u5373\u7b54\u6848\u4e3a\u8d77\u59cb\u70b9\u7684 $t$ \u7ea7\u7956\u5148\u3002\u6c42 $t$ \u7ea7\u7956\u5148\u663e\u7136\u53ef\u4ee5\u7528\u6811\u94fe\u5256\u5206\u6765\u6c42\u3002\u500d\u589e\u7684\u65b9\u5f0f\u5927\u6982\u4e5f\u53ef\u4ee5\uff08\u4f46\u597d\u50cf\u7531\u4e8e\u5e38\u6570\u8fc7\u5927\u4f1a\u8d85\u65f6\uff09\n\n3. $dist1<t$\uff0c\u6b64\u65f6\u7ec8\u70b9\u4e00\u5b9a\u662f\u5728 $lca$ \u5230\u76ee\u6807\u70b9\u7684\u4e00\u6761\u94fe\u4e0a\uff0c\u7b54\u6848\u4e3a $lca$ \u5411\u4e0b\u8df3 $t-dis1$ \u6b65\u7684\u4f4d\u7f6e\u3002\u4f46\u6c42\u513f\u5b50\u663e\u7136\u5e76\u4e0d\u597d\u6c42\uff0c\u800c\u7531\u4e8e\u603b\u8ddd\u79bb\u56fa\u5b9a\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06\u8df3\u513f\u5b50\u6539\u4e3a\u8df3\u7956\u5148\uff0c\u5373\u7b54\u6848\u4e3a\u76ee\u6807\u70b9\u7684 $dis1+dis2-t$ \u7ea7\u7956\u5148\uff0c\u540c\u6837\u53ef\u4ee5\u7528\u4e0a\u8ff0\u65b9\u6cd5\u6765\u6c42\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+k)logn)$\uff0c\u5373\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define N 1000005\nint n,now,k,head[N],tot,cnt,rk[N];\nstruct node{\n\tint to,next;\n\tnode (int to=0,int next=0)\n\t\t:to(to),next(next){}\n}b[N<<1];\nstruct node1{\n\tint fa,w,zson,top,size,id,d;\n}e[N];\nint read(){\n\tint w=0,f=1;\n\tchar c=getchar();\n\twhile (c>'9'||c<'0'){\n\t\tif (c=='-') f=-1;\n\t\tc=getchar();\n\t}\n\twhile (c>='0'&&c<='9'){\n\t\tw=(w<<3)+(w<<1)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn w*f;\n}\nvoid adde(int u,int v){\n\tb[++tot]=node(v,head[u]);\n\thead[u]=tot;\n}\nvoid dfs1(int u){\n\te[u].d=e[e[u].fa].d+1,e[u].size=1;\n\tfor (int i=head[u];i;i=b[i].next){\n\t\tint v=b[i].to;\n\t\tif (v!=e[u].fa){\n\t\t\te[v].fa=u;\n\t\t\tdfs1(v);\n\t\t\te[u].size+=e[v].size;\n\t\t\tif (e[v].size>=e[e[u].zson].size)\n\t\t\t\te[u].zson=v;\n\t\t} \n\t} \n} \nvoid dfs2(int u,int tp){\n\te[u].top=tp,e[u].id=++cnt,rk[cnt]=u;\n\tif (e[u].zson) dfs2(e[u].zson,tp);\n\tfor (int i=head[u];i;i=b[i].next){\n\t\tint v=b[i].to;\n\t\tif (v!=e[u].fa&&v!=e[u].zson)\n\t\t\tdfs2(v,v);\n\t}\n}\nvoid query(int x,int y,int t){\n\tint to=y;\n\twhile (e[x].top!=e[y].top){\n\t\tif (e[e[x].top].d<e[e[y].top].d) swap(x,y);\n\t\tx=e[e[x].top].fa;\n\t}\n\tif (e[x].id>e[y].id) swap(x,y);//\u6b64\u65f6x\u4e3alca\n\tint all=e[to].d+e[now].d-e[x].d*2;\n\tif (all<=t){\n\t\tnow=to;\n\t\treturn;\n\t}\n\tif (e[now].d-e[x].d==t){//\u5206\u7c7b\u8ba8\u8bba\n\t\tnow=x;\n\t\treturn;\n\t}else if (e[now].d-e[x].d>t){\n\t\ty=now;\n\t\twhile (e[y].d-e[e[y].top].d<t) t-=e[y].d-e[e[y].top].d+1,y=e[e[y].top].fa;//\u8df3\u91cd\u94fe\n\t\tnow=rk[e[y].id-t];//\u540c\u91cd\u94fe\u4e4b\u4e2d\u8df3\n\t\treturn;\n\t}else{\n\t\tt=all-t,y=to;\n\t\twhile (e[y].d-e[e[y].top].d<t) t-=e[y].d-e[e[y].top].d+1,y=e[e[y].top].fa;\n\t\tnow=rk[e[y].id-t];\n\t\treturn;\n\t}\n}\nint main(){\n\tn=read(),now=read(),k=read();\n\tfor (int i=1;i<n;i++){\n\t\tint u=read(),v=read();\n\t\tadde(u,v),adde(v,u);\n\t}\n\tdfs1(1),dfs2(1,1);\n\twhile (k--){\n\t\tint d=read(),t=read();\n\t\tquery(now,d,t);\n\t\tprintf(\"%d \",now);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1644708693,
        "uid": 257621,
        "name": "\u7ffc\u5fb7\u5929\u5c0a",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P8025 Zwi\u0105zek Harcerstwa Bajtockiego"
    }
]