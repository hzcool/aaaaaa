[
    {
        "content": "\u8003\u8651\u4e00\u4e2a\u66b4\u529b\u7684 DP\uff1a\u5173\u4e8e\u4e09\u8fdb\u5236 DP\uff0c\u4ee4 $f_{i,j}$ \u8868\u793a\u4e09\u8fdb\u5236\u610f\u4e49\u4e0b\u9ad8\u4e8e $i$ \u7684\u4fe1\u606f\u5df2\u7ecf\u786e\u5b9a\uff0c\u4e14\u5df2\u786e\u5b9a\u7684\u6570\u7684\u4e8c\u8fdb\u5236\u8868\u8fbe\u4e3a $j$\uff0c\u6240\u6709\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u6570 $i$ \u7684 $x^iz^{b(i)}$ \u4e4b\u548c\u3002$y^{a(i)}$ \u7684\u7cfb\u6570\u53ef\u4ee5\u5728 $f_{-1,j}$ \u5904\u7edf\u8ba1\u3002\n\n\u8fd9\u4e2a\u505a\u6cd5\u662f $O(n)$ \u7684\uff0c\u4e0d\u53ef\u627f\u53d7\u3002\n\n\u6ce8\u610f\u5230\u4e09\u8fdb\u5236\u4e0b\u586b\u5165\u540e $i$ \u4f4d\u65f6\uff0c\u53ea\u4f1a\u5f71\u54cd\u4e8c\u8fdb\u5236\u4e0b\u6700\u4f4e\u7684 $l_i$ \u4f4d\uff0c\u5176\u4e2d $l_i$ \u662f\u6ee1\u8db3 $2^{l_i}>3^{i+1}$ \u7684\u6700\u5c0f\u81ea\u7136\u6570\u3002\u5bf9\u4e8e\u66f4\u9ad8\u4f4d\u7684\u5f71\u54cd\uff0c\u5176\u81f3\u591a\u8fdb\u4e00\u4f4d\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u72b6\u6001\u66f4\u65b0\u6210 $f_{i,j,0/1}$\uff0c\u8868\u793a\u5df2\u786e\u5b9a\u7684\u6570\u7684\u4e8c\u8fdb\u5236\u8868\u8fbe\u7684\u540e $l_i$ \u4f4d\uff08\u4e5f\u5373\u6a21 $2^{l_i}$ \u7684\u7ed3\u679c\uff09\u662f $j$\uff0c\u4e14\u5411\u66f4\u9ad8\u4f4d\u65e0/\u6709\u8fdb\u4f4d\u65f6\u7684\u7b54\u6848\u3002\n\n\u4f46\u662f\u8fd9\u4e2a DP \u5e76\u6ca1\u6709\u4efb\u4f55\u5b9e\u8d28\u6027\u7684\u6539\u53d8\u2026\u2026\u5417\uff1f\n\n\u8003\u8651 **\u6839\u53f7\u5206\u6cbb**\u3002\u9ad8 $3^{m/2}$ \u4f4d\u4e00\u5171\u53ea\u4f1a\u8bbf\u95ee\u6839\u53f7\u4e2a\u6001\uff1b\u4f4e $3^{m/2}$ \u4f4d\u7684\u72b6\u6001\u603b\u6570\u662f\u6839\u53f7\u7684\uff1b\u6545\u53ea\u5bf9\u4f4e $3^{m/2}$ \u4f4d\u8bb0\u5fc6\u5316\uff0c\u590d\u6742\u5ea6\u5c31\u662f\u6b63\u786e\u7684\u6839\u53f7\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int mod=998244353;\nint ksm(int x,ll y){int z=1;for(;y;y>>=1,x=1ll*x*x%mod)if(y&1)z=1ll*z*x%mod;return z;}\nconst int LG=28;\nconst int HF=14;\nll n;int X,Y,Z,py[1010],pz[1010];\nll tri[30];\nint px[30][3],l[30],bd[30],sum[30],pc[1<<10];\nint f[1<<25][2];\nint dfs(int pos,ll num,bool car,bool lim){\n\tif(pos==-1){return !car?py[pc[num]]:0;}\n\tif(!lim&&pos<HF&&f[sum[pos]+num][car]!=-1)return f[sum[pos]+num][car];\n\tint res=0;\n\tfor(int i=0;i<=(lim?bd[pos]:2);i++)for(int CAR=0;CAR<2;CAR++){\n\t\tll NUM=num+tri[pos]*i+((ll)CAR<<l[pos]);\n\t\tif((NUM>=(1ll<<l[pos+1]))!=car)continue;\n\t\tNUM&=(1ll<<l[pos+1])-1;\n\t\tint PX=px[pos][i],PY=py[pc[NUM>>l[pos]]],PZ=pz[i];\n\t\tres=(1ll*dfs(pos-1,NUM&((1ll<<l[pos])-1),CAR,lim&&(i==bd[pos]))*PX%mod*PY%mod*PZ+res)%mod;\n\t}\n\t// printf(\"%d %d %d %d:%d\\n\",pos,num,car,lim,res);\n\tif(!lim&&pos<HF)f[sum[pos]+num][car]=res;\n\treturn res;\n}\nint main(){\n\tfreopen(\"conversion.in\",\"r\",stdin);\n\tfreopen(\"conversion.out\",\"w\",stdout);\n\tscanf(\"%lld%d%d%d\",&n,&X,&Y,&Z);\n\tfor(int i=0;i<(1<<10);i++)pc[i]=pc[i>>1]+(i&1);\n\tpy[0]=pz[0]=1;for(int i=1;i<=1000;i++)py[i]=1ll*py[i-1]*Y%mod,pz[i]=1ll*pz[i-1]*Z%mod;\n\ttri[0]=1;for(int i=1;i<=LG+1;i++)tri[i]=tri[i-1]*3;\n\tfor(int i=0;i<LG;i++)px[i][0]=1,px[i][1]=ksm(X,tri[i]),px[i][2]=1ll*px[i][1]*px[i][1]%mod;\n\tfor(int i=0;i<=LG;i++)while((1ll<<l[i])<=tri[i])l[i]++;\n\t// for(int i=0;i<=LG;i++)printf(\"%d \",l[i]);puts(\"\");\n\tfor(int i=0;i<HF;i++)sum[i+1]=sum[i]+(1<<l[i+1]);\n\tfor(int i=0;i<LG;i++)bd[i]=(n/tri[i])%3;\n\tmemset(f,-1,sizeof(f));\n\tprintf(\"%d\\n\",(dfs(LG-1,0,false,true)+mod-1)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1652775339,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8350\u3010[SDOI/SXOI2022] conversion\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u6ce2\u7279\u601d\u7ef4\u7684\u5199\u6cd5\u3002\n\n\u9996\u5148\u4e00\u4e2a\u5927\u4f53\u7684\u601d\u8def\u5e94\u8be5\u662f\u5bf9\u4e8e $a(i),b(i)$ \u90fd\u76f8\u540c\u7684\u6211\u4eec\u4e00\u8d77\u8ba1\u7b97\u7b54\u6848\u3002\u4f46\u662f\u4e00\u4e2a\u6570\u5728\u4e09\u8fdb\u5236\u548c\u4e8c\u8fdb\u5236\u4e0b\u7684\u6570\u4f4d\u51e0\u4e4e\u662f\u6ca1\u6709\u4ec0\u4e48\u5173\u8054\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5fc5\u987b\u8981\u201c\u66b4\u529b\u201d\u5730\u627e\u8fd9\u4e2a\u5bf9\u5e94\u5173\u7cfb\u3002\u7136\u540e\u53d1\u73b0\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u770b\u8d77\u6765\u5c31\u5f88\u6839\u53f7\uff0c\u6240\u4ee5\u8003\u8651\u6298\u534a\u6cd5\u4f18\u5316\u66b4\u529b\u3002\n\n\u8003\u8651\u5bf9\u4e09\u8fdb\u5236\u8fd9\u8fb9\u8fdb\u884c\u6298\u534a\uff0c\u5206\u6210\u4e86\u9ad8\u4f4d\u548c\u4f4e\u4f4d\u3002\u4f4e\u4f4d\u7684\u6570 $p$ \u4f1a\u5bf9\u5e94\u4e00\u4e2a $\n\\sqrt n $ \u7ea7\u522b\u7684\u4e8c\u8fdb\u5236\u6570\uff0c\u9ad8\u4f4d\u7684\u6570 $q\\times 3^B$ \u4f1a\u5bf9\u5e94\u4e00\u4e2a $n$ \u7ea7\u522b\u7684\u4e8c\u8fdb\u5236\u6570\u3002\u8fd9\u65f6\u5019 $x$ \u548c $z$ \u7684\u6b21\u6570\u5f88\u597d\u7b97\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u7684\u76ee\u7684\u662f\u6c42\u51fa\u8fd9\u4e2a\u6570\u7684\u4e8c\u8fdb\u5236\u6570\u4f4d\u6570\u3002\u6ce8\u610f\u5230\u8fd9\u4e2a\u6570\u7684\u4e8c\u8fdb\u5236\u9ad8\u4f4d\u4e0e $q\\times 3^B$ \u7684\u8981\u4e48\u76f8\u540c\uff0c\u8981\u4e48\u5927\u4e00\u3002\u56e0\u6b64\u53ef\u4ee5\u505a\u4e00\u4e2a\u5206\u7c7b\u8ba8\u8bba\uff0c\u8fd9\u6837\u53ef\u4ee5\u628a\u4e8c\u8fdb\u5236\u9ad8\u4f4d\u7684\u4f4d\u6570\u7b97\u51fa\u6765\u3002\u7136\u540e\u628a $p$ \u4e0e $q\\times 3^B$ \u5408\u5e76\u7684\u65f6\u5019\uff0c\u4e8c\u8fdb\u5236\u4f4e\u4f4d\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u90a3\u76f4\u63a5 NTT \u66b4\u529b\u5377\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u8c03\u6574 $B$ \u7684\u503c\uff0c\u4f7f\u5f97\u8fd9\u4e2a $\\log$ \u5e26\u5728\u6839\u53f7\u4e0b\u9762\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sqrt {n\\log n})$\u3002\n\n\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\u7406\u89e3\u4e0a\u8ff0\u8fc7\u7a0b\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nconst int N=531441,M=14348907,P=1<<20,mod=998244353;\n\nvoid add(int&x,int y){\n\tx+=y;x%=mod;\n}\nint gsc(int x,int y){\n    int ans=1;\n    for(int i=1;i<=y;i<<=1,x=x*x%mod)\n        if(y&i)\n            ans=ans*x%mod;\n    return ans;\n}int inv(int k){return gsc(k,mod-2);}\nint lim,r[P<<1];\nconst int G=3;\nvoid initntt(int n){\n\tlim=1;while(lim<n)lim<<=1;\n\tfor(int i=0;i<lim;i++)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)*(lim>>1));\n}\nvoid ntt(int*a,int ty=1){\n\tfor(int i=0;i<lim;i++)if(r[i]<=i)swap(a[i],a[r[i]]);\n\tint x,y;\n\tfor(int i=1;i<lim;i<<=1){\n\t\tint o=gsc(ty==1?G:inv(G),mod/(i*2)),x,y;\n\t\tfor(int j=0;j<lim;j+=i<<1)\n\t\t\tfor(int k=0,w=1;k<i;k++,w=w*o%mod)\n\t\t\t\tx=a[j+k],y=a[j+k+i]*w,a[j+k]=(x+y)%mod,a[j+k+i]=(x-y)%mod;\n\t}\n\tif(ty==-1){\n\t\tint iv=inv(lim);\n\t\tfor(int i=0;i<lim;i++)a[i]=(a[i]*iv%mod+mod)%mod;\n\t}\n}\n\nint n,x,y,z;\nint py[M];\nint a[P<<1],b[P<<1],c[P<<1];\n\nint c2(int k){int res=0;while(k)res++,k-=k&-k;return res;}\nint c3(int k){int res=0;while(k)res+=k%3,k/=3;return res;}\n\nint calc(int k){\n\treturn gsc(x,k)*gsc(y,c2(k))%mod*gsc(z,c3(k))%mod;\n}\n\nint res=0;\n\nvoid solve(){\n\tcin>>n>>x>>y>>z;\n\tfor(int i=n/N*N;i<=n;i++)res+=calc(i);//\u4e3a\u4e86\u65b9\u4fbf\uff0c\u628a\u96f6\u6563\u7684\u90e8\u5206\u66b4\u529b\u7b97\u597d\n\tpy[0]=1;for(int i=1;i<M;i++)py[i]=py[i-(i&-i)]*y%mod;\n\tn=n/N;res-=!!n;//\u4f1a\u7edf\u8ba1\u5230 0\uff0c\u624b\u52a8\u6263\u6389\n\tint X=1,_x=gsc(x,N),iz=inv(z);\n\tfor(int i=0;i<N;i++)add(a[i],gsc(x,i)*gsc(z,c3(i)));\n\tfor(int i=0;i<n;i++){\n\t\tint t=i*N;\n\t\tadd(b[t&(P-1)],X*py[t/P]);//\u9884\u8bbe\u4f4e\u4f4d\u4e0d\u8fdb\u4f4d\n\t\tadd(c[t&(P-1)],X*py[t/P+1]);//\u9884\u8bbe\u4f4e\u4f4d\u8fdb\u4f4d\n\t\tX=X*_x%mod*z%mod;\n\t\tfor(int j=i+1;j%3==0;j/=3)X=X*iz%mod*iz%mod;//\u7ebf\u6027\u5730\u7ef4\u62a4 x^t * z^b(i)\n\t}\n\tinitntt(P<<1);\n\tntt(a,1),ntt(b,1),ntt(c,1);\n\tfor(int i=0;i<lim;i++){\n\t\tb[i]=b[i]*a[i]%mod;\n\t\tc[i]=c[i]*a[i]%mod;\n\t}\n\tntt(b,-1),ntt(c,-1);\n\tfor(int i=0;i<P;i++){\n\t\tres+=b[i]*gsc(y,c2(i))%mod;//\u6ca1\u8fdb\u4f4d\u7684\u7528 b \u7b97\n\t\tres+=c[i+P]*gsc(y,c2(i))%mod;//\u8fdb\u4f4d\u7684\u7528 c \u7b97\n\t}\n\tcout<<(res%mod+mod)%mod<<endl;\n}\n\nmain(){\n\tios::sync_with_stdio(0);\n\tsolve();\n}\n\n```",
        "postTime": 1653810792,
        "uid": 79067,
        "name": "dottle",
        "ccfLevel": 10,
        "title": "8350"
    },
    {
        "content": "\u6765\u63cf\u8ff0\u4e00\u4e0b EI \u505a\u6cd5\u3002\u5982\u6709\u610f\u4f1a\u9519\u8bef\u4e4b\u5904\uff0c\u671b\u6d77\u6db5\u3002\n\n\u4e0d\u59a8\u5c06\u9898\u9762\u4e2d\u7684 $1\\le i\\le n$ \u6539\u4e3a $0\\le i\\le n$\u3002\n\n\u4e3a\u63cf\u8ff0\u65b9\u4fbf\uff0c\u63d0\u524d\u58f0\u660e\u6700\u7ec8\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\sqrt n)$\u3002\n\n\u5e76\u8bbe\u4e8c\u9608\u503c $B_1=2^{c_1},B_2=3^{c_2}$ \u4f7f $c_1,c_2\\in \\mathbf{N}^*,B_1=\\Theta(\\sqrt n),B_2=\\Theta(\\sqrt n)$\u3002\n\n\u5bf9\u4e8e\u539f\u9898\u9762\u4e2d\u7684 $i$\uff0c\u5206\u522b\u679a\u4e3e\u5176\u5728\u4e24\u4e2a\u8fdb\u5236\u4e0b\u7684\u4f4e\u4f4d\u3001\u9ad8\u4f4d\uff0c\u5c06\u6240\u6c42\u8f6c\u5199\u4e3a\u5982\u4e0b\u548c\u5f0f\uff1a\n$$\\sum_{i_1+B_1j_1=i_2+B_2j_2}a_1(i_1)a_2(j_1)b_1(i_2)b_2(j_2)$$\n\u5176\u4e2d $0\\le i_1<B_1,0\\le i_2<B_2$ \u4e3a\u6240\u679a\u4e3e\u4f4e\u4f4d\u3002\n\n\u800c$a_1(i)=a_2(i)=y^{a(i)},b_1(i)=x^iz^{b(i)},b_2(i)=x^{iB_2}z^{b(i)}$\u3002\n\n\u4e3a\u4f7f\u6c42\u548c\u4e0d\u8d85\u8fc7\u9898\u9762\u6240\u8ff0\u4e0a\u754c $n$\uff0c\u53ef\u8003\u8651\u5bf9 $j_1$ \u4f5c\u9650\u5236 $0\\le j_1<\\left\\lfloor\\frac{n}{B_1}\\right\\rfloor$\u3002\u6b64\u65f6 $i_1+B_1j_1$ \u4f1a\u6070\u53d6\u904d $[0,\\left\\lfloor\\frac{n}{B_1}\\right\\rfloor B_1)$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u3002\u56e0\u6b64\u82e5\u5728\u6b64\u6761\u4ef6\u4e0b\u8ba1\u7b97\u51fa\u4e0a\u8ff0\u548c\u5f0f\uff0c\u5219\u6211\u4eec\u53ea\u9700\u679a\u4e3e\u5269\u4f59\u4e0d\u8d85\u8fc7 $B_1$ \u9879\u5373\u53ef\u5f97\u5230\u6700\u7ec8\u7b54\u6848\u3002\n\n\u8ba1\u7b97\u548c\u5f0f\u7684\u5173\u952e\u5728\u4e8e\u5c06\u548c\u5f0f\u4e2d\u7684\u9650\u5236\u79fb\u9879\u4e3a\uff1a\n$$i_1-i_2=B_2j_2-B_1j_1$$\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5206\u522b\u8ba1\u7b97\n$$f_n=\\sum_{i_1-i_2=n}a_1(i_1)b_1(i_2)$$\n$$g_n=\\sum_{B_2j_2-B_1j_1=n}a_2(j_1)b_2(j_2)$$\n\u800c $-B_2<i_1-i_2<B_1$\u3002\u56e0\u6b64\u5206\u522b\u8ba1\u7b97\u4e24\u6570\u5217\u4e0b\u6807\u5728**\u6b64\u533a\u95f4**\u5185\u7684\u503c\u5373\u53ef\u3002\n\n\u5148\u8003\u8651\u7b97 $g$\u3002\u5148\u679a\u4e3e $j_2$\uff0c\u5219\u7531\u4e8e $B_1,B_2$ \u540c\u9636\uff0c\u4f7f $B_2j_2-B_1j_1$ \u843d\u5728**\u6b64\u533a\u95f4**\u5185\u7684 $j_1$ \u4ec5\u6709 $O(1)$ \u4e2a\uff0c\u56e0\u6b64\u66b4\u529b\u679a\u4e3e\u5373\u53ef\u505a\u5230 $O(\\sqrt n)$ \u7684\u590d\u6742\u5ea6\u3002\n\n\u81f3\u4e8e\u7b97 $f$\uff0c\u53ef\u4ee5\u8003\u8651\u9010\u4f4d\u500d\u589e\u8ba1\u7b97\uff1a\u8bbe\u6211\u4eec\u5f53\u524d\u8ba1\u7b97\u51fa\u7684 $f$ \u662f\u5728 $0\\le i_1<2^{d_1},0\\le i_2<3^{d_2}$ \u7684\u9650\u5236\u4e0b\uff0c\u6b32\u5c06\u4e4b\u500d\u589e\u81f3 $0\\le i_1<2^{d_1+1}$\u3002\u7531\u4e8e\u51fd\u6570 $a_1$ \u5177\u6709\u826f\u597d\u7684\u6309\u4f4d\u72ec\u7acb\u6027\u8d28\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u9012\u63a8\u5f0f\uff1a\n$$f'_n=f_n+a_1(2^{d_1})\\times f_{n-2^{d_1}}$$\n\u5c06 $3^{d_2}$ \u500d\u589e\u81f3 $3^{d_2+1}$ \u65b9\u6cd5\u7c7b\u4f3c\u3002\u6bcf\u6b21\u53d6 $2^{d_1}$ \u4e0e $3^{d_2}$ \u4e4b\u8f83\u5c0f\u8005\u500d\u589e\uff0c\u53ef\u4fdd\u6301 $2^{d_1}$ \u4e0e $3^{d_2}$ \u540c\u9636\uff0c\u800c\u4f7f\u603b\u590d\u6742\u5ea6\u505a\u5230 $O(\\sqrt n)$\u3002\n\n\u6ce8\u610f\u5728\u8ba1\u7b97 $a_1$ \u7b49\u51fd\u6570\u65f6\uff0c\u4e0d\u8981\u7531\u4e8e\u5feb\u901f\u5e42\u6216\u6c42\u5404\u6570\u4f4d\u4e4b\u548c\u800c\u4f7f\u590d\u6742\u5ea6\u591a\u5e26 $\\log$\uff0c\u5177\u4f53\u5b9e\u73b0\u53ef\u89c1\u4ee3\u7801\u3002\u7531\u4e8e\u7b97\u6cd5\u5e38\u6570\u5f88\u5c0f\uff0c\u76ee\u524d\u662f\u6700\u4f18\u89e3\u3002\n```cpp\n#include<cstdio>\n#include<numeric>\n#include<cassert>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<vector>\n#include<cstdlib>\nusing namespace std;\n\nint read();\ntypedef long long ll;\n#define fr(i,l,r) for(int i=(l);i<=(r);++i)\n#define rf(i,l,r) for(int i=(l);i>=(r);--i)\n#define fo(i,l,r) for(int i=(l);i<(r);++i)\n#define foredge(i,u,v) for(int i=fir[u],v;v=to[i],i;i=nxt[i])\n#define filein(File) freopen(File\".in\",\"r\",stdin)\n#define fileout(File) freopen(File\".out\",\"w\",stdout)\n\nconst int N1=(1<<22)+5,N2=4782969+5,MOD=998244353;\nll qpow(ll a,int x) {\n\tll z=1;\n\tfor(;x;x>>=1,a=a*a%MOD)\n\t\tif(x&1) z=z*a%MOD;\n\treturn z;\n}\nll n,lim1,lim2,B1,B2;\nint x,y,z,s1,s2,c1,c2;\nll f[N1+N2],g[N1+N2],tf[N1+N2];\nvoid calcf() {\n\tll len1=1,len2=1;\n\tf[N2]=1;\n\twhile(len1<B1||len2<B2) if(len1<len2) {\n\t\trf(i,len1-1,-len2+1) (f[i+len1+N2]+=f[i+N2]*y)%=MOD;\n\t\tlen1*=2;\n\t} else {\n\t\tll val=qpow(x,len2)*z%MOD;\n\t\tfr(i,-len2+1,len1-1) {\n\t\t\tll tmp=f[i+N2]*val%MOD;\n\t\t\t(f[i-len2+N2]+=tmp)%=MOD;\n\t\t\t(f[i-len2*2+N2]+=tmp*val)%=MOD;\n\t\t}\n\t\tlen2*=3;\n\t}\n}\nint d2[50],d3[30],cnt2,cnt3;\nvoid init(ll x) {\n\tcnt2=cnt3=0; ll i;\n\ti=x; fo(j,0,44) cnt2+=d2[j]=i%2,i/=2;\n\ti=x; fo(j,0,28) cnt3+=d3[j]=i%3,i/=3;\n}\nvoid inc() {\n\t++d2[0]; ++d3[0]; ++cnt2; ++cnt3;\n\tfo(j,0,44) if(d2[j]>=2) d2[j]=0,++d2[j+1],cnt2-=1;\n\telse break;\n\tfo(j,0,28) if(d3[j]>=3) d3[j]=0,++d3[j+1],cnt3-=2;\n\telse break;\n}\nstatic ll pw2[50],pw3[60];\nvoid calcg() {\n\tinit(0);\n\tll xB2=qpow(x,B2),xi=1;\n\tfor(ll i=0;i<lim2;++i) {\n\t\tfor(ll j=i*B2/B1;j<lim1&&i*B2-j*B1>-B2;++j)\n\t\t\t(g[i*B2-j*B1+N2]+=xi*pw3[cnt3]%MOD*pw2[__builtin_popcountll(j)])%=MOD;\n\t\txi=xi*xB2%MOD;\n\t\tinc();\n\t}\n}\n\n\nint main() {\n\tcin>>n>>x>>y>>z;\n\t*pw2=1; fr(i,1,45) pw2[i]=pw2[i-1]*y%MOD;\n\t*pw3=1; fr(i,1,56) pw3[i]=pw3[i-1]*z%MOD;\n\tfor(ll p1=1;p1<n;p1*=2) ++s1;\n\tfor(ll p2=1;p2<n;p2*=3) ++s2;\n\tc1=s1+1>>1,c2=s2+1>>1;\n\tB1=1; fr(i,1,c1) B1*=2;\n\tB2=1; fr(i,1,c2) B2*=3;\n\n\tlim1=n/B1; lim2=n/B2;\n\tcalcf(); calcg();\n\tll ans=0;\n\tfr(i,-B2+1,B1-1) (ans+=f[i+N2]*g[i+N2])%=MOD;\n\tll lim=min(lim1*B1,lim2*B2);\n\tinit(lim);\n\tll pw=qpow(x,lim%(MOD-1));\n\tfor(ll i=lim;i<=n;++i) {\n\t\t(ans+=pw*pw2[cnt2]%MOD*pw3[cnt3])%=MOD;\n\t\tpw=pw*x%MOD; inc();\n\t}\n\tprintf(\"%lld\\n\",(ans-1+MOD)%MOD);\n\treturn 0;\n}\n\nconst int S=1<<21;\nchar p0[S],*p1,*p2;\n#define getchar() (p2==p1&&(p2=(p1=p0)+fread(p0,1,S,stdin))==p1?EOF:*p1++)\ninline int read() {\n\tstatic int x,c,f;x=0;f=1;\n\tdo c=getchar(),c=='-'&&(f=-1); while(!isdigit(c));\n\tdo x=x*10+(c&15),c=getchar(); while(isdigit(c));\n\treturn x*f;\n}\n```",
        "postTime": 1655819834,
        "uid": 89645,
        "name": "\u7384\u71d5\u672c\u71d5",
        "ccfLevel": 10,
        "title": "\u3010\u9898\u89e3\u3011P8350 [SDOI/SXOI2022] \u8fdb\u5236\u8f6c\u6362"
    },
    {
        "content": "#### \u9898\u89e3\r\n\r\n\u8003\u8651\u62c6\u4f4d\u8ba1\u7b97\u8d21\u732e\uff0c\u6309 $3^B$ \u5c06 $m=1 \\sim n$ \u62c6\u4e3a $m=i+j\\times 3^B$\uff0c\u5219 $m$ \u7684\u8d21\u732e\u4e3a $x^my^{a(m)}z^{b(i)+b(j)}$\u3002\u5bf9\u4e8e $i,j$\uff0c\u53ef\u4ee5\u9650\u5236 $i\\in[0,3^B),j\\in[0,\\frac{n}{3^B})$\uff0c\u7136\u540e\u66b4\u529b\u8ba1\u7b97 $[\\lfloor\\frac{n}{3^B}\\rfloor]\\times 3^B,n]$ \u8303\u56f4\u5185\u7684\u8d21\u732e\u3002\r\n\r\n\u5bb9\u6613\u53d1\u73b0\u4e0a\u5f0f\u662f\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f\u7684\u5f0f\u5b50\uff0c\u95ee\u9898\u5728\u4e8e $m$ \u7684\u8303\u56f4\u4ecd\u7136\u662f $[0,n]$ \u65e0\u6cd5\u5904\u7406\u3002\u8003\u8651\u8ba1\u7b97\u7b54\u6848\u7684\u8fc7\u7a0b\uff0c$x^m$ \u53ef\u4ee5\u62c6\u4e3a $x^i\\times x^{j\\times 3^B}$\uff0c\u53ea\u6709 $y^{a(m)}$ \u8fd8\u65e0\u6cd5\u5feb\u901f\u8ba1\u7b97\u3002\u7531\u4e8e $a(m)=a(\\lfloor \\frac{m}{2^S}\\rfloor)+a(m \\bmod {2^S})$\uff0c\u524d\u4e00\u90e8\u5206\u53ea\u9700\u8981\u8003\u8651\u662f\u5426\u8fdb\u4f4d\uff0c\u540e\u4e00\u90e8\u5206\u53ef\u4ee5\u66b4\u529b\u5faa\u73af\u5377\u79ef\u3002\u56e0\u6b64\u5bf9 $i$ \u4e0e $j\\times 3^B$ \u505a\u4e00\u6b21 $\\operatorname{mod} 2^S$ \u610f\u4e49\u4e0b\u7684\u5faa\u73af\u5377\u79ef\u5373\u53ef\u3002\u5b9e\u9645\u4e0a\u53ef\u4ee5\u901a\u8fc7 $\\operatorname{mod} 2^{S+1}$ \u610f\u4e49\u4e0b\u7684\u5faa\u73af\u5377\u79ef\u540c\u65f6\u8ba1\u7b97\u8fdb\u4f4d\u7684\u7b54\u6848\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(B+\\frac{n}{B}+S2^S)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(2^S)$\uff0c\u5177\u4f53\u5b9e\u73b0\u65f6\u53ef\u4ee5\u53d6 $B=13,S=21$\u3002\r\n\r\n#### \u4ee3\u7801\r\n\r\n```cpp\r\n#include <bits/stdc++.h>\r\nconst int mod = 998244353;\r\nstruct Power\r\n{\r\n\tint x, BS[(1 << 15) + 1], GS[(1 << 15) + 1];\r\n\tinline int operator [] (long long x) {x %= mod - 1; return 1LL * GS[x >> 15] * BS[x & ((1 << 15) - 1)] % mod;}\r\n\tinline void init (int w)\r\n\t{\r\n\t\tBS[0] = 1; for (int i = 1; i <= (1 << 15); i++) BS[i] = 1LL * BS[i - 1] * w % mod;\r\n\t\tGS[0] = 1; for (int i = 1; i <= (1 << 15); i++) GS[i] = 1LL * GS[i - 1] * BS[1 << 15] % mod;\r\n\t}\r\n} powx, powy, powz;\r\nstruct Bit {inline int operator [] (int x) {return __builtin_popcount(x);}} bit2;\r\nconst int S = 1 << 21, L = 21, B = 1594323, t = 1 << 22;\r\nlong long n; int x, y, z, ans, bit3[1 << 24], f[1 << 22], g[1 << 22], rev[1 << 22];\r\ninline int power (int x, int y)\r\n{\r\n\tint z = 1;\r\n\tfor (; y; y >>= 1, x = 1LL * x * x % mod) if (y & 1) z = 1LL * z * x % mod;\r\n\treturn z;\r\n}\r\ninline void NTT (int *a, int f)\r\n{\r\n\tfor (int i = 0; i < t; i++) if (i < rev[i]) std::swap(a[i], a[rev[i]]);\r\n\tfor (int i = 2; i <= t; i <<= 1)\r\n\t{\r\n\t\tint wn = power(~f ? 3 : 332748118, (mod - 1) / i);\r\n\t\tfor (int j = 0; j < t; j += i) for (int k = 0, w = 1; k < i / 2; k++, w = 1LL * w * wn % mod)\r\n\t\t{\r\n\t\t\tint x = a[j + k], y = 1LL * w * a[j + k + i / 2] % mod;\r\n\t\t\ta[j + k] = (x + y) % mod; a[j + k + i / 2] = (x - y + mod) % mod;\r\n\t\t}\r\n\t}\r\n\tif (!~f) for (int i = 0, invt = power(t, mod - 2); i < t; i++) a[i] = 1LL * a[i] * invt % mod;\r\n}\r\nsigned main()\r\n{\r\n\tstd::cin >> n >> x >> y >> z; powx.init(x); powy.init(y); powz.init(z);\r\n\tfor (int i = 0; i < t; i++) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) ? (t >> 1) : 0);\r\n\tfor (int i = 1; i < (1 << 24); i++) bit3[i] = bit3[i / 3] + i % 3;\r\n\tfor (int i = 0; i < B; i++) f[i] = 1LL * powx[i] * powz[bit3[i]] % mod;\r\n\tfor (int i = 0; i < n / B; i++)\r\n\t{\r\n\t\tlong long w = 1LL * i * B; int w0 = w & (S - 1), w1 = w >> L;\r\n\t\tg[w0] = (g[w0] + 1LL * powx[w] * powy[bit2[w1]] % mod * powz[bit3[i]]) % mod;\r\n\t\tg[w0 + S] = (g[w0 + S] + 1LL * powx[w] * powy[bit2[w1 + 1]] % mod * powz[bit3[i]]) % mod;\r\n\t}\r\n\tNTT(f, 1); NTT(g, 1);\r\n\tfor (int i = 0; i < t; i++) f[i] = 1LL * f[i] * g[i] % mod;\r\n\tNTT(f, -1);\r\n\tfor (int i = 0; i < S; i++) ans = (ans + 1LL * f[i] * powy[bit2[i]]) % mod;\r\n\tfor (long long i = n / B * B; i <= n; i++)\r\n\t\tans = (ans + 1LL * powx[i] * powy[bit2[i & (S - 1)] + bit2[i >> L]] % mod * powz[bit3[i / B] + bit3[i % B]]) % mod;\r\n\tstd::cout << (ans - 1 + mod) % mod << std::endl;\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1661749986,
        "uid": 46197,
        "name": "_RSY_",
        "ccfLevel": 10,
        "title": "\u3010\u9898\u89e3\u3011P8350"
    },
    {
        "content": "\u6211\u4eec\u53ea\u8003\u8651\u5f53\u524d\u6570\u5b57\u7684\u7684\u4e8c\u8fdb\u5236\u4f4e w1 \u4f4d\u548c\u4e09\u8fdb\u5236\u4f4e w2 \u4f4d\uff0c\u7528\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(a,b)$ \u8868\u793a\uff0c\u5176\u4e2d $0\\le a<2^{w1},0\\le b<3^{w2}$\u3002\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u4e8c\u5143\u7ec4\u662f\u597d\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53 $a$ \u548c $b$ \u4e4b\u4e2d\u6709\u4e00\u4e2a\u662f $0$\u3002\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u6b21 $+1$ \u64cd\u4f5c\u4f1a\u8ba9 $(a,b)$ \u53d8\u6210 $((a+1)\\bmod 2^{w1},(b+1)\\bmod 3^{w2})$\u3002\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u597d\u7684\u4e8c\u5143\u7ec4\u7684\u540e\u7ee7\u4e8c\u5143\u7ec4\u4e3a\u91cd\u590d\u6267\u884c $+1$ \u64cd\u4f5c\u76f4\u5230\u7b2c\u4e00\u6b21\u53d8\u6210\u597d\u7684\u4e8c\u5143\u7ec4\u65f6\u7684\u4e8c\u5143\u7ec4\uff0c\u5e76\u8bb0\u5f55\u7ecf\u8fc7\u7684\u4e8c\u5143\u7ec4\u7684\u6743\u503c\u548c\u3002\n\n\u6211\u4eec\u627e\u4e00\u5bf9\u5408\u9002\u7684 $w1,w2$ \u4f7f\u5f97 $2^{w1}$ \u548c $3^{w2}$ \u8fd1\u53ef\u80fd\u63a5\u8fd1 $\\sqrt n$\uff0c\u7136\u540e\u4e0d\u505c\u8df3\u540e\u7ee7\u4e8c\u5143\u7ec4\uff0c\u6bcf\u6b21\u76f4\u63a5\u628a\u4e24\u4e2a\u597d\u7684\u4e8c\u5143\u7ec4\u4e4b\u95f4\u7684\u4e8c\u5143\u7ec4\u7684\u8d21\u732e\u7b97\u5165\u7b54\u6848\uff0c\u8df3\u7684\u8fc7\u7a0b\u4e2d\u9ad8\u4f4d\u7684\u8d21\u732e\u4e0d\u53d8\uff0c\u4f4e\u4f4d\u7684\u8d21\u732e\u5df2\u7ecf\u9884\u5904\u7406\uff0c\u8df3\u4e00\u6b21\u590d\u6742\u5ea6\u662f $O(1)$ \u7684\uff0c\u603b\u5171\u8df3 $O(\\sqrt n)$ \u6b21\u3002\n\n\u73b0\u5728\u95ee\u9898\u5728\u4e0e\u600e\u4e48\u627e\u540e\u7ee7\u4e8c\u5143\u7ec4\u548c\u7b97\u7ecf\u8fc7\u7684\u4e8c\u5143\u7ec4\u7684\u6743\u503c\u548c\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u4e2a $w1,w2$\uff0c\u597d\u7684\u4e8c\u5143\u7ec4\u6570\u91cf\u662f $2^{w1}+3^{w2}-1$\uff0c \u56e0\u4e3a $a$ \u548c $b$ \u4e2d\u6709\u4e00\u4e2a\u662f $0$\u3002\n\n\u9014\u5f84\u7684\u4e8c\u5143\u7ec4\u7684\u8d21\u732e\u4e0d\u80fd\u66b4\u529b\u7b97\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u7684\u4ece $w1-1,w2$ \u6216\u8005 $w1,w2-1$ \u5f97\u5230\uff0c\u6211\u4eec\u6bcf\u6b21\u53d6 $2^{w1}$ \u548c $3^{w2}$ \u4e2d\u5927\u7684\u90a3\u4e2a\u5c06\u6307\u6570\u51cf\u53bb $1$\uff0c\u9012\u5f52\u7b97\u3002\n\n\u603b\u7684\u590d\u6742\u5ea6\u5dee\u4e0d\u591a\u662f $O(\\sqrt n)$\n\n```cpp\n#include<bits/stdc++.h>\n#ifdef xay5421\n#define D(...) fprintf(stderr,__VA_ARGS__)\n#define DD(...) D(#__VA_ARGS__ \"=\"),debug_helper::debug(__VA_ARGS__),D(\"\\n\")\n#include\"/home/xay5421/debug.hpp\"\n#else\n#define D(...) ((void)0)\n#define DD(...) ((void)0)\n#endif\n#define pb push_back\n#define eb emplace_back\n#define SZ(x) ((int)(x).size())\n#define each(x,v) for(auto&x:v)\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define per(i,a,b) for(int i=(a);i>=(b);--i)\ntemplate<class T>void rd(T&x){int f=0,c;while(!isdigit(c=getchar()))f^=!(c^45);x=(c&15);while(isdigit(c=getchar()))x=x*10+(c&15);if(f)x=-x;}\ntemplate<class T>void pt(T x,int c=-1){if(x<0)putchar('-'),x=-x;if(x>9)pt(x/10);putchar(x%10+48);if(c!=-1)putchar(c);}\nusing namespace std;\nusing LL=long long;\nusing ULL=unsigned long long;\nconst int P=998244353;\nint ad(int k1,int k2){return k1+=k2-P,k1+=k1>>31&P;}\nint su(int k1,int k2){return k1-=k2,k1+=k1>>31&P;}\nint mu(int k1,int k2){return 1LL*k1*k2%P;}\nvoid uad(int&k1,int k2){k1+=k2-P,k1+=k1>>31&P;}\nvoid usu(int&k1,int k2){k1-=k2,k1+=k1>>31&P;}\ntemplate<class... T>int ad(int k1,T... k2){return ad(k1,ad(k2...));}\ntemplate<class... T>int su(int k1,T... k2){return su(k1,ad(k2...));}\ntemplate<class... T>int mu(int k1,T... k2){return mu(k1,mu(k2...));}\ntemplate<class... T>void uad(int&k1,T... k2){return uad(k1,ad(k2...));}\ntemplate<class... T>void usu(int&k1,T... k2){return usu(k1,ad(k2...));}\nint po(int k1,int k2){\n\tint k3=1;\n\tfor(;k2;k2>>=1,k1=mu(k1,k1))if(k2&1)k3=mu(k3,k1);\n\treturn k3;\n}\nconst int N=5000005;\nLL n;\nint x,y,z;\nLL pw2[50],pw3[30];\nint pwx[N],pwy[50],pwz[60],cnt3[4782969];\ninline int calc2(LL x){\n\treturn __builtin_popcountll(x);\n}\ninline int calc3(LL x){\n\treturn cnt3[x%4782969]+cnt3[x/4782969];\n}\nint get_sz(int w1,int w2){\n\treturn pw2[w1]+pw3[w2]-1;\n}\nint get_id(int w1,int w2,int x,int y){\n\tassert(x==0||y==0);\n\tassert(x<pw2[w1]);\n\tassert(y<pw3[w2]);\n\tif(x==0)return y;\n\treturn pw3[w2]+x-1;\n}\nvoid get_xy(int w1,int w2,int id,int&x,int&y){\n\tif(id<pw3[w2])x=0,y=id;\n\telse x=id-pw3[w2]+1,y=0;\n}\nvector<pair<int,int> >sol(int w1,int w2){ // 2:[0,2^{w1}) 3:[0,3^{w2})\n\tDD(w1,w2);\n\tif(w1==1&&w2==1){\n\t\tvector<pair<int,int> >ret(get_sz(w1,w2));\n\t\trep(u,0,pw2[w1]-1){\n\t\t\trep(v,0,pw3[w2]-1){\n\t\t\t\tif(u&&v)break;\n\t\t\t\tint u_=u,v_=v,step=0,sum=0;\n\t\t\t\twhile(1){\n\t\t\t\t\tuad(sum,mu(pwx[step++],pwy[calc2(u_)],pwz[calc3(v_)]));\n\t\t\t\t\t++u_,++v_;\n\t\t\t\t\tif(u_==pw2[w1]||v_==pw3[w2])break;\n\t\t\t\t}\n\t\t\t\tif(u_==pw2[w1])u_=0;\n\t\t\t\tif(v_==pw3[w2])v_=0;\n\t\t\t\tret[get_id(w1,w2,u,v)]=make_pair(get_id(w1,w2,u_,v_),sum);\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\tif(pw2[w1]>pw3[w2]){\n\t\tvector<pair<int,int> >ret(get_sz(w1,w2));\n\t\tvector<pair<int,int> >old(sol(w1-1,w2));\n\t\tDD(w1,w2);\n\t\trep(u,0,pw2[w1]-1){\n\t\t\trep(v,0,pw3[w2]-1){\n\t\t\t\tif(u&&v)break;\n\t\t\t\tint u_=u,v_=v,step=0,sum=0;\n\t\t\t\twhile(1){\n\t\t\t\t\tint cur=get_id(w1-1,w2,u_%pw2[w1-1],v_);\n\t\t\t\t\tint nex=old[cur].first;\n\t\t\t\t\tint u__,v__;\n\t\t\t\t\tget_xy(w1-1,w2,nex,u__,v__);\n\t\t\t\t\t\n\t\t\t\t\tuad(sum,mu(pwx[step],pwy[u_/pw2[w1-1]&1],old[cur].second));\n\t\t\t\t\t\n\t\t\t\t\tif(u__==0){\n\t\t\t\t\t\tstep+=pw2[w1-1]-(u_%pw2[w1-1]);\n\t\t\t\t\t\tu_+=pw2[w1-1]-(u_%pw2[w1-1]);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tstep+=u__-(u_%pw2[w1-1]);\n\t\t\t\t\t\tu_+=u__-(u_%pw2[w1-1]);\n\t\t\t\t\t}\n\t\t\t\t\tif(v__==0){\n\t\t\t\t\t\tret[get_id(w1,w2,u,v)]=make_pair(get_id(w1,w2,u_%pw2[w1],0),sum);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tv_=v__;\n\t\t\t\t\tif(u_==pw2[w1]){\n\t\t\t\t\t\tret[get_id(w1,w2,u,v)]=make_pair(get_id(w1,w2,0,v_),sum);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}else{\n\t\tvector<pair<int,int> >ret(get_sz(w1,w2));\n\t\tvector<pair<int,int> >old(sol(w1,w2-1));\n\t\tDD(w1,w2);\n\t\trep(u,0,pw2[w1]-1){\n\t\t\trep(v,0,pw3[w2]-1){\n\t\t\t\tif(u&&v)break;\n\t\t\t\tint u_=u,v_=v,step=0,sum=0;\n\t\t\t\twhile(1){\n\t\t\t\t\tint cur=get_id(w1,w2-1,u_,v_%pw3[w2-1]);\n\t\t\t\t\tint nex=old[cur].first;\n\t\t\t\t\tint u__,v__;\n\t\t\t\t\tget_xy(w1,w2-1,nex,u__,v__);\n\t\t\t\t\t\n\t\t\t\t\tuad(sum,mu(pwx[step],pwz[v_/pw3[w2-1]%3],old[cur].second));\n\t\t\t\t\t\n\t\t\t\t\tif(v__==0){\n\t\t\t\t\t\tstep+=pw3[w2-1]-(v_%pw3[w2-1]);\n\t\t\t\t\t\tv_+=pw3[w2-1]-(v_%pw3[w2-1]);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tstep+=v__-(v_%pw3[w2-1]);\n\t\t\t\t\t\tv_+=v__-(v_%pw3[w2-1]);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(u__==0){\n\t\t\t\t\t\tret[get_id(w1,w2,u,v)]=make_pair(get_id(w1,w2,0,v_%pw3[w2]),sum);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tu_=u__;\n\t\t\t\t\tif(v_==pw3[w2]){\n\t\t\t\t\t\tret[get_id(w1,w2,u,v)]=make_pair(get_id(w1,w2,u_,0),sum);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n}\nint main(){\n#ifdef xay5421\n\tfreopen(\"a.in\",\"r\",stdin);\n#endif\n\trep(i,1,4782968){\n\t\tcnt3[i]=cnt3[i/3]+i%3;\n\t}\n\tpw2[0]=1;\n\trep(i,1,49)pw2[i]=pw2[i-1]+pw2[i-1];\n\tpw3[0]=1;\n\trep(i,1,29)pw3[i]=pw3[i-1]*3;\n\trd(n),rd(x),rd(y),rd(z);\n\tpwx[0]=1;\n\trep(i,1,N-1)pwx[i]=mu(pwx[i-1],x);\n\tpwy[0]=1;\n\trep(i,1,49)pwy[i]=mu(pwy[i-1],y);\n\tpwz[0]=1;\n\trep(i,1,59)pwz[i]=mu(pwz[i-1],z);\n\tconst int w1=21,w2=13;\n\tvector<pair<int,int> >ret(sol(w1,w2));\n\tLL val=0;\n\tint base=1;\n\tint ans=P-1;\n\twhile(1){\n\t\tint u=val%pw2[w1];\n\t\tint v=val%pw3[w2];\n\t\tpair<int,int>now=ret[get_id(w1,w2,u,v)];\n\t\tint u_,v_;\n\t\tget_xy(w1,w2,now.first,u_,v_);\n\t\tLL val_;\n\t\tif(u_==0){\n\t\t\tval_=val+pw2[w1]-u;\n\t\t}else{\n\t\t\tval_=val+u_-u;\n\t\t}\n\t\tif(val_<=n){\n\t\t\tuad(ans,mu(base,now.second,pwy[calc2(val/pw2[w1])],pwz[calc3(val/pw3[w2])]));\n\t\t}else{\n\t\t\twhile(val<=n){\n\t\t\t\tuad(ans,mu(base,pwy[calc2(val)],pwz[calc3(val)]));\n\t\t\t\tbase=mu(base,x);\n\t\t\t\t++val;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tbase=mu(base,pwx[val_-val]);\n\t\tval=val_;\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1652787343,
        "uid": 200001,
        "name": "xay5421",
        "ccfLevel": 10,
        "title": "P8350 [SDOI/SXOI2022] \u8fdb\u5236\u8f6c\u6362 \u9898\u89e3"
    }
]