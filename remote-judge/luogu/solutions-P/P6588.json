[
    {
        "content": "### update on 6.1\n\n\u589e\u52a0\u4e86\u4e00\u79cd\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u611f\u8c22@oswin \u5728\u79c1\u4fe1\u4e2d\u4e3a\u6211\u63d0\u4f9b\u7075\u611f\u3002\n\n------------\n\n\n### \u5b8c\u6210\u8fd9\u9898\u4f60\u9996\u5148\u8981\u77e5\u9053\u7684\uff1a\n\n+ \u7ebf\u6bb5\u6811\n+ \u5411\u91cf\u7684\u57fa\u672c\u8fd0\u7b97\n\n-----------------------\n\n### Subtask 1\uff1a\n\n\u76f4\u63a5\u66b4\u529b\u5373\u53ef\u3002\n\n~~\u4f60\u770b\u51fa\u9898\u4eba\u591a\u826f\u5fc3\u8fd8\u7ed9\u4f6020\u5206\u66b4\u529b\u5206\u3002~~\n\n-------------------\n\n### Subtask 2\uff1a\n\n\u56e0\u4e3a\u5411\u91cf\u7684\u70b9\u4e58\uff08$\\vec{a}\\cdot\\vec{b}$\uff09\u6ee1\u8db3\u4e0b\u9762\u4e24\u6761\u6027\u8d28\uff1a\n\n+ \u4ea4\u6362\u5f8b $\\vec{a}\\cdot\\vec{b}=\\vec{b}\\cdot\\vec{a}$\n+ \u5206\u914d\u5f8b $(\\vec{a}+\\vec{b})\\cdot\\vec{c}=\\vec{a}\\cdot\\vec{c}+\\vec{b}\\cdot\\vec{c}$\n\n\uff08\u4e0a\u9762\u4e24\u6761\u53ef\u4ee5\u81ea\u884c\u62c6\u5f00\u8bc1\u660e\uff0c\u4e0d\u60f3\u8bc1\u7684\u53ef\u4ee5\u81ea\u884c\u767e\u5ea6\uff09\n\n\u8bb0 $\\vec{b_{i,j}}$ \u4e3a\u7b2c $i$ \u4e2a\u5411\u91cf\u5230\u7b2c $j$ \u4e2a\u5411\u91cf\u4e4b\u548c\u3002\n\n\u6240\u4ee5 $\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}=\\dfrac{\\overrightarrow{b_{l,r}}\\cdot\\overrightarrow{b_{l,r}}-\\sum\\limits_{i=l}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_i}}{2}$\n\n\u4e8e\u662f\u5c31\u53d8\u6210\u7ebf\u6bb5\u6811\u88f8\u9898\u4e86\uff08\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\uff09\u3002\n\n---------------------\n\n### Subtask 3\uff1a\n\n\u6709\u4e86 Subtask 2 \u7684\u7ecf\u9a8c\uff0c\u6211\u4eec\u80af\u5b9a\u4f1a\u60f3\u7528\u540c\u6837\u7684\u65b9\u5f0f\u89e3\u51b3 $\\vec{a}\\oplus\\vec{b}$\u3002\n\n\u7136\u800c\u5f88\u4e0d\u5e78\uff0c\u5b83\u867d\u7136\u6ee1\u8db3\u5206\u914d\u5f8b\uff0c\u4f46\u5e76\u4e0d\u6ee1\u8db3\u4ea4\u6362\u5f8b\uff08\u5b9e\u9645\u4e0a $\\vec{a}\\oplus\\vec{b}=-\\vec{b}\\oplus\\vec{a}$\uff09\uff0c\u6240\u4ee5\u5e76\u4e0d\u80fd\u7528\u540c\u6837\u7684\u65b9\u5f0f\u6c42\u5f97\u7b54\u6848\u3002\n\n\u56e0\u4e3a $\\oplus$ \u8fd0\u7b97\u6ee1\u8db3\u5206\u914d\u5f8b\uff0c\u6240\u4ee5\n\n$\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}=\\sum\\limits_{i=l}^r(\\overrightarrow{b_{1,i-1}}-\\overrightarrow{b_{1,l-1}})\\oplus\\overrightarrow{a_i}=\\sum\\limits_{i=l}^r\\overrightarrow{b_{1,i-1}}\\oplus\\overrightarrow{a_i}-\\overrightarrow{b_{1,l-1}}\\oplus\\overrightarrow{b_{l,r}}$\n\n$\\overrightarrow{b_{1,l-1}}\\oplus\\overrightarrow{b_{l,r}}$ \u5bb9\u6613\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c$\\overrightarrow{b_{1,i-1}}\\oplus\\overrightarrow{a_i}$ \u53ef\u4ee5\u5728\u7ebf\u6bb5\u6811\u5355\u70b9\u4fee\u6539\u7684\u540c\u65f6\u8fdb\u884c\u533a\u95f4\u4fee\u6539\u6765\u7ef4\u62a4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)\\log n)$\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ls(w) w<<1\n#define rs(w) (w<<1)^1\nusing namespace std;\nstruct xds{\n\tint l,r,len;\n\tll x,y,f;\n\t//x,y\u5206\u522b\u8868\u793a\u533a\u95f4\u5185\u6240\u6709\u5411\u91cf\u7684x,y\u603b\u548c,f\u8868\u793a\u6240\u6709\u7684x\u7684\u5e73\u65b9\u548cy\u7684\u5e73\u65b9\u7684\u603b\u548c\n\tll qx,qy,xy,yx,bjx,bjy;\n\t//qx,qy\u5206\u522b\u8868\u793a\u533a\u95f4\u5185\u6240\u6709\u7684\u524d\u7f00\u548c\u4e4b\u548c\n\t//bjx\u548cbjy\u4e3a\u6807\u8bb0\n\t//\u56e0\u4e3a\u76f4\u63a5\u7ef4\u62a4\u53c9\u79ef\u4e0d\u597d\u7ef4\u62a4\uff0c\u6240\u4ee5\u5c06\u53c9\u79ef\u5206\u4e3a\u4e24\u90e8\u5206(\u53d8\u91cfxy\u548cyx)\u7ef4\u62a4\uff0c\u76f8\u51cf\u5373\u53ef\u5f97\u5230\u7ed3\u679c\n};//\u770b\u4e0d\u61c2\u5b9a\u4e49\u7684\u5efa\u8bae\u8f6c\u5230\u521d\u59cb\u5316\u51fd\u6570\u8f85\u52a9\u4e86\u89e3\u5404\u53d8\u91cf\u7528\u5904\nxds tree[400005];\nll x[100005],y[100005],qx[100005],qy[100005];\nint n,m;\nll dr()\n{\n\tll xx=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')xx=(xx<<1)+(xx<<3)+ch-'0',ch=getchar();\n\treturn xx*f;\n}\nvoid u(int w)//\u4fe1\u606f\u4e0a\u4f20\n{\n\ttree[w].x=tree[ls(w)].x+tree[rs(w)].x,tree[w].y=tree[ls(w)].y+tree[rs(w)].y,tree[w].f=tree[ls(w)].f+tree[rs(w)].f;\n\ttree[w].xy=tree[ls(w)].xy+tree[rs(w)].xy,tree[w].yx=tree[ls(w)].yx+tree[rs(w)].yx;\n\ttree[w].qx=tree[ls(w)].qx+tree[rs(w)].qx,tree[w].qy=tree[ls(w)].qy+tree[rs(w)].qy;\n}\nvoid d(int w)//\u6807\u8bb0\u4e0b\u4f20\n{//\u6709\u4ebf\u70b9\u70b9\u538b\u884c\u4f46\u5b9e\u9645\u4e0a\u4e00\u884c\u5185\u4fee\u6539\u7684\u4e1c\u897f\u90fd\u662f\u7c7b\u4f3c\u7684\n\ttree[ls(w)].xy+=tree[w].bjx*tree[ls(w)].y,tree[ls(w)].yx+=tree[w].bjy*tree[ls(w)].x,tree[rs(w)].xy+=tree[w].bjx*tree[rs(w)].y,tree[rs(w)].yx+=tree[w].bjy*tree[rs(w)].x;\n\t//xy\u548cyx\u7684\u4fee\u6539\u9700\u8981\u501f\u52a9x\u548cy\u7684\u5177\u4f53\u6570\u503c\n\ttree[ls(w)].qx+=tree[w].bjx*tree[ls(w)].len,tree[ls(w)].qy+=tree[w].bjy*tree[ls(w)].len,tree[rs(w)].qx+=tree[w].bjx*tree[rs(w)].len,tree[rs(w)].qy+=tree[w].bjy*tree[rs(w)].len;\n\ttree[ls(w)].bjx+=tree[w].bjx,tree[ls(w)].bjy+=tree[w].bjy,tree[rs(w)].bjx+=tree[w].bjx,tree[rs(w)].bjy+=tree[w].bjy;\n\ttree[w].bjx=0,tree[w].bjy=0;\n}\nvoid csh(int w,int l,int r)//\u521d\u59cb\u5316\n{//\u8bb2\u9053\u7406\u770b\u8fd9\u90e8\u5206\u66f4\u5bb9\u6613\u7406\u89e3\u5404\u53d8\u91cf\u7684\u7528\u5904\n\ttree[w].l=l,tree[w].r=r,tree[w].len=r-l+1;\n\tif(l==r)\n\t{\n\t\ttree[w].x=x[l],tree[w].y=y[l],tree[w].f=x[l]*x[l]+y[l]*y[l],tree[w].qx=qx[l-1],tree[w].qy=qy[l-1];\n\t\ttree[w].xy=qx[l-1]*y[l],tree[w].yx=qy[l-1]*x[l];\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tcsh(ls(w),l,mid),csh(rs(w),mid+1,r),u(w); \n}\nvoid xg_1(int w,int xh,ll a,ll b)//\u5355\u70b9\u4fee\u6539\n{\n\tif(tree[w].l==tree[w].r)\n\t{//\u7ef4\u62a4qx\u548cqy\u65f6\u4e3a\u4e86\u8fdb\u884c\u5355\u70b9\u4fee\u6539\u65f6\u4fbf\u4e8e\u8ba1\u7b97xy\u548cyx\n\t\ttree[w].x+=a,tree[w].y+=b,tree[w].f=tree[w].x*tree[w].x+tree[w].y*tree[w].y;\n\t\ttree[w].xy+=tree[w].qx*b,tree[w].yx+=tree[w].qy*a;\n\t\treturn;\n\t}\n\td(w);\n\tint mid=(tree[w].l+tree[w].r)>>1;\n\tif(xh<=mid)xg_1(ls(w),xh,a,b);else xg_1(rs(w),xh,a,b);\n\tu(w);\n}\nvoid xg_2(int w,int l,int r,ll a,ll b)//\u533a\u95f4\u4fee\u6539\n{\n\tif(l>r)return;\n\tif(l<=tree[w].l&&tree[w].r<=r)\n\t{\n\t\ttree[w].xy+=a*tree[w].y,tree[w].yx+=b*tree[w].x,tree[w].qx+=tree[w].len*a,tree[w].qy+=tree[w].len*b;\n\t\ttree[w].bjx+=a,tree[w].bjy+=b;\n\t\treturn;\n\t}\n\td(w);\n\tint mid=(tree[w].l+tree[w].r)>>1;\n\tif(l<=mid)xg_2(ls(w),l,r,a,b);\n\tif(mid<r)xg_2(rs(w),l,r,a,b);\n\tu(w);\n}\nll cx_1(int w,int l,int r)//\u67e5\u533a\u95f4x\u603b\u548c\n{\n\tif(l>r)return 0;\n\tif(l<=tree[w].l&&tree[w].r<=r)return tree[w].x;\n\td(w);\n\tint mid=(tree[w].l+tree[w].r)>>1;ll x=0;\n\tif(l<=mid)x+=cx_1(ls(w),l,r);\n\tif(mid<r)x+=cx_1(rs(w),l,r);\n\treturn x;\n}\nll cx_2(int w,int l,int r)//\u4e0ecx_1\u7c7b\u4f3c\uff0c\u67e5y\n{\n\tif(l>r)return 0;\n\tif(l<=tree[w].l&&tree[w].r<=r)return tree[w].y;\n\td(w);\n\tint mid=(tree[w].l+tree[w].r)>>1;ll x=0;\n\tif(l<=mid)x+=cx_2(ls(w),l,r);\n\tif(mid<r)x+=cx_2(rs(w),l,r);\n\treturn x;\n}\nll cx_3(int w,int l,int r)//\u7c7b\u4f3c\uff0c\u67e5f\n{\n\tif(l>r)return 0;\n\tif(l<=tree[w].l&&tree[w].r<=r)return tree[w].f;\n\td(w);\n\tint mid=(tree[w].l+tree[w].r)>>1;ll x=0;\n\tif(l<=mid)x+=cx_3(ls(w),l,r);\n\tif(mid<r)x+=cx_3(rs(w),l,r);\n\treturn x;\n}\nll cx_4(int w,int l,int r)//\u7c7b\u4f3c\uff0c\u67e5xy-yx\n{\n\tif(l>r)return 0;\n\tif(l<=tree[w].l&&tree[w].r<=r)return tree[w].xy-tree[w].yx;\n\td(w);\n\tint mid=(tree[w].l+tree[w].r)>>1;ll x=0;\n\tif(l<=mid)x+=cx_4(ls(w),l,r);\n\tif(mid<r)x+=cx_4(rs(w),l,r);\n\treturn x;\n}\nint main()\n{\n\tn=dr(),m=dr();\n\tfor(int i=1;i<=n;i++)x[i]=dr(),y[i]=dr(),qx[i]=qx[i-1]+x[i],qy[i]=qy[i-1]+y[i];\n\tcsh(1,1,n);\n\twhile(m--)\n\t{\n\t\tint opt=dr();\n\t\tif(opt==1)\n\t\t{\n\t\t\tint i=dr();ll a=dr(),b=dr();\n\t\t\txg_1(1,i,a,b),xg_2(1,i+1,n,a,b),x[i]+=a,y[i]+=b;\n\t\t}\n\t\tif(opt==2)\n\t\t{\n\t\t\tint i=dr();ll a=dr(),b=dr();\n\t\t\txg_1(1,i,-a,-b),xg_2(1,i+1,n,-a,-b),x[i]-=a,y[i]-=b;\n\t\t}\n\t\tif(opt==3)//\u56e0\u4e3a\u76f4\u63a5\u4e58\u4e0d\u597d\u7ef4\u62a4\uff0c\u6240\u4ee5\u8f6c\u5316\u4e3a\u52a0\n\t\t{\n\t\t\tint i=dr();ll a=dr(),c=x[i]*(a-1),d=y[i]*(a-1);\n\t\t\txg_1(1,i,c,d),xg_2(1,i+1,n,c,d),x[i]+=c,y[i]+=d;\n\t\t}\n\t\tif(opt==4)\n\t\t{\n\t\t\tint l=dr(),r=dr();ll xx=cx_1(1,l,r),yy=cx_2(1,l,r);\n\t\t\tprintf(\"%lld\\n\",(xx*xx+yy*yy-cx_3(1,l,r))>>1);\n\t\t}\n\t\tif(opt==5)\n\t\t{\n\t\t\tint l=dr(),r=dr();\n\t\t\tprintf(\"%lld\\n\",cx_4(1,l,r)-cx_1(1,1,l-1)*cx_2(1,l,r)+cx_1(1,l,r)*cx_2(1,1,l-1));\n\t\t}\n\t}\n}\n```\n\n------------\n### update on 6.1\n\n\u5176\u5b9e\u51fa\u9898\u4eba\u7b2c\u4e8c\u79cd\u8fd0\u7b97\u505a\u9ebb\u70e6\u4e86\u3002\n\n\u5047\u8bbe $q$ \u8868\u793a\u7ebf\u6bb5\u6811\u5f53\u524d\u8282\u70b9 $\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}$ \u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fd9\u6837\u7ef4\u62a4\uff1a\n\n```cpp\ntree[w].q=tree[ls(w)].q+tree[rs(w)].q+tree[ls(w)].x*tree[rs(w)].y-tree[rs(w)].x*tree[ls(w)].y\n```\n\n\u8fd9\u6761\u5f0f\u5b50\u4f1a\u66f4\u65b9\u4fbf\u7406\u89e3\u4e00\u4e9b\u3002",
        "postTime": 1583277089,
        "uid": 104581,
        "name": "kkk\u7684\u5c0f\u8214\u72d7",
        "ccfLevel": 8,
        "title": "\u5411\u91cf \u9898\u89e3"
    },
    {
        "content": "# P6588 \u9898\u89e3\n\n\u5efa\u8bae\u5728[\u535a\u5ba2](https://www.luogu.com.cn/blog/453059/solution-p6588)\u91cc\u98df\u7528\uff1a\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P6588)\n\n## \u9898\u76ee\u63cf\u8ff0\n\n\u5c0f L \u6709 $n$ \u4e2a\u5411\u91cf $\\overrightarrow{a_1}, \\overrightarrow{a_2}, \\dots, \\overrightarrow{a_n}$\uff0c\u4ed6\u5e0c\u671b\u4f60\u80fd\u591f\u5e2e\u4ed6\u56de\u7b54\u4e0b\u9762\u4e24\u4e2a\u95ee\u9898\u3002\n\n+ \u5bf9\u4e8e\u7ed9\u5b9a\u7684 $l,r$\uff0c\u6c42\u51fa \n\n$$\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}$$\n\n\n+ \u5bf9\u4e8e\u7ed9\u5b9a\u7684 $l,r$\uff0c\u6c42\u51fa \n\n$$\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}$$\n\n\n\u4e00\u5171\u6709\u4e0b\u9762\u4e94\u79cd\u64cd\u4f5c\u3002\n\n1. \u8f93\u5165\u4e09\u4e2a\u6574\u6570 $i,x,y(1\\leq i\\leq n)$\uff0c\u5c06 $\\overrightarrow{a_i}$ \u52a0\u4e0a $(x,y)$\u3002\n1. \u8f93\u5165\u4e09\u4e2a\u6574\u6570 $i,x,y(1\\leq i\\leq n)$\uff0c\u5c06 $\\overrightarrow{a_i}$ \u51cf\u53bb $(x,y)$\u3002\n1. \u8f93\u5165\u4e24\u4e2a\u6574\u6570 $i,t(1\\leq i\\leq n)$\uff0c\u5c06 $\\overrightarrow{a_i}$ \u4fee\u6539\u4e3a $t\\overrightarrow{a_i}$\u3002\n1. \u8f93\u5165\u4e24\u4e2a\u6574\u6570 $l,r(1\\leq l<r\\leq n)$\uff0c\u6c42 $\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}$\u3002\n1. \u8f93\u5165\u4e24\u4e2a\u6574\u6570 $l,r(1\\leq l<r\\leq n)$\uff0c\u6c42 $\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}$\u3002\n\n---\n\n## 1.\u5206\u6790\n\n\u5bf9\u4e8e 1, 2, 3 \u64cd\u4f5c\uff0c\u5c31\u662f\u7b80\u5355\u7684\u5355\u70b9\u4fee\u6539\uff0c\u76f4\u63a5\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u800c\u5bf9\u4e8e 4, 5 \u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u63a8\u5f0f\u5b50\uff0c\u770b\u770b\u4e00\u5171\u8981\u7ef4\u62a4\u54ea\u4e9b\u4fe1\u606f\uff1a\n\n## 2.\u63a8\u5bfc\n\n### \u64cd\u4f5c4\uff1a\n\n\u8bb0 $mid=\\dfrac{l+r}{2}$\uff0c$cdots_{l,r}=\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}$\uff0c\u90a3\u4e48\uff1a\n\n$$\\begin{aligned}cdots_{l,r}&=\\sum_{i=l}^{r-1}\\sum_{j=i+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\\\&=\\sum_{i=l}^{mid}\\left(\\sum_{j=i+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)+\\sum_{i=mid+1}^{r-1}\\left(\\sum_{j=i+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)\\\\&=\\sum_{i=l}^{mid}\\left(\\sum_{j=i+1}^{mid}\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}+\\sum_{j=mid+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)+\\sum_{i=mid+1}^{r-1}\\left(\\sum_{j=i+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)\\\\&=\\left(\\sum_{i=l}^{mid-1}\\sum_{j=i+1}^{mid}\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)+\\left(\\sum_{i=l}^{mid}\\sum_{j=mid+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)+\\left(\\sum_{i=mid+1}^{r-1}\\sum_{j=i+1}^r\\overrightarrow{a_i}\\cdot\\overrightarrow{a_j}\\right)\\\\&=cdots_{l,mid}+\\left(\\sum_{i=l}^{mid}\\sum_{j=mid+1}^rx_ix_j+y_iy_j\\right)+cdots_{mid+1,r}\\\\&=cdots_{l,mid}+cdots_{mid+1,r}+\\left(\\sum_{i=l}^{mid}x_i\\right)\\left(\\sum_{j=mid+1}^rx_j\\right)+\\left(\\sum_{i=l}^{mid}y_i\\right)\\left(\\sum_{j=mid+1}^ry_j\\right)\\end{aligned}$$\n\n\u6211\u4eec\u770b\u5230\u5f0f\u5b50\u91cc\u53ea\u9700\u8981\u518d\u7ef4\u62a4 $sx_{l,r}=\\sum\\limits_{i=l}^rx_i$ \u4ee5\u53ca $sy_{l,r}=\\sum\\limits_{i=l}^ry_i$ \u5373\u533a\u95f4 $x$ \u7684\u548c\u3001\u533a\u95f4 $y$ \u7684\u548c\u5373\u53ef\u3002\n\n\u603b\u7ed3\uff1a$cdots_{l,r}=cdots_{l,mid}+cdots_{mid+1,r}+sx_{l,mid}\\cdot sx_{mid+1,r}+sy_{l,mid}\\cdot sy_{mid+1,r}$\n\n### \u64cd\u4f5c5\uff1a\n\n\u540c\u6837\u5730\u63a8\u5f0f\u5b50\uff1a\n\n\u8bb0 $mid=\\dfrac{l+r}{2}$\uff0c$times_{l,r}=\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}$\uff0c\u90a3\u4e48\uff1a\n\n$$\\begin{aligned}times_{l,r}&=\\sum_{i=l}^{r-1}\\sum_{j=i+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\\\&=\\sum_{i=l}^{mid}\\left(\\sum_{j=i+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)+\\sum_{i=mid+1}^{r-1}\\left(\\sum_{j=i+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)\\\\&=\\sum_{i=l}^{mid}\\left(\\sum_{j=i+1}^{mid}\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}+\\sum_{j=mid+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)+\\sum_{i=mid+1}^{r-1}\\left(\\sum_{j=i+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)\\\\&=\\left(\\sum_{i=l}^{mid-1}\\sum_{j=i+1}^{mid}\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)+\\left(\\sum_{i=l}^{mid}\\sum_{j=mid+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)+\\left(\\sum_{i=mid+1}^{r-1}\\sum_{j=i+1}^r\\overrightarrow{a_i}\\oplus\\overrightarrow{a_j}\\right)\\\\&=times_{l,mid}+\\left(\\sum_{i=l}^{mid}\\sum_{j=mid+1}^rx_iy_j-x_jy_i\\right)+times_{mid+1,r}\\\\&=times_{l,mid}+times_{mid+1,r}+\\left(\\sum_{i=l}^{mid}x_i\\right)\\left(\\sum_{j=mid+1}^ry_j\\right)-\\left(\\sum_{i=mid+1}^rx_i\\right)\\left(\\sum_{j=l}^{mid}y_j\\right)\\end{aligned}$$\n\n\u540c\u6837\u53ea\u9700\u518d\u7ef4\u62a4\u533a\u95f4 $x$ \u7684\u548c\u3001\u533a\u95f4 $y$ \u7684\u548c\u5373\u53ef\u3002\n\n\u603b\u7ed3\uff1a$times_{l,r}=times_{l,mid}+times_{mid+1,r}+sx_{l,mid}\\cdot sy_{mid+1,r}-sx_{mid+1,r}\\cdot sy_{l,mid}$\n\n## 3.\u5b9e\u73b0\n\n\u7528\u7ebf\u6bb5\u6811+\u7ed3\u6784\u4f53\uff0c\u5373\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u7684\u4fe1\u606f\uff1a\n\n```cpp\nstruct node\n{\n\tint x;//\u533a\u95f4\u6a2a\u5750\u6807\u4e4b\u548c\n\tint y;//\u533a\u95f4\u7eb5\u5750\u6807\u4e4b\u548c\n\tint cdots;\n\tint times;\n};\n```\n\n\u7528\u6211\u4eec\u63a8\u5bfc\u51fa\u7684\u5f0f\u5b50\uff0c\u5b9e\u73b0 `merge` \u64cd\u4f5c\uff08\u5408\u5e76\u533a\u95f4\uff09\u3002\n\n```cpp\ninline node merge(node l,node r)\n{\n\tnode res;\n\tres.x=l.x+r.x;\n\tres.y=l.y+r.y;\n\tres.cdots=l.cdots+r.cdots+l.x*r.x+l.y*r.y;//4\u7684\u7ed3\u8bba\n\tres.times=l.times+r.times+l.x*r.y-l.y*r.x;//5\u7684\u7ed3\u8bba\n\treturn res;\n}\n```\n\n\u4ee5\u53ca\u533a\u95f4\u67e5\u8be2\uff1a\n\n```cpp\ninline node ask(int o,int l,int r,int ql,int qr)\n{\n    if(ql<=l&&r<=qr) return t[o];\n    int mid=(l+r)>>1;\n    if(ql<=mid&&qr>mid) return merge(ask(ls,l,mid,ql,qr),ask(rs,mid+1,r,ql,qr));//\u5206\u4e24\u6bb5\u7684\u60c5\u51b5\n    if(ql<=mid) return ask(ls,l,mid,ql,qr);\n    else return ask(rs,mid+1,r,ql,qr);\n}\n```\n\n## 4.\u4ee3\u7801\n\n\uff08\u4e00\u5b9a\u8bb0\u4f4f\u8981 `long long` \uff01\uff01\uff01\uff09\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#define S 100010\n#define int long long\nusing namespace std;\ninline int read()\n{\n\tint f=1,x=0;\n\tchar c=getchar();\n\twhile(c!='-'&&(c<'0'||c>'9')) c=getchar();\n\twhile(c=='-') f=-f,c=getchar();\n\twhile('0'<=c&&c<='9')  x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\treturn f*x;\n}\nint n,m;\nint x[S],y[S];\nstruct node\n{\n\tint x,y,cdots,times;//\u7ef4\u62a4\u7684\u4fe1\u606f\n};\ninline node merge(node l,node r)\n{\n\tnode res;\n\tres.x=l.x+r.x;\n\tres.y=l.y+r.y;\n\tres.cdots=l.cdots+r.cdots+l.x*r.x+l.y*r.y;\n\tres.times=l.times+r.times+l.x*r.y-l.y*r.x;\n   //\u76f4\u63a5\u8fd0\u7528\u7ed3\u8bba\n\treturn res;\n}\nstruct seg\n{\n\t#define ls o<<1\n\t#define rs o<<1|1\n\tnode t[S<<2];\n\tinline void pushup(int o)\n\t{\n\t\tt[o]=merge(t[ls],t[rs]);\n\t}\n\tinline void build(int o,int l,int r)\n\t{\n\t\tif(l==r)\n\t\t{\n\t\t\tt[o].x=x[l];\n\t\t\tt[o].y=y[l];\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tbuild(ls,l,mid);\n\t\tbuild(rs,mid+1,r);\n\t\tpushup(o);\n\t}\n\tinline void updadd(int o,int l,int r,int d,int x,int y)\n\t{\n\t\tif(l==r) {t[o].x+=x;t[o].y+=y;return;}\n\t\tint mid=(l+r)>>1;\n\t\tif(d<=mid) updadd(ls,l,mid,d,x,y);\n\t\telse updadd(rs,mid+1,r,d,x,y);\n\t\tpushup(o);\n\t}\n\tinline void updmin(int o,int l,int r,int d,int x,int y)\n\t{\n\t\tif(l==r) {t[o].x-=x;t[o].y-=y;return;}\n\t\tint mid=(l+r)>>1;\n\t\tif(d<=mid) updmin(ls,l,mid,d,x,y);\n\t\telse updmin(rs,mid+1,r,d,x,y);\n\t\tpushup(o);\n\t}\n\tinline void updmul(int o,int l,int r,int d,int k)\n\t{\n\t\tif(l==r) {t[o].x*=k;t[o].y*=k;return;}\n\t\tint mid=(l+r)>>1;\n\t\tif(d<=mid) updmul(ls,l,mid,d,k);\n\t\telse updmul(rs,mid+1,r,d,k);\n\t\tpushup(o);\n\t}\n\tinline node ask(int o,int l,int r,int ql,int qr)\n\t{\n\t\tif(ql<=l&&r<=qr) return t[o];\n\t\tint mid=(l+r)>>1;\n\t\tif(ql<=mid&&qr>mid) return merge(ask(ls,l,mid,ql,qr),ask(rs,mid+1,r,ql,qr));\n\t\tif(ql<=mid) return ask(ls,l,mid,ql,qr);\n\t\telse return ask(rs,mid+1,r,ql,qr);\n\t}\n}c;\nsigned main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++) x[i]=read(),y[i]=read();\n\tc.build(1,1,n);\n\twhile(m--)\n\t{\n\t\tint op=read(),x,y,k;\n\t\tif(op==1||op==2||op==3) k=read();\n\t\tx=read();\n\t\tif(op!=3) y=read();//\u8bfb\u5165\u90e8\u5206\n\t\tif(op==1) c.updadd(1,1,n,k,x,y);\n\t\tif(op==2) c.updmin(1,1,n,k,x,y);\n\t\tif(op==3) c.updmul(1,1,n,k,x);\n\t\tif(op==4||op==5)\n\t\t{\n\t\t\tnode res=c.ask(1,1,n,x,y);\n\t\t\tif(op==4) printf(\"%lld\",res.cdots);\n\t\t\tif(op==5) printf(\"%lld\",res.times);\n\t\t\tprintf(\"\\n\");\n\t\t}//\u67e5\u8be2\u90e8\u5206\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1663735765,
        "uid": 453059,
        "name": "kbtyyds",
        "ccfLevel": 5,
        "title": "P6588 \u9898\u89e3"
    },
    {
        "content": "$\\color{blue}{\\texttt{[Analysis]}}$\n\n\u524d\u4e09\u4e2a\u64cd\u4f5c\u90fd\u662f\u7ebf\u6bb5\u6811\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u91cd\u70b9\u8003\u8651\u7b2c\u56db\u548c\u7b2c\u4e94\u4e2a\u64cd\u4f5c\u3002\n\n$\\text{Operation 4}$\n\n\u56e0\u4e3a\u70b9\u4e58\u5177\u6709**\u4ea4\u6362\u5f8b**\u548c**\u5206\u914d\u5f8b**\uff0c\u6240\u4ee5\uff1a\n\n$$\\sum\\limits_{i=l}^{r-1}\\sum\\limits_{j=i+1}^{r}\\overrightarrow{a_{i}} \\cdot \\overrightarrow{a_{j}}=\\dfrac{\\left ( \\overrightarrow{s_{l,r}} \\right )^{2}-\\sum\\limits_{i=l}^{r} \\left ( \\overrightarrow{a_{i}} \\right )^{2}}{2}$$\n\n\u5176\u4e2d\uff1a\n\n$$s_{l,r}=\\sum\\limits_{i=l}^{r} \\overrightarrow{a_{i}}$$\n\n\u76f8\u5f53\u4e8e\u628a\u6240\u6709\u7684\u5411\u91cf\u90fd\u76f8\u4e58\u4e00\u6b21\uff0c\u51cf\u53bb\u81ea\u5df1\u4e58\u81ea\u5df1\uff0c\u518d\u9664\u4ee5 $2$\uff08\u56e0\u4e3a $\\overrightarrow{a}$ \u548c $\\overrightarrow{b}$ \u4f1a\u76f8\u4e58\u4e24\u6b21\uff09\u3002\n\n$\\text{Operation 5}$\n\n\u5f88\u9057\u61be\uff0c\u53c9\u4e58\u6ca1\u6709\u4ea4\u6362\u5f8b\uff0c\u53ea\u6709\u5206\u914d\u5f8b\u3002\n\n\u6211\u4eec\u53e6\u8f9f\u8e4a\u5f84\uff0c\u8bb0\uff1a\n\n$$\\text{Cross}_{l,r}=\\sum\\limits_{i=1}^{r-1} \\sum\\limits_{j=i+1}^{r} \\overrightarrow{a_{i}} \\oplus \\overrightarrow{a_{j}}$$\n\n$$\\text{Sx}_{l,r}=\\sum\\limits_{i=l}^{r}x_{i}$$\n\n\u5373 $\\text{Sx}_{l,r}$ \u4e3a\u5411\u91cf $\\overrightarrow{a_{l \\cdots r}}$ \u7684\u6a2a\u5750\u6807\u7684\u548c\uff0c$\\text{Sy}_{l,r}$ \u7c7b\u4f3c\uff0c\u4e3a\u7eb5\u5750\u6807\u7684\u548c\u3002\n\n\u53d6 $\\forall \\text{mid} \\quad \\texttt{s.t.} \\quad l < \\text{mid} < r$\uff0c\u5219\uff1a\n\n$$\\text{Cross}_{l,r}=\\text{Cross}_{l,\\text{mid}}+\\text{Cross}_{\\text{mid}+1,r}+\\text{Sx}_{l,\\text{mid}} \\times \\text{Sy}_{\\text{mid}+1,r}-\\text{Sy}_{l,\\text{mid}} \\times \\text{Sx}_{\\text{mid}+1,r}$$\n\n\u6839\u636e\u8fd9\u6761\u6027\u8d28\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e86\u3002\n\n$\\color{blue}{\\texttt{[code]}}$\n\n```cpp\ntypedef long long ll;\nconst int N=1e5+100,M=N<<2;\n\nll x[M],y[M],xs[M],ys[M],Cross[M];\n\npair<ll,ll> add(pair<ll,ll> a,pair<ll,ll> b){\n\treturn make_pair(a.first+b.first,a.second+b.second);\n}\n\ninline void maintain(int o){\n\txs[o]=x[o]*x[o];\n\tys[o]=y[o]*y[o];\n}//maintain the leaves\n\npair<int,int> a[N];\n\ninline void pushup(int o){\n\tx[o]=x[o<<1]+x[o<<1|1];\n\ty[o]=y[o<<1]+y[o<<1|1];\n\txs[o]=xs[o<<1]+xs[o<<1|1];\n\tys[o]=ys[o<<1]+ys[o<<1|1];\n\tCross[o]=Cross[o<<1]+Cross[o<<1|1]+x[o<<1]*y[o<<1|1]-y[o<<1]*x[o<<1|1];\n}\nvoid build(int o,int l,int r){\n\tif (l==r){\n\t\tx[o]=a[l].first;\n\t\ty[o]=a[r].second;\n\t\tmaintain(o);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tbuild(o<<1,l,mid);\n\tbuild(o<<1|1,mid+1,r);\n\tpushup(o);return;\n}\nvoid modify(int o,int l,int r,int p,int vx,int vy){\n\tif (l==r){\n\t\tx[o]+=vx;y[o]+=vy;\n\t\tmaintain(o);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif (p<=mid) modify(o<<1,l,mid,p,vx,vy);\n\telse modify(o<<1|1,mid+1,r,p,vx,vy);\n\tpushup(o);return;\n}//add or minus \uff08\u64cd\u4f5c 1,2\uff09\nvoid modify(int o,int l,int r,int p,int v){\n\tif (l==r){\n\t\tx[o]*=v;y[o]*=v;\n\t\tmaintain(o);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif (p<=mid) modify(o<<1,l,mid,p,v);\n\telse modify(o<<1|1,mid+1,r,p,v);\n\tpushup(o);return;\n}//times \uff08\u64cd\u4f5c 3\uff09\npair<ll,ll> query(int o,int l,int r,int p,int q){\n\tif (p<=l&&r<=q) return make_pair(x[o],y[o]);\n\tint mid=(l+r)>>1;\n\tpair<ll,ll> ret=make_pair(0ll,0ll);\n\tif (p<=mid) ret=add(ret,query(o<<1,l,mid,p,q));\n\tif (mid<q) ret=add(ret,query(o<<1|1,mid+1,r,p,q));\n\treturn ret;\n}//the sum of ai \uff08\u6c42\u548c\uff09\nll Query(int o,int l,int r,int p,int q){\n\tif (p<=l&&r<=q) return xs[o]+ys[o];\n\tint mid=(l+r)>>1;ll ans=0;\n\tif (p<=mid) ans+=Query(o<<1,l,mid,p,q);\n\tif (mid<q) ans+=Query(o<<1|1,mid+1,r,p,q);\n\treturn ans;\n}//the sum of ai dot ai \uff08\u70b9\u4e58\uff09\npair<ll,pair<ll,ll> > QUERY(int o,int l,int r,int p,int q){\n\tif (p<=l&&r<=q) return make_pair(Cross[o],make_pair(x[o],y[o]));\n\tint mid=(l+r)>>1;\n\tpair<ll,pair<ll,ll> > L,R;\n\tL=make_pair(0ll,make_pair(0ll,0ll));\n\tR=make_pair(0ll,make_pair(0ll,0ll));\n\tif (p<=mid) L=QUERY(o<<1,l,mid,p,q);\n\tif (mid<q) R=QUERY(o<<1|1,mid+1,r,p,q);\n\tll ans=L.first+R.first+L.second.first*R.second.second-L.second.second*R.second.first;\n\treturn make_pair(ans,make_pair(L.second.first+R.second.first,L.second.second+R.second.second));\n}//the sum of ai cross ai \uff08\u53c9\u4e58\uff09\n\nint n,m;\n\nint main(){\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++){\n\t\tint u=read(),v=read();\n\t\ta[i]=make_pair(u,v);\n\t}\n\t\n\tbuild(1,1,n);\n\t\n\tfor(int i=1,opt,l,r,vx,vy;i<=m;i++){\n\t\topt=read();l=read();\n\t\tif (opt==1){\n\t\t\tvx=read();vy=read();\n\t\t\tmodify(1,1,n,l,vx,vy);\n\t\t}\n\t\telse if (opt==2){\n\t\t\tvx=read();vy=read();\n\t\t\tmodify(1,1,n,l,-vx,-vy);\n\t\t}\n\t\telse if (opt==3){\n\t\t\tvx=read();\n\t\t\tmodify(1,1,n,l,vx);\n\t\t}\n\t\telse if (opt==4){\n\t\t\tr=read();\n\t\t\tpair<ll,ll> tmp=query(1,1,n,l,r);\n\t\t\tll Minus=Query(1,1,n,l,r);\n\t\t\tprintf(\"%lld\\n\",(tmp.first*tmp.first+tmp.second*tmp.second-Minus)/2);\n\t\t}//\u522b\u5fd8\u4e86\u9664\u4ee5 2\n\t\telse{\n\t\t\tr=read();\n\t\t\tpair<ll,pair<ll,ll> > ans=QUERY(1,1,n,l,r);\n\t\t\tprintf(\"%lld\\n\",ans.first);\n\t\t}\n\t}\n\t\n\treturn 0;\n}\n```",
        "postTime": 1658209920,
        "uid": 95624,
        "name": "HPXXZYY",
        "ccfLevel": 7,
        "title": "the Solution of the Problem P6588"
    }
]