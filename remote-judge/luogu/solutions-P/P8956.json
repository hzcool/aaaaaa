[
    {
        "content": "#### \u524d\u8a00\uff1a\u672c\u9898\u89e3 $\\LaTeX$ \u4f7f\u7528\u8f83\u591a\uff0c\u5982\u679c\u6e32\u67d3\u5931\u8d25\u8bf7[\u79fb\u6b65\u4e0e\u6b64](https://www.luogu.com.cn/blog/ztntonny/solution-p8956)\u3002\n\n## \u9898\u610f\n\n\u975e\u5e38\u559c\u6b22\u8fd9\u9053\u9898\uff0c\u8003\u5bdf\u5230\u4e86\u591a\u65b9\u9762\u7684\u77e5\u8bc6\u4ee5\u53ca~~\u975e\u5e38\u5751\u7684~~\u53d6\u6a21\uff0c\u4e0b\u9762\u7b80\u8ff0\u4e00\u4e0b\uff1a\n\n\u7ed9\u5b9a $5$ \u4e2a\u6574\u6570 $n,A,B,X,Y$\uff0c\u6c42\u5bf9\u4e8e\u4e24\u4e32\u4e32\u6570\u5217\uff1a\n\n$$\\left\\{\n\\begin{aligned}\nF_{A,B}(1)=A,F_{A,B}(2)=B,F_{A,B}(x)=\\lfloor \\sqrt{F_{A,B}(x-2)F_{A,B}(x-1)}\\rfloor+1\\;(x \\ge 3)\\\\\nF_{X,Y}(1)=X,F_{X,Y}(2)=Y,F_{X,Y}(x)=\\lfloor \\sqrt{F_{X,Y}(x-2)F_{X,Y}(x-1)}\\rfloor+1\\;(x \\ge 3)\n\\end{aligned}\n\\right.$$\n\u7684\uff1a\n\n$$\\prod_{i=1}^nF_{X,Y}(i)-F_{A,B}(i)$$\n\n## \u601d\u8def\n\n\u9996\u5148\uff0c\u610f\u8bc6\u5230 $\\sqrt{F(x-2)F(x-1)}+1$ \u5c31\u662f $F(x-2),F(x-1)$ \u7684\u51e0\u4f55\u5e73\u5747\u503c\u52a0\u4e0a\u4e00\uff0c\u4e14\u7531\u5747\u503c\u4e0d\u7b49\u5f0f\u5f97\u5230\n\n$$\\sqrt{F(x-2)F(x-1)}+1\\leq \\frac{F(x-2)+F(x-1)}{2}+1$$\n\n\u6240\u4ee5\u5f97\u51fa\uff0c\u6570\u5217 $F$ \u4e00\u5b9a\u6709 $F(x)=F(x+1)$ \u4e14\u6ee1\u8db3 $x\\leq\\log{(F(1)\\times F(2))}+1$\uff08\u8bb0 $x_{F_{A,B}},x_{F_{X,Y}}$ \u5206\u522b\u4e3a $F_{x,y},F_{A,B}$ \u7684\u7b2c\u4e00\u9879\u6ee1\u8db3 $F(x)=F(x+1)$ \u7684\u4e0b\u6807\uff09\u3002\n\n\u90a3\u4e48\u5c31\u4e0d\u96be\u5f97\u5230\uff0c\u5728 $F(x+1)$ \u4e4b\u540e\u6570\u5217\u5f62\u72b6\uff1a\n\n$$F(x+2)=F(x)+1,F(x+3)=F(x)+1,F(x+4)=F(x)+2,F(x+5)=F(x)+2\\ldots$$\n\n\u5373\uff1a\n\n$$F(x+n)=F(x)+\\lfloor\\frac{n}{2}\\rfloor$$\n\n\n\u90a3\u4e48\u5b9e\u9645\u4e0a\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u7528 $\\mathcal{O}(\\log{(X\\times Y)})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6c42\u51fa $F_{X,Y}$\uff0c\u7528 $\\mathcal{O}(\\log {A\\times B})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6c42\u51fa $F_{A,B}$ \u4e86\u3002\u4e0b\u9762\u5206\u6790 $\\prod_{i=1}^nF_{X,Y}(i)-F_{A,B}(i)$\uff1a\n\n\u6b64\u5f0f\u5b50\u82e5 $n\\leq \\min(x_{F_{A,B}},x_{F_{X,Y}})$ \u8fd8\u53ef\u4ee5\u66b4\u529b\u8ba1\u7b97\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(\\min(\\log{(A\\times B)},\\log{(X\\times Y)}))$\uff0c\u4f46\u662f\u82e5 $n$ \u5df2\u7ecf\u53d6\u5230 $10^9$ \u7ea7\u522b\uff0c\u5c31\u9700\u8981\u8003\u8651\u66f4\u5feb\u7684\u65b9\u6cd5\u4e86\uff0c\u6211\u4eec\u63a8\u5bfc\u5728 $\\max(x_{F_{A,B}},x_{F_{X,Y}})$ \u4ee5\u540e\u7684\u4e58\u79ef\u5f62\u5f0f\uff1a\n\n$$(F_{A,B}(x)-F_{X,Y}(x))\\times(F_{A,B}(x+1)-F_{X,Y}(x+1))\\times\\ldots$$\n\n\u8003\u8651 $F_{A,B}(n)=F_{A,B}(x)+\\lfloor\\frac{n-x}{2}\\rfloor$\uff0c\u7b80\u5316\u6210\u4e3a\uff1a\n\n$$(F_{A,B}(x_{F_{A,B}})+\\lfloor\\frac{x-x_{F_{A,B}}}{2}\\rfloor-F_{X,Y}(x_{F_{X,Y}})+\\lfloor\\frac{x-x_{F_{X,Y}}}{2}\\rfloor)\\times(F_{A,B}(x_{F_{A,B}})+\\lfloor\\frac{x+1-x_{F_{A,B}}}{2}\\rfloor-F_{X,Y}(x_{F_{X,Y}})+\\lfloor\\frac{x+1-x_{F_{X,Y}}}{2}\\rfloor)\\times\\ldots$$ \n\n\u6613\u5f97\u7b2c $x$ \u9879\uff1a\n\n$$F_{A,B}(x_{F_{A,B}})+\\lfloor\\frac{x-x_{F_{A,B}}}{2}\\rfloor-F_{X,Y}(x_{F_{X,Y}})+\\lfloor\\frac{x-x_{F_{X,Y}}}{2}\\rfloor$$\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5f53 $x_{F_{A,B}}\\mod 2\\equiv x_{F_{X,Y}}\\mod 2$ \u65f6\uff1a\n\n$$F_{A,B}(x_{F_{A,B}})+\\lfloor\\frac{x-x_{F_{A,B}}}{2}\\rfloor-F_{X,Y}(x_{F_{X,Y}})+\\lfloor\\frac{x-x_{F_{X,Y}}}{2}\\rfloor= F_{A,B}(x_{F_{A,B}})-F_{X,Y}(x_{F_{X,Y}})$$\n\n\u90a3\u4e48\u539f\u5f0f\u5b9e\u9645\u4e0a\u5c31\u6210\u4e3a\u4e86\uff1a\n\n$$(F_{A,B}(x_{F_{A,B}})-F_{X,Y}(x_{F_{X,Y}}))^{n-\\max(x_{F_{A,B}},x_{F_{X,Y}})+1}$$\n\n\u8089\u773c\u53ef\u89c1\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u5e42\u89e3\u51b3\u3002\n\n\u90a3\u4e48\u5f53 $x_{F_{A,B}}\\mod 2\\not\\equiv x_{F_{X,Y}}\\mod 2$ \u65f6\uff1a\n\n$$(F_{A,B}(x_{F_{A,B}})+\\lfloor\\frac{x-x_{F_{A,B}}}{2}\\rfloor-F_{X,Y}(x_{F_{X,Y}})+\\lfloor\\frac{x-x_{F_{X,Y}}}{2}\\rfloor)\\times(F_{A,B}(x_{F_{A,B}})+\\lfloor\\frac{x+1-x_{F_{A,B}}}{2}\\rfloor-F_{X,Y}(x_{F_{X,Y}})+\\lfloor\\frac{x+1-x_{F_{X,Y}}}{2}\\rfloor)=(F_{A,B}(x_{F_{A,B}})-F_{X,Y}(x_{F_{X,Y}}))\\times(F_{A,B}(x_{F_{A,B}}+1)-F_{X,Y}(x_{F_{X,Y}}+1))$$\n\n\u539f\u5f0f\u5b9e\u9645\u4e0a\u6210\u4e3a\uff1a\n\n$$(F_{A,B}(x_{F_{A,B}})-F_{X,Y}(x_{F_{X,Y}}))\\times(F_{A,B}(x_{F_{A,B}}+1)-F_{X,Y}(x_{F_{X,Y}}+1))^{\\lfloor\\frac{n-\\max(x_{F_{A,B}},x_{F_{X,Y}})+1}{2}\\rfloor}\\times (F_{A,B}(x_{F_{A,B}})-F_{X,Y}(x_{F_{X,Y}}))^{(n-\\max(x_{F_{A,B}},x_{F_{X,Y}})+1)\\mod 2}$$\n\n\u540c\u6837\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u5e42\u89e3\u51b3\u3002\n\n---\n\n\u90a3\u4e48\u8fd9\u6837\uff0c\u5b9e\u9645\u4e0a\u6574\u4e2a\u7a0b\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $\\mathcal{O}(t\\log n)$ \u7ea7\u522b\u7684\u4e86\uff0c\u5b8c\u7ed3\u6492\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst ll MOD = 998244353;\nll t , n , a , b , x , y , cmp1 , cmp2;\nlong double f[105] , g[105];\nll fpow( ll xx , ll yy )\n{\n\tif ( yy == 0 )\treturn 1;\n\tll z = fpow( xx , yy / 2 ) % MOD;\n\tif ( yy % 2 )\treturn ( ( z * z ) % MOD * xx ) % MOD;\n\telse\treturn ( z * z ) % MOD;\n}\nll ff( ll xx )\n{\n\tif ( xx > cmp1 )\treturn ( ( ( xx - cmp1 ) / 2 ) % MOD + (ll)f[cmp1] ) % MOD;\n\telse\treturn (ll)f[xx];\n}\nll gg( ll xx )\n{\n\tif ( xx > cmp2 )\treturn ( ( ( xx - cmp2 ) / 2 ) % MOD + (ll)g[cmp2] ) % MOD;\n\telse\treturn (ll)g[xx];\n}\nint main()\n{\n\tcin >> t;\n\tfor ( ll k = 1; k <= t; k++ )\n\t{\n\t\tll cmp , ans = 1;\n\t\tcmp1 = 2 , cmp2 = 2 , cin >> n >> a >> b >> x >> y , f[1] = a , f[2] = b , g[1] = x , g[2] = y;\n\t\twhile ( f[++cmp1 - 1] != f[cmp1 - 2] && cmp1 <= n + 3 )\tf[cmp1] = ( (ll)( sqrt( f[cmp1 - 1] * f[cmp1 - 2] ) ) + 1 ) % MOD;\n\t\twhile ( g[++cmp2 - 1] != g[cmp2 - 2] && cmp2 <= n + 3 )\tg[cmp2] = ( (ll)( sqrt( g[cmp2 - 1] * g[cmp2 - 2] ) ) + 1 ) % MOD;\n\t\tcmp1 -= 2 , cmp2 -= 2 , cmp = max( cmp1 , cmp2 );\n\t\tfor ( ll i = 1; i <= min( n , cmp - 1 ); i++ )\tans *= ( gg( i ) - ff( i ) ) % MOD , ans %= MOD;\n\t\tif ( cmp <= n )\n\t\t{\n\t\t\tif ( cmp1 % 2 == cmp2 % 2 )\tans *= fpow( ( gg( cmp ) - ff( cmp ) ) % MOD , n - cmp + 1 ) , ans %= MOD;\n\t\t\telse\n\t\t\t{\n\t\t\t\tans *= fpow( ( ( gg( cmp ) - ff( cmp ) ) % MOD * ( gg( cmp + 1 ) - ff( cmp + 1 ) ) % MOD ) % MOD , ( n - cmp + 1 ) / 2 ) , ans %= MOD;\n\t\t\t\tif ( ( n - cmp + 1 ) % 2 )\tans *= ( gg( cmp ) - ff( cmp ) ) % MOD , ans %= MOD;\n\t\t\t}\n\t\t}\n\t\tcout << ( ans + MOD ) % MOD << endl;\n\t}\n    return 0;\n}\n```",
        "postTime": 1674191586,
        "uid": 726395,
        "name": "ztntonny",
        "ccfLevel": 4,
        "title": "P8956\u9898\u89e3"
    },
    {
        "content": "# \u524d\u8a00\n\nT1\uff0c\u6781\u5176\u5361\u7cbe\u5ea6\u3002\u9b3c\u624d\u77e5\u9053\u6211\u4e3a\u5565\u4f1a\u505a\u3002\n\n\u4e0e\u5b98\u65b9\u7b54\u6848\u6b8a\u9014\u540c\u5f52\u3002\n\n# \u6b63\u6587\n\n\u624b\u6a21\u51e0\u7ec4\u6570\u636e\u53ef\u5f97\u8fd9\u4e2a\u6570\u5217\u5148\u662f\u75af\u72c2\u4e0b\u964d\uff0c\u5230\u4e00\u5b9a\u6570\u503c\u5f00\u59cb\u7f13\u6b65\u4e0a\u5347\u3002\n\n\u7136\u540e\u6613\u5f97\u6570\u5217\u4e0a\u5347 $1$ \u9700\u8981\u4e24\u4e2a\u957f\u5ea6\uff0c\u4e8e\u662f\u5728\u8fd9\u4e00\u6bb5\u4e24\u4e2a\u6570\u5217\u7684\u5dee\u503c\u6700\u591a\u6ce2\u52a8 $1$\u3002\n\n\u7ed3\u8bba\u539f\u7406\uff1a\n\n\u7531\u57fa\u672c\u4e0d\u7b49\u5f0f $a + b \\geq 2 \\sqrt{ab}$\uff0c\u4e0d\u96be\u53d1\u73b0 $\\sqrt{F_{A, B}(x - 1) \\times F_{A, B}(x - 2)} + 1 \\leq \\dfrac{F_{A, B}(x - 1) + F_{A, B}(x - 2)}{2} + 1$\n\n\u7ecf\u8fc7\u6570\u5217\u7684\u4e0d\u65ad\u9012\u63a8\u4e4b\u540e\uff0c\u4ed6\u4e0b\u964d\u5230\u4e86 $1$\uff0c\u4f7f\u5f97\u8fd9\u4e2a\u7b49\u53f7\u53ef\u53d6\uff0c\u4e8e\u662f\u4f1a\u6709 $x$ \u6ee1\u8db3\uff1a\n\n$$\n\\begin{cases}\nF_{A, B}(x) = F_{A, B}(x + 1) \\\\\nF_{A, B}(x + 2) = F_{A, B}(x + 3) = F_{A, B}(x) + 1 \\\\\nF_{A, B}(x + 4) = F_{A, B}(x + 5) = F_{A, B}(x) + 2 \\\\\n\\cdots \\\\\nF_{A, B}(x + 2k) = F_{A, B}(x + 2k + 1) = F_{A, B}(x) + k \\quad(k \\in N)\\\\\n\\end{cases}\n$$\n\n\u5373\u5230\u8fbe\u6570\u5217\u4e0a\u5347 $1$ \u9700\u8981\u4e24\u4e2a\u957f\u5ea6\u7684\u60c5\u51b5\u3002\u800c\u4e14\u8fd9\u4e24\u4e2a\u6570\u5217\u7684\u5dee\u503c\u6700\u591a\u6ce2\u52a8 1\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5bf9\u5176\u5947\u5076\u6027\u8fdb\u884c\u5206\u8ba8\uff0c\u7136\u540e\u5feb\u901f\u5e42\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $\\mathcal{O}(T \\log_2 \\omega)$\uff0c\u53cd\u6b63\u4e0d\u4f9d\u8d56\u4e8e $N$ \u80af\u5b9a\u8fc7\u3002\n \n# \u4ee3\u7801\n\n\u4ec5\u4f9b\u8c03\u8bd5\u7528\u7684\u6838\u5fc3\u4ee3\u7801\uff1a\n\n``` python\nVar T, N, A, B, X, Y\nVal MOD = 998244353 \n\nFun main():\n    T = read()\n    While T != 0:\n        dec(T)\n        N, A, B, X, Y = read()\n        If N == 1:\n            writeln(X - A)\n        Elif N == 2:\n            writeln((X - A) * (Y - B))\n        Else:\n            Var pf, ppf, pg, ppg = B, A, Y, X\n            Var ans = (X - A) * (Y - B)\n            Var fready, gready = False, False\n            For i From 3 Upto N(Included) Step 1:\n                Var f, g = floor(sqrt(pf * ppf)) + 1, floor(sqrt(pg * ppg)) + 1\n                If f == pf:\n                    fready = True\n                    \n                If g == pg:\n                    gready = True\n                    \n                ans = ans * (g - f)\n                If fready And gready:\n                    Var now = i + 1\n                    If now > N:\n                    \tBreak\n                        \n                    If (pf - pg) == (f - g):\n                        ans = ans * pow(g - f, N - now + 1)\n                    \n                    Else: \n                        ppf = pf, ppg = pg, pf = f, pg = g\n                        f, g = floor(sqrt(pf * ppf)) + 1, floor(sqrt(pg * ppg)) + 1\n                        ans = ans * pow((g - f) * (pg - pf), (N - now + 1) / 2)\n                        If (N - now + 1) % 2 == 1:\n                        \tans = ans * (g - f)\n                    \n                    Break\n\n                ppf = pf, ppg = pg, pf = f, pg = g\n\n            writeln(ans)\n```\n\n# \u540e\u8a00\n\n\u611f\u8c22\u3010\u4e11\u56fd\u3011\u9898\u68ee\u51fa\u9898\u7ec4\u63d0\u4f9b\u7684\u4f18\u8d28\u9898\u76ee\uff01",
        "postTime": 1674127665,
        "uid": 224558,
        "name": "JackMerryYoung",
        "ccfLevel": 5,
        "title": "P8956 \u300cCGOI-3\u300d\u62db\u9b42\u672f \u9898\u89e3"
    }
]