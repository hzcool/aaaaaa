[
    {
        "content": "\u66b4\u529b\u80fd A \u7684\u8ff7\u4e4b\u9898\u76ee\u3002\n\n\u9898\u610f\u53ef\u4ee5\u7406\u89e3\u4e3a\u7ed9\u4f60\u51e0\u68f5\u5c0f\u6811\uff0c\u7136\u540e\u5c06\u8fd9\u51e0\u9897\u5c0f\u6811\u8fde\u6210\u4e00\u4e2a\u73af\uff0c\u4f7f\u5f97\u73af\u957f $\\ge Y$ \uff0c\u6c42\u6ee1\u8db3\u8981\u6c42\u7684\u6811\u4e2a\u6570\u3002\n\n\u56e0\u4e3a\u6570\u636e\u8303\u56f4\u5f88\u5c0f\uff0c\u8003\u8651\u76f4\u63a5\u7528 $dfs$ \u5c06\u6bcf\u68f5\u5c0f\u6811\u5185\u7684\u6240\u6709\u8def\u5f84\u90fd\u7edf\u8ba1\u51fa\u6765\u3002\u7136\u540e\u5c31\u53d8\u6210\u4e86\u95ee\u7ed9\u4f60\u51e0\u4e2a\u96c6\u5408\uff0c\u4ece\u8fd9\u4e9b\u96c6\u5408\u4e2d\u6bcf\u4e2a\u96c6\u5408\u9009\u62e9\u4e00\u4e2a\u6570\uff0c\u95ee\u548c $\\ge Y$ \u7684\u65b9\u6848\u548c\u3002\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u80cc\u5305\u95ee\u9898\u3002\u6c42\u65b9\u6848\u548c\u53ef\u4ee5\u987a\u4fbf\u6c42\u51fa\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u8bbe $dp[i][0/1]$ \u8868\u793a \u548c\u4e3a $i$ \u7684\u65b9\u6848\u6570/\u65b9\u6848\u548c\uff0c $g[i][0/1]$ \u8868\u793a\u5f53\u524d\u5c0f\u6811\u5185\u957f\u5ea6\u4e3a $i$ \u7684\u8def\u5f84\u6570/\u957f\u5ea6\u548c\uff0c\u5219\u5b58\u5728\u8f6c\u79fb:\n\n$$dp[i+j][0]\\leftarrow dp[i][0]*g[j][0]$$\n\n$$dp[i+j][1]\\leftarrow dp[i][0]*g[j][1] + dp[i][1]*g[j][0]$$\n\n\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u6ce8\u610f\u6211\u4eec\u5e76\u4e0d\u5173\u6ce8\u8fd9\u4e2a\u957f\u5ea6\u5177\u4f53\u662f\u591a\u5c11\uff0c\u53ea\u5173\u6ce8\u5b83\u662f\u5426\u6bd4 $Y$ \u5927\u3002\u5e76\u4e14\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $Y$ \u7684\u65b9\u6848\u4e4b\u540e\u518d\u600e\u4e48\u53d8\u90fd\u662f\u6ee1\u8db3\u8981\u6c42\u7684\u3002\u56e0\u6b64\u53ef\u4ee5\u5c06\u957f\u5ea6 $\\ge Y$ \u7684\u90e8\u5206\u8bb0\u5728\u4e00\u8d77\u3002\u8fd8\u6709\u4e2a\u4f18\u5316\u662f\u53ef\u4ee5\u76f4\u63a5\u4ece $X*k$ \u5f00\u59cb\u8f6c\u79fb\u3002\u8fd8\u6709\u5c31\u662f\u53ea\u8f6c\u79fb $g$ \u548c $dp$ \u6709\u503c\u7684\u4f4d\u7f6e\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\sum n_i^2+\\min\\{Y,n_i^2\\}(Y-XK))=O(NY\\sqrt{Y})$ \uff0c $n_i$ \u4e3a\u7b2c $i$ \u68f5\u5c0f\u6811\u7684\u70b9\u6570\u3002\u590d\u6742\u5ea6\u8bc1\u660e\u4e3a\u8003\u8651\u5b50\u6811\u8d21\u732e\uff0c\u5f53 $\\forall i,Y=n_i^2$\u65f6\u590d\u6742\u5ea6\u53d6\u5f97\u6700\u5927\u503c\u3002\n\n\n\n\u4ee3\u7801:\n```cpp\n#include<bits/stdc++.h>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mx(a,b) (a>b?a:b)\n#define mn(a,b) (a<b?a:b)\ntypedef unsigned long long uint64;\ntypedef unsigned int uint32;\ntypedef long long ll;\nusing namespace std;\n\nnamespace IO\n{\n\tconst uint32 Buffsize=1<<15,Output=1<<24;\n\tstatic char Ch[Buffsize],*S=Ch,*T=Ch;\n\tinline char getc()\n\t{\n\t\treturn((S==T)&&(T=(S=Ch)+fread(Ch,1,Buffsize,stdin),S==T)?0:*S++);\n\t}\n\tstatic char Out[Output],*nowps=Out;\n\t\n\tinline void flush(){fwrite(Out,1,nowps-Out,stdout);nowps=Out;}\n\n\ttemplate<typename T>inline void read(T&x)\n\t{\n\t\tx=0;static char ch;T f=1;\n\t\tfor(ch=getc();!isdigit(ch);ch=getc())if(ch=='-')f=-1;\n\t\tfor(;isdigit(ch);ch=getc())x=x*10+(ch^48);\n\t\tx*=f;\n\t}\n\n\ttemplate<typename T>inline void write(T x,char ch='\\n')\n\t{\n\t\tif(!x)*nowps++='0';\n\t\tif(x<0)*nowps++='-',x=-x;\n\t\tstatic uint32 sta[111],tp;\n\t\tfor(tp=0;x;x/=10)sta[++tp]=x%10;\n\t\tfor(;tp;*nowps++=sta[tp--]^48);\n\t\t*nowps++=ch;\n\t}\n}\nusing namespace IO;\n\nvoid file(void)\n{\n\tFILE*DSD=freopen(\"water.in\",\"r\",stdin);\n\tFILE*CSC=freopen(\"water.out\",\"w\",stdout);\n}\n\nconst int MAXN=1500+7,MAXY=2500+7,mod=1e9+7;\n\nstatic int n,m;\n\nstatic struct edge\n{\n\tint v,w,nxt;\n}p[MAXN<<1];\n\nstatic int head[MAXN],e;\n\ninline void add(int u,int v,int w)\n{p[++e]=(edge){v,w,head[u]},head[u]=e;}\n\nnamespace DSU\n{\n\tstatic int fa[MAXN];\n\n\tinline void clear(){Rep(i,1,n)fa[i]=i;}\n\n\tinline int Find(int u){return u==fa[u]?u:fa[u]=Find(fa[u]);}\n}\n\nstatic int X,Y;\n\ninline void init()\n{\n\tread(n),read(m),read(X),read(Y);\n\tDSU::clear();\n\tstatic int u,v,w;\n\tRep(i,1,m)read(u),read(v),read(w)\n\t\t,add(u,v,w),add(v,u,w),DSU::fa[DSU::Find(u)]=DSU::Find(v);\n}\n\nstatic int cn;\n\nstatic int bel[MAXN],dst[MAXN][MAXY],sig[MAXN][MAXY];\n\nvoid dftag(int u,int fr,int dir)\n{\n\tbel[u]=dir;\n\tfor(register int i=head[u];i;i=p[i].nxt)\n\t{\n\t\tint v=p[i].v;\n\t\tif(v^fr)dftag(v,u,dir);\n\t}\n}\n\nvoid dffix(int u,int fr,int len)\n{\n\tif(fr)(sig[bel[u]][min(Y,len)]+=len)%=mod,++dst[bel[u]][min(Y,len)];\n\tfor(register int i=head[u];i;i=p[i].nxt)\n\t{\n\t\tint v=p[i].v;\n\t\tif(v^fr)dffix(v,u,len+p[i].w);\n\t}\n}\n\nstatic int dp[MAXY][2],las[MAXY][2];\n\ninline int fac(int u)\n{\n\tregister int sm=1;\n\tRep(i,2,u)sm=(ll)sm*i%mod;\n\treturn sm;\n}\n\ninline void solve()\n{\n\tRep(i,1,n)if(DSU::Find(i)==i)++cn,dftag(i,0,cn);\n\tRep(i,1,n)dffix(i,0,0);\n\tstatic int st=min(Y,X*cn);\n\tdp[st][0]=1,dp[st][1]=X*cn;\n\tRep(i,1,cn)\n\t{\n\t\tRep(j,st,Y)las[j][0]=dp[j][0]\n\t\t\t,las[j][1]=dp[j][1],dp[j][0]=dp[j][1]=0;\n\t\tRep(j,0,Y)if(dst[i][j])Rep(k,st,Y)if(las[k][0])\n\t\t{\n\t\t\tdp[min(j+k,Y)][0]=(dp[min(j+k,Y)][0]+\n\t\t\t\t(ll)las[k][0]*dst[i][j])%mod;\n\n\t\t\tdp[min(j+k,Y)][1]=(dp[min(j+k,Y)][1]+\n\t\t\t\t(ll)las[k][0]*sig[i][j]+(ll)las[k][1]*dst[i][j])%mod;\n\t\t}\n\t}\n\tcout<<(ll)dp[Y][1]*fac(cn-1)%mod*((mod+1)/2)%mod<<endl;\n}\n\nint main()\n{\n\tfile();\n\tinit();\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1551769905,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5243 \u3010[USACO19FEB]Moorio Kart\u3011"
    },
    {
        "content": "~~\u4e3a\u5565\u5168\u7f51\u90fd\u662f\u5947\u602a\u590d\u6742\u5ea6\u505a\u6cd5\u3002~~\n\n\u4e00\u79cd\u76f4\u63a5\u7684\u60f3\u6cd5\u662f\uff0c\u5148\u6c42\u51fa\u6bcf\u4e2a\u8fde\u901a\u5757\u6bcf\u79cd\u6743\u503c\u7684\u8def\u5f84\u6570\u7136\u540e\u5377\u79ef\u3002\u8fd9\u6837\u505a\u770b\u4e0a\u53bb\u5f88\u52a3\uff0c\u4f46\u662f\u5927\u5bb6\u53ef\u4ee5\u5206\u6790\u51fa\u6765\u5982\u679c\u53ea\u8f6c\u79fb\u975e0\u7684\u4f4d\u7f6e\u590d\u6742\u5ea6\u662f $O(\\sum_{i}\\sqrt{s_i^2Y}Y) = O(nY\\sqrt Y)$\u3002\n\n\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5730\u89c4\u907f\u6389\u5377\u79ef\uff0c\u53ea\u9700\u6bcf\u6b21\u52a0\u4e00\u6761\u8fb9\u5373\u53ef\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8fde\u901a\u5757\uff0c\u6211\u4eec\u8dd1\u4e24\u6b21\u6811\u5f62dp\uff08\u4e00\u6b21\u5f80\u4e0a\uff0c\u4e00\u6b21\u5f80\u4e0b\uff09\u6c42\u51fa\u65b9\u6848\u6570\uff0c\u52a0\u8fb9\u76f8\u5f53\u4e8e\u5f8001\u80cc\u5305\u5185\u52a0\u4e00\u4e2a\u7269\u54c1\uff0c\u540c\u65f6\u5f00\u4e00\u4e2a\u5168\u5c40\u6570\u7ec4\u8bb0\u5f55\u7b54\u6848\u3002\u6bcf\u5904\u7406\u5b8c\u4e00\u4e2a\u8fde\u901a\u5757\u540e\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u5728\u5df2\u5904\u7406\u8fc7\u7684\u6240\u6709\u8fde\u901a\u5757\u4e2d\u5404\u9009\u4e00\u6761\u8def\u5f84\u7684\u65b9\u6848\u6570\u3002\u6ce8\u610f\u5728 lca \u5904\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u5904\u7406\u9632\u6b62\u7b97\u91cd\u3002\u8fd9\u6837\u5c31\u4e0d\u7528\u5377\u79ef\uff0c\u590d\u6742\u5ea6\u662f $O(nY)$ \u7684\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\n#define For(i, a, b) for (int i = a, i##end = b; i <= i##end; ++i)\n#define rFor(i, b, a) for (int i = b, i##end = a; i >= i##end; --i)\n#define eFor(i, u, v) for (int i = head[u], v = e[i].to; i; i = e[i].next, v = e[i].to)\n\ntypedef long long ll;\n\ntypedef std::pair<int, int> pii;\n#define fi first\n#define se second\n\nstd::mt19937 rnd(std::chrono::steady_clock::now().time_since_epoch().count());\ntemplate<typename T> \nT myrand(T l, T r) {\n\treturn std::uniform_int_distribution<T>(l, r)(rnd);\n}\n\ntemplate<typename T, typename ...Args> \nvoid LOG(T str, Args ...args) {\n#ifdef DEBUG\n\tfprintf(stderr, str, args...);\n#endif\n}\n\n#define fre(s) freopen(#s \".in\", \"r\", stdin), freopen(#s \".out\", \"w\", stdout)\n\nconst int kN = 1505;\nconst int kM = 2505;\nconst int P = 1e9 + 7;\n\nint n, m, X, Y, inv[kN], f[kN], head[kN], ecnt = 1;\n\ninline int norm(int x) {\n\treturn x >= P ? x - P : x;\n}\n\nstruct Arc {\n\tint next, to, w;\n} e[kN << 1];\n\nvoid addEdge(int from, int to, int w) {\n\te[ecnt] = (Arc) {\n\t\thead[from], to, w\n\t};\n\thead[from] = ecnt++;\n}\n\nint vid[kN], tot, up[kN][kM], dn[kN][kM], s[kN], fe[kN], d[kM], nd[kM], bsz[kN], sum[kN][kM];\n\nvoid dfs1(int u) {\n\tvid[++tot] = u;\n\tFor(i, 0, Y) up[u][i] = d[i];\n\ts[u] = 1;\n\teFor(i, u, v) if (v != f[u]) {\n\t\tf[v] = u;\n\t\tfe[v] = e[i].w;\n\t\tdfs1(v);\n\t\ts[u] += s[v];\n\t\trFor(j, Y, e[i].w) up[u][j] = norm(up[u][j] + up[v][j - e[i].w]);\n\t}\n}\n\nvoid dfs2(int u) {\n\tbsz[u] = tot;\n\tFor(j, 0, Y) nd[j] = norm(nd[j] + dn[u][j]);\n\teFor(i, u, v) if (v != f[u]) {\n\t\trFor(j, Y, e[i].w) dn[v][j] = norm(dn[v][j] + dn[u][j - e[i].w]);\n\t\tdfs2(v);\n\t}\n}\n\nint main() {\n\tscanf(\"%d%d%d%d\", &n, &m, &X, &Y);\n\tFor(i, 1, m) {\n\t\tint u, v, w;\n\t\tscanf(\"%d%d%d\", &u, &v, &w);\n\t\taddEdge(u, v, w), addEdge(v, u, w);\n\t}\n\tinv[1] = 1;\n\tFor(i, 2, n) inv[i] = P - (ll)inv[P % i] * (P / i) % P;\n\td[0] = 1;\n\tint coe = 1, all = 1, ans = 0;\n\tFor(u, 1, n) if (!f[u] && head[u]) {\n\t\tmemset(nd, 0, sizeof(nd));\n\t\ttot = 0;\n\t\tdfs1(u);\n\t\tall = (ll)all * tot % P * (tot - 1) % P;\n\t\tFor(i, 2, tot) {\n\t\t\tFor(j, 0, Y - fe[vid[i]]) \n\t\t\t\tsum[f[vid[i]]][j + fe[vid[i]]] = norm(sum[f[vid[i]]][j + fe[vid[i]]] + up[vid[i]][j]);\n\t\t}\n\t\tFor(i, 1, tot) {\n\t\t\tFor(j, 0, Y) {\n\t\t\t\tnd[j] = norm(nd[j] + sum[vid[i]][j]);\n\t\t\t\tsum[vid[i]][j] = norm(sum[vid[i]][j] + d[j]);\n\t\t\t}\n\t\t\teFor(j, vid[i], v) if (v != f[vid[i]]) {\n\t\t\t\trFor(k, Y, e[j].w) {\n\t\t\t\t\tdn[v][k] = norm(sum[vid[i]][k - e[j].w] + P - (k >= e[j].w * 2 ? up[v][k - 2 * e[j].w] : 0));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdfs2(u);\n\t\tstd::copy(nd, nd + Y + 1, d);\n\t}\n\tFor(i, 2, n - m - 1) coe = (ll)coe * i % P;\n\tFor(i, 1, n) if (f[i]) {\n\t\tans = (ans + (ll)fe[i] * s[i] % P * (bsz[i] - s[i]) % P * coe % P * all % P * inv[bsz[i]] % P * inv[bsz[i] - 1]) % P;\n\t}\n\tans = (ans + (ll)all * coe % P * inv[2] % P * (n - m) % P * X) % P;\n\tFor(i, 1, Y - X * (n - m) - 1) {\n\t\tans = norm(ans + P - (ll)d[i] * coe % P * inv[2] % P * (i + (ll)(n - m) * X % P) % P);\n\t}\n\tprintf(\"%d\", ans);\n\treturn 0;\n}\n/* PAY ATTENTION TO: */\n/* 1. Memory Limit, Array Size */\n/* 2. Integer Overflow */\n/* 3. Multi-test */\n/* 4. Potential Constant-speedup */\n/* Stay organized and write things down. */\n\n```",
        "postTime": 1671720169,
        "uid": 161577,
        "name": "psoet",
        "ccfLevel": 0,
        "title": "P5243 [USACO19FEB]Moorio Kart P"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problemnew/show/P5243)\n\n\u6211\u4eec\u7684\u795e\u4ed9\u6559\u7ec3\u5728\u8003\u8bd5\u91cc\u653e\u4e86\u8fd9\u9053\u9898\uff0c\u5f53\u65f6\u6211\u975e\u5e38\u60ca\u8bb6\u554a\n\n\u80cc\u5305\u662f$O(n^3)$\u7684\u5427~~\u660e\u660e\u662f\u5e26\u6839\u53f7\u7684\u597d\u5427~~\uff0c\u90a3\u65e2\u7136\u8981\u4f18\u5316\u7684\u8bdd\n\nNTT\uff01\u4ec0\u4e48\u65f6\u5019\u6211\u4eec\u6559\u7ec3\u4f1a\u5728\u8003\u8bd5\u91cc\u653e\u591a\u9879\u5f0f\u4e86\n\n\u6a21\u6570$1e9+7$\uff1f\n\n~~\u4efb\u610f\u6a21\u6570~~\u4e0d\u5b58\u5728\u7684\uff0c\u6211\u4eec\u5f00int128\u627e\u4e00\u4e2a\u5927\u4e00\u70b9\u7684$NTT$\u6a21\u6570\u5c31\u53ef\u4ee5\u4e86\n\n\u8fd8\u662f\u8bf4\u4e00\u4e0b$NTT$\u7684\u505a\u6cd5\u5427\uff0c\u53d1\u73b0\u6211\u4eec\u8981\u6c42\u957f\u5ea6\u5927\u4e8e$Y$\u7684\u8def\u5f84\u53ef\u80fd\u4e0d\u592a\u597d\u6c42\uff0c\u4e8e\u662f\u6211\u4eec\u6b63\u96be\u5219\u53cd\u4e00\u4e0b\uff0c\u6211\u4eec\u6c42\u51fa\u6709\u591a\u5c11\u79cd\u62fc\u6cd5\u53ef\u4ee5\u4f7f\u5f97\u8def\u5f84\u957f\u5ea6\u5c0f\u4e8e$Y$\u5c31\u53ef\u4ee5\u4e86\n\n\u6bcf\u4e00\u68f5\u6811\u91cc\u53ea\u80fd\u51fa\u4e00\u6761\u8def\u5f84\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u68f5\u6811\u7684\u8def\u5f84\u4fe1\u606f\u641e\u6210\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u7cfb\u6570\u4ee3\u8868\u8fd9\u79cd\u957f\u5ea6\u7684\u8def\u5f84\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\n\n\u6211\u4eec\u628a\u6bcf\u68f5\u6811\u7684\u591a\u9879\u5f0f\u5377\u8d77\u6765\u5c31\u662f\u6700\u540e\u7684\u7b54\u6848\u4e86\n\n\u5e76\u4e0d\u4fdd\u8bc1\u968f\u65f6\u80fd\u901a\u8fc7\u800c\u4e14\u6211\u4eec\u4e0d\u600e\u4e48\u80fd\u770b\u61c2\u7684\u4ee3\u7801\n\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#define re register\n#define _LL __int128\n#define LL long long\n#define max(a,b) ((a)>(b)?(a):(b))\n#define min(a,b) ((a)<(b)?(a):(b))\n#pragma GCC optimize(3)\n#pragma GCC optimize(\"-fcse-skip-blocks\")\n#pragma GCC optimize(\"Ofast,no-stack-protector\")\nchar BB[1<<18],*S=BB,*T=BB; \nconst int maxn=1505;\ninline int read() {\n    char c=getchar();int x=0;while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9') x=(x<<3)+(x<<1)+c-48,c=getchar();return x;\n}\nstruct E{int v,nxt,w;}e[maxn<<1];\nconst LL mod=4222124650659841;\nconst LL P=1e9+7;\n_LL G[2],t,og;\n_LL mi[2][16];\nint head[maxn],sum[maxn];\nint n,m,X,Y,tot,num;\nint rev[10000],len,fa[maxn],vis[maxn],pre[maxn];\nint tax[1501][2501];LL tp[maxn];\n_LL A[9000],B[9000];\nLL tmp=1,k=0;\ninline void add(int x,int y,int w) {\n    e[++num].v=y;e[num].nxt=head[x];\n    head[x]=num;e[num].w=w;\n}\ninline _LL ksm(_LL a,LL b) {\n    _LL S=1;\n    while(b) {if(b&1ll) S=S*a%mod;b>>=1ll;a=a*a%mod;}\n    return S;\n}\nvoid exgcd(LL a,LL b,LL &x,LL &y) {\n    if(!b) {x=1,y=0;return;}\n    exgcd(b,a%b,y,x);\n    y-=a/b*x;\n}\ninline LL getInv(LL a) {\n    LL x,y;exgcd(a,P,x,y);\n    return (x%P+P)%P;\n}\nvoid write(LL x){\n\tif(x==0){putchar(48);return;}\n\tint len=0,dg[25];\n\twhile(x>0){dg[++len]=x%10ll;x/=10ll;}\n\tfor(int i=len;i>=1;i--)putchar(dg[i]+48);\n}\ninline void NTT(_LL *f,int o) {\n    for(re int i=0;i<len;i++) if(i<rev[i]) std::swap(f[i],f[rev[i]]);\n    for(re int i=2,k=0;i<=len;i<<=1,k++) {\n        int ln=i>>1;\n        LL og1;\n        if(!mi[o][k]) {mi[o][k]=og1=ksm(G[o],(mod-1)/i);}\n        else og1=mi[o][k];\n        for(re int l=0;l<len;l+=i) {\n        \tog=1;\n            for(re int x=l;x<ln+l;++x) {\n                t=(f[ln+x]*og)%mod;\n                f[ln+x]=(f[x]-t+mod)%mod;\n                f[x]=(f[x]+t)%mod;\n                og=(og*og1)%mod;\n            }\n        }\n    }\n    if(!o) return;\n    _LL inv=ksm(len,mod-2);\n    for(re int i=0;i<len;i++) f[i]=(f[i]*inv)%mod;\n}\nvoid dfs(int x,int Fa) {\n    ++k;\n    fa[x]=Fa;vis[x]=1;\n    for(re int i=head[x];i;i=e[i].nxt) {\n        if(vis[e[i].v]) continue;\n        dfs(e[i].v,Fa); \n    }\n}\nvoid Dfs(int x,int fa,int p) {\n    for(re int i=head[x];i;i=e[i].nxt) {\n        if(e[i].v==fa) continue;\n        pre[e[i].v]=pre[x]+e[i].w;\n        if(pre[e[i].v]<Y) tax[p][pre[e[i].v]]++;\n            else tp[p]+=pre[e[i].v];\n        Dfs(e[i].v,x,p);\n    }\n}\ninline void mul() {\n    NTT(A,0),NTT(B,0);\n    for(re int i=0;i<len;i++) A[i]=(A[i]*B[i])%mod;\n    NTT(A,1);\n    for(re int i=0;i<Y;i++) A[i]%=P;\n    //\u4e2d\u95f4\u53d6\u6a21\u7684\u7b80\u6613\u7248\u4efb\u610f\u6a21\u6570NTT\n    for(re int i=Y;i<len;i++) A[i]=0;\n}\nint main() {\n    G[0]=19ll,G[1]=ksm(19ll,mod-2);\n    n=read(),m=read(),X=read(),Y=read();\n    for(re int x,y,z,i=1;i<=m;i++)\n        x=read(),y=read(),z=read(),add(x,y,z),add(y,x,z);\n    LL cnt=0,H=0,T=0;\n    for(re int i=1;i<=n;i++)\n    if(!vis[i]) {\n        k=0;++tot,dfs(i,tot); \n        k=k*(k-1ll)/2ll;sum[tot]=k;\n        tmp=(tmp*k)%P;\n    }\n    Y-=tot*X;\n    for(re int i=1;i<=n;i++) pre[i]=0,Dfs(i,0,fa[i]);\n    A[0]=1;len=1;while(len<Y+Y) len<<=1;\n    for(re int i=0;i<len;i++) rev[i]=rev[i>>1]>>1|((i&1)?len>>1:0);\n    for(re int i=1;i<=tot;i++) {\n        for(re int j=0;j<len;j++) B[j]=0;\n        LL inv=tmp*getInv(sum[i])%P;\n        for(re int j=0;j<Y;j++) {\n            B[j]=(tax[i][j]/2);\n            H+=(inv*(LL)j%P*(LL)(tax[i][j]/2ll)%P);\n            H%=P;\n        }\n        H+=inv*(tp[i]/2ll)%P;H%=P;\n        mul();\n    }\n    //H\u662f\u6240\u6709\u73af\u7684\u957f\u5ea6\u548c\uff0ctmp\u662f\u6240\u6709\u73af\u7684\u65b9\u6848\u6570\n    //cnt\u662f\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u73af\u7684\u65b9\u6848\u6570\uff0cT\u662f\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u73af\u7684\u957f\u5ea6\u548c\n    for(re int i=1;i<Y;i++) \n        cnt=(cnt+A[i])%P,T=(T+A[i]*(LL)i%P)%P;\n    H=(H-T+P)%P;\n    tmp=(tmp-cnt+P)%P;\n    H+=tmp*(LL)tot%P*(LL)X%P;H%=P;\n    if(tot==1) {write(H);return 0;}\n    if(tot==2) write(H*2ll%P);\n    else {\n        LL pw=2,now=4;tot-=2;\n        for(re int i=1;i<=tot;i++)\n            pw=(pw*now)%P,now=(now+2ll)%P;\n        write(H*pw%P);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1553607288,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5243 \u3010[USACO19FEB]Moorio Kart\u3011"
    },
    {
        "content": "\u89c9\u5f97xyx\u8bb2\u7684\u975e\u5e38\u597d\n\n\u5c31\u7528\u4e00\u4e0b\u4ed6\u7684\u5199\u6cd5\u5427\n\n\u8003\u8651\u7528\u6240\u6709\u7684\u8def\u5f84\u51cf\u53bb\u4e0d\u5408\u6cd5\u7684\u8def\u5f84\u7684\u957f\u5ea6\u3002\n\n\u6240\u6709\u8def\u5f84\u7684\u957f\u5ea6\u662f\u5bb9\u6613\u8ba1\u7b97\u7684\uff0c\u53ea\u9700\u8981\u8003\u8651\u6bcf\u4e00\u6761\u8fb9\u88ab\u7edf\u8ba1\u4e86\u591a\u5c11\u6b21\u3002\n\n\u4e0d\u5408\u6cd5\u7684\u8def\u5f84\u5373\u957f\u5ea6\u4e0d\u8db3 Y \u7684\u8def\u5f84\uff0c\u53ef\u4ee5\u901a\u8fc7\u6bcf\u4e00\u4e2a\u8054\u901a\u5757\u5185\u8def\u5f84\u7684\u6570\u7ec4\u5377\u79ef\u5f97\u5230\u3002\n\n\u6ce8\u610f\u5230\u5f53\u4e14\u4ec5\u5f53\u8054\u901a\u5757\u5927\u5c0f\u8fbe\u5230 \u7684\u7ea7\u522b\uff0c\n\n\u4e0d\u8db3 Y \u7684\u6240\u6709\u8def\u5f84\u957f\u5ea6\u624d\u6709\u53ef\u80fd\u88ab\u5168\u90e8\u53d6\u5230\uff0c\n\n\u56e0\u6b64\u5728\u5377\u79ef\u65f6\u7279\u5224\u6570\u7ec4\u4e2d\u4e3a 0\u7684\u4f4d\u7f6e\u8df3\u8fc7\u5373\u53ef\u3002\n\n\u6240\u4ee5\u6211\u4eec\u66b4\u529b\u679a\u4e3e\u5373\u53ef\n\n\u590d\u6742\u5ea6\u591a\u4e00\u4e2a\u6839\u53f7\uff1a\n\n```cpp\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst ll p = 1e9 + 7;\nconst int N = 2505;\nint to[N << 1], nxt[N << 1], len[N << 1], fir[N], bel[N], fa[N], ecnt, cnt, x, y;\nll tot[N][N], f[N][2], g[N][2], sum[N][N], ans;\ntemplate <typename T> inline void upd(T &a, T b) {a = (a + b) % p;}\nint find(int u) {return fa[u] = fa[u] == u ? u : find(fa[u]);}\nvoid ae(int u, int v, int w) {to[++ecnt] = v; nxt[ecnt] = fir[u]; len[ecnt] = w; fir[u] = ecnt;}\nvoid build(int u, int f, int id) {\n    int v, i;\n    bel[u] = id;\n    for (i = fir[u]; i; i = nxt[i]) {\n        v = to[i];\n        if (v != f) build(v, u, id);\n    }\n}\nvoid dfs(int u, int f, int l) {\n    int v, w, i;\n    if (f) {upd(sum[bel[u]][min(l, y)], 1ll * l); ++tot[bel[u]][min(l, y)];}\n    for (i = fir[u]; i; i = nxt[i]) {\n        v = to[i]; w = len[i];\n        if (v != f) dfs(v, u, l + w);\n    }\n}\nint main() {\n    int n, m, now, u, v, w, i, j, k;\n    scanf(\"%d%d%d%d\", &n, &m, &x, &y);\n    for (i = 1; i <= n; ++i) fa[i] = i;\n    for (i = 1; i <= m; ++i) {\n        scanf(\"%d%d%d\", &u, &v, &w);\n        ae(u, v, w); ae(v, u, w);\n        fa[find(u)] = find(v);\n    }\n    for (i = 1; i <= n; ++i) if (i == find(i)) build(i, 0, ++cnt);\n    for (i = 1; i <= n; ++i) dfs(i, 0, 0);\n    now = min(cnt * x, y); f[now][0] = 1; f[now][1] = cnt * x;\n    for (i = 1; i <= cnt; ++i) {\n        for (j = now; j <= y; ++j) {g[j][0] = f[j][0]; g[j][1] = f[j][1]; f[j][0] = f[j][1] = 0;}\n        for (j = 0; j <= y; ++j)\n            if (tot[i][j])\n                for (k = now; k <= y; ++k)\n                    if (g[k][0]) {\n                        upd(f[min(j + k, y)][0], 1ll * g[k][0] * tot[i][j]);\n            \t\t\tupd(f[min(j + k, y)][1], 1ll * g[k][0] * sum[i][j] + 1ll * g[k][1] * tot[i][j]);\n                    }\n    }\n    ans = f[y][1];\n    for (i = 1; i < cnt; ++i) ans = ans * i % p;\n    printf(\"%lld\\n\", ans * 500000004 % p);\n    return 0;\n}\n\n```\n",
        "postTime": 1552128777,
        "uid": 30817,
        "name": "muller",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5243 \u3010[USACO19FEB]Moorio Kart\u3011"
    }
]