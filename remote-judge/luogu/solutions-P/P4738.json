[
    {
        "content": "\u8003\u8651\u4e00\u4e2a\u5b50\u6ee1\u4e8c\u53c9\u6811\u7684 Prufer \u5e8f\u5217\u60c5\u51b5\uff0c\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u9012\u5f52\u5230\u6b64\u65f6\u6839\u6709\u7236\u4eb2\uff0c\u90a3\u4e48\u5fc5\u987b\u628a\u5b50\u6811\u4e2d\u5176\u4ed6\u70b9\u5265\u5b8c\u624d\u80fd\u8f6e\u5230\u8fd9\u4e2a\u70b9\uff0c\u800c\u5de6\u8fb9\u7684\u70b9\u7f16\u53f7\u5c0f\uff0c\u6240\u4ee5\u662f**\u5de6->\u53f3->\u4e2d**\u7684\u987a\u5e8f\uff1b\u800c\u5982\u679c\u6839\u6ca1\u6709\u7236\u4eb2\uff08\u8fd9\u8868\u793a\u8fd9\u4e2a\u70b9\u5728\u6839\u7ed3\u70b9\u5f80\u53f3\u7684\u94fe\u4e0a\uff09\uff0c\u90a3\u4e48\u5265\u5b8c\u5de6\u8fb9\u540e\u53ef\u4ee5\u76f4\u63a5\u5220\u6389\u6839\uff0c\u6240\u4ee5\u662f**\u5de6->\u4e2d->\u53f3**\u7684\u987a\u5e8f\u3002\n\n\u4f46\u662f\u5982\u679c\u76f4\u63a5\u9012\u5f52\u662f $O(2^n)$ \u7684\uff0c\u6709\u70b9\u79bb\u8c31\uff0c\u4f46\u662f\u7531\u4e8e\u5927\u5c0f\u76f8\u7b49\u7684\u5b50\u6811\u90fd\u662f\u957f\u5f97\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u4e00\u90e8\u5206\u9884\u5904\u7406\u6765\u8fdb\u884c\u5e73\u8861\u89c4\u5212\u3002\n\n\u6211\u4eec\u4e8b\u5148\u9884\u5904\u7406\u51fa\u5927\u5c0f\u4e0d\u8d85\u8fc7 $2^d$ \u7684\u6ee1\u4e8c\u53c9\u6811\u7684 Prufer \u5e8f\u5217\u4e2d\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u4e0b\u6807\u7684\u6c42\u548c\uff0c\u7136\u540e\u9012\u5f52\u65f6\u53ea\u8981\u5f53\u524d\u5b50\u6811\u5927\u5c0f\u4e0d\u8d85\u8fc7 $2^d$ \u5c31\u4f7f\u7528\u9884\u5904\u7406\u7ed3\u679c\uff08\u7531\u4e8e\u4e00\u4e2a\u5b50\u6811\u7f16\u53f7\u8fde\u7eed\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u901a\u8fc7\u9884\u5904\u7406\u4fe1\u606f\u7ebf\u6027\u53d8\u6362\u5c31\u53ef\u4ee5\u5f97\u5230\u60f3\u8981\u7684\u7ed3\u679c\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(q(2^d+2^{n-d}))$\uff0c\u53d6 $d=\\dfrac{n}{2}$\uff0c\u590d\u6742\u5ea6\u4e3a $O(q2^{n/2})$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int MAXN=100010;\nint k,q,a,b,c,tot,tot2,num[MAXN][2],num2[MAXN][2];\nll ans,sum[MAXN][2],sum2[MAXN][2];\nvoid dfs1 (int d,int a,int b,int c,int dd) {\n\tif (d>k-15) {return;}\n\tdfs1(d+1,a*2,b*2,a,b);\n\tdfs1(d+1,a*2,b*2+1,a,b);\n\ttot++;\n\tnum[tot][0]=c,num[tot][1]=dd;\n\treturn;\n}\nvoid dfs1p5 (int d,int a,int b,int c,int dd,int flg) {\n\tif (d>k-15) {return;}\n\tif (flg) {\n\t\tdfs1p5(d+1,a*2,b*2,a,b,1);\n\t\tdfs1p5(d+1,a*2,b*2+1,a,b,1);\n\t\ttot2++;\n\t\tnum2[tot2][0]=c,num2[tot2][1]=dd;\n\t\treturn;\n\t}\n\tdfs1p5(d+1,a*2,b*2,a,b,1);\n\ttot2++;\n\tnum2[tot2][0]=2*a,num2[tot2][1]=2*b+1;\n\tdfs1p5(d+1,a*2,b*2+1,a,b,0);\n\treturn;\n}\nbool chk (int x) {\n\treturn (a<=x&&x<=c&&(c-x)%b==0);\n}\nvoid dfs2 (int x,int d,int flg) {\n\tif (d>k) {return;}\n\tif (flg) {\n\t\tif (d<=15&&d+1<=k) {\n\t\t\tdfs2(2*x,d+1,1);\n\t\t\tif (chk(1)) {ans+=x;}\n\t\t\ta--,c--;\n\t\t\tdfs2(2*x+1,d+1,1);\n\t\t\tif (chk(1)) {ans+=x;}\n\t\t\ta--,c--;\n\t\t\treturn;\n\t\t} else if (d>15) {\n\t\t\tint l,r,siz=(1<<(k-15))-2;\n\t\t\tif (a>0) {l=max(a-b,0);}\n\t\t\telse {l=0;}\n\t\t\tif (c>siz) {r=((c-siz)%b==0?siz:siz+(c-siz)%b-b);}\n\t\t\telse {r=c;}\n\t\t\tif (r>0&&l<r) {ans+=1ll*x*(sum[r][0]-sum[l][0])+sum[r][1]-sum[l][1];}\n\t\t\ta-=siz,c-=siz;\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\tif (d<=15&&d+1<=k) {\n\t\t\tdfs2(2*x,d+1,1);\n\t\t\tif (chk(1)) {ans+=x;}\n\t\t\ta--,c--;\n\t\t\tif (chk(1)) {ans+=2*x+1;}\n\t\t\ta--,c--;\n\t\t\tdfs2(2*x+1,d+1,0);\n\t\t\treturn;\n\t\t} else if (d>15) {\n\t\t\tint l,r,siz=(1<<(k-15))-3;\n\t\t\tif (a>0) {l=max(a-b,0);}\n\t\t\telse {l=0;}\n\t\t\tif (c>siz) {r=((c-siz)%b==0?siz:siz+(c-siz)%b-b);}\n\t\t\telse {r=c;}\n\t\t\tif (r>0&&l<r) {ans+=1ll*x*(sum2[r][0]-sum2[l][0])+sum2[r][1]-sum2[l][1];}\n\t\t\ta-=siz,c-=siz;\n\t\t\treturn;\n\t\t}\n\t}\n}\nint main () {\n\tscanf(\"%d%d\",&k,&q);\n\tdfs1(1,1,0,0,0);\n\tdfs1p5(1,1,0,0,0,0);\n\tfor (int i=1;i<=q;i++) {\n\t\tscanf(\"%d%d%d\",&a,&b,&c);\n\t\tc=a+(c-1)*b;\n\t\tfor (int i=1;i<=tot;i++) {\n\t\t\tsum[i][0]=(i>=b?sum[i-b][0]:0)+num[i][0];\n\t\t\tsum[i][1]=(i>=b?sum[i-b][1]:0)+num[i][1];\n\t\t\tsum2[i][0]=(i>=b?sum2[i-b][0]:0)+num2[i][0];\n\t\t\tsum2[i][1]=(i>=b?sum2[i-b][1]:0)+num2[i][1];\n\t\t}\n\t\tans=0;\n\t\tdfs2(1,1,0);\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1623830614,
        "uid": 113546,
        "name": "ix35",
        "ccfLevel": 10,
        "title": "[CERC2017]Cumulative Code \u9898\u89e3"
    }
]