[
    {
        "content": "# \u5e7f\u544a\n\n### [\u849f\u84bb\u306eblog](http://www.cnblogs.com/dedicatus545/p/8831000.html)\n\n# \u6b63\u6587\n\n\u9996\u5148\uff0c\u6709\u4e00\u4e2a\u7ed3\u8bba\uff1a\u4e24\u4e2a\u624b\u73af\u589e\u52a0\u975e\u8d1f\u6574\u6570\u4eae\u5ea6\uff0c\u7b49\u4e8e\u5176\u4e2d\u4e00\u4e2a\u589e\u52a0\u4e00\u4e2a\u6574\u6570\u4eae\u5ea6\uff08\u53ef\u4ee5\u4e3a\u8d1f\uff09\n\n\u6211\u4eec\u4ee4\u589e\u52a0\u91cf\u4e3a$x$\uff0c\u65cb\u8f6c\u4ee5\u540e\u7684\u539f\u6570\u5217\u4e3a$\\{a\\}\\{b\\}$\u90a3\u4e48\u73b0\u5728\u7684\u8d39\u7528\u5c31\u662f\uff1a\n\n### $\\sum_{i=1}^n\\left(a_i+x-b_i\\right)^2$\n\n\u6211\u4eec\u628a\u7b2ci\u9879\u62ff\u51fa\u6765\u62c6\u5f00\uff0c\u5f97\u5230\uff1a\n\n### $\\left(a_i+x-b_i\\right)^2=a_i^2+b_i^2+x^2+2a_ix-2a_ib_i-2b_ix$\n\n\u90a3\u4e48\u539f\u5f0f\u53d8\u6210\u4e86\n\n### $\\sum_{i=1}^na_i^2+\\sum_{i=1}^nb_i^2+nx^2+2x\\left(\\sum_{i=1}^na_i-\\sum_{i=1}^nb_i\\right)-2\\sum_{i=1}^na_ib_i$\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u9664\u4e86\u6700\u540e\u4e00\u9879\u4e4b\u5916\u90fd\u662f\u786e\u5b9a\u7684QwQ\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u4ee4\u6700\u540e\u4e00\u9879\u6700\u5927\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5f97\u5230\u6700\u5c0f\u7684\u8d39\u7528\u503c\u4e86\n\n### \u73b0\u5728\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42$\\sum_{i=1}^na_ib_i$\u7684\u6700\u5927\u503c\n\n\u7b49\u7b49\uff0c\u8fd9\u4e2a\u5f62\u5f0f......\n\n\u6211\u4eec\u628a\u6570\u5217$\\{a\\}$\u53cd\u8fc7\u6765\uff0c\u53d8\u6210\n\n### $\\sum_{i=1}^na_{n-i+1}b_i$\n\n\u8fd9\u4e0d\u662f\u4e00\u4e2a\u5377\u79ef\u5417~\n\n\u6240\u4ee5\u628a\u53cd\u8fc7\u6765\u7684\u6570\u5217$\\{a\\}$\u500d\u957f\uff0c\u548c\u6570\u5217$\\{b\\}$\u5377\u79ef\uff0c\u5f97\u5230\u7684\u9879\u91cc\u9762\u7684\u7b2cn+1\u5230n\\*2\u9879\u7684\u6700\u5927\u503c\uff0c\u5c31\u662f$\\sum_{i=1}^na_ib_i$\u7684\u6700\u5927\u503c\n\n\u7136\u540e\u628a\u524d\u9762\u7684\u4e0d\u53d8\u9879\u52a0\u4e0a\uff0c\u5c31\u662f\u7b54\u6848\u4e86\n\nCode\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#define ll long long\n#define inf 1e15\nusing namespace std;\ninline int read(){\n    int re=0,flag=1;char ch=getchar();\n    while(ch>'9'||ch<'0'){\n        if(ch=='-') flag=-1;\n        ch=getchar();\n    }\n    while(ch>='0'&&ch<='9') re=(re<<1)+(re<<3)+ch-'0',ch=getchar();\n    return re*flag;\n}\nstruct complex{\n    double x,y;\n    complex(double xx=0,double yy=0){x=xx;y=yy;}\n    complex operator +(const complex &b){return complex(x+b.x,y+b.y);}\n    complex operator -(const complex &b){return complex(x-b.x,y-b.y);}\n    complex operator *(const complex &b){return complex(x*b.x-y*b.y,x*b.y+y*b.x);}\n}A[400010],B[400010];\nconst double pi=acos(-1.0);\nint n,m,limit=1,cnt=0,r[400010];\nvoid fft(complex *a,double type){\n    int i,j,mid,k;complex x,y,w,wn;\n    for(i=0;i<limit;i++) if(i<r[i]) swap(a[i],a[r[i]]);\n    for(mid=1;mid<limit;mid<<=1){\n        wn=complex(cos(pi/mid),type*sin(pi/mid));\n        for(j=0;j<limit;j+=(mid<<1)){\n            w=complex(1,0);\n            for(k=0;k<mid;k++,w=w*wn){\n                x=a[j+k];y=w*a[j+k+mid];\n                a[j+k]=x+y;a[j+k+mid]=x-y;\n            }\n        }\n    }\n}\nll a1=0,a2=0,b1=0,b2=0,ans=inf;\nint a[100010],b[100010];\nint main(){\n    ll i,j;\n    n=read();m=read();\n    for(i=1;i<=n;i++){\n        a[i]=read();\n        a1+=a[i]*a[i];a2+=a[i];\n    }\n    for(i=1;i<=n;i++){\n        b[i]=read();\n        b1+=b[i]*b[i];b2+=b[i];\n    }\n    for(i=1;i<=n;i++){\n        A[i].x=A[i+n].x=a[i];\n        B[i].x=b[n-i+1];\n    }\n    \n    while(limit<=(n*3)) limit<<=1,cnt++;\n    for(i=0;i<limit;i++) r[i]=((r[i>>1]>>1)|((i&1)<<(cnt-1)));\n    \n    fft(A,1);fft(B,1);\n    for(i=0;i<=limit;i++) A[i]=A[i]*B[i];\n    fft(A,-1);\n    for(i=0;i<=limit;i++) A[i].x=(ll)(A[i].x/limit+0.5);\n    \n    for(i=1;i<=n;i++){\n        for(j=-m;j<=m;j++){\n            ans=min(ans,a1+b1+j*j*n+2ll*j*(a2-b2)-2ll*(ll)A[i+n].x);\n        }\n    }\n    printf(\"%lld\",ans);\n}\n```",
        "postTime": 1523676593,
        "uid": 27753,
        "name": "Orion545",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "$\\text{FFT}$\u7ecf\u5178\u9898\n\n**\u9898\u610f**\n\n\u7ed9\u5b9a\u6570\u5217$a,b$\uff0c$b$\u53ef\u4ee5\u5faa\u73af\u79fb\u52a8\uff0c\u9009\u62e9\u6574\u6570$c$\uff0c\u6c42$\\sum_{i=1}^n(a_i-b_i+c)^2$\u6700\u5c0f\u503c\n\n**\u9898\u89e3**\n\n\u5316\u7b80\u5f0f\u5b50\uff1a\n\n$$\\sum_{i=1}^n(a_i-b_i+c)^2$$\n\n$$=\\sum_{i=1}^n(a_i-b_i)^2+c^2+2c(a_i-b_i)$$\n\n$$=\\sum_{i=1}^n a_i^2+b_i^2-2a_ib_i+c^2+2a_ic-2b_ic$$\n\n$$=\\sum_{i=1}^na_i^2+\\sum_{i=1}^nb_i^2-2\\sum_{i=1}^na_ib_i+nc^2+2c\\sum_{i=1}^n(a_i-b_i)$$\n\n\u524d\u9762\u4e24\u9879\u662f\u5b9a\u503c\uff0c\u540e\u9762\u4e24\u9879\u662f\u5173\u4e8e$c$\u7684\u4e8c\u6b21\u51fd\u6570\uff0c\u6c42\u5bf9\u79f0\u8f74\uff0c\u627e\u5230\u5bf9\u79f0\u8f74\u6700\u8fd1\u7684\u4e24\u4e2a\u6574\u6570\u5750\u6807\u6bd4\u8f83\u4e00\u4e0b\u3002\u4e8e\u662f\u4efb\u52a1\u53d8\u4e3a\u6700\u5927\u5316$\\sum_{i=1}^na_ib_i$\u3002\n\n\u8fd9\u73a9\u610f\u5148\u7834\u73af\u4e3a\u94fe\uff0c\u5373$b_{i+n}=b_i$\uff0c\u5c31\u4e0d\u7528\u7ba1\u73af\u4e86\n\n\u8003\u8651\u628a\u79fb\u52a8$k$\u4f4d\u65f6\u5019\u7684\u7b54\u6848\uff1a$\\sum_{i=1}^n a_ib_{i+k}$\n\n\u8fd9\u79cd\u5f62\u5f0f\u975e\u5e38\u5377\u79ef\uff0c\u56e0\u4e3a\u7ffb\u8f6c$a$\u6570\u7ec4\u540e\uff1a$\\sum_{i=1}^n a_{n-i+1}b_{i+k}$\n\n\u5c31\u53ef\u4ee5$\\text{FFT}$\u5377\u79ef\u4e86\uff0c\u7136\u540e\u5377\u79ef\u5b8c\u4e86\u626b\u4e00\u904d\u6c42\u4e2a$\\max\t$\n\n```cpp\n#include <algorithm>\n#include <complex>\n#include <cstdio>\n#include <cmath>\nusing namespace std;\n\ntypedef long long ll;\ntypedef complex<double> cex;\n\nconst int N = 1e6 + 10;\nconst double PI = acos(-1);\n\nint n, m, a[N], b[N];\nll ans, t, res[N], mx;\n\nint r[N];\nvoid fft(cex *c, int lim, int type)  {\n\tfor(int i = 1; i < lim; i ++)\n\t\tif(i < r[i]) swap(c[i], c[r[i]]);\n\tfor(int n = 1; n < lim; n <<= 1) {\n\t\tcex x(cos(PI / n), type * sin(PI / n));\n\t\tfor(int i = 0; i < lim; i += (n << 1)) {\n\t\t\tcex y(1, 0);\n\t\t\tfor(int k = 0; k < n; k ++, y *= x) {\n\t\t\t\tcex p = c[i + k], q = y * c[i + k + n];\n\t\t\t\tc[i + k] = p + q; c[i + k + n] = p - q;\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid _transform(int *a, int *b, int n, int m, ll *ans) {\n\tstatic cex f[N], g[N];\n\tint lim = 1, l = 0;\n\tfor(int i = 1; i <= n; i ++) f[i].real(a[i]);\n\tfor(int i = 1; i <= m; i ++) g[i].real(b[i]);\n\tfor(n += m; lim <= n + m; lim <<= 1) l ++;\n\tfor(int i = 1; i < lim; i ++)\n\t\tr[i] = (r[i >> 1] >> 1) | ((i & 1) << (l - 1));\n\tfft(f, lim, 1), fft(g, lim, 1);\n\tfor(int i = 0; i < lim; i ++) f[i] *= g[i];\n\tfft(f, lim, -1);\n\tfor(int i = 1; i <= n; i ++)\n\t\tans[i] = (ll)(0.5 + f[i].real() / lim);\n}\n\nint main() {\n\tscanf(\"%d%d\", &n, &m);\n\tfor(int i = 1; i <= n; i ++) scanf(\"%d\", &a[i]);\n\tfor(int i = 1; i <= n; i ++) scanf(\"%d\", &b[i]);\n\tfor(int i = 1; i <= n; i ++) {\n\t\tans += a[i] * a[i] + b[i] * b[i]; t += b[i] - a[i];\n\t}\n\tint c1 = floor(t * 1.0 / n), c2 = ceil(t * 1.0 / n);\n\tans += min(n * c1 * c1 - 2 * c1 * t, n * c2 * c2 - 2 * c2 * t);\n\t\n\tfor(int i = 1; i <= n; i ++) b[i + n] = b[i];\n\treverse(a + 1, a + n + 1);\n\t_transform(a, b, n, n << 1, res);\n\tll tmp = 0;\n\tfor(int i = 0; i <= n; i ++)\n\t\ttmp = max(tmp, res[i + n + 1]);\n\tans -= (tmp << 1);\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1547904077,
        "uid": 20375,
        "name": "hongzy",
        "ccfLevel": 9,
        "title": "P3723 \u300cAHOI 2017\u300d\u793c\u7269\u300cFFT\u300d"
    },
    {
        "content": "\u62c6\u5f0f\u5b50\u5957\u8def\u9898\n\n\u6ce8\u610f\u5230$c$\u53ef\u4ee5\u52a0\u5728$a$\u4e0a\u4e5f\u53ef\u4ee5\u52a0\u5728$b$\u4e0a\uff0c\u6240\u4ee5\u7b49\u4ef7\u4e8e\u53ef\u4ee5\u7ed9\u5e8f\u5217$a$\u4e0a\u52a0\u4e0a\u4e00\u4e2a\u5927\u5c0f\u4efb\u610f\u7684$c$\n\n\u6211\u4eec\u628a\u5f0f\u5b50\u4e00\u62c6\uff1a\n\n$$\\sum_{i=1}^n(a_i-b_i+c)^2$$\n\n$$\\sum_{i=1}^na_i^2+b_i^2+c^2+2a_i*c-2*b_i*c-2*a_ib_i$$\n\n$$\\sum_{i=1}^n(a_i^2+b_i^2)+2*(\\sum_{i=1}^na_i-b_i)c+n*c^2-2*\\sum_{i=1}^na_i*b_i$$\n\n\u9009\u5b9a\u90a3\u4e2a$x$\u53ef\u4ee5\u4e8c\u6b21\u51fd\u6570\u7b97\n\n\u4e8e\u662f\u4ea4\u6362\u987a\u5e8f\u5bf9\u7b54\u6848\u9020\u6210\u7684\u5f71\u54cd\u53ea\u6709\u6700\u540e\u8fd9\u4e00\u5768\n\n$$\\sum_{i=1}^na_i*b_i$$\n\n\u76ee\u6807\u662f\u6700\u5927\u5316\u5b83\n\n\u5982\u679c\u4f60\u548c\u6211\u4e00\u6837\u7684$naive$\u53ef\u80fd\u4f1a\u60f3\u8d77\u6765\u4e00\u4e2a\u5b9a\u7406\uff0c\u628a\u4e24\u4e2a\u6392\u5e8f\u540e\u4e24\u4e24\u4e58\u8d77\u6765\u6700\u5927\uff0c\u7136\u800c\u8fd9\u6837\u4e0d\u884c\uff0c\u56e0\u4e3a\u76f8\u5bf9\u5173\u7cfb\u4e0d\u80fd\u6539\u53d8\uff08\u53ea\u80fd\u65cb\u8f6c\uff09\n\n\u6211\u4eec\u5c1d\u8bd5\u6784\u9020\u65b0\u7684\u4e00\u7ec4$a$\u6ee1\u8db3\uff1a\n\n$$a_i'=a_{n-i}$$\n\n\u4e8e\u662f\u539f\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e3a\uff0c\u6c42\u89e3\uff1a\n\n$$\\sum_{i=1}^na_{n-i}'*b_i$$\n\n\u6b64\u5904$b$\u5e8f\u5217\u53ef\u4ee5\u65cb\u8f6c\n\n\u6211\u4eec\u60ca\u4eba\u7684\u53d1\u73b0\u5b83\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\n\n\u63a5\u4e0b\u6765\u8003\u8651$b$\u7684\u65cb\u8f6c\n\n\u4f60\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u4ee4$c$\u4e3a$a'$\u4e0e$b$\u8fdb\u884c\u5377\u79ef\u8fd0\u7b97\u5f97\u5230\u7684\u7ed3\u679c\n\n\u90a3\u4e48$c_x=\\sum_{i=0}^xa'_{x-i}*b_i$\n\n\u5982\u679c\u4ee4$b_0=0,a_{n+1,n+2...n+n}=0$\n\n\u5c31\u6709\uff1a\n\n$$c_n=\\sum_{i=1}^na_{n-i}'*b_i$$\n\n$$c_{n+1}=\\sum_{i=1}^na_{n-i}'b_{i+1}$$\n\n\u4f60\u53d1\u73b0\u6211\u4eec\u53ea\u9700\u8981\u4ee4$b_{n+1}=b_1$\uff0c\u5c31\u80fd\u901a\u8fc7$c_{n+1}$\u8868\u793a\u65cb\u8f6c\u4e00\u4f4d\u540e\u5377\u79ef\u7684\u7ed3\u679c\u4e86\n\n\u540c\u7406\u6211\u4eec\u4ee4$b_{n+k}=b_k$\n\n\u4e8e\u662f\u5c31\u53ea\u8981\u505a\u4e00\u904d\u5feb\u4e50\u7684$NTT$\u5c31\u884c\u4e86$qwq$\n\n\u56e0\u4e3a\u5377\u79ef\u6700\u5927\u7684\u7ed3\u679c\u662f$100*100*50000=5*10^8$\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528$998244353$\n\n------------\n\n\u5751\u70b9\uff1a\n\n$C++$\u662f\u9ed8\u8ba4\u7684\u5411$0$\u53d6\u6574\uff0c\u6b64\u5904\u8ba1\u7b97\u5408\u9002\u7684$x$\u8981\u56db\u820d\u4e94\u5165\uff0c\u6240\u4ee5\u8981\u5206\u7c7b\u8ba8\u8bba$...$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define rep( i, s, t ) for( register int i = s; i <= t; ++ i )\n#define re register\n#define LL long long\n#define int long long\nint read() {\n\tchar cc = getchar(); int cn = 0, flus = 1;\n\twhile(cc < '0' || cc > '9') {  if( cc == '-' ) flus = -flus;  cc = getchar();  }\n\twhile(cc >= '0' && cc <= '9')  cn = cn * 10 + cc - '0', cc = getchar();\n\treturn cn * flus;\n}\nconst LL P = 998244353 ; \nconst LL Gi = 332748118 ; \nconst LL G = 3 ; \nconst int N = 400000 + 5 ;\nint n, m, limit, L, R[N] ; \nLL A[N], B[N], Ans, K, X, Inv ;\nLL fpow( LL x, LL k ) {\n\tLL base = x, ans = 1 ; \n\twhile( k ) {\n\t\tif( k & 1 ) ans *= base, ans %= P ; \n\t\tbase *= base, base %= P, k >>= 1 ;  \n\t}\n\treturn ans ; \n}\nvoid init( int x ) {\n\tlimit = 1, L = 0 ;\n\twhile( limit <= x ) limit <<= 1, ++ L ; \n\tfor( int i = 0; i < limit; ++ i ) R[i] = ( R[i >> 1] >> 1 ) | ( ( i & 1 ) << ( L - 1 ) ) ;\n\tInv = fpow( limit, P - 2 ) ;\n}\nvoid NTT( LL *a, int type ) {\n\tfor( int i = 0; i < limit; ++ i )\n\tif( i < R[i] ) swap( a[i], a[R[i]] ) ;\n\tfor( int k = 1; k < limit; k <<= 1 ) {\n\t\tLL dg = fpow( ( type == 1 ) ? G : Gi, ( P - 1 ) / ( k << 1 ) ); \n\t\tfor( int i = 0; i < limit; i += ( k << 1 ) )\n\t\tfor( LL j = i, g = 1; j < i + k; ++ j, g = ( g * dg ) % P ) {\n\t\t\tLL Nx = a[j], Ny = ( a[j + k] * g ) % P;\n\t\t\ta[j] = ( Nx + Ny ) % P, a[j + k] = ( Nx - Ny + P ) % P ; \n\t\t}\n\t}\n\tif( type != 1 ) rep( i, 0, limit ) a[i] = a[i] * Inv % P ; \n}\nsigned main()\n{\n\tn = read(), m = read() ; \n\trep( i, 1, n ) A[n - i] = read(), Ans += A[n - i] * A[n - i], K += A[n - i] ;\n\trep( i, 1, n ) B[n + i] = B[i] = read(), Ans += B[i] * B[i], K -= B[i] ;\n\tK *= 2 ; double toX = -1.0 * K / n / 2 ;\n\tif( toX > 0 ) X = (LL)( toX + 0.5 ) ;\n\telse X = (LL)( toX - 0.5 ) ; \n\tinit( 3 * n ), Ans += X * X * n + K * X ;\n\tNTT( A, 1 ), NTT( B, 1 ) ; \n\trep( i, 0, limit ) A[i] = A[i] * B[i] % P ;\n\tNTT( A, -1 ) ; LL Rr = 0 ; \n\tfor( int i = n; i <= 2 * n + 1; ++ i ) Rr = max( Rr, A[i] ) ;\n\tprintf(\"%lld\\n\", Ans - 2 * Rr ) ;\n\treturn 0 ;\n}\n```",
        "postTime": 1566986661,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u5bb9\u6211\u8bf4\u4e00\u53e5\uff0c\u8fd9\u9053\u9898FFT\u7684\u7cbe\u5ea6\u635f\u5931\u5b9e\u5728\u662f\u592a\u5927\u4e86QAQ\neps\u5f00\u52301e-2\uff0c\u4e0d\u7136\u5927\u6570\u636e\u4f1a\u635f\u5931\u5f88\u591a\u7cbe\u5ea6\n##  \u6559\u4f60\u80ccFFT\u677f\u5b50\nfft\u7684\u8bdd\uff0c\u7b2c\u4e00\u5c31\u662foi\u5b8c\u5168\u4e0d\u9700\u8981\u7406\u89e3\u5b83\u7684\u539f\u7406\uff0c\u53ea\u9700\u8981\u77e5\u9053\u5b83\u80fd\u5e72\u4ec0\u4e48\u4ee5\u53ca\u600e\u4e48\u5199\uff0c\u7b2c\u4e8c\u5c31\u662f\u4ee3\u7801\u4e0d\u5b58\u5728\u5404\u79cd\u88ab\u9b54\u6539\u7684\u53ef\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u53ea\u8bb0\u7ed3\u8bba\uff0c\u7136\u540e\u5ffd\u7565\u8bc1\u660e\uff08\u5566\u5566\u5566~\uff09\n\n\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053FFT\u662f\u5e72\u4ec0\u4e48\u7528\u7684/\u5feb\u901f\u591a\u9879\u5f0f\u4e58\u6cd5/\u5f53\u7136\u4e5f\u53ef\u4ee5\u5feb\u901f\u9ad8\u7cbe\u4e58\n\n\u4e0b\u9762\u662f\u9884\u5907\u829d\u58eb~\n\n#### \u591a\u9879\u5f0f\u7684\u8868\u793a\n _(\u6ce8:\u4ee5\u4e0b\u5168\u90e8\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\uff0c\u90e8\u5206\u8868\u8ff0\u4e0d\u662f\u5f88\u4e25\u8c28\uff0c\u8bf7\u89c1\u8c05)_ \n \n \u9996\u5148\u6211\u4eec\u77e5\u9053\u5bf9\u4e8e\u4e00\u4e2a\u6700\u9ad8\u6b21\u7cfb\u6570\u4e3an\u7684\u591a\u9879\u5f0f\uff0c\u6709\u4e00\u4e2a\u663e\u800c\u6613\u89c1\u7684\u8868\u793a\u65b9\u6cd5\u5c31\u662f\n \u4ece\u5e38\u6570\u9879\u5199\u8d77\uff0c\u628a\u6bcf\u4e00\u9879\u7684\u7cfb\u6570\u90fd\u5199\u51fa\u6765\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5c31\u586b0\uff0c\u8fd9\u4e2a\u770b\u8d77\u6765\u663e\u800c\u6613\u89c1\u7684\u65b9\u6cd5\u5c31\u662f\u591a\u9879\u5f0f\u7684**\u7cfb\u6570\u8868\u793a**\uff0c(\u5f53\u7136\u4e5f\u53ef\u4ee5\u770b\u6210\u4e00\u4e2an+1\u7ef4\u5411\u91cf)\n \n \u4f46\u662f\u5462\uff0c\u521d\u4e2d\u8001\u5e08\u4f1a\u544a\u8bc9\u4f60\uff0c\u5f85\u5b9a\u7cfb\u6570\u6cd5\u662f\u53ef\u4ee5\u89e3\u51fa\u4e00\u4e2a\u591a\u9879\u5f0f\u6240\u6709\u7cfb\u6570\u7684\uff0c\u5e76\u4e14\uff0c\u6211\u4eec\u77e5\u9053\uff0cn\u4e2a\u672a\u77e5\u6570\u81f3\u5c11\u9700\u8981n\u4e2a\u65b9\u7a0b\u624d\u80fd\u89e3\u51fa\u6765\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u53d1\u73b0\u5982\u679c\u628a\u8fd9\u4e2a\u591a\u9879\u5f0f\u4ee3n\u4e2a\u503c\u8fdb\u53bb\uff0c\u5f97\u5230n\u4e2a\u6570\u5bf9(n,f(n))\uff0c\u6211\u4eec\u662f\u53ef\u4ee5\u901a\u8fc7\u5f85\u5b9a\u7cfb\u6570\u6cd5\u8fd8\u539f\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\uff0c\u8fd9\u4e00\u5806\u6570\u5bf9\u88ab\u79f0\u4e3a\u591a\u9879\u5f0f\u7684**\u70b9\u503c\u8868\u793a**(ps,\u4e00\u822c\u6765\u8bb2\uff0c\u5982\u679c\u6211\u4eec\u4ee3\u7684\u662f\u540c\u4e00\u5957\u6570\u7684\u8bdd\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u4e00\u7ef4\u6570\u7ec4\u8868\u793a\u70b9\u503c\uff0c\u5373\u53ea\u5b58\u51fd\u6570\u503c)\n \n####  \u6c42\u503c\u4e0e\u63d2\u503c\n\u4ece\u591a\u9879\u5f0f\u7684\u7cfb\u6570\u8868\u793a\u5411\u70b9\u503c\u8868\u793a\u7684\u8f6c\u5316\uff0c\u53eb\u505a**\u6c42\u503c**\uff0c\u800c\u4ece\u591a\u9879\u5f0f\u7684\u70b9\u503c\u8868\u793a\u5411\u7cfb\u6570\u8868\u793a\u7684\u8f6c\u5316\uff0c\u53eb\u505a**\u63d2\u503c**\n\n\u9996\u5148\u6211\u4eec\u6c42\u503c\u6211\u4eec\u8fd8\u662f\u4f1a\u7684\uff0c\u76f4\u63a5\u4ee3\u5165\uff0c\u7b97\u6cd5\u590d\u6742\u5ea6O(n^3)\n\n\u63d2\u503c\u6211\u4eec\u4e5f\u4f1a\uff0c\u5f85\u5b9a\u7cfb\u6570\u6cd5\uff0c\u9ad8\u65af\u524a\u5143\uff0c\u7b97\u6cd5\u590d\u6742\u5ea6O(n^3)\n\n\u4e8e\u662f\u6211\u4eec\u6709\u4e86\u4e00\u4e2a\u590d\u6742\u5ea6\u7206\u70b8\u7684\u7b97\u6cd5\n\n\u7136\u540e\u4f60\u4ed4\u7ec6\u7ffb\u9ad8\u4e2d\u6570\u5b66\u8bfe\u672c\uff0c\u4f60\u4f1a\u53d1\u73b0\u6709\u4e2a\u7b97\u6cd5\u53eb**\u79e6\u4e5d\u97f6\u7b97\u6cd5**(\u56fd\u5916\u7684\u8bdd\u53eb\u970d\u7eb3\u6cd5\u5219)\uff0c\u53ef\u4ee5O(n)\u6c42\u591a\u9879\u5f0f\u7684\u503c\uff0c\u597d\u4e86O(n^2)\u6c42\u503c\n\n\u4e4b\u540e\u6211\u4eec\u53d1\u73b0\u554a\uff0c\u5f85\u5b9a\u7cfb\u6570\u6cd5\u7684\u65b9\u7a0b\u7ec4\uff0c\u975e\u5e38\u7684\u6709\u89c4\u5f8b\uff0c\u6240\u4ee5\u56fd\u5916\u6709\u4e2a\u53eb\u62c9\u683c\u6717\u65e5\u7684\u5144\u5f1f\u5e2e\u4f60\u89e3\u597d\u4e86\uff0c\u540d\u5b57\u53eb**\u62c9\u683c\u6717\u65e5\u63d2\u503c\u516c\u5f0f**\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5O(n^2)\u63d2\u503c\n\n _(\u8fd9\u91cc\u6211\u5c31\u4e0d\u5199\u4e86\uff0c\u4f60\u4e5f\u4e0d\u4f1a\u9700\u8981\u5b83\u7684\uff0c\u6bd5\u7adfO(n^2)\u7684\u516c\u5f0f\u6ca1\u5565\u597d\u770b\u7684)_ \n \n \u597d\u4e86\u4f46\u95ee\u9898\u662f\uff0c\u65e2\u7136\u4e24\u79cd\u5f62\u6001\u5207\u6362\u8fd9\u4e48\u8d39\u52b2\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u5f15\u5165\u70b9\u503c\u8868\u8fbe\u5462\uff1f\n \n #### \u70b9\u503c\u8868\u8fbe\u7684\u4f18\u8d8a\u6027\n \n \u770b\u4f3c\u8d39\u52b2\u7684\u70b9\u503c\u8868\u8fbe\uff0c\u6709\u4e00\u4e2a\u80fd\u591f\u5b8c\u7206\u7cfb\u6570\u8868\u8fbe\u7684\u4f18\u70b9\n \n \u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u521d\u4e2d\u548c\u9ad8\u4e2d\u8001\u5e08\u6559\u7ed9\u6211\u4eec\u7684\u591a\u9879\u5f0f\u4e58\u6cd5\uff0c\u662fO(n^2)\u7684\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u610f\u5473\u8fd9\u591a\u9879\u5f0f\u7684\u4e58\u6cd5\u771f\u7684\u5c31\u8fd9\u4e48\u6162\uff0c\u53ea\u662f\u56e0\u4e3a\u7cfb\u6570\u8868\u8fbe\u7684\u5c40\u9650\u6027\uff0c\u5bfc\u81f4\u7b97\u6cd5\u590d\u6742\u5ea6\u5947\u9ad8\n \n \u5982\u679c\u662f\u4e24\u4e2a\u4ee5\u70b9\u503c\u5f62\u5f0f\u8868\u8fbe\u7684\u591a\u9879\u5f0f\u5462\uff1f\uff0c\u90a3\u4e48\u4e58\u79ef\u7684\u51fd\u6570\u503c\u7b49\u4e8e\u51fd\u6570\u503c\u7684\u4e58\u79ef\uff0c\u76f4\u63a5\u5bf9\u5e94\u76f8\u4e58\u5373\u53ef\uff0cO(n)\u7684\u590d\u6742\u5ea6\u4e0d\u77e5\u5230\u5feb\u5230\u5230\u54ea\u91cc\u53bb\u4e86\n \n \u53ea\u662f\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u4e00\u822c\u6765\u8bb2\uff0c\u6211\u4eec\u7684\u5b9e\u9645\u5e94\u7528\u4e2d\u591a\u534a\u7528\u4e0d\u5230\u70b9\u503c\u8868\u8fbe\uff0c\u6709\u610f\u4e49\u7684\uff0c\u662f\u7b28\u62d9\u7684\u7cfb\u6570\u8868\u8fbe\u3002\n \n \u4f46\u662f\u6211\u4eec\u5728\u5207\u6362\u5f62\u6001\u65f6\u7684\u7b97\u6cd5\uff0c\u662fO(n^2)\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u65e0\u6cd5\u5728\u8fd9\u4e24\u79cd\u5f62\u5f0f\u4e4b\u95f4\u8c08\u7b11\u98ce\u751f\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u9700\u8981fft\u7684\u539f\u56e0\u4e86\n \n #### fft\u5230\u5e95\u662f\u5e72\u4ec0\u4e48\u7684\n \u4e00\u53e5\u8bdd\uff0c\u5feb\u901f\u6c42\u503c\uff0c\u63d2\u503c\uff0c\u7b97\u6cd5\u590d\u6742\u5ea6nlogn\n \n#### fft\u7684\u539f\u7406\n\u6211\u4eec\u53d1\u73b0\u70b9\u503c\u8868\u8fbe\u662f\u7075\u6d3b\u7684\uff0c\u53ea\u8981\u4f60\u5f00\u5fc3\uff0c\u4ee3\u4ec0\u4e48\u6570\u90fd\u884c\n\n\u7136\u540e\u6709\u4eba\u8bc1\u660e\u4e86\uff0c\u53ea\u8981\u6709\u8fd9\u6837\u4e00\u7c7b\u6570\uff0c\u4ed6\u4eec\u8fde\u7eed\u4e58\u4e00\u5708\uff0c\u80fd\u591f\u4e58\u56de\u6765\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u591a\u9879\u5f0f\u7684\u503c\u4e86\uff0c(\u4e58\u4e00\u5708\u7684\u8bf4\u6cd5\u53ef\u4ee5\u6682\u65f6\u4e0d\u7528\u7406\u89e3)\n\n\u62b1\u6b49\uff0c\u8fd9\u6837\u7684\u6570\u5728\u5b9e\u6570\u8303\u56f4\u5185\u4e0d\u5b58\u5728\u7684\n\n\u4f46\u662f\u590d\u6570\u8303\u56f4\u5185\u6709\uff0c\u5b83\u4eec\u88ab\u79f0\u4e3a**n\u6b21\u5355\u4f4d\u590d\u6570\u6839**\uff0c\u5373\u65b9\u7a0bw^n=1\u7684\u89e3\n\n(\u8fd9\u91cc\u5148\u4ecb\u7ecd\u4e00\u4e0b\u590d\u6570\u8fd0\u7b97\uff0c\u4e00\u4e2a\u590d\u6570\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a\u4e8c\u7ef4\u5e73\u9762\u4e2d\u7684\u7ebf\u6bb5\uff0c\u590d\u6570\u7684\u4e58\u6cd5\u89c4\u5219\u662f\u201c\u5e45\u89d2\u76f8\u52a0\uff0c\u6a21\u957f\u76f8\u4e58\u201d)\n\n\u5176\u5b9e\u6211\u4eec\u5c31\u4f1a\u53d1\u73b0\uff0c\u5c31\u662f\u4e00\u4e2a\u7ebf\u6bb5\uff0c\u5b83\u8f6cn\u4e0b\uff0c\u53ef\u4ee5\u8f6c\u56de1\uff0c\u5e76\u4e14\u8f6c\u4e00\u5708\uff0c\u518d\u8f6c\u4e00\u683c\uff0c\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u7ebf\u6bb5\uff0c\u8f6cn\u4e0b\uff0c\u53ef\u4ee5\u8f6c\u56de1\uff0c\u5e76\u4e14\u8f6c\u4e24\u5708\uff0c\u6700\u540e\u4e00\u4e2a\u8f6cn-1\u5708\u53ef\u4ee5\u8f6c\u4f1a1\uff0c\u4f46\u662f\u4e5f\u662f\u8f6cn\u4e0b\uff0c\u6700\u540e\u4e00\u4e2a\u89e3\u662f1\uff0c\u5b83\u8f6cn\u4e0b\uff0c\u8f6cn\u5708\uff0c\u53ef\u4ee5\u56de\u52301\n\n\u6ce8\u610f\uff0c\u8fd9\u5176\u4e2d\u7684\u4e00\u4e2a\u89e3,wn\uff0c\u5c31\u662f\u5e45\u89d2\u662f2\u03c0/n\u7684\u90a3\u4e2a\u7ebf\u6bb5\uff0c\u6709\u8fd9\u6837\u4e00\u4e2a\u795e\u5947\u7684\u6027\u8d28\uff0c\u5176\u4ed6\u7684\u89e3\uff0c\u90fd\u53ef\u4ee5\u8868\u793a\u4e3awn\u7684\u82e5\u5e72\u6b21\u5e42(\u8fd8\u662f\u7528\u8f6c\u5708\u6765\u7406\u89e3\uff0c\u6bcf\u6b21\u62e8\u4e00\u5c0f\u683c)\n\n\u63a5\u4e0b\u6765\u4e00\u5e2e\u4eba\u5c31\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u6b21\u6570\u4e3an-1\u7684\u591a\u9879\u5f0f\uff0c\u6211\u4eec\u4f9d\u6b21\u4ee3\u5165 wn^0,wn^1,wn^2,wn^3\u2026\u2026\u7684\u8bdd\uff0c\u6240\u5f97\u7684\u51fd\u6570\u503c\u4f1a\u6709\u4e00\u4e2a\u795e\u5947\u7684\u6027\u8d28\n\n\u8bbe\u4f60\u4ee3\u5165\u7684\u591a\u9879\u5f0f\u4e3af(x)\uff0c\u5982\u679c\u6211\u4eec\u628a\u6240\u6709**\u5076\u6570\u6b21**\u7684\u9879\u90fd\u62c9\u51fa\u6765\uff0c\u540c\u65f6**\u6b21\u6570\u51cf\u534a**\uff0c\u8bbe\u8fd9\u6837\u5f97\u5230\u7684\u591a\u9879\u5f0f\u8bb0\u4e3af1(x)\uff0c\u5982\u679c\u6211\u4eec\u628a\u6240\u6709**\u5947\u6570\u6b21**\u7684\u9879\u90fd\u62c9\u51fa\u6765\uff0c**\u6b21\u6570\u4e5f\u51cf\u534a**(\u5411\u4e0b\u53d6\u6574)\uff0c\u8bb0\u4e3af2(x)\n\n\u5219\u4f1a\u6709\u8fd9\u6837\u4e00\u4e2a\u795e\u5947\u7684\u6027\u8d28:\n\n1.f(wn^i)=f1(w\\[n/2]^i)+wn^i\\*f2(wn^i)\n\n2.f(wn^(i+n/2))=f1(w\\[n/2]^2^i)-wn^i\\*f2(wn^i)\n\n\u4e0a\u8ff0\u4e24\u4e2a\u5f0f\u5b50\u90fd\u8981\u6c42i<n/2\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u7edd\u4f73\u7684\u9012\u5f52\u5f0f\uff0c\u56e0\u4e3af1,f2\u4e5f\u662f\u53ef\u4ee5\u9012\u5f52\u8ba1\u7b97\u7684\u56e0\u6b64\uff0c\u800c\u5982\u679c\u591a\u9879\u5f0f\u7684\u6b21\u6570\u88ab\u964d\u5230\u4e86\u5e38\u6570\u9879\uff0c\u6211\u4eec\u4ee3\u5165w0\u540e\u6c42\u7684\u503c\uff0c\u6070\u597d\u5c31\u662f\u5e38\u6570\u9879\u672c\u8eab\uff01\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u5217\u51fa\u4e00\u4e2a\u9012\u5f52\u7248fft\u7684\u7b97\u6cd5\u6d41\u7a0b\uff0c\u6ce8\u610ffft\u8981\u6c42\u591a\u9879\u5f0f\u7684\u6b21\u6570\u4e3a2\u7684\u6574\u6570\u5e42\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e2a\u4e0d\u662f2\u7684\u6574\u6570\u5e42\u7684\u591a\u9879\u5f0f\uff0c\u6211\u4eec\u8981\u5728\u9ad8\u4f4d\u8865\u96f6\n\n1\u628a\u8fd9\u4e2a\u591a\u9879\u5f0f\u8fdb\u884c\u5947\u5076\u5206\u62c6\uff0c\u5076\u653e\u5de6\u8fb9\uff0c\u5947\u653e\u53f3\u8fb9\n\n2.\u9012\u5f52\u8ba1\u7b97\u5076\u6570\u548c\u5947\u6570\n\n3.\u5408\u5e76\uff0creturn\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u4ee5\u4e00\u79cd\u5947\u5999\u7684\u64cd\u4f5c\uff0c\u5c06\u539f\u591a\u9879\u5f0f\u7cfb\u6570\u91cd\u65b0\u6392\u5e03\uff0c\u4f7f\u5f97\u6bcf\u4e00\u4e2a\u7cfb\u6570\uff0c\u90fd\u5728\u5b83\u9012\u5f52\u7684\u6700\u540e\u4f4d\u7f6e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5316\u9012\u5f52\u4e3a\u8fed\u4ee3\uff0c\u4e00\u4e2a\u9012\u5f52\u5c42\u4e00\u4e2a\u9012\u5f52\u5c42\u7684\u8ba1\u7b97\uff0c\u4ece\u800c\u51cf\u5c11\u5927\u91cf\u5e38\u6570\n\n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\uff0c\u8bbe\u539f\u6765\u7b2ci\u4e2a\u4f4d\u7f6e\u7684\u7cfb\u6570\uff0c\u5b83\u5728\u9012\u5f52\u5230\u7ec8\u70b9\u65f6\u88ab\u5206\u914d\u5230\u4e86p\u4f4d\u7f6e\n\n\u90a3\u4e48\u6211\u4eec\u4f1a\u53d1\u73b0\uff0cp\u521a\u597d\u65f6i\u7684\u4e8c\u8fdb\u5236\u4f4d\u53cd\u8f6c\u4ee5\u540e\u7684\u6570\n\n\u6240\u4ee5\u6211\u4eec\u9884\u5904\u7406\u51fa\u6765\u6bcf\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u7684\u53cd\u8f6c\u5373\u53ef\n\n\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u8fed\u4ee3fft\u4e86\n\n\u4e14\u6162\uff0c\u6211\u4eec\u521a\u8bb2\u5b8c\u6c42\u503c\uff0c\u63d2\u503c\u5462\uff1f\n\n\u597d\u5427\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u975e\u5e38\u4e0d\u9760\u8c31\u7684\u8bb0\u5fc6\u65b9\u6cd5\uff0c\u4f60\u5728\u6c42\u503c\u7684\u65f6\u5019\uff0c\u76f8\u5f53\u4e8e\u5c06wn\u987a\u65f6\u9488\u62e7\u4e86\u4e00\u5708\uff0c\u628a\u4e00\u4e2a\u7cfb\u6570\u8868\u8fbe\u62e7\u6210\u4e86\u70b9\u503c\u8868\u8fbe\uff0c\u6240\u4ee5\u63d2\u503c\u7684\u65f6\u5019\u9006\u65f6\u9488\u62e7\u4e00\u5708\u5c31\u884c\u4e86\uff0c\u5177\u4f53\u6765\u8bb2\uff0cwn\u8bbe\u4e3a-wn\u5373\u53ef,\u4f46\u662f\u63d2\u503c\u4e4b\u540e\u6240\u6709\u7684\u7cfb\u6570\u4f1a\u81a8\u80c0n\u500d\uff0c\u6240\u4ee5\u8bb0\u5f97\u9664\u4ee5n\n\n\u5bf9\u4e86\uff0cwn\u7684\u5b9e\u90e8\u662fcos(2\u03c0/n)\u865a\u90e8\u662fsin(2\u03c0/n)\n\n\u597d\u4e86fft\u5c31\u8bb2\u5b8c\u4e86\n## \u600e\u4e48\u505a\u8fd9\u9053\u9898\n\n\u4ee4xi=ai-bi,\u9700\u8981\u63d0\u5347\u6216\u4e0b\u8c03r\u7684\u4eae\u5ea6\n\n\u90a3\u4e48\u603b\u4ee3\u4ef7\u4e3asigma((xi+r)^2)=sigma(xi^2)+2r\\*sigma(xi)+n\\*r^2\n\n\u53d1\u73b0sigma(xi)\u5373\u4f7f\u5728\u65cb\u8f6c\u7684\u65f6\u5019\u4e5f\u4fdd\u6301\u4e0d\u53d8\uff0c\u90a3\u4e48\u540e\u8fb9\u7684\u4e1c\u897f\uff0c\u5c31\u662f\u4e00\u4e2a\u4e8c\u6b21\u51fd\u6570\u7684\u6700\u5c0f\u503c\uff0c\u53ef\u4ee5O(1)\u6c42\u51fa\n\n\u90a3\u4e48\u73b0\u5728\u5c31\u662f\u6700\u5c0f\u5316sigma((ai-bi)^2)=sigma(ai^2+bi^2)-2\\*sigma(aibi)\n\n\u5176\u4e2dsigma(ai^2+bi^2)\u4e0d\u968f\u65cb\u8f6c\u6539\u53d8\uff0c\u6240\u4ee5\u5c31\u662f\u6c42sigma(aibi)\u7684\u6700\u5927\u503c\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e0b\u4e58\u6cd5\uff0c\u5c06b\u6570\u7ec4\u500d\u957f\uff0ca\u6570\u7ec4\u53cd\u5411\uff0c\u90a3\u4e48a\\*b\u4e2d\u7684\u4e00\u4e9b\u4f4d\u5c31\u662fsigma(aibi)\u5728\u65cb\u8f6c\u540e\u7684\u7ed3\u679c\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u5728\u5176\u4e2d\u505a\u4e00\u4e2a\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u627e\u5230\u4e86\n\n\u4e0a\u4ee3\u7801~(\u8bf4\u4e86\u8fd9\u4e48\u591a\u5176\u5b9e\u4ee3\u7801\u5f88\u77ed)\n\n```C\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\nconst db pi=acos(-1.0);\nconst db eps=1e-2;\nstruct cmp//\u865a\u6570\u7c7b \n{\n\tdb r;db i;cmp(db a=0.0,db b=0.0){r=a;i=b;} \n\tfriend cmp operator +(cmp a,cmp b){return cmp(a.r+b.r,a.i+b.i);}\n\tfriend cmp operator -(cmp a,cmp b){return cmp(a.r-b.r,a.i-b.i);}\n\tfriend cmp operator *(cmp a,cmp b){return cmp(a.r*b.r-a.i*b.i,a.r*b.i+a.i*b.r);}\n\tfriend cmp operator /(cmp a,db b){return cmp(a.r/b,a.i/b);}\n}a[400010],b[400010];int r[400010];int len=1;int n; \ninline void clacr(int len,int n)//\u9884\u5904\u7406\u4e8c\u8fdb\u5236\u53cd\u8f6c\u7684\u6570\u7ec4 \n{for(int i=0;i<n;i++){r[i]=r[i>>1]>>1|((i&1)<<len);}}\ninline void fft(cmp *tp,int n,int op)//op\u8868\u793a\u5411\u6b63\u65b9\u5411\u62e7\u548c\u53cd\u65b9\u5411\u62e7 \n{\n\tfor(int i=0;i<n;i++){if(i<r[i]){swap(tp[i],tp[r[i]]);}}//\u628a\u6240\u6709\u4e1c\u897f\u653e\u5230\u9012\u5f52\u7684\u7ec8\u70b9 \n\tfor(int k=1;k<n;k<<=1)//\u679a\u4e3e\u9012\u5f52\u8f6e\u6b21 \n\t{\n\t\tfor(int s=0;s<n;s+=2*k)//\u6bcf\u6b21\u8df32*k\u5757 \n\t\t{\n\t\t\tcmp now(1,0);cmp rt(cos(pi/k),op*sin(pi/k));//\u8ba1\u7b97\u8fd9\u4e00\u8f6e\u8981\u7528\u7684wn \n\t\t\tfor(int i=s;i<s+k;i++,now=now*rt)//\u6309\u7167\u516c\u5f0f\u9012\u63a8 \n\t\t\t{cmp ev=tp[i];cmp od=tp[i+k];tp[i]=ev+now*od;tp[i+k]=ev-now*od;}\n\t\t}\n\t}\n\tif(op==-1){for(int i=0;i<n;i++){tp[i]=tp[i]/n;}}//\u63d2\u503c\u7684\u8bdd\u8981\u9664\u4ee5n \n}\ninline void fit(cmp *tp,int n){for(int i=0;i<n;i++){tp[i].r=(ll)(tp[i].r+eps);}}//\u5904\u7406\u8ba1\u7b97\u4e2d\u7684\u7cbe\u5ea6\u635f\u5931 \nll light=0x7fffffff;ll mid;ll delta;ll sig;ll ma;int m;\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=0;i<n;i++){scanf(\"%lf\",&a[i].r);}\n\tfor(int i=0;i<n;i++){scanf(\"%lf\",&b[i].r);}\n\tfor(int i=0;i<n;i++){sig+=a[i].r*a[i].r+b[i].r*b[i].r;}//\u8ba1\u7b97\u5404\u7c7b\u8981\u7528\u7684\u503c \n\tfor(int i=0;i<n;i++){delta+=a[i].r-b[i].r;}\n\tmid=-(delta/n);\n\tfor(int i=-1;i<=1;i++)//\u4e8c\u6b21\u51fd\u6570\u7684\u5bf9\u79f0\u8f74\u53ef\u80fd\u4e0d\u662f\u6574\u6570\uff0c\u6240\u4ee5\u5de6\u53f3\u5404\u53d6\u4e00\u6b21\u8bd5\u8bd5 \n\t{light=min(light,2*delta*(mid+i)+n*(mid+i)*(mid+i));}\n\tfor(int i=0;2*i<n;i++){swap(a[i],a[n-i-1]);}//\u53cd\u8f6ca \n\tfor(int i=0;i<n;i++){b[i+n]=b[i];}  //\u500d\u957fb \n\tfor(;(1<<len)<3*n;len++);n=(1<<len);//\u7531\u4e8e\u6700\u540e\u7684\u6b21\u6570\u662f3*n\uff08n+2n\uff09\u6240\u4ee5\u5904\u7406\u51fa3n\u4e2a\u70b9\u503c \n\tclacr(len-1,n);fft(a,n,1);fft(b,n,1); //\u6c42\u503c \n\tfor(int i=0;i<n;i++){a[i]=a[i]*b[i];} //\u4e58 \n\tfft(a,n,-1);fit(a,n);                 //\u63d2\u503c \n\tfor(int i=0;i<n;i++){ma=max((ll)(a[i].r),ma);}//\u6c42\u6700\u5927\u503c \n\tprintf(\"%lld\",light+sig-2*ma);return 0;//\u62dc\u62dc\u7a0b\u5e8f~ \n}\n```\n\n\n\n\n\n\n",
        "postTime": 1517915102,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u9996\u5148\u6211\u4eec\u8981\u6709\u4e00\u4e2a\u7b80\u5355\u7c97\u66b4\u7684\u66b4\u529b\u3002\n\n$$\\min\\limits_{x=0}^{n-1}\\min\\limits_{c_{1}=0,c_{2}=0}^{m}\\sum\\limits_{i=0}^{n-1}(A_{i}+c_{1}-B_{(i+x)\\%n}-c_{2})^{2}$$\n\n\u56e0\u4e3a\u6211\u4eec\u5173\u5fc3\u7684\u53ea\u662f\u4e24\u4e2a\u6570\u7684\u5dee\u7684\u5e73\u65b9\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06$c_{1}$\u548c$c_{2}$\u8fd9\u4e24\u4e2a\u975e\u8d1f\u6574\u6570\u5408\u5e76\u6210\u4e00\u4e2a\u6574\u6570$c$\u3002\n\n$$\\min\\limits_{x=0}^{n-1}\\min\\limits_{c=-m}^{m}\\sum\\limits_{i=0}^{n-1}(A_{i}-B_{(i+x)\\%n}+c)^{2}$$\n\n\u6211\u4eec\u4ed4\u7ec6\u89c2\u5bdf\u4e00\u4e0b\u90a3\u4e2a$\\Sigma$\u3002\n\n$$\\begin{aligned}&\\sum\\limits_{i=0}^{n-1}(A_{i}-B_{(i+x)\\%n}+c)^{2}\\\\=&\\sum\\limits_{i=0}^{n-1}(A_{i}^{2}+B_{(i+x)\\%n}^{2}+c^{2}-2A_{i}B_{(i+x)\\%n}+2cA_{i}-2cB_{(i+x)\\%n})\\\\=&\\sum\\limits_{i=0}^{n-1}A_{i}^{2}+\\sum\\limits_{i=0}^{n-1}B_{i}^{2}+nc^{2}+2c(\\sum\\limits_{i=0}^{n-1}A_{i}-\\sum\\limits_{i=0}^{n-1}B_{i})-2\\sum\\limits_{i=0}^{n-1}A_{i}B_{(i+x)\\%n}\\end{aligned}$$\n\n\u9996\u5148$\\Sigma A_{i}^{2}$\u548c$\\Sigma B_{i}^{2}$\u53ef\u4ee5\u770b\u6210\u662f\u5e38\u6570\u9879\u3002\n\n$nc^{2}+2c(\\Sigma A_{i}-\\Sigma B_{i})$\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a\u5173\u4e8e$c$\u7684\u4e8c\u6b21\u51fd\u6570\uff0c\u4ee4$k=(\\Sigma A_{i}-\\Sigma B_{i})$\uff0c\u6211\u4eec\u77e5\u9053\u5b83\u5728$c=-\\frac{k}{n}$\u5904\u53d6\u5f97\u6700\u5c0f\u503c\u3002\u4f46\u662f\u6839\u636e\u9898\u610f\uff0c$c$\u5e94\u5f53\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5c06$c=\\lfloor -\\frac{k}{n}\\rfloor$\u548c$c=\\lceil -\\frac{k}{n}\\rceil$\u4e24\u8005\u90fd\u4ee3\u5165\u539f\u5f0f\uff0c\u7136\u540e\u53d6\u8f83\u5c0f\u503c\u3002\n\n\u7136\u540e\u6211\u4eec\u60f3\u8981\u6c42\u51fa$\\Sigma A_{i}B_{(i+x)\\%n}$\u7684\u6700\u5927\u503c\uff0c\u52a0\u4e0a\u4e0a\u9762\u90a3\u4e24\u9879\u5c31\u662f\u6700\u7ec8\u7b54\u6848\u4e86\u3002\u9996\u5148\u8fd9\u4e2a\u53d6\u6a21\u4e0d\u597d\u641e\uff0c\u6211\u4eec\u628a\u5b83\u62c6\u5f00\u3002\n\n$$\\sum\\limits_{i=0}^{n-x-1}A_{i}B_{i+x}+\\sum\\limits_{i=0}^{x-1}A_{i-x+n}B_{i}$$\n\n\u7136\u540e\u6211\u4eec\u770b\u5230\u8fd9\u4e2a\u4e1c\u897f\u597d\u50cf\u5377\u79ef\u554a\uff0c\u4f46\u662f\u5377\u79ef\u8981\u6c42\u4e24\u4e2a\u4e0b\u6807\u52a0\u8d77\u6765\u662f\u5e38\u6570\uff0c\u8fd9\u4e2a\u4e0b\u6807\u662f\u52a0\u4e0a\u4e00\u4e2a\u6570\u6ca1\u529e\u6cd5\u5377\u79ef\u554a\u3002\n\n\u7136\u540e\u4e00\u60f3\uff0c\u6211\u4eec\u53ef\u4ee5\u5012\u8fc7\u6765\u641e\u554a\u3002\n\n\u5b9a\u4e49$F^{R}(x)$\u662f\u5c06$F(x)$\u7684\u7cfb\u6570\u6570\u7ec4\u7ffb\u8f6c\u8fc7\u6765\u5f97\u5230\u7684\u65b0\u591a\u9879\u5f0f\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u5f0f\u5199\u6210\n\n$$\\begin{aligned}&\\sum\\limits_{i=0}^{n-x-1}A_{i}B^{R}_{n-x-1-i}+\\sum\\limits_{i=0}^{x-1}A^{R}_{x-1-i}B_{i}\\\\=&(AB^{R})_{n-x-1}+(A^{R}B)_{x-1}\\end{aligned}$$\n\n\u7136\u540e\u5957\u4e00\u6ce2\u591a\u9879\u5f0f\u4e58\u6cd5\u7684\u677f\u5b50\uff0c\u626b\u4e00\u904d\u7cfb\u6570\u6c42\u4e2a\u6700\u5927\u503c\u5c31\u884c\u4e86\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u5f53$x=0$\u7684\u65f6\u5019\u5c31\u53ea\u6709$(AB^{R})_{n-1}$\u4e00\u9879\u3002\n\n\u4ee3\u7801\u53bb\u6211[blog](https://challestend.github.io/luogu-p3723-solution/)\u91cc\u627e\u5427\uff08\n\n\u770b\u4e86\u4e00\u5708\u9898\u89e3\u53d1\u73b0\u5c31\u6211\u7528NTTemmmmmm\u2026\u2026",
        "postTime": 1546580173,
        "uid": 63352,
        "name": "rehtorbegnaro",
        "ccfLevel": 7,
        "title": "\u300cAHOI2017/HNOI2017\u300d\u793c\u7269"
    },
    {
        "content": "\u4e00\u9053\u795e\u9898233\u3002\u3002\u3002\u5176\u5b9e\u8981\u662f\u628a\u601d\u8def\u60f3\u901a\u4e86\u4e5f\u4e0d\u662f\u5f88\u96be\u3002  \n### \u6b63\u6587\u90e8\u5206\uff1a         \n\u8bbe\u7ecf\u8fc7\u4e86\u5404\u79cd\u64cd\u4f5c\u4e4b\u540e\u7684\u6570\u5217\u4e3a$A$\u4e0e$B$\uff0c\u603b\u589e\u52a0\u91cf\u4e3a$x$\u3002  \n\u90a3\u4e48\u7b2c$i$\u9879\u6240\u9020\u6210\u7684\u5f71\u54cd\u5c31\u662f      \n$(A_i+x-B_i)^2=A_i^2+x^2+B_i^2+2A_ix-2A_iB_i-2xB_i^2$\n\u7136\u800c$A$\u624b\u73af\u52a0\u4e0a\u76f8\u7b49\u4e8e$B$\u624b\u73af\u51cf\u53bb\uff0c\u6240\u4ee5$m$\u7684\u8303\u56f4\u53d8\u4e3a$-100\\sim100$         \n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u7684\u5f97\u5230\u8fd9\u4e24\u4e2a\u6570\u5217\u7684\u603b\u5f71\u54cd\uff1a\n\n$\\sum_{i=1}^{i=n}(A_i+x-B_i)^2$\n\n\u5c1d\u8bd5\u628a\u8fd9\u4e2a\u5f0f\u5b50\u5c55\u5f00\uff0c\u6210\u4e3a\uff1a     \n\n$\\sum_{i=1}^{i=n}A_i^2+\\sum_{i=1}^{i=n}B_i^2+n*x^2+2x(\\sum_{i=1}^{i=n}A_i-\\sum_{i=1}^{i=n}B_i)-2\\sum_{i=1}^{i=n}A_iB_i$     \n\n\u8fd9\u65f6\u53d1\u73b0\u9664\u4e86\u6700\u540e\u4e00\u9879\u5176\u4ed6\u9879\u5168\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8ba9\u6700\u540e\u4e00\u9879\u6700\u5927\u5373\u53ef\uff0c\u53ef\u4ee5\u7528$fft$\u6765\u6c42\u89e3\uff1a    \n### My code\n```cpp\n#include <bits/stdc++.h>\n#define il inline\n#define gc getchar\n#define FI \"gift\"\nconst int MAXN = 4e6 + 10;\nconst int INF = 0x7f7f7f7f;\nconst double pi = acos(-1);\nusing namespace std;\nil int read() {\n    int res = 0;char c;bool sign = 0;\n    for(c = gc();!isdigit(c);c = gc()) sign |= c == '-';\n    for(;isdigit(c);c = gc()) res = (res << 1) + (res << 3) + (c ^ 48);\n    return sign ? -res : res;\n}\nil void FileIO() {\n    freopen(FI\".in\",\"r\",stdin);\n    freopen(FI\".out\",\"w\",stdout);\n    return;\n}\nstruct Cpx {\n    double r,i;\n    Cpx(){}\n    Cpx(double x,double y) {\n        r = x,i = y;\n    }\n    Cpx operator + (const Cpx& x) const {\n        return Cpx(r + x.r,i + x.i);\n    }\n    Cpx operator - (const Cpx& x) const {\n        return Cpx(r - x.r,i - x.i);\n    }\n    Cpx operator * (const Cpx& x) const {\n        return Cpx(r * x.r - i * x.i,r * x.i + i * x.r);\n    }\n    void operator *= (Cpx& x) {\n        *this = *this * x;\n        return;\n    }\n}a[MAXN],b[MAXN];\nint n,m,i,j,k,R[MAXN],_a[MAXN],_b[MAXN];\nint sqr_a,sqr_b,sum_a,sum_b,li,x,ans = INF;\nil void fft(Cpx a[MAXN],int f) {\n    int i,j,k;\n    for(i = 0;i < li;i++) {\n        if(i < R[i]) swap(a[i],a[R[i]]);\n    }\n    for(i = 1;i < li;i <<= 1) {\n        Cpx wn(cos(pi / i),f * sin(pi / i));\n        for(j = 0;j < li;j += (i << 1)) {\n            Cpx w(1,0);\n            for(k = 0;k < i;k++,w *= wn) {\n                Cpx x = a[j + k],y = w * a[j + k + i];\n                a[j + k] = x + y;a[j + k + i] = x - y;\n            }\n        }\n    }\n    return;\n}\nint main() {\n    // FileIO();\n    n = read();m = read();\n    for(i = 1;i <= n;i++) {\n        _a[i] = read();\n        sqr_a += _a[i] * _a[i];\n        sum_a += _a[i];\n    }\n    for(i = 1;i <= n;i++) {\n        _b[i] = read();\n        sqr_b += _b[i] * _b[i];\n        sum_b += _b[i];\n    }\n    for(i = 1;i <= n;i++) {\n        a[i].r = a[i + n].r = _a[i];\n        b[i].r = _b[n - i + 1];\n    }\n    int t = 0;li = 1;while(li <= n*3) li <<= 1,t++;\n    for(i = 0;i <= li;i++) {\n        R[i] =(R[i >> 1] >> 1 | ((i & 1) << (t - 1)));\n    }\n    fft(a,1);fft(b,1);\n    for(i = 0;i <= li;i++) a[i] *= b[i];\n    fft(a,-1);\n    for(i = 0;i <= li;i++) {\n        a[i].r = (int)(a[i].r / li + 0.5);\n    }\n    for(i = 1;i <= n;i++) {\n        for(x = -m;x <= m;x++) {\n            int tmp = sqr_a + sqr_b + n * x * x;\n            tmp += 2 * x *(sum_a - sum_b);\n            ans = min(ans,tmp - 2 * (int)a[i + n].r);\n        }\n \t}\n \tprintf(\"%lld\",1LL * ans);\n}\n```",
        "postTime": 1543065537,
        "uid": 114320,
        "name": "\u843d\u6c50",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "## \u77e5\u8bc6\u70b9\uff1a\nFFT\uff0cNTT\n\n## \u9898\u610f\uff1a\n\u7ed9\u4e24\u4e2a\u73af\uff0c\u53ef\u4ee5\u8f6c\u4f46\u662f\u4e0d\u53ef\u4ee5\u7ffb\uff0c\u8981\u6c42\u7ed9\u5176\u4e2d\u4e00\u4e2a\u73af\u6bcf\u4e2a\u5143\u7d20\u52a0\u4e0a\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff0c\u6c42\u6bcf\u4e00\u9879\u5dee\u7684\u5e73\u65b9\u4e4b\u548c\u6700\u5c0f\u3002\n\n## \u89e3\u6cd5\uff1a\n\u4efb\u610f\u4e00\u4e2a\u73af\u52a0\u4e0a\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\u76f8\u5f53\u4e8e\u5176\u4e2d\u4e00\u4e2a\u73af\u52a0\u4e0a\u4e00\u4e2a\u6574\u6570\u3002\u5217\u51fa\u5f0f\u5b50\uff08$x\\in Z$\uff0c\u662f\u6211\u4eec\u8981\u52a0\u4e0a\u7684\u90a3\u4e2a\u6570\uff09\uff1a$\\displaystyle\\sum_{i=1}^{n}(a_i-b_i+x)^2=\\displaystyle\\sum_{i=1}^{n}(a_i^2+b_i^2+x^2+2a_ix-2b_ix-2a_ib_i)=\\displaystyle\\sum_{i=1}^{n}a_i^2+\\displaystyle\\sum_{i=1}^{n}b_i^2+nx^2+2x\\displaystyle\\sum_{i=1}^{n}(a_i-b_i)-2\\displaystyle\\sum_{i=1}^{n}a_ib_i$\u3002\u6240\u4ee5\u6700\u540e\u4e00\u9879\u662f\u4e2a\u5377\u79ef\uff0c\u5377\u4e00\u4e0b\u6c42\u6700\u5927\u503c\u5373\u53ef\uff08\u56e0\u4e3a\u500d\u957f\u8fc7a\uff0c\u6240\u4ee5\u627e\u6700\u5927\u503c\u4ece\u7b2cn+1\u52302n\u9879\u627e\uff0c\u539f\u5f0f\u5377\u8d77\u6765\u6709\u6548\u7684\u5c31\u662f\u90a3\u4e9b\u5730\u65b9\uff09\u3002\u4e2d\u95f4\u4e24\u9879\u662f\u4e2a\u4e8c\u6b21\u51fd\u6570\uff0c\u6c42\u4e00\u4e0b\u9876\u70b9\u5de6\u53f3\u7684\u4e24\u4e2a\u6574\u6570\u5373\u53ef\uff0c\u524d\u4e24\u9879\u662f\u5e38\u6570\u3002\n\n## \u5907\u6ce8\uff1a\n\u8fd9\u79cd\u9898\u89c1\u5230\u73af\u5148\u7834\u73af\u6210\u94fe\uff0c\u500d\u957f\u53d8\u6210\u5e8f\u5217\uff0c\u5377\u51fa\u6765\u7684\u7b54\u6848\u5fc5\u5b9a\u5728n+1\u52302n\u9879\uff08\u60f3\u60f3\u539f\u6765\u7684\u662f\u4ec0\u4e48\uff0c\u73b0\u5728\u7684\u662f\u4ec0\u4e48\uff09\u3002\u7136\u540e\u5c31\u90fd\u662f\u5957\u8def\u4e86\u3002\n\n## \u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\nusing namespace std;\n\ntypedef long long ll;\nconst int maxn=400010,mod=998244353,G=3,invG=332748118;\nint n,m,a[maxn],b[maxn],c[maxn],r[maxn],ta[maxn],tb[maxn];\nll ans;\n\nint read()\n{\n\tint x=0;\n\tchar c=getchar();\n\twhile (c<48||c>57)\n\t\tc=getchar();\n\twhile (c>=48&&c<=57)\n\t\tx=(x<<1)+(x<<3)+(c^48),c=getchar();\n\treturn x;\n}\n\nint qp(int a,int b)\n{\n\tint res=1;\n\tfor (;b;b>>=1)\n\t{\n\t\tif (b&1)\n\t\t\tres=1ll*res*a%mod;\n\t\ta=1ll*a*a%mod;\n\t}\n\treturn res;\n}\n\nint init(int len)\n{\n\tint N,i,j;\n\tfor (N=1;N<len;N<<=1);\n\tj=(N>>1);\n\tfor (i=1;i<=N-2;i++)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)*j);\n\treturn N;\n}\n\nvoid ntt(int *f,int N,bool pos)\n{\n\tint i,j,k,len,t,tmp,w;\n\tfor (i=1;i<=N-2;i++)\n\t\tif (i<r[i])\n\t\t\tswap(f[i],f[r[i]]);\n\tfor (k=2;k<=N;k<<=1)\n\t{\n\t\tlen=(k>>1);\n\t\ttmp=qp(pos?G:invG,(mod-1)/k);\n\t\tfor (j=0;j<N;j+=k)\n\t\t{\n\t\t\tw=1;\n\t\t\tfor (i=j;i<j+len;i++)\n\t\t\t{\n\t\t\t\tt=1ll*w*f[i+len]%mod;\n\t\t\t\tf[i+len]=f[i]-t;\n\t\t\t\tif (f[i+len]<0)\n\t\t\t\t\tf[i+len]+=mod;\n\t\t\t\tf[i]=f[i]+t;\n\t\t\t\tif (f[i]>=mod)\n\t\t\t\t\tf[i]-=mod;\n\t\t\t\tw=1ll*w*tmp%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif (!pos)\n\t{\n\t\tint invN=qp(N,mod-2);\n\t\tfor (i=0;i<N;i++)\n\t\t\tf[i]=1ll*f[i]*invN%mod;\n\t}\n}\n\nvoid poly_mul(int *A,int n,int *B,int m,int *C,int lim=0)\n{\n\tint i,N=init(n+m-1);\n\tmemcpy(ta,A,n*4);\n\tfill(ta+n,ta+N,0);\n\tmemcpy(tb,B,m*4);\n\tfill(tb+m,tb+N,0);\n\tntt(ta,N,1),ntt(tb,N,1);\n\tfor (i=0;i<N;i++)\n\t\tC[i]=1ll*ta[i]*tb[i]%mod;\n\tntt(C,N,0);\n\tmemset(ta,0,N*4+4);\n\tmemset(tb,0,N*4+4);\n\tif (lim)\n\t\tfill(C+lim,C+N,0);\n}\n\nint main()\n{\n\tint n=read(),i=read(),p=0,q=0,tmp=0,x;\n\tfor (i=0;i<n;i++)\n\t\ta[i]=a[i+n]=read(),ans+=a[i]*a[i];\n\tfor (i=0;i<n;i++)\n\t\tb[i]=read(),ans+=b[i]*b[i],q+=a[i]-b[i];\n\tq*=2,p=n;\n\treverse(b,b+n);\n\tpoly_mul(a,n*2,b,n,c,n*2);\n\tfor (i=n;i<n*2;i++)\n\t\ttmp=max(tmp,c[i]);\n\ttmp*=2;\n\tans-=tmp;\n\tx=(int)floor((-1.0*q)/(2.0*p));\n\ttmp=1ll*x*x*p+1ll*x*q;\n\tx=(int)ceil((-1.0*q)/(2.0*p));\n\tans+=1ll*min(1ll*tmp,1ll*x*x*p+1ll*x*q);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1579488680,
        "uid": 38036,
        "name": "\u5357\u65b9\u4e0d\u8d25",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3723 [AH2017/HNOI2017]\u793c\u7269"
    },
    {
        "content": "~~\u88ab\u67d0\u5927\u4f6c\u6307\u51fa\u8fd9\u662f\u591a\u9879\u5f0f\u677f\u5b50\uff01\uff1f~~\n\n\u6211\u4eec\u5047\u8bbe\u6211\u4eec\u539f\u59cb\u6570\u5217\u662f$a_i, c_i$\uff0c \u65cb\u8f6c\u540e\u7684\u6570\u5217\u662f$a_i, b_i$\uff0c\u6211\u4eec\u7684\u589e\u52a0\u91cf\u4e3ax\n\n$$\\sum_{i = 1}^n(a_i - b_i + x)^2$$\n\n\u62c6\u5f00\u5e73\u65b9\u5f97\uff1a\n\n$$\\sum_{i = 1}^na_i^2+b_i^2+x^2+2*x*a_i-2*x*b_i-2*a_i*b_1$$\n\n\u628a\u8fd9\u4e9b\u4e1c\u897f\u5206\u4e0b\u7c7b\uff1a\n\n$$x^2*n+(\\sum_{i=1}^na_i^2+b_i^2)+2*x*(\\sum_{i = 1}^n a_i+b_i)+2*(\\sum_{i = 1}^na_i*b_i)$$\n\n\u53d1\u73b0$x$\u53ea\u6709$[-100, 100]$\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3ex\uff0c\u7136\u540e\u5c31\u53ea\u6709\u6700\u540e\u4e00\u5806\u662f\u672a\u77e5\u7684\n\n\u6211\u4eec\u8003\u8651\u600e\u4e48\u6c42\u6700\u540e\u4e00\u5806\uff1a\u4e24\u4e2a\u503c\u4e58\u5728\u4e00\u8d77\u7684\u548c\uff0c\u662f\u4e0d\u662f\u548c\u591a\u9879\u5f0f\u6709\u5173\u7cfb\u5462\uff1f\n\n\u4f46\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u4f46\u6211\u4eec\u8003\u8651\u628ab\u53cd\u5411\uff0c\u539f\u5f0f\u5c31\u53d8\u6210\u4e86\uff1a$\\sum_{i=1}^na_i*b_{n-i+1}$\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4e0e\u6109\u5feb\u7684\u7528\u591a\u9879\u5f0f\u6765\u505a\u8fd9\u9053\u9898\u4e86\u3002[\u4e0d\u4f1a\u591a\u9879\u5f0f\uff1f\u6233\u6233\u770b\uff1f](https://www.cnblogs.com/bcoier/p/11644303.html)\n\n\u628aa\u6570\u7ec4\u500d\u957f\uff0c\u628ab\u6570\u7ec4\u53cd\u5411\uff0c\u4e8e\u662f\u8fd9\u9053\u9898\u7684\u5f0f\u5b50\u5c31\u6210\u4e86\uff1a$\\sum_{i=1}^na_{i+k}c_{n-i+1}$\uff0c\u7136\u540e\u591a\u9879\u5f0f\u7684\u7b2c$n+1-2*n$\u5c31\u5206\u522b\u4ee3\u8868$k$\u53d6$0-n-1$\u7684\u503c\u4e86\n## $Code:$\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define il inline\n#define re register\n#define int long long\nconst double pi = acos(-1);\n#define inf 12345678900000000\nil int read() {\n    re int x = 0, f = 1; re char c = getchar();\n    while(c < '0' || c > '9') { if(c == '-') f = -1; c = getchar();}\n    while(c >= '0' && c <= '9') x = x * 10 + c - 48, c = getchar();\n    return x * f;\n}\n#define rep(i, s, t) for(re int i = s; i <= t; ++ i)\n#define maxn 300005\nstruct node {\n\tdouble x, y;\n}a[maxn], b[maxn];\nil node operator + (node a, node b) { return (node){a.x + b.x, a.y + b.y}; }\nil node operator - (node a, node b) { return (node){a.x - b.x, a.y - b.y}; }\nil node operator * (node a, node b) { return (node){a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x}; }\nint n, m, lim, r[maxn], ans = inf, sum1, sum2, Ans = -inf;\nil void FFT(node *a, int f, int len) {\n\trep(i, 0, len - 1) if(r[i] > i) swap(a[r[i]], a[i]);\n\tfor(re int mid = 1; mid < len; mid <<= 1) {\n\t\tnode base = (node){cos(pi / mid), f * sin(pi / mid)};\n\t\tfor(re int p = mid * 2, j = 0; j < len; j += p) {\n\t\t\tnode w = (node){1, 0};\n\t\t\tfor(re int k = 0; k < mid; ++ k, w = w * base) {\n\t\t\t\tnode x = a[j + k], y = a[j + k + mid] * w;\n\t\t\t\ta[j + k] = x + y, a[j + k + mid] = x - y;\n\t\t\t}\n\t\t}\n\t}\n}\nsigned main() {\n\tn = read(), m = read();\n\trep(i, 1, n) a[i].x = a[i + n].x = read();\n\trep(i, 1, n) b[n - i + 1].x = read();\n\trep(i, 1, n) sum1 += a[i].x * a[i].x + b[i].x * b[i].x, sum2 += a[i].x - b[i].x;\n\twhile((1 << lim) <= 3 * n) ++ lim;\n\trep(i, 0, (1 << lim)) r[i] = (r[i >> 1] >> 1) | ((i & 1) << (lim - 1));\n\tFFT(a, 1, (1 << lim)), FFT(b, 1, (1 << lim));\n\trep(i, 0, (1 << lim)) a[i] = a[i] * b[i];\n\tFFT(a, -1, (1 << lim));\n\trep(x, -m, m) ans = min(ans, x * x * n + sum1 + 2 * x * sum2);\n\trep(i, n + 1, 2 * n) Ans = max(Ans, (int)(a[i].x / (1 << lim) + 0.5));\n\tprintf(\"%lld\", ans - 2 * Ans);\n\treturn 0;\n}\n```",
        "postTime": 1570679960,
        "uid": 57014,
        "name": "Nemlit",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\uff08\u8fd9\u5e94\u8be5\u662f\u6b65\u9aa4\u6700\u5168\u7684\u9898\u89e3\u4e86233\uff09  \n\u8003\u8651\u5230\u516c\u5f0f\u53ef\u80fd\u51fa\u95ee\u9898\uff0c\u6211\u5c31\u8d34\u56fe\u7247\u597d\u4e86\n\uff08\u6d1b\u8c37\u56fe\u5e8a\u538b\u4e86\u56fe\uff0c\u91cd\u65b0\u4f20\u4e00\u6b21)\n\n-------------------\n\n## \u63a8\u5bfc\u8fc7\u7a0b\n![Formula](https://raw.githubusercontent.com/panda2134/panda2134.github.io/master/img/Gift.png)\n## \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n#define PI M_PI\nusing namespace std;\n\ntypedef long long int64;\n\ntypedef std::complex<double> cmplx;\n\nconst int MAXN = 4e5;\n\nnamespace FFT {\n\tinline cmplx get_rt(int step, bool inv) {\n\t\treturn !inv ? cmplx(cos(2*PI / step), sin(2*PI / step))\n\t\t\t\t\t: cmplx(cos(2*PI / step), -sin(2*PI / step));\n\t}\n\tvoid fft(int len, cmplx* A, bool inv) {\n\t\tstatic int R[MAXN+10];\n\t\tfor(int i = 1; i < len; i++)\n\t\t\tR[i] = ((R[i>>1]>>1) | (len>>(i&1))) & (len-1);\n\t\tfor(int i = 0; i < len; i++)\n\t\t\tif(R[i] > i) swap(A[i], A[R[i]]);\n\t\tfor(int step = 1; step < len; step <<= 1)\n\t\t\tfor(int i = 0; i < len; i += (step<<1)) {\n\t\t\t\tcmplx omega = 1, rt = get_rt(step<<1, inv);\n\t\t\t\tfor(int j = 0; j < step; j++, omega *= rt) {\n\t\t\t\t\tcmplx t = omega * A[i+j+step];\n\t\t\t\t\tA[i+j+step] = A[i+j] - t;\n\t\t\t\t\tA[i+j] = A[i+j] + t;\n\t\t\t\t}\n\t\t\t}\n\t\tif(inv)\n\t\t\tfor(int i = 0; i < len; i++) A[i] /= len;\n\t}\n\tvoid conv(int64* A, int64* B, int64* C, int deg) {\n\t\tstatic cmplx CA[MAXN+10], CB[MAXN+10], CC[MAXN+10];\n\t\tint len;\n\t\tfor(len = 1; len <= ((deg + 1) << 1); len <<= 1);\n\t\tfill(CA, CA + len, 0);\n\t\tfill(CB, CB + len, 0);\n\t\tfill(CC, CC + len, 0);\n\t\tfor(int i = 0; i <= deg; i++) {\n\t\t\tCA[i] = A[i], CB[i] = B[i];\n\t\t}\n\t\tfft(len, CA, false); fft(len, CB, false);\n\t\tfor(int i = 0; i < len; i++)\n\t\t\tCC[i] = CA[i] * CB[i];\n\t\tfft(len, CC, true);\n\t\tfor(int i = 0; i < len; i++)\n\t\t\tC[i] = int64(real(CC[i]) + 0.5);\n\t}\n}\n\nusing FFT::conv;\nint64 n, m, SumY, SumY2, SumC, SumC2, C[MAXN+10], Y[MAXN+10], T[MAXN+10];\n\ninline int readint() {\n\tint f=1, r=0; char c=getchar();\n\twhile(!isdigit(c)) { if(c=='-')f=-1; c=getchar(); }\n\twhile(isdigit(c)) { r=r*10+c-'0'; c=getchar(); }\n\treturn f*r;\n}\n\nvoid Init() {\n\tn = readint(); m = readint();\n\tfor(int i = 0; i < n; i++) C[i] = C[i+n] = readint();\n\tfor(int i = 1; i <= n; i++) Y[i] = readint();\n\treverse(C, C+n); reverse(C+n, C+2*n);\n\tconv(C, Y, T, 2*n);\n\tfor(int i = 1; i <= n; i++) {\n\t\tSumY += Y[i];\n\t\tSumY2 += Y[i] * Y[i];\n\t}\n\tfor(int i = 0; i < n; i++) {\n\t\tSumC += C[i];\n\t\tSumC2 += C[i] * C[i];\n\t}\n}\n\nvoid Work() {\n\tint64 Ans = LLONG_MAX;\n\tfor(int a = 0; a <= n-1; a++) {\n\t\tint64 CurP, CurAns = LLONG_MAX, CoeA, CoeB, CoeC;\n\t\tCoeA = n;\n\t\tCoeB = 2*SumC - 2*SumY;\n\t\tCoeC = SumY2 + SumC2 - 2*T[n + a];\n\t\tCurP = (-CoeB) / (2*CoeA);\n\t\tfor(int P = max(-m, CurP - 10); P <= min(m, CurP + 10); ++P)\n\t\t\tCurAns = min(CurAns, CoeA * P * P + CoeB * P + CoeC);\n\t\tAns = min(Ans, CurAns);\n\t}\n\tcout << Ans;\n}\n\nint main() {\n\tInit(); Work();\n\treturn 0;\n}\n```",
        "postTime": 1520743684,
        "uid": 23865,
        "name": "panda_2134",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\n[\u672c\u849f\u84bb\u7684Blog](https://www.chnxuzhiyuan.cn/2019/10/21/%E3%80%8CAH2017HNOI2017%E3%80%8D%E7%A4%BC%E7%89%A9-Solution/)\n\n### \u9898\u89e3\n\n\u9996\u5148\u6765\u770b\u4e0b\u9898\u76ee\u91cc\u7684\u5f0f\u5b50\uff1a\n$$\n\\sum_{i=1}^{n}{(x_i-y_i+c)^2}=\\sum_{i=1}^{n}{x_i^2+y_i^2+c^2-2x_iy_i+2cx_i-2cy_i}\n$$\n\u5176\u4e2d$\\sum x_i^2+y_i^2$\u4e3a\u5b9a\u503c\uff0c$\\sum c^2+2cx_i-2cy_i-2x_iy_i$\u5728\u786e\u5b9a\u4e86$c$\u7684\u503c\u4e4b\u540e\u4e5f\u662f\u5b9a\u503c\uff0c\u5e76\u4e14c\u7684\u503c\u975e\u5e38\u5c0f\u53ef\u4ee5\u66b4\u679a\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u8003\u8651$\\sum x_iy_i$\u3002\n\n\u7531\u4e8e\u662f\u4e00\u4e2a\u73af\uff0c\u6309\u7167\u5957\u8def\uff0c\u53ef\u4ee5\u5148\u5c06$x_i$\u590d\u5236\u4e00\u904d\u3002\n\n\u8bbe$C_i$\u4e3a\u65cb\u8f6c\u4e86$i$\u4e2a\u5355\u4f4d\u540e$\\sum x_iy_i$\u7684\u503c\uff0c\u6709\uff1a\n$$\nC_i=\\sum_{j=1}^{n}{x_{i+j}y_j}\n$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u4e0d\u662f\u5f88\u597d\u770b\uff0c\u4e8e\u662f\u6211\u4eec\u628a$y$\uff08$x$\u4e5f\u884c\uff09\u5012\u8fc7\u6765\uff0c\u90a3\u4e48\u5c31\u6709\uff1a\n$$\nC_i=\\sum_{j=1}^{n}{x_{i+j}y_{n-j+1}}\n$$\n\u7136\u540e\u4e0d\u96be\u53d1\u73b0\uff0c$x$\u4e0e$y$\u4e0b\u6807\u4e4b\u548c\u4e3a$n+i+1$\u7684\u6570\u5c06\u88ab\u4e58\u8d77\u6765\u7136\u540e\u5bf9$C_i$\u9020\u6210\u8d21\u732e\uff0c\u6240\u6b64\u65f6\u4ee5$C_i$\u5c31\u7b49\u4e8e\u591a\u9879\u5f0f$x_1\\cdot x+x_2\\cdot x^2+\\cdots x_n\\cdot x^n$\u4e0e$y_1\\cdot x+y_2\\cdot x^2+\\cdots y_n\\cdot x^n$\u5377\u79ef\u5377\u8d77\u6765\u4e4b\u540e$x^{i+n+1}$\u9879\u7684\u7cfb\u6570\u3002\n\n\u7136\u540eNTT\u6c42\u4e2a\u5377\u79ef\u7136\u540e\u53d6\u4e2a\u6700\u5c0f\u503c\u5c31\u884c\u4e86\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\ntypedef long long LL;\nconst int maxn=50005,TT=998244353;\nint n,m,r[maxn<<3],X[maxn],Y[maxn],A[maxn<<3],B[maxn<<3],C[maxn<<3],ans=2e9;\ninline int read()\n{\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){ret=ret*10+ch-'0';ch=getchar();}\n\treturn ret*f;\n}\ninline int QP(int a,int b)\n{\n\tint ret=1,w=a;\n\twhile(b)\n\t{\n\t\tif(b&1) ret=(LL)ret*w%TT;\n\t\tw=(LL)w*w%TT;b>>=1;\n\t}\n\treturn ret;\n}\ninline void NTT(int* A,int limit,int typ)\n{\n\tfor(int i=0;i<limit;i++)\n\t\tif(i<r[i])\n\t\t\tswap(A[i],A[r[i]]);\n\tfor(int mid=1;mid<limit;mid<<=1)\n\t{\n\t\tint gn=QP(3,(TT-1)/(mid<<1));\n\t\tif(typ<0) gn=QP(gn,TT-2);\n\t\tfor(int j=0;j<limit;j+=mid<<1)\n\t\t{\n\t\t\tint g=1;\n\t\t\tfor(int k=0;k<mid;k++,g=(LL)g*gn%TT)\n\t\t\t{\n\t\t\t\tint x=A[j+k],y=(LL)g*A[j+k+mid]%TT;\n\t\t\t\tA[j+k]=(x+y)%TT;\n\t\t\t\tA[j+k+mid]=(x-y+TT)%TT;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ<0)\n\t{\n\t\tint inv=QP(limit,TT-2);\n\t\tfor(int i=0;i<limit;i++) A[i]=(LL)A[i]*inv%TT;\n\t}\n}\ninline int Calc(int c){int ret=0;for(int i=1;i<=n;i++)ret+=X[i]*X[i]+Y[i]*Y[i]+c*c+2*X[i]*c-2*Y[i]*c;return ret;}\ninline void Solve()\n{\n\tfor(int i=1;i<=n;i++) A[i]=A[i+n]=X[i];\n\tfor(int i=1;i<=n;i++) B[i]=Y[i];\n\treverse(A+1,A+1+n*2);\n\tint limit=1,l=0;\n\twhile(limit<=n+n+m){limit<<=1;l++;}\n\tfor(int i=0;i<limit;i++)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n\tNTT(A,limit,1);\n\tNTT(B,limit,1);\n\tfor(int i=0;i<limit;i++) C[i]=(LL)A[i]*B[i]%TT;\n\tNTT(C,limit,-1);\n\tfor(int c=-m;c<=m;c++)\n\t\tif(Calc(c)<ans)\n\t\t\tans=Calc(c);\n\tint tep=0;\n\tfor(int i=1;i<=n;i++)\n\t\tif(C[n+i]>tep)\n\t\t\ttep=C[n+i];\n\tans-=2*tep;\n}\nint main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++) X[i]=read();\n\tfor(int i=1;i<=n;i++) Y[i]=read();\n\tSolve();\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1576551364,
        "uid": 42392,
        "name": "\u5f90\u81f4\u8fdc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P3723)\u770b\u9898\u76ee\u3002\n# \u5206\u6790\n### $30pts$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u770b\u5230$m$\u8fd9\u4e48\u5c0f\uff0c\u4e0d\u96be\u60f3\u5230\u679a\u4e3e\u5176\u4e2d\u4e00\u4e2a\u73af\u589e\u52a0\u7684$c$\u3002\u7136\u540e\u679a\u4e3e\u53e6\u4e00\u4e2a\u73af\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u4e0e\u7b2c\u4e00\u4e2a\u73af\u66b4\u529b\u8ba1\u7b97\u7b54\u6848\uff0c\u53d6\u6700\u5c0f\u503c\u3002\u65f6\u95f4$O(n^2m)$\u3002  \n### $70pts$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9996\u5148\u5256\u73af\uff0c\u4e5f\u5c31\u662f\u628a\u5e8f\u5217\u590d\u5236\u4e00\u904d\u5230\u5c3e\u5df4\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5927\u529b\u62c6\u5f0f\u5b50\uff1a  \n$$\\sum_{i=1}^n((x_i+c)-y_i)^2$$  \n$$=\\sum_{i=1}^n((x_i+c)^2-2(x_i+c)y_i+y_i^2)$$  \n$$=\\sum_{i=1}^n(x_i+c)^2-2\\sum_{i=1}^n(x_i+c)y_i+\\sum_{i=1}^ny_i^2$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4ee4$p=\\sum_{i=1}^n(x_i+c)^2,q=\\sum_{i=1}^ny_i^2$\u3002\u5728\u4e00\u6b21\u52a0\u4e0a$c$\u4e4b\u540e\u7684\u8ba1\u7b97\u4e2d\uff0c\u8fd9\u4e24\u4e2a\u90fd\u53ef\u4ee5$O(n)$\u7b97\u51fa\u6765\u3002  \n$$\\text{\u539f\u5f0f}=p+q-2\\sum_{i=1}^nx_iy_i$$  \n$$\\therefore \\min_{0\\le j<n}\\left\\{\\sum_{i=1}^n((x_i+c)-y_{i+j})^2\\right\\}=p+q-2\\max_{0\\le j<n}\\left\\{\\sum_{i=1}^n(x_i+c)y_{i+j}\\right\\}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u662f\u5f53$c$\u56fa\u5b9a\u7684\u65f6\u5019\u7684\u6700\u5c0f\u5dee\u5f02\u503c\u3002\u679a\u4e3e$c$\uff0c\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5982\u4f55\u89e3\u51b3\u540e\u9762\u90a3\u4e00\u5927\u5806\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5982\u679c\u5bf9\u4e8e$x$\u603b\u4f53\u52a0\u4e0a\u4e00\u4e2a$c$\uff0c\u90a3\u4e48\u5c31\u6709\uff1a  \n$$\\sum_{i=1}^n(x_i+c)y_{i}=\\sum_{i=1}^nx_iy_{i}+c\\sum_{i=1}^ny_i$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7531\u4e8e$\\sum_{i=1}^ny_i$\u4e0d\u53d8\uff0c\u6240\u4ee5$c\\sum_{i=1}^ny_i$\u4e5f\u4e0d\u53d8\u3002  \n$$\\therefore \\min_{0\\le j<n}\\left\\{\\sum_{i=1}^n((x_i+c)-y_{i+j})^2\\right\\}=p+q-2\\left(\\max_{0\\le j<n}\\left\\{\\sum_{i=1}^nx_iy_{i+j}\\right\\}+c\\sum_{i=1}^ny_i\\right)$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u4e2a\u6545\u4e8b\u544a\u8bc9\u6211\u4eec\uff0c\u53ea\u9700\u8981\u9884\u5904\u7406$\\max_{0\\le j<n}\\{\\sum_{i=1}^nx_iy_{i+j}\\}$\u5c31\u53ef\u4ee5\u4e86\u3002\u9884\u5904\u7406\u5b8c\u4e86\u4e4b\u540e\u5c31\u53ef\u4ee5$O(mn)$\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u66b4\u529b$O(n^2+mn)$\uff0c\u5c31\u6709$70pts$\u4e86\u3002  \n### $100pts$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u770b\u4e00\u4e0b\u6211\u4eec\u8981\u6c42\u7684\u4e1c\u897f\uff1a  \n$$\\max_{0\\le j<i}\\left\\{\\sum_{i=1}^nx_iy_{i+j}\\right\\}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4ee4$f(j)=\\sum_{i=1}^nx_iy_{i+j}$\uff0c\u5b9e\u9645\u4e0a\u5c31\u8981\u6c42$\\max_{0\\le j<i}\\{f(j)\\}$\u3002\u5047\u5982\u6211\u4eec\u53ef\u4ee5\u9ad8\u6548\u5730\u6c42\u51fa$f$\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$y_{i+j}$\u770b\u8d77\u6765\u6709\u4e00\u4e9b\u5947\u602a\u4e0d\u662f\u5417\uff1f\u628a$y$\u6574\u4f53\u5012\u8fc7\u6765\u5f97\u5230$y'$\u3002\u65b0\u4e0b\u6807\u5173\u7cfb\u8ba9\u6211\u4eec\u60f3\u5230\u4e86\u5377\u79ef\u3002\u8003\u8651\u901a\u8fc7\u5377\u79ef\u7684\u53d8\u6362\u5f97\u5230\u6211\u4eec\u9700\u8981\u7684$f$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe\u5377\u79ef\u7684\u7ed3\u679c$f'(j)=\\sum_{i=0}^jx_iy_{j-i}'$\u4e3e\u4e2a\u4f8b\u5b50\u627e\u89c4\u5f8b\uff0c\u6837\u4f8b\uff1a  \n![gift.png](https://i.loli.net/2019/12/19/hxtOznYE2McoIQb.png)  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7b2c\u4e00\u6392\u5c0f\u6570\u5b57\u5bf9\u5e94\u4e0b\u6807\uff1b\u7b2c\u4e8c\u6392\u7684\u5927\u6570\u5b57\u5bf9\u5e94\u7b2c\u4e00\u4e2a\u624b\u73af\u4e0a\u7684\u6570\uff08\u5df2\u5c55\u5f00\uff09\uff1b\u7b2c\u4e09\u6392\u7684\u5927\u6570\u5b57\u5bf9\u5e94\u7b2c\u4e8c\u4e2a\u624b\u73af\u4e0a\u7684\u6570\uff08\u5df2\u5c55\u5f00\uff09\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7ea2\u8272\u7ebf\u548c\u6df1\u84dd\u8272\u7ebf\u8868\u793a\u7684\u662f$f'(8)$\u4e2d\u5404\u9879\u5bf9\u5e94\u5173\u7cfb\u3002\u5929\u84dd\u8272\u7ebf\u548c\u7c89\u7ea2\u8272\u7ebf\u8868\u793a\u7684\u662f$f'(3)$\u4e2d\u5404\u9879\u5bf9\u5e94\u5173\u7cfb\u3002\u7eff\u8272\u7ebf\u5212\u5b9a\u4e86$f'(3)$\u7684\u8303\u56f4\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u53d1\u73b0$f'(8)$\u4e2d\u4f3c\u4e4e\u5305\u542b\u4e86$f(2)$\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4f46\u662f\u8fd8\u6709\u591a\u7684\u90e8\u5206\u2014\u2014\u4e5f\u5c31\u662f\u7b2c\u4e8c\u6392\u5927\u6570\u5b57\u4e0a\u6807\u53f7\u4e3a$6,7,8$\u7684\u4f4d\u7f6e\uff0c\u5b83\u4eec\u88ab\u591a\u8ba1\u7b97\u4e86\u3002\u4e0d\u8fc7\uff0c\u8fd9\u6837\u7684\u5bf9\u5e94\u5173\u7cfb\u5728$f'(3)$\u4e2d\u5df2\u7ecf\u88ab\u8ba1\u7b97\u597d\u4e86\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u51cf\u6389\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148$FFT$\uff0c\u518d\u7528\u8fd9\u4e2a\u89c4\u5f8b\u8ba1\u7b97\u51fa$f$\uff0c\u53d6$\\max$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6700\u540e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f$O(n\\log_2n+nm)$\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <iostream>\n\ntypedef long long LL;\n\nconst double PI = acos( -1 );\nconst LL INF = 0x3f3f3f3f3f3f3f3f;\nconst int MAXN = 100005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n    x = 0;char s = getchar();int f = 1;\n    while( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n    while( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n    x *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n    if( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n    if( 9 < x ){ write( x / 10 ); }\n    putchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MIN( const _T a, const _T b )\n{\n\treturn a < b ? a : b;\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n\treturn a > b ? a : b;\n}\n\n\ntypedef struct complex\n{\n\tdouble r, i;\n\tcomplex(){} complex( const double R, const double I = 0 ) { r = R, i = I; }\n\tcomplex operator + ( const complex & b ) const { return complex( r + b.r, i + b.i ); }\n\tcomplex operator - ( const complex & b ) const { return complex( r - b.r, i - b.i ); }\n\tcomplex operator * ( const complex & b ) const { return complex( r * b.r - i * b.i, r * b.i + i * b.r ); }\n\tcomplex operator / ( const double & b ) const { return complex( r / b, i / b ); }\n\tvoid operator += ( const complex & b ) { *this = *this + b; }\n\tvoid operator -= ( const complex & b ) { *this = *this - b; }\n\tvoid operator *= ( const complex & b ) { *this = *this * b; }\n\tvoid operator /= ( const double & b ) { *this = *this / b; }\n}comp;\n\ncomp A[MAXN << 2], B[MAXN << 2], C[MAXN << 2];\nLL negt[MAXN];\nint a[MAXN << 1], b[MAXN << 1];\nLL mxNeg, sumA, sumB;\nint N, M;\n\nLL sqr( const LL x ) { return x * x; }\n\nLL cal( const int x, const bool type )\n{\n\tLL sa = 0, sb = 0;\n\tfor( int i = 1 ; i <= N ; i ++ ) sa += sqr( a[i] + type * x ), sb += sqr( b[i] + ( 1 - type ) * x );\n\treturn sa - 2 * ( mxNeg + ( type ? sumB * x : sumA * x ) ) + sb;\n}\n\nvoid FFT( comp *coe, const int len, const int type )\n{\n\tint lg2 = log2( len );\n\tfor( int i = 0, rev ; i < len ; i ++ )\n\t{\n\t\trev = 0;\n\t\tfor( int j = 0 ; j < lg2 ; j ++ ) rev |= ( ( i >> j ) & 1 ) << ( lg2 - j - 1 );\n\t\tif( rev < i ) std :: swap( coe[rev], coe[i] );\n\t}\n\tcomp wp, w, we, wo;\n\tfor( int s = 2, p ; s <= len ; s <<= 1 )\n\t{\n\t\tp = s >> 1, wp = comp( cos( type * PI / p ), sin( type * PI / p ) );\n\t\tfor( int i = 0 ; i < len ; i += s )\n\t\t{\n\t\t\tw = comp( 1, 0 );\n\t\t\tfor( int j = 0 ; j < p ; j ++, w *= wp )\n\t\t\t{\n\t\t\t\twe = coe[i + j], wo = coe[i + j + p];\n\t\t\t\tcoe[i + j] = we + wo * w, coe[i + j + p] = we - wo * w;\n\t\t\t}\n\t\t}\n\t}\n\tif( ~ type ) return ;\n\tfor( int i = 0 ; i <= len ; i ++ ) coe[i] /= len;\n}\n\nvoid times( const int la, const int lb )\n{\n\tint K = la + lb;\n\tint len = 1 << int( ceil( log2( K ) ) );\n\tif( len == K ) len <<= 1;\n\tFFT( A, len, 1 ), FFT( B, len, 1 );\n\tfor( int i = 0 ; i <= len ; i ++ ) C[i] = A[i] * B[i];\n\tFFT( C, len, -1 );\n}\n\nint main()\n{\n\tLL res = INF;\n\tread( N ), read( M );\n\tfor( int i = 1 ; i <= N ; i ++ ) read( a[i] ), a[i + N] = a[i], sumA += a[i];\n\tfor( int i = 1 ; i <= N ; i ++ ) read( b[i] ), b[i + N] = b[i], sumB += b[i];\n\tfor( int i = 1 ; i <= N << 1 ; i ++ ) A[i] = a[i], B[i] = b[( N << 1 ) - i + 1];\n\ttimes( N * 2 + 1, N * 2 + 1 );\n\tfor( int i = N ; i <= N << 1 ; i ++ ) \n\t\tmxNeg = MAX( mxNeg, ( LL ) round( C[i].r - C[i - N].r ) );\n\tfor( int i = 0 ; i <= M ; i ++ ) res = MIN( res, cal( i, true ) );\n\tfor( int i = 0 ; i <= M ; i ++ ) res = MIN( res, cal( i, false ) );\n\twrite( res ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1576735227,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[AH2017/HNOI2017]\u793c\u7269"
    },
    {
        "content": "$\\textbf{FFT}$.  \n~~\u6a21\u6570\u539f\u6839\u4e0d\u662f 3 \u751a\u81f3\u6ca1\u6709\u6a21\u6570\u7684\u591a\u9879\u5f0f\u9898\u90fd\u662f\u5c51\u3010\u534a\u607c\u3011~~  \n\u611f\u8c22\u8fd9\u9053\u9898\u8ba9\u6211\u590d\u4e60\u4e86 FFT \u7684\u5199\u6cd5\uff08  \n\u9996\u5148\u4e24\u4e2a\u624b\u73af\u90fd\u52a0\u4eae\u5ea6\u5c31\u7b49\u4ef7\u4e8e\u4e00\u4e2a\u624b\u73af\u52a0\u51cf\u4eae\u5ea6\uff0c\u8003\u8651\u52a0\u51cf\u7684\u4eae\u5ea6\u4e3a $\\ell$\uff0c\u5219\u6700\u540e\u7684\u5dee\u5f02\u503c\u4e3a\n$$\\sum_{i=1}^n(a_i-b_i+\\ell)^2$$\n\u8003\u8651\u62c6\u5f00\u5176\u4e2d\u4e00\u9879\uff0c\u5219\u5f97\uff1a\n$$a_i^2+b_i^2+\\ell^2+2\\times a_i\\times \\ell-2\\times b_i\\times \\ell-2\\times a_i\\times b_i$$\n\u90a3\u4e48\u539f\u5f0f\u53ef\u4ee5\u88ab\u8f6c\u5316\u4e3a\uff1a\n$$\\sum_{i=1}^n(a_i^2+b_i^2)+n\\times \\ell^2+2\\times \\ell\\times \\sum_{i=1}^n(a_i-b_i)-2\\times \\sum_{i=1}^n(a_i\\times b_i)$$\n\u8fd9\u65f6\u6211\u4eec\u53d1\u73b0\u5982\u679c $\\ell$ \u786e\u5b9a\uff0c\u90a3\u4e48\u6574\u4e2a\u5f0f\u5b50\u9664\u4e86\u6700\u540e\u4e00\u9879\u7684\u503c\u6211\u4eec\u90fd\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u6c42\u51fa\u6765\u3002\u7b54\u6848\u8981\u6c42\u6700\u5c0f\u5316\u5dee\u5f02\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u8ba9 $\\sum(a_i\\times b_i)$ \u6700\u5927\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u4e2a\u6700\u5927\u503c\u53ef\u4ee5\u7528\u5377\u79ef\u6c42\u51fa\u3002  \n\uff08\u6ca1\u6709\u6a21\u6570\u88ab\u8feb\u4f7f\u7528 FFT\uff0c\u5f88\u96be\u53d7\uff09  \n\uff08%%% lhx \u795e\u4ed9\uff09\n```cpp\n#include<bits/stdc++.h>\n#define N 100005\n#define MAXN 400005\n#define reg register\n#define inl inline\n#define int long long\n#define db double\nusing namespace std;\nstruct Complex\n{\n\tdb x,y;\n\tfriend Complex operator + (const Complex &x,const Complex &y)\n\t{\n\t\treturn ((Complex){x.x+y.x,x.y+y.y});\n\t}\n\tfriend Complex operator - (const Complex &x,const Complex &y)\n\t{\n\t\treturn ((Complex){x.x-y.x,x.y-y.y});\n\t}\n\tfriend Complex operator * (const Complex &x,const Complex &y)\n\t{\n\t\treturn ((Complex){x.x*y.x-x.y*y.y,x.x*y.y+x.y*y.x});\n\t}\n}f[MAXN],g[MAXN];\nconst db Pi=acos(-1.0);\nint n,m,lim,maxn,rev[MAXN],a[N],b[N];\ninl void FFT(reg Complex *A,reg int opt)\n{\n\tfor(reg int i=0;i<lim;i++) if(i<rev[i]) swap(A[i],A[rev[i]]);\n\tfor(reg int mid=1;mid<lim;mid<<=1)\n\t{\n\t\treg Complex Wn=((Complex){cos(Pi/(db)mid),(db)opt*sin(Pi/(db)mid)});\n\t\tfor(reg int j=0;j<lim;j+=(mid<<1))\n\t\t{\n\t\t\treg Complex W=((Complex){1,0});\n\t\t\tfor(reg int k=0;k<mid;k++,W=W*Wn)\n\t\t\t{\n\t\t\t\treg Complex x=A[j+k],y=W*A[j+k+mid];\n\t\t\t\tA[j+k]=x+y;\n\t\t\t\tA[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n}\nsigned main()\n{\n\treg int A=0,suma=0,B=0,sumb=0;\n\tscanf(\"%lld %lld\",&n,&m);\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld\",&a[i]);\n\t\tA+=a[i]*a[i];\n\t\tsuma+=a[i];\n\t}\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld\",&b[i]);\n\t\tB+=b[i]*b[i];\n\t\tsumb+=b[i];\n\t}\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tf[i].x=a[i];\n\t\tf[i+n].x=a[i];\n\t\tg[i].x=b[n-i+1];\n\t}\n\tlim=1;\n\tmaxn=0;\n\twhile(lim<=(n*3))\n\t{\n\t\tlim<<=1;\n\t\tmaxn++;\n\t}\n\tfor(reg int i=0;i<lim;i++) rev[i]=((rev[i>>1]>>1)|((i&1)<<maxn-1));\n\tFFT(f,1);\n\tFFT(g,1);\n\tfor(reg int i=0;i<=lim;i++) f[i]=f[i]*g[i];\n\tFFT(f,-1);\n\tfor(reg int i=0;i<=lim;i++) f[i].x=(int)(f[i].x/(db)lim+0.5);\n\treg int Ans=1e18;\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tfor(reg int j=-m;j<=m;j++) Ans=min(Ans,A+B+j*j*n+j*(suma-sumb)*2-(int)f[i+n].x*2);\n\t}\n\tprintf(\"%lld\\n\",Ans);\n\treturn 0;\n}\n```",
        "postTime": 1573479994,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\n\u5f0f\u5b50\u5316\u7b80\u4e00\u4e0b\uff0c\u53d1\u73b0\u6700\u540e\u53ea\u8ddf \u03a3 xi*yi \u6709\u5173\n\n\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u53cd\u8f6c\uff0c\u5c31\u53ef\u4ee5\u7528FFT\u4f18\u5316\n\n \n\n# \u6ce8\u610f\uff1a\n\n\u5faa\u73af\u4f1a\u60f3\u5230\u5c06\u5e8f\u5217\u590d\u5236\u4e00\u904d\uff0c\u4f46\u53ea\u80fd\u590d\u5236\u4e00\u4e2a\u5e8f\u5217\uff0c\n\n\u82e5n=4\uff0c\u7b2c\u4e00\u4e2a\u5e8f\u5217\u4e3a1 2 3 4,\uff0c\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u4e3a5 6 7 8\n\n\u53ea\u590d\u5236\u7b2c\u4e00\u4e2a\u5e8f\u5217\uff0c1 2 3 4 1 2 3 4\n\n\u5f53i=5\u65f6\uff0cf[i]=2*0+1*0+4*8+3*7+2*6+1*5\n\n\u5982\u679c\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u4e5f\u590d\u5236\uff0c\u90a3\u4e48\u4e0a\u9762*0\u7684\u5730\u65b9\u5c06\u4f1a\u51fa\u9519\n\n\n\n\n\n```\n#include<cmath>\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n\nusing namespace std;\n\nconst int N=(1<<18)+2;\n\nconst double pi=acos(-1);\n\nint a[N],b[N];\n\nstruct Complex \n{\n    double x,y;\n    Complex(double x_=0,double y_=0):x(x_),y(y_){}\n    Complex operator + (Complex P)\n    {\n        return Complex(x+P.x,y+P.y);\n    }\n    Complex operator - (Complex P)\n    {\n        return Complex(x-P.x,y-P.y);\n    }\n    Complex operator * (Complex P)\n    {\n        return Complex(x*P.x-y*P.y,x*P.y+y*P.x);\n    }\n};\ntypedef Complex E;\n\nE A[N],B[N];\nint rev[N];\n\nint f[N];\n\nvoid read(int &x)\n{\n    x=0; char c=getchar();\n    while(!isdigit(c)) c=getchar();\n    while(isdigit(c)) { x=x*10+c-'0'; c=getchar(); }\n}\n\nvoid fft(E *a,int len,int ty)\n{\n    for(int i=0;i<len;++i)\n        if(i<rev[i]) swap(a[i],a[rev[i]]);\n    for(int i=1;i<len;i<<=1)\n    {\n        E wn(cos(pi/i),ty*sin(pi/i));\n        for(int p=i<<1,j=0;j<len;j+=p)\n        {\n            E w(1,0);\n            for(int k=0;k<i;++k,w=w*wn)\n            {\n                E x=a[j+k],y=a[j+k+i]*w;\n                a[j+k]=x+y; a[j+k+i]=x-y;\n            }\n        }\n    }\n    if(ty==-1)\n    {\n        for(int i=0;i<len;++i) a[i].x=a[i].x/len+0.5;\n    }\n}\n\nint main()\n{\n    int n,m;\n    read(n); read(m);\n    long long sum2=0,sum=0;\n    for(int i=1;i<=n;++i) \n    {\n        read(a[i]);\n        sum+=a[i];\n        sum2+=a[i]*a[i];\n    }\n    for(int i=1;i<=n;++i) \n    {\n        read(b[i]);\n        sum-=b[i];\n        sum2+=b[i]*b[i];\n    }\n    for(int i=0;i<n;++i) A[i].x=a[i+1];\n    for(int i=0;i<n;++i) A[n+i].x=a[i+1];\n    for(int i=n,j=0;i;--i,++j) B[j].x=b[i];\n    int num=3*n-3,len=1,bit=0;\n    while(len<num) len<<=1,bit++;\n    for(int i=0;i<len;++i) rev[i]=(rev[i>>1]>>1)|((i&1)<<bit-1);\n    fft(A,len,1);\n    fft(B,len,1);\n    for(int i=0;i<len;++i) A[i]=A[i]*B[i];\n    fft(A,len,-1);\n    long long ab=0;\n/*    ab=A[n-1].x;\n    for(int i=0;i<n-1;++i) \n        ab=max(ab,(long long)A[i+n].x+(long long)A[i].x);\n*/\n    for(int i=0;i<n;++i) ab=max(ab,(long long)A[i+n-1].x);\n    ab<<=1;\n    long long mi=2e18;\n    for(int c=-m;c<=m;++c) mi=min(mi,1LL*n*c*c+1LL*2*c*sum);\n    cout<<sum2-ab+mi;\n}\n```\n",
        "postTime": 1561341074,
        "uid": 111289,
        "name": "Ryan_",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u63a8\u5bfc\u53ef\u5f97\n\n$ \\sum_{0}^{n-1}(a_{i}-b_{i}+c)^{2} $\n\n$ =\\sum_{0}^{n-1}(a_{i}^{2}+b_{i}^{2})+nc^{2}+2c\\sum_{0}^{n-1}(a_{i}-b_{i})-2\\sum_{0}^{n-1}a_{i}b_{i} $\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u7b2c\u4e00\u9879\u662f\u4e2a\u5e38\u6570\uff0c\u7b2c\u4e8c\u9879\u548c\u7b2c\u4e09\u9879\u4e00\u8d77\u662f\u4e00\u4e2a\u4e8c\u6b21\u51fd\u6570\u7684\u8868\u8fbe\u5f0f\uff0c\u5957\u7528\u516c\u5f0f $ f(x)_{min}= f(-\\frac{b}{2a}) $ \u5bf9 $-\\frac{b}{2a}$ \u56db\u820d\u4e94\u5165\u5373\u53ef\n\n\u90a3\u4e48\u7b2c\u56db\u9879\u8be5\u600e\u4e48\u600e\u4e48\u5904\u7406\u5462\n\n\u6211\u4eec\u53ef\u4ee5\u5c06 $a$ \u6570\u7ec4\u7ffb\u8f6c\uff0c\u4f7f $ a'_{n-1-i}=a_{i} $\n\n\u6211\u4eec\u4ee4 $ z_{k}=\\sum_{0}^{n-1}a_{i}b_{(i+k)\\%n} $ \n\n\u5219 $ z_{k}==\\sum_{0}^{n-1}a'_{n-1-i}b_{(i+k)\\%n} $\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5b9e\u9645\u4e0a\u4e0d\u9700\u8981\u5c06 $b$ \u6570\u7ec4\u500d\u957f\uff0c$z_{k}$ \u7684\u503c\u5c31\u662f\u8fd0\u7b97\u540e\u7684\u7b2c $k-1$ \u548c\u7b2c $n+k-1$ \u9879\u7684\u548c\uff08 $z_{0}$ \u5bf9\u5e94 $k==n$\uff09\u3002\u6700\u540e\u5bf9\u6240\u6709 $z_{k}$ \u53d6 $max$ \u518d\u4ece $ans$ \u4e2d\u51cf\u53bb\u5373\u53ef\n\n\u4ee3\u7801\u5982\u4e0b\n\n\uff08\u6570\u7ec4\u5f00 $131100$ \u662f\u56e0\u4e3a $2^{17}=131072>100000$\uff09\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\nusing namespace std;\n\ntypedef struct complex{\n    double a,b;\n    complex() {}\n    complex(double _a,double _b):a(_a),b(_b) {}\n    complex operator + (complex x) {return complex(a+x.a,b+x.b);}\n    complex operator - (complex x) {return complex(a-x.a,b-x.b);}\n    complex operator * (complex x) {return complex(a*x.a-b*x.b,a*x.b+b*x.a);}\n}complex;\n\nconst double Pi=acos(-1.0);\ncomplex a[131100],b[131100];\nint n,m,limit=1,r[131100],l;\ndouble ans,c,maxs=0;\n\nvoid FFT(complex *a,int type){\n    for(int i=0;i<limit;i++) if(i<r[i]) swap(a[i],a[r[i]]);\n    for(int len=1;len<limit;len<<=1){\n        complex w(cos(Pi/len),type*sin(Pi/len));\n        for(int i=0;i<limit;i+=(len<<1)){\n            complex k(1.0,0);\n            for(int j=0;j<len;j++,k=k*w){\n                complex x=a[i+j],y=k*a[i+j+len];\n                a[i+j]=x+y; a[i+j+len]=x-y;\n            }\n        }\n    }\n    if(type==-1) for(int i=0;i<limit;i++) a[i].a/=limit;\n}\n\ninline int read(){\n    int num=0,k=1; char c=getchar();\n    while(c>'9' || c<'0') k=(c=='-')?0:k,c=getchar();\n    while(c>='0' && c<='9') num=num*10+c-'0',c=getchar();\n    return k?num:-num;\n}\n\nint main(){\n    n=read(),m=read();\n    while(limit<=2*n) limit<<=1,l++;\n    for(int i=0;i<limit;i++) r[i]=((r[i>>1]>>1)|((i&1)<<(l-1)));\n    for(int i=0;i<n;i++) a[i].a=read();\n    for(int i=0;i<n;i++) b[i].a=read();\n    for(int i=0;i<n;i++) c+=(b[i].a-a[i].a),ans+=a[i].a*a[i].a+b[i].a*b[i].a;\n    c=floor(c/n+0.5);\n    for(int i=0;i<n;i++) ans+=2*c*(a[i].a-b[i].a);\n    ans+=n*c*c;\n    for(int i=0;n-1-i>i;i++) swap(a[i].a,a[n-1-i].a);\n    FFT(a,1); FFT(b,1);\n    for(int i=0;i<limit;i++) a[i]=a[i]*b[i];\n    FFT(a,-1);\n    for(int i=0;i<n;i++) maxs=max(maxs,a[i].a+a[i+n].a);\n    ans-=2*maxs;\n    printf(\"%.0f\",ans);\n    return 0;\n}\n\n```",
        "postTime": 1552100064,
        "uid": 100037,
        "name": "kkxhh",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u4f3c\u4e4e\u662f\u4e00\u9053\u6cd5\u6cd5\u5854(FFT)\u7684\u5957\u8def\u9898\u5462\n\n\u6211\u4eec\u9996\u5148\u8003\u8651\u8fd9\u4e2a$+c$\u600e\u4e48\u5904\u7406\n\n$$\\sum_{i=1}^n(x_i-y_i+c)^2=nc^2+2c\\sum_{i=1}^n(x_i-y_i)+\\sum_{i=1}^n(x_i^2+y_i^2)-2\\sum_{i=1}^n x_iy_i$$\n\n\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e$c$\u7684\u4e8c\u6b21\u51fd\u6570\uff0c\u6700\u5c0f\u503c\u53d6\n\n$c=-\\frac{\\sum_{i=1}^n(x_i-y_i)}n$\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u4e2a\u5c55\u5f00\u5f0f\u524d\u9762\u7684\u9879\u90fd\u5f88\u597d\u7b97\uff0c\u5c31\u6700\u540e\u4e00\u9879\u6bd4\u8f83\u9ebb\u70e6\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u6700\u540e\u4e00\u9879\u770b\u6210\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u7ffb\u8f6c\u4e00\u4e0b$b$\u6570\u7ec4\uff0c\u90a3\u6837\u5c31\u53ef\u4ee5\u7528\u6cd5\u6cd5\u5854\u5feb\u901f\u8ba1\u7b97\u4e86\n\n\u65cb\u8f6c\u64cd\u4f5c\u7684\u8bdd\u5c31\u662f\u79fb\u52a8$b$\u6570\u5217\u7136\u540e\u548c$a$\u5377\u79ef\uff0c\u5b9e\u73b0\u4e0a\u53ef\u4ee5\u628a$a$\u6570\u7ec4\u590d\u5236\u4e00\u904d\uff0c\u7136\u540e\u7528\u73b0\u5728\u7684$a$\u6570\u7ec4\u548c$b$\u6570\u7ec4\u5377\u79ef\uff0c\u53d6\u7b54\u6848\u4e2d$n+1$~$2n$\u4f4d\u7684\u6700\u5927\u5c31\u884c\n\n\u8fde\u7740\u7206\u4e86\u4e24\u6b2195\u5206\uff0c\u539f\u56e0\u662f\u8d1f\u5c0f\u6570\u53d6\u6574\u9700\u8981\u518d\u51cf1\uff0c\u7136\u540ec\u5c31\u7b97\u9519\u4e86qwq\uff0c\u8fd9\u4e2a\u7ec6\u8282\u8981\u6ce8\u610f\u7684\u5566\n\n```cpp\n#include<bits/stdc++.h>\n#define N 3000005\n#define fo(i, a, b) for (R int i = (a); i <= (b); ++i)\n#define in inline\n#define R register\nconst double pi = acos(-1);\nint a[N], b[N], len, len1, len2, n, m;\nstruct complex{\n    double real, imag;\n    in void conj ()\n    {\n        imag = -imag;\n    }\n    friend in complex operator * (const complex &x, const complex &y)\n    {\n        return (complex) {x.real * y.real - x.imag * y.imag, x.real * y.imag + x.imag * y.real};\n    }\n    friend in complex operator + (const complex &x, const complex &y)\n    {\n        return (complex) {x.real + y.real, x.imag + y.imag};\n    }\n    friend in complex operator - (const complex &x, const complex &y)\n    {\n        return (complex) {x.real - y.real, x.imag - y.imag};\n    }\n}c1[N], c2[N], omega[N];\nin void dft(complex *c, int len)\n{\n    int k = 0;\n    while ((1 << k) < len) ++k;\n    --k;\n    fo (i, 0, len)\n    {\n        int g = 0;\n        fo (j, 0, k)\n            if ((1 << j) & i) g |= (1 << k - j);\n        if (i < g) std::swap(c[i], c[g]);\n    }\n    for (int l = 2; l <= len; l <<= 1)\n    {\n        int mid = l >> 1;\n        for (complex *p = c; p != c + len; p += l)\n            for (int i = 0; i < mid; ++i)\n            {\n                complex tmp = omega[len / l * i] * p[mid + i];\n                p[mid + i] = p[i] - tmp;\n                p[i] = p[i] + tmp;\n            }\n    }\n}\ninline long long flor (double x)\n{\n    if (x > 0)\n        return (long long) x;\n    else\n        return (long long) (x - 1.0);\n}\nint main()\n{\n    scanf(\"%d %d\", &n, &m);\n    fo (i, 1, n) scanf(\"%d\", &a[i]); \n    fo (i, 1, n) scanf(\"%d\", &b[i]);\n    long long sum = 0, c;\n    long long ans = 0;\n    fo (i, 1, n) sum += a[i] - b[i];\n    c = flor(- 1.0 * sum / n + 0.5);\n    fo (i, 1, n)\n        ans += a[i] * a[i] + b[i] * b[i];\n    ans += 1ll * n * c * c + 1ll * 2 * c * sum;\n    std::reverse(b + 1, b + n + 1);\n    fo (i, 1, n) a[i + n] = a[i];\n    int len = 1;\n    while (len <= n * 3) len = len << 1;\n    fo (i, 1, n << 1) c1[i - 1].real = a[i];\n    fo (i, 1, n) c2[i - 1].real = b[i];\n    fo (i, 0, len)\n        omega[i] = (complex) {cos(2 * pi * i / len), sin(2 * pi * i / len)};\n    dft(c1, len);\n    dft(c2, len);\n    fo (i, 0, len)\n        c1[i] = c1[i] * c2[i];\n    fo (i, 0, len)\n        omega[i].conj();\n    dft(c1, len);\n    sum = 0;\n    fo (i, n - 1, 2 * n - 1)\n        sum = std::max(sum, (long long) ((c1[i].real + 0.5) / len));\n    printf(\"%lld\", ans - sum * 2);\n}\n```",
        "postTime": 1551269531,
        "uid": 13137,
        "name": "HomuraCat",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u8bbe\u7b2c\u4e00\u4e2a\u4e32\u4e3a$a$,\u7b2c\u4e8c\u4e2a\u4e32\u4e3a$b$\u3002 \n\n\u4e0d\u59a8\u8ba9\u6211\u4eec\u7684\u6240\u6709\u64cd\u4f5c\u5bf9$b$\u8fdb\u884c\u3002\n\n\u5982\u679c\u6211\u4eec\u5c06$b$\u9006\u65f6\u9488\u8f6c\u52a8$j(0\\le j<n)$\u4e2a\u5355\u4f4d,\u90a3\u4e48\u4e0e$a_i$\u5bf9\u5e94\u7684\u88c5\u9970\u7269\u5c31\u662f$b_{i+j}$\u4e86\u3002\n\n\u6ce8:\u5728\u672c\u6587\u4e2d,\u6570\u7ec4\u4e0b\u6807\u4ece1\u5f00\u59cb\u3002\u5bf9\u4e8e$b$,\u5f53\u6570\u7ec4\u4e0b\u6807\u5927\u4e8e\u6570\u7ec4\u957f\u5ea6,\u6211\u4eec\u5c06\u5176\u5bf9\u6570\u7ec4\u957f\u5ea6\u53d6\u4f59\u3002\n\n\u6211\u4eec\u5bf9$b$\u8fdb\u884c\u4e86$j(0\\le j<n)$\u6b21\u9006\u65f6\u9488\u65cb\u8f6c,\u589e\u52a0\u4e86$c(-m\\le c\\le m)$\u7684\u4eae\u5ea6,\u8bbe$ans_x$\u8868\u793a$j=x$\u65f6\u7684\u7b54\u6848,\u90a3\u4e48\n\n$ans_j=\\sum_{i=1}^n(a_i-b_{i+j}-c)^2$\n\n$ans_j=\\sum_{i=1}^n[a_i^2+b_{i+j}^2-2c(a_i-b_{i+j})-2a_ib_{i+j}+c^2]$\n\n$ans_j=\\sum_{i=1}^na_i^2+\\sum_{i=1}^nb_{i+j}^2-2c(\\sum_{i=1}^na_i-\\sum_{i=1}^nb_{i+j})+ nc^2-2\\sum_{i=1}^na_ib_{i+j}$\n\n$ans_j=\\sum_{i=1}^na_i^2+\\sum_{i=1}^nb_i^2-2c(\\sum_{i=1}^na_i-\\sum_{i=1}^nb_i)+nc^2-2\\sum_{i=1}^na_ib_{i+j}$\n\n\u53d1\u73b0\u53ea\u6709\u6700\u540e\u4e00\u9879\u4e0e$j$\u6709\u5173,\u4e14\u8be5\u9879\u4e0e$c$\u65e0\u5173\u3002\n\n\u8003\u8651\u6c42$\\sum_{i=1}^na_ib_{i+j}$\u3002\n\n\u6211\u4eec\u7ffb\u8f6c$b$\u3002\u5219\u539f\u5f0f\u53d8\u4e3a\n\n$\\sum_{i=1}^na_ib_{n+j-i+1}$\n\n\u53d1\u73b0\u4e0a\u5f0f\u662f\u5377\u79ef\u7684\u5f62\u5f0f\u3002\n\n\u8fd9\u6837\u770b\u4e0d\u660e\u663e,\u4f46\u662f\u5982\u679c\u6211\u4eec\u8ba4\u4e3a\u5f53$i>n$,$a_i=0$,\u90a3\u539f\u5f0f\u7b49\u4ef7\u4e8e\n\n$\\sum_{i=1}^{n+j}a_ib_{n+j-i+1}$\n\n\u5c31\u5f88\u660e\u663e\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8bbe\u5f53$j=x$,\u539f\u5f0f\u503c\u4e3a$v_{n+j}$,\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528$FFT$\u6c42\u51fa$v$,\u7531\u4e8e$v_{n+j}$\u8d8a\u5927,$ans_j$\u8d8a\u5c0f,\u5f53$0\\le j<n$,$n\\le n+j<2n$,\u6240\u4ee5\u539f\u5f0f\u7684\u6700\u5927\u503c\u4e3a$max_{i=n}^{2n-1}v_i$\u3002\n\n\u6211\u4eec\u679a\u4e3e$c$,\u5373\u53ef\u6c42\u5f97\u5176\u4ed6\u9879\u7684\u7b54\u6848,\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nm\\log n)$\n\ncode:\n\n\u6ce8:\u65b9\u4fbf\u8fdb\u884c$FFT$,\u4ee3\u7801\u4e2d\u4e0b\u6807\u4ece0\u5f00\u59cb\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define VAL(x) (int)(fabs(x.re)/(N*1.0)+0.5)\nusing namespace std;\nconst int INF=2e9;\nconst double pi=acos(-1);\nstruct com{\n\tdouble re,in;\n}f[300010],f1[300010],f2[300010],cpy[300010];\ncom operator+(const com &x,const com &y){\n\treturn (com){x.re+y.re,x.in+y.in};\n}\ncom operator-(const com &x,const com &y){\n\treturn (com){x.re-y.re,x.in-y.in};\n}\ncom operator*(const com &x,const com &y){\n\treturn (com){x.re*y.re-x.in*y.in,x.re*y.in+x.in*y.re};\n}\nint n,m,N=1,a,b,a1,b1,a2,b2,mx;\nlong long ans=INF;\nvoid FFT(com *f,int l,int len,int op){\n\tif(len<2)return;\n\tint nl=len>>1,tmp=l-1;\n\tfor(int i=l;i<l+len;++i)cpy[i]=f[i];\n\tfor(int i=l;i<l+nl;++i)f[i]=cpy[++tmp],f[i+nl]=cpy[++tmp];\n\tFFT(f,l,nl,op),FFT(f,l+nl,nl,op);\n\tcom w=(com){cos(pi/(1.0*nl)),sin(pi/(1.0*nl)*op)},nw=(com){1,0},t;\n\tfor(int i=l;i<l+nl;++i,nw=nw*w)t=nw*f[i+nl],cpy[i]=f[i]+t,cpy[i+nl]=f[i]-t;\n\tfor(int i=l;i<l+len;++i)f[i]=cpy[i];\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;++i)scanf(\"%d\",&a),f1[i-1]=(com){a,0},a1+=a,a2+=a*a;//len(f1)=n\n\tfor(int i=1;i<=n;++i)scanf(\"%d\",&b),f2[n-i]=f2[n-i+n]=(com){b,0},b1+=b,b2+=b*b;//len(f2)=2n\n\t//len(f)=3n-1\n\twhile(N<3*n-1)N<<=1;\n\tFFT(f1,0,N,1),FFT(f2,0,N,1);\n\tfor(int i=0;i<N;++i)f[i]=f1[i]*f2[i];\n\tFFT(f,0,N,-1);\n\t//f[x]=sum(0<=i<=x)f1[i]*f2[x-i]\n\tfor(int i=n-1;i<2*n-1;++i)mx=max(mx,VAL(f[i]));\n\tfor(int i=-m;i<=m;++i)ans=min(ans,1ll*n*i*i+2*i*(a1-b1));\n\tprintf(\"%lld\",ans+a2+b2-2*mx);\n\treturn 0;\n}\n```",
        "postTime": 1550219258,
        "uid": 26294,
        "name": "xryjr233",
        "ccfLevel": 9,
        "title": "[2019.2.15]LuoguP3723/BZOJ4827 [Hnoi2017]\u793c\u7269(\u6570\u5b66/FFT)"
    },
    {
        "content": "[$blog$](https://www.cnblogs.com/hbxblog/p/10328890.html)\n### $Solution$  \n\n\u5e94\u4e3a\u6211\u4eec\u53ef\u4ee5\u5c06\u4efb\u610f\u4e00\u4e2a\u6570\u5217\u52a0\u4e0a\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff0c\u5373\u53ef\u4ee5\u53d8\u4e3a\u5c06\u4e00\u4e2a\u6570\u5217\u52a0\u4e0a\u4e00\u4e2a\u6574\u6570(\u53ef\u4ee5\u4e3a\u8d1f),\u6211\u4eec\u5c06\u8fd9\u4e2a\u6574\u6570\u8bbe\u4e3a$z$.\u6240\u4ee5\u8981\u6c42\u7684\u5f0f\u5b50\u7684\u53d8\u4e3a\uff1a  \n$$\\sum_{i=1}^{n}(x_i-y_i+z)^2$$  \n\u9996\u5148\u6765\u5316\u7b80\u4e00\u4e0b\u5f0f\u5b50  \n$$\\sum_{i=1}^{n}(x_i-y_i+z)^2$$  \n$$\\sum_{i=1}^{n}x_i^2+\\sum_{i=1}^{n}y_i^2+\\sum_{i=1}^{n}z_i^2+2z\\sum_{i=1}^{n}(x_i-y_i)-2\\sum_{i=1}^{n}x_i*y_i$$  \n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e0d\u7ba1\u5982\u4f55\u53d8\u5316$\\sum_{i=1}^{n}x_i^2+\\sum_{i=1}^{n}y_i^2$\u7684\u503c\u90fd\u4e0d\u4f1a\u53d8.  \n\n\u7136\u540e\u518d\u770b\u770b$\\sum_{i=1}^{n}z_i^2+2z\\sum_{i=1}^{n}(x_i-y_i)$\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e$z$\u7684\u4e8c\u6b21\u51fd\u6570.\u6700\u5c0f\u503c\u53ef\u4ee5$O(1)$\u7b97\u51fa\u4f46\u662f\u6ce8\u610f\u4e00\u4e0b$z$\u5fc5\u987b\u662f\u6574\u6570\u800c\u4e14\u53ef\u4ee5\u4e3a\u8d1f,\u6240\u4ee5\u9700\u8981\u5c06$-\\frac{x_i-y_i}{n}$\u5411\u4e0a\u548c\u5411\u4e0b\u53d6\u6574\u5e76\u5e26\u5165\u5f0f\u5b50\u53d6\u6700\u5c0f\u503c.  \n\n\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u53ea\u9700\u8981\u7b97\u51fa$2\\sum_{i=1}^{n}x_i*y_i$\u7684\u6700\u5927\u503c\u5373\u53ef.\n\u8fd9\u4e2a\u5982\u4f55\u53bb\u7b97,\u5c06$y$\u53d8\u6210\u94fe,\u5728\u8fdb\u884c\u4e00\u6b21$fft$\u5728\u53d6\u4e00\u4e2a\u6700\u5927\u503c\u5c31\u597d\u4e86\n\n### $Code$\n``` cpp\n#include<bits/stdc++.h>\n#define int long long\n#define rg register\n#define file(x) freopen(x\".in\",\"r\",stdin);freopen(x\".out\",\"w\",stdout);\nusing namespace std;\nint read(){\n    int x=0,f=1;\n    char c=getchar();\n    while(c<'0'||c>'9') f=(c=='-')?-1:1,c=getchar();\n    while(c>='0'&&c<='9') x=x*10+c-48,c=getchar();\n    return f*x;\n}\nconst int N=3000001;\nconst double pi=3.14159265358979323846;\nstruct node {\n    double x,y;\n    node operator + (node z)const {\n        return (node){x+z.x,y+z.y};\n    }\n    node operator - (node z)const {\n        return (node){x-z.x,y-z.y};\n    }\n    node operator * (node z)const {\n        return (node){x*z.x-y*z.y,y*z.x+x*z.y};\n    }\n}f[N],g[N];\nint r[N],limit=1;\nvoid fft(node *a,int opt){\n    for(int i=0;i<=limit;i++)\n        if(i<r[i])\n            swap(a[i],a[r[i]]);\n    for(int i=1;i<limit;i<<=1){\n        node w=(node){cos(pi/i),opt*sin(pi/i)};\n        for(int j=0;j<limit;j+=i<<1){\n            node l=(node){1,0};\n            for(int k=j;k<j+i;k++){\n                node p=l*a[k+i];\n                a[k+i]=a[k]-p;\n                a[k]=a[k]+p;\n                l=l*w;\n            }\n        }\n    }\n}\nint a[N],b[N];\nmain(){\n    int n=read(),k=read(),l=0,m=n,js=0,ans=0;\n    for(int i=1;i<=n;i++)\n        a[i]=f[i].x=read(),f[i+n].x=f[i].x,js+=a[i],ans+=a[i]*a[i];\n    for(int i=1;i<=n;i++)\n\t\tb[i]=read(),js-=b[i],ans+=b[i]*b[i];\n\treverse(b+1,b+n+1);\n\tfor(int i=1;i<=n;i++)\n\t\tg[i].x=b[i];\n\tint A=-floor(js*1.0/n),B=-ceil(js*1.0/n);\n\tans+=min(A*A*n+2*A*js,B*B*n+2*B*js);\n\tn*=2;\n\twhile(limit<=n+m)\n        limit<<=1,l++;\n    for(int i=0;i<limit;i++)\n        r[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n    fft(f,1),fft(g,1);\n    for(int i=0;i<=limit;i++)\n        f[i]=f[i]*g[i];\n    fft(f,-1);\n\tint maxx=0;\n    for(int i=m;i<=n+1;i++)\n\t\tmaxx=max((int)(f[i].x/limit+0.5),maxx);\n\tprintf(\"%lld\",ans-2*maxx);\n}\n\n```",
        "postTime": 1548640154,
        "uid": 19805,
        "name": "\u64a4\u4e91",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u849f\u84bb\u535a\u5ba2\uff1a[QwQ](https://www.cnblogs.com/GoldenPotato/p/10296961.html)\uff08\u6233\u6211\u83b7\u5f97\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8cw\uff09\n\n---\n# Solution\n\n~~\u8c03\u5f97\u6211\u5934\u5927\uff0c\u6211\u597d\u83dc\u554a~~\n\n\u597d\u5427\uff0c\u6211\u4eec\u6765\u9893\u67ff\u5b50\u5427\uff1a\n\u6211\u4eec\u53ef\u4ee5\u53ea\u65cb\u8f6c\u5176\u4e2d\u4e00\u4e2a\u624b\u73af\u3002\u5bf9\u4e8e\u4eae\u5ea6\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5728\u4e24\u4e2a\u4e32\u4e0a\u589e\u52a0\u4eae\u5ea6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u505a\u662f\u53ef\u4ee5\u4e3a\u8d1f\u6570\u7684\u3002\n\n\n\u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe\u6211\u4eec\u65cb\u8f6c$B$\u4e32\uff0c\u4e0a\u4e0b\u8981\u52a0\u4e0a\u7684\u4eae\u5ea6\u5dee\u4e3a$p$,\u53ef\u4ee5\u76f4\u63a5\u62cd\u51fa\u4e00\u4e2a\u6700\u66b4\u529b\u7684\u67ff\u5b50\uff1a\n\u8bbe$f(x)$\u8868\u793a$B$\u4e32\u4ee5$x$\u4e3a\u5f00\u5934\u7684\u5dee\u5f02\u503c\uff0c\u6709\uff1a\n$f(x)=\\sum_{i=0}^{x-1}(B[i]-A[i+n-x]+p)^2+\\sum_{i=x}^{n-1}(B[i]-A[i-x]+p)^2$\n\n\u5927\u529b\u5c55\u5f00\u5316\u7b80\u540e\u6709\uff1a\n$f(x)=\\sum_{i=0}^{n-1}A[i]^2+\\sum_{i=0}^{n-1}B[i]^2+n*p^2-2p\\sum_{i=0}^{n-1}(A[i]-B[i])-2\\sum_{i=0}^{x-1}(B[i]*A[i+n-x])-2\\sum_{i=x}^{n-1}(B[i]*A[i-x])$\n\n\u524d\u4e24\u9879$\\sum_{i=0}^{n-1}A[i]^2+\\sum_{i=0}^{n-1}B[i]^2$\u663e\u7136$O(n)$\u9884\u5904\u7406\u51fa\u6765\n\n\u4e2d\u95f4\u4e24\u9879$n*p^2-2p\\sum_{i=0}^{n-1}(A[i]-B[i])$\u662f\u4e00\u4e2a\u5173\u4e8e$p$\u7684\u4e8c\u6b21\u51fd\u6570\uff0c\u6211\u4eec\u627e\u6700\u5c0f\u503c\u5c31\u597d\u3002\uff08\u56e0\u4e3a\u8fd9\u9898$m$\u975e\u5e38\u5c0f\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e\uff09\uff0c\u590d\u6742\u5ea6$O(1)$\u6216$O(m)$\u3002\n\n\u6700\u540e\u4e24\u9879$-2\\sum_{i=0}^{x-1}(B[i]*A[i+n-x])-2\\sum_{i=x}^{n-1}(B[i]*A[i-x])$\u770b\u8d77\u6765\u975e\u5e38\u50cf\u5377\u79ef\uff0c\u4f46\u662f\u5e76\u4e0d\u662f\uff0c\u56e0\u6b64\u6211\u4eec\u5f97\u505a\u70b9\u5904\u2642\u7406\u3002\n\n\n\u849f\u84bb\u672c\u4eba\u662f\u8fd9\u6837\u5904\u7406\u7684\uff1a\n\u9996\u5148\uff0c\u540e\u9762\u90a3\u4e2a\u5faa\u73af\u8303\u56f4\u662f\u80af\u5b9a\u6ca1\u6cd5\u5377\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u5148\u628a\u540e\u9762\u7684\u5faa\u73af\u5904\u7406\u4e00\u4e0b\u5f97\uff1a\n$-2\\sum_{i=0}^{x-1}(B[i]*A[i+n-x])-2\\sum_{i=0}^{n-x-1}(A[i]*B[i+x])$\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u524d\u9762\u90a3\u9879\u7684$A$\u53cd\u8f6c(\u8fd9\u6837\u53ef\u4ee5\u5904\u7406\u6389$n$\u6765\u65b9\u4fbf\u5377\u79ef)\uff0c\u628a\u540e\u9762\u90a3\u9879\u7684$B$\u53cd\u8f6c(\u8fd9\u6837\u53ef\u4ee5\u5236\u9020$n$\u4e0e$\\sum$\u5bf9\u5e94)\n$-2\\sum_{i=0}^{x-1}(B[i]*A'[x-1-i])-2\\sum_{i=0}^{n-x-1}(A[i]*B'[n-1-i-x])$\n\n\n\u54e6\u8c41\uff0c\u5377\u79ef\uff0c\u641e\u5b9a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n*logn)$\n\n---\n# Code\n\n~~\u6211\u4ec0\u4e48\u65f6\u5019\u624d\u80fd\u4e00\u6b21\u6027\u5199\u5bf9FFT\u554a~~\n```cpp\n//Luogu P3723 [AH2017/HNOI2017]\u793c\u7269\n//Jan,20th,2019\n//\u9893\u67ff\u5b50+FFT\u52a0\u901f\u8ba1\u7b97\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<complex>\n#include<algorithm>\nusing namespace std;\nlong long read()\n{\n\tlong long x=0,f=1; char c=getchar();\n\twhile(!isdigit(c)){if(c=='-') f=-1;c=getchar();}\n\twhile(isdigit(c)){x=x*10+c-'0';c=getchar();}\n\treturn x*f;\n}\nconst int M=50000+100;\nconst int N=M*4;\nconst double PI=acos(-1);\ntypedef complex <double> cp;\ninline cp omega(int K,int n)\n{\n\treturn cp(cos(2*PI*K/n),sin(2*PI*K/n));\n}\nvoid FFT(cp a[],int n,bool type)\n{\n\tstatic int tmp[N],num=n-1,len=0;\n\twhile(num!=0) num/=2,len++;\n\tfor(int i=0,j;i<=n;i++)\n\t{\n\t\tfor(j=0,num=i;j<len;j++)\n\t\t\ttmp[j]=num%2,num/=2;\n\t\treverse(tmp,tmp+len);\n\t\tfor(j=0,num=0;j<len;j++)\n\t\t\tnum+=tmp[j]*(1<<j);\n\t\tif(i<num) swap(a[i],a[num]);\n\t}\n\tfor(int l=2;l<=n;l*=2)\n\t{\n\t\tcp x0=omega(1,l);\n\t\tif(type==true) x0=conj(x0);\n\t\tint m=l/2;\n\t\tfor(int j=0;j<n;j+=l)\n\t\t{\n\t\t\tcp x(1,0);\n\t\t\tfor(int k=0;k<m;k++,x*=x0)\n\t\t\t{\n\t\t\t\tcp temp=x*a[j+k+m];\n\t\t\t\ta[j+k+m]=a[j+k]-temp;\n\t\t\t\ta[j+k]=a[j+k]+temp;\n\t\t\t}\n\t\t}\n\t}\n}\nint n,m,a[N],b[N];\ncp B1[N],A1[N],B2[N],A2[N];\nlong long ans;\nint main()\n{\n\tfreopen(\"3723.in\",\"r\",stdin);\n\t\n\tn=read(),m=read();\n\tfor(int i=0;i<n;i++)\n\t\ta[i]=read();\n\tfor(int i=0;i<n;i++)\n\t\tb[i]=read();\n\t\n\tlong long dif=0;\n\tfor(int i=0;i<n;i++)\n\t\tans+=a[i]*a[i]+b[i]*b[i],dif+=a[i]-b[i];\n\tlong long t_ans=0x3f3f3f3f*0x3f3f3f3f;\n\tfor(int i=-m;i<=m;i++)\n\t\tt_ans=min(t_ans,n*i*i-2*i*dif);\n\tans+=t_ans;\n\t\n\tint t=1;\n\twhile(t<2*n) t*=2;\n\treverse(a,a+n);\n\tfor(int i=0;i<n;i++)\n\t\tA1[i]=a[i],B1[i]=b[i];\n\tFFT(A1,t,false);\n\tFFT(B1,t,false);\n\tfor(int i=0;i<t;i++)\n\t\tA1[i]*=B1[i];\n\tFFT(A1,t,true);\n\tfor(int i=0;i<t;i++)\n\t\tA1[i].real()/=t;\n\t\t\n\treverse(a,a+n);\n\treverse(b,b+n);\n\tfor(int i=0;i<n;i++)\n\t\tA2[i]=a[i],B2[i]=b[i];\n\tFFT(A2,t,false);\n\tFFT(B2,t,false);\n\tfor(int i=0;i<t;i++)\n\t\tA2[i]*=B2[i];\n\tFFT(A2,t,true);\n\tfor(int i=0;i<t;i++)\n\t\tA2[i].real()/=t;\n\t\n\tt_ans=(long long)(2*floor(A2[n-1].real()+0.5));\n\tfor(int i=1;i<n;i++)\n\t\tt_ans=max(t_ans,(long long)(2*floor(A1[i-1].real()+A2[n-i-1].real()+0.5)));\n\tans-=t_ans;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n\n```\n\n\n\n\n\n\n\n",
        "postTime": 1548029342,
        "uid": 52563,
        "name": "GoldenPotato137",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "~~\u7b2c\u4e00\u6b21\u81ea\u5df1\u505a\u51fa\u7684fft\u9898\u76ee\uff0c\u5f00\u5fc3~~\n\n\u9898\u610f:\u6c42$\\sum^{n}_{i=1}(xi-yi)^2$\u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u8ba9$x$\u6216$y$\u6574\u4f53\u52a0\u4e0a\u4e00\u4e2a\u6570\u6216\u8005\u628a\u4e00\u4e2a\u6570\u5217\u5411\u5de6\u8f6c\u4e00\u4f4d\u3002\n\n\u4e00\u4e2a\u663e\u7136\u7684\u7ed3\u8bba\uff0c\u5982\u679c\u4e24\u4e2a\u6570\u5217\u540c\u65f6\u64cd\u4f5c\u7684\u8bdd\uff0c\u90a3\u4e48\u7b49\u540c\u4e8e\u5bf9\u4e00\u4e2a\u6570\u5217\u64cd\u4f5c\u3002\u6240\u4ee5\u6211\u4eec\u9ed8\u8ba4\u7528$x$\u64cd\u4f5c\n\n\u5047\u8bbe\uff0c\u6211\u4eec\u73b0\u5728\u628a$x$\u6570\u5217\u52a0\u4e0a\u4e86$a$\uff0c\u90a3\u4e48\u539f\u5f0f\uff1d$\\sum^{n}_{i=1}(xi-yi+a)^2$\u5176\u4e2d$a$\u662f\u4efb\u610f\u6574\u6570\u3002\n\n\u7136\u540e\u66b4\u529b\u5c55\u5f00\n\n\u4e0b\u9762\u7684$\\sum$\u5747\u8868\u793a$\\sum^{n}_{i=1}$\n\n\u539f\u5f0f=$\\sum{xi}^2+\\sum{yi}^2-2*\\sum{xiyi}+2a\\sum{xi-yi}+\\sum{a^2}$\n\n\u6240\u4ee5\uff0c\u5f53$x$\u548c$y$\u6570\u5217\u662f\u786e\u5b9a\u7684\u65f6\u5019\uff0c\u663e\u7136$\\sum{xi}^2+\\sum{yi}^2$\u662f\u56fa\u5b9a\u7684\uff0c$2a(\\sum{xi}-\\sum{yi})+\\sum{a^2}$\u7684\u6700\u5c0f\u503c\u662f\u56fa\u5b9a\u7684,\u5c31\u662f\u4e8c\u6b21\u51fd\u6570\u7684\u5bf9\u79f0\u8f74\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u6c42$\\sum{xiyi}$\u7684\u6700\u5927\u503c\n\n\u56e0\u4e3a\u6570\u5217\u53ef\u4ee5\u5de6\u79fb\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u628a\u6570\u5217\u500d\u957f\u3002\n\n\u90a3\u4e48\u6211\u4eec\u7684\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u6c42$min(\\sum_{i=1+j}^{1+j+n})(j\\in[0,n])$\n\n\u8003\u8651\u5339\u914d\u7684\u6bcf\u4e00\u4f4d\u7684\u4e0b\u6807\u7684\u548c\u76f8\u7b49\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u628a\u8fd9\u4e2a\u500d\u957f\u6570\u5217\u7ffb\u8f6c\uff0c\u4e3a\u4e86\u8ba9\u5b83\u6ee1\u8db3$fft$\u7684\u5f62\u5f0f\u3002\uff08$fft$\u7ffb\u8f6c\u4f8b\u9898[\u6233\u8fd9\u91cc](https://www.luogu.org/problemnew/show/P4173))\n\n\u4ee3\u7801\u5982\u4e0b\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define maxn 400008*2\nint l=1,tmp=0;\nint n,m;\nstruct c{\n    double r,i;\n    c (){}\n    c (double rr,double ii){r=rr,i=ii;}\n    c operator + (const c &x){return c(r+x.r,i+x.i);}\n    c operator - (const c &x){return c(r-x.r,i-x.i);}\n    c operator * (const c &x){return c(r*x.r-i*x.i,r*x.i+i*x.r);}\n    c operator / (const int &x){return c(r/x,i/x);}\n};\nc w[maxn];\nint r[maxn];\nc x[maxn];\nc y[maxn];\nint sum_x=0;\nint sum_y=0;\nint sum_x_2=0;\nint sum_y_2=0;\nint ans=0;\nconst double pi=3.1415926535;\nvoid init(int tmp){\n    for(int i=0;i<l;i++){\n        w[i]=c(cos(2.0*pi*i/l),sin(2.0*pi*i/l));\n        r[i]=(r[i>>1]>>1)|((i&1)<<(tmp-1));\n    }\n}\nvoid FFT(c a[],int type){\n    for(int i=0;i<l;i++)if(i>r[i])swap(a[i],a[r[i]]);\n    for(int len=1,t=l>>1;len<l;len<<=1,t>>=1){\n        for(int i=0;i<l;i+=(len<<1)){\n            for(int j=0;j<len;j++){\n                c ww=w[t*j];\n                ww.i*=type;\n                c x=a[i+j];\n                c y=a[i+j+len]*ww;\n                a[i+j]=x+y;\n                a[i+j+len]=x-y;\n            }\n        }\n    }\n    if(type==-1)for(int i=0;i<l;i++)a[i]=a[i]/l;\n}\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    for(int i=0;i<n;i++){\n        scanf(\"%lf\",&x[i].r);\n        sum_x+=x[i].r;\n        sum_x_2+=x[i].r*x[i].r;\n    }\n    for(int i=0;i<n;i++){\n        scanf(\"%lf\",&y[i].r);\n        sum_y+=y[i].r;\n        sum_y_2+=y[i].r*y[i].r;\n    }\n    double delta=sum_x-sum_y;\n    ans+=sum_x_2+sum_y_2;\n    int a=round(-delta/(double)n);\n    ans+=a*delta*2+n*a*a;\n    for(int i=0;i<n/2;i++)swap(y[i],y[n-i-1]);\n    for(int i=n;i<n+n;i++)y[i]=y[i-n];\n    int A=n,B=2*n;\n    tmp=0,l=1;\n    for(;l<A+B;l<<=1,tmp++);\n    init(tmp);\n    FFT(x,1),FFT(y,1);\n    for(int i=0;i<l;i++)x[i]=x[i]*y[i];\n    FFT(x,-1);\n    int MIN=0;\n    for(int i=n-1;i<3*n;i++)MIN=max(MIN,int(x[i].r+0.5));\n    ans-=MIN*2;\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1545438528,
        "uid": 53023,
        "name": "tiandong123",
        "ccfLevel": 0,
        "title": "[AH2017/HNOI2017]\u793c\u7269 \u9898\u89e3"
    },
    {
        "content": "\u5e7f\u544a\uff1a\u98df\u7528[$blog$](https://www.cnblogs.com/heyujun/p/10334711.html)\u4f53\u9a8c\u66f4\u4f73\n\n\u9996\u5148\u6211\u4eec\u5c06$c$\u770b\u4f5c\u4e00\u4e2a\u53ef\u4ee5\u4e3a\u8d1f\u7684\u6574\u6570\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7701\u53bb\u8ba8\u8bba\u5728\u54ea\u4e2a\u624b\u73af\u52a0$c$\u7684\u7e41\u7410\u6b65\u9aa4\u4e86\n\n\u8bbe\u6211\u4eec\u5f53\u524d\u5df2\u7ecf\u9009\u597d\u4e86\u624b\u73af\u7684\u987a\u5e8f\n\n\u5219\n$$Ans=\\sum_{i=1}^n(x_i-y_i+c)^2$$\n$$=\\sum_{i=1}^nx_i^2+\\sum_{i=1}^ny_i^2+n*c^2+2c\\sum_{i=1}^n(x_i-y_i)-2\\sum_{i=1}^nx_i*y_i$$\n\n\u5b9e\u9645\u4e0a\uff0c\u56e0\u4e3a\u524d\u9762\u90fd\u662f\u5b9a\u503c($C$\u7684\u53d6\u503c\u53ef\u4ee5\u679a\u4e3e)\uff0c\u6240\u4ee5\u8981\u6c42\n\n$$\\sum_{i=1}^nx_i*y_i$$\n\n\u6700\u5927\u5c31\u884c\u4e86\u3002\n\n\u6211\u4eec\u5c06$y_i$\u53cd\u5411\uff0c\u90a3\u4e48\u539f\u5f0f\u5c31\u662f\u4e00\u4e2a\u5377\u79ef\u3002\n\n\u8fd9\u91cc\u6709\u4e2a\u5f88\u5de7\u5999\u7684$trick$\uff1a\u5c06$y$\u518d\u500d\u957f\u4e00\u4e0b\uff0c\u53d6$x*y$\u4e2d\u7b2c$n+1$\u5230$2n$\u9879\u7684\u6700\u5c0f\u503c\u5373\u53ef\uff0c\u8fd9\u6837\n\n\u5c31\u5f88\u5de7\u5999\u5730\u6a21\u62df\u4e86\u7ffb\u8f6c\u7684\u8fc7\u7a0b\n\n\u4ee3\u7801\n\n```cpp\n#include <iostream> \n#include <cstdio> \n#include <cstdlib> \n#include <cstring> \n#include <cmath> \n#include <algorithm> \nusing namespace std; \ninline int gi() {\n\tregister int data = 0, w = 1;\n\tregister char ch = 0;\n\twhile (!isdigit(ch) && ch != '-') ch = getchar(); \n\tif (ch == '-') w = -1, ch = getchar();\n\twhile (isdigit(ch)) data = 10 * data + ch - '0', ch = getchar();\n\treturn w * data; \n}\nconst double PI = acos(-1.0);\nconst int MAX_N = 2000005; \nstruct Complex { double x, y; } a[MAX_N], b[MAX_N]; \ninline Complex operator + (const Complex &l, const Complex &r) { return (Complex){l.x + r.x, l.y + r.y}; }\ninline Complex operator - (const Complex &l, const Complex &r) { return (Complex){l.x - r.x, l.y - r.y}; }\ninline Complex operator * (const Complex &l, const Complex &r) { return (Complex){l.x * r.x - l.y * r.y, l.y * r.x + l.x * r.y}; } \nint n, m, N, M, s1[MAX_N], s2[MAX_N], r[MAX_N], res[MAX_N]; \nvoid FFT(Complex *p, int op) { \n\tfor (int i = 0; i < N; i++) if (i < r[i]) swap(p[i], p[r[i]]); \n\tfor (int i = 1; i < N; i <<= 1) {\n\t\tComplex rot = (Complex){cos(PI / i), op * sin(PI / i)};\n\t\tfor (int tmp = i << 1, j = 0; j < N; j += tmp) { \n\t\t\tComplex w = (Complex){1, 0}; \n\t\t\tfor (int k = 0; k < i; k++, w = w * rot) { \n\t\t\t\tComplex x = p[j + k], y = w * p[i + j + k]; \n\t\t\t\tp[j + k] = x + y, p[i + j + k] = x - y; \n\t\t\t} \n\t\t} \n\t} \n} \nvoid Prepare () { \n\tN = n - 1, M = n + n - 1; \n\tfor (int i = 0; i <= N; i++) a[i].x = s1[i + 1]; \n\tfor (int i = 0; i < n; i++) b[i].x = s2[n - i]; \n\tfor (int i = 0; i < n; i++) b[i + n] = b[i];\n\tint P = 0; \n\tfor (M += N, N = 1; N <= M; N <<= 1, ++P) ; \n\tfor (int i = 0; i < N; i++) r[i] = (r[i >> 1] >> 1) | ((i & 1) << (P - 1)); \n\tFFT(a, 1), FFT(b, 1); \n\tfor (int i = 0; i < N; i++) a[i] = a[i] * b[i]; \n\tFFT(a, -1); \n\tfor (int i = 0; i <= M; i++) res[i] = (int)(a[i].x / N + 0.5); \n} \nint main () {\n\tn = gi(), m = gi(); \n\tfor (int i = 1; i <= n; i++) s1[i] = gi(); \n\tfor (int i = 1; i <= n; i++) s2[i] = gi(); \n\tPrepare(); \n\tint p1 = 0, p2 = 0, ans = 1e9, tmp1 = 0, tmp2 = 0, tt = -1e9;\n\tfor (int i = 1; i <= n; i++) p1 += s1[i] * s1[i], p2 += s2[i] * s2[i], tmp1 += s1[i], tmp2 += s2[i]; \n\tfor (int i = n - 1; i < n + n; i++) tt = max(tt, res[i]); \n\tfor (int C = -m; C <= m; C++) {\n\t\tint tot = p1 + p2 + n * C * C + 2 * C * (tmp1 - tmp2) - 2 * tt; \n\t\tans = min(tot, ans); \n\t} \n\tprintf(\"%d\\n\", ans); \n\treturn 0; \n} \n```",
        "postTime": 1550386228,
        "uid": 42506,
        "name": "\u4f55\u4fde\u5747",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3723 \u3010[AH2017/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "http://www.cnblogs.com/D-O-Time/p/7954847.html\n\n\u56e0\u4e3a\u53ef\u4ee5\u52a0\u4e0a\u4e00\u4e2a\u5e38\u6570C\uff0c\u8bf4\u662f\u975e\u8d1f\u6574\u6570\uff0c\u4f46\u5176\u5b9eA\u624b\u73af\u52a0\u4e0a\uff0c\u5c31\u7b49\u4e8eB\u624b\u73af\u51cf\u53bb\uff0c\u4e8e\u662f\u628am\u8303\u56f4\u6269\u5145\u5230[-100,100]\u5373\u53ef\u3002\n\n\n\u7136\u540e\u6240\u6c42\u53d8\u4e3a\uff1a\n\n\n$$\\sum (x_i-y_i+C)$$\n\n\n\u63a5\u7740\u62c6\u5f00\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n\n$$\\sum(x_i^2+y_i^2+C^2)+2*C*\\sum(x_i-y_i)+2*\\sum(x_i*y_i)$$\n\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u4e9b\u6709\u5e38\u91cf\uff0c\u53ef\u53d8\u7684C\u6240\u5bf9\u5e94\u7684x\u548cy\u662f\u5e38\u6570\uff0c\u800c\u4e0e\u987a\u5e8f\u6709\u5173\u7684xi\\*yi\u53c8\u662f\u4e0eC\u65e0\u5173\u7684\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u6c42\u51fa\u7684\u6700\u5927\u503cxi\\*yi\u3002\u5982\u679c\u6211\u4eec\u5c06B\u624b\u73af\u5728\u8f93\u5165\u4e4b\u540e\u53cd\u8f6c\u4e00\u4e0b\uff0c\u53ef\u4ee5\u53d1\u73b0\u5f53\u7ffb\u8f6c\u524dA\u4e0eB\u53d1\u751f\u9519\u4f4d\u4e4b\u65f6\uff0c\u6bcf\u4e00\u4e2a\u9519\u4f4d\u90fd\u53ef\u4ee5\u5bf9\u5e94\u53cd\u8f6c\u4e4b\u540e\u7684B\u4e0eA\u7684FFT\u7684\u4e58\u79ef\u7684\u5404\u4e2a\u9879\u7684\u7cfb\u6570\u3002\n\n\n\u7136\u540e\u518d\u679a\u4e3eC\u4ece[-m,m]\u90a3\u4e48\u7b54\u6848\u5c31\u51fa\u6765\u4e86\u3002\n\n\n\u4e0d\u4f1aFFT\u7684\u5c31\u53bb\u5b66\u5427\u3002\n\n\n```cpp\n 1 #include<cmath>\n 2 #include<cstdio>\n 3 #include<complex>\n 4 #include<iostream>\n 5 #include<algorithm>\n 6 #define C complex<double>\n 7 #define pf(a) ((a)*(a))\n 8 using namespace std;\n 9 const int MAXN=1000000,INF=0x3f3f3f3f;\n10 const double pi=acos(-1.0);\n11 int n,m,L,G,Max,Val,ans=INF,sum1,sum2;\n12 int R[MAXN],V[MAXN];\n13 C A[MAXN],B[MAXN];\n14 inline int gi(){int res; scanf(\"%d\",&res); return res;}\n15 void FFT(C *a,int p)\n16 {\n17   for(int i=0;i<n;i++)if(i<R[i])swap(a[i],a[R[i]]);\n18   for(int i=1;i<n;i<<=1)\n19     {\n20       C wn(cos(pi/i),sin(p*pi/i)),x,y;\n21       for(int j=0;j<n;j+=(i<<1))\n22         {\n23           C w(1,0);\n24           for(int k=0;k<i;k++,w*=wn)\n25             {\n26               x=a[j+k],y=w*a[j+k+i];\n27               a[j+k]=x+y;\n28               a[j+k+i]=x-y;\n29             }\n30         }\n31     }\n32 }\n33 int main()\n34 {\n35   freopen(\"gift.in\",\"r\",stdin);\n36   freopen(\"gift.out\",\"w\",stdout);\n37   n=gi();Max=gi(); n--;\n38   for(int i=0;i<=n;i++)A[i]=gi();\n39   for(int i=0;i<=n;i++)B[i]=gi();\n40   for(int i=0;i<=n;i++)\n41     {\n42       sum1+=pf(A[i].real())+pf(B[i].real());\n43       sum2+=A[i].real()-B[i].real();\n44     }\n45   m=n+n; reverse(B,B+n+1);\n46   for(n=1;n<=m;n<<=1)L++;L--;\n47   for(int i=0;i<n;i++)R[i]=(R[i>>1]>>1)|((i&1)<<L);\n48   FFT(A,1); FFT(B,1);\n49   for(int i=0;i<=n;i++)A[i]*=B[i];\n50   FFT(A,-1);\n51   for(int i=0;i<=m;i++)V[i]=(int)(A[i].real()/n+0.5);\n52   n=m/2; Val=V[n];\n53   for(int i=0;i<=n-1;i++)\n54     if(Val<V[i]+V[n+i+1])\n55       Val=V[i]+V[n+i+1];\n56   Val*=2;\n57   for(int c=-Max;c<=Max;c++)\n58     ans=min(ans,sum2*2*c+(n+1)*c*c-Val);\n59   printf(\"%d\\n\",ans+sum1);\n60   return 0;\n61 }\n```",
        "postTime": 1512213033,
        "uid": 38711,
        "name": "DOTime",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3723 \u3010[AH/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u53ef\u4ee5\u60f3\u5230\uff0c\u5148\u65cb\u8f6c\u5230\u6700\u4f18\u65b9\u6848\uff0c\u518d\u679a\u4e3e\u4eae\u5ea6\u3002\n\n\u800c\u5173\u952e\u5728\u4e8e\u600e\u6837\u6c42\u65cb\u8f6c\u5230\u7684\u6700\u4f18\u65b9\u6848\u3002\n\n\u628a\u5dee\u5f02\u503c\u7684\u5f0f\u5b50\u5c55\u5f00\u5f97\u5230\uff1a\n\n$\\sum_{i=1}^n(x_i-y_i)^2=\\sum_{i=1}^n(x_i^2+y_i^2)-2\\sum_{i=1}^nx_iy_i$\u3002\n\n\u6240\u4ee5\u76ee\u6807\u5c31\u662f\u8ba9$\\sum_{i=1}^nx_iy_i$\u6700\u5927\u3002\n\n\u6b64\u65f6\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u65cb\u8f6c\u7b2c\u4e00\u4e2a\u73af\u4e4b\u540e\u7b2c\u4e00\u4e2a\u73af\u7684\u7b2c$1$\u4e2a\u662f\u539f\u6765\u7b2c\u4e00\u4e2a\u73af\u7684\u7b2c$k$\u4e2a\uff0c\u90a3\u4e48\u5bb9\u6613\u5f97\u51fa\u6b64\u65f6\u7684\u5dee\u5f02\u503c\u4e3a\uff1a\n\n$\\sum_{i=1}^{n-k+1}x_{k+i-1}y_i+\\sum_{i=1}^{k-1}x_iy_{n-k+i+1}$\u3002\n\n\u5982\u679c\u5206\u522b\u628a\u7b2c\u4e00\u4e2a\u73af\u548c\u7b2c\u4e8c\u4e2a\u73af\u7ffb\u8f6c\uff0c\u5e76\u628a\u73af\u770b\u4f5c\u591a\u9879\u5f0f\uff0c\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0$\\sum_{i=1}^{n-k+1}x_{k+i-1}y_i$\u548c$\\sum_{i=1}^{k-1}x_iy_{n-k+i+1}$\u90fd\u662f\u4e24\u4e2a\u591a\u9879\u5f0f\u7684\u4e58\u79ef\u4e2d\u4e00\u4e2a\u7cfb\u6570\u7684\u503c\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u505a\u4e24\u904dFFT\u6c42\u51fa\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#include <bits/stdc++.h> \nusing namespace std;\ninline int read() {\n    int res = 0; bool bo = 0; char c;\n    while (((c = getchar()) < '0' || c > '9') && c != '-');\n    if (c == '-') bo = 1; else res = c - 48;\n    while ((c = getchar()) >= '0' && c <= '9')\n        res = (res << 3) + (res << 1) + (c - 48);\n    return bo ? ~res + 1 : res;\n}\ntypedef complex<double> cyx;\nconst int N = 2e5 + 5, INF = 0x3f3f3f3f; const double pi = acos(-1.0);\nint n, m, a[N], b[N], rev[N], lef[N], rig[N], ff, tmp[N];\ncyx A[N], B[N];\nvoid FFT(int n, cyx *y, int op) {\n    int i, j, k;\n    for (i = 0; i < n; i++) if (i < rev[i]) swap(y[i], y[rev[i]]);\n    for (k = 1; k < n; k <<= 1) {\n        cyx x(cos(pi / k), op * sin(pi / k));\n        for (i = 0; i < n; i += (k << 1)) {\n            cyx w(1, 0);\n            for (j = 0; j < k; j++) {\n                cyx u = y[i + j], v = w * y[i + j + k];\n                y[i + j] = u + v; y[i + j + k] = u - v;\n                w = w * x;\n            }\n        }\n    }\n}\nvoid solve() {\n    int i, tot = 0; ff = 1;\n    while (ff <= (n << 1) - 2) ff <<= 1, tot++;\n    memset(rev, 0, sizeof(rev));\n    for (i = 0; i <= ff; i++)\n        rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << tot - 1);\n    FFT(ff, A, 1); FFT(ff, B, 1); for (i = 0; i <= ff; i++)\n        A[i] = A[i] * B[i]; FFT(ff, A, -1);\n}\nint main() {\n    int i, sum = 0, pos = 0, now = INF, ans = INF, sm = 0;\n    n = read(); m = read(); for (i = 1; i <= n; i++) a[i] = read(),\n    sum += a[i] * a[i]; for (i = 1; i <= n; i++) b[i] = read(),\n    sum += b[i] * b[i]; for (i = 0; i < n; i++) A[i] = a[n - i],\n    B[i] = b[i + 1]; solve(); for (i = 1; i <= n; i++)\n        rig[i] = ((int) (A[n - i].real() / ff + 0.5));\n    for (i = 0; i <= ff; i++) A[i] = B[i] = 0;\n    for (i = 0; i < n; i++) A[i] = a[i + 1], B[i] = b[n - i];\n    solve(); for (i = 1; i <= n; i++)\n        lef[i] = ((int) (A[i - 1].real() / ff + 0.5));\n    for (i = 1; i <= n; i++) {\n        int x = sum - (lef[i - 1] + rig[i] << 1);\n        if (x < now) now = x, pos = i;\n    }\n    if (pos > 1) {\n        for (i = pos; i <= n; i++) tmp[i] = a[i];\n        for (i = n; i >= n - pos + 2; i--) a[i] = a[i - n + pos - 1];\n        for (i = pos; i <= n; i++) a[i - pos + 1] = tmp[i];\n    }\n    for (i = 1; i <= n; i++) sm += a[i] - b[i];\n    for (i = -100; i <= 100; i++)\n        ans = min(ans, now + n * i * i + 2 * sm * i);\n    printf(\"%d\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1508641135,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3723 \u3010[AH/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "From:DZYO\u7684\u535a\u5ba2<http://blog.csdn.net/qq\\_35649707/article/details/78076863>\n\n\n\u9898\u610f:\n\n\u7ed9\u4e24\u4e2a\u5e8f\u5217$a_i,b_i$,\u53ef\u4ee5\u5bf9b\u5e8f\u5217\u8fdb\u884c\u53f3\u79fb\u6216\u8005\u6574\u4f53\u52a0\u51cf$c$,\u6700\u5c0f\u5316$$\\sum_i(x_i-y_i-c_i)^2$$.\n\n\n\u9898\u89e3:\n\n\u6807\u51c6FFT\u88f8\u9898,\u771f\u4e0d\u6562\u76f8\u4fe1\u8fd9\u662fT3\u7684\u9898..\n\n\n\u9996\u5148\u5bf9\u539f\u5f0f\u5c55\u5f00,\u5f97:\n\n$$\\sum\\_i x\\_i^2+\n\n\\sum\\_iy\\_i^2+n\\*c^2-2\\*c(x\\_i-y\\_i)-\\sum\\_i2x\\_iy\\_i$$\n\n\n\u7136\u540e\u6709\u4e00\u5806\u5e38\u6570,\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42$2x_iy_i$\u6700\u5c0f,\u628a$y$\u6570\u7ec4\u53cd\u8fc7\u6765,\u76f4\u63a5FFT\u5373\u53ef.\n\n\u6700\u540e\u76f4\u63a5\u4e8c\u6b21\u51fd\u6570\u6700\u5c0f\u503c.\u6ce8\u610f\u6709\u4e00\u70b9\u5751\u7684\u662f\u8fd9\u4e2a\u6781\u503c\u4e0d\u4e00\u5b9a\u5728\u6574\u6570\u57df\u53d6\u5f97,\u6240\u4ee5\u8981\u53d6\u76f8\u90bb\u4e24\u4e09\u4e2a\u70b9\u7b97\u4e00\u7b97\u53d6\u6700\u5c0f\u503c.\n\nCode:http://paste.ubuntu.com/25605289/\n\n",
        "postTime": 1506236042,
        "uid": 49483,
        "name": "DZYO",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3723 \u3010[AH/HNOI2017]\u793c\u7269\u3011"
    },
    {
        "content": "\u6211\u7684\u9898\u89e3\uff1a\n\n\n1.\u9996\u5148\u8fd9\u4e2a\u9898\u80af\u5b9a\u8981\u5377\u79ef\uff0c\u56e0\u4e3a\u5f88\u88f8\u7684\u591a\u9879\u5f0f\u4e58\u6cd5\n\n\n2.\u7136\u540e\u5c31\u662f\u63a8\u63a8\u516c\u5f0f\uff0c\u56e0\u4e3a\u6709n\u79cd\u5bf9\u4f4d\u65b9\u5f0f\uff0c\u6240\u4ee5\u80af\u5b9a\u5c11\u4e0d\u4e86n\u7684\u679a\u4e3e\n\n\n3.\u5c31\u662f\u5728\u628a\u516c\u5f0f\u5c55\u5f00\u540e\uff0c\u4f1a\u53d1\u73b0\u6709\u51e0\u9879\u548c\u9898\u76ee\u4e2d\u7684c\u6ca1\u6709\u5173\u7cfb\uff0c\u7136\u540e\u76f4\u63a5\u5bf9c\u679a\u4e3e\uff0c\u53ef\u4ee5\u627e\u5230\u6700\u5408\u9002\u7684c\n\n\n4.\u7136\u540e\u5377\u79ef\u5c31FFT\u641e\u641e\n\n![](https://latex.codecogs.com/gif.latex?%5Csum\\_%7Bi%3D1%7D%5E%7Bn%7D%28X\\_%7Bi%7D-Y\\_%7Bi&plus;x%7D%29%5E2);\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\n#include <iostream> \n#include <complex>\n#define pi 3.14159265358979\n#define INF 2147483647\n#define CD complex<double>\nusing namespace std;\n\nint sa,m,s,bit,mini,suma,sumb,rev[500100];\nCD a[500010],b[500010];\n\nint read(){\n    int rtn=0;char ch=getchar();\n    while(!isdigit(ch))ch=getchar();\n    while(isdigit(ch))rtn=rtn*10+ch-'0',ch=getchar();\n    return rtn;\n}\n\nvoid get_rev(){\n     for(int i=0;i<(1<<bit);i++)\n         rev[i]=(rev[i>>1]>>1)|((i&1)<<(bit-1));\n}\n\nvoid FFT(CD *A,int n,int dft){\n    for(int i=0;i<n;i++)if(i<rev[i])swap(A[i],A[rev[i]]);\n    for(int step=1;step<n;step<<=1){\n        CD dx=exp(CD(0,dft*pi/step));\n        for(int j=0;j<n;j+=step<<1){\n            CD x(1,0);\n            for(int k=j;k<j+step;k++){\n                CD p1=A[k];\n                CD p2=x*A[k+step];\n                A[k]=p1+p2;\n                A[k+step]=p1-p2;\n                x*=dx;\n            }\n        }\n    }\n    if(dft==-1)for(int i=0;i<n;i++)A[i]/=n;\n}\n\nint main()\n{\n    scanf(\"%d%d\",&sa,&m);\n    for(int i=0;i<sa;i++)a[i]=read(),suma+=a[i].real()*a[i].real(),sumb+=a[i].real();\n    for(int i=0;i<sa;i++)b[sa-i-1]=read(),suma+=b[sa-i-1].real()*b[sa-i-1].real(),sumb-=b[sa-i-1].real();\n    s=2,bit=1;\n    while(s<2*sa-1)s<<=1,bit++;\n    get_rev();\n    FFT(a,s,1);\n    FFT(b,s,1);\n    for(int i=0;i<s;i++)a[i]*=b[i];\n    FFT(a,s,-1);\n    for(int i=0;i<sa-1;i++)a[i]+=a[i+sa];\n    int compare=INF,ans=INF;\n    for(int i=-m;i<=m;i++)\n        if(suma+sumb*2*i+i*i*sa<compare)compare=suma+sumb*2*i+i*i*sa;\n    for(int i=0;i<sa;i++){\n        ans=min(ans,compare-2*((int)(a[i].real()+0.5)));\n    }\n    printf(\"%d\",ans);\n    return 0;\n}\n```",
        "postTime": 1504936483,
        "uid": 29379,
        "name": "Tyw_ei",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3723 \u3010[AH/HNOI2017]\u793c\u7269\u3011"
    }
]