[
    {
        "content": "\u8fd9\u9053\u9898\u53ef\u4ee5\u5206\u6210\u4e24\u90e8\u5206\u3002\n\n1. \u7f29\u6811\u3002\n2. \u6811\u540c\u6784\u3002\n\n\u7b2c\u4e00\u6b65\u76f4\u63a5\u5728\u539f\u6811\u4e0a\u91cd\u65b0\u5efa\u6811\u5373\u53ef\uff0c\u5173\u952e\u5728\u4e8e\u7b2c\u4e8c\u6b65\u3002\n\n\u8fd9\u91cc\u7684\u4e3b\u8981\u95ee\u9898\u5728\u4e8e\u5bf9\u65e0\u6839\u6811\u5224\u540c\u6784\u5f88\u9ebb\u70e6\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u76f4\u63a5\u5c06\u65e0\u6839\u6811\u8f6c\u6362\u6210\u6709\u6839\u6811\u3002\n\n\u81f3\u4e8e\u9009\u4ec0\u4e48\u70b9\u505a\u6839\uff0c \u8fd9\u4e2a\u5c31\u5f88\u660e\u663e\u4e86\uff1a\u91cd\u5fc3\u3002\n\n\u552f\u4e00\u7684\u95ee\u9898\u5728\u4e8e\u4e00\u68f5\u6811\u7684\u91cd\u5fc3\u53ef\u80fd\u6709\u4e24\u4e2a\u3002\u4e0d\u8fc7\u8fd9\u4e24\u4e2a\u91cd\u5fc3\u80af\u5b9a\u662f\u76f4\u63a5\u76f8\u8fde\u7684\uff0c\u6211\u4eec\u628a\u76f8\u8fde\u7684\u8fb9\u65ad\u5f00\u770b\u505a\u4e24\u68f5\u6811\u5373\u53ef\u3002\n\n\u7136\u540e\u8dd1\u4f60\u6700\u559c\u6b22\u7684\u6709\u6839\u6811\u54c8\u5e0c\u7b97\u6cd5\u5c31\u53ef\u4ee5\u4e86\u3002\u6211\u8fd9\u91cc\u9009\u62e9\u7684\u54c8\u5e0c\u503c\u8ba1\u7b97\u65b9\u6cd5\u662f:\n\n$$Hash[u]=\\oplus(Hash[v]-W[u])*W[v]$$\n\n\u5176\u4e2d $W[u]$ \u662f\u968f\u673a\u51fa\u6765\u7684\u67d0\u79cd\u7cfb\u6570\u3002\n\n\u4ee3\u7801:\n```cpp\n#include<bits/stdc++.h>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mp make_pair\nusing namespace std;\n\ninline void Chkmax(int&u,int v){u<v?u=v:0;}\n\nconst int MAXN = 1e4 + 7;\n\nvector <int> ed[MAXN];\n\nset < pair<int, unsigned long long> > G;\n\nstatic int rt1, rt2, d[MAXN];\n\nstatic int sz[MAXN], F[MAXN];\n\nstatic unsigned long long w[MAXN];\n\nvoid getcentr(int u, int fa, int al)\n{\n\tsz[u] = 1, F[u] = 0;\n\tfor(int v : ed[u]) if(v ^ fa) getcentr(v, u, al), Chkmax(F[u], sz[v]), sz[u] += sz[v];\n\tChkmax(F[u], al - sz[u]);\n\tif(!rt1 || F[u] < F[rt1]) rt1 = u, rt2 = fa;\n}\n\nstatic unsigned long long hs[MAXN];\n\nvoid geths(int u, int fa)\n{\n\tsz[u] = 1;\n\ths[u] = 0;\n\tfor(int v : ed[u]) if(v ^ fa) geths(v, u), sz[u] += sz[v];\n\tfor(int v : ed[u]) if(v ^ fa)\n\t\ths[u] ^= (hs[v] - w[sz[u]]) * w[sz[v]];\n\ths[u] ^= w[sz[u]];\n}\n\ninline unsigned long long calc(int n, int zz)\n{\n\trt1 = rt2 = 0;\n\tRep(i, 1, n) if(d[i] == 1) {getcentr(i, 0, zz); break;}\n\t//cerr << rt1 << ' ' << rt2 <<endl;\n\tif(F[rt1] == F[rt2])\n\t{\n\t\tgeths(rt1, rt2), geths(rt2, rt1);\n\t\treturn hs[rt1] ^ hs[rt2];\n\t}\n\tgeths(rt1, 0);\n\treturn hs[rt1];\n}\n\nstatic vector <int> us[MAXN];\n\nstatic pair <int, int> cn[MAXN];\n\nvoid shrink(int u, int fa, int tf, int & n)\n{\n\tif(d[u] == 2) {for(int v : us[u]) if(v ^ fa) shrink(v, u, tf, -- n);}\n\telse\n\t{\n\t\tif(tf) ed[u].pb(tf), ed[tf].pb(u);\n\t\tfor(int v : us[u]) if(v ^ fa) shrink(v, u, u, n);\n\t}\n}\n\n#define read(x) cin>>x\n\ninline void init()\n{\n\tstatic int n, m, u, v;\n\tsrand(time(NULL));\n\tRep(i, 1, 10000) w[i] = rand() | (unsigned long long)rand() << 30;\n\tread(m);\n\tRep(i, 1, m)\n\t{\n\t\tread(n);\n\t\tRep(i, 1, n) us[i].resize(0), ed[i].resize(0), d[i] = 0;\n\t\tRep(i, 1, n - 1) read(u), read(v), ++ d[u], ++ d[v], us[u].pb(v), us[v].pb(u);\n\t\tint s = n;\n\t\tRep(i, 1, n) if(d[i] == 1) {shrink(i, 0, 0, s); break;}\n\t\tG.insert(mp(s, calc(n, s)));\n\t}\n}\n\ninline void solve()\n{\n\tcout << G.size() << endl;\n\tfor(auto z : G) printf(\"%d \", z.first);\n\tputs(\"\");\n}\n\nint main()\n{\n\tinit();\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1581431486,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6084 \u3010[JSOI2015]isomorphism\u3011"
    }
]