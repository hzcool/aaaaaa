[
    {
        "content": "\u5982\u679c\u4e0d\u8003\u8651\u5220\u70b9\u6c42\u94fe\u6570\uff0c\u6211\u4eec\u663e\u7136\u6709\u4e00\u4e2a\u5f88\u7b80\u5355\u7684 $\\mathbf O(n)$ DAG \u62d3\u6251\u5e8f\u4e0a dp\u3002\u8bbe $f_i$ \u8868\u793a\u4ece\u5165\u5ea6\u4e3a $0$ \u7684\u70b9\u5230 $i$ \u7684\u65b9\u6848\u6570\uff0c\u6709 $\\forall (u,v),f_v\\leftarrow f_u$\u3002\u6700\u7ec8\u7b54\u6848\u5373\u4e3a\u6240\u6709\u51fa\u5ea6\u4e3a $0$ \u7684\u70b9\u7684 $f$ \u4e4b\u548c\u3002  \n\n\u73b0\u5728\u8003\u8651\u5220\u4e00\u4e2a\u70b9 $x$ \u7684\u60c5\u51b5\uff0c\u5bb9\u6613\u60f3\u5230\u518d\u8bbe\u4e00\u4e2a $g_i$ \u8868\u793a\u4ece\u51fa\u5ea6\u4e3a $0$ \u7684\u70b9\u5230 $i$ \u7684\u65b9\u6848\u6570\uff0c\u6700\u540e\u603b\u7b54\u6848\u51cf\u53bb $f_xg_x$\u3002  \n\n\u8003\u8651\u5220\u591a\u4e2a\u70b9\uff0c\u7531\u4e8e\u672c\u9898 $n,k$ \u5f88\u5c0f\uff0c\u8003\u8651\u5bb9\u65a5\u3002\u663e\u7136\u76f4\u63a5\u51cf $k$ \u6b21 $f_xg_x$ \u4f1a\u7b97\u91cd\uff0c\u4e8e\u662f\u6211\u4eec\u518d\u6c42\u4e00\u4e2a\u4e24\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u6570 $h_{x,y}$\u3002\u5c06\u6240\u6709\u62d3\u6251\u5e8f\u6bd4 $x$ \u5927\u7684\u6240\u6709 $y$ \u7684 $f_y$ \u51cf $f_xh_{x,y}$\uff0c\u7136\u540e\u518d\u4e58 $g_x$\uff0c\u518d\u4ece\u603b\u7b54\u6848\u4e2d\u51cf\u6389\u3002\n\n\u590d\u6742\u5ea6 $\\mathbf O(nm+k\\sum k)$\u3002  \n\n```cpp\n#include<cstdio>\n#include<algorithm>\nconst int N=2010,M=20010,p=1e9+7;\nint n,m,qt,las[N],nxt[M],to[M],cnt,du[N],c[N],d[N],f[N],g[N],h[N][N],q[N],id[N],sum,ans;\ninline void add(int u,int v){++cnt;to[cnt]=v;nxt[cnt]=las[u];las[u]=cnt;++du[v];}\nbool cmp(const int &x,const int &y){return id[x]<id[y];}\nint main()\n{\n\tint i,j,k,x,y,hd,tl=0;scanf(\"%d%d\",&n,&m);\n\tfor(i=1;i<=m;i++)scanf(\"%d%d\",&x,&y),add(x,y);\n\tfor(i=1;i<=n;i++)if(!du[i])f[q[++tl]=i]=1;\n\tfor(hd=1;hd<=tl;++hd)for(i=las[q[hd]];i;i=nxt[i]){f[to[i]]=(f[to[i]]+f[q[hd]])%p;if(!--du[to[i]])q[++tl]=to[i];}\n\tfor(hd=tl;hd>=1;--hd)if(las[q[hd]])for(i=las[q[hd]];i;i=nxt[i])g[q[hd]]=(g[q[hd]]+g[to[i]])%p;else g[q[hd]]=1,sum=(sum+f[q[hd]])%p;\n\tfor(i=1;i<=n;i++)\n\t{\n\t\th[q[i]][q[i]]=1;id[q[i]]=i;\n\t\tfor(j=i;j<=n;j++)for(k=las[q[j]];k;k=nxt[k])h[q[i]][to[k]]=(h[q[i]][to[k]]+h[q[i]][q[j]])%p;\n\t}\n\tscanf(\"%d\",&qt);\n\twhile(qt--)\n\t{\n\t\tscanf(\"%d\",&m);ans=sum;\n\t\tfor(i=1;i<=m;i++)scanf(\"%d\",&c[i]);\n\t\tstd::sort(c+1,c+1+m,cmp);\n\t\tfor(i=1;i<=m;i++)d[i]=f[c[i]];\n\t\tfor(i=1;i<=m;i++)for(j=i+1;j<=m;j++)d[j]=(d[j]-1ll*d[i]*h[c[i]][c[j]]%p+p)%p;\n\t\tfor(i=1;i<=m;i++)ans=(ans-1ll*d[i]*g[c[i]]%p+p)%p;\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1624096254,
        "uid": 35137,
        "name": "a___",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6651 \u300cSWTR-05\u300dChain"
    },
    {
        "content": "\u5bf9\u4e8e\u4e00\u4e2a\u6709\u5411\u65e0\u73af\u56fe\uff0c\u9996\u5148\u60f3\u5230\u7684\u5c31\u662f\u8fdb\u884c\u62d3\u6251\u6392\u5e8f\u3002\u6392\u5e8f\u7684\u540c\u65f6\uff0c\u53ef\u4ee5\u5c06\u4e24\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u6570\u9884\u5904\u7406\u51fa\u6765\uff0c\u5e76\u5728\u8fd9\u4e4b\u524d\uff0c\u628a\u6240\u6709\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\u653e\u5165\u96c6\u5408 ```S```\uff0c\u51fa\u5ea6\u4e3a\u96f6\u7684\u70b9\u653e\u5230\u96c6\u5408 ```T```\uff0c\u6700\u5f00\u59cb\u7684\u7b54\u6848\u8bb0\u4e3a ```sum```\u3002\u4e3a\u4e86\u67e5\u8be2\u65b9\u4fbf\uff0c\u540c\u65f6\u8bb0\u5f55 ```onto[x]``` \u4e3a\u6240\u6709\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\u5230 x \u7684\u8def\u5f84\u603b\u6570\uff0c```znto[x]``` \u4e3a x \u5230\u6240\u6709\u51fa\u5ea6\u4e3a\u96f6\u7684\u70b9\u7684\u8def\u5f84\u603b\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\nfor(i=1;i<=m;++i){x=read();lk[x].push_back(y=read());++deg[y];}\nfor(x=1;x<=n;++x){if(deg[x]==0)S.push_back(x);if(lk[x].empty())T.push_back(x);}\nqueue<int>bfs;Ssize=S.size();Tsize=T.size();\nfor(i=0;i<Ssize;++i)bfs.push(S[i]);\nwhile(!bfs.empty()){\n\tx=bfs.front();bfs.pop();siz=lk[x].size();\n\tRT[Topo[x]=++Top]=x;Got[x][x]=1;\n\tfor(i=0;i<siz;++i){\n\t\tif(--deg[lk[x][i]]==0)bfs.push(lk[x][i]);\n\t\tfor(ai=1;ai<=n;++ai)(Got[ai][lk[x][i]]+=Got[ai][x])%=M;\n\t}\n}\nfor(ai=0;ai<Ssize;++ai)\n\tfor(i=0;i<Tsize;++i)\n\t\tsum=(sum+Got[S[ai]][T[i]])%M;\nfor(ai=0;ai<Ssize;++ai)\n\tfor(i=1;i<=n;++i)\n\t\t(onto[i]+=Got[S[ai]][i])%=M;\nfor(ai=0;ai<Tsize;++ai)\n\tfor(i=1;i<=n;++i)\n\t\t(znto[i]+=Got[i][T[ai]])%=M;\n```\n\u5bb9\u6613\u53d1\u73b0\u4e0a\u9762\u7684\u505a\u6cd5\u662f $O(n^2)$\uff0c\u56e0\u6b64\u4e0d\u4f1a\u8d85\u65f6\u3002\n\u63a5\u4e0b\u6765\u662f\u4e00\u4e2a\u9012\u63a8\u7684\u8fc7\u7a0b\uff0c\u8bb0 ```ans[x]``` \u4e3a\u4ece\u6240\u6709\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\u5230 x \u7684**\u6709\u6548**\u8def\u5f84\u603b\u6570\uff0c\u8fd9\u91cc\u7684**\u6709\u6548**\u6307\u7684\u662f\u6ca1\u6709\u7ecf\u8fc7\u4efb\u4f55\u4e00\u4e2a\u88ab\u5220\u9664\u7684\u70b9\u7684\u8def\u5f84\u603b\u6570\u3002\n\u4e8e\u662f\uff0c$ans[x]=onto[x]-Got[x][y]\\times\\sum\\limits_{y \\in Delt\\bigwedge y\\neq x}^nans[y]$ \u56e0\u4e3a\u4efb\u610f\u65e0\u6548\u8def\u5f84\u5df2\u7ecf\u4ece ```ans``` \u6570\u7ec4\u4e2d\u53bb\u9664\u6240\u4ee5\u4e0d\u4f1a\u7edf\u8ba1\u4e24\u904d\u3002\u6ce8\u610f x \u5230 y \u6709\u8def\u5f84\u7684\u5fc5\u8981\u6761\u4ef6\u662f x \u7684\u62d3\u6251\u5e8f\u6bd4 y \u66f4\u9760\u524d\uff0c\u4e8e\u662f\u53ef\u4ee5\u5c06\u8be2\u95ee\u5148\u6309\u62d3\u6251\u5e8f\u8fdb\u884c\u6392\u5e8f\u7136\u540e\u6bcf\u6b21\u5faa\u73af\u53ea\u9700\u8003\u8651\u62d3\u6251\u5e8f\u6bd4\u5f53\u524d\u70b9\u66f4\u9760\u524d\u7684\u70b9\u3002\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e3+3,M=1e9+7;\nchar buf[1<<23],*p1,*p2,c;\nint an,f,Ssize,Tsize;\n#define gc (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<22,stdin),p1==p2))?EOF:*p1++\ninline int read(){\n\tan=0;f=1;while(!isdigit(c=gc))if(c=='-')f=-f;\n\tdo an=an*10+c-'0';while(isdigit(c=gc));return an*f;\n}\nll Got[N][N],onto[N],znto[N],sum,nsum,ans[N];\nint Topo[N],Top,n,m,ask[40],k,deg[N],now,fdeg[N],q,RT[N];\ninline bool cmp(const int &a,const int &b){\n\treturn Topo[a]<Topo[b];\n}\nvector<int>lk[N],S,T;\nint main(){\n\tn=read();m=read();int i,x,y,siz,ai;\n\tfor(i=1;i<=m;++i){x=read();lk[x].push_back(y=read());++deg[y];}\n\tfor(x=1;x<=n;++x){if(deg[x]==0)S.push_back(x);if(lk[x].empty())T.push_back(x);}\n\tqueue<int>bfs;Ssize=S.size();Tsize=T.size();\n\tfor(i=0;i<Ssize;++i)bfs.push(S[i]);\n\twhile(!bfs.empty()){\n\t\tx=bfs.front();bfs.pop();siz=lk[x].size();\n\t\tRT[Topo[x]=++Top]=x;Got[x][x]=1;\n\t\tfor(i=0;i<siz;++i){\n\t\t\tif(--deg[lk[x][i]]==0)bfs.push(lk[x][i]);\n\t\t\tfor(ai=1;ai<=n;++ai)(Got[ai][lk[x][i]]+=Got[ai][x])%=M;\n\t\t}\n\t}\n\tfor(ai=0;ai<Ssize;++ai)\n\t\tfor(i=0;i<Tsize;++i)\n\t\t\tsum=(sum+Got[S[ai]][T[i]])%M;\n\tfor(ai=0;ai<Ssize;++ai)\n\t\tfor(i=1;i<=n;++i)\n\t\t\t(onto[i]+=Got[S[ai]][i])%=M;\n\tfor(ai=0;ai<Tsize;++ai)\n\t\tfor(i=1;i<=n;++i)\n\t\t\t(znto[i]+=Got[i][T[ai]])%=M;\n\tq=read();\n\twhile(q--){\n\t\tfor(ai=1,k=read();ai<=k;++ai)ask[ai]=read(),ans[ai]=0;\n\t\tsort(ask+1,ask+k+1,cmp);nsum=sum;\n\t\tfor(ai=1;ai<=k;++ai){\n\t\t\tans[ai]=onto[ask[ai]];\n\t\t\tfor(i=1;i<ai;++i)\n\t\t\t\t(ans[ai]-=ans[i]*Got[ask[i]][ask[ai]])%=M;\n\t\t\t(nsum-=ans[ai]*znto[ask[ai]])%=M;\n\t\t}\n\t\tnsum=(nsum+M)%M;\n\t\tprintf(\"%lld\\n\",nsum);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1634123973,
        "uid": 502410,
        "name": "EnofTaiPeople",
        "ccfLevel": 0,
        "title": "P6651\u9898\u89e3"
    },
    {
        "content": "### Description\n\n\u7ed9\u5b9a\u4e00\u4e2a DAG\uff0c\u6bcf\u6b21\u8be2\u95ee\u5982\u679c\u5220\u9664 $k\\leq 15$ \u4e2a\u70b9\uff0c\u8fd8\u5269\u4e0b\u591a\u5c11\u6761\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\u5230\u51fa\u5ea6\u4e3a\u96f6\u7684\u70b9\u7684\u8def\u5f84\u3002\u65b0\u589e\u7684\u8def\u5f84\u4e0d\u53c2\u4e0e\u7edf\u8ba1\u3002\n\n### Solution\n\n\u552f\u4e00\u53ef\u505a\u9898\uff0c\u5176\u4ed6\u7684\u90fd\u6ca1\u4ec0\u4e48\u601d\u8def/kel\u3002\n\n$k$ \u5f88\u5c0f\uff0c\u5bb9\u6613\u60f3\u5230\u4e00\u4e2a\u679a\u4e3e\u5b50\u96c6\u7684\u505a\u6cd5\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u9884\u5904\u7406\u51fa\u6bcf\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\u53ef\u4ee5\u6309\u62d3\u6251\u5e8f\u5220\u70b9\uff0c\u7136\u540e\u518d\u4e00\u904d\u62d3\u6251\u6c42\u51fa\u6240\u6709\u70b9\u5230\u5f53\u524d\u70b9\u7684\u8ddd\u79bb\u3002\u914d\u5408\u5bb9\u65a5\u53ef\u4ee5\u8fc7\u524d 75%\uff0c\u590d\u6742\u5ea6 $O(nm+q2^k)$\u3002\n\n\u53d1\u73b0\u53ea\u9700\u8981\u77e5\u9053\u6700\u540e\u4e00\u4e2a\u70b9\u662f\u54ea\u4e2a\u70b9\uff0c\u628a\u8fd9 $k$ \u4e2a\u70b9\u6309\u62d3\u6251\u5e8f\u6392\u5e8f\uff0c\u7136\u540e\u8003\u8651 dp\u3002$dp_{i,j}$ \u8868\u793a\u9009\u4e86 $j$ \u4e2a\u70b9\uff0c\u6700\u540e\u4e00\u4e2a\u70b9\u662f\u7b2c $i$ \u4e2a\u7684\u4ece\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\u5230 $i$ \u7684\u8def\u5f84\u6761\u6570\u3002\u90a3\u4e48\u7edf\u8ba1\u7b54\u6848\u5c31\u53ea\u9700\u8981\u4e58\u4e0a $(-1)^j$ \u7684\u5bb9\u65a5\u7cfb\u6570\uff0c\u518d\u4e58\u4e0a\u70b9\u5230\u7ec8\u70b9\u7684\u65b9\u6848\u6570\u3002\u8fd9\u6837\u5355\u6b21\u8be2\u95ee\u5c31\u662f $O(k^3)$\u3002\n\n\u518d\u6b21\u89c2\u5bdf\uff0c\u53d1\u73b0\u5e76\u4e0d\u9700\u8981\u77e5\u9053\u9009\u4e86\u591a\u5c11\u4e2a\uff0c\u53ea\u9700\u8981\u5728\u8f6c\u79fb\u7684\u65f6\u5019\u5bb9\u65a5\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5220\u6389\u4e00\u7ef4\u3002\u5355\u6b21 $O(k^2)$\u3002\n\n```cpp\n#include<stdio.h>\n#include<vector>\n#include<queue>\n#include<algorithm>\nusing namespace std;\n\ninline int read(){\n    int x=0,flag=1; char c=getchar();\n    while(c<'0'||c>'9'){if(c=='-')flag=0;c=getchar();}\n    while(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-48;c=getchar();}\n    return flag? x:-x;\n}\n\nconst int N=2e3+7;\nconst int Mod=1e9+7;\n\nqueue<int> Q;\nvector<int> G[N];\nint dfn[N],in[N],dis[N][N],In[N],a[N],dp[16];\n\ninline bool Cmp(int x,int y){return dfn[x]<dfn[y];}\n\nint main(){\n    freopen(\"foodchain.in\",\"r\",stdin);\n    freopen(\"foodchain.out\",\"w\",stdout);\n    int n=read(),m=read();\n    for(int i=1;i<=m;i++){\n        int u=read(),v=read();\n        G[u].push_back(v),In[v]++;\n    }\n    for(int u=1;u<=n;u++){\n        if(!G[u].size()) G[u].push_back(n+1),In[n+1]++;\n        if(!In[u]) G[0].push_back(u),In[u]++;\n        in[u]=In[u];\n    }\n    Q.push(0); int timer=0;\n    while(!Q.empty()){\n        int u=Q.front(); Q.pop(); dfn[u]=++timer;\n        for(int v:G[u]) if(!(--in[v])) Q.push(v);\n    }\n    for(int i=0;i<=n+1;i++) a[i]=i;\n    sort(a,a+1+n+1,Cmp);\n    for(int i=0;i<=n+1;i++){\n        const int U=a[i];\n        for(int v=0;v<=n+1;v++) in[v]=In[v];\n        dis[U][U]=1;\n        for(int j=i;j<=n+1;j++)\n            if(!in[a[j]]) Q.push(a[j]);\n        while(!Q.empty()){\n            int u=Q.front(); Q.pop();\n            for(int v:G[u]){\n                dis[U][v]=(dis[U][v]+dis[U][u])%Mod;\n                if(!(--in[v])) Q.push(v);\n            }\n        }\n        for(int v:G[U]) --In[v];\n    }\n    int q=read();\n    while(q--){\n        int k=read();\n        for(int i=1;i<=k;i++) a[i]=read();\n        sort(a+1,a+1+k,Cmp);\n        for(int i=1;i<=k;i++)\n            dp[i]=Mod-dis[0][a[i]]; \n        for(int i=1;i<=k;i++)\n        for(int j=1;j<i;j++)\n            dp[i]=(dp[i]-1ll*dp[j]*dis[a[j]][a[i]]%Mod+Mod)%Mod;\n        int ans=dis[0][n+1];\n        for(int i=1;i<=k;i++)\n            ans=(ans+1ll*dp[i]*dis[a[i]][n+1]%Mod)%Mod;\n        printf(\"%d\\n\",ans);\n    }\n}\n```",
        "postTime": 1633944551,
        "uid": 83337,
        "name": "wwlw",
        "ccfLevel": 7,
        "title": "\u300cSWTR-05\u300dChain"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P6651)\n\n\u5220\u53bb\u67d0\u4e9b\u70b9\u540e\u65b0\u4ea7\u751f\u7684\u94fe\u4e0d\u8ba1\u5165\u7b54\u6848\uff0c\u8fd9\u542f\u793a\u6211\u4eec\u53ef\u4ee5\u5148\u6c42\u5220\u70b9\u524d\u94fe\u6570\uff0c\u51cf\u53bb\u7ecf\u8fc7\u5220\u53bb\u70b9\u7684\u94fe\u6570\u5f97\u5230\u6700\u7ec8\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u5220\u70b9\u524d\u94fe\u6570\uff0c\u8bb0 $f_i$ \u4e3a\u4ece\u5165\u5ea6\u4e3a $0$ \u7684\u70b9\u5230\u8282\u70b9 $i$ \u7684\u8def\u5f84\u6570\uff0c$g_i$ \u4e3a\u4ece\u8282\u70b9 $i$ \u5230\u51fa\u5ea6\u4e3a $0$ \u7684\u8282\u70b9\u7684\u8def\u5f84\u6570\uff0c$f$ \u548c $g$ \u6570\u7ec4\u53ef\u4ee5\u5728\u6b63\u56fe\u53cd\u56fe\u4e0a\u5206\u522b\u62d3\u6251\u6392\u5e8f\u5f97\u5230\uff0c\u5219\u5220\u70b9\u524d\u7684\u94fe\u6570\u5c31\u7b49\u4e8e $\\sum_{i}^{out_i=0} f_i$ \n\n\u6709\u4e86 $f$ \u548c $g$ \u6570\u7ec4\uff0c\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u7b97\u51fa\u7ecf\u8fc7\u6bcf\u4e00\u4e2a\u70b9\u7684\u8def\u5f84\u6570\uff0c\u82e5\u76f4\u63a5\u51cf\u53bb\u7ecf\u8fc7\u7ed9\u5b9a\u7684 $k$ \u4e2a\u70b9\u7684\u8def\u5f84\u6570\uff0c\u5fc5\u7136\u4f1a\u7b97\u91cd\uff0c\u8003\u8651\u5982\u4f55\u4e0d\u91cd\u4e0d\u6f0f\u7684\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u4ee5\u4e0b\u79f0\u6bcf\u6b21\u8be2\u95ee\u4e2d\u7ed9\u5b9a\u7684 $k$ \u4e2a\u70b9\u4e3a\u5173\u952e\u70b9\uff0c\u8bb0 $d_{i,j}$ \u4e3a\u7b2c $i$ \u4e2a\u8282\u70b9\u5230\u7b2c $j$ \u4e2a\u70b9\u7684\u8def\u5f84\u6570\uff0c$e$ \u6570\u7ec4\u53ef\u4ee5\u679a\u4e3e\u8d77\u70b9\u62d3\u6251\u6392\u5e8f\u5f97\u5230\u3002\n\n\u4e00\u4e2a\u7ecf\u5178\u7684\u6280\u5de7\u662f\u5728\u6bcf\u6761\u94fe\u7ecf\u8fc7\u7b2c\u4e00\u4e2a\u5173\u952e\u70b9\u65f6\u7edf\u8ba1\u8d21\u732e\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u5173\u952e\u70b9\u6309\u62d3\u6251\u5e8f\u6392\u5e8f\uff0c\u5bf9\u4e8e\u62d3\u6251\u5e8f\u7b2c $i$ \u4e2a\u8282\u70b9\uff0c\u5c06\u7b54\u6848\u51cf\u53bb $f_i\\times g_i$ \u540e\uff0c\u4ece $i+1$ \u626b\u63cf\u5230 $k$\uff0c\u8bb0\u626b\u63cf\u5230\u7b2c $j$ \u4e2a\u8282\u70b9\uff0c\u5c06 $f_j$ \u51cf\u53bb $f_i\\times d_{i,j}$ \uff0c\u6ce8\u610f\u8be2\u95ee\u4e4b\u95f4\u72ec\u7acb\u3002\n\n\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e3+10,M=4e4+10,mod=1e9+7;\ntypedef long long LL;\nstruct edge{\n    int to,nxt;\n}e[M];\nint head[N],hd[N],idx,in[N],out[N];\nint f[N],g[N],d[N][N];\nint n,m,q,ans;\nvoid add(int i,int j,int head[],int in[]){\n    e[++idx].to=j;\n    e[idx].nxt=head[i];\n    head[i]=idx;\n    in[j]++;\n}\nint id[N],tt;\nvoid topsort(int head[],int in[],int f[],int s=0,bool op=0){\n    queue<int>q;\n    if(s) q.push(s),f[s]=1;\n    else for(int i=1;i<=n;i++) if(!in[i]) q.push(i),f[i]=1;\n\twhile(!q.empty()){\n        int x=q.front();\n        q.pop();\n        if(op) id[x]=++tt;\n        for(int i=head[x];i;i=e[i].nxt){\n            if(!--in[e[i].to]) q.push(e[i].to);\n            f[e[i].to]+=f[x];\n            if(f[e[i].to]>mod) f[e[i].to]-=mod;\n        }\n    }\n} \nbool cmp(const int &x,const int &y){\n    return id[x]<id[y];\n}\nint stk[20],val[20];\nbool vis[N];\nvoid bfs(int s,int in[]){\n\tqueue<int>q;\n\tq.push(s);\n\tvis[s]=1;\n\twhile(!q.empty()){\n\t\tint x=q.front();\n\t\tq.pop();\n\t\tfor(int i=head[x];i;i=e[i].nxt) {\n\t\t\t++in[e[i].to];\n\t\t\tif(!vis[e[i].to]) vis[e[i].to]=1,q.push(e[i].to);\n\t\t}\n\t}\n}\nint main()\n{\n    ios::sync_with_stdio(false);\n    cin.tie(0);cout.tie(0);\n    cin>>n>>m;\n    for(int i=1;i<=m;i++){\n        int u,v;\n        cin>>u>>v;\n        add(u,v,head,in);\n        add(v,u,hd,out);\n    }\n    topsort(head,in,f,0,1);\n\tfor(int i=1;i<=n;i++) if(!out[i]) (ans+=f[i])>mod?ans-=mod:0;\n    topsort(hd,out,g);\n    for(int i=1;i<=n;i++) {\n    \tmemset(in,0,sizeof in);\n    \tmemset(vis,0,sizeof vis);\n    \tbfs(i,in);\n\t\ttopsort(head,in,d[i],i);\n\t}\n    cin>>q;\n    for(int i=1;i<=q;i++){\n        int k,res=ans;\n        cin>>k;\n        for(int j=1;j<=k;j++) cin>>stk[j];\n        sort(stk+1,stk+k+1,cmp);\n        for(int j=1;j<=k;j++) val[j]=f[stk[j]];\n        for(int j=1;j<=k;j++){\n            res-=1ll*val[j]*g[stk[j]]%mod;\n\t\t\tif(res<0) res+=mod;\n\t\t\tfor(int g=j+1;g<=k;g++) {\n                val[g]-=1ll*val[j]*d[stk[j]][stk[g]]%mod;\n\t\t\t\tif(val[g]<0) val[g]+=mod;\n            }\n    \t}\t\n    \tcout<<res%mod<<endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1685540193,
        "uid": 803959,
        "name": "gk4000plus",
        "ccfLevel": 0,
        "title": "P6651\u9898\u89e3"
    },
    {
        "content": "### \u9898\u76ee\u63cf\u8ff0\n\u7ed9\u5b9a$n$\u4e2a\u70b9\uff0c$m$\u6761\u8fb9\u7684\u6709\u5411\u65e0\u73af\u56fe\u3002\u4e0d\u4fdd\u8bc1\u56fe\u8054\u901a\u3002\n$q$\u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u51fa$k$\u548c$k$\u4e2a\u4e92\u4e0d\u76f8\u540c\u7684\u6570$c_i$\n \uff0c\u6c42\u51fa\u5982\u679c\u53bb\u6389\u8fd9$k$\u4e2a\u70b9\uff0c\u6574\u4e2a\u6709\u5411\u65e0\u73af\u56fe\u5c06\u5269\u4f59\u591a\u5c11\u6761\u94fe\u3002\u7b54\u6848\u5bf9$10^9+7$\u53d6\u6a21\u3002\u6bcf\u6b21\u8be2\u95ee\u72ec\u7acb\u3002\n\n- \u201c\u94fe\u201d\u7684\u5b9a\u4e49\u662f\uff1a\u6211\u4eec\u8bbe\u4e00\u6761\u957f\u5ea6\u4e3a$p$\u7684\u94fe\u7684\u8def\u5f84\u4e3a$w_0\\to w_1\\to\\cdots\\to w_{p-1}\\to w_p$ \uff0c\u5219\u5e94\u6ee1\u8db3$w_0$\u5165\u5ea6\u4e3a$0$\uff0c$w_p$\u51fa\u5ea6\u4e3a$0$\u3002\u4f60\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u4e00\u6761\u98df\u7269\u94fe\u3002\n\n- \u4e24\u6761\u94fe\u662f\u201c\u4e0d\u540c\u7684\u201d\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u4eec\u7684\u957f\u5ea6\u4e0d\u540c\uff0c\u6216\u8005\u7ecf\u8fc7\u7684\u70b9\u96c6\u4e0d\u540c\u3002\n\n- \u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662f\uff0c\u5220\u53bb\u67d0\u4e9b\u70b9\u540e\u65b0\u4ea7\u751f\u7684\u94fe\u4e0d\u8ba1\u5165\u7b54\u6848\u3002 \u4f8b\u5982$1\\to 2\\to 3\\to 4$\u4e00\u56fe\u4e2d\uff0c\u6709$1$\u6761\u94fe$1\\to 2\\to 3\\to 4$\u3002\u5982\u679c\u53bb\u6389$2$\u53f7\u70b9\uff0c\u5219\u5269\u4f59$0$\u6761\u94fe\u3002\n\n### \u6570\u636e\u8303\u56f4\n\n- Subtask 1\uff081 point\uff09\uff1a\u7ed9\u5b9a\u7684\u56fe\u662f\u4e00\u6761\u94fe\u3002\n- Subtask 2\uff0814 points\uff09\uff1a$n,q\\leq 10$\u3002\n- Subtask 3\uff0820 points\uff09\uff1a$q\\leq 10^3$\u3002\n- Subtask 4\uff0817 points\uff09\uff1a$k=1$\u3002\n- Subtask 5\uff0818 points\uff09\uff1a$k=2$\u3002\n- Subtask 6\uff0830 points\uff09\uff1a\u65e0\u7279\u6b8a\u9650\u5236\u3002\n\n\u5bf9\u4e8e$100\\%$\u7684\u6570\u636e\uff1a$2\\leq n\\leq 2\\times 10^3$\uff0c$1\\leq m\\leq \\min(\\frac{n\\times(n-1)}{2},2\\times 10^4)$\uff0c$1\\leq q\\leq 5\\times 10^5$\n\n\u6240\u6709\u8be2\u95ee\u6ee1\u8db3\uff1a$1\\leq \\sum k\\leq 2\\times 10^6$\uff0c$0\\leq k\\leq \\min(n,15)$\uff0c$1\\leq c_i\\leq n$\u3002\u4fdd\u8bc1 $c_i$\u4e92\u4e0d\u76f8\u540c\u3002\n\n### \u9898\u76ee\u5206\u6790\n#### $Subtask1$\n\u5f88\u660e\u663e\uff0c\u5982\u679c $k=0$ \u5c31\u53ea\u6709\u4e00\u6761\u94fe\uff0c\u5426\u5219\u5c31\u6ca1\u6709\u3002\n\n#### $Subtask2-3$\n\u6807\u8bb0\u5220\u6389\u7684\u70b9\uff0c\u66b4\u529b\u53bb\u8dd1\u56fe\u3002\n\n\u8bbe$f_i$\u8868\u793a\u4ee5$i$\u7ed3\u5c3e\u7684\u94fe\u6570\uff0c\u8f6c\u79fb\u663e\u7136\uff1a\n\n $$\u2200(u,v),f_v\\leftarrow f_u+f_v$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(qm)$\u3002\n\n#### $Subtask4$\n$k=1$\u7684\u60c5\u51b5\u4e0b\uff0c\u8003\u8651\u5220\u53bb\u7684\u70b9\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f\u591a\u5c11\u8d21\u732e\u3002\n\n\u62ff\u6837\u4f8b\u4f5c\u5206\u6790\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2gbdoemh.png)\n\n\n\u5165\u5ea6\u4e3a$0$\u7684\u70b9\u662f$3$\uff0c\u51fa\u5ea6\u4e3a$0$\u7684\u70b9\u662f$5$\u3002\u624b\u73a9\u627e\u51fa$f_i$\u3002\n\n$\n\\begin{matrix}\n  i & 1 & 2 & 3 & 4 & 5 & 6 & 7\\\\\nf_i & 1  & 2 & 1  & 6 & 13 & 4 & 1\n\\end{matrix}\n$\n\n\u518d\u627e\u51fa\u6bcf\u4e2a\u70b9\u5230\u51fa\u5ea6\u4e3a$0$\u7684\u70b9\u7684\u65b9\u6848\u6570$n\\!f_i$\u3002\n\n$\n\\begin{matrix}\n  i   & 1 & 2 & 3  & 4 & 5 & 6 & 7\\\\\nn\\!f_i & 3 & 3 & 13 & 1 & 1 & 2 & 4\n\\end{matrix}\n$\n\n\u624b\u73a9\u7b54\u6848\u540e\u6c47\u603b\u5f97\uff1a\n\n$\n\\begin{matrix}\n  i   & 1  & 2 & 3  & 4 & 5  & 6 & 7\\\\\nf_i   & 1  & 2 & 1  & 6 & 13 & 4 & 1\\\\\nn\\!f_i & 3  & 3 & 13 & 1 & 1  & 2 & 4\\\\\nans_i  & 10 & 7 & 0  & 7 & 0  & 5 & 9\n\\end{matrix}\n$\n\n\u8bbe$s$\u4e3a\u51fa\u5ea6\u4e3a$0$\u7684$f_i$\u7684\u548c\uff0c\u53d1\u73b0$ans_i=s-f_i\\times n\\!f_i$\u3002\n\n$O(m)$\u9884\u5904\u7406\uff0c$O(1)$\u67e5\u8be2\uff0c\u603b\u590d\u6742\u5ea6$O(q+m)$\u3002\n\n#### $Subtask5$\n\n\u5bf9\u4e8e$k=2$\uff0c\u76f4\u63a5\u7528 $ans=s-f_i\\times n\\!f_i-f_j\\times n\\!f_j$\u8ba1\u7b97\u53ef\u80fd\u4f1a\u51fa\u95ee\u9898\uff0c\u56e0\u4e3a\u540c\u65f6\u7ecf\u8fc7$i,j$\u7684\u94fe\u4f1a\u88ab\u91cd\u590d\u8ba1\u7b97\uff0c\u8003\u8651\u4e24\u70b9\u5bb9\u65a5\u3002\n\n\u8bbe$d_{i,j}$\u8868\u793a\u5728\u539f\u56fe\u4e0a$i \\to j$\u7684\u65b9\u6848\u6570\uff0c\u8fd8\u662f\u901a\u8fc7\u6837\u4f8b\uff1a\n\n$\n\\begin{matrix}\n  d_{i,j} & 1 & 2 & 3 & 4 & 5  & 6 & 7 & i\\\\\n 1      & 1 & 0 & 0 & 2 & 3  & 1 & 0 & \\\\\n 2      & 0 & 1 & 0 & 1 & 3  & 1 & 0 & \\\\\n 3      & 1 & 2 & 1 & 6 & 13 & 4 & 1 & \\\\\n 4      & 0 & 0 & 0 & 1 & 1  & 0 & 0 & \\\\\n 5      & 0 & 0 & 0 & 0 & 1  & 0 & 0 & \\\\\n 6      & 0 & 0 & 0 & 1 & 2  & 1 & 0 & \\\\\n 7      & 0 & 1 & 0 & 2 & 4  & 1 & 1 & \\\\\n  j     &\n\\end{matrix}\n$\n\n\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28:\u82e5 $i\\ne j$\uff0c\u5219 $d_{i,j}\\times d_{j,i}=0$\u3002~~\u663e\u7136\u6210\u7acb\u3002~~\n\n- \u5982\u679c $d_{i,j}=d_{j,i}=0$\uff0c\u4ee3\u8868 $i,j$\u5230\u51fa\u5ea6\u4e3a$0$\u7684\u70b9\u7684\u8def\u5f84\u4e0d\u76f8\u4ea4\uff0c\u76f4\u63a5\u7528 $ans=s-f_i\\times n\\!f_i-f_j\\times n\\!f_j$ \u8ba1\u7b97\u5373\u53ef\u3002\n- \u5982\u679c $d_{i,j}\\ne 0$\uff0c\u4ee3\u8868 $i,j$\u5230\u51fa\u5ea6\u4e3a$0$\u7684\u70b9\u7684\u8def\u5f84\u4e2d $i$\u5305\u542b  $j$\uff0c\u91cd\u590d\u8def\u5f84\u5c31\u662f $f_i\\times d_{i,j}\\times n\\!f_j$\uff0c\u7528 $ans=s-f_i\\times n\\!f_i - (f_j - f_i \\times d_{i,j})\\times n\\!f_j$ \u8ba1\u7b97\u5373\u53ef\u3002\n- \u5982\u679c $d_{j,i}\\ne 0$\u3002\u7528 $ans=s-f_i\\times (n\\!f_i - f_j \\times d_{j,i})- f_j\\times n\\!f_j$ \u8ba1\u7b97\u5373\u53ef\uff0c\u540c\u4e0a\u3002\n\n\u6240\u4ee5\uff0c\u603b\u8ba1\u7b97\u5f0f\u4e3a\uff1a\n$$ ans=s-(f_i-f_j\\times d_{j,i})\\times n\\!f_i - (f_j - f_i \\times d_{i,j})\\times n\\!f_j$$\n\n$O(nm)$\u9884\u5904\u7406\uff0c$O(1)$\u67e5\u8be2\uff0c\u603b\u590d\u6742\u5ea6$O(nm+q)$\u3002\n\n#### $Subtask6$\n\u5230\u6b64\uff0c\u601d\u8def\u5df2\u7ecf\u5168\u90e8\u51fa\u6765\u4e86\uff0c\u5c06$k=2$\u7684\u60c5\u51b5\u6269\u5c55\u3002\u5bf9\u6240\u6709\u5220\u53bb\u7684\u70b9\u7684\u6bcf\u4e2a\u70b9\u5bf9 $(i,j)$\uff0c\u5982\u679c$i$\u80fd\u5230\u8fbe$j$\uff0c\u5c31\u5f80$i\\to j$\u8fde\u4e00\u6761\u7684\u8fb9\uff0c\u7136\u540e\u518d\u62d3\u6251\u6392\u5e8f\u4e00\u904d\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u70b9$i$\u7684\u51fa\u8fb9 $p$ \u5c06 $f_p\\leftarrow f_p-f_i\\times d_{i,p}$ \u3002\u6700\u540e\u7edf\u8ba1\u7b54\u6848\uff0c\u5373\n$$ans=s-\\sum\\limits_{i=1}^kf_{c_i}\\times n\\!f_{c_i}$$\n\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u9884\u5904\u7406\u62d3\u6251\u5e8f\u907f\u514d\u6bcf\u6b21\u8be2\u95ee\u518d\u8dd1\u4e00\u904d\u62d3\u6251\uff0c\u5373\u6839\u636e**\u62d3\u6251\u5e8f\u6392\u5e8f**\u540e\u8fdb\u884c\u5bb9\u65a5\u3002\n\n$O(nm)$\u9884\u5904\u7406\uff0c$O(k^2)$\u67e5\u8be2\uff0c\u603b\u590d\u6742\u5ea6$O(nm+k\\sum k)$\u3002\n\n## [\u53c2\u8003\u4ee3\u7801](https://www.luogu.com.cn/paste/2xoqfn83)",
        "postTime": 1634172520,
        "uid": 222362,
        "name": "yxzy4615",
        "ccfLevel": 6,
        "title": "P6651"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\u70b9\uff1a \u62d3\u6251\u6392\u5e8f+\u5bb9\u65a5\n\n\u672c\u9898\u5206\u4e09\u4e2a\u6b65\u9aa4\uff1a\u5efa\u56fe\uff0c\u62d3\u6251\uff0c\u5bb9\u65a5\u51cf\u8fb9\n\n\u56e0\u4e3a\u6709\u591a\u4e2a\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\u548c\u51fa\u5ea6\u4e3a\u96f6\u7684\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5efa\u4e00\u4e2a\u8d85\u7ea7\u6e90\u70b9\u8fde\u63a5\u6240\u6709\u5165\u5ea6\u4e3a\u96f6\u7684\u70b9\uff0c\u4e00\u4e2a\u8d85\u7ea7\u6c47\u70b9\u8fde\u63a5\u6240\u6709\u51fa\u5ea6\u4e3a\u96f6\u7684\u70b9\u3002\n\n\u5efa\u56fe\u8bb2\u5b8c\u4e86\uff0c\u63a5\u4e0b\u6765\u662f\u62d3\u6251\u3002\n\n\u62d3\u6251\u5c31\u662f\u666e\u901a\u7684\u62d3\u6251\uff0c\u4f46\u9700\u8981\u8bb0\u5f55\u62d3\u6251\u5e8f $dfn$ \uff0c\u540c\u65f6\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u5230\u6bcf\u4e2a\u70b9\u7684\u8def\u5f84\u6570\u91cf $dp$ \u3002\n\n\u6700\u540e\u662f\u5bb9\u65a5\u51cf\u8fb9\uff0c\u5148\u628a\u8981\u5220\u7684\u70b9\u6309\u62d3\u6251\u5e8f\u6392\u5e8f\uff0c\u4e4b\u540e\u627e\u51fa\u6bcf\u4e00\u4e2a\u70b9\u5bf9 $(c_i,c_j)~,~i,j\\in[1,k+1]$ \uff0c\u8ba9  $dis_i$ \u51cf\u53bb $dis_j\\times dp_{del_j,del_i}$ \u5373\u53ef\uff08 $dis_i$ \u8868\u793a\u8d85\u7ea7\u6e90\u70b9\u5230\u70b9 $i$ \u7684\u8def\u5f84\u6761\u6570 \uff09\u3002\n\n\u6700\u7ec8\u7b54\u6848\u5c31\u662f $dis_{k+1}$ \u5373\u8d85\u7ea7\u6e90\u70b9\u5230\u8d85\u7ea7\u6c47\u70b9\u7684\u8def\u5f84\u6761\u6570\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int MAXN=8e3+5;\nconst int MAXM=4e4+5;\nconst int MOD=1e9+7;\nstruct node\n{\n\tint to,nxt;\n}e[MAXM];\nint head[MAXN],cnt,sum;\nint ru[MAXN],chu[MAXN];\nint dfn[MAXN],dp[MAXN][MAXN];\nint del[MAXN],dis[MAXN];\nint n,m;\ninline void add(int x,int y)\n{\n\te[++cnt].to=y;\n\te[cnt].nxt=head[x];\n\thead[x]=cnt;\n\tchu[x]++;\n\tru[y]++;//\u7edf\u8ba1\u5165\u5ea6\u548c\u51fa\u5ea6\n}\ninline void topo()//\u666e\u901a\u7684\u62d3\u6251\u6392\u5e8f\n{\n\tqueue<int>q;\n\tq.push(n-1);\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();\n\t\tq.pop();\n\t\tdfn[x]=++sum;//\u8bb0\u5f55\u62d3\u6251\u5e8f\n\t\tfor(register int i=head[x];i;i=e[i].nxt)\n\t\t{\n\t\t\tint y=e[i].to;\n\t\t\tru[y]--;\n\t\t\tfor(register int j=1;j<=n;j++)\n\t\t\t\tdp[j][y]=(dp[j][y]+dp[j][x])%MOD;//\u7d2f\u52a0\u8def\u5f84\u6761\u6570\n\t\t\tif(!ru[y])q.push(y);\n\t\t}\n\t}\n}\ninline bool cmp(int x,int y)//\u88ab\u5220\u9664\u7684\u70b9\u9700\u6309\u62d3\u6251\u5e8f\u6392\u5e8f\n{\n\treturn dfn[x]<dfn[y];\n}\nsigned main()\n{\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(register int i=1;i<=m;i++)\n\t{\n\t\tint x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tadd(x,y);\n\t}\n\tfor(register int i=1;i<=n;i++)//\u5efa\u7acb\u8d85\u7ea7\u6e90\u70b9n+1\n\t\tif(!ru[i])add(n+1,i);\n\tfor(register int i=1;i<=n;i++)//\u5efa\u7acb\u8d85\u7ea7\u6c47\u70b9n+2\n\t\tif(!chu[i])add(i,n+2);\n\tn+=2;\n\tfor(register int i=1;i<=n;i++)\n\t\tdp[i][i]=1;\n\ttopo();\n\tint q;\n\tscanf(\"%lld\",&q);\n\twhile(q--)\n\t{\n\t\tint k;\n\t\tscanf(\"%lld\",&k);\n\t\tfor(register int i=1;i<=k;i++)\n\t\t\tscanf(\"%lld\",&del[i]);\n\t\tdel[0]=n-1;\n\t\tdel[k+1]=n;\n\t\tdis[0]=-1;\n\t\tsort(del+1,del+k+1,cmp);\n\t\tfor(register int i=1;i<=k+1;i++)\n\t\t{\n\t\t\tdis[i]=0;\n\t\t\tfor(register int j=0;j<i;j++)\n\t\t\t\tdis[i]=(dis[i]-dis[j]*dp[del[j]][del[i]]%MOD)%MOD;//\u5bb9\u65a5\u51cf\u8fb9\n\t\t}\n\t\tprintf(\"%lld\\n\",(dis[k+1]+MOD)%MOD);//\u7b54\u6848\u5c31\u662fdis[k+1]\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1634129440,
        "uid": 126871,
        "name": "yzh_Error404",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6651 \u3010Chain\u3011"
    },
    {
        "content": "\u6bd4\u8f83\u6076\u5fc3\u7684\u4e00\u9053\u84dd\u9898\u3002\n\n#### \u601d\u8def\n\n\u62d3\u6251\u6392\u5e8f + dp\u3002\n\n\u770b\u5230\u6709\u5411\u65e0\u73af\u56fe\uff0c\u9996\u5148\u8003\u8651\u62d3\u6251\u6392\u5e8f\u3002\n\n\u8bb0\u5f55\u4e0b\u6bcf\u4e2a\u70b9\u7684\u62d3\u6251\u5e8f\uff0c\u4ee5\u53ca\u6bcf\u4e24\u4e2a\u8282\u70b9\u4e4b\u95f4\u6709\u591a\u5c11\u6761\u8def\u5f84,\u4ee5\u53ca $f_{i}$ \u548c $r_{i}$\u3002\n\n $f_{i}$ \u4e3a\u5165\u5ea6\u4e3a $0$ \u5230\u70b9 $i$ \u7684\u8def\u5f84\u6570\uff0c$r_{i}$ \u4e3a\u53cd\u56fe\u4e0a\u7684 $f_{i}$\u3002\n\n\u8fd0\u7528DP\uff0c\u8bbe\u9700\u8981\u5220\u9664\u7684\u70b9\u4e3a $c_{i}$ \u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $c_{i}$ \u7684\u51fa\u8fb9 $c_{j}$ \uff0c\u5c06 $f_{c_j}$ \u51cf\u53bb $f_{c_j} \\times d_{c_i , c_j}$ \u3002\n\n\u5176\u4e2d $d_{c_i , c_j}$ \u4ee3\u8868 $c_{i}$ \u5230 $c_{j}$ \u6709\u591a\u5c11\u6761\u8def\u5f84\u3002\n\n\u6700\u540e\u5728\u7edf\u8ba1\u7b54\u6848\uff0c\u5373$sum - \\sum{f_{c_i} \\times r_{c_i}}$\u3002\n\n\u53d1\u73b0\u6bcf\u6b21DP\u65f6\u90fd\u505a\u62d3\u6251\u6392\u5e8f\u6bd4\u8f83\u9ebb\u70e6\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u9884\u5904\u7406\u3002\n\n\u4e5f\u5c31\u76f8\u5f53\u4e8e\u6839\u636e\u62d3\u6251\u6392\u5e8f\u8fdb\u884c\u5bb9\u65a5\u3002\n\n#### Code\n\n\u4ee3\u7801\u4e5f\u4e0d\u7b97\u957f\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int p = 1e9 + 7;\nint n, m, q, cnt, leng;\nint head[3001], ru[3001], chu[3001], dfn[3001], dp[3001][3001], f[3001], c[3001];\n\nstruct edge\n{\n    int to, nxt;\n} e[20010], e1[20010];\n\nint read()\n{\n    int X = 0, qwe = 1;\n    char ch = getchar();\n    while (!isdigit(ch))\n    {\n        if (ch == '-') qwe = -1;\n        ch = getchar();\n    }\n    while (isdigit(ch))\n        X = X * 10 + (int)(ch - '0'),\n        ch = getchar();\n    return X * qwe;\n}\n\nvoid add(int x, int y)\n{\n    e[++cnt] = (edge)\n    {\n        y, head[x]\n    };\n    head[x] = cnt;\n}\n\nvoid topo()\n{\n    int top;\n    queue<int>q;\n    q.push(n - 1);\n    while (!q.empty())\n    {\n        top = q.front(), dfn[top] = ++leng, q.pop();\n        for (int i = head[top]; i > 0; i = e[i].nxt)\n        {\n            ru[e[i].to]--;\n            for (int j = 1; j <= n; ++j) dp[j][e[i].to] = (dp[j][top] + dp[j][e[i].to]) % p;\n            if (!ru[e[i].to]) q.push(e[i].to);\n        }\n    }\n    return;\n}\n\nbool cmp(int x, int y)\n{\n    return dfn[x] < dfn[y];\n}\n\nsigned main()\n{\n//    freopen(\"foodchain.in\", \"r\", stdin);\n//    freopen(\"foodchain.out\", \"w\", stdout);\n    int x, y;\n    n = read(), m = read();\n    for (int i = 1; i <= m; i++) x = read(), y = read(), add(x, y), ru[y]++, chu[x]++;\n    for (int i = 1; i <= n; i++)\n        if (!ru[i])\n            add(n + 1, i), ru[i]++, chu[n + 1]++;\n    for (int i = 1; i <= n; i++)\n        if (!chu[i])\n            add(i, n + 2), chu[i]++, ru[n + 2]++;\n    n += 2;\n    for (int i = 1; i <= n; i++) dp[i][i] = 1;\n    topo(), q = read();\n    while (q--)\n    {\n        int k = read();\n        for (int i = 1; i <= k; i++) c[i] = read();\n        c[0] = n - 1, c[k + 1] = n, f[0] = -1;\n        sort(c  + 1, c + k + 1, cmp);\n        for (int i = 1; i <= k + 1; i++)\n        {\n            f[i] = 0;\n            for (int j = 0; j <= i - 1; j++) f[i] = (f[i] - f[j] * dp[c[j]][c[i]] % p) % p;\n        }\n\t\tprintf(\"%lld\\n\" , (f[k + 1] + p) % p);\n    }\n    return 0;\n}\n```",
        "postTime": 1634123693,
        "uid": 320933,
        "name": "Mfeitveer",
        "ccfLevel": 0,
        "title": "P6651 \u300cSWTR-05\u300dChain \u9898\u89e3"
    },
    {
        "content": "# P6651\u9898\u89e3\n## \u9898\u610f \n\u81ea\u5df1\u770b\u9898\u9762\u3002\n## \u601d\u8def\n\u9898\u76ee\u7ed9\u51fa\u8fd9\u662f\u4e2a $DAG$ \u6240\u4ee5\u731c\u6d4b\u8981\u7528\u62d3\u6251\u6392\u5e8f\u3002\n\n\u518d\u770b\u8be2\u95ee \uff1a\u8be2\u95ee $q$ \u6b21\uff0c\u6bcf\u6b21\u8be2\u95ee\u72ec\u7acb\u3002\n\n\u770b\u5230\u6570\u636e\u8303\u56f4 $q\u2264500000$ \u663e\u7136\u9700\u8981\u5728\u8be2\u95ee\u524d\u9884\u5904\u7406\uff0c\u5426\u5219\u65f6\u95f4\u4f1a\u70b8\u3002\n\n\u6240\u4ee5\u5bb9\u6613\u60f3\u5230\u5e94\u5148\u9884\u5904\u7406\u51fa\u4e00\u4e2a\u70b9\u4e5f\u4e0d\u5220\u65f6\u94fe\u7684\u6570\u91cf\u3002\n\n\u5728\u770b\u5230\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa\u591a\u4e2a\u70b9\uff0c\u6c42\u5220\u9664\u540e\u94fe\u7684\u6570\u91cf\uff0c\u53d1\u73b0\u4e0d\u592a\u597d\u60f3\uff0c\u6240\u4ee5\u5148\u8003\u8651\u53ea\u5220\u4e00\u4e2a\u70b9\u3002\n\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u5230 \u98df\u7269\u94fe\u9876\u7aef \u7684\u8def\u5f84\u6761\u6570 \u548c \u5230 \u98df\u7269\u94fe\u5e95\u90e8 \u7684\u8def\u5f84\u6761\u6570\uff0c\u6bcf\u6b21\u8be2\u95ee\u5c06\u5220\u9664\u7684\u70b9\u5230 \u94fe\u9876\u548c\u94fe\u5e95 \u7684\u8def\u5f84\u6761\u6570\u76f8\u4e58\uff0c\u518d\u8f93\u51fa\u9884\u5904\u7406\u51fa\u7684 \u94fe\u7684\u6761\u6570 \u51cf\u53bb\u8fd9\u4e2a\u503c\uff0c\u53ef\u4ee5\u505a\u5230 $O(1)$ \u7684\u8be2\u95ee\uff0c\u4f46\u8981\u6ce8\u610f\u53d6\u6a21\u662f\u8981\u5728\u53d6\u5b8c\u4e00\u6b21\u6a21\u540e\u518d\u52a0 $mod$ \u518d\u6a21 $mod$ \uff0c\u4e0d\u7136\u4f1a\u6709\u8d1f\u6570\u7684\u60c5\u51b5\u3002\n\n--------------------------------------------\n\u5728\u8003\u8651\u5b8c\u4e00\u4e2a\u70b9\u540e\uff0c\u518d\u60f3\u6bcf\u6b21\u5220\u4e24\u4e2a\u70b9\u7684\u505a\u6cd5\u3002\n\n\u5f53\u8fd9\u4e24\u4e2a\u70b9\u4e0d\u5728\u540c\u4e00\u6761\u94fe\u4e0a\u662f\uff0c\u76f4\u63a5\u6309\u4e00\u4e2a\u70b9\u7684\u6c42\u6cd5\u5c31\u884c\u3002\n\n\u5f53\u4e24\u4e2a\u70b9\u4f4d\u4e8e\u540c\u4e00\u6761\u8fde\u4e0a\u65f6\uff0c\u53ef\u4ee5\u8003\u8651\u5c06\u62d3\u6251\u5e8f\u5927\u7684\u70b9\u5230 \u98df\u7269\u94fe\u5e95\u90e8 \u7684\u8def\u5f84\u6761\u6570\u51cf\u53bb\u62d3\u6251\u5e8f\u5c0f\u7684\u70b9\u5230 \u98df\u7269\u94fe\u5e95\u7aef\u7684\u8def\u5f84\u6761\u6570\u4e58\u4e0a\u4e24\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u6761\u6570\uff0c\u611f\u6027\u7406\u89e3\u5373\u4e3a \u62d3\u6251\u5e8f\u5927\u7684\u70b9\u5728\u4e0d\u7ecf\u8fc7 \u62d3\u6251\u5e8f\u5c0f\u7684\u90a3\u4e2a\u70b9\u7684\u60c5\u51b5\u4e0b\u5230\u98df\u7269\u94fe\u5e95\u90e8\u7684\u8def\u5f84\u6761\u6570\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u80fd\u6709\u6548\u5730\u53bb\u91cd\u3002\n\n\u4e09\u4e2a\u70b9\u53ca\u4ee5\u4e0a\u7684\u60c5\u51b5\u4e0e\u4e24\u4e2a\u70b9\u7684\u60c5\u51b5\u76f8\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u5177\u4f53\u770b\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define int ll\nconst ll N=2e3+5,M=2e4+5,mod=1000000007;\nll n,m,q,k,c[N],st[N],ed[N],rd[N],cd[N],ans,nans;\nll head[N],to[M],nxt[M],cnt,topo,top[N],kk[N],S[N],T[N],ss,tt;\nll dis[N][N];\nqueue<int> d;\nll read()//\u5feb\u8bfb\n{\n\tint r=0,f=1;\n\tchar c=getchar();\n\twhile(!isdigit(c))\n\t{\n\t\tif(c=='-')  f=-1;\n\t\tc=getchar();\n\t} \n\twhile(isdigit(c))  \n\t{\n\t\tr=(r<<1)+(r<<3)+c-48;\n\t\tc=getchar();\n\t}\n\treturn r*f;\n}\nvoid add(int u,int v)\n{\n\tto[++cnt]=v;\n\tnxt[cnt]=head[u];\n\thead[u]=cnt;\n}\nbool cmp(int x,int y) //\u6309\u62d3\u6251\u5e8f\u6392\u5e8f\n{\n\treturn top[x]<top[y];\n}\nsigned main()\n{\n\tn=read(); m=read();\n\tfor(int i=1,u,v;i<=m;i++) //\u8fde\u8fb9\n\t{\n\t\tu=read();v=read();\n\t\tadd(u,v);\n\t\trd[v]++; cd[u]++;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(rd[i]==0)\n\t\t{\n\t\t\td.push(i);\n\t\t\tS[++ss]=i; //\u94fe\u5e95\u6570\u91cf\n\t\t}\n\t\tif(cd[i]==0)\n\t\t\tT[++tt]=i; //\u94fe\u9876\u6570\u91cf\n\t}\n\t\t\n\twhile(!d.empty()) //\u6c42\u4efb\u610f\u4e24\u70b9\u4e4b\u95f4\u8def\u5f84\u6761\u6570\uff0c\u540c\u65f6\u8bb0\u5f55\u62d3\u6251\u5e8f\n\t{\n\t\tint u=d.front();\n\t\td.pop();\n\t\tdis[u][u]=1;\n\t\ttop[u]=++topo;\n\t\tfor(int i=head[u];i;i=nxt[i])\n\t\t{\n\t\t\tint v=to[i];\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tdis[j][v]=(dis[j][v]+dis[j][u])%mod;\n\t\t\trd[v]--;\n\t\t\tif(rd[v]==0) d.push(v);\n\t\t}\n\t}\n\tfor(int i=1;i<=ss;i++)\n\t\tfor(int j=1;j<=tt;j++)\n\t\t\t(ans+=dis[S[i]][T[j]])%=mod; //\u521d\u59cb\u94fe\u7684\u6761\u6570\n\tfor(int i=1;i<=ss;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\t(st[j]+=dis[S[i]][j])%=mod; //\u6bcf\u4e2a\u70b9\u5230\u94fe\u5e95\u7684\u6761\u6570\n\tfor(int i=1;i<=tt;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\t(ed[j]+=dis[j][T[i]])%=mod; //\u6bcf\u4e2a\u70b9\u5230\u94fe\u9876\u7684\u6761\u6570\n\tq=read();\n\twhile(q--)\n\t{\n\t\tk=read();\n\t\tnans=ans;\n\t\tfor(int i=1;i<=k;i++)\n\t\t\tc[i]=read();\n\t\tsort(c+1,c+1+k,cmp);//\u62d3\u6251\u6392\u5e8f\n\t\tfor(int i=1;i<=k;i++)\n\t\t{\n\t\t\tkk[i]=st[c[i]];\n\t\t\tfor(int j=1;j<i;j++)\n\t\t\t\t(kk[i]-=dis[c[j]][c[i]]*kk[j])%=mod; //\u51cf\u53bb\u91cd\u590d\u90e8\u5206\n\t\t\tnans=((nans-kk[i]*ed[c[i]])%mod+mod)%mod; //\u6ce8\u610f\u53bb\u6a21\n\t\t}\n\t\tprintf(\"%lld\\n\",nans);\n\t}\n}\n```\n",
        "postTime": 1634172576,
        "uid": 256970,
        "name": "xie_lzh",
        "ccfLevel": 0,
        "title": "P6651\u9898\u89e3"
    }
]