[
    {
        "content": "# \u5e7f\u544a\n\n[\u849f\u84bb\u306eblog](http://www.cnblogs.com/dedicatus545/p/8900494.html)\n\n# \u66f4\u65b0\u73b0\u573a\uff08\u5efa\u8bae\u5148\u770b\u201c\u601d\u8def\u201d\u5f00\u59cb\u7684\u90e8\u5206\uff09\n\n\u9274\u4e8e\u8bc4\u8bba\u533a\u7684\u5927\u5bb6\u5bf9\u4ee3\u7801\u4e2d\u7684$ans$\u63d0\u51fa\u7684\u7591\u60d1\uff0c\u6211\u518d\u91cd\u65b0\u7ec6\u8bb2\u4e00\u904d\n\n\u8003\u8651$kmp$\u8fc7\u7a0b\u4e2d\u6c42\u51fa\u7684$next$\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u6211\u7684\u4ee3\u7801\u91cc\u9762\u7684$fail$\n\n\u5b9e\u9645\u4e0a\u8fd9\u4e9b$fail$\u4f5c\u4e3a\u8fb9\u7684\u8bdd\uff0c\u5b83\u4eec\u6784\u6210\u4e86\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\u3002\u8fd9\u4e2a\u6811\u5f62\u7ed3\u6784\u5c31\u662f**KMP\u81ea\u52a8\u673a\u7684$fail$\u6811**\uff08\u5173\u4e8e$fail$\u6811\u7684\u6982\u5ff5\u53ef\u4ee5\u53c2\u8003$AC$\u81ea\u52a8\u673a\uff0c\u8fd9\u91cc\u5b9e\u9645\u4e0a$KMP$\u81ea\u52a8\u673a\u5c31\u662f\u5728$AC$\u81ea\u52a8\u673a\u53ea\u63d2\u5165\u4e86\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u60c5\u51b5\u4e0b\u5efa\u7acb\u7684\u81ea\u52a8\u673a\uff0c\u540c\u7406\u5b83\u4e5f\u62e5\u6709$fail$\u6811\uff09\uff08\u540c\u65f6\u4e5f\u8981\u6ce8\u660e\uff0c\u5b9e\u9645\u4e0a\u6b64\u5904\u4f7f\u7528\u7684\u5e94\u8be5\u662f$MP$\u7b97\u6cd5\u800c\u4e0d\u662f$KMP$\u7b97\u6cd5\uff0c\u6240\u4ee5\u79f0\u4e4b\u4e3a$MP$\u81ea\u52a8\u673a\u66f4\u5408\u9002\uff09\n\n\u90a3\u4e48\u7406\u89e3\u4e86\u8fd9\u4e2a\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8f7b\u677e\u610f\u8bc6\u5230\uff0c\u4ee3\u7801\u91cc\u9762\u7684$ans$\u5b9e\u9645\u4e0a\u662f\u8fd9\u4e2a\u8282\u70b9\u5728$fail$\u6811\u4e0a\u7684\u6df1\u5ea6\n\n\u5e94\u5f53\u610f\u8bc6\u5230\uff0c\u7531\u4e8e\u5bf9\u4e8e\u524d\u7f00$i$\u800c\u8a00\uff0c$next[i]$\u3001$next[next[i]]$\u3001$next[next[next[i]]]$\u7b49\u7b49\u90fd\u662f\u5b83\u7684\u516c\u5171\u524d\u540e\u7f00\uff0c**\u6240\u4ee5\u8282\u70b9$i$\u5728\u8be5\u5b57\u7b26\u4e32\u7684$KMP$\u81ea\u52a8\u673a\u7684$fail$\u6811\u4e0a\u7684\u6df1\u5ea6\u5c31\u662f\u524d\u7f00$[1,i]$\u7684\u516c\u5171\u524d\u540e\u7f00\u4e2a\u6570**\n\n\u5728\u540e\u9762\u7684\u9012\u5f52\u6c42\u89e3\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u628a\u8fd9\u4e2a\u8fc7\u7a0b\u653e\u5230$fail$\u6811\u4e0a\u7406\u89e3\uff0c\u540c\u6837\u4f1a\u597d\u7406\u89e3\u5f88\u591a\uff1a$j$\u4e5f\u5c31\u662f\u5728$fail$\u6811\u4e0a\u5f80\u524d\u8df3\u7684\u8fc7\u7a0b\u4e2d\u7528\u4e8e\u8bb0\u5f55\u7684\u4e00\u4e2a\u6307\u9488\uff0c\u5b83\u4f1a\u6bcf\u6b21\u8df3\u5230\u76f4\u5230$j\\ast 2>i$\u4e3a\u6b62\n\n# \u601d\u8def\n\n\u9996\u5148\uff0c\u8fd9\u9898\u6700\u597d\u7684\u4e00\u4e2a\u5730\u65b9\uff0c\u5728\u4e8e\u5b83\u7ed9\u51fa\u7684\u5173\u4e8e$next$\u7684\u8bb2\u89e3\u5b9e\u5728\u662f\u5999\u6781......\u751a\u81f3\u53ef\u4ee5\u8bf4\u6211\u7684kmp\u662f\u8fc7\u4e86\u8fd9\u9053\u9898\u4ee5\u540e\u624d\u8131\u80ce\u6362\u9aa8\u7684\n\n\u7136\u540e\u662f\u6b63\u6587\uff1a\n\n### \u5982\u4f55\u6c42$num$\u6570\u7ec4\uff1f\n\n\u8fd9\u9053\u9898\u7684\u8f93\u5165\u67091e6\u4e2a\u5b57\u7b26\uff0c\u663e\u7136\u9700\u8981$O\\left(n\\right)$\u5de6\u53f3\u7ea7\u522b\u7684\u7b97\u6cd5\u6765\u89e3\n\n\u5148\u770b\u5230$num$\u7684\u5b9a\u4e49\uff1a\u4e0d\u4e92\u76f8\u91cd\u53e0\u7684\u516c\u5171\u524d\u540e\u7f00**\u4e2a\u6570**\n\n\u8fd9\u8bf4\u660e\u4ec0\u4e48\uff1f\n\n\u8bf4\u660e$num$\u4e0d\u540c\u4e8e$next$\u8bb0\u5f55\u7684\u662f\u4e00\u4e2a\u6700\u5927\u503c\uff0c\u5b83\u8bb0\u5f55\u7684\u662f\u4e00\u4e2a\u548c\u503c\n\n\u800c\u8fd9\u4e2a\u548c\u503c\uff0c\u662f\u53ef\u4ee5\u63a8\u51fa\u6765\u7684\n\n\u8003\u8651\u4e00\u4e2a\u524d\u7f00$i$\u7684$next[i]$\uff0c\u5b83\u957f\u8fd9\u6837\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/dedicatus545/1199264/o_NOI2014%20p1.png)\n\n\u5176\u4e2d\uff0c$next[i]$\uff0c$next[next[i]]$\uff0c$next[next[next[i]]]$......\u90fd\u662f\u8fd9\u4e2a\u524d\u7f00\u4e32i\u7684\u516c\u5171\u524d\u540e\u7f00\uff0c\u800c\u4e14\u53ea\u6709\u5b83\u4eec\u662f\u516c\u5171\u524d\u540e\u7f00\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u5176\u5b9e\u53ea\u8981\u5728\u6c42$next$\u7684\u8fc7\u7a0b\u4e2d\uff0c\u987a\u4fbf\u628a\u8fd9\u4e2a\u516c\u5171\u524d\u540e\u7f00\u7684\u6570\u91cf\u9012\u63a8\u4e00\u4e0b\uff0c\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u5f31\u5316\u7248\u7684$num$\u6570\u7ec4\uff1a\u53ef\u4ee5\u91cd\u53e0\u7684\u516c\u5171\u524d\u540e\u7f00\u6570\u91cf\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a$ans$\n\n### \u5982\u4f55\u53bb\u9664\u6709\u91cd\u53e0\u7684\uff1f\n\n\u8fd8\u662f\u770b\u4e0a\u9762\u90a3\u5f20\u56fe\n\n\u9996\u5148$next$\u6570\u7ec4\u6709\u4e00\u4e2a\u6027\u8d28\uff1a$next[i] < i$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6\u6709\u4e00\u4e2a\u9012\u5f52\u4e86n\u5c42\u7684next\uff0c\u6bd4\u539f\u524d\u7f00i\u7684\u957f\u5ea6\u7684\u4e00\u534a\u8981\u5c0f\uff0c\u90a3\u4e48\u8fd9\u4e2anext\u7684\u9012\u63a8\u51fa\u7684\u7b54\u6848$ans$\u5c31\u662fi\u7684$num$\u4e86\n\n### \u4e00\u4e2a\u95ee\u9898\n\n\u5047\u5982\u6211\u4eec\u62ff\u5230\u7684\u4e32\u662f1e6\u4e2a'a'\uff0c\u90a3\u4e48\u4e0a\u9762\u90a3\u4e2a\u7b97\u6cd5\u5c31\u4f1a\u88ab\u5361\u6210$O\\left(n^2\\right)$\uff0c\u9053\u7406\u7684\u8bdd\u5927\u5bb6\u53ef\u4ee5\u60f3\u4e00\u60f3\uff08\u6bcf\u4e00\u6b21\u9012\u5f52\u90fd\u53ea\u4f1a\u628anext[i]\u53d8\u5c0f1\uff09\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u505a\u4e00\u4e2a\u4f18\u5316\uff0c\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u800c\u89e3\u51b3\u95ee\u9898\u7684\u6838\u5fc3\u5c31\u662f\uff1a\u51cf\u5c11\u91cd\u590d\u9012\u5f52\n\n\u51cf\u5c11\u91cd\u590d\u9012\u5f52......\u6709\u6ca1\u6709\u60f3\u5230\u4ec0\u4e48\uff1f\n\n\u6ca1\u9519\uff0c\u5c31\u662f\u5982\u540c\u6c42$next$\u65f6\u4e00\u6837\u7684\u65b9\u6cd5\uff01\n\n\u6211\u4eec\u5c06\u9012\u5f52\u7528\u7684\u53d8\u91cf$j$\u7684\u503c\u4e0d\u66f4\u65b0\uff0c\u8fd9\u6837\uff0c\u6c42\u5b8c\u4e86$i$\u7684\u7b54\u6848\u4ee5\u540e\uff0c$j$\u7684\u4f4d\u7f6e\u4e00\u5b9a\u5728$\\frac i2$\u7684\u5de6\u8fb9\uff0c\u4e5f\u5c31\u662f\u5b83\u5df2\u7ecf\u6ee1\u8db3\u8981\u6c42\u4e86\n\n\u8fd9\u65f6\u518d\u9012\u5f52\u6c42\u89e3\uff0c\u603b\u65f6\u95f4\u6548\u7387\u662f$O\\left(n\\right)$\u7684\n\n# Code\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define ll long long\nusing namespace std;\nconst ll MOD=1e9+7;\nint n,fail[1000010],ans[1000010];ll cnt;char a[1000010];\nint main(){\n    int T,i,j;scanf(\"%d\",&T);\n    while(T--){\n        scanf(\"%s\",a);n=strlen(a);\n        memset(fail,0,sizeof(fail));\n        j=0;ans[0]=0;ans[1]=1;\n        \n        for(i=1;i<n;i++){//\u6c42\u89e3next\n            while(j&&(a[i]!=a[j])) j=fail[j];\n            j+=(a[i]==a[j]);fail[i+1]=j;ans[i+1]=ans[j]+1;//\u9012\u63a8\u8bb0\u5f55ans\n        }\n        \n        j=0;cnt=1;\n        for(i=1;i<n;i++){//\u6c42\u89e3num\n            while(j&&(a[i]!=a[j])) j=fail[j];\n            j+=(a[i]==a[j]);\n            while((j<<1)>(i+1)) j=fail[j];\n            cnt=(cnt*(ll)(ans[j]+1))%MOD;//\u8bb0\u5f97+1\n        }\n        printf(\"%lld\\n\",cnt);\n    }\n}\n```",
        "postTime": 1524283301,
        "uid": 27753,
        "name": "Orion545",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "## [\u9898\u610f](https://www.luogu.org/problemnew/show/P2375)\n\n\u9996\u5148\u6211\u4eec\u6bd4\u5bf9\u4e00\u4e0b$nxt$\u6570\u7ec4\u548c$num$\u6570\u7ec4\n\n$nxt$\uff1aS\u4e32\u524d$i$\u4e2a\u5b57\u7b26\u6700\u957f\u516c\u5171\u524d\u540e\u7f00\n\n$num$\uff1aS\u4e32\u524d$i$\u4e2a\u5b57\u7b26\u4e0d\u91cd\u53e0\u7684\u516c\u5171\u524d\u540e\u7f00\u6570\u91cf\n\n\u9996\u5148\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff1a\n\n\u5bf9\u4e8e$[1,i]$\uff1a$nxt[i],nxt[nxt[i]],nxt[nxt[nxt[i]]]...$\u8868\u793a\u4e86$[1,i]$\u6240\u6709\u7684\u516c\u5171\u524d\u540e\u7f00\n\n![](https://cdn.luogu.com.cn/upload/pic/62593.png)\n\n\u5982\u56fe\uff1a\u7eff\u8272\u7684\u90e8\u5206\u662f\u76f8\u540c\u7684\n\n\u4e8e\u662f\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5148\u66b4\u529b\u8df3$nxt$\u76f4\u5230$j<=i/2$\uff0c$num[i]$\u5c31\u662f\u4e4b\u540e\u80fd\u8df3\u51e0\u6b65\n\n\u6211\u4eec\u8bb0\u5f55$i$\u80fd\u8df3$nxt$\u76f4\u5230$nxt=0$\u7684\u6b21\u6570\uff0c\u8bb0\u4e3a$num[i]$(\u6709\u7684\u601d\u8def\u8bf4\u8fd9\u662f\u4e0d\u8003\u8651\u4e0d\u91cd\u53e0\u7684num\u6570\u7ec4)\n\n\u7b49\u5230\u8df3\u5230$j<=i/2$,\u8ba9$ans*(num[j]+1)$ \u5373\u53ef\n\ncode\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=1000010;\nconst int mod=1e9+7;\nint n,T;\nint nxt[maxn],num[maxn];\nlong long ans;\nchar s[maxn];\nvoid getnxt()\n{\n    for(int i=2,j=0;i<=n;i++)\n    {\n        while(j&&s[i]!=s[j+1]) j=nxt[j];\n        if(s[i]==s[j+1]) j++;\n        nxt[i]=j;num[i]=num[j]+1;\n    }\n}\nvoid getnum()\n{\n    for(int i=2,j=0;i<=n;i++)\n    {\n        while(j&&s[i]!=s[j+1]) j=nxt[j];\n        if(s[i]==s[j+1])j++;\n        while((j<<1)>i) j=nxt[j];\n        ans=(ans*(long long)(num[j]+1))%mod;\n    }\n}\nint main()\n{\n    scanf(\"%d\",&T);\n    while(T--)\n    {\n        ans=1;num[1]=1;\n        scanf(\"%s\",s+1);n=strlen(s+1);\n        getnxt();getnum();\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1562549945,
        "uid": 145441,
        "name": "nofind",
        "ccfLevel": 6,
        "title": "P2375 [NOI2014]\u52a8\u7269\u56ed(kmp)"
    },
    {
        "content": "\u795eTM\u9605\u8bfb\u7406\u89e3\u9898\n\n\u770b\u5b8c\u9898\u76ee\u4e4b\u540e\n\n\n\u66b4\u529b\uff1a\u6bcf\u6b21\u66b4\u8df3$next$\u6570\u7ec4\n\n\u592a\u6162\u5566\n\n\n\u4f18\u5316\u4e00\u4e0b\u66b4\u529b\uff1a\n\n\u641e\u4e2a\u500d\u589e\u6570\u7ec4\u6765\u8df3$next$\n\n\u6bcf\u6b21\u500d\u589e\u8df3$next$\n\n\u590d\u6742\u5ea6$O(Tnlogn)$\n\n\u7b97\u4e00\u4e0b\uff0c\u611f\u89c9\u590d\u6742\u5ea6\u5dee\u4e0d\u591a\u5440\n\n\u5f88\u679c\u65ad\u7684\u4ea4\u4e86\u4e00\u53d1\n\n\u7136\u540e$80$\u5206\u3002\u3002\u3002\n\n\n\u66b4\u529b\u4ee3\u7801\u9001\u4e0a\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<set>\n#include<map>\n#include<vector>\n#include<queue>\nusing namespace std;\n#define MOD 1000000007\nchar s[1200000];\nint nt[1200000];\nint jp[1200000][21];\nint main()\n{\n    int T;\n    scanf(\"%d\",&T);\n    while(T--)\n    {\n        scanf(\"%s\",s+1);\n        nt[1]=0;\n        int l=strlen(s+1);\n        for(int i=2;i<=l;++i)\n        {\n            int j=nt[i-1];\n            while(j&&s[i]!=s[j+1])j=nt[j];\n            if(s[i]==s[j+1])nt[i]=j+1;\n            else nt[i]=0;\n            jp[i][0]=nt[i];\n        }\n        for(int j=1;j<20;++j)\n            for(int i=1;i<=l;++i)\n                jp[i][j]=jp[jp[i][j-1]][j-1];\n        int ans=1;\n        for(int i=2;i<=l;++i)\n        {\n            int tt=i;\n            for(int j=19;j>=0;--j)\n                if(jp[tt][j]*2>i)tt=jp[tt][j];\n            int gg=0;\n            for(int j=19;j>=0;--j)\n                if(jp[tt][j])gg+=1<<j,tt=jp[tt][j];\n            ans=1ll*ans*(gg+1)%MOD;\n        }\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```\n\n---\n\n\u7136\u540e\u6211\u5f88\u4e0d\u723d\n\n\u628a\u500d\u589e\u6570\u7ec4\u7684\u4e24\u7ef4\u53cd\u4e86\u8fc7\u6765\uff0c\u9632\u6b62\u53cd\u590d\u6a2a\u8df3\n\n\u7136\u540e\u6211\u5c31$AC$\u4e86\uff1f\uff1f\uff1f\n\n~~\u53c8\u4e00\u6b21\u611f\u53d7\u5230\u7384\u5b66\u5f3a\u5927\u7684\u529b\u91cf~~\n\n\n\u8fd9\u4e2a$O(Tnlogn)$\u7684\u590d\u6742\u5ea6\u679c\u7136\u5f88\u5bf9\u5440\u3002\u3002\u3002\n\n\u66b4\u529b\u80fdAC\uff1f\uff1f\uff1f\uff1a\n\n\uff08BZOJ\u4e0a\u90fd\u80fdAC\uff1f\uff1f\uff1f\uff09\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<set>\n#include<map>\n#include<vector>\n#include<queue>\nusing namespace std;\n#define MOD 1000000007\nchar s[1200000];\nint nt[1200000];\nint jp[21][1200000];\nint main()\n{\n    int T;\n    scanf(\"%d\",&T);\n    while(T--)\n    {\n        scanf(\"%s\",s+1);\n        nt[1]=0;\n        int l=strlen(s+1);\n        for(int i=2;i<=l;++i)\n        {\n            int j=nt[i-1];\n            while(j&&s[i]!=s[j+1])j=nt[j];\n            if(s[i]==s[j+1])nt[i]=j+1;\n            else nt[i]=0;\n            jp[0][i]=nt[i];\n        }\n        for(int j=1;j<20;++j)\n            for(int i=1;i<=l;++i)\n                jp[j][i]=jp[j-1][jp[j-1][i]];\n        int ans=1;\n        for(int i=2;i<=l;++i)\n        {\n            int tt=i;\n            for(int j=19;j>=0;--j)\n                if(jp[j][tt]*2>i)tt=jp[j][tt];\n            int gg=0;\n            for(int j=19;j>=0;--j)\n                if(jp[j][tt])gg+=1<<j,tt=jp[j][tt];\n            ans=1ll*ans*(gg+1)%MOD;\n        }\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n\n```\n\n~~\u6211\u7684\u590d\u6742\u5ea6\u8fd8\u662f\u592a\u5f31\u4e86~~\n\n\n~~\u8fd9\u662f\u4e00\u7bc7\u6765\u81ea\u849f\u84bb\u7684\u9898\u89e3~~\n",
        "postTime": 1515933009,
        "uid": 21283,
        "name": "yybyyb",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "~~\u52a8\u7269\u56ed\u662f\u4e2a\u597d\u5730\u65b9~~\n\n\u5728\u505a\u9898\u4e4b\u524d\uff0c\u8bf7\u5927\u5bb6\u6ce8\u610f\u4e00\u4e2a\u4e8b\u60c5\uff1a\u5b57\u7b26\u578b\u6570\u7ec4\u6570\u4e0d\u53ef\u4ee5\u901a\u8fc7$memset$\u51fd\u6570\u6e050\u7684\uff0c\n\u56e0\u4e3a\u5373\u4f7f\u53ea\u662f\u628a\u5185\u5b58\u6e05\u7a7a\uff0c\u4e5f\u4f1a\u5f15\u8d77\u7ffb\u8f66\uff0c\uff08\u8be6\u89c1\u672c\u4eba\u7b2c\u4e00\u6b21\u63d0\u4ea4\u7684\u4ee3\u7801\uff09\n\n------------\n\u7136\u540e\u6211\u4eec\u6765\u770b\u9898\uff0c\u8fd9\u9053\u9898\uff0c\u4e4d\u4e00\u770b\u8fd8\u4ee5\u4e3a\u662f~~\u770b\u6bdb\u7247~~KMP\u88f8\u9898\uff0c\u4f46\u8ba1\u7b97\u4e86\u4e00\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u6211\u4eec\u679a\u4e3e\u6bcf\u4e00\u4e2a$i$\u7136\u540e\u8ba9$next$\u6570\u7ec4\uff08\u5931\u914d\u51fd\u6570\uff09\u4e00\u76f4\u5411\u524d\u8dd1\uff0c\u7136\u540e\u66b4\u529b\u7edf\u8ba1$num$\u6570\u7ec4\u4e00\u76f4\u5411\u524d\u8dd1\uff0c\u5c31\u4f1aTLE\u3002 \n\n**\u4e0d\u4f1aKMP\u7684\u7ae5\u978b\u770b\u8fd9\u91cc**:\n[KMP\u7b97\u6cd5](http://www.matrix67.com/blog/archives/115)matrix67\u7684\u6587\u7ae0\uff0c\u5199\u7684\u5f88\u597d\n\n\n\u6240\u4ee5\u8fd9\u4e48\u505a\u80af\u5b9a\u4e0d\u884c\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u4f7f\u7528\u66f4\u4f18\u79c0\u7684\u7b97\u6cd5\n\n\u6211\u4eec\u4ece\u66b4\u529b\u5f00\u59cb\u4e00\u70b9\u4e00\u70b9\u7684\u4f18\u5316**\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u9898\u76ee\u7684\u5173\u952e\u662f\u524d\u540e\u4e24\u4e2a\u5b57\u7b26\u4e32\uff08\u524d\u7f00\u4e0e\u540e\u7f00\uff09\u4e0d\u53ef\u4ee5\u91cd\u5408**\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u5148\u5ffd\u7565\u6389\u8fd9\u4e00\u4e2a\u6761\u4ef6\uff0c\u6c42\u51fa\u6709\u4ea4\u53c9\u7684$num1$\u6570\u7ec4\uff0c\u90a3\u4e48\u663e\u800c\u6613\u89c1\u7684$num$\u6570\u7ec4\n\u5c31\u662fnum[i]=num[j]\uff08j\u662f\u5c0f\u4e8ei\u7684\u4e00\u534a\u7684\u90a3\u4e2a\u6570\uff09\n\n\u90a3\u4e48\u672c\u9898\u7684\u91cd\u70b9\u4fbf\u5230\u4e86\u6c42\u51fa$num1$\u6570\u7ec4\u4e86\uff0c\u7136\u800c\u663e\u800c\u6613\u89c1\u7684\u53ea\u8981\u5728\u6c42KMP\u7684\u65f6\u5019\u987a\u4fbf**\u9012\u63a8**\u6c42\u51fa\u4fbf\u53ef\u4ee5\u4e86\uff0c\u5176\u4e2d\u8981\u6ce8\u610f\u7684\u662fnum\u6570\u7ec4\u7684\u521d\u503c**\u4e0b\u6807\u4e3a0\u7684\u662f0\uff0c\u4e0b\u6807\u4e3a\u4e00\u7684\u4e3a1**\u8fd8\u6709\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u4e0b\u6807\u662f\u4ece\u4e00\u5f00\u662f\u7684\uff0c\u8fd9\u4e2a\u76f8\u4fe1\u5927\u5bb6\u90fd\u77e5\u9053\u4e86\uff0c\u5982\u679c\u60a8\u60f3\u628a\u4e0b\u6807\u6539\u4e3a\u4ece\u4e00\u5f00\u59cb\u7684\u8bdd\u4e0d\u59a8\u8bd5\u8bd5\u8fd9\u4e2a\n**scanf(\"%s\",s+1);**\u975e\u5e38\u597d\u7528\u3002\n\n\u5982\u56fe\n```cpp\nvoid kmp()\n{\n\tj=0;\n\tfor(int i=1;i<la;i++)\n\t{\n\t\twhile(j&&a[j]!=a[i])  j=next[j];\n\t\tif(a[j]==a[i])  j++;\n\t\tnext[i+1]=j;num1[i+1]=num1[j]+1;\n\t}\n}\n```\n\n\u7136\u540e\u7531\u4e8e$num$\u6570\u7ec4\u7528\u4e86\u5c31\u6254\uff0c**\u6240\u4ee5\u5c31\u6839\u672c\u4e0d\u7528\u6c42\u51fa\u6765\uff01\uff01**\n\n\u53ea\u9700\u8981\u8ba9\u6211\u4eec\u8bb0\u5f55\u7b54\u6848\u7684\u90a3\u4e2a\u6570\u76f4\u63a5\u4e58\u4e0a\u6c42\u51fa\u7684\u6570\u5c31\u597d\u4e86\uff08\u4e00\u5b9a\u8981\u5f00long long \uff09\n\u4e0d\u7136\u5c0f\u5fc3\u7206\u70b8**~~\uff08BOOM\uff09~~**\n\n\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\n```cpp\nfor(int i=1;i<la;i++)\n\t\t{\n\t\t\twhile(a[j]!=a[i]&&j) j=next[j];\n\t\t\tif(a[i]==a[j]) j++;\n\t\t\twhile((j<<1)>i+1)   j=next[j];\n\t\t\tans*=(num1[j]+1);\n\t\t\tans%=mod;\n\t\t}\n```\n\n\n\u6700\u540e\uff0c\u518d\u628aAC\u4ee3\u7801\u6beb\u4e0d\u541d\u556c\u5730\u5949\u732e\u51fa\u6765\uff01\uff01(\u65f6\u95f4\u590d\u6742\u5ea6O(n)\uff0c\u8bf7\u653e\u5fc3\u9605\u8bfb)\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst long long mod=1000000007;\n\nint n;\nchar a[1000010]={};\nint la;\nint next[1000010]={};\nlong long num1[1000010]={};\nint j;\n\nvoid kmp()\n{\n\tj=0;\n\tfor(int i=1;i<la;i++)\n\t{\n\t\twhile(j&&a[j]!=a[i])  j=next[j];\n\t\tif(a[j]==a[i])  j++;\n\t\tnext[i+1]=j;num1[i+1]=num1[j]+1;\n\t}\n}\n\nint main()\n{\n\tscanf(\"%d\",&n);\n\twhile(n--)\n\t{\n//\t\tmemset(num1,0,sizeof(num1));\n\t\tmemset(next,0,sizeof(next));\n//\t\tmemset(a,0,sizeof(a));//\u7ffb\u8f66\u73b0\u573a\n\t\tscanf(\"%s\",a);\n\t\tla=strlen(a);\n\t\tnum1[0]=0;\n\t\tnum1[1]=1;\n\t\tkmp();\n\t\tj=0;\n\t\tlong long ans=1;\n\t\tfor(int i=1;i<la;i++)\n\t\t{\n\t\t\twhile(a[j]!=a[i]&&j) j=next[j];\n\t\t\tif(a[i]==a[j]) j++;\n\t\t\twhile((j<<1)>i+1)   j=next[j];\n\t\t\tans*=(num1[j]+1);\n\t\t\tans%=mod;\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1530964394,
        "uid": 103762,
        "name": "Wow_Goodjob",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "\u8d34\u4e00\u4e2az-box\u505a\u6cd5\u7684\u9898\u89e3\u3002\n\n\u6211\u4eec\u7528z-box\u7b97\u6cd5\u6c42\u51fa\u6bcf\u4e2a\u540e\u7f00\u4e0e\u539f\u4e32\u7684lcp\uff0c\u7136\u540e\u5f88\u8f7b\u677e\u7684\u5229\u7528\u5dee\u5206\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\nz-box\u7b97\u6cd5\u53ef\u4ee5\u5728O(N)\u7684\u65f6\u95f4\u5185\u6c42\u51fa\u6bcf\u4e2a\u540e\u7f00\u4e0e\u539f\u4e32\u7684lcp\uff0c\u4ed6\u7c7b\u4f3c\u4e8e\u9a6c\u62c9\u8f66\u7b97\u6cd5\uff0c\u4e5f\u662f\u9012\u63a8\u5730\u6c42\u89e3\u3002\n\n\u5047\u8bbe\u6211\u4eec\u8981\u6c42\u7b2ci\u4e2a\u540e\u7f00\u7684lcp\uff0c\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u6765\u524di-1\u4e2a\uff0c\u7ef4\u62a4\u5339\u914dlcp\u4e00\u4e2a\u6700\u53f3\u7aef\u7684\u6307\u9488\uff0c\u8bb0\u6b64\u65f6\u7684\u540e\u7f00\u4e3apos\uff0c\u539f\u4e32\u4e3as\u3002pos+lcp[pos]-1\u662fmax(j+lcp[j]-1) {j<i}\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0i\u5982\u679c\u4f4d\u4e8epos+lcp[pos]-1\u7684\u5de6\u9762\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e4b\u524d\u7684\u7ed3\u679c\u66f4\u65b0\u5f53\u524d\u7684lcp\uff0c\u7136\u540e\u518d\u66b4\u529b\u6269\u5c55\uff0c\u968f\u65f6\u66f4\u65b0\u4e00\u4e0b\u6307\u9488\uff0c\u548c\u9a6c\u62c9\u8f66\u5176\u5b9e\u662f\u4e00\u4e2a\u9053\u7406\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1000005;\nconst int mod=1e9+7;\nchar s[N];\nint r,pos,lcp[N],t[N];\nint main()\n{\n\tint T;scanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tmemset(lcp,0,sizeof lcp);\n\t\tmemset(t,0,sizeof t);\n\t\tpos=r=0;\n\t\tscanf(\"%s\",s+1);\n\t\tint len=strlen(s+1);\n\t\tfor(int i=2;i<=len;++i)\n\t\t{\n\t\t\tif(pos==0)\n\t\t\t{\n\t\t\t\tint p=1;\n\t\t\t\twhile(s[p+lcp[i]]==s[i+lcp[i]]) ++lcp[i];\n\t\t\t\tif(lcp[i]) r=i+lcp[i]-1,pos=i;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(i>r)\n\t\t\t{\n\t\t\t\tint p=1;\n\t\t\t\twhile(s[p+lcp[i]]==s[i+lcp[i]]) ++lcp[i];\n\t\t\t\tif(lcp[i]) r=i+lcp[i]-1,pos=i;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tint npos=i-pos+1;\n\t\t\tlcp[i]=min(lcp[npos],r-i+1);\n\t\t\twhile(s[lcp[i]+1]==s[i+lcp[i]]) ++lcp[i];\n\t\t\tif(i+lcp[i]-1>r) r=i+lcp[i]-1,pos=i;\n\t\t}\n\t\tfor(int i=2;i<=len;++i)\n\t\tif(lcp[i])\n\t\tt[i]++,t[min(2*(i-1),min(len,i+lcp[i]-1))+1]--;\n\t\tfor(int i=1;i<=len;++i)\n\t\tt[i]+=t[i-1];\n\t\tlong long ans=1;\n\t\tfor(int i=1;i<=len;++i)\n\t\tans=ans*(t[i]+1)%mod;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\t\n}\n```",
        "postTime": 1520237702,
        "uid": 24553,
        "name": "fanfan",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "\u4e00\u5f00\u59cb\u5148\u5199\u4e86\u4e00\u4e2a\u88f8\u7684KMP\uff0c\u5728\u6c42next\u6570\u7ec4\uff08f\u6570\u7ec4\uff09\u7684\u65f6\u5019\u52a0\u4e86\u4e00\u4e2a\u5224\u65adj<<1\u662f\u5426>i+1\uff08\u82e5\u5927\u4e8e\u5219\u8bf4\u660e\u6709\u91cd\u53e0\u90e8\u5206\uff09\uff0c\u540e\u6765\u53d1\u73b0\u5e76\u4e0d\u80fd\u8fd9\u6837\u505a\u3002\u56e0\u4e3a\u8fd9\u6837\u4f1a\u5f71\u54cd\u5230\u540e\u9762next\u6570\u7ec4\u7684\u6c42\u503c\u3002\u540e\u6765\u770b\u4e86\u4e00\u4e2a\u9898\u89e3\uff0c\u91cc\u9762\u7684\u601d\u8def\u662f\u91cd\u65b0\u505a\u4e00\u904d\u6c42next\u7684\u8fc7\u7a0b\uff0c\u540c\u65f6\u518d\u5224\u65ad\u662f\u5426\u8d85\u8fc7\u4e00\u534a\u3002\n\n\u91cd\u70b9\u662f\u5728num\u6570\u7ec4\uff0c\u7528\u6765\u5b58\u50a8\u5931\u914d\u7684\u6b21\u6570\u3002\u7b97\u662f\u4e00\u4e2a\u6bd4\u8f83\u5de7\u5999\u7684\u5730\u65b9\u5427\u3002\n\n\u7a0b\u5e8f\u53c2\u8003\u4e86\u4e00\u4e2a\u535a\u5ba2\uff1ahttp://blog.csdn.net/zhaoyh2000/article/details/54866734\n\n```cpp\n#define maxl 1000000+1\n#define mod 1000000007\n#include<string>\n#include<iostream>\nusing namespace std;\nint n,f[maxl],num[maxl];\nstring s;\nint main() {\n    ios::sync_with_stdio(false);\n    cin>>n;\n    while(n--) {\n        cin>>s;\n        f[0]=-1;\n        f[1]=0;\n        num[0]=0;\n        num[1]=1;\n        int j=0;\n        unsigned long long ans=1ull;\n        for(int i=1;i<(int)s.length();i++) {\n            while(j>=0&&s[i]!=s[j]) j=f[j];\n            f[i+1]=++j;\n            num[i+1]=num[j]+1;\n        }\n        j=0;\n        for(int i=1;i<(int)s.length();i++) {\n            while(j>=0&&s[i]!=s[j]) j=f[j];\n            j++;\n            while((j<<1)>(i+1)) j=f[j];\n            ans*=(unsigned long long)num[j]+1;\n            ans%=mod;\n        }\n        cout<<ans<<endl;\n    }\n    return 0;\n}\n```",
        "postTime": 1488976376,
        "uid": 10086,
        "name": "skylee",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2375 \u3010\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "## \u9898\u610f\n\n\u539f\u9898\u8bf7\u770b <https://www.luogu.org/problemnew/show/P2375>\n\n### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u5b57\u7b26\u4e32 $S$\uff0c \u6c42 $\\sum (num_i+1)$ \uff0c\u5176\u4e2d\u5bf9\u4e8e\u5b57\u7b26\u4e32 $S$ \u7684\u524d $i$ \u4e2a\u5b57\u7b26\u6784\u6210\u7684\u5b50\u4e32\uff0c\u65e2\u662f\u5b83\u7684\u540e\u7f00\u540c\u65f6\u53c8\u662f\u5b83\u7684\u524d\u7f00\uff0c\u5e76\u4e14\u8be5\u540e\u7f00\u4e0e\u8be5\u524d\u7f00\u4e0d\u91cd\u53e0\uff0c\u5c06\u8fd9\u79cd\u5b57\u7b26\u4e32\u7684\u6570\u91cf\u8bb0\u4f5c $num_i$ \n\n## \u9898\u89e3\n\n\u6839\u636e $KMP$ \u7b97\u6cd5\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u5b57\u7b26\u4e32 $S$ \u7684\u524d $i$ \u4e2a\u5b57\u7b26\u6784\u6210\u7684\u5b50\u4e32\uff0c\u65e2\u662f\u5b83\u7684\u540e\u7f00\u540c\u65f6\u53c8\u662f\u5b83\u7684\u524d\u7f00\u7684\u4e32\u7684\u96c6\u5408\u5c31\u662f $A = \\{next_i, next_{next_i}, \\dots 0\\}$. \n\n\u90a3\u4e48\u5982\u679c\u4e0d\u8003\u8651**\u4e0d\u91cd\u53e0**\u8fd9\u4e2a\u9650\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $cnt_i = |A|$\uff0c$cnt_i$ \u53ef\u4ee5\u901a\u8fc7 $cnt_i = cnt_{next_i} + 1$ \u5728\u7ebf\u6027\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u9012\u63a8\u6c42\u51fa. \u90a3\u4e48\u5982\u4f55\u8003\u8651\u8fd9\u4e2a\u9650\u5236\u5462?\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c$Next_i$ \u5c31\u76f8\u5f53\u4e8e\u8868\u793a\u4e86\u70b9 $i$ \u7684\u7236\u4eb2\uff0c \u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709 $Next_i$ \u5f62\u6210\u4e86\u4e00\u68f5\u6811\uff08$Next_i$ \u8868\u793a\u70b9 $i$ \u7684\u7236\u4eb2\uff09\uff0c\u800c\u6211\u4eec\u8981\u6c42\u7684 $ans_i$ \u5c31\u76f8\u5f53\u4e8e\u70b9 $i$ \u5230\u6839\u7684\u8def\u5f84\u4e0a\u6ee1\u8db3\u6df1\u5ea6 $\\leq \\lfloor {i \\over 2} \\rfloor$\u7684\u70b9\u7684\u4e2a\u6570.  \n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u8003\u8651**\u500d\u589e\u540e\u4e8c\u5206**\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $i$\uff0c\u627e\u5230 $pos = max\\{x \\in A \\, | \\, x \\leq \\lfloor {i \\over 2}\\rfloor\\}$ \uff0c\u90a3\u4e48 $num_i = cnt_{pos} - 1$\uff0c\u8fd9\u4e2a\u6c42\u89e3\u6700\u5927\u503c\u7684\u65b9\u6cd5\u53ef\u4ee5\u5229\u7528\u7c7b\u4f3c\u6c42 $LCA$ \u7684\u65b9\u6cd5\u901a\u8fc7\u500d\u589e\u6765\u5b9e\u73b0 $O(\\log n)$ \u7684\u4e8c\u5206\uff0c\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\u8fd9\u6837\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(n \\log n)$ . \u8fd9\u4e2a\u7b97\u6cd5\u662f**\u80fd\u591f\u901a\u8fc7**\u7684\uff0c\u4f46\u662f\u9700\u8981\u4e00\u4e9b\u5361\u5e38\u7684\u6280\u5de7\uff0c\u6bd4\u5982\u2026\u2026\n\n> \u500d\u589e\u7684\u6570\u7ec4\u53ef\u4ee5\u662f\u8fd9\u6837\u7684\uff1a$fa[N][LOGN]$\uff0c\u4e5f\u53ef\u4ee5\u662f\u8fd9\u6837\u7684\uff1a$fa[LOGN][N]$\n>\n> \u4f46\u662f\u524d\u8005\u6bd4\u540e\u8005\u6162**\u5f88\u591a**\uff01\uff01\uff01\u8fd9\u70b9\u5728 $N$ \u6bd4\u8f83\u5927\u7684\u65f6\u5019\u5c24\u4e3a\u660e\u663e.\n>\n> **\u6d4b\u8bd5\u4fe1\u606f**\n>\n> \u672c\u4eba\u7531\u4e8e\u592a\u61d2\uff0c\u4e0d\u60f3\u4f7f\u7528 $NOI \\ Linux$\uff0c\u6240\u4ee5\u5c31\u7528\u4e86**\u6d1b\u8c37**\u3002\u603b\u8ba1 $5$ \u7ec4\u6570\u636e\uff0c\u6bcf\u7ec4\u6570\u636e\u90fd\u662f $5$ \u4e2a\u957f\u5ea6\u4e3a $10^6$ \u7684\u5168 $a$ \u4e32\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u65f6\u95f4\u76f8\u5dee\u4e86**\u63a5\u8fd1 $3$ \u500d**\u3002\n>\n> ![https://cdn.luogu.com.cn/upload/pic/47252.png](https://cdn.luogu.com.cn/upload/pic/47252.png)\n\n------\n\n\u8fd9\u6837\u867d\u7136\u53ef\u4ee5\u5361\u8fc7\uff0c\u4f46\u662f\u4e0d\u591f\u4f18\u79c0\uff0c\u8fd9\u9053\u9898\u662f\u6709 $O(n)$ \u7684\u7b97\u6cd5\u7684. \u53ef\u662f\u4f18\u5316\u7684\u52a8\u673a\u5728\u54ea\u91cc\u5462\uff1f\n\n\u5176\u5b9e\u4e0a\u9762\u7684\u7b97\u6cd5\u4e2d\uff0c\u500d\u589e\u672c\u8d28\u4e0a\u662f\u7528\u6765\u4f18\u5316\u4e00\u4e2a\u4ece\u70b9 $i$ \u5f80\u4e0a\u8df3\u7684\u8fc7\u7a0b\uff0c\u4e00\u4e2a\u66b4\u529b\u5f80\u4e0a\u8df3\u7684\u8fc7\u7a0b\uff1b\u5982\u679c\u8fd9\u9053\u9898\u4e2d\u8fd9\u68f5\u6811\u5c31\u662f\u666e\u901a\u7684\u6811\uff08*\u6307\u6ca1\u6709\u5176\u5b83\u6027\u8d28\uff0c\u8282\u70b9\u7f16\u53f7\u4e5f\u662f\u4e71\u7684*\uff09\uff0c\u6211\u4eec\u53d1\u73b0\u662f\u5f88\u96be\u4f18\u5316\u5230 $O(n)$ \u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u4e00\u4e9b $Next_i$ \u6570\u7ec4\u7684\u7279\u6b8a\u6027\u8d28\u3002\n\n\u800c\u6211\u4eec\u8981\u5229\u7528\u7684\u6027\u8d28\uff0c\u662f\u4e00\u4e2a\u975e\u5e38\u663e\u7136\u800c\u7b80\u5355\u7684\u6027\u8d28\uff1a$Next_i \\lt i$\uff0c\u8fd9\u4e2a\u6027\u8d28\u7531 $Next_i$ \u7684\u5b9a\u4e49\u4fdd\u8bc1\uff1b\u8fd9\u4e2a\u6027\u8d28\u5728\u6811\u4e0a\u7684\u8868\u73b0\u662f\u4ec0\u4e48\u5462\uff1f\u5c31\u662f**\u7236\u4eb2\u8282\u70b9\u7684\u7f16\u53f7\u4e00\u5b9a\u6bd4\u5176\u513f\u5b50\u8282\u70b9\u7684\u7f16\u53f7\u8981\u5c0f**\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a\n\n> \u6211\u4eec\u6df1\u641c\u6811\u7684\u540c\u65f6\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6808\uff0c\u4e2d\u95f4\u6709\u4e00\u4e2a\u6307\u9488\uff0c\u5b83\u6307\u5411\u7684\u6570\u662f\u6808\u4e2d\u4e8c\u500d\u4e0d\u8d85\u8fc7x\u7684\u6700\u5927\u503c\u3002\u7531\u4e8e\u8fd9\u4e2a\u6808\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6240\u4ee5\u6307\u9488\u53ea\u8981\u5de6\u53f3\u79fb\u52a8\u3002$ans_i$ \u5c31\u662f\u52a0\u5165 $i$ \u7684\u90a3\u4e00\u523b\uff0c\u6307\u9488\u5de6\u8fb9\u7684\u6570\uff08\u5305\u62ec\u6307\u9488\u6240\u6307\u7684\u6570\uff09\u7684\u4e2a\u6570+1.\n>\n> \u53c2\u8003 <https://www.luogu.org/blog/user31435/solution-p2375>, \u5199\u7684\u975e\u5e38\u597d\uff0c\u7528 $DFA$ \u6765\u5206\u6790\u6b64\u9898\n\n\u7531\u4e8e\u521a\u624d\u90a3\u4e2a\u6027\u8d28\u6211\u4eec\u53ef\u4ee5\u4fdd\u8bc1\u4e2d\u95f4\u90a3\u4e2a\u6307\u9488\u53ea\u4f1a\u5411\u53f3\u79fb\u52a8\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u505a\u5230\u5728 $O(n)$ \u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5f97\u5230\u7b54\u6848\u3002\n\n",
        "postTime": 1546149602,
        "uid": 31635,
        "name": "yingjz",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "\u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\u3002\n\n\u5047\u8bbe\u4e00\u4e2a\u5b57\u7b26\u4e32\u957f\u5ea6\u4e3an\uff0c\u6709\u70b90,1,...,n\uff0c\u5982\u679c\u8bfb\u5165s[i]\uff0c\u5c31\u80fd\u4ece\u70b9i\u8d70\u5230\u70b9i+1\uff0c\u8fd9\u6837\u8bfb\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u67d0\u4e2a\u5b50\u4e32\uff0c\u5c31\u80fd\u4ece\u67d0\u4e2a\u70b9\u8d70\u5230\u53e6\u4e00\u4e2a\u70b9\u3002\n\n\u4ecenext[i]\u5411i\u8fde\u5355\u5411\u8fb9\uff0c\u8fd9\u6837\u5f62\u6210\u4e86\u4e00\u5f20\u56fe\u3002\u9664\u4e86\u70b90\u7684\u5165\u5ea6\u4e3a0\u5916\uff0c\u5176\u4f59\u6240\u6709\u70b9\u7684\u5165\u5ea6\u5747\u4e3a1.\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u5f20\u56fe\u662f\u4ee50\u4e3a\u6839\u7684\u4e00\u68f5\u6811\u3002\n\n\u6709\u4e00\u4e2a\u4e32abacaba\uff0c\u6211\u4eec\u77e5\u9053next[3]=1\uff0c\u800c\u8bfb\u5165\u5b50\u4e32a\u65e2\u80fd\u4ece0\u8d70\u52301\uff0c\u53c8\u80fd\u4ece2\u8d70\u52303.\u540c\u6837\u7684\uff0cnext[7]=3\uff0c\u800c\u8bfb\u5165\u5b50\u4e32aba\u65e2\u80fd\u4ece0\u8d70\u52303\uff0c\u53c8\u80fd\u4ece4\u8d70\u52307.\u7ecf\u89c2\u5bdf\uff0c\u6211\u4eec\u53d1\u73b0\uff0cnext[next[7]]=1\uff0c\u800c\n\u4ece0\u8d70\u52301\u548c\u4ece6\u8d70\u52307\u8981\u7ecf\u8fc7\u76f8\u540c\u7684\u5b57\u7b26\u3002\n\n\u4ece\u4ee5\u4e0a\u7ecf\u9a8c\u51fa\u53d1\uff0c\u53ef\u4ee5\u8bc1\u660e\uff0c\u5982\u679c\u4ece\u70b9i\u51fa\u53d1\u80fd\u8d70\u5230x\uff0c\u539f\u4e32\u7684\u957f\u5ea6\u4e3ax\u7684\u524d\u7f00\u4ee3\u8868\u7684\u5b57\u7b26\u4e32\u4e2d\uff0c\u957f\u5ea6\u4e3ai\u7684\u524d\u7f00\u90fd\u548c\u957f\u5ea6\u4e3ai\u7684\u540e\u7f00\u6070\u597d\u76f8\u7b49\u3002\n\n\u8fd9\u6837\uff0c\u80fd\u4f7fnum[x]\u589e\u52a01\u7684\u70b9\u5fc5\u987b\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a\n\n<1>\u5728\u6811\u4e0a\uff0c\u5b83\u662fx\u7684\u7956\u5148\u3002\n\n<2>\u5b83\u7684\u4e8c\u500d\u4e0d\u8d85\u8fc7x\u3002\n\n\u6211\u4eec\u6df1\u641c\u6811\u7684\u540c\u65f6\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6808\uff0c\u4e2d\u95f4\u6709\u4e00\u4e2a\u6307\u9488\uff0c\u5b83\u6307\u5411\u7684\u6570\u662f\u6808\u4e2d\u4e8c\u500d\u4e0d\u8d85\u8fc7x\u7684\u6700\u5927\u503c\u3002\u7531\u4e8e\u8fd9\u4e2a\u6808\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6240\u4ee5\u6307\u9488\u53ea\u8981\u5de6\u53f3\u79fb\u52a8\u3002num[x]\u5c31\u662f\u52a0\u5165x\u7684\u90a3\u4e00\u523b\uff0c\u6307\u9488\u5de6\u8fb9\u7684\u6570\uff08\u5305\u62ec\u6307\u9488\u6240\u6307\u7684\u6570\uff09\u7684\u4e2a\u6570+1.\n\n\u53ef\u4ee5\u8bc1\u660e\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u7684\u590d\u6742\u5ea6\u662fO(n)\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<math.h>\nusing namespace std;\n\nconst long long mod=1e9+7;\nint T,n;\nint E,ot[2000005],ne[2000005],g[1000005],fa[1000005];\nint stack[1000005],ltl,rtl;\nlong long ans;\nchar s[10000005];\n\nvoid clear()\n{\n\tint i;\n\tfor(i=0;i<=n;++i) g[i]=0;\n\tE=0,ans=1;\n}\n\nvoid add(int u,int v)\n{\n\tot[++E]=v;\n\tne[E]=g[u];\n\tg[u]=E;\n}\n\nvoid build()\n{\n\tint i,j;\n\tfa[1]=0;\n\tadd(0,1),add(1,0);\n\tfor(i=1,j=0;i<n;++i)\n\t{\n\t\twhile(j&&s[i]!=s[j]) j=fa[j];\n\t\tif(s[i]==s[j]) ++j;\n\t\tfa[i+1]=j;\n\t\tadd(i+1,j),add(j,i+1);\n\t}\n}\n\nvoid dfs(int x,int fath)\n{\n\tint p,to;\n\tif(x)\n\t{\n\t\tstack[++rtl]=x;\n\t\twhile((stack[ltl]<<1)<=x) ++ltl;\n\t\twhile((stack[ltl]<<1)>x) --ltl;\n\t\tans*=ltl;\n\t\tans%=mod;\n\t}\n\tfor(p=g[x];p;p=ne[p])\n\t{\n\t\tto=ot[p];\n\t\tif(to==fath) continue;\n\t\tdfs(to,x);\n\t}\n\t--rtl;\n}\n\nint main()\n{\n\tint i;\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tclear();\n\t\tscanf(\"%s\",&s);\n\t\tn=strlen(s);\n\t\tbuild();\n\t\tltl=rtl=1,stack[ltl]=0;\n\t\tdfs(0,-1);\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1533375786,
        "uid": 31435,
        "name": "hwk0518",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "## \u672c\u9898\u7684~~\u6307\u7eb9~~hash\u89e3\u6cd5\n\n---\n\n\u535a\u5ba2\u94fe\u63a5[\u8fd9\u91cc](https://blog.csdn.net/avenLJY/article/details/104668783)\n\n----\n\u4f5c\u8005\u7531\u4e8e\u53ea\u6709CSPJ\u6c34\u5e73\uff0c\u6240\u4ee5\u6839\u672c\u60f3\u4e0d\u51faKMP\u6216\u8005\u4ec0\u4e48\u81ea\u52a8\u673a\u89e3\u6cd5\u3002\u53ea\u4f1ahash+\u4e8c\u5206\n\n\u867d\u7136\u8be5\u7b97\u6cd5\u590d\u6742\u5ea6\u4e3a $O(Tnlogn)$,\u4f46\u662f\u5e38\u6570\u5c0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\u3002\n\n--------\n\n\u8003\u8651 $j>i$\uff0c\u5982\u679c $i-j$ \u8fd9\u4e2a\u5b57\u7b26\u4e32\u540c\u65f6\u662f\u4e32 $1--j$ \u7684\u524d\u7f00\u548c\u540e\u7f00\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u4f4d\u7f6e $i$ \u5bf9 $num[j]$ \u505a\u51fa\u4e861\u7684\u8d21\u732e\u3002\n\n\u7136\u540e\u6211\u4eec\u679a\u4e3e $i$\uff0c\u770b\u5b83\u53ef\u4ee5\u5bf9\u54ea\u4e9b $num[j]$ \u4ea7\u751f\u8d21\u732e\u3002\u5bb9\u6613\u53d1\u73b0\u5982\u679c $k<j$ \u4e14 $i$\u5bf9 $num[j]$ \u4ea7\u751f\u4e86\u8d21\u732e\uff0c\u90a3\u4e48 $i$ \u4e5f\u4e00\u5b9a\u4f1a\u5bf9$num[k]$ \u4ea7\u751f\u8d21\u732e\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u51fa\u4e00\u4e2a $x$\uff0c\u4f7f\u5f97 $i$ \u5bf9 $num[i]--num[k]$ \u4ea7\u751f\u8d21\u732e\uff0c\u4e14\u4e0d\u4f1a\u5bf9 $num[k+1]--num[n]$ \u4ea7\u751f\u8d21\u732e\u3002\n\n\u7136\u540e\u8003\u8651\u4e8c\u5206\u8fc7\u7a0b\u4e2d\u5982\u4f55 $check$ $i$\u662f\u5426\u5bf9\u5f53\u524d\u7684 $mid$ \uff08\u6211\u8bbe\u7684 $mid$ \u662f $j--i+1$ \u7684\u503c\u5373\u524d/\u540e\u7f00\u7684\u957f\u5ea6\uff09\u4ea7\u751f\u8d21\u732e\uff1a\u7528hash\u5224\u65ad\u4e00\u4e0b\u5b57\u7b26 $1--mid$ \u7ec4\u6210\u7684\u5b57\u7b26\u4e32\u548c\u5b57\u7b26 $x--x+mid-1$\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u540c\u5c31\u53ef\u4ee5\u4e86\u3002\u7136\u540e\u7edf\u8ba1\u7b54\u6848\u5c31\u7528\u5dee\u5206\u6570\u7ec4\u4e71\u641e\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u679a\u4e3e $i$ \u662f $O(n)$ \u7684\uff0c\u4e8c\u5206\u662f $(logn)$ \u7684\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u4e3a $O(Tnlogn)$\uff0c\u56e0\u4e3a\u5e38\u6570\u5c0f\u53ef\u4ee5\u901a\u8fc7\u3002\n\n---\n\u4e0a\u6587\u4e2d\u7684--\u53ef\u4ee5\u7406\u89e3\u4e3a~\uff0c\u56e0\u4e3a\u4f5c\u8005\u5bf9markdown\u592a\u4e0d\u4e86\u89e3\u6240\u4ee5\u53ea\u80fd\u8fd9\u4e48\u5199\u4e86\u3002\n\n\u6392\u7248\u5f88\u4e11\uff0c\u8868\u8ff0\u5f88\u5783\u573e\uff0c\u4ee3\u7801\u4e5f\u4e11\uff0c\u5e0c\u671b\u8f7b\u55b7\u3002\n\n---\ncode:\n\n```\n#include<bits/stdc++.h> \nusing namespace std;\nconst int N=1e6+5,mod=1e9+7,md=19260817;char c[N];int hash[N],n,pre[N],pows[N];\ninline void work(int x){\n\tif(c[x]!=c[1])return ;int l=1,r=min(x-1,n-x+1);\n\twhile(l<r){int mid=l+r+1>>1; \n\t\tif((hash[x+mid-1]-(long long)hash[x-1]*(long long)pows[mid]%md+md)%md==hash[mid])l=mid;else r=mid-1;\n\t}++pre[x];--pre[x+l];\n}\nsigned main(){\n\tint t;scanf(\"%d\",&t);while(t--){\n\t\tscanf(\"%s\",c+1);n=strlen(c+1);pows[0]=1;memset(pre,0,sizeof(pre)); \n\t\tfor(int i=1;i<=n;++i)hash[i]=(hash[i-1]*26+c[i]-'a')%md,pows[i]=pows[i-1]*26%md;\n\t\tfor(int i=2;i<=n;++i)work(i);for(int i=1;i<=n;++i)pre[i]+=pre[i-1];\n\t\tlong long ans=1;for(int i=2;i<=n;++i)ans=ans*((long long)pre[i]+1ll)%mod;\n\t\tprintf(\"%lld\\n\",ans);\n\t}return 0; \n} \n```\n\u4ee3\u7801\u4e2d\u7684hash\u5c31\u662fhash\u503c\uff0cpow[i]\u662f26\u7684i\u6b21\u65b9\u3002\u7136\u540epre\u662fnum\u7684\u5dee\u5206\u6570\u7ec4\u3002\u4e2a\u4eba\u8ba4\u4e3a\u4ee3\u7801\u5f88\u597d\u7406\u89e3\u3002",
        "postTime": 1583375031,
        "uid": 86579,
        "name": "zmx_wzx_JY",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\uff1a\n\u8f93\u5165N\u7ec4\u6570\u636e\uff0c\u6bcf\u7ec4\u6570\u636e\u5305\u542b\u4e00\u4e2a\u5b57\u7b26\u4e32S,\u5bf9\u4e8e\u6bcf\u4e2aS,\u6c42\u51fa\u5b83\u7684num\u6570\u7ec4\u3002\n\nnum\u6570\u7ec4\u7684\u5b9a\u4e49\u662f\uff1a\u5b57\u7b26\u4e32S\u7684\u524di\u4e2a\u5b57\u7b26\u6784\u6210\u7684\u5b50\u4e32\uff0c\u65e2\u662f\u5b83\u7684\u540e\u7f00\u540c\u65f6\u53c8\u662f\u5b83\u7684\u524d\u7f00\uff0c\u5e76\u4e14\u8be5\u540e\u7f00\u4e0e\u8be5\u524d\u7f00\u4e0d\u91cd\u53e0\uff0c\u5c06\u8fd9\u79cd\u5b57\u7b26\u4e32\u7684\u6570\u91cf\u8bb0\u4f5cnum[i]\u3002\n\n\u4e3a\u4e86\u907f\u514d\u5927\u91cf\u7684\u8f93\u51fa\uff0c\u4f60\u4e0d\u9700\u8981\u8f93\u51fanum[i]\u5206\u522b\u662f\u591a\u5c11\uff0c\u4f60\u53ea\u9700\u8981\u8f93\u51fa\u6240\u6709(num[i]+1)\u7684\u4e58\u79ef\uff0c\u5bf91,000,000,007\u53d6\u6a21\u7684\u7ed3\u679c\u5373\u53ef\u3002\n\n## \u9898\u89e3\uff1a\n\u8fd9\u662f\u4e00\u9053\u5f88\u7ecf\u5178\u7684KMP\u3002\u8fd8\u4e0d\u4f1aKMP\u7684\u540c\u5b66\u53ef\u4ee5\u5148\u770b\u4e00\u4e0b\u8fd9\u7bc7[\u535a\u5ba2](https://blog.csdn.net/WjNaG/article/details/99238903)\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u4ecb\u7ecd\u4e86\n\n\u90a3\u4e48\u8fd9\u9053\u9898\u4e0e\u666e\u901a\u7684KMP\u6709\u4ec0\u4e48\u4e0d\u540c\u70b9\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u6700\u5927\u7684\u4e0d\u540c\u70b9\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662f\u539f\u6765\u7684next[i]\u8868\u793a\u7684\u662f\u5b57\u7b26\u4e32\u524di\u4f4d\u7684\u6700\u957f\u76f8\u540c\u524d\u540e\u7f00\uff0c\u800cnum[i]\u5374\u8981\u6c42\u51fa\u76f8\u540c\u524d\u540e\u7f00\u7684\u603b\u6570\u3002\u7b2c\u4e8c\u4e2a\u662f\uff0c\u8fd9\u91cc\u8981\u6c42\u540e\u7f00\u548c\u524d\u7f00\u4e0d\u91cd\u53e0\u3002\n\n\u53d1\u73b0\u4e86\u4e0d\u540c\u70b9\uff0c\u90a3\u4e48\u5c31\u53ea\u8981\u5728\u539f\u6765\u7684KMP\u4ee3\u7801\u4e0a\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u70b9\u5206\u522b\u6539\u52a8\u4e00\u4e0b\u5c31\u884c\u4e86\n\n\u5927\u5bb6\u90fd\u77e5\u9053(next[i]>0)\u8868\u793a\u5b57\u7b26\u4e32\u524di\u4f4d\u6709\u76f8\u540c\u524d\u540e\u7f00\uff08\u5982\u679cnext[i]=0\u5c31\u8868\u793a\u6ca1\u6709\uff09\uff0c\u800c\u5b83\u7684\u503c\u5c31\u662f\u6700\u957f\u7684\u4e00\u4e2a\u524d\u7f00\u7684\u7ed3\u5c3e\u3002\n\nOK\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u70b9\u5c31\u8fce\u5203\u800c\u89e3\u4e86\n\n\u7b2c2\u957f\u7684\u516c\u5171\u524d\u540e\u7f00\u4e00\u5b9a\u6bd4\u6700\u957f\u7684\u77ed\u5427\n\n\u90a3\u5b83\u4e00\u5b9a\u5305\u542b\u5728S[0]-S[next[i]]\u91cc\u9762\u5427\n\n\u90a3\u4e48\u8fd9\u91cc\u9762\u6700\u957f\u7684\u662f\u54ea\u4e2a\uff1f\n\n**next[next[i]]**\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0cnext[i],next[next[i]],next[next[next[next[i]]].....\u90fd\u662f\u76f8\u540c\u524d\u7f00\u7684\u7ed3\u5c3e\uff0c\u53ea\u8981\u5b83\u4eec\u4e0d\u662f0\uff0c\u5c31\u4ee3\u8868num[i]\u591a\u4e00\u4e2a\uff0c\u90a3\u4e48\u628anum[i]++\u5c31\u884c\u4e86\n\u662f\u4e0d\u662f\u611f\u89c9\u548cmanacher\u6709\u70b9\u50cf\uff1f\n\n\u8fd9\u6837\u80fd\u89e3\u51b3\u7b2c\u4e00\u4e2a\u70b9\uff0c\u4f46\u4e0d\u80fd\u89e3\u51b3\u7b2c\u4e8c\u4e2a\uff0c\u56e0\u4e3a\u8fd9\u6837\u6c42\u51fa\u6765\u7684\u524d\u540e\u7f00\u53ef\u80fd\u4f1a\u6709\u91cd\u53e0\n\n\u73b0\u5728\u89e3\u51b3\u7b2c\u4e8c\u4e2a\u70b9\u5c31\u5f88\u7b80\u5355\u5566\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u5c0f\u4e8e\u4e00\u534a\u7684num\uff0c\n```cpp\nwhile(k*2>j+1){\n\tk=next[k];\n}\n```\n\u5176\u5b83\u5c31\u548c\u666e\u901a\u7684KMP\u4e00\u6837\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int maxn=1e6+10;\nconst long long mod=1e9+7;\nint next[maxn],num[maxn];\nint main(){\n\tint n;\n\tcin>>n;\n\t\n\tfor(int i=0;i<n;i++){\n\t\tmemset(next,0,sizeof(next));\n\t\tmemset(num,0,sizeof(num));\n\t\tstring s;\n\t\tcin>>s;\n\t\tint len=s.size();\n\t\tint k=0;\n\t\tnum[1]=1; \n\t\tfor(int j=1;j<len;j++){\n\t\t\twhile(k>0&&s[j]!=s[k]){\n\t\t\t\tk=next[k];\n\t\t\t}\n\t\t\tif(s[j]==s[k]) k++;\n\t\t\tnext[j+1]=k;\n\t\t\tnum[j+1]=num[k]+1;\n\t\t}\n\t\tk=0;\n\t\tlong long int ans=1;\n\t\tfor(int j=1;j<len;j++){\n\t\t\twhile(k>0&&s[j]!=s[k]){\n\t\t\t\tk=next[k];\n\t\t\t}\n\t\t\tif(s[j]==s[k]) k++;\n\t\t\twhile(k*2>j+1){\n\t\t\t\tk=next[k];\n\t\t\t}\n\t\t\tans=ans*(num[k]+1)%mod;\n\t\t}\n\t\tcout<<ans<<endl;\n\t}\n\treturn 0;\n}\n```\n\n\n\n\n#### \u5199\u4f5c\u65f6\u95f4\uff1a\n2019-8-17",
        "postTime": 1566895390,
        "uid": 101319,
        "name": "WjNaG",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1a[My Blog](https://www.cnblogs.com/luckyblock/p/14250205.html)\u3002\r\n\r\n\u539f\u9898\u9762\uff1a[\u300cNOI2014\u300d\u52a8\u7269\u56ed](https://loj.ac/p/2246)\u3002\r\n\r\n>$n$ \u7ec4\u6570\u636e\uff0c\u6bcf\u6b21\u7ed9\u5b9a\u4e00\u5b57\u7b26\u4e32 $s$\u3002  \r\n>\u5b9a\u4e49 $\\operatorname{num}_i$ \u8868\u793a\u662f $s[1:i]$ \u7684\u524d\u540e\u7f00\uff0c\u4e14\u957f\u5ea6\u4e0d\u5927\u4e8e $\\left\\lfloor\\frac{i}{2}\\right\\rfloor$ \u7684\u5b57\u7b26\u4e32\u7684\u4e2a\u6570\u3002  \r\n>\u6c42\uff1a  \r\n>$$\\prod_{i=1}^{n}\\left(\\operatorname{num}_i + 1\\right)\\pmod {10^9 + 7}$$\r\n>$1\\le n\\le 5$\uff0c$1\\le |s|\\le 10^6$\u3002  \r\n>1S\uff0c512MB\u3002\r\n\r\n\u505a\u6cd5\u662f\u81ea\u5df1 YY \u7684\uff0c\u6548\u7387\u88ab\u7206\u8e29\u4f46\u662f\u80fd\u8fc7\uff08  \r\n\u8bb0 $\\mathbf{B}(i)$ \u8868\u793a\u6ee1\u8db3\u65e2\u662f\u524d\u7f00 $s[1:i]$ \u7684\u771f\u524d\u7f00\uff0c\u53c8\u662f\u5176\u771f\u540e\u7f00\u7684\u5b57\u7b26\u4e32\u7ec4\u6210\u7684\u96c6\u5408\u3002  \r\n\r\n\u5148\u4e0d\u8003\u8651\u957f\u5ea6\u4e0d\u5927\u4e8e $\\left\\lfloor\\frac{i}{2}\\right\\rfloor$ \u8fd9\u4e00\u9650\u5236\uff0c\u5bf9\u4e8e\u524d\u7f00 $s[1:i]$\uff0c\u663e\u7136 $\\operatorname{num}_i$ \u7684\u503c\u4e3a $|\\mathbf{B}(i)|$\u3002\u5219\u663e\u7136\u6709 $\\operatorname{num}_{i} = \\operatorname{num}_{\\operatorname{fail}_i} + 1$\uff0c\u8868\u793a\u5728 $\\operatorname{num}_i$ \u7684\u57fa\u7840\u4e0a\u8ba1\u5165 $s[1:i]$ \u7684 $\\operatorname{border}$ \u7684\u8d21\u732e\u3002$\\operatorname{num}$ \u53ef\u5728 KMP \u7b97\u6cd5\u4e2d\u987a\u4fbf\u6c42\u5f97\u3002  \r\n\u518d\u8003\u8651\u9650\u5236\uff0c\u82e5\u524d\u7f00 $s[1:i]$ \u7684 $\\operatorname{border}$ \u7684\u957f\u5ea6\u5927\u4e8e $\\left\\lfloor\\frac{i}{2}\\right\\rfloor$\uff0c\u5219\u9700\u8981\u4e0d\u65ad\u8df3 $\\operatorname{fail}$\uff0c\u8df3\u5230**\u7b2c\u4e00\u4e2a**\u6ee1\u8db3\u957f\u5ea6\u5408\u6cd5\u7684\u4f4d\u7f6e $j\\in \\mathbf{B}(i)$\uff0c\u518d\u7edf\u8ba1\u5176\u8d21\u732e $\\operatorname{num}_j$\u3002  \r\n\u66b4\u8df3\u5b9e\u73b0\u53ef\u4ee5\u83b7\u5f97 50pts \u7684\u597d\u6210\u7ee9\u3002\r\n\r\n---\r\n\r\n\u8003\u8651\u4f18\u5316\uff0c\u53d1\u73b0\u8df3 $\\operatorname{fail}$ \u8fc7\u7a0b\u4e2d\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u4f1a\u7f29\u77ed\uff08\u5e9f\u8bdd\uff09\uff0c\u8003\u8651\u5012\u5e8f\u679a\u4e3e\u5404\u4f4d\u7f6e $i$\uff0c\u4f7f\u5f97 $\\left\\lfloor\\frac{i}{2}\\right\\rfloor$ \u4e5f\u5448\u73b0\u9012\u51cf\u7684\u72b6\u6001\u3002  \r\n\u8003\u8651\u66b4\u8df3\u8fc7\u7a0b\uff0c\u663e\u7136\u662f\u7531\u4e8e\u67d0\u4e9b $\\operatorname{fail}$ \u7684\u8f6c\u79fb\u88ab\u91cd\u590d\u7edf\u8ba1\uff0c\u5bfc\u81f4\u66b4\u8df3\u6548\u7387\u8f83\u4f4e\u3002\u8003\u8651\u5e76\u67e5\u96c6\u7684\u601d\u8def\uff0c\u5c06\u91cd\u590d\u7684\u8f6c\u79fb\u8fdb\u884c\u8def\u5f84\u538b\u7f29\u3002  \r\n\u8bbe $\\operatorname{pos}_{i}$ \u8868\u793a\u524d\u7f00 $s[1:i]$ \u5728\u8df3 $\\operatorname{fail}$ \u4e4b\u540e\u5bf9\u5e94\u7684\u6700\u5927\u7684**\u7b2c\u4e00\u4e2a**\u6ee1\u8db3\u957f\u5ea6\u5408\u6cd5\u7684 $\\mathbf{B}$ \u4e2d\u7684\u5143\u7d20\uff0c\u521d\u59cb\u503c\u4e3a $\\operatorname{pos}_i = i$\u3002\u5728\u66b4\u529b\u8df3 $\\operatorname{fail}$ \u65f6\uff0c\u66f4\u65b0\u6cbf\u9014\u904d\u5386\u5230\u7684 $\\operatorname{pos}$ \u5373\u53ef\u3002  \r\n\r\n\u8fd9\u4e2a\u8def\u5f84\u538b\u7f29\u7684\u590d\u6742\u5ea6\u6211\u5e76\u4e0d\u4f1a\u8bc1\uff0c\u4f46\u662f\u611f\u89c9\u8dd1\u7684\u8fd8\u86ee\u5feb\u7684= =  \r\n\r\n```cpp\r\n//\u77e5\u8bc6\u70b9\uff1aKMP\r\n/*\r\nBy:Luckyblock\r\n*/\r\n#include <algorithm>\r\n#include <cctype>\r\n#include <cstdio>\r\n#include <cstring>\r\n#define LL long long\r\nconst int kN = 1e6 + 10;\r\nconst int mod = 1e9 + 7;\r\n//=============================================================\r\nint n, ans, next[kN], num[kN], pos[kN];\r\nchar s[kN];\r\n//=============================================================\r\ninline int read() {\r\n  int f = 1, w = 0;\r\n  char ch = getchar();\r\n  for (; !isdigit(ch); ch = getchar())\r\n    if (ch == '-') f = -1;\r\n  for (; isdigit(ch); ch = getchar()) w = (w << 3) + (w << 1) + (ch ^ '0');\r\n  return f * w;\r\n}\r\nvoid Init() {\r\n  ans = 1;\r\n  scanf(\"%s\", s + 1);\r\n  n = strlen(s + 1);\r\n}\r\nvoid KMP() {\r\n  for (int i = 2, j = 0; i <= n; ++ i) {\r\n    while (j > 0 && s[i] != s[j + 1]) j = next[j];\r\n    if (s[i] == s[j + 1]) ++ j;\r\n    next[i] = j;\r\n    if (! j) continue ;\r\n    pos[j] = j; //\u521d\u59cb\u5316\r\n    num[j] = 1ll * (num[next[j]] + 1ll) % mod;\r\n  }\r\n}\r\nint Find(int x_, int lth_) {\r\n  if (pos[x_] <= lth_ / 2) return pos[x_];\r\n  return pos[x_] = Find(next[pos[x_]], lth_); //\u8def\u5f84\u538b\u7f29\r\n}\r\n//=============================================================\r\nint main() {\r\n  int t = read();\r\n  while (t --) {\r\n    Init(); KMP();\r\n    for (int i = n; i >= 2; -- i) {\r\n      pos[next[i]] = Find(next[i], i); //\u627e\u5230\u8d21\u732e\u4f4d\u7f6e\r\n      if (! pos[next[i]]) continue ; //\u7279\u5224\u65e0\u8d21\u732e\u60c5\u51b5\r\n      ans = 1ll * ans * (num[pos[next[i]]] + 1) % mod;\r\n    }\r\n    printf(\"%d\\n\", ans); \r\n  }\r\n  return 0;\r\n}\r\n```",
        "postTime": 1610072521,
        "uid": 186186,
        "name": "\u7075\u4e4c\u8def\u7a7a",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014] \u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "\u3010\u9898\u610f\u3011\n\n\u5b9a\u4e49Num[i]\u4e3a\u5b57\u7b26\u4e32S\u7684\u524d\u7f00S[1~i]\u4e2d\u4e0d\u91cd\u53e0\u7684\u76f8\u540c\u524d\u540e\u7f00\u7684\u4e2a\u6570\u3002\u7ed9\u5b9aS\uff0c\u6c42\u6240\u6709(Num[i]+1)\u7684\u4e58\u79ef\u3002L<=10^6\n\n\u3010\u5206\u6790\u3011\n\n\u8fd9\u9898\u662f\u5bf9KMP\u7684\u6df1\u5165\u7406\u89e3\u4e86\u3002\u9996\u5148\u6211\u4eec\u5148\u660e\u786e\u4e00\u4e0bNext\u6570\u7ec4\u7684\u542b\u4e49\uff0cNext[i]\u6570\u7ec4\u7684\u610f\u601d\u662f\u5b57\u7b26\u4e32S\u7684\u524d\u7f00S[1~i]\u4e2d\u7684\u6700\u957f\u7684\u76f8\u540c\u524d\u540e\u7f00\u7684\u957f\u5ea6\uff08\u524d\u7f00\u4f4d\u7f6e\u4e0d\u7b49\u4e8e\u540e\u7f00\uff09\uff0c\u7136\u540e\u6211\u4eec\u7528KMP\u6c42Next\u6570\u7ec4\u7684\u65b9\u6cd5\u5176\u5b9e\u662f\u5229\u7528\u5df2\u6709\u4fe1\u606f\u51cf\u5c11\u91cd\u590d\u5224\u65ad\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5b57\u7b26\u6765\u8bf4\uff0cNext[i]\u662f\u5b83\u6700\u957f\u7684\u76f8\u540c\u524d\u540e\u7f00\u7684\u957f\u5ea6\uff0cNext[Next[i]]\u5219\u662f\u5b83\u6b21\u957f\u7684\u76f8\u540c\u524d\u540e\u7f00\u7684\u957f\u5ea6\u3002\u6c42\u5f53\u524dNext\u7684\u65f6\u5019\u6bcf\u6b21\u7528Next\u5f80\u524d\u8df3\u7684\u6bcf\u4e00\u4e2a\u90fd\u53ef\u4ee5\u4fdd\u8bc1\u5230\u4e0a\u4e00\u4f4d\u4e3a\u6b62\u524d\u7f00\u7b49\u4e8e\u540e\u7f00\uff0c\u5e76\u4e14\u6211\u4eec\u7684\u4e00\u4e2aj\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5168\u5c40\u7684\u53d8\u91cf\uff0c\u5b83\u4fdd\u5b58\u7684\u662f\u5f53\u524d\u4e0a\u4e00\u4f4d\u7684\u540e\u7f00\u7684\u6700\u5927\u5339\u914d\u7684\u524d\u7f00\u957f\u5ea6\uff0c\u7136\u540e\u6211\u4eec\u53ea\u662f\u8981\u7528j\u5c3d\u65e9\u627e\u5230\u4e00\u4e2a\uff0c\u4e5f\u5c31\u662f\u6700\u957f\u7684\u90a3\u4e00\u4e2a\u6765\u4f7f\u5f97\u5f53\u524d\u4f4d\u6ee1\u8db3\uff0c\u6240\u4ee5\u6211\u4eec\u8df3\u5230\u7684\u7b2c\u4e00\u4e2a\u80fd\u6ee1\u8db3\u5f53\u524d\u4f4d\u7f6e\u7684\u5c31\u662f\u6700\u4f73\u7b54\u6848\u3002\u66f4\u52a0\u672c\u8d28\u7684\u662f\uff0c\u5176\u5b9e\u5982\u679c\u6211\u4eec\u7ee7\u7eed\u5f80\u524d\u8df3\uff0c\u662f\u6709\u53ef\u80fd\u627e\u5230\u53e6\u4e00\u4e2a\u66f4\u77ed\u7684\u76f8\u540c\u524d\u540e\u7f00\u7684\u3002\u7136\u540e\u5bf9\u4e8e\u672c\u9898\u800c\u8a00\uff0c\u6211\u4eec\u5148\u6c42\u51faNext\u6570\u7ec4\uff0c\u7136\u540e\u6709\u591a\u5c11\u4e2a\u8fed\u4ee3\u7684Next\u6211\u4eec\u5c31\u76f8\u5f53\u4e8e\u662f\u6709\u591a\u5c11\u4e2a\u76f8\u540c\u7684\u524d\u540e\u7f00\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728\u6c42Next\u7684\u540c\u65f6\u6c42\u51fa\u6bcf\u4e2a\u524d\u7f00\u53ef\u4ee5\u91cd\u53e0\u7684\u524d\u7f00\u540e\u7f00\u7684\u6570\u91cf\uff08\u524d\u7f00\u4f4d\u7f6e\u4e0d\u7b49\u4e8e\u540e\u7f00\uff09\uff0c\u4e0d\u59a8\u79f0\u5176\u4e3aCnt[i]\u3002\u7136\u540e\u6211\u4eec\u5176\u5b9e\u53ea\u8981\u627e\u7b49\u4e8e\u540e\u7f00\u7684\u4e00\u4e2a\u524d\u7f00\u4e2d\u4e0d\u8d85\u8fc7\u524d\u7f00\u957f\u5ea6\u4e00\u534a\u7684\u90a3\u4e2a\uff0c\u5b83\u7684Cnt\u5c31\u662f\u6211\u4eec\u8fd9\u4e2a\u524d\u7f00\u7684Num\u3002\u672c\u8d28\u5c31\u662f\uff0c\u5b57\u7b26\u4e32S\u7684\u524d\u7f00\u4e2d\u7b49\u4e8eS\u67d0\u4e2a\u540e\u7f00\u7684\u90a3\u4e2a\u524d\u7f00\u7684\u540e\u7f00\u4e5f\u662fS\u7684\u4e00\u4e2a\u524d\u7f00\u7b49\u4e8e\u540e\u7f00\u7684\u540e\u7f00\uff0c\u5e76\u4e14\u6240\u6709\u90fd\u662f\u3002\n\n\u3010\u4ee3\u7801\u3011\n```\n#include <bits/stdc++.h>\n#define For(i, a, b) for(int i = (a); i <= (b); ++i)\n#define Rof(i, a, b) for(int i = (a); i >= (b); --i)\n#define mem(A, Pos) memset(A, Pos, sizeof(A))\n#define LL long long\n#define MaxN 2000001\n#define Mod 1000000007\nusing namespace std;\nLL Ans = 1;\nint N, T, Next[MaxN], Cnt[MaxN];\nchar S[MaxN];\nint main() {\n    scanf(\"%d\", &T);\n    while(T--) {\n        scanf(\"%s\", S + 1); N = strlen(S + 1);\n        Cnt[1] = 1; \n        for(int i = 2, j = 0; i <= N; ++i) {\n            while(j > 0 && S[i] != S[j + 1]) j = Next[j];\n            if(S[i] == S[j + 1]) ++j;\n            Next[i] = j;\n            Cnt[i] = Cnt[j] + 1;\n        }\n        Ans = 1;\n        for(int i = 1, j = 0; i <= N; ++i) {\n            while(j > 0 && S[i] != S[j + 1]) j = Next[j];\n            if(S[i] == S[j + 1]) ++j;\n            while((j << 1) > i) j = Next[j];\n            Ans = (1ll * Ans * (Cnt[j] + 1)) % Mod;\n        }\n        printf(\"%lld\\n\", Ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1568122743,
        "uid": 24518,
        "name": "\u5047\u88c5\u601d\u8003",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "# \u5176\u5b9e\u8fd9\u9898\u53ef\u4ee5\u7528\u6269\u5c55KMP #\n\u5b66\u4e86\u6269\u5c55KMP\u60f3\u627e\u4e00\u9053\u6a21\u677f\u9898\uff0c\u53d1\u73b0\u5728luogu\u641c\u7d22\uff0c\u5e76\u6ca1\u6709\u6269\u5c55KMP\u7684\u6807\u7b7e\u3002\u968f\u4fbf\u70b9\u4e86\u4e00\u4e2aKMP\u7684\uff0c\u7ed3\u679c\u53d1\u73b0\u53ef\u4ee5\u505a\u2026\u2026\n\n\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u535a\u5ba2\uff1a[\u6269\u5c55KMP](https://www.cnblogs.com/dilthey/p/8620119.html)\n\uff08\u5e76\u4e0d\u662f\u6211\u7684\u535a\u5ba2/\u9003\uff09\n\n\u6269\u5c55KMP\u53ef\u4ee5\u6c42\u51fa$extend$\u6570\u7ec4\uff0c\u5176\u4e2d$extend[i]$\u8868\u793a\u6a21\u5f0f\u4e32$S$\u4e0e\u4e3b\u4e32$T$\u7684\u540e\u7f00$T[i..lenT]$\u7684\u6700\u957f\u516c\u5171\u524d\u7f00\u3002\n$$extend[i]=lcp(S,T[i..lenT])$$\n\u6c42$extend$\u6570\u7ec4\u7684\u8fc7\u7a0b\u4f1a\u5f15\u5165\u4e00\u4e2a$next$\u6570\u7ec4\uff08\u7c7b\u4f3c\u4e8eKMP\uff0c\u4f46\u662f\u8fd9\u4e2a$next$\u6570\u7ec4\u4e0eKMP\u7684next\u6570\u7ec4\u4e0d\u540c\uff09\uff0c\u4ed6\u8868\u793a$S$\u4e0e$S$\u7684\u540e\u7f00$S[i..lenS]$\u7684\u6700\u957f\u516c\u5171\u524d\u7f00\u3002\n$$next[i]=lcp(S,S[i..lenS])$$\n# \u6211\u4eec\u53ea\u9700\u8981$next$\u6570\u7ec4\u5c31\u597d\u4e86\u3002 #\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4f4d\u7f6e$i$\uff0c\u6211\u4eec\u8003\u8651\u8ba1\u7b97\uff1a\u4ee5 $i$ \u4f5c\u4e3a  $num$\u6570\u7ec4\u8ba1\u6570\u89c4\u5219\u91cc\u7684\u90a3\u4e2a\u540e\u7f00 \u7684\u8d77\u70b9\u4f4d\u7f6e \u65f6 \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u5f88\u7b80\u5355\uff0c\u53d6$len=min(i-1,next[i])$\uff08\u4ee51\u4e3a\u5b57\u7b26\u4e32\u8d77\u59cb\u4e0b\u6807\uff09\u4e5f\u5c31\u662f$i$\u4f4d\u7f6e\u80fd\u5bf9$num$\u6570\u7ec4\u8d21\u732e\u5230\u7684\u957f\u5ea6\uff0c\u90a3\u4e48$num[i..i+len-1]$\u90fd\u8981+1\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u505a$O(n)$\u6b21\u533a\u95f4+1\uff0c\u6700\u540e\u5f97\u5230\u539f\u6570\u7ec4\u3002\u8fd9\u4e2a\u53ef\u4ee5\u7528\u5dee\u5206\u6570\u7ec4\u89e3\u51b3\u3002\n\nexkmp\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nvoid exkmp() {\n\t//next[i]\u8868\u793aa[i..lena]\u4e0ea\u7684\u6700\u957f\u516c\u5171\u524d\u7f00\n\tint vi,vj;\n\tne[1]=lena;\n\tfor(vi=1; an[vi]==an[vi+1]&&vi<lena; vi++);\n\tne[2]=vi-1;\n\tint po=2;\n\tfor(vi=3; vi<=lena; vi++)\n\t\tif(vi+ne[vi-po+1]<po+ne[po])ne[vi]=ne[vi-po+1];\n\t\telse {\n\t\t\tvj=po+ne[po]-vi>=1?po+ne[po]-vi+1:1;\n\t\t\tfor(; an[vj]==an[vi+vj-1]&&vi+vj-1<=lena; vj++);\n\t\t\tne[vi]=vj-1;\n\t\t\tpo=vi;\n\t\t}\n}\n```\n\n\u672c\u9898\u6838\u5fc3\u4ee3\u7801\uff1a\n```cpp\nint num[1000010];\nvoid ADD(int l,int r){\n\tnum[l]++;\n\tnum[r+1]--;\n}\nvoid work() {\n\tint vi;\n\texkmp();\n\tint tmp;\n\tfor(vi=2;vi<=lena;vi++){\n\t\ttmp=min(vi-1,ne[vi]);\n\t\tADD(vi,vi+tmp-1);\n\t}\n\tfor(vi=1;vi<=lena;vi++)num[vi]+=num[vi-1];\n\tLL ans=1;\n\tfor(vi=1;vi<=lena;vi++)ans=ans*(num[vi]+1)%intp;\n\tprintf(\"%lld\\n\",ans);\n}\n```\n\n\u4ee5\u4e0a\u3002",
        "postTime": 1565436538,
        "uid": 13036,
        "name": "liaoy14866",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "[\u6233\u8fde\u63a5\u98df\u7528](http://www.cnblogs.com/tonylim/p/6919212.html)\n\n\n\u611f\u8c22 [@ \u67d0\u6c99\u8336\u7684OI\u4ee3\u7801\u5e93 ](http://my.csdn.net/qpswwww)   \u5199\u7684\u9898\u89e3\uff0c\u4e3b\u8981\u601d\u8def(\u5f15\u7528\u90e8\u5206)\u6765\u81ea[[\u7701\u9009\u524d\u9898\u76ee\u6574\u7406][BZOJ 3670][NOI 2014]\u52a8\u7269\u56ed(KMP)](http://blog.csdn.net/qpswwww/article/details/44937169)\n\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u7528kmp\u6c42\u51fanext\u6570\u7ec4\uff0c\u7136\u540e\u6211\u4eec\u6784\u9020\u4e00\u4e2acnt\u6570\u7ec4\uff0c\n\n>cnt[i]=\u4e3a\u6ee1\u8db3\u65e2\u662f\u524d\u7f00i\u7684\u524d\u7f00\uff0c\u53c8\u662f\u524d\u7f00i\u7684\u540e\u7f00\u7684\u5b50\u4e32\u4e2a\u6570(\u5305\u62ec\u524d\u7f00i\u672c\u8eab)\uff0c\u8fd9\u4e2a\u6570\u7ec4\u53ef\u4ee5\u901a\u8fc7\u9012\u63a8\u5728O(n)\u65f6\u95f4\u5185\u5f97\u51fa\uff1a\n\n\n>\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7cnt[]\u548cnext[]\u6570\u7ec4\u6c42\u5f97num[]\u6570\u7ec4\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e2ai>=2(i=1\u65f6\u663e\u7136num[i]=0)\uff0c\u901a\u8fc7\u6cbf\u7740next[]\u6307\u9488\u5411\u524d\u8d70\u627e\u5230\u6700\u5927\u7684j,j\u6ee1\u8db3\u524d\u7f00j\u65e2\u662f\u524d\u7f00i\u7684\u524d\u7f00\uff0c\u4e5f\u662f\u5b83\u7684\u540e\u7f00\uff0c\u4e142j<=i(\u5373\u9898\u9762\u4e2d\u6240\u9650\u5236\u7684\u524d\u7f00\u548c\u540e\u7f00\u4e0d\u91cd\u53e0)\uff0c\u90a3\u4e48num[i]=cnt[j]\n\n//\u6ce8\u610f\uff1a\u524d\u7f00i\u6307\u7684\u662f\u524di\u4e2a\u5b57\u7b26\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\n\ncnt[1]=1  //\u524d\u7f001\u53ea\u6709\u672c\u8eab\n\ncnt[i]=cnt[next[i]]+1(1<i<=len) //\u524d\u7f00i\u7684\u6700\u957f\u5339\u914dnext[i]+\u4ed6\u81ea\u8eab\n\n\u80e1\u5f04\u4e00\u756a\u8bc1\u660e\u2014\u2014:\n\n\u2235\u5f53\u524d\u7f00i\u7684\u524d\u7f00j\u548c\u4ed6\u957f\u5ea6\u4e3aj\u7684\u540e\u7f00\u4e0d\u91cd\u53e0\n\n\u2234\u524d\u7f00j\u7684\u957f\u5ea6\u4e3au\u540e\u7f00=\u524d\u7f00i\u7684\u957f\u5ea6\u4e3au\u7684\u540e\u7f00   //\u5f531<=u<=cnt[j]\n\n\u53c8\u2235\u524d\u7f00j\u7684\u957f\u5ea6\u4e3au\u540e\u7f00=\u524d\u7f00j\u7684\u957f\u5ea6\u4e3au\u524d\u7f00=\u524d\u7f00i\u7684\u957f\u5ea6\u4e3au\u7684\u524d\u7f00\n\n\u2234\u524d\u7f00i\u7684\u957f\u5ea6\u4e3au\u7684\u524d\u7f00=\u524d\u7f00i\u7684\u957f\u5ea6\u4e3au\u7684\u540e\u7f00=\u524d\u7f00j\u7684\u957f\u5ea6\u4e3au\u524d\u7f00(\u8fd9\u4e2a\u7684\u79cd\u6570\u4e5f\u5c31\u662fcnt[j])=\u524d\u7f00j\u7684\u957f\u5ea6\u4e3au\u540e\u7f00\n\n\u53c8\u2235\u6211\u4eec\u627e\u5230\u7684j\u6ee1\u8db32j<=i\n\n\u2234num[i]=cnt[j]\n\n\n\u7136\u540e\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a50\u5206\u7684\u505a\u6cd5with TLE(\u6ce8\u610fans\u4e3aint64)\n\n\n```pascal\n\nprogram no;\nconst\n  m=1000000007;\nvar\n  b:ansistring;\n  ans:int64;\n  n,p,i,j,l,num:Longint;\n  next,cnt:array[0..1000001] of longint;\n\nprocedure get_next_and_cnt;\nbegin\n     j:=0;\n    next[1]:=0;  cnt[1]:=1;\n    for i:= 2 to l do\n    begin\n      while (j>0) and (b[j+1]<>b[i]) do j:=next[j];\n      if b[j+1]=b[i] then inc(j);\n      next[i]:=j;              //kmp\u8ba1\u7b97next\n      cnt[i]:=cnt[next[i]]+1;  //\u987a\u5e26\u8ba1\u7b97cnt\n    end;\nend;\n\nprocedure cal;\nbegin\n    ans:=1;\n    for i:= 2 to l do\n      begin\n          j:=next[i];\n          while 2*j>i do j:=next[j];  //\u67e5\u627e\u6700\u5927\u7684\u7b26\u5408\u6761\u4ef6\u7684J\n          num:=cnt[j];\n          ans:=((ans mod m)*((num+1) mod m)) mod m;\n      end;\nend;\n\nbegin\n   //assign(input,'1.in'); assign(output,'1.out');\n   reset(input); rewrite(output);\n\n   readln(n);\n   for p:= 1 to n do\n   begin\n     readln(b);   l:=length(b);\n\n     get_next_and_cnt();\n     cal();\n\n     writeln(ans);\n   end;\n\n   close(input);  close(output);\nend.\n\n```\n\n\u4e8e\u662f\u4e0b\u9762\u662f100\u5206\u7684\u505a\u6cd5\uff1a\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u67e5\u627e\u6700\u5927\u7684\u7b26\u5408\u6761\u4ef6\u7684J\u7684\u90e8\u5206\u6539\u4e3a\u50cfkmp\u4e2d\u7684\u4e00\u6837\uff1a\n\n\n ```pascal\n\n while(j<>0) and (b[j+1]<>b[i]) do j:=next[j];\n            if(b[j+1]=b[i]) then inc(j);\n\n```\n\n\u6211\u4eec\u5728\u5faa\u73af\u5230i\u65f6\u5f53\u524d\u7684j\u662f\u4e0d\u662f\u53ef\u4ee5\u91cd\u524d\u4e00\u6b21\u7684\u6700\u957f\u7684\u4e0d\u91cd\u53e0\u7684j\u5f97\u5230\u5462\uff1f\n\n\u7b54\u6848\u662f\u80af\u5b9a\u7684,\u8981\u4e48\u5c0f\u4e8e\u7b49\u4e8e\u4e0a\u4e00\u6b21\u7684j\uff0c\u8981\u4e48\u7b49\u4e8e\u4e0a\u4e00\u6b21\u7684j+1\n\n===\n\u731c\u60f3\uff1a\u4f1a\u4e0d\u4f1a\u662fj+2\u6216\u66f4\u5927\u5462\uff1f\n\n\n\u4e0d\uff0c\u53ef\u4ee5\u7528\u53cd\u8bc1\u6cd5\n\n\u5047\u8bbe\u7b2ci\u22121\u6b21\u5faa\u73af\u5f97\u5230j\u4e3aj,\u8fd9\u6b21(\u7b2ci\u6b21)\u6700\u7ec8\u5f97\u5230\u7684\u4e3aj+2\n\n\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0\u524d\u7f00i\u7684\u524d\u7f00j+2=\u4ed6\u957f\u5ea6\u4e3aj+2\u7684\u540e\u7f00\n\n\u90a3\u4e48\u524d\u7f00j+2=\u524d\u7f00i\u7684\u957f\u5ea6\u4e3aj+2\u7684\u540e\u7f00\u7684\u957f\u5ea6\u4e3aj+1\u7684\u524d\u7f00(\u7ed3\u675f\u4e3ai\u22121)\n\n\u53c8\u56e0\u4e3a\u6211\u4eec\u5f97\u5230\u7684j+2\u6ee1\u8db3\u4e0d\u91cd\u53e0\uff0c\u90a3\u4e48j+1\u81ea\u7136\u4e5f\u4e0d\u4f1a\u91cd\u53e0\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u524d\u7f00i\u22121\u7684\u7684\u6700\u4f18j\u4e3aj+1\n\n\u8fd9\u6837\u5c31\u51b2\u7a81\u5566\uff0c\u4e8e\u662f\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684\n\n=====\n\u7136\u540e\u6211\u4eec\u6bcf\u6b21\u6c42j\u7684\u64cd\u4f5c\u5c31\u63a5\u8fd1O(1),\u90a3cal()\u4e5f\u5c31\u63a5\u8fd1O(n)\u5566\uff01\n\n\n\n\n\n\n\n\n\n\n\n```cpp\nprogram no;\nconst\n  m=1000000007;\nvar\n  b:ansistring;\n  ans:int64;\n  n,p,i,j,l,num:Longint;\n  next,cnt:array[0..1000001] of longint;\nprocedure get_next_and_cnt;\nbegin\n     j:=0;\n    next[1]:=0;  cnt[1]:=1;\n    for i:= 2 to l do\n    begin\n      while (j>0) and (b[j+1]<>b[i]) do j:=next[j];\n      if b[j+1]=b[i] then inc(j);\n      next[i]:=j;\n      cnt[i]:=cnt[next[i]]+1;\n    end;\nend;\nprocedure cal;\nbegin\n    ans:=1;j:=0;\n    for i:= 2 to l do\n      begin\n        while(j<>0) and (b[j+1]<>b[i]) do j:=next[j];\n            if(b[j+1]=b[i]) then inc(j);            //\u4fee\u6539\u7684\u5730\u65b9\n          while 2*j>i do j:=next[j];\n          num:=cnt[j];\n          ans:=((ans mod m)*((num+1) mod m)) mod m;\n      end;\nend;\nbegin\n  // assign(input,'1.in'); assign(output,'1.out');\n   reset(input); rewrite(output);\n   readln(n);\n   for p:= 1 to n do\n   begin\n     readln(b);   l:=length(b);\n     get_next_and_cnt();\n     cal();\n     writeln(ans);\n   end;\n   close(input);  close(output);\nend.\n```",
        "postTime": 1496069534,
        "uid": 19015,
        "name": "bobble",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010\u52a8\u7269\u56ed\u3011"
    },
    {
        "content": "\u3010\u9898\u76ee\u63cf\u8ff0\u3011\n\n\u8fd1\u65e5\uff0c\u56ed\u957f\u53d1\u73b0\u52a8\u7269\u56ed\u4e2d\u597d\u5403\u61d2\u505a\u7684\u52a8\u7269\u8d8a\u6765\u8d8a\u591a\u4e86\u3002\u4f8b\u5982\u4f01\u9e45\uff0c\u53ea\u4f1a\u5356\u840c\u5411\u6e38\u5ba2\u8981\u5403\u7684\u3002\u4e3a\u4e86\u6574\u6cbb\u52a8\u7269\u56ed\u7684\u4e0d\u826f\u98ce\u6c14\uff0c\u8ba9\u52a8\u7269\u4eec\u51ed\u81ea\u5df1\u7684\u771f\u624d\u5b9e\u5b66\u5411\u6e38\u5ba2\u8981\u5403\u7684\uff0c\u56ed\u957f\u51b3\u5b9a\u5f00\u8bbe\u7b97\u6cd5\u73ed\uff0c\u8ba9\u52a8\u7269\u4eec\u5b66\u4e60\u7b97\u6cd5\u3002\n\n\u67d0\u5929\uff0c\u56ed\u957f\u7ed9\u52a8\u7269\u4eec\u8bb2\u89e3KMP\u7b97\u6cd5\u3002\n\n\u56ed\u957f\uff1a\u201c\u5bf9\u4e8e\u4e00\u4e2a\u5b57\u7b26\u4e32S\uff0c\u5b83\u7684\u957f\u5ea6\u4e3aL\u3002\u6211\u4eec\u53ef\u4ee5\u5728O(L)\u7684\u65f6\u95f4\u5185\uff0c\u6c42\u51fa\u4e00\u4e2a\u540d\u4e3anext\u7684\u6570\u7ec4\u3002\u6709\u8c01\u9884\u4e60\u4e86next\u6570\u7ec4\u7684\u542b\u4e49\u5417\uff1f\u201d\n\n\u718a\u732b\uff1a\u201c\u5bf9\u4e8e\u5b57\u7b26\u4e32S\u7684\u524di\u4e2a\u5b57\u7b26\u6784\u6210\u7684\u5b50\u4e32\uff0c\u65e2\u662f\u5b83\u7684\u540e\u7f00\u53c8\u662f\u5b83\u7684\u524d\u7f00\u7684\u5b57\u7b26\u4e32\u4e2d\uff08\u5b83\u672c\u8eab\u9664\u5916\uff09\uff0c\u6700\u957f\u7684\u957f\u5ea6\u8bb0\u4f5cnext[i]\u3002\u201d\n\n\u56ed\u957f\uff1a\u201c\u975e\u5e38\u597d\uff01\u90a3\u4f60\u80fd\u4e3e\u4e2a\u4f8b\u5b50\u5417\uff1f\u201d\n\n\u718a\u732b\uff1a\u201c\u4f8bS\u4e3aabcababc\uff0c\u5219next[5]=2\u3002\u56e0\u4e3aS\u7684\u524d5\u4e2a\u5b57\u7b26\u4e3aabcab\uff0cab\u65e2\u662f\u5b83\u7684\u540e\u7f00\u53c8\u662f\u5b83\u7684\u524d\u7f00\uff0c\u5e76\u4e14\u627e\u4e0d\u5230\u4e00\u4e2a\u66f4\u957f\u7684\u5b57\u7b26\u4e32\u6ee1\u8db3\u8fd9\u4e2a\u6027\u8d28\u3002\u540c\u7406\uff0c\u8fd8\u53ef\u5f97\u51fanext[1] = next[2] = next[3] = 0\uff0cnext[4] = next[6] = 1\uff0cnext[7] = 2\uff0cnext[8] = 3\u3002\u201d\n\n\u56ed\u957f\u8868\u626c\u4e86\u8ba4\u771f\u9884\u4e60\u7684\u718a\u732b\u540c\u5b66\u3002\u968f\u540e\uff0c\u4ed6\u8be6\u7ec6\u8bb2\u89e3\u4e86\u5982\u4f55\u5728O(L)\u7684\u65f6\u95f4\u5185\u6c42\u51fanext\u6570\u7ec4\u3002\n\n\u4e0b\u8bfe\u524d\uff0c\u56ed\u957f\u63d0\u51fa\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u201cKMP\u7b97\u6cd5\u53ea\u80fd\u6c42\u51fanext\u6570\u7ec4\u3002\u6211\u73b0\u5728\u5e0c\u671b\u6c42\u51fa\u4e00\u4e2a\u66f4\u5f3a\u5927num\u6570\u7ec4\u4e00\u4e00\u5bf9\u4e8e\u5b57\u7b26\u4e32S\u7684\u524di\u4e2a\u5b57\u7b26\u6784\u6210\u7684\u5b50\u4e32\uff0c\u65e2\u662f\u5b83\u7684\u540e\u7f00\u540c\u65f6\u53c8\u662f\u5b83\u7684\u524d\u7f00\uff0c\u5e76\u4e14\u8be5\u540e\u7f00\u4e0e\u8be5\u524d\u7f00\u4e0d\u91cd\u53e0\uff0c\u5c06\u8fd9\u79cd\u5b57\u7b26\u4e32\u7684\u6570\u91cf\u8bb0\u4f5cnum[i]\u3002\u4f8b\u5982S\u4e3aaaaaa\uff0c\u5219num[4] = 2\u3002\u8fd9\u662f\u56e0\u4e3aS\u7684\u524d4\u4e2a\u5b57\u7b26\u4e3aaaaa\uff0c\u5176\u4e2da\u548caa\u90fd\u6ee1\u8db3\u6027\u8d28\u2018\u65e2\u662f\u540e\u7f00\u53c8\u662f\u524d\u7f00\u2019\uff0c\u540c\u65f6\u4fdd\u8bc1\u8fd9\u4e2a\u540e\u7f00\u4e0e\u8fd9\u4e2a\u524d\u7f00\u4e0d\u91cd\u53e0\u3002\u800caaa\u867d\u7136\u6ee1\u8db3\u6027\u8d28\u2018\u65e2\u662f\u540e\u7f00\u53c8\u662f\u524d\u7f00\u2019\uff0c\u4f46\u9057\u61be\u7684\u662f\u8fd9\u4e2a\u540e\u7f00\u4e0e\u8fd9\u4e2a\u524d\u7f00\u91cd\u53e0\u4e86\uff0c\u6240\u4ee5\u4e0d\u80fd\u8ba1\u7b97\u5728\u5185\u3002\u540c\u7406\uff0cnum[1] = 0,num[2] = num[3] = 1,num[5] = 2\u3002\u201d\n\n\u6700\u540e\uff0c\u56ed\u957f\u7ed9\u51fa\u4e86\u5956\u52b1\u6761\u4ef6\uff0c\u7b2c\u4e00\u4e2a\u505a\u5bf9\u7684\u540c\u5b66\u5956\u52b1\u5de7\u514b\u529b\u4e00\u76d2\u3002\u542c\u4e86\u8fd9\u53e5\u8bdd\uff0c\u7761\u4e86\u4e00\u8282\u8bfe\u7684\u4f01\u9e45\u7acb\u523b\u5c31\u9192\u8fc7\u6765\u4e86\uff01\u4f46\u4f01\u9e45\u5e76\u4e0d\u4f1a\u505a\u8fd9\u9053\u9898\uff0c\u4e8e\u662f\u5411\u53c2\u89c2\u52a8\u7269\u56ed\u7684\u4f60\u5bfb\u6c42\u5e2e\u52a9\u3002\u4f60\u80fd\u5426\u5e2e\u52a9\u4f01\u9e45\u5199\u4e00\u4e2a\u7a0b\u5e8f\u6c42\u51fanum\u6570\u7ec4\u5462\uff1f\n\n\u7279\u522b\u5730\uff0c\u4e3a\u4e86\u907f\u514d\u5927\u91cf\u7684\u8f93\u51fa\uff0c\u4f60\u4e0d\u9700\u8981\u8f93\u51fanum[i]\u5206\u522b\u662f\u591a\u5c11\uff0c\u4f60\u53ea\u9700\u8981\u8f93\u51fa\u6240\u6709num[i]\u7684\u4e58\u79ef\uff0c\u5bf91,000,000,007\u53d6\u6a21\u7684\u7ed3\u679c\u5373\u53ef\u3002\n\n\u3010\u8f93\u5165\u8f93\u51fa\u683c\u5f0f\u3011\n\n- \u8f93\u5165\u683c\u5f0f\n\n\u7b2c1\u884c\u4ec5\u5305\u542b\u4e00\u4e2a\u6b63\u6574\u6570n \uff0c\u8868\u793a\u6d4b\u8bd5\u6570\u636e\u7684\u7ec4\u6570\u3002\u968f\u540en\u884c\uff0c\u6bcf\u884c\u63cf\u8ff0\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\u3002\u6bcf\u7ec4\u6d4b\u8bd5\u6570\u636e\u4ec5\u542b\u6709\u4e00\u4e2a\u5b57\u7b26\u4e32S\uff0cS\u7684\u5b9a\u4e49\u8be6\u89c1\u9898\u76ee\u63cf\u8ff0\u3002\u6570\u636e\u4fdd\u8bc1S \u4e2d\u4ec5\u542b\u5c0f\u5199\u5b57\u6bcd\u3002\u8f93\u5165\u6587\u4ef6\u4e2d\u4e0d\u4f1a\u5305\u542b\u591a\u4f59\u7684\u7a7a\u884c\uff0c\u884c\u672b\u4e0d\u4f1a\u5b58\u5728\u591a\u4f59\u7684\u7a7a\u683c\u3002\n\n- \u8f93\u51fa\u683c\u5f0f\n\n\u5305\u542b n \u884c\uff0c\u6bcf\u884c\u63cf\u8ff0\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\u7684\u7b54\u6848\uff0c\u7b54\u6848\u7684\u987a\u5e8f\u5e94\u4e0e\u8f93\u5165\u6570\u636e\u7684\u987a\u5e8f\u4fdd\u6301\u4e00\u81f4\u3002\u5bf9\u4e8e\u6bcf\u7ec4\u6d4b\u8bd5\u6570\u636e\uff0c\u4ec5\u9700\u8981\u8f93\u51fa\u4e00\u4e2a\u6574\u6570\uff0c\u8868\u793a\u8fd9\u7ec4\u6d4b\u8bd5\u6570\u636e\u7684\u7b54\u6848\u5bf9 1,000,000,007 \u53d6\u6a21\u7684\u7ed3\u679c\u3002\u8f93\u51fa\u6587\u4ef6\u4e2d\u4e0d\u5e94\u5305\u542b\u591a\u4f59\u7684\u7a7a\u884c\u3002\n\n\u3010\u8f93\u5165\u8f93\u51fa\u6837\u4f8b\u3011\n\n- \u8f93\u5165\u6837\u4f8b\n```\n3\naaaaa\nab\nabcababc\n```\n\n- \u8f93\u51fa\u6837\u4f8b\n```\n36\n1\n32\n```\n\n$100$\u5206\uff08\u6ee1\u5206\uff09\u601d\u8def\uff1a\n\n\u65e2\u7136\u9898\u76ee\u91cc\u63d0\u5230\u4e86KMP\u7b97\u6cd5\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u8bb2\u8bb2\u4ec0\u4e48\u662fKMP\u7b97\u6cd5\u3002\n\n> KMP\uff08Knuth Morris Pratt\uff09\u7b97\u6cd5\u662f\u4e00\u79cd\u6539\u8fdb\u7684\u5b57\u7b26\u4e32\u5339\u914d\u7b97\u6cd5\uff0c\u7531D.E.Knuth\uff0cJ.H.Morris\u548cV.R.Pratt\u540c\u65f6\u53d1\u73b0\uff0c\u56e0\u6b64\u4eba\u4eec\u79f0\u5b83\u4e3a\u514b\u52aa\u7279\u2014\u2014\u83ab\u91cc\u65af\u2014\u2014\u666e\u62c9\u7279\u64cd\u4f5c\uff08\u7b80\u79f0KMP\u7b97\u6cd5\uff09\u3002KMP\u7b97\u6cd5\u7684\u5173\u952e\u662f\u5229\u7528\u5339\u914d\u5931\u8d25\u540e\u7684\u4fe1\u606f\uff0c\u5c3d\u91cf\u51cf\u5c11\u6a21\u5f0f\u4e32\u4e0e\u4e3b\u4e32\u7684\u5339\u914d\u6b21\u6570\u4ee5\u8fbe\u5230\u5feb\u901f\u5339\u914d\u7684\u76ee\u7684\u3002\u5982\u679c\u6211\u4eec\u5c06\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u5b57\u7b26\u4e32\u548c\u4e00\u4e2a\u957f\u5ea6\u4e3a$m$\u7684\u5b57\u7b26\u4e32\u76f8\u5339\u914d\u7684\u8bdd\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n+m)$\u3002\n\n\u4e0a\u9762\u7684\u5f15\u7528\u90e8\u5206\u7684\u5185\u5bb9\u6458\u81ea[\u767e\u5ea6\u767e\u79d1](https://baike.baidu.com/)\u548c[@fstqwq](https://www.luogu.org/space/show?uid=12621)\u7684\u8bb2\u4e49\u3002\n\n\u4e0b\u9762\u5c06\u7ed9\u51fa\u4e00\u4e2a\u4f8b\u5b50\uff1a\n\n\u5229\u7528\u4fe1\u606f\uff1f\n```\nABCEABCDABEABCDABCDABDE\nABCDABD\n```\n\u7ee7\u7eed\u5339\u914d\uff1a\n```\nABCEABCDABEABCDABCDABDE\n    ABCDABD\n```\n\u518d\u7ee7\u7eed\u5339\u914d\uff1a\n```\nABCEABCDABEABCDABCDABDE\n        ABCDABD\n```\n\u63a5\u7740\u5339\u914d\uff1a\n```\nABCEABCDABEABCDABCDABDE\n           ABCDABD\n```\n\u53d1\u73b0\u6700\u4f73\u5339\u914d~\n```\nABCEABCDABEABCDABCDABDE\n               ABCDABD\n```\n\n\u4e0a\u9762\u7684\u4f8b\u5b50\u6458\u81ea\u6d1b\u8c37\u8bb2\u4e49\uff0c\u4f5c\u8005\u4e3a\u6d1b\u8c37\u7f51\u6821\u7684\u8bb2\u5e08[@fstqwq](https://www.luogu.org/space/show?uid=12621)\u3002\n\n\u6211\u4eec\u7528$next[i]$\u6765\u8868\u793a\u6709\u5b57\u7b26\u4e32\u4e2d\u7684\u7b2c$1$\u4e2a\u5b57\u7b26\u5230\u7b2c$i$\u4e2a\u5b57\u7b26\u6240\u7ec4\u6210\u7684\u5b50\u4e32\u4e2d\u524d\u7f00\u4e0e\u540e\u7f00\u5b8c\u5168\u76f8\u540c\u7684\u6700\u5927\u957f\u5ea6\uff08\u4e0d\u5305\u542b\u5b83\u672c\u8eab\uff09\u3002\n\n\u4f8b\u5982\u5bf9\u4e8e\u5b57\u7b26\u4e32$abcdaba$\uff0c$next[1]=next[2]=next[3]=next[4]=0$\uff0c$next[5]=next[7]=1$\uff0c$next[6]=2$\u3002\n\n\u4f60\u53ef\u4ee5\u5728[\u8fd9\u91cc](https://www.luogu.org/problemnew/show/P3375)\u68c0\u9a8c\u4f60\u7684KMP\u7b97\u6cd5\u7684\u6b63\u786e\u6027\u3002\n\n\u4e0b\u9762\u6211\u5c06\u7ed9\u51faKMP\u7b97\u6cd5\u7684\u6a21\u677f\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\nchar sta[1000001],stb[1000001];\nint next[1000001];\nint main()\n{\n\tscanf(\"%s %s\",sta+1,stb+1);\n\tnext[1]=0;\n\tint lena=strlen(sta+1),lenb=strlen(stb+1);\n\tint k=0;\n\tfor(int i=2;i<=lenb;i++)\n\t{\n\t\twhile(k!=0 && stb[i]!=stb[k+1])\n\t\t{\n\t\t\tk=next[k];\n\t\t}\n\t\tif(stb[i]==stb[k+1])\n\t\t{\n\t\t\tk++;\n\t\t}\n\t\tnext[i]=k;\n\t}\n\tk=0;\n\tfor(int i=1;i<=lena;i++)\n\t{\n\t\twhile(k!=0 && sta[i]!=stb[k+1])\n\t\t{\n\t\t\tk=next[k];\n\t\t}\n\t\tif(sta[i]==stb[k+1])\n\t\t{\n\t\t\tk++;\n\t\t}\n\t\tif(k==lenb)\n\t\t{\n\t\t\tk=next[k];\n\t\t\tprintf(\"%d\\n\",i-lenb+1);\n\t\t}\n\t}\n\tfor(int i=1;i<=lenb;i++)\n\t{\n\t\tprintf(\"%d \",next[i]);\n\t}\n\treturn 0;\n}\n```\n$100$\u5206\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n#include <cstring>\nlong long next[1000001],num[1000001];\nchar sta[1000001];\nint main()\n{\n\tlong long now=1,t=0;\n\tscanf(\"%lld\",&t);\n\twhile(now<=t)\n\t{\n\t\tscanf(\"%s\",sta);\n\t\tlong long lena=strlen(sta),k=0;\n\t\tnext[0]=-1,next[1]=0;\n\t\tnum[0]=0,num[1]=1;\n\t\tlong long ans=1;\n\t\tfor(long long i=1;i<=lena-1;i++)\n\t\t{\n\t\t\twhile(k>=0 && sta[i]!=sta[k])\n\t\t\t{\n\t\t\t\tk=next[k];\n\t\t\t}\n\t\t\tnext[i+1]=++k;\n\t\t\tnum[i+1]=num[k]+1;\n\t\t}\n\t\tk=0;\n\t\tfor(long long i=1;i<=lena-1;i++)\n\t\t{\n\t\t\twhile(k>=0 && sta[i]!=sta[k])\n\t\t\t{\n\t\t\t\tk=next[k];\n\t\t\t}\n\t\t\tk++;\n\t\t\twhile((k*2)>(i+1))\n\t\t\t{\n\t\t\t\tk=next[k];\n\t\t\t}\n\t\t\tans*=num[k]+1;\n\t\t\tans%=1000000007;\n\t\t}\n\t\tprintf(\"%lld\",ans);\n\t\tif(now<=t-1)\n\t\t{\n\t\t\tprintf(\"\\n\");\n\t\t}\n\t\tnow++;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1518924721,
        "uid": 48269,
        "name": "Drinkkk",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2375 \u3010[NOI2014]\u52a8\u7269\u56ed\u3011"
    }
]