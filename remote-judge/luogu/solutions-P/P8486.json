[
    {
        "content": "\u573a\u4e0a\u5c31\u4e00\u4e2a\u4eba AC\uff0c\u600e\u4e48\u56de\u4e8b\u5462\uff1f\n\n\u6837\u4f8b\u7ed9\u7684\u505a\u6cd5\u63d0\u793a\u5f88\u660e\u663e\uff0c\u5c31\u662f \u6709 $k$ \u4e2a\u9009\u624b\u8fc7\u7ebf\u6982\u7387 \u4e58\u4ee5 \u7ed9 $k$ \u4e2a\u9009\u624b\u5206\u914d\u7684\u671f\u671b\u4ef7\u503c \u518d\u6c42\u548c\u3002\n\n\u6709 $k$ \u4e2a\u4eba\u8fc7\u7ebf\u7684\u6982\u7387\u5f88\u7b80\u5355\uff0c\u5c31\u662f $[x^k]\\prod_i((1-p_i)+p_ix)$\uff0c\u5206\u6cbb\u4e58\u5373\u53ef\u3002\n\n\u7136\u540e\u9700\u8981\u8ba1\u7b97\u7ed9 $k$ \u4e2a\u9009\u624b\u5206\u914d\u7684\u4ef7\u503c\u603b\u548c\u3002\u5bf9\u4e8e\u8fd9\u79cd\u7ecf\u5178\u6a21\u578b\uff0c\u5bf9\u6bcf\u79cd\u5956\u54c1\u5efa\u7acb EGF\uff0c\u7136\u540e\u90fd\u4e58\u8d77\u6765\uff0c\u4e5f\u5c31\u662f\uff1a\n\n$$k![x^k]\\prod_{i=1}^A(1+a_i(\\cosh x-1))\\times \\prod_{i=1}^B(b_i \\sinh x)$$\n\u540e\u4e00\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u524d\u4e00\u90e8\u5206\u6709\u4e2a\u66b4\u529b\u505a\u6cd5\uff1a\u505a\u6362\u5143 $u=\\text e^x$\uff0c\u7136\u540e\u76f4\u63a5\u5206\u6cbb\u4e58\uff0c\u6700\u540e\u5c31\u662f\u6c42 $F(\\text e^x)$ \u7684\u7cfb\u6570\u3002\n\n$$k![x^k]F(\\text e^x)=\\sum_{i=-A}^Af_i i^k$$\n$$=[x^k]\\sum_{k=0}^\\infty x^k\\sum_{i=-A}^Af_i i^k =[x^k]\\sum_{i=-A}^A\\frac{f_i}{1-ix}$$\n\u53ef\u4ee5\u76f4\u63a5\u7ef4\u62a4\u5206\u5b50\u548c\u5206\u6bcd\u5206\u6cbb\u6c42\u548c\u3002\n\n\u6700\u540e\u628a\u603b\u548c\u53d8\u4e3a\u671f\u671b\u5c31\u662f\u9664\u4e00\u4e2a\u65b9\u6848\u6570\uff0c\u4ee4 $a_i,b_i$ \u90fd\u4e3a $1$ \u5c31\u662f\u7b54\u6848\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff08\u6ca1\u592a\u6ce8\u610f\u5b9e\u73b0\u7ec6\u8282\uff0c\u8dd1\u5f97\u6bd4\u8f83\u6162\uff09\uff1a\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#define N 1048579\n#define p 998244353\n#define ll long long\nusing namespace std;\n\ninline void read(int &x){\n\tx = 0;\n\tchar c = getchar();\n\twhile(c<'0'||c>'9') c = getchar();\n\twhile(c>='0'&&c<='9'){\n\t\tx = (x<<3)+(x<<1)+(c^48);\n\t\tc = getchar();\n\t}\n}\n\nvoid print(int x){\n\tif(x>9) print(x/10);\n\tputchar(x%10+'0');\t\n}\n\ninline int power(int a,int t){\n    int res = 1;\n    while(t){\n        if(t&1) res = (ll)res*a%p;\n        a = (ll)a*a%p;\n        t >>= 1;\n    }\n    return res;\n}\n\ninline int add(const int& x,const int& y){ return x+y>=p?x+y-p:x+y; }\ninline int dec(const int& x,const int& y){ return x<y?x-y+p:x-y; }\n\nint rt[N],rev[N],fac[N],ifac[N],inv[N];\nint siz;\n\nvoid init(int n){\n\tint w,lim = 1;\n\twhile(lim<=n) lim <<= 1,++siz;\n\tfor(int i=1;i!=lim;++i) rev[i] = (rev[i>>1]>>1)|((i&1)<<(siz-1));\n\tw = power(3,(p-1)>>siz);\n\tinv[1] = fac[0] = fac[1] = ifac[0] = ifac[1] = rt[lim>>1] = 1;\n\tfor(int i=(lim>>1)+1;i!=lim;++i) rt[i] = (ll)rt[i-1]*w%p;\n\tfor(int i=(lim>>1)-1;i;--i) rt[i] = rt[i<<1];\t\n    for(int i=2;i<=n;++i) fac[i] = (ll)fac[i-1]*i%p;\n    ifac[n] = power(fac[n],p-2);\n    for(int i=n-1;i;--i) ifac[i] = (ll)ifac[i+1]*(i+1)%p;\n    for(int i=2;i<=n;++i) inv[i] = (ll)fac[i-1]*ifac[i]%p;\n}\n\ninline void dft(int *f,int n){\n    static unsigned long long a[N];\n    int x,shift = siz-__builtin_ctz(n);\n    for(int i=0;i!=n;++i) a[rev[i]>>shift] = f[i];\n    for(int mid=1;mid!=n;mid<<=1)\n    for(int j=0;j!=n;j+=(mid<<1))\n    for(int k=0;k!=mid;++k){\n        x = a[j|k|mid]*rt[mid|k]%p;\n        a[j|k|mid] = a[j|k]+p-x;\n        a[j|k] += x;\n    }\n    for(int i=0;i!=n;++i) f[i] = a[i]%p;\n}\n\ninline void idft(int *f,int n){\n    reverse(f+1,f+n);\n    dft(f,n);\n    int x = p-((p-1)>>__builtin_ctz(n));\n    for(int i=0;i!=n;++i) f[i] = (ll)f[i]*x%p;\n}\n\ninline int getlen(int n){ return 1<<(32-__builtin_clz(n)); }\n\ninline void inverse(const int *f,int n,int *r){\n    static int g[N],h[N],st[30];\n    memset(g,0,getlen(n<<1)<<2);\n    int lim = 1,top = 0;\n    while(n){\n        st[++top] = n;\n        n >>= 1;\n    }\n    g[0] = 1;\n    while(top--){\n        n = st[top+1];\n        while(lim<=(n<<1)) lim <<= 1;\n        memcpy(h,f,(n+1)<<2);\n        memset(h+n+1,0,(lim-n)<<2);\n        dft(g,lim),dft(h,lim);\n        for(int i=0;i!=lim;++i) g[i] = g[i]*(2-(ll)g[i]*h[i]%p+p)%p;\n        idft(g,lim);\n        memset(g+n+1,0,(lim-n)<<2);\n    }\n    memcpy(r,g,(n+1)<<2);\n}\n\nint n,A,B;\nint pr[N],a[N],C[N];\n\nvoid product(int l,int r,int *R){\n    if(l==r){\n        R[0] = p+1-pr[l],R[1] = pr[l];\n        return;\n    }\n    int lim = getlen(r-l+1),mid = (l+r)>>1;\n    int fl = mid-l+1,gl = r-mid;\n    int f[lim+2],g[lim+2];\n    product(l,mid,f),product(mid+1,r,g);\n    memset(f+fl+1,0,(lim-fl)<<2);\n    memset(g+gl+1,0,(lim-gl)<<2);\n    dft(f,lim),dft(g,lim);\n    for(int i=0;i!=lim;++i) R[i] = (ll)f[i]*g[i]%p;\n    idft(R,lim);\n}\n\nvoid prod2(int l,int r,int *R){\n    if(l==r){\n        R[0] = R[2] = a[l],R[1] = ((p+1-a[l])<<1)%p;\n        return;\n    }\n    int lim = getlen((r-l+1)<<1),mid = (l+r)>>1;\n    int fl = (mid-l+1)<<1,gl = (r-mid)<<1;\n    int f[lim+2],g[lim+2];\n    prod2(l,mid,f),prod2(mid+1,r,g);\n    memset(f+fl+1,0,(lim-fl)<<2);\n    memset(g+gl+1,0,(lim-gl)<<2);\n    dft(f,lim),dft(g,lim);\n    for(int i=0;i!=lim;++i) R[i] = (ll)f[i]*g[i]%p;\n    idft(R,lim);\n}\n\nvoid solve(int l,int r,const int *sc,int *fz,int *fm){ // \u591a\u9879\u5f0f\u590d\u5408 F(e^x)\n    if(l==r){\n        fz[0] = sc[l+A],fm[0] = 1,fm[1] = (p-l)%p;\n        return;\n    }\n    int lim = getlen(r-l+1),mid = (l+r)>>1;\n    int fl = mid-l+1,gl = r-mid;\n    int lfz[lim+2],lfm[lim+2],rfz[lim+2],rfm[lim+2];\n    solve(l,mid,sc,lfz,lfm),solve(mid+1,r,sc,rfz,rfm);\n    memset(lfz+fl,0,(lim-fl+1)<<2),memset(lfm+fl+1,0,(lim-fl)<<2);\n    memset(rfz+gl,0,(lim-gl+1)<<2),memset(rfm+gl+1,0,(lim-gl)<<2);\n    dft(lfz,lim),dft(lfm,lim),dft(rfz,lim),dft(rfm,lim);\n    for(int i=0;i!=lim;++i){\n        fz[i] = ((ll)lfz[i]*rfm[i]+(ll)lfm[i]*rfz[i])%p;\n        fm[i] = (ll)lfm[i]*rfm[i]%p;\n    }\n    idft(fz,lim),idft(fm,lim);\n}\n\ninline void deriv(const int *f,int n,int *R){\n    for(int i=1;i!=n;++i) R[i-1] = (ll)i*f[i]%p;\n    R[n-1] = 0;\n}\n\ninline void integ(const int *f,int n,int *R){\n    for(int i=n-1;i;--i) R[i] = (ll)f[i-1]*inv[i]%p;\n    R[0] = 0;\n}\n\ninline void log(const int *f,int n,int *r){\n    static int g[N],h[N];\n    inverse(f,n,g);\n    deriv(f,n+1,h);\n    int lim = getlen(n<<1);\n    memset(g+n+1,0,(lim-n)<<2);\n    memset(h+n+1,0,(lim-n)<<2);\n    dft(g,lim),dft(h,lim);\n    for(int i=0;i!=lim;++i) g[i] = (ll)g[i]*h[i]%p;\n    idft(g,lim);\n    integ(g,n+1,r);\n}\n\ninline void exp(const int *a,int n,int *R){\n    int m = n+1;\n    n = 1;\n    while(n<m) n <<= 1;\n    static int der[N],b[N],c[N],dfta[N],dftb[N],dftb2[N],dftc[N];\n    for(int i=0;i!=n;++i) b[i] = c[i] = dfta[i] = dftb[i] = dftb2[i] = dftc[i] = 0;\n    dftb2[0] = b[0] = c[0] = 1;\n    dft(dftb2,2);\n    deriv(a,n,der);\n    for(int d=1;d!=n;d<<=1){\n        memcpy(dftc,c,d<<2);\n        dft(dftc,d<<1);\n        for(int i=0;i!=d;++i) dftb[i] = (ll)dftb2[i<<1]*dftc[i<<1]%p;\n        idft(dftb,d);\n        dftb[0] = dec(dftb[0],1);\n        for(int i=0;i!=d;++i) dftb[d+i] = dftb[i];\n        memset(dftb,0,d<<2);\n        dft(dftb,d<<1);\n        memcpy(dfta,der,(d-1)<<2);\n        dfta[d-1] = 0;\n        dft(dfta,d<<1);\n        for(int i=0;i!=(d<<1);++i) dfta[i] = (ll)dfta[i]*dftb[i]%p;\n        idft(dfta,d<<1);\n        deriv(b,d,dftb);\n        dft(dftb,d);\n        for(int i=0;i!=d;++i) dftb[i] = (ll)dftb[i]*dftc[i<<1]%p;\n        idft(dftb,d);\n        for(int i=0;i!=d-1;++i) dftb[d+i] = dec(dftb[i],der[i]);\n        memset(dftb,0,(d-1)<<2);\n        for(int i=d-1;i!=(d<<1);++i) dftb[i] = dec(dftb[i],add(der[i],dfta[i]));\n        integ(dftb,d<<1,dftb);\n        dft(dftb,d<<1);\n        for(int i=0;i!=(d<<1);++i) dftb[i] = (ll)dftb[i]*dftb2[i]%p;\n        idft(dftb,d<<1);\n        for(int i=d;i!=(d<<1);++i) b[i] = p-dftb[i];\n        if((d<<1)==n) continue;\n        memcpy(dftb2,b,d<<3);\n        dft(dftb2,d<<2);\n        for(int i=0;i!=(d<<1);++i) dftb[i] = (ll)dftb2[i<<1]*dftc[i]%p;\n        idft(dftb,d<<1);\n        memset(dftb,0,d<<2);\n        dft(dftb,d<<1);\n        for(int i=0;i!=(d<<1);++i) dftb[i] = (ll)dftb[i]*dftc[i]%p;\n        idft(dftb,d<<1);\n        for(int i=d;i!=(d<<1);++i) c[i] = p-dftb[i];\n    }\n    memcpy(R,b,m<<2);\n}\n\nint f[N],g[N],fz[N],fm[N],suf[N];\nint pw,ans;\n\nint main(){\n\tread(n),read(A),read(B);\n    if(n<B){\n        puts(\"0\");\n        return 0;\n    }\n    init(800000);\n    for(int i=1;i<=n;++i) read(pr[i]);\n    for(int i=1;i<=A;++i) read(a[i]);\n    product(1,n,C),prod2(1,A,f);\n    solve(-A,A,f,fz,fm); \n    for(int i=n+1;i<=(A<<1);++i) fz[i] = fm[i] = 0;\n    inverse(fm,n,fm);\n    int lim = getlen(n<<1);\n    dft(fz,lim),dft(fm,lim);\n    for(int i=0;i!=lim;++i) fz[i] = (ll)fz[i]*fm[i]%p;\n    idft(fz,lim);\n    memset(fz+n+1,0,(lim-n)<<2),memset(f,0,lim<<2);\n    for(int i=0;i<=n;++i) fz[i] = (ll)fz[i]*ifac[i]%p;\n    int tn = max((n-B)>>1,4);\n    for(int i=0;i<=tn;++i) f[i] = ifac[i<<1|1];\n    log(f,tn,f);\n    for(int i=0;i<=tn;++i) f[i] = (ll)f[i]*B%p;\n    exp(f,tn,f);\n    for(int i=tn;i;--i) f[i<<1] = f[i],f[i] = 0;\n    for(int i=n;i>=B;--i) f[i] = f[i-B];\n    memset(f,0,B<<2),memset(f+n+1,0,(lim-n)<<2);\n    for(int i=0;(i<<1)<=n;++i) g[i] = ifac[i<<1];\n    log(g,n>>1,g);\n    for(int i=0;(i<<1)<=n;++i) g[i] = (ll)g[i]*A%p;\n    exp(g,n>>1,g);\n    for(int i=(n>>1);i;--i) g[i<<1] = g[i],g[i] = 0;\n    dft(fz,lim),dft(f,lim),dft(g,lim);\n    for(int i=0;i!=lim;++i){\n        fz[i] = (ll)fz[i]*f[i]%p;\n        g[i] = (ll)g[i]*f[i]%p;\n    }\n    idft(fz,lim),idft(g,lim);\n    suf[n+1] = 1;\n    for(int i=n;i;--i) suf[i] = (ll)suf[i+1]*(g[i]==0?1:g[i])%p;\n    int pre = power(suf[1],p-2);\n    for(int i=1;i<=n;++i){\n        ans = (ans+(ll)fz[i]*C[i]%p*pre%p*suf[i+1])%p;\n        pre = (ll)pre*(g[i]==0?1:g[i])%p;\n    }\n    for(int i=1;i<=B;++i){\n        read(pw);\n        ans = (ll)ans*pw%p;\n    }\n    ans = (ll)ans*power(2,p-A-1)%p;\n    print(ans);\n\treturn 0;\n}\n```",
        "postTime": 1661007194,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "HGOI div1 E \u9898\u89e3"
    },
    {
        "content": "\u6839\u636e\u9898\u610f\uff0c\u79ef\u6781\u6027\u7684\u671f\u671b\u5c31\u662f\u6bcf\u79cd\u65b9\u6848\u7684\u79ef\u6781\u6027 $\\times$ \u8fd9\u79cd\u65b9\u6848\u7684\u6982\u7387\u3002\r\n\r\n\u5f62\u5f0f\u5316\u7684\uff0c\u6211\u4eec\u8bb0 $P_k$ \u8868\u793a\u6700\u7ec8\u6709 $k$ \u4e2a\u4eba\u8fbe\u5230\u5206\u6570\u7ebf\u7684\u6982\u7387\uff0c$F_k$ \u8868\u793a\u7ed9 $k$ \u4e2a\u4eba\u53d1\u5956\u54c1\u7684\u65b9\u6848\u6570\uff0c$val_k$ \u8868\u793a\u7ed9 $k$ \u4e2a\u4eba\u53d1\u5956\u54c1\u6240\u6709\u65b9\u6848\u7684\u79ef\u6781\u6027\u4e4b\u548c\u3002\r\n\r\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u79cd\u53d1\u7ed9 $k$ \u4e2a\u4eba\u5956\u54c1\u7684\u65b9\u6848\u5176\u6982\u7387\u4e3a $\\dfrac{P_k}{F_k}$\u3002\r\n\r\n\u5219\u6700\u7ec8\u671f\u671b $E=\\sum\\limits_{k=0}^n \\dfrac{P_k\\times val_k}{F_k}$\u3002\r\n\r\n\u4e0b\u9762\u8003\u8651\u5206\u522b\u6c42\u51fa $P_k$\uff0c$F_k$\uff0c$val_k$\u3002\r\n\r\n$P_k$\uff1a\r\n\r\n\u663e\u7136\u53ef\u4ee5 $O(n^2)$ \u8fdb\u884c $\\tt{DP}$\u3002\u8bb0 $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u4eba\u4e2d\u6709 $j$ \u4e2a\u4eba\u8fbe\u5230\u5206\u6570\u7ebf\u7684\u6982\u7387\u3002\u90a3\u4e48\u6709 $f_{0,0}=1$\uff0c$f_{i,j}=f_{i-1,j}\\times (1-p_i)+f_{i-1,j-1}\\times p_i$\u3002\r\n\r\n\u4f46\u8fd9\u4e2a\u590d\u6742\u5ea6\u663e\u7136\u4e0d\u80fd\u63a5\u53d7\u3002\u5957\u8def\u6027\u7684\uff0c\u6211\u4eec\u8003\u8651\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570 $\\sum\\limits_{k=0}^n P_kx^k$\u3002\u800c\u6bcf\u4e2a\u4eba\u7684\u751f\u6210\u51fd\u6570\u5373\u4e3a $1-p_i+p_ix$\u3002\r\n\r\n\u5219 $\\sum\\limits_{k=0}^n P_kx^k = \\prod\\limits_{i=1}^n (1-p_i+p_ix)$\u3002\r\n\r\n\u666e\u901a\u5206\u6cbb\u4e58\u6cd5\u5c31\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\r\n\r\n$F_k$\uff1a\r\n\r\n\u6709 $O((A+B)n^2)$ \u7684 $\\tt{DP}$\uff0c\u8bb0 $f_{i,j}$ \u8868\u793a\u7528\u524d $i$ \u4e2a \u5956\u54c1\u53d1\u7ed9 $j$ \u4e2a\u4eba\u7684\u65b9\u6848\u6570\u3002\r\n\r\n\u679a\u4e3e\u7b2c $i$ \u4e2a\u5956\u54c1\u7528\u4e86\u591a\u5c11\u4e2a\u548c\u53d1\u7ed9\u591a\u5c11\u4eba\u3002\r\n\r\n\u5bf9\u4e8e $\\text{A}$ \u7c7b\u5956\u54c1\u6709\u8f6c\u79fb $f_{i,j}=\\sum\\limits_{k\\text{\u4e3a\u5076\u6570}}^j f_{i-1,j-k}\\times \\binom{j}{k}$\u3002\r\n\r\n\u5bf9\u4e8e $\\text{B}$ \u7c7b\u5956\u54c1\u6709\u8f6c\u79fb $f_{i,j}=\\sum\\limits_{k\\text{\u4e3a\u5947\u6570}}^j f_{i-1,j-k}\\times \\binom{j}{k}$\u3002\r\n\r\n\u4e0d\u96be\u53d1\u73b0\u8f6c\u79fb\u8fc7\u7a0b\u7c7b\u4f3c\u5377\u79ef\uff0c\u4f46\u4e0d\u5b8c\u5168\u4e00\u6837\u3002\u5957\u8def\u7684\u5c06\u7ec4\u5408\u6570\u5199\u6210\u9636\u4e58\u7684\u5f62\u5f0f\u3002\r\n\r\n\u5373\u5bf9\u4e8e $\\text{A}$ \u7c7b\u5956\u54c1\u6709\u8f6c\u79fb $f_{i,j}=\\sum\\limits_{k\\text{\u4e3a\u5076\u6570}}^j f_{i-1,j-k}\\times \\dfrac{j!}{k!\\times (j-k)!}=j!\\times \\sum\\limits_{k\\text{\u4e3a\u5076\u6570}}^j \\dfrac{f_{i-1,j-k}}{(j-k)!}\\times \\dfrac{1}{k!}$\u3002\r\n\r\n\u4e0d\u8003\u8651 $j!$ \u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53ef\u4ee5\u7528 $\\tt{NTT}$ \u4f18\u5316\u4e86\u3002\r\n\r\n\u5bf9\u4e8e $\\text{B}$ \u7c7b\u5956\u54c1\u4e5f\u662f\u4e00\u6837\u7684\u3002\u590d\u6742\u5ea6 $O((A+B)n\\log n)$\u3002\r\n\r\n\u4e0d\u96be\u53d1\u73b0\u6bcf\u6b21\u5377\u7684\u591a\u9879\u5f0f\u90fd\u662f\u4e00\u6837\u7684\u3002\r\n\r\n\u5bf9\u4e8e $\\text{A}$ \u7c7b\uff0c\u6bcf\u4e2a\u5956\u54c1\u7684\u751f\u6210\u51fd\u6570\u5747\u4e3a $1+\\dfrac{x^2}{2!}+\\dfrac{x^4}{4!}\\cdots$\u3002\r\n\r\n\u5373\u6700\u7ec8\u7684\u7ed3\u679c\u5373\u4e3a $(1+\\dfrac{x^2}{2!}+\\dfrac{x^4}{4!}\\cdots)^A$\u3002\r\n\r\n[\u591a\u9879\u5f0f\u5feb\u901f\u5e42](https://www.luogu.com.cn/problem/P5245)  \u5373\u53ef\u3002\r\n\r\n\u5bf9\u4e8e $\\text{B}$ \u7c7b\uff0c\u6bcf\u4e2a\u5956\u54c1\u7684\u751f\u6210\u51fd\u6570\u4e3a $\\dfrac{x}{1!}+\\dfrac{x^3}{3!}\\cdots$\u3002\r\n\r\n\u800c $(\\dfrac{x}{1!}+\\dfrac{x^3}{3!}\\cdots)^B$ \u7531\u4e8e\u5e38\u6570\u9879\u4e0d\u4e3a $1$\uff0c\u6709\u4e24\u79cd\u5904\u7406\u65b9\u5f0f\uff1a\r\n\r\n1. \u8f6c\u5316\u4e3a $x^B(\\dfrac{1}{1!}+\\dfrac{x^2}{3!}\\cdots)^B$ \u76f4\u63a5\u5feb\u901f\u5e42\u5373\u53ef\u3002\r\n\r\n2. [\u591a\u9879\u5f0f\u5e42\u51fd\u6570\uff08\u52a0\u5f3a\u7248\uff09](https://www.luogu.com.cn/problem/P5273)\u3002\r\n\r\n\u6700\u540e\u518d\u5c06 $\\text{A}$\uff0c$\\text{B}$ \u4e24\u7c7b\u7684\u65b9\u6848\u6570\u5377\u8d77\u6765\u4e58\u4e0a $k!$ \u5c31\u53ef\u4ee5\u5f97\u5230 $F_k$\u3002\r\n\r\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\r\n\r\n$val_k$\uff1a\r\n\r\n$\\tt{DP}$ \u505a\u6cd5\u53ca\u4f18\u5316\u548c\u6c42\u65b9\u6848\u6570\u4e00\u6837\uff0c\u53ea\u9700\u591a\u4e58\u4e00\u4e2a\u4ef7\u503c\u3002\r\n\r\n\u5bf9\u4e8e $\\text{B}$ \u7c7b\uff0c\u6bcf\u79cd\u5956\u54c1\u4ef7\u503c\u7684\u751f\u6210\u51fd\u6570\u4e3a $b_i(\\dfrac{x}{1!}+\\dfrac{x^3}{3!}\\cdots)$\u3002\r\n\r\n\u5219 $\\text{B}$ \u7c7b\u7684\u65b9\u6848\u4ef7\u503c\u751f\u6210\u51fd\u6570\u5373\u4e3a $(\\dfrac{x}{1!}+\\dfrac{x^3}{3!}\\cdots)^B \\prod\\limits_{i=1}^B b_i$\u3002\r\n\r\n\u5c06\u4e4b\u524d\u6c42\u8fc7\u7684\u65b9\u6848\u6570\u4e58\u4e0a $\\prod\\limits_{i=1}^B b_i$ \u5373\u53ef\u3002\r\n\r\n\u5bf9\u4e8e $\\text{A}$ \u7c7b\uff0c\u6bcf\u79cd\u5956\u54c1\u4ef7\u503c\u7684\u751f\u6210\u51fd\u6570\u4e3a $1+\\dfrac{a_i}{2!}x^2+\\dfrac{a_i}{4!}x^4\\cdots$\u3002\r\n\r\n\u8fd9\u4e2a\u4e1c\u897f\u663e\u7136\u4e0d\u80fd\u7528\u5feb\u901f\u5e42\u505a\u3002\u8003\u8651\u5176\u6307\u6570\u578b\u751f\u6210\u51fd\u6570 $\\tt{EGF}$\u3002\r\n\r\n\u7531 $e^x=\\sum\\limits_{k=0}^{\\infty} \\dfrac{x^k}{k!}$\uff0c$e^{-x}=\\sum\\limits_{k=0}^{\\infty} (-1)^k\\dfrac{x^k}{k!}$\u3002\r\n\r\n\u5219 $1+\\dfrac{x^2}{2!}+\\dfrac{x^4}{4!}\\cdots=\\dfrac{e^x+e^{-x}}{2}$\u3002\r\n\r\n$1+\\dfrac{a_i}{2!}x^2+\\dfrac{a_i}{4!}x^4\\cdots=a_i(\\dfrac{e^x+e^{-x}}{2}-1)+1$\u3002\r\n\r\n$\\prod\\limits_{i=1}^A (1+\\dfrac{a_i}{2!}x^2+\\dfrac{a_i}{4!}x^4\\cdots)=\\prod\\limits_{i=1}^A (a_i(\\dfrac{e^x+e^{-x}}{2}-1)+1)$\u3002\r\n\r\n\u8003\u8651\u5c06\u4e0a\u8ff0\u5f0f\u5b50\u5c55\u5f00\u540e\uff0c\u518d\u5c06 $e^{kx}$ \u6cf0\u52d2\u5c55\u5f00\u56de\u666e\u901a\u578b\u751f\u6210\u51fd\u6570\u3002\r\n\r\n\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\uff0c\u5148\u5c06 $e^{-x}$ \u63d0\u51fa\u6765\u3002\r\n\r\n$\\prod\\limits_{i=1}^A (a_i(\\dfrac{e^x+e^{-x}}{2}-1)+1)=e^{-Ax}\\prod\\limits_{i=1}^A(\\dfrac{a_i}{2}e^{2x}+(1-a_i)e^x+\\dfrac{a_i}{2})$\u3002\r\n\r\n\u5c06 $e^x$ \u770b\u6210 $x$\u3002\u7528\u5206\u6cbb\u4e58\u6cd5\u5c06\u5176\u5c55\u5f00\u3002\u5f97\u5230\u4e00\u4e2a\u5f62\u5982 $\\sum\\limits_{i=0}^{2A} c_ie^{i-A}$ \u7684\u591a\u9879\u5f0f\u3002\r\n\r\n\u63a5\u4e0b\u6765\u5c31\u662f\u5c06 $e^{kx}$ \u6cf0\u52d2\u5c55\u5f00\u3002\r\n\r\n\u5373\u5bf9\u4e8e\u6bcf\u4e2a $k\\in[1,n]$\uff0c\u6c42\u51fa $\\sum\\limits_{i=0}^{2A}c_i(i-A)^k$\u3002\r\n\r\n\u5f53 $c_i=1$ \u65f6\uff0c\u5c31\u662f\u76f4\u63a5\u6c42\u81ea\u7136\u6570\u5e42\u548c\uff08\u53ef\u53c2\u8003[calc\u52a0\u5f3a\u7248](https://www.luogu.com.cn/problem/P5850)\u6216[[THUPC2017] \u5c0f L \u7684\u8ba1\u7b97\u9898](https://www.luogu.com.cn/problem/P7431)\uff09\u3002\r\n\r\n\u5bf9\u4e8e\u4efb\u610f\u60c5\u51b5\uff1a\r\n\r\n\u540c\u6837\u8003\u8651\u6700\u7ec8\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570 $G(x)=\\sum\\limits_{k=0}^{\\infty}x^k\\sum\\limits_{i=0}^{2A}c_i(i-A)^k$\u3002\r\n\r\n\u56e0\u4e3a $\\sum\\limits_{k=0}^{\\infty}a^kx^k=\\dfrac{1}{1-ax}$\u3002\r\n\r\n\u6240\u4ee5 $G(x)=\\sum\\limits_{i=0}^{2A}\\dfrac{c_i}{1-(i-A)x}$\u3002\r\n\r\n\u76f4\u63a5\u901a\u5206\uff1a\r\n\r\n$$G(x)=\\dfrac{\\sum\\limits_{i=0}^{2A}c_i\\prod\\limits_{j=0,j\\ne i}^{2A}(1-(j-A)x)}{\\prod\\limits_{i=0}^{2A}{(1-(i-A)x)}}$$\r\n\r\n\u540c\u6837\u8003\u8651\u7528\u5206\u6cbb\u6c42\u89e3\u4e0a\u8ff0\u5f0f\u5b50\u3002\r\n\r\n\u6211\u4eec\u8bb0 $A(l,r)=\\sum\\limits_{i=l}^{r}c_i\\prod\\limits_{j=l,j\\ne i}^r(1-(j-A)x)$\uff0c$B(l,r)=\\prod\\limits_{i=l}^{r}{(1-(i-A)x)}$\u3002\r\n\r\n\u4e0d\u96be\u53d1\u73b0 $A(l,r)=A(l,mid)\\times B(mid+1,r)+A(mid+1,r)\\times B(l,mid)$\uff0c$B(l,r)=B(l,mid)\\times B(mid+1,r)$\u3002\r\n\r\n\u76f4\u63a5\u5206\u6cbb\u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\r\n\r\n\u800c\u4e4b\u524d\u6c42\u65b9\u6848\u6570\u540c\u6837\u53ef\u4ee5\u8003\u8651\u7528\u4e0a\u8ff0\u5206\u6cbb\u65b9\u6cd5\u5b8c\u6210\u3002\u5e76\u4e14\u7531\u4e8e\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u7684\u5927\u5e38\u6570\uff0c\u4e24\u8005\u7684\u6548\u7387\u5dee\u4e0d\u591a\u3002\r\n\r\n\u7efc\u4e0a\u6700\u7ec8\u7684\u590d\u6742\u5ea6\u4e3a $O(n\\log^2n)$\u3002\r\n\r\n\u793a\u4f8b\u4ee3\u7801\uff1a\r\n```cpp\r\nnamespace work_A\r\n{\r\n\t#define mid ((l+r)>>1)\r\n\tpoly tA,tB;\r\n\tinline poly solve(int l,int r)\r\n\t{\r\n\t\tif(l==r)return r=1ll*inv[2]*a[l]%mod,(poly{r,sub(1-a[l]),r});\r\n\t\treturn Get_Mul(solve(l,mid),solve(mid+1,r),-1);\r\n\t}\r\n\tPoly tp;\r\n\tPoly work(Poly L,Poly R)\r\n\t{\r\n\t\tint lim=1,p=0,Lb=L.b.size(),Rb=R.b.size();\r\n\t\tfor(;lim<Lb+Rb;lim<<=1,p++);\r\n\t\tL.resize(lim),R.resize(lim);\r\n\t\tDFT(L.a),DFT(L.b),DFT(R.a),DFT(R.b);\r\n\t\tfor(int i=0;i!=lim;++i)L.a[i]=(1ll*L.a[i]*R.b[i]+1ll*R.a[i]*L.b[i])%mod;\r\n\t\tdot(L.b,R.b),IDFT(L.a),IDFT(L.b);\r\n\t\tL.resize(min(Lb+Rb-1,n+1));\r\n\t\treturn L;\r\n\t}\r\n\tPoly solve2(int l,int r)\r\n\t{\r\n\t\tif(l==r)return (Poly){{tA[l]},{1,sub(-tB[l])}};\r\n\t\treturn work(solve2(l,mid),solve2(mid+1,r));\r\n\t}\r\n\tinline Poly main()\r\n\t{\r\n\t\ttA=solve(1,A);   //\u5206\u6cbb\u6c42((a_ie^2x+a_i)/2+(1-a_i)e^x) \r\n\t\ttB.resize(tA.size());\r\n\t\tfor(int i=0;i<(int)tA.size();i++)tB[i]=i-A;\r\n\t\tif((int)tA.size()<n)tA.resize(n),tB.resize(n);\r\n\t\t//\u5206\u6cbb\u5c55\u5f00 e^kx \r\n\t\ttp=solve2(0,tA.size()-1);\r\n\t\ttp.b=Get_Inv(tp.b,tp.b.size());\r\n\t\ttp.a=Get_Mul(tp.a,tp.b,n+1);\r\n\t\tfor(int i=0;i<=n;i++)tp.a[i]=1ll*tp.a[i]*ifac[i]%mod;\r\n\t\t//ksm\u6c42A\u7684\u65b9\u6848\u6570 \r\n\t\ttp.b.resize(n+1);\r\n\t\tfor(int i=0;i<=n;i++)(i&1)?tp.b[i]=0:tp.b[i]=ifac[i];\r\n\t\ttp.b=Get_Ksm(tp.b,n+1,A);\r\n\t\treturn tp;\r\n\t}\r\n}\r\nnamespace work_B\r\n{\r\n\tPoly tp;\r\n\tinline Poly main()\r\n\t{\r\n\t\t//ksm\u6c42B\u7684\u65b9\u6848\u6570\u548c\u4ef7\u503c \r\n\t\ttp.resize(n+1);\r\n\t\tfor(int i=0;i<=n;i+=2)tp.b[i]=ifac[i+1];\r\n\t\ttp.b=Get_Ksm(tp.b,n+1,B);\r\n\t\tfor(int i=n;i-B>=0;i--)tp.b[i]=tp.b[i-B];\r\n\t\tfor(int i=0;i<B;i++)tp.b[i]=0;\r\n\t\tint mul=1;\r\n\t\tfor(int i=1;i<=B;i++)mul=1ll*mul*b[i]%mod;\r\n\t\tfor(int i=B;i<=n;i+=2)tp.a[i]=1ll*tp.b[i]*mul%mod;\r\n\t\treturn tp;\r\n\t}\r\n}\r\nnamespace work_P\r\n{\r\n\tpoly solve(int l,int r)\r\n\t{\r\n\t\tif(l==r)return poly{sub(1-p[l]),p[l]};\r\n\t\treturn Get_Mul(solve(l,(l+r)>>1),solve(((l+r)>>1)+1,r));\r\n\t}\r\n\tinline poly main(){return solve(1,n);}//\u5206\u6cbb\u6c42 P \r\n}\r\ninline poly merge(Poly a,Poly b)//\u5408\u5e76A\uff0cB \r\n{\t\r\n\ta.a=Get_Mul(a.a,b.a,n+1);\r\n\ta.b=Get_Mul(a.b,b.b,n+1);\r\n\tfor(int i=B;i<=n;i+=2)a.a[i]=1ll*a.a[i]*ksm(a.b[i],mod-2)%mod;\r\n\treturn a.a;\r\n}\r\nint main()\r\n{\r\n\tn=read(),A=read(),B=read();\r\n\ta.resize(A+1),b.resize(B+1),p.resize(n+1);\r\n\tfor(int i=1;i<=n;i++)p[i]=read();\r\n\tfor(int i=1;i<=A;i++)a[i]=read();\r\n\tfor(int i=1;i<=B;i++)b[i]=read();\r\n\tinit(N>>1);\r\n\tAB=merge(work_A::main(),work_B::main());\r\n\tP=work_P::main();\r\n\tfor(int i=B;i<=n;i+=2)ans=(ans+1ll*AB[i]*P[i])%mod;\r\n\tprintf(\"%d\\n\",ans);\r\n\treturn 0;\r\n}\r\n```\r\n",
        "postTime": 1650090721,
        "uid": 46091,
        "name": "uuku",
        "ccfLevel": 7,
        "title": "Competition \u9898\u89e3"
    },
    {
        "content": "\u573a\u4e0a\u88ab\u81ea\u5df1\u6f14\u4e86\u6ca1\u8fc7\uff0c\u5176\u5b9e\u8fd8\u662f\u633a\u7b80\u5355\u7684\u3002\n\n\u62c6\u6210\u8ba1\u7b97\u671f\u671b\u8fc7\u7ebf\u4eba\u6570\u548c\u6bcf\u4e2a\u8fc7\u7ebf\u4eba\u6570\u5bf9\u5e94\u7684\u671f\u671b\u4ef7\u503c\uff0c\u524d\u8005\u65e0\u975e\u662f\u4e00\u4e2a\u5206\u6cbb\u4e58\u3002\n\n\u540e\u8005\u5206\u5947\u3001\u5076\u4e24\u79cd\u5956\u54c1\uff0c\u5373\u8ba1\u7b97\uff1a\n\n$$\\prod(1+a_i(\\frac{e^x+e^{-x}}{2}-1))\\prod b_i(\\frac{e^x-e^{-x}}{2})$$\n\n\u540e\u534a\u8fb9\u5f88\u5bb9\u6613\u8003\u8651\uff0c\u524d\u534a\u90e8\u5206\u5148\u53d8\u4e00\u4e0b\u5f62\uff1a\n\n$$e^{-Ax}\\prod(\\frac{a_ie^{2x}}{2}+(1-a_i)e^x+\\frac{a_i}{2})$$\n\n\u6362\u5143\uff0c\u4ee4 $x$ \u4e3a $e^x$\uff0c\u90a3\u4e48\u5c31\u662f\u4e00\u4e2a\u5206\u6cbb\u4e58\uff0c\u4f46\u662f\u6211\u4eec\u8981\u8fd8\u539f\u7cfb\u6570\u3002\n\n\u5373\u5bf9\u4e8e\u6240\u6709 $k$\uff0c\u6c42\u51fa\uff1a\n\n$$\\sum_i f_ii^k$$\n\n\u6839\u636e [P7431 [THUPC2017] \u5c0f L \u7684\u8ba1\u7b97\u9898](https://www.luogu.com.cn/problem/P7431) \u7684\u6280\u5de7\uff0c\u6211\u4eec\u5373\u6c42\uff1a\n\n$$\\sum_kx^k\\sum_i f_ii^k=\\sum_if_i\\sum_k(ix)^k=\\sum_i\\frac{f_i}{1-ix}$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u76f4\u63a5\u5206\u6cbb\u901a\u5206\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002",
        "postTime": 1668476397,
        "uid": 105611,
        "name": "IdnadRev",
        "ccfLevel": 0,
        "title": "\u3010poly\u8bb0\u5f55\u3011P8486 \u300cHGOI-1\u300dCompetition"
    }
]