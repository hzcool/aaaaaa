[
    {
        "content": "\u4e00\u9053\u7ecf\u5178\u7684\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7ec3\u4e60\u9898\u3002\n\n---\n\n\u8fd9\u91cc\u89c4\u5b9a\u4e00\u4e0b\u53d8\u91cf\u540d\uff1a\n\n\u9898\u76ee\u4e2d\u7684 $d \\rightarrow k$\u3002\n\n\u9898\u76ee\u4e2d\u7684 $w \\rightarrow n$\u3002\n\n\u9898\u76ee\u4e2d\u7684 $n \\rightarrow N$\u3002\n\n---\n\n\u8003\u8651\u6784\u9020\uff1a\n\n$$ F(n)=\\sum_{i=1}^{n} i^k $$\n\n$$ G(n)=\\sum_{i=1}^{n} i^k[\\gcd(i, n)=1] $$\n\n\u5219\u6211\u4eec\u6700\u540e\u60f3\u8981\u7684\u7b54\u6848\u4e3a $G(N)$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u6709\uff1a\n\n$$ F(n)=\\sum_{d|n} d^k G\\left(\\frac{n}{d}\\right) $$\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5bf9\u5176\u505a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u5219\u6709\uff1a\n\n$$ G(n)=\\sum_{d|n} \\mu(d)d^k F\\left(\\frac{n}{d}\\right) $$\n\n\u6ce8\u610f\u5230 $F(n)$ \u4e8b\u5b9e\u4e0a\u662f\u5173\u4e8e $n$ \u7684 $k+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u5176\u8868\u793a\u4e3a $F(n)=\\sum_{i=0}^{k+1}f_i n^i$ \u7684\u5f62\u5f0f\u3002\n\n\u90a3\u4e48\u5bf9\u4e0a\u9762\u7684\u5f0f\u5b50\u5c55\u5f00\u5373\u5f97\uff1a\n\n$$ G(n)=\\sum_{d|n} \\mu(d)d^k \\sum_{i=0}^{k+1} f_i\\left(\\frac{n}{d}\\right)^i $$\n\n$$ G(n)= \\sum_{i=0}^{k+1} f_i n^i \\sum_{d|n} \\mu(d)d^{k-i} $$\n\n\u82e5 $n$ \u80fd\u591f\u5206\u89e3\u4e3a $\\prod p_i^{a_i}$ \u7684\u5f62\u5f0f\uff0c\u7531\u4e8e $\\mu(d)d^{k-i}$ \u5fc5\u7136\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u540e\u9762\u7684\u4e00\u4e2a $\\sum$ \u53ef\u4ee5\u5199\u6210\uff1a\n\n$$ G(n)= \\sum_{i=0}^{k+1} f_i n^i \\prod_{p_j|n} \\sum_{t=0}^{a_j}\\mu(p_j^t)p_j^{t(k-i)} $$\n\n\u6ce8\u610f\u5230 $\\mu$ \u5728\u8d28\u6570\u5e42\u6b21\u4e0a\u6b21\u53d6\u503c\u6709\uff1a\n\n$$\n\\mu(p^k)=\n\\begin{cases}\n1 \\qquad & k=0\\\\\n-1 \\qquad & k=1\\\\\n0 \\qquad & k>1\n\\end{cases}\n$$\n\n\u6240\u4ee5\u6700\u540e\u4e00\u4e2a $\\sum$ \u4e2d\u7684 $t$ \u81f3\u591a\u679a\u4e3e\u5230 $1$\u3002\u5373\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n\n$$ G(n)= \\sum_{i=0}^{k+1} f_i n^i \\prod_{p_j|n} \\left(1-p_j^{k-i}\\right) $$\n\n\u800c\u6211\u4eec\u60f3\u8981\u7684\u5c31\u662f $G(N)$\uff0c\u800c $N$ \u4e5f\u662f\u4ee5\u5176\u8d28\u56e0\u6570\u5206\u89e3\u7684\u5f62\u5f0f\u7ed9\u51fa\uff0c\u5219\u5269\u4e0b\u7684\u95ee\u9898\u662f\u63d2\u503c\u51fa\u6211\u4eec\u8981\u7684\u81ea\u7136\u6570\u5e42\u548c\u7684\u591a\u9879\u5f0f\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u7684\u4e00\u822c\u66b4\u529b\u65b9\u6cd5\u53ef\u4ee5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u505a\u5230 $O(n^3)$ \u6216\u8005 $O(n^2)$\u3002\u4e3b\u8981\u539f\u7406\u5c31\u662f\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n\u5bf9\u4e8e\u4e00\u4e2a $k$ \u6b21\u591a\u9879\u5f0f\uff0c\u5728\u7ed9\u5b9a\u5176 $k+1$ \u4e2a\u70b9\u503c $(x_i,y_i=F(x_i))$ \u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u63d2\u51fa\u5176\u591a\u9879\u5f0f\u4e3a\uff1a\n\n$$ F(x)=\\sum_{i=1}^{k+1} y_i \\prod_{j \\ne i} \\frac{x-x_j}{x_i-x_j}$$\n\n\u7136\u540e\u7eaf\u7cb9\u6a21\u62df\u591a\u9879\u5f0f\u4e58\u6cd5\u548c\u591a\u9879\u5f0f\u52a0\u6cd5\uff0c\u5c31\u53ef\u4ee5\u505a\u5230 $O(k^3)$\u3002\u4f46\u662f\u5982\u679c\u6211\u4eec\u9884\u5904\u7406\u51fa $\\prod_{i=1}^{k+1}(x-x_j)$ \u8fd9\u4e2a\u591a\u9879\u5f0f\uff0c\u6bcf\u6b21\u52a0\u7684\u65f6\u5019\u5148\u9664\u6389\u4e00\u4e2a\u5355\u9879\u5f0f\u518d\u4e58\u5e38\u6570\uff0c\u6700\u540e\u505a\u52a0\u6cd5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5230 $O(k^2)$ \u63d2\u51fa\u8fd9\u4e2a\u591a\u9879\u5f0f\u3002\u7531\u4e8e\u6b64\u9898\u4e2d $k \\leq 100$\uff0c\u6240\u4ee5\u4f7f\u7528\u6700\u66b4\u529b\u6734\u7d20\u7684\u7b97\u6cd5\u5373\u53ef\u3002\n\n\u81f3\u6b64\uff0c\u6574\u4e2a\u95ee\u9898\u5c31\u53ef\u4ee5\u5728 $O(k^3+kn)$ \u6216\u8005 $O(k^2+kn)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u3002\n\n\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nconst int mod = 1e9 + 7;\n\ninline int Mod(int x) { return x >= mod ? x - mod : x; }\ninline void Add(int &x, int y) { x += y, x -= x >= mod ? mod : 0; }\ninline int fsp(int x, int k = mod - 2) {\n\tint s = 1;\n\twhile(k) {\n\t\tif(k & 1) s = 1LL * s * x % mod;\n\t\tx = 1LL * x * x % mod, k >>= 1;\n\t} return s;\n}\n\nint f[110];\nint p[1010];\n\n// {{{ Lagrange\nint A[110];\nint len;\n\ninline void Poly_Mul(int a, int b) {\n\t++len;\n\tfor(int i = len; i >= 1; i--)\n\t\tA[i] = (1LL * A[i] * b + 1LL * A[i - 1] * a) % mod;\n\tA[0] = 1LL * A[0] * b % mod;\n}\n\ninline void Num_Mul(int v) {\n\tfor(int i = 0; i <= len; i++)\n\t\tA[i] = 1LL * A[i] * v % mod;\n}\n\ninline void Poly_Add() {\n\tfor(int i = 0; i <= len; i++)\n\t\tAdd(f[i], A[i]), A[i] = 0;\n\tlen = 0, A[0] = 1;\n}\n\ninline void init(int k) {\n\tA[0] = 1, len = 0;\n\tint S = 0;\n\tfor(int i = 1; i <= k + 3; i++) {\n\t\tAdd(S, fsp(i, k));\n\t\tint mul = fsp(S);\n\t\tfor(int j = 1; j <= k + 3; j++) {\n\t\t\tif(i == j) continue;\n\t\t\tPoly_Mul(1, mod - j);\n\t\t\tmul = 1LL * mul * (i + mod - j) % mod;\n\t\t} Num_Mul(fsp(mul)), Poly_Add();\n\t}\n}\n// }}}\n\nint main() {\n\tint k = ri, n = ri, N = 1;\n\tfor(int i = 1; i <= n; i++) p[i] = ri, N = 1LL * N * fsp(p[i], ri) % mod;\n\n\tinit(k);\n\n\tint res = 0, pw = N;\n\tfor(int i = 1; i <= k + 3; i++) {\n\t\tint ans = 1LL * pw * f[i] % mod;\n\t\tpw = 1LL * pw * N % mod;\n\t\tfor(int j = 1; j <= n; j++)\n\t\t\tans = 1LL * ans * (1 + mod - fsp(p[j], k - i + mod - 1)) % mod;\n\t\tAdd(res, ans);\n\t} cout << res << endl;\n\treturn 0;\n}\n```",
        "postTime": 1596959101,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6271 \u3010[\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba\u3011"
    },
    {
        "content": "upd: typo\u4e86\u4e00\u4e2a\u5730\u65b9\uff0c\u611f\u8c22NaCly_Fish\u7684\u6307\u6b63\u3002\n____\n\n\u9996\u5148\u5199\u51fa\u5f0f\u5b50\u6765\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/6577i0r6.png)\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u4e1c\u897f\u597d\u50cf\u4e0d\u662f\u5bb9\u6613\u63d0\u524d\u9884\u5904\u7406\u3002\u6839\u636e\u4f2f\u52aa\u5229\u6570\u7684\u63a8\u8bba\uff0c\u53ef\u4ee5\u77e5\u9053 $\\sum i^m$ \u8fd9\u4e1c\u897f\u662f\u4e00\u4e2a\u5173\u4e8e\u4e0a\u754c $n$ \u7684 $m+1$ \u6b21\u591a\u9879\u5f0f\u3002\u53d1\u73b0 $m$ \u5e76\u4e0d\u5927\u4e8e\u662f\u53ef\u4ee5 $O(m^2)$ \u63d2\u51fa\u6765\u3002 \u82e5\u8bb0\u8fd9\u4e2a\u591a\u9879\u5f0f\u662f $f$ \uff0c\u90a3\u4e48\u539f\u5f0f\u5c31\u7b49\u4ef7\u4e8e\n\n$$\\sum_{d|n}d^m\\mu(d)\\sum_{i=1}^{m+1} f_i\\left(\\lfloor\\frac{n}{d}\\rfloor\\right) ^ i$$\n\n\u7a0d\u5fae\u5316\u4e00\u4e0b\u5c31\u662f\n\n$$=\\sum_{i=0}^{m+1} f_{i} \\sum_{d | n} d^{m} \\mu(d)\\left(\\frac{n}{d}\\right)^{i}$$\n\n\u53d1\u73b0\u5bf9\u4e8e\u540e\u9762\u7684 $\\sum $ \u53ea\u9700\u8981\u6c42\u51fa\u6bcf\u4e2a $p_i^{a_i}$ \u5904\u7684\u503c\uff0c\u7136\u540e\u6bcf\u6b21 $O(k)$ \u66b4\u529b\u5408\u5e76\uff0c\u4f3c\u4e4e\u4e5f\u6ca1\u5565\u95ee\u9898\u3002\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $p_i^{a_{i}}$ \u600e\u4e48\u6c42\u3002\n\n\u8fd9\u4e2a\u5730\u65b9\u5927\u6982\u9700\u8981\u6da8\u4e2a\u7ecf\u9a8c\uff0c\u5c31\u662f\u8981\u8003\u8651 $\\mu(d)$ \u8fd9\u4e1c\u897f\u7684\u5bb9\u65a5\u610f\u4e49\uff0c\u53ea\u6709\u5f53 $d=1$ \u548c $d=p_i$ \u7684\u65f6\u5019\u624d\u6709\u503c(\u65e0\u5e73\u65b9\u56e0\u5b50,\u5269\u4e0b\u7684\u56e0\u5b50\u90fd\u662f $p_i$ \u7684\u67d0\u4e2a\u6b21\u6570 $>2$ \u7684\u5e42)\uff0c\u6240\u4ee5\u6bcf\u4e2a\u53ea\u9700\u8981\u7b97\u4e24\u6b21\uff0c\u662f $O(1)$ \u7684\u3002\u4e8e\u662f\u6700\u540e\u7684\u590d\u6742\u5ea6 $O(m(m+k))$ \u3002\n\n\u5e76\u4e14\u2026\u2026\u8fd9\u4e2a\u9898\u5c45\u7136\u5141\u8bb8\u7528\u9ad8\u65af\u6d88\u5143\u6765\u4ee3\u66ff\u63d2\u503c\u3002\u6bd5\u7adf $m$ \u53ea\u6709 $100$ \u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std ;\n\ntypedef long long ll ; \n\nconst int N = 1000010 ; \nconst int P = 1000000007 ;\n\nint n, k ; \n\nvoid debug(int *tp, int minn, int maxn, char c){\n    for (int i = minn ; i <= maxn ; ++ i)\n        cout << tp[i] << \" \" ;  cout << c ;\n}\n\nnamespace Interpolation{\n\tint ans ; \n\tint now ; \n\tint x[N] ;\n\tint y[N] ;\n\tint fac[N] ; \n\tint inv[N] ; \n\tint pres[N] ; \n\tint sufs[N] ; \n\tint expow(int a, int b){\n\t\tint res = 1 ;\n\t\ta = (a % P + P) % P ;\n\t\twhile (b){\n\t\t\tif (b & 1)\n\t\t\t\tres = (ll)res * a % P ; \n\t\t\ta = (ll)a * a % P ; b >>= 1 ; \n\t\t}\n\t\treturn res ;\n\t}\n\tint fz[N] ;\n\tint fm[N] ; \n\tint tmp[N] ;\n\tint res[N] ;\n\tvoid add(int &a, int b){\n\t\ta += b ;\n\t\tif (a > P) a -= P ; \n\t}\n\tvoid dec(int &a, int b){\n\t\t(a -= b) %= P ;\n\t\tif (a < 0) a += P ; \n\t}\n\tvoid fmul(int *t, int deg, int opt){\n\t\tfor (int i = deg + 1 ; i >= 1 ; -- i)\n\t\t\ttmp[i] = t[i], t[i] = t[i - 1] ;\n\t\tfor (int i = 1 ; i <= deg + 1 ; ++ i)\n\t\t\tadd(t[i], (ll)opt * tmp[i] % P) ;   \n\t}\n\tvoid fdiv(int *t, int *ret, int deg, int opt){\n\t\tfor (int i = 1 ; i <= deg ; ++ i) tmp[i] = t[i] ; \n\t\tfor (int i = deg - 1 ; i >= 1 ; -- i)\n\t\t\tret[i] = tmp[i + 1], dec(tmp[i], (ll)tmp[i + 1] * opt % P) ;\n\t}\n\tvoid get_xs(int n){\n\t\tfz[1] = 1 ;\n\t\tfor (int i = 1 ; i <= n ; ++ i)\n\t\t\tfmul(fz, i, (-x[i] + P) % P) ;\n\t\t//debug(fz, 1, n + 1, '\\n') ;\n\t\tfor (int i = 1 ; i <= n ; ++ i){\n\t\t\tint fenmu = 1 ; \n\t\t\tfor (int j = 1 ; j <= n ; ++ j)\n\t\t\t\tif (i != j) fenmu = (ll)fenmu * (x[i] - x[j] + P) % P ;\n\t\t\tfdiv(fz, fm, n + 1, -x[i]) ; \n\t\t\tfenmu = (ll)y[i] * expow(fenmu, P - 2) % P ;\n\t\t//\tcout << fenmu << endl ; \n\t\t\tfor (int j = 1 ; j <= n ; ++ j)\n\t\t\t\tadd(res[j], (ll)fenmu * fm[j] % P) ;\n\t\t//\tdebug(res, 1, n, '\\n') ;\n\t\t}\n\t}\n\tvoid pre_do(int U){\n\t\tfac[0] = 1 ;\n\t\tfor (int i = 1 ; i <= U ; ++ i)\n\t\t\tfac[i] = (ll)fac[i - 1] * i % P ;\n\t\tinv[U] = expow(fac[U], P - 2) ; \n\t\tfor (int i = U ; i >= 1 ; -- i)\n\t\t\tinv[i - 1] = (ll)inv[i] * i % P ;\n\t\t//debug(fac, 1, U, '\\n') ;\n\t\t//debug(inv, 1, U, '\\n') ;\n\t}\n\tint evenmark(int x){\n\t\treturn (x & 1) ? -1 : 1 ; \n\t}\n\tvoid get_dnx(int n, int k, bool m){\n\t\tif (m){\n\t\t\tpre_do(n) ;\n\t\t\tpres[0] = 1, sufs[n + 1] = 1 ;\n\t\t\tfor (int i = 1 ; i <= n ; ++ i)\n\t\t\t\tpres[i] = ((ll)pres[i - 1] * (k - x[i]) % P + P) % P ;\n\t\t\tfor (int i = n ; i >= 1 ; -- i)\n\t\t\t\tsufs[i] = ((ll)sufs[i + 1] * (k - x[i]) % P + P) % P ; \n\t\t\tfor (int i = 1 ; i <= n ; ++ i){\n\t\t\t\tnow = (ll)pres[i - 1] * sufs[i + 1] % P ;\n\t\t\t\tnow = (ll)now * expow((ll)fac[i - 1] * fac[n - i] % P, P - 2) % P ;\n\t\t\t\tnow = (ll)evenmark(n - i) * y[i] % P * now % P ; ans = (ll)(ans + now) % P ; \n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tint inow = 1 ;\n\t\t\tpres[0] = 1, sufs[n + 1] = 1 ;\n\t\t\tfor (int i = 1 ; i <= n ; ++ i)\n\t\t\t\tpres[i] = ((ll)pres[i - 1] * (k - x[i]) % P + P) % P ;\n\t\t\tfor (int i = n ; i >= 1 ; -- i)\n\t\t\t\tsufs[i] = ((ll)sufs[i + 1] * (k - x[i]) % P + P) % P ; \n\t\t\tfor (int i = 1 ; i <= n ; ++ i){\n\t\t\t\tinow = 1, now = (ll)pres[i - 1] * sufs[i + 1] % P ;\n\t\t\t\tfor (int j = 1 ; j <= n ; ++ j)\n\t\t\t\t\tif (i != j) inow = (ll)inow * ((x[i] - x[j]) % P + P) % P ; \n\t\t\t\tans = (ans + (ll)now * expow(inow, P - 2) % P * y[i] % P) % P ; \n\t\t\t}\n\t\t}\n\t}\n}/*\nnamespace Linear_sieve{\n\tint cnt ;\n\tint pr[N] ; \n\tint mu[N] ;\n\tint vis[N] ;\n\tvoid sieve(int U){\n\t\tmu[1] = 1 ;\n\t\tfor (int i = 2 ; i <= U ; ++ i){\n\t\t\tif (!vis[i]) mu[i] = -1, pr[++ cnt] = i ; \n\t\t\tfor (int j = 1 ; j <= cnt ; ++ j){\n\t\t\t\tif (i * pr[j] > U) break ; \n\t\t\t\tvis[i * pr[j]] = 1 ; \n\t\t\t\tif (i % pr[j] == 0) break ; \n\t\t\t\tmu[i * pr[j]] = -mu[i] ; \n\t\t\t}\n\t\t}\n\t}\n}*/\nint d, w, num ;\nint base[N], cs[N] ;\nint main(){\n\tcin >> d >> w ; n = d + 2 ; \n//\tusing namespace Linear_sieve ; \n\tusing namespace Interpolation ;\n\tfor (int i = 1 ; i <= n ; ++ i) \n\t\tx[i] = i, y[i] = (y[i - 1] + expow(x[i], d)) % P ; \n\tfor (int i = 1 ; i <= w ; ++ i)\n\t\tcin >> base[i] >> cs[i] ; get_xs(n) ; \n//\tdebug(y, 1, n + 1, '\\n') ;\n//\tdebug(res, 1, n + 1, '\\n') ;\n\tfor (int i = 1 ; i <= n + 1 ; ++ i){\n\t\tnow = 0, num = 1 ;   \n\t\tfor (int j = 1 ; j <= w ; ++ j){\n\t\t\tnow = expow(expow(base[j], cs[j] - 1), i - 1) ;\n\t\t\tnow = ((-1ll * now * expow(base[j], d) % P) + P) % P ; \n\t\t\tnow = (now + expow(expow(base[j], cs[j]), i - 1)) % P ; \n\t\t\tnum = 1ll * num * now % P ; \n\t\t}\n\t\tans = (ans + (ll)num * res[i] % P) % P ;\n\t}\n\tcout << ans << '\\n' ; return 0 ;\n}\n```",
        "postTime": 1585745127,
        "uid": 28313,
        "name": "\u768e\u6708\u534a\u6d12\u82b1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6266 \u3010\u4e00\u4e2a\u4eba\u7684\u6570\u8bba\u3011"
    },
    {
        "content": "\u901a\u8fc7\u8fd9\u9053\u9898\u5b66\u4e86**\u4f2f\u52aa\u5229\u6570**\uff0c\u5199\u7bc7\u9898\u89e3\u63a8\u4e00\u4e0b\n\n[\u9898\u76ee](https://www.luogu.com.cn/problem/P6271)\n\n\u5148\u63a8\u4e00\u4e0b\u5f0f\u5b50\n$$\n\\sum_{i=1}^ni^d[gcd(i,n)=1]\n$$\n$$\n\\sum_{i=1}^{n}i^d\\sum_{k|i}\\sum_{k|n}\\mu(k)\n$$\n$$\n\\sum_{k|n}\\mu(k)\\sum_{i=1}^{\\frac{n}{k}}(ik)^d\n$$\n$$\n\\sum_{k|n}\\mu(k)k^d\\sum_{i=1}^{\\frac{n}{k}}i^d\n$$\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u597d\u9884\u5904\u7406\uff0c\u90a3\u4e48\u6211\u4eec\u518d\u7b80\u5316\u4e00\u4e0b\u3002\n\n\u8bbe $S_k(n)=\\sum_{i=1}^{n-1}i^k$\n\n\u5219\u539f\u5f0f\u7b49\u4e8e\n$$\n\\sum_{k|n}\\mu(k)k^d(S_d(\\frac{n}{k})+(\\frac{n}{k})^d)\n$$\n$$\n\\sum_{k|n}\\mu(k)k^dS_d(\\frac{n}{k})+\\sum_{k|n}\\mu(k)n^d\n$$\n$\\sum_{k|n}\\mu(k)$ \u7b49\u4ef7\u4e0e $[n=1]$\uff0c\u800c\u672c\u9898\u4e2d $n$ \u4e0d\u53ef\u80fd\u4e3a $1$\uff0c\u6240\u4ee5\u539f\u5f0f\u4e3a\n$$\n\\sum_{k|n}\\mu(k)k^dS_d(\\frac{n}{k})\n$$\n\u8bbe $f_i$ \u4e3a\u5728\u4f2f\u52aa\u5229\u516c\u5f0f\u4e2d $i$ \u6b21\u5e42\u7684\u7cfb\u6570\n$$\n\\sum_{k|n}\\mu(k)k^d\\sum_{i=1}^{d+1}f_i(\\frac{n}{k})^i\n$$\n$$\n\\sum_{k|n}\\mu(k)\\sum_{i=1}^{d+1}f_in^ik^{d-i}\n$$\n$$\n\\sum_{i=1}^{d+1}f_in^i\\sum_{k|n}\\mu(k)k^{d-i}\n$$\n\u6211\u4eec\u4f1a\u53d1\u73b0\u5f0f\u5b50\u540e\u534a\u90e8\u5206\u5c31\u662f $(\\mu\u00d7id_{d-i})*I$\uff0c\u6240\u4ee5\u80af\u5b9a\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\u3002\n\n\u8bbe $F(n)=\\sum_{k|n}\\mu(k)k^{d-i},G(p)=\\mu(p)p^{d-i},F(n)=\\sum_{p|n}G(p)$\n\n\u8003\u8651\u8d28\u6570\u53d6\u503c\uff1a\n$$\nG(p)=\\left\\{\n\\begin{array}{lcl}\n1\\kern 2.2em(p=1)\\\\\n-p^{d-i}\\kern 1.0em(p\\in prime)\\\\\n\\end{array}\n\\right.\n$$\n\u7531 $\\mu$ \u7684\u6027\u8d28\uff0c\u53ef\u4ee5\u5f97\u51fa\u4e0a\u5f0f\u5f53 $n\\in prime$ \u65f6\uff0c$F(n)=1-n^{d-i}$\n\n\u6240\u4ee5\u603b\u7684\u590d\u6742\u5ea6\u5373\u4e3a $O(d^2+dw)$\uff0c$d^2$ \u4e3a\u9884\u5904\u7406 $f_i$ \u3002\n\n$AC \\kern 0.4emCODE:$\n```cpp\n#include<bits/stdc++.h>\n#define ri register int\n#define p(i) ++i\nusing namespace std;\nconst int MOD=1e9+7,W=1010,D=107;\ninline int read() {\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if (ch=='-') f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\ninline int fpow(int x,int y) {\n\tint res=1;\n\twhile(y) {\n\t\tif (y&1) res=1ll*res*x%MOD;\n\t\tx=1ll*x*x%MOD;y>>=1;\n\t}\n\treturn res;\n}\ninline int inv(int x) {return fpow(x,MOD-2);} \nint frac[D],invf[D];\nvoid init(int k) {\n\tfrac[0]=1;\n\tfor (ri i(1);i<=k;p(i)) frac[i]=1ll*frac[i-1]*i%MOD;\n\tinvf[k]=inv(frac[k]);\n\tfor (ri i(k);i;--i) invf[i-1]=1ll*invf[i]*i%MOD;\n}\ninline int C(int n,int m) {return 1ll*frac[n]*invf[m]%MOD*invf[n-m]%MOD;}\nstruct Bernou{\n\tint B[D],f[D];\n\tinline void Bernoulli(int k) {\n\t\tB[0]=1;\n\t\tfor (ri i(1);i<=k;p(i)) {\n\t\t\tint sum=0;\n\t\t\tfor (ri j(0);j<i;p(j)) sum=(sum+1ll*C(i+1,j)*B[j]%MOD)%MOD;\n\t\t\tB[i]=(0-1ll*sum*inv(i+1)%MOD+MOD)%MOD; \t\n\t\t}\n\t\tint INV=inv(k+1);\n\t\tfor (ri i(0);i<=k;p(i)) f[k+1-i]=1ll*C(k+1,i)*B[i]%MOD*INV%MOD;\n\t}\n}B;\nint d,w,p[W],a[W];\ninline int Sum(int cm) {\n\tif (cm<0) cm=MOD-2;\n\tint res=1;\n\tfor (ri i(1);i<=w;p(i)) res=1ll*res*(1-fpow(p[i],cm)+MOD)%MOD;\n\treturn res;\n}\nint main() {\n\td=read(),w=read();\n\tinit(d+3);B.Bernoulli(d);\n\tfor (ri i(1);i<=w;p(i)) p[i]=read(),a[i]=read();\n\tint ans=0,n=1;\n\tfor (ri i(1);i<=w;p(i)) n=1ll*n*fpow(p[i],a[i])%MOD;\n\tfor (ri i(1),cm(1);i<=d+1;p(i)) {\n\t\tcm=1ll*cm*n%MOD;\n\t\tans=(ans+1ll*B.f[i]*cm%MOD*Sum(d-i)%MOD)%MOD;\n\t} \n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1618832432,
        "uid": 141958,
        "name": "\u6960\u67ab",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba"
    },
    {
        "content": "\u6ce8\u610f\u672c\u7bc7\u9898\u89e3\u7684 $k$ \u662f\u9898\u76ee\u4e2d\u7684 $d$\u3002\n\n$$\\sum_{i=1}^n[\\gcd(i,n)=1]i^k$$\n\n$$\\sum_{i=1}^ni^k\\sum_{d|\\gcd(i,n)}\\mu(d)$$\n\n$$\\sum_{d|n}\\mu(d)d^k\\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor}i^k$$\n\n$$\\sum_{d|n}\\mu(d)d^k(S_k(\\frac{n}{d})+(\\frac{n}{d})^k)$$\n\n$$\\sum_{d|n}\\mu(d)d^kS_k(\\frac{n}{d})+\\sum_{d|n} \\mu(d)d^k(\\frac{n}{d})^k$$\n\n$$\\sum_{d|n}\\mu(d)d^kS_k(\\frac{n}{d})+n^k\\sum_{d|n} \\mu(d)$$\n\n$$\\sum_{d|n}\\mu(d)d^kS_k(\\frac{n}{d})+n^k[n=1]$$\n\n\u8fd9\u9053\u9898 $n$ \u80af\u5b9a\u4e0d\u4e3a $1$ , \u540e\u9762\u7684\u503c\u4e3a $0$\uff0c\u53ea\u9700\u8003\u8651\u524d\u4e00\u4e2a\u548c\u5f0f\u3002\n\n\u81ea\u7136\u6570\u5e42\u548c\u662f\u4e00\u4e2a $k+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u53ef\u4ee5\u7528[\u4f2f\u52aa\u5229\u6570](https://www.luogu.com.cn/blog/chihik/bo-nu-li-shu)\u7b97\u51fa\u7cfb\u6570\uff0c\u4e0d\u59a8\u8bb0\u4e3a $f_i$\u3002\n\n\u7531\u4f2f\u52aa\u5229\u516c\u5f0f\u5f97\uff1a$f_{k+1-i}=\\frac{\\binom{k+1}{i}B_i}{k+1}$\n\n$$\\sum_{d|n}\\mu(d)d^k \\sum_{i=1}^{k+1} f_i \\left ( \\frac{n}{d} \\right)^{i}$$\n\n$$\\sum_{i=1}^{k+1} f_i\\sum_{d|n}\\mu(d)d^k \\left( \\frac{n}{d} \\right)^{i}$$\n\n$$\\sum_{i=1}^{k+1} f_i n^i\\sum_{d|n}\\mu(d) d^{k-i}$$\n\n\u540e\u9762\u7684\u548c\u5f0f\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\uff0c\u8003\u8651\u8d28\u6570\u53d6\u503c\n\n$$\\sum_{d|p^w}\\mu(d)d^{k-i}$$\n\n$$\\sum_{i=0}^w \\mu(p^i)p^{i(k-i)}$$\n\n\u7531 $\\mu$ \u7684\u6027\u8d28\uff0c\u53ea\u6709 $i=0$ \u6216 $1$ \u65f6\u4e0d\u4e3a $0$\uff0c\u6240\u4ee5\u4e0a\u5f0f\u7b49\u4e8e $1-p^{k-i}$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u80fd $\\mathcal O(w)$ \u8ba1\u7b97\u51fa\u8fd9\u4e2a\u5f0f\u5b50\u3002\n\n\u90a3\u4e48\u9884\u5904\u7406\u51fa\u4f2f\u52aa\u5229\u6570\u548c $f$ \uff0c\u539f\u9898\u4fbf\u80fd $\\mathcal O(d^2+dw)$ \u89e3\u51b3\u4e86\u3002\n\n```cpp\n#include <cstdio>\n\nconst int MAXK = 105 , Mod = 1e9 + 7;\n\nint Add( int x , int y ) { x += y; return x >= Mod ? x - Mod : x; }\nint Sub( int x , int y ) { x -= y; return x < 0 ? x + Mod : x; }\nint Mul( int x , int y ) { return 1ll * x * y % Mod; }\nint Quick_pow( int x , int po ) { int Ans = 1; for( ; po ; po >>= 1 , x = Mul( x , x ) ) if( po & 1 ) Ans = Mul( Ans , x ); return Ans; }\nint Inv( int x ) { return Quick_pow( x , Mod - 2 ); }\nint Div( int x , int y ) { return Mul( x , Inv( y ) ); }\n\nint fac[ MAXK + 10 ] , ivf[ MAXK + 10 ];\nvoid Init( ) {\n    fac[ 0 ] = 1;\n    for( int i = 1 ; i <= MAXK + 5 ; i ++ ) fac[ i ] = Mul( fac[ i - 1 ] , i );\n    ivf[ MAXK + 5 ] = Inv( fac[ MAXK + 5 ] );\n    for( int i = MAXK + 5 ; i >= 1 ; i -- ) ivf[ i - 1 ] = Mul( ivf[ i ] , i );\n}\nint C( int n , int m ) { return Mul( fac[ n ] , Mul( ivf[ m ] , ivf[ n - m ] ) ); }\n\nint w , k , p[ 1005 ] , a[ 1005 ];\n\nint B[ MAXK + 5 ] , f[ MAXK + 5 ];\nvoid Init_Bernoulli( ) {\n    B[ 0 ] = 1;\n    for( int i = 1 ; i <= MAXK ; i ++ ) {\n        int Sum = 0;\n        for( int j = 0 ; j < i ; j ++ ) Sum = Add( Sum , Mul( C( i + 1 , j ) , B[ j ] ) );\n        B[ i ] = Sub( 0 , Mul( Sum , Inv( C( i + 1 , i ) ) ) );\n    }\n    for( int i = 0 ; i <= k ; i ++ ) f[ k + 1 - i ] = Div( Mul( C( k + 1 , i ) , B[ i ] ) , k + 1 );\n}\n\nint Sum( int pw ) {\n    if( pw < 0 ) pw += Mod - 1;\n    int Ans = 1;\n    for( int i = 1 ; i <= w ; i ++ ) Ans = Mul( Ans , Sub( 1 , Quick_pow( p[ i ] , pw ) ) );\n    return Ans;\n}\n\nint main( ) {\n    scanf(\"%d %d\",&k,&w);\n    Init(); Init_Bernoulli();\n    for( int i = 1 ; i <= w ; i ++ ) scanf(\"%d %d\",&p[ i ],&a[ i ]);\n\n    int Ans = 0 , n = 1;\n    for( int i = 1 ; i <= w ; i ++ ) n = Mul( n , Quick_pow( p[ i ] , a[ i ] ) );\n    for( int i = 1 , nk = 1 ; i <= k + 1 ; i ++ ) {\n        nk = Mul( nk , n );\n        Ans = Add( Ans , Mul( Mul( f[ i ] , nk ) , Sum( k - i ) ) );\n    }\n    printf(\"%d\\n\", Ans );\n    return 0;\n}\n```",
        "postTime": 1610175868,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba"
    },
    {
        "content": "## \u9898\u610f\n$\\sum_{i=1}^n[\\gcd(i,n)=1]i^d$\n\n\u7531\u4e8e $n$ \u53ef\u80fd\u5f88\u5927\uff0c\u7ed9\u51fa$n$\u7684\u8d28\u56e0\u6570\u5206\u89e3\u5f0f\u3002\n\n$n=\\prod_{i=1}^{w} p_{i}^{\\alpha_{i}}$\n\n$1\u2264w\u226410^3,2\\leq p_i \\leq 10^9,1 \\leq a_i \\leq 10^9$\n## \u9898\u89e3\n\n\u5b9a\u4f4d\uff1a~~\u83ab\u53cd\u677f\u5b50\u9898~~\u83ab\u53cd\u795e\u4ed9\u9898\n\n$\\sum_{i=1}^n[\\gcd(i,n)=1]i^d$\n\n$\\sum_{i=1}i^d\\sum_{x|\\gcd(i,n)}\\mu(x)$\n\n$\\sum_{x|n}\\mu(x)\\sum_{i=1}^{\\frac n x}(ix)^d$\n\n$\\sum_{x|n}\\mu(x)x^d\\sum_{i=1}^{\\frac n x}i^d$\n\n\u6839\u636e\u7ecf\u9a8c\u6211\u4eec\u5f97\u5230\uff0c$f(x)=\\sum_{i=1}^xi^d$\u662f\u4e00\u4e2a\u5173\u4e8e$x$\u7684$d+1$\u6b21\u7684\u591a\u9879\u5f0f\u3002\n\n\u56e0\u6b64\uff0c\u8bbe\uff0c$f(x)=a_0+a_1x+a_2x^2+a_3x^3+\\ldots+a_{d+1}x^{d+1}$\n\n$\\sum_{x|n}\\mu(x)x^d f(\\frac n x)$\n\n$\\sum_{x|n}\\mu(x)x^d \\sum_{i=0}^{d+1}a_i(\\frac n x)^i$\n\n$\\sum_{i=0}^{d+1}a_i\\sum_{x|n}\\mu(x)x^d (\\frac n x)^i$\n\n\u8bbe$g(n)=\\sum_{x|n}\\mu(x)x^d (\\frac n x)^i$\uff0c\u4e3a$\\mu\\times Id_d$\u4e0e$Id_i$\u5377\u8d77\u6765\u5f97\u5230\u7684\uff0c\u524d\u8005\u4e0e\u540e\u8005\u663e\u7136\u90fd\u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u90a3\u4e48$g$\u4e5f\u5fc5\u4e3a\u79ef\u6027\u51fd\u6570\u3002\n\n$\\sum_{i=0}^{m+1}a_ig(n)$\n\n\u90a3\u4e48\u6839\u636e\u79ef\u6027\u51fd\u6570\u7684\u6027\u8d28\uff0c\u6211\u4eec\u77e5\u9053\uff1a\n\n$g(n)=\\prod_{j} g(p_j^{\\alpha_j})$\n\n\u518d\u8003\u8651\u5f53$n=p^{\\alpha}$\u65f6\uff0c$\\mu$\u5f53\u4e14\u4ec5\u5f53$x=1\\ \\text{or}\\ p$\u65f6\u503c\u4e0d\u4e3a\u96f6\uff0c\u56e0\u6b64\uff1a\n\n$g(p^{\\alpha})=\\mu(1)1^d (\\frac {p^\\alpha} 1)^i+\\mu(p)p^d (\\frac {p^\\alpha} p)^i=p^{i\\alpha}-p^{d+(\\alpha-1)\\times i}$\n\n\u518d\u5e26\u56de\u53bb\uff0c$g(n)=\\prod_{j} (p_j^{i\\alpha_j}-p_j^{d+(\\alpha_j-1)\\times i})$\n\n\u518d\u5e26\u56de\u53bb\uff0c$\\sum_{i=0}^{d+1}a_i\\prod_{j} (p_j^{i\\alpha_j}-p_j^{d+(\\alpha_j-1)\\times i})$\n\n\u4e8e\u662f\u6211\u4eec\u901a\u8fc7\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\uff0c\u5f97\u51fa\u4e86\u4e00\u4e2a\u4e0e\u5b83\u65e0\u5173\u7684\u67ff\u5b50\u3002\n\n$a_i$\u53ef\u4ee5\u7528\u9ad8\u65af\u6d88\u5143\u6c42\u51fa\u3002\n\n\u590d\u6742\u5ea6\uff1a$\\mathcal{O}(d^3+d\\times w)$~~\u53ef\u80fd\u8fd8\u6709\u5feb\u901f\u5e42\u7684$\\log mod$~~\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<class T,const int M>\nstruct Gauss{\n\t//\u89e3n\u5143\u65b9\u7a0b\u7ec4\n\tint n;\n\tT B[M][M+1];\n\tT ans[M];\n\tbool run(){\n\t\tfor(int i=0;i<n;i++){\n\t\t\tint pivot=i;\n\t\t\tfor(int j=i;j<n;j++)\n\t\t\t\tif(B[j][i]==B[pivot][i])\n\t\t\t\t\tpivot=j;\n\t\t\tfor(int j=0;j<=n;j++)swap(B[i][j],B[pivot][j]);\n\t\t\tif(B[i][i]==0)return false;\n\t\t\tfor(int j=i+1;j<=n;j++)B[i][j]/=B[i][i];\n\t\t\tfor(int j=0;j<n;j++)\n\t\t\t\tif(i!=j)\n\t\t\t\t\tfor(int k=i+1;k<=n;k++)\n\t\t\t\t\t\tB[j][k]-=B[j][i]*B[i][k];\n\t\t}\n\t\tfor(int i=0;i<n;i++)ans[i]=B[i][n];\n\t\treturn true;\n\t}\n};\ntypedef long long ll;\nconst ll mod=1e9+7;\nll ksm(ll a,ll b){\n    ll res=1;\n    while(b){\n        if(b&1)res=res*a%mod;\n        a=a*a%mod;b>>=1;\n    }return res;\n}\nstruct node{\n\tll x;\n\tnode(ll _=0){x=_;}\n\tbool operator==(node b){return x==b.x;}\n\tbool operator==(ll b){return x==b;}\n\tnode operator*(node b){return node(x*b.x%mod);}\n\tnode *operator/=(node b){x*=ksm(b.x,mod-2),x%=mod;return this;}\n\tnode *operator-=(node b){x-=b.x,x%=mod,x+=mod,x%=mod;;return this;}\n\tnode *operator+=(node b){x+=b.x,x%=mod,x+=mod,x%=mod;;return this;}\n};\nGauss<node,200>G;\nint d,w,p[1200],a[1200];\nll n=1;\nsigned main(){\n\tcin>>d>>w;\n\tG.n=d+2;\n\tfor(int i=0;i<G.n;i++){\n\t\tfor(int j=0;j<G.n;j++)\n\t\t\tG.B[i][j].x=ksm(i+1,j);\n\t\tfor(int j=1;j<=i+1;j++)\n\t\t\t(G.B[i][G.n].x+=ksm(j,d))%=mod;\n\t}\n\tG.run();\n\tfor(int i=1;i<=w;i++)\n\t\tcin>>p[i]>>a[i],(n*=ksm(p[i],a[i]))%=mod; \n\tll ans=0,res;\n\tfor(int i=0;i<G.n;i++){\n\t\tres=G.ans[i].x;\n\t\tfor(int j=1;j<=w;j++)\n\t\t\tres*=ksm(p[j],1ll*i*a[j])-ksm(p[j],d+1ll*(a[j]-1)*i),res%=mod; \n\t\tans+=res;ans%=mod;\n\t}\n\tcout<<(ans+mod)%mod;\n}\n```",
        "postTime": 1607093372,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6271 \u3010[\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba\u3011"
    },
    {
        "content": "\u4eca\u5929\u5fc3\u60c5\u4e0d\u597d\uff0c\u6765\u5199\u4e00\u9053\u7b80\u5355\u6570\u8bba\u9898\u8c03\u8282\u4e00\u4e0b~\n\n---\n\n## \u9898\u76ee\u63cf\u8ff0\n\n\u7ed9\u51fa$n$\u7684\u8d28\u56e0\u6570\u5206\u89e3\u548c$m$\uff0c\u6c42\n$$\\sum_{i=1}^n[i\\perp n]i^m$$\n## \u9898\u89e3\n$$\\begin{aligned}\\sum_{i=1}^n[i\\perp n]i^m &=\\sum_{i=1}^mi^m\\sum_{k|\\gcd(i,n)}\\mu(k)\\\\&=\\sum_{k|n}\\mu(k)\\sum_{i=1}^{n/k}(ik)^m\\\\&=\\sum_{k|n}\\mu(k)k^m\\sum_{i=1}^{n/k}i^m\\end{aligned}$$\n\u770b\u5230\u540e\u9762\u90a3\u4e2a\u81ea\u7136\u6570\u5e42\u548c\uff0c\u76f4\u63a5\u62ff\u4f2f\u52aa\u5229\u6570\u6de6\u5b83\u5c31\u597d\u4e86.\n\n\u73b0\u5728\u4ee4\n$$S_m(n)=\\sum_{i=1}^ni^m=\\sum_{i=1}^{m+1}a_in^i$$\n\u5e26\u5165\u5f97\n$$\\begin{aligned}\\sum_{i=1}^{n}[i\\perp n]i^m&=\\sum_{k|n}\\mu(k)k^m\\sum_{i=1}^{m+1}a_i\\left(\\frac{n}{k}\\right)^i\\\\&=\\sum_{i=1}^{m+1}a_i\\sum_{k|n}\\mu(k)k^m\\left(\\frac{n}{k}\\right)^i\\\\&=\\sum_{i=1}^{m+1}a_ig_i(n)\\end{aligned}$$\n\u663e\u7136\uff0c$\\mu(n)n^m$\u4e0e$n^i$\u5747\u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u800c\u79ef\u6027\u51fd\u6570\u7684\u72c4\u5229\u514b\u96f7\u5377\u79ef\u4e5f\u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5$g_i(n)$\u4e3a\u79ef\u6027\u51fd\u6570.\n\n\u6240\u4ee5\u6709\n$$g_i(n)=\\prod_{j=1}^{\\omega(n)}g(p_j^{c_j})$$\n\u8003\u8651\u5230$\\mu$\u53ea\u5728free square number\u5904\u6709\u503c\uff0c\u6240\u4ee5\n$$g_i(n)=\\prod_{j=1}^{\\omega(n)}(p_j^{ic_j}-p^{m+i(c_j-1)})$$\n\u65f6\u95f4\u590d\u6742\u5ea6$O(m\\omega(n))$.\n\n## \u4ee3\u7801\n\n\u8003\u8651\u4e86\u4e0b\u8981\u4e0d\u8981\u5199\u591a\u9879\u5f0f\u6c42\u9006\n\n\u53d1\u73b0\u6a21\u6570\u4e0d\u5bf9\uff08\u61d2\u5f97\u5199MTT\u4e86\uff09\uff0c\u4e8e\u662f\u6ca1\u5199\n\n$m$\u592a\u5c0f\u4e86\u600e\u4e48\u641e\u90fd\u884c.\n\n```cpp\n#include <cstdio>\n#include <iostream>\n\nusing namespace std;\nconst int M = 100 + 1;\nconst int mod = 1e9 + 7;\nint B[M + 1], inv[M + 2], fac[M + 1], facinv[M + 1];\n\nint pow(int a, int b)\n{\n\tint ans = 1;\n\tfor(; b; b >>= 1, a = 1ll * a * 1ll * a % mod)\n\t\tif(b & 1) ans = 1ll * ans * 1ll * a % mod;\n\treturn ans;\n}\nint Comb(int n, int m)\n{\n\treturn 1ll * fac[n] * 1ll * facinv[m] % mod * 1ll * facinv[n - m] % mod;\n}\nvoid init()\n{\n\tfac[0] = 1;\n\tfor(int i = 1; i <= M; i++)\n\t\tfac[i] = 1ll * fac[i - 1] * 1ll * i % mod;\n\tfacinv[M] = pow(fac[M], mod - 2);\n\tfor(int i = M; i >= 1; i--)\n\t\tfacinv[i - 1] = 1ll * facinv[i] * 1ll * i % mod;\n\tinv[1] = 1;\n\tfor(int i = 2; i <= M + 1; i++)\n\t\tinv[i] = 1ll * inv[mod % i] * 1ll * (mod - mod / i) % mod;\n\tB[0] = 1;\n\tfor(int i = 1; i <= M; i++)\n\t{\n\t\tfor(int j = 0; j < i; j++)\n\t\t\tB[i] = (1ll * B[i] - 1ll * Comb(i + 1, j) * 1ll * B[j] % mod + 1ll * mod) % mod;\n\t\tB[i] = 1ll * B[i] * 1ll * inv[i + 1] % mod;\n\t}\n}\nconst int W = 1e3;\nint w, m, ans, a[M + 1], p[W + 1], c[W + 1];\nint read()\n{\n\tint ans = 0; char ch;\n\tfor(; !isdigit(ch = getchar()); );\n\tfor(; isdigit(ch); ans = (ans << 1) + (ans << 3) + (ch ^ 48), ch = getchar());\n\treturn ans;\n}\nint g(int i)\n{\n\tint ans = 1;\n\tfor(int j = 1; j <= w; j++)\n\t\tans = 1ll * ans * (1ll * pow(p[j], 1ll * c[j] * 1ll * i % (mod - 1)) - 1ll * pow(p[j], (1ll * m + 1ll * i * 1ll * (c[j] - 1)) % (mod - 1)) + 1ll * mod) % mod;\n\treturn ans;\n}\nint main()\n{\n\tinit();\n\tm = read(), w = read();\n\tfor(int i = 1; i <= w; i++)\n\t\tp[i] = read(), c[i] = read();\n\tfor(int i = 1; i <= m + 1; i++)\n\t{\n\t\tfor(int j = 0; j <= i; j++)\n\t\t\ta[j] = (1ll * a[j] + 1ll * Comb(m + 1, i) * 1ll * B[m + 1 - i] % mod * 1ll * Comb(i, j)) % mod;\n\t}\n\tfor(int i = 1; i <= m + 1; i++)\n\t\ta[i] = 1ll * a[i] * 1ll * pow(m + 1, mod - 2) % mod;\n\tfor(int i = 1; i <= m + 1; i++)\n\t\tans = (1ll * ans + 1ll * a[i] * 1ll * g(i)) % mod;\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1617695959,
        "uid": 139340,
        "name": "Gauss0320",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u300c\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014\u300d\u4e00\u4e2a\u4eba\u7684\u6570\u8bba"
    },
    {
        "content": "\u65b9\u4fbf\u8d77\u89c1\uff0c\u4ee4\u9898\u4e2d\u7684 $d\\to m$\u3002\n\n$$\n\\begin{aligned}\nf_m(n)&=\\sum_{i=1}^{n}[\\gcd(i,n)=1]i^m\\\\\n&=\\sum_{i=1}^{n}i^m\\sum_{d|i,d|n}\\mu(d)\\\\\n&=\\sum_{d|n}\\mu(d)\\sum_{d|i}i^m\\\\\n&=\\sum_{d|n}\\mu(d)d^m\\sum_{i=1}^{n/d}i^m\\\\\n\\end{aligned}\n$$\n\u8bbe\n$$\n\\sum_{i=1}^{n}i^m=\\sum_{i=0}^{m+1}f_in^i\n$$\n\u53ef\u4ee5\u63d2\u503c\u6216\u9ad8\u65af\u6d88\u5143\u8fdb\u884c\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u662f $O(m^3)$ \u6216 $O(m^2)$ \u6216 $O(m\\log^2 m)$\uff0c\u91c7\u7528\u7b2c\u4e00\u79cd\u5373\u53ef\u3002\n\n\u5219\n$$\n\\begin{aligned}\nf_m(n)&=\\sum_{d|n}\\mu(d)d^m\\sum_{i=0}^{m+1}f_i(n/d)^i\\\\\n&=\\sum_{i=0}^{m+1}f_i\\sum_{d|n}\\mu(d)d^m(n/d)^i\n\\end{aligned}\n$$\n\u6ce8\u610f\u5230\n$$\nF_i(n)=\\sum_{d|n}\\mu(d)d^m(n/d)^i\n$$\n\u662f\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u8ba1\u7b97 $F_i(p^k)$ \u5373\u53ef\uff0c\u663e\u7136\u53ef\u4ee5 $O(1)$ \u7b97\u3002\n\n\u590d\u6742\u5ea6 $O(m^3+mw)$",
        "postTime": 1611326020,
        "uid": 121027,
        "name": "Spasmodic",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6271 \u3010[\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba\u3011"
    },
    {
        "content": "### [P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba](https://www.luogu.com.cn/problem/P6271)\n\n\u7ed9\u4f60 $n=\\prod\\limits_{i=1}^{w}p_i^{a_i}$\uff0c\u6c42\uff1a\n$$\n\\sum_{i=1}^{n}i^d[\\gcd(i,n)=1]\n$$\n$1 \\leq w \\leq 10^3.2 \\leq p_i \\leq 10^9,1 \\leq a_i \\leq 10^9$\u3002\n\n\u5148\u5316\u7b80\u539f\u5f0f\uff0c\u6709\uff1a\n$$\n\\begin{aligned}\n\\sum_{i=1}^{n}i^d[\\gcd(i,n)=1]&=\\sum_{i=1}^{n}i^d\\sum_{p|\\gcd(i,n)}\\mu(p)\\\\\n&=\\sum_{i=1}^{n}i^k\\sum_{p=1}^{n}\\mu(p)[p|i][p|n]\\\\\n&=\\sum_{p|n}\\mu(p)\\sum_{i=1}^{n}i^k[p|i]\\\\\n&=\\sum_{p|n}\\mu(p)\\sum_{i=1}^{\\frac{n}{p}}(ip)^d\\\\\n&=\\sum_{p|n}\\mu(p)k^d\\sum_{i=1}^{\\frac{n}{p}}i^d\n\\end{aligned}\n$$\n\u5bf9\u4e8e $\\sum\\limits_{i=1}^{x}i^d$\uff0c\u6211\u4eec\u77e5\u9053\u5b83\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u4e2a\u5173\u4e8e $x$ \u7684 $d+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u8bbe\u5176\u4e3a\uff1a\n$$\n\\sum_{i=1}^{d+1}f_ix^i\n$$\n\u6211\u4eec\u53ef\u4ee5\u7528\u9ad8\u65af\u6d88\u5143\u5728 $\\mathcal O(d^3)$ \u5185\u7b97\u51fa\u7cfb\u6570 $f_i$ \u7684\u503c\uff0c\u518d\u7b97\u51fa\u539f\u5f0f\u7684\u503c\u3002\n\n\u641e\u5b9a\u4e0a\u9762\u90a3\u4e2a\u540e\uff0c\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n$$\n\\begin{aligned}\n&\\sum_{p|n}\\mu(p)p^d\\sum_{i=0}^{d+1}f_i(\\frac{n}{p})^i\\\\\n&=\\sum_{i=0}^{d+1}f_i\\sum_{p|n}\\mu(p)p^d(\\frac{n}{p})^i\n\\end{aligned}\n$$\n\u540e\u9762\u90a3\u90e8\u5206\u7b5b\u4e00\u4e0b\u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\n#define int long long\nint read()\n{\n    int x = 0, f = 1;\n    char c = getchar();\n    while (c < '0' || c > '9')\n    {\n        if (c == '-')\n            f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9')\n    {\n        x = x * 10 + c - '0';\n        c = getchar();\n    }\n    return x * f;\n}\n\nconst int mod = 1e9 + 7;\n\nint qpow(int a, int b)\n{\n    if (b < 0)\n        b += mod - 1;\n    int ret = 1;\n    for (; b; b >>= 1, a = 1ll * a * a % mod)\n        if (b & 1)\n            ret = 1ll * ret * a % mod;\n    return ret;\n}\n\nint inv(int a)\n{\n    return qpow(a, mod - 2);\n}\n\nint m, w;\n\nint p[1007], a[1007];\n\nint mat[105][105], f[105], sum[105];\n\nvoid init()\n{\n    for (int i = 1; i <= m + 2; ++i)\n    {\n        sum[i] = (qpow(i, m) + sum[i - 1]) % mod;\n        mat[i - 1][0] = 1, mat[i - 1][m + 2] = sum[i];\n        for (int j = 1; j <= m + 1; ++j)\n            mat[i - 1][j] = mat[i - 1][j - 1] * i % mod;\n    }\n}\n\n//\u884c\uff1a[0, m + 1]\uff0c\u5217\uff1a[0, m + 2]\n\nvoid gauss()\n{\n    for (int i = 0; i <= m + 1; ++i)\n    {\n        int r = i;\n        for (int j = i + 1; j <= m + 1; ++j)\n            if (mat[j][i] > mat[r][i])\n                r = j;\n        std::swap(mat[r], mat[i]);\n        int div = inv(mat[i][i]);\n        for (int j = i; j <= m + 2; ++j)\n            mat[i][j] = mat[i][j] * div % mod;\n        for (int j = i + 1; j <= m + 1; ++j)\n        {\n            div = mat[j][i];\n            for (int k = i; k <= m + 2; ++k)\n                mat[j][k] = ((mat[j][k] - mat[i][k] * div % mod) % mod + mod) % mod;\n        }\n    }\n    f[m + 1] = mat[m + 1][m + 2];\n    for (int i = m; i >= 0; --i)\n    {\n        f[i] = mat[i][m + 2];\n        for (int j = i + 1; j <= m + 1; ++j)\n            f[i] = ((f[i] - mat[i][j] * f[j] % mod) % mod + mod) % mod;\n    }\n    return;\n}\n\nsigned main()\n{\n    m = read(), w = read();\n    for (int i = 1; i <= w; ++i)\n        p[i] = read(), a[i] = read();\n    init();\n    gauss();\n    int ans = 0;\n    for (int i = 0; i <= m + 1; ++i)\n    {\n        int tmp = 1;\n        for (int j = 1; j <= w; ++j)\n            tmp = qpow(p[j], a[j] * i % (mod - 1)) * (1ll - qpow(p[j], m - i) + mod) % mod * tmp % mod;\n        ans = (ans + tmp * f[i] % mod) % mod;\n    }\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```\n\n\n\n",
        "postTime": 1642256520,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba"
    },
    {
        "content": "\u7531\u4e8e $d$ \u6709\u522b\u7684\u7528\u9014\uff0c\u6240\u4ee5\u7528 $m$ \u6765\u8868\u793a\u539f\u6765\u7684 $d$\n\n\u9898\u76ee\u8981\u6c42\n$$\nans=\\sum_{i=1}^n[i\\bot n]i^m\n$$\n\u7136\u540e\u6839\u636e\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u5f88\u660e\u663e $[i\\bot n]=\\sum_{d|i,d|n}\\mu(d)$\uff0c\u518d\u66f4\u6362\u679a\u4e3e\u987a\u5e8f\uff0c\u5c31\u6709\n$$\nans=\\sum_{d=1}^n\\mu(d)\\sum_{i=1}^{\\frac nd}(id)^m\n$$\n\n\u628a $\\sum_{i}$ \u91cc\u7684 $d$ \u63d0\u51fa\u6765\uff0c\u7136\u540e\u5c31\u8981\u6c42 $\\sum_{i=1}^ni^n$\u3002\u5b83\u662f\u4e2a $m+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u5148\u7528 $O(m^3)$ \u9ad8\u65af\u6d88\u5143\u6c42\u51fa\u6bcf\u4e00\u9879\u7684\u7cfb\u6570 $f_i$ \uff0c\u7136\u540e\n$$\nans=\\sum_{d=1}^n\\mu(d)d^m\\sum_{i=0}^{m+1}f_i\\left(\\frac nd\\right)^m\n$$\n\u6700\u540e\u518d\u66f4\u6362\u4e00\u4e0b\u679a\u4e3e\u987a\u5e8f\u7a0d\u52a0\u6574\u7406\u5f97\u5230\n$$\nans=\\sum_{i=0}^{m+1}f_in^i\\sum_{d|n}\\mu(d)d^{m-i}\n$$\n\u9898\u76ee\u8bf4 $n=\\prod_{i=1}^wp_i^{\\alpha_i}$\uff0c\u8fd9\u6837\u6bcf\u9879\u8981\u4e58\u8d77\u6765\u7684\u5c31\u4e92\u8d28\u4e86\uff0c\u7136\u540e\u6839\u636e\u79ef\u6027\u51fd\u6570\u7684\u6027\u8d28\uff0c\u6709\n$$\nans=\\sum_{i=0}^{m+1}f_in^i\\prod_{j=1}^w\\sum_{k_j=0}^{\\alpha_j}\\mu(p_j^{k_j})p_j^{k_j(m-i)}\n$$\n\u867d\u7136\u8bf4 $\\alpha_i\\le 10^9$\uff0c\u4f46\u4e0d\u4e3a\u96f6\u7684\u53ea\u6709 $p_i^0$ \u548c $p_i^1$ \u4e24\u9879\u554a\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u505a\u5230 $O(mw\\log(m\\alpha))$ \u4e86\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#define mod 1000000007\nusing namespace std;\nint m,w,ans;\nint p[1005],a[1005];\nint g[105][105],h[105],f[105];\nint qp(int x,int y=mod-2){\n\tif(y==-1) y=mod-2;\n\tif(y==0) return 1;\n\tif(y==1) return x;\n\tint res=qp(x,y>>1);\n\tres=1ll*res*res%mod;\n\tif(y&1) res=1ll*res*x%mod;\n\treturn res;\n}\nint add(int x,int y){\n\tif((x+=y)>=mod) x-=mod;\n\treturn x;\n}\nint sub(int x,int y){\n\tif((x-=y)<0) x+=mod;\n\treturn x;\n}\nvoid init(){\n\tint n=m+1,x;\n\tfor(int i=0;i<=n;i+=1){\n\t\tg[i][0]=1; if(i) h[i]=add(h[i-1],qp(i,m));\n\t\tfor(int j=1;j<=n;j+=1) g[i][j]=1ll*g[i][j-1]*i%mod;\n\t}\n\tfor(int i=0;i<=n;i+=1){\n\t\tfor(int j=i;j<=n;j+=1){\n\t\t\tif(g[i][j]){\n\t\t\t\tswap(g[i],g[j]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor(int j=0;j<=n;j+=1){\n\t\t\tif(i==j) continue;\n\t\t\tx=1ll*g[j][i]*qp(g[i][i])%mod;\n\t\t\tfor(int k=i;k<=n;k+=1){\n\t\t\t\tg[j][k]=sub(g[j][k],1ll*g[i][k]*x%mod);\n\t\t\t}\n\t\t\th[j]=sub(h[j],1ll*h[i]*x%mod);\n\t\t}\n\t}\n\tfor(int i=0;i<=n;i+=1) f[i]=1ll*h[i]*qp(g[i][i])%mod;\n\treturn;\n}\nint solve(int n){\n\tint res=1,now;\n\tfor(int i=1;i<=w;i+=1){\n\t\tnow=1;\n\t\tif(a[i]>=1) now=sub(now,qp(p[i],m-n));\n\t\tres=1ll*res*now%mod;\n\t}\n\treturn res;\n}\nint main(){\n\tint n=1;\n\tscanf(\"%d%d\",&m,&w); init();\n\tfor(int i=1;i<=w;i+=1){\n\t\tscanf(\"%d%d\",&p[i],&a[i]);\n\t\tn=1ll*n*qp(p[i],a[i])%mod;\n\t}\n\tfor(int i=0;i<=m+1;i+=1){\n\t\tans=add(ans,1ll*f[i]*solve(i)%mod*qp(n,i)%mod);\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\nThanks~",
        "postTime": 1642133136,
        "uid": 189682,
        "name": "QQ82272760",
        "ccfLevel": 7,
        "title": "P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba \u9898\u89e3"
    },
    {
        "content": "[$\\texttt{link}$](https://www.luogu.com.cn/problem/P6271)  \n\n## \u9898\u610f\n\n\u5b9a\u4e49 $f_d(n)=\\sum\\limits_{i=1}^ni^d\\left[\\gcd(i,n)=1\\right]$\uff0c\u7ed9\u5b9a $n=\\prod\\limits_{i=1}^wp_i^{\\alpha_i}$\uff0c\u6c42 $f_d(n)$\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002  \n\n\u6570\u636e\u8303\u56f4\uff1a$1\\le d \\le 10^2,1\\le w\\le10^3,1\\le p_i,\\alpha_i\\le10^9,p_i\\in\\mathbf{Prime}$\n\n## \u9898\u89e3 \n\n\n$$\\begin{aligned}\\sum_{i=1}^n i^d\\left[\\gcd(i,n)=1\\right]&=\\sum_{i=1}^n i^d\\sum_{x|\\gcd(i,n)}\\mu(x)\\\\&=\\sum_{i=1}^ni^d\\sum_{x|i,x|n}\\mu(x)\\end{aligned}$$\n\u66f4\u6362\u679a\u4e3e\u987a\u5e8f  \n\n$$\\begin{aligned}\\sum_{i=1}^n i^d\\left[\\gcd(i,n)=1\\right]&=\\sum\\limits_{x|n}\\mu(x)\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{n}{x}}\\right\\rfloor}(ix)^d\\\\&=\\sum\\limits_{x|n}x^d\\mu(x)\\sum_{i=1}^{\\left\\lfloor{\\frac{n}{x}}\\right\\rfloor}i^d\\end{aligned}$$  \n\n\u770b\u53f3\u534a\u90e8\u5206\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u4ee4 $f(k)=\\sum\\limits_{i=1}^ki^d$\uff0c\u663e\u7136\u53ef\u4ee5\u7528\u7cfb\u6570\u8868\u793a\u6210\u4e00\u4e2a\u5173\u4e8e $k$ \u7684 $d+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u8bbe $f(k)=\\sum\\limits_{i=0}^{d+1}c_ik^i$\uff0c\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u7cfb\u6570\u53ef\u4ee5\u7528\u9ad8\u65af\u6d88\u5143\uff0clagrange \u63d2\u503c\u6216\u4f2f\u52aa\u5229\u6570\u6c42\u51fa\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(d^2)$ \u6216 $O(d^3)$\u3002  \n\n\u5e26\u8fdb\u53bb  \n\n$$\\begin{aligned}\\sum_{i=1}^n i^d\\left[\\gcd(i,n)=1\\right]&=\\sum\\limits_{x|n}x^d\\mu(x)f(\\left\\lfloor{\\frac{n}{x}}\\right\\rfloor)\\\\&=\\sum\\limits_{x|n}x^d\\mu(x)\\sum\\limits_{i=0}^{d+1}c_i\\left\\lfloor{\\frac{n}{x}}\\right\\rfloor^i\\\\&=\\sum\\limits_{i=0}^{d+1}c_in^i \\sum\\limits_{x|n}x^{d-i}\\mu(x)\\end{aligned}$$  \n\n\u8bbe $g(n)=\\sum\\limits_{x|n}x^{d-i}\\mu(x)$\uff0c\u8fd9\u4e2a\u51fd\u6570\u663e\u7136\u662f\u79ef\u6027\u7684\uff0c\u6240\u4ee5\u6709 $g(n)=\\prod\\limits_{j=1}^wg(p_j^{\\alpha_j})$\u3002\n\n\u5728\u6c42 $g(p_j^{\\alpha_j})$ \u65f6\uff0c\u6839\u636e $\\mu$ \u51fd\u6570\u7684\u5b9a\u4e49\uff0c\u542b\u6709\u5b8c\u5168\u5e73\u65b9\u56e0\u5b50\u65f6\u5176\u503c\u4e3a $0$\uff0c\u6240\u4ee5\u5f53\u4e14\u4ec5\u5f53 $x=1$ \u6216 $x=p_j$ \u65f6\uff0c$x^{d-i}\\mu(x)$ \u5bf9 $g(p_j^{\\alpha_j})$ \u662f\u6709\u8d21\u732e\u7684\uff0c\u5373 $g(p_j^{\\alpha_j})=1^{d-i}\\mu(1)+{p_j}^{d-i}\\mu(p_j)=1-p_j^{d-i}$\u3002  \n\n\u6240\u4ee5\n$$\\begin{aligned}\\sum_{i=1}^n i^d\\left[\\gcd(i,n)=1\\right]&=\\sum\\limits_{i=0}^{d+1}c_in^ig(n)\\\\&=\\sum\\limits_{i=0}^{d+1}c_in^i\\prod\\limits_{j=1}^wg(p_j^{\\alpha_j})\\\\&=\\sum\\limits_{i=0}^{d+1}c_in^i\\prod\\limits_{j=1}^w(1-p_j^{d-i})\\end{aligned}$$  \n\n\u4e8e\u662f\u53ef\u4ee5 $O(d^2+dw\\log\\text{mod})$ \u6216 $O(d^3+dw\\log\\text{mod})$ \u6c42\u51fa\u7b54\u6848\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace IO {\n\t//read and write\n} using namespace IO;\nconst int N = 1e3 + 10, P = 1e9 + 7;\nint qpow(int a, int k) {\n\tint res = 1;\n\twhile(k) {\n\t\tif(k & 1) res = 1ll * res * a % P;\n\t\ta = 1ll * a * a % P;\n\t\tk >>= 1; \n\t}\n\treturn res;\n}\nint d, w, n, a[N][N], p[N], q[N], c[N], ans;\nvoid build() {\n\tfor(int i = 0; i <= d + 1; i++) {\n\t\tfor(int j = 0; j <= d + 1; j++) a[i][j] = qpow(i + 1, j);\n\t\tfor(int j = 1; j <= i + 1; j++)\n\t\t\ta[i][d + 2] = (a[i][d + 2] + qpow(j, d)) % P;\n\t}\n}\nvoid gauss(int n) {\n\tfor(int i = 0, mx, inv; i <= n; i++) {\n\t\tmx = i;\n\t\tfor(int j = i + 1; j <= n; j++)\n\t\t\tif(a[mx][i] < a[j][i]) mx = j;\n\t\tswap(a[i], a[mx]);\n\t\tinv = qpow(a[i][i], P - 2) % P;\n\t\tfor(int j = i + 1; j <= n + 1; j++)\n\t\t\ta[i][j] = 1ll * a[i][j] * qpow(a[i][i], P - 2) % P;\n\t\tfor(int j = 0; j <= n; j++)\n\t\t\tif(i != j)\n\t\t\t\tfor(int k = i + 1; k <= n + 1; k++)\n\t\t\t\t\ta[j][k] = (a[j][k] - 1ll * a[i][k] * a[j][i] % P + P) % P;\n\t}\n\tfor(int i = 0; i <= n; i++) c[i] = a[i][n + 1]; \n}\nint main() {\n\td = read(), w = read();\n\tbuild(); gauss(d + 1);\n\tfor(int i = 1; i <= w; i++)\n\t\tp[i] = read(), q[i] = read(), n = 1ll * n * qpow(p[i], q[i]) % P;\n\tfor(int i = 0, res, t = 1; i <= d + 1; t = 1ll * t * n % P, i++) {\n\t\tres = 1ll * c[i] * t % P;\n\t\tfor(int j = 1; j <= w; j++)\n\t\t\tres = 1ll * res * (1 - qpow(p[j], d - i + P - 1) + P) % P;\n\t\tans = (ans + res) % P;\n\t}\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1627375565,
        "uid": 365107,
        "name": "Terac",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba"
    },
    {
        "content": "[P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba](https://www.luogu.com.cn/problem/P6271) \n\n$$\n\\begin{aligned}\n&\\sum_{i=1}^n[\\gcd(i,n)==1]i^k\\\\\n=&\\sum_{i=1}^n\\sum_{d|i,d|n}\\mu(d)i^k\\\\\n=&\\sum_{d|n}\\mu(d)d^k\\sum_{i=1}^{\\frac{n}{d}}i^k\n\\end{aligned}\n$$\n\n\u8bbe $F(n)=\\sum_{i=1}^ni^k$ \uff0c$F(n)$ \u4e3a\u4e00\u4e2a $k+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u5373 $F(n)=\\sum_{i=0}^{k+1}f_in^i$\uff0c\u4ee3\u5165\u4e0a\u5f0f\u5f97\n\n$$\n\\begin{aligned}\n&\\sum_{d|n}\\mu(d)d^k\\sum_{i=1}^{\\frac{n}{d}}i^k\\\\\n=&\\sum_{d|n}\\mu(d)d^k\\sum_{i=0}^{k+1}f_i\\left(\\frac{n}{d}\\right)^i\\\\\n=&\\sum_{i=0}^{k+1}f_in^i\\sum_{d|n}\\mu(d)d^{k-i}\n\\end{aligned}\n$$\n\n$k$ \u5f88\u5c0f\uff0c\u4e8e\u662f\u679a\u4e3e $i$\u3002$\\mu$ \u548c $id_k$ \u90fd\u662f\u79ef\u6027\u51fd\u6570\uff0c\u56e0\u6b64 $\\mu(d)d^k$ \u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u540e\u9762\u7684\u548c\u5f0f\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u79ef\u6027\u51fd\u6570 $*1$\uff0c\u4e5f\u662f\u79ef\u6027\u51fd\u6570\u3002\u90a3\u4e48\u8003\u8651\u7d20\u6570\u5e42\u5904\u7684\u53d6\u503c\n\n$$\n\\begin{aligned}\n&\\sum_{i=0}^{k+1}f_in^i\\sum_{d|n}\\mu(d)d^{k-i}\\\\\n=&\\sum_{i=0}^{k+1}f_in^i\\prod_{p|n}\\sum_{j=0}^{p^j|n}\\mu(p^j)p^{j(k-i)}\\\\\n=&\\sum_{i=0}^{k+1}f_in^i\\prod_{p|n}(1-p^{k-i})\n\\end{aligned}\n$$\n\n\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6c42 $f$\uff0c\u590d\u6742\u5ea6 $O(d^2+dw)$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace FGF\n{\n\tint K,m,n=1;\n\tconst int N=1010,mo=1e9+7;\n\tint p[N],ans,f[N],a[N],inv[N],g[N];\n\tint qpow(int x,int y)\n\t{\n\t\tint s=1;\n\t\twhile(y)\n\t\t{\n\t\t\tif(y&1)s=1ll*s*x%mo;\n\t\t\tx=1ll*x*x%mo;\n\t\t\ty>>=1;\n\t\t}\n\t\treturn s;\n\t}\n\tvoid Lagrange()\n\t{\n\t\tinv[1]=f[0]=1;\n\t\tfor(int i=2;i<=K+2;i++)\n\t\t\tinv[i]=1ll*inv[mo%i]*(mo-mo/i)%mo;\n\t\tfor(int i=1;i<=K+2;i++)\n\t\t\tfor(int j=K+2;j>=0;j--)\n\t\t\t\tf[j]=((j?f[j-1]:0)+1ll*(mo-i)*f[j]%mo)%mo;\n\t\tfor(int y=1,i=1;i<=K+2;i++,y=(y+qpow(i,K))%mo)\n\t\t{\n\t\t\tg[0]=1ll*f[0]*(mo-inv[i])%mo;\n\t\t\tfor(int j=1;j<=K+2;j++)\n\t\t\t\tg[j]=1ll*(f[j]-g[j-1]+mo)%mo*(mo-inv[i])%mo;\n\t\t\tint tmp=y;\n\t\t\tfor(int j=1;j<=K+2;j++)\n\t\t\t{\n\t\t\t\tif(i>j)tmp=1ll*tmp*inv[i-j]%mo;\n\t\t\t\tif(i<j)tmp=1ll*tmp*(mo-inv[j-i])%mo;\n\t\t\t}\n\t\t\tfor(int j=0;j<=K+1;j++)\n\t\t\t\ta[j]=(a[j]+1ll*tmp*g[j]%mo)%mo;\n\t\t}\n\t}\n\tvoid work()\n\t{\n\t\tscanf(\"%d%d\",&K,&m);\n\t\tfor(int i=1,x;i<=m;i++)\n\t\t\tscanf(\"%d%d\",&p[i],&x),n=1ll*n*qpow(p[i],x)%mo;\n\t\tLagrange();\n\t\tfor(int i=0,x=1;i<=K+1;i++,x=1ll*x*n%mo)\n\t\t{\n\t\t\tint s=1ll*a[i]*x%mo;\n\t\t\tfor(int j=1;j<=m;j++)\n\t\t\t\ts=1ll*s*(mo+1-qpow(p[j],K-i+mo-1))%mo;\n\t\t\tans=(ans+s)%mo;\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n\n\n",
        "postTime": 1623935325,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba\uff08\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14+\u81ea\u7136\u6570\u5e42\u548c\uff09"
    },
    {
        "content": "[\u5ba3\u4f20\u535a\u5ba2](https://blog.imyangty.com/sol-bzoj3601/)\n\n## Description\n\n\u5b9a\u4e49 $f_m(n)$ \u4e3a\u6240\u6709\u5c0f\u4e8e $n$ \u4e14\u4e0e $n$ \u4e92\u7d20\u7684\u6b63\u6574\u6570\u7684 $m$ \u6b21\u65b9\u4e4b\u548c\u3002\u7ed9\u5b9a $m$ \u7684\u503c\u548c $n$ \u7684\u8d28\u56e0\u6570\u5206\u89e3\u5f0f\uff0c\u6c42 $f_m(n)\\bmod 10^9 + 7$ \u7684\u503c\u3002\n\n\u82e5\n$$\nn = \\prod_{i = 1}^{w}p_i^{\\alpha_i}\n$$\n\u6709 $1\\le w \\le 1000$\uff0c$2\\le p_i\\le 10^9$\uff0c$1\\le \\alpha_i\\le 10^9$\uff0c$0\\le m \\le 100$\u3002\n\n## Solution\n\n### Part. 1\n\n\u9996\u5148\u660e\u786e\u4e00\u4e0b\u6c42\u7684\u4e1c\u897f\u662f\u4ec0\u4e48\uff1a\n$$\n\\sum_{i = 1}^{n - 1}i^m[\\gcd(i, n) = 1]\n$$\n\u7136\u540e\u53d1\u73b0\u8c8c\u4f3c\u628a\u4e0a\u754c\u6539\u6210 $n$ \u4e5f\u4e0d\u4f1a\u6709\u4e8b\uff0c\u53cd\u6b63 $n > 1$\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u4ece $[\\gcd(i, n) = 1]$ \u5165\u624b\u5f00\u59cb\u5316\u7b80\u5f0f\u5b50\u4e86\u3002\n$$\n\\begin{aligned}\n&\\sum_{i = 1}^ni^m\\sum_{d\\mid i, n}\\mu(d)\\\\\n=&\\sum_{d \\mid n}\\mu(d)\\sum_{i = 1}^{\\frac nd}(id)^m\\\\\n=&\\sum_{d \\mid n}\\mu(d)d^m\\sum_{i = 1}^{\\frac nd}i^m\\\\\n\\end{aligned}\n$$\n\u7b2c\u4e00\u884c\u662f\u53cd\u6f14\u53d8\u6362\u5c06 $[(i, n) = 1]$ \u6362\u6389\u3002\n\n\u7b2c\u4e8c\u884c\u662f\u66f4\u6362\u679a\u4e3e\u987a\u5e8f\uff0c\u4ee4 $i = i'd$\uff0c\u5219\u6211\u4eec\u679a\u4e3e $i'$ \u5373\u53ef\u3002\n\n\u7b2c\u4e09\u884c\u5c31\u662f\u628a\u80fd\u63d0\u51fa\u6765\u7684\u7ed9\u63d0\u51fa\u6765\u3002\n\n### Part. 2\n\n\u89c2\u5bdf\u5230\u5f0f\u5b50\u91cc\u9762\u6709\u4e00\u9879\u5f62\u5982\n$$\nf(n) = \\sum_{i = 1}^ni^m\n$$\n\u7684\u4e1c\u897f\uff0c\u6839\u636e\u7ecf\u9a8c\u53ef\u5f97 $f(n)$ \u4e3a\u5173\u4e8e $n$ \u7684 $m + 1$ \u6b21\u591a\u9879\u5f0f\u3002\u4ee4\u8fd9\u4e2a\u591a\u9879\u5f0f\u4e3a $\\sum_{i = 0}^{m + 1}f_in^i$\u3002\u8fd9\u4e9b\u7cfb\u6570\u662f\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u9ad8\u65af\u6d88\u5143\u6c42\u51fa\u6765\u7684\uff0c\u518d\u56de\u8fc7\u5934\u770b\u770b\u6211\u4eec\u7684\u5f0f\u5b50\uff1a\n$$\n\\begin{aligned}\n&\\sum_{d \\mid n}\\mu(d)d^m\\sum_{i = 1}^{\\frac nd}i^m\\\\\n=&\\sum_{d \\mid n}\\mu(d)d^m\\sum_{i = 0}^{m + 1}f_i\\left(\\frac nd\\right)^i\\\\\n=&\\sum_{i = 0}^{m + 1}f_i\\sum_{d \\mid n}\\mu(d)d^m\\left(\\frac nd\\right)^i\n\\end{aligned}\n$$\n\u540e\u9762\u7684\u90a3\u4e2a\u4e1c\u897f\u662f\u79ef\u6027\u51fd\u6570\u7684\u5377\u79ef\uff0c\u6240\u4ee5\u4ed6\u4eec\u672c\u8eab\u4e5f\u6ee1\u8db3\u79ef\u6027\uff0c\u53ef\u4ee5\u628a\u6240\u6709\u7684 $p_i^{\\alpha_i}$ \u7684\u51fd\u6570\u503c\u7b97\u51fa\u6765\u4e4b\u540e\u4e58\u5728\u4e00\u8d77\u5f97\u5230\u7ed3\u679c\u3002\u95ee\u9898\u5c31\u662f\u600e\u4e48\u5feb\u901f\u6c42\u8fd9\u4e2a\u957f\u5f97\u602a\u602a\u7684\u4e1c\u897f\u3002\n\n### Part. 3\n\n\u6ce8\u610f\u5230\u6211\u4eec\u8981\u6c42\u7684\u662f\u5f62\u5982 $p_i^{\\alpha_i}$ \u8fd9\u6837\u7684\u4e1c\u897f\u7684\u51fd\u6570\u503c\u3002\u90a3\u4e48\u5f53 $\\alpha_i\\ge 2$ \u7684\u65f6\u5019\u662f\u80af\u5b9a\u4f1a\u51fa\u73b0\u5e73\u65b9\u56e0\u5b50\u7684\uff0c\u8fd9\u90e8\u5206 $d$ \u662f\u4e0d\u7528\u8ba1\u7b97\u7684\u56e0\u4e3a $\\mu(d) = 0$\u3002\u6240\u4ee5\u5b9e\u9645\u4e0a\u8981\u7b97\u7684\u5c31\u53ea\u6709 $d = 1$ \u548c $d = p_i$ \u7684\u60c5\u51b5\u3002\u5373\u6211\u4eec\u9700\u8981\u7b97 $p_i^{\\alpha_ii} - p_i^mp_i^{\\alpha_ii-i}$\u3002\n\n\u7b97\u6cd5\u5c31\u662f\u679a\u4e3e $i$\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u8d28\u56e0\u5b50\u7b97\u4e00\u904d\u90a3\u4e2a\u79ef\u6027\u51fd\u6570\u7684\u503c\u7136\u540e\u4e58\u8d77\u6765\uff0c\u518d\u4e58\u4e0a $f_i$ \u7d2f\u52a0\u8fdb\u7b54\u6848\u4e2d\u3002\n\n\u6240\u4ee5\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(m^3 + m(m + w))$\u3002\n\n## Implementation\n\n\u9996\u5148\u662f\u521d\u59cb\u5316\u77e9\u9635\u7684\u65f6\u5019\uff0c\u5343\u4e07\u6ce8\u610f\u662f\u5426\u6709\u975e\u6cd5\u8bbf\u95ee\uff0c\u5426\u5219 WA 70\u3002\n\n\u5176\u6b21\u662f\u6ce8\u610f\u8be5\u5f00 `long long` \u7684\u5730\u65b9\u4e00\u5b9a\u4e0d\u80fd\u6f0f\u6389\uff0c\u5426\u5219 WA 50\u3002\n\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <algorithm>\n#define il inline\n#define FOR(i, a, b) for (int i = a; i <= b; ++i)\n#define DEC(i, a, b) for (int i = a; i >= b; --i)\n\nnamespace fastIO {\n    const int maxc = 1 << 21;\n    char ibuf[maxc], *__p1 = ibuf, *__p2 = ibuf;\n    il char getchar() {return __p1 == __p2 && (__p2 = (__p1 = ibuf) + fread(ibuf, 1, maxc, stdin), __p1 == __p2) ? EOF : *__p1++;}\n    template<typename T> void read(T &n) {\n        int x = 0; n = 0;\n        char c = getchar();\n        while (!isdigit(c))\n            x |= (c == '-'), c = getchar();\n        while (isdigit(c))\n            n = n * 10 + c - '0', c = getchar();\n        n = x ? -n : n;\n    }\n}\n\nusing namespace fastIO;\n\ntypedef long long ll;\nconst int mod = 1e9 + 7;\n\nll qPow(ll a, ll b, ll p = mod) {\n    if (b < 0) b += mod - 1;\n    ll ret = 1;\n    for (; b; b >>= 1, a = 1ll * a * a % p)\n        if (b & 1) ret = 1ll * ret * a % mod;\n    return ret;\n}\n\nil int inv(int a, int m = mod) {return qPow(a, m - 2, m);}\n\nconst int maxw = 1005;\nint m, w;\nll p[maxw], a[maxw];\nll mat[105][105], f[105], sum[105];\n\nvoid initMat() {\n    FOR(i, 1, m + 2) {\n        sum[i] = (qPow(i, m) + sum[i - 1]) % mod;\n        mat[i - 1][0] = 1, mat[i - 1][m + 2] = sum[i];\n        FOR(j, 1, m + 1)\n            mat[i - 1][j] = mat[i - 1][j - 1] * i % mod;\n    }\n    return;\n}\n\n//\u884c\uff1a[0, m + 1]\uff0c\u5217\uff1a[0, m + 2]\n\nvoid gauss() {\n    FOR(i, 0, m + 1) {\n        int r = i;\n        FOR(j, i + 1, m + 1)\n            if (mat[j][i] > mat[r][i])\n                r = j;\n        std::swap(mat[r], mat[i]);\n        ll div = inv(mat[i][i]);\n        FOR(j, i, m + 2) mat[i][j] = mat[i][j] * div % mod;\n        FOR(j, i + 1, m + 1) {\n            div = mat[j][i];\n            FOR(k, i, m + 2)\n                mat[j][k] = ((mat[j][k] - mat[i][k] * div % mod) % mod + mod) % mod;\n        }\n    }\n    f[m + 1] = mat[m + 1][m + 2];\n    DEC(i, m, 0) {\n        f[i] = mat[i][m + 2];\n        FOR(j, i + 1, m + 1)\n            f[i] = ((f[i] - mat[i][j] * f[j] % mod) % mod + mod) % mod;\n    }\n    return;\n}\n\nint main() {\n    read(m), read(w);\n    FOR(i, 1, w) read(p[i]), read(a[i]);\n    initMat();\n    gauss();\n    ll ans = 0;\n    FOR(i, 0, m + 1) {\n        ll tmp = 1;\n        FOR(j, 1, w)\n            tmp = qPow(p[j], a[j] * i % (mod - 1)) * (1ll - qPow(p[j], m - i) + mod) % mod * tmp % mod;\n        ans = (ans + tmp * f[i] % mod) % mod;\n    }\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```\n",
        "postTime": 1629009043,
        "uid": 212488,
        "name": "\u6e05\u70db",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6271 [\u6e56\u5317\u7701\u961f\u4e92\u6d4b2014]\u4e00\u4e2a\u4eba\u7684\u6570\u8bba"
    }
]