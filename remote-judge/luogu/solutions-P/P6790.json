[
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u56fe\uff0c\u4fdd\u8bc1\u8fd9\u4e2a\u56fe\u5220\u6389\u4e00\u6761\u8fb9\u4e4b\u540e\u662f\u8fb9\u4ed9\u4eba\u638c\uff0c\u6c42\u8be5\u56fe\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n$\\texttt{Data Range:}1\\leq n,m\\leq 5\\times 10^5$\n\n### \u9898\u89e3\n\n\u5e7f\u4e49\u4e32\u5e76\u8054\u56fe\u3002\n\n\u6ce8\u610f\u5230\u539f\u56fe\u662f\u5e7f\u4e49\u4e32\u5e76\u8054\u56fe\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u5bf9\u6bcf\u6761\u8fb9\u8fdb\u884c DP\uff0c\u7136\u540e\u5728\u6536\u7f29\u7684\u65f6\u5019\u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u4e00\u4e2a\u601d\u8def\u662f\u8bbe $f_e$ \u8868\u793a $e$ \u8fd9\u6761\u8fb9\u5728\u751f\u6210\u6811\u4e0a\u7684\u65b9\u6848\uff0c$g_e$ \u8868\u793a\u8fd9\u6761\u8fb9\u4e0d\u5728\u751f\u6210\u6811\u4e0a\u7684\u65b9\u6848\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6536\u7f29\u7684\u4e09\u79cd\u64cd\u4f5c\u6709\uff1a\n\n- \u5220 $1$ \u5ea6\u70b9\uff1a\u76f4\u63a5\u5c06 $f_e$ \u4e58\u8fdb\u7b54\u6848\u5373\u53ef\u3002\n\n- \u7f29 $2$ \u5ea6\u70b9\uff1a\u8fd9\u4e24\u6761\u8fb9\u4e0d\u53ef\u80fd\u540c\u65f6\u4e0d\u5b58\u5728\u4e8e\u751f\u6210\u6811\u4e0a\uff0c\u540c\u65f6\u7f29\u51fa\u6765\u7684\u8fb9\u53ea\u6709\u5f53\u4e24\u6761\u8fb9\u90fd\u5b58\u5728\u65f6\u624d\u5b58\u5728\uff0c\u4e8e\u662f\u6709\u5982\u4e0b\u8f6c\u79fb\uff1a\n\n$$\\begin{cases}f_e=f_{e_1}f_{e_2}\\\\g_e=f_{e_1}g_{e_2}+f_{e_2}g_{e_1}\\end{cases}$$\n\n- \u53e0\u5408\u91cd\u8fb9\uff1a\u8fd9\u4e24\u6761\u8fb9\u4e0d\u53ef\u80fd\u540c\u65f6\u5b58\u5728\u4e8e\u751f\u6210\u6811\u4e0a\uff0c\u540c\u65f6\u7f29\u51fa\u6765\u7684\u8fb9\u53ea\u6709\u5f53\u4e24\u6761\u8fb9\u90fd\u4e0d\u5b58\u5728\u65f6\u624d\u4e0d\u5b58\u5728\uff0c\u4e8e\u662f\u6709\u5982\u4e0b\u8f6c\u79fb\uff1a\n\n$$\\begin{cases}f_e=f_{e_1}g_{e_2}+f_{e_2}g_{e_1}\\\\g_e=g_{e_1}g_{e_2}\\end{cases}$$\n\n\u7136\u540e\u62d3\u6251\u6392\u5e8f\u6784\u9020\u51fa\u6574\u4e2a\u6536\u7f29\u5e8f\u5217\u5373\u53ef\uff0c\u5220\u8fb9\u7684\u8bdd\u53ef\u4ee5\u4f7f\u7528\u54c8\u5e0c\u8868\u6216\u8005\u662f `map`\uff0c\u5b9e\u6d4b `map` \u6bd4\u5404\u79cd\u54c8\u5e0c\u8868\u4f18\u79c0\uff0c\u5b9e\u73b0\u4e0a\u6709\u4ebf\u70b9\u7ec6\u8282\u8981\u6ce8\u610f\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=5e5+51,MOD=998244353;\nqueue<ll>q;\nll n,m,u,v,totd,top,x,y,r,res=1;\nll f[MAXN],g[MAXN],deg[MAXN];\nmap<ll,ll>mp[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\nint main()\n{\n    n=read(),m=read(),g[0]=1;\n    for(register int i=1;i<=m;i++)\n    {\n    \tu=read(),v=read();\n\t\t!mp[u][v]?g[mp[u][v]=mp[v][u]=++totd]=1,deg[u]++,deg[v]++:1;\n\t\tf[mp[u][v]]++;\n\t}\n\tfor(register int i=1;i<=n;i++)\n\t{\n\t\tdeg[i]<=2?q.push(i):(void)1;\n\t}\n\twhile(!q.empty())\n\t{\n\t\ttop=q.front(),q.pop();\n\t\tif(!deg[top])\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tif(deg[top]==1)\n\t\t{\n\t\t\ttie(u,x)=*mp[top].begin(),deg[top]=0,res=(li)res*f[x]%MOD;\n\t\t\tmp[top].clear(),mp[u].erase(top),--deg[u]<=2?q.push(u):(void)1;\n\t\t}\n\t\tif(deg[top]==2)\n\t\t{\n\t\t\ttie(u,x)=*mp[top].begin(),tie(v,y)=*next(mp[top].begin()),r=mp[u][v];\n\t\t\tmp[top].clear(),mp[u].erase(top),mp[v].erase(top),deg[top]=0;\n\t\t\tg[x]=((li)g[x]*f[y]+(li)f[x]*g[y])%MOD,f[x]=(li)f[x]*f[y]%MOD;\n\t\t\tf[x]=((li)f[x]*g[r]+(li)g[x]*f[r])%MOD,g[x]=(li)g[x]*g[r]%MOD;\n\t\t\tmp[u][v]=mp[v][u]=x;\n\t\t\tr?--deg[u]<=2?q.push(u):(void)1,--deg[v]<=2?q.push(v):(void)1:(void)1;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",res);\n}\n```",
        "postTime": 1612319251,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6790 \u3010[SNOI2020] \u751f\u6210\u6811\u3011"
    },
    {
        "content": "\u5982\u679c\u4e00\u4e2a\u70b9\u53cc\u7684\u751f\u6210\u5b50\u56fe\u4e2d\u6709\u5ea6\u6570\u4e3a $3$ \u7684\u70b9\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u53cc\u4e00\u5b9a\u80fd\u8868\u793a\u6210\u4e00\u4e2a\u73af\u4e0a\u6709\u82e5\u5e72\u4e0d\u4ea4\u7684\u6a2a\u8de8\u8fb9\uff0c\u6ca1\u6709\u88ab\u4efb\u4f55\u4e00\u6761\u6a2a\u8de8\u8fb9\u8986\u76d6\u7684\u8fb9\u5c31\u662f\u53bb\u6389\u540e\u4f7f\u5f97\u539f\u56fe\u662f\u4e2a\u4ed9\u4eba\u638c\u7684\u8fb9\u3002\n\n~~\u4f46\u662f\u51fa\u9898\u4eba\u628a\u6700\u540e\u4e00\u6761\u8fb9\u6f5c\u89c4\u5219\u6210\u53bb\u6389\u540e\u5269\u4e0b\u7684\u662f\u4e2a\u4ed9\u4eba\u638c\uff0c\u627e\u8fb9\u8fd9\u90e8\u5206\u6211\u5c31\u5495\u4e86~~\n\n\u627e\u5230\u8fd9\u6761\u8fb9\u4e4b\u540e\uff0c\u5c06\u6240\u6709\u751f\u6210\u6811\u5206\u6210\u53bb\u6389\u989d\u5916\u8fb9\u548c\u4e0d\u53bb\u6389\u989d\u5916\u8fb9\u4e24\u79cd\u60c5\u51b5\u3002\n\n\u53bb\u6389\u989d\u5916\u8fb9\u7684\u751f\u6210\u6811\u4e2a\u6570\u7b49\u4e8e\u6240\u6709\u73af\u7684\u73af\u957f\u4e4b\u79ef\u3002\n\n\u5efa\u51fa\u5706\u65b9\u6811\uff0c\u989d\u5916\u8fb9\u7684\u4e24\u4e2a\u7aef\u70b9\u5728\u5706\u65b9\u6811\u4e0a\u627e\u5230\u7684\u8def\u5f84\u5305\u542b\u4e86\u6240\u6709\u9700\u8981\u989d\u5916\u5904\u7406\u7684\u70b9\u53cc\u3002\u8fd9\u5f53\u4e2d\u6709\u4e00\u4e2a\u70b9\u53cc\u9700\u8981\u53bb\u6389\u8fb9\u4f7f\u4e0d\u8fde\u901a\uff0c\u5176\u4f59\u7684\u6240\u6709\u73af\u90fd\u9700\u8981\u53bb\u6389\u4e00\u6761\u8fb9\u628a\u73af\u65ad\u6389\u3002\n\n\u5c06\u4e00\u4e2a\u70b9\u53cc\u53d8\u4e3a\u4e0d\u8fde\u901a\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u5982\u679c\u70b9\u53cc\u662f\u4e00\u6761\u8fb9\uff0c\u90a3\u4e48\u65b9\u6848\u4e3a $1$\uff0c\u5426\u5219\u627e\u5230\u73af\u5728\u8def\u5f84\u4e0a\u51fa\u73b0\u7684\u4e24\u4e2a\u8282\u70b9\uff0c\u8fd9\u4e24\u4e2a\u8282\u70b9\u5c06\u73af\u5212\u5206\u6210\u7684\u4e24\u90e8\u5206\u6bcf\u90e8\u5206\u90fd\u8981\u53bb\u6389\u4e00\u6761\u8fb9\uff0c\u65b9\u6848\u6570\u5728\u77e5\u9053\u8fd9\u4e24\u4e2a\u8282\u70b9\u5728\u73af\u4e0a\u7684\u8ddd\u79bb\u540e\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u6211\u7684\u5b9e\u73b0\u4e2d\u4e3a\u4e86\u65b9\u4fbf\u7528\u4e86 map\uff0c\u590d\u6742\u5ea6\u8fbe\u5230\u4e86 $O(nlogn)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define I inline int\n#define V inline void\n#define ll long long int\n#define FOR(i,a,b) for(int i=a;i<=b;i++)\n#define ROF(i,a,b) for(int i=a;i>=b;i--)\n#define REP(u) for(int i=h[u],v;v=e[i].t,i;i=e[i].n)\nconst int N=5e5+1,mod=998244353;\nvector<int>E[N];\nint n,m,ans=1,tot,top;\nmap<int,int>id[N],cnt[N];\nint h[N],dep[N],pre[N],tmp[N];\nint dfn[N],low[N],sta[N],siz[N];\nstruct edge{int t,n;}e[N<<1];\nI Pow(ll t,int x,ll s=1){\n\tfor(;x;x>>=1,t=t*t%mod)if(x&1)s=s*t%mod;\n\treturn s;\n}\nV cmin(int&x,int y){if(y-x>>31)x=y;}\nV add_edge(int x,int y){\n\te[++tot]=(edge){y,h[x]},h[x]=tot;\n\te[++tot]=(edge){x,h[y]},h[y]=tot;\n}\nV link(int x,int y){E[x].push_back(y),E[y].push_back(x);}\nV input(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int x,y;--m;add_edge(x,y))scanf(\"%d%d\",&x,&y),cnt[x][y]++,cnt[y][x]++;\n}\nV dfs(int u){\n\tdfn[u]=low[u]=++tot,sta[++top]=u;\n\tREP(u)\n\t\tif(!dfn[v]){\n\t\t\tif(dfs(v),cmin(low[u],low[v]),low[v]!=dfn[u])continue;\n\t\t\tfor(link(u,++n);sta[top+1]!=v;)id[n][sta[top]]=++siz[n],link(n,sta[top--]);\n\t\t\tif((id[n][u]=++siz[n])==2)siz[n]=cnt[u][v];\n\t\t\tans=1ll*ans*siz[n]%mod;\n\t\t}\n\t\telse cmin(low[u],dfn[v]);\n}\nV init(int u){for(int v:E[u])if(v!=pre[u])pre[v]=u,dep[v]=dep[u]+1,init(v);}\nV init(){tot=0,dfs(1),init(1);}\nI lca(int x,int y){for(;x^y;x=pre[x])if(dep[x]<dep[y])swap(x,y);return x;}\nV work(){\n\tint x,y,v1=ans,v2=0,p,c1,c2,d,l=0,r;\n\tscanf(\"%d%d\",&x,&y),p=lca(x,y),m=dep[x]+dep[y]-dep[p]*2+1,r=m+1;\n\twhile(x!=p)tmp[++l]=x,x=pre[x];\n\twhile(y!=p)tmp[--r]=y,y=pre[y];\n\ttmp[++l]=tmp[--r]=p;\n\tFOR(i,1,m)if(siz[tmp[i]])v1=Pow(siz[tmp[i]],mod-2,v1);\n\tFOR(i,1,m)if(siz[p=tmp[i]]){\n\t\tif(x=tmp[i-1],y=tmp[i+1],siz[p]==1)c1=c2=1;\n\t\telse c1=siz[p],c2=abs(id[p][x]-id[p][y]),c2=1ll*c2*(siz[p]-c2)%mod;\n\t\tv2=(1ll*v1*c2+1ll*v2*c1)%mod,v1=1ll*v1*c1%mod;\n\t}\n\tcout<<(ans+v2)%mod;\n}\nint main(){\n\tinput();\n\tinit();\n\twork();\n\treturn 0;\n}\n```",
        "postTime": 1598510228,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6790 \u3010[SNOI2020] \u751f\u6210\u6811\u3011"
    },
    {
        "content": "\u9996\u5148\u5148\u601d\u8003\u5982\u679c\u5176\u662f\u4e00\u68f5\u4ed9\u4eba\u638c\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u505a\uff1a\u663e\u7136\uff0c\u6bcf\u4e2a\u73af\u4e0a\u987b\u5220\u53bb\u4e14\u4ec5\u5220\u53bb\u4e00\u6761\u8fb9\uff0c\u4e8e\u662f\u7b54\u6848\u5c31\u662f\u73af\u957f\u4e4b\u79ef\u3002\n\n\u4f46\u662f\u8fd9\u4e0d\u662f\u4ed9\u4eba\u638c\u3002\u8fd8\u6709\u4e00\u6761\u989d\u5916\u8fb9\u3002\n\n\u8003\u8651\u5efa\u51fa\u4ed9\u4eba\u638c\u7684\u5706\u65b9\u6811\uff0c\u5e76\u5c06\u8be5\u989d\u5916\u8fb9\u5bf9\u5e94\u7684\u8def\u5f84\u644a\u5230\u5706\u65b9\u6811\u4e0a\u3002\n\n\u8be5\u8def\u5f84\u7ecf\u8fc7\u4e86\u82e5\u5e72\u65b9\u70b9\uff0c\u4e5f\u5373\u7ecf\u8fc7\u4e86\u82e5\u5e72\u73af\u3002\n\n\u8be5\u8def\u5f84\u5916\u7684\u90e8\u5206\uff0c\u4ecd\u7136\u662f\u4ed9\u4eba\u638c\u7684\u6027\u8d28\uff1a\u6bcf\u4e2a\u73af\u5220\u4e00\u6761\u8fb9\u3002\u8be5\u8def\u5f84\u4e0a\u7684\u90e8\u5206\uff0c\u6211\u4eec\u628a\u5b83\u5355\u72ec\u6458\u51fa\u6765\u3002\u663e\u7136\u6b64\u65f6\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u82e5\u5e72\u73af\u9996\u5c3e\u76f8\u63a5\u8fde\u6210\u4e00\u4e2a\u5927\u201c\u73af\u201d\u7684\u56fe\u5f62\uff0c\u5c31\u50cf\u82e5\u5e72\u5c0f\u94c1\u73af\u4e32\u6210\u4e00\u6761\u9501\u94fe\u4e00\u6837\u3002\n\n\u663e\u7136\uff0c\u9664\u4e86\u5176\u4e2d\u7684\u4e00\u4e2a\u5c0f\u73af\u8981\u5220\u4e24\u6761\u8fb9\u5916\uff0c\u5176\u5b83\u5c0f\u73af\u90fd\u53ea\u9700\u5220\u4e00\u6761\u8fb9\u3002\n\n\u679a\u4e3e\u8be5\u5220\u4e24\u6761\u8fb9\u7684\u5c0f\u73af\u3002\u5176\u4e24\u4fa7\u6709\u4e24\u4e2a\u4e0e\u5176\u5b83\u73af\u76f8\u8fde\u7684\u201c\u5272\u70b9\u201d\uff0c\u5c06\u6574\u4e2a\u5c0f\u73af\u5206\u6210\u4e86\u4e0a\u4e0b\u4e24\u6761\u8def\u5f84\u3002\u663e\u7136\u6211\u4eec\u8981\u5728\u4e0a\u4e0b\u8def\u5f84\u4e2d\u5404\u5220\u4e00\u6761\uff0c\u56e0\u6b64\u65b9\u6848\u6570\u5373\u4e3a\u4e0a\u4e0b\u8def\u5f84\u957f\u5ea6\u4e4b\u79ef\u3002\u5176\u5b83\u73af\u7684\u8d21\u732e\u5373\u4e3a\u5176\u957f\u5ea6\u4e4b\u79ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230\u7ebf\u6027\u3002\n\n\u4f46\u662f\uff0c\u6211\u4eec\u56de\u8fc7\u5934\u6765\u601d\u8003\u4e00\u4e0b\uff0c**\u5e94\u8be5\u5982\u4f55\u627e\u5230\u90a3\u6761\u989d\u5916\u8fb9\u5462**\uff1f\n\n\u4e00\u79cd\u60f3\u6cd5\u5c31\u662f\u5efa\u51fa\u5e7f\u4e49\u5706\u65b9\u6811\u7136\u540e\u5927\u529b\u5728\u552f\u4e00\u4e00\u4e2a\u975e\u73af SCC \u4e2d\u5927\u529b\u8ba8\u8bba\uff0c\u4f46\u8fd9\u592a\u4e0d\u4f18\u96c5\u4e86\u3002\n\n\u6ce8\u610f\u5230\u4ed9\u4eba\u638c\u6709\u4e00\u4e2a\u4f18\u96c5\u7684\u6027\u8d28\uff1a\u6c42\u51fa\u5176\u4efb\u4e00\u68f5\u751f\u6210\u6811\uff0c\u5c06\u5176\u6240\u6709\u975e\u6811\u8fb9\u644a\u5230\u6811\u4e0a\uff0c\u5219\u6240\u6709\u975e\u6811\u8fb9\u5bf9\u5e94\u8def\u5f84\u4e24\u4e24\u65e0\u516c\u5171\u8fb9\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u6bcf\u6761\u6811\u8fb9\u88ab\u81f3\u591a\u4e00\u6761\u975e\u6811\u8fb9\u8986\u76d6\u3002\n\n\u73b0\u5728\u591a\u4e86\u4e00\u6761\u8fb9\uff0c\u5c31\u7b49\u4e8e\u82e5\u5e72\u6811\u8fb9\u88ab\u989d\u5916\u4e00\u6761\u975e\u6811\u8fb9\u8986\u76d6\u3002\n\n\u90a3\u5c31\u628a\u6240\u6709\u975e\u6811\u8fb9\u644a\u5230\u6811\u4e0a\u540e\uff0c\u627e\u5230\u6240\u6709\u88ab\u591a\u4e8e\u4e00\u6761\u975e\u6811\u8fb9\u8986\u76d6\u7684\u6811\u8fb9\uff08\u663e\u7136\uff0c\u6b64\u65f6\u5176\u5fc5\u7136\u88ab\u6070\u4e24\u6761\u975e\u6811\u8fb9\u8986\u76d6\uff09\uff0c\u7136\u540e\u6c42\u51fa\u8986\u76d6\u5176\u7684\u975e\u6811\u8fb9\u7684\u4ea4\u96c6\uff0c\u5219\u4ea4\u96c6\u4e2d\u7684\u8fb9\u5373\u4e3a\u8be5\u7279\u6b8a\u8fb9\u3002\uff08\u82e5\u4ea4\u96c6\u4e2d\u6709\u4e0d\u6b62\u4e00\u6761\u8fb9\uff0c\u5219\u5176\u5747\u53ef\u4f5c\u4e3a\u7279\u6b8a\u8fb9\uff09\n\n\u4e2a\u4eba\u89c9\u5f97\u8fd9\u4e2a\u505a\u6cd5\u4e0d\u7528\u5206\u7c7b\u8ba8\u8bba\u4e4b\u7c7b\u7684\uff0c\u4f1a\u66f4\u52a0\u53ef\u7231\u2026\u2026\u5417\uff1f\n\n\u5e76\u4e0d\u662f\u3002\u867d\u7136\u4ed9\u4eba\u638c\u786e\u5b9e\u662f\u6ee1\u8db3\u6bcf\u6761\u6811\u8fb9\u88ab\u81f3\u591a\u4e00\u6761\u975e\u6811\u8fb9\u8986\u76d6\u7684\u6027\u8d28\u7684\uff0c\u4f46\u662f\u4ed9\u4eba\u638c\u52a0\u4e0a\u4e00\u6761\u8fb9\u540e\uff0c\u4e0d\u4e00\u5b9a\u6bcf\u6761\u6811\u8fb9\u90fd\u88ab\u81f3\u591a\u4e24\u6761\u975e\u6811\u8fb9\u8986\u76d6\uff1a\u5047\u5982\u52a0\u4e0a\u7684\u8fb9\u5728\u6c42\u751f\u6210\u6811\u65f6\u6210\u4e3a\u4e86\u6811\u8fb9\uff0c\u5219\u4f1a\u6709\u4e24\u6761\u4f4d\u4e8e\u540c\u4e00\u73af\u4e2d\u7684\u8fb9\u53d8\u6210\u975e\u6811\u8fb9\uff0c\u8fdb\u800c\u5b83\u4eec\u8986\u76d6\u7684\u8fb9\u96c6\u6709\u4ea4\u3002\n\n\u8fd9\u65f6\uff0c\u624b\u73a9\u53ef\u4ee5\u53d1\u73b0\u65b0\u589e\u8fb9\u5fc5\u7136\u4f4d\u4e8e\u90a3\u4e24\u6761\u73af\u4e2d\u7684\u975e\u6811\u8fb9\u5bf9\u5e94\u8def\u5f84\u7684\u4ea4\u96c6\u4e2d\u3002\u8fdb\u4e00\u6b65\uff0c\u5176\u662f\u4ea4\u96c6\u4e2d\u67d0\u6761\u4ec5\u88ab\u8be5\u4e24\u6761\u73af\u975e\u6811\u8fb9\u8986\u76d6\u7684\u8fb9\u3002\u627e\u5230\u5176\u5373\u53ef\u3002\u5047\u5982\u5bfb\u627e\u7684\u751f\u6210\u6811\u662f dfs \u6811\uff0c\u8fd8\u80fd\u66f4\u597d\u5199\u4e00\u4e9b\uff08\u56e0\u4e3a dfs \u6811\u4e2d\u7684\u975e\u6811\u8fb9\u5fc5\u4e3a\u8fd4\u7956\u8fb9\uff09\u3002\n\n\u540c\u65f6\uff0c\u7528\u8fd9\u79cd\u65b9\u6cd5\u5b9e\u73b0\u65f6\u751a\u81f3\u4e0d\u7528\u5199\u5706\u65b9\u6811\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=998244353;\nint n,m,X[500100],Y[500100];\nvector<int>v[500100];\nvector<int>u[500100];\nint fi[500100],dep[500100];\nint ban;\nbool tr[500100];\nvoid dfs(int x){\n\tfor(auto i:v[x])if(i!=fi[x]&&i!=ban){\n\t\tint y=X[i]^Y[i]^x;\n\t\tif(fi[y])continue;\n\t\ttr[i]=true,fi[y]=i,dep[y]=dep[x]+1,dfs(y);\n\t}\n}\nint len[500100],on[500100];\nvoid func(){\n\tmemset(len,0,sizeof(len)),memset(on,0,sizeof(on));\n\tmemset(fi,0,sizeof(fi)),memset(tr,false,sizeof(tr));\n\tfor(int i=0;i<=n;i++)u[i].clear();\n\tfi[1]=-1,dep[1]=0,dfs(1);\n\tfor(int i=1;i<=m;i++)if(!tr[i]&&i!=ban)\n\t\tfor(int x=X[i],y=Y[i];x!=y;){\n\t\t\tif(dep[x]<dep[y])swap(x,y);\n\t\t\tu[x].push_back(i),len[i]++;\n\t\t\tx=X[fi[x]]^Y[fi[x]]^x;\n\t\t\t// printf(\"%d %d\\n\",x,y);\n\t\t}\n}\nvector<int>U,V;\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=m;i++)\n\t\tscanf(\"%d%d\",&X[i],&Y[i]),\n\t\tv[X[i]].push_back(i),v[Y[i]].push_back(i);\n\tfunc();\n\tint mx=0;\n\tfor(int i=1;i<=n;i++)mx=max(mx,(int)u[i].size());\n\tif(mx<=1){\n\t\tint res=1;\n\t\tfor(int i=1;i<=m;i++)if(len[i])res=1ll*res*(len[i]+1)%mod;\n\t\tprintf(\"%d\\n\",res);\n\t\treturn 0;\n\t}\n\tfor(int i=2;i<=n;i++)if(u[i].size()==mx){\n\t\tif(u[0].empty())u[0]=u[i];\n\t\telse{\n\t\t\tfor(auto it=u[0].begin();it!=u[0].end();)\n\t\t\t\tif(find(u[i].begin(),u[i].end(),*it)==u[i].end())\n\t\t\t\t\tit=u[0].erase(it);\n\t\t\t\telse it++;\n\t\t}\n\t}\n\tif(mx==3){\n\t\tassert(u[0].size()>=2);\n\t\tint i=u[0][0],j=u[0][1];\n\t\tif(dep[X[i]]<dep[Y[i]])swap(X[i],Y[i]);\n\t\tif(dep[X[j]]<dep[Y[j]])swap(X[j],Y[j]);\n\t\tfor(int x=(dep[X[i]]<dep[X[j]]?X[i]:X[j]);x!=Y[i]&&x!=Y[j];x=X[fi[x]]^Y[fi[x]]^x)\n\t\t\tif(u[x].size()==2){ban=fi[x];break;}\n\t\tassert(ban);\n\t\tfunc();\n\t\tfor(int i=2;i<=n;i++)assert(u[i].size()<=1);\n\t}else{\n\t\tban=u[0].back();\n\t\tint x=X[ban],y=Y[ban],z;\n\t\twhile(x!=y){\n\t\t\tif(dep[x]<dep[y])swap(x,y);\n\t\t\tu[x].erase(find(u[x].begin(),u[x].end(),ban));\n\t\t\tx=X[fi[x]]^Y[fi[x]]^x;\n\t\t}\n\t}\n\tfor(int i=2;i<=n;i++)assert(u[i].size()<=1);\n\tint x=X[ban],y=Y[ban],z;\n\twhile(x!=y){\n\t\tif(dep[x]<dep[y])swap(x,y);\n\t\tx=X[fi[x]]^Y[fi[x]]^x;\n\t}\n\tz=x;\n\tx=X[ban],y=Y[ban];\n\twhile(x!=z){\n\t\tif(!u[x].empty()){\n\t\t\ton[u[x].back()]++;\n\t\t\tif(U.empty()||U.back()!=u[x].back())\n\t\t\t\tU.push_back(u[x].back());\n\t\t}else U.push_back(fi[x]);\n\t\tx=X[fi[x]]^Y[fi[x]]^x;\n\t}\n\twhile(y!=z){\n\t\tif(!u[y].empty()){\n\t\t\ton[u[y].back()]++;\n\t\t\tif(V.empty()||V.back()!=u[y].back())\n\t\t\t\tV.push_back(u[y].back());\n\t\t}else V.push_back(fi[y]);\n\t\ty=X[fi[y]]^Y[fi[y]]^y;\n\t}\n\treverse(V.begin(),V.end());\n\tfor(auto _:V)if(U.empty()||U.back()!=_)U.push_back(_);\n\ttr[ban]=true,len[ban]=0,U.push_back(ban);\n\tstatic int pre[500100],suf[500100];\n\tpre[0]=1;for(int i=0;i<U.size();i++)\n\t\tpre[i+1]=1ll*pre[i]*(len[U[i]]+1)%mod;\n\tsuf[U.size()]=1;for(int i=U.size();i;i--)\n\t\tsuf[i-1]=1ll*suf[i]*(len[U[i-1]]+1)%mod;\n\tint pro=1,res=0;\n\tfor(int i=1;i<=m;i++)if(len[i]&&!on[i])\n\t\tpro=1ll*pro*(len[i]+1)%mod;\n\tfor(int i=0;i<U.size();i++){\n\t\tif(tr[U[i]])res=(1ll*pre[i]*suf[i+1]+res)%mod;\n\t\telse res=(1ll*pre[i]*suf[i+1]%mod*on[U[i]]%mod*(len[U[i]]-on[U[i]]+1)+res)%mod;\n\t}\n\tprintf(\"%d\\n\",1ll*pro*res%mod);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1678687518,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6790\u3010[SNOI2020] \u751f\u6210\u6811\u3011"
    }
]