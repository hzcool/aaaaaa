[
    {
        "content": "\u9996\u5148\u53d1\u73b0\u8fd9\u9053\u9898\u7684\u4ed3\u5e93\u6570\u91cf\u504f\u5c0f\uff0c\u8003\u8651\u72b6\u538b\u3002\n\n\u5b9a\u4e49\u72b6\u6001$f[i][j]$\u8868\u793a\u5df2\u7ecf\u8d70\u8fc7\u7684\u4ed3\u5e93\u96c6\u5408\u4e3a$i$\u4e14\u6700\u540e\u4e00\u6b21\u5230\u7684\u4ed3\u5e93\u4e3a$j$\u65f6\u8d70\u8fc7\u7684\u6700\u5c0f\u8ddd\u79bb\u3002\n\n\u8fd9\u4e2a\u8f6c\u79fb\u7684\u8bdd\u53ea\u9700\u8981\u5728\u679a\u4e3e\u4e0b\u4e00\u4e2a\u5230\u8fbe\u7684\u4ed3\u5e93$k$\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8f6c\u79fb\u4e86\u3002\u5982\u4e0b:\n\n$ f[i|(1<<k)][k] =min(f[i|(1<<k)][k], f[i][j] + dis[j][k])$\n\n\u8fd9\u91cc\u7684$dis[j][k]$\u5c31\u8868\u793a\u4ece$j$\u5230$k$\u7684\u6700\u77ed\u8def\uff0c\u8fd9\u4e2a\u53ea\u9700\u8981\u5728\u539f\u56fe\u4e2d\u4ee5\u6bcf\u4e00\u4e2a\u4ed3\u5e93\u4e3a\u8d77\u70b9\u8dd1\u51e0\u904d$BFS$\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4f46\u662f\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u8f93\u51fa\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u65b9\u6848\u3002\n\n\u8fd9\u4e2a\u5176\u5b9e\u5e76\u4e0d\u96be\uff0c\u53ea\u9700\u8981\u7c7b\u6bd4\u5730\u518d\u8bb0\u5f55\u4e00\u4e2a\u72b6\u6001$g[i][j]$\u8868\u793a\u6700\u5c0f\u8ddd\u79bb\u60c5\u51b5\u4e0b\u7684\u6700\u5c0f\u5b57\u5178\u5e8f\u7684\u65b9\u6848\u5373\u53ef\u3002\n\n\u6709\u5f88\u591a\u4ebaWA\u5c31\u662f\u53ea\u8003\u8651\u5728\u8f6c\u79fb$f$\u7684\u65f6\u5019\u987a\u4fbf\u66f4\u65b0\u4e00\u4e0b$g$\uff0c\u6b8a\u4e0d\u77e5\u9700\u8981\u5728$f$\u76f8\u7b49\u7684\u65f6\u5019\u518d\u5224\u65ad\u4e00\u4e0b\u66f4\u65b0$g$\u770b\u770b\u4f1a\u4e0d\u4f1a\u6709\u66f4\u5c0f\u7684\u5b57\u5178\u5e8f\u4ea7\u751f\u3002\n\n\u5177\u4f53\u7ec6\u8282\u8bf7\u770b~~\u4e11\u964b\u7684\u4ee3\u7801~~\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nstruct Node {\n    int x;\n    int y;\n};\n\nconst int N = 16;\nconst int fx[4][2] = {{0, 1}, {1, 0}, {0, -1}, {-1, 0}};//\u56db\u4e2a\u65b9\u5411\n\nint n;\nint m;\nint s;\nint jsq;\nint f[1 << N][N];    //\u6700\u5c0f\u7684\u8ddd\u79bb \nstring g[1 << N][N]; //\u8d70\u7684\u65b9\u6848\nint To[N][N];        //\u6700\u77ed\u8def\nint Arrive[501][501];//\u8bb0\u5f55\u4ee5\u67d0\u4e00\u4e2a\u70b9\u5f00\u59cb\u5230\u6240\u6709\u70b9\u7684\u6700\u77ed\u8def\nchar S[501][501];    //\u5b58\u5730\u56fe\n\nNode F[N];\n\nvoid BFS(Node F) {  //\u6c42\u4eceF\u4ed3\u5e93\u5f00\u59cb\u5230\u5176\u4ed6\u4ed3\u5e93\u7684\u6700\u77ed\u8def\u662f\u591a\u5c11\n\tmemset(Arrive, 0, sizeof(Arrive));\n\tqueue<Node>q;\n\tq.push(F);\n\tArrive[F.x][F.y] = 1;\n\twhile(!q.empty()) {\n\t\tNode f = q.front(); q.pop();\n\t\tfor(int i = 0; i < 4; i++) {\n\t\t\tint x = f.x + fx[i][0];\n\t\t\tint y = f.y + fx[i][1];\n\t\t\tif(x < 1 || y < 1 || x > n || y > m || S[x][y] == '*' || Arrive[x][y]) continue;  //\u4e0d\u53ef\u4ee5\u8d70\u5230\u5c31\u8df3\u8fc7\n\t\t\tArrive[x][y] = Arrive[f.x][f.y] + 1; //\u66f4\u65b0\u6700\u77ed\u8def\n\t\t\tq.push((Node){x, y});  //\u52a0\u5165\u961f\u5217\n\t\t}\n\t}\n}\n\nint main() {\n    scanf(\"%d%d%d\", &n, &m, &s);\n    for(int i = 1; i <= n; i++)\n        scanf(\"%s\", S[i] + 1); //\u8bfb\u5165\u5730\u56fe\n    for(int i = 1; i <= n; i++)\n        for(int j = 1; j <= m; j++) //\u627e\u5230\u4ed3\u5e93\u70b9\n            if(S[i][j] >= 'A' && S[i][j] <= 'Z')\n                F[S[i][j] - 'A' + 1] = (Node){i, j};\n    for(int i = 1; i <= s; i++) { //\u6c42\u51fa\u6700\u77ed\u8def\n\t\tBFS(F[i]);\n\t\tfor(int j = 1; j <= s; j++) To[i][j] = Arrive[F[j].x][F[j].y] - 1;\n\t}\n\tmemset(f, 63, sizeof(f));  //\u521d\u59cb\u5316\n\tf[1][1] = 0;\n\tg[1][1] = \"A\";  //\u53ea\u80fd\u4eceA\u53f7\u4ed3\u5e93\u5f00\u59cb\n\tfor(int i = 2; i < (1 << s); i++) {\n\t\tif(!(i & 1)) continue;\n\t\tfor(int j = 1; j <= s; j++) {\n\t\t\tif(i & (1 << (j - 1)) == 0) continue;\n\t\t\tfor(int k = 2; k <= s; k++) {\n\t\t\t\tif(i & (1 << (k - 1)) == 0 || j == k) continue;\n\t\t\t\tif(f[i][k] > f[i ^ (1 << (k - 1))][j] + To[j][k]) {\n\t\t\t\t\tf[i][k] = f[i ^ (1 << (k - 1))][j] + To[j][k];\n\t\t\t\t\tg[i][k] = g[i ^ (1 << (k - 1))][j] + (char)(k + 'A' - 1);\n\t\t\t\t} //\u5982\u679c\u53ef\u4ee5\u6709\u66f4\u5c0f\u7684f\u66f4\u65b0\u5c31\u76f4\u63a5\u66f4\u65b0\n\t\t\t\telse if(f[i][k] == f[i ^ (1 << (k - 1))][j] + To[j][k] && g[i][k] > (g[i ^ (1 << (k - 1))][j] + (char)(k + 'A' - 1)))\n\t\t\t\t\tg[i][k] = (g[i ^ (1 << (k - 1))][j] + (char)(k + 'A' - 1));   \n                    //\u5982\u679cf\u76f8\u7b49\u5c31\u8003\u8651\u5b57\u5178\u5e8f\u4f1a\u4e0d\u4f1a\u66f4\u65b0\u4e4b\u540e\u66f4\u5c0f\n\t\t\t}\n\t\t}\n\t}\n\tint T = (1 << s) - 1;\n\tint Min = f[T][2];\n\tstring res = g[T][2];  //\u4e0d\u53ef\u80fd\u6700\u540e\u4e00\u4e2a\u70b9\u5230A\u4ed3\u5e93\uff0c\u6240\u6709\u4ece\u7b2c\u4e8c\u4e2a\u4ed3\u5e93\u5f00\u59cb\n\tfor(int i = 3; i <= s; i++) {\n\t\tif(Min > f[T][i]) {\n\t\t\tMin = f[T][i];\n\t\t\tres = g[T][i];\n\t\t}\n\t\telse if(Min == f[T][i] && res > g[T][i])\n\t\t\tres = g[T][i];\n\t}//\u5bfb\u627e\u6700\u4f18\u89e3\n\tprintf(\"%d\\n\", Min);\n\tcout << res << endl;\n    return 0;\n}\n```",
        "postTime": 1531983179,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4772 \u3010\u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u3011"
    },
    {
        "content": "~~\u4eca\u5929\u961f\u5185\u4e92\uff08\u80e1\uff09\u6d4b\uff08\u7b56\uff09\u9898T2\uff0c\u6ca1\u60f3\u5230\u82b1\u4e862\u5c0f\u65f6\u5c45\u7136\u7801\u4e86\u51fa\u6765~~\n\n\u6700\u5f00\u59cb\u8bd5\u56fe\u641c\u7d22\u9a97\u5206\uff0c\u7136\u540e\"\u826f\u5fc3\"\u7684\u51fa\u9898\u4eba$l$*$p$\u5c06\u6d4b\u8bd5\u70b9\u5f00\u6210\u4e86\u5b50\u4efb\u52a1$...$\u7136\u540e\u5f00$10$\u4e2a\u5b50\u4efb\u52a1$100$\u4e2a\u6d4b\u8bd5\u70b9\u6346\u7ed1\u6d4b\u8bd5\n\n\u4e8e\u662f$n$=$16$\u8003\u8651\u72b6\u538b\uff0c\u8bbe\u72b6\u6001$dp[i][j]$\u8868\u793a$i$\u72b6\u6001\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u4e3a$j$\u65f6\u7684\u6700\u77ed\u8ddd\u79bb\uff0c\u56e0\u6b64\u8003\u8651\u5f53$i$\u72b6\u6001\u4e2d\u5305\u62ec$j$\u5e76\u4e14\u6ca1\u6709\u5305\u62ec$k$\u65f6\u8f6c\u79fb$dp[i|(1<<k-1)][k]$=$min(dp[i|(1<<k-1)][k],dp[i][j]+dis[j][k])$\n\n$dis[j][k]$\u8868\u793a$j$\u5230$k$\u7684\u6700\u77ed\u8def,\u53ef\u4ee5\u901a\u8fc7$bfs$\u5b9e\u73b0\uff0c\u8003\u573a\u7684\u65f6\u9650\u4e3a$1s$\uff0c\u4e8e\u662f\u6211\u5bf9\u7740\u6bcf\u4e2a\u4ed3\u5e93\u66b4\u529b\u8dd1\u4e86\u4e00\u904d$dijkstra$\u6c42\u6700\u77ed\u8def$...$\n\n\u5bf9\u7740\u6bcf\u4e2a\u4e0d\u662f\u969c\u788d\u7684\u4f4d\u7f6e\u66b4\u529b\u5efa\u8fb9\n\n```cpp\nfor(ri i=1;i<=n;i++)\n\tfor(ri j=1;j<=m;j++){\n\t\tif(a[i][j]=='*') continue;//\u5982\u679c\u4e0d\u662f\u969c\u788d\u5c31\u5411\u56db\u5468\u5efa\u8fb9\n\t\tif((a[i][j]>='A')&&(a[i][j]<='A'+p-1)) posx[a[i][j]-'@']=i,posy[a[i][j]-'@']=j;\n\t\tfor(ri k=0;k<=3;k++){\t\n\t\t\tri x=i+dx[k],y=j+dy[k];\n\t\t\tif((x>=1)&&(y>=1)&&(x<=n)&&(y<=m)&&(a[x][y]!='*')) add((i-1)*m+j,(x-1)*m+y);\n\t\t}\n\t}\n    \nfor(ri i=1;i<=p;i++)\n\tdijkstra(i);//dis[i][j]//\u8868\u793a\u4ece\u7b2ci\u4e2a\u5b57\u6bcd\u51fa\u53d1\u5230\u5404\u70b9\u7684\u6700\u77ed\u8def\n```\n\n```cpp\nvoid dijkstra(ri s){\n\tfor(ri i=1;i<=n*m;i++)\n\t\tvis[i]=0,dis[s][i]=1e9+7;\n\tdis[s][calc(s)]=0;\n\tq.push(make_pair(0,calc(s)));\n\twhile(!q.empty()){\n\t\tri u=q.top().second;\n\t\tq.pop();\n\t\tif(!vis[u]){\n\t\t\tvis[u]=1;\n\t\t\tfor(ri i=head[u];i;i=e[i].nxt){\n\t\t\t\tri v=e[i].v;\n\t\t\t\tif(dis[s][v]>dis[s][u]+1){\n\t\t\t\t\tdis[s][v]=dis[s][u]+1;\n\t\t\t\t\tq.push(make_pair(dis[s][v],v));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n\n\n```cpp\nfor(ri i=1;i<(1<<p);i++)//p\u8868\u793a\u4ed3\u5e93\u7684\u6570\u91cf\n\tfor(ri j=1;j<=p;j++)\n\t\tif((i&(1<<j-1))==(1<<j-1))\n\t\t\tfor(ri k=2;k<=p;k++)\n\t\t\t\tif((i&(1<<k-1))!=(1<<k-1)) dp[i|(1<<k-1)][k]=min(dp[i|(1<<k-1)][k],dp[i][j]+dis[j][calc(k)]);\n```\n\n\u7136\u540e\u518d\u8003\u8651\u600e\u6837\u8bb0\u5f55\u6bcf\u79cd\u72b6\u6001\u7ecf\u8fc7\u7684\u4ed3\u5e93\uff0c\u9996\u5148\u7b2c\u4e00\u4e2a\u4ed3\u5e93\u5fc5\u7136\u4e3a$A$\uff0c\u4e0d\u5fc5\u8bb0\u5f55\uff0c\u7136\u540e\u5269\u4f59\u7684\u4ed3\u5e93\u6570\u91cf\u4e3a$15$\uff0c\u53ef\u4ee5\u5c06\u72b6\u6001\u89c6\u4f5c\u4e3a\u4e00\u4e2a$16$\u8fdb\u5236\u6570\uff0c\u5c06$B$\u89c6\u4e3a$1$\uff0c$P$\u89c6\u4e3a$15$\uff0c\u5c06\u7ecf\u8fc7\u7684\u4ed3\u5e93\u72b6\u6001\u4f7f\u7528$unsigned$ $long$ $long$\u5b58\u50a8\uff0c~~\u5176\u5b9e\u8c8c\u4f3c$long$ $long$\u4e5f\u80fd\u884c~~\n\n\u4e8e\u662f\u72b6\u6001\u8f6c\u79fb\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\n\n```cpp\nmemset(dp,0x3f,sizeof(dp));\nfor(ri i=1;i<(1<<p);i++)\n\tfor(ri j=1;j<=p;j++)\t\n\t\tstate[i][j]=9223372036854775807;\nfinal=9223372036854775807;\nstate[1][1]=0=dp[1][1]=0;\nfor(ri i=1;i<(1<<p);i++)\n\tfor(ri j=1;j<=p;j++)\n\t\tif((i&(1<<j-1))==(1<<j-1))\n\t\t\tfor(ri k=2;k<=p;k++)\n\t\t\t\tif((i&(1<<k-1))!=(1<<k-1)){\n\t\t\t\t\tif(dp[i|(1<<k-1)][k]==dp[i][j]+dis[j][calc(k)]) state[i|(1<<k-1)][k]=min(state[i|(1<<k-1)][k],state[i][j]*16+(k-1));//\u5f53\u6700\u65b0\u72b6\u6001\u7684\u539f\u6700\u77ed\u8ddd\u79bb\u4e0e\u8be5\u8f6c\u79fb\u65b9\u5f0f\u76f8\u540c\u65f6\uff0c\u66f4\u65b0\u6700\u65b0\u72b6\u6001\u7684\u8f6c\u79fb\u65b9\u5f0f\n\t\t\t\t\tif(dp[i|(1<<k-1)][k]>dp[i][j]+dis[j][calc(k)]) dp[i|(1<<k-1)][k]=dp[i][j]+dis[j][calc(k)],state[i|(1<<k-1)][k]=state[i][j]*16+(k-1);//\u5982\u679c\u53ef\u4ee5\u66f4\u65b0\u6700\u65b0\u72b6\u6001\u7684\u6700\u77ed\u8ddd\u79bb\u65f6\uff0c\u5c31\u76f4\u63a5\u8f6c\u79fb\n\t\t\t\t}\n\t\t\n```\n\n\u653e\u4e0a\u8003\u573a\u4ee3\u7801\uff08\u6d1b\u8c37$dijkstra$\u9700\u8981\u5f00\u6c27\uff0c\u56e0\u4e3a\u6d1b\u8c37\u65f6\u9650$400ms$\uff0c\u9700\u8981\u5c06$dijkstra$\u6539\u4e3a$bfs$\uff09\n\n```cpp\n#include<map>\n#include<list>\n#include<queue>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define N 250010\n#define in inline\n#define ll long long\n#define INF 2147483647\n#define ri register int\n#define P pair<int,int>\nusing namespace std;\nin int read(){\n\tint v=0;char c=' ';\n\twhile((c<'0')||(c>'9')) c=getchar();\n\twhile((c>='0')&&(c<='9')){v=(v<<1)+(v<<3)+(c^48);c=getchar();}\n\treturn v;\n}\nstruct Edge{\n\tint u,v,nxt;\n}e[N<<3];\nunsigned ll state[1<<17][20],final;\nint n,m,p,cnt,posx[20],posy[20],dx[]={0,0,1,-1},dy[]={1,-1,0,0},head[N],dis[20][N],dp[1<<17][20],ans=INF,tot,let[20];\nbool vis[N];\nchar a[510][510];\npriority_queue<P,vector<P>,greater<P> > q;\nvoid add(ri u,ri v){\n\te[++cnt]=(Edge){u,v,head[u]};\n\thead[u]=cnt;\n}\nint calc(ri x){\n\treturn (posx[x]-1)*m+posy[x];\n}\nvoid dijkstra(ri s){\n\tfor(ri i=1;i<=n*m;i++)\n\t\tvis[i]=0,dis[s][i]=1e9+7;\n\tdis[s][calc(s)]=0;\n\tq.push(make_pair(0,calc(s)));\n\twhile(!q.empty()){\n\t\tri u=q.top().second;\n\t\tq.pop();\n\t\tif(!vis[u]){\n\t\t\tvis[u]=1;\n\t\t\tfor(ri i=head[u];i;i=e[i].nxt){\n\t\t\t\tri v=e[i].v;\n\t\t\t\tif(dis[s][v]>dis[s][u]+1){\n\t\t\t\t\tdis[s][v]=dis[s][u]+1;\n\t\t\t\t\tq.push(make_pair(dis[s][v],v));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){\n\tn=read(),m=read(),p=read();\n\tfor(ri i=1;i<=n;i++)\n\t\tfor(ri j=1;j<=m;j++)\n\t\t\tcin>>a[i][j];\n\tfor(ri i=1;i<=n;i++)\n\t\tfor(ri j=1;j<=m;j++){\n\t\t\tif(a[i][j]=='*') continue;\n\t\t\tif((a[i][j]>='A')&&(a[i][j]<='A'+p-1)) posx[a[i][j]-'@']=i,posy[a[i][j]-'@']=j;\n\t\t\tfor(ri k=0;k<=3;k++){\t\n\t\t\t\tri x=i+dx[k],y=j+dy[k];\n\t\t\t\tif((x>=1)&&(y>=1)&&(x<=n)&&(y<=m)&&(a[x][y]!='*')) add((i-1)*m+j,(x-1)*m+y);\n\t\t\t}\n\t\t}\n\tfor(ri i=1;i<=p;i++)\n\t\tdijkstra(i);\n\tmemset(dp,0x3f,sizeof(dp));\n\tfor(ri i=1;i<(1<<p);i++)\n\t\tfor(ri j=1;j<=p;j++)\t\n\t\t\tstate[i][j]=9223372036854775807;\n\tfinal=9223372036854775807;\n\tstate[1][1]=0;\n\tdp[1][1]=0;\n\tfor(ri i=1;i<(1<<p);i++)\n\t\tfor(ri j=1;j<=p;j++){\n\t\t\tif((i&(1<<j-1))==(1<<j-1)){\n\t\t\t\tfor(ri k=2;k<=p;k++)\n\t\t\t\t\tif((i&(1<<k-1))!=(1<<k-1)){\n\t\t\t\t\t\tif(dp[i|(1<<k-1)][k]==dp[i][j]+dis[j][calc(k)]) state[i|(1<<k-1)][k]=min(state[i|(1<<k-1)][k],state[i][j]*16+(k-1));\n\t\t\t\t\t\tif(dp[i|(1<<k-1)][k]>dp[i][j]+dis[j][calc(k)]) dp[i|(1<<k-1)][k]=dp[i][j]+dis[j][calc(k)],state[i|(1<<k-1)][k]=state[i][j]*16+(k-1);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\tfor(ri i=1;i<=n;i++){\n\t\tif(ans==dp[(1<<p)-1][i]) final=min(final,state[(1<<p)-1][i]);\n\t\tif(ans>dp[(1<<p)-1][i]) ans=dp[(1<<p)-1][i],final=state[(1<<p)-1][i];\n\t}\n\tprintf(\"%d\\nA\",ans);\n\twhile(final) let[++tot]=final%16,final/=16;\n\tfor(ri i=tot;i;i--)\n\t\tprintf(\"%c\",let[i]+'A');//\u5c06\u4eceB\u5411\u540e\u7ecf\u8fc7\u7684\u4ed3\u5e93\u8f93\u51fa\n\treturn ~~(0-0);\n}\n\n```\n\n _~~\u6700\u540e\u8fd9\u573a\u8003\u8bd5\u7a9d\u597d\u50cf$AK$\u4e86~~_ ",
        "postTime": 1572253811,
        "uid": 90610,
        "name": "\u4faf\u4f73\u660a",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4772 \u3010\u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u3011"
    },
    {
        "content": "### \u8bf4\u5b9e\u8bdd\u8fd9\u4e2a\u9898\u601d\u8def\u4e0d\u96be\uff0c\u4f46\u5361\u65f6\u95f4\u7a7a\u95f4\u6781\u5176\u6bd2\u7624\uff01\uff01\uff01\n\u505a\u8fd9\u4e2a\u9898\u4e4b\u524d\u63a8\u8350\u5927\u5bb6\u5148\u505a\u4e00\u4e0b\u6d1b\u8c37\u7684   \n\n[P4802 [CCO 2015]\u8def\u77ed\u6700](https://www.luogu.org/problem/P4802)\n\n\u662f\u8fd9\u4e2a\u9898\u7684\u7b80\u5316\u7248\uff08\u63a8\u8350\u98df\u7528\u6211\u7684\u9898\u89e3QWQ\uff09\n\n\u5206\u6790\u4e00\u4e0b\uff0cN<=16\u8003\u8651\u72b6\u538b\uff0c\u4f46\u662f\u80af\u5b9a\u4e0d\u80fd\u5728\u56fe\u4e0a\u72b6\u538b\u5427\u3002\u3002\u3002\n\n\u6c42\u6700\u77ed\u8def\uff0c\u90a3\u4e48\u5148\u6bcf\u4e2a\u70b9BFS\u4e00\u904d\u6c42\u6700\u77ed\u8def\u90a3\u4e48\u5c31\u53ef\u4ee5\u8131\u79bb\u539f\u56fe\u4e86\uff08\u57fa\u672c\u64cd\u4f5c\uff09\n\n\u5269\u4e0b\u7684\u7b2c\u4e00\u95ee\u548cP4802\u4e00\u6837DP\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\n\n\u4f46\u662f\u4e0d\u4e00\u6837\u7684\u662f\u672c\u9898\u53ea\u80fd\u4eceA\u70b9\u51fa\u53d1\uff01\uff01\uff01\uff08\u6211\u56e0\u4e3a\u8fd9\u4e2aWA\u4e8620\u5206\uff09\n\n\u7b2c\u4e8c\u95ee\u624d\u662f\u8fd9\u4e2a\u9898\u6076\u5fc3\u7684\u5730\u65b9\uff08\u601d\u8def\u501f\u9274 Cesare\u5927\u4f6c\uff09\n\n\u672c\u6765\u7ef4\u62a4\u4e00\u4e2astring[1<<17][17]\u4e0d\u4f1a\u88ab\u5361\uff0c\u4f46\u662f\u51fa\u9898\u4eba\u6545\u610f\u5361\u81ea\u5df131.25MB\n\n\u53ea\u80fd\u8003\u8651\u4ece\u7b54\u6848\u53cd\u5411DFS\u66f4\u65b0\uff0c\u6b63\u5e38570+ms\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u672c\u9898400ms\u5f00O2\u52c9\u5f3a\u8fc7\n\n\u4ee3\u7801\u90e8\u5206\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<queue>\n#include<cstring\ntypedef long long ll;\nusing namespace std;\nll dp[1<<17][20],n,m,num,dis[50][50],ans=0x7f7f7f7f7f7f7f;\nll tx[5]={0,0,1,-1};\nll ty[5]={1,-1,0,0};\nll head[1<<17][20];\nchar s[510][510];\nbool book[510][510];\nstring sans;\nvoid bfs(ll stx,ll sty){\n\tmemset(book,0,sizeof(book));\n\tqueue<ll>x;\n\tqueue<ll>y;\n\tqueue<ll>val;\n\tx.push(stx);\n\ty.push(sty);\n\tval.push(0);\n\tbook[stx][sty]=1;\n\twhile(x.size()){\n\t\tll ax=x.front();\n\t\tll ay=y.front();\n\t\tll av=val.front();\n\t\tfor(ll i=0;i<4;i++){\n\t\t\tll kx=ax+tx[i];\n\t\t\tll ky=ay+ty[i];\n\t\t\tll kv=av+1;\n\t\t\tif(kx>=0&&kx<n&&ky>=0&&ky<m){\n\t\t\t\tif(s[kx][ky]=='.'&&book[kx][ky]==0){\n\t\t\t\t\tbook[kx][ky]=1;\t\n\t\t\t\t\tx.push(kx);\n\t\t\t\t\ty.push(ky);\n\t\t\t\t\tval.push(kv);\n\t\t\t\t}\n\t\t\t\tif(s[kx][ky]>='A'&&s[kx][ky]<='Z'&&book[kx][ky]==0){\n\t\t\t\t\tbook[kx][ky]=1;\n\t\t\t\t\tdis[s[stx][sty]-'A'][s[kx][ky]-'A']=kv;\n\t\t\t\t\tx.push(kx);\n\t\t\t\t\ty.push(ky);\n\t\t\t\t\tval.push(kv);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tx.pop();\n\t\ty.pop();\n\t\tval.pop();\n\t}\n}//\u5e38\u89c4BFS\nvoid dfs(ll i,ll S,string k){\n\tk.insert(0,1,(char)(i+'A'));//\u610f\u601d\u662f\u5728k[0]\u5904\u63d2\u51651\u4e2achar\u7c7b\u578b\u7684\u5b57\u7b26\n\tif(S==1){\n\t\tif(sans==\"\") sans=k;\n\t\telse if(k<sans) sans=k;//string\u53ef\u4ee5\u76f4\u63a5\u6bd4\u8f83\u5b57\u5178\u5e8f\n\t\treturn;\n\t}\n\tll now=S^(1<<i);\n\tfor(ll j=0;j<num;j++) \n\t\tif((now&(1<<j))&&dp[S][i]==dp[now][j]+dis[j][i])\n\t\t\tdfs(j,now,k);\n}\nint main(){\n\tscanf(\"%lld%lld%lld\",&n,&m,&num);\n\tfor(ll i=0;i<n;i++)\n\t\tscanf(\"%s\",s[i]);\n\tfor(ll i=0;i<n;i++)\n\t\tfor(ll j=0;j<n;j++)\n\t\t\tif(s[i][j]>='A'&&s[i][j]<='Z')\n\t\t\t\tbfs(i,j);\n\tfor(ll i=0;i<=(1<<num)-1;i++)\n\t\tfor(ll j=0;j<num;j++)\n\t\t\tdp[i][j]=0x7f7f7f7f7f7f7f;\n\tfor(ll j=0;j<num;j++)\n\t\tdp[(1<<j)^1][j]=dis[0][j];\n\tdp[1][0]=0;//\u521d\u59cb\u5316\uff0c\u4ee5\u81ea\u5df1\u4e3a\u8d77\u70b9\u7ec8\u70b9\u4e3a0\uff0cDFS\u4f1a\u7528\u5230\uff0c\u4e0d\u61c2\u7684\u8bdd\u5220\u53bb\u6a21\u62df\u4e00\u4e0bDFS\u6837\u4f8b\u5427\n\tfor(ll i=0;i<=(1<<num)-1;i++)\n\t\tfor(ll j=0;j<num;j++)\n\t\t\tif(i&(1<<j))\n\t\t\t\tfor(ll k=0;k<num;k++)\n\t\t\t\t\tif(i&(1<<k)&&k!=j)\n\t\t\t\t\t\tif(dp[i^(1<<j)][k]+dis[k][j]<dp[i][j])\n\t\t\t\t\t\t\tdp[i][j]=dp[i^(1<<j)][k]+dis[k][j];\n   //\u548cP4802\u65b9\u7a0b\u4e00\u6837\n\tfor(ll i=0;i<num;i++)\n\t\tans=min(ans,dp[(1<<num)-1][i]);\n\tprintf(\"%lld\\n\",ans);\n\tfor(ll i=0;i<num;i++)\n\t\tif(dp[(1<<num)-1][i]==ans)\n\t\t\tdfs(i,((1<<num)-1),\"\");//DFS\u641c\n\tcout<<sans;\n\treturn 0;\n}\n```\n\n## \u795d\u5927\u5bb62019CSP,NOI,XXXOI RP++!!!",
        "postTime": 1570609942,
        "uid": 221615,
        "name": "S_S_H",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4772 \u3010\u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u3011"
    },
    {
        "content": "\u76f4\u63a5 $O(2^{rc})$ \u66b4\u529b\u641c\u7d22\u80af\u5b9a\u4f1a TLE\u3002\u5b9e\u5219\u53ef\u4ee5\u7b80\u5316\uff0c\u5199\u4e00\u4e2a BFS \u8dd1\u51fa\u5404\u4e2a\u70b9\u7684\u6700\u77ed\u8def\uff0c\u7136\u540e\u66b4\u529b $O(n!)$ \u641c\u7d22\u3002\n\nBFS \u4ee3\u7801\uff1a\n\n```cpp\nconst int dx[] = {0, 1, 0, -1}, dy[] = {1, 0, -1, 0};\nstruct node {\n\tint x, y, s;\n\tnode(int _, int __, int _s) :\n\t\tx(_), y(__), s(_s) {}\n};\nvoid bfs(char k) {\n\tqueue<node> q;\n\tq.push(node(x[k], y[k], 0)), memset(vis, 0, sizeof vis);\n\tvis[x[k]][y[k]] = true, dis[k][k] = 0;\n\twhile (!q.empty()) {\n\t\tnode u = q.front(); q.pop();\n\t\tif (isupper(s[u.x][u.y])) dis[k][s[u.x][u.y]] = u.s;\n\t\tfor (int i = 0; i < 4; i ++) {\n\t\t\tnode v(u.x + dx[i], u.y + dy[i], u.s + 1);\n\t\t\tif (v.x >= 1 && v.x <= r && v.y >= 1 && v.y <= c && s[v.x][v.y] != '*' && !vis[v.x][v.y])\n\t\t\t\tvis[v.x][v.y] = true, q.push(v);\n\t\t}\n\t}\n}\nfor (int i = 1; i <= n; i ++)\n\tbfs(i + 'A' - 1);\n    \n// x['A'], y['A']\u5206\u522b\u662f\u519c\u573aA\u7684x\u4e0ey\u5750\u6807\u3002\n// dis['A']['B']\u662f\u519c\u573aA\u5230B\u7684\u6700\u77ed\u8def\n```\n\n\u7136\u9e45\u53c8\u662f TLE \u2026\u2026\n\n\u4e00\u822c $O(n!)$ \u641c\u7d22\u7684\u90fd\u53ef\u4ee5\u7b80\u5316\u6210 $O(n2^n)$ \u6216 $O(n^22^n)$ \u7684\u72b6\u538b dp\uff0c\u53c2\u8003[P1171 \u552e\u8d27\u5458\u7684\u96be\u9898](https://www.luogu.com.cn/problem/P1171)\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5199\u51fa\u4e00\u4e2a\u72b6\u538b dp\uff1a\n\n$f_{i,j}$ \u4e3a\u904d\u5386\u8fc7\u7684\u519c\u573a\u7684\u96c6\u5408\u4e3a $i$\uff0c\u76ee\u524d\u5728\u519c\u573a $j$ \u7684\u6700\u77ed\u8def\u3002\n\n\u90a3\u4e48\u6709:\n\n$$f_{i,j}=\\min_{k\\in i}\\{f_{i\\text{ xor }2^j,k}+dis_{k,j}\\}$$\n\n$i\\text{ xor }2^j$ \u76f8\u5f53\u4e8e\u4ece\u96c6\u5408 $i$ \u4e2d\u5220\u53bb $j$\u3002\n\ndp \u4ee3\u7801\uff1a\n\n```cpp\nfor (int i = 0; i < 1 << c; i ++)\n\t\tfor (int j = 0; j < c; j ++)\n\t\t\tif (i & 1 << j)\n\t\t\t\tfor (int k = 0; k < c; k ++)\n\t\t\t\t\tif (j != k && (i & 1 << k))\n\t\t\t\t\t\tif (f[i][j] > f[i ^ 1 << j][k] + dis[k + 'A'][j + 'A'])\n\t\t\t\t\t\t\tf[i][j] = f[i ^ 1 << j][k] + dis[k + 'A'][j + 'A'];\n```\n\n\u7136\u9e45\uff0c\u4f60\u53d1\u73b0\u8981\u6c42\u8def\u5f84\u2026\u2026\u90a3\u4e48\u53ef\u4ee5\u5efa\u4e00\u4e2a\u5b57\u7b26\u4e32\u6570\u7ec4\u7edf\u8ba1\u3002\n\n\n\u5f53 $f_{i,j}$ \u6709\u66f4\u4f18\u65f6\uff0c\u8981\u66f4\u65b0\u8def\u5f84\uff1b\u5f53\u5b83\u4eec\u76f8\u7b49\u4e14\u65b0\u7684\u8def\u5f84\u5b57\u5178\u5e8f\u66f4\u5c0f\u65f6\uff0c\u4e5f\u8981\u66f4\u65b0\u3002\n\n~~\u611f\u89c9\u50cf\u5199\u5927\u6a21\u62dfqwq~~\n\nCode:\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 17, M = 505, dx[] = {0, 1, 0, -1}, dy[] = {1, 0, -1, 0};\nstruct node {\n\tint x, y, s;\n\tnode(int _, int __, int _s) :\n\t\tx(_), y(__), s(_s) {}\n};\nint f[1 << N][N], dis[M][M], x[M], y[M], n, m, c, ans = 114514;\nchar s[M][M];\nbool vis[M][M];\nstring str, path[1 << N][N];\nvoid bfs(char k) {\n\tqueue<node> q;\n\tq.push(node(x[k], y[k], 0)), memset(vis, 0, sizeof vis);\n\tvis[x[k]][y[k]] = true, dis[k][k] = 0;\n\twhile (!q.empty()) {\n\t\tnode u = q.front(); q.pop();\n\t\tif (isupper(s[u.x][u.y])) dis[k][s[u.x][u.y]] = u.s;\n\t\tfor (int i = 0; i < 4; i ++) {\n\t\t\tnode v(u.x + dx[i], u.y + dy[i], u.s + 1);\n\t\t\tif (v.x >= 1 && v.x <= n && v.y >= 1 && v.y <= m && s[v.x][v.y] != '*' && !vis[v.x][v.y])\n\t\t\t\tvis[v.x][v.y] = true, q.push(v);\n\t\t}\n\t}\n}\nint main() {\n\tcin >> n >> m >> c;\n\tmemset(f, 0x3f, sizeof f);\n\tfor (int i = 1; i <= n; i ++)\n\t\tfor (int j = 1; j <= m; j ++) {\n\t\t\tcin >> s[i][j];\n\t\t\tif (isupper(s[i][j]))\n\t\t\t \tx[s[i][j]] = i, y[s[i][j]] = j;\n\t\t}\n\tfor (int i = 1; i <= c; i ++)\n\t\tbfs(i + 'A' - 1);\n\tf[1][0] = 0, path[1][0] = \"A\";\n\tfor (int i = 0; i < 1 << c; i ++)\n\t\tfor (int j = 0; j < c; j ++)\n\t\t\tif (i & 1 << j)\n\t\t\t\tfor (int k = 0; k < c; k ++)\n\t\t\t\t\tif (j != k && (i & 1 << k))\n\t\t\t\t\t\tif (f[i][j] > f[i ^ 1 << j][k] + dis[k + 'A'][j + 'A']) {\n\t\t\t\t\t\t\tf[i][j] = f[i ^ 1 << j][k] + dis[k + 'A'][j + 'A'];\n\t\t\t\t\t\t\tpath[i][j] = path[i ^ 1 << j][k] + char('A' + j);\n\t\t\t\t\t\t} else if (path[i][j] > (path[i ^ 1 << j][k] + char('A' + j)) && f[i][j] == f[i ^ 1 << j][k] + dis[k + 'A'][j + 'A'])\n\t\t\t\t\t\t\tpath[i][j] = path[i ^ 1 << j][k] + char('A' + j);\n\tfor (int i = 1; i < c; i ++)\n\t\tif (ans > f[(1 << c) - 1][i]) {\n\t\t\tans = f[(1 << c) - 1][i];\n\t\t\tstr = path[(1 << c) - 1][i];\n\t\t} else if (str > path[(1 << c) - 1][i] && ans == f[(1 << c) - 1][i])\n\t\t\tstr = path[(1 << c) - 1][i];\n\tcout << ans << '\\n' << str << '\\n';\n\treturn 0;\n}\n```\n",
        "postTime": 1657595969,
        "uid": 560516,
        "name": "\u55b5\u4ed4\u725b\u5976",
        "ccfLevel": 0,
        "title": "P4772 \u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u9898\u89e3"
    },
    {
        "content": "## [P4772 \u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1](https://www.luogu.com.cn/problem/P4772)\n\n## \u9898\u76ee\u5927\u610f\uff1a\n\u7ed9\u51fa\u4e00\u77e9\u9635\uff0c\u6c42\u7ecf\u8fc7\u6240\u6709\u4ed3\u5e93\u7684\u6700\u77ed\u8def\u3002\n\n## solution:\n\n\u770b\u5230\u5f88\u5c0f\u7684 $n$ \u7684\u8303\u56f4\uff0c\u6211\u4eec\u8003\u8651\u72b6\u538b\u3002\u8ddf [P4802 [CCO 2015]\u8def\u77ed\u6700](https://www.luogu.com.cn/problem/P4802) \u4e0d\u540c\u7684\u662f\uff0c\u672c\u9898\u7ed9\u51fa\u4e86\u77e9\u9635\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5982\u4f55\u5efa\u56fe:\n\t\n\u6211\u4eec\u4ece\u6bcf\u4e2a\u70b9\u51fa\u53d1\uff0c\u8fdb\u884c $\\text{BFS}$ \uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u72b6\u538b\u4e86\u3002\n\n\u8bbe**\u72b6\u6001** $f[\\,i\\,][\\,j\\,]$ \u4e3a\u5f53\u524d\u72b6\u6001\u4e3a $\\,i\\,$ \u8d70\u5230\u4e86 $\\,j\\,$ \u70b9\u7684\u6700\u77ed\u8def\u5f84\u957f\uff0c$g[\\,i\\,][\\,j\\,]$ \u4e3a\u5f53\u524d\u72b6\u6001\u4e3a $\\,i\\,$ \u8d70\u5230\u4e86 $\\,j\\,$ \u70b9\u7684\u6700\u5c0f\u5b57\u5178\u5e8f\u8def\u5f84\u3002\n\n\u81f3\u4e8e\u8def\u5f84\u957f\uff0c~~\u6613\u5f97~~\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n   $$f[\\,i\\,][\\,j\\,]= \\text{max}(f[\\,i\\,][\\,j\\,],f[\\,i\\, \\bigoplus\\,(1\\ll j)][\\,k\\,]+dis[\\,k\\,][\\,j\\,]) $$\n   \n\u601d\u8003\u4e00\u4e0b\u6700\u5c0f\u5b57\u5178\u5e8f\u8def\u5f84\uff0c\u8fd9\u91cc $g[\\,i\\,][\\,j\\,]$ \u6211\u7528\u7684\u662f $\\text{string}$ \u7c7b\u578b\uff0c\u65b9\u4fbf\u5b57\u7b26\u4e32\u7684\u62fc\u63a5\u4e0e\u6bd4\u8f83\u3002\u8f6c\u79fb\u6211\u4eec\u8003\u8651\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. \u5f53\u524d\u6700\u77ed\u8def\u66f4\u65b0\u4e86\uff0c\u76f8\u5e94\u7684\u8def\u5f84\u4e5f\u8981\u66f4\u65b0\u3002\n2. \u5f53\u524d\u6700\u77ed\u8def\u65e0\u6cd5\u66f4\u65b0\uff0c\u4f46\u4e0e\u539f\u72b6\u6001\u76f8\u7b49\uff0c\u5e76\u4e14\u5f53\u524d\u7684\u8def\u5f84\u5b57\u5178\u5e8f\u8f83\u5c0f\uff0c\u53ef\u66f4\u65b0\u3002\n\n## \u7ec6\u8282\u5904\u7406\uff1a\n- \u53ea\u80fd\u4ece $\\text{A}$ \u70b9\u51fa\u53d1\u3002\n- \u6700\u540e\u7edf\u8ba1\u7b54\u6848\u8981\u8d4b\u4e2a\u6781\u5927\u503c\u3002\n\n\u770b\u5230\u8fd9\u7684\u540c\u5b66\uff0c\u53ef\u4ee5\u81ea\u5df1\u53bb\u5199\u4ee3\u7801\u4e86(~~tf\u53e3\u543b~~)\n\n[code](https://www.luogu.com.cn/paste/jk067sgm)\n\n### End",
        "postTime": 1619825374,
        "uid": 297501,
        "name": "Th1nkS2",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4772 \u3010\u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u3011"
    },
    {
        "content": "$update:$ \u4fee\u6539\u90e8\u5206\u63aa\u8f9e\u4e0e\u6392\u7248\u3002\n\n\u518d $update:$ \u5220\u9664\u4e86\u67d0\u4e9b\u5bf9\u51fa\u9898\u4eba\u4e0d\u656c\u7684\u7528\u8bed\uff0c\u589e\u52a0\u4e86\u5c0f\u6807\u9898\u3002~~\u5927\u7237\u6211\u9519\u4e86\uff0c\u8ba9\u6211\u8fc7\u5427~~\n\n## $Solution$\n\n\u72b6\u538b $dp$ + \u6700\u77ed\u8def\u3002\n\n### \u72b6\u538b $dp$ \u90e8\u5206\n\n\u8bbe $f_{i, S}$ \u8868\u793a\u5f53\u524d\u5728 $i$ \uff0c\u8d70\u8fc7\u4ed3\u5e93\u7684\u72b6\u6001\u4e3a $S$ \u8d70\u7684\u6700\u77ed\u8ddd\u79bb\u3002 \n\n\u6709\u8f6c\u79fb\n\n$$f_{j, S | (1 << j - 1)} = min (f_{j, S | (1 << j - 1))}, f_{i, S} + dis_{i, j})$$\n\n## \u6700\u77ed\u8def\u90e8\u5206\n\n\u6211\u4eec\u53d1\u73b0\u53ea\u9700\u8981\u5bf9\u4e8e $k$ \u4e2a\u70b9\u6c42\u5230\u5176\u4ed6\u70b9\u7684\u6700\u77ed\u8def\u5c31\u53ef\u4ee5\u4e86\uff0c\u5b58\u4e0b\u6765\u4e4b\u540e\u76f4\u63a5 $dp$ \u3002 \n\n\u4f46\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u672c\u9898\u8981\u6c42\u8f93\u51fa\u8d70\u7684\u65b9\u6848\uff0c\u8fd8\u8981\u6c42\u5b57\u5178\u5e8f\u6700\u5c0f\u3002\n\n\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u7528\u4e00\u4e2a $string$ \u5b58\u4e00\u4e0b\u4e2d\u95f4\u6bcf\u4e00\u6b65\u8f6c\u79fb\u65b9\u6848\u7684\u6700\u5c0f\u5b57\u5178\u5e8f\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\u987a\u4fbf\u6bd4\u4e00\u4e0b\u5c31\u662f\u4e86\u3002\n\n\u4f46\u662f\u51fa\u9898\u4eba\u5361\u4e86\u7a7a\u95f4\uff0c\u5bfc\u81f4\u4e86\u8fd9\u79cd\u505a\u6cd5 $MLE$ \u3002\n\n~~\u6211\u4e5f\u4e0d\u77e5\u9053\u662f\u4e0d\u662f\u6211\u4e0d\u592a\u4f1a\u5361\u7a7a\u95f4\u624d\u6ca1\u5361\u8fc7\u53bb\u3002~~\n\n\u6240\u4ee5\u8003\u8651\u53e6\u4e00\u79cd\u505a\u6cd5\uff1a\u5148 $dp$ \u4e00\u904d\uff0c $dp$ \u5b8c\u4e4b\u540e\u628a\u6240\u6709\u6700\u4f18\u7684\u7b54\u6848\u90fd $dfs$ \u4ed6\u80fd\u4ece\u54ea\u91cc\u8f6c\u79fb\u5230\uff0c\u7136\u540e\u5b58\u4e0b\u8fd9\u4e2a\u7b54\u6848\u3002\n\n\u5982\u6b64\uff0c\u5f00 $O2$ \u52c9\u5f3a * \u8fc7\u3002\n\n## $Code:$\n\n```cpp\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\n//#include <tr1/unordered_map>\n//#include\"Bignum/bignum.h\"\n//#define lll bignum\n#define lowbit(x) (x & -x)\n#define debug(x) (cout << \"#x = \" << (x) << endl)\n#define Set(x, i) memset (x, i, sizeof(x))\n#define R register\n#define For(i, j, k) for(R int i = (j), ED = (k); i <= ED; ++i)\n#define Rep(i, j, k) for(R int i = (j), ED = (k); i >= ED; --i)\n#define Cross(i, j, k) for(R int i = (j); i; i = (k))\nusing namespace std;\ntypedef long long ll;\nconst ll N = 511;\nconst ll INF = 5e16;\n\nnamespace IO {\n\n    inline char gc() {\n        static char buf[100000], *p1 = buf, *p2 = buf;\n        return (p1 == p2) && (p2 = (p1 = buf) +\n            fread (buf, 1, 100000, stdin), p1 == p2)? EOF: *p1++;\n    }\n\n    #define dd ch = getchar()\n    inline ll read() {\n        R ll x = 0; R int f = 0; R char dd;\n        for (; !isdigit (ch); dd) f ^= (ch == '-');\n        for (; isdigit (ch); dd)  x = x * 10 + (ch ^ 48);\n        return f? -x: x;\n    }\n    #undef dd\n\n    inline void write( ll x ) {\n        if (x < 0) putchar ('-'), x = -x;\n        if (x > 9) write (x / 10); putchar (x % 10 | 48);\n    }\n\n    inline void wrn ( ll x ) { write (x); putchar (' '); }\n\n    inline void wln ( ll x ) { write (x); putchar ('\\n'); }\n\n    inline void wlnn ( ll x, ll y ) { wrn (x), wln (y); }\n\n}\n\nusing IO::wln;\nusing IO::read;\n\nnamespace Cesare {\n    \n    const ll M = 31;\n    \n\tchar mp[N][N];\n    string S = \"\";\n    ll n, m, k, CC, pos, Ans = INF;\n    ll Dis[N][N], f[M][(1 << 16) + 2];\n    \n    \n    struct Node {\n        ll x, y;\n    } Way[N];\n    \n    struct Alb {\n        ll x, y;\n    };\n    \n    /*\n        \u8bbe f[i][S] \u8868\u793a\u5f53\u524d\u5728 i \uff0c \n        \u8d70\u8fc7\u4ed3\u5e93\u7684\u72b6\u6001\u4e3a S \u8d70\u7684\u6700\u77ed\u8ddd\u79bb\u3002 \n        if (!(S & (1 << j - 1))) \n            f[j][S | (1 << j - 1)] = \n                min (f[j][S | (1 << j - 1))], f[i][S] + Dis[i][j])\n        \u9884\u5904\u7406 i -> j \u7684\u6700\u77ed\u8def\u5373\u53ef\u3002 \n    */\n    \n    const ll dx[] = { 1, 0, -1, 0 };\n    const ll dy[] = { 0, 1, 0, -1 };\n    \n    ll D[N][N], Vis[N][N];\n    \n    inline ll bfs ( ll sx, ll sy ) {\n        Set (Vis, 0);\n        Set (D, 0x3f);\n        queue <Alb> Q;\n        Q.push((Alb) { sx, sy });\n        D[sx][sy] = 0; Vis[sx][sy] = 1;\n        while (!Q.empty()) {\n            Alb T = Q.front(); \n            Q.pop(); \n            for (R int i = 0; i < 4; ++i) {\n                ll nx = T.x + dx[i], ny = T.y + dy[i];\n                if (nx <= 0 || nx > n || ny <= 0 || ny > m) continue;\n                if (Vis[nx][ny] || mp[nx][ny] == '*') continue;\n                Vis[nx][ny] = 1; Q.push((Alb) { nx, ny });\n                D[nx][ny] = D[T.x][T.y] + 1;\n            }\n        } return INF;\n    }\n    \n    inline void dfs ( ll i, ll St, string K ) {\n    \tK.insert(0, 1, (char) (i + 'A' - 1));\n    \tif (St == 1) {\n    \t\tif (S == \"\") S = K;\n    \t\telse if (S > K) S = K;\n\t\t\treturn ;\n\t\t}\n    \tll NS = St - (1 << i - 1);\n    \tFor ( j, 1, CC ) \n            if ((NS & (1 << j - 1)) && \n                f[i][St] == f[j][NS] + Dis[j][i]) dfs (j, NS, K);\n    }\n    \n//    inline void Print ( ll i, ll S ) {\n//        A[++K] = i;\n//        if (i == 1ll) return ;\n//        Print (xzy[i][S], S ^ (1ll << i - 1ll)); \n//    }\n    \n    void main() {\n        Set (f, 0x3f); \n        n = read(), m = read(), k = CC = read();\n        For ( i, 1, n ) For ( j, 1, m ) cin >> mp[i][j];\n        For ( i, 1, n ) For ( j, 1, m ) \n            if (mp[i][j] >= 'A' && mp[i][j] <= 'Z') \n                Way[mp[i][j] - 'A' + 1] = (Node) { i, j };\n        For ( i, 1, CC ) {\n            bfs (Way[i].x, Way[i].y);\n            For ( j, 1, CC ) Dis[i][j] = D[Way[j].x][Way[j].y];\n        }\n        f[1][1] = 0;\n        ll Max = (1 << CC) - 1;\n        For ( St, 1, Max ) For ( i, 1, CC ) For ( j, 1, CC ) {\n            ll I = 1 << i - 1, J = 1 << j - 1;\n            if ((St & I) && (!(St & J))) \n                f[j][St | J] = min (f[j][St | J], f[i][St] + Dis[i][j]);\n        }\n        For ( i, 1, CC ) Ans = min (Ans, f[i][Max]);\n        wln (Ans);\n        For ( i, 1, CC ) if (Ans == f[i][Max]) dfs (i, Max, \"\");\n        cout << S << endl, exit (0);\n    }\n    \n}\n\nint main()\n{\n    return Cesare::main(), 0;\n}\n\n/*\n\n*/\n\n```",
        "postTime": 1562804753,
        "uid": 104379,
        "name": "Cesare",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4772 \u3010\u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u3011"
    },
    {
        "content": "\u4e0d\u592a\u96be\u7684\u84dd\u9898\uff0c\u6574\u4f53\u6765\u8bf4\u6bd4\u8f83\u597d\u60f3\u3002\n\n\u770b\u5230 $1 \\leq N \\leq 16$\uff0c\u5c31\u5f88\u5bb9\u6613\u60f3\u5230\u72b6\u6001\u538b\u7f29\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u5230\u6bcf\u4e2a\u70b9\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u72b6\u538b\uff0c$f[i][j]$ \u4ee3\u8868\u4e0a\u4e00\u4e2a\u7684\u70b9\u662f $\\texttt{A}+i-1$\uff0c\u73b0\u5728\u5230\u4e86 $j$ \u4e2a\u70b9\uff0c\u627e\u5f53\u524d\u7684\u6700\u5c0f\u8ddd\u79bb\uff0c\u6bcf\u6b21\u8f6c\u79fb\u7528\u4e4b\u524d\u9884\u5904\u7406\u7684\u8ddd\u79bb\uff0c\u6211\u8fd9\u91cc\u7528\u7684\u662f\u6211\u4e3a\u4eba\u4eba\uff0c\u7136\u540e\u8f93\u51fa\u600e\u4e48\u8d70\uff0c\u8fd9\u91cc\u5982\u679c\u8f6c\u79fb\u8fc7\u53bb\u503c\u7684\u8981\u5c0f\u4e8e\u5f53\u524d\u503c\uff0c\u90a3\u4e48\u628a\u53e6\u4e00\u4e2a\u6570\u7ec4 $last[x][y]$ \u6362\u6210 $last[i][j]$ \u63d2\u5165 $\\texttt{A}+x-1$\uff0c\u7136\u540e\u7ed3\u5c3e\u76f4\u63a5\u8f93\u51fa\u5c31\u884c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(N2^N)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u540c\u6837 $O(N2^N)$\u3002\n\n```cpp\n#include<iostream>\n#include<cmath>\n#include<algorithm>\n#include<string>\n#include<cstring>\n#include<queue>\n#include<stack>\n#include<iomanip>\n#define int long long\nusing namespace std;\nint n,m,t;\nvector<pair<int,pair<int,int> > >v;\nchar mp[505][505];\nint f[30][100001];\nstring last[30][100001];\nint dis[30][30],vis[505][505];\nint dx[4]={0,0,1,-1};\nint dy[4]={1,-1,0,0};\nint cnt=0;\nvoid bfs(int p)//\u9884\u5904\u7406\u8ddd\u79bb\n{\n\tmemset(vis,-1,sizeof(vis));\n\tqueue<pair<int,int> >q;\n\tvis[v[p].second.first][v[p].second.second]=0;\n\tq.push(make_pair(v[p].second.first,v[p].second.second));\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front().first,y=q.front().second;\n\t\tif(mp[x][y]>='A'&&mp[x][y]<='Z')\n\t\t{\n\t\t\tdis[v[p].first][mp[x][y]-'A'+1]=vis[x][y];\n\t\t}\n\t\tfor(int i=0;i<4;i++)\n\t\t{\n\t\t\tint xx=x+dx[i],xy=y+dy[i];\n\t\t\tif(vis[xx][xy]!=-1||xx<1||xx>n||xy<1||xy>m||mp[xx][xy]=='*')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvis[xx][xy]=vis[x][y]+1;\n\t\t\tq.push(make_pair(xx,xy));\n\t\t}\n\t\tq.pop();\n\t}\n}\nsigned main()\n{\n\tmemset(dis,0x3f3f3f3f,sizeof(dis));\n\tcin>>n>>m>>t;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tcin>>mp[i][j];\n\t\t\tif(mp[i][j]>='A'&&mp[i][j]<'Z')\n\t\t\t{\n\t\t\t\tcnt+=(1<<(mp[i][j]-'A'));\n\t\t\t\tv.push_back(make_pair(mp[i][j]-'A'+1,make_pair(i,j)));//\u6bcf\u4e00\u4e2a\u5b57\u7b26\u90fd\u653e\u8fdb\u6876\u91cc\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=0;i<t;i++)//\u679a\u4e3e\u6bcf\u4e00\u4e2a\u8d77\u70b9\n\t{\n\t\tbfs(i);\n\t}\n\tmemset(f,0x3f,sizeof(f));//\u628af\u521d\u59cb\u5316\n\tf[1][1]=0;//\u8d77\u59cb\u70b9\u662f'A'\n\tlast[1][1]+='A';\n\tfor(int j=1;j<cnt;j++)\n\t{\n\t\tfor(int it=0;it<v.size();it++)\n\t\t{\n\t\t\tint i=v[it].first;\n\t\t\tif((j&(1<<(i-1)))==0)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor(int kt=0;kt<v.size();kt++)\n\t\t\t{\n\t\t\t\tint k=v[kt].first;\n\t\t\t\tif((j&(1<<(k-1)))!=0)//\u6ca1\u6709\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(f[k][j+(1<<(k-1))]>f[i][j]+dis[i][k])\n\t\t\t\t{\n\t\t\t\t\tf[k][j+(1<<(k-1))]=f[i][j]+dis[i][k];\n\t\t\t\t\tlast[k][j+(1<<(k-1))]=last[i][j]+char(k+'A'-1);\n\t\t\t\t}\n\t\t\t\tif(f[k][j+(1<<(k-1))]==f[i][j]+dis[i][k]&&last[k][j+(1<<(k-1))]>last[i][j]+char(k+'A'-1))\n\t\t\t\t{\n\t\t\t\t\tlast[k][j+(1<<(k-1))]=last[i][j]+char(k+'A'-1);\n\t\t\t\t}\n\t\t\t\tif(f[k][j+(1<<(k-1))]==f[i][j]+dis[i][k]&&last[k][j+(1<<(k-1))].size()==0)\n\t\t\t\t{\n\t\t\t\t\tf[k][j+(1<<(k-1))]=f[i][j]+dis[i][k];\n\t\t\t\t\tlast[k][j+(1<<(k-1))]=last[i][j]+char(k+'A'-1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tf[0][cnt]=0x3f3f3f3f3f;\n\tint minnid=0;\n\tfor(int i=1;i<=t;i++)\n\t{\n\t\tif(f[i][cnt]<f[minnid][cnt])\n\t\t{\n\t\t\tminnid=i;\n\t\t}\n\t}\n\tcout<<f[minnid][cnt]<<endl;\n\tstring ans=last[minnid][cnt];\n\tfor(int i=1;i<=t;i++)\n\t{\n\t\tif(last[i][cnt]<ans&&f[i][cnt]==f[minnid][cnt]&&last[i][cnt].size()!=0)\n\t\t{\n\t\t\tans=last[i][cnt];\n\t\t}\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1648192814,
        "uid": 326797,
        "name": "Suffix_Sum",
        "ccfLevel": 5,
        "title": "P4772 \u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1\u9898\u89e3"
    },
    {
        "content": "\u7b80\u660e\u9898\u610f\u5982\u4e0b\uff1a\n\n- \u7ed9\u5b9a\u4e00\u4e2a $R \\times C$ \u7684\u5b57\u7b26\u77e9\u9635\u4f5c\u4e3a\u5730\u56fe\u3002\u5305\u542b $N$ \u4e2a\u5b57\u6bcd\u4f5c\u4e3a\u8282\u70b9\uff1b\n- \u6c42\u4e00\u6761\u4ece $\\text{A}$ \u8282\u70b9\u5f00\u59cb\u8d70\u8fc7\u6240\u6709\u8282\u70b9\u7684\u9053\u8def\uff0c\u4f7f\u5f97**\u8def\u5f84\u6700\u77ed**\uff0c\u5728\u6b64\u524d\u63d0\u4e0b\u4f7f\u5f97\u7ecf\u8fc7\u7684\u8282\u70b9\u7f16\u53f7\u5e8f\u5217\u7684**\u5b57\u5178\u5e8f**\u6700\u5c0f\u3002\n\n***\n\n\u6c42\u89e3\u6b64\u9898\u9700\u8981\u5148\u4e86\u89e3[**\u54c8\u5bc6\u987f\u8def\u5f84**](https://oi-wiki.org/graph/hamilton/)\uff08$\\texttt{Hamilton Path}$\uff0c\u4e5f\u79f0\u54c8\u5bc6\u987f\u901a\u8def\uff09\u3002\u6307\u4e00\u6761\u7b80\u5355\u8def\u5f84**\u4e0d\u91cd\u590d**\u5730\u7ecf\u8fc7**\u6240\u6709\u8282\u70b9**\u4ec5\u4e00\u6b21\u3002\u5305\u542b\u54c8\u5bc6\u987f\u8def\u5f84\u7684\u56fe\u79f0\u4f5c**\u54c8\u5bc6\u987f\u56fe**\u3002\u6570\u636e\u4fdd\u8bc1\u6709\u89e3\uff0c\u56e0\u6b64\u8fd9\u5f20\u5730\u56fe\u5fc5\u7136\u662f\u4e00\u5f20\u54c8\u5bc6\u987f\u56fe\u3002\n\n\u6c42\u6700\u77ed\u8def\u5f84\u7684\u95ee\u9898\u4fbf\u662f**\u6700\u77ed\u54c8\u5bc6\u987f\u8def\u5f84\u95ee\u9898**\u3002\u6700\u77ed\u54c8\u5bc6\u987f\u8def\u5f84\u5c31\u662f\u6240\u6709\u54c8\u5bc6\u987f\u8def\u5f84\u4e2d\u6700\u77ed\u7684\u4e00\u6761\u3002\u4e3a\u4e86\u65b9\u4fbf\u6c42\u89e3\uff0c\u5047\u8bbe\u5df2\u7ecf\u77e5\u9053\u6bcf\u4e2a\u8282\u70b9\u5230\u5176\u4ed6\u6240\u6709\u8282\u70b9\u7684\u8fb9\u7684\u957f\u5ea6\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u5730\u56fe\u5efa\u6210\u4e00\u5f20\u56fe\u3002\n\n\u6c42\u89e3\u6700\u77ed\u54c8\u5bc6\u987f\u8def\u5f84\u95ee\u9898\u901a\u5e38\u4f7f\u7528\u72b6\u6001\u538b\u7f29 $\\texttt{dp}$\u3002\u5177\u4f53\u8fd9\u91cc\u4e0d\u505a\u8fc7\u591a\u7684\u8bb2\u89e3\uff0c\u53ea\u4f5c\u7b80\u5355\u4ecb\u7ecd\uff0c\u82e5\u9700\u8981\u6a21\u677f\u7ec3\u4e60\u53ef\u4ee5\u5c1d\u8bd5 [P4802 \u77ed\u8def\u6700](https://www.luogu.org/problem/P4802)\u3002\n\n\u56e0\u4e3a $N \\leq 16$\uff0c\u4e14\u9700\u8981\u968f\u65f6\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u70b9\u662f\u5426\u6709\u5230\u8fbe\u8fc7\uff0c\u8003\u8651\u72b6\u538b\u3002\u7528\u4e00\u4e2a\u6574\u6570 $S$ \u6765\u8bb0\u5f55\uff0c\u8bbe\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b\u7b2c $k$ \u4f4d\u4e3a $S_k$\uff0c\u8868\u793a\u8282\u70b9 $k$ \u662f\u5426\u5230\u8fbe\u8fc7\u3002\u5219\u72b6\u6001\u53ef\u4ee5\u7528\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(S, \\text{pos})$ \u8868\u793a\uff0c$\\text{pos}$ \u8868\u793a\u5f53\u524d\u5904\u4e8e\u54ea\u4e2a\u70b9\u3002\u9700\u8981\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 $\\text{pos}$ \u4e00\u7ef4\u4e0d\u53ef\u5c11\u3002\n\n\u7528 $S^{\\prime}_i$ \u8868\u793a\u5c06 $S$ \u4e8c\u8fdb\u5236\u8868\u793a\u4e0b\u7684\u7b2c $i$ \u4f4d\u8bbe\u4e3a $1$ \u540e\u7684\u503c\uff0c\u8bbe\u96c6\u5408 $U_v$ \u8868\u793a\u6240\u6709\u4ece\u8282\u70b9 $v$ \u51fa\u53d1\u80fd\u5230\u8fbe\u7684\u672a\u8bbf\u95ee\u8fc7\u8282\u70b9\u7684\u96c6\u5408\uff0c\u90a3\u4e48\u72b6\u6001\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n$$\n\\forall i \\in U_k~~~~\n(S, k)\n\\rightarrow\n(S^{\\prime}_i, i)+E_{k,i}\n$$\n\n\u5176\u4e2d\uff0c$E_{k,i}$ \u8868\u793a\u8fde\u63a5\u8282\u70b9 $k$ \u548c\u8282\u70b9 $i$ \u7684\u8fb9\u7684\u957f\u5ea6\u3002\n\n\u9898\u76ee\u8fd8\u8981\u6c42\u8f93\u51fa\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u8def\u5f84\u3002\u5982\u679c\u4f7f\u7528**\u8bb0\u5fc6\u5316\u641c\u7d22**\u6765\u8ba1\u7b97\u4e0a\u9762\u7684\u72b6\u6001\u8f6c\u79fb\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u76f8\u5bf9\u5bb9\u6613\u7684\u89e3\u51b3\u3002\u529e\u6cd5\u662f\u8bb0\u5f55**\u5f53\u524d\u72b6\u6001\u7684\u6700\u4f18\u540e\u7ee7\u72b6\u6001**\uff0c\u7531\u4e8e\u521d\u59cb\u72b6\u6001\u548c\u7ec8\u6b62\u72b6\u6001\u90fd\u662f\u786e\u5b9a\u7684\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u9012\u63a8\u6765\u8ba1\u7b97\u51fa\u8def\u5f84\u3002\n\n\u5177\u4f53\u53ef\u4ee5\u7ed3\u5408\u4ee3\u7801\u5b9e\u73b0\u6765\u66f4\u597d\u5730\u7406\u89e3\u3002\n\n\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u4f55\u628a\u5b57\u7b26\u77e9\u9635\u5efa\u6210\u4e00\u5f20\u56fe\u3002\u8fd9\u4e2a\u95ee\u9898\u4e0d\u96be\u89e3\u51b3\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u4f7f\u7528 $\\texttt{BFS}$ \u6765\u5f97\u5230\u8be5\u8282\u70b9\u5230\u5176\u5b83\u8282\u70b9\u7684\u6700\u77ed\u8def\u5f84\u957f\u5ea6\u5373\u53ef\u3002\u603b\u5171\u9700\u8981\u8fdb\u884c $N$ \u6b21 $\\texttt{BFS}$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(NRC)$\uff0c\u53ef\u4ee5\u627f\u53d7\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\uff1a\n\n```\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int maxn = 16 + 1;\n\nint r, c, n;\nchar org[500 + 5][500 + 5];\nint stp[500 + 5][500 + 5];\nbool vis[500 + 5][500 + 5];\n\nint posx[maxn], posy[maxn];\n\nint tot = 0;\nint head[550], nxt[550], ver[550], w[550];\nvoid add(int x, int y, int v) {\n\ttot++, ver[tot] = y, w[tot] = v, nxt[tot] = head[x], head[x] = tot;\n}\n\nstruct Rec {\n\tint x, y, step;\n};\n\nint dx[4] = { -1, 1, 0, 0 };\nint dy[4] = { 0, 0, 1, -1 };\n\ninline bool valid(int x, int y) { // \u5224\u65ad (x,y) \u662f\u5426\u8d8a\u754c\u6216\u4e0d\u80fd\u884c\u8d70\n\treturn org[x][y] != '*' && x > 0 && y > 0 && x <= r && y <= c;\n}\n\nvoid bfs(int sx, int sy) { // BFS \u627e\u6700\u77ed\u8def\n\tRec rec;\n\trec.x = sx, rec.y = sy, rec.step = 0;\n\tvis[sx][sy] = true;\n\tqueue<Rec> q;\n\tq.push(rec);\n\twhile(!q.empty()) {\n\t\trec = q.front(); q.pop();\n\t\tstp[rec.x][rec.y] = rec.step;\n\t\tfor(int i = 0; i < 4; i++) {\n\t\t\tint nx = rec.x + dx[i], ny = rec.y + dy[i];\n\t\t\tif(valid(nx, ny) && !vis[nx][ny]) vis[nx][ny] = true, q.push((Rec){nx, ny, rec.step + 1});\n\t\t}\n\t}\n}\n\nvoid read_map() {\n\tchar x;\n\tcin >> r >> c >> n;\n\tfor(int i = 1; i <= r; i++) {\n\t\tfor(int j = 1; j <= c; j++) {\n\t\t\tcin >> x;\n\t\t\tif(isalpha(x)) { // \u662f\u5b57\u6bcd\n\t\t\t\tposx[x - 'A' + 1] = i;\n\t\t\t\tposy[x - 'A' + 1] = j;\n\t\t\t\torg[i][j] = '.';\n\t\t\t}\n\t\t\telse {\n\t\t\t\torg[i][j] = x;\n\t\t\t}\n\t\t}\n\t}\n}\nint S;\n\nint f[1 << 16][maxn];\nint fbest[1 << 16][maxn];\nint pos;\nint dp() {\n\tif(S == (1 << n) - 1) { // \u7ec8\u6b62\u72b6\u6001\n\t\treturn 0;\n\t}\n\telse {\n\t\tint ret = 0x3f3f3f3f;\n\t\tif(f[S][pos] != -1) return f[S][pos];\n\t\t\n\t\tint bk = pos;\n\t\tint best_step = 0xff; // \u6700\u4f73\u540e\u7ee7\u51b3\u7b56\n\t\t\n\t\tfor(int i = head[pos]; i; i = nxt[i]) {\n\t\t\tint to = ver[i], len = w[i];\n\t\t\tif(!(S & (1 << (to - 1)))) {\n\t\t\t\tS |= (1 << (to - 1));\n\t\t\t\tpos = to;\n\t\t\t\tint aft = dp() + len; // \u8ba1\u7b97\u4e0b\u4e00\u9636\u6bb5\n\t\t\t\tif(aft <= ret && best_step >= to) {\n\t\t\t\t\t// \u66f4\u4f18\u7684\u89e3\u6cd5\uff1a\u5148\u5224\u65ad\u8def\u5f84\u662f\u5426\u66f4\u77ed\uff0c\u5982\u679c\u662f\u5224\u65ad\u5b57\u5178\u5e8f\u662f\u5426\u66f4\u5c0f\n\t\t\t\t\t// \u6ce8\u610f\u8fd9\u91cc\u7684 <= \u53f7\u4e0d\u80fd\u5199\u6210 <\n\t\t\t\t\tret = aft;\n\t\t\t\t\tbest_step = to;\n\t\t\t\t}\n\t\t\t\tS &= ~(1 << (to - 1));\n\t\t\t}\n\t\t}\n\t\tpos = bk;\n\t\tfbest[S][pos] = best_step; // \u4fdd\u5b58\u5f53\u524d\u72b6\u6001\u7684\u6700\u4f73\u540e\u7ee7\u51b3\u7b56\n\t\treturn f[S][pos] = ret;\n\t}\n}\n\n// \u5199\u6210\u4e00\u4e2a get \u51fd\u6570\u66f4\u65b9\u4fbf\u8c03\u7528\nint get(int x) {\n\tS = 1 << (x - 1);\n\tpos = x;\n\treturn dp();\n}\n\nvoid weedy(int x) {\n\tS |= 1 << (x - 1);\n\tpos = x; // \u521d\u59cb\u72b6\u6001\n\tcout << (char)(x + 'A' - 1);\n\tfor(int i = 1; i < n; i++) { // \u627e n \u4e2a\u70b9\u9700\u8981\u5faa\u73af n-1 \u6b21\n\t\tint nxtpt = fbest[S][pos]; // \u627e\u5230\u5f53\u524d\u72b6\u6001\u7684\u6700\u4f73\u540e\u7ee7\u9009\u62e9\n\t\tpos = nxtpt; // \u66f4\u65b0\u72b6\u6001\n\t\tS |= 1 << (pos - 1);\n\t\tcout << (char)(nxtpt + 'A' - 1);\n\t}\n}\n\nint main() {\n\tread_map();\n\t\n\tfor(int node = 1; node <= n; node++) {\n\t\tmemset(vis, false, sizeof(vis));\n\t\tmemset(stp, 0, sizeof(stp));\n\t\tbfs(posx[node], posy[node]);\n\t\tfor(int i = node + 1; i <= n; i++) { // \u6ce8\u610f\u6dfb\u52a0\u53cc\u5411\u8fb9\n\t\t\tif(i != node) {\n\t\t\t\tadd(i, node, stp[posx[i]][posy[i]]);\n\t\t\t\tadd(node, i, stp[posx[i]][posy[i]]);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tmemset(f, -1, sizeof(f));\n\tcout << get(1) << endl;\n\tweedy(1);\n\treturn 0;\n}\n```\n\n\u7ecf\u8fc7\u4e00\u5b9a\u7684\u4f18\u5316\uff0c\u76ee\u524d\u8fd9\u4efd\u4ee3\u7801\u5df2\u7ecf\u80fd\u591f\u6bd4\u8f83\u5feb\u5730\u901a\u8fc7\u672c\u9898\u4e86\u3002\u5177\u4f53\u53ef\u89c1[\u8bc4\u6d4b\u8bb0\u5f55](https://www.luogu.com.cn/record/69312138)\u3002",
        "postTime": 1644829067,
        "uid": 188950,
        "name": "UruhaRushia",
        "ccfLevel": 6,
        "title": "P4772 \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\uff1a\n\u7ed9\u5b9a\u4e00\u4e2a $r \\times c$ \u7684\u77e9\u9635\uff0c\u6c42\u4ece $A$ \u4ed3\u5e93\u51fa\u53d1\u7ecf\u8fc7\u6240\u6709\u4ed3\u5e93\u7684\u6700\u77ed\u8def\u5f84\u957f\u5ea6\uff0c\u548c\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u4e00\u4e2a\u65b9\u6848\u8def\u5f84\u3002\n\n### \u601d\u8def\uff1a\n\u53d1\u73b0 $n$ \u5f88\u5c0f\uff0c\u8003\u8651\u72b6\u538b\u3002\n\n\u8bbe $f[S][i]$ \u8868\u793a\u5728 $S$ \u8fd9\u4e2a\u72b6\u6001\u6700\u540e\u5230\u8fbe $i$ \u70b9\u7684\u6700\u77ed\u8def\u5f84\u957f\u5ea6\u3002\n\n\u5f97\u5230\u8f6c\u79fb $f[S|(1<<j-1)][j] = \\min(f[S][i]+Dis[i][j])$\u3002\n\n\u5176\u4e2d $j$ \u8868\u793a\u5230\u8fbe $S|(1<<j-1)$ \u8fd9\u4e2a\u72b6\u6001\u7684\u6700\u540e\u4e00\u4e2a\u70b9\uff0c$i$ \u8868\u793a\u8f6c\u79fb\u5230\u8fd9\u4e2a\u72b6\u6001\u7684\u4e0a\u4e00\u4e2a\u70b9\uff0c$Dis[i][j]$ \u8868\u793a $i$ \u5230 $j$ \u7684\u6700\u77ed\u8def\u5f84\u957f\u5ea6\uff0c\u53ef\u4ee5\u7528 BFS \u66b4\u529b\u6c42\u51fa\u6765\u3002\n\n\u8003\u8651\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u8bb0\u5f55\u8def\u5f84\uff0c$g[S][i].prei$\uff0c$g[S][i].pres$ \u8868\u793a\u7684\u662f\u4ee5 $i$ \u7ed3\u5c3e\u7684\u72b6\u6001 $S$ \u65f6\u7531\u4ee5 $prei$ \u7ed3\u5c3e\u7684\u72b6\u6001 $pres$ \u8f6c\u79fb\u800c\u6765\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u9012\u5f52\u5c06\u6574\u6761\u8def\u5f84\u8f93\u51fa\u51fa\u6765\u3002\n\n\u8fd8\u8981\u4fdd\u8bc1\u5b57\u5178\u5e8f\u6700\u5c0f\uff0c\u5728\u8f6c\u79fb $f$ \u7684\u65f6\u5019\uff0c\u5982\u679c $f[S|(1<<j-1)][j] > f[S][i] + Dis[i][j]$\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u628a $g$ \u66f4\u65b0\u6389\uff0c\u5982\u679c $f[S|(1<<j-1)][j] = f[S][i] + Dis[i][j]$\uff0c\u76f4\u63a5\u66b4\u529b\u628a\u4e24\u6761\u8def\u5f84\u6c42\u51fa\u6765\u6bd4\u8f83\u5927\u5c0f\uff0c\u5982\u679c\u65b0\u8def\u5f84\u5b57\u5178\u5e8f\u66f4\u5c0f\u5c31\u66f4\u65b0 $g$\uff0c\u5426\u5219\u4e0d\u66f4\u65b0\u3002\u53ef\u4ee5\u7528\u9012\u5f52\u5b9e\u73b0\u3002\n\n### \u4e3b\u8981\u4ee3\u7801\uff1a\n```cpp\n\nint n, r, c, a[510][510], f[(1 << 16)][17], tot, vis[510][510]; \n\nstruct kk {\n    int pres, prei;\n}g[(1 << 16)][17];\n\nstruct node {\n    char c;\n    int x, y;\n}u, t, C[17];\n\nint dis[510][510], Dis[17][17];\nint dx[] = {0, 0, 1, -1};\nint dy[] = {1, -1, 0, 0};\n\nvoid bfs(int s) {\n    memset(dis, 0x3f, sizeof dis);\n    queue<node> q;\n    dis[C[s].x][C[s].y] = 0;\n    q.push(C[s]);\n    while (!q.empty()) {\n        u = q.front();\n        q.pop();\n        for (int i = 0; i <= 3; i++) {\n            t.x = u.x + dx[i], t.y = u.y + dy[i];\n            if (t.x >= 1 && t.x <= r && t.y >= 1 && t.y <= c && dis[t.x][t.y] == 0x3f3f3f3f && vis[t.x][t.y]) {\n                dis[t.x][t.y] = dis[u.x][u.y] + 1;\n                q.push(t);\n            }\n        }\n    }\n}\n\nvoid dfs(int S, int i, string &res) {\n    if (!S) return ;\n    dfs(g[S][i].pres, g[S][i].prei, res);\n    res += char('A' + i - 1);\n}\n\nsigned main() {\n    r = read(), c = read(), n = read();\n    for (int i = 1; i <= r; i++)\n        for (int j = 1; j <= c; j++) {\n            char c;\n            cin >> c;\n            if (c == '.') vis[i][j] = 1;\n            else if (c != '*') C[c - 'A' + 1] = node{c, i, j}, vis[i][j] = 1; \n        }\n    for (int i = 1; i <= n; i++) {\n        bfs(i);\n        for (int j = 1; j <= n; j++) \n            Dis[i][j] = dis[C[j].x][C[j].y];\n    }\n    memset(f, 0x3f, sizeof f);\n    f[1][1] = 0;\n    for (int S = 0; S < (1 << n); S++) {\n        for (int i = 1; i <= n; i++) {\n            if (!(S & (1 << i - 1))) continue;\n            for (int j = 1; j <= n; j++) {\n                if (S & (1 << j - 1)) continue;\n                int T = (S | (1 << j - 1));\n                if (f[T][j] > f[S][i] + Dis[i][j]) {\n                    f[T][j] = f[S][i] + Dis[i][j];\n                    g[T][j].prei = i, g[T][j].pres = S;\n                }\n                else if (f[T][j] == f[S][i] + Dis[i][j]) {\n                    string res1, res2;\n                    dfs(T, j, res1);\n                    int x = g[T][j].prei, y = g[T][j].pres;\n                    g[T][j].prei = i, g[T][j].pres = S;\n                    dfs(T, j, res2);\n                    if (res1 < res2) g[T][j].prei = x, g[T][j].pres = y;\n                }\n            }\n        }\n    }\n    int Ans1 = 1000000000, Ans2;\n    string Anss;\n    for (int i = 1; i <= n; i++) \n        if (f[(1 << n) - 1][i] < Ans1) Ans1 = f[(1 << n) - 1][i], Ans2 = i;\n        else if (f[(1 << n) - 1][i] == Ans1) {\n            string res1, res2;\n            dfs((1 << n) - 1, Ans2, res1);\n            dfs((1 << n) - 1, i, res2);\n            if (res2 < res1) Ans2 = i;\n        }\n    print(Ans1), putchar('\\n');\n    dfs((1 << n) - 1, Ans2, Anss);\n    cout << Anss;\n    return 0;\n}\n```",
        "postTime": 1636018895,
        "uid": 371178,
        "name": "Fan_Tuan",
        "ccfLevel": 4,
        "title": "P4772 \u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1 \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9053\u9898 $N$ \u7684\u8303\u56f4\u6bd4\u8f83\u5c0f\uff0c \u5bb9\u6613\u60f3\u5230\u72b6\u538b\u3002 \u72b6\u6001\u5b9a\u4e49\u5982\u4e0b\uff1a\n\n$f(S,i)$ \u8868\u793a\u8d70\u8fc7 $S$ \u96c6\u5408\u4e2d\u7684\u4ed3\u5e93\uff0c \u73b0\u5728\u6b63\u5728 $i$ \u4ed3\u5e93\u7684\u6700\u77ed\u8ddd\u79bb\n\n\u8bbe $i,j$ \u4ed3\u5e93\u7684\u8ddd\u79bb\u4e3a $dis_{i,j}$, \u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7 $bfs$ \u5728 $\\Theta(NRC)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u6765\u3002\n\n\u5bb9\u6613\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$\\large f(S,i)=\\min_{j\\in S\\wedge j\\neq i}\\{f(S-\\{i\\},j)+dis_{j,i}\\}$\n\n\u7531\u4e8e\u672c\u9898\u8981\u8f93\u51fa\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u65b9\u6848\uff0c \u6211\u4eec\u4ee4 $g(S,i)$ \u8868\u793a $f(S,i)$ \u8fd9\u4e2a\u72b6\u6001\u65f6\u7684\u6700\u5c0f\u5b57\u5178\u5e8f\u65b9\u6848\uff0c \u8f6c\u79fb\u987a\u4fbf\u66f4\u65b0\u5373\u53ef\u3002\n\n\u8fb9\u754c\u662f $f(\\{1\\},0)=0, g({1},0)=A$\n\n## Code:\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=505;\nstruct point{\n\tint x,y,step;\n\tpoint(int _=0,int __=0,int ___=0){\n\t\tx=_,y=__,step=___;\n\t}\n};\nint dis[19][19];\nqueue <point> q;\nint n,m,r,vis[N][N];\nchar s[N][N];\nint px[5]={1,-1,0,0},py[5]={0,0,1,-1};\nbool isab(char s){\n\treturn 'A'<=s&&s<='Z';\n}\nvoid bfs(int x,int y,int a){\n\tqueue <point> k;swap(k,q);memset(vis,0,sizeof vis);\n\tq.push(point(x,y,0));\n\twhile(!q.empty()){\n\t\tpoint c=q.front();q.pop();\n\t\tint nx=c.x,ny=c.y;\n\t\tif(vis[nx][ny]) continue;\n\t\tvis[nx][ny]=1;\n\t\tif(isab(s[nx][ny])){\n\t\t\tdis[a][s[nx][ny]-'A']=c.step;\n\t\t}\n\t\tfor(int i=0; i<4; i++){\n\t\t\tint ux=nx+px[i],uy=ny+py[i];\n\t\t\tif(ux<0||uy<0||ux>=n||uy>=m||s[nx][ny]=='*') continue;\n\t\t\tq.push(point(ux,uy,c.step+1));\n\t\t}\n\t}\n}\nint f[(1<<16)+1][17];\nstring ans[(1<<16)+1][17];\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&m,&r);\n\tfor(int i=0; i<n; i++) scanf(\"%s\",s[i]);\n\tfor(int i=0; i<n; i++){\n\t\tfor(int j=0; j<m; j++){\n\t\t\tif(isab(s[i][j])){\n\t\t\t\tbfs(i,j,s[i][j]-'A');\n\t\t\t}\n\t\t}\n\t}\n\tmemset(f,0x3f,sizeof f);\n\tf[1][0]=0;ans[1][0]+='A';\n\tfor(int s=1; s<(1<<r); s++){\n\t\tfor(int i=0; i<r; i++){\n\t\t\tif((1<<i)&s){\n\t\t\t\tfor(int j=0; j<r; j++){\n\t\t\t\t\tif(j!=i&&((1<<j)&s)){\n\t\t\t\t\t\tif(f[s][i]>f[s&(~(1<<i))][j]+dis[j][i]){\n\t\t\t\t\t\t\tf[s][i]=f[s&(~(1<<i))][j]+dis[j][i];\n\t\t\t\t\t\t\tans[s][i]=ans[s&(~(1<<i))][j]+(char)(i+'A');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(f[s][i]==f[s&(~(1<<i))][j]+dis[j][i]&&ans[s][i]>(ans[s&(~(1<<i))][j]+(char)(i+'A'))){\n\t\t\t\t\t\t\tans[s][i]=ans[s&(~(1<<i))][j]+(char)(i+'A');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint minnum=0,min=0x3f3f3f3f;\n\tfor(int i=0; i<r; i++){\n\t\tif(f[(1<<r)-1][i]<min){\n\t\t\tmin=f[(1<<r)-1][i],minnum=i;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",min);\n\tcout<<ans[(1<<r)-1][minnum];\n\t\n\treturn 0;\n}\n",
        "postTime": 1632201527,
        "uid": 225370,
        "name": "loverintime",
        "ccfLevel": 8,
        "title": "P4772"
    },
    {
        "content": "## \u505a\u6cd5\n\u72b6\u538b DP+BFS\u3002\n\n\u9996\u5148\u7531\u4e8e\u5404\u4e2a\u4ed3\u5e93\u4e4b\u95f4\u7684\u8ddd\u79bb\u662f\u4e0d\u4f1a\u6539\u53d8\u7684\uff0c\u6240\u4ee5\u9700\u8981\u5148\u7528 BFS \u521d\u59cb\u5316\u4e00\u4e0b\u5404\u4e2a\u4ed3\u5e93\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\n\n\u56e0\u4e3a $n\\le16$\uff0c\u6240\u4ee5\u8003\u8651\u72b6\u538b\u3002\n\n\u53ef\u4ee5\u7528\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\u6765\u8868\u793a\u5404\u4e2a\u4ed3\u5e93\u6709\u6ca1\u6709\u53bb\u8fc7\uff0c\u4f8b\u5982 `1010001` \u5c31\u8868\u793a\u7b2c `1`\u3001`3` \u548c `7` \u53f7\u4ed3\u5e93\u53bb\u8fc7\u3002\n\n\u56e0\u4e3a\u5c31\u7b97\u72b6\u6001\u4e00\u6837\uff0c\u6700\u7ec8\u505c\u7559\u7684\u4ed3\u5e93\u4e0d\u540c\u6240\u9700\u8981\u8d70\u7684\u8ddd\u79bb\u4e5f\u4e0d\u540c\uff0c\u6240\u4ee5\u7528 $dp_i$ \u8868\u793a\u72b6\u6001\u4e3a $i$ \u6240\u9700\u8981\u8d70\u7684\u6700\u77ed\u8ddd\u79bb\u663e\u7136\u662f\u4e0d\u884c\u7684\u3002\u90a3\u4e48\u5c31\u9700\u8981\u589e\u52a0\u4e00\u7ef4\uff0c\u7528 $dp_{i,j}$ \u6765\u8868\u793a\u72b6\u6001\u4e3a $i$\uff0c\u73b0\u5728\u4f4d\u4e8e $j$ \u53f7\u4ed3\u5e93\u6240\u9700\u8981\u8d70\u7684\u6700\u77ed\u8ddd\u79bb\u3002\u90a3\u4e48\u5f88\u663e\u7136\u53ef\u4ee5\u501f\u9274\u4e00\u4e0b `Floyd` \u7b97\u6cd5\u7684\u601d\u8def\u6765\u66f4\u65b0 `dp` \u6570\u7ec4\uff1a\u679a\u4e3e\u4e00\u4e2a\u4e2d\u95f4\u70b9 $k$\u6765\u66f4\u65b0 $dp_{i,j}$\u3002\n\n\u6700\u540e\u5c31\u5269\u4e0b\u8f93\u51fa\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u8def\u5f84\u8fd9\u4e2a\u68d8\u624b\u7684\u4efb\u52a1\u4e86\u3002\u53ef\u4ee5\u7528\u4e00\u4e2a `string` \u7c7b\u578b\u7684\u6570\u7ec4 `path` \u6765\u5b58\u8def\u5f84\u3002$path_{i,j}$ \u8868\u793a\u72b6\u6001\u4e3a $i$\uff0c\u73b0\u5728\u4f4d\u4e8e $j$ \u53f7\u4ed3\u5e93\u7684\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u6700\u77ed\u8def\u5f84\u3002\u90a3\u4e48\u5728\u5bf9 `dp` \u6570\u7ec4\u8fdb\u884c\u66f4\u65b0\u7684\u65f6\u5019\u987a\u4fbf\u66f4\u65b0\u4e00\u4e0b `path` \u6570\u7ec4\u5c31\u884c\u4e86\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u6700\u77ed\u8def\u5f84\u957f\u5ea6\u76f8\u540c\u65f6\uff0c\u9700\u8981\u53d6\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u8def\u5f84\u3002\n\n## AC \u4ee3\u7801\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <queue>\n#include <cstring>\n\nusing namespace std;\n\nstruct node\n{\n\tint x,y,step;\n};\n\nint r,c,n,dis[20][20],xs[20],ys[20],dx[4]={0,0,1,-1},dy[4]={1,-1,0,0},dp[1<<16][20];\nbool mp[505][505],vis[505][505];\nstring path[1<<16][20];\n\nvoid bfs(int s) // bfs \u521d\u59cb\u5316 s \u53f7\u4ed3\u5e93\u5230\u5176\u5b83\u4ed3\u5e93\u7684\u6700\u77ed\u8ddd\u79bb \n{\n\tint sx=xs[s],sy=ys[s];\n\tmemset(vis,0,sizeof(vis));\n\tqueue<node> q;\n\tq.push((node){\n\t\tsx,sy,0\n\t});\n\tvis[sx][sy]=true;\n\twhile(!q.empty())\n\t{\n\t\tnode now=q.front();\n\t\tq.pop();\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(now.x==xs[i]&&now.y==ys[i])\n\t\t\t{\n\t\t\t\tdis[s][i]=now.step;\n\t\t\t\tdis[i][s]=now.step;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor(int i=0;i<4;i++)\n\t\t{\n\t\t\tint nx=now.x+dx[i],ny=now.y+dy[i];\n\t\t\tif(nx<1||nx>r||ny<1||ny>c||mp[nx][ny]||vis[nx][ny])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvis[nx][ny]=true;\n\t\t\tq.push((node){\n\t\t\t\tnx,ny,now.step+1\n\t\t\t});\n\t\t}\n\t}\n}\n\nint main()\n{\n\tscanf(\"%d%d%d\",&r,&c,&n);\n\tfor(int i=1;i<=r;i++)\n\t{\n\t\tfor(int j=1;j<=c;j++)\n\t\t{\n\t\t\tchar ch;\n\t\t\tscanf(\" %c\",&ch);\n\t\t\tif(ch=='*')\n\t\t\t{\n\t\t\t\tmp[i][j]=true;\n\t\t\t}\n\t\t\tif(ch>='A'&&ch<='Z')\n\t\t\t{\n\t\t\t\tint num=ch-'A'+1; \n\t\t\t\txs[num]=i;\n\t\t\t\tys[num]=j;\n\t\t\t}\n\t\t}\n\t}\n\tmemset(dis,-1,sizeof(dis));\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tbfs(i);\n\t}\n\tmemset(dp,127,sizeof(dp));\n\tdp[1][1]=0;\n\tpath[1][1]=\"A\"; // \u521a\u5f00\u59cb\u53ea\u6709 A \u5728\u8def\u5f84\u91cc \n\tfor(int i=2;i<=(1<<n)-1;i++)\n\t{\n\t\tif(!(i&1))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tif(!(i&(1<<j-1)))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor(int k=1;k<=n;k++)\n\t\t\t{\n\t\t\t\tif(k==j||dis[k][j]==-1||!(i&(1<<k-1)))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tint cost=dp[i-(1<<j-1)][k]+dis[k][j];\n\t\t\t\tstring npath=path[i-(1<<j-1)][k]+(char)(j+'A'-1);\n\t\t\t\tif(\n\t\t\t\tcost<dp[i][j] // \u5982\u679c\u8def\u5f84\u66f4\u77ed \n\t\t\t\t||(cost==dp[i][j]&&path[i][j]>npath) // \u5982\u679c\u8def\u5f84\u4e00\u6837\u957f\u5e76\u4e14\u5b57\u5178\u5e8f\u66f4\u5c0f \n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tdp[i][j]=cost;\n\t\t\t\t\tpath[i][j]=npath;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint minn=0,last=(1<<n)-1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(\n\t\tdp[last][i]<dp[last][minn]\n\t\t||(dp[last][i]==dp[last][minn]&&path[last][i]<path[last][minn])\n\t\t)\n\t\t{\n\t\t\tminn=i; // \u627e\u4e00\u6761\u6700\u77ed\u4e14\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u8def\u5f84 \n\t\t}\n\t}\n\tprintf(\"%d\\n%s\\n\",dp[last][minn],path[last][minn].c_str());\n\treturn 0;\n}\n```\n",
        "postTime": 1621334343,
        "uid": 251130,
        "name": "lovely_ckj",
        "ccfLevel": 0,
        "title": "P4772 \u7070\u5316\u80a5\uff0c\u4f1a\u6325\u53d1 \u9898\u89e3"
    }
]