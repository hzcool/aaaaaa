[
    {
        "content": "## \u9898\u76ee\u5206\u6790\n\n\u770b\u6570\u636e\u8303\u56f4\u4e0d\u5927\uff0c\u5c24\u5176\u662f $s_i$ \u5f88\u5c0f\uff0c\u6240\u4ee5\u5148\u66b4\u529b\u5bb9\u65a5\u51fa\u6bcf\u79cd\u8d1d\u58f3\u7ed9\u8d21\u732e\u7684\u81f3\u591a $2^{s_i}$ \u4e2a\u77e9\u5f62\u533a\u57df\uff0c\u7136\u540e\u5dee\u5206\u4e0b\u6765\u518d\u4e8c\u7ef4\u524d\u7f00\u548c\u5373\u53ef $O(ms\\times2^s+n^2)$ \u9884\u5904\u7406\u51fa\u4ee5\u6bcf\u4e2a\u70b9\u4e3a\u6240\u6316\u77e9\u5f62\u5de6\u4e0b\u89d2\u65f6\u7684\u7b54\u6848\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u4fee\u6539\uff0c\u6ce8\u610f\u5230\u6bcf\u52a0\u5165\u4e00\u4e2a\u9e1f\u86cb\u90fd\u4f1a\u4f7f\u4e00\u4e9b\u683c\u5b50\u7531\u5408\u6cd5\u53d8\u6210\u4e0d\u5408\u6cd5\uff0c\u800c\u6bcf\u4e2a\u683c\u5b50\u81f3\u591a\u4f1a\u8fd9\u6837\u53d8\u4e00\u6b21\uff0c\u6240\u4ee5\u8003\u8651\u7528\u5e76\u67e5\u96c6\u5bf9\u6bcf\u884c\u7ef4\u62a4\u5f53\u524d\u8fd8\u5408\u6cd5\u7684\u683c\u5b50\uff0c\u6bcf\u6b21\u52a0\u86cb\u66b4\u529b\u5728\u6bcf\u884c\u7684\u5e76\u67e5\u96c6\u4e0a\u8df3\uff0c\u8fd9\u6837\u5373\u53ef $O(nT+n^2)$ \u5730\u627e\u51fa\u6bcf\u6b21\u9700\u8981\u5220\u9664\u7684\u683c\u5b50\u3002\n\n\u6700\u540e\u8003\u8651\u8be2\u95ee\uff0c\u53d1\u73b0\u6bcf\u6b21\u6574\u4f53\u8be2\u95ee $\\geq V_i$ \u7684\u503c\u7684\u6570\u91cf\uff0c\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u52a0\u6570\u5220\u6570\u548c\u533a\u95f4\u548c\u5c31\u884c\u4e86\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(ms\\times 2^s+nT+n^2 \\log m)$\uff0c\u5e38\u6570\u8fd8\u633a\u5c0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n## \u4ee3\u7801\n\n```cpp\n/*\n  author: PEKKA_l  \n */\n#include <iostream>\n#include <cstring>\n#include <algorithm>\n#include <cstdio>\nusing namespace std;\n#define mp make_pair\n#define pb push_back\n#define fi first\n#define se second\n#define int long long\n#define popcount(x) __builtin_popcount(x)\n\nint n,k,m,s,u[7],v[7],t,b,c,flag,a[2505][2505];\n\nstruct tree\n{\n\tint sum;\n}tree[400005];\n\n#define ls(x) (x<<1)\n#define rs(x) ((x<<1)|1)\n#define n(x) tree[x].sum\n#define md(x,y) ((x+y)>>1)\n#define push_up(x) n(x)=n(ls(x))+n(rs(x))\n\nvoid cz(int l,int r,int x,int k,int p)\n{\n\tif(l==r) {n(p)+=k; return;} int mid=md(l,r);\n\tif(mid>=x) cz(l,mid,x,k,ls(p)); else cz(mid+1,r,x,k,rs(p)); push_up(p);\n}\nint ask(int l,int r,int x,int y,int p)\n{\n\tif(x>y) return 0;\n\tif(l>=x&&r<=y) return n(p); int mid=md(l,r),nans=0;\n\tif(mid>=x) nans+=ask(l,mid,x,y,ls(p)); if(mid<y) nans+=ask(mid+1,r,x,y,rs(p)); return nans;\n}\n\nint fa[2505][2505];\nint getfa(int u,int x) {return fa[u][x]==x?x:fa[u][x]=getfa(u,fa[u][x]);}\n\nsigned main()\n{\n\tcin>>n>>k>>m;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tcin>>s; for(int j=1;j<=s;j++) cin>>u[j]>>v[j];\n\t\tfor(int j=1;j<(1<<s);j++)\n\t\t{\n\t\t\tint mnx=1,mny=1,mxx=n-k+1,mxy=n-k+1;\n\t\t\tfor(int p=1;p<=s;p++)\n\t\t\t{\n\t\t\t\tif(j&(1<<(p-1)))\n\t\t\t\t{\n\t\t\t\t\tmnx=max(mnx,u[p]-k+1); mny=max(mny,v[p]-k+1);\n\t\t\t\t\tmxx=min(mxx,u[p]); mxy=min(mxy,v[p]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(mnx>mxx||mny>mxy) continue; int zz=(popcount(j)&1)?1:-1;\n\t\t\ta[mnx][mny]+=zz; a[mnx][mxy+1]-=zz; a[mxx+1][mny]-=zz; a[mxx+1][mxy+1]+=zz;\n\t\t} \n\t}\n\tfor(int i=1;i<=n-k+1;i++) for(int j=1;j<=n-k+1;j++) \n\t{a[i][j]+=a[i-1][j]+a[i][j-1]-a[i-1][j-1]; cz(0,m,a[i][j],1,1);}\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n+1;j++) fa[i][j]=j;\n\tcin>>t; while(t--)\n\t{\n\t\tcin>>flag;\n\t\tif(flag==1)\n\t\t{\n\t\t\tcin>>b>>c; int mnx=1,mny=1,mxx=n-k+1,mxy=n-k+1;\n\t\t\tmnx=max(mnx,b-k+1); mny=max(mny,c-k+1); mxx=min(mxx,b); mxy=min(mxy,c);\n\t\t\tif(mnx>mxx||mny>mxy) continue;\n\t\t\tfor(int i=mnx;i<=mxx;i++)\n\t\t\t{\n\t\t\t\tint kk=getfa(i,mny);\n\t\t\t\twhile(kk<=mxy) {cz(0,m,a[i][kk],-1,1); fa[i][kk]=getfa(i,kk+1); kk=fa[i][kk];}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcin>>b; cout<<(double)ask(0,m,b,m,1)/(double)((n-k+1)*(n-k+1))<<endl;\n\t\t}\n\t}\n}\n```\n",
        "postTime": 1682867096,
        "uid": 529697,
        "name": "PEKKA_l",
        "ccfLevel": 6,
        "title": "P5476 \u9898\u89e3"
    }
]