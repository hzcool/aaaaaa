[
    {
        "content": "$$\\mathsf{Preface}$$\n\n[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6213)\n\n\u672c\u9898\u7075\u611f\u6765\u6e90\uff1a\u66fe\u7ecf\u7684\u67d0\u6b21 CF \u7684\u9519\u89e3\u3002\n\n---\n\n$$\\mathsf{Solution}$$\n\nSubtask $1$\uff1a$k_i=1$\u3002\u6bcf\u4e2a\u623f\u95f4\u53ea\u80fd\u8fdb\u5165 $1$ \u6b21\uff0c\u663e\u7136\u8f93\u51fa $0$\u3002\n\nSubtask $2$\uff1a$k_i\\leq 3$\u3002\u7206\u641c\u5373\u53ef\u3002\n\n**\u9001\u5206\u7ed3\u675f\u3002**\n\nSubtask $3$\uff1a\u4e00\u6761\u94fe\uff0c$n\\leq 10^3$\u3002\u4e71\u641e\uff0c\u6316\u6398\u6027\u8d28\uff0c\u7565\u3002\n\n---\n\nSubtask $4$\uff1a$n\\leq 10^3$\uff0c\u663e\u7136\u7206\u641c\u7684\u65b9\u6cd5\u884c\u4e0d\u901a\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u6811\u5f62 DP\u3002**\u4e0d\u4f1a\u6811\u5f62 DP \u5c31\u522b\u5f80\u4e0b\u770b\u4e86\u3002**\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5c0f A \u7684\u8def\u5f84\u80af\u5b9a\u662f\u4e00\u68f5\u6811\u7684\u5f62\u6001\uff0c\u4e0b\u6587\u6211\u4eec\u7b80\u79f0\u4e3a**\u8def\u5f84\u6811**\u3002\u4e0b\u56fe\u5373\u6837\u4f8b $5$ \u7684\u8def\u5f84\u6811\uff0c\u8def\u5f84\u5728\u6837\u4f8b\u89e3\u91ca\u4e2d\u5df2\u7ed9\u51fa\u3002\n\n\u9664\u4e86**\u51fa\u53d1\u70b9 $3$**\uff0c\u6211\u4eec\u79f0**\u5176\u4f59\u5728\u8def\u5f84\u4e0a\u7684\u8282\u70b9 $9,10,8,12,6$ **\u4e3a**\u8def\u5f84\u8282\u70b9\u3002**\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/u8aibsns.png)\n\n\u6211\u4eec\u5047\u8bbe $l_i$ \u4e3a\u70b9 $i$ \u5728**\u8def\u5f84\u6811**\u4e0a\u7684\u5ea6\u6570\u3002\u8fd9\u6837\u6709\u4e00\u4e2a\u663e\u7136\u7684\u6027\u8d28\uff1a\u51fa\u53d1\u70b9\u6ee1\u8db3 $l_i<k_i$\uff0c\u8def\u5f84\u8282\u70b9\u6ee1\u8db3 $l_i\\leq k_i$\u3002\n\n- \u5982\u679c\u628a\u6240\u6709\u8fb9\u770b\u6210\u6709\u5411\u8fb9\uff0c\u90a3\u4e48\u9664\u4e86\u4e00\u5f00\u59cb\u8fdb\u5165\u623f\u95f4\uff0c\u8d70\u5411\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u4f7f\u8be5\u8282\u70b9\u7684\u5ea6\u6570 $+1$\uff0c\u611f\u6027\u7406\u89e3\u4e00\u4e0b\u5373\u53ef\u3002\n\n1. \u6211\u4eec\u5b9a\u4e49**\u5230\u8fbe\u70b9** $i$ \u4e3a **\u5728\u5ea6\u6570\u9650\u5236\u4e0b**\u80fd\u5230\u8fbe $d$ \u7684\u70b9\uff0c\u5373\u8def\u5f84 $i\\to d$ \u4e0a\u6240\u6709\u70b9 $j$ \u66fc\u5ea6 $k_j\\ge2$\uff08\u9664\u4e86 $k_d$ \u53ef\u4ee5\u4e3a $1$\uff09\u3002\u4f8b\u5982 $10$ \u5c31\u662f\u4e00\u4e2a\u5230\u8fbe\u70b9\uff0c\u800c $4$ \u4e0d\u662f\uff08$k_8=1<2$\uff09\u3002\u53ef\u4ee5\u901a\u8fc7\u4e00\u904d DFS $O(n)$ \u6c42\u51fa\u4e00\u4e2a\u70b9\u662f\u4e0d\u662f\u5230\u8fbe\u70b9\u3002\u5f53\u7136\uff0c\u5728 $n\\leq 10^3$ \u7684\u9650\u5236\u4e0b\uff0c\u4f60\u4e5f\u53ef\u4ee5 $O(n^2)$ \u6c42\u3002\n    \n2. \u6211\u4eec\u5b9a\u4e49**\u5230\u8fbe\u8fb9** $u\\to v$ \u4e3a **\u9664\u53bb\u5ea6\u6570\u9650\u5236**\uff0c\u4ece $v$ \u4e0d\u7ecf\u8fc7 $v\\to u$ \u80fd\u5230\u8fbe $d$ \u7684\u8fb9\u3002\u4f8b\u5982 $11\\to 12$ \u5c31\u662f\u4e00\u4e2a\u5230\u8fbe\u8fb9\uff0c\u800c $12\\to 10$ \u4e0d\u662f\u3002\u53ef\u4ee5\u901a\u8fc7\u4e00\u904d DFS $O(n)$ \u7ed9\u6240\u6709\u5230\u8fbe\u8fb9\u6253\u4e0a\u6807\u8bb0\u3002\u5f53\u7136\uff0c\u5728 $n\\leq 10^3$ \u7684\u9650\u5236\u4e0b\uff0c\u4f60\u4e5f\u53ef\u4ee5 $O(n^2)$ \u6c42\u3002\n\n3. \u8fd9\u6837\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u5f00\u59cb\u6811\u5f62 DP \u4e86\u3002\u56e0\u4e3a\u9898\u76ee\u6ca1\u6709\u6307\u5b9a\u6839\u7684\u4f4d\u7f6e\uff08\u4efb\u9009\u521d\u59cb\u623f\u95f4\uff09\uff0c\u6240\u4ee5\u8981\u628a\u6bcf\u4e2a**\u5230\u8fbe\u70b9**\u90fd\u5f53\u6210\u6839\u8bd5\u4e00\u904d\uff0c\u6c42\u51fa\u6700\u5927\u503c\u3002\n\n   \u6211\u4eec\u8bbe $f_i$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u9009\u51fa\u7684\u8def\u5f84\u6811\u7684\u6700\u5927\u503c\u3002\u6211\u4eec\u628a\u8fb9\u6309\u7167\uff1a\u5230\u8fbe\u8fb9\u4f18\u5148\uff0c\u90fd\u4e0d\u662f\u5230\u8fbe\u8fb9\u6309\u7167 $f_x+v(i,x)$ \u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002\u9009\u51fa\u524d $k_i-1$ \u4e2a\u513f\u5b50\uff0c$f_i\\gets f_i+f_x+v(i,x)$\u3002\n     \n   - \u5982\u679c $i$ \u4e3a\u6839\uff0c\u90a3\u4e48\u672c\u6765\u5c31\u5e94\u8be5\u9009 $k_i-1$ \u4e2a\u513f\u5b50\u3002\n   \n   - \u5982\u679c $i$ \u4e0d\u4e3a\u6839\uff0c\u90a3\u4e48\u56e0\u4e3a\u5176\u7236\u8282\u70b9\u9009\u62e9 $i$ \u7684\u65f6\u5019\u4ecd\u8981\u82b1\u53bb $1$ \u5ea6\u6570\uff0c\u6240\u4ee5\u4e5f\u5e94\u9009 $k_i-1$ \u4e2a\u513f\u5b50\u3002\n\n\u5b9a\u4e49\uff1a\n\n```cpp\nconst int N=1e5+5;//\u5176\u5b9e\u5e94\u8be5\u662f1e3+5\nstruct edge{int to,val,pa;};\nvector <edge> e[N];\nint n,d,k[N],a[N];\n```\n\n\u6c42\u5230\u8fbe\u8fb9\u7684\u4ee3\u7801\uff0c$O(n)$\uff1a\n\n```cpp\nvoid path(int id,int f){\n\tfor(int i=0;i<e[id].size();i++){\n\t\tedge &p=e[id][i];\n\t\tif(p.to!=f)p.pa=0,path(p.to,id);\n\t}\n}\n......\npath(d,0);\n```\n\n\u6c42\u5230\u8fbe\u70b9\u7684\u4ee3\u7801\uff0c$O(n)$\uff1a\n\n```cpp\nvoid avail(int id,int f){\n\ta[id]=1;\n\tfor(int i=0;i<e[id].size();i++){\n\t\tint to=e[id][i].to;\n\t\tif(to!=f&&(id==d||k[id]>=2))avail(to,id);\n\t}\n}\n......\navail(d,0);\n```\n\n\u6392\u5e8f\u89c4\u5219\uff1a\n\n```cpp\nint dp[N];\nbool cmp(edge x,edge y){\n\tif(x.pa)return 1; if(y.pa)return 0;\n\treturn dp[x.to]+x.val>dp[y.to]+y.val;\n}\n```\n\u90e8\u5206 DP \u4ee3\u7801\uff0c$O(n\\log n)$\uff1a\n\n```cpp\nvoid dfs1(int id,int f){\n\tfor(int i=0;i<e[id].size();i++){\n\t\tint to=e[id][i].to;\n\t\tif(to!=f)dfs1(to,id);\n\t}\n\tsort(e[id].begin(),e[id].end(),cmp);\n\tint deg=k[id]-1;\n\tfor(int i=0;i<e[id].size();i++){\n\t\tif(!deg)break;\n\t\tedge p=e[id][i];\n\t\tint to=p.to; int v=dp[to]+p.val;\n\t\tif(to==f)continue;\n\t\tdeg--;\n\t\tdp[id]+=v;\n\t}\n}\n```\n   \n\u6bcf\u6b21 DP \u7ed3\u675f\u540e\u66f4\u65b0\u7b54\u6848\uff0c\u4e00\u6b21 DP \u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2\\log n)$\u3002\n\n---\n\nSubtask $5$\uff1a\u4e00\u6761\u94fe\uff0c$n\\leq 10^5$\u3002\u6316\u6398\u6027\u8d28\uff0c\u7565\u3002\n\nSubtask $6$\uff1a\u4e00\u6761\u83ca\u82b1\uff0c$n\\leq 10^5$\u3002\u6316\u6398\u6027\u8d28\uff0c\u7565\u3002\n\n---\n\nSubtask $7$\uff1a$n\\leq 10^5$\u3002\u663e\u7136\uff0c\u6316\u6398\u6027\u8d28\u4e0d\u518d\u7ba1\u7528\u4e86\u3002~~\u6240\u4ee5\u7565\u4e5f\u4e0d\u7ba1\u7528\u4e86\u3002~~ \u7701\u7565\u5982\u4f55\u6c42\u51fa\u5230\u8fbe\u8fb9\u53ca\u5230\u8fbe\u70b9\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u4e8c\u6b21\u626b\u63cf\u4e0e\u6362\u6839\u6cd5\uff0c\u7b80\u79f0\u6362\u6839 DP\u3002**\u4e0d\u4f1a\u6362\u6839 DP \u5c31\u522b\u5f80\u4e0b\u770b\u4e86\u3002**\n\n\u9898\u76ee\u6ca1\u6709\u7ed9\u51fa\u6839\u7684\u4f4d\u7f6e\uff0c\u663e\u7136\u662f\u6362\u6839 DP \u7684\u4e00\u5927\u7279\u5f81\u3002~~\u5982\u679c\u4f1a\u6362\u6839 DP \u8fd8\u60f3\u4e0d\u5230\u7684\u8bdd\uff0cAFO \u7f62\uff0c\u5b69\u5b50\u3002~~\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u5047\u5b9a $1$ \u4e3a\u6811\u6839\uff08\u5176\u5b9e $[1,n]$ \u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u6574\u6570\u90fd\u53ef\u4ee5\uff09\u3002\n\n1. \u7b2c\u4e00\u904d DP\uff1a\n\n   \u5b9a\u4e49 $nxt_i$ \u4e3a \u6309\u7167\u524d\u6587\u7ed9\u51fa\u7684\u6392\u5e8f\u89c4\u5219\u6392\u5e8f\uff0c$i$ \u7684\u7b2c $k_i$ \u4e2a\u513f\u5b50\u7684\u6743\u503c\uff0c\u6743\u503c\u5373 $f_x+v(x,i)$\uff0c\u5982\u679c\u6ca1\u6709\u5219\u4e3a $0$\u3002\u5728 DP \u65f6\u540c $f_i$ \u4e00\u8d77\u6c42\u51fa\u3002\n   \n2. \u7b2c\u4e8c\u904d DP\uff1a\n\n   \u5b9a\u4e49 $g_i$ \u4e3a\u4ee5 $i$ \u4e3a\u6811\u6839\u7684\u7b54\u6848\uff0c\u663e\u7136 $g_1=f_1$\u3002\u5b9a\u4e49 $S_i$ \u4e3a\u8ba1\u7b97 $g_i$ \u65f6\u9009\u62e9\u7684\u8282\u70b9\u7f16\u53f7\uff0c\u663e\u7136 $|S_i|<k_i$\uff0c\u4e14\u5728\u6c42 $f_1$ \u65f6\u53ef\u4ee5\u6c42\u51fa $S_1$\u3002\u73b0\u5728\u6211\u4eec\u8003\u8651\u5982\u4f55\u8f6c\u79fb\u51fa\u522b\u7684 $g_i$\u3002\n   \n   \u60c5\u51b5 $1$\uff1a$i\\in S_{y}$\uff0c\u5176\u4e2d $y$ \u4e3a $i$ \u7684\u7236\u4eb2\u3002\u6b64\u65f6 $f_y=g_y+nxt_y-f_i-v(y,i)$\u3002\u60f3\u60f3\u770b\uff0c\u8ba1\u7b97 $g_y$ \u5df2\u7ecf\u9009\u51fa\u4e86 $|S_y|$ \u4e2a\u513f\u5b50\uff0c\u73b0\u5728\u5176\u4e2d\u7684\u4e00\u4e2a\u513f\u5b50\u6210\u4e86 $y$ \u7684\u7236\u4eb2\uff0c\u90a3\u4e48\u5c31\u5e94\u8be5\u53bb\u6389 $i$ \u5bf9 $y$ \u7684\u8d21\u732e\uff0c\u9009\u7b2c $|S_y|+1$ \u4e2a\u513f\u5b50\u3002\n   \n   \u60c5\u51b5 $2$\uff1a$i\\notin S_y$\uff0c\u663e\u7136 $f_y=g_y$\uff0c\u539f\u56e0\u4e0d\u518d\u8d58\u8ff0\uff0c\u8bf7\u8bfb\u8005\u81ea\u884c\u601d\u8003\u3002\n\n   \u7528 set \u7ef4\u62a4 $S$ \u6570\u7ec4\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u7b54\u6848\u5373\u4e3a $\\max_{i\\in V}g_i$\uff0c\u5176\u4e2d $V$ \u4e3a\u5230\u8fbe\u70b9\u96c6\u5408\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read(){\n\tint x=0,sign=0; char s=getchar();\n\twhile(!isdigit(s))sign|=s=='-',s=getchar();\n\twhile(isdigit(s))x=(x<<1)+(x<<3)+(s-'0'),s=getchar();\n\treturn sign?-x:x;\n}\nconst int N=1e5+5;\nstruct edge {int to,val,pa;};\nvector <edge> e[N];\nint n,d,k[N],a[N];\nvoid path(int id,int fa){\n\tfor(int i=0;i<e[id].size();i++){\n\t\tedge &p=e[id][i];\n\t\tif(p.to!=fa)p.pa=0,path(p.to,id);\n\t}\n}\nvoid avail(int id,int fa){\n\ta[id]=1;\n\tfor(int i=0;i<e[id].size();i++){\n\t\tint to=e[id][i].to;\n\t\tif(to!=fa&&(id==d||k[id]>=2))avail(to,id);\n\t}\n}\nint f[N],g[N],nxt[N];\nset <int> S[N];\nbool cmp(edge x,edge y){\n\tif(x.pa)return 1; if(y.pa)return 0;\n\treturn f[x.to]+x.val>f[y.to]+y.val;\n}\nvoid dfs1(int id,int fa){\n\tfor(int i=0;i<e[id].size();i++){\n\t\tint to=e[id][i].to;\n\t\tif(to!=fa)dfs1(to,id);\n\t}\n\tsort(e[id].begin(),e[id].end(),cmp);\n\tint deg=k[id]-1;\n\tfor(int i=0;i<e[id].size();i++){\n\t\tedge p=e[id][i];\n\t\tint to=p.to; int v=f[to]+p.val;\n\t\tif(to==fa)continue;\n\t\tif(--deg==-1){nxt[id]=v; break;}\n\t\tf[id]+=v;\n\t\tif(id==1)S[id].insert(to);\n\t}\n}\nvoid dfs2(int id,int fa,int val){\n\tif(id!=1){\n\t\tif(S[fa].count(id))f[fa]=g[fa]+nxt[fa]-f[id]-val;\n\t\telse f[fa]=g[fa];\n\t\tsort(e[id].begin(),e[id].end(),cmp);\n\t\tint deg=k[id]-1;\n\t\tfor(int i=0;i<e[id].size();i++){\n\t\t\tedge p=e[id][i];\n\t\t\tint to=p.to; int v=f[to]+p.val;\n\t\t\tif(--deg==-1){nxt[id]=v; break;}\n\t\t\tg[id]+=v,S[id].insert(to);\n\t\t}\n\t}\n\tfor(int i=0;i<e[id].size();i++){\n\t\tedge p=e[id][i];\n\t\tif(p.to!=fa)dfs2(p.to,id,p.val);\n\t}\n}\nint main(){\n\tn=read(),d=read();\n\tfor(int i=1;i<n;i++){\n\t\tint u=read(),v=read(),w=read();\n\t\te[u].push_back({v,w,1}),e[v].push_back({u,w,1});\n\t}\n\tfor(int i=1;i<=n;i++)k[i]=read();\n\tpath(d,0),avail(d,0);\n\tdfs1(1,0),g[1]=f[1],dfs2(1,0,0);\n\tint ans=0;\n\tfor(int i=1;i<=n;i++)if(a[i])ans=max(ans,g[i]);\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n\n---\n\n$$\\mathsf{Conclusion}$$\n\n\u56e0\u4e3a\u67d0\u6b21 CodeForces \u4e00\u4e2a\u7b80\u5355\u9898\u60f3\u590d\u6742\u4e86\u800c\u5f97\u5230\u7684 idea\uff0c\u5e94\u8be5\u662f\u4e00\u9053\u96be\u5ea6\u9002\u4e2d\u7684\u6362\u6839 DP\u3002**\u5e0c\u671b\u5927\u5bb6\u80fd\u901a\u8fc7\u672c\u9898\u5bf9\u6362\u6839 DP \u7684\u7406\u89e3\u66f4\u6df1\u4e00\u6b65\u3002**\n\n~~\u6ca1\u6709\u6839\u7684\u6811\u5f62 DP \u4e0d\u662f\u597d\u6362\u6839 DP\u3002~~\n\n- Upd on 2020.3.13\uff1a\u6bd4\u8d5b\u7684\u65f6\u5019\u4e00\u4e9b\u795e\u4ed9\u53ea\u7528\u4e86 $1$ \u6b21 DFS \u7684\u6811\u5f62 DP\u3002\u4ee3\u7801\uff0c\u5e38\u6570\u90fd\u78be\u538b\u6b63\u89e3\uff0c\u4e5f\u6ca1\u6709\u6b63\u89e3\u8fd9\u4e48\u9ebb\u70e6\uff0corz\uff01\n\n\u7801\u5b57\u4e0d\u6613\uff0c\u70b9\u4e2a\u8d5e\u5457 qwq\u3002\u53e6\u5916\uff0c\u53d1\u73b0\u9519\u8bef\u8bb0\u5f97\u79c1\u4fe1\u6211\u54c8\uff0cbye ~",
        "postTime": 1582792773,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "\u300cSWTR-04\u300dE Collecting Coins"
    },
    {
        "content": "> preface.\n\n#### \u505a\u6cd5\u4f7f\u7528\u4e86\u6811\u5f62dp\u4e00\u6b21dfs, \u5bf9 *BeyondHeaven* \u7684\u9898\u89e3\u505a\u4e86\u4e00\u5b9a\u7684\u7b80\u6790\u4e0e\u8865\u5145\n\n----\n\n> \u63d0\u53d6\u9898\u610f.\n\n* \u9009\u62e9\u4e00\u4e2a$d$\u7684**\u8054\u901a\u5b50\u6811**(\u8fde\u901a\u5757), \u5e76\u4e14\u9009\u62e9\u4e00\u4e2a\u70b9\u4f5c\u5165\u53e3. $d$ \u662f\u5c0f c \u6240\u5728\u7684\u7ed3\u70b9.\n* \u5165\u53e3 $r$ \u6ee1\u8db3 $deg_r \\le k_r-1$ ; \u5176\u4ed6\u70b9 $v$ \u6ee1\u8db3 $deg_v \\le k_v$ .\n* \u6c42\u6240\u6709\u8054\u901a\u5b50\u6811\u5185\u7684\u8fb9\u6743\u503c\u548c\u7684\u6700\u5927\u4ef7\u503c.\n\n\u5b98\u65b9\u9898\u89e3\u7684\u505a\u6cd5\u662f\u4ee4 $r$ \u505a\u6839, \u7528\u6362\u6839dp\u89e3\u51b3\u95ee\u9898\n\n\u7136\u800c\u6bd4\u8d5b\u65f6\u53d1\u73b0\u4e86\u4e00\u79cd\u66f4\u901a\u7528\u7684\u505a\u6cd5, \u76f4\u63a5\u5c06\u5165\u53e3 $r$ \u4f5c\u4e3a**\u65b0\u7684\u4e00\u7ef4**\n\n* \u6211\u4eec\u4ee5$d$\u4e3a\u6839, \u72b6\u6001\u8bb0\u505a$f[u][0/1]$\n* \u5176\u4e2d$f[u][0]$\u8868\u793a$u$\u5b50\u6811\u4e2d\u6ca1\u6709\u9009\u62e9$r$\u7684\u6700\u5927\u4ef7\u503c, $f[u][1]$\u5219\u8868\u793a$u$\u5b50\u6811\u4e2d\u5df2\u9009$r$\n\n\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86$d$\u5728\u8054\u901a\u5757\u5185, \u5e76\u4e14$r$\u88ab\u9009\u5230\n\n\u4e8e\u662f, \u9898\u76ee\u53d8\u6210\u4e86\u63d0\u9ad8\u7ec4dp\n\n> \u8f6c\u79fb\u65b9\u7a0b.\n\n$f[u][0] = \\text{\u524d}k[u]-1\\text{\u5927\u7684}\\{f[v][0]+val_{(u,v)}\\}$\n\n$f[u][1] = \\begin{cases} 1.\\text{\u524d}k[u]-2\\text{\u5927\u7684}\\{f[v][0]+val_{(u,v)}\\}\\\\ 2.\\max_{x} \\{ f[x][1]+val_{(u,x)}+\\text{\u9664}x\\text{\u4e4b\u5916\u524d}k[u]-2\\text{\u5927\u7684}\\{f[v][0]+val_{(u,v)}\\}\\} \\end{cases} $\n\n($2.$) \u8f6c\u79fb$2.$\u672c\u8d28\u662f\u679a\u4e3e\u4e86$x$\u4e2d\u51fa\u73b0\u4e86\u5165\u53e3$r$\n\n\u6ce8\u610f\u5f53$k[u]=1$\u65f6, $f[u][1] = -\\inf$, \u56e0\u4e3a\u6ca1\u6709\u53ef\u9009\u7684\u513f\u5b50\n\n\u56e0\u4e3a$d$\u662f\u6839, $k[d]$\u9700\u8981\u5148$+1$\n\n\u6240\u6c42\u5373\u4e3a$f[d][1]$\n\n> else.\n\n\u7531\u4e8e\u6392\u5e8f, \u590d\u6742\u5ea6 $O(n \\log n)$\n\n\u5728 *BeyondHeaven* \u7684\u9898\u89e3\u4e2d, $f[u][1]$\u7684\u8f6c\u79fb\u6ca1\u6709\u8003\u8651$k[u]-1$\u4e4b\u5916\u7684, \u6240\u4ee5\u6709\u4e9b\u7455\u75b5\n\n## code:\n\n```\n// Etavioxy\n#define il inline\n#define ll long long\n#define rep(i,s,t) for(register int i=(s);i<=(t);i++)\n#define rev_rep(i,s,t) for(register int i=(s);i>=(t);i--)\n#define each(i,u) for(int i=head[u];i;i=bow[i].nxt)\n#define pt(x) putchar(x)\nusing namespace std;\nil int ci(){\n\tregister char ch;int f=1;\n\twhile(!isdigit(ch=getchar()))f=ch=='-'?-1:1;\n\tregister int x=ch^'0';\n\twhile(isdigit(ch=getchar()))x=(x*10)+(ch^'0');\n\treturn f*x;\n}\n\nenum{N=100023};\n\nstruct Edge{ int nxt,to,val; } bow[N*2];\nint head[N],tot_e;\nil void add(int x,int y,int z){\n\ttot_e++;\n\tbow[tot_e<<1]=(Edge){head[x],y,z};\n\tbow[tot_e<<1|1]=(Edge){head[y],x,z};\n\thead[y]=(head[x]=tot_e<<1)|1;\n}\n\nint k[N];\nint val[N],f[N][2];\nbool cmp1(int x,int y){\n\treturn f[x][0]+val[x] > f[y][0]+val[y];\n}\nvoid dfs(int u,int fa){\n\tif( k[u]==0 ){\n\t\tf[u][1] = -1e9;\n\t\tf[u][0] = 0;\n\t\treturn ;\n\t}\n\tf[u][1] = f[u][0] = 0;\n\tvector<int>vec;\n\teach(i,u){\n\t\tint v = bow[i].to;\n\t\tif( v==fa ) continue;\n\t\tdfs(v,u);\n\t\tval[v] = bow[i].val;\n\t\tvec.push_back(v);\n\t}\n\tsort(vec.begin(),vec.end(),cmp1);\n\tbool flag=0;\n\tif( k[u]>(int)vec.size() ){ flag = 1; k[u] = vec.size(); }\n\trep(i,0,k[u]-1) f[u][0] += f[vec[i]][0]+val[vec[i]];\n\tif( flag ) return f[u][1] = f[u][0], void();\n\tint kth = vec[k[u]-1];\n\tf[u][1] = f[u][0] - f[kth][0] - val[kth];\n\trep(i,0,(int)vec.size()-1){\n\t\tif( i<=k[u]-1 ) f[u][1] = max(f[u][1],f[vec[i]][1]+f[u][0]-f[vec[i]][0]);\n\t\telse f[u][1] = max(f[u][1],f[vec[i]][1]+val[vec[i]]+f[u][0]-f[kth][0]-val[kth]);\n\t}\n//\tprintf(\"LINE : %d u %d f %d %d\\n\",__LINE__,u,f[u][0],f[u][1]);\n}\n\nint main(){\n\tint n = ci(), d = ci();\n\trep(i,1,n-1){\n\t\tint x = ci(), y = ci();\n\t\tadd(x,y,ci());\n\t}\n\trep(i,1,n) k[i] = ci()-1;\n\tk[d]++;\n\tdfs(d,0);\n\tprintf(\"%d\\n\",f[d][1]);\n\treturn 0;\n}\n```\n\n\u8fd9\u9053\u9898\u8d85\u4f18\u7f8e\u7684\n\n~~\u4f46\u662fEta\u592a\u8822\u4e86\u592a\u8822\u4e86\u592a\u8822\u4e86~~",
        "postTime": 1589166861,
        "uid": 127195,
        "name": "z7z_Eta",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6213 \u3010\u300cSWTR-04\u300dCollecting Coins\u3011"
    },
    {
        "content": "\n\u7ed9\u4e00\u4e2a\u4e00\u6b21Dfs\u7684\u505a\u6cd5\n\n\u6211\u4eec\u8bb0\u4e00\u4e2a\u8fde\u901a\u5757\u7684\u6839\u4e3a\u8fd9\u4e2a\u8fde\u901a\u5757\u4e2d\u6df1\u5ea6\u6700\u5c0f\u7684\u8282\u70b9\u3002\n\n\u9898\u76ee\u76f8\u5f53\u4e8e\uff0c\u6c42\u4e00\u4e2a\u8fb9\u6743\u548c\u6700\u5927\u7684\u5305\u542b$d$\u7684\u8fde\u901a\u5757\uff0c\u4f7f\u5f97\u5bf9\u8fd9\u4e2a\u8fde\u901a\u5757\u4e2d\u7684\u4e00\u4e2a\u7279\u5b9a\u70b9\u7684$k$\u503c$-1$\u540e\uff0c\u6ee1\u8db3\u6bcf\u4e2a\u70b9$x$\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7$k[x]$\u3002($-1$\u76f8\u5f53\u4e8e\u628a\u8fd9\u4e2a\u8282\u70b9\u4f5c\u4e3a\u8d77\u59cb\u70b9)\n\n\u9996\u5148\u628a$d$\u4f5c\u4e3a\u6811\u6839\uff0c\u7136\u540e\u4ee4$k[d]\\leftarrow k[d]+1$\u3002(\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u8ba1\u7b97)\n\n\u5bf9\u4e00\u4e2a\u8282\u70b9$u$\uff0c\u8bbe$f[u]$\u8868\u793a\u6ee1\u8db3\u6bcf\u4e2a\u70b9$v$\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7$k[v]$\u4e14$u$\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7$k[u]-1$\u7684\u5305\u542b$u$\u7684\u8fde\u901a\u5757\u7684\u6700\u5927\u8fb9\u6743\u548c\uff0c$g[u]$\u8868\u793a\u6ee1\u8db3\u5bf9\u8fd9\u4e2a\u8fde\u901a\u5757\u4e2d\u7684\u4e00\u4e2a\u7279\u5b9a\u70b9\u7684$k$\u503c$-1$\u540e\u6ee1\u8db3\u6bcf\u4e2a\u70b9$v$\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7$k[v]$\u4e14$u$\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7$k[u]-1$\u7684\u5305\u542b$u$\u7684\u8fde\u901a\u5757\u7684\u6700\u5927\u8fb9\u6743\u548c\u3002\n\n\u9012\u63a8\u5f0f\u4e3a\uff1a\n\n$f[u]=\\{$\u524d$k[u]-1$\u5927\u7684$f[v]$\u4e4b\u548c$|v\\in \\operatorname{son}(u)\\}$\n\n$g[u]=\\max(f[u]-\\min\\{f[v]-g[v]|v\\in \\operatorname{son}(u)\\},\\{$\u524d$k[u]-2$\u5927\u7684$f[v]$\u4e4b\u548c$|v\\in \\operatorname{son}(u)\\})$\n\n\u6240\u6c42\u5373\u4e3a$g[d]$\uff0c\u6ce8\u610f\u5f53$k[u]=1$\u65f6$g[u]$\u4e0d\u5b58\u5728\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<algorithm>\n#define MaxN 100123\nstruct Edge{int v,w,next;}edge[MaxN<<1];\nint head[MaxN],num_edge;\ninline void add_edge(int u,int v,int w)\n{\n\tedge[++num_edge].v=v;\n\tedge[num_edge].w=w;\n\tedge[num_edge].next=head[u];\n\thead[u]=num_edge;\n}\nint n,d;\nint k[MaxN];\ninline void Init()\n{\n\tscanf(\"%d%d\",&n,&d);\n\tfor(int i=1,u,v,w;i<n;++i)\n\t{\n\t\tscanf(\"%d%d%d\",&u,&v,&w);\n\t\tadd_edge(u,v,w);\n\t\tadd_edge(v,u,w);\n\t}\n\tfor(int i=1;i<=n;++i)\n\tscanf(\"%d\",k+i);\n\t++k[d];\n}\nint path[MaxN];\nint f[MaxN],g[MaxN];\ninline void Dfs(int u,int fa,int val)\n{\n\tpath[u]=val;\n\tif(k[u]==1){f[u]=0;g[u]=-0x3f3f3f3f;return;}\n\tstd::vector<int>sons;\n\tfor(int i=head[u];i;i=edge[i].next)\n\tif(edge[i].v!=fa)\n\t{\n\t\tDfs(edge[i].v,u,edge[i].w);\n\t\tsons.push_back(edge[i].v);\n\t}\n\tauto cmp=[](int a,int b){return f[a]+path[a]>f[b]+path[b];};\n\tstd::sort(sons.begin(),sons.end(),cmp);\n\tfor(int i=0;i<k[u]-1&&i<sons.size();++i)\n\tf[u]+=f[sons[i]]+path[sons[i]];\n\tif(k[u]-1>sons.size())g[u]=f[u];\n\telse\n\t{\n\t\tint dec=f[sons[k[u]-2]]+path[sons[k[u]-2]];\n\t\tfor(int i=0;i<k[u]-1;++i)\n\t\tdec=std::min(dec,f[sons[i]]-g[sons[i]]);\n\t\tg[u]=f[u]-dec;\n\t}\n}\nint main()\n{\n\tInit();\n\tDfs(d,0,0);\n\tprintf(\"%d\\n\",g[d]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1584257162,
        "uid": 77609,
        "name": "BeyondHeaven",
        "ccfLevel": 9,
        "title": "\u9898\u89e3\u3010P6213\u3011 \u300cSWTR-04\u300dCollecting Coins"
    },
    {
        "content": "\u5c06\u9650\u5236\u5206\u5f00\u8003\u8651\u3002\n\n\u5047\u8bbe\u4e0d\u7ba1\u5230\u8fbe\u6b21\u6570 $k_i$ \u548c\u8981\u6551\u5c0f c \u4e24\u4e2a\u6761\u4ef6\uff0c\u53ea\u7ba1\u6536\u96c6\u91d1\u5e01\uff0c\u90a3\u4e48\u4e0d\u96be\u5f97\u5230\u4e00\u4e2a\u7b80\u5355\u7684dp\uff1a\u8bbe $f_x$ \u8868\u793a $x$ \u5b50\u6811\u5185\u80fd\u6536\u96c6\u5230\u7684\u6700\u591a\u7684\u91d1\u5e01\uff0c\u8f6c\u79fb\u4e3a $f_x=\\sum_{y\\in son}f_y+w$\uff0c$w$ \u662f\u8fb9\u4e0a\u7684\u91d1\u5e01\u6570\u3002\n\n\u52a0\u4e0a\u5230\u8fbe\u6b21\u6570\u8fd9\u4e2a\u9650\u5236\uff0c\u7531\u4e8e\u8fd9\u4e2a\u70b9\u8981\u4e48\u4ece\u7236\u4eb2\u90a3\u8d70\u8fc7\u6765\uff0c\u8981\u4e48\u4f5c\u4e3a\u8d77\u70b9\uff0c\u65e0\u8bba\u5982\u4f55\u5230\u8fbe\u6b21\u6570\u90fd\u8981\u51cf\u4e00\uff0c\u90a3\u4e48\u6bcf\u6b21\u53d6\u524d $a_x-1$ \u5927\u7684\u513f\u5b50\u5373\u53ef\uff0c\u6309 $f_y+w$ \u8fdb\u884c\u6392\u5e8f\u3002\n\n\u7136\u540e\u8fdb\u884c\u7b80\u5355\u7684\u6362\u6839dp\uff0c\u6bcf\u6b21\u5c06\u7236\u4eb2\u90a3\u68f5\u5b50\u6811\u4e5f\u8003\u8651\u8fdb\u8fd9 $a_x-1$ \u4e2a\u91cc\u9762\u5c31\u597d\u4e86\u3002\n\n\u6700\u540e\u52a0\u4e0a\u6551\u5c0f c \u7684\u9650\u5236\uff0c\u8fd9\u4e2a\u9650\u5236\u5176\u5b9e\u5c31\u662f\u8f6c\u79fb\u65f6\u5f3a\u5236\u67d0\u68f5\u5b50\u6811\u4e00\u5b9a\u8981\u9009\u3002\n\n\u8fd9\u5c31\u505a\u5b8c\u4e86\uff0c\u4f46\u770b\u8d77\u6765\u8f6c\u79fb\u65f6\u9700\u8981\u8ba8\u8bba\u5f88\u591a\u4e1c\u897f\u3002\n\n\u4e0d\u59a8\u7b2c\u4e00\u6b21dp\u4ece\u5c0f c \u6240\u5728\u7684\u4f4d\u7f6e\u5f00\u59cb\u505a\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21dp\uff08\u5373\u6362\u6839\u90e8\u5206\uff09\u65f6\uff0c\u5f3a\u5236\u9009\u7684\u90a3\u68f5\u5b50\u6811\u5c31\u662f\u7236\u4eb2\uff0c\u53ea\u9700\u8981\u9009\u51fa\u513f\u5b50\u4e2d\u7684\u524d $a_x-2$ \u5927\u5373\u53ef\uff0c\u8fd9\u6837\u53ef\u4ee5\u7b80\u5355\u5730\u5b9e\u73b0\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include <cstdio>\n#include <vector>\n#include <algorithm>\nusing namespace std;\n#define maxn 200010\n#define pb push_back\n\nint n,rt,a[maxn],ans=0;\nstruct edge{int y,z,next;}e[maxn<<1];\nint first[maxn],len=0;\nvoid buildroad(int x,int y,int z){e[++len]=(edge){y,z,first[x]};first[x]=len;}\nint f[maxn];\nstruct par{int x,val;};\nvector<par> s[maxn];\nbool cmp(par x,par y){return x.val>y.val;}\nvoid dfs1(int x,int fa){\n\tfor(int i=first[x];i;i=e[i].next){\n\t\tint y=e[i].y;if(y==fa)continue;\n\t\tdfs1(y,x);s[x].pb((par){y,f[y]+e[i].z});\n\t}\n\tsort(s[x].begin(),s[x].end(),cmp);\n\tfor(int i=0;i<min((int)s[x].size(),a[x]-1);i++)f[x]+=s[x][i].val;\n}\nbool v[maxn];\nvoid dfs2(int x,int fa,int fa_val){\n\tif(x!=rt&&a[x]==1)return;\n\tf[x]=fa_val;int lim=a[x]-2;if(!fa)lim++;\n\tfor(int i=0;i<min((int)s[x].size(),lim);i++)v[s[x][i].x]=true,f[x]+=s[x][i].val;\n\tans=max(ans,f[x]);\n\tint p=0;if(s[x].size()>lim)p=s[x][lim].val;\n\tfor(int i=first[x];i;i=e[i].next){\n\t\tint y=e[i].y;if(y==fa)continue;\n\t\tif(v[y])dfs2(y,x,f[x]-f[y]-e[i].z+p+e[i].z);\n\t\telse dfs2(y,x,f[x]+e[i].z);\n\t}\n}\n\nint main()\n{\n\tscanf(\"%d %d\",&n,&rt);\n\tfor(int i=1,x,y,z;i<n;i++){\n\t\tscanf(\"%d %d %d\",&x,&y,&z);\n\t\tbuildroad(x,y,z);buildroad(y,x,z);\n\t}\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tdfs1(rt,0);ans=max(ans,f[rt]);\n\tdfs2(rt,0,0);\n\tprintf(\"%d\",ans);\n}\n```",
        "postTime": 1602804134,
        "uid": 35379,
        "name": "Scarlet_Hypoc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6213 \u3010\u300cSWTR-04\u300dCollecting Coins\u3011"
    }
]