[
    {
        "content": "\u53c2\u52a0div1\u540e\u552f\u4e00A\u7684\u9898\u76ee\u3002\u3002\u3002\u3002\u3002\u3002\n\n\u8bbe$a_2=x$\u3002\u5148\u63a8\u5f0f\u5b50\uff0c\u66b4\u529b\u7b97\u51fa\u524d\u51e0\u9879\uff0c\u53d1\u73b0\n\n\n$a_z=iFi[z-3]+Fi[z-2]x$\n\n\n(Fi\u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u4e14Fi[0]=1)\n\n\u6240\u4ee5\n\n$a_k=iFi[k-3]+Fi[k-2]x\\equiv m\\pmod p$\n\n\n\u5373\n\n$Fi[k-2]x\\equiv m-iFi[k-3]\\pmod p$\n\n\n\u8bbe$Q=m-iFi[k-3]$\uff0c\u5219\n\n\n$Fi[k-2]x\\equiv Q\\pmod p$\n\n\n$Fi[k-2]x=Q+py$\n\n\n$Fi[k-2]x-py=Q$\n\n\n\u540c\u4f59\u65b9\u7a0b\uff0c\u7528\u6269\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u89e3\u5f97\u51fax\u7684\u901a\u89e3\u516c\u5f0f\uff0c\u5728\u5229\u7528\u901a\u89e3\u516c\u5f0f\u6765\u8ba1\u7b97x\u5728[l,r]\u5185\u89e3\u4e2a\u6570\u3002\u65f6\u95f4\u590d\u6742\u5ea6\uff0c$O(log_2k)$\u3002\n\n\n\u4ee3\u7801\uff1a\n\n\n```cpp\n    #include<bits/stdc++.h>\n    #include<cctype>\n    #define For(i,a,b) for(i=(a),i##end=(b);i<=i##end;++i)\n    #define Forward(i,a,b) for(i=(a),i##end=(b);i>=i##end;--i)\n    #define Rep(i,a,b) for(register int i=(a),i##end=(b);i<=i##end;++i)\n    #define Repe(i,a,b) for(register int i=(a),i##end=(b);i>=i##end;--i)\n    #define Chkmax(a,b) a=a>(b)?a:(b)\n    using namespace std;\n    template<typename T>inline void read(T &x){\n        T s=0,f=1;char k=getchar();\n        while(!isdigit(k)&&k^'-')k=getchar();\n        if(!isdigit(k)){f=-1;k=getchar();}\n        while(isdigit(k)){s=s*10+(k^48);k=getchar();}\n        x=s*f;\n    }\n    void file(void){\n    #ifndef ONLINE_JUDGE\n        freopen(\"water.in\",\"r\",stdin);\n        freopen(\"water.out\",\"w\",stdout);\n    #endif\n    }\n    long long g,l,r,k,mod,m;\n    void init()\n    {\n        read(g);read(l);read(r);read(k);read(mod);read(m);\n    }\n    long long a[2][2]={0ll,1ll,1ll,1ll},s[2][2],base[2][2];\n    inline void tim(long long a[][2],long long b[][2])\n    {\n        long long c[2][2]={0ll};\n        Rep(i,0,1)Rep(j,0,1)Rep(k,0,1)(c[i][j]+=a[i][k]*b[k][j])%=mod;\n        Rep(i,0,1)Rep(j,0,1)a[i][j]=c[i][j];\n    }\n    long long ext_gcd(long long a,long long b,long long &x,long long &y)\n    {\n        if(!b){x=1ll;y=0ll;return a;}\n        long long ans=ext_gcd(b,a%b,x,y);\n        swap(x,y);\n        y=y-a/b*x;\n        return ans;\n    }\n    void solve()\n    {\n        --k;\n        memcpy(base,a,sizeof a);\n        s[0][0]=s[1][1]=1;s[0][1]=s[1][0]=0;\n        for(;k;k>>=1,tim(base,base))if(k&1)tim(s,base);\n        g%=mod;\n        m-=s[0][0]%mod*g%mod;m%=mod;m+=mod;m%=mod;\n        long long y,z;\n        long long gcd=ext_gcd(s[1][0],mod,y,z);\n        if(m%gcd!=0)\n        {\n            printf(\"0\\n\");\n            return;\n        }\n        y*=m/gcd;\n        if(y>=0)(y%=(mod/gcd))-=mod/gcd;\n        printf(\"%lld\\n\",(r-y)/(mod/gcd)-(l-1-y)/(mod/gcd));\n    }\n    int main(void){\n        file();\n        int _;\n        read(_);\n        while(_--)\n        init(),\n        solve();\n        return 0;\n}\n```",
        "postTime": 1514986657,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4031 \u3010\u300cCodePlus 2017 12 \u6708\u8d5b\u300d\u53ef\u505a\u98982\u3011"
    }
]