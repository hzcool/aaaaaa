[
    {
        "content": "## Solution\n\u5f53\u6211\u4eec\u56fa\u5b9a\u4e00\u4e2a\u8d77\u70b9\u540e , \u628a\u8d77\u70b9\u4f5c\u4e3a\u6574\u4e2a\u6811\u7684\u6839 , \u90a3\u4e48\u8fd9\u65f6\u6bcf\u4e2a\u8282\u70b9\u9009\u4e0d\u9009\u7684\u4ef7\u503c\u5c31\u662f\u5b83\u6240\u6709\u513f\u5b50\u7684\u94c1\u7403\u6570\u91cf\u52a0\u548c .  \n\u90a3\u4e48\u8bbe $f_{i,j}$ \u8868\u793a\u5728 $i$ \u5b50\u6811\u91cc\u9009\u62e9\u4e86 $j$ \u4e2a\u70b9\u6240\u80fd\u5f97\u5230\u7684\u6700\u5927\u8d21\u732e , \u8f6c\u79fb\u65f6\u8003\u8651\u8fd9\u4e2a\u8282\u70b9\u662f\u5426\u9009\u62e9 .  \n\u8bbe $son_i$ \u8868\u793a $i$ \u8282\u70b9\u7684\u513f\u5b50 , $v_i$ \u8868\u793a $i$ \u8282\u70b9\u7684\u6240\u6709\u513f\u5b50\u94c1\u7403\u6570\u91cf\u548c .\n$f_{i,j}=\\max(f_{son_i,j},f_{son_i,j-1}+v_i)$\n\u679a\u4e3e\u8d77\u70b9\u4f5c\u4e3a\u6839 , \u590d\u6742\u5ea6 $O(n^2v)$.  \n\u4e0d\u80fd\u901a\u8fc7\u672c\u9898 ,  \n\u8003\u8651\u6cbf\u7528\u4e0a\u9762\u5bf9\u4ef7\u503c\u7684\u5b9a\u4e49 , \u8bbe\u8ba1\u65b0\u7684 dp,  \n\u8bbe $f_{i,j,0/1},g_{i,j,0/1}$ \u5206\u522b\u8868\u793a\u4ece $i$($i$\u7684\u5b50\u6811)\u8d70\u5230 $i$ \u7684\u5b50\u6811($i$)\u4e2d , $i$ \u88ab/\u4e0d\u88ab)\u9009 , \u9009\u4e86 $j$ \u4e2a\u7684\u6700\u5927\u8d21\u732e .  \n\u8bbe\u5f53\u524d\u8282\u70b9\u4e3a $u$ , \u513f\u5b50\u4e3a $son$, \u7236\u4eb2\u4e3a $fa$ , \u5f53\u524d\u8282\u70b9\u513f\u5b50\u6743\u503c\u548c\u4e3a $v$ , \u70b9 $i$ \u7684\u94c1\u7403\u6570\u91cf\u4e3a $p_i$.  \n\u90a3\u4e48\u6709\u8f6c\u79fb  \n$f_{u,j,0}=\\max(f_{son,j,0},f_{son,j,1})$  \n$f_{u,j,1}=\\max(\\max(f_{son,j-1,0},f_{son,j-1,1})+v)$  \n$g_{u,j,0}=\\max(g_{son,j,0},g_{son,j,1})$  \n$g_{u,j,1}=\\max(\\max(g_{son,j-1,0},g_{son,j-1,1})+v+p_{fa}-p_{son})$  \n\u6ce8\u610f\u8def\u5f84\u65b9\u5411\u7684\u4e0d\u540c\u5bfc\u81f4\u7684\u4ef7\u503c\u53d8\u5316 .  \n\u8fd8\u8981\u8003\u8651 $u$  \u81ea\u5df1\u4f5c\u4e3a\u8d77\u70b9 ,  \n\u5373 $g_{u,1,1}=\\max(v+p_{fa})$  \n\u4f46\u76f4\u63a5\u4f7f\u7528\u4e00\u4e2a\u70b9\u7684 $f$ \u548c $g$ \u53bb\u66f4\u65b0\u7b54\u6848 , \u65e0\u6cd5\u4fdd\u8bc1\u8def\u5f84\u4e0d\u91cd\u590d ,  \n\u90a3\u4e48\u8003\u8651\u5728\u5408\u5e76\u5b50\u6811\u65f6\u66f4\u65b0\u7b54\u6848 ,\n$ans=\\max(\\max(f_{son,j,0},f_{son,j,1})+\\max(g_{u,k,0},g_{u,k,1}))$  \n$ans=\\max(\\max(g_{son,j,0},g_{son,j,1})+\\max(f_{u,k,0},f_{u,k,1}+p_{fa}-p_{son}))$  \n\u6ce8\u610f\u8fd9\u91cc $f,g$ \u662f\u7531\u4e4b\u524d\u7684\u5168\u90e8\u513f\u5b50\u8f6c\u79fb\u800c\u6765 , \u6240\u4ee5\u80fd\u591f\u4fdd\u8bc1\u8def\u5f84\u4e0d\u91cd\u590d .\n\u6ce8\u610f\u7531\u4e8e $f_{u,0,1},g_{u,0,1}$ \u4e0d\u5408\u6cd5 , \u5f3a\u5236\u8d4b\u503c\u8d1f\u65e0\u7a77 .  \n\u4e0a\u5f0f\u7684 $j+k\\leq v$ , \u5982\u679c\u679a\u4e3e $j,k$ \u4f1a\u6709 $O(v^2)$ \u7684\u590d\u6742\u5ea6 , \u5b9e\u9645\u4e0a\u53ea\u9700\u7ef4\u62a4\u524d\u7f00\u6700\u5927\u503c\u5c31\u53ef\u505a\u5230 $O(v)$ \u8f6c\u79fb .  \n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nv)$\n## Code\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cstdlib>\n#define ll long long\nusing namespace std;\nint read()\n{\n    int ret=0;char c=getchar();\n    while(c>'9'||c<'0')c=getchar();\n    while(c>='0'&&c<='9')ret=(ret<<3)+(ret<<1)+(c^48),c=getchar();\n    return ret;\n}\nconst int maxn=1e5+5;\nconst int maxm=105;\nconst ll inf=1e15;\nint n,v;\nll ans;\nstruct graph\n{\n    int p[maxn];ll val[maxn];\n    int head[maxn],ver[maxn<<1],nxt[maxn<<1],tot;\n    void add(int x,int y){ver[++tot]=y;nxt[tot]=head[x];head[x]=tot;}\n    void link(int x,int y){add(x,y);add(y,x);}\n    ll f[maxn][maxm][2],g[maxn][maxm][2];\n    void dfs(int u,int fa)\n    {\n        val[u]=0;\n        for(int i=head[u];i;i=nxt[i])\n        {\n            if(ver[i]==fa)continue;\n            dfs(ver[i],u);val[u]+=p[ver[i]];\n        }\n        f[u][0][1]=g[u][0][1]=-inf;\n        g[u][1][1]=max(g[u][1][1],val[u]+p[fa]);\n        for(int i=head[u];i;i=nxt[i])\n        {\n            if(ver[i]==fa)continue;\n            ll mx1=0,mx2=0;\n            for(int j=v;j>=0;j--)\n            {\n                mx1=max(mx1,max(g[u][v-j][0],g[u][v-j][1]));\n                mx2=max(mx2,max(f[u][v-j][0],f[u][v-j][1]+p[fa]-p[ver[i]]));\n                ans=max(ans,max(f[ver[i]][j][0],f[ver[i]][j][1])+mx1);\n                ans=max(ans,max(g[ver[i]][j][0],g[ver[i]][j][1])+mx2);\n            }\n            for(int j=1;j<=v;j++)\n                f[u][j][0]=max(f[u][j][0],max(f[ver[i]][j][0],f[ver[i]][j][1])),f[u][j][1]=max(f[u][j][1],max(f[ver[i]][j-1][0],f[ver[i]][j-1][1])+val[u]);\n            for(int j=1;j<=v;j++)\n                g[u][j][0]=max(g[u][j][0],max(g[ver[i]][j][0],g[ver[i]][j][1])),g[u][j][1]=max(g[u][j][1],max(g[ver[i]][j-1][0],g[ver[i]][j-1][1])+val[u]+p[fa]-p[ver[i]]);\n        }\n    }\n}o;\nint main()\n{\n    n=read();v=read();\n    for(int i=1;i<=n;i++)o.p[i]=read();\n    for(int i=1;i<=n-1;i++)o.link(read(),read());\n    o.dfs(1,0);\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1626826252,
        "uid": 174469,
        "name": "zero4338",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4657 [CEOI2017]Chase"
    },
    {
        "content": "\u6bd4\u8f83\u7ecf\u5178\u7684\u6811\u5f62 $DP$\n\n\u5982\u679c\u6211\u4eec\u786e\u5b9a\u4e86\u8d77\u70b9\uff0c\u90a3\u4e48\u6bcf\u4e2a\u70b9\u88ab\u9009\u4e2d\u4ed6\u7684\u8d21\u732e\u5c31\u662f $\\sum_{v \\in son} f_v$\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u6709\u4e86 $n^2$ \u7206\u529b\n\n$dp_{i, j, 1 / 0}$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u94fe\uff0c\u4f7f\u7528\u4e86 $j$ \u4e2a\u78c1\u94c1\uff0c $i$ \u653e / \u6ca1\u653e\u78c1\u94c1\n\n\u8f6c\u79fb\u7684\u8bdd\u5bf9\u5176\u5b50\u6811\u7684\u8d21\u732e\u53d6 $max$ \u8d21\u732e\u5230 $dp_{i, j, 0}$\n\n\u7531 $dp_{i, j , 0}$ \u8d21\u732e\u5230 $dp_{i, j + 1, 1}$\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u8003\u573a\u4e0a\u6211\u6709\u4e24\u79cd\u601d\u8def\n\n1. \u8003\u8651 $dp$ \u51fa\u4e00\u6761\u5411\u4e0a\u7684\u94fe\uff0c \u5728 $lca$ \u5904\u62fc\u63a5\n\n\u4f46\u662f\u8fd9\u6837\u505a\u7684\u8bdd\u6bd4\u8f83\u9ebb\u70e6\uff0c\u9700\u8981\u8bb0\u5f55\u7684\u72b6\u6001\u6bd4\u8f83\u591a\uff0c\u5408\u5e76\u65f6\u6bd4\u8f83\u96be\u641e\n\n\u4e8e\u662f\u6709\u4e86\u53e6\u4e00\u79cd\u601d\u8def\n\n2. \u6362\u6839 $dp$\n\n\u8fd9\u4e2a\u5c31\u6bd4\u8f83\u597d\u641e\u4e86\n\n\u6362\u6839\u65f6\u53ea\u4f1a\u5f71\u54cd\u5230 $x , fa_x$\n\n\u8003\u8651\u5728 $fa_x$ \u4f4d\u7f6e\u4fee\u6539\u4ed6\u7684 $dp$ \u503c\uff0c\u4f7f\u4ed6\u4f5c\u4e3a $x$ \u7684\u5b50\u6811\u8fdb\u884c\u8d21\u732e\n\n\u8fd9\u4e2a\u5176\u5b9e\u6bd4\u8f83\u5957\u8def\uff0c\u56e0\u4e3a\u53d1\u73b0\u5176\u5b9e\u5c31\u662f\u6263\u6389 $x$ \u4f5c\u4e3a\u4ed6\u7684\u513f\u5b50\u7684\u8d21\u732e\uff0c\u90a3\u4e48\u6211\u4eec\u5bf9\u8f6c\u79fb\u8fc7\u7a0b\u7ef4\u62a4\u4e00\u4e2a\u6700\u5927\u503c\uff0c \u4e00\u4e2a\u4e0e\u6700\u5927\u503c\u4e0d\u540c\u5b50\u6811\u7684\u6b21\u5927\u503c\uff0c\u90a3\u4e48\u53ea\u8981\u4e0d\u53d6\u5230\u6700\u5927\u503c\u6765\u6e90\u7684\u5b50\u6811, \u5176 $dp$ \u503c\u4ecd\u7136\u4e3a\u6700\u5927\u503c\uff0c\u5426\u5219\u4e3a\u6b21\u5927\u503c\n\n\n```cpp\n#include<bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long ull;\ninline int read(){\n    int x = 0; char c = getchar();\n    while(c < '0' || c > '9')c = getchar();\n\tdo{x = (x << 3) + (x << 1) + (c ^ 48); c = getchar();}while(c <= '9' && c >= '0');\n\treturn x;   \n}\nconst int maxn = 1e5 + 55;\nint n, sum, f[maxn], head[maxn], tot, root;\nstruct edge{\n\tint to, net;\n}e[maxn << 1 | 1];\nvoid add(int u, int v){\n\te[++tot].net = head[u];\n\thead[u] = tot;\n\te[tot].to = v;\n}\nll ans;\nll tmp[maxn][105][2], g[maxn];\nvoid solve(int x, int fa){\n\tg[x] = 0;\n\tfor(int i = 1; i <= sum; ++i)tmp[x][i][0] = 0;\n\tfor(int i = head[x]; i; i = e[i].net){\n\t\tint v = e[i].to;\n\t\tif(v == fa)continue;\n\t\tg[x] += f[v];\n\t\tsolve(v, x);\n\t\tfor(int j = 1; j <= sum; ++j)tmp[x][j][0] = max(tmp[x][j][0], max(tmp[v][j][1], tmp[v][j][0]));\n\t}\n\tfor(int i = sum; i >= 1; --i)tmp[x][i][1] = tmp[x][i - 1][0] + g[x];\n}\nint rmx[maxn][105];\nll  rval[maxn][105], rcm[maxn][105];\nvoid ch(int x, int fa){\n\tfor(int j = 1; j <= sum; ++j)tmp[x][j][0] = max(tmp[x][j][0] ,max(tmp[fa][j][0], tmp[fa][j][1]));\n\tfor(int j = 1; j <= sum; ++j)tmp[x][j][1] = tmp[x][j - 1][0] + g[x] + f[fa];\n\tans = max(ans, max(tmp[x][sum][0], tmp[x][sum][1]));\n\tfor(int j = 1; j <= sum; ++j)tmp[x][j][0] = max(tmp[fa][j][0], tmp[fa][j][1]);\n\tfor(int j = head[x]; j; j = e[j].net){\n\t\tint v = e[j].to;\n\t\tfor(int k = 1; k <= sum; ++k){\n\t\t\tll val = 0;\n\t\t\tif(v == fa)val = max(tmp[fa][k][0], tmp[fa][k][1]);\n\t\t\telse val = max(tmp[v][k][0], tmp[v][k][1]);\n\t\t\tif(val > rval[x][k]){\n\t\t\t\trcm[x][k] = rval[x][k];\n\t\t\t\trval[x][k] = val;\n\t\t\t\trmx[x][k] = v;\n\t\t\t}else rcm[x][k] = max(rcm[x][k], val);\n\t\t}\n\t}\n\tfor(int i = head[x]; i; i = e[i].net){\n\t\tint v = e[i].to;\n\t\tif(v == fa)continue;\n\t\tfor(int j = 1; j <= sum; ++j)tmp[x][j][0] = rmx[x][j] == v ? rcm[x][j] : rval[x][j];\n\t\tfor(int j = 1; j <= sum; ++j)tmp[x][j][1] = tmp[x][j - 1][0] + g[x] - f[v] + f[fa];\n\t\tch(v, x);\t\n\t}\n}\nint main(){\n\tn = read(), sum = read();\n\tfor(int i = 1; i <= n; ++i)f[i] = read();\n\tfor(int i = 1; i < n; ++i){\n\t\tint u = read(), v = read();\n\t\tadd(u, v); add(v, u);\n\t}\n\tif(n == 1 || sum == 0){\n\t\tprintf(\"0\\n\");\n\t\treturn 0;\n\t}\n\tif(n == 2){\n\t\tprintf(\"%d\\n\",max(f[1], f[2]));\n\t\treturn 0;\n\t}\n\tsolve(1, 0);\n\tch(1, 0);\n\tprintf(\"%lld\\n\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1664541954,
        "uid": 291408,
        "name": "Chen_jr",
        "ccfLevel": 7,
        "title": "P4657 [CEOI2017] Chase"
    },
    {
        "content": "\u6254\u78c1\u94c1\u5f97\u5230\u7684\u6536\u76ca\u6709\u4e24\u79cd\u60c5\u51b5\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201130084550629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01vZGVzdENvZGVyXw==,size_16,color_FFFFFF,t_70)\n\n1. \u6211\u5728\u8d77\u70b9\uff0c\u6254\u4e00\u4e2a\u78c1\u94c1\uff0c\u5468\u56f4\u7684\u6743\u503c\u662f\u6536\u76ca\uff0c\u56e0\u4e3a\u5468\u56f4\u7684\u90a3\u4e9b\u94c1\u5757\u6211\u80af\u5b9a\u4e0d\u4f1a\u9047\u5230\uff0c\u800c\u8ffd\u9010\u8005\u80af\u5b9a\u4f1a\u9047\u5230\n2. \u6211\u4ece\u67d0\u4e00\u4e2a\u70b9\u8d70\u8fc7\u6765\uff0c\u5047\u8bbe\u4e0a\u4e00\u4e2a\u70b9\u662f\u7ea2\u70b9\uff0c\u73b0\u5728\u6211\u5728\u7eff\u70b9\uff0c\u7136\u540e\u6211\u6254\u4e86\u4e00\u4e2a\u78c1\u94c1\uff0c\u6211\u83b7\u5f97\u7684\u6536\u76ca\u662f\u5468\u56f4\u70b9\u7684\u6743\u503c\u548c\u51cf\u53bb\u7ea2\u70b9\u7684\u6743\u503c\uff0c\u56e0\u4e3a\u6211\u662f\u7ecf\u8fc7\u4e86\u7ea2\u70b9\u7684\uff0c\u9047\u5230\u8fc7\u7ea2\u70b9\u7684\u94c1\u5757\uff0c\u800c\u4e14\u8ffd\u9010\u8005\u4e5f\u80af\u5b9a\u4f1a\u9047\u5230\n\n\u6240\u4ee5\u4e00\u6761\u8def\u5f84\u4e0a\uff0c\u6254\u78c1\u94c1\u83b7\u5f97\u7684\u6536\u76ca\u6709\u4e24\u79cd\u60c5\u51b5\n\n\u800c\u4e14\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5047\u5982\u6211\u4ece\u67d0\u4e00\u4e2a\u70b9\u51fa\u53d1\uff0c\u4e00\u5b9a\u8981\u6254\u4e00\u4e2a\u78c1\u94c1\u3002\u6216\u8005\u8bf4\uff0c**\u6211\u6254\u7b2c\u4e00\u4e2a\u78c1\u94c1\u7684\u5730\u65b9\uff0c\u4e00\u5b9a\u662f\u51fa\u53d1\u70b9**\n\n\u601d\u8003\u6811\u5f62dp\uff0c\u904d\u5386\u5230\u67d0\u4e2a\u70b9$u$\u7684\u65f6\u5019\uff0c\u8ba1\u7b97\u5982\u4e0b\u56fe\u7684\u6700\u4f18\u503c\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201130085304813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01vZGVzdENvZGVyXw==,size_16,color_FFFFFF,t_70)\n\n\u4ece$u$\u7684\u5b50\u6811\u4e2d\u67d0\u70b9\u51fa\u53d1\uff0c\u5f80\u4e0a\u8d70\u7ecf\u8fc7$u$\uff0c\u518d\u8d70\u5411\u5b50\u6811\u4e2d\u7684\u67d0\u70b9\n\n\u4fdd\u8bc1\u4e86**\u4e0d\u91cd\u4e0d\u6f0f**\n\n\u6240\u4ee5\u6211\u662f\u94a6\u5b9a\u4e86\u4ece\u8d77\u70b9\u8d70\u5230\u7ec8\u70b9\u662f\u5148\u5f80\u4e0a\u8d70\u518d\u5f80\u4e0b\u8d70\uff0c\u800c\u8fd9\u9053\u9898\u76ee\uff0c\u8d77\u70b9\u6254\u78c1\u94c1\u7684\u8d21\u732e\u4e0e\u4e2d\u9014\u67d0\u4e00\u70b9\u6254\u78c1\u94c1\u7684\u8d21\u732e\u7684\u8ba1\u7b97\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\u3002\u6240\u4ee5\u6211\u8bbe\u8ba1\u72b6\u6001\u7684\u65f6\u5019\u9700\u8981**\u7740\u91cd\u8003\u8651**\n\n\u4ee4\n\n$a[u]$\u4e3a\u8be5\u70b9\u6743\u503c\n\n$s[u]$\u4e3a\u4e0e\u8be5\u70b9\u76f8\u90bb\u7684\u6240\u6709\u70b9\u6743\u503c\u548c\n\n$f[u][i]$\u8868\u793a\u4ece$u$\u7684\u5b50\u6811\u4e2d\u51fa\u53d1\u5f80\u4e0a\u8d70\u5230$u$\uff0c\u5171\u6254\u4e86$i$\u4e2a\u78c1\u94c1\u7684\u6700\u4f18\u503c\n\n$g[u][i]$\u8868\u793a\u4ece$u$\u5f80\u4e0b\u8d70\u5230\u5b50\u6811\u4e2d\u67d0\u4e00\u70b9\uff0c\u5171\u6254\u4e86$i$\u4e2a\u78c1\u94c1\u7684\u6700\u4f18\u503c\n\n\u521d\u59cb\u5316$f[u][1]=s[u](u\u4e3a\u8d77\u70b9)$\n\n$g[u][1]=s[u]-a[pre](u\u4e3a\u5f80\u4e0b\u8d70\u7684\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e2a\u70b9)$\n\n\u4ee5$u$\u4e3a\u4e2d\u8f6c\u70b9\u7684\u7b54\u6848\u7edf\u8ba1\n\n$ans=max(ans,f[u][i]+g[v][m-i])$\n\n\u8f6c\u79fb\n\n\n$f[u][i]=max(f[u][i],f[v][i],f[v][i-1]+s[u]-a[v])$\n\n$g[u][i]=max(g[u][i],g[v][i],g[v][i-1]+s[u]-a[pre])$\n\n\u8fd8\u53d1\u73b0\u5176\u5b9e\u6211\u662f\u4ece\u5b50\u6811\u4e2d\u9009\u4e86\u4e24\u4e2a\u65b9\u5411\uff0c\u4e00\u4e2a\u662f\u6765\u65f6\u7684\u65b9\u5411\uff0c\u4e00\u4e2a\u662f\u53bb\u5411\n\n\u56e0\u4e3a\u65b9\u5411\u4e0d\u540c\uff0c\u8d77\u70b9\u7684\u8d21\u732e\u5c31\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u8fd8\u6709\u5012\u7740\u679a\u4e3e\u513f\u5b50\u679a\u4e3e\u4e00\u904d\n\nCode\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define maxn 100010\n#define maxm 110\n#define LL long long\nusing namespace std;\nstruct Edge{\n\tint to, next;\n}edge[maxn << 1];\nint num, head[maxn], n, m, stk[maxn];\nLL a[maxn], s[maxn], f[maxn][maxm], g[maxn][maxm], ans;\n\ninline int read(){\n\tint s = 0, w = 1;\n\tchar c = getchar();\n\tfor (; !isdigit(c); c = getchar()) if (c == '-') w = -1;\n\tfor (; isdigit(c); c = getchar()) s = (s << 1) + (s << 3) + (c ^ 48);\n\treturn s * w;\n}\n\nvoid addedge(int x, int y){\n\tedge[++num] = (Edge){y, head[x]}, head[x] = num;\n}\n\nvoid dfs(int u, int pre){\n\tfor (int i = 1; i <= m; ++i)\n\t\tf[u][i] = s[u], g[u][i] = s[u] - a[pre];\n\tfor (int i = head[u]; i; i = edge[i].next){\n\t\tint v = edge[i].to;\n\t\tif (v == pre) continue;\n\t\tdfs(v, u);\n\t\tfor (int j = 0; j <= m; ++j) ans = max(ans, f[u][j] + g[v][m - j]);\n\t\tfor (int j = 1; j <= m; ++j){\n\t\t\tf[u][j] = max(f[u][j], max(f[v][j], f[v][j - 1] + s[u] - a[v]));\n\t\t\tg[u][j] = max(g[u][j], max(g[v][j], g[v][j - 1] + s[u] - a[pre]));\n\t\t}\n\t}\n\tfor (int i = 1; i <= m; ++i)\n\t\tf[u][i] = s[u], g[u][i] = s[u] - a[pre];\n\tint top = 0;\n\tfor (int i = head[u]; i; i = edge[i].next){\n\t\tint v = edge[i].to;\n\t\tif (v == pre) continue;\n\t\tstk[++top] = v;\n\t}\n\twhile (top){\n\t\tint v = stk[top--];\n\t\tfor (int j = 0; j <= m; ++j) ans = max(ans, f[u][j] + g[v][m - j]);\n\t\tfor (int j = 1; j <= m; ++j){\n\t\t\tf[u][j] = max(f[u][j], max(f[v][j], f[v][j - 1] + s[u] - a[v]));\n\t\t\tg[u][j] = max(g[u][j], max(g[v][j], g[v][j - 1] + s[u] - a[pre]));\n\t\t}\n\t}\n}\n\nint main(){\n\tn = read(), m = read();\n\tfor (int i = 1; i <= n; ++i) a[i] = read();\n\tfor (int i = 1; i < n; ++i){\n\t\tint x = read(), y = read();\n\t\taddedge(x, y), addedge(y, x);\n\t\ts[x] += a[y], s[y] += a[x];\n\t}\n\tdfs(1, 0);\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1606698329,
        "uid": 51719,
        "name": "ModestCoder_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4657 \u3010[CEOI2017]Chase\u3011"
    },
    {
        "content": "\u4e00\u4e2a\u6bd4\u8f83\u76f4\u63a5\u7684\u65b9\u6cd5\u662f\u76f4\u63a5\u6362\u6839 dp\uff0c\u9898\u89e3\u91cc\u4f3c\u4e4e\u6ca1\u6709\u2026\u2026\n\n\u6734\u7d20\u7684 dp \u8bbe $f[u][i]$ \u4e3a\u4ece\u6839\u5411 u \u5b50\u6811\u91cc\u8d70\u7684\u6700\u5927\u8d21\u732e\n\n\u8f6c\u79fb\u65f6\u5bf9\u4e24\u79cd\u60c5\u51b5\u53d6 max\uff1a\n\n$$ f[v][i]\\rightarrow f[u][i] $$\n$$ f[v][i]+sum_v\\rightarrow f[u][i+1] $$\n\n\u5176\u4e2d $sum_v$ \u8868\u793a\u5728\u786e\u5b9a\u6839\u7684\u524d\u63d0\u4e0b v \u7684\u6240\u6709\u513f\u5b50\u6743\u503c\u4e4b\u548c\n\n\u56e0\u4e3a\u8f6c\u79fb\u662f\u53d6 max\uff0c\u6240\u4ee5\u6362\u6839\u65f6\u4e0d\u80fd\u7b80\u5355\u52a0\u51cf\uff0c\u800c\u5e94\u5bf9\u5f53\u524d\u6839\u7b97\u51fa\u6bcf\u79cd\u8f6c\u79fb\u6240\u9700\u503c\u7684\u6700\u5927/\u6b21\u5927\u503c\uff0c\u6362\u6839\u65f6\u5224\u65ad\u6240\u9700\u503c\u662f\u5426\u6765\u81ea\u8981\u6362\u5230\u7684\u513f\u5b50\uff0c\u7136\u540e\u6309\u65b9\u7a0b\u8f6c\u79fb\u5373\u53ef\uff0c\u56e0\u4e3a\u513f\u5b50\u53d8\u4e3a\u6839\u540e\u5f53\u524d\u6839\u53d8\u4e3a\u513f\u5b50\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u7b97\u51fa\u5f53\u524d\u6839\u65b0\u7684 dp \u503c\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nint read(){\n\tint f=0,s=0; char c=getchar();\n\twhile(c>'9'||c<'0')f=(c=='-'),c=getchar();\n\twhile(c>='0'&&c<='9')s=(s<<3)+(s<<1)+(c^'0'),c=getchar();\n\treturn f?-s:s;\n}\n\nconst int N=100005;\nconst int M=105;\nint n,V;\nint a[N];\nint t1,t2;\n\nconst int E=200005;\nint to[E],nx[E],h[N],tot=0;\ninline void add(int a,int b){ to[++tot]=b; nx[tot]=h[a]; h[a]=tot; }\ninline void link(int a,int b){ add(a,b); add(b,a); }\nint f[N][M][2];\nint ans=0;\n\nconst int inf=1e18;\nint w[N];\nvoid dfs1(int u,int fa){\n\tw[u]=0;\n\tfor(int i=h[u];i;i=nx[i])if(to[i]!=fa&&to[i])dfs1(to[i],u),w[u]+=a[to[i]];\n\tfor(int i=0;i<=V;i++)for(int j=0;j<2;j++)f[u][i][j]=-inf;\n\tf[u][0][0]=0; f[u][1][1]=w[u];\n\tfor(int i=h[u];i;i=nx[i])if(to[i]!=fa&&to[i]){\n\t\tfor(int j=0;j<=V;j++){\n\t\t\tint tmp=max(f[to[i]][j][0],f[to[i]][j][1]);\n\t\t\tf[u][j][0]=max(f[u][j][0],tmp);\n\t\t\tf[u][j+1][1]=max(f[u][j+1][1],tmp+w[u]);\n\t\t}\n\t}\n}\nint t[N][M][2][2];\nvoid dfs2(int u,int fa){\n\tfor(int i=0;i<=V;i++)ans=max(ans,max(f[u][i][0],f[u][i][1]));\n\tfor(int i=0;i<=V;i++)for(int j=0;j<2;j++)t[u][i][j][0]=t[u][i][j][1]=-inf;\n\tfor(int i=h[u];i;i=nx[i]){\n\t\tfor(int j=0;j<=V;j++)for(int k=0;k<2;k++){\n\t\t\tif(f[to[i]][j][k]>t[u][j][k][0])swap(t[u][j][k][1],t[u][j][k][0]),t[u][j][k][0]=f[to[i]][j][k];\n\t\t\telse if(f[to[i]][j][k]>t[u][j][k][1])t[u][j][k][1]=f[to[i]][j][k];\n\t\t}\n\t}\n\tfor(int i=h[u];i;i=nx[i])if(to[i]!=fa){\n\t\tw[to[i]]+=a[u];\n\t\tfor(int j=V;j>=0;j--){\n\t\t\tint g0=-inf,g1=-inf;\n\t\t\tif(f[to[i]][j][0]==t[u][j][0][0])g0=max(g0,t[u][j][0][1]);\n\t\t\telse g0=max(g0,t[u][j][0][0]);\n\t\t\tif(f[to[i]][j][1]==t[u][j][1][0])g0=max(g0,t[u][j][1][1]);\n\t\t\telse g0=max(g0,t[u][j][1][0]);\n\t\t\tif(j){\n\t\t\t\tif(f[to[i]][j-1][0]==t[u][j-1][0][0])g1=max(g1,t[u][j-1][0][1]+w[u]-a[to[i]]);\n\t\t\t\telse g1=max(g1,t[u][j-1][0][0]+w[u]-a[to[i]]);\n\t\t\t\tif(f[to[i]][j-1][1]==t[u][j-1][1][0])g1=max(g1,t[u][j-1][1][1]+w[u]-a[to[i]]);\n\t\t\t\telse g1=max(g1,t[u][j-1][1][0]+w[u]-a[to[i]]);\n\t\t\t}\n\t\t\tif(j==1)g1=max(g1,w[u]-a[to[i]]);\n\t\t\tf[u][j][0]=g0; f[u][j][1]=g1;\n\t\t\tint tmp=max(g0,g1);\n\t\t\tf[to[i]][j][0]=max(f[to[i]][j][0],tmp);\n\t\t\tf[to[i]][j][1]+=a[u];\n\t\t\tif(j==0)f[to[i]][j][1]=-inf;\n\t\t\tf[to[i]][j+1][1]=max(f[to[i]][j+1][1],tmp+w[to[i]]);\n\t\t}\n\t\tdfs2(to[i],u);\n\t}\n}\n\nsigned main(){\n\tn=read(); V=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<n;i++)t1=read(),t2=read(),link(t1,t2);\n\tdfs1(1,0); dfs2(1,0);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n\n~~\u5173\u4e8e\u8003\u573a\u5bf9\u539f\u9898\u7528\u65b0\u505a\u6cd5\u51993.5h\u8fd9\u4e8b~~",
        "postTime": 1637139967,
        "uid": 118743,
        "name": "ZZ\u4f5c\u8005",
        "ccfLevel": 7,
        "title": "P4657 [CEOI2017]Chase \u9898\u89e3"
    },
    {
        "content": "## \u9898\u89e3\n\n\u9996\u5148\uff0c\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a\u7b54\u6848\uff1a\u672c\u8d28\u4e0a\u662f\u6c42\u5728\u4e00\u6761\u8def\u5f84\u4e0a\uff0c\u9009\u62e9\u4e86\u4e00\u4e9b\u70b9\uff0c\u8fd9\u4e9b\u70b9\u7684\u8d21\u732e\u662f\u5b83\u5468\u56f4\u7684\u70b9\u6743\u548c - \u5b83\u4e0a\u4e00\u6b65\u7684\u70b9\u6743\n\n\u5bf9\u4e8e\u4e00\u68f5\u6811\uff0c\u53ef\u4ee5\u5148\u786e\u5b9a\u4e00\u4e2a\u6839\uff0c\u7136\u540e\u6bcf\u6761\u8def\u5f84\u5c31\u53ef\u4ee5\u5206\u6210\u5411\u4e0a\u548c\u5411\u4e0b\u7684\u4e24\u90e8\u5206\n\n\u90a3\u4e48\u5b9a\u72b6\u6001 $dp_{i,j,0}$ \u8868\u793a\u7531 $i$ \u5411 $i$ \u7684\u5b50\u6811\u8d70\uff0c\u9009\u4e86 $j$ \u4e2a\u70b9\u653e\u78c1\u94c1\uff0c$dp_{i,j,1}$ \u5219\u8868\u793a\u5411\u4e0a\u8d70\n\n\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5c31\u5f88\u597d\u60f3\n$$\ndp_{i,j,0}=\\max\\{dp_{son\\in son_i,j,0},dp_{son\\in son_i,j-1,0}+sum_x-num_{son}\\}\n$$\n\n$$\ndp_{i,j,1}=\\max\\{dp_{son\\in son_i,j,1},dp_{son\\in son_i,j-1,1}+sum_x-num_{fa}\\}\n$$\n\n\u8fd9\u4e2a\u65b9\u7a0b\u5c31\u662f\u7531\u4e0b\u5f80\u4e0a\u8f6c\u79fb\uff0c\u4e14\u5bf9\u4e8e\u4e00\u4e2a\u653e\u4e86\u7684\u70b9\uff0c\u5b83\u4e0a\u4e00\u4e2a\u7ecf\u8fc7\u7684\u70b9\u65e0\u6cd5\u88ab\u5b83\u7ba1\u5230\u3002\n\n\u521d\u59cb\u5316\u65f6\u8981\u628a $dp_{x,i,0}$ \u90fd\u521d\u59cb\u5316\u4e3a $sum_x$\uff0c\u56e0\u4e3a\u8f6c\u79fb\u65f6\u53ef\u4ee5\u662f\u4e00\u4e2a\u70b9\u52a0\u4e0a\u4e00\u6761\u5411\u4e0b\u7684\u8def\u5f84\u3002\n\n\u8f6c\u79fb\u7b54\u6848\u65f6\u8981\u6ce8\u610f\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\u7684\u6240\u6709\u513f\u5b50\u8981\u4ece\u524d\u5f80\u540e\u8f6c\u79fb\u4e00\u904d\uff0c\u540c\u65f6\u4ece\u540e\u5f80\u524d\u8f6c\u79fb\u4e00\u904d\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u6240\u6709\u5206\u652f\u90fd\u6709\u53ef\u80fd\u5411\u4e0b\u6216\u5411\u4e0a\u3002\n\n\u8fd8\u8981\u5728\u9006\u5411\u8f6c\u79fb\u4e4b\u524d\u6062\u590d $dp$ \u6570\u7ec4\u539f\u6709\u72b6\u6001\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ri register signed\n#define p(i) ++i\nusing namespace std;\nnamespace IO{\n    char buf[1<<21],*p1=buf,*p2=buf;\n    #define gc() p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++\n    template<typename T>inline void read(T &x) {\n        ri f=1;x=0;register char ch=gc();\n        while(ch<'0'||ch>'9') {if (ch=='-') f=0;ch=gc();}\n        while(ch>='0'&&ch<='9') {x=(x<<1)+(x<<3)+(ch^48);ch=gc();}\n        x=f?x:-x;\n    }\n}\nusing IO::read;\nnamespace nanfeng{\n    #define FI FILE *IN\n    #define FO FILE *OUT\n    template<typename T>inline T cmax(T x,T y) {return x>y?x:y;}\n    template<typename T>inline T cmin(T x,T y) {return x>y?y:x;}\n    typedef long long ll;\n    static const int N=1e5+7;\n    int first[N],nm[N],tmp[N],cnt,t=1,n,vn;\n    struct edge{int v,nxt;}e[N<<1];\n    inline void add(int u,int v) {\n        e[t].v=v,e[t].nxt=first[u],first[u]=t++;\n        e[t].v=u,e[t].nxt=first[v],first[v]=t++;\n    }\n    ll dp[N][107][2],ans,sum[N];\n    inline void update(int x,int v,int fa) {\n        for (ri i(1);i<vn;p(i)) ans=cmax(ans,dp[x][i][0]+dp[v][vn-i][1]);\n        for (ri i(1);i<=vn;p(i)) {\n            dp[x][i][0]=cmax(dp[x][i][0],cmax(dp[v][i][0],dp[v][i-1][0]+sum[x]-nm[v]));\n            dp[x][i][1]=cmax(dp[x][i][1],cmax(dp[v][i][1],dp[v][i-1][1]+sum[x]-nm[fa]));\n        }\n    }\n    void dfs(int x,int fa) {\n        for (ri i(first[x]),v;i;i=e[i].nxt) {\n            if ((v=e[i].v)==fa) continue;\n            dfs(v,x);\n        }\n        for (ri i(1);i<=vn;p(i)) dp[x][i][0]=sum[x];\n        cnt=0;\n        for (ri i(first[x]);i;i=e[i].nxt) update(x,tmp[p(cnt)]=e[i].v,fa);\n        for (ri i(1);i<=vn;p(i)) dp[x][i][0]=sum[x],dp[x][i][1]=0;\n        for (ri i(cnt);i;--i) update(x,tmp[i],fa);\n        ans=cmax(ans,cmax(dp[x][vn][1],dp[x][vn][0]));\n    }\n    inline int main() {\n        // FI=freopen(\"nanfeng.in\",\"r\",stdin);\n        // FO=freopen(\"nanfeng.out\",\"w\",stdout);\n        // printf(\"cost = %d\\n\",sizeof(dp)>>20);\n        read(n),read(vn);\n        for (ri i(1);i<=n;p(i)) read(nm[i]);\n        for (ri i(1),u,v;i<n;p(i)) {\n            read(u),read(v);\n            add(u,v);\n        } \n        for (ri i(1);i<=n;p(i)) {\n            for (ri j(first[i]),v;j;j=e[j].nxt) sum[i]+=nm[e[j].v];\n        }\n        dfs(1,0);\n        printf(\"%lld\\n\",ans); \n        return 0;\n    }  \n}\nint main() {return nanfeng::main();} \n```",
        "postTime": 1626839761,
        "uid": 141958,
        "name": "\u6960\u67ab",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4657 [CEOI2017]Chase"
    },
    {
        "content": "![image.png](https://i.loli.net/2021/11/17/45WTelN9C6LwyxK.png)\n\n\u4e14\u770b\u4e0a\u56fe\uff08\u793a\u610f\u56fe\uff0c\u4e0d\u59a8\u5c06 1 \u770b\u6210\u6811\u6839\uff09\u3002\u6211\u4eec\u4f1a\u53d1\u73b0\u5728\u8fd9\u6761\u8def\u5f84\u4e0a\uff0c\u4f1a\u6709\u4e09\u79cd\u4e0d\u540c\u8eab\u4efd\u7684\u70b9\uff0c\u5206\u522b\u5982\u4e0a\u56fe\u7ea2\u3001\u7eff\u3001\u84dd\u6240\u793a\uff1a\u7eff\u70b9\u662f\u8d77\u70b9\uff0c\u5b83\u7684\u6536\u76ca\u662f 4,13,14,15 \u56db\u4e2a\u70b9\u4e0a\u7684\u94c1\u7403\u6570\uff1b\u7ea2\u70b9\u662f\u5f80\u4e0a\u8d70\u7684\u70b9\uff0c\u5b83\u7684\u6536\u76ca\u662f\u6240\u6709\u4e0e\u5b83\u8fde\u63a5\u7684\u70b9\u4e0a\u7684\u94c1\u7403\u6570\u51cf\u53bb\u5b83\u7684\u524d\u4e00\u4e2a\u70b9 3 \u4e0a\u7684\u94c1\u7403\u6570\uff0c\u4e3a\u4ec0\u4e48\u8981\u51cf\u53bb\u5462\uff0c\u56e0\u4e3a 3 \u8fd9\u4e2a\u70b9\u4e0a\u7684\u94c1\u7403\u662f\u4e24\u4e2a\u4eba\u90fd\u4f1a\u9047\u5230\u7684\uff1b\u84dd\u70b9\u662f\u5411\u4e0b\u8d70\u7684\u70b9\uff0c\u5b83\u7684\u6536\u76ca\u662f\u5b83\u7684\u513f\u5b50\u7684\u94c1\u7403\u6570\u603b\u548c\uff0c\u5176\u5b9e\u672c\u8d28\u548c\u7ea2\u70b9\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u6ca1\u6709\u529e\u6cd5\uff0c\u4e00\u6761\u8def\u5f84\u4e0a\u53ef\u80fd\u6709\u5411\u4e0a\u8d70\u7684\u4e5f\u53ef\u80fd\u5411\u4e0b\u8d70\uff0c\u6211\u4eec\u90fd\u9700\u8981\u8003\u8651\uff1b\u90a3\u4e48 7 \u4e3a\u4ec0\u4e48\u8981\u6253\u9634\u5f71\uff0c\u5c31\u662f 7 \u8fd9\u4e2a\u65e2\u53ef\u4ee5\u7b97\u5411\u4e0a\u8d70\u53c8\u53ef\u4ee5\u7b97\u5411\u4e0b\u8d70\u7684\u70b9\u6765\u628a\u4e24\u6bb5\u8def\u5f84\u5408\u5e76\u8ba1\u5165\u7b54\u6848\u3002\n\n\u6709\u4e86\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u6211\u4eec\u5927\u81f4\u80fd\u60f3\u5230\u8fd9\u662f\u4e00\u4e2a\u6811\u5f62 DP\u3002\n\n\u72b6\u6001\uff1a$f_{i,j,0/1}(g_{i,j,0/1})$\uff0c$f(g)$ \u8868\u793a\u4ece $i$\uff08$i$ \u7684\u513f\u5b50\uff09 \u8d70\u5230 $i$ \u7684\u513f\u5b50\uff08$i$\uff09\uff0c\u628a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u770b\u6210\u4e16\u754c\uff0c\u534a\u6761\u8def\u5f84\u7684\u6700\u5927\u6536\u76ca\uff0c$j$ \u8868\u793a\u653e\u591a\u5c11\u4e2a\u78c1\u94c1\uff0c$0/1$ \u8868\u793a\u5728 $i$ \u653e\u4e0d\u653e\u78c1\u94c1\u3002\n\n\u8bbe\u513f\u5b50\u4e3a $son$\uff0c$i$ \u7684\u6240\u6709\u513f\u5b50\u94c1\u7403\u6570\u4e4b\u548c\u4e3a $v$\uff0c$i$ \u7684\u7236\u4eb2\u4e3a $p$\uff0c\u67d0\u70b9 $x$ \u7684\u7236\u4eb2\u94c1\u7403\u6570\u4e3a $a_x$\u3002\n\n\u6700\u7b80\u5355\u7684\uff1a${f_{i,j,0}}^{\\max}_{\\longleftarrow}\\max(f_{son,j,0},f_{son,j,1}),{g_{i,j,0}}^{\\max}_{\\longleftarrow}\\max(g_{son,j,0},g_{son,j,1})$\n\n\u7b2c\u4e8c\u7b80\u5355\u7684\uff08\u662f\u8d77\u70b9\u7684\u60c5\u51b5\uff09\uff1a$f_{i,1,1}=v+a_p$\n\n\u7ee7\u7eed\u5f97\u51fa\n\n$$\n{f_{i,j,1}}^{\\max}_{\\longleftarrow}\\max(f_{son,j-1,0},f_{son,j-1,1})+v\\\\\n{g_{i,j,1}}^{\\max}_{\\longleftarrow}\\max(g_{son,j-1,1},g_{son,j-1,1})+v-a_{son}+a_p\n$$\n\n\u89e3\u91ca\uff1a$v$ \u548c $v-a_{son}+a_p$ \u90fd\u662f\u8868\u8fbe\u201d$i$ \u5468\u56f4\u7684\u94c1\u7403\u6570\u548c\u51cf\u524d\u4e00\u4e2a\u70b9\u7684\u94c1\u7403\u6570\u201c\uff0c\u53ea\u662f\u7531\u4e8e\u8def\u5f84\u65b9\u5411\u4e0d\u540c\u800c\u8868\u8fbe\u5f62\u5f0f\u4e0d\u540c\u3002\n\n\n\nDP \u4e00\u96be\u70b9\u662f\u8fb9\u754c\uff0c\u6ce8\u610f $f_{i,0,1},g_{i,0,1}$ \u662f\u8fdd\u6cd5\u7684\uff0c\u8bbe\u6210 $-\\infin$\u3002\n\n\u77e5\u9053\u5982\u4f55\u9012\u63a8\uff0c\u90a3\u600e\u4e48\u8ba1\u7b97\u7b54\u6848\u3002\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u91cd\u590d\u7ecf\u8fc7\u4e00\u6761\u8fb9\u6211\u4eec\u8003\u8651\u8fd9\u6837\u8ba1\u7b97\uff0c\u5bf9\u4e8e\u5c06\u8981\u7528\u6765\u66f4\u65b0 $f_{i,\u00d7,\u00d7}$\u7684\u8fd9\u4e2a $son$\uff0c\u6211\u4eec\u5728\u7528\u5b83\u66f4\u65b0*\u4e4b\u524d*\u6765\u8ba1\u7b97\u4e00\u4e0b\u7531*\u5f53\u524d\u7684* $f(g)_{i,j_1,0/1}$ \u548c $f(g)_{son,j_2,0/1}$\uff08$\\forall j_1+j_2\\le v$\uff09\u80fd\u4e0d\u80fd\u66f4\u65b0\u7b54\u6848 $ans$\u3002\n\n\u90a3\u4e48\n$$\nans^{\\max}_{\\longleftarrow}\\max(f_{i,j_1,0},f_{i,j_1,1}+a_p-a_{son})+\\max(g_{son,j_2,0},g_{son,j_2,1}),\\forall j_1+j_2\\le v\\\\\nans^{\\max}_{\\longleftarrow}\\max(g_{i,j_1,0},g_{i,j_1,1})+\\max(f_{son,j_2,0},f_{son,j_2,1}),\\forall j_1+j_2\\le v\n$$\n\u89e3\u91ca\uff1a\n\n1. \u4e3a\u4ec0\u4e48\u8981 $+a_p-a_{son}$\u3002\u56e0\u4e3a\u6211\u4eec\u5f53\u521d\u7b97 $f$ \u7684\u662f\u5019\u662f\u5f53\u5411\u4e0b\u8d70\u6765\u7b97\u7684\uff0c\u9ed8\u8ba4\u4e86\u662f\u4ece\u4e00\u4e2a\u7236\u4eb2\u8282\u70b9\u8d70\u4e0b\u6765\uff0c\u90a3\u4e48\u73b0\u5728\u8fd9\u6761\u8def\u662f\u2191\u5230 $i$ \u53c8\u2193\uff0c\u6240\u4ee5\u9700\u8981\u52a0\u4e0a\u6ca1\u6709\u7b97\u5b8c\u6574\u7684 $i$ \u7684\u6536\u76ca $a_p$\uff0c\u518d\u51cf\u53bb\u539f\u6765\u7b97\u591a\u7684 $a_{son}$\uff08\u56e0\u4e3a\u73b0\u5728\u662f\u4ece $son$ \u8d70\u8fc7\u6765\uff09\u3002\n2. \u7b2c\u4e00\u4e2a\u5f0f\u5b50\u662f $\\swarrow i\\nwarrow son$ \u7684\u60c5\u51b5\uff0c\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u662f $\\nearrow i\\searrow son$ \u7684\u60c5\u51b5\u3002\n3. \u8fd9\u4e00\u90e8\u5206\u5982\u679c\u901a\u8fc7 $\\forall0\\le j_1\\le v,0\\le j_2\\le v$ \u7684\u679a\u4e3e\u5b9e\u73b0\u590d\u6742\u5ea6 $O(v^2)$\uff0c\u96be\u4ee5\u627f\u53d7\u3002\u8003\u8651\u5012\u5e8f\uff08\u4ece $v$ \u5230 $0$\uff09\u679a\u4e3e $j_2$\uff0c*\u5b9e\u65f6*\u7528 $f(g)_{i,j_1=v-j_2,\u00d7}$ \u6765\u66f4\u65b0\u8bb0\u5f55 $\\max f(g)_{i,j_1=0\\to j_2,\u00d7}$ \u7684\u524d\u7f00\u6700\u5927\u503c\u53d8\u91cf\uff0c\u65e2\u53ef\u4ee5\u53ea\u901a\u8fc7 $O(v)$ \u6765\u89e3\u51b3\u3002\u5177\u4f53\u89c1\u4ee3\u7801\u3002\n\n\u636e\u6b64\u5df2\u7ecf\u89e3\u51b3\u4e86\u6b64\u9898\uff0c\u603b\u590d\u6742\u5ea6 $O(nv)$\uff0c\u662f\u4e00\u9053\u601d\u7ef4\u96be\u5ea6\u8f83\u5927\u7684\u6811\u5f62 DP\u3002\n\n---\n\n\u672c\u7bc7\u9898\u89e3\u53c2\u8003 @zero4338 \u7684\u9898\u89e3\uff0c\u9e23\u8c22\n\n---\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n//typedef long long ll;\nusing namespace std;\ninline int read(){\n\tregister char ch=getchar();register int x=0;\n\twhile(ch<'0'||ch>'9')ch=getchar();\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn x;\n}\nconst int N=1e5+5,V=105;\nint n,v,ans,a[N],f[N][V][2],g[N][V][2];\nvector<int>G[N];\nvoid dfs(int x,int p){\n\tf[x][0][1]=g[x][0][1]=-1e16;\n\tint sum=0;\n\tfor(int i=0;i<G[x].size();i++){\n\t\tint y=G[x][i];\n\t\tif(y==p)continue;\n\t\tdfs(y,x);\n\t\tsum+=a[y];\n\t}\n\tg[x][1][1]=sum+a[p];\n\tfor(int i=0;i<G[x].size();i++){\n\t\tint y=G[x][i];\n\t\tif(y==p)continue;\n\t\tint mxf=-1e16,mxg=-1e16;\n\t\tfor(int j=v;j>=0;j--){\n\t\t\tmxf=max(mxf,max(f[x][v-j][0],f[x][v-j][1]+a[p]-a[y])),\n\t\t\tmxg=max(mxg,max(g[x][v-j][0],g[x][v-j][1]));\n\t\t\tans=max(ans,mxg+max(f[y][j][0],f[y][j][1]));\n\t\t\tans=max(ans,mxf+max(g[y][j][0],g[y][j][1]));\n\t\t}\n\t\tfor(int j=1;j<=v;j++){\n\t\t\tf[x][j][0]=max(f[x][j][0],max(f[y][j][0],f[y][j][1])),\n\t\t\tg[x][j][0]=max(g[x][j][0],max(g[y][j][0],g[y][j][1]));\n\t\t\tf[x][j][1]=max(f[x][j][1],max(f[y][j-1][0],f[y][j-1][1])+sum),\n\t\t\tg[x][j][1]=max(g[x][j][1],max(g[y][j-1][0],g[y][j-1][1])+sum-a[y]+a[p]);\n\t\t}\n\t}\n}\nsigned main(){\n\tn=read(),v=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1,u,v;i<n;i++){\n\t\tu=read(),v=read();\n\t\tG[u].push_back(v);\n\t\tG[v].push_back(u);\n\t}\n\tdfs(1,0);\n\tcout<<ans;\n}\n```\n\n",
        "postTime": 1637151333,
        "uid": 300078,
        "name": "pengyule",
        "ccfLevel": 7,
        "title": "P4657 [CEOI2017]Chase \u96be\u9898\u6574\u7406"
    },
    {
        "content": "### \u57fa\u672c\u601d\u8def \uff1a\n\n * \u9996\u5148\u4ee4 a \u6570\u7ec4\u8868\u793a\u8be5\u70b9\u7684\u6743\u503c\uff0cc \u6570\u7ec4\u8868\u793a\u8be5\u70b9\u6240\u8fde\u63a5\u7684\u6240\u6709\u70b9\u7684\u6743\u503c\u548c\u3002\n \n * \u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86\u8be5\u70b9\u7684\u524d\u9a71\uff0c\u90a3\u8be5\u70b9\u7684\u6743\u503c\u5c31\u4e3a $ c_{now}-a_{pre} $\u3002\n \n---------\n### \u9012\u8fdb \uff1a\n\n  \u95ee\u9898\u5728\u4e8e\u8fd9\u662f\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u5b9a\u4e49\u4e00\u70b9\u4e3a\u6839\uff0c\n  \u7136\u540e\u8bbe\u4e24\u4e2a\u6570\u7ec4 $ s_{i,j} $,$ d_{i,j} $ \u5206\u522b\u8868\u793a\u4ece\u5b50\u6811 $ i $ \u4e2d\u67d0\u4e2a\u70b9\u8d70\u5230 $ i $ \u548c\u4ece $ i $ \u8d70\u5230\u5b50\u6811 $ i $ \u4e2d\u67d0\u4e2a\u70b9\uff0c\u653e\u7f6e\u4e86 $ j $ \u6b21\u7684\u6700\u5927\u6536\u76ca\u3002\u90a3\u95ee\u9898\u5c31\u53d8\u6210\u6c42\u6811\u7684\u76f4\u5f84\u4e86\u3002\n\n---------\n### \u6ce8\u610f \uff1a\n\n\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u77e5\u9053\u4e00\u4e2a\u70b9\u7684\u524d\u9a71\uff0c\u6240\u4ee5 $ s $ \u6570\u7ec4 \u662f\u8bb0\u5f55\u8be5\u5b50\u6811\u7684\u6839\u8282\u70b9\u7684\uff0c$ d $ \u6570\u7ec4 \u662f\u4e0d\u8bb0\u5f55\u8be5\u5b50\u6811\u7684\u6839\u8282\u70b9\u7684\u3002\n\n\u53e6\u5916\uff0c\u8d77\u59cb\u70b9\u4e00\u5b9a\u4f1a\u653e\u7f6e\u78c1\u94c1\uff0c\u56e0\u4e3a\u5982\u679c\u9003\u4ea1\u8005\u964d\u843d\u4e00\u4e2a\u70b9\u540e\u518d\u8dd1\u5230\u5176\u4ed6\u70b9\u653e\u7f6e\u78c1\u94c1\uff0c\u90a3\u663e\u7136\u4e0d\u5982\u76f4\u63a5\u964d\u843d\u5728\u8be5\u70b9\u653e\u7f6e\u78c1\u94c1\u66f4\u4f18\u3002\n\n\u6700\u540e\u4e00\u70b9\uff0c\u5982\u679c\u662f\u8d77\u59cb\u70b9\uff0c\u56e0\u4e3a\u5176\u6ca1\u6709\u524d\u9a71\uff0c\u6240\u4ee5\u8be5\u70b9\u7684\u8d21\u732e\u4e3a $ c_{now} $\u3002 \n\n--------\n### \u6811\u7684\u76f4\u5f84 \uff1a\n\n\u56e0\u4e3a\u6811\u7684\u8def\u5f84\u4e0d\u80fd\u91cd\u590d\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u5b8c\u4e00\u4e2a $ to $ \u8282\u70b9\u540e\u5148\u4e0e $ now $ \u7684 $ d $ \u6570\u7ec4\u548c $ s $ \u6570\u7ec4\u66f4\u65b0\u4e00\u8fb9\u7b54\u6848\uff0c\u518d\u5c06 $ to $ \u8282\u70b9\u7684\u7b54\u6848\u5408\u5e76\u5230 $ now $ \u7684\u7b54\u6848\u4e2d\u3002\n\n--------\n\n\u65f6\u95f4\u590d\u6742\u5ea6 \uff1a$ O(nv) $\n* code  \n\n```cpp\n/* \u5ff5\u5f80\u6614 */\n#include<bits/stdc++.h>\n#define re register\n#define int long long\n#define lls long long\n#define fr first\n#define sc second\n#define pb push_back\nusing namespace std;\nconst int mol=1e9+7;\nconst int maxn=1e5+10;\nconst int INF=1e9+10;\ninline int qpow(int a,int b) { int ans=1; while(b) { if(b&1) (ans*=a)%=mol; (a*=a)%=mol; b>>=1; } return ans; }\ninline int read() {\n    int w=1,s=0; char ch=getchar();\n    while(ch<'0'||ch>'9') { if(ch=='-') w=-1; ch=getchar(); }\n    while(ch>='0'&&ch<='9') { s=s*10+ch-'0'; ch=getchar(); }\n    return s*w;\n}\n\nint n,m,w[maxn],f[110][maxn],g[110][maxn],ans,maxf[110],maxg[110],as[maxn];\nstruct EDGE { int var,nxt; } edge[maxn<<1];\nint head[maxn],cnt;\ninline void add(int a,int b) { edge[++cnt]=(EDGE){ b,head[a] }; head[a]=cnt; }\ninline void dfs(int now,int fa) {\n    f[1][now]=as[now];\n    for(re int i=head[now],to;i;i=edge[i].nxt) if((to=edge[i].var)!=fa) {\n        dfs(to,now);\n        for(re int j=1;j<=m;j++) maxf[j]=max(maxf[j-1],f[j][now]); \n        for(re int j=1;j<=m;j++) maxg[j]=max(maxg[j-1],g[j][now]); \n        ans=max(ans,f[1][to]+maxg[m-1]); \n        for(re int k=2;k<=m;k++) ans=max(ans,max(f[k][to],f[k-1][to]+as[now]-w[to])+maxg[m-k]);\n        for(re int k=1;k<=m;k++) ans=max(ans,g[k][to]+maxf[m-k]);\n        for(re int k=m;k>=1;k--) {\n            f[k][now]=max(f[k][now],f[k][to]); \n            g[k][now]=max(g[k][now],g[k][to]); \n        }\n        for(re int k=m-1;k>=1;k--) if(f[k][to]) f[k+1][now]=max(f[k+1][now],f[k][to]+as[now]-w[to]);\n    }\n    for(re int i=1;i<=m;i++) ans=max(ans,f[i][now]);\n    for(re int i=m-1;i>=1;i--) if(g[i][now]) g[i+1][now]=max(g[i+1][now],g[i][now]+as[now]-w[fa]); \n    g[1][now]=max(g[1][now],as[now]-w[fa]); \n}\nsigned main(void) {\n    n=read(); m=read(); if(!m) { puts(\"0\"); return 0; }\n    for(re int i=1;i<=n;i++) w[i]=read();\n    for(re int i=1,a,b;i<n;i++) { a=read(); b=read(); add(a,b); add(b,a); as[b]+=w[a]; as[a]+=w[b]; } \n    dfs(1,0);\n    printf(\"%lld\\n\",ans);\n}\n```\n\n",
        "postTime": 1626836711,
        "uid": 464822,
        "name": "zJx_Lm",
        "ccfLevel": 0,
        "title": "P4657 Chase"
    },
    {
        "content": "[\u5b98\u65b9\u9898\u89e3](http://ceoi.inf.elte.hu/probarch/17/ceoi2017-solutions-day2.pdf)\n### \u9898\u610f\n\n\u7ed9\u51fa\u4e00\u68f5\u6811\uff0c\u6c42\u4e00\u6761\u8def\u5f84\uff0c\u9009\u62e9\u8def\u4e0a\u7684V\u4e2a\u70b9\uff0c\u4f7f\u5f97\u88ab\u9009\u62e9\u7684\u70b9\u7684**\u76f8\u90bb\u4e14\u4e0d\u5728\u8def\u5f84\u4e0a\u7684\u70b9**\u7684\u6743\u503c\u548c\u6700\u5927\u3002\n\n### \u601d\u8def\n\n#### \u5b9a\u4e49\uff1a\n$c[i][j]$\u4e3a\u4ece$i$\u70b9\u7684\u5b50\u6811\u4e2d\u8d70\u5230i\uff0c\u9009\u62e9j\u4e2a\u70b9\u7684\u6743\u503c\u548c\u3002\n\n$b[i][j]$\u4e3a\u4ece$i$\u70b9\u5f00\u59cb\uff0c\u5411\u5b50\u6811\u4e2d\u8d70\uff0c\u9009\u62e9j\u4e2a\u70b9\u7684\u6743\u503c\u548c\u3002\n\n$g[i]$\u4e3a$i$\u7684\u76f8\u90bb\u8282\u70b9\u7684\u6743\u503c\u548c\u3002\n\n$fa[i]$\u4e3a$i$\u7684\u7236\u8282\u70b9\u3002\n\n$F[i]$\u4e3a$i$\u7684\u6743\u503c\u3002\n\n#### \u521d\u59cb\u503c\uff1a\n\n$c[x][0]=0,c[x][i]=g[x]$\n\n$b[x][0]=0,b[x][i]=g[x]-F[fa[x]]$\n\n#### \u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$c[x][i]=max(c[y][i],c[y][i-1]+g[x]-F[y])$\n\n$b[x][i]=max(b[y][i],b[y][i-1]+g[x]-F[fa[x]])$\n\n### \u4ee3\u7801\n\n``` c\n#include<cstdio>\n#include<string>\n#include<cstring>\nusing namespace std;\nconst int maxn=1e5+5;\nint N,V,x,y,tot,top,F[maxn],sta[maxn];\nint son[maxn<<1],nxt[maxn<<1],lnk[maxn];\nlong long g[maxn],c[maxn][105],b[maxn][105],ans;\ninline int read() {\n\tint ret=0,f=1,ch=getchar();\n\tfor (; !isdigit(ch); ch=getchar()) if (ch=='-') f=-f;\n\tfor (; isdigit(ch); ch=getchar()) ret=ret*10+ch-48;\n\treturn ret*f;\n}\ninline void add_edge(int x,int y) {\n\tson[++tot]=y,nxt[tot]=lnk[x],lnk[x]=tot;\n\tson[++tot]=x,nxt[tot]=lnk[y],lnk[y]=tot;\n}\ninline void DP(int x,int y,int f) {\n//  ans\u4e00\u5b9a\u8981\u5728\u524d\u9762\u8d4b\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4ecey\u8d70\u5230x\u53c8\u8d70\u56dey\n\tfor (int i=1; i<=V; ++i) ans=max(ans,c[x][i]+b[y][V-i]);\n\tfor (int i=1; i<=V; ++i)\n\t\tc[x][i]=max(c[x][i],max(c[y][i],c[y][i-1]+g[x]-F[y])),\n\t\tb[x][i]=max(b[x][i],max(b[y][i],b[y][i-1]+g[x]-F[f]));\n}\nvoid dfs(int x,int pre) {\n\tfor (int i=1; i<=V; ++i) c[x][i]=g[x],b[x][i]=g[x]-F[pre];\n\tfor (int k=lnk[x]; k; k=nxt[k]) if (son[k]^pre) dfs(son[k],x),DP(x,son[k],pre);\n//  \u5bf9\u4e8e\u8282\u70b9x\uff0cy\u548cz\u662f\u5b83\u7684\u5b50\u8282\u70b9\u5e76\u4e14\uff0cy\u5148\u4e8ez\u904d\u5386\u3002\n//  \u4e0a\u9762\u7684\u65b9\u6cd5\uff0c\u65e0\u6cd5\u8ba1\u7b97z->x->y\u6240\u4ee5\u8981\u5012\u7740\u505a\u4e00\u904d\n\tfor (int i=1; i<=V; ++i) c[x][i]=g[x],b[x][i]=g[x]-F[pre];\n\ttop=0;for (int k=lnk[x]; k; k=nxt[k]) if (son[k]^pre) sta[++top]=son[k];\n\tfor (int i=top; i; --i) DP(x,sta[i],pre);\n\tans=max(ans,max(c[x][V],b[x][V]));\n}\nint main() {\n\tN=read(),V=read();\n\tfor (int i=1; i<=N; ++i) F[i]=read();\n\tfor (int i=1; i<N; ++i) add_edge(x=read(),y=read()),g[x]+=F[y],g[y]+=F[x];\n\treturn dfs(1,0),printf(\"%lld\",ans),0;\n}\n```",
        "postTime": 1534730364,
        "uid": 25545,
        "name": "ZZXB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4657 \u3010[CEOI2017]Chase\u3011"
    },
    {
        "content": "\u672c\u9898\u4e3b\u8981\u6709\u56db\u79cd\u601d\u8def\uff1a\n\n1.\u7206\u641c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n^22^n)$\uff1b\u671f\u671b\u5f97\u520620pts\u3002\n\n2.\u8d2a\u5fc3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2vlogv)$\uff1b\u671f\u671b\u5f97\u520670pts\u3002\n\n3.\u6d45\u5c42\u7684\u52a8\u6001\u89c4\u5212\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2v)$\uff1b\u671f\u671b\u5f97\u520670pts\u3002\n\n4.\u6df1\u5165\u5730\u52a8\u6001\u89c4\u5212\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(nv)$\uff1b\u671f\u671b\u5f97\u5206100\u3002\n\nemm\u2026\u2026\u65e2\u7136\u4f60\u70b9\u8fdb\u4e86\u9898\u89e3\u5927\u6982\u662f\u4e0d\u4f1a\u505a\u5427\u3002\n\n\u672c\u9898\u633a\u597d\u7684\u8fd8\u662f\u81ea\u5df1\u591a\u601d\u8003\u4e00\u4e0b\u5427\u3002\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u53e5\u8bdd\u9898\u89e3\u5e2e\u52a9\u4f60\u5927\u6982\u660e\u786e\u4e00\u4e2a\u601d\u8003\u7684\u65b9\u5411\u3002\n\n\u5982\u679c\u5b9e\u5728\u60f3\u4e0d\u51fa\u6765\uff0c[\u3010\u52a8\u6001\u89c4\u5212\u3011loj#2485. \u300cCEOI2017\u300dChase](https://www.cnblogs.com/antiquality/p/9503630.html)\u8fd9\u91cc\u6709\u8be6\u7ec6\u7684\u9898\u89e3\uff08\u6211\u7684\u535a\u5ba2\uff09\u3002\n\n",
        "postTime": 1534729768,
        "uid": 18351,
        "name": "antiquality",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4657 \u3010[CEOI2017]Chase\u3011"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u5148\u628a 1 \u53f7\u8282\u70b9\u94a6\u5b9a\u4e3a\u6839\u8282\u70b9\uff0c\u8fd9\u6837\u540e\u9762\u597d\u8ba1\u7b97\u3002\n\n\u90a3\u4e48\u8003\u8651\u8bbe\u8ba1\u52a8\u6001\u89c4\u5212\u72b6\u6001\uff0c\u53ef\u4ee5\u60f3\u5230\u5e94\u8be5\u4f7f\u7528\u6811\u5f62 DP\uff0c\u5982\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/yuql054c.png)\n\n\u4e00\u6761\u7ecf\u8fc7 $i$ \u7684\u8def\u5f84\u80af\u5b9a\u80fd\u591f\u5206\u4e3a\u4ece\u5b50\u6811\u5230 $i$ (\u5728\u56fe\u4e2d\u7bad\u5934\u5411\u4e0a) \u548c\u4ece $i$ \u5230\u5b50\u6811 (\u5728\u56fe\u4e2d\u7bad\u5934\u5411\u4e0b) \u7684\u4e24\u90e8\u5206\u3002\u4e14\u53ef\u4ee5\u5728 $i$ \u70b9\u653e\u7f6e\u78c1\u94c1\u4e5f\u53ef\u4ee5\u4e0d\u653e\uff0c\u8fd9\u4e24\u79cd\u60c5\u51b5\u662f\u4e0d\u540c\u7684\u3002\u5e76\u4e14\u8fd8\u9700\u8981\u9650\u5236\u8def\u5f84\u4e0a\u7684\u78c1\u94c1\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece\u8fd9\u51e0\u4e2a\u56e0\u7d20\u4e2d\u5f97\u5230\u72b6\u6001 $f_{i,j,0/1}$\uff0c\u8868\u793a\u4ece $i$ \u5230 $i$ \u7684\u5b50\u6811\uff0c\u653e $j$ \u4e2a\u78c1\u94c1\uff0c$i$ \u70b9\u653e/\u4e0d\u653e\u78c1\u94c1\u7684\u6700\u4f18\u7b54\u6848\u3002\u540c\u65f6\u9700\u8981\u4e00\u4e2a\u5bf9\u5e94\u7684\u72b6\u6001 $g_{i,j,0/1}$\uff0c\u8868\u793a\u4ece $i$ \u7684\u5b50\u6811\u5230 $i$\uff0c\u653e $j$ \u4e2a\u78c1\u94c1\uff0c$i$ \u70b9\u653e/\u4e0d\u653e\u78c1\u94c1\u7684\u6700\u4f18\u7b54\u6848\u3002 \n\n\u72b6\u6001\u8f6c\u79fb\uff0c\u5148\u8003\u8651 $f$ \u7684\u8f6c\u79fb\uff1a\n\n$$f_{i,j,0}=\\max_{\\text{v\u662fi\u7684\u5b50\u8282\u70b9}}\\max(f_{v,j,0},f_{v,j,1})$$\n$$f_{i,j,1}=\\max_{\\text{v\u662fi\u7684\u5b50\u8282\u70b9}}\\max(f_{v,j-1,0},f_{v,j-1,1})+s_i+a_{fa_i}-a_v$$\n\n\u5176\u4e2d\uff0c$s_i$ \u8868\u793a $i$ \u7684\u6240\u6709\u5b50\u8282\u70b9\u7684\u94c1\u7403\u6570\u91cf\u4e4b\u548c\uff0c$a_i$ \u8868\u793a $i$ \u70b9\u7684\u94c1\u7403\u6570\u3002\n\n\u89e3\u6790\uff1a\u9996\u5148 $f_{i,j,0}$ \u4e2d $i$ \u6ca1\u6709\u653e\u4e0a\u78c1\u94c1\uff0c\u6240\u4ee5\u5b50\u8282\u70b9\u5904\u7684 $j$ \u4e0d\u53d8\uff0c\u5bf9\u5b50\u8282\u70b9\u9009\u4e0d\u9009\u90fd\u6ca1\u6709\u8981\u6c42\uff0c\u6240\u4ee5\u76f4\u63a5\u53d6 $\\max$ \u5c31\u53ef\u4ee5\u3002$f_{i,j,1}$ \u4e2d $i$ \u70b9\u653e\u4e0a\u4e86\u78c1\u94c1\uff0c\u5219\u518d\u5f80\u4e0b\u7684\u5b50\u8282\u70b9\u5904\u53ea\u80fd\u653e $j-1$ \u4e2a\u78c1\u94c1\u3002\u5728 $i$ \u70b9\u653e\u78c1\u94c1\u53d6\u5f97\u7684\u4ef7\u503c\u5c31\u662f\u6240\u6709\u548c $i$ \u70b9\u6709\u8fb9\u76f8\u8fde\u7684\u70b9\u7684\u94c1\u7403\u6570 (\u5373 $s_i+a_{fa_i}$)\uff0c\u4f46\u662f\u8fd9\u91cc\u679a\u4e3e\u7684\u662f $i$ \u70b9\u521a\u521a\u4ece $v$ \u70b9\u79fb\u52a8\u8fc7\u6765\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u51cf\u53bb $v$ \u70b9\u7684\u94c1\u7403\u6570\u91cf (\u5373 $-a_v$)\uff0c\u5c31\u662f\u53d6\u5f97\u7684\u4ef7\u503c\u3002\n\n$g$ \u7684\u8f6c\u79fb\uff1a\n\n$$g_{i,j,0}=\\max_{\\text{v\u662fi\u7684\u5b50\u8282\u70b9}}\\max(g_{v,j,0},g_{v,j,1})$$\n$$g_{i,j,1}=\\max_{\\text{v\u662fi\u7684\u5b50\u8282\u70b9}}\\max(g_{v,j-1,0},g_{v,j-1,1})+s_i$$\n\n\u8fd9\u91cc $g$ \u7684\u8f6c\u79fb\u548c $f$ \u540c\u7406\uff0c\u5c31\u4e0d\u518d\u89e3\u91ca\u3002\n\n\u521d\u59cb\u5316\uff1a\n- $g_{i,1,1}=s_i+a_{fa_i}$\uff0c\u5373 $i$ \u662f\u8d77\u70b9\n- $f_{i,0,1}$ \u4e0e $g_{i,0,1}$ \u975e\u6cd5\uff0c\u521d\u59cb\u5316\u4e3a\u8d1f\u65e0\u7a77\n\n\u4f46\u662f\u8981\u7b97\u51fa\u7b54\u6848\u9700\u8981\u4fdd\u8bc1\u8def\u5f84\u4e0d\u91cd\u5408\uff0c\u4e0d\u53cd\u590d\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\u3002\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u5728\u5b50\u6811\u5185,\u7528\u8fd9\u4e2a\u5b50\u8282\u70b9\u66f4\u65b0 $i$ \u70b9\u7684\u52a8\u6001\u89c4\u5212\u503c\u4e4b\u524d\u8ba1\u7b97\u7b54\u6848\u3002\n\n$res=\\max({res,\\max{(f_{i,j_1,0},f_{i,j_1,1})+\\max{(g_{v,j_2,0},g_{v,j_2,1})}}})$\n\n$res=\\max({res,\\max{(f_{v,j_1,0},f_{v,j_1,1})+\\max{(g_{i,j_2,0},g_{i,j_2,1}+a_{fa_i}-a_v)}}})$\n\n\u8fd9\u6837\u679a\u4e3e $j_1,j_2$ \u4f1a\u8d85\u65f6\uff0c\u4f46\u662f\u53ef\u4ee5\u7528\u524d\u7f00\u6700\u5927\u503c\u6765\u89e3\u51b3\u3002\u5177\u4f53\u89c1\u4ee3\u7801\u3002\n\n------------\n### \u4ee3\u7801\n###### \u4ee3\u7801\u91cc\u6709\u6ce8\u91ca\n```cpp\n\n\n#include <cstdio>\n#include <cstring>\n#define ll long long\n\nusing namespace std;\n\nint N;\nint V;\nll F[100009];\nint h[100009];\nint nxt[200009];\nint to[200009];\nint idx;\nll f[100009][109][2]; //\u8fd9\u91cc\u7684f\u548cg\u4ee3\u8868\u7684\u610f\u4e49\u4e0e\u9898\u89e3\u4e2d\u76f8\u53cd(\nll g[100009][109][2];\nll res;\n\ninline void Add (int a, int b) {\n    nxt[idx] = h[a], to[idx] = b, h[a] = idx++;\n}\n\nvoid In () {\n    int a;\n    int b;\n\n    memset(h, -1, sizeof(h));\n    scanf(\"%d%d\", &N, &V);\n    for (int i = 1; i <= N; i++) scanf(\"%lld\", &F[i]);\n    for (int i = 1; i < N; i++) {\n        scanf(\"%d%d\", &a, &b);\n        Add(a, b), Add(b, a);\n    }\n}\n\ninline ll Max (ll a, ll b) {\n    return a > b ? a : b;\n}\n\nvoid Get_Res (int x, int p) {\n    ll s = 0;\n    int v;\n    ll sf; //\u524d\u7f00\u6700\u5927\u503c\n    ll sg;\n\n    f[x][0][1] = g[x][0][1] = -1e18; //\u521d\u59cb\u5316\n    for (int e = h[x]; ~e; e = nxt[e]) {\n        v = to[e];\n        if (v == p) continue;\n        Get_Res(v, x);\n        s += F[v]; //\u8ba1\u7b97\u5b50\u8282\u70b9\u7684\u94c1\u7403\u6570\u91cf\u548c\n    }\n    g[x][1][1] = s + F[p];\n    for (int e = h[x]; ~e; e = nxt[e]) {\n        v = to[e];\n        if (v == p) continue;\n        sf = sg = -1e18;\n        for (int j = V; j >= 0; j--) {\n            sf = Max(sf, Max(f[x][V - j][0], f[x][V - j][1] + F[p] - F[v])); //\u66f4\u65b0\u524d\u7f00\u6700\u5927\u503c\n            sg = Max(sg, Max(g[x][V - j][0], g[x][V - j][1]));\n            res = Max(res, sf + Max(g[v][j][0], g[v][j][1]));\n            res = Max(res, sg + Max(f[v][j][0], f[v][j][1]));\n        }\n        for (int j = 1; j <= V; j++) {\n            f[x][j][0] = Max(f[x][j][0], Max(f[v][j][0], f[v][j][1]));\n            f[x][j][1] = Max(f[x][j][1], Max(f[v][j - 1][0], f[v][j - 1][1]) + s);\n            g[x][j][0] = Max(g[x][j][0], Max(g[v][j][0], g[v][j][1]));\n            g[x][j][1] = Max(g[x][j][1], Max(g[v][j - 1][0], g[v][j - 1][1]) + s + F[p] - F[v]);\n        }\n    }\n}\n\nvoid Solve () {\n    Get_Res(1, 0);\n}\n\nvoid Out () {\n    printf(\"%lld\\n\", res);\n}\n\nint main () {\n\n    In();\n    Solve();\n    Out();\n\n    return 0;\n}\n```",
        "postTime": 1644226651,
        "uid": 224532,
        "name": "lyxeason",
        "ccfLevel": 5,
        "title": "[CEOI2017]Chase \u9898\u89e3"
    },
    {
        "content": "\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u7ed3\u8bba\uff0c\u5c06\u78c1\u94c1\u7528\u5b8c\u4e4b\u540e\u8fd8\u8981\u8d70\u663e\u7136\u4e0d\u4f1a\u66f4\u4f18\u79c0\uff0c\u6240\u4ee5\u7528\u5b8c\u4e86 $v$ \u4e2a\u78c1\u94c1\u5c31\u4e0d\u7528\u8d70\u4e86\u3002\n\n\u4e8e\u662f\u8003\u8651\u4e00\u4e2a\u6734\u7d20\u7684 dp \u60f3\u6cd5\u3002\u5b9a\u4e49 $dp_{u,i}$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\uff0c\u7528 $i$ \u5757\u78c1\u94c1\u7684\u6700\u5927\u7b54\u6848\u662f\u591a\u5c11\u3002\u5f53\u7136\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u679a\u4e3e\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u6574\u68f5\u6811\u7684\u6839\u3002\n\n\u5728 dp \u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u70b9\u53ea\u6709\u7528\u6216\u8005\u4e0d\u7528\u4e24\u79cd\u72b6\u6001\uff0c\u679a\u4e3e\u76f8\u8fde\u7684\u6bcf\u4e2a\u8282\u70b9\u627e\u5230\u6700\u5927\u7684\u8f6c\u79fb\uff0c\u5199\u6cd5\u548c\u601d\u8def\u6bd4\u8f83\u663e\u7136\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2v)$\u3002\n\n\u54e6\u4e0d\u8fd9\u6837\u8fd8\u62ff\u4e0d\u5230\u6ee1\u5206\u3002\u6211\u4eec\u8be5\u600e\u4e48\u529e\uff1f\n\n\u5bf9\u4e8e\u4e00\u822c\u7684\u5957\u8def\uff0c\u6211\u4eec\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u95ee\u9898\u8fc7\u5927\u662f\u56e0\u4e3a\u6211\u4eec\u679a\u4e3e\u4e86\u6bcf\u4e2a\u6839\u3002\u90a3\u8981\u662f\u6211\u4eec\u4e0d\u679a\u4e3e\u6839\u5462\uff1f\n\n\u8003\u8651\u6700\u7ec8\u7b54\u6848\uff0c\u53ef\u4ee5\u628a\u5176\u770b\u4e3a\u4e00\u6761\u5728\u4ee5 $1$ \u4e3a\u6839\u7684\u6811\u4e0a\u7684\u94fe\u3002\u5047\u8bbe\u73b0\u5728\u6211\u4eec\u5230\u4e86\u904d\u5386\u5230\u8fd9\u6761\u94fe\u4e0a\u7684\u67d0\u4e00\u4e2a\u70b9\uff0c\u6709\u54ea\u4e9b\u60c5\u51b5\u5462\uff1f\n\n- \u5728\u4e0d\u5b58\u5728\u70b9\u7684\u6df1\u5ea6\u6bd4\u8fd9\u4e2a\u70b9\u6df1\u5ea6\u5927\u7684\u70b9\u4e0a\uff0c\u94fe\u4e00\u76f4\u5f80\u4e0b\u5ef6\u4f38\uff1b   \n- \u5728\u4e0d\u5b58\u5728\u70b9\u7684\u6df1\u5ea6\u6bd4\u8fd9\u4e2a\u70b9\u6df1\u5ea6\u5c0f\u7684\u70b9\u4e0a\uff0c\u94fe\u4e00\u76f4\u5f80\u4e0a\u5ef6\u4f38\uff1b   \n- \u5728\u67d0\u4e2a\u70b9\u4e0a\uff0c\u4f7f\u5f97\u5b58\u5728\u70b9\u7684\u6df1\u5ea6\u6bd4\u8fd9\u4e2a\u70b9\u6df1\u5ea6\u5927\uff0c\u540c\u65f6\u5b58\u5728\u70b9\u7684\u6df1\u5ea6\u6bd4\u8fd9\u4e2a\u70b9\u6df1\u5ea6\u5c0f\uff0c\u94fe\u6709\u5f80\u4e0a\u5ef6\u4f38\u7684\uff0c\u4e5f\u6709\u5f80\u4e0b\u5ef6\u4f38\u7684\u3002\n\n\u6211\u4eec\u53d1\u73b0\u4e0a\u9762\u4e24\u79cd\u60c5\u51b5\u6bd4\u8f83\u597d\u5904\u7406\uff0c\u5dee\u4e0d\u591a\u8ddf\u6211\u4eec\u5f00\u59cb\u60f3\u7684 $O(n^2v)$ \u7684 dp \u5dee\u4e0d\u591a\u7684\uff08\u8fd9\u90e8\u5206\u662f $O(nv)$ \u7b97\uff01\uff09\u3002\u4f46\u662f\u7b2c\u4e09\u79cd\u60c5\u51b5\u600e\u4e48\u5904\u7406\uff1f\n\n\u5c06\u7b54\u6848\u4e0a\u7684\u94fe\u4e0a\u7684\u4e00\u4e2a\u70b9 $s$ \u5220\u53bb\uff0c\u73b0\u5728\u5c31\u53d8\u6210\u4e86\u4e24\u6761\u94fe\uff0c\u521a\u597d\u662f $s$ \u5f80\u4e0b\u5ef6\u4f38\u7684\u94fe\u548c $s$ \u5f80\u4e0a\u5ef6\u4f38\u7684\u94fe\u3002\n\n\u800c\u6211\u4eec\u4e4b\u524d\u7684\u4e24\u4e2a\u4e1c\u897f\u5df2\u7ecf\u53ef\u4ee5\u7b97\u51fa\u6765\u4e86\uff0c\u4e8e\u662f\u4e24\u6761\u94fe\u7684\u8d21\u732e\u5408\u5e76\u8d77\u6765\u5c31\u80fd\u5f97\u5230\u6700\u7ec8\u7b54\u6848\u3002\n\n\u7efc\u4e0a\uff0c\u5b9a\u4e49 $dp_{u,i,x=0 \\operatorname{or} 1}$ \u4e3a\u82e5 $x=0$\uff0c\u5219\u662f\u4ece $u$ \u7684\u5b50\u6811\u7684\u67d0\u4e2a\u70b9\u5411\u4e0a\u7528\u4e86 $i$ \u4e2a\u78c1\u94c1\u8d70\u5230 $u$\uff1b\u5426\u5219\u5219\u662f\u4ece\u67d0\u4e2a\u8282\u70b9\u5411\u4e0b\u8d70\u4e86\u82e5\u5e72\u6b65\u7528\u4e86 $i$ \u4e2a\u78c1\u94c1\u8d70\u5230 $u$ \u7684\u7b54\u6848\u3002\u6bcf\u6b21\u52a0\u5165\u4e00\u68f5\u5b50\u6811\uff0c\u5148\u66f4\u65b0\u4e24\u6761\u94fe\u5408\u5e76\u8d77\u6765\u7684\u7b54\u6848\uff0c\u518d\u66f4\u65b0 dp \u6570\u7ec4\u3002\n\n\u5b9e\u9645\u4ee3\u7801\u5e76\u4e0d\u662f\u5f88\u96be\u5199\u3002\u4ee3\u7801\u5e26\u6ce8\u91ca\u3002\u81f3\u5c11\u5728 2020/8/23 10:55 \u4e4b\u524d\u662f\u6700\u4f18\u89e3\u5427\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nchar buf[1<<21],*p1=buf,*p2=buf;\n#define getchar() (p1==p2 && (p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nLL read()\n{\n\tLL x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0' || c>'9')\n\t{\n\t\tif(c=='-')\tf=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0' && c<='9')\tx=(x<<1)+(x<<3)+(c^'0'),c=getchar();\n\treturn x*f;\n}\nvoid write(LL x)\n{\n\tif(x<0)\tputchar('-'),x=-x;\n\tif(x>9)\twrite(x/10);\n\tputchar(x%10+'0');\n}\nvector<LL> G[100005];\nLL n,v,a[100005],dp[100005][105][2],sum[100005],ans;\nvoid dfs(LL now,LL pre)\n{\n\tfor(LL i=1;i<=v;++i)\tdp[now][i][0]=sum[now],dp[now][i][1]=sum[now]-a[pre];\n\tfor(unsigned int i=0;i<G[now].size();++i)\n\t{\n\t\tLL to=G[now][i];\n\t\tif(to==pre)\tcontinue;\n\t\tdfs(to,now);\n\t\tfor(LL i=1;i<v;++i)\tans=max(ans,dp[now][i][0]+dp[to][v-i][1]);//\u5408\u5e76\u4e24\u6761\u94fe\uff0c\u66f4\u65b0\u7b54\u6848\u3002\n\t\tfor(LL i=1;i<=v;++i)\n\t\t{\n\t\t\tdp[now][i][0]=max(dp[now][i][0],max(dp[to][i][0],dp[to][i-1][0]+sum[now]-a[to]));\n\t\t\tdp[now][i][1]=max(dp[now][i][1],max(dp[to][i][1],dp[to][i-1][1]+sum[now]-a[pre]));\n\t\t}\n\t\t//\u5408\u5e76\u5b50\u6811\uff0c\u66f4\u65b0 dp \u503c\u3002\n\t}\n\tfor(LL i=1;i<=v;++i)\tdp[now][i][0]=sum[now],dp[now][i][1]=sum[now]-a[pre];\n\tfor(unsigned int i=G[now].size()-1;~i;--i)//\u904d\u5386\u987a\u5e8f\u53ef\u80fd\u4f1a\u5f71\u54cd\u7b54\u6848\uff0c\u4e8e\u662f\u518d\u5012\u7740\u52a0\u5165\u5b50\u6811\u8ba1\u7b97\u3002\n\t{\n\t\tLL to=G[now][i];\n\t\tif(to==pre)\tcontinue;\n\t\tfor(LL i=1;i<v;++i)\tans=max(ans,dp[now][i][0]+dp[to][v-i][1]);\n\t\tfor(LL i=1;i<=v;++i)\n\t\t{\n\t\t\tdp[now][i][0]=max(dp[now][i][0],max(dp[to][i][0],dp[to][i-1][0]+sum[now]-a[to]));\n\t\t\tdp[now][i][1]=max(dp[now][i][1],max(dp[to][i][1],dp[to][i-1][1]+sum[now]-a[pre]));\n\t\t}\n\t}\n\tans=max(ans,max(dp[now][v][0],dp[now][v][1]));//\u7edf\u8ba1\u4e00\u76f4\u5f80\u4e0a\u7528 v \u4e2a\u78c1\u94c1\u548c\u5f80\u4e0b\u7528 v \u4e2a\u78c1\u94c1\u7684\u7b54\u6848\u3002\n}\nint main(){\n\tn=read(),v=read();\n\tfor(LL i=1;i<=n;++i)\ta[i]=read();\n\tfor(LL i=1;i<n;++i)\n\t{\n\t\tLL p=read(),q=read();\n\t\tG[p].push_back(q);\n\t\tG[q].push_back(p);\n\t\tsum[p]+=a[q];\n\t\tsum[q]+=a[p];\n\t}\n\tdfs(1,0);\n\twrite(ans);\n\treturn 0;\n}\n```",
        "postTime": 1598152221,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4657 \u3010[CEOI2017]Chase\u3011"
    },
    {
        "content": "\u6076\u5fc3\u7684\u6811\u5f62 dp\u3002\u3002\u3002wtcl\n\n\u8003\u8651\u679a\u4e3e\u4e2d\u8f6c\u70b9\uff0c\u4e5f\u5c31\u662f\u9003\u4ea1\u8005\u8d70\u7684\u8def\u5f84\u6df1\u5ea6\u6700\u6d45\u7684\u70b9 LCA\u3002\u5206\u522b\u7528 $dp[x][i]$ \u548c $f[x][i]$ \u8868\u793a\u4ece $x$ \u70b9\u5411\u4e0b\u548c\u4ece\u67d0\u4e2a\u70b9\u5411\u4e0a\u5230 $x$ \u70b9\uff0c\u4e14\u7528\u4e86 $i$ \u5757\u78c1\u94c1\u6700\u591a\u80fd\u5bf9\u7b54\u6848\u6709\u591a\u5c11\u8d21\u732e\u3002\n\n\u8f6c\u79fb\u7684\u8bdd\u5c31\u76f4\u63a5\u5bf9\u4e8e\u4e00\u4e2a\u4e2d\u8f6c\u70b9\u7684\u6bcf\u4e2a\u513f\u5b50\uff0c\u6b63\u5e8f\u4e00\u904d\u9006\u5e8f\u4e00\u904d\u5373\u53ef\u3002\n\n\u5177\u4f53\u5c31\u662f\u5148\u8003\u8651\u513f\u5b50\u4ece\u8003\u5de6\u8fb9\u4e0a\u5230 $x$ \u70b9\uff0c\u7136\u540e\u518d\u4ece $x$ \u8d70\u5230\u9760\u53f3\u8fb9\u7684\u70b9\u4e0b\u53bb\uff0c\u4e5f\u5c31\u662f\u5de6\u4e0a\u53f3\u4e0b\u6216\u8005\u53f3\u4e0a\u5de6\u4e0b\u3002\n\n\u8f6c\u79fb\u7684\u8bdd\u76f4\u63a5\u6811\u4e0a\u80cc\u5305\u4e00\u4e0b\u5373\u53ef\n\n```\ndp[x][j]=max(dp[x][j],max(dp[y][j],dp[y][j-1]+s[x]-a[y]));\n\nf[x][j]=max(f[x][j],max(f[y][j],f[y][j-1]+s[x]-a[fa_]));\n```\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long \nusing namespace std;\nconst int NR=1e5+10;\nconst int MR=105;\nvoid Min(int& x,int y){x=min(x,y);}\nvoid Max(int& x,int y){x=max(x,y);}\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nint n,v;\nint a[NR];\nll s[NR],ans;\nint to[NR<<1],nxt[NR<<1],head[NR],tot=1;\nvoid add(int x,int y){\n\tto[tot]=y,nxt[tot]=head[x],head[x]=tot++;\n}\nint st[NR];\nll dp[NR][MR],f[NR][MR];\nvoid dfs(int x,int fa_)\n{\n\tfor(int i=1;i<=v;i++)dp[x][i]=s[x],f[x][i]=s[x]-a[fa_];\n\tfor(int i=head[x];i;i=nxt[i])\n\t{\n\t\tint y=to[i];if(y==fa_)continue;dfs(y,x);\n\t\tfor(int j=0;j<=v;j++)ans=max(ans,dp[x][j]+f[y][v-j]);\n\t\tfor(int j=1;j<=v;j++){\n\t\t\tdp[x][j]=max(dp[x][j],max(dp[y][j],dp[y][j-1]+s[x]-a[y]));\n\t\t\tf[x][j]=max(f[x][j],max(f[y][j],f[y][j-1]+s[x]-a[fa_]));\n\t\t}\n\t}int tt=0;\n\tfor(int i=1;i<=v;i++)dp[x][i]=s[x],f[x][i]=s[x]-a[fa_];\n\tfor(int i=head[x];i;i=nxt[i])if(to[i]!=fa_)st[++tt]=to[i];\n\tfor(int i=tt;i>=1;i--)\n\t{\n\t\tint y=st[i];\n\t\tfor(int j=0;j<=v;j++)ans=max(ans,dp[x][j]+f[y][v-j]);\n\t\tfor(int j=1;j<=v;j++){\n\t\t\tdp[x][j]=max(dp[x][j],max(dp[y][j],dp[y][j-1]+s[x]-a[y]));\n\t\t\tf[x][j]=max(f[x][j],max(f[y][j],f[y][j-1]+s[x]-a[fa_]));\n\t\t}\n\t}\n}\nint main()\n{\n\tn=read(),v=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<n;i++){\n\t\tint x=read(),y=read();\n\t\ts[x]+=a[y],s[y]+=a[x],add(x,y),add(y,x);\n\t}\n\tdfs(1,0);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1625554750,
        "uid": 97136,
        "name": "chenzida",
        "ccfLevel": 0,
        "title": "[CEOI2017]Chase"
    },
    {
        "content": "\u9996\u5148\u975e\u5e38\u663e\u7136\u7684\u5c31\u662f\uff0c\u8fd9\u4e9b\u623f\u95f4\u8fde\u6210\u4e00\u68f5\u6811\uff0c\u800c\u4e14\u662f\u4e00\u68f5\u65e0\u6839\u6811\u3002\u5047\u5b9a\u70b9x\n\u662f\u6839\uff0c\u90a3\u4e48\u9003\u4ea1\u8005\u7684\u8def\u5f84\u5c31\u662f\u4ecex\n\u7684\u5b50\u6811\u91cc\u9009\u4e00\u4e2a\u70b9\uff0c\u5f80\u8fd9\u4e2a\u70b9\u8d70\u3002\u7136\u540e\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u76f4\u5230\u4ed6\u9009\u62e9\u4e00\u4e2a\u70b9\u79bb\u5f00\u8ff7\u5bab\u3002\n\u6240\u4ee5\u4e00\u4e2a\u663e\u7136\u7684\u6811\u5f62DP\u5c31\u662f\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\u505a\u6839\uff0c\u7136\u540e\u4ee5\u8fd9\u4e2a\u6839\u5411\u4e0bDP\uff0c\u6c42\u51fa\u6254\u4e0bv\n\u4e2a\u78c1\u94c1\u6240\u80fd\u83b7\u5f97\u7684\u6700\u5927\u94c1\u7403\u5dee\u5f02\u503c\u3002\n\u5f53\u7136\u6211\u4eec\u9700\u8981\u660e\u786e\uff0c\u94c1\u7403\u7684\u5dee\u5f02\u662f\u5982\u4f55\u4ea7\u751f\u7684\u3002\u5f53\u6211\u4eec\u5728\u6811\u4e0ax\n\u70b9\u6254\u4e0b\u4e00\u4e2a\u78c1\u94c1\uff0c\u90a3\u4e48\u5dee\u5f02\u662f\u8fd9\u4e2a\u70b9\u7684\u6240\u6709\u513f\u5b50\u7684\u6743\u503c\u548c\uff08\u4e3a\u4ec0\u4e48\u6ca1\u6709\u5b83\u81ea\u5df1\u548c\u5b83\u7236\u4eb2\uff1f\u56e0\u4e3a\u8fd9\u4e9b\u70b9\u90fd\u662f\u5148\u8d70\u7684\uff0c\u6216\u8005\u8fd9\u4e9b\u70b9\u88ab\u4e4b\u524d\u7684\u70b9\u5438\u5f15\u4e86\uff0c\u5e76\u4e0d\u53ef\u80fd\u589e\u52a0\u5f53\u524d\u70b9\u7684\u8d21\u732e\uff09\u3002\n\u6240\u4ee5\u8fd9\u4e2a\u6811\u5f62DP\u5f88\u7b80\u5355\uff0c\u7136\u800c\u590d\u6742\u5ea6\u662f\u8fc7\u4e0d\u53bb\u7684\u3002\u53ea\u80fd\u62ff70\u5206\u3002\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 100005\n#define ll long long\nusing namespace std;\nchar tc(){\n    static char fl[100000],*A=fl,*B=fl;\n    return A==B&&(B=(A=fl)+fread(fl,1,100000,stdin),A==B)?EOF:*A++;\n}\nll read(){\n    char c;ll x=0,y=1;while(c=tc(),(c<'0'||c>'9')&&c!='-');\n    if(c=='-') y=-1;else x=c-'0';while(c=tc(),c>='0'&&c<='9')\n    x=x*10+c-'0';return x;\n}\nll ans,f[MAXN][105];\nint n,v,cnt,val[MAXN],head[MAXN<<1],nxt[MAXN<<1],go[MAXN<<1],vis[MAXN];\nvoid add(ll x,ll y){\n    go[cnt]=y;nxt[cnt]=head[x];head[x]=cnt;cnt++;\n    go[cnt]=x;nxt[cnt]=head[y];head[y]=cnt;cnt++;\n}\nll rise(int x,int v){\n    if(v==0) return 0;\n    if(f[x][v]) return f[x][v];\n    ll res=0,out=0;vis[x]=1;\n    register int i;\n    for(i=head[x];i!=-1;i=nxt[i]){\n        int to=go[i];\n        if(vis[to]) continue;\n        res+=val[to];\n    }\n    for(i=head[x];i!=-1;i=nxt[i]){\n        int to=go[i];\n        if(vis[to]) continue;\n        out=max(out,res+rise(to,v-1));\n    }\n    for(i=head[x];i!=-1;i=nxt[i]){\n        int to=go[i];\n        if(vis[to]) continue;\n        out=max(out,rise(to,v));\n    }\n    vis[x]=0;f[x][v]=out;\n    return f[x][v];\n}\nint main()\n{\n    n=read();v=read();\n    register int i,j,k;\n    memset(head,-1,sizeof(head));\n    for(i=1;i<=n;i++) val[i]=read();\n    for(i=1;i<n;i++){\n        ll x=read(),y=read();\n        add(x,y);\n    }\n    if(n<=1000){  //\u8fd9\u4e2a\u662f\u6839\u636e\u6570\u636e\u7279\u5224\n        for(i=1;i<=n;i++){\n            for(j=1;j<=n;j++) vis[j]=0;\n            for(j=1;j<=n;j++)\n             for(k=1;k<=v;k++) f[j][k]=0;\n            ans=max(ans,rise(i,v));\n        }\n        printf(\"%lld\\n\",ans);\n        return 0;\n    }\n    printf(\"%lld\",rise(1,v));  //\u7531\u4e8e\u4fdd\u8bc1\u670930\u5206\u4ece1\u5f00\u59cb\uff0c\u6240\u4ee5\u76f4\u63a5\u4ee51\u4e3a\u6839\u505a\n    return 0;\n}```\n\n\n\u65e2\u7136\u6211\u4eec\u8981\u4ee5\u6bcf\u4e00\u4e2a\u70b9\u4e3a\u6839\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5b9a1\u4e3a\u5047\u6839\uff0c\u7136\u540e\u7528\u4e00\u79cd\u7c7b\u4f3c\u70b9\u5206\u6cbb\u7684\u601d\u8def\uff0c\u53bb\u8ba1\u7b97\u5b83\u7684\u513f\u5b50\u7684\u7b54\u6848\u3002\uff08\u5b9e\u9645\u4e0a\u5c31\u662f\u4ee5\u513f\u5b50\u4e3a\u6839\u7684\u7b54\u6848\uff09\uff0c\u6211\u4eec\u8bbeup[x][i]\u8868\u793a\u4ece\u67d0\u70b9\u51fa\u53d1\uff0c\u6254\u51fai\u4e2a\u78c1\u94c1\uff0c\u6700\u7ec8\u5230\u8fbex\u7684\u6700\u5927\u5dee\u5f02\u503c\uff0c\u800cdown[x][i]\u8868\u793a\u4ecex\u51fa\u53d1\uff0c\u6254\u4e0bi\u4e2a\u78c1\u94c1\u6240\u80fd\u83b7\u5f97\u7684\u6700\u5927\u5dee\u5f02\u503c\u3002\n\u90a3\u4e48\u6211\u4eec\u663e\u7136\u53ef\u4ee5\u5199\u51fa\u8f6c\u79fb\uff1a\n\n```cpp\nfor(int j=1;j<=v;j++) up[x][j]=max(up[x][j],up[to][j]),down[x][j]=max(down[x][j],down[to][j]);\nfor(int j=1;j<=v;j++){\n    up[x][j]=max(up[x][j],up[to][j-1]+deg[x]-val[to]);  //up\u4ece\u4e0b\u5f80\u4e0a\uff0c\u6240\u4ee5\u5e94\u8be5\u51cf\u53bb\u4e0b\u9762\u7684\u70b9\u3002\n    down[x][j]=max(down[x][j],down[to][j-1]+deg[x]-val[fa[x]]);  //down\u4ece\u4e0a\u5f80\u4e0b\uff0c\u6240\u4ee5\u51cf\u53bb\u7236\u4eb2\n}\n```\n\u4f46\u662f\u6211\u4eec\u8981\u53bb\u91cd\uff0c\u56e0\u4e3a\u5982\u679c\u4e0d\u53bb\u91cd\uff0c\u53ef\u80fdup\u548cdown\u8d70\u7684\u662f\u540c\u4e00\u4e2a\u513f\u5b50\uff0c\u90a3\u4e48\u8fd9\u6837\u5c31\u8fdd\u53cd\u4e86\u9898\u76ee\u6bcf\u6761\u8fb9\u53ea\u80fd\u8d70\u4e00\u6b21\u7684\u89c4\u5b9a\u3002\u4e8e\u662f\u6211\u4eec\u5728\u5faa\u73af\u7684\u65f6\u5019\u5148\u66f4\u65b0\u7b54\u6848\uff0c\u518d\u66f4\u65b0up\u548cdown\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\nfor(int i=head[x];i!=-1;i=nxt[i]){\n    int to=go[i];\n    if(fa[x]==to) continue;sta[++top]=to;  //sta\u8fd9\u53e5\u8bdd\u548c\u76ee\u524d\u65e0\u5173\uff0c\u53ef\u4ee5\u65e0\u89c6\n    for(int j=1;j<v;j++) ans=max(ans,up[x][j]+down[to][v-j]);  //\u5148\u66f4\u65b0\uff0c\u5c31\u80fd\u4fdd\u8bc1\u4e0d\u4f1a\u91cd\u590d\n    for(int j=1;j<=v;j++) up[x][j]=max(up[x][j],up[to][j]),down[x][j]=max(down[x][j],down[to][j]);\n    for(int j=1;j<=v;j++){\n        up[x][j]=max(up[x][j],up[to][j-1]+deg[x]-val[to]);\n        down[x][j]=max(down[x][j],down[to][j-1]+deg[x]-val[fa[x]]);\n    }\n}\nans=max(ans,max(down[x][v],up[x][v]));\n```\n\u4f46\u662f\u6211\u4eec\u8fd8\u5f97\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u6bd4\u5982\u6211\u4eec\u4eceu\n\u8d70\u4e0ax\n,\u518d\u4ecex\n\u8d70\u4e0bv\n\uff0c\u8fd9\u6837\u7684\u7b54\u6848\u548c\u4ecev\n\u8d70\u4e0ax\n\uff0c\u518d\u4ecex\n\u8d70\u4e0bu\n\u7684\u5927\u7b54\u6848\u662f\u4e0d\u4e00\u6837\u7684\u3002\u800c\u6211\u4eec\u4e0a\u9762\u7684\u7edf\u8ba1\u7531\u4e8e\u4e3a\u4e86\u53bb\u91cd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6211\u4eec\u5339\u914dup\u548cdown\u65f6up\u8d70\u7684\u5b50\u6811\u80af\u5b9a\u5728down\u5de6\u8fb9\u3002\u4f46\u5982\u679c\u5728\u53f3\u8fb9\u600e\u4e48\u529e\uff1f\u6211\u4eec\u628ax\n\u7684\u5b50\u6811\u987a\u5e8f\u524d\u540e\u7ffb\u8f6c\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u4f7f\u5339\u914d\u65f6up\u8d70\u7684\u5b50\u6811\u5728down\u53f3\u8fb9\u3002\u8fd9\u6837\u64cd\u4f5c\u5c31\u53ef\u4ee5\u7edf\u8ba1\u6240\u6709\u7684\u7b54\u6848\u3002\n\u6211\u4eec\u5728\u4ee3\u7801\u91cc\u7528\u4e00\u4e2a\u6808\u6765\u64cd\u4f5c\u3002\u4e0a\u6587\u7684sta\u5c31\u662f\u5c06\u6240\u6709\u513f\u5b50\u653e\u5728\u6808\u91cc\u3002\u6700\u540e\u7edf\u8ba1\u53f3\u8fb9\u7684\u65f6\u5019\u5c31\u5012\u7740\u679a\u4e3e\u6808\u5373\u53ef\u3002\n```cpp\nwhile(top){\n    int to=sta[top--];\n    for(int j=1;j<v;j++) ans=max(ans,up[x][j]+down[to][v-j]);\n    for(int j=1;j<=v;j++) up[x][j]=max(up[x][j],up[to][j]),down[x][j]=max(down[x][j],down[to][j]);\n    for(int j=1;j<=v;j++){\n        up[x][j]=max(up[x][j],up[to][j-1]+deg[x]-val[to]);\n        down[x][j]=max(down[x][j],down[to][j-1]+deg[x]-val[fa[x]]);\n    }\n}\nans=max(ans,max(down[x][v],up[x][v]));\n```\n\u4e0b\u9762\u662f\u5b8c\u6574\u7684\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 100005\n#define ll long long\nusing namespace std;\nint read(){\n    char c;int x;while(c=getchar(),c<'0'||c>'9');x=c-'0';\n    while(c=getchar(),c>='0'&&c<='9') x=x*10+c-'0';return x;\n}\nint n,v,cnt,val[MAXN],head[MAXN<<1],nxt[MAXN<<1],go[MAXN<<1],fa[MAXN],sta[MAXN],top;\nll up[MAXN][105],down[MAXN][105],ans,deg[MAXN];\nvoid add(int x,int y){\n    go[cnt]=y;nxt[cnt]=head[x];head[x]=cnt;cnt++;\n    go[cnt]=x;nxt[cnt]=head[y];head[y]=cnt;cnt++;\n}\nvoid dfs(int x){\n    for(int i=1;i<=v;i++) up[x][i]=deg[x],down[x][i]=deg[x]-val[fa[x]];\n    for(int i=head[x];i!=-1;i=nxt[i]){\n        int to=go[i];\n        if(fa[x]==to) continue;\n        fa[to]=x;dfs(to);\n    }\n    for(int i=head[x];i!=-1;i=nxt[i]){\n        int to=go[i];\n        if(fa[x]==to) continue;sta[++top]=to;\n        for(int j=1;j<v;j++) ans=max(ans,up[x][j]+down[to][v-j]);\n        for(int j=1;j<=v;j++) up[x][j]=max(up[x][j],up[to][j]),down[x][j]=max(down[x][j],down[to][j]);\n        for(int j=1;j<=v;j++){\n            up[x][j]=max(up[x][j],up[to][j-1]+deg[x]-val[to]);\n            down[x][j]=max(down[x][j],down[to][j-1]+deg[x]-val[fa[x]]);\n        }\n    }\n    ans=max(ans,max(down[x][v],up[x][v]));\n    for(int i=1;i<=v;i++) up[x][i]=deg[x],down[x][i]=deg[x]-val[fa[x]];\n    while(top){\n        int to=sta[top--];\n        for(int j=1;j<v;j++) ans=max(ans,up[x][j]+down[to][v-j]);\n        for(int j=1;j<=v;j++) up[x][j]=max(up[x][j],up[to][j]),down[x][j]=max(down[x][j],down[to][j]);\n        for(int j=1;j<=v;j++){\n            up[x][j]=max(up[x][j],up[to][j-1]+deg[x]-val[to]);\n            down[x][j]=max(down[x][j],down[to][j-1]+deg[x]-val[fa[x]]);\n        }\n    }\n    ans=max(ans,max(down[x][v],up[x][v]));\n}\nint main()\n{\n    n=read();v=read();\n    memset(head,-1,sizeof(head));\n    for(int i=1;i<=n;i++) val[i]=read();\n    for(int i=1;i<n;i++){\n        int x=read(),y=read();\n        add(x,y);deg[x]+=val[y];deg[y]+=val[x];\n    }\n    dfs(1);\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1534729611,
        "uid": 26880,
        "name": "XUCHENGHUI",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4657 \u3010[CEOI2017]Chase\u3011"
    }
]