[
    {
        "content": "KM\u7b97\u6cd5\u9898\u89e3\u3002\n\n\u9996\u5148\uff0c\u201c\u4e0d\u80fd\u51fa\u73b0\u591a\u9897\u68cb\u5b50\u540c\u65f6\u5728\u67d0\u4e00\u683c\u7684\u60c5\u51b5\u201d\u6761\u4ef6\u6ca1\u6709\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u8def\u5f84\u987a\u5e8f\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002\n\n\u8003\u8651\u9884\u5904\u7406\u6240\u6709\u8d77\u59cb\u70b9\u548c\u76ee\u6807\u70b9\u7684\u8ddd\u79bb\uff0c\u7528BFS\u5b9e\u73b0\uff0c\u5e94\u8be5\u90fd\u4f1a\u5427\u3002\u4e4b\u540e\u5c31\u662f\u88f8\u7684\u4e8c\u5206\u56fe\u6700\u5c0f\u6743\u5339\u914d\u4e86\uff0c\u6c42\u51fa\u6240\u6709\u8d77\u59cb\u70b9\u5230\u6240\u6709\u7ec8\u70b9\u7684\u6700\u5c0f\u6743\u5339\u914d\uff0c\u5c06\u8fb9\u6743\u53d6\u76f8\u53cd\u6570\u76f4\u63a5\u8dd1KM\u5373\u53ef\uff0c\u6b64\u5904\u7528BFS\u7248KM\u4fdd\u8bc1\u65f6\u95f4\u590d\u6742\u5ea6\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(k^{3}+knm)$\uff0c\u8f7b\u677eAC\u3002\n\n```cpp\n#include<cstdio>\n#include<cstring>\nconst int N=109,M=509;\nchar mp[N][N];\nint d[N][N],qx[N*N],qy[N*N],n,m,k,a,b,sx[M],sy[M],tx[M],ty[M],lx[M],ly[M],sl[M],w[M][M],mt[M],p[M];\nbool f[M];\nint main(){\n\tregister int i,j,l,x,y,u,v,h,t;\n\tscanf(\"%d%d%d%d%d\",&n,&m,&k,&a,&b),memset(lx,-9,sizeof(lx));\n\tregister int nx[9]={a,a,-a,-a,b,b,-b,-b},ny[9]={b,-b,b,-b,a,-a,a,-a};\n\tfor(i=1;i<=n;++i)scanf(\"%s\",mp[i]+1);\n\tfor(i=1;i<=k;++i)scanf(\"%d%d\",sx+i,sy+i);\n\tfor(i=1;i<=k;++i)scanf(\"%d%d\",tx+i,ty+i);\n\tfor(i=1;i<=k;++i){\n\t\th=0,t=1,qx[1]=sx[i],qy[1]=sy[i],memset(d,9,sizeof(d)),d[sx[i]][sy[i]]=0;\n\t\twhile(h!=t){\n\t\t\tu=qx[++h],v=qy[h];\n\t\t\tfor(j=0;j<8;++j){\n\t\t\t\tx=u+nx[j],y=v+ny[j];\n\t\t\t\tif(x>0&&y>0&&x<=n&&y<=m&&mp[x][y]=='.'&&d[x][y]>1e8)d[x][y]=d[u][v]+1,qx[++t]=x,qy[t]=y;\n\t\t\t}\n\t\t}\n\t\tfor(j=1;j<=k;++j)w[i][j]=-d[tx[j]][ty[j]],lx[i]=lx[i]>w[i][j]?lx[i]:w[i][j];\n\t}//BFS\u9884\u5904\u7406\u8ddd\u79bb\n\tfor(i=1;i<=k;++i){\n\t\tmemset(sl,9,sizeof(sl)),memset(f,0,sizeof(f));\n\t\tfor(mt[j=0]=i;mt[j];j=u){\n\t\t\tf[j]=1,l=1e8,x=mt[j];\n\t\t\tfor(y=1;y<=k;++y)if(!f[y]){\n\t\t\t\tv=lx[x]+ly[y]-w[x][y];\n\t\t\t\tif(v<sl[y])sl[y]=v,p[y]=j;\n\t\t\t\tif(l>sl[y])l=sl[y],u=y;\n\t\t\t}\n\t\t\tfor(y=0;y<=k;++y)if(f[y])lx[mt[y]]-=l,ly[y]+=l;else sl[y]-=l;\n\t\t}\n\t\twhile(j)mt[j]=mt[p[j]],j=p[j];\n\t}//KM\u6700\u5c0f\u6743\u5339\u914d\n\tfor(l=0,i=1;i<=k;++i)l-=lx[i]+ly[i];\n\tprintf(\"%d\",l);\n\treturn 0;\n}\n```\n",
        "postTime": 1580188552,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P2499 \u3010[SDOI2012]\u8c61\u68cb\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u79cd\u65b9\u6848\uff0c\u4e00\u5b9a\u6709\u4e00\u79cd\u8c03\u6574\u7684\u529e\u6cd5\u4f7f\u5f97\u4e24\u4e2a\u68cb\u5b50\u4efb\u610f\u65f6\u523b\u4e0d\u5728\u540c\u4e00\u70b9\u3002\n\n\u4f60\u53ef\u4ee5\u8003\u8651\u611f\u6027\u8bc1\u660e\uff1a\u5982\u679c\u4e00\u4e2a\u4eba\u65e0\u8def\u53ef\u8d70\uff0c\u90a3\u4e48\u5835\u5b83\u7684\u4eba\u4e00\u5b9a\u53ef\u4ee5\u5148\u8d70\uff0c\u5426\u5219\u8fd8\u4e0d\u5982\u76f4\u63a5\u505c\u3002\n\n\u6240\u4ee5\u8bf4\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u7ed9\u4f60\u5de6\u8fb9 $k$ \u4e2a\u70b9\uff0c\u53f3\u8fb9 $k$ \u4e2a\u70b9\uff0c\u4efb\u610f\u4e24\u70b9\u6709\u8fde\u8fb9\uff0c\u6c42\u4e00\u4e2a\u6700\u5927\u6743\u5b8c\u7f8e\u5339\u914d\u3002\n\n\u663e\u7136\uff0c`Kuhn-Munkres` \u7b97\u6cd5\u662f\u5f88\u4f18\u7684\uff0c\u590d\u6742\u5ea6\u4e3a $O(k^3+knm)$\u3002\n\n\u8fd9\u91cc\u6ce8\u610f\u4e00\u4e0b\uff0c\u56db\u6b21\u65b9\u7b97\u6cd5\u53ef\u80fd\u8fc7\u4e0d\u53bb\uff0c\u9700\u8981\u4e09\u6b21\u65b9\u7684 `Kuhn-Munkres` \u7b97\u6cd5\u5b9e\u73b0\uff0c\u8fd9\u91cc\u6211\u91c7\u7528 bfs \u7248\u672c\uff0c\u5efa\u8bae\u80cc\u4e0b\u6765\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long w[505][505],lf[505],rf[505],gp[505];\nint pp[505],v[505],z[505],sx[505],sy[505],tx[505],ty[505];\nchar f[205][205];\nint qx[10005],qy[10005],r[105][105],mb[8][2];\nint n,m,k,a,b;\nvoid bfs(int x)\n{\n\tint B=0;\n\tdo\n\t{\n\t\tint A=pp[B],dt=B;\n\t\tlong long d=LLONG_MAX/2;\n\t\tv[B]=1;\n\t\tfor(int cu=1;cu<=k;cu++)\n\t\t{\n\t\t\tif(v[cu])continue;\n\t\t\tlong long gg=lf[A]+rf[cu]-w[A][cu];\n\t\t\tif(gp[cu]>gg)gp[cu]=gg,z[cu]=B;\n\t\t\tif(d>gp[cu])d=gp[cu],dt=cu;\n\t\t}\n\t\tlf[x]-=d;\n\t\tfor(int i=1;i<=k;i++)\n\t\t{\n\t\t\tif(v[i])lf[pp[i]]-=d,rf[i]+=d;\n\t\t\telse gp[i]-=d;\n\t\t}\n\t\tB=dt;\n\t}while(pp[B]!=0);\n\twhile(B!=0)pp[B]=pp[z[B]],B=z[B];\n}\nint main()\n{\n\tcin>>n>>m>>k>>a>>b;\n\tmb[0][0]=a,mb[0][1]=b;\n\tmb[1][0]=a,mb[1][1]=-b;\n\tmb[2][0]=-a,mb[2][1]=b;\n\tmb[3][0]=-a,mb[3][1]=-b;\n\tmb[4][0]=b,mb[4][1]=a;\n\tmb[5][0]=b,mb[5][1]=-a;\n\tmb[6][0]=-b,mb[6][1]=a;\n\tmb[7][0]=-b,mb[7][1]=-a;\n\tfor(int i=1;i<=n;i++)scanf(\"%s\",f[i]+1);\n\tfor(int i=1;i<=k;i++)scanf(\"%d%d\",&sx[i],&sy[i]);\n\tfor(int i=1;i<=k;i++)scanf(\"%d%d\",&tx[i],&ty[i]);\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tint head=0,tail=-1;\n\t\ttail++;\n\t\tqx[tail]=sx[i],qy[tail]=sy[i];\n\t\tmemset(r,63,sizeof(r));\n\t\tr[sx[i]][sy[i]]=0;\n\t\twhile(head<=tail)\n\t\t{\n\t\t\tint px=qx[head],py=qy[head];\n\t\t\thead++;\n\t\t\tfor(int d=0;d<8;d++)\n\t\t\t{\n\t\t\t\tint dx=px+mb[d][0],dy=py+mb[d][1];\n\t\t\t\tif(dx<1||dy<1||dx>n||dy>m||f[dx][dy]!='.')\n\t\t\t\t\tcontinue;\n\t\t\t\tif(r[dx][dy]>r[px][py]+1)\n\t\t\t\t{\n\t\t\t\t\tr[dx][dy]=r[px][py]+1;\n\t\t\t\t\ttail++;\n\t\t\t\t\tqx[tail]=dx,qy[tail]=dy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(int j=1;j<=k;j++)w[i][j]=-r[tx[j]][ty[j]];\n\t}\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tmemset(v,0,sizeof(v));\n\t\tmemset(gp,63,sizeof(gp));\n\t\tmemset(z,0,sizeof(z));\n\t\tpp[0]=i,bfs(i);\n\t}\n\tlong long L=0;\n\tfor(int i=1;i<=k;i++)L-=w[pp[i]][i];\n\tcout<<L<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1632373622,
        "uid": 107484,
        "name": "wmy_goes_to_thu",
        "ccfLevel": 8,
        "title": "P2499 \u9898\u89e3"
    },
    {
        "content": "\u5173\u4e8e\u8fd9\u9053\u9898, \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u79fb\u52a8\u987a\u5e8f\u4e0d\u4f1a\u6539\u53d8\u7b54\u6848, \u5177\u4f53\u6765\u8bf4, \u6211\u4eec\u6709\u4ee5\u4e0b\u5f15\u7406\u6210\u7acb:\n\n- \u5bf9\u4e8e\u4e00\u4e2a\u79fb\u52a8\u8fc7\u7a0b\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u79fb\u52a8, \u82e5\u5176\u5230\u8fbe\u7684\u4f4d\u7f6e\u4e0a\u6709\u4e00\u4e2a\u68cb\u5b50, \u5219\u8be5\u65b9\u6848\u8981\u4e48\u4e0d\u80fd\u5c06\u6240\u6709\u68cb\u5b50\u79fb\u52a8\u5230\u6700\u7ec8\u4f4d\u7f6e, \u8981\u4e48\u53ef\u4ee5\u901a\u8fc7\u6539\u53d8\u987a\u5e8f\u4f7f\u8fd9\u4e00\u6b21\u79fb\u52a8\u5408\u6cd5\n\n\u8bc1\u660e: \n\n\u8003\u8651\u5230\u8fbe\u4f4d\u7f6e\u4e0a\u7684\u90a3\u4e2a\u68cb\u5b50, \u5982\u679c\u5b83\u6ca1\u6709\u5230\u8fbe\u6700\u7ec8\u4f4d\u7f6e, \u5219\u6211\u4eec\u8003\u8651\u5c06\u8be5\u68cb\u5b50\u79fb\u81f3\u4e0b\u4e00\u6b65, \u5982\u679c\u4e0b\u4e00\u6b65\u8fd8\u6709\u6ca1\u6709\u5230\u8fbe\u6700\u7ec8\u4f4d\u7f6e\u7684\u68cb\u5b50, \u5219\u4e5f\u79fb\u52a8\u5b83\n\n\u5426\u5219\u76f4\u63a5\u8c03\u6362\u8fd9\u4e24\u4e2a\u68cb\u5b50\u7684\u79fb\u52a8\u987a\u5e8f\u5373\u53ef\n\n\u597d\u7684\u6211\u4eec\u53bb\u9664\u4e86\u9898\u76ee\u4e2d\u7684\u8981\u6c42: \u300c\u79fb\u52a8\u8fc7\u7a0b\u4e2d\u4e0d\u80fd\u51fa\u73b0\u591a\u9897\u68cb\u5b50\u540c\u65f6\u5728\u67d0\u4e00\u683c\u7684\u60c5\u51b5\u300d, \u63a5\u4e0b\u6765\u8003\u8651\u9898\u76ee\u88ab\u6211\u4eec\u8f6c\u5316\u6210\u4e86\u4ec0\u4e48\u6837\u5b50:\n\n\u7ed9\u5b9a$k$\u4e2a\u8d77\u59cb\u70b9\u548c\u5b83\u4eec\u5230\u8fbe$k$\u4e2a\u7ec8\u70b9\u7684\u6b65\u6570, \u6c42\u4e00\u79cd\u79fb\u52a8\u65b9\u6848, \u4f7f\u5f97\u8fd9\u79cd\u79fb\u52a8\u65b9\u6848\u80fd\u5c06\u6240\u6709\u8d77\u59cb\u70b9\u79fb\u52a8\u5230\u7ec8\u70b9(\u4fdd\u8bc1\u6709\u65b9\u6848), \u5176\u6b21\u4f7f\u5f97\u6240\u82b1\u8d39\u7684\u6b65\u6570\u6700\u5c11.\n\n\u4e8e\u662f\u6211\u4eec\u628a\u8fd9\u9053\u9898\u76ee\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u8d39\u7528\u6d41\u95ee\u9898, \u5177\u4f53\u7684, \u6211\u4eec\u5efa\u7acb\u8d85\u7ea7\u6e90\u70b9$S$, \u8d85\u7ea7\u6c47\u70b9$T$, \u63a5\u4e0b\u6765\u8fde\u63a5\u4e09\u7c7b\u8fb9\n\n1. $S\\rightarrow$\u6240\u6709\u8d77\u59cb\u70b9, \u8fd9\u7c7b\u8fb9\u5bb9\u91cf\u4e3a1, \u8d39\u7528\u4e3a0\n\n2. \u6bcf\u4e00\u4e2a\u8d77\u59cb\u70b9$\\rightarrow$\u6bcf\u4e00\u4e2a\u5b83\u80fd\u591f\u5230\u8fbe\u7684\u7ec8\u70b9, \u8fd9\u7c7b\u8fb9\u5bb9\u91cf\u4e3a1, \u8d39\u7528\u4e3a\u6240\u6d88\u8017\u7684\u6b65\u6570\n\n3. \u6240\u6709\u7ec8\u70b9$\\rightarrow T$, \u8fd9\u7c7b\u8fb9\u5bb9\u91cf\u4e3a1, \u8d39\u7528\u4e3a0\n\n~~\u5728\u65b0\u56fe\u4e0a\u8dd1\u8d39\u7528\u6d41\u5373\u53efAC~~\n\n\u8981\u662f\u8fd9\u9053\u9898\u6709\u8fd9\u4e48\u7b80\u5355\u5c31\u597d\u4e86\n\n\u5982\u679c\u4f60\u4f7f\u7528\u4e86\u4e00\u822c\u7684EK+SPFA, \u4f60\u4f1a\u50cf\u6211\u8fd9\u6837:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ue09qnc2.png)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u6539\u8fdb\u7b97\u6cd5, ouuan\u5728[\u8fd9\u7bc7\u5e16\u5b50](https://www.luogu.com.cn/discuss/show/161006)\u4e2d\u8bf4\u9053:\n\n\u5e38\u89c1\u8d39\u7528\u6d41\u7b97\u6cd5(\u628a Dinic \u7684 BFS \u6539\u6210\u6c42\u6700\u77ed\u8def)\u590d\u6742\u5ea6\u4e0a\u754c\u662f $O(nmf)$,\u5176\u4e2d $f$ \u662f\u6700\u5927\u6d41\u3002\n\n~~\u4e8e\u662f\u6211\u4eec\u70b9\u8fdb\u4e86\u4e0b\u9762\u7684\u94fe\u63a5\u5b66\u4e60\u4e86\u90a3\u79cd\u65b9\u6cd5\u5e76\u4e14AC\u672c\u9898~~\n\n\u6211\u4e0d\u4f1a\u90a3\u79cd\u65b9\u6cd5>\\_< \u4e8e\u662f\u4f7f\u7528\u4e86Dijkstra\u8dd1\u6700\u77ed\u8def, \u4e8b\u5b9e\u4e0a\u4e00\u822c\u7684Dijkstra\u662f\u4e0d\u80fd\u8dd1\u7684, \u4f46\u662f\u6211\u5728[\u8d39\u7528\u6d41\u7684\u9898\u89e3](https://www.luogu.com.cn/blog/Bartholomew/solution-p3381)\u4e2d\u627e\u5230\u4e86\u8fd9\u79cd\u795e\u4ed9\u505a\u6cd5\n\n\u5982\u679c\u6211\u8bb2\u5f97\u4e0d\u592a\u597d\u53ef\u4ee5\u76f4\u63a5\u770b\u4e0a\u9762\u90a3\u7bc7\u535a\u5ba2 /kel\n\n\u5177\u4f53\u6765\u8bf4, \u6211\u4eec\u5b9a\u4e49\u52bf\u51fd\u6570$h(i)$\u4f7f\u5f97$e'(u,v)=e(u,v)+h(u)-h(v)$, \u6700\u540e\u5bf9\u6700\u77ed\u8def\u7684\u5f71\u54cd\u53ef\u4ee5\u5f3a\u884c\u8003\u8651\u6389, \u4e14$e'(u,v)$\u6052\u975e\u8d1f, \u5c31\u53efDijkstra\u4e86\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u53d1\u73b0$h(i)=mindis(u)$\u662f\u6210\u7acb\u7684, \u4f46\u90a3\u6837\u7684\u8bdd\u4f60\u8fd8\u8981\u8dd1SPFA\u6c42\u6700\u77ed\u8def\n\n\u56e0\u6b64\u6211\u4eec\u8f6c\u800c\u8003\u8651$h(i)=mindis_{round-1}(u)$, \u5176\u4e2d$mindis_{round-1}(u)$\u6307\u4e0a\u4e00\u6b21\u589e\u5e7f\u65f6$S \\rightarrow u$\u7684\u6700\u77ed\u8def(\u4e0d\u5b58\u5728\u4e3a0), \u6211\u4eec\u53d1\u73b0\u8fd9\u4e5f\u662f\u6210\u7acb\u7684, \u5177\u4f53\u6765\u8bf4, \u6211\u4eec\u8003\u8651\u6bcf\u6761\u8fb9$e(u,v)$.\n\n- \u82e5$e(u,v)$\u5728\u4e0a\u4e00\u6b21\u589e\u5e7f\u65f6\u5b58\u5728, \u90a3\u4e48\u663e\u7136\u6ee1\u8db3\u6027\u8d28\n- \u5426\u5219$e(u,v)$\u5728\u6700\u77ed\u8def\u4e0a, \u4e5f\u53ef\u8bc1\u660e$e'(u,v) \\geq 0$\n\n\u4e8e\u662f\u6211\u4eec\u7684\u52bf\u7b97\u6cd5\u6210\u7acb, \u7528Dijkstra\u66ff\u6362SPFA\u5373\u53ef\u5728luogu\u4e0aAC\u672c\u9898\n\n```cpp\n#pragma GCC diagnostic error \"-std=c++11\"\n#pragma GCC target(\"avx\")\n#pragma GCC optimize(2)\n#pragma GCC optimize(3)\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"inline\")\n#pragma GCC optimize(\"-fgcse\")\n#pragma GCC optimize(\"-fgcse-lm\")\n#pragma GCC optimize(\"-fipa-sra\")\n#pragma GCC optimize(\"-ftree-pre\")\n#pragma GCC optimize(\"-ftree-vrp\")\n#pragma GCC optimize(\"-fpeephole2\")\n#pragma GCC optimize(\"-ffast-math\")\n#pragma GCC optimize(\"-fsched-spec\")\n#pragma GCC optimize(\"unroll-loops\")\n#pragma GCC optimize(\"-falign-jumps\")\n#pragma GCC optimize(\"-falign-loops\")\n#pragma GCC optimize(\"-falign-labels\")\n#pragma GCC optimize(\"-fdevirtualize\")\n#pragma GCC optimize(\"-fcaller-saves\")\n#pragma GCC optimize(\"-fcrossjumping\")\n#pragma GCC optimize(\"-fthread-jumps\")\n#pragma GCC optimize(\"-funroll-loops\")\n#pragma GCC optimize(\"-fwhole-program\")\n#pragma GCC optimize(\"-freorder-blocks\")\n#pragma GCC optimize(\"-fschedule-insns\")\n#pragma GCC optimize(\"inline-functions\")\n#pragma GCC optimize(\"-ftree-tail-merge\")\n#pragma GCC optimize(\"-fschedule-insns2\")\n#pragma GCC optimize(\"-fstrict-aliasing\")\n#pragma GCC optimize(\"-fstrict-overflow\")\n#pragma GCC optimize(\"-falign-functions\")\n#pragma GCC optimize(\"-fcse-skip-blocks\")\n#pragma GCC optimize(\"-fcse-follow-jumps\")\n#pragma GCC optimize(\"-fsched-interblock\")\n#pragma GCC optimize(\"-fpartial-inlining\")\n#pragma GCC optimize(\"no-stack-protector\")\n#pragma GCC optimize(\"-freorder-functions\")\n#pragma GCC optimize(\"-findirect-inlining\")\n#pragma GCC optimize(\"-fhoist-adjacent-loads\")\n#pragma GCC optimize(\"-frerun-cse-after-loop\")\n#pragma GCC optimize(\"inline-small-functions\")\n#pragma GCC optimize(\"-finline-small-functions\")\n#pragma GCC optimize(\"-ftree-switch-conversion\")\n#pragma GCC optimize(\"-foptimize-sibling-calls\")\n#pragma GCC optimize(\"-fexpensive-optimizations\")\n#pragma GCC optimize(\"-funsafe-loop-optimizations\")\n#pragma GCC optimize(\"inline-functions-called-once\")\n#pragma GCC optimize(\"-fdelete-null-pointer-checks\")\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace mcmf {\n\tconst int N=1002; const int M=500*502*2+1; const int inf=0x3f3f3f3f;\n    int tot = 1, head[N], Next[M * 2], ver[M * 2], edge[M * 2], cost[M * 2];\n    int dis[N], h[N], lst[N], pre[N], C, n;\n\t#define pi pair<int,int>\n    inline void _add(int u, int v, int c, int w) {\n        Next[++tot] = head[u], head[u] = tot, ver[tot] = v, edge[tot] = c, cost[tot] = w;\n    }\n    inline void add(int u, int v, int c, int w) {\n        _add(u, v, c, w), _add(v, u, 0, -w);\n    }\n    void Dijkstra(int s) {\n    \tpriority_queue<pi, vector<pi>, greater<pi> > q;\n        for(; !q.empty(); q.pop());\n        fill(dis, dis + 1 + n, -1);\n        dis[s] = 0, q.push(pi(0, s));\n        while(!q.empty()) {\n            pi now = q.top(); q.pop();\n            int u = now.second;\n            if(dis[u] < now.first) continue;\n            for(int i = head[u]; i; i = Next[i]) {\n                static int v; v = ver[i];\n                if(!edge[i]) continue;\n                if(dis[v] < 0 || dis[v] > dis[u] + cost[i] + h[u] - h[v]) {\n                    dis[v] = dis[u] + cost[i] + h[u] - h[v];\n                    pre[v] = u, lst[v] = i;\n                    q.push(pi(dis[v], v));\n                }\n            }\n        }\n    }\n    int solve(int s, int t) {\n        memset(h,0,sizeof(h)); int d=inf;\n        while(1){\n            Dijkstra(s); if(dis[t] < 0) break;\n            for(register int i = 1; i <= n; ++i) h[i] += (dis[i] != -1) ? dis[i] : 0; d=inf;\n            for(int u = t; u != s; u = pre[u]) edge[lst[u]]<d && (d=edge[lst[u]]); C += h[t] * d;\n            for(int u = t; u != s; u = pre[u]) edge[lst[u]] -= d, edge[lst[u] ^ 1] += d;\n        } \n\t\treturn C;\n    }\n}\nconst int _=501,__=101;\nint n,m,k,a,b;\nint un[__][__],dis[__][__];\nstruct pos{\n\tint x,y;\n}st[_], ed[_];\nqueue<pos> Q;\nint dx[8]={1,1,-1,-1,1,1,-1,-1}, dy[8]={1,-1,1,-1,1,-1,1,-1};\n#define in(a) (a.x>=1 && a.x<=n && a.y>=0 && a.y<=m && !un[a.x][a.y])\nvoid getdis(int s){\n\tQ.push(st[s]); dis[st[s].x][st[s].y]=0; pos x; int d;\n\twhile(!Q.empty()){\n\t\tx=Q.front(); d=dis[x.x][x.y]; Q.pop();\n\t\tfor(int i=0;i<8;++i){\n\t\t\tx.x+=dx[i]; x.y+=dy[i];\n\t\t\t(dis[x.x][x.y]==-1) && in(x) && (Q.push(x),dis[x.x][x.y]=d+1);\n\t\t\tx.x-=dx[i]; x.y-=dy[i];\n\t\t}\n\t}\n}\nchar get(){char c=getchar(); while(c!='*' && c!='.') c=getchar(); return c;}\nint main(){\n\tscanf(\"%d%d%d%d%d\",&n,&m,&k,&a,&b); \n\tfor(register int i=1;i<=n;++i) for(int j=1;j<=m;++j) {\n\t\tchar ch=get(); un[i][j]=(ch=='*');\n\t}\n\tfor(register int i=0;i<4;++i) dx[i]*=a,dy[i]*=b;\n\tfor(register int i=4;i<8;++i) dx[i]*=b,dy[i]*=a;\n\tfor(register int i=1;i<=k;++i) scanf(\"%d%d\",&st[i].x,&st[i].y);\n\tfor(register int i=1;i<=k;++i) scanf(\"%d%d\",&ed[i].x,&ed[i].y);\n\tfor(register int i=1;i<=k;++i) {\n\t\tmemset(dis,-1,sizeof(dis)); getdis(i);\n\t\tfor(int j=1;j<=k;++j) if(dis[ed[j].x][ed[j].y]!=-1) mcmf::add(i+1,j+k+1,1,dis[ed[j].x][ed[j].y]);\n\t}\n\tfor(int i=1;i<=k;++i) mcmf::add(1,i+1,1,0),mcmf::add(i+k+1,2*k+2,1,0);\n\tmcmf::n=2*k+2; printf(\"%d\\n\",mcmf::solve(1,2*k+2));\n}\n```",
        "postTime": 1576049777,
        "uid": 133345,
        "name": "lightup37",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2499 \u3010[SDOI2012]\u8c61\u68cb\u3011"
    }
]