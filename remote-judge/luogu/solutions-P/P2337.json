[
    {
        "content": "\u672c\u9898\u89e3\u601d\u8def&\u90e8\u5206\u4ee3\u7801\u5b9e\u73b0\u6765\u81ea[\u8fd9\u7bc7](https://www.luogu.com.cn/blog/efforts-will-pay-off/du-liu-dong-gui-cha-tou-dp)\u65e5\u62a5\n\n\u7ec8\u4e8e\u8fc7\u4e86\uff0c\u8c03\u4e863h\uff0c\u5199\u4e2a\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\n\n~~\u8fd9\u9053\u9898\u8ba9\u6211\u611f\u5230\u4e86\u4ec0\u4e48\u53eb\u771f\u6b63\u7684\u6bd2\u7624~~\n\n\u8fd9\u9898\u5462\uff0c\u770b\u4e00\u773c\u6570\u636e\u8303\u56f4\uff0c\u5927\u6982\u662f\u63d2\u5934dp\n\n\u90a3\u6211\u4eec\u5c31\u8981\u8003\u8651\u5982\u4f55\u8bbe\u8ba1\u72b6\u6001\u4e86\n\n\u663e\u7136\uff0c\u672c\u9898\u4e2d\u53ea\u8bb0\u5f55\u8f6e\u5ed3\u7ebf\u7684**\u63d2\u5934**\u72b6\u6001\u662f\u4e0d\u591f\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u662f\u7531\u5b83\u5468\u56f4\u7684\u516b\u4e2a\u70b9\u7684\u72b6\u6001\u51b3\u5b9a\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u8981\u8bb0\u5f55\u8f6e\u5ed3\u7ebf\u7684**\u8def\u5f84**\uff0c\u4e5f\u5c31\u662f\u8f6e\u5ed3\u7ebf\u4e0a\u662f\u653e\u969c\u788d\u8fd8\u662f\u70ae\u53f0\u8fd8\u662f\u8def\u5f84\n\n\u6211\u4eec\u8bb0\u8f6e\u5ed3\u7ebf\u4e0a\u5982\u679c\u662f\u969c\u788d\u5219\u4e3a\u72b6\u6001 0\uff0c\u5982\u679c\u662f\u8def\u5f84\u5219\u4e3a\u72b6\u6001 1\uff0c\u5982\u679c\u662f\u70ae\u53f0\u5219\u4e3a 3\n\n\u5f53\u7136\uff0c\u6211\u4eec\u53d1\u73b0\u63d2\u5934\u72b6\u6001\u4ec5\u8bb0\u5f55\u5de6\u62ec\u53f7\uff08\u8bb0\u4e3a1\uff09\uff0c\u53f3\u62ec\u53f7\uff08\u8bb0\u4e3a2\uff09\uff0c\u548c\u65e0\u63d2\u5934\uff08\u8bb0\u4e3a0\uff09\u662f\u4e0d\u591f\u7684\uff0c\u56e0\u4e3a\u672c\u9898\u4e2d\u53ef\u80fd\u6709\u6ca1\u6709\u62ec\u53f7\u548c\u5b83\u5339\u914d\u7684\u63d2\u5934\uff0c\u6211\u4eec\u79f0\u5176\u4e3a**\u72ec\u7acb\u63d2\u5934**\uff08\u8bb0\u4e3a3\uff09\n\n\u6211\u4eec\u53c8\u53d1\u73b0\u70ae\u53f0\u7684\u6570\u91cf\u8fd8\u6709\u4e2a\u9650\u5236\uff0c\u4e8e\u662f\u8fd8\u8981\u52a0\u4e00\u4e2a\u72b6\u6001\u8bb0\u5f55\u70ae\u53f0\u7684\u6570\u91cf\n\n\u63a5\u4e0b\u6765\uff0c\u5c31\u662f~~\u559c\u95fb\u4e50\u89c1~~\u7684\u5927\u529b\u5206\u7c7b\u8ba8\u8bba\u65f6\u95f4\u5566\n\n\uff08\u5f53\u7136\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u505a\u8fc7[\u8fd9\u4e2a](https://www.luogu.com.cn/problem/P5056)\u9898\uff0c\u90a3\u4e48\u5efa\u8bae\u4f60\u5148\u53bb\u505a\u4e00\u4e0b\uff0c\u56e0\u4e3a\u672c\u9898\u63d2\u5934\u4f7f\u7528\u62ec\u53f7\u8868\u793a\u6cd5\uff09\n\n\u6211\u4eec\u8bb0 $pl1$ \u4e3a\u53f3\u63d2\u5934\uff0c\u8bb0 $pl2$ \u4e3a\u4e0b\u63d2\u5934\n\n1. \u8fd9\u4e2a\u70b9 $pl1=0$ \u4e14\u5de6\u8fb9\u662f\u8def\u5f84\u6216 $pl2=0$ \u4e14\u4e0a\u8fb9\u662f\u8def\u5f84  \n\u8fd9\u79cd\u60c5\u51b5\u663e\u7136\u9700\u8981\u7528\u969c\u788d\u53bb\u5835\u4f4f  \n\u90a3\u4e48\uff0c\u663e\u7136\u53ea\u6709\u65e0\u5de6\u63d2\u5934\u4e14\u65e0\u4e0b\u63d2\u5934\u7684\u60c5\u51b5\u662f\u5408\u6cd5\u7684  \n\u63a5\u4e0b\u6765\uff0c\u53ea\u8981\u8f6c\u79fb\u8fd9\u4e2a\u70b9\u653e\u70ae\u53f0\u6216\u969c\u788d\u5c31\u884c\u4e86\n\n2. \u8fd9\u4e2a\u70b9\u662f\u969c\u788d\u70b9  \n\u8fd9\u5e94\u8be5\u662f\u6700\u7b80\u5355\u7684\u4e00\u79cd  \n\u663e\u7136\u53ea\u6709\u65e0\u5de6\u63d2\u5934\u4e14\u65e0\u4e0b\u63d2\u5934\u7684\u60c5\u51b5\u662f\u5408\u6cd5\u7684  \n\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\n\n3. \u8fd9\u4e2a\u70b9\u662f\u975e\u969c\u788d\u70b9  \n\uff08\u75af\u72c2\u7684\u5730\u65b9\u5f00\u59cb\u4e86\uff09  \n1\uff09\u82e5 $pl1=0$ \u4e14 $pl2=0$  \n$\\quad$ \u5219\u53ef\u4ee5\u6dfb\u52a0\u70ae\u53f0\uff0c\u6216\u8005\u65b0\u5efa\u4e00\u4e2a\u8054\u901a\u5206\u91cf\uff0c\u6216\u8005\u4e0d\u8d70  \n2\uff09\u82e5 $pl1=0$ \u6216 $pl2=0$  \n$\\quad$ \u5219\u76f4\u63a5\u5ef6\u4f38\u63d2\u5934\u5373\u53ef  \n3\uff09\u82e5 $pl1=1$ \u4e14 $pl2=1$  \n$\\quad$ \u5219\u9700\u8981\u5411\u53f3\u5bfb\u627e\u4e00\u4e2a\u53f3\u62ec\u53f7\u6362\u6210\u5de6\u62ec\u53f7\u5e76\u5220\u9664\u5f53\u524d\u63d2\u5934  \n4\uff09\u82e5 $pl1=2$ \u4e14 $pl2=2$  \n$\\quad$ \u5219\u9700\u8981\u5411\u5de6\u5bfb\u627e\u4e00\u4e2a\u5de6\u62ec\u53f7\u6362\u6210\u53f3\u62ec\u53f7\u5e76\u5220\u9664\u5f53\u524d\u63d2\u5934  \n5\uff09\u82e5 $pl1=1$ \u4e14 $pl2=2$  \n$\\quad$ \u4e0d\u5408\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u5f62\u6210\u95ed\u5408\u56de\u8def  \n6\uff09\u82e5 $pl1=2$ \u4e14 $pl2=1$  \n$\\quad$ \u76f4\u63a5\u5220\u9664\u63d2\u5934\u5373\u53ef  \n7\uff09\u82e5 $pl1=1$ \u4e14 $pl2=3$ \u6216 $pl1=3$ \u4e14 $pl2=1$  \n$\\quad$ \u5219\u9700\u8981\u5411\u53f3\u5bfb\u627e\u4e00\u4e2a\u53f3\u62ec\u53f7\u66ff\u6362\u6210\u72ec\u7acb\u63d2\u5934\u5e76\u5220\u9664\u5f53\u524d\u63d2\u5934  \n8\uff09\u82e5 $pl1=2$ \u4e14 $pl2=3$ \u6216 $pl1=3$ \u4e14 $pl2=2$  \n$\\quad$ \u5219\u9700\u8981\u5411\u5de6\u5bfb\u627e\u4e00\u4e2a\u5de6\u62ec\u53f7\u66ff\u6362\u6210\u72ec\u7acb\u63d2\u5934\u5e76\u5220\u9664\u5f53\u524d\u63d2\u5934  \n9\uff09\u82e5 $pl1=3$ \u4e14 $pl2=3$  \n$\\quad$ \u76f4\u63a5\u5220\u9664\u63d2\u5934\u5373\u53ef\n\n4. \u8fd9\u4e2a\u70b9\u662f\u8d77\u70b9\u6216\u8005\u7ec8\u70b9  \n1\uff09\u82e5 $pl1=0$ \u4e14 $pl2=0$  \n$\\quad$ \u5219\u9700\u8981\u65b0\u5efa\u4e00\u4e2a\u72ec\u7acb\u63d2\u5934  \n2\uff09\u82e5 $pl1=1$ \u4e14 $pl2=0$ \u6216 $pl1=0$ \u4e14 $pl2=1$  \n$\\quad$ \u5219\u9700\u8981\u5411\u53f3\u5bfb\u627e\u4e00\u4e2a\u53f3\u62ec\u53f7\u66ff\u6362\u6210\u72ec\u7acb\u63d2\u5934\u5e76\u5220\u9664\u5f53\u524d\u63d2\u5934  \n3\uff09\u82e5 $pl1=2$ \u4e14 $pl2=0$ \u6216 $pl1=0$ \u4e14 $pl2=2$  \n$\\quad$ \u5219\u9700\u8981\u5411\u5de6\u5bfb\u627e\u4e00\u4e2a\u5de6\u62ec\u53f7\u66ff\u6362\u6210\u72ec\u7acb\u63d2\u5934\u5e76\u5220\u9664\u5f53\u524d\u63d2\u5934  \n4\uff09\u82e5 $pl1=3$ \u4e14 $pl2=0$ \u6216 $pl1=0$ \u4e14 $pl2=3$  \n$\\quad$ \u76f4\u63a5\u5220\u9664\u63d2\u5934\u5373\u53ef\n\n---\n\u4ee5\u4e0a\u662f\u5927\u529b\u5206\u7c7b\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u8bb2\u8bb2\u70b9\u6743\u7684\u4e8b\u60c5\n\n\u5982\u679c\u7ecf\u8fc7\u8fd9\u4e2a\u70b9\uff0c\u7531\u4e8e\u6211\u4eec\u53ea\u77e5\u9053\u8f6e\u5ed3\u7ebf\u4e0a\u7684\u5468\u56f4\u56db\u4e2a\u70b9\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u53ea\u80fd\u52a0\u4e0a\u8fd9\u56db\u4e2a\u70b9\u4e2d\u70ae\u53f0\u7684\u4e2a\u6570\n\n\u5982\u679c\u8fd9\u4e2a\u70b9\u653e\u969c\u788d\uff0c\u4e0d\u52a0\uff0c\u76f4\u63a5\u4f20\u4e0b\u53bb\u5c31\u884c\n\n\u5982\u679c\u8fd9\u4e2a\u70b9\u653e\u70ae\u53f0\uff0c\u6211\u4eec\u5c31\u8981\u52a0\u4e0a\u8f6e\u5ed3\u7ebf\u4e0a\u8def\u5f84\u7684\u4e2a\u6570\uff0c\u90a3\u4e3a\u5565\u8fd9\u6837\u76f4\u63a5\u52a0\u662f\u5bf9\u7684\u5462\uff1f\n\n\u6211\u4eec\u5982\u679c\u4e0d\u7ecf\u8fc7\u4e00\u4e2a\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u5b83\u8bbe\u7f6e\u6210\u969c\u788d\uff0c\u8fd9\u6837\uff0c\u4e00\u4e2a\u70ae\u53f0\u7684\u8d21\u732e\u5c31\u662f\u8f6e\u5ed3\u7ebf\u4e0a\u7684\u5468\u56f4\u56db\u4e2a\u70b9\u4e2d\u8def\u5f84\u7684\u4e2a\u6570\n\n\u8be5\u89e3\u91ca\u7684\u90fd\u89e3\u91ca\u4e86\uff0c\u6211\u4eec\u6765\u770b\u4ee3\u7801\u5427\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 25\n#define p 100007\n#define int long long\nusing namespace std;\nint n,m,K,now,pre;\nchar c[MAXN][MAXN];\nint head[p+3],nxt[1<<24];\nint f[2][1<<24],fst[2][3][1<<24];\nint cnt[2];\nvoid insert(int state1,int state2,int state3,int val)\n{\n\tint ha=((((1ll*state1<<16)|state2)<<4)|state3)%p+1;//\u54c8\u5e0c\n\tfor(int i=head[ha];i;i=nxt[i])\n\t\tif(fst[now][0][i]==state1&&fst[now][1][i]==state2&&fst[now][2][i]==state3)\n\t\t{\n\t\t\tf[now][i]=max(f[now][i],val);\n\t\t\treturn;\n\t\t}\n\tf[now][++cnt[now]]=val;\n\tfst[now][0][cnt[now]]=state1;\n\tfst[now][1][cnt[now]]=state2;\n\tfst[now][2][cnt[now]]=state3;//\u4e09\u4e2a\u72b6\u6001\n\tnxt[cnt[now]]=head[ha];\n\thead[ha]=cnt[now];\n}//hash\u8868\nint left(int state,int pos,int val)\n{//\u5411\u5de6\u5bfb\u627e\u5de6\u62ec\u53f7\n\tint tot=1;\n\twhile(true)\n\t{\n\t\tint pl=(state>>(pos<<1))&3;\n\t\tif(pl==2)tot++;if(pl==1) tot--;\n\t\tif(!tot)return state^(pl<<(pos<<1))^(val<<(pos<<1));\n\t\tpos--;\n\t}\n}\nint right(int state,int pos,int val)\n{//\u5411\u53f3\u5bfb\u627e\u53f3\u62ec\u53f7\n\tint tot=1;\n\twhile(true)\n\t{\n\t\tint pl=(state>>(pos<<1))&3;\n\t\tif(pl==1)tot++;if(pl==2) tot--;\n\t\tif(!tot)return state^(pl<<(pos<<1))^(val<<(pos<<1));\n\t\tpos++;\n\t}\n}\nchar tmp[MAXN][MAXN];\nsigned main()\n{\n\tscanf(\"%lld%lld%lld\",&n,&m,&K);\n\tfor(int i=0;i<n;i++)scanf(\"%s\",c[i]);\n\tif(n<m)\n\t{//n<m\u7684\u65f6\u5019\u628a\u5730\u56fe\u8f6c90\u5ea6\n\t\tmemcpy(tmp,c,sizeof(c));\n\t\tfor(int i=0;i<n;i++)\n\t\t\tfor(int j=0;j<m;j++)\n\t\t\t\tc[j][i]=tmp[i][j];\n\t\tswap(n,m);\n\t}\n\tcnt[0]=1;\n\tfor(int i=0;i<n;i++)\n\t{\n\t\tfor(int j=1;j<=cnt[now];j++)\n\t\t\tfst[now][0][j]<<=2;\n\t\tfor(int j=1;j<=cnt[now];j++)\n\t\t\tfst[now][1][j]=(fst[now][1][j]^(((fst[now][1][j]>>(m+1<<1))&3)<<(m+1<<1)))<<2;//\u66f4\u65b0\u4e0a\u4e00\u884c\u7684\u72b6\u6001\n\t\tfor(int j=0;j<m;j++)\n\t\t{\n\t\t\tpre=now;now^=1;cnt[now]=0;\n\t\t\tmemset(head,0,sizeof(head));//\u6ce8\u610f\u521d\u59cb\u5316\n\t\t\tfor(int k=1;k<=cnt[pre];k++)\n\t\t\t{\n\t\t\t\tint sta=fst[pre][0][k],stb=fst[pre][1][k],stc=fst[pre][2][k];\n\t\t\t\tint val=f[pre][k];\n\t\t\t\tif(sta>=(1<<(m+1<<1)))continue;\n\t\t\t\tint pl1=(sta>>(j<<1))&3;//right\n\t\t\t\tint pl2=(sta>>(j+1<<1))&3;//down\n\t\t\t\tint r=(stb>>(j<<1))&3;//\u53f3\u72b6\u6001\n\t\t\t\tint ur=(stb>>(j+1<<1))&3;//\u53f3\u4e0a\u72b6\u6001\n\t\t\t\tint u=(stb>>(j+2<<1))&3;//\u4e0a\u72b6\u6001\n\t\t\t\tint ul=(stb>>(j+3<<1))&3;//\u5de6\u4e0a\u72b6\u6001\n\t\t\t\tint now=(sta^(pl1<<(j<<1))^(pl2<<(j+1<<1)));\n\t\t\t\tif((!pl1&&r==1)||(!pl2&&u==1))//1\n\t\t\t\t{\n\t\t\t\t\tif(pl1||pl2)continue;\n\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1)),stc,val);//\u653e\u969c\u788d\n\t\t\t\t\tif(stc<K&&c[i][j]=='.')\n\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1))^(3<<(j+1<<1)),stc+1,val+(r==1)+(ur==1)+(u==1)+(ul==1));//\u653e\u70ae\u53f0\n\t\t\t\t}\n\t\t\t\telse if(c[i][j]=='#'){if(!pl1&&!pl2)insert(now,stb^(ur<<(j+1<<1)),stc,val);}//2\n\t\t\t\telse if(c[i][j]=='.')//3\n\t\t\t\t{\n\t\t\t\t\tif(!pl1&&!pl2)//1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif(stc<K)\n\t\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1))^(3<<(j+1<<1)),stc+1,\n\t\t\t\t\t\t\t\tval+(r==1)+(ur==1)+(u==1)+(ul==1));//\u653e\u70ae\u53f0\n\t\t\t\t\t\tinsert(now^(1<<(j<<1))^(2<<(j+1<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));//\u8d70\n\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1)),stc,val);//\u4e0d\u8d70\n\t\t\t\t\t}\n\t\t\t\t\telse if(!pl1&&pl2)//2\uff09\n\t\t\t\t\t{\n\t\t\t\t\t\tinsert(now^(pl2<<(j<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t\tinsert(now^(pl2<<(j+1<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t}\n\t\t\t\t\telse if(pl1&&!pl2)//2\uff09\n\t\t\t\t\t{\n\t\t\t\t\t\tinsert(now^(pl1<<(j<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t\tinsert(now^(pl1<<(j+1<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t}\n\t\t\t\t\telse if(pl1==1&&pl2==1)//3\uff09\n\t\t\t\t\t\tinsert(right(now,j,1),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==2&&pl2==2)//4\uff09\n\t\t\t\t\t\tinsert(left(now,j,2),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==2&&pl2==1)//6\uff09\n\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==1&&pl2==3)//7\uff09\n\t\t\t\t\t\tinsert(right(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==2&&pl2==3)//8\uff09\n\t\t\t\t\t\tinsert(left(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==3&&pl2==1)//7\uff09\n\t\t\t\t\t\tinsert(right(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==3&&pl2==2)//8\uff09\n\t\t\t\t\t\tinsert(left(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==3&&pl2==3)//9\uff09\n\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t}\n\t\t\t\telse if(c[i][j]=='S'||c[i][j]=='T')//4\n\t\t\t\t{\n\t\t\t\t\tif(c[i][j]=='S'&&!pl1&&!pl2)//1\uff09\n\t\t\t\t\t{\n\t\t\t\t\t\tinsert(now^(3<<(j<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t\tinsert(now^(3<<(j+1<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t}\n\t\t\t\t\telse if(c[i][j]=='T'&&!pl1&&!pl2)//1\uff09\n\t\t\t\t\t{\n\t\t\t\t\t\tinsert(now^(3<<(j<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t\tinsert(now^(3<<(j+1<<1)),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\t}\n\t\t\t\t\telse if(!pl1&&pl2==1)//2\uff09\n\t\t\t\t\t\tinsert(right(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(!pl1&&pl2==2)//3\uff09\n\t\t\t\t\t\tinsert(left(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==1&&!pl2)//2\uff09\n\t\t\t\t\t\tinsert(right(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==2&&!pl2)//3\uff09\n\t\t\t\t\t\tinsert(left(now,j,3),stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(pl1==3&&!pl2)//4\uff09\n\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t\telse if(!pl1&&pl2==3)//4\uff09\n\t\t\t\t\t\tinsert(now,stb^(ur<<(j+1<<1))^(1<<(j+1<<1)),stc,\n\t\t\t\t\t\t\tval+(r==3)+(ur==3)+(u==3)+(ul==3));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint ans=0;\n\tfor(int i=1;i<=cnt[now];i++)//\u7edf\u8ba1\u7b54\u6848\n\t\tif(!fst[now][0][i])\n\t\t\tans=max(ans,f[now][i]);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1587092009,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2337 \u3010[SCOI2012]\u55b5\u661f\u4eba\u7684\u5165\u4fb5\u3011"
    },
    {
        "content": "## \u89e3\u6790\n\n\u53d1\u73b0\u969c\u788d\u53ef\u4ee5\u968f\u4fbf\u653e\uff0c\u6240\u4ee5\u82e5\u7ed9\u51fa\u4e00\u6761\u8def\u5f84\uff0c\u4e00\u5b9a\u6709\u529e\u6cd5\u4f7f\u5b83\u5408\u6cd5\uff1a\u53ea\u8981\u5728\u8def\u5f84\u65c1\u90fd\u653e\u4e0a\u969c\u788d\u5c31\u884c\u3002\n\n\u4e0d\u8fc7\u8def\u5f84\u662f\u4e0d\u5141\u8bb8\u56db\u8fde\u901a\uff08\u5373\u8def\u5f84\u683c\u5b50\u95f4\u9664\u4e86\u63d2\u5934\u8fd8\u6709\u5171\u8fb9\uff09\uff0c\u5426\u5219\u8fd8\u4f1a\u6709\u66f4\u77ed\u7684\u8def\u5f84\n\n\uff08\u56db\u8fde\u901a\uff09\n\n![\u56db\u8fde\u901a](https://cdn.luogu.com.cn/upload/image_hosting/ftvzkm65.png)\n\n\u4e8e\u662f\u8fd9\u5c31\u76f8\u5f53\u4e8e\u6c42\u4e00\u6761\u4e0d\u5141\u8bb8\u56db\u8fde\u901a\u7684\u683c\u70b9\u8def\u5f84\uff0c\u4e14\u8d77\u70b9\u4e3a $S$\uff0c\u7ec8\u70b9\u4e3a $T$\uff0c\u8fd9\u4e2a\u6211\u4eec\u7528\u63d2\u5934 dp \u5f88\u65b9\u4fbf\u5730\u5c31\u80fd\u6c42\u51fa\n\n### \u6c42\u7f51\u683c\u8def\u5f84\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u53e6\u5f15\u5165\u4e00\u4e2a\u72ec\u7acb\u63d2\u5934\uff0c\u4ee3\u8868\u8def\u5f84\u4ece\u8fd9\u683c**\u51fa\u53d1\u6216\u7ed3\u675f**\uff0c\u8fd9\u683c\u53ea\u6709**\u8fd9\u4e00\u4e2a\u63d2\u5934**\n\n\u6bd4\u8d77\u6c42\u56de\u8def\u53e6\u5916\u8981\u6ce8\u610f\u7684\u51e0\u70b9\uff1a\n\n-   \u8f6e\u5ed3\u7ebf\u5185\u6700\u591a\u5b58\u5728\u4e24\u4e2a\u72ec\u7acb\u63d2\u5934\uff08\u5bf9\u4e8e\u6c42\u4e00\u6761\u8def\u5f84\uff1b\u591a\u6761\u8def\u5f84\u9700\u8981\u6700\u5c0f\u8868\u793a\uff09\n\n-   \u82e5\u5408\u5e76\u72ec\u7acb\u63d2\u5934\u548c\u4e00\u4e2a\u62ec\u53f7\uff0c\u663e\u7136\u4f1a\u628a\u8be5\u62ec\u53f7\u5bf9\u7684**\u53e6\u4e00\u4e2a\u62ec\u53f7**\u53d8\u4e3a\u72ec\u7acb\u63d2\u5934\n\n-   \u50cf\u8fd9\u9898\u8981\u6c42\u6c42\u51fa\u4e00\u6761\u8def\u5f84\uff0c\u663e\u7136\u662f\u4e0d\u5141\u8bb8\u56de\u8def\u5b58\u5728\u7684\u3002\u5982\u679c\u51fa\u73b0\u56de\u8def\u90a3\u4e48\u8fd9\u4e2a\u72b6\u6001\u5c31\u65e0\u6548\n\n\u5982\u679c\u8981\u4f7f\u8def\u5f84\u4ee5 $S, T$ \u4e3a\u8d77\u70b9\u7ec8\u70b9\uff0c**\u53ea\u5141\u8bb8\u5728\u8fd9\u4e24\u4e2a\u683c\u5b50\u653e**\u72ec\u7acb\u63d2\u5934\u5c31\u884c\u4e86\n\n### \u8ba1\u7b97\u70ae\u5854\u8d21\u732e\n\n\u73b0\u5728\u518d\u6765\u8003\u8651\u5982\u4f55\u7b97\u8def\u5f84\u7684\u8d21\u732e\n\n\u5f53\u6211\u4eec dp \u5230\u68cb\u76d8\u7684\u67d0\u4e00\u683c\u65f6\uff0c\u6211\u4eec\u5df2\u904d\u5386\u7684\u683c\u5b50\u90fd\u5728\u8f6e\u5ed3\u7ebf\u7684\u4e0a\u9762\n\n![\u8f6e\u5ed3\u7ebf](https://cdn.luogu.com.cn/upload/image_hosting/6vqmc0de.png)\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u82e5\u6211\u4eec\u5728\u8fd9\u683c\u653e\u4e0b\u70ae\u5854\uff0c\u53ea\u80fd\u7edf\u8ba1\u5230\u516b\u4e2a\u65b9\u5411\u7684\u5de6\u3001\u5de6\u4e0a\u3001\u4e0a\u3001\u53f3\u4e0a\u8fd9\u56db\u4e2a\u65b9\u5411\u7684\u8d21\u732e\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u82e5\u5269\u4e0b\u56db\u4e2a\u65b9\u5411\u7684\u4f4d\u7f6e\u6709\u8def\u5f84\uff0c\u8fd9\u4e2a\u70ae\u5854\u4e5f**\u4e00\u5b9a\u5728\u8be5\u8def\u5f84\u7684\u4e0a\u8ff0\u56db\u4e2a\u65b9\u5411**\uff08\u5de6\u3001\u5de6\u4e0a\u3001\u4e0a\u3001\u53f3\u4e0a\uff09\u4e4b\u4e00\u7684\u4f4d\u7f6e\n\n\u4e8e\u662f\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u8def\u5f84\u683c\u5b50\u4e5f\u7edf\u8ba1\u5de6\u3001\u5de6\u4e0a\u3001\u4e0a\u3001\u53f3\u4e0a\u8fd9\u56db\u4e2a\u65b9\u5411\u7684\u8d21\u732e\u5373\u53ef\n\n&nbsp;\n\n\u5177\u4f53\u5b9e\u73b0\u65f6\u6211\u4eec\u518d\u72b6\u538b\u53e6\u4e00\u4e2a\u72b6\u6001\uff0c\u8868\u793a\u8f6e\u5ed3\u7ebf\u4e0a\u683c\u5b50\u7684\u79cd\u7c7b\uff1b\u5de6\u4e0a\u65b9\u5411\u7684\u683c\u5b50\u4e0d\u5728\u8f6e\u5ed3\u7ebf\u4e0a\uff0c\u518d\u53e6\u5916\u8bbe\u4e2a\u72b6\u6001\u4fdd\u5b58\u5c31\u884c\u4e86\u3002\n\n\uff08\u53e6\u5916\u6ce8\u610f\u8fd9\u4e2a\u72b6\u6001\u5728\u6362\u884c\u65f6\u53ef\u80fd\u4ea7\u751f\u591a\u4f59\u7684\u4fe1\u606f\uff08\u89c1\u4e0b\u56fe\u8f6e\u5ed3\u7ebf\u7ea2\u8272\u8fb9\uff09\uff09\n\n![\u6362\u884c\u591a\u4f59](https://cdn.luogu.com.cn/upload/image_hosting/95sax6gj.png)\n\n\u81f3\u4e8e\u70ae\u5854\u4e2a\u6570\u9650\u5236\uff0c\u4e5f\u540c\u6837\u8bbe\u4e2a\u72b6\u6001\u4fdd\u5b58\uff08\u590d\u6742\u5ea6\u6700\u540e\u662f\u8fc7\u5f97\u4e86\u7684\uff0c\u4e24\u4e2a\u8f6e\u5ed3\u7ebf\u7684\u4e0d\u540c\u72b6\u6001\u6570\u5dee\u4e0d\u591a $4^m$\uff0c$m\\leq 6$\uff0c\u653e\u5fc3\u8bbe\u5c31\u884c...\uff09\n\n### \u5176\u5b83\n\n\u5927\u529b\u5206\u7c7b\u90e8\u5206\u76f4\u63a5\u89c1\u4ee3\u7801\uff0c\u6216\u8005\u770b\u53e6\u4e00\u7bc7\u9898\u89e3\u5373\u53ef\u3002\n\n## CODE\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <cstring>\n#define ll long long\n#define ull unsigned ll\n#pragma GCC optimize(2)/*\u4ee5\u6211\u7684\u5e38\u6570\u53ef\u80fd\u6709\u70b9\u60ac...*/\nusing std::vector;\n\nconst int M =1e6+3;\n\nint n, m, K;\nchar map[21][7];\nstruct qwq{\n\tint state/*\u63d2\u5934\u4fe1\u606f*/, state2/*\u5730\u56fe\u683c\u5b50\u4fe1\u606f*/;\n\tint mpl/*\u65b0\u683c\u5b50\u5de6\u4e0a\u89d2\u683c\u5b50\u4fe1\u606f*/, battery/*\u70ae\u53f0\u6570*/;\n\tint pre;\n\tll sum;\n\tqwq(int s, int s2, int mp, int b, int p, ll su)\n\t\t:state(s), state2(s2), mpl(mp), battery(b), pre(p), sum(su){}\n};\nint pos[M];\nbool used[M];\nvector<qwq> hsh, dp;\n\ninline int get(int state, int x){\n\tint p =(1<<(x<<1));\n\tint a =(bool)(state&p), b =(bool)(state&(p<<1));\n\treturn a+(b<<1);\n}\n\ninline void upd(int &state, int x, int val){ state +=-(get(state, x)<<(x<<1))+(val<<(x<<1)); }\n\n/*hash \u94fe\u5f0f\u524d\u5411\u661f*/\ninline void push(qwq nw){\n\tint key=(((((ull)nw.state<<18)|(ull)nw.state2)<<4)|nw.battery)%M;\n//\tunsigned ll tmp =(nw.state-nw.state2+nw.battery);\n//\tint key =tmp*tmp%M;\n\tif(!used[key]){\n\t\tused[key] =1;\n\t\tnw.pre =-1;\n\t\thsh.push_back(nw);\n\t\tpos[key] =hsh.size()-1;\n\t}\n\telse{\n\t\tfor(int p =pos[key]; p != -1; p =hsh[p].pre)\n\t\t\tif(hsh[p].state == nw.state && hsh[p].state2 == nw.state2 && hsh[p].battery == nw.battery && hsh[p].mpl == nw.mpl){\n\t\t\t\tif(nw.sum > hsh[p].sum)\n\t\t\t\t\thsh[p].sum =nw.sum;\n\t\t\t\treturn;\n\t\t\t}\n\t\tnw.pre =pos[key];\n\t\thsh.push_back(nw);\n\t\tpos[key] =hsh.size()-1;\n\t}\n}\n\ninline void clearhsh(){\n\thsh.clear();\n\tmemset(used, 0, sizeof(used));/*\u6bd4\u8d77\u6e05\u7a7a pos \u4f1a\u7a0d\u5fae\u8282\u7701\u4e9b\u5e38\u6570*/\n}\n\ninline int count(int mp1, int lmp, int mp2, int rmp, int typ){\n\tint cnt =0;\n\tif(lmp == typ) ++cnt;\n\tif(mp1 == typ) ++cnt;\n\tif(mp2 == typ) ++cnt;\n\tif(rmp == typ) ++cnt;\n\treturn cnt;\n}\n\n/*\u7ed9\u5b9a\u4e00\u4e2a\u62ec\u53f7\u4f4d\u7f6e\uff0c\u628a\u8fd9\u4e2a\u62ec\u53f7\u5bf9\u66ff\u6362\u6210\u6307\u5b9a\u63d2\u5934*/\ninline void updbracket(int &state, int posi, int val){\n\tint x, d, cnt =0, pg =get(state, posi), pg_;\n\tif(pg == 1)\n\t\td =1, pg_ =2;\n\telse\n\t\td =-1, pg_ =1;\n\tfor(x =posi+d; cnt >= 0; x +=d){\n\t\tif(get(state, x) == pg) ++cnt;\n\t\telse if(get(state, x) == pg_) --cnt;\n\t}\n\tx -=d;\n\tupd(state, posi, val), upd(state, x, val);\n}\n\ninline void work(){\n\tclearhsh();\n\tdp.push_back(qwq(0, 0, 0, 0, -1, 0));\n\tfor(int i =0; i < n; ++i){\n\t\tfor(int k =0; k < (int)dp.size(); ++k)\n\t\t\tdp[k].state <<=2, dp[k].state2 <<=2, dp[k].mpl =0;\n\t\tfor(int j =0; j < m; ++j){\n\t\t\tfor(int k =0; k < (int)dp.size(); ++k){\n\t\t\t\tqwq nw =dp[k];\n\t\t\t\tif(get(nw.state, m+1) != 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tupd(nw.state2, m+1, 0);/*\u53bb\u6389\u6362\u884c\u4ea7\u751f\u7684\u591a\u4f59\u5730\u56fe\u4fe1\u606f*/\n\t\t\t\t/*0 \u65e0\u63d2\u5934\uff0c1 \u5de6\u62ec\u53f7\uff0c2 \u53f3\u62ec\u53f7\uff0c3 \u72ec\u7acb\u63d2\u5934*/\n\t\t\t\t/*0 \u969c\u788d\uff0c1 \u8def\u5f84\uff0c2 \u70ae\u53f0*/\n\t\t\t\t/*pg1, mp1 \u5de6\uff0cpg2\uff0cmp2 \u4e0a*/\n\t\t\t\tint pg1 =get(nw.state, j), pg2 =get(nw.state, j+1);/*plug*/\n\t\t\t\tint mp1 =get(nw.state2, j), mp2 =get(nw.state2, j+1);/*map*/\n\t\t\t\tint lmp =nw.mpl/*\u5de6\u4e0a\u89d2*/, rmp =get(nw.state2, j+2)/*\u53f3\u4e0a\u89d2*/;\n\t\t\t\tnw.mpl =mp2;/*\u8bb0\u5f55\u65b0\u72b6\u6001\u5de6\u4e0a\u89d2*/\n\t\t\t\tif(map[i][j] == '#'){\n\t\t\t\t\tif(pg1 == 0 && pg2 == 0){\n\t\t\t\t\t\tupd(nw.state2, j, 0), upd(nw.state2, j+1, 0);/*\u6ce8\u610f\u66f4\u65b0\u8f6e\u5ed3\u7ebf*/\n\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(map[i][j] == 'S' || map[i][j] == 'T'){/*\u8d77\u70b9\u7ec8\u70b9\u5904\u7406\u7c7b\u4f3c*/\n\t\t\t\t\tif(pg1 == 0 && pg2 == 0){/*\u6ca1\u6709\u63d2\u5934*/\n\t\t\t\t\t\tif(mp1 != 1 && mp2 != 1){/*\u4e0d\u5141\u8bb8\u56db\u8fde\u901a*/\n\t\t\t\t\t\t\tupd(nw.state, j, 3);\n\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 3);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(pg1 == 0 || pg2 == 0){/*\u6709\u4e00\u4e2a\u63d2\u5934*/\n\t\t\t\t\t\tint pg, mp, posi;\n\t\t\t\t\t\tif(pg1 == 0)\n\t\t\t\t\t\t\tpg =pg2, mp =mp1, posi =j+1;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tpg =pg1, mp =mp2, posi =j;\n\t\t\t\t\t\tif(mp != 1){/*\u5224\u65ad\u56db\u8fde\u901a*/\n\t\t\t\t\t\t\tif(pg == 3){/*\u5408\u5e76\u72ec\u7acb\u63d2\u5934*/\n\t\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{/*\u8fde\u63a5\u7684\u4e0d\u662f\u4e00\u4e2a\u72ec\u7acb\u63d2\u5934\uff0c\u8981\u66f4\u65b0\u62ec\u53f7*/\n\t\t\t\t\t\t\t\tupdbracket(nw.state, posi, 3);\n\t\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse/*\u6709\u4e24\u4e2a\u63d2\u5934\uff0c\u8fd9\u683c\u4e5f\u5fc5\u987b\u6709\u4e24\u4e2a\u63d2\u5934\u3002\u4f46\u8981\u6c42\u8fd9\u683c\u5fc5\u987b\u653e\u72ec\u7acb\u63d2\u5934\uff08\u5355\u4e2a\u63d2\u5934\uff09*/\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\telse{/*\u4e3a\u7a7a\u5730*/\n\t\t\t\t\tif(pg1 == 0 && pg2 == 0){\n\t\t\t\t\t\t/*\u65b0\u5efa\u5206\u91cf*/\n\t\t\t\t\t\tif(mp1 != 1 && mp2 != 1){/*\u5224\u65ad\u56db\u8fde\u901a*/\n\t\t\t\t\t\t\tqwq nw2 =nw;\n\t\t\t\t\t\t\tupd(nw2.state, j, 1), upd(nw2.state, j+1, 2);\n\t\t\t\t\t\t\tupd(nw2.state2, j, 1), upd(nw2.state2, j+1, 1);\n\t\t\t\t\t\t\tnw2.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw2);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/*\u653e\u7f6e\u969c\u788d*/\n\t\t\t\t\t\tupd(nw.state2, j, 0), upd(nw.state2, j+1, 0);\n\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t/*\u653e\u7f6e\u70ae\u53f0*/\n\t\t\t\t\t\tif(nw.battery < K){\n\t\t\t\t\t\t\tupd(nw.state2, j, 2), upd(nw.state2, j+1, 2);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 1);\n\t\t\t\t\t\t\tnw.battery +=1;\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(pg1 == 0 || pg2 == 0){/*\u5ef6\u4f38\u8def\u5f84*/\n\t\t\t\t\t\tint pg, mp;\n\t\t\t\t\t\tif(pg1 == 0)\n\t\t\t\t\t\t\tpg =pg2, mp =mp1;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tpg =pg1, mp =mp2;\n\t\t\t\t\t\tif(mp != 1){/*\u5224\u65ad\u56db\u8fde\u901a*/\n\t\t\t\t\t\t\tupd(nw.state, j, pg), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, pg);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse{/*\u6709\u4e24\u4e2a\u63d2\u5934*/\n\t\t\t\t\t\tif(pg1 == 3 && pg2 == 3){/*\u4e24\u4e2a\u72ec\u7acb\u63d2\u5934*/\n\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(pg1 == 3 || pg2 == 3){/*\u6709\u4e00\u4e2a\u72ec\u7acb\u63d2\u5934*/\n\t\t\t\t\t\t\tint posi;\n\t\t\t\t\t\t\tif(pg1 == 3)\n\t\t\t\t\t\t\t\tposi =j+1;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tposi =j;\n\t\t\t\t\t\t\tupdbracket(nw.state, posi, 3);\n\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(pg1 == pg2){/*\u4e24\u4e2a\u76f8\u540c\u63d2\u5934\uff0c\u8981\u6539\u62ec\u53f7*/\n\t\t\t\t\t\t\tif(pg1 == 1)\n\t\t\t\t\t\t\t\tupdbracket(nw.state, j+1, 1);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tupdbracket(nw.state, j, 2);\n\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(pg1 == 2 && pg2 == 1){/*\u4e24\u4e2a\u4e0d\u540c\u63d2\u5934\uff0c\u4e14\u6ca1\u5f62\u6210\u56de\u8def*/\n\t\t\t\t\t\t\tupd(nw.state, j, 0), upd(nw.state, j+1, 0);\n\t\t\t\t\t\t\tupd(nw.state2, j, 1), upd(nw.state2, j+1, 1);\n\t\t\t\t\t\t\tnw.sum +=count(mp1, lmp, mp2, rmp, 2);\n\t\t\t\t\t\t\tpush(nw);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse/*\u4e0d\u5141\u8bb8\u95ed\u5408\u56de\u8def\u4ea7\u751f*/\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdp.swap(hsh);\n\t\t\tclearhsh();\n\t\t}\n\t}\n}\n\n\nint main(){\n\tscanf(\"%d%d%d\", &n, &m, &K);\n\tif(n >= m){\n\t\tfor(int i =0; i < n; ++i){\n\t\t\tchar c =getchar();\n\t\t\twhile(c != '#' && c != '.' && c != 'S' && c != 'T') c =getchar();\n\t\t\tfor(int j =0; j < m; ++j){\n\t\t\t\tmap[i][j] =c;\n\t\t\t\tc =getchar();\n\t\t\t}\n\t\t}\n\t}\n\telse{/*\u955c\u50cf\u505a\u51fa\u6765\u4e5f\u662f\u5bf9\u7684*/\n\t\tn ^=m ^=n ^=m;\n\t\tfor(int j =0; j < m; ++j){\n\t\t\tchar c =getchar();\n\t\t\twhile(c != '#' && c != '.' && c != 'S' && c != 'T') c =getchar();\n\t\t\tfor(int i =0; i < n; ++i){\n\t\t\t\tmap[i][j] =c;\n\t\t\t\tc =getchar();\n\t\t\t}\n\t\t}\n\t}\n\twork();\n\tll ans =0;\n\tfor(int k =0; k < (int)dp.size(); ++k)\n\t\tif(dp[k].state == 0)\n\t\t\tif(dp[k].sum > ans)\n\t\t\t\tans =dp[k].sum;\n\tprintf(\"%lld\", ans);\n}\n```",
        "postTime": 1594982015,
        "uid": 105254,
        "name": "Piwry",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2337 \u3010[SCOI2012]\u55b5\u661f\u4eba\u7684\u5165\u4fb5\u3011"
    },
    {
        "content": "\u672c\u6587\u7684\u5b9e\u73b0\u8981\u6bd4\u5e38\u89c4\u63d2\u5934 DP \u8981\u590d\u6742\uff08\u5373\u5206\u7c7b\u8ba8\u8bba\u7684\u60c5\u5f62\u66f4\u591a\uff09\u3002\u4f46\u662f\uff0c\u5176\u601d\u60f3\uff08\u5927\u6982\uff09\u4f1a\u6bd4\u5e38\u89c4\u63d2\u5934DP\u8981\u66f4\u52a0\u7b80\u5355\u3002\u4e00\u53e5\u8bdd\uff0c\u672c\u6587\u6bd4\u8f83\u65e0\u8111\u786c\u4e0a\u3002\u540c\u65f6\uff0c\u7801\u91cf\u5728\u5220\u53bb\u6ce8\u91ca\u540e\u5e94\u8be5\u6bd4\u5e38\u89c4\u63d2\u5934 DP \u6709\u4f18\u52bf\uff08\u56e0\u4e3a\u9664\u4e86\u5206\u7c7b\u8ba8\u8bba\u5916\u7ec6\u8282\u4e0d\u591a\uff09\u3002\n\n------\n\n\u9996\u5148\u5148\u9ed8\u8ba4 $n>m$\uff0c\u518d\u4ee4\u4e0b\u6807\u81ea $0$ \u5f00\u59cb\u3002\n\n\u4e00\u4e2a\u7b80\u5355\u7684\u89c2\u5bdf\u662f\u5fc5\u5b9a\u5b58\u5728\u4e00\u79cd\u6700\u4f18\u72b6\u6001\u4f7f\u5f97\u8def\u5f84\u552f\u4e00\u2014\u2014\u56e0\u4e3a\u969c\u788d\u6570\u91cf\u65e0\u9650\u5236\uff0c\u6240\u4ee5\u81ea\u7136\u53ef\u4ee5\u5835\u6b7b\u90a3\u4e9b\u654c\u4eba\u4e0d\u4f1a\u53bb\u7684\u5730\u65b9\u3002\u8fd9\u6837\u4fbf\u662f\u6709\u5173\u8def\u5f84\u7684\u7edf\u8ba1\uff0c\u53c8\u662f\u7f51\u683c\u56fe\uff0c\u8003\u8651\u63d2\u5934 DP\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u63d2\u5934 DP \u5e76\u4e0d\u597d\uff0c\u56e0\u4e3a\u5e76\u975e\u6240\u6709\u4fe1\u606f\u90fd\u80fd\u7528\u63d2\u5934\u8868\u793a\uff0c\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\u662f\u683c\u5b50\u4e2d\u6709\u65e0\u70ae\u53f0\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8003\u8651\u538b\u7f29\u8f6e\u5ed3\u7ebf\u5468\u56f4\u7684**\u65b9\u683c**\u800c\u975e**\u63d2\u5934**\u3002\n\n\u56e0\u4e3a\u4e00\u4e2a\u70ae\u53f0\u5f71\u54cd\u516b\u8fde\u901a\u7684\u683c\u5b50\uff0c\u6240\u4ee5\u4e00\u4e2a\u663e\u7136\u7684\u60f3\u6cd5\u662f\u538b\u7f29 $m+1$ \u4e2a\u683c\u5b50\u7684\u72b6\u6001\u3002\u5047\u5982\u5f53\u524d\u51b3\u7b56\u70b9\u662f $(x,y)$\uff0c\u5219\u72b6\u6001\u4e2d\u5e94\u8be5\u5b58\u50a8\u7b2c $x$ \u884c\u4e2d $0\\sim y-1$ \u4f4d\u7f6e\u7684\u72b6\u6001\uff0c\u4ee5\u53ca\u7b2c $x-1$ \u884c\u4e2d $y-1\\sim m-1$ \u4f4d\u7f6e\u7684\u72b6\u6001\u3002\u8fd9\u6837\u5728\u51b3\u7b56 $(x,y)$ \u65f6\uff0c\u6240\u6709\u5b83\u80fd\u5f71\u54cd\u5230\u4ee5\u53ca\u80fd\u5f71\u54cd\u5230\u5b83\u7684\u4f4d\u7f6e\u5168\u90e8\u88ab\u8bb0\u5f55\u5728\u72b6\u6001\u4e2d\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u72b6\u6001\u7684\u6bcf\u4e00\u4f4d\u586b\u4ec0\u4e48\u3001\u5404\u8868\u793a\u4ec0\u4e48\u610f\u4e49\uff1a\n\n0. \u8fd9\u4e2a\u683c\u5b50\u653e\u7f6e\u4e86\u969c\u788d\u3002\n1. \u8fd9\u4e2a\u683c\u5b50\u662f\u8def\u5f84\u4e2d\u67d0\u4e00\u6bb5\u7684\u5de6\u7aef\u70b9\u3002\n2. \u8fd9\u4e2a\u683c\u5b50\u662f\u8def\u5f84\u4e2d\u67d0\u4e00\u6bb5\u7684\u53f3\u7aef\u70b9\u3002\n3. \u8fd9\u4e2a\u683c\u5b50\u5728\u8def\u5f84\u4e0a\uff0c\u4f46\u4e0d\u662f\u7aef\u70b9\u3002\n4. \u8fd9\u4e2a\u683c\u5b50\u662f\u7aef\u70b9\uff0c\u4f46\u662f\u6b64\u6bb5\u8def\u5f84\u7684\u53e6\u4e00\u4e2a\u7aef\u70b9\u662f\u8d77\u70b9/\u7ec8\u70b9\u3002\n5. \u8fd9\u4e2a\u683c\u5b50\u653e\u7f6e\u4e86\u70ae\u53f0\u3002\n6. \u8fd9\u4e2a\u683c\u5b50\u662f\u67d0\u4e00\u6bb5\u8def\u5f84\u7684\u8d77\u70b9\u3002\uff08\u4e5f\u5373\uff0c\u5176\u540c\u65f6\u662f1\u548c2\uff09\u3002\n\n\u9664\u4e86\u72b6\u60016\u5176\u5b83\u90fd\u6bd4\u8f83\u597d\u7406\u89e3\uff0c\u552f\u72ec\u72b6\u60016\u6bd4\u8f83\u5947\u602a\u3002\u4f46\u662f\u4e8b\u5b9e\u4e0a\u4ed4\u7ec6\u4e00\u60f3\u8fd9\u662f\u6b63\u5e38\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u8bb0\u5f55\u7684\u662f**\u65b9\u683c\u72b6\u6001**\u800c\u975e**\u63d2\u5934\u72b6\u6001**\uff0c\u5982\u679c\u8bb0\u5f55\u7684\u662f\u63d2\u5934\u90a3\u4e486\u5c31\u53ef\u4ee5\u7528\u4e00\u4e2a\u4e0b\u63d2\u5934+\u4e00\u4e2a\u53f3\u63d2\u5934\u8868\u793a\uff0c\u4f46\u662f\u65b9\u683c\u5c31\u53ea\u80fd\u8001\u8001\u5b9e\u5b9e\u65b0\u5efa\u72b6\u6001\u8868\u793a\u3002\n\n\u56e0\u4e3a\u4ec5\u4ec5\u662f\u7f16\u53f7\u5c31\u592a\u62bd\u8c61\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u6240\u6709\u72b6\u6001\u7528\u4e00\u4e2a\u5f62\u5bb9\u8bcd\u6765\u4fee\u9970\u4e00\u4e0b\uff1a\n\n- 0&5\uff0c\u8fd9\u4e24\u4e2a\u72b6\u6001\u662f\u201c\u7edd\u7f18 `insulated`\u201d\u7684\uff0c\u5b83\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u4e92\u52a8\uff08\u5f53\u7136\uff0c5\u4f1a\u5bf9\u5468\u8fb9\u7684\u683c\u5b50\u6709\u8f90\u5c04\uff0c\u4f46\u662f\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u683c\u5b50\u7684\u72b6\u6001\uff0c\u4ec5\u4ec5\u5f71\u54cd\u7b54\u6848\u7f62\u4e86\uff09\u3002\n- 3\uff0c\u8fd9\u4e2a\u72b6\u6001\u662f\u201c\u60f0\u6027 `inert`\u201d\u7684\uff0c\u5b83\u4e0d\u4f1a\u6269\u5c55\uff0c\u5468\u8fb9\u4e5f\u4e0d\u5e94\u8be5\u51fa\u73b0\u5176\u5b83\u975e\u7edd\u7f18\u72b6\u6001\uff08\u4e0d\u7136\u8def\u5f84\u5c31\u4f1a\u4e0d\u552f\u4e00\uff09\u3002\n- 6\uff0c\u8fd9\u4e2a\u72b6\u6001\u662f\u201c\u591a\u52a8 `hyperactive`\u201d\u7684\uff08\u5b9e\u9645\u4e0a\u6211\u672c\u6765\u60f3\u7528\u201c\u6d3b\u6cfc\u201d\u6765\u4fee\u9970\uff0c\u4f46\u662f `hyperactive` \u8fd9\u4e2a\u8bcd\u592a\u6709\u97f5\u5473\u4e86\uff0c`hyper-` \u524d\u7f00\u9664\u4e86\u201c\u8fc7\u4e8e\u6d3b\u6cfc\u201d\u4e5f\u6709\u201c\u865a\u62df\u201d\u7684\u610f\u601d\uff0c\u521a\u597d\u8868\u793a\u72b6\u60016\u5b9e\u9645\u4e0a\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u5176\u771f\u5b9e\u610f\u4e49\u662f1\u548c2\u6324\u5728\u4e00\u4e2a\u683c\u5b50\u4e2d\uff09\u3002\u5b83\u5728\u4ea7\u751f\u7684\u4e0b\u4e00\u8f6eDP\u4e2d\uff0c\u5c31\u4f1a\u7acb\u9a6c\u201c\u88c2\u53d8\u201d\u53d8\u56de1\u548c2\u3002\u540c\u65f6\uff0c\u201c\u591a\u52a8\u201d\u4e5f\u8868\u793a\u5b83\u81ea\u7136\u4ea7\u751f\u6761\u4ef6\u4e25\u82db\uff08\u5468\u8fb9\u53ea\u80fd\u5b58\u5728\u7edd\u7f18\u7684\u683c\u5b50\uff09\u3002\n- 4\uff0c\u8fd9\u4e2a\u72b6\u6001\u662f\u201c\u5bc4\u751f `parasitic`\u201d\u7684\u3002\u5b83\u81ea\u7136\u4ea7\u751f\u6761\u4ef6\u975e\u5e38\u4e25\u82db\uff08\u548c6\u4e00\u6837\uff09\uff0c\u4f46\u662f\u5374\u53ef\u4ee5\u4f9d\u6258\u67d0\u6bb5\u8def\u5f84\u4ea7\u751f\u3002\u5e76\u4e14\uff0c\u5b83\u4f1a\u628a\u4e00\u6574\u6bb51-2\u8def\u5f84\u76f4\u63a5\u5bc4\u751f\u62104\u8def\u5f84\u3002\n- 1&2\uff0c\u8fd9\u4e24\u4e2a\u72b6\u6001\u662f\u201c\u5e73\u51e1 `mundane`\u201d\u7684\uff0c\u5b83\u6ca1\u6709\u8fc7\u591a\u7684\u7279\u5f81\u3002\n\n\u75288\u8fdb\u5236\u538b\u7f297\u8fdb\u5236\u662f\u8001\u751f\u5e38\u8c08\u4e86\u3002$f(x,y,w,k)$ \u8868\u793a\u5f85\u51b3\u7b56\u7684\u683c\u5b50\u662f $(x,y)$\u3001\u586b\u5165\u70ae\u53f0\u6570\u662f $w$\u3001\u72b6\u6001\u662f $k$ \u65f6\u7684\u7b54\u6848\u5e94\u8be5\u4e5f\u4e0d\u96be\u60f3\u5230\u3002\u7136\u540e\u73b0\u5728\u6211\u4eec\u6765\u8003\u8651\u5982\u4f55\u8f6c\u79fb\u3002\n\n> \u9644\uff1a\u6211\u6700\u8fd1\u627e\u5230\u4e00\u79cd\u5f62\u8c61\u5730\u7ed9\u7f51\u683c\u56fe\u4e0a\u53d8\u91cf\u53d6\u540d\u7684\u597d\u65b9\u6cd5\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5411\u952e\u76d8\u3002\n>\n> ```\n> QWERTYUIOP\n> ASDFGHJKL\n> ZXCVBNM\n> ```\n>\n> \u5047\u5982\u6211\u4eec\u5f53\u524d\u5173\u5fc3\u7684\u683c\u5b50\u662f `J` \u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u8f7b\u677e\u5f97\u5230\u5176\u5b83\u65b9\u4f4d\u7684\u53d8\u91cf\u7684\u547d\u540d\uff1a\u5de6\u4fa7\u662f `H`\uff0c\u5de6\u4e0a\u662f `Y`\uff0c\u4e0a\u65b9\u662f `U`\uff0c\u53f3\u4e0a\u662f `I`\u3002\u8fd9\u51e0\u4e2a\u4f4d\u7f6e\u662f\u6211\u4eec\u51b3\u7b56 `J` \u65f6\u9700\u8981\u77e5\u9053\u7684\u4fe1\u606f\u3002\n>\n> \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u9009\u62e9 `J` \u800c\u4e0d\u9009\u5176\u5b83\u5b57\u7b26\u561b\uff0c\u56e0\u4e3a\u5176\u5b83\u5b57\u7b26\u5468\u8fb9\u7684\u533a\u57df\u4e2d\u7684\u5927\u5199\u5b57\u7b26\u5df2\u7ecf\u88ab\u6211\u5360\u7528\u4e86\u3002\n>\n> ~~\u751a\u81f3\u53ef\u4ee5\u51fa\u4e00\u9053\u9898\u76ee\uff1a\u952e\u76d8\u4e0a\u6709\u4e00\u4e9b\u5927\u5199\u5b57\u7b26\u5df2\u7ecf\u88ab\u5360\u7528\uff0c\u6c42\u6700\u591a\u80fd\u6316\u51fa\u51e0\u5757\u8fd9\u6837\u7684\u533a\u57df\u3002~~\n>\n> ~~\u7136\u540e\u53d1\u73b0\u8fd9\u4e5f\u53ef\u4ee5\u7528\u8f6e\u5ed3\u7ebfDP\u89e3\u51b3\u3002~~\n\n\u597d\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u8003\u8651\u8f6c\u79fb\u3002\n\n\u9996\u5148\uff0c\u5f53\u524d\u683c `J` \u586b\u5165\u975e\u7edd\u7f18\u72b6\u6001\uff08\u5373\u662f\u8def\u5f84\u7684\u4e00\u90e8\u5206\uff09\u548c\u586b\u51655\u65f6\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u53ef\u4ee5\u7531 `H,Y,U,I` \u56db\u4e2a\u72b6\u6001\u5904\u7406\u5f97\u5230\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u8003\u8651\u8f6c\u79fb\u3002\n\n\u9996\u5148\u5148\u8003\u8651 $(x,y)$ \u586b\u5165\u7684\u4e1c\u897f\u5e76\u975e\u7531 `H,U` \u7684\u72b6\u6001\u5ef6\u4f38\u800c\u6765\u7684\u60c5\u5f62\u3002\n\n- \u8003\u86516\u4ee5\u53ca4\uff08\u5728\u4e0d\u5bc4\u751f\u4e00\u6761\u73b0\u5b58\u8def\u5f84\u7684\u65f6\u5019\uff09\u7684\u4ea7\u751f\uff08\u4e8c\u8005\u6761\u4ef6\u76f8\u540c\uff09\u3002\u6211\u4eec\u4e0a\u6587\u5df2\u7ecf\u63d0\u5230\u5176\u4ea7\u751f\u6761\u4ef6\u82db\u523b\uff0c\u5373\u987b\u6ee1\u8db3 `H,U` \u7edd\u7f18\u4e14\u5f53\u524d\u683c\u5b50\u975e\u969c\u788d\u3002\u6b64\u65f6\uff0c\u82e5\u5f53\u524d\u683c\u5b50\u975e\u8d77\u8bab\u70b9\uff0c\u5219\u53ef\u586b\u51656\u3002\u5426\u5219\uff0c\u5373\u5176\u662f\u8d77\u8bab\u70b9\uff0c\u5219\u53ef\u586b\u51654\u3002\n\n- \u8003\u8651\u586b\u5165\u7edd\u7f18\u72b6\u6001\u7684\u60c5\u5f62\u3002\u5176\u9650\u5236\u662f\u5f53\u524d\u683c\u5b50\u975e\u8d77\u8bab\u70b9\u3001`H` \u4e0d\u80fd\u586b\u5165\u591a\u52a8\u76846\uff08\u56e0\u4e3a6\u5728\u4ea7\u751f\u540e\u4f1a\u7acb\u9a6c\u88c2\u53d8\u6210\u4e3a1\u548c2\uff0c\u56e0\u6b64\u5982\u679c\u5f53\u524d\u70b9\u662f\u7edd\u7f18\u72b6\u6001\u7684\u8bdd\u5c31\u4f1a\u963b\u6b626\u7684\u88c2\u53d8\uff09\uff0c\u4ee5\u53ca `U` \u53ea\u80fd\u586b\u5165\u7edd\u7f18\u76840&5\u6216\u8005\u60f0\u6027\u76843\u2014\u2014\u56e0\u4e3a\u975e\u7edd\u7f18\u3001\u975e\u60f0\u6027\u7684\u72b6\u6001\u662f\u603b\u8981\u5ef6\u4f38\u7684\uff0c\u4e0d\u5f80\u53f3\u8fb9\u5ef6\u4f38\u5c31\u5f80\u4e0b\u8fb9\u5ef6\u4f38\uff0c\u800c `U` \u5f80\u53f3\u8fb9\u5ef6\u4f38\u7684\u8def\u5df2\u7ecf\u88ab `I` \u5835\u6b7b\u4e86\uff0c\u6240\u4ee5\u975e\u7edd\u7f18\u3001\u975e\u60f0\u6027\u7684 `U` \u5fc5\u987b\u5f80\u4e0b\u5ef6\u4f38\uff0c\u5219\u5f53\u524d\u683c\u5b50\u4e0d\u80fd\u7edd\u7f18\u3002\u6b64\u65f6\uff0c\u65e0\u8bba\u5982\u4f55\u90fd\u53ef\u4ee5\u586b\u51650\uff0c\u800c\u5f53\u5f53\u524d\u683c\u5b50\u975e\u969c\u788d\u65f6\u5c31\u53ef\u586b\u51655\u3002\n\n\u5176\u5b83\u6240\u6709\u72b6\u6001\u90fd\u662f\u7531 `H,U` \u7684\u72b6\u6001\u5ef6\u4f38\u6216\u62fc\u63a5\u800c\u6210\u7684\u3002\u6240\u4ee5\u8fd9\u65f6\uff0c\u5982\u679c\u683c\u5b50\u6709\u969c\u788d\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5 `continue` \u4e86\u2014\u2014\u969c\u788d\u683c\u663e\u7136\u4e0d\u80fd\u6210\u4e3a\u5ef6\u4f38\u6216\u62fc\u63a5\u7684\u53bb\u5904\u3002\n\n- \u8003\u8651 `U` \u975e\u7edd\u7f18\u975e\u60f0\u6027\uff0c\u5373\u5176\u5fc5\u987b\u5ef6\u4f38\u7684\u60c5\u5f62\u3002\n    - \u8003\u8651 `H` \u975e\u7edd\u7f18\uff0c\u5373\u5ef6\u4f38\u7684 `U` \u5fc5\u7136\u4f1a\u5bfc\u81f4\u4e24\u6761\u8def\u5f84\u4ea4\u6c47\u7684\u60c5\u5f62\u3002\n        - \u5f53\u524d\u683c\u5b50\u662f\u8d77\u8bab\u70b9\u3002\u6b64\u65f6\u5c31\u4f1a\u53d1\u751f\u4ece\u5f53\u524d\u683c\u5b50\u51fa\u53d1\u6709\u4e24\u6761\u4e0d\u540c\u8def\u5f84\u7684\u60c5\u5f62\uff0c\u56e0\u6b64 `continue`\u3002\n        - `H=3`\uff1a\u56e0\u4e3a\u6b64\u65f6 `H` \u975e\u7aef\u70b9\uff0c\u6240\u4ee5\u5c31\u4f1a\u51fa\u73b0\u8def\u5f84\u4e0d\u552f\u4e00\u7684\u72b6\u51b5\uff0c\u56e0\u6b64\u72b6\u6001\u4e0d\u5408\u6cd5\uff0c\u76f4\u63a5 `continue` \u6389\u3002\n        - `Y` \u975e\u7edd\u7f18\uff0c\u6b64\u65f6\u5c31\u4f1a\u51fa\u73b0\u56db\u4e2a\u76f8\u90bb\u4f4d\u7f6e\u6210\u56e2\u7684\u73b0\u8c61\uff0c\u72b6\u6001\u4e0d\u5408\u6cd5\uff0c\u76f4\u63a5 `continue`\u3002\n        - `U=6`\uff0c\u8fd9\u4e2a\u72b6\u6001\u4e0d\u53ef\u80fd\u51fa\u73b0\uff08\u56e0\u4e3a6\u4e00\u51fa\u73b0\u5c31\u4f1a\u88c2\u53d8\uff09\uff0c\u76f4\u63a5 `continue`\u3002\n        - `H=1,U=1 \u6216 H=2,U=2`\uff0c\u8fd9\u4e24\u4e2a\u72b6\u6001\u540c\u5e38\u89c4\u63d2\u5934DP\u7c7b\u4f3c\uff0c\u5408\u5e76\u540e\u4fee\u6539\u5176\u4e2d\u4e00\u6761\u8def\u5f84\u7684\u53e6\u4e00\u7aef\u70b9\u5373\u53ef\u3002\u6ce8\u610f\u5408\u5e76\u5b8c\u540e `HJU` \u90fd\u53d8\u62103\uff08\u8def\u5f84\u7684\u975e\u7aef\u70b9\u90e8\u5206\uff09\u3002\n        - `H=1,U=2`\uff0c\u8fd9\u65f6\u8def\u5f84\u6210\u73af\uff0c`continue`\u3002\n        - `H=2,U=1`\uff0c\u540c\u5e38\u89c4\u63d2\u5934DP\u4e00\u81f4\uff0c\u76f4\u63a5\u5408\u5e76\u3002\u6ce8\u610f\u5408\u5e76\u5b8c `HJU` \u90fd\u53d8\u62103\u3002\n        - `H=4,U=4`\uff0c\u8fd9\u65f6\u76f8\u5f53\u4e8e\u5b8c\u6574\u7684\u4e00\u6761\u8def\u5f84\u88ab\u62fc\u63a5\u6210\u4e86\uff0c\u76f4\u63a5\u5408\u5e76\uff0c`HJU` \u53d8\u62103\u3002\n        - `H=4,U=1 \u6216 H=1,U=4`\uff0c\u8fd9\u4e24\u4e2a\u72b6\u6001\u76f8\u4f3c\uff0c\u628a\u4e0e\u5176\u4e2d\u76841\u5bf9\u5e94\u76842\u8d4b\u62104\u3001`HJU` \u53d8\u62103\u5373\u53ef\u3002\n        - `H=4,U=2 \u6216 H=2,U=4`\uff0c\u8fd9\u4e24\u4e2a\u72b6\u6001\u76f8\u4f3c\uff0c\u628a\u4e0e\u5176\u4e2d\u76842\u5bf9\u5e94\u76841\u8d4b\u62104\u3001`HJU` \u53d8\u62103\u5373\u53ef\u3002\n        - `H=6`\uff0c\u8fd9\u65f6\u5c31\u628a\u5b83\u5f53\u4f5c1\u4e0e2\u7684\u5408\u4f53\u8ba1\u7b97\u5373\u53ef\u3002\n    - \u8003\u8651 `H` \u7edd\u7f18\uff0c\u53ea\u6709 `U` \u5ef6\u4f38\u7684\u60c5\u5f62\u3002\n        - \u8003\u8651\u5f53\u524d\u683c\u5b50\u662f\u8d77\u8bab\u70b9\u3002\u5982\u679c `U` \u662f1\u62162\u5c31\u4fee\u6539\u5bf9\u5e94\u53e6\u4e00\u7aef\u70b9\u4e3a4\uff0c`JU` \u53d8\u62103\uff1b\u5982\u679c `U` \u4e5f\u662f4\u5c31\u76f4\u63a5 `JU` \u53d8\u62103\u5373\u53ef\u3002\n        - \u8003\u8651\u5f53\u524d\u683c\u5b50\u975e\u8d77\u8bab\u70b9\u3002\u6b64\u65f6\u5c31\u628a `J` \u8d4b\u4f5c `U`\uff0c`U` \u8d4b\u4f5c3\u5373\u53ef\u3002\n- \u5269\u4f59\u60c5\u5f62\u4e0b\uff0c\u5c31\u662f `U` \u65e0\u6cd5\u5ef6\u4f38\u7684\u72b6\u6001\u4e86\u3002\u56e0\u4e3a\u4e24\u4e2a\u683c\u5b50\u5747\u4e0d\u5ef6\u4f38\u7684\u60c5\u5f62\u6211\u4eec\u5df2\u7ecf\u8ba8\u8bba\u8fc7\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u9700\u8ba8\u8bba `H` \u5ef6\u4f38\u7684\u60c5\u5f62\u3002\u6b64\u65f6\u8981\u6c42 `H` \u975e\u7edd\u7f18\uff0c\u975e\u60f0\u6027\u3002\n    - `U=3`\u3002\u540c\u4e0a\uff0c\u8def\u5f84\u4e0d\u552f\u4e00\uff0c`continue`\u3002\n    - \u5269\u4e0b\u7684\u5c31\u8ddf `H` \u7edd\u7f18 `U` \u5ef6\u4f38\u7684\u8f6c\u79fb\u5dee\u4e0d\u591a\u4e86\u3002\u552f\u4e00\u9700\u8981\u6ce8\u610f\u7684\u662f `H` \u53ef\u80fd\u4e3a6\uff0c\u6b64\u65f6\u5c31\u5f53\u4f5c1\u548c2\u540c\u65f6\u5b58\u5728\u5373\u53ef\u3002\n\n\u4e0d\u91cd\u4e0d\u6f0f\uff0c\u8ba8\u8bba\u5b8c\u6bd5\u3002\n\n\u4ee3\u7801\uff08\u9644\u6709\u8be6\u7ec6\u6ce8\u91ca\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int fni=0xc0c0c0c0;\nint n,m,p,hs[2100000],sta[50000],cnt,res;\nvoid pr(int x){for(int i=0;i<=m;i++)printf(\"%d\",(x>>i*3)&7);}\nint f[2][16][50000];\n//0:block 1:left plug 2:right plug 3:part of the route 4:free plug 5:cannon 6:bi-direction plug\n//0&5 are 'insulated',which do not act with any state.\n//3 is 'inert',which cannot expand.\n//6 is 'hyperactive',which has the necessity of expanding in both directions.\n//4 is 'parasitic',which need a 1/2 plug to produce, otherwise it is as difficult as 6 when to be produced.\n//1&2 are 'mundane',which do not have strong characteristics.\n//all plugs except the 'insulated' 0&5 and the 'inert' 3, once put above, will always expand.\nchar s[30][30];\nint num[30];\nvoid dfs1(int pos,int msk,int fre,int tms){\n\tif(pos==m+1){\n\t\tif(tms)return;\n\t\tfor(int i=1;i<pos;i++){\n\t\t\tif((num[i]==1||num[i]==2||num[i]==4)&&num[i-1]==3&&num[i+1]==3)return;\n\t\t\tif(num[i]==6&&(num[i-1]==3||num[i+1]==3))return;\n\t\t}\n\t\tcnt++,hs[msk]=cnt,sta[cnt]=msk;\n\t\treturn;\n\t}\n\tnum[pos]=0;dfs1(pos+1,msk,fre,tms);\n\tnum[pos]=3,dfs1(pos+1,msk+(3<<pos*3),fre,tms);\n\tnum[pos]=5;dfs1(pos+1,msk+(5<<pos*3),fre,tms);\n\tif(!pos||num[pos-1]==0||num[pos-1]==5){\n\t\tnum[pos]=1,dfs1(pos+1,msk+(1<<pos*3),fre,tms+1);\n\t\tnum[pos]=6,dfs1(pos+1,msk+(6<<pos*3),fre,tms);\n\t}\n\tif(!pos||(num[pos-1]!=2&&num[pos-1]!=6&&num[pos-1]!=4))num[pos]=2,dfs1(pos+1,msk+(2<<pos*3),fre,tms-1);\n\tif((!pos||num[pos-1]==0||num[pos-1]==5||num[pos-1]==3)&&fre<2)num[pos]=4,dfs1(pos+1,msk+(4<<pos*3),fre+1,tms);\n}\nint nex(int y,int k){\n\tif(y==m-1){\n\t\tint L=k>>m*3;k-=(L<<m*3);\n\t\tif(L!=0&&L!=3&&L!=5)return 0;\n\t\treturn hs[k<<3];\n\t}\n\treturn hs[k];\n}\nint P=0,Q=1;\nvoid chmx(int j,int w,int id,int nw,int K,int bon=0){\n\tint nid=nex(j,K);\n//\tprintf(\"%d:\",nid),pr(K),puts(\"\");\n\tif(nid&&nw<=p)f[Q][nw][nid]=max(f[Q][nw][nid],f[P][w][id]+bon);\n}\nint nex2(int y,int K){\n\tfor(int i=y,j=0;i<=m;i++){\n\t\tif(((K>>i*3)&7)==1)j++;\n\t\tif(((K>>i*3)&7)==2&&!j--)return i;\n\t}\n}\nint las1(int y,int K){\n\tfor(int i=y,j=0;i>=0;i--){\n\t\tif(((K>>i*3)&7)==2)j++;\n\t\tif(((K>>i*3)&7)==1&&!j--)return i;\n\t}\n}\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&p);\n\tfor(int i=0;i<n;i++)scanf(\"%s\",s[i]);\n\tif(n<m){\n\t\tfor(int i=0;i<n;i++)for(int j=i+1;j<m;j++)swap(s[i][j],s[j][i]);\n\t\tswap(n,m); \n\t}\n\tdfs1(0,0,0,0);\n//\tprintf(\"%d\\n\",cnt);\n//\tfor(int i=1;i<=cnt;i++)pr(sta[i]),puts(\"\");\n\tmemset(f[P],fni,sizeof(f[P]));\n\tf[P][0][hs[0]]=0;\n\tfor(int i=0;i<n;i++)for(int j=0;j<m;j++,P^=1,Q^=1){\n\t\tmemset(f[Q],fni,sizeof(f[Q]));\n\t\tfor(int w=0;w<=p;w++)for(int id=1;id<=cnt;id++){\n\t\t\tif(f[P][w][id]<0)continue;\n\t\t\tint k=sta[id];\n//\t\t\tprintf(\"(%d,%d)[%d,%d]\",i,j,w,id);pr(k);printf(\":%d\\n\",f[P][w][id]);\n\t\t\tint H=0,Y=(k>>j*3)&7,U=(k>>(j+1)*3)&7,I=(k>>(j+2)*3)&7;\n\t\t\tif(U==6)continue;\n\t\t\t//impossible to have 6 above, as 'hyperactive' 6 is 'hyper', will immediately fission into 1&2.\n\t\t\tint K=k-(Y<<j*3),KHU=K;\n\t\t\tK-=(U<<(j+1)*3);int KH=K;\n\t\t\tif(j)H=((k>>(j-1)*3)&7),K-=(H<<(j-1)*3);\n\t\t\tint bon=(H==5)+(Y==5)+(U==5)+(I==5);\n\t\t\tint nob=(H!=0&&H!=5)+(Y!=0&&Y!=5)+(U!=0&&U!=5)+(I!=0&&I!=5);\n\t\t\tif((H==0||H==5)&&(U==0||U==5)&&s[i][j]!='#'){\n\t\t\t\t//situation of producing 'hyperactive' 6 and 'parasitic' 4(when it does not parasitize)\n\t\t\t\tif(s[i][j]=='S'||s[i][j]=='T')chmx(j,w,id,w,KHU+(4<<j*3),bon);\n\t\t\t\telse chmx(j,w,id,w,KHU+(6<<j*3),bon);\n\t\t\t}\n\t\t\tif(H!=6&&(U==0||U==5||U==3)&&s[i][j]!='S'&&s[i][j]!='T'){\n\t\t\t\t//situation where it is possible to put 'insulated' 0&5 in.\n\t\t\t\tchmx(j,w,id,w,KHU);//putting 0.\n\t\t\t\tif(s[i][j]!='#')chmx(j,w,id,w+1,KHU+(5<<j*3),nob);//putting 5.\n\t\t\t}\n\t\t\tif(s[i][j]=='#')continue;//the only operation under this circumstance is putting 0.\n\t\t\tif(U!=0&&U!=5&&U!=3){//situation when U has to expand.\n\t\t\t\tif(H!=0&&H!=5){//two plugs meet.\n\t\t\t\t\tif(s[i][j]=='S'||s[i][j]=='T')continue;//there can't be two different routes around endpoints.\n\t\t\t\t\tif(H==3)continue;//H has been on a complete route.\n\t\t\t\t\tif(Y!=0&&Y!=5)continue;//a 'cancer' forms, which is invalid. \n\t\t\t\t\tif(H==1&&U==1)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3)-(1<<nex2(j,K)*3),bon);\n\t\t\t\t\t//two 1s will 'alpha-fusion', turing a 2 into 1, and leaving three 3s. \n\t\t\t\t\tif(H==1&&U==2)continue;//1&2 will 'circle', which is invalid.\n\t\t\t\t\tif(H==2&&U==1)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3),bon);\n\t\t\t\t\t//2&1 will 'beta-fusion',only leaving three 3s. \n\t\t\t\t\tif(H==2&&U==2)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3)+(1<<las1(j,K)*3),bon);\n\t\t\t\t\t//two 2s will 'gamma-fusion', turing an 1 into 2, and leaving three 3s.\n\t\t\t\t\tif(H==6&&U==1)chmx(j,w,id,w,K+(1<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3),bon);\n\t\t\t\t\tif(H==6&&U==2)chmx(j,w,id,w,K+(2<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3),bon);\n\t\t\t\t\t//6 shall be seen as 1+2.\n\t\t\t\t\tif(H==4&&U==4){chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3),bon);continue;}\n\t\t\t\t\t//two 'parasitic' 4, forming a complete route.\n\t\t\t\t\tif(H==4&&U==1||H==1&&U==4)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3)+(2<<nex2(j,K)*3),bon);\n\t\t\t\t\tif(H==4&&U==2||H==2&&U==4)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3)+(3<<las1(j,K)*3),bon);\n\t\t\t\t\tif(H==6&&U==4)chmx(j,w,id,w,K+(4<<(j-1)*3)+(3<<j*3)+(3<<(j+1)*3),bon);\n\t\t\t\t\t//4 going parasitize. \n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(s[i][j]=='S'||s[i][j]=='T'){\n\t\t\t\t\tif(U==1)chmx(j,w,id,w,KH+(3<<j*3)+(3<<(j+1)*3)+(2<<nex2(j,K)*3),bon);\n\t\t\t\t\tif(U==2)chmx(j,w,id,w,KH+(3<<j*3)+(3<<(j+1)*3)+(3<<las1(j,K)*3),bon);\n\t\t\t\t\tif(U==4)chmx(j,w,id,w,KH+(3<<j*3)+(3<<(j+1)*3),bon);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tchmx(j,w,id,w,KH+(U<<j*3)+(3<<(j+1)*3),bon);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(H!=0&&H!=5&&H!=3){\n\t\t\t\tif(U==3)continue;\n\t\t\t\tif(s[i][j]=='S'||s[i][j]=='T'){\n\t\t\t\t\tif(H==1)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(2<<nex2(j,K)*3)+(U<<(j+1)*3),bon);\n\t\t\t\t\tif(H==2)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(3<<las1(j,K)*3)+(U<<(j+1)*3),bon);\n\t\t\t\t\tif(H==4)chmx(j,w,id,w,K+(3<<(j-1)*3)+(3<<j*3)+(U<<(j+1)*3),bon);\n\t\t\t\t\tif(H==6)chmx(j,w,id,w,K+(4<<(j-1)*3)+(3<<j*3)+(U<<(j+1)*3),bon);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(H==1||H==2||H==4)chmx(j,w,id,w,K+(3<<(j-1)*3)+(H<<j*3)+(U<<(j+1)*3),bon);\n\t\t\t\telse chmx(j,w,id,w,K+(1<<(j-1)*3)+(2<<j*3)+(U<<(j+1)*3),bon);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int j=1;j<=cnt;j++){\n\t\tbool ok=true;\n\t\tint k=sta[j];\n\t\tfor(int t=0;t<=m;t++)if(((k>>t*3)&7)!=0&&((k>>t*3)&7)!=3&&((k>>t*3)&7)!=5){ok=false;break;}\n\t\tif(!ok)continue;\n\t\tfor(int i=0;i<=p;i++)res=max(res,f[P][i][j]);\n\t}\n\tprintf(\"%d\\n\",res);\n//\tfor(int i=1;i<=cnt;i++)pr(sta[i]),puts(\"\");\n\treturn 0;\n}\n```\n\n",
        "postTime": 1626085552,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2337\u3010[SCOI2012]\u55b5\u661f\u4eba\u7684\u5165\u4fb5\u3011"
    },
    {
        "content": "\uff08\u601d\u8def\u5927\u91cf\u53c2\u8003 [DP \u5e26\u5e08 UM \u7684\u535a\u5ba2](https://www.luogu.com.cn/blog/sflsrick/solution-p2337 \"DP \u5e26\u5e08 UM \u7684\u535a\u5ba2\")\uff09\n\n\u4e00\u4e2a\u80fd\u76f4\u63a5\u628a\u4eba\u5e72\u529d\u9000\u7684\u63d2\u5934 DP \u3002\u3002\n\n## Description\n\n\u7ed9\u5b9a\u4e00\u4e2a $n * m$ \u56fe\uff0c\u6709\u4e00\u4e2a\u8d77\u70b9\u548c\u7ec8\u70b9\u548c\u4e00\u4e9b\u7a7a\u5730\uff0c\u4f60\u9700\u8981\u5728\u7a7a\u5730\u4e0a\u653e\u7f6e**\u4e00\u4e9b**\u969c\u788d\u548c**\u4e0d\u8d85\u8fc7 k \u4e2a**\u70ae\u53f0\uff08\u5747\u4e0d\u53ef\u7ecf\u8fc7\uff09\uff0c\u4f7f\u5f97\uff1a\n\n1. \u8d77\u70b9\u548c\u7ec8\u70b9**\u4ecd**\u8fde\u901a\uff0c\u53ef\u4ee5\u5b58\u5728\u591a\u6761\u8def\u5f84\uff1b\n\n2. \u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u70b9\uff08\u8d77\u7ec8\u4e5f\u7b97\uff09\uff0c\u7b54\u6848\u52a0\u4e0a\u8be5\u70b9\u516b\u8fde\u901a\u7684\u70ae\u53f0\u6570\uff0c\u6700\u5927\u5316\u7b54\u6848\uff08\u6ce8\uff1a\u591a\u6761\u8def\u5f84\u7b97\u7b54\u6848**\u6700\u5c0f**\u7684\u4e00\u6761\uff09\u3002\n\n$\\min(n,\\ m) \\leq 6,\\ \\max(n,\\ m) \\leq 20,\\ 1\\leq k \\leq 15$\n\n## Analysis\n\n\u8fd9\u4e2a\u6570\u636e\u5c31\u5f88\u63d2\u5934 DP \u628a\uff0c\u90a3\u5c31\u4e0d\u53bb\u60f3\u5176\u4ed6\u7684\u4e86\u3002\n\n\u90a3\u65e2\u7136\u662f\u8981\u8def\u5f84\uff08\u4e0d\u662f\u56de\u8def\uff09\uff0c\u90a3\u81ea\u7136\u4e00\u884c\u7684\u72b6\u6001\u5c31\u76f4\u63a5 $0$ \u8868\u793a\u65e0\u63d2\u5934\uff0c $1$ \u8868\u793a\u5de6\u63d2\u5934\uff0c $2$ \u8868\u793a\u53f3\u63d2\u5934\uff0c $3$ \u8868\u793a\u72ec\u7acb\u63d2\u5934\u3002\n\n\u4f46\u662f\u8fd9\u6837\u597d\u50cf\u4e0d\u592a\u591f\uff0c\u56e0\u4e3a\u8003\u8651\u5230\u516b\u8fde\u901a\u4e0b\u7684\u8d21\u732e\uff0c\u9700\u8981\u77e5\u9053\u9644\u8fd1\u51e0\u4e2a\u70b9\u7684\u72b6\u6001\uff0c\u662f\u8def\u5f84\uff0c\u662f\u70ae\u53f0\u8fd8\u662f\u969c\u788d\u3002\n\n\u6240\u4ee5\u9700\u8981\u4e00\u884c\u72b6\u6001\u5f62\u5982\uff08\u7c89\u8272\u90a3\u4e00\u5217\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/z8ogrbh1.png)\n\n\u5bf9\u4e8e\u6253\u53c9\u7684\u70b9\uff0c\u8bb0\u5f55\u7684\u5c31\u662f\u8fd9\u4e9b\u683c\u5b50\u662f\u8def\u5f84\uff0c\u662f\u70ae\u53f0\u8fd8\u662f\u969c\u788d\uff08\u5176\u4ed6\u8fd8\u6709\u56db\u4e2a\u683c\u5b50\u56e0\u4e3a\u90a3\u4e2a\u70b9\u8fd8\u6ca1\u904d\u5386\u5230\uff0c\u4e0d\u8003\u8651\uff09\u3002\n\n\uff08\u8fd9\u4e24\u4e2a\u90fd\u56db\u8fdb\u5236\u5c31\u884c\uff0c**\u6ce8\uff1a\u4e4b\u540e\u63d2\u5934\u7684\u53eb\u72b6\u6001 $1$ \uff0c\u683c\u5b50\u79cd\u7c7b\u7684\u53eb\u72b6\u6001 $2$** \uff09\n\n\u8fd8\u4e0d\u591f\uff0c\u56e0\u4e3a\u6709\u70ae\u53f0\u7684\u9650\u5236\uff0c\u6240\u4ee5\u8fd8\u8981\u52a0\u4e00\u4e2a\u6307\u70ae\u53f0\u6570\u91cf\uff08\u6700\u591a $15$ \u4e2a\u6240\u4ee5\u4e8c\u8fdb\u5236 $4$ \u4f4d\u5c31\u591f\u4e86\uff09\u3002\n\n## Solution\n\n\u6839\u636e **Analysis** \u91cc\u8bf4\u7684\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u6211\u4eec\u63d0\u53d6\u4e0a\u4e00\u884c\u72b6\u6001 $1$ \u7684\u5de6\u683c $pr$ \u548c\u4e0a\u683c $pd$ \uff0c\u72b6\u6001 $2$ \u7684\u5de6\u683c $l$ \uff0c\u5de6\u4e0a\u683c $ul$ \uff0c\u4e0a\u683c $u$ \uff0c\u53f3\u4e0a\u683c $ur$ \u3002\n\n\u554a\u554a\u554a\uff0c** \u5927\u529b\u5206\u8ba8\uff01\uff01\uff08\u63a8\u8350\u753b\u56fe\u98df\u7528\uff09\n\n1. \u5982\u679c\u5de6\uff0c\u4e0a\u90fd\u662f\u8def\u5f84\u4f46\u662f\u90fd\u4e0d\u662f\u63d2\u5934\uff0c\u8bf4\u660e\u8fd9\u4e2a\u5730\u65b9\u4e0d\u80fd\u518d\u6709\u8def\u5f84\u63a5\u4e0a\u53bb\u4e86\uff0c\u8981\u4e48\u653e\u969c\u788d\uff0c\u8981\u4e48\u653e\u70ae\u53f0\u3002\uff08\u4e5f\u5c31\u8fd9\u79cd\u60c5\u51b5\u662f\u548c\u72b6\u6001 $2$ \u6709\u5173\u7684\uff09\n\n2. \u8fd9\u4e2a\u70b9\u672c\u6765\u5c31\u662f\u969c\u788d\u70b9\uff0c\u90a3\u4e5f\u5c31\u53ea\u6709\u5de6\uff0c\u4e0a\u5747\u6ca1\u6709\u63d2\u5934\u7684\u65f6\u5019\u80fd\u8f6c\u79fb\u3002\n\n3. \u8d77\u70b9\u6216\u7ec8\u70b9\uff08\u53ef\u4ee5\u5f62\u8c61\u5316\u6210\u4e00\u4e2a\u72ec\u7acb\u63d2\u5934\uff09\n\n\t\u2460. \u5747\u6ca1\u6709\u63d2\u5934\n    \n\t\u76f4\u63a5\u65b0\u5efa\u72ec\u7acb\u63d2\u5934\u3002\n    \n\t\u2461. \u65e0\u63d2\u5934 + \u5de6\u63d2\u5934\uff08\u6216\u5de6 + \u65e0\uff09\n    \n\t\u5220\u9664\u5f53\u524d\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u5bf9\u5e94\u7684\u53f3\u63d2\u5934\u6539\u6210\u72ec\u7acb\u63d2\u5934\u3002\n    \n\t\u2462. \u65e0\u63d2\u5934 + \u53f3\u63d2\u5934\uff08\u6216\u53f3 + \u65e0\uff09\n    \n\t\u5220\u9664\u5f53\u524d\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u5bf9\u5e94\u7684\u5de6\u63d2\u5934\u6539\u6210\u72ec\u7acb\u63d2\u5934\u3002\n    \n\t\u2463. \u65e0\u63d2\u5934 + \u72ec\u7acb\u63d2\u5934\uff08\u6216\u72ec\u7acb + \u65e0\uff09\n    \n\t\u5220\u9664\u5f53\u524d\u63d2\u5934\uff0c\u6ca1\u5bf9\u5e94\u7684\u63d2\u5934\uff0c\u6240\u4ee5\u6ca1\u4e86\u3002\n\n4. \u7a7a\u5730\uff08\u63d2\u5934\u79cd\u7c7b\u4e0d\u5b9a\uff0c\u8ddf\u7740\u4e4b\u524d\u7684\u8d70\u5c31\u884c\uff09\n\n\t\u2460. \u5747\u6ca1\u6709\u63d2\u5934\n    \n\t\u53ef\u4ee5\u9009\u62e9\u653e\u969c\u788d\uff0c\u653e\u70ae\u53f0\uff0c\u6216\u8005\u5f00\u4e00\u4e2a\u65b0\u8def\u5f84\u3002\n    \n\t\u2461. \u4ec5\u6709\u4e00\u4e2a\u6709\u63d2\u5934\n    \n\t\u8ddf\u7740\u63d2\u5934\u8d70\u5c31\u884c\u4e86\u3002\n    \n\t\u2462. \u90fd\u662f\u5de6\u63d2\u5934\n    \n\t\u5220\u9664\u8fd9\u4e24\u4e2a\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u4e0a\u683c\u63d2\u5934\u5bf9\u5e94\u7684\u53f3\u63d2\u5934\u53d8\u6210\u5de6\u63d2\u5934\u3002\n    \n\t\u2463. \u90fd\u662f\u53f3\u63d2\u5934\n    \n\t\u5220\u9664\u8fd9\u4e24\u4e2a\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u5de6\u683c\u63d2\u5934\u5bf9\u5e94\u7684\u5de6\u63d2\u5934\u53d8\u6210\u53f3\u63d2\u5934\u3002\n    \n\t\u2464. \u53f3\u63d2\u5934 + \u5de6\u63d2\u5934\n    \n\t\u5220\u9664\u8fd9\u4e24\u4e2a\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u5bf9\u5e94\u7684\u4e24\u4e2a\u63d2\u5934\u5de6\u53f3\u4e0d\u53d8\u3002\n    \n\t\u2465. \u5de6\u63d2\u5934 + \u53f3\u63d2\u5934\n    \n\t\u4e0d\u5408\u6cd5\uff0c\u8fd9\u6837\u5c31\u662f\u95ed\u5408\u56de\u8def\u3002\n    \n\t\u2466. \u5de6\u63d2\u5934 + \u72ec\u7acb\u63d2\u5934\uff08\u6216\u72ec\u7acb + \u5de6\uff09\n    \n\t\u5220\u9664\u8fd9\u4e24\u4e2a\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u5bf9\u5e94\u7684\u53f3\u63d2\u5934\u53d8\u6210\u72ec\u7acb\u63d2\u5934\u3002\n    \n\t\u2467. \u53f3\u63d2\u5934 + \u72ec\u7acb\u63d2\u5934\uff08\u6216\u72ec\u7acb + \u53f3\uff09\n    \n\t\u5220\u9664\u8fd9\u4e24\u4e2a\u63d2\u5934\uff0c\u5e76\u4e14\u628a\u5bf9\u5e94\u7684\u5de6\u63d2\u5934\u53d8\u6210\u72ec\u7acb\u63d2\u5934\u3002\n    \n\t\u2468. \u72ec\u7acb\u63d2\u5934 + \u72ec\u7acb\u63d2\u5934\n    \n\t\u76f4\u63a5\u5220\u9664\uff0c\u6ca1\u4ec0\u4e48\u80fd\u4f38\u5c55\u51fa\u53bb\u7684\u3002\n\n------------\n\n\u63a5\u4e0b\u6765\uff0c\u6765\u60f3\u60f3\u600e\u4e48\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u524d\u9762\u63d0\u5230\u8fc7\uff0c\u5904\u7406\u8fd9\u4e2a\u70b9\u7684\u65f6\u5019\u6211\u4eec\u53ea\u77e5\u9053\u5468\u56f4\u56db\u4e2a\u70b9\u7684\u72b6\u6001\u3002\n\n\u90a3\u4e22\u6389\u7684\u56db\u4e2a\u70b9\u600e\u4e48\u529e\u5462\uff1f\u5728\u5904\u7406\u90a3\u56db\u4e2a\u70b9\u7684\u65f6\u5019\u81ea\u7136\u5c31\u4f1a\u7b97\u5f53\u524d\u8fd9\u4e2a\u70b9\u4e86\u3002\u6b63\u597d\uff0c\u8fd8\u4e0d\u4f1a\u7b97\u91cd\u3002\n\n\u56e0\u4e3a\u76f8\u5f53\u4e8e\u6211\u4eec\u5168\u90e8\u8ba4\u5b9a\u8fd9\u4e2a\u7a7a\u5730\u5c31\u662f\u8def\u5f84\uff0c\u90a3\u4e48\u4ed6\u7684\u8d21\u732e\u5c31\u662f\u5468\u56f4\u516b\u4e2a\u683c\u5b50\u70ae\u53f0\u6570\u3002\u8f6c\u5316\u4e00\u4e0b\u4e5f\u5c31\u662f\u70ae\u53f0\u7684\u8d21\u732e\u5c31\u662f\u5468\u56f4\u516b\u4e2a\u683c\u5b50\u7a7a\u5730\u6570\u3002\n\n\u6240\u4ee5\u5982\u679c\u662f\u70ae\u53f0\uff0c\u5c31\u7b97\u5df2\u77e5\u7684\u56db\u4e2a\u70b9\u91cc\u9762\u7a7a\u5730\u6570\uff1b\n\n\u6240\u4ee5\u5982\u679c\u662f\u7a7a\u5730\uff0c\u5c31\u7b97\u5df2\u77e5\u7684\u56db\u4e2a\u70b9\u91cc\u9762\u70ae\u53f0\u6570\u3002\n\n\u90a3\u4e0d\u662f\u8fd8\u6709\u591a\u6761\u8def\u5f84\u7b97\u6700\u5c0f\u503c\u7684\u9650\u5236\u5417\uff1f\n\n\u90a3\u4f60\u628a\u7b54\u6848\u6700\u5927\u7684\u90a3\u6761\u7559\u4e0b\uff0c\u5269\u4e0b\u7684\u76f4\u63a5\u5168\u90e8\u7528\u969c\u788d\u586b\u6ee1\uff0c\u7b54\u6848\u80af\u5b9a\u4e0d\u52a3\uff0c\u51b5\u4e14\u8fd9\u4e00\u5b9a\u4f1a\u5728\u72b6\u6001\u4e2d\u51fa\u73b0\uff0c\u6240\u4ee5\u53ef\u4ee5\u8986\u76d6\u6389\u591a\u6761\u8def\u5f84\u7684\u5f71\u54cd\u3002\n\n\u90a3\u5168\u90e8\u7b54\u6848\u53d6\u5408\u6cd5\u91cc\u9762\u7684\u6700\u5927\u503c\u5c31\u884c\u4e86\u3002\n\n## Code\n\n```cpp\n/*\n\n*/\n#include <bits/stdc++.h>\n//#define int long long\n#define BT1 ((l == 1) + (ul == 1) + (u == 1) + (ur == 1))\n#define BT3 ((l == 3) + (ul == 3) + (u == 3) + (ur == 3))\nusing namespace std;\ntypedef long long ll;\nconst int N = 24, zs = 299987;\nint n, m, K, a[N][N], p, las, fst[zs + 10], tot[2], ans, inc[N], pl[N];\nstruct BIT {\n\tint c0, c1, c2;\n\tbool operator == (const BIT &it) const {\n\t\treturn (c0 == it.c0) && (c1 == it.c1) && (c2 == it.c2);\n\t}\n};\nstruct mdzz {int nxt, val[2]; BIT bt[2];} e[(1 << 24) + 10];\ninline int read() {\n\tint s = 0, w = 1;\n\tchar ch = getchar();\n\twhile (!isdigit(ch)) {if (ch == '-') w = -1; ch = getchar();}\n\twhile (isdigit(ch)) {s = (s << 3) + (s << 1) + (ch ^ 48); ch = getchar();}\n\treturn s * w;\n}\ninline void insert(int c0, int c1, int c2, int num) {\n\tint u = ((((1ll * c0 << 16) | c1) << 4) | c2) % zs + 1;\n\tfor (int i = fst[u]; i; i = e[i].nxt) {\n\t\tif (e[i].bt[p] == (BIT) {c0, c1, c2}) {\n\t\t\te[i].val[p] = max(e[i].val[p], num);\n\t\t\treturn ;\n\t\t}\n\t}\n\te[++tot[p]].nxt = fst[u];\n\te[tot[p]].bt[p] = (BIT) {c0, c1, c2};\n\te[tot[p]].val[p] = num;\n\tfst[u] = tot[p];\n}\nint pr, pd, l, ul, u, ur, c0, c1, c2;\ninline int RT(int c0, int j, int pm) {\n\tint tot = 1, x = c0, lm;\n\twhile (2333) {\n\t\tlm = (x >> pl[j]) & 3;\n\t\tif (lm == 1) ++tot; else if (lm == 2) --tot;\n\t\tif (!tot) return c0 ^ (lm << pl[j]) ^ (pm << pl[j]);\n\t\t++j;\n\t}\n\treturn 0;\n}\ninline int LT(int c0, int j, int pm) {\n\tint tot = 1, x = c0, lm;\n\twhile (2333) {\n\t\tlm = (x >> pl[j]) & 3;\n\t\tif (lm == 2) ++tot; else if (lm == 1) --tot;\n\t\tif (!tot) return c0 ^ (lm << pl[j]) ^ (pm << pl[j]);\n\t\t--j;\n\t}\n\treturn 0;\n}\ninline void Plugdp(int i, int j, BIT bit, int num) {\n\t//\u8fd9\u91cc\u7684c0\u662f\u5df2\u7ecf\u628a\u5de6\u548c\u4e0a\u53bb\u6389\u7684\u6b8b\u7f3a\u72b6\u6001\n\t//\u8fd9\u91cc\u7684c1\u662f\u5df2\u7ecf\u628a\u5de6\u4e0a\u53bb\u6389\u7684\u6b8b\u7f3a\u72b6\u6001\n\tif ((!pr && l == 1) || (!pd && u == 1)) {\n\t\tif (pr || pd) return ;\n\t\tinsert(c0, c1, c2, num);\n\t\tif (c2 < K && a[i][j] == 1) {\n\t\t\tinsert(c0, c1 ^ (3 << pl[j]), c2 + 1, num + BT1);\n\t\t}\n\t}\n\telse if (a[i][j] == 2) {\n\t\tif (!pr && !pd) insert(c0, c1, c2, num);\n\t}\n\telse if (a[i][j] == 1) {\n\t\tif (!pr && !pd) {\n\t\t\tinsert(c0, c1, c2, num);\n\t\t\tif (c2 < K) insert(c0, c1 ^ (3 << pl[j]), c2 + 1, num + BT1);\n\t\t\tinsert(c0 ^ inc[j - 1] ^ (inc[j] << 1), c1 ^ inc[j], c2, num + BT3);\n\t\t}\n\t\telse if (!pr || !pd) {\n\t\t\tinsert(c0 ^ ((pd | pr) << pl[j - 1]), c1 ^ inc[j], c2, num + BT3);\n\t\t\tinsert(c0 ^ ((pd | pr) << pl[j]), c1 ^ inc[j], c2, num + BT3);\n\t\t}\n\t\telse if (pr == 1 && pd == 1) insert(RT(c0, j - 1, 1), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 2 && pd == 2) insert(LT(c0, j - 1, 2), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 2 && pd == 1) insert(c0, c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 1 && pd == 2) ;\n\t\telse if (pr == 1 && pd == 3) insert(RT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 3 && pd == 1) insert(RT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 2 && pd == 3) insert(LT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 3 && pd == 2) insert(LT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 3 && pd == 3) insert(c0, c1 ^ inc[j], c2, num + BT3);\n\t}\n\telse if (a[i][j] == 3 || a[i][j] == 4) {\n\t\tif (!pr && !pd) {\n\t\t\tinsert(c0 ^ (3 << pl[j - 1]), c1 ^ inc[j], c2, num + BT3);\n\t\t\tinsert(c0 ^ (3 << pl[j]), c1 ^ inc[j], c2, num + BT3);\n\t\t}\n\t\telse if (!pr && pd == 1) insert(RT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 1 && !pd) insert(RT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (!pr && pd == 2) insert(LT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 2 && !pd) insert(LT(c0, j - 1, 3), c1 ^ inc[j], c2, num + BT3);\n\t\telse if (pr == 3 && !pd) insert(c0, c1 ^ inc[j], c2, num + BT3);\n\t\telse if (!pr && pd == 3) insert(c0, c1 ^ inc[j], c2, num + BT3);\n\t}\n}\ninline void plug() {\n\ttot[p] = 1;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tfor (int j = 1, x; j <= tot[p]; ++j) {\n\t\t\te[j].bt[p].c0 <<= 2;\n\t\t\tx = e[j].bt[p].c1;\n\t\t\t(e[j].bt[p].c1 ^= ((x >> pl[m + 1]) & 3) << pl[m + 1]) <<= 2;\n\t\t}\n\t\tfor (int j = 1; j <= m; ++j) {\n\t\t\tmemset(fst, 0, sizeof(fst));\n\t\t\tswap(las, p); tot[p] = 0;\n\t\t\tfor (int k = 1, num; k <= tot[las]; ++k) {\n\t\t\t\tBIT bit = e[k].bt[las]; num = e[k].val[las];\n\t\t\t\tif (bit.c0 >= inc[m + 1]) continue;\n\t\t\t\tc0 = bit.c0; c1 = bit.c1; c2 = bit.c2;\n\t\t\t\tpr = (c0 >> pl[j - 1]) & 3; pd = (c0 >> pl[j]) & 3;\n\t\t\t\tl = (c1 >> pl[j - 1]) & 3; ul = (c1 >> pl[j]) & 3;\n\t\t\t\tu = (c1 >> pl[j + 1]) & 3; ur = (c1 >> pl[j + 2]) & 3;\n\t\t\t\tc0 ^= (pr << pl[j - 1]) ^ (pd << pl[j]); c1 ^= (ul << pl[j]);\n\t\t\t\tPlugdp(i, j, bit, num);\n\t\t\t}\n\t\t}\n\t}\n}\ninline int pdd(char ch) {\n\tif (ch == '.') return 1;\n\tif (ch == '#') return 2;\n\tif (ch == 'S') return 3;\n\tif (ch == 'T') return 4;\n\tif (ch == 'X') return 5;\n\treturn 0;\n}\nint main() {\n\tn = read(); m = read(); K = read();\n\tinc[0] = 1; las = 1;\n\tfor (int i = 1; i <= 14; ++i) {\n\t\tinc[i] = inc[i - 1] << 2, pl[i] = i << 1;\n\t}\n\tif (n >= m) {\n\t\tchar ch;\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\tfor (int j = 1; j <= m; ++j) {\n\t\t\t\tch = getchar();\n\t\t\t\twhile (!(a[i][j] = pdd(ch))) ch = getchar();\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\tswap(n, m);\n\t\tchar ch;\n\t\tfor (int j = 1; j <= m; ++j) {\n\t\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\t\tch = getchar();\n\t\t\t\twhile (!(a[i][j] = pdd(ch))) ch = getchar();\n\t\t\t}\n\t\t}\n\t}\n\tplug();\n\tfor (int i = 1; i <= tot[p]; ++i) {\n\t\tif (!e[i].bt[p].c0) ans = max(ans, e[i].val[p]);\n\t}\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1652703703,
        "uid": 206024,
        "name": "Illusory_dimes",
        "ccfLevel": 7,
        "title": "[SCOI2012]\u55b5\u661f\u4eba\u7684\u5165\u4fb5 \u9898\u89e3"
    }
]