[
    {
        "content": "## \u9898\u89e3\r\n\r\n\u8003\u8651\u6bcf\u4e2a $d_i$ \u5230\u5e95\u53ef\u4ee5\u7ed9\u6211\u4eec\u63d0\u4f9b\u591a\u5c11\u4fe1\u606f\u3002\u5177\u4f53\u800c\u8a00\uff0c\u4ece\u5de6\u5f80\u53f3\u8003\u8651\u6bcf\u4e00\u5757\u78c1\u94c1\u3002\u6bcf\u6b21\u9009\u62e9\u4e09\u5757\u78c1\u94c1\u8fdb\u884c\u8ba8\u8bba\u3002\r\n\r\n### \u60c5\u51b5\u4e00\uff1a$\\boxed\\to\\boxed\\to\\boxed\\to$\r\n\r\n\u6b64\u65f6\u5b8c\u5168\u65e0\u6cd5\u63a8\u65ad\u7b2c\u4e8c\u5757\u548c\u7b2c\u4e09\u5757\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\uff0c\u76f4\u63a5\u5ffd\u7565\u3002\r\n\r\n### \u60c5\u51b5\u4e8c\uff1a$\\boxed\\to\\boxed\\to\\boxed\\gets$\r\n\r\n- \u4fdd\u7559\u7b2c\u4e8c\u5757\u78c1\u94c1\uff0c\u603b\u8d21\u732e\u4e3a $x=p+1+b+c+q$\uff1b\r\n- \u62ff\u6389\u7b2c\u4e8c\u5757\u78c1\u94c1\uff0c\u603b\u8d21\u732e\u4e3a $y=p+a+c+q$\u3002\r\n\r\n\u505a\u5dee\uff0c\u53d1\u73b0 $x-y-1=b-a$\u3002\u53ef\u4ee5\u76f4\u63a5\u63a8\u65ad\u51fa\u7b2c\u4e00\u5757\u548c\u7b2c\u4e8c\u5757\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u3002\r\n\r\n### \u60c5\u51b5\u4e09\uff1a$\\boxed\\to\\boxed\\gets\\boxed\\gets$\r\n\r\n- \u4fdd\u7559\u7b2c\u4e8c\u5757\u78c1\u94c1\uff0c\u603b\u8d21\u732e\u4e3a $x=p+a+b+1+q$\uff1b\r\n- \u62ff\u6389\u7b2c\u4e8c\u5757\u78c1\u94c1\uff0c\u603b\u8d21\u732e\u4e3a $y=p+a+c+q$\u3002\r\n\r\n\u505a\u5dee\uff0c\u53d1\u73b0 $x-y-1=b-c$\u3002\u53ef\u4ee5\u76f4\u63a5\u63a8\u65ad\u51fa\u7b2c\u4e8c\u5757\u548c\u7b2c\u4e09\u5757\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u3002\r\n\r\n### \u60c5\u51b5\u56db\uff1a$\\boxed\\to\\boxed\\gets\\boxed\\to$\r\n\r\n- \u4fdd\u7559\u7b2c\u4e8c\u5757\u78c1\u94c1\uff0c\u603b\u8d21\u732e\u4e3a $x=p+a+b+1+b+c+q$\uff1b\r\n- \u62ff\u6389\u7b2c\u4e8c\u5757\u78c1\u94c1\uff0c\u603b\u8d21\u732e\u4e3a $y=p+q$\u3002\r\n\r\n\u505a\u5dee\uff0c\u53d1\u73b0 $x-y-1=a+2b+c$\u3002\u611f\u89c9\u4e0d\u4e00\u5b9a\u6709\u7528\u963f\u3002\u4f46\u662f\u53ea\u8981\u6211\u4eec\u77e5\u9053\u4e86 $a$ \u6216\u8005 $c$ \u7684\u5927\u5c0f\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u5269\u4f59\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u3002\r\n\r\n\r\n\r\n---\r\n\r\n\u4f46\u662f\u4ece\u8fd9\u4e9b\u5730\u65b9\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e9b\u7ed3\u8bba\uff1a\r\n\r\n- \u5982\u679c\u51fa\u73b0\u4e86\u5f62\u5982 $\\text{AAAAA}$ \u5f62\u5f0f\u7684\u65b9\u5411\u6446\u653e\uff0c\u6700\u4e2d\u95f4\u7684\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u65e0\u9700\u5f97\u77e5\u3002\u56e0\u6b64\u53ef\u4ee5\u5c06\u6240\u6709\u957f\u5ea6\u5927\u4e8e $4$ \u7684\u8fde\u7eed\u6bb5\u7f29\u6210\u957f\u5ea6\u4e3a $4$ \u7684\u8fde\u7eed\u6bb5\u3002\r\n- \u5982\u679c\u51fa\u73b0\u4e86\u5f62\u5982 $\\text{ABB}$ \u5f62\u5f0f\u7684\u65b9\u5411\u6446\u653e\uff0c\u5c31\u53ef\u4ee5\u4e00\u6b21\u6027\u63a8\u65ad\u51fa\u540e\u4e24\u5757\u78c1\u94c1\u7684\u78c1\u529b\u3002\r\n- \u5982\u679c\u51fa\u73b0\u4e86\u5f62\u5982 $\\text{BBA}$ \u5f62\u5f0f\u7684\u65b9\u5411\u6446\u653e\uff0c\u5c31\u53ef\u4ee5\u4e00\u6b21\u6027\u63a8\u65ad\u51fa\u524d\u4e24\u5757\u78c1\u94c1\u7684\u78c1\u529b\u3002\r\n- \u7ed3\u5408\u4e0a\u8ff0\u4e09\u70b9\uff0c\u5bf9\u4e8e\u7f29\u5b8c\u4e4b\u540e\u7684\u957f\u5ea6\u5728 $2\\sim 4$ \u4e4b\u95f4\u7684\u8fde\u7eed\u6bb5\uff0c\u5982\u679c\u5b83\u4e24\u7aef\u6709\u78c1\u94c1\uff0c\u5c31\u53ef\u4ee5\u4e00\u53e3\u6c14\u628a\u8fd9\u4e00\u6bb5\u5185\u6240\u6709\u78c1\u94c1\u7684\u78c1\u529b\u8ba1\u7b97\u51fa\u6765\u3002\r\n- \u90a3\u4e48\u76ee\u524d\u8ba1\u7b97\u4e0d\u51fa\u6765\u78c1\u529b\u7684\u78c1\u94c1\uff0c\u80af\u5b9a\u90fd\u662f\u957f\u5ea6\u4e3a $1$ \u7684\u4e92\u76f8\u4ea4\u9519\u7684\u8fde\u7eed\u6bb5\u3002\u4ed6\u4eec\u7684\u4e24\u4fa7\u5c31\u662f\u78c1\u529b\u5927\u5c0f\u90fd\u88ab\u8ba1\u7b97\u51fa\u6765\u7684\u78c1\u94c1\uff0c\u6216\u8005\u662f\u6574\u6761\u78c1\u94c1\u94fe\u7684\u9876\u7aef\u3002\r\n- \u90a3\u4e48\u7ed3\u5408\u60c5\u5f62 $3$\uff0c\u53ef\u4ee5\u63a8\u77e5\u6240\u6709\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u3002\r\n\r\n---\r\n\r\n\u63a5\u7740\u662f\u7279\u6b8a\u60c5\u51b5\u7684\u8ba8\u8bba\uff1a\r\n\r\n- \u5982\u679c\u6240\u6709\u78c1\u94c1\u65b9\u5411\u76f8\u540c\uff0c\u90a3\u4e48\u6240\u6709\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u90fd\u662f\u65e0\u5173\u7d27\u8981\u7684\uff0c\u53ef\u4ee5\u968f\u4fbf\u8d4b\u503c\u3002\r\n- \u6392\u9664\u4ee5\u4e0a\u4e00\u70b9\uff0c\u80af\u5b9a\u4f1a\u51fa\u73b0\u4e0d\u540c\u65b9\u5411\u7684\u78c1\u94c1\u3002\u5982\u679c\u78c1\u94c1\u65b9\u5411\u5448\u73b0\u4e86 $\\text{ABAB}\\cdots$ \u7684\u4ea4\u66ff\u60c5\u5f62\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u80fd\u679a\u4e3e\u67d0\u4e2a\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u6765\u7834\u5c40\u3002\u4f46\u662f\u4f60\u6ca1\u5fc5\u8981 $\\mathcal O(\\log n)$ \u679a\u4e3e\uff1b\u4e8b\u5b9e\u4e0a\uff0c\u7531\u4e8e\u60c5\u5f62 $4$\uff0c\u53ef\u4ee5\u53d1\u73b0 $b$ \u7684\u53ef\u80fd\u6027\u662f\u975e\u5e38\u6709\u9650\u7684\u3002\r\n- \u6392\u9664\u4ee5\u4e0a\u4e24\u70b9\uff0c\u80af\u5b9a\u4f1a\u51fa\u73b0\u957f\u5ea6\u4e0d\u5c0f\u4e8e $2$ \u7684\u8fde\u7eed\u6bb5\u3002\u53ef\u4ee5\u4ece\u8fd9\u91cc\u4f5c\u4e3a\u7a81\u7834\u53e3\uff0c\u9996\u5148\u8fdb\u884c\u94fe\u7684\u7f29\u51cf\uff0c\u63a5\u7740\u8ba1\u7b97\u51fa\u6240\u6709 $2\\sim 4$ \u6bb5\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\uff0c\u63a5\u7740\u8ba1\u7b97\u51fa\u6240\u6709\u78c1\u94c1\u7684\u78c1\u529b\u5927\u5c0f\u3002\r\n\r\n\u521d\u59cb\u65f6\u8bbe\u7b2c\u4e00\u5757\u78c1\u94c1\u65b9\u5411\u5411\u5de6\u5373\u53ef\u3002\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e0d\u4f1a\u5bf9\u7ed3\u679c\u4ea7\u751f\u4efb\u4f55\u5f71\u54cd\u3002\u4e0d\u8fc7\u6709\u53ef\u80fd\u51fa\u73b0\u7b2c\u4e00\u5757\u78c1\u94c1\u5de6\u53f3\u4e24\u4fa7\u6070\u597d\u6709\u4e00\u5757\u65b9\u5411\u548c\u5b83\u4e0d\u540c\uff0c\u4f60\u5374\u4e0d\u77e5\u9053\u662f\u54ea\u4e2a\u3002\u90a3\u4e5f\u95ee\u9898\u4e0d\u5927\uff0c\u5bf9\u4e24\u79cd\u60c5\u51b5\u5206\u522b\u6c42\u89e3\u5224\u65ad\u5408\u6cd5\u6027\u5373\u53ef\u3002\r\n\r\n---\r\n\r\n\u5982\u4f55\u5224\u65ad\u8fde\u7eed\u6bb5\u7684\u957f\u5ea6\uff1a\r\n\r\n- \u5982\u679c\u4e00\u4e2a\u78c1\u94c1\u4e0e\u5468\u56f4\u4e24\u5757\u78c1\u94c1\u65b9\u5411\u90fd\u76f8\u540c\uff0c\u90a3\u4e48\u62ff\u6389\u4ed6\u540e\uff0c$d$ \u53ea\u4f1a\u51cf\u5c0f $1$\uff1b\r\n- \u5982\u679c\u4e00\u4e2a\u78c1\u94c1\u4ec5\u4e0e\u5468\u56f4\u4e00\u5757\u78c1\u94c1\u65b9\u5411\u4e0d\u540c\uff0c\u90a3\u4e48\u62ff\u6389\u4ed6\u540e\uff0c$d$ \u7684\u51cf\u5c0f\u503c\u6a21 $3$ \u4e0e $1$ \u540c\u4f59\uff1b\r\n- \u5982\u679c\u4e00\u4e2a\u78c1\u94c1\u4e0e\u5468\u56f4\u4e24\u5757\u78c1\u94c1\u65b9\u5411\u90fd\u4e0d\u540c\uff0c\u90a3\u4e48\u62ff\u6389\u4ed6\u540e\uff0c$d$ \u7684\u51cf\u5c0f\u503c\u6a21 $3$ \u4e0e $2$ \u540c\u4f59\u3002\r\n\r\n\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u8bc1\u660e\u3002\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\r\n\r\n---\r\n\r\n\u5982\u4f55\u6839\u636e $a+2b,a\\neq b$ \u77e5\u6653 $a$ \u548c $b$ \u7684\u503c\uff1a\r\n\r\n- \u6ce8\u610f\u5230 $a,b$ \u5747\u4e3a $4$ \u7684\u6574\u6570\u6b21\u5e42\uff0c\u53ef\u4ee5\u8bbe $a=2^{2u},b=2^{2v}$\uff0c\u76f8\u52a0\u540e\u4e3a $2^{2u}+2^{2v+1}$\u3002\u90a3\u4e48\u627e\u4e8c\u8fdb\u5236\u4e0b\u4e24\u4e2a $1$\uff0c\u5076\u6570\u4f4d\u7f6e\u7684 $1$ \u662f\u5c5e\u4e8e $a$ \u7684\uff0c\u5947\u6570\u4f4d\u7f6e\u7684 $1$ \u662f\u5c5e\u4e8e $b$ \u7684\u3002\r\n\r\n\u5982\u4f55\u6839\u636e $a-b,a\\neq b$ \u77e5\u6653 $a$ \u548c $b$ \u7684\u503c\uff1a\r\n\r\n- \u82e5 $a-b>0$\uff0c\u90a3\u4e48 $b=\\text{lowbit}(a-b)$\uff0c\u540c\u65f6\u63a8\u51fa $a=(a-b)+b$\u3002\r\n- \u82e5 $a-b<0$\uff0c\u90a3\u4e48\u53d6\u53cd\u540e\u7684\u503c\u4e3a $b-a>0$\uff0c\u6839\u636e\u4e0a\u4e00\u79cd\u60c5\u51b5\u5373\u53ef\u5f97\u89e3\u3002\r\n\r\n\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u9a8c\u8bc1/\u8bc1\u660e\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\r\n\r\n## \u4ee3\u7801\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define up(l,r,i) for(int i=l,END##i=r;i<=END##i;++i)\r\n#define dn(r,l,i) for(int i=r,END##i=l;i>=END##i;--i)\r\nusing namespace std;\r\ntypedef unsigned int       u32;\r\ntypedef unsigned long long u64;\r\ntypedef long long i64;\r\nconst int INF =2147483647;\r\nconst int MAXN=1e6+3;\r\ni64 D[MAXN],E[MAXN],A[MAXN]; bool F[MAXN]; int n,O[MAXN];\r\ni64 qread(){\r\n    i64 w=1,c,ret;\r\n    while((c=getchar())> '9'||c< '0') w=(c=='-'?-1:1); ret=c-'0';\r\n    while((c=getchar())>='0'&&c<='9') ret=ret*10+c-'0';\r\n    return ret*w;\r\n}\r\ni64 lowbit(i64 t){return t&-t;}\r\nint countz(i64 t){return __builtin_ctzll(t);}\r\nbool check(){\r\n    A[0]=A[n],F[0]=F[n],A[n+1]=A[1],F[n+1]=F[1];\r\n    i64 d0=n,d1=0,dn=0,dx=0;\r\n    up(1,n,i){\r\n        if(A[i]==-1) continue;\r\n        if(A[i]!=(1ll<<(O[i]<<1))) return false;\r\n        if(A[i]==A[i==1?n:i-1]||A[i]==A[i==n?1:i+1])\r\n            return false;\r\n    }\r\n    up(1,n,i) if(F[i]!=F[i+1]) d0+=A[i]+A[i+1];\r\n    if(d0!=D[0]) return false;\r\n    up(1,n,i){\r\n        dx=d0-1;\r\n        if(F[i  ]!=F[i-1]) dx-=A[i  ]+A[i-1];\r\n        if(F[i  ]!=F[i+1]) dx-=A[i  ]+A[i+1];\r\n        if(F[i-1]!=F[i+1]) dx+=A[i-1]+A[i+1];\r\n        if(dx!=D[i]) return false;\r\n    }\r\n    return true;\r\n}\r\nvoid find_add(i64 w,i64 &p,i64 &q){ // w=p+2q -> p,q\r\n    i64 a=lowbit(w),b=w-a;\r\n    if(countz(a)&1) q=a/2,p=b; else q=b/2,p=a;\r\n}\r\nvoid find_min(i64 w,i64 &p,i64 &q){ // w=p- q -> p,q\r\n    if(w>0) q=lowbit( w),p=w+q;\r\n    else    p=lowbit(-w),q=p-w;\r\n}\r\nint N[MAXN],M[MAXN];\r\nvoid maintain1(){\r\n    up(1,n,i) if(A[i]!=-2&&A[i]!=-1){\r\n            int a=i,b=N[a],c=N[b];\r\n            if(F[a]!=F[b]&&F[a]==F[c]){\r\n                find_add(D[0]-D[b]-A[a]-1,A[c],A[b]);\r\n            }\r\n        }\r\n}\r\nvoid maintain2(){\r\n    up(1,n,i){\r\n        if(A[i]==-1) O[i]=114514+i; else O[i]=countz(A[i])/2;\r\n    }\r\n}\r\nvoid showshowway(){\r\n    up(1,n,i){\r\n        printf(\"%lld, %d\\n\",A[i],F[i]);\r\n    }\r\n}\r\nbool solve2(){\r\n    up(1,n,i) N[i]=i+1; N[n]=1;\r\n    up(1,n,i) M[i]=i-1; M[1]=n;\r\n    up(2,n,i){\r\n        if(  D[0]-D[i]        ==1) F[i+1]= F[i  ]; else\r\n        if(((D[0]-D[i])%3+3)%3==1) F[i+1]=!F[i-1]; else\r\n        if(((D[0]-D[i])%3+3)%3==2) F[i+1]=!F[i  ];\r\n    }\r\n    F[0]=F[n],F[n+1]=F[1]; bool g=0,h=0;\r\n    up(1,n,i) g|=F[i],h|=F[i]==F[i+1];\r\n    if(g==0){\r\n        up(1,n,i) A[i]=-1; maintain2(); return check();\r\n    } else if(h==0){\r\n        i64 w=D[0]-D[1]-1;\r\n        up(0,20,i){\r\n            bool f=false;\r\n            up(0,20,j){\r\n                up(0,20,k){\r\n                    i64 a=1ll<<(j<<1);\r\n                    i64 b=1ll<<(i<<1);\r\n                    i64 c=1ll<<(k<<1);\r\n                    if(w==a+2*b+c) f=true;\r\n                }\r\n            }\r\n            if(f){\r\n                A[1]=(1ll<<(i<<1));\r\n                maintain1(),maintain1(),maintain2();\r\n                if(check()) return true;\r\n            }\r\n        }\r\n    } else {\r\n        up(1,n,i) if(F[i]!=F[M[i]]){\r\n            int l=i,r=i,p=i;\r\n            for(;F[r]==F[N[r]];r=N[r]); if(l==r) continue;\r\n            find_min(D[0]-D[r]-1,A[r],A[M[r]]);\r\n            find_min(D[0]-D[l]-1,A[l],A[N[l]]);\r\n            for(;F[p]==F[N[p]];p=N[p]) if(A[p]==-2) A[p]=-1;\r\n            if(l<r) i=r; else break;\r\n        }\r\n        maintain1(),maintain1(),maintain2();\r\n        return check();\r\n    }\r\n    return 0;\r\n}\r\nvoid solve1(bool f){\r\n    up(1,n,i) A[i]=-2,F[i]=-1; F[1]=false,F[2]=f;\r\n    if(solve2()){\r\n        up(1,n,i) printf(\"%d %d\\n\",F[i],O[i]); exit(0);\r\n    }\r\n}\r\ni64 p1,p2,q1,q2;\r\nint main(){\r\n    n=qread(); up(0,n,i) D[i]=qread();\r\n    if(n==1){puts(\"1\");exit(0);}\r\n    F[1]=false;\r\n    if(  D[0]-D[1]        ==1)              solve1(false); else\r\n    if(((D[0]-D[1])%3+3)%3==1) solve1(true),solve1(false); else\r\n    if(((D[0]-D[1])%3+3)%3==2) solve1(true)              ;\r\n    return 0;\r\n}\r\n```",
        "postTime": 1661822058,
        "uid": 68344,
        "name": "\u79bb\u6563\u5c0f\u6ce2\u53d8\u6362\u00b0",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 \u3010WR2-1C\u3011\u3010\u300cWdoi-2\u300d\u9b54\u529b\u7684\u96f7\u4e91\u3011"
    },
    {
        "content": "> [P8542 \u300cWdoi-2\u300d\u9b54\u529b\u7684\u96f7\u4e91](https://www.luogu.com.cn/problem/P8542)\n\n\u9996\u5148\u7279\u5224\u6389 $n = 2$ \u7684\u60c5\u51b5\uff0c\u6570\u636e\u6ca1\u6709 $n = 1$\u3002\u5982\u679c\u6709\u4e5f\u5e73\u51e1\u3002\n\n\u8bbe $b_i = 4 ^ {a_i}$\uff0c$c_i = d_0 - d_i$\u3002\n\n\u8003\u8651\u4e00\u6bb5\u65b9\u5411\u76f8\u540c\u7684\u78c1\u94c1 $l\\sim r$\u3002\u6211\u4eec\u53d1\u73b0\u5c06 $l + 1\\sim r - 1$ \u5f53\u4e2d\u4efb\u610f\u4e00\u4e2a\u62ff\u53bb\uff0c\u5747\u4f7f\u5f97\u603b\u957f\u51cf\u5c11 $1$\uff0c\u53cd\u4e4b\u6839\u636e\u78c1\u529b\u4e3a $4$ \u7684\u5e42\u4e14\u76f8\u90bb\u78c1\u529b\u4e0d\u540c\u53ef\u8bc1\u5176\u5145\u5206\u6027\u3002\u636e\u6b64\u53ef\u627e\u51fa\u957f\u5ea6 $\\geq 3$ \u7684\u6781\u957f\u7684\u65b9\u5411\u76f8\u540c\u7684\u78c1\u94c1\u3002\n\n**\u6cd5\u4e00**\uff1a\u8fdb\u4e00\u6b65\u5730\uff0c\u8003\u8651\u957f\u5ea6\u4e3a $2$ \u7684\u6781\u957f\u7684\u65b9\u5411\u76f8\u540c\u7684\u78c1\u94c1 $l, l + 1$\u3002\u8bbe $u = b_{l - 1}$\uff0c$v = b_l$\uff0c$w = b_{l + 1}$\uff0c$x = b_{l + 2}$\u3002\u5f53\u4e0d\u62ff\u53bb\u4efb\u4f55\u78c1\u94c1\u65f6\uff0c$l - 1$ \u548c $l + 2$ \u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a $u + v + 2 + w + x$\u3002\u62ff\u53bb\u78c1\u94c1 $l$ \u65f6\uff0c\u8ddd\u79bb\u4e3a $u + w + 1 + w + x$\uff0c\u62ff\u53bb\u78c1\u94c1 $l + 1$ \u65f6\uff0c\u8ddd\u79bb\u4e3a $u + v + 1 + v + x$\u3002\u636e\u6b64\u5f97\u5fc5\u8981\u6761\u4ef6 $c_l + c_{l + 1} = 2$\u3002\u95ee\u9898\u5728\u4e8e\u5b83\u5e76\u4e0d\u662f\u5145\u5206\u6761\u4ef6\u3002\u4f8b\u5982 $(1, u), (1, v), (0, u), (0, v)$\uff0c\u64a4\u53bb\u4e2d\u95f4\u4e24\u4e2a\u78c1\u94c1\u7684 $c$ \u5206\u522b\u4e3a $1 + v - u$ \u548c $1 + u - v$\u3002\u4f46\u5206\u7c7b\u8ba8\u8bba\u540e\u53ef\u77e5\u4ec5\u6709\u8fd9\u79cd\u60c5\u51b5\u4e3a\u7279\u4f8b\uff08$4$ \u7684\u5e42\u6a21 $3$ \u4f59 $1$\uff09\uff0c\u56e0\u6b64\u9664\u53bb\u957f\u5ea6 $\\geq 3$ \u7684\u8fde\u7eed\u6bb5\u4e4b\u540e\uff0c\u8003\u8651\u6781\u957f\u7684 $c_i + c_{i + 1} = 2$ \u7684\u8fde\u7eed\u6bb5 $[l, r]$\uff0c\u53ef\u77e5 $[l, l + 1], [l + 2, l + 3], \\cdots, [r - 1, r]$ \u4e3a\u8fde\u7eed\u6bb5\u3002\u636e\u6b64\u53ef\u627e\u51fa\u957f\u5ea6 $\\geq 2$ \u7684\u6781\u957f\u7684\u65b9\u5411\u76f8\u540c\u7684\u78c1\u94c1\u3002\u5219\u5269\u4e0b\u6765\u7684\u78c1\u94c1\u76f8\u90bb\u4e24\u4e2a\u65b9\u5411\u5747\u4e0d\u540c\u3002\n\n**\u6cd5\u4e8c**\uff1a\u6362\u79cd\u89d2\u5ea6\u8003\u8651\uff0c\u6211\u4eec\u68c0\u67e5\u957f\u5ea6\u4e3a $1$ \u7684\u6781\u957f\u8fde\u7eed\u6bb5 $[l, l]$ \u7684\u6027\u8d28\u3002\u8bbe $u = b_{l - 1}$\uff0c$v = b_l$\uff0c$w = b_{l + 1}$\u3002\u5f53\u4e0d\u62ff\u53bb\u4efb\u4f55\u78c1\u94c1\u65f6\uff0c$l - 1$ \u4e0e $l + 1$ \u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a $u + v + 1 + v + w$\u3002\u62ff\u53bb\u78c1\u94c1 $l$ \u65f6\uff0c$l - 1$ \u4e0e $l + 1$ \u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a $0$\u3002\u56e0\u6b64 $c_l = 1 + u + 2v + w$\u3002\u6211\u4eec\u8981\u5c06\u5176\u4e0e\u5b58\u5728\u4e0e $l$ \u76f8\u90bb\u7684\u65b9\u5411\u76f8\u540c\u7684\u78c1\u94c1\u533a\u5206\u5f00\u6765\u3002\u5f53 $f_{l - 1} = f_l = f_{l + 1}$ \u65f6 $c_l = 1$\uff0c\u8fd9\u4e2a\u5728\u7b2c\u4e00\u6b65\u5224\u8fc7\u4e86\u3002\u56e0\u6b64\uff0c\u8003\u8651\u6070\u5b58\u5728\u4e00\u4e2a\u4e0e $l$ \u76f8\u90bb\u7684\u65b9\u5411\u76f8\u540c\u7684\u78c1\u94c1\uff0c\u4e0d\u59a8\u8bbe\u4e3a $l - 1$\uff0c\u5219\u6b64\u65f6 $c'_l = 1 + v - u$\u3002\u770b\u8d77\u6765\u4e0d\u662f\u5f88\u597d\u5224\u65ad\uff0c\u4f46\u6ce8\u610f\u5230 $b_i$ \u4e3a $4$ \u7684\u5e42\uff0c\u6240\u4ee5 $b_i\\equiv 1\\pmod 3$\uff0c\u5219 $c_l \\equiv 2\\pmod 3$ \u4e14 $c_{l'} \\equiv 1\\pmod 3$\u3002\u7ed3\u5408 $f_{l - 1} = f_l = f_{l + 1}$ \u60c5\u51b5\u7684 $c_l = 1$\uff0c\u53ef\u77e5\u82e5 $c_l\\equiv 2\\pmod 3$ \u5219\u4e0e $i$ \u76f8\u90bb\u7684\u4e24\u4e2a\u78c1\u94c1\u65b9\u5411\u5747\u4e0d\u540c\uff0c\u5373 $[i, i]$ \u4e3a\u6781\u957f\u8fde\u7eed\u6bb5\u3002\u5219\u5269\u4e0b\u672a\u88ab\u4efb\u4f55\u8fde\u7eed\u6bb5\u8986\u76d6\u7684\u78c1\u94c1\u5f62\u6210\u4e86\u4e3a\u82e5\u5e72\u957f\u5ea6\u4e3a $2$ \u7684\u6781\u957f\u8fde\u7eed\u6bb5\uff0c\u5bb9\u6613\u5f97\u5230\u6bcf\u4e2a\u78c1\u94c1\u7684\u65b9\u5411\u3002\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u786e\u5b9a\u4e86\u6240\u6709\u78c1\u94c1\u7684\u65b9\u5411\uff0c\u63a5\u4e0b\u6765\u786e\u5b9a\u78c1\u529b\u3002\n\n\u5bf9\u4e8e $l < r$\uff0c\u6a21\u62df\u53ef\u77e5 $c_l - 1 = b_l - b_{l + 1}$\uff0c$c_r - 1 = b_r - b_{r - 1}$\u3002\u56e0\u4e3a\u76f8\u90bb\u78c1\u94c1\u78c1\u529b\u4e0d\u540c\uff0c\u6240\u4ee5\u5bb9\u6613\u786e\u5b9a $b_l, b_{l + 1}, b_{r - 1}, b_r$\u3002\u5177\u4f53\u5730\uff0c\u8bbe $u = 4 ^ v$\uff0c$x = 4 ^ y$\uff0c\u5df2\u77e5 $u > x$ \u548c $u - x$\uff0c\u6c42 $u, x$\u3002\u6839\u636e $2$ \u7684\u5e42\u7684\u6027\u8d28\uff0c\u6613\u8bc1 $x = \\mathrm{lowbit}(u - x)$\uff0c\u8fdb\u800c\u53ef\u77e5 $u = (u - x) + x$\u3002\u78c1\u94c1 $l + 2\\sim r - 2$ \u7684\u78c1\u529b\u4efb\u610f\u9009\u53d6\u5747\u7b26\u5408\u8981\u6c42\uff0c\u53ea\u9700\u6ee1\u8db3\u76f8\u90bb\u4e0d\u76f8\u7b49\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $l = r$\uff0c\u6a21\u62df\u53ef\u77e5 $c_l - 1 = b_{l - 1} + 2b_l + b_{l + 1}$\u3002\u56e0\u4e3a $b_l\\neq b_{l - 1}, b_{l + 1}$ \u4e14 $b_i$ \u4e3a $4$ \u7684\u5e42\uff0c\u6240\u4ee5 $\\mathrm{popcount}(c_l - 1)$ \u7b49\u4e8e $2$ \u6216 $3$\u3002\u5f53\u7b49\u4e8e $2$ \u65f6 $b_{l - 1} = b_{l + 1}$\uff0c\u6211\u4eec\u65e0\u6cd5\u533a\u5206 $b_{l - 1}$ \u548c $b_l$\uff1b\u5f53\u7b49\u4e8e $3$ \u65f6\u53ef\u77e5 $a_l$ \u4e3a $c_l - 1$ \u552f\u4e00\u4e3a $1$ \u7684\u5947\u6570\u4f4d\u9664\u4ee5 $2$\uff0c\u5373 $a_l = 2 ^ x$\uff0c\u5176\u4e2d $c_l - 1$ \u7684\u7b2c $2x + 1$ \u4f4d\u4e3a $1$\u3002\u4f46\u5982\u679c $\\mathrm{popcount}(c_l - 1) = 2$ \u65f6\u5df2\u77e5 $b_{l - 1}$ \u6216 $b_{l + 1}$\uff0c\u5219\u53ef\u4ee5\u786e\u5b9a $b_l$\u3002\n\n\u7efc\u5408\u4e0a\u8ff0\u6240\u6709\u7ed3\u8bba\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u76f8\u90bb\u78c1\u94c1\u65b9\u5411\u4e0d\u540c\uff0c\u4e14\u6240\u6709 $\\mathrm{popcount}(c_i - 1) = 2$ \u65f6\uff0c\u4e0a\u8ff0\u7ed3\u8bba\u65e0\u6cd5\u7ed9\u51fa\u786e\u5b9a\u89e3\u3002\u6b64\u65f6\u6240\u6709 $c_i$ \u5168\u90e8\u76f8\u540c\u3002\u56e0\u4e3a $c_i - 1 = 2(4 ^ {a_i} + 4^ {a_{i + 1}})$\uff0c\u4ee4\u5076\u6570\u4f4d\u7f6e $a_i$ \u4e3a $c_i - 1$ \u8f83\u4f4e\u4f4d\u51cf $1$ \u9664\u4ee5 $2$\uff0c\u4ee4\u5947\u6570\u4f4d\u7f6e $a_i$ \u4e3a\u8f83\u9ad8\u4f4d\u51cf $1$ \u9664\u4ee5 $2$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n)$\u3002\u4ee3\u7801\u4f7f\u7528\u6cd5\u4e8c\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define TIME 1e3 * clock() / CLOCKS_PER_SEC\nusing ll = long long;\nusing pii = pair<int, int>;\nusing pll = pair<ll, ll>;\nusing ull = unsigned long long;\ninline ll read() {\n  ll x = 0, sgn = 0;\n  char s = getchar();\n  while(!isdigit(s)) sgn |= s == '-', s = getchar();\n  while(isdigit(s)) x = x * 10 + s - '0', s = getchar();\n  return sgn ? -x : x;\n}\ninline void print(int x) {\n  if(x < 0) return putchar('-'), print(-x);\n  if(x >= 10) print(x / 10);\n  putchar(x % 10 + '0');\n}\nbool Mbe;\nconstexpr int N = 1e6 + 5;\nll low(ll x) {return x & -x;}\nint lg(ll x) {return __builtin_ctzll(x);}\nint ppc(ll x) {return __builtin_popcountll(x);}\nint n, f[N], g[N], a[N];\nll d[N], c[N];\nint id(int x) {return x < 1 ? x + n : x > n ? x - n : x;}\nvoid done() {\n  for(int i = 1; i <= n; i++) {\n    putchar(f[i] + '0'), putchar(' ');\n    print(a[i]), putchar('\\n');\n  }\n  exit(0);\n}\npii dis(ll v) {return {lg(low(v)), lg(v ^ low(v))};}\nvoid sub(int x, int y, ll v) { // a[x] - a[y] = v\n  if(v < 0) swap(x, y), v = -v;\n  a[id(y)] = lg(low(v)) >> 1, a[id(x)] = lg(v + low(v)) >> 1;\n}\nvoid ded(int x) {\n  ll v = c[id(x)] - 1;\n  if(ppc(v) == 3) {\n    for(int _ : {0, 0, 0}) {\n      ll u = low(v);\n      a[id(x)] = lg(u) >> 1, v ^= u;\n      if(lg(u) & 1) return;\n    }\n  }\n  int nei = a[id(x - 1)] = a[id(x + 1)] = max(a[id(x - 1)], a[id(x + 1)]);\n  if(nei == -1) return;\n  pii res = dis(v);\n  a[id(x)] = ((nei << 1) ^ res.first ^ res.second) >> 1;\n}\nvoid ded2(int l, int r) {\n  sub(l, l + 1, c[id(l)] - 1);\n  sub(r, r - 1, c[id(r)] - 1);\n  for(int p = l + 2; p <= r - 2; p++) a[id(p)] = p + 1064;\n}\nbool Med;\nint main() {\n  fprintf(stderr, \"%.3lf MB\\n\", (&Mbe - &Med) / 1048576.0);\n  #ifdef ALEX_WEI\n    FILE* IN = freopen(\"1.in\", \"r\", stdin);\n    FILE* OUT = freopen(\"1.out\", \"w\", stdout);\n  #endif\n  cin >> n >> d[0];\n  for(int i = 1; i <= n; i++) d[i] = read();\n  if(d[0] == n) {\n    for(int i = 1; i <= n; i++) a[i] = i < n ? i & 1 : 2;\n    done();\n  }\n  if(n == 2) {\n    d[0] = d[0] - 2 >> 1;\n    ll low = d[0] & -d[0];\n    a[1] = lg(low), a[2] = lg(d[0] ^ low), f[2] = 1;\n    done();\n  }\n  for(int i = 1; i <= n; i++) c[i] = d[0] - d[i], g[i] = 2, a[i] = -1;\n  for(int i = 1; i <= n; i++)\n    if(c[i] == 1) g[i] = g[id(i - 1)] = g[id(i + 1)] = 3;\n    else if((c[i] % 3 + 3) % 3 == 2) g[i] = 1;\n  int pos = 1;\n  for(int i = 2; i <= n; i++) if(g[i] != g[i - 1]) pos = i;\n  for(int i = pos; i < pos + n;) {\n    f[id(i)] = f[id(i - 1)] ^ 1;\n    if(g[id(i)] == 1) ded(i++);\n    else if(g[id(i)] == 2) {\n      f[id(i + 1)] = f[id(i)];\n      ded2(i, i + 1), i += 2;\n    }\n    else {\n      f[id(i + 1)] = f[id(i)];\n      int r = i + 2;\n      while(c[id(r - 1)] == 1) f[id(r++)] = f[id(i)];\n      ded2(i, r - 1), i = r;\n    }\n  }\n  for(int i = 1; i <= n; i++) if(a[i] == -1) ded(i);\n  if(a[1] == -1) {\n    pii res = dis(c[1] - 1);\n    for(int i = 1; i <= n; i++) a[i] = (i & 1 ? res.first : res.second) >> 1;\n  }\n  done();\n  cerr << TIME << \" ms\\n\";\n  return 0;\n}\n```",
        "postTime": 1662826525,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P8542 \u300cWdoi-2\u300d\u9b54\u529b\u7684\u96f7\u4e91"
    }
]