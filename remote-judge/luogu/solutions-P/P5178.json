[
    {
        "content": "\u63a8\u5f0f\u5b50\u9898\u3002\n\n\u9996\u5148\uff0c\u53ef\u4ee5\u5148\u8bbe$a_{n+1}=x_0$\u3002\u7136\u540e\u6839\u636e\u6768\u8f89\u4e09\u89d2\u53ef\u5f97:\n\n$$f[i][j]=\\begin{cases}0 & ,i\\le j\\\\\\sum_{k=0}^j \\binom{j}{k} a_{i-k} & ,i>j\\end{cases}$$\n\n\u7136\u540e\u53ef\u4ee5\u5f00\u59cb\u5316\u5f0f\u5b50\u4e86:\n\n$ans=\\sum_{i=1}^{n+1}\\sum_{j=0}^{i-1} f[i][j]$\n\n$=\\sum_{i=1}^{n+1}\\sum_{j=0}^{i-1}\\sum_{k=0}^j \\binom{j}{k}a_{i-k}$\n\n$=\\sum_{i=1}^{n+1}\\sum_{k=0}^{i-1}a_{i-k}\\sum_{j=k}^{i-1}\\binom{j}{k}$\n\n$=\\sum_{i=1}^{n+1}\\sum_{k=1}^i a_k\\sum_{j=i-k}^{i-1}\\binom{j}{i-k}$\n\n$=\\sum_{i=1}^{n+1}\\sum_{k=1}^i a_k \\sum_{j=1}^k \\binom{i-j}{i-k}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{i=k}^{n+1}\\sum_{j=1}^k\\binom{i-j}{i-k}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{j=1}^k\\sum_{i=0}^{n+1-k}\\binom{i+k-j}{i}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{j=1}^k\\sum_{i=0}^{n+1-k}\\binom{i+k-j}{k-j}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{j=1}^k\\binom{k-j+n+2-k}{k-j+1}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{j=1}^k\\binom{n-j+2}{k-j+1}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{j=1}^k\\binom{n-j+2}{n-k+1}$\n\n$=\\sum_{k=1}^{n+1} a_k \\sum_{j=n-k+2}^{n+1}\\binom{j}{n-k+1}$\n\n$=\\sum_{k=1}^{n+1} a_k[\\binom{n+2}{n-k+2}-1]$\n\n\u5230\u4e86\u8fd9\u91cc\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5$O(n)$\u8ba1\u7b97\u521d\u59cb\u7b54\u6848\u4e86\u3002\u6211\u4eec\u5bf9\u540e\u534a\u90e8\u5206\u8bb0\u5f55\u524d\u7f00\u548c\uff0c\u7136\u540e\u5229\u7528\u524d\u7f00\u548c\u76f8\u51cf\u5373\u53ef\u652f\u6301\u533a\u95f4\u4fee\u6539\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(n+m)$\u3002\n\n\u4ee3\u7801:\n```cpp\n#include<bits/stdc++.h>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mx(a,b) (a>b?a:b)\n#define mn(a,b) (a<b?a:b)\ntypedef unsigned long long uint64;\ntypedef unsigned int uint32;\ntypedef long long ll;\nusing namespace std;\n\nnamespace IO\n{\n    const uint32 Buffsize=1<<15,Output=1<<24;\n    static char Ch[Buffsize],*S=Ch,*T=Ch;\n    inline char getc()\n    {\n        return((S==T)&&(T=(S=Ch)+fread(Ch,1,Buffsize,stdin),S==T)?0:*S++);\n    }\n    static char Out[Output],*nowps=Out;\n    \n    inline void flush(){fwrite(Out,1,nowps-Out,stdout);nowps=Out;}\n\n    template<typename T>inline void read(T&x)\n    {\n        x=0;static char ch;T f=1;\n        for(ch=getc();!isdigit(ch);ch=getc())if(ch=='-')f=-1;\n        for(;isdigit(ch);ch=getc())x=x*10+(ch^48);\n        x*=f;\n    }\n\n    template<typename T>inline void write(T x,char ch='\\n')\n    {\n        if(!x)*nowps++='0';\n        if(x<0)*nowps++='-',x=-x;\n        static uint32 sta[111],tp;\n        for(tp=0;x;x/=10)sta[++tp]=x%10;\n        for(;tp;*nowps++=sta[tp--]^48);\n        *nowps++=ch;\n    }\n}\nusing namespace IO;\n\nvoid file(void)\n{\n    FILE*DSD=freopen(\"water.in\",\"r\",stdin);\n    FILE*CSC=freopen(\"water.out\",\"w\",stdout);\n}\n\nconst int MAXN=6e5+7;\n\nconst int mod=1234567891;\n\nstatic int n,m;\n\nstatic int fac[MAXN],inv[MAXN],a[MAXN];\n\ninline int power(int u,int v)\n{\n\tstatic int sm;\n\tfor(sm=1;v;v>>=1,u=(uint64)u*u%mod)if(v&1)\n\t\tsm=(uint64)sm*u%mod;\n\treturn sm;\n}\n\ninline void init()\n{\n\tread(n),read(m);\n\tRep(i,1,n+1)\n\t{\n\t\tread(a[i]);\n\t\tif(a[i]<0)a[i]+=mod;\n\t}\n\tfac[0]=1;\n\tRep(i,1,n+2)fac[i]=(uint64)fac[i-1]*i%mod;\n\tinv[n+2]=power(fac[n+2],mod-2);\n\tRepe(i,n+2,1)inv[i-1]=(uint64)inv[i]*i%mod;\n}\n\nstatic uint32 Pev[MAXN],*pre=Pev+1;\n\ninline uint32 C(int u,int v)\n{return u>=v?(uint64)fac[u]*inv[v]%mod*inv[u-v]%mod:0u;}\n\nstatic uint32 ans;\n\ninline void solve()\n{\n\tpre[0]=C(n+2,1)-1;\n\tans=(uint64)a[n+1]*pre[0]%mod;\n\tRep(i,1,n)\n\t{\n\t\tpre[i]=(pre[i-1]+C(n+2,n-i+2)-1)%mod;\n\t\tans=(ans+(uint64)a[i]*(C(n+2,n-i+2)-1))%mod;\n\t}\n\twrite(ans);\n\tstatic int l,r,p;\n\tRep(i,1,m)\n\t{\n\t\tread(l),read(r),read(p);\n\t\tif(p<0)p+=mod;\n\t\tans=(ans+(uint64)(pre[r]-pre[l-1]+mod)*p)%mod;\n\t\twrite(ans);\n\t\tif(i%100000==0)flush();\n\t}\n\tflush();\n\t\n}\n\nint main()\n{\n    init();\n    solve();\n\treturn 0;\n}\n```",
        "postTime": 1546521269,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5178 \u3010\u6c42\u548c\u3011"
    },
    {
        "content": "[Great_influence\u7684\u795e\u4ed9\u9898\u89e3](https://www.luogu.com.cn/blog/user7035/solution-p5178) \u592a\u5f3a\u8fa3qwq\n\n\u7136\u800c\u90a3\u4e2a\u5f0f\u5b50\u5bf9\u65b0\u624b\u5f88\u4e0d\u53cb\u597d\u3002\u4e8e\u662f\u6211\u51b3\u5b9a\u62ff\u5f0f\u5b50+\u56fe\u56fe\u6765\u8bb2\u3002\n\n### \u524d\u7f6e\u77e5\u8bc6\n\n1. \u6768\u8f89\u4e09\u89d2\n\n\u628a\u7ec4\u5408\u6570\u6392\u6210\u4e09\u89d2\u5f62\u7684\u5f62\u5f0f\u3002\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\uff0c\u6211\u4eec\u628a\u5b83\u4eec\u5de6\u5bf9\u9f50\u3002\n\n\u6bd4\u5982\u524d\u51e0\u884c\u662f\u8fd9\u6837\u7684\n\n```\n1\n1 1\n1 2 1\n1 3 3 1\n1 4 6 4 1\n1 5 10 10 5 1\n...\n```\n\n2. \u6768\u8f89\u4e09\u89d2\u7684\u6027\u8d28\n\n\u53f3\u8fb9\u90a3\u4e00\u5217\u6c38\u8fdc\u662f\u5de6\u8fb9\u90a3\u4e00\u5217\u7684\u524d\u7f00\u548c\u5f80\u4e0b\u79fb\u4e00\u4f4d\u3002\n\n\u8bc1\u660e\uff1a\u975e\u5e38simple\u3002\n\n\u4f17\u6240\u5468\u77e5\uff0c\u6768\u8f89\u4e09\u89d2\uff0c\u4e5f\u5c31\u662f\u7ec4\u5408\u6570\uff0c\u6709\u9012\u63a8\u5f0f $C(n,m)=C(n-1,m-1)+C(n-1,m)$\u3002\n\n\u7528 $C_m$ \u8868\u793a\u7ec4\u5408\u6570\u7684\u7b2c $m$ \u5217\uff0c\u90a3\u5c31\u662f\n\n$C_{m} [n]=C_{m-1}[n-1]+C_{m}[n-1]$\n\n\u628a\u7b2c $m$ \u5217\u6574\u4f53\u5f80\u4e0a\u79fb\u4e00\u4f4d\uff0c\u5373 $C_{m}[i]$ \u653e\u5230 $C_{m}[i-1]$ \u7684\u4f4d\u7f6e\n\n$C_{m} [n-1]=C_{m-1}[n-1]+C_{m}[n-2]$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u73a9\u610f\u5c31\u662f\u524d\u7f00\u548c\u7684\u9012\u63a8\u5f0f\u3002\u7136\u540e\u5c31\u8bc1\u5b8c\u4e86\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6709\uff1a\n\n- \u533a\u95f4\u548c\uff1a $\\sum\\limits_{j=l}^{r} C(j,i)=C(r+1,i)-C(l,i)$\n- \u524d\u7f00\u548c\uff1a $\\sum\\limits_{j=i}^{n} C(j,i)=C(n+1,i)$\n\n\u56fe\uff1a\n\n![](https://i.loli.net/2020/10/02/5WBROpAzHVGtZTv.png)\n\n\u9ec4=\u7ea2-\u84dd \uff08\u53ef\u4ee5\u9a8c\u8bc1\uff09\n\n\u505a\u9898\u7684\u65f6\u5019\u53ef\u4ee5\u8bd5\u7740\u6309\u56fe\u6765\u60f3\u8c61\uff0c\u66f4\u52a0\u5feb\u901f\uff0c\u6613\u61c2\n\n### \u5f00\u59cb\u505a\u9898\n\n\u628a $f$ \u6253\u51fa\u6765\u3002\n\n\uff08\u4e3a\u4e86\u65b9\u4fbf\uff0c\u7701\u7565\u4e86 $a$\uff0c\u6307\u6570\u8868\u793a\u51fa\u73b0\u6b21\u6570\uff0c\u6bd4\u5982\u5199 $1+2^2+3$ \u5c31\u4ee3\u8868 $a_1+2a_2+a_3$\uff09\n\n[\u50cf\u8fd9\u6837](https://www.luogu.com.cn/paste/kcuu6taf)\n\n\u7136\u540e\u89c2\u5bdf\u51fa\u73b0\u6b21\u6570\uff08\u6307\u6570\uff0c\u4e0d\u5199\u5c31\u662f $1$ \u6b21\uff09\u3002\u6211\u4eec\u53d1\u73b0\u5b83\u5c31\u662f\u6768\u8f89\u4e09\u89d2\uff01\n\n\u5206\u6790\u4e00\u4e0b $f[n][m]$\uff08\u884c\u4ece $1$ \u5f00\u59cb\uff0c\u5217\u4ece $0$ \u5f00\u59cb\uff09\uff1a\n- \u4ece $n-m$ \u5230 $n$\uff0c\u4e00\u5171 $m+1$ \u9879\n- \u7cfb\u6570\u662f $C(m,*)$\n\n\u679a\u4e3e\u5b83\u662f $n-k$\uff0c\u5f97\u51fa\uff1a\n\n$f[n][m]=\\sum\\limits_{k=0}^{m} a[n-k]\\times C(m,k)$\n\n\u7b54\u6848\u8981\u6c42\u5230 $N+1$\u3002\u76f4\u63a5\u4ee4 $a_{n+1}=x_0$\uff0c\u7136\u540e ```++N```\uff0c\u53d8\u6210\u6c42\u548c\u5230 $N$\u3002\n\n\u90a3\u7b54\u6848\u5c31\u662f\uff1a\n\n$\\sum\\limits_{n=1}^{N} \\sum\\limits_{m=0}^{n-1} \\sum\\limits_{k=0}^{m} a[n-k]\\times C(m,k)$\n\n\u6839\u636e\u76f4\u89c9\u6765\u8bb2\u5e94\u8be5\u6362\u6210\uff0c\u679a\u4e3e $a[]$\uff0c\u7b97\u7cfb\u6570\u7684\u5f62\u5f0f\u3002\u4f46\u662f\u4e0d\u597d\u76f4\u63a5\u770b\u51fa\u6765\u6bcf\u4e2a $a[i]$ \u88ab\u7b97\u4e86\u591a\u5c11\u6b21\uff0c\u56e0\u4e3a\u6709\u4e09\u4e2asigma\u3002\u4e0d\u6025\uff0c\u4e00\u5c42\u4e00\u5c42\u4e0a\u53bb\u3002\n\n\u5148\u53d8\u4e00\u5c42\uff1a\u6700\u91cc\u9762\u679a\u4e3e $m,k$ \u7684\u65f6\u5019\uff0c\u5148\u679a\u4e3e $k$\uff0c\u7136\u540e\u53bb\u627e $m$\u3002\n\n$\\sum$ \u4e2d $k=0\\rightarrow m$ \u76f8\u5f53\u4e8e $k \\le m$\uff0c\u6362\u4e00\u4e0b\u5c31\u662f $m \\ge k$\u3002\u90a3\u6211\u4eec\u76f8\u5f53\u4e8e\u679a\u4e3e $k$ \u4ece $0$ \u5230 $n-1$\uff0c\u7136\u540e\u679a\u4e3e $m$ \u4ece $k$ \u5230 $n-1$\u3002\n\n\u53d8\u6210\uff1a\n\n$=\\sum\\limits_{n=1}^{N} \\sum\\limits_{k=0}^{n-1} a_{n-k} \\sum\\limits_{m=k}^{n-1} C(m,k)$\n\n\u63a5\u7740\u53d8\uff1a\u5bf9\u4e8e\u6bcf\u4e2a $n$\uff0c\u6211\u4eec\u8fd9\u6837\u679a\u4e3e $k$ \u4e4b\u540e\uff0c\u53d1\u73b0 $a_1,a_2...a_n$ \u90fd\u4f1a\u88ab\u8ba1\u7b97\u4e00\u904d\u3002\n\n\u90a3\u6211\u4eec\u679a\u4e3e $i=n-k$\uff0c\u7136\u540e\u53bb\u627e\u5408\u6cd5\u7684 $n$\uff0c\u5e94\u8be5\u5728 $[i,n]$ \u8303\u56f4\u4e2d\u3002\u8fd9\u6837\u4e4b\u540e $k=n-i$\uff0c\u4e0a\u5f0f\u4e2d\u7684 $k$ \u5168\u90e8\u66ff\u6362\u6210 $n-i$ \u5373\u53ef\u3002\n\n\u53d8\u6210\uff1a\n\n$\\sum\\limits_{i=1}^{N} a_i \\sum\\limits_{n=i}^{N}\\sum\\limits_{m=n-i}^{n-1} C(m,n-i)$\n\n\u63a5\u4e0b\u6765\u4e0d\u7528\u53d8\u4e86\uff0c\u654f\u611f\u7684\u540c\u5b66\u5e94\u8be5\u5df2\u7ecf\u770b\u51fa\u6765\u4e1c\u897f\u4e86\u3002\u6700\u91cc\u9762\u679a\u4e3e $m$ \u7684\u90a3\u4e00\u5c42\uff0c$n-i$ \u662f\u4e0d\u53d8\u7684\uff0c\u53d8\u7684\u53ea\u6709\u6bcf\u6b21 $+1$ \u7684 $m$\u3002\u90a3\u5b83\u5c31\u662f\u4e2a\u6768\u8f89\u4e09\u89d2\u524d\u7f00\u548c\u3002\u4e0d\u654f\u611f\u7684\u540c\u5b66\u4e5f\u53ef\u4ee5\u770b\u56fe\uff1a\n\n![2.png](https://i.loli.net/2020/10/02/fp975OUTxQPe3aW.png)\n\n\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u9ec4\u8272\u90e8\u5206\u3002\u5b83\u672c\u8d28\u4e0a\u5c31\u662f\u7ec4\u5408\u6570\u524d\u7f00\u548c\uff0c\u7b49\u4e8e $C(n,n-i+1)$\u3002\n\n\u5f0f\u5b50\u53d8\u6210\u4e86\uff1a\n\n$=\\sum\\limits_{i=1}^{N} a_i \\sum\\limits_{n=i}^{N}C(n,n-i+1)$\n\n\u7531 $C(n,m)=C(n,n-m)$\uff0c\n\n$=\\sum\\limits_{i=1}^{N} a_i \\sum\\limits_{n=i}^{N}C(n,i-1)$\n\n\u8fd9\u56de $i-1$ \u662f\u5b9a\u503c\u4e86\uff0c\u53c8\u53ef\u4ee5\u7528\u4e00\u6b21\uff08\u6ce8\u610f\u8fd9\u4e00\u6b21\u662f\u533a\u95f4\u548c\uff0c\u8981\u51cf\u4e00\uff0c\u53ef\u4ee5\u81ea\u5df1\u753b\u56fe\u53d1\u73b0\uff09\uff1a\n\n$=\\sum\\limits_{i=1}^{N} a_i\\times (C(n+1,i)-1)$\n\n\u5269\u4e0b\u7684\u5c31\u5f88\u50bb\u903c\u4e86\u3002\u7ef4\u62a4 $C(n+1,i)-1$ \u7684\u524d\u7f00\u548c\uff0c\u7136\u540e\u5bf9\u4e8e\u533a\u95f4\u52a0 $x$\uff0c\u5bf9\u7b54\u6848\u8d21\u732e\u5c31\u662f\u52a0\u4e0a\u4e86 $x\\times S$\uff0c$S$ \u662f\u533a\u95f4\u548c\u3002\u7279\u5224\u4e00\u4e0b\u7b2c $N$ \u4e2a\uff0c\u539f\u6765\u662f $x_0$ \u7684\u90a3\u4e00\u9879\u3002\n\n\u7531\u4e8e\u53ea\u6709\u524d\u7f00\u548c\u7684\u6784\u9020/\u67e5\u8be2\uff0c\u590d\u6742\u5ea6\u662f $O(n+m)$ \u7684\uff0c\u975e\u5e38\u7684\u5feb\u3002\n\n~~\u5efa\u8bae\u52a0\u5f3a\u52301e7~~\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace Flandre_Scarlet\n{\n    #define N 1000006\n    #define mod 1234567891\n    #define int long long\n    #define F(i,l,r) for(int i=l;i<=r;++i)\n    #define D(i,r,l) for(int i=r;i>=l;--i)\n    #define Fs(i,l,r,c) for(int i=l;i<=r;c)\n    #define Ds(i,r,l,c) for(int i=r;i>=l;c)\n    #define MEM(x,a) memset(x,a,sizeof(x))\n    #define FK(x) MEM(x,0)\n    #define Tra(i,u) for(int i=G.Start(u),v=G.To(i);~i;i=G.Next(i),v=G.To(i))\n    #define p_b push_back\n    #define sz(a) ((int)a.size())\n    #define all(a) a.begin(),a.end()\n    #define iter(a,p) (a.begin()+p)\n    int I() {char c=getchar(); int x=0; int f=1; while(c<'0' or c>'9') f=(c=='-')?-1:1,c=getchar(); while(c>='0' and c<='9') x=(x<<1)+(x<<3)+(c^48),c=getchar(); return (x=(f==1)?x:-x);}\n    template <typename T> void Rd(T& arg){arg=I();}\n    template <typename T,typename...Types> void Rd(T& arg,Types&...args){arg=I(); Rd(args...);}\n    void RA(int *p,int n) {F(i,1,n) *p=I(),++p;}\n    int n,m;\n    int a[N];\n    void Input()\n    {\n        Rd(n,m); ++n;\n        RA(a+1,n); F(i,1,n) a[i]%=mod;\n    }\n    int fac[N],ifc[N],inv[N];\n    void Init()\n    {\n        int n=1e6;\n        inv[1]=fac[0]=ifc[0]=1;\n        F(i,2,n) inv[i]=(mod-mod/i)*inv[mod%i]%mod;\n        F(i,1,n) ifc[i]=ifc[i-1]*inv[i]%mod;\n        F(i,1,n) fac[i]=fac[i-1]*i%mod;\n    }\n    int C(int n,int m) {return m>n?0:(fac[n]%mod*ifc[m]%mod*ifc[n-m]%mod);}\n    int s[N];\n    void Soviet()\n    {\n        Init();\n        F(i,1,n) s[i]=(C(n+1,i)%mod-1+mod)%mod;\n        F(i,1,n) if (s[i]<0) s[i]+=mod;\n        int ans=0;\n        F(i,1,n) ans=(ans+a[i]*s[i]%mod)%mod;\n        printf(\"%lld\\n\",(ans%mod+mod)%mod);\n        F(i,1,n) s[i]=(s[i]+s[i-1])%mod;\n        F(i,1,m)\n        {\n            int l,r,x; Rd(l,r,x); x=(x%mod+mod)%mod;\n            if (l==0) ans=(ans+(s[n]-s[n-1]+mod)*x%mod),l=1;\n            if (l<=r) ans=(ans+(s[r]-s[l-1]+mod)%mod*x%mod)%mod;\n            ans=(ans%mod+mod)%mod;\n            printf(\"%lld\\n\",ans);\n        }\n    }\n    // \u4e00\u5b9a\u8981\u591a\u5199\u51e0\u4e2a\u6a21\uff01\n    void IsMyWife()\n    {\n        Input();\n        Soviet();\n    }\n}\n#undef int //long long\nint main()\n{\n    Flandre_Scarlet::IsMyWife();\n    getchar();\n    return 0;\n}\n```",
        "postTime": 1601613423,
        "uid": 106252,
        "name": "LightningUZ",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5178 \u3010\u6c42\u548c\u3011"
    }
]