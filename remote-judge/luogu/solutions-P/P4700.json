[
    {
        "content": "\n> \u505a\u6cd5:\u5f3a\u8054\u901a\u5206\u91cf\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898,\u6211\u4eec\u53d1\u73b0\u4e86\u8fd9\u6837\u4e00\u53e5\u8bdd\n\n> \u4fdd\u8bc1\u8fb9\u5728\u4ea4\u70b9\u4ee5\u5916\u7684\u4efb\u4f55\u5730\u65b9\u4e0d\u76f8\u4ea4\u3002\n\n\u90a3\u4e48,\u8fd9\u8bf4\u660e\u4e86\u4ec0\u4e48\u5462\uff1f\n\n\u8fd9\u5c31\u8bf4\u660e\u4e86\u4e0b\u9762\u8fd9\u5e45\u56fe\n\n![233](https://i.loli.net/2019/07/20/5d3291501bae713922.png)\n\n\u56e0\u4e3a,\u5982\u679c\u6ca1\u6709\u8fde\u4e0a\u7684\u8bdd,\u90a3\u4e48\u80af\u5b9a\u522b\u7684\u70b9\u90fd\u8fde\u4e0d\u4e0a,\u4e0d\u7136\u5c31\u76f8\u4ea4\u4e86\n\n\u6240\u4ee5\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28:**\u53f3\u8fb9\u7684\u70b9\u76f8\u5f53\u4e8e\u4e00\u6bb5\u533a\u95f4,\u662f\u8fde\u7eed\u7684\uff01**\n\n\u56e0\u6b64,\u6211\u4eec\u53ea\u9700\u8981dfs\u8dd1\u51fa\u4ed6\u80fd\u7ecf\u8fc7\u7684\u6700\u9ad8\u4e0e\u6700\u4f4e\u70b9\u5373\u53ef\n\n\u5982\u679c\u8fd9\u4e2a\u56fe\u5f62\u6210\u4e86\u73af\u600e\u4e48\u529e\uff1f\u7f29\u70b9\uff01\n\n#### Code:\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int M=300005,oo=2e9;\nstruct node{\n\tint x,y,flag,id;\n}A[M],Q[M];\nvector<int>Edge[M],G[M];\nvector<node>L,R;\nint dfn[M],low[M],stk[M],top,cnt,tot,ID[M];\nint mx[M],mn[M],n,m,sizx,sizy;\nbool instk[M],mark[M];\n\nvoid Tarjan(int x){\n\tdfn[x]=low[x]=++tot;\n\tinstk[x]=1; stk[++top]=x;\n\tif(A[x].flag==1) R.push_back(A[x]);\n\tfor(int i=0,_=Edge[x].size(); i<_; i++){\n\t\tint y=Edge[x][i];\n\t\tif(!dfn[y]){\n\t\t\tTarjan(y);\n\t\t\tlow[x]=min(low[x],low[y]);\n\t\t}else if(instk[y]) low[x]=min(low[x],dfn[y]);\n\t}\n\tif(low[x]==dfn[x]){\n\t\tint y=-1; cnt++;\n\t\twhile(x!=y){\n\t\t\ty=stk[top--];\n\t\t\tinstk[y]=0;\n\t\t\tID[y]=cnt;\n\t\t}\n\t}\n}\n\nvoid dfs(int x){\n\tif(mark[x]) return;\n\tmark[x]=1;\n\tfor(int i=0,_i=G[x].size(); i<_i; i++){\n\t\tint y=G[x][i];\n\t\tdfs(y);\n\t\tmx[x]=max(mx[x],mx[y]);\n\t\tmn[x]=min(mn[x],mn[y]);\n\t}\n}\n\nbool cmp(node x, node y){\n\treturn x.y>y.y;\n}\n\nint main(){\n\tfreopen(\"1.in\",\"r\",stdin);\n\tfreopen(\"myanswer.out\",\"w\",stdout);\n\tscanf(\"%d %d %d %d\",&n,&m,&sizx,&sizy);\n\tfor(int i=1; i<=n; i++){\n\t\tscanf(\"%d %d\",&A[i].x,&A[i].y);\n\t\tA[i].id=i;\n\t\tif(A[i].x==sizx) A[i].flag=1;\n\t\telse if(!A[i].x) A[i].flag=-1;\n\t\telse A[i].flag=0;\n\t}\n\tfor(int i=1,u,v,k; i<=m; i++){\n\t\tscanf(\"%d %d %d\",&u,&v,&k);\n\t\tEdge[u].push_back(v);\n\t\tif(k==2) Edge[v].push_back(u);\n\t}\n\tfor(int i=1; i<=n; i++){\n\t\tmn[i]=oo, mx[i]=0;\n\t\tif(A[i].flag==-1){\n\t\t\tL.push_back(A[i]);\n\t\t\tif(!dfn[i]) Tarjan(i);\n\t\t}\n\t}\n\tfor(int i=1; i<=n; i++){\n\t\tfor(int j=0,_j=Edge[i].size(); j<_j; j++){\n\t\t\tint y=Edge[i][j];\n\t\t\tif(ID[i]==ID[y]) continue;\n\t\t\tG[ID[i]].push_back(ID[y]);\n\t\t}\n\t}\n\tsort(L.begin(),L.end(),cmp);\n\tsort(R.begin(),R.end(),cmp);\n\tfor(int i=0,szr=R.size(); i<szr; i++){\n\t\tint now=ID[R[i].id],res=lower_bound(R.begin(),R.end(),R[i],cmp)-R.begin()+1;\n\t\tmn[now]=min(mn[now],res);\n\t\tmx[now]=max(mx[now],res);\n\t}\n\tfor(int i=0,szl=L.size(); i<szl; i++){\n\t\tint y=ID[L[i].id];\n\t\tdfs(y);\n\t\tprintf(\"%d\\n\",max(mx[y]-mn[y]+1,0));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1563595523,
        "uid": 81715,
        "name": "ppp204",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4700 \u3010[CEOI2011]Traffic\u3011"
    },
    {
        "content": "## BFS\uff08\u65e0\u9700\u7f29\u70b9\uff01\uff09\n\u6839\u636e\u9898\u610f:\n\n>\u4e24\u6761\u9053\u8def\u662f\u6ca1\u6709\u76f8\u4ea4\u7684\n\n\u4e0d\u96be\u5f97\u51fa\uff1a\n>\u82e5\u4e00\u4e2a\u897f\u6d77\u5cb8\u7684\u70b9$x$\u80fd\u8fde\u5230\u7eb5\u5750\u6807\u4e3a$y1$\u548c\u7eb5\u5750\u6807\u4e3a$y2$\u7684\u4e1c\u6d77\u5cb8(\u6ee1\u8db3$y1<y2$)\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5728\u4e1c\u6d77\u5cb8\u7684\u7eb5\u5750\u6807\u4e3a$[y1,y2]$\u7684\u70b9**\u82e5\u6709\u8fde\u5411\u897f\u6d77\u5cb8\u7684\u8def**\uff0c\u5176\u90fd\u53ef\u4ee5\u5230\u8fbe\u70b9$x$\u3002\n\n\u4e0d\u61c2\u5f97\u770b\u4e00\u4e0b\u56fe\u81ea\u5df1\u518dyy\u4e00\u4e0b:\n![](https://cdn.luogu.com.cn/upload/pic/64748.png)\n\n#### \u7b97\u6cd5\u6d41\u7a0b\n~~\u96be\u4ee5\u53e3\u80e1\uff0c\u5b9e\u5728\u770b\u4e0d\u61c2\u5c31\u770b\u4ee3\u7801\u5427~~\n1.\u5e7f\u641c\u4e00\u904d\u6c42\u51fa\u4e1c\u6d77\u5cb8\u5230\u4e0d\u4e86\u7684\u70b9\n\n2.\u5efa\u53cd\u56fe\uff0c\u5c06\u53ef\u5230\u8fbe\u7684\u4e1c\u6d77\u5cb8\u7684\u70b9\u8fdb\u884c\u6807\u53f7\n\n3.\u8fdb\u884c\u6309y\u5750\u6807**\u4ece\u5c0f\u5230\u5927**\u7531\u4e1c\u6d77\u5cb8\u5411\u897f\u6d77\u5cb8\u7684\u5e7f\u641c\uff0c\u5c06\u9047\u5230\u7684\u70b9\u90fd\u6807\u8bb0\u4e3a\u5f53\u524d\u70b9\u7684\u6807\u53f7\n\n4.\u8fdb\u884c\u6309y\u5750\u6807**\u4ece\u5927\u5230\u5c0f**\u7531\u4e1c\u6d77\u5cb8\u5411\u897f\u6d77\u5cb8\u7684\u5e7f\u641c\uff0c\u5c06\u9047\u5230\u7684\u70b9\u90fd\u6807\u8bb0\u4e3a\u5f53\u524d\u70b9\u7684\u6807\u53f7\n\n\u4ee3\u7801:\n```c++\n#include<bits/stdc++.h>\n#define MAXN 300010\nusing namespace std;\nint n,m,A,B,Head[MAXN],TotEdge,TotWest,TotEast,cnt,L[MAXN],R[MAXN],HeadF[MAXN],TotEdgeF;\nstruct Edge{\n\tint ed,last;\n}G[MAXN*6],F[MAXN*6];\nstruct Point{\n\tint i,y,num;\n}West[MAXN],East[MAXN];\nqueue<int> Q;\nbool mark[MAXN];\nbool cmp(Point XX,Point YY){\n\treturn XX.y>YY.y;\n}\nvoid Rd(int &res){\n\tres=0;char ch=getchar();\n\twhile('0'>ch||'9'<ch)ch=getchar();\n\twhile('0'<=ch&&ch<='9')res=(res<<3)+(res<<1)+(ch-'0'),ch=getchar();\n}\nvoid Add(int st,int ed){\n\tTotEdge++,TotEdgeF++;\n\tG[TotEdge]=(Edge){ed,Head[st]};\n\tF[TotEdgeF]=(Edge){st,HeadF[ed]};\n\tHead[st]=TotEdge;\n\tHeadF[ed]=TotEdgeF;\n}\nint main(){\n\tmemset(Head,-1,sizeof(Head));\n\tmemset(HeadF,-1,sizeof(HeadF));\n\tRd(n),Rd(m),Rd(A),Rd(B);\n\tfor(int i=1;i<=n;i++){\n\t\tint x,y;\n\t\tRd(x),Rd(y);\n\t\tif(x==0)West[++TotWest]=(Point){i,y};\n\t\telse if(x==A)East[++TotEast]=(Point){i,y};\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tint x,y,k;\n\t\tRd(x),Rd(y),Rd(k);\n\t\tif(k==1)Add(x,y);\n\t\telse Add(x,y),Add(y,x);\n\t}\n\tsort(West+1,West+1+TotWest,cmp);\n\tsort(East+1,East+1+TotEast,cmp);\n\tfor(int i=1;i<=TotWest;i++){\n\t\tif(mark[West[i].i])continue;\n\t\tmark[West[i].i]=true;\n\t\tQ.push(West[i].i);\n\t\twhile(!Q.empty()){\n\t\t\tint now=Q.front();\n\t\t\tQ.pop();\n\t\t\tfor(int i=Head[now];~i;i=G[i].last){\n\t\t\t\tint t=G[i].ed;\n\t\t\t\tif(mark[t])continue;\n\t\t\t\tmark[t]=true;\n\t\t\t\tQ.push(t);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=TotEast;i++){\n\t\tif(!mark[East[i].i])continue;\n\t\tEast[i].num=++cnt;\n\t}\n\twhile(!Q.empty())Q.pop();\n\tfor(int i=1;i<=TotEast;i++){\n\t\tif(!mark[East[i].i])continue;\n\t\tif(L[East[i].i])continue;\n\t\tQ.push(East[i].i);\n\t\tL[East[i].i]=East[i].num;\n\t\twhile(!Q.empty()){\n\t\t\tint now=Q.front();\n\t\t\tQ.pop();\n\t\t\tfor(int j=HeadF[now];~j;j=F[j].last){\n\t\t\t\tint t=F[j].ed;\n\t\t\t\tif(L[t])continue;\n\t\t\t\tL[t]=East[i].num;\n\t\t\t\tQ.push(t);\n\t\t\t}\n\t\t}\n\t}\n\twhile(!Q.empty())Q.pop();\n\tfor(int i=1;i<=TotEast;i++){\n\t\tif(!mark[East[i].i])continue;\n\t}\n\tfor(int i=TotEast;i>=1;i--){\n\t\tif(!mark[East[i].i])continue;\n\t\tif(R[East[i].i])continue;\n\t\tQ.push(East[i].i);\n\t\tR[East[i].i]=East[i].num;\n\t\twhile(!Q.empty()){\n\t\t\tint now=Q.front();\n\t\t\tQ.pop();\n\t\t\tfor(int j=HeadF[now];~j;j=F[j].last){\n\t\t\t\tint t=F[j].ed;\n\t\t\t\tif(R[t])continue;\n\t\t\t\tR[t]=East[i].num;\n\t\t\t\tQ.push(t);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=TotWest;i++){\n\t\tif(L[West[i].i]==0)puts(\"0\");\n\t\telse printf(\"%d\\n\",R[West[i].i]-L[West[i].i]+1);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1563584639,
        "uid": 54298,
        "name": "\u7cea\u773e\u8126\u98b0\u7f77",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4700 \u3010[CEOI2011]Traffic\u3011"
    },
    {
        "content": "## [P4700](https://www.luogu.com.cn/problem/P4700)  \n\u63d0\u4f9b\u4e00\u79cd\u4e0d\u9700\u8981\u7f29\u70b9\u7684\u505a\u6cd5\u3002   \n\n\u5bf9\u4e8e\u4efb\u4f55\u8d77\u70b9\u90fd\u4e0d\u80fd\u5230\u8fbe\u7684\u7ec8\u70b9\uff0c\u5c06\u5176\u5220\u53bb\uff0c\u90a3\u4e48\u5269\u4e0b\u7684\u70b9\u5c31\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\u5bf9\u4e8e\u70b9 $x$\uff0c\u5b83\u6240\u80fd\u5230\u8fbe\u7684\u7ec8\u70b9\u5728 $y$ \u7684\u503c\u4e0a\u5f62\u6210\u4e00\u6bb5\u8fde\u7eed\u533a\u95f4\u3002   \n\n\u7528\u53cd\u8bc1\u8bc1\u660e\u4e00\u4e0b\uff1a\u5982\u679c\u5bf9\u4e8e\u8d77\u70b9 $a$\uff0c\u7ec8\u70b9 $b$\uff0c$c$\uff0c$d$\uff0c$y_b>y_c>y_d$ \u4e14 $a$ \u53ef\u4ee5\u5230\u8fbe $b$\uff0c$d$\uff0c\u4e0d\u80fd\u5230\u8fbe $c$\uff0c\u5219\u4e00\u5b9a\u6709\u53e6\u5916\u4e00\u4e2a\u8d77\u70b9 $e$ \u53ef\u4ee5\u5230\u8fbe\u70b9 $c$\uff0c\u4e0d\u59a8\u4ee4 $e$ \u5728 $a$ \u7684\u4e0a\u65b9\uff0c\u90a3\u4e48\u8003\u8651 $e$ \u5230 $c$ \u7684\u8def\u5f84\u4e0e $a$ \u5230 $b$ \u7684\u8def\u5f84\uff0c\u4e8c\u8005\u5fc5\u5b9a\u6709\u4ea4\u70b9\uff08\u663e\u7136\uff09\uff0c\u5e76\u4e14\u6839\u636e\u9898\u76ee\u9650\u5236\uff0c\u4ea4\u70b9\u4e00\u5b9a\u662f\u4e00\u4e2a\u7aef\u70b9 $f$\uff0c\u90a3\u4e48 $a$ \u53ef\u4ee5\u5230 $f$\uff0c$f$ \u53c8\u53ef\u4ee5\u5230 $c$\uff0c\u90a3\u4e48 $a$ \u53ef\u4ee5\u5230 $c$\uff0c\u5047\u8bbe\u4e0d\u6210\u7acb\uff0c\u7ed3\u8bba\u5f97\u8bc1\u3002    \n\n\u6709\u4e86\u8fd9\u4e2a\u7ed3\u8bba\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u6bcf\u4e2a\u70b9\u5230\u7ec8\u70b9\u7684\u6700\u5927\u6700\u5c0f $y$ \u503c\u5c31\u597d\u4e86\uff0c\u5982\u679c\u6b63\u7740\u505a\u9700\u8981\u7f29\u70b9\uff08\u4f46\u662f\u6211\u662f\u51f8\u8f6e\u5e9f\u7269\u6240\u4ee5\u4e0d\u4f1a\uff09\uff0c\u8003\u8651\u5bf9\u7ec8\u70b9\u904d\u5386\uff0c\u4e00\u904d\u6c42\u6700\u5927\uff0c\u4e00\u904d\u6c42\u6700\u5c0f\u5c31\u53ef\u4ee5\u4e86\u3002     \n\n\n\u4e0a\u4ee3\u7801\uff1a   \n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint n,m,a,b,x[500003],y[500003],mx[500003],mn[500003],vis[500003];\nint k1,k2,k3,k4,k5,k6,k7,k8,k9;\nvector<int>r;\nvector<int>st;\nvector<int>ed;\nvector<int>E[500003];\nvector<int>F[500003];\nvector<pair<int,int> >ans;\nvoid dfs(int now){\n\tvis[now]=1;\n\tfor(auto i:E[now])if(!vis[i])dfs(i);\n\treturn;\n}\nbool comp(int XX,int YY){return y[XX]>y[YY];}\nint q[2000003],totq;\nsigned main(){\n\tscanf(\"%lld%lld%lld%lld\",&n,&m,&a,&b);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld%lld\",&x[i],&y[i]);\n\t\tmn[i]=-1;\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%lld%lld%lld\",&k1,&k2,&k3);\n\t\tE[k1].emplace_back(k2);\n\t\tF[k2].emplace_back(k1);\n\t\tif(k3==2){\n\t\t\tF[k1].emplace_back(k2);\n\t\t\tE[k2].emplace_back(k1);\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)if(vis[i]==0&&x[i]==0)dfs(i);\n\tfor(int i=1;i<=n;i++){\n\t\tif(x[i]==0)st.push_back(i);\n\t\tif(x[i]==a&&vis[i])ed.push_back(i);\n\t}\n\tsort(st.begin(),st.end(),comp);\n\tsort(ed.begin(),ed.end(),comp);\n\tfor(int i=0;i<ed.size();i++){\n\t\ttotq=0;\n\t\tq[++totq]=ed[i];\n\t\tmx[ed[i]]=i;\n\t\tfor(int j=1;j<=totq;j++){\n\t\t\tfor(auto u:F[q[j]]){\n\t\t\t\tif(mx[u]>0)continue;\n\t\t\t\tmx[u]=i+1;\n\t\t\t\tq[++totq]=u;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=ed.size()-1;i>=0;i--){\n\t\ttotq=0;\n\t\tq[++totq]=ed[i];\n\t\tmx[ed[i]]=i;\n\t\tfor(int j=1;j<=totq;j++){\n\t\t\tfor(auto u:F[q[j]]){\n\t\t\t\tif(mn[u]>0)continue;\n\t\t\t\tmn[u]=i+1;\n\t\t\t\tq[++totq]=u;\n\t\t\t}\n\t\t}\n\t}\n\tfor(auto i:st)printf(\"%lld\\n\",max(mn[i]-mx[i]+1,0ll));\n\treturn 0;\n}\n```\n",
        "postTime": 1683809006,
        "uid": 340819,
        "name": "cwfxlh",
        "ccfLevel": 5,
        "title": "P4700"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u5e73\u9762\u56fe](https://oi-wiki.org/graph/planar/)\u3001[SCC](https://oi-wiki.org/graph/scc/)\u3001[\u62d3\u6251\u6392\u5e8f](https://oi-wiki.org/graph/topo/)\n\n\u9996\u5148\u53ef\u4ee5\u628a\u8fd9\u5f20\u6df7\u5408\u56fe\u7f29\u70b9\u53d8\u6210\u4e00\u4e2a DAG\u3002\u82e5\u5bf9\u4e8e\u6bcf\u4e2a SCC \u4e2d\u6311\u9009\u4e00\u4e2a\u5728\u5176\u4e2d\u7684\u70b9\u4f5c\u4e3a\u5176\u5750\u6807\uff0c\u611f\u6027\u5730\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u7f29\u70b9\u5bf9\u539f\u56fe\u6027\u8d28\u65e0\u5f71\u54cd\u3002\n\n\u6ce8\u610f\u5230\u539f\u56fe\u7684\u6027\u8d28\u76f8\u5f53\u4e8e\u7ed9\u51fa\u8fd9\u662f\u4e00\u5f20**\u5e73\u9762\u56fe**\uff0c\u90a3\u8fd9\u5f20\u5e73\u9762\u56fe\u6709\u4ec0\u4e48\u6027\u8d28\u5462\uff1f\n\n\u629b\u5f00\u90a3\u4e9b\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u897f\u4fa7\u70b9\u53ef\u4ee5\u5230\u8fbe\u7684\u4e1c\u4fa7\u70b9\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\uff1a**\u82e5\u5c06\u5269\u4e0b\u7684\u4e1c\u4fa7\u70b9\u6309 $y$ \u5750\u6807\u5347\u5e8f\u91cd\u7f16\u53f7\uff0c\u6bcf\u4e2a\u897f\u4fa7\u70b9\u53ef\u4ee5\u5230\u8fbe\u7684\u4e1c\u4fa7\u70b9\u6784\u6210\u4e00\u4e2a\u533a\u95f4**\u3002\n\n\u4e0a\u8ff0\u7ed3\u8bba\u4e0d\u96be\u611f\u6027\u7406\u89e3\u3002\n\n\u4e8e\u662f\u6211\u4eec Tarjan \u7f29\u70b9\uff0c\u5bf9\u7f29\u70b9\u540e\u7684\u53cd\u56fe\u62d3\u6251\u6392\u5e8f\uff0c\u6bcf\u6b21\u66f4\u65b0\u5f53\u524d\u533a\u95f4\u7684\u5de6\u53f3\u7aef\u70b9\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n + m)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <stack>\n#include <queue>\n#include <cstdio>\n\nusing namespace std;\n\ntypedef struct {\n\tint nxt;\n\tint start;\n\tint end;\n} Edge;\n\ntypedef struct {\n\tint cnt = 0;\n\tint head[300007];\n\tEdge edge[1800007];\n\t\n\tinline void add_edge(int start, int end){\n\t\tcnt++;\n\t\tedge[cnt].nxt = head[start];\n\t\thead[start] = cnt;\n\t\tedge[cnt].start = start;\n\t\tedge[cnt].end = end;\n\t}\n} Graph;\n\nGraph G1, G2;\nint x[300007], y[300007], label[300007], p[300007], dfn[300007], low[300007], belong[300007], l[300007], r[300007], deg[300007], ans[300007];\nbool vis1[300007], vis2[300007], vis3[300007], vis4[300007];\nstack<int> s;\nqueue<int> q;\n\ninline int read(){\n\tint ans = 0;\n\tchar ch = getchar();\n\twhile (ch < '0' || ch > '9'){\n\t\tch = getchar();\n\t}\n\twhile (ch >= '0' && ch <= '9'){\n\t\tans = ans * 10 + (ch ^ 48);\n\t\tch = getchar();\n\t}\n\treturn ans;\n}\n\nbool cmp(const int a, const int b){\n\treturn y[a] > y[b];\n}\n\nvoid dfs(int u){\n\tif (vis1[u]) return;\n\tvis1[u] = true;\n\tfor (register int i = G1.head[u]; i != 0; i = G1.edge[i].nxt){\n\t\tdfs(G1.edge[i].end);\n\t}\n}\n\nvoid tarjan(int u, int &id, int &scc_cnt, int a){\n\tdfn[u] = low[u] = ++id;\n\tvis2[u] = vis3[u] = true;\n\ts.push(u);\n\tfor (register int i = G1.head[u]; i != 0; i = G1.edge[i].nxt){\n\t\tint x = G1.edge[i].end;\n\t\tif (!vis2[x]){\n\t\t\ttarjan(x, id, scc_cnt, a);\n\t\t\tlow[u] = min(low[u], low[x]);\n\t\t} else if (vis3[x]){\n\t\t\tlow[u] = min(low[u], dfn[x]);\n\t\t}\n\t}\n\tif (dfn[u] == low[u]){\n\t\tint cur;\n\t\tscc_cnt++;\n\t\tl[scc_cnt] = 0x7fffffff;\n\t\tr[scc_cnt] = 0;\n\t\tvis4[scc_cnt] = true;\n\t\tdo {\n\t\t\tcur = s.top();\n\t\t\ts.pop();\n\t\t\tvis3[cur] = false;\n\t\t\tbelong[cur] = scc_cnt;\n\t\t\tvis4[scc_cnt] &= vis1[cur];\n\t\t\tif (x[cur] == a){\n\t\t\t\tl[scc_cnt] = min(l[scc_cnt], label[cur]);\n\t\t\t\tr[scc_cnt] = max(r[scc_cnt], label[cur]);\n\t\t\t}\n\t\t} while (cur != u);\n\t}\n}\n\nint main(){\n\tint n = read(), m = read(), a = read(), b = read(), label_id = 0, awa = 0, dfn_id = 0, scc_cnt = 0;\n\tfor (register int i = 1; i <= n; i++){\n\t\tx[i] = read();\n\t\ty[i] = read();\n\t\tif (x[i] == a) label[i] = ++label_id;\n\t}\n\tfor (register int i = 1; i <= m; i++){\n\t\tint c = read(), d = read(), k = read();\n\t\tG1.add_edge(c, d);\n\t\tif (k == 2) G1.add_edge(d, c);\n\t}\n\tfor (register int i = 1; i <= n; i++){\n\t\tif (x[i] == 0) dfs(i);\n\t}\n\tfor (register int i = 1; i <= n; i++){\n\t\tp[i] = i;\n\t}\n\tlabel_id = 0;\n\tsort(p + 1, p + n + 1, cmp);\n\tfor (register int i = 1; i <= n; i++){\n\t\tif (x[p[i]] == a && vis1[p[i]]) label[p[i]] = ++label_id;\n\t}\n\tfor (register int i = 1; i <= n; i++){\n\t\tif (!vis2[i]) tarjan(i, dfn_id, scc_cnt, a);\n\t}\n\tfor (register int i = 1; i <= G1.cnt; i++){\n\t\tint u = G1.edge[i].start, v = G1.edge[i].end;\n\t\tif (belong[u] != belong[v] && vis4[belong[u]] && vis4[belong[v]]){\n\t\t\tdeg[belong[u]]++;\n\t\t\tG2.add_edge(belong[v], belong[u]);\n\t\t}\n\t}\n\tfor (register int i = 1; i <= scc_cnt; i++){\n\t\tif (vis4[i] && deg[i] == 0) q.push(i);\n\t}\n\twhile (!q.empty()){\n\t\tint cur = q.front();\n\t\tq.pop();\n\t\tans[cur] = l[cur] == 0x7fffffff && r[cur] == 0 ? 0 : r[cur] - l[cur] + 1;\n\t\tfor (register int i = G2.head[cur]; i != 0; i = G2.edge[i].nxt){\n\t\t\tint x = G2.edge[i].end;\n\t\t\tl[x] = min(l[x], l[cur]);\n\t\t\tr[x] = max(r[x], r[cur]);\n\t\t\tif (--deg[x] == 0) q.push(x);\n\t\t}\n\t}\n\tfor (register int i = 1; i <= n; i++){\n\t\tp[i] = i;\n\t}\n\tsort(p + 1, p + n + 1, cmp);\n\tfor (register int i = 1; i <= n; i++){\n\t\tif (x[p[i]] == 0) cout << ans[belong[p[i]]] << endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1665142419,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4700 \u3010[CEOI2011] Traffic\u3011"
    }
]