[
    {
        "content": "\u975e\u5e38\u4f20\u7edf\u7684\u9ad8\u65af\u6d88\u5143\u9898\u76ee\u2026\u2026\n\n\u5982\u679c\u719f\u7ec3\u4e4b\u540e\u53ef\u4ee5\u5f88\u5feb\u7684\u5207\u6389\u8fd9\u9053\u9898\uff1f\n__________________________\n\n## \u672c\u4f53\u9898\u89e3\n\n\u5176\u5b9e\u5728\u6982\u7387\u9898\u4e2d\u6709\u4e00\u4e2a\u975e\u5e38\u4f20\u7edf\u7684\u6a21\u578b\n\n\u7ed9\u4f60\u4e00\u5806\u70b9\uff0c\u70b9u\u6709$P(u,v)$\u7684\u6982\u7387\u901a\u5411\u70b9v\uff0c\u6c42\u4ece\u67d0\u4e2a\u70b9S\u51fa\u53d1\uff0c\u7ecf\u8fc7\u591a\u5c11\u6b65\u4e4b\u540e\u53ef\u4ee5\u7b2c\u4e00\u6b21\u5230\u8fbe\u70b9T\uff0c\u901a\u5e38\u6709\u4e00\u4e9b\u70b9\u8fdb\u5165\u4e4b\u540e\u5c31\u4e0d\u53ef\u4ee5\u7ee7\u7eed\u51fa\u6765\uff0c\u6bd4\u5982\u6211\u4eec\u4e00\u822c\u8ba4\u4e3aT\u70b9\u8fdb\u53bb\u4e4b\u540e\u5c31\u4e0d\u4f1a\u51fa\u6765\u4e86\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5982\u679c\u4e0d\u662fDAG\u5c31\u4e0d\u53ef\u80fd\u4f7f\u7528dp\u6c42\u89e3\uff0c\u56e0\u6b64\u6211\u4eec\u4e00\u822c\u4f7f\u7528\u9ad8\u65af\u6d88\u5143\u5217\u65b9\u7a0b\u7684\u505a\u6cd5\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\uff0c\u4e00\u822c\u6765\u8bb2\u6211\u4eec\u8bbe$E_{i}$\u4e3a\u4ecei\u51fa\u53d1\u5230\u8fbe\u70b9T\u7684\u671f\u671b\u6b65\u6570\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u5f0f\u5b50\n\n## $E_{i}=\\sum_{j=1}^{n}E_{j}P_{i,j}+1$\n\n## $E_{T}=0$\n\n\u610f\u601d\u5c31\u662f\u8fd9\u4e2a\u70b9\u7684\u671f\u671b\u6b65\u6570\u4e3a\u6240\u6709\u540e\u7ee7\u72b6\u6001\u7684\u671f\u671b\u6b65\u6570\u4e58\u4e0a\u5bf9\u5e94\u7684\u8f6c\u79fb\u6982\u7387\u4e4b\u548c(\u663e\u7136\u8fd9\u7b26\u5408\u671f\u671b\u7684\u5b9a\u4e49)\uff0c\u6700\u540e\u65e0\u8bba\u5982\u4f55\u8f6c\u79fb\u6b65\u6570\u90fd\u4f1a+1(\u6216\u8005\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u662f\u6240\u6709\u7684\u540e\u7ee7\u72b6\u6001\u7684\u6982\u7387\u4e4b\u548c\u4e3a1\uff0c\u7136\u540e\u6211\u4eec\u672c\u6765\u8fd9\u4e2a1\u5728\u03a3\u91cc\u9762\uff0c\u6211\u4eec\u63d0\u4e86\u51fa\u6765)\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u7531n\u4e2a\u53d8\u91cf\uff0cn\u4e2a\u65b9\u7a0b\u901a\u8fc7\u9ad8\u65af\u6d88\u5143\u6c42\u89e3\u4e86\n____________________\n\n\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u9053\u9898\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f\u8fd9\u4e2a\u6a21\u578b\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u4e2a\u8840\u91cf\u503ci\u4f5c\u4e3a\u4e00\u4e2a\u70b9\uff0c\u8fd9\u6837\u6211\u4eec\u73b0\u5728\u53ea\u9700\u8981\u6c42\u51fa\u8f6c\u79fb\u7684\u6982\u7387$P_{i,j}$\u5c31\u53ef\u4ee5\u5229\u7528\u9ad8\u65af\u6d88\u5143\u5927\u529b\u5217\u65b9\u7a0b\u6c42\u89e3\u4e86\n\n\u53d1\u73b0\u4ece\u72b6\u6001i\u53ef\u4ee5\u8f6c\u79fb\u5230\u7684\u72b6\u6001\u53ea\u67090~i\u4ee5\u53cai+1\u8fd9\u4e9b\u72b6\u6001\n\n\u90a3\u4e48\u6211\u4eec\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u8fd9\u4e2a\u82f1\u96c4\u53d7\u5230\u4e86a\u70b9\u4f24\u5bb3\u7684\u6982\u7387\u5c31\u53ef\u4ee5\u5217\u65b9\u7a0b\u4e86\n\n\u90a3\u4e48\u8fd9\u4e2a\u82f1\u96c4\u53d7\u5230a\u70b9\u4f24\u5bb3\u7684\u4e8b\u4ef6\u53ef\u4ee5\u5199\u6210\u4e00\u4e2a01\u5e8f\u5217\uff0c\u5176\u4e2d\u53d7\u5230\u4f24\u5bb3\u8bb0\u4e3a1\uff0c\u4e0d\u53d7\u4f24\u5bb3\u8bb0\u4e3a0\uff0c\u90a3\u4e48\u7531\u4e8e\u53d7\u5230\u4e86a\u70b9\u4f24\u5bb3\uff0c\u6240\u4ee5\u6709a\u4e2a1\uff0c\u663e\u7136\u8fd9\u6837\u768401\u5e8f\u5217\u6709$C_{k}^{a}$\u79cd\uff0c\u6bcf\u79cd01\u5e8f\u5217\u51fa\u73b0\u7684\u6982\u7387\u90fd\u662f\n\n## $(\\frac{1}{m+1})^{a}(\\frac{m}{m+1})^{k-a}$\n\n\u6240\u4ee5\u6700\u540e\u53d7\u5230k\u70b9\u4f24\u5bb3\u7684\u6982\u7387\u5c31\u662f\n\n## $C_{k}^{a}(\\frac{1}{m+1})^{a}(\\frac{m}{m+1})^{k-a}$\n\n\u5199\u6210\u9636\u4e58\u7684\u5f62\u5f0f\u5c31\u662f\n\n## $\\frac{k!}{a!(k-a)!}(\\frac{1}{m+1})^{a}(\\frac{m}{m+1})^{k-a}$\n\n\u663e\u7136\u8fd9\u73a9\u610f\u53ef\u4ee5\u5728\u6211\u4eec\u6253\u8868\u4e86\u9006\u5143\u4e4b\u540e\u7ebf\u6027\u7684\u9012\u63a8\u51fa\u6765\n\n\u597d\u4e86\u73b0\u5728\u6211\u4eec\u6709\u4e86\u82f1\u96c4\u53d7\u5230k\u70b9\u4f24\u5bb3\u7684\u6982\u7387\uff0c\u8ba9\u6211\u4eec\u5f00\u59cb\u5217\u65b9\u7a0b\u5427\u2026\u2026\n\n\u4ee5\u4e0b\u8bb0$P_{k}$\u4e3a\u82f1\u96c4\u53d7\u5230\u6070\u597dk\u70b9\u4f24\u5bb3\u7684\u6982\u7387\uff0c$E_{i}$\u4e3a\u8840\u91cf\u4e3ai\u7684\u82f1\u96c4\u8840\u91cf\u5f520\u7684\u671f\u671b\u6b65\u6570\n\n\u5bf9\u4e8ei\uff01=n\u7684\u60c5\u51b5\u6211\u4eec\u90fd\u9700\u8981\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff0c\u8fd9\u4e2a\u82f1\u96c4\u6709\u6ca1\u6709\u88ab\u5976\u5230\u2026\u2026\n\n\u6240\u4ee5\u6211\u4eec\u4ecei\u8f6c\u79fb\u5230j\u7684\u6982\u7387\u5e94\u8be5\u662f\n\n## $\\frac{m}{m+1}P_{i-j}+\\frac{1}{m+1}P_{i-j-1}$\n\n\u7279\u522b\u7684\uff0c\u8f6c\u79fb\u5230i+1\u7684\u524d\u63d0\u662f\u6ca1\u6709\u53d7\u5230\u4f24\u5bb3\uff0c\u6240\u4ee5\u6982\u7387\u5e94\u8be5\u662f\n\n## $\\frac{1}{m+1}P_{0}$\n\n\u7279\u522b\u7684\uff0c\u5bf9\u4e8ei=n\u7684\u60c5\u51b5\u6211\u4eec\u6ca1\u6709\u88ab\u5976\u4e2d\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u6b64i\u8f6c\u79fb\u5230j\u7684\u6982\u7387\u5e94\u8be5\u662f\n\n## $P_{i-j}$\n\n\u53e6\u5916\u7684\u4e00\u70b9\u662f\u6211\u4eec\u7684\u65b9\u7a0b\u5e76\u6ca1\u6709\u8003\u8651\u53d7\u5230\u8fc7\u91cf\u4f24\u5bb3\u7684\u95ee\u9898\u2026\u2026\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u8fd9\u5e94\u8be5\u4f1a\u5f71\u54cd\u7684\u7cfb\u6570\u662f$E_{0}$\u7684\u7cfb\u6570\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u95ee\u9898,\u6211\u4eec\u5bf9\u4e8e$E_{i}$\u7684\u5b9a\u4e49\u662f\u8840\u91cf\u4e3ai\u7684\u82f1\u96c4\u8840\u91cf\u5f52\u96f6\u7684\u671f\u671b\u6b65\u6570\u2026\u2026\uff0c\u663e\u7136$E_{0}=0$\u56e0\u6b64\u6211\u4eec\u65e0\u9700\u8003\u8651$E_{0}$\u524d\u7684\u7cfb\u6570\u2026\u2026\n\n____________________________\n\n\u6240\u4ee5\u6700\u540e\u6211\u4eec\u5217\u51fa\u6765\u7684\u65b9\u7a0b\u5927\u6982\u957f\u8fd9\u6837\n\n\u5bf9\u4e8ei=1~n-1\n\n### $E_{i}=(\\sum_{j=1}^{j}(\\frac{m}{m+1}P_{i-j}+\\frac{1}{m+1}P_{i-j-1})E_{j})+(\\frac{1}{m+1}P_{0})E_{i+1}+1$\n\n\u5bf9\u4e8e i=n\n\n## $E_{n}=(\\sum_{j=1}^{n}P_{n-j}E_{j})+1$\n\n\n\u8fd9\u6837n-1\u4e2a\u53d8\u91cfn-1\u4e2a\u65b9\u7a0b\u6211\u4eec\u5c31\u53ef\u4ee5\u89e3\u51fa$E_{m}$\u4e86\uff0c\u6ce8\u610f\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u4ee3\u5165\u4e86$E_{0}=0$\u4ece\u800c\u6d88\u6389\u4e86\u77e9\u9635\u7684\u4e00\u884c\u4e00\u5217\n\n\u505a\u5b8c\u4e86\uff1f\n__________________________\n\n## \u7b49\u7b49\uff0c$n=1500$\u4f60\u8ddf\u6211\u8bf4\u9ad8\u65af\u6d88\u5143\uff1f\n\n\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u8fdb\u884c$O(n^3)$\u7684\u9ad8\u65af\u6d88\u5143\uff0c\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u8fd9\u4e2a\u77e9\u9635\uff0c\u4f1a\u53d1\u73b0\u5b83\u5927\u6982\u957f\u8fd9\u6837\n\n1 1 0 0 0 0 \u2026\u2026\n\n1 1 1 0 0 0 \u2026\u2026\n\n1 1 1 1 0 0 \u2026\u2026\n\n1 1 1 1 1 0 \u2026\u2026\n\n\u4f1a\u53d1\u73b0\u5b83\u7684\u4e3b\u5bf9\u89d2\u7ebf\u4e4b\u4e0a\u53ea\u6709\u4e00\u4e2a\u53d8\u91cf\u7684\u7cfb\u6570\u4e0d\u4e3a1\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4e24\u884c\u4e24\u884c\u7684\u5411\u4e0b\u6d88\uff0c\u6700\u540e\u524a\u6210\u8fd9\u4e2a\u6837\u5b50\n\n1 1 0 0 0 0 \u2026\u2026\n\n0 1 1 0 0 0 \u2026\u2026\n\n0 0 1 1 0 0 \u2026\u2026\n\n0 0 0 1 1 0 \u2026\u2026\n\n0 0 0 0 1 1 \u2026\u2026\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u6700\u540e\u4e00\u884c\u6ca1\u6709\u90a3\u4e2a\u591a\u4f59\u76841\uff0c\u6240\u4ee5\u6211\u4eec\u4ece\u6700\u540e\u4e00\u884c\u5f00\u59cb\u5012\u7740\u6d88\u5143\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e2a\u77e9\u9635\u524a\u6210\u5355\u4f4d\u77e9\u9635\u4e86~\n\n\u590d\u6742\u5ea6$O(n^2)$\n\n\u53e6\u5916\u6ce8\u610f\u5224\u65ad\u8bf8\u591a\u65e0\u89e3\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\u4ec0\u4e48k=0\uff0cm=0,k=1\u4e4b\u7c7b\u7684\n\n\u8fd8\u6709\u4ec0\u4e48m=0\u7684\u65f6\u5019\u4e5f\u9700\u8981\u6ce8\u610f\u5224\u6389\n\n\u4e0a\u4ee3\u7801~\n\n```C\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=1510;typedef long long ll;const ll mod=1e9+7;\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod){if(p&1){r=r*a%mod;}}return r;}\nint n;int p;ll m;ll k;ll mp[N][N];ll f[N];ll inv1;ll inv;ll res;int T;\ninline void solve()\n{\n    scanf(\"%d%d%lld%lld\",&n,&p,&m,&k);\n    if(k==0){printf(\"-1\\n\");return;}//\u7279\u5224\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\n    if(m==0)\n    {\n        if(k==1){printf(\"-1\\n\");return;}\n        for(;p>0;){if(p<n){p++;}p-=k;res++;}printf(\"%lld\\n\",res);res=0;return;\n    }inv=po(m+1,mod-2);inv1=po(m,mod-2);f[0]=po(m*inv%mod,k);\n    for(int i=1;i<=min((ll)(n+1),k);i++)f[i]=f[i-1]*inv1%mod*po(i,mod-2)%mod*(k-i+1)%mod;//\u9012\u63a8f\u6570\u7ec4\n    for(int i=1;i<n;i++)for(int j=1;j<=i;j++)mp[i][j]=(f[i-j]*m+f[i-j+1])%mod*inv%mod;//\u5217\u65b9\u7a0b\n    for(int i=1;i<n;i++)mp[i][i+1]=f[0]*inv%mod;//i+1\n    for(int i=1;i<n;i++)(mp[i][i]+=mod-1)%=mod;//1~i\n    for(int i=1;i<=n;i++){mp[i][n+1]=mod-1;}//\u5e38\u6570\u9879\n    for(int i=1;i<=n;i++){mp[n][i]=f[n-i];}(mp[n][n]+=mod-1)%=mod;\n    for(int i=1;i<=n;i++)//\u9ad8\u65af\u6d88\u5143\n    {\n        ll inv=po(mp[i][i],mod-2);mp[i][i]=1;(mp[i][n+1]*=inv)%=mod;\n        if(i!=n){(mp[i][i+1]*=inv)%=mod;}//\u4e24\u884c\u4e24\u884c\u7684\u5411\u4e0b\u6d88\n        for(int j=i+1;j<=n;j++)\n        {\n            ll mult=mp[j][i];mp[j][i]=0;(mp[j][i+1]+=mod-mult*mp[i][i+1]%mod)%=mod;\n            (mp[j][n+1]+=mod-mult*mp[i][n+1]%mod)%=mod;\n        }\n    }\n    for(int i=n;i>1;i--){(mp[i-1][n+1]+=mod-mp[i-1][i]*mp[i][n+1]%mod)%=mod;mp[i-1][i]=0;}//\u5012\u7740\u6d88\u4e0a\u53bb\n    printf(\"%lld\\n\",mp[p][n+1]);\n}\ninline void clear()//\u6e05\u7a7a\n{\n    for(int i=1;i<=min((ll)(n+1),k);i++){f[i]=0;}\n    for(int i=1;i<=n;i++)for(int j=1;j<=n+1;j++)mp[i][j]=0;\n}\nint main(){scanf(\"%d\",&T);for(int i=1;i<=T;i++){solve();clear();}return 0;}//\u62dc\u62dc\u7a0b\u5e8f~\n\n```\n",
        "postTime": 1525825885,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4457 \u3010[BJOI2018]\u6cbb\u7597\u4e4b\u96e8\u3011"
    },
    {
        "content": "## \u9898\u9762\n\n[\u4f20\u9001\u95e8(loj)](https://loj.ac/problem/2513)\n\n[\u4f20\u9001\u95e8(\u6d1b\u8c37)](https://www.luogu.org/problemnew/show/P4457)\n\n## \u9898\u89e3\n\n\u6a21\u62df\u8d5b\u7684\u65f6\u5019\u53ea\u60f3\u51fa\u4e86\u9ad8\u65af\u6d88\u5143\u7136\u540e\u6b7b\u6d3b\u4e0d\u77e5\u9053\u600e\u4e48\u7ee7\u7eed\u2026\u2026\u7ed3\u679c\u6b63\u89e3\u5c45\u7136\u5c31\u662f\u9ad8\u65af\u6d88\u5143\u5361\u5e38\uff1f\n\n\u9996\u5148\u6709\u4e2a\u6bd4\u8f83\u96be\u53d7\u7684\u5730\u65b9\u662f\u5b83\u4e00\u4e2a\u56de\u5408\u53ef\u80fd\u4e0d\u6b62\u6263\u4e00\u6ef4\u8840\u2026\u2026\u6211\u4eec\u5f97\u7b97\u51fa$P_i$\u8868\u793a\u4e00\u56de\u5408\u6263$i$\u6ef4\u8840\u7684\u6982\u7387\uff0c\u4e3a\n\n$$P_i={{k\\choose i}m^{k-i}\\over (m+1)^k}$$\n\n\u6240\u4ee5\u8fd9\u4e2a\u67ff\u5b50\u5565\u610f\u601d\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u628a$k$\u6b21\u6263\u8840\u770b\u6210\u4e00\u4e2a\u957f\u5ea6\u4e3a$k$\u7684\u5e8f\u5217\uff0c\u6bcf\u4e2a\u5e8f\u5217\u6709$m+1$\u79cd\u9009\u62e9\u65b9\u6cd5\uff0c\u4e8e\u662f\u603b\u7684\u9009\u6cd5\u5c31\u662f$(m+1)^k$\u3002\u6211\u4eec\u8981\u94a6\u5b9a\u5b83\u6263$i$\u6ef4\u8840\uff0c\u5c31\u662f\u4ee4\u5176\u4e2d$i$\u4e2a\u6570\u5f3a\u5236\u9009\u62e9$1$\uff0c\u65b9\u6848\u6570\u4e3a${k\\choose i}$\u3002\u5269\u4e0b\u7684\u6570\u90fd\u4e0d\u80fd\u9009$1$\uff0c\u6240\u4ee5\u65b9\u6848\u6570\u4e3a$m^{k-i}$\n\n\u6709\u4e86\u8fd9\u4e2a$P_i$\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u627e\u5173\u7cfb\u4e86\n\n\u7136\u800c\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u5f88\u8ba8\u538c\u7684\u5730\u65b9\u5c31\u662f\u5b83\u65f6\u4e0d\u65f6\u4f1a\u88ab\u5976\u4e00\u53e3\u2026\u2026\n\n\u6211\u4eec\u8bb0$f_i$\u8868\u793a\u5f53\u8840\u91cf\u4e3a$i$\u65f6\u88ab\u5e72\u6389\u7684\u671f\u671b\u56de\u5408\u6570\uff0c$g_i$\u8868\u793a\u4e00\u56de\u5408\u5185\u6253\u51fa\u4f24\u5bb3\u5927\u4e8e\u7b49\u4e8e$i$\u7684\u6982\u7387\uff0c\u7136\u540e\u8003\u8651\u8fd9\u4e1c\u897f\u8be5\u600e\u4e48\u8f6c\u79fb\n\n$$f_i={m\\over m+1}\\left(g_i+\\sum_{k=0}^{i-1}P_k(f_{i-k}+1)\\right)+{1\\over m+1}\\left(g_{i+1}+\\sum_{k=0}^{i}P_k(f_{i+1-k}+1)\\right)$$\n\n\u8fb9\u754c\u6761\u4ef6\u4e3a\n\n$$f_n=g_n+\\sum_{k=0}^{n-1}P_k(f_{n-k}+1)$$\n\n\u6240\u4ee5\u8fd9\u67ff\u5b50\u662f\u5565\uff1f\n\n${m\\over m+1}$\u8868\u793a\u6ca1\u6709\u88ab\u5976\u5230\u7684\u6982\u7387\uff0c\u90a3\u4e48\u6211\u4eec\u679a\u4e3e\u5b83\u88ab$A$\u4e86\u51e0\u4e0b\u3002\u5982\u679c\u5b83\u4e00\u56de\u5408\u88ab\u5e72\u6389\u4e86\uff0c\u90a3\u4e48\u671f\u671b\u5c40\u6570\u4e3a$1$\uff0c\u5426\u5219$A$\u4e86$k$\u4e0b\u4e4b\u540e\u8840\u91cf\u4f1a\u5230$i-k$\uff0c\u8fd9\u4e00\u90e8\u5206\u7684\u671f\u671b\u6b65\u6570\u5c31\u662f$f_{i-k}+1$\u3002\u540e\u9762\u90a3\u4e2a\u5c31\u662f\u5982\u679c\u88ab\u5976\u4e86\u4e4b\u540e\u7684\u60c5\u51b5\u3002\u987a\u4fbf\u56e0\u4e3a\u6ee1\u8840\u7684\u65f6\u5019\u662f\u4e0d\u53ef\u80fd\u88ab\u5976\u7684\uff0c\u6240\u4ee5$f_n$\u8981\u7279\u6b8a\u8003\u8651\n\n\u7136\u800c\u8fd9\u67ff\u5b50\u4e00\u70b9\u90fd\u4e0d\u597d\u770b\uff0c\u7279\u522b\u662f$g_i$\u5f88\u4e0d\u723d\uff0c\u90a3\u5c31\u7ee7\u7eed\u63a8\u5012\n\n$$f_i={m\\over m+1}\\left(g_i+\\sum_{k=0}^{i-1}P_k+\\sum_{k=0}^{i-1}P_kf_{i-k}\\right)+{1\\over m+1}\\left(g_{i+1}+\\sum_{k=0}^{i}P_k+\\sum_{k=0}^{i}P_kf_{i+1-k}\\right)$$\n\n$$f_i={m\\over m+1}\\left(1+\\sum_{k=0}^{i-1}P_kf_{i-k}\\right)+{1\\over m+1}\\left(1+\\sum_{k=0}^{i}P_kf_{i+1-k}\\right)$$\n\n\u540c\u7406\u6709$f_n=1+\\sum_{k=0}^{n-1}P_kf_{n-k}$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u9012\u63a8\u2026\u2026\u7b49\u4f1a\u513f\u8fd9\u548b\u63a8\u554a\u2026\u2026\u8f6c\u79fb\u597d\u50cf\u90fd\u6210\u73af\u4e86\u554a\u2026\u2026\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u628a\u5b83\u770b\u6210\u4e00\u4e2a\u65b9\u7a0b\u7ec4\u6765\u9ad8\u65af\u6d88\u5143\u6c42\u89e3\u5427\n\n\u54c8\uff1f$n=1500$\u4f60\u8ba9\u6211\u9ad8\u65af\u6d88\u5143\uff1f\n\n\u6211\u4eec\u6765\u597d\u597d\u89c2\u5bdf\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u7a0b\u7ec4\uff0c$f_i$\u6240\u5bf9\u5e94\u7684\u65b9\u7a0b\u53ea\u4e0e$f_1,...f_{i+1}$\u7684\u503c\u6709\u5173\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u4e00\u884c\u7684\u5bf9\u89d2\u7ebf\u53f3\u8fb9\u53ea\u6709\u5728\u5b83\u53f3\u8fb9\u4e00\u4f4d\u7684\u90a3\u4e2a\u7cfb\u6570\u4e0d\u4e3a$0$\n\n\u56e0\u4e3a\u6211\u4eec\u9ad8\u65af\u6d88\u5143\u7684\u65f6\u5019\u662f\u62ff\u81ea\u5df1\u8fd9\u884c\u53bb\u51cf\u4e0b\u9762\u7684\uff0c\u6240\u4ee5\u6bcf\u4e00\u884c\u4e2d\u53ea\u6709$2$\u4e2a\u7cfb\u6570\u8981\u53bb\u548c\u4e0b\u9762\u7684\u76f8\u51cf\uff0c\u590d\u6742\u5ea6\u5c31\u80fd\u5316\u5230$O(n^2)$\u4e86\n\n~~\u867d\u7136\u6211\u8fd8\u662f\u4e0d\u77e5\u9053\u8fd9\u4e2a\u590d\u6742\u5ea6\u662f\u600e\u4e48\u8fc7\u53bb\u7684~~\n\n```cpp\n//minamoto\n#include<bits/stdc++.h>\n#define R register\n#define fp(i,a,b) for(R int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(R int i=a,I=b-1;i>I;--i)\n#define go(u) for(int i=head[u],v=e[i].v;i;i=e[i].nx,v=e[i].v)\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline char getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\nint read(){\n    R int res,f=1;R char ch;\n    while((ch=getc())>'9'||ch<'0')(ch=='-')&&(f=-1);\n    for(res=ch-'0';(ch=getc())>='0'&&ch<='9';res=res*10+ch-'0');\n    return res*f;\n}\nchar sr[1<<21],z[20];int K=-1,Z=0;\ninline void Ot(){fwrite(sr,1,K+1,stdout),K=-1;}\nvoid print(R int x){\n    if(K>1<<20)Ot();if(x<0)sr[++K]='-',x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++K]=z[Z],--Z);sr[++K]='\\n';\n}\nconst int N=1505,P=1e9+7;\ninline int add(R int x,R int y){return x+y>=P?x+y-P:x+y;}\ninline int dec(R int x,R int y){return x-y<0?x-y+P:x-y;}\ninline int mul(R int x,R int y){return 1ll*x*y-1ll*x*y/P*P;}\nint ksm(R int x,R int y){\n\tR int res=1;\n\tfor(;y;y>>=1,x=mul(x,x))if(y&1)res=mul(res,x);\n\treturn res;\n}\nint a[N][N],ans[N],s[N],inv[N],g[N];\nint n,m,p,k,T,qwq,aa,bb,tmp,res;\nvoid init(int n){\n\tinv[0]=inv[1]=1;\n\tfp(i,2,n)inv[i]=mul(P-P/i,inv[P%i]);\n}\nvoid Gauss(int n){\n\tfp(i,1,n-1){\n\t\tint t=ksm(a[i][i],P-2);\n\t\ta[i][i]=1,a[i][n]=mul(a[i][n],t);\n\t\tif(i!=n-1)a[i][i+1]=mul(a[i][i+1],t);\n\t\tfp(j,i+1,n-1){\n\t\t\tt=a[j][i],a[j][i]=0;\n\t\t\ta[j][i+1]=dec(a[j][i+1],mul(t,a[i][i+1])),\n\t\t\ta[j][n]=dec(a[j][n],mul(t,a[i][n]));\n\t\t}\n\t}\n    ans[n-1]=a[n-1][n];\n    fd(i,n-2,1)ans[i]=dec(a[i][n],mul(a[i][i+1],ans[i+1]));\n}\nint main(){\n//\tfreopen(\"testdata.in\",\"r\",stdin);\n\tT=read();\n\tinit(N-5);\n\twhile(T--){\n\t\tn=read(),p=read(),m=read(),k=read();\n\t\tif(!k||(!m&&k==1)){puts(\"-1\");continue;}\n\t\tif(!m){\n\t\t\twhile(p>0){if(p<n)++p;p-=k,++res;}\n\t\t\tprintf(\"%d\\n\",res),res=0;continue;\n\t\t}\n\t\tqwq=ksm(m+1,k),qwq=ksm(qwq,P-2)%P,tmp=1;\n\t\tfp(i,0,n)s[i]=0;\n\t\tfp(i,0,min(n,k)){\n\t\t\ts[i]=1ll*tmp*ksm(m,k-i)%P*qwq%P;\n\t\t\ttmp=1ll*tmp*inv[i+1]%P*(k-i)%P;\n\t\t}\n\t\tmemset(a,0,sizeof(a));\n\t\tbb=ksm(m+1,P-2),aa=mul(m,bb);\n\t\tfp(i,1,n-1){\n\t\t\t++a[i][i],++a[i][n+1];\n\t\t\tfp(j,0,i-1)a[i][i-j]=dec(a[i][i-j],mul(s[j],aa));\n\t\t\tfp(j,0,i)a[i][i+1-j]=dec(a[i][i+1-j],mul(s[j],bb));\n\t\t}\n\t\t++a[n][n],++a[n][n+1];\n\t\tfp(j,0,n-1)a[n][n-j]=dec(a[n][n-j],s[j]);\n\t\tGauss(n+1);\n\t\tprintf(\"%d\\n\",ans[p]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1551856126,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4457 \u3010[BJOI2018]\u6cbb\u7597\u4e4b\u96e8\u3011"
    },
    {
        "content": "\u8d21\u732e\u4e00\u4e2a\u4e0d\u7528\u9ad8\u65af\u6d88\u5143\u6765\u505a\uff08\u4f46\u5b9e\u9645\u4e0a\u5dee\u4e0d\u591a\u53ea\u4e0d\u8fc7\u89e3\u51b3\u95ee\u9898\u7684\u65b9\u5411\u4e0d\u4e00\u6837\uff09\u7684\u9898\u89e3\u5427\u3002\n\n\u9996\u5148$k$\u6b21\u4e2d\u6709$i$\u6b21\u6b63\u597d\u5bf9\u81ea\u5df1\u9020\u6210\u4e86\u4f24\u5bb3\u7684\u6982\u7387\u662f$\\frac{C_k^im^{k-i}}{(m+1)^k}$\u3002\n\n\u90a3\u4e48\u4f9d\u9760\u8fd9\u4e2a\u6211\u4eec\u5c31\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u7684\u9884\u5904\u7406\u4e00\u4e2a$p[i][j]$\u8868\u793a\u5f53\u524d\u8840\u91cf\u4e3a$i$\uff0c\u7ecf\u8fc7\u4e86\u4e00\u8f6e\u4e4b\u540e\u8840\u91cf\u53d8\u6210\u4e86$j$\u7684\u6982\u7387\u3002\n\n\u7136\u540e\u5c31\u8003\u8651\u8bbe$f[i]$\u4e3a\u8840\u91cf\u4e3a$i$\u65f6\u6263\u8840\u6263\u6210$0$\u7684\u671f\u671b\u6b65\u6570\u3002\n\n\u90a3\u4e48\u8f6c\u79fb\u5c31\u975e\u5e38\u663e\u7136\uff1a\n$$\nf[0]=0\n$$\n$$\nf[1]=p[1][0]\\times f[0]+p[1][1]\\times f[1]+p[1][2]\\times f[2]+1\n$$\n$$\nf[2]=p[2][0]\\times f[0]+p[2][1]\\times f[1]+p[2][2]\\times f[2]+p[2][3]\\times f[3]+1\n$$\n\t\t\t\t   ........\n$$\nf[i]=1+\\sum_{j=0}^{i+1}p[i][j]\\times f[j]\n$$\n\u90a3\u4e48\u663e\u7136\u8fd9\u4e2a\u53ef\u4ee5\u9ad8\u65af\u6d88\u5143\uff0c\u4f46\u662f\u590d\u6742\u5ea6\u4e3a$O(n^3)$\uff0c\u7206\u70b8\u3002\n\n\u8003\u8651\u770b\u770b\u8fd9\u4e2a\u8f6c\u79fb\u5f0f\u6709\u4ec0\u4e48\u6027\u8d28\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b2c$i$\u4e2a\u65b9\u7a0b\u7684\u53d8\u91cf\u662f$1$\u5230$i+1$\uff08\u7b2c$n$\u4e2a\u9664\u5916\uff09\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u5728\u7b2c$i$\u4e2a\u7b49\u5f0f\u5c06$f[i+1]$\u8868\u793a\u6210$a\\times f[1]+b$\u8fd9\u6837\u7684\u5f62\u5f0f\uff08$i\\in [1,n-1]$\uff09\uff0c\u7136\u540e\u518d\u5c06\u5b83\u4eec\u4ee3\u5165\u7b2c$n$\u4e2a\u7b49\u5f0f\u4e2d\u89e3\u51fa$f[1]$\uff0c\u7136\u540e\u518d\u4ee3\u5165\u6c42\u51fa$f[p]$\u5373\u53ef\u3002\n\n\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u662f$O(n^2)$\u7684\uff0c\u603b\u590d\u6742\u5ea6\u5c31\u662f$O(Tn^2)$\u3002\n\n\u9700\u8981\u7279\u5224$m=0$\u548c$k=0$\u7684\u60c5\u51b5\u3002\n\ncode\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<iostream>\n#include<set>\n#include<vector>\n#include<queue>\n#include<stack>\n#include<bitset>\n#define G 3\n#define eps 1e-15\n#define maxn 1505\n#define maxm 100010\n#define inf 999999999999999\n#define mod 1000000007\n#define mp(x,y) make_pair(x,y)\n#define fi first\n#define se second\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned int uint;\ntypedef pair<int,int> pii;\nint read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch-'0'<0||ch-'0'>9){if(ch=='-') f=-1;ch=getchar();}\n    while(ch-'0'>=0&&ch-'0'<=9){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nint T;\nint n,px,m,K,INV,INVX;\nint C[maxn],p[maxn][maxn],ci[maxn],cix[maxn];\nint quick_pow(int x,int p)\n{\n    int an=1,po=x;\n    while(p)\n    {\n        if(p&1)  an=1ll*an*po%mod;\n        po=1ll*po*po%mod;\n        p>>=1;\n    }\n    return an;\n}\nint calc(int i)\n{\n    if(i<0||i>K)  return 0;\n    return 1ll*C[i]*ci[i]%mod*INVX%mod;\n}\nstruct P{\n    int k,b;\n}a[maxn];\nP operator * (P a,int b)\n{\n    return (P){1ll*a.k*b%mod,1ll*a.b*b%mod};\n}\nP operator + (P a,P b)\n{\n    return (P){(a.k+b.k)%mod,(a.b+b.b)%mod};\n}\nP operator - (P a,int b)\n{\n    return (P){a.k,(a.b-b+mod)%mod};\n}\nP operator - (P a,P b)\n{\n    return (P){(a.k-b.k+mod)%mod,(a.b-b.b+mod)%mod};\n}\nint main()\n{\n    T=read();\n    while(T--)\n    {\n        n=read();px=read();m=read();K=read();INV=quick_pow(m+1,mod-2);INVX=quick_pow(INV,K);\n        if(!K)\n        {\n            puts(\"-1\");\n            continue;\n        }\n        if(!m)\n        {\n            if(K==1)  puts(\"-1\");\n            else{\n                int cnt=0;\n                while(px>0)  ++cnt,px=min(n,px+1)-K;\n                printf(\"%d\\n\",cnt);\n            }\n            continue;\n        }\n        for(int i=0;i<=min(n,K);i++)  ci[i]=quick_pow(m,K-i)%mod;\n        C[0]=1;for(int i=1;i<=min(n,K);i++)  C[i]=1ll*C[i-1]*(K-i+1)%mod*quick_pow(i,mod-2)%mod;\n        for(int i=1;i<=n;i++)\n        {\n            for(int j=1;j<=n;j++)\n            {\n                p[i][j]=(1ll*calc(i-j)*INV%mod*m%mod+1ll*calc(i-j+1)*INV%mod)%mod;\n                if(i==n)  p[i][j]=calc(i-j);\n            }\n        }\n        a[1]=(P){1,0};\n        for(int i=1;i<=n-1;i++)\n        {\n            a[i+1]=(P){0,0};\n            for(int j=1;j<=i;j++)  a[i+1]=a[i+1]+a[j]*p[i][j];\n            a[i+1]=(a[i]-a[i+1]-1)*quick_pow(p[i][i+1],mod-2);\n        }\n        P sum=(P){0,0};\n        for(int i=1;i<=n;i++)  sum=sum+a[i]*p[n][i];\n        sum=a[n]-sum-1;\n        int st=1ll*(mod-sum.b)*quick_pow(sum.k,mod-2)%mod;\n        int ans=(1ll*st*a[px].k%mod+a[px].b)%mod;\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1580997295,
        "uid": 46396,
        "name": "justin_cao",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4457 \u3010[BJOI2018]\u6cbb\u7597\u4e4b\u96e8\u3011"
    },
    {
        "content": "# 5568 -- \u3010BJOI2018\u3011\u6cbb\u7597\u4e4b\u96e8\n*\u4e00\u9053\u601d\u8def\u5f88\u50cf\u7684\u9898\u3010SHOI2017\u3011\u5206\u624b\u662f\u795d\u613f*\n## \u9898\u9762\u7ffb\u8bd1\n\n\u4f60\u6709$p$\u6ef4\u8840\uff0c\u6ee1\u8840$n$\u6ef4\uff0c\u8fdb\u884c\u5f88\u591a\u4e2a\u56de\u5408\uff1a\n\n- \u5148\u662f$\\frac 1{m+1}$\u7684\u6982\u7387\u589e\u52a0$1$\u8840\uff0c\u5df2\u7ecf\u6ee1\u8840\u5219\u6982\u7387\u4e3a$0$\n- \u7136\u540e\u662f$k$\u6b21\u5224\u5b9a\uff0c\u6bcf\u6b21\u5224\u5b9a$\\frac 1{m+1}$\u7684\u6982\u7387\u51cf\u5c11$1$\u8840\uff0c\u5df2\u7ecf\u6b7b\u4e86\u5219\u6982\u7387\u4e3a$0$\n\n\u95ee\u671f\u671b\u51e0\u4e2a\u56de\u5408\u6ca1\u8840\uff08\u7b2c$ans$\u4e2a\u56de\u5408\u6ca1\u5b8c\u5c31\u6b7b\u4e86\u7b97\u7b2c$ans$\u4e2a\u56de\u5408\uff09\n\n## \u521d\u6b65\u63a8\u5bfc\n\n\u8003\u8651\u671f\u671b$dp$\uff0c\u8bbe$f[x]$\u8868\u793a$x$\u6ef4\u8840\uff0c\u671f\u671b\u51e0\u56de\u5408\u6ca1\u8840\n\n\u72b6\u6001\u8f6c\u79fb\u5f88\u663e\u7136\uff0c\u5148\u679a\u4e3e\u6709\u6ca1\u6709\u52a0\u8840\uff0c\u518d\u679a\u4e3e\u5269\u51e0\u6ef4\u8840\n\n$f[x]=\\frac 1{m+1}\\sum_{i=0}^{x+1}f_ip_{x+1-i}+\\frac m{m+1}\\sum_{i=0}^xf_ip_{x-i}+1$\uff08$p_i$\u8868\u793a\u6263$i$\u6ef4\u8840\u7684\u6982\u7387\uff09\n\n$f[0]=0$\uff08\u8fb9\u754c\uff09\n\n\u8fd9\u91cc\u6709\u4e2a\u7ec6\u8282\uff0c\u7531\u4e8e\u53ea\u6709$k$\u6b21\u5224\u5b9a\uff0c\u6240\u4ee5\u53ef\u80fd\u6263\u4e0d\u4e86\u90a3\u4e48\u591a\u8840\uff0c\u6240\u4ee5\u628a$i>k$\u7684$p_i$\u90fd\u8bbe\u62100\u5c31\u597d\u4e86\n\n\n\n\u63a8\u5bfc$p_i$\uff0c\u76f8\u5f53\u4e8e\u662f$k$\u6b21\u5224\u5b9a\u4e2d\uff0c\u6709$i$\u6b21\u4e2d\u4e86\uff0c$k-i$\u6b21\u6ca1\u4e2d\uff0c\u518d\u4e58\u4e0a$\\binom ki$\n\n\u5f97\u5230$p_i=\\frac {m^{k-i}}{(m+1)^k}\\cdot\\binom ki$\n\n\u8fd9\u9053\u9898\u867d\u7136\u5224\u5b9a\u6b21\u6570\u591a\u8fbe$1e9$\uff0c\u4f46\u662f\u6263\u8840\u4e0a\u9650\u53ea\u6709$n$\uff0c1500\u7ea7\u522b\n\n\u6240\u4ee5\u53ea\u9884\u5904\u7406\u524d$n$\u4e2a\u5373\u53ef\uff0c\u7528\u9012\u63a8\u5f0f\u9884\u5904\u7406$p_i=p_{i-1}\\cdot\\frac{k-i+1}i\\cdot\\frac 1m$\n\n\n\n>\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c\u601d\u8003\u4e00\u4e0b\u3002\n\u5f53\u4f60\u53ea\u6709$x$\u6ef4\u8840\u7684\u65f6\u5019\uff0c$p_x$\u8fd8\u662f\u90a3\u4e48\u591a\u5417\uff1f\n\u6ce8\u610f\u5230\u5982\u679c\u4f60\u4e2d\u9014\u6ca1\u6709\u8840\u4e86\uff0c\u90a3\u4e48\u540e\u9762\u5224\u5b9a\u662f\u5fc5\u5b9a\u4e0d\u4e2d\u7684\uff08\u9898\u9762\u5199\u7684\uff09\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019$p_x$\u5c31\u4e0d\u662f\u90a3\u4e2a\u8868\u8fbe\u5f0f\u4e86\u3002\n\u4f46\u662f\u8fd9\u5e76\u6ca1\u6709\u5173\u7cfb\uff0c\u4e3a\u4ec0\u4e48\uff1f\n$x$\u6ef4\u8840\u6263$x$\u6ef4\uff0c\u5c31\u662f0\u4e86\uff0c\u800c$f_0=0$\uff0c\u5c31\u662f\u8bf4\u4f60\u4e0d\u7ba1\u5b83\u7cfb\u6570\u591a\u5c11\u90fd\u6ca1\u5f71\u54cd\uff0c\u4e58\u51fa\u6765\u90fd\u662f0\n\n\n\n\u7136\u540e\u65b9\u7a0b\u7684\u7cfb\u6570\u5c31\u9884\u5904\u7406\u597d\u4e86\uff0c\u5f97\u5230\u4e86$O(n^3)$\u7684\u9ad8\u65af\u6d88\u5143\u505a\u6cd5\n\n## \u7384\u5b66\u63a8\u5f0f\u5b50\n\n~~\u505a\u4e0d\u51fa\u6765\u9898\u6ca1\u4e8b\u513f\u5e72\u5c55\u5f00\u4e86\u4e00\u4e0b\u524d\u51e0\u4e2a\u8868\u8fbe\u5f0f~~\n\n$f_1=\\frac 1{m+1}(f_2p_0+f_1p_1+f_0p_2)+\\frac m{m+1}(f_1p_0+f_0p_1)+1$\n\n\u6ce8\u610f\u5230$f_0$\u8d21\u732e\u4e3a$0$\uff0c\u540e\u9762\u5c31\u90fd\u4e0d\u8003\u8651\u5b83\n\n\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u5316\u7b80\u6210$f_1=k_1f_2+b_1$\u7684\u5f62\u5f0f\n\n\n\n\u518d\u770b$f_2$\uff0c\u53d1\u73b0$f_2$\u53ea\u548c$f_1,f_2,f_3$\u6709\u5173\uff0c\u8fd9\u4e2a\u65f6\u5019\u628a$f_1$\u4ee3\u6362\u6210$k_1f_2+b_1$\n\n\u4e8e\u662f$f_2$\u5c31\u53ea\u548c$f_3$\u6709\u5173\u4e86\uff0c\u4e5f\u53ef\u4ee5\u8868\u793a\u6210$f_2=k_2f_3+b_2$\n\n\u7136\u540e\u5e26\u56de\u5f97\u5230$f_1=k_1f_2+b_1=(k_1k_2)f_3+(k_1b_2+b_1)$\n\n\u4e8e\u662f\u5728\u63a8$f_4$\u7684\u65f6\u5019\uff0c\u53c8\u53ef\u4ee5\u628a$f_1,f_2$\u90fd\u4ee3\u6362\u6210$f_3$\u7684\u5f0f\u5b50\uff0c\u90a3\u4e48$f_3$\u5c31\u53ea\u548c$f_4$\u6709\u5173\u4e86\n\n\n\n\u7136\u540e\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u7b97\u6cd5\uff1a\n\n- \u5bf9\u4e8e$f_n$\uff0c\u628a$f_1,f_2\\cdots f_{n-1}$\u90fd\u5206\u522b\u4ee3\u6362\u6210$k_if_n+b_i$\n\n- \u6c42\u51fa$f_n=k_nf_{n+1}+b_n$\n- \u5c06$f_n$\u4ee3\u56de\uff0c\u6c42\u51fa$f_i=k'_if_{n+1}+b'_i$\n\n\u8fdb\u884c\u5230$f_n$\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u9898\u9762\uff0c\u8fd9\u65f6\u5fc5\u5b9a\u4e0d\u4f1a\u52a0\u8840\uff0c\u90a3\u4e48\u6709\n\n$f_n=\\sum_{i=0}^nf_ip_{n-i}+1$\uff0c\u8fd9\u4e2a\u65f6\u5019\u628a\u540e\u9762\u7684$f_i$\u5168\u90e8\u4ee3\u6362\uff0c\u5c31\u5f88\u5bb9\u6613\u5730\u6c42\u51fa$f_n$\u4e86\n\n\u4e8e\u662f$f_p=k_pf_n+b_p$\u5373\u53ef\n\n\u590d\u6742\u5ea6$O(n^2)$\n\n\n\n## \u559c\u63d050\n\n### **\u7279\u5224\u7279\u5224\u7279\u5224**\n\n\u91cd\u8981\u7684\u4e8b\u8bf4\u4e09\u904d\n\n- $k=0$\u76f4\u63a5$-1$\n\n- $m=0$\n\n  \u8fd9\u4e2a\u65f6\u5019\u52a0\u8840\u548c\u51cf\u8840\u90fd\u662f\u5fc5\u4e2d\n\n  - $k=1$\uff0c\u5219\u6bcf\u56de\u5408\u8840\u91cf+1-1\uff0c\u4e00\u76f4\u4e0b\u53bb\uff08\u76f4\u63a5$-1$\uff09\n  - $k>1$\uff0c\u6bcf\u56de\u5408\u5fc5\u6263$1-k$\uff0c\u7b80\u5355\u7b97\u4e00\u7b97\u8f93\u51fa\u7b54\u6848",
        "postTime": 1599897916,
        "uid": 56825,
        "name": "oisdoaiu",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4457 \u3010[BJOI2018]\u6cbb\u7597\u4e4b\u96e8\u3011"
    },
    {
        "content": "\u6613\u77e5\u8fd9\u662f\u9053\u9ad8\u65af\u6d88\u5143\u9898\u3002\n\n\u8bbeE[k]\u4e3a**\u8840\u91cf\u4e3ak**\uff0c**\u751f\u547d\u503c\u964d\u4e3a0**\u7684\u671f\u671b\u6b65\u6570\uff0cE[0]=0\uff0c\u7b54\u6848\u4e3aE[p]\uff0c\u82e5\u65b9\u7a0b\u65e0\u89e3\u5373\u4e3a-1\u3002\n\n\u8003\u8651\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n\u9996\u5148\u8bbe\u7f6e\u4e00\u4e2a\u5927\u6982\u8303\u56f4\u4ee5\u904d\u5386\uff0c\u8840\u91cfi\u53ef\u7531\u8840\u91cfmax(1,i-1)~min(i+k,n)\u8f6c\u79fb\u800c\u6765\uff08\u8ba1\u7b97E[i]\u65f6\u8981\u53cd\u8fc7\u6765\uff09\u3002\n\n\u8bbe\u6b64\u8f6e\u8840\u91cf\u4e3ai\uff0c\u4e0a\u4e00\u8f6e\u7684\u8840\u91cf\u4e3aj\uff0c\u5355\u8f6e\u53d7\u5230x\u70b9\u4f24\u5bb3\u7684\u6982\u7387\u4e3af[x] (\u9012\u63a8\u516c\u5f0f\u5728\u540e\u9762)\uff0c\u6839\u636e\u662f\u5426\u8fbe\u5230\u8840\u91cf\u4e0a\u9650\u5206\u7c7b\u8ba8\u8bba\u3002\n\n\u82e5j==n\uff0c\u5219E[i]\u5bf9E[j]\u6709f[j-i]\u7684\u8d21\u732e\uff08\u56e0\u4e3a\u82f1\u96c4\u5df2\u8fbe\u8840\u91cf\u4e0a\u9650\uff09\uff1b\n\n\u5426\u5219\u8003\u8651\u662f\u5426\u4e3a\u82f1\u96c4\u8865\u8840\uff1a\n\n\u82e5\u4e0d\u8865\u8840\uff0c\u5219E[i]\u5bf9E[j]\u6709m/(m+1)*f[j-i]\u7684\u8d21\u732e\uff1b\n\n\u82e5\u8865\u8840\uff0c\u5219E[i]\u5bf9E[j]\u67091/(m+1)*f[j+1-i]\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u5148\u9884\u5904\u7406f[x]=C(k,x)*(1/(m+1))^x*(m/(m+1))^(k-x),\u8fd9\u91cc\u53ef\u4ee5\u7ebf\u6027\u9012\u63a8\u3002\n\n\u6700\u540e\u5c31\u662f\u9ad8\u65af\u6d88\u5143\u677f\u5b50\u4e86\u3002\n\n\u7136\u800c\u8fd9\u79cd\u505a\u6cd5\u53ea\u670930\u5206\u3002\n\n\u6ce8\u610f\u5728\u9884\u5904\u7406f[x]\u65f6**m==0\u5bfc\u81f4\u672a\u547d\u4e2d\u82f1\u96c4\u7684\u6982\u7387\u4e3a0**\u7684\u60c5\u51b5\n\n\u5b9e\u9645\u4e0af[k]\u662f\u975e0\u7684\uff0c\u7136\u800c\u9012\u63a8\u8fc7\u7a0b\u4e2d0^0\u4f1a\u7b49\u4e8e9\uff0c\u7279\u5224\u5373\u53ef\u3002\n\n\u7136\u540e\u4f60\u5c31\u5f97\u5230\u4e8670\u5206\uff0cO(n^3)\u7684\u9ad8\u65af\u6d88\u5143\u662f\u786c\u4f24\u3002\n\n\u5982\u4f55\u4f18\u5316\u5462\uff1f\n\n\u6253\u5370\u77e9\u9635\uff08\u6216\u8005\u4ece\u6784\u9020\u77e9\u9635\u8fc7\u7a0b\u4e2d\u53d1\u73b0\uff09\u6ce8\u610f\u5230\u77e9\u9635**\u53f3\u4e0a\u89d2**\u57fa\u672c\u4e0a\u662f0\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u5316\u4e3a\u4e0b\u4e09\u89d2\u77e9\u9635\u3002\n\n\u7531\u6784\u9020\u77e9\u9635\u8fc7\u7a0b\u53ef\u53d1\u73b0\u5bf9\u4e8e\u7b2ci\u5217\u6700\u591a\u53ea\u9700\u6d88\u53bb\u7b2ci-1\u884c\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u4e3aO(n^2)\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6O(Tn^2)\uff0c\u8dd1\u4e86[3468ms](https://www.luogu.org/record/show?rid=6859937)\u3002\n\n\u6700\u540e\u9644\u4e0a\u4ee3\u7801\uff08\u4ee3\u7801\u6bd4\u8f83\u6e05\u6670\uff0c\u4f46\u662f\u5e38\u6570\u8f83\u5927\uff09\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\nconst int size=1515,mod=1000000007;\ntypedef long long Int64;\nInt64 powm(Int64 x,int k){\n    Int64 res=1;\n    while(k){\n        if(k&1)res=res*x%mod;\n        k>>=1,x=x*x%mod;\n    }\n    return res;\n}\nInt64 inv(Int64 x){\n    return powm(x,mod-2);\n}\nInt64 A[size][size],B[size],ans[size];\nint solve(int n,int init){\n    for(int i=n;i>=0;--i){\n        int x=(i==0 || A[i][i])?i:i-1;\n        if(A[x][i]==0)return -1;\n        if(i==0)break;\n        if(i!=x){\n            for(int j=0;j<=i;++j)\n                std::swap(A[i][j],A[x][j]);\n            std::swap(B[i],B[x]);\n        }\n        else{\n        \tInt64 invv=inv(A[i][i]);\n\t        int j=i-1;\n\t        if(A[j][i]==0)continue;\n            Int64 mul=A[j][i]*invv%mod;\n            for(int k=0;k<=i;++k)\n                A[j][k]=(A[j][k]-A[i][k]*mul)%mod;\n            B[j]=(B[j]-B[i]*mul)%mod;\n\t\t}\n    }\n    for(int i=0;i<=init;++i){\n    \tInt64 res=B[i];\n    \tfor(int j=0;j<i;++j)\n    \t\tres=(res-A[i][j]*ans[j])%mod;\n    \tans[i]=res*inv(A[i][i])%mod;\n\t}\n\treturn (ans[init]+mod)%mod;\n}\nInt64 LUT[size],invTable[size];\nint foo(int n,int init,int m,int k){\n    Int64 p=inv(m+1),ip=(1-p+mod)%mod,invip=inv(ip);\n    {\n    \tmemset(LUT,0,sizeof(LUT));\n    \tif(ip==0){\n    \t\tif(k<=n)LUT[k]=powm(p,k);\n    \t}\n    \telse{\n\t        Int64 cur=powm(ip,k),c=1;\n\t        int end=std::min(n,k);\n\t        for(int i=0;i<=end;++i){\n\t            LUT[i]=cur*c%mod;\n\t            c=c*(k-i)%mod*invTable[i+1]%mod;\n\t            cur=cur*p%mod*invip%mod;\n\t        }\n    \t}\n    }\n    memset(A,0,sizeof(A));\n    for(int i=0;i<=n;++i){\n        A[i][i]=-1;\n        B[i]=(i==0?0:-1);\n    }\n    for(int i=0;i<=n;++i){\n        int begin=std::max(1,i-1),end=std::min(n,i+k);\n        for(int j=begin;j<=end;++j){\n        \tif(j==n)A[j][i]=(A[j][i]+LUT[j-i])%mod;\n\t\t\telse{\n\t\t\t\tif(j>=i)A[j][i]=(A[j][i]+ip*LUT[j-i])%mod;\n            \tif(j+1>=i)A[j][i]=(A[j][i]+p*LUT[j+1-i])%mod;\n\t\t\t}\n        }\n    }\n    return solve(n,init);\n}\nint main(){\n    invTable[0]=invTable[1]=1;\n    for(int i=2;i<size;++i)\n        invTable[i]=(mod-mod/i)*invTable[mod%i]%mod;\n    int t;\n    scanf(\"%d\",&t);\n    while(t--){\n        int n,p,m,k;\n        scanf(\"%d%d%d%d\",&n,&p,&m,&k);\n        printf(\"%d\\n\",foo(n,p,m,k));\n    }\n    return 0;\n}\n\n```\n\n\u4e71\u641e\uff1a\u82e5\u9898\u76ee\u8981\u6c42\u8f93\u51fa\u5c0f\u6570\uff0cdp\u591a\u8f6e\u540e\u76f4\u63a5\u8f93\u51fa\u671f\u671b\u4e5f\u53ef\u4ee5\u9a97\u70b9\u5206\u3002\n",
        "postTime": 1524039879,
        "uid": 25170,
        "name": "dtcxzyw",
        "ccfLevel": 0,
        "title": "P4457 [BJOI2018]\u6cbb\u7597\u4e4b\u96e8 \u9898\u89e3"
    },
    {
        "content": "\u6211\u4e0d\u662f\u5f88\u4f1a\u77e9\u9635\u505a\u8fd9\u9053\u9898(\u4e0d\u4f1a\u5361\u5e38)\u3002\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u672c\u8d28\u5dee\u4e0d\u591a\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u4e0d\u7528\u77e9\u9635\uff0c\u53ef\u80fd\u5e38\u6570\u4f1a\u5c0f\u4e00\u70b9\uff1f\u53cd\u6b63\u76ee\u524d\u5f00O2\u4e0d\u5f00O2\u90fd\u662f\u6700\u5feb\u7684\u2026\u2026\n\n\u7528$dp[i]$\u8868\u793a\u8fd8\u5269$i$\u70b9\u8840\u7684\u65f6\u5019\uff0c\u671f\u671b\u8fd8\u8981\u6709\u591a\u5c11\u8f6e\u64cd\u4f5c\u3002\n\n\u548c\u697c\u4e0a\u9898\u89e3\u4e00\u6837\uff0c\u7528$f[x]$\u8868\u793a$K$\u6b21\u4e2d\u6709$i$\u6b21\u6253\u5230\u82f1\u96c4\u7684\u6982\u7387\u3002\n\n$f[x]=C(K,x)(\\frac{1}{m+1})^x(\\frac{m}{m+1})^{(k-x)}$\n\n**\u9996\u5148\u5bf9\u4e8e$m=0$\u7684\u60c5\u51b5\u7279\u5224\u3002**\n\n\u5bf9\u4e8e$m!=0$\u60c5\u51b5\uff0c\u6211\u4eec\u53d1\u73b0\u6709\n\n$dp[0]=0$\n\n$dp[1]=a_{1,2}dp[2]+a_{1,1}dp[1]+1$\n\n...\n\n$dp[i]=a_{i,i+1}dp[i+1]+a_{i,i}dp[i]+...+a_{i,1}dp[1]+1$\n\n...\n\n$dp[n]=a_{n,n}dp[n]+a_{n,n-1}dp[n-1]+...+a_{n,1}dp[1]+1$\n\n\u5176\u4e2d$a_{i,j}$\u8868\u793a\u82f1\u96c4$i$\u70b9\u8840\u5728\u4e00\u8f6e\u64cd\u4f5c\u540e\u53d8\u6210$j$\u70b9\u8840\u7684\u6982\u7387\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u6839\u636e$f$\u7b97\u51fa\u6765\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u6240\u4ee5\u8bf4\u6211\u4eec\u53ef\u4ee5\u5f97\u5230$n$\u4e2a\u7b49\u5f0f\uff0c\u7b2c$i$\u4e2a\u5f0f\u5b50\u662f$dp[i]$\u7b49\u4e8e\u591a\u5c11\u591a\u5c11\n\n$n$\u4e2a\u672a\u77e5\u6570\uff0c$n$\u4e2a\u7b49\u5f0f(\u65b9\u7a0b)\uff0c\u5f88\u4f18\u79c0\u7684\u6837\u5b50\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u7b2c$i$\u4e2a\u7b49\u5f0f\u53f3\u8fb9\u6709$dp[i+1]$\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u9012\u63a8\uff0c\u611f\u89c9\u5f88\u607c\u706b\u3002\n\n\u6211\u4eec\u628a\u7b2c$i$\u4e2a\u5f0f\u5b50\u53f3\u8fb9\u7684$dp[i+1]$\u653e\u5230\u7b49\u5f0f\u5de6\u8fb9\u6765\uff0c\u7136\u540e\u628a$dp[i]$\u653e\u5230\u7b49\u5f0f\u53f3\u8fb9\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86$dp[i+1]$\u7b49\u4e8e\u591a\u5c11\u591a\u5c11\u3002\n\n\u6ce8\u610f\u7b2c$n$\u4e2a\u5f0f\u5b50\u4f8b\u5916\uff0c\u56e0\u4e3a\u548c$dp[n+1]$\u65e0\u5173\uff0c\u4ecd\u662f$dp[n]$\u7b49\u4e8e\u591a\u5c11\u591a\u5c11\u3002\n\n\u6240\u4ee5\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u7528\u7b2c$i$\u4e2a\u5f0f\u5b50\u7b97$dp[i+1]$\uff1f\n\n\u4f46\u662f\u6211\u4eec\u7b97\u4e0d\u51fa$dp[1]$\u5440\uff0c\u4e5f\u6ca1\u6cd5\u76f4\u63a5\u5f80\u540e\u9012\u63a8\u3002\n\n\u90a3\u6211\u4eec\u5148\u8bbe$dp[1]=X$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u7b2c$1$~$n-1$\u4e2a\u5f0f\u5b50\uff0c\u628a$dp[i]$\u8868\u793a\u6210$AX+B$\u7684\u5f62\u5f0f\uff0c\u9012\u63a8\u7b97\u51fa$dp[n]=A_1X+B_1$\uff0c\u7136\u540e\u6839\u636e\u7b2c$n$\u4e2a\u5f0f\u5b50\u7b97\u51fa$dp[n]=A_2X+B_2$\u3002\n\n\u90a3\u4e48$A_1X+B_1=A_2X+B_2$\uff0c\u89e3\u4e00\u5143\u4e00\u6b21\u65b9\u7a0b\u76f4\u63a5\u7b97\u51fa$X$\u3002\n\n**\u6ce8\u610f\u7279\u5224\u89e3\u4e0d\u51fa$X$\u7684\u60c5\u51b5\u8f93\u51fa-1\u3002**\n\n\u4ee3\u7801\u4e2d\u6709\u7b80\u5355\u7684\u6ce8\u91ca\u3002\n\n```cpp\n//Serene\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdlib>\n#include<cstdio>\n#include<cmath>\nusing namespace std;\n#define ll long long\n#define db double\n#define For(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Rep(i,a,b) for(register int i=(a);i>=(b);--i)\nconst int maxn=3000+7;\nconst ll mod=1e9+7;\nll Td,n,P,m,K,X;\n\nchar cc; ll ff;\ntemplate<typename T>void read(T& aa) {\n    aa=0;cc=getchar();ff=1;\n    while((cc<'0'||cc>'9')&&cc!='-') cc=getchar();\n    if(cc=='-') ff=-1,cc=getchar();\n    while(cc>='0'&&cc<='9') aa=aa*10+cc-'0',cc=getchar();\n    aa*=ff;\n}\n\nll qp(ll x,ll k) {\n    if(x<=1) return x;\n    ll rs=1;\n    while(k) {\n        if(k&1) rs=rs*x%mod;\n        k>>=1; x=x*x%mod;\n    }\n    return rs;\n}\n\nll mo(ll x) {if(x>=mod) x-=mod; return x;}\n\nstruct T{\n    ll x,y;\n    T(ll x=0.,ll y=0.):x(x),y(y){}\n    inline T operator + (const T& b) const{return T(mo(x+b.x),mo(y+b.y));}\n    inline T operator - (const T& b) const{return T(mo(x-b.x+mod),mo(y-b.y+mod));}\n    inline T operator * (const T&b) const{return T((x*b.y+y*b.x)%mod,y*b.y%mod);}\n}dp[maxn],f[maxn],o,r,t,inv,finv;\n\nll work() {\n    if(K==0) return -1;\n    if(K==1&&n!=1) return -1;\n    dp[0]=T(0,0);\n    ll x; T p;\n    For(i,1,n-1) {\n        dp[i]=T(0,1)+dp[max(i+1-K,(ll)0)];\n    }\n    dp[n]=T(0,1)+dp[max(n-K,(ll)0)];\n    return dp[P].y;\n}\t\n\nll solve() {\n    if(P==0) return 0;\n    if(n==1&&K==0) return -1;\n    ll x; T p;\n    o=T(0,m+1); r=T(0,m); inv=T(0,qp(qp(m+1,K),mod-2));\n    f[0]=T(0,1); x=min(K,n);\n    For(i,1,x) f[i]=f[i-1]*T(0,(K-i+1)*qp(i,mod-2)%mod);\n    For(i,0,x) f[i]=f[i]*inv*T(0,qp(m,K-i)); \n    if(m==0) return work();\n    finv=T(0,qp(f[0].y,mod-2));\n    if(f[0].y==1||f[0].y==0) return -1;\n    //f[i]: probability of get i of K , finv : inv of f[0]\n    dp[0]=T(0,0);\n    dp[1]=T(1,0);\n    //dp[i+1]=((m+1)(dp[i]-1)-m*sum(f[j]*dp[i-j])-sum(f[j]*dp[i-j+1]))/f[0]\n    For(i,1,n-1) {\n        dp[i+1]=o*dp[i]-o;\n        x=min((ll)i,K);\n        p=T(0,0);\n        For(j,0,x) p=p+f[j]*dp[i-j];\n        dp[i+1]=dp[i+1]-p*r;\n        x=min((ll)i+1,K);\n        For(j,1,x) dp[i+1]=dp[i+1]-f[j]*dp[i-j+1];\n        dp[i+1]=dp[i+1]*finv;\n    }\n    //(1-f[0])*dp[n]=sum(f[j]*dp[n-j])+1;\n    t=T(0,1); x=min(n,K);\n    For(j,1,x) t=t+f[j]*dp[n-j];\n    t=t*T(0,qp(mo(mod+1-f[0].y),mod-2));\n    t=t-dp[n];\n    if(t.x==0&&dp[P].x!=0) return -1;\n    if(t.x) X=(mod-1)*t.y%mod*qp(t.x,mod-2)%mod;\n    return (X*dp[P].x%mod+dp[P].y)%mod;\n}\n\nint main() {\n    read(Td);\n    while(Td--) {\n        read(n); read(P); read(m); read(K);\n        printf(\"%lld\\n\",solve());\n    }\n//\tcerr<<clock()<<\"\\n\";\n    return 0;\n}\n\n```",
        "postTime": 1524370128,
        "uid": 22151,
        "name": "shixinyi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4457 \u3010[BJOI2018]\u6cbb\u7597\u4e4b\u96e8\u3011"
    },
    {
        "content": "\u9898\u610f\u63cf\u8ff0\u6bd4\u8f83\u8ff7\u60d1\uff0c\u5269\u4e0b $m$ \u4e2a\u6570\u662f\u65e0\u7a77\u7684\u610f\u601d\u662f\u4efb\u610f\u64cd\u4f5c\u5bf9\u5b83\u4eec\u4e0d\u4ea7\u751f\u5f71\u54cd\uff0c\u64cd\u4f5c\u5f71\u54cd\u7684\uff0c\u6216\u8005\u8bf4\u5f71\u54cd\u9009\u54ea\u4e2a\u6570\u8fdb\u884c\u64cd\u4f5c\u7684\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u6570\uff0c\u6240\u4ee5\u5f53\u524d\u7684\u72b6\u6001\u53ef\u4ee5\u7528\u7b2c\u4e00\u4e2a\u6570\u7684\u503c\u6765\u8868\u793a\u3002\n\n\u8bbe $dp_i$ \u8868\u793a\u7b2c\u4e00\u4e2a\u6570\u4e3a $i$ \u65f6\u628a\u5b83\u53d8\u4e3a $0$ \u7684\u671f\u671b\u6b65\u6570\uff0c\u53ef\u5f97\uff1a\n\n$$\n\\begin{aligned}\n&dp_0 = 0\\\\\n&dp_i = \\frac{1}{m+1} \\times (\\sum_{j=0}^{min(i+1, k)}[\\binom{k}{j} \\times (\\frac{1}{m+1})^j \\times (\\frac{m}{m+1})^{k-j} \\times dp_{i+1-j}]) \\\\ &+ \\frac{m}{m+1} \\times (\\sum_{j=0}^{min(i, k)}[\\binom{k}{j} \\times (\\frac{1}{m+1})^j \\times (\\frac{m}{m+1})^{k-j} \\times dp_{i-j}]) + 1\\\\\n&dp_n = \\sum_{j=0}^{min(n, k)}[\\binom{k}{j} \\times (\\frac{1}{m+1})^j \\times (\\frac{m}{m+1})^{k-j} \\times dp_{n-j}]+1\\\\\n\\end{aligned}\n$$\n\n\u82e5 $dp_p$ \u65e0\u89e3\u5219\u51cf\u4e0d\u5230 $0$\uff0c\u5426\u5219 $dp_p$ \u5373\u4e3a\u7b54\u6848\u3002\n\n\u5bf9\u4e8e $dp_0$\uff0c\u663e\u7136\u4e0d\u9700\u8981\u4efb\u4f55\u64cd\u4f5c\u3002\n\n\u5bf9\u4e8e $dp_n$ \u7684\u8f6c\u79fb\uff0c\u679a\u4e3e\u7b2c\u4e00\u4e2a\u6570\u4e00\u5171\u51cf\u4e86 $j$ \u6b21\u4ee5\u53ca\u5177\u4f53\u5728\u54ea\u51e0\u6b21\u64cd\u4f5c\u4e2d\u51cf\u4e86\u7b2c\u4e00\u4e2a\u6570\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u51cf\u4e86 $j$ \u6b21\u7684\u65b9\u6848\uff0c\u6709 $(\\frac{1}{m+1})^j \\times (\\frac{m}{m+1})^{k-j}$ \u7684\u6982\u7387\u51fa\u73b0\uff0c\u53c8\u56e0\u4e00\u5171\u6709 $\\binom{k}{j}$ \u79cd\u65b9\u6848\uff0c\u6240\u4ee5\u628a $n$ \u51cf\u4e3a $n-j$ \u7684\u6982\u7387\u4e3a $\\binom{k}{j} \\times (\\frac{1}{m+1})^j \\times (\\frac{m}{m+1})^{k-j}$\u3002\n\n\u5bf9\u4e8e $dp_i$ \u7684\u8f6c\u79fb\uff0c\u7c7b\u4f3c\u4e8e $dp_n$\u3002\u7b2c\u4e00\u4e2a\u6570 $i$ \u6709 $\\frac{1}{m+1}$ \u7684\u6982\u7387\u53d8\u4e3a $i+1$\uff0c\u6709 $\\frac{m}{m+1}$ \u7684\u6982\u7387\u4e0d\u53d8\uff0c\u5206\u7c7b\u4ee5\u540e\u4e24\u79cd\u72b6\u6001\u7684\u8f6c\u79fb\u4e0e $dp_n$ \u7684\u8f6c\u79fb\u76f8\u540c\u3002\n\n\u9700\u6ce8\u610f\uff0c\u7531\u4e8e\u7b2c\u4e00\u4e2a\u6570\u51cf\u4e3a $0$ \u540e\u4e0d\u80fd\u518d\u51cf\u5c0f\uff0c\u8bbe\u5f53\u524d\u7b2c\u4e00\u4e2a\u6570\u4e3a $i$\uff0c\u90a3\u4e48\u6700\u591a\u8fdb\u884c $min(i, k)$ \u6b21\u51cf $1$ \u64cd\u4f5c\u3002\n\n$\\text{dp}$ \u72b6\u6001\u548c\u8f6c\u79fb\u8bbe\u8ba1\u597d\u4e86\uff0c\u63a5\u4e0b\u6765\u601d\u8003\u600e\u4e48\u8f6c\u79fb\u3002\u53d1\u73b0\u8f6c\u79fb\u6709\u540e\u6548\u6027\uff0c\u518d\u770b\u4e00\u773c\u6570\u636e\u8303\u56f4\uff0c$1 \\leq p \\leq n \\leq 1500$\uff0c\u4f3c\u4e4e\u53ef\u4ee5\u7528\u9ad8\u65af\u6d88\u5143\uff1f\n\n\u4f46\u6b63\u5e38\u9ad8\u65af\u6d88\u5143\u590d\u6742\u5ea6\u662f $O(n^3)$ \u7684\uff0c$O(T \\cdot n^3)$ \u8fc7\u4e0d\u4e86\u3002/kk\n\n\u4f46\u89c2\u5bdf\u8f6c\u79fb\u65b9\u7a0b\u6216\u6253\u5370\u4e00\u4e0b\u589e\u5e7f\u77e9\u9635\u53d1\u73b0\u77e9\u9635\u90fd\u662f\u5f62\u5982\u8fd9\u6837\u7684\uff1a\n\n$\n\\begin{bmatrix}\n k_{1,1} & k_{1,2} & ... & 0 & 0 & k_{1,n+1}\\\\\n k_{2,1} & k_{2,2} & k_{2,3} & ... & 0 & k_{2,n+1}\\\\\n ... & ... & ... & ... & ... & ...\\\\\n 0 & k_{n-1,n-1-min(n-1,k)} & k_{n-1,n-min(n-1,k)} & ... & k_{n-1,n} & k_{n-1,n+1}\\\\\n 0 & 0 & k_{n,n-min(n,k)} & ... & k_{n,n} & k_{n,n+1}\n\\end{bmatrix}\n$\n\n\u770b\u5f97\u51fa\u77e9\u9635\u7684\u5de6\u4e0b\u548c\u53f3\u4e0a\u4f1a\u5b58\u5728\u4e00\u5806 $0$\u3002\u5f53 $k \\ge n-1$ \u65f6\uff0c\u5171\u6709\u53f3\u4e0a\u89d2 $\\frac{(n-1)(n-2)}{2}$ \u4e2a $0$\u3002\u4ece\u4e0a\u5f80\u4e0b\u6d88\u5143\uff0c\u5f53\u524d\u884c\u6700\u591a\u53ea\u6709 $2$ \u4e2a\u6570\uff0c\u4e8e\u662f\u9ad8\u65af\u6d88\u5143\u7684\u590d\u6742\u5ea6\u53ef\u4ee5\u964d\u5230 $O(n^2)$\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u65f6\uff0c\u7531\u4e8e $k$ \u5f88\u5927\uff0c\u4f46\u662f\u662f\u56fa\u5b9a\u7684\uff0c\u53ef\u4ee5\u9012\u63a8\u9884\u5904\u7406\u51fa\u6240\u6709\u7684\u6982\u7387\u7cfb\u6570\u3002\n\n\u8bbe\uff1a\n\n$$f(x)=\\binom{k}{x} \\times (\\frac{1}{m+1})^x \\times (\\frac{m}{m+1})^{k-x}$$\n\n\u5c55\u5f00\u5f97\uff1a\n\n$$f(x) = \\frac{k!}{x!(k-x)!} \\times \\frac{m^{k-x}}{(m+1)^k}$$\n\n$f(x)$ \u9012\u63a8\u5f0f\u4e3a\uff1a\n\n$$f(x) = \\frac{(k-x+1) \\times f(x-1)}{m x}$$\n\n\u8d77\u59cb\u9879\uff1a\n$$f(0) = (\\frac{m}{m+1})^k$$\n\n\u8fd8\u6709\u4e00\u4e9b\u5c0f\u7ec6\u8282\uff0c$k=0$ \u4f46 $p \\ne 0$ \u65f6\u65e0\u89e3\uff0c$m=0$ \u65f6\u76f4\u63a5\u8ba1\u7b97\uff0c\u9ad8\u65af\u6d88\u5143\u7b2c\u4e8c\u5c42\u51fd\u6570\u91cc\u4e0d\u80fd\u6709\u6c42\u9006\u5143\u64cd\u4f5c\uff0c\u5426\u5219\u590d\u6742\u5ea6\u591a\u4e00\u4e2a $\\text{log}$\u3002\n\n\u6574\u4f53\u590d\u6742\u5ea6 $O(T \\cdot n^2)$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst ll SIZE = 1505;\nconst ll mod = 1000000007;\nll a[SIZE][SIZE];\nll f[SIZE];\nll n, st, m, K;\nll T;\n\nll power(ll x, ll y){\n\tll jl = 1;\n\twhile(y){\n\t\tif(y & 1) jl = (jl * x) % mod;\n\t\tx = (x * x) % mod;\n\t\ty >>= 1;\n\t}\n\treturn jl;\n}\n\nint main(){\n\tscanf(\"%lld\", &T);\n\twhile(T--){\n\t\tscanf(\"%lld%lld%lld%lld\", &n, &st, &m, &K);\n\t\t//\u7279\u5224 \n\t\tif(K == 0){\n\t\t\tprintf(\"-1\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tif(m == 0){\n\t\t\tif(K <= 1) printf(\"-1\\n\");\n\t\t\telse{\n\t\t\t\tll cnt = 0;\n\t\t\t\twhile(st > 0){\n\t\t\t\t\tif(st < n) st++;\n\t\t\t\t\tst -= K;\n\t\t\t\t\tcnt++;\n\t\t\t\t}\n\t\t\t\tprintf(\"%lld\\n\", cnt);\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\t\t//\u6784\u9020\u589e\u5e7f\u77e9\u9635 \n\t\tll t = power(m+1, mod-2), tt = ((1-t)%mod+mod)%mod;\n\t\tfor(ll i = 1; i <= n; i++){\n\t\t\tfor(ll j = 1; j <= n+1; j++){\n\t\t\t\ta[i][j] = 0;\n\t\t\t}\n\t\t\tf[i] = 0;\n\t\t}\n\t\tll xx;\n\t\tf[0] = power((m * t) % mod, K);\n\t\tfor(ll i = 1; i <= n; i++){\n\t\t\tf[i] = ((((K-i+1+mod)%mod) * f[i-1])%mod * power((m*i)%mod, mod-2)) % mod;\n\t\t}\n\t\tfor(ll i = 1; i < n; i++){\n\t\t\ta[i][i] = (-1+mod)%mod;\n\t\t\tfor(ll j = 0; j <= min(i+1, K); j++){\n\t\t\t\txx = (f[j] * t) % mod;\n\t\t\t\ta[i][i+1-j] = (a[i][i+1-j] + xx) % mod;\n\t\t\t}\n\t\t\tfor(ll j = 0; j <= min(i, K); j++){\n\t\t\t\txx = (f[j] * tt) % mod;\n\t\t\t\ta[i][i-j] = (a[i][i-j] + xx) % mod;\n\t\t\t}\n\t\t\ta[i][n+1] = (-1+mod)%mod;\n\t\t}\n\t\ta[n][n] = mod-1;\n\t\tfor(ll j = 0; j <= min(n, K); j++){\n\t\t\ta[n][n-j] = (a[n][n-j] + f[j]) % mod;\n\t\t}\n\t\ta[n][n+1] = mod-1;\n\t\t//\u9ad8\u65af\u6d88\u5143 \n\t\tfor(ll i = 1; i <= n; i++){\n\t\t\tll uu = power(a[i][i], mod-2);\n\t\t\tfor(ll j = i+1; j <= n; j++){\n\t\t\t\txx = (a[j][i] * uu) % mod;\n\t\t\t\tfor(ll k = i; k <= n; k++){\n\t\t\t\t\tif(a[i][k] == 0) break;\n\t\t\t\t\ta[j][k] = (a[j][k] - ((xx * a[i][k]) % mod) + mod) % mod;\n\t\t\t\t}\n\t\t\t\ta[j][n+1] = (a[j][n+1] - ((xx * a[i][n+1]) % mod) + mod) % mod;\n\t\t\t}\n\t\t}\n\t\tfor(ll i = n-1; i >= 1; i--){\n\t\t\txx = (a[i][i+1] * power(a[i+1][i+1], mod-2)) % mod;\n\t\t\ta[i][i+1] = 0;\n\t\t\ta[i][n+1] = (a[i][n+1] - ((xx*a[i+1][n+1])%mod) + mod) % mod;\t\n\t\t}\n\t\t//\u5224\u65e0\u89e3 \n\t\tbool ff = 1;\n\t\tfor(int i = 1; i <= n; i++){\n\t\t\tif(a[i][i] == 0 && a[i][n+1] != 0){\n\t\t\t\tff = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(!ff) printf(\"-1\\n\");\n\t\telse{\n\t\t\tll ans = (a[st][n+1] * power(a[st][st], mod-2)) % mod;\n\t\t\tprintf(\"%lld\\n\", ans);\t\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1679647967,
        "uid": 271096,
        "name": "Semorius",
        "ccfLevel": 7,
        "title": "P4457 [BJOI2018]\u6cbb\u7597\u4e4b\u96e8"
    },
    {
        "content": "[\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P4457 \"\u539f\u9898\u94fe\u63a5\")\r\n\r\n## \u9898\u610f\r\n\r\n\u521d\u59cb\u65f6\u73a9\u5bb6\u6709 $p$ \u6ef4\u8840\uff0c\u6ee1\u8840 $n$ \u6ef4\uff0c\u6bcf\u4e2a\u56de\u5408\u4f1a\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a\r\n\r\n* \u82e5\u5f53\u524d\u8fd8\u6ca1\u6709\u6ee1\u8840\uff0c\u5219\u4ee5 $\\frac{1}{m+1}$ \u7684\u6982\u7387\u589e\u52a0\u4e00\u6ef4\u8840\uff1b\r\n\r\n* $k$ \u6b21\u5224\u5b9a\uff0c\u6bcf\u6b21\u4ee5 $\\frac{1}{m+1}$ \u7684\u6982\u7387\u6263\u9664\u4e00\u6ef4\u8840\uff0c\u5f53\u8840\u91cf\u51cf\u5c11\u4e3a $0$ \u65f6\u6e38\u620f\u7ed3\u675f\u3002\r\n\r\n\u6c42\u73a9\u5bb6\u80fd\u5b58\u6d3b\u7684\u671f\u671b\u56de\u5408\u6570\u3002\r\n\r\n$1 \\leq p \\leq n \\leq 1500$\uff0c$0 \\leq m, k \\leq 10^9$\u3002\r\n\r\n## \u601d\u8def\r\n\r\n\u8bbe\u4e00\u4e2a\u56de\u5408\u6263\u9664 $i$ \u6ef4\u8840\u7684\u6982\u7387\u4e3a $P_i(i \\leq k)$\uff0c\u7531\u6570\u5b66\u9009\u4fee\u4e09\u7684\u77e5\u8bc6\u53ef\u77e5\uff0c\u8fd9\u5176\u5b9e\u662f\u4e00\u4e2a**\u4f2f\u52aa\u5229\u8bd5\u9a8c**\u7684\u6a21\u578b\uff0c\u53ef\u4ee5\u5f97\u5230\u8868\u8fbe\u5f0f\uff1a\r\n\r\n$$P_i=\\binom{n}{i} (\\frac{1}{{m+1}})^i (\\frac{m}{{m+1}})^{n-i}$$\r\n\r\n\u7531\u4e8e\uff1a\r\n\r\n$$\\dfrac{P_i}{P_{i-1}}=\\dfrac{\\binom{n}{i} (\\frac{1}{{m+1}})^i (\\frac{m}{{m+1}})^{n-i}}{\\binom{n}{i-1} (\\frac{1}{{m+1}})^{i-1} (\\frac{m}{{m+1}})^{n-i+1}}$$\r\n\r\n\u53ef\u4ee5\u5f97\u5230\u9012\u63a8\u5f0f\uff1a\r\n\r\n$$P_i=P_{i-1} \\times \\frac{1}{m} \\times \\frac{k-i+1}{i}$$\r\n\r\n\u7531\u4e8e\u4e00\u4e2a\u56de\u5408\u6700\u591a\u4e00\u6b21\u5c06\u6ee1\u8840\u5168\u90e8\u6263\u5b8c\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206\u53ef\u4ee5 $O(n)$ \u9884\u5904\u7406\u5f97\u5230\u3002\r\n\r\n\u8bbe $f_i$ \u4e3a\u6709 $i$ \u6ef4\u8840\u7684\u671f\u671b\u5b58\u6d3b\u56de\u5408\u6570\uff0c\u5f53 $i\\in [1,n-1]$ \u65f6\uff0c\u7b80\u5355\u5206\u7c7b\u8ba8\u8bba\u4e0d\u96be\u5f97\u5230\u8868\u8fbe\u5f0f\uff1a\r\n\r\n$$f_i=\\sum_{j=1}^{i}f_j (\\frac{1}{m+1} P_{i+1-j}+\\frac{m}{m+1}P_{i-j})+\\frac{1}{m+1}P_0 f_{i+1}+1$$\r\n\r\n\u5176\u4e2d\u5f53 $i=n$ \u65f6\uff0c\u7531\u4e8e\u6b64\u65f6\u4e0d\u80fd\u518d\u52a0\u8840\uff0c\u6240\u4ee5\u6b64\u65f6\u7684\u8868\u8fbe\u5f0f\u4e3a\uff1a\r\n\r\n$$f_n=\\sum_{j=1}^{n} P_{n-j} f_j+1$$\r\n\r\n\u8fd9\u91cc\u4e00\u5171\u6709 $n$ \u4e2a\u65b9\u7a0b\u4ee5\u53ca $n$ \u4e2a\u4f4d\u7f6e\u6570\uff0c\u9ad8\u65af\u6d88\u5143\u53ef\u4ee5\u5f97\u51fa\u7b54\u6848\u3002\u7136\u800c\u76f4\u63a5\u6d88\u5143\u7684\u590d\u6742\u5ea6\u4e3a $O(n^3)$\uff0c\u9700\u8981\u8003\u8651\u4f18\u5316\u3002\r\n\r\n\u5217\u51fa\u65b9\u7a0b\u7ec4\uff0c\u5f53 $a_{i,j}=1$ \u65f6\u8868\u793a\u8fd9\u4e00\u9879\u7684\u7cfb\u6570\u4e0d\u4e3a $0$\uff0c\u53cd\u4e4b\u5219\u8868\u793a\u8fd9\u4e00\u9879\u4e0d\u5b58\u5728\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\r\n\r\n$$\\begin{bmatrix}\r\n 1&  1&  0&  0&  0& \\ldots  1&\\\\\r\n  1&  1&  1&  0&  0& \\ldots 1&\\\\\r\n  1&  1&  1&  1&  0& \\ldots 1&\\\\\r\n  \\ldots \\\\\r\n  1&  1&  1&  1&  1& \\ldots 1&\\\\\r\n\\end{bmatrix}$$\r\n\r\n\u53d1\u73b0\u8fd9\u4e2a\u65b9\u7a0b\u7684\u5f62\u5f0f\u5f88\u7279\u6b8a\uff0c\u6bcf\u6b21\u5f80\u4e0b\u6d88\u5143\u7684\u65f6\u5019\u53ea\u9700\u8981\u5e26\u5165\u4e24\u4e2a\u503c\uff0c\u6d88\u53bb\u8fd9\u4e00\u884c\u7b2c\u4e00\u4e2a\u975e\u7a7a\u7684\u7cfb\u6570\uff0c\u6700\u7ec8\u5f97\u5230\u7684\u5f62\u5f0f\u662f\u8fd9\u6837\u7684\uff1a\r\n\r\n$$\\begin{bmatrix}\r\n 1&  1&  0&  0&  0& \\ldots  1&\\\\\r\n  0&  1&  1&  0&  0& \\ldots 1&\\\\\r\n  0&  0&  1&  1&  0& \\ldots 1&\\\\\r\n  \\ldots \\\\\r\n  0&  0&  0&  0&  1& \\ldots 1&\\\\\r\n\\end{bmatrix}$$\r\n\r\n\u6700\u540e\u4e00\u884c\u5c31\u662f $x=A$ \u7684\u5f62\u5f0f\u4e86\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5411\u4e0a\u56de\u5e26\u5c31\u53ef\u4ee5\u89e3\u51fa\u6240\u6709\u7684\u672a\u77e5\u6570\uff0c\u6700\u7ec8\u7684\u590d\u6742\u5ea6\u4e3a $O(n^2)$\u3002\r\n\r\n\u6700\u540e\uff0c\u8fd8\u9700\u8981\u7279\u5224\u4e00\u4e0b $k=0$ \u548c $m=0$ \u7684\u60c5\u51b5\u3002\r\n\r\n## code\uff1a\r\n```\r\n#include<cstdio>\r\n#include<cstring>\r\n#include<algorithm>\r\nusing namespace std;\r\n#define LL long long\r\nconst int N=2023,mod=1e9+7;\r\nint n,p,m,k;LL P[N],a[N][N];//\u521d\u59cbp\u6ef4\u8840\uff0c\u6ee1\u8840n\u6ef4\uff0c1/(m+1)\u6982\u7387\u52a0\u8840\uff0c1/(m+1)\u6982\u7387\u6263\u8840->k\u6b21 \r\nint mul(int a,int b){int res=1;while(b) ((b&1)&&(res=1ll*res*a%mod,0)),a=1ll*a*a%mod,b>>=1;return res;}\r\nvoid Gauss()\r\n{\r\n\tfor(int i=1;i<=n;i++)\r\n    {\r\n    \tLL inv=mul(a[i][i],mod-2);a[i][i]=1;a[i][n+1]=a[i][n+1]*inv%mod;\r\n    \tif(i!=n) a[i][i+1]=a[i][i+1]*inv%mod;\r\n    \tfor(int j=i+1;j<=n;j++)\r\n    \t{\r\n    \t\tLL mult=a[j][i];a[j][i]=0;a[j][i+1]=(a[j][i+1]-mult*a[i][i+1]%mod+mod)%mod;\r\n    \t\ta[j][n+1]=(a[j][n+1]-mult*a[i][n+1]%mod+mod)%mod;\r\n\t\t}\r\n\t}\r\n\tfor(int i=n;i>1;i--) a[i-1][n+1]=(a[i-1][n+1]-a[i-1][i]*a[i][n+1]%mod+mod)%mod,a[i-1][i]=0;\r\n}\r\nvoid solve()\r\n{\r\n\tscanf(\"%d%d%d%d\",&n,&p,&m,&k);\r\n\tif(k==0) return puts(\"-1\"),void();\r\n\tif(m==0)\r\n\t{\r\n\t\tif(k==1) return puts(\"-1\"),void();int res=0;\r\n\t\twhile(p>0){if(p<n) p++;p-=k;res++;} return printf(\"%d\\n\",res),void();\r\n\t}\r\n\tfor(int i=1;i<N;i++) P[i]=0;\r\n\tLL invm=mul(m,mod-2),invm1=mul(m+1,mod-2);P[0]=mul(1ll*m*mul(m+1,mod-2)%mod,k);\r\n\tfor(int i=1;i<=min(n+1,k);i++) P[i]=P[i-1]*invm%mod*mul(i,mod-2)%mod*(k-i+1)%mod;\r\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n+1;j++) a[i][j]=0;\r\n\tfor(int i=1;i<n;i++) for(int j=1;j<=i;j++) a[i][j]=(P[i-j]*m+P[i-j+1])%mod*invm1%mod;\r\n\tfor(int i=1;i<n;i++) a[i][i+1]=P[0]*invm1%mod;\r\n\tfor(int i=1;i<n;i++) a[i][i]=(a[i][i]-1+mod)%mod;\r\n\tfor(int i=1;i<=n;i++) a[i][n+1]=mod-1;\r\n\tfor(int i=1;i<=n;i++) a[n][i]=P[n-i];a[n][n]=(a[n][n]-1+mod)%mod;\r\n\tGauss();printf(\"%lld\\n\",(a[p][n+1]%mod+mod)%mod);\r\n}\r\nint main()\r\n{\r\n//\tfreopen(\"in.txt\",\"r\",stdin);\r\n\tint T;scanf(\"%d\",&T);while(T--) solve();\r\n\treturn 0;\r\n} \r\n```",
        "postTime": 1678710417,
        "uid": 288192,
        "name": "ListenSnow",
        "ccfLevel": 7,
        "title": "P4457 [BJOI2018]\u6cbb\u7597\u4e4b\u96e8"
    },
    {
        "content": "\u5bf9\u4e8e\u8fd9\u79cd\u6982\u7387\u9898\uff0c\u4e00\u4e2a\u5957\u8def\u662f\u76f4\u63a5\u8bbe\u7b54\u6848\u63a8\u5f0f\u5b50\u3002\n\n\u8bbe$f[i]$\u8868\u793a\u82f1\u96c4\u6709i\u6ef4\u8840\u65f6\u671f\u671b\u7684\u751f\u5b58\u56de\u5408\uff0c\u8bbe$p[i]$\u4e3a\u6389i\u6ef4\u8840\u7684\u6982\u7387\uff0c\u53ef\u4ee5\u770b\u51fa$p[i]$\u662f\u548c\u5f53\u524d\u8840\u91cf\u65e0\u5173\u7684\u3002\n$$\nf[i]=1+\\sum_{j=1}^{i}f[i-j]\\times p[j]\\times\\frac{m}{m+1}+f[i-j+1]\\times p[j+1]\\times\\frac{1}{m+1}\n$$\n\u610f\u601d\u662f\u5728\u4e0d\u88ab\u52a0\u8840\u7684\u60c5\u51b5\u4e0b\u6389j\u6ef4\u8840\u548c\u52a0\u8840\u7684\u60c5\u51b5\u4e0b\u6389j+1\u6ef4\u8840\u3002\n\n\u540c\u65f6\uff0cf[i]\u8fd8\u53ef\u4ee5\u5f97\u5230f[i+1]\uff0c\u5373\u5728i<n\u7684\u60c5\u51b5\u4e0b\u52a0\u4e86\u4e00\u6ef4\u8840\u5e76\u4e0d\u53d7\u4f24\uff1a\n$$\nf[i]+=f[i+1]\\times\\frac{p[0]}{m+1}(i<n)\n$$\n\u6211\u4eec\u6765\u770bp\uff1a\n$$\np[i]=C_{k}^{i}\\times(\\frac{1}{m+1})^i\\times(\\frac{m}{m+1})^{k-i}\n$$\n\u628a\u7ec4\u5408\u6570\u5c55\u5f00\uff1a\n$$\np[i]=\\frac{k!}{i!\\times (k-i)!}\\times(\\frac{1}{m+1})^i\\times(\\frac{m}{m+1})^{k-i}\n$$\n\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u5728\u9884\u5904\u7406$\\frac{1}{i!}$\u540en^2\u7b97\uff0c\u4f46\u6709o(n)\u7684\u505a\u6cd5\uff1a\n$$\np[i]=\\frac{k!}{(i-1)!\\times(k-i-1)!}\\times(\\frac{1}{m+1})^{i-1}\\times(\\frac{m}{m+1})^{k-i+1}\\times\\frac{m\\times(m+1)}{m+1}\\times\\frac{k-i+1}{i}\n$$\n\n$$\np[i]=p[i-1]\\times\\frac{1}{m}\\times\\frac{k-i+1}{i}\n$$\n\u521d\u59cb\u5316$p[0]=(\\frac{m}{m+1})^k$\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u524d\u9762f[i]\u7684\u65b9\u7a0b\u5217\u51fa\u4e00\u4e2a\u9ad8\u65af\u6d88\u5143\u7684\u77e9\u9635\uff0c\u5f97\u5230\u4e00\u4e2a$O(n^3)$\u7684\u505a\u6cd5\uff0c\u83b7\u5f9770\u5206\u7684\u597d\u6210\u7ee9\u3002\n\n\u8fd9\u4e2a\u77e9\u9635\u7531\u4e8e\u524d\u9762f[i]\u53ea\u80fd\u4ece\u4e0d\u6bd4\u4ed6\u5927\u7684\u548cf[i+1]\u8f6c\u79fb\u5230\u6240\u4ee5\u662f\u8fd9\u6837\uff1a\n\n| $a[1][1]$ | $a[1][2]$ | 0         | 0         | -1   |\n| --------- | --------- | --------- | --------- | ---- |\n| $a[2][1]$ | $a[2][2]$ | $a[2][3]$ | 0         | -1   |\n| $a[3][1]$ | $a[3][2]$ | $a[3][3]$ | $a[3][4]$ | -1   |\n| $a[4][1]$ | $a[4][2]$ | $a[4][3]$ | $a[4][4]$ | -1   |\n\n\u9664\u4e86\u6700\u540e\u4e00\u884c\u4ee5\u5916\uff0c\u5176\u4ed6\u884c\u5bf9\u89d2\u7ebf\u53f3\u8fb9\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd9\u6837\u6211\u4eec\u5728\u5bf9\u7b2ci\u884c\u6d88\u5143\u7684\u65f6\u5019\u53ef\u4ee5\u53ea\u6d88\u6389\u7b2ci\u5217\uff0c\u6700\u540e\u4e00\u5217\u53ea\u4f1a\u5269\u4e0b\u4e00\u9879\uff0c\u7531\u6b64\u53ef\u4ee5\u89e3\u51fa\u524d\u9762\u6240\u6709\u7684\u7b54\u6848\u3002\n\n```c++\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#define re register\n#define ll long long\n#define mod 1000000007\n#ifdef ONLINE_JUDGE\nchar ss[1<<17],*A=ss,*B=ss;\ninline char gc(){if(A==B){B=(A=ss)+fread(ss,1,1<<17,stdin);if(A==B)return EOF;}return*A++;}\ntemplate<class T>inline void read(T&x){\n    static char c;static int y;\n    for(c=gc(),x=0,y=1;c<48||57<c;c=gc())if(c=='-')y=-1;\n    for(;48<=c&&c<=57;c=gc())x=((x+(x<<2))<<1)+(c^'0');\n    x*=y;\n}\n#else\nvoid read(ll&x){scanf(\"%lld\",&x);}\n#endif\nusing namespace std;\nll dft[1501],a[1501][1501],rec[1501];\nll p[1501],n,u,m,k,t;\ninline ll ksm(ll a,ll b){\n\tll res=1;\n\twhile (b){\n\t\tif (b&1) res=(res*a)%mod;\n\t\ta=a*a%mod; b>>=1;\n\t}\n\treturn res;\n}\ninline ll C(ll a,ll b){\n\tll res=1;\n\tfor (re int i=0; i<a; i++) res=(res*(b-i))%mod;\n\treturn res*dft[a]%mod;\n}\ninline void gauss(){\n\tfor (re int i=1; i<n; i++){\n\t\t// re int bj=i;\n\t\t// for (re int j=i+1; j<=n; j++)\n\t\t// \tif (a[j][i]){bj=j; break;}\n\t\t// for (re int j=i; j<=n+1; j++) swap(a[i][j],a[bj][j]);\n\t\tll inv=ksm(a[i][i],mod-2); a[i][n+1]=(a[i][n+1]*inv)%mod;\n\t\ta[i][i+1]=(a[i][i+1]*inv)%mod; a[i][i]=1;\n\t\tfor (re int j=i+1; j<=n; j++){\n\t\t\ta[j][n+1]=(a[j][n+1]+mod-a[i][n+1]*a[j][i]%mod)%mod;\n\t\t\ta[j][i+1]=(a[j][i+1]+mod-a[i][i+1]*a[j][i]%mod)%mod;\n\t\t\ta[j][i]=0;\n\t\t}\n\t\t// for (re int j=i; j<=n+1; j++) a[i][j]=a[i][j]*inv%mod;\n\t\t// for (re int j=1; j<=n; j++){\n\t\t// \tif (j==i) continue;\n\t\t// \tll r=a[j][i];\n\t\t// \tfor (re int k=i; k<=n+1; k++) a[j][k]=(a[j][k]+mod-a[i][k]*r%mod)%mod;\n\t\t// \ta[j][i]=0;\n\t\t// }\n\t}\n\t// for (re int i=1; i<=n; i++){\n\t// \tfor (re int j=1; j<=n+1; j++) printf(\"%lld \",a[i][j]);\n\t// \tputs(\"\");\n\t// }\n\tll inv=ksm(a[n][n],mod-2); a[n][n+1]=(a[n][n+1]*inv)%mod; a[n][n]=1;\n\tfor (re int i=n-1; i>=u; i--){\n\t\ta[i][n+1]=(a[i][n+1]+mod-a[i+1][n+1]*a[i][i+1]%mod)%mod;\n\t\t// a[i][i+1]=a[i][n+1]*ksm(a[i][i],mod-2)%mod;\n\t\ta[i][i]=1;\n\t}\n}\nint main(){\n\tread(t);\n\tdft[0]=dft[1]=rec[1]=1;\n\tfor (re int i=2; i<=1500; i++) rec[i]=(mod-mod/i)*rec[mod%i]%mod;\n\t// for (re int i=2; i<=1500; i++) dft[i]=dft[i-1]*rec[i]%mod;\n\twhile (t--){\n\t\tread(n),read(u),read(m),read(k);\n\t\tif (!k){puts(\"-1\"); continue;}\n\t\tif (!m&&(k==1)){puts(\"-1\"); continue;}\n\t\tif (!m){\n\t\t\tre int ans=0;\n\t\t\twhile (u>0){\n\t\t\t\tif (u<n) u++;\n\t\t\t\tu-=k; ans++;\n\t\t\t}\n\t\t\tprintf(\"%d\\n\",ans); continue;\n\t\t}\n\t\tll ny=ksm(m+1,mod-2),nym=ksm(m,mod-2);\n\t\tmemset(p,0,sizeof(p));\n\t\tmemset(a,0,sizeof(a));\n\t\tp[0]=ksm(m*ny%mod,k);\n\t\tfor (re int i=1; i<=min(n,k); i++)\n\t\t\tp[i]=p[i-1]*nym%mod*rec[i]%mod*(k-i+1+mod)%mod;\n//\t\tfor (re int i=0; i<=n; i++)\n//\t\t\tp[i]=(C(i,k)*ksm(ny,i)%mod)*ksm(m*ny%mod,k-i)%mod;\n\t\tfor (re int i=1; i<=n-1; i++){\n\t\t\tfor (re int j=0; j<=i-1; j++)\n\t\t\t\ta[i][i-j]=(p[j]*m%mod+p[j+1])%mod*ny%mod;\n\t\t\ta[i][i+1]=p[0]*ny%mod;\n\t\t}\n\t\tfor (re int i=1; i<=n; i++) a[n][i]=p[n-i];\n\t\tfor (re int i=1; i<=n; i++) a[i][i]=(a[i][i]-1+mod)%mod;\n\t\tfor (re int i=1; i<=n; i++) a[i][n+1]=mod-1;\n\t\tgauss();\n\t\tprintf(\"%lld\\n\",a[u][n+1]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1550666877,
        "uid": 63661,
        "name": "Taduro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4457 \u3010[BJOI2018]\u6cbb\u7597\u4e4b\u96e8\u3011"
    },
    {
        "content": "\u7ecf\u5178\u968f\u673a\u6e38\u8d70\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u671f\u671b\u6b65\u6570\u53ea\u548c\u7b2c\u4e00\u4e2a\u4eba\u7684\u8840\u91cf\u6709\u5173\uff0c\u4e8e\u662f\u8bbe $f_x$ \u8868\u793a\u7b2c\u4e00\u4e2a\u4eba\u8840\u91cf\u662f $x$ \u65f6\u7684\u671f\u671b\u6b65\u6570\u3002\n\n\u5219 $f_0=0$\uff0c$f_x(1\\leq x\\leq n)=1+\\sum\\limits_{i=1}^{n}P_{x,i}f_i$\uff0c\u5176\u4e2d $P_{i,j}$ \u8868\u793a\u7b2c\u4e00\u4e2a\u4eba\u8840\u91cf\u662f $i$\uff0c\u7ecf\u8fc7\u4e00\u8f6e\u64cd\u4f5c\u540e\u8840\u91cf\u662f $j$ \u7684\u6982\u7387\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u6211\u4eec\u4e0d\u9700\u8981\u5173\u5fc3 $P_{i,0}$\uff0c\u56e0\u4e3a $f_0=0$\u3002\n\n\u800c\u5f53 $j>i+1$ \u6216 $j<i-k$ \u65f6 $P_{i,j}$ \u4e5f\u662f $0$\u3002\n\n\u7136\u540e\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\u5269\u4e0b\u7684\u60c5\u51b5\uff1a\n\n### $1\\leq i<n$\n\n$$P_{i,j}=[i+1-j\\leq k]\\binom{k}{i+1-j}\\frac{m^{k+j-i-1}}{(m+1)^{k+1}}+[i-j\\leq k \\cap j\\leq i]\\binom{k}{i-j}\\frac{m^{k+j-i+1}}{(m+1)^{k+1}}$$\n\n### $i=n$\n\n$$P_{i,j}=[i-j\\leq k]\\binom{k}{i-j}\\frac{m^{k+j-i}}{(m+1)^k}$$\n\n\u4e8e\u662f\u76f4\u63a5\u6d88\u5143\u5c31\u884c\u4e86\uff0c\u53ef\u662f\u53d1\u73b0 $n$ \u4e0a\u9650\u662f $1500$ \u6240\u4ee5\u8dd1\u4e0d\u4e86 $O(n^3)$ \u7684\u9ad8\u65af\u6d88\u5143\u3002\n\n\u5199\u4e00\u4e0b\u7b2c $i$ \u4e2a\u65b9\u7a0b\uff08$1\\leq i\\leq n$)\uff1a\n$$\\begin{aligned}\\sum\\limits_{i=1}^n(P_{i,j}-[i=j])f_i=-1\\end{aligned}$$\n\n\u4e0d\u59a8\u8bbe\u7b2c $i$ \u4e2a\u65b9\u7a0b\u4e2d $f_j$ \u7684\u7cfb\u6570\u662f $a_{i,j}$\n\n\u6211\u4eec\u6ce8\u610f\u5230\u53ea\u6709\u5f53 $j\\leq i+1$ \u65f6\uff0c$a_{i,j}$ \u624d\u975e\u96f6\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u7cfb\u6570\u77e9\u9635\u4e3b\u5bf9\u89d2\u7ebf\u53f3\u4e0a\u65b9\u53ea\u6709\u7d27\u6328\u7740\u7684\u659c\u7740\u4e00\u6761\u662f\u975e\u96f6\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u7528\u7b2c $n$ \u884c\u6d88\u53bb\u7b2c $n-1$ \u884c\u7684\u7b2c $n$ \u5217\uff0c\u518d\u7528\u7b2c $n-1$ \u884c\u6d88\u53bb\u7b2c $n-2$ \u884c\u7684\u7b2c $n-1$ \u5217\u2026\u2026\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6211\u4eec\u80fd\u5f97\u5230\u4e00\u4e2a\u4e0b\u4e09\u89d2\u77e9\u9635\uff0c\u7136\u540e\u76f4\u63a5\u4ece\u4e0a\u5230\u4e0b\u4ee3\u5165\u6d88\u5143\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(Tn^2)$\uff0c\u53ef\u8fc7\u3002\n\n```cpp\n// Problem: P4457 [BJOI2018]\u6cbb\u7597\u4e4b\u96e8\n// Contest: Luogu\n// URL: https://www.luogu.com.cn/problem/P4457\n// Memory Limit: 500 MB\n// Time Limit: 4000 ms\n\n//One-eye Dingzhen identified as:\n//zxx is God.\n//zxx bless me.\n#include<stdio.h>\nint a[1501][1502],inv[1501],x[1502];\nconst int p=1000000007;\nint sum(int a,int b){return (p-a)>b?a+b:b-(p-a);}\nint dif(int a,int b){return a<b?p-(b-a):a-b;}\nint pro(int a,int b){return (long long)a*b%p;}\nint pow(int a,int b){\n\tint res=1;\n\tfor(;b;b>>=1,a=pro(a,a))if(b&1)res=pro(res,a);\n\treturn res;\n}\nvoid work(){\n\tint n,P,m,k;\n\tscanf(\"%d%d%d%d\",&n,&P,&m,&k);\n\tif(!k)return (void)puts(\"-1\");\n\tif(!m){\n\t\tif(k<2)return (void)puts(\"-1\");\n\t\tfor(int i=1;;++i){\n\t\t\tif(P<n)++P;\n\t\t\tP-=k;\n\t\t\tif(P<=0)return (void)printf(\"%d\\n\",i);\n\t\t}\n\t}\n\tint invt=pow(m+1,p-2-k),invm=pow(m,p-2),mk=pow(m,k);\n\tinv[1]=1;for(int i=2;i<=n;++i)inv[i]=pro(dif(p,p/i),inv[p%i]);\n\tfor(int i=1;i<=n;++i)\n\t\tfor(int j=1;j<=n+1;++j)\n\t\t\ta[i][j]=0;\n\tfor(int i=1;i<=n;++i){\n\t\tif(i<n){\n\t\t\tint c=mk;\n\t\t\tfor(int j=0;j<=k&&j<i;++j){\n\t\t\t\ta[i][i-j]=pro(m,c);\n\t\t\t\tc=pro(c,pro(invm,pro(k-j,inv[j+1])));\n\t\t\t}\n\t\t\tc=mk;\n\t\t\tfor(int j=0;j<=k&&j<=i;++j){\n\t\t\t\ta[i][i+1-j]=sum(a[i][i+1-j],c);\n\t\t\t\tc=pro(c,pro(invm,pro(k-j,inv[j+1])));\n\t\t\t}\n\t\t\tfor(int j=1;j<=n;++j)a[i][j]=pro(a[i][j],invt);\n\t\t}else{\n\t\t\tint c=mk;\n\t\t\tfor(int j=0;j<=k&&j<i;++j){\n\t\t\t\ta[i][i-j]=c;\n\t\t\t\tc=pro(c,pro(invm,pro(k-j,inv[j+1])));\n\t\t\t}\n\t\t\tfor(int j=1;j<=n;++j)a[i][j]=pro(a[i][j],pro(m+1,invt));\n\t\t}\n\t\ta[i][i]=dif(a[i][i],1),a[i][n+1]=dif(a[i][n+1],1);\n\t}\n\tfor(int i=n;i>1;--i){\n\t\tint u=a[i][i],v=a[i-1][i];\n\t\tif(!v)continue;\n\t\tfor(int j=1;j<=n+1;++j)a[i-1][j]=dif(pro(a[i-1][j],u),pro(a[i][j],v));\n\t}\n\tx[1]=pro(pow(a[1][1],p-2),a[1][n+1]);\n\tfor(int i=2;i<=n;++i){\n\t\tx[i]=a[i][n+1];\n\t\tfor(int j=1;j<i;++j)\n\t\t\tx[i]=dif(x[i],pro(a[i][j],x[j]));\n\t\tx[i]=pro(x[i],pow(a[i][i],p-2));\n\t}\n\tprintf(\"%d\\n\",x[P]);\n}\nint main(){\n\tint t;\n\tfor(scanf(\"%d\",&t);t--;work());\n\treturn 0;\n}\n//The moon shines. Thank the moon.\n```",
        "postTime": 1682660131,
        "uid": 203008,
        "name": "toaru",
        "ccfLevel": 5,
        "title": "osxevdlcrz"
    }
]