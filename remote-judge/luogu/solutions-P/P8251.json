[
    {
        "content": "\u8bb0\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u4e3a $P_i$\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4 $[L, R]$ \u6309\u9898\u610f\u6a21\u62df\uff0c\u6211\u4eec\u4f1a\u5148\u628a $P_L$ \u5165\u6808\u3002\u5bf9\u4e8e\u4e0b\u4e00\u4e2a\u6210\u529f\u7684\u4e8c\u5143\u7ec4 $P_i$\uff0c\u5b83\u4f1a\u628a\u6808\u9876\u5143\u7d20\u76f4\u5230 $P_L$ \u90fd\u5f39\u51fa\uff0c\u518d\u628a\u81ea\u5df1\u538b\u8fdb\u53bb\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bcf\u4e00\u4e2a\u4e8c\u5143\u7ec4\u8981\u4e48\u88ab\u4e00\u4e2a\u6210\u529f\u7684\u4e8c\u5143\u7ec4\u5f39\u51fa\u53bb\uff0c\u8981\u4e48\u7559\u5230\u672b\u5c3e\u3002\n\n\u56e0\u6b64\uff0c\u53ef\u4ee5\u8bb0\u5f55\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u80fd\u88ab\u54ea\u4e2a\u4e8c\u5143\u7ec4\u5f39\u51fa\u53bb\u3002\u6309\u9898\u610f\u6a21\u62df\u5373\u53ef\u3002\n\n```cpp\nstruct P { int a, b; };\n// ...\nstatic pair<P, int> s[500005];\nint p = 0;\nfor (int i = 1; i <= n; ++i) {\n\twhile(p && (s[p].first.a == f[i].a || s[p].first.b <= f[i].b)) {\n\t\tnxt[s[p].second] = i; // \u8bb0\u5f55\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u88ab\u8c01\u5f39\u51fa\u53bb\u4e86\n\t\t--p;\n\t}\n\ts[++p] = {f[i], i};\n}\n```\n\n\u6b64\u540e\uff0c\u5bf9\u4e8e\u533a\u95f4 $[L, R]$\uff0c\u9996\u5148\u6210\u529f\u7684\u662f $P_L$\uff0c\u4e4b\u540e\u88ab $nxt[P_L]$ \u5f39\u51fa\u53bb\uff1b $nxt[P_L]$ \u518d\u88ab $nxt[nxt[P_L]]$ \u5f39\u51fa\u53bb\u2026\u2026\u4ee5\u6b64\u7c7b\u63a8\uff0c\u987a\u7740 $nxt$ \u8df3\uff0c\u4e00\u76f4\u8df3\u5230\u5e8f\u5217\u5c3e\u6216\u662f\u533a\u95f4\u5916\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\u65e0\u6cd5\u901a\u8fc7\u3002\n\n\u53ef\u4ee5\u4f7f\u7528\u500d\u589e\u5bf9\u8df3\u7684\u8fc7\u7a0b\u8fdb\u884c\u4f18\u5316\u3002\u8bb0\u5f55 $nxt[i][j]$ \u8868\u793a\u4ece $j$ \u5904\u8df3\u4e86 $2^i$ \u6b64\uff0c\u5219\u53ef\u4ee5\u505a\u5230\u9884\u5904\u7406 $O(n\\log n)$\uff0c\u8be2\u95ee $O(\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate <typename T>\ninline void read(T& s) {\n\tchar c = getchar();\n\tT f = 1; s = 0;\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9') {\n\t\ts = (s << 1) + (s << 3) + (c ^ 48);\n\t\tc = getchar();\n\t}\n\ts *= f;\n}\nconst int N = 500005;\nstruct P{ int a, b; } f[N];\n\nint n,q;\nint nxt[21][N];\n\nint main(){    \n\tread(n); read(q);\n\tfor (int i = 1; i <= n; ++i) read(f[i].a);\n\tfor (int i = 1; i <= n; ++i) read(f[i].b);\n\n\tstatic pair<P, int> s[500005]; int p = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\twhile(p && (s[p].first.a == f[i].a || s[p].first.b <= f[i].b)) {\n\t\t\tnxt[0][s[p].second] = i;\n\t\t\t--p;\n\t\t}\n\t\ts[++p] = {f[i], i};\n\t}\n\n    for (int i = 1; i <= 20; ++i) {\n        for (int j = 1; j <= n; ++j)\n            nxt[i][j] = nxt[i - 1][nxt[i - 1][j]]; // \u5904\u7406\u500d\u589e\n    }\n    \n\twhile (q--){\n\t\tint cnt = 0;\n\t\tint l, r;\n\t\tread(l); read(r);\n        for (int i = 20; i >= 0; --i) {\n            if (nxt[i][l] && nxt[i][l] <= r) { // \u5411\u53f3\u8df3\uff0c\u4f46\u4e0d\u8d8a\u8fc7\u8fb9\u754c\n                cnt += 1 << i; // \u8df3\u4e86 2^i \u6b21\n                l = nxt[i][l];\n            }\n        }\n\t\tprintf(\"%d\\n\", cnt + 1); // \u8981\u7b97\u4e0a L \u672c\u8eab\n\t}\n\treturn 0;\n}\n```\n\n\u4e0d\u9700\u8981\u4efb\u4f55\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\u3002",
        "postTime": 1648274821,
        "uid": 120324,
        "name": "Yansuan_HCl",
        "ccfLevel": 7,
        "title": "P8251 \u4e39\u9493\u6218 \u9898\u89e3"
    },
    {
        "content": "\u8c28\u4ee5\u6b64\u9898\u89e3\uff0c\u7eaa\u5ff5\u6211\u7b2c\u4e00\u6b21 NOIO TG \u524d $25\\%$\u3002\r\n## \u9898\u610f\r\n\u6bcf\u6b21\u5411\u6808\u4e2d\u52a0\u5165\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(a_i,b_i)$\uff0c\u5148\u4e0d\u65ad\u5f39\u51fa\u6808\u9876\u5143\u7d20\u76f4\u81f3\u6808\u7a7a\u6216\u6808\u9876\u5143\u7d20 $(a_j,b_j)$ \u76f4\u5230\u5176\u6ee1\u8db3 $a_i \\neq a_j$ \u4e14 $b_i<b_j$\uff0c\u7136\u540e\u5165\u6808\u3002\u5982\u679c\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5165\u6808\u540e\u6808\u5185\u53ea\u6709\u8fd9\u4e00\u4e2a\u5143\u7d20\uff0c\u5219\u79f0\u8be5\u4e8c\u5143\u7ec4\u662f\u201c\u6210\u529f\u7684\u201d\u3002\r\n\r\n\u5728 $[l,r]$ \u7684\u533a\u95f4\u4e2d\u6bcf\u5bf9\u5143\u7d20\u4f9d\u6b21\u505a\u5982\u4e0a\u64cd\u4f5c\uff0c\u6c42\u6709\u591a\u5c11\u4e2a\u201c\u6210\u529f\u7684\u201d\u4e8c\u5143\u7ec4\u3002\r\n## \u601d\u8def\r\n\u770b\u5230\u8fd9\u9898\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u6253\u4e2a $15$ \u5206\u7684\u66b4\u529b\uff0c\u5728\u6b64\u76f4\u63a5\u7ed9\u51fa\u4ee3\u7801\uff1a\r\n```cpp\r\n#include<iostream>\r\n#include<cstdio>\r\n#include<stack>\r\nusing namespace std;\r\n#define int long long\r\npair<int,int> a[500010];\r\n#define fi first\r\n#define se second\r\nsigned main(){\r\n    //freopen(\"stack.in\",\"r\",stdin);\r\n    //freopen(\"stack.out\",\"w\",stdout);\r\n    int n,q;\r\n    cin>>n>>q;\r\n    for(int i=1;i<=n;i++) cin>>a[i].fi;\r\n    for(int i=1;i<=n;i++) cin>>a[i].se;\r\n    while(q--){\r\n        stack<int> s,s1;\r\n        int x,y,ans=0;\r\n        cin>>x>>y;\r\n        for(int i=x;i<=y;i++){\r\n            int tmp=a[i].fi,temp=a[i].se;\r\n            if(s.empty()){\r\n                s.push(tmp);\r\n                s1.push(temp);\r\n                ans++;\r\n            }\r\n            else{\r\n                be:;\r\n                if(s.empty()){\r\n                    s.push(tmp);\r\n                    s1.push(temp);\r\n                    ans++;\r\n                    continue;\r\n                }\r\n                int xx=s.top(),yy=s1.top();\r\n                if(xx!=tmp&&yy>temp){\r\n                    s.push(tmp);\r\n                    s1.push(temp);\r\n                    if(s.size()==1) ans++;\r\n                }\r\n                else{\r\n                    s.pop();\r\n                    s1.pop();\r\n                    goto be;\r\n                }\r\n            }\r\n        }\r\n        cout<<ans<<endl;\r\n    }\r\n}\r\n```\r\n\u63a5\u4e0b\u6765\u8bb2\u6b63\u89e3\uff1a\r\n\r\n\u6211\u4f7f\u7528\u7684\u7b97\u6cd5\u662f\u5f52\u5e76\u6811\uff0c\u5176\u5b9e\u5c31\u662f\u5f52\u5e76\u6392\u5e8f\u548c\u7ebf\u6bb5\u6811\u7684\u7ed3\u5408\u4f53\uff0c\u5229\u7528\u7ebf\u6bb5\u6811\u8bb0\u5f55\u5f52\u5e76\u6392\u5e8f\u7684\u6b65\u9aa4\u3002\r\n\r\n\u5b83\u53ef\u4ee5\u7528\u4e8e\u8ba1\u7b97\u67d0\u533a\u95f4\u4e2d\u6bd4\u67d0\u4e2a\u6570\u5c0f\u6216\u5927\u7684\u6570\u6709\u591a\u5c11\u4e2a\uff0c\u6b63\u597d\u9002\u7528\u672c\u9898\u3002\u5efa\u6811\u65f6\u9012\u5f52\u6784\u9020\u5b50\u8282\u70b9\uff0c\u56de\u6eaf\u65f6\u6784\u9020\u7236\u8282\u70b9\u3002\r\n\r\n\u5b66\u4e60\u5f52\u5e76\u6811\u53ef\u4ee5\u770b\u6b64\u7bc7\u6587\u7ae0\uff1a<https://www.cnblogs.com/bennettz/p/8342242.html>\r\n\r\n\u4e3a\u4ec0\u4e48\u672c\u9898\u53ef\u4ee5\u8f6c\u5316\u6210\u6c42\u89e3\u67d0\u533a\u95f4\u6bd4\u67d0\u6570\u5c0f\u7684\u6570\u7684\u6570\u91cf\u5462\uff1f\r\n\r\n\u8fd9\u6837\u60f3\uff1a\u6bcf\u4e2a\u5143\u7d20\u53ef\u4ee5\u5f39\u51fa\u4ed6\u524d\u9762\u7684\u82e5\u5e72\u5143\u7d20\uff0c\u6211\u4eec\u8ba1\u4ed6\u53ef\u4ee5\u5f39\u51fa\u81f3 $a[i]$ \u53f7\u5143\u7d20\u3002\u5982\u679c\u6c42\u89e3\u4e00\u4e2a\u533a\u95f4 $[l,r]$\uff0c\u90a3\u4e48\u5982\u679c\u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u67d0\u4e2a\u5143\u7d20 $a[i]$ \u53ef\u4ee5\u5f39\u51fa\u81f3 $l$ \u4ee5\u4e0b\uff0c\u5c31\u80af\u5b9a\u53ef\u4ee5\u628a\u6808\u5f39\u7a7a\uff0c\u6240\u4ee5\u672c\u9898\u5c31\u8f6c\u5316\u4e3a\u6c42\u89e3\u533a\u95f4 $<l$ \u7684\u6570\u7684\u6570\u91cf\u4e86\u3002\r\n\r\n\u5728\u7a0b\u5e8f\u6700\u5f00\u59cb\u5148\u6a21\u62df\u4e00\u4e0b\u9898\u76ee\u6240\u8bf4\u7684\u64cd\u4f5c\uff0c\u7528\u6808\u8bb0\u5f55\u4e0b\u6765\uff0c\u7136\u540e\u76f4\u63a5\u5957\u6a21\u677f\u6c42\u89e3\u67d0\u533a\u95f4\u6bd4\u67d0\u6570\u5c0f\u7684\u6570\u7684\u6570\u91cf\u5373\u53ef\u3002\r\n\r\n\u6700\u5f00\u59cb\u8bfb\u5165\u7684\u6570\u636e\u53ef\u4ee5\u7528\u4e00\u4e2a `pair` \u8bb0\u5f55\u4e0b\u6765\uff0c\u6ce8\u610f\u7ec6\u8282\uff0c\u521a\u5f00\u59cb\u51c6\u5907\u7684 `stack` \u5148\u5c06\u4e00\u5bf9 `0,0` \u5165\u6808\u4ee5\u9632\u51fa\u9519\u3002\r\n\r\n\u672c\u4ee3\u7801\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u4e3a $O(n \\ \\log^2 \\ n)$\u3002\r\n## \u4ee3\u7801\r\n```cpp\r\n/* / / / / / / / / /\r\nwritten by Jerrlee\r\n\r\n\u7b97\u6cd5\u4f7f\u7528\uff1a\u5f52\u5e76\u6811\r\n/ / / / / / / / / */\r\n#include<iostream>\r\n#include<cstdio>\r\n#include<stack>\r\nusing namespace std;\r\n#define int long long\r\n#define fi first\r\n#define se second\r\npair<int,int> a[500010];\r\nint c[500010],f[50][500010];\r\nvoid Build(int de,int l,int r){\r\n\tif(l==r){\r\n\t\tf[de][l]=c[l];\r\n\t\treturn;\r\n\t}\r\n\tint mid=(l+r)>>1;\r\n\tBuild(de+1,l,mid);\r\n    Build(de+1,mid+1,r);\r\n    for(int i=l,j=mid+1,k=l;i<=mid||j<=r;){\r\n        if(j>r) f[de][k++]=f[de+1][i++];\r\n        else if(i>mid||f[de+1][i]>f[de+1][j]) f[de][k++]=f[de+1][j++];\r\n        else f[de][k++]=f[de+1][i++];\r\n    }\r\n}//\u5efa\u6811\r\nint calc(int de,int L,int R,int l,int r,int x){\r\n    if(L>=l&&R<=r) return lower_bound(f[de]+L,f[de]+R+1,x)-f[de]-L;\r\n    int mid=(L+R)>>1,ans=0;\r\n    if(mid>=l) ans+=calc(de+1,L,mid,l,r,x);\r\n    if(mid<r) ans+=calc(de+1,mid+1,R,l,r,x);\r\n    return ans;\r\n}//\u6a21\u677f\u90e8\u5206\r\nsigned main(){\r\n    //freopen(\"stack.in\",\"r\",stdin);\r\n    //freopen(\"stack.out\",\"w\",stdout);\r\n\tint n,q;\r\n\tcin>>n>>q;\r\n    for(int i=1;i<=n;i++) cin>>a[i].fi;\r\n    for(int i=1;i<=n;i++) cin>>a[i].se;\r\n\tstack<pair<int,int> > s,s1;\r\n\ts.push({0,0});\r\n    s1.push({0,0});\r\n\tfor(int i=1;i<=n;i++){\r\n        be:\r\n\t\tc[i]=s.top().fi;\r\n\t\tif(s.size()>1&&!(s.top().se!=a[i].fi&&s1.top().se>a[i].se)){\r\n            s.pop();\r\n            s1.pop();\r\n            goto be;\r\n        }\r\n\t\ts.push({i,a[i].fi});\r\n        s1.push({i,a[i].se});\r\n\t}//\u6a21\u62df\r\n\tBuild(1,1,n);\r\n\twhile(q--){\r\n\t\tint x,y;\r\n\t\tcin>>x>>y;\r\n\t\tcout<<calc(1,1,n,x,y,x)<<endl;//\u6c42\u51fa x-y \u533a\u95f4\u5185\u6570\u5b57\u5c0f\u4e8e x \u7684\u6570\u91cf \r\n\t}\r\n}\r\n```\r\n\u6ce8\uff1a\u6b64\u4ee3\u7801\u5728\u6d1b\u8c37\u53ea\u6709 $50$ \u5206\uff0c\u9700\u8981\u52a0\u5feb\u8bfb\uff08\u4f46\u662f\u6211\u6d4b\u5b8c CCF \u7684\u5b98\u65b9\u6570\u636e\u662f $100$\uff09\u3002\r\n\r\n\u5feb\u8bfb\u7248\uff1a<https://www.luogu.com.cn/paste/1c5p7sdz>\r\n\r\n[AC \u8bb0\u5f55](https://www.luogu.com.cn/record/72805036)",
        "postTime": 1648781431,
        "uid": 367652,
        "name": "Jerrlee\u2705",
        "ccfLevel": 5,
        "title": "P8251 \u9898\u89e3"
    },
    {
        "content": "## Preface\n\n\u8fd9\u4e0d\u662f\u500d\u589e\u5417\uff1f\u4e3a\u4ec0\u4e48\u8981 \u4e3b\u5e2d\u6811/BIT \u5462\uff1f\n\n## Analysis\n\n\u4ee4 $dp_{i,j}$ \u8868\u793a\u4ece $i$ \u5f00\u59cb\u5165\u6808\uff0c\u7b2c $2^j$ \u4e2a \u6210\u529f\u7684 \u4e8c\u5143\u7ec4\u7684\u7f16\u53f7\u3002\n\n\u901a\u8fc7\u4e00\u904d\u5bf9\u9898\u610f\u5f97\u6a21\u62df\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa\u5bf9\u4e8e\u6240\u6709\u7684 $i$ \u7684 $dp_{i,0}$\u3002\u5373\u5f53 $i$ \u628a $j$ \u5f39\u51fa\u65f6\uff0c\u8bb0\u5f55 $dp_{j,0}=i$\u3002\n\n\u63a5\u7740\uff0c\u9884\u5904\u7406\u500d\u589e\u6570\u7ec4\uff0c\u5728 $O(n\\log n)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u6240\u6709\u7684 $dp_{i,j}$\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u679a\u4e3e $i$ \u4ece $\\log n$ \u5230 $0$\uff0c\u770b\u5f53\u524d\u4f4d\u5f80\u540e $2^i$ \u4e2a \u6210\u529f\u7684 \u4e8c\u5143\u7ec4\u7684\u7f16\u53f7\u662f\u5426\u8fd8\u5728 $[l,r]$ \u533a\u95f4\u5185\uff08\u7c7b\u4f3c\u500d\u589e\u6c42 LCA\uff09\u3002\u5355\u6b21\u8be2\u95ee\u65f6\u95f4\u590d\u6742\u5ea6 $q\\log n$\u3002\n\n\u6700\u7ec8\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n+q\\log n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n## Code\n\n**Talk is cheap, show me the code.**\n\n\u5949\u4e0a\u6781\u7b80\u4ee3\u7801\u3002\n\n```cpp\n// And in that light, I find deliverance.\n#define int long long\nint n,q,a[500010],b[500010],dp[500010][25];\nint st[500010],top=0;\nsigned main(){\n\tread(n,q);\n\tFor(i,1,n) read(a[i]);\n\tFor(i,1,n) read(b[i]);\n\tFor(i,1,n+1) dp[i][0]=n+1;\n\tFor(i,1,n){\n\t\twhile(top!=0&&(a[i]==a[st[top]]||b[i]>=b[st[top]])) dp[st[top]][0]=i,top--;\n\t\tst[++top]=i;\n\t}\n\tFor(j,1,20) For(i,1,n+1) dp[i][j]=dp[dp[i][j-1]][j-1];\n\twhile(q--){\n\t\tint l,r;\n\t\tread(l,r);\n\t\tint res=0,pos=l;\n\t\tRof(i,20,0) if(dp[pos][i]<=r) pos=dp[pos][i],res+=(1<<i);\n\t\twrite(res+1,'\\n');\n\t}\n}\n```",
        "postTime": 1648273984,
        "uid": 169574,
        "name": "Enucai",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P8251 \u3010[NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\u3011"
    },
    {
        "content": "- [\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P8251)\n\n---\n\n### \u601d\u8def\u5206\u6790\n\n- \u65e2\u7136\u9898\u76ee\u53eb\u505a\u4e39\u9493\u6218\uff0c\u5f53\u7136\u662f\u7528 ~~\u5355\u8c03\u6808\uff08\u8c10\u97f3\u6897\uff0c\u6263\u94b1\uff01\uff09~~ **\u6811\u72b6\u6570\u7ec4**\u505a\u3002\n\n---\n\n### \u5177\u4f53\u505a\u6cd5\n\n\u5bf9\u4e8e\u6bcf\u7ec4\u6570\u636e\uff1a\n\n1. \u8bfb\u5165\uff0c\u5c06\u8be2\u95ee\u5b58\u5165\u6570\u7ec4\u5e76\u8bb0\u5f55\u8be2\u95ee\u7f16\u53f7\uff1b\n\n2. \u5bf9\u8be2\u95ee\u6309\u53f3\u7aef\u70b9\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff1a\n\n3. \u5c06 $n$ \u4e2a\u4e8c\u5143\u7ec4\u7684\u7f16\u53f7\u4f9d\u6b21\u52a0\u5165\u9898\u76ee\u6240\u8ff0\u7684\u5355\u8c03\u6808\uff0c\u8bb0\u52a0\u5165\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u65f6\u6808\u9876\u5143\u7d20\u4e3a $t_i$ \uff0c\u5219\u5f53\u5de6\u7aef\u70b9\u5728\u533a\u95f4 $[t_i+1,i]$ \u4e2d\u4e14\u53f3\u7aef\u70b9\u4e0d\u5c0f\u4e8e $i$ \u65f6\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u5bf9\u7b54\u6848\u6709\u8d21\u732e\uff08\u8bf7\u81ea\u884c\u601d\u8003\u539f\u56e0\uff09\uff0c\u6240\u4ee5\u5bf9\u533a\u95f4 $[t_i+1,i]$ \u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u52a0 $1$\u3002\u5f53\u53f3\u7aef\u70b9\u4e3a $i$ \u65f6\uff0c\u8be2\u95ee\u7684\u7b54\u6848\u5373\u4e3a\u5f53\u524d\u5de6\u7aef\u70b9\u5bf9\u5e94\u7684\u503c\u3002\u533a\u95f4\u4fee\u6539\u5355\u70b9\u67e5\u8be2\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff1b\n\n---\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n\n**AC \u4ee3\u7801**\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nstruct node\n{\n\tint l,r,id;\n\tbool operator < (const node &x)const\n\t{\n\t\treturn this->r<x.r;\n\t}\n}Q[500005];\nint a[500005],b[500005],c[500005],ans[500005],n;\nstack<int> stk;\nint read()\n{\n\tint x=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9')ch=getchar();\n\twhile('0'<=ch&&ch<='9')x=(x<<1)+(x<<3)+ch-'0',ch=getchar();\n\treturn x;\n}\nvoid write(int x,int flag)\n{\n\tif(!x)\n\t{\n\t\tif(flag)putchar('0');\n\t\treturn;\n\t}\n\twrite(x/10,false);\n\tputchar(x%10+'0');\n\treturn;\n}\nint lowbit(int x)\n{\n\treturn x&(-x);\n}\nvoid add(int x,int v)\n{\n\tfor(int i=x;i<=n;i+=lowbit(i))c[i]+=v;\n\treturn;\n}\nint sum(int x)\n{\n\tint res=0;\n\tfor(int i=x;i;i-=lowbit(i))res+=c[i];\n\treturn res;\n}\nint main()\n{\n//\tfreopen(\"stack.in\",\"r\",stdin);\n//\tfreopen(\"stack.out\",\"w\",stdout);\n\tint q,pos=1;\n\tn=read();q=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<=n;i++)b[i]=read();\n\tfor(int i=1;i<=q;i++)Q[i].l=read(),Q[i].r=read(),Q[i].id=i;\n\tsort(Q+1,Q+q+1);\n\ta[0]=b[0]=INT_MAX;\n\tstk.push(0);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(true)\n\t\t{\n\t\t\tint j=stk.top();\n\t\t\tif(a[i]!=a[j]&&b[i]<b[j])break;\n\t\t\tstk.pop();\n\t\t}\n\t\tadd(stk.top()+1,1),add(i+1,-1);\n\t\tstk.push(i);\n\t\twhile(Q[pos].r==i)ans[Q[pos].id]=sum(Q[pos].l),pos++;\n\t}\n\tfor(int i=1;i<=q;i++)write(ans[i],true),putchar('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1648271677,
        "uid": 380019,
        "name": "xieyikai2333",
        "ccfLevel": 6,
        "title": "\u4e39\u9493\u6218"
    },
    {
        "content": "[\u60ca\u9669\u7684\u63d0\u4ea4\u8bb0\u5f55](https://www.luogu.com.cn/record/72363685)\u3002\n\u5361\u5230\u4e86 $993$ \u6beb\u79d2\u3002\u3002\u3002\n\n## \u8fdb\u5165\u6b63\u9898\n\n\u5148\u770b\u9898\u76ee\uff0c\u7ecf\u5178\u9759\u6001\u67e5\u8be2\u95ee\u9898\uff0c\u7528\u666e\u901a\u83ab\u961f\u5c31\u884c\u5566\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e $i$ \u8bb0\u5f55\u4e00\u4e2a\u503c $pre_i$\uff0c\u8868\u793a\u8fd9\u4e2a\u4e8c\u5143\u7ec4 $(a_i,b_i)$ \u5728 $pre_i + 1$ \u5230 $i$ \u7684\u4f4d\u7f6e\u662f\u6210\u529f\u7684\u3002\u8fd9\u4e2a\u53ef\u4ee5\u4e00\u5f00\u59cb\u7528\u5355\u8c03\u6808\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u7136\u540e\u5c31\u662f\u83ab\u961f\u7684\u4e8b\u60c5\u4e86\uff0c\u6211\u4eec\u8981\u627e\u7684\u76f8\u5f53\u4e8e\u5c31\u662f $p_l$ \u5230 $p_r$ \u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u662f\u6bd4 $l$ \u5c0f\u7684\u3002\u6240\u4ee5\u5728\u8f6c\u79fb\u8fc7\u7a0b\u4e2d\u8bb0\u5f55\u4e00\u4e0b\u63d2\u5165\u548c\u5220\u9664\u7684\u4f4d\u7f6e\u7684\u6570\u91cf\u5c31\u884c\u4e86\u3002\n\n\u6700\u540e\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u628a\u503c\u57df\u5206\u5757\u5373\u53ef\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u590d\u6742\u5ea6\u662f $O(n \\times \\sqrt n)$ \u7684\u3002\n\n\u6700\u540e\u83ab\u961f\u6392\u5e8f\u7684\u65f6\u5019\u8bb0\u5f97\u7528\u5947\u5076\u7384\u5b66\u4f18\u5316\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nint read() {\n\tint s = 0, f = 1;\n\tchar ch = getchar();\n\twhile (ch < '0' || ch > '9')\n\t\t(ch == '-' ? -1 : 1), ch = getchar();\n\twhile (ch >= '0' && ch <= '9')\n\t\ts = (s << 1) + (s << 3) + (ch ^ 48), ch = getchar();\n\treturn s * f;\n}\n\nint n, Q;\nint a[500005], b[500005], p[500005];\nint s[500005], top = 0;\nint bl[500005];\nstruct qry{\n\tint l, r, id;\n\tfriend bool operator < (const qry &x, const qry &y) {\n\t\tif (bl[x.l] != bl[y.l])\n\t\t\treturn bl[x.l] < bl[y.l];\n\t\tif (bl[x.l] % 2 == 0)\n\t\t\treturn x.r > y.r;\n\t\treturn x.r < y.r;\n\t}\n}q[500005];\nint ans[500005], c[500005];\nint head = 1, tail = 0;\n\nint l[1005], r[1005], sum[1005], pos[500005];\n\nvoid buildblock(){\n\tint k = sqrt(n);\n\tfor (int i = 1; i <= k; i++)\n\t\tl[i] = r[i - 1] + 1, r[i] = r[i - 1] + k;\n\tif (r[k] < n)\n\t\tl[k + 1] = r[k] + 1, r[k + 1] = n, k++;\n\tfor (int i = 1; i <= k; i++)\n\t\tfor (int j = l[i]; j <= r[i]; j++)\n\t\t\tpos[j] = i;\n}\n\nint query(int p){\n\tint P = 0, ans = 0;\n\tfor (int i = 1; i < pos[p]; i++)\n\t\tans += sum[i];\n\tfor (int i = l[pos[p]]; i <= p; i++)\n\t\tans += c[i];\n\treturn ans;\n}\n\nvoid mdf(int x, int v){\n\tc[p[x]] += v;\n\tsum[pos[p[x]]] += v;\n}\n\nsigned main() {\n\tn = read(), Q = read();\n\tfor (int i = 1; i <= n; i++)\n\t\ta[i] = read();\n\tfor (int i = 1; i <= n; i++)\n\t\tb[i] = read();\n\tfor (int i = 1; i <= n; i++){\n\t\twhile (top > 0 && !(a[i] != a[s[top]] && b[i] < b[s[top]]))\n\t\t\ttop--;\n\t\tp[i] = s[top] + 1;\n\t\ts[++top] = i;\n\t}\n\tbuildblock();\n\tint t = sqrt(n);\n\tfor (int i = 1; i <= n; i++)\n\t\tbl[i] = (i - 1) / t + 1;\n\tfor (int i = 1; i <= Q; i++)\n\t\tq[i].l = read(), q[i].r = read(), q[i].id = i;\n\tsort(q + 1, q + Q + 1);\n\tfor (int i = 1; i <= Q; i++){\n\t\twhile (tail < q[i].r)\n\t\t\tmdf(++tail, 1);\n\t\twhile (tail > q[i].r)\n\t\t\tmdf(tail--, -1);\n\t\twhile (head < q[i].l)\n\t\t\tmdf(head++, -1);\n\t\twhile (head > q[i].l)\n\t\t\tmdf(--head, 1);\n\t\tans[q[i].id] = query(q[i].l);\n\t}\n\tfor (int i = 1; i <= Q; i++)\n\t\tprintf(\"%d\\n\", ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1648273758,
        "uid": 483037,
        "name": "Galex",
        "ccfLevel": 6,
        "title": "P8251-\u9898\u89e3"
    },
    {
        "content": "~~\u5355\u8c03\u6808\uff1f\u5403\u6843\u5427\u4f60\u83ab\u961fyyds~~\n\n\u867d\u7136\u9898\u9762\u4e0a\u5df2\u7ecf\u63d0\u9192\u6211\u4eec\u8981\u7528\u5355\u8c03\u6808\u4e86\u3002\n\n\u4f46\u662f\u6211\u4eec\u8981\u6709~~\u53db\u9006~~\u521b\u65b0\u601d\u7ef4\u3002\n\n~~\u9996\u5148\u89c2\u5bdf\u5230 $1 \\leq n, q \\leq 5 \\times 10^5$\uff0c\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u8bf4\u660e\u51fa\u9898\u4eba\u4e0d\u4ec5\u63d0\u793a\u6211\u4eec\u53ef\u4ee5\u7528\u5355\u8c03\u6808\uff0c\u8fd8\u53ef\u4ee5\u7528\u83ab\u961f\u505a~~\n\n\u77e5\u9053\u51fa\u9898\u4eba\u7ed9\u6211\u4eec\u7684\u63d0\u793a\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u83ab\u961f\u4e86\u3002\n\n\u9996\u5148\u6211\u4eec\u9884\u5904\u7406\u4e00\u4e2a fa \u6570\u7ec4\uff0c\u7136\u540e\u8fd9\u4e2a fa \u6570\u7ec4\u662f\u5e72\u4ec0\u4e48\u7528\u7684\u5462\uff0c\u662f\u7528\u6765\u8bb0\u5f55**\u5047\u5982\u4ece\u7b2c1\u4e2a\u5f00\u59cb\u653e\uff0c\u90a3\u4e48\u5f53\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u5165\u6808\u524d\u6808\u9876\u7684\u4e0b\u6807\u3002**\n\n\u5b9e\u73b0\u4e5f\u80a5\u80a0\u7b80\u5355\uff1a\n\n```cpp\n\tk=i-1;\n\twhile(k&&((a[k]==a[i])||((a[k]^a[i])&&b[k]<=b[i])))\n\t\tk=fa[k];\n\tfa[i]=k;\n```\n\n\u5b9e\u9645\u4e0a\u539f\u7406\u5c31\u662f\u6a21\u62df\u4e00\u4e0b\u6808\u7684\u60c5\u51b5\uff0c\u968f\u4fbf\u624b\u63a8\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u53e6\u5916\u5bf9\u4e8e\u6bcf\u4e2a\u4e0b\u6807 $i$ \u6211\u4eec\u90fd\u5f00\u4e00\u4e2a vector cnt \u8bb0\u5f55\u6240\u6709\u5c06 $i$ \u4f5c\u4e3a fa \u7684\u4f4d\u7f6e\uff1a\n\n```cpp\n    cnt[i].emplace_back(-0x7ffffff);//\u5148\u538b\u4e00\u4e2a\u65b9\u4fbf\u4e8c\u5206\n    cnt[k].emplace_back(i);\n```\n\n\u6613\u77e5\u9884\u5904\u7406\u662f $O(n)$ \u7684\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u83ab\u961f\u73af\u8282\u4e86\u3002\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u53f3\u6307\u9488\u7684\u79fb\u52a8\uff0c\u6bd4\u8f83\u7b80\u5355\uff1a\n\n\u53f3\u7aef\u7684\u79fb\u52a8\u8868\u793a\u628a\u4e00\u4e2a\u65b0\u7684\u6570\u538b\u8fdb\u6808\u5185\u3002\n\n\u53f3\u79fb\uff08\u538b\u6808\uff09\uff1a\n\n```cpp\n\twhile(q[i].r>r)\n\t\tans+=(fa[++r]<l?1:0);\n```\n\n\u5047\u5982\u963b\u6321\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u5230\u8fbe\u6808\u5e95\u7684\u4e8c\u5143\u7ec4\u4e0d\u5728\u5f53\u524d\u7684\u8be2\u95ee\u533a\u95f4\uff08\u6ca1\u6709\u5165\u6808\uff09\u90a3\u4e48\u81ea\u7136\u8fd9\u4e2a\u6570\u53ef\u4ee5\u4e00\u901a\u5230\u5e95\uff1b\n\n\u5de6\u79fb\uff08\u5f39\u6808\uff09\uff1a\n\n```cpp\n\twhile(q[i].r<r)\n\t\tans-=(fa[r--]<l?1:0);\n```\n\n\u540c\u7406\u5047\u5982\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u505a\u51fa\u4e86\u8d21\u732e\u5c31\u8981\u51cf\u6389\u3002\n\n\u7136\u540e\u6765\u8003\u8651\u5de6\u6307\u9488\u3002\n\n\u5de6\u6307\u9488\u79fb\u52a8\u6709\u4e00\u70b9\u9ebb\u70e6\uff0c\u56e0\u4e3a\u4e0d\u7ba1\u662f\u5728\u64cd\u4f5c\u5e8f\u5217\u6700\u524d\u7aef\u52a0\u5165\u6216\u8005\u5220\u9664\u90fd\u6709\u53ef\u80fd\u5f71\u54cd\u64cd\u4f5c\u5e8f\u5217\u540e\u7aef\u7684\u4e8c\u5143\u7ec4\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u4e4b\u524d\u9884\u5904\u7406\u7684 cnt \u5c31\u6709\u7528\u4e86\uff1a\n\n\u5de6\u79fb\uff08\u52a0\u5165\uff09\uff1a\n\n```cpp\n\twhile(q[i].l<l)\n\t{\n\t\tl--,ans++;\n\t\tvector<int>::iterator t1=upper_bound(cnt[l].begin(),cnt[l].end(),l);\n\t\tvector<int>::iterator t2=upper_bound(cnt[l].begin(),cnt[l].end(),r)-1;\n\t\tif(t1!=cnt[l].end()&&t2!=cnt[l].begin())\n\t\tans-=(t2-t1+1);\n\t}\n```\n\n\u4e8c\u5206\u627e\u5230\u5728\u533a\u95f4 $[l,r]$ \u5185\u4ee5 $i$ \u4e3a fa \u7684\u4e8c\u5143\u7ec4\u3002\n\n\u7531\u4e8e\u5047\u5982 $i$ \u6ca1\u6709\u52a0\u5165\uff0c\u90a3\u4e48\u8fd9\u4e9b\u4e8c\u5143\u7ec4\u53ef\u4ee5\u4e3a\u7b54\u6848\u505a\u51fa\u8d21\u732e\uff0c\u73b0\u5728\u52a0\u5165\u4e86\uff0c\u5c31\u8981\u51cf\u6389\u3002\n\n\u53e6\u5916\u7531\u4e8e $i$ \u6210\u4e3a\u4e86\u7b2c\u4e00\u4e2a\u5165\u6808\u7684\uff0c\u6240\u4ee5 $i$ \u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\uff0c\u6240\u4ee5 ```ans++``` \u3002\n\n\u540c\u7406\u53ef\u5f97\u53f3\u79fb\uff08\u5220\u9664\uff09\uff1a\n\n```cpp\n\twhile(q[i].l>l)\n\t{\n\t\tvector<int>::iterator t1=upper_bound(cnt[l].begin(),cnt[l].end(),l);\n\t\tvector<int>::iterator t2=upper_bound(cnt[l].begin(),cnt[l].end(),r)-1;\n\t\tif(t1!=cnt[l].end()&&t2!=cnt[l].begin())\n\t\t\tans+=(t2-t1+1);\n\t\tl++,ans--;\n\t}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $n\\sqrt {nlogn}$ \uff0c\u5e94\u8be5\u8fd8\u6709\u66f4\u7d27\u7684\u4e0a\u754c\uff0c\u4f46\u662f\u6211\u61d2\u5f97\u7b97\u4e86\uff08\n\n~~\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8fd9\u4e1c\u897f\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8fc7\uff0c\u603b\u4e4b\u5404\u79cd\u7384\u5b66\u5361\u5e38\u5c31\u8fc7\u4e86~~\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define Maxn 500100\nusing namespace std;\nnamespace DEBUG {\n\tinline void cerr_out(){cerr<<'\\n';}\n\ttemplate<typename Head,typename... Tail>\n\tinline void cerr_out(Head H,Tail... T){cerr<<' '<<H,cerr_out(T...);}\n\tvoid debug_out() { cerr << '\\n'; }\n\ttemplate <typename Head, typename... Tail>\n\tvoid debug_out(Head H, Tail... T) { cerr << ' ' << H, debug_out(T...); }\n#define debug(...) cerr << '[' << #__VA_ARGS__ << \"]:\", debug_out(__VA_ARGS__)\n} using namespace DEBUG;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int> pii;\n#define getchar() (S==T&&(T=(S=B)+fread(B,1,1<<15,stdin),S==T)?EOF:*S++)\nnamespace get_out\n{\n\tchar B[1<<20],*S=B,*T=B;\n\tchar op;\n\tinline void read_(int &x)\n\t{\n\t\tx=0;\n\t\tint fi(1);\n\t\top=getchar();\n\t\twhile((op<'0'||op>'9')&&op!='-') op=getchar();\n\t\tif(op=='-') op=getchar(),fi=-1;\n\t\twhile(op>='0'&&op<='9') x=(x<<1)+(x<<3)+(op^48),op=getchar();\n\t\tx*=fi;\n\t\treturn;\n\t}\n\tinline void read_(long long &x)\n\t{\n\t\tx=0;\n\t\tint fi(1);\n\t\top=getchar();\n\t\twhile((op<'0'||op>'9')&&op!='-') op=getchar();\n\t\tif(op=='-') op=getchar(),fi=-1;\n\t\twhile(op>='0'&&op<='9') x=(x<<1)+(x<<3)+(op^48),op=getchar();\n\t\tx*=fi;\n\t\treturn;\n\t}\n\tinline void read_(double &x)\n\t{\n\t\tx=0.0;\n\t\tfloat fi(1.0),sm(0.0);\n\t\top=getchar();\n\t\twhile((op<'0'||op>'9')&&op!='-') op=getchar();\n\t\tif(op=='-') op=getchar(),fi=-1.0;\n\t\twhile(op>='0'&&op<='9') x=(x*10.0)+(op^48),op=getchar();\n\t\tif(op=='.') op=getchar();\n\t\tint rtim=0;\n\t\twhile(op>='0'&&op<='9') sm=(sm*10.0)+(op^48),++rtim,op=getchar();\n\t\twhile(rtim--) sm/=10.0;\n\t\tx+=sm,x*=fi;\n\t\treturn;\n\t}\n\tinline void read_(string &s)\n\t{\n\t\tchar c(getchar());\n\t\ts=\"\";\n\t\twhile(!isgraph(c)&&c!=EOF) c=getchar();\n\t\tfor(;isgraph(c);c=getchar()) s+=c;\n\t}\n\tinline void read_(char &c)\n\t{\n\t\tfor(c=op;c==' '||c=='\\n'||c=='\\r'||c=='\\t';c=getchar());\n\t\top=c;\n\t}\n\t\n\ttemplate<typename Head,typename ...Tail>\n\tinline void read_(Head& h,Tail&... t)\n\t{read_(h),read_(t...);}\n\t\n\tinline void write_(){}\n\tinline void postive_write(unsigned x)\n\t{\n\t\tif(x>9) postive_write(x/10);\n\t\tputchar(x%10|'0');\n\t}\n\tinline void postive_write(unsigned long long x)\n\t{\n\t\tif(x>9) postive_write(x/10);\n\t\tputchar(x%10|'0');\n\t}\n\tinline void postive_write(int x)\n\t{\n\t\tif(x>9) postive_write(x/10);\n\t\tputchar(x%10|'0');\n\t}\n\tinline void postive_write(long long x)\n\t{\n\t\tif(x>9) postive_write(x/10);\n\t\tputchar(x%10|'0');\n\t}\n\tinline void postive_write(short x)\n\t{\n\t\tif(x>9) postive_write(x/10);\n\t\tputchar(x%10|'0');\n\t}\n\tinline void write_(const char* ss) {while(*ss) putchar(*ss++);}\n\tinline void write_(char c) {putchar(c);}\n\tinline void write_(string s) {for(unsigned i=0;i<s.size();++i) putchar(s[i]);}\n\tinline void write_(short x)\n\t{\n\t\tif(x<0) putchar('-'),postive_write(-x);\n\t\telse postive_write(x);\n\t}\n\tinline void write_(int x)\n\t{\n\t\tif(x<0) x=-x,putchar('-');\n\t\tpostive_write(x);\n\t}\n\tinline void write_(long long x)\n\t{\n\t\tif(x<0) x=-x,putchar('-');\n\t\tpostive_write(x);\n\t}\n\tinline void write_(unsigned x) {postive_write(x);}\n\tinline void write_(ull x) {postive_write(x);}\n\t\n\ttemplate<typename Head,typename ...Tail>\n\tinline void write_(Head h,Tail ...t) {write_(h),write_(t...);}\n}\nusing get_out::read_;\nusing get_out::write_;\n//dalao\u5609\u5e74\u534e\u63d0\u4f9b\u7684\u5feb\u5230\u98de\u8d77\u7684\u5feb\u8bfb\nvector<int>cnt[Maxn<<1];\nint n,F,m,fa[Maxn<<1];\nint a[Maxn<<1],b[Maxn<<1],ans_[Maxn<<1];\nstruct ques\n{\n\tint l,r,id;\n\tint bl;\n}q[Maxn<<1];\ninline bool cmp(ques &a,ques &b)\n{\n\treturn a.bl!=b.bl?a.bl<b.bl:a.r<b.r;\n}\nint main()\n{\n\tread_(n,m);\n\tF=pow(n,0.45)+5;\n\tfor(register int i=1;i<=n;i++) read_(a[i]);\n\tfor(register int i=1;i<=n;i++) read_(b[i]);\n\tfor(register int i=1,k;i<=n;i++)\n\t{\n\t\tcnt[i].emplace_back(-0x7ffffff);\n\t\tk=i-1;\n\t\twhile(k&&((a[k]==a[i])||((a[k]^a[i])&&b[k]<=b[i])))\n\t\t\tk=fa[k];\n\t\tcnt[fa[i]=k].emplace_back(i);\n\t}\n\tfor(register int i=1;i<=m;i++)\n\t{\n\t\tread_(q[i].l,q[i].r);\n\t\tq[i].id=i,q[i].bl=q[i].l/F;\n\t}\n\tsort(q+1,q+m+1,cmp);\n//\tcerr<<clock();\n\tint l=1,r=1,ans=1;\n\tfor(register int i=1;i<=m;i++)\n\t{\n\t\twhile(q[i].r>r)\n\t\t\tans+=(fa[++r]<l?1:0);\n\t\twhile(q[i].l<l)\n\t\t{\n\t\t\tl--,ans++;\n\t\t\tvector<int>::iterator t1=upper_bound(cnt[l].begin(),cnt[l].end(),l);\n\t\t\tvector<int>::iterator t2=upper_bound(cnt[l].begin(),cnt[l].end(),r)-1;\n\t\t\tif(t1!=cnt[l].end()&&t2!=cnt[l].begin())\n\t\t\t\tans-=(t2-t1+1);\n\t\t}\n\t\twhile(q[i].r<r)\n\t\t\tans-=(fa[r--]<l?1:0);\n\t\twhile(q[i].l>l)\n\t\t{\n\t\t\tvector<int>::iterator t1=upper_bound(cnt[l].begin(),cnt[l].end(),l);\n\t\t\tvector<int>::iterator t2=upper_bound(cnt[l].begin(),cnt[l].end(),r)-1;\n\t\t\tif(t1!=cnt[l].end()&&t2!=cnt[l].begin())\n\t\t\t\tans+=(t2-t1+1);\n\t\t\tl++,ans--;\n\t\t}\n\t\tans_[q[i].id]=ans;\n\t}\n\tfor(register int i=1;i<=m;i++) write_(ans_[i],'\\n');\n}\n```",
        "postTime": 1648275307,
        "uid": 167279,
        "name": "Danno0v0",
        "ccfLevel": 7,
        "title": "[NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\u9898\u89e3"
    },
    {
        "content": "\u672c\u9898\u89e3\u9ed8\u8ba4\u8bfb\u8005\u5df2\u7ecf\u5b66\u4e60\u8fc7\u5355\u8c03\u6808\u3002\u4e0b\u6587\u4e2d\u7684\u5bf9\u4e8e\u5355\u8c03\u6808\u7684\u201c\u63d2\u5165\u67d0\u5143\u7d20\u4e4b\u524d\u201d\u82e5\u672a\u7279\u6b8a\u8bf4\u660e\u5747\u5df2\u7ecf\u5b8c\u6210\u5355\u8c03\u6027\u7684\u7ef4\u62a4\uff0c\u4e5f\u5c31\u662f\u5df2\u7ecf\u628a\u6b64\u65f6\u6808\u91cc\u4e0d\u8be5\u6709\u7684\u4e1c\u897f\u98de\u4e86\u3002\n\n\u9898\u4e2d\u7ed9\u7684\u6808\u53ef\u770b\u4f5c\u662f\u5355\u8c03\u6808\u7684\u4e00\u79cd\u53d8\u5f62\uff0c\u56e0\u6b64\u4e0b\u6587\u5bf9\u6b64\u4e5f\u79f0\u4e3a\u201c\u5355\u8c03\u6808\u201d\u3002\n\n\u7ed3\u8bba\uff1a\u628a\u4e8c\u5143\u7ec4\u6309\u5e8f\u5168\u90fd\u5f80\u5355\u8c03\u6808\u91cc\u63d2\u4e00\u6b21\uff0c\u5982\u679c\u5bf9\u4e8e\u67d0\u4e2a\u533a\u95f4\u5185\u7684\u67d0\u4e8c\u5143\u7ec4\u5bf9\u8fd9\u4e2a\u533a\u95f4\u7684\u7b54\u6848\u4ea7\u751f\u4e86\u8d21\u732e\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u5f80\u5355\u8c03\u6808\u91cc\u8fdb\u7684\u65f6\u5019\u8981\u4e48\u6808\u662f\u7a7a\u7684\u8981\u4e48\u6808\u9876\u4e8c\u5143\u7ec4\u7684\u4e0b\u6807\u5c0f\u4e8e\u5de6\u8fb9\u754c\u3002\n\n\u6bd4\u8f83\u7b80\u5355\u7c97\u66b4\u7684\u8bc1\u660e\u601d\u8def\uff1a\u5355\u8c03\u6808\u4e3a\u7a7a\u7684\u60c5\u51b5\u663e\u7136\uff1b\u5355\u8c03\u6808\u6808\u9876\u4e0b\u6807\u5c0f\u4e8e\u5de6\u8fb9\u754c\u4e0b\u6807\u65f6\uff0c\u8bf4\u660e\u5de6\u533a\u95f4\u70b9\u5230\u5f53\u524d\u4e8c\u5143\u7ec4\u4e4b\u95f4\u7684\u4e8c\u5143\u7ec4\u5df2\u7ecf\u4ece\u5355\u8c03\u6808\u91cc\u88ab\u98de\u4e86\uff1b\u6362\u53e5\u8bdd\u8bf4\uff0c\u6b64\u65f6\u5982\u679c\u4ece\u5de6\u8fb9\u754c\u5f00\u59cb\u63d2\u5165\u5355\u8c03\u6808\u7684\u8bdd\uff0c\u5230\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u7684\u65f6\u5019\u6808\u662f\u7a7a\u7684\u3002\n\n\u8fd8\u6709\u4e00\u79cd\u8bc1\u660e\u601d\u8def\uff1a\u5efa\u7acb\u4e00\u9897\u4ee5\u4e8c\u5143\u7ec4\u4e0b\u6807\u4e3aBST\u5173\u952e\u5b57\uff0c\u4ee5\u76f8\u90bb\u4e8c\u5143\u7ec4\u76f8\u5bf9\u5927\u5c0f\u4e3a\u5806\u5173\u952e\u5b57\u7684\u5927\u6839\u5806\u7b1b\u5361\u5c14\u6811\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u662f\u5927\u6839\u5806\uff0c\u62ff\u5355\u8c03\u6808\u5efa\u6811\u7684\u8bdd\u4f1a\u53d1\u73b0\u8fd9\u91cc\u7684\u5355\u8c03\u6808\u548c\u9898\u76ee\u4e2d\u7684\u5355\u8c03\u6808\u4e00\u81f4\u3002\u4e4b\u540e\u4f1a\u53d1\u73b0\uff1a\u5efa\u6811\u65f6\u53f3\u94fe\u5c31\u662f\u5355\u8c03\u6808\u53cd\u8fc7\u6765\u7684\u6837\u5b50\uff0c\u800c\u5982\u679c\u53d1\u751f\u4e86\u56e0\u7ef4\u62a4\u5355\u8c03\u6027\u800c\u5bfc\u81f4\u7684\u5143\u7d20\u5f39\u51fa\uff0c\u53f3\u94fe\u4e5f\u4f1a\u5bf9\u5e94\u5730\u53d1\u751f\u6539\u53d8\uff0c\u4e14\u82e5\u52a0\u5165\u7684\u4e8c\u5143\u7ec4\u662f\u201c\u6210\u529f\u7684\u201d\uff0c\u8be5\u4e8c\u5143\u7ec4\u5bf9\u5e94\u7ed3\u70b9\u4f1a\u5728\u6b64\u65f6\u6210\u4e3a\u53f3\u94fe\u7684\u6839\u8282\u70b9\uff0c\u6b64\u65f6\u5dee\u4e0d\u591a\u5c31\u60f3\u5230\u4e3a\u4ec0\u4e48\u4e86\uff0c\u7559\u7ed9\u8bfb\u8005\u601d\u8003\u3002\n\n\u7531\u6b64\u6613\u5f97\u82e5\u662f\u5c06\u5168\u90e8\u4e8c\u5143\u7ec4\u6309\u4e0b\u6807\u987a\u5e8f\u5168\u90e8\u5f80\u5355\u8c03\u6808\u91cc\u585e\u4e00\u8fb9\u7684\u8bdd\u5c06\u4e00\u4e2a\u4e8c\u5143\u7ec4\u63d2\u5165\u5355\u8c03\u6808\u4e4b\u524d\uff0c\u82e5\u6808\u4e0d\u4e3a\u7a7a\uff0c\u5219\u8be5\u4e8c\u5143\u7ec4\u5bf9\u4e8e\u4ee5\u6808\u9876\u4e0b\u6807\u5f80\u540e\u4e00\u4f4d\u4e3a\u5de6\u8fb9\u754c\u3001\u4ee5\u5f53\u524d\u4e8c\u5143\u7ec4\u4e0b\u6807\u4e3a\u53f3\u8fb9\u754c\u7684\u533a\u95f4\u4ea7\u751f1\u7684\u8d21\u732e\u3002\n\n\u663e\u7136\u73b0\u5728\u6709\u4e2a\u6734\u7d20\u7684\u601d\u8def\uff1a\u62ff\u6811\u72b6\u6570\u7ec4\u6309\u7167\u7edf\u8ba1\u9006\u5e8f\u5bf9\u7684\u65b9\u6cd5\uff08\u5c06\u4ea7\u751f\u8d21\u732e\u7684\u4f4d\u7f6e+1\uff0c\u4e4b\u540e\u7edf\u8ba1\uff09\u8fdb\u884c\u8ba1\u6570\uff0c\u5f88\u663e\u7136\u4f1aBOOM\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e00\u4e2a\u67e5\u8be2\u533a\u95f4\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u53ef\u80fd\u90fd\u9700\u8981\u64cd\u4f5c\u6811\u72b6\u6570\u7ec4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u6bd4\u5e73\u65b9\u8fd8\u70c2\u3002\n\n\u8fd9\u65f6\u5019\u5982\u679c\u6ca1\u6709\u601d\u8def\u7684\u8bdd\uff0c\u5efa\u8bae\u51fa\u95e8\u5de6\u8f6c[P1972](https://www.luogu.com.cn/problem/P1972)\uff0c\u8fd9\u7b97\u662f\u6811\u72b6\u6570\u7ec4\u8fdb\u884c\u79bb\u7ebf\u591a\u533a\u95f4\u5904\u7406\u7684\u677f\u5b50\uff0c\u5bf9\u4e8e\u601d\u8def\u53ef\u80fd\u4f1a\u6709\u542f\u53d1\u3002\u5176\u5b9e\u8fd9\u4e00\u90e8\u5206\u672c\u9898\u4e0e\u8fd9\u9053\u9898\u57fa\u672c\u4e00\u81f4\u3002\n\n\u56de\u5230\u672c\u9898\u3002\u7b14\u8005\u7684\u601d\u8def\u662f\uff1a\u628a\u7edf\u8ba1\u65b9\u6cd5\u8f6c\u5316\u4e00\u4e0b\u3002\u901a\u8fc7\u5355\u8c03\u6808\u6211\u4eec\u83b7\u5f97\u7684\u662f\u67d0\u4e2a\u70b9\u4f1a\u5bf9\u8be2\u95ee\u533a\u95f4\u5de6\u7aef\u70b9\u5728\u54ea\u4e2a\u4e0b\u6807\u540e\u9762\u7684\u533a\u95f4\u4ea7\u751f\u8d21\u732e\u7684\u90a3\u4e2a\u4e0b\u6807\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u53cd\u8fc7\u6765\u77e5\u9053\u5bf9\u4e8e\u4e00\u4e2a\u4e0b\u6807\uff0c\u6709\u54ea\u4e2a\u4e0b\u6807\u7684\u4e8c\u5143\u7ec4\u7684\u201c\u8d21\u732e\u4ea7\u751f\u5f00\u59cb\u5de6\u8fb9\u754c\u201d\u662f\u6b64\u4e0b\u6807\uff0c\u6211\u4eec\u59d1\u4e14\u79f0\u5176\u4e3a\u201c\u524d\u9a71\u201d\u3002\u6211\u4eec\u5bf9\u6240\u6709\u4e8c\u5143\u7ec4\u63d0\u524d\u8bb0\u5f55\u521d\u59cb\u4e0b\u6807\uff0c\u4e4b\u540e\u6309\u7167\u5176\u524d\u9a71\u9012\u589e\u6392\u5e8f\uff0c\u8fd9\u6837\u53ef\u4ee5\u5bf9\u6574\u4e2a\u533a\u95f4\u7ebf\u6027\u626b\u63cf\u4e00\u6b21\u901a\u8fc7\u524d\u9a71\u6c42\u51fa\u6b64\u524d\u9a71\u5bf9\u5e94\u54ea\u4e2a\u4e8c\u5143\u7ec4\u4ea7\u751f\u8d21\u732e\uff0c\u4e4b\u540e\u76f4\u63a5\u533a\u95f4\u6c42\u548c\u5373\u53ef\uff0c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u524d\u7f00\u548c\uff0c\u76f4\u63a5\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u626c\u4e86?\n\n\u6ca1\u8fd9\u4e48\u7b80\u5355\uff0c\u6ce8\u610f\u8fd9\u4e2a\u7531\u524d\u9a71\u4ea7\u751f\u7684\u8d21\u732e\u5e76\u4e0d\u662f\u9759\u6001\u7684\u3002\u540c\u65f6\u6ce8\u610f\u5230\u8fd9\u4e2a\u524d\u9a71\u663e\u7136\u4e0e\u8be2\u95ee\u533a\u95f4\u5de6\u7aef\u70b9\u6709\u5173\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u4ed4\u7ec6\u60f3\u60f3\u7ed3\u8bba\u3002\u8981\u662f\u6bcf\u6b21\u90fd\u5355\u72ec\u5904\u7406\u590d\u6742\u5ea6\u548c\u524d\u9762\u90a3\u4e2anaive\u601d\u8def\u662f\u4e00\u6837\u7684\u3002\u6b64\u65f6\u53ef\u501f\u9274P1972\u7684\u601d\u8def\uff0c\u5c06\u8be2\u95ee\u533a\u95f4\u901a\u8fc7\u5de6/\u53f3\u7aef\u70b9\u7ec4\u7ec7\u6210\u5355\u8c03\u7684\uff0c\u4e4b\u540e\u968f\u533a\u95f4\u79fb\u52a8\u8fdb\u884c\u4fee\u6539\u3002\u663e\u7136\u7531\u524d\u9762\u8bf4\u7684\uff0c\u8fd9\u91cc\u5e94\u8be5\u6309\u5de6\u7aef\u70b9\u5347\u5e8f\u6392\u5e8f\u6240\u6709\u533a\u95f4\uff0c\u4ee5\u533a\u95f4\u5de6\u7aef\u70b9\u4f5c\u4e3a\u6bcf\u6b21\u4fee\u6539\u64cd\u4f5c\u7ec8\u70b9\uff0c\u5728\u4fee\u6539\u7ed3\u675f\u540e\u8fdb\u884c\u7edf\u8ba1\u3002\u6392\u5e8f\u540e\u8be5\u6307\u9488\u7684\u79fb\u52a8\u6b21\u6570\u663e\u7136\u6700\u5927\u4e3a\u4e8c\u5143\u7ec4\u4e2a\u6570\u6b21\uff0c\u5373 $O(n)$ \uff0c\u56e0\u6b64\u672c\u7b97\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((q+n)\\log n)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u7ebf\u6027\u3002\n\n\u732e\u4e0a\u6d1b\u8c37\u6c11\u95f4\u6570\u636eAC\u4ee3\u7801\uff1a\uff08\u5148\u522b\u8d70\uff0c\u540e\u9762\u8fd8\u6709\u5185\u5bb9\uff09\n```cpp\n/*\n\u306f\u3089\u308a\u3001\u6ed1\u308a\u843d\u3061\u308b\n\u63b4\u3093\u3060\u5e78\u305b\u306e\u8106\u3055\u306b\n\u305d\u308c\u3067\u3082\u3001\u9858\u3046\u306e\u306f\n\u611b\u3057\u305f\u7537\u3068\u6d3b\u304d\u308b\u3053\u3068\n*/\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst LL N=5e5+15;\nstack<LL> st;\nLL C[N],n;\ninline LL lbt(LL x) {return x&(-x);}\ninline void cha(LL x,LL q) {while(x<=n&&x) C[x]+=q,x+=lbt(x);}\ninline LL sum(LL x) {LL ans=0;while(x>0) ans+=C[x],x-=lbt(x);return ans;}\ninline LL getsm(LL l,LL r) {return sum(r)-sum(l-1);}\ninline char gc()\n{\n    static char buf[1<<23],*p1=buf,*p2=buf;\n    return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<23,stdin),p1==p2)?EOF:*p1++;\n}\n//#define gc getchar\ninline LL qread()\n{\n    LL a=0,f=1;char ch=gc();\n    while(ch<'0' || ch>'9') {if(ch=='-') f=-1;ch=gc();}\n    while(ch>='0' && ch<='9') {a=(a<<3)+(a<<1)+ch-'0';ch=gc();}\n    return a*f;\n}\ninline void qwrite(LL x)\n{\n    if(x==0) {putchar('0'),putchar('\\n');return;}\n    char w[128];LL cnt=0;\n    if(x<0) putchar('-'),x*=-1;\n    while(x) {w[cnt++]=(x%10)+'0';x/=10;}\n    while(cnt--) putchar(w[cnt]);putchar('\\n');\n}\ninline void file(string name)\n{\n    freopen((name+\".in\").c_str(),\"r\",stdin);\n    freopen((name+\".out\").c_str(),\"w\",stdout);\n}\nstruct AWSL{LL a,b,pos,id;} WA[N];//\u6b64\u5904\u7684id\u5176\u5b9e\u4e3aidx\uff0c\u5373\u4e0b\u6807\nconst inline bool operator <(const AWSL &a,const AWSL &b) {return a.pos<b.pos;}\nLL ans[N],q;\nstruct queries{LL l,r,id;}Q[N];\nconst inline bool operator <(const queries &a,const queries &b) {return a.l<b.l;}\nint main()\n{\n    //file(\"stack4\");\n    n=qread(),q=qread();\n    for(LL i=1;i<=n;++i) WA[i].id=i,WA[i].a=qread();for(LL i=1;i<=n;++i) WA[i].b=qread();\n    for(LL i=1;i<=n;++i) {while(!st.empty() && (WA[st.top()].a==WA[i].a || WA[st.top()].b<=WA[i].b)) st.pop();WA[i].pos=st.empty()?0:st.top();st.push(i);}\n    for(LL i=1;i<=q;++i) Q[i].id=i,Q[i].l=qread(),Q[i].r=qread();\n    stable_sort(WA+1,WA+n+1);stable_sort(Q+1,Q+q+1);LL rptr=1;\n    for(LL i=1;i<=q;++i)//\u4f2a\u53cc\u6307\u9488\n    {\n        while(WA[rptr].pos<Q[i].l) cha(WA[rptr].id,1),++rptr;\n        ans[Q[i].id]=getsm(Q[i].l,Q[i].r);\n    }\n    for(LL i=1;i<=q;++i) qwrite(ans[i]);\n    return 0;\n}\n/*\n\u305f\u3051\u306e\u306f\u306a\n\u3055\u3044\u3066\u305f\u3060\n\u3061\u308b\u307e\u3067\u306e\u307f\u3092\u304b\u304b\u3048\u3066\n\u3060\u308c\u306b\u3067\u306a\u304f\u3042\u3044\u3092\u3055\u3051\u3076\n\u3068\u3082\u306b\u3044\u304d\u3066\u3044\u305f\u3053\u3068\n\u3060\u305f\u3057\u3042\u308f\u305b\u3092\u306d\u304c\u3063\u305f\u304c\n\u305d\u308c\u3067\u3082\u306f\u304b\u306a\u304f\u304d\u3086\u308b\u306e\u307f\n\u305f\u3060\u3075\u304b\u3044\u30a2\u30a4\u306e\u304a\u308f\u3089\u305a\u306b\n\u3044\u3064\u307e\u3067\u3082\u306e\u3053\u3055\u308c\u3066\u3001\u3042\u3042\n*/\n```\n\u6b64\u5916\uff0c\u6613\u5f97\u5728\u7b1b\u5361\u5c14\u6811\u4e0a\uff0c\u67d0\u4e2a\u533a\u95f4\u7684\u7b54\u6848\u4e3a\u533a\u95f4\u5de6\u7aef\u70b9\u5bf9\u5e94\u7ed3\u70b9\u4e0e\u533a\u95f4\u4e24\u4e2a\u7aef\u70b9\u5bf9\u5e94\u7ed3\u70b9\u7684LCA\u4e4b\u95f4\u7684\u6700\u77ed\u8def\u5f84\u4e0a\u5bf9\u5e94\u4e0b\u6807\u5728\u8be5\u533a\u95f4\u5185\u7684\u7ed3\u70b9\u4e2a\u6570\u3002\u7b14\u8005\u4e0e @Rnfmabj  \u6b63\u5728\u5c1d\u8bd5\u7531\u6b64\u7ed3\u8bba\u5f15\u7533\u51fa\u7684\u70b9\u5206\u6cbb\u89e3\u6cd5\uff0c\u82e5\u6709\u8fdb\u5c55\u4f1a\u5728\u6b64\u5904\u66f4\u65b0\u3002",
        "postTime": 1648273817,
        "uid": 456724,
        "name": "2020kanade",
        "ccfLevel": 3,
        "title": "\u3010\u53e3\u80e1\u9898\u89e3\u3011NOI Online 2022 Senior T1 \u4e39\u9493\u6218"
    },
    {
        "content": "[P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\uff08\u6c11\u95f4\u6570\u636e\uff09](https://www.luogu.com.cn/problem/P8251)\n\n\u9898\u76ee\u8981\u6c42\u628a\u6570\u5b57\u653e\u5728\u4e00\u4e2a\u65b0\u5b9a\u4e49\u7684\u6808\u4e2d\u3002\n\n\u9898\u76ee\u4f1a\u7ed9\u51fa\u6bcf\u4e2a\u6570\u7684\u4e24\u4e2a\u5173\u952e\u5b57\uff0c\u8fd8\u4f1a\u5728\u6700\u540e\u7ed9\u51fa\u6bcf\u4e00\u6b21\u67e5\u8be2\u7684\u8303\u56f4\uff0c\u6bcf\u4e00\u6b21\u67e5\u8be2\u65f6\u662f\u4ece\u5de6\u7aef\u70b9\u5230\u53f3\u7aef\u70b9\u4f9d\u6b21\u8fdb\u884c\u5165\u6808\u64cd\u4f5c\u3002\u8be2\u95ee\u95f4\u72ec\u7acb\u3002\n\n\uff08\u6bd4\u8f83\u61d2\uff0c\u8fd9\u91cc\u7684\u7b2c\u4e00\u7b2c\u4e8c\u662f\u6307\u6bcf\u4e00\u5217\u7b2c\u4e00\u3001\u4e8c\u4e2a\u503c\uff09\n\n\u5728\u8fd9\u4e2a\u6808\u4e2d\uff0c\u6bcf\u6b21\u52a0\u5165\u65b0\u5143\u7d20\u90fd\u8981\u5224\u65ad\u4e00\u4e0b\uff0c\u53ea\u6709\u5728\u7b2c\u4e00\u5173\u952e\u5b57\u4e0d\u540c\u4e14\u7b2c\u4e8c\u5173\u952e\u5b57\u6bd4\u539f\u6765\u7684\u6808\u9876\u5c0f\u7684\u6216\u6808\u4e3a\u7a7a\u624d\u80fd\u628a\u4e00\u4e2a\u6570\u653e\u4e0a\u53bb\u3002\u7edf\u8ba1\u503c\u4e3a\u6bcf\u6b21\u5165\u5b8c\u6808\u540e\u6808\u91cc\u53ea\u8981\u4e00\u4e2a\u5143\u7d20\u7684\u6b21\u6570\u3002\n\n\u90a3\u4e48\u8fd9\u4e2a\u6808\u5c31\u662f\u6ee1\u8db3\u76f8\u90bb\u6570\u5b57\u7684\u7b2c\u4e00\u5173\u952e\u5b57\u4e0d\u540c\u4e14\u7b2c\u4e8c\u5173\u952e\u5b57\u4ece\u9876\u5230\u5e95\u5355\u8c03\u3002\n\n\u4e00\u770b\u5c31\u611f\u89c9\u53ef\u4ee5\u76f4\u63a5\u79bb\u7ebf\u3002\n\n\u7b2c\u4e00\u53cd\u5e94\u53ef\u80fd\u5c06\u8be2\u95ee\u6309\u7167\u53f3\u7aef\u70b9\u6392\u5e8f\u3002\n\n\u5f00\u59cb\u7684\u65f6\u5019\u8fd8\u4e0d\u786e\u5b9a\u8be5\u600e\u4e48\u5904\u7406\u3002\u7136\u540e\u770b\u4e86\u4e0b\u6570\u636e\u8303\u56f4\u3002\n\n![\u6570\u636e\u8303\u56f4](https://cdn.luogu.com.cn/upload/image_hosting/yxds7jrd.png)\n\n\u53ef\u4ee5\u770b\u5230\u7b2c\u56db\u7c7b\u548c\u7b2c\u4e94\u7c7b\u662f\u5341\u5206\u7279\u6b8a\u7684\u3002\n\n\u611f\u89c9\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u4ece\u8fd9\u4e24\u4e2a\u70b9\u5165\u624b\uff0c\u4e5f\u5c31\u662f\u5206\u522b\u601d\u8003\u7b2c\u4e00\u5173\u952e\u5b57\u7684\u5904\u7406\u4ee5\u53ca\u7b2c\u4e8c\u5173\u952e\u5b57\u7684\u5904\u7406\uff0c\u90a3\u4e48\u5408\u8d77\u6765\u5c31\u53ef\u4ee5\u8fc7\u4e86\u3002\n\n\u5148\u770b $a_i=i$ \u7684\u60c5\u51b5\uff0c\u8fd9\u4e2a\u5c31\u662f\u8bf4\u7b2c\u4e00\u5173\u952e\u5b57\u90fd\u4e0d\u540c\uff0c\u53ef\u4ee5\u4e0d\u8003\u8651\uff0c\u53ea\u8981\u8003\u8651\u7b2c\u4e8c\u5173\u952e\u5b57\u5c31\u597d\u4e86\u3002\n\n\u76f4\u63a5\u601d\u8003\u5982\u4f55\u5355\u8c03\u3002\u53ea\u8981\u5c0f\u4e8e\u7b49\u4e8e\u73b0\u6709\u7684\u6570\u5c31\u53ef\u4ee5\u76f4\u63a5\u8e22\u6389\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e00\u4e2a\u6570\u80fd\u8e22\u6389\u7684\u8303\u56f4\u5185\u7684\u6570\u90fd\u80fd\u88ab\u8fd9\u4e2a\u65b0\u6570\u8986\u76d6\uff0c\u4e5f\u5c31\u662f\u4ece\u88ab\u8e22\u6389\u7684\u6570\u90fd\u53ef\u4ee5\u5728\u5230\u4e86\u65b0\u6570\u65f6\u6b21\u6570\u52a0\u4e00\u3002\u56e0\u4e3a\u5411\u5de6\u8986\u76d6\uff0c\u6b64\u65f6\u82e5\u662f\u5c06\u53f3\u7aef\u70b9\u6392\u5e8f\uff0c\u5c31\u4e0d\u4f1a\u88ab\u8303\u56f4\u5916\u7684\u6570\u5f71\u54cd\u3002\n\n\u518d\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u4e0b\u5dee\u5206\u5c31\u597d\u4e86\u3002\n\n\u518d\u601d\u8003 $b_i=n-i+1$ \u7684\u60c5\u51b5\u3002\u5c31\u662f\u4fdd\u8bc1\u7b2c\u4e8c\u884c\u5355\u8c03\u9012\u51cf\u4e86\uff0c\u6211\u4eec\u53ea\u8981\u8003\u8651\u7b2c\u4e00\u884c\u662f\u5426\u76f8\u540c\uff0c\u76f8\u540c\u7684\u53ef\u4ee5\u5f80\u524d\u8e22\u3002\n\n![\u8986\u76d6\u56fe\u793a](https://cdn.luogu.com.cn/upload/image_hosting/bj8u7ul4.png)\n\n\u53ef\u4ee5\u7528\u6570\u7ec4\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u6570\u6700\u591a\u8986\u76d6\u5230\u54ea\u4e2a\u70b9\u6765\u65b9\u4fbf\u7ed9\u540e\u9762\u7684\u70b9\u627e\u8986\u76d6\u8303\u56f4\u3002\n\n\u5f00\u59cb\u90fd\u89c6\u4f5c\u7b97\u5b8c\u4e3a\u4e00\uff0c\u5982\u679c\u67e5\u8be2\u7684\u8303\u56f4\u7684\u5de6\u7aef\u70b9\u505a\u8fc7\u53f3\u7aef\u70b9\u8981\u5728\u7b97\u5b8c\u540e\u51cf\u4e00\u3002\n\n\u7528\u4e86\u4e0b\u5feb\u8f93\u3002\n\n\u4ee3\u7801\u5982\u4e0b\u3002\n\n---\n\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define ull unsigned long long\n#define For(i,a,b) for(int i=a;i<=b;i++)\n#define Rep(i,a,b) for(int i=a;i>=b;i--)\n#define f(a) ((a)*(a))\n#define p(x) printf(\"%lld \",(x))\n#define fp(x) printf(\"%.10Lf \",(x))\n#define P() puts(\"\")\n#define lowbit(x) ((x)&(-(x)))\nusing namespace std;\ninline int read()\n{\n\tchar c=getchar();int x=0;bool f=0;\n\twhile(!isdigit(c))f^=!(c^45),c=getchar();\n\twhile(isdigit(c))x=(x<<1)+(x<<3)+(c^48),c=getchar();\n\tif(f)x=-x;return x;\n}\ninline void write(int re)\n{\n\tif (re>9) write(re/10);\n\tputchar(re%10+'0');\n}\nconst int maxn=500010;\nconst int mod=1e9+7;\nconst int base=10007;\nstruct node\n{\n\tint l,r,Pos;\n}Q[maxn];\nint n,q,L,R;\nint a[maxn],b[maxn],c[maxn],d[maxn],e[maxn];\nint ans[maxn];\ninline void add(int pos,int x)\n{\n\twhile(pos<=n)\n\t{\n\t\tc[pos]+=x;\n\t\tpos+=lowbit(pos);\n\t}\n}\ninline int query(int x)\n{\n\tint res=0;\n\twhile(x>0)\n\t{\n\t\tres+=c[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn res;\n}\nbool cmp(node a,node b)\n{\n\treturn a.r<b.r;\n}\nsigned main()\n{\n\t//freopen(\"stack.in\",\"r\",stdin);\n\t//freopen(\"stack.out\",\"w\",stdout);\n\tn=read();q=read();\n\tFor(i,1,n) a[i]=read();\n\tFor(i,1,n) b[i]=read();\n\tFor(i,1,q)\n\t{\n\t\tQ[i].l=read();Q[i].r=read();Q[i].Pos=i;\n\t}\n\tsort(Q+1,Q+q+1,cmp);\n\tadd(1,1);\n\tFor(i,1,n) d[i]=i;\n\tR=1;L=1;\n\ta[0]=n+1;\n\tb[0]=n+1;\n\tFor(i,1,q)\n\t{\n\t\twhile(R<Q[i].r)\n\t\t{\n\t\t\tR++;\n\t\t\tL=R-1;\n\t\t\twhile(1)\n\t\t\t{\n\t\t\t\tif(a[L]==a[R]||b[L]<=b[R])\n\t\t\t\t{\n\t\t\t\t\tif(d[L]!=L)\n\t\t\t\t\t{\n\t\t\t\t\t\tL=d[L];\n\t\t\t\t\t}\n\t\t\t\t\tL--;\n\t\t\t\t}\n\t\t\t\telse \n\t\t\t\t{\n\t\t\t\t\tL++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(L==R) continue;\n\t\t\telse \n\t\t\t{\n\t\t\t\td[R]=L;\n\t\t\t\te[R]=1;\n\t\t\t\tadd(L,1);\n\t\t\t\tadd(R+1,-1);\n\t\t\t}\n\t\t}\n\t\tans[Q[i].Pos]=query(Q[i].l)-e[Q[i].l];\n\t}\n\tFor(i,1,q)\n\t{\n\t\twrite(ans[i]);\n\t\tP();\n\t}\n\treturn 0;\n}\n```\n\n---\n\n\u611f\u8c22\u7ba1\u7406\u5458\u7684\u5ba1\u6838\u3002\n",
        "postTime": 1648275764,
        "uid": 194642,
        "name": "xiaozeyu",
        "ccfLevel": 5,
        "title": "P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\uff08\u6c11\u95f4\u6570\u636e\uff09"
    },
    {
        "content": "update on 2022/4/6\n\n\u505a\u6cd5\uff1a\u79bb\u7ebf + \u6811\u72b6\u6570\u7ec4\n\n\u56e0\u4e3a\u6bcf\u6b21\u8be2\u95ee\u65f6\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u5143\u7d20\u6765\u8bf4\uff0c\u6211\u4eec\u53ea\u5728\u610f\u7b2c\u4e00\u4e2a\u628a\u5b83 pop \u51fa\u6808\u7684\u5143\u7d20\uff0c\u5e76\u53ef\u4ee5\u628a\u5b83\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u5f88\u663e\u7136\u7b2c\u4e00\u4e2a\u628a\u5b83 pop \u51fa\u6808\u7684\u5143\u7d20\u53ea\u6709\u4e00\u4e2a\uff08\u6216\u6ca1\u6709\uff09\u3002\u6240\u4ee5\u53ef\u4ee5\u628a\u5b83\u60f3\u8c61\u6210\u82e5\u5e72\u68f5\u6811\uff08\u4e00\u4e2a\u68ee\u6797\uff09\u3002\u8fd9\u6837\u6709\u5982\u4e0b\u597d\u5904\uff1a\n\n1. \u4e00\u68f5\u6811\u5185\u7684\u7f16\u53f7\u662f\u8fde\u7eed\u7684\u3002\n\n2. \u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u7684\u540e\u4ee3\u7f16\u53f7\u90fd\u6bd4\u5b83\u5c0f\u3002\n\n3. \u5f53\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u5165\u6808\u65f6\uff0c\u5b83\u7684\u540e\u4ee3\u80af\u5b9a\u5df2\u7ecf\u5168\u90e8\u51fa\u6808\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u6570\u7ec4 $mn$ \u6765\u8868\u793a\u5b83\u7684\u540e\u4ee3\u4e2d\u7f16\u53f7\u6700\u5c0f\u7684\u6570\u3002**\uff08update on 2022/4/6 : \u56e0\u4e3a\u540e\u4ee3\u7f16\u53f7\u90fd\u6bd4\u5b83\u5c0f\uff0c\u6240\u4ee5\u5728\u8bbf\u95ee\u5b83\u7684\u65f6\u5019\u5b83\u7684\u540e\u4ee3\u65e9\u5c31\u88ab\u8bbf\u95ee\u8fc7\u4e86\uff0c\u6240\u4ee5\u4e0d\u7528\u9012\u5f52\u6c42\u89e3, \u4f46\u662f\u628a\u5b83\u60f3\u8c61\u6210\u4e00\u68f5\u6811\u7684\u786e\u662f\u975e\u5e38\u76f4\u89c2\u7684\uff09\u3002**\n\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9 $id$ , \u5b83\u4f1a\u5bf9\u6240\u6709 $mn[id] \\le l \\le id$ \u4e14 $r \\ge id$ \u7684\u8be2\u95ee\u8d21\u732e\u52a0\u4e00\u3002\n\n\u56e0\u4e3a $mn[id] \\le l \\le id$ \uff0c\u4fdd\u8bc1\u4e86\u5b83\u5165\u6808\u65f6\u4e3a\u7a7a\u7684\uff0c\u5b83\u7684\u540e\u4ee3\u5df2\u7ecf\u5168\u90e8\u63a8\u51fa\u3002\u56e0\u4e3a $r \\ge id$\uff0c\u6240\u4ee5\u5b83\u6709\u5165\u6808\u7684\u673a\u4f1a\u3002\n\n\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\uff0c\u4ee5 $r$ \u4e3a\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\uff0c\u5c06 $id \\le r$ \u7684\u6240\u6709\u8282\u70b9\u5bf9\u5e94\u7684 $l$ \u8303\u56f4\u52a0\u4e00\u3002\n\n\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5b9e\u73b0\uff0c\u533a\u95f4\u52a0\u8f6c\u5316\u6210\u5dee\u5206\u64cd\u4f5c\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n//#pragma GCC optimize(2)\n#include<iostream>\n#include<vector>\n#include<stack>\n#include<algorithm>\n#include<cstdio>\nusing namespace std;\nconst int maxn = 5e5+5;\n\nstruct t{\n\tint a,b;\n\tint pos;\n};\nstruct Q{\n\tint l,r;\n\tint pos;\n}q[maxn];\nvector<int> v[maxn];\n\n\nint mn[maxn];\n\n/*int vis[maxn];\nvoid dfs(int u){\n\tvis[u] = 1;\n\tmn[u] = u;\n\tfor (int i = 0; i < v[u].size(); i++){\n\t\tint to = v[u][i];\n\t\tmn[u] = min(mn[u], mn[to]);\n\t\tif (!vis[to]) dfs(to);\n\t}\n}*/ //\u4e4b\u524d\u7684\u9012\u5f52 \nbool cmp(Q a, Q b){\n\treturn a.r < b.r;\n}\nint a[maxn], b[maxn],ans[maxn];\nint n,m;\n\n//\u6811\u72b6\u6570\u7ec4\nint C[maxn];\nint lowbit(int x){\n\treturn x&-x;\n}\nvoid add(int x, int v){\n\tif (!x) return;\n\tfor (int i = x; i <= n; i += lowbit(i)){\n\t\tC[i] += v;\n\t}\n}\nint getsum(int x){\n\tint ans = 0;\n\tfor (int i = x; i; i -= lowbit(i)){\n\t\tans += C[i];\n\t}\n\treturn ans;\n}\n//\n\n\nt s[maxn*2];\nint main(){\n\t//freopen(\"stack.in\",\"r\",stdin);\n\t//freopen(\"stack.out\",\"w\",stdout);\n\tcin >> n >> m;\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\",&a[i]);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\",&b[i]);\n\t\n\tint l,r;\n\tl = r = 0;\n\tfor (int i = 1; i <= n; i++){\n\t\twhile(r > l && (s[r].a == a[i] || s[r].b <= b[i])){\n\t\t\tv[i].push_back(s[r].pos);\n\t\t\tr--;\n\t\t}\n\t\ts[++r] = (t){a[i],b[i],i};\n\t}//\u9884\u5904\u7406\u51fa\u6765\u7b2c\u4e00\u4e2apop\u5143\u7d20\n    \n    \n\tfor (int i = 1; i <= n; i++){\n\t\t//if (!vis[i]) dfs(i);//\u627e\u6700\u5c0f\u8282\u70b9\n\t\tmn[i] = i;\n\t\tfor (int j = 0; j < v[i].size(); j++) mn[i] = min(mn[i], mn[v[i][j]]);\n\t}\n    \n\tfor (int i = 1; i <= m; i++){\n\t\tscanf(\"%d%d\",&q[i].l, &q[i].r);\n\t\tq[i].pos = i;\n\t}\n\tsort(q+1,q+1+m,cmp);\n\tint now = 1;\n\tfor (int i = 1; i <= m; i++){\n\t\twhile(now <= n && now <= q[i].r){\n\t\t\tadd(mn[now],1);\n\t\t\tadd(now+1,-1);//\u5dee\u5206\n\t\t\tnow++;\n\t\t}\n\t\tans[q[i].pos] = getsum(q[i].l);\n\t}\n\tfor (int i = 1; i <= m; i++){\n\t\tprintf(\"%d\\n\",ans[i]);\n\t}\n\treturn 0;\n} \n```\n\n",
        "postTime": 1648275213,
        "uid": 127682,
        "name": "lg_zhou",
        "ccfLevel": 7,
        "title": "P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218"
    },
    {
        "content": "# P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\u9898\u89e3\n\n[P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218](https://www.luogu.com.cn/problem/P8251)\n\n\u8fd9\u9053\u9898\u6211\u7684\u65b9\u6cd5\u662f**\u4e3b\u5e2d\u6811**\uff0c\u8bf7\u4e0d\u4e86\u89e3\u4e3b\u5e2d\u6811\u7684\u540c\u5b66\u79fb\u6b65\u8fd9\u9053\u9898\uff1a [P3834 \u3010\u6a21\u677f\u3011\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811 2](https://www.luogu.com.cn/problem/P3834)\n\n## \u5206\u6790\n\n### \u6a21\u62df\u5165\u6808\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u6808\u7684\u5143\u7d20 $b_i$ \u4e00\u5b9a\u662f\u5355\u8c03\u4e0b\u964d\u7684\uff0c\u5982\u679c\u8981\u6a21\u62df\u5165\u6808\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u7b2c\u4e00\u4e2a\u6bd4 $b_i$ \u5927\u7684\u5143\u7d20\u6765\u6a21\u62df\uff0c\u53ef\u4ee5\u5728 $n\\log n$ \u7684\u590d\u6742\u5ea6\u5185\u5b8c\u6210\u4e00\u6b21\u6a21\u62df\u3002\u4f46\u662f\u540c\u65f6\u8fd8\u8981\u6ee1\u8db3\u4efb\u610f\u4e24\u4e2a\u76f8\u90bb\u5143\u7d20\u7684 $a$ \u4e0d\u540c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u627e\u5230\u7b2c\u4e00\u4e2a\u6bd4 $b_i$ \u5927\u7684\u5143\u7d20\u540e\uff0c\u5f39\u51fa\u6808\u9876\u76f4\u5230\u6808\u9876\u5143\u7d20\u7684 $a$ \u4e0e $a_i$ \u4e0d\u76f8\u7b49\u3002\u6ce8\u610f\u8981\u9996\u5148\u628a $inf$ \u5165\u6808\uff0c\u9632\u6b62\u8d8a\u754c\u3002\n\n$b$ \u4ee3\u8868 $b$ \u5e8f\u5217\uff0c$c$ \u4ee3\u8868\u6808\u3002\n\n```cpp\nint l=0,r=t,z;\nwhile(l<r)\n {\n    z=(l+r+1)>>1;\n    if(b[i]<b[c[z]]) l=z;\n    else r=z-1;\n}\nwhile(a[c[l]]==a[i]) --l;\n```\n\n## \u67e5\u8be2\n\n\u5982\u679c\u6211\u4eec\u5148\u628a\u6240\u6709\u5143\u7d20\u6309\u987a\u5e8f\u5165\u6808\uff0c\u7531\u4e8e\u4efb\u610f\u7684 $[l,r]$ \u90fd\u5e94\u8be5\u662f $[1,n]$ \u7684\u4e00\u90e8\u5206\uff0c\u5e76\u4e14\u6808\u4e2d\u7684\u5143\u7d20\u7f16\u53f7\u4e00\u5b9a\u9012\u51cf\uff0c\u6240\u4ee5 $\\forall [l,r]$\uff0c\u6700\u7ec8\u5f62\u6210\u7684\u6808\u4e00\u5b9a\u662f $[1,r]$ \u5f62\u6210\u7684\u6808\u7684\u4e00\u90e8\u5206\uff0c\u5177\u4f53\u6765\u8bf4\u5c31\u662f $[1,r]$ \u5f62\u6210\u7684\u6808\u53bb\u6389\u6240\u6709\u7f16\u53f7\u6bd4 $l$ \u5c0f\u7684\u5143\u7d20\u3002\u5982\u679c $r$ \u53f7\u5143\u7d20\u60f3\u8981\u5728 $[l,r]$ \u5f62\u6210\u7684\u6808\u4e2d\u6210\u4e3a\u7b2c\u4e00\u4e2a\uff0c\u90a3\u4e48 $[1,r]$ \u6240\u5f62\u6210\u7684\u7684\u6808\u4e2d\u5728 $r$ \u4e4b\u524d\u7684\u5143\u7d20\u7684\u7f16\u53f7\u5fc5\u7136\u90fd\u6bd4 $l$ \u5c0f\uff0c\u53ea\u6709\u8fd9\u6837\u524d\u9762\u6240\u6709\u5143\u7d20\u624d\u4f1a\u88ab\u5220\u53bb\u3002\u6240\u4ee5\u7528 $d$ \u6765\u50a8\u5b58\u6bcf\u4e2a\u6570\u5165\u6808\u540e\u524d\u4e00\u4e2a\u5143\u7d20\u7684\u7f16\u53f7\uff0c\u90a3\u4e48 $[l,r]$ \u4e2d\u6210\u529f\u4e8c\u5143\u7ec4\u7684\u4e2a\u6570\u5c31\u662f $k \\in [l,r],d_k < l$ \u6210\u7acb\u7684 $k$ \u7684\u4e2a\u6570\u3002\n\n## \u4f18\u5316\n\n\u4f46\u662f\u4e0a\u9762\u8fd9\u79cd\u65b9\u6cd5\u7684\u590d\u6742\u5ea6\u4e3a $O(n\\times q)$ \uff0c\u663e\u7136\u8fc7\u4e0d\u4e86\u3002\u901a\u8fc7\u4e0a\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u53d1\u73b0\u67e5\u8be2\u7684\u5b9e\u8d28\u662f\u6c42 $d$ \u4e2d $[l,r]$ \u4e2d\u5c0f\u4e8e $l$ \u7684\u6570\u7684\u4e2a\u6570\u3002\u6709\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u80fd\u5b9e\u73b0\uff1f\u4e3b\u5e2d\u6811\uff01\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u53d8\u6210\u4e86\u4e3b\u5e2d\u6811\u7684\u677f\u5b50\u9898\u3002\u7136\u540e\uff0c\u5c31\u6ca1\u6709\u7136\u540e\u4e86\u3002\n\n## code\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nint read()\n{\n    char c=getchar();int x=0;bool f=0;\n    for(;!isdigit(c);c=getchar())f^=!(c^45);\n    for(;isdigit(c);c=getchar())x=(x<<1)+(x<<3)+(c^48);\n    if(f)x=-x;return x;\n}\nint n,m,p,t,a[500001],b[500001],c[500001],rt[500001];\nstruct tree\n{\n    int l,r,s;\n}T[30000001];\nvoid pushup(int x)\n{\n    T[x].s=T[T[x].l].s+T[T[x].r].s;\n}\nvoid build(int &x,int l,int r)\n{\n    x=++p;\n    if(l==r) return;\n    int z=l+r>>1;\n    build(T[x].l,l,z);\n    build(T[x].r,z+1,r);\n}\nvoid modify(int &x,int l,int r,int q)\n{\n    T[++p]=T[x];\n    ++T[p].s;\n    x=p;\n    if(l==r) return;\n    int z=l+r>>1;\n    if(q<=z) modify(T[x].l,l,z,q);\n    else modify(T[x].r,z+1,r,q);\n}\nint num(int x,int l,int r,int k)\n{\n    if(l==r) return 0;\n    int z=l+r>>1;\n    if(k==z) return T[T[x].l].s;\n    if(k<z) return num(T[x].l,l,z,k);\n    return T[T[x].l].s+num(T[x].r,z+1,r,k);\n}\nint main()\n{\n    freopen(\"stack.in\",\"r\",stdin);\n    freopen(\"stack.out\",\"w\",stdout);\n    n=read(),m=read();\n    for(int i=1;i<=n;++i) a[i]=read();\n    for(int i=1;i<=n;++i) b[i]=read();\n    a[0]=0;\n    b[0]=1e9;\n    c[0]=0;\n    build(rt[0],0,n);\n    for(int i=1;i<=n;++i)\n    {\n        int l=0,r=t,z;\n        while(l<r)\n        {\n            z=(l+r+1)>>1;\n            if(b[i]<b[c[z]]) l=z;\n            else r=z-1;\n        }\n        while(a[c[l]]==a[i]) --l;\n        t=l+1;\n        c[t]=i;\n        rt[i]=rt[i-1];\n        modify(rt[i],0,n,c[l]);\n    }\n    for(int i=1;i<=m;++i)\n    {\n        int l=read(),r=read();\n        printf(\"%d\\n\",num(rt[r],0,n,l-1)-num(rt[l-1],0,n,l-1));\n    }\n    return 0;\n}\n```",
        "postTime": 1648273924,
        "uid": 291248,
        "name": "\u8d75\u60a6\u5c91",
        "ccfLevel": 7,
        "title": "P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\u9898\u89e3"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\u73b0\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u6709\u4e24\u4e2a\u51b3\u5b9a\u7684\u53d8\u91cf $a_i,b_i$\u3002\u5411\u6808\u4e2d\u52a0\u5165\u5143\u7d20 ($a_i,b_i$) \u65f6\uff0c\u5148\u4e0d\u65ad\u5f39\u51fa\u6808\u9876\u5143\u7d20\u76f4\u81f3\u6808\u7a7a\u6216\u6808\u9876\u5143\u7d20 ($a_j,b_j$) \u6ee1\u8db3 $a_j\u2260b_j$ \u4e14 $b_i<b_j$ \uff0c\u7136\u540e\u5c06\u5176\u52a0\u5165\u6808\u4e2d\u3002\n\n\u5982\u679c\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5165\u6808\u540e\u6808\u5185\u53ea\u6709\u8fd9\u4e00\u4e2a\u5143\u7d20\uff0c\u5219\u79f0\u8be5\u4e8c\u5143\u7ec4\u662f\u201c\u6210\u529f\u7684\u201d\u3002\n\n\u8be2\u95ee $q$ \u6b21\uff0c\u6bcf\u6b21\u8be2\u95ee\u533a\u95f4 $[l,r]$ \u4e4b\u95f4\u6709\u591a\u5c11\u4e2a\u4e8c\u5143\u7ec4\u662f\u201c\u6210\u529f\u7684\u201d\u3002\n\n## \u601d\u8def\n\n\u770b\u5230\u6b64\u9898\uff0c\u7b2c\u4e00\u53cd\u5e94\u662f\u83ab\u961f\u7b97\u6cd5\u3002\u518d\u4e00\u770b\u6570\u636e\u8303\u56f4\u2014\u2014$n,q<=10^5$\uff0c\u786c\u4e0a\u83ab\u961f\u7684\u8bdd\u6709\u70b9\u60ac\u3002\u8003\u8651\u5e26\u4e00\u4e2a $\\log$ \u7684\u7b97\u6cd5\u3002\n\n\u6700\u521d\uff0c\u6211\u4eec\u5148\u5c06\u6240\u6709\u4e8c\u5143\u7ec4\u52a0\u5165\u6808\u4e2d\u3002\u540c\u65f6\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u5728\u5355\u8c03\u6808\u4e2d\u524d\u4e00\u4e2a\u6570\u7684\u7f16\u53f7\uff0c\u82e5\u6ca1\u6709\u524d\u4e00\u4e2a\u6570\uff0c\u5c06\u7f16\u53f7\u8bb0\u4e3a\u96f6\u3002\u5c06\u6240\u6709\u4e8c\u5143\u7ec4\u5728\u5355\u8c03\u6808\u4e2d\u524d\u4e00\u4e2a\u6570\u7684\u7f16\u53f7\u5728\u4e00\u4e2a\u4f18\u5148\u961f\u5217\u4e2d\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\u8fd9\u662f\u6700\u91cd\u8981\u7684\u90e8\u5206\uff0c\u8bb0\u4f4f\u4e86\u5965\u3002\n\n\u7136\u540e\uff0c\u5c06\u6240\u6709\u8be2\u95ee\u79bb\u7ebf\u5904\u7406\uff0c\u6309\u7167\u5de6\u7aef\u70b9\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\u6ce8\u610f\uff1a\u5728\u8be5\u505a\u6cd5\u4e2d\uff0c\u4e0d\u7528\u7ba1\u53f3\u6bb5\u70b9\u662f\u4e0d\u662f\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u7684\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u5c06\u4f18\u5148\u961f\u5217\u961f\u5934\u4e2d\u6bcf\u4e00\u4e2a\u524d\u4e00\u4e2a\u6570\u7684\u7f16\u53f7\u5c0f\u4e8e\u5de6\u7aef\u70b9\u7684\u4e8c\u5143\u7ec4\u8d21\u732e\u52a0\u4e0a\u4e00\u3002\u4e3a\u4e86\u7ef4\u62a4\u8fd9\u4e2a\u8d21\u732e\uff0c\u6211\u4eec\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u4fdd\u5b58\uff0c\u5b9e\u73b0\u6bcf\u4e00\u6b21\u589e\u52a0\u8d21\u732e\u4e3a $O(\\log n)$\u3002\n\n\u6700\u540e\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u6b21\u8be2\u95ee\u7684\u7b54\u6848\u5c31\u662f $sum(r)-sum(l-1)$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a\u6392\u5e8f\uff1a$O(q\\log q)$\uff0c\u8be2\u95ee $O(n\\log n)$\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log n+q\\log q)$\u3002\n\n## code\n```cpp\n//sto \u5434\u6208 orz \u4fdd\u6211AC\u6b64\u9898 \n#include<bits/stdc++.h>\nusing namespace std;\nstruct node1{\n\tint l,r,id;\n}d[500001];\nstruct node2{\n\tint a,b,id;\n}a[500001];\nint n,q;\nlong long ans[500001],t[500001];\nstack<node2> st;\npriority_queue<pair<int,int> > qu;\ninline int read()\n{\n\tint x(0);char ch=getchar();\n\twhile(ch<48||ch>57) ch=getchar();\n\twhile(ch>=48&&ch<=57) x=x*10+(ch^48),ch=getchar();\n\treturn x;\n}\nbool cmp(node1 x,node1 y)\n{\n\treturn x.l==y.l?x.r<y.r:x.l<y.l;\n}\nvoid add(int x)\n{\n\tfor(;x<=n;x+=x&-x) t[x]++;\n\treturn;\n}\nlong long sum(int x)\n{\n\tlong long s=0;\n\tfor(;x;x-=x&-x) s+=t[x];\n\treturn s;\n}\nint pr[30],cnt;\nvoid pu(long long x)\n{\n\twhile(x) pr[++cnt]=x%10,x/=10;\n\twhile(cnt) putchar(pr[cnt--]+48);\n\tputchar('\\n'); \n}\nint main()\n{\n\tfreopen(\"stack.in\",\"r\",stdin);\n\tfreopen(\"stack.out\",\"w\",stdout);\n\tn=read(),q=read();\n\tfor(int i=1;i<=n;i++) a[i].a=read(),a[i].id=i;\n\tfor(int i=1;i<=n;i++) a[i].b=read();\n\tfor(int i=1;i<=q;i++) d[i].l=read(),d[i].r=read(),d[i].id=i;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(!st.empty()&&(st.top().b<=a[i].b||st.top().a==a[i].a)) st.pop();\n\t\tif(st.empty()) qu.push(make_pair(0,i));else qu.push(make_pair(-st.top().id,i));st.push(a[i]);\n\t}\n\tsort(d+1,d+1+q,cmp);\n\tfor(int i=1;i<=q;i++)\n\t{\n\t\twhile(!qu.empty()&&-qu.top().first<d[i].l) {add(qu.top().second);qu.pop();} \n\t\tans[d[i].id]=sum(d[i].r)-sum(d[i].l-1);\n\t}\n\tfor(int i=1;i<=q;i++) pu(ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1648270317,
        "uid": 399674,
        "name": "Naro_Ahgnay",
        "ccfLevel": 0,
        "title": "P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218 \u9898\u89e3"
    },
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/P8251)\n\n## \u9898\u610f\n\n\u6709 $n$ \u4e2a\u4e8c\u5143\u7ec4 $(a_i, b_i)$\uff0c\u7f16\u53f7\u4e3a $1$ \u5230 $n$\u3002\n\n\u6709\u4e00\u4e2a\u521d\u59cb\u4e3a\u7a7a\u7684\u6808 $S$\uff0c\u5411\u5176\u4e2d\u52a0\u5165\u5143\u7d20 $(a_i, b_i)$ \u65f6\uff0c\u5148\u4e0d\u65ad\u5f39\u51fa\u6808\u9876\u5143\u7d20\u76f4\u81f3\u6808\u7a7a\u6216\u6808\u9876\u5143\u7d20 $(a_j , b_j)$ \u6ee1\u8db3 $a_i \\neq a_j$ \u4e14 $b_i < b_j$\uff0c\u7136\u540e\u518d\u5c06\u5176\u52a0\u5165\u6808\u4e2d\u3002\n\n\u5982\u679c\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5165\u6808\u540e\u6808\u5185\u53ea\u6709\u8fd9\u4e00\u4e2a\u5143\u7d20\uff0c\u5219\u79f0\u8be5\u4e8c\u5143\u7ec4\u662f\u201c\u6210\u529f\u7684\u201d\u3002\n\n\u6709 $q$ \u4e2a\u8be2\u95ee $[l, r]$\uff0c\u8868\u793a\u82e5\u5c06\u7f16\u53f7\u5728 $[l, r]$ \u4e2d\u7684\u4e8c\u5143\u7ec4\u6309\u7f16\u53f7\u4ece\u5c0f\u5230\u5927\u4f9d\u6b21\u5165\u6808\uff0c\u4f1a\u6709\u591a\u5c11\u4e2a\u4e8c\u5143\u7ec4\u662f\u201c\u6210\u529f\u7684\u201d\u3002\n\n\u8be2\u95ee\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\u3002\n\n## \u5206\u6790\n\n\u4ed4\u7ec6\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u52a0\u5165\u5143\u7d20 $(a_i, b_i)$ \u524d\uff0c\u5f39\u51fa\u5143\u7d20\u540e\uff0c\u8981\u4e48\u6808\u53d8\u7a7a\u4e86\uff0c\u8981\u4e48\u4f1a\u51fa\u73b0\u4e00\u4e2a\u6ee1\u8db3 $a_i = a_{c_i}$ \u6216 $b_i > b_{c_i}$ \u7684\u5143\u7d20 $(a_{c_i}, b_{c_i})$ \u963b\u6b62\u5f39\u51fa\uff0c\u53c8\u56e0\u4e3a\u52a0\u5165\u64cd\u4f5c\u7684\u987a\u5e8f\u662f\u56fa\u5b9a\u4ece\u5de6\u5230\u53f3\u7684\uff0c\u6240\u4ee5 $c_i$ \u662f\u56fa\u5b9a\u7684\u4e00\u4e2a\u6570\uff08\u5982\u679c $c_i$ \u4e0d\u5b58\u5728\u5219\u8bbe\u4e3a $0$\uff09\u3002\n\n\u6240\u4ee5\u5728\u4e00\u7ec4\u8be2\u95ee $[l,r]$ \u4e2d\uff0c\u4e8c\u5143\u7ec4 $(a_i, b_i)(l\\le i\\le r)$ \u662f\u6210\u529f\u7684\u4ec5\u5f53 $c_i$ \u4e0d\u5728 $[l,r]$ \u4e2d\uff0c\u5373 $c_i<l$\u3002\n\n\u90a3\u4e48\uff0c\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u6c42 $c_i<l(l\\le i\\le r)$ \u7684\u4e2a\u6570\u3002\n\n\u4e8e\u662f\u5927\u81f4\u6d41\u7a0b\u5c31\u51fa\u6765\u4e86\u3002\n\n\u9996\u5148\u628a\u8be2\u95ee\u8bfb\u5165\uff0c\u8981\u8fdb\u884c\u79bb\u7ebf\u5904\u7406\uff0c\u518d\u6839\u636e\u9898\u610f\u6a21\u62df\u4e00\u904d\uff0c\u6c42\u51fa\u6240\u6709\u7684 $c_i$\uff0c\u540c\u65f6\u628a $c_i$ \u653e\u8fdb\u6811\u72b6\u6570\u7ec4\uff0c\u6c42\u51fa $c_i$ \u7684\u4e2a\u6570\u7684\u524d\u7f00\u548c $sum_{l-1},sum_r$\uff0c\u4e8c\u8005\u7684\u5dee\u5c31\u662f\u7b54\u6848\u3002\n\n## \u4ee3\u7801\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+q)\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nlong long read(){\n\tlong long x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n\treturn x*f;\n}\nvoid write(long long x){\n    if(x<0) putchar('-'),x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\nconst int N=5e5+10;\nint n,q,a[N],b[N],z[N],t,ans;\nstruct Q{\n\tint l,r,ans;\n}d[N];\nint headl[N],nxtl[N*2],verl[N*2],totl;\nvoid addl(int x,int y){\n\tverl[++totl]=y;\n\tnxtl[totl]=headl[x];\n\theadl[x]=totl;\n}\nint headr[N],nxtr[N*2],verr[N*2],totr;\nvoid addr(int x,int y){\n\tverr[++totr]=y;\n\tnxtr[totr]=headr[x];\n\theadr[x]=totr;\n}\nvector<int>el[N],er[N];\nint f[N];\nvoid add(int x,int v){\n\tx++;\n\tfor(;x<=n;x+=x&-x)\n\t\tf[x]+=v;\n}\nint ask(int x){\n\tx++;\n\tint ans=0;\n\tfor(;x;x-=x&-x)\n\t\tans+=f[x];\n\treturn ans;\n}\nint main(){\n\t//freopen(\"stack.in\",\"r\",stdin);\n\t//freopen(\"stack.out\",\"w\",stdout);\n\tn=read();q=read();\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read();\n\tfor(int i=1;i<=n;i++)\n\t\tb[i]=read();\n\tfor(int i=1;i<=q;i++){\n\t\td[i].l=read();\n\t\td[i].r=read();\n\t\taddl(d[i].l-1,i);\n\t\taddr(d[i].r,i);\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\twhile(t&&(a[z[t]]==a[i]||b[z[t]]<=b[i]))\n\t\t\tt--;\n\t\tadd(z[t],1);\n\t\tz[++t]=i;\n\t\tfor(int j=headl[i];j;j=nxtl[j])\n\t\t\td[verl[j]].ans-=ask(d[verl[j]].l-1);\n\t\tfor(int j=headr[i];j;j=nxtr[j])\n\t\t\td[verr[j]].ans+=ask(d[verr[j]].l-1);\n\t}\n\tfor(int i=1;i<=q;i++){\n\t\twrite(d[i].ans);\n\t\tputs(\"\");\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1648275112,
        "uid": 419144,
        "name": "chenjunxiu",
        "ccfLevel": 7,
        "title": "P8251 [NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218"
    },
    {
        "content": "\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u4e0e\u5176\u4e0d\u51b2\u7a81\u7684\u524d\u9a71 $pre_i$\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c$pre_i$ \u5230 $i$ \u7684\u6240\u6709\u4e8c\u5143\u7ec4\u90fd\u53ef\u4ee5\u88ab\u4e8c\u5143\u7ec4 $i$ \u6362\u51fa\u6765\u3002\u7279\u522b\u7684\uff0c\u5982\u679c\u8be5\u4e8c\u5143\u7ec4\u6ca1\u6709\u524d\u9a71\uff0c\u524d\u9a71\u8bb0\u4e3a\u7b2c $0$ \u4e2a\u4e8c\u5143\u7ec4\u3002\u5982\u679c $pre_i < l$\uff0c\u4e8c\u5143\u7ec4\u5c31\u4f1a\u628a\u5355\u8c03\u6808\u4e2d\u6240\u6709\u4e8c\u5143\u7ec4\u6362\u51fa\u6765\uff0c\u6210\u4e3a\u4e00\u4e2a\u201c\u6210\u529f\u201d\u7684\u4e8c\u5143\u7ec4\u3002\u539f\u5148\u7684\u95ee\u9898\u5c31\u88ab\u8f6c\u5316\u4e3a\u6c42 $pre$ \u6570\u7ec4\u4e2d $[l,r]$ \u7684\u533a\u95f4\u5185\u5c0f\u4e8e $l$ \u7684\u5143\u7d20\u6570\u91cf\u95ee\u9898\u3002\n\n\u8be5\u95ee\u9898\u6709\u4e0d\u5c11\u89e3\u51b3\u65b9\u6cd5\uff0c\u4f46\u6811\u72b6\u6570\u7ec4\u8f83\u4e3a\u65b9\u4fbf\u3002\u6211\u4eec\u628a\u8be2\u95ee\u6309 $l$ \u7684\u5927\u5c0f\u6392\u5e8f\u3002\u5904\u7406\u8be2\u95ee\u524d\u5148\u628a\u6240\u6709\u5c0f\u4e8e $l$ \u7684\u5143\u7d20\u5bf9\u5e94\u7684\u4f4d\u7f6e\u6539\u6210 $1$\uff0c\u8be2\u95ee\u7684\u7b54\u6848\u5c31\u7b49\u4e8e $[l,r]$ \u4e2d $1$ \u7684\u6570\u91cf\uff0c\u5728\u6570\u503c\u4e0a\u7b49\u4e8e $r$ \u4e0e $l-1$ \u7684\u524d\u7f00\u548c\u4e4b\u5dee\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <stack>\nusing namespace std;\nconst int maxn = 5e5 + 7;\nint n, m;\nint a[maxn], b[maxn];\nint s[maxn], scnt;\npair<int, int> pre[maxn];\nint c[maxn];\npair<pair<int, int>, int> q[maxn];\nint ans[maxn];\nvoid add(int x, int k)\n{\n    for (; x <= n; x += x & -x)\n        c[x] += k;\n}\nint ask(int x)\n{\n    int k = 0;\n    for (; x; x -= x & -x)\n        k += c[x];\n    return k;\n}\nint main()\n{\n    scanf(\"%d%d\", &n, &m);\n    for (int i = 1; i <= n; i++)\n        scanf(\"%d\", &a[i]);\n    for (int i = 1; i <= n; i++)\n        scanf(\"%d\", &b[i]);\n    s[++scnt] = 0, b[0] = 1e7;\n    for (int i = 1; i <= n; i++)\n    {\n        while (a[s[scnt]] == a[i] || b[s[scnt]] <= b[i])\n            scnt--;\n        pre[i] = make_pair(s[scnt], i);\n        s[++scnt] = i;\n    }\n    sort(pre + 1, pre + n + 1);\n    for (int i = 1; i <= m; i++)\n    {\n        scanf(\"%d%d\", &q[i].first.first, &q[i].first.second);\n        q[i].second = i;\n    }\n    sort(q + 1, q + m + 1);\n    int p = 1;\n    for (int i = 1; i <= m; i++)\n    {\n        while (p <= n && pre[p].first < q[i].first.first)\n            add(pre[p].second, 1), p++;\n        ans[q[i].second] = ask(q[i].first.second) - ask(q[i].first.first - 1);\n    }\n    for (int i = 1; i <= m; i++)\n    {\n        printf(\"%d\\n\", ans[i]);\n    }\n}\n\n```",
        "postTime": 1648274043,
        "uid": 295455,
        "name": "staly",
        "ccfLevel": 7,
        "title": "P8251\u9898\u89e3"
    },
    {
        "content": "[\u4e0d\u77e5\u662f\u5426\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/tiatto/p/16060222.html)\n\n### Description\n\u7ed9\u51fa $n$ \u4e2a\u4e8c\u5143\u7ec4 $(a_i,b_i)$ \u548c $q$ \u4e2a\u8be2\u95ee $[l_i,r_i]$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u56de\u7b54\u5c06\u533a\u95f4 $[l_i,r_i]$ \u5185\u7684\u4e8c\u5143\u7ec4\u4f9d\u6b21\u52a0\u5165\u6ee1\u8db3\u76f8\u90bb\u4e24\u6570 $a$ \u503c\u4e0d\u540c\u3001$b$ \u503c\u9012\u51cf\u7684\u5355\u8c03\u6808\u7684\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6709\u591a\u5c11\u6b21\u5c06\u6808\u5f39\u7a7a\u3002\n\n$1\\leq n,q\\leq 5\\times 10^5$\n\n\n------------\n\n### Solution\n\n\u53d1\u73b0\u5de6\u7aef\u70b9\u76f8\u540c\u7684\u8be2\u95ee\u52a0\u5165\u5143\u7d20\u7684\u8fc7\u7a0b\u662f\u76f8\u540c\u7684\uff0c\u8003\u8651\u5c06\u8be2\u95ee\u79bb\u7ebf\uff0c\u5904\u7406\u4e00\u8d77\u5de6\u7aef\u70b9\u76f8\u540c\u7684\u8be2\u95ee\u3002\n\n\u8bbe $p_{l,i}$ \u8868\u793a\u4ee5 $l$ \u4e3a\u5de6\u7aef\u70b9\u7684\u60c5\u51b5\u4e0b\u52a0\u5165\u4e8c\u5143\u7ec4 $(a_i,b_i)$ \u65f6\u662f\u5426\u80fd\u5c06\u6808\u5f39\u7a7a\uff0c\u90a3\u4e48 $[l,r]$ \u7684\u7b54\u6848\u5373\u4e3a $\\sum_{i=l}^rp_{l,i}$\u3002\u8003\u8651\u4ee5 $l$ \u4e3a\u5de6\u7aef\u70b9\u76f8\u8f83\u4e8e\u4ee5 $l+1$ \u4e3a\u5de6\u7aef\u70b9\u4ea7\u751f\u4e86\u600e\u6837\u7684\u53d8\u5316\u3002\u8bbe $(a_i,b_i)$ \u4e3a\u5c06 $(a_l,b_l)$ \u4ece\u6808\u4e2d\u5f39\u51fa\u7684\u5143\u7d20\uff0c\u90a3\u4e48\u6709\uff1a\n1. $\\forall j\\in(l,i),p_{l,i}=0$\u3002\u8003\u8651\u53cd\u8bc1\uff0c\u82e5 $j_0\\in(l,i)$ \u80fd\u5c06\u6808\u5f39\u7a7a\uff0c\u5219 $j_0$ \u5c31\u4f1a\u5c06 $l$ \u5f39\u51fa\uff0c\u4e0e\u5b9a\u4e49\u4e0d\u7b26\u3002\n2. $\\forall j\\in[i,n],p_{l,i}=p_{l+1,i}$\u3002$i$ \u82e5\u80fd\u5c06 $l$ \u5f39\u51fa\uff0c\u5219\u4e5f\u80fd\u5c06 $l+1$ \u5f39\u51fa\u3002\u90a3\u4e48\u52a0\u5165 $i$ \u540e\u4ee5 $l$ \u4e3a\u5de6\u7aef\u70b9\u548c\u4ee5 $l+1$ \u4e3a\u5de6\u7aef\u70b9\u6808\u4e2d\u90fd\u53ea\u5269 $(a_i,b_i)$\uff0c\u6b64\u540e\u8fc7\u7a0b\u5b8c\u5168\u4e00\u81f4\u3002\n\n\u5982\u4f55\u627e\u5230 $i$\uff1f\u9996\u5148 $i$ \u4e00\u5b9a\u6ee1\u8db3 $p_{l+1,i}=1$\u3002\u8003\u8651\u8981\u4e48 $a_i=a_l$\uff0c\u8fd9\u79cd\u60c5\u51b5\u5bf9\u4e8e\u6bcf\u4e2a $a$ \u503c\u5f00\u4e00\u4e2a `set`\uff0c\u5b58\u653e $a_j=a_l$ \u4e14 $p_{l+1,j}=1$ \u7684\u6240\u6709 $j$\uff0c\u53d6 $a_l$ \u5bf9\u5e94\u7684 `set` \u4e2d\u7684\u6700\u5c0f\u503c\u5373\u4e3a $i$\uff1b\u53e6\u5916\u4e00\u79cd\u60c5\u51b5\u5c31\u662f $b_l\\leq b_i$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4 $p_{l+1,i}$ \u548c\u533a\u95f4\u4e2d\u6ee1\u8db3 $p_{l+1,i}=1$ \u7684\u6700\u5927 $b_i$\uff0c\u7684\u901a\u8fc7\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u627e\u5230 $i$\u3002\n\n\u5bf9\u4e8e\u4fee\u6539\uff0c\u9700\u8981\u5b9e\u73b0\u5355\u70b9\u4fee\u6539\u548c\u533a\u95f4\u63a8\u5e73\u3002\u8fd9\u91cc\u6709\u4e2a\u7279\u6b8a\u4e4b\u5904\uff0c\u4e00\u4e2a\u4f4d\u7f6e\u53ea\u4f1a\u88ab\u63d2\u5165\u4e00\u6b21\u548c\u63a8\u5e73\u4e00\u6b21\uff0c\u5982\u679c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7684\u8bdd\u63a8\u5e73\u4e0d\u9700\u8981\u61d2\u6807\u8bb0\uff0c\u66b4\u529b\u63a8\u5e73\u5373\u53ef\uff0c\u4e5f\u56e0\u4e3a\u8fd9\u4e2a\u6027\u8d28\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u7528\u73c2\u6735\u8389\u6811\u7ee7\u7eed\u7ef4\u62a4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f\u6b63\u786e\u7684\u3002\u63a8\u5e73\u7684\u65f6\u5019\u8981\u540c\u65f6\u4fee\u6539 `set`\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((n+q)\\log n)$\u3002\n\n```cpp\nstruct que{ int r,id; que(int r=0,int id=0):r(r),id(id) {}  };\nint n,q;\nint a[500005],b[500005],ans[500005];\nvector<que> m[500005];\nset<int> s[500005];\nstruct node{\n\tint l,r,mxb,sum; \n}t[500005<<2];\ninline void up(int x){ t[x].mxb=max(t[x<<1].mxb,t[x<<1|1].mxb); t[x].sum=t[x<<1].sum+t[x<<1|1].sum; }\nvoid build(int x,int l,int r){\n\tt[x].l=l,t[x].r=r;\n\tif(l==r) return;\n\tconst int mid=l+r>>1;\n\tbuild(x<<1,l,mid),build(x<<1|1,mid+1,r);\n}\nvoid insert(int x,const int id){\n\tif(t[x].l==t[x].r) return t[x].sum=1,t[x].mxb=b[id],void();\n\tconst int mid=t[x].l+t[x].r>>1; \n\tif(id<=mid) insert(x<<1,id);\n\telse insert(x<<1|1,id);\n\tup(x);\n}\nvoid assign(int x,const int sl,const int sr){\n\tif(sl>sr) return;\n\tif(t[x].l==t[x].r) return t[x].mxb=t[x].sum=0,s[a[t[x].l]].erase(t[x].l),void();\n\tconst int mid=t[x].l+t[x].r>>1; \n\tif(sl<=mid&&t[x<<1].sum) assign(x<<1,sl,sr);\n\tif(sr>mid&&t[x<<1|1].sum) assign(x<<1|1,sl,sr);\n\tup(x);\n}\nint bound(int x,const int k){\n\tif(t[x].l==t[x].r) return t[x].l;\n\tif(t[x<<1].mxb>=k) return bound(x<<1,k);\n\tif(t[x<<1|1].mxb>=k) return bound(x<<1|1,k);\n\treturn n+1;\n}\nint query(int x,const int sl,const int sr){\n\tif(sl<=t[x].l&&sr>=t[x].r) return t[x].sum;\n\tconst int mid=t[x].l+t[x].r>>1; int ret=0;\n\tif(sl<=mid) ret+=query(x<<1,sl,sr);\n\tif(sr>mid) ret+=query(x<<1|1,sl,sr);\n\treturn ret;\n}\nsigned main(){\n\t//system(\"fc stack4.out stack4.ans\");\n\tfile();\n  \tn=read(),q=read(); \n\tfor(rg int i=1;i<=n;++i) s[i].insert(n+1);\n  \tfor(rg int i=1;i<=n;++i) a[i]=read();\n  \tfor(rg int i=1;i<=n;++i) b[i]=read();\n  \tfor(rg int i=1,l,r;i<=q;++i) l=read(),r=read(),m[l].epb(que(r,i));\n  \tbuild(1,1,n);\n  \tfor(rg int i=n;i;--i){\n  \t\tconst int sr=min(bound(1,b[i]),*s[a[i]].begin());\n  \t\tassign(1,i+1,sr-1); insert(1,i); s[a[i]].insert(i);\n  \t\tfor(que j:m[i]) ans[j.id]=query(1,i,j.r);\n  \t}\n  \tfor(rg int i=1;i<=q;++i) printf(\"%d\\n\",ans[i]);\n  \treturn 0;\n}\n```\n",
        "postTime": 1648272859,
        "uid": 241977,
        "name": "Legitimity",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8251"
    },
    {
        "content": "### \u4e00\u4e9b\u626f\u6de1\n\u597d\u561b\uff0c\u8fd9\u9898\u76ee\u6211\u6123\u662f\u770b\u4e86\u534a\u5929\u6ca1\u770b\u51fa\u6765\u201c\u4e39\u9493\u6218\u201d\u3002\n\n\u9000\u5f79\u9009\u624b\uff0c\u4ece\u4e00\u4e9b\u5730\u65b9\u5ad6\u6765\u4e86\u9898\u9762\u548c\u6570\u636e\uff0c\u770b\u4e86\u770bT1\u3002\n\n### \u56de\u5f52\u6b63\u9898\n#### \u7b80\u8981\u53d9\u8ff0\n\u8fd9\u4e2a\u9898\u76ee\u6211\u53ef\u80fd\u505a\u6cd5\u8ddf\u5927\u5bb6\u7684\u4e0d\u592a\u4e00\u6837\uff08\uff1f\uff09\n\n\u9996\u5148\u5bf9\u4e8e\u8fd9**\u6574\u4e2a\u6570\u7ec4**\uff0c\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u53ef\u4ee5\u5f80\u524d\u4e00\u76f4\u5f39\u5230\u7b2c\u51e0\u4e2a\u4e8c\u5143\u7ec4\u7684\u524d\u9762\uff0c\u8fd9\u4e2a\u503c\u7528\u4e00\u4e2a\u6570\u7ec4 $f$ \u8bb0\u5f55\u4e0b\u6765\u3002\u5982\u679c\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u538b\u5165\u6808\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u628a\u4e4b\u524d\u6808\u91cc\u9762\u7684\u5168\u90e8\u5143\u7d20\u90fd\u5f39\u51fa\u6765\uff0c\u4e5f\u5c31\u662f\u6210\u4e3a\u4e00\u4e2a\u201c\u6210\u529f\u7684\u201d\u4e8c\u5143\u7ec4\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4ee4 $f_i=0$\n\n##### \u4e3e\u4e2a\u6817\u5b50\uff1a\n```\na[i]=3  1  3 1 2\nb[i]=10 10 2 9 7\nf[i]=0  0  2 0 4\n```\n##### \u89e3\u91ca\uff1a\n\u6211\u4eec\u628a $(3,10)$ \u538b\u5165\u6808\uff0c\u5b83\u524d\u9762\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c$f_1=0$\n\n\u6211\u4eec\u628a $(1,10)$ \u538b\u5165\u6808\uff0c\u7531\u4e8e $b_2=b_1=10$\uff0c$(3,10)$ \u5c31\u88ab\u5f39\u51fa\uff0c\u6b64\u65f6\u5b83\u524d\u9762\u5c31\u4e5f\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c$f_2=0$\n\n\u6211\u4eec\u628a $(3,2)$ \u538b\u5165\u6808\uff0c\u53d1\u73b0 $(1,10)$ \u6ee1\u8db3\u9898\u76ee\u7684\u6761\u4ef6\uff0c\u4e0d\u5fc5\u5f39\u51fa\uff0c\u6b64\u65f6 $(3,2)$ \u7684\u524d\u9762\u662f\u7b2c\u4e8c\u4e2a\u4e8c\u5143\u7ec4\uff0c$f_3=2$\n\n\u6211\u4eec\u628a $(1,9)$ \u538b\u5165\u6808\uff0c\u53d1\u73b0 $(1,10),(3,2)$ \u90fd\u8981\u5f39\u51fa\uff08\u7531\u4e8e\u9898\u76ee\u6761\u4ef6\uff09\uff0c\u6240\u4ee5\u6b64\u65f6 $(1,9)$ \u524d\u9762\u4e0d\u518d\u5269\u4e0b\u4efb\u4f55\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c$f_4=0$\n\n$f_5=4$ \u4e5f\u540c\u7406\n\n#### \u505a\u6cd5\n\u6709\u4e86\u8fd9\u4e2a $f$ \u6570\u7ec4\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee $l,r$ \uff0c\u6211\u4eec\u53ea\u9700\u8981\u6570\u4e00\u6570\u533a\u95f4 $[l,r]$ \u4e2d\u6709\u591a\u5c11\u4e2a $f_i$ \u662f\u6ee1\u8db3 $f_i<l$ \u7684\uff0c\u5982\u679c\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\uff0c\u4e5f\u5c31\u8bf4\u660e\u4e86\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u662f\u53ef\u4ee5\u6210\u4e3a\u4e00\u4e2a\u201c\u6210\u529f\u7684\u201d\u3002\\\n\u8fd9\u662f\u56e0\u4e3a\u80fd\u8ba9\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u201c\u4e0d\u6210\u529f\u201d\u7684\u4e8c\u5143\u7ec4\u662f\u7b2c $f_i$ \u4e2a\u4e8c\u5143\u7ec4\uff0c\u800c\u53c8\u56e0\u4e3a $f_i<l$\uff0c\u4e0d\u5728\u8be2\u95ee\u533a\u95f4\u5185\uff0c\u6240\u4ee5\u6ca1\u6709\u4e00\u4e2a\u4e8c\u5143\u7ec4\u80fd\u591f\u201c\u963b\u6321\u201d\u7b2c $i$ \u4e2a\u4e8c\u5143\u7ec4\u5728\u6b64\u6b21\u8be2\u95ee\u4e2d\u6210\u4e3a\u201c\u6210\u529f\u7684\u201d\u3002\n\n\u7136\u540e\u4e0d\u96be\u53d1\u73b0 $f$ \u6570\u7ec4\u53ef\u4ee5\u7ebf\u6027\u6c42\u5f97\uff0c\u7edf\u8ba1\u7b54\u6848\u7684\u8bdd\u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\u2014\u2014\u201c\u7edf\u8ba1\u8be2\u95ee\u533a\u95f4\u5185\u6709\u591a\u5c11\u4e2a\u6570\u5b57\u5c0f\u4e8e $x$ \u201d\uff0c\u6811\u72b6\u6570\u7ec4\u6c42\u89e3\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define F(i,l,r) for(register int i=l;i<=r;i++)\n#define D(i,r,l) for(register int i=r;i>=l;i--)\n#define ll long long\n#define mem(a,b) memset(a,b,sizeof(a))\n#define p_b push_back\n#define m_p make_pair\n#define il inline\n#define fi first\n#define se second\nconst int INF=0x7f7f7f7f,N=1e6+5;\nvoid rd(int &num) {\n    num=0;\n    int k=1;\n    char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-') ch=getchar();\n    if(ch=='-') k=-1,ch=getchar();\n    while(ch<='9'&&ch>='0') {\n        num=num*10+ch-'0';\n        ch=getchar();\n    }\n    num*=k;\n}\nint n,T;\nint a[N],b[N];\nstruct node {\n    int f,ind;\n}p[N];\nstruct query {\n    int l,r,ind;\n}q[N];\nbool cmp1(node x,node y) {return x.f<y.f;}\nbool cmp2(query x,query y) {return x.l<y.l;}\nint sum[N],ans[N];\nil int lbt(int x) {return x&(-x);}\nil void add(int p) {\n    while(p<=n) {\n        sum[p]+=1;\n        p+=lbt(p);\n    }\n    return;\n}\nil int ask(int p) {\n    int res=0;\n    while(p>0) {\n        res+=sum[p];\n        p-=lbt(p);\n    }\n    return res;\n}\nint main() {\n    // freopen(\"stack.in\",\"r\",stdin);\n    // freopen(\"stack.out\",\"w\",stdout);\n    rd(n),rd(T);\n    F(i,1,n) rd(a[i]);\n    F(i,1,n) rd(b[i]);\n    F(i,2,n) {\n        int pos=i-1;\n        while(pos) {\n            if(a[i]==a[pos]||b[i]>=b[pos]) pos=p[pos].f;\n            else break;\n        }\n        p[i].f=pos;\n        p[i].ind=i;\n    }\n    p[1].ind=1;\n    // F(i,1,n) printf(\"%d \",p[i].f);puts(\"\");\n    sort(p+1,p+1+n,cmp1);\n    F(i,1,T) {\n        rd(q[i].l),rd(q[i].r);\n        q[i].ind=i;\n    }\n    sort(q+1,q+1+T,cmp2);\n    // F(i,1,n) printf(\"%d \",p[i].f);\n    int po=1;\n    F(i,1,T) {\n        while(p[po].f<q[i].l&&po<=n) {\n            add(p[po].ind);po++;\n        }\n        ans[q[i].ind]=ask(q[i].r)-ask(q[i].l-1);\n    }\n    F(i,1,T) printf(\"%d\\n\",ans[i]);\n    return 0;\n}\n```\n~~\uff08\u7801\u98ce\u5e94\u8be5\u8fd8\u884c\u5427\uff09~~\n\n~~(\u7ed9\u4e2a\u8d5e\u5427)~~",
        "postTime": 1648272438,
        "uid": 117648,
        "name": "tuzhewen",
        "ccfLevel": 5,
        "title": "P8251 \u9898\u89e3"
    },
    {
        "content": "\u548c\u4e4b\u524d\u7684\u9898\u76ee\u5dee\u4e0d\u591a\u7c7b\u578b\u3002\u6211\u4e3b\u8981\u8bb2\u4e00\u4e0b\u6211\u8d5b\u65f6\u662f\u600e\u4e48\u505a\u51fa\u6765\u7684\u3002\n\n## \u89e3\u9898\u601d\u8def\n\n### 1. \u6309\u7167\u5f80\u5e74\u7684\u9898\u76ee\u53d1\u73b0\u5e94\u8be5\u8981\u679a\u4e3e\u5de6\u754c $l$\n\u5b9e\u9645\u4e0a\u5f53 $l$ \u786e\u5b9a\u4ee5\u540e\uff0c\u6210\u529f\u7684\u6570\u7ec4\u548c $r$ \u65e0\u5173\u3002\u76f4\u63a5\u524d\u7f00\u548c\u4f18\u5316\u5373\u53ef\u3002\n\n### 2. \u53d1\u73b0\u5b9e\u9645\u4e0a $a$ \u6570\u7ec4\u80fd\u6539\u53d8\u7684\u4e1c\u897f\u5f88\u5c11\uff0c\u5e72\u8106\u4e0d\u8003\u8651\n\n\u4e0d\u8003\u8651 $a$ \u6570\u7ec4\u4ee5\u540e\uff0c\u4e3a\u9898\u5c31\u53d8\u6210\u4e86\u6709\u591a\u5c11\u4e2a $i$ \u4f7f\u5f97 $\\min_{j=l}^i a_j=a_i$\u3002\u5b9e\u9645\u4e0a\u6211\u4eec\u628a $a$ \u6570\u7ec4\u7406\u89e3\u6210\u4e00\u5ea7\u5ea7\u5c71\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u6709\u591a\u5c11\u4e2a\u70b9\u53ef\u4ee5\u770b\u5230 $l$ \u8fd9\u4e2a\u4f4d\u7f6e\u3002\n\n\u6211\u4eec\u5047\u8bbe $las_i$ \u8868\u793a\u7b2c\u4e00\u4e2a $j>i$ \u4f7f\u5f97 $a_j>a_i$\u3002\u90a3\u4e48\u6700\u7ec8\u6240\u6709\u7684\u53ef\u4ee5\u770b\u5230 $l$ \u4f4d\u7f6e\u7684 $i$ \u5b9e\u9645\u4e0a\u662f $i,las_i,las_{las_i},\\dots$\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u7406\u89e3\u6210\u4e3a\u201c\u94fe $i$\u201d\u3002\n\n\u73b0\u5728\u8003\u8651\u5982\u4f55\u4ece $l$ \u8f6c\u79fb\u5230 $l+1$\u3002\n\n\u7ecf\u8fc7\u7b80\u5355\u7684\u679a\u4e3e\u53ef\u4ee5\u53d1\u73b0\u201c\u94fe $l$\u201d\u548c\u201c\u94fe $l+1$\u201d\u5982\u679c\u5728\u67d0\u5904\u91cd\u5408\u4e86\uff0c\u90a3\u4e48\u540e\u9762\u4e5f\u4f1a\u91cd\u5408\u3002\n\n\u6240\u4ee5\u5f53 $l$ \u8f6c\u79fb\u5230 $l+1$ \u7684\u65f6\u5019\u53ea\u8981\u628a\u6240\u6709\u591a\u51fa\u6765\u7684\u201c\u6210\u529f\u4e8c\u5143\u7ec4\u201d\u4e22\u8fdb\u53bb\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\n\n### 3. \u91cd\u65b0\u8003\u8651 $a$ \u6570\u7ec4\uff0c\u4e71\u641e\u51fa\u6b63\u89e3\n\n\u6839\u636e\u524d\u9762\u7684\u7ecf\u9a8c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u91cd\u65b0\u6539\u9020 $a$ \u6570\u7ec4\u7684\u610f\u4e49\u3002\n\n$las_i$ \u6570\u7ec4\u672c\u8d28\u4e0a\u5c31\u662f $i$ \u5728\u6808\u5c3e\uff0c\u7b2c\u4e00\u4e2a\u4e22\u6389\u5b83\u7684\u5143\u7d20\u3002\u90a3\u6211\u4eec\u540c\u6837\u5730\u6784\u9020\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\u968f\u4fbf\u8bd5\u4e86\u4e00\u4e0b\u6362 $las$ \u7684\u63a8\u5bfc\u516c\u5f0f\uff0c\u76f4\u63a5\u51fa\u6765\u6b63\u89e3\n\n## \u53c2\u8003\u4ee3\u7801\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\nusing namespace std;\nconst int MAXN=5e5+5;\nint n,m;\nint a[MAXN];\nint b[MAXN];\nint las[MAXN];bool flag[MAXN];\nint st[MAXN];int cnt=0;\nint tree[MAXN];\nstruct ask{\n\tint l,r,id;\n}q[MAXN];\nint ans[MAXN];\nbool cmp(ask x,ask y){\n\treturn x.l<y.l;\n}\nint lowbit(int x){\n\treturn ((-x)&x);\n}\nvoid update(int x,int k){\n\twhile(x<=n){\n\t\ttree[x]+=k;\n\t\tx+=lowbit(x);\n\t}\n\treturn;\n}\nint query(int x){\n\tint r=0;\n\twhile(x){\n\t\tr+=tree[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn r;\n}\ninline int read(){\n\tint re=0;char ch=getchar();\n\twhile(ch>'9'||ch<'0') ch=getchar();\n\twhile(ch>='0'&&ch<='9') re=10*re+ch-'0',ch=getchar();\n\treturn re;\n}\nint main(){\n\t//freopen(\"stack.in\",\"r\",stdin);\n\t//freopen(\"stack.out\",\"w\",stdout);\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read();\n\tfor(int i=1;i<=n;i++)\n\t\tb[i]=read();\n\tfor(int i=1;i<=m;i++)\n\t\tq[i].l=read(),q[i].r=read(),q[i].id=i;\n\tsort(q+1,q+m+1,cmp);\n\tfor(int i=n;i>=1;i--){\n\t\twhile((b[st[cnt]]<b[i]&&a[i]!=a[st[cnt]])&&cnt>0) cnt--;\n\t\tlas[i]=st[cnt];\n\t\tst[++cnt]=i;\n\t}\n\tint k=0;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=i;j;j=las[j])\n\t\t\tif(!flag[j]){\n\t\t\t\tflag[j]=true;\n\t\t\t\tupdate(j,1);\n\t\t\t}\n        else break;//\u4e00\u5b9a\u4e00\u5b9a\u8981\u8bb0\u5f97break!!!!!!!\n\t\twhile(k<m&&q[k+1].l==i){\n\t\t\tk++;\n\t\t\tans[q[k].id]=query(q[k].r)-query(q[k].l-1);\n\t\t}\n\t}\n\tfor(int i=1;i<=m;i++)\n\t\tprintf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n\n## Upd 2022.3.30\n\n\u6e90\u4ee3\u7801\u5f53\u4e2d\u5c11\u4e86\u4e00\u4e2a `else break;` \u76f4\u63a5\u6302\u6389\u4e86 $45pts$\u3002\n\n\u8b66\u9192\u540e\u4eba\uff01",
        "postTime": 1648273300,
        "uid": 248400,
        "name": "Inaba_Meguru",
        "ccfLevel": 7,
        "title": "[NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218 \u9898\u89e3"
    },
    {
        "content": "\u7b80\u8981\u9898\u610f\uff1a\u7ed9\u4f60\u4e00\u4e32\u4e8c\u5143\u7ec4\u3002\u6709\u4e00\u4e2a\u6808\uff0c\u521d\u59cb\u4e3a\u7a7a\uff0c\u5c06\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5165\u6808\u524d\u4f1a\u4e0d\u65ad\u5c06\u6808\u9876\u51fa\u6808\u76f4\u5230\u6808\u7a7a\u6216\u8005\u6808\u9876\u548c\u5c06\u5165\u6808\u7684\u4e8c\u5143\u7ec4\u6ee1\u8db3\u67d0\u5173\u7cfb\u3002\u6bcf\u6b21\u8be2\u95ee\u7ed9\u5b9a\u4e00\u4e2a\u533a\u95f4\uff0c\u95ee\u5c06\u8fd9\u4e2a\u533a\u95f4\u7684\u4e8c\u5143\u7ec4\u4f9d\u6b21\u5165\u6808\u65f6\uff0c\u6709\u591a\u5c11\u4e2a\u4e8c\u5143\u7ec4\u5165\u6808\u524d\u4f1a\u628a\u6808\u5f39\u7a7a\u3002\n\n\u5206\u6790\uff1a\u8bc8\u9a97\u9898\uff0c\u90a3\u4e2a\u5173\u7cfb\u662f\u4ec0\u4e48\u5b8c\u5168\u4e0d\u91cd\u8981\u3002\n\n\u5bb9\u6613\u6ce8\u610f\u5230\uff0c\u5728\u67d0\u4e2a\u4e8c\u5143\u7ec4\u51fa\u6808\u524d\uff0c\u6808\u5185\u5728\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u4ee5\u540e\u7684\u90e8\u5206\uff0c\u4e0e\u4ece\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u5f00\u59cb\u5165\u6808\u7684\u7ed3\u679c\u662f\u4e00\u6837\u7684\u3002\u4ece\u800c\uff0c\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u80fd\u5f39\u51fa\u5230\u54ea\u4e9b\u4e8c\u5143\u7ec4\u4e0d\u53d7\u4ece\u54ea\u4e2a\u4e8c\u5143\u7ec4\u5f00\u59cb\u5165\u6808\u5f71\u54cd\u3002\n\n\u56e0\u6b64\uff0c\u5148\u4ece\u5934\u6a21\u62df\u4e00\u904d\u5165\u6808\u64cd\u4f5c\uff0c\u7136\u540e\u8bb0\u5f55\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u771f\u6b63\u5165\u6808\u524d\u6808\u9876\u7684\u7f16\u53f7\uff0c\u90a3\u4e48\u6bd4\u8fd9\u4e2a\u7f16\u53f7\u5927\u7684\u5168\u90fd\u53ef\u4ee5\u88ab\u8fd9\u4e2a\u4e8c\u5143\u7ec4\u6216\u8005\u66f4\u4e4b\u524d\u7684\u4e8c\u5143\u7ec4\u5f39\u51fa\u3002\u8bb0\u7b2c $k$ \u4e2a\u4e8c\u5143\u7ec4\u53ef\u4ee5\u5f39\u51fa $L_k,L_k+1,\\cdots,k-2,k-1$\u3002\n\n\u90a3\u4e48\uff0c\u6bcf\u4e2a\u8be2\u95ee $l,r$ \u76f8\u5f53\u4e8e\u95ee $\\sum\\limits_{i=l}^r[L_i\\le l]$\u3002\u5bb9\u6613\u60f3\u5230\u79bb\u7ebf\u8be2\u95ee\u6216\u8005\u4f7f\u7528\u53ef\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784\uff0c\u7136\u540e\u6309 $L_i$ \u4ece\u5c0f\u5230\u5927\u4fee\u6539\u518d\u533a\u95f4\u67e5\u8be2\u3002\n\n\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n[\u53c2\u8003\u4ee3\u7801\uff1a\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811](https://www.luogu.com.cn/paste/ceg7fvsv)",
        "postTime": 1648272946,
        "uid": 130151,
        "name": "WYXkk",
        "ccfLevel": 9,
        "title": "P8251 \u4e39\u9493\u6218 \u9898\u89e3"
    },
    {
        "content": "## \u4e39\u9493\u6218   \u9898\u89e3\u62a5\u544a\n\n\u770b\u5230\u8fd9\u79cd $Q$ \u6b21\u8be2\u95ee\u533a\u95f4\u7684\u9898\uff0c\u4e0d\u96be\u5f80 $O(n)$ \u9884\u5904\u7406 $O(logn)$ \u67e5\u8be2\u60f3\u3002\n\n\u53ef\u4ee5\u60f3\u5230\u76f4\u63a5\u505a\u4e00\u6b21 $1\\sim n$ \u306e \u5355\u8c03\u6808\uff0c\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u70b9**\u5165\u6808\u524d\u7684\u6808\u9876** $l_i$\u3002\n\n\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\u5462\uff1f\n\n\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9 $i$\uff0c\u53ea\u6709\u5728\u8be2\u95ee $l\\sim r$ \u6ee1\u8db3 $l>l_i \\wedge i\\le r$ \u65f6\uff0c$i$ \u624d\u4f1a\u4ea7\u751f $1$ \u7684\u8d21\u732e\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u8be2\u95ee $l\\sim r$ \u7684\u7b54\u6848\u4e3a\n\n$$ans=\\sum_{i=1}^{r} [l_i < l \\le i]$$\n\n\u89c2\u5bdf\u5230\u7b97\u5f0f\u91cc\u6709 $\\sum_{i=1}^{r}$ \u8fd9\u4e2a\u5f0f\u5b50\uff0c\u53ef\u4ee5\u8003\u8651**\u79bb\u7ebf**\u6240\u6709\u8be2\u95ee\uff0c\u6309\u7167 $r$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\n\n\u7136\u540e\u5f00\u4e00\u4e2a**\u503c\u57df** $t$ \u7edf\u8ba1\u6bcf\u4e2a\u503c\u88ab\u591a\u5c11\u4e2a\u533a\u95f4\u8986\u76d6\uff0c\u5373**\u533a\u95f4\u52a0**\u3002\n\n\u60f3\u5230\u8fd9\u91cc\uff0c\u5c31\u81ea\u7136\u4f1a\u60f3\u5230**\u6811\u72b6\u6570\u7ec4**+**\u5dee\u5206**\u7684\u505a\u6cd5\uff0c\u5bf9\u4e8e\u533a\u95f4\u52a0 $l_i+1\\sim i$ \u8f6c\u5316\u4e3a $t[l_i+1]+1$\uff0c$t[i+1]-1$\uff0c\u6700\u540e\u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define lb(x) (x&(-x))\nusing namespace std;\nconst int N=5e5+10;\nint n,Q,a[N],b[N],ans[N];\nstruct Question{\n\tint l,r,id;\n}q[N];\ninline bool cmp(Question a,Question b){\n\treturn a.r==b.r?a.l<b.l:a.r<b.r;\n}\nstack<int>st;\nint l[N];\nint tree[N<<1];\ninline void add(int x,int k){\n\twhile(x<=n){\n\t\ttree[x]+=k;\n\t\tx+=lb(x);\n\t}\n}\ninline int query(int x){\n\tint res=0;\n\twhile(x){\n\t\tres+=tree[x];\n\t\tx-=lb(x);\n\t}\n\treturn res;\n}\nint main(){\n//\tfreopen(\"stack.in\",\"r\",stdin);\n//\tfreopen(\"stack.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&Q);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",a+i);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",b+i);\n\tfor(int i=1;i<=Q;i++)scanf(\"%d%d\",&q[i].l,&q[i].r),q[i].id=i;\n\tsort(q+1,q+Q+1,cmp);\n\tfor(int i=1;i<=n;i++){\n\t\twhile(!st.empty()&&(a[st.top()]==a[i]||b[st.top()]<=b[i]))st.pop();\n\t\tif(st.empty())l[i]=1;\n\t\telse l[i]=st.top()+1;\n\t\tst.push(i);\n\t}\n\tint lst=0;\n\tfor(int i=1;i<=Q;i++){\n\t\twhile(lst<q[i].r){\n\t\t\tlst++;\n\t\t\tadd(l[lst],1);\n\t\t\tadd(lst+1,-1);\n\t\t}\n\t\tans[q[i].id]=query(q[i].l);\n\t}\n\tfor(int i=1;i<=Q;i++)printf(\"%d\\n\",ans[i]);\n//\tfclose(stdin);\n//\tfclose(stdout);\n\treturn 0;\n}\n```\n",
        "postTime": 1648272682,
        "uid": 390742,
        "name": "qwqUwU",
        "ccfLevel": 7,
        "title": "\u4e39\u9493\u6218"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/P8251)\u3002\n\n### \u601d\u8def\n\n\u7531\u4e8e\u4e8c\u5143\u7ec4\u4ee5\u4ece\u5de6\u5230\u53f3\u987a\u5e8f\u5165\u6808\uff0c\u6240\u4ee5\u5982\u679c\u4ece\u5934\u5f00\u59cb\u5165\u6808\u4e14\u5143\u7d20 $x$ \u5728\u63d2\u5165\u5143\u7d20 $y$ \u65f6\u88ab\u5f39\u51fa\u6808\uff0c\u90a3\u4e48\u4ece $x$ \u524d\u7684\u4efb\u4f55\u4e00\u4e2a\u5143\u7d20\u4e3a\u8d77\u70b9\u5165\u6808\uff0c$x$ \u90fd\u4f1a\u5728\u63d2\u5165 $y$ \u65f6\u88ab\u5f39\u51fa\u3002\n\n\u672c\u9898\u6240\u8981\u6c42\u7684\u662f\u5728\u6309\u7ed9\u5b9a\u533a\u95f4\u63d2\u5165\u5143\u7d20\uff0c\u80fd\u628a\u6808\u5f39\u7a7a\u7684\u5143\u7d20\u6570\u91cf\uff0c\u5219\u8003\u8651\u4e00\u4e2a\u4e0b\u6807 $x$ \u7684\u5143\u7d20\uff0c\u5f53\u5176\u4e3a\u5408\u6cd5\u7684\u7b54\u6848\u65f6\u4ec5\u5f53 $[L,x-1]$ \u90fd\u5df2\u7ecf\u88ab\u5f39\u51fa\u3002\u8bbe\u4ece\u5934\u5f00\u59cb\u5165\u6808\uff0c\u5143\u7d20 $x$ \u5165\u6808\u65f6\u7684\u6808\u9876\u5143\u7d20\u4e0b\u6807\u4e3a $last$\uff0c\u5219\u6839\u636e\u521a\u624d\u7684\u7ed3\u8bba\uff0c\u5982\u679c\u5f53\u524d\u8be2\u95ee\u7684 $L$ \u5728 $[last+1,x-1]$ \u4e4b\u95f4\uff0c\u5143\u7d20 $x$ \u5c31\u662f\u8be5\u8be2\u95ee\u7684\u4e00\u4e2a\u5408\u6cd5\u7b54\u6848\u3002\u56e0\u4e3a\u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u6240\u6709\u5143\u7d20\u90fd\u4f1a\u5728\u63d2\u5165 $x$ \u4e4b\u524d\u88ab\u5f39\u51fa\u6808\uff0c\u800c\u6700\u8fd1\u7684\u4e00\u4e2a\u4e0d\u4f1a\u88ab\u5f39\u51fa\u7684\u5143\u7d20 $last$ \u5728\u8be5\u8be2\u95ee\u4e2d\u672a\u66fe\u5165\u6808\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5148\u7528\u5355\u8c03\u6808\u8dd1\u4e00\u904d\u6574\u4e2a\u4e8c\u5143\u7ec4\u5e8f\u5217\uff0c\u5f97\u5230\u6bcf\u4e00\u4e2a\u5143\u7d20 $x$ \u7684\u5bf9\u5e94 $last_x$\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee $[L,R]$\uff0c\u76f8\u5f53\u4e8e\u6c42\u6ee1\u8db3 $last_x < L$ \u4e14 $L \\leq x \\leq R$ \u7684\u5143\u7d20 $x$ \u6570\u91cf\u3002\n\n\u53ef\u4ee5\u5bf9\u8be2\u95ee\u79bb\u7ebf\uff0c\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u5b9e\u73b0\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nconst int Nx=500010;\nint N,Q,A[Nx],B[Nx],con[Nx],lst[Nx],L[Nx],R[Nx],idx[Nx],ans[Nx];\nbool cmp_c(int x,int y){return lst[x]<lst[y];}\nbool cmp_i(int x,int y){return L[x]<L[y];}\nint sta[Nx],top,bit[Nx];\nvoid upd(int x,int delta)\n{\n\twhile(x<Nx)\n\t\tbit[x]+=delta,x+=x&-x;\n}\nint query(int x)\n{\n\tint ret=0;\n\twhile(x)\n\t\tret+=bit[x],x-=x&-x;\n\treturn ret;\n}\nint main()\n{\n\tscanf(\"%d%d\",&N,&Q);\n\tint i,j,k;\n\tfor(i=1;i<=N;i++)\n\t\tscanf(\"%d\",&A[i]);\n\tfor(i=1;i<=N;i++)\n\t\tscanf(\"%d\",&B[i]);\n\tfor(i=1;i<=Q;i++)\n\t{\n\t\tscanf(\"%d%d\",&L[i],&R[i]);\n\t\tidx[i]=i;\n\t}\n\tfor(i=1;i<=N;i++)\n\t{\n\t\tcon[i]=i;\n\t\twhile(top>0&&B[i]>=B[sta[top]])\n\t\t\ttop--;\n\t\twhile(top>0&&A[i]==A[sta[top]])\n\t\t\ttop--;\n\t\tlst[i]=sta[top];\n\t\tsta[++top]=i;\n\t}\n\tstd::sort(idx+1,idx+Q+1,cmp_i);\n\tstd::sort(con+1,con+N+1,cmp_c);\n\tj=1;k=1;\n\tfor(i=0;i<=N;i++)\n\t{\n\t\twhile(lst[con[j]]==i)\n\t\t\tupd(con[j],1),j++;\n\t\twhile(L[idx[k]]==i+1)\n\t\t\tans[idx[k]]=query(R[idx[k]])-query(L[idx[k]]-1),k++;\n\t}\n\tfor(i=1;i<=Q;i++)\n\t\tprintf(\"%d\\n\",ans[i]);\n}\n```\n",
        "postTime": 1648267657,
        "uid": 291481,
        "name": "novax",
        "ccfLevel": 7,
        "title": "[NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218"
    },
    {
        "content": "# P8251 \u9898\u89e3\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217\u548c\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u95ee\u5f53\u9700\u8981\u987a\u5e8f\u63d2\u5165\u5e8f\u5217\u4e2d\u4e00\u6bb5\u533a\u95f4\u4e2d\u7684\u5143\u7d20\u65f6\uff0c\u5728\u591a\u5c11\u4e2a\u5143\u7d20\u63d2\u5165\u540e\uff0c\u5355\u8c03\u6808\u4e2d\u53ea\u5269\u8fd9\u4e00\u4e2a\u5143\u7d20\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u6ce8\u610f\u5230\u6bcf\u6b21\u90fd\u662f\u6309\u4e00\u4e2a\u56fa\u5b9a\u7684\u987a\u5e8f\u63d2\u5165\u67d0\u4e00\u6bb5\u5143\u7d20\u7684\u3002\n\n\u6240\u4ee5\u8bf4\u65e0\u8bba\u63d2\u5165\u7684\u662f\u54ea\u4e00\u6bb5\u533a\u95f4\uff0c\u5bf9\u4e8e\u67d0\u4e2a\u5143\u7d20\u6765\u8bf4\uff0c\u6700\u540e\u90fd\u4e00\u5b9a\u662f\u4e00\u4e2a\u56fa\u5b9a\u7684\u5143\u7d20\u628a\u8fd9\u4e2a\u5143\u7d20\u5f39\u51fa\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5148\u6a21\u62df\u4e00\u904d\u5355\u8c03\u6808\u6c42\u51fa\u6bcf\u4e2a\u5143\u7d20\u88ab\u54ea\u4e2a\u5143\u7d20\u5f39\u51fa\uff0c\u8bb0\u4e3a $f_i$\u3002\n\n\u518d\u5206\u6790\u4e00\u4e0b\u6bcf\u4e2a\u95ee\u9898\u3002\n\n\u9996\u5148\u63d2\u5165\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u663e\u7136\u6b64\u65f6\u5355\u8c03\u6808\u4e2d\u53ea\u6709\u8fd9\u4e00\u4e2a\u5143\u7d20\uff0c$ans++$\u3002\n\n\u73b0\u5728\u8fd9\u4e2a\u5143\u7d20\u5728\u6808\u5e95\uff0c\u6240\u4ee5\u8bf4\u5982\u679c\u6709\u5176\u4ed6\u5143\u7d20\u60f3\u5230\u8fbe\u6808\u5e95\uff0c\u5c31\u5fc5\u987b\u5148\u628a\u5b83\u5f39\u51fa\uff0c\u8fd9\u4e2a\u6211\u4eec\u5df2\u7ecf\u6c42\u8fc7\u4e86\uff0c\u80fd\u591f\u628a\u5b83\u5f39\u51fa\u7684\u90a3\u4e2a\u5143\u7d20\u662f $f_i$\u3002\n\n\u5f39\u51fa\u6808\u5e95\u540e\uff0c\u8fd8\u8981\u52a0\u5165\u5143\u7d20 $f_i$\uff0c\u6240\u4ee5\u6b64\u65f6\u5355\u8c03\u6808\u4e2d\u53ea\u6709\u4e00\u4e2a $f_i$\uff0c$ans++$\u3002\n\n\u63a5\u4e0b\u6765\u8fd8\u662f\u4e00\u6837\uff0c\u8981\u627e\u5230\u4e0b\u4e00\u4e2a\u80fd\u628a\u6808\u5e95\u5f39\u51fa\u7684\u6570\uff0c\u5373 $f_{f_i}$\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2a\u80fd\u628a\u6808\u5e95\u5f39\u51fa\u7684\u6570\u8d85\u51fa\u4e86 $r$\u3002\n\n\u6b64\u65f6\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\uff0c\u4ece $l$ \u5f00\u59cb\u6cbf $f$ \u6570\u7ec4\u5f80\u540e\u8df3\uff0c\u95ee\u8df3\u51e0\u4e2a\u6570\u4f1a\u8d85\u51fa $r$\u3002\n\n\u8fd9\u663e\u7136\u662f\u500d\u589e\u677f\u5b50\u3002\n\n\u8bb0 $f_{i,j}$ \u4e3a\u4ece $i$ \u5f00\u59cb\u5f80\u540e\u8df3 $2^j$ \u6b21\u80fd\u5230\u8fbe\u54ea\u4e2a\u5143\u7d20\u3002\n\n\u76f4\u63a5\u7528\u500d\u589e\u6c42\u51fa\u8df3\u591a\u5c11\u6b21\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u8bb0\u5f97\u52a0\u5feb\u8bfb\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<cstdio>\nusing namespace std;\nint read()\n{\n\tint x=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9')ch=getchar();\n\twhile(ch>='0'&&ch<='9')x=x*10+ch-'0',ch=getchar();\n\treturn x;\n}\nvoid write(int x)\n{\n\tif(x>9)write(x/10);\n\tputchar(x%10+'0');\n}\nint n,q;\nint a[500001],b[500001];\nint sa[500001],sb[500001],sid[500001],top;//\u5355\u8c03\u6808\nint f[500002][20];//\u500d\u589e\u6570\u7ec4\nint main()\n{\n\tn=read(),q=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<=n;i++)b[i]=read();\n\tfor(int i=1;i<=n;i++)//\u6a21\u62df\u5355\u8c03\u6808\uff0c\u6c42\u6bcf\u4e2a\u5143\u7d20\u88ab\u54ea\u4e2a\u5143\u7d20\u5f39\u51fa\n\t{\n\t\twhile(top&&(sa[top]==a[i]||sb[top]<=b[i]))\n\t\t\tf[sid[top--]][0]=i;\n\t\ttop++,sa[top]=a[i],sb[top]=b[i],sid[top]=i;\n\t}\n\twhile(top)f[sid[top--]][0]=n+1;\n//\u6c42\u500d\u589e\u6570\u7ec4\n\tfor(int i=0;i<20;i++)\n\t\tf[n+1][i]=n+1;\n\tfor(int i=1;i<20;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tf[j][i]=f[f[j][i-1]][i-1];\n\twhile(q--)\n\t{\n\t\tint l=read(),r=read(),ans=1;\n\t\tfor(int i=19;i>=0;i--)\n\t\t\tif(f[l][i]<=r)\n\t\t\t\tans+=1<<i,l=f[l][i];\n\t\twrite(ans);\n\t\tputs(\"\");\n\t}\n\treturn 0;\n}\n```\n\n\u8c22\u8c22\u89c2\u770b\uff01",
        "postTime": 1648273313,
        "uid": 241520,
        "name": "fanglong",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P8251\u3010[NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218\uff08\u6c11\u95f4\u6570\u636e\uff09\u3011"
    },
    {
        "content": "\u5bf9\u4e8e\u4e00\u4e2a\u5143\u7d20 $(a_i,b_i)$\uff0c\u5982\u679c\u7ee7\u7eed\u987a\u6b21\u52a0\u5165\u5143\u7d20\u76f4\u5230\u52a0\u5165 $(a_j,b_j)$ \u5bfc\u81f4\u81ea\u5df1\u88ab\u5f39\u51fa\uff0c\u90a3\u4e48\u5c31\u8fde\u8fb9 $i \\to j$\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u90a3\u5c31 $i \\to n+1$\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\uff0c\u7ed3\u5408\u9898\u76ee\u8003\u8651\u4e00\u6761\u8fb9\u7684\u5b9e\u9645\u610f\u4e49\u3002\u5047\u8bbe\u6211\u4eec\u4ece $(a_l,b_l)$ \u5f00\u59cb\u52a0\uff0c\u5728\u52a0\u5165 $(a_p,b_p)$ \u7684\u65f6\u5019\u88ab\u5f39\u51fa\uff08\u610f\u5473\u7740\u8fb9 $l \\to p$\uff09\uff0c\u53ef\u4ee5\u77e5\u9053 $l,p$ \u90fd\u4f1a\u5bf9\u7b54\u6848\u9020\u6210\u8d21\u732e\u3002\u76f4\u5230\u52a0\u5165\u5b8c $[l,r]$ \u5185\u7684\u6240\u6709\u5143\u7d20\u540e\uff0c$(a_q,b_q)$ \u7559\u5728\u6808\u5e95\uff0c\u8fd8\u4f1a\u9020\u6210\u4e00\u70b9\u8d21\u732e\u3002\n\n\u90a3\u4e48\u4e0d\u96be\u53d1\u73b0\uff0c\u4ece $l$ \u5f00\u59cb\u8df3\u7236\u8fb9\u76f4\u5230\u8df3\u5230\u7684\u70b9\u7f16\u53f7\u5927\u4e8e $r$ \u7684\u8df3\u8dc3\u6b21\u6570\u5c31\u662f\u7b54\u6848\u3002\n\n\u8fd8\u6709\u95ee\u9898\u662f\uff0c\u600e\u4e48\u5efa\u7236\u8fb9\u624d\u80fd\u4fdd\u8bc1\u6b63\u786e\uff1f\n\n\u7b54\u6848\u662f\u4ece $1$ \u5f00\u59cb\u7528\u5355\u8c03\u6808\u6839\u636e\u9898\u610f\u6a21\u62df\u5373\u53ef\u3002\u5728\u505a $[l,r]$ \u7684\u65f6\u5019\uff0c\u52a0\u5165 $[l+1,p-1]$ \u4e5f\u4e0d\u4f1a\u4f7f $l$ \u5f39\u51fa\uff0c\u5728\u5b9e\u9645\u4e0a\u662f\u548c\u4ece $1$ \u5f00\u59cb\u76f8\u540c\u7684\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u76f4\u63a5\u500d\u589e\u4e86\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n```cpp\nint n,q;\nint a[500005],b[500005],top,stk[500005],fa[20][500005];\nbool cmp(int x,int y)\n{\n\tif((a[x]^a[y]) && b[x]<b[y])\treturn true;\n\treturn false;\n}\nint main(){\n\tn=read(),q=read();\n\tfor(int i=1;i<=n;++i)\ta[i]=read();\n\tfor(int i=1;i<=n;++i)\tb[i]=read();\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\twhile(top && !cmp(i,stk[top]))\tfa[0][stk[top]]=i,--top;\n\t\tstk[++top]=i;\n\t}\n\tfor(int i=1;i<=n;++i)\tif(!fa[0][i])\tfa[0][i]=n+1;\n\tfor(int i=0;i<=19;++i)\tfa[i][n+1]=n+1;\n\tfor(int i=1;i<=19;++i)\tfor(int j=1;j<=n;++j)\tfa[i][j]=fa[i-1][fa[i-1][j]];\n\twhile(q-->0)\n\t{\n\t\tint l=read(),r=read();\n\t\tint ans=0,u=l;\n\t\tfor(int i=19;~i;--i)\tif(fa[i][u]<=r)\tans|=(1<<i),u=fa[i][u];\n\t\t++ans;\n\t\twrite(ans),puts(\"\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1648272207,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u4e39\u9493\u6218"
    },
    {
        "content": "**\u5b9a\u4e491\uff1a** $(a_j,b_j)$ \u662f $(a_i,b_i)$ \u7684**\u5bbf\u654c**\u5f53\u4e14\u4ec5\u5f53 $\\forall l\\le j,r\\ge l$ \uff0c\u4e8c\u5143\u7ec4 $(a_i,b_i)$ \u4e0d\u662f\u201c\u6210\u529f\u7684\u201d\u3002\u4e3a\u4e86\u65b9\u4fbf\u8ba8\u8bba\uff0c\u89c4\u5b9a $(a_0,b_0)$ \u662f\u4e00\u5207\u4e8c\u5143\u7ec4\u7684\u5bbf\u654c\u3002\n\n**\u5b9a\u4e492\uff1a** $(a_j,b_j)$ \u662f $(a_i,b_i)$ \u7684**\u6700\u8fd1\u5bbf\u654c**\u5f53\u4e14\u4ec5\u5f53 $j$ \u662f\u6ee1\u8db3 $(a_j,b_j)$ \u662f $(a_i,b_i)$ \u7684\u5bbf\u654c\u7684\u6700\u5927\u7684 $j$\u3002\n\n\u8bb0 $f(i)$ \u4e3a $(a_i,b_i)$ \u7684\u6700\u8fd1\u5bbf\u654c\u7684\u4e0b\u6807\u3002\n\n\u7531\u5b9a\u4e49\u663e\u7136\uff1a $(a_i,b_i)$ \u662f\u201c\u6210\u529f\u7684\u201d \u5f53\u4e14\u4ec5\u5f53 $f(i)\\lt l\\le i,r\\ge i$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u6a21\u62df\u4e00\u6b21\u5165\u6808\u3001\u5f39\u6808\u7684\u8fc7\u7a0b\uff0c\u90a3\u4e48\u5f53 $(a_i,b_i)$ \u5165\u6808\u65f6\uff0c\u6808\u9876\u5143\u7d20\u5373\u662f\u5b83\u7684\u5bbf\u654c\u3002\u7531\u6b64\u6211\u4eec\u5728 $O(n)$ \u7684\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u4e86\u6240\u6709 $f(i)$\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u7528 $f(i)$ \u6c42\u51fa\u7b54\u6848\u3002\n\n\u9898\u76ee\u4e2d\u7684\u67e5\u8be2\u5c31\u662f\u8981\u6c42\u4f7f\u5f97 $f(i)\\lt l ,i\\in [l,r]$ \u7684 $i$ \u7684\u4e2a\u6570\u3002\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u7528\u4e3b\u5e2d\u6811\u7ef4\u62a4\u3002\u4ee4\u4e3b\u5e2d\u6811\u4e2d\u7b2c $v$ \u4e2a\u7248\u672c\u4e2d\u533a\u95f4 $[l,r]$ \u8868\u793a $[l,r]$ \u4e2d $f(i)\\le v$ \u7684\u4e2a\u6570\uff0c\u53ea\u8981\u5728\u751f\u6210\u7b2c $f(i)$ \u4e2a\u7248\u672c\u65f6\u5c06\u70b9 $i$ \u52a0\u5165\u4e3b\u5e2d\u6811\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6\u662f $O((n+q)\\log n)$ \u7684\u3002\u9274\u4e8e\u4e3b\u5e2d\u6811\u7684\u5927\u5e38\u6570\uff0c\u53ef\u80fd\u9700\u8981\u5361\u5e38\u3002\n\n------------\n\u4ee5\u4e0b\u4e3a\u8003\u540e\u53e3\u80e1\u5185\u5bb9\uff1a\n\n\u4e8b\u5b9e\u4e0a\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u4e3b\u5e2d\u6811\u6765\u7ef4\u62a4\u5386\u53f2\u7248\u672c\uff0c\u56e0\u4e3a\u6bcf\u4e00\u4e2a\u7248\u672c\u53ea\u6709\u5728\u67e5\u8be2\u65f6\u7684 $l=v+1$ \u65f6\u4f1a\u7528\u5230\u3002\u6240\u4ee5\u53ef\u4ee5\u5c06\u67e5\u8be2\u6309 $l$ \u6392\u5e8f\uff0c\u7136\u540e\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u6216\u8005\u6811\u72b6\u6570\u7ec4\u5728\u751f\u6210\u7248\u672c\u7684\u540c\u65f6\u5904\u7406\u67e5\u8be2\u3002\u8fd9\u6837\u5e38\u6570\u5e94\u8be5\u4f1a\u5c0f\u5f88\u591a\u3002\n\n\n\u8003\u573a\u4ee3\u7801\uff08\u6781\u5176\u60e8\u70c8\u7684\u4e3b\u5e2d\u6811\u505a\u6cd5\uff09\uff08\u65e2\u88ab\u5361\u65f6\u95f4\u53c8\u88ab\u5361\u7a7a\u95f4\uff09\uff1ahttps://www.luogu.com.cn/record/72364566   \n\nAC\u4ee3\u7801\uff08\u7ebf\u6bb5\u6811\u505a\u6cd5\uff09\uff1a  \n```cpp\n#include <iostream>\n#include <fstream>\n#include <vector>\n#include <stack>\n#include <utility>\n#include <algorithm>\nusing namespace std;\n\ntemplate<typename Int>\nclass xds{\n\tprivate:\n\t\tclass node{\n\t\t\tpublic:\n\t\t\t\tnode *lc,*rc;\n\t\t\t\tInt value,tag;\n\t\t\t\tvirtual ~node(){delete lc,delete rc;}\n\t\t\t\tnode(){lc=rc=nullptr;}\n\t\t\t\tnode(const Int&value){lc=rc=nullptr;this->value=value;tag=0;}\n\t\t};\n\t\tnode *root;\n\t\tsize_t ln,rn;\n\t\txds(){;}\n\t\tstatic node* build(size_t left,size_t right)\n\t\t{\n\t\t\tif(right==left+1)\n\t\t\t\treturn new node(0);\n\t\t\tsize_t mid=(left+right)/2;\n\t\t\tnode *pt=new node;\n\t\t\tpt->lc=build(left,mid),pt->rc=build(mid,right);\n\t\t\tpt->tag=0,pt->value=pt->lc->value+pt->rc->value;\n\t\t\treturn pt;\n\t\t}\n\t\tstatic void pushtag(size_t left,size_t right,node *pt)\n\t\t{\n\t\t\tif(pt->lc==nullptr)\n\t\t\t\treturn;\n\t\t\tsize_t mid=(left+right)/2;\n\t\t\tpt->lc->tag+=pt->tag,pt->rc->tag+=pt->tag;\n\t\t\tpt->lc->value+=pt->tag*(mid-left),pt->rc->value+=pt->tag*(right-mid);\n\t\t\tpt->tag=0;\n\t\t\treturn;\n\t\t}\n\t\tstatic void add(size_t left,size_t right,size_t l,size_t r,Int x,node* pt)\n\t\t{\n\t\t\tif(l<=left&&r>=right)\n\t\t\t{\n\t\t\t\tpt->value+=(right-left)*x;\n\t\t\t\tpt->tag+=x;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(l>=right||r<=left)\n\t\t\t\treturn;\n\t\t\tpushtag(left,right,pt);\n\t\t\tsize_t mid=(left+right)/2;\n\t\t\tadd(left,mid,l,r,x,pt->lc),add(mid,right,l,r,x,pt->rc);\n\t\t\tpt->value=pt->lc->value+pt->rc->value;\n\t\t\treturn;\n\t\t}\n\t\tstatic Int quest(size_t left,size_t right,size_t l,size_t r,node* pt)\n\t\t{\n\t\t\tif(l<=left&&r>=right)\n\t\t\t\treturn pt->value;\n\t\t\tif(l>=right||r<=left)\n\t\t\t\treturn 0;\n\t\t\tpushtag(left,right,pt);\n\t\t\tsize_t mid=(left+right)/2;\n\t\t\treturn quest(left,mid,l,r,pt->lc)+quest(mid,right,l,r,pt->rc);\n\t\t}\n\tpublic:\n\t\txds(size_t left,size_t right)\n\t\t{\n\t\t\tln=left,rn=right;\n\t\t\troot=build(left,right);\n\t\t\treturn;\n\t\t}\n\t\tvoid add(size_t l,size_t r,Int x)\n\t\t{\n\t\t\tadd(ln,rn,l,r,x,root);\n\t\t}\n\t\tInt quest(size_t l,size_t r)\n\t\t{\n\t\t\treturn quest(ln,rn,l,r,root);\n\t\t}\n};\n\nclass pnt{\n\tpublic:\n\t\tint pos,a,b;\n\t\tpnt(int _pos,int _a,int _b){pos=_pos,a=_a,b=_b;}\n};\n\nint n,q;\nint a[500010],b[500010];\nvector<pair<int,int> >pre;\nstack<pnt> stk;\nxds<int> *tree;\n\nclass que{\n\tpublic:\n\t\tint l,r,ans,pos;\n\t\tbool operator<(const que&x)const{\n\t\t\treturn l==x.l?r<x.r:l<x.l;\n\t\t}\n};\n\nbool tmp(const que&x,const que&y)\n{\n\treturn x.pos<y.pos;\n}\n\nvoid work(istream&ins,ostream&ous)\n{\n\tins>>n>>q;\n\tfor(int i=1;i<=n;i++)\n\t\tins>>a[i];\n\tfor(int i=1;i<=n;i++)\n\t\tins>>b[i];\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(!stk.empty()&&(stk.top().a==a[i]||stk.top().b<=b[i]))\n\t\t\tstk.pop();\n\t\tif(stk.empty())\n\t\t{\n\t\t\tpre.push_back(make_pair(0,i));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpre.push_back(make_pair(stk.top().pos,i));\n\t\t}\n\t\tstk.push(pnt(i,a[i],b[i]));\n\t}\n\tvector<que>qes;\n\tfor(int i=0;i<q;i++)\n\t{\n\t\tque x;\n\t\tins>>x.l>>x.r;\n\t\tx.pos=i;\n\t\tqes.push_back(x);\n\t}\n\tsort(qes.begin(),qes.end());\n\tsort(pre.begin(),pre.end());\n\ttree=new xds<int>(0,n+1);\n\tint it=0;\n\tint it2=0;\n\tfor(int i=0;i<n;i++)\n\t{\n\t\twhile(it<pre.size()&&pre[it].first<=i)\n\t\t{\n\t\t\ttree->add(pre[it].second,pre[it].second+1,1);\n\t\t\tit++;\n\t\t}\n\t\twhile(it2<q&&qes[it2].l-1==i)\n\t\t{\n\t\t\tqes[it2].ans=tree->quest(qes[it2].l,qes[it2].r+1);\n\t\t\tit2++;\n\t\t}\n\t}\n\tsort(qes.begin(),qes.end(),tmp);\n\tfor(int i=0;i<q;i++)\n\t{\n\t\tous<<qes[i].ans<<'\\n';\n\t}\n\tdelete tree;\n\treturn;\n}\n\nint main()\n{\n\tios::sync_with_stdio(false);\n\twork(cin,cout);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1648270092,
        "uid": 362489,
        "name": "comando",
        "ccfLevel": 6,
        "title": "P8251\u9898\u89e3"
    },
    {
        "content": "whker \u8fc7\u6765\u5199\u4e00\u7bc7\u9898\u89e3\u3002\n\n\u89c2\u5bdf\u5230\u6bcf\u4e2a\u4e8c\u5143\u7ec4\u4f1a\u88ab\u5b83\u524d\u9762\u7684\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5361\u4f4f\uff0c\u6216\u8005\u6ca1\u6709\uff0c\u6211\u4eec\u5c06\u5176\u8bb0\u4e3a $lst_i$\uff0c\u6ca1\u6709\u8bb0 $lst_i=0$\u3002\n\n\u7528\u5355\u8c03\u6808\u6c42\u51fa $lst$ \u6570\u7ec4\u540e\uff0c\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u4e8c\u5143\u7ec4 $x$ \u5728\u533a\u95f4 $[l,r]$ \u6ee1\u8db3\u4ec0\u4e48\u8981\u6c42\u65f6\u4f1a\u8bb0\u4f5c\u201c\u6210\u529f\u7684\u201d\u3002\n\n\u4e0d\u96be\u60f3\u5230\uff0c\u5982\u679c\u552f\u4e00\u80fd\u5361\u4f4f\u4ed6\u7684\u4e8c\u5143\u7ec4\u5728\u533a\u95f4\u5916\uff0c\u5373 $lst_x<l$\uff0c\u90a3\u4e48\u8fd9\u4e00\u5b9a\u662f\u4e00\u4e2a\u201c\u6210\u529f\u7684\u201d\u4e8c\u5143\u7ec4\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e86\uff0c\u5177\u4f53\u7528\u6811\u72b6\u6570\u7ec4\u3001\u500d\u589e\u8fd8\u662f\u5176\u5b83\u90fd\u968f\u4fbf\u4f60\uff0c\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002",
        "postTime": 1648270053,
        "uid": 159610,
        "name": "Meaninglessness",
        "ccfLevel": 4,
        "title": "[NOI Online 2022 \u63d0\u9ad8\u7ec4] \u4e39\u9493\u6218"
    }
]