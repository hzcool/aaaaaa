[
    {
        "content": "\u4e0d\u592a\u597d\u5199\u7684\u72b6\u538bDP\n\n\u8fd8\u662f\u6bd4\u8f83\u597d\u60f3\u7684\uff1a\n\n- \u628a\u6751\u5e84\u4ee5\u516d\u8fdb\u5236\u538b\u8fdb\u72b6\u6001\u3002\n\n- $f_{i,j,st}$\u524d$i$\u6b65\u6751\u5e84\u72b6\u6001\u4e3a$j$\u4ed3\u5e93\u72b6\u6001\u4e3a$st$\u7684\u6700\u5927\u4eba\u6c14,\u5206\u4e09\u79cd\u60c5\u51b5\u8f6c\u79fb\u3002[code\u4e2d\u7684(1)-(3)]\n\n\u6ce8\u610f:\n\n- \u5408\u6210\u662f\u4f1a\u89e6\u53d1\u591a\u6b21\u7684,\u9700\u8981\u5199\u4e2a\u5faa\u73af\u3002\n\n\n$\\color{brown}{code}$~\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<assert.h>\nusing namespace std;\ntypedef long long LL;\n#define NS 47000//6^6\nchar opt[105];\nint f[105][NS][6];//f[i][j][st]\u524di\u6b65\u6751\u5e84\u72b6\u6001\u4e3aj\u4ed3\u5e93\u72b6\u6001\u4e3ast\u7684\u6700\u5927\u4eba\u6c14\nint six[10];//6^k \ninline int bit(register int n,register int b)\n\t{return n/six[b]%6;}//n\u76846\u8fdb\u5236\u7b2cb\u4f4d(\u7f16\u53f7from0) \nint val[NS]//==-1:invalid|==0\u4e0d\u80fd\u6d88|other:\u6d88\u9664\u83b7\u5f97\u7684\u4eba\u6c14\n,to[NS];//\u6d88\u9664\u540e\u4e0d\u5305\u62ec\u65b0\u4ea7\u751f\u7684\u90a3\u4e2a\u7684\u5176\u4ed6\u7684\u72b6\u6001 \nvoid Up(int&a,int b){a=max(a,b);}//Update\nint n;\nvoid print6(int e){//\u516d\u8fdb\u5236\u8f93\u51fa(debug) \n\tchar ou[10];int i;\n\tmemset(ou,'0',sizeof(ou));\n\tfor(i=0;e>0;i++,e/=6)\n\t\tou[i]=e%6+'0';\n\tfor(int j=n-1;j>=0;j--)putchar(ou[j]);\n\tputchar(' ');\n}\nint main(){\n\tint d;\n\tscanf(\"%d%d\",&n,&d);\n\tscanf(\"%s\",opt+1);\n\tfor(int i=1;i<=d;i++)opt[i]-='0';\n\tsix[0]=1;\n\tfor(int i=1;i<=n;i++)six[i]=six[i-1]*6;\n\t\n\tfor(int i=0;i<six[n];i++){\n\t\tint cnt=0;\n\t\tfor(int j=0;j<n-1;j++){\n\t\t\tint u=bit(i,j),k=2,s=0;\n\t\t\tif(u==0||u!=bit(i,j+1))continue;\n\t\t\tcnt++,s=u*six[j]+u*six[j+1],j++;\n\t\t\tif(cnt>1){val[i]=-1;break;}\n\t\t\twhile(bit(i,j+1)==u)j++,k++,s+=u*six[j];\n\t\t\tval[i]=k*(1<<u),to[i]=i-s;\n\t\t}\n\t\tif(cnt==0)val[i]=0,to[i]=i;//useless\n\t}//\u9884\u5904\u7406val,to \n\t\n\tmemset(f,-0x3f,sizeof(f)),f[0][0][0]=0;\n\tfor(int i=1;i<=d;i++){//i:\u7b2c\u51e0\u6b65\n\t\tfor(int j=0;j<six[n];j++){//j:\u72b6\u6001\n\t\t\tif(val[j]!=0)continue;\n\t\t\tUp(f[i][j][opt[i]],f[i-1][j][0]);//\u653e\u4ed3\u5e93\u3002(1)\n\t\t\tfor(int k=0;k<n;k++){//k:\u653e\u54ea\u513f\n\t\t\t\tif(bit(j,k)!=0)continue;\n\t\t\t\tfor(int st=0;st<6;st++){//st:\u4ed3\u5e93\n\t\t\t\t\tint nxt=j+six[k]*opt[i],v=0,t=1;\n\t\t\t\t\twhile(val[nxt]!=0){//\u5faa\u73af\"\u5408\u6210\"\n\t\t\t\t\t\tassert(val[nxt]!=-1);\n\t\t\t\t\t\tv+=val[nxt];\n\t\t\t\t\t\tnxt=to[nxt]+(opt[i]+t)%6*six[k];\n\t\t\t\t\t\t//\u5982\u679copt[i]+t==6\u90a3\u4e48val[nxt]\u80af\u5b9a\u5408\u6cd5,\u6240\u4ee5\u53ea%\u4e00\u4e0b\u5c31\u884c\u53ef\u4ee5\u5c11\u4e00\u884c\u7279\u5224\n\t\t\t\t\t\tt++;\n\t\t\t\t\t}\n\t\t\t\t\tUp(f[i][nxt][st],f[i-1][j][st]+v);//\u4ed3\u5e93\u4e0d\u53d8\u3002(2)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(int j=0;j<six[n];j++){\n\t\t\tif(val[j]!=0)continue;\n\t\t\tfor(int k=0;k<n;k++){\n\t\t\t\tif(bit(j,k))continue;\n\t\t\t\tfor(int st=1;st<6;st++){//j,st:\u72b6\u6001;k:\u653e\u54ea\u513f\n\t\t\t\t\tint nxt=j+six[k]*st,v=0,t=1;\n\t\t\t\t\twhile(val[nxt]!=0){//\u5faa\u73af\u540c\u4e0a\n\t\t\t\t\t\tassert(val[nxt]!=-1);\n\t\t\t\t\t\tv+=val[nxt];\n\t\t\t\t\t\tnxt=to[nxt]+(st+t)%6*six[k];\n\t\t\t\t\t\tt++;\n\t\t\t\t\t}\n\t\t\t\t\tUp(f[i][nxt][0],f[i][j][st]+v);//clear\u4ed3\u5e93\u3002(3)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint ans=0;\n\tfor(int a=1;a<=d;a++)\n\t\tfor(int i=0;i<six[n];i++){\n\t\t\tif(val[i]!=0)continue; \n\t\t\tfor(int st=0;st<6;st++)\n\t\t\t\tans=max(ans,f[a][i][st]);\n\t\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n$O(6^{n+1}dn)$",
        "postTime": 1612352609,
        "uid": 157677,
        "name": "maruize",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3999 \u3010[SHOI2013]\u4e8c\u91cd\u9547\u3011"
    },
    {
        "content": "\u601d\u8def\u501f\u9274\u4e86[\u8fd9\u4e2a\u535a\u5ba2](http://www.cnblogs.com/wangyurzee7/p/5267194.html)\uff1a\n\n\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u72b6\u538bdp\n\n\u7528\u4e00\u4e2a\u5341\u8fdb\u5236\u6570\u6765\u8868\u793a\u72b6\u6001\uff0c\u5373\u7b2ci\u4f4d\u8868\u793a\u4f4d\u7f6ei\u5904\u7684\u7269\u54c1\u7b49\u7ea7\n\n\u7528f[i][j][k]\u8868\u793a\u7b2ci\u5929\uff0c\u4ed3\u5e93\u7684\u7269\u54c1\u7b49\u7ea7\u4e3aj\uff0c\u72b6\u6001\u4e3ak\u65f6\u7684\u6700\u5927\u6536\u76ca\n\n\u4f46\u662f\u72b6\u6001\u6570\u8c8c\u4f3c\u5f88\u591a\uff0c\u5f00\u4e0d\u4e0b\uff0c\u540c\u65f6\u4e0a\u9762\u7684\u5f0f\u5b50\u597d\u50cf\u4e0d\u592a\u597d\u8f6c\u79fb\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6240\u6709\u7684\u5408\u6cd5\u72b6\u6001\uff0c\u5373\u65e0\u6cd5\u6d88\u9664\u7684\u72b6\u6001\uff0c\u7136\u540e\u5728\u9884\u5904\u7406\u51fa\u6240\u6709\u72b6\u6001\u53ef\u80fd\u7684\u8f6c\u79fb\uff0c\u5373\u679a\u4e3e\u7a7a\u4f4d\u653e\u90a3\u4e9b\u7b49\u7ea7\u7684\u7269\u54c1\uff0c\u7528e[i][j][k]\u8868\u793a\u72b6\u6001i\uff0c\u5728\u7b2ck\u4e2a\u7a7a\u4f4d\u586b\u7b49\u7ea7\u4e3aj\u7684\u7269\u54c1\u4f1a\u8f6c\u79fb\u5230\u7684\u72b6\u6001\u7f16\u53f7\uff0cdis[i][j][k]\u8868\u793a\u8fd9\u79cd\u8f6c\u79fb\u6240\u5f97\u5230\u7684\u6536\u76ca\uff0c\u8fd9\u6837\u5c31\u65b9\u4fbf\u8f6c\u79fb\u4e86\n\n\u6ce8\u610f\u5230\u6211\u4eec\u8fd8\u8981\u8003\u8651\u5230\u4ed3\u5e93\u4e2d\u7684\u7269\u54c1\uff0c\u5373\u4f1a\u6709f[i][j][k]\u8f6c\u79fb\u5230f[i][0][s]\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u679a\u4e3e\u7b2c\u4e8c\u7ef4\u7684\u987a\u5e8f\u5e94\u8be5\u662f\u5012\u5e8f\u679a\u4e3e(\u5373\u6700\u540e\u8003\u8651f[i][0]\u7684\u72b6\u6001\uff09\n\n\u7ec6\u8282\u6709\u70b9\u591a\uff0c\u6ce8\u610f\u4e0d\u8981\u5199\u6302\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\n#include <cstring>\n\nusing namespace std;\n\nconst int mn = 8;\nconst int maxn = 105;\nconst int mx = 25005;//\u72b6\u6001\u603b\u6570\n\nchar s[maxn];\nint n,m,a[mn],b[mn],cnt,g[maxn];\nint sit[mn],id[700005];\nint e[mx][mn][mn],dis[mx][mn][mn],head[mx];\n\nint xiao(int *a,int pos,int &val)\n{\n    val=0;\n    while(a[pos])\n    {\n        int tmp=a[pos],l=pos,r=pos;\n        while(a[l]==a[l-1] && l>1) l--;\n        while(a[r]==a[r+1] && r<n) r++;\n        if(l==r) break;\n        val+=(r-l+1)*(1<<tmp);\n        for(int i=l;i<=r;i++)\n            a[i]=0;\n        a[pos]=(tmp+1)%6;\n    }\n    int tmp=0;\n    for(int i=1;i<=n;i++)\n        tmp=tmp*10+a[i];\n    if(!id[tmp]) id[tmp]=++cnt;\n    return id[tmp];\n}\n\nvoid dfs(int x)\n{\n    //printf(\"%d\\n\",x);\n    if(x>n)\n    {\n        int now = xiao(a,0,b[0]);\n        for(int i=1;i<=n;i++)\n        {\n            if(!a[i])\n            {\n                ++head[now];\n                for(int j=1;j<=5;j++)\n                {\n                    for(int k=1;k<=n;k++)\n                        b[k]=a[k];\n                    b[i]=j;\n                    e[now][j][head[now]] = xiao(b,i,dis[now][j][head[now]]);\n                }\n            }\n        }\n        return ;\n    }\n    for(int i=0;i<=5;i++)\n    {\n        if(x==1 || !a[x-1] || !i || a[x-1]!=i)\n        {\n            a[x]=i;\n            dfs(x+1);\n        }\n    }\n}\nint f[maxn][mn][mx];\nint dp()\n{\n    memset(f,-1,sizeof(f));\n    int ans=0;\n    f[0][0][1]=0;\n    for(int i=0;i<=m;i++)\n        for(int k=5;k>=0;k--)\n            for(int j=1;j<=cnt;j++)\n            {\n                if(f[i][k][j]>=0)\n                {\n                    if(i<m)\n                    {\n                        for(int s=1;s<=head[j];s++)\n                            f[i+1][k][e[j][g[i+1]][s]]=max(f[i+1][k][e[j][g[i+1]][s]],f[i][k][j]+dis[j][g[i+1]][s]);\n                    }\n                    if(k)\n                    {\n                        for(int s=1;s<=head[j];s++)\n                            f[i][0][e[j][k][s]]=max(f[i][0][e[j][k][s]],f[i][k][j]+dis[j][k][s]);\n                    }\n                    else  f[i+1][g[i+1]][j]=max(f[i+1][g[i+1]][j],f[i][k][j]);\n                    ans=max(ans,f[i][k][j]);\n                }\n            }\n    return ans;\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    scanf(\"%s\",s+1);\n    for(int i=1;i<=m;i++)\n        g[i]=s[i]-'0';\n    dfs(1);\n    printf(\"%d\\n\",dp());\n    return 0;\n}\n\n```",
        "postTime": 1539333987,
        "uid": 58931,
        "name": "logeadd",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3999 \u3010[SHOI2013]\u4e8c\u91cd\u9547\u3011"
    },
    {
        "content": "## [P3999](https://www.luogu.com.cn/problem/P3999)\n\n### \u89e3\u9898\u601d\u8def\uff1a\n\n\u6ce8\u610f\u5230\u7b49\u7ea7\u4e0d\u4f1a\u8d85\u8fc7 $5$\uff0c\u4e14 $n\\le 6$\uff0c\u6240\u4ee5\u53ef\u4ee5\u8bbe $dp_{i,j}$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u7269\u54c1\uff0c$j$ \u662f\u4e00\u4e2a\u516d\u8fdb\u5236\u6570\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u4f4d\u7f6e\u548c\u4ed3\u5e93\u7269\u54c1\u7684\u7b49\u7ea7\u3002\n\n\u5bf9\u4e8e\u5408\u5e76\u64cd\u4f5c\uff0c\u53ef\u4ee5\u53bb\u66b4\u529b dfs\uff0c\u56e0\u4e3a\u6bcf\u6b21\u5408\u5e76\u7269\u54c1\u6570\u91cf\u90fd\u81f3\u5c11\u51cf $1$\uff0c\u6240\u4ee5\u4e00\u6b21\u6700\u591a\u5408\u5e76 $O(n)$ \u6b21\u3002\n\n\u56e0\u4e3a\u5408\u5e76\u5f97\u5230\u7684\u7269\u54c1\u8981\u6c42\u653e\u5728\u5408\u5e76\u7269\u54c1\u4e2d\u6700\u540e\u653e\u7684\uff0c\u53ef\u4ee5\u53d1\u73b0\u653e\u5b8c\u4e00\u4e2a\u7269\u54c1\u540e\uff0c\u6240\u6709\u5408\u5e76\u64cd\u4f5c\u5f97\u5230\u7684\u65b0\u7269\u54c1\u90fd\u662f\u653e\u5728\u8fd9\u4e2a\u7269\u54c1\u6240\u653e\u4f4d\u7f6e\u7684\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7269\u54c1\uff0c\u8981\u5206 $3$ \u6b65\uff1a\n\n1. \u679a\u4e3e\u6240\u6709\u4e0a\u4e00\u6b21\u7684\u72b6\u6001\uff0c\u8003\u8651\u5f53\u524d\u8fd9\u4e2a\u7269\u54c1\u653e\u54ea\u4e2a\u7a7a\u4f4d\uff0c\u5f97\u5230\u4e0b\u4e00\u4e2a\u72b6\u6001\uff0c\u7136\u540e\u8f6c\u79fb\u3002\n2. \u679a\u4e3e\u6240\u6709\u4ed3\u5e93\u4e2d\u6709\u7269\u54c1\u7684\u72b6\u6001\uff0c\u8003\u8651\u4ed3\u5e93\u4e2d\u7684\u7269\u54c1\u653e\u54ea\u4e2a\u7a7a\u4f4d\uff0c\u5f97\u5230\u4e0b\u4e00\u4e2a\u72b6\u6001\uff0c\u7136\u540e\u8f6c\u79fb\u3002\n3. \u7528\u5df2\u7ecf\u586b\u6ee1\u6240\u6709\u683c\u5b50\u7684\u72b6\u6001\u66f4\u65b0\u7b54\u6848\u3002\n\n\u8fd9\u6837\u64cd\u4f5c\u7684\u597d\u5904\u5728\u4e8e\uff0c\u65e2\u5305\u542b\u4e86\u5148\u4ece\u4ed3\u5e93\u62ff\u7269\u54c1\uff0c\u518d\u8003\u8651\u5f53\u524d\u7269\u54c1\u7684\u4f4d\u7f6e\u7684\u60c5\u51b5\uff0c\u4e5f\u5305\u542b\u4e86\u5148\u8003\u8651\u5f53\u524d\u7269\u54c1\u7684\u4f4d\u7f6e\uff0c\u518d\u8003\u8651\u4ed3\u5e93\u4e2d\u7684\u7269\u54c1\u7684\u60c5\u51b5\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(6^n\\times n^2)$\u3002\n\n### \u4ee3\u7801\uff1a\n```cpp\nconst int N=6*6*6*6*6*6*6+10;\n\nint dp[2][N],a[10],ta[10],mi6[10],n,cur;\n\npi get(int x)\n{\n\tint i=x,l,r;\n\twhile(i>1&&ta[i-1]==ta[x]) i--;\n\tl=i;\n\ti=x;\n\twhile(i<n&&ta[i+1]==ta[x]) i++;\n\tr=i;\n\tif(l==r)\n\t{\n\t\tint sum=0;\n\t\tper(j,1,n+1) sum=sum*6+ta[j];\n\t\treturn mk(sum,0);\n\t}\n\telse\n\t{\n\t\tint tem=ta[x];\n\t\trep(j,l,r) ta[j]=0;\n\t\tpi res;\n\t\tif(tem<5) ta[x]=tem+1,res=get(x);\n\t\telse\n\t\t{\n\t\t\tint sum=0;\n\t\t\tper(j,1,n+1) sum=sum*6+ta[j];\n\t\t\tres=mk(sum,0);\n\t\t}\n\t\tint sum=1;\n\t\trep(i,1,tem) sum*=2;\n\t\treturn mk(res.fi,res.se+sum*(r-l+1));\n\t}\n}\n\nint main()\n{\n\tmemset(dp,-1,sizeof(dp));\n\tint d,ans=0;\n\tscanf(\"%d%d\",&n,&d);\n\tmi6[0]=1;\n\trep(i,1,n+1) mi6[i]=mi6[i-1]*6;\n\tdp[cur][0]=0;\n\trep(i,1,d)\n\t{\n\t\tcur^=1;\n\t\tmemset(dp[cur],-1,sizeof(dp[cur]));\n\t\tint x;\n\t\tscanf(\"%1d\",&x);\n\t\trep(j,0,mi6[n+1]-1)\n\t\t{\n\t\t\tif(dp[cur^1][j]==-1) continue;\n\t\t\trep(k,1,n+1) a[k]=0;\n\t\t\tint t=0,s=j,ss=j;\n\t\t\twhile(ss) a[++t]=ss%6,ss/=6;\n\t\t\trep(k,1,n)\n\t\t\t\tif(!a[k]) \n\t\t\t\t{\n\t\t\t\t\ta[k]=x;\n\t\t\t\t\trep(h,1,n+1) ta[h]=a[h];\n\t\t\t\t\tpi ns=get(k);\n\t\t\t\t\tdp[cur][ns.fi]=max(dp[cur][ns.fi],dp[cur^1][s]+ns.se);\n\t\t\t\t\ta[k]=0;\n\t\t\t\t}\n\t\t\tif(!a[n+1])\n\t\t\t{\n\t\t\t\tint ns=s+mi6[n]*x;\n\t\t\t\tdp[cur][ns]=max(dp[cur][ns],dp[cur^1][s]);\n\t\t\t}\n\t\t}\n\t\trep(j,0,mi6[n+1]-1)\n\t\t{\n\t\t\tif(dp[cur][j]==-1) continue;\n\t\t\trep(k,1,n+1) a[k]=0;\n\t\t\tint t=0,s=j,ss=j;\n\t\t\twhile(ss) a[++t]=ss%6,ss/=6;\n\t\t\tif(a[n+1])\n\t\t\t\trep(k,1,n)\n\t\t\t\t\tif(!a[k])\n\t\t\t\t\t{\n\t\t\t\t\t\tint tem=a[n+1];\n\t\t\t\t\t\ta[k]=a[n+1];\n\t\t\t\t\t\ta[n+1]=0;\n\t\t\t\t\t\trep(h,1,n+1) ta[h]=a[h];\n\t\t\t\t\t\tpi ns=get(k);\n\t\t\t\t\t\tdp[cur][ns.fi]=max(dp[cur][ns.fi],dp[cur][s]+ns.se);\n\t\t\t\t\t\ta[k]=0;\n\t\t\t\t\t\ta[n+1]=tem;\n\t\t\t\t\t}\n\t\t}\n\t\trep(j,0,mi6[n+1]-1)\n\t\t{\n\t\t\tif(dp[cur][j]==-1) continue;\n\t\t\trep(k,1,n+1) a[k]=0;\n\t\t\tint t=0,s=j,ss=j;\n\t\t\twhile(ss) a[++t]=ss%6,ss/=6;\n\t\t\tbool f=1;\n\t\t\trep(k,1,n+1) if(!a[k]) {f=0;break;}\n\t\t\tif(f) ans=max(ans,dp[cur][j]);\n\t\t}\n\t}\n\trep(i,0,mi6[n+1]-1) \n\t{\n\t\tans=max(ans,dp[cur][i]);\n\t}\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1670488756,
        "uid": 571634,
        "name": "hgzxwzf",
        "ccfLevel": 7,
        "title": "P3999 [SHOI2013]\u4e8c\u91cd\u9547"
    }
]