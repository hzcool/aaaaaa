[
    {
        "content": "\u6781\u5176\u7384\u5b66\u7684\u9898\u76ee,\u597d\u50cf\u6ca1\u51e0\u4e2a\u4eba\u901a\u8fc7,\u90a3\u6211\u5c31\u8bb2\u4e0b\u6211\u7684\u601d\u8def\u5427,\u770b\u4e86\u4e0b\u901a\u8fc7\u7684\u5de8\u4f6c\u7684$Code$,\u597d\u50cf\u6ca1\u4eba\u548c\u6211\u4e00\u6837,\u4ee5\u4e0b\u4e3a\u6bd2\u7624\u505a\u6cd5,~~\u597d\u5b69\u5b50\u4e0d\u8981\u5b66\u4e60~~\n\n---\n### \u4e00\n\n\u9996\u5148,\u4e00\u4e2a\u6570\u4e8c\u8fdb\u5236\u7b2c$i$\u4e3a$1$\u7684\u8bdd,\u90a3\u4e48\u5b83\u80af\u5b9a\u5927\u4e8e$2^{i}$,\u90a3\u5b83\u6709\u6ca1\u6709\u4e0a\u754c\u5462,~~\u597d\u50cf\u6ca1\u6709~~,\u4e0d\u7528\u6015,\u6ca1\u6709\u4e0a\u754c\u6211\u4eec\u4e5f\u8981\u521b\u9020\u4e0a\u754c,\u6211\u4eec\u628a\u5b83\u6a21\u4e0a$2^{i+1}$\uff0c\u90a3\u5b83\u4e0d\u5c31\u6709\u4e0a\u754c\u4e86\u561b,\u6240\u4ee5\u5206\u522b$mod$ $2$,$4$,$8$...  \n\u6211\u4eec\u53ef\u4ee5\u5efa$16$\u9897\u6743\u503c\u7ebf\u6bb5\u6811\u6216\u5e73\u8861\u6811\u67e5\u627e\u533a\u95f4$[2^{i},2^{i+1})$\u4e2d\u6570\u7684\u4e2a\u6570  \n\n## \u4e8c\n\u5173\u952e\u8fd9\u9898\u8fd8\u6709\u4e2a\u4fee\u6539\u64cd\u4f5c,  \n\u56e0\u4e3a$a+x$\u5c5e\u4e8e$[2^{i},2^{i+1})$,\u6240\u4ee5$a$\u5c5e\u4e8e$[2^{i}-x,2^{i+1}-x)$,  \n\u53ef\u8fd8\u662f\u6709\u53d6\u6a21\u5462? \n\n\u6211\u4eec\u5927\u80c6\u731c\u6d4b$a$\u5c5e\u4e8e$[2^{i}-x(mod$ $2^{i+1}),2^{i+1}-x(mod$ $2^{i+1}))$  \n~~\u5927\u5bb6\u81ea\u5df1\u624b\u73a9\u4e00\u4e0b\u4e5f\u80fd\u63a8\u5f97\u51fa\u6765~~\uff0c$OI$~~\u754c\u4e0d\u9700\u8981\u8bc1\u660e~~  \n\n\u53ef\u5de6\u8fb9\u754c\u8fd8\u6709\u53ef\u80fd\u662f\u8d1f\u7684\u5462?  \n~~\u6ca1\u5173\u7cfb\uff0c\u7ee7\u7eed\u5927\u80c6\u731c\u6d4b~~  \n\u4ee4$l=2^{i}-x(mod$ $2^{i+1})$,$r=2^{i+1}-x(mod$ $2^{i+1})-1$,$nr=2^{i+1}-1$  \n\u90a3\u6b64\u65f6$a$\u5e94\u5c5e\u4e8e$[0,r]$\u5e76\u4e0a$[nr+l+1,nr]$  \n\u5982\u679c\u4e0d\u61c2\u7684\u8bdd\u5c31\u628a\u5b83\u60f3\u8c61\u6210\u4e00\u4e2a\u73af\u5427\n\n**\u5173\u952e\u8fd8\u662f\u5206\u6790\uff0c\u4ee3\u7801\u76f8\u4fe1\u5927\u5bb6\u90fd\u80fd\u5199\u51fa\u4e86\uff0c\u8fd9\u79cd\u5206\u6790\u6bd4\u8f83\u4e0d\u5bb9\u6613\u7684\u61c2,\u5efa\u8bae\u5927\u5bb6\u81ea\u5df1\u53bb\u63a8\uff0c\u53bb\u624b\u7b97**  \n\u6bd2\u7624$Code$\n```cpp\n#include<cstdio>\nnamespace IO {\n\n    template<typename T>\n    T read(T& a) {\n        int c;\n        while((a=getchar()-'0')) if(a>0&&a<=9) break;\n        while((c=getchar())) {\n            if(c<'0'||c>'9') return a;\n            a=a*10+c-'0';\n        }\n        return a;\n     }\n\n    inline char get() { int c; while((c=getchar())) if(c=='A'||c=='Q') return c; }\n}\n\nclass SegmentTree {\n    static const int maxn = 1<<18;\n    int s[maxn],lc[maxn],rc[maxn];\n    int size;\n\n    public:\n    int root[20];\n\n    void build(int o,int L,int R) {\n        s[o]=lc[o]=rc[o]=0;\n        if(L==R) return ;\n        int mid=(L+R)>>1;\n        rc[o]=(lc[o]=size)+1,size+=2;\n        build(lc[o],L,mid);\n        build(rc[o],mid+1,R);\n    }\n\n    SegmentTree() {\n        size=0;\n        for(int i=0;i<=15;++i)\n            build(root[i]=size++,0,(1<<(i+1))-1);\n    }\n\n    void insert(int o,int L,int R,int x) {\n        if(L==R) s[o]++;\n        else {\n            int mid=(L+R)>>1;\n            if(x<=mid) insert(lc[o],L,mid,x);\n            else insert(rc[o],mid+1,R,x);\n            s[o]=s[lc[o]]+s[rc[o]];\n        }\n    }\n\n    int query(int o,int L,int R,int l,int r) {\n        if(l<=L&&r>=R) return s[o];\n        int mid=(L+R)>>1,res=0;\n        if(l<=mid) res=query(lc[o],L,mid,l,r);\n        if(r>mid) res+=query(rc[o],mid+1,R,l,r);\n        return res;\n    }\n/*\n    void Debug(int o,int L,int R){\n        printf(\"L %d R %d s %d\\n\",L,R,s[o]);\n        if(L==R) return ;\n        int mid=(L+R)>>1;\n        Debug(lc[o],L,mid);\n        Debug(rc[o],mid+1,R);\n    }\n*/\n}t;\nint n,m,a;\nlong long ans;\nusing namespace IO;\n\n#define Mod(x,i) ((x)%(1<<(i)))\n\nint main() {\n    int x;\n    read(n); read(m);\n    for(register int i=0;i<n;++i) {\n        read(x);\n        for(int j=0;j<=15;++j) {\n            int k=Mod(x,j+1);\n            t.insert(t.root[j],0,(1<<(j+1))-1,k);\n        }\n    }\n    while(m--) {\n        if(get()=='A') read(x),a+=x,a=Mod(a,16);\n        else {\n            read(x);\n            if(x>=16) continue;\n            int k=Mod(a,x+1),l=(1<<x)-k,r=(1<<(x+1))-k-1;\n            if(l<0) {\n                int nr=(1<<(x+1))-1;\n                ans+=t.query(t.root[x],0,nr,nr+l+1,nr);\n                l=0;\n            }\n            ans+=t.query(t.root[x],0,(1<<(x+1))-1,l,r);\n        }\n    }\n    return !printf(\"%lld\\n\",ans);\n}\n\n```",
        "postTime": 1560097464,
        "uid": 125925,
        "name": "zl_just",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4641 \u3010[BJWC2008]\u5e8f\u5217\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a  \n\u7ed9\u4f60\u4e00\u4e2a\u5e8f\u5217\uff0c\u652f\u6301\u5168\u5c40\u52a0\u53ca\u67e5\u8be2\u4e8c\u8fdb\u5236\u67d0\u4f4d\u4e3a $1$ \u7684\u6570\u7684\u4e2a\u6570\uff0c\u5e8f\u5217\u4e2d\u7684\u6570\u5bf9 $65536$ \u53d6\u6a21\u3002\n___\n\u8bbe\u5e8f\u5217\u4e2d\u7684\u6570\u7684\u503c\u57df\u4e3a $v$\u3002\n___\n\u6ce8\u610f\u5230\u64cd\u4f5c\u90fd\u662f\u5168\u5c40\u7684\uff0c\u6240\u4ee5\u5e8f\u5217\u4e2d\u7684\u6570\u53ef\u4ee5\u5f00\u6876\u6765\u5b58\uff0c\u5168\u5c40\u52a0\u4e5f\u53ef\u4ee5\u7528\u6807\u8bb0\u89e3\u51b3\u3002\n\n\u5bf9\u4e8e\u67e5\u8be2\uff0c\u9700\u8981\u8ba1\u5165\u7b54\u6848\u7684\u6570\u7684\u533a\u95f4\u662f $[k\\cdot2^{i+1}+2^i,(k+1)\\cdot2^{i+1})$\uff0c\u66b4\u529b $O(mv)$\u3002~~\u52a0\u4e2a\u6307\u4ee4\u96c6\u5c31\u53ef\u4ee5\u8fc7\u4e86\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/3ot5sjt3)\u3002~~\n\n\u901a\u8fc7\u89c2\u5bdf\u53d1\u73b0\u5176\u7b54\u6848\u53ea\u4e0e\u52a0\u4e0a\u7684\u6570\u7684\u548c\u7684\u540e $i$ \u4f4d\u6709\u5173\uff0c\u7528\u524d\u7f00\u548c\u53ca\u8bb0\u5fc6\u5316\u4f18\u5316\u540e\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002~~\u53ef\u4ee5\u5361\u5230\u6700\u4f18\u89e3~~\u3002\n\nAC\u4ee3\u7801\uff1a\uff08$O(n+v\\log v),191ms$\uff09\n```cpp\n#include<bits/stdc++.h>\nint n,m,a2;\nchar c;\nunsigned short p,x;\nint sum[131088],cnt[131088],ans[17][65537];\nbool vis[17][65537];\nint main()\n{\n\tregister long long anss=0;\n\tregister unsigned short p=0;\n\tscanf(\"%d%d\",&n,&m); \n\tfor(int i=0;i<n;i++)scanf(\"%d\",&a2),++cnt[a2],++cnt[a2+65536];\n\tsum[0]=cnt[0];\n\tfor(int i=1;i<131088;i++)sum[i]=sum[i-1]+cnt[i];\n\twhile(m--)\n\t{\n\t\tscanf(\"%s%d\",&c,&x);\n\t\tif(c=='A')p+=x;\n\t\telse\n\t\t{\n\t\t\tif(vis[x][p&((2<<x)-1)])anss+=ans[x][p&((2<<x)-1)];\n\t\t\telse\n\t\t\t{\n\t\t\t\tregister int ansa=0;\n\t\t\t\tfor(register int i=(2<<x)-1;i<65536;i+=2<<x)ansa+=sum[65536-p+i]-sum[65536-p+i-(1<<x)];\n\t\t\t\tvis[x][p&((2<<x)-1)]=1,anss+=(ans[x][p&((2<<x)-1)]=ansa);\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%lld\",anss);\n\treturn 0;\n}\n```",
        "postTime": 1599219264,
        "uid": 44840,
        "name": "123456zmy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4641 \u3010[BJWC2008]\u5e8f\u5217\u3011"
    },
    {
        "content": "\u9996\u5148\u89c2\u5bdf\u5230\u662f\u5168\u5c40\u52a0\uff0c\u53ef\u7528\u53d8\u91cfX\u8868\u793a\u3002 \n\n\u7136\u540e\u5bf9\u4e8e\u4f9d\u6b21\u8be2\u95ee\uff0c\u5927\u529b\u8f6c\u79fb\u4e00\u6cd5\u8be2\u95ee\u8303\u56f4\u3002 \n\n\u7136\u540e\u968f\u4fbf\u7528\u4e00\u4e0b\u7ebf\u6bb5\u6811\u5c31OK\u8fa3\u3002\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<algorithm>\n#define N 65535\nusing namespace std;\nchar s[10];\nint n,m,x,t,X,l,r,mo;\nint v[16][270000];\nlong long ans; \nvoid change(int K,int k,int l,int r,int p)\n{\n    v[K][k]++;\n    if (l==r) return;\n    int mid=(l+r)/2;\n    if (p<=mid) change(K,k*2,l,mid,p);\n    else change(K,k*2+1,mid+1,r,p);\n}\nint ask(int K,int k,int l,int r,int x,int y)\n{\n    if (l==x&&r==y) return v[K][k];\n    int mid=(l+r)/2;\n    if (y<=mid) return ask(K,k*2,l,mid,x,y);\n    if (x>mid) return ask(K,k*2+1,mid+1,r,x,y);\n    return ask(K,k*2,l,mid,x,mid)+ask(K,k*2+1,mid+1,r,mid+1,y);\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    while (n--)\n    {\n        scanf(\"%d\",&x);\n        t=0;\n        for (int i=0;i<16;i++)\n        {\n            t+=x&(1<<i);\n            change(i,1,0,N,t);\n        }\n    }\n    while (m--)\n    {\n        scanf(\"%s\",s);\n        if (s[0]=='A')\n        {\n            scanf(\"%d\",&x);\n            X+=x;\n        }\n        if (s[0]=='Q')\n        {\n            scanf(\"%d\",&x);\n            if (x>=16)\n            {\n                puts(\"0\");\n                continue;\n            }\n            l=1<<x; r=l*2-1; mo=r+1;\n            l=(l-X%mo+mo)%mo;\n            r=(r-X%mo+mo)%mo;\n            if (l<=r) ans+=ask(x,1,0,N,l,r);\n            else ans+=ask(x,1,0,N,l,N)+ask(x,1,0,N,0,r);\n        }\n    }\n    printf(\"%lld\",ans);\n}\n```",
        "postTime": 1561202255,
        "uid": 98954,
        "name": "\u4e0d\u5b58\u5728\u4e4b\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4641 \u3010[BJWC2008]\u5e8f\u5217\u3011"
    }
]