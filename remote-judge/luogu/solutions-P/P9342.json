[
    {
        "content": "~~\u8d81\u65b0\u9898\u8d76\u7d27\u53d1\u4e00\u7bc7\u9898\u89e3~~\n\n\u9996\u5148\u5bb9\u6613\u53d1\u73b0\uff0c\u6211\u4eec\u53ea\u9700\u8981\u9884\u5904\u7406\u51fa\u6bcf\u4e2a $A_i$ \u7684\u7b54\u6848\u5373\u53ef\u3002\n\n\u800c\u4e14\uff0c\u6bcf\u6b21\u64cd\u4f5c\u5b8c\u8bbf\u95ee\u8fc7\u7684\u666f\u70b9\u4e00\u5b9a\u662f\u4e00\u4e2a\u8fde\u7eed\u6bb5\uff0c\u4e14\u4e00\u6b21\u5fc5\u5b9a\u8bbf\u95ee\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u7684\u5de6\u8fb9\u6216\u8005\u53f3\u8fb9\u3002\n\n\u5982\u679c\u628a\u8bbf\u95ee\u5de6\u8fb9\u8bb0\u4f5c `L`\uff0c\u53f3\u8fb9\u8bb0\u4f5c `R`\uff0c\u5e76\u5c06\u64cd\u4f5c\u5e8f\u5217\u770b\u6210\u4e00\u4e2a\u4e32\uff0c\u90a3\u4e48\u7ecf\u8fc7\u4e00\u5b9a\u89c2\u5bdf\uff0c\u53ef\u4ee5\u53d1\u73b0 `L` \u548c `R` \u7ec4\u6210\u7684\u8fde\u7eed\u6bb5\u4e2a\u6570\u4e0d\u662f\u5f88\u591a\u3002\u4e8b\u5b9e\u4e0a\uff0c\u53ef\u4ee5\u8bc1\u660e\u8fde\u7eed\u6bb5\u7684\u4e2a\u6570\u662f $\\Theta(\\log X)$ \u7684\u3002\n\n\u8bc1\u660e\u5982\u4e0b\uff1a\n\n\u8003\u8651\u6bcf\u6b21\u6539\u53d8\u65b9\u5411\u65f6\u4e0d\u9009\u62e9\u7684\u8f83\u5927\u7684\u8ddd\u79bb\u3002\u8bb0\u7b2c $k$ \u6b21\u7684\u8ddd\u79bb\u4e3a $L_k$\u3002\n\n\u653e\u4e00\u5f20\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/rk5jk1y0.png)\n\n\u90a3\u4e48\u53ef\u4ee5\u770b\u51fa:\n\n$$L_k\\geq L+L_{k-1}=\\sum_{i=1}^{k-1}L_{i}$$\n\n\u8bbe $S_k=\\sum_{i=1}^kL_i$\u3002\n\n\u5219\u7531\u4e0a\u9762\u7684\u5f0f\u5b50\u53ef\u4ee5\u5f97\u5230 $S_k\\geq2S_{k-1}$\u3002\n\n\u53c8\u56e0\u4e3a $\\forall k,S_k\\leq X_n-X_1$\uff0c\u56e0\u6b64\u53ea\u6709 $\\Theta(\\log X)$ \u4e2a\u8fde\u7eed\u6bb5\u3002\n\n\u8fd9\u6837\u53ea\u8981\u80fd\u5feb\u901f\u627e\u5230\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u7684\u7ed3\u675f\u4f4d\u7f6e\u5c31\u505a\u5b8c\u4e86\u3002\u4e00\u79cd\u7b80\u6d01\u7684\u505a\u6cd5\u662f\u4f7f\u7528 ST \u8868+\u500d\u589e\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n\\log^2n+q\\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define rep(i,a,b) for(ll i=(a);i<=(b);i++)\n#define per(i,a,b) for(ll i=(a);i>=(b);i--)\n#define re(i,a,b) for(ll i=(a);i<(b);i++)\n#define pe(i,a,b) for(ll i=(a);i>(b);i--)\n#define getchar()(p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ntemplate <typename T>\ninline void read(T& r) {\n\tr=0;bool w=0; char ch=getchar();\n\twhile(ch<'0'||ch>'9') w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9') r=r*10+(ch^48), ch=getchar();\n\tr=w?-r:r;\n}\nconst ll N=200003,M=3003,INF=2000000000000000007ll;\nll n,q,a[N],ans[N],st1[20][N],st2[20][N];\nint main(){\n\tread(n);\n\trep(i,1,n)read(a[i]);\n\tif(n==1){\n\t\tread(q);\n\t\trep(i,1,q){\n\t\t\tll in;\n\t\t\tread(in);\n\t\t\tprintf(\"%lld\\n\",abs(in-a[1]));\n\t\t}\n\t\treturn 0;\n\t}\n\trep(i,1,n-1)st1[0][i]=2*a[i]-a[i+1];\n\tst1[0][n]=-1000000007;\n\trep(i,2,n)st2[0][i]=2*a[i]-a[i-1];\n\tst2[0][1]=1000000007;\n\trep(l,1,19){\n\t\trep(i,1,n)if(i+(1<<(l-1))<=n)st1[l][i]=min(st1[l-1][i],st1[l-1][i+(1<<(l-1))]);else st1[l][i]=st1[l-1][i];\n\t\tper(i,n,1)if(i-(1<<(l-1))>=1)st2[l][i]=max(st2[l-1][i],st2[l-1][i-(1<<(l-1))]);else st2[l][i]=st2[l-1][i];\n\t}\n\ta[0]=-1000000007,a[n+1]=2000000014;\n\trep(i,1,n){\n\t\tll tl=i,tr=i;\n\t\tbool dir=0;\n\t\tif(a[i]-a[i-1]<=a[i+1]-a[i])dir=0;\n\t\telse dir=1;\n\t\tll res=0;\n\t\twhile(tl!=1||tr!=n){\n\t\t\tif(dir==0){\n\t\t\t\tll pos=tl;\n\t\t\t\tper(j,19,0){\n\t\t\t\t\tif(pos<=(1<<j)+1)continue;\n\t\t\t\t\tll o=st2[j][pos-1];\n\t\t\t\t\tif(o<=a[tr+1])pos-=(1<<j);\n\t\t\t\t}\n\t\t\t\tpos--;\n\t\t\t\tres+=a[tr]-a[pos];\n\t\t\t\ttl=pos;\n\t\t\t\tdir=1;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tll pos=tr;\n\t\t\t\tper(j,19,0){\n\t\t\t\t\tif(pos+(1<<j)>=n)continue;\n\t\t\t\t\tll o=st1[j][pos+1];\n\t\t\t\t\tif(o>a[tl-1])pos+=(1<<j);\n\t\t\t\t}\n\t\t\t\tpos++;\n\t\t\t\tres+=a[pos]-a[tl];\n\t\t\t\ttr=pos;\n\t\t\t\tdir=0;\n\t\t\t}\n\t\t}\n\t\tans[i]=res;\n\t}\n\tread(q);\n\trep(i,1,q){\n\t\tll in;\n\t\tread(in);\n\t\tll o1=lower_bound(a+1,a+n+1,in)-a;\n\t\tll o2=o1-1;\n\t\tif(in-a[o2]<=a[o1]-in)printf(\"%lld\\n\",ans[o2]+in-a[o2]);\n\t\telse printf(\"%lld\\n\",ans[o1]+a[o1]-in);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1684726385,
        "uid": 198266,
        "name": "Y2hlbnlpa2Fp",
        "ccfLevel": 7,
        "title": "P9342 \u9898\u89e3"
    }
]