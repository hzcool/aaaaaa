[
    {
        "content": "\u8bb2\u9053\u7406\uff0c\u8fd9\u9898\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\u3002  \n~~\u867d\u7136\u7528 Taylor \u5c55\u5f00+\u7ef4\u62a4 $k$ \u6b21\u65b9\u548c\u4e5f\u53ef\u4ee5\u505a\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a T \u6389\uff08~~  \nTaylor \u5c55\u5f00\u76f4\u63a5\u7cbe\u5ea6\u5c31\u70b8\u4e86\uff0c\uff0c\u6ca1\u6cd5\u505a\u3002\n\n\u8003\u8651\u7528\u4e00\u79cd\u597d\u60f3\u53c8\u597d\u5199\u7684\u505a\u6cd5\uff1a\n\n$$\\sin(a+x)=\\sin a\\cos x+\\cos a\\sin x$$\n$$\\cos(a+x)=\\cos a\\cos x-\\sin a \\sin x$$\n\n\u7136\u540e\u968f\u4fbf\u600e\u4e48\u7ef4\u62a4\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\uff0c\uff0c\n\n\u4e8e\u662f\u5728 $\\Theta(m \\log n)$ \u7684\u590d\u6742\u5ea6\u5185\u5c31\u80fd\u89e3\u51b3\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#define reg register\n#define N 200003\n#define ls (u<<1)\n#define rs (u<<1|1)\n#define mid ((l+r)>>1)\nusing namespace std;\n\ninline void read(int &x){\n    x = 0;\n    char c = getchar();\n    while(c<'0'||c>'9') c = getchar();\n    while(c>='0'&&c<='9'){\n        x = (x<<3)+(x<<1)+(c^48);\n        c = getchar();\n    }\n}\n\nint n,q;\nint a[N];\ndouble sink,cosk;\n\nstruct Segment_Tree{\n    double sine[N<<2],cosi[N<<2];\n    long long tag[N<<2];\n\n    inline void pushup(int u){\n        sine[u] = sine[ls]+sine[rs];\n        cosi[u] = cosi[ls]+cosi[rs];\n    }\n\n    inline void update(int u,double sinx,double cosx){\n        double sina = sine[u],cosa = cosi[u];\n        sine[u] = sina*cosx + cosa*sinx;\n        cosi[u] = cosa*cosx - sina*sinx;\n    }\n\n    inline void pushdown(int u){\n        if(!tag[u]) return;\n        double sinx = sin(tag[u]),cosx = cos(tag[u]);\n        update(ls,sinx,cosx);\n        update(rs,sinx,cosx);\n        tag[ls] += tag[u];\n        tag[rs] += tag[u];\n        tag[u] = 0;\n    }\n\n    void build(int l,int r,int u){\n        if(l==r){\n            sine[u] = sin(a[l]);\n            cosi[u] = cos(a[l]);\n            return;\n        }\n        build(l,mid,ls);\n        build(mid+1,r,rs);\n        pushup(u);\n    }\n\n    void modify(int nl,int nr,int l,int r,int u,int k){\n        if(nl<=l&&r<=nr){\n            update(u,sink,cosk);\n            tag[u] += k;\n            return;\n        }\n        pushdown(u);\n        if(nl<=mid) modify(nl,nr,l,mid,ls,k);\n        if(nr>mid) modify(nl,nr,mid+1,r,rs,k);\n        pushup(u);\n    }\n\n    double query(int nl,int nr,int l,int r,int u){\n        if(nl<=l&&r<=nr) return sine[u];\n        double res = 0;\n        pushdown(u);\n        if(nl<=mid) res += query(nl,nr,l,mid,ls);\n        if(nr>mid) res += query(nl,nr,mid+1,r,rs);\n        return res;\n    }\n}T;\n\nint main(){\n    int op,l,r,k;\n    read(n);\n    for(reg int i=1;i<=n;++i) read(a[i]);\n    T.build(1,n,1);\n    read(q);\n    while(q--){\n        read(op),read(l),read(r);\n        if(op==1){\n            read(k);\n            sink = sin(k),cosk = cos(k);\n            T.modify(l,r,1,n,1,k);\n        }else printf(\"%.1lf\\n\",T.query(l,r,1,n,1));\n    }\n    return 0;\n}\n```",
        "postTime": 1566919329,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]D1T1\u3011"
    },
    {
        "content": "~~Ynoi\u51fa\u6570\u5b66~~\n\n\u6211\u4eec\u6709\u516c\u5f0f\uff1a\n\n$$\n\\sin(\\alpha+\\beta)=\\sin(\\alpha)\\cos(\\beta)+\\sin(\\beta)\\cos(\\alpha)$$\n$$\n\\cos(\\alpha+\\beta)=\\cos(\\alpha)\\cos(\\beta)-\\sin(\\beta)\\sin(\\alpha)\n$$\n\n\u7136\u540e\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4$\\sin$\u548c\u4e0e$\\cos$\u548c\uff0c\u4fee\u6539\u65f6\u4ee4$\\beta=v$\u7136\u540e\u4ee3\u5165\u4e0a\u9762\u7684\u5f0f\u5b50\u5373\u53ef\u66f4\u65b0\u4e00\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\u3002\u6253\u6807\u8bb0\u53ea\u9700\u8bb0\u5f55\u6bcf\u4e2a\u533a\u95f4\u88ab\u6574\u4f53\u52a0\u4e86\u591a\u5c11\u5c31\u597d\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O((n+m)\\log n)$\u3002",
        "postTime": 1566910728,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]D1T1\u3011"
    },
    {
        "content": "\u590d\u6570\u89e3\u6cd5\uff0c\u5e38\u6570\u5f88\u5c0f\u3002\n\n\u6211\u4eec\u6709\u516c\u5f0f\uff1a\n\n$(\\cos(\\alpha)+i\\sin(\\alpha))\\times(\\cos(\\beta)+i\\sin(\\beta))=\\cos(\\alpha+\\beta)+i\\sin(\\alpha+\\beta)$\n\n\u53ef\u4ee5\u8003\u8651\u7ef4\u62a4\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $\\cos(ai)+i\\sin(ai)$ \uff0c\u7ebf\u6bb5\u6811\u533a\u95f4\u548c\uff0c\u63d0\u53d6\u865a\u90e8\u5373\u4e3a\u6240\u6c42\u3002\n\n\u5bf9\u4e8e\u4fee\u6539\u64cd\u4f5c\uff0c\u7ebf\u6bb5\u6811\u6253\u4e58\u6cd5\u6807\u8bb0 $\\cos(v)+i\\sin(v)$ \u5373\u53ef\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<cstdio>\n#include<cmath>\nstruct C{//\u590d\u6570\u7c7b\n\tdouble x,y;\n\tinline C operator+(C b)const{return{x+b.x,y+b.y};}\n\tinline C operator*(C b)const{return{x*b.x-y*b.y,x*b.y+y*b.x};}\n}s[525009],t[525009],w;\nint a[200009],u,v;\nvoid build(int k,int l,int r){//\u5efa\u6811\n\tt[k]={1,0};\n\tif(l==r){\n\t\ts[k]={cos(a[l]),sin(a[l])};\n\t\treturn;\n\t}\n\tregister int m=l+r>>1,a=k<<1,b=a|1;\n\tbuild(a,l,m),build(b,m+1,r),s[k]=s[a]+s[b];\n}\ninline void down(int k,int a,int b){//\u6807\u8bb0\u4e0b\u4f20\n\tif(t[k].y||t[k].x!=1)s[a]=s[a]*t[k],s[b]=s[b]*t[k],t[a]=t[a]*t[k],t[b]=t[b]*t[k],t[k]={1,0};\n}\nvoid upd(int k,int l,int r){//\u4fee\u6539\n\tif(u<=l&&r<=v){\n\t\ts[k]=s[k]*w,t[k]=t[k]*w;\n\t\treturn;\n\t}\n\tregister int m=l+r>>1,a=k<<1,b=a|1;\n\tdown(k,a,b);\n\tif(u<=m)upd(a,l,m);\n\tif(m<v)upd(b,m+1,r);\n\ts[k]=s[a]+s[b];\n}\nC qry(int k,int l,int r){//\u8be2\u95ee\n\tif(u<=l&&r<=v)return s[k];\n\tregister int m=l+r>>1,a=k<<1,b=a|1;\n\tdown(k,a,b);\n\tif(u<=m&&m<v)return qry(a,l,m)+qry(b,m+1,r);\n\tif(u<=m)return qry(a,l,m);\n\treturn qry(b,m+1,r);\n}\nint main(){\n\tregister int n,m,i,j;\n\tscanf(\"%d\",&n);\n\tfor(i=1;i<=n;++i)scanf(\"%d\",a+i);\n\tbuild(1,1,n),scanf(\"%d\",&m);\n\twhile(m--){\n\t\tscanf(\"%d%d%d\",&i,&u,&v);\n\t\tif(i==1)scanf(\"%d\",&j),w={cos(j),sin(j)},upd(1,1,n);\n\t\telse printf(\"%.1lf\\n\",qry(1,1,n).y);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1580128246,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]NOIP2015\u6d0b\u6ea2\u7740\u5e0c\u671b\u3011"
    },
    {
        "content": "\u90a3\u4e48\u8fd9\u9053\u9898\u7684\u516c\u5f0f\u5df2\u7ecf\u6709\u4eba\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u5c31\u662f\u9ad8\u4e00\u7684\u548c\u5dee\u89d2\u516c\u5f0f\n$$sin(x+y)=sin\\ x \\ cos\\ y + cos\\ x\\ sin\\ y$$\n$$cos(x+y)=cos\\ x \\ cos\\ y - sin\\ x\\ sin\\ y$$\n\n\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u9053\u9898\u6765\u8bf4\uff0c\u6211\u4eec\u5462\u7ef4\u62a4\u6bcf\u4e00\u4e2a\u8282\u70b9\u7684`sin`\u548c`cos`\u503c\u3002\u5982\u679c\u8981\u5c06\u53f6\u8282\u70b9`x`\u52a0\u4e0a`c`\uff0c\u6211\u4eec\u5c31\u7b97\u51fa`x`\u548c`c`\u7684`sin`\u548c`cos`\u503c\uff0c\u7136\u540e\u7528\u516c\u5f0f\u66f4\u65b0\u8fd9\u4e2a\u8282\u70b9\u7684`sin`\u548c`cos`\u3002\n\n\u800c\u4e00\u4e2a\u975e\u53f6\u8282\u70b9\uff0c\u5b83\u7684`sin`\u503c\uff08`cos`\u540c\u7406\uff09\u662f\u7b49\u4e8e\u5b50\u6811\u7684`sin`\u503c\u52a0\u8d77\u6765\u7684\u548c\uff0c\u8bbe\u4ed6\u7684\u6240\u6709\u503c\u5206\u522b\u4e3a`l`\u548c`r`\uff0c\u90a3\u4e48\n\n$$sin(l+c)+sin(r+c)=sin\\ l\\ cos\\ c + sin\\ c\\ cos\\ l + sin\\ r\\ cos\\ c + cos\\ r\\ sin\\ c$$\n\n$$= cos\\ c\\ (sin\\ l + sin\\ r) + sin\\ c(cos\\ l + cos\\ r)$$\n\n\u90a3\u4e48$(sin\\ l + sin\\ r)$\u5c31\u662f\u672c\u8282\u70b9\u7684`sin`\u503c\uff0c$(cos\\ l + cos\\ r)$\u5c31\u662f\u672c\u8282\u70b9\u7684`cos`\u503c\uff0c\u6700\u540e\u4ecd\u5316\u4e3a\u4e86\u548c\u89d2\u516c\u5f0f\uff0c\u6240\u4ee5\u975e\u53f6\u8282\u70b9\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528\u548c\u5dee\u89d2\u66f4\u65b0\n\n\u5361\u5e38\uff1a\u5c06\u8bfb\u5165\u7684\u589e\u91cf\u9884\u5148\u8ba1\u7b97`sin`\u548c`cos`\u503c\uff0c\u53e6\u5916\u8981\u5f00`long long`\n\n```cpp\n#pragma GCC optimize(\"Ofast\")\n#define MAX (200000 + 7)\n#include <bits/stdc++.h>\ntypedef double d64;\n\nint N, M, pd[MAX];\nd64 sc, cc;\n\nvoid read(int &a)\n{\n\tstatic char c = getchar();\n\tfor (a=0; c<'0'||'9'<c; c=getchar());\n\tfor (; '0'<=c && c<='9'; c=getchar())\n\t\ta = a * 10 + (c & 15);\n}\n\nstruct Segtree\n{\n\t#define i0 (i << 1)\n\t#define i1 (i << 1 | 1)\n\tstruct Node { \n\t\tint L, R;\n\t\tlong long fa;\n\t\td64 sin, cos;\n\t} a[MAX << 2];\n\tvoid update(int i, d64 sc, d64 cc)\n\t{\n\t\td64 si = a[i].sin, ci = a[i].cos;\n\t\ta[i].sin = si * cc + ci * sc;\n\t\ta[i].cos = cc * ci - si * sc;\n\t}\n\tvoid pushup(int i)\n\t{\n\t\ta[i].sin = a[i0].sin + a[i1].sin;\n\t\ta[i].cos = a[i0].cos + a[i1].cos;\n\t}\n\tvoid pushdown(int i)\n\t{\n\t\tlong long &x = a[i].fa;\n\t\tif (!x) return;\n\t\td64 sx = sin(x), cx = cos(x);\n\t\tupdate(i0, sx, cx), a[i0].fa += x;\n\t\tupdate(i1, sx, cx), a[i1].fa += x;\n\t\tx = 0;\n\t}\n\tvoid init(int i, int L, int R)\n\t{\n\t\ta[i].L = L, a[i].R = R;\n\t\tif (L != R) {\n\t\t\tint mid = L + R >> 1;\n\t\t\tinit(i0, L, mid), init(i1, mid+1, R);\n\t\t\tpushup(i);\n\t\t} \n\t\telse\n\t\t\ta[i].sin = sin(pd[L]), a[i].cos = cos(pd[R]);\n\t}\n\tvoid add(int i, int L, int R, int c)\n\t{\n\t\tif (a[i].R < L || R < a[i].L) return;\n\t\tif (L <= a[i].L && a[i].R <= R)\n\t\t{\n\t\t\tupdate(i, sc, cc);\n\t\t\ta[i].fa += c; return;\n\t\t}\n\t\tpushdown(i);\n\t\tadd(i0, L, R, c), add(i1, L, R, c);\n\t\tpushup(i);\n\t}\n\td64 sum(int i, int L, int R)\n\t{\n\t\tif (a[i].R < L || R < a[i].L) return 0;\n\t\tif (L <= a[i].L && a[i].R <= R)\n\t\t\treturn a[i].sin;\n\t\tpushdown(i);\n\t\treturn sum(i0, L, R) + sum(i1, L, R);\n\t}\n} Seg;\n\nint main()\n{\n\tread(N);\n\tfor (int i = 1; i <= N; i++)\n\t\tread(pd[i]);\n\tread(M), Seg.init(1, 1, N);\n\t\n\tfor (int i = 1, op, l, r, c; i <= M; i++)\n\t{\n\t\tread(op), read(l), read(r);\n\t\tif (op - 1) \n\t\t\tprintf(\"%.1lf\\n\", Seg.sum(1, l, r));\n\t\telse\n\t\t{\n\t\t\tread(c), sc = sin(c), cc = cos(c); \n\t\t\tSeg.add(1, l, r, c);\n\t\t}\n\t}\n}\n```",
        "postTime": 1572021783,
        "uid": 73489,
        "name": "NyaRu_Official",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]D1T1\u3011"
    },
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c -> [\u63a8\u9500\u535a\u5ba2](https://nikaidou-shinku.github.io/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91-Luogu5524-Ynoi2012D1T1/)\n\n---\n\n# \u524d\u8a00\n\n\u8fd9\u5e94\u8be5\u662f\u6700\u6c34\u7684 Ynoi \u9898\u4e86\u5427\uff0c\u4e0d\u9700\u8981\u5f88\u9ad8\u7ea7\u7684\u6570\u636e\u7ed3\u6784\u4e5f\u4e0d\u9700\u8981\u4ec0\u4e48\u5947\u6280\u6deb\u5de7\uff0c\u53ef\u4ee5\u5f53\u505a\u7ebf\u6bb5\u6811\u7ec3\u624b\u9898\u3002\n\n---\n\n# \u6b63\u6587\n\n\u6211\u7b2c\u4e00\u773c\u770b\u89c1\u64cd\u4f5c $2$ \u7684\u65f6\u5019\u5dee\u70b9\u5413\u50bb\uff1a\u533a\u95f4 $\\sin$ \u548c\uff01\n\n\u4f46\u662f\u4e0d\u7528\u614c\uff0c\u7ef4\u62a4\u8fd9\u79cd\u5c11\u89c1\u7684\u4fe1\u606f\u6709\u4e24\u4e2a\u6bd4\u8f83\u5957\u8def\u7684\u65b9\u6cd5\uff1a\n\n1. \u62c6\u5206\u6210\u597d\u7ef4\u62a4\u7684\u4fe1\u606f\n2. \u76f4\u63a5\u7ef4\u62a4\uff0c\u8003\u8651\u4fee\u6539\u5bf9\u5176\u7684\u5f71\u54cd\n\n\u6211\u5f00\u59cb\u60f3\u7684\u662f\u65b9\u6cd5 $1$ \uff0c\u5341\u5206 naive \u5730\u5c1d\u8bd5\u628a $\\sin x$ \u5c55\u5f00\u6210\u9ea6\u514b\u52b3\u6797\u7ea7\u6570\uff0c\u7136\u540e\u7ef4\u62a4\u533a\u95f4 $k$ \u6b21\u65b9\u548c\uff0c\u540e\u6765\u53d1\u73b0\u533a\u95f4\u52a0\u4e4b\u540e\u7cbe\u5ea6\u4f1a\u5f88\u60e8\u70c8...\n\n\u4e8e\u662f\u4f7f\u7528\u65b9\u6cd5 $2$ \uff0c\u8003\u8651\u52a0\u6cd5\u5bf9\u8fd9\u4e2a\u4e1c\u897f\u7684\u5f71\u54cd\uff0c\u7531\u548c\u89d2\u516c\u5f0f\uff1a\n$$\n\\sin(x+v)=\\sin x\\cos v+\\cos x\\sin v\n$$\n\n$$\n\\cos(x+v)=\\cos x\\cos v-\\sin x\\sin v\n$$\n\n\u7136\u540e\u5c31\u975e\u5e38\u597d\u505a\u4e86\uff0c\u6211\u4eec\u540c\u65f6\u7ef4\u62a4\u533a\u95f4 $\\sin$ \u548c\u8ddf\u533a\u95f4 $\\cos$ \u548c\uff0c\u4e0a\u4f20\u4fe1\u606f\u53ef\u4ee5\u76f4\u63a5\u76f8\u52a0\uff0c\u518d\u7ef4\u62a4\u4e00\u4e2a\u52a0\u6cd5\u6807\u8bb0\uff0c\u7528\u4e0a\u9762\u7684\u548c\u89d2\u516c\u5f0f\u53ef\u4ee5\u505a\u5230 $\\Theta(1)$ \u4e0b\u4f20\u6807\u8bb0\u3002\n\n```cpp\ninline void add(int id,i64 v) {\n    double x=sinv[id],y=cosv[id];\n    double p=sin(v),q=cos(v);\n    sinv[id]=x*q+y*p;\n    cosv[id]=y*q-x*p;\n    addv[id]+=v;\n}\n```\n\n\u5176\u5b83\u7684\u5c31\u662f\u7ebf\u6bb5\u6811\u6a21\u677f\u4e86\uff0c\u7136\u540e\u4f60\u5c31\u80fd\u901a\u8fc7\u8fd9\u9053\u9898\u3002\n\n\u5982\u679c\u4f60\u7684\u5e38\u6570\u8fc7\u5927\u53ef\u4ee5\u8003\u8651\u51cf\u5c11\u6c42 $\\sin$ \u548c $\\cos$ \u7684\u6b21\u6570\uff0c\u53ef\u4ee5\u5927\u5e45\u51cf\u5c0f\u5e38\u6570\u3002\n\n---\n\n# \u6700\u540e\n\nYnoi \u9898\u5c31\u4e0d\u8d34\u4ee3\u7801\u4e86\uff0c\u53cd\u6b63\u8fd9\u4e2a\u9898\u4ee3\u7801\u4e5f\u597d\u5199\u3002\n\n\u53e6\u5916\u8fd9\u4e2a\u9898\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8e\u539f\u5e8f\u5217\u7684 $x$ \u7ef4\u62a4 $e^{ix}$ \uff0c\u8fd9\u6837\u6bcf\u6b21\u4fee\u6539\u53ea\u9700\u8981\u7ef4\u62a4\u4e58\u6cd5\u6807\u8bb0\u5373\u53ef\u3002\n\n\u7531\u6b27\u62c9\u516c\u5f0f\uff0c\u67e5\u8be2\u65f6\u53ef\u4ee5\u76f4\u63a5\u63d0\u53d6\u865a\u90e8\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5e38\u6570\u4f1a\u5c0f\u4e9b\u3002",
        "postTime": 1566914456,
        "uid": 126486,
        "name": "yurzhang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]D1T1\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5462\uff0c\u8fd8\u662f\u5f88\u9700\u8981\u4e00\u70b9\u601d\u7ef4\u7684\u3002\n\n\u6211\u4e00\u5f00\u59cb\u770b\u5230\u8fd9\u9053\u9898\uff0c\u4ee5\u4e3a\u53ea\u662f\u57fa\u672c\u7684\u7ebf\u6bb5\u6811\u6c42\u548c\uff0c\u76f4\u63a5\u5957\u5c31\u662f\u4e86\uff0c\u7136\u540e\u53d1\u73b0\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/75393.png) \uff08~~\u70e6\u4eba\u7684\u6c34\u5370~~\uff09\n\n\u90a3\u5982\u679c\u8001\u8001\u5b9e\u5b9e\u7684\u76f4\u63a5\u52a0\uff0c\u4e0d\u5c31T\u4e86\u5417\uff08\u5927\u6982\u662fO(nm))\n\n\u4e8e\u662f\u60f3\u5230\u4e86\u4e00\u4e9b\u5173\u4e8e\u4e09\u89d2\u51fd\u6570\u7684\u5f88\u597d\u7684\u6027\u8d28\u2026\u2026\n\n\u5c31\u662f\u6700\u4e3a\u57fa\u672c\u7684\u4e09\u89d2\u51fd\u6570\u53d8\u6362\u516c\u5f0f\uff08~~\u63a8\u5bfc\u8fc7\u7a0b\u7565~~\uff09\n\n![](https://cdn.luogu.com.cn/upload/pic/75396.png)\n\n\u5f53\u7136\uff0c\u672c\u9898\u53ea\u9700\u8981\u7528\u5230\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e09\u4e2a\u5373\u53ef\u3002\n\n## \u603b\u7ed3\u4e00\u4e0b\uff1a\u672c\u9898\u5c31\u662f\u4e09\u89d2\u51fd\u6570+\u7ebf\u6bb5\u6811\uff08\u4e0d\u8981\u8ddf\u6211\u8bf4\u4f60\u7ebf\u6bb5\u6811\u4e0d\u4f1a\uff09\n\n\u6700\u540e\u9644\u4e0a\u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\n#include <iostream>\nusing namespace std;\n\n#define ll long long\nconst int MAXN=1000005;\n\ndouble s_n[MAXN],c_s[MAXN];\nint a[MAXN],n;\nll fflg[MAXN];\n\nint read(){\n    char c=getchar();int ans=0;\n    while (c<'0'||c>'9') c=getchar();\n    while (c>='0'&&c<='9') ans=(ans<<1)+(ans<<3)+(c^48),c=getchar();\n    return ans;\n}\n\n\n//\u4ee5\u4e0b\u662f\u57fa\u672c\u7684\u7ebf\u6bb5\u6811\u64cd\u4f5c\nvoid build(int L,int R,int rt){\n    if (L==R) {\n\t\ts_n[rt]=sin(a[L]);\n\t\tc_s[rt]=cos(a[L]);\n\t\treturn;\n\t}\n    int mid=(L+R)>>1;\n\tbuild(L,mid,rt<<1);\n\tbuild(mid+1,R,rt<<1|1);\n    s_n[rt]=s_n[rt<<1]+s_n[rt<<1|1];\n    c_s[rt]=c_s[rt<<1]+c_s[rt<<1|1];\n    return;\n}\n\nvoid pushup(int rt,double sinx,double cosx){\n    double Sum_sin=s_n[rt],Sum_cos=c_s[rt];\n    s_n[rt]=Sum_sin*cosx+Sum_cos*sinx;//\u91cd\u70b9\n    c_s[rt]=Sum_cos*cosx-Sum_sin*sinx;//\u91cd\u70b9\n    return;\n}\n\nvoid pushdown(int rt){\n    if (!fflg[rt]) return;\n    fflg[rt<<1]+=fflg[rt];\n\tfflg[rt<<1|1]+=fflg[rt];\n    double sinx=sin(fflg[rt]),cosx=cos(fflg[rt]);\n    pushup(rt<<1,sinx,cosx);\n\tpushup(rt<<1|1,sinx,cosx);\n    fflg[rt]=0;\n\treturn;\n}\n\nvoid modify(int L,int R,int l,int r,int rt,double sinx,double cosx,int x){\n    if (l<=L&&R<=r) {\n\t\tpushup(rt,sinx,cosx);\n\t\tfflg[rt]+=x;\n\t\treturn;\n\t}\n    int mid=(L+R)>>1;pushdown(rt);\n    if (mid>=l) modify(L,mid,l,r,rt<<1,sinx,cosx,x);\n    if (mid<r) modify(mid+1,R,l,r,rt<<1|1,sinx,cosx,x);\n    s_n[rt]=s_n[rt<<1]+s_n[rt<<1|1];\n    c_s[rt]=c_s[rt<<1]+c_s[rt<<1|1];\n    return;\n}\n\ndouble query(int L,int R,int l,int r,int rt){\n    if (l<=L&&R<=r) return s_n[rt];\n    if (l>R||L>r) return 0;pushdown(rt);int mid=(L+R)>>1;\n    return query(L,mid,l,r,rt<<1)+query(mid+1,R,l,r,rt<<1|1);\n}\n\nint main(){\n    scanf(\"%d\",&n);\n    int i;\n    for (i=1;i<=n;i++) a[i]=read();\n    build(1,n,1);\n    int m;\n    scanf(\"%d\",&m);\n    int what;\n    while(m--){\n        what=read();\n        int x,y,z;\n        switch(what){\n            case 1:{\n                x=read(),y=read(),z=read();\n\t\t\t\tmodify(1,n,x,y,1,sin(z),cos(z),z);\n                break;\n            }\n            case 2:{\n                x=read(),y=read();\n\t\t\t\tprintf(\"%.1lf\\n\",query(1,n,x,y,1));\n                break;\n            }\n        }\n    }\n    return 0;\n}\n```\n# \u5b8c\u7ed3\u6492\u82b1~~~",
        "postTime": 1566964471,
        "uid": 14871,
        "name": "kgory",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]D1T1\u3011"
    },
    {
        "content": "~~C(S)S(C)P(O)S(I)\u6a21\u62df\u8003\u6ca1\u5f00\u6587\u4ef6\u70b8\u5230145,\u4e8e\u662f\u6765luogu\u6c34\u5c31\u53d1\u73b0\u4e86\u8fd9\u9053\u9898~~\n\n\u5230\u9898\u4ee5\u4e3a\u6cf0\u52d2\u5c55\u5f00\u679c\u65ad\u653e\u5f03\uff0c\u540e\u6765\u53d1\u73b0\u7528\u53ef\u4ee5\u9ad8\u4e00\u6570\u5b66\u516c\u5f0f\uff1a\n\n$$\\sin\\alpha+\\beta=\\cos\\alpha\\sin\\beta+\\cos\\beta\\sin\\alpha$$\n\n$$\\cos\\alpha+\\beta=\\cos\\alpha\\cos\\beta-\\sin\\alpha\\sin\\beta$$\n\n~~\u6240\u4ee5\u6211\u5728\u6d1b\u8c37\u5b66\u6587\u5316\u8bfe~~\n\n\u8003\u8651\u6765\u8bc1\u660e\u8fd9\u4e2a\u516c\u5f0f\u3002\u5148\u8bf4\u7b2c\u4e8c\u4e2a\u3002\n\n\u5047\u8bbe\u5728\u5750\u6807\u7cfb\u4e0a\u6709\u4e24\u4e2a\u957f\u5ea6\u4e3a1\u7684\u5411\u91cf$A(\\cos\\alpha,\\sin\\alpha),B(\\cos\\beta,\\sin\\beta)$\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/tbhh8m24.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n~~\u4e0d\u8981\u55b7\u56fe\u4e11~~\n\n\u6839\u636e\u8bf1\u5bfc\u516c\u5f0f\uff0c$\\cos <A,B>=\\cos\\alpha+\\beta$\n\n\u6709$A\\cdot B=1*1*cos<A,B>=\\cos\\alpha\\cos\\beta-\\sin\\alpha\\sin\\beta$\n\n\u7b2c\u4e00\u4e2a\u516c\u5f0f\u5982\u679c\u81ea\u5df1\u4e71\u5b9a\u4e49\u5411\u91cf\u7684X\u79ef\u662f$|A|\\cdot|B|\\cdot\\sin<A,B>$\u7684\u8bdd\u81ea\u5df1\u63a8\u4e00\u4e0b\u5750\u6807\u5f62\u5f0f\u6309\u4e0a\u9762\u65b9\u6cd5\u6765\u5c31\u884c\u4e86\u3002\uff08\u4e25\u683c\u8bc1\u660e\u53c2\u8003\u60a8\u7684\u6570\u5b66\u4e66\uff09\n\n\u4e8e\u662f\u6bcf\u6b21\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4sin\u548c\u548ccos\u548c\u5c31\u597d\u4e86\u3002\u5177\u4f53\u7ef4\u62a4\u56e0\u4e3a\u4e58\u6cd5\u7684\u5206\u914d\u7387\uff0c\u628a\u6574\u4e2a\u533a\u95f4\u7684sincos\u548c\u770b\u6210\u4e00\u4e2a\u6574\u4f53\u5c31\u597d\u3002\n\n\u4ee3\u7801\uff08\u5341\u5e74OI\u4e00\u573a\u7a7a\uff0c\u4e0d\u5f00longlong\u89c1\u7956\u5b97\uff09\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#include <cmath>\n\nusing namespace std;\n\nint n, m, a[200005];\ndouble sk, ck;\n\ninline int read() {\n\tregister int s = 0, f = 1;\n\tregister char ch = getchar();\n\twhile (!isdigit(ch)) { if (ch == '-') f = -1; ch = getchar(); }\n\twhile (isdigit(ch)) s = (s << 1) + (s << 3) + (ch & 15), ch = getchar();\n\treturn s * f;\n}\n\nstruct node {\n\tint l, r;\n\tlong long lazy;\n\tdouble ss, cs;\n\tnode *left = NULL;\n\tnode *right = NULL;\n\t\n\tinline void plus(double s, double c) {\n\t\tdouble sss = ss, ccc = cs;\n\t\tthis -> ss = sss * c + ccc * s;\n\t\tthis -> cs = ccc * c - sss * s; \n\t}\n\t\n\tinline void pushdown() {\n\t\tif (!(this -> lazy)) return ;\n\t\tif (left != NULL) { left -> lazy += lazy; left -> plus(sin(lazy), cos(lazy)); }\n\t\tif (right != NULL) { right -> lazy += lazy; right -> plus(sin(lazy), cos(lazy)); }\n\t\tthis -> lazy = 0;\n\t}\n\t\n\tinline void update() {\n\t\tss = left -> ss + right -> ss;\n\t\tcs = left -> cs + right -> cs;\n\t}\n\t\n\tinline void build(int l, int r) {\n\t\tthis -> l = l; this -> r = r; lazy = 0;\n\t\tif (r <= l) ss = sin(a[l]), cs = cos(a[l]);\n\t\telse {\n\t\t\tleft = new node; left -> build(l, l + r >> 1);\n\t\t\tright = new node; right -> build((l + r >> 1) + 1, r);\n\t\t\tthis -> update();\n\t\t}\n\t}\n\t\n\tinline void modify(int l, int r, int k) {\n\t\tif (this -> l >= l && this -> r <= r) { this -> lazy += k; this -> plus(sk, ck); return ; }\n\t\tthis -> pushdown();\n\t\tif (left != NULL && left -> r >= l) left -> modify(l, r, k);\n\t\tif (right != NULL && left -> r < r) right -> modify(l, r, k);\n\t\tthis -> update();\n\t}\n\t\n\tinline double query(int l, int r) { \n\t\tif (this -> l >= l && this -> r <= r) return ss;\n\t\tdouble ret = 0; this -> pushdown();\n\t\tif (left != NULL && left -> r >= l) ret += left -> query(l, r);\n\t\tif (right != NULL && left -> r < r) ret += right -> query(l, r);\n\t\treturn ret;\n\t}\n};\n\nint main() {\n\tn = read();\n\tfor (int i = 1; i <= n; ++i) a[i] = read();\n\tnode *root = new node; root -> build(1, n);\n\tm = read();\n\twhile (m--) {\n\t\tint opt = read(), l = read(), r = read();\n\t\tif (opt == 1) {\n\t\t\tint k = read(); sk = sin(k); ck = cos(k);\n\t\t\troot -> modify(l, r, k);\n\t\t} else if (opt == 2) printf(\"%.1lf\\n\", root -> query(l, r));\n\t} return 0;\n} \n```\n",
        "postTime": 1573624217,
        "uid": 98096,
        "name": "Smallbasic",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5524 \u3010[Ynoi2012]D1T1\u3011"
    }
]