[
    {
        "content": "\u8fd9\u9898\u5f88\u5751\u7684\u662f\u6309\u7167\u539f\u9898\u7684\u65b9\u6cd5\u6700\u540e\u8981\u9664\u4ee5$n$\uff0c\u4f46$n$\u5728\u6a21\u610f\u4e49\u4e0b\u53ef\u80fd\u4e3a0\u3002\r\n\r\n\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u6309\u7167\u539f\u6765\u7684\u65b9\u6cd5\u6765\u3002\u53ea\u9700\u8981\u628a\u6a21\u6570\u6539\u4e3a${998244353}^2$\u5373\u53ef\u3002\r\n\r\n\u8003\u8651\u6700\u7ec8\u7684\u7b54\u6848\u5728\u4e0d\u53d6\u6a21\u65f6\u4e3a$c$\uff0c\u8bbe$c=a\\times 998244353^2+b$\u3002\r\n\r\n\u90a3\u4e48\u6709$c\\equiv b\\pmod{998244353^2}$\u3002\r\n\r\n\u5219\u663e\u7136\u6709$c\\equiv b\\bmod{998244353}\\pmod{998244353}$\u3002\r\n\r\n\u6240\u4ee5\u5f53$n$\u4e0d\u4e3a\u6a21\u6570\u7684\u500d\u6570\u7684\u65f6\u5019\uff0c\u6309\u7167\u8fd9\u6837\u8ba1\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u76f4\u63a5\u5bf9\u539f\u6a21\u6570\u53d6\u6a21\u5c31\u662f\u7b54\u6848\u3002\u7136\u540e\u9664\u4ee5$n$\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u9006\u5143\u3002\r\n\r\n\u8003\u8651\u5f53$n\\equiv 0\\pmod{998244353}$\u7684\u60c5\u51b5\u3002\u51fa\u9898\u4eba\u5df2\u7ecf\u8bc1\u660e\u7b54\u6848\u5b58\u5728\uff0c\u8fd9\u91cc\u4e0d\u4f5c\u8ba8\u8bba\u3002\r\n\r\n\u6b64\u65f6$c\\equiv 0\\pmod{998244353}$\u3002\r\n\r\n\u7531\u4e8e$a\\times 998244353^2\\equiv 0\\pmod{998244353}$\uff0c\u6240\u4ee5\u53ef\u77e5$b\\equiv 0\\pmod {998244353}$\u3002\r\n\r\n\u4e8e\u662f\u6211\u4eec\u8ba1\u7b97\u51fa\u7684$b$\u4e00\u5b9a\u662f$998244353$\u7684\u500d\u6570\uff0c\u90a3\u4e48\u9664\u6389\u5c31\u53ef\u4ee5\u4e86\u3002\r\n\r\n\u8fd9\u6837\u9700\u8981\u6d89\u53ca\u975e\u5e38\u591a\u7684```long long```\u8fd0\u7b97\uff0c\u6240\u4ee5\u901f\u5ea6\u975e\u5e38\u6162\uff0c\u5f88\u5361\u5e38\u3002\u4f46\u7531\u4e8e\u8fd9\u9898\u7684\u505a\u6cd5\u74f6\u9888\u5728\u4e8e\u7ebf\u6027\u7684\u5faa\u73af\uff0c\u6240\u4ee5\u52a0\u7f16\u8bd1\u6307\u4ee4\u96c6\u4f1a\u6709\u5947\u6548\u3002\r\n\r\n## Code\uff1a\r\n```cpp\r\n#pragma GCC optimize(\"Ofast\")\r\n#pragma GCC optimize(\"unroll-loops\")\r\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")\r\n#include<cstdio>\r\n#include<cctype>\r\nconst int N=1e7+10;\r\ntypedef long long LL;\r\nconst LL md=998244353LL*998244353;\r\ninline void upd(LL&a){a+=a>>63&md;}\r\ninline LL mul(LL a,LL b,const LL&md=998244353LL*998244353){\r\n    const LL tmp=a*b-(LL)((long double)a*b/md+.5)*md;\r\n    return(tmp>>63&md)+tmp;\r\n}\r\ninline LL pow(LL a,LL b,const LL&md=998244353LL*998244353){\r\n    LL ret=1;\r\n    for(;b;b>>=1,a=mul(a,a,md))if(b&1)ret=mul(ret,a,md);\r\n    return ret;\r\n}\r\ninline void exgcd(LL a,LL b,LL&x,LL&y){if(!b)x=1,y=0;else exgcd(b,a%b,y,x),y-=a/b*x;}\r\ninline LL getinv(LL a){\r\n    static LL x,y;\r\n    exgcd(a,md,x,y);\r\n    upd(x);\r\n    return x;\r\n}\r\nint k,vis[N],pri[N/10],tot;\r\nLL P[N],X[N];\r\nLL fac,iv[N],pre[N],suf[N],ans=0,n,ivv[N];\r\nvoid init(const int n){\r\n    P[1]=1;\r\n    for(int i=2;i<=n;++i){\r\n        if(!vis[i])pri[++tot]=i,P[i]=pow(i,k);\r\n        for(int j=1;j<=tot&&i*pri[j]<=n;++j){\r\n            vis[i*pri[j]]=1;\r\n            P[i*pri[j]]=mul(P[i],P[pri[j]]);\r\n            if(i%pri[j]==0)break;\r\n        }\r\n    }\r\n}\r\ninline LL query(LL x){\r\n    LL ret=0;\r\n    for(int i=1;i<=k+3;++i)\r\n    pre[i]=mul(pre[i-1],x-i+md);\r\n    for(int i=k+3;i;--i)\r\n    suf[i]=mul(suf[i+1],x-i+md);\r\n    for(int i=1;i<=k+3;++i)iv[i]=((k+3-i)&1)?(-mul(mul(pre[i-1],suf[i+1]),ivv[i])+md):mul(mul(pre[i-1],suf[i+1]),ivv[i]);\r\n    for(int i=1;i<=k+3;++i)upd(ret+=mul(X[i],iv[i])-md);\r\n    return ret;\r\n}\r\nvoid read(){\r\n    int c=getchar();\r\n    for(;!isdigit(c);c=getchar());\r\n    for(;isdigit(c);c=getchar())n=(n*10+(c^'0'))%998244353;\r\n    scanf(\"%d\",&k);\r\n}\r\nint main(){\r\n    read();\r\n    if(n==1){puts(\"0\");return 0;}\r\n    if(n==0)n=998244353;\r\n    init(k+5);\r\n    for(int i=fac=1;i<=k+3;++i)fac=mul(i,fac);\r\n    iv[k+3]=getinv(fac);\r\n    for(int i=k+3-1;~i;--i)iv[i]=mul(i+1,iv[i+1]);\r\n    for(int i=1;i<=k+3;++i)ivv[i]=mul(iv[i-1],iv[k+3-i]);\r\n    pre[0]=suf[k+4]=1;\r\n    for(int i=1;i<=k+3;++i)\r\n    upd(X[i]=X[i-1]+mul(i-1,P[i])-md);\r\n    ans=query(n+1);\r\n    for(int i=1;i<=k+3;++i)\r\n    upd(X[i]=X[i-1]+mul(P[i],P[2])-md);\r\n    ans=(ans-(LL)query(2*n+1>>1)+md)%md;\r\n    for(int i=1;i<=k+3;++i)\r\n    upd(X[i]=X[i-1]+mul((2*n+1-i+md)%md,P[i])-md);\r\n    ans=(ans+query(n<<1|1)-query(n+1)+md)%md;\r\n    if(n%998244353)\r\n    printf(\"%lld\\n\",ans%998244353*(LL)pow(n,998244351,998244353)%998244353);else\r\n    printf(\"%lld\\n\",ans/998244353);\r\n    return 0;\r\n}\r\n\r\n```",
        "postTime": 1563114796,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5442 \u3010\u3010XR-2\u3011\u7ea6\u5b9a (\u52a0\u5f3a\u7248)\u3011"
    },
    {
        "content": "\u6b64\u9898\u8fd8\u662f\u6765\u8865\u4e00\u7247\u9898\u89e3\u6bd4\u8f83\u597d\u3002\u3002  \n\u9996\u5148\u5bf9\u4e8e\u666e\u901a\u7248\u7684\u9898\u89e3\uff0c\u770b[\u8fd9\u91cc](https://www.luogu.org/blog/NaCly-Fish-blog/solution-of-yueding)\u5c31\u597d\u4e86\u3002  \n\n\u6b64\u5904\u53ea\u8be6\u7ec6\u8bb2\u5bf9\u4e8e $n\\equiv 0\\pmod{p}$ \u7684\u89e3\u6cd5\u3002\n****\n\u7531\u4e8e $n$ \u5728\u6a21 $p$ \u610f\u4e49\u4e0b\u4e3a $0$\uff0c\u6240\u4ee5\u6b64\u65f6 $n$ \u7684\u9006\u5143\u662f\u4e0d\u5b58\u5728\u7684\u3002  \n\n\u800c\u6700\u7ec8\u7b54\u6848\u53c8\u4e0d\u4e00\u5b9a\u662f $0$\u3002\u5c31\u6bd4\u5982 $k=1$ \u65f6\uff0c\u7b54\u6848\u5e94\u4e3a $p-1$\u3002  \n\n\u4f46\u662f\u6211\u4eec\u77e5\u9053\u7b54\u6848\u662f\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e2a\uff1a  \n\nps\uff1a\u4e0b\u9762\u8fd9\u4e2a\u5f0f\u5b50\u7684 $n$\uff0c\u8868\u793a\u7684\u662f\u70b9\u503c\u6570\u91cf\uff0c\u5373 $k+3$\u3002  \n$$\\large f(x)=\\sum\\limits_{i=0}^n\\frac{f(i)(-1)^{n-i}}{(i-1)!(n-i)!}\\prod\\limits_{j\\neq i}(x-j)$$  \n\u5bb9\u6613\u53d1\u73b0 $f(0)=0$\uff0c\u4e5f\u5c31\u662f\u8bf4 $f(x)$ \u7684\u5e38\u6570\u9879\u4e3a $0$\u3002  \n\n\u8fd9\u544a\u8bc9\u6211\u4eec\uff0c\u7b54\u6848\u662f\u53ef\u4ee5\u8868\u793a\u51fa\u6765\u7684\u3002\n\n\u5728\u539f\u672c\u7684\u505a\u6cd5\u4e2d\uff0c\u6211\u4eec\u6c42\u51fa $f(n)$\uff0c\u5c06\u5176\u4e58 $2$ \u518d\u9664 $n$\uff0c\u5f97\u5230\u7b54\u6848\u3002  \n\n\u4f46\u5728\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u4e0d\u4e00\u5b9a\u8981\u6c42\u51fa\u8fd9\u4e2a $f(n)$ \u5177\u4f53\u662f\u4ec0\u4e48\uff0c\u6240\u4ee5\u8fd8\u662f\u628a\u5b83\u5f53\u505a\u4e00\u4e2a\u591a\u9879\u5f0f\u6bd4\u8f83\u597d\u3002\n\n\u89c2\u5bdf\u4e00\u4e0b\u5f0f\u5b50\uff1a  \n$$\\large \\frac{2f(n)}{n} \\text{ mod }p$$  \n\u5c06 $f(n)$ \u9664 $n$\uff0c\u5c31\u76f8\u5f53\u4e8e\u662f $f(n)$ \u7684\u6bcf\u4e00\u9879\u90fd\u964d\u4e86\u4e00\u6b21\u3002  \n\n\u800c\u7531\u4e8e $p|n$\uff0c\u6240\u4ee5\u6a21 $p$ \u4e4b\u540e\uff0c\u9664\u4e86\u5e38\u6570\u9879\u5168\u90e8\u90fd\u88ab\u6d88\u53bb\u4e86\uff01  \n\n\u4e8e\u662f\u53ea\u9700\u8981\u6c42\u51fa $f(n)$ \u7684\u4e00\u6b21\u9879\u7cfb\u6570\u7684 $2$ \u500d\uff0c\u5c31\u5f97\u5230\u4e86\u7b54\u6848\u3002\n\n\u8981\u6c42\u7684\u662f\u7cfb\u6570\uff0c\u800c\u4e0d\u662f\u70b9\u503c\uff0c\u6240\u4ee5\u9700\u8981\u5199\u4e00\u4e2a\u4e8c\u9879\u5f0f\u7684\u7ed3\u6784\u4f53\u6765\u8ba1\u7b97\u3002  \n\n\u5bf9\u4e8e\u9ad8\u4e8e\u4e00\u6b21\u7684\u7cfb\u6570\uff0c\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\uff0c\u6240\u4ee5\u8981\u5ffd\u7565\u6389\uff0c\u5bf9\u7b54\u6848\u4e5f\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u53c2\u8003\u4ee3\u7801(\u9644\u6ce8\u91ca)\uff1a\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<vector>\n#define N 20000007\n#define ll long long\n#define reg register\n#define p 998244353\nusing namespace std;\n\ninline int add(int a,int b);\ninline int dec(int a,int b);\ninline int power(int a,int t);\ninline void read(int &x);\nvoid print(int x);\nint solve();\ninline int case1(); //case1\u5c31\u662f\u89e3\u51b3\u7279\u6b8a\u60c5\u51b5\u7684\ninline int case2();\n\nstruct binom{ //binomial \u4e8c\u9879\u5f0f\n    int a,b;\n    binom(int a=0,int b=0):a(a),b(b){}\n\n    inline binom operator + (const binom& x) const{\n        return binom(add(a,x.a),add(b,x.b));\n    }\n\n    inline binom operator - (const binom& x) const{\n        return binom(dec(a,x.a),dec(b,x.b));\n    }\n\n    inline binom operator * (const binom& x) const{\n        return binom(((ll)a*x.b+(ll)b*x.a)%p,(ll)b*x.b%p);\n    }\n\n    inline binom operator * (const int& x) const{\n        return binom((ll)a*x%p,(ll)b*x%p);\n    }\n};\n\nint n,k,lim,ans;\nint f[N],s[N],_pre[N],_suf[N];\nbinom pre[N],suf[N];\n\nint main(){\n    reg int cnt = 0;\n    read(n),read(k);\n    lim = min(k+3,n+1)<<1;\n    if(n==0) lim = (k+3)<<1;\n    s[1] = 1;\n    for(reg int i=2;i<=lim;++i){\n        if(!s[i]){\n            f[++cnt] = i;\n            s[i] = power(i,k);\n        }\n        for(reg int j=1;j<=cnt;++j){\n            if(i*f[j]>lim) break;\n            s[i*f[j]] = (ll)s[i]*s[f[j]]%p;\n            if(i%f[j]==0) break;\n        }\n    }\n    for(reg int i=2;i<=lim;++i) s[i] = add(s[i],s[i-1]);\n    lim >>= 1;\n    f[1] = 0,f[2] = power(3,k);\n    for(reg int i=3;i<=lim;++i)\n        f[i] = add(f[i-1],dec(s[(i<<1)-1],s[i]));\n    if(n<=lim&&n>0) ans = (ll)(f[n]<<1)*power(n,p-2)%p;\n    else ans = solve();\n    print(ans);\n    return 0;\n}\n\ninline int case1(){\n    reg int res = 0,g;\n    reg binom qwq;\n    pre[0] = suf[lim+1] = binom(0,1);\n    for(reg int i=1;i<=lim;++i) pre[i] = pre[i-1]*binom(1,p-i); //\u4e0a\u9762\u90a3\u4e00\u5927\u5768\u5f0f\u5b50\u4e2d,\u53f3\u534a\u8fb9\u7684\u8fde\u7eed\u4e58\u79ef,\u6bcf\u4e00\u5757\u90fd\u662f(x-j). \u4e00\u6b21\u9879\u4e3a1,\u5e38\u6570\u9879\u5c31\u662f-j\n    for(reg int i=lim;i>=1;--i) suf[i] = suf[i+1]*binom(1,p-i);\n    for(reg int i=1;i<=lim;++i){ //\u7c7b\u6bd4case2\u7684\u505a\u6cd5\u6765\u4e58\uff0c\u53ea\u4e0d\u8fc7\u7b97\u51fa\u7684\u662f\u7cfb\u6570\n        g = (ll)f[i]*s[i-1]%p*s[lim-i]%p;\n        qwq = pre[i-1]*suf[i+1]*g;   \n        if((lim-i)&1) res = dec(res,qwq.a);\n        else res = add(res,qwq.a);\n    }\n    return add(res,res); //\u522b\u5fd8\u4e86*2\n}\n\ninline int case2(){\n    reg int res = 0,g;\n    _pre[0] = _suf[lim+1] = 1;\n    for(reg int i=1;i<=lim;++i) _pre[i] = (ll)_pre[i-1]*(n-i)%p;\n    for(reg int i=lim;i>=1;--i) _suf[i] = (ll)_suf[i+1]*(n-i)%p;\n    for(reg int i=1;i<=lim;++i){\n        g = (ll)f[i]*_pre[i-1]%p*_suf[i+1]%p*s[i-1]%p*s[lim-i]%p;\n        if((lim-i)&1) res = dec(res,g);\n        else res = add(res,g);\n    }\n    return (ll)(res<<1)*power(n,p-2)%p;\n}\n\nint solve(){\n    s[0] = s[1] = 1;\n    for(reg int i=2;i<=lim;++i) s[i] = (ll)s[i-1]*i%p;\n    s[lim] = power(s[lim],p-2);\n    for(reg int i=lim-1;i>=1;--i) s[i] = (ll)s[i+1]*(i+1)%p;\n    if(n) return case2();\n    return case1();\n}\n\ninline int add(int a,int b){\n    return a+b>=p?a+b-p:a+b;\n}\n\ninline int dec(int a,int b){\n    return a<b?a-b+p:a-b;\n}\n\ninline int power(int a,int t){\n    int res = 1;\n    while(t){\n        if(t&1) res = (ll)res*a%p;\n        a = (ll)a*a%p;\n        t >>= 1;\n    }\n    return res;\n}\n\ninline void read(int &x){\n    x = 0;\n    char c = getchar();\n    while(c<'0'||c>'9') c = getchar();\n    while(c>='0'&&c<='9'){\n        x = (((ll)x<<3)+(x<<1)+(c^48))%p;\n        c = getchar();\n    }\n}\n\nvoid print(int x){\n    if(x>9) print(x/10);\n    putchar(x%10+'0');\n}\n```",
        "postTime": 1562433695,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u7ea6\u5b9a(\u52a0\u5f3a\u7248) \u9898\u89e3"
    },
    {
        "content": "\u5728\u6211\u7684\u535a\u5ba2\u770b\u6548\u679c\u66f4\u4f73\uff1a[\u70b9\u8fd9\u91cc](https://www.cnblogs.com/1000Suns/p/11109469.html)\n\n## \u5bf9\u539f\u9898\u7684\u60f3\u6cd5\uff1a\n\n\u5176\u5b9e\u4e5f\u662f\u4e00\u9053\u6bd4\u8f83\u7b80\u5355\u7684\u9898\u3002~~\uff08\u6240\u4ee5\u5c31\u5e94\u8be5\u628a\u8fd9\u9898\u548c\u4e0a\u4e00\u9053\u539f\u9898\u8c03\u4e2a\u4f4d\u7f6e\uff09~~\n\n\u8003\u8651\u4e00\u6761\u8fb9\u5728\u751f\u6210\u6811\u4e2d\u51fa\u73b0\u7684\u6982\u7387\uff0c\u7531\u4e8e\u4e00\u5171\u6709 $\\dfrac{n(n-1)}{2}$ \u6761\u8fb9\uff0c\u4e00\u4e2a\u751f\u6210\u6811\u6709 $n-1$ \u6761\u8fb9\uff0c\u800c\u6bcf\u6761\u8fb9\u7684\u6982\u7387\u76f8\u7b49\uff0c\u6240\u4ee5\u4e3a $\\dfrac{2}{n}$\u3002\n\n\u90a3\u4e48\u5f00\u59cb\u63a8\u5f0f\u5b50\uff1a\uff08\u6ce8\uff1a\u7b2c\u4e09\u6b65\u662f\u679a\u4e3e $i+j$\uff09\n\n$$\\dfrac{2}{n}\\sum\\limits_{i=1}^n\\sum\\limits_{j=i+1}^n(i+j)^k$$\n\n$$\\dfrac{1}{n}(\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n(i+j)^k-\\sum\\limits^n_{i=1}(i+i)^k)$$\n\n$$\\dfrac{1}{n}(\\sum\\limits_{s=1}^{2n}s^k\\min(s-1,2n+1-s)-2^k\\sum\\limits^n_{i=1}i^k)$$\n\n$$\\dfrac{1}{n}(\\sum\\limits_{s=1}^{n}s^k(s-1)+\\sum\\limits_{s=n+1}^{2n}s^k(2n+1-s)-2^k\\sum\\limits^n_{i=1}i^k)$$\n\n$$\\dfrac{1}{n}(\\sum\\limits_{s=1}^{n}s^{k+1}-\\sum\\limits_{s=1}^{n}s^{k}+(2n+1)\\sum\\limits_{s=n+1}^{2n}s^k-\\sum\\limits_{s=n+1}^{2n}s^{k+1}-2^{k}\\sum\\limits^n_{i=1}i^k)$$\n\n$$\\dfrac{1}{n}(2\\sum\\limits_{i=1}^{n}i^{k+1}-(2n+2+2^k)\\sum\\limits_{i=1}^{n}i^{k}+(2n+1)\\sum\\limits_{i=1}^{2n}i^k-\\sum\\limits_{i=1}^{2n}i^{k+1})$$\n\n\u73b0\u5728\u95ee\u9898\u5c31\u662f\u6c42 $f(n)=\\sum\\limits_{i=1}^ni^k$ \u4e86\u3002\n\n\u7531\u4e8e $f(n)-f(n-1)=n^k$\uff0c$f$ \u7684\u5dee\u503c\u662f\u4e2a $k$ \u6b21\u591a\u9879\u5f0f\uff0c\u6240\u4ee5 $f$ \u662f\u4e2a $k+1$ \u6b21\u591a\u9879\u5f0f\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u62c9\u683c\u6717\u65e5\u63d2\u503c\u3002\uff08\u4ee5\u4e0b\u5185\u5bb9\u7684\u4ee3\u7801\u5b9e\u73b0\u7ec6\u8282\u6bd4\u8f83\u591a\uff0c\u6ce8\u610f\u8981\u63a7\u5236\u590d\u6742\u5ea6\u4e0d\u5e26 $\\log$\uff09\n\n\u53d6 $k+2$ \u4e2a\u70b9\u4e3a $1$ \u5230 $k+2$\uff0c\u53d1\u73b0\u70b9\u503c $y_i$ \u53ef\u4ee5 $O(k)$ \u8ba1\u7b97\u3002\uff08$y_i=y_{i-1}+i^k$ \u4e0d\u80fd\u76f4\u63a5\u5feb\u901f\u5e42\uff0c\u4e0d\u7136\u5e26 $\\log$\u3002\u53ef\u4ee5\u7528\u6b27\u62c9\u7b5b\u7b5b\u51fa\u6240\u6709 $k$ \u6b21\u65b9\uff09\n\n$$f(n)=\\sum\\limits_{i=1}^{k+2}y_i\\dfrac{\\prod\\limits^{k+2}_{j=1,j\\ne i}(n-x_j)}{\\prod\\limits^{k+2}_{j=1,j\\ne i}(x_i-x_j)}$$\n\n\u8fd9\u6837\u62c9\u683c\u6717\u65e5\u63d2\u503c\u516c\u5f0f\u4e2d\u7684\u5206\u6bcd\u5c31\u662f\u4e24\u4e2a\u9636\u4e58\u76f8\u4e58\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5 $O(1)$\u3002\uff08\u9884\u5904\u7406\u8981\u6ce8\u610f\u63a7\u5236\u590d\u6742\u5ea6\uff09\n\n\u4ee3\u5165\u4e00\u4e2a\u6570\u7b97\u65f6\uff0c\u5148\u7279\u5224 $n\\ge mod$\uff08\u56e0\u4e3a\u4f1a\u8c03\u7528\u5230 $f(2n)$\uff09\uff0c\u6b64\u65f6 $f(n)=\\lfloor\\dfrac{n}{mod}\\rfloor f(mod-1)+f(n\\%mod)$\u3002\n\n\u5426\u5219\u5148\u7b97\u51fa $fac=\\prod\\limits_{i=1}^{k+2}(n-i)$\u3002\u540c\u65f6\u9884\u5904\u7406\u51fa\u6240\u6709 $n-i$ \u7684\u9006\u5143 $inv_i$\u3002\uff08\u4e0d\u8981\u4e00\u4e2a\u4e2a\u5feb\u901f\u5e42\u7b97\uff0c\u590d\u6742\u5ea6\u9519\u7684\u3002\u8981\u7528 $O(k+\\log)$ \u7684\u65b9\u5f0f\uff09\n\n\u6b64\u65f6\u5c31\u6709\uff1a\n\n$$f(n)=\\sum\\limits_{i=1}^{k+2}y_i\\dfrac{fac\\times inv_i}{(i-1)!(k-i+2)!(-1)^{k-i+2}}$$\n\n\u5df2\u7ecf\u53ef\u4ee5 $O(k)$ \u8ba1\u7b97\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(k+\\log)$\u3002\n\n\u4ee5\u4e0a\u662f\u539f\u7248\u7684\u505a\u6cd5\u3002\n\n---\n## \u5bf9\u52a0\u5f3a\u7248\u7684\u60f3\u6cd5\uff1a\n\n\u6bd2\u7624\u7684\u795e\u9c7c\u53c8\u52a0\u5f3a\u4e86\u8fd9\u9898\u2026\u2026\u7136\u540e\u5c31\u2026\u2026\u8ba9\u6211\u6765\u505a\u2026\u2026\n\n~~\u53d7\u5ba0\u82e5\u60ca\u5462QwQ~~\n\n\u4e0d\u8fc7\u771f\u6ca1\u60f3\u5230\u81ea\u5df1\u4e5f\u80fd\u60f3\u5230\u52a0\u5f3a\u7248\u6b63\u89e3\u3002\n\n\u5148\u8003\u8651 $n$ \u4e0d\u4e3a $998244353$\uff08\u4ee5\u4e0b\u7b80\u5199\u4e3a $p$\uff09\u7684\u500d\u6570\u3002\uff08\u56e0\u4e3a\u5f0f\u5b50\u524d\u9762\u6709\u4e2a $\\dfrac{1}{n}$\uff0c\u53ef\u80fd\u6ca1\u6709\u9006\u5143\uff09\n\n\u90a3\u4e48 $\\sum\\limits_{i=1}^ni^k=\\lfloor\\dfrac{n}{p}\\rfloor\\sum\\limits_{i=1}^{p-1}i^k+\\sum\\limits_{i=1}^{n\\bmod p}i^k$\u3002\n\n\u5199\u4e2a\u9ad8\u7cbe\u9664\u4f4e\u7cbe\u5c31\u6ca1\u4e86\u3002\n\n\u7136\u540e\u8003\u8651 $n$ \u662f $p$ \u7684\u500d\u6570\u3002\n\n$\\sum\\limits_{i=1}^ni^k=\\dfrac{n}{p}\\sum\\limits_{i=1}^pi^k$\u3002\n\n\u6b64\u65f6\u539f\u5f0f\uff1a\n\n$$\\dfrac{1}{n}(\\dots\\sum\\limits^n_{i=1}i^k+\\dots\\sum\\limits^{2n}_{i=1}i^k)$$\n\n$$\\dfrac{1}{n}(\\dfrac{n}{p}\\dots\\sum\\limits^{p-1}_{i=1}i^k+2\\dfrac{n}{p}\\dots\\sum\\limits^{p-1}_{i=1}i^k)$$\n\n$$\\dfrac{1}{p}\\dots\\sum\\limits^{p-1}_{i=1}i^k+\\dfrac{2}{p}\\dots\\sum\\limits^{p-1}_{i=1}i^k$$\n\n\u6b64\u5904\u53d6\u70b9\u503c\u4e3a $0$ \u5230 $k+1$ \u800c\u4e0d\u662f\u4e0a\u6587\u4e2d\u7684 $1$ \u5230 $k+2$\u3002\n\n\u89c2\u5bdf\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u5f0f\u5b50\uff0c\u5206\u5b50\u662f\u6709\u4e2a $x-x_j$ \u7684\u3002\u90a3\u4e48\u5f53 $i=0$ \u65f6\uff0c$y_i=0$\uff0c\u662f $p$ \u7684\u500d\u6570\u3002\u5f53 $i\\ne 0$ \u65f6\uff0c$x-x_0=x=p$\uff0c\u662f $p$ \u7684\u500d\u6570\u3002\n\n\u90a3\u4e48\u53ea\u9700\u8981\u5728\u5206\u5b50\u4e2d\u4e0d\u4e58\u4e0a\u90a3\u4e2a $x-x_0=p$ \u5373\u53ef\u3002\u5c31\u76f8\u5f53\u4e8e\u6c42\u51fa\u4e86 $\\frac{\\sum\\limits_{i=1}^pi^k}{p}$\u3002\n\n\u90a3\u4e48\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(k+\\log n)$\u3002\n\n\uff08\u795e\u9c7c\u592a\u6bd2\u7624\u4e86\u2026\u2026\u4e00\u9053\u6570\u8bba\u9898\u6211\u7801\u4e863.8K\u2026\u2026\u7801\u51fa\u4e86\u6570\u636e\u7ed3\u6784\u9898\u7684\u611f\u89c9\u2026\u2026\uff09\n\n```cpp\n#define Orz_NaCly_Fish\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int maxn=10001000,mod=998244353;\n#define FOR(i,a,b) for(int i=(a);i<=(b);i++)\n#define ROF(i,a,b) for(int i=(a);i>=(b);i--)\n#define MEM(x,v) memset(x,v,sizeof(x))\ninline int read(){\n\tchar ch=getchar();int x=0,f=0;\n\twhile(ch<'0' || ch>'9') f|=ch=='-',ch=getchar();\n\twhile(ch>='0' && ch<='9') x=x*10+ch-'0',ch=getchar();\n\treturn f?-x:x;\n}\nint ndiv,nmod,k,ans,len,kp[maxn],k1p[maxn],pr[maxn/10],pl,ky[maxn],k1y[maxn],fac[maxn],invfac[maxn],tfac[maxn],tinv[maxn];\nchar nstr[11111];\nbool vis[maxn];\ninline int add(int a,int b){return a+b<mod?a+b:a+b-mod;}\ninline int sub(int a,int b){return a<b?a-b+mod:a-b;}\ninline int mul(int a,int b){return 1ll*a*b%mod;}\ninline int qpow(int a,int b){\n\tint ans=1;\n\tfor(;b;b>>=1,a=mul(a,a)) if(b&1) ans=mul(ans,a);\n\treturn ans;\n}\nint kcalc(int x){\n\tif(x<=k+1){\n\t\tint ans=mul(mul(ky[x],fac[x]),fac[k-x+1]);\n\t\tif(!((k-x)&1)) return ans?mod-ans:0;\n\t\telse return ans;\n\t}\n\tif(x==mod){\n\t\ttfac[0]=1;\n\t\tFOR(i,1,k+1) tfac[i]=mul(tfac[i-1],x-i);\n\t\ttinv[k+1]=qpow(tfac[k+1],mod-2);\n\t\tROF(i,k,1) tinv[i]=mul(tinv[i+1],x-i-1);\n\t\tFOR(i,2,k+1) tinv[i]=mul(tinv[i],tfac[i-1]);\n\t\tint ans=0;\n\t\tFOR(i,1,k+1) ans=add(ans,mul(mul(ky[i],tfac[k+1]),tinv[i]));\n\t\treturn ans;\n\t}\n\ttfac[0]=x;\n\tFOR(i,1,k+1) tfac[i]=mul(tfac[i-1],x-i);\n\ttinv[k+1]=qpow(tfac[k+1],mod-2);\n\tROF(i,k,0) tinv[i]=mul(tinv[i+1],x-i-1);\n\tFOR(i,1,k+1) tinv[i]=mul(tinv[i],tfac[i-1]);\n\tint ans=0;\n\tFOR(i,0,k+1) ans=add(ans,mul(mul(ky[i],tfac[k+1]),tinv[i]));\n\treturn ans;\n}\nint k1calc(int x){\n\tif(x<=k+2){\n\t\tint ans=mul(mul(k1y[x],fac[x]),fac[k-x+2]);\n\t\tif((k-x)&1) return ans?mod-ans:0;\n\t\telse return ans;\n\t}\n\tif(x==mod){\n\t\ttfac[0]=1;\n\t\tFOR(i,1,k+2) tfac[i]=mul(tfac[i-1],x-i);\n\t\ttinv[k+2]=qpow(tfac[k+2],mod-2);\n\t\tROF(i,k+1,1) tinv[i]=mul(tinv[i+1],x-i-1);\n\t\tFOR(i,2,k+2) tinv[i]=mul(tinv[i],tfac[i-1]);\n\t\tint ans=0;\n\t\tFOR(i,1,k+2) ans=add(ans,mul(mul(k1y[i],tfac[k+2]),tinv[i]));\n\t\treturn ans;\n\t}\n\ttfac[0]=x;\n\tFOR(i,1,k+2) tfac[i]=mul(tfac[i-1],x-i);\n\ttinv[k+2]=qpow(tfac[k+2],mod-2);\n\tROF(i,k+1,0) tinv[i]=mul(tinv[i+1],x-i-1);\n\tFOR(i,1,k+2) tinv[i]=mul(tinv[i],tfac[i-1]);\n\tint ans=0;\n\tFOR(i,0,k+2) ans=add(ans,mul(mul(k1y[i],tfac[k+2]),tinv[i]));\n\treturn ans;\n}\nvoid init(){\n\tfac[0]=1;\n\tFOR(i,1,k+2) fac[i]=mul(fac[i-1],i);\n\tinvfac[k+2]=qpow(fac[k+2],mod-2);\n\tROF(i,k+1,0) invfac[i]=mul(invfac[i+1],i+1);\n\tkp[1]=k1p[1]=1;\n\tFOR(i,2,k+2){\n\t\tif(!vis[i]){\n\t\t\tpr[++pl]=i;\n\t\t\tkp[i]=qpow(i,k);\n\t\t\tk1p[i]=qpow(i,k+1);\n\t\t}\n\t\tFOR(j,1,pl){\n\t\t\tif(i*pr[j]>k+2) break;\n\t\t\tvis[i*pr[j]]=true;\n\t\t\tkp[i*pr[j]]=mul(kp[i],kp[pr[j]]);\n\t\t\tk1p[i*pr[j]]=mul(k1p[i],k1p[pr[j]]);\n\t\t\tif(i%pr[j]==0) break;\n\t\t}\n\t}\n\tky[0]=k1y[0]=0;\n\tFOR(i,1,k+2) ky[i]=add(ky[i-1],kp[i]),k1y[i]=add(k1y[i-1],k1p[i]);\n\tFOR(i,0,k+2){\n\t\tky[i]=mul(mul(ky[i],invfac[i]),invfac[k-i+1]);\n\t\tif(!((k-i)&1)) ky[i]=ky[i]?mod-ky[i]:0;\n\t\tk1y[i]=mul(mul(k1y[i],invfac[i]),invfac[k-i+2]);\n\t\tif((k-i)&1) k1y[i]=k1y[i]?mod-k1y[i]:0;\n\t}\n}\nint main(){\n\tscanf(\"%s\",nstr+1);k=read();\n\tlen=strlen(nstr+1);\n\tinit();\n\tFOR(i,1,len){\n\t\tll tmp=10ll*nmod+nstr[i]-'0';\n\t\tndiv=add(mul(ndiv,10),tmp/mod);\n\t\tnmod=tmp%mod;\n\t}\n\tif(nmod){\n\t\tint ktmp=kcalc(mod-1),k1tmp=k1calc(mod-1);\n\t\tint krem=kcalc(nmod),k1rem=k1calc(nmod);\n\t\tint kans=add(mul(ndiv,ktmp),krem),k1ans=add(mul(ndiv,k1tmp),k1rem);\n\t\tans=mul(2,k1ans);\n\t\tans=sub(ans,mul(add(add(mul(nmod,2),2),qpow(2,k)),kans));\n\t\tkrem=kcalc(mul(nmod,2)),k1rem=k1calc(mul(nmod,2));\n\t\tkans=add(mul(add(mul(ndiv,2),nmod>mod/2),ktmp),krem),k1ans=add(mul(add(mul(ndiv,2),nmod>mod/2),k1tmp),k1rem);\n\t\tans=add(ans,mul(2*nmod+1,kans));\n\t\tans=sub(ans,k1ans);\n\t\tans=mul(ans,qpow(nmod,mod-2));\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\telse{\n\t\tint kans=kcalc(mod),k1ans=k1calc(mod);\n\t\tans=mul(2,k1ans);\n\t\tans=sub(ans,mul(add(2,qpow(2,k)),kans));\n\t\tans=add(ans,mul(2,kans));\n\t\tans=sub(ans,mul(2,k1ans));\n\t\tprintf(\"%d\\n\",ans);\n\t}\n}\n```",
        "postTime": 1562331192,
        "uid": 72118,
        "name": "AThousandSuns",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5442 \u3010\u3010XR-2\u3011\u7ea6\u5b9a (\u52a0\u5f3a\u7248)\u3011"
    },
    {
        "content": "\u51b7\u9759\u5206\u6790\uff0c\u51b7\u9759\u5206\u6790\u2026\u2026\n\n[\u9898\u76ee](https://www.luogu.org/problem/P5442)\n\n[\u52a0\u5f3a\u524d\u7684\u8be6\u7ec6\u601d\u8def\u89c1\u6b64\u5904](https://www.luogu.com.cn/problemnew/solution/P5437)\n\n__\u4e3a\u4e86\u65b9\u4fbf\uff0c\u8bb0 $M = 998244353$\u3002__\n\n\u8bb0 $F_k(n)=\\sum_{1\\le i<j\\le n}(i+j)^k$\uff0c\u5219\u7b54\u6848\u5c31\u662f $\\frac{2}{n}F_k(n)$\u3002\n\n\u53d1\u73b0 $F_k(n)$ \u662f\u4e2a\u5173\u4e8e $n$ \u7684 $(k+2)$ \u6b21\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u62ff $(k+3)$ \u4e2a\u70b9\u503c\u6765\u63d2\u5b83\u3002\n\n\u6839\u636e\u62c9\u683c\u6717\u65e5\u63d2\u503c\uff0c\u5f97\u5230\u5f0f\u5b50 \n\n$F_k(n)=\\sum_{i=1}^{m+3}F_k(i)\\prod_{j\\ne i}\\frac{n-j}{i-j}$\n\n$=\\sum_{i=1}^{m+3}F_k(i)\\frac{1}{(i-1)!}\\frac{1}{(m+3-i)!}(-1)^{m+3-i}\\prod_{j=1}^{i-1}(n-j)\\prod_{j=i+1}^{m+3}(n-j)$\n\n\u3002\u6c42\u548c\u53f7\u540e\u9762\u7684\u6bcf\u4e2a\u4e1c\u897f\u90fd\u53ef\u4ee5\u9884\u5904\u7406\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u6c42\u51fa\u4e86 $F_k(n) \\mod M$\u3002\n\n\u63a5\u4e0b\u6765\u8fd8\u8981\u4e58\u4e2a $\\frac{2}{n}$\uff0c\u5206\u51e0\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n#### \u4e00\u3001$1\\le n<M$\n\n\u8fd9\u65f6\u5019 $n$ \u5b58\u5728\u9006\u5143\uff0c\u76f4\u63a5\u4e58\u5c31\u597d\u4e86\u3002\u4e8e\u662f\u6211\u4eec\u89e3\u51b3\u4e86\u6ca1\u52a0\u5f3a\u7684\u7248\u672c\u3002\n\n#### \u4e8c\u3001$n=M$\n\n\u8fd9\u65f6\u5019\u7b97\u51fa\u7684 $F_k(n) \\mod M$ \u5176\u5b9e\u4e5f\u662f\u5bf9\u7684\uff08\u5b9e\u9645\u4e0a\uff0c\u8fd9\u65f6\u5019 $F_k(n) \\mod M=0$\uff09\u3002\n\n\u95ee\u9898\u5728\u4e8e\u6700\u540e\u8fd8\u8981\u4e58\u4e2a $\\frac{2}{n}$\uff0c\u800c $n$ \u8fd9\u65f6\u5019\u6ca1\u6709\u9006\u5143\u3002\n\n\u9996\u5148\u60f3\u5230\u770b\u770b\u4e0a\u9762\u6709\u6ca1\u6709\u53ef\u4ee5\u6d88\u53bb\u7684 $n$ \uff0c\u4f46\u4f3c\u4e4e\u5e76\u6ca1\u6709\u627e\u5230\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u62c9\u683c\u6717\u65e5\u63d2\u503c\uff0c\u6211\u4eec\u53d6\u7684\u70b9\u662f $1$ \u5230 $k+3$\u3002\u6362\u6210 $0$ \u5230 $k+2$ \u8bd5\u8bd5\u770b\uff1f\n\n\u9996\u5148\u53ef\u4ee5\u5f97\u5230 $F_k(0)=0$\u3002\n\n\u7136\u540e\u53d1\u73b0\u5f0f\u5b50\u53d8\u6210\u8fd9\u6837\uff1a\n\n$F_k(n)=\\sum_{i=0}^{m+2}F_k(i)\\frac{1}{i!}\\frac{1}{(m+2-i)!}(-1)^{m+2-i}\\prod_{j=0}^{i-1}(n-j)\\prod_{j=i+1}^{m+2}(n-j)$\n\n\u90a3 $\\prod_{j=0}^{i-1}(n-j)$ \u8fd9\u91cc\uff0c\u4e0d\u5c31\u6709\u4e00\u4e2a $n$ \u5417\uff1f\u628a\u5b83\u6d88\u6389\u5c31\u884c\u4e86\u3002\n\nWait...\u4f60\u8bf4 $i=0$ \u7684\u65f6\u5019\u6ca1\u6709 $n$ \u600e\u4e48\u529e\uff1f$F_k(0)=0$\uff0c\u6240\u4ee5 $i=0$ \u7684\u65f6\u5019\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\uff0c\u76f4\u63a5\u8ba9\u5faa\u73af\u4ece $1$ \u5f00\u59cb\u5c31\u597d\u4e86\u3002\n\n\uff08\u5c3d\u7ba1\u5728\u8ba1\u7b97\u7684\u65f6\u5019\u6ca1\u6709\u8d21\u732e\uff0c\u4f46\u6211\u4eec\u4ecd\u7136\u662f\u62ff $(k+3)$ \u4e2a\u70b9\u503c\u6765\u63d2\u7684\uff0c\u53ea\u4e0d\u8fc7\u5728 $0$ \u5904\u7684\u70b9\u503c\u4e3a $0$ \u800c\u5df2\u3002\uff09\n\n\u4e8e\u662f\u5f97\u5230\u7684\u5f0f\u5b50\u662f\n\n$\\frac{1}{n}F_k(n)=\\sum_{i=1}^{m+2}F_k(i)\\frac{1}{i!}\\frac{1}{(m+2-i)!}(-1)^{m+2-i}\\prod_{j=1}^{i-1}(n-j)\\prod_{j=i+1}^{m+2}(n-j)$\n\n\u4e58\u4e2a $2$ \u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n#### \u4e09\u3001$n>M$\n\n$n>M$ \u65f6\uff0c$n$ \u7684\u7b54\u6848\u548c $n\\mod M+[n\\mod M=0]\\cdot M$ \u7684\u7b54\u6848\u662f\u4e00\u6837\u7684\uff0c\u8f93\u5165\u7684\u65f6\u5019\u76f4\u63a5\u53d6\u6a21\u5c31\u597d\u4e86\u3002\n\n\u8fd9\u4e2a\u8bc1\u660e\u5176\u5b9e\u5e76\u4e0d\u50cf\u770b\u8d77\u6765\u4e00\u6837\u7b80\u5355\uff0c\u53ef\u4ee5\u601d\u8003\u4e00\u4e0b\u3002\n\n```cpp\n#include<cstdio>\ntypedef long long ll;\nconst int A=1e7+37,M=998244353;\ninline int Pow(int a,int m){int s=1;for(;m;m>>=1)m&1?s=(ll)s*a%M:0,a=(ll)a*a%M;return s;}\nint n,m,f[A+A],g[A],func[A],t0[A],t1[A],invf[A],np[A+A],p[1300000],k,ans;\ninline int Read(){\n\tint a=0;char c=getchar();\n\tfor(;c>57||c<48;c=getchar());for(;c>47&&c<58;a=(a*10ll+c-48)%M,c=getchar());\n\treturn a;\n}\nint main(){\n\tn=Read();if(!n)n+=M;\n\tscanf(\"%d\",&m);\n\tf[1]=1;\n\tfor(int i=2;i<=m+m+3;i++){\n\t  if(!np[i])p[++k]=i,f[i]=Pow(i,m);\n\t  for(int j=1;j<=k&&i*p[j]<=m+m+3;j++){\n\t\tnp[i*p[j]]=1;\n\t\tf[i*p[j]]=(ll)f[i]*f[p[j]]%M;\n\t\tif(i%p[j]==0)break;\n\t  }\n\t}\n\tfor(int i=1;i<=m+m+3;i++)f[i]=(f[i]+f[i-1])%M;\n\tfunc[0]=1,t0[0]=1;\n\tfor(int i=1;i<=m+2;i++){\n\t  t0[i]=(ll)t0[i-1]*(n-i)%M;\n\t  func[i]=(ll)func[i-1]*i%M;\n\t  g[i]=((ll)g[i-1]+f[2*i-1]-f[i]+M)%M;\n\t  if(n==i)return 0*printf(\"%lld\\n\",g[i]*2ll*Pow(n,M-2)%M);\n\t}\n\tinvf[m+2]=Pow(func[m+2],M-2),t1[m+2]=n-(m+2),t1[m+3]=1;\n\tfor(int i=m+2;i;i--){\n\t  t1[i-1]=(ll)t1[i]*(n-i+1)%M;\n\t  invf[i-1]=(ll)invf[i]*i%M;\n\t}\n\tfor(int i=1;i<=m+2;i++)\n\t  ans=(ans+(ll)g[i]*t0[i-1]%M*t1[i+1]%M*invf[i]%M*invf[m+2-i]*(m+2-i&1?-1:1)%M+M)%M;\n\tprintf(\"%d\\n\",ans*2%M);\n\treturn 0;\n}\n```",
        "postTime": 1582356030,
        "uid": 72487,
        "name": "Dreamunk",
        "ccfLevel": 9,
        "title": "luogu P5442 \u3010XR-2\u3011\u7ea6\u5b9a (\u52a0\u5f3a\u7248)"
    }
]