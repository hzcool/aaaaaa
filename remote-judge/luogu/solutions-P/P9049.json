[
    {
        "content": "\u770b\u5230\u533a\u95f4\u548c\u9996\u5148\u8003\u8651\u4f5c\u4e00\u4e2a\u524d\u7f00\u548c $s$\uff0c\u6ce8\u610f\u662f $\\bmod {10^9+7}$ \u610f\u4e49\u4e0b\u7684\u3002\n\n\u4e8e\u662f\u5c31\u53d8\u6210\u4e86 $(s_i-s_{j-1})\\bmod{10^9+7}$ \u662f\u4e0d\u662f\u4e00\u4e2a\u5076\u6570\u3002\n\n\u4e0d\u59a8\u4ee4 $f_i$ \u4ee5 $i$ \u7ed3\u5c3e\u7684\u524d\u7f00\u7684\u7b54\u6848\u3002\n\n\u8003\u8651\u600e\u4e48\u8f6c\u79fb\uff0c\u82e5 $s_{j-1}\\leq s_i$ \u4e14\u8fd9\u4e24\u4e2a\u4e1c\u897f\u5947\u5076\u6027\u76f8\u540c\uff0c\u663e\u7136 $f_j$ \u662f\u53ef\u4ee5\u8f6c\u79fb\u5230 $f_i$ \u4e0a\u7684\uff1b\u4e0d\u4e00\u6837\u7684\u5f53\u7136\u4e5f\u53ef\u4ee5\u8d21\u732e\uff0c\u4e0d\u8fc7\u8981 $s_{j-1}\\gt s_i$\uff0c\u56e0\u4e3a\u6b64\u65f6 $\\bmod$ \u540e\u7684\u503c\u662f $s_i-s_{j-1}+10^9+7$\uff0c\u56e0\u4e3a\u5947\u5076\u6027\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u524d\u9762\u4e24\u9879\u51cf\u5b8c\u662f\u5947\u6570\uff0c\u518d\u52a0\u4e0a\u4e00\u4e2a\u5947\u6570\u5c31\u662f\u5076\u6570\u4e86\u3002\n\n\u6b64\u65f6\u662f $O(n^2)$ \u7684\uff0c\u6ce8\u610f\u5230 $f_i$ \u7684\u8f6c\u79fb\u4e8b\u5b9e\u4e0a\u53ea\u8ddf\u503c\u57df\u76f8\u5173\uff0c\u4e8e\u662f\u8003\u8651\u7ecf\u5178\u5957\u8def\uff1a\u5c06\u6240\u6709\u7684 $f_i$ \u6620\u5c04\u5230\u503c\u57df\u4e0a\u7136\u540e\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\n\n\u7ef4\u62a4\u4e24\u4e2a `BIT`\uff0c\u5206\u522b\u5bf9\u5e94\u5947\u5076\u6570\u5373\u53ef\uff0c\u6ce8\u610f\u79bb\u6563\u5316\u7684\u5904\u7406\uff0c\u9700\u8981\u4fdd\u7559\u4e4b\u524d\u7684\u5947\u5076\u6027\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 3e5 + 5, mod = 1e9 + 7;\nint n, m, a[N], sum[N], lsh[N], f[N];\ninline int mod_add(int x, int y) {\n\tx += y;\n\treturn x >= mod ? x - mod : x;\n}\nstruct BIT {\n\tint c[N];\n\tinline void modify(int x, int k) {\n\t\twhile (x <= m) {\n\t\t\tc[x] = mod_add(c[x], k);\n\t\t\tx += (x & -x);\n\t\t}\n\t}\n\tinline int query(int x) {\n\t\tint res = 0;\n\t\twhile (x) {\n\t\t\tres = mod_add(res, c[x]);\n\t\t\tx -= (x & -x);\n\t\t}\n\t\treturn res;\n\t}\n} odd, even;\nsigned main() {\n\tcin.tie(nullptr)->sync_with_stdio(false);\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i];\n\tfor (int i = 1; i <= n; i++)\n\t\tsum[i] = mod_add(sum[i - 1], a[i]);\n\tfor (int i = 1; i <= n; i++)\n\t\tlsh[++m] = sum[i];\n\tlsh[++m] = 0;\n\tsort(lsh + 1, lsh + m + 1);\n\tm = unique(lsh + 1, lsh + m + 1) - lsh - 1;\n\teven.modify(1, 1);\n\tfor (int i = 1; i <= n; i++) {\n\t\tint pos = lower_bound(lsh + 1, lsh + m + 1, sum[i]) - lsh;\n\t\tif (sum[i] & 1) {\n\t\t\tf[i] = mod_add(odd.query(pos), mod_add(even.query(m), mod - even.query(pos - 1)));\n\t\t\todd.modify(pos, f[i]);\n\t\t} else {\n\t\t\tf[i] = mod_add(mod_add(odd.query(m), mod - odd.query(pos - 1)), even.query(pos));\n\t\t\teven.modify(pos, f[i]);\n\t\t}\n\t}\n\tcout << f[n] << endl;\n\treturn 0;\n}\n```",
        "postTime": 1676639600,
        "uid": 434929,
        "name": "Usada_Pekora",
        "ccfLevel": 7,
        "title": "P9049 \u524d\u7f00\u548c+\u9002\u91cf\u8f6c\u5316"
    }
]