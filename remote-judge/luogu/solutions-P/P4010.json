[
    {
        "content": "```\n\u5206\u522b\u641c\u51fa\u4e24\u4eba\u7684\u724c\u5c40\uff0c\n\u7136\u540e\u7edf\u4e00\u6392\u5e8f\uff0c\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u77e5\u9053\u4e00\u4e2a\u724c\u5c40\u524d\u9762\u6709\u591a\u5c11\u6ca1\u6709\u76f8\u540c\u91cd\u590d\u624b\u724c\u7684\u724c\u5c40\u5373\u53ef\uff0c\n\u8fd9\u90e8\u5206\u5c31\u7528\u5bb9\u65a5\u7edf\u8ba1\uff0c\n\u7136\u540e\u6bd4\u8f83\u5927\u5c0f\u3002\n\u4ee3\u7801\uff1a\n```\n```\n#include<bits/stdc++.h>\n#ifdef WIN32\n#define fmt64 \"%I64d\"\n#else\n#define fmt64 \"%lld\"\n#endif\nstruct state{int a[6],b[6],e,u1,u2;}st[2600000];\nint a[6],b[6],v[15][5],u[2600000],o[5],d[10],pi,qi,debug;\nint n,m,tot,xx[15],yy[5],g[8000000],p[10];\nlong long ans1,ans2,f[32];\nvoid sort(state &u)\n{\n  int i,j,e;\n  for (i=1;i<=4;i++)\n    for (j=i+1;j<=5;j++)\n      if (u.a[i]<u.a[j] || (u.a[i]==u.a[j] && u.b[i]<u.b[j])) \n\te=u.a[i],u.a[i]=u.a[j],u.a[j]=e,\n\t  e=u.b[i],u.b[i]=u.b[j],u.b[j]=e;\n}\nvoid yasuo(state &x)\n{\n  int i,k;\n  for (i=1,k=6;i<=5;i++,k--) \n    x.u2+=x.a[i]*d[k];\n  x.u2+=x.b[1];\n}\nint tonghuashun(state &x)\n{\n  int i;\n  if (o[x.b[1]]!=5) return 0;\n  for (i=2;i<=5;i++)\n    if (x.a[i]!=x.a[i-1]-1) return 0;\n  x.u1=9;x.u2+=x.a[1]*d[6],x.u2+=x.b[1];\n  return 1;\n}\nint sitiao(state &x)\n{\n  if (u[x.a[1]]!=4 && u[x.a[2]]!=4) return 0;\n  x.u1=8;\n  if (u[x.a[1]]==4) x.u2+=x.a[1]*d[6];\n  else x.u2+=x.a[2]*d[6];\n  return 1;\n}\nint mantanghong(state &x)\n{\n  if (!((u[x.a[1]]==3 && u[x.a[4]]==2) || (u[x.a[1]]==2 && u[x.a[3]]==3))) return 0;\n  x.u1=7;\n  if (u[x.a[1]]==3 && u[x.a[4]]==2) x.u2+=x.a[1]*d[6];\n  else x.u2+=x.a[3]*d[6];\n  return 1;\n}\nint tonghua(state &x)\n{\n  if (o[x.b[1]]!=5) return 0;\n  x.u1=6;yasuo(x);\n  return 1;\n}\nint shunzi(state &x)\n{\n  int i;\n  for (i=2;i<=5;i++)\n    if (x.a[i]!=x.a[i-1]-1) return 0;\n  x.u1=5;\n  x.u2+=x.a[1]*d[6],x.u2+=x.b[1];\n  return 1;\n}\nint santiao(state &x)\n{\n  if (!(u[x.a[1]]==3 || u[x.a[2]]==3 || u[x.a[3]]==3)) return 0;\n  x.u1=4;\n  if (u[x.a[1]]==3) x.u2+=x.a[1]*d[6];\n  else if (u[x.a[2]]==3) x.u2+=x.a[2]*d[6];\n  else x.u2+=x.a[3]*d[6];\n  return 1;\n}\nint liangdui(state &x)\n{\n  if (!(u[x.a[2]]==2 && u[x.a[4]]==2)) return 0;\n  x.u1=3;\n  if (u[x.a[1]]==1) x.u2+=x.a[2]*d[6]+x.a[4]*d[5]+x.a[1]*d[4]+x.b[2];\n  else if (u[x.a[3]]==1) x.u2+=x.a[1]*d[6]+x.a[4]*d[5]+x.a[3]*d[4]+x.b[1];\n  else x.u2+=x.a[1]*d[6]+x.a[3]*d[5]+x.a[5]*d[4]+x.b[1];\n  return 1;\n}\nint yidui(state &x)\n{\n  int i,j,k;\n  for (i=2;i<=5;i++)\n    if (x.a[i]==x.a[i-1]) break;\n  if (i>5) return 0;\n  x.u1=2;\n  x.u2+=x.a[i-1]*d[6]+x.b[i-1];\n  for (j=1,k=5;j<=5;j++) {\n    if (j==i || j==i-1) continue;\n    x.u2+=x.a[j]*d[k--];\n  }\n  return 1;\n}\nvoid check(int e)\n{\n  int i;\n  ++tot;st[tot].e=e;\n  for (i=1;i<=5;i++) st[tot].a[i]=a[i],st[tot].b[i]=b[i];\n  sort(st[tot]);\n  if (tonghuashun(st[tot])) return ;\n  if (shunzi(st[tot])) return ;\n  for (i=1;i<=5;i++) st[tot].a[i]=(st[tot].a[i]==1) ? 14 : st[tot].a[i];\n  sort(st[tot]);\n  if (tonghuashun(st[tot])) return ;\n  if (sitiao(st[tot])) return ;\n  if (mantanghong(st[tot])) return ;\n  if (tonghua(st[tot])) return ;\n  if (shunzi(st[tot])) return ;\n  if (santiao(st[tot])) return ;\n  if (liangdui(st[tot])) return ;\n  if (yidui(st[tot])) return ;\n  st[tot].u1=1,yasuo(st[tot]);\n}\nvoid dfs(int x,int e,int lim1,int lim2)\n{\n  if (x>5) {\n    check(e);return ;\n  }\n  int i,j;\n  for (i=lim1;i<=13;i++) {\n    for (j=(i!=lim1) ? 1 : lim2;j<=4;j++)\n      if (!v[i][j]) {\n\ta[x]=i,b[x]=j;\n\tv[i][j]=1;\n\tu[i]++,o[j]++,u[14]=(i==1) ? u[14]+1 : u[14];\n\tdfs(x+1,e,i,j);\n\ta[x]=b[x]=0;\n\tv[i][j]=0;\n\tu[i]--,o[j]--,u[14]=(i==1) ? u[14]-1 : u[14];\n      }\n  }\n}\nlong long gcd(long long a,long long b)\n{\n  long long t;\n  for (;a%b;) {\n    t=a%b;\n    a=b;\n    b=t;\n  }\n  return b;\n}\nint cmp(const void *i,const void *j) \n{\n    pi=*(int *)i,qi=*(int *)j;\n    if (st[pi].u1!=st[qi].u1) return st[pi].u1-st[qi].u1;\n    return st[pi].u2-st[qi].u2;\n}\nvoid init()\n{\n    int i,j,x,y,k,e,sum;\n  scanf(\"%d\\n\",&n);\n  for (i=2,d[1]=15;i<=6;i++) d[i]=d[i-1]*15;\n  for (i=1;i<=n;i++) {\n    scanf(\"%d%d\\n\",&x,&y);y=4-y+1;\n    a[i]=x,b[i]=y;\n    v[x][y]=1;\n    u[x]++,o[y]++,u[14]=(x==1) ? u[14]+1 : u[14];\n  }\n  for (i=1;i<=n-1;i++) scanf(\"%d%d\\n\",&xx[i],&yy[i]),v[xx[i]][4-yy[i]+1]=1;\n  dfs(n+1,0,1,1);\n  memset(a,0,sizeof(a));memset(b,0,sizeof(b));memset(o,0,sizeof(o));\n  for (i=1;i<=15;i++) u[i]=0;\n  for (i=1;i<=n-1;i++) {\n    x=xx[i],y=4-yy[i]+1;\n    a[i]=x,b[i]=y;\n    v[x][y]=1;\n    u[x]++,o[y]++,u[14]=(x==1) ? u[14]+1 : u[14];\n  }\n  dfs(n,1,1,1);\n  for (ans2=0,i=1;i<=tot;i++) {\n    u[i]=i;\n    if (st[i].e) continue;\n    x=47-n+1,y=5-n+1;\n    for (sum=1,j=x;j>=x-y+1;j--) sum*=j;\n    for (j=1;j<=y;j++) sum/=j;\n    ans2+=sum;\n  }\n  qsort(u+1,tot,sizeof(u[1]),cmp);\n  for (i=1,sum=0;i<=tot;i++) {\n    if (st[u[i]].e==0) f[0]+=sum;else sum+=1;\n    if (st[u[i]].a[1]!=14) continue;\n    for (j=1;j<=5;j++)\n      st[u[i]].a[j]=(st[u[i]].a[j]==14) ? 1 : st[u[i]].a[j];\n    sort(st[u[i]]);\n  }\n  for (i=2,p[1]=1;i<=5;i++) p[i]=p[i-1]*53;\n  for (i=1;i<=tot;i++) {\n      for (j=1;j<=30;j++) {\n\t  for (k=1,e=0,debug=0;k<=5;k++)\n  \t      if ((j>>(k-1))&1 && !v[st[u[i]].a[k]][st[u[i]].b[k]]) \n\t\t  debug+=((st[u[i]].a[k]-1)*4+st[u[i]].b[k])*p[++e];else if (j>>(k-1)&1) break;\n  \t  if (k<=5) continue;\n\t  if (!st[u[i]].e) f[j]+=g[debug];\n  \t  else g[debug]++;\n      }\n  }\n  for (ans1=0,i=0;i<=30;i++) {\n      if (!f[i]) continue;\n      for (e=1,k=i;k;k>>=1) if (k&1) e*=-1;\n      ans1+=f[i]*e;\n  }\n  long long gc=gcd(ans1,ans2);\n  printf(fmt64\"/\"fmt64,ans1/gc,ans2/gc);\n}\nint main()\n{\n   init();\n  return 0;\n}\n\n```",
        "postTime": 1536144865,
        "uid": 123679,
        "name": "okbj",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4010 \u3010[CTSC2012]\u68ad\u54c8\u6e38\u620f\u3011"
    },
    {
        "content": "> [[CTSC2012]\u68ad\u54c8\u6e38\u620f](https://www.luogu.com.cn/problem/P4010)\n\n\u4e00\u9053\u5f88\u4e0d\u5e73\u51e1\u7684\u9898\u76ee\u554a\uff01\u4e0d\u6127\u662f CTSC\u3002\n\n\u521d\u6b65\u60f3\u6cd5\u662f\u679a\u4e3e\u5269\u4e0b\u6765\u4e24\u4e2a\u4eba\u62ff\u5230\u7684\u724c\uff0c\u6bcf\u6b21\u6bd4\u8f83\u4e00\u4e0b\uff0c\u6c42\u51fa Y \u80dc\u8fc7 Z \u7684\u603b\u8f6e\u6570\u3002\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u4e3a $\\dbinom {53 - 2N}{11 - 2N} = \\dbinom {53 - 2N} {42}$\u3002\u53ea\u80fd\u901a\u8fc7 $N \\geq 3$\u3002\n\n\u6362\u4e2a\u89d2\u5ea6\uff0c\u56e0\u4e3a\u4efb\u610f\u4e24\u526f\u624b\u724c\u5747\u53ef\u6bd4\u8f83\uff0c\u6240\u4ee5\u6240\u6709 $\\dbinom {52} 5$ \u79cd\u624b\u724c\u5f62\u6210\u5168\u5e8f\u5173\u7cfb\u3002\n\n\u6211\u4eec\u53d1\u73b0 Y \u548c Z \u7684\u624b\u724c\u4e0d\u80fd\u91cd\u590d\u8fd9\u4e00\u9650\u5236\u5f88\u70e6\u4eba\u3002\u7531\u4e8e\u624b\u724c\u6570\u5f88\u5c11\uff0c\u53ef\u4ee5\u60f3\u5230\u6d88\u706d \u201c\u4e0d\u91cd\u590d\u201d \u9650\u5236\u7684\u7ecf\u5178\u5957\u8def\uff1a**\u5bb9\u65a5**\u3002\n\n\u5148\u4e0d\u8003\u8651 \u201c\u4e0d\u91cd\u590d\u201d \u9650\u5236\uff0c\u5bf9 Y \u548c Z \u72ec\u7acb\u7206\u641c\u51fa\u5728\u4ed6\u4eec\u5df2\u6709\u624b\u724c\u7684\u57fa\u7840\u4e0a\u80fd\u6478\u5230\u7684\u6240\u6709\u624b\u724c\u79cd\u7c7b\uff0c\u8bb0\u4f5c $Y$ \u548c $Z$\uff0c\u8868\u793a\u624b\u724c\u79cd\u7c7b\u96c6\u5408\u3002\u94a6\u5b9a\u4e00\u526f\u624b\u724c\u5f53\u4e2d\u624b\u724c\u4e4b\u95f4\u65e0\u5e8f\u3002\u7b54\u6848\u4e3a\n$$\n\\dfrac {\\sum\\limits_{y\\in Y}\\sum\\limits_{z\\in Z} [y\\cap z = \\varnothing \\land y > z]}{\\dbinom {53 - 2N} {11 - 2N}\\dbinom {11 - 2N}{6 - N}}\n$$\n$y, z$ \u8868\u793a\u4e00\u526f\u624b\u724c\uff0c\u662f\u624b\u724c\u96c6\u5408\u3002\u5206\u6bcd\u4e58\u4ee5 $\\dbinom {11 - 2N} {6 - N}$ \u7684\u539f\u56e0\u662f\u4ece\u9009\u51fa\u6765\u7684 $11 - 2N$ \u5f20\u724c\u4e2d\u518d\u9009 $6 - N$ \u5f20\u724c\u7ed9\u5c0f Z\uff0c\u5269\u4e0b\u6765\u7684\u7ed9\u5c0f Y\u3002\n\n\u5982\u679c\u6ca1\u6709 $y\\cap z = \\varnothing$ \u7684\u9650\u5236\uff0c\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $y$\uff0c\u5e76\u5bf9\u6709\u5e8f\u7684 $Z$ \u7ef4\u62a4\u6307\u9488 $p$ \u8868\u793a $Z_p$ \u5c0f\u4e8e\u5f53\u524d $y$ \u4e14 $Z_p$ \u6700\u5927\u3002\u5bf9\u6240\u6709 $p$ \u6c42\u548c\u5373\u4e3a\u7b54\u6848\u3002\n\n\u6ce8\u610f\u5230\u4e00\u526f\u624b\u724c\u7684\u5f20\u6570\u53ea\u6709 $5$\uff0c\u8003\u8651\u5bb9\u65a5\u94a6\u5b9a $y\\cap z$ \u7684\u4ea4\u96c6\u4e3a $x$\uff1a\u679a\u4e3e $y$ \u7684\u6bcf\u4e2a\u771f\u5b50\u96c6 $x\\subset y$\uff08\u6709 $y > z$ \u7684\u9650\u5236\uff0c$y$ \u548c $z$ \u4e0d\u53ef\u80fd\u76f8\u7b49\uff09\uff0c\u6c42\u5f53\u524d\u626b\u8fc7\u7684\u5305\u542b $x$ \u4f5c\u4e3a\u5b50\u96c6\u7684 $z$ \u7684\u6570\u91cf\uff0c\u4e58\u4ee5\u5bb9\u65a5\u7cfb\u6570 $(-1) ^ {|x|}$\uff08\u8ba9 $x = \\varnothing$ \u7684\u8d21\u732e\u7cfb\u6570\u4e3a $1$\uff09\u3002\u4e3a\u5b9e\u73b0\u8fd9\u4e00\u6b65\uff0c\u6839\u636e $|x| \\leq 4$\uff0c\u53ef\u5728\u626b\u8fc7\u6bcf\u4e2a $z$ \u65f6\u679a\u4e3e\u5176\u771f\u5b50\u96c6 $t$\uff0c\u5bf9 $t$ \u54c8\u5e0c\u5f97\u5230\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $53 ^ 4$ \u7684\u503c\uff0c\u5e76\u5c06\u5bf9\u5e94\u54c8\u5e0c\u503c\u51fa\u73b0\u7684\u6b21\u6570\u589e\u52a0 $1$\u3002\n\n\u6709\u4e2a\u9057\u7559\u95ee\u9898\uff1a\u600e\u4e48\u5bf9\u624b\u724c\u79cd\u7c7b\u6392\u5e8f\u3002\u76f4\u63a5\u5199\u6bd4\u8f83\u51fd\u6570\u5e76\u6392\u5e8f\u4e0d\u4ec5\u5e26 $\\log$\uff0c\u800c\u4e14\u5e38\u6570\u592a\u5927\uff0c\u5f88\u4e0d\u4f18\u7f8e\u3002\u6ce8\u610f\u5230\u82e5\u4e24\u526f\u624b\u724c\u4e4b\u95f4\u65e0\u4ea4\u96c6\uff0c\u5219\u5b83\u4eec\u7684\u6bd4\u8f83\u6700\u591a\u53ea\u4f1a\u6700\u5173\u952e\u7684\u4e00\u5f20\u724c\u7684\u82b1\u8272\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u4ee5 $[0, B = 9\\times 13 ^ 5 \\times 4)$ \u7684\u503c\u57df\u54c8\u5e0c\u51fa\u6bcf\u526f\u724c\u7684\u6743\u503c\uff0c\u5206\u522b\u662f $9$ \u79cd\u724c\u578b\uff0c$13 ^ 5$ \u79cd\u70b9\u6570\uff08\u5b9e\u9645\u4e0a\u662f $\\dbinom{17}{5} - 13$\uff0c\u4f46\u662f $13 ^ 5$ \u5199\u8d77\u6765\u6bd4\u8f83\u65b9\u4fbf\uff09\u4ee5\u53ca $4$ \u79cd\u5173\u952e\u724c\u7684\u82b1\u8272\uff0c\u6ce8\u610f\u70b9\u6570\u7684\u6bd4\u8f83\u987a\u5e8f\u3002\u5f97\u5230\u54c8\u5e0c\u503c\u4e4b\u540e\u6876\u6392\u5373\u53ef\u3002\n\n\u4f8b\u5982\u624b\u724c\u300c\u6885\u82b1 $6$\uff0c\u7ea2\u5fc3 $K$\uff0c\u65b9\u5757 $6$\uff0c\u9ed1\u6843 $3$\uff0c\u6885\u82b1 $3$\u300d\u7684\u54c8\u5e0c\u503c\u4e3a $2\\times 13 ^ 5 \\times 4$\uff08\u5c0f\u4e8e\u4e24\u5bf9\u7684\u724c\u578b\u6709 $2$ \u4e2a\uff09\uff0c\u52a0\u4e0a $4 \\times 13 ^ 2\\times 4$\uff08\u8f83\u5927\u7684\u4e00\u5bf9\u662f $6$\uff0c\u4e24\u5bf9\u6bd4\u8f83\u65f6\u4f18\u5148\u6bd4\u8f83\u8f83\u5927\u7684\u4e00\u5bf9\u7684\u70b9\u6570\uff0c\u540c\u65f6\u5c0f\u4e8e $6$ \u7684\u724c\u6709 $4$ \u5f20\uff09\uff0c\u52a0\u4e0a $1\\times 13\\times 4$\uff08\u8f83\u5c0f\u7684\u4e00\u5bf9\u662f $3$\uff0c\u5c0f\u4e8e $3$ \u7684\u724c\u6709 $1$ \u5f20\uff09\uff0c\u52a0\u4e0a $11 \\times 4$\uff08\u5355\u724c\u662f $K$\uff0c\u5c0f\u4e8e $K$ \u7684\u724c\u6709 $11$ \u5f20\uff09\uff0c\u52a0\u4e0a $1$\uff08\u5bf9\u516d\u5f53\u4e2d\u8f83\u5927\u7684\u82b1\u8272\u662f\u6885\u82b1\uff0c\u800c\u5c0f\u4e8e\u6885\u82b1\u7684\u82b1\u8272\u6709\u4e00\u79cd\uff09\u3002\n\n- \u6ce8\u610f\u7279\u5224 $5432A$ \u987a\u5b50\uff0c\u4ee5\u53ca\u6b64\u65f6\u770b $5$ \u7684\u82b1\u8272\u800c\u4e0d\u662f $A$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}\\left(\\dbinom {53 - 2N}{11 - 2N} + B\\right)$\uff0c\u524d\u9762\u7684\u7ec4\u5408\u6570\u6709 $2 ^ 5$ \u7684\u5e38\u6570\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\nusing pii = pair<int, int>;\nconstexpr int base = 13 * 13 * 13 * 13 * 13 * 4;\nconstexpr int N = 52 * 51 * 50 * 49 * 48 / 120;\nlong long C(int n, int m) {\n  long long res = 1;\n  for(int i = 1; i <= m; i++) res = res * (n - i + 1) / i;\n  return res;\n}\nint calc(const pii *_x) {\n  static pii x[5];\n  memcpy(x, _x, sizeof(x)), sort(x, x + 5);\n  bool tonghua = 1, shunzi = 1, spj = 0;\n  for(int i = 0; i < 5; i++) tonghua &= x[i].se == x[0].se; // \u5224\u65ad\u540c\u82b1\n  for(int i = 0; i < 5; i++) shunzi &= x[i].fi == x[0].fi + i; // \u5224\u65ad\u987a\u5b50\n  spj = !x[0].fi && x[1].fi == 1 && x[2].fi == 2 && x[3].fi == 3 && x[4].fi == 12; // \u7279\u6b8a\u5224\u65ad 10 J Q K A\n  if(tonghua && shunzi) return 8 * base + x[4].fi * 4 + x[4].se; // \u540c\u82b1\u987a\n  if(tonghua && spj) return 8 * base + 3 * 4 + x[3].se;\n  if(x[0].fi == x[3].fi || x[1].fi == x[4].fi) return 7 * base + x[2].fi; // \u56db\u6761\n  if(x[0].fi == x[2].fi && x[3].fi == x[4].fi) return 6 * base + x[2].fi; // \u4e09\u5e26\u4e8c\n  if(x[2].fi == x[4].fi && x[0].fi == x[1].fi) return 6 * base + x[2].fi; // \u4e09\u5e26\u4e8c\n  int hshdian = 0;\n  for(int i = 4; ~i; i--) hshdian = hshdian * 13 + x[i].fi;\n  hshdian = hshdian * 4 + x[4].se;\n  if(tonghua) return 5 * base + hshdian; // \u540c\u82b1\n  if(shunzi) return 4 * base + x[4].fi * 4 + x[4].se; // \u987a\u5b50\n  if(spj) return 4 * base + 3 * 4 + x[3].se;\n  if(x[0].fi == x[2].fi || x[1].fi == x[3].fi || x[2].fi == x[4].fi) return 3 * base + x[2].fi; // \u4e09\u6761\n  int cnt = 0, hshdui = 0, huase = -1, vis[5];\n  memset(vis, 0, sizeof(vis));\n  for(int i : {3, 2, 1, 0})\n    if(x[i].fi == x[i + 1].fi) {\n      hshdui = hshdui * 13 + x[i].fi;\n      if(huase == -1) huase = x[i + 1].se;\n      cnt++, vis[i] = vis[i + 1] = 1;\n    }\n  for(int i : {4, 3, 2, 1, 0}) if(!vis[i]) hshdui = hshdui * 13 + x[i].fi;\n  hshdui = hshdui * 4 + huase;\n  if(cnt == 2) return 2 * base + hshdui; // \u4e24\u5bf9\n  if(cnt == 1) return base + hshdui; // \u4e00\u5bf9\n  return hshdian; // \u5355\u724c\n}\npii cur[5], card[52];\nint n, vis[52], player, cnty, cntz;\nstruct dat {\n  int cd[5], hsh;\n  bool operator < (const dat &rhs) const {return hsh < rhs.hsh;}\n  void deal() {sort(cd, cd + 5);}\n} bucy[N / 10], bucz[N];\nlong long fenzi, fenmu;\nvoid dfs(int cnt, int las) {\n  if(cnt == 5) {\n    if(player == 1) {\n      for(int i = 0; i < 5; i++) bucy[cnty].cd[i] = cur[i].fi * 4 + cur[i].se;\n      bucy[cnty].deal();\n      bucy[cnty++].hsh = calc(cur);\n    }\n    else {\n      for(int i = 0; i < 5; i++) bucz[cntz].cd[i] = cur[i].fi * 4 + cur[i].se;\n      bucz[cntz].deal();\n      bucz[cntz++].hsh = calc(cur);\n    }\n    assert(cnty <= N && cntz <= N);\n    return;\n  }\n  for(int i = las; i < 52; i++) if(!vis[i]) vis[i] = 1, cur[cnt] = card[i], dfs(cnt + 1, i), vis[i] = 0;\n}\nint w[53 * 53 * 53 * 53];\nint main() {\n  cin >> n;\n  fenmu = C(53 - 2 * n, 11 - 2 * n) * C(11 - 2 * n, 5 - n);\n  for(int i = 0; i < 52; i++) card[i] = {i / 4, i & 3};\n  for(int i = 0; i < n; i++) {\n    cin >> cur[i].fi >> cur[i].se;\n    if(cur[i].fi == 1) cur[i].fi = 14;\n    cur[i].fi -= 2, cur[i].se = 4 - cur[i].se;\n    vis[cur[i].fi * 4 + cur[i].se] = 1;\n  }\n  player = 1, dfs(n, 0);\n  memset(vis, 0, sizeof(vis));\n  for(int i = 0; i + 1 < n; i++) {\n    cin >> cur[i].fi >> cur[i].se;\n    if(cur[i].fi == 1) cur[i].fi = 14;\n    cur[i].fi -= 2, cur[i].se = 4 - cur[i].se;\n    vis[cur[i].fi * 4 + cur[i].se] = 1;\n  }\n  player = 2, dfs(n - 1, 0);\n  sort(bucy, bucy + cnty);\n  if(n > 1) sort(bucz, bucz + cntz);\n  else {\n    static int bucket[base * 9];\n    static dat tmp[N];\n    memset(bucket, 0, sizeof(bucket));\n    for(int i = 0; i < cntz; i++) bucket[bucz[i].hsh]++;\n    for(int i = 1; i < base * 9; i++) bucket[i] += bucket[i - 1];\n    for(int i = cntz - 1; ~i; i--) tmp[--bucket[bucz[i].hsh]] = bucz[i];\n    memcpy(bucz, tmp, sizeof(tmp));\n  }\n  int cy = 0, cz = 0;\n  auto addy = [&]() {\n    static int hsh[31];\n    hsh[0] = 0, fenzi += w[0];\n    for(int i = 1; i < 31; i++) {\n      int low = i & -i, par = __builtin_popcount(i) & 1;\n      hsh[i] = hsh[i ^ low] * 53 + bucy[cy].cd[__builtin_ctz(low)] + 1;\n      fenzi += w[hsh[i]] * (par ? -1 : 1);\n    }\n    cy++;\n  };\n  auto addz = [&]() {\n    static int hsh[31];\n    hsh[0] = 0, w[0]++;\n    for(int i = 1; i < 31; i++) {\n      int low = i & -i;\n      w[hsh[i] = hsh[i ^ low] * 53 + bucz[cz].cd[__builtin_ctz(low)] + 1]++;\n    }\n    cz++;\n  };\n  while(cy < cnty && cz < cntz) {\n    if(bucy[cy].hsh <= bucz[cz].hsh) addy();\n    else addz();\n  }\n  while(cy < cnty) addy();\n  long long d = __gcd(fenzi, fenmu);\n  printf(\"%lld/%lld\\n\", fenzi / d, fenmu / d);\n  return cerr << \"Time: \" << clock() << endl, 0;\n}\n```",
        "postTime": 1655562817,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "[CTSC2012]\u68ad\u54c8\u6e38\u620f"
    },
    {
        "content": "#### Part 1\n\n\u9996\u5148\uff0c\u9898\u76ee\u4e2d\u9610\u8ff0\u4e86\u5197\u957f\u7684\u9898\u610f\uff0c\u7ecf\u8fc7\u6574\u7406\uff0c\u4fbf\u53ef\u53d1\u73b0\u4e24\u4eba\u5404\u81ea\u7684\u724c\u5c40\u60c5\u51b5\u6570\u4e0d\u4f1a\u8d85\u8fc7 $ \\binom {52} 5 $\uff0c\u5927\u7ea6\u4e24\u767e\u591a\u4e07\uff0c\u663e\u7136\u9700\u8981\u5728\u8fd9\u4e0a\u9762\u505a\u6587\u7ae0\u3002\n\n#### Part 2\n\n\u6211\u4eec\u53d1\u73b0\u5047\u5b9a\u4e24\u4eba\u7684\u53ef\u80fd\u724c\u5c40\u7684\u96c6\u5408\u4e3a $ Card_{0/1} $\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a\u96c6\u5408\u4e2d\u7684\u6bcf\u4e00\u5bf9\u724c\u5c40\u4e4b\u95f4\u90fd\u4f1a\u5b58\u5728\u5927\u5c0f\u5173\u7cfb\uff0c\u4fbf\u5bf9\u6bcf\u4e2a\u724c\u5c40\u8bbe\u5b9a\u4e00\u4e2a\u503c $ val $\uff0c\u5c06\u724c\u5c40\u6309\u5404\u81ea\u7684 $ val $ \u503c sort \u5373\u53ef\u3002\n\n#### Part 3\n\n\u90a3\u4e48\u4e24\u4eba\u724c\u5c40\u7684 $ val $ \u503c\u5747\u5df2\u5355\u589e\uff0c\u5373\u5177\u6709\u5355\u8c03\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u53cc\u6307\u9488\u679a\u4e3e\u5373\u53ef\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u4e24\u4eba\u7684\u724c\u5c40\u53ef\u80fd\u4f1a\u51fa\u73b0\u91cd\u590d\u4f7f\u7528\u540c\u4e00\u5f20\u724c\uff0c\u4f46\u4e5f\u597d\u505a\uff0c\u56e0\u4e3a\u6bcf\u4eba\u81f3\u591a $ 5 $ \u5f20\u724c\uff0c\u66b4\u529b\u5bb9\u65a5\u5373\u53ef\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff08\u4ec5\u4f9b\u53c2\u8003\u7ed3\u6784\uff0c\u6709\u9519\u8bef\u6539\u52a8\uff0ccopy \u65e0\u6cd5 AC\uff09\uff1a\n\n```cpp\n#include<iostream>\n#include<iomanip>\n#include<cmath>\n#include<cstring>\n#include<cstdio>\n#include<algorithm>\n#include<queue>\n#include<map>\nusing namespace std;\n#define md(a) a=(a%mod+mod)%mod\n#define file(a) freopen(#a\".in\",\"r\",stdin);freopen(#a\".out\",\"w\",stdout)\nconst int ALL=2600000,ALL2=15000000;\nint n,Num[2],Pow[6],tis[ALL2];\nbool Had_Poker[60];\nstruct Poke{int num,col;bool friend operator <(Poke a,Poke b){return a.num>b.num||(a.num==b.num&&a.col<b.col);}};\nstruct Type{Poke a[5];int val;bool friend operator <(Type a,Type b){return a.val<b.val;}};\nType Card[2][ALL],P1,P2;\nlong long C(int n,int m){long long ans=1;for(int i=1;i<=m;i++)ans=1ll*ans*(n-i+1)/i;return ans;}\nvoid Debug1(Type x)\n{\n\tfor(int i=0;i<=4;i++)\n\t{\n\t\tPoke y=x.a[i];\n\t\tif(y.col==1)printf(\"{\u9ed1\u6843 \");\n\t\telse if(y.col==2)printf(\"{\u7ea2\u5fc3 \");\n\t\telse if(y.col==3)printf(\"{\u6885\u82b1 \");\n\t\telse if(y.col==4)printf(\"{\u65b9\u5757 \");\n\t\telse{printf(\"{}\");continue;}\n\t\tif(y.num>=2&&y.num<=10)printf(\"%d\",y.num);\n\t\tif(y.num==11)printf(\"J\");\n\t\tif(y.num==12)printf(\"Q\");\n\t\tif(y.num==13)printf(\"K\");\n\t\tif(y.num==1||y.num==14)printf(\"A\");\n\t\tprintf(\"}\");\n\t}\n}\n\nvoid Debug2()\n{\n\tType ans,ans2;\n\tans.a[0]={7,3};\n\tans.a[1]={6,4};\n\tans.a[2]={13,3};\n\tans.a[3]={3,2};\n\tans.a[4]={12,4};\n\tprint(ans);puts(\"\");\n\tint GG=Getres(ans);\n\tcout<<\"\u7c7b\u578b\uff1a\"<<GG<<endl;\n\tfor(int i=0;i<=4;i++)ans2.a[i]=a[i];\n\tprint(ans2);puts(\"\");\n}\nnamespace Game_Pre\n{\n\tPoke a[5];\n\tint Getres(Type &x)\n\t{\n\t\tfor(int i=0;i<=4;i++)a[i]=x.a[i];sort(a,a+5);\n\t\t\n\t\tif(a[0].col==a[1].col&&a[1].col==a[2].col&&a[2].col==a[3].col&&a[3].col==a[4].col)\n\t\t{\n\t\t\tif(a[0].num-1==a[1].num&&a[1].num-1==a[2].num&&a[2].num-1==a[3].num&&a[3].num-1==a[4].num)return 1;\n\t\t\tif(a[0].num==14&&a[1].num==5&&a[2].num==4&&a[3].num==3&&a[4].num==2)\n\t\t\t{\n\t\t\t\tPoke chk=a[0];\n\t\t\t\tfor(int i=0;i<=3;i++)a[i]=a[i+1];\n\t\t\t\ta[4]=chk,a[4].num=1;return 1;\n\t\t\t}\n\t\t}//1\n\t\t\n\t\tif(a[0].num==a[1].num&&a[1].num==a[2].num&&a[2].num==a[3].num)return 2;\n\t\tif(a[1].num==a[2].num&&a[2].num==a[3].num&&a[3].num==a[4].num)\n\t\t{\n\t\t\tPoke chk=a[0];\n\t\t\tfor(int i=0;i<=3;i++)a[i]=a[i+1];\n\t\t\ta[4]=chk;return 2;\n\t\t}//2\n\t\t\n\t\tif(a[0].num==a[1].num&&a[1].num==a[2].num&&a[3].num==a[4].num)return 3;\n\t\tif(a[0].num==a[1].num&&a[2].num==a[3].num&&a[3].num==a[4].num)\n\t\t{\n\t\t\tPoke chk1=a[0],chk2=a[2];\n\t\t\ta[0]=a[2],a[1]=a[3],a[2]=a[4],a[3]=chk1,a[4]=chk2;\n\t\t\treturn 3;\n\t\t}//3\n\t\t\n\t\tif(a[0].col==a[1].col&&a[1].col==a[2].col&&a[2].col==a[3].col&&a[3].col==a[4].col)return 4;\n\t\t//4\n\t\t\n\t\tif(a[0].num-1==a[1].num&&a[1].num-1==a[2].num&&a[2].num-1==a[3].num&&a[3].num-1==a[4].num)return 5;\n\t\tif(a[0].num==14&&a[1].num==5&&a[2].num==4&&a[3].num==3&&a[4].num==2)\n\t\t{\n\t\t\tPoke chk=a[0];\n\t\t\tfor(int i=0;i<=3;i++)a[i]=a[i+1];\n\t\t\ta[4]=chk,a[4].num=1;return 5;\n\t\t}//5\n\t\t\n\t\tif(a[0].num==a[1].num&&a[1].num==a[2].num)return 6;\n\t\tif(a[1].num==a[2].num&&a[2].num==a[3].num)\n\t\t{\n\t\t\tPoke chk=a[0];\n\t\t\ta[0]=a[1],a[1]=a[2],a[2]=a[3],a[3]=chk;\n\t\t\treturn 6;\n\t\t}\n\t\tif(a[2].num==a[3].num&&a[3].num==a[4].num)\n\t\t{\n\t\t\tPoke chk1=a[0],chk2=a[1];\n\t\t\ta[0]=a[2],a[1]=a[3],a[2]=a[4],a[3]=chk1,a[4]=chk2;\n\t\t\treturn 6;\n\t\t}//6\n\t\t\n\t\tif(a[0].num==a[1].num&&a[2].num==a[3].num)return 7;\n\t\tif(a[0].num==a[1].num&&a[3].num==a[4].num)\n\t\t{\n\t\t\tPoke chk=a[2];\n\t\t\ta[2]=a[3],a[3]=a[4],a[4]=chk;\n\t\t\treturn 7;\n\t\t}\n\t\tif(a[1].num==a[2].num&&a[3].num==a[4].num)\n\t\t{\n\t\t\tPoke chk=a[0];\n\t\t\ta[0]=a[1],a[1]=a[2],a[2]=a[3],a[3]=a[4],a[4]=chk;\n\t\t\treturn 7;\n\t\t}//7\n\t\t\n\t\tif(a[0].num==a[1].num)return 8;\n\t\tif(a[1].num==a[2].num)\n\t\t{\n\t\t\tPoke chk=a[0];\n\t\t\ta[0]=a[1],a[1]=a[2],a[2]=chk;\n\t\t\treturn 8;\n\t\t}\n\t\tif(a[2].num==a[3].num)\n\t\t{\n\t\t\tPoke chk1=a[0],chk2=a[1];\n\t\t\ta[0]=a[2],a[1]=a[3],a[2]=chk1,a[3]=chk2;\n\t\t\treturn 8;\n\t\t}\n\t\tif(a[3].num==a[4].num)\n\t\t{\n\t\t\tPoke chk1=a[3],chk2=a[4];\n\t\t\ta[4]=a[2],a[3]=a[1],a[2]=a[0],a[0]=chk1,a[1]=chk2;\n\t\t\treturn 8;\n\t\t}//8\n\t\t\n\t\treturn 9;//9\n\t}\n\tint Getans(Type &x)\n\t{\n\t\tint res=Getres(x),ans=(9-res)*Pow[5]*4+(4-a[4].col);\n\t\tif(res==1||res==5)\n\t\t{\n\t\t\tans+=(a[4].num-1)*4;\n\t\t\treturn ans;\n\t\t}\n\t\tif(res==2||res==3)\n\t\t{\n\t\t\tans+=(a[0].num-2)*Pow[1]*4;\n\t\t\tans+=(a[4].num-2)*4;\n\t\t\treturn ans;\n\t\t}\n\t\tif(res==4||res==9)\n\t\t{\n\t\t\tfor(int i=0;i<=4;i++)ans+=(a[i].num-2)*Pow[4-i]*4;\n\t\t\treturn ans;\n\t\t}\n\t\tif(res==6)\n\t\t{\n\t\t\tans+=(a[0].num-2)*Pow[2]*4;\n\t\t\tans+=(a[3].num-2)*Pow[1]*4;\n\t\t\tans+=(a[4].num-2)*4;\n\t\t\treturn ans;\n\t\t}\n\t\tif(res==7)\n\t\t{\n\t\t\tans+=(a[0].num-2)*Pow[2]*4;\n\t\t\tans+=(a[2].num-2)*Pow[1]*4;\n\t\t\tans+=(a[4].num-2)*4;\n\t\t\treturn ans;\n\t\t}\n\t\tif(res==8)\n\t\t{\n\t\t\tfor(int i=1;i<=4;i++)ans+=(a[i].num-2)*Pow[4-i]*4;\n\t\t\treturn ans;\n\t\t}\n\t}\n};\nusing namespace Game_Pre;\nnamespace Game_Init\n{\n\tType Vsted;Poke a[5];\n\tvoid Getlas(int k,int p,int las)\n\t{\n\t\tif(k==6)\n\t\t{\n\t\t\tfor(int i=0;i<=4;i++)a[i]=Vsted.a[i];sort(a,a+5);\n\t\t\tCard[p][++Num[p]]=Vsted;return ;\n\t\t}\n\t\tfor(int i=las;i<=52;i++)\n\t\t{\n\t\t\tif(Had_Poker[i])continue;\n\t\t\tHad_Poker[i]=1,Vsted.a[k-1]={(i-1)%13+1,(i-1)/13+1};\n\t\t\tGetlas(k+1,p,i);Had_Poker[i]=0;\n\t\t}\n\t}\n};\nvoid Before()\n{\n\tscanf(\"%d\",&n),Pow[0]=1;int uls;\n\tfor(int i=1;i<=5;i++)Pow[i]=Pow[i-1]*13;\n\tfor(int i=1,x,y;i<=n;i++)scanf(\"%d%d\",&x,&y),Had_Poker[13*(y-1)+x]=1,P1.a[i-1]={x,y};\n\tfor(int i=1,x,y;i<=n-1;i++)scanf(\"%d%d\",&x,&y),Had_Poker[13*(y-1)+x]=1,P2.a[i-1]={x,y};\n\tGame_Init::Vsted=P1,Game_Init::Getlas(n+1,0,1);\n\tGame_Init::Vsted=P2,Game_Init::Getlas(n,1,1);\n\tfor(int i=1;i<=Num[0];i++)for(int j=0;j<=4;j++)if(Card[0][i].a[j].num==1)Card[0][i].a[j].num=14;\n\tfor(int i=1;i<=Num[1];i++)for(int j=0;j<=4;j++)if(Card[1][i].a[j].num==1)Card[1][i].a[j].num=14;\n\tfor(int i=1;i<=Num[0];i++)uls=Game_Pre::Getans(Card[0][i]),Card[0][i].val=uls;\n\tfor(int i=1;i<=Num[1];i++)uls=Game_Pre::Getans(Card[1][i]),Card[1][i].val=uls;\n}\nvoid ins(int pos)\n{\n\tType Now=Card[1][pos];\n\tfor(int i=0;i<=30;i++)\n\t{\n\t\tint st=0;\n\t\tfor(int j=0;j<=4;j++)\n\t\t{\n\t\t\tif(((i>>j)&1)==0)continue;\n\t\t\tint stn=(Now.a[j].col-1)*14+Now.a[j].num;\n\t\t\tst=st*57+stn;\n\t\t}\n\t\ttis[st]++;\n\t}\n}\nlong long During()\n{\n\tint j=0;\n\tlong long chk[5]={0,0,0,0,0},ans=0;\n\tsort(Card[0]+1,Card[0]+Num[0]+1);\n\tsort(Card[1]+1,Card[1]+Num[1]+1);\n\tfor(int i=1;i<=Num[0];i++)\n\t{\n\t\tType Now=Card[0][i];\n\t\twhile(j<Num[1]&&Card[0][i].val>Card[1][j+1].val)j++,ins(j);\n\t\tfor(int S=0;S<=30;S++)\n\t\t{\n\t\t\tint st=0,siz=0;\n\t\t\tfor(int q=0;q<=4;q++)\n\t\t\t{\n\t\t\t\tif(((S>>q)&1)==0)continue;\n\t\t\t\tint stn=(Now.a[q].col-1)*14+(Now.a[q].num);\n\t\t\t\tst=st*57+stn,siz++;\n\t\t\t}\n\t\t\tchk[siz]+=tis[st];\n\t\t}\n\t\tfor(int p=0;p<=4;p++){if(p%2==0)ans+=chk[p];else ans-=chk[p];}\n\t\tfor(int p=0;p<=4;p++)chk[p]=0;\n\t}\n\treturn ans;\n}\nsigned main()\n{\n\tBefore();long long ans1=C(53-n*2,11-n*2)*C(11-n*2,6-n);\n\tlong long ans=During(),d=__gcd(ans,ans1);\n\tif(ans==0)return cout<<\"0/1\",0;\n\tans/=d,ans1/=d;\n\tcout<<ans<<\"/\"<<ans1;\n\treturn 0;\n}\n```\n",
        "postTime": 1670550922,
        "uid": 556042,
        "name": "Iratis",
        "ccfLevel": 7,
        "title": "P4010-\u68ad\u54c8\u6e38\u620f"
    }
]