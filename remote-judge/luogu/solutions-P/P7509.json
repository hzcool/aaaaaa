[
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a $O(nk\\log p)$ \u7684\u505a\u6cd5\u3002\n\n\u663e\u7136 dp\uff0c\u7528\u4e09\u7ef4\u5206\u522b\u8868\u793a\u5f53\u524d\u4f4d\u7f6e\uff0c\u5f53\u524d\u8fde\u7eed\u6bb5\u6570\uff0c\u5f53\u524d\u662f\u5426\u4e3a $1$\u3002\u5f00\u4e00\u4e2a\u6570\u7ec4\u8868\u793a\u671f\u671b\u4e58\u4e0a\u6982\u7387\uff0c\u518d\u5f00\u4e00\u4e2a\u8868\u793a\u6982\u7387\u3002\n\n\u4ee3\u7801\u4e2d\u5206\u522b\u53eb `dp` \u548c `qwq`\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u72b6\u6001\uff0c\u6211\u4eec\u53d1\u73b0\u5b83\u6700\u591a\u7531\u4e24\u4e2a\u5148\u524d\u72b6\u6001\u63a8\u51fa\u6765\u3002\n\n\u6211\u4eec\u7b97\u51fa\u8fd9\u4e2a\u72b6\u6001\u7684\u6982\u7387\u4ee5\u53ca\u7531\u6bcf\u4e2a\u72b6\u6001\u8f6c\u79fb\u8fc7\u6765\u7684\u6982\u7387\u3002\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u7b97\u4e86\u3002\n\n\u5177\u4f53\u7684 dp \u5f0f\u5b50\u89c1\u4ee3\u7801\u3002\n\n\u4ee3\u7801\u5728\u4e0b\u9762\u3002\u7531\u4e8e\u4e2d\u95f4\u7684 `Mod` \u5199\u7684\u5f88\u4e11\uff0c\u5c31\u6254 [\u8fd9\u91cc](https://www.luogu.com.cn/paste/59mpe2yn).\n\n```cpp\n#include <stdio.h>\ninline int read()\n{\n\tint num=0;char c=getchar();\n\twhile(c<48||c>57)c=getchar();\n\twhile(c>47&&c<58)num=(num<<3)+(num<<1)+(c^48),c=getchar();\n\treturn num;\n}\n#define int long long\nconst int mod = 998244353;\nint qp(int x,int p)\n{\n\tint res=1;\n\twhile(p)\n\t{\n\t\tif(p&1)res=res*x%mod;\n\t\tx=x*x%mod;\n\t\tp>>=1;\n\t}\n\treturn res;\n}\nstruct Mod{...};\nMod a[100005],p[100005],dp[100005][20][2],qwq[100005][20][2];\nsigned main()\n{\n\tint n=read(),m=read();\n    for(int i=1;i<=n;i++)a[i]=read();\n    for(int i=1;i<=n;i++)p[i]=read();\n    //memset(dp,-0x3f,sizeof(dp));\n    qwq[0][0][0]=1;\n    Mod unit=1;\n    for(int i=1;i<=n;i++)\n    {\n        for(int k=0;k<=m;k++)\n        {\n            if(k==0)\n            {\n                qwq[i][k][0]=qwq[i-1][k][0]*(mod+1-p[i].x);\n                goto hidsa;\n            }\n            if(k+k-1>i)continue;\n            else if(k+k-1==i)\n            {\n                qwq[i][k][1]=qwq[i-1][k-1][0]*p[i];\n                //dp[i][k][1]=qwq[i][k][1]*a[i]+dp[i-1][k-1][0];\n                dp[i][k][1]=a[i]+dp[i-1][k-1][0];\n            }\n            else\n            {\n                qwq[i][k][1]=qwq[i-1][k-1][0]*p[i]+qwq[i-1][k][1]*p[i];\n                Mod wqw=qwq[i-1][k-1][0]+qwq[i-1][k][1];\n                wqw=unit/wqw;\n                dp[i][k][1]=a[i];//dp[i-1][k-1][0]*qwq[i-1][k-1][0]\n                dp[i][k][1]+=dp[i-1][k-1][0]*qwq[i-1][k-1][0]*wqw;\n                dp[i][k][1]+=dp[i-1][k][1]*qwq[i-1][k][1]*wqw;\n                //dp[i][k][1]=qwq[i][k][1]*a[i]+dp[i-1][k-1][0]+dp[i-1][k][1];\n                qwq[i][k][0]=(qwq[i-1][k][0]+qwq[i-1][k][1])*(mod+1-p[i].x);\n                //dp[i][k][0]=qwq[i][k][0]*(dp[i-1][k][0]+dp[i-1][k][1]);\n                wqw=qwq[i-1][k][0]+qwq[i-1][k][1];\n                wqw=unit/wqw;\n                dp[i][k][0]=dp[i-1][k][0]*qwq[i-1][k][0]*wqw;\n                dp[i][k][0]+=dp[i-1][k][1]*qwq[i-1][k][1]*wqw;\n            }\n            \n        /*    if(k*2-1>i)continue;\n            if(k*2-1!=i){\n            dp[i][k][0]+=dp[i-1][k][1]*(mod-p[i].x+1);\n            dp[i][k][0]+=dp[i-1][k][0]*(mod-p[i].x+1);}\n            //dp[i][k][1]=p[i]*a[i];\n            dp[i][k][1]+=(a[i]+dp[i-1][k-1][0]+dp[i-1][k][1])*p[i];*/\n            hidsa:;/*\n            printf(\"dp[ %lld %lld %lld] = %lld\\n\",i,k,0ll,dp[i][k][0].x);\n            printf(\"dp[ %lld %lld %lld] = %lld\\n\",i,k,1ll,dp[i][k][1].x);\n            printf(\"qwq[ %lld %lld %lld] = %lld\\n\",i,k,0ll,qwq[i][k][0].x);\n            printf(\"qwq[ %lld %lld %lld] = %lld\\n\",i,k,1ll,qwq[i][k][1].x);*/\n        }\n    }\n    //printf(\"%lld\\n\",((dp[n][m][0]+dp[n][m][1])/qp(2,n)*(qp(2,n)-1)).x);\n    printf(\"%lld\\n\",(dp[n][m][0]*qwq[n][m][0]+dp[n][m][1]*qwq[n][m][1]).x);\n}\n/*\n2 1\n3 5\n0 1\n*/\n```",
        "postTime": 1618882854,
        "uid": 171487,
        "name": "cmll02",
        "ccfLevel": 8,
        "title": "devinwang is watching you"
    },
    {
        "content": "\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(nk \\log p)$\u3002   \n\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u4e24\u4e2a\u6570\u7ec4\uff0c\u5206\u522b\u4e3a $dp$ \u548c $g$\uff0c$g$ \u662f\u4f5c\u4e3a\u6982\u7387\u8fdb\u884c\u8f85\u52a9\u7684\u8ba1\u7b97\uff0c\u6bcf\u4e00\u4e2a\u72b6\u6001\u90fd\u53ef\u5728\u524d\u4e00\u4e2a\u72b6\u6001\u8fdb\u884c\u8f6c\u79fb\u3002\u800c $dp$ \u6570\u7ec4\u600e\u4e48\u6253\u76f8\u4fe1\u6211\u4e0d\u7528\u591a\u8bf4\u4e86\u5427\u3002        \n\u6839\u636e\u9898\u610f\uff0c\u53ef\u4ee5\u6253\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a   \n$dp(i,j,0) = (1 - p(i)) \\times (dp(i - 1,j,1) + p(i - 1,j,0))$     \n$dp(i,j,1)=p(i) \\times (dp(i - 1,j,1) + g(i - 1,j,1) \\times a(i)) + p(i) \\times (dp(i - 1,j - 1,0) + g(i - 1,j - 1,0) \\times a(i))$   \n$i$: \u5f53\u524d\u4f4d\u7f6e  \n$j$: \u5f53\u5148\u8fde\u7eed\u7684\u6bb5\u6570   \n\u8fd0\u7b97\u7b26\u91cd\u8f7d\u4e2d\u7684\u9664\u6cd5\u91cd\u8f7d\u7528\u5feb\u901f\u5e42\u5373\u53ef\u3002  \n\u9644\u4e0a\u6700\u957f\u672c\u9898\u4ee3\u7801\uff1a  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst long long mo=998244353;\nconst long long MAX_N=1e5+5,MAX_M=25;\ninline int read(){\n\tlong long x=0;char ch=getchar();\n\twhile (ch<'0'||ch>'9') ch=getchar();\n\twhile (ch>='0'&&ch<='9') x=x*10+ch-48,ch=getchar();\n\treturn x;\n}//\u8bfb\u5165\u4f18\u5316\nlong long kkksc03(long long x,long long y){\n\tlong long s=1;\n\twhile (y!=0){\n\t\tif (y%2==1) s=s*x%mo;\n\t\tx=x*x%mo;\n\t\ty/=2;\n\t}\n\treturn s;\n}//\u5feb\u901f\u5e42\nstruct kira{\n\tlong long x;\n\tkira(long long x=0):x(x){};\n\tkira operator=(const long long &xx){\n\t\tx=xx;\n\t\treturn *this;\n\t}\n\tkira operator+(const kira &b){\n\t\treturn (kira)((x+b.x)%mo);\n\t}\n\tkira operator-(const kira &b){\n\t\treturn (kira)((x-b.x+mo)%mo);\n\t}\n\tkira operator*(const kira &b){\n\t\treturn (kira)((x*b.x)%mo);\n\t}\n\tkira operator/(const kira &b){\n\t\treturn (kira)(x*kkksc03(b.x,mo-2)%mo);\n\t}\n\tkira operator^(const kira &b){\n\t\treturn (kira)(kkksc03(x,b.x));\n\t}\n\tkira operator+=(const kira &b){\n\t\treturn (kira)((x+b.x)%mo);\n\t}\n\tkira operator-=(const kira &b){\n\t\treturn (kira)((x-b.x+mo)%mo);\n\t}\n\tkira operator*=(const kira &b){\n\t\treturn (kira)((x*b.x)%mo);\n\t}\n\tkira operator/=(const kira &b){\n\t\treturn (kira)(x*kkksc03(b.x,mo-2)%mo);\n\t}\n\tkira operator^=(const kira &b){\n\t\treturn (kira)(kkksc03(x,b.x));\n\t}\n\tkira operator+(const long long  &b){\n\t\treturn (kira)((x+b)%mo);\n\t}\n\tkira operator-(const long long &b){\n\t\treturn (kira)((x-b+mo)%mo);\n\t}\n\tkira operator*(const long long &b){\n\t\treturn (kira)((x*b)%mo);\n\t}\n\tkira operator/(const long long &b){\n\t\treturn (kira)(x*kkksc03(b,mo-2)%mo);\n\t}\n\tkira operator^(const long long &b){\n\t\treturn (kira)(kkksc03(x,b));\n\t}\n\tkira operator+=(const long long &b){\n\t\treturn (kira)((x+b)%mo);\n\t}\n\tkira operator-=(const long long &b){\n\t\treturn (kira)((x-b+mo)%mo);\n\t}\n\tkira operator*=(const long long &b){\n\t\treturn (kira)((x*b)%mo);\n\t}\n\tkira operator/=(const long long &b){\n\t\treturn (kira)(x*kkksc03(b,mo-2)%mo);\n\t}\n\tkira operator^=(const long long &b){\n\t\treturn (kira)(kkksc03(x,b));\n\t}\n\tbool operator==(const long long b){\n\t\treturn x==b;\n\t}\n};//\u8d85\u7ea7\u53d8\u6001\u7684\u8fd0\u7b97\u7b26\u91cd\u8f7d\nlong long n,m,i,k;\nkira a[MAX_N],p[MAX_N],u,g[MAX_N][MAX_M][2],dp[MAX_N][MAX_M][2],gundam;\nint main(){\n\tn=read();m=read();\n\tfor (i=1;i<=n;i++)  a[i]=read();\n\tfor (i=1;i<=n;i++)\tp[i]=read();//\u624b\u6253\u8bfb\u5165\n\tg[0][0][0]=1;//\u521d\u59cb\u5316\n\tu=1;//\u56e0\u4e3a\u67d0\u4e9b\u7075\u5f02\u4e8b\u4ef6\uff08\u7c7b\u578b\u4e0d\u76f8\u7b49\u4e8b\u4ef6\uff09\uff0c\u5fc5\u987b\u8981\u8fd9\u4e48\u5b9a\u4e00\u4e2a\u3002\n\tfor (i=1;i<=n;i++)\n\t\tfor (k=0;k<=m;k++)\n\t\t\tif (k==0)\n\t\t\t\tg[i][k][0]=g[i-1][k][0]*(mo+1-p[i].x);\n\t\t\telse{\n\t\t\t\tif (k+k-1>i) continue;\n\t\t\t\telse if (k+k-1==i){\n\t\t\t\t\tg[i][k][1]=g[i-1][k-1][0]*p[i];\n\t\t\t\t\tdp[i][k][1]=dp[i-1][k-1][0]+a[i];\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tg[i][k][1]=g[i-1][k-1][0]*p[i]+g[i-1][k][1]*p[i];\n\t\t\t\t\tgundam=u/(g[i-1][k-1][0]+g[i-1][k][1]);\n\t\t\t\t\tdp[i][k][1]=a[i]+dp[i-1][k-1][0]*g[i-1][k-1][0]*gundam+dp[i-1][k][1]*g[i-1][k][1]*gundam;\n\t\t\t\t\tg[i][k][0]=(g[i-1][k][1]+g[i-1][k][0])*(mo+1-p[i].x);\n\t\t\t\t\tgundam=u/(g[i-1][k][0]+g[i-1][k][1]);\n\t\t\t\t\tdp[i][k][0]=dp[i-1][k][0]*g[i-1][k][0]*gundam+dp[i-1][k][1]*g[i-1][k][1]*gundam;//\u90fd\u61c2\u7684\n\t\t\t\t}\n\t\t\t}\n\tprintf(\"%lld\\n\",(dp[n][m][0]*g[n][m][0]+dp[n][m][1]*g[n][m][1]).x);\n\treturn 0; \n}\n```\n",
        "postTime": 1619012132,
        "uid": 315398,
        "name": "\u5c0f\u6768\u5c0f\u5c0f\u6768",
        "ccfLevel": 5,
        "title": "P7509 \u6495\u88c2\u62b9\u6d88"
    },
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1a[my blog](https://www.cnblogs.com/SkyRainWind/p/17051926.html)\n\n[\u8fd9\u662f\u5b98\u65b9\u9898\u89e3](https://www.luogu.com.cn/blog/your-alpha1022/cooi-round-1-ti-xie)\n\n\u9898\u89e3\uff1a\n\n\u8bbe $f[i][j][0/1]$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u4f4d\u7f6e\uff0c\u5df2\u7ecf\u5f62\u6210\u4e86\u6781\u5927\u7684 $j$ \u6bb5\uff0c\u5f53\u524d\u4f4d\u7f6e\u4e3a 0/1 \u7684\u671f\u671b\u503c \uff1b $g[i][j][0/1]$ \u4e5f\u540c\u7406\uff0c\u4e0d\u8fc7\u7ef4\u62a4\u7684\u662f\u6982\u7387\u3002\n\n\uff08\u601d\u8003\uff1a\u8fd9\u79cd\u4e0d\u662f\u6c42\u6700\u4f18\u51b3\u7b56\u800c\u662f\u6c42\u67d0\u79cd\u56fa\u5b9a\u7684\u7b54\u6848\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u518d\u5f00\u4e00\u4e2a\u6570\u7ec4\u7ef4\u62a4\u4e00\u4e0b\u5f53\u524d\u72b6\u6001\u4e0b\u7684\u5176\u5b83\u503c\uff0c\u56e0\u4e3a\u6ca1\u6709\u51b3\u7b56\u4e5f\u5c31\u6ca1\u6709 max/min \u4e4b\u7c7b\u7684\u64cd\u4f5c\uff0c\u56e0\u6b64\u7ef4\u62a4\u6bd4\u8f83\u65b9\u4fbf\uff09\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n![\u8f6c\u79fb\u65b9\u7a0b](https://cdn.luogu.com.cn/upload/image_hosting/ohj7w8ew.png)\n\n\uff08from \u5b98\u65b9\u9898\u89e3\uff09\n\n\u89e3\u91ca\uff1a\u7b2c\u4e00\u4e2a\u65b9\u7a0b\u5c31\u662f\u5f53\u524d\u4f4d\u7f6e\u53d6 $0$ \u65f6\u7684\u671f\u671b\uff0c\u53ef\u4ee5\u7531\u4e0a\u4e00\u4f4d\u662f 0/1 \u8f6c\u79fb\u8fc7\u6765\uff0c\u6982\u7387\u662f $1-p_i$\u3002\n\n\u7b2c\u4e8c\u4e2a\u65b9\u7a0b\u662f\u5f53\u524d\u53d6 $1$ \u65f6\u7684\u3002\u663e\u7136\u4e5f\u662f\u7531 0/1 \u8f6c\u79fb\u8fc7\u6765\uff0c\u7531\u671f\u671b\u7684\u7ebf\u6027\u6027\u53ef\u4ee5\u76f8\u52a0\u3002$f(i-1,j,1)+g(i-1,j,1)a_i$ \u4ee3\u8868\u5f53\u524d\u8fd9\u4e2a\u72b6\u6001\u7684\u671f\u671b\uff08\u518d\u6b21\u8fd0\u7528\u4e86\u671f\u671b\u7684\u7ebf\u6027\u6027\uff09\uff0c\u56e0\u4e3a\u53d6 1 \u4e5f\u6709 $p_i$ \u7684\u6982\u7387\uff0c\u6240\u4ee5\u4e5f\u8981\u4e58\u4e00\u4e2a\u7cfb\u6570\uff0c\u52a0\u53f7\u540e\u9762\u7684\u4e5f\u540c\u7406\u3002\n\n\u6ce8\u610f\u7ef4\u62a4\u4e00\u4e0b $j=0$ \u7684\u65f6\u5019\u7684 $g$ \u5c31\u884c\u4e86\u3002\n\n```cpp\n// by SkyRainWind\n#include <bits/stdc++.h>\n#define mpr make_pair\n#define debug() cerr<<\"Yoshino\\n\"\n#define rep(i,a,b) for(int (i)=(a);(i)<=(b);(i)++)\n#define pii pair<int,int>\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef long long LL;\n\nconst int inf = 1e9, INF = 0x3f3f3f3f, mod = 998244353, maxn = 2e5+5;\n\nint n,k,a[maxn],p[maxn];\nint dp[maxn][22][2], g[maxn][22][2];\n\nll pw(ll x,int y){\n\tif(!y)return 1;\n\tif(y == 1)return x%mod;\n\tll mid=pw(x,y>>1);\n\tif(y&1)return 1ll*mid*mid%mod*x%mod;\n\treturn 1ll*mid*mid%mod;\n}\n\nsigned main(){\n//\tfreopen(\"Luogu7509.in\",\"r\",stdin);\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&p[i]);\n\t\n\tg[0][0][0] = 1;\n\tfor(int i=1;i<=n;i++){\n\t\tdp[i][0][0] = 0;\n\t\tg[i][0][0] = 1ll * (1-p[i]+mod) * g[i-1][0][0] % mod;\n\t\tfor(int j=1;j<=min(k, (i+1)/2);j++){\n\t\t\t(dp[i][j][0] += 1ll * (1-p[i]+mod) * (dp[i-1][j][1] + dp[i-1][j][0]) % mod) %= mod;\n\t\t\t(dp[i][j][1] += 1ll * p[i] * (dp[i-1][j-1][0] + 1ll * g[i-1][j-1][0] * a[i] % mod) % mod) %= mod;\n\t\t\t(dp[i][j][1] += 1ll * p[i] * (dp[i-1][j][1] + 1ll * g[i-1][j][1] * a[i] % mod) % mod) %= mod;\n\t\t\t(g[i][j][1] += 1ll * p[i] * (g[i-1][j][1]+g[i-1][j-1][0]) % mod) %= mod;\n\t\t\t(g[i][j][0] += 1ll * (1-p[i]+mod) * (g[i-1][j][1] + g[i-1][j][0]) % mod) %= mod;\n\t\t}\n\t}\n\tint bs = pw((g[n][k][1] + g[n][k][0])%mod, mod-2);\n\tcout<<(dp[n][k][1]+dp[n][k][0])%mod;\n\n\treturn 0;\n}\n```",
        "postTime": 1673681808,
        "uid": 84042,
        "name": "SkyRainWind",
        "ccfLevel": 7,
        "title": "Luogu7509 \u9898\u89e3"
    }
]