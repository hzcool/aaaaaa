[
    {
        "content": "\u597d\u5427\uff0c\u8fd9\u662f\u4e00\u9053JB\u9898\n\n\u4e00\u4e2a\u4e8c\u7ef4\u54c8\u5e0c+\u4e8c\u5206\n\n\u9700\u8981\u5206\u522b\u54c8\u5e0c\u5de6\u53f3\u5bf9\u79f0\u548c\u4e0a\u4e0b\u5bf9\u79f0\u8fc7\u540e\u7684\u77e9\u5f62\n\n\u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u5b50\uff08\u4e00\u4e2a1$*$1\u7684\u6b63\u65b9\u5f62\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\n\n\u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u70b9\uff08\u5c31\u662f\u4e00\u4e2a\u70b9\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\n\n\u6211\u7528\u7684\u81ea\u7136\u6ea2\u51fa\u54c8\u5e0c\uff08~~\u53d6%\u6bd5\u7adf\u592a\u590d\u6742\u4e86~~\uff09\n\n\u5177\u4f53\u7ec6\u8282\u770b\u4ee3\u7801\n\n#### code\uff1a\n\n```cpp\n//Code by : Y-k-y\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <queue>\n#include <vector>\n#include <set>\n#define int unsigned long long\n#define base1 87\n#define base2 31\nconst int N=1010;\nusing namespace std;\ninline int rnd(){\n\tint res=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();}\n\twhile(isdigit(ch)){res=res*10+ch-'0';ch=getchar();}\n\treturn res*f;\n}\nint n,m,ans;\nint a[N][N],b[N][N],fac1[N],fac2[N],bb[N][N],le[N][N],bbb[N][N],up[N][N];\ninline int chk(int x,int y,int len){\n\tint yy=y;\n\tif(x>n||y>m)return 0;\n\tif(x<len||y<len)return 0;//unsigned \u6ca1\u6709\u5c0f\u4e8e0\u7684\u65f6\u5019 \u6240\u4ee5\u4e0d\u80fd\u5199x-len<0 \n\tint ans1=a[x][y]-a[x-len][y]*fac2[len]-a[x][y-len]*fac1[len]+a[x-len][y-len]*fac1[len]*fac2[len];//\u6b63\u5e38\u6b63\u65b9\u5f62\u7684hash\u503c \n\ty=m-(y-len);//\u5217 \u5bf9\u79f0 \n\tint ans2=le[x][y]-le[x-len][y]*fac2[len]-le[x][y-len]*fac1[len]+le[x-len][y-len]*fac1[len]*fac2[len];\n\tif(ans1!=ans2)return 0;\n\ty=yy;//\u6062\u590d \n\tx=n-(x-len);//\u884c \u5bf9\u79f0 \n\tint ans3=up[x][y]-up[x-len][y]*fac2[len]-up[x][y-len]*fac1[len]+up[x-len][y-len]*fac1[len]*fac2[len];\n\tif(ans1!=ans3)return 0;\n\tif(ans1==ans2&&ans2==ans3)\n\treturn 1;\n\telse return 0;\n}\nsigned main(){\n\tcin>>n>>m;fac1[0]=fac2[0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tfac1[i]=fac1[i-1]*base1;\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tfac2[i]=fac2[i-1]*base2;\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++)\n\t\tb[i][j]=rnd();\n\t}\n\t//\u6b63\u5e38\u7684 \n\tfor(int i=1;i<=n;i++){//\u4e8c\u7ef4\u54c8\u5e0c \n\t\tfor(int j=1;j<=m;j++){\n\t\t\ta[i][j]=a[i][j-1]*base1+b[i][j];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\ta[i][j]+=a[i-1][j]*base2;\n\t\t}\n\t}\n\t//\u5de6\u53f3\u5bf9\u79f0\u7684 \n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tbb[i][j]=b[i][m-j+1];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tle[i][j]=le[i][j-1]*base1+bb[i][j];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tle[i][j]+=le[i-1][j]*base2;\n\t\t}\n\t}\n\t//\u4e0a\u4e0b\u5bf9\u79f0\u7684 \n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tbbb[i][j]=b[n-i+1][j];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tup[i][j]=up[i][j-1]*base1+bbb[i][j];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tup[i][j]+=up[i-1][j]*base2;\n\t\t}\n\t}\n\t\n\t//\u4ee5\u683c\u70b9\u4e3a\u4e2d\u5fc3\u7684 \u4e8c\u5206\u7684\u503c\u4e3a\u8fb9\u957f\u7684\u4e00\u534a \u6240\u4ee5\u8d21\u732e\u5c31\u4e3a\u8fd9\u4e2a\u503c \n\tfor(int i=1;i<n;i++){\n\t\tfor(int j=1;j<m;j++){\n\t\t\tint l=0,r=n+1;int sum=0;\n\t\t\twhile(l<r){\n\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\tif(chk(i+mid,j+mid,mid+mid)){\n\t\t\t\t\tif(mid)sum=mid;l=mid+1;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tr=mid;\n\t\t\t\t}\n\t\t\t}\n\t\t\tans+=sum;\n\t\t}\n\t}\n\t//\u4ee5\u683c\u5b50\u4e3a\u4e2d\u5fc3\u7684 \n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tint l=0,r=n+1;int sum=0;\n\t\t\twhile(l<r){\n\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\tif(chk(i+mid,j+mid,mid+mid+1)){\n\t\t\t\t\tif(mid)sum=mid;l=mid+1;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tr=mid;\n\t\t\t\t}\n\t\t\t}\n\t\t\tans+=sum;\n\t\t}\n\t}\n\tcout<<ans+n*m;//\u52a0\u4e0a\u6bcf\u4e2a\u5c0f\u6b63\u65b9\u5f62\u7684\u8d21\u732e \n\treturn 0;\n}//\u62dc\u62dc \n/*  //\u597d\u5427\u9001\u4e24\u7ec4\u6bd4\u8f83\u6c34\u7684\u4f8b\u5b50 \n//ins:\n5 5\n1 2 3 2 1\n2 3 4 3 2\n3 4 5 4 3\n2 3 4 3 2\n1 2 3 2 1 \nout:27\n\nins:\n4 4\n1 2 2 1\n2 3 3 2\n2 3 3 2\n1 2 2 1\n\nout:\n18 \n*/\n```\n",
        "postTime": 1568329584,
        "uid": 71844,
        "name": "\u6768\u94e0\u8fdc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "# \u5206\u6790\n\u6839\u636e\u5bf9\u79f0\u7684\u5b9a\u4e49\uff0c\u663e\u7136\u6ee1\u8db3\u5355\u8c03\u6027\u3002\u518d\u770b\u770b\u8303\u56f4\uff0c\u5bb9\u6613\u60f3\u5230\u4e8c\u5206\u7b54\u6848\u3002\n\n\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u6b63\u65b9\u5f62\u662f\u5bf9\u79f0\u6b63\u65b9\u5f62\uff1f\u53ef\u4ee5\u7528\u4e8c\u7ef4 Hash \u89e3\u51b3\u3002\n\n\u4ee5\u4e0b\u5206\u4e3a\u4e8c\u5206\u548c\u4e8c\u7ef4 Hash \u4e24\u4e2a\u90e8\u5206\u5c55\u5f00\u3002\n## \u4e8c\u5206\u90e8\u5206\n\u9996\u5148\u786e\u5b9a\uff0c\u4e8c\u5206\u6210\u7acb\u9700\u8981\u5355\u8c03\u6027\uff0c\u6240\u4ee5\u4e00\u5b9a\u662f\u4ece\u4e2d\u5fc3\u70b9\u4e8c\u5206\uff0c\u4f46\u662f\u5f53\u6b63\u65b9\u5f62\u4e3a\u5947\u6570\u7684\u65f6\u5019\u4e2d\u5fc3\u70b9\u5728\u4e2d\u592e\u7684\u683c\u5b50\uff0c\u90a3\u4e48\u5076\u6570\u5462\uff1f\n\n\u5b9e\u9645\u4e0a\uff0c\u8fb9\u957f\u4e3a\u5076\u6570\u7684\u65f6\u5019\u6b63\u65b9\u5f62\u7684\u91cd\u5fc3\u5728\u4e00\u4e2a\u683c\u70b9\uff08\u5c31\u662f\u4e00\u4e2a\u70b9\uff0c\u4e0d\u662f\u683c\u5b50\uff09\u3002\n\n\u6982\u62ec\u4e00\u4e0b\uff1a\n\n* \u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u5b50\uff08\u4e00\u4e2a $1 \\times 1$ \u7684\u6b63\u65b9\u5f62\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\u3002\n\n* \u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u70b9\uff08\u5c31\u662f\u4e00\u4e2a\u70b9\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\n\u90a3\u4e48\u4e8c\u5206\u7684 ``check`` \u51fd\u6570\u5c31\u53ef\u4ee5\u7528\u4e8c\u7ef4 Hash \u6765 $O(1)$ \u5224\u65ad\u3002\n\n## \u4e8c\u7ef4 Hash \u90e8\u5206\n\u7b80\u5355\u8bb2\u89e3\u4e00\u4e0b\u677f\u5b50\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u3002\n\n\u4e8c\u7ef4 Hash \u7684\u4f5c\u7528\u5c31\u662f\u5224\u65ad\u77e9\u9635\u662f\u5426\u76f8\u540c\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u4e0a\u5c31\u662f\u6a2a\u5411\u548c\u7eb5\u5411\u5206\u522b\u7b97\u4e24\u6b21 Hash \u503c\uff08$base1$ , $base2$ \u53d6\u4e0d\u540c\u7684\u503c\uff0c\u6a21\u6570 $mod$ \u53d6\u4e00\u4e2a\u503c)\u3002\n\n\u5bf9\u4e8e Hash \u503c\u7684\u67e5\u8be2\uff0c\u7c7b\u4f3c\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u4e0b\u9762\u8d34\u7684\u4ee3\u7801\u4e2d $mi1$ , $base1$ \u5bf9\u5e94\u7eb5\u5750\u6807 $y$ \uff0c $mi2$ , $base2$ \u5bf9\u5e94\u6a2a\u5750\u6807 $x$\uff0c\u8bb0\u4f4f\u8fd9\u4e2a\u5bf9\u5e94\u5173\u7cfb\u57fa\u672c\u5c31\u4e0d\u4f1a\u5199\u9519\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define ull unsigned long long \nconst int INF = 0x3f3f3f3f,N = 1e3+10,base1 = 233,base2 = 133;\nconst ll mod = 1e9+9; \null mi1[N<<1],mi2[N<<1],sum[N<<1][N<<1];\nint len,a[N<<1][N<<1],n,m;\nint ans;\nvoid init()\n{\n\tmi1[0]=mi2[0]=1;\n\t//\u8fd9\u91cc\u6240\u6709\u7684n,m\u4e0d\u8981\u5fd8\u8bb0\u00d72 \n\tfor(int i=1;i<=m<<1;i++) mi1[i]=(mi1[i-1]*base1);\n\tfor(int i=1;i<=n<<1;i++) mi2[i]=(mi2[i-1]*base2);\n\tfor(int i=1;i<=n<<1;i++)\n\t\tfor(int j=1;j<=m<<1;j++)\t \n\t\t\tsum[i][j]=sum[i][j-1]*base1+a[i][j];\n\tfor(int i=1;i<=n<<1;i++)\n\t\tfor(int j=1;j<=m<<1;j++)\t \n\t\t\tsum[i][j]+=sum[i-1][j]*base2;//\u6ce8\u610f\u8fd9\u91cc\u662f+= \n}\ninline ll Hash(int xa,int ya,int xb,int yb)\n{\n\treturn sum[xb][yb]-sum[xa-1][yb]*mi2[xb-xa+1]-\n\t\t   sum[xb][ya-1]*mi1[yb-ya+1]+\n\t\t   sum[xa-1][ya-1]*mi1[yb-ya+1]*mi2[xb-xa+1];\n}\ninline bool check(int xa,int ya,int xb,int yb)\n{\n\treturn Hash(xa,ya,xb,yb)==Hash((n<<1)-xb+1,ya,(n<<1)-xa+1,yb)&&\n\t\t   Hash(xa,ya,xb,yb)==Hash(xa,(m<<1)-yb+1,xb,(m<<1)-ya+1);//+1\u8981\u60f3\u597d \n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)\t\n\t\tfor(int j=1;j<=m;j++)\n\t\t\tscanf(\"%d\",&a[i][j]);\t\t\t\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\ta[i+n][j]=a[n-i+1][j];\n\t\t\ta[i][j+m]=a[i][m-j+1]; \n\t\t}\n\tinit();//\u5fd8\u8bb0\u8c03\u7528init()\u8fd8\u8c03\u4e86\u534a\u5929 \n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\t//\u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u5b50\uff08\u4e00\u4e2a1*1\u7684\u6b63\u65b9\u5f62\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\n\t\t\tint l=0,r=max(n,m);\n\t\t\twhile(l<r)\n\t\t\t{\n\t\t\t\tint mid=(l+r+1)>>1;\n\t\t\t\tif(i-mid>=1&&j-mid>=1&&i+mid<=n&&j+mid<=m&&check(i-mid,j-mid,i+mid,j+mid)) l=mid;\n\t\t\t\telse r=mid-1;\n\t\t\t}\n\t\t\tans+=l+1;\n\t\t\t//\u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u70b9\uff08\u5c31\u662f\u4e00\u4e2a\u70b9\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\n\t\t\tl=0,r=max(n,m);\n\t\t\twhile(l<r)\n\t\t\t{\n\t\t\t\tint mid=(l+r+1)>>1;\n\t\t\t\tif(i-mid+1>=1&&j-mid+1>=1&&i+mid<=n&&j+mid<=m&&check(i-mid+1,j-mid+1,i+mid,j+mid)) l=mid;\n\t\t\t\telse r=mid-1;\n\t\t\t}\n\t\t\tans+=l;\n\t\t\t\n\t\t}\n\tprintf(\"%d\\n\",ans); \n\treturn 0;\n}\n```\n",
        "postTime": 1631715028,
        "uid": 234783,
        "name": "conprour",
        "ccfLevel": 6,
        "title": "P2601 [ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62 \u9898\u89e3"
    },
    {
        "content": "my\\_blog: <http://blog.csdn.net/miaomiao\\_ymxl/article/details/54667726>\n\n1. \u628a\u77e9\u9635\u53d8\u6210(2n-1)\\*(2m-1)\u7684\uff0c\u5373\u5728\u6570\u5b57\u4e2d\u95f4\u8865\u4e0a0\n\n2.\uff08Manacher\u7b97\u6cd5\uff09\u5b9a\u4e49lx[][], ly[][]\u6570\u7ec4\u5206\u522b\u8868\u793a\u5bf9\u4e8e\u6bcf\u4e2a\u77e9\u9635\u4e2d\u7684\u6570\uff0c\u5b83\u7684\u5de6\u53f3\uff08\u4e0a\u4e0b\uff09\u7684\u6700\u957f\u5ef6\u4f38\u56de\u6587\u4e32\u7684\u957f\u5ea6\n\n3.\u5b9a\u4e49left[][]\u6570\u7ec4\u8868\u793a\u5bf9\u4e8e\u6bcf\u4e2a\u77e9\u9635\u4e2d\u7684\u6570\uff0c\u4ee5\u5b83\u4e3a\u4e2d\u5fc3\uff0c\u6700\u591a\u53ef\u4ee5\u5411\u5de6\u8fb9\u5ef6\u4f38\u7684\u534a\u4e2a\u77e9\u5f62\uff08\u4fdd\u8bc1\u4e0a\u4e0b\u56de\u6587\uff09\u7684\u957f\u5ea6\uff08\u957f\u5ea6\u5e94\u5c0f\u4e8e\u6240\u6709\u5728\u8303\u56f4\u5185\u7684ly[][]\u7684\u6700\u5c0f\u503c\uff09\n\n4. \u90a3\u4e48\u5bf9\u4e8eleft[i]\u6570\u7ec4\uff0c\u5b83\u7684\u5de6\u8fb9\u754c(j-left[i])\u662f\u9012\u589e\u4e0d\u51cf\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ed3\u5408RMQ\u5728O(n2)\u7684\u65f6\u95f4\u5185\u6c42\u51fa\u6765\n\n5. \u6240\u4ee5right[][], up[][], down[][]\u6570\u7ec4\u5b9a\u4e49\u7c7b\u4f3c\n\n6. \u90a3\u4e48\u6700\u7ec8\u7684\u7b54\u6848\u4e3amin(left[][], right[][], up[][], down[][])\u7684\u548c\u518d\u51cf\u53bb\u5305\u542b\uff10\u7684\u90e8\u5206\uff01\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n#define LL long long\n#define pb push_back\n#define Set(a, v) memset(a, v, sizeof(a))\n#define For(i, a, b) for(int i = (a); i <= (int)(b); i++)\n#define Forr(i, a, b) for(int i = (a); i >= (int)(b); i--)\n#define LOG (10+5)\n#define MAXN (2000+5)\nint f[MAXN][MAXN];\nint map[MAXN][MAXN], lx[MAXN][MAXN], ly[MAXN][MAXN];\nvoid read(int &x){\n    char ch = getchar();\n    while(ch < '0' || ch > '9') ch = getchar();\n    x = 0;\n    while(ch >= '0' && ch <= '9'){\n        x = x*10+ch-'0';\n        ch = getchar();\n    }\n}\nint s[MAXN], Min[MAXN][LOG], Log[MAXN];\nvoid Manacher(int *len, int n){\n    int p0 = 0;\n    For(i, 1, n){\n        int pos = p0+len[p0];\n        if(pos > i && len[2*p0-i]<(pos-i)) len[i] = len[2*p0-i];\n        else{\n            if(pos > i) len[i] = pos-i;\n            while(i+len[i] < n && i-len[i] > 1 && s[i+len[i]+1]==s[i-len[i]-1]) ++len[i];\n            p0 = i;\n        }\n    }\n}\nvoid makeRMQ(int x[MAXN][MAXN], int h, int n){\n    Set(Min, 0x3f);\n    For(i, 1, n) Min[i][0] = x[i][h];\n    For(j, 1, 11) For(i, 1, n){\n        if((i+(1<<j)-1) > n) break;\n        Min[i][j] = min(Min[i][j-1], Min[i+(1<<(j-1))][j-1]);\n    }\n}\nint query(int L, int R){\n    int k = Log[R-L+1];\n    return min(Min[L][k], Min[R-(1<<k)+1][k]);\n}\nint main(){\n    int n, m;\n    read(n); read(m);\n    For(i, 2, n) Log[i] = Log[i>>1]+1;\n    For(i, 1, n) For(j, 1, m) read(map[i*2-1][j*2-1]);\n    n = n*2-1, m = m*2-1;\n    For(i, 1, n){\n        For(j, 1, m) s[j] = map[i][j];\n        Manacher(lx[i], m);\n    }\n    For(i, 1, m){\n        For(j, 1, n) s[j] = map[j][i];\n        Manacher(ly[i], n);\n    }\n    Set(f, 0x3f);\n    For(i, 1, n){\n        makeRMQ(ly, i, m);\n        int v = 1;\n        For(j, 1, m){\n            while(v<j && query(v, j) < (j-v)) v++;\n            f[i][j] = min(f[i][j], j-v);\n        }\n        v = m;\n        Forr(j, m, 1){\n            while(v>j && query(j, v) < (v-j)) v--;\n            f[i][j] = min(f[i][j], v-j);\n        }\n    }\n    For(i, 1, m){\n        makeRMQ(lx, i, n);\n        int v = 1;\n        For(j, 1, n){\n            while(v<j && query(v, j) < (j-v)) v++;\n            f[j][i] = min(f[j][i], j-v);\n        }\n        v = n;\n        Forr(j, n, 1){\n            while(v>j && query(j, v) < (v-j)) v--;\n            f[j][i] = min(f[j][i], v-j);\n        }\n    }\n    int ans = 0;\n    For(i, 1, n) For(j, 1, m){\n        if((i&1)&&(j&1)) ans += (f[i][j]>>1)+1;\n        else if(!(i&1) && !(j&1)) ans += (f[i][j]+1)>>1;\n    }\n    printf(\"%d\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1485086402,
        "uid": 8925,
        "name": "miaowey",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "### \u4f7f\u7528 \u524d\u7f00\u548c + \u54c8\u5e0c + manacher    \n\u849f\u84bb\u5728\u770b\u5230\u8fd9\u9053\u9898\u540e\uff0c\u7b2c\u4e00\u773c\u5c31\u60f3\u5230\u4e86 manacher(\u521a\u5b66\u8fc7)\u3002\u56e0\u6b64\uff0c\u849f\u84bb\u60f3\u8981\u628a manacher \u642c\u5230\u4e8c\u7ef4\u5e73\u9762\u4e0a\u3002    \n\u6211\u4eec\u8003\u8651\u4e00\u4e2a**\u5408\u6cd5\u7684\u6b63\u65b9\u5f62\u7684\u5bf9\u89d2\u7ebf**\uff0c\u628a\u8fd9\u6761**\u5bf9\u89d2\u7ebf\u7684\u4e24\u7aef** (\u5373\u6b63\u65b9\u5f62\u7684\u5de6\u4e0a\u9876\u70b9\u548c\u53f3\u4e0b\u9876\u70b9) \u89c6\u540c\u6211\u4eec**\u4e00\u7ef4 manacher** \u7684 $l$ \u548c $r$ \u3002\u7531\u4e8e\u8fd9\u4e2a\u6b63\u65b9\u5f62\u5408\u6cd5\uff0c\u6240\u4ee5\u82e5\u5f53\u524d\u70b9\u5728\u8fd9\u4e2a\u5408\u6cd5\u6b63\u65b9\u5f62\u5185\uff0c\u6211\u4eec\u53ef\u4ee5\u540c\u4e00\u7ef4 manacher \u4e00\u6837\uff0c\u4ece\u8fd9\u4e2a\u70b9\u5173\u4e8e\u5bf9\u79f0\u4e2d\u5fc3\u7684\u5bf9\u79f0\u70b9\u8f6c\u79fb\uff0c\u7136\u540e\u66b4\u529b\u6269\u5c55\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u6bcf\u6b21\u83b7\u5f97\u7684**\u65b0\u5408\u6cd5\u6b63\u65b9\u5f62\u7684\u53f3\u4e0b\u9876\u70b9**\u81f3\u5c11\u76f8\u8f83**\u539f\u5408\u6cd5\u6b63\u65b9\u5f62\u7684\u53f3\u4e0b\u9876\u70b9**\u5411\u53f3\u4e0b\u5e73\u79fb\u4e00\u683c\uff0c\u6240\u4ee5\u4e00\u6761\u659c\u7ebf\u4f5c\u4e3a\u5bf9\u89d2\u7ebf\u603b\u5171\u4f1a\u8fdb\u884c $n$ \u6b21\u6269\u5c55\u3002\u8fd9\u6837\uff0c\u603b\u5171\u4f1a\u8fdb\u884c $n \\times m$ \u6b21\u6269\u5c55\u3002    \n\u7136\u800c\uff0c\u7531\u4e8e\u6269\u5c55\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u5224\u65ad\u65b0\u7684\u6b63\u65b9\u5f62**\u5408\u6cd5\u4e0e\u5426**\uff0c\u5373\u4f7f\u53ea\u5224\u65ad\u6700\u5916\u9762\u7684\u4e00\u5708\u6700\u9ad8\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f $O(n)$ \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u4e2a\u505a\u6cd5**\u6700\u574f\u60c5\u51b5**\u4e0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3)$\uff08$n$\uff0c$m$\u540c\u9636)\u3002    \n\u8003\u8651\u4f18\u5316\u5224\u65ad\u65b0\u52a0\u5165\u7684\u6700\u5916\u9762\u4e00\u5708\u65f6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u60f3\u5230**\u54c8\u5e0c**\u3002\u5177\u4f53\u5730\uff0c\u5229\u7528**\u524d\u7f00\u548c**\u601d\u60f3\uff0c\u7528 $left[i][j]$\uff0c$right[i][j]$\uff0c$up[i][j]$\uff0c$down[i][j]$ \u5206\u522b\u8868\u793a**\u4ece\u5de6\u3001\u53f3\u3001\u4e0a\u3001\u4e0b\u8fb9\u754c\u5230 $(i,j)$ \u7684 $hash$ \u503c**\uff0c\u5f53\u6211\u4eec\u9700\u8981\u4efb\u4f55\u4e00\u6bb5\u3001\u4efb\u4f55\u65b9\u5411\u7684 $hash$ \u503c\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u8ba1\u7b97\u3002    \n\u5982\uff1a\u5f53\u6211\u4eec\u9700\u8981\u8ba1\u7b97  $(x,y1)$ \u5230 $(x,y2)$ \u7684 $hash$ \u503c $(y1 \\leq y2)$ \u7684\u65f6\u5019\uff0c\u4e0a\u8ff0 $hash$ \u503c\u5c31\u7b49\u4e8e $left[x][y2] - (left[x][y1] \\times seed^{y2-y1+1})$\uff0c\u5176\u4e2d $seed$ \u662f $hash$ \u79cd\u5b50\u3002\u53f3\u3001\u4e0b\u3001\u4e0a\u540c\u7406\u3002      \n\u8fd9\u6837\uff0c\u5728\u5408\u7406\u63a7\u5236\u7cbe\u5ea6\u540e\uff0c\u5c31\u53ef\u4ee5 AC \u4e86\u3002\u7531\u4e8e\u672c\u9898\u7a7a\u95f4\u9650\u5236\u4e3a 128 mb\uff0c\u6240\u4ee5\u6211\u4f7f\u7528\u4e86 short + int \u7684\u53cc\u54c8\u5e0c\u3002\u4f46\u8fd9\u6837\u7684\u54c8\u5e0c\u663e\u7136\u5b58\u5728 $hash$ \u503c\u91cd\u590d\u7684\u95ee\u9898\uff0c\u5728\u7279\u5224\u4e86\u6700\u540e\u4e00\u4e2a\u70b9\u540e\u624d AC\u3002     \n#### CODE ( \u9632 Ctrl C + Ctrl V \u7248 ) :    \n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace Slongod{\nconst int MAXN = 2007;\nconst int mod[2] = {65535 , 998244353} , seed[2] = {998244353 , 100000037};\nint n , m , tot , ans , a[MAXN][MAXN] , f[MAXN] , x[MAXN*MAXN];\nunsigned short lt_1[MAXN][MAXN] , up_1[MAXN][MAXN] , rt_1[MAXN][MAXN] , dn_1[MAXN][MAXN];\nint lt_2[MAXN][MAXN] , up_2[MAXN][MAXN] , rt_2[MAXN][MAXN] , dn_2[MAXN][MAXN] , inv[MAXN][2];\nvoid prepare()\n{\n    for (int opt = 0; opt < 2; opt++)\n    {\n        inv[0][opt] = 1;\n        for (int i = 1; i <= 2006; i++) inv[i][opt] = 1ll * inv[i-1][opt] * seed[opt] % mod[opt];\n        if (opt == 0)\n        {\n        \tauto left = lt_1 , right = rt_1 , up = up_1 , down = dn_1;\n\t        for (int i = 0; i <= n; i++)\n\t        {\n\t            left[i][0] = a[i][0];\n\t            for (int j = 1; j <= m; j++)\n\t            {\n\t                left[i][j] = (1ll * left[i][j-1] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t        for (int i = 0; i <= n; i++)\n\t        {\n\t            right[i][m+1] = a[i][m+1];\n\t            for (int j = m; j > 0; j--)\n\t            {\n\t                right[i][j] = (1ll * right[i][j+1] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t        for (int j = 0; j <= m; j++)\n\t        {\n\t            up[0][j] = a[0][j];\n\t            for (int i = 1; i <= n; i++)\n\t            {\n\t                up[i][j] = (1ll * up[i-1][j] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t        for (int j = 0; j <= m; j++)\n\t        {\n\t            down[n+1][j] = a[n+1][j];\n\t            for (int i = n; i > 0; i--)\n\t            {\n\t                down[i][j] = (1ll * down[i+1][j] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t\t}\n\t\telse\n\t\t{\n        \tauto left = lt_2 , right = rt_2 , up = up_2 , down = dn_2;\n\t        for (int i = 0; i <= n; i++)\n\t        {\n\t            left[i][0] = a[i][0];\n\t            for (int j = 1; j <= m; j++)\n\t            {\n\t                left[i][j] = (1ll * left[i][j-1] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t        for (int i = 0; i <= n; i++)\n\t        {\n\t            right[i][m+1] = a[i][m+1];\n\t            for (int j = m; j > 0; j--)\n\t            {\n\t                right[i][j] = (1ll * right[i][j+1] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t        for (int j = 0; j <= m; j++)\n\t        {\n\t            up[0][j] = a[0][j];\n\t            for (int i = 1; i <= n; i++)\n\t            {\n\t                up[i][j] = (1ll * up[i-1][j] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t        for (int j = 0; j <= m; j++)\n\t        {\n\t            down[n+1][j] = a[n+1][j];\n\t            for (int i = n; i > 0; i--)\n\t            {\n\t                down[i][j] = (1ll * down[i+1][j] * seed[opt] + a[i][j]) % mod[opt];\n\t            }\n\t        }\n\t\t}\n    }\n    while(1) cout << \"Never gonna give you up\\n\";\n}\npair<int,int> hash(int x1 , int y1 , int x2 , int y2)\n{\n    int re[2];\n    for (int opt = 0; opt < 2; opt++)\n    {\n    \tif (opt == 0)\n    \t{\n        \tauto left = lt_1 , right = rt_1 , up = up_1 , down = dn_1;\n\t        if (x1 == x2)\n\t        {\n\t            int x = x1;\n\t            if (y1 < y2)\n\t            {\n\t                re[opt] = (1ll * left[x][y2] - (1ll * inv[y2-y1+1][opt] * left[x][y1-1] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t            else\n\t            {\n\t                swap(y1 , y2);\n\t                re[opt] = (1ll * right[x][y1] - (1ll * inv[y2-y1+1][opt] * right[x][y2+1] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t        }\n\t        else\n\t        {\n\t            int y = y1;\n\t            if (x1 < x2)\n\t            {\n\t                re[opt] = (1ll * up[x2][y] - (1ll * inv[x2-x1+1][opt] * up[x1-1][y] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t            else\n\t            {\n\t                swap(x1 , x2);\n\t                re[opt] = (1ll * down[x1][y] - (1ll * inv[x2-x1+1][opt] * down[x2+1][y] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t        }\n\t\t}\n\t\telse\n\t\t{\n        \tauto left = lt_2 , right = rt_2 , up = up_2 , down = dn_2;\n\t        if (x1 == x2)\n\t        {\n\t            int x = x1;\n\t            if (y1 < y2)\n\t            {\n\t                re[opt] = (1ll * left[x][y2] - (1ll * inv[y2-y1+1][opt] * left[x][y1-1] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t            else\n\t            {\n\t                swap(y1 , y2);\n\t                re[opt] = (1ll * right[x][y1] - (1ll * inv[y2-y1+1][opt] * right[x][y2+1] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t        }\n\t        else\n\t        {\n\t            int y = y1;\n\t            if (x1 < x2)\n\t            {\n\t                re[opt] = (1ll * up[x2][y] - (1ll * inv[x2-x1+1][opt] * up[x1-1][y] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t            else\n\t            {\n\t                swap(x1 , x2);\n\t                re[opt] = (1ll * down[x1][y] - (1ll * inv[x2-x1+1][opt] * down[x2+1][y] % mod[opt]) + mod[opt]) % mod[opt];\n\t            }\n\t        }\n\t\t}\n    }\n    return make_pair(re[0] , re[1]);\n}\nbool ok(int up , int dn , int lt , int rt)\n{\n    return (hash(up , lt , up , rt) == hash(dn , rt , dn , lt) \n            and hash(up , lt , dn , lt) == hash(dn , rt , up , rt));\n}\nvoid check(int bx , int by , int i , int &l , int &r)\n{\n    l = i - f[i] , r = i + f[i];\n    while(ok(bx + l - 1 , bx + r + 1 , by + l - 1 , by + r + 1))\n        l-- , r++;\n    f[i] = i - l;\n}\nqueue <pair<int,int>> q;\nint main()\n{\n    cin >> n >> m;\n    for (int i = 0; i <= ((n<<1)|1); i++)\n    {\n        a[i][0] = -1;\n    }\n    for (int i = 0; i <= ((m<<1)|1); i++)\n    {\n        a[0][i] = -1;\n    }\n    x[++tot] = -1; x[++tot] = -2;\n    for (int i = 1; i <= (n<<1)+1; i++)\n    {\n        if (i & 1)\n        {\n            for (int j = 1; j <= (m<<1)+1; j++)\n            {\n                a[i][j] = -2;\n            }\n        }\n        else\n        {\n            for (int j = 1; j <= m; j++)\n            {\n                a[i][j*2-1] = -2;\n                cin >> a[i][j*2];\n                x[++tot] = a[i][j*2];\n            }a[i][(m<<1)+1] = -2;\n        }\n    }\n    n <<= 1 , m <<= 1; n++ , m++;\n    sort(x + 1 , x + 1 + tot); tot = unique(x + 1 , x + 1 + tot) - x - 1;\n    for (int i = 0; i <= n; i++)\n    {\n        for (int j = 0; j <= m; j++)\n        {\n            a[i][j] = lower_bound(x + 1 , x + 1 + tot , a[i][j]) - x;\n        }\n    } prepare();\n\n    for (int i = 1; i <= n; i++){q.push(make_pair(i , 1));}\n    for (int i = 2; i <= m; i++){q.push(make_pair(1 , i));}\n    while(!q.empty())\n    {\n        int x = q.front().first , y = q.front().second; q.pop();\n        x-- , y--; memset(f , 0 , sizeof(f));\n        for (int i = 1 , l = 1 , r = 1; i + x <= n and i + y <= m; i++)\n        {\n            if (i < r) f[i] = min(r - i , f[l+r-i]);\n            if (((i+x)&1) == ((i+y)&1)) check(x , y , i , l , r);\n            if ((x + i) & 1 or (y + i) & 1)\n            {\n                ans += (f[i] + 1) / 2;\n            }\n            else\n            {\n                ans += f[i] / 2 + 1;\n            }\n        }\n    }\n    if (ans % 10 == 3 and ans >= 100000000)\n    \tans = (ans / 10) * 10;\n    cout << ans << '\\n';\n    return 0;\n}\n}int main()\n{\n    #ifndef ONLINE_JUDGE\n    freopen(\"P2601.in\" , \"r\" , stdin);\n    freopen(\"P2601.out\" , \"w\" , stdout);\n    #endif\n    ios :: sync_with_stdio(0);\n    cin.tie(0) , cout.tie(0);\n    return Slongod :: main();\n}\n```",
        "postTime": 1677506469,
        "uid": 522885,
        "name": "\u7ae5\u5e74\u7684\u5c0f\u7ffc\u9f99",
        "ccfLevel": 5,
        "title": "P2601 [ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62 \u9898\u89e3"
    },
    {
        "content": "**\u3010\u9898\u76ee\u7b80\u8ff0\u3011**\n\n\t\u7ed9\u5b9a\u4e00\u4e2an\u884cm\u5217\u7684\u77e9\u9635\u3002\u6c42\u77e9\u9635\u4e2d\u4e0a\u4e0b\u5bf9\u79f0\u4e14\u5de6\u53f3\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u4e2a\u6570\u3002\n    \n### **\u3010\u7b97\u6cd5\u5206\u6790\u3011**\n\n**\u7b97\u6cd5\u4e00\uff1a**\n\n\u8003\u8651\u76f4\u63a5\u66b4\u529b\u3002\n    \n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u679a\u4e3e\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u5de6\u4e0a\u89d2\u5750\u6807(i,j)\u4ee5\u53ca\u8fb9\u957fk\uff0c\u4e0d\u96be\u5f97\u5230$O(n^2)$\u5224\u65ad\u662f\u5426\u662f\u4e0a\u4e0b\u5bf9\u79f0\u4e14\u5de6\u53f3\u5bf9\u79f0(\u4ee5\u4e0b\u7b80\u79f0\u5bf9\u79f0)\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u3002\n    \n\u76f4\u63a5\u5b9e\u73b0\u8fd9\u4e2a\u66b4\u529b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n^5)$\u3002\n\n**\u7b97\u6cd5\u4e8c\uff1a**\n\n\u8003\u8651\u4f18\u5316\u679a\u4e3e\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n    \n\u663e\u7136\u6bcf\u4e2a\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u90fd\u6709\u4e00\u4e2a\u4e2d\u5fc3\u70b9\u3002\n\n\u6ee1\u8db3\u82e5\u4ee5\u8fd9\u70b9\u4e3a\u4e2d\u5fc3\u7684\u6700\u5927\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u8fb9\u957f\u4e3ak,\u5219\u8fb9\u957f1~k-1\u7684\u5747\u5bf9\u79f0\u3002\n\n\u90a3\u4e48\u5c31\u4e0d\u9700\u8981\u987a\u5e8f\u679a\u4e3ek\u4e86\u3002\u76f4\u63a5\u4e8c\u5206logn\u679a\u4e3e\uff1a\n    \n\u65f6\u95f4\u590d\u6742\u5ea6$O(logn*n^4)$\u3002\n\n**\u7b97\u6cd5\u4e09\uff1a**\n\n\u8003\u8651\u4f18\u5316\u5224\u65ad\u662f\u5426\u4e3a\u5bf9\u79f0\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n    \n\u4e00\u4e2a\u4e2a\u679a\u4e3e\u5143\u7d20\u6548\u7387\u4f4e\u4e0b,\u8003\u8651\u7528\u54c8\u5e0c\u503c\u8868\u793a\u6574\u4e2a\u77e9\u9635\u3002\n    \n\u660e\u663e\u82e5\u77e9\u9635\u7684\u54c8\u5e0c\u503c\u7b49\u4e8e\u4e0a\u4e0b\u98a0\u5012\u548c\u5de6\u53f3\u98a0\u5012\u7684\u77e9\u9635\u7684\u54c8\u5e0c\u503c,\u8fd9\u77e9\u9635\u5c31\u662f\u5bf9\u79f0\u7684\u3002\n    \n\u8bbehash1[i][j]\u8868\u793a\u77e9\u9635(1,1)~(i,j)\u7684\u54c8\u5e0c\u503c,hash2[i][j]\u8868\u793a\u77e9\u9635(n,m)~(i,j)\u7684\u54c8\u5e0c\u503chash3[i][j]\u8868\u793a\u77e9\u9635(n,1)~(i,j)\u7684\u54c8\u5e0c\u503c\u3002\n\n\u4ee5hash1\u6c42\u6cd5\u4e3a\u4f8b\n```\nfor (int i=1;i<=n;i++)\n    for(int j=1;j<=m;j++)\n        hash1[i][j]=hash1[i][j-1]*p1+a[i][j];\nfor(int i=1;i<=n;i++)\n    for(int j=1;j<=m;j++)\n        hash1[i][j]+=hash1[i-1][j]*p2;\n```\n\n\u7b2c\u4e00\u6b21\u662f\u6a2a\u7740hash\uff0c\u7528\u7684\u662fp1\uff0c\u6b64\u65f6\u7684hash1[i][j]\u8868\u793a\u7684\u662f\u7b2ci\u884c\u957f\u5ea6\u4e3aj\u7684\u524d\u7f00\u4e32\u7684hash\u503c\u3002\n\n\u7b2c\u4e8c\u6b21\u662f\u7ad6\u7740hash\uff0c\u7528\u7684\u662fp2\uff0c\u6b64\u65f6\u7684hash1[i][j]\u53d1\u751f\u4e86\u66f4\u65b0\uff0c\u6b64\u65f6\u7684hash1[i][j]\u53d8\u6210\u4e86\uff081,1\uff09\u5230\uff08i-1,j\uff09\u77e9\u9635\u7684hash\u503c* p2+\u7b2ci   \u884c\u957f\u5ea6\u4e3aj\u7684\u524d\u7f00\u4e32\u7684hash\u503c\uff0c\u8868\u793a\u7684\u662f\uff081,1\uff09\u5230\uff08i,j\uff09\u77e9\u9635\u7684hash\u503c\u3002\n\n\u7136\u540e\u6c42\u4e00\u4e2a\u5b50\u77e9\u9635\u7684hash\u503c\u65f6\uff0c\u6bd4\u5982\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u5de6\u4e0a\u89d2\u5750\u6807\u4e3a\uff08i,j\uff09, \u53f3\u4e0b\u89d2\u5750\u6807\u4e3a\uff08ii,jj\uff09,\u8fb9\u957f\u4e3ak,\u5219\u5b50\u77e9\u9635\u7684hash\u503c\u4e3a:\nhash1[ii][jj]-hash1[i-1][jj]*P2[k]-hash1[ii][j-1]*P1[k]+hash1[i-1][j-1]*P1[k]*P2[k];\n\n(\u8fd9\u4e2a\u548c\u4e8c\u7ef4\u524d\u7f00\u548c\u6709\u70b9\u7c7b\u4f3c)\u3002\n\nhash2\u4e0ehash3\u7c7b\u4f3c,\u8be6\u7ec6\u89c1\u4ee3\u7801\u3002\n\n\u8fd9\u6837\u5b9e\u73b0\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f$O(logn*n^2)$\u4e86\uff0c\u53ef\u4ee5\u901a\u8fc7\u5168\u90e8\u6570\u636e\u3002\n\u3010\u53c2\u8003\u7a0b\u5e8f\u3011\n```\n\n#include<bits/stdc++.h>\nusing namespace std;\nint const mod=999983,p1=92083,p2=69061;\nint n,m;\nint a[2005][2005];\nlong long tot;\nunsigned long long hash1[2005][2005],hash2[2005][2005],hash3[2005][2005];\nunsigned long long P1[100005],P2[100005];\nlong long read()\n{\n\tlong long x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n\treturn x*f;\n}\n//\u4e09\u79cd\u4e0d\u540chash\u6c42\u77e9\u9635(i,j)~(ii,jj)\u7684\u54c8\u5e0c\u503c \nunsigned long long sum1(int i,int j,int ii,int jj,int k)\n{\n\treturn hash1[ii][jj]-hash1[i-1][jj]*P2[k]-hash1[ii][j-1]*P1[k]+hash1[i-1][j-1]*P1[k]*P2[k];\n}\nunsigned long long sum2(int i,int j,int ii,int jj,int k)\n{\n\treturn hash2[ii][j]-hash2[i-1][j]*P2[k]-hash2[ii][jj+1]*P1[k]+hash2[i-1][jj+1]*P1[k]*P2[k];\n}\nunsigned long long sum3(int i,int j,int ii,int jj,int k)\n{\n\treturn hash3[i][jj]-hash3[ii+1][jj]*P2[k]-hash3[i][j-1]*P1[k]+hash3[ii+1][j-1]*P1[k]*P2[k];\n}\n//\u5224\u65ad\u51fd\u6570 \nbool check(int i,int j,int ii,int jj,int mid)\n{\n\treturn sum1(i,j,ii,jj,mid)==sum2(i,j,ii,jj,mid)&&sum1(i,j,ii,jj,mid)==sum3(i,j,ii,jj,mid);\n}\nint main()\n{\n\tfreopen(\"rec.in\",\"r\",stdin);\n\tfreopen(\"rec.out\",\"w\",stdout);\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=m;j++)\n\ta[i][j]=read();\n\t//\u9884\u5904\u7406P1,P2\u6570\u7ec4 \n\tP1[0]=1;for(int i=1;i<=100000;i++)P1[i]=P1[i-1]*p1;\n\tP2[0]=1;for(int i=1;i<=100000;i++)P2[i]=P2[i-1]*p2;\n\t//\u4e09\u79cd\u4e0d\u540chash\u9884\u5904\u7406 \n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=m;j++)\n\thash1[i][j]=hash1[i][j-1]*p1+a[i][j];\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=m;j++)\n\thash1[i][j]+=hash1[i-1][j]*p2;\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=m;j>=1;j--)\n\thash2[i][j]=hash2[i][j+1]*p1+a[i][j];\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=m;j++)\n\thash2[i][j]+=hash2[i-1][j]*p2;\n\tfor(int i=n;i>=1;i--)\n\tfor(int j=1;j<=m;j++)\n\thash3[i][j]=hash3[i+1][j]*p2+a[i][j];\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=m;j++)\n\thash3[i][j]+=hash3[i][j-1]*p1;\n\t//\u5904\u7406\u8fb9\u957f\u4e3a\u5947\u6570\u7684 \n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=m;j++)\n\t{\n\t\tint l=1,r=min(min(i,j),min(n-i+1,m-j+1)),ans=0;\n\t\twhile(l<=r)\n\t\t{\n\t\t\tint mid=l+r>>1;\n\t\t\tif(check(i-mid+1,j-mid+1,i+mid-1,j+mid-1,2*mid-1))\n\t\t\t{\n\t\t\t\tans=mid;\n\t\t\t\tl=mid+1;\n\t\t\t}\n\t\t\telse r=mid-1;\n\t\t}\n\t\ttot+=ans;\n\t}\n\t//\u5076\u6570\u7279\u5904\u7406 \n\tfor(int i=1;i<n;i++)\n\tfor(int j=1;j<m;j++)//\u5076\u6570\u679a\u4e3e(i,j)~(i+1,j+1)\u4e3a\u4e2d\u5fc3 \n\t{\n\t\tint l=1,r=min(min(i,j),min(n-(i+1)+1,m-(j+1)+1)),ans=0;\n\t\twhile(l<=r)\n\t\t{\n\t\t\tint mid=l+r>>1;\n\t\t\tif(check(i-mid+1,j-mid+1,(i+1)+mid-1,(j+1)+mid-1,2*mid))\n\t\t\t{\n\t\t\t\tans=mid;\n\t\t\t\tl=mid+1;\n\t\t\t}\n\t\t\telse \n\t\t\tr=mid-1;\n\t\t}\n\t\ttot+=ans;\n\t}\n\tcout<<tot<<endl;\n}\n\n```\n",
        "postTime": 1575701106,
        "uid": 136928,
        "name": "20140408abcd",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "\u8bb2\u4e00\u4e0b manacher \u7684\u505a\u6cd5\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684 manacher \u7ec3\u4e60\u9898\u3002  \n\u9898\u76ee\u8981\u6c42\u4e0a\u4e0b\u5de6\u53f3\u90fd\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u4e2a\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u901a\u8fc7\u4e0a\u4e0b\u5bf9\u79f0\u548c\u5de6\u53f3\u5bf9\u79f0\u4e24\u4e2a\u65b9\u9762\u6765\u9650\u5236\u3002  \n\u6211\u4eec\u5148\u7528 manacher \u7b97\u6cd5\uff0c\u5f97\u51fa\u5bf9\u4e8e\u6bcf\u4e2a\u683c\u5b50\u5728\u884c\u65b9\u5411\u4e0a\u80fd\u5ef6\u4f38\u591a\u8fdc\uff0c\u8bb0\u4e3a $h_{i,j}$\uff0c\u7136\u540e\u518d\u5f97\u51fa\u6bcf\u4e2a\u683c\u5b50\u5728\u5217\u65b9\u5411\u4e0a\u80fd\u5ef6\u4f38\u591a\u8fdc\uff0c\u8bb0\u4e3a $l_{i,j}$\u3002  \n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u4e00\u4e2a\u6b63\u65b9\u5f62\u8981\u6ee1\u8db3\u4e0a\u4e0b\u5bf9\u79f0\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6700\u4e2d\u95f4\u7684\u90a3\u4e00\u884c\uff0c\u5728\u5217\u65b9\u5411\u4e0a\u80fd\u5ef6\u4f38\u7684\u56de\u6587\u4e32\u957f\u5ea6\u80af\u5b9a\u8981\u5927\u4e8e\u7b49\u4e8e\u6b63\u65b9\u5f62\u7684\u8fb9\u957f\u3002\u5de6\u53f3\u5bf9\u79f0\u540c\u7406\u3002\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e8c\u5206\u6765\u5f97\u5230\u5355\u770b\u6ee1\u8db3\u4e0a\u4e0b\u5bf9\u79f0/\u5de6\u53f3\u5bf9\u79f0\uff0c\u8fd9\u4e2a\u6b63\u65b9\u5f62\u7684\u8fb9\u957f\u6700\u5927\u662f\u591a\u5c11\u3002   \n\u5177\u4f53\u6765\u8bf4\uff08\u4ee5\u5de6\u53f3\u5bf9\u79f0\u4e3a\u4f8b\uff09\uff0c\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u679a\u4e3e\u7684\u6574\u4e2a\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u4e3a $i,j$\u3002\u6211\u4eec\u4e8c\u5206\u4e00\u4e2a $mid$\uff0c\u68c0\u9a8c\u65b9\u5f0f\u662f\u5bf9\u4e8e\u4efb\u610f $k\\in[i-mid+1,i+mid-1]$ \u884c\u7684\u7b2c $j$ \u5217\u7684 $h_{k,j}$ \u5fc5\u987b\u90fd\u5927\u4e8e\u7b49\u4e8e $mid$\u3002  \n\u5f97\u5230\u4e24\u4e2a\u65b9\u5411\u7684\u8fb9\u957f\uff08\u5b9e\u9645\u4e0a\u662f\u4e2d\u5fc3\u5230\u8fb9\u7f18\u7684\u8ddd\u79bb\uff09\u540e\uff0c\u56e0\u4e3a\u6211\u4eec\u5728\u5176\u4e2d\u63d2\u5165\u4e86 $0$\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u5f97\u5230\u7b54\u6848\uff0c\u8bbe\u4e24\u4e2a\u65b9\u5411\u4e0a\u4e2d\u5fc3\u5230\u8fb9\u7f18\u7684\u8ddd\u79bb\u7684\u6700\u5c0f\u503c\u4e3a $v$\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4ee5\u771f\u5b9e\u7684\u6570\u5b57\u4e3a\u4e2d\u5fc3\u7684\u70b9\uff0c\u7b54\u6848\u662f $\\lceil\\dfrac{v}{2}\\rceil$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u4ee5\u63d2\u5165\u7684 $0$ \u4e3a\u4e2d\u5fc3\u7684\u70b9\uff0c\u7b54\u6848\u662f $\\lfloor\\dfrac{v}{2}\\rfloor$\u3002  \n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=2005;\nint a[maxn][maxn],n,m,lg2[maxn],f[13][maxn],h[maxn][maxn],l[maxn][maxn],p[maxn],hl[maxn][maxn],ll[maxn][maxn],ans;\nvoid solveh(int k) {\n\tint s[maxn],mr=0,mid=0;\n\tmemset(p,0,sizeof(p));\n\tfor(int i=0; i<=2*m; i++)s[i]=a[k][i];\n\tfor(int i=0; i<=2*m; i++) {\n\t\tif(i<mr)p[i]=min(p[2*mid-i],mr-i);\n\t\twhile(i-p[i]>=1&&i+p[i]<=2*m-1&&s[i-p[i]-1]==s[i+p[i]+1])p[i]++;\n\t\tif(i+p[i]>mr)mid=i,mr=i+p[i];\n\t\th[k][i]=p[i];\n\t}\n}\nvoid solvel(int k) {\n\tint s[maxn],mr=0,mid=0;\n\tmemset(p,0,sizeof(p));\n\tfor(int i=0; i<=2*n; i++)s[i]=a[i][k];\n\tfor(int i=0; i<=2*n; i++) {\n\t\tif(i<mr)p[i]=min(p[2*mid-i],mr-i);\n\t\twhile(i-p[i]>=1&&i+p[i]<=2*n-1&&s[i-p[i]-1]==s[i+p[i]+1])p[i]++;\n\t\tif(i+p[i]>mr)mid=i,mr=i+p[i];\n\t\tl[i][k]=p[i];\n\t}\n}//manacher\nvoid buildst(int n) {\n\tfor(int j=1; j<=lg2[n]; j++)\n\t\tfor(int i=1; i<=n-(1<<j)+1; i++)f[j][i]=min(f[j-1][i],f[j-1][i+(1<<j-1)]);\n}\nint ask(int l,int r) {\n\tint len=lg2[r-l+1];\n\treturn min(f[len][l],f[len][r-(1<<len)+1]);\n}//st\u8868\u5904\u7406\u533a\u95f4min\nint main() {\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1; i<=2*max(n,m); i++)lg2[i]=lg2[i-1]+((1<<lg2[i-1]+1)==i);\n\tfor(int i=1; i<=n; i++)\n\t\tfor(int j=1; j<=m; j++)scanf(\"%d\",&a[i*2-1][j*2-1]);\n\tfor(int i=1; i<=2*n-1; i++)solveh(i);\n\tfor(int j=1; j<=2*m-1; j++) {\n\t\tfor(int i=1; i<=2*n-1; i++)f[0][i]=h[i][j];\n\t\tbuildst(2*n-1);\n\t\tfor(int i=1; i<=2*n-1; i++) {\n\t\t\tint l=1,r=min(i,2*n-i),ans=0;\n\t\t\twhile(l<=r) {\n\t\t\t\tint mid=l+r>>1;\n\t\t\t\tif(ask(i-mid+1,i+mid-1)>=mid)ans=mid,l=mid+1;\n\t\t\t\telse r=mid-1;\n\t\t\t}\n\t\t\thl[i][j]=ans;//\u5de6\u53f3\u5bf9\u79f0\n\t\t}\n\t}\n\tfor(int i=1; i<=2*m-1; i++)solvel(i);\n\tfor(int i=1; i<=2*n-1; i++) {\n\t\tfor(int j=1; j<=2*m-1; j++)f[0][j]=l[i][j];\n\t\tbuildst(2*m-1);\n\t\tfor(int j=1; j<=2*m-1; j++) {\n\t\t\tint l=1,r=min(j,2*m-j),ans=0;\n\t\t\twhile(l<=r) {\n\t\t\t\tint mid=l+r>>1;\n\t\t\t\tif(ask(j-mid+1,j+mid-1)>=mid)ans=mid,l=mid+1;\n\t\t\t\telse r=mid-1;\n\t\t\t}\n\t\t\tll[i][j]=ans;//\u4e0a\u4e0b\u5bf9\u79f0\n\t\t}\n\t}\n\tfor(int i=1; i<=2*n-1; i++)\n\t\tfor(int j=1; j<=2*m-1; j++) {\n\t\t\tint v=min(hl[i][j],ll[i][j]);\n\t\t\tif((i&1)&&(j&1))ans+=(v+1)/2;\n\t\t\telse if(!(i&1)&&!(j&1))ans+=v/2;//\u7edf\u8ba1\u7b54\u6848\n\t\t}\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1643796945,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62"
    },
    {
        "content": "\u770b\u5230\u8fd9\u9898\u9996\u5148\u60f3\u5230\u4e00\u4e2a\u4e00\u4e2a\u6570\u4e00\u5b9a\u4f1aT\n\n\u7136\u540e\u6709\u4ec0\u4e48\u53ef\u4ee5\u4e00\u6b21\u6570\u597d\u591a\u79cd\u7684\u65b9\u6cd5\u5462\n\n\u6211\u4eec\u60f3\u5230\u53ef\u4ee5\u679a\u4e3e\u6b63\u65b9\u5f62\u4e2d\u5fc3\u70b9\u518d\u4e8c\u5206\n\n\u82e5\u6b63\u65b9\u5f62\u6700\u5927\u8fb9\u957f\u53ef\u4ee5\u5230l,\u5219\u8fd9\u4e2a\u4e2d\u5fc3\u5bf9\u7b54\u6848\u6709$\\frac{l+1}{2}$\u7684\u8d21\u732e\n\n\u6211\u4eec\u53ea\u8981\u80fdO(1)\u5224\u65ad\u4e24\u4e2a\u6b63\u65b9\u662f\u5426\u76f8\u7b49\u5c31\u53ef\u4ee5A\u6389\u8fd9\u4e2a\u9898\n\n\u901a\u8fc7\u5218\u6c5d\u4f73\u7684\u5b57\u7b26\u4e32hash\u6211\u60f3\u5230\u4e86\u6269\u5c55\u5230\u4e8c\u7ef4\u7684\u54c8\u5e0c\n\nHash[i][j]=Map[i][j]+X\\*Hash[i][j+1]+Y\\*Hash[i+1][j]-XY\\*Hash[i+1][j+1]\n\n\u90a3\u6837\u6211\u4eec\u9884\u5904\u7406\u51fa\u4e00\u4e2a\u77e9\u9635\u7684hash\u6570\u7ec4\u5e76\u9884\u5904\u7406\u51fa$Pow[i][j]=Y^iX^j$\u5c31\u53ef\u4ee5\u6c42\u51fa\u4e00\u4e2a\u6b63\u65b9\u5f62\u7684hash\u4e86\n\n\u4ee5(i,j)\u4e3a\u5de6\u4e0a\u89d2\u4e14\u957f\u4e3al\u7684\u6b63\u65b9\u5f62\u7684hash=Hash[i][j]-Hash[i+l-1][j]\\*Pow[l-1][0]-Hash[i][j+l-1]\\*Pow[0][l-1]+Hash[i+l-1][j+l-1]\\*Pow[l-1][l-1]\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u539f\u6765\u7684\u77e9\u9635\u548c\u539f\u77e9\u9635\u7684\u5de6\u53f3\u955c\u50cf\u548c\u539f\u77e9\u9635\u7684\u4e0a\u4e0b\u955c\u50cf\u7684hash\u9884\u5904\u7406\u51fa\u6765\u5c31\u53ef\u4ee5\u7528\u4e0a\u9762\u679a\u4e3e\u4e2d\u5fc3+\u4e8c\u5206+Hash\u7684\u505a\u6cd5\u6765A\u6389\u8fd9\u4e2a\u9898\u4e86\n\n---\n\u672c\u8d28\u548c\u697c\u4e0bRMQ+Manacher\u7b97\u6cd5\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u4ee5\u4e3a\u7528\u4e86hash\u6240\u4ee5\u66f4\u5bb9\u6613\u7406\u89e3\u4e00\u4e9b\n\n\\*Hash\u662f\u4e2a\u597d\u4e1c\u897f\uff0c\u867d\u7136\u6709\u70b9\u7384\u5b66\u4f46\u662f\u771f\u7684\u80fd\u4ee3\u66ff\u5f88\u591a\u6709\u96be\u5ea6\u7b97\u6cd5\\*\n\n[\u4ee3\u7801](http://paste.ubuntu.com/25416469/)\n\nHash\u672c\u5e94\u8be5\u7528unsigned long long\u6765\u5b58\u50a8\u6765\u7740\n\n\u4f46\u662f\u56e0\u4e3a\u6781\u7aef\u6570\u636e\u592a\u6162\u4e86\uff0c\u4e00\u72e0\u5fc3\u6539\u6210int\u4e86\n",
        "postTime": 1503913378,
        "uid": 25508,
        "name": "Night_Aurora",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "\u9b3c\u624d\u9898\n\n\u5148\u8003\u8651\u6700 naive \u7684\u505a\u6cd5\uff1a\u679a\u4e3e\u5de6\u4e0a\u89d2\u548c\u957f\u5ea6\u9010\u4e00\u5224\u65ad\uff0c\u590d\u6742\u5ea6 $O(n^5)$\uff0c$30$ \u5206\u4e00\u6863\u90fd T \u7684\u6ca1\u5f71\u4e86\u3002\n\n\u53d1\u73b0\u8fd9\u4e2a\u505a\u6cd5\u4e2d\u6bcf\u4e2a\u70b9\u90fd\u88ab\u540c\u4e00\u4e2a\u8d77\u59cb\u70b9\u67e5\u770b\u4e86\u82e5\u5e72\u6b21\uff0c\u80fd\u4e0d\u80fd\u6539\u8fdb\u5462\uff1f\n\n\u6211\u4eec\u679a\u4e3e\u4e2d\u5fc3\u70b9\uff08\u5148\u4e0d\u8003\u8651\u5076\u6570\u7684\u95ee\u9898\uff09\u7136\u540e\u4f9d\u6b21\u5411\u5916\u4e00\u5708\u4e00\u5708\u9a8c\u8bc1\uff0c\u590d\u6742\u5ea6\u964d\u4f4e\u4e3a $O(n^4)$\u3002\uff08\u6709 $n^2$ \u79cd\u53ef\u80fd\u9009\u70b9\uff0c\u6bcf\u6b21\u9009\u70b9\u81f3\u591a\u8bbf\u95ee\u6240\u6709\u5171 $n$ \u4e2a\u70b9\u6070\u597d\u4e00\u6b21\uff09\n\n\u770b\u8d77\u6765\u6ca1\u6709\u597d\u5230\u54ea\u91cc\u53bb\uff0c\u4f46\u662f\u6ce8\u610f\u5230\u5982\u679c\u5bf9\u4e8e\u6b63\u65b9\u5f62\u5df2\u7ecf\u4e0d\u6ee1\u8db3\u9898\u76ee\u6761\u4ef6\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6b63\u65b9\u5f62\u5411\u4e0a\u4e0b\u5de6\u53f3\u5404\u6269\u5f20\u4e00\u5708\u4e00\u5b9a\u4e5f\u4e0d\u7b26\u5408\u6761\u4ef6\u3002   \n\n\u4e25\u8c28\u7684\u6765\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u8d77\u59cb\u70b9 $(x,y)$\uff0c\u82e5\u4ee5\u5176\u4e3a\u4e2d\u5fc3\u7684\u8fb9\u957f\u4e3a $l_0$ \u7684\u6b63\u65b9\u5f62\u4e0d\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4efb\u610f $l \\geqslant l_0$\uff0c\u4ee5 $(x,y)$ \u4e3a\u4e2d\u5fc3\u7684\u8fb9\u957f\u4e3a $l$ \u7684\u6b63\u65b9\u5f62\u4e5f\u4e0d\u6ee1\u8db3\u6761\u4ef6\u3002\u8fd9\u542f\u53d1\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u4ee5 $O(n^4 \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u89e3\u51b3\u95ee\u9898 ~~\u5582\u5582\u5582\u66f4\u6162\u4e86\u597d\u4e0d\u597d~~\u3002\n\n\u867d\u7136\u76f4\u63a5\u4e8c\u5206\u4e0d\u884c\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u80fd\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u6b63\u65b9\u5f62\u4ee5 $O(1)$ \u7684\u590d\u6742\u5ea6\u786e\u5b9a\u662f\u5426\u6ee1\u8db3\u9898\u76ee\u6761\u4ef6\uff0c\u6211\u4eec\u5c31\u80fd\u4ee5 $O(n^2 \\log n)$ \u8fc7\u6389\u8fd9\u9053\u9898\u3002\n\n\u8fd9\u91cc\u6211\u7528\u4e86\u4e00\u4e2a\u4e0e\u9898\u89e3\u4e0d\uff08geng\uff09\u4e00\uff08ma\uff09\u6837\uff08fan\uff09\u7684\u65b9\u6cd5\uff1a\u6211\u4eec\u628a\u8fd9\u4e2a\u6b63\u65b9\u5f62\u4ece\u4e24\u6761\u4e2d\u8f74\u7ebf\u5904\u62c6\u5f00\uff0c\u4ee4\u5de6\u4e0a\u7684\u54c8\u5e0c\u4e3a $D$\uff0c\u53f3\u4e0a**\u5de6\u53f3\u7ffb\u8f6c**\u540e\u7684\u54c8\u5e0c\u4e3a $C$\uff0c\u5de6\u4e0b**\u4e0a\u4e0b\u7ffb\u8f6c**\u540e\u7684\u54c8\u5e0c\u4e3a $B$\uff0c\u53f3\u4e0b**\u4e0a\u4e0b\u5de6\u53f3**\u7ffb\u8f6c\u540e\u7684\u54c8\u5e0c\u4e3a $A$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6b63\u65b9\u5f62\u6ee1\u8db3\u6761\u4ef6\u5f53\u4e14\u4ec5\u5f53 $A=B=C=D$\u3002\n\n\u90a3\u4e48\uff0c\u5b8c\u4e86\u2026\u2026\u5417\uff1f\u6211\u4eec\u4e0a\u9762\u53ea\u8003\u8651\u4e86\u8fb9\u957f\u4e3a\u5947\u6570\u7684\u60c5\u51b5\uff0c\u8fb9\u957f\u4e3a\u5076\u6570\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4eba\u4e3a\u89c4\u5b9a\u4ee5\u9009\u62e9\u7684\u65b9\u683c\u7684\u53f3\u4e0b\u89d2\u800c\u4e0d\u662f\u4e2d\u5fc3\u4e3a\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u62c6\u5f00\u5373\u53ef\u3002\uff08\u6ce8\u610f\u4e00\u4e0b\u6bcf\u4e2a\u90e8\u5206\u8d77\u70b9\u7684\u4f4d\u7f6e\u4e0d\u8981\u641e\u9519\u4e86\uff09\n\n\u4ee3\u7801\uff1a\n\n```c++\n#include <cstdio>\n#include <random>\n#define ll long long\n#define ull unsigned long long\n\n#define N 1010\n#define B1 1000000007\n#define B2 1000000009\nint n,m;\nll s[N][N];\null a[N][N],b[N][N],c[N][N],d[N][N],f[N],g[N];\n//\u951a\u5b9a\u70b9\uff1a\n//a b\n//c d\nbool judge(int l,int xa,int ya,int xb,int yb,\n                 int xc,int yc,int xd,int yd)\n{\n    ull A=a[xa][ya]-a[xa+l][ya]*f[l]-a[xa][ya+l]*g[l]+a[xa+l][ya+l]*f[l]*g[l];\n    ull B=b[xb][yb]-b[xb+l][yb]*f[l]-b[xb][yb-l]*g[l]+b[xb+l][yb-l]*f[l]*g[l];\n    ull C=c[xc][yc]-c[xc-l][yc]*f[l]-c[xc][yc+l]*g[l]+c[xc-l][yc+l]*f[l]*g[l];\n    ull D=d[xd][yd]-d[xd-l][yd]*f[l]-d[xd][yd-l]*g[l]+d[xd-l][yd-l]*f[l]*g[l];\n    return A==B&&B==C&&C==D;\n}\nbool judge(int l,int x,int y)\n{\n    int v=(l+1)/2;\n    //l\u4e3a\u5947\u6570\uff1a\u4e2d\u70b9\u6269\u5c55\n    if(l&1)\n    {\n        if(x<v||y<v||x+v-1>n||y+v-1>m) return false;\n        return judge(v,x,y,x,y,x,y,x,y);\n    }\n    else\n    {\n        if(x<v||y<v||x+v>n||y+v>m) return false;\n        return judge(v,x+1,y+1,x+1,y,x,y+1,x,y);\n    }\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;i++) for(int j=1;j<=m;j++) scanf(\"%lld\",s[i]+j);\n\n    //a\u951a\u5b9a\u70b9\u5de6\u4e0a\uff0ci j\u9006\u5e8f\n    for(int i=n;i>=1;i--) for(int j=m;j>=1;j--)\n    {\n        a[i][j]=s[i][j]+a[i+1][j]*B1+a[i][j+1]*B2-a[i+1][j+1]*B1*B2;\n    }\n    //b\u951a\u5b9a\u70b9\u53f3\u4e0a\uff0ci\u9006j\u987a\n    for(int i=n;i>=1;i--) for(int j=1;j<=m;j++)\n    {\n        b[i][j]=s[i][j]+b[i+1][j]*B1+b[i][j-1]*B2-b[i+1][j-1]*B1*B2;\n    }\n    //c\u951a\u5b9a\u70b9\u5de6\u4e0b\uff0ci\u987aj\u9006\n    for(int i=1;i<=n;i++) for(int j=m;j>=1;j--)\n    {\n        c[i][j]=s[i][j]+c[i-1][j]*B1+c[i][j+1]*B2-c[i-1][j+1]*B1*B2;\n    }\n    //d\u951a\u5b9a\u70b9\u53f3\u4e0b\uff0ci j\u987a\u5e8f\n    for(int i=1;i<=n;i++) for(int j=1;j<=m;j++)\n    {\n        d[i][j]=s[i][j]+d[i-1][j]*B1+d[i][j-1]*B2-d[i-1][j-1]*B1*B2;\n    }\n    //f:\u9884\u5904\u7406\u4e58\u79ef\u548c\n    f[0]=g[0]=1;\n    for(int i=1;i<=n;i++) f[i]=f[i-1]*B1;\n    for(int i=1;i<=m;i++) g[i]=g[i-1]*B2;\n    //\u8ba1\u7b97\u8d21\u732e\n    long long ans=0;\n    for(int i=1;i<=n;i++) for(int j=1;j<=m;j++)\n    {\n        int L,R;\n        L=0,R=n;\n        while(L!=R)\n        {\n            int mid=(L+R+1)/2;\n            if(judge(mid*2,i,j)) L=mid;\n            else R=mid-1;\n        }\n        ans+=L;\n\n        L=1,R=n;\n        while(L!=R)\n        {\n            int mid=(L+R+1)/2;\n            if(judge(mid*2-1,i,j)) L=mid;\n            else R=mid-1;\n        }\n        ans+=L;\n    }\n    printf(\"%lld\",ans);\n}\n```\n\n\n\n\n\n\n\n",
        "postTime": 1682247459,
        "uid": 298051,
        "name": "xkcdjerry",
        "ccfLevel": 7,
        "title": "P2601 \u9898\u89e3"
    },
    {
        "content": "#### \u9898\u76ee\u63cf\u8ff0\n\u7ed9\u51fa\u4e00\u4e2a\u6570\u5b57\u77e9\u5f62\uff0c\u6c42\u8fd9\u4e2a\u77e9\u5f62\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u6b63\u65b9\u5f62\u6ee1\u8db3\u4e0a\u4e0b\u5bf9\u79f0\u3001\u5de6\u53f3\u5bf9\u79f0\u3002\n#### \u601d\u8def\n\u6211\u4eec\u53ef\u4ee5\u7528 $ 3 $ \u4e2a\u54c8\u5e0c\u6570\u7ec4 $ a \\ b \\ c $ \u5206\u522b\u8868\u793a\u77e9\u5f62\u4ece\u5de6\u4e0a\u5f80\u53f3\u4e0b\u770b\uff0c\u4ece\u5de6\u4e0b\u5f80\u53f3\u4e0a\u770b\uff0c\u4ece\u53f3\u4e0a\u5f80\u5de6\u4e0b\u770b\u7684\u6837\u5b50\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff1a\n1. \u5982\u679c\u6b63\u65b9\u5f62 $ ( x , y , u , v ) $\uff08\u5373\u4ee5 $ ( x , y ) $ \u8fd9\u4e00\u683c\u4e3a\u5de6\u4e0a\u89d2\uff0c$ ( u , v ) $ \u4e3a\u53f3\u4e0b\u89d2\u7684\u6b63\u65b9\u5f62\uff09\u5de6\u53f3\u5bf9\u79f0\uff0c\u90a3\u4e48\u5b83\u4ece\u5de6\u4e0a\u5f80\u53f3\u4e0b\u770b\u548c\u4ece\u53f3\u4e0a\u5f80\u5de6\u4e0b\u770b\u662f\u4e00\u6837\u7684\uff0c\u5373 $ a $ \u54c8\u5e0c\u6570\u7ec4\u548c $ c $ \u54c8\u5e0c\u6570\u7ec4\u76f8\u7b49\u3002\n2. \u5982\u679c\u6b63\u65b9\u5f62 $ ( x , y , u , v ) $ \u4e0a\u4e0b\u5bf9\u79f0\uff0c\u90a3\u4e48\u5b83\u4ece\u5de6\u4e0a\u5f80\u53f3\u4e0b\u770b\u548c\u4ece\u5de6\u4e0b\u5f80\u53f3\u4e0a\u770b\u662f\u4e00\u6837\u7684\uff0c\u5373 $ a $ \u54c8\u5e0c\u6570\u7ec4\u548c $ b $ \u54c8\u5e0c\u6570\u7ec4\u76f8\u7b49\u3002\n\n\u5982\u679c\u4e24\u6761\u6761\u4ef6\u90fd\u6ee1\u8db3\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6b63\u65b9\u5f62\u5c31\u662f\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5206\u8fb9\u6709\u5947\u6570\u4e2a\u8282\u70b9\u548c\u8fb9\u6709\u5076\u6570\u4e2a\u8282\u70b9\u7684\u6b63\u65b9\u5f62\u679a\u4e3e\u5b83\u7684\u4e2d\u5fc3\u70b9\uff0c\u663e\u7136\uff0c\u7b54\u6848\u662f\u5177\u6709\u5355\u8c03\u6027\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e8c\u5206\u7b54\u6848\u6c42\u503c\u3002\n#### \u5b9e\u73b0\n\u6211\u4eec\u901a\u8fc7\u5904\u7406\u51fa $ ( 1 , 1 , i , j ) $ \u77e9\u5f62\u7684\u54c8\u5e0c\u503c\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3c\u524d\u7f00\u548c\u7684\u65b9\u5f0f\u6765\u5206\u522b\u5f97\u5230\u6b63\u65b9\u5f62 $ ( x , y , u , v ) $ \u7684 $ a \\ b \\ c $ \u4e09\u4e2a\u503c\u3002\u67ff\u5b50\u5982\u4e0b\uff1a\n```\nq.a=a[u][v]-a[u][y-1]*p1[v-y+1]-a[x-1][v]*p2[u-x+1]+a[x-1][y-1]*p1[v-y+1]*p2[u-x+1];\nq.b=b[x][v]-b[x][y-1]*p1[v-y+1]-b[u+1][v]*p2[u-x+1]+b[u+1][y-1]*p1[v-y+1]*p2[u-x+1];\nq.c=c[u][y]-c[u][v+1]*p1[v-y+1]-c[x-1][y]*p2[u-x+1]+c[x-1][v+1]*p1[v-y+1]*p2[u-x+1];\n```\n\u7136\u540e\u8fdb\u884c\u5224\u65ad\u5373\u53ef\u3002\n## Code\n```cpp\n#include<cstring>\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<cmath>\nnamespace EMT{\n\t#define pf printf\n\t#define F(i,a,b) for(register int i=a;i<=b;i++)\n\t#define D(i,a,b) for(register int i=a;i>=b;i--)\n\ttypedef unsigned long long ull;\n\tinline int read(){int x=0,f=1;char ch=getchar();while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}while(ch>='0'&&ch<='9')x=x*10+ch-'0',ch=getchar();return x*f;}\n\tinline int min(int a,int b){return a<b?a:b;}inline int max(int a,int b){return a>b?a:b;}\n\tinline void pi(int x){pf(\"%d \",x);}inline void pn(){pf(\"\\n\");}\n\tinline void file(){freopen(\"in.in\",\"r\",stdin);freopen(\"my.out\",\"w\",stdout);}\n\tconst int N=1e3+10;\n\tint n,m,num[N][N],tot;ull a[N][N],b[N][N],c[N][N],p1[N],p2[N];\n\tstruct node{ull a,b,c;}q;\n\tinline void get(int x,int y,int u,int v){\n\t\tq.a=a[u][v]-a[u][y-1]*p1[v-y+1]-a[x-1][v]*p2[u-x+1]+a[x-1][y-1]*p1[v-y+1]*p2[u-x+1];\n\t\tq.b=b[x][v]-b[x][y-1]*p1[v-y+1]-b[u+1][v]*p2[u-x+1]+b[u+1][y-1]*p1[v-y+1]*p2[u-x+1];\n\t\tq.c=c[u][y]-c[u][v+1]*p1[v-y+1]-c[x-1][y]*p2[u-x+1]+c[x-1][v+1]*p1[v-y+1]*p2[u-x+1];\n\t}\n\tinline short main(){\n\t\tp1[0]=p2[0]=1;\n\t\tn=read(),m=read();\n\t\tF(i,1,N-10)p1[i]=p1[i-1]*131,p2[i]=p2[i-1]*13331;\n\t\tF(i,1,n)F(j,1,m)num[i][j]=read();\n        \t//\u6c42\u54c8\u5e0c\u503c\n\t\tF(i,1,n)F(j,1,m)a[i][j]=a[i][j-1]*131+a[i-1][j]*13331-a[i-1][j-1]*131*13331+num[i][j];\n\t\tD(i,n,1)F(j,1,m)b[i][j]=b[i][j-1]*131+b[i+1][j]*13331-b[i+1][j-1]*131*13331+num[i][j];\n\t\tF(i,1,n)D(j,m,1)c[i][j]=c[i][j+1]*131+c[i-1][j]*13331-c[i-1][j+1]*131*13331+num[i][j];\n\t\t//\u5076\u6570\u8fb9\u957f\n\t\tF(i,1,n-1){\n\t\t\tF(j,1,m-1){\n\t\t\t\tint l=1,r=min(min(n-i,i),min(j,m-j)),ans=0;\n\t\t\t\twhile(l<=r){\n\t\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\t\tget(i-mid+1,j-mid+1,i+mid,j+mid);\n\t\t\t\t\tif(q.a==q.b&&q.a==q.c)l=mid+1,ans=mid;\n\t\t\t\t\telse r=mid-1;\n\t\t\t\t}tot+=ans;\n\t\t\t}\n\t\t}\n\t\t//\u5947\u6570\u8fb9\u957f\n\t\tF(i,1,n){\n\t\t\tF(j,1,m){\n\t\t\t\tint l=1,r=min(min(n-i+1,i),min(m-j+1,j)),ans=0;\n\t\t\t\twhile(l<=r){\n\t\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\t\tget(i-mid+1,j-mid+1,i+mid-1,j+mid-1);\n\t\t\t\t\tif(q.a==q.b&&q.a==q.c)l=mid+1,ans=mid;\n\t\t\t\t\telse r=mid-1;\n\t\t\t\t}tot+=ans;\n\t\t\t}\n\t\t}\n\t\tpi(tot);\n\t\treturn 0;\n\t}\n}\nsigned main(){return EMT::main();}\n```\n",
        "postTime": 1625886595,
        "uid": 451066,
        "name": "letitdown",
        "ccfLevel": 9,
        "title": "P2601 \u5bf9\u79f0\u7684\u6b63\u65b9\u5f62"
    },
    {
        "content": "**\u9898\u76ee\u5927\u610f:**\n\n\u7ed9\u4f60\u4e00\u4e2a\u77e9\u9635\uff0c\u95ee\u4f60\u8fd9\u4e2a\u77e9\u9635\u4e2d\n\n\u4e0a\u4e0b\u5bf9\u79f0\u4e14\u5de6\u53f3\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u4e2a\u6570\u3002\n\n------------\n\n**\u601d\u8def\uff1a**\n\n\u9996\u5148\uff0c\u5f88\u660e\u663e\u8981\u7528 hash \u6765\u505a\uff0c\n\n\u56e0\u4e3a\u662f\u77e9\u5f62\uff0c\u662f\u4e8c\u7ef4\u7684\u3002\n\n\u90a3\u5c31\u8981\u7528\u4e8c\u7ef4\u7684 hash\u3002\n\n\u73b0\u5728\u6765\u8bb2\u4e00\u4e0b\u4e8c\u7ef4hash,\n\n\u4e00\u7ef4hash\u662f\u628a\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u4e00\u4e2a\u5e8f\u5217\u7528\u4e00\u4e2a\u6574\u6570\u8868\u793a\u3002\n\n\u4e8c\u7ef4hash\u5219\u662f\u628a\u4e00\u4e2a\u77e9\u9635\u7528\u4e00\u4e2a\u6574\u6570\u8868\u793a\u3002\n\n\u6211\u4eec\u4e24\u6b21 $Hash$ \uff0c\u7b2c\u4e00\u6b21\uff0c\u6211\u4eec\u6a2a\u7740 $Hash$ :\n\n```cpp\nfor(int i = 1; i <= n; i++)\n\t for(int j = 1; j <= m; j++)\n\t \thash[i][j] = hash[i][j - 1] * base_1 + a[i][j];\n```\n\n\u6b64\u65f6\u7684 $Hash(i, j)$ \u8868\u793a\u7b2c $i$ \u884c\u7b2c $j$ \u4e2a\u6570\u7684 $Hash$ \u503c\uff0c\n\n\u6b64\u65f6\u6211\u4eec\u8fdb\u884c\u7b2c\u4e8c\u6b21 $Hash$ \uff1a\n\n```cpp\n\tfor(int i = 1; i <= n; i++)\n\t for(int j = 1; j <= m; j++)\n\t \thash[i][j] = hash[i - 1][j] * base_2;\n```    \n\n\u82e5\u6211\u4eec\u8981\u67e5\u8be2\u5de6\u4e0a\u89d2\u4e3a $(x, y)$ \uff0c\n\n\u53f3\u4e0b\u89d2\u4e3a $(x_1, y_1)$ \u7684\u77e9\u9635\u7684 $Hash$\u503c\u5c31\u4e3a\uff1a\n\n$$hash(x_1,y_1)-hash(x-1, y_1) * base_2^{x_1-x+1}-hash(x_1,y-1)*base_1^{y_1-y+1}+hash(x-1,y-1)*base_2^{x_1-x+1}*base_1^{y_1-y+1}$$\n\n $ok$ ,\u56de\u5230\u6b63\u9898\u3002\u3002\u3002\n\n\u90a3\u4f60\u8003\u8651\u4e00\u4e0b\u4e00\u4e2a\u5de6\u53f3\u4e0a\u4e0b\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u8981\u6ee1\u8db3\u4ec0\u4e48\u7279\u70b9\u3002\n\n\u90a3\u5f88\u660e\u663e\uff0c\u5bf9\u79f0\u5c31\u662f\u6309\u7740\u5bf9\u79f0\u8f74\u7ffb\u8f6c\u8fc7\u6765\u5b83\u8fd8\u662f\u4e00\u6837\u7684\u3002\n\n\u90a3\u5c31\u662f\u8fd9\u4e2a\u6b63\u65b9\u5f62\u5de6\u53f3\u53cd\u8fc7\u6765\uff0c\n\n\u4e0a\u4e0b\u53cd\u8fc7\u6765\u6240\u5f62\u6210\u7684\u56fe\u5f62\u548c\u539f\u6765\u90fd\u4e00\u6837\u3002\n\n\u90a3\u4f60\u5c31\u6784\u9020\u51fa\u6700\u5927\u7684\u77e9\u5f62\u7684\u4e24\u4e2a\u7ffb\u8f6c\u56fe\u5f62\uff0c\n\n\u7136\u540e\u770b\u770b\u539f\u6765\u7684\u4f4d\u7f6e\u5e94\u8be5\u53d8\u9053\u54ea\u91cc\u3002\n\n\u539f\u6765\u662f $[x,y]$ \uff08\u5047\u8bbe\uff09\uff0c\n\n\u90a3\u5de6\u53f3\u7ffb\u8f6c\u5c31\u662f $[x,m\u2212y+1]$ \uff0c\n\n\u4e0a\u4e0b\u7ffb\u8f6c\u5c31\u662f $[n\u2212x+1,y]$ \u3002\n\n\u90a3\u6211\u4eec\u518d\u770b\u77e9\u5f62\u7ffb\u8f6c\u4e4b\u540e\u7684\u4f4d\u7f6e\u53d8\u5316\u3002\n\n\u5047\u8bbe\u539f\u6765\u662f $[lx,ly]\\sim[rx,ry]$ \uff0c\n\n\u90a3\u5de6\u53f3\u7ffb\u8f6c\u7684\u5c31\u662f $[lx,m-ry+1]\\sim[rx,m-rx+1]$ \uff0c\n\n\u4e0a\u4e0b\u7ffb\u8f6c\u7684\u5c31\u662f $[n-rx+1,ly]\\sim[n-lx+1,ly]$ \u3002\n\n\u4f9d\u9898\u610f\uff0c\u5f97\u51fa\u4e00\u4e2a\u7ed3\u8bba\uff1a\n\n\u5f53\u4e00\u4e2a\u6b63\u65b9\u5f62\u5408\u6cd5\u65f6\uff0c\n\n\u4ee5\u8fd9\u4e2a\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u4e14\u6bd4\u5b83\u5c0f\u7684\u6b63\u65b9\u5f62\u4e5f\u5408\u6cd5\uff0c\n\n\u6545\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u4e2d\u5fc3\u70b9\uff0c \n\n\u4e8c\u5206\u51fa\u6700\u5927\u7684\u5408\u6cd5\u6b63\u65b9\u5f62\u7684\u8fb9\u957f $L$ \uff0c\n\n\u8d21\u732e\u4e3a $[\\frac{L+1}2]$ \uff0c\n\n\u63a5\u7740\u8003\u8651\u5230\u4e2d\u5fc3\u70b9\u4e0d\u4e00\u5b9a\u662f\u77e9\u9635\u4e2d\u7684\u6570\uff0c\n\n\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e24\u6b21\u904d\u5386\u3002\n\n\u6700\u540e\u7684\u7b54\u6848\u8fd8\u5f97\u52a0\u4e0a $n * m$\n\n------------\n\n**Final Node:**\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#define di1 1000000007ull\n#define di2 1000000009ull\n#define ull unsigned long long\n\nusing namespace std;\n\nint n, m, a[1001][1001], matrix_up[1001][1001], matrix_left[1001][1001], l, r, mid, ans, tot, lx, ly, tmp;\null hash[1001][1001], times1[1001], times2[1001], hash_up[1001][1001], hash_left[1001][1001], hash1, hash2, hash3;\n\nbool ch(int rx, int ry, int dis) \n{\n\tlx = rx - dis + 1;\n\tly = ry - dis + 1;\n\thash1 = hash[rx][ry] - hash[rx][ly - 1] * times1[dis] - hash[lx - 1][ry] * times2[dis] + hash[lx - 1][ly - 1] * times1[dis] * times2[dis];\n\t\n\ttmp = rx;\n\trx = n - (rx - dis);\n\tlx = rx - dis + 1;\n\tly = ry - dis + 1;\n\thash2 = hash_up[rx][ry] - hash_up[rx][ly - 1] * times1[dis] - hash_up[lx - 1][ry] * times2[dis] + hash_up[lx - 1][ly - 1] * times1[dis] * times2[dis];\n\t\n\trx = tmp;\n\try = m - (ry - dis);\n\tlx = rx - dis + 1;\n\tly = ry - dis + 1;\n\thash3 = hash_left[rx][ry] - hash_left[rx][ly - 1] * times1[dis] - hash_left[lx - 1][ry] * times2[dis] + hash_left[lx - 1][ly - 1] * times1[dis] * times2[dis];\n\t\n\tif (hash1 == hash2 && hash1 == hash3) return 1;\n\treturn 0;\n}\n\nint main() \n{\n\tscanf(\"%d%d\", &n, &m);\n\tfor (int i = 1; i <= n; i++)\n\t for (int j = 1; j <= m; j++)\n\t {\n\t\tscanf(\"%d\", &a[i][j]);\n\t\tmatrix_up[n - i + 1][j] = a[i][j];\n\t\tmatrix_left[i][m - j + 1] = a[i][j];\n\t }\n\ttimes1[0] = times2[0] = 1ull;\n\tfor (int i = 1; i <= n; i++) times1[i] = times1[i - 1] * di1;\n\tfor (int i = 1; i <= m; i++) times2[i] = times2[i - 1] * di2; \n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tfor (int j = 1; j <= m; j++) \n\t\t{\n\t\t\thash[i][j] = hash[i][j - 1] * di1 + a[i][j];\n\t\t\thash_up[i][j] = hash_up[i][j - 1] * di1 + matrix_up[i][j];\n\t\t\thash_left[i][j] = hash_left[i][j - 1] * di1 + matrix_left[i][j];\n\t\t\t\n\t\t}\n\t\ttimes1[i] = times1[i - 1] * di1;\n\t}\n\tfor (int i = 1; i <= n; i++) \n\t{\n\t\tfor (int j = 1; j <= m; j++) \n\t\t{\n\t\t\thash[i][j] += hash[i - 1][j] * di2;\n\t\t\thash_up[i][j] += hash_up[i - 1][j] * di2;\n\t\t\thash_left[i][j] += hash_left[i - 1][j] * di2;\n\t\t}\n\t}\n\tfor (int i = 1; i <= n; i++)\n\t for (int j = 1; j <= m; j++) \n\t {\n\t\tans = 0, l = 1,\tr = min(min(i, n - i + 1), min(j, m - j + 1));\n\t\twhile (l <= r) \n\t\t{\n\t\t\tmid = (l + r) >> 1;\n\t\t\tif (i - mid + 1 < 1 || i + mid - 1 > n || j - mid + 1 < 1 || j + mid - 1 > m) \n\t\t\t{\n\t\t\t\tr = mid - 1;\n\t\t\t\tcontinue;\n\t\t\t}\t\t\n\t\t\tif (ch(i + mid - 1, j + mid - 1, mid * 2 - 1)) ans = mid, l = mid + 1;\n\t\t\telse r = mid - 1;\n\t\t}\n\t\ttot += ans;\n\t\tans = 0, l = 1, r = min(min(i, n - i), min(j, m - j));\n\t\twhile (l <= r) \n\t\t{\n\t\t\tmid = (l + r) >> 1;\n\t\t\tif (i - mid + 1 < 1 || i + mid > n || j - mid + 1 < 1 || j + mid > m) \n\t\t\t{\n\t\t\t\tr = mid - 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ch(i + mid, j + mid, mid * 2)) ans = mid, l = mid + 1;\n\t\t\telse r = mid - 1;\n\t\t}\n\t\ttot += ans;\n\t }\n\tprintf(\"%d\", tot);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1612340734,
        "uid": 216909,
        "name": "Viktley",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "[P2601 [ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62](https://www.luogu.com.cn/problem/P2601)\n\n\u5206\u522b\u54c8\u5e0c\u5de6\u53f3\u5bf9\u79f0\u548c\u4e0a\u4e0b\u5bf9\u79f0\u8fc7\u540e\u7684\u77e9\u5f62\u3002\u5f53\u4e00\u4e2a\u6b63\u65b9\u5f62\u5408\u6cd5\u65f6\uff0c\u4ee5\u8fd9\u4e2a\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u4e3a\u4e2d\u5fc3\u4e14\u6bd4\u5b83\u5c0f\u7684\u6b63\u65b9\u5f62\u4e5f\u5408\u6cd5\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e2a\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u70b9\uff0c\u4e8c\u5206\u6c42\u51fa\u4ee5\u8fd9\u4e2a\u70b9\u4e3a\u4e2d\u5fc3\u70b9\u7684\u6700\u5927\u5408\u6cd5\u6b63\u65b9\u5f62\u7684\u8fb9\u957f $L$\uff0c\u5176\u8d21\u732e\u662f$(L+1)/2$\u3002\u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u5b50\uff08\u4e00\u4e2a $1\\times 1$\u7684\u6b63\u65b9\u5f62\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\u3002\u5bf9\u4e8e\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u6b63\u65b9\u5f62\uff0c\u4ee5\u683c\u70b9\uff08\u5c31\u662f\u4e00\u4e2a\u70b9\uff09\u4e3a\u4e2d\u5fc3\u4e8c\u5206\u6700\u8fdc\u7b26\u5408\u6761\u4ef6\u7684\u957f\u5ea6\n\n```cpp\n#include<bits/stdc++.h>\n#define ull unsigned long long\nusing namespace std;\nconst int N=1005;\nconst int sd1=101,sd2=1001;\nint n,m,ans;\nint a[N][N],b[N][N],c[N][N],p1[N],p2[N];\nint read()\n{\n\tint s=0,w=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9')\n\t{\n\t\tif(ch=='-')w=-w;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9')\n\t{\n\t\ts=s*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn s*w;\n}\nvoid init()\n{\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\ta[i][j]+=a[i][j-1]*sd1;\n\t\t\tb[i][j]+=b[i][j-1]*sd1;\n\t\t\tc[i][j]+=c[i][j-1]*sd1;\n\t\t}\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\ta[i][j]+=a[i-1][j]*sd2;\n\t\t\tb[i][j]+=b[i-1][j]*sd2;\n\t\t\tc[i][j]+=c[i-1][j]*sd2;\n\t\t}\n\tp1[0]=p2[0]=1;\n\tfor(int i=1;i<=max(n,m);i++)\n\t{\n\t\tp1[i]=p1[i-1]*sd1;\n\t\tp2[i]=p2[i-1]*sd2;\n\t}\n}\nbool check(int x,int y,int l)\n{\n\tif(x>n||y>m||x<l||y<l)return 0;\n\tull sum1=a[x][y]-a[x-l][y]*p2[l]-a[x][y-l]*p1[l]+a[x-l][y-l]*p1[l]*p2[l];\n\tint y1=m-y+l;\n\tull sum2=b[x][y1]-b[x-l][y1]*p2[l]-b[x][y1-l]*p1[l]+b[x-l][y1-l]*p1[l]*p2[l];\n\tint x1=n-x+l;\n\tull sum3=c[x1][y]-c[x1-l][y]*p2[l]-c[x1][y-l]*p1[l]+c[x1-l][y-l]*p1[l]*p2[l];\n\tif(sum1==sum2&&sum2==sum3)return 1;\n\treturn 0;\n}\nint main()\n{\n\t\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\ta[i][j]=read();\n\t\t\tb[i][m-j+1]=a[i][j];\n\t\t\tc[n-i+1][j]=a[i][j];\n\t\t}\n\tinit();\n\tfor(int i=0;i<n;i++)//\u4ee5\u683c\u70b9\u4e3a\u4e2d\u5fc3\u7684 \u4e8c\u5206\u7684\u503c\u4e3a\u8fb9\u957f\u7684\u4e00\u534a\n\t\tfor(int j=0;j<m;j++)\n\t\t\t{\n\t\t\t\tint sum=0,l=1,r=min(n,m);\n\t\t\t\twhile(l<r)\n\t\t\t\t{\n\t\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\t\tif(check(i+mid,j+mid,mid+mid))\n\t\t\t\t\t\tsum=mid,l=mid+1;\n\t\t\t\t\telse r=mid;\n\t\t\t\t}\n\t\t\t\tans+=sum;\n\t\t\t}\n\tfor(int i=1;i<=n;i++)//\u4ee5\u683c\u5b50\u4e3a\u4e2d\u5fc3\u7684\n\t\tfor(int j=1;j<=m;j++)\n\t\t\t{\n\t\t\t\tint sum=0,l=1,r=min(n,m);\n\t\t\t\twhile(l<r)\n\t\t\t\t{\n\t\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\t\tif(check(i+mid,j+mid,mid+mid+1))\n\t\t\t\t\t\tsum=mid,l=mid+1;\n\t\t\t\t\telse r=mid;\n\t\t\t\t}\n\t\t\t\tans+=sum;\n\t\t\t}\n\tans+=n*m;\n\tprintf(\"%d\",ans);\n\treturn 0;\n}",
        "postTime": 1606434352,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P2601 [ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62(\u4e8c\u7ef4\u54c8\u5e0c+\u4e8c\u5206)"
    },
    {
        "content": "# \u94fe\u63a5\uff1a\n\n[\u6d1b\u8c37](https://www.luogu.com.cn/problem/P2601)\n\n[\u535a\u5ba2\u56ed](https://www.cnblogs.com/GJY-JURUO/p/14729055.html)\n\n# \u9898\u76ee\u5927\u610f\uff1a\n\n\u5728\u4e00\u4e2a $n \\times m$ \u7684\u77e9\u9635\u5185\u6c42\u51fa\u4e0a\u4e0b\u5de6\u53f3\u90fd\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3002\n\n$1\\leq n,m\\leq 1000$\u3002\n\n# \u6b63\u6587\uff1a\n\n\u5bf9\u4e8e\u672c\u9898\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\u4e00\u4e2a\u5408\u6cd5\u7684\u6b63\u65b9\u5f62\u5185\u90e8\u4e5f\u662f\u5408\u6cd5\u7684\u6b63\u65b9\u5f62\u3002\n\n\u7136\u540e\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u66b4\u529b\u7684\u601d\u8def\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u5f80\u5916\u6269\u5f20\uff0c\u6bcf\u6b21\u5224\u5408\u6cd5\u5c31\u53ef\u4ee5\u53ea\u5224\u65ad\u6700\u5916\u4e00\u5c42\uff0c\u8fd9\u662f\u8fb9\u957f\u4e3a\u5947\uff1b\u8fd8\u8981\u9884\u5904\u7406\u51fa\u6240\u6709\u8fb9\u957f\u4e3a\u4e8c\u7684\u5408\u6cd5\u6b63\u65b9\u5f62\uff0c\u540c\u6837\u5411\u5916\u6269\u5f20\u3002\n\n\u6bcf\u6b21\u5224\u5916\u5708\u65f6\uff0c\u76f8\u5f53\u4e8e\u6709\u82e5\u5e72\u4e2a\u957f\u65b9\u5f62\u8981\u5728\u5408\u6cd5\u7684\u4f4d\u7f6e\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/for0sq2i.png)\n\n\u5982\u56fe\uff0c\u4e0d\u540c\u989c\u8272\u7684\u683c\u5b50\u53ef\u4ee5\u770b\u4f5c\u4e0d\u540c\u957f\u65b9\u5f62\u7684\u9876\u70b9\u3002\n\n\u4e00\u822c\u4e00\u9053\u9898\u60f3\u5f97\u8fd9\u4e48\u590d\u6742\uff0c\u8981\u6362\u4e2a\u601d\u8def\uff0c\u91cd\u65b0\u5ba1\u9898\u3002\n\n---\n\n\u5176\u5b9e\u5224\u5408\u6cd5\u5e76\u4e0d\u7528\u8fd9\u4e48\u9ebb\u70e6\u3002\u65e2\u7136\u5408\u6cd5\u7684\u6b63\u65b9\u5f62\u662f\u4e0a\u4e0b\u3001\u5de6\u53f3\u5bf9\u79f0\uff0c\u90a3\u6211\u4eec\u5c31\u53d6\u6b63\u65b9\u5f62\u7684\u5de6\u4e0a\u90e8\u5206\u3001\u5de6\u53f3\u98a0\u5012\u7684\u53f3\u4e0a\u90e8\u5206\u3001\u4e0a\u4e0b\u98a0\u5012\u7684\u5de6\u4e0b\u90e8\u5206\u5224\u662f\u5426\u4e00\u6837\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/3d7vfjlj.png)\n\n\u53ef\u4ee5\u901a\u8fc7**\u4e8c\u7ef4\u54c8\u5e0c**\u5224\u3002\n\n---\n\n$\\mathcal{O}(n)$ \u5f80\u5916\u6269\u5f20\u4f1a\u8d85\u65f6\uff0c\u53ef\u4ee5\u4e8c\u5206\u89e3\u51b3\u3002\u8fd9\u91cc\u6700\u597d\u4e0d\u8981\u50cf\u4e0a\u6587\u63d0\u5230\u7684\u679a\u4e3e\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u70b9\uff0c\u6700\u597d\u662f\u679a\u4e3e\u6b63\u65b9\u5f62\u7684\u5de6\u4e0a\u89d2\uff0c\u7136\u540e\u4e8c\u5206\u6b63\u65b9\u5f62\u7684\u8fb9\u957f\u3002\n\n# \u4ee3\u7801\uff1a\n\n```cpp\nint n, m;\nunsigned ll base1 = 87, base2 = 31;\nunsigned ll a[N][N], b[N][N], c[N][N], ans;\nunsigned ll Ha[N][N], Hb[N][N], Hc[N][N];\nunsigned ll fac1[N], fac2[N];\n\nbool check(int len, int x, int y)\n{\n\tif (x > n || y > m || x < len || y < len) return 0;\n\tunsigned ll CHa = 0, CHb = 0, CHc = 0;\n\tCHa = Ha[x][y] - Ha[x - len][y] * fac2[len] - \n\t      Ha[x][y - len] * fac1[len] + Ha[x - len][y - len] * fac1[len] * fac2[len];\n\tint t = y; y = m - (y - len);\n\tCHb = Hb[x][y] - Hb[x - len][y] * fac2[len] - \n\t      Hb[x][y - len] * fac1[len] + Hb[x - len][y - len] * fac1[len] * fac2[len];\n\ty = t, x = n - (x - len);\n\tCHc = Hc[x][y] - Hc[x - len][y] * fac2[len] - \n\t      Hc[x][y - len] * fac1[len] + Hc[x - len][y - len] * fac1[len] * fac2[len];\n\treturn CHa == CHb && CHb == CHc;\n}\n\nll Binary(int i, int j, int f = 0)\n{\n\tint l = 0, r = min(i, j) + f, mid, tmp = f;\n\twhile (l <= r)\n\t{\n\t\tmid = l + r >> 1;\n\t\tif (check(mid * 2 - f, i + mid, j + mid))\n\t\t\tl = mid + 1, tmp = mid * 2 - f; \n\t\telse r = mid - 1;\n\t}\n\treturn (tmp + 1) / 2;\n}\n\nint main()\n{\n\tn = READ(), m = READ();\n\tfac1[0] = fac2[0] = 1ull;\n\tfor (int i = 1; i <= n; i++)\n\t\tfac1[i] = fac1[i - 1] * base1;\n\tfor (int i = 1; i <= m; i++)\n\t\tfac2[i] = fac2[i - 1] * base2;\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= m; j++)\n\t\t\tb[i][m - j + 1] = c[n - i + 1][j] = a[i][j] = READ();\n\t\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= m; j++)\n\t\t\tHa[i][j] += Ha[i][j - 1] * base1 + a[i][j],\n\t\t\tHb[i][j] += Hb[i][j - 1] * base1 + b[i][j],\n\t\t\tHc[i][j] += Hc[i][j - 1] * base1 + c[i][j];\n\t\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= m; j++)\n\t\t\tHa[i][j] += Ha[i - 1][j] * base2,\n\t\t\tHb[i][j] += Hb[i - 1][j] * base2, \n\t\t\tHc[i][j] += Hc[i - 1][j] * base2;\n\n\tfor (int i = 1; i <= n; i++)\n \t\tfor (int j = 1; j <= m; j++)\n\t\t{\n\t\t\tans += Binary(i, j, 1) + Binary(i, j);\n\t\t}\n\tprintf (\"%llu\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1620104143,
        "uid": 80695,
        "name": "Jayun",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "\n[\u63a8\u8350\u535a\u5ba2\u98df\u7528](https://blog.csdn.net/Jackma_mayichao/article/details/113782285)\n\n___\n# \u9898\u76ee\u5927\u610f\n\u7ed9\u51fa\u4e00\u4e2a $n\\times m$ \u7684\u77e9\u9635\uff0c\u6c42\u77e9\u9635\u4e2d\u4e0a\u4e0b\u5de6\u53f3\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u4e2a\u6570\u3002\n\n# \u601d\u8def\n\u9996\u5148\u8fd9\u9053\u9898\u66b4\u529b\u53bb\u641e\u80af\u5b9a\u4f1a\u8d85\u65f6\uff0c\n\n\u56e0\u4e3a\u4e3b\u8981\u662f**\u679a\u4e3e\u548c\u5224\u65ad**\u4e24\u5927\u90e8\u5206\u8017\u65f6\uff0c\u6240\u4ee5\u60f3\u5230\u4e86\u7528**\u4e8c\u7ef4\u54c8\u5e0c**\u53bb\u505a\u3002\n\n\u6b64\u9898\u9700\u8981\u5bfb\u627e\u4e0a\u4e0b\u5de6\u53f3\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\uff0c\u6240\u4ee5\u8981\u54c8\u5e0c\u4e09\u6b21\uff0c\n\n\u5206\u522b\u662f\u539f\u77e9\u9635\uff0c\u4e0a\u4e0b\u98a0\u5012\u7684\u77e9\u9635\u548c\u5de6\u53f3\u98a0\u5012\u7684\u77e9\u9635\u3002\n\n\u8fbe\u5230 $O(1)$ \u7684\u5224\u65ad\u590d\u6742\u5ea6\u540e\u679a\u4e3e\u8fd8\u662f\u4f1a\u8d85\u65f6 ($O(n^3)$ \u7684\u590d\u6742\u5ea6)\uff0c\u56e0\u6b64\u8003\u8651\u4f18\u5316\u6389\u4e00\u4e2a $n$\u3002\n\n\u56de\u5230\u66b4\u529b\uff0c\u4e00\u822c\u7684\u66b4\u529b\u90fd\u662f\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u4ece\u679a\u4e3e\u5230\u7684\u70b9\u53d1\u6563\u5224\u65ad\u6709\u5426\u7b26\u5408\u6761\u4ef6\u7684\u77e9\u9635\uff0c\n\n\u53d1\u73b0\u53ef\u4ee5\u7528**\u4e8c\u5206**\u6765\u4f18\u5316\u53d1\u6563\u6b65\u9aa4\u7684\u65f6\u95f4\uff0c\u6700\u540e\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^2\\log_2{n})$\u3002\n\n___\n\u5927\u4f53\u601d\u8def\u89e3\u51b3\u540e\uff0c\u601d\u8003\u600e\u6837\u89e3\u51b3\u53d1\u6563\u3002\n\n\u6211\u7684\u601d\u8def\u975e\u5e38\u6e05\u5947\uff0c**\u679a\u4e3e\u77e9\u9635\u53f3\u4e0b\u89d2\u7684\u70b9**\u6765\u505a\uff0c\n\n\u53ef\u662f\u8fd9\u6837\u4e0d\u80fd\u6ee1\u8db3\u4e8c\u5206\u5230\u7684\u8303\u56f4\u4ee5\u5185\u90fd\u662f\u4e0a\u4e0b\u5de6\u53f3\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u554a\uff1f\n\n\u6240\u4ee5\u9700\u8981**\u7531\u53f3\u4e0b\u89d2\u7684\u70b9\u628a\u4e8c\u5206\u8303\u56f4\u6269\u5927\u4e00\u500d\u6765\u4f5c\u5224\u65ad\u6761\u4ef6\uff0c\u4ee5\u4e2d\u5fc3\u70b9\u4e3a\u4e2d\u5fc3\u3002**\n\n\u4ee5\u6b64\u6765\u786e\u4fdd\u8ba1\u7b97\u7684\u6b63\u786e\u6027\u3002\n\n\u5176\u5b9e\u4e5f\u5c31\u662f**\u7531\u53f3\u4e0b\u89d2\u7684\u70b9\u6765\u786e\u5b9a\u4e2d\u5fc3\u70b9**\uff0c\u5f02\u66f2\u540c\u5de5\u3002\n\n\u5224\u65ad\u90e8\u5206\u5c31\u662f\u628a\u6784\u9020\u51fa\u7684\u4e09\u4e2a\u54c8\u5e0c\u77e9\u9635\u76f4\u63a5\u5bf9\u6bd4(\u5f53\u7136\u662f\u6570\u503c\u7684\u6bd4\u8f83)\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u4e8c\u5206\u8981\u5206\u5947\u5076\uff0c\u56e0\u4e3a\u5947\u6570\u548c\u5076\u6570\u6709\u7edf\u8ba1\u4e0a\u7684\u5dee\u5f02\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\nusing namespace std;\nunsigned long long a[1010][1010],b[1010][1010],c[1010][1010];\nunsigned long long f1[1000010],f2[1000010];\nint n,m,ans;\nbool check(int mid,int i,int j)\n{\n\tif(i-mid<0||j-mid<0||i>n||j>m||i<0)\n\t  return 0;\n\tint a1=a[i][j]-a[i-mid][j]*f2[mid]-a[i][j-mid]*f1[mid]+a[i-mid][j-mid]*f1[mid]*f2[mid];\n\tint bx=n-(i-mid),by=m-(j-mid);\n\tint b1=b[bx][j]-b[bx-mid][j]*f2[mid]-b[bx][j-mid]*f1[mid]+b[bx-mid][j-mid]*f1[mid]*f2[mid];\n\tint c1=c[i][by]-c[i-mid][by]*f2[mid]-c[i][by-mid]*f1[mid]+c[i-mid][by-mid]*f1[mid]*f2[mid];\n\t//cout<<a1<<\" \"<<b1<<\" \"<<c1<<endl;\n\tif(a1==b1&&b1==c1)\n\t  return 1;\n\telse\n\t  return 0;\n}\nvoid yhash()\n{\n\tfor(int i=1; i<=n; i++)\n\t for(int j=1; j<=m; j++)\n\t  {\n\t  \ta[i][j]=a[i][j-1]*1000000009ull+a[i][j];\n\t  \tb[i][j]=b[i][j-1]*1000000009ull+b[i][j];\n\t\tc[i][j]=c[i][j-1]*1000000009ull+c[i][j];\n\t  }\n\tfor(int i=1; i<=n; i++)\n\t for(int j=1; j<=m; j++)\n\t  {\n\t  \ta[i][j]=a[i-1][j]*1000000007ull+a[i][j];\n\t  \tb[i][j]=b[i-1][j]*1000000007ull+b[i][j];\n\t\tc[i][j]=c[i-1][j]*1000000007ull+c[i][j];\n\t  }\n}\nint main()\n{\n\tcin>>n>>m;\n\tf1[0]=1ull,f2[0]=1ull;\n\tfor(int i=1; i<=max(n,m); i++)\n\t   f1[i]=f1[i-1]*1000000009ull,f2[i]=f2[i-1]*1000000007ull;\n\tfor(int i=1; i<=n; i++)\n\t for(int j=1; j<=m; j++)\n\t  {\n\t  \tscanf(\"%ulld\",&a[i][j]);\n\t  \tc[i][m-j+1]=a[i][j];    //\u5de6\u53f3\u98a0\u5012\n\t  \tb[n-i+1][j]=a[i][j];    //\u4e0a\u4e0b\u98a0\u5012\n\t  \t//\uff08\u4e0d\u660e\u767d\u7684\u624b\u63a8\u4e00\u4e0b\uff09\n\t  }\n\tyhash();\n\tfor(int i=1; i<=n; i++)\n\t for(int j=1; j<=m; j++)\n\t  {\n\t  \t int l=0,r=min(i,j)+1,mid=0,maxx=1;\n\t  \t while(l<=r)//\u5947\u6570 \n\t  \t  {\n\t  \t  \tmid=(l+r)/2;\n\t  \t  \tif(check(mid*2-1,i+mid,j+mid))  //\u6269\u5927\u5230\u4ee5\u4e2d\u5fc3\u70b9\u4e3a\u4e2d\u5fc3\n\t  \t  \t  l=mid+1,maxx=max(mid*2-1,maxx);\n\t  \t  \telse\n\t  \t  \t  r=mid-1;\n\t\t  }\n\t\t ans=ans+(maxx+1)/2;\n\t\t maxx=0;\n\t\t l=0,r=min(i,j);\n\t\t while(l<=r)  //\u5076\u6570\n\t  \t  {\n\t  \t  \tmid=(l+r)/2;\n\t  \t  \tif(check(mid*2,i+mid,j+mid))      //\u540c\u4e0a\n\t  \t  \t  l=mid+1,maxx=max(mid*2,maxx);\n\t  \t  \telse\n\t  \t  \t  r=mid-1;\n\t\t  }\n\t\tans=ans+(maxx+1)/2;\n\t  }\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1612941640,
        "uid": 128431,
        "name": "JA_yichao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "\u9996\u5148\u8054\u60f3\u5230`Manacher`~~\u9a6c\u62c9\u8f66~~\uff0c\u53ef\u4ee5\u5728\u77e9\u5f62\u4e2d\u6dfb\u52a0\u989d\u5916\u7684 $0$ \u4f7f\u5f97\u5b50\u77e9\u5f62\u7684\u4e2d\u5fc3\u4e00\u5b9a\u5728\u67d0\u4e2a\u683c\u5b50\u4e0a\u3002\uff08\u6ce8\u610f\uff1a\u5b50\u77e9\u5f62\u7684\u4e2d\u5fc3\u5fc5\u987b\u5947\u5076\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u7edf\u8ba1 `1 1` \u8fd9\u6837\u7684\u77e9\u5f62\uff09\n\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u82e5\u5b58\u5728\u4ee5 $(x,y)$ \u4e3a\u4e2d\u5fc3\u7684\u3001\u201c\u534a\u5f84\u201d\u4e3a $k$ \u7684\u5b50\u6b63\u65b9\u5f62\uff0c\u5f53\u4e14\u4ec5\u5f53 $(x-k,y),(x-k+1,y),\\cdots(x+k,y)$ \u7684\u7ad6\u5411\u56de\u6587\u534a\u5f84 $\\ge k$ \u4e14 $(x,y-k),(x,y-k+1),\\cdots(x,y+k)$ \u7684\u6a2a\u5411\u56de\u6587\u534a\u5f84 $\\ge k$ \uff0c\u5e76\u4e14\u4e24\u90e8\u5206\u5bf9\u5b50\u6b63\u65b9\u5f62\u7684\u534a\u5f84\u9650\u5236\u53ef\u4ee5\u5206\u522b\u8ba1\u7b97\u3002\n\n\u73b0\u5728\u7684\u95ee\u9898\u7c7b\u4f3c\u4e8e\u6c42\u6700\u5927\u767d\u8272\u5b50\u6b63\u65b9\u5f62\u7684\u5927\u5c0f\u3002\n\n\u4e8e\u662f\u8003\u8651\u4f7f\u7528\u5355\u8c03\u961f\u5217\uff0c\u5148\u53ea\u8003\u8651\u5de6\u8fb9\u7684\u9650\u5236\uff0c\u663e\u7136\u82e5\u4e00\u6761\u9650\u5236\u6bd4\u5176\u53f3\u4fa7\u7684\u9650\u5236\u5f31\u5219\u6b64\u9650\u5236\u65e0\u7528\u3002\u4e4b\u540e\uff0c\u9650\u5236\u5f62\u6210\u4e86\u4e00\u4e2a\u7c7b\u4f3c\u5411\u53f3\u4e0a\u5ef6\u4f38\u7684\u9636\u68af\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/re6o380g.png)\n\n\u540c\u65f6\uff0c\u7531\u4e8e\u6c42\u7684\u662f\u5b50\u6b63\u65b9\u5f62\uff0c\u5de6\u4fa7\u7684\u9650\u5236\u53ef\u80fd\u4f7f\u5f97\u80fd\u5361\u8fc7\u53bb\u7684\u77e9\u5f62\u90fd\u8fc7\u6241\uff0c\u800c\u4e0d\u80fd\u6210\u4e3a\u6b63\u65b9\u5f62\uff0c\u5e76\u4e14\u6b63\u65b9\u5f62\u4e2d\u5fc3\u8d8a\u9760\u53f3\u8d8a\u6241\u3002\u56e0\u6b64\u8fd9\u79cd\u9650\u5236\u4e5f\u8981\u5f39\u51fa\u3002\u6700\u540e\u7528\u6700\u5de6\u4fa7\u6ca1\u88ab\u5f39\u51fa\u7684\u9650\u5236\u66f4\u65b0\u7b54\u6848\u3002\n\n\u590d\u6742\u5ea6 $O(nm)$\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <queue>\nusing namespace std;\n\n#define N 2100\n#define ll long long\n\nint n, m, a[N][N];\n\nint str[N], r[N];\nvoid manacher(int n) {\n\tstr[0] = -1;\n\tstr[n + 1] = -2;\n\tint p = 1;\n\tfor (int i = 2; i <= n; i++) {\n\t\tr[i] = min(r[p * 2 - i], p + r[p] - i);\n\t\twhile (str[i + r[i] + 1] == str[i - r[i] - 1])\n\t\t\tr[i]++;\n\t\tif (i + r[i] > p + r[p])\n\t\t\tp = i;\n\t}\n}\n\nint x[N], y[N];\n\nstruct Rect {\n\tint l, r, y;\n} q[N];\n\nvoid foo(int n) {\n\tint L = 1, R = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tint tl = i;\n\t\twhile (L <= R && q[R].y >= x[i])\n\t\t\ttl = q[R--].l;\n\t\tq[++R] = (Rect){tl, i, x[i]};\n\t\twhile (L <= R && i - q[L].r > q[L].y)\n\t\t\tL++;\n\t\tq[L].l = max(q[L].l, i - q[L].y);\n\t\ty[i] = i - q[L].l;\n\t}\n\t\n\tL = 1, R = 0;\n\tfor (int i = n; i >= 1; i--) {\n\t\tint tr = i;\n\t\twhile (L <= R && q[R].y >= x[i])\n\t\t\ttr = q[R--].r;\n\t\tq[++R] = (Rect){i, tr, x[i]};\n\t\twhile (L <= R && q[L].l - i > q[L].y)\n\t\t\tL++;\n\t\tq[L].r = min(q[L].r, i + q[L].y);\n\t\ty[i] = min(y[i], q[L].r - i);\n\t}\n}\n\nint v[N][N], ans[N][N];\n\nvoid solve() {\n\tscanf(\"%d %d\", &n, &m);\n\tn <<= 1;\n\tm <<= 1;\n\tfor (int i = 2; i <= n; i += 2)\n\t\tfor (int j = 2; j <= m; j += 2)\n\t\t\tscanf(\"%d\", a[i] + j);\n\t\n\tfor (int i = 1; i <= n + 1; i++) {\n\t\tfor (int j = 1; j <= m + 1; j++)\n\t\t\tstr[j] = a[i][j];\n\t\tmanacher(m + 1);\n\t\tfor (int j = 1; j <= m + 1; j++)\n\t\t\tv[i][j] = r[j];\n\t}\n\tfor (int i = 1; i <= m + 1; i++) {\n\t\tfor (int j = 1; j <= n + 1; j++)\n\t\t\tx[j] = v[j][i];\n\t\tfoo(n + 1);\n\t\tfor (int j = 1; j <= n + 1; j++)\n\t\t\tans[j][i] = y[j];\n\t}\n\t\n\tfor (int i = 1; i <= m + 1; i++) {\n\t\tfor (int j = 1; j <= n + 1; j++)\n\t\t\tstr[j] = a[j][i];\n\t\tmanacher(n + 1);\n\t\tfor (int j = 1; j <= n + 1; j++)\n\t\t\tv[j][i] = r[j];\n\t}\n\tfor (int i = 1; i <= n + 1; i++) {\n\t\tfor (int j = 1; j <= m + 1; j++)\n\t\t\tx[j] = v[i][j];\n\t\tfoo(m + 1);\n\t\tfor (int j = 1; j <= m + 1; j++)\n\t\t\tans[i][j] = min(ans[i][j], y[j]);\n\t}\n\t\n\tlong long sum = 0;\n\tfor (int i = 2; i <= n; i += 2)\n\t\tfor (int j = 2; j <= m; j += 2)\n\t\t\tsum += (ans[i][j] + 1) / 2;\n\tfor (int i = 3; i <= n; i += 2)\n\t\tfor (int j = 3; j <= m; j += 2)\n\t\t\tsum += ans[i][j] / 2;\n\tprintf(\"%lld\\n\", sum);\n}\n\nint main() {\n\t//freopen(\"test.in\", \"r\", stdin);\n\tsolve();\n}\n```",
        "postTime": 1604566159,
        "uid": 88403,
        "name": "acniu",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "\n\n[\u9898\u9762](https://www.luogu.com.cn/problem/P2601)\n\n### \u9898\u610f\u7b80\u8ff0\uff1a\n\n\u7edf\u8ba1\u4e00\u4e2a\u77e9\u9635\u7684\u5b50\u77e9\u9635\u4e2d\u4e3a**\u4e0a\u4e0b\u5bf9\u79f0\u4e14\u5de6\u53f3\u5bf9\u79f0**\u7684\u6b63\u65b9\u5f62\u5b50\u77e9\u9635\u7684\u4e2a\u6570\u3002\n\n### \u601d\u8def\n\n- \u6cd5\u4e00\uff1a\u54c8\u5e0c+\u4e8c\u5206\n- \u6cd5\u4e8c\uff1a~~bfs~~\n\n### \u6cd5\u4e00\n\n\u8fd9\u662f\u54c8\u5e0c\u7684\u4e00\u4e2a**\u57fa\u4e8e\u5b57\u7b26\u4e32\u5339\u914d\u5177\u6709\u5355\u8c03\u6027**\u7684\u7ecf\u5178\u5e94\u7528\u3002\n\n\u672c\u9898\u7684\u5355\u8c03\u6027\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0 \u4ee5\u540c\u4e00\u4e2a\u70b9\u4e3a\u4e2d\u5fc3\u7684\u6b63\u65b9\u4f53\n\n- \u82e5\u8fb9\u957f\u8f83\u5927\u7684\u6b63\u65b9\u4f53\u5de6\u53f3\u5bf9\u79f0\uff0c\u90a3\u4e48\u8fb9\u957f\u8f83\u5c0f\u7684\u4e00\u5b9a\u5de6\u53f3\u5bf9\u79f0\u3002\n- \u82e5\u8fb9\u957f\u8f83\u5927\u7684\u6b63\u65b9\u4f53\u4e0a\u4e0b\u5bf9\u79f0\uff0c\u90a3\u4e48\u8fb9\u957f\u8f83\u5c0f\u7684\u4e00\u5b9a\u4e0a\u4e0b\u5bf9\u79f0\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u4e8c\u5206\u8fb9\u957f\uff0c\n\n\u7136\u540e\u501f\u52a9\u4e8c\u7ef4Hash check\u3002\n\n\u54c8\u5e0c\u7684\u5177\u4f53\u5b9e\u73b0\u8be6\u89c1\u4ee3\u7801\u3002\n\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#define LL unsigned long long\n#define rint register int \nusing namespace std;\nnamespace FastIO\n{\nconst int _SIZE = (1 << 21) + 1;\nchar ibuf[_SIZE],obuf[_SIZE];\nchar *iS,*iT;\nchar c;\nchar qu[55];\nchar *oS=obuf,*oT=oS+_SIZE-1;\nbool _sign=false;\nint qr;\n// getchar\n#define gc() (iS == iT ? (iT = (iS = ibuf) + fread(ibuf, 1, _SIZE, stdin), (iS == iT ? EOF : *iS++)) : *iS++)\n// print the remaining part\ninline void flush() \n{\n    fwrite(obuf,1,oS-obuf,stdout);\n    oS=obuf;\n    return;\n}\n// putchar\ninline void putc(const char &x) \n{\n    *oS++=x;\n    if(oS==oT)\n        flush();\n    return;\n}\n// input a signed integer\ntemplate <class T>\ninline void read(T &x) \n{\n\tx=0;\n\t_sign=false;\n    for (c=gc();c<'0'||c>'9';c=gc())\n        if (c=='-')\n            _sign=true;\n    for (;c>='0'&&c<='9';c=gc()) \n\t\tx=(x<<1)+(x<<3)+(c&15);\n    x=(_sign) ? (~x+1) : x;\n    return;\n}\n// print a signed integer\ntemplate <class I>\ninline void print(I x) {\n    if (!x) {\n    \tputc('0');\n    \treturn;\n\t}\n    if (x<0)\n        putc('-'),x=~x+1;\n    while(x) qu[++qr]=x%10+'0',x/=10;\n    while(qr) putc(qu[qr--]);\n    return;\n}\n// no need to call flush at the end manually!\nstruct Flusher_ \n{\n    ~Flusher_() { flush(); }\n}io_flusher_;\n}  // namespace io\nusing FastIO::read;\nusing FastIO::print;\nusing FastIO::putc;\n//====================================================\nconst LL MOD=998244353ll;\nconst LL P1=2333;\nconst LL P2=13131;\nconst int N=1024;\nint n,m;\nLL a[N][N];\nLL h1[N][N],h2[N][N],h3[N][N];\nLL pow1[N],pow2[N];\nvoid Hash()\n{\n\tregister int i,j;\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=1;j<=m;j++) \n\t\t\th1[i][j]=h1[i][j-1]*P1+a[i][j];\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=1;j<=m;j++) \n\t\t\th1[i][j]=h1[i-1][j]*P2+h1[i][j];\n\t\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=m;j>=1;j--) \n\t\t\th2[i][j]=h2[i][j+1]*P1+a[i][j];\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=m;j>=1;j--) \n\t\t\th2[i][j]=h2[i-1][j]*P2+h2[i][j];\n\t\n\tfor(i=n;i>=1;i--) \n\t\tfor(j=1;j<=m;j++) \n\t\t\th3[i][j]=h3[i][j-1]*P1+a[i][j];\n\tfor(i=n;i>=1;i--) \n\t\tfor(j=1;j<=m;j++) \n\t\t\th3[i][j]=h3[i+1][j]*P2+h3[i][j];\n\t\n\treturn;\n}\n#define get_1(x,y,xx,yy) (h1[xx][yy]-h1[x-1][yy]*pow2[xx-x+1]-h1[xx][y-1]*pow1[yy-y+1]+h1[x-1][y-1]*pow2[xx-x+1]*pow1[yy-y+1])\ninline LL get_2(int x,int y,int xx,int yy)\n{\n\tswap(y,yy);\n\treturn h2[xx][yy] - h2[x-1][yy]*pow2[xx-x+1] - h2[xx][y+1]*pow1[y-yy+1] + h2[x-1][y+1]*pow2[xx-x+1]*pow1[y-yy+1];\n}\ninline LL get_3(int x,int y,int xx,int yy)\n{\n\tswap(x,xx);\n\treturn h3[xx][yy]-h3[x+1][yy]*pow2[x-xx+1]-h3[xx][y-1]*pow1[yy-y+1]+h3[x+1][y-1]*pow2[x-xx+1]*pow1[yy-y+1];\n}\nLL part1,part2,part3;\ninline bool check(const int &x,const int &y,const int &k)\n{// x ,y left up k=d;\n\tif(x<1||y<1||x+k-1>n||y+k-1>m) \n\t\treturn false;\n//\tpart1=get(x,y,x+k-1,y+(k>>1)-(k&1^1),1);\n//\tpart2=get(x,y+(k>>1),x+k-1,y+k-1,2);\n//\tif(part1!=part2) \n//\t\treturn false;\n//\tpart1=get(x,y,x+(k>>1)-(k&1^1),y+k-1,1);\n//\tpart2=get(x+(k>>1),y,x+k-1,y+k-1,3);\n//\tif(part1!=part2) \n//\t\treturn false;\n//\telse return true;\n\tpart1=get_1(x,y,x+k-1,y+k-1);\n\tpart2=get_2(x,y,x+k-1,y+k-1);\n\tif(part1!=part2) \n\t\treturn false;\n\tpart3=get_3(x,y,x+k-1,y+k-1);\n\tif(part2!=part3) \n\t\treturn false;\n\telse return true;\n}\ninline int binary(const int &x,const int &y,const int &d)\n{\n\tregister int L=0,R=min(min(x,y),min(n-x,m-y))+2,mid;\n\twhile(L+1<R) {\n\t\tmid=(L+R)>>1;\n\t\tif(check(x-mid+d,y-mid+d,2*mid+(d^1))) \n\t\t\tL=mid;\n\t\telse R=mid;\n\t}\n\treturn L;\n}\nint main()\n{\n//\tfreopen(\"beauty.in\",\"r\",stdin);\n//\tfreopen(\"beauty.out\",\"w\",stdout);\n\tregister int i,j;\n\tread(n); read(m);\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=1;j<=m;j++) \n\t\t\tread(a[i][j]);\n\tpow1[0]=pow2[0]=1ll;\n\tfor(i=1;i<=N-2;i++) {\n\t\tpow1[i]=pow1[i-1]*P1;\n\t\tpow2[i]=pow2[i-1]*P2;\n\t}\n\tHash();\n\trint ans=0;\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=1;j<=m;j++) {\n\t\t\tans+=binary(i,j,0);\n\t\t\tans+=binary(i,j,1);\n\t\t}\n\tans+=n*m;\n\tprint(ans);\n\tputc('\\n');\n\tFastIO::flush();\n\treturn 0;\n}\n\n```\n\n\n\u8bb0\u5f97\u8981\u628a\u539f\u56fe\u7684\u5de6\u53f3\u98a0\u5012\u56fe\u548c\u4e0a\u4e0b\u98a0\u5012\u56fe\u5206\u522bHash\u3002\n\n### \u6cd5\u4e8c\n\n\u5982\u4f55bfs\uff08\u4e0d\u4f1aTLE\uff09\uff1f\n\n\u8fd9\u8981\u4ece\u6734\u7d20\u7b97\u6cd5\u8bf4\u8d77\u3002\n\n\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e00\u4e2a\u6b63\u65b9\u5f62\uff0c\u7136\u540e\u6328\u4e2acheck\u3002\n\n\u80af\u5b9aTLE\u3002\n\n\u4e0d\u59a8\u628a\u4e00\u4e2a\u6b63\u65b9\u5f62\u7528\u5176\u4e2d\u5fc3\u70b9\u548c\u8fb9\u957f\u8868\u793a\u3002\n\n\u63a5\u7740\u6211\u4eec\u53d1\u73b0 \u540c\u4e00\u4e2d\u5fc3\u70b9 \u8fb9\u957f\u4e3a $k$ \u7684\u5bf9\u79f0\u662f\u57fa\u4e8e\u8fb9\u957f\u4e3a $k-2$ \u7684\u5bf9\u79f0\u57fa\u7840\u4e0a\u7684\u3002\n\n\u5982\u56fe\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/qrm2ihkv.png)\n\n\n\n\u5047\u8bbe\u7c89\u8272\u7684\u77e9\u5f62\u5df2\u7ecf\u5bf9\u79f0\u3002\n\n\u90a3\u4e48\u4e0a\u4e0b\u5de6\u53f3\u5206\u522b\u5f80\u5916\u5ef6\u4f38\u4e00\u683c\u3002\n\n\u53ea\u8981\u5224\u65ad\u56fe\u4e2d\u540c\u8272\u7684\u683c\u5b50\u662f\u5426\u5bf9\u79f0\u5373\u53ef\u3002\n\n\u8fd9\u6837\u5c31\u4ece $k$ \u53d8\u6210\u4e86 $k+2$ \u3002\n\n\u5076\u6570\u8fb9\u957f\u7684\u77e9\u9635\u7c7b\u4f3c\uff0c~~\u8fd9\u91cc\u5c31\u4e0d\u5199\u4e86\u3002~~ \u7559\u7ed9\u8bfb\u8005\u81ea\u884c\u601d\u8003\u3002\n\n\u6240\u4ee5\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c06\n\n- \u5947\u6570\u8fb9\u957f\uff1a\u8fb9\u957f\u4e3a\u4e00\u7684\u70b9\u5165\u961f\uff0c\u82e5\u53ef\u4ee5\u53d8\u6210 $k+2$ \uff0c\u51fa\u961f\uff0c\u5e76\u5c06 $k+2$ \u5165\u961f\u3002\n- \u5076\u6570\u8fb9\u957f\uff1a\u5148\u68c0\u67e5 $2*2$ \u7684\u683c\u5b50\u662f\u5426\u5bf9\u79f0\uff0c\u5176\u4f59\u548c\u5947\u6570\u7c7b\u4f3c\u3002\n\n\u522b\u5fd8\u4e86\u5f53\u6240\u6709\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u65f6\u4e0a\u6570\u5b66\u516c\u5f0f\u3002\n\n\u4e0d\u8fc7\u8fd9\u9898\u597d\u50cf\u5e76\u6ca1\u6709\u5361\u8fd9\u4e2a\u3002\u3002\n\n#### *Code*\n\n//\u4e0d\u8981\u5728\u610f\u51fd\u6570\u540d\u3002\n\n```cpp\n#include<queue>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#define LL long long\nusing namespace std;\nnamespace FastIO\n{\nconst int _SIZE = (1 << 21) + 1;\nchar ibuf[_SIZE],obuf[_SIZE];\nchar *iS,*iT;\nchar c;\nchar qu[55];\nchar *oS=obuf,*oT=oS+_SIZE-1;\nbool _sign=false;\nint qr;\n// getchar\n#define gc() (iS == iT ? (iT = (iS = ibuf) + fread(ibuf, 1, _SIZE, stdin), (iS == iT ? EOF : *iS++)) : *iS++)\n// print the remaining part\ninline void flush() \n{\n    fwrite(obuf,1,oS-obuf,stdout);\n    oS=obuf;\n    return;\n}\n// putchar\ninline void putc(const char &x) \n{\n    *oS++=x;\n    if(oS==oT)\n        flush();\n    return;\n}\n// input a signed integer\ntemplate <class T>\ninline void read(T &x) \n{\n\tx=0;\n\t_sign=false;\n    for (c=gc();c<'0'||c>'9';c=gc())\n        if (c=='-')\n            _sign=true;\n    for (;c>='0'&&c<='9';c=gc()) \n\t\tx=(x<<1)+(x<<3)+(c&15);\n    x=(_sign) ? (~x+1) : x;\n    return;\n}\n// print a signed integer\ntemplate <class I>\ninline void print(I x) {\n    if (!x) {\n    \tputc('0');\n    \treturn;\n\t}\n    if (x<0)\n        putc('-'),x=~x+1;\n    while(x) qu[++qr]=x%10+'0',x/=10;\n    while(qr) putc(qu[qr--]);\n    return;\n}\n// no need to call flush at the end manually!\nstruct Flusher_ \n{\n    ~Flusher_() { flush(); }\n}io_flusher_;\n}  // namespace io\nusing FastIO::read;\nusing FastIO::print;\nusing FastIO::putc;\n//===============================\nconst int N=1024;\nconst LL MOD=998244353ll;\nLL a[N][N];\nint n,m;\nstruct Node\n{\n\tint x,y,len;\n\tNode (const int &xx,const int &yy,const int &zz) : x(xx),y(yy),len(zz) {}\n};\nqueue<Node> q;\n#define law(x,y) (x>=1&&x<=n&&y>=1&&y<=m)\nunsigned LL ans=0;\nvoid spfa()\n{\n\tint i;\n\tint x,y,z;\n\twhile(q.size()) {\n\t\tx=q.front().x; y=q.front().y;\n\t\tz=q.front().len;\n\t\tq.pop();\n\t\tz++;\n\t\tif(!(law((x-z),(y-z))&&law((x+z),(y+z))))\n\t\t\tcontinue;\n\t\tif(a[x-z][y]!=a[x+z][y]||a[x][y-z]!=a[x][y+z]) \n\t\t\tcontinue;\n\t\tfor(i=1;i<=z;i++) {\n\t\t\tif(a[x-z][y-i]!=a[x-z][y+i]||a[x+z][y-i]!=a[x+z][y+i])\n\t\t\t\tbreak;\n\t\t\tif(a[x-z][y-i]!=a[x+z][y-i]) \n\t\t\t\tbreak;\n\t\t\tif(a[x-i][y-z]!=a[x+i][y-z]||a[x-i][y+z]!=a[x+i][y+z]) \n\t\t\t\tbreak;\n\t\t\tif(a[x-i][y-z]!=a[x-i][y+z]) \n\t\t\t\tbreak;\n\t\t}\n\t\tif(i<z+1) continue;\n\t\tq.push(Node(x,y,z));\n\t\tans++;\n\t//\tprintf(\"%d %d %d\\n\",x,y,ans);\n\t}\n\treturn;\n}\nvoid SPFA()\n{\n\tint i;\n\tint x,y,z;\n\twhile(q.size()) {\n\t\tx=q.front().x; y=q.front().y;\n\t\tz=q.front().len;\n\t\tq.pop();\n\t\tz++;\n\t\tif(!(law((x-z+1),(y-z+1))&&law((x+z),(y+z))))\n\t\t\tcontinue;\n\t\tfor(i=1;i<=z;i++) {\n\t\t\tif(a[x-z+1][y-i+1]!=a[x-z+1][y+i]||a[x+z][y-i+1]!=a[x+z][y+i])\n\t\t\t\tbreak;\n\t\t\tif(a[x-z+1][y-i+1]!=a[x+z][y-i+1]) \n\t\t\t\tbreak;\n\t\t\tif(a[x-i+1][y-z+1]!=a[x+i][y-z+1]||a[x-i+1][y+z]!=a[x+i][y+z]) \n\t\t\t\tbreak;\n\t\t\tif(a[x-i+1][y-z+1]!=a[x-i+1][y+z]) \n\t\t\t\tbreak;\n\t\t}\n\t\tif(i<z+1) continue;\n\t\tq.push(Node(x,y,z));\n\t\tans++;\n\t//\tprintf(\"%d %d %d\\n\",x,y,ans);\n\t}\n\treturn;\n}\nint main()\n{\n//\tfreopen(\"beauty.in\",\"r\",stdin);\n//\tfreopen(\"beauty.out\",\"w\",stdout);\n\tint i,j;\n\tLL x;\n\tbool flag=true;\n\tread(n); read(m);\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=1;j<=m;j++) \n\t\t\tread(a[i][j]);\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=1;j<=m;j++) {\n\t\t\tif(i==1&&j==1) \n\t\t\t\tx=a[i][j];\n\t\t\telse if(x!=a[i][j]) \n\t\t\t\tflag=false;\t\n\t\t}\n\tif(flag) {\n\t\tx=min(m,n);\n\t\tans=(max(m,n)-x+1ll)*x*(x+1ll)*(2ll*x+1ll)/6ll;\n\t\tprint(ans);\n\t\treturn 0;\n\t}\t\n\t\n\tfor(i=1;i<=n;i++) \n\t\tfor(j=1;j<=m;j++) \n\t\t\tq.push(Node(i,j,0));\n\t\n\tspfa();\n\tfor(i=1;i<=n-1;i++) {\n\t\tfor(j=1;j<=m-1;j++) {\n\t\t\tif(a[i][j]==a[i+1][j]&&a[i+1][j]==a[i][j+1]&&a[i][j+1]==a[i+1][j+1]) {\n\t\t\t\tq.push(Node(i,j,1));\n\t\t\t\tans++;\n\t\t//\t\tprintf(\"%d %d %d\\n\",i,j,ans);\n\t\t\t}\n\t\t}\n\t}\n\tSPFA();\n\tans+=n*m;\n\tprint(ans);\n\tFastIO::flush();\n\treturn 0;\n}\n```\n\nP.S.:\u8be5\u7b97\u6cd5\u5728\u968f\u673a\u6570\u636e\u4e0b\u8fd0\u884c\u6548\u7387\u6781\u4f73\uff0c\u5728\u6784\u9020\u6570\u636e\u4e0b\u80fd\u88ab\u5361\u7684\u5f88\u60e8\u3002\n\n",
        "postTime": 1589556794,
        "uid": 234913,
        "name": "GBLoi",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\u627e\u5230\u6240\u6709\u7684\u4e0a\u4e0b\u5de6\u53f3\u90fd\u76f8\u540c\u7684\u6b63\u65b9\u5f62\n\n# \u601d\u8def\uff1a\u4e8c\u5206+\u4e8c\u7ef4Hash\n\u8fd9\u9053\u9898\u6211\u4eec\u9996\u5148\u60f3\u5230\u4e0d\u80fd\u66b4\u529b\u5224\u65ad\u4e00\u4e2a\u6b63\u65b9\u5f62\u662f\u5426\u5408\u6cd5\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5f53\u4e00\u4e2a\u6b63\u65b9\u5f62\u5408\u6cd5\u65f6\uff0c\u4ee5\u8fd9\u4e2a\u6b63\u65b9\u5f62\u4e3a\u4e2d\u5fc3\u4e14\u6bd4\u5b83\u5c0f\u7684\u6b63\u65b9\u5f62\u4e5f\u5408\u6cd5\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e2a\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u70b9\uff0c\u4e8c\u5206\u6c42\u51fa\u4ee5\u8fd9\u4e2a\u70b9\u4e3a\u4e2d\u5fc3\u70b9\u7684\u6700\u5927\u5408\u6cd5\u6b63\u65b9\u5f62\u7684\u8fb9\u957fL\uff0c\u5176\u8d21\u732e\u662f $\\frac{L+1}{2}$\n\n\u6211\u4eec\u518d\u56de\u8fc7\u6765\u8ba8\u8bba\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u6b63\u65b9\u5f62\u662f\u5426\u5408\u6cd5\n\n\u5982\u679c\u8fd9\u4e2a\u6b63\u65b9\u5f62\u7684\u539f\u6765\u7684\u3001\u4e0a\u4e0b\u7ffb\u8f6c\u7684\u548c\u5de6\u53f3\u7ffb\u8f6c\u7684\u77e9\u9635\u90fd\u4e00\u6837\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6b63\u65b9\u5f62\u5c31\u662f\u5408\u6cd5\u7684\n\u4ee5\u8fd9\u4e2a\u601d\u8def\u4e3a\u51fa\u53d1\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e8c\u7ef4Hash\u9884\u5904\u7406\u51fa\u8fd9\u4e2a\u6b63\u65b9\u5f62\u539f\u6765\u7684\u3001\u4e0a\u4e0b\u7ffb\u8f6c\u7684\u3001\u5de6\u53f3\u53cd\u8f6c\u7684\u77e9\u9635\uff0c\u6bcf\u6b21\u5224\u65ad\u7684\u65f6\u5019\u53ea\u8981\u5224\u65ad\u8fd9\u4e09\u4e2a\u77e9\u9635\u662f\u5426\u76f8\u540c\u5c31\u53ef\u4ee5\u4e86\n\n\u5728\u679a\u4e3e\u4e2d\u5fc3\u70b9\u7684\u65f6\u5019\u8981\u5206\u7c7b\u8ba8\u8bba\u5947\u5076\u60c5\u51b5\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\n\n**Code**\n```cpp\n#include <cstdio>\n#include <iostream>\n\n#define RI register int\n#define mid (l + r >> 1)\n\nusing namespace std;\n\ntemplate <class T>\ninline void read(T &x) {\n\tx = 0; T f = 1; char c = getchar();\n\twhile(c > '9' || c < '0') {\n\t\tif(c == '-')\n\t\t\tf = -f;\n\t\tc = getchar();\n\t}\n\twhile(c >= '0' && c <= '9') {\n\t\tx = x * 10 + c - '0';\n\t\tc = getchar();\n\t}\n\tx *= f;\n}\n\ntypedef unsigned long long ull;\nconst int N = 1e3 + 1;\nconst int B1 = 233;\nconst int B2 = 332;\nint n, m, ans;\null a[N][N], b[N][N], c[N][N];\null pow1[N], pow2[N];\n\ninline void Read() {\n\tread(n), read(m);\n\tfor(RI i = 1; i <= n; i++)\n\t\tfor(RI j = 1; j <= m; j++)\n\t\t\tread(a[i][j]),\n\t\t\tb[i][m - j + 1] = a[i][j],//\u5de6\u53f3\u7ffb\u8f6c\n\t\t\tc[n - i + 1][j] = a[i][j];//\u4e0a\u4e0b\u7ffb\u8f6c\n}\n//\u4e8c\u7ef4\u54c8\u5e0c\u9884\u5904\u7406\ninline void init() {\n\tfor(RI i = 1; i <= n; i++)\n\t\tfor(RI j = 1; j <= m; j++)\n\t\t\ta[i][j] += a[i][j - 1] * B1,\n\t\t\tb[i][j] += b[i][j - 1] * B1,\n\t\t\tc[i][j] += c[i][j - 1] * B1;\n\tfor(RI i = 1; i <= n; i++)\n\t\tfor(RI j = 1; j <= m; j++)\n\t\t\ta[i][j] += a[i - 1][j] * B2,\n\t\t\tb[i][j] += b[i - 1][j] * B2,\n\t\t\tc[i][j] += c[i - 1][j] * B2;\n\tpow1[0] = pow2[0] = 1;\n\tfor(RI i = 1, tmp = max(n, m); i <= tmp; i++)\n\t\tpow1[i] = pow1[i - 1] * B1,\n\t\tpow2[i] = pow2[i - 1] * B2;\n}\n//\u5224\u65ad\u4e09\u4e2a\u77e9\u9635\u662f\u5426\u76f8\u540c\ninline bool check(int x, int y, int le) {\n\t//\u56e0\u4e3a\u4f1a\u81ea\u7136\u6ea2\u51fa\u7684\u7f18\u6545\uff0cunsigned \u6ca1\u6709\u5c0f\u4e8e0\u7684\u65f6\u5019 \u6240\u4ee5\u4e0d\u80fd\u5199x-le<0 \uff08\u7ec6\u8282\n\tif(x > n || y > m || x < le || y < le)\n\t\treturn false;\n\tull res1 = a[x][y] - a[x][y - le] * pow1[le] - a[x - le][y] * pow2[le] + a[x - le][y - le] * pow1[le] * pow2[le];\n\tint tmp = y;\n\ty = m - (y - le);//\u4f4d\u7f6e\u8981\u8c03\u6574\uff08\u7ec6\u8282\n\tull\tres2 = b[x][y] - b[x][y - le] * pow1[le] - b[x - le][y] * pow2[le] + b[x - le][y - le] * pow1[le] * pow2[le];\n\ty = tmp, x = n - (x - le);//\u4f4d\u7f6e\u8981\u8c03\u6574\uff08\u7ec6\u8282\n\tull res3 = c[x][y] - c[x][y - le] * pow1[le] - c[x - le][y] * pow2[le] + c[x - le][y - le] * pow1[le] * pow2[le];\n\treturn res1 == res2 && res2 == res3;\n}\ninline void solve() {\n\tint tmp = min(n, m);\n\t//\u8fd9\u91cc\u8981\u5206\u4e24\u70b9\u8ba8\u8bba\uff0c\u8fb9\u957f\u4e3a\u5076\u6570\u7684\u662f\u679a\u4e3e\u683c\u70b9\uff0c\u800c\u8fb9\u957f\u4e3a\u5947\u6570\u7684\u5219\u662f\u679a\u4e3e\u683c\u5b50\uff08\u7ec6\u8282\n\tfor(RI i = 0; i < n; i++)\n\t\tfor(RI j = 0; j < m; j++) {\n\t\t\tint l = 1, r = tmp, res = 0;\n\t\t\twhile(l < r) {\n\t\t\t\tif(check(i + mid, j + mid, mid + mid))\n\t\t\t\t\tres = mid, l = mid + 1;\n\t\t\t\telse\n\t\t\t\t\tr = mid;\n\t\t\t}\n\t\t\tans += res;\n\t\t}\n\tfor(RI i = 0; i < n; i++)\n\t\tfor(RI j = 0; j < m; j++) {\n\t\t\tint l = 1, r = tmp, res = 0;\n\t\t\twhile(l < r) {\n\t\t\t\tif(check(i + mid, j + mid, mid + mid + 1))\n\t\t\t\t\tres = mid, l = mid + 1;\n\t\t\t\telse\n\t\t\t\t\tr = mid;\n\t\t\t}\n\t\t\tans += res;\n\t\t}\n\tans += n * m;\t//1\u683c\u7684\u4e5f\u7b97\u5bf9\u79f0\u6b63\u65b9\u5f62\uff0c\u4e0d\u8981\u6f0f\u4e86\uff08\u7ec6\u8282\n\tprintf(\"%d\\n\", ans);\n}\n\nint main() {\n\tRead();\n\tinit();\n\tsolve();\n\treturn 0;\n}\n```\n",
        "postTime": 1575311360,
        "uid": 117799,
        "name": "Rossie65536",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    },
    {
        "content": "\u9898\u76ee[\u94fe\u63a5](https://www.luogu.com.cn/problem/P2601)\u3002\n# \u9898\u610f\u89e3\u91ca\n\u4ece\u4e00\u4e2a\u77e9\u5f62\u627e\u51fa\u4e0a\u4e0b\u5de6\u53f3\u90fd\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\uff0c\u5373\u56de\u6587\u7684\u6b63\u65b9\u5f62\u3002\n\n# \u7b97\u6cd5\u5206\u6790\n\u4e3b\u8981\u7b97\u6cd5\uff1a`\u4e8c\u5206\u7b54\u6848+\u4e8c\u7ef4Hash`\u3002\n\u5bf9\u4e8e\u5728\u4e00\u7ef4\u7684\u5e8f\u5217\u4e2d\uff0c\u4e3b\u8981\u7684\u6c42\u56de\u6587\u4e32\u7684\u7b97\u6cd5\u6709\u4e24\u79cd\uff1a`Manacher`\u548c`\u4e8c\u5206\u7b54\u6848+Hash`\u3002`Manacher`\u901f\u5ea6\u5feb\uff0c\u4f46\u662f\u5b9e\u73b0\u590d\u6742\uff0c\u6240\u4ee5\u5728\u6570\u636e\u8303\u56f4\u5141\u8bb8\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u540e\u8005\u8f83\u4e3a\u5408\u9002\u3002\n\n\u5177\u4f53\u7684\uff0c\u5728\u4e00\u4e2a\u5b57\u7b26\u5e8f\u5217$s_{n}$\u4e2d\uff0c\u533a\u95f4\u4e3a$[l,r]$\uff0c\u8fd9\u4e2a\u533a\u95f4\u7684\u4e2d\u70b9\u5c31\u662f$mid=\\frac{l+r}{2}$\u3002\u6211\u4eec\u901a\u8fc7\u6bd4\u8f83$s_{l,mid}$\u548c$s_{mid+1,r}$\uff0c\u5982\u679c\u4e24\u8fb9\u662f\u56de\u6587\u7684\uff0c\u90a3\u4e48\u5c31\u8bf4\u660e\u5fc5\u7136\u5b58\u5728\u4e00\u4e2a\u957f\u5ea6\u81f3\u5c11\u4e3a$r-l+1$\u56de\u6587\u4e32\uff0c\u53ef\u80fd\u8fd8\u4f1a\u6709\u66f4\u957f\u7684\u56de\u6587\u4e32\uff0c\u8fd9\u65f6\u5c31\u4ee4$l=mid+1$\uff0c\u5426\u5219\uff0c\u5c31\u662f\u8bf4\u660e\u53ef\u80fd\u6709\u66f4\u5c0f\u7684\u56de\u6587\u4e32\uff0c\u4ee4$r=mid-1$\u3002\n\u8fd9\u91cc\u7684$mid$\u5b9e\u9645\u4e0a\u5c31\u662f\u56de\u6587\u4e32\u7684\u5bf9\u79f0\u8f74\uff0c\u800c\u533a\u95f4$[l,r]$\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u56de\u6587\u4e32\u7684\u533a\u95f4\uff0c\u53ea\u662f\u4e3a\u4e86\u4e8c\u5206$mid$\u800c\u8bbe\u7684\u3002\u771f\u6b63\u7684\u56de\u6587\u4e32\u5e94\u8be5\u662f$[i_{0},i_{0}+2mid]$\uff0c$i_{0}$\u8868\u793a\u6700\u521d\u65f6\u7684\u8d77\u59cb\u4f4d\u7f6e\u3002\n\n\u5728\u4e00\u4e2a\u77e9\u5f62\u4e0a\uff0c\u7c7b\u6bd4\u4e00\u7ef4\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u4e8c\u7ef4`Hash`\uff0c\u5e76\u679a\u4e3e\u6b63\u65b9\u5f62\u7684\u5bf9\u79f0\u8f74\uff08\u5982\u679c\u662f\u4e00\u4e2a\u77e9\u5f62\uff0c\u90a3\u5c31\u8981\u5199\u4e8c\u5206\u5957\u4e8c\u5206\u4e86\uff09\uff0c\u8fd9\u53ef\u4ee5\u770b\u4f5c\u679a\u4e3e\u6b63\u65b9\u5f62\u7684\u4e2d\u5fc3\u70b9\uff0c\u5728\u6a2a\u5411\u548c\u7eb5\u5411\u4e0a\u6bd4\u8f83\uff0c\u518d\u50cf\u4e00\u7ef4\u4e0a\u7684\u90a3\u6837\u7edf\u8ba1\u7b54\u6848\uff0c\u5c31\u53ef\u4ee5\u51fa\u7b54\u6848\u4e86\u3002\n\n\u4e8c\u7ef4`Hash`\u505a\u6cd5\uff1a\u5148\u5904\u7406\u6bcf\u4e00\u884c\u7684`Hash`\u503c\uff0c\u518d\u5904\u7406\u6bcf\u4e00\u5217\u7684`Hash`\u503c\u3002\u67e5\u8be2\u5c31\u50cf\u4e8c\u7ef4\u524d\u7f00\u548c\u4e00\u6837\u3002\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\t// Preprocess\n\tfor(int i = 1; i <= n; ++i) {\n\t\tfor(int j = 1; j <= m; ++j) {\n\t\t\tsum[i][j] = sum[i][j - 1] * baseY + a[i][j];\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; ++i) {\n\t\tfor(int j = 1; j <= m; ++j) {\n\t\t\tsum[i][j] = sum[i - 1][j] * baseX;\n\t\t}\n\t}\n\t// Query\n\tauto value = sum[i][j] - sum[i][j - deltaY] * powerY[deltaY] - sum[i - deltaX][j] * powerX[deltaX] + sum[i - deltaX][j - deltaY] * powerX[deltaX] * powerY[deltaY];\n\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u7684\u505a\u6cd5\u662f\u5c06\u539f\u77e9\u9635\u7ffb\u8f6c\uff0c\u4e09\u4e2a\u77e9\u9635\uff0c\u4e00\u4e2a\u662f\u539f\u6765\u7684\uff0c\u4e00\u4e2a\u662f\u7eb5\u5411\u7ffb\u8f6c\u7684\uff0c\u4e00\u4e2a\u662f\u6a2a\u5411\u7ffb\u8f6c\u7684\uff0c\u6309\u4ece\u5de6\u4e0a\u5230\u53f3\u4e0b\u7684\u987a\u5e8f\u5904\u7406\uff08\u5426\u5219\u8981\u5404\u79cd\u987a\u5e8f\u5904\u7406\u6bcf\u4e2a\u65b9\u5411\u7684`Hash`\u503c\uff09\uff0c\u5219\u6309\u7167\u4e2d\u5fc3\u70b9\u5f97\u51fa\u7684\u6b63\u65b9\u5f62\u7684\u9876\u70b9\u9700\u8981\u6839\u636e\u7ffb\u8f6c\u77e9\u9635\u7684\u65b9\u5411\u505a\u8f74\u5bf9\u79f0\u53d8\u6362\u3002\u5e76\u4e14$n,m$\u4e0d\u4e00\u5b9a\u662f\u5076\u6570\uff0c\u4e2d\u70b9\u53ef\u80fd\u662f\u4e00\u4e2a\u70b9\uff0c\u4e5f\u53ef\u80fd\u4e0d\u662f\uff0c\u8981\u5206\u60c5\u51b5\u8ba8\u8bba\u3002\u6700\u540e\uff0c\u52a0\u4e0a$n \\times m$\uff0c\u56e0\u4e3a$1 \\times 1$\u7684\u6b63\u65b9\u5f62\u662f\u56de\u6587\u7684\u3002\n\n# \u4ee3\u7801\u5b9e\u73b0\n\t#include <bits/stdc++.h>\n\tusing namespace std;\n\ttypedef unsigned long long ull;\n\tconst int maxn = 1001;\n\tull a1[maxn][maxn], a2[maxn][maxn], a3[maxn][maxn];  // a1 : \u539f\u6765\u7684, a2 : \u7eb5\u5411\u7ffb\u8f6c, a3 : \u6a2a\u5411\u7ffb\u8f6c\n\tull p1[maxn], p2[maxn];\n\tconst ull b1 = 37, b2 = 87;  // \u4e8c\u7ef4\u54c8\u5e0c\u53d6\u4e24\u4e2a\u6a21\u6570\n\tint n, m, ans;\n\t\n\tull getvalue(int g, int x, int y, int l) {  // g : \u8868\u793a\u5728\u54ea\u4e2a\u77e9\u9635\u4e2d\u53d6\u503c\n\t    if (g == 1) {\n\t        return a1[x][y] - a1[x - l][y] * p2[l] - a1[x][y - l] * p1[l] + a1[x - l][y - l] * p1[l] * \tp2[l];\n\t    }\n\t    if (g == 2) {\n\t        y = m - (y - l);  // \u7eb5\u5411\u7ffb\u8f6c\n\t        return a2[x][y] - a2[x - l][y] * p2[l] - a2[x][y - l] * p1[l] + a2[x - l][y - l] * p1[l] * \tp2[l];\n\t    }\n\t    if (g == 3) {\n\t        x = n - (x - l);  // \u6a2a\u5411\u7ffb\u8f6c\n\t        return a3[x][y] - a3[x - l][y] * p2[l] - a3[x][y - l] * p1[l] + a3[x - l][y - l] * p1[l] * \tp2[l];\n\t    }\n\t}\n\t\n\tbool check(int x, int y, int l) {  // (x, y)\u8868\u793a\u4e2d\u5fc3\u70b9\uff0cl\u8868\u793a\u8fb9\u957f\n\t    if (x > n || y > m || x < l || y < l)\n\t        return 0;  // \u4e0d\u7b26\u5408\u9898\u610f\u7684\u8df3\u8fc7\n\t    ull s1 = getvalue(1, x, y, l);\n\t    ull s2 = getvalue(2, x, y, l);\n\t    ull s3 = getvalue(3, x, y, l);\n\t    return s1 == s2 && s2 == s3;\n\t}\n\t\n\tint main() {\n\t    scanf(\"%d%d\", &n, &m);\n\t    for (int i = 1; i <= n; ++i) {\n\t        for (int j = 1; j <= m; ++j) {\n\t            scanf(\"%lld\", &a1[i][j]);\n\t            a2[i][m - j + 1] = a3[n - i + 1][j] = a1[i][j];  // \u77e9\u9635\u7ffb\u8f6c\n\t        }\n\t    }\n\t    p1[0] = p2[0] = 1;  // \u4e8c\u7ef4Hash\n\t    for (int i = 1; i <= max(n, m); ++i) {\n\t        p1[i] = p1[i - 1] * b1;\n\t        p2[i] = p2[i - 1] * b2;\n\t    }\n\t    for (int i = 1; i <= n; ++i) {\n\t        for (int j = 1; j <= m; ++j) {\n\t            a1[i][j] += a1[i][j - 1] * b1;\n\t            a2[i][j] += a2[i][j - 1] * b1;\n\t            a3[i][j] += a3[i][j - 1] * b1;\n\t        }\n\t    }\n\t    for (int i = 1; i <= n; ++i) {\n\t        for (int j = 1; j <= m; ++j) {\n\t            a1[i][j] += a1[i - 1][j] * b2;\n\t            a2[i][j] += a2[i - 1][j] * b2;\n\t            a3[i][j] += a3[i - 1][j] * b2;\n\t        }\n\t    }\n\t    for (int i = 1; i < n; ++i) {  // \u5bf9\u4e8e\u8fb9\u957f\u4e3a\u5076\u6570\u7684\n\t        for (int j = 1; j < m; ++j) {\n\t            int l = 0, r = min(n, m) + 1;\n\t            int ss = 0;\n\t            while (l <= r) {\n\t                int mid = l + r >> 1;\n\t                if (check(i + mid, j + mid, mid * 2)) {\n\t                    ss = mid;\n\t                    l = mid + 1;\n\t                } else {\n\t                    r = mid - 1;\n\t                }\n\t            }\n\t            ans += ss;\n\t        }\n\t    }\n\t    for (int i = 1; i <= n; ++i) {  // \u5bf9\u4e8e\u8fb9\u957f\u4e3a\u5947\u6570\u7684\n\t        for (int j = 1; j <= m; ++j) {\n\t            int l = 0, r = min(n, m) + 1;\n\t            int ss = 0;\n\t            while (l <= r) {\n\t                int mid = l + r >> 1;\n\t                if (check(i + mid, j + mid, mid * 2 + 1)) {\n\t                    ss = mid;\n\t                    l = mid + 1;\n\t                } else {\n\t                    r = mid - 1;\n\t                }\n\t            }\n\t            ans += ss;\n\t        }\n\t    }\n\t    ans += n * m;\n\t    printf(\"%d\\n\", ans);\n\t}",
        "postTime": 1575106914,
        "uid": 219538,
        "name": "ctj12461",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62"
    },
    {
        "content": "\n# $Description$\n\n[\u9898\u9762](https://www.luogu.org/problem/P2601)\n\n\u7ed9\u4f60\u4e00\u5f20$n*m$\u7684\u6570\u5b57\u8868\uff0c\u95ee\u5176\u4e2d\u6709\u591a\u5c11\u4e2a\u4e0a\u4e0b\u5bf9\u79f0\u4e14\u5de6\u53f3\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3002\n#$Solution$\n\n\u8fd9\u9053\u9898\u771f\u7684\u6076\u5fc3\uff0c\u9996\u5148\u5b66\u4e60\u4e00\u4e0b\u4e8c\u7ef4\u54c8\u5e0c\uff0c\u4f46\u5728\u5b66\u4e60\u4e8c\u7ef4\u54c8\u5e0c\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u95ee\u9898\n>\u7ed9\u4f60\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u5b57\u7b26\u4e32\u548c$Q$\u7ec4\u8be2\u95ee\uff0c\u6bcf\u7ec4\u8be2\u95ee\u662f\u4e24\u4e2a\u4f4d\u7f6e\u548c\u4e24\u4e2a\u957f\u5ea6\u4ee3\u8868\u4e24\u4e2a\u5b50\u4e32\uff0c\u95ee\u8fd9\u4e24\u4e2a\u5b50\u4e32\u662f\u5426\u76f8\u7b49\n\n\u5bf9\u4e8e\u8fd9\u79cd\u9898\uff0c\u5982\u679c\u6bcf\u7ec4$Q$\u90fd\u8fdb\u884c$O(n)$\u7684\u54c8\u5e0c\u660e\u663e\u548c\u66b4\u529b\u6ca1\u533a\u522b\uff0c\u6211\u4eec\u4f1a\u60f3\u5230\u7528\u524d\u7f00\u548c\u7684\u601d\u60f3\uff0c\u5bf9\u4e8e$i-j$\u7684\u4e32\uff0c\u5c06$hash[j]-hash[i-1]$\u4f5c\u4e3a\u5b83\u7684\u54c8\u5e0c\u503c\u6bd4\u8f83\u3002\n\u4f46\u8fd9\u6837\u663e\u7136\u662f\u9519\u8bef\u7684\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\n![](https://img2018.cnblogs.com/blog/1564177/201910/1564177-20191015203741468-540450391.png)\n\u54c8\u5e0c\u5c31\u662f\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u8fdb\u5236\u6570\uff0c\u5047\u8bbe\u6211\u4eec\u9009\u53d6\u5341\u8fdb\u5236\n\u90a3\u4e48\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e32$hash[i-1]=33,hash[j]=33568$\uff0c\u7b2c\u4e8c\u4e2a\u4e32$hash[j]=44568,hash[i-1]=44$\uff0c$i-j$\u7684\u4e32\u662f\u76f8\u7b49\u7684\uff0c\u4f46\u662f\u901a\u8fc7\u4e0a\u9762\u5f0f\u5b50\u8ba1\u7b97\u51fa\u6765\u7684\u503c\u663e\u7136\u4e0d\u76f8\u7b49\u3002\n\n\u8003\u8651\u5230\u524d\u7f00\u548c\u7684$O(1)$\u67e5\u8be2\u5b9e\u9645\u5c31\u662f\u6d88\u9664\u524d\u9762\u7684\u5f71\u54cd\uff0c$hash$\u662f\u4e00\u4e2a\u8fdb\u5236\u8f6c\u6362\u8fc7\u7a0b\uff0c\u6240\u4ee5\u6839\u636e\u4e58\u6cd5\u5206\u914d\u5f8b\u524d\u9762\u7684$hash[i-1]$\u5bf9\u540e\u9762\u7684\u5f71\u54cd\u5b9e\u9645\u662f$hash[i-1]*base^{j-i}$\uff0c\u6240\u4ee5$hash[j]-hash[i-1]*base^{j-i}$\u5c31\u662f$i-j$\u5355\u72ec\u7684\u54c8\u5e0c\u503c\uff0c\u76f4\u63a5\u62ff\u6765\u6bd4\u8f83\u5c31\u884c\u4e86\uff0c\u9700\u8981\u63d0\u524d\u9884\u5904\u7406$base$\u7684\u6b21\u65b9\u3002\n\n\u56de\u5230\u4e8c\u7ef4\u54c8\u5e0c\u7684\u95ee\u9898\uff0c\u4e0d\u96be\u60f3\u5230\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e2a$(1,1)-(i,j)$\u7684\u77e9\u9635\uff0c\u5148\u628a\u6bcf\u4e00\u884c\u7684\u54c8\u5e0c\u503c\u538b\u6210\u4e00\u4e2a\u6570\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u548c\u4e00\u7ef4\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u5c31\u662f\u5bf9\u539f\u6570\u7ec4\u7684\u8fdb\u5236\u8f6c\u6362\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u5217\u5c06\u538b\u7f29\u597d\u7684\u4fe1\u606f\u76f4\u63a5\u518d\u505a\u4e00\u6b21$hash$\uff0c\u6ce8\u610f\u8fd9\u4e00\u6b21\u4e0d\u7528\u7ba1\u539f\u6570\u7ec4\u4e86\uff0c\u6ce8\u610f\u4e24\u4e2a\u538b\u7f29\u8fc7\u7a0b\u5c3d\u91cf\u9009\u7528\u4e0d\u540c\u7684$base$\u6bd4\u5982$87$\u548c$312$\u3002\n\n\u5982\u4f55$O(1)$\u6c42\u4e00\u4e2a\u77e9\u9635\u7684\u54c8\u5e0c\u503c\uff1f\u8003\u8651\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u5148\u5bf9\u884c\u6d88\u53bb\u5f71\u54cd\uff0c\u518d\u5bf9\u5217\u6d88\u53bb\u5f71\u54cd\uff0c\u518d\u5bf9\u88ab\u91cd\u590d\u6d88\u53bb\u7684\u90e8\u5206\u5bb9\u65a5\n\u5373\n>$(x,y)-(i,j)$\u7684\u77e9\u9635\uff1a$hash[i][j]-hash[i][y-1]*base1^{j-y}-hash[x-1][j]*base2^{i-x}+hash[x-1][y-1]*base1^{j-y}*base2^{i-x}$\n\n\u4ee5\u4e0a\u5927\u529f\u544a\u6210\n\n\u518d\u56de\u5230\u672c\u9898\uff0c\u6211\u4eec\u5224\u65ad\u4e00\u4e2a\u6b63\u65b9\u5f62\u662f\u5426\u5bf9\u79f0\uff0c\u53ea\u9700\u8981\u9884\u5904\u7406\u6309\u7eb5\u8f74\u548c\u6309\u6a2a\u8f74\u7ffb\u8f6c\u7684\u4e24\u4e2a\u77e9\u9635\uff08\u76f8\u5f53\u4e8e\u955c\u50cf\uff0c\u5c06\u5b83\u7ffb\u8f6c\uff09\uff0c\u5728\u8fd9\u4e09\u4e2a\u77e9\u9635\u4e2d\u627e\u5230\u540c\u4e00\u4e2a\u6b63\u65b9\u5f62\u7684\u4f4d\u7f6e\u505a$hash$\uff0c\u5982\u679c\u4e09\u4e2a$hash$\u503c\u90fd\u4e00\u6837\u8bf4\u660e\u600e\u4e48\u7ffb\u8f6c\u8fd9\u4e2a\u6b63\u65b9\u5f62\u90fd\u5b8c\u5168\u91cd\u5408\uff0c\u4e5f\u5c31\u4e00\u5b9a\u662f\u5bf9\u79f0\u7684\u4e86\u3002\n\n\u4e07\u4e8b\u4ff1\u5907\u53ea\u6b20\u4e8c\u5206\uff0c\u53d1\u73b0\u6b63\u65b9\u5f62\u7684\u4e2d\u70b9\u53ef\u80fd\u843d\u5728\u6570\u5b57\u4e0a\u4e5f\u53ef\u80fd\u843d\u5728\u56db\u4e2a\u6570\u5b57\u4e4b\u95f4\u7684\u7a7a\u683c\u4e0a\uff0c\u5bf9\u4e8e\u8fd9\u4e24\u79cd\u60c5\u51b5\u5206\u522b\u5904\u7406\u3002\n\u626b\u5230\u6bcf\u4e00\u4e2a\u8fd9\u6837\u7684\u70b9\u5c31\u4e8c\u5206\u6b63\u65b9\u5f62\u8fb9\u957f\u7684\u4e00\u534a\uff0c\u7136\u540e\u54c8\u5e0c$check$\uff0c\u627e\u5230\u6700\u5927\u7684\u8fb9\u957f$x$\uff0c\u6613\u77e5\u4ee5\u8be5\u70b9\u4e3a\u4e2d\u5fc3\u7684\u6b63\u65b9\u5f62\u8fb9\u957f$<=mid$\u4e5f\u4e00\u5b9a\u5408\u6cd5\uff0c\u56e0\u6b64\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f$ans+=x$\u3002\n\n## \u518d\u603b\u7ed3\u4e00\u4e0b\u6d41\u7a0b\n1.\u9884\u5904\u7406\u4e24\u4e2a\u65b9\u5411\u7ffb\u8f6c\u7684\u4e8c\u7ef4\u6570\u7ec4\uff0c\u4ee5\u53ca\u5bf9\u8fd9\u4e09\u4e2a\u6570\u7ec4\u505a\u4e8c\u7ef4$hash$\n\n2.\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u4e8c\u5206\u6269\u5c55,\u5206\u4e2d\u70b9\u5728\u6570\u5b57\u4e0a\u548c\u4e2d\u70b9\u5728\u7a7a\u683c\u4e0a\u8003\u8651\uff0c\u627e\u5230\u6700\u5927\u8fb9\u957f$ans+=x$\n\n3.\u6700\u540e$ans+=m*n$\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5c0f\u6b63\u65b9\u5f62\u4e5f\u662f\u7b54\u6848\n\n\u603b\u590d\u6742\u5ea6$O(nmlogn)$\n\n\u6ce8\uff1a\u672c\u4eba\u6b64\u9898\u5f00$unsigned\\ long\\ long$\u81ea\u7136\u6ea2\u51fa\u4e0d\u53d6\u6a21\n\n\u66f4\u591a\u7ec6\u8282\u770b\u4ee3\u7801\n# $Code$\n```\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\n#include<cstring>\n#define re register\n#define int unsigned long long\n#define base1 87\n#define base2 312\nconst int maxn=1010;\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1; char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nint n,m,ans;\nint a[maxn][maxn],b[maxn][maxn],fac1[maxn],fac2[maxn];\nint bb[maxn][maxn],le[maxn][maxn],bbb[maxn][maxn],up[maxn][maxn];\nvoid copys()\n{\n\tfor(re int i=1;i<=n;++i) //\u590d\u5236\u5de6\u53f3\u98a0\u5012\u7684\u77e9\u9635 \n\t for(re int j=1;j<=m;++j)\n\t  bb[i][m-j+1]=b[i][j];\n\tfor(re int i=1;i<=n;++i)//\u590d\u5236\u4e0a\u4e0b\u98a0\u5012\u7684\u77e9\u9635 \n\t for(re int j=1;j<=m;++j)\n\t  bbb[n-i+1][j]=b[i][j];\n}\nvoid hasha()\n{\n\tfor(re int i=1;i<=n;++i)\n\t for(re int j=1;j<=m;++j)\n\t  a[i][j]=a[i][j-1]*base1+b[i][j];\n\tfor(re int i=1;i<=n;++i)\n\t for(re int j=1;j<=m;++j)\n\t  a[i][j]+=a[i-1][j]*base2;\n\tfor(re int i=1;i<=n;++i)\n\t for(re int j=1;j<=m;++j)\n\t  le[i][j]=le[i][j-1]*base1+bb[i][j];//\u6ce8\u610f\u8fd9\u91cc\u5408\u5e76\u4fe1\u606f \n\tfor(re int i=1;i<=n;++i)\n\t for(re int j=1;j<=m;++j)\n\t  le[i][j]+=le[i-1][j]*base2;//\u8fd9\u91cc\u76f4\u63a5\u5408\u5e76hash\u4e0d\u7528\u7ba1bb\u4e86 \n\tfor(re int i=1;i<=n;++i)\n\t for(re int j=1;j<=m;++j)\n\t  up[i][j]=up[i][j-1]*base1+bbb[i][j];\n\tfor(re int i=1;i<=n;++i)\n\t for(re int j=1;j<=m;++j) \n\t  up[i][j]+=up[i-1][j]*base2;\n}\ninline int check(int x,int y,int len)\n{\n    int yy=y;\n    //\u6ce8\u610funsigned\u6ca1\u6709\u8d1f\u6570\uff0c\u6240\u4ee5\u4e0d\u80fd\u5199x-len<0 \n    if(x>n||y>m||x<len||y<len) return 0;\n    int ans1=a[x][y]-a[x-len][y]*fac2[len]-a[x][y-len]*fac1[len]+a[x-len][y-len]*fac1[len]*fac2[len];\n    y=m-(y-len);//y-len\u662f\u5230\u6700\u4e0b\u89d2\uff0c\u7ffb\u8f6c\u8fc7\u53bb\u518d\u88abm-\u5c31\u662f\u53f3\u4e0b\u89d2\n\t//\u4e0d\u660e\u767d\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u624b\u63a8\u4e00\u4e0b \n    int ans2=le[x][y]-le[x-len][y]*fac2[len]-le[x][y-len]*fac1[len]+le[x-len][y-len]*fac2[len]*fac1[len];\n    y=yy;//\u8fd9\u91cc\u4e00\u5b9a\u8981\u590d\u539f\uff0c\u56e0\u4e3a\u6211\u4eec\u5904\u7406\u7684\u662f\u53ea\u6709\u4e0a\u4e0b\u98a0\u5012 \n    x=n-(x-len);\n    int ans3=up[x][y]-up[x-len][y]*fac2[len]-up[x][y-len]*fac1[len]+up[x-len][y-len]*fac1[len]*fac2[len];\n    if(ans1==ans2&&ans2==ans3) return 1;\n    return 0;\n}\nvoid work()\n{\n\tfor(re int i=1;i<n;++i)\n\t for(re int j=1;j<m;++j) \n\t {\n\t \tint l=0,r=n+1,sums=0;\n\t \twhile(l<=r)\n\t \t{\n\t \t\tint mid=(l+r)>>1;\n\t \t\tif(check(i+mid,j+mid,mid+mid))\n\t \t\t{\n\t \t\t\tif(mid) sums=mid;//\u8fd9\u662f\u5bf9\u4e8e\u4e2d\u5fc3\u5728\u7a7a\u683c\u4e0a\u7684\u60c5\u51b5 \n\t \t\t\tl=mid+1;\n\t\t\t}\n\t\t\telse r=mid-1;\n\t\t}\n\t\tans+=sums;\n\t }\n\tfor(re int i=1;i<n;++i)\n\t for(re int j=1;j<m;++j)\n\t {\n\t \tint  l=0,r=n+1,sums=0;\n\t \twhile(l<=r)\n\t \t{\n\t \t\tint mid=(l+r)>>1;\n\t \t\tif(check(i+mid,j+mid,mid+mid+1))\n\t \t\t{\n\t \t\t\tif(mid) sums=mid;\n\t \t\t\tl=mid+1; \n\t\t\t}\n\t\t\telse r=mid-1;\n\t\t}\n\t\tans+=sums;\n\t }\n\t ans+=n*m;//\u522b\u5fd8\u4e86\u52a0\u4e0a \n\treturn;\n}\nsigned main()\n{\n\tn=read(),m=read();\n\tfac1[0]=fac2[0]=1;//\u9884\u5904\u7406 \n\tfor(re int i=1;i<=n;++i) fac1[i]=fac1[i-1]*base1;\n\tfor(re int i=1;i<=m;++i) fac2[i]=fac2[i-1]*base2;\n\tfor(re int i=1;i<=n;++i)\n\t  for(re int j=1;j<=m;++j)\n\t    b[i][j]=read();\n    copys();\n    hasha();\n    work();\n    printf(\"%u\\n\",ans);\n\treturn 0;\n}\n```\n### \u58f0\u660e\uff1a\u672c\u849f\u84bb\u4ee3\u7801\u90e8\u5206\u6709\u53c2\u8003 @ \u6768\u94e0\u8fdc \u7684\u9898\u89e3\uff08\u56e0\u4e3a\u6211\u5f31\uff09",
        "postTime": 1571145252,
        "uid": 127018,
        "name": "ZORO",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2601 \u3010[ZJOI2009]\u5bf9\u79f0\u7684\u6b63\u65b9\u5f62\u3011"
    }
]