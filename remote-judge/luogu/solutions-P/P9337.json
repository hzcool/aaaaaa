[
    {
        "content": "boring.\n\n\u7b80\u5355\u53e3\u80e1\u4e00\u4e0b\u3002\u5f88\u660e\u663e\uff0c\u8fd9\u4e2a\u95ee\u9898\u5b58\u5728\u77e9\u4e58\u5f52\u7ea6\u3002\u8003\u8651\u6839\u53f7\u505a\u6cd5\u3002\n\n\u6570\u989c\u8272\u76f4\u63a5\u6839\u53f7\u5206\u6cbb\u3002\u5bf9\u4e8e $\\le B$ \u7684\u989c\u8272\uff0c\u679a\u4e3e\u989c\u8272\u5bf9\uff0c\u53d6\u51fa\u8fd9\u4e2a\u989c\u8272\u5bf9\u7684\u533a\u95f4\u4e2d\u7684 $\\min,\\max$\uff0c\u67e5\u8be2\u76f4\u63a5\u7528\u5206\u5757\u4e8c\u7ef4\u6570\u70b9\uff0c$O(nB+m\\sqrt n)$\u3002\u5bf9\u4e8e $>B$ \u7684\u989c\u8272\uff0c\u5bf9\u6bcf\u79cd\u989c\u8272\u505a\u4e00\u4e0b\u3002\u5c06\u76f8\u90bb\u4e24\u4e2a\u8be5\u989c\u8272\u4e4b\u95f4\u7684\u533a\u95f4\u7528\u5176 $\\min,\\max$ \u4ee3\u66ff\uff0c\u628a\u8be2\u95ee\u533a\u95f4\u79bb\u6563\u5316\u4e00\u4e0b\uff0c\u7136\u540e\u8dd1\u56de\u6eda\u83ab\u961f\u7528\u94fe\u8868\u7ef4\u62a4\u4e00\u4e0b\u3002\u5355\u4e2a\u989c\u8272\u590d\u6742\u5ea6\u662f $O(m+n'\\sqrt m)$\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(\\dfrac {nm} B+n\\sqrt m)$\u3002\u53d6 $B=\\sqrt m$ \u6709\u6700\u4f18\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt m+m\\sqrt n)$\u3002\n\n\u6211\u6709\u4e00\u70b9 interesting \u7684\u60f3\u6cd5\uff0c\u53ef\u60dc\u5730\u65b9\u592a\u5c0f\uff0c\u5199\u4e0d\u4e0b\u3002",
        "postTime": 1683598286,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u53e3\u80e1 P9337 [Ynoi2001] \u51b7\u305f\u3044\u90e8\u5c4b\u3001\u4e00\u4eba"
    },
    {
        "content": "\u9608\u503c\u5206\u6cbb\uff0c\u5bf9\u4e8e $a_i$ \u51fa\u73b0\u6b21\u6570 $\\leq B$ \u7684\u76f4\u63a5\u6c42\u51fa\u6bcf\u4e2a pair \u7684\u8d21\u732e\u7136\u540e\u505a\u4e8c\u7ef4\u6570\u70b9\u3002\n\n\u5bf9\u4e8e $a_i$ \u51fa\u73b0\u6b21\u6570 $>B$ \u7684\u76f4\u63a5\u5bf9\u4e8e\u6bcf\u79cd\u6570\u505a\u4e00\u904d\u56de\u6eda\u83ab\u961f\u7ef4\u62a4\u8fde\u7eed\u6bb5\u3002\n\n\u524d\u534a\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6 $O(nB+m\\sqrt n)$\uff0c\u540e\u534a\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\frac{nm}{B}+n\\sqrt m)$\u3002\n\n~~\u4ee3\u7801\u61d2\u5f97\u5199\u4e86\uff0c\u9000\u5f79\u4eba\u54ea\u6709\u7a7a\u5199\u4ee3\u7801\u3002~~\n\n\u5199\u5b8c\u4e86\u3002\n\n```cpp\n// Problem: P9337 [Ynoi2001] \u51b7\u305f\u3044\u90e8\u5c4b\u3001\u4e00\u4eba\n// Contest: Luogu\n// URL: https://www.luogu.com.cn/problem/P9337\n// Memory Limit: 512 MB\n// Time Limit: 4000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n//And from now on, YOU are my GUIDING STAR.\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nint a[500003],c[500003];\nint l2[500003],n=read(),m=read();\nvector<int> v[500003];\nint arr[2000003],L;\nbool flg[2000003];\nstruct query{int l,r,id;}q[500003],q0[500003];\nvector<pair<int,int>> vq[500003];\nstruct stmax\n{\n\tint st[500003][19];\n\tinline void init(int l)\n\t{\n\t\tst[l][0]=a[l];\n\t\tfor(int i=1; i<19; i++) \n\t\t\tst[l][i]=max(st[l][i-1],\n\t\t\tst[min(l+(1<<(i-1)),n)][i-1]);\n\t}\n\tinline int query(int l,int r)\n\t{\n\t\tint L=l2[r-l+1];\n\t\treturn max(st[l][L],st[min(r-(1<<L)+1,n)][L]);\n\t}\n\tvoid main()\n\t{\n\t\tfor(int i=n; i; --i) init(i);\n\t\treturn ;\n\t}\n}S1;\nstruct stmin\n{\n\tint st[500003][19];\n\tinline void init(int l)\n\t{\n\t\tst[l][0]=a[l];\n\t\tfor(int i=1; i<19; i++) \n\t\t\tst[l][i]=min(st[l][i-1],\n\t\t\tst[min(l+(1<<(i-1)),n)][i-1]);\n\t}\n\tinline int query(int l,int r)\n\t{\n\t\tint L=l2[r-l+1];\n\t\treturn min(st[l][L],st[min(r-(1<<L)+1,n)][L]);\n\t}\n\tvoid main()\n\t{\n\t\tfor(int i=n; i; --i) init(i);\n\t\treturn ;\n\t}\n}S0;\nstruct BIT\n{\n\tint pre0[500003],pre1[503];\n\tinline void add(int x)\n\t{\n\t\t++pre0[x],++pre1[x>>10];\n\t\treturn ;\n\t}\n\tinline int find(int x)\n\t{\n\t\tint res=0;\n\t\tfor(int i=(x>>10)<<10; i<=x; ++i) res+=pre0[i];\n\t\tfor(int i=0; i<(x>>10); ++i) res+=pre1[i];\n\t\treturn res;\n\t}\n}T;\nconst int B=2000;\nll ans[500003];\nvector<int> pos[500003];\nint to_[500003],val_[500003],top;\nint to[500003],val[500003],buc[500003];\nint ta[500003],lsh[500003],inv[500003];\nbool tf[500003];\nstruct range{int fi,se,id;}rg[500003],stk[1000003];\nsigned main()\n{\n\tfor(int i=2; i<=n; i++) l2[i]=l2[i>>1]+1;\n\tfor(int i=1; i<=n; ++i) c[i]=read(),v[c[i]].push_back(i);\n\tfor(int i=1; i<=n; ++i) a[i]=read();\n\tfor(int i=1; i<=m; ++i)\n\t\trg[i].fi=read(),rg[i].se=read(),rg[i].id=i,\n\t\tvq[rg[i].fi].emplace_back(rg[i].se,i);\n\tS0.main(),S1.main(),sort(rg+1,rg+m+1,\n\t[&](auto x,auto y){return x.se<y.se;});\n\tfor(int i=1; i<=n; ++i)\n\t{\n\t\tint sz=v[i].size();\n\t\tif(sz>=B)\n\t\t{\n\t\t\tint N=0,M=0;\n\t\t\tmemset(buc,0,sizeof(buc));\n\t\t\tfor(int j=0; j<sz; ++j)\n\t\t\t{\n\t\t\t\tta[++N]=a[v[i][j]],tf[N]=1;\n\t\t\t\tif(j+1<sz&&v[i][j]+1<v[i][j+1])\n\t\t\t\t{\n\t\t\t\t\tta[++N]=S0.query(v[i][j]+1,v[i][j+1]-1),tf[N]=0;\n\t\t\t\t\tif(v[i][j]+2<v[i][j+1])\n\t\t\t\t\tta[++N]=S1.query(v[i][j]+1,v[i][j+1]-1),tf[N]=0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(int j=1; j<=N; ++j) lsh[j]=ta[j],++buc[ta[j]];\n\t\t\tfor(int j=1; j<=n; ++j) buc[j]+=buc[j-1];\n\t\t\tsort(lsh+1,lsh+N+1);\n\t\t\tfor(int j=1; j<=N; ++j)\n\t\t\t\tta[j]=lower_bound(lsh+1,lsh+N+1,ta[j])-lsh,\n\t\t\t\tinv[ta[j]]=j;\n\t\t\tfor(int j=1; j<=m; ++j)\n\t\t\t{\n\t\t\t\t++M,q0[M].l=buc[rg[j].fi-1]+1,\n\t\t\t\tq0[M].r=buc[rg[j].se],q0[M].id=rg[j].id;\n\t\t\t\tif(q0[M].l>q0[M].r) --M;\n\t\t\t}\n\t\t\tif(!M) continue;\n\t\t\tint C=.7*N/sqrt(M)+1;\n\t\t\tmemset(buc,0,sizeof(buc));\n\t\t\tfor(int j=1; j<=M; ++j) ++buc[q0[j].l/C];\n\t\t\tfor(int j=1; j<=N; ++j) buc[j]+=buc[j-1];\n\t\t\tfor(int j=M; j>=1; --j) q[buc[q0[j].l/C]--]=q0[j];\n\t\t\tll sum=0;\n\t\t\tmemset(to,0,(N+2)<<2),memset(val,0,(N+2)<<2);\n\t\t\tfor(int j=1,tl=C,tr=C-1; j<=M; ++j)\n\t\t\t{\n\t\t\t\tif(q[j].l/C!=q[j-1].l/C)\n\t\t\t\t\tmemset(to,0,(N+2)<<2),\n\t\t\t\t\tmemset(val,0,(N+2)<<2),\n\t\t\t\t\ttl=(q[j].l/C+1)*C,tr=tl-1,sum=0;\n\t\t\t\tif(q[j].l/C==q[j].r/C)\n\t\t\t\t{\n\t\t\t\t\tll sum_=0;\n\t\t\t\t\tfor(int k=q[j].l; k<=q[j].r; ++k)\n\t\t\t\t\t{\n\t\t\t\t\t\tint l=inv[k],r=inv[k],sv=tf[inv[k]];\n\t\t\t\t\t\tif(to_[l-1])\n\t\t\t\t\t\t\tsum_-=1ll*val_[to_[l-1]]*\n\t\t\t\t\t\t\t(val_[to_[l-1]]-1),\n\t\t\t\t\t\t\tsv+=val_[to_[l-1]],l=to_[l-1];\n\t\t\t\t\t\tif(to_[r+1])\n\t\t\t\t\t\t\tsum_-=1ll*val_[r+1]\n\t\t\t\t\t\t\t*(val_[r+1]-1),\n\t\t\t\t\t\t\tsv+=val_[r+1],r=to_[r+1];\n\t\t\t\t\t\tsum_+=1ll*sv*(sv-1),\n\t\t\t\t\t\tto_[l]=r,to_[r]=l,val_[l]=sv;\n\t\t\t\t\t}\n\t\t\t\t\tfor(int k=q[j].l; k<=q[j].r; ++k)\n\t\t\t\t\t\tto_[inv[k]]=val_[inv[k]]=0;\n\t\t\t\t\tans[q[j].id]+=sum_>>1;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\twhile(tr<q[j].r)\n\t\t\t\t{\n\t\t\t\t\tint k=++tr,l=inv[k],r=inv[k],sv=tf[inv[k]];\n\t\t\t\t\tif(to[l-1])\n\t\t\t\t\t\tsum-=1ll*val[to[l-1]]*\n\t\t\t\t\t\t(val[to[l-1]]-1),\n\t\t\t\t\t\tsv+=val[to[l-1]],l=to[l-1];\n\t\t\t\t\tif(to[r+1])\n\t\t\t\t\t\tsum-=1ll*val[r+1]\n\t\t\t\t\t\t*(val[r+1]-1),\n\t\t\t\t\t\tsv+=val[r+1],r=to[r+1];\n\t\t\t\t\tsum+=1ll*sv*(sv-1),\n\t\t\t\t\tto[l]=r,to[r]=l,val[l]=sv;\n\t\t\t\t}\n\t\t\t\tll tsum=sum;\n\t\t\t\tfor(int k=tl-1; k>=q[j].l; --k)\n\t\t\t\t{\n\t\t\t\t\tint l=inv[k],r=inv[k],sv=tf[inv[k]];\n\t\t\t\t\tif(to[l-1])\n\t\t\t\t\t\ttsum-=1ll*val[to[l-1]]*\n\t\t\t\t\t\t(val[to[l-1]]-1),\n\t\t\t\t\t\tsv+=val[to[l-1]],l=to[l-1];\n\t\t\t\t\tif(to[r+1])\n\t\t\t\t\t\ttsum-=1ll*val[r+1]\n\t\t\t\t\t\t*(val[r+1]-1),\n\t\t\t\t\t\tsv+=val[r+1],r=to[r+1];\n\t\t\t\t\ttsum+=1ll*sv*(sv-1),\n\t\t\t\t\tstk[++top]={to[l],val[l],l},\n\t\t\t\t\tto[l]=r,val[l]=sv,\n\t\t\t\t\tstk[++top]={to[r],val[r],r},\n\t\t\t\t\tto[r]=l;\n\t\t\t\t}\n\t\t\t\twhile(top)\n\t\t\t\t\tto[stk[top].id]=stk[top].fi,\n\t\t\t\t\tval[stk[top].id]=stk[top].se,--top;\n\t\t\t\tans[q[j].id]+=tsum>>1;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor(int j=0; j<sz; ++j)\n\t\t\t{\n\t\t\t\tarr[++L]=a[v[i][j]],flg[L]=1,\n\t\t\t\tpos[arr[L]].push_back(L);\n\t\t\t\tif(j+1<sz&&v[i][j]+1<v[i][j+1])\n\t\t\t\t{\n\t\t\t\t\tarr[++L]=S0.query(v[i][j]+1,v[i][j+1]-1),\n\t\t\t\t\tpos[arr[L]].push_back(L);\n\t\t\t\t\tif(v[i][j]+2<v[i][j+1])\n\t\t\t\t\t\tarr[++L]=S1.query(v[i][j]+1,v[i][j+1]-1),\n\t\t\t\t\t\tpos[arr[L]].push_back(L);\n\t\t\t\t}\n\t\t\t}\n\t\t\tarr[++L]=0;\t\n\t\t}\n\t}\n\tfor(int i=n; i>=1; --i)\n\t{\n\t\tfor(int j:pos[i])\n\t\t{\n\t\t\tfor(int l=j,v=arr[j]; arr[l]>=arr[j];\n\t\t\t\tv=max(v,arr[--l])) if(flg[l])\n\t\t\tfor(int r=j,w=v; r==j||arr[r]>arr[j];\n\t\t\t\tw=max(w,arr[++r])) if(flg[r]&&l<r) T.add(w);\n\t\t}\n\t\tfor(auto [j,k]:vq[i])\n\t\t\tans[k]+=T.find(j);\n\t}\n\tfor(int i=1; i<=m; ++i) printf(\"%lld\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1683636303,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P9337"
    },
    {
        "content": "[\u9898\u4f20](https://www.luogu.com.cn/problem/P9337)\n\n\u7b80\u5316\u9898\u610f\uff1a\u591a\u6b21\u8be2\u95ee\uff0c\u4fdd\u7559\u7b2c\u4e8c\u5173\u952e\u5b57 $y \\in[l, r]$ \u7684\u5143\u7d20\uff0c\u8be2\u95ee\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u5185\u5173\u4e8e\u6bcf\u79cd\u989c\u8272\u6570\u7684 2 \u6b21\u591a\u9879\u5f0f\u7684\u548c\u7684\u548c\u3002\n\n\u8003\u8651\u964d\u4f4e\u95ee\u9898\u81ea\u7531\u5ea6\uff0c\u6309\u989c\u8272 $a$ \u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c\u539f\u5e8f\u5217\u4e0b\u6807\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u6765\u91cd\u6392\u5e8f\u5217\uff0c\u8bbe $b_{i}^{c}$  \u65b0\u5e8f\u5217\u5bf9\u5e94\u539f\u5e8f\u5217\u7684\u4e0b\u6807\uff0c\u5176\u4e2d $c=a_{b_{i}}$\u3002\n\n\u5728\u4e00\u6b21\u8be2\u95ee\u91cc\uff0c\u6211\u4eec\u79f0\u4e00\u4e2a\u5143\u7d20 $b_{i}^{c}$ \u88ab\u201d\u4fdd\u7559\u201c\u5f53\u4e14\u4ec5\u5f53\uff1a\n\n1. $\\exists b_{j}^{c}(i<j)$\uff0c\u5373 $b_{i}^{c}$ \u4e0d\u662f\u6700\u540e\u4e00\u4e2a $a=c$ \u7684\u5143\u7d20\n2. $\\forall j\\in [b^{c}_{i}, b_{i+1}^{c}], y_{j} \\in [l, r]$\n\n\u6211\u4eec\u4ee5\u4e22\u6389\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\u7684\u4ee3\u4ef7\uff0c\u628a\u989c\u8272\u8fd9\u4e00\u81ea\u7531\u5ea6\u7ed9\u53bb\u6389\u4e86\uff0c\u90a3\u4e48\u73b0\u5728\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u7684\u8d21\u732e\u5e94\u8be5\u662f\u662f $\\frac{len(len+1)}{2}$\u3002\n\n\u73b0\u5728\u7684\u8be2\u95ee\u5c31\u53d8\u6210\u4e86\uff1a\u6bcf\u4e2a\u4f4d\u7f6e $i$ \u6709\u4e00\u4e2a\u9650\u5236\u533a\u95f4 $[x_{i}, y_{i}]$\uff0c\u6bcf\u6b21\u8be2\u95ee $[l, r]$\uff0c\u4fdd\u7559\u9650\u5236\u533a\u95f4\u4e3a\u8be2\u95ee\u533a\u95f4\u5b50\u533a\u95f4\u7684\u5143\u7d20\uff0c\u8ba1\u7b97\u8fde\u7eed\u6bb5\u7684\u8d21\u732e\u3002\n\n\u8003\u8651\u5bf9 $b$ \u5206\u5757\uff0c\u8bbe\u5757\u957f\u4e3a $B$\uff0c\u4e00\u4e2a\u5757\u5185\u6709\u6548\u5de6\u53f3\u7aef\u70b9\u53ea\u6709 $O(B)$ \u4e2a\uff0c\u79bb\u6563\u5316\u540e\uff0c\u679a\u4e3e\u672c\u8d28\u4e0d\u540c\u7684\u8be2\u95ee\u533a\u95f4\uff0c\u62d3\u5c55\u65f6\u52a0\u5165\u6bcf\u4e2a\u70b9\uff0c\u62ff\u5e76\u67e5\u96c6\u7b97\u7b97\u8d21\u732e\u5c31\u53ef\u4ee5\u9884\u5904\u7406\u5f97\u5230\u5bf9\u4e8e\u5355\u72ec\u5757\u7684\u8be2\u95ee $[a, b]$ \u7684\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee\uff0c\u9700\u8981\u8ba1\u7b97\u5757\u4e0e\u5757\u4e4b\u95f4\u7684\u8d21\u732e\uff0c\u6ce8\u610f\u53ea\u6709\u524d\u7f00/\u540e\u7f00\u4f1a\u6539\u53d8\uff0c\u8fd9\u4e2a\u5728\u9884\u5904\u7406\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u5f97\u5230\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nB+m(\\frac{n}{B}+B))$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(nB)$\uff0c\u53d6 $B=\\sqrt{\\frac{mn}{m+n}}$\uff0c\u7406\u8bba\u6700\u4f18\u3002\n\n\u7a7a\u95f4\u7701\u7740\u70b9\u5f00\u3002\u3002\n\n\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7\u79bb\u7ebf\u7684\u65b9\u5f0f\u5c06\u7a7a\u95f4\u53d8\u6210\u7ebf\u6027\uff0c\u4f46\u90fd\u9000\u5f79\u4e86\u4e3a\u4ec0\u4e48\u8981\u6298\u78e8\u81ea\u5df1\u5462\uff1f\n\n\u4ee3\u7801\u5495\u5495.jpg",
        "postTime": 1685160702,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "P9337 [Ynoi2001] \u51b7\u305f\u3044\u90e8\u5c4b\u3001\u4e00\u4eba"
    }
]