[
    {
        "content": "upd: \u5728\u770b\u4e86 SF \u7684\u6587\u7ae0\u540e\u4fee\u4e86\u4fee\u683c\u5f0f\uff1b\u53e6\u5916\u9898\u89e3\u7684\u6e32\u67d3\u771f\u7684\u5f88\u4e11\u3002\u3002\u3002\u5efa\u8bae\u70b9\u51fb \u201c\u5728 Ta \u7684\u535a\u5ba2\u67e5\u770b\u201d\u3002\n\n## Solution\n\u7528\u6781\u89d2\u505a\u771f\u7684\u66f4\u7b80\u5355\u8bf6\u3002\u3002\u3002  \n\u5728\u672c\u9898\u89e3\u4e2d\uff0c\u6781\u89d2\u7684\u503c\u57df\u9ed8\u8ba4\u4e3a $(-\\pi,\\pi]$\u3002  \n#### \u5e73\u9762\u955c\n\u8bbe\u4e24\u4e2a\u7aef\u70b9\u6781\u89d2\u4e3a $\\alpha,\\ \\beta(\\alpha < \\beta)$.  \n$\\because$ \u5e73\u9762\u955c\u4e0d\u7ecf\u8fc7\u539f\u70b9  \n$\\therefore$ $\\beta - \\alpha \\neq \\pi$  \n\u5982\u679c $\\beta - \\alpha > \\pi$, \u8bf4\u660e\u5e73\u9762\u955c\u8de8\u8fc7\u5c04\u7ebf $\\theta = \\pi$,\u5c31\u5bf9\u5e94\u4e24\u6bb5 $[-\\pi,\\alpha]$\u3001$[\\beta,\\pi]$\u3002  \n\u5426\u5219\u5bf9\u5e94\u4e00\u6bb5 $[\\alpha,\\beta]$\u3002  \n#### \u5c04\u7ebf\n\u663e\u7136\uff0c\u82e5\u8bbe $(x,y)$ \u6781\u89d2\u4e3a $\\varphi$ , \u5219\u5bf9\u5e94\u533a\u95f4 $[\\varphi,\\varphi]$\u3002\n#### \u7efc\u4e0a\n- opt = 1: \u533a\u95f4 $[\\alpha',\\beta']$ \u589e\u52a0 $v$\n- opt = 2: \u533a\u95f4$[\\alpha',\\beta']$ \u51cf\u5c11 $v$\n- opt = 3: \u67e5\u8be2\u533a\u95f4 $[\\alpha',\\alpha']$ \u7684 $\\max$\n- opt = 4: \u67e5\u8be2\u533a\u95f4 $[\\alpha',\\beta']$ \u7684 $\\max$  \n\n\u5177\u4f53\u5b9e\u73b0\u5148\u5c06\u8f93\u5165\u4e2d\u51fa\u73b0\u7684\u6781\u89d2\u96c6\u5408 $S$ \u79bb\u6563\u5316\uff0c\u518d\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u52a0\u3001\u533a\u95f4\u6c42 $\\max$ \u5c31\u597d\u4e86\u3002\n#### \u6d6e\u70b9\u8bef\u5dee\n$\\because |x|,|y| <= 10^5$\uff0c\u8f93\u5165\u4e2d\u90fd\u662f\u6574\u70b9   \n$\\therefore$ $\\forall \\alpha,\\beta \\in S(\\alpha \\neq \\beta),$ \u6709 $|\\alpha - \\beta| \\geq \\frac{\\pi}{4} - \\arctan(1 - 10^{-5}) \\approx 5.1 \\times 10^{-6}$.  \n$\\therefore$ \u79bb\u6563\u5316\u89d2\u5ea6\u65f6\u53d6EPS = $10^{-10}$ \u8db3\u591f\uff08\u5176\u5b9e\u5373\u4f7f\u4e0d\u7528EPS\u4e5f\u80fd\u8fc7qwq)\u3002\n## Code\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <cmath>\n#include <vector>\n#include <queue>\n#include <utility>\n\nusing namespace std;\ntypedef long long ll;\nconst int LEN = 100000;\n\nstruct fastio{\n  int it,len;\n  char s[LEN + 5];\n  fastio(){\n    it = len = 0;\n  }\n  char get(){\n    if(it < len) return s[it++];\n    it = 0, len = fread(s,1,LEN,stdin);\n    return len ? s[it++] : EOF;\n  }\n  bool notend(){\n    char c;\n    for(c = get();c == ' ' || c == '\\n';c = get());\n    if(it) it--;\n    return c != EOF;\n  }\n  void put(char c){\n    if(it == LEN) fwrite(s,1,LEN,stdout), it = 0;\n    s[it++] = c;\n  }\n  void flush(){\n    fwrite(s,1,it,stdout);\n  }\n}buff,bufo;\ninline int getint(){\n  char c; int res = 0, sig = 1;\n  for(c = buff.get();c < '0' || c > '9';c = buff.get()) if(c == '-') sig = -1;\n  for(;c >= '0' && c <= '9';c = buff.get()) res = res * 10 + (c - '0');\n  return sig * res;\n}\ninline ll getll(){\n  char c; ll res = 0, sig = 1;\n  for(c = buff.get();c < '0' || c > '9';c = buff.get()) if(c == '-') sig = -1;\n  for(;c >= '0' && c <= '9';c = buff.get()) res = res * 10 + (c - '0');\n  return sig * res;\n}\ninline void putint(int x,char suf){\n  if(!x) bufo.put('0');\n  else{\n    if(x < 0) bufo.put('-'), x = -x;\n    int k = 0; char s[15];\n    while(x){\n      s[++k] = x % 10 + '0';\n      x /= 10;\n    }\n    for(;k;k--) bufo.put(s[k]);\n  }\n  bufo.put(suf);\n}\ninline void putll(ll x,char suf){\n  if(!x) bufo.put('0');\n  else{\n    if(x < 0) bufo.put('-'), x = -x;\n    int k = 0; char s[25];\n    while(x){\n      s[++k] = x % 10 + '0';\n      x /= 10;\n    }\n    for(;k;k--) bufo.put(s[k]);\n  }\n  bufo.put(suf);\n}\ninline char get_char(){\n  char c;\n  for(c = buff.get();c == ' ' || c == '\\n';c = buff.get());\n  return c;\n}\n#define maxn 200005\nconst double pi = acos(-1);\nstruct Query{\n  int opt,x0,y0,x2,y2,v;\n  // opt = 2: v = d\n  // opt = 3: (x0,y0) = (x,y)\n  // opt = 4: v = d\n}qs[maxn];\nint id[maxn],num;\nint n,len;\nvector <double> thetas;\nstruct Sgt{\n  int maxi[maxn << 3],add[maxn << 3];\n  void up(int id){\n    maxi[id] = max(maxi[id << 1],maxi[id << 1 | 1]);\n    maxi[id] += add[id];\n  }\n  void down(int id){\n    if(add[id]){\n      maxi[id << 1] += add[id];\n      add[id << 1] += add[id];\n      maxi[id << 1 | 1] += add[id];\n      add[id << 1 | 1] += add[id];\n      add[id] = 0;\n    }\n  }\n  void _plus(int id,int l,int r,int ql,int qr,int x){\n    if(ql <= l && r <= qr){\n      maxi[id] += x;\n      add[id] += x;\n    }else{\n      down(id);\n      int mid = (l + r) >> 1;\n      if(ql <= mid) _plus(id << 1,l,mid,ql,qr,x);\n      if(mid < qr) _plus(id << 1 | 1,mid + 1,r,ql,qr,x);\n      up(id);\n    }\n  }\n  int query(int id,int l,int r,int ql,int qr){\n    if(ql <= l && r <= qr) return maxi[id];\n    down(id);\n    int mid = (l + r) >> 1, res = 0;\n    if(ql <= mid) res = max(res,query(id << 1,l,mid,ql,qr));\n    if(mid < qr) res = max(res,query(id << 1 | 1,mid + 1,r,ql,qr));\n    return res;\n  }\n}sgt;\nvoid range_add(double a,double b,int v){\n  if(a > b) swap(a,b);\n  int id_a = lower_bound(thetas.begin(),thetas.end(),a) - thetas.begin() + 1,\n      id_b = lower_bound(thetas.begin(),thetas.end(),b) - thetas.begin() + 1;\n  if(b - a > pi){\n    sgt._plus(1,1,len,1,id_a,v);\n    sgt._plus(1,1,len,id_b,len,v);\n  }else{\n    sgt._plus(1,1,len,id_a,id_b,v);\n  }\n}\nint query_max(double a,double b){\n  if(a > b) swap(a,b);\n  int id_a = lower_bound(thetas.begin(),thetas.end(),a) - thetas.begin() + 1,\n      id_b = lower_bound(thetas.begin(),thetas.end(),b) - thetas.begin() + 1;\n  if(b - a > pi)\n    return max(sgt.query(1,1,len,1,id_a),sgt.query(1,1,len,id_b,len));\n  return sgt.query(1,1,len,id_a,id_b);\n}\nint main(){\n  n = getint();\n  thetas.push_back(-pi);\n  thetas.push_back(pi);\n  for(int i = 1;i <= n;i++){\n    qs[i].opt = getint();\n    if(qs[i].opt == 1){\n      id[++num] = i;\n      qs[i].x0 = getint(), qs[i].y0 = getint(),\n      qs[i].x2 = getint(), qs[i].y2 = getint(), qs[i].v = getint();\n      thetas.push_back(atan2(qs[i].y0,qs[i].x0)),\n      thetas.push_back(atan2(qs[i].y2,qs[i].x2));\n    }else if(qs[i].opt == 2){\n      qs[i].v = getint();\n    }else if(qs[i].opt == 3){\n      qs[i].x0 = getint(), qs[i].y0 = getint();\n      thetas.push_back(atan2(qs[i].y0,qs[i].x0));\n    }else{\n      qs[i].v = getint();\n    }\n  }\n  sort(thetas.begin(),thetas.end());\n  thetas.erase(unique(thetas.begin(),thetas.end()),thetas.end());\n  len = thetas.size();\n  for(int i = 1;i <= n;i++){\n    if(qs[i].opt == 1){\n      range_add(atan2(qs[i].y0,qs[i].x0),atan2(qs[i].y2,qs[i].x2),qs[i].v);\n    }else if(qs[i].opt == 2){\n      int j = id[qs[i].v];\n      range_add(atan2(qs[j].y0,qs[j].x0),atan2(qs[j].y2,qs[j].x2),-qs[j].v);\n      id[qs[i].v] = -1;\n    }else if(qs[i].opt == 3){\n      printf(\"%d\\n\",\n        query_max(atan2(qs[i].y0,qs[i].x0),atan2(qs[i].y0,qs[i].x0)));\n    }else{\n      int j = id[qs[i].v];\n      if(j == -1) puts(\"oops!\");\n      else{\n        printf(\"%d\\n\",\n          query_max(atan2(qs[j].y0,qs[j].x0),atan2(qs[j].y2,qs[j].x2)));\n      }\n    }\n  }\n  return 0;\n}\n```\nRunID: [28847331](https://www.luogu.com.cn/record/28847331)\uff0c\u8dd1\u7684\u8fd8\u633a\u5feb\u3002\u3002\u3002",
        "postTime": 1577589881,
        "uid": 53793,
        "name": "caeious",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5859 \u3010\u300cSWTR-03\u300dPlane Mirrors\u3011"
    },
    {
        "content": "$\\color{#9400d3}\\mathrm{This\\ is\\ Sweet\\ Round\\ 03.}$\n\n[$\\color{#9400d3}\\mathrm{Link:T5\\ Plane\\ Mirrors}$](https://www.luogu.com.cn/problem/T112464)\n\n\u57fa\u7840\u6570\u636e\u7ed3\u6784 $+$ \u8ba1\u7b97\u51e0\u4f55\u3002\n\n---\n\n$\\mathrm{Sol\\ 1}:$\n\n\u5bf9\u4e8e\u6bcf\u4e2a $3$ \u8be2\u95ee\uff0c\u66b4\u529b\u679a\u4e3e\u6240\u6709\u5e73\u9762\u955c\uff0c\u5224\u65ad\u662f\u5426\u5728\u8be5\u5c04\u7ebf\u4e0a\u3002\n\n#### \u5982\u4f55\u5224\u65ad\u5c04\u7ebf\u662f\u5426\u5728\u5e73\u9762\u955c\u4e0a\uff1f\n\n\u6211\u4eec\u8bbe $r_1=\\dfrac{y_1}{x_1},r_2=\\dfrac{y_2}{x_2},r=\\dfrac{y}{x}$\u3002\u5982\u679c $x=0$\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a $r$ \u770b\u6210\u4e00\u4e2a\u5f88\u5927\u7684\u6570\uff0c\u4f8b\u5982 $10^9+7$\u3002\n\n- \u5982\u679c\u8be5\u5e73\u9762\u955c\u6ca1\u6709\u7a7f\u8fc7 $y$ \u8f74\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/47lvdbc5.png)\n\n\u5982\u56fe\uff0c\u4e0d\u59a8\u8bbe $r_1\\leq r_2$\uff0c\u5982\u679c $r_1\\leq r\\leq r_2$\uff0c\u90a3\u4e48\u8be5\u5c04\u7ebf\u5c31\u7a7f\u8fc7\u4e86\u8be5\u5e73\u9762\u955c\uff08\u56fe\u4e2d $r_1=-0.56,r=3.12,r_2=5.789$\uff09\u3002\n\n- \u5982\u679c\u8be5\u5e73\u9762\u955c\u7a7f\u8fc7\u4e86 $y$ \u8f74\uff1a\n\n\u4e0d\u59a8\u8bbe $x_1<0,x_2\\ge0$\u3002\u8ba1\u7b97\u51fa\u8be5\u5e73\u9762\u955c\u4e0e $y$ \u8f74\u7684\u4ea4\u70b9 $P(x_P,y_P)$\uff0c\u7136\u540e\u628a\u5e73\u9762\u955c\u4ece\u8be5\u70b9\u65ad\u5f00\uff0c\u62c6\u6210\u4e24\u4e2a\u6ca1\u6709\u7a7f\u8fc7 $y$ \u8f74\u7684\u5e73\u9762\u955c\uff0c\u518d\u5224\u65ad\u5373\u53ef\u3002\n\n- \u5982\u4f55\u8ba1\u7b97\u5e73\u9762\u955c\u4e0e $y$ \u8f74\u7684\u4ea4\u70b9\uff1f\n\n\u5c06\u8be5\u5e73\u9762\u955c\u770b\u6210\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570\uff0c\u7528\u5e73\u9762\u955c\u4e24\u4e2a\u7aef\u70b9\u8ba1\u7b97\u51fa\u51fd\u6570\u8868\u8fbe\u5f0f\uff0c\u518d\u6c42\u51fa $x=0$ \u65f6 $y$ \u7684\u503c\u5373\u53ef\u3002\n\n```cpp\n#define ld long double\nld zero(ld x1,ld y1,ld x2,ld y2){\n\tld k=(y1-y2)/(x1-x2),b=y1-k*x1;\n\treturn b;\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n^2)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7\u6d4b\u8bd5\u70b9 $1-4$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$20\\%$\u3002\n\n```cpp\n#include<iostream>\nusing namespace std;\n#define ld long double\nconst int N=1e3+5;\nconst ld inf=1e9;\nint n,cnt;\nstruct Plane_Mirror{\n\tint x1,x2,y1,y2,v,pd;\n}c[N];\nld ratio(ld x,ld y){\n\tif(x==0)return y>0?inf:-inf;\n\telse return y/x;\n}\nld zero(ld x1,ld y1,ld x2,ld y2){\n\tld k=(y1-y2)/(x1-x2),b=y1-k*x1;\n\treturn b;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++){\n\t\tint op;\n\t\tscanf(\"%d\",&op);\n\t\tif(op==1){\n\t\t\tcnt++;\n\t\t\tscanf(\"%d%d%d%d%d\",&c[cnt].x1,&c[cnt].y1,&c[cnt].x2,&c[cnt].y2,&c[cnt].v);\n\t\t}\n\t\tif(op==2){\n\t\t\tint d;\n\t\t\tscanf(\"%d\",&d);\n\t\t\tc[d].pd=1;\n\t\t}\n\t\tif(op==3){\n\t\t\tint x,y,ans=0;\n\t\t\tscanf(\"%d%d\",&x,&y);\n\t\t\tld r=ratio(x,y);\n\t\t\tfor(int j=1;j<=cnt;j++)\n\t\t\t\tif(!c[j].pd){\n\t\t\t\t\tint x1=c[j].x1,y1=c[j].y1,x2=c[j].x2,y2=c[j].y2;\n\t\t\t\t\tld r1=ratio(x1,y1),r2=ratio(x2,y2);\n\t\t\t\t\tif(x1>=0&&x2>=0){\n\t\t\t\t\t\tif(x<0)continue;\n\t\t\t\t\t\tif(r1>r2)swap(r1,r2);\n\t\t\t\t\t\tif(r1<=r&&r<=r2)ans+=c[j].v;\n\t\t\t\t\t}\n\t\t\t\t\telse if(x1<0&&x2<0){\n\t\t\t\t\t\tif(x>=0)continue;\n\t\t\t\t\t\tif(r1>r2)swap(r1,r2);\n\t\t\t\t\t\tif(r1<=r&&r<=r2)ans+=c[j].v;\n\t\t\t\t\t}\n\t\t\t\t\telse if(x1>=0&&x2<0){\n\t\t\t\t\t\tld cont=zero(x1,y1,x2,y2);\n\t\t\t\t\t\tif(x<0&&(cont>0&&r<=r2||cont<0&&r2<=r))ans+=c[j].v;\n\t\t\t\t\t\tif(x>=0&&(cont>0&&r1<=r||cont<0&&r<=r1))ans+=c[j].v;\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tld cont=zero(x1,y1,x2,y2);\n\t\t\t\t\t\tif(x<0&&(cont>0&&r<=r1||cont<0&&r1<=r))ans+=c[j].v;\n\t\t\t\t\t\tif(x>=0&&(cont>0&&r2<=r||cont<0&&r<=r2))ans+=c[j].v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tcout<<ans<<endl;\n\t\t}\n\t}\n    return 0;\n}\n```\n\n\n---\n\n$\\mathrm{Sol\\ 2}:$\n\n\u89c2\u5bdf\u5230\u6d4b\u8bd5\u70b9 $5-8$ \u4e2d\u6240\u6709 $y$ \u76f8\u7b49\u3002\n\n\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u52a0\u6cd5\u4e0e\u533a\u95f4\u6c42\u6700\u5927\u503c\u5373\u53ef\uff0c\u751a\u81f3\u8fde\u79bb\u6563\u5316\u90fd\u4e0d\u9700\u8981\u3002\u4e3a\u4e86\u907f\u514d\u8bbf\u95ee\u5230\u8d1f\u6570\u4e0b\u6807\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709 $x$ \u52a0\u4e0a $10^5+1$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n\\log n)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7\u6d4b\u8bd5\u70b9 $5-8$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$20\\%$\uff0c\u7ed3\u5408 $\\mathrm{Sol\\ 1}$ \u53ef\u5f97 $40\\%$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int N=1e5+5;\nstruct Plane{\n\tint a,b,c,d,v;\n}p[N<<2];\nstruct Seg_Tree{\n\tint v[N<<4],lz[N<<4];\n\tvoid push_down(int x){\n\t\tlz[x<<1]+=lz[x],v[x<<1]+=lz[x];\n\t\tlz[x<<1|1]+=lz[x],v[x<<1|1]+=lz[x];\n\t\tv[x]=max(v[x<<1],v[x<<1|1]);\n\t\tlz[x]=0;\n\t}\n\tvoid modify(int l,int r,int ql,int qr,int x,int val){\n\t\tif(ql<=l&&r<=qr){\n\t\t\tv[x]+=val,lz[x]+=val;\n\t\t\treturn;\n\t\t}\n\t\tpush_down(x);\n\t\tint m=(l+r)>>1;\n\t\tif(ql<=m)modify(l,m,ql,qr,x<<1,val);\n\t\tif(m<qr)modify(m+1,r,ql,qr,x<<1|1,val);\n\t\tv[x]=max(v[x<<1],v[x<<1|1]);\n\t}\n\tll query(ll l,ll r,ll ql,ll qr,ll x){\n\t\tpush_down(x);\n\t\tv[x]=max(v[x<<1],v[x<<1|1]);\n\t\tif(ql<=l&&r<=qr)return v[x];\n\t\tll m=l+r>>1,ans=0;\n\t\tif(ql<=m)ans=max(ans,query(l,m,ql,qr,x<<1));\n\t\tif(m<qr)ans=max(ans,query(m+1,r,ql,qr,x<<1|1));\n\t\treturn ans;\n\t}\n}t;\nint n,cnt,des[N<<2];\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++){\n\t\tint opt;cin>>opt;\n\t\tif(opt==1){\n\t\t\tcnt++;\n\t\t\tcin>>p[cnt].a>>p[cnt].b>>p[cnt].c>>p[cnt].d>>p[cnt].v;\n\t\t\tif(p[cnt].a>p[cnt].c)swap(p[cnt].a,p[cnt].c);\n\t\t\tt.modify(1,N<<1,p[cnt].a+N,p[cnt].c+N,1,p[cnt].v);\n\t\t}\n\t\tif(opt==2){\n\t\t\tint d;\n\t\t\tcin>>d;\n\t\t\tdes[d]=1;\n\t\t\tt.modify(1,N<<1,p[d].a+N,p[d].c+N,1,-p[d].v);\n\t\t}\n\t\tif(opt==3){\n\t\t\tint x,y;\n\t\t\tcin>>x>>y;\n\t\t\tcout<<t.query(1,N<<1,x+N,x+N,1)<<endl;\n\t\t}\n\t\tif(opt==4){\n\t\t\tint d;\n\t\t\tcin>>d;\n\t\t\tif(des[d])puts(\"oops!\");\n\t\t\telse cout<<t.query(1,N<<1,p[d].a+N,p[d].c+N,1)<<endl;\n\t\t}\n\t}\n    return 0;\n}\n```\n\n\n---\n\n$\\mathrm{Sol\\ 3}:$\n\n\u89c2\u5bdf\u5230\u6d4b\u8bd5\u70b9 $9-12$ \u4e2d $x\\ge 0$\u3002\n\n\u6c42\u51fa\u6240\u6709 $r_1,r_2,r$\uff0c\u79bb\u6563\u5316\u540e\u7528**\u4e00\u4e2a**\u7ebf\u6bb5\u6811**\u79bb\u7ebf**\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n\\log n)$\u3002\n\n- \u53ef\u4ee5\u901a\u8fc7\u6d4b\u8bd5\u70b9 $9-12$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$20\\%$\uff0c\u7ed3\u5408 $\\mathrm{Sol\\ 1,2}$ \u53ef\u5f97 $60\\%$\u3002\n\n---\n\n$\\mathrm{Sol\\ 4}:$\n\n\u6c42\u51fa\u6240\u6709 $r_1,r_2,r$\uff0c\u6839\u636e **$x$ \u662f\u5426\u4e0d\u5927\u4e8e $0$** **\u5206\u522b\u79bb\u6563\u5316\u540e\u7528\u4e24\u4e2a**\u7ebf\u6bb5\u6811**\u79bb\u7ebf**\u7ef4\u62a4\u3002\u5982\u679c\u4e00\u4e2a\u5e73\u9762\u955c\u7a7f\u8fc7\u4e86 $y$ \u8f74\uff0c\u5219\u50cf $\\mathrm{Sol\\ }1$ \u4e00\u6837\uff0c\u5c06\u5b83\u5206\u6210\u4e24\u534a\u5206\u522b\u8003\u8651\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(n\\log n)$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$100\\%$\u3002\n\n---\n\n$\\mathrm{std:}$\n\n\u5e38\u6570\u6781\u5927\uff0c\u7ec6\u8282\u8f83\u591a\u3002\n\n\uff08\u636e\u8bf4\u7528\u6781\u89d2\u6bd4\u8fd9\u79cd\u65b9\u6cd5\u66f4\u7b80\u5355\uff0c\u4f46\u662f\u51fa\u9898\u4eba\u592a\u83dc\uff0c\u4e0d\u4f1a\uff09\n\n```cpp\n#include<map>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n#define ld long double\ninline int read(){\n\tint x=0,sign=1;char s=getchar();\n\twhile(!isdigit(s)){\n\t\tif(s=='-')sign=-1;\n\t\ts=getchar();\n\t}\n\twhile(isdigit(s)){\n\t\tx=(x<<1)+(x<<3)+(s^48);\n\t\ts=getchar();\n\t}\n\treturn x*sign;\n}\nint max(int a,int b){\n\treturn a>b?a:b;\n}\nconst int N=2e5+5;\nconst ld inf=2e9;\nstruct operation{\n\tint opt,x1,y1,x2,y2,d;\n\tint v;\n\tld r1,r2;\n}p[N];\nstruct Segment_Tree{//\u7ef4\u62a4\u533a\u95f4\u52a0\u6cd5\uff0c\u533a\u95f4\u6c42\u6700\u5927\u503c\u7684\u7ebf\u6bb5\u6811\n\tint v[N<<3],lz[N<<3],siz;\n\tvoid push_up(int x){\n\t\tv[x]=max(v[x<<1],v[x<<1|1]);\n\t}\n\tvoid push_down(int l,int r,int x){\n\t\tif(!lz[x])return;\n\t\tv[x<<1]+=lz[x];\n\t\tv[x<<1|1]+=lz[x];\n\t\tlz[x<<1]+=lz[x];\n\t\tlz[x<<1|1]+=lz[x];\n\t\tlz[x]=0;\n\t}\n\tvoid modify(int l,int r,int ql,int qr,int x,int val){\n\t\tif(ql<=l&&r<=qr){\n\t\t\tv[x]+=val;\n\t\t\tlz[x]+=val;\n\t\t\treturn;\n\t\t}\n\t\tpush_down(l,r,x);\n\t\tint m=l+r>>1;\n\t\tif(ql<=m)modify(l,m,ql,qr,x<<1,val);\n\t\tif(m<qr)modify(m+1,r,ql,qr,x<<1|1,val);\n\t\tpush_up(x);\n\t}\n\tint query(int l,int r,int ql,int qr,int x){\n\t\tif(ql<=l&&r<=qr)return v[x];\n\t\tpush_down(l,r,x);\n\t\tint ans=0,m=l+r>>1;\n\t\tif(ql<=m)ans=max(ans,query(l,m,ql,qr,x<<1));\n\t\tif(m<qr)ans=max(ans,query(m+1,r,ql,qr,x<<1|1));\n\t\treturn ans;\n\t}\n}lt,rt;//lt\u4e3ax<0\u65f6\u7684\u7ebf\u6bb5\u6811\uff0crt\u4e3ax>=0\u65f6\u7684\u7ebf\u6bb5\u6811\nmap <ld,int> lmp,rmp;//\u5206\u522b\u79bb\u6563\u5316\nld lpo[N<<1],rpo[N<<1];//\u843d\u5728\uff08\u5de6/\u53f3\uff09\u8fb9\u7684\u70b9\u7684r\u503c\nint n,cnt,pl[N],lp,rp,des[N];//lp/rp \u4e3a\u843d\u5728\uff08\u5de6/\u53f3\uff09\u8fb9\u7684\u70b9\u7684\u4e2a\u6570\uff0cdes[i]\u4e3a\u7b2ci\u4e2a\u5e73\u9762\u955c\u662f\u5426\u88ab\u6467\u6bc1\nvoid swap(operation &x)//\u4ea4\u6362\u5e73\u9762\u955c\u7684\u4e24\u4e2a\u7aef\u70b9\n{\n\tswap(x.x1,x.x2);\n\tswap(x.y1,x.y2);\n\tswap(x.r1,x.r2);\n}\nld ratio(ld x,ld y){//\u6c42r\u503c \n\tif(x==0)return y>0?inf:-inf;//\u7279\u5224x\u4e3a0\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u8bber\u4e3a\u4e00\u4e2a\u6781\uff08\u5927/\u5c0f\uff09\u503c\n\telse return y/x;\n}\nld zero(ld x1,ld y1,ld x2,ld y2){//\u6c42\u5e73\u9762\u955c\u4e0ey\u8f74\u7684\u4ea4\u70b9\u7684\u7eb5\u5750\u6807\n\tld k=(y1-y2)/(x1-x2),b=y1-k*x1;//\u5f85\u5b9a\u7cfb\u6570\u6cd5\n\treturn b;\n}\nvoid init(){\n\tn=read();\n\tfor(int i=1;i<=n;i++){\n\t\tp[i].opt=read();\n\t\tif(p[i].opt==1){\n\t\t\tp[i].x1=read(),p[i].y1=read();\n\t\t\tp[i].x2=read(),p[i].y2=read();\n\t\t\tp[i].v=read();\n\t\t\tif(p[i].x1>=0)p[i].r1=rpo[++rp]=ratio(p[i].x1,p[i].y1);\n\t\t\telse p[i].r1=lpo[++lp]=ratio(p[i].x1,p[i].y1);\n\t\t\tif(p[i].x2>=0)p[i].r2=rpo[++rp]=ratio(p[i].x2,p[i].y2);\n\t\t\telse p[i].r2=lpo[++lp]=ratio(p[i].x2,p[i].y2);//\u4e0a\u9762\u56db\u884c\u90fd\u662f\u52a0\u70b9\uff0c\u6c42r\n\t\t\tif((p[i].x1>=0&&p[i].x2>=0||p[i].x1<0&&p[i].x2<0)&&p[i].r1>p[i].r2)swap(p[i]);//\u5c06\u6240\u6709\u672a\u7a7f\u8fc7y\u8f74\u7684\u5e73\u9762\u955c\u7684\u7aef\u70b9\u53d8\u4e3ar1<=r2\uff0c\u65b9\u4fbf\u8ba1\u7b97\n\t\t\tif(p[i].x1<0&&p[i].x2>=0)swap(p[i]);//\u5c06\u6240\u6709\u7a7f\u8fc7y\u8f74\u7684\u5e73\u9762\u955c\u7684\u7aef\u70b9\u53d8\u4e3ax1>=0,x2<0\uff0c\u65b9\u4fbf\u8ba1\u7b97 \n\t\t}\n\t\tif(p[i].opt==2||p[i].opt==4)p[i].d=read();\n\t\tif(p[i].opt==3){\n\t\t\tp[i].x1=read(),p[i].y1=read();\n\t\t\tif(p[i].x1>=0)p[i].r1=rpo[++rp]=ratio(p[i].x1,p[i].y1);\n\t\t\telse p[i].r1=lpo[++lp]=ratio(p[i].x1,p[i].y1);//\u4e0a\u9762\u4e24\u884c\u90fd\u662f\u52a0\u70b9\uff0c\u6c42r\n\t\t}\n\t}\n\trt.siz=rp;\n\tlt.siz=lp;\n}\nvoid discretize(){//\u79bb\u6563\u5316\n\tsort(rpo+1,rpo+rp+1);\n\tfor(int i=1;i<=rp;i++)rmp[rpo[i]]=i;\n\tsort(lpo+1,lpo+lp+1);\n\tfor(int i=1;i<=lp;i++)lmp[lpo[i]]=i;\n}\nvoid Add_Plane_Mirror(int x1,int y1,int x2,int y2,ld r1,ld r2,int val){//\u6dfb\u52a0/\u6467\u6bc1\u5e73\u9762\u955c \n\tif(x1>=0&&x2>=0){\n\t\trt.modify(1,rt.siz,rmp[r1],rmp[r2],1,val);\n\t}\n\telse if(x1<0&&x2<0){\n\t\tlt.modify(1,lt.siz,lmp[r1],lmp[r2],1,val);\n\t}\n\telse{\n\t\tld cont=zero(x1,y1,x2,y2);\n\t\tif(cont>0){\n\t\t\trt.modify(1,rt.siz,rmp[r1],rt.siz,1,val);\n\t\t\tlt.modify(1,lt.siz,1,lmp[r2],1,val);\n\t\t}\n\t\telse{\n\t\t\trt.modify(1,rt.siz,1,rmp[r1],1,val);\n\t\t\tlt.modify(1,lt.siz,lmp[r2],lt.siz,1,val);\n\t\t}\n\t}\n}\nvoid solve(){\n\tfor(int i=1;i<=n;i++){\n\t\tif(p[i].opt==1){\n\t\t\tpl[++cnt]=i;\n\t\t\tAdd_Plane_Mirror(p[i].x1,p[i].y1,p[i].x2,p[i].y2,p[i].r1,p[i].r2,p[i].v);\n\t\t}\n\t\tif(p[i].opt==2){\n\t\t\tif(!des[p[i].d]){\n\t\t\t\tint d=pl[p[i].d];\n\t\t\t\tAdd_Plane_Mirror(p[d].x1,p[d].y1,p[d].x2,p[d].y2,p[d].r1,p[d].r2,-p[d].v);\n\t\t\t\tdes[p[i].d]=1;\n\t\t\t}\n\t\t}\n\t\tif(p[i].opt==3){\n\t\t\tint pos;\n\t\t\tif(p[i].x1>=0){\n\t\t\t\tpos=rmp[p[i].r1];\n\t\t\t\tprintf(\"%d\\n\",rt.query(1,rt.siz,pos,pos,1));\n\t\t\t}\n\t\t\telse{\n\t\t\t\tpos=lmp[p[i].r1];\n\t\t\t\tprintf(\"%d\\n\",lt.query(1,lt.siz,pos,pos,1));\n\t\t\t}\n\t\t}\n\t\tif(p[i].opt==4){\n\t\t\tif(des[p[i].d])puts(\"oops!\");\n\t\t\telse{\n\t\t\t\tint d=pl[p[i].d];\n\t\t\t\tif(p[d].x1>=0&&p[d].x2>=0){\n\t\t\t\t\tprintf(\"%d\\n\",rt.query(1,rt.siz,rmp[p[d].r1],rmp[p[d].r2],1));\n\t\t\t\t}\n\t\t\t\telse if(p[d].x1<0&&p[d].x2<0){\n\t\t\t\t\tprintf(\"%d\\n\",lt.query(1,lt.siz,lmp[p[d].r1],lmp[p[d].r2],1));\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tld cont=zero(p[d].x1,p[d].y1,p[d].x2,p[d].y2);\n\t\t\t\t\tif(cont>0){\n\t\t\t\t\t\tprintf(\"%d\\n\",max(rt.query(1,rt.siz,rmp[p[d].r1],rt.siz,1),lt.query(1,lt.siz,1,lmp[p[d].r2],1)));\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tprintf(\"%d\\n\",max(rt.query(1,rt.siz,1,rmp[p[d].r1],1),lt.query(1,lt.siz,lmp[p[d].r2],lt.siz,1)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){\n\tinit();\n\tdiscretize();\n\tsolve();\n\treturn 0;\n}\n```\n",
        "postTime": 1576152673,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "\u300cSWTR-03\u300dT5 Plane Mirrors"
    }
]