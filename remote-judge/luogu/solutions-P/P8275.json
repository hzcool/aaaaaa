[
    {
        "content": "\u9996\u5148\u6709\u4e00\u4e2a\u663e\u7136\u7684\u533a\u95f4 DP\uff1a\u8bbe $f_{i,j}$ \u4e3a\u533a\u95f4 $[i,j]$ \u7684\u6743\u503c\uff0c\u5219 $f_{i,j} = \\min \\limits_{i \\leq k < j}  \\{ \\max(f_{i,k}, f_{k+1,j}) + 1\\}$\u3002\n\n\u8fdb\u4e00\u6b65\u5730\uff0c\u7531\u4e8e $f_{i,k}$ \u5173\u4e8e $k$ \u5355\u8c03\u4e0d\u964d\uff0c$f_{k+1,j}$ \u5173\u4e8e $k$ \u5355\u8c03\u4e0d\u5347\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u4e8c\u5206\u51fa\u6700\u5927\u7684 $k'$ \u4f7f\u5f97 $f_{i,k'} \\leq f_{k' + 1,j}$\uff0c\u7136\u540e\u5728 $k \\in \\{k',k'+1\\}$ \u4e2d\u505a\u51b3\u7b56\u5373\u53ef\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528\u51b3\u7b56\u5355\u8c03\u6027\u505a\u5230 $\\mathcal{O}(n^2)$\u3002\n\n\u4f46\u5230\u6b64\u4e3a\u6b62\uff0c\u76f4\u63a5 DP \u4f3c\u4e4e\u5df2\u7ecf\u770b\u4e0d\u5230\u524d\u9014\u4e86\u3002\u6211\u4eec\u53ef\u80fd\u9700\u8981\u627e\u5230\u4e00\u79cd\u66f4\u4f18\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002\n\n------------------------------------------------------------------\n\n\u8003\u8651\u4e00\u79cd\u65e0\u8111\u7684\u5408\u5e76\u65b9\u5f0f\uff1a\u6bcf\u6b21\u5c06\u533a\u95f4\u5212\u5206\u6210\u957f\u5ea6\u5c3d\u91cf\u76f8\u540c\u7684\u4e24\u90e8\u5206\uff0c\u7136\u540e\u5f52\u5e76\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u7684\u4e00\u4e2a\u4e0a\u754c $\\max a_i + \\lceil \\log n \\rceil$\u3002\u65e2\u7136\u7b54\u6848\u7684\u4e0a\u754c\u53ea\u6709 $\\mathcal{O}(A)$\uff0c\u6211\u4eec\u4e0d\u59a8\u8f6c\u53d8\u4e00\u4e0b\u601d\u8def\uff0c\u8003\u8651\u4f9d\u6b21\u679a\u4e3e $v$\uff0c\u7136\u540e\u8ba1\u7b97\u6743\u503c $\\geq v$ \u7684\u533a\u95f4\u4e2a\u6570\u3002\n\n\u7531\u4e8e $f_{i,k}$ \u5173\u4e8e $k$ \u5355\u8c03\u4e0d\u964d\uff0c\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u5de6\u7aef\u70b9 $i$ \u7ef4\u62a4\u6700\u5927\u7684\u53f3\u7aef\u70b9 $r_i$ \u4f7f\u5f97 $[i,r_i)$ \u7684\u6743\u503c\u4e0d\u5927\u4e8e $v$\u3002\u7ef4\u62a4\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a\u521d\u59cb\u65f6 $r_i = i$\uff0c\u5f53 $v-1 \\to v$ \u65f6\uff0c\u6211\u4eec\u4f9d\u6b21\u679a\u4e3e $i$\uff0c\u4ee4 $r_i \\gets r_{r_i}$\uff0c\u7136\u540e\u5bf9\u4e8e\u6240\u6709 $a_i = v$ \u7684\u4f4d\u7f6e $i$\uff0c\u4ee4 $r_i \\gets i+1$\u3002\n\n\u6211\u4eec\u63a5\u4e0b\u6765\u8bf4\u660e\u4e3a\u4ec0\u4e48\u4e0a\u9762\u7684\u505a\u6cd5\u662f\u5bf9\u7684\u3002\u5f53 $i = r_i$ \u65f6\u6b63\u786e\u6027\u663e\u7136\u3002\u5426\u5219\u8003\u8651 $[i,r_i)$ \u548c $[r_i,r_{r_i})$ \u8fd9\u4e24\u4e2a\u533a\u95f4\uff0c\u4e0d\u59a8\u8bbe\u5b83\u4eec\u5206\u522b\u4e3a\u533a\u95f4 $\\mathcal{A},\\mathcal{B}$\u3002\u5f53 $\\mathcal{A}$ \u548c $\\mathcal{B}$ \u7684\u6743\u503c\u90fd\u662f $v-1$ \u6b63\u786e\u6027\u663e\u7136\u3002\u5426\u5219\u82e5 $\\mathcal{A}$ \u7684\u6743\u503c\u5c0f\u4e8e $v - 1$\uff0c\u90a3\u4e48\u7531 $\\mathcal{A}$ \u7684\u6781\u5927\u6027\uff0c\u6709 $a_{r_i} \\geq v-1$\u3002\u82e5 $a_{r_i} \\geq v$\uff0c\u5219\u6b64\u65f6 $r_{r_i} = r_i$\uff0c\u5426\u5219 $a_{r_i} = v-1$\uff0c\u4e24\u8005\u7684\u6b63\u786e\u6027\u90fd\u662f\u663e\u7136\u7684\u3002\u5f53 $\\mathcal{B}$ \u7684\u6743\u503c\u5c0f\u4e8e $v-1$ \u65f6\u540c\u7406\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a $\\mathcal{O}(nA)$ \u7684\u505a\u6cd5\u3002\u76ee\u524d\u800c\u8a00\uff0c\u7b97\u6cd5\u7684\u6548\u7387\u4e0a\u4f3c\u4e4e\u6ca1\u6709\u4ec0\u4e48\u5b9e\u8d28\u6027\u7684\u8fdb\u5c55\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5bfb\u627e\u52a0\u901f\u7684\u65b9\u6cd5\u3002\n\n---------------------------------------------\n\n\u4e0d\u59a8\u518d\u5173\u6ce8\u4e00\u4e0b $f$ \u7684\u5355\u8c03\u6027\u3002\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u7684 $f$ \u503c $\\leq v$\uff0c\u90a3\u4e48\u5176\u6240\u6709\u5b50\u533a\u95f4\u7684 $f$ \u503c\u90fd $\\leq v$\u3002\n\n\u8fd9\u53e5\u8bdd\u542c\u4e0a\u53bb\u662f\u4e00\u53e5\u5e9f\u8bdd\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u5bb9\u65a5\uff0c\u6bcf\u6b21\u6539\u4e3a\u8ba1\u7b97\u6743\u503c $< v$ \u7684\u533a\u95f4\u4e2a\u6570\u3002\u8fd9\u65f6\u8003\u8651\u4e00\u7c7b\u7279\u6b8a\u7684\u533a\u95f4\uff1a\u6211\u4eec\u79f0\u4e00\u4e2a\u533a\u95f4\u662f $[l,r]$ \u662f \u201c\u6781\u5927\u7684\u201d\uff0c\u5f53\u4e14\u4ec5\u5f53\u5176\u5411\u5de6\u6216\u5411\u53f3\u6269\u5c55\u90fd\u4f1a\u4f7f $f$ \u503c\u589e\u5927\u3002\n\n\u5bf9\u4e8e\u6240\u6709\u6743\u503c\u4e3a $v-1$ \u7684\u6781\u5927\u533a\u95f4\uff0c\u663e\u7136\u5b83\u4eec\u4e0d\u4f1a\u4e92\u76f8\u5305\u542b\u3002\u4e8e\u662f\u6211\u4eec\u8981\u6c42\u7684\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\u7684\u4e00\u4e2a\u95ee\u9898\uff1a\u7ed9\u5b9a $L$ \u4e2a\u5de6\u53f3\u7aef\u70b9\u5355\u8c03\u589e\u7684\u533a\u95f4\uff0c\u6c42\u5b83\u4eec\u8986\u76d6\u7684\u533a\u95f4\u6570\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u5bb9\u65a5\u505a\u5230 $\\mathcal{O}(L)$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u76f4\u63a5\u5728\u679a\u4e3e $v$ \u7684\u8fc7\u7a0b\u4e2d\u7ef4\u62a4\u6781\u5927\u533a\u95f4\u7684\u96c6\u5408\uff0c\u5c31\u80fd\u591f\u907f\u514d\u6bcf\u6b21 $\\mathcal{O}(n)$ \u7684\u679a\u4e3e\u3002\u4f46\u4ece\u76f4\u89c9\u4e0a\u770b\uff0c\u6781\u5927\u533a\u95f4\u7684\u6570\u91cf\u4f3c\u4e4e\u8fd8\u662f\u53ef\u80fd\u5f88\u591a\uff0c\u590d\u6742\u5ea6\u7a76\u7adf\u80fd\u4f18\u5316\u591a\u5c11\u8fd8\u6709\u5f85\u5546\u69b7\u3002\n\n--------------------------\n\n\u4e3a\u6b64\uff0c\u6211\u4eec\u9700\u8981\u8bc1\u660e\u5982\u4e0b\u5f15\u7406\uff1a\n\n> **\u5f15\u7406**\uff1a\u8bbe $f(n)$ \u8868\u793a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\u7684\u6781\u5927\u533a\u95f4\u7684\u6570\u91cf\uff0c\u5219 $f(n)=O(n \\log n)$\u3002\n\n**\u8bc1\u660e**\uff1a\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\uff0c$f(n) \\leq f(\\log n!) = f(\\log 1 + \\cdots + \\log n) \\leq f(n \\log n)$\u3002\n\n\u8003\u8651\u539f\u5e8f\u5217\u7684\u7b1b\u5361\u5c14\u6811\uff0c\u8bbe\u5176\u4e2d\u4e00\u4e2a\u6700\u5927\u5143\u7d20\u7684\u4f4d\u7f6e\u4e3a $p$\uff0c\u5219\u6709\uff1a\n$$\nf(n) \\leq f(p-1) + f(n - p) + \\text{val}(p)\n$$\n\u5176\u4e2d $\\text{val}(p)$ \u4e3a\u539f\u5e8f\u5217\u4e2d\u5305\u542b\u4f4d\u7f6e $p$ \u7684\u6781\u5927\u533a\u95f4\u6570\u3002\u4e0d\u59a8\u8bbe $2p \\leq n$\uff0c\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\uff0c$\\text{val}(p) \\leq \\mathcal{O}(p \\log \\frac{n}{p})$\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u8bbe $\\text{val}_{k}(p)$ \u8868\u793a\u5305\u542b $p$\uff0c\u4e14\u6743\u503c\u4e3a $a_p + k$ \u7684\u6781\u5927\u533a\u95f4\u6570\uff0c\u5219\u6709 $\\text{val}_k(p) \\leq \\min(p,2^k)$\uff0c\u5176\u4e2d $0 \\leq k \\leq \\lceil \\log_2 n \\rceil$\u3002$p$ \u7684\u9650\u5236\u662f\u56e0\u4e3a\u6743\u503c\u76f8\u540c\u7684\u6781\u5927\u533a\u95f4\u5de6\u7aef\u70b9\u4f4d\u7f6e\u4e00\u5b9a\u4e0d\u540c\uff0c\u800c $2^k$ \u7684\u9650\u5236\u662f\u56e0\u4e3a\u6743\u503c\u4ece $a_p + k - 1$ \u5230 $a_p + k$ \u5fc5\u7136\u4f1a\u7ecf\u8fc7\u4e00\u6b21\u6269\u5c55\uff0c\u6bcf\u6b21\u6269\u5c55\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5411\u5de6\u6216\u662f\u5411\u53f3\uff0c\u800c\u6211\u4eec\u9700\u8981\u4ece $a_p$ \u5f00\u59cb\u6269\u5c55 $k$ \u6b21\u3002\n\n\u8003\u8651\u5bf9\u6240\u6709 $\\text{val}_i(p)$ \u6c42\u548c\u3002\u6ce8\u610f\u5230\uff0c\u5f53 $0 \\leq k < \\lceil \\log_2 p \\rceil$ \u65f6\uff0c$\\min(p,2^k) = 2^k$\uff0c\u8fd9\u90e8\u5206 $\\text{val}_i(p)$ \u7684\u548c\u4e3a $\\mathcal{O}(p)$\u3002\u5f53 $\\lceil \\log_2p \\rceil \\leq k \\leq \\lceil \\log_2 n \\rceil$ \u65f6\uff0c$\\min(p,2^k) = p$\uff0c\u8fd9\u90e8\u5206 $\\text{val}_i(p)$ \u7684\u548c\u4e3a $\\mathcal{O}(p \\log \\frac{n}{p})$\u3002\u4e8e\u662f\u547d\u9898\u5f97\u8bc1\u3002\n\n\u5bf9\u4e8e\u5f15\u7406\u7684\u8bc1\u660e\uff0c\u6211\u4eec\u8003\u8651\u5f52\u7eb3\u3002\u7531 $\\mathcal{O}(p \\log \\frac{n}{p}) \\leq \\mathcal{O}(\\log\\frac{n}{p} + \\log\\frac{n-1}{p-1} + \\cdots + \\log \\frac{n-p+1}{1}) \\leq \\mathcal{O}(\\log \\binom{n}{p}) \\leq \\mathcal{O}(\\log \\frac{n!}{(p-1)!(n-p)!})$\uff0c\u5219\u6709\n$$\n\\begin{aligned}\nf(n) &\\leq f(p-1) + f(n-p) + \\text{val}(p) \\\\\n     &\\leq \\mathcal{O}(\\log(p-1)!) + \\mathcal{O}(\\log(n-p)!) + \\mathcal{O}(\\log n! - \\log(p-1)! - \\log (n-p)!) \\\\\n     &\\leq \\mathcal{O}(n!)\n\\end{aligned}\n$$\n\u5219\u539f\u547d\u9898\u5f97\u8bc1\u3002\n\n-----------------------------\n\n\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u8003\u8651\u5982\u4f55\u7ef4\u62a4\u6781\u5927\u533a\u95f4\u3002\u5bf9\u5f53\u524d\u7684\u6743\u503c $v$\uff0c\u6211\u4eec\u79f0\u4e00\u4e2a\u533a\u95f4 $[l,r)$ \u662f\u4e00\u4e2a\u6bb5\uff0c\u5f53\u4e14\u4ec5\u5f53\u5176\u4e2d\u6240\u6709\u5143\u7d20\u90fd\u4e0d\u5927\u4e8e $v$\uff0c\u4e14 $\\min(a_{l-1},a_r) > v$\u3002\u5bf9\u4e8e\u5f53\u524d\u7684\u6240\u6709\u6781\u5927\u533a\u95f4\uff0c\u5176\u8981\u4e48\u6743\u503c\u4e3a $v$\uff0c\u8981\u4e48\u662f\u4e00\u4e2a\u6bb5\u3002\n\n\u6211\u4eec\u5c06\u6240\u6709\u6781\u5927\u533a\u95f4\u50a8\u5b58\u5728\u5176\u6240\u5c5e\u7684\u6bb5 $[l,r)$ \u7684\u5de6\u7aef\u70b9\u7684\u96c6\u5408 $\\text{seg}_l$ \u5185\u3002\u5f53 $v-1 \\to v$ \u65f6\uff0c\u6211\u4eec\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a\u5bf9\u6240\u6709\u9700\u8981\u66f4\u65b0\u7684\u6bb5\uff0c\u66f4\u65b0\u6781\u5927\u533a\u95f4\u5e76\u91cd\u65b0\u8ba1\u7b97\u5b83\u4eec\u7684\u8d21\u732e\u3002\u5408\u5e76\u8fc7\u540e\uff0c\u6bb5\u5185\u6240\u6709\u6781\u5927\u533a\u95f4\u7684\u6743\u503c\u53d8\u4e3a $v$\u3002\u63a5\u7740\u5728\u6240\u6709 $a_i = v$ \u7684\u4f4d\u7f6e\u6dfb\u52a0\u4e00\u4e2a\u6781\u5927\u533a\u95f4 $[i,i+1)$\uff0c\u7136\u540e\u5c06\u76f8\u90bb\u7684\u6bb5\u5408\u5e76\u3002\n\n\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u7ef4\u62a4\u6bb5\u7684\u5408\u5e76\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(A + n \\log n)$\u3002\u5177\u4f53\u7ec6\u8282\u89c1\u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\ntypedef vector <int> vi;\ntypedef pair <int, int> pi;\ntypedef long long LL;\nconst int N = 3e5 + 5, M = 1e6 + 35;\nint n, a[N], pre[N], nex[N]; LL cur;\nvi p[M];\nlist <pi> seg[N];\nLL sum(int l, int r) {\n    return 1LL * (l + r) * (r - l + 1) / 2;\n}\nLL calc(list <pi> L) {\n    LL ret = 0;\n    for (auto it = L.begin(); it != L.end(); it++) {\n        auto [x, y] = *it;\n        if (next(it) == L.end()) {\n            ret += sum(1, y - x);\n            break;\n        } else {\n            int nx = next(it) -> fi;\n            ret += 1LL * (nx - x) * y - sum(x, nx - 1);\n        }\n    }\n    return ret;\n}\nvoid upd(list <pi> &L) {\n    if (L.size() <= 1) \n        return;\n    cur += calc(L);\n    int mx = -1;\n    list <pi> nL;\n    auto it = L.begin();\n    for (auto [x, y] : L) {\n        while (next(it) != L.end() && next(it) -> fi <= y)\n            it++;\n        if (it -> se > mx) {\n            nL.push_back({x, mx = it -> se});\n        }\n    }\n    swap(L, nL);\n    cur -= calc(L);\n}\nint main() {\n    ios :: sync_with_stdio(false);\n    cin.tie(nullptr);\n    cin >> n;\n    for (int i = 1; i <= n; i++) {\n        cin >> a[i];\n        p[a[i]].push_back(i);\n    }\n    cur = 1LL * n * (n + 1) / 2;\n    for (int i = 1; i <= n; i++) \n        pre[i] = nex[i] = i;\n    LL ans = 0;\n    vi q;\n    for (int v = 1; cur > 0; v++) {\n        ans += cur;\n        vi nq;\n        for (auto l : q) {\n            upd(seg[l]);\n            if (seg[l].size() > 1) nq.push_back(l);\n        }\n        for (auto i : p[v]) {\n            int l = pre[i], r = nex[i + 1];\n            bool add = seg[l].size() <= 1;\n            nex[l] = r, pre[r] = l;\n            seg[l].push_back({i, i + 1});\n            cur--;\n            seg[l].splice(seg[l].end(), seg[i + 1]);\n            add &= seg[l].size() > 1;\n            if (add) nq.push_back(l); \n        }\n        swap(q, nq);\n    }\n    cout << ans << \"\\n\";\n    return 0;   \n}\n```\n",
        "postTime": 1674638915,
        "uid": 246019,
        "name": "_came11ia_",
        "ccfLevel": 7,
        "title": "P8275 [USACO22OPEN] 262144 Revisited P"
    }
]