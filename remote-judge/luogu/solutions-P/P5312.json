[
    {
        "content": "NOIP \u6a21\u62df\u8d5b\u8003\u4e86\u8fd9\u4e2a\u4e1c\u897f\uff0c\u7136\u800c\u5f53\u65f6\u6ca1\u5199\u51fa\u6765\u3002\n\n\u8003\u8651\u53ea\u6709\u5f02\u6216\u64cd\u4f5c\u548c\u6c42\u548c\u64cd\u4f5c\u600e\u4e48\u529e\u3002\n\n\u90a3\u6309\u4f4d\u8003\u8651\uff0c\u6bcf\u4f4d\u505a\u4e00\u4e0b\u524d\u7f00\u548c\u5c31\u80fd\u7ef4\u62a4\u4e86\u3002\n\n\u7136\u540e\u770b\u5230\u8fd9\u4e2a\u6392\u5e8f\u64cd\u4f5c\uff0c\u80af\u5b9a\u4e0d\u80fd\u66b4\u529b\u6392\u5e8f\uff0c\u5e94\u8be5\u6709\u4ec0\u4e48\u65b9\u6cd5\u53ef\u4ee5\u89c4\u907f\uff1b\u518d\u770b\u770b\u8fd9\u4e2a\u5f02\u6216\uff0c\u8bd5\u8bd5 01trie \u5427\u3002\n\n\u7ef4\u62a4 tag1 \u8868\u793a\u4e0a\u4e00\u6b21\u6392\u5e8f\u4e4b\u524d\u6240\u6709\u5f02\u6216\u64cd\u4f5c\u7684\u5f02\u6216\u548c\uff0ctag2 \u8868\u793a\u5230\u73b0\u5728\u4e3a\u6b62\u6240\u6709\u5f02\u6216\u64cd\u4f5c\u7684\u5f02\u6216\u548c\u3002\n\n\u5982\u679c\u8981\u5355\u70b9\u67e5\uff0c\u90a3\u6570\u7ec4\u7684\u7b2c $k$ \u4e2a\u4f4d\u7f6e\u5c31\u662f\u521d\u59cb\u5e8f\u5217\u5f02\u6216 tag1 \u540e\u7684\u7b2c $k$ \u5927\u3002\u5728 trie\u4e0a\u8d70\u5c31\u80fd\u627e\u5230\u3002\n\n\u7136\u800c\u73b0\u5728\u8981\u533a\u95f4\u6c42\u548c\uff0c\u6211\u4eec\u8003\u8651\u628a $1$ \u5230 $r$ \u7684\u7b54\u6848\u51cf\u53bb $1$ \u5230 $l-1$ \u7684\u7b54\u6848\u3002\u81f3\u4e8e $1$ \u5230 $r$ \u7684\u7b54\u6848\uff0c\u5728 trie \u6811\u4e0a\u4e8c\u5206\uff0c\u6bcf\u6b21\u8981\u8d70\u8fdb\u53f3\u5b50\u6811\u7684\u65f6\u5019\u7edf\u8ba1\u4e00\u4e0b\u5de6\u5b50\u6811\u7684\u7b54\u6848\uff0c\u5373\u53ef\u3002\n\n\u5173\u4e8e\u7b54\u6848\u600e\u4e48\u7edf\u8ba1\u2014\u2014\u7ef4\u62a4\u4e00\u4e0btrie\u6811\u7684\u6bcf\u4e2a\u5b50\u6811\u5f53\u4e2d\u6bcf\u4e00\u4f4d\u4e3a $1$ \u7684\u5404\u6709\u591a\u5c11\u4e2a\uff0c\u7136\u540e\u5728\u5f02\u6216 tag2 \u7684\u610f\u4e49\u4e0b\u7edf\u8ba1\u5373\u53ef\u3002\n\n\u672b\u5c3e\u63d2\u5165\u64cd\u4f5c\u600e\u4e48\u505a\uff1f\u4f60\u53d1\u73b0\u63d2\u5165\u4ee5\u540e\u6240\u63d2\u5165\u7684\u4e1c\u897f\u4e0d\u4e00\u5b9a\u548c\u524d\u9762\u662f\u6709\u5e8f\u7684\u3002\u90a3\u8003\u8651\u6682\u65f6\u5355\u72ec\u8003\u8651\u5b83\u4eec\uff0c\u62ff\u524d\u7f00\u548c\u53bb\u505a\uff0c\u4e0b\u4e00\u6b21\u6392\u5e8f\u7684\u65f6\u5019\u518d\u63d2\u8fdb trie \u91cc\u9762\u5c31\u597d\u4e86\u3002\u6ce8\u610f\u8f93\u5165\u8fd9\u4e2a\u64cd\u4f5c\u7684\u65f6\u5019\u7684\u65f6\u5019\u8981\u5148\u5f02\u6216\u4e00\u4e2a\u5f53\u65f6\u7684 tag2\uff0c\u8868\u793a\u5047\u5982\u5b83\u4e00\u5f00\u59cb\u5c31\u6709\uff0c\u90a3\u5b83\u521d\u59cb\u65f6\u662f\u591a\u5c11\u3002\n\n\u65f6\u7a7a\u590d\u6742\u5ea6 $O((n+m)\\log^2 a_i)$\u3002\n\n__\u7531\u4e8e\u5e76\u4e0d\u77e5\u9053\u4e24\u4e2a log \u7684\u7a7a\u95f4\u80fd\u8fc7\uff0c\u6211\u5c31\u6709\u4e86\u7a7a\u95f4\u66f4\u5c0f\u7684\u505a\u6cd5\u3002__\n\n\u4f18\u5316\u4e00\uff1a\u9996\u5148 trie \u6811\u90a3\u4e2a log \u662f\u53ef\u4ee5\u53bb\u6389\u7684\uff1a\u628a\u53ea\u6709\u4e00\u4e2a\u513f\u5b50\u7684\u7ed3\u70b9\u7701\u7565\u6389\uff0c\u8fd9\u6837\u6bcf\u4e2a\u6570\u63d2\u5165\u65f6\u6700\u591a\u589e\u52a0\u4e24\u4e2a\u7ed3\u70b9\uff0c\u7ed3\u70b9\u4e2a\u6570\u53d8\u6210 $O(n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O((n+m)\\log a_i)$\u4e86\u3002\n\n\u4f18\u5316\u4e8c\uff1a\u7531\u4e8e\u8fd9\u9898\u53ef\u4ee5\u79bb\u7ebf\uff0c\u6240\u4ee5\u8fd8\u80fd\u518d\u4f18\u5316\u3002\u79bb\u7ebf\u8d77\u6765\uff0c\u5bf9\u6bcf\u4e00\u4f4d\u7b97\u4e00\u8f6e\u7b54\u6848\u6700\u540e\u52a0\u8d77\u6765\uff0c\u8fd9\u6837\u6bcf\u6b21\u53ea\u8981\u5f00\u8fd9\u4e00\u4f4d\u7684\u7a7a\u95f4\u3002\u90a3\u7a7a\u95f4\u5c31 $O(n+m)$ \u5566\u3002\n\n\u8fd9\u4e2a\u4ee3\u7801\u6bd4\u8f83\u4e71\uff0c\u53ef\u4ee5\u5f53\u4f5c\u6ca1\u770b\u89c1\uff08\u5b83\u53ea\u6709\u4f18\u5316\u4e00\n\n```cpp\n#include<cstdio>\n#include<algorithm>\ntypedef long long ll;\nconst int N=2e5+3,K=30;\nint n,m,son[N+N][2],c[N+N][2],l[N+N],s[N+N][K],siz[N+N],lz,lstn,newn,tmp,b[N][K],a[N],t;ll res;\ninline void Push_back(int x){\n\t++newn,x^=tmp;\n\ta[newn]=x;\n\tfor(int j=0;j<K;j++)b[newn][j]=(x>>j&1)+b[newn-1][j];\n}\ninline void Insert(int a){\n\tint k=0,w,i,p,j,aa=a;\n\tfor(;l[k];){\n\t  i=a>>l[k]-1&1;\n\t  if(!son[k][i]){\n\t\tson[k][i]=++t,c[k][i]=a,l[t]=0;\n\t  }\n\t  else if(c[k][i]!=a-(a&(1<<l[son[k][i]])-1)){\n\t\tw=++t;\n\t\tsiz[w]=siz[son[k][i]];\n\t\tfor(int j=0;j<K;j++)s[w][j]=s[son[k][i]][j];\n\t\tp=a>c[k][i];\n\t\tfor(j=l[k]-1;~(c[k][i]^a)>>j&1;j--);\n\t\tl[w]=j+1;\n\t\tson[w][p]=++t,c[w][p]=a&(1<<l[w])-1,l[t]=0;\n\t\tson[w][p^1]=son[k][i],c[w][p^1]=c[k][i]&(1<<l[w])-1;\n\t\tson[k][i]=w,c[k][i]-=c[w][p^1];\n\t  }\n\t  a-=c[k][i],k=son[k][i];\n\t  ++siz[k];\n\t  for(int j=0;j<K;j++)s[k][j]+=aa>>j&1;\n\t}\n}\ninline ll Sum(int g){\n\tif(!g)return 0;\n\tint k=0,i,sum=0;ll res=0;\n\tfor(;l[k];){\n\t  i=lz>>l[k]-1&1;\n\t  if(g<=siz[son[k][i]])sum|=c[k][i],k=son[k][i];\n\t  else{\n\t\tg-=siz[son[k][i]];\n\t\tfor(int j=0;j<K;j++)\n\t\t  if((lz^tmp)>>j&1)res+=(ll)(1<<j)*(siz[son[k][i]]-s[son[k][i]][j]);\n\t\t  else res+=(ll)(1<<j)*s[son[k][i]][j];\n\t\tsum|=c[k][i^1],k=son[k][i^1];\n\t  }\n\t}\n\tres+=(sum^lz^tmp)*g;\n\treturn res;\n}\nint main(){\n\tint x,y,L,R,o;\n\tscanf(\"%d\",&n);\n\tlstn=tmp=newn=0;\n\tl[0]=K;\n\tfor(;n--;)scanf(\"%d\",&x),Push_back(x);\n\tscanf(\"%d\",&m);\n\tfor(;m--;){\n\t  scanf(\"%d\",&o);\n\t  switch(o){\n\t\tcase 1:scanf(\"%d\",&x),Push_back(x);break;\n\t\tcase 2:\n\t\t  scanf(\"%d%d\",&x,&y);\n\t\t  res=0;\n\t\t  if(y>lstn){\n\t\t\tL=std::max(x-lstn,1),R=y-lstn;\n\t\t\tfor(int j=0;j<K;j++)\n\t\t\t  if(tmp>>j&1)res+=(ll)(1<<j)*(R-L+1-b[R][j]+b[L-1][j]);\n\t\t\t  else res+=(ll)(1<<j)*(b[R][j]-b[L-1][j]);\n\t\t  }\n\t\t  if(x<=lstn){\n\t\t\tL=x,R=std::min(y,lstn);\n\t\t\tres+=Sum(R)-Sum(L-1);\n\t\t  }\n\t\t  printf(\"%lld\\n\",res);\n\t\tbreak;\n\t\tcase 3:scanf(\"%d\",&x),tmp^=x;break;\n\t\tcase 4:\n\t\t  for(int i=1;i<=newn;i++)Insert(a[i]^lz);\n\t\t  lz^=tmp;\n\t\t  lstn+=newn,tmp=newn=0;\n\t\tbreak;\n\t  }\n\t}return 0;\n}\n```",
        "postTime": 1595599214,
        "uid": 72487,
        "name": "Dreamunk",
        "ccfLevel": 9,
        "title": "Ynoi2011 \u7ade\u8d5b\u5b9e\u9a8c\u73ed"
    },
    {
        "content": "\u8003\u8651\u67d0\u4e00\u65f6\u523b\u6570\u5217\u7684\u72b6\u6001\uff0c\u4e00\u5b9a\u662f\u524d\u9762\u4e00\u6bb5\u6709\u5e8f\uff0c\u540e\u9762\u4e00\u6bb5\u65e0\u5e8f\u3002\n\n\u9996\u5148\u8003\u8651\u7b2c\u4e09\u4e2a\u64cd\u4f5c\uff0c\u663e\u7136\u7528\u4e00\u4e2a\u53d8\u91cf\u8bb0\u4e00\u4e0b\u5168\u5c40\u5f02\u6216\u7684\u503c$X$\u5c31\u53ef\u4ee5\u4e86\u3002\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5148\u628a$x$\u5f02\u6216\u4e0a$X$\u518d\u63d2\u5165\u3002\n\n\u8ba1\u7b97\u8d21\u732e\u7684\u8bdd\uff0c\u53ef\u4ee5\u6309\u4f4d\u8003\u8651\uff0c\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e00\u4f4d\u6709\u591a\u5c11\u4e2a\u5373\u53ef\u3002\n\n\u5982\u679c\u6ca1\u6709\u6392\u5e8f\u64cd\u4f5c\uff0c\u76f4\u63a5\u8bb0\u4e00\u4e0b\u6bcf\u4e00\u4f4d\u7684\u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u8003\u8651\u6392\u5e8f\u64cd\u4f5c\uff0c\u524d\u9762\u6709\u5e8f\u7684\u6211\u4eec\u4e0d\u53bb\u52a8\u5b83\uff0c\u540e\u9762\u65e0\u5e8f\u7684\uff0c\u76f4\u63a5\u628a\u5b83\u63d2\u5728\u6b63\u786e\u7684\u4f4d\u7f6e\u5373\u53ef\u3002\u663e\u7136\u4e00\u4e2a\u6570\u53ea\u4f1a\u88ab\u63d2\u5165\u4e00\u6b21\u3002\u752801Trie\u6216\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u4e0b\u533a\u95f4\u5404\u4e2a\u4f4d\u7684\u51fa\u73b0\u6b21\u6570\u5373\u53ef\u505a\u5230\u533a\u95f4\u67e5\u8be2\uff08\u53ef\u4ee5\u7528\u524d\u7f00\u76f8\u51cf\u6765\u641e\uff09\u3002\n\n\u7136\u800c\u64cd\u4f5c3\u4f1a\u6539\u53d8\u5df2\u7ecf\u6392\u5b8c\u5e8f\u7684\u6570\u7684\u5927\u5c0f\u5173\u7cfb\u3002\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u6027\u8d28\u3002\n\n\u8003\u8651\u6700\u9ad8\u4f4d\uff0c\u5982\u679c\u5b83\u5f02\u6216\u4e0a\u4e861\uff0c\u5219\u8fd9\u4e2a\u5e8f\u5217\u7684\u540e\u4e00\u90e8\u5206\uff08\u6700\u9ad8\u4f4d\u4e3a1\u7684\u90a3\u4e9b\u6570\uff09\u4f1a\u6574\u4f53\u53d8\u5230\u524d\u9762\u6765\u3002\u800c\u6bcf\u4e2a\u90e8\u5206\u5185\u90e8\u7684\u76f8\u5bf9\u987a\u5e8f\u4e0d\u53d8\u3002\u7136\u540e\u5bf9\u6bcf\u4e00\u90e8\u5206\uff0c\u518d\u5bf9\u6b21\u9ad8\u4f4d\u8003\u8651\u3002\u4f9d\u6b21\u7c7b\u63a8\u3002\n\n\u5bf9\u5e94\u5230\u6570\u636e\u7ed3\u6784\u5185\u90e8\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u67d0\u4e00\u4f4d\u5f02\u6216\u4e0a\u4e861\uff0c\u76f8\u5f53\u4e8e\u8fd9\u4e00\u5c42\u7684\u8282\u70b9\u7684\u5de6\u53f3\u513f\u5b50\u4ea4\u6362\u4e86\u4e00\u4e0b\u3002\n\n\u6211\u4eec\u4e0d\u9700\u8981\u771f\u7684\u4ea4\u6362\uff0c\u53ea\u9700\u8981\u5728\u8be2\u95ee\u7684\u65f6\u5019\u5224\u65ad\u4e00\u4e0b\u5f80\u54ea\u8fb9\u8d70\u5373\u53ef\u3002\n\n\u8fd9\u6837\u5c31\u975e\u5e38\u7b80\u5355\u4e86\uff0c\u4ee3\u7801\u4e5f\u5f88\u597d\u5199\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log^2 A)$\u3002",
        "postTime": 1555999021,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5312 \u3010[Ynoi2012]D2T1\u3011"
    },
    {
        "content": "\u5199\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\u76ee\u524d\u6211\u5199\u7684\u65f6\u95f4\u6700\u957f\u7684 Ynoi\uff0c~~\u867d\u7136\u6700\u540e\u662f\u9760\u548c\u9898\u89e3\u5bf9\u62cd\u624d\u8fc7\u7684\u5c31\u662f\u4e86~~\u3002\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u6570\u7ec4 $a$\uff0c\u4f60\u9700\u8981\u7ef4\u62a4\u5982\u4e0b\u64cd\u4f5c\uff1a\n\n- \u672b\u5c3e\u63d2\u5165\u4e00\u4e2a\u6570 $x$\n\n- \u533a\u95f4\u6c42\u548c\n\n- \u5168\u5c40\u5f02\u6216 $x$\n\n- \u5168\u5c40\u6392\u5e8f\n\n$1\\leq n,m\\leq 10^5,0\\leq x,a_i\\leq10^9$\n\n## \u9898\u76ee\u5206\u6790\n\n\u6211\u4eec\u8003\u8651\u5c06\u64cd\u4f5c\u5206\u5f00\u7ec4\u5408\u4e00\u4e0b\uff0c\u770b\u600e\u4e48\u505a\u3002\n\n\u9996\u5148\u672b\u5c3e\u63d2\u5165\uff0c\u7edd\u5927\u90e8\u5206\u7684\u6570\u636e\u7ed3\u6784\u90fd\u80fd\u652f\u6301\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u6bd4\u5982\u5e73\u8861\u6811\uff0c\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u4e4b\u7c7b\u7684\u3002\n\n\u53ea\u8003\u8651\u5168\u5c40\u6392\u5e8f\u5957\u63d2\u5165\uff0c\u90a3\u4e48\u5c31\u80fd\u4fdd\u8bc1\u5f53\u524d\u5e8f\u5217\u53ef\u4ee5\u88ab\u5206\u6210\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u662f\u4e4b\u524d\u66fe\u6392\u597d\u5e8f\u7684\uff0c\u5df2\u7ecf\u4fdd\u8bc1\u6709\u5e8f\u4e86\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u6c42\u524d\u7f00\u548c\uff0c\u53e6\u4e00\u90e8\u5206\u5219\u662f\u540e\u7eed\u63d2\u5165\u7684\u65e0\u5e8f\u6bb5\uff0c\u8fd9\u90e8\u5206\u76f4\u63a5\u524d\u7f00\u548c\u7ef4\u62a4\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u533a\u95f4\u67e5\u8be2\u64cd\u4f5c\u3002\n\n\u7531\u4e8e\u6211\u4eec\u67e5\u8be2\u524d\u7f00\u548c\u53ea\u67e5\u540e\u534a\u90e8\u5206\u7684\uff0c\u6240\u4ee5\u524d\u534a\u90e8\u5206\u5373\u4fbf\u6392\u5e8f\u4e86\uff0c\u5bf9\u67e5\u8be2\u4e5f\u4e0d\u4f1a\u6709\u5f71\u54cd\u3002\n\n\u90a3\u6211\u4eec\u8003\u8651\u5168\u5c40\u5f02\u6216\u600e\u4e48\u505a\uff1f\u6211\u4eec\u5bf9\u4e8e\u8fd9\u79cd\u5168\u5c40\u52a0\u3001\u51cf\u3001\u5f02\u6216\u4e4b\u7c7b\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u4e00\u822c\u8003\u8651\u5728\u5c06\u65b0\u7684\u6570\u52a0\u5165\u5230\u6570\u636e\u7ed3\u6784\u4e0a\u65f6\uff0c\u5148\u5bf9\u5e94\u5168\u5c40\u6807\u8bb0\u505a\u4fee\u6539\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5904\u7406\u5168\u5c40\u5f02\u6216\u548c\u63d2\u5165\u3002\n\n\u533a\u95f4\u6c42\u548c\u3001\u5168\u5c40\u5f02\u6216\u3001\u672b\u5c3e\u63d2\u5165\uff0c\u8fd9\u51e0\u4e2a\u64cd\u4f5c\u90fd\u53ef\u4ee5\u62c6\u4f4d\u524d\u7f00\u548c\u6765\u7ef4\u62a4\uff0c\u6240\u4ee5\u5bf9\u4e8e\u672a\u6392\u5e8f\u7684\u96f6\u6563\u90e8\u5206\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62c6\u4f4d\u524d\u7f00\u548c\uff0c\u5177\u4f53\u6765\u8bf4\u5c31\u662f $sum_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u4e8c\u8fdb\u5236\u4e0b\u7b2c $j$ \u4f4d $1$ \u7684\u6570\u91cf\uff0c\u67e5\u8be2\u7684\u65f6\u5019\u5904\u7406\u5f53\u524d\u5168\u5c40\u5f02\u6216\u5bf9\u524d\u7f00\u548c\u7684\u5f71\u54cd\u5373\u53ef\u3002\n\n\u73b0\u5728\u552f\u4e00\u7684\u95ee\u9898\u5c31\u5728\u4e8e\u524d\u9762\u90e8\u5206\u6392\u597d\u5e8f\u7684\u600e\u4e48\u5904\u7406\uff0c\u5f02\u6216\u3001\u533a\u95f4\u6c42\u548c\u3001\u63d2\u5165\uff0c\u533a\u95f4\u6c42\u548c\u6211\u4eec\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u505a\u76f8\u51cf\uff0c\u76f8\u5f53\u4e8e\u6211\u4eec\u8981\u6c42\u5728\u5f02\u6216 $x$ \u610f\u4e49\u4e0b\uff0c\u5e8f\u5217 $a$ \u7684\u524d $k$ \u5927\u4e4b\u548c\uff0c\u53ef\u4ee5\u5b57\u5178\u6811\u554a\uff01\n\n\u542c\u6211\u626f\u4e86\u8fd9\u4e48\u591a\uff0c\u603b\u8be5\u5199\u70b9\u6709\u7528\u7684\u4e86\uff0c\u6211\u4eec\u8003\u8651\u5efa\u5b57\u5178\u6811\uff0c\u6bcf\u6b21\u6392\u5e8f\uff0c\u5c31\u5c06\u540e\u9762\u7684\u65e0\u5e8f\u5757\u63d2\u5165\u5230\u6811\u4e0a\uff0c\u6bcf\u4e2a\u70b9\u53ea\u4f1a\u88ab\u63d2\u5165\u4e00\u6b21\uff0c\u590d\u6742\u5ea6\u6b63\u786e\uff0c\u6bcf\u6b21\u6392\u5e8f\u90fd\u8bb0\u5f55\u4e00\u4e0b\u5f53\u524d\u7684\u5168\u5c40\u5f02\u6216\u6807\u8bb0\uff0c\u8bb0\u4f5c $tags$\uff0c\u67e5\u8be2\u524d\u534a\u90e8\u5206\u7684\u524d\u7f00\u548c\uff0c\u5c31\u76f8\u5f53\u4e8e\u5728\u5f02\u6216 $tags$ \u7684\u610f\u4e49\u4e0b\u627e\u5b57\u5178\u6811\u4e0a\u524d $k$ \u5927\u7684\u548c\uff0c\u4f46\u662f\u8fd8\u6709\u5168\u5c40\u5f02\u6216\u600e\u4e48\u529e\u5462\uff1f\n\n\u6211\u4eec\u7528\u65e0\u5e8f\u6bb5\u7c7b\u4f3c\u7684\u5904\u7406\u65b9\u6cd5\uff0c\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u6811\u4e0a\u8282\u70b9\uff0c\u7ef4\u62a4\u5176\u5b50\u6811\u53ca\u672c\u8eab\u8bb0\u5f55\u7684\u6570\u7684\u62c6\u4f4d\u4e8c\u8fdb\u5236\u548c\u5373\u53ef\uff0c\u67e5\u8be2\u7684\u65f6\u5019\u6ce8\u610f\u662f\u5f02\u6216\u5168\u5c40\u6807\u8bb0\u7684\u60c5\u51b5\u4e0b\u3002\n\n\u7531\u4e8e\u8981\u540c\u65f6\u7ef4\u62a4\u5b57\u5178\u6811\u548c\u62c6\u4f4d\u6570\u7ec4\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u662f $O(n\\log^2 V)$\uff0c$V$ \u662f\u503c\u57df\u3002\n\n## Code\n\n\u4e00\u5b9a\u8981\u6ce8\u610f\u67e5\u8be2\u7684\u65f6\u5019\u662f\u4ee5\u4e0a\u4e00\u6b21\u6392\u5e8f\u65f6\u7684\u5168\u5c40\u6807\u8bb0\u4e3a\u57fa\u51c6\u627e\u524d $k$ \u5927\uff0c\u800c\u7edf\u8ba1\u7b54\u6848\u5374\u662f\u6309\u7167\u5f53\u524d\u5168\u5c40\u6807\u8bb0\u7edf\u8ba1\uff0c\u6211\u5728\u8fd9\u5361\u4e86\u597d\u4e45\u3002\n\n\u4ee3\u7801\u6211\u5b57\u5178\u6811\u63d2\u5165\u548c\u67e5\u8be2\u7684\u5199\u6cd5\u4e0d\u4e00\u6837\uff0c\u4e00\u4e2a\u975e\u9012\u5f52\u4e00\u4e2a\u9012\u5f52\uff0c\u5f88\u4e11\u89c1\u8c05\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#include <queue>\n#include <cmath>\nusing namespace std;\nint read(){\n\tint x=0,f=1;char ch = getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-'){f=-1;}ch = getchar();}\n\twhile(ch>='0'&&ch<='9'){x = x*10+ch-'0';ch = getchar();}\n\treturn x*f;\n}\nconst int N = 1e5+5;\nint n,m;\nstruct aa{\n\tint ch[2];\n\tint sum[34],siz,val;\n\tbool flg;\n}node[N*34];\nvoid upd(int u,int val){\n\tint cnt = 0;\n\twhile(val){\n\t\tnode[u].sum[cnt]+=(val&1);\n\t\tval>>=1;\n\t\tcnt++;\n\t}\n\tnode[u].siz++;\n}\nint tot=1;\nvoid ins(int val){\n\tint now = 1;\n\tupd(now,val);\n\tfor(int i=31;i>=0;i--){\n\t\tbool x = (val>>i)&1;\n\t\tif(i==0){\n\t\t}\n\t\tif(!node[now].ch[x]){\n\t\t\tnode[now].ch[x] = ++tot;\n\t\t}\n\t\tnow = node[now].ch[x];\n\t\tupd(now,val);\n\t\tif(i==0){\n\t\t\t\n\t\t}\n\t}\n\tnode[now].val = val;\n\tnode[now].flg = 1;\n}\nint top,tag,las;\nlong long query(int u,int k,int cs){\n\tif(cs==-1&&k>0&&node[u].flg){\n\t\treturn min(k,node[u].siz)*(node[u].val^tag);\n\t}\n\tif(!u){\n\t\treturn 0;\n\t}\n\tif(k<=0){\n\t\treturn 0;\n\t}\n\t\n\tint s = node[u].siz;\n\tif(s<=k){\n\t\tlong long res = 0;\n\t\tfor(int i=31;i>=0;i--){\n\t\t\tres+=((tag>>i)&1)?(s-node[u].sum[i])*(1ll<<i):node[u].sum[i]*(1ll<<i);\n\t\t}\n\t\treturn res;\n\t}\n\tbool x = (las>>cs)&1;\n\tlong long res = 0;\n\ts = node[node[u].ch[x]].siz;\n\tres+=query(node[u].ch[x],k,cs-1);\n\tres+=query(node[u].ch[x^1],k-s,cs-1);\n\treturn res;\n}\nint qzh[N*2][34],a[N*2];\nlong long ask(int x){\n\tif(x>=top){\n\t\tlong long res = 0;\n\t\tfor(int i=31;i>=0;i--){\n\t\t\tres+=(tag>>i)&1?(x-qzh[x][i])*(1ll<<i):qzh[x][i]*(1ll<<i); \n\t\t}\n\t\treturn res;\n\t}else{\n\t\treturn query(1,x,31);\n\t}\n}\nint main(){\n\tn = read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i] = read();\n\t\tfor(int j=0;j<=31;j++){\n\t\t\tqzh[i][j] = qzh[i-1][j]+((a[i]>>j)&1);\n\t\t}\n\t}\n\tint opt,x,y;\n\tm = read();\n\twhile(m--){\n\t\topt = read();\n\t\tif(opt==1){\n\t\t\tx = read();\n\t\t\tx^=tag;\n\t\t\ta[++n] = x;\n\t\t\tfor(int i=0;i<=31;i++){\n\t\t\t\tqzh[n][i] = qzh[n-1][i]+((a[n]>>i)&1);\n\t\t\t}\n\t\t}else if(opt==2){\n\t\t\tx = read();y = read();\n\t\t\tcout<<ask(y)-ask(x-1)<<'\\n';\n\t\t}else if(opt==3){\n\t\t\tx = read();\n\t\t\ttag^=x;\n\t\t}else{\n\t\t\twhile(top<n){\n\t\t\t\t++top;\n\t\t\t\tins(a[top]);\n\t\t\t}\n\t\t\tlas = tag;\n\t\t}\n\t}\n\n\treturn 0;\n}\n```\n\n\u7a81\u7136\u53d1\u73b0\u81ea\u5df1\u53ea\u8981\u5199 Ynoi \u7684\u9898\u89e3\u5c31\u4f1a\u957f\u7684\u53ef\u6015\u3002",
        "postTime": 1668131887,
        "uid": 369399,
        "name": "yizhiming",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010P5312 [Ynoi2011] \u7ade\u8d5b\u5b9e\u9a8c\u73ed\u3011"
    },
    {
        "content": "\u9996\u5148\u4e0d\u96be\u53d1\u73b0\u5728\u67d0\u4e00\u4e2a\u65f6\u523b\u6570\u5217\u4e00\u5b9a\u662f\u524d\u4e00\u6bb5\u6709\u5e8f\u540e\u4e00\u6bb5\u65e0\u5e8f\u3002\n\n3\u64cd\u4f5c\u662f\u5168\u5c40\u5f02\u6216\uff0c\u76f4\u63a5\u5f00\u4e2a\u5168\u5c40\u53d8\u91cf\u8bb0\u5f55\u5f02\u6216\u503c\u5373\u53ef\u3002\u5bf9\u4e8e\u540e\u6765\u65b0\u52a0\u5165\u7684\u6570\uff0c\u5148\u5f02\u6216\u4e0a\u8fd9\u4e2a\u5168\u5c40\u53d8\u91cf\u518d\u63d2\u5165\u5373\u53ef\u3002\n\n\u8003\u8651\u65e0\u6392\u5e8f\u64cd\u4f5c\u65f6\uff0c\u5373\u65e0\u5e8f\u6bb5\u7684\u5904\u7406\uff0c\u4e0d\u96be\u60f3\u5230\u62c6\u4f4d\uff0c\u7ef4\u62a4\u6bcf\u4e00\u4f4d\u4e0a1\u7684\u51fa\u73b0\u6b21\u6570\u7684\u524d\u7f00\u548c\u3002\u8bbe\u67e5\u8be2\u4f4d\u7f6e\u4e3a$p$\uff0c\u5168\u5c40\u5f02\u6216\u503c\u4e3a$X$\uff0c\u8be5\u4f4d\u524d\u7f00\u548c\u4e3a$prf_{p}$\uff0c\u5219\u82e5$X$\u7684\u8fd9\u4e00\u4f4d\u4e3a1\u5219\u533a\u95f4\u5185\u8be5\u4f4d\u4e3a1\u7684\u6570\u5b57\u4e2a\u6570\u4e3a$p-prf_p$\uff0c\u5426\u5219\u4e3a$prf_p$\u3002\u5206\u5f00\u8ba1\u7b97\u6bcf\u4e00\u4f4d\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5373\u53ef\u5b9e\u73b0\u533a\u95f4\u6c42\u548c\u3002\n\n\u8003\u8651\u65e0\u63d2\u5165\u64cd\u4f5c\u65f6\uff0c\u5373\u6709\u5e8f\u6bb5\u7684\u5904\u7406\uff0c\u4e0d\u96be\u60f3\u5230\u7ef4\u62a4$01Trie$\u6811\uff0c\u4e0e\u7ebf\u6bb5\u6811\u7c7b\u4f3c\uff0cTrie\u6811\u6bcf\u4e00\u5c42\u7684\u8282\u70b9\u5c06\u5f53\u524d\u533a\u95f4\u5206\u6210\u8be5\u4f4d\u4e3a0\u548c\u8be5\u4f4d\u4e3a1\u4e24\u6bb5\u533a\u95f4\u3002\u7528\u7c7b\u4f3c\u7ebf\u6bb5\u6811\u7684\u6807\u8bb0\u5904\u7406\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u5206\u522b\u7ef4\u62a4\u6240\u6709\u4f4d\u7684\u51fa\u73b0\u6b21\u6570\u4e4b\u548c\uff0c\u67e5\u8be2\u65f6\u7c7b\u4f3c\u7ebf\u6bb5\u6811\u67e5\u8be2\u5373\u53ef\u67e5\u8be2\u4f4d\u524d\u7f00\u548c\u3002\n\n\u5f53\u6267\u884c4\u64cd\u4f5c\u65f6\uff0c\u4e4b\u524d\u76843\u64cd\u4f5c\u4f1a\u6539\u53d8\u524d\u9762$01Trie$\u4e0a\u7684\u6570\u5b57\u987a\u5e8f\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u67d0\u4e00\u4f4d\u5f02\u62161\u5373\u628a\u8fd9\u4e00\u4f4d\u5bf9\u5e94$Trie$\u6811\u7684\u90a3\u4e00\u5c42\u6240\u6709\u5de6\u53f3\u8282\u70b9\u4ea4\u6362\u3002\n\n\u628a\u524d\u9762\u4e24\u79cd\u505a\u6cd5\u7efc\u5408\u8d77\u6765\uff0c\u6392\u5e8f\u65f6\u5c06\u65e0\u5e8f\u6bb5\u7684\u6570\u63d2\u5165$01Trie$\u4e2d\uff0c\u968f\u540e\u7ef4\u62a4$3$\u64cd\u4f5c\u5e26\u6765\u7684\u5f71\u54cd\u3002\u5207\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAXN = 2e5 + 50, MW = 30;\ntypedef long long lint;\nint read() {\n\tchar ch; int x; while(ch = getchar(), ch < '!'); x = ch - 48;\n\twhile(ch = getchar(), ch > '!') x = (x << 3) + (x << 1) + ch - 48; return x;\n}\nint ch[MAXN << 4][2], X, pre[MAXN][MW+5], s[MAXN << 4][MW+5], cntc = 1, n, _n, tag[MW+5], a[MAXN], m, siz[MAXN << 4];\nlint qry(int p) {\n\tif(p == 0) return 0;\n\tlint res = 0; int val = 0, u = 1;\n\tfor(int i = MW; i >= 0; --i) {\n\t\tif(p <= siz[ch[u][tag[i]]]) u = ch[u][tag[i]], val |= tag[i] << i;\n\t\telse {\n            int x = siz[ch[u][tag[i]]]; p -= x;\n            for(int j = 0; j <= MW; ++j){\n                int cnt = s[ch[u][tag[i]]][j];\n                if(X>>j&1) cnt = x - cnt;\n                res += (1ll*cnt) << j;\n            }\n            u = ch[u][tag[i]^1];\n            val |= (tag[i]^1) << i;\n        }\n\t}\n    return res + 1ll * (val ^ X) * p;\n}\nvoid insert(int x) {\n\tint u = 1; for(int i = MW; i >= 0; --i) {\n\t\t++siz[u];\n\t\tfor(int j = 0; j <= MW; ++j) s[u][j] += ((x>>j)&1);\n\t\tint p = ((x>>i)&1);\n\t\tu = ch[u][p] ? ch[u][p] : ch[u][p] = ++cntc;\n\t} ++siz[u];\n\tfor(int j = 0; j <= MW; ++j) s[u][j] += x>>j&1;\n}\nlint qryx(int l, int r) {\n\tint len = r - l + 1; lint res = 0;\n\tfor(int i = 0; i <= MW; ++i) {\n\t\tint cnt = pre[r][i] - pre[l-1][i];\n        if(X>>i&1) cnt = len - cnt;\n        res += (1ll*cnt) << i;\n\t} return res;\n}\nvoid srt() {for(int i = 0; i <= MW; ++i) tag[i] = (X>>i)&1;}\nlint query(int l, int r) {\n\tif(r <= _n) return qry(r) - qry(l-1);\n\tif(l > _n) return qryx(l, r);\n\treturn qry(_n) - qry(l-1) + qryx(_n+1, r);\n}\nint main() {\n\tn = read(); _n = 0;\n\tfor(int i = 1; i <= n; ++i) {\n\t\ta[i] = read();\n\t\tfor(int k = 0; k < MW; ++k)\n\t\t\tpre[i][k] = pre[i-1][k] + ((a[i]>>k)&1);\n\t} m = read();\n\tfor(int opt, l, r, x; m--; ) {\n\t\topt = read();\n\t\tif(opt == 1) {\n\t\t\ta[++n] = read(); a[n] ^= X;\n\t\t\tfor(int k = 0; k < MW; ++k)\n\t\t\t\tpre[n][k] = pre[n-1][k] + ((a[n]>>k)&1);\n\t\t}\n\t\tif(opt == 2) {\n\t\t\tl = read(); r = read();\n\t\t\tprintf(\"%lld\\n\", query(l, r));\n\t\t}\n\t\tif(opt == 3) x = read(), X ^= x;\n\t\tif(opt == 4) {\n\t\t\tfor(int i = _n+1; i <= n; ++i) insert(a[i]);\n\t\t\t_n = n; srt();\n\t\t\tmemset(pre[n], 0, sizeof pre[n]);\n\t\t}\n\t}\n}\n\n```\n",
        "postTime": 1572010521,
        "uid": 2491,
        "name": "\u8bd7\u4e43",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5312 \u3010[Ynoi2011]D2T1\u3011"
    },
    {
        "content": "\u7531\u4e8e\u4e0d\u5361\u7a7a\u95f4\u4e0d\u5361\u5e38\uff0c\u6240\u4ee5\u5c31\u63d0\u4f9b\u4e00\u79cd\u6bd4\u8f83\u968f\u4fbf\u7684\u505a\u6cd5\u3002\n\n\u5982\u679c\u60f3\u8981\u505a\u6b64\u9898\u7684\u52a0\u5f3a\u7248\uff0c\u53ef\u4ee5\u5c1d\u8bd5 P5612\u3002\n\n\u7531\u4e8e\u8fd9\u4e2a\u6392\u5e8f\u6bd4\u8f83\u62c9\u8de8\uff0c\u53ea\u80fd\u5168\u5c40\u6392\uff0c\u6240\u4ee5\u5e8f\u5217\u662f\u7531\u4e00\u6bb5\u6392\u597d\u5e8f\u7684\u524d\u7f00\u52a0\u4e0a\u672a\u6392\u597d\u5e8f\u7684\u540e\u7f00\u7ec4\u6210\u3002\n\n\u5148\u8003\u8651\u7ef4\u62a4\u540e\u7f00\uff0c\u6bd4\u8f83\u7b80\u5355\u7684\u53ef\u4ee5\u60f3\u5230\u5f00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u5bf9\u4e8e $1$ \u64cd\u4f5c\u5c31\u76f4\u63a5\u5728\u5f00\u597d\u7684\u7ebf\u6bb5\u6811\u4e0a\u9884\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u52a0\u8fdb\u53bb\uff1b\u5bf9\u4e8e $2$ \u64cd\u4f5c\u5728\u7ebf\u6bb5\u6811\u4e0a\u62c6\u4f4d\u7ef4\u62a4\u5373\u53ef\uff0c\u5bf9\u4e8e $3$ \u64cd\u4f5c\u7ebf\u6bb5\u6811\u4e0a\u4e0b\u653e\u6807\u8bb0\u5373\u53ef\uff1b\u5bf9\u4e8e $4$ \u64cd\u4f5c\u5c06\u540e\u7f00\u52a0\u5165\u524d\u7f00\uff0c\u6e05\u7a7a\u540e\u7f00\uff1b\n\n\u5bf9\u4e8e\u524d\u7f00\uff0c\u8003\u8651\u5f00\u4e2a trie \u6811\u7ef4\u62a4\u3002\u5bf9\u4e8e $2$ \u64cd\u4f5c\u7ef4\u62a4\u6392\u540d\u4e3a $[l,r]$ \u7684\u6570\u7684\u548c\uff0c\u53ef\u4ee5\u62c6\u4f4d\u7ef4\u62a4\uff1b\u5bf9\u4e8e $3$ \u64cd\u4f5c\u76f4\u63a5 trie \u6811\u4e0a\u5de6\u53f3\u53cd\u8f6c\u7684\u540c\u65f6\u91cd\u65b0\u7ef4\u62a4\u6bcf\u4f4d\u7684\u6570\u91cf\uff1b\u5bf9\u4e8e $4$ \u64cd\u4f5c\u5c31\u8ba9\u540e\u7f00\u63d2\u5165\u524d\u7f00\u5373\u53ef\u3002\n\n\u8fd9\u6837\u53ef\u4ee5\u83b7\u5f97\u65f6\u7a7a $O(n \\log ^ 2 n)$ \u7684\u7b80\u5355\u505a\u6cd5\uff0c\u6ca1\u5b9e\u73b0\uff0c\u5e94\u8be5\u662f\u4f1a\u88ab\u5361\u5e38\u7684\u3002\n\n\u8003\u8651\u4e00\u79cd\u5e38\u6570\u8f83\u5c0f\u7684\u505a\u6cd5\u3002\n\n\u5047\u8bbe\u5168\u5c40\u90fd\u6309\u4f4d\u5f02\u6216\u4e0a\u4e00\u4e2a\u6570\u90a3\u4e48\u65b0\u63d2\u5165\u7684\u6570\u90fd\u5fc5\u987b\u6309\u4f4d\u5f02\u6216\u4e0a\u8fd9\u4e2a\u6570\u518d\u63d2\u5165\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u6bcf\u6b21\u9884\u5904\u7406 trie \u6bcf\u4e00\u5c42\u7684\u5b9e\u9645\u4ea4\u6362\u987a\u5e8f\uff0c\u540c\u65f6\u5b9e\u73b0\u4e5f\u66f4\u65b9\u4fbf\u3002\n\n\u5bf9\u4e8e\u540e\u7f00\u4e0d\u7528\u6570\u636e\u7ed3\u6784\uff0c\u76f4\u63a5\u7ef4\u62a4\u540e\u7f00\u5185\u6bcf\u4e00\u4f4d\u51fa\u73b0\u6570\u91cf\u7684\u524d\u7f00\u548c\uff0c\u8fd9\u6837\u5c31\u628a\u540e\u7f00\u7684 $2,3$ \u64cd\u4f5c\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u4e86\u53ea $O(\\log n)$\uff0c\u540c\u65f6\u4e0d\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e5f\u5e26\u6765\u4e86\u4e00\u5b9a\u7684\u5e38\u6570\u4f18\u52bf\u3002\n\n\u867d\u7136\u7a7a\u95f4 $O(n \\log ^ 2 n)$ \u5c31\u53ef\u4ee5\u901a\u8fc7\u4e86\uff0c\u4f46\u662f\u60f3\u83b7\u5f97\u66f4\u4f18\u7684\u7a7a\u95f4\u5c31\u53ea\u80fd\u727a\u7272\u70b9\u65f6\u95f4\uff0c\u79bb\u7ebf\u4e0b\u6765\u5bf9\u4e8e\u6bcf\u4e00\u4f4d\u5355\u72ec\u8dd1\u4e00\u904d\u64cd\u4f5c\uff0c\u5373\u53ef\u5c06\u7a7a\u95f4\u538b\u5230 $O(n \\log n)$\uff0c\u8c8c\u4f3c\u518d\u5728 Trie \u4e0a\u641e\u4e00\u4e9b\u64cd\u4f5c\u53ef\u4ee5\u628a\u7a7a\u95f4\u5361\u6210\u7ebf\u6027\u590d\u6742\u5ea6\u3002\n\n\u4e2a\u4eba\u53ea~~\u8d3a~~\u4e86\u65f6\u7a7a $O(n \\log ^ 2 n)$ \u7684\u505a\u6cd5\u5c31\u8dd1\u8def\u4e86\uff0c\u5982\u679c\u4ec5\u4e3a\u4e86\u901a\u8fc7\u6b64\u9898\u76f4\u63a5\u5199\u5c31\u597d\u4e86\u3002\u5982\u679c\u662f\u4e3a\u4e86\u7ec3\u4e60\u538b\u4f4d Trie \u4e4b\u7c7b\u7684\u6570\u636e\u7ed3\u6784\u4e5f\u53ef\u4ee5\u6765\u5199\u4e00\u4e0b\u6b64\u9898\uff0c\u53ea\u4e0d\u8fc7\u770b\u4e86\u4e00\u4e9b\u5b9e\u73b0\u611f\u89c9\u5e38\u6570\u4e5f\u4e00\u822c\uff0c\u5c31\u5feb\u4e86\u4e00\u70b9\uff0c\u4e0d\u77e5\u9053\u662f\u4e3a\u4ec0\u4e48\uff0c\u6bd5\u7adf\u5168\u4f4d\u8fd0\u7b97\u5b9e\u73b0\u7684\u8bdd\u5e94\u8be5\u5feb\u5f88\u591a\u3002\n\nPS\uff1a\u521a\u624d\u53c8\u60f3\u4e86\u4e0b\uff0c\u8c8c\u4f3c\u8fd9\u4e2a\u538b\u4f4d trie \u538b\u4e86\u8fd8\u4e0d\u5982\u4e0d\u538b\uff08\uff08\uff08        ",
        "postTime": 1646983131,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5312 [Ynoi2011] \u7ade\u8d5b\u5b9e\u9a8c\u73ed"
    },
    {
        "content": "# Description\n\n\u7ef4\u62a4\u957f\u4e3a $n$ \u7684\u6570\u7ec4 $A$\uff0c\u652f\u6301\u56db\u79cd\u64cd\u4f5c\uff1a\n\n- \u5728 $A$ \u672b\u7aef\u6dfb\u52a0\u4e00\u4e2a\u6570 $x$\u3002\n- \u7ed9\u51fa $[l,r]$\uff0c\u8be2\u95ee\u533a\u95f4\u548c\u3002\n- \u5c06 $A$ \u6574\u4f53\u5f02\u6216 $x$\u3002\n- \u5c06 $A$ \u5347\u5e8f\u6392\u5e8f\u3002\n\n$n,Q \\le 10^5, V \\le 10^9$\uff0c\u65f6\u9650 1s\uff0c\u7a7a\u9650 500MB\u3002\n\n# Solution\n\n\u505a\u8fd9\u79cd\u5c0f\u6e05\u65b0 ds \u9898\u7adf\u7136\u8c03\u4e86\u4e00\u5929\uff0c\u5b9e\u5728\u60ed\u6127\u2026\u2026\n\n-----\n\n\u8fd9\u9898\u7684\u601d\u8def\u8fd8\u662f\u6bd4\u8f83\u7cbe\u5999\u7684\uff0c\u6211\u4eec\u5fc5\u987b\u4ee5\u4e00\u79cd\u624b\u6bb5\u5c06\u5f02\u6216\u3001\u63d2\u5165\u3001\u6c42\u548c\u3001\u6392\u5e8f\u8fd9\u56db\u79cd\u770b\u4f3c\u6beb\u65e0\u76f8\u5173\u7684\u64cd\u4f5c\u7ed3\u5408\u8d77\u6765\uff0c\u5e76\u4e14\u8fbe\u5230\u4e00\u5230\u4e24\u4e2a $\\log$ \u7ea7\u522b\u7684\u590d\u6742\u5ea6\u3002\n\n\u4e0d\u59a8\u5047\u8bbe\u6ca1\u6709\u67d0\u79cd\u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u5bf9\u5e94\u7684\u6bcf\u4e2a\u505a\u6cd5\u7ed3\u5408\u8d77\u6765\uff0c\u5f97\u5230\u6b63\u89e3\u3002\n\n\u5047\u5982\u6ca1\u6709\u64cd\u4f5c 4\uff0c\u4e0d\u96be\u60f3\u5230\u5bf9\u6bcf\u4e00\u4f4d\u5206\u522b\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u7136\u540e\u5c06\u6bcf\u4e00\u4e2a\u6574\u4f53\u5f02\u6216\u7684 $x$ \u5f02\u6216\u8d77\u6765\u5f97\u5230\u5168\u5c40\u7684 $X$\u3002\u5bf9 $X$ \u7684\u6bcf\u4e00\u4f4d\u8ba8\u8bba 0/1\uff0c\u8ba1\u7b97\u6bcf\u4e00\u4f4d\u7684\u8d21\u732e\u5373\u53ef\u3002\n\n\u63d2\u5165\u7684\u65f6\u5019\u53ef\u4ee5\u5c06\u65b0\u63d2\u5165\u7684\u6570\u5f02\u6216\u4e00\u4e0b\u5f53\u524d\u7684 $X$\uff0c\u5728\u8ba1\u7b97\u7b54\u6848\u65f6\u5c31\u53ef\u4ee5\u5f97\u5230\u62b5\u6d88\u7684\u6548\u679c\u3002\n\n\u53c8\u8003\u8651\u6ca1\u6709\u64cd\u4f5c 3\uff0c\u5bf9\u8fd9\u4e2a\u6392\u5e8f\u64cd\u4f5c\uff0c\u5c06\u5f53\u524d\u7684\u6570\u7ec4\u5206\u4e3a\u5df2\u6392\u5e8f\u7684\u4e00\u6bb5\u548c\u65b0\u63d2\u5165\u7684\u4e00\u6bb5\u3002\n\n\u5bf9\u4e8e\u65b0\u63d2\u5165\u7684\u4e00\u6bb5\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e0a\u9762\u6ca1\u6709\u64cd\u4f5c 4 \u7684\u65b9\u6cd5\u3002\n\n\u5bf9\u4e8e\u5df2\u6392\u5e8f\u7684\u4e00\u6bb5\uff0c\u53ef\u4ee5\u7edf\u7edf\u63d2\u5165 01Trie \u4e2d\u3002\u56e0\u4e3a\u5df2\u7ecf\u6392\u8fc7\u5e8f\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1 01Trie \u4e2d\u5148 0 \u540e 1 \u7684\u533a\u95f4\u4e0e\u6570\u7ec4\u4e2d\u7684\u533a\u95f4\u76f8\u5bf9\u5e94\u3002\u8fd9\u68f5 01Trie\uff0c\u66f4\u50cf\u662f\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u7ed3\u70b9\u6240\u5bf9\u5e94\u7684\u5b50\u533a\u95f4\u4e2d\u6570\u7684\u6bcf\u4e00\u4f4d\u7684 1 \u7684\u4e2a\u6570\u3002\u8ba1\u7b97\u7b54\u6848\u65f6\uff0c\u53ef\u4ee5\u7c7b\u6bd4\u7ebf\u6bb5\u6811\uff0c\u505a\u5230\u533a\u95f4\u67e5\u8be2\uff08\u60f3\u4e00\u60f3\uff0c\u4e3a\u4ec0\u4e48\uff09\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u7684\u601d\u8def\u5df2\u7ecf\u975e\u5e38\u62df\u8fd1\u6b63\u89e3\uff0c\u53ef\u662f\u64cd\u4f5c 3 \u4f1a\u6539\u53d8\u5df2\u6392\u5e8f\u7684\u6570\u7684\u6027\u8d28\uff0c\u600e\u4e48\u529e\uff1f\n\n\u89c2\u5bdf\u5f02\u6216\u540e\u5bf9 01Trie \u4e2d\u7684\u5f71\u54cd\uff0c\u4e0d\u96be\u53d1\u73b0\u67d0\u4e00\u4f4d\u5f02\u6216 1\uff0c\u5bf9\u5e94\u7684\u662f\u5c06\u8be5\u5c42\u6bcf\u4e00\u4e2a\u7ed3\u70b9\u7684\u5de6\u53f3\u513f\u5b50\u4e92\u6362\u3002\n\n\u5e76\u4e0d\u9700\u8981\u771f\u6b63\u4ea4\u6362\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6392\u5e8f\u7684\u65f6\u5019\u5bf9\u6bcf\u4e00\u4f4d\u6253\u4e00\u4e2a\u6807\u8bb0\uff0c\u8bb0\u5f55\u8be5\u5e97\u771f\u5b9e\u7684\u5de6\u513f\u5b50\u662f\u54ea\u4e00\u4e2a\u5373\u53ef\u3002\n\n\u7efc\u4e0a\uff0c\u53ef\u4ee5\u5728 $\\mathcal O(n \\log^2 V)$ \u7684\u65f6\u7a7a\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u8be5\u9898\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u53ef\u4ee5\u5ffd\u7565\u6389\u53ea\u6709\u4e00\u4e2a\u513f\u5b50\u7684\u7ed3\u70b9\uff0c\u5bf9\u6df1\u5ea6\u8fdb\u884c\u538b\u7f29\uff0c\u8fd9\u6837\u7684\u8bdd\u6bcf\u6b21\u63d2\u5165\u53ea\u4f1a\u589e\u52a0 $\\mathcal O(1)$ \u4e2a\u7ed3\u70b9\uff0c\u53ef\u4ee5\u5c06\u7a7a\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u5230 $\\mathcal O(n \\log V)$\u3002\u53ea\u662f\u7b14\u8005\u7684\u4ee3\u7801\u4e2d\u5e76\u65e0\u5b9e\u73b0\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u5c1d\u8bd5\u3002\n\n# Code\n\n```cpp\ntypedef long long LL;\n\nconst int N=3.2e6+5,V=32;\n\nint n,sn,Q,tot=1,tx,a[N],s[N][V],sz[N],ch[N][2];\nLL pe[N][V];\nbitset<N> tg;\n\nvoid Ins(int x) {\n\tint u=1;\n\tfor (int i=30;i>=0;i--) {\n\t\tsz[u]++;\n\t\tfor (int j=0;j<=30;j++) s[u][j]+=((x>>j)&1);\n\t\tint p=(bool)(x&(1<<i));\n\t\tif (!ch[u][p]) ch[u][p]=++tot;\n\t\tu=ch[u][p];\n\t}\n\tsz[u]++;\n\tfor (int j=0;j<=30;j++) s[u][j]+=((x>>j)&1);\n}\n\nLL Qry(int x) {\n\tif (!x) return 0;\n\tint u=1;\n\tLL Res=0,Ans=0;\n\tfor (int i=30;i>=0;i--) {\n\t\tif (x<=sz[ch[u][tg[i]]]) u=ch[u][tg[i]],Res|=((1ll*tg[i])<<i);\n\t\telse {\n\t\t\tx-=sz[ch[u][tg[i]]];\n\t\t\tfor (int j=0;j<=30;j++)\n\t\t\t\tAns+=(1ll*((tx&(1<<j))?(sz[ch[u][tg[i]]]-s[ch[u][tg[i]]][j]):(s[ch[u][tg[i]]][j]))<<j);\n\t\t\tu=ch[u][tg[i]^1],Res|=(1ll*(tg[i]^1)<<i);\n\t\t}\n\t}\n\treturn Ans+(Res^tx)*x;\n\t//\u8fd9\u4e2a Res \u8ba1\u7b97\u7684\u662f\u5de6\u5b50\u6811\u4e0a\u7684\u6f0f\u7f51\u4e4b\u9c7c\uff0c\u5373 x \u6ca1\u6709\u88ab\u51cf\u5230\u4e3a 0 \u65f6\n}\n\nLL QryD(int l,int r) {\n\tif (r<=sn) return Qry(r)-Qry(l-1);\n\tint ln=r-l+1;\n\tif (l>sn) {\n\t\tLL Ans=0;\n\t\tfor (int j=0;j<=30;j++) {\n\t\t\tAns+=((tx&(1<<j))?(1ll*ln-(pe[r][j]-pe[l-1][j])):(pe[r][j]-pe[l-1][j]))*(1<<j);\n\t\t}\n\t\treturn Ans;\n\t}\n\tLL Ans=Qry(sn)-Qry(l-1);\n\tln=r-sn;\n\tfor (int j=0;j<=30;j++) Ans+=((tx&(1<<j))?(1ll*ln-pe[r][j]):pe[r][j])*(1<<j);\n\treturn Ans;\n}\n\nvoid srt() {\n\tfor (int j=30;j>=0;j--) tg[j]=((tx>>j)&1);\n}\n\nint main() {\n\tscanf(\"%d\",&n);\n\tfor (int i=1;i<=n;i++) {\n\t\tscanf(\"%d\",&a[i]);\n\t\tfor (int j=0;j<=30;j++) pe[i][j]=pe[i-1][j]+((a[i]>>j)&1);\n\t}\n\tscanf(\"%d\",&Q);\n\twhile (Q--) {\n\t\tint op;\n\t\tscanf(\"%d\",&op);\n\t\tif (op==1) {\n\t\t\tn++;\n\t\t\tscanf(\"%d\",&a[n]),a[n]^=tx;\n\t\t\tfor (int j=0;j<=30;j++) pe[n][j]=pe[n-1][j]+((a[n]>>j)&1);\n\t\t}\n\t\telse if (op==2) {\n\t\t\tint l,r;\n\t\t\tscanf(\"%d%d\",&l,&r);\n\t\t\tprintf(\"%lld\\n\",QryD(l,r));\n\t\t}\n\t\telse if (op==3) {\n\t\t\tint x;\n\t\t\tscanf(\"%d\",&x),tx^=x;\n\t\t}\n\t\telse {\n\t\t\tfor (int i=sn+1;i<=n;i++) Ins(a[i]);\n\t\t\tsn=n,srt();\n\t\t\tfor (int j=0;j<=30;j++) pe[n][j]=0;\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1643030570,
        "uid": 283913,
        "name": "ZillionX",
        "ccfLevel": 6,
        "title": "\u300c\u9898\u89e3\u300d[Ynoi2011] \u7ade\u8d5b\u5b9e\u9a8c\u73ed"
    },
    {
        "content": "\u538b \u4f4d T r i e \u5165 \u95e8 \u7ec3 \u4e60 \u9898\uff08\u786e\u4fe1\uff09\n\n\u9898\u610f\u5f88\u6e05\u695a\uff08\n\n\u8ba9\u6211\u4eec\u5148\u6765\u60f3\u4e00\u60f3\uff0c\u5982\u679c\u6ca1\u6709\u6392\u5e8f\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd9\u9053\u9898\u5e94\u8be5\u600e\u4e48\u505a\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a $ x $ \u8868\u793a\u4ece\u5f00\u59cb\u5230\u73b0\u5728\u4e00\u5171\u5f02\u6216\u4e0a\u4e86 $ x $\uff0c\u5728\u5e8f\u5217\u672b\u5c3e\u63d2\u5165\u4e00\u4e2a $ n $ \u76f8\u5f53\u4e8e\u63d2\u5165 $ n \\bigoplus x $\u3002\n\n\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f\uff1a\n\n1. \u8be2\u95ee $ \\sum_{i=l}^ra_i \\bigoplus x $\n2. \u6539\u53d8 $ x $\u3002\n\n\u4f4d\u8fd0\u7b97\u76f8\u5173\u7684\u8fd8\u662f\u8003\u8651\u6309\u4f4d\u62c6\u5206\u6bd4\u8f83\u597d\u3002\n\n\u5982\u679c\u6211\u4eec\u80fd\u591f\u77e5\u9053\u8fd9\u4e2a\u533a\u95f4\u4e2d\u7684\u7b2c $ k $ \u4f4d\u6709\u591a\u5c11\u4e2a $ 1 $\uff0c\u4f3c\u4e4e\u5c31\u80fd\u591f $ O(k) $ \u8ba1\u7b97\u8fd9\u4e00\u4f4d\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e86\u3002\n\n\u4e8e\u662f\u6211\u4eec\u4f7f\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u8fd9\u4e2a\u5e8f\u5217\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u5f00\u4e00\u4e2a $ \\log V $ \u7684\u6570\u7ec4\u6765\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\uff0c\u63d2\u5165\u548c\u8be2\u95ee\u7684\u590d\u6742\u5ea6\u5747\u4e3a $ O(\\log n\\log V) $\u3002\n\n\u90a3\u4e48\u6211\u4eec\u52a0\u4e0a\u6392\u5e8f\u64cd\u4f5c\uff1f\n\n\u4f17\u6240\u5468\u77e5 01trie \u5c31\u662f\u7ebf\u6bb5\u6811\uff0c\u4e8e\u662f\u6211\u4eec\u5148\u628a\u7ebf\u6bb5\u6811\u6539\u6210 01trie\u3002\n\n\u6211\u4eec\u53d1\u73b0\u5f02\u6216\u4e0a\u4e00\u4e2a\u6570\u53ef\u4ee5\u770b\u505a\u5c06\u67d0\u51e0\u5c42\u7684\u5de6\u513f\u5b50\u548c\u53f3\u513f\u5b50\u4ea4\u6362\u3002\n\n\u7136\u540e\u5728\u8be2\u95ee\u7684\u65f6\u5019\u641e\u6e05\u695a\u8fd9\u4e00\u5c42\u6709\u6ca1\u6709\u4ea4\u6362\u5de6\u53f3\u513f\u5b50\uff0c\u7136\u540e\u5224\u65ad\u7a76\u7adf\u8be5\u8d70\u54ea\u8fb9\u548c\u8be5\u52a0\u4e0a\u54ea\u8fb9\u5c31\u884c\u4e86\u3002\n\n\u81f3\u4e8e\u5b9e\u73b0\u7684\u8bdd\uff0c\u5bf9\u6392\u5e8f\u540e\u7684\u90e8\u5206\u5f00\u4e00\u9897 01trie\uff0c\u672a\u6392\u5e8f\u7684\u90e8\u5206\u76f4\u63a5\u4f7f\u7528\u524d\u7f00\u548c\u7edf\u8ba1\u3002\n\n\u65f6\u7a7a\u590d\u6742\u5ea6\u90fd\u662f $ O((n+m)\\log^2V) $\u3002\n\n\u7136\u800c\u4f60\u53d1\u73b0\u8fd9\u6837\u7b97\u4e0b\u6765\u5927\u6982\u662f 660MB\uff0c\u4f1a\u88ab\u5361\u7a7a\u95f4\u3002\u3002\u3002\n\n\u5982\u679c\u6211\u4eec\u80fd\u591f\u5c06 01trie \u7684\u8282\u70b9\u6570\u91cf\u51cf\u5c11\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7a7a\u95f4\u538b\u4e0b\u6765\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5c06 01trie \u6539\u6210\u538b\u4e24\u4f4d\u7684 \u538b\u4f4d trie\uff08\u4e5f\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u7684\u5ea6\u6570\u4e3a $ 4 $\uff09\uff0c\u7a7a\u95f4\u5c31\u53ef\u4ee5\u9664\u4ee5 $ 2 $ \u4e86\u3002\n\n\u56e0\u4e3a\u513f\u5b50\u4e2a\u6570\u5e76\u4e0d\u662f\u74f6\u9888\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n~~\u867d\u7136\u8bf4\u5427\uff0c\u4f60\u53ef\u4ee5\u53bb\u8d4c lxl \u7684\u63d2\u5165\u64cd\u4f5c\u5f88\u5c11\uff0c\u4f46\u662f\u8fd9\u660e\u663e\u8fd8\u662f\u4f1a\u88ab\u5361\uff08~~\n\n\u4ee5\u53ca\u7ec6\u8282\u5de8\u591a\uff0c\u9700\u8981\u5224\u76f8\u540c\u7684\u6570\uff0c~~\u8fd8\u8981\u5224\u65ad\u6211\u5728\u4ec0\u4e48\u65f6\u5019\u5f02\u6216\u4e0a\u4e86\u591a\u5c11\u3002~~\n```cpp\n#include<cstdio>\ntypedef unsigned ui;\nconst ui M=1e5+5,N=M*32;\nui n,m,cnt,k,tk,l1,l2,rt,ans[31],a[M<<1],S[M<<1][31];ui L,X[2];\nstruct Node{\n\tui sz,chi[4],ans[31];\n\tinline ui&operator[](const ui&x){\n\t\treturn chi[x];\n\t}\n}t[N];\ninline void swap(ui&a,ui&b){\n\tui c=a;a=b;b=c;\n}\nui Find(const ui&u,ui x,const ui&id=14){\n\tif(!u)return X[L++]=x,0;if(!~id)return X[L++]=x,0;const ui&k=tk>>(id<<1)&3;\n\tif(x<=t[t[u][0^k]].sz)return Find(t[u][0^k],x,id-1)|0<<(id<<1);x-=t[t[u][0^k]].sz;\n\tif(x<=t[t[u][1^k]].sz)return Find(t[u][1^k],x,id-1)|1<<(id<<1);x-=t[t[u][1^k]].sz;\n\tif(x<=t[t[u][2^k]].sz)return Find(t[u][2^k],x,id-1)|2<<(id<<1);x-=t[t[u][2^k]].sz;\n\tif(x<=t[t[u][3^k]].sz)return Find(t[u][3^k],x,id-1)|3<<(id<<1);x-=t[t[u][3^k]].sz;\n}\nvoid Qry(const ui&u,const ui&l,const ui&r,const ui&L=0,const ui&R=(1<<30)-1,const ui&id=14){\n\tif(!u||l>R||L>r)return;\n\tif(l<=L&&R<=r){\n\t\tfor(ui i=0;i<=30;++i)ans[i]+=t[u].ans[i];return;\n\t}\n\tui k=tk>>(id<<1)&3,m1,m2,m3;m2=L+R>>1;m1=L+m2>>1;m3=m2+1+R>>1;\n\tQry(t[u][0^k],l,r,L,m1,id-1);Qry(t[u][1^k],l,r,m1+1,m2,id-1);\n\tQry(t[u][2^k],l,r,m2+1,m3,id-1);Qry(t[u][3^k],l,r,m3+1,R,id-1);\n}\nvoid Insert(const ui&x){\n\tui u=rt,id=14;\n\twhile(~id){\n\t\t++t[u].sz;for(ui i=0;i<=30;++i)if(x>>i&1)++t[u].ans[i];\n\t\tif(!t[u][x>>(id<<1)&3])t[u][x>>(id<<1)&3]=++cnt;u=t[u][x>>(id<<1)&3];--id;\n\t}\n\t++t[u].sz;for(ui i=0;i<=30;++i)if(x>>i&1)++t[u].ans[i];\n}\ninline void ins(const ui&x,const ui&id){\n\tfor(ui i=0;i<=30;++i)S[id][i]=S[id-1][i]+(x>>i&1);a[id]=x;\n}\nsigned main(){\n\tui i,x,l,r,q,p,opt;unsigned long long sum;scanf(\"%u\",&n);rt=++cnt;\n\tfor(i=1;i<=n;++i)scanf(\"%u\",&x),ins(x,++l2);\n\tscanf(\"%u\",&m);\n\twhile(m--){\n\t\tscanf(\"%u\",&opt);\n\t\tif(opt==1){\n\t\t\tscanf(\"%u\",&x);ins(x^k,++l2);\n\t\t}\n\t\tif(opt==2){\n\t\t\tscanf(\"%u%u\",&l,&r);for(i=0;i<=30;++i)ans[i]=0;sum=0;\n\t\t\tif(r<=l1){\n\t\t\t\tq=Find(rt,l);p=Find(rt,r);if(q^p)Qry(rt,q,p-1);--X[0];\n\t\t\t\tfor(i=0;i<=30;++i)sum+=1ull*(k>>i&1?r-l+1+X[0]-X[1]-ans[i]:ans[i])<<i;\n\t\t\t\tsum+=1ull*(p^k^tk)*X[1];sum-=1ull*(q^k^tk)*X[0];\n\t\t\t}\n\t\t\tif(l<=l1&&l1<r){\n\t\t\t\tq=Find(rt,l);Qry(rt,q,(1<<30)-1);--X[0];\n\t\t\t\tfor(i=0;i<=30;++i)sum+=1ull*(k>>i&1?l1-l+1+X[0]-ans[i]:ans[i])<<i;\n\t\t\t\tfor(i=0;i<=30;++i)sum+=1ull*(k>>i&1?r-l1-S[r-l1][i]:S[r-l1][i])<<i;\n\t\t\t\tsum-=1ull*(q^k^tk)*X[0];\n\t\t\t}\n\t\t\tif(l1<l){\n\t\t\t\tr-=l1;l-=l1;\n\t\t\t\tfor(i=0;i<=30;++i)sum+=1ull*(k>>i&1?r-l+1-(S[r][i]-S[l-1][i]):(S[r][i]-S[l-1][i]))<<i;\n\t\t\t}\n\t\t\tprintf(\"%llu\\n\",sum);::L=0;\n\t\t}\n\t\tif(opt==3){\n\t\t\tscanf(\"%u\",&x);k^=x;\n\t\t}\n\t\tif(opt==4){\n\t\t\tfor(i=1;i<=l2;++i)Insert(a[i]);l1+=l2;tk=k;l2=0;\n\t\t}\n\t}\n}\n```",
        "postTime": 1641455645,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u636e\u7ed3\u6784 \u538b\u4f4dtrie P5312\u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P5312)\n\n\u9898\u610f\uff1a\u7ef4\u62a4\u4e00\u4e2a\u5e8f\u5217\u652f\u6301\uff1a\u52a0\u4e00\u4e2a\u6570\u3001\u6574\u4f53\u5f02\u6216\u3001\u6574\u4f53\u6392\u5e8f\u3001\u6c42\u533a\u95f4\u548c\u3002\n\n#### $\\text{Step 1}$\n\n\u5148\u8003\u8651\u6ca1\u6709\u52a0\u5165\u4e00\u4e2a\u6570\u8be5\u600e\u4e48\u505a\u3002\n\n\u7531\u4e8e\u5f02\u6216\u4e0e\u6392\u5e8f\u90fd\u662f\u57fa\u4e8e\u6574\u4f53\u7684\uff0c\u8bb0\u5f55**\u6700\u8fd1\u4e00\u6b21\u6392\u5e8f\u65f6**\u6574\u4f53\u5f02\u6216\u4e0a\u4e86 $s$ \uff0c\u4ee5\u53ca**\u5f53\u524d\u5e8f\u5217**\u6574\u4f53\u5f02\u6216\u4e0a\u4e86 $t$ \n\n\u90a3\u67e5\u8be2\u533a\u95f4 $[l,r]$ \u7684\u548c\u5c31\u76f8\u5f53\u4e8e\u67e5\u8be2\u5e8f\u5217\u4e2d\u5f02\u6216\u4e0a $s$ \u540e\uff0c\u524d $r$ \u5c0f\u7684\u503c\u5f02\u6216\u4e0a $t$ \u4e4b\u548c\uff0c\u51cf\u53bb\u524d $l-1$ \u5c0f\u7684\u503c\u5f02\u6216\u4e0a $t$ \u4e4b\u548c\u3002\n\n\u6240\u4ee5\u73b0\u5728\u8981\u7ef4\u62a4\u7684\u5c31\u662f\uff1a\u5f02\u6216 $s$ \u540e\u524d $k$ \u5c0f\u7684\u5f02\u6216\u4e0a $t$ \u7684\u548c\u3002\n\n\u90a3\u5c31\u53ef\u4ee5\u7528 $\\text{01trie}$ \u53bb\u7ef4\u62a4\u5f02\u6216 $s$ \u540e\u524d $k$ \u5c0f\uff0c\u7136\u540e\u5728 $\\text{01trie}$ \u4e0a\u62c6\u4f4d\uff0c\u8bb0\u5f55\u5f02\u6216 $s$ \u540e\u524d $k$ \u5c0f\u7684\u6570\u5728\u6bcf\u4e00\u4f4d\u4e0a\u6709\u591a\u5c11\u4e2a $1$ \uff0c\u7b2c $j$ \u4f4d\u4e0a $1$ \u7684\u4e2a\u6570\u8bb0\u4e3a $sum_j$ \u3002\n\n\u518d\u5bf9 $t$ \u62c6\u4f4d\u7edf\u8ba1\u8d21\u732e\uff0c\u5982\u679c $t$ \u5728\u7b2c $j$ \u4f4d\u4e0a\u4e3a $0$ \uff0c\u90a3\u5f02\u6216\u540e\u4f1a\u4ea7\u751f $sum_j\\times 2^j$ \u7684\u8d21\u732e\uff0c\u82e5  $t$ \u5728\u7b2c $j$ \u4f4d\u4e0a\u4e3a $1$ \uff0c\u90a3\u5f02\u6216\u540e\u4f1a\u4ea7\u751f  $(k-sum_j)\\times2^j$ \u7684\u8d21\u732e\u3002\n\n\u8fd9\u6837\u65f6\u7a7a\u590d\u6742\u5ea6\u90fd\u662f $O(n\\log^2 n)$ \u7684\uff0c\u4f46\u4e1d\u6beb\u4e0d\u5361\u3002\n\n#### $\\text{Step 2}$\n\n\u518d\u8003\u8651\u6709\u52a0\u6570\u8be5\u5982\u4f55\u5b9e\u73b0\u3002\n\n\u52a0\u6570\u4f1a\u4f7f\u5f97\u5e8f\u5217\u4e2d\u4e00\u90e8\u5206\u662f\u65e0\u9700\u6bb5\uff0c\u4f46\u6709\u5e8f\u6bb5\u4ecd\u53ef\u4ee5\u7528\u4e0a\u8ff0\u65b9\u6cd5\u3002\n\n\u53ea\u9700\u5728\u6392\u5e8f\u662f\u8981\u628a \u628a\u65e0\u5e8f\u6bb5\u4e2d\u7684\u6570\u5f02\u6216\u4e0a \u5b83\u4eec**\u52a0\u8fdb\u5e8f\u5217\u65f6**\u6574\u4e2a\u5e8f\u5217\u5f02\u6216\u7684\u503c\u3002\n\n\u8fd9\u662f\u4e3a\u4e86\u4fdd\u8bc1\u67e5\u8be2\u65f6\u8fd9\u4e9b\u6570\u4ecd\u662f**\u57fa\u4e8e\u6574\u4f53\u7684** \u201c \u5f02\u6216 $s$ \u540e\u524d $k$ \u5c0f\u7684\u5f02\u6216\u4e0a $t$ \u7684\u548c \u201d\u3002\n\n\u800c\u5bf9\u4e8e\u65e0\u5e8f\u6bb5\uff0c\u5f53\u7136\u53ef\u4ee5\u62c6\u4f4d\u5efa\u7ebf\u6bb5\u6811\uff0c\u5728\u6574\u4f53\u5f02\u6216\u65f6\u6253\u533a\u95f4 $01$  \u4e92\u6362\u7684\u6807\u8bb0\u3002\n\n\u4f46\u8fd8\u6709\u66f4\u5feb\u7684\u4e00\u4e2a $\\log$ \u7684\u505a\u6cd5\uff1a\n\n\u4ecd\u7136\u8ba9\u8fd9\u4e9b\u503c\u5728\u52a0\u8fdb\u6765\u65f6\uff0c\u5f02\u6216\u4e0a**\u5f53\u524d\u5e8f\u5217**\u5f02\u6216\u7684\u503c\uff0c\u4fdd\u8bc1\u67e5\u65f6\u662f\u57fa\u4e8e\u6574\u4f53\u7684\u5f02\u6216\u4e0a $t$ \u3002\n\n\u7136\u540e\u5bf9\u6bcf\u4e00\u4f4d\u7528**\u524d\u7f00\u548c**\u8bb0\u5f55\u524d $i$ \u4e2a\u6570\u5728\u7b2c $j$ \u4f4d\u4e0a $1$   \u7684\u4e2a\u6570 $f_i^j$\u3002\n\n\u90a3\u67e5\u4e00\u4e2a\u65e0\u5e8f\u6bb5\u7684\u533a\u95f4 $[l,r]$ \u4e4b\u548c\u65f6\uff0c\u540c\u6837\u5bf9 $t$ \u62c6\u4f4d\uff0c\u5982\u679c $t$ \u5728\u7b2c $j$ \u4f4d\u4e0a\u4e3a $0$ \uff0c\u90a3\u5f02\u6216\u540e\u4f1a\u4ea7\u751f $(f_r^j-f_{l-1}^j)\\times 2^j$ \u7684\u8d21\u732e\uff0c\u82e5  $t$ \u5728\u7b2c $j$ \u4f4d\u4e0a\u4e3a $1$ \uff0c\u90a3\u5f02\u6216\u540e\u4f1a\u4ea7\u751f  $(r-l+1-(f_r^j-f_{l-1}^r))\\times2^j$ \u7684\u8d21\u732e\u3002\n\n\u90a3\u67e5\u8be2\u65f6\u6309\u65e0\u5e8f\u6bb5\u4e0e\u6709\u5e8f\u6bb5\u5206\u5f00\u7edf\u8ba1\u8d21\u732e\u5c31\u884c\u4e86\u3002\n\n#### \u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=2e5+10,K=31;\nint n,m,x,y,xx,yy,s,ss,last,opt,rt,tot;\nll ans;int a[N];char ch;\nint tmp[K+1];\ninline void read(int &x){\n\tx=0;ch=getchar();\n\twhile(ch<48||ch>57)ch=getchar();\n\twhile(ch>47&&ch<58)x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n}\nvoid write(ll x){if(x>9)write(x/10);putchar(48+x%10);}\n#define lowbit(i) i&(-i)\nint sum[K+1][N];bool c[K+1];\nstruct trie{int son[2],s,t[K+1];}t[N*(K+1)];\nvoid update(int &k,int x,int i){\n\tif(!k)k=++tot;++t[k].s;\n\tfor(int j=K;~j;--j)t[k].t[j]+=c[j];\n\tif(~i)update(t[k].son[(x>>i)&1],x,i-1);\n}\nvoid inquiry(int k,int x,int kth,int i){\n\tif(i<0)for(int j=K;~j;--j)tmp[j]+=min(t[k].t[j],kth);\n\telse {\n\t\tbool b=(x>>i)&1;int ksb=t[k].son[b];\n\t\tif(t[ksb].s>=kth)inquiry(ksb,x,kth,i-1);\n\t\telse {\n\t\t\tfor(int j=K;~j;--j)tmp[j]+=t[ksb].t[j];\n\t\t\tinquiry(t[k].son[!b],x,kth-t[ksb].s,i-1);\n\t\t}\n\t}\n}\nmain(){\n\tread(n);register int i,j;\n\tlast=1;\n\tfor(i=1;i<=n;++i){\n\t\tread(x);a[i]=x;\n\t\tfor(j=K;~j;--j)sum[j][i]=sum[j][i-1]+((x>>j)&1);\n\t}\n\tread(m);\n\twhile(m--){\n\t\tread(opt);\n\t\tif(opt==1){\n\t\t\t++n;read(x);x^=s;a[n]=x;\n\t\t\tfor(j=K;~j;--j)sum[j][n]=sum[j][n-1]+((x>>j)&1);\n\t\t}\n\t\telse if(opt==3)read(x),s^=x;\n\t\telse if(opt==4){\n\t\t\tss=s;\n\t\t\tfor(;last<=n;++last){\n\t\t\t\tx=a[last];\n\t\t\t\tfor(j=K;~j;--j)c[j]=(x>>j)&1;\n\t\t\t\tupdate(rt,x,K);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tread(x),read(y);\n\t\t\tans=0;\n\t\t\tif(y>=last){\n\t\t\t\txx=max(x,last)-1;\n\t\t\t\tfor(j=K;~j;--j){\n\t\t\t\t\tif((s>>j)&1)ans+=(1ll<<j)*(y-sum[j][y]-xx+sum[j][xx]);\n\t\t\t\t\telse ans+=(1ll<<j)*(sum[j][y]-sum[j][xx]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(x<last){\n\t\t\t\tyy=min(y,last-1);\n\t\t\t\tinquiry(rt,ss,yy,K);\n\t\t\t\tfor(j=K;~j;--j){\n\t\t\t\t\tif((s>>j)&1)ans+=(1ll<<j)*(yy-tmp[j]);\n\t\t\t\t\telse ans+=(1ll<<j)*tmp[j];\n\t\t\t\t\ttmp[j]=0;\n\t\t\t\t}\n\t\t\t\tinquiry(rt,ss,x-1,K);\n\t\t\t\tfor(j=K;~j;--j){\n\t\t\t\t\tif((s>>j)&1)ans-=(1ll<<j)*(x-1-tmp[j]);\n\t\t\t\t\telse ans-=(1ll<<j)*tmp[j];\n\t\t\t\t\ttmp[j]=0;\n\t\t\t\t}\n\t\t\t}\n\t\t\twrite(ans);putchar('\\n');\n\t\t}\n\t}\n}\n```",
        "postTime": 1633256318,
        "uid": 334380,
        "name": "Y_B_X",
        "ccfLevel": 7,
        "title": "\u9898\u89e3[P5312\u7ade\u8d5b\u5b9e\u9a8c\u73ed]"
    },
    {
        "content": "## \u524d\u8a00\n\u4e8b\u60c5\u662f\u8fd9\u6837\u7684\uff1a\n\n\u5fb7\u6e29\u738b\u5b50\u653e\u4e86\u4e00\u5957 string \u4e13\u9879\u8bad\u7ec3\u9898\uff0c\u4f17\u6240\u5468\u77e5 string \u662f dead_X \u7684\u5f31\u9879\u3002\u5979\u770b\u7740\u4e00\u9053\u9053\u795e\u4ed9\u9898\u6beb\u65e0\u601d\u8def\uff0c\u76f4\u5230\u5979\u770b\u5230\u4e86\u8fd9\u4e2a\u9898\u2026\u2026\n## Section 1\n\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u6ca1\u6709 $3$ \u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u6570\u7ec4\u7684**\u524d\u4e00\u6bb5**\u662f\u6709\u5e8f\u7684\uff0c**\u540e\u4e00\u6bb5**\u662f\u65e0\u5e8f\u7684\u3002\n\n\u7136\u540e\u8be2\u95ee\u6709\u4e09\u79cd\u53ef\u80fd\uff1a\u6709\u5e8f\u7684\u4e00\u6bb5\uff0c\u65e0\u5e8f\u7684\u4e00\u6bb5\uff0c\u6709\u5e8f\u7684\u4e00\u6bb5\u52a0\u65e0\u5e8f\u7684\u4e00\u6bb5\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u5927\u529b\u5728\u6bcf\u6b21 $1$ \u64cd\u4f5c\u7684\u65f6\u5019\u5c06\u65e0\u5e8f\u8fd9\u6bb5\u7684\u6bcf\u4e2a\u5143\u7d20\u6254\u8fdb\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982**01-trie**\u3002\u5f53\u7136\u4e3a\u4ec0\u4e48\u4e0d\u53eb\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u5462\uff1f\u6211\u4eec\u7a0d\u540e\u518d\u8bf4\u3002\n\n**\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282\uff1a\u52a0\u5165\u4e00\u4e2a\u6570\u7684\u65f6\u5019\u8981\u628a\u8bfb\u5165\u7684\u6570 $\\oplus$ \u4e0a\u5168\u5c40\u5f02\u6216\u503c\uff0c\u4e5f\u5c31\u662f\u5047\u88c5\u5b83\u4e00\u76f4\u5728\u5e8f\u5217\u91cc\uff0c\u5f02\u6216\u4e86\u51e0\u6b21\u4e4b\u540e\u53d8\u6210\u4e86\u8bfb\u5165\u503c\u3002**\n## Section 2\n\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u6ca1\u6709 $2$ \u64cd\u4f5c\u7684\u65f6\u5019\u2026\u2026\n\n\u554a\uff0c\u8fd9\u4e2a\u5e94\u8be5\u662f\u4e2a\u4eba\u5c31\u4f1a\u5199\u5427\u3002\n\n\u7ef4\u62a4 $[l,r]$ \u4e2d**\u6bcf\u4e00\u4f4d\u4e0a** $0,1$ \u7684\u6570\u91cf\u548c**\u5168\u5c40\u5f02\u6216\u548c**\u5373\u53ef\u3002\n## Section 3\n\u5408\u5e76\u8d77\u6765\u7a0d\u7a0d\u6709\u70b9\u590d\u6742\uff0c\u56e0\u4e3a\u4e24\u4e2a\u7b80\u5355\u505a\u6cd5\u4e4b\u95f4\u7684\u6027\u8d28\u4f1a\u88ab\u76f8\u4e92\u7834\u574f\uff0c\u7136\u800c\u7a0d\u5fae\u6574\u5408\u4e00\u4e0b\u524d\u4e24\u4e2a\u4e1c\u897f\u5c31\u884c\u4e86\u3002\n\n\u6211\u4eec\u4ecd\u7136\u7ef4\u62a4**\u5168\u5c40\u5f02\u6216\u548c**\u548c**\u6709\u5e8f\u6bb5**\uff0c\u65e0\u5e8f\u6bb5\u6211\u4eec\u76f4\u63a5\u5957 Section 2 \u5373\u53ef\uff0c\u4e0b\u6587\u4e3b\u8981\u8bb2\u89e3**\u6709\u5e8f\u6bb5**\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u660e\u786e\u4e00\u4e2a\u4e8b\u60c5\uff1a\u6392\u5e8f\uff0c\u5f02\u6216\u6211\u4eec\u80af\u5b9a\u4e0d\u4f1a\u66b4\u529b\u53bb\u505a\uff0c\u4e00\u5b9a\u662f\u901a\u8fc7\u6253\u6807\u8bb0\u7684\u65b9\u5f0f\u95f4\u63a5\u5b9e\u73b0\u7684\u3002\n\n\u56e0\u6b64\u6211\u4eec\u5927\u529b\u5c06**\u6240\u6709**\u6700\u540e\u4e00\u6b21\u6392\u5e8f\u7684\u90a3\u6bb5\u6570\u90fd\u6254\u8fdb01-trie\u91cc\uff0c\u7136\u540e\u5206\u6790\u8fd9\u4e2a01-trie\u548c\u6b63\u5e38\uff08\u6240\u6709\u6570\u5f02\u6216\u5168\u5c40\u5f02\u6216\u503c\u540e\uff09\u768401-trie\u7684\u533a\u522b\u3002\n\n\u7a0d\u5fae\u624b\u73a9\u5c31\u80fd\u53d1\u73b0\uff0c\u8fd9\u4e2a\u5df2\u7ecf\u6392\u5e8f\u7684\u5e8f\u5217\u7b49\u4ef7\u4e8e\u539f\u59cb\u5e8f\u5217**\u5f02\u6216 $x$\uff0c\u6392\u5e8f\uff0c\u5f02\u6216 $y$**\uff0c\u7136\u540e $x$ \u548c $y$ \u90fd\u975e\u5e38\u597d\u7ef4\u62a4\uff0c\u6211\u4eec\u5c31\u975e\u5e38\u5957\u8def\u5730\u7ef4\u62a4\u6bcf\u4e2a\u70b9\u6bcf\u4e00\u4f4d\u662f $1$ \u7684\u4e2a\u6570\u7136\u540e\u6765\u4e00\u6ce2\u524d $k$ \u5927\u5373\u53ef\u3002\n\n\u7136\u540e\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u4e00\u4e2a\u5c0f tips\uff1a\u6709\u91cd\u590d\u7684\u6570\u8bb0\u5f97\u7279\u5224\uff0c\u6bd4\u5982\u8fd9\u7ec4\u6570\u636e\u3002\n\n```\n2\n10 10\n4\n2\n4 1 1\n4 2 2\n4 1 2\n```\n## \u4ee3\u7801\n\u7531\u4e8e\u9898\u89e3\u6709\u4eba\u653e\u4e86\u4ee3\u7801\u4e86\u90a3\u6211\u4e5f\u653e\u4e00\u4efd\u5427\u3002\n\n~~\u88abxxs\u6284\u4ee3\u7801\u662f\u6211\u7684\u8363\u5e78\u3002~~\n\n```\n//orz zhouAKngyang AK IOI!\n//\u53ef\u601c\u7684 dead_X \u8981\u9000\u5f79\u4e86\u2026\u2026\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9') ch=getchar();\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nint a[200003],pos,len;\nint pre[200003][31],ls[4000003],rs[4000003],bit[4000003][31],sz[4000003],num[4000003],cnt=1,x,tmpx,dx;\nvoid ins(int k)\n{\n    ++sz[1];\n    for(int j=0,p=1; j<=30; ++j,p<<=1) bit[1][j]+=((k&p)>0);\n    for(int i=30,t=1<<30,id=1; i>=0; --i,t>>=1) \n    {\n        if(k&t)\n        {\n            if(!rs[id]) rs[id]=++cnt,num[cnt]=num[id]+t;\n            id=rs[id];\n        }\n        else\n        {\n            if(!ls[id]) ls[id]=++cnt,num[cnt]=num[id];\n            id=ls[id];\n        }\n        for(int j=0,p=1; j<=30; ++j,p<<=1) bit[id][j]+=((k&p)>0);\n        ++sz[id];\n    }\n}\nlong long getsum(int t,int k,int id)\n{\n    if(!k||!id) return 0; \n    if(k==sz[id]) \n    {\n        long long res=0;\n        for(int j=0,p=1; j<=30; ++j,p<<=1) res+=1ll*p*((p&x)?(k-bit[id][j]):bit[id][j]);\n        return res; \n    }\n    if(t==0) { return 1ll*k*(num[id]^x); }\n    if(dx&t) if(k<=sz[rs[id]]) return getsum(t>>1,k,rs[id]); else return getsum(t>>1,sz[rs[id]],rs[id])+getsum(t>>1,k-sz[rs[id]],ls[id]); \n    else if(k<=sz[ls[id]]) return getsum(t>>1,k,ls[id]); else return getsum(t>>1,sz[ls[id]],ls[id])+getsum(t>>1,k-sz[ls[id]],rs[id]);\n}\nsigned main()\n{\n    len=read();\n    for(int i=1; i<=len; ++i) \n    {\n        a[i]=read();\n        for(int j=0,p=1; j<=30; ++j,p<<=1) pre[i][j]=pre[i-1][j]+((a[i]&p)>0);\n    }\n    for(int m=read(),op;m--;)\n    {\n        op=read();\n        if(op==1)\n        {\n            a[++len]=read()^x;\n            for(int j=0,p=1; j<=30; ++j,p<<=1) pre[len][j]=pre[len-1][j]+((a[len]&p)>0);\n        }\n        else if(op==3) \n        {\n            int g=read();\n            x^=g,tmpx^=g;\n        }\n        else if(op==4) \n        {\n            while(pos<len) ins(a[++pos]);\n            dx^=tmpx,tmpx=0;\n        }\n        else \n        {\n            int l=read(),r=read();long long res;\n            if(r<=pos) \n            {\n                res=getsum(1<<30,r,1)-getsum(1<<30,l-1,1);\n                printf(\"%lld\\n\",res);\n            }\n            else if(l>pos) \n            {\n                res=0;\n                for(int j=0,p=1; j<=30; ++j,p<<=1) res+=1ll*p*((p&x)?(r-l+1-pre[r][j]+pre[l-1][j]):(pre[r][j]-pre[l-1][j]));\n                printf(\"%lld\\n\",res);\n            }\n            else\n            {\n                res=getsum(1<<30,pos,1)-getsum(1<<30,l-1,1);\n                for(int j=0,p=1; j<=30; ++j,p<<=1) res+=1ll*p*((p&x)?(r-pos-pre[r][j]+pre[pos][j]):(pre[r][j]-pre[pos][j]));\n                printf(\"%lld\\n\",res);\n            }\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1608538249,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5312 \u3010[Ynoi2011]\u7ade\u8d5b\u5b9e\u9a8c\u73ed\u3011"
    }
]