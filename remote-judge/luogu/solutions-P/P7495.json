[
    {
        "content": "\u6837\u4f8b\u89e3\u91ca\u5df2\u7ecf\u5f88\u660e\u663e\u544a\u8bc9\u4f60\u5148\u8ba1\u7b97\u6240\u6709\u9009\u62e9\u5b50\u4e32\u65b9\u6848\u7684\u6982\u7387\u548c\u518d\u9664\u6389\u65b9\u6848\u6570\u4e86\u3002\n\n\u5148\u8003\u8651\u53bb\u6389 $l$ \u548c $r$ \u7684\u9650\u5236\u7684\u60c5\u51b5\u4e0b\u5982\u4f55\u8ba1\u7b97\u3002\n\n\u8bbe $f_{i,0/1}$ \u8868\u793a**\u6240\u6709**\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684\u5b50\u4e32\uff0c\u9009\u62e9\u76f8\u5e94\u7684 $b$\uff0c\u6ee1\u8db3 $b$ \u5bf9\u4e8e\u76f8\u5e94\u5b50\u4e32\u662f\u300c\u5fe0\u8bda\u7684\u300d\uff0c\u4e14 $b$ \u7684**\u7ed3\u5c3e**\u4e0e\u76f8\u5e94\u5b50\u4e32**\u76f8\u540c**/**\u4e0d\u540c**\u7684**\u6982\u7387\u548c**\u3002\n\n\u6709\u9012\u63a8\u5f0f $\\begin{cases}f_{i,0}=\\dfrac{1}{2}(f_{i-1,0}+f_{i-1,1}+1),f_{i,1}=\\dfrac{1}{2}(f_{i-1,0}+1)&a_i=0\\\\f_{i,0}=\\dfrac{1}{2}(f_{i-1,0}+f_{i-1,1}+1),f_{i,1}=\\dfrac{1}{2}(f_{i-1,1}+1)&a_i=1\\end{cases}$\u3002\n\n\u6216\u8005\u5199\u6210 $f_{i,0}=\\dfrac{1}{2}(f_{i-1,0}+f_{i-1,1})+\\dfrac{1}{2},f_{i,1}=\\dfrac{1}{2}(f_{i-1,a_i})+\\dfrac{1}{2}$\u3002\n\n\u7279\u522b\u7684\uff0c$f_{0,0}=f_{0,1}=0$\u3002\n\n\u89c2\u5bdf\u5982\u4f55\u7ed9\u8fd9\u4e2a\u5f0f\u5b50\u52a0\u4e0a $l$ \u548c $r$ \u7684\u9650\u5236\u3002\n\n\u6ce8\u610f\u5230\u5f0f\u5b50\u4e2d\u7684 $+\\dfrac{1}{2}$ \u5176\u5b9e\u5c31\u7c7b\u4f3c\u4e8e $l=1$ \u65f6\u4ea7\u751f\u7684\u9650\u5236\uff0c\u8fd9\u63d0\u793a\u6211\u4eec\u53ef\u4ee5\u5728 dp \u65f6\u4fdd\u7559\u4fdd\u7559\u5f0f\u5b50\u5176\u4ed6\u90e8\u5206\uff0c\u5c06 $+\\dfrac{1}{2}$ \u6839\u636e $l$ \u7684\u9650\u5236\u8fdb\u884c\u66f4\u6362\uff0c\u540c\u65f6\u518d\u6839\u636e $r$ \u7684\u9650\u5236\u518d\u5728\u539f\u5f0f\u4e2d\u51cf\u53bb\u4e00\u90e8\u5206\u3002\n\n\u56e0\u6b64\u6211\u4eec\u4fee\u6539 $f$ \u7684\u5b9a\u4e49\u3002\u8bbe $f_{i,0/1}$ \u8868\u793a**\u6240\u6709**\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684**\u4e14\u957f\u5ea6\u5728 $l$ \u5230 $r$ \u4e4b\u95f4\u7684\u5b50\u4e32**\uff0c\u9009\u62e9\u76f8\u5e94\u7684 $b$\uff0c\u6ee1\u8db3 $b$ \u5bf9\u4e8e\u76f8\u5e94\u5b50\u4e32\u662f\u300c\u5fe0\u8bda\u7684\u300d\uff0c\u4e14 $b$ \u7684**\u7ed3\u5c3e**\u4e0e\u76f8\u5e94\u5b50\u4e32**\u76f8\u540c**/**\u4e0d\u540c**\u7684**\u6982\u7387\u548c**\uff0c\u53e6\u5916\u8bbe $fl_{i,0/1},fr_{i,0/1}$ \u5206\u522b\u8868\u793a**\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684\u957f\u5ea6\u4e3a $l$ /\u4e3a $r+1$ \u7684\u5b50\u4e32**\uff0c\u6709**\u591a\u5c11\u4e2a 01 \u4e32** $b$ \u4f7f\u5f97 $b$ **\u5bf9\u5176\u662f\u300c\u5fe0\u8bda\u7684\u300d**\uff0c\u4e14$b$ \u7684**\u7ed3\u5c3e**\u4e0e\u5176**\u76f8\u540c**/**\u4e0d\u540c**\uff08\u5982\u679c $i< l$ / $i< r+1$\uff0c\u90a3\u4e48 $fl_{i,0}=fl_{i,1}=0$ / $fr_{i,0}=fr_{i,1}=0$\uff09\u3002\n\n\u4e8e\u662f\u6709 $f_{i,0}=\\dfrac{1}{2}(f_{i-1,0}+f_{i-1,1})+\\dfrac{fl_{i,0}}{2^l}-\\dfrac{fr_{i,0}}{2^{r+1}},f_{i,1}=\\dfrac{1}{2}(f_{i-1,a_i})+\\dfrac{fl_{i,1}}{2^l}-\\dfrac{fr_{i,1}}{2^{r+1}}$\u3002\n\n\u73b0\u5728\u7684\u95ee\u9898\u662f\u5982\u4f55\u8ba1\u7b97 $fl$ \u548c $fr$\u3002\n\n\uff08\u56e0\u4e3a\u4e24\u8005\u8ba1\u7b97\u65b9\u6cd5\u57fa\u672c\u76f8\u540c\u6240\u4ee5\u4e0b\u9762\u53ea\u8bb2\u4e00\u4e2a\uff09\n\n\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u8981\u8ba1\u7b97\u4e00\u4e2a\u4e32\u6709\u591a\u5c11\u4e2a\u4e32 $b$ \u5bf9\u5176\u662f\u300c\u5fe0\u8bda\u7684\u300d\uff0c\u8bbe $g_{i,0/1}$ \u8868\u793a\u5230\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u4e3a\u6b62\u6709\u591a\u5c11\u4e2a\u4e32\u5bf9\u5176\u662f\u300c\u5fe0\u8bda\u7684\u300d\u3002\n\n\u6709\u9012\u63a8\u5f0f $g_{i,0}=g_{i-1,0}+g_{i-1,1},g_{i,1}=g_{i-1,a_i}$\u3002\u7279\u522b\u7684\uff0c$g_{1,0}=g_{1,1}=1$\u3002\n\n\u628a\u9012\u63a8\u5f0f\u5199\u6210\u77e9\u9635\u7684\u5f62\u5f0f\uff0c\u6709\uff1a\n\n$\\begin{cases}\\begin{bmatrix}g_{i-1,0}&g_{i-1,1}\\end{bmatrix}\\begin{bmatrix}1&1\\\\1&0\\end{bmatrix}=\\begin{bmatrix}g_{i,0}&g_{i,1}\\end{bmatrix}&a_i=0\\\\\\begin{bmatrix}g_{i-1,0}&g_{i-1,1}\\end{bmatrix}\\begin{bmatrix}1&0\\\\1&1\\end{bmatrix}=\\begin{bmatrix}g_{i,0}&g_{i,1}\\end{bmatrix}&a_i=1\\end{cases}$\n\n\u56e0\u4e3a\u4e24\u79cd\u60c5\u51b5\u4f7f\u7528\u7684\u77e9\u9635\u4e0d\u540c\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8fdb\u884c\u77e9\u9635\u5feb\u901f\u5e42\u3002\u4f46\u6211\u4eec\u53d1\u73b0\u5728\u8ba1\u7b97\u65f6\u7528\u7684\u90fd\u662f\u4e00\u8fde\u4e32\u7684\u77e9\u9635\uff0c\uff0c\u5e76\u4e14\u5934\u90e8\u548c\u5c3e\u90e8\u90fd\u5f80\u4e00\u4e2a\u65b9\u5411\u79fb\u52a8\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728\u8ba1\u7b97\u65f6\u76f4\u63a5\u5728\u5c3e\u90e8\u4e58\u4e0a\u4e00\u4e2a\u65b0\u7684\u77e9\u9635\uff0c\u5e76\u5728\u5934\u90e8\u4e58\u4e0a\u4e00\u4e2a\u9006\u77e9\u9635\uff0c\u8fd9\u6837\u6bcf\u6b21\u53ea\u9700\u8981\u505a\u4e24\u6b21\u77e9\u9635\u4e58\u6cd5\u5c31\u80fd\u76f4\u63a5\u5f97\u5230\u65b0\u7684\u7528\u4e8e\u8ba1\u7b97\u7684\u77e9\u9635\u3002\u4ece\u800c\u8ba1\u7b97\u51fa $fl$ \u548c $fr$\u3002\n\n\u4e0a\u9762\u4e24\u4e2a\u77e9\u9635\u7684\u9006\u77e9\u9635\u5206\u522b\u4e3a $\\begin{bmatrix}0&1\\\\1&-1\\end{bmatrix}$ \u548c $\\begin{bmatrix}1&0\\\\-1&1\\end{bmatrix}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define p 998244353\nusing namespace std;\nstruct jx{\n\tint a[2][2];\n};\njx operator *(const jx &x,const jx &y)\n{\n\tjx z;\n\tz.a[0][0]=(1ll*x.a[0][0]*y.a[0][0]+1ll*x.a[0][1]*y.a[1][0])%p;\n\tz.a[1][0]=(1ll*x.a[1][0]*y.a[0][0]+1ll*x.a[1][1]*y.a[1][0])%p;\n\tz.a[0][1]=(1ll*x.a[0][0]*y.a[0][1]+1ll*x.a[0][1]*y.a[1][1])%p;\n\tz.a[1][1]=(1ll*x.a[1][0]*y.a[0][1]+1ll*x.a[1][1]*y.a[1][1])%p;\n\treturn z;\n}\njx A[2],B[2],aa;\nint n,l,r,a[5000005],fl[2][5000005],fr[2][5000005],f[2][5000005],ans,cho,pl,pr,p2;\nint P(int x,int y=p-2)\n{\n\tint z=1;\n\tfor(;y;x=1ll*x*x%p,y>>=1)if(y&1)z=1ll*z*x%p;\n\treturn z;\n}\nint main()\n{\n\tA[0].a[0][0]=A[0].a[0][1]=A[0].a[1][0]=1,B[0].a[0][1]=B[0].a[1][0]=1,B[0].a[1][1]=p-1;\n\tA[1].a[0][0]=A[1].a[1][0]=A[1].a[1][1]=1,B[1].a[0][0]=B[1].a[1][1]=1,B[1].a[1][0]=p-1;\n\tscanf(\"%d%d%d\",&n,&l,&r);\n\tpl=P(P(2,l)),pr=P(P(2,r+1)),cho=P((1ll*(n*2-l-r+2)*(r-l+1)/2)%p),p2=P(2);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tchar ch=getchar();\n\t\twhile(ch!='0'&&ch!='1')ch=getchar();\n\t\ta[i]=ch-'0';\n\t}\n\taa.a[0][0]=aa.a[1][1]=1,aa.a[0][1]=aa.a[1][0]=0;\n\tfor(int i=1;i<l;i++)aa=aa*A[a[i]];\n\tfor(int i=l;i<=n;i++)\n\t{\n\t\taa=B[a[i-l+1]]*aa*A[a[i]];\n\t\tfl[0][i]=(aa.a[0][0]+aa.a[1][0])%p,fl[1][i]=(aa.a[0][1]+aa.a[1][1])%p;\n\t}\n\taa.a[0][0]=aa.a[1][1]=1,aa.a[0][1]=aa.a[1][0]=0;\n\tfor(int i=1;i<=r;i++)aa=aa*A[a[i]];\n\tfor(int i=r+1;i<=n;i++)\n\t{\n\t\taa=B[a[i-r]]*aa*A[a[i]];\n\t\tfr[0][i]=(aa.a[0][0]+aa.a[1][0])%p,fr[1][i]=(aa.a[0][1]+aa.a[1][1])%p;\n\t}\n\tfor(int i=1;i<=n;i++)f[0][i]=((1ll*p2*(f[0][i-1]+f[1][i-1])+1ll*pl*fl[0][i]-1ll*pr*fr[0][i])%p+p)%p,f[1][i]=((1ll*p2*f[a[i]][i-1]+1ll*pl*fl[1][i]-1ll*pr*fr[1][i])%p+p)%p;\n\tfor(int i=1;i<=n;i++)ans=(ans+(f[0][i]+f[1][i])%p)%p;\n\tprintf(\"%lld\",1ll*ans*cho%p);\n}\n```",
        "postTime": 1613643213,
        "uid": 104581,
        "name": "kkk\u7684\u5c0f\u8214\u72d7",
        "ccfLevel": 8,
        "title": "\u5f02\u4f4d\u574d\u7f29 \u9898\u89e3"
    }
]