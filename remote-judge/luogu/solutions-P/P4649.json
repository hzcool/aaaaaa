[
    {
        "content": "[\u539f\u9898\u5730\u5740](http://ioi2007.hsin.hr/tasks/day2/training.pdf)\n\n[\u5b98\u65b9\u9898\u89e3](http://ioi2007.hsin.hr/tasks/solutions.pdf)\n\n[\u6211\u7684\u535a\u5ba2](https://zepto.page/post/ioi-2007-training)\n\n\n### \u9898\u610f\u6982\u8ff0\n\n\u7ed9\u5b9a $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe\uff0c\u4f60\u9700\u8981\u5220\u6389\u4e00\u4e9b\u8fb9\uff0c\u4f7f\u5f97\u6b64\u56fe\u6ca1\u6709\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u7b80\u5355\u73af\u3002 \n\n\u5220\u6389\u7b2c $i$ \u6761\u8fb9\u6709 $C_i$ \u7684\u82b1\u8d39\uff0c\u6709\u4e9b\u8fb9\u53c8\u662f\u4e0d\u80fd\u5220\u7684\u3002\u4e0d\u80fd\u5220\u7684\u8fb9\u5f62\u6210\u56fe\u7684\u4e00\u68f5\u751f\u6210\u6811\u3002 \n\n$n\\leq 1000,m \\leq 5000$\uff0c\u70b9\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7 10\u3002\n\n### \u601d\u8def\n\n\u5bf9\u4e8e\u6240\u6709\u975e\u6811\u8fb9\uff0c\u5982\u679c\u975e\u6811\u8fb9\u6240\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\u5728\u6811\u4e0a\u7684\u8ddd\u79bb\u4e3a\u5947\u6570\uff0c\u90a3\u4e48\u4f1a\u6784\u6210\u4e00\u4e2a\u5076\u73af\uff0c\u5220\u53bb\u8fd9\u4e9b\u8fb9\u3002\n\n\u8003\u8651\u4e24\u4e2a\u4ec5\u542b\u6709\u4e00\u6761\u975e\u6811\u8fb9\u7684\u5947\u73af\uff0c\u5982\u679c\u4ed6\u4eec\u5728\u6811\u4e0a\u7684\u90e8\u5206\u6709\u4ea4\uff0c\u90a3\u4e48\u628a\u4e24\u4e2a\u73af\u5408\u5e76\u5728\u4e00\u8d77\u518d\u53bb\u6389\u90a3\u4e9b\u91cd\u590d\u7684\u90e8\u5206\u5269\u4e0b\u7684\u5c31\u4e00\u5b9a\u662f\u4e00\u4e2a\u5076\u73af\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u9700\u8981\u7559\u4e0b\u4e00\u5f20\u56fe\uff0c\u4f7f\u5f97\u6ca1\u6709\u4e00\u6761\u8fb9\u540c\u65f6\u5c5e\u4e8e\u4e24\u4e2a\u7b80\u5355\u73af\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u4ed9\u4eba\u638c\uff08\u6b64\u5904\u6ca1\u6709\u8003\u8651\u5728\u6700\u521d\u5c31\u88ab\u6211\u4eec\u5220\u6389\u7684\u975e\u6811\u8fb9\uff09\u3002\u5bb9\u6613\u8bc1\u660e\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u65b9\u6848\u4e00\u5b9a\u5408\u6cd5\u3002\n\n\u5982\u679c\u8ba9\u6bcf\u6761\u975e\u6811\u8fb9\u8986\u76d6\u4ed6\u8fde\u63a5\u4e24\u70b9\u6811\u4e0a\u7684\u8def\u5f84\u4e0a\u7684\u6240\u6709\u8fb9\uff0c\u90a3\u4e48\u6811\u4e0a\u7684\u6bcf\u4e00\u6761\u8fb9\u6700\u591a\u53ea\u80fd\u88ab\u8986\u76d6\u4e00\u6b21\uff0c\u518d\u5c06\u5fc5\u987b\u5220\u9664\u7684\u6700\u5c0f\u8fb9\u6743\u6539\u4e3a\u603b\u8fb9\u6743-\u80fd\u7559\u4e0b\u7684\u6700\u5927\u8fb9\u6743\u3002\n\n\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u7684\u5ea6\u6570\u4e0d\u8d85\u8fc7 10\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u72b6\u6001\u538b\u7f29\u3002\n\n\u5b9a\u4e49 $f_{(i,S)}$ \u4e3a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u4e0d\u8003\u8651\u513f\u5b50\u96c6\u5408 $S$ \u7684\u6700\u5927\u8fb9\u6743\u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u5de6\u53f3\u7aef\u70b9$u, v$ \u7684 $LCA$ \u4e3a $i$ \u7684\u975e\u6811\u8fb9\uff0c\n\n- \u5982\u679c\u4e0d\u9009\u62e9\uff0c\u6b64\u65f6\u7684 $f_{(i,S)}=\\sum_{son\\notin S} f_{(son,0)}$\uff1b\n\n- \u5982\u679c\u9009\u62e9\u8fd9\u6761\u8fb9\uff0c\u8fd9\u6761\u8fb9\u7684\u8d21\u732e $val$ \u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\n\n1. $f_{(u,0)} + f_{(v,0)}$\n\n2. \u5bf9\u4e8e\u5230 $LCA$ \u8def\u5f84\u4e0a\u7684\u7684\u6bcf\u4e2a\u70b9 $p$\u3002\u8bbe\u5bf9\u4e8e $p$\uff0c\u4e0d\u5305\u542b $u$ \u6216 $v$ \u7684\u513f\u5b50\u96c6\u5408\u4e3a $K$\uff0c\u8d21\u732e\u4e3a $\\sum f_{(p,K)}$\n\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u70b9 $i$ \u7684\u5b50\u96c6 $S$\uff0c\u4ee4\u5b50\u6811\u5305\u542b $u,v$ \u7684\u513f\u5b50\u5206\u522b\u4e3a $x,y$\u3002\u5bf9\u4e8e $\\{ S| x\\notin S, y\\notin S\\}$\n\n$$f_{(i,S)}=\\max f_{(i,S|x|y)}+val$$\n\n\u6700\u7ec8\u7684\u7b54\u6848\u4e3a\u603b\u8fb9\u6743\u51cf\u53bb $f_{(root,0)}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta (m2^{10}+mn)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define max(a,b) (a>b?a:b)\n#define pb push_back\n#define maxn 1010\n#define maxm 5010\nstruct Edge{\n\tint to,next;\n\tEdge(int a=0,int b=0){\n\t\tto=a,next=b;\n\t}\n}l[maxn<<1];\nstruct Brid{\n\tint from,to,val;\n\tBrid(int a=0,int b=0,int c=0){\n\t\tfrom=a,to=b,val=c;\n\t}\n}H[maxm];\nint head[maxn],p[maxn][12],cnt,n,m;\nint dep[maxn],f[maxn][maxn<<2];\nint id[maxn],rid[maxn],tot,sum;\nstd::vector<int>B[maxn];\n//H \u5b58\u50a8\u9898\u76ee\u7ed9\u5b9a\u7684\u6240\u6709\u975e\u6811\u8fb9\n//B \u5b58\u50a8\u4e0d\u6784\u6210\u5076\u73af\u7684\u8fb9\uff0c\u5c06\u5b83\u6302\u5728\u76f8\u5e94\u7684 LCA \u5904\u3002\nvoid Add(int a=0,int b=0){\n\tl[++cnt]=Edge(b,head[a]);\n\thead[a]=cnt;\n}\nvoid Dfs(int u,int fa){\n\tdep[u]=dep[fa]+1;\n\tp[u][0]=fa;\n\tfor (register int i=1;i<12;i++)\n\tp[u][i]=p[p[u][i-1]][i-1];\n\tfor (register int i=head[u];i;i=l[i].next){\n\t\tint v=l[i].to;if (v!=fa) Dfs(v,u);\n\t}\n}\nint Lca(int a,int b){\n\tif (dep[b]<dep[a]) std::swap(a,b);\n\tfor (register int i=11;~i;i--)\n\t\tif (dep[p[b][i]]>=dep[a]) b=p[b][i];\n\tif (a==b) return a;\n\tfor (register int i=11;~i;i--)\n\t\tif (p[a][i]!=p[b][i])\n\t\ta=p[a][i],b=p[b][i];\n\treturn p[a][0];\n}\n#define fa(i) (p[i][0])\nvoid Solve(int u){\n\tint son=0;\n\tfor (register int i=head[u];i;i=l[i].next){\n\t\tint v=l[i].to;\n\t\tif (v==fa(u)) continue;\n\t\tSolve(v);\n\t}\n\tfor (register int i=head[u];i;i=l[i].next){\n\t\tint v=l[i].to;\n\t\tif (v==fa(u)) continue;\n\t\tid[son]=v,rid[v]=1<<son,son++;//id \u662f\u513f\u5b50\u7f16\u53f7\u5bf9\u5e94\u7684\u70b9\uff0crid \u662f\u6bcf\u4e2a\u70b9\u5728\u7236\u4eb2\u5904\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u4f4d\u7f6e\n\t}\n\tfor (register int S=0,tem=0;S<1<<son;++S,tem=0){\n\t\tfor (register int i=0;i<son;i++)\n\t\t\tif (!(S>>i&1))\n\t\t\ttem+=f[id[i]][0];\n\t\tf[u][S]=tem;\n\t}//\u4e0d\u9009\u62e9\u6302\u5728 u \u4e0a\u7684\u975e\u6811\u8fb9\u3002\n\tfor (register int k=B[u].size()-1;~k;--k){\n\t\tint i=B[u][k],tem=H[i].val;\n\t\tif (H[i].from!=u)\n\t\ttem+=f[H[i].from][0];\n\t\tif (H[i].to!=u)\n\t\ttem+=f[H[i].to][0];\n\t\tint a=0,b=0;\n\t\tif (H[i].from!=u)\n\t\t\tfor (a=H[i].from;fa(a)!=u;a=fa(a))\n\t\t\ttem+=f[fa(a)][rid[a]];\n\t\tif (H[i].to!=u)\n\t\t\tfor (b=H[i].to;fa(b)!=u;b=fa(b))\n\t\t\ttem+=f[fa(b)][rid[b]];\n\t\tfor (register int S=0;S<1<<son;++S)\n\t\t\tif ((S&rid[a])==0&&(S&rid[b])==0)\n\t\t\tf[u][S]=max(f[u][S],f[u][S|rid[a]|rid[b]]+tem);\n\t}\n}\n#undef fa\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor (register int i=1,a,b,c;i<=m;++i){\n\t\tscanf(\"%d%d%d\",&a,&b,&c);\n\t\tif (!c) Add(a,b),Add(b,a);\n\t\telse H[++tot]=Brid(a,b,c),sum+=c;\n\t}\n\tDfs(1,0);\n\tfor (register int i=1;i<=tot;++i){\n\t\tint t=Lca(H[i].from,H[i].to);\n\t\tif (!((dep[H[i].from]+dep[H[i].to]-2*dep[t])&1))\n\t\tB[t].pb(i);\n\t}\n\tSolve(1);\n\tprintf(\"%d\",sum-f[1][0]);\n\treturn 0;\n}\n```",
        "postTime": 1540944760,
        "uid": 37158,
        "name": "XG_Zepto",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4649 \u3010[IOI2007] training \u8bad\u7ec3\u8def\u5f84 \u3011"
    },
    {
        "content": "# \u6d1b\u8c37 P4649 \u9898\u89e3\n\n[$\\text{Link}$](https://www.luogu.com.cn/problem/P4649)\n\n## \u601d\u8def\u5206\u6790\n\n\u53cd\u9762\u8003\u8651\uff0c\u8ba1\u7b97\u6700\u591a\u80fd\u52a0\u51e0\u6761\u975e\u6811\u8fb9\u4f7f\u56fe\u4e0a\u6ca1\u6709\u5076\u73af\n\n\u5982\u679c\u67d0\u6761\u975e\u6811\u8fb9 $(u,v)$ \u6dfb\u52a0\u540e\u4f7f\u5f97 $u\\to \\operatorname{LCA}(u,v)\\to v\\to u$ \u7684\u957f\u5ea6\u4e3a\u5076\u6570\uff0c\u5219\u4e0d\u80fd\u5fc5\u9009\u62e9 $(u,v)$\n\n\u53ea\u8003\u8651\u6dfb\u52a0 $(u,v)$ \u4f7f\u5f97 $u\\to \\operatorname{LCA}(u,v) \\to v\\to u$ \u7684\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u8fb9 $(u,v)$\n\n\u5982\u679c\u4e24\u6761\u8fb9 $(u,v)$ \u548c $(x,y)$ \u7684\u6811\u4e0a\u8def\u5f84\u6709\u4ea4\u96c6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4e5f\u4f1a\u5f62\u6210\u4e00\u4e2a\u5076\u73af\uff1a\n\n[![vV2JmR.png](https://s1.ax1x.com/2022/08/03/vV2JmR.png)](https://imgtu.com/i/vV2JmR)\n\n\u6240\u4ee5\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u5728\u6811\u4e0a\u9009\u62e9\u82e5\u5e72\u6761\u4e0d\u76f8\u4ea4\u7684\u975e\u6811\u8fb9\u4f7f\u5f97\u5176\u6743\u503c\u548c\u6700\u5927\n\n\u8003\u8651\u5728\u6dfb\u52a0\u67d0\u6761\u975e\u6811\u8fb9 $(u,v)$ \u540e\u628a $u\\to v$  \u7684\u6240\u6709\u8fb9\u90fd\u5220\u6389\uff0c\u7136\u540e\u5206\u6210\u82e5\u5e72\u68f5\u5b50\u6811\u8fdb\u884c dp\n\n\u6211\u4eec\u628a\u6bcf\u6761\u975e\u6811\u8fb9 $(u,v)$ \u5728 $\\operatorname{LCA}(u,v)$ \u5904\u8003\u8651\uff0c\u8bbe $dp_{p,\\mathbf S}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\uff0c\u4e14 $p$ \u5230\u96c6\u5408 $\\mathbf S$\uff08\u72b6\u6001\u538b\u7f29\uff09\u4e2d\u7684\u513f\u5b50\u7684\u8fb9\u5df2\u7ecf\u88ab\u5220\u6389\u540e\u80fd\u9009\u62e9\u7684\u6700\u4f18\u7b54\u6848\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u6761\u8def\u5f84 $(u,v)$ \u6ee1\u8db3 $\\operatorname{LCA}(u,v)=p$ \u4ed6\u80fd\u5e26\u6765\u7684\u4ef7\u503c\u4e3a\uff1a\n$$\nvalue(u,v)=w(u,v)+\\sum_{x\\in path(u,v)}^{fa(x)\\neq p,x\\neq p} dp_{fa(x),\\{x\\}}\n$$\n\u8bbe $u\\to v$ \u7684\u8def\u5f84\u5305\u542b $x\\to p\\to y$ \u4e14 $x,y$ \u5747\u4e3a $p$ \u7684\u513f\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u7528\u8fd9\u4e2a\u4ef7\u503c\u53bb\u8f6c\u79fb\uff1a\n\n$$\n\\forall \\mathbf S:x,y\\not\\in \\mathbf S\\\\\ndp_{p,S}\\gets value(u,v)+dp_{p,\\mathbf S\\cup\\{x,y\\}}\n$$\n\n\u6700\u7ec8\u7684\u7b54\u6848\u4e3a $\\sum w(u,v)-dp_{1,\\varnothing}$\n\n \u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(m\\log n+n2^{|\\mathbf S|})$\n\n> \u603b\u7ed3\uff1a\n>\n> \u795e\u4ed9\u9898\n>\n> \u89c2\u5bdf\u6027\u8d28\u8f6c\u5316\u6210\u751f\u6210\u4ed9\u4eba\u638c\n>\n> \u7136\u540e\u72b6\u538b\u6811\u4e0a dp\n>\n> \u5f88\u5f3a\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=1001;\nvector <int> tree[MAXN];\nstruct node {\n\tint src,des,val;\n};\nvector <node> vec,link[MAXN];\nint dep[MAXN],fa[MAXN],siz[MAXN],son[MAXN],root[MAXN],fid[MAXN];\nint dp[MAXN][1<<10];\ninline int bit(int x) {\n\treturn 1<<x;\n}\ninline void init1(int p,int f) {\n\tfa[p]=f,siz[p]=1,dep[p]=dep[f]+1;\n\tfor(int v:tree[p]) {\n\t\tif(v==f) continue;\n\t\tinit1(v,p);\n\t\tsiz[p]+=siz[v];\n\t\tif(siz[v]>siz[son[p]]) son[p]=v;\n\t}\n}\ninline void init2(int p,int r) {\n\troot[p]=r;\n\tif(son[p]) init2(son[p],r);\n\tfor(int v:tree[p]) {\n\t\tif(v==son[p]||v==fa[p]) continue;\n\t\tinit2(v,v);\n\t}\n}\ninline void init3(int p) {\n\tfor(int i=0;i<tree[p].size();++i) {\n\t\tint v=tree[p][i];\n\t\tif(v==fa[p]) continue;\n\t\tfid[v]=bit(i);\n\t\tinit3(v);\n\t}\n}\ninline int LCA(int u,int v) {\n\twhile(root[u]!=root[v]) {\n\t\tif(dep[root[u]]<dep[root[v]]) swap(u,v);\n\t\tu=fa[root[u]];\n\t}\n\treturn dep[u]>dep[v]?v:u;\n}\ninline void dfs(int p) {\n\tfor(int v:tree[p]) {\n\t\tif(v==fa[p]) continue;\n\t\tdfs(v);\n\t}\n\tfor(int s=0;s<bit(tree[p].size());++s) {\n\t\tfor(int i=0;i<tree[p].size();++i) {\n\t\t\tif(!((s>>i)&1)) dp[p][s]+=dp[tree[p][i]][0];\n\t\t}\n\t}\n\tfor(auto e:link[p]) {\n\t\tint val=e.val,u=0,v=0;;\n\t\tif(e.src!=p) {\n\t\t\tval+=dp[e.src][0];\n\t\t\tfor(u=e.src;fa[u]!=p;u=fa[u]) val+=dp[fa[u]][fid[u]];\n\t\t}\n\t\tif(e.des!=p) {\n\t\t\tval+=dp[e.des][0];\n\t\t\tfor(v=e.des;fa[v]!=p;v=fa[v]) val+=dp[fa[v]][fid[v]];\n\t\t}\n\t\tint t=fid[u]|fid[v];\n\t\tfor(int s=0;s<bit(tree[p].size());++s) {\n\t\t\tif(!(s&t)) dp[p][s]=max(dp[p][s],val+dp[p][s|t]);\n\t\t}\n\t}\n}\nsigned main() {\n\tint n,m,res=0;\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=m;++i) {\n\t\tint u,v,w;\n\t\tscanf(\"%d%d%d\",&u,&v,&w);\n\t\tif(!w) {\n\t\t\ttree[u].push_back(v);\n\t\t\ttree[v].push_back(u);\n\t\t} else {\n\t\t\tres+=w;\n\t\t\tvec.push_back((node){u,v,w});\n\t\t}\n\t}\n\tinit1(1,0);\n\tinit2(1,1);\n\tinit3(1);\n\tfor(auto e:vec) {\n\t\tint lca=LCA(e.src,e.des);\n\t\tif(!((dep[e.src]+dep[e.des]-dep[lca]*2)&1)) link[lca].push_back(e);\n\t}\n\tdfs(1);\n\tprintf(\"%d\\n\",res-dp[1][0]);\n\treturn 0;\n}\n\n```",
        "postTime": 1659495706,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "\u6d1b\u8c37 P4649 \u9898\u89e3"
    }
]