[
    {
        "content": "[\u4f20\u9001\u95e8](/problem/P8504)\n\n#### \u5206\u6790\uff1a\n\n##### Subtask 1\uff1a\n\n$\\forall i$\uff0c$x_i=0\\lor y_i=0$\uff0c\u5373\u53ef\u80fd\u6027\u5e8f\u5217\u56fa\u5b9a\u3002\u6b64\u65f6\u662f\u4e00\u9053\u7ecf\u5178\u8d2a\u5fc3\u9898\uff1a\u60f3\u8c61\u6709\u4e00\u4e2a\u957f\u4e3a $a$ \u7684\u7a97\u53e3\u4ece $[1,a]$ \u6ed1\u52a8\u5230 $[n-a+1,n]$\uff0c\u6bcf\u6b21\u6ed1\u52a8\u540e\u9700\u8981\u4f7f\u7a97\u53e3\u5185\u7528\u4e8e\u805a\u96c6\u7684\u65f6\u523b\u6570\u4e0d\u5c0f\u4e8e $b$\u3002\u8003\u8651\u8d2a\u5fc3\uff0c\u5047\u8bbe\u7a97\u53e3\u5185\u5df2\u7ecf\u7528\u4e8e\u805a\u96c6\u7684\u65f6\u523b\u6570\u4e3a $b'$\uff0c\u90a3\u4e48\u9009\u6700\u53f3\u4fa7\u7684 $b-b'$ \u4e2a\u5b89\u5168\u4f46\u8fd8\u672a\u7528\u4e8e\u805a\u96c6\u7684\u65f6\u523b\uff0c\u5c06\u5b83\u4eec\u7528\u4e8e\u805a\u96c6\u5373\u53ef\u3002\u7531\u4e8e\u524d\u9762\u7684\u7a97\u53e3\u5df2\u7ecf\u6ee1\u8db3\u6761\u4ef6\uff0c\u6240\u4ee5\u53ea\u7528\u8003\u8651\u5bf9\u540e\u9762\u7684\u7a97\u53e3\u7684\u8d21\u732e\uff0c\u800c\u8fd9\u79cd\u9009\u6cd5\u5bf9\u540e\u9762\u7684\u7a97\u53e3\u8d21\u732e\u4e00\u5b9a\u662f\u6700\u5927\u7684\uff1b\u540c\u65f6\u7531\u4e8e\u524d\u9762\u7684\u7a97\u53e3\u5bf9\u6b64\u7a97\u53e3\u8d21\u732e\u6700\u5927\uff0c\u6240\u4ee5\u66fe\u7ecf\u9009\u8fc7\u7684\u4e0d\u9700\u8981\u4fee\u6539\u3002\n\n##### Subtask 2\uff1a\n\n\u6ce8\u610f\u5230 $a$ \u8f83\u5c0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5b58\u4e0b\u4e0a\u8ff0\u8d2a\u5fc3\u4e2d\u7684\u6240\u6709\u72b6\u6001\u3002\u5177\u4f53\u5730\uff0c\u5f00\u4e00\u4e2a $a$ \u4f4d\u4e09\u8fdb\u5236\u6570\u8868\u793a\u5f53\u524d\u7a97\u53e3\u72b6\u6001\uff0c\u6bcf\u4e00\u4f4d\u4e0a\uff0c$0$ \u8868\u793a\u4e0d\u5b89\u5168\uff0c$1$ \u8868\u793a\u5b89\u5168\u4f46\u8fd8\u6ca1\u7528\u4e8e\u805a\u96c6\uff0c$2$ \u8868\u793a\u5df2\u7ecf\u7528\u4e8e\u805a\u96c6\u3002\u79fb\u52a8\u7a97\u53e3\u76f8\u5f53\u4e8e\u628a\u8fd9\u4e2a\u4e09\u8fdb\u5236\u6570\u5de6\u79fb\u4e00\u4f4d\uff0c\u5728\u672b\u5c3e\u52a0\u4e00\u4e2a $0$ \u6216 $1$\uff0c\u518d\u6839\u636e\u65b0\u7684\u4e09\u8fdb\u5236\u6570\u4e2d $2$ \u7684\u6570\u91cf\u6765\u5c06\u6700\u53f3\u4fa7\u7684\u82e5\u5e72\u4e2a $1$ \u53d8\u4e3a $2$\u3002\u8bb0 $dp_{i,s}$ \u8868\u793a\u5df2\u7ecf\u5904\u7406\u5b8c $[i-a,i-1]$ \u53ca\u4e4b\u524d\u7684\u7a97\u53e3\uff0c\u73b0\u5728\u5904\u7406 $[i-a+1,i]$\uff0c\u5e76\u4e14\u4e09\u8fdb\u5236\u6570\u4e3a $s$ \u7684\u65b9\u6848\u6570\uff0c\u6309\u4e0a\u6587\u6240\u8ff0\u8f6c\u79fb\u5230 $dp_{i+1,s'}\\times x_i$ \u6216 $dp_{i+1,s'}\\times y_i$ \u5373\u53ef\u3002\n\n\u9884\u5904\u7406\u6bcf\u4e00\u4e2a\u4e09\u8fdb\u5236\u6570\u7684\u8f6c\u79fb\uff0c\u590d\u6742\u5ea6 $\\mathcal O(3^an)$\uff0c\u53ef\u80fd\u9700\u8981\u6eda\u52a8\u6570\u7ec4\u3002\u65f6\u9650\u5f88\u677e\uff0c\u5e38\u6570\u7a0d\u5fae\u5c0f\u4e00\u70b9\u5e94\u8be5\u5c31\u53ef\u4ee5 AC \u4e86\u3002\n\n##### Subtask 3\uff1a\n\n\u6ce8\u610f\u5230\u6bcf\u4e2a\u7a97\u53e3\u5bf9\u5e94\u4e09\u8fdb\u5236\u6570\u4e2d $2$ \u7684\u6570\u91cf\u5e94\u5f53\u603b\u662f\u4e3a $b$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u904d\u5386\u4e09\u8fdb\u5236\u4e0b $2$ \u7684\u6570\u91cf\u4e3a $b$ \u7684\u6570\u5373\u53ef\u3002\u540c\u65f6\uff0c\u8f6c\u79fb\u4e0e\u4e09\u8fdb\u5236\u4e0b\u7b2c\u4e00\u4f4d\u662f\u4ec0\u4e48\u65e0\u5173\uff0c\u53ea\u4e0e\u540e $a-1$ \u4f4d\u4e2d $1,2$ \u7684\u4f4d\u7f6e\u3001\u4e2a\u6570\u6709\u5173\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5b58\u50a8 $a-1$ \u4f4d\u3002\u6b64\u65f6\u72b6\u6001\u6570\u4e3a $\\binom{a-1}{b-1}\\times2^{a-b}+\\binom{a-1}b\\times2^{a-1-b}$\uff0c\u6700\u5927\u7ea6\u4e3a $3584$\uff0c\u662f $3^a=19683$ \u7684\u7ea6\u4e94\u5206\u4e4b\u4e00\uff0c\u975e\u5e38\u53ef\u8fc7\u3002\n\n---\n\n\u4ee3\u7801\u4e2d\u7528\u56db\u8fdb\u5236\u6765\u5b58\u9898\u89e3\u4e2d\u6240\u8bf4\u7684\u4e09\u8fdb\u5236\u6570\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i, l, r) for(int i=l, _=r; i<=_; ++i)\nusing namespace std;\ntypedef long long ll;\nconst int mN=1.5e4+9, mA=9+2, mT=1<<16|9, mS=4000;\nconst int mod=998244353;\ninline int qpow(int x, int y) {\n\tint res=1;\n\tfor(; y; y>>=1, x=(ll) x*x%mod) if(y&1) res=(ll) res*x%mod;\n\treturn res;\n}\n#define pm(a) ((a)<mod? a: (a)-mod)\n#define inc(a, b) a=pm(a+b)\nint n, a, b, x[mN][2], sumx=1;\nint dp[2][mS][2];\n\nint trans[mS][2];\nbool pl[mS][2];\nint p[mA], mp[mT], tot;\nvoid dfs(int stp) {\t//\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u4e09\u8fdb\u5236\u6570\u3002\n\tif(stp>=a) {\n\t\tint cnt2=0, t=0;\n\t\trep(i, 1, a-1) cnt2+=p[i]==2, t|=p[i]<<(i-1)*2;\n\t\tif(cnt2<b-1 || cnt2>b) return;\t//\u5171\u6709 b \u4e2a 2\uff0c\u6545\u540e a-1 \u4f4d\u6709 b-1 \u6216 b \u4e2a 2\n\t\tmp[t]=++tot;\n\t\tif(cnt2==b) {\t//\u4e0d\u9700\u8981\u5c06 1 \u6539\u4e3a 2\n\t\t\ttrans[tot][0]=t>>2;\n\t\t\ttrans[tot][1]=t>>2|1<<(a-2)*2;\n\t\t} else {\t//\u9700\u8981\u5c06 1 \u6539\u4e3a 2\n\t\t\tint k;\n\t\t\tfor(k=a-1; k>=1; --k) if(p[k]==1) break;\n\t\t\ttrans[tot][1]=t>>2|2<<(a-2)*2, pl[tot][1]=1;\n\t\t\tif(!k) return trans[tot][0]=mT-1, void();\t//\u6ca1\u6709 1 \u4e14\u4e0b\u4e00\u4f4d\u4e3a 0\n\t\t\tt+=1<<(k-1)*2;\n\t\t\ttrans[tot][0]=t>>2, pl[tot][0]=1;\n\t\t}\n\t\treturn;\n\t}\n\trep(t, 0, 2) p[stp]=t, dfs(stp+1);\n}\n\nint q[mA];\nvoid pre(int stp) {\t//\u521d\u59cb\u5316 [1, a] \u7684\u7b54\u6848\n\tif(stp>a) {\n\t\tint lft=b, sum=1, t=0;\n\t\tfor(int i=a; i>=1; --i) {\n\t\t\tsum=(ll) sum*x[i][q[i]=p[i]]%mod;\n\t\t\tif(q[i]==1 && lft) q[i]=2, --lft;\n\t\t}\n\t\tif(lft) return;\n\t\tfor(int i=2; i<=a; ++i) t|=q[i]<<(i-2)*2;\n\t\tinc(dp[a&1][mp[t]][0], sum), dp[a&1][mp[t]][1]=(dp[a&1][mp[t]][1]+(ll) sum*b)%mod;\n\t\treturn;\n\t}\n\trep(t, 0, 1) p[stp]=t, pre(stp+1);\n}\n\nint main() {\n\n\tscanf(\"%d%d%d\", &n, &a, &b), dfs(1);\n\trep(i, 1, tot) rep(t, 0, 1) trans[i][t]=mp[trans[i][t]];\n\trep(i, 1, n) scanf(\"%d%d\", x[i]+1, x[i]), sumx=(ll) sumx*(x[i][0]+x[i][1])%mod;\n\tpre(1);\n\trep(i, a+1, n) {\n\t\tmemset(dp[i&1], 0, sizeof dp[i&1]);\n\t\trep(j, 1, tot) if(dp[i&1^1][j][0] || dp[i&1^1][j][1])rep(t, 0, 1) {\n\t\t\tconst int k=trans[j][t];\n\t\t\tdp[i&1][k][0]=(dp[i&1][k][0]+(ll) x[i][t]*dp[i&1^1][j][0])%mod;\n\t\t\tdp[i&1][k][1]=(dp[i&1][k][1]+(ll) (dp[i&1^1][j][1]+\n\t\t\tpl[j][t]*dp[i&1^1][j][0])*x[i][t])%mod;\n\t\t}\n\t}\n\tint ans=0;\n\trep(j, 1, tot) inc(ans, dp[n&1][j][1]);\n\tprintf(\"%lld\\n\", (ll) ans*qpow(sumx, mod-2)%mod);\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1659781557,
        "uid": 364963,
        "name": "\u963f\u4e11",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8504 No will to break"
    }
]