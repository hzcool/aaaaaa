[
    {
        "content": "## \u9898\u610f\n\u7ed9\u51fa\u5e38\u6570 $k$\uff0c\u6709 $n$ \u4e2a\u6761\u4ef6\uff0c\u8868\u793a $a_i+xk$ \u5904\u6709\u4e00\u4e2a\u70b9\uff08$x\\ge 1,x\\in Z$\uff09\uff0c\u591a\u6b21\u8be2\u95ee\u533a\u95f4\u4e2d\u70b9\u7684\u6570\u91cf\u3002\n\n## \u601d\u8def\n\n\u9996\u5148\u5dee\u5206\uff0c\u95ee\u9898\u53d8\u6210\u524d\u7f00\u95ee\u9898\uff0c\u5047\u8bbe\u6bcf\u6b21\u8be2\u95ee\u7684\u7aef\u70b9\u662f $x$\u3002\n\n\u5c06 $a$ \u6392\u5e8f\uff0c\u8bbe\u6700\u5927\u7684\u5c0f\u4e8e\u7b49\u4e8e $x$ \u7684\u4f4d\u7f6e\u4e3a $lim$\u3002\n\n\u7136\u540e\u7b54\u6848\u5c31\u662f:\n\n$$\n\\sum_{i=1}^{lim}\\left\\lfloor\\frac{x-a_i}{k}\\right\\rfloor\n$$\n\n\u5c06\u4e0b\u53d6\u6574\u5206\u5f00\uff1a\n\n$$\n\\left\\lfloor\\frac{a}{b}\\right\\rfloor=\\frac{a}{b}-a\\bmod b\n$$\n\n\u8fd9\u4e2a\u67ff\u5b50\u663e\u7136\uff0c\u5c31\u4e0d\u9700\u8981\u8bc1\u660e\u4e86\u3002\n\n\u7136\u540e\u6c42\u548c\u9879\u5c31\u53ef\u4ee5\u62c6\u5f00\u4e86\uff1a\n$$\n\\sum_{i=1}^{lim}\\left\\lfloor\\frac{x-a_i}{k}\\right\\rfloor=\n\nk\\sum_{i=1}^{lim}x-a_i-(x-a_i)\\bmod k\n$$\n\n\u524d\u9762\u51e0\u4e2a\u9879\u90fd\u662f\u5bb9\u6613\u7684\uff0c\u770b\u6700\u540e\u4e00\u4e2a\uff1a\n\n$$\n(x-a_i)\\bmod k=x\\bmod k-a_i\\bmod k +[a_i\\bmod k>x\\bmod k]\\cdot k\n$$\n\n\u524d\u9762\u4e24\u9879\u53ef\u4ee5\u524d\u7f00\u548c\uff0c\u6700\u540e\u4e00\u4e2a\u5c31\u662f\u4e8c\u7ef4\u6570\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e3b\u5e2d\u6811\u505a\u5230\u5728\u7ebf\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n## code\n\n```cpp\nconst int MAXN=2e5+10;\nstruct node{int l,r,w;}t[MAXN*60];\n#define ls t[p].l\n#define rs t[p].r\nint tt;\nvoid update(int& p,int l,int r,int qq)\n{\n    t[++tt]=t[p],p=tt,t[p].w++;\n    if(l==r)return;int mid=(l+r)>>1;\n    if(qq<=mid)update(ls,l,mid,qq);\n    else update(rs,mid+1,r,qq);\n}\nint ask(int p,int l,int r,int ql,int qr)\n{\n    if(!p)return 0;\n    if(ql<=l&&r<=qr)return t[p].w;\n    int mid=(l+r)>>1;\n    if(qr<=mid)return ask(ls,l,mid,ql,qr);\n    else if(ql>mid)return ask(rs,mid+1,r,ql,qr);\n    else return ask(ls,l,mid,ql,qr)+ask(rs,mid+1,r,ql,qr);\n}\nint rt[MAXN],a[MAXN];\nll sum[MAXN];\nint main()\n{\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);cout<<fixed<<setprecision(10);\n\tint tp;cin>>tp;\n    int n,m,k;cin>>n>>m>>k;if(tp)cin>>mod;\n    for(int i=1;i<=n;i++)cin>>a[i];\n    sort(a+1,a+n+1);\n    for(int i=1;i<=n;i++)\n    {\n        update(rt[i]=rt[i-1],0,k,a[i]%k);\n        sum[i]=sum[i-1]-1ll*a[i]+a[i]%k;\n    }\n    auto cal=[&](int b)->ll\n    {\n        int w=upper_bound(a+1,a+n+1,b)-a-1;\n        ll ans=sum[w];\n        ans+=1ll*b*w;\n        ans-=1ll*(b%k)*w;\n        ans-=1ll*k*ask(rt[w],0,k,b%k+1,k);\n        return ans/k;\n    };\n    ll l,r;cin>>l>>r;\n    ll la=cal(r)-cal(l-1);\n    cout<<la<<'\\n';\n    for(int i=2;i<=m;i++)\n    {\n        cin>>l>>r;\n        if(tp)l=(l+la-1)%mod+1,r=(r+la-1)%mod+1;\n        if(l>r)swap(l,r);\n        la=cal(r)-cal(l-1);\n        cout<<la<<'\\n';\n    }\n\treturn 0;\n} \n```\n",
        "postTime": 1684468543,
        "uid": 571229,
        "name": "__stick",
        "ccfLevel": 7,
        "title": "P6638 \u300cJYLOI Round 1\u300d\u5e38\u89c4"
    },
    {
        "content": "\u672c\u4eba\u5de6\u8fb9\u662f\u51fa\u9898\u4eba\uff0c\u53f3\u8fb9\u662f\u60f3\u51fa\u65b9\u6cd5\u7684 dalao\uff0c\u7531\u4e2d\u95f4\u7684\u849f\u84bb\u4ee3\u7b14\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\uff0c\u53ef\u4ee5\u8f7b\u6613\u7684\u60f3\u5230\u5c06 $[l,r]$ \u7684\u7b54\u6848\u62c6\u5f00\u6765\u6c42\uff0c\u5373\u6c42 $ans(1\u223cr)-ans(1\u223c(l-1))$\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42 $ans$ \u51fd\u6570\u3002\n\n\u663e\u800c\u6613\u89c1\u7684\u662f $ans(x)=\\sum_{i=1}^{n}\\lfloor\\dfrac{x-a_i}{k}\\rfloor$\uff0c\u5047\u8bbe $\\sum_{i=1}^{n}(x-a_i)=pk+q$\uff0c\u5219 $ans(x)=p$\u3002\n\n\u4e0e\u6b64\u540c\u65f6 $q=\\sum_{i=1}^{n}(x-a_i)\\;\\text{mod}\\;k$\uff0c\u53ef\u4ee5 $O(n)$ \u8fdb\u884c\u9884\u5904\u7406\uff0c\u7136\u540e\u5c31\u6709\uff1a\n$$p=\\dfrac{\\sum_{i=1}^{n}(x-a_i)-\\sum_{i=1}^{n}(x-a_i)\\;\\text{mod}\\;k}{k}$$\n\n\u540c\u65f6\u8981\u8003\u8651\u8ba1\u7b97 $ans(x)$ \u65f6 $x \\leq a_i$ \u7684\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u7528 $O(1)$ \u7684\u4f18\u79c0\u65f6\u95f4\u590d\u6742\u5ea6\u7b97\u51fa\u7b54\u6848\u4e86\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n)$\u3002\u5e0c\u671b\u53e3\u80e1\u6ca1\u6709\u9505\u3002\n\n\u6211\u73b0\u5728\u5c31\u627e\u51fa\u9898\u4eba\u52a0\u5f3a\u6570\u636e......\u8fd9\u9898\u9876\u591a\u666e\u53ca\u3002",
        "postTime": 1626787575,
        "uid": 139496,
        "name": "Taystered",
        "ccfLevel": 0,
        "title": "\u5173\u4e8e\u6b64\u9898\u7684\u7b80\u6613\u505a\u6cd5"
    }
]