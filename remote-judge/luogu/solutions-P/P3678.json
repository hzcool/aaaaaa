[
    {
        "content": "[CF GYM \u94fe\u63a5](https://codeforces.com/gym/101173)\n\n$\\text{Solution}$\uff1a\n\n\u9996\u5148\u627e\u5230\u7b2c\u4e8c\u4e2a\u5168 ``#`` \u884c\u548c\u7b2c\u4e8c\u4e2a\u5168 ``#`` \u5217\uff0c\u53ef\u4ee5\u5f97\u5230\u6bcf\u4e2a\u77e9\u5f62\u7684\u5927\u5c0f\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u77e9\u5f62\uff0c\u66b4\u529b Hash + map \u5224\u65ad\u5b83\u662f\u5426\u5728\u4e4b\u524d\u51fa\u73b0\u8fc7\u3002\u5bf9\u4e8e\u65cb\u8f6c\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5148\u770b\u65cb\u8f6c\u540e\u77e9\u5f62\u7684\u6bcf\u4e2a\u4f4d\u7f6e\u5728\u539f\u77e9\u5f62\u4e2d\u662f\u54ea\u4e2a\u4f4d\u7f6e\u3002\n\n\u4e2a\u4eba\u5efa\u8bae\u65e0\u8bba\u4ec0\u4e48\u60c5\u51b5\u4e0b\u5199\u53cc\u54c8\u5e0c\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u6211\u5077\u61d2\u4e86\u6ca1\u5199\uff0c\u6bd5\u7adf\u77e9\u9635\u6570\u91cf\u6bd4\u8f83\u5c11\u3002\n\n$\\text{Code}$\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#pragma GCC optimize(3)\n#define int long long\n#define ri register\n#define mk make_pair\n#define fi first\n#define se second\n#define pb push_back\n#define eb emplace_back\n#define is insert\n#define es erase\nusing namespace std; const int N=233, B1=191, B2=137, Mod=998244353;\ninline int read()\n{\n\tint s=0, w=1; ri char ch=getchar();\n\twhile(ch<'0'||ch>'9') { if(ch=='-') w=-1; ch=getchar(); }\n\twhile(ch>='0'&&ch<='9') s=(s<<3)+(s<<1)+(ch^48), ch=getchar();\n\treturn s*w;\n}\nint n,m,H,W,Ans,hsh[N][N];\nchar s[N][N];\nmap<int,int> Q;\nsigned main()\n{\n\tn=read(), m=read();\n\tfor(ri int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%s\",s[i]+1);\n\t\tint flg=1;\n\t\tfor(ri int j=1;j<=m;j++)\n\t\t{\n\t\t\tif(s[i][j]!='#')\n\t\t\t{\n\t\t\t\tflg=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(flg&&i>1&&H==0) H=i-1;\n\t}\n\tfor(ri int i=1;i<=m;i++)\n\t{\n\t\tint flg=1;\n\t\tfor(ri int j=1;j<=n;j++)\n\t\t{\n\t\t\tif(s[j][i]!='#')\n\t\t\t{\n\t\t\t\tflg=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(flg&&i>1&&W==0) W=i-1;\n\t}\n\tfor(ri int i=2;i<=n;i+=H)\n\tfor(ri int j=2;j<=m;j+=W)\n\t{\n\t\tfor(ri int x=0;x<=H;x++) hsh[x][0]=0;\n\t\tfor(ri int x=0;x<=W;x++) hsh[0][x]=0;\n\t\tfor(ri int x=1;x<H;x++)\n\t\tfor(ri int y=1;y<W;y++)\n\t\thsh[x][y]=(hsh[x][y-1]*B1+s[i+x-1][j+y-1])%Mod;\n\t\tfor(ri int x=1;x<H;x++)\n\t\tfor(ri int y=1;y<W;y++)\n\t\thsh[x][y]=(hsh[x][y]+hsh[x-1][y]*B2)%Mod;\n\t\tif(Q[hsh[H-1][W-1]]) continue;\n\t\tQ[hsh[H-1][W-1]]=1, Ans++;\n        \n\t\tfor(ri int x=0;x<=H;x++) hsh[x][0]=0;\n\t\tfor(ri int x=0;x<=W;x++) hsh[0][x]=0;\n\t\tfor(ri int x=1;x<H;x++)\n\t\tfor(ri int y=1;y<W;y++)\n\t\thsh[x][y]=(hsh[x][y-1]*B1+s[i+H-x-1][j+W-y-1])%Mod;\n\t\tfor(ri int x=1;x<H;x++)\n\t\tfor(ri int y=1;y<W;y++)\n\t\thsh[x][y]=(hsh[x][y]+hsh[x-1][y]*B2)%Mod;\n\t\tQ[hsh[H-1][W-1]]=1;\n        \n\t\tfor(ri int x=0;x<=W;x++) hsh[x][0]=0;\n\t\tfor(ri int x=0;x<=H;x++) hsh[0][x]=0;\n\t\tfor(ri int x=1;x<W;x++)\n\t\tfor(ri int y=1;y<H;y++)\n\t\thsh[x][y]=(hsh[x][y-1]*B1+s[i+H-y-1][j+x-1])%Mod;\n\t\tfor(ri int x=1;x<W;x++)\n\t\tfor(ri int y=1;y<H;y++)\n\t\thsh[x][y]=(hsh[x][y]+hsh[x-1][y]*B2)%Mod;\n\t\tQ[hsh[W-1][H-1]]=1;\n        \n\t\tfor(ri int x=0;x<=W;x++) hsh[x][0]=0;\n\t\tfor(ri int x=0;x<=H;x++) hsh[0][x]=0;\n\t\tfor(ri int x=1;x<W;x++)\n\t\tfor(ri int y=1;y<H;y++)\n\t\thsh[x][y]=(hsh[x][y-1]*B1+s[i+y-1][j+W-x-1])%Mod;\n\t\tfor(ri int x=1;x<W;x++)\n\t\tfor(ri int y=1;y<H;y++)\n\t\thsh[x][y]=(hsh[x][y]+hsh[x-1][y]*B2)%Mod;\n\t\tQ[hsh[W-1][H-1]]=1;\n\t}\n\tprintf(\"%lld\\n\",Ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1612250053,
        "uid": 98618,
        "name": "Provicy",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3678"
    }
]