[
    {
        "content": ">\u4f60\u6709\u4e00\u4e2a$n$\u70b9\u7684\u7ade\u8d5b\u56fe\uff0c\u521d\u59cb\u6bcf\u6761\u8fb9\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u73b0\u5728\u6bcf\u6761\u8fb9$i$(\u6ce8\u610f\u662f\u53cc\u5411\u7684)\u6709$p_i$\u7684\u6982\u7387\u5b58\u5728\uff0c\u6c42\u4ece$1$\u51fa\u53d1\u5230\u6240\u6709\u70b9\u7684\u6700\u77ed\u8def\u5f84\u90fd\u4e0d\u8d85\u8fc7$k$\u7684\u6982\u7387\n\n### \u524d\u8a00\n\n\u4eca\u5929\u7ec8\u4e8e\u62ff\u5230\u4ee3\u7801\u4e86,\u8fd9\u91cc\u662f[\u8003\u8bd5\u65f6\u63d0\u4ea4](https://thupc2021.thusaac.com/#!/contest/2/detail/5536)\n\n\u7ed9\u4e00\u4e2a\u597d\u770b\u7684\u4e09\u8fdb\u5236\u72b6\u538b$dp$\uff0c\u5173\u4e8e\u590d\u6742\u5ea6~~\u6211\u4e0d\u77e5\u9053~~\n\n\u53e6\u5916\u9644\u4e00\u53e5\uff0c\u5173\u4e8e[\u8fd9\u9053\u9898](https://blog.csdn.net/mys_c_k/article/details/89336055)\uff0c\u4f60\u53ef\u4ee5\"\u4e0d\u5c0f\u5fc3\"\u641c\u5230\n\n\u5728\u8fd9\u91cc\u5f3a\u8c03\u4e00\u70b9\u7531\u4e8e\u6211\u8111\u5b50\u6bd4\u8f83\u5947\u602a\uff0c\u4e0b\u9762\u4e8c\u8fdb\u5236\u70b9\u96c6\u8868\u793a\u7684\u72b6\u6001\u548c\u4e09\u8fdb\u5236\u70b9\u7684\u9009\u53d6\u72b6\u6001\u901a\u5e38\u662f\u4e00\u4e2a\u5b57\u7b26$S$\u8868\u793a\uff0c\u8bf7\u6ce8\u610f\n\n### \u6b63\u6587\n\n\u8fd9\u9898\u6211\u4eec\u53cd\u5176\u9053\u800c\u884c\uff0c\u9012\u63a8\u6c42\u6070\u597d$i(i\\in[1,k])$\u6761\u7684\u518d\u6c42\u548c\u5c31\u53ef\u4ee5\u4e86\n\n\u53d1\u73b0\u8fd9\u4e2a\u8fc7\u7a0b\u672c\u8d28\u662f\u5728\u5efa\u4e00\u68f5\u6700\u77ed\u8def\u5f84$\\mathrm{DAG}$,\u4e8e\u662f\u6211\u4eec\u4fbf\u72b6\u538b\u8fd9\u4e2a\u8fc7\u7a0b\n\n\u6574\u4f53\u601d\u8def\u662f\u6211\u4eec\u53d1\u73b0\u70b9\u5206\u4e3a\u4e24\u7c7b\uff0c\u6700\u77ed\u8def\u5f84$\\mathrm{DAG}$\u4e0a\u7684\u70b9\uff0c\u4e0d\u5728\u6700\u77ed\u8def\u5f84$\\mathrm{DAG}$\u4e0a\u7684\u70b9\n\n\u800c\u6700\u77ed\u8def\u5f84$\\mathrm{DAG}$\u4e0a\u7684\u70b9\u53c8\u5206\u4e3a\u6700\u524d\u6cbf\u7684\u2014\u2014\u5f85\u6269\u5c55\u7684$i$\u5c42\u70b9\uff0c\u4e0e\u843d\u540e\u7684$[1,i)$\u5c42\u70b9\n\n\u8bbe$f_{i,S}$\u8868\u793a\u5efa\u5230\u7b2c$i$\u5c42\uff0c\u70b9\u7684\u9009\u62e9\u72b6\u6001\u4e3a$S$\u7684\u6982\u7387\n\n$0$\u8868\u793a\u672a\u9009\uff0c$1$\u8868\u793a\u5728\u6269\u5c55\u5c42(\u5c31\u662f\u521a\u597d\u7b2c$i$\u5c42)\uff0c$2$\u8868\u793a\u6269\u5c55\u7ed3\u675f($<i$\u5c42\u70b9)\n\n\u5148\u9884\u5904\u7406\u4e00\u4e9b\u4e1c\u897f\n\n$all_{S,x}$\u8868\u793a$S$**\u70b9\u96c6**\u5230$x$\u70b9\u4e0d\u5b58\u5728\u4e00\u6761\u51fa\u8fb9\u7684\u6982\u7387\n\n$part_{S,x}$\u8868\u793a$S$**\u70b9\u96c6**\u5230$x$\u70b9\u5b58\u5728\u81f3\u5c11\u4e00\u6761\u51fa\u8fb9\u7684\u6982\u7387\n\n\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5**\u52a8\u6001\u7684**(\u662f\u5728\u8f6c\u79fb\u4e2d\u52a8\u6001\u77e5\u9053\u7684$S$\u4e0e$T$)\u5904\u7406\u51fa\n\n\u5bf9\u5df2\u7ecf\u5b9a\u7684\u8d21\u732e\u51fa\u70b9\u7684**\u70b9\u96c6**$S$\n\n\u5bf9\u8d21\u732e\u5165\u70b9\u7684**\u70b9\u96c6**$T$\u7684\u6bcf\u4e2a\u5b50\u96c6$T'$\n\n$p0_{T'}$\u6c42\u51fa$S$\u5230$T'$\u6ca1\u6709\u4e00\u6761\u51fa\u8fb9\u7684\u6982\u7387\n\n$p1_{T'}$\u8868\u793a$S$\u5230$T'$\u81f3\u5c11\u6709\u4e00\u6761\u51fa\u8fb9\u7684\u6982\u7387\n\n\u6211\u5b9e\u73b0\u7684\u65f6\u5019\u56e0\u4e3a\u4e0d\u4f1a\u6b63\u5e8f\u679a\u4e3e\u5b50\u96c6\u6240\u4ee5\u662f\u53d6\u51fa\u6765\u518dreverse\u7684\n\n\u53e6\u5916\u4e00\u4e9b\u81ea\u5df1\u5b9e\u73b0\u7684\u7ec6\u8282\n\n$s_S$\u8868\u793a$S$\u8fd9\u4e2a\u70b9\u96c6\u6574\u4f53\u5728\u4e09\u8fdb\u5236\u4e0b\u5e73\u79fb\u7684\u5dee\u91cf\n\n$S=\\sum 2^{a_i},$\u5219$s_S=\\sum 3^{a_i}$\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8f6c\u79fb\u4e86\n\n\u5bf9\u4e00\u4e2a\u6709\u503c\u7684\u72b6\u6001$(i,S)$\n\n\u6211\u4eec\u53d6\u51fa\u4e3a$0$(\u8981**\u88ab**\u6269\u5c55)\u7684\u70b9\u96c6$S_0$,\u4e3a$1$(\u8981\u6269\u5c55)\u7684\u70b9\u96c6$S_1$\n\n\u7136\u540e\u679a\u4e3e$S_0$\u4e2d\u88ab\u52a0\u5165\u5230\u8fd9\u4e00\u5c42\u7684\u70b9\u96c6$T$\n\n\u4ee5$S_1$\u4e3a\u51fa\u70b9\u96c6\u5408\u5904\u7406\u4ee5$S_0$\u4e3a\u5165\u70b9\u96c6\u5408\u7684$p_0,p_1$\n\n\u90a3\u4e48$f_{i,S}\\cdot p1_{T}\\cdot p0_{S\\oplus T}\\to f_{i+1,S+s_{T}+s_{S_1}}$\n\n\u8dd1\u5f97\u83ab\u540d\u5f88\u5feb\uff1f\uff1f\n\n\n```cpp\n#include<bits/stdc++.h>\n#define N 13\n#define STA 531442\n#define mod 998244353\nusing namespace std;\nint n,K,lg[1<<12],d[STA][13],p[N][N],s[1<<12],all[1<<12][N],part[1<<12][N],_[STA],f[N][STA],pw[N],ans,p0[STA],p1[STA];\ninline int Mod(int x){return x>=mod?x-mod:x;}\ninline int qpow(int a,int b){int res=1;while(b){if(b&1)res=1ll*res*a%mod;a=1ll*a*a%mod;b>>=1;}return res;}\ninline void Div(int x){int t=x,tot=0;while(t)d[x][tot++]=t%3,t/=3;}\nsigned main(void){\n\tint i,k,x,y,a,b,S,T,S0,S1,_S;scanf(\"%d%d\",&n,&K);\n\tT=n*(n-1);while(T--)scanf(\"%d%d%d%d\",&x,&y,&a,&b),--x,--y,p[x][y]=1ll*a*qpow(b,mod-2)%mod;\n\tfor(*pw=i=1;i<=n;++i)pw[i]=3ll*pw[i-1]%mod;\n\tfor(i=2;i<1<<n;++i)lg[i]=lg[i>>1]+1;\n\tfor(S=0;S<pw[n];++S)Div(S);\n\tfor(S=0;S<(1<<n);++S){\n\t\tfor(i=0;i<n;++i)if((S>>i)&1)s[S]=Mod(s[S]+pw[i]);\n\t\tfor(x=0;x<n;++x){for(all[S][x]=1,i=S;i;i-=i&-i)y=lg[i&-i],all[S][x]=1ll*all[S][x]*(1ll-p[y][x]+mod)%mod;part[S][x]=Mod(1-all[S][x]+mod);\n\t\t}\n\t}\n\tfor(f[0][1]=1,k=0;k<=K;++k){\n\t\tfor(S=0;S<pw[n];++S)if(f[k][S]){\n\t\t\tfor(S0=S1=i=0;i<n;++i)if(d[S][i]<2){(!d[S][i])?S0^=(1<<i):S1^=(1<<i);}\n\t\t\tif(!S0){ans=Mod(ans+f[k][S]);continue;}\n\t\t\tfor(*_=0,T=S0;T;T=(T-1)&S0)_[++*_]=T;\n\t\t\treverse(_+1,_+*_+1);\n\t\t\tfor(*p0=*p1=i=1;i<=*_;++i)T=_[i],p0[T]=1ll*p0[T-(T&-T)]*all[S1][lg[T&-T]]%mod,p1[T]=1ll*p1[T-(T&-T)]*part[S1][lg[T&-T]]%mod;\n\t\t\tfor(_S=S+s[S1],T=S0;T;T=(T-1)&S0)f[k+1][_S+s[T]]=(f[k+1][_S+s[T]]+1ll*f[k][S]*p1[T]%mod*p0[S0^T])%mod;\n\t\t}\n\t}printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1609550969,
        "uid": 40629,
        "name": "zzw4257",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7142 \u3010[THUPC2021 \u521d\u8d5b]\u5bc6\u96c6\u5b50\u56fe\u3011"
    },
    {
        "content": "\u8003\u8651\u6700\u77ed\u8def\u6811\uff0c\u5bf9\u4e8e\u6df1\u5ea6\u4e3a $i$ \u7684\u67d0\u4e2a\u70b9\uff0c\u6df1\u5ea6\u5c0f\u4e8e $i-1$ \u7684\u70b9\u4e0d\u80fd\u5411\u5176\u8fde\u8fb9\uff0c\u81f3\u5c11\u6709\u4e00\u4e2a\u6df1\u5ea6\u4e3a $i-1$ \u7684\u70b9\u5411\u5176\u8fde\u8fb9\uff0c\u5bf9\u4e8e\u5176\u4ed6\u70b9\u8fde\u5411\u5b83\u7684\u8fb9\u6ca1\u6709\u9650\u5236\u3002\n\n\u8fd9\u542f\u53d1\u6211\u4eec\u5206\u5c42\u72b6\u538b dp\u3002\u8bbe $f_{d,s_1,s_2}$ \u4e3a\uff0c\u6df1\u5ea6\u4e3a $d$ \u7684\u70b9\u7684\u96c6\u5408\u4e3a $s_1$\uff0c\u6df1\u5ea6\u5c0f\u4e8e\u7b49\u4e8e $d$ \u7684\u70b9\u7684\u96c6\u5408\u4e3a $s_2$\uff0c\u53ea\u8003\u8651\u8fde\u5411\u6df1\u5ea6\u5927\u4e8e $d$ \u7684\u70b9\u7684\u8fb9\u7684\u9650\u5236\uff0c\u65f6\uff0c\u56fe\u6ee1\u8db3\u6761\u4ef6\u7684\u6982\u7387\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\u679a\u4e3e\u6df1\u5ea6\u4e3a $d+1$ \u7684\u70b9\u7684\u96c6\u5408 $s_3$\uff0c\u5219 $s_1-s_2$ \u5185\u7684\u70b9\u90fd\u4e0d\u80fd\u5411 $s_3$ \u5185\u7684\u70b9\u8fde\u8fb9\uff0c\u4e14\u5bf9\u4e8e $s_3$ \u5185\u7684\u6bcf\u4e00\u4e2a\u70b9\uff0c$s_2$ \u5185\u81f3\u5c11\u6709\u4e00\u4e2a\u70b9\u9700\u8981\u5411\u5176\u8fde\u8fb9\u3002dp \u503c\u5373\u4e3a\u6bcf\u4e2a\u8fd9\u6837\u7684 $s_3$ \u7b26\u5408\u6761\u4ef6\u7684\u6982\u7387\u4e4b\u548c\u3002\n\n\u76f4\u63a5\u5b9e\u73b0\u5373\u53ef\u505a\u5230 $O(\\operatorname{poly}(n)4^n)$ \u7684\u590d\u6742\u5ea6\uff0c\u56e0\u4e3a\u8fd9\u4e2a dp \u5b9e\u9645\u4e0a\u76f8\u5f53\u4e8e\u679a\u4e3e\u5b50\u96c6\u7684\u5b50\u96c6\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $s_1$ \u548c $s_2$\uff0c\u9884\u5904\u7406 $s_1$ \u5185\u7684\u70b9\u90fd\u4e0d\u5411 $s_2$ \u5185\u7684\u70b9\u8fde\u8fb9\u7684\u6982\u7387\uff0c\u548c\u5bf9\u4e8e\u6bcf\u4e2a $s_2$ \u5185\u7684\u70b9 $s_1$ \u5185\u7684\u70b9\u81f3\u5c11\u6709\u4e00\u4e2a\u5411\u5176\u8fde\u8fb9\u7684\u6982\u7387\u3002\u8fd9\u90e8\u5206\u53ef\u4ee5\u5728 $O(3^n)$ \u81f3 $O(n4^n)$ \u4e0d\u7b49\u7684\u65f6\u95f4\u5185\u5b8c\u6210\u3002\u9884\u5904\u7406\u540e\u6bcf\u6b21\u8f6c\u79fb\u7684\u590d\u6742\u5ea6\u964d\u4e3a $O(1)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n4^n)$\u3002\n\n\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u5361\u5e38\u5361\u7a7a\u95f4\u3002\n\n\u4e0b\u9762\u662f\u6211\u7684\u6700\u7ec8\u4ee3\u7801\uff0c\u4f7f\u7528\u4e86\u6eda\u52a8\u6570\u7ec4\u8fdb\u884c\u4f18\u5316\uff0c\u7a7a\u95f4 $O(4^n)$\u3002\u7406\u8bba\u4e0a\u6700\u597d\u53ef\u4ee5\u505a\u5230 $O(3^n)$ \u7a7a\u95f4\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int readint(){\n\tint x=0;\n\tbool f=0;\n\tchar c=getchar();\n\twhile(!isdigit(c)&&c!='-') c=getchar();\n\tif(c=='-'){\n\t\tf=1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst int maxn=12;\nint n,k;\nconst int mod=998244353;\nint ksm(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b%2==1) ans=1ll*ans*a%mod;\n\t\ta=1ll*a*a%mod;\n\t\tb/=2;\n\t}\n\treturn ans;\n}\ninline void mul(int& x,int y){\n\tx=1ll*x*y%mod;\n}\nint p[maxn+5][maxn+5];\nint f[2][(1<<maxn)+5][(1<<maxn)+5];\nint g[(1<<maxn)+5][(1<<maxn)+5],h[(1<<maxn)+5][(1<<maxn)+5];\nint main(){\n\t#ifdef LOCAL\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n\t#endif\n\tn=readint();\n\tk=readint();\n\tfor(int i=0;i<n*(n-1);i++){\n\t\tint x,y;\n\t\tx=readint()-1;\n\t\ty=readint()-1;\n\t\tp[x][y]=readint();\n\t\tmul(p[x][y],ksm(readint(),mod-2));\n\t}\n\tint all=(1<<n)-1;\n\tfor(int s1=0;s1<=all;s1++){\n\t\tfor(int i=0;i<n;i++) if(!(s1>>i&1)){\n\t\t\tg[s1][1<<i]=1;\n\t\t\tfor(int j=0;j<n;j++) if(s1>>j&1) mul(g[s1][1<<i],(1-p[j][i]+mod)%mod);\n\t\t}\n\t\tfor(int s2=all^s1;s2;s2=(s2-1)&(all^s1)) if((s2&-s2)!=s2){\n\t\t\tg[s1][s2]=1;\n\t\t\tfor(int i=0;i<n;i++) if(s2>>i&1) mul(g[s1][s2],g[s1][1<<i]);\n\t\t}\n\t}\n\tfor(int s1=0;s1<=all;s1++){\n\t\tfor(int i=0;i<n;i++) if(!(s1>>i&1)) h[s1][1<<i]=(1-g[s1][1<<i]+mod)%mod;\n\t\tfor(int s2=all^s1;s2;s2=(s2-1)&(all^s1)) if((s2&-s2)!=s2){\n\t\t\th[s1][s2]=1;\n\t\t\tfor(int i=0;i<n;i++) if(s2>>i&1) mul(h[s1][s2],h[s1][1<<i]);\n\t\t}\n\t}\n\tf[(k+1)%2][all][0]=1;\n\tfor(int d=k;d>=0;d--) for(int s1=1;s1<=all;s1++){\n\t\tf[d%2][s1][0]=s1==all;\n\t\tfor(int s2=s1;s2;s2=(s2-1)&s1){\n\t\t\tlong long res=s1==all;\n\t\t\tfor(int s3=all^s1;s3;s3=(s3-1)&(all^s1))\n\t\t\t\tres+=1ll*f[!(d%2)][s1|s3][s3]*g[s1^s2][s3]%mod*h[s2][s3]%mod;\n\t\t\tf[d%2][s1][s2]=res%mod;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",f[0][1][1]);\n\treturn 0;\n}\n```",
        "postTime": 1608991809,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7142 \u3010[THUPC2021 \u521d\u8d5b]\u5bc6\u96c6\u5b50\u56fe\u3011"
    }
]