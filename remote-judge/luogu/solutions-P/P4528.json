[
    {
        "content": "# \u6d1b\u5495 P4528 [CTSC2008]\u56fe\u817e\n\n\n---\n\n\u795e\u9898orz\u3002\n\n\u5148\u7ea6\u5b9a`abcd`\u8868\u793a$1\\leq A<B<C<D\\leq n$\uff0c\u800c\u4e14$y_a,y_b,y_c,y_d$\u7684\u6392\u540d\u6b63\u597d\u662f$a,b,c,d$\u7684\u65b9\u6848\u6570\n\n\u90a3\u4e48\u6240\u6c42\u5c31\u662f\n\n1324-1243-1432\n\n=(1x2x-1423)-(14xx-1423)-(12xx-1234)\n\n\uff08\u5176\u4e2d\u6709x\u7684\u8868\u793a\u6392\u540d\u4efb\u610f\uff0c\u4f46\u662f\u4e0d\u80fd\u91cd\u590d)\n\n=1x2x-14xx-12xx+1234\n\n=1x2x-1xxx+13xx+1234\n\n\u9884\u5904\u7406$L,R$\uff0c$L_i=\\sum_{j<i}[y_j<y_i],R_i=\\sum_{j>i}[y_j<y_i]$\uff0c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u5904\u7406\n\n\uff08\u53ef\u4ee5\u770b\u51fa\uff0c$L_i+R_i=y_i-1$\uff0c\u53ef\u4ee5\u53ea\u6c42$L_i$\u5c31\u884c\u4e86\uff1b$n-i-R_i=\\sum_{j>i}[y_j>y_i]$\uff0c\u8fd9\u662f\u7b49\u4e00\u4e0b\u8981\u7528\u5230\u7684\u6027\u8d28\uff09\n\n\u5206\u522b\u770b\u600e\u4e48\u6c42\uff1a\n\n1x2x\uff1a\u679a\u4e3e2\u7684\u4f4d\u7f6e$i$\uff0c\u90a3\u4e48\u53f3\u8fb9\u6709$n-i-R_i$\u4e2d\u9009\u6cd5\uff0c\u5de6\u8fb9\u8981\u6ee1\u8db3$j<k<i,y_j<y_i,y_k>y_i$\uff0c1\u653e\u5728j\uff0cx\u653e\u5728k\u7684\u4f4d\u7f6e\n\n\u82e5\u53ea\u8003\u8651$y_j<y_i$\uff0c\u6709$L_i*(i-1)$\u79cd\u9009\u6cd5\uff1b\u90a3\u4e48\u591a\u7b97\u4e86$j<k,y_k<y_i$\u7684\u548c$j\\geq k$\u7684\n\n$j<k,y_k<y_i$\u7684\u65b9\u6848\u6570\u662f$C_{L_i}^2$\n\n$j>k$\u7684\u65b9\u6848\u6570\uff0c\u56e0\u4e3a\u6b64\u65f6\u5bf9$k$\u7684\u9650\u5236\u53ea\u6709$k\\leq j$\uff0c\u6240\u4ee5\u5bf9\u6bcf\u4e2a$j$\u90fd\u53ef\u4ee5\u53d6$[1,j]$\uff0c\u6240\u4ee5\u5c31\u662f$\\sum_{p<i,y_p<y_i}p$\n\n1xxx\uff1a\u5f88\u5bb9\u6613\uff0c\u5c31\u662f$\\sum C_{n-i-R_i}^3$\n\n13xx\uff1a\u679a\u4e3e3\uff0c\u90a3\u4e484\u6709$n-i-R_i$\u79cd\u9009\u6cd5\uff0c1\u548c2\u8981\u6ee1\u8db3$j<i<k,y_j<y_k<y_i$\n\n\u53ea\u8003\u8651$y_j<y_i,y_k<y_i,j<i$\uff0c\u6709$L_i(y_i-1)$\u79cd\u9009\u6cd5\uff0c\u9700\u8981\u51cf\u53bb\u7684\u662f$k\\leq i$\u7684\u548c$y_j\\geq y_k$\u7684\n\n$k\\leq i$\u7684\u5c31\u662f$C_{L_i}^2$\n\n$y_j>y_k$\u7684\uff0c\u6b64\u65f6\u5bf9$k$\u7684\u9650\u5236\u53ea\u6709$y_k\\leq y_j$\uff0c\u6240\u4ee5\u5bf9\u6bcf\u4e2a$j$\u90fd\u53ef\u4ee5\u53d6\u6240\u6709$y<y_j$\u7684\u4f4d\u7f6e\uff0c\u5c31\u662f$\\sum_{p<i,y_p<y_i}y_p$\n\n1234:\u679a\u4e3e3\uff0c\u540e\u9762\u7684\u5c31\u662f$n-i-R_i$\uff0c\u524d\u9762\u5982\u679c2\u786e\u5b9a\u4e86\u653e\u5728$j$\u4f4d\u7f6e,1\u7684\u653e\u6cd5\u5c31\u662f$L_j$\uff0c\u7b54\u6848\u662f$\\sum_{i} (n-i-R_i)(\\sum_{j<i,y_j<y_i}L_j)$\uff0c\u6811\u72b6\u6570\u7ec4\u76f4\u63a5\u505a\n\n\u5b8c\u7ed3\u6492FA\uff08\u9003\n\n```cpp\n#include<bits/stdc++.h>\n#define il inline\n#define vd void\n#define mod 16777216\ntypedef long long ll;\nil int gi(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(!isdigit(ch)){\n        if(ch=='-')f=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))x=x*10+ch-'0',ch=getchar();\n    return x*f;\n}\nll n,p[200010],L[200010],R[200010];\nint t[200010];\nil vd inc(int&x,int y){x+=y;x%=mod;}\nil vd upd(int p,int d){while(p<=n)inc(t[p],d),p+=p&-p;}\nil int query(int p){int ret=0;while(p)inc(ret,t[p]),p-=p&-p;return ret;}\nint main(){\n    n=gi();\n    for(int i=1;i<=n;++i)p[i]=gi();\n    for(int i=1;i<=n;++i)L[i]=query(p[i]),R[i]=p[i]-1-L[i],upd(p[i],1);\n    memset(t,0,sizeof t);\n    int ans=0;\n    for(int i=1;i<=n;++i){\n        int x=n-i-R[i];\n        ans=(ans-(1ll*x*(x-1)*(x-2)/6)%mod+mod)%mod;//1xxx\n    }\n    for(int i=1;i<=n;++i)ans=(ans+(n-i-R[i])*query(p[i]))%mod,upd(p[i],L[i]);//1234\n    memset(t,0,sizeof t);\n    for(int i=1;i<=n;++i)ans=(ans+(L[i]*(i-1)-query(p[i])-L[i]*(L[i]-1)/2)*(n-i-R[i])%mod+mod)%mod,upd(p[i],i);//1x2x\n    memset(t,0,sizeof t);\n    for(int i=n;i;--i)ans=(ans+(query(p[i])-R[i]*(R[i]+1)/2)*(n-i-R[i])%mod+mod)%mod,upd(p[i],p[i]);//13xx\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1543484366,
        "uid": 23118,
        "name": "\u03bb\u1d09\u028d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4528 \u3010[CTSC2008]\u56fe\u817e\u3011"
    },
    {
        "content": "\u672c\u7bc7\u9898\u89e3\u9002\u5408 **\u6570\u5b66\u516c\u5f0f\u6050\u60e7\u75c7\u60a3\u8005** \u548c **\u6570\u636e\u7ed3\u6784\u7231\u597d\u8005** \u9605\u8bfb\n\n\u672c\u6587\u4e2d $h$ \u610f\u4e49\u540c\u9898\u76ee\u4e2d\u7684 $y$\n\n\u672c\u6587\u4e0d\u8003\u8651\u53d6\u6a21\uff0c\u800c\u4f7f\u7528 ``uint32(\u5373 unsigned int)`` \u6765\u8bb0\u5f55\u7b54\u6848\uff0c\u5e76\u4f7f\u7528**\u81ea\u7136\u6ea2\u51fa**\uff0c\u6700\u540e\u53d6\u7b54\u6848\u7684\u4f4e 24 \u4f4d\u8f93\u51fa ($16777216=2^{24}$)\n\n# \u6b63\u6587\n\n\u5b9a\u4e49 ``abcd`` \u8868\u793a\u56db\u4e2a $y_i$ \u5bf9\u5e94\u7684\u6392\u540d(\u4ece\u5c0f\u5230\u5927)\u5e8f\u5217\u3002\n\ne.g. ``1324`` \u8868\u793a**\u95ea\u7535**\u56fe\u817e\n\n---\n\n\u9996\u5148\uff0c\u8ddf\u5176\u4ed6\u4eba\u7684\u9898\u89e3\u4e00\u6837\u5730\u653e\u51fa\u8fd9\u4e2a\u795e\u5947\u7684\u5f0f\u5b50\uff1a\n```plain\n  1324 - 1243 - 1432\n= (1x2x - 1432) - (12xx - 1234) - (14xx - 1423)\n= 1x2x - (12xx + 14xx) + 1234\n= 1x2x - (1xxx - 13xx) + 1234\n= 1x2x + 13xx + 1234 - 1xxx\n```\n\n\u7136\u540e\uff0c\u6211\u4eec\u6765\u8c08\u8c08\u5982\u4f55\u5728\u5c3d\u91cf\u5c11\u5730\u63a8\u5f0f\u5b50\u7684\u60c5\u51b5\u4e0b\uff0c\u4ee5 **\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4** \u7684\u65b9\u5f0f\uff0cAC \u8fd9\u9053\u9898\u3002\n\n## \u9884\u5904\u7406\n\n\u4e3a\u4e86\u4e0b\u6587\u7684\u65b9\u4fbf\uff0c\u6211\u4eec\u63d0\u524d\u8bb2\u4e00\u4e0b\u9884\u5904\u7406\u3002\n\n\u6211\u4eec\u9700\u8981\u9884\u5904\u7406\u7684\u6570\u7ec4\u6709: ``before_less`` \u548c ``after_greater``\uff0c\u5176\u610f\u4e49\u5206\u522b\u662f\uff1a\n- ``before_less[x]``: \u5728 $x$ \u4e4b\u524d\u7684\uff0c\u6bd4 $x$ \u77ee\u7684\u70b9\u7684\u4e2a\u6570  \n- ``after_greater[x]``: \u5728 $x$ \u4e4b\u540e\u7684\uff0c\u6bd4 $x$ \u9ad8\u7684\u70b9\u7684\u4e2a\u6570  \n\n\u53ef\u4ee5\u4f7f\u7528 **\u6811\u72b6\u6570\u7ec4** \u4ece\u524d\u5230\u540e\u626b\u63cf\u4e00\u904d\uff0c\u518d\u4ece\u540e\u5230\u524d\u626b\u63cf\u4e00\u904d\u6765\u9884\u5904\u7406\u8fd9\u4e24\u4e2a\u6570\u7ec4\u3002\n\n```cpp\nvoid init() {\n    BinaryIndexTree tr;\n    for (int i = n; i >= 1; --i) {\n        after_greater[i] = n - i - tr.qry(h[i]);\n        tr.add(h[i], 1);\n    }\n    tr.clear();\n    for (int i = 1; i <= n; ++i) {\n        before_less[i] = tr.qry(h[i]);\n        tr.add(h[i], 1);\n    }\n}\n```\n\n## \u6811\u72b6\u6570\u7ec4\n\n\u4e0b\u6587\u5c06\u4f1a\u7528\u5230\u6811\u72b6\u6570\u7ec4\uff0c\u6700\u666e\u901a\u7684\u90a3\u79cd\n\n```cpp\nstruct BinaryIndexTree {\n    uint32 tr[N];\n    BinaryIndexTree() {\n        memset(tr, 0, sizeof(tr));\n    }\n    void clear() {\n        memset(tr, 0, sizeof(tr));\n    }\n    void add(int u, uint32 dif) {\n        for (; u <= n; u += u & -u) tr[u] += dif;\n    }\n    uint32 qry(int u) {\n        uint32 ret = 0;\n        for (; u; u ^= u & -u) ret += tr[u];\n        return ret;\n    }\n};\n\n```\n\n## \u7ebf\u6bb5\u6811\n\n\u4e0b\u6587\u5c06\u7528\u5230\u4e00\u79cd\u7ebf\u6bb5\u6811\uff0c\u5176\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u4e86\u4e24\u4e2a\u503c ``covered`` \u548c ``sum``\u3002\n\n\u8fd9\u79cd\u7ebf\u6bb5\u6811\u652f\u6301\u4e09\u79cd\u64cd\u4f5c\uff1a\n1. \u5355\u70b9\u4fee\u6539 ``covered``\n2. \u7ed9\u5b9a $x,d$, $\\forall i\\in[1, x], sum[i] \\Leftarrow sum[i]+covered[i]\\times d$\n3. \u7ed9\u5b9a $x$, \u8be2\u95ee $\\sum\\limits_{i=x}^{n}sum[i]$\n\n\u7531\u4e8e\u64cd\u4f5c ``2`` \u662f\u533a\u95f4\u64cd\u4f5c\uff0c\u56e0\u6b64\u8fd8\u9700\u8981\u7ef4\u62a4 $add$ \u8868\u793a $d$ \u7684\u61d2\u6807\u8bb0\u3002\n\n\u5982\u679c\u4f60\u73b0\u5728\u4e0d\u80fd\u660e\u767d\u8fd9\u4e2a\u7ebf\u6bb5\u6811\u7684\u4f5c\u7528\uff0c**\u8bf7\u4f60\u5148\u770b\u4e0b\u53bb**\uff0c\u770b\u5230\u4e0b\u9762\u4f60\u5c31\u660e\u767d\u4e86\u3002\n\n\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u5982\u4f55\u5199\u8fd9\u79cd\u7ebf\u6bb5\u6811\uff0c\u53c2\u8003\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\uff1a\n\n```cpp\nstruct segt {\n    struct node {\n        uint32 covered, add, sum;\n    } tr[N << 2];\n    segt() {\n        memset(tr, 0, sizeof(tr));\n    }\n    void cover(int u, int l, int r, int pos, uint32 dif) {\n        tr[u].covered += dif;\n        if (l == r) return;\n        int mid = (l + r) >> 1, ls = u << 1, rs = ls ^ 1;\n        if (tr[u].add) {\n            tr[ls].sum += tr[ls].covered * tr[u].add;\n            tr[ls].add += tr[u].add;\n            tr[rs].sum += tr[rs].covered * tr[u].add;\n            tr[rs].add += tr[u].add;\n            tr[u].add = 0;\n        }\n        if (pos <= mid) cover(ls, l, mid, pos, dif);\n        else cover(rs, mid + 1, r, pos, dif);\n    }\n    void add(int u, int l, int r, int mr, uint32 dif) {\n        if (r <= mr) {\n            tr[u].sum += tr[u].covered * dif;\n            tr[u].add += dif;\n            return;\n        }\n        int mid = (l + r) >> 1, ls = u << 1, rs = ls ^ 1;\n        if (tr[u].add) {\n            tr[ls].sum += tr[ls].covered * tr[u].add;\n            tr[ls].add += tr[u].add;\n            tr[rs].sum += tr[rs].covered * tr[u].add;\n            tr[rs].add += tr[u].add;\n            tr[u].add = 0;\n        }\n        add(ls, l, mid, mr, dif);\n        if (mid < mr) add(rs, mid + 1, r, mr, dif);\n        tr[u].sum = tr[ls].sum + tr[rs].sum;\n    }\n    uint32 query(int u, int l, int r, int ml) {\n        if (l >= ml) return tr[u].sum;\n        int mid = (l + r) >> 1, ls = u << 1, rs = ls ^ 1;\n        if (tr[u].add) {\n            tr[ls].sum += tr[ls].covered * tr[u].add;\n            tr[ls].add += tr[u].add;\n            tr[rs].sum += tr[rs].covered * tr[u].add;\n            tr[rs].add += tr[u].add;\n            tr[u].add = 0;\n        }\n        uint32 res = 0;\n        if (mid >= ml) res += query(ls, l, mid, ml);\n        res += query(rs, mid + 1, r, ml);\n        return res;\n    }\n};\n```\n\n## 1x2x\n\n``1x2x`` \u5305\u62ec\u4e86\u4e24\u79cd\u60c5\u51b5\uff1a``1324`` \u548c ``1423``\u3002\u8fd9\u4e24\u79cd\u60c5\u51b5\u7684\u5171\u540c\u4e4b\u5904\u5728\u4e8e\uff1a**\u7b2c\u4e8c\u4e2a\u4f4d\u7f6e** \u548c **\u7b2c\u56db\u4e2a\u4f4d\u7f6e** \u662f\u56db\u4e2a\u6570\u4e2d\u6700\u5927\u7684\u4e24\u4e2a\u6570\u3002\n\n\u8003\u8651\u4ece n \u5230 1 \u679a\u4e3e\u4e00\u904d\u3002\n\n\u73b0\u5728\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $a$\uff1a\n\n### \u5982\u679c\u8fd9\u4e2a\u70b9\u662f\u56db\u4e2a\u70b9\u4e2d\u7684\u7b2c\u4e00\u4e2a\u70b9  \n\n\u6211\u4eec\u9700\u8981\u67e5\u8be2\u6ee1\u8db3 ``h[a] < h[c]``\uff0c``b < c < d`` \u5e76\u4e14 ``h[b], h[d] > h[c]`` \u7684\u4e09\u5143\u7ec4\u7684\u4e2a\u6570\u3002 \n\n\u7531\u4e8e ``b < c < d``\uff0c``h[b], h[d] > h[c]`` \u4e24\u4e2a\u7ea6\u675f\u6761\u4ef6\u4e0e $a$ \u65e0\u5173\uff0c\u8003\u8651\u5728\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff08\u6743\u503c\u7ebf\u6bb5\u6811\uff09\u4e0a\u7ef4\u62a4\u4e09\u5143\u7ec4\n\n\u7531\u4e8e\u8ddf $a$ \u6709\u5173\u7684\u7ea6\u675f\u6761\u4ef6\u4e5f\u4e0e $c$ \u6709\u5173\uff0c\u8003\u8651\u5c06\u4e09\u5143\u7ec4\u7684\u4e2a\u6570\u7ef4\u62a4\u5728\u7ebf\u6bb5\u6811\u7684\u8282\u70b9 ``h[c]`` \u4e0a\u3002\n\n\u4e09\u5143\u7ec4\u7684\u4e2a\u6570\u663e\u7136\u7b49\u4e8e ``(a, c) \u4e4b\u95f4\u5927\u4e8e h[c] \u7684\u70b9\u4e2a\u6570`` \u4e58\u4e0a ``(c, n] \u4e4b\u95f4\u5927\u4e8e h[c] \u7684\u70b9\u4e2a\u6570``\u3002  \n\n\u73b0\u5728\u6211\u544a\u8bc9\u4f60\uff1a\u4e0a\u9762\u90a3\u79cd\u7ebf\u6bb5\u6811\uff0c``covered`` \u7ef4\u62a4\u7684\u5c31\u662f ``(c, n] \u4e4b\u95f4\u5927\u4e8e h[c] \u7684\u70b9\u4e2a\u6570``\uff0c``sum`` \u7ef4\u62a4\u7684\u5c31\u662f ``(a, c) \u4e4b\u95f4\u5927\u4e8e h[c] \u7684\u70b9\u4e2a\u6570`` \u4e58\u4e0a ``(c, n] \u4e4b\u95f4\u5927\u4e8e h[c] \u7684\u70b9\u4e2a\u6570``\u3002  \n\n\u90a3\u4e48\u6bcf\u6b21\u67e5\u8be2\u7684\uff0c\u5c31\u662f\u7ebf\u6bb5\u6811\u4e0a ``h[a] ~ n`` \u7684\u8282\u70b9\u7684\u7b54\u6848\u603b\u548c\u3002\n\n**\u7ebf\u6bb5\u6811\uff1a\u6267\u884c\u64cd\u4f5c ``3``**   \n\u67e5\u8be2\u7ebf\u6bb5\u6811\u4e2d\u7684\u8282\u70b9 ``1 ~ h[a]`` \u7684 ``sum`` \u7684\u603b\u548c\n\n### \u5982\u679c\u8fd9\u4e2a\u70b9\u662f\u56db\u4e2a\u70b9\u7684\u7b2c\u4e09\u4e2a\u70b9\n\n**\u7ebf\u6bb5\u6811\uff1a\u6267\u884c\u64cd\u4f5c ``1``**   \n\u7ebf\u6bb5\u6811\u4e2d\u7684\u8282\u70b9 ``h[a]`` \u7684 ``covered[i]`` \u4e0a\u589e\u52a0 ``after_greater[c]``\n\n### \u5982\u679c\u8fd9\u4e2a\u70b9\u662f\u56db\u4e2a\u70b9\u7684\u7b2c\u4e8c\u4e2a\u70b9\n\n**\u7ebf\u6bb5\u6811\uff1a\u6267\u884c\u64cd\u4f5c ``2``**   \n\u7ebf\u6bb5\u6811\u4e2d\u7684\u8282\u70b9 ``h[a] ~ n`` \u7684 ``sum[i]`` \u4e0a\u589e\u52a0 ``covered[i] * 1``\n\n\uff08\u8fd9\u91cc\uff0c\u64cd\u4f5c ``2`` \u7684\u53c2\u6570 $d$ \u7b49\u4e8e $1$\uff1b\u4f46\u540e\u9762\u6c42 ``13xx`` \u65f6\uff0c $d$ \u4e0d\u4e3a $1$\uff09\n\n```cpp\nuint32 solve_1x2x() {\n    segt s;\n    uint32 ret = 0;\n    for (int i = n; i >= 1; --i) {\n        ret += s.query(1, 1, n, h[i]);\n        s.add(1, 1, n, h[i], 1);\n        s.cover(1, 1, n, h[i], after_greater[i]);\n    }\n    return ret;\n}\n```\n\n## 13xx\n\n``13xx`` \u5305\u62ec\u4e86\u4e24\u79cd\u60c5\u51b5\uff1a``1324`` \u548c ``1342``\u3002\u8fd9\u4e24\u79cd\u60c5\u51b5\u7684\u5171\u540c\u4e4b\u5904\u5728\u4e8e\uff1a**\u7b2c\u4e8c\u4e2a\u4f4d\u7f6e** \u548c **\u7b2c\u56db\u4e2a\u4f4d\u7f6e** \u7684 $h$ \u4e00\u4e2a\u5927\u4e8e ``h[c]``\uff0c\u4e00\u4e2a\u5c0f\u4e8e ``h[c]``\n\n\u8003\u8651\u4ece n \u5230 1 \u679a\u4e3e\u4e00\u904d\u3002\n\n$\\color{red}\\text{\u8bf7\u6ce8\u610f\u7406\u89e3\u4ee5\u4e0b\u5185\u5bb9!}$\n\n\u8003\u8651\u5728\u7ebf\u6bb5\u6811\u7684\u8282\u70b9 ``min(h[b], h[d])`` \u4e0a\u7ef4\u62a4\u4e09\u5143\u7ec4\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $a$\uff1a\n\n### \u5982\u679c\u8fd9\u4e2a\u70b9\u662f\u56db\u4e2a\u70b9\u4e2d\u7684\u7b2c\u4e00\u4e2a\u70b9  \n\n**\u7ebf\u6bb5\u6811\uff1a\u6267\u884c\u64cd\u4f5c ``3``**   \n\u67e5\u8be2\u7ebf\u6bb5\u6811\u4e2d\u7684\u8282\u70b9 ``1 ~ h[a]`` \u7684 ``sum`` \u7684\u603b\u548c\n\n### \u5982\u679c\u8fd9\u4e2a\u70b9\u662f\u56db\u4e2a\u70b9\u7684\u7b2c\u4e09\u4e2a\u70b9\n\n**\u7ebf\u6bb5\u6811\uff1a\u6267\u884c\u64cd\u4f5c ``2``**   \n\u7ebf\u6bb5\u6811\u4e2d\u7684\u8282\u70b9 ``h[a] ~ n`` \u7684 ``sum[i]`` \u4e0a\u589e\u52a0 ``covered[i] * after_greater[a]``\n\n### \u5982\u679c\u8fd9\u4e2a\u70b9\u662f\u56db\u4e2a\u70b9\u7684\u7b2c\u4e8c/\u56db\u4e2a\u70b9\uff0c\u4e14\u662f\u7b2c\u4e8c/\u56db\u4e2a\u70b9\u4e2d\u8f83\u5c0f\u7684\u90a3\u4e2a\u70b9\n\n**\u7ebf\u6bb5\u6811\uff1a\u6267\u884c\u64cd\u4f5c ``1``**   \n\u7ebf\u6bb5\u6811\u4e2d\u7684\u8282\u70b9 ``h[a]`` \u7684 ``covered[i]`` \u4e0a\u589e\u52a0 ``1``\n\n```cpp\nuint32 solve_13xx() {\n    segt s;\n    uint32 ret = 0;\n    for (int i = n; i >= 1; --i) {\n        ret += s.query(1, 1, n, h[i]);\n        s.add(1, 1, n, h[i], after_greater[i]);\n        s.cover(1, 1, n, h[i], 1);\n    }\n    return ret;\n}\n```\n\n## 1234\n\n\u53ef\u4ee5\u7b80\u5355\u5730\u4ece 1 \u5230 n \u626b\u4e00\u904d\uff0c\u7528\u4e00\u9897\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4 ``before_less`` \u7684\u603b\u548c\uff0c\u5e76\u4e58\u4e0a ``after_greater`` \u5f97\u5230\u7b54\u6848\n\n```cpp\nuint32 solve_1234() {\n    BinaryIndexTree tr;\n    uint32 ret = 0;\n    for (int i = 1; i <= n; ++i) {\n        ret += tr.qry(h[i]) * after_greater[i];\n        tr.add(h[i], before_less[i]);\n    }\n    return ret;\n}\n```\n\n## 1xxx\n\n\u6700\u7b80\u5355\u7684\u90e8\u5206\u3002\u679a\u4e3e\u54ea\u4e2a\u8282\u70b9\u4f5c\u4e3a $a$\uff0c\u5728 $a$ \u540e\u9762\u968f\u4fbf\u9009\u4e09\u4e2a $h$ \u503c\u5927\u4e8e $a$ \u7684\u8282\u70b9\uff0c\u5747\u80fd\u6ee1\u8db3\u8981\u6c42\n\n```cpp\nuint32 solve_1xxx() {\n    uint32 ret = 0;\n    for (int i = 1; i <= n; ++i) {\n        uint32 x = after_greater[i];\n        ret += (uint64)x * (x - 1) * (x - 2) / 6;\n    }\n    return ret;\n}\n```\n\n# Code\n\n```cpp\n/*************************************\n * @problem:      totem\n * @author:       brealid.\n * @time:         2020-11-25.\n*************************************/\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef unsigned uint32;\ntypedef long long int64;\ntypedef unsigned long long uint64;\n\n/* \u6b64\u5904\u4e3a\uff1a\u5feb\u901f\u8f93\u5165\u8f93\u51fa\u6a21\u677f\uff0c\u5df2\u7701\u7565 */\n/* \u4e0b\u6587\u4e2d\uff0c\u8bf7\u5c06 kin \u7406\u89e3\u6210 cin, \u5c06 kout \u7406\u89e3\u6210 cout */\n\nconst int N = 2e5 + 7;\n\nint n, h[N];\n\nstruct BinaryIndexTree {\n    uint32 tr[N];\n    BinaryIndexTree() {\n        memset(tr, 0, sizeof(tr));\n    }\n    void clear() {\n        memset(tr, 0, sizeof(tr));\n    }\n    void add(int u, uint32 dif) {\n        for (; u <= n; u += u & -u) tr[u] += dif;\n    }\n    uint32 qry(int u) {\n        uint32 ret = 0;\n        for (; u; u ^= u & -u) ret += tr[u];\n        return ret;\n    }\n};\n\nstruct segt {\n    struct node {\n        uint32 covered, add, sum;\n    } tr[N << 2];\n    segt() {\n        memset(tr, 0, sizeof(tr));\n    }\n    void cover(int u, int l, int r, int pos, uint32 dif) {\n        tr[u].covered += dif;\n        if (l == r) return;\n        int mid = (l + r) >> 1, ls = u << 1, rs = ls ^ 1;\n        if (tr[u].add) {\n            tr[ls].sum += tr[ls].covered * tr[u].add;\n            tr[ls].add += tr[u].add;\n            tr[rs].sum += tr[rs].covered * tr[u].add;\n            tr[rs].add += tr[u].add;\n            tr[u].add = 0;\n        }\n        if (pos <= mid) cover(ls, l, mid, pos, dif);\n        else cover(rs, mid + 1, r, pos, dif);\n    }\n    void add(int u, int l, int r, int mr, uint32 dif) {\n        if (r <= mr) {\n            tr[u].sum += tr[u].covered * dif;\n            tr[u].add += dif;\n            return;\n        }\n        int mid = (l + r) >> 1, ls = u << 1, rs = ls ^ 1;\n        if (tr[u].add) {\n            tr[ls].sum += tr[ls].covered * tr[u].add;\n            tr[ls].add += tr[u].add;\n            tr[rs].sum += tr[rs].covered * tr[u].add;\n            tr[rs].add += tr[u].add;\n            tr[u].add = 0;\n        }\n        add(ls, l, mid, mr, dif);\n        if (mid < mr) add(rs, mid + 1, r, mr, dif);\n        tr[u].sum = tr[ls].sum + tr[rs].sum;\n    }\n    uint32 query(int u, int l, int r, int ml) {\n        if (l >= ml) return tr[u].sum;\n        int mid = (l + r) >> 1, ls = u << 1, rs = ls ^ 1;\n        if (tr[u].add) {\n            tr[ls].sum += tr[ls].covered * tr[u].add;\n            tr[ls].add += tr[u].add;\n            tr[rs].sum += tr[rs].covered * tr[u].add;\n            tr[rs].add += tr[u].add;\n            tr[u].add = 0;\n        }\n        uint32 res = 0;\n        if (mid >= ml) res += query(ls, l, mid, ml);\n        res += query(rs, mid + 1, r, ml);\n        return res;\n    }\n};\n\nuint32 after_greater[N], after_less[N], before_greater[N], before_less[N];\nuint32 before_greater2[N];\n\nvoid init() {\n    BinaryIndexTree tr;\n    for (int i = n; i >= 1; --i) {\n        after_greater[i] = n - i - tr.qry(h[i]);\n        tr.add(h[i], 1);\n    }\n    tr.clear();\n    for (int i = 1; i <= n; ++i) {\n        before_less[i] = tr.qry(h[i]);\n        tr.add(h[i], 1);\n    }\n}\n\nuint32 solve_1x2x() {\n    segt s;\n    uint32 ret = 0;\n    for (int i = n; i >= 1; --i) {\n        ret += s.query(1, 1, n, h[i]);\n        s.add(1, 1, n, h[i], 1);\n        s.cover(1, 1, n, h[i], after_greater[i]);\n    }\n    return ret;\n}\n\nuint32 solve_13xx() {\n    segt s;\n    uint32 ret = 0;\n    for (int i = n; i >= 1; --i) {\n        ret += s.query(1, 1, n, h[i]);\n        s.add(1, 1, n, h[i], after_greater[i]);\n        s.cover(1, 1, n, h[i], 1);\n    }\n    return ret;\n}\n\nuint32 solve_1234() {\n    BinaryIndexTree tr;\n    uint32 ret = 0;\n    for (int i = 1; i <= n; ++i) {\n        ret += tr.qry(h[i]) * after_greater[i];\n        tr.add(h[i], before_less[i]);\n    }\n    return ret;\n}\n\nuint32 solve_1xxx() {\n    uint32 ret = 0;\n    for (int i = 1; i <= n; ++i) {\n        uint32 x = after_greater[i];\n        ret += (uint64)x * (x - 1) * (x - 2) / 6;\n    }\n    return ret;\n}\n\nsigned main() {\n    kin >> n;\n    for (int i = 1; i <= n; ++i) kin >> h[i];\n    init();\n    uint32 ans = solve_1x2x() + solve_13xx() + solve_1234() - solve_1xxx();\n    kout << (ans & 16777215) << '\\n';\n    return 0;\n}\n```",
        "postTime": 1606282753,
        "uid": 63720,
        "name": "brealid",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4528 \u3010[CTSC2008]\u56fe\u817e\u3011"
    },
    {
        "content": "#### **\u6700\u8be6\u7ec6\u7684\u5bb9\u65a5\u5316\u7b80\u8fc7\u7a0b,\u5982\u679c\u5176\u4ed6\u795e\u7287\u7684\u9898\u89e3\u770b\u4e0d\u61c2\u53ef\u4ee5\u6765\u770b\u770b\u672c\u849f\u84bb\u7684\u9898\u89e3**\n\n\u8fd9\u9053\u9898\u662f\u4e00\u9053\u5f88\u7075\u6d3b\u8fd0\u7528\u6811\u72b6\u6570\u7ec4\u7684\u9898\n\n\u521a\u521a\u770b\u5230\u8fd9\u4e00\u9898\u7684\u65f6\u5019\u89c9\u5f97\u8fd8\u597d\u4e0d\u662f\u5f88\u96be\n\n\u7ed3\u679c\u53d1\u73b0\u9898\u76ee\u8981\u6c42\u7684\u56fe\u817e\u6570\u91cf\u90fd\u4e0d\u80fd\u76f4\u63a5\u6c42\u51faQWQ\n\n\u5b8c\u5168\u4e0d\u80fd\u7eaf\u9760\u9006\u5e8f\u5bf9\u5904\u7406\n\n\u8fd9\u4e00\u9898\u5176\u5b9e\u8981\u7528\u5bb9\u65a5\u5316\u7b80\u4f60\u4f1a\u60ca\u5947\u7684\u53d1\u73b0$1423$\u4f1a\u88ab\u6d88\u6389\n\n$abcd$\u8868\u793a\u4ece\u5de6\u5230\u53f3\u56db\u4e2a\u70b9\u9ad8\u5ea6\u79bb\u6563\u5316\u7684\u503c\uff0c\u90a3\u4e48$abcd$\u5fc5\u5b9a\u4e3a$1234$\u7684\u4e00\u4e2a\u6392\u5217\n\n($x$\u4e3a\u4efb\u610f\u6392\u540d)\n\n\u5982$1423$\uff1a\u7b2c\u4e00\u4e2a\u70b9\u7684\u9ad8\u5ea6\u4e3a\u6700\u4f4e\uff0c\u7b2c\u4e8c\u4e2a\u70b9\u4e3a\u6700\u9ad8\uff0c\n\n\u7b2c\u4e09\u4e2a\u70b9\u4e3a\u7b2c\u4e8c\u4f4e\uff0c\u7b2c\u56db\u4e2a\u70b9\u4e3a\u7b2c\u4e8c\u9ad8\n\n\u5047\u8bbe\u7b54\u6848\u4e3a$ans$\n\n\u90a3\u4e48$ans=1324-1243-1432$(\u95ea\u7535-\u9ad8\u5c71$1$-\u9ad8\u5c71$2$)\n\n$=(1x2x-1423)-(12xx-1234)-(14xx-1423)$\n\n$=1x2x-1423-12xx+1234-14xx+1423$\n\n$=1x2x-12xx-14xx+1234$\n\n$=1x2x-(1xxx-13xx-14xx)-(1xxx-13xx-12xx)+1234$\n\n$=1x2x-1xxx+13xx+14xx-1xxx+13xx+12xx+1234$\n\n$=1x2x-1xxx+(12xx+13xx+14xx)-1xxx+13xx+1234$\n\n$=1x2x-1xxx+1xxx-1xxx+13xx+1234$\n\n$=1x2x-1xxx+13xx+1234$\n      \n\u4e0b\u9762\u662f\u6211\u7684\u5904\u7406\u65b9\u5f0f,~~\u8fd8\u662f\u6bd4\u8f83\u8be6\u7ec6\u7684~~\n\n\u5982\u6709\u9519\u8bef,\u8bf7\u5404\u8def\u5946\u4f6c\u591a\u591a\u6307\u6b63\n\n\u603b\u7684\u6765\u8bb2\u8fd9\u4e00\u9898\u7684\u6838\u5fc3\u5c31\u662f\u6c42\u51fa:$1x2x-1xxx+13xx+1234$\u7684\u56fe\u817e\u603b\u548c\n\n\u9996\u5148\u8981\u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u7684\u9006\u5e8f\u5bf9\u548c\u987a\u5e8f\u5bf9\u4e2a\u6570,\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6216\u7ebf\u6bb5\u6811\u7ef4\u62a4\n\n$y[i]$\u8868\u793a\u7b2c$i$\u4e2a\u70b9\u7684\u9ad8\u5ea6\n\n\u4e0b\u6587\u4e2d\u7684$ls[i]$\u6307\u7684\u662fi\u5de6\u8fb9\u6bd4i\u4f4e\u7684\u70b9\u4e2a\u6570\n\n$lb[i]$\u6307\u7684\u662fi\u5de6\u8fb9\u6bd4i\u9ad8\u7684\u70b9\u4e2a\u6570\n\n$rs[i]$\u6307\u7684\u662fi\u53f3\u8fb9\u6bd4i\u4f4e\u7684\u70b9\u4e2a\u6570\n\n$rb[i]$\u6307\u7684\u662fi\u53f3\u8fb9\u6bd4i\u9ad8\u7684\u70b9\u4e2a\u6570\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u679a\u4e3e\u67d0\u4e2a\u70b9\u7684\u4f4d\u7f6e\n\n\u4ece$1x2x$\u8bb2\u8d77\n\n**$1x2x$**\n\n\u679a\u4e3e$2$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$1$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$j$\u7b2c\u4e00\u4e2a$x$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$k$\n\n\u90a3\u4e48\u7b2c\u4e8c\u4e2a$x$\u6709$rb[i]$\u79cd\u9009\u62e9\n\n\u524d\u9762$3$\u4e2a\u70b9\u6709\u4e0d\u8003\u8651\u5176\u4ed6\u987a\u5e8f\u5219\u6709$ls[i] * (i-1)$\u79cd\u9009\u62e9\n\n\u56e0\u4e3a$j$\u6709$ls[i]$\u79cd\u9009\u62e9\n\n$k$\u6709$i-1$\u79cd\u9009\u62e9\u56e0\u4e3a\u5f53\u524d\u70b9\u4e3a$i$\u90a3\u4e48\u5047\u8bbe\u5de6\u8fb9\u5168\u90e8\u70b9\u90fd\u53ef\u4ee5\u9009\u90a3\u4e48\u6700\u591a\u6709$i-1$\u79cd\u9009\u62e9\n\n\u4f46\u662f\u591a\u7b97\u4e86$k<=j$,$k<i$\u4f46\u662f$yk<yi$\u7684\u60c5\u51b5\n\n$yk<yi$\u6709$\\Large{C^2_{ls[i]}}$\u79cd\u9009\u62e9\n\n\u56e0\u4e3a\u5de6\u8fb9\u4f4e\u7684\u70b9\u91cc\u9762\u9009\u4e24\u4e2a\u5fc5\u5b9a\u90fd\u6bd4$i$\u4f4e\n\n\u5bf9\u4e8e$k<=j$\u7684\u60c5\u51b5\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$j$,$k$\u90fd\u6709$1$~$j$\u79cd\u9009\u62e9\u6240\u4ee5$k$\u6709$j$\u79cd\u9009\u62e9(\u56e0\u4e3a$k<=j$)\n\n\u6240\u4ee5\u5bf9\u4e8e$i$\u6765\u8bb2$1x2x$\u6709$(ls[i]*(i-1)-\\large{C^2_{ls[i]}}-\\sum\\limits_{p=1}^{p<i,y[p]<y[i]}p)*rb[i]$\u79cd\u9009\u62e9\n\n**$1xxx$**\n\n\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\n\n\u679a\u4e3e$1$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$i$\n\n\u90a3\u4e48\u5728$rb[i]$\u91cc\u9762\u9009$3$\u4e2a\u5373\u53ef\n\n\u6240\u4ee5\u5bf9\u4e8e$i$\u6765\u8bb2$1xxx$\u6709$\\Large{C^3_{rb[i]}}$\u79cd\u9009\u62e9\n\n**$13xx$**\n\n\u679a\u4e3e$3$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$i$\n\n$1$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$k$,\n\n$2$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$j$\n\n$4$\u6709$rb[i]$\u79cd\u9009\u62e9\n\n\u5bf9\u4e8e\u6bcf\u4e2a$j$\u90fd\u6709$yj-1$\u4e2a\u70b9\u80fd\u4e0ej\u8fd9\u4e2a\u70b9\u6784\u6210\u987a\u5e8f\u5bf9\u56e0\u4e3a$yk<yj$\u5426\u5219\u7b2c$1$\u4e2a\u70b9\u4e0d\u662f\u6700\u4f4e\u7684\n\n\u6709\u56e0\u4e3a\u8fd9$y[j]-1$\u4e2a\u70b9\u91cc\u9762\u6709\u4e9b\u70b9\u5728$i$\u7684\u53f3\u8fb9\u6240\u4ee5\u8981\u51cf\u53bb\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$i$\u5168\u90e8\u7684$j$\u548c$k$\u7684\u9009\u62e9\u65b9\u6848\u6709$\\sum\\limits_{p=i+1}^{p<=n}({y[p]-1})$\u79cd\u9009\u62e9\n\n\u5f88\u663e\u7136\u591a\u7b97\u4e86$k>i$\u7684\u60c5\u51b5\u6240\u4ee5\u8981\u51cf\u53bb$\\Large{C^2_{rs[i]}}$\u79cd\u9009\u62e9\n\n\u56e0\u4e3a\u6bcf\u4e2a$j$\u90fd\u591a\u7b97\u4e86$k>i$\u7684\u60c5\u51b5\u6240\u4ee5\u5bf9\u4e8e$rs[i]$\u91cc\u7684\u4efb\u610f\u4e24\u4e2a\u70b9\u9ad8\u7684\u70b9\u4f1a\u8986\u76d6\u5230\u4f4e\u7684\u70b9\n\n\u6240\u4ee5\u8981\u51cf\u53bb\u4f4e\u7684\u70b9\u5bf9\u9ad8\u7684\u70b9\u7684\u8d21\u732e(\u5373\u4e3a$1$)\u6240\u4ee5\u8981\u6c42\u51fa\u6709\u591a\u5c11\u5bf9\u8fd9\u6837\u7684\u70b9\n\n\u603b\u5171\u6709$\\Large{C^2_{rs[i]}}$\u79cd\u9009\u62e9\u56e0\u4e3a$rs[i]$\u4e2d\u4e24\u4e2a\u70b9\u5fc5\u7136\u4e00\u4e2a\u9ad8\u4e00\u4e2a\u4f4e\u4e14\u53ea\u4f1a\u8ba1\u7b97\u4e00\u6b21\n\n\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a$i$\u6765\u8bb2$13xx$\u6709$\\sum\\limits_{p=i+1}^{p<=n}(y[p]-1)$-$\\Large{C^2_{rs[i]}}*rb[i]$\u79cd\u9009\u62e9\n\n**$1234$**\n\n\u679a\u4e3e$3$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$i$,$2$\u7684\u4f4d\u7f6e\u8bb0\u4e3a$j$\n\n\u90a3\u4e48$4$\u6709$rb[i]$\u79cd\u9009\u62e9\n\n\u90a3\u4e48$1$\u548c$2$\u603b\u5171\u6709$ls[i]$\u4e2d\u9006\u5e8f\u5bf9\u7684\u603b\u548c\u79cd\u9009\u62e9\n\n\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a$j$\u90fd\u6709$ls[j]$\u4e2a\u70b9\u4f9bj\u9009\u62e9\n\n\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a$i$\u6765\u8bb2$1234$\u6709$\\sum\\limits_{p=1}^{p<i}(ls[p])*rb[i]$\u79cd\u9009\u62e9\n\n\u4e0b\u9762\u4e3aAC\u4ee3\u7801:\n```cpp\n//  x\u8868\u793a\u6392\u540d\u4efb\u610f\uff0c\u4f46\u662f\u4e0d\u80fd\u91cd\u590d\n//  \u4ee5\u4e0b\u4e3a\u6700\u6700\u8be6\u7ec6\u7684\u56fe\u817e\u5316\u7b80\u8fc7\u7a0b \n// ans=1324-1243-1432(\u95ea\u7535-\u9ad8\u5c711-\u9ad8\u5c712)\n//\t  =(1x2x-1423)-(12xx-1234)-(14xx-1423)\n//\t  =1x2x-1423-12xx+1234-14xx+1423\n//\t  =1x2x-12xx-14xx+1234\n//\t  =1x2x-(1xxx-13xx-14xx)-(1xxx-13xx-12xx)+1234\n//\t  =1x2x-1xxx+13xx+14xx-1xxx+13xx+12xx+1234\n//\t  =1x2x-1xxx+(12xx+13xx+14xx)-1xxx+13xx+1234\n//\t  =1x2x-1xxx+1xxx-1xxx+13xx+1234\n//\t  =1x2x-1xxx+13xx+1234\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#define N 200010\n#define mod 16777216\n#define re register\n#define st static\n#define in inline\n#define int long long\n#define lowbit(x) (x&(-x))\n#if true\nusing namespace std;\nint n,c[N],y[N],ans;\nint lb[N],ls[N],rs[N],rb[N];\nin int read(){\n\tre int s=0;\n\tst char ch=getchar();\n\tfor(;!isdigit(ch);)ch=getchar();\n\tfor(;isdigit(ch);){\n\t\ts=(s<<1)+(s<<3)+(ch^48);\n\t\tch=getchar();\n\t}\n\treturn s;\n}\nin void add(int i,int x){\n    for(;i<=n;i+=lowbit(i))c[i]+=x;\n    return;\n}\nin int sum(int i){\n    re int sum=0;\n    for(;i>0;i-=lowbit(i))sum+=c[i];\n    return sum;\n}\nin int t_1x2x(){\n\tmemset(c,0,sizeof(c));\n\tre int s=0;\n\t//2\u653ei\u7684\u4f4d\u7f6e,1\u653ej\u7684\u4f4d\u7f6e,\u7b2c\u4e00\u4e2ax\u653ek\u7684\u4f4d\u7f6e\n\tfor(re int i=1;i<=n;++i){\n//\t\t\u82e5\u53ea\u8003\u8651yj<yi,j<i,k<i\u7684\u60c5\u51b5 \n//\t\tj\u6709ls[i]\u79cd\u9009\u62e9,k\u6709i-1\u79cd\u9009\u62e9,i\u7684\u524d\u9762\u6709i-1\u4e2a\u7a7a\u6240\u4ee5\u90fd\u80fd\u9009\u62e9\n//\t\t\u56e0\u4e3a\u8981\u6ee1\u8db3j<k<i,yj<yi<yk\n//\t\t\u5219\u7b97\u591a\u4e86j<k,yk<yi,\u8fd8\u6709k<=j\u7684\u60c5\u51b5 \n//\t\tj<k,yk<yi{\n//\t\t\t\u6709C(2,ls[i])\u79cd\u60c5\u51b5\uff08\u56e0\u4e3a\u4ed6\u4eec\u90fd\u6bd4i\u4f4e\uff09\n//\t\t\t(\u56e0\u4e3a\u662f\u7ec4\u5408\u6570,\u6240\u4ee5\u6bcf\u4e24\u4e2a\u70b9\u53ea\u4f1a\u8bb0\u5f55\u4e00\u6b21)\n//\t\t}\n//\t\tk<=j{\n//\t\t\t\u56e0\u4e3a\u8981\u6ee1\u8db3k<=j\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2aj\u6709(1~j)\u79cd\u9009\u6cd5\n//\t\t\t\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\n//\t\t}\n//\t\t\u7b2c\u4e8c\u4e2ax\u6709rb[i]\u79cd\u9009\u6cd5 \n\t\ts+=(ls[i]*(i-1)-(ls[i]*(ls[i]-1)>>1)-sum(y[i]))*rb[i];\n\t\ts%=mod;\n\t\tadd(y[i],i);\n\t}\n\treturn s;\n}\nin int t_1xxx(){\n\tre int s=0;\n\t//\u5927\u7684\u91cc\u9762\u9009\u4e09\u4e2aC(3,rb[i])\u6bd4\u8f83\u7b80\u5355 \n\tfor(re int i=1;i<=n;++i){\n\t\ts+=rb[i]*(rb[i]-1)*(rb[i]-2)/6;\n\t\ts%=mod;\n\t}\n\treturn s;\n}\nin int t_13xx(){\n\tmemset(c,0,sizeof(c));\n\tre int s=0;\n\tfor(re int i=n;i>0;--i){//13xx\n//\t\t\u679a\u4e3e3\u7684\u4f4d\u7f6e\u8bb0\u4e3ai,1\u653e\u5728k\u7684\u4f4d\u7f6e,2\u653e\u5728j\u7684\u4f4d\u7f6e \n//\t\t4\u6709rb[i]\u79cd\u9009\u62e9\n//\t\t\u82e5\u8bbe2\u653e\u5728j\u7684\u4f4d\u7f6e,1\u653e\u5728k\u7684\u4f4d\u7f6e,\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u4e2aj\u80fd\u4e0e\u5b83\u6784\u6210\u987a\u5e8f\u5bf9\u7684\u70b9\u7684\u4e2a\u6570\u6709yj-1\u4e2a\n//\t\t\u4f46\u662f\u591a\u7b97\u4e86k\u5728i\u53f3\u8fb9\u7684\u60c5\u51b5,\u603b\u5171\u6709C(2,rs[i])\u79cd\u60c5\u51b5(\u56e0\u4e3a\u53f3\u8fb9\u4efb\u610f\u4e24\u4e2a\u70b9\u4e00\u5b9a\u4f1a\u6709\u4e00\u4e2a\u9ad8\u4e00\u4e2a\u4f4e)\n//\t\t\u90a3\u4e48\u9ad8\u7684\u70b9\u4f1a\u591a\u7b97\u4e00\u6b21\u6240\u4ee5\u8981\u51cf\u53bb1,\u6240\u4ee5\u7528\u7ec4\u5408\u6570\u6c42\u51fars[i]\u4efb\u610f\u4e24\u4e2a\u70b9\u7684\u60c5\u51b5\n//\t\t\u6700\u540e\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\n//\t\t\u6ce8\u610f\u9006\u5e8f\u5904\u7406 \n\t\ts+=(sum(y[i])-((rs[i]*(rs[i]-1))>>1))*rb[i];\n\t\ts%=mod;\n        add(y[i],y[i]-1);\n\t}\n\treturn s;\n}\nin int t_1234(){ \n//\t\u679a\u4e3e\u4e09\u7684\u4f4d\u7f6e,\u90a3\u4e484\u6709rb[i]\u79cd\u9009\u62e9,1\u548c2\u6709\u6240\u6709\u6bd43\u77ee\u7684\u70b9\u7684\u987a\u5e8f\u5bf9\u6570\u91cf\u7684\u548c\u79cd\u9009\u62e9\n//\t\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\n\tmemset(c,0,sizeof(c)); \n\tre int s=0;\n\tfor(re int i=1;i<=n;++i){\n\t\ts+=sum(y[i])*rb[i];\n\t\ts%=mod;\n        add(y[i],ls[i]);\n\t}\n\treturn s;\n}\nsigned main(){\n    n=read();\n    for(re int i=1;i<=n;++i)y[i]=read();\n//    \u9884\u5904\u7406\u987a\u5e8f\u5bf9\u548c\u9006\u5e8f\u5bf9 \n    memset(c,0,sizeof(c));\n    for(re int i=1;i<=n;++i){\n        lb[i]=sum(n)-sum(y[i]);\n        add(y[i],1);\n    }\n    memset(c,0,sizeof(c));\n    for(re int i=1;i<=n;++i){\n        ls[i]=sum(y[i]);\n        add(y[i],1);\n    }\n//    \u7136\u540e\u53ef\u4ee5\u5229\u7528\u9006\u5e8f\u548c\u987a\u5e8f\u5bf9\u6765\u6c42\u51fa\u540e\u9762\u6709\u591a\u5c11\u4e2a\u5927\u7684\u70b9\u548c\u5c0f\u7684\u70b9 \n    for(re int i=1;i<=n;++i)rb[i]=n-y[i]-lb[i];\n    for(re int i=1;i<=n;++i)rs[i]=y[i]-1-ls[i];\n//    \u8f93\u51fa\u56fe\u817e\u5316\u7b80\u540e\u7684\u5dee\u503c\n    ans=t_1x2x()-t_1xxx()+t_13xx()+t_1234();\n    printf(\"%lld\",(ans+mod)%mod);\n    return 0;\n}\n#endif\n//\u4e2a\u4eba\u624b\u73a9\u6570\u636e\u7684\u4e60\u60ef\n/*\n4\n3 1 2 4\n7\n2 1 5 4 3 7 6\n6\n1 2 3 4 6 5\n10\n2 1 10 5 3 4 9 6 8 7\n5   o\n4        o  \n3     o      \n2       o\n1 o   \n*/\n```",
        "postTime": 1606913474,
        "uid": 374929,
        "name": "SpeMars",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4528 \u3010[CTSC2008]\u56fe\u817e\u3011"
    },
    {
        "content": "[P4528 [CTSC2008]\u56fe\u817e](https://www.luogu.com.cn/problem/P4528)\n\n\u95ea\u7535\u548c\u5c71\u5cf0\u7684\u5f62\u72b6\u592a\u5947\u602a\u4e86\uff0c\u4e0d\u597d\u7b97\uff0c\u8003\u8651\u8f6c\u5316\uff08\u5bb9\u65a5\uff09\u4e00\u4e0b\n$$\n\\begin{aligned}\nans=&1324-1243-1432\\\\\n=&(1x2x-1423)-(12xx-1234)-(14xx-1423)\\\\\n=&1x2x-12xx+1234-14xx\\\\\n=&1x2x+1234-1xxx+13xx\n\\end{aligned}\n$$\n\u5176\u4e2d $x$ \u8868\u793a\u5143\u7d20\u4efb\u610f\u4f46\u4e0d\u80fd\u91cd\u590d\u3002\u7136\u540e\u4e00\u4e2a\u4e00\u4e2a\u8003\u8651\u5982\u4f55\u7b97\u3002\u8bbe $L_i=\\sum\\limits_{j<i}[y_j<y_i],R_i=\\sum\\limits_{j>i}[y_j<y_i]$\uff0c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6c42\u51fa\u3002\n\n* $1234$\n\n  \u679a\u4e3e $3$ \u7684\u4f4d\u7f6e $i$\uff0c\u5219 $4$ \u7684\u65b9\u6848\u6570\u5373 $n-i-R_i$\uff1b\u82e5 $2$ \u7684\u4f4d\u7f6e\u4e3a $j$\uff0c\u5219 $1$ \u7684\u65b9\u6848\u6570\u4e3a $L_j$\u3002\u90a3\u4e48\u8fd9\u90e8\u5206\u7684\u7b54\u6848\u5373\u4e3a $\\sum\\limits_{i}(n-i-R_i)(\\sum\\limits_{j<i,y_j<y_i}L_j)$\uff0c\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\n\n* $1x2x$ \n\n  \u679a\u4e3e $2$ \u7684\u4f4d\u7f6e $i$\uff0c\u53f3\u8fb9\u7684\u65b9\u6848\u6570\u4e3a $n-i-R_i $\uff1b\u8bbe $1$ \u7684\u4f4d\u7f6e\u4e3a $j$\uff0c$x$ \u7684\u4f4d\u7f6e\u4e3a $k$\uff0c\u82e5\u4e0d\u8003\u8651 $j<k \\wedge y_j<y_k$ \u7684\u9650\u5236\uff0c\u5de6\u8fb9\u7684\u65b9\u6848\u6570\u4e3a $L_i\\times(i-1)$\uff0c\u4f46\u8fd8\u8981\u51cf\u53bb $j<k \\wedge y_j>y_k$ \u548c $j\\ge k$ \u7684\u60c5\u51b5\u3002 \u5373\u51cf\u53bb ${L_i\\choose 2}$ \u548c $\\sum\\limits_{y_j<y_i,j<i}j$\n\n* $1xxx$\n\n  \u5373 $\\sum\\limits_i{n-i-R_i\\choose3}$\n\n* $13xx$\n\n  \u679a\u4e3e $3$ \u7684\u4f4d\u7f6e $i$\uff0c$4$ \u6709 $n-i-R_i$ \u79cd\u9009\u6cd5\u3002\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\u5bf9\u4e8e\u6bcf\u4e2a $3$ \u6c42\u51fa $(1,3,2)$ \u7684\u4e09\u5143\u7ec4\u4e2a\u6570 \u3002\n\n  * \u9996\u5148\u7b97\u51fa\u5168\u5c40\u7684 $(1,2)$ \u4e2a\u6570\uff0c\u5373 $\\sum\\limits_{y_j<y_i} L_j$\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u4e00\u4e0b\u3002\n  * \u51cf\u53bb $(1,2,3)$ \u7684\u4e2a\u6570\uff0c\u5373 $\\sum\\limits_{j<i,y_j<y_i}L_j$\n  * \u518d\u51cf\u53bb $(3,1,2)$ \u7684\u65b9\u6848\u6570\uff0c\u5373 $3xx-321$ \uff0c\u5373 ${R_i\\choose 2}-\\sum\\limits_{j>i,y_j<y_i}R_j$\n\n  \u5316\u7b80\u4e00\u4e0b\uff0c\u4e09\u5143\u7ec4\u7684\u4e2a\u6570\u5373 $\\sum\\limits_{j>i,y_j<y_i}(L_j+R_j)-{R_i\\choose 2}$\n\n\u901a\u8fc7\u819c\u9898\u89e3\u4e86\u89e3\u5230\u53e6\u4e00\u79cd\u7684\u505a\u6cd5\uff1a\n\n\u8bbe $1$ \u7684\u4f4d\u7f6e\u4e3a $j$ \uff0c$2$ \u7684\u4f4d\u7f6e\u4e3a $k$\uff0c\u5219 $1,2$ \u7684\u65b9\u6848\u8981\u6ee1\u8db3 $j<i<k\\wedge y_j<y_k<y_i$\u3002\u82e5\u53ea\u8003\u8651 $j<i,y_j<y_i,y_k<y_i$ \u5219\u65b9\u6848\u6570\u4e3a $L_i(y_i-1)$\uff0c\u518d\u51cf\u53bb $k\\le i\\wedge y_k>y_j$ \u7684\u65b9\u6848\u6570 $L_i\\choose 2$ \u548c $y_k\\le y_j$ \u7684\u65b9\u6848\u6570 $\\sum\\limits_{j<i,y_j<y_i} y_j$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nnamespace FGF\n{\n\tint n,m;\n\tconst int N=2e5+5,mo=16777216,inv=(mo+1)/2;\n\tll a[N],c[N],b[N],L[N],R[N],ans;\n\tll query(int x){ll s=0;while(x)(s+=c[x])%=mo,x-=x&(-x);return s;}\n\tvoid add(int x,int y){while(x<=n)(c[x]+=y)%=mo,x+=x&(-x);}\n\tvoid work()\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tscanf(\"%lld\",&a[i]);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tL[i]=query(a[i]),add(a[i],1);\n\t\tmemset(c,0,sizeof(c));\n\t\tfor(int i=n;i;i--)\n\t\t\tR[i]=query(a[i]),add(a[i],1);\n\t\tmemset(c,0,sizeof(c));\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans=(ans+(n-i-R[i])*query(a[i])%mo)%mo,add(a[i],L[i]);\n\t\tmemset(c,0,sizeof(c));\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans=(ans+(n-i-R[i])*(L[i]*(i-1)%mo-(L[i]-1)*L[i]/2%mo-query(a[i]))%mo)%mo,add(a[i],i);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans=(ans-max(0ll,(n-i-R[i])*(n-i-R[i]-1)*(n-i-R[i]-2)/6)%mo+mo)%mo;\n\t\tmemset(c,0,sizeof(c));\n\t\tfor(int i=n;i;i--)\n\t\t\tans=(ans+(n-i-R[i])*(query(a[i])-R[i]*(R[i]-1)/2%mo)%mo)%mo,add(a[i],L[i]+R[i]);\n\t\tprintf(\"%lld\\n\",(ans+mo)%mo);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1616123341,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P4528 [CTSC2008]\u56fe\u817e\uff08\u5bb9\u65a5+\u6811\u72b6\u6570\u7ec4\uff09"
    },
    {
        "content": "# Link\n\n[P4528 [CTSC2008]\u56fe\u817e](https://www.luogu.com.cn/problem/P4528)\n\n# Solve\n\n\u4e00\u9053\u975e\u5e38\u597d\u7684\u601d\u7ef4\u9898\u3002\n\n\u76f4\u63a5\u7edf\u8ba1\u975e\u5e38\u96be\uff0c\u9700\u8981\u7528\u7c7b\u4f3c\u5bb9\u65a5\u7684\u60f3\u6cd5\u4f18\u5316\u4e00\u9053\n\n\u6700\u540e\u7684\u7b54\u6848\n\n$=1324-1432-1243$\n\n$=(1x2x-1423)-(14xx-1423)-(12xx-1234)$\n\n$=1x2x-14xx-12xx+1234$\n\n$=1x2x-1xxx+13xx+1234$\n\n\uff08$x$\u8868\u793a\u6392\u540d\u4efb\u610f\uff0c\u4f46\u662f\u4e0d\u80fd\u91cd\u590d\uff09\n\n\u4e8e\u662f\u6211\u4eec\u601d\u8003\u5982\u4f55\u7b97\u51fa$1x2x,1xxx,13xx,1234$\n\n\u5148\u9884\u5904\u7406\u51e0\u4e2a\u6570\u7ec4$L_i,R_i$\n\n$L_i=\\sum_{j<i}[y_j<y_i],R_i=\\sum_{j>i}[y_j<y_i]$\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u51fa\u6765\u5c31\u597d\u4e86\n\n\u63a5\u4e0b\u6765\u770b\u5206\u522b\u600e\u4e48\u6c42\n\n## 1xxx\n\n\u6bd4\u8f83\u7b80\u5355\uff0c\u5bf9\u4e8e\u6bcf\u4e2a$i$\u540e\u9762\u4e09\u4e2a\u6570\u4e71\u53d6\uff0c\u5c31\u662f$\\sum C_{n-i-R_i}^3$\n\n## 1234\n\n\u679a\u4e3e$3$\u540e\u9762\u7684\u4e2a\u6570\u5c31\u662f$n-i-R_i$,\u5982\u679c$2$\u7684\u4f4d\u7f6e\u786e\u5b9a\u4e86\uff0c\u90a3\u4e48$1$\u7684\u65b9\u6848\u6570\u5c31\u662f$L_j$\uff0c\u6240\u4ee5\u7b54\u6848\u5c31\u662f$\\sum_{i} (n-i-R_i)(\\sum_{j<i,y_j<y_i}L_j)$\n\n\u7528\u6811\u72b6\u6570\u7ec4\u6765\u7ef4\u62a4\n\n## 1x2x\n\n\u5148\u679a\u4e3e$2$\u7684\u4f4d\u7f6e$i$\uff0c\u90a3\u53f3\u8fb9\u6709$n-i-R_i$\u4e2d\u65b9\u6cd5\uff0c\u5de6\u8fb9\u6211\u4eec\u5047\u8bbe$1$\u7684\u4f4d\u7f6e\u4e3a$j$\uff0c$2$\u7684\u4f4d\u7f6e\u4e3a$k$\n\n\u5de6\u8fb9\u8981\u6ee1\u8db3$j<k<i,y_j<y_i,y_k>y_i$\n\n\u82e5\u53ea\u8003\u8651$y_j<y_i,j<i,k<i$\uff0c\u65b9\u6848\u6570\u662f$L_i*(i-1)$\n\n\u90a3\u4e48\u5c31\u591a\u7b97\u4e86$j<k,y_k<y_ij$\u548c$j\u2265k$\u7684\u65b9\u6848\n\n$j<k,y_k<y_ij$\u7684\u65b9\u6848\u6570\u662f$C_{L_i}^2$\n\n$k\u2264j$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a$j$\uff0c$k$\u7684\u53d6\u503c\u8303\u56f4\u90fd\u662f$[1,j]$\uff0c\u6240\u4ee5\u5c31\u662f$\\sum_{p<i,y_p<y_i}p$\n\n\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\n\n## 13xx\n\n\u679a\u4e3e$3$\uff0c\u90a3\u4e48$4$\u6709$n-i-R_i$\u79cd\u9009\u6cd5\uff0c$1,2$\u6ee1\u8db3$j<i<k,y_j<y_k<y_i$\n\n\u82e5\u53ea\u8003\u8651$y_j<y_i,y_k<y_i,j<i$\u90a3\u4e48\u6709$L_i \\ast(y_i-1)$\u79cd\u9009\u6cd5\uff0c\u9700\u8981\u51cf\u53bb$k\u2264i$\u548c$y_j>y_k$\u7684\u65b9\u6848\u6570\n\n$k\u2264i$\u662f$C_{L_i}^2$\n\n$y_k\\leq y_j$,\u5bf9\u4e8e\u6bcf\u4e2a$j$,$k$\u7684\u53d6\u503c\u90fd\u53ef\u4ee5\u53d6\u5230\u6240\u6709$y<y_j$\u7684\u4f4d\u7f6e\uff0c\u6bcf\u4e2a$k$\u7684\u53d6\u503c\u8303\u56f4\u4e3a$[1,p[j]]$\u6240\u4ee5\u5c31\u662f$\\sum_{p<i,y_p<y_i}y_p$\n\n\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\n\n\u6b64\u9898\u975e\u5e38\u7075\u6d3b\u7684\u8fd0\u7528\u4e86\u6811\u72b6\u6570\u7ec4\uff0c\u662f\u4e2a\u597d\u9898\uff0c\u597d\u597d\u770b\u597d\u597d\u5b66\uff0c\n\n# Code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst int maxn=200005;\nconst LL TT=16777216;\nLL p[maxn],L[maxn],R[maxn],c[maxn],ans,N;\ninline int read(){\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch<='9'&&ch>='0')ret=ret*10+ch-'0',ch=getchar();\n\treturn ret*f;\n}\nvoid add_x(int x,LL data){\n\tfor(int i=x;i<=N;i+=i&-i)c[i]=(c[i]+data)%TT;\n\treturn ;\n}\nint get(int x){\n\tLL S=0;\n\tfor(int i=x;i;i-=i&-i)S=(S+c[i])%TT;\n\treturn S;\n}\nint main(){\n\tfreopen(\"P4528.in\",\"r\",stdin);\n\tfreopen(\"P4528.out\",\"w\",stdout);\n\tN=read();\n\tfor(int i=1;i<=N;i++)p[i]=read();\n\tfor(int i=1;i<=N;i++)L[i]=get(p[i]),R[i]=p[i]-L[i]-1,add_x(p[i],1);\n\tfor(int i=1;i<=N;i++){\n\t\tLL x=N-i-R[i];\n\t\tans=(ans-(x*(x-1)*(x-2)/6)%TT+TT)%TT;//1xxx\n\t}\n\tmemset(c,0,sizeof c);\n\tfor(int i=1;i<=N;i++){\n\t\tans=(ans+(N-i-R[i])*get(p[i])%TT)%TT;//1234\n\t\tadd_x(p[i],L[i]);\n\t}\n\tmemset(c,0,sizeof c);\n\tfor(int i=1;i<=N;i++){\n\t\tans=(ans+(L[i]*(i-1)-get(p[i])-(L[i]-1)*L[i]/2)*(N-i-R[i])%TT+TT)%TT;//1x2x\n\t\tadd_x(p[i],i);\n\t}\n\tmemset(c,0,sizeof c);\n\tfor(int i=1;i<=N;i++){\n\t\tans=(ans+(L[i]*(p[i]-1)-(L[i]-1)*L[i]/2-get(p[i]))*(N-i-R[i])%TT+TT)%TT;//13xx\n\t\tadd_x(p[i],p[i]);\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1603693478,
        "uid": 128822,
        "name": "OI\u754c\u7684\u5c0f\u6df7\u6df7",
        "ccfLevel": 6,
        "title": "P4528 [CTSC2008]\u56fe\u817e \u9898\u89e3"
    },
    {
        "content": "$$f[1324]-f[1243]-f[1432]=(f[1x2x]-f[1423])+(f[12xx]-f[1234])+(f[14xx]-f[1423])$$\n$$=f[1x2x]+f[1234]-f[12xx]-f[14xx]$$\n$$=f[1x2x]+f[1234]+f[13xx]-f[1xxx]$$\n\n\u8bbe$l_i,r_i$\u5206\u522b\u8868\u793a$i$\u4f4d\u7f6e\u5de6\u8fb9/\u53f3\u8fb9\u6bd4\u5b83\u5c0f\u7684\u6570\u7684\u4e2a\u6570\uff0c\u8fd9\u4e9b\u4e1c\u897f\u90fd\u53ef\u4ee5\u7528$l_i,r_i$\u8868\u793a\u3002\n\n- $f[1x2x]$\uff1a\u679a\u4e3e\u4e2d\u95f4\u7684$2$\u7684\u4f4d\u7f6e$i$\uff0c\u5219\u53f3\u8fb9\u7684\u4f4d\u7f6e\u7684\u65b9\u6848\u6570\u4e3a$n-i-r_i$\u3002\u5de6\u8fb9\u9009\u4e24\u4e2a\u6570$(x,y)$\u7792\u4f4f$a_x<a_y,x<y$\u7684\u65b9\u6848\u6570\u4e3a$l_i \\times (i-1)$\u3002\u7136\u540e\u6709\u4e24\u79cd\u4e0d\u5408\u6cd5\u60c5\u51b51.\u4e24\u4e2a\u6570\u90fd\u5c0f\u4e8e$x<y,a_y<a_i$\u30022.$y<x$\u5206\u522b\u51cf\u53bb\u5373\u53ef\u3002\n- $f[1234]$\uff1a\u679a\u4e3e\u4e2d\u95f4$2$\u7684\u4f4d\u7f6e$i$\u3002\u65b9\u6848\u6570\u4e3a$l_i\\times\\sum_{j>i,a[j]>a[i]}n-j-r[j]$\n- $f[1xxx]$\uff1a$\\sum \\binom {n-i-r_i} {3}$\n- $f[13xx]$\uff1a\u679a\u4e3e$3$\u7684\u4f4d\u7f6e$i$\uff0c$l_i\\times r_i \\times (n-r_i-1)-(\\sum_{j<i,a_j<a_i}r_j-(\\frac{l_i\\times (l_i-1)}{2}-\\sum_{j<i,a_j<a_i}l_j))$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long lint;\nconst int maxn = 200005, mod = 16777216;\n\nint n, ans, a[maxn], l[maxn], r[maxn];\nint sum[maxn];\n\ninline void inc(int &a, int b)\n{\n\ta += b;\n\tif (a >= mod) a -= mod;\n}\n\ninline void dec(int &a, int b)\n{\n\ta -= b;\n\tif (a < 0) a += mod;\n}\n\ninline int gi()\n{\n\tchar c = getchar();\n\twhile (c < '0' || c > '9') c = getchar();\n\tint sum = 0;\n\twhile ('0' <= c && c <= '9') sum = sum * 10 + c - 48, c = getchar();\n\treturn sum;\n}\n\n#define lowbit(x) (x & (-x))\n\ninline void insert(int x, int a)\n{\n\twhile (x <= n) {\n\t\tinc(sum[x], a);\n\t\tx += lowbit(x);\n\t}\n}\n\ninline int query(int x)\n{\n\tint res = 0;\n\twhile (x) {\n\t\tinc(res, sum[x]);\n\t\tx -= lowbit(x);\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tfreopen(\"picture.in\", \"r\", stdin);\n\tfreopen(\"picture.out\", \"w\", stdout);\n\n\tn = gi();\n\tfor (int i = 1; i <= n; ++i) a[i] = gi();\n\n\tfor (int i = 1; i <= n; ++i) {\n\t\tl[i] = query(a[i]); r[i] = a[i] - l[i] - 1;\n\t\tinsert(a[i], 1);\n\t}\n\n\t//1x2x\n\tmemset(sum + 1, 0, sizeof(int) * n);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tinc(ans, (lint)(n - i - r[i]) * (i - 1) % mod * l[i] % mod);\n\t\tdec(ans, (lint)query(a[i]) * (n - i - r[i]) % mod);\n\t\tdec(ans, (lint)(l[i] - 1) * l[i] / 2 % mod * (n - i - r[i]) % mod);\n\t\tinsert(a[i], i);\n\t}\n\n\t//1234\n\tmemset(sum + 1, 0, sizeof(int) * n);\n\tfor (int i = n; i >= 1; --i) {\n\t\tinc(ans, (lint)l[i] * (query(n) - query(a[i])) % mod);\n\t\tinsert(a[i], n - i - r[i]);\n\t}\n\n\t//1xxx\n\tfor (int t, i = 1; i <= n; ++i) {\n\t\tt = n - i - r[i];\n\t\tif (t >= 3) dec(ans, (lint)t * (t - 1) / 2 * (t - 2) / 3 % mod);\n\t}\n\t\n\t//13xx\n\tmemset(sum + 1, 0, sizeof(int) * n);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tinc(ans, (lint)l[i] * r[i] % mod * (n - i - r[i]) % mod);\n\t\tinc(ans, (lint)l[i] * (l[i] - 1) / 2 % mod * (n - i - r[i]) % mod);\n\t\tdec(ans, (lint)query(a[i]) * (n - i - r[i]) % mod);\n\t\tinsert(a[i], l[i] + r[i]);\n\t}\n\n\tprintf(\"%d\\n\", ans);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1543473936,
        "uid": 119899,
        "name": "dsidsi",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4528 \u3010[CTSC2008]\u56fe\u817e\u3011"
    },
    {
        "content": "\u5c1d\u8bd5\u7528\u56fe\u5f62\u63a8\u5bfc\u7684\u5c51\u9898\u89e3\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u6811\u72b6\u6570\u7ec4\u3002\n\n\u89c2\u5bdf\u53d1\u73b0\uff0c\u6240\u6709\u7684\u56fe\u817e\u7684 $y_a$ \u90fd\u662f\u6700\u5c0f\u503c\uff0c\u5e76\u4e14\u7ec4\u6210\u56fe\u817e\u7684\u70b9\u4e2d\u81f3\u5c11\u6709\u4e00\u7ec4\u9006\u5e8f\u5bf9\u3002\u8bd5\u7740\u628a\u8fd9\u6837\u7684\u70b9\u63d0\u51fa\u6765\u4f5c\u4e3a\u5173\u952e\u70b9\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/53obpw5j.png)\n\n\u5728\u5df2\u7ecf\u6709\u4e86 $3$ \u4e2a\u70b9\u4e4b\u540e\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u53ef\u80fd\u5728\u6807\u53f7\u6807\u51fa\u7684\u533a\u57df\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u3002\u5982\u679c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u533a\u57df \u2462\uff0c\u53ef\u4ee5\u5f97\u5230\u95ea\u7535\u56fe\u817e\uff1b\u5982\u679c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u533a\u57df\u4e03\uff0c\u53ef\u4ee5\u5f97\u5230\u9ad8\u5c71 A \u56fe\u817e\uff1b\u5982\u679c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u533a\u57df \u2460\u3001\u533a\u57df \u2464 \u6216\u533a\u57df \u2468\uff0c\u53ef\u4ee5\u5f97\u5230\u9ad8\u5c71 B \u56fe\u817e\u3002\u6839\u636e\u9898\u610f\uff0c\u4f4d\u4e8e\u533a\u57df \u2462 \u7684\u70b9\u8d21\u732e\u4e3a $1$\uff0c\u4f4d\u4e8e\u533a\u57df \u2466 \u7684\u70b9\u8d21\u732e\u4e3a $-1$\uff0c\u5bf9\u4e8e\u9ad8\u5c71 B \u56fe\u817e\uff0c\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u8ba1\u7b97\uff0c\u53ef\u4ee5\u53ea\u5c06\u4f4d\u4e8e\u533a\u57df \u2460 \u7684\u70b9\u8d21\u732e\u8bbe\u4e3a $-1$\u3002\n\n\u4f46\u662f\u4e09\u5757\u4e0d\u76f8\u90bb\u7684\u8d21\u732e\u4e0d\u597d\u7b97\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u533a\u57df \u2464 \u548c\u533a\u57df \u2468\u3001\u5728\u533a\u57df \u2461 \u548c\u533a\u57df \u2463\u3001\u5728\u533a\u57df \u2465 \u548c\u533a\u57df \u2467\uff0c\u5f97\u5230\u7684\u56fe\u5f62\u662f\u4e00\u6837\u7684\u3002\u53ef\u4ee5\u5c06\u5176\u4e2d\u4e00\u4e2a\u533a\u57df\u7684\u8d21\u732e\u8bbe\u4e3a $1$\uff0c\u53e6\u4e00\u4e2a\u533a\u57df\u7684\u8d21\u732e\u8bbe\u4e3a $-1$\uff0c\u5982\u4e0b\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dsugi330.png)\n\n(\u7eff\u8272\u90e8\u5206\u8d21\u732e\u4e3a $1$\uff0c\u7ea2\u8272\u90e8\u5206\u8d21\u732e\u4e3a $-1$\u3002)\n\nL \u578b\u7684\u7ea2\u8272\u90e8\u5206\u4e0d\u597d\u5904\u7406\uff0c\u8003\u8651\u628a\u7eff\u8272\u90e8\u5206\u7684\u8d21\u732e\u62c6\u4e3a $-1$ \u52a0\u4e0a $2$\u3002\u8fd9\u6837\u4e24\u5757\u8d21\u732e\u90fd\u5448\u77e9\u5f62\u3002\n\n\u4f46\u662f\u6709 $X$\u3001$Y$ \u662f\u9006\u5e8f\u5bf9\u7684\u6761\u4ef6\uff0c\u8d21\u732e\u8fd8\u662f\u4e0d\u597d\u7b97\u3002\u53d1\u73b0 $X$\u3001$Y$ \u662f\u9006\u5e8f\u5bf9\u7684\u7b54\u6848\uff0c\u5c31\u662f\u4e0d\u9650\u5b9a $X$\u3001$Y$ \u7684\u5927\u5c0f\u5173\u7cfb\u7684\u7b54\u6848\u51cf\u53bb $X$\u3001$Y$ \u662f\u987a\u5e8f\u5bf9\u7684\u7b54\u6848\u3002\n\n\u63a5\u4e0b\u6765\u8ba1\u7b97\u8fd9\u56db\u90e8\u5206\u7684\u8d21\u732e\u3002\n\n1. $X$\u3001$Y$ \u662f\u987a\u5e8f\u5bf9\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u4e0b\u56fe\u77e9\u5f62\u533a\u57df\uff0c\u8d21\u732e\u4e3a $-2$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/h9uf70rw.png)\n\n\u679a\u4e3e\u70b9 $X$ \u7684\u4f4d\u7f6e\uff0c\u8bbe\u6709 $v_1$ \u4e2a\u70b9\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\uff0c\u6709 $v_2$ \u4e2a\u70b9\u5728\u4ed6\u7684\u5de6\u4e0b\u65b9\u3002$v1$\uff0c$v2$ \u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u7528\u6811\u72b6\u6570\u7ec4\u8ba1\u7b97\u3002\u5728\u4ed6\u7684\u5de6\u4e0b\u65b9\u7684\u70b9\u90fd\u53ef\u4ee5\u9009\u4f5c $A$ \u70b9\uff0c\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\u7684\u70b9\u90fd\u53ef\u4ee5\u9009\u4f5c $Y$ \u70b9\uff0c\u518d\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\u9009\u53e6\u5916\u4e00\u4e2a\u70b9\uff0c\u65b9\u6848\u4e3a $v_1(v_1-1)v_2$\u3002\n\n2. $X$\u3001$Y$ \u662f\u987a\u5e8f\u5bf9\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u4e0b\u56fe\u77e9\u5f62\u533a\u57df\uff0c\u8d21\u732e\u4e3a $1$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/rncozw6p.png)\n\n\u679a\u4e3e\u70b9 $A$ \u7684\u4f4d\u7f6e\uff0c\u8bbe\u6709 $v_1$ \u4e2a\u70b9\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\uff0c\u8bbe\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\u987a\u5e8f\u5bf9\u6570\u4e3a $s$\u3002\u65b9\u6848\u4e3a $sv_1$\u3002\n\n$s$ \u600e\u4e48\u6c42\uff1f\u8bbe\u987a\u5e8f\u5bf9\u4e2d\u7684\u70b9\u662f $X$\u3001$Y$\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u7ec4\u987a\u5e8f\u5bf9\u8981\u5728 $A$ \u7684\u53f3\u4e0a\u65b9\uff0c\u53ea\u9700\u8981\u8ba9 $X$ \u5728 $A$ \u7684\u53f3\u4e0a\u65b9\u3002\u5982\u679c\u8ba9\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u662f\u4ed6\u4f5c\u4e3a\u987a\u5e8f\u5bf9\u4e2d\u5de6\u8fb9\u4e00\u4e2a\u70b9\u7ec4\u6210\u7684\u987a\u5e8f\u5bf9\u6570\uff08\u4e5f\u5c31\u662f\u4ed6\u53f3\u4e0a\u65b9\u7684\u70b9\u6570\uff09\u3002$s$ \u5c31\u7b49\u4e8e $A$ \u70b9\u53f3\u4e0a\u65b9\u7684\u70b9\u7684\u6743\u503c\u548c\u3002\n\n3. \u4e0d\u9650\u5b9a $X$\u3001$Y$ \u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u4e0b\u56fe\u77e9\u5f62\u533a\u57df\uff0c\u8d21\u732e\u4e3a $-1$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/f5l6gihq.png)\n\n\u679a\u4e3e\u70b9 $A$ \u7684\u4f4d\u7f6e\uff0c\u8bbe\u6709 $v_1$ \u4e2a\u70b9\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\u3002\u5148\u5728\u4ed6\u7684\u53f3\u4e0a\u65b9\u5148\u51fa\u4e00\u5bf9\u70b9 $X$\u3001$Y$\uff0c\u518d\u9009\u53e6\u5916\u4e00\u4e2a\u70b9\uff0c\u65b9\u6848\u4e3a $\\frac{v_1(v_i-1)(v_i-2)}{2}$\u3002\n\n4. \u4e0d\u9650\u5b9a $X$\u3001$Y$ \u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u5728\u4e0b\u56fe\u77e9\u5f62\u533a\u57df\uff0c\u8d21\u732e\u4e3a $2$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/tdjpng4b.png)\n\n\u8fd9\u4e00\u5757\u6bd4\u8f83\u68d8\u624b\uff0c\u4e0d\u5982\u8003\u8651\u4ec0\u4e48\u6837\u7684\u56db\u4e2a\u70b9\u624d\u80fd\u6ee1\u8db3\u8fd9\u4e2a\u8d21\u732e\u7684\u6761\u4ef6\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/z03dzwfy.png)\n\n\u9996\u5148 $A$ \u8981\u5728\u5de6\u4e0b\u65b9\uff0c\u5176\u4f59\u4e09\u4e2a\u70b9\u4e2d\u6a2a\u5750\u6807\u548c\u7eb5\u5750\u6807\u6700\u5c0f\u7684\u70b9\u662f $X$ \u6216\u8005 $Y$\u3002\uff08\u5982\u679c\u4e0d\u662f\u7684\u8bdd\uff0c\u5269\u4e0b\u4e00\u4e2a\u70b9\u4f1a\u5728\u77e9\u5f62\u8303\u56f4\u4e4b\u5916\u3002\uff09\u5982\u679c\u5176\u4f59\u4e09\u4e2a\u70b9\u4e2d\u6a2a\u5750\u6807\u548c\u7eb5\u5750\u6807\u6700\u5c0f\u7684\u70b9\u7684\u4e0d\u662f\u540c\u4e00\u4e2a\u70b9\uff0c$X$\u3001$Y$ \u53ea\u6709\u4e00\u79cd\u53d6\u6cd5\uff0c\u5426\u5219 $X$\u3001$Y$ \u6709\u4e24\u79cd\u53d6\u6cd5\uff08\u591a\u4e00\u79cd\u53d6\u6cd5\uff09\u3002\n\n\u5bf9\u4e8e\u5176\u4f59\u4e09\u4e2a\u70b9\u4e2d\u6a2a\u5750\u6807\u548c\u7eb5\u5750\u6807\u6700\u5c0f\u7684\u70b9\u7684\u4e0d\u4e00\u5b9a\u662f\u540c\u4e00\u4e2a\u70b9\u7684\u60c5\u51b5\uff0c\u8ba1\u7b97\u65b9\u6cd5\u540c 3.\u3002\n\n\u5bf9\u4e8e\u5176\u4f59\u4e09\u4e2a\u70b9\u4e2d\u6a2a\u5750\u6807\u548c\u7eb5\u5750\u6807\u6700\u5c0f\u7684\u70b9\u7684\u662f\u540c\u4e00\u4e2a\u70b9\u7684\u60c5\u51b5\uff0c\u8ba1\u7b97\u65b9\u6cd5\u540c 1.\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long\n#define Maxn 200005\n#define mod 16777216\n#define inf 0x3f3f3f3f\n#define lb(i) (i & -(i))\n#define mes(s, x) memset(s, x, sizeof(s))\nusing namespace std;\ninline LL read(){char c;c = getchar();while(!(('0' <= c && c <= '9') || c == '-')) c = getchar();bool flag = 0;if(c == '-'){flag = 1;c = getchar();}LL tot = 0;while('0' <= c && c <= '9'){tot = 10 * tot + c - '0';c = getchar();}return flag ? -tot : tot;}\nint n, a[Maxn], v1[Maxn], v2[Maxn];\nLL s1[Maxn], s2[Maxn];\nvoid add(LL *s, int i, int x){\n\twhile(i <= n){\n\t\ts[i] += x;\n\t\ts[i] %= mod;\n\t\ti += lb(i);\n\t}\n}\nLL tot(LL *s, int i){\n\tLL t = 0;\n\twhile(i){\n\t\tt += s[i];\n\t\tt %= mod;\n\t\ti -= lb(i);\n\t}\n\treturn t;\n}\nint main(){\n\tn = read();\n\tLL x, y, ans = 0;\n\tfor(int i = 1; i <= n; i++) a[i] = read();\n\tfor(int i = n; i >= 1; i--){\n\t\tv1[i] = tot(s1, n) - tot(s1, a[i]);\n\t\tadd(s1, a[i], 1);\n\t}\n\tmes(s1, 0);\n\tfor(int i = 1; i <= n; i++){\n\t\tv2[i] = tot(s1, a[i]);\n\t\tadd(s1, a[i], 1);\n\t}\n\tmes(s1, 0);\n\tfor(int i = n; i >= 1; i--){\n\t\tans = (ans + 1 * (tot(s1, n) - tot(s1, a[i]) + mod) * (v1[i] - 2) % mod) % mod;\n\t\tadd(s1, a[i], v1[i]);\n\t}\n\tfor(int i = n; i >= 1; i--){\n\t\tx = v1[i];\n\t\tans = (ans - 2 * x * (x - 1) % mod * v2[i] % mod + mod) % mod;\n\t\tans = (ans - x * (x - 1) / 2 % mod * (x - 2) % mod + mod) % mod;\n\t\tans = (ans + 2 * x * (x - 1) * (x - 2) / 6 % mod) % mod;\n\t\tans = (ans + 2 * x * (x - 1) / 2 % mod * v2[i] % mod) % mod;\n\t}\n\tprintf(\"%lld\", ans);\n\treturn 0;\n}\n\n",
        "postTime": 1683189532,
        "uid": 488539,
        "name": "E_firework",
        "ccfLevel": 7,
        "title": "P4528 \u9898\u89e3"
    },
    {
        "content": "\u795e\u4ed9\u9898\u3002\n\n\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u4e00\u4e2a\u6392\u5217\uff0c\u987a\u6b21\u9009\u56db\u4e2a\u6570\uff0c\u95ee\u5927\u5c0f\u987a\u5e8f\u4e3a $1324$ \u7684\u65b9\u6848\u6570\u51cf\u53bb\u4e3a $1243$\u3001$1432$ \u65b9\u6848\u6570\u4e4b\u548c\u7684\u7ed3\u679c\u3002\n\n\u4e09\u4e2a\u65b9\u6848\u770b\u8d77\u6765\u6ca1\u4e00\u4e2a\u53ef\u505a\u7684\uff0c\u5f00\u59cb\u63a8\u5f0f\u5b50\u3002\u5176\u4ed6\u9898\u89e3\u91cc\u5df2\u7ecf\u6709\u5b8c\u5907\u7684\u63a8\u5bfc\uff0c\u8fd9\u91cc\u4e0d\u505a\u91cd\u70b9\uff0c\u5f97\u5230\u7ed3\u679c\u4e3a 1x2x+13xx+1234-1xxx\u3002\n\n\u9996\u5148\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u7ef4\u62a4\u56db\u4e2a\u503c\uff0c\u7528 $ld_i,lu_i$ \u8868\u793a\u4f4d\u7f6e $i$ \u524d\u9762\u7684\u6570\u4e2d\u5c0f\u4e8e/\u5927\u4e8e $a_i$ \u6570\u7684\u4e2a\u6570\uff0c$rd_i,ru_i$ \u8868\u793a\u4f4d\u7f6e $i$ \u540e\u9762\u7684\u6570\u4e2d\u5c0f\u4e8e/\u5927\u4e8e $a_i$ \u6570\u7684\u4e2a\u6570\u3002\n\n\u7136\u540e\u5bf9\u6bcf\u4e00\u9879\u5206\u522b\u8003\u8651\u3002\n\n- 1x2x \u9879\n\n\u679a\u4e3e\u7b2c\u4e8c\u5927\u7684\u4f4d\u7f6e $i$\u3002\u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u6570\uff0c\u53ea\u8981\u6bd4 $a_i$ \u5927\u5373\u5408\u6cd5\uff0c\u8be5\u4f4d\u7f6e\u65b9\u6848\u6570\u4e3a $ru_i$\u3002\n\n\u8003\u8651\u524d\u9762 1x2 \u90e8\u5206\u65b9\u6848\u6570\uff0c\u5b9e\u9645\u5c31\u662f 2 \u56fa\u5b9a\u65f6\u7edf\u8ba1 132\u3002\u76f4\u63a5\u505a\u4e0d\u597d\u7edf\u8ba1\uff0c\u7a0d\u52a0\u53d8\u5f62\u3002\n\n```\n132\n=xx2-312\n=xx2-(x1x-213)\n=xx2-x1x+213\n=xx2-x1x+xx3-123\n=xxx-xx1-x1x-123\n```\n\n\u663e\u7136\uff0c$xxx=C_{i-1}^2$\uff0c$xx1=C_{lu_i}^2$\u3002\n\n\u89c2\u5bdf\u53ef\u77e5\uff0c$x1x=\\sum\\limits_{j<i,a_j<a_i}lu_j$\uff0c$123=\\sum\\limits_{j<i,a_j<a_i}ld_j$\u3002\u4e24\u9879\u5408\u5e76\u4e3a $\\sum\\limits_{j<i,a_j<a_i}lu_j+ld_j$\u3002\n\n\u6811\u72b6\u6570\u7ec4\u5728 $a_i$ \u5904\u7ef4\u62a4 $lu_i+ld_i$ \u5373\u53ef\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u6c42\u5b8c 132 \u7684\u65b9\u6848\u8bb0\u5f97\u4e58\u4e0a $ru_i$\u3002\n\n- 13xx \u9879\n\n\u679a\u4e3e\u7b2c\u4e09\u5927\u7684\u4f4d\u7f6e $i$\u3002\u540e\u9762\u4e00\u5b9a\u8981\u9009\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\uff0c\u4f9d\u65e7\u4e58\u4e0a $ru_i$\u3002\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f 3 \u56fa\u5b9a\uff0c\u8ba1\u6570 132\u3002\u8fd9\u4e2a\u5f62\u5f0f\u5f88\u96be\u548c\u5148\u524d\u7ef4\u62a4\u7684\u51e0\u4e2a\u91cf\u4ea7\u751f\u8054\u7cfb\uff0c\u6240\u4ee5\u53d8\u901a\u4e00\u4e0b\uff0c\u8003\u8651\u4ece 12 \u5207\u5165\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u8ba1\u6570 12 \u70b9\u5bf9\u603b\u4e2a\u6570\uff0c\u51cf\u53bb 123 \u548c 312 \u7684\u4e2a\u6570\uff0c\u5c31\u662f 132 \u7684\u4e2a\u6570\u3002\u8fd9\u91cc\u7684 3 \u662f\u6211\u4eec\u679a\u4e3e\u7684\u4f4d\u7f6e $i$\u3002\n\n$sum_i$ \u8868\u793a $\\le i$ \u7684\u6570\u5f62\u6210\u987a\u5e8f\u5bf9\u4e2a\u6570\u3002\u4ee4 $a_x=i+1$\uff0c\u5219\u6709 $sum_{i+1}=sum_i+ld_x$\uff0c\u9012\u63a8\u5904\u7406\u5373\u53ef\u3002\n\n```\n132\n=sum-123-312\n=sum-123-(3xx-321)\n=sum-3xx-123+321\n```\n\n$3xx=C_{rd_i}^2$\uff0c$321=\\sum\\limits_{j>i,a_j<a_i}rd_i$\uff0c$123=\\sum\\limits_{j<i,a_j<a_i}ld_j$\u3002\n\n\u540e\u4e24\u9879\u5408\u5e76\uff0c\u82e5 $j<i$\uff0c$a_j$ \u5904\u7ef4\u62a4 $-ld_j$\uff1b\u82e5 $j>i$\uff0c$a_j$ \u5904\u7ef4\u62a4 $rd_j$\uff0c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\u8bb0\u5f97\u4e58\u4e0a $ru_i$\u3002\n\n- 1234 \u9879\n\n\u6570\u636e\u7ed3\u6784\u4f18\u5316 dp \u5f53\u7136\u53ef\u4ee5\u3002\u66f4\u597d\u7684\u65b9\u6cd5\u662f\u679a\u4e3e\u7b2c 3 \u9879\uff0c\u524d\u9762\u7ecf\u5178 123 \u8ba1\u6570\uff0c\u6700\u540e\u4e58\u4e0a $ru_i$\u3002\n\n- 1xxx \u9879\n\n\u679a\u4e3e\u7b2c\u4e00\u9879\uff0c\u540e\u9762\u6311\u5927\u7684\u968f\u4fbf\u9009\uff0c$C_{ru_i}^3$\u3002\n\n\u5b8c\u6574\u4ee3\u7801\n\n```cpp\n#include<cstdio>\nconst int mod=16777216;\nint n,a[200001],pos[200001],ld[200001],lu[200001],rd[200001],ru[200001];\nlong long tre[200001],sum[200001];\nint lowbit(int x){return x&(-x);}\nvoid change(int x,int val){while(x<=n)tre[x]+=val,x+=lowbit(x);}\nlong long qsum(int x){\n\tlong long res=0;\n\twhile(x)res+=tre[x],x-=lowbit(x);\n\treturn res%mod;\n}\nlong long c2(long long x){return x*(x-1)/2%mod;}\nlong long c3(long long x){return x*(x-1)/2*(x-2)/3%mod;}\nlong long a_b_(){\n\tlong long res=0;\n\tint i;\n\tfor(i=1;i<=n;i++){\n\t\tres+=1ll*ru[i]*(c2(i-1)-c2(lu[i])-qsum(a[i]-1)+3ll*mod)%mod;\n\t\tres%=mod;\n\t\tchange(a[i],lu[i]+ld[i]);\n\t}\n\tfor(i=1;i<=n;i++)tre[i]=0;\n\treturn res;\n}\nlong long a___(){\n\tlong long res=0;\n\tint i;\n\tfor(i=1;i<=n;i++)res=(res+c3(ru[i]))%mod;\n\treturn res;\n}\nlong long ac__(){\n\tlong long res=0;\n\tint i;\n\tfor(i=1;i<=n;i++)change(a[i],rd[i]);\n\tfor(i=1;i<=n;i++){\n\t\tchange(a[i],-rd[i]);\n\t\tres+=1ll*ru[i]*(sum[a[i]-1]-c2(rd[i])+qsum(a[i])+mod)%mod;\n\t\tres%=mod;\n\t\tchange(a[i],-ld[i]);\n\t}\n\tfor(i=1;i<=n;i++)tre[i]=0;\n\treturn res;\n}\nlong long abcd(){\n\tint i;\n\tlong long res=0;\n\tfor(i=1;i<=n;i++){\n\t\tres+=1ll*ru[i]*qsum(a[i]);\n\t\tres%=mod;\n\t\tchange(a[i],ld[i]);\n\t}\n\tfor(i=1;i<=n;i++)tre[i]=0;\n\treturn res;\n}\nint main(){\n\tint i;\n\tscanf(\"%d\",&n);\n\tfor(i=1;i<=n;i++){\n\t\tscanf(\"%d\",&a[i]);\n\t\tpos[a[i]]=i;\n\t\tld[i]=qsum(a[i]-1);\n\t\tlu[i]=i-ld[i]-1;\n\t\trd[i]=a[i]-ld[i]-1;\n\t\tru[i]=n-i-rd[i];\n\t\tchange(a[i],1);\n\t}\n\tfor(i=1;i<=n;i++)sum[i]=sum[i-1]+ld[pos[i]];\n\tfor(i=1;i<=n;i++)tre[i]=0;\n\tprintf(\"%lld\",(a_b_()-a___()+ac__()+abcd()+mod)%mod);\n}\n```",
        "postTime": 1670426563,
        "uid": 128606,
        "name": "2018ljw",
        "ccfLevel": 7,
        "title": "P4528 \u56fe\u817e\u9898\u89e3"
    },
    {
        "content": "\u6c42\u51fal[i]\uff0cr[i]\uff0c\u5206\u522b\u8868\u793a\u5728i\u7684\u5de6\u53f3\u6bd4a[i]\u5c0f\u7684\u4e2a\u6570\n\n\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6c42l[i]\uff0c\u5219r[i]=(a[i]-l[i]-1)\uff1b\n```\n#include <bits/stdc++.h>\nusing namespace std;\n#define inf 1000000000\n#define ll long long\n#define pa pair<int,int>\n#define P 16777215\nconst int maxn=200005;\n\nint n,res,s[maxn];\n\nint read()\n{\n\tint x=0,f=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9')\n\t{\n\t    if(ch=='-')\n\t\t    f=-1;\n\t\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9')\n\t{\n\t    x=(x<<3)+(x<<1)+(ch^48);\n\t\tch=getchar();\n\t}\n\treturn x*f;\n}\n\nll l[maxn],r[maxn],t[maxn];\n\nvoid add(int x,int val)\n{\n\tfor(int i=x;i<=n;i+=(i&-i))\n\t    t[i]+=val;\n}\n\nll query(int x)\n{\n\tll res=0;\n\tfor(int i=x;i;i-=(i&-i))\n\t    res+=t[i];\n\treturn res;\n}\n\nint c1()\n{\n\tmemset(t,0,sizeof(t));\n\tll res=0;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tres=(res+(l[i]*(i-1)-query(s[i])-l[i]*(l[i]-1)/2)*(n-r[i]-i))&P;\n\t\tadd(s[i],i);\n\t}\n\treturn res;\n}\n\nint c2()\n{\n\tmemset(t,0,sizeof(t));\n    ll res=0;\n\tfor(int i=n;i;--i)\n\t{\n\t\tres=(res+(query(s[i])-r[i]*(r[i]+1)/2)*(n-r[i]-i))&P;\n\t\tadd(s[i],s[i]);\n\t}\n\treturn res;\n}\n\nint c3()\n{\n\tmemset(t,0,sizeof(t));\n\tll res=0;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tres=(res+query(s[i])*(n-i-r[i]))&P;\n\t\tadd(s[i],l[i]);\n\t}\n\treturn res;\n}\n\nint c4()\n{\n\tll res=0;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tll t=n-i-r[i];\n\t\tif(t>=3)\n\t\t\tres=(res+t*(t-1)*(t-2)/6)&P;\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;++i)\n\t    s[i]=read();\n\t    \n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tl[i]=query(s[i]);\n\t\tr[i]=s[i]-l[i]-1;\n\t\tadd(s[i],1);\n\t}\n\t\n\tprintf(\"%d\",(c1()+c2()+c3()-c4())&P);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1540389907,
        "uid": 73881,
        "name": "bwoi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4528 \u3010[CTSC2008]\u56fe\u817e\u3011"
    }
]