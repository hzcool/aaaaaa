[
    {
        "content": "\u80fd\u4ece$i$\u8d70\u5230\u6240\u6709\u8dd1\u9053 \u76f8\u5f53\u4e8e \u80fd\u4ece$i$\u8d70\u5230$1$\u548c$n$.\n\u8fb9\u53cd\u5411\u540e\u5c31\u76f8\u5f53\u4e8e \u80fd\u4ece$1$\u548c$n$\u8d70\u5230$i$.\n\n\u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0,\u628a$1$\\~$n$\u53eb\u505ax\u5750\u6807,$1$\\~$(m+1)$\u53eb\u505ay\u5750\u6807.\n\n\u7136\u540e\u6211\u4eec\u5c06\u56fe**\u4e0a\u4e0b\u7ffb\u8f6c**($y$\u5750\u6807)\u540e,\u80fd\u4ece$1$\u8d70\u5230$i$\u7684\u8bdd\u4e00\u5b9a\u4f1a\u7ecf\u8fc7$i-1$\u6761\u5411\u53f3\u7684\u8fb9,\u4e14\u8fd9\u4e9b\u8fb9\u7684$y$\u5750\u6807\u4e0d\u4e0b\u964d.\n\n\u90a3\u4e48\u6211\u4eec\u8bbe$fl[i]$\u8868\u793a\u4ece$1$\u8d70\u5230$i$\u6700\u5c0f\u52a0\u8fb9\u6570\u91cf,\u90a3\u4e48\u6709\n$fl[i]=i-1-LIS$\n\n\u8fd9\u91cc\u7684$LIS$\u662fx\u5750\u6807\u5728$1$~$(i-1)$\u7684\u8fb9\u7684$y$\u5750\u6807\u5f62\u6210\u7684\u6700\u957f\u4e0d\u4e0b\u964d\u5b50\u5e8f\u5217\u957f\u5ea6.\n\n\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5$O(nlogn)$\u9884\u5904\u7406\u51fa\u6765,\u540c\u65f6\u6211\u4eec\u53cd\u7740\u5904\u7406\u4e00\u904d\u5411\u5de6\u7684\u8fb9\u5c31\u80fd\u5904\u7406\u51fa\u4ece$n$\u8d70\u5230$i$\u7684\u6700\u5c0f\u52a0\u8fb9\u6570\u91cf$fr[i]$.\n\n\u6700\u7ec8\u7b54\u6848\u4e00\u5b9a\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u533a\u95f4$[i,j]$.\u56e0\u4e3a\u5982\u679c\u4e24\u4e2a\u6ee1\u8db3\u7b54\u6848\u7684\u4f4d\u7f6e\u4e0d\u76f8\u90bb,\u4f53\u73b0\u5728\u8fb9\u7684$y$\u5750\u6807\u5e8f\u5217\u4e0a\u5c31\u662f\u4e24\u5ea7\u5c71\u5cf0,\u4e2d\u95f4\u7684\u503c\u4e5f\u4e00\u5b9a\u53ef\u4ee5\u5f62\u6210\u5c71\u5cf0.\u5982\u4e0b\u56fe\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20190328185259756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0lrZTk0MDA2Nzg5Mw==,size_16,color_FFFFFF,t_70)\n\u5047\u8bbe\u4e24\u5ea7\u5c71\u5cf0\u4e3a$L,R$.\u90a3\u4e48\u5bf9\u4e8e\u5728$[L,R]$\u4e2d\u7684\u70b9,\u5982\u679c\u5728M\u5de6\u8fb9\u5c31\u53d6\u2460\u4e0a\u7684\u70b9,\u5982\u679c\u5728M\u53f3\u8fb9\u5c31\u53d6\u2461\u4e0a\u7684\u70b9,\u8fd9\u6837\u4e5f\u4e00\u5b9a\u80fd\u591f\u5f62\u6210\u603b\u957f\u4e3a$n$\u7684\u5c71\u5cf0.\n\n\u6240\u4ee5\u8bf4\u8981\u6c42\u7684\u5c31\u662f\u533a\u95f4$[i,j]$\u6ee1\u8db3$fr[i]+fl[j]<=k$\u7684\u6700\u957f\u533a\u95f4\u957f\u5ea6.\n\n\u7531\u4e8e$fr[i]$\u9012\u51cf,$fl[i]$\u9012\u589e,\u90a3\u4e48\u679a\u4e3e$i$\u589e\u52a0\u7684\u65f6\u5019,\u4e3a\u4e86\u8ba9\u533a\u95f4\u957f\u5ea6\u5c3d\u91cf\u5927,$j$\u4e5f\u4e00\u5b9a\u4e0d\u4f1a\u53d8\u5c0f.\u90a3\u4e48\u5c31\u5f00\u4e2a\u53d8\u91cf\u5b58\u4e00\u4e0b\u5f53\u524d$j$\u7684\u4f4d\u7f6e\u7136\u540e\u5f80\u540e\u9762\u632a\u52a8\u5c31\u884c\u4e86.$O(n)$\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(nlogn)$.\n\n\u6ce8\u610f\u8fd9\u9053\u9898\u8981\u51cf\u53bb\u539f\u672c\u5c31\u80fd\u591f\u88ab$1,n$\u90fd\u5230\u8fbe\u7684\u8dd1\u9053\u7684\u6570\u91cf.\n# CODE\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nchar cb[1<<15],*cs=cb,*ct=cb;\n#define getc() (cs==ct&&(ct=(cs=cb)+fread(cb,1,1<<15,stdin),cs==ct)?0:*cs++)\ntemplate<class T>inline void read(T &res) {\n\tchar ch; int flg = 1; for(;!isdigit(ch=getc());)if(ch=='-')flg=-flg;\n\tfor(res=ch-'0';isdigit(ch=getc());res=res*10+ch-'0'); res*=flg;\n}\nconst int MAXN = 100005;\nint n, m, p, k, T[MAXN], fl[MAXN], fr[MAXN];\nvector<pair<int,int> >el[MAXN], er[MAXN];\ninline void chkmax(int &x, int y) { if(y > x) x = y; };\ninline void upd(int x, int val) {\n\twhile(x <= m) chkmax(T[x], val), x += x&-x;\n}\ninline int qsum(int x) { int re = 0;\n\twhile(x) chkmax(re, T[x]), x -= x&-x;\n\treturn re;\n}\nint main() {\n\tread(n), read(m), read(p), read(k); ++m;\n\tfor(int i = 1, x, y, z; i <= p; ++i) {\n\t\tread(x), read(y), read(z); y = m-y;\n\t\tif(z) el[x+1].push_back(make_pair(y, 0));\n\t\telse er[x].push_back(make_pair(y, 0));\n\t\t//\u8fd9\u91cc\u7684z=1\u548cz=0\u4e24\u79cd\u8fb9,\u5c06\u54ea\u4e00\u79cd\u770b\u4f5c\u5411\u5de6\u7684\u8fb9\u5176\u5b9e\u65e0\u6240\u8c13(\u56fe\u7684\u5de6\u53f3\u7ffb\u8f6c\u4e0d\u5f71\u54cd\u7b54\u6848)\n\t\t//\u53ea\u8981\u9898\u76ee\u4e2d\u7ed9\u51fa\u7684\u4e0d\u540c\u7684\u4e24\u79cd\u8fb9\u76f8\u5bf9\u5173\u7cfb\u56fa\u5b9a\u5c31\u884c\n\t}\n\tint LIS = 0;\n\tfor(int i = 2; i <= n; ++i) {\n\t\t\n\t\tfor(int j = 0, siz = el[i].size(); j < siz; ++j)\n\t\t\tchkmax(LIS, el[i][j].second = qsum(el[i][j].first) + 1);\n\t\tfl[i] = i - 1 - LIS;\n\t\tfor(int j = 0, siz = el[i].size(); j < siz; ++j)\n\t\t\tupd(el[i][j].first, el[i][j].second);\n\t}\n\tfor(int i = 1; i <= m; ++i) T[i] = 0;\n\tLIS = 0;\n\tfor(int i = n-1; i >= 1; --i) {\n\t\tfor(int j = 0, siz = er[i].size(); j < siz; ++j)\n\t\t\tchkmax(LIS, er[i][j].second = qsum(er[i][j].first) + 1);\n\t\tfr[i] = n - i - LIS;\n\t\tfor(int j = 0, siz = er[i].size(); j < siz; ++j)\n\t\t\tupd(er[i][j].first, er[i][j].second);\n\t}\n\tint j = 1, ans = 0, cnt = 0;\n\tfor(int i = 1; i <= n; ++i) {\n\t\twhile(j <= n && fr[i] + fl[j] <= k) ++j;\n\t\tchkmax(ans, j - i);\n\t\tif(!fl[i] && !fr[i]) ++cnt;\n\t}\n\t//printf(\"ans = %d\\n\", ans);\n\tprintf(\"%d\\n\", ans-cnt);\n}\n```",
        "postTime": 1553771027,
        "uid": 30433,
        "name": "Ark_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3463 \u3010[POI2007]EGZ-Driving Exam\u3011"
    },
    {
        "content": "\u90e8\u5206\u5185\u5bb9\u4e3a\u4e86\u65b9\u4fbf\u51fa\u81eaArk_\u7684\u9898\u89e3\uff0c\u56e0\u4e3a\u5176\u5b9e\u90fd\u5dee\u4e0d\u591a\u3002\n\u80fd\u4ece $i$ \u8d70\u5230\u6240\u6709\u8dd1\u9053\u76f8\u5f53\u4e8e\u80fd\u4ecei\u8d70\u5230 $$1 \u548c $n$,\u8fb9\u53cd\u5411\u540e\u5c31\u76f8\u5f53\u4e8e\u80fd\u4ece $1$ \u548c $n$ \u8d70\u5230 $i$ ;\n\n\u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0,\u628a $1-n$ \u53eb\u505a $x$ \u5750\u6807,$1-(m+1)$ \u53eb\u505a $y$ \u5750\u6807.\n\n\u7136\u540e\u6211\u4eec\u5c06\u56fe\u4e0a\u4e0b\u7ffb\u8f6c( $y$ \u5750\u6807)\u540e,\u80fd\u4ece $1$ \u8d70\u5230 $i$ \u7684\u8bdd\u4e00\u5b9a\u4f1a\u7ecf\u8fc7\u524d $i-1$ \u6761\u5411\u53f3\u7684\u8fb9,\u4e14\u8fd9\u4e9b\u8fb9\u7684 $y$ \u5750\u6807\u4e0d\u4e0b\u964d\uff08\u4ece\u5de6\u5f80\u53f3\u770b\uff09.\n\n\u90a3\u4e48\u6211\u4eec\u8bbe $F[0][i]$ \u8868\u793a\u4ece $1$ \u8d70\u5230 $i$ \u6700\u5c11\u52a0\u8fb9\u6570\u91cf,\u90a3\u4e48\u6709 $F[0][i]=i-1-LIS$\uff1b\n\n\u8fd9\u91cc\u7684 $LIS$ \u662f $x$ \u5750\u6807\u5728 $1-(i-1)$ \u7684\u8fb9\u7684 y \u5750\u6807\u5f62\u6210\u7684\u6700\u957f\u4e0d\u4e0b\u964d\u5b50\u5e8f\u5217\u957f\u5ea6.\n\n$LIS$ \u53ef\u4ee5 $O(nlogn)$ \u9884\u5904\u7406\u51fa\u6765,\u540c\u65f6\u6211\u4eec\u53cd\u7740\u5904\u7406\u4e00\u904d\u5411\u5de6\u7684\u8fb9\u5c31\u80fd\u5904\u7406\u51fa\u4ece $n$ \u8d70\u5230 $i$ \u7684\u6700\u5c0f\u52a0\u8fb9\u6570\u91cf $F[1][i]$.\n\n\u5176\u5b9e $F[0][i]$ \u7684\u503c\u4ece\u5de6\u5f80\u53f3\u770b\u662f\u5355\u8c03\u4e0d\u964d\u7684\uff0c$F[1][i]$ \u7684\u503c\u4ece\u53f3\u5f80\u5de6\u770b\u4e5f\u4f9d\u7136\u662f\u5355\u8c03\u4e0d\u964d\u7684\n\n\u6700\u540e\u4e00\u8d9f $O(n)$ \u7684\u679a\u4e3e\u5373\u53ef\uff0c\u56e0\u4e3a $F[1][i]$ \u5355\u8c03\u4e0d\u964d(\u4ece\u540e\u5f80\u524d\u770b)\uff0c\u6240\u4ee5\u518d\u4e0a\u4e00\u6b21\u7684\u57fa\u7840\u4e4b\u4e0a\u5c31OK\u3002\n\nCode:\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=200005;\nint n,m,p,k,Ans,tot,T[maxn],F[2][maxn],son[2][maxn],nxt[2][maxn],lnk[2][maxn],cnt[2],opt[2][maxn];\nint read(){\n\tint ret=0,f=1;char ch=getchar();\n\twhile (!isdigit(ch)){if (ch=='-')f=-f;ch=getchar();}\n\twhile (isdigit(ch)) ret=(ret<<3)+(ret<<1)+ch-'0',ch=getchar();\n\treturn ret*f;\n}\nvoid add_e(int a,int x,int y){son[a][++cnt[a]]=y;nxt[a][cnt[a]]=lnk[a][x];lnk[a][x]=cnt[a];}\nvoid add(int x,int val){\n\tfor (;x<=m;x+=x&-x) T[x]=max(T[x],val);\n}\nint Ask(int x){\n\tint re=0;\n\tfor (;x;x-=x&-x) re=max(re,T[x]);\n    return re;\n}\nint main() {\n    n=read(),m=read()+1,p=read(),k=read();\n    for (int i=1;i<=p;i++) {\n        int x=read(),y=m-read(),z=read();\n        if (z) add_e(0,x+1,y);else add_e(1,x,y);\n    }\n    int LIS=0;\n    for (int i=2;i<=n;i++){\n    \tfor (int j=lnk[0][i];j;j=nxt[0][j]) LIS=max(LIS,opt[0][son[0][j]]=Ask(son[0][j])+1);\n        F[0][i]=i-1-LIS;\n        for (int j=lnk[0][i];j;j=nxt[0][j]) add(son[0][j],opt[0][son[0][j]]);\n    }\n    memset(T,0,sizeof T);LIS=0;\n    for (int i=n-1;i;i--){\n    \tfor (int j=lnk[1][i];j;j=nxt[1][j]) LIS=max(LIS,opt[1][son[1][j]]=Ask(son[1][j])+1);\n        F[1][i]=n-i-LIS;\n        for (int j=lnk[1][i];j;j=nxt[1][j]) add(son[1][j],opt[1][son[1][j]]);\n    }\n    int j=0,L,R;\n    for (int i=1;i<=n;i++) {\n        while (j<n&&F[1][i]+F[0][j+1]<=k) j++;//\u6b64\u5904\u4f18\u5316\u7684\u539f\u7406F[1][i]>=F[1][i+1],\u6545j\u4ece\u4e0a\u4e00\u6b21\u7ee7\u7eed\u5c31OK\uff0c\u6ee1\u8db3i\u7684\u6240\u6709j\uff0c\u4f9d\u7136\u6ee1\u8db3i+1\n        if (j-i+1>Ans) Ans=j-i+1,L=i,R=j;//\u80af\u5b9a\u6311\u9009\u4e00\u5757\u8fde\u7eed\u533a\u95f4\u7684\u5927\u7684\u554a \n    }\n    for (int i=L;i<=R;i++) Ans-=!F[0][i]&&!F[1][i];\n    printf(\"%d\\n\",Ans);\n    return 0;\n}\n```\n",
        "postTime": 1596021030,
        "uid": 188879,
        "name": "VioletIsMyLove",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3463 \u3010[POI2007]EGZ-Driving Exam\u3011"
    },
    {
        "content": "> [P3463 [POI2007]EGZ-Driving Exam](https://www.luogu.com.cn/problem/P3463)\n>\n> [POI \u5408\u96c6](https://www.cnblogs.com/alex-wei/p/poi.html)\u3002\n\n\u5173\u952e\u6027\u8d28\uff1a\u5982\u679c $i$ \u80fd\u5230\u6700\u5de6\u8fb9\uff0c\u90a3\u4e48 $i - 1$ \u4e5f\u80fd\u3002\u56e0\u6b64\uff0c\u80fd\u591f\u5230\u8fbe\u6240\u6709\u9053\u8def\u7684\u521d\u59cb\u4f4d\u7f6e\u4e00\u5b9a\u662f\u4e00\u6bb5\u533a\u95f4 $[l, r]$\uff0c\u6ee1\u8db3 $1\\sim r$ \u80fd\u5230\u6700\u5de6\u8fb9\u4f46 $r + 1$ \u4e0d\u80fd\uff0c\u4e14 $l \\sim n$ \u80fd\u5230\u6700\u53f3\u8fb9\u4f46 $l - 1$ \u4e0d\u80fd\u3002\n\n\u8bbe $pre_i$ \u8868\u793a\u4f7f $1\\sim i$ \u80fd\u5230\u6700\u5de6\u8fb9\uff0c\u6700\u5c11\u9700\u8981\u4fee\u5efa\u591a\u5c11\u6761\u8def\u3002\u660e\u773c\u4eba\u53ef\u4ee5\u770b\u51fa\u8fd9\u662f $i$ \u51cf\u53bb $1\\sim i$ \u7684 LDS\uff0c\u4f46\u662f\u6211\u6ca1\u6709\u770b\u51fa\u6765\uff08\u5927\u96fe\uff09\u3002\u63d0\u4f9b\u4e00\u4e2a\u65b0\u7684\u601d\u8def\uff1a\u8003\u8651\u679a\u4e3e\u4ece $i$ \u5411\u5de6\u8fb9\u7684\u6240\u6709\u9053\u8def\uff0c\u8bbe\u5176\u9ad8\u5ea6\u4e3a $k$\uff0c\u6211\u4eec\u8bbe $f_{i, k}$ \u8868\u793a $i\\to i - 1$ \u8d70\u7684\u9053\u8def\u7684\u9ad8\u5ea6\u4e3a $k$ \u65f6\uff0c\u8d70\u5230 $1$ \u6700\u5c11\u9700\u8981\u65b0\u5efa\u591a\u5c11\u6761\u8def\u3002\u518d\u679a\u4e3e\u4e0b\u4e00\u6b65\u8d70\u7684 **\u539f\u6709** \u7684\u9053\u8def\u662f\u54ea\u4e00\u6761\uff0c\u6709\u8f6c\u79fb\u65b9\u7a0b\n$$\nf_{i, k} = \\min_{1\\leq j < i\\land  p \\geq k} f_{j, p} + (i - j - 1)\n$$\n\u521d\u59cb\u503c $f_{1, m} = 0$\u3002\u540e\u9762\u7684 $i - j - 1$ \u662f\u56e0\u4e3a\u6839\u636e\u5b9a\u4e49\uff0c\u4ece $i - 1$ \u5230 $j$ \u8d70\u7684\u90fd\u4e0d\u662f\u539f\u6709\u9053\u8def\uff0c\u56e0\u6b64\u8981\u65b0\u5efa $i - j - 1$ \u6761\u9053\u8def\u3002$p \\geq k$ \u7684\u539f\u56e0\u663e\u7136\u3002\u5c06\u8d21\u732e\u62c6\u6210 $(f_{j, p} - j) + (i - 1)$\uff0c\u53d8\u6210\u4e00\u4e2a\u7ecf\u5178\u7684\u4e8c\u7ef4\u6570\u70b9\uff0c$i$ \u7684\u6709\u5e8f\u6027\uff08\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u4f4d\u7f6e\uff09\u81ea\u7136\u5730\u4f7f\u7528\u626b\u63cf\u7ebf\uff0c\u628a\u95ee\u9898\u964d\u4e86\u4e00\u7ef4\u3002\u6211\u4eec\u9700\u8981\u652f\u6301\u5355\u70b9\u4fee\u6539\uff0c\u4ee5\u53ca\u67e5\u8be2\u540e\u7f00\u6700\u5c0f\u503c\u3002\u7531\u4e8e\u67e5\u7684\u662f\u540e\u7f00\uff0c\u4fe1\u606f\u4e0d\u9700\u8981\u53ef\u51cf\uff0c\u6240\u4ee5\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\u800c $pre_i$ \u663e\u7136\u5c31\u662f $\\min f_{i, k}$\u3002\n\n\u5bf9\u4e8e $suf_i$ \u540c\u7406\uff0c\u8f6c\u79fb\u65b9\u7a0b\u53d8\u6210\u4e86 $f_{i, k} = \\min\\limits_{i < j \\leq n \\land p\\geq k} f_{j, p} + (j - i - 1)$\uff0c\u540c\u6837\u7528 BIT \u7ef4\u62a4\u3002\n\n\u6839\u636e\u4e00\u5f00\u59cb\u7684\u7ed3\u8bba\uff0c\u533a\u95f4 $[l, r]$ \u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53 $suf_l + pre_r \\leq k$\uff0c\u56e0\u4e3a\u5411\u5de6\u8fb9\u548c\u5411\u53f3\u8fb9\u7684\u9053\u8def\u72ec\u7acb\uff0c$suf_l$ \u548c $pre_r$ \u53ea\u662f\u505a\u7b80\u5355\u7684\u52a0\u6cd5\u3002\u6ce8\u610f\u5230 $pre$ \u5177\u6709\u5355\u8c03\u4e0d\u964d\uff0c$suf$ \u5177\u6709\u5355\u8c03\u4e0d\u5347\u7684\u6027\u8d28\uff0c\u56e0\u6b64\u8003\u8651\u6309\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u679a\u4e3e $r$\uff0c\u5408\u6cd5\u7684 $l$ \u968f\u7740 $r$ \u7684\u9012\u589e\uff0c\u663e\u7136\u5355\u8c03\u4e0d\u51cf\uff0c\u53ea\u9700\u7528\u6307\u9488\u7ef4\u62a4\u5373\u53ef\uff0c\u8be5\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6\u7ebf\u6027\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u6811\u72b6\u6570\u7ec4\u7684\u7ebf\u6027\u5bf9\u6570\u3002\u5b9e\u9645\u4e0a LIS/LDS \u548c\u6211\u7684\u52a8\u6001\u89c4\u5212\u5e94\u8be5\u662f\u5728\u5e72\u540c\u4e00\u4ef6\u4e8b\u60c5 qwq\uff0c\u53ea\u4e0d\u8fc7\u6211\u60f3\u590d\u6742\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ninline int read() {\n\tint x = 0; char s = getchar();\n\twhile(!isdigit(s)) s = getchar();\n\twhile(isdigit(s)) x = x * 10 + s - '0', s = getchar();\n\treturn x;\n}\n#define sor(x) sort(x.begin(), x.end())\nconst int N = 1e5 + 5;\nint n, m, p, k, ans, origin, pre[N], suf[N];\nvector <int> lft[N], rt[N];\nstruct BIT {\n\tint c[N];\n\tvoid init() {memset(c, 0x3f, N << 2);}\n\tvoid modify(int x, int v) {while(x) c[x] = min(c[x], v), x -= x & -x;}\n\tint query(int x) {int s = N; while(x <= m + 1) s = min(s, c[x]), x += x & -x; return s;}\n} tr;\n\nint main() {\n\tcin >> n >> m >> p >> k;\n\tfor(int i = 1; i <= p; i++) {\n\t\tint n = read(), m = read(), d = read();\n\t\tif(d) lft[n + 1].push_back(m + 1); else rt[n].push_back(m + 1);\n\t} for(int i = 1; i <= n; i++) sor(lft[i]), sor(rt[i]);\n\tfor(int i = (tr.init(), tr.modify(m + 1, -1), 2); i <= n; i++) {\n\t\tfor(int it : lft[i]) tr.modify(it, tr.query(it) - 1);\n\t\tpre[i] = tr.query(1) + i;\n\t} for(int i = (tr.init(), tr.modify(m + 1, n), n - 1); i; i--) {\n\t\tfor(int it : rt[i]) tr.modify(it, tr.query(it) - 1);\n\t\tsuf[i] = tr.query(1) - i;\n\t} for(int i = 1; i <= n; i++) origin += !pre[i] && !suf[i];\n\tfor(int i = 1, l = 1; i <= n; i++) {\n\t\twhile(l <= i && pre[i] + suf[l] > k) l++;\n\t\tans = max(ans, i - l + 1);\n\t} cout << ans - origin << endl;\n\treturn 0;\n}\n```",
        "postTime": 1644056446,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P3463 [POI2007]EGZ-Driving Exam"
    },
    {
        "content": "\u80fd\u5230\u8fbe\u6240\u6709\u8def\u7684\u5145\u8981\u6761\u4ef6\u662f\u80fd\u5230\u8fbe\u5de6\u53f3\u4e24\u7aef\u7684\u8def\n\n\u7528vector\u53cd\u5411\u5efa\u8fb9\u5bf9\u6bcf\u6761\u8def\u5de6\u53f3\u5206\u522b\u6c42\u4e2a\u6700\u957f\u4e0d\u4e0a\u5347\u5b50\u5e8f\u5217\n\n\u9884\u5904\u7406\u51fa\u6bcf\u6761\u8def\u5411\u5de6\u5411\u53f3\u5206\u522b\u9700\u8981\u591a\u5efa\u591a\u5c11\u8def\u624d\u80fd\u5230\u8fbe\u6700\u5de6\u7aef\u548c\u6700\u53f3\u7aef\n\n\u7136\u540e\u8dd1\u4e2a$\\Theta(n)$\u7684\u5c3a\u53d6\u6cd5\u5c31\u53ef\u4ee5\u4e86\n\n\u672c\u9898\u6700\u957f\u4e0d\u4e0a\u5347\u5b50\u5e8f\u5217\u7528vector+zkw\u7ebf\u6bb5\u6811\u6bd4\u4e8c\u5206\u66f4\u52a0\u597d\u60f3\uff1f\n\n\u539f\u6765\u6807\u7a0b\u7684`solve`\u51fd\u6570\u5c3a\u53d6\u65f6\u51fa\u9505~~\uff08\u4f46\u662f\u5c45\u7136AC\u4e86~~\n\n~~\u611f\u8c22\u6211\u81ea\u5df1\u56de\u6765\u770b\u9898\u89e3\u53d1\u73b0\u770b\u4e0d\u61c2~~\n\n\u73b0\u5728\u8fd9\u9898\u89e3\u662f\u771f\u9898\u89e3\u4e86\n\n```cpp\n#include\"cstdio\"\n#include\"cstring\"\n#include\"iostream\"\n#include\"algorithm\"\n#include\"vector\"\nusing namespace std;\n\nconst int MAXN=1<<17;\n\nint n,m,P,K,np;\nint f[2][MAXN];\nint tree[MAXN<<1];\nstruct rpg{bool kd;int h,fl,fr;};\nvector<rpg> vec[MAXN];\n\nint read()\n{\n\tint x=0;char ch=getchar();\n\twhile(ch<'0'||'9'<ch) ch=getchar();\n\twhile('0'<=ch&&ch<='9') x=(x<<3)+(x<<1)+(ch^'0'),ch=getchar();\n\treturn x;\n}\n\nvoid calcl()\n{\n\tfor(int i=1;i<n;++i){\n\t\tfor(int j=0;j<vec[i].size();++j){\n\t\t\tif(!vec[i][j].kd){\n\t\t\t\tint l=MAXN+vec[i][j].h-1,r=MAXN+m+2,maxn=0;\n\t\t\t\twhile(l^r^1){\n\t\t\t\t\tif(~l&1) maxn=max(maxn,tree[l^1]);\n\t\t\t\t\tif(r&1) maxn=max(maxn,tree[r^1]);\n\t\t\t\t\tl>>=1;r>>=1;\n\t\t\t\t}vec[i][j].fl=maxn+1;\n\t\t\t}\n\t\t}for(int j=0;j<vec[i].size();++j){\n\t\t\tif(!vec[i][j].kd){\n\t\t\t\tfor(int k=MAXN+vec[i][j].h;k;k>>=1){\n\t\t\t\t\ttree[k]=max(tree[k],vec[i][j].fl);\n\t\t\t\t}\n\t\t\t}\n\t\t}int l=MAXN,r=MAXN+m+2,maxn=0;\n\t\twhile(l^r^1){\n\t\t\tif(~l&1) maxn=max(maxn,tree[l^1]);\n\t\t\tif(r&1) maxn=max(maxn,tree[r&1]);\n\t\t\tl>>=1,r>>=1;\n\t\t}f[0][i+1]=maxn;\n\t}return;\n}\n\nvoid calcr()\n{\n\tfor(int i=n;i>1;--i){\n\t\tfor(int j=0;j<vec[i].size();++j){\n\t\t\tif(vec[i][j].kd){\n\t\t\t\tint l=MAXN+vec[i][j].h-1,r=MAXN+m+2,maxn=0;\n\t\t\t\twhile(l^r^1){\n\t\t\t\t\tif(~l&1) maxn=max(maxn,tree[l^1]);\n\t\t\t\t\tif(r&1) maxn=max(maxn,tree[r^1]);\n\t\t\t\t\tl>>=1;r>>=1;\n\t\t\t\t}vec[i][j].fr=maxn+1;\n\t\t\t}\n\t\t}for(int j=0;j<vec[i].size();++j){\n\t\t\tif(vec[i][j].kd){\n\t\t\t\tfor(int k=MAXN+vec[i][j].h;k;k>>=1){\n\t\t\t\t\ttree[k]=max(tree[k],vec[i][j].fr);\n\t\t\t\t}\n\t\t\t}\n\t\t}int l=MAXN,r=MAXN+m+2,maxn=0;\n\t\twhile(l^r^1){\n\t\t\tif(~l&1) maxn=max(maxn,tree[l^1]);\n\t\t\tif(r&1) maxn=max(maxn,tree[r&1]);\n\t\t\tl>>=1,r>>=1;\n\t\t}f[1][i-1]=maxn;\n\t}return;\n}\n\nvoid init()\n{\n\tn=read(),m=read(),P=read(),K=read();\n\tfor(int i=1;i<=P;++i){\n\t\tint x=read(),y=read(),z=read();\n\t\tif(z) vec[x].push_back((rpg){z^1,y+1});\n\t\telse vec[x+1].push_back((rpg){z^1,y+1});\n\t}calcl();memset(tree,0,sizeof(tree));calcr();\n\tfor(int i=1;i<=n;++i) f[0][i]=i-f[0][i]-1,f[1][i]=n-i-f[1][i];\n\treturn;\n}\n\nvoid solve()\n{\n\tint ans=0,ct=0,cnt=0;\n\tfor(int i=1;i<=n;++i){\n\t\twhile(ct+1<=n&&f[1][i]+f[0][ct+1]<=K){\n\t\t\t++ct;\n\t\t\tif(!f[0][ct]&&!f[1][ct]) ++cnt;\n\t\t}ans=max(ans,ct-i+1-cnt);\n\t\tif(!f[0][i]&&!f[1][i]) --cnt;\n\t}printf(\"%d\\n\",ans);\n\treturn;\n}\n\nint main()\n{\n\tinit();\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1536567256,
        "uid": 31293,
        "name": "Adove",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3463 \u3010[POI2007]EGZ-Driving Exam\u3011"
    }
]