[
    {
        "content": "[\u535a\u5ba2\u56ed\u9605\u8bfb\u5730\u5740](https://www.cnblogs.com/BaseAI/p/12221703.html)\n\n# **Problem**\n\n[ACwing \u9898\u76ee\u5730\u5740](https://www.acwing.com/problem/content/214/)\n\n[\u6d1b\u8c37 \u9898\u76ee\u5730\u5740](https://www.luogu.com.cn/problem/P4778)\n\n\u7ecf\u5178\u9898\uff0c\u597d\u9898\u3002\u53e6\u5916\u611f\u8c22 Rose_max \u5927\u4f6c\u7684\u535a\u5ba2\u8ba9\u6211\u641e\u61c2\u4e86\u8fd9\u9898\u3002\n\n---\n\n# **Solution 1**\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6392\u5217 $p_1,p_2,...,p_n$\uff0c\u6bcf\u4e00\u4e2a $p_i$ \u5411 $i$ \u8fde\u4e00\u6761\u65e0\u5411\u8fb9\uff0c\u6784\u6210\u4e00\u5f20\u7531\u82e5\u5e72\u4e2a\u7b80\u5355\u73af\u7ec4\u6210\u7684\u65e0\u5411\u56fe\u3002\u76ee\u6807\u72b6\u6001\u5373 $n$ \u4e2a\u81ea\u73af\u3002\n\n> \u5f15\u7406\uff1a\u5c06\u4e00\u4e2a\u5927\u5c0f\u4e3a $k$ \u7684\u7b80\u5355\u73af\u53d8\u6210 $k$ \u4e2a\u81ea\u73af\uff0c\u81f3\u5c11\u9700\u8981 $k-1$ \u6b21\u4ea4\u6362\u3002\n\n\u5229\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\uff0c\u8bc1\u660e\u5f88\u7b80\u5355\uff0c\u8fd9\u91cc\u7701\u7565\u8bc1\u660e\u3002\n\n\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u63a8\u8bba\uff1a**\u5047\u8bbe\u56fe\u4e2d\u6709 $k$ \u4e2a\u73af\uff0c\u90a3\u4e48\u6700\u5c0f\u4ea4\u6362\u6b65\u6570\u662f $n-k$\u3002**\n\n---\n\n\u4e0b\u9762\u6211\u4eec\u6765\u8003\u8651\u8ba1\u6570\u3002\n\n\u8bbe $f[i]$ \u8868\u793a\u4e00\u4e2a\u5927\u5c0f\u4e3a $i$ \u7684\u73af\uff0c\u5728\u4fdd\u8bc1\u4ea4\u6362\u6b21\u6570\u6700\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c**\u6709\u591a\u5c11\u79cd\u65b9\u6cd5**\u5c06\u5176\u53d8\u6210\u76ee\u6807\u72b6\u6001\u3002\n\n**\u6bcf\u4e00\u6b21\u4ea4\u6362\u53ef\u4ee5\u628a\u5927\u5c0f\u4e3a $i$ \u7684\u73af\u62c6\u6210\u5927\u5c0f\u4e3a $x,y$ \u7684\u4e24\u4e2a\u73af\uff0c$x+y=n$**\u3002\u8bbe $T(x,y)$ \u8868\u793a**\u6709\u591a\u5c11\u79cd\u4ea4\u6362\u65b9\u6cd5**\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5927\u5c0f\u4e3a $i$ \u7684\u73af\u62c6\u6210\u4e24\u4e2a\u5927\u5c0f\u5206\u522b\u4e3a $x,y$ \u7684\u73af\u3002\u53ef\u4ee5\u53d1\u73b0\uff1a\u5f53 $x=y$ \u65f6\uff0c\u6709\u4e00\u534a\u7684\u65b9\u6cd5\u662f\u91cd\u590d\u7684\uff0c$T(x,y)=x$\uff1b\u5426\u5219 $T(x,y)=x+y$\u3002\n\n\u5c06\u4e00\u4e2a\u5927\u5c0f\u4e3a $i$ \u7684\u73af\u62c6\u6210\u5927\u5c0f\u4e3a $x,y$ \u7684\u4e24\u4e2a\u73af\u540e\uff0c$x$ \u73af\u9700\u8981 $x-1$ \u6b21\u4ea4\u6362\u8fbe\u5230\u76ee\u6807\u72b6\u6001\uff0c\u5c06\u8fd9 $x-1$ \u6b21\u64cd\u4f5c\u8bb0\u4e3a $x-1$ \u4e2a $0$\uff0c\u540c\u7406\u5c06 $y$ \u73af\u7684 $y-1$ \u6b21\u64cd\u4f5c\u8bb0\u4e3a $y-1$ \u4e2a $1$\u3002**\u7531\u4e8e $x$ \u73af\u4e0e $y$ \u73af\u7684\u64cd\u4f5c\u4e92\u4e0d\u5e72\u6270\uff0c\u4e24\u8fb9\u7684\u64cd\u4f5c\u53ef\u4ee5\u968f\u610f\u6392\u5217\uff0c\u56e0\u6b64\u8fd9\u91cc\u5c31\u662f\u4e00\u4e2a\u591a\u91cd\u96c6\u7684\u5168\u6392\u5217**\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u53ef\u4ee5\u5f97\u5230 $f[i]$ \u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f[i]=\\sum_{x+y=i} f[x]*f[y]*T(x,y)*\\frac{(i-2)!}{(x-1)!(y-1)!}$$\n\n\uff08\u6216\u8bb8\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5 $FFT$ \u4e00\u4e0b\uff0c\u5982\u679c\u4f60\u53ef\u4ee5\u5c06\u5176 $FFT$\uff0c\u8bb0\u5f97\u544a\u8bc9\u6211\u4e00\u4e0b\u505a\u6cd5qwq\uff09\n\n---\n\n\u5047\u8bbe\u6392\u5217 $p_1,p_2,...,p_n$ \u4e2d\u6709 $k$ \u4e2a\u5927\u5c0f\u5206\u522b\u4e3a $L_1,L_2,...,L_k$ \u7684\u73af\u3002**\u56e0\u4e3a\u8fd9 $k$ \u4e2a\u73af\u7684\u64cd\u4f5c\u4e92\u4e0d\u5e72\u6270**\uff0c\u53ef\u4ee5\u8bb0\u5176\u4e2d\u7b2c $i$ \u4e2a\u73af\u7684 $L_i-1$ \u6b21\u64cd\u4f5c\u4e3a $L_i-1$ \u4e2a $i$\uff0c**\u603b\u64cd\u4f5c\u5c31\u662f\u4e00\u4e2a\u591a\u91cd\u96c6\u7684\u5168\u6392\u5217**\u3002\u7b54\u6848\u662f\uff1a\n\n$$Ans=(\\prod_{i=1}^k f[L_i])*(\\frac{(n-k)!}{\\prod_{i=1}^k (L_i-1)!})$$\n\n\u5728 $\\mod 10^9+9$ \u610f\u4e49\u4e0b\uff0c\u4e0a\u8ff0\u9664\u6cd5\u53ef\u4ee5\u7528\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6c42\u5f97\u9006\u5143\u89e3\u51b3\u3002\u590d\u6742\u5ea6\u5e26\u4e00\u4e2a $\\log$\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^2 \\log n)$**\n\n\u6c42 $f[\\ ]$ \u6570\u7ec4\u548c\u9636\u4e58\u90e8\u5206\u4ee3\u7801\uff08\u9884\u5904\u7406\uff09\n\n```cpp\nvoid Init() {\n\tfc[0] = 1;\t//\u9636\u4e58 factorial\n\tfor(int i=1;i<=1000;++i) fc[i] = fc[i-1] * i % mod;\n\tf[1] = 1;\n\tfor(int i=2;i<=1000;++i) {\n\t\tfor(int j=1;j<=i/2;++j) {\t// (x,y)\u548c(y,x)\u53ea\u80fd\u7b97\u4e00\u6b21 \n\t\t\tint inv = Pow(fc[i-j-1]*fc[j-1]%mod, mod-2);\n\t\t\tf[i] = (f[i] + f[i-j]*f[j]%mod*T(i-j,j)%mod*fc[i-2]%mod*inv%mod) % mod;\n\t\t}\n\t}\n\tfor(int i=1;i<=10;++i) printf(\"%lld\\n\",f[i]);\n}\n```\n\n# **Solution 2**\n\n\u6ce8\u610f\u5230\u4e0a\u8ff0\u7b97\u6cd5\u5e76\u4e0d\u80fd\u901a\u8fc7\u6b64\u9898\uff08$n \\leqslant 10^5$\uff09\u3002\u74f6\u9888\u5728\u4e8e\u6c42 $f[\\ ]$ \u6570\u7ec4\u8fd9\u91cc\u3002\u4e8e\u662f\u6211\u4eec\u6253\u8868\u51fa $f[\\ ]$ \u6570\u7ec4\u7684\u524d $10$ \u9879\uff1a\n\n``1 1 3 16 125 1296 16807 262144 4782969 100000000``\n\n\u5c06\u5176\u8f93\u5165\u8fdb $OEIS$\uff0c\u6216\u8005\u662f\u5bf9\u4e58\u65b9\u654f\u611f\u7684\u540c\u5b66\u53ef\u4ee5\u53d1\u73b0\uff1a$f[n]=n^{n-2}$\u3002\u6709\u4e86\u8fd9\u4e2a\u89c4\u5f8b\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n \\log n)$**\n\n# **Code**\n\nTalk is cheap.Show me the code.\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ninline int read() {\n\tint x=0,f=1; char ch=getchar();\n\twhile(ch<'0' || ch>'9') { if(ch=='-') f=-1; ch=getchar(); }\n\twhile(ch>='0'&&ch<='9') { x=(x<<3)+(x<<1)+(ch^48); ch=getchar(); }\n\treturn x * f;\n}\nconst int N = 1e5+7, mod = 1e9+9;\nint n,cnt,ans;\nint p[N],f[N],fc[N],L[N];\nbool vis[N];\nint Pow(int x,int y) {\n\tint res = 1, base = x;\n\twhile(y) {\n\t\tif(y&1) res = res*base%mod; base = base*base%mod; y >>= 1;\n\t}\n\treturn res;\n}\nvoid Init2() {\n\tfc[0] = 1;\n\tfor(int i=1;i<N;++i) fc[i] = fc[i-1] * i % mod;\n\tf[1] = 1;\n\tfor(int i=2;i<N;++i) f[i] = Pow(i,i-2);\n}\nint Dfs(int u) {\n\tvis[u] = 1;\n\tif(vis[p[u]]) return 1;\n\treturn Dfs(p[u]) + 1;\n}\nvoid work() {\n\tcnt = 0;\n\tmemset(vis, 0, sizeof(vis));\n\tn = read();\n\tfor(int i=1;i<=n;++i) p[i] = read();\n\tfor(int i=1;i<=n;++i)\n\t\tif(!vis[i]) L[++cnt] = Dfs(i);\n\tans = fc[n-cnt] % mod;\n\tfor(int i=1;i<=cnt;++i) {\n\t\tint inv = Pow(fc[L[i]-1], mod-2);\n\t\tans = ans*f[L[i]]%mod*inv%mod;\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\nsigned main()\n{\n\tInit2();\n\tint T = read();\n\twhile(T--) work();\n\treturn 0;\n}\n```\n\n# **Summary**\n\n~~\u6a21\u6570\u770b\u9519\u81ea\u95ed\u4e00\u4e2d\u5348~~\uff0c\u6240\u4ee5\u5927\u5bb6\u5728\u4efb\u4f55\u5730\u65b9\u90fd\u8981\u7ec6\u5fc3\u5440\uff01\uff01\n\n\u8fd9\u4e2a\u9898\u76ee\u8ba9\u6211\u5b66\u4f1a\u4e24\u5927\u7ecf\u5178\u6a21\u578b\uff1a\n\n- **\u5c06\u6392\u5217 $p_1,p_2,...,p_n$ \u53d8\u6210\u9012\u589e\u5e8f\u5217\u7684\u6700\u5c0f\u4ea4\u6362\u6b21\u6570\u3002**\n\n- **\u5c06\u6392\u5217 $p_1,p_2,...,p_n$ \u53d8\u6210\u9012\u589e\u5e8f\u5217\uff0c\u4fdd\u8bc1\u6700\u5c0f\u4ea4\u6362\u6b21\u6570\u4e0b\u7684\u65b9\u6848\u6570**\n\n\u53e6\u5916\u8ba9\u6211\u5b66\u4f1a\u4e00\u4e9b\u8ba1\u6570\u9898\u7684 **\u6280\u5de7/\u601d\u8def/\u5957\u8def**\u3002",
        "postTime": 1579589018,
        "uid": 147511,
        "name": "\u57fa\u5730A_I",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4778 \u3010Counting swaps\u3011"
    },
    {
        "content": "\u5bf9\u6bcf\u4e2a $i$ \u5411 $p_i$ \u8fde\u8fb9\uff0c\u8868\u793a\u521d\u59cb\u5728\u4f4d\u7f6e $i$ \u4e0a\u7684\u6570\u60f3\u5230\u4f4d\u7f6e $p_i$ \u4e0a\u53bb\u3002\u8fd9\u6837\u5f97\u5230\u82e5\u5e72\u4e2a\u73af\u3002\u660e\u663e\u73af\u95f4\u4ea4\u6362\u4e0d\u4f18\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8003\u8651\u4e00\u4e2a\u73af\u7684\u6700\u4f18\u4ea4\u6362\u6b21\u6570\uff0c\u7136\u540e\u7528\u7ec4\u5408\u6570\u7ed9\u6240\u6709\u73af\u7684\u64cd\u4f5c\u5e8f\u5217\u5206\u914d\u6807\u53f7\u3002\u5bf9\u4e8e\u4e00\u4e2a\u73af\uff0c\u8003\u8651\u5bf9\u4e8e\u5b83\u8868\u793a\u7684\u5e8f\u5217\u4ea4\u6362\u4e24\u4e2a\u6570\u540e\uff0c\u73af\u4f1a\u5206\u88c2\u6210\u4e24\u4e2a\u5c0f\u73af\u3002\u56e0\u6b64\u53ef\u4ee5\u5f97\u51fa\u5927\u5c0f\u4e3a $n$ \u7684\u73af\u7684\u6700\u4f18\u4ea4\u6362\u6b21\u6570 $f_n$ \u7684\u9012\u63a8\u5f0f\uff08\u5f53\u4e24\u70b9\u8ddd\u79bb\u4e3a $\\frac{n}{2}$ \u65f6\u9009\u6cd5\u662f $\\frac{n}{2}$\uff0c\u5176\u5b83\u90fd\u662f $n$\u3002\u7528 $\\binom{n-2}{i-1}$ \u5206\u914d\u4e24\u4e2a\u73af\u7684\u64cd\u4f5c\u7684\u6807\u53f7\uff09\n$$\nf_1=1,f_n=\\sum_{i=1}^{\\lfloor \\frac{n}{2}\\rfloor} \\binom{n-2}{i-1}f_if_{n-i}(2i==n?\\frac{n}{2}:n)\n$$\n\uff08\u8fd9\u4e2a\u9012\u63a8\u5f0f\u5bf9\u7ed3\u8bba\u7684\u8bc1\u660e\u6ca1\u6709\u7528\u5904\uff09\n\n\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u5206\u6cbb FFT \u6c42\u3001\u4e5f\u53ef\u4ee5\u725b\u987f\u8fed\u4ee3\uff0c\u4f46\u8fd9\u5e76\u4e0d\u662f\u91cd\u70b9\uff0c\u91cd\u70b9\u662f\u5927\u591a\u6570\u9898\u89e3\u63d0\u51fa\u4f46\u6ca1\u6709\u8bc1\u660e\u7684\u7ed3\u8bba $f_n=n^{n-2}$\uff08\u8fd9\u5c31\u662f\u6709\u6807\u53f7\u65e0\u6839\u6811\u4e2a\u6570\uff01\uff09\u3002\u4e3a\u6b64\u6211\u54a8\u8be2\u4e86\u5927\u4f6c $\\text{S}\\color{red}\\text{aInT7}$\uff0c\u5f97\u5230\u4e86\u57fa\u4e8e\u6784\u9020\u53cc\u5c04\u6cd5\u7684\u7ec4\u5408\u610f\u4e49\u8bc1\u660e\uff1a\n\n\u6bcf\u6b21\u64cd\u4f5c $p_x,p_y$ \u65f6\uff0c\u5728\u4e00\u4e2a\u56fe $G$ \u4e2d\u52a0\u4e00\u6761\u8fb9 $(x,y)$\uff0c\u7531\u4e0a\u9762\u7684\u8ba8\u8bba\u77e5\u9053\u8fd9\u662f\u4e00\u68f5\u6811\u3002\u4e00\u4e2a\u5c1d\u8bd5\u662f\u5c06\u6bcf\u79cd\u64cd\u4f5c\u4e0e\u5b83\u5bf9\u5e94\u7684\u6811\u5efa\u7acb\u53cc\u5c04\uff0c\u4f46\u8fd9\u663e\u7136\u662f\u9519\u7684\uff0c\u56e0\u4e3a\u5f88\u5bb9\u6613\u4e3e\u51fa\u4f8b\u5b50\u53d1\u73b0\u76f8\u540c\u7684\u64cd\u4f5c\u96c6\u5408\u4f46\u4e0d\u540c\u7684\u64cd\u4f5c\u987a\u5e8f\u5f97\u5230\u4e86\u76f8\u540c\u7684\u6811\u3002\u4f46\u662f\u6211\u4eec\u6ce8\u610f\u5230\u786e\u5b9a\u4e00\u68f5\u6811\u4ee5\u53ca\u786e\u5b9a\u4e86 $n-1$ \u6761\u8fb9\u7684\u5220\u9664\u987a\u5e8f\u540e\uff08\u8fd9\u6837\u7684\u7ec4\u5408\u5bf9\u8c61\u6709 $n^{n-2}(n-1)!$ \u79cd\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u5012\u5e8f\u64cd\u4f5c\uff0c\u5012\u7740 swap\uff0c\u90a3\u4e48\u6bcf\u6b21\u5c31\u662f\u5bf9\u4e8e\u4e24\u4e2a\u73af\u5728\u73af\u95f4\u4ea4\u6362\u5143\u7d20\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u4f1a\u4f7f\u4e24\u4e2a\u73af\u5408\u6210\u4e00\u4e2a\u5927\u73af\uff0c\u56e0\u6b64\u5b58\u5728\u4e00\u4e2a\u552f\u4e00\u7684\u73af\u4f7f\u5f97\u8fd9\u4e2a\u64cd\u4f5c\u662f\u5408\u6cd5\u7684\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u7684\u6240\u6709\u5408\u6cd5\u64cd\u4f5c\uff0c\u5c06\u5176\u4e0e\u8fb9\u6709\u987a\u5e8f\u7684\u6709\u6807\u53f7\u65e0\u6839\u6811\u5efa\u7acb\u4e86\u53cc\u5c04\u3002\u800c\u663e\u7136\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u5408\u6cd5\u64cd\u4f5c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8e\u5355\u4e2a\u73af\u5408\u6cd5\u64cd\u4f5c\u4e2a\u6570\u4e3a $\\frac{n^{n-2}(n-1)!}{(n-1)!}=n^{n-2}$\u3002\n\n\u53e6\u5916\u987a\u4fbf\u63d0\u4e00\u4e0b\uff0c\u8fd9\u9898\u7684\u590d\u6742\u5ea6\u5b83\u5e94\u8be5\u662f $O(n)$ \u7684\u3002\u53ea\u9700\u4e0d\u63d0\u524d\u9884\u5904\u7406 $f_n$\uff0c\u800c\u662f\u5728\u6bcf\u6b21\u7528\u5230\u7684\u65f6\u5019\u7b97\u3002\n\n\n\n\n\n",
        "postTime": 1621226044,
        "uid": 62308,
        "name": "Mr_Wu",
        "ccfLevel": 10,
        "title": "P4778 Counting swaps"
    },
    {
        "content": "~~\u8ba1\u6570\u5957\u8def\u9898?\u4f46\u662f\u6211\u8fde\u5957\u8def\u90fd\u4e0d\u4f1a,,,~~\n\n\u62ff\u5230\u8fd9\u9053\u9898\u6211\u4e00\u8138\u8499\u5f7c,,,\u611f\u8c22 @poorpool \u5927\u4f6c\u7684\u535a\u5ba2\u7684\u6307\u70b9\n\n\u5148\u5c06\u7b2c$i$\u4f4d\u4e0a\u7684\u6570\u5b57$p_i$\u5411$i$\u8fde\u65e0\u5411\u8fb9,\u7136\u540e\u6784\u6210\u4e86\u4e00\u4e2a\u6709\u82e5\u5e72\u73af\u7ec4\u6210\u7684\u65e0\u5411\u56fe,\u53ef\u4ee5\u77e5\u9053\u67d0\u4e2a\u70b9\u5305\u542b\u5b83\u7684\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u73af,\u56e0\u4e3a\u6240\u6709\u70b9\u5ea6\u6570\u90fd\u4e3a2(\u81ea\u73af\u7684\u70b9\u5ea6\u6570\u4e5f\u662f2\u5427qwq)\n\n\u90a3\u4e48\u6211\u4eec\u7684\u6700\u7ec8\u76ee\u6807\u5c31\u662f\u628a\u8fd9\u4e2a\u56fe\u8f6c\u6362\u6210\u6709$n$\u4e2a\u81ea\u73af\u7684\u56fe,\u76f8\u5f53\u4e8e\u628a\u6392\u5217\u6392\u597d\u987a\u5e8f\n\n\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a$m$\u4e2a\u70b9\u7684\u73af,\u628a\u5b83\u53d8\u6210$m$\u4e2a\u81ea\u73af\u81f3\u5c11\u9700\u8981$m-1$\u6b65(\u76f8\u5f53\u4e8e\u6392\u5217$(2,3...m,1)$\u53d8\u6210$(1,2,3...m)$,\u8fd9\u81f3\u5c11\u9700\u8981$m-1$\u6b21\u4ea4\u6362)\n\n\u8bbe\u628a\u4e00\u4e2a$m$\u4e2a\u70b9\u7684\u73af\u53d8\u6210$m$\u4e2a\u81ea\u73af\u7684\u65b9\u6848\u6570\u4e3a$f_m$.\u56e0\u4e3a\u4e00\u6b21\u64cd\u4f5c\u53ef\u4ee5\u628a\u4e00\u4e2a\u73af\u62c6\u6210\u4e24\u4e2a\u73af,\u8bbe\u62c6\u51fa\u6765\u4e24\u4e2a\u73af\u5927\u5c0f\u4e3a$x,y$,\u90a3\u4e48\u62c6\u73af\u7684\u65b9\u6848\u6570$g(x,y)$\u4e3a$$g(x,y)=\\begin{cases}x,\\quad (x=y)\\\\x+y, \\quad others\\end{cases} $$\n\n\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9,\u6709\u4e24\u4e2a\u70b9\u4f7f\u5f97\u8fd9\u4e00\u4e2a\u70b9\u548c\u90a3\u4e24\u4e2a\u70b9\u4e2d\u7684\u4e00\u4e2a\u8fdb\u884c\u4ea4\u6362\u64cd\u4f5c\u53ef\u4ee5\u5206\u51fa\u5927\u5c0f\u4e3a$x,y$\u7684\u73af,\u56e0\u4e3a\u70b9\u5bf9\u4f1a\u88ab\u8ba1\u7b972\u6b21,\u6240\u4ee5\u65b9\u6848\u4e3a$\\frac{(x+y)*2}{2}=x+y$,\u5982\u679c$x=y$,\u90a3\u4e48\u90a3\u4e24\u4e2a\u70b9\u662f\u540c\u4e00\u70b9,\u6240\u4ee5\u65b9\u6848\u8981\u9664\u4ee52\n\n\u6bcf\u4e2a\u73af\u4e4b\u95f4\u7684\u64cd\u4f5c\u662f\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\u7684,\u6240\u4ee5\u53ef\u4ee5\u4ea4\u9519\u8fdb\u884c\u64cd\u4f5c,\u4e24\u4e2a\u73af\u8d21\u732e\u7b54\u6848\u7ed9\u4e00\u4e2a\u5927\u73af\u65f6,\u4e24\u4e2a\u73af\u7684\u64cd\u4f5c\u4ea4\u9519\u6240\u6784\u6210\u7684\u6392\u5217\u6570\u5c31\u662f\u53ef\u91cd\u96c6\u7684\u6392\u5217\u6570(\u603b\u5143\u7d20\u4e2a\u6570\u9636\u4e58\u9664\u4ee5\u6bcf\u4e00\u4e2d\u5143\u7d20\u4e2a\u6570\u9636\u4e58).\u7efc\u4e0a,\u6211\u4eec\u53ef\u4ee5\u77e5\u9053$$f_m=\\sum_{i=1}^{\\lfloor\\frac{m}{2}\\rfloor} g(i,m-i)f_if_{m-i}\\frac{(m-2)!}{(i-1)!(m-i-1)!}$$\n\n\u6211\u4eec\u53ef\u4ee5\u627e\u51fa$k$\u4e2a\u5927\u5c0f\u4e3a$a_1,a_2...a_k$\u7684\u73af\n\n\u628a\u6240\u6709\u73af\u7684\u7b54\u6848\u5408\u5e76,\u540c\u6837\u6bcf\u4e2a\u73af\u4e4b\u95f4\u7684\u64cd\u4f5c\u662f\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\u7684,\u6240\u4ee5\u65b9\u6848\u6570\u8981\u4e58\u4e0a\u4e00\u4e2a\u53ef\u91cd\u96c6\u7684\u6392\u5217\u6570,\u53ef\u4ee5\u5f97\u5230$$ans=\\prod_{i=1}^{k}  f_{a_i}*\\frac{(n-k)!}{\\prod_{i=1}^{k}(a_i-1)!}$$\n\n(\u6ce8\u610f\u8fb9\u754c,$f_1=f_2=1$)\n\n\u7136\u800c\u6c42$f$\u8981$O(n)$\u7684\u65f6\u95f4,\u603b\u590d\u6742\u5ea6\u4e3a$O(nk)$\n\n\u8003\u8651\u4f18\u5316\u6b64\u7b97\u6cd5,\u901a\u8fc7~~\u6253\u8868\u627e\u89c4\u5f8b~~\u53ef\u4ee5\u53d1\u73b0$f_i=i^{i-2}$\n\n\u7136\u540e\u6c42$f$\u53ea\u8981\u8981$O(logn)$\u4e86,\u723d!\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5077\u7a0e\u7684\u5199\u4ee3\u7801\u4e86\n\n```cpp\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\n#define LL long long\n#define il inline\n#define re register\n\nusing namespace std;\nconst LL mod=1000000009;\nil LL rd()\n{\n    re LL x=0,w=1;re char ch;\n    while(ch<'0'||ch>'9') {if(ch=='-') w=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9') {x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n    return x*w;\n}\nint to[200010],nt[200010],hd[100010],tot=1;\nint vis[200010],a[100010],tt;\nLL jc[100010],cj[100010];   //\u4e0d\u8981\u95ee\u6211\u4e3a\u4ec0\u4e48\u628a\u9636\u4e58\u6570\u7ec4\u7684\u9006\u5143\u5199\u6210cj(\u9003\nbool v[100010];\nil void add(int x,int y)\n{\n  ++tot;to[tot]=y;nt[tot]=hd[x];hd[x]=tot;\n  ++tot;to[tot]=x;nt[tot]=hd[y];hd[y]=tot;\n}\nil void dfs(int x,int o,int h)\n{\n  if(!v[x]) ++a[o];v[x]=true;\n  for(int i=hd[x];i;i=nt[i])\n    {\n      if(vis[i]==h) continue;\n      vis[i]=vis[i^1]=h;\n      dfs(to[i],o,h);\n    }\n}\nil LL ksm(LL a,LL b)\n{\n  if(b<=0) return 1;    //i=1\u65f6,i-2\u4f1a\u4e3a-1 qwq\n  LL an=1;\n  while(b)\n    {\n      if(b&1) an=(an*a)%mod;\n      a=(a*a)%mod;\n      b>>=1;\n    }\n  return an;\n}\n\nint main()\n{\n  jc[0]=cj[0]=1;\n  for(int i=1;i<=100000;i++) jc[i]=(jc[i-1]*i)%mod,cj[i]=ksm(jc[i],mod-2);\n  int T=rd();\n  for(int h=1;h<=T;h++)\n  {\n    tot=1;tt=0;\n    memset(a,0,sizeof(a));\n    memset(v,0,sizeof(v));\n    memset(hd,0,sizeof(hd));\n    int n=rd();\n    for(int i=1;i<=n;i++) add(i,rd());\n    for(int i=1;i<=n;i++)\n      if(!v[i]) dfs(i,++tt,h);\n    LL ans=jc[n-tt];\n    for(int i=1;i<=tt;i++) ans=((ans*ksm(a[i],a[i]-2))%mod*cj[a[i]-1])%mod;\n    printf(\"%lld\\n\",ans);\n  }\n  return 0;\n}\n\n  \n\n```",
        "postTime": 1534131851,
        "uid": 38372,
        "name": "star_magic_young",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4778 \u3010Counting swaps\u3011"
    },
    {
        "content": "# \u539f\u9898\u94fe\u63a5\n[\u6d1b\u8c37 P4778](https://www.luogu.com.cn/problem/P4778)\n\n[AcWing 212](https://www.acwing.com/problem/content/214/)\n# \u9898\u76ee\u5206\u6790\n\u867d\u7136\u8981\u6c42\u7684\u662f\u65b9\u6848\u6570\uff0c\u4f46\u662f\u6700\u597d\u8fd8\u662f\u5148\u628a\u81f3\u5c11\u9700\u8981\u51e0\u6b65\u5f04\u597d\u4e86\u518d\u8bf4\u3002\u9898\u76ee\u4e2d\u6bcf\u4e00\u4e2a\u70b9\u90fd\u8981\u5230\u53e6\u4e00\u4e2a\u70b9\uff0c\u4e0d\u59a8\u7ed9\u8fd9\u4e24\u4e2a\u70b9\u8fde\u4e00\u6761\u8fb9\u3002\u73b0\u5728\u6211\u7ed9\u51fa\u4e00\u4e0b\u6837\u4f8b\uff1a\n$$6:2\u30001\u30003\u30005\u30006\u30004$$\n\u6211\u4eec\u4f1a\u5f97\u5230\u5982\u4e0b\u56fe\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201129154534174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDA0MzY2OA==,size_16,color_FFFFFF,t_70#pic_center)\n\n\u8bf7\u6ce8\u610f\uff0c\u5176\u4e2d\u7ed3\u70b9$3$\u662f\u81ea\u73af\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u6bcf\u4e00\u4e2a\u8fde\u901a\u5757\u90fd\u4e00\u5b9a\u662f\u4e00\u4e2a\u7b80\u5355\u73af\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u90fd\u53ea\u6709\u4e00\u4e2a\u51fa\u5ea6\u3001\u4e00\u4e2a\u5165\u5ea6\u3002\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u901a\u8fc7\u6539\u53d8\u4e00\u4e9b\u8fb9\u4f7f\u5f97\u539f\u56fe\u53d8\u6210$n$\u4e2a\u81ea\u73af\u3002\u6240\u4ee5\u539f\u95ee\u9898\u5c31\u662f\u5206\u88c2\u8fd9\u4e9b\u73af\uff0c\u8bbe\u73af\u5927\u5c0f\u4e3a$a$\uff0c\u6240\u4ee5\u6bcf\u4e2a\u73af\u81f3\u5c11\u9700\u8981$a-1$\u6b65\u5206\u88c2\u6210\u81ea\u73af\u3002\n# \u5c1d\u8bd5\u5728\u56fe\u4e2d\u64cd\u4f5c\n\u73b0\u5728\u6211\u4eec\u6765\u770b\u4e00\u770b\u67d0\u4e00\u4e2a\u73af\u4e2d\u4ea4\u6362\u4e24\u4e2a\u70b9\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201129155132753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDA0MzY2OA==,size_16,color_FFFFFF,t_70#pic_center)\n\n\u4e0a\u56fe\u5bf9\u5e94\u5e8f\u5217$2\u30003\u30004\u30005\u30001$\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u66f4\u6362\u4f4d\u7f6e$2$\u548c\u4f4d\u7f6e$3$\uff08\u5e8f\u5217$2\u30004\u30003\u30005\u30001$\uff09\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201129155411917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDA0MzY2OA==,size_16,color_FFFFFF,t_70#pic_center)\n\n\u53d1\u73b0\u521a\u597d\u628a\u539f\u56fe\u5206\u6210\u4e86\u4e24\u4e2a\u73af\uff0c\u8ba9\u5269\u4f59\u7684\u6b65\u6570\u66f4\u5c11\u4e86\u3002\u73b0\u5728\u6211\u4eec\u518d\u770b\u4e00\u770b\u4ea4\u6362\u4e24\u4e2a\u73af\u4e0a\u7684\u70b9\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201129155931770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDA0MzY2OA==,size_16,color_FFFFFF,t_70#pic_center)\n\n\u539f\u56fe\u5bf9\u5e94\u5e8f\u5217$3\u30001\u30002\u30005\u30006\u30004$\u73b0\u5728\u6211\u4eec\u4ea4\u6362\u4f4d\u7f6e$1$\u548c$4$\uff08\u5e8f\u5217$5\u30001\u30002\u30003\u30006\u30004$\uff09\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201129160315843.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDA0MzY2OA==,size_16,color_FFFFFF,t_70#pic_center)\n\n\u53d1\u73b0\u6211\u4eec\u628a\u4e24\u4e2a\u73af\u53d8\u6210\u4e86\u4e00\u4e2a\u73af\uff0c\u8ba9\u9700\u8981\u4ea4\u6362\u7684\u6b65\u6570\u66f4\u591a\u4e86\uff01\n# \u6027\u8d28\u7684\u8bc1\u660e\n\u6211\u4eec\u521a\u521a\u753b\u4e86\u56fe\u601d\u8003\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u597d\u50cf\u53ea\u6709\u4ea4\u6362\u73af\u5185\u7684\u70b9\u66f4\u4f18\u3002\u90a3\u662f\u4e0d\u662f\u4e00\u5b9a\u5982\u6b64\u5462\uff1f\u4e0d\u96be\u53d1\u73b0\u4efb\u610f\u7684\u5e8f\u5217\u90fd\u552f\u4e00\u5bf9\u5e94\u4e00\u4e2a\u53ea\u542b\u7b80\u5355\u73af\u4e14\u6ca1\u6709\u73af\u5916\u8fb9\u7684\u56fe\uff0c\u4efb\u610f\u7684\u53ea\u542b\u7b80\u5355\u73af\u4e14\u6ca1\u6709\u73af\u5916\u8fb9\u7684\u56fe\u90fd\u552f\u4e00\u5bf9\u5e94\u4e00\u4e2a\u5e8f\u5217\u3002\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u6765\u5206\u6790\u56fe\u7684\u6027\u8d28\uff0c\u56fe\u7684\u6027\u8d28\u5c31\u662f\u5e8f\u5217\u7684\u6027\u8d28\u3002\n\u5982\u679c\u4ea4\u6362\u4e86\u4e24\u4e2a\u70b9$a$\u548c$b$\uff0c\u5176\u6570\u503c\u5206\u522b\u4e3a$c$\u548c$d$\uff0c\u90a3\u4e48\u5c31\u65ad\u6389\u4e86$a\\to b$\u548c$c\\to d$\u7684\u8fb9\uff0c\u7136\u540e\u8fde\u63a5$a\\to d$\u548c$b\\to c$\u3002\u5982\u679c\u539f\u6765$a$\u548c$b$\u5728\u4e00\u4e2a\u73af\u5185\uff0c\u5c31\u4f1a\u65ad\u6389\u4e24\u6761\u73af\u4e0a\u7684\u8fb9\uff0c\u7136\u540e\u5c31\u4f1a\u5f62\u6210\u4e86\u4e24\u6761\u94fe\uff0c\u63a5\u7740\u8fde\u63a5\u4e86\u4e24\u6761\u8fb9\uff0c\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e24\u6761\u8fb9\u8fde\u63a5\u7684\u90fd\u662f\u4e24\u6761\u94fe\u7684\u8d77\u70b9\u548c\u7ec8\u70b9\uff0c\u6240\u4ee5\u4e00\u5b9a\u4f1a\u5206\u88c2\u3002\u5982\u679c$a$\u548c$b$\u662f\u4e24\u4e2a\u73af\u4e0a\u7684\u70b9\uff0c\u90a3\u5c31\u4f1a\u5206\u522b\u65ad\u6389\u4e24\u4e2a\u73af\uff0c\u65b0\u8fde\u63a5\u7684\u4e24\u6761\u8fb9\u5c31\u4f1a\u8fde\u63a5\u6210\u4e00\u4e2a\u73af\u3002\u6240\u4ee5\u9009\u62e9\u73af\u5185\u7684\u4efb\u610f\u4e24\u70b9\u4ea4\u6362\u90fd\u662f\u53ef\u4ee5\u7684\u3002\n# \u521d\u6b65\u7684dp\n\u73b0\u5728\u6211\u4eec\u6765\u8003\u8651\u5982\u4f55\u7b97\u51fa\u6765\u8fd9\u4e2a\u65b9\u6848\u6570\u3002\u9996\u5148\u6211\u4eec\u5148\u9488\u5bf9\u5355\u4e2a\u73af\u5904\u7406\u3002\u8bbe$f_i$\u8868\u793a\u5927\u5c0f\u4e3a$i$\u7684\u73af\uff0c\u5176\u4e2d$f_1=1$\u3002\u4e00\u4e2a\u73af\u53ef\u4ee5\u5206\u6210\u4e24\u4e2a\u73af\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u8fd9\u4e24\u4e2a\u73af\u7684\u5927\u5c0f\u3002\u7136\u540e\u9009\u62e9\u4e24\u4e2a\u70b9\u6765\u5206\u5272\uff0c\u4e0d\u96be\u770b\u51fa\u53ef\u4ee5\u627e\u5230$n$\u4e2a\u5206\u5272\u7684\u65b9\u6848\u3002\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u5206\u5272\u7684\u4e24\u90e8\u5206\u5927\u5c0f\u4e00\u6837\u5c31\u4f1a\u51fa\u73b0\u91cd\u590d\uff0c\u53ea\u6709$\\frac{n}{2}$\u4e2a\u5206\u5272\u65b9\u6848\u3002\u8bbe$T$\u8868\u793a\u5206\u5272\u7684\u65b9\u6848\u6570\uff0c\u5219\u6709\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$f_i=\\displaystyle\\sum_x^{\\frac{n}{2}}f_x\\times f_{n-x}\\times T$$\n\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e2a\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5e76\u4e0d\u5bf9\uff01\u6211\u4eec\u5206\u5272\u51fa\u6765\u7684\u4e24\u4e2a\u96c6\u5408\u5e76\u6ca1\u6709\u5148\u540e\u987a\u5e8f\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e24\u4e2a\u96c6\u5408\u7684\u64cd\u4f5c\u53ef\u4ee5\u6df7\u4e71\u5f97\u653e\u5728\u4e00\u8d77\uff0c\u53ea\u9700\u8981\u4fdd\u8bc1\u4e24\u4e2a\u96c6\u5408\u5185\u90e8\u662f\u6709\u5e8f\u7684\u3002\u56e0\u4e3a\u4e00\u4e2a\u96c6\u5408\u5904\u7406\u81f3\u5c11\u9700\u8981$x-1$\u6b65\uff0c\u6240\u4ee5$01$\u4e32\u7684\u957f\u5ea6\u4e3a$n-2$\u3002\u73b0\u5728\u6211\u4eec\u5148\u5047\u8bbe\u5409\u548c\u5185\u90e8\u4e5f\u53ef\u4ee5\u968f\u610f\u6446\u653e\uff0c\u6240\u4ee5\u65b9\u6848\u6570\u5c31\u662f$(n-2)!$\u3002\u7136\u540e\u5355\u4e2a\u96c6\u5408\u5185\u53ea\u80fd\u6709\u5e8f\uff0c$1$\u79cd\u65b9\u6848\uff0c\u4f46\u662f\u7b2c\u4e00\u4e2a\u96c6\u5408\u5185\u968f\u610f\u6446\u653e\u4ea7\u751f\u4e86$(x-1)!$\u4e2a\u65b9\u6848\uff0c\u9664\u6cd5\u8ba1\u7b97\u5373\u53ef\u3002\u53e6\u4e00\u4e2a\u96c6\u5408\u540c\u7406\u3002\u5f97\u5230\u6700\u7ec8\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$f_i=\\displaystyle\\sum_{x=1}^{\\frac{n}{2}}f_x\\times f_{n-x}\\times T\\times \\frac{(n-2)!}{(x-1)!(n-x-1)!}$$\n\u73b0\u5728\u601d\u8003\u4e00\u4e0b\u7b54\u6848\u662f\u4ec0\u4e48\u3002\u56e0\u4e3a\u6574\u4f53\u4f1a\u6709\u5f88\u591a\u7684\u73af\uff0c\u6240\u4ee5\u6bcf\u4e2a\u73af\u90fd\u8981\u4e58\u8d77\u6765\u3002\u56e0\u4e3a\u7b54\u6848\u4e2d\u4e24\u4e2a\u96c6\u5408\u7684\u987a\u5e8f\u4e5f\u53ef\u4ee5\u6253\u4e71\uff0c\u8bbe\u6709$k$\u4e2a\u73af\uff0c\u6bcf\u4e2a\u73af\u7684\u5927\u5c0f\u4e3a$l_i$\uff0c\u6240\u4ee5\u7b54\u6848\u4e3a\uff1a\n$$ans=\\displaystyle\\prod_{i=1}^kf_{l_i}\\times\\frac{(n-k)!}{\\displaystyle\\prod_{j=1}^k[(l_j-1)!]}$$\n\n# \u8d85\u65f6\u7684\u5904\u7406\n\u4f46\u662f\u4ee5\u4e0a\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u7b97$f$\u662f$\\Theta(n^2)$\u7684\uff0c\u4f1a\u8d85\u65f6\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5148\u770b\u4e00\u770b$f$\u6570\u7ec4\u7b97\u51fa\u6765\u6709\u4ec0\u4e48\u7279\u70b9\uff1a\n$$1\u30001\u30003\u300016\u3000125\u30001296\u300016807\u3000262144\u30004782969\u3000100000000...$$\n\u53d1\u73b0\u4e86\u4ec0\u4e48\uff1f\u4f60\u6ca1\u53d1\u73b0\uff1f\u653e\u5230$OEIS$\u4e0a\u770b\u770b\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20201129182942523.png#pic_center)\n\n$OEIS$\u544a\u8bc9\u6211\u4eec\uff0c\u8fd9\u4e32\u6570\u5217\u662f$n^{n-2}$\u3002\u6240\u4ee5\uff0c$f$\u6570\u7ec4\u7684\u5904\u7406\u76f4\u63a5\u53d8\u6210\u4e86$\\Theta(n\\log n)$\u3002\n# \u6700\u540e\u7684\u95ee\u9898\uff1a\u5bfb\u627e\u73af\n\u56e0\u4e3a\u672c\u9898\u53ea\u6709\u7b80\u5355\u73af\uff0c\u76f4\u63a5$dfs$\u5c31\u80fd\u5f88\u5feb\u5730\u627e\u5230\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u6709$\\Theta(n)$\u3002\u5e94\u8be5\u4e0d\u4f1a\u6709\u4eba\u4e0d\u4f1a\u7528$dfs$\u627e\u73af\u5427\uff1f\u4e0d\u4f1a\u7684\u8be6\u89c1\u4ee3\u7801\n# \u9898\u76ee\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int NN=1e5+4,P=1e9+9;\nint f[NN],inv[NN],a[NN],l[NN];\nbool vis[NN];\nint qmi(int a,int b)\n{\n    int res=1;\n    while(b)\n    {\n        if(b&1)\n            res=1ll*res*a%P;\n        a=1ll*a*a%P;\n        b>>=1;\n    }\n    return res;\n}\nint dfs(int u)\n{\n    vis[u]=true;\n    if(vis[a[u]])\n        return 1;\n    return dfs(a[u])+1;\n}\nint main()\n{\n    inv[0]=f[1]=1;\n    for(int i=1;i<NN;i++)\n        inv[i]=1ll*inv[i-1]*i%P;\n    for(int i=2;i<NN;i++)\n        f[i]=qmi(i,i-2);\n    int t;\n    scanf(\"%d\",&t);\n    while(t--)\n    {\n        memset(vis,false,sizeof(vis));\n        int n,cnt=0;\n        scanf(\"%d\",&n);\n        for(int i=1;i<=n;i++)\n            scanf(\"%d\",&a[i]);\n        for(int i=1;i<=n;i++)\n            if(!vis[i])\n                l[++cnt]=dfs(i);\n        int ans=inv[n-cnt];\n        for(int i=1;i<=cnt;i++)\n            ans=1ll*ans*f[l[i]]%P*qmi(max(1,inv[l[i]-1]),P-2)%P;\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1606646900,
        "uid": 132424,
        "name": "\u826f\u5fc3WA\u9898\u4eba",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4778 \u3010Counting swaps\u3011"
    },
    {
        "content": "\u628a\u6570\u5217\u4e2d\u6bcf\u4e2a\u5143\u7d20\u4e0e\u4ed6\u7684\u4f4d\u7f6e\u8fde\u8fb9\u3002\u5bb9\u6613\u53d1\u73b0\uff0c\u76ee\u6807\u72b6\u6001\u5c31\u662f\u8ba9\u56fe\u4e2d\u53ea\u6709\u81ea\u73af\u3002  \n\u8003\u8651\u4e00\u6b21\u4ea4\u6362\u5bf9\u73af\u7684\u5f71\u54cd\u3002\u628a\u4ea4\u6362\u6620\u5c04\u5230\u56fe\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4ed6\u7684\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a  \n\u7b2c\u4e00\u6b65\uff1a\u5220\u8fb9\u3002  \n![](https://cdn.luogu.com.cn/upload/image_hosting/zbrbrgtn.png)  \n\u7b2c\u4e8c\u90e8\uff1a\u91cd\u8fde\u3002  \n![](https://cdn.luogu.com.cn/upload/image_hosting/m340sshc.png)  \n\u7531\u4e8e\u6bcf\u6b21\u6700\u591a\u5220\u9664\u4e24\u6761\u8fb9\uff0c\u6240\u4ee5\u53ea\u80fd\u5c06\u73af\u4e0a\u76f8\u90bb\u7684\u90e8\u5206\u5206\u5272\u5f00\u3002\u56e0\u6b64\uff0c\u6bcf\u4e00\u6b65\u5206\u88c2\u4e00\u4e2a\u73af\uff0c\u8bbe\u73af\u957f\u5ea6\u4e3a $n$\uff0c\u5219\u6700\u5c11\u6b65\u6570\u4e3a $n-1$\u3002  \n~~\u4e3a\u4e86\u62d2\u7edd OEIS\uff0c\u6211\u51b3\u5b9a\u624b\u63a8\u7ed3\u679c~~  \n\u628a\u6bcf\u6b21\u4ea4\u6362\u5f71\u54cd\u7684\u4e24\u4e2a\u70b9\u8fde\u8d77\u6765\u3002\u9996\u5148\uff0c\u5f88\u660e\u663e\u4e0d\u80fd\u6210\u73af\uff0c\u4e0d\u7136\u4e0d\u6362\u80af\u5b9a\u6bd4\u6362\u4f18\u3002\u5176\u6b21\uff0c\u603b\u8fb9\u6570\u4e3a $n-1$\u3002\u7ed3\u5408\u4ee5\u4e0a\u4e24\u6761\u4fbf\u53ef\u5f97\u51fa\uff1a\u8fd9\u662f\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\u3002\u867d\u7136\u5728\u6811\u4e2d\u7684\u4efb\u610f\u4e24\u6761\u8fb9\u4e0d\u80fd\u4ea4\u53c9\uff0c\u800c\u4e14\uff0c\u56e0\u4e3a\u64cd\u4f5c\u987a\u5e8f\u539f\u56e0\uff0c\u4e5f\u4f1a\u591a\u51fa\u6765\u4e2a\u522b\u60c5\u51b5\u3002\u6bd4\u5982\u4ee5\u4e0b\u4e24\u79cd\uff1a  \n![](https://cdn.luogu.com.cn/upload/image_hosting/jerm45iu.png)![](https://cdn.luogu.com.cn/upload/image_hosting/00uxefct.png)  \n\u4f46\u662f\uff0c\u901a\u8fc7\u5c06\u4ea4\u53c9\u7684\u8fb9\u91cd\u8fde\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e0d\u53ef\u80fd\u7684\u60c5\u51b5\u4e0e\u91cd\u590d\u7684\u60c5\u51b5\u4e4b\u95f4\u5b58\u5728\u4e00\u4e00\u5bf9\u5e94\u3002\u65b9\u6848\u62b5\u6d88\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u6b63\u5e38\u7684\u60c5\u51b5\u7edf\u8ba1\u65b9\u6848\u6570\u3002  \n\u90a3\u4e48\u7b54\u6848\u5c31\u5f88\u660e\u663e\u4e86\u3002\u6839\u636e $\\text{Cayley}$ \u516c\u5f0f\uff0c\u603b\u65b9\u6848\u6570\u5c31\u662f $n^{n-2}$\u3002 \n\u5355\u4e2a\u73af\u7684\u60c5\u51b5\u89e3\u51b3\u4e86\u3002\u6211\u4eec\u7edf\u8ba1\u56fe\u4e0a\u6240\u6709\u7684\u73af\uff0c\u9010\u4e2a\u7edf\u8ba1\u3002\u8bbe\u7b2c $i$ \u4e2a\u73af\u7684\u957f\u5ea6\u4e3a $l_i$\uff0c\u4ea4\u6362\u7684\u65b9\u6848\u6570\u4e3a $f_i$\uff0c\u73af\u7684\u6570\u91cf\u4e3a $k$\uff0c\u90a3\u4e48\u6839\u636e\u4e58\u6cd5\u539f\u7406\u4e0e\u53ef\u91cd\u96c6\u7684\u6392\u5217\u6570\uff0c\u53ef\u4ee5\u63a8\u51fa\u7b54\u6848\u4e3a\uff1a  \n$$(n-k)!\\prod^k_{i=1}f_i\\frac1{(l_i-1)!}$$\n\u590d\u6742\u5ea6 $O(n\\log n)$\uff0c\u5b8c\u7ed3\u6492\u82b1\u3002\n# AC \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int mod = 1e9 + 9;\nconst int MAXN = 1e5 + 10;\n\ninline \nll qpow(ll b, ll p) {\n\tll res = 1;\n\twhile (p) {\n\t\tif (p & 1) res = res * b % mod;\n\t\tb = b * b % mod, p >>= 1;\n\t}\n\treturn res;\n}\n\nll frc[MAXN], ifrc[MAXN];\n\ninline \nvoid init(int n) {\n\tfrc[0] = 1;\n\tfor (int i = 1; i <= n; i++) frc[i] = frc[i - 1] * i % mod;\n\tifrc[n] = qpow(frc[n], mod - 2);\n\tfor (int i = n - 1; ~i; i--) ifrc[i] = ifrc[i + 1] * (i + 1) % mod;\n}\n\nint n, a[MAXN];\n\nbool vis[MAXN];\n\ninline \nll calc(int k) {\n\tint cnt = 1; vis[k] = 1;\n\tfor (int i = a[k]; i != k; i = a[i]) cnt++, vis[i] = 1;\n\treturn cnt == 1 ? 1 : qpow(cnt, cnt - 2) * ifrc[cnt - 1] % mod;\n}\n\nint t;\n\nll ans, k;\n\nint main() {\n\tinit(1e5);\n\tfor (scanf(\"%d\", &t); t--;) {\n\t\tmemset(vis, 0, sizeof vis);\n\t\tscanf(\"%d\", &n), ans = 1, k = 0;\n\t\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]);\n\t\tfor (int i = 1; i <= n; i++) {\n\t\t\tif (!vis[i]) ans = ans * calc(i) % mod, k++;\n\t\t}\n\t\tprintf(\"%lld\\n\", ans * frc[n - k] % mod);\n\t}\n}\n```",
        "postTime": 1661157394,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "P4778 \u9898\u89e3"
    },
    {
        "content": "# P4778 Counting swaps\n\n[**My blogs**](https://www.cnblogs.com/linghuabaobao/p/15516909.html)\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P4778)\n\n## \u9898\u610f\uff1a\n\u7ed9\u51fa\u4e00\u4e2a $1\\sim n$ \u7684\u6392\u5217\uff0c\u95ee\u5c06\u5176\u53d8\u6210 $1\\sim n$ \u7684\u6700\u5c11\u6b21\u6570\u7684\u65b9\u6848\u6570\u4e3a\u591a\u5c11\u3002\n\n## \u89e3\u6cd5\uff1a\n\n\u9996\u5148\u5bf9\u4e8e\u4e00\u4e2a\u6392\u5217\uff0c\u5c06\u8fd9\u4e2a\u4f4d\u7f6e\u548c\u8fd9\u4e2a\u4f4d\u7f6e\u4e0a\u6570\u5b57\u5e94\u8be5\u5728\u7684\u4f4d\u7f6e\u8fde\u8fb9\uff0c\u4f1a\u5f62\u6210\u82e5\u5e72\u4e2a\u73af\uff0c\u7edf\u8ba1\u6bcf\u4e2a\u73af\u4e0a\u7684\u70b9\u7684\u4e2a\u6570\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u8fdb\u884c\u7ef4\u62a4\u3002\n\n> \u5f15\u7406\uff1a\u5bf9\u6bcf\u4e2a\u73af\uff0c\u4efb\u610f\u9009\u53d6\u4e24\u4e2a\u64cd\u4f5c\u4e00\u6b21\uff0c\u4e00\u5b9a\u4f1a\u5206\u6210\u4e24\u4e2a\u4e0d\u76f8\u8fde\u7684\u73af\n\n> \u8bc1\u660e\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u4e0a\u7684\u6240\u6709\u70b9\uff0c\u90fd\u6709\u4e00\u4e2a $from_i$ \u548c $to_i$ \u5206\u522b\u8868\u793a\u54ea\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u70b9\u5e94\u8be5\u5230\u8fd9\u91cc\u548c\u8fd9\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u70b9\u5e94\u8be5\u5230\u54ea\u91cc\u3002\u5176\u4e2d $from_i$ \u548c $to_i$ \u662f\u4e24\u4e2a\u5bf9\u4e8e $1\\sim n$ \u7684\u6392\u5217\uff0c\u4e14\u6ca1\u6709\u4efb\u610f\u4e00\u4e2a\u5b50\u5e8f\u5217\u7684 $from_{i-j}$ \u548c $to_{i-j}$ \u7684\u503c\u57df\u76f8\u7b49\u3002\u800c\u5982\u679c\u4ea4\u6362\u5176\u4e2d\u4e24\u4e2a\u6570\uff0c\u4f1a\u4ea4\u6362\u8fd9\u4e24\u4e2a\u4f4d\u7f6e\u4e0a\u7684 $to_i$ \u800c\u4e0d\u4f1a\u4ea4\u6362 $from_i$\u3002\u6240\u4ee5\uff0c\u4ea4\u6362\u4e00\u6b21\u5c31\u4f1a\u4f7f\u67d0\u5b50\u5e8f\u5217\u4e0a\u7684 $from$ \u548c $to$ \u7684\u503c\u57df\u76f8\u7b49\u3002\n\n### \u7136\u540e\u8003\u8651\u6bcf\u4e2a\u73af\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u73af\uff0c\u6839\u636e\u4e0a\u9762\u7684\u7406\u8bba\uff0c\u8981\u4f7f\u5b83\u4e0a\u9762\u6240\u6709\u7684\u70b9\u90fd\u5f52\u4f4d\uff0c\u90a3\u4e48\u81f3\u5c11\u9700\u8981 $n-1$ \u6b21\u7684\u64cd\u4f5c\u3002\n\n### \u8003\u8651\u64cd\u4f5c\u53d6\u6cd5\uff1a\n\n\u4e4b\u540e\u8003\u8651\u5bf9\u8fd9 $n-1$ \u6b21\u64cd\u4f5c\u6709\u51e0\u79cd\u53d6\u6cd5\u3002\u5047\u8bbe\u8fdb\u884c\u5b8c\u8fd9\u4e00\u6b21\u64cd\u4f5c\u540e\uff0c\u5c06\u8fd9\u4e2a\u73af\u5206\u6210\u4e86 $x$ \u548c $y$ \u4e24\u90e8\u5206\uff0c\u5176\u4e2d\u6ee1\u8db3 $x + y = n$ \uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u8003\u8651\u8fd9\u79cd\u5206\u5272\u64cd\u4f5c\uff0c\u4e00\u5171\u6709\u4e24\u79cd\uff1a\u4e00\u79cd\u662f\u548c\u8fd9\u4e2a\u70b9 $i$ \u7684\u7b2c $x$ \u7ea7 $from$ \u4ea4\u6362\uff0c\u53ef\u4ee5\u5206\u5272\u6210\u529f\uff1b\u53e6\u4e00\u79cd\u662f\u548c\u8fd9\u4e2a\u70b9 $i$ \u7684\u7b2c $y$ \u7ea7 $from$ \u4ea4\u6362\uff0c\u53ef\u4ee5\u5206\u5272\u6210\u529f\uff08\u5176\u4e2d\u8fd9\u91cc\u9762\u8981\u6ce8\u610f\u7684\u662f\uff1a\u6bcf\u4e2a\u70b9\u7684\u7b2c $a$ \u7ea7 $from$ \u5c31\u662f\u8fd9\u4e2a\u70b9\u7684 $n-a$ \u7ea7 $to$\uff09\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u90fd\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u6bcf\u79cd\u64cd\u4f5c\u7684\u4e24\u4e2a\u70b9\u5bf9\u8fd9\u6b21\u64cd\u4f5c\u5206\u522b\u7b97\u4e00\u6b21\uff0c\u6240\u4ee5\u5c06\u4e00\u4e2a\u73af\u5206\u4e3a $x$ \u548c $y$ \u4e24\u90e8\u5206\u7684\u6b21\u6570 $T(x,y)$ \u5c31\u4e3a $\\frac{2\\times n}{2}=n$\u3002\u5176\u4e2d\uff0c\u5f53\u4e14\u4ec5\u5f53\u4e00\u4e2a\u70b9\u7684\u8fd9\u4e24\u79cd\u64cd\u4f5c\u4ea4\u6362\u7684\u5176\u5b9e\u662f\u540c\u4e00\u4e2a\u70b9\uff0c\u4e5f\u5c31\u662f $x=y$ \u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u91cd\u590d\u7684\u5f71\u54cd\uff0c\u6240\u4ee5\u6b64\u65f6 $T(x,y)$ \u4e3a $\\frac{n}{2}$\u3002\n\n### \u8003\u8651\u64cd\u4f5c\u987a\u5e8f\uff1a\n\n\u5f53\u6211\u4eec\u5c06\u4e00\u4e2a\u73af\u62c6\u6210\u4e24\u4e2a\u5927\u5c0f\u4e3a $x$ \u548c $y$ \u7684\u4e24\u4e2a\u73af\u540e\uff0c\u5bf9 $x$ \u8fd9\u4e2a\u73af\u8fd8\u4f1a\u6709 $x-1$ \u6b21\u64cd\u4f5c\uff0c\u5bf9 $y$ \u540c\u7406\uff0c\u7136\u540e\u5bf9 $x$ \u548c $y$ \u7684\u64cd\u4f5c\uff0c\u4f46\u662f $x$ \u548c $y$ \u4e92\u4e0d\u5e72\u6270\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u770b\u6210\u662f\u5bf9 $x-1$ \u4e2a $0$ \u548c $y-1$ \u4e2a $1$ \u6c42\u591a\u91cd\u96c6\u6392\u5e8f\u6570\u3002\n\n### \u7edf\u8ba1\u7b54\u6848\uff1a\n\n\u5047\u8bbe\u6211\u4eec\u5bf9\u4e8e\u4e2a\u6570\u4e3a $n$ \u7684\u73af\u64cd\u4f5c\u79cd\u6570\u6709 $f_n$ \u79cd\uff0c\u4e14\u5206\u6210\u4e86 $x$ \u548c $y$ \u4e24\u90e8\u5206\uff0c\u5e76\u4e14\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u5206\u5f00\u4e4b\u540e\u7684\u64cd\u4f5c\u79cd\u6570\u5c31\u662f $T(x,y)\\times f_x\\times f_y \\times \\frac{(n-2)!}{(x-1)!\\times(y-1)!}$\u3002\n\n\u5bf9\u4e8e $k$ \u4e2a\u73af\u7684\u9898\uff0c\u8bbe\u6bcf\u4e2a\u73af\u4e0a\u70b9\u7684\u4e2a\u6570\u4e3a $siz_i$\uff0c\u56e0\u4e3a $k$ \u4e2a\u73af\u4e4b\u95f4\u64cd\u4f5c\u76f8\u4e92\u4e0d\u5f71\u54cd\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u6210\u662f\u5bf9\u4e8e  $k$ \u4e2a $siz_i$ \u6c42\u591a\u91cd\u96c6\u6392\u5e8f\u6570\uff0c\u6240\u4ee5\u6700\u7ec8\u7b54\u6848\u5c31\u662f \n$$\nf_{siz_1}\\times f_{siz_2} \\times \\dots \\times f_{siz_k} \\times \\frac{(n-k)!}{(siz_1-1)!\\times(siz_2-1)!\\times\\dots\\times(siz_k-1)! }\n$$\n\n\u5bf9\u4e8e\u8ba1\u7b97\uff0c\u56e0\u4e3a\u6a21\u6570 $10^9+9$ \u662f\u8d28\u6570\uff0c\u6240\u4ee5\u5728\u7b54\u6848\u8303\u56f4\u5185\u90fd\u6709\u5173\u4e8e $10^9+9$ \u8fd9\u4e2a\u6570\u7684\u9006\u5143\uff0c\u628a\u9664\u53f7\u6539\u4e3a\u4f7f\u7528\u9006\u5143\u8ba1\u7b97\u3002\u590d\u6742\u5ea6 $O(n^2)$\u3002\u8003\u8651\u4f18\u5316\uff0c\u7b97\u6cd5\u74f6\u9888\u5728\u4e8e\u8981\u679a\u4e3e $f_{siz_i}$\uff0c\u5bfc\u81f4\u589e\u52a0\u4e86\u4e00\u4e2a $n$\uff0c\u4f46\u662f\u5bf9\u4e8e\u8fd9\u4e2a $f_n$\uff0c\u524d\u4eba\u544a\u8bc9\u4e86\u6211\u4eec $f_n=n^{n-2}$~~\uff08\u6211\u4e5f\u4e0d\u77e5\u9053\u548b\u6765\u7684\\bushi\uff09~~\u3002\u7136\u540e\u5c31\uff0c\u55ef\uff0c$O(n\\log n)$ \u5c31\u53ef\u4ee5\u89e3\u51b3\u4e86\u3002\n\n\n## Code\n\n```cpp\n#include <iostream>\n#include <cstring>\nusing namespace std ;\n\nconst long long N = 1000005 , M = 1e9 + 9 ;\nint cal[N] , n , clr[N] , siz[N] , msiz , a[N] , dt , res , ans ;\nbool vis[N] ;\n\nvoid init ( )\n{\n\tmemset ( clr , 0 , sizeof ( clr ) ) ;\n\tmemset ( siz , 0 , sizeof ( siz ) ) ;\n\tmemset ( a , 0 , sizeof ( a ) ) ;\n\tmemset ( vis , 0 , sizeof ( vis ) ) ;\n\tdt = res = ans = 0 ;\n}\n\nint read ( )\n{\n\tchar ch = getchar ( ) ;\n\tint x = 0 ;\n\twhile ( ch < '0' || ch > '9' )\n\t\tch = getchar ( ) ;\n\twhile ( ch >= '0' && ch <= '9' )\n\t\tx = x * 10 + ch - 48 , ch = getchar ( ) ;\n\treturn x ;\n}\n\nint find ( int x )\n{\n\tif ( x == clr [ x ] )\n\t\treturn x ;\n\treturn clr [ x ] = find ( clr [ x ] ) ;\n}\n\nint qpow ( int x , int y )\n{\n\tif ( y < 1 )\n\t\treturn 1 ;\n\tint res = 1 ;\n\twhile ( y )\n\t{\n\t\tif ( y & 1 )\n\t\t\tres = res * 1ll * x % M ;\n\t\tx = x * 1ll * x % M ;\n\t\ty >>= 1 ;\n\t}\n\treturn res ;\n}\n\nint main ( )\n{\n\tcal [ 0 ] = cal [ msiz = 1 ] = 1 ;\n\tint T = read ( ) ;\n\twhile ( T -- )\n\t{\n\t\tinit ( ) ;\n\t\tn = read ( ) ;\n\t\tfor ( int i = 1 ; i <= n ; ++ i )\n\t\t\tclr [ i ] = i , siz [ i ] = 1 , vis [ i ] = 0 ;\n\t\tint msz = 0 ;\n\t\tfor ( int i = 1 ; i <= n ; ++ i )\n\t\t{\n\t\t\tint x = read ( ) ;\n\t\t\tint fi = find ( i ) , fx = find ( x ) ;\n\t\t\tif ( fi != fx )\n\t\t\t{\n\t\t\t\tclr [ fi ] = fx ;\n\t\t\t\tsiz [ fx ] += siz [ fi ] ;\n\t\t\t\tmsz = max ( msz , siz [ fx ] ) ;\n\t\t\t\tvis [ fi ] = 1 ;\n\t\t\t}\n\t\t}\n\t\tdt = 0 ;\n\t\tfor ( int i = 1 ; i <= n ; ++ i )\n\t\t\tif ( ! vis [ i ] )\n\t\t\t\ta [ ++ dt ] = siz [ i ] ;\n\t\tmsz = max ( msz , n - dt ) ;\n\t\tif ( msz > msiz )\n\t\t{\n\t\t\tfor ( int i = msiz + 1 ; i <= msz ; ++ i )\n\t\t\t\tcal [ i ] = cal [ i - 1 ] * 1ll * i % M ;\n\t\t\tmsiz = msz ;\n\t\t}\n\t\tres = ans = 1 ;\n\t\tfor ( int i = 1 ; i <= dt ; ++ i )\n\t\t\tres = res * 1ll * cal [ a [ i ] - 1 ] % M , ans = ans * 1ll * qpow ( a [ i ] , a [ i ] - 2 ) % M ;\n\t\tans = ans * 1ll * qpow ( res , M - 2 ) % M * cal [ n - dt ] % M ;\n\t\tans = ( ans % M + M ) % M ;\n\t\tprintf ( \"%lld\\n\" , ans ) ;\n\t}\n\treturn 0 ;\n}\n```",
        "postTime": 1636169284,
        "uid": 68882,
        "name": "\u7075\u534e",
        "ccfLevel": 6,
        "title": "P4778 Counting swaps"
    },
    {
        "content": "\u6211\u6765\u8bf4\u4e0b\u8fd9\u9898\u7684\u4e00\u4e2a\u5c0f\u6280\u5de7\n\n\u6211\u4eec\u77e5\u9053\u4e00\u4e2a\u6570\u5bf9\u5e94\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u4e14\u4e00\u4e2a\u4f4d\u7f6e\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u6570\n\n\u8fd9\u5c31\u610f\u5473\u7740\u6574\u4e2a\u56fe\u4e0a\u6bcf\u4e2a\u70b9\u5165\u5ea6\u51fa\u5ea6\u90fd\u4e3a1\n\n\u4e5f\u5c31\u610f\u5473\u7740\u56fe\u4e0a\u7684\u73af\u90fd\u662f\u7b80\u5355\u73af\n\n\u4e8e\u662fDFS\u627e\u73af\u5e76\u7edf\u8ba1\u957f\u5ea6\u53ef\u4ee5\u7528\u5f88\u7b80\u5355\u7684\u4ee3\u7801\u5b9e\u73b0\n\n```cpp\nint dfs(int x)\n{\n\tvis[x]=1;\n\tif(vis[a[x]]) return 1;\n\treturn dfs(a[x])+1;\n}\n```",
        "postTime": 1540365537,
        "uid": 31293,
        "name": "Adove",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4778 \u3010Counting swaps\u3011"
    },
    {
        "content": "\u4e00\u9053\u7ec3\u8ba1\u6570\u7684\u9898\u3002\n\n### \u7b2c\u4e00\u6b65 \u5efa\u56fe\n\n\u5c06\u6bcf\u4e2a\u6570\u548c\u5b83\u7684\u76ee\u6807\u4f4d\u7f6e\u8fde\u4e00\u6761\u8fb9\uff0c\u5f62\u6210\u4e00\u4e2a $n$ \u4e2a\u8282\u70b9 $n$ \u6761\u8fb9\u7684\u6709\u5411\u56fe\u3002\n\n\u4f8b\u5982\u8fd9\u7ec4\u6570\u636e\uff1a\n\n> 2 4 6 1 5 3\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/17xda8rj.png)\n\n\u6ce8\uff1a\u56fe\u6e90\u81ea@[\u6ce5\u571f\u7b28\u7b28](https://www.luogu.com.cn/user/43206) \u5bb6\u7684\u72d7\u8c46\u8c46\u8bb2\u8bfe\u65f6\u7684\u8bfe\u4ef6\u3002\n\n\u76ee\u6807\u5c31\u662f\u7ecf\u8fc7\u5f88\u591a\u6b21\u4ea4\u6362\u5c06\u8fd9\u5199\u73af\u53d8\u6210 $n$ \u4e2a\u81ea\u73af\u3002\n\n### \u7b2c\u4e8c\u6b65 \u81ea\u73af\n\n\u9996\u5148\u7ecf\u8fc7\u5c1d\u8bd5\uff0c\u957f\u5ea6\u4e3a $1$ \u7684\u73af\u4e0d\u9700\u8981\u64cd\u4f5c\uff1b\u957f\u5ea6\u4e3a $2$ \u7684\u73af\u9700\u8981\u7ecf\u8fc7 $1$ \u6b21\u64cd\u4f5c\uff1b\u957f\u5ea6\u4e3a $3$ \u7684\u73af\u9700\u8981\u7ecf\u8fc7 $2$ \u6b21\u64cd\u4f5c\u2026\u2026\n\n\u56e0\u6b64\u53ef\u4ee5\u5047\u8bbe\uff0c\u957f\u5ea6\u4e3a $k$ \u7684\u73af\u9700\u8981 $k-1$ \u6b21\u64cd\u4f5c\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\uff0c\u73b0\u5728\u8003\u8651\u6709 $k$ \u4e2a\u8282\u70b9\u7684\u73af\uff0c\u5728\u73af\u4e0a\u9009\u62e9\u4efb\u610f\u4e24\u70b9\u4ea4\u6362\uff0c\u4f1a\u53d1\u73b0\u73af\u4f1a\u88ab\u5206\u6210\u4e24\u4e2a\u5177\u6709 $x$ \u4e2a\u8282\u70b9\u548c $k-x$ \u4e2a\u8282\u70b9\u7684\u73af\u3002\n\n\u6240\u4ee5\u5c31\u9700\u8981\u64cd\u4f5c $(x-1)+(k-x-1)+1=k-1$ \u6b21\u64cd\u4f5c\uff0c\u5047\u8bbe\u6210\u7acb\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/tb9okbl2.png)\n\n\u6ce8\uff1a\u56fe\u6e90\u81ea@[\u6ce5\u571f\u7b28\u7b28](https://www.luogu.com.cn/user/43206) \u5bb6\u7684\u72d7\u8c46\u8c46\u8bb2\u8bfe\u65f6\u7684\u8bfe\u4ef6\u3002\n\n### \u7b2c\u4e09\u6b65 \u8fd8\u539f\n\n\u8bbe $f_k$ \u8868\u793a\u628a\u957f\u5ea6\u4e3a $k$ \u7684\u73af\u53d8\u6210 $k$ \u4e2a\u81ea\u73af\u7684\u65b9\u6848\u6570\u3002\u8bbe $t(x,y)$ \u8868\u793a\u4e00\u6b21\u4ea4\u6362\u4e4b\u540e\uff0c\u628a\u957f\u5ea6\u4e3a $n$ \u7684\u73af\u62c6\u6210\u957f\u5ea6\u5206\u522b\u4e3a $x$ \u548c $y$ \u7684\u73af\u7684\u65b9\u6848\u6570\u3002\n\n\u9996\u5148\u82e5 $x=y$\uff0c$n$ \u5fc5\u987b\u4e3a\u5076\u6570\uff0c\u9009\u62e9\u4efb\u610f\u4e00\u4e2a\u70b9\u90fd\u53ef\u4ee5\u9009\u62e9\u5bf9\u9762\u7684\u4e00\u4e2a\u70b9\uff0c\u4e0d\u8003\u8651\u76f8\u53cd\u9009\u62e9\u987a\u5e8f\u7684\u65b9\u6848\u6570\u6709 $n$ \u79cd\uff0c\u8003\u8651\u91cd\u590d\u7684\u9009\u62e9\uff0c\u5171\u6709 $\\frac{n}{2}$ \u79cd\u65b9\u6848\u3002\n\n\u82e5 $x \\neq y$\uff0c\u9009\u62e9\u4efb\u610f\u4e00\u4e2a\u70b9\u90fd\u6709\u4e24\u4fa7\u7684\u4e24\u4e2a\u70b9\u53ef\u4ee5\u9009\u62e9\uff0c\u4e0d\u8003\u8651\u76f8\u53cd\u9009\u62e9\u987a\u5e8f\u7684\u65b9\u6848\u6570\u6709 $2n$ \u79cd\uff0c\u8003\u8651\u91cd\u590d\u7684\u9009\u62e9\uff0c\u5171\u6709 $n$ \u79cd\u65b9\u6848\u3002\n\n$$t(x.y)=\\begin{cases}\\frac{n}{2}&x = y\\\\n&x \\neq y\\end{cases}$$\n\n\u90a3\u4e48\u957f\u5ea6\u4e3a $k$ \u7684\u73af\uff0c\u5206\u6210 $x$ \u548c $y$ \u4e24\u90e8\u5206\u540e\uff0c\u62c6\u6210\u7684\u65b9\u6848\u6570\u4e3a $t(x, y)$\uff0c\u5404\u81ea\u9700\u8981\u7684\u6b65\u9aa4\u5206\u522b\u4e3a $x-1$ \u548c $y-1$\uff0c\u5404\u81ea\u7684\u65b9\u6848\u6570\u4e3a $f_x$ \u548c $f_y$\u3002\u90a3\u4e48\u603b\u7684\u65b9\u6848\u5c31\u662f $x$ \u7684\u65b9\u6848\uff08\u76f8\u5f53\u4e8e\u5185\u90e8\u76f8\u540c\uff09\u548c $y$ \u7684\u65b9\u6848\uff08\u76f8\u5f53\u4e8e\u5185\u90e8\u76f8\u540c\uff09\uff0c\u5c31\u662f\u4e00\u4e2a\u591a\u91cd\u96c6\u7684\u6392\u5217\u6570 $\\frac{(n-2)!}{(x-1)!(y-1)!}$\uff0c\u5c06\u8fd9\u4e9b\u5206\u6b65\u7684\u6b65\u9aa4\u4e58\u8d77\u6765\u5c31\u662f $f_k$\uff0c\u5373\uff1a\n\n$$f_k=\\sum\\limits_{x+y=k}^{}t(x,y)f_xf_y\\frac{(k-2)!}{(x-1)!(y-1)!}$$\n\n\u90a3\u4e48\u6709\u4e86\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53ef\u4ee5\u7528 $O(n^2)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6c42\u51fa $f_k$\uff0c\u4f46\u662f\u4e00\u770b\u6570\u636e\u8303\u56f4 $n \\leq 10^5$\uff0c\u660e\u663e\u8fc7\u4e0d\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6253\u8868\u6253\u51fa\u6765\u8fd9\u4e2a\u6570\u7ec4\u7684\u524d\u51e0\u9879\u3002\n\n> 1 1 3 16 125 1296 16807 262144\n\n\u6c42\u52a9 [OEIS](http://oeis.org/)\uff0c\u53d1\u73b0\u662f A000272\uff1aNumber of trees on n labeled nodes: $f_n = n^{n-2}$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u5728 $O(\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa $f_k$\u3002\n\n### \u7b2c\u56db\u6b65 \u8ba1\u6570\n\n\u6700\u7ec8\uff0c\u5982\u679c\u539f\u59cb\u6392\u5217\u7531 $a$ \u4e2a\u73af\u6784\u6210\uff0c\u957f\u5ea6\u5206\u522b\u4e3a $l_1, l_2, \\cdots, l_a$\uff0c\u7b54\u6848\u5373\u4e3a\u6bcf\u4e2a\u73af\u7684\u65b9\u6848\u6570\u4e58\u4e0a\u8fd9\u4e9b\u65b9\u6848\u7684\u591a\u91cd\u96c6\u6392\u5217\u6570\uff0c\u5373\uff1a\n\n$$\\prod\\limits_{i=1}^a f_{l_i} \\times \\frac{(n-a)!}{\\prod\\limits_{i=1}^a (l_i - 1)!}$$\n\n\u5c31\u53ef\u4ee5\u5728 $O(n \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u7b54\u6848\u3002\n\n### Code:\n\n```cpp\n#include <iostream>\n#include <fstream>\n#include <cstring>\n\nusing namespace std;\n\nconst int MAXN = 1e5 + 9;\nconst int mod = 1e9 + 9;\n\nint _maxi = 0;\nint _myArray[MAXN];\nbool _visArray[MAXN];\nint _circleArray[MAXN];\nlong long _facArray[MAXN];\nlong long _invArray[MAXN];\nlong long _res = 0;\n\nlong long QuickPow (long long base, long long index) {\n\t\n\tlong long res = 1;\n\t\n\twhile (index) {\n\t\tif (index & 1) {\n\t\t\tres = res * base % mod;\n\t\t}\n\t\t \n\t\tbase = base * base % mod;\n\t\tindex >>= 1;\n\t}\n\t\n\treturn res;\n\t\n}\n\nvoid Init () {\n\t\n\t_facArray[0] = 1;\n\t\n\tfor (int i = 1; i < 1e5 + 1; i++) {\n\t\t_facArray[i] = _facArray[i - 1] * i % mod;\n\t}\n\t\n\t_invArray[100000] = QuickPow(_facArray[100000], mod - 2);\n\t\n\tfor (int i = 1e5 - 1; i > -1; i--) {\n\t\t_invArray[i] = _invArray[i + 1] * (i + 1) % mod; \n\t}\n\t\n}\n\nint Dfs (int cur) {\n\t\n\t_visArray[cur] = 1;\n\t\n\tif (_visArray[_myArray[cur]]) {\n\t\treturn 1;\n\t}\n\t\n\treturn Dfs(_myArray[cur]) + 1;\n\t\n}\n\nint main () {\n\t\n\tios::sync_with_stdio(false);\n\tcin.tie(nullptr), cout.tie(nullptr);\n\t\n\tint codeNum = 0;\n\t\n\tInit();\n\t\n\tcin >> codeNum;\n\t\n\twhile (codeNum--) {\n\t\tmemset(_myArray, 0, sizeof(_myArray));\n\t\tmemset(_visArray, 0, sizeof(_visArray));\n\t\tmemset(_circleArray, 0, sizeof(_circleArray));\n\t\t\n\t\tcin >> _maxi;\n\t\t\n\t\tfor (int i = 1; i < _maxi + 1; i++) {\n\t\t\tcin >> _myArray[i];\n\t\t}\n\t\t\n\t\tint tot = 0;\n\t\n\t\tfor (int i = 1; i < _maxi + 1; i++) {\n\t\t\tif (!_visArray[i]) {\n\t\t\t\t_circleArray[++tot] = Dfs(i);\n\t\t\t}\n\t\t} \n\t\t\n\t\t_res = _facArray[_maxi - tot];\n\t\t\n\t\tfor (int i = 1; i < tot + 1; i++) {\n\t\t\tif (_circleArray[i] > 1) {\n\t\t\t\t_res = _res * QuickPow(_circleArray[i], _circleArray[i] - 2) % mod;\t\n\t\t\t\t_res = _res * _invArray[_circleArray[i] - 1] % mod;\n\t\t\t}\n\t\t}\n\t\t\n\t\tcout << _res << '\\n';\t\n\t}\n\t\n\treturn 0;\n\t\n} \n```",
        "postTime": 1673321359,
        "uid": 621187,
        "name": "accomplishment",
        "ccfLevel": 0,
        "title": "P4778 Counting swaps \u9898\u89e3"
    },
    {
        "content": "# Link\n[P4778 Counting swaps](https://www.luogu.com.cn/problem/P4778)\n\n# Solve\n\u5bf9\u4e8e\u4e00\u4e2a\u6392\u5217$p_1,p_2,...,p_n$\uff0c\u5982\u679c\u4ece\u6bcf\u4e2a$i$\u5411$p_i$\u5efa\u4e00\u6761\u8fb9\uff0c\u663e\u7136\u53ef\u4ee5\u5f97\u5230\u4e00\u5f20\u56fe\uff0c\u8fd9\u5f20\u56fe\u5305\u62ec\u82e5\u5e72\u4e2a\u73af\u7ec4\u6210\uff08\u5305\u62ec\u81ea\u73af\uff09\u3002\u6700\u540e\u7684\u76ee\u6807\u5e8f\u5217\u4e3a$1,2,...,n$\uff0c\u663e\u7136\u7531$n$\u4e2a\u81ea\u73af\u7ec4\u6210\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u6709\u4e00\u4e2a\u5f15\u7406\uff1a\n\n> \u628a\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u73af\u53d8\u6210$n$\u4e2a\u81ea\u73af\uff0c\u6700\u5c11\u9700\u8981$n-1$\u6b21\u64cd\u4f5c\u3002\n\n\u8bc1\u660e\uff1a\n\n\u9996\u5148\u628a\u957f\u5ea6\u4e3a$2$\u7684\u73af\u53d8\u6210$2$\u4e2a\u81ea\u73af\uff0c\u663e\u7136\u9700\u8981\u4e00\u79cd\u64cd\u4f5c\u3002\n\n\u5047\u8bbe$\u2200k\u2264n-1$\uff0c\u628a\u957f\u5ea6\u4e0d\u8d85\u8fc7$k$\u7684\u73af\u53d8\u6210$k$\u4e2a\u81ea\u73af\u6700\u5c11\u9700\u8981$k-1$\u6b21\u64cd\u4f5c\u3002\u5f53$k=n$\u65f6\uff0c\u8bbe\u8be5\u73af\u4e3a$v_1\u2192v_2\u2192v_3\u2192...\u2192v_n\u2192v_1$,\u4efb\u610f\u4ea4\u6362$v_i,v_j(i<j)$\u7684\u51fa\u8fb9\u540e\uff0c\u6211\u4eec\u5f97\u5230$v_{i+1}\u2192v_{i+2}\u2192v_{i+3}\u2192...\u2192v_j\u2192v_{i+1}$\u548c$v_{1}\u2192v_{2}\u2192v_{i}\u2192...\u2192v_{j+1}\u2192v_{j+2}\u2192...\u2192v_n\u2192v_1$\u4e24\u4e2a\u73af\u3002\n\n\u4e24\u8005\u7684\u957f\u5ea6\u5206\u522b\u662f$j-i$\u548c$n-(j-i)$\u3002\u628a\u4e24\u8005\u5206\u522b\u62c6\u5206\u6210\u81ea\u73af\u7684\u6700\u5c0f\u4ea4\u6362\u6b21\u6570\u4e3a$j-i-1$\u548c$n-(j-i)-1$\u4e24\u8005\u76f8\u52a0\u662f$n-2$\uff0c\u52a0\u4e0a\u521a\u624d$v_i$\u548c$v_j$\u7684\u4ea4\u6362\uff0c\u603b\u5171\u9700\u8981$n-1$\u6b21\u4ea4\u6362\u3002\u6700\u540e\u901a\u8fc7\u6570\u5b66\u5f52\u7eb3\u6cd5\u53ef\u77e5\uff0c\u539f\u547d\u9898\u6210\u7acb\u3002\n\n\u8bc1\u6bd5\n\n\u8bbe$F_n$\u8868\u793a\u7528\u6700\u5c11\u6b65\u6570\u628a\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u73af\u53d8\u6210$n$\u4e2a\u81ea\u73af\uff0c\u603b\u5171\u6709\u591a\u5c11\u4e2d\u64cd\u4f5c\u65b9\u6cd5\u3002\u7531\u4e0a\u9762\u7684\u8bc1\u660e\u8fc7\u7a0b\u53ef\u77e5\uff0c\u628a\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u73af\u53d8\u6210$n$\u4e2a\u81ea\u73af\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u628a\u8be5\u73af\u62c6\u6210\u957f\u5ea6\u4e3a$x$\u548c$y$\u7684\u4e24\u4e2a\u73af\uff0c\u5176\u4e2d$x+y=n$,\u8bbe$T(x,y)$\u8868\u793a\u6709\u591a\u5c11\u79cd\u4ea4\u6362\u65b9\u6cd5\u53ef\u4ee5\u628a\u957f\u5ea6\u4e3a$n$\u7684\u73af\u53d8\u6210\u957f\u5ea6\u4e3a$x$\u548c$y$\u7684\u4e24\u4e2a\u73af\uff0c\u6613\u5f97\uff1a\n\n$$T(x,y)=\\begin{cases}\n{n/2,x=y}\\\\{n,x\u2260y} \\end{cases}$$\n\n\u53e6\u5916\uff0c\u4e24\u8005\u5404\u81ea\u53d8\u4e3a\u81ea\u73af\u7684\u65b9\u6cd5\u6570\u4e3a$F_x$\u548c$F_y$\uff0c\u6b65\u6570\u4e3a$x-1$\u548c$y-1$\u3002\n\n\u6839\u636e\u591a\u91cd\u96c6\u7684\u6392\u5217\u6570\u00b7\u52a0\u6cd5\u539f\u7406\u548c\u4e58\u6cd5\u539f\u7406\uff1a\n\n$$F_n=\\sum_{x+y=n}T(x,y)\\ast F_x \\ast F_y \\ast \\dfrac{(n-2)!}{(x-1)!(y-1)!}$$\n\n\u5982\u679c\u6700\u521d\u7684\u6392\u5217$p_1,P-2,...,p_n$\u7531\u957f\u5ea6\u4e3a$l_1,l_2,...,l_k$\u7684$k$\u4e2a\u73af\u7ec4\u6210\uff0c\u5176\u4e2d$l_1+l_2+...l_k=n$\uff0c\u90a3\u4e48\u6700\u7ec8\u7b54\u6848\u5c31\u662f\n\n$$F_{l_1} \\ast F_{l_2} \\ast ... \\ast F_{l_k} \\ast \\dfrac{(n-k)!}{(l_1-1)! \\ast (l_2-1)! \\ast ... \\ast (l_k-1)!}$$\n\n\u56e0\u4e3a$10^9+9$\u662f\u4e00\u4e2a\u8d28\u6570\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u7528\u4e58\u6cd5\u9006\u5143\u7b97\u4e0a\u9762\u7684\u9664\u6cd5\uff0c\u6574\u4e2a\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(n^2)$\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u9012\u63a8\u51fa$F_n$\u7684\u524d\u51e0\u9879\u627e\u89c4\u5f8b\uff0c\u6570\u611f\u597d\u7684\u540c\u5b66\u5e94\u8be5\u53ef\u4ee5\u627e\u51fa\u89c4\u5f8b\uff0c\u6216\u8005\u628a\u524d\u51e0\u9879\u8f93\u5165\u5230$OEIS$\u7f51\u7ad9\u4e2d\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u5f97\u5230\u901a\u9879\u516c\u5f0f$F_n=n^{n-2}$\uff0c\u4ece\u800c\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u4f18\u5316\u5230$O(nlogn)$\u3002\n\n\u4ee3\u7801\u4e0d\u96be\uff0c\u6570\u5b66\u63a8\u7406\u96be\u3002\n# Code\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\nusing namespace std;\nconst int TT=1000000009,maxn=100005;\nint N,a[maxn],T,vis[maxn],cnt;\ntypedef long long LL;\nLL ans,Fc[maxn],F[maxn],size[maxn];\nint read(){\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') ret=ret*10+ch-'0',ch=getchar();\n\treturn ret*f; \n}\nLL Pow(LL a,LL b){\n\tLL w=a,s=1;\n\twhile(b){\n\t\tif(b&1)s=w*s%TT;\n\t\tw=w*w%TT;\n\t\tb>>=1;\n\t}\n\treturn s;\n}\nint main(){\n\tfreopen(\"P4778.in\",\"r\",stdin);\n\tfreopen(\"P4778.out\",\"w\",stdout);\n\tT=read();\n\tFc[0]=1;for(int i=1;i<maxn;i++)Fc[i]=Fc[i-1]*i%TT;\n\tF[1]=1;for(int i=2;i<maxn;i++)F[i]=Pow(i,i-2);\n\twhile(T--){\n\t\tN=read();\n\t\tfor(int i=1;i<=N;i++)a[i]=read();\n\t\tcnt=0;memset(vis,0,sizeof vis);\n\t\tint now_x;\n\t\tfor(int i=1;i<=N;i++)if(!vis[i]){\n\t\t\tnow_x=i;int num=0;\n\t\t\twhile(!vis[now_x]){vis[now_x]=1;now_x=a[now_x];num++;};\n\t\t\tsize[++cnt]=num;\n\t\t}\n\t\tans=Fc[N-cnt];\n\t\tfor(int i=1;i<=cnt;i++){\n\t\t\tLL inv=Pow(Fc[size[i]-1],TT-2);\n\t\t\tans=ans*F[size[i]]%TT*inv%TT;\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1603370000,
        "uid": 128822,
        "name": "OI\u754c\u7684\u5c0f\u6df7\u6df7",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4778 \u3010Counting swaps\u3011"
    },
    {
        "content": "\n\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e $i$ , \u6211\u4eec\u5411 $p_i$ \u8fde\u4e00\u6761\u8fb9\u3002 \u7ed3\u5408\u9898\u610f\u53ef\u77e5\uff0c\u4e00\u4e2a\u5408\u6cd5\u7684\u6392\u5217\uff0c\u662f\u4e00\u4e2a\u7531 $n$ \u4e2a\u81ea\u73af\u7ec4\u6210\u7684\u56fe\u3002\n\n\u4f46\u73b0\u5728\u4f1a\u5f62\u6210\u591a\u4e2a\u73af\uff0c\u4e0d\u59a8\u8bb0\u73af\u7684\u6570\u91cf\u4e3a $k$  \uff0c \u7b2c $i$ \u4e2a\u73af\u7684\u5927\u5c0f\u4e3a $s_i$\uff08\u5305\u62ec\u81ea\u73af\uff09\u3002\n\n\u6211\u4eec\u73b0\u5728\u8981\u505a\u7684\uff0c\u5c31\u662f\u5c06\u8fd9 $k$ \u4e2a\u73af\u62c6\u6210 $n$ \u4e2a\u81ea\u73af\u3002\n\n\u663e\u7136\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5927\u5c0f\u4e3a $s$ \u7684\u73af\uff0c\u62c6\u6210\u81ea\u73af\u81f3\u5c11\u9700\u8981 $s-1$\u6b21\u64cd\u4f5c\u3002\n\n\u8bb0 $w_n(x,y)$ , \u8868\u793a\u5c06 $n$ \u4e2a\u70b9\u7684\u73af \uff0c \u62c6\u6210 $x$ \u4e2a\u70b9\u7684\u73af + $y$\u4e2a\u70b9\u7684\u73af\u7684\u65b9\u6848\u6570\u3002\n\n\u663e\u7136\u6709 \n\n$$\nw_n(x,y)=\n\\begin{cases}\n\n\\frac{n}{2} & x=y\\\\\n\nn & x \\not= y\n\\end{cases}\n(x+y=n)\n$$\n\n\u8bb0 $f_n$ \u8868\u793a\u5927\u5c0f\u4e3a $n$ \u7684\u73af\u7684\u62c6\u5206\u65b9\u6848\u6570\uff08$f_1=1$\uff09 , \u5219\u6839\u636e\u591a\u91cd\u96c6\u7684\u6392\u5217\u516c\u5f0f\u5f97\uff1a\n\n$$\nf_n=\\sum_{x+y=n}^{x \\le\\frac{n}{2}}w_n(x,y) \\times f_x \\times f_y \\times \\frac{ (n-2)! }{(x-1)! (y-1)!}\n$$\n\n\u8fd9\u6837\u9012\u63a8\u7684\u590d\u6742\u5ea6\u662f $\\Theta(n^2)$ \u7684 \uff0c\u7ed9\u4e00\u4efd\u4ee3\u7801\uff1a\n\n```cpp\nf[ 1 ] = 1;\n\tfor( int i = 2 ; i <= MAXN ; i ++ ) {\n\t\tfor( int x = 1 ; x <= i / 2 ; x ++ ) {\n\t\t\tint y = i - x , t = x == y ? i / 2 : i;\n\t\t\tf[ i ] += t * f[ x ] * f[ y ] * ( Fac[ i - 2 ] / Fac[ x - 1 ] / Fac[ y - 1 ] );\n\t\t}\n\t\tprintf(\"%d %d\\n\", i , f[ i ] );\n\t}\n```\n\u7ecf\u8fc7~~\u627e\u89c4\u5f8b~~\uff0c\u6211\u4eec\u53d1\u73b0\uff0c$f_i=i^{i-2}$\uff0c\u73b0\u5728\u5c31\u53ef\u4ee5$\\Theta(nlogn)$\u6c42\u51fa$f_i$\u4e86\u3002\n\n\u7b54\u6848\u4e5f\u662f\u4e00\u4e2a\u591a\u91cd\u96c6\uff0c\u53ef\u4ee5\u7b80\u5355\u6c42\u51fa\n$$\nAns=(\\prod_{i=1}^k f[s_i]) \\times (\\frac{(n-k)!}{\\prod_{i=1}^k(s_i-1)!})\n$$\n\n```cpp\n#include <cstdio>\n#include <cstring>\nusing namespace std;\n#define Mod 1000000009\n\nconst int MAXN = 100000;\nint t , n , p[ MAXN + 5 ] , s[ MAXN + 5 ] , k;\nbool vis[ MAXN + 5 ];\n\nint Quick_pow( int x , int po ) {\n\tint Ans = 1;\n\twhile( po ) {\n\t\tif( po % 2 ) Ans = 1ll * Ans * x % Mod;\n\t\tx = 1ll * x * x % Mod;\n\t\tpo /= 2;\n\t}\n\treturn Ans;\n}\nint Inv( int x ) {\n\treturn Quick_pow( x , Mod - 2 );\n} \n\nint dfs( int u ) {\n\tif( vis[ u ] ) return 0;\n\tvis[ u ] = 1;\n\treturn dfs( p[ u ] ) + 1;\n}\n\nint f[ MAXN + 5 ] , Fac[ MAXN + 5 ] , InvFac[ MAXN + 5 ];\nvoid Init( ) {\n\tf[ 1 ] = 1;\n\tfor( int i = 2 ; i <= MAXN ; i ++ )\n\t\tf[ i ] = Quick_pow( i , i - 2 );\n\t\n\tFac[ 0 ] = 1; \n\tfor( int i = 1 ; i <= MAXN ; i ++ )\n\t\tFac[ i ] = 1ll * Fac[ i - 1 ] * i % Mod;\n\t\t\n\tInvFac[ MAXN ] = Inv( Fac[ MAXN ] );\n\tfor( int i = MAXN - 1 ; i >= 0 ; i -- )\n\t\tInvFac[ i ] = 1ll * InvFac[ i + 1 ] * ( i + 1 ) % Mod;\n}\nint main( ) {\n\tInit( ); \n\tscanf(\"%d\",&t);\n\twhile( t -- ) {\n\t\tk = 0;\n\t\tmemset( vis , 0 , sizeof( vis ) );\n\t\tmemset( s , 0 , sizeof( s ) );\n\t\t\n\t\tscanf(\"%d\",&n);\n\t\tfor( int i = 1 ; i <= n ; i ++ )\n\t\t\tscanf(\"%d\",&p[ i ]);\n\t\tfor( int i = 1 ; i <= n ; i ++ )\n\t\t\tif( !vis[ i ] ) s[ ++ k ] = dfs( i );\n\t\t\n\t\tint p1 = 1 , p2 = 1 , p3 = Fac[ n - k ];\n\t\tfor( int i = 1 ; i <= k ; i ++ ) {\n\t\t\tp1 = 1ll * p1 * f[ s[ i ] ] % Mod;\n\t\t\tp2 = 1ll * p2 * Fac[ s[ i ] - 1 ] % Mod;\n\t\t}\n\t\tprintf(\"%d\\n\", 1ll * p1 * Inv( p2 ) % Mod * p3 % Mod );\n\t}\n\treturn 0;\n} \n```\n",
        "postTime": 1573610196,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4778 \u3010Counting swaps\u3011"
    },
    {
        "content": "\u4e00\u9053\u7ecf\u5178\u597d\u9898\u3002\n\n\u9996\u5148\u628a $i$ \u5411 $a_i$ \u8fde\u8fb9\uff0c\u8fd9\u5c31\u8f6c\u5316\u6210\u4e86\u4e00\u4e2a\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u56fe\u662f\u7531\u82e5\u5e72\u4e2a\u73af\uff08\u53ef\u80fd\u5305\u62ec\u81ea\u73af\uff09\u7ec4\u6210\u7684\u3002\n\n\u6392\u5e8f\u540e\u7684\u5e8f\u5217\u8f6c\u5316\u6210\u7684\u56fe\u662f\u7531 $n$ \u4e2a\u81ea\u73af\u7ec4\u6210\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6bcf\u6b21\u64cd\u4f5c\uff0c\u5982\u679c\u4e24\u70b9\u5728\u4e00\u4e2a\u73af\u5185\uff0c\u5c31\u591a\u4e00\u4e2a\u73af\uff1b\u5426\u5219\uff0c\u5c31\u5c11\u4e00\u4e2a\u73af\u3002\u5982\u679c\u6211\u4eec\u73b0\u5728\u6709 $k$ \u4e2a\u73af\uff0c\u90a3\u81f3\u5c11\u64cd\u4f5c $n-k$ \u6b21\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u5355\u72ec\u8003\u8651\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5206\u88c2\u73af\u7684\u64cd\u4f5c\u5012\u8fc7\u6765\u5730\u770b\u6210\u5408\u5e76\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u6709\u4e86\u6811\u7684\u7ed3\u6784\uff0c\u4ed4\u7ec6\u5206\u6790\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\u6709\u6807\u53f7\u65e0\u6839\u6811\u7684\u6570\u91cf\uff0c\u5c31\u662f $len^{len-2}$\u3002\n\n\u7136\u540e\u8003\u8651\u6240\u6709\u7684\u73af\uff0c\u8fdb\u884c\u96c6\u5408\u6392\u5217\uff0c\u7b54\u6848\u5c31\u662f $\\prod {\\frac{len^{len-2}}{(len-1)!}} \\ \\times (n-k)!$\uff0c\u5176\u4e2d $len$ \u662f\u5404\u4e2a\u73af\u7684\u5927\u5c0f\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>inline void read(register T &x)\n{\n\tregister T p = 1,num = 0;\n\tchar c = getchar();\n\twhile(c < '0'||c > '9')\n\t{\n\t\tif(c == '-') p = -p;\n\t\tc = getchar();\n\t}\n\twhile('0' <= c&&c <= '9')\n\t{\n\t\tnum = (num<<3)+(num<<1)+(c^48);\n\t\tc = getchar();\n\t}\n\tx = p * num;\n}\ntemplate<typename T>inline void write(register T x)\n{\n\tif(x < 0) putchar('-'),x = -x;\n\tif(x > 9) write(x/10);\n\tputchar(x%10+48);\n}\n#define D(i,a,b) for(register int i=a;i>=b;--i)\n#define F(i,a,b) for(register int i=a;i<=b;++i)\n#define min(a,b) ((a<b)?a:b)\n#define max(a,b) ((a>b)?a:b)\n#define ll long long\n#define N 100010\nconst int mod = 1e9 + 9;\nll fac[N],inv[N],pw[N];\nint a[N],t,n;\nbitset<N> vis;\ninline ll qp(ll x,ll y)\n{\n\tll ret = 1;\n\twhile(y)\n\t{\n\t\tif(y & 1) ret = ret * x % mod;\n\t\tx = x * x % mod;\n\t\ty >>= 1;\t\n\t}\n\treturn ret;\n}\nint main()\n{\n\tfac[0] = fac[1] = inv[0] = inv[1] = 1ll;\n\tF(i,2,1e5) fac[i] = fac[i-1] * i % mod;\n\tF(i,2,1e5) inv[i] = 1ll * (mod - mod / i) * inv[mod % i] % mod;\n\tF(i,2,1e5) inv[i] = inv[i] * inv[i-1] % mod;\n\tpw[0] = pw[1] = pw[2] = 1ll;\n\tF(i,3,1e5) pw[i] = qp(i,i-2);\n\tread(t);\n\twhile(t--)\n\t{\n\t\tll ans = 1,k = 0;\n\t\tvis = 0;\n\t\tread(n);\n\t\tF(i,1,n) read(a[i]);\n\t\tF(i,1,n)\n\t\t{\n\t\t\tif(vis[i]) continue;\n\t\t\tint len = 0,p = i;\n\t\t\twhile(!vis[p]) vis[p] = 1,p = a[p],++len;\n\t\t\tans = ans * pw[len] % mod * inv[len-1] % mod;\n\t\t\t++k;\n\t\t}\n\t\tans = ans * fac[n-k] % mod;\n\t\twrite(ans);\n\t\tputchar('\\n');\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1674631840,
        "uid": 197648,
        "name": "Wangxun",
        "ccfLevel": 5,
        "title": "P4778 \u9898\u89e3"
    },
    {
        "content": "## \u505a\u6cd5\n\u7531$i$\u5411$p_i$\u8fde\u4e00\u6761\u8fb9\uff0c\u5f62\u6210\u4e86\u4e00\u4e9b\u73af\u3002\u6700\u7ec8\u72b6\u6001\u662f\u5f62\u6210$n$\u4e2a\u81ea\u73af\u3002\n\n\u7ed3\u8bba\uff1a\u5c06\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u73af\u62c6\u6210$n$\u4e2a\u81ea\u73af\uff0c\u81f3\u5c11\u9700\u8981$n-1$\u6b21\u64cd\u4f5c\u3002\n\n> \u5f53\u524d\u7684\u73af\u4e3a$p_1\\Rightarrow p_2\\Rightarrow p_3\\Rightarrow \u2026\\Rightarrow p_n\\Rightarrow p_1$\u3002\u4ea4\u6362$p_i$\u4e0e$p_j$\u540e\uff0c\u5f53\u524d\u7684\u73af\u53d8\u4e3a$p_1\\Rightarrow p_2\\Rightarrow \u2026\\Rightarrow p_i\\Rightarrow p_{i+1}\\Rightarrow \u2026\\Rightarrow p_n$\uff0c$p_j\\Rightarrow p_{j+1}\\Rightarrow \u2026\\Rightarrow p_{i-1}\\Rightarrow p_j$\u3002\u65b0\u5f62\u6210\u7684\u4e24\u4e2a\u73af\u7684\u957f\u5ea6\u5206\u522b\u4e3a$n-(j-i)$\uff0c$j-i$\u3002\u5c06\u8fd9\u4e24\u4e2a\u73af\u53d8\u4e3a\u81ea\u73af\u9700\u8981$n-(j-i)-1+(j-i)+1=n-2$\u6b21\uff0c\u52a0\u4e0a\u521a\u521a\u7684\u4e00\u6b21\u521a\u597d\u662f$n-1$\u6b21\u3002\n>\n> \uff08\u611f\u89c9\u8bc1\u7684\u4e0d\u592a\u4e25\u8c28????\uff09\n\n\u63a8\u8bba\uff1a\u5c06$k$\u4e2a\u603b\u957f\u5ea6\u4e3a$n$\u7684\u73af\u62c6\u6210$n$\u4e2a\u81ea\u73af\uff0c\u9700\u8981\u81f3\u5c11$n-k$\u6b21\u64cd\u4f5c\u3002\n\n\u5c06\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u73af\u62c6\u6210\u6210\u957f\u5ea6\u4e3a$x$\u548c\u957f\u5ea6\u4e3a$y$\u7684\u73af\u7684\u65b9\u6848\u6570$T(x,y)$\n\n> $x=y$,$n$\u4e3a\u5076\u6570\uff0c$\\frac{n}{2}$\n>\n> $x\\ne y$\u6216$n$\u4e3a\u5947\u6570\uff0c$n$\n\n\u5c06$F_n$\u8bb0\u4e3a\u5c06\u957f\u5ea6\u4e3a$n$\u7684\u73af\u62c6\u6210$n$\u4e2a\u81ea\u73af\u7684\u65b9\u6848\u6570\u3002\n\n$F_n=T(x,y)\\times F_x\\times F_y\\times \\frac{(n-2)!}{(x-1)!(y-1)!}=n^{n-2}\uff08\u627e\u89c4\u5f8b\uff09$\n\n> \u4e00\u5171\u6709$n-2$\u6b21\u64cd\u4f5c\uff0c$x-1$\u6b21\u62c6\u957f\u5ea6\u4e3a$x$\u7684\u5e8f\u5217\uff0c$y-1$\u6b21\u62c6\u957f\u5ea6\u4e3a$y$\u7684\u5e8f\u5217\uff0c\u53ef\u4ee5\u770b\u6210\u4e00\u4e2a\u7531$x-1$\u4e2a$0$\u548c$y-1$\u4e2a$1$\u7ec4\u6210\u7684\u96c6\u5408$S$\uff0c\u7531\u4e8e\u64cd\u4f5c\u7684\u987a\u5e8f\u53ef\u4ee5\u53d8\uff0c\u5b9e\u9645\u4e0a\u662f\u6c42$S$\u7684\u4e00\u4e2a\u5168\u6392\u5217\u6570\u3002\n\n\u6700\u7ec8\u7684\u7b54\u6848\u4e3a\uff1a\n\n$F_{l_1}*F_{l_2}*\u2026*F_{l_3}*\u2026*\\frac{(n-k)!}{(l_1-1)!(l_2-1)!(l_3-1)!\u2026}$\n\n## code\n```cpp\n#include<algorithm>\n#include<cstdio>\nusing namespace std;\nint const mod=1000000009;\ntypedef long long LL;\nint t,n;\nLL f[100101];\nLL fac[100101],inv[100101];\nbool vis[100101];\nint to[100101];\nint len,cnt,loop[100101];\nLL ans=1ll;\nvoid init(){\n    memset(vis,false,sizeof(false));\n    memset(to,0,sizeof(to));\n    memset(loop,0,sizeof(loop));\n    len=0;cnt=0;ans=1ll;\n}\nvoid dfs(int rt){\n    if(vis[rt]) return ;\n    ++len;\n    vis[rt]=true;\n    dfs(to[rt]);\n    \n}\nLL qpow(LL a,LL b,LL mod){\n    if(b<=0) return 1;\n    LL res=1ll;\n    while(b){\n        if(b&1) res=res*a%mod;\n        a=a*a%mod;\n        b>>=1;\n    }\n    return res%mod;\n}\nvoid pre_f(){\n    for(int i=1;i<=100000;i++)\n        f[i]=qpow(i,i-2,mod);\n}\nvoid pre_fac(){\n    fac[0]=1ll;\n    for(LL i=1ll;i<=100000;i++)\n        fac[i]=fac[i-1]*i%mod;\n    inv[100000]=qpow(fac[100000],mod-2,mod);\n    for(int i=100000;i>=1;i--)\n        inv[i-1]=inv[i]*i%mod;\n}\nvoid work(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++){\n        int num;scanf(\"%d\",&num);\n        to[num]=i;\n    }\n    for(int i=1;i<=n;i++){\n        if(!vis[i]){\n            len=0;dfs(i);\n            loop[++cnt]=len;\n        }\n    }\n    ans*=fac[n-cnt];\n    for(int i=1;i<=cnt;i++)\n        ans=(((ans*f[loop[i]])%mod)*inv[loop[i]-1])%mod;\n    printf(\"%lld\\n\",ans);\n}\nint main(){\n    pre_f();\n    pre_fac();\n    scanf(\"%d\",&t);\n    while(t--){\n        init();\n        work();\n    }\n    return 0;\n}\n```\n",
        "postTime": 1633682057,
        "uid": 392421,
        "name": "Rapunzel_Only",
        "ccfLevel": 0,
        "title": "Counting swaps"
    }
]