[
    {
        "content": "\u4e8c\u5206\u7b54\u6848\u3002\n\n\u539f\u5f0f \n$=(M(i,j)-mid\\times j)-(m(i,j)-mid\\times i)\\geq k\\times mid\\;\\;(j\\geq i)$\n\n\u7136\u540e\u5f3a\u5236 $j$ \u4e3a\u533a\u95f4\u6700\u5927\u503c\uff0c$i$ \u4e3a\u6700\u5c0f\u503c\uff0c\u5982\u679c $j$ \u4e0d\u662f\u6700\u5927\u503c\u6216 $i$ \u4e0d\u662f\u6700\u5c0f\u503c\uff0c\u5de6\u5f0f\u7684\u7b54\u6848\u90fd\u4f1a\u66f4\u5927\uff0c\u6240\u4ee5\u5982\u679c\u539f\u5f0f\u6210\u7acb\u5c31\u6210\u7acb\uff0c\u7136\u540e\u679a\u4e3e $j$\uff0c\u7ef4\u62a4\u6700\u5c0f\u7684 $(a_i-mid\\times i)$ \u5373\u53ef\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u679a\u4e3e\u7684\u60c5\u51b5\u662f\u6700\u5c0f\u503c\u5728\u5de6\u6700\u5927\u503c\u5728\u53f3\u7684\u60c5\u51b5\uff0c\u53e6\u4e00\u79cd\u60c5\u51b5\u540c\u7406\u5904\u7406\u5373\u53ef\u3002\n\n\u7136\u540e\u6709\u4e00\u4e2a\u7279\u6b8a\u60c5\u51b5\uff0c\u5c31\u662f $i$ \u4e3a $j$ \u7684\u6700\u4f18\u5de6\u7aef\u70b9\u65f6\uff0c\u4f46\u533a\u95f4\u6700\u5c0f\u503c\u4e0d\u662f $i$ \uff0c\u6700\u5c0f\u503c\u4e0d\u5728 $j$ \u7684\u5408\u6cd5\u8303\u56f4\u5185\u3002\n\n\u56e0\u4e3a\u6700\u5c0f\u503c\u4e0d\u5728j\u7684\u5408\u6cd5\u8303\u56f4\uff0c\u4f46\u662f\u53d6\u5b8c $i$~$j$ \u662f\u5408\u6cd5\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u80fd\u4f1a\u628a\u8fd9\u79cd\u60c5\u51b5\u5f04\u6210\u4e0d\u5408\u6cd5\u3002\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa\u6240\u6709\u957f\u5ea6\u4e3aL-1\u7684\u65b9\u6848\u7684\u7b54\u6848\uff0c\u7136\u540e\u4e0e\u603b\u7b54\u6848\u6bd4\u8f83\u5373\u53ef\u3002\n\n```cpp\n#include<cstdio>\n#define max(x,y) (x>y?x:y)\nusing namespace std;\nint t,L,R,n,k,a[50001],head,tail,q[50001],heada,headb,taila,tailb,qa[50001];\nint qb[50001];\ndouble l,r,mid,ans1,ans;\ndouble pd(double mid)\n{\n\thead=1;tail=0;ans=-0x3FFFFFFF;\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tif (i>=L)\n\t\t{\n\t\t\tint t=i-L+1;\n\t\t\twhile (head<=tail&&a[t]-mid*t<=a[q[tail]]-mid*q[tail]) tail--;\n\t\t\tq[++tail]=t;\n\t\t}\n\t\tif (head<=tail&&q[head]<i-R+1) head++;\n\t\tif (head<=tail) ans=max(ans,a[i]-i*mid-(a[q[head]]-mid*q[head]));\n\t}\n\tfor (int i=1;i<=n;i++)\n\t\ta[i]=-a[i];\n\thead=1;tail=0;\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tif (i>=L)\n\t\t{\n\t\t\tint t=i-L+1;\n\t\t\twhile (head<=tail&&a[t]-mid*t<=a[q[tail]]-mid*q[tail]) tail--;\n\t\t\tq[++tail]=t;\n\t\t}\n\t\tif (head<=tail&&q[head]<i-R+1) head++;\n\t\tif (head<=tail) ans=max(ans,a[i]-i*mid-(a[q[head]]-mid*q[head]));\n\t}\n\tfor (int i=1;i<=n;i++)\n\t\ta[i]=-a[i];\n\treturn ans;\n}\nint main()\n{\n\tscanf(\"%d\",&t);\n\twhile (t--)\n\t{\n\t\tscanf(\"%d%d%d%d\",&n,&k,&L,&R);\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tscanf(\"%d\",&a[i]);\n\t\tans1=0;heada=1;taila=0;headb=1;tailb=0;\n\t\tfor (int i=1;i<=n;i++)\n\t\t{\n\t\t\twhile (heada<=taila&&a[i]>=a[qa[taila]]) taila--;\n\t\t\tqa[++taila]=i;\n\t\t\twhile (headb<=tailb&&a[i]<=a[qb[tailb]]) tailb--;\n\t\t\tqb[++tailb]=i;\n\t\t\tif (heada<=taila&&i-qa[heada]>=L-1) heada++;\n\t\t\tif (headb<=tailb&&i-qb[headb]>=L-1) headb++;\n\t\t\tans1=max(ans1,(double)(a[qa[heada]]-a[qb[headb]])/(L-1+k));\n\t\t}\n\t\tl=0;r=1e3;\n\t\twhile (l+0.000001<r)\n\t\t{\n\t\t\tmid=(l+r)/2;\n\t\t\tif (pd(mid)>=k*mid) l=mid;\n\t\t\telse r=mid;\n\t\t}\n\t\tprintf(\"%.4lf\\n\",max(l,ans1));\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1582208830,
        "uid": 157857,
        "name": "ImmortalWatcher",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6087 \u3010[JSOI2015]\u9001\u793c\u7269\u3011"
    },
    {
        "content": "### [P6087 [JSOI2015]\u9001\u793c\u7269](https://www.luogu.com.cn/problem/P6087)\n\n>\u7ed9\u4f60\u4e00\u4e2a\u5e8f\u5217\uff0c\u6c42\u533a\u95f4\u957f\u5ea6\u5728$[L,R]$\u4e4b\u95f4\u7684\u7f8e\u89c2\u5ea6\u6700\u5927\uff0c\u533a\u95f4$[l,r]$\u7684\u7f8e\u89c2\u5ea6\u4e3a$\\dfrac{\\max_{i=l}^{r}a_i-\\min_{i=l}^{r}a_i}{r-l+k}$\u3002\n\n\u5efa\u8bae\u770b\u770b\u6211\u7684[01\u5206\u6570\u89c4\u5212\u5b66\u4e60\u7b14\u8bb0](https://www.luogu.com.cn/blogAdmin/article/edit/333789)\u6548\u679c\u66f4\u4f73\u3002\n\n\n\u5f53\u770b\u5230\u6c42\u4e00\u4e2a**\u5206\u5f0f\u7684\u6700\u5927\u503c**\u65f6\uff0c\u7b2c\u4e00\u65f6\u95f4\u60f3\u5230**\u5206\u6570\u89c4\u5212**\uff0c\u4f46\u8fd9\u9053\u9898\u4e0e\u666e\u901a\u7684\u5206\u6570\u89c4\u5212\u4e0d\u4e00\u6837\uff0c\u4e0d\u80fd\u76f4\u63a5\u5b9a\u4e49\u6743\u503c\uff0c\u56e0\u4e3a\u533a\u95f4\u6700\u5927/\u5c0f\u503c(\u5206\u5b50)\u4e0e\u533a\u95f4\u8fb9\u754c(\u5206\u6bcd)**\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb**\u3002\n\n\u5bf9\u4e8e\u6700\u5927/\u5c0f\u503c\u5728\u533a\u95f4\u5185\u90e8\u7684\uff0c\u7f29\u5c0f\u533a\u95f4\u957f\u5ea6\u53ea\u4f1a\u4f7f\u7b54\u6848\u66f4\u4f18\u3002\u90a3\u4e48\u6211\u4eec\u5c1d\u8bd5\u5c06\u6700\u5927/\u5c0f\u503c\u653e\u5230\u533a\u95f4\u7684\u8fb9\u754c\u4e0a\uff0c\u5219\u7f8e\u89c2\u5ea6\u53ef\u4ee5\u53d8\u4e3a$\\dfrac{\\left|a[r]-a[l]\\right|}{r-l+k}$\uff0c\u4f46\u4e0d\u8fc7\u8fd9\u6837\u53ef\u80fd\u6ee1\u8db3\u4e0d\u4e86$r-l+1\\ge L$\u7684\u9650\u5236\u3002\u6211\u4eec\u53ef\u4ee5\u5148\u5c06\u5c0f\u4e8e$L$\u5904\u7406\u6389\uff0c\u518d\u5904\u7406\u5927\u4e8e\u7684\u3002\n\n\u5bf9\u4e8e\u4e00\u7ec4\u6700\u5927\u6700\u5c0f\u503c\u8ddd\u79bb\u5c0f\u4e8e$L$\u7684\uff0c\u6211\u4eec\u5c06\u957f\u5ea6\u76f4\u63a5\u6269\u5c55\u5230$L$\u662f\u6700\u4f18\u7684\uff0c\u90a3\u4e48\u5206\u6bcd\u5c31\u786e\u5b9a\u4e3a$L-1+k$\uff0c\u95ee\u9898\u5c31\u53d8\u4e3a\u6c42$L$\u4e2a\u8fde\u7eed\u7684\u6570\u4e2d\u7684\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\uff0c\u662f[\u5355\u8c03\u961f\u5217\u7684\u6a21\u677f\u9898](https://www.luogu.com.cn/problem/P1886)\u3002\n\n\u5bf9\u4e8e\u957f\u5ea6\u5927\u4e8e$L$\u7684\u533a\u95f4\uff0c\u6211\u4eec\u901a\u8fc7$01$\u5206\u6570\u89c4\u5212\uff0c\u4e8c\u5206\u4e00\u4e2a\u7b54\u6848$mid$\uff0c\u5bf9\u5f0f\u5b50$\\dfrac{\\left|a[r]-a[l]\\right|}{r-l+k}\\ge mid$\u8fdb\u884c\u63a8\u5bfc\u3002\n\n\u5f53$a[r]>a[l]$\uff0c$(a[r]-r*mid)-(a[l]-l*mid)\\ge k*mid$\n\n\u5f53$a[r]<a[l]$\uff0c$(a[l]+l*mid)-(a[r]+r*mid)\\ge k*mid$\n\n\u7531\u533a\u95f4\u957f\u5ea6\u5c0f\u4e8e$L$\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u7528\u5355\u8c03\u961f\u5217\u6765\u5904\u7406\u3002\n\n\u5f53$a[r]>a[l]$\uff0c$l$\u4ece1\u5f00\u59cb\uff0c$r$\u4ece$L$\u5f00\u59cb\uff0c\u7ef4\u62a4$(a[l]-l*mid)$\u5355\u8c03\u9012\u51cf\uff0c\u5f53\u961f\u5934\u8ddd\u79bb$i$\u5927\u4e8e$R$\u65f6\u5f39\u51fa\uff0c\u6bcf\u6b21\u4ece\u961f\u5c3e\u52a0\u5165$a[i-L+1]$\uff0c\u5f53$(a[i]-i*mid)-(a[q[h]]-q[h]*mid)\\ge k*mid$\u6210\u7acb\u65f6\uff0c\u5f53\u524d$mid$\u53ef\u4ee5\u3002\n\n\u5f53$a[r]<a[l]$\uff0c\u7ef4\u62a4$(a[l]-l*mid)$\u5355\u8c03\u9012\u589e\uff0c\u5f53$(a[q[h]]-q[h]*mid)-(a[i]-q[i]*mid)\\ge k*mid$\u6210\u7acb\u65f6\uff0c\u5f53\u524d$mid$\u53ef\u4ee5\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define N 50010\nusing namespace std;\ninline int read(){\n\tint w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9') ch=getchar();\n\twhile(ch<='9'&&ch>='0'){\n\t\tw=(w<<3)+(w<<1)+(ch^48);\n\t\tch=getchar();\n\t}\n\treturn w;\n}\nint t,n,L,R;\ndouble a[N],k;\ninline double pre(){\n\tdouble res=0;\n\tint he1=1,he2=1,ta1=0,ta2=0,q1[N],q2[N];\n\tfor(int i=1;i<L;i++){\n\t\twhile(he1<=ta1&&a[i]>=a[q1[ta1]]) ta1--; \n\t\twhile(he2<=ta2&&a[i]<=a[q2[ta2]]) ta2--;\n\t\tq1[++ta1]=i;q2[++ta2]=i;\n\t}\n\tfor(int i=L;i<=n;i++){\n\t\twhile(he1<=ta1&&a[i]>=a[q1[ta1]]) ta1--; \n\t\twhile(he2<=ta2&&a[i]<=a[q2[ta2]]) ta2--;\n\t\tq1[++ta1]=i;q2[++ta2]=i;\n\t\twhile(he1<=ta1&&i-q1[he1]>=L) he1++;\n\t\twhile(he2<=ta2&&i-q2[he2]>=L) he2++;\n\t\tres=max(res,(a[q1[he1]]-a[q2[he2]])/(double)(L-1+k));\n\t}\n\treturn res;\n}\ninline bool check(double x){\n\tdouble c[N];\n\tint he=1,ta=0,q[N];\n\tmemset(q,0,sizeof(q));\n\tfor(int i=1;i<=n;i++) c[i]=a[i]-x*(double)i;\n\tfor(int i=L;i<=n;i++){\n\t\twhile(he<=ta&&i-q[he]>=R) he++;\n\t\twhile(he<=ta&&c[i-L+1]<=c[q[ta]]) ta--;\n\t\tq[++ta]=i-L+1;\n\t\tif(c[i]-c[q[he]]>=x*k) return 1;\n\t}\n\the=1;ta=0;\n\tmemset(q,0,sizeof(q));\n\tfor(int i=1;i<=n;i++) c[i]=a[i]+x*(double)i;\n\tfor(int i=L;i<=n;i++){\n\t\twhile(he<=ta&&i-q[he]>=R) he++;\n\t\twhile(he<=ta&&c[i-L+1]>=c[q[ta]]) ta--;\n\t\tq[++ta]=i-L+1;\n\t\tif(c[q[he]]-c[i]>=x*k) return 1;\n\t}\n\treturn 0;\n}\ninline double work(){\n\tdouble l=0,r=1e3,mid,eps=1e-7;\n\twhile(r-l>eps){\n\t\tmid=(l+r)/2.0;\n\t\tif(check(mid)) l=mid;\n\t\telse r=mid;\n\t}\n\treturn max(l,pre());\n}\nint main(){\n\tt=read();\n\twhile (t--){\n\t\tn=read();k=read();L=read();R=read();\n\t\tfor(int i=1;i<=n;i++) a[i]=read();\n\t\tprintf(\"%.4lf\\n\",work());\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1621089509,
        "uid": 56835,
        "name": "CJzjy",
        "ccfLevel": 0,
        "title": "P6087"
    },
    {
        "content": "\u5bf9\u4e8e\u8fd9\u79cd\u5206\u5f0f\u6c42\u6700\u503c\uff0c\u53ef\u4ee5\u8003\u8651\u7528 01\u5206\u6570\u89c4\u5212\u3002\n\n\u8bbe\n$$\n\\frac{\\max\\{i,j\\}-\\min\\{i,j\\}}{i-j+k} \\leq V \\qquad (L \\leq i-j+1\\leq R)\n$$\n\u8fd9\u91cc\u56e0\u4e3a\u6211\u4eec\u4e00\u822c\u5916\u5c42\u679a\u4e3e\u7684\u53d8\u91cf\u4e3a $i$\uff0c\u6240\u4ee5\u6211\u628a\u539f\u9898\u4e2d$i$ $j$\u4ea4\u6362\u4e86\u3002\n$$\n\\max\\{i,j\\}-\\min\\{i,j\\} -iV +jV\\leq kV\n$$\n\u533a\u95f4\u4e2d\u53d6\u6700\u503c\uff0c\u4e0d\u592a\u597d\u5904\u7406\uff0c\u8003\u8651\u5982\u4f55\u505a\u4e00\u4e2a\u66ff\u6362\u3002\n\n\u5206\u8ba8\uff0c\n\n1. \u6700\u5927\u6700\u5c0f\u503c\u8ddd\u79bb\u4e0d\u8d85\u8fc7 $L$ \uff0c\u53ef\u4ee5\u8003\u8651\u53d6\u51fa\u6bcf\u4e00\u6bb5$L$\u533a\u95f4\u4e2d\u7684\u6700\u503c\uff0c\u76f4\u63a5\u8ba1\u7b97\u51fa\u503c$\\frac{\\max-\\min}{L-1+k}$\u3002\n\n2. \u8ddd\u79bb\u5927\u4e8e$L$\u3002$\\max \\min$\u4ecd\u7136\u4e0d\u597d\u5728\u4e0d\u679a\u4e3e $j$ \u7684\u60c5\u51b5\u4e0b\u786e\u5b9a\u3002\u3002\u8003\u8651\u76f4\u63a5\u8ba4\u4e3a $a_i$, $a_j$ \u662f\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u65b9\u4fbf\u5730\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u3002\u663e\u7136\u8fd9\u6837\u4f1a\u6709\u5f88\u591a\u503c\u662f\u9519\u8bef\u7684\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u60f3\u4e00\u60f3\uff0c\u8fd9\u4e9b\u9519\u89e3\u548c\u6b63\u786e\u7684\u503c\u662f\u4e0d\u662f\u5b58\u5728\u67d0\u79cd\u5173\u7cfb\uff1f  \n$$\na_i-a_j-iV+jV\\leq kV \\qquad a_i\\text{\u4e3a\u6700\u5927\u503c}\n$$\n$$\na_j-a_i-iV+jV\\leq kV \\qquad a_j\\text{\u4e3a\u6700\u5927\u503c}\n$$\n\n\u7a0d\u52a0\u601d\u8003\u53d1\u73b0\uff0c\u5f53$a_i$ $a_j$ \u5e76\u4e0d\u662f\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u65f6\uff0c\u5de6\u8fb9\u7684\u503c\u53ea\u4f1a\u5c0f\u4e8e\u6b63\u786e\u7684\u503c\uff0c\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e24\u7aef\u5747\u4e3a\u6700\u503c\u7684\u60c5\u51b5\u90fd\u80fd\u53d6\u5230\uff08\u6307\u8ddd\u79bb\u5927\u4e8e $L$ \u7684\uff09\u3002  \n\n\u56e0\u6b64\u5f97\u51fa\u7ed3\u8bba\uff0c\u8fd9\u6837\u867d\u7136\u8fc7\u7a0b\u4e2d\u4f1a\u6709\u9519\u89e3\uff0c\u4f46\u4e0d\u5f71\u54cd\u53d6\u5230\u6b63\u786e\u7b54\u6848\u3002\n\n\n\u56de\u8fc7\u53bb\u601d\u8003\uff0c\u53d1\u73b0\u5176\u5b9e\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e5f\u80fd\u7528\u8fd9\u6837\u65b9\u5f0f\u5904\u7406\uff0c\u65e0\u7591\u65b9\u4fbf\u4e86\u6c42\u89e3\u3002\n\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\ninline double max(double a, double b) { return a < b ? b : a; }\nint n = 0, k = 0, L = 0, R = 0;\nint a[50003];\ndouble dl[50003];\nint id[50003], l = 1, r = 0;\ninline void push(int pos, double val) { //\u6700\u5927\u503c\n\twhile (l <= r && dl[r] <= val)\n\t\t--r;\n\t++r;\n\tdl[r] = val;\n\tid[r] = pos;\n}\ninline void push2(int pos, double val) { //\u6700\u5c0f\u503c\n\twhile (l <= r && dl[r] >= val)\n\t\t--r;\n\t++r;\n\tdl[r] = val;\n\tid[r] = pos;\n}\ninline void pop(int limit) {\n\twhile (l <= r && id[l] <= limit)\n\t\t++l;\n}\nbool check(double V) {\n\t// Max{i,j} - jV - Min{i,j} + vi - kv >= 0 ?\n\tdouble ans = -1e5;\n\t// a[i] \u4e3a\u6700\u5927\u503c\n\tl = 1;\n\tr = 0;\n\tfor (int i = L; i <= n; ++i) {\n\t\tpush(i - L + 1, -a[i - L + 1] + (i - L + 1) * V);\n\t\tpop(i - R);\n\t\tif (l <= r) ans = max(ans, dl[l] + a[i] - i * V);\n\t}\n\t// a[i] \u4e3a\u6700\u5c0f\u503c\n\tl = 1;\n\tr = 0;\n\tfor (int i = L; i <= n; ++i) {\n\t\tpush(i - L + 1, +a[i - L + 1] + (i - L + 1) * V);\n\t\tpop(i - R);\n\t\tif (l <= r) ans = max(ans, dl[l] - a[i] - i * V);\n\t}\n\treturn ans >= V * k;\n}\ndouble inRangeAnswer() {\n\tdouble ans = -1e5;\n\tl = 1; r = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tpush(i, a[i]);\n\t\tpop(i - L);\n\t\tans = max(ans, (dl[l] - a[i]) / (L - 1 + k));\n\t}\n\tl = 1; r = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tpush2(i, a[i]);\n\t\tpop(i - L);\n\t\tans = max(ans, (a[i] - dl[l]) / (L - 1 + k));\n\t}\n\treturn ans;\n}\nint main() {\n\tint T = 0;\n\tscanf(\"%d\", &T);\n\tfor (int t = 1; t <= T; ++t) {\n\t\tscanf(\"%d%d%d%d\", &n, &k, &L, &R);\n\t\tfor (int i = 1; i <= n; ++i)\n\t\t\tscanf(\"%d\", a + i);\n\t\tdouble l = 0.0, r = 1000.0, mid = 0.0;\n\t\twhile (r - l > 0.000001) {\n\t\t\tmid = 0.5 * (l + r);\n\t\t\tif (check(mid))\n\t\t\t\tl = mid;\n\t\t\telse\n\t\t\t\tr = mid;\n\t\t}\n\t\tprintf(\"%.4lf\\n\", max(l,inRangeAnswer()));\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1595560724,
        "uid": 128771,
        "name": "\u738b\u9cb2\u9e4f",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6087 \u3010[JSOI2015]\u9001\u793c\u7269\u3011"
    },
    {
        "content": "### [P6087 [JSOI2015]\u9001\u793c\u7269](https://www.luogu.com.cn/problem/P6087)\n\n\u4e8c\u5206 $mid$\uff0c\u5217\u51fa\u5f0f\u5b50 $M(i,j)-m(i,j)-(j-i+K)\\times mid<0$\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u662f\u5982\u4f55\u6c42\u89e3\u6700\u5927\u7684 \n\n$M(i,j)-m(i,j)-(j-i+K)\\times mid$\n\n\u53d1\u73b0\u4e0d\u592a\u597d\u89e3\u51b3\uff0c\u6211\u4eec\u62c6\u89e3\u4e00\u4e0b\u3002\n\n$M(i,j)-m(i,j)-j\\times mid+i\\times mid-K\\times mid$\n\n\u6211\u4eec\u5148\u5047\u8bbe\u6ca1\u6709\u957f\u5ea6\u5728 $L\\sim R$ \u7684\u9650\u5236\uff0c\u8003\u8651\u4e00\u4e2a\u663e\u7136\u7684\u4e8b\u5b9e\uff0c\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u4e00\u5b9a\u5728\u533a\u95f4\u7684\u6700\u5de6\u8fb9\u548c\u6700\u53f3\u8fb9\uff0c\u5426\u5219\u4e0d\u662f\u6700\u4f18\u7684\u3002\n\n\u6211\u4eec\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n-  \u6700\u5c0f\u503c\u5728\u53f3\u8fb9\uff0c\u6700\u5927\u503c\u5728\u5de6\u8fb9\uff1a\n\n\u9898\u76ee\u8f6c\u5316\u4e3a\u6c42 $a_l+l\\times mid-a_r-r\\times mid$ \u6700\u5927\uff0c$K$ \u4e3a\u5e38\u6570\uff0c\u6682\u65f6\u5ffd\u7565\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u628a $i$ \u7684\u4ee3\u4ef7\u89c6\u4e3a $a_i+i\\times mid$ \u627e\u5230\u6700\u5c0f\u548c\u6700\u5927\u7684\u6743\u503c\u5373\u53ef\u3002\n\n\u53ef\u662f\u4ed6\u6709 $L\\sim R$ \u7684\u8303\u56f4\u54ce\uff0c\u4e0d\u597d\u641e\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u4e00\u4e2a\u5de6\u7aef\u70b9\u4e3a $i$\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u6c42\u51fa $i+L-1\\sim i+R-1$ \u8303\u56f4\u5185\u7684\u6700\u5c0f\u503c\u5c31\u884c\u3002\u5982\u4f55\u6c42\u8fd9\u4e2a\uff1f\u5f53\u7136\u53ef\u4ee5\u7ebf\u6bb5\u6811\uff0c\u4f46\u662f\u6211\u4eec\u6ce8\u610f\u5230\u6211\u4eec\u662f\u6c42\u56fa\u5b9a\u957f\u5ea6\u7684\u6700\u5927\u503c\uff0c\u5e76\u4e14\u8981\u6c42 $n$ \u6b21\uff0c\u6bcf\u6b21\u5411\u5de6\u79fb\u52a8\u4e00\u4f4d\uff0c\u8fd9\u662f\u4ec0\u4e48\uff1f**\u5355\u8c03\u961f\u5217\uff01**\n\n\u95ee\u9898\u5c31\u7b80\u5355\u4e86\uff0c\u5355\u8c03\u961f\u5217\u76f4\u63a5\u6c42\u89e3\u5373\u53ef\u3002\n\n- \u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u4ea4\u6362\u4f4d\u7f6e\u540c\u7406\uff0c\u53ef\u4ee5\u7b97\u51fa $i$ \u7684\u6743\u503c\u5e94\u8be5\u4e3a $a_i-i\\times mid$\u3002\n\n\u8fd8\u8981\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282\uff0c\u5f53\u6211\u4eec\u8981\u627e\u7684 $j$ \u548c $i$ \u7684\u8ddd\u79bb\u5c0f\u4e8e $L$ \u5c31\u4e00\u5b9a\u4e0d\u884c\u5417\uff1f\n\n\u8fd9\u662f\u6211\u4eec\u53ef\u4ee5\u591a\u9009\u51e0\u4e2a\u51d1\u6570\u5230 $L$ \u4e2a\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u4e5f\u5355\u72ec\u7528\u5355\u8c03\u961f\u5217\u6c42\u89e3\u3002\n\n\u7ec6\u8282\u86ee\u591a\u7684\uff0c\u53ef\u4ee5\u770b\u770b\u4ee3\u7801\u3002\n\n### $\\text{CODE}$\n```cpp\n#include<bits/stdc++.h>\n#define N 1000006\nusing namespace std;\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nconst double eps=1e-6;\nconst int inf=1e9;\nint t,n,k,L,R,len;\ndouble val[N],a[N];\ndeque<int> q,p;\ndouble solve1()\n{\n\tdouble ans=-inf;len=R-L+1;\n\twhile(q.size())q.pop_back();\n\tfor(int i=L;i<=R;i++)\n\t{\n\t\twhile(q.size()&&val[q.back()]>val[i])q.pop_back();\n\t\tq.push_back(i);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(q.size()&&q.front()-i<L-1)q.pop_front();\n\t\tans=max(ans,val[i]-val[q.front()]);\n\t\twhile(q.size()&&val[q.back()]>val[R+i])q.pop_back();\n\t\tq.push_back(R+i);\n\t}\n\treturn ans;\n}\ndouble solve2()\n{\n\tdouble ans=-inf;len=R-L+1;\n\twhile(q.size())q.pop_back();\n\tfor(int i=L;i<=R;i++)\n\t{\n\t\twhile(q.size()&&val[q.back()]<val[i])q.pop_back();\n\t\tq.push_back(i);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(q.size()&&q.front()-i<L-1)q.pop_front();\n\t\tans=max(ans,val[q.front()]-val[i]);\n\t\twhile(q.size()&&val[q.back()]<val[R+i])q.pop_back();\n\t\tq.push_back(R+i);\n\t}\n\treturn ans;\n}\ndouble solve3(double mid)\n{\n\tdouble ans=-inf;len=L-1;\n\twhile(q.size())q.pop_back();\n\twhile(p.size())p.pop_back(); \n\tfor(int i=1;i<len;i++)\n\t{\n\t\twhile(q.size()&&val[q.back()]<val[i])q.pop_back();\n\t\tq.push_back(i);\n\t\twhile(p.size()&&val[p.back()]>val[i])p.pop_back();\n\t\tp.push_back(i);\n\t}\n\tfor(int i=len;i<=n;i++)\n\t{\n\t\twhile(q.size()&&val[q.back()]<val[i])q.pop_back();\n\t\tif(q.size()&&i-q.front()>=len)q.pop_front();\n\t\tq.push_back(i);\n\t\twhile(p.size()&&val[p.back()]>val[i])p.pop_back();\n\t\tif(p.size()&&i-p.front()>=len)p.pop_front();\n\t\tp.push_back(i);\n\t\tans=max(ans,val[q.front()]-val[p.front()]);\n\t}\n\treturn ans-mid*(L-1);\n}\nbool check(double mid)\n{\n\tdouble ans=-inf;\n\tfor(int i=1;i<=n;i++)val[i]=a[i]+mid*i;\n\tfor(int i=1;i<=n;i++)val[i+n]=inf;\n\tans=max(ans,solve1());\n\tfor(int i=1;i<=n;i++)val[i]=a[i]-mid*i;\n\tfor(int i=1;i<=n;i++)val[i+n]=-inf;\n\tans=max(ans,solve2());\n\tfor(int i=1;i<=n;i++)val[i]=a[i];\n\tans=max(ans,solve3(mid));\n\treturn ans-mid*k>0;\n}\nint main()\n{\n\tt=read();\n\twhile(t--)\n\t{\n\t\tn=read();k=read();L=read();R=read();\n\t\tfor(int i=1;i<=n;i++)a[i]=read();\n\t\tdouble l=0,r=1e3,mid;\n\t\twhile(r-l>eps)\n\t\t{\n\t\t\tmid=(l+r)/2.0;\n\t\t\tif(check(mid))l=mid;\n\t\t\telse r=mid;\n\t\t}\n\t\tprintf(\"%.4f\\n\",r);\n\t}\n\treturn 0;\n}\n```\n\n\u5bb9\u6613 `TLE` \uff0c\u5f00 $O_2$ \u80fd\u8fc7\u3002",
        "postTime": 1673748232,
        "uid": 331947,
        "name": "hegm",
        "ccfLevel": 0,
        "title": "P6087 [JSOI2015]\u9001\u793c\u7269 \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6087)\n\n\u5927\u6982\u9898\u610f\uff1a\u627e\u51fa\u4e00\u4e2a\u533a\u95f4\uff0c$len \\in [L,R]$\uff0c\u4f7f\u5f97\u533a\u95f4\u5185\u6781\u503c\u5dee\u4e0e $len+1+k$ \u6bd4\u503c\u6700\u5927\uff0c\u8f93\u51fa\u6700\u5927\u6bd4\u503c\u3002\n\n**\u7b54\u6848\u6709\u4e24\u79cd\u53ef\u80fd\uff0c\u4e00\u79cd\u662f\u6781\u503c\u4e3a\u533a\u95f4\u5de6\u53f3\u7aef\u70b9\uff1b\u53e6\u4e00\u79cd\u662f\u6781\u503c\u4e4b\u95f4\u8ddd\u79bb\u5c0f\u4e8e $L$\uff0c\u9700\u8981\u5728\u5de6\u53f3\u4fa7\u52a0\u5165\u5176\u4ed6\u7aef\u70b9\u6765\u4fdd\u8bc1\u533a\u95f4\u5408\u6cd5\u3002**\n\n\u4e3b\u51fd\u6570\uff1a\u5bf9 $E$ \u4e8c\u5206\u7b54\u6848\uff0c\u5c06\u4e8c\u5206\u51fa\u7684\u7b54\u6848\u4e0e\u8ba1\u7b97\u5f53 $r-l+1=L$ \u7684\u60c5\u51b5\u4e0b\u7684\u7b54\u6848\u53d6\u6700\u5927\u503c\u3002\n\n\n------------\n\n### check\uff1a\n\n\u8d2a\u5fc3\u8ba1\u7b97\u5f53\u6781\u503c\u5728\u5de6\u53f3\u7aef\u70b9\u7684\u533a\u95f4\u3002\n\n\u63a8\u5f0f\u5b50\uff1a\n\n$a_{max} -a_{min} \\ge x(r-l+k)$\n\n$a_{max} -a_{min} -xr +xl \\ge xk$\n\n\u4ee3\u7801\u4e2d $ans$ \u7ef4\u62a4\u7684\u5373\u4e3a $a_{max} -a_{min} -xr +xl$ \u7684\u6700\u5927\u503c\u3002\n\n\u628a\u66f4\u65b0 $ans$ \u7684\u6570\u503c\u62c6\u6210\u4e24\u6bb5\uff0c\u5de6\u7aef\u70b9\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\uff0c\u53f3\u7aef\u70b9\u679a\u4e3e\u3002\u5bf9\u4e8e\u533a\u95f4\u957f\u5ea6\u7684\u9650\u5236\uff0c\u901a\u8fc7\u5355\u8c03\u961f\u5217\u5b9e\u73b0\u3002\n\n\u518d\u8bf4\u5355\u8c03\u961f\u5217\u52a0\u5165\u7684\u6743\u503c\u3002\u7ef4\u62a4\u7684\u6743\u503c\uff0c\u4ee5\u5de6\u7aef\u70b9\u4e3a\u6700\u5927\u503c\u4e3a\u4f8b\uff0c\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u7684\u662f $a_{min}+xr$ \u7684\u6700\u5c0f\u503c\u3002\u63a5\u4e0b\u6765\u7b54\u6848\u7684\u5904\u7406\u5c31\u76f4\u63a5\u770b\u4ee3\u7801\u5427\uff0c\u76f8\u4fe1\u90fd\u80fd\u770b\u61c2\u4e86\u3002\n\n\u503c\u5f97\u4e00\u63d0\u7684\u662f\u5355\u8c03\u961f\u5217\u8bbe\u5b9a $len$ \u6570\u503c\uff0c\u5e94\u4e3a $R-L+1$\uff0c\u56e0\u4e3a\u5f53\u786e\u5b9a\u5de6\u7aef\u70b9  $i$\uff0c\u901a\u8fc7\u5355\u8c03\u961f\u5217\u5bfb\u627e\u6700\u4f18\u53f3\u7aef\u70b9\u5e76\u66f4\u65b0\u7b54\u6848\u65f6\uff0c\u53f3\u7aef\u70b9\u7684\u503c\u57df\u4e3a $[i+L-1,i+R-1]$\uff0c\u6545\u8981\u8bbe\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u7684\u957f\u5ea6\u4e3a $R-L+1$\u3002\n\n------------\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5;\nint n,k,L,R,a[N];\npair<int,double> q[N];\nint head,tail,len,now;\nvoid init(int x){head=0,tail=-1,len=x,now=0;}\nvoid outq()\n{\n\tif(head<=tail&&q[head].first==++now-len) head++;\n}\nvoid inq(double x)\n{\n\toutq();\n\twhile(tail>=head&&q[tail].second>=x) --tail;\n\tq[++tail]=make_pair(now,x);\n}\nbool check(double x)\n{\n\tdouble ans=-1e18;\n\tinit(R-L+1);\n\tfor(int i=L;i<R;++i) inq(a[i]+x*i);\n\tfor(int i=R;i<=n;++i) \n\t{\n\t\tinq(a[i]+x*i);\n\t\tans=max(ans,a[i-R+1]+x*(i-R+1)-q[head].second);\n\t}\n\tfor(int i=n-R+2;i<=n-L+1;++i) \n\t{\n\t\toutq();\n\t\tans=max(ans,a[i]+x*i-q[head].second);\n\t}\n\t//\u4ee5\u4e0a\u5904\u7406\u5de6\u7aef\u70b9\u4e3a\u6700\u5927\u503c\uff0c\u4ee5\u4e0b\u5904\u7406\u5de6\u7aef\u70b9\u4e3a\u6700\u5c0f\u503c \n\tinit(R-L+1);\n\tfor(int i=1;i+L-1<=n;++i) \n\t{\n\t\tinq(a[i]-x*i);\n\t\tans=max(ans,a[i+L-1]-x*(i+L-1)-q[head].second);\n\t}\n\treturn ans>x*k;\n}\ndouble getmin()\n{\n\tdouble ans=-1e18;\n\tinit(L*2-1);\n\tfor(int i=1;i<=L-1;++i) inq(a[i]);\n\tfor(int i=L;i<=n;++i)\n\t{\n\t\tinq(a[i]);\n\t\tans=max(ans,a[i-L+1]-q[head].second);\n\t}\n\tfor(int i=n-L+2;i<=n;++i) \n\t{\n\t\toutq();\n\t\tans=max(ans,a[i]-q[head].second);\n\t}\n\treturn ans/(L+k-1);\n}\nint main()\n{\n//\tfreopen(\"extreme.in\",\"r\",stdin);\n//\tfreopen(\"extreme.out\",\"w\",stdout);\n\tint t;\n\tscanf(\"%d\",&t);\n\twhile(t--)\n\t{\n\t\tscanf(\"%d%d%d%d\",&n,&k,&L,&R);\n\t\tfor(int i=1;i<=n;++i) scanf(\"%d\",a+i);\n\t\tdouble l=0,r=1e9,mid;\n\t\tfor(int i=1;i<=60;++i)\n\t\t{\n\t\t\tmid=(l+r)/2;\n\t\t\tif(check(mid)) l=mid;\n\t\t\telse r=mid;\n\t\t}\n\t\tmid=max(mid,getmin());\n\t\tprintf(\"%.4lf\\n\",mid);\n\t}\n    return 0;\n}\n\n```\n",
        "postTime": 1655004569,
        "uid": 255581,
        "name": "gao_yc",
        "ccfLevel": 0,
        "title": "P6087 [JSOI2015]\u9001\u793c\u7269"
    },
    {
        "content": "## \u5206\u6790\n\n\u770b\u5230\u8fd9\u4e00\u4e2a\u5f0f\u5b50\uff0c\u663e\u7136\u662f $01$ \u5206\u6570\u89c4\u5212\n\n\u4f46\u662f\u4e00\u822c\u7684 $01$ \u5206\u6570\u89c4\u5212\u90fd\u662f\u4e0a\u9762\u4e00\u4e2a\u6c42\u548c\u516c\u5f0f\u6bd4\u4e0b\u9762\u4e00\u4e2a\u6c42\u548c\u516c\u5f0f\n\n\u800c\u8fd9\u4e00\u9053\u9898\u5219\u662f\u6700\u5927\u503c\u51cf\u53bb\u6700\u5c0f\u503c\u6bd4\u533a\u95f4\u957f\u5ea6\u52a0\u4e00\u4e2a\u5b9a\u503c\u7684\u5f62\u5f0f\n\n\u6211\u4eec\u624b\u73a9\u4e00\u4e0b\u4f1a\u53d1\u73b0\uff0c\u4e00\u4e2a\u533a\u95f4\u7684\u5de6\u53f3\u4e24\u7aef\u4e00\u5b9a\u662f\u8be5\u533a\u95f4\u7684\u6700\u5927\u503c\u6216\u6700\u5c0f\u503c\n\n\u56e0\u4e3a\u5982\u679c\u4f60\u5728\u6700\u5927\u503c\u6216\u8005\u6700\u5c0f\u503c\u7684\u57fa\u7840\u4e0a\u7ee7\u7eed\u6269\u5c55\u7684\u8bdd\uff0c\u5206\u6bcd\u4f1a\u53d8\u5927\uff0c\u7ed3\u679c\u4f1a\u53d8\u5c0f\uff0c\u80af\u5b9a\u4e0d\u5229\u4e8e\u6211\u4eec\u6c42\u89e3\n\n\u4f46\u662f\u6709\u53ef\u80fd\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u4e4b\u95f4\u7684\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e\u6700\u5c0f\u7684\u533a\u95f4\u957f\u5ea6 $l$ \uff0c\u6b64\u65f6\u6211\u4eec\u5c31\u5fc5\u987b\u5411\u4e24\u8fb9\u6269\u5c55\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n$1$ \u3001 \u533a\u95f4\u7684\u957f\u5ea6\u5927\u4e8e $l$ \n\n\u6b64\u65f6\uff0c\u6211\u4eec\u50cf\u6b63\u5e38\u7684 $01$ \u5206\u6570\u89c4\u5212\u4e00\u6837\u4e8c\u5206\u679a\u4e3e\u5373\u53ef\n\n\u6211\u4eec\u8bbe\u6b64\u65f6\u679a\u4e3e\u5230\u7684\u4ef7\u503c\u4e3a $mids$\n\n\u90a3\u4e48\u5982\u679c $\\frac{M(i,j)-m(i,j)}{j-i+K} \\geq mids$\n\n\u5219\u6709 $\\ M(i,j)-m(i,j) \\geq mids \\times (j-i+K)$\n\n\u6839\u636e\u4e4b\u524d\u63a8\u5bfc\u7684\u7ed3\u8bba\uff0c\u4e24\u8fb9\u7684\u5143\u7d20\u53ea\u80fd\u662f\u6700\u5927\u503c\u6216\u8005\u6700\u5c0f\u503c\n\n\u56e0\u6b64\u6211\u4eec\u5206\u7c7b\u8ba8\u8bba\n\n\u5982\u679c\u533a\u95f4\u5de6\u8fb9\u7684\u5143\u7d20\u5927\u4e8e\u533a\u95f4\u53f3\u8fb9\u7684\u5143\u7d20\n\n\u5219\u6709 $a[i]-a[j] \\geq mids \\times (j-i+K)$\n\n\u6211\u4eec\u5c55\u5f00\u79fb\u4e00\u4e0b\u9879\uff0c\u5c31\u6709 \n\n$a[i]-a[j] \\geq mids \\times j- mids \\times i +mids \\times K$\n\n$a[i]+i \\times mids - a[j] - j \\times mids \\geq mids \\times K$\n\n\u6211\u4eec\u4ee4 $val[i]=a[i]+i \\times mids$\n\n\u5219\u5c31\u6709 $val[i]-val[j] \\geq mids \\times K$\n\n\u5176\u4e2d\u53f3\u8fb9\u662f\u4e00\u4e2a\u5e38\u6570\n\n\u4e8e\u662f\u6211\u4eec\u60ca\u559c\u5730\u53d1\u73b0\u8fd9\u73a9\u610f\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u53bb\u641e\u4e00\u4e0b\n\n\u540c\u7406\uff0c\u5982\u679c\u533a\u95f4\u5de6\u8fb9\u7684\u5143\u7d20\u5927\u4e8e\u533a\u95f4\u53f3\u8fb9\u7684\u5143\u7d20\n\n\u5219\u6709 $a[j]-a[i] \\geq mids \\times (j-i+K)$\n\n$a[j]-a[i] \\geq mids \\times j- mids \\times i +mids \\times K$\n\n$a[j]- j \\times mids - a[i] + i \\times mids \\geq mids \\times K$\n\n\u6211\u4eec\u4ee4 $val[i]=a[i]-i \\times mids$\n\n\u5219\u5c31\u6709 $val[j]-val[i] \\geq mids \\times K$\n\n\u4e5f\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u53bb\u7ef4\u62a4\n\n$2$ \u3001\u533a\u95f4\u7684\u957f\u5ea6\u7b49\u4e8e $l$\n\n\u6b64\u65f6\u6211\u4eec\u7528 $ST$ \u8868\u9884\u5904\u7406\u51fa\u533a\u95f4\u6700\u5927\u6700\u5c0f\u503c\n\n\u6bcf\u6b21\u4ece\u5de6\u5230\u53f3\u626b\u4e00\u8fb9\u679a\u4e3e\u5de6\u7aef\u70b9\u5373\u53ef\n\n## \u4ee3\u7801\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=1e6+5;\nconst double eqs=1e-6;\nint zdz[maxn][20],zxz[maxn][20],a[maxn],n,k,l,r;\ndouble ans=0;\nvoid solve1(){\n\tint cd=log2(l);\n\tfor(int i=1;i<=n-l+1;i++){\n\t\tint j=i+l-1;\n\t\tdouble mmax=max(zdz[i][cd],zdz[j-(1<<cd)+1][cd]);\n\t\tdouble mmin=min(zxz[i][cd],zxz[j-(1<<cd)+1][cd]);\n\t\tans=max(ans,(mmax-mmin)/((double)l-1+(double)k));\n\t}\n}\n//\u679a\u4e3e\u533a\u95f4\u7b49\u4e8el\u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u66b4\u626b\nint ql[maxn],qr[maxn],headl,headr,taill,tailr;\ndouble val[maxn];\nbool jud(double mids){\n\tdouble res=mids*k;\n\tmemset(ql,0,sizeof(ql));\n\tmemset(qr,0,sizeof(qr));\n\theadl=1,taill=0,headr=1,tailr=0;\n\tfor(int i=1;i<=n;i++){\n\t\tval[i]=(double)a[i]-i*mids;\n\t}\n\tfor(int i=l;i<=n;i++){\n\t\twhile(headl<=taill && i-ql[headl]+1>r) headl++;\n\t\tif(headl<=taill && val[i]-val[ql[headl]]>=res) return 1;\n\t\twhile(headl<=taill && val[i-l+1]<=val[ql[headl]]) taill--;\n\t\tql[++taill]=i-l+1;\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tval[i]=(double)a[i]+i*mids;\n\t}\n\tfor(int i=l;i<=n;i++){\n\t\twhile(headr<=tailr && i-qr[headr]+1>r) headr++;\n\t\tif(headr<=tailr && val[qr[headr]]-val[i]>=res) return 1;\n\t\twhile(headr<=tailr && val[qr[tailr]]<=val[i-l+1]) tailr--;\n\t\tqr[++tailr]=i-l+1;\n\t}\n\treturn 0;\n}\n//\u5355\u8c03\u961f\u5217\u5206\u522b\u641e\u4e00\u4e0b\nvoid solve2(){\n\tdouble ml=0,mr=1000,mmids;\n\twhile(mr-ml>eqs){\n\t\tmmids=(ml+mr)/2;\n\t\tif(jud(mmids)) ml=mmids;\n\t\telse mr=mmids;\n\t}\n\tans=max(ans,ml);\n}//01\u5206\u6570\u89c4\u5212\nint main(){\n\tint t;\n\tscanf(\"%d\",&t);\n\twhile(t--){\n\t\tscanf(\"%d%d%d%d\",&n,&k,&l,&r);\n\t\tans=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=0;j<20;j++){\n\t\t\t\tzxz[i][j]=0x3f3f3f3f,zdz[i][j]=-0x3f3f3f3f;\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tscanf(\"%d\",&a[i]);\n\t\t\tzxz[i][0]=a[i];\n\t\t\tzdz[i][0]=a[i];\n\t\t}\n\t\tfor(int j=1;j<=18;j++){\n\t\t\tfor(int i=1;i+(1<<j)-1<=n;i++){\n\t\t\t\tzxz[i][j]=min(zxz[i][j-1],zxz[i+(1<<(j-1))][j-1]);\n\t\t\t\tzdz[i][j]=max(zdz[i][j-1],zdz[i+(1<<(j-1))][j-1]);\n\t\t\t}\n\t\t}\n\t\t//ST\u8868\u9884\u5904\u7406\n\t\tsolve1();\n\t\t//\u60c5\u51b5\u4e00\n\t\tsolve2();\n\t\t//\u60c5\u51b5\u4e8c\n\t\tprintf(\"%.4lf\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1597153149,
        "uid": 316322,
        "name": "hzoi_liuchang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6087 \u3010[JSOI2015]\u9001\u793c\u7269\u3011"
    },
    {
        "content": "# \u5206\u6790\n\n\u5148\u8003\u8651\u5982\u679c\u6ca1\u6709 $L$ \u548c $R$ \u7684\u957f\u5ea6\u9650\u5236\uff0c\u6211\u4eec\u53d1\u73b0\u6700\u4f18\u89e3\u4e2d\u5bf9\u4e8e\u533a\u95f4 $l\\sim r$\uff0c$A_l$ \u548c $A_r$ \u5e94\u8be5\u5206\u522b\u4e3a $A_l,A_{l+1},\\cdots,A_r$ \u4e2d\u7684\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u3002\n\n\u8003\u8651\u52a0\u4e0a $L$ \u548c $R$ \u7684\u957f\u5ea6\u9650\u5236\uff0c\u82e5\u539f\u6765\u7684\u533a\u95f4\u4e3a $l\\sim r$\uff0c\u5219\u4f1a\u5206\u5982\u4e0b 3 \u79cd\u60c5\u51b5\u8fdb\u884c\u8ba8\u8bba\uff1a\n\n1. \u5982\u679c $r-l+1< L$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u5b83\u7684\u957f\u5ea6\u8865\u6210 $L$\u3002\n\n2. \u5982\u679c $L\\le r-l+1\\le R$\uff0c\u90a3\u4e48\u8fd9\u76f4\u63a5\u53ef\u4ee5\u4f5c\u4e3a\u7b54\u6848\u3002\n\n3. \u5982\u679c $R<r-l+1$\uff0c\u90a3\u4e48\u5b83\u574f\u4e86\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u53ea\u6709\u60c5\u51b5 $1,2$ \u662f\u9700\u8981\u8003\u8651\u7684\u3002\n\n## \u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\n\n\u533a\u95f4\u957f\u5ea6\u56fa\u5b9a\u4e3a $L$\uff0c\u5206 $A_r$ \u4e3a\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u8dd1\u4e00\u4e0b\u5355\u8c03\u961f\u5217\u5c31\u597d\u4e86\u3002\n\n## \u5bf9\u4e8e\u7b2c\u4e8c\u4e2d\u60c5\u51b5\n\n\u6211\u4eec\u518d\u56de\u6765\u770b\u90a3\u4e2a\u5f0f\u5b50\uff0c\u53d1\u73b0\u662f\u4e2a\u5206\u6570\u89c4\u5212\uff0c\u975e\u5e38\u5e38\u89c4\u5730\u8f6c\u6362\u6210\u5224\u65ad\u6027\u95ee\u9898\uff1a\n\n$$\n\\begin{aligned}\n\\frac{M(l,r)-m(l,r)}{r-l+K}&\\ge mid\\\\\nM(l,r)-m(l,r)&\\ge mid\\times(r-l+K)\\\\\nM(l,r)-m(l,r)-mid\\times r+mid\\times l&\\ge mid\\times K\n\\end{aligned}\n$$\n\n\u4e0d\u59a8\u53e6 $A_r$ \u4e3a\u533a\u95f4 $l\\sim r$ \u7684\u6700\u5927\u503c\uff0c$A_l$ \u4e3a\u533a\u95f4 $l\\sim r$ \u7684\u6700\u5c0f\u503c\u3002\n\n$$\n\\begin{aligned}\nA_r-A_l-mid\\times r+mid\\times l&\\ge mid\\times K\\\\\n(A_r-mid\\times r)-(A_l-mid\\times l)&\\ge mid\\times K\n\\end{aligned}\n$$\n\n\u7528\u5355\u8c03\u961f\u5217\u5b9e\u73b0\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n$A_r$ \u4e3a\u533a\u95f4 $l\\sim r$ \u7684\u6700\u5c0f\u503c\uff0c$A_l$ \u4e3a\u533a\u95f4 $l\\sim r$ \u7684\u6700\u5927\u503c\u540c\u7406\u3002\n\n## \u5b9e\u73b0\u7ec6\u8282\n\n\u5c31\u662f\u6781\u4e3a\u6709\u7528\u7684\u5c0f trick\u2014\u2014\u5f31\u5316\u6700\u5927\u503c\uff0c\u6700\u5c0f\u503c\u3002\n\n\u4f60\u4f1a\u53d1\u73b0\u7528\u4e0a\u8ff0\u65b9\u6cd5\u5b9e\u73b0\u975e\u5e38\u56f0\u96be\uff0c\u56e0\u4e3a\u4f60\u8981\u5f3a\u5236\u53d6\u6700\u5927\u6216\u53d6\u6700\u5c0f\u3002\n\n\u4f46\u662f\u7a0d\u4f5c\u601d\u8003\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u53d6\u6700\u5927\u503c\u6700\u5c0f\u503c\u7b54\u6848\u4e00\u5b9a\u4e0d\u4f1a\u66f4\u4f18\uff0c\u6240\u4ee5\u5199\u4ee3\u7801\u7684\u65f6\u5019\u5b8c\u5168\u4e0d\u9700\u8981\u8003\u8651\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define log(a) cerr<<\"\\033[32m[DEBUG] \"<<#a<<'='<<(a)<<\" @ line \"<<__LINE__<<\"\\033[0m\"<<endl\n#define LL long long\n#define SZ(x) ((int)x.size()-1)\n#define ms(a,b) memset(a,b,sizeof a)\n#define F(i,a,b) for(int i=(a);i<=(b);++i)\n#define DF(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\ninline int read(){char ch=getchar(); int w=1,c=0;\n\tfor(;!isdigit(ch);ch=getchar()) if (ch=='-') w=-1;\n\tfor(;isdigit(ch);ch=getchar()) c=(c<<1)+(c<<3)+(ch^48);\n\treturn w*c;\n}\nconst int N=5e4+10;\nconst double eps=1e-6;\nint a[N],n,k,L,R,q[N],s,t;\ndouble b[N],c[N];\ninline double situation1(){\n\tdouble ans=0;\n\ts=1,t=0;\n\tF(i,1,n){\n\t\twhile(s<=t&&i-q[s]>=L)s++;\n\t\tif(s<=t)ans=max(ans,(a[i]-a[q[s]])/((double)(L+k-1)));\n\t\twhile(s<=t&&a[q[t]]>a[i])t--;\n\t\tq[++t]=i;\n\t}\n\ts=1,t=0;\n\tF(i,1,n){\n\t\twhile(s<=t&&i-q[s]>=L)s++;\n\t\tif(s<=t)ans=max(ans,(a[q[s]]-a[i])/((double)(L+k-1)));\n\t\twhile(s<=t&&a[q[t]]<a[i])t--;\n\t\tq[++t]=i;\n\t}return ans;\n}\ninline bool check(double x){\n\tF(i,1,n)b[i]=a[i]-x*i,c[i]=a[i]+x*i;\n\ts=1,t=0;\n\tF(i,1,n){\n\t\twhile(s<=t&&i-q[s]+1>R)s++;\n\t\tif(s<=t&&b[i]-b[q[s]]>=x*k)return true;\n\t\tif(i>=L){\n\t\t\twhile(s<=t&&b[q[t]]>b[i-L+1])t--;\n\t\t\tq[++t]=i-L+1;\n\t\t}\n\t}\n\ts=1,t=0;\n\tF(i,1,n){\n\t\twhile(s<=t&&i-q[s]+1>R)s++;\n\t\tif(s<=t&&c[q[s]]-c[i]>=x*k)return true;\n\t\tif(i>=L){\n\t\t\twhile(s<=t&&c[q[t]]<c[i-L+1])t--;\n\t\t\tq[++t]=i-L+1;\n\t\t}\n\t}\n\treturn false;\n}\ninline double situation2(){\n\tdouble l=0,r=10001;\n\twhile(l+eps<r){\n\t\tdouble mid=(l+r)/2.0;\n\t\tif(check(mid))l=mid;\n\t\telse r=mid;\n\t}return l;\n}\nsigned main(){\n\tint _=read();\n\twhile(_--){\n\t\tn=read(),k=read(),L=read(),R=read();\n\t\tF(i,1,n)a[i]=read();\n\t\tcout<<fixed<<setprecision(4)<<max(situation1(),situation2())<<endl;\n\t}\n\treturn 0;\n}\n```\n\n\n\n\n",
        "postTime": 1630137390,
        "uid": 180242,
        "name": "orzdevinwang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6087 \u3010[JSOI2015]\u9001\u793c\u7269\u3011"
    }
]