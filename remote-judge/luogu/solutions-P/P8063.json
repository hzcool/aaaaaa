[
    {
        "content": "\u5728\u5220\u9664\u8fb9 $(v_i, v_{i+1})$ \u524d\u540e\uff0c\u82e5\u8282\u70b9 $x$ \u5230 $a$ \u7684\u6700\u77ed\u8def\u957f\u5ea6\u4e0d\u53d8\uff0c\u5219\u79f0 $x$ \u4eb2\u548c $a$\uff1b\u82e5\u5176\u5230 $b$ \u7684\u6700\u77ed\u8def\u957f\u5ea6\u4e0d\u53d8\uff0c\u5219\u79f0 $x$ \u4eb2\u548c $b$\u3002\u6211\u4eec\u6709\u7ed3\u8bba\uff1a\n\n\u5bf9\u4e8e\u4efb\u610f $i\\in [1, k-1]$\uff0c\u5728\u5220\u9664\u8fb9 $(v_i, v_{i+1})$ \u540e $a$ \u5230 $b$ \u7684\u6240\u6709\u6700\u77ed\u8def\u90fd\u53ef\u4ee5\u5212\u5206\u4e3a $a$ \u5230 $x$ \u7684\u4e00\u6761\u6700\u77ed\u8def\u3001\u8fb9 $(x, y)$ \u548c $y$ \u5230 $b$ \u7684\u4e00\u6761\u6700\u77ed\u8def\u8fd9\u4e09\u90e8\u5206\uff0c\u4e14\u6ee1\u8db3 $x$ \u4eb2\u548c $a$\uff0c$y$ \u4eb2\u548c $b$\u3002\n\n\u4e0b\u9762\u8bc1\u660e\u8be5\u7ed3\u8bba\u3002\n\n**\u5f15\u7406 $\\mathbf{1.}$** \u5728\u5220\u9664\u8fb9 $(v_i, v_{i+1})$ \u524d\u540e\uff0c\u5bf9\u4e8e\u4efb\u610f\u8282\u70b9 $x$\uff0c\u5176\u4e00\u5b9a\u4eb2\u548c $a$ \u548c $b$ \u4e2d\u7684\u81f3\u5c11\u4e00\u4e2a\u3002\n\n\u8bc1\u660e\uff1a\u82e5\u4e8c\u8005\u6700\u77ed\u8def\u957f\u5ea6\u5747\u6709\u53d8\u5316\uff0c\u5219\u8bf4\u660e\u5728\u539f\u56fe\u4e2d $x$ \u5230 $a$ \u548c $b$ \u7684\u6700\u77ed\u8def\u5747\u7ecf\u8fc7 $(v_i, v_{i+1})$\uff0c\u5219 $d_{xy}+d_{yz}\\le d_{xz}$ \u548c $d_{xz}+d_{zy}\\le d_{xy}$\u3002\u7136\u800c\u7531\u4e8e $d_{yz} > 0$\uff0c\u8be5\u4e8c\u5f0f\u4e0d\u53ef\u80fd\u540c\u65f6\u6210\u7acb\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/zgp4egvx.png)\n\n\n**\u5f15\u7406 $\\mathbf{2.}$** \u5bf9\u4e8e\u5220\u9664\u8fb9 $(v_i, v_{i+1})$ \u540e $a$ \u5230 $b$ \u7684\u4efb\u610f\u4e00\u6761\u6700\u77ed\u8def $p_1\\rightarrow p_2\\rightarrow \\ldots\\rightarrow p_l$ \uff08$p_1=a,p_l=b$\uff09\uff0c\u82e5 $p_i$ \u4eb2\u548c $a$\uff0c\u5219\u5bf9\u4e8e\u6240\u6709 $1\\le j< i$ \u6709 $p_j$ \u4eb2\u548c $a$\uff1b\u82e5 $p_i$ \u4eb2\u548c $b$\uff0c\u5219\u5bf9\u4e8e\u6240\u6709 $i< j\\le l$ \u6709 $p_j$ \u4eb2\u548c $b$\uff1b\n\n\u8bc1\u660e\uff1a\u82e5 $p_{i-1}$ \u4e0d\u4eb2\u548c $a$\uff0c\u5219 $p_i$ \u4e00\u5b9a\u4e5f\u4e0d\u4eb2\u548c $a$\u3002\n\n\u5bf9\u4e24\u4e2a\u5f15\u7406\u7a0d\u52a0\u5206\u6790\uff0c\u5c31\u53ef\u4ee5\u5f97\u51fa\u6587\u9996\u63d0\u51fa\u7684\u7ed3\u8bba\u3002\u90a3\u4e48\u6211\u4eec $O(n^2)$ \u679a\u4e3e\u8fb9 $(x,y)$\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u7cfb\u5217\u8def\u5f84 $a\\rightarrow \\ldots\\rightarrow x\\rightarrow y\\rightarrow \\ldots\\rightarrow b$ \u4e86\uff1b\u8bbe $t_{ax}$ \u8868\u793a\u8def\u5f84 $a\\rightarrow \\ldots\\rightarrow x$ \u4e0a\u8ddd $a$ \u6700\u8fdc\u7684\u5e78\u8fd0\u8fb9\uff0c $t_{by}$ \u8868\u793a\u8def\u5f84 $y\\rightarrow \\ldots\\rightarrow b$ \u4e0a\u8ddd $b$ \u6700\u8fdc\u7684\u5e78\u8fd0\u8fb9\uff0c\u6211\u4eec\u65ad\u5b9a\uff0c\u53ea\u9700\u7528 $a\\rightarrow \\ldots\\rightarrow x\\rightarrow y\\rightarrow \\ldots\\rightarrow b$ \u7684\u957f\u5ea6\u66f4\u65b0\u9664\u53bb\u524d $t_{ax}$ \u6761\u548c\u540e $t_{by}$ \u6761\u4e4b\u5916\u6240\u6709\u5e78\u8fd0\u8fb9\u7684\u7b54\u6848\uff0c\u6700\u7ec8\u6bcf\u6761\u5e78\u8fd0\u8fb9\u5c31\u90fd\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7b54\u6848\u3002\n\n\u8981\u8bc1\u660e\u4e0a\u8ff0\u8bba\u65ad\uff0c\u53ea\u9700\u8bc1\u660e\uff0c\u5bf9\u4e8e\u6240\u6709\u5e78\u8fd0\u8fb9 $(v_i,v_{i+1})$\uff0c\u5220\u9664\u5176\u4e4b\u540e\u5b58\u5728\u4e00\u6761 $a$ \u5230 $b$ \u7684\u6700\u77ed\u8def\u4e0a\u7684\u4e00\u6761\u8fb9 $(x,y)$ \u6ee1\u8db3 $x$ \u4eb2\u548c $a$\u3001$y$ \u4eb2\u548c $b$ \u4e14 $t_{ax}\\le i-1,t_{by}\\le k - i - 1$\u3002\u8fd9\u6837\u4e00\u6761\u8fb9\u603b\u662f\u5b58\u5728\uff0c\u56e0\u4e3a\u5982\u4e0b\u56fe\u4e2d\u7684\u7ea2\u8272\u6700\u77ed\u8def\uff0c$c$ \u4e00\u5b9a\u4eb2\u548c $a$\uff0c$d$ \u4e00\u5b9a\u4eb2\u548c $b$\uff0c\u6545\u800c $c$\u3001$d$ \u4e4b\u95f4\u7684\u8def\u5f84\u4e0a\u4e5f\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a\u201c\u5206\u754c\u7ebf\u201d $(x,y)$ \u6ee1\u8db3 $x,y$ \u5206\u522b\u4eb2\u548c $a,b$\uff1b\u7531\u4e8e $(x,y)$ \u4f4d\u4e8e $c,d$ \u4e4b\u95f4\uff0c$t_{ax}\\le i-1,t_{by}\\le k - i - 1$ \u7684\u6761\u4ef6\u4e5f\u81ea\u7136\u6ee1\u8db3\u4e86\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/d8314gpk.png)\n\n\u6211\u4eec\u53ea\u9700\u8981\u5206\u522b\u4ee5 $a,b$ \u4e3a\u6e90\u70b9\u7528 Dijkstra \u8dd1\u6700\u77ed\u8def\uff08\u4ee5\u8ddd\u79bb\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$t_{ax}$ \u6216 $t_{by}$ \u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\uff09\uff0c\u518d $O(n^2)$ \u679a\u4e3e $(x,y)$ \u7528 $d_{ax}+w_{xy}+d_{yb}$ \u5957\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u66f4\u65b0 $[t_{ax}+1,k-1-t_{by}]$ \u533a\u95f4\u5e78\u8fd0\u8fb9\u7684\u7b54\u6848\u5373\u53ef\u3002\u603b\u590d\u6742\u5ea6\u4e3a $O(n^2\\log n)$\u3002\n\n\u4ee3\u7801\u4ec5\u793a\u610f\u3002\u4e0d\u7528\u6570\u636e\u7ed3\u6784\u4e5f\u80fd\u8fc7\uff0c\u4e0d\u77e5\u662f\u6709\u4ec0\u4e48\u6027\u8d28\u4fdd\u8bc1\u590d\u6742\u5ea6\u8fd8\u662f\u6570\u636e\u592a\u6c34\u3002\n\n```cpp\nint main(){\n\tread(n), read(m), read(a), read(b);\n\tfor(int i = 1; i <= n; ++i) for(int j = 1; j <= n; ++j) w[i][j] = (i == j ? 0 : inf);\n\tfor(int i = 1, u, v, d; i <= m; ++i){\n\t\tread(u), read(v), read(d);\n\t\tadd(u, v, d), add(v, u, d);\n\t\tw[u][v] = std::min(w[u][v], d);\n\t\tw[v][u] = std::min(w[v][u], d);\n\t}\n\tread(k);\n\tfor(int i = 1; i <= k; ++i) read(v[i]);\n\tdijkstra(a, da, ta), rev = true, dijkstra(b, db, tb);\n\tfor(int i = 1; i <= k; ++i) ans[i] = inf;\n\tfor(int i = 1; i <= n; ++i)\n\t\tfor(int j = 1; j <= n; ++j){\n\t\t\tll val = da[i] + db[j] + w[i][j];\n\t\t\tif(val >= inf || c[i] == j || c[j] == i) continue;\n\t\t\tfor(int p = ta[i] + 1; p <= k - 1 - tb[j]; ++p)\n\t\t\t\tans[p] = std::min(ans[p], val);\n\t\t}\n\tfor(int i = 1; i < k; ++i) printf(\"%d\\n\", ans[i] < inf ? ans[i] : -1);\n}\n```",
        "postTime": 1661613168,
        "uid": 222441,
        "name": "Flan",
        "ccfLevel": 7,
        "title": "P8063 [BalkanOI 2012] Shortest paths \u9898\u89e3"
    }
]