[
    {
        "content": "### \u9898\u89e3\r\n\r\n\u538b\u8f74\u9898\u3002\r\n\r\n\u5bb9\u6613\u53d1\u73b0\u8fd9\u662f\u4e00\u68f5\u6811\u3002\u5177\u4f53\u53ef\u4ee5\u7528\u5f52\u7eb3\u6cd5\u3002\u8bbe\u524d $i$ \u884c\u7ec4\u6210\u4e00\u68f5\u6811\uff0c\u90a3\u4e48\u7b2c $i+1$ \u884c\u5185\u6bcf\u4e2a\u70b9\u90fd\u5411\u7b2c $i$ \u884c\u67d0\u4e2a\u70b9\u8fde\u4e86\u8fb9\uff0c\u90a3\u80af\u5b9a\u524d $i+1$ \u884c\u4e5f\u662f\u4e00\u68f5\u6811\u4e86\u3002\r\n\r\n\u5bb9\u6613\u53d1\u73b0\u8fd9\u6811\u5f88\u7279\u6b8a\u3002\u5b83\u7684\u70b9\u6570\u8fbe\u5230\u4e86 $n^2$ \u7ea7\u522b\uff0c\u4f46\u662f\u7b2c $i$ \u5217\u6574\u4e2a\u5c31\u662f\u4e32\u5728\u4e00\u8d77\u7684\u5f62\u6210\u94fe\u7684\u6837\u5b50\u3002\u53ef\u4ee5\u8bc1\u660e\uff0c\u6574\u68f5\u6811\u53ef\u4ee5\u88ab\u5212\u5206\u4e3a $\\mathcal O(n)$ \u4e2a\u70b9\u548c $\\mathcal O(n)$ \u6761\u94fe\u3002\r\n\r\n**\u5b9a\u4e49**\uff1a\u6211\u4eec\u9009\u51fa\u6811\u4e0a\u4e00\u4e9b\u70b9\u4f5c\u4e3a**\u5173\u952e\u70b9**\u3002\u8fd9\u4e9b\u70b9\u5305\u62ec\u7b2c $1$ \u5c42\u7684\u6240\u6709\u70b9\u3001\u7b2c $n$ \u5c42\u7684\u6240\u6709\u70b9\u3001\u5176\u4ed6\u6240\u6709**\u5ea6\u6570**\u4e3a $3$ \u7684\u70b9\u3002\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/d9ztpaj5.png)\r\n\r\n\u56fe\u4e2d\u6807\u4e0a\u7ea2\u661f\u7684\u5373\u4e3a\u5173\u952e\u70b9\u3002\r\n\r\n**\u65ad\u8a00**\uff1a\u5173\u952e\u70b9\u7684\u4e2a\u6570\u662f $\\mathcal O(n)$ \u7ea7\u522b\u7684\u3002\r\n\r\n**\u8bc1\u660e**\uff1a\u8003\u8651\u524d $i$ \u884c\uff0c$i\\ge 2$\u3002\u5bb9\u6613\u53d1\u73b0\uff0c\u7b2c $i$ \u884c\u6240\u6709\u70b9\u7684\u5ea6\u6570\u5e94\u8be5\u6070\u597d\u4e3a $1$\u3002\u5f53\u52a0\u5165\u7b2c $i+1$ \u884c\u7684\u6240\u6709\u70b9\u4ee5\u53ca\u8fb9\u65f6\uff0c\u7b2c $i+1$ \u884c\u524d $i$ \u4e2a\u70b9\u8fde\u7684\u8fb9\u4f7f\u5f97\u7b2c $i$ \u884c\u6240\u6709\u70b9\u5ea6\u6570\u90fd\u53d8\u6210\u4e86 $2$\uff0c\u800c\u7b2c $i+1$ \u884c\u7b2c $i+1$ \u4e2a\u70b9\u8fde\u7684\u8fb9\u4f7f\u5f97\u7b2c $i+1$ \u884c\u6070\u597d\u6709\u4e00\u4e2a\u70b9\u5ea6\u6570\u53d8\u6210\u4e86 $3$\uff0c\u8fd9\u4e2a\u70b9\u5c31\u6210\u4e86\u5173\u952e\u70b9\u3002\u90a3\u4e48\uff0c\u7b2c $2\\sim (n-1)$ \u884c\u5e94\u8be5\u5747\u6070\u597d\u6709\u4e00\u4e2a\u7279\u6b8a\u70b9\u3002\u518d\u52a0\u4e0a\u7b2c $1$ \u884c\u4e0e\u7b2c $n$ \u884c\u7684\u70b9\uff0c\u7279\u6b8a\u70b9\u7684\u603b\u4e2a\u6570\u5c31\u662f $\\mathcal O(n)$ \u7ea7\u522b\u7684\u4e86\u3002\r\n\r\n\u9664\u4e86\u5173\u952e\u70b9\uff0c\u5176\u4ed6\u6240\u6709\u70b9\u7684\u5ea6\u6570\u5747\u4e3a $2$\uff08\u8bfb\u8005\u81ea\u8bc1\u4e0d\u96be\uff09\u3002\u4e8e\u662f\u522b\u7684\u70b9\u80af\u5b9a\u4f1a\u5728\u67d0\u6761\u94fe\u4e0a\u3002\u6cbf\u7740\u94fe\u8d70\uff0c\u8d70\u5230\u7684\u4e24\u7aef\u80af\u5b9a\u90fd\u662f\u5173\u952e\u70b9\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u6761\u94fe\u62bd\u8c61\u6210\u8fde\u63a5\u4e24\u4e2a\u5173\u952e\u70b9\u7684\u300c\u8fb9\u300d\uff0c\u8fd9\u4e2a\u300c\u865a\u6811\u300d\u8282\u70b9\u4e2a\u6570\u4e3a $\\mathcal O(n)$\uff0c\u90a3\u4e48\u5b83\u7684\u8fb9\u7684\u4e2a\u6570\u80af\u5b9a\u4e5f\u662f $\\mathcal O(n)$\u3002\r\n\r\n\u628a\u865a\u6811\u5efa\u597d\u540e\uff0c\u53ef\u4ee5\u7528\u975e\u5e38\u7ecf\u5178\u7684\u6811\u4e0a\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u7684\u52a8\u6001\u89c4\u5212\u505a\u6cd5\u5728\u865a\u6811\u4e0a\u8dd1\u3002\u6211\u4eec\u5173\u5fc3\u7684\u662f\u4e24\u4e2a\u5173\u952e\u70b9\u4e4b\u95f4\u5e94\u8be5\u600e\u4e48\u8f6c\u79fb\u3002\u6362\u8a00\u4e4b\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fde\u63a5\u4e24\u4e2a\u5173\u952e\u70b9\u7684\u94fe\u5b83\u7684\u8d21\u732e\u600e\u4e48\u8ba1\u7b97\u3002\r\n\r\n\u8bb0 $f_u,g_u$ \u5206\u522b\u8868\u793a\uff0c\u5728\u9009\u62e9/\u4e0d\u9009\u62e9\u865a\u6811\u4e0a\u7684\u8282\u70b9 $u$ \u7684\u60c5\u51b5\u4e0b\uff0c\u5b50\u6811 $u$ \u80fd\u53d6\u5f97\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u7684\u503c\u3002\r\n\r\n\u5047\u8bbe\u6709\u4e24\u4e2a\u5173\u952e\u70b9 $u,v$\uff0c\u4ed6\u4eec\u4e4b\u95f4\u901a\u8fc7\u94fe $s=\\{p_1,p_2,\\cdots p_t\\}$ \u8fde\u63a5\u3002\u90a3\u4e48 $v$ \u5bf9 $f_u$ \u7684\u8d21\u732e\u662f $\\max\\{\\operatorname{val}(p_2,p_3,\\cdots,p_t)+g_v,\\operatorname{val}(p_2,p_3,\\cdots,p_{t-1})+f_v\\}$\uff0c$v$ \u5bf9 $g_u$ \u7684\u8d21\u732e\u662f $\\max\\{\\operatorname{val}(p_1,p_2,\\cdots,p_t)+g_v,\\operatorname{val}(p_1,p_2,\\cdots,p_{t-1})+f_v\\}$\u3002\u5176\u4e2d $\\operatorname{val}(p_1,p_2,\\cdots,p_t)$ \u8868\u793a\u5e8f\u5217 $p$ \u5728\u4e0d\u80fd\u9009\u62e9\u76f8\u90bb\u5143\u7d20\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u53d6\u5f97\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u3002\u6211\u4eec\u9700\u8981\u77e5\u9053\uff0c$s$ \u5e8f\u5217\u5728\u300c\u9996\u9879/\u672b\u9879\u300d\u300c\u80fd\u9009/\u4e0d\u80fd\u9009\u300d\u5171 $4$ \u79cd\u7ec4\u5408\u7684\u60c5\u51b5\u4e0b\uff0c\u5206\u522b\u8ba1\u7b97\u51fa\u6765\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u662f\u591a\u5c11\u3002\r\n\r\n\u6ce8\u610f\u4e00\u4e2a\u91cd\u8981\u6027\u8d28\uff1a\r\n\r\n- \u5bf9\u4e8e\u6bcf\u4e00\u6761\u8fde\u63a5\u4e86\u4e24\u4e2a\u5173\u952e\u70b9\u7684\u94fe\uff0c\u8fd9\u6761\u94fe\u4e0a\u7684\u70b9\uff08\u4e0d\u5305\u542b\u9876\u5934\u7684\u4e24\u4e2a\u5173\u952e\u70b9\uff09\uff0c\u80af\u5b9a\u5728\u540c\u4e00\u5217\u4e0a\u3002\r\n\r\n\u8fd9\u540c\u6837\u5bb9\u6613\u8bc1\u660e\u3002\u7531\u4e8e\u8be5\u6811\u7279\u6b8a\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5bf9\u4e8e $j<i$\uff0c\u975e\u7279\u6b8a\u70b9 $(i,j)$ \u80af\u5b9a\u4e0e $(i+1,j)$ \u548c $(i-1,j)$ \u76f8\u8fde\uff0c\u90a3\u4e48\u8fd9\u4e09\u4e2a\u70b9\u80af\u5b9a\u5728\u540c\u4e00\u5217\uff1b\u5bf9\u4e8e $(i,i)$\uff0c\u5b83\u5411\u4e0a\u8fde\u63a5\u7684\u70b9\u80af\u5b9a\u662f\u5173\u952e\u70b9\uff0c\u5411\u4e0b\u8fde\u63a5\u7684\u70b9\u80af\u5b9a\u4e0e\u5b83\u5728\u540c\u4e00\u5217\u3002\u4e8e\u662f\u5bb9\u6613\u53d1\u73b0\u6bcf\u6761\u94fe\u4e0a\u7684\u975e\u7279\u6b8a\u70b9\u5fc5\u7136\u5728\u540c\u4e00\u5217\u3002\r\n\r\n\u90a3\u4e48\u4e00\u6761\u94fe\u53ef\u4ee5\u88ab\u6620\u5c04\u5230 $01$ \u5e8f\u5217 $r$ \u4e0a\u7684\u4e00\u6bb5\u533a\u95f4 $[a,b]$\u3002\u5047\u8bbe\u8fd9\u4e2a\u94fe\u5728\u7b2c $k$ \u5217\u3002\u5982\u679c $c_k=0$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u5185\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u6743\u503c\u5c31\u662f $r_a,r_{a+1},\\cdots,r_b$\uff1b\u5982\u679c $c_k=1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u5185\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u6743\u503c\u5c31\u662f $\\neg r_a,\\neg r_{a+1},\\cdots,\\neg r_b$\u3002\r\n\r\n\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\uff0c\u67e5\u8be2\u5bf9 $r$ \u5e8f\u5217\u6216\u8005 $\\neg r$ \u5e8f\u5217\uff08\u8fd9\u4e24\u4e2a\u90fd\u662f $01$ \u5e8f\u5217\uff09\u505a**\u533a\u95f4\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6**\u7684\u7ed3\u679c\u3002\r\n\r\n\u5bf9\u4e8e $01$ \u5e8f\u5217\uff0c\u8ba1\u7b97\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u662f\u53ef\u4ee5\u91c7\u7528\u8d2a\u5fc3\u601d\u60f3\u7684\u3002\u6bd4\u5982\uff0c\u5bf9\u4e8e\u957f\u5ea6\u4e3a $2k$ \u7684\u5168 $1$ \u6bb5\uff0c\u5b83\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u663e\u7136\u662f $k$\uff1b\u5bf9\u4e8e\u957f\u5ea6\u4e3a $2k+1$ \u7684\u5168 $1$ \u6bb5\uff0c\u5b83\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u663e\u7136\u662f $k+1$\u3002\u5bf9\u4e8e\u542b\u6709 $0$ \u7684\u5e8f\u5217\uff0c\u603b\u662f\u53ef\u4ee5\u4ee5 $0$ \u4f5c\u4e3a\u5206\u9694\u7b26\u5212\u5206\u51fa\u5404\u79cd\u5168 $1$ \u6bb5\uff0c\u5206\u522b\u6c42\u548c\u518d\u76f8\u52a0\u5c31\u884c\u3002\r\n\r\n\u90a3\u4e48\u600e\u4e48\u5bf9 $01$ \u5e8f\u5217\u505a\u533a\u95f4\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u5462\uff1f\r\n\r\n\u6211\u4eec\u9884\u5904\u7406\u4e24\u4e2a\u4e1c\u897f\uff1a\r\n\r\n- $h_i$\uff0c\u8868\u793a\u4ec5\u8003\u8651\u524d $i$ \u4e2a\u5143\u7d20\uff0c\u7b97\u51fa\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u7684\u7ed3\u679c\u3002\r\n- $p_i$\uff0c\u8868\u793a\u7b2c $i$ \u4e2a\u5143\u7d20\u6240\u5904\u7684\u5168 $1$ \u6bb5\u6700\u540e\u4e00\u4e2a $1$ \u7684\u4f4d\u7f6e\u3002\u7279\u522b\u5730\uff0c\u82e5 $i$ \u4f4d\u7f6e\u662f $0$\uff0c\u90a3\u4e48 $p_i=i$\u3002\r\n\r\n\u5bb9\u6613\u9884\u5904\u7406\u4e0a\u9762\u7684\u4e24\u4e2a\u6570\u7ec4\u3002\u73b0\u5728\u8981\u8ba1\u7b97 $[l,r]$ \u533a\u95f4\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\uff0c\u90a3\u4e48\u7ed3\u679c\u5c31\u662f\uff1a\r\n\r\n$$h_r-h_{\\min\\{r,p_l\\}}+\\lfloor(\\min\\{r,p_l\\}-l)/2+1\\rfloor$$\r\n\r\n**\u89e3\u91ca**\uff1a\u4f7f\u7528\u505a\u5dee\u7684\u65b9\u6cd5\u8ba1\u7b97\u51fa $[\\min\\{r,p_l\\}+1,r]$ \u8fd9\u4e00\u6bb5\u7684\u6700\u5927\u70b9\u6743\u72ec\u7acb\u96c6\u7684\u503c\uff0c\u518d\u52a0\u4e0a $[l,\\min\\{r,p_l\\}]$ \u8fd9\u4e2a\u5168 $1$ \u6bb5\u7684\u8d21\u732e\u3002\r\n\r\n\u6700\u540e\u8bb2\u8bb2\u600e\u4e48\u5efa\u865a\u6811\u3002\u7ef4\u62a4 $F_i$ \u8868\u793a\u7b2c $i$ \u5217\u4ece\u6700\u4e0b\u9762\u5f80\u4e0a\u8d70\u8d70\u5230\u7684\u5173\u952e\u70b9\u7684\u7f16\u53f7\u3002\u5f53 $(i,i)$ \u4f4d\u7f6e\u5f80 $(i-1,a_i)$ \u8fde\u8fb9\u65f6\uff0c$(i-1,a_i)$ \u53d8\u6210\u4e86\u7b2c $a_i$ \u5217\u6700\u9760\u4e0b\u7684\u5173\u952e\u70b9\uff0c\u4f5c\u4e3a\u865a\u6811\u7684\u4e00\u5458\u5b83\u9996\u5148\u8981\u548c $F_{a_i}$ \u8fde\u4e0a\u8fb9\uff0c\u7136\u540e\u66f4\u65b0 $F_{a_i}$ \u7684\u503c\u3002\u56e0\u4e3a\u6700\u540e\u4e00\u884c\u5168\u90e8\u90fd\u4f1a\u662f\u5173\u952e\u70b9\uff0c\u6240\u4ee5\u6700\u540e\u518d\u5c06\u5b83\u4eec\u53d8\u6210\u5173\u952e\u70b9\u4e0e $F_i$ \u8fde\u8fb9\u5373\u53ef\u3002\r\n\r\n\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\r\n\r\n### \u53c2\u8003\u4ee3\u7801\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define up(l, r, i) for(int i = l, END##i = r;i <= END##i;++ i)\r\n#define dn(r, l, i) for(int i = r, END##i = l;i >= END##i;-- i)\r\nusing namespace std;\r\ntypedef long long i64;\r\nconst i64 INF = 1e18;\r\nint n;\r\nint qread(){\r\n    int w=1,c,ret;\r\n    while((c = getchar()) >  '9' || c <  '0') w = (c == '-' ? -1 : 1); ret = c - '0';\r\n    while((c = getchar()) >= '0' && c <= '9') ret = ret * 10 + c - '0';\r\n    return ret * w;\r\n}\r\nconst int MAXN = 1e6 + 3;\r\nconst int MAXM = 2e6 + 3;\r\nint R[MAXN], C[MAXN], A[MAXN], F[MAXN], G[MAXM], W[MAXM], o = 0;\r\nint X[MAXM]; i64 U[MAXM][4];\r\nint Y[MAXM]; i64 V[MAXM][4];\r\nint P0[MAXN], Q0[MAXN], P1[MAXN], Q1[MAXN];\r\nint value(int w){return w % 2 == 1 ? w / 2 + 1 : w / 2;}\r\nvoid calc(int l, int r, i64 &w, bool t){    // [l, r] \u533a\u95f4\r\n    if(r - l + 1 ==  0){w = 0   ; return;}\r\n    if(r - l + 1 == -1){w = 0   ; return;}\r\n    if(r - l + 1 == -2){w = -INF; return;}\r\n    if(t == false){\r\n        int u = min(Q0[l], r); w = P0[r] - P0[u] + ( R[l] == 1 ? value(u - l + 1) : 0);\r\n    } else {\r\n        int u = min(Q1[l], r); w = P1[r] - P1[u] + (!R[l] == 1 ? value(u - l + 1) : 0);\r\n    }\r\n}\r\nvoid calc(int l, int r, i64 O[4], bool t){  // [l + (0~1), r - (0~1)] \u533a\u95f4\r\n    calc(l    , r    , O[0b11], t);\r\n    calc(l    , r - 1, O[0b10], t);\r\n    calc(l + 1, r    , O[0b01], t);\r\n    calc(l + 1, r - 1, O[0b00], t);\r\n}\r\ni64 I[MAXM], J[MAXM];   // I \u662f\u5fc5\u987b\u9009\u4e0a\uff0cJ \u662f\u5fc5\u987b\u4e0d\u9009\r\nvoid dfs(int u){\r\n    if(X[u] == 0) I[u] = W[u], J[u] = 0; else {\r\n        int l = X[u], r = Y[u]; dfs(l), dfs(r);\r\n        I[u] = W[u]\r\n            + max(U[u][0b00] + I[l], U[u][0b01] + J[l])\r\n            + max(V[u][0b00] + I[r], V[u][0b01] + J[r]);\r\n        J[u] =\r\n            + max(U[u][0b10] + I[l], U[u][0b11] + J[l])\r\n            + max(V[u][0b10] + I[r], V[u][0b11] + J[r]);\r\n    }\r\n}\r\nint main(){ \r\n    n = qread();\r\n    up(1, n, i) R[i] = qread();\r\n    up(1, n, i) C[i] = qread();\r\n    up(2, n, i) A[i] = qread();\r\n    P0[1] = R[1], P1[1] = !R[1];\r\n    up(2, n, i){\r\n        P0[i] = max(P0[i - 1], P0[i - 2] +  R[i]);\r\n        P1[i] = max(P1[i - 1], P1[i - 2] + !R[i]);\r\n    }\r\n    Q0[n] = Q1[n] = n;\r\n    dn(n - 1, 1, i){\r\n        if( R[i] == 0) Q0[i] = i; else\r\n            if( R[i + 1] == 0) Q0[i] = i; else Q0[i] = Q0[i + 1];\r\n        if(!R[i] == 0) Q1[i] = i; else\r\n            if(!R[i + 1] == 0) Q1[i] = i; else Q1[i] = Q1[i + 1];\r\n    }\r\n    up(1, n - 1, i){\r\n        int t = A[i + 1], f = F[t]; // (i, t) \u662f\u7279\u6b8a\u70b9\r\n        F[t] = F[i + 1] = ++ o;     // \u7ed9\u7279\u6b8a\u70b9\u5206\u914d\u7f16\u53f7\r\n        if(f)\r\n            if(X[f]) Y[f] = o, calc(G[f] + 1, i - 1, V[f], C[t]);\r\n            else     X[f] = o, calc(G[f] + 1, i - 1, U[f], C[t]);\r\n        W[o] = R[i] ^ C[t], G[o] = i;\r\n    }\r\n    up(1, n, i){    // \u6700\u540e\u4e00\u5c42\u90fd\u662f\u7279\u6b8a\u70b9\r\n        int t = i, f = F[t]; ++ o, W[o] = R[n] ^ C[i];\r\n        if(f)\r\n            if(X[f]) Y[f] = o, calc(G[f] + 1, n - 1, V[f], C[t]);\r\n            else     X[f] = o, calc(G[f] + 1, n - 1, U[f], C[t]);\r\n    }\r\n    dfs(1); printf(\"%lld\\n\", max(I[1], J[1]));\r\n    return 0;\r\n}\r\n```",
        "postTime": 1669510639,
        "uid": 68344,
        "name": "\u79bb\u6563\u5c0f\u6ce2\u53d8\u6362\u00b0",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8877 \u3010[\u4f20\u667a\u676f #5 \u521d\u8d5b] I-\u4e0d\u6563\u7684\u5bb4\u4f1a\u3011"
    }
]