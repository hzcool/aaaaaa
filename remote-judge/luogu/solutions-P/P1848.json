[
    {
        "content": "\u8fd9\u9053\u9898\u9898\u610f\u8fd8\u662f\u5f88\u660e\u786e\u7684~~\u6211\u662f\u770b\u7740splay\u5237\u7684\u6ca1\u60f3\u5230\u662fdp\u3002~~\n\n\u9996\u5148\u9898\u76ee\u4e2d\u5f88\u8be6\u7ec6\u7684\u8bf4\u4e66\u8981\u4e00\u672c\u4e00\u672c\u653e\uff0c\u8fd9\u4fbf\u4e3a\u6211\u4eec\u7684\u52a8\u6001\u89c4\u5212\u5212\u5206\u597d\u4e86\u9636\u6bb5\u4e86\uff0c\u663e\u7136\u4e00\u4e2a\u72b6\u6001\u662f f[i]\u8868\u793a\u524di\u672c\u4e66\u653e\u5230\u4e86\u82e5\u5e72\u4e2a\u4e66\u67b6\u4e0a\u7684\u9ad8\u5ea6\u6700\u5c0f\u603b\u548c\u3002\n\n    f[i]=min{f[j]+cost[j+1][i]} \n\n    \u5176\u4e2dj\u2208flag-1~i-1 cost[j+1][i]=MAX{b[j+1]~b[i]};\n\n-    \u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u9700\u8981\u679a\u4e3e\u51b3\u7b56j \u590d\u6742\u5ea6\u662fn^2\u7684\u8003\u8651\u4f18\u5316\uff0c\u4f46\u662f\u663e\u7136\u6211\u4eec\u611f\u89c9\u4e0d\u592a\u597d\u4f18\u5316\uff0c\u6211\u4eec\u4ed4\u7ec6\u770b\u8fd9\u4e2a\u65b9\u7a0b\u53ef\u4ee5\u53d1\u73b0 \u5bf9\u4e8e k<=j f[k]<=f[j] \u8fd9\u8bf4\u660e\u4e86 \u662f\u5177\u6709\u5355\u8c03\u6027\u7684\u3002\n\n- \u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4e2ab\u6765\u8bf4\u90fd\u6709\u4e00\u4e2a\u63a7\u5236\u533a\u95f4\u5728\u6b64\u533a\u95f4\u5185\u6700\u5de6\u7aef\u7684\u7aef\u70b9\u662f\u6700\u4f18\u7684\uff0c\u5355\u8c03\u961f\u5217\u5b58\u50a8\u4e00\u4e0b\u8fd9\u4e2ab\u5355\u8c03\u9012\u51cf\u7684\u533a\u95f4\u7136\u540e \u6bcf\u6b21\u72b6\u6001\u8f6c\u79fb\u7528\u5f53\u524d\u533a\u95f4\u7684\u5de6\u7aef\u70b9+\u4e0b\u4e2a\u533a\u95f4\u7684b\u6765\u66f4\u65b0\u5373\u53ef\u3002\n\n- \u5c11\u4e86\u4e00\u70b9\u662f\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u51b3\u7b56\u70b9\u6211\u4eec\u5176\u5b9e\u8fd8\u6709\u4e00\u4e2a\u9690\u85cf\u7684\u51b3\u7b56\u70b9 \u5c31\u662fflag-1+\u7b2c\u4e00\u4e2a\u51b3\u7b56\u70b9\u3002\u6ce8\u610f\u597d\u8fd9\u4e9b\u5c31\u662f\u53ef\u4ee5\u5728\u4e0d\u5f00o2\u7684\u60c5\u51b5\u4e0b\u5f97\u523095\u5206\u3002\n\n```cpp\n// luogu-judger-enable-o2\n#include<iostream>\n#include<queue>\n#include<iomanip>\n#include<cctype>\n#include<cstdio>\n#include<deque>\n#include<utility>\n#include<cmath>\n#include<ctime>\n#include<cstring>\n#include<string>\n#include<cstdlib>\n#include<vector>\n#include<algorithm>\n#include<stack>\n#include<map>\n#include<set>\n#include<bitset>\n#define max(x,y) ((x)>(y)?(x):(y))\n#define min(x,y) ((x)>(y)?(y):(x))\n#define INF 1000000000\n#define ll long long\n#define l(x) t[x].l\n#define r(x) t[x].r\n#define sum(x) t[x].sum\n#define v(x) t[x].v\nusing namespace std;\nchar buf[1<<15],*fs,*ft;\ninline char getc()\n{\n    return (fs==ft&&(ft=(fs=buf)+fread(buf,1,1<<15,stdin),fs==ft))?0:*fs++;\n}\ninline ll read()\n{\n    ll x=0,f=1;char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\ninline void put(ll x)\n{\n    x<0?putchar('-'),x=-x:0;\n    ll num=0;char ch[50];\n    while(x)ch[++num]=x%10+'0',x/=10;\n    num==0?putchar('0'):0;\n    while(num)putchar(ch[num--]);\n    putchar('\\n');return;\n}\nconst ll MAXN=100010;\nll n,m,maxx,cnt,flag;\nll a[MAXN],b[MAXN];\nll f[MAXN];//f[i]\u8868\u793a\u524di\u672c\u4e66\u653e\u5165\u82e5\u5e72\u4e2a\u4e66\u67b6\u7684\u6700\u5c0f\u82b1\u8d39\u3002\nll q[MAXN],l,r;\nint main()\n{\n    //freopen(\"1.in\",\"r\",stdin);\n    n=read();m=read();\n    for(ll i=1;i<=n;++i)b[i]=read(),a[i]=read();\n    memset(f,0x3f3f3f3f,sizeof(f));\n    f[0]=0;flag=1;q[++r]=0;++l;\n    for(ll i=1;i<=n;++i)\n    {\n        cnt+=a[i];\n        while(cnt>m)++flag,cnt-=a[flag-1];\n        while(l<=r&&q[l]<flag)++l;\n        while(l<=r&&b[q[r]]<=b[i])--r;\n        q[++r]=i;\n        for(ll j=l;j<r;++j)f[i]=min(f[i],f[q[j]]+b[q[j+1]]);\n        f[i]=min(f[i],f[flag-1]+b[q[l]]);\n    }\n    put(f[n]);\n    return 0;\n}\n\n```\n\u5f53\u7136\u5c3d\u91cf\u8981\u4e0d\u5f00o2\u5c3d\u7ba1\u8fd9\u79cd\u4f18\u5316\u770b\u8d77\u6765\u975e\u5e38\u77ed\u975e\u5e38\u597d\u4f46\u662f\u4e0d\u591f\u4f18\u79c0\u3002\n\n\u8003\u8651\u7ebf\u6bb5\u6811\u4f18\u5316 \u7ebf\u6bb5\u6811\u4e0a\u5b58\u5728\u6bcf\u4e00\u4e2a\u70b9\u5305\u542b\u5f53\u524df\u503c\u5bf9\u4e8e\u6bcf\u4e00\u4e2ab\u6211\u4eec\u5c06\u5176\u66b4\u529b\u533a\u95f4\u8986\u76d6\u3002\n\n\u7136\u540e\u67e5\u8be2\u533a\u95f4\u6700\u5c0f\u503c\u4e5f\u5c31\u662f\u6700\u4f18\u51b3\u7b56\u5373\u53ef\u3002\u6ce8\u610f\u66b4\u529b\u8986\u76d6\u7684\u65f6\u5019\u8003\u8651\u65f6\u95f4\u590d\u6742\u5ea6\u6709\u70b9\u9ad8\uff0c\u91c7\u53d6\u4e24\u4e2a\u4f18\u5316\u7ebf\u6bb5\u6811\u4e2d\u5b58\u4e00\u4e2as h \u4e00\u4e2a\u9ad8\u5ea6\u53d6\u6700\u5927\u4e00\u4e2a\u9ad8\u5ea6\u53d6\u6700\u5c0f\uff0c\u5982\u679c\u6700\u5c0f\u9ad8\u5ea6>=b\u76f4\u63a5\u8df3\u8fc7\uff0c\u5982\u679c\u5f53\u524d\u6700\u5927\u9ad8\u5ea6<=b\u5219\u61d2\u6807\u8bb0\u76f4\u63a5\u533a\u95f4\u8986\u76d6\u5373\u53ef\u3002\n\n- \u590d\u6742\u5ea6\u7684\u8bc1\u660e\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u503c\u5404\u4e0d\u76f8\u540c\u7684\u533a\u95f4\u7b2c\u4e00\u6b21\u80af\u5b9a\u662f\u66b4\u529b\u8986\u76d6 \u7136\u540e\u53d8\u6210\u4e86\u4e00\u4e2a\u5355\u8c03\u9012\u51cf\u7684 \u8fd9\u6837\u7684\u8bdd\u4e0b\u4e00\u6b21\u4fee\u6539\u4e00\u90e8\u5206\u662f\u76f4\u63a5\u533a\u95f4\u8986\u76d6\u4e86\uff0c\u4e00\u90e8\u5206\u662f\u8df3\u8fc7\u4e86\u8df3\u8fc7\u4e86\u3002\u7136\u540e\u5747\u644a\u590d\u6742\u5ea6\u4ecd\u4e3anlogn.\u5f88\u5b8c\u7f8e\u7684\u89e3\u51b3\u4e86\u8fd9\u79cd\u7c7b\u578b\u7684dp\u4f18\u5316\u3002\n\n- \u5f53\u7136\u8fd8\u6709set\u4f18\u5316\u4e0d\u8fc7\u5f88\u4e0d\u597d\u5199\uff08~~\u6211\u4e0a\u6b21\u5199set\u4f18\u5316\u771f\u7684\u96be\u53d7\u6b7b\u4e86~~\u90a3\u5c31\u5206\u4eab\u4e24\u79cd\u4f18\u5316\u65b9\u6cd5\u597d\u4e86~\n\n-     segmenttree\uff1a\n\n```cpp\n#include<iostream>\n#include<queue>\n#include<iomanip>\n#include<cctype>\n#include<cstdio>\n#include<deque>\n#include<utility>\n#include<cmath>\n#include<ctime>\n#include<cstring>\n#include<string>\n#include<cstdlib>\n#include<vector>\n#include<algorithm>\n#include<stack>\n#include<map>\n#include<set>\n#include<bitset>\n#define max(x,y) ((x)>(y)?(x):(y))\n#define min(x,y) ((x)>(y)?(y):(x))\n#define INF 10000000000000ll\n#define ll long long\n#define l(x) t[x].l\n#define r(x) t[x].r\n#define sum(x) t[x].sum\n#define s(x) t[x].s\n#define h(x) t[x].h\n#define tag(x) t[x].tag\n#define g(x) t[x].g\nusing namespace std;\nchar buf[1<<15],*fs,*ft;\ninline char getc()\n{\n    return (fs==ft&&(ft=(fs=buf)+fread(buf,1,1<<15,stdin),fs==ft))?0:*fs++;\n}\ninline int read()\n{\n    int x=0,f=1;char ch=getc();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getc();}\n    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getc();}\n    return x*f;\n}\ninline void put(ll x)\n{\n    x<0?putchar('-'),x=-x:0;\n    int num=0;char ch[50];\n    while(x)ch[++num]=x%10+'0',x/=10;\n    num==0?putchar('0'):0;\n    while(num)putchar(ch[num--]);\n    putchar('\\n');return;\n}\nconst int MAXN=100010;\nint n,m,flag;\nint a[MAXN],b[MAXN];\nll f[MAXN],maxx,cnt;//f[i]\u8868\u793a\u524di\u672c\u4e66\u653e\u5165\u82e5\u5e72\u4e2a\u4e66\u67b6\u7684\u6700\u5c0f\u82b1\u8d39\u3002\ninline ll min1(ll x,ll y){return x>y?y:x;}\ninline ll max1(ll x,ll y){return x>y?x:y;}\nstruct wy\n{\n    int l,r;\n    ll sum,g;\n    ll h,s;\n    int tag;\n}t[MAXN<<2];\ninline void build(int p,int l,int r)\n{\n    l(p)=l;r(p)=r;\n    if(l==r)return;\n    int mid=(l+r)>>1;\n    build(p<<1,l,mid);\n    build(p<<1|1,mid+1,r);\n    return;\n}\ninline void pushdown(int p)\n{\n    tag(p<<1)=tag(p<<1|1)=tag(p);\n    s(p<<1)=s(p<<1|1)=h(p<<1)=h(p<<1|1)=tag(p);\n    sum(p<<1)=g(p<<1)+tag(p);\n    sum(p<<1|1)=g(p<<1|1)+tag(p);\n    tag(p)=0;return;\n}\ninline void change(int p,int l,int r,int x)\n{\n    if(h(p)>=x)return;\n    if(l<=l(p)&&r>=r(p))\n        if(s(p)<=x)\n        {\n            tag(p)=x;s(p)=h(p)=x;\n            sum(p)=h(p)+g(p);\n            return;\n        }\n    if(tag(p))pushdown(p);\n    int mid=(l(p)+r(p))>>1;\n    if(l<=mid)change(p<<1,l,r,x);\n    if(r>mid)change(p<<1|1,l,r,x);\n    s(p)=max(s(p<<1),s(p<<1|1));\n    h(p)=min(h(p<<1),h(p<<1|1));\n    g(p)=min(g(p<<1),g(p<<1|1));\n    sum(p)=min(sum(p<<1),sum(p<<1|1));\n}\ninline ll ask(int p,int l,int r)\n{\n    if(l<=l(p)&&r>=r(p))return sum(p);\n    int mid=(l(p)+r(p))>>1;\n    ll cnt=INF;\n    if(tag(p))pushdown(p);\n    if(l<=mid)cnt=min1(cnt,ask(p<<1,l,r));\n    if(r>mid)cnt=min1(cnt,ask(p<<1|1,l,r));\n    s(p)=max(s(p<<1),s(p<<1|1));\n    h(p)=min(h(p<<1),h(p<<1|1));\n    sum(p)=min(sum(p<<1),sum(p<<1|1));\n    g(p)=min(g(p<<1),g(p<<1|1));\n    return cnt;\n}\ninline void insert(int p,int x)\n{\n    if(l(p)==r(p)){g(p)=f[x];return;}\n    int mid=(l(p)+r(p))>>1;\n    if(tag(p))pushdown(p);\n    if(x<=mid)insert(p<<1,x);\n    else insert(p<<1|1,x);\n    g(p)=min(g(p<<1),g(p<<1|1));\n}\nint main()\n{\n    //freopen(\"1.in\",\"r\",stdin);\n    n=read();m=read();\n    for(int i=1;i<=n;++i)b[i]=read(),a[i]=read();\n    build(1,0,n);f[0]=0;flag=1;\n    for(int i=1;i<=n;++i)\n    {\n        cnt+=a[i];\n        while(cnt>m)++flag,cnt-=a[flag-1];\n        change(1,flag-1,i-1,b[i]);\n        f[i]=ask(1,flag-1,i-1);\n        //cout<<f[i]<<' ';\n        if(i!=n)insert(1,i);\n    }\n    put(f[n]);\n    return 0;\n}\n```\n\u5b8c\u5de5~",
        "postTime": 1557701902,
        "uid": 59688,
        "name": "chdy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "\u6709\u795e\u4ed9\u94a6\u5b9a\u6211\u5199\u4e00\u7bc7\u9898\u89e3\uff0c\u6211\u5199\u4e00\u7bc7\u597d\u4e86\u3002\n\n~~\u81ea\u5df1\u90fd\u5fd8\u4e86\u600e\u4e48\u505a\u4e86~~\n\n\u5148\u4ece\u4e00\u4e2a naive \u7684 $O(n^2)$ dp \u5f00\u59cb\u8bb2\u8d77\u3002\n\n$f_i$ \u8868\u793a\u7b2c $i$ \u672c\u4e66\u7ed3\u5c3e\u65f6\u9ad8\u5ea6\u548c\u7684\u6700\u5c0f\u503c\u3002\n\n$$f_i=\\min(f_j+\\max(h_{j+1},...,h_i))(w_{j+1}+...+w_i\\leq L)$$\n\n$w$ \u8fd9\u4e2a\u9650\u5236\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7**\u4e8c\u5206**\u5f97\u5230\u3002\n\n\u73b0\u5728\u6211\u4eec\u628a\u95ee\u9898\u8f6c\u5316\u6210\uff1a\n\n$$f_i=\\min(f_j+\\max(h_{j+1},...,h_i))(pos_i\\leq j)$$\n\n\u5176\u4e2d $pos_i$ \u4e3a\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u7684**\u6700\u5de6\u7aef\u70b9**\u3002\n\n\u90a3\u4e48\uff0c\u8fd9\u9053\u9898\u5c31\u6210\u4e3a\u4e00\u9053\u975e\u5e38\u5957\u8def\u7684\u7ebf\u6bb5\u6811\u4f18\u5316 dp \u4e86\u3002\n\n\u76f8\u4fe1\u5927\u5bb6\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e0b\u9762\u7684\u64cd\u4f5c\u90fd\u4f1a\u5427\uff1a\n\n- 1. \u533a\u95f4\u8d4b\u503c\n\n- 2. \u533a\u95f4\u53d6 $\\min$\n\n- 3. \u5355\u70b9\u4fee\u6539\n\n\u9996\u5148\uff0c\u6211\u4eec\u5148\u5f00\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e\u627e\u51fa\u7b2c\u4e00\u4e2a\u5927\u4e8e $h_i$ \u7684\u4f4d\u7f6e $l$\uff0c\u5e76\u5c06 $[l+1,i]$ \u8fd9\u6bb5\u533a\u95f4\u5185\u7684 $h$ \u8d4b\u4e3a $h_i$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u7684 $f$ \u662f\u786e\u5b9a\u7684\uff0c\u6211\u4eec\u6bcf\u6b21\u53ea\u9700\u533a\u95f4\u4fee\u6539 $h$ \u7684\u503c\uff0c\u7136\u540e\u7ef4\u62a4 $f+h$ \u548c $f$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u67e5\u8be2\u5c31\u76f4\u63a5\u5728\u4e00\u6bb5\u533a\u95f4\u4e0a\u67e5\u5c31\u884c\u4e86\u3002\n\n\u987a\u4fbf\u4e00\u63d0\uff0c\u8fd9\u9898\u56e0\u4e3a $L$ \u662f\u7ed9\u5b9a\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u3002\u5982\u679c\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $L_i$ \u662f\u4e0d\u56fa\u5b9a\u7684\uff0c\u8fd9\u9053\u9898\u5c31\u53ea\u80fd\u7528 $\\log$ \u6570\u636e\u7ed3\u6784\u4e86\u3002\n\n$Code\\ Below:$\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define lson (rt<<1)\n#define rson (rt<<1|1)\nusing namespace std;\nconst int maxn=100000+10;\nconst ll inf=1e18;\nint n,L,w[maxn],h[maxn],pre[maxn],sta[maxn],top;ll sum[maxn],f[maxn],Min[maxn<<2],val[maxn<<2],tag[maxn<<2];\n// Min \u4e3a f + h \u7684\u6700\u5c0f\u503c\n// val \u4e3a f \u7684\u6700\u5c0f\u503c\n\ninline int read()\n{\n\tregister int x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn (f==1)?x:-x;\n}\n\ninline void pushup(int rt)\n{\n\tMin[rt]=min(Min[lson],Min[rson]);\n\tval[rt]=min(val[lson],val[rson]);\n}\n\ninline void pushdown(int rt)\n{\n\tif(tag[rt]!=inf)\n\t{\n\t\tMin[lson]=val[lson]+tag[rt];\n\t\tMin[rson]=val[rson]+tag[rt];\n\t\ttag[lson]=tag[rson]=tag[rt];tag[rt]=inf;\n\t}\n}\n\nvoid build(int l,int r,int rt)\n{\n\tMin[rt]=val[rt]=tag[rt]=inf;\n\tif(l == r) return ;\n\tint mid=(l+r)>>1;\n\tbuild(l,mid,lson);build(mid+1,r,rson);\n}\n\nvoid update(int L,int R,int C,int l,int r,int rt)\n{\n\tif(L <= l && r <= R)\n\t{\n\t\tMin[rt]=val[rt]+C;tag[rt]=C;\n\t\treturn ;\n\t}\n\tpushdown(rt);\n\tint mid=(l+r)>>1;\n\tif(L <= mid) update(L,R,C,l,mid,lson);\n\tif(R > mid) update(L,R,C,mid+1,r,rson);\n\tpushup(rt);\n}\n\nvoid modify(int x,int l,int r,int rt)\n{\n\tif(l == r)\n\t{\n\t\tMin[rt]=inf;val[rt]=f[l-1];\n\t\treturn ;\n\t}\n\tpushdown(rt);\n\tint mid=(l+r)>>1;\n\tif(x <= mid) modify(x,l,mid,lson);\n\telse modify(x,mid+1,r,rson);\n\tpushup(rt);\n}\n\nll query(int L,int R,int l,int r,int rt)\n{\n\tif(L <= l && r <= R) return Min[rt];\n\tpushdown(rt);\n\tint mid=(l+r)>>1;ll ans=inf;\n\tif(L <= mid) ans=min(ans,query(L,R,l,mid,lson));\n\tif(R > mid) ans=min(ans,query(L,R,mid+1,r,rson));\n\treturn ans;\n}\n\nint main()\n{\n\tn=read(),L=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\th[i]=read(),w[i]=read();\n\t\tsum[i]=sum[i-1]+w[i];\n\t}\n\tsta[++top]=1;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\twhile(top&&h[i]>h[sta[top]]) top--;\n\t\tif(top) pre[i]=sta[top];\n\t\tsta[++top]=i;\n\t}\n\tbuild(1,n,1);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tmodify(i,1,n,1);//\u521d\u59cb\u5316\u51b3\u7b56\u70b9\n\t\tif(pre[i]+1<=i) update(pre[i]+1,i,h[i],1,n,1);// \u533a\u95f4\u8d4b\u503c\n\t\tint l=lower_bound(sum,sum+i+1,sum[i]-L)-sum;//\u4e8c\u5206\u5de6\u7aef\u70b9\n\t\tif(l<i) f[i]=query(l+1,i,1,n,1);//\u533a\u95f4\u67e5\u8be2\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1557907565,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "\u9996\u5148\u8fd9\u9053\u9898\u76ee\u7684\u6700\u57fa\u672c\u7684n^2dp\u8981\u4f1a\n\n\u90a3\u4e48\u4e4b\u540e\u5c31\u67092\u79cd\u505a\u6cd5\n\n###\u7ebf\u6bb5\u6811\n\n\u9996\u5148\u8fd9\u9053\u9898\u76ee\u7684\u66b4\u529bdp\u90a3\u662f\u663e\u7136\u7684\n\nf[i]\u53ef\u4ee5\u4ecef[j-1]+max(h[j]\u2026\u2026h[i])\u63a8\u5f97\n\n\u4e0d\u96be\u53d1\u73b0\u65e0\u8bba\u662ff[]\u8fd8\u662f\u5f53j\u786e\u5b9a\u7684max(h[j]\u2026\u2026h[i])\uff0c\u90fd\u662f\u5355\u8c03\u7684\uff1b\n\n\u90a3\u4e48\u6211\u4eec\u5927\u529b\u7ebf\u6bb5\u6811\uff1b\n\n\u5bf9\u4e8e\u4e00\u4e2a\u65b0\u52a0\u5165\u7684i\u70b9\n\n\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u7ef4\u62a4h[j]=max(h[j]\u2026\u2026h[i])\uff0c\u987a\u4fbf\u5427\u7b54\u6848\u7ef4\u62a4\u4e86;\n\n\u7136\u540e\u5355\u8c03\u961f\u5217\u83b7\u5f97\u4e00\u6bb5\u7b54\u6848\u7684\u53ef\u884c\u533a\u95f4last~i\n\n\u90a3\u4e48\u5728\u8fd9\u6bb5\u533a\u95f4\u91cc\u53d6\u7b54\u6848\uff1b\n\n\u6700\u540e\u628a\u7b54\u6848\u653e\u5230f[i+1]\n\n\u6362\u53e5\u8bdd\u8bf4\u4e00\u5f00\u59cb\u7684f[1]\u662f0\n\n\u8fd9\u6837\u7684\u8bdd\u6bcf\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u7684\u7b54\u6848\u521a\u521a\u597d\u5c31\u662ff[j]+h[j]\n\n\n```cpp\n#include<bits/stdc++.h>\n#define Ll long long\nusing namespace std;\nconst int N=1e5+5;\nstruct tree{int l,r,h,H,lazy;Ll f,v;}T[N*4];\nint q[N],last;\nint n,L,x,y;\nLl sum,ans;\nvoid make(int id,int l,int r){\n    T[id].l=l;T[id].r=r;\n    if(l==r)return;\n    int mid=l+r>>1;\n    make(id*2  ,l,mid  );\n    make(id*2+1,mid+1,r);\n}\nvoid push(int id){\n    if(T[id].lazy==0||T[id].l==T[id].r)return;\n    int x=id*2,y=x+1;\n    T[x].H=T[x].h=T[y].H=T[y].h=T[x].lazy=T[y].lazy=T[id].lazy;\n    T[x].v=T[x].f+T[x].H;T[y].v=T[y].f+T[y].H;T[id].lazy=0;\n}\nvoid change(int id,int l,int r,int x){\n    push(id);\n    if(l<=T[id].l&&T[id].r<=r){\n        if(T[id].H<x){\n            T[id].H=T[id].h=T[id].lazy=x;\n            T[id].v=T[id].f+x;\n        }else{\n            if(T[id*2  ].h<x)change(id*2  ,l,r,x);\n            if(T[id*2+1].h<x)change(id*2+1,l,r,x);\n            T[id].H=max(T[id*2].H,T[id*2+1].H);\n            T[id].h=min(T[id*2].h,T[id*2+1].h);\n            T[id].v=min(T[id*2].v,T[id*2+1].v);\n        }return;\n    }\n    if(T[id*2  ].r>=l)change(id*2  ,l,r,x);\n    if(T[id*2+1].l<=r)change(id*2+1,l,r,x);   \n    T[id].H=max(T[id*2].H,T[id*2+1].H);\n    T[id].h=min(T[id*2].h,T[id*2+1].h);\n    T[id].v=min(T[id*2].v,T[id*2+1].v);\n}\nLl out(int id,int l,int r){\n    push(id);\n    if(l<=T[id].l&&T[id].r<=r){\n//        if(l==4&&r==5)cout<<id<<' '<<T[id].h<<endl;\n        return T[id].v;\n    }\n    Ll ans=1e18;\n    if(T[id*2  ].r>=l)ans=min(ans,out(id*2  ,l,r));\n    if(T[id*2+1].l<=r)ans=min(ans,out(id*2+1,l,r));\n    return ans;\n}\nvoid add(int id,int x,Ll f){\n    push(id);\n    if(T[id].l==T[id].r){T[id].f=f;return;}\n    if(T[id*2].r>=x)add(id*2,x,f);else add(id*2+1,x,f);\n    T[id].f=min(T[id*2].f,T[id*2+1].f);\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&L);\n    last=1;\n    make(1,1,n);\n    for(int i=1;i<=n;i++){\n        scanf(\"%d%d\",&x,&q[i]);\n        sum+=q[i];\n        while(sum>L)sum-=q[last++];\n        change(1,1,i,x);\n        ans=out(1,last,i);\n        if(i!=n)add(1,i+1,ans);\n    }printf(\"%lld\",ans);\n}\n```\n###\u5355\u8c03\u961f\u5217\n\n\u5355\u8c03\u961f\u5217\u8c03\u51fa\u6765\u4e86\u54c8\u54c8\uff1b\n\n\u611f\u89c9\u5355\u8c03\u961f\u5217\u5e76\u6ca1\u6709\u6570\u636e\u7ed3\u6784\u90a3\u4e48\u66b4\u529b\u90a3\u4e48\u597d\u6253\uff1b\n\n\u8fd9\u79cd\u505a\u6cd5\u5b8c\u5168\u4f9d\u8d56\u4e8e\u8fd9\u9053\u9898\u76ee\u7684\u5355\u8c03\u6027\uff1b\n\n\u9996\u5148\u5148\u8bf4\u51e0\u70b9\n\n\u6211\u7684\u5199\u6cd5\u8c8c\u4f3c\u5e76\u4e0d\u662f\u5f88\u5feb\uff0c\u800c\u4e14\u5728\u4e0d\u5f00O2\u7684\u60c5\u51b5\u4e0b\u662f\u6bd4\u7ebf\u6bb5\u6811\u8fd8\u8981\u6162\u70b9\uff1b\n\n\u5f00\u4e86o2\u5c31\u662f\u5f88\u5feb\u7684\u5566\uff1b\n\n\u7136\u540e\u5bf9\u4e8e\u8fd9\u4e2aset\u6211\u6bcf\u8fdb\u8fdb\u884c\u4e00\u6b21\u63d2\u5165\u5220\u9664\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u4e2alog\u7684\u65f6\u95f4\uff0c\u6211\u7684\u7a0b\u5e8f\u662f\u5e26\u6709\u5f88\u5927\u7684\u5e38\u6570\u7684\uff0c\u4f46\u611f\u89c9\u4e5f\u662f\u57fa\u672c\u7684\u4e00\u79cd\u505a\u6cd5\uff1b\n\n\n\u5bf9\u4e8e\u57fa\u672c\u7684n^2\u7684dp\u6211\u5c31\u4e0d\u5728\u8d58\u8ff0\u4e86\uff1b\n\n\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8bfb\u5165i\n\n\u9996\u5148\u5c31\u662f\u9700\u8981\u786e\u5b9a\u53ef\u5411\u5de6\u8fb9\u6269\u5c55\u7684\u6700\u8fdc\u70b9last\n\n\u7136\u540e\u6839\u636eh[i]\u53bb\u66f4\u65b0\u8fd9\u6bb5\u533a\u95f4\u91cc\u7684h[j]\uff1b\n\n\u7136\u540e\u628alast~i\u8fd9\u6bb5\u533a\u95f4\u7684\u7b54\u6848\u5168\u653e\u5230\u4e00\u4e2aset\u91cc\u9762\u53bb\n\n\u6700\u540e\u53bb\u4e00\u4e2a\u6700\u5c0f\u503c\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684f[i]\uff1b\n\n\u4e8e\u662f\u6211\u5f00\u4e86\u4e00\u4e2a\u961f\u5217q\n\n\u4ee3\u8868\u73b0\u5728last~i\u8fd9\u6bb5\u533a\u95f4\u91cc\uff0c\u9ad8\u5ea6\u4e3ah[j]\u6700\u9760\u524d\u7684\u4e0b\u6807\n\n\u56e0\u4e3a\u5f53i\u786e\u5b9a\u7684\u65f6\u5019\uff0ch[j]>=h[j+1]\n\n\u5e76\u4e14h[j]\u6709\u5f88\u591a\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u628ah[j]\u5408\u5e76\u8d77\u6765\n\n\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e2ai\uff0c\u5148\u628ai\u653e\u5230q\u91cc\u9762\uff0c\u7136\u540e\u4e0d\u65ad\u627eh[q[top]]<=h[i]\u628a\u4ed6\u5f39\u51fa\n\n\u4e4b\u540e\u518d\u628ah[j]<=h[i]\u7684\u6700\u9760\u524d\u7684\u91cd\u65b0\u63d2\u5165\uff0c\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5c31\u53ef\u4ee5\u7ef4\u62a4\u5173\u4e8eh[j]\u4e86\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5982\u4f55\u5220\u9664\u5230\u4e0d\u4e86\u7684\u70b9\uff0c\u5c31\u662f\u66f4\u65b0last\u503c\n\n\u9996\u5148\u6211\u4eec\u5224\u65ad\u5f53\u524d\u7684\u70b9\u662f\u5426\u5728q\u91cc\u9762\uff0c\u5982\u679c\u5728\u7684\u8bdd\u5c31\u4ece\u961f\u9996\u5f39\u51fa\uff0c\u4e0d\u5728\u7684\u8bdd\uff0c\u6211\u4eec\u628ah[j]\u8ddf\u65b0\u4e3ah[j-1]\n\n\u4e3a\u4ec0\u4e48\u5462\uff0c\u56e0\u4e3a\u6211\u4eec\u7ef4\u62a4h[j]\u76f8\u540c\u7684\u4e00\u5757\u7684\u65f6\u5019\u6211\u4eec\u53ea\u662f\u66f4\u65b0\u4e86h[j]\u503c\u76f8\u540c\u7684\u6700\u524d\u9762\u7684\u4e00\u70b9\uff0c\u5e76\u4e14\u628a\u8fd9\u4e2a\u70b9\u653e\u5230\u4e86q\u91cc\u9762\uff0c\u90a3\u4e48\u4e4b\u540e\u7684\u70b9\u7684h[j]\u503c\u5176\u5b9e\u5c31\u662fh[j-1]\uff0c\n\n\u6700\u540e\u6211\u4eec\u8981\u770b\u770b\u73b0\u5728\u7684last\u503c\u662f\u4e0d\u662f\u5728\u961f\u5217\u91cc\u9762\uff0c\u5982\u679c\u4e0d\u5728\u7684\u8bdd\u8981\u4ece\u961f\u9996\u538b\u5165\uff1b\n\n\u5982\u679c\u6ca1\u542c\u61c2\u90a3\u4e48\u5f88\u62b1\u6b49\uff0c\u6211\u7684\u8bed\u6587\u6c34\u5e73\u8c8c\u4f3c\u592a\u5dee\u4e86\n\n\u5176\u5b9e\u5c31\u662f\u627e\u5230\u5355\u8c03\u6027\u7684h[j]\u89c4\u5f8b\u800c\u5df2\n\n\u81f3\u4e8e\u90a3\u4e2ain[j]\u5c31\u4ee3\u8868j\u6709\u6ca1\u6709\u5728q\u91cc\u9762\n\n\n```cpp\n#include<bits/stdc++.h>\n#define Ll long long\nusing namespace std;\nconst Ll N=1e5+5;\nLl h[N],w[N],f[N],q[N],top;\nbool in[N];\nmultiset<Ll>S;\nLl n,m,last,sum,l;\nint main()\n{\n    scanf(\"%lld%lld\",&n,&m);\n    l=last=1;in[1]=1;\n    for(Ll i=1;i<=n;i++){\n        scanf(\"%lld%lld\",&h[i],&w[i]);\n        sum+=w[i];\n        while(sum>m){\n            if(in[last])S.erase(f[last-1]+h[last]),l++;else h[last]=h[last-1];\n            in[last]=0;sum-=w[last++];    \n        }\n        if(!in[last]){\n            in[last]=1;q[--l]=last;h[last]=h[last-1];\n            S.insert(f[last-1]+h[last]);\n        }\n        q[++top]=i;S.insert(f[i-1]+h[i]);in[i]=1;\n        while(top>=l&&h[q[top]]<=h[i]){\n            in[q[top]]=0;\n            S.erase(f[q[top]-1]+h[q[top]]);\n            top--;        \n        }\n        in[q[++top]]=1;\n        h[q[top]]=h[i];\n        S.insert(f[q[top]-1]+h[q[top]]);\n        f[i]=*S.begin();\n    }\n    printf(\"%lld\",f[n]);\n}\n```",
        "postTime": 1504070525,
        "uid": 7442,
        "name": "\u5de8\u578b\u65b9\u5757",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "\u8c03\u4e86\u4e00\u4e0b\u5348\uff0c\u5199\u7bc7\u9898\u89e3\u5e86\u795d\u4e00\u4e0b\n\n\u672c\u849f\u84bb\u8fd8\u4ece\u672a\u505a\u8fc7\u8fd9\u79cd dp \u7684\u4f18\u5316\n\n\u9996\u5148\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u7b80\u5355\u7684 dp \uff1a\u76f4\u63a5\u8bbe $dp(i)$ \u8868\u793a\u524d $i$ \u672c\u4e66\u7684\u6700\u5c0f\u9ad8\u5ea6\u548c\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\u8003\u8651\u5728\u524d $j$ \u672c\u4e66\u7684\u57fa\u7840\u4e0a\uff0c\u628a\u7b2c $j+1$ \u5230\u7b2c $i$ \u672c\u4e66\u653e\u5230\u65b0\u7684\u4e00\u5c42\uff0c\u4e8e\u662f\n\n$$\ndp(i) = \\min\\left\\{dp(j) + \\max_{k=j+1}^i\\{h_k\\}\\mid s_i-s_j\\leq L\\right\\}\n$$\n\n\u5176\u4e2d $s_i$ \u4e3a $w$ \u6570\u7ec4\u7684\u524d\u7f00\u548c\uff0c\u8fd9\u662f\u4e3a\u4e86\u6ee1\u8db3\u5bbd\u5ea6\u8981\u6c42\n\n\u8fd9\u4e2a dp \u662f $O\\left(n^2\\right)$ \u7684\uff1a\n\n```cpp\nvoid force() {\n  dp[1] = h[1];\n  for (int i = 2; i <= n; ++i) {\n    dp[i] = inf;\n    int mv = 0;\n    for (int j = i - 1; j >= 0; --j) {\n      if (s[i] - s[j] > L)\n        break;\n      if (h[j + 1] > mv)\n        mv = h[j + 1];\n      if (dp[j] + mv < dp[i])\n        dp[i] = dp[j] + mv;\n    }\n  }\n}\n```\n\n\u8003\u8651\u5bf9\u5b83\u8fdb\u884c\u4f18\u5316\u3002\n\n\u9996\u5148\u6211\u4eec\u53d1\u73b0\uff0c $mv_i(j)=\\max_{k=j+1}^i\\{h[k]\\}$ \u6709\u4e00\u4e2a\u7279\u70b9\uff1a\u5f53 $j$ \u9012\u51cf\u7684\u65f6\u5019\uff0c $mv$ \u7684\u503c\u662f\u4e00\u6bb5\u4e00\u6bb5\u53d8\u5316\u7684\u3002\n\n\u5982\u679c\u8bb0 $i$ \u5de6\u4fa7\u7b2c\u4e00\u4e2a\u6ee1\u8db3 $h_j>h_i$ \u7684 $j$ \u4e3a $lft(i)$ \uff0c\u6211\u4eec\u53d1\u73b0 $\\forall j\\in[lft(i)+1,i]$ \u90fd\u6709 $mv_i(j)=h_i$\u3002\n\n\u57fa\u4e8e\u8fd9\u4e2a\u6027\u8d28\u518d\u8003\u5bdf dp \u7684\u51b3\u7b56\uff1a\n\n\u5f53 $j,j+1\\in[lft(i)+1,i]$ \u65f6\uff0c\u4e24\u4e2a\u51b3\u7b56\u5206\u522b\u4e3a\n\n- $dp(j)+mv_i(j)$\n- $dp(j+1)+mv_i(j+1)$\n\n\u800c $mv_i(j)=mv_i(j+1)$ \uff0c\u53c8\u663e\u7136 $dp$ \u503c\u662f\u975e\u9012\u51cf\u7684\uff0c\u56e0\u6b64\u4ece $j$ \u8f6c\u79fb\u4e00\u5b9a\u6bd4\u4ece $j+1$ \u8f6c\u79fb\u66f4\u4f18\u3002\n\n\u6240\u4ee5\u5bf9\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u7684 $i$ \uff0c\u5b83\u53ef\u80fd\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u662f\u8fd9\u6837\u7684\uff1a\n\n![luogu](https://cdn.luogu.com.cn/upload/pic/42630.png)\n\n\u5176\u4e2d\u6bcf\u4e2a\u7ea2\u70b9\u662f\u53ef\u80fd\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u3002\u8fd9\u91cc\u6211\u4eec\u7528 $lb$ \u8868\u793a\u6ee1\u8db3 $s_i-s_j\\leq L$ \u7684\u6700\u5c0f\u7684 $j$ \uff0c\u8fd9\u4e2a\u53ef\u4ee5\u4e8c\u5206\u5f97\u5230\uff08\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u5c3a\u53d6\uff0c\u4f46\u5e76\u4e0d\u4f1a\u5bf9\u590d\u6742\u5ea6\u5e26\u6765\u4ec0\u4e48\u4f18\u5316\uff09\u3002\u5728 $lb$ \u5de6\u4fa7\u7684\u90a3\u4e2a\u7ea2\u70b9\u662f\u975e\u6cd5\u7684\uff0c\u4e0b\u9762\u4f1a\u63d0\u5230\u5982\u4f55\u5904\u7406\u3002\n\n\u8003\u8651\u6211\u4eec\u5982\u4f55\u5f97\u5230\u6bcf\u4e2a $i$ \u7684 $lft$ \u503c\uff0c\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u4fdd\u8bc1\u91cc\u9762\u7684\u5143\u7d20\u4ece\u4e0b\u5f80\u4e0a\u662f\u9012\u51cf\u7684\u3002\u5bf9\u4e8e\u4e00\u4e2a $i$ \uff0c\u5982\u679c\u6808\u9876\u5143\u7d20 $\\leq h_i$ \u5c31\u5f39\u51fa\uff0c\u8fd9\u6837\u4e4b\u540e\u6808\u9876\u5143\u7d20\u5c31\u662f $i$ \u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5927\u4e8e $h_i$ \u7684\u503c\u4e86\uff0c\u8bb0\u5f55\u4e00\u4e0b\u4e4b\u540e\u518d\u628a\u7b2c $i$ \u4e2a\u5143\u7d20\u52a0\u5165\u6808\u9876\u3002\uff08\u5b9e\u9645\u64cd\u4f5c\u65f6\u6808\u91cc\u901a\u5e38\u4fdd\u5b58\u4e0b\u6807\u800c\u4e0d\u662f\u771f\u5b9e\u503c\uff09\n\n```cpp\nwhile (top && h[s[top]] <= h[i])\n  --top;\ns[++top] = i;\n```\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5355\u8c03\u6808\u91cc\u7684\u5143\u7d20\u5c31\u6070\u5230\u5bf9\u5e94\u4e0a\u56fe\u4e2d\u7684\u6bcf\u4e2a\u7ea2\u70b9\u7684\u5de6\u8fb9\u4e00\u4e2a\u4f4d\u7f6e\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u7528\u5355\u8c03\u6808\u5c31\u5df2\u7ecf\u628a\u6240\u6709\u53ef\u80fd\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u653e\u8fdb\u4e86\u8fde\u7eed\u7684\u5e8f\u5217\u91cc\uff0c\u6211\u4eec\u53ea\u8981\u7528\u4e00\u4e2a\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u5355\u8c03\u6808\u4e2d\u6bcf\u4e00\u4e2a\u51b3\u7b56\u7684\u8868\u8fbe\u5f0f\uff0c\u7ef4\u62a4\u5176\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u652f\u6301\u5355\u70b9\u4fee\u6539\u3001\u533a\u95f4\u67e5\u6700\u5c0f\u503c\u7684\u7ebf\u6bb5\u6811\uff0c\u6211\u5199\u4e86\u7b80\u5355\u597d\u5199\u5e38\u6570\u5c0f\u7684 zkw \u7ebf\u6bb5\u6811\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$ \uff0c\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u6765\u5f97\u51fa\u5728 $lb$ \u53f3\u4fa7\u7684\u7b2c\u4e00\u4e2a\u51b3\u7b56\u70b9\u5728\u5355\u8c03\u6808\u4e2d\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u76f4\u63a5\u4ece\u7ebf\u6bb5\u6811\u4e0a\u8bfb\u7b54\u6848\u3002\u4f46\u662f\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff0c $lb$ \u5904\u53ef\u80fd\u4e5f\u662f\u4e00\u4e2a\u51b3\u7b56\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u4e8c\u5206\u627e\u5230 $lb$ \u7684\u5177\u4f53\u4f4d\u7f6e\uff0c\u7136\u540e\u8bfb\u53d6\u5b83\u7684\u7b54\u6848\u3002\n\n```cpp\nint l = 1, r = top, pos = 0;\nwhile (l <= r) {\n  int mid = (l + r) / 2;\n  if (sw[i] - sw[s[mid]] <= L) {\n    pos = mid;\n    r = mid - 1;\n  } else\n    l = mid + 1;\n}\nint pos2 = std::lower_bound(sw, sw + i + 1, sw[i] - L) - sw;\ndp[i] = std::min(query(pos + 1, top), dp[pos2] + h[s[pos]]);\n```\n\n\u540c\u65f6\u6ce8\u610f\uff0c\u5728\u5355\u8c03\u6808\u4e2d\u52a0\u5165 $i$ \u5143\u7d20\u7684\u65f6\u5019\u4e0d\u8981\u5fd8\u4e86\u5728\u7ebf\u6bb5\u6811\u4e0a\u4fee\u6539\uff1a\n\n```cpp\nwhile (top && h[s[top]] <= h[i])\n  --top;\ns[++top] = i;\nmodify(top, dp[s[top - 1]] + h[i]);\n```\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n\n```cpp\n#include <cctype>\n#include <cstdio>\n#include <climits>\n#include <algorithm>\n\n#define rep(i, a, b) for (int i = (a); i <= (b); ++i)\n#define dwn(i, a, b) for (int i = (a); i >= (b); --i)\n#define erp(i, x) for (int i = head[x]; i; i = next[i])\n\ntemplate <typename T> inline void read(T& t) {\n\tint f = 0, c = getchar(); t = 0;\n\twhile (!isdigit(c)) f |= c == '-', c = getchar();\n\twhile (isdigit(c)) t = t * 10 + c - 48, c = getchar();\n\tif (f) t = -t;\n}\ntemplate <typename T> void write(T x) {\n\tif (x < 0) x = -x, putchar('-');\n\tif (x > 9) write(x / 10);\n\tputchar(x % 10 + 48);\n}\ntemplate <typename T> inline void writeln(T x) {\n\twrite(x); puts(\"\");\n}\ntemplate <typename T> inline bool chkMin(T& x, const T& y) {\n\treturn y < x ? (x = y, 1) : 0;\n}\ntemplate <typename T> inline bool chkMax(T& x, const T& y) {\n\treturn x < y ? (x = y, 1) : 0;\n}\n\ntypedef long long LL;\nconst int maxn = 1e5 + 207;\nconst LL inf = 1e16;\nLL mv[maxn << 2];\nint M;\ninline void update(int o) { mv[o] = std::min(mv[o << 1], mv[o << 1 | 1]); }\ninline void build(int n) {\n\tfor (M = 1; M < n + 2; M <<= 1);\n\trep(i, M + 1, M + n) mv[i] = inf;\n\tdwn(i, M - 1, 1) update(i);\n}\ninline void modify(int x, LL nv) { for (mv[x += M] = nv, x >>= 1; x; update(x), x >>= 1); }\ninline LL query(int s, int t) {\n\tLL ans = inf;\n\tfor (--s += M, ++t += M; s ^ t ^ 1; s >>= 1, t >>= 1) {\n\t\tif (~s & 1) chkMin(ans, mv[s ^ 1]);\n\t\tif (t & 1) chkMin(ans, mv[t ^ 1]);\n\t}\n\treturn ans;\n}\n\nLL h[maxn], w[maxn], sw[maxn], dp[maxn], L;\nint s[maxn];\nint n, top;\n\nint main() {\n\tread(n); read(L);\n\trep(i, 1, n) {\n\t\tread(h[i]); read(w[i]);\n\t\tsw[i] = sw[i - 1] + w[i];\n\t}\n\tbuild(n + 1);\n\ts[top = 1] = 0;\n\tmodify(1, 0);\n\trep(i, 1, n) {\n\t\twhile (top && h[s[top]] <= h[i]) --top;\n\t\ts[++top] = i;\n\t\tmodify(top, dp[s[top - 1]] + h[i]);\n\t\tint l = 1, r = top, pos = 0;\n\t\twhile (l <= r) {\n\t\t\tint mid = (l + r) >> 1;\n\t\t\tif (sw[i] - sw[s[mid]] <= L) pos = mid, r = mid - 1;\n\t\t\telse l = mid + 1;\n\t\t}\n\t\tint pos2 = std::lower_bound(sw, sw + i + 1, sw[i] - L) - sw;\n\t\tdp[i] = std::min(query(pos + 1, top), dp[pos2] + h[s[pos]]);\n\t}\n\twriteln(dp[n]);\n\treturn 0;\n}\n```",
        "postTime": 1541591134,
        "uid": 72071,
        "name": "GKxx",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "\u9898\u610f:https://www.luogu.org/problem/P1848\n\n\u6709\u9053\u5f31\u5316\u7248\uff1a\n\nP1295 [TJOI2011]\u4e66\u67b6:https://www.luogu.org/problem/P1295\n\n\u8fd9\u4e24\u9053\u9898\u672c\u8d28\u662f\u4e00\u6837\u7684,\u4e0a\u9762\u90a3\u9053$W[]$\u548c$h[]$\u662f\u540c\u4e00\u4e2a\u6570\u7ec4,\u5176\u4ed6\u6ca1\u6709\u4efb\u4f55\u533a\u522b\n\n\u5b9a\u4e49$sum[i]=\\sum_{i=1}^iW[i]$\n\n\u8bbe$f[i]$\u8868\u793a\u653e\u7f6e$1~i$\u7684\u4e66\u7684\u6700\u5c0f\u4ee3\u4ef7\n\n$f[i]=min(f[j-1]+max(h[j],h[j+1]...h[i]))(sum[i]-sum[j-1]<=L)$\n\n\u5bf9\u4e8e\u6bcf\u4e2ai,\u5904\u7406\u51fa$h[i]$\u5411\u5de6\u7b2c\u4e00\u4e2a\u5927\u4e8e\u5b83\u7684\u4f4d\u7f6e$pre[i]$,\u8fd9\u4e2a\u7528\u5355\u8c03\u6808\u5373\u53ef\n\n\u5bf9\u4e8e$[pre[i]+1,i]$,\u6700\u5927\u7684$h[]$\u662f\u5b9a\u503c,\u53ea\u9700\u8981\u627e\u5230\u6700\u5927\u7684$f[j-1]$\u5373\u53ef\n\n\u4ee5\u4e0b\u7edf\u79f0\u6700\u5927\u7684$h[]$\u4e3a$max$\n\n\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u7ef4\u62a4$[l,r]$\u4e2d$f[]$\u7684\u6700\u5c0f\u503c,$max$\u548c$f[]+max$\u7684\u6700\u5c0f\u503c\u5373\u53ef\n\ncode:\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define ls(p) (p<<1)\n#define rs(p) (p<<1|1)\n#define minn(p) (seg[p].minn)\n#define val(p) (seg[p].val)\n#define tag(p) (seg[p].tag)\nconst int maxn=100010;\nconst int inf=1e18;\nint n,m,top;\nint a[maxn],b[maxn],sum[maxn],pre[maxn],s[maxn],f[maxn];\nstruct Seg\n{\n\tint minn,val,tag;\n}seg[maxn<<2];\ninline void up(int p)\n{\n\tminn(p)=min(minn(ls(p)),minn(rs(p)));\n\tval(p)=min(val(ls(p)),val(rs(p)));\n}\ninline void down(int p)\n{\n\tif(tag(p)==inf)return;\n\tminn(ls(p))=val(ls(p))+tag(p);\n\tminn(rs(p))=val(rs(p))+tag(p);\n\ttag(ls(p))=tag(rs(p))=tag(p);tag(p)=inf;\n}\nvoid build(int p,int l,int r)\n{\n\tif(l==r){minn(p)=val(p)=tag(p)=inf;return;}\n\tint mid=(l+r)>>1;\n\tbuild(ls(p),l,mid);build(rs(p),mid+1,r);\n\tup(p);\n}\nvoid change(int p,int L,int R,int pos)\n{\n\tif(L==R){minn(p)=inf;val(p)=f[pos-1];return;}\n\tint mid=(L+R)>>1;\n\tdown(p);\n\tif(pos<=mid)change(ls(p),L,mid,pos);\n\telse change(rs(p),mid+1,R,pos);\n\tup(p);\n}\nvoid update(int p,int L,int R,int l,int r,int k)\n{\n\tif(L>=l&&R<=r){minn(p)=val(p)+k,tag(p)=k;return;}\n\tdown(p);\n\tint mid=(L+R)>>1;\n\tif(l<=mid)update(ls(p),L,mid,l,r,k);\n\tif(r>mid)update(rs(p),mid+1,R,l,r,k);\n\tup(p);\n}\nint query(int p,int L,int R,int l,int r)\n{\n\tif(L>=l&&R<=r)return minn(p);\n\tdown(p);\n\tint mid=(L+R)>>1,ans=inf;\n\tif(l<=mid)ans=min(ans,query(ls(p),L,mid,l,r));\n\tif(r>mid)ans=min(ans,query(rs(p),mid+1,R,l,r));\n\treturn ans;\n}\nsigned main()\n{\n\t//freopen(\"test.in\",\"r\",stdin);\n\t//freopen(\"test.out\",\"w\",stdout);\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld%lld\",&a[i],&b[i]);\n\tfor(int i=1;i<=n;i++)sum[i]=sum[i-1]+b[i];\n\ts[++top]=0;a[0]=inf;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(top&&a[i]>a[s[top]])top--;\n\t\tpre[i]=s[top];\n\t\ts[++top]=i;\t\n\t}\n\tbuild(1,1,n);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tchange(1,1,n,i);\n\t\tupdate(1,1,n,pre[i]+1,i,a[i]);\n\t\tint l=lower_bound(sum,sum+i+1,sum[i]-m)-sum;//\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5de6\u7aef\u70b9\n\t\tif(l<i)f[i]=query(1,1,n,l+1,i);\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1569551088,
        "uid": 145441,
        "name": "nofind",
        "ccfLevel": 6,
        "title": "P1848 [USACO12OPEN]\u4e66\u67b6Bookshelf(\u7ebf\u6bb5\u6811\u4f18\u5316DP)"
    },
    {
        "content": "\u8fd9\u9898\u8c03\u8d77\u6765\u771f\u662f...\n\n---\n\n\u8bbe$f[i]$\u8868\u793a\u524d$i$\u4e2a\u6570\u5206\u6210\u82e5\u5e72\u6bb5\u7684\u6700\u5c0f\u7b54\u6848\uff0c\u90a3\u4e48\u5bb9\u6613\u5199\u51fa\u65b9\u7a0b\n\n$f[i]=\\min\\limits_{0\\leq j<i,\\sum\\limits_{k=j+1}^iw[k]\\leq L}\\{f[j]+\\max\\limits_{j<k\\leq i}h[k]\\}$\n\n\u89c2\u5bdf\u8fd9\u4e2a\u65b9\u7a0b\uff0c\u6ce8\u610f\u5230\u5f53$i$\u56fa\u5b9a\u65f6\u968f\u7740$j$\u7684\u589e\u5927$f$\u5355\u8c03\u4e0d\u964d\u548c$\\max\\limits_{j<k\\leq i}h[k]$\u5355\u8c03\u4e0d\u5347.\u6240\u4ee5\u5982\u679c\u6709\u4e24\u4e2a\u51b3\u7b56$j_1<j_2$\u6ee1\u8db3$\\max\\limits_{j_1<k\\leq i}h[k]=\\max\\limits_{j_2<k\\leq i}h[k]$\u90a3\u4e48$j_2$\u662f\u6ca1\u6709\u7528\u7684.\u4ee4$j_1=j_2-1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6761\u4ef6\u53d8\u6210$h[j_2]\\leq \\max\\limits_{j_2<k\\leq i}h[k]$\u5e76\u4e14$\\sum\\limits_{k=j_2}^i\\leq L$.\u8fd9\u4e2a\u4e1c\u897f\u770b\u8d77\u6765\u5c31\u975e\u5e38\u7684\u5355\u8c03\u961f\u5217\uff0c\u7ef4\u62a4\u51fa\u6240\u6709\u53ef\u80fd\u7684\u51b3\u7b56\u70b9\u5373\u53ef.\u6709\u4e00\u4e9b\u7ec6\u8282\u53ef\u4ee5\u770b\u4ee3\u7801\n\n\u4f46\u662f\u8fd9\u6837\u53ea\u7ef4\u62a4\u51fa\u4e86\u6240\u6709\u7684\u51b3\u7b56\u70b9\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4\u6240\u6709\u51b3\u7b56\u70b9\u4e2d\u7684\u6700\u4f18\u503c.\u7528\u4e00\u4e2a\u652f\u6301\u5220\u9664\u7684\u5806\u5373\u53ef\u5b8c\u6210.\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int N=1e6;\nstruct Node{int id;long long w;bool operator <(const Node &a)const{return w<a.w;}};\nstruct Heap\n{\n\tNode a[N];int size,pos[N];\n\tvoid push(Node x)\n\t{\n\t\ta[++size]=x;pos[x.id]=size;\n\t\tfor(int o=size;o>1;o>>=1)if(a[o]<a[o>>1])swap(a[o],a[o>>1]),swap(pos[a[o].id],pos[a[o>>1].id]);else return;\n\t}\n\tvoid pop(int x)\n\t{\n\t\tpos[a[size].id]=pos[x],a[pos[x]]=a[size--];\n\t\tfor(int o=pos[x];o>1;o>>=1)if(a[o]<a[o>>1])swap(a[o],a[o>>1]),swap(pos[a[o].id],pos[a[o>>1].id]);else break;\n\t\tfor(int o=pos[x],son;(o<<1)<=size;o=son)\n\t\t{\n\t\t\tson=(o<<1|1)>size||a[o<<1]<a[o<<1|1]?(o<<1):(o<<1|1);\n\t\t\tif(a[son]<a[o])swap(a[son],a[o]),swap(pos[a[son].id],pos[a[o].id]);else break;\n\t\t}\n\t\tpos[x]=0;\n\t}\n\tNode top(){return a[1];}\n}qs;\nint q[N],lst[N],n,a[N],w[N];\nlong long f[N],m;\nint main()\n{\n\tscanf(\"%d%lld\",&n,&m);\n\tlong long s=0;\n\tfor(int i=1,j=0;i<=n;i++)\n\t{\n\t\tscanf(\"%d%d\",a+i,w+i);s+=w[i];\n\t\twhile(s>m)s-=w[++j];\n\t\tlst[i]=j;if(lst[i]==i){puts(\"-1\");return 0;}//\u9884\u5904\u7406\u4e00\u4e2a\u51b3\u7b56\u5de6\u7aef\u70b9\n\t}\n\tf[0]=0;q[1]=0;int head=1,tail=0;q[0]=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(q[head]<lst[i]&&head<=tail)qs.pop(q[head++]);\n\t\twhile(head<=tail&&a[i]>=a[q[tail]])qs.pop(q[tail--]);\n        //\u8fd9\u4e00\u53e5\u8bdd\u662f\u56e0\u4e3a\u5355\u8c03\u961f\u5217\u4e2d\u7684\u51b3\u7b56\u4e00\u5b9a\u6ee1\u8db3i-1\u65f6\u7684\u6761\u4ef6\uff0c\u7136\u540e\u518d\u548c\u8fd9\u4e2a\u6761\u4ef6\u5408\u5e76\n        //\u518d\u6839\u636e\u4e4b\u524d\u7684\u6761\u4ef6\u53ef\u4ee5\u5f97\u5230\u961f\u5c3e\u5143\u7d20\u662f\u5b83\u5230i\u4e2d\u95f4\u6700\u5927\u7684\u5143\u7d20\n\t\tif(a[i-1]>a[i])//\u53ea\u6709\u8fd9\u6837i-1\u624d\u662f\u6709\u4ef7\u503c\u7684\u51b3\u7b56\n\t\t{\n\t\t\tNode t={q[++tail]=i-1,f[i-1]+a[i]};\n\t\t\tqs.push(t);\n\t\t}\n\t\telse\n\t\t\tif(head<=tail)//\u8fd9\u65f6\u5019\u961f\u5c3e\u5143\u7d20(\u4e0d\u542b)\u5230i\u7684\u6700\u5927\u503c\u53ef\u80fd\u8fd8\u662f\u5230i-1\u7684\uff0c\u9700\u8981\u5728\u5806\u4e2d\u66f4\u65b0\u4e00\u4e0b;\u5176\u4ed6\u5143\u7d20(\u4e0d\u542b)\u5230i\u7684\u6700\u5927\u503c\u6839\u636e\u6761\u4ef6\u5e94\u8be5\u662f\u5176\u5355\u8c03\u961f\u5217\u4e2d\u7684\u540e\u7ee7\n\t\t\t{\n\t\t\t\tqs.pop(q[tail]);\n\t\t\t\tNode t={q[tail],f[q[tail]]+a[i]};qs.push(t);\n\t\t\t}\n\t\tf[i]=f[lst[i]];\n\t\tif(head>tail)f[i]+=a[i];\n\t\telse \n\t\t\tif(q[head]==lst[i])\n\t\t\t\tf[i]+=a[head==tail?i:q[head+1]];\n\t\t\telse f[i]+=a[q[head]];//\u7528\u6700\u524d\u9762\u90a3\u4e2a\u8f6c\u79fb\u4e00\u6b21 \u6ce8\u610f\u6700\u5927\u503c\u7684\u5224\u65ad\n\t\tif(head<=tail)f[i]=min(f[i],qs.top().w);//\u7528\u5806\u9876\u8f6c\u79fb\u4e00\u6b21\n\t}\n\tcout<<f[n]<<endl;\n}\n```\n\n\u8fd9\u9898\u8fd8\u662f\u975e\u5e38\u597d\u7684emmmm",
        "postTime": 1561083296,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "Orz\u98ce\u4ee5\u9759\u5fc3\uff08\u7f51\u6613\u535a\u5ba2\uff09\n\n\u660e\u660e\u662f\u52a8\u89c4\u554a\u2026\u2026\u5355\u8c03\u961f\u5217\uff0cmultiset\u7ef4\u62a4\u4e00\u4e0b\u2026\u2026\u5728\u6b64\u5410\u69fd\u4e0d\u5f00\u4f18\u5316\u7684STL\u7684set\u7684\u901f\u5ea6\u2026\u2026\u673a\u623f\u91cc\u5c45\u7136\u6709\u795e\u7287\u5199\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5389\u5bb3\u4e86\u3002\n\n\u6765\u81ea\u98ce\u4ee5\u9759\u5fc3\uff08\u7f51\u6613\u535a\u5ba2\uff09\u7684\u601d\u8def\uff1a\n\n\u9884\u5904\u7406w\u7684\u524d\u7f00\u548cs.\n\n\u9996\u5148\u5f97\u5230\u52a8\u89c4\u65b9\u7a0b\uff1af[i]=min{f[j]+max{h[j+1..i]} | s[i]-s[j]<=l}.\n\n\u76f4\u63a5\u505a\u662f\u5e73\u65b9\u7684\uff0c\u5982\u4f55\u4f18\u5316\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0f[j]\u4e0d\u51cf\uff0c\u4e14\u5bf9\u67d0\u4e2ai\uff0cmax{h[j+1..i]}\u4e0d\u589e\u3002\n\n\u8003\u8651\u7ef4\u62a4hmax\u503c\u76f8\u540c\u7684\u6bb5\u3002\u90a3\u4e48\u4ecei-1\u5230i\u65f6\uff0c\u7528h[i]\u628a\u524d\u9762hmax\u6bd4\u5b83\u5c0f\u7684\u6bb5\u5408\u5e76\u6389\u3002\n\n\u5e73\u8861\u6811\u7ef4\u62a4\u6bcf\u6bb5\u6700\u524d\u9762\u7684f\u503c\uff0c\u51b3\u7b56\u65f6\u53d6\u6700\u5c0f\u7684\u3002\n\n\n'''\n\n\n\n\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <set>\nusing namespace std;\ntypedef long long LL;\nconst int maxn = 100010;\nint H[maxn], W[maxn], sum[maxn];\nLL f[maxn];\nmultiset<LL> s;\ninline char getc(void){\n    static char buf[1000000], *p1 = buf, *p2 = buf;\n    if(p1 == p2){\n        p2 = (p1 = buf) + fread(buf, 1, 1000000, stdin);\n        if(p1 == p2) return EOF;\n    }\n    return *p1++;\n}\ninline void read(int& x){\n    x = 0; int f = 1; char ch = getc();\n    for(;!(ch>='0' && ch<='9');ch=getc()) if(ch == '-') f = -1;\n    for(;(ch>='0' && ch<='9');x=x*10+ch-'0', ch=getc());\n    x *= f;\n}\ninline void write(LL x){\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\nint main()\n{\n    int n, L;\n    int ans = 0, head = 1, tail = 0;\n    read(n); read(L);\n    for(int i=1;i<=n;i++){\n        read(H[i]); read(W[i]);\n        for(sum[++tail]=i-1;head<tail&&H[i]>H[sum[tail]];--tail)\n            s.erase(s.find(f[sum[tail-1]]+H[sum[tail]]));\n        s.insert(f[sum[tail]]+H[i]);\n        sum[tail+1] = i;\n        for(ans+=W[i];ans>L;ans-=W[sum[head]]){\n            s.erase(s.find(f[sum[head]]+H[sum[head+1]]));\n            if(++sum[head]==sum[head+1])\n                ++head;\n            else s.insert(f[sum[head]]+H[sum[head+1]]);\n        }\n        f[i] = *s.begin();\n    }\n    write(f[n]);\n}\n'''\n```",
        "postTime": 1484642764,
        "uid": 31766,
        "name": "LoliconAutomaton",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "### [\u53cc\u500d\u7ecf\u9a8c](https://www.luogu.com.cn/problem/P1295)\n\n\n### \u524d\u7f6e\u77e5\u8bc6\n\u5355\u8c03\u961f\u5217\uff0c`dp`\uff0c`ST` \u8868\n\n### \u601d\u8def\n\n\u9996\u5148 `dp` \u65b9\u7a0b\u662f $dp_i=\\min\\{dp_j+\\max\\{h_k\\}\\},\\sum\\limits_{k=j}^i w_k \\le m,j<k\\le i$\u3002\n\n\u8003\u8651\u53ef\u4ee5\u8f6c\u79fb\u5230 $dp_i$ \u7684\u4e24\u4e2a\u72b6\u6001 $dp_j+\\max\\{h_{j+1},h_{j+2}...h_i\\}$ \u548c $dp_{j+1}+\\max\\{h_{j+2},h_{j+3}...h_i\\}$\u3002\u663e\u7136 $dp_{j+1}\\ge dp_j$\uff0c\u6240\u4ee5 $dp_{j+1}$ \u80fd\u4f18\u4e8e $dp_j$ \u7684\u60c5\u51b5\u53ea\u6709 $\\max\\{h_{j+2},h_{j+3}...h_i\\}<\\max\\{h_{j+1},h_{j+2}...h_i\\}$\uff0c\u6240\u4ee5 $h_{j+1}$ \u4e3a $\\max\\{h_{j+1},h_{j+2}...h_i\\}$ \u65f6\u624d\u53ef\u80fd\u53d6 $dp_{j+1}+\\max\\{h_{j+2},h_{j+3}...h_i\\}$ \u3002\n\n\u63a5\u4e0b\u6765\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u964d\u5e8f\u5217\uff0c\u5f39\u51fa\u8fc7\u671f\u4e0b\u6807\u3002\u6211\u4eec\u8bb0 $left_i$ \u4f7f $w_{left_i}+w_{left_i+1}...+w_i\\le m$ \u4e14 $w_{left_i-1}+w_{left_i}...+w_i>m$\uff0c\u5c0f\u4e8e $left_i$ \u7684\u4e0b\u6807\u53ef\u4ee5\u76f4\u63a5\u5f39\u51fa\u3002 $left_i$ \u53ef\u4ee5\u7528\u524d\u7f00\u548c\u7ef4\u62a4\u3002\u63a5\u4e0b\u6765\u5bf9\u6bcf\u4e2a\u5355\u8c03\u961f\u5217\u4e2d\u7684\u4e0b\u6807\u4e0e ${left_i}$\u66f4\u65b0\uff0c\u66f4\u65b0\u4e2d\u6c42 $h$ \u7684\u533a\u95f4\u6700\u5927\u503c\u53ef\u4ee5\u7528 `ST` \u8868\u5bb9\u6613\u5730\u7ef4\u62a4\u3002\n\n#### Update on 2022-10-3\n\n\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\uff1f\u4e0d\uff01\n\n\u611f\u8c22 [@Sham_Devour](https://www.luogu.com.cn/user/365542) \u7684\u95ee\u9898\uff0c\u627e\u5230\u4e86\u8fd9\u4e2a\u505a\u6cd5\u7684\u9519\u8bef\u3002\n\n\u57fa\u4e8e\u968f\u673a\u6570\u5217\u7684\u5355\u8c03\u961f\u5217\u671f\u671b\u957f\u5ea6\uff0c\u8fd9\u4e2a\u505a\u6cd5\u5728\u5e73\u5747\u60c5\u51b5\u4e0b\u662f $\\Theta(n\\log n)$ \u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u4e00\u4e2a\u9012\u51cf\u7684\u3001\u5bbd\u5ea6\u5168\u4e3a $1$ \u7684\u5e8f\u5217\u8ba9\u5355\u8c03\u961f\u5217\u957f\u5ea6\u53d8\u6210 $\\Theta(n)$ \u6765\u5361\u6389\u8fd9\u4e2a\u505a\u6cd5\u3002\n\n\u8fd9\u4e2a\u6570\u636e\u6709\u70b9\u592a\u6c34\u4e86\u2026\u2026\u8d21\u732e\u4e00\u4e2a\u6570\u636e\u751f\u6210\u5668\n\n```cpp\n#include <stdio.h>\n#include <stdlib.h>\n#define lld long long\ninline unsigned int randint() { return (rand() << 16) | rand(); }\ninline unsigned lld randlld() { return ((1ll * randint()) << 32) | randint(); }\ninline lld random(lld l, lld r) { return randlld() % (r - l + 1) + l; }\nint main() {\n\tint n = 100000;\n\tprintf(\"%d 1000000000\\n\", n);\n\tfor (int i = 1; i <= n; ++ i) printf(\"%lld %lld\\n\", n - i + 1, 1);\n}\n```\n\n\u6240\u4ee5\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e0b\u964d\u5e8f\u5217\u4e4b\u540e\uff0c\u6bcf\u6b21\u627e\u5230\u524d\u9762\u7b2c\u4e00\u4e2a\u6bd4\u5f53\u524d\u70b9\u66f4\u5927\u7684\u70b9\uff0c\u7528\u7ebf\u6bb5\u6811\u8fdb\u884c\u533a\u95f4\u4fee\u6539\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n\n\u6700\u540e\u8d34\u4e0a\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n#include <string.h>\n#include <algorithm>\n#define lld long long\nusing namespace std;\nconst int N = 100010;\nint n, m;\nlld w[N], h[N];\nlld sum[N];\nstruct node {\n\tint l, r;\n\tlld val, ans, tag;\n} tr[N << 2];\ninline void pushdown(int k) {\n//\tprintf(\"pushdown %d\\n\", k);\n\ttr[k << 1].tag = tr[k].tag;\n\ttr[k << 1 | 1].tag = tr[k].tag;\n\ttr[k].tag = 0;\n\ttr[k << 1].ans = tr[k << 1].val + tr[k << 1].tag;\n\ttr[k << 1 | 1].ans = tr[k << 1 | 1].val + tr[k << 1 | 1].tag;\n}\ninline void pushup(int k) {\n\ttr[k].val = min(tr[k << 1].val, tr[k << 1 | 1].val);\n\ttr[k].ans = min(tr[k << 1].ans, tr[k << 1 | 1].ans);\n}\ninline void build(int k, int l, int r) {\n\ttr[k].l = l, tr[k].r = r;\n\tif (l == r) {\n\t\ttr[k].ans = 0x3f3f3f3f3f3f3f3fll;\n\t\ttr[k].val = 0x3f3f3f3f3f3f3f3fll;\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(k << 1, l, mid);\n\tbuild(k << 1 | 1, mid + 1, r);\n\tpushup(k);\n}\ninline void modify(int k, int p, lld x) {\n\tif (tr[k].l == tr[k].r) {\n\t\ttr[k].val = x;\n\t\ttr[k].ans = x + tr[k].tag;\n\t\treturn;\n\t}\n\tif (tr[k].tag) pushdown(k);\n\tint mid = (tr[k].l + tr[k].r) >> 1;\n\tif (p <= mid) modify(k << 1, p, x);\n\telse modify(k << 1 | 1, p, x);\n\tpushup(k);\n}\ninline lld query(int k, int l, int r) {\n\tif (l <= tr[k].l && tr[k].r <= r) {\n//\t\tprintf(\"tr[%d]:%d~%d\\n\", k, tr[k].l, tr[k].r);\n//\t\tprintf(\"tr[%d].tag = %lld\\n\", k, tr[k].tag);\n//\t\tprintf(\"tr[%d].val = %lld\\n\", k, tr[k].val);\n//\t\tprintf(\"tr[%d].ans = %lld\\n\", k, tr[k].ans);\n//\t\tprintf(\"Query %d(%d~%d) %d~%d:%lld\\n\", k, tr[k].l, tr[k].r, l, r, tr[k].ans);\n\t\treturn tr[k].ans;\n\t}\n\tif (tr[k].tag) pushdown(k);\n\tint mid = (tr[k].l + tr[k].r) >> 1;\n\tlld ans = 0x3f3f3f3f3f3f3f3fll;\n\tif (l <= mid) ans = min(ans, query(k << 1, l, r));\n\tif (mid < r) ans = min(ans, query(k << 1 | 1, l, r));\n\treturn ans;\n}\ninline void modify2(int k, int l, int r, lld x) {\n\tif (l <= tr[k].l && tr[k].r <= r) {\n\t\ttr[k].tag = x;\n\t\ttr[k].ans = tr[k].val + tr[k].tag;\n//\t\tprintf(\"tr[%d]:%d~%d\\n\", k, tr[k].l, tr[k].r);\n//\t\tprintf(\"tr[%d].tag = %lld\\n\", k, tr[k].tag);\n//\t\tprintf(\"tr[%d].val = %lld\\n\", k, tr[k].val);\n//\t\tprintf(\"tr[%d].ans = %lld\\n\", k, tr[k].ans);\n\t\treturn;\n\t}\n\tif (tr[k].tag) pushdown(k);\n\tint mid = (tr[k].l + tr[k].r) >> 1;\n\tif (l <= mid) modify2(k << 1, l, r, x);\n\tif (mid < r) modify2(k << 1 | 1, l, r, x);\n\tpushup(k);\n//\tprintf(\"tr[%d]:%d~%d\\n\", k, tr[k].l, tr[k].r);\n//\tprintf(\"tr[%d].tag = %lld\\n\", k, tr[k].tag);\n//\tprintf(\"tr[%d].val = %lld\\n\", k, tr[k].val);\n//\tprintf(\"tr[%d].ans = %lld\\n\", k, tr[k].ans);\n}\ninline int findpre(int x) {\n\tint l = 0, r = x, ans;\n\twhile (l <= r) {\n\t\tint mid = (l + r) >> 1;\n\t\tif (sum[x] - sum[mid] <= m){\n\t\t\tans = mid;\n\t\t\tr = mid - 1;\n\t\t} else l = mid + 1;\n\t}\n\treturn ans;\n}\nint head, tail, q[N << 1];\nvoid push(int x) {\n    while (head <= tail && h[q[tail]] < h[x]) -- tail;\n\tmodify2(1, head <= tail ? (q[tail] + 1) : 1, x, h[x]);\n    q[++ tail] = x;\n}\nint main() {\n\tscanf(\"%d%d\", &n, &m);\n\tfor (int i = 1; i <= n; ++ i) {\n\t\tscanf(\"%lld%lld\", h + i, w + i);\n\t\tsum[i] = sum[i - 1] + w[i];\n\t}\n\tbuild(1, 1, n + 1);\n\tmodify(1, 1, 0);\n\tint mn = 0;\n\thead = 1, tail = 1;\n\tq[head] = 0;\n\tlld res;\n\tfor (int i = 1; i <= n; ++ i) {\n\t\tpush(i);\n\t\tres = query(1, findpre(i) + 1, i);\n\t\tmodify(1, i + 1, res);\n\t}\n\tprintf(\"%lld\\n\", res);\n}```",
        "postTime": 1628160931,
        "uid": 228486,
        "name": "SunsetSamsara",
        "ccfLevel": 7,
        "title": "P1848 \u9898\u89e3"
    },
    {
        "content": "## [\u9898\u9762](https://www.luogu.com.cn/problem/P1848)\n## \u601d\u8def\n\u9996\u5148DP\u601d\u8def\u86ee\u597d\u60f3\u7684\uff1a$f_i=min(f_j+max(h_{j+1},h_i))(sum(w_{j+1},w_i)\\le L)$\u3002\n\n### 69pts\n$sum(w_{j+1},w_i)$\uff0c\u8fd9\u4e2a\u6761\u4ef6\u662f\u4e2a\u6ed1\u52a8\u533a\u95f4\uff0c\u8fb9\u505a\u8fb9\u5224\u65ad\u5c31\u597d\u4e86\u3002\n\n$max(h_{j+1},h_i)$\uff0c\u8fd9\u4e2amax\u53ef\u4ee5\u7528ST\u8868\u4f18\u5316\u3002\n\n~~\u4f17\u6240\u5468\u77e5 $n^2$ \u662f\u80fd\u8fc7 100000 \u7684\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u66f4\u65b0\u3002~~\n\n~~\u6211\u627f\u8ba4\u6211\u6709\u8d4c\u7684\u6210\u5206\u3002~~\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=101000;\nint read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c>'9' || c<'0'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0' && c<='9'){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n\treturn x*f;\n}\nint n,L,w[N];\nint k[N],f[N<<2][18],dp[N];\nvoid build(){\n\tfor(int i=2;i<=n;i++)w[i]+=w[i-1];//\u524d\u7f00\u548c\n\tfor(int i=1;i<=17;i++)for(int j=1;j<=n;j++)f[j][i]=max(f[j][i-1],f[j+(1<<i-1)][i-1]);\n\tint now=0;for(int i=1;i<=n;i++){if((1<<now+1)<=i)now++;k[i]=now;}\n\treturn;\n}//ST\u8868\nint q[N<<1],head;\nint stquery(int x,int y){return max(f[x][k[y-x+1]],f[y-(1<<k[y-x+1])+1][k[y-x+1]]); }\nsigned main(){\n\tn=read(),L=read();\n\tfor(int i=1;i<=n;i++)f[i][0]=read(),w[i]=read();build();\n\thead=0;memset(dp,0x7f,sizeof(dp));dp[0]=0;\n\tfor(int i=1;i<=n;i++){\n\t\twhile(w[i]-w[head]>L)head++;//\u7b26\u5408\u6761\u4ef6\n\t\tfor(int j=head;j<i;j++)dp[i]=min(dp[i],dp[j]+stquery(j+1,i));\n\t} \n\tprintf(\"%lld\\n\",dp[n]);\n\treturn 0;\n} \n```\n### 100pts\n\u7136\u540e\u6211\u4eec\u5f00\u59cb\u60f3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5dee\u5728\u8fd9\u4e2a ```min``` \u4e0a\uff0c\u6bcf\u6b21\u6574\u4e2a\u533a\u95f4\u91cd\u65b0\u6c42\u4e00\u6b21\u6700\u5c0f\u503c\uff0c\u800c\u533a\u95f4\u5927\u90e8\u5206\u662f\u91cd\u590d\u7684\uff0c\u591a\u6d6a\u8d39\u554a\u3002\n\n\u90a3\u4e48\u600e\u4e48\u52a8\u6001\u7ef4\u62a4\u8fd9\u4e2a\u533a\u95f4\u6700\u5c0f\u503c\u5462\uff1f\n\n\u663e\u7136\u6bcf\u52a0\u5165\u4e00\u4e2a\u6570 $i$\uff0c\u524d\u9762\u533a\u95f4\u4e2d\u6bcf\u4e2a\u6570\u7684 $max(j+1,i-1)$ \u5c31\u6539\u4e3a\u4e86 $max(j+1,i)$\u3002\u7136\u540e\u806a\u660e\u7684\u4f60\u4e00\u5b9a\u80fd\u53d1\u73b0\uff1a**\u8fd9\u4e2a\u533a\u95f4\u7684 $max(j+1,i-1)$\uff0c$j$\u662f\u9012\u589e\u7684\uff0c\u533a\u95f4\u5728\u4e0d\u65ad\u51cf\u5c0f\uff0c\u90a3\u4e48\u503c\u5c06\u662f\u5355\u8c03\u9012\u51cf**\u3002\u6240\u4ee5\u6bcf\u6b21\u66f4\u65b0\u7684\u6570\u4e00\u5b9a\u662f\u9760\u53f3\u7684\u4e00\u6bb5\u533a\u95f4\uff0c\u800c\u8fd9\u6bb5\u533a\u95f4\u662f\u4ec0\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\uff08\u5bf9\u4e8e\u6bcf\u4e2a $h_i$\uff0c\u7528\u5355\u8c03\u6808\u9884\u5904\u7406\u51fa\u5b83\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u4ed6\u7684\u6570\uff0c\u5728\u8fd9\u4e2a\u6570\u53f3\u8fb9\uff0c\u5c31\u662f\u4ed6\u66f4\u65b0\u7684\u533a\u95f4\uff09\u3002\u90a3\u4e48\u6211\u4eec\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u4e00\u4e0b\u5427\u3002\n\n**Q** \uff1a\u53ef\u662f\u6211\u4eec\u8981\u7684\u662f $f_j+max(j+1,i)$ \u7684\u6700\u5c0f\u503c\uff0c\u53ea\u80fd\u6c42\u51fa $max(j+1,i)$ \uff0c\u4f60\u600e\u4e48\u529e\uff1f  \n**A** : \u4e8b\u5b9e\u4e0a\uff0c\u4e00\u6bb5\u533a\u95f4\u7684 $max(j+1,i)$ \uff0c\u88ab\u66f4\u65b0\u6210\u4e00\u6837\u7684\u4e4b\u540e\uff0c\u90a3\u4e48 $f_j+max(j+1,i)$ \u7684\u503c\u53ea\u8981\u770b $f_j$ \u7684\u503c\u5c31\u884c\u4e86\uff08$max(j+1,i)$\u5927\u5bb6\u90fd\u4e00\u6837\uff09\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u4e0b $f_j$ \u7684\u503c\u3002\n\n\u7ef4\u62a4\u4e00\u68f5\u7ebf\u6bb5\u6811\u3002\n1. \u4e00\u7ef4\u62a4 $f_j$ \u7684\u503c\u3002\u6709\u4e00\u4e2a\u5355\u70b9\u63d2\u5165\u64cd\u4f5c\u3002\n2. \u4e8c\u7ef4\u62a4 $f_j+max(j+1,i)$ \u7684\u503c\uff0c\u90a3\u4e48\u6bcf\u6b21\u533a\u95f4\u4fee\u6539 $max(j+1,i)$ \u7684\u503c\u7684\u65f6\u5019\uff0c\u7528 $f_j$  \u7684\u503c\u66f4\u65b0\u5b83\u3002\n3. \u5177\u4f53\u770b\u4ee3\u7801\u5566\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=201000;\nint read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c>'9' || c<'0'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0' && c<='9'){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n\treturn x*f;\n}\nstruct node{\n\tint l,r,f,sum,lazy;//\u5206\u5f00\u7ef4\u62a4\u3002lazy\u662f\u8fd9\u4e2a\u533a\u95f4\u7684max(j+1,i) \n}e[N<<2];\nint n,w[N],h[N],m,f[N];\nint pre[N],st[N],top,L;\nvoid pushup(int u){\n\te[u].f=min(e[u<<1].f,e[u<<1|1].f);\n\te[u].sum=min(e[u<<1].sum,e[u<<1|1].sum);\n\treturn;\n}\nvoid pushdown(int u){\n\tif(e[u].lazy){\n\t\te[u<<1].lazy=e[u<<1|1].lazy=e[u].lazy;\n\t\te[u<<1].sum=e[u<<1].f+e[u].lazy;\n\t\te[u<<1|1].sum=e[u<<1|1].f+e[u].lazy;\n\t\te[u].lazy=0;\n\t}\n\treturn;\n}\nvoid build(int u,int l,int r){\n\te[u].l=l,e[u].r=r;if(l==r)return;\n\tint mid=l+r>>1;build(u<<1,l,mid);build(u<<1|1,mid+1,r);return;\n}\nvoid insert(int u,int x,int val){//\u63d2\u5165\u4e00\u4e2af[i] \n\tif(e[u].l==e[u].r){\n\t\te[u].f=e[u].sum=val;\n\t\treturn;\n\t}\n\tpushdown(u);\n\tint mid=e[u].l+e[u].r>>1;\n\tif(x<=mid)insert(u<<1,x,val);\n\telse insert(u<<1|1,x,val);\n\tpushup(u);\n\treturn;\n}\nvoid update(int u,int l,int r,int val){\n\tif(l<=e[u].l && e[u].r<=r){\n\t\te[u].lazy=val;\n\t\te[u].sum=e[u].f+val;\n\t\treturn;\n\t} \n\tpushdown(u);\n\tint mid=e[u].l+e[u].r>>1;\n\tif(l<=mid)update(u<<1,l,r,val);\n\tif(r>mid)update(u<<1|1,l,r,val);\n\tpushup(u);\n\treturn;\n}\nint query(int u,int l,int r){\n\tif(l<=e[u].l && e[u].r<=r)return e[u].sum;\n\tpushdown(u); \n\tint mid=e[u].l+e[u].r>>1;\n\tint res=1e18;\n\tif(l<=mid)res=min(res,query(u<<1,l,r));\n\tif(r>mid)res=min(res,query(u<<1|1,l,r));\n\treturn res;\n}\nsigned main(){\n\tn=read();L=read();\n\tfor(int i=1;i<=n;i++)h[i]=read(),w[i]=read();\n\tfor(int i=2;i<=n;i++)w[i]+=w[i-1];\n\tfor(int i=1;i<=n;i++){\n\t\twhile(top && h[i]>h[st[top]])top--;\n\t\tif(top)pre[i]=st[top];else pre[i]=1;\n\t\tst[++top]=i;\n\t}//\u5355\u8c03\u6808\n\tbuild(1,1,n);\n\tint head=0,nowmaxn=0;\n\tfor(int i=1;i<=n;i++){\n\t\tnowmaxn=max(nowmaxn,h[i]);//\u5f53\u53ea\u6709\u4e00\u6bb5\u533a\u95f4\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u7528\u6700\u5927\u503c\u3002\n\t\twhile(w[i]-w[head]>L)head++;\n\t\tupdate(1,pre[i],i-1,h[i]);\n\t\tif(head==0){\n\t\t\tf[i]=query(1,head+1,i-1);\n\t\t\tf[i]=min(f[i],nowmaxn);\n\t\t}\n\t\telse f[i]=query(1,head,i-1);\n\t\tinsert(1,i,f[i]);\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1668652819,
        "uid": 234356,
        "name": "\u65b9\u6770123",
        "ccfLevel": 6,
        "title": "P1848 [USACO12OPEN]Bookshelf G"
    },
    {
        "content": "## \u9898\u89e3\n\n\u8bbe $f_i$ \u8868\u793a\u524d $i$ \u672c\u4e66\u6ee1\u8db3\u6761\u4ef6\u65f6\u4e66\u67b6\u9ad8\u5ea6\u548c\u7684\u6700\u5c0f\u503c\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u4f4d\u7f6e $i$\uff0c\u6ee1\u8db3\u5bbd\u5ea6\u9650\u5236\u7684\u6700\u5c0f\u4f4d\u7f6e $w$ \u4e00\u5b9a\u4e0d\u51cf\uff0c\u53ef\u4ee5\u7528\u6307\u9488\u7ef4\u62a4\u3002\n\n\u663e\u7136\u6709 $f_i=\\min\\{f_{j-1}+\\max\\{H_j,\\cdots,H_i\\}\\}(w\\le j\\le i)$\u3002\n\n\u6211\u4eec\u628a\u539f\u6765\u7684 $H_j$ \u53d8\u4e3a $H_j\\sim H_i$ \u7684\u6700\u5927\u503c\uff0c\u663e\u7136\u8981\u52a8\u6001\u7ef4\u62a4 $H_w\\sim H_i$ \u7684\u503c\uff0c\u53ea\u9700\u652f\u6301\u5bf9 $H$ \u540e\u7f00\u53d6 $\\max$ \u64cd\u4f5c\u3002\n\n\u7531\u4e8e $H$ \u7684\u6700\u5927\u503c\u662f\u4e0d\u589e\u7684\uff0c\u6240\u4ee5\u53d6 $\\max$ \u76f8\u5f53\u4e8e\u5bf9\u4e00\u6bb5\u540e\u7f00\u505a\u533a\u95f4\u8986\u76d6\u3002\n\n\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u627e\u5230\u5f53\u524d\u8981\u53d6 $\\max$ \u7684\u5206\u754c\u70b9\uff0c\u5269\u4e0b\u7684\u524d\u7f00\u4e0d\u4f1a\u88ab\u5f71\u54cd\u3002\n\n\u6211\u4eec\u8fd8\u9700\u7ef4\u62a4\u533a\u95f4\u5185 $f_i$ \u7684 $\\min$ \u548c $f_i+H_i$ \u7684 $\\min$\uff0c\u4ee5\u53ca\u67e5\u8be2 $w\\sim i$ \u4e2d\u6700\u5c0f\u7684 $f_i+H_i$\u3002\n\n\u8fd9\u90fd\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n## Code\n```cpp\n#include<cstdio>\n#define LL long long\n#define inf 0x3f3f3f3f3f3f3f3f\nint n,l,w=1,sum=0;\nint H[100008],W[100008];\nLL f[100008];\nstruct aaa\n{\n\tLL mnf,mnfh,laz,mnh;\n}arr[400008];\ninline LL max(LL a,LL b)\n{\n\treturn a>b? a:b;\n}\ninline LL min(LL a,LL b)\n{\n\treturn a<b? a:b;\n}\ninline int lson(int x)\n{\n\treturn (x<<1);\n}\ninline int rson(int x)\n{\n\treturn ((x<<1)|1);\n}\ninline void build(int k,int l,int r)\n{\n\tif(!l)arr[k]=(aaa){0,0,0,0};\n\telse arr[k]=(aaa){inf,inf,0,0};\n\tif(l==r)return ;\n\tint ls=lson(k),rs=rson(k),mid=((l+r)>>1);\n\tbuild(ls,l,mid),build(rs,mid+1,r);\n}\ninline void modifyH(int k,int l,int r,int l1,int r1,LL d)\n{\n\tif(l1>r1)return ;\n\tif(l>=l1 && r<=r1){arr[k].laz=d,arr[k].mnh=d,arr[k].mnfh=arr[k].mnf+d;return ;}\n\tif(arr[k].laz)arr[k].mnh=arr[k].laz,arr[k].mnfh=arr[k].mnf+arr[k].mnh;\n\tint ls=lson(k),rs=rson(k),mid=((l+r)>>1);\n\tif(arr[k].laz)\n\t{\n\t\tarr[ls].laz=arr[k].laz,arr[ls].mnfh=arr[ls].mnf+arr[ls].laz,arr[ls].mnh=arr[ls].laz;\n\t\tarr[rs].laz=arr[k].laz,arr[rs].mnfh=arr[rs].mnf+arr[rs].laz,arr[rs].mnh=arr[rs].laz,arr[k].laz=0;\n\t}\n\tif(r1<=mid)modifyH(ls,l,mid,l1,r1,d);\n\telse if(l1>mid)modifyH(rs,mid+1,r,l1,r1,d);\n\telse modifyH(ls,l,mid,l1,mid,d),modifyH(rs,mid+1,r,mid+1,r1,d);\n\tarr[k].mnfh=min(arr[ls].mnfh,arr[rs].mnfh),arr[k].mnh=min(arr[ls].mnh,arr[rs].mnh);\n}\ninline LL query(int k,int l,int r,int l1,int r1)\n{\n\tif(arr[k].laz)arr[k].mnh=arr[k].laz,arr[k].mnfh=arr[k].mnf+arr[k].mnh;\n\tif(l>=l1 && r<=r1)return arr[k].mnfh;\n\tint ls=lson(k),rs=rson(k),mid=((l+r)>>1);\n\tif(arr[k].laz)\n\t{\n\t\tarr[ls].laz=arr[k].laz,arr[ls].mnfh=arr[ls].mnf+arr[ls].laz,arr[ls].mnh=arr[ls].laz;\n\t\tarr[rs].laz=arr[k].laz,arr[rs].mnfh=arr[rs].mnf+arr[rs].laz,arr[rs].mnh=arr[rs].laz,arr[k].laz=0;\n\t}\n\tif(r1<=mid)return query(ls,l,mid,l1,r1);\n\tif(l1>mid)return query(rs,mid+1,r,l1,r1);\n\treturn min(query(ls,l,mid,l1,mid),query(rs,mid+1,r,mid+1,r1));\n}\ninline void modifyF(int k,int l,int r,int x,LL d)\n{\n\tif(arr[k].laz)arr[k].mnh=arr[k].laz,arr[k].mnfh=arr[k].mnf+arr[k].mnh;\n\tif(l==r){arr[k].mnf=d,arr[k].mnfh=d+arr[k].mnh;return ;}\n\tint ls=lson(k),rs=rson(k),mid=((l+r)>>1);\n\tif(arr[k].laz)\n\t{\n\t\tarr[ls].laz=arr[k].laz,arr[ls].mnfh=arr[ls].mnf+arr[ls].laz,arr[ls].mnh=arr[ls].laz;\n\t\tarr[rs].laz=arr[k].laz,arr[rs].mnfh=arr[rs].mnf+arr[rs].laz,arr[rs].mnh=arr[rs].laz,arr[k].laz=0;\n\t}\n\tif(x<=mid)modifyF(ls,l,mid,x,d);else modifyF(rs,mid+1,r,x,d);\n\tarr[k].mnf=min(arr[ls].mnf,arr[rs].mnf),arr[k].mnfh=min(arr[ls].mnfh,arr[rs].mnfh),arr[k].mnh=max(arr[ls].mnh,arr[rs].mnh);\n}\ninline int find(int k,int l,int r,int l1,int r1,LL d)\n{\n\tif(arr[k].laz)arr[k].mnh=arr[k].laz,arr[k].mnfh=arr[k].mnf+arr[k].mnh;\n\tif(l==r)return (d>arr[k].mnh? l:n);\n\tint ls=lson(k),rs=rson(k),mid=((l+r)>>1);\n\tif(arr[k].laz)\n\t{\n\t\tarr[ls].laz=arr[k].laz,arr[ls].mnfh=arr[ls].mnf+arr[ls].laz,arr[ls].mnh=arr[ls].laz;\n\t\tarr[rs].laz=arr[k].laz,arr[rs].mnfh=arr[rs].mnf+arr[rs].laz,arr[rs].mnh=arr[rs].laz,arr[k].laz=0;\n\t}\n\tif(r1>mid && d<=max(arr[ls].mnh,arr[ls].laz))return find(rs,mid+1,r,max(mid+1,l1),r1,d);\n\treturn find(ls,l,mid,l1,min(mid,r1),d);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&l);\n\tfor(int i=1;i<=n;++i)scanf(\"%d%d\",&H[i],&W[i]);\n\tbuild(1,0,n);\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tfor(sum+=W[i];sum>l;++w)sum-=W[w];\n\t\tmodifyH(1,0,n,find(1,0,n,0,i-1,H[i]),i-1,H[i]),f[i]=query(1,0,n,w-1,i-1),modifyF(1,0,n,i,f[i]);\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1617281832,
        "uid": 121216,
        "name": "18Michael",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P1848 [USACO12OPEN]Bookshelf G"
    },
    {
        "content": "\u9996\u5148\u8003\u8651\u66b4\u529b dp\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u5df2\u7ecf\u5b89\u7f6e\u597d $i$ \u672c\u4e66\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5219\u4e0d\u96be\u5f97\u5230\u5982\u4e0b\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n$$f_i = \\min\\{f_{j - 1} + \\max_{k = j}^{i}\\{h_k\\}\\}, \\sum_{k = j}^{i}{w_k} \\le L$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n ^ 2)$\u3002\u671f\u671b\u5f97\u5206 64 pts\u3002\n\n```\nf[1] = h[1];\nrep(i, 2, n) {\n\tint res = 0;\n\tper(j, i - 1, 0) {\n\t\tif(s[i] - s[j] > m) break;\n\t\tres = max(res, h[j + 1]);\n\t\tf[i] = min(f[i], f[j] + res);\n\t}\n}\n```\n\n\uff08$s$ \u662f $w$ \u7684\u524d\u7f00\u548c\u6570\u7ec4\u3002$m$ \u5373\u4e3a $L$\u3002\uff09\n\n\u8003\u8651\u4f18\u5316\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u786e\u5b9a\u7684 $i$\uff0c\u5f53 $j$ \u5355\u8c03\u9012\u589e\u65f6\uff0c$\\max_{k = j}^{i}\\{h_k\\}$ \u5355\u8c03\u4e0d\u589e\uff0c$f_{k - 1}$ \u5355\u8c03\u4e0d\u964d\u3002\u5f53\u6211\u4eec\u679a\u4e3e\u5230 $i$ \u65f6\uff0c$f_{k - 1}$ \u5df2\u88ab\u66f4\u65b0\u8fc7\uff0c\u5373\u503c\u5df2\u7ecf\u786e\u5b9a\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651 $h_i$ \u5bf9\u4e8e\u7b54\u6848\u7684\u5f71\u54cd\u3002\n\n$\\forall k \\in [j, i] \\text{\u4e14} h_k \\le h_i$\uff0c\u4e0d\u4f1a\u5bf9 $\\max_{k = j} ^{i}\\{h_k\\}$ \u4ea7\u751f\u8d21\u732e\uff0c\u90a3\u4e48\u6211\u4eec\u8bb0 $pre_i$\uff0c\u4f7f\u5f97 $h_{pre_i}$ \u662f $i$ \u5de6\u4fa7\u7684 $h$ \u4e2d\u7b2c\u4e00\u4e2a\u5927\u4e8e $h_i$ \u7684\u6570\u3002\u90a3\u4e48 $max_{k = pre_i + 1}^{i} = h_i$\u3002\n\n\u56e0\u6b64\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u9700\u8981\u7ef4\u62a4\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $f$ \u548c $f + h_{max}$\uff0c\u652f\u6301\u5c06 $[pre_i, i]$ \u4e2d\u7684 $f + h_{max}$ \u4fee\u6539\uff0c\u548c\u67e5\u8be2\u4e00\u6bb5\u533a\u95f4\u5185 $f + h_{max}$ \u7684\u6700\u5c0f\u503c\uff0c\u672c\u9898\u89e3\u91c7\u7528\u7ebf\u6bb5\u6811\uff0c\u5728\u6bcf\u4e2a\u4f4d\u7f6e $i$ \u7ef4\u62a4 $f_{i - 1} $ \u548c $f_{i - 1} + h_{max}$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u81f3\u4e8e\u9650\u5236\u6761\u4ef6 $\\sum_{k = j}^{i}{w_k} \\le L$\uff0c\u53ef\u4ee5\u4e8c\u5206\u51fa\u7b2c\u4e00\u4e2a\u70b9 $t$\uff0c\u4f7f\u5f97 $s_i - s_t \\le L$\u3002\n\n------------\n\n\u5728\u679a\u4e3e\u5230\u6bcf\u4e2a\u70b9 $i$ \u65f6\uff0c\n\n- \u5355\u70b9\u4fee\u6539\uff0c\u5c06\u7ebf\u6bb5\u6811\u4e0a\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u6539\u6210 $f_{i - 1}$\u3002\n- \u66f4\u65b0 $[pre_i, i]$ \u7684 $f + h_{max}$\u3002\n- \u4e8c\u5206\u51fa\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u9650\u5236\u7684\u70b9 $t$\u3002\n- \u67e5\u8be2 $[t + 1, i]$ \u4e2d $f + h_{max}$ \u7684\u6700\u5c0f\u503c\u3002\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define int long long\n#define rep(a, b, c) for(int (a) = (b); (a) <= (c); ++ (a))\n#define per(a, b, c) for(int (a) = (b); (a) >= (c); -- (a))\nusing namespace std;\n\nconst int N = 1e5 + 10, inf = 1e18;\n\nint n, m;\nint f[N], h[N], s[N], stk[N], top, pre[N], w[N];\n\nstruct Tree {\n\tint l, r;\n\tint f, res, tag;\n}tr[N << 2];\n\nvoid upd(int u) {\n\ttr[u].f = min(tr[u << 1].f, tr[u << 1 | 1].f);\n\ttr[u].res = min(tr[u << 1].res, tr[u << 1 | 1].res);\n}\n\nvoid psd(int u) {\n\tif(tr[u].tag) {\n\t\ttr[u << 1].res = tr[u << 1].f + tr[u].tag;\n\t\ttr[u << 1 | 1].res = tr[u << 1 | 1].f + tr[u].tag;\n\t\ttr[u << 1].tag = tr[u << 1 | 1].tag = tr[u].tag;\n\t\ttr[u].tag = 0;\n\t}\n}\n\nvoid build(int u, int l, int r) {\n\ttr[u].l = l, tr[u].r = r;\n\tif(l == r) {\n\t\ttr[u].f = tr[u].res = inf;\n\t\ttr[u].tag = 0;\n\t\treturn;\n\t}\n\tint mid = l + r >> 1;\n\tbuild(u << 1, l, mid), build(u << 1 | 1, mid + 1, r);\n\tupd(u);\n}\n\nvoid modify(int u, int pos) {\n\tif(tr[u].l == tr[u].r) {\n\t\ttr[u].res = inf;\n\t\ttr[u].f = f[pos - 1];\n\t\treturn;\n\t}\n\tpsd(u);\n\tint mid = tr[u].l + tr[u].r >> 1;\n\tif(pos <= mid) modify(u << 1, pos);\n\telse modify(u << 1 | 1, pos);\n\tupd(u);\n}\n\nvoid modify(int u, int l, int r, int d) {\n\tif(l <= tr[u].l && r >= tr[u].r) {\n\t\ttr[u].res = tr[u].f + d;\n\t\ttr[u].tag = d;\n\t\treturn;\n\t}\n\tpsd(u);\n\tint mid = tr[u].l + tr[u].r >> 1;\n\tif(l <= mid) modify(u << 1, l, r, d);\n\tif(r > mid) modify(u << 1 | 1, l, r, d);\n\tupd(u);\n}\n\nint query(int u, int l, int r) {\n\tif(l <= tr[u].l && r >= tr[u].r) return tr[u].res;\n\tpsd(u);\n\tint mid = tr[u].l + tr[u].r >> 1;\n\tint res = inf;\n\tif(l <= mid) res = min(res, query(u << 1, l, r));\n\tif(r > mid) res = min(res, query(u << 1 | 1, l, r));\n\treturn res;\n}\n\nsigned main() {\n\tscanf(\"%lld%lld\", &n, &m);\n\trep(i, 1, n) scanf(\"%lld%lld\", &h[i], &w[i]), s[i] = s[i - 1] + w[i];\n\tstk[ ++ top] = 1;\n\trep(i, 2, n) {\n\t\twhile(top && h[stk[top]] <= h[i]) -- top;\n\t\tif(top) pre[i] = stk[top];\n\t\tstk[ ++ top] = i;\n\t}\n\tbuild(1, 1, n);\n\trep(i, 1, n) {\n\t\tmodify(1, i);\n\t\tmodify(1, pre[i] + 1, i, h[i]);\n\t\tint l = lower_bound(s, s + i + 1, s[i] - m) - s;\n\t\tf[i] = query(1, l + 1, i);\n\t}\n\tprintf(\"%lld\\n\", f[n]);\n\treturn 0;\n}\n```\n\n\u540e\u8bb0\uff1a[\u53cc\u500d\u7ecf\u9a8c](https://www.luogu.com.cn/problem/P1295)\u3002\n\n\u4f5c\u8005\u5b66\u4e60\u65f6\u53c2\u8003\u4e86[\u8fd9\u7bc7\u9898\u89e3](https://www.luogu.com.cn/blog/luckyblock/solution-p1295)\u3002",
        "postTime": 1679731221,
        "uid": 477674,
        "name": "Lagerent",
        "ccfLevel": 0,
        "title": "[USACO12OPEN]Bookshelf G \u9898\u89e3"
    },
    {
        "content": "\u8c03\u4e86\u4e24\u4e2a\u4e0b\u5348+\u4e00\u4e2a\u665a\u4e0a\uff0c\u6c34\u7bc7\u9898\u89e3\u662f\u5f53\u7136\u7684\u4e8b\u60c5\u3002\u53cd\u6b63\u8fd9\u9053\u9898\u5bf9\u4e8e\u6211\u8fd9\u79cd\u849f\u84bb\u4e5f\u662f\u9053\u795e\u9898\uff0c~~\u81ea\u5df1\u90fd\u5f88\u60ca\u8bb6\u4e8e\u4e3a\u4ec0\u4e48\u4e0d\u770b\u9898\u89e3\u80fd\u505a\u51fa\u6765~~\n\n# $\\texttt{Description}$\n\n> \u6709 $n$ \u4e2a\u6570\u5bf9 $(h_i,w_i)$\uff0c\u8981\u6c42\u5c06\u8fd9\u4e9b\u6570\u5bf9\u5206\u6210\u4efb\u610f\u4e2a\u8fde\u7eed\u7684\u6bb5\uff0c\u8981\u6c42\u6bcf\u6bb5 $w_i$ \u4e4b\u548c\u5747\u4e0d\u8d85\u8fc7 $L$\uff0c\u6bcf\u6bb5\u7684\u82b1\u8d39\u4e3a\u8be5\u6bb5\u4e2d $h_i$ \u7684\u6700\u5927\u503c\uff0c\u8bf7\u8f93\u51fa\u6700\u5c0f\u7684\u82b1\u8d39\u3002\n\n# $\\texttt{Solution}$\n\n\u9996\u5148\u770b\u5b8c\u9898\u5c31\u5e94\u8be5\u60f3\u5230 $O(n^2)$ \u7684\u66b4\u529b\uff0c$dp_i$ \u8868\u793a\u5212\u5206\u4e86\u524d $i$ \u4e2a\u6570\u5bf9\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u5219 $dp_i=min^{j<n}_{j=lim_i}dp_j+mx_{j+1,i}$\u3002 $lim_i$ \u8868\u793a\u6ee1\u8db3 $\\sum\\limits^{j\\le i}_{j=0}\\le L$ \u7684\u6700\u5c0f $j$ \u52a0\u4e0a $1$\u3002$mx_{l,r}$ \u8868\u793a $max^{i\\le r}_{i=l}h_i$\uff0c\u53ef\u4ee5\u6253\u4e2ast\u8868\u7b97\uff0c$lim$ \u53ef\u4ee5\u524d\u7f00\u548c+\u4e8c\u5206\u3002\n\n\u7136\u800c\u8fd9\u9898 $n\\le 10^5$ \u7684\u6570\u636e\u8303\u56f4\u662f\u4e0d\u662f\u592a\u5c0f\u4e86\u4ebf\u70b9\uff0c\u4fdd\u4e0d\u51c6\u54ea\u5929\u5c31\u88ab\u5947\u5947\u602a\u602a\u7684\u66b4\u529b\u8279\u4e86\uff08\n\n\u4f18\u5316\uff1f\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u4e0d\u96be\u53d1\u73b0 $i$ \u589e\u52a0 $1$ \u540e\uff0c\u6709\u7684 $mx_{j,i}$ \u4e0d\u4f1a\u53d8\uff0c\u6709\u7684\u4f1a\u53d8\u3002\u54ea\u4e9b\u4f1a\u53d8\u5462\uff1f\u8bbe $left_i$ \u8868\u793a $i$ \u524d\u9762\u7b2c\u4e00\u4e2a $h$ \u503c\u5927\u4e8e\u7b49\u4e8e $i$ \u7684\u4f4d\u7f6e $j$\uff0c\u4e0d\u96be\u53d1\u73b0 $mx_{left_i+1,i},mx_{left_i+2,i},mx_{left_i+3,i}...mx_{i,i}$ \u76f8\u5bf9\u4e8e $mx_{left_i+1,i-1},mx_{left_i+2,i-1},mx_{left_i+3,i-1}...mx_{i,i-1}$ \u4f1a\u53d8\u4e3a $h_i$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c$[left_i+1,i]$ \u8fd9\u6bb5\u533a\u95f4\u7684 $mx$ \u503c\u4f1a\u53d8\u5316\u4e3a\u4e00\u4e2a\u5b9a\u503c\u3002\u597d\u50cf\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u4f46\u56e0\u4e3a\u6211\u4eec\u8981\u7ef4\u62a4\u7684\u662f $dp_j+mx_{j,i}$ \u7684\u6700\u5927\u503c\uff0c\u800c\u4e0d\u662f\u4e24\u8005\u4efb\u610f\u4e00\u4e2a\u7684\u6700\u5927\u503c\uff0c\u65e0\u6cd5\u7b80\u5355\u5730\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4~~\u4e0d\u7136\u4f60\u89c9\u5f97\u8fd9\u9898\u4e3a\u4ec0\u4e48\u4f1a\u7d2b\u3002~~\n\n\u6ce8\u610f\u5230 dp \u6570\u7ec4\u5355\u8c03\u4e0d\u964d\uff0c\u56e0\u6b64 $[left_i+1,i]$ \u533a\u95f4\u7684 $mx$ \u53d8\u4e00\u6837\u4e86\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651 $left_i+1$ \u8fd9\u4e2a dp \u503c\u6700\u5c0f\u7684\u70b9\u3002\u81f3\u4e8e\u5982\u679c $left_i+1<lim_i$ \u600e\u4e48\u529e\uff0c\u5355\u72ec\u8003\u8651 $lim_i$ \u8fd9\u4e2a\u51b3\u7b56\u70b9\u5373\u53ef\u3002\n\n\u76f4\u63a5\u628a\u8fd9\u4e9b\u53ef\u80fd\u6700\u4f18\u7684\u51b3\u7b56\u70b9\u653e\u5230\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u4e2d\u3002\u6ce8\u610f\uff0c\u5982\u679c\u4e4b\u524d $[left_j+1,j]$ \u533a\u95f4\u7684 $mx$ \u503c\u4ea7\u751f\u53d8\u5316\uff0c\u800c\u73b0\u5728 $[left_i+1,i]$ \u7684 $mx$ \u503c\u53c8\u6709\u53d8\u5316\uff0c\u4e14\u6ee1\u8db3 $left_i\\leq left_j$\uff0c**\u76f4\u63a5\u820d\u5f03 $left_j+1$ \u8fd9\u4e2a\u51b3\u7b56\u70b9**\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u5730\u4f7f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u53ef\u80fd\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u5462\uff1f\u7531\u4e8e\u6211\u4eec\u6309\u7167 $1...n$ \u7684\u987a\u5e8f\u9012\u63a8 dp \u6570\u7ec4\uff0c\u56e0\u6b64\u4e00\u5b9a\u5b58\u5728 $j\\le i$\uff0c\u90a3\u4e48 $left_i\\le left_j$\uff0c\u4e0d\u5c31\u610f\u5473\u7740 $[left_j+1,j]$ \u8fd9\u6bb5\u533a\u95f4\u88ab**\u5b8c\u5168\u5305\u542b**\uff0c$left_j+1$ \u4e5f\u4e0d\u518d\u662f $mx$ \u76f8\u540c\u7684\u4e00\u4e2a\u8fde\u7eed\u6bb5\u91cc\u4e0b\u6807\u6700\u5c0f\u7684\u4e86\u5417\uff1f\n\n\u6bcf\u6b21\u5f39\u6808\uff0c\u8fdb\u6808\u65f6\uff0c\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u7ef4\u62a4\u8fd9\u4e9b\u6700\u4f18\u51b3\u7b56\u70b9\u7684\u503c\u3002\u53d6 $[lim_i,i]$ \u4e2d\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u503c\u6700\u5c0f\u7684\uff0c\u518d\u5355\u72ec\u8003\u8651 $lim_i$ \u8fd9\u4e2a\u51b3\u7b56\u70b9\u3002\u5982\u679c\u4f60\u770b\u61c2\u4e86\u7684\u8bdd\uff0c\u4f1a\u53d1\u73b0\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n# $\\texttt{Code}$\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#define int long long\n#define N 100005\n\nconst int INF = 1000000000000000000LL;\ninline int min(const int x, const int y) {return x < y ? x : y;}\ninline int max(const int x, const int y) {return x > y ? x : y;}\nint w[N], h[N], lim[N], dp[N], lft[N], sub[N], s[N << 1], st[N][17], top;\n\nstruct Node {\n\tint l, r, v;\n} c[N << 2];\nvoid make_tree(const int O, const int L, const int R) {\n\tc[O].l = L, c[O].r = R, c[O].v = INF;\n\tif (L != R) {\n\t\tmake_tree(O << 1, L, L + R >> 1);\n\t\tmake_tree(O << 1 | 1, (L + R >> 1) + 1, R);\n\t}\n}\nvoid update(const int O, const int x, const int d) {\n\tif (c[O].l == c[O].r) {c[O].v = d; return;}\n\tint mid(c[O].l + c[O].r >> 1);\n\tif (x <= mid) update(O << 1, x, d);\n\telse update(O << 1 | 1, x, d);\n\tc[O].v = min(c[O << 1].v, c[O << 1 | 1].v);\n}\nint query(const int O, const int L, const int R) {\n\tif (L <= c[O].l && c[O].r <= R) return c[O].v;\n\tint mid(c[O].l + c[O].r >> 1), ans(INF);\n\tif (L <= mid) ans = query(O << 1, L, R);\n\tif (mid < R) ans = min(ans, query(O << 1 | 1, L, R));\n\treturn ans;\n}\ninline int query(int L, int R) {\n\tint k(log2(R - L + 1));\n\treturn max(st[L][k], st[R - (1 << k) + 1][k]);\n}\n\nsigned main() {\n\tint n, L;\n\tscanf(\"%lld%lld\", &n, &L);\n\tfor (int i(1); i <= n; ++ i)\n\t\tscanf(\"%lld%lld\", h + i, w + i), sub[i] = sub[i - 1] + w[i];\n\tfor (int i(1); i <= n; ++ i) st[i][0] = h[i];\n\tfor (int i(n); i >= 1; -- i)\n\tfor (int j(1); i + (1 << j - 1) <= n; ++ j)\n\t\tst[i][j] = max(st[i][j - 1], st[i + (1 << j - 1)][j - 1]);\n\tfor (int i(n); i; -- i) {\n\t\twhile (top && h[s[top]] < h[i]) lft[s[top --]] = i;\n\t\ts[++ top] = i;\n\t}\n\ttop = 0;\n\tfor (int i(1); i <= n; ++ i)\n\t\tlim[i] = std::lower_bound(sub, sub + n + 1, sub[i] - L) - sub;\n\tmake_tree(1, 0, n);\n\tfor (int i(1); i <= n; ++ i) {\n\t\twhile (top && lft[i] < s[top]) update(1, s[top --], INF);\n\t\ts[++ top] = lft[i], update(1, lft[i], dp[lft[i]] + h[i]);\n\t\tdp[i] = min(query(1, lim[i], i), dp[lim[i]] + query(lim[i] + 1, i));\n\t}\n\tprintf(\"%lld\", dp[n]);\n\treturn 0;\n}\n```\n\n# $\\texttt{Summary}$\n\n\u795e\u9898\u5199\u4e00\u4e0b\u89e3\u9898\u603b\u7ed3\u8fd8\u662f\u6709\u7528\u7684\u3002\n\n\u8fd9\u79cd\u9898\u6838\u5fc3\u5728\u4e8e\u4f18\u5316 DP\u3002\u5355\u8c03\u961f\u5217/\u5355\u8c03\u6808\u662f\u6700\u5e38\u89c1\u7684\u6570\u636e\u7ed3\u6784\u4f18\u5316 dp \u7684\u624b\u6bb5\u3002\u7ebf\u6bb5\u6811/\u6811\u72b6\u6570\u7ec4/\u5e73\u8861\u6811\u7b49\u5176\u5b83\u6570\u636e\u7ed3\u6784\u4e5f\u53ef\u80fd\u4f1a\u7528\u5230\u3002\n\n\u6240\u4ee5\u9700\u8981\u5145\u5206\u6316\u6398\u9898\u76ee\u7684\u5355\u8c03\u6027\u3002\u800c\u4e14\uff0c\u5bf9\u4e8e DP \u548c\u5404\u79cd\u6570\u636e\u7ed3\u6784\u800c\u8a00\uff0c**\u8fde\u7eed\u6027**\u4e2a\u4eba\u611f\u89c9\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u70b9\u3002\u6bd4\u5982\u7ebf\u6bb5\u6811\uff0c\u5982\u679c\u8981\u4fee\u6539\u7684\u96c6\u5408\u662f\u4e00\u4e9b\u96f6\u6563\u7684\u4f4d\u7f6e\u5c31\u5f88\u96be\u9ad8\u6548\u5730\u4fee\u6539\uff0c\u53cd\u4e4b\uff0c\u5982\u679c\u4fee\u6539\u7684\u96c6\u5408\u662f\u8fde\u7eed\u5730\u533a\u95f4\u5c31\u4f1a\u5bb9\u6613\u5f88\u591a\u3002dp \u4e5f\u662f\uff0c\u8fd9\u9053\u9898\u89c4\u5b9a\u4e86\u5206\u51fa\u7684\u6bb5\u5fc5\u987b\u5bf9\u4e8e\u539f\u6765\u7684\u4f4d\u7f6e\u662f\u8fde\u7eed\u7684\uff0c\u56e0\u6b64\u624d\u53ef\u4ee5\u5b9a\u51fa\u8fd9\u6837\u7684\u72b6\u6001\u3002\u4e0d\u7136\u5982\u679c\u8f6c\u79fb\u987a\u5e8f\u4e0d\u660e\uff0c\u53ef\u80fd\u5c31\u9700\u8981\u72b6\u538b\u4e86\u3002",
        "postTime": 1614590053,
        "uid": 361308,
        "name": "Stinger",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]Bookshelf G\u3011"
    },
    {
        "content": "emmm \u8fd9\u4e2a\u9898\u76ee\u809b\u4e86\u4e00\u4e2a\u665a\u81ea\u4fee\u5199\u51fa\u6765\uff08\u4e0d\u5305\u62ec\u601d\u8003\u8fc7\u7a0b\uff09\n\u4e3b\u8981\u601d\u8def\u697c\u4e0a\u8bb2\u7684\u5f88\u6e05\u695a\u5427\uff0c\u6240\u4ee5\u6211\u5c31\u968f\u4fbf\u8bb2\u8bb2\n\n\u7b80\u5355\u7684dp\u65b9\u7a0b\u8fd8\u662f\u6bd4\u8f83\u597d\u60f3\u7684\u4f46\u662fn\u65b9\u7684\u65f6\u95f4\u663e\u7136\u8fc7\u4e0d\u4e86\n### f[i]=min(f[j]+max(h[i]....h[j])) sum[i..j]<=L\n\u4e8e\u662f\u8003\u8651\u4f18\u5316\u4ee5\u4e0b\u5206\u597d\u51e0\u4e2a\u70b9\n\n------------\n### \u8003\u8651\u5230max(h[i])\u662f\u4e00\u6bb5\u6bb5\u53d8\u5316\u7684\u53ef\u4ee5\u5408\u5e76\u4e14 f \u5355\u8c03\u4e0d\u51cf\u56e0\u6b64\u53ea\u9700\u8003\u8651h[i]\u53d8\u5316\u7684\u70b9\uff0c\u5373\u51b3\u7b56\u70b9 \u6545\u6709\u4e24\u79cd\u7ef4\u62a4\u65b9\u6cd5\n#### 1.\u5355\u8c03\u6808+\u4e8c\u5206\u4f4d\u7f6e\n#### 2.\u5bf9\u5f53\u524di\u4f4d\u7f6e\u7684\u5355\u8c03\u961f\u5217\uff08\u4fdd\u7559\u6700\u5f00\u59cb\u5143\u7d20\u5373head<tail\u4e0d\u53d6\u7b49\uff09\n\u53cd\u6b63\u5404\u6709\u6240\u7231\u5427\uff0c~~\u4e2a\u4eba\u559c\u6b22\u5355\u8c03\u961f\u5217\u4e00\u70b9~~\n\n### \u7136\u540e\u5728max(h[i]) \u7ef4\u62a4\u597d\u7684\u524d\u63d0\u4e0bf \u7684 dp\u53ea\u8981\u8003\u8651\u51b3\u7b56\u70b9\u4e14\u6ee1\u8db3\u5355\u8c03\u6027\n#### 1.\u6570\u636e\u7ed3\u6784 \u7ebf\u6bb5\u6811\uff08\u652f\u6301\u5355\u70b9\u4fee\u6539\uff09~~\u66b4\u529b~~\u585e\u5165\u51b3\u7b56\u70b9\u6570\u636e\n#### 2.STL multiset \u4e5f\u662f\u7ef4\u62a4\u6700\u5c0f\u503c\u53d6*begin\uff08\u540c\u6837\u66b4\u529b\u585e\u8fdb\u53bb\uff09\n#### 3.heap \u5c0f\u6839\u5806\uff08\u53cd\u6b63\u5c31\u662f\u7ef4\u62a4\u6700\u5c0f\u503c\u561b\uff09\u5dee\u4e0d\u591a\u5176\u5b9e\u4e0d\u8fc7\u5feb\u4e00\u4e9b\uff0c\u597d\u50cf\u697c\u4e0a\u90fd\u6ca1\u8bb2\u5230\n#### 4.\u7136\u540e\u7ffb\u4e86\u4e00\u4e0b\u770b\u5230\u8fd8\u6709\u4e00\u4e2a\u65b9\u6cd5\u5c31\u662f\u5199priority_queue\u770b\u5230\u4e00\u4e2a\u795e\u4ed9\u8dd1\u5f97\u98de\u5feb\u4e0d\u5438\u6c27200\u6beb\u79d2\u5f88\u53ef\u6015\u554a\u849f\u84bb\u81ea\u53f9\u4e0d\u5982\n\n\n------------\n\n\u6700\u540e\u4e48\u5c31\u662f\u5728\u6700\u524d\u9762\u51b3\u7b56\u70b9\u4e0d\u7b26\u5408\u6761\u4ef6\u65f6\u5f80\u540e\u79fb\u52a8\u4e00\u4f4d(\u4e24\u4e2a\u5143\u7d20\u4e0d\u76f8\u90bb\u5426\u5219\u76f4\u63a5\u961f\u5934\u540e\u79fb)\uff0c\u6211\u7684\u987a\u5e8f\u662f\u5148\u66f4\u65b0\u961f\u5217\u7136\u540e\u5220\u70b9\u518d\u66f4\u65b0f\n\n\u7136\u540e\u5410\u69fd\u4ee5\u4e0b\u8c03\u8bd5\u8fc7\u7a0bstl\u771f\u7684\u96be\u8c03\u8bd5 **\u54ed**\u8fd8\u6709\u6211\u81ea\u5df1\u7684\u4ee3\u7801\u5355\u8c03\u961f\u5217\u51fa\u95ee\u9898\u4e86\u770b\u4e00\u4e0b\u673a\u623f\u795e\u4ed9\u4ee3\u7801**\u7384\u5b66**\u4e00\u6b65\u770b\u4e0d\u61c2\u554a\u5f88\u96be\u53d7 \u7ebf\u6bb5\u6811\u4e0d\u600e\u4e48\u6211\u7684\u83dc\uff0c**\u4ee3\u7801\u5c31\u4e0d\u5199\u4e86**\uff0c\u597d\u50cf\u90fd\u5dee\u4e0d\u591a\uff0c\u987a\u4fbf\u819c\u4e00\u4e0b\n### [\u795e\u4ed9](https://www.luogu.org/space/show?uid=35069)rank 1 \u5de8\u79c0 \u77ac\u95f4\u79d2\u638920\u5206\u949f\u6572\u5b8c\u4e00\u904dA\u6000\u7591\u4eba\u751f\u3002\u3002\u3002\u8fd8\u597d\u5199\u7ebf\u6bb5\u6811\u6bd4\u6211stl\u6162~~\u563b\u563b\u563b~~",
        "postTime": 1554705836,
        "uid": 60250,
        "name": "will5438",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "### \u6bcf\u5468\u6587\u7ae0\u8ba1\u5212 2021.12 \u7b2c\u4e8c\u5468\u7b2c\u4e00\u7bc7\n\n\u7ba1\u7406\u6c42\u8fc7www\u3002\u3002\u3002\n\n[\u663e\u7136\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://lookcatbox.blog.luogu.org/solution-p1848)\n\n\u9898\u89e3\u539f\u9898\uff1a[P1295  [TJOI2011]\u4e66\u67b6](https://www.luogu.com.cn/problem/P1295) \u6b64\u9898\u4e3a\u672c\u9898\u7684 $w_i$ \u548c $h_i$ \u76f8\u7b49\u7684\u60c5\u51b5\uff0c\u505a\u6cd5\u672c\u8d28\u76f8\u540c\u3002\n\n\u9898\u76ee\u5927\u610f\uff1a**\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a$\uff0c\u8bf7\u5c06 $a$ \u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6ee1\u8db3\u6bcf\u6bb5\u6570\u5b57\u4e4b\u548c\u90fd\u4e0d\u8d85\u8fc7 $m$\uff0c\u6700\u5c0f\u5316\u6bcf\u6bb5\u7684\u6700\u5927\u503c\u4e4b\u548c\u3002**\n\n~~\u770b\u4e0d\u61c2\u9898\u89e3\u968f\u4fbf\u624b\u6253\u5c45\u7136AC\u4e86\u5624\u5624\u5624\u3002~~\n\n\u5927\u90e8\u5206\u9898\u89e3\u4f7f\u7528\u7ebf\u6bb5\u6811\u4f18\u5316 $dp$ \uff0c\u4f46\u7ebf\u6bb5\u6811\u5199\u7740\u597d\u7d2f\uff0c\u4e0d\u5982\u6765\u770b\u4e00\u79cd\u5806\u7684\u89e3\u6cd5\u3002\n\n\u8bbe $f_i$ \u4e3a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u6570\uff0c\u6700\u5927\u503c\u4e4b\u548c\u7684\u6700\u5c0f\u503c\u3002\n\n\u5f88\u5bb9\u6613\u5199\u51fa $dp$ \u5f0f\uff1a\n\n$f_i$ = $min$ ($f_i$ , $f_j$ $+$ $max${$a_{j+1},a_{j+2},\u00b7\u00b7\u00b7 ,a_i$} ) ($\\sum_{k=j+1}^i a_k$ $\\leq m$ )\n\n\u679a\u4e3e$i,j$\u5373\u53ef\u83b7\u5f97 $O(n^2)$ \u505a\u6cd5\uff0c\u5f97\u5230 $30pt$ \u3002\n\n\u8003\u8651\u4f18\u5316\u3002\n\n\u6613\u5f97$f_i$ $\\leq$ $f_j $ ($i<j$) , \u8bc1\u660e$f_i$ \u5355\u8c03\u4e0d\u964d\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5728 $max${$j+1,i$} \u76f8\u540c\u65f6\uff0c\u9009\u53d6\u6700\u5c0f\u7684 $j$ \u603b\u662f\u6700\u4f18\u7684\u3002\n\n\u6211\u4eec\u8003\u8651\u7528\u5355\u8c03\u6808\u9884\u5904\u7406\u51fa $a_i$ \u4f5c\u4e3a\u6700\u5927\u503c\u7684\u6700\u957f\u533a\u95f4 $[mi_i,mx_i]$ \u3002\n\n\u663e\u7136\uff0c\u5982\u679c\u6211\u4eec\u9009\u62e9 $a_i$ \u4f5c\u4e3a\u8f6c\u79fb\u65f6\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48$f_{mi_i-1}$ \u5fc5\u5b9a\u662f\u6700\u5c0f\u7684 $f$ \u3002\n\n\u7528\u5c0f\u6839\u5806\u7ef4\u62a4\uff0c\u5206\u522b\u8bb0\u4e0b\uff1a\n\n$val$ , $id$ , $fr$ \u8868\u793a\u72b6\u6001\u7684\u503c\uff0c\u6b64\u72b6\u6001\u6240\u91c7\u53d6\u7684\u6700\u5927\u503c\u7684\u7f16\u53f7\uff0c\u6b64\u72b6\u6001\u6240\u91c7\u53d6\u7684 $f$ \u503c\u7684\u7f16\u53f7\u3002\n\n\u8003\u8651\u9650\u5236\u6761\u4ef6\u3002\n\n\u9884\u5904\u7406 $lst$ \u4f5c\u4e3a\u6ee1\u8db3 $\\{\\sum_{j=lst+1}^i a_j \\}$  $\\leq$ $m$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u5982\u679c $id$ $\\leq$ $lst$ , \u6700\u5927\u503c\u5230 $i$ \u90fd\u5df2\u7ecf $>m$ \u4e86\uff0c\u4e0d\u884c \uff0c$pop$ \u3002\n\n\u5982\u679c $mx_{id} < i $ \u663e\u7136\u4e5f\u4e0d\u884c\uff0c\u56e0\u4e3a\u8fd9\u65f6\u5019 $a_i > a_{id}$  $id$ \u5df2\u7ecf\u5f71\u54cd\u4e0d\u5230 $i$ \u4e86\uff0c$pop$ \u3002\n\n\u5982\u679c $fr < lst$ \uff0c\u4e5f\u662f\u4e0d\u884c\uff0c\u6240\u4ee5\u76f4\u63a5 $pop$ \u00b7\u00b7\u00b7\u5417\uff1f\n\n\u663e\u7136\u8fd9\u662f\u4e0d\u80fd\u76f4\u63a5$pop$ \uff0c \u867d\u7136\u6211\u7406\u8bba\u4e0a\u7684\u6700\u5c0f\u503c\u53d6\u4e0d\u5230\u4e86\uff0c\u4f46\u6211\u8fd8\u53ef\u4ee5\u53d6\u6b64\u65f6\u8fd8\u5b58\u5728\u7684\u6700\u5c0f\u503c\uff0c\u5c06 $f_{mi_i-1}$ \u66ff\u6362\u6210 $f_{lst}$ \u4e0d\u5c31\u53ef\u4ee5\u53d6\u5230\uff0c\u4e14\u6ee1\u8db3\u5728\u80fd\u53d6\u5230\u4e14\u6700\u5927\u503c\u4e3a$a_{id}$\u7684\u72b6\u6001\u4e2d\u6700\u5c0f\u5417\u3002\n\n\u56e0\u6b64\u5bf9\u4e8e\u7b2c\u4e09\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u628a $val$ \u6539\u4e3a  $f_{lst}+a_{id}$ \uff0c\u628a $fr$ \u6539\u4e3a $lst$ \uff0c\u518d\u6254\u56de\u5806\u91cc\uff08\u6ce8\u610f\u5f97\u5148\u628a\u539f\u6765\u7684\u5f39\u51fa\u518d\u6254\uff09\u3002\n\n\u6700\u540e $f_i$ \u76f4\u63a5\u53d6\u5f53\u524d\u5806\u9876\u7684 $val$ \u5373\u53ef\u3002\n\n\u6ce8\u610f\u5728\u5904\u7406\u5b8c$f_i$\u4e4b\u540e\u5f97\u5148\u628a $a_{i+1}$ \u4f5c\u4e3a\u6700\u5927\u503c\u7684\u72b6\u6001\u6254\u8fdb\u5806\u91cc\u3002\n\n\u5176\u4ed6\u7ec6\u8282\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define N 500010\nusing namespace std;\nlong long n,m,mi[N],mx[N],f[N],sum[N],a[N];\nstruct node{\n\tlong long val,id,fr;\n\tbool operator>(node a2) {return val<a2.val;};\n};\nstruct Priority_queue{\n    node tr[2*N];\n    int cnt;\n    void init() {cnt=0;}\n    bool empty() {return !cnt;}\n    void push(node num) {\n    \ttr[++cnt]=num;\n\t\tint now=cnt;\n    \twhile(now!=1&&num>tr[now/2]) swap(tr[now],tr[now/2]),now/=2;\n\t} \n\tvoid pop() {\n\t    swap(tr[1],tr[cnt]),cnt--;\n\t    int now=1;\n\t    while((2*now<=cnt&&tr[2*now]>tr[now])||(2*now+1<=cnt&&tr[2*now+1]>tr[now])) {\n\t    \tif(2*now+1>cnt||tr[2*now]>tr[2*now+1]) swap(tr[now],tr[2*now]),now*=2;\n\t\t\telse swap(tr[now],tr[2*now+1]),now=2*now+1; \n\t\t}\n\t}\n\tnode top() {return tr[1];}\n}q;\nnode stk[N];\nint top;\nint main()\n{\n\tq.init();\n\tcin>>n>>m;\n\tfor(int i=1; i<=n; i++) {\n\t\tcin>>a[i];int tmp=a[i];\n\t\tcin>>a[i];\n\t\tsum[i]=sum[i-1]+a[i],a[i]=tmp;\n\t}\n\tfor(int i=1; i<=n; i++) {\n\t\twhile(top&&stk[top].val<=a[i]) top--;\n\t\tif(!top) mi[i]=1;\n\t\telse mi[i]=stk[top].id+1;\n\t\tstk[++top]=node{a[i],i};\n\t}   \n\ttop=0;\n\tfor(int i=n; i>=1; i--) {\n\t\twhile(top&&stk[top].val<=a[i]) top--;\n\t\tif(!top) mx[i]=n;\n\t\telse mx[i]=stk[top].id-1;\n\t\tstk[++top]=node{a[i],i};\n\t}  \n    f[1]=a[1],q.push(node{a[1],1,0});\n    int lst=0;\n\tfor(int i=1; i<=n; i++) {\n\t\twhile(sum[i]-sum[lst]>m) lst++;\n\t\twhile(!q.empty()&&(q.top().id<=lst||mx[q.top().id]<i||q.top().fr<lst)) {\n\t\t\tif(q.top().id<=lst||mx[q.top().id]<i) q.pop();\n\t\t\telse {\n\t\t\t\tnode tmp=node{f[lst]+a[q.top().id],q.top().id,lst};\n\t\t\t\tq.pop(),q.push(tmp);\n\t\t\t}\n\t\t}\n\t\tf[i]=q.top().val;\n\t    q.push(node{f[mi[i+1]-1]+a[i+1],i+1,mi[i+1]-1});\n\t}\n    cout<<f[n];\n\treturn 0;\n}\n```\n\nps\uff1a\u672c\u6765\u662f\u60f3\u6253[[ZJOI2006]\u4e66\u67b6](https://www.luogu.com.cn/problem/P2596)\u7684\uff08\u6821\u5185\u4f5c\u4e1a\uff09\uff0c\u7ed3\u679c\u56e0\u4e3a\u6253\u5f00\u4e86\u592a\u591a\u9053\u201c\u4e66\u67b6\u201d\uff0c\u6700\u540e\u505a\u6210\u4e86\u8fd9\u9053\u3002\n\n\n",
        "postTime": 1639071214,
        "uid": 124918,
        "name": "LinkyChristian",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]\u4e66\u67b6Bookshelf\u3011"
    },
    {
        "content": "\n[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P1848)\n\n### \u9898\u76ee\u5927\u610f\n\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $h$\uff0c\u548c\u6bcf\u4e00\u4e2a\u6570\u7684 $val$ \uff0c\u8bf7\u5c06 $h$ \u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6ee1\u8db3\u6bcf\u6bb5\u6570\u5b57\u7684 $val$ \u4e4b\u548c\u90fd\u4e0d\u8d85\u8fc7 $m$\uff0c\u6700\u5c0f\u5316\u6bcf\u6bb5\u7684\u6700\u5927\u503c\u4e4b\u548c\u3002\n\n### \u89e3\u9898\u601d\u8def\n\u9996\u5148\u5206\u6790\u9898\u610f\uff0c\u5f97\u5230\u52a8\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_i=min(f_{j-1}+max(h_j\\sim h_i))\\ \\ (\\sum\\limits_{k=j}^i h_k\\leq m)$$\n\n\u7528\u7ebf\u6bb5\u6811\u5b58 $z_j=f_{j-1}+max(h_j\\sim h_i))$\u3002\n\n\u6c42$f_i$ \u76f4\u63a5\u533a\u95f4\u6700\u5c0f\u503c\u5c31\u884c\u4e86\u3002\n\n\u8003\u8651\u600e\u4e48\u5728\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4 $z$ \u7684\u503c\u3002\n\n\u7ebf\u6bb5\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u5b58\u8fd9\u4e2a\u533a\u95f4 $z$ \u7684\u6700\u5c0f\u503c\uff0c$h$ \u7684\u6700\u5927\u503c\u4ee5\u53ca $f$ \u7684\u6700\u5927\u503c\u3002\n\n\u6bcf\u5f53 $i$ \u5411\u53f3\u79fb\u52a8\u4e00\u4f4d\uff0c\u5148\u8003\u8651\u5408\u6cd5\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u4f1a\u4e0d\u4f1a\u56e0\u4e3a $\\sum\\limits_{k=j}^i h_k>m$ \u5411\u53f3\u79fb\u52a8\u3002\n\n\u7136\u540e\u56e0\u4e3a\u53f3\u7aef\u52a0\u5165\u4e86\u4e2a $h_i$ \uff0c\u53ef\u4ee5\u53d1\u73b0\u5728\u533a\u95f4 $[j,i]$ \u91cc\uff0c\u4ece\u6700\u9760\u5de6\u7684\u6ee1\u8db3 $h_x\\le h_i$ \u7684\u4f4d\u7f6e $x$ \uff0c\u533a\u95f4 $[x,i-1]$ \u7684 $h$ \u90fd\u4f1a\u53d8\u4e3a $h_i$\uff0c\u53ef\u4ee5\u4e8c\u5206\u627e\u51fa\u90a3\u4e2a\u4f4d\u7f6e\u7136\u540e\u5728\u7ebf\u6bb5\u6811\u4e0a\u533a\u95f4\u4fee\u6539 $h$ \u7684\u503c\u3002\n\n\u6700\u540e\u522b\u5fd8\u4e86\u628a\u63d2\u5165\u65b0\u7684 $z$ \uff0c$f$ \u548c $h$ \u3002\n\n\u8fd8\u6709\uff0c\u4e00\u5b9a\u8981\u770b\u6570\u636e\u8303\u56f4\uff0c\u8981\u7528 long long\u3002\n### AC CODE\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n#define _ 100005\nusing namespace std;\n\nint n, m;\nint sum;\nint a[_], val[_];\n\ninline int read()\n{\n    int ans = 0, fh = 1;\n    char ch = getchar();\n    while (ch < '0' || ch > '9')\n    {\n        if (ch == '-')\n            fh = -1;\n        ch = getchar();\n    }\n    while (ch >= '0' && ch <= '9')\n        ans = ans * 10 + ch - '0', ch = getchar();\n    return ans * fh;\n}\n\nstruct Tree\n{\n    int z, f, h, lazy;\n} tr[_ << 2];\n\nvoid push_up(int o)\n{\n    tr[o].h = max(tr[o << 1].h, tr[o << 1 | 1].h);\n    tr[o].f = min(tr[o << 1].f, tr[o << 1 | 1].f);\n    tr[o].z = min(tr[o << 1].z, tr[o << 1 | 1].z);\n}\n\nvoid push_down(int o)\n{\n    if (tr[o].lazy)\n    {\n        tr[o << 1].h = tr[o].lazy;\n        tr[o << 1].z = tr[o << 1].f + tr[o].lazy;\n        tr[o << 1].lazy = tr[o].lazy;\n        tr[o << 1 | 1].h = tr[o].lazy;\n        tr[o << 1 | 1].z = tr[o << 1 | 1].f + tr[o].lazy;\n        tr[o << 1 | 1].lazy = tr[o].lazy;\n        tr[o].lazy = 0;\n    }\n}\n\ninline void insert(int o, int l, int r, int d, int qf, int qh)\n{\n    if (l == r)\n    {\n        tr[o].f = qf;\n        tr[o].h = qh;\n        tr[o].z = qf + qh;\n        return;\n    }\n    int mid = (l + r) >> 1;\n    push_down(o);\n    if (d <= mid)\n        insert(o << 1, l, mid, d, qf, qh);\n    else\n        insert(o << 1 | 1, mid + 1, r, d, qf, qh);\n    push_up(o);\n}\n\ninline void revise(int o, int l, int r, int ql, int qr, int qz)\n{\n    if (ql <= l && qr >= r)\n    {\n        tr[o].h = qz;\n        tr[o].z = tr[o].f + qz;\n        tr[o].lazy = qz;\n        return;\n    }\n    int mid = (l + r) >> 1;\n    push_down(o);\n    if (ql <= mid)\n        revise(o << 1, l, mid, ql, qr, qz);\n    if (qr > mid)\n        revise(o << 1 | 1, mid + 1, r, ql, qr, qz);\n    push_up(o);\n}\n\ninline int geth(int o, int l, int r, int ql, int qr)\n{\n    if (ql <= l && qr >= r)\n        return tr[o].h;\n    int mid = (l + r) >> 1;\n    int Ans = 0;\n    push_down(o);\n    if (ql <= mid)\n        Ans = max(Ans, geth(o << 1, l, mid, ql, qr));\n    if (qr > mid)\n        Ans = max(Ans, geth(o << 1 | 1, mid + 1, r, ql, qr));\n    return Ans;\n}\n\ninline int getz(int o, int l, int r, int ql, int qr)\n{\n    if (ql <= l && qr >= r)\n        return tr[o].z;\n    int mid = (l + r) >> 1;\n    int Ans = LLONG_MAX;\n    push_down(o);\n    if (ql <= mid)\n        Ans = min(Ans, getz(o << 1, l, mid, ql, qr));\n    if (qr > mid)\n        Ans = min(Ans, getz(o << 1 | 1, mid + 1, r, ql, qr));\n    return Ans;\n}\n\ninline int getl(int l, int r, int z)\n{\n    int Ans = r + 1;\n    int R = r;\n    r++;\n    while (l < r)\n    {\n        int mid = (l + r) >> 1;\n        if (geth(1, 1, n, mid, R) < z)\n            Ans = r = mid;\n        else\n            l = mid + 1;\n    }\n    return Ans;\n}\n\nsigned main()\n{\n    n = read();\n    m = read();\n    for (int i = 1; i <= n; i++)\n        a[i] = read(), val[i] = read();\n    insert(1, 1, n, 1, 0, a[1]);\n    for (int l = 1, r = 1; r <= n; r++)\n    {\n        sum += val[r];\n        while (sum > m)\n            sum -= val[l++];\n        int x = getl(l, r - 1, a[r]);\n        if (x < r)\n            revise(1, 1, n, x, r - 1, a[r]);\n        if (r == n)\n            cout << getz(1, 1, n, l, r) << endl;\n        else\n            insert(1, 1, n, r + 1, getz(1, 1, n, l, r), a[r + 1]);\n    }\n    return 0;\n}\n```",
        "postTime": 1627483693,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P1848 [USACO12OPEN]Bookshelf G"
    },
    {
        "content": "\u8c03\u4e86\u597d\u4e45\u7684\u9898\uff0c\u5199\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b       \n\u8fd9\u9898\u5176\u5b9e\u6709\u4e24\u79cd\u65b9\u6cd5     \n1. Sol1\uff08\u7b80\u5355$DP$\uff09:    \n\u9884\u5904\u7406\u4e00\u4e0b\u524d\u7f00\u548c     \n\u4ee4$f[i]$\u8868\u793a\u4ee5\u7b2c$i$\u672c\u4e66\u4e3a\u5f53\u524d\u6700\u540e\u4e00\u5c42\u7684\u6700\u540e\u4e00\u672c\u4e66\u7684\u6700\u5c0f\u9ad8\u5ea6   \n$f[i]=min\\{f[j]+max\\{h_k\\}\\}|\\sum_{k=j+1}^{i}w_i\\leq L$   \n\u603b\u590d\u6742\u5ea6$O(n^3)$  \n2. Sol2\uff08\u524d\u7f00$min$\u7a7a\u95f4\u6362\u65f6\u95f4\uff09    \n\u5728$Sol1$\u7684\u57fa\u7840\u4e0a\u4ee4$a[j]$\u8868\u793a$max\\{h_j....h_i\\}$     \n\u603b\u590d\u6742\u5ea6\u6765\u5230\u4e86$O(n^2)$    \n3. Sol3 \uff08\u7ebf\u6bb5\u6811+\u5355\u8c03\u6808\uff09    \n\u8003\u8651\u5355\u8c03\u6808\u4f18\u5316\u8fd9\u4e2a$DP$    \n\u7c7b\u4f3c\u5355\u8c03\u6808\u7684\u8bc1\u660e\uff0c\u53ef\u4ee5\u63a8\u51fa\u4e00\u5171\u53ea\u6709$O(n)$\u4e2a\u533a\u95f4\u4f1a\u5bf9$f$\u4ea7\u751f\u8d21\u732e    \n\u4f7f\u7528\u7ebf\u6bb5\u6811\u4f18\u5316\u8fd9\u4e9b\u533a\u95f4\u5bf9$f$\u7684\u8d21\u732e     \n\u5047\u8bbe\u5f53\u524d\u8003\u8651\u5230\u7684\u533a\u95f4\u662f$[l,r]$      \n\u90a3\u4e48$max\\{h_k\\}=h_r$     \n\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4$min\\{f_j\\}$\u5373\u53ef     \n\u65f6\u95f4\u590d\u6742\u5ea6$O(nlog_2n)$\uff0c\u5f97\u5206$100$    \n4. Sol4 \uff08\u5355\u8c03\u961f\u5217+$multiset$\uff09    \n\u8003\u8651\u5728$Sol2$\u7684\u57fa\u7840\u4e0a\u4f7f\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316    \n\u5176\u5b9e\u5c31\u662f\u5c06\u7ebf\u6bb5\u6811\u66ff\u6362\u6210\u4e86$STL$   $multiset+deque$    \n\u56e0\u4e3a\u4f7f\u7528\u4e86$STL$\uff0c\u6240\u4ee5\u5e38\u6570\u66f4\u5927    \n\n\n\u4e0b\u9762\u653e\u51fa Sol3 \u4ee3\u7801    \n###### \u4e0d\u4fdd\u8bc1\u6240\u6709\u4ee3\u7801\u7684\u6b63\u786e\u6027    \n###### ~~\u6211\u662f\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u7ebf\u6bb5\u6811\u5199\u9519\u4e86\u7684~~     \n\nCode:   \n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<stack>\nusing namespace std;\nconst int NR=1e5+10;\n#define lson (id<<1)\n#define rson (id<<1|1)\n#define mid ((l+r)>>1)\n#define int long long\nint h[NR],w[NR];\nint f[NR];\nint sum[NR];\nint n,L;\nstruct Segment_Tree{\n\tint minn[NR<<3];\n\tvoid init(){\n\t\tmemset(minn,999999,sizeof(minn));\n\t}\n\tvoid update(int id){\n\t\tminn[id]=min(minn[lson],minn[rson]);\n\t}\n\tvoid change(int id,int l,int r,int pos,int k){\n\t\tif(l==r){\n\t\t\tminn[id]=min(minn[id],k);\n\t\t\treturn;\n\t\t}\n\t\tif(pos<=mid)change(lson,l,mid,pos,k);\n\t\telse change(rson,mid+1,r,pos,k);\n\t\tupdate(id);\n\t}\n\tint query(int id,int l,int r,int L,int R){\n\t\tif(L>R)return 1e18;\n\t\tif(r<L||R<l)return 1e18;\n\t\tif(L<=l&&r<=R)return minn[id];\n\t\treturn min(query(lson,l,mid,L,R),query(rson,mid+1,r,L,R));\n\t}\t\n}lcy;\nint q[NR];\nint l,r;\nvoid init(){\n\tstack<int>S;\n\tlcy.init();\n\tmemset(f,999999,sizeof(f));\n\tint now=0;\n\tlcy.change(1,1,n+1,1,0);\n\tfor(int i=1;i<=n;i++){\n\t\tl=1;r=0;\n\t\twhile(!S.empty()&&h[S.top()]>=h[i])q[++r]=S.top(),S.pop();\n\t\tS.push(i);\n\t\twhile(sum[i]-sum[max(0ll,now-1)]>L)now++;\n\t\tfor(int j=l;j<=(l+r)/2;j++)swap(q[j],q[l+r-j]);\n\t\twhile(l<=r&&q[l]<now)q[l++]=0;\n\t\tq[--l]=now-1;q[++r]=i;\n\t\tfor(int j=l;j<r;j++){\n\t\t\tint x=q[j],y=q[j+1]-1;\n\t\t\t//printf(\"x:%lld y:%lld\\n\",x,y);\n\t\t\tf[i]=min(f[i],lcy.query(1,1,n+1,max(x+1,1ll),y+1)+h[y+1]);\n\t\t}\n\t\tlcy.change(1,1,n+1,i+1,f[i]);\n\t\t//printf(\"%lld\\n\",f[i]);\n\t}\n}\nsigned main(){\n\tcin>>n>>L;\n\tfor(int i=1;i<=n;i++)scanf(\"%lld%lld\",&h[i],&w[i]),sum[i]=sum[i-1]+w[i];\n\tinit();\n\tcout<<f[n]<<endl;\n\treturn 0;\n}\n```\n",
        "postTime": 1607601082,
        "uid": 117771,
        "name": "intel_core",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1848 \u3010[USACO12OPEN]Bookshelf G\u3011"
    }
]