[
    {
        "content": "[P6943 [ICPC2018 WF]Conquer The World](https://www.luogu.com.cn/problem/P6943)\u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/xiaoziyao/p/15524172.html)\n\n## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u5e26\u70b9\u8fb9\u6743\u7684\u6811\uff08\u8bbe\u70b9\u6743\u4e3a $v$\uff09\uff0c\u53ef\u4ee5\u4efb\u610f\u5c06\u70b9\u7684\u70b9\u6743\u5728\u6811\u4e0a\u8fdb\u884c\u79fb\u52a8\uff0c\u79fb\u52a8\u5355\u4f4d\u70b9\u6743\u7684\u4ee3\u4ef7\u4e3a\u8def\u5f84\u4e0a\u7684\u8fb9\u6743\u548c\uff0c\u6c42\u8ba9\u6240\u6709\u70b9\u70b9\u6743\u975e\u8d1f\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n$1\\leqslant n\\leqslant 2.5\\times 10^5,\\sum v\\geqslant 0,\\sum[v>0]v\\leqslant 10^6$\n\n## \u5206\u6790\n\n\u5c0f\u6e05\u65b0\u9898\u3002\n\n\u4e0b\u9762\u79f0\u6b63\u70b9\u6743\u70b9\u4e3a\u6e90\uff0c\u8d1f\u70b9\u6743\u70b9\u4e3a\u6c47\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u660e\u663e\u7684\u8d39\u7528\u6d41\u505a\u6cd5\uff0c\u76f4\u63a5\u6e90\u70b9\u8fde\u6b63\u70b9\u6743\uff0c\u8d1f\u70b9\u6743\u8fde\u6c47\u70b9\u7136\u540e\u8d39\u7528\u6d41\u5373\u53ef\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff0c\u5bf9\u4e8e\u5339\u914d\u7684\u4e24\u6761\u8def\u5f84\uff0c\u5b83\u4eec\u4ea4\u53c9\u7684\u4ee3\u4ef7\u4e00\u5b9a\u4e0d\u4f18\u4e8e\u5b83\u4eec\u4e0d\u4ea4\u53c9\u7684\u4ee3\u4ef7\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u53cd\u6094\u8d2a\u5fc3\uff08\u6a21\u62df\u8d39\u7528\u6d41\uff09\uff0c\u8bbe\u5f53\u524d\u5b50\u6811\u7684\u6839\u4e3a $x$\uff0c\u90a3\u4e48\uff1a\n\n\u8d2a\u5fc3\u7b56\u7565\uff1a\u6bcf\u6b21\u627e\u5230\u6df1\u5ea6\u6700\u5c0f\u7684\u6e90\u548c\u6df1\u5ea6\u6700\u5c0f\u7684\u6c47\u8fdb\u884c\u5339\u914d\u3002\n\n\u53cd\u6094\u7b56\u7565\uff1a\u5c06\u6e90\u7684\u70b9\u6743\u6539\u6210 $2dep_x$ \u51cf\u53bb\u6c47\u7684\u70b9\u6743\uff0c\u5c06\u6c47\u7684\u70b9\u6743\u6539\u6210 $2dep_x-$ \u51cf\u53bb\u6e90\u7684\u70b9\u6743\u5373\u53ef\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u6837\u5339\u914d\u4e4b\u540e\u53ef\u4ee5\u53d6\u6d88\u6389\u8fd9\u5bf9\u6e90\u6c47\u7684\u5339\u914d\u3002\n\n\u4f7f\u7528\u5de6\u504f\u6811\u6765\u652f\u6301\u5806\u7684\u5408\u5e76\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sum|v|\\log(\\sum|v|))$\u3002\n\n## \u4ee3\u7801\n\n\u76f4\u63a5\u7528\u4e86 pbds \u6765\u5b9e\u73b0\u5de6\u504f\u6811\u3002\n\n[AC \u8bb0\u5f55](https://www.luogu.com.cn/record/62047327)\n\n```\n#include<stdio.h>\n#include<vector>\n#include<ext/pb_ds/priority_queue.hpp>\n#define inf 1000000000000\nusing namespace std;\nconst int maxn=250005;\nint n,tot;\nint a[maxn],b[maxn];\nlong long ans;\nlong long dep[maxn];\nvector< pair<int,int> >v[maxn];\n__gnu_pbds::priority_queue< long long,greater<long long> >A[maxn],B[maxn];\nvoid dfs(int x,int last){\n\tfor(int i=a[x]+1;i<=b[x];i++)\n\t\tA[x].push(dep[x]-inf),tot++;\n\tfor(int i=b[x]+1;i<=a[x];i++)\n\t\tB[x].push(dep[x]);\n\tfor(int i=0;i<v[x].size();i++){\n\t\tint y=v[x][i].first,z=v[x][i].second;\n\t\tif(y!=last)\n\t\t\tdep[y]=dep[x]+z,dfs(y,x),A[x].join(A[y]),B[x].join(B[y]);\n\t}\n\twhile(!A[x].empty()&&!B[x].empty()&&A[x].top()+B[x].top()-2*dep[x]<0){\n\t\tlong long u=A[x].top(),v=B[x].top();\n\t\tA[x].pop(),B[x].pop(),ans+=u+v-2*dep[x];\n\t\tA[x].push(2*dep[x]-v),B[x].push(2*dep[x]-u);\n\t}\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1,x,y,z;i<n;i++)\n\t\tscanf(\"%d%d%d\",&x,&y,&z),v[x].push_back(make_pair(y,z)),v[y].push_back(make_pair(x,z));\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d%d\",&a[i],&b[i]);\n\tdfs(1,0);\n\tprintf(\"%lld\\n\",ans+1ll*tot*inf);\n\treturn 0;\n}\n```",
        "postTime": 1636359131,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6943\u3010[ICPC2018 WF]Conquer The World\u3011"
    },
    {
        "content": "#### \n\n\u65e0\u8111\u505a\u6cd5\u3002\n\n\u8003\u8651\u7ef4\u62a4\u6bcf\u6761\u8fb9\u7684\u6d41\u91cf\u5bf9\u5e94\u7684\u4ee3\u4ef7\u51f8\u51fd\u6570\uff0c\u8bbe $f_{u,i}$ \u8868\u793a $u$ \u7684\u7236\u4eb2\u8fb9\u6d41\u91cf\u4e3a $i$\uff0c\u5982\u679c\u662f\u4ece $u$ \u6d41\u5411 $fa_u$\uff0c\u90a3\u4e48\u6d41\u91cf\u4e3a\u6b63\uff0c\u5982\u679c\u662f\u4ece $fa_u$ \u6d41\u5411 $u$\uff0c\u6d41\u91cf\u4e3a\u8d1f\u6570\u3002\n\n\u6211\u4eec\u7ef4\u62a4 $f$ \u7684\u5dee\u5206\u6570\u7ec4 $g$\uff0c\u8f6c\u79fb\u5206\u4e3a\u4e09\u90e8\u5206\uff1a\n\n* \u5408\u5e76\u5b50\u6811\u3002\n  * \u662f\u4e00\u4e2a $(\\min,+)$ \u5377\u79ef\uff0c\u76f4\u63a5\u95f5\u53ef\u592b\u65af\u57fa\u548c\u5f52\u5e76\u5dee\u5206\u6570\u7ec4\u5373\u53ef\u3002\n* \u5904\u7406\u5f53\u524d\u70b9\u8d21\u732e\u7684\u6d41\u91cf\u3002\n  * \u8bbe $t_i=a_i-b_i$\uff0c\u5982\u679c $t_i>0$\uff0c\u53ef\u4ee5\u9009\u62e9\u6d41\u7684\u6d41\u91cf $x\\in [0,t_i]$\uff0c\u90a3\u4e48\u64cd\u4f5c\u76f8\u5f53\u4e8e\u5c06 $f_{u,*}$ \u548c $f(x)=0,x\\in[0,t_i]$\uff0c\u505a $(\\min,+)$ \u5377\u79ef\uff0c\u4ecd\u7136\u4f7f\u7528\u95f5\u53ef\u592b\u65af\u57fa\u548c\u5f52\u5e76\u3002\u5982\u679c $t_i<0$\uff0c\u90a3\u4e48\u64cd\u4f5c\u76f8\u5f53\u4e8e\u5c06 $f_{u,*}$ \u5e73\u79fb $t_i$ \u4e2a\u5355\u4f4d\uff0c\u90a3\u4e48\u8bb0\u5f55 $st_u$ \u8868\u793a $u$ \u7684\u5e73\u79fb\u91cf\u5373\u53ef\u3002\n* \u5904\u7406\u7236\u4eb2\u8fb9\u7684\u4ee3\u4ef7\u3002\n  * \u64cd\u4f5c\u76f8\u5f53\u4e8e\u52a0\u4e0a\u4e00\u4e2a\u51fd\u6570 $f(x)=w|x|$\uff0c$w$ \u4e3a\u8fb9\u6743\u3002\u90a3\u4e48\u64cd\u4f5c\u5373\u4e3a\u5bf9\u5dee\u5206\u6570\u7ec4\u4e0b\u6807 $\\leq 0$ \u7684\u90e8\u5206\u52a0\u4e0a $-w$\uff0c\u4e0b\u6807 $>0$ \u7684\u90e8\u5206\u52a0\u4e0a $w$\u3002\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5dee\u5206\u6570\u7ec4\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a\n\n* \u5f52\u5e76\u4e24\u4e2a\u5dee\u5206\u6570\u7ec4\u3002\n* \u533a\u95f4\u52a0\u3002\n\n\u4f7f\u7528\u5e73\u8861\u6811+\u542f\u53d1\u5f0f\u5408\u5e76\u7ef4\u62a4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(V\\log^2 V)$\uff0c$V$ \u4e3a $\\sum a_i$\u3002\n\n\u6ce8\u610f\u7ef4\u62a4\u5dee\u5206\u6570\u7ec4\u7684\u540c\u65f6\uff0c\u8fd8\u9700\u8981\u7ef4\u62a4\u51fd\u6570\u6700\u5de6\u7aef\u7684\u53d6\u503c $val_u$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ull unsigned long long\n#define db double\n#define ldb long double\n#define pb push_back\n#define mp make_pair\n#define pii pair<int, int>\n#define FR first\n#define SE second\n#define int long long\nusing namespace std;\ninline int read() {\n    int x = 0; bool op = 0;\n    char c = getchar();\n    while(!isdigit(c))op |= (c == '-'), c = getchar();\n    while(isdigit(c))x = (x << 1) + (x << 3) + (c ^ 48), c = getchar();\n    return op ? -x : x;\n}\nconst int N = 1e6 + 10;\nint n, tot;\nint a[N], b[N], st[N], val[N], rt[N];\nvector<pii> G[N];\nstruct Node {\n    int ls, rs, tg, val, ky, sz;\n}nd[N];\nmt19937 rnd(time(0));\nint New(int x) {\n    int cur = ++tot;\n    nd[cur].ls = nd[cur].rs = nd[cur].tg = 0;\n    nd[cur].sz = 1; nd[cur].val = x; nd[cur].ky = rnd();\n    return cur;\n}\nvoid mark(int x, int w) {\n    if(x == 0)return ;\n    nd[x].val += w; nd[x].tg += w;\n    return ;\n}\nvoid pushdown(int x) {\n    mark(nd[x].ls, nd[x].tg);\n    mark(nd[x].rs, nd[x].tg);\n    nd[x].tg = 0;\n    return ;\n}\nvoid pushup(int x) {\n    if(x == 0)return ;\n    nd[x].sz = nd[nd[x].ls].sz + nd[nd[x].rs].sz + 1;\n    return ;\n}\nvoid merge(int &k, int x, int y) {\n    if(x == 0 || y == 0)return k = x + y, void();\n    pushdown(x); pushdown(y);\n    if(nd[x].ky < nd[y].ky) {k = x; merge(nd[k].rs, nd[x].rs, y);}\n    else {k = y; merge(nd[k].ls, x, nd[y].ls);}\n    pushup(k);\n    return ;\n}\nvoid split1(int k, int &x, int &y, int w) {\n    if(k == 0)return x = y = 0, void();\n    pushdown(k);\n    if(nd[nd[k].ls].sz + 1 <= w) {x = k; split1(nd[k].rs, nd[x].rs, y, w - nd[nd[k].ls].sz - 1);}\n    else {y = k; split1(nd[k].ls, x, nd[y].ls, w);}\n    pushup(x); pushup(y);\n    return ;\n}\nvoid split2(int k, int &x, int &y, int w) {\n    if(k == 0)return x = y = 0, void();\n    pushdown(k);\n    if(nd[k].val <= w) {x = k; split2(nd[k].rs, nd[x].rs, y, w);}\n    else {y = k; split2(nd[k].ls, x, nd[y].ls, w);}\n    pushup(x); pushup(y);\n    return ;\n}\nvoid update(int u, int w) {\n    int x = 0, y = 0;\n    val[u] += abs(st[u]) * w;\n    split1(rt[u], x, y, -st[u]);\n    mark(x, -w); mark(y, w);\n    merge(rt[u], x, y);\n    return ;\n}\nvoid ins(int &k, int u) {\n    if(u == 0)return ;\n    pushdown(u);\n    ins(k, nd[u].ls); ins(k, nd[u].rs);\n    int x = 0, y = 0;\n    nd[u].ls = nd[u].rs = nd[u].tg = 0;\n    nd[u].sz = 1;\n    split2(k, x, y, nd[u].val);\n    merge(x, x, u); merge(k, x, y);\n    return ;\n}\nvoid print(int u) {\n    if(u == 0)return ;\n    print(nd[u].ls);\n    printf(\"%d \", nd[u].val);\n    print(nd[u].rs);\n    return ;\n}\nvoid dfs(int u, int fa) {\n    for(auto e : G[u]) {\n        int v = e.FR, w = e.SE;\n        if(v == fa)continue;\n        dfs(v, u); update(v, w); \n        if(nd[rt[u]].sz < nd[rt[v]].sz)swap(rt[u], rt[v]);\n        ins(rt[u], rt[v]); st[u] += st[v]; val[u] += val[v];\n    }\n    if(a[u] > b[u]) {\n        for(int i = 1; i <= a[u] - b[u]; i++) {\n            int x = 0, y = 0;\n            split2(rt[u], x, y, 0); \n            merge(x, x, New(0)); merge(rt[u], x, y);\n        }\n    }\n    else st[u] += a[u] - b[u];\n    // printf(\"rt:%d %d %d\\n\", u, rt[u], st[u]);\n    return ;\n}\nint ans;\nvoid calc_ans(int u) {\n    if(u == 0)return ;\n    pushdown(u);\n    calc_ans(nd[u].ls);\n    // printf(\"%d \", nd[u].val);\n    if(st[1] < 0)ans += nd[u].val, st[1]++;\n    calc_ans(nd[u].rs);\n    return ;\n}\nsigned main() { \n    n = read();\n    for(int i = 1; i < n; i++) {\n        int u = read(), v = read(), w = read();\n        G[u].pb(mp(v, w)); G[v].pb(mp(u, w));\n    }\n    for(int i = 1; i <= n; i++)a[i] = read(), b[i] = read();\n    dfs(1, 0); calc_ans(rt[1]); \n    printf(\"%lld\\n\", ans + val[1]);\n    return 0;\n}\n```\n",
        "postTime": 1675672706,
        "uid": 682934,
        "name": "yllcm",
        "ccfLevel": 0,
        "title": "Solution-P6943"
    },
    {
        "content": "\u5efa\u8bae\u5bf9\u6a21\u62df\u8d39\u7528\u6d41\uff08\u5e26\u6094\u8d2a\u5fc3\uff09\u6709\u4e00\u5b9a\u4e86\u89e3\u540e\u518d\u8003\u8651\u6b64\u9898\u3002\n\n\u5982\u679c\u4f60\u8fd8\u6ca1\u5b66\u8fc7\u7684\u8bdd\uff0c[\u8bd5\u8bd5\u8fd9\u4e2a\u3002](https://www.cnblogs.com/wyher/p/11134980.html)\n\n\u9996\u5148\u4e0d\u770b\u6570\u636e\u8303\u56f4\uff0c\u6709\u4e00\u4e2a\u5f88\u76f4\u89c2\u7684\u60f3\u6cd5\uff0c\u5c31\u662f\u5efa\u8d85\u7ea7\u6e90\u6c47\u70b9\u5206\u522b\u5411\u6709\u70b9\u6743\u3001\u9700\u8981\u70b9\u6743\u7684\u5730\u65b9\u8fde\u8fb9\uff0c\u8dd1\u8d39\u7528\u6d41\u3002\n\n\u7136\u800c\u6ca1\u6709\u4ec0\u4e48\u8d39\u7528\u6d41\u7b97\u6cd5\u80fd\u8dd1\u5b8c $2.5\\times 10^5$ \u7684\u6570\u636e\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u60f3\u5230\u8fd9\u662f\u4e00\u9053\u6a21\u62df\u8d39\u7528\u6d41\u7684\u9898\u3002\n\n\u5b9a\u4e49 $dep_u$ \u4e3a\u6839\u8282\u70b9\u5230 $u$ \u7684\u8def\u5f84\u4e0a\u7684\u8fb9\u6743\u548c\uff0c\u6211\u4eec\u6bcf\u6b21\u8003\u8651**\u4e00\u4e2a**\u70b9\u6743\u3002\n\n\u5219\u5c06 $u$ \u7684\u70b9\u6743\u8f6c\u79fb\u5230 $v$ \u9700\u8981\u82b1\u8d39\u4e3a $dep_u+dep_v-2dep_{lca}$\n\n\u4ece\u4e0b\u5411\u4e0a\u8003\u8651\u6bcf\u4e2a\u70b9\u4f5c\u4e3a $lca$ \u7684\u60c5\u51b5\uff0c\u628a\u6709\u70b9\u6743\u548c\u9700\u8981\u70b9\u6743\u7684\u70b9\u7684 $dep$ \u503c\u52a0\u5230\u5806\u91cc\uff0c\u5206\u522b\u627e\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n\u7136\u540e\u5f53\u9047\u5230\u66f4\u4f18\u7684\u70b9\u65f6\uff0c\u6211\u4eec\u8003\u8651\u53cd\u6094\uff1a\u9009\u4e2d $u$ \u540e\uff0c\u5c06 $u$ \u7684\u70b9\u6743\u6539\u4e3a $-dep_v+2dep_{lca}$\uff0c\u8fd9\u6837\u518d\u6b21\u9009\u4e2d $u$ \u65f6\u5c31\u53d6\u6d88\u4e86 $u$ \u4e0e $v$ \u7684\u5339\u914d\u3002\n\n\u4e0d\u8fc7\u6211\u4eec\u8fd8\u8981\u4fdd\u8bc1\u6bcf\u4e2a\u70b9\u7684\u8981\u6c42\u90fd\u88ab\u6ee1\u8db3\uff0c\u6240\u4ee5\u6211\u4eec\u7ed9\u6bcf\u4e2a\u70b9\u6743\u9700\u6c42\u642d\u914d\u4e00\u4e2a $-\\inf$ \u7684\u8d21\u732e\uff0c\u8fd9\u6837\u6700\u5c0f\u5316\u8d21\u732e\u662f\u6211\u4eec\u5fc5\u7136\u6ee1\u8db3\u6240\u6709\u9700\u6c42\u3002\n\n\u7531\u4e8e\u6211\u4eec\u9700\u8981\u8ba9\u7236\u4eb2\u7ee7\u627f\u513f\u5b50\u7684\u5806\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a[\u53ef\u5e76\u5806](https://www.luogu.com.cn/problem/P3377)\u3002\n\n\u5982\u679c\u4f60\u4e0d\u60f3\u624b\u5199\u7684\u8bdd\u53ef\u4ee5\u7528 pb_ds \u4ee3\u66ff\u3002\n\n\u5982\u679c\u4f60\u7684\u53ef\u5e76\u5806\u51fa\u4e86\u4ec0\u4e48\u95ee\u9898\uff0c\u4ee3\u7801\u91cc\u6709\u4e00\u4e2a\u5199\u7684\u7a00\u70c2\u7684\u6307\u9488\u7248\u7684\u5de6\u504f\u6811\u7559\u4f5c\u53c2\u8003\u3002\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3e5,M=5e5+10;\nconst long long inf=1e12;\nint head[N],to[M],nxt[M],w[M],x[N],y[N],cnt,n,sum;\nlong long ans,dep[N];\nvoid add_edge(int u,int v,int c){\n\tnxt[++cnt]=head[u],head[u]=cnt,to[cnt]=v,w[cnt]=c;\n\tnxt[++cnt]=head[v],head[v]=cnt,to[cnt]=u,w[cnt]=c;\t\n}\n\ntemplate<typename T>\nstruct pri_que{\n\tstruct node{\n\t\tnode *ls,*rs;\n\t\tint dis;\n\t\tT val;\n\t\tnode(long long v=1e18,node *f=NULL){ls=rs=f;dis=0,val=v;}\n\t\tbool operator ==(node b){return val==b.val;}\n\t}*root,nul;\n\tpri_que(){root=&nul;}\n\tvoid push(T v){insert(v,root);}\n\tvoid join(pri_que p){\n\t\troot=join(root,p.root);\n\t\tp.root=&nul;\n\t}\n\tT top(){return root->val;}\n\tbool empty(){return *root==nul;}\n\tvoid pop(){\n\t\tnode *r=root;\n\t\troot=join(root->ls,root->rs);\n\t\tdelete(r);\n\t}\n\t\n\tvoid insert(T v,node* &rt){\n\t\tif(*rt==nul){\n\t\t\trt=new node(v,&nul);\n\t\t\treturn;\n\t\t}\n\t\tinsert(v,rt->rs);\n\t\tif(rt->rs->val<rt->val)swap(rt->rs->val,rt->val);\n\t\tif(rt->rs->dis>rt->ls->dis)swap(rt->ls,rt->rs);\t\t\n\t\trt->dis=rt->rs->dis+1;\n\t}\n\tnode *join(node *x,node *y){\n\t\tif(*x==nul||*y==nul)return *x==nul?y:x;\n\t\tif(y->val<x->val)swap(x,y);\n\t\tx->rs=join(x->rs,y);\n\t\tif(x->rs->dis>x->ls->dis)swap(x->ls,x->rs);\n\t\tx->dis=x->rs->dis+1;\n\t\treturn x;\n\t}\n};\npri_que<long long>q1[N],q2[N];\n//\u4ee5\u4e0a\u4e3a\u5de6\u504f\u6811\n\nvoid dfs(int rt,int fa){\n\twhile(x[rt]--)q1[rt].push(dep[rt]);\n\twhile(y[rt]--)q2[rt].push(dep[rt]-inf);\n    //\u9010\u4e2a\u8003\u8651\uff0c\u540c\u65f6\u7ed9\u6bcf\u4e2a\u9700\u6c42\u51cf\u53bb inf \u7684\u8d21\u732e\u3002\n\tfor(int i=head[rt];i;i=nxt[i])\n\t  if(to[i]!=fa){\n\t  \tdep[to[i]]=dep[rt]+w[i];\n\t  \tdfs(to[i],rt);\n\t  \tq1[rt].join(q1[to[i]]);\n\t  \tq2[rt].join(q2[to[i]]);\n\t  }\n\t//\u5f53q2[rt].top()+q1[rt].top()-2*dep[rt]<0\u65f6\u5e94\u5f53\u53cd\u6094\u3002\n\twhile(!q2[rt].empty()&&!q1[rt].empty()&&q2[rt].top()+q1[rt].top()-2*dep[rt]<0){\n\t\tlong long x=q1[rt].top(),y=q2[rt].top(),res=x+y-2*dep[rt];\n\t\tans+=res;\n\t\tq1[rt].pop(),q2[rt].pop();\n\t\tq1[rt].push(x-res);\n\t\tq2[rt].push(y-res);\n\t}\n} \n\nint main(){\n//\tfreopen(\"conquer.in\",\"r\",stdin);\n//\tfreopen(\"conquer.out\",\"w\",stdout);\t\n\tint u,v,c;\n\tcin>>n;\n\tfor(int i=1;i<n;++i)\n\t\tcin>>u>>v>>c,add_edge(u,v,c);\n\tfor(int i=1;i<=n;++i)\n\t\tcin>>x[i]>>y[i];\n\tfor(int i=1;i<=n;++i){\n\t\tint d=min(x[i],y[i]);\n\t\tx[i]-=d,y[i]-=d;\n\t\tsum+=y[i];\n\t}\n\tdfs(1,0);\n\tcout<<ans+sum*inf<<endl;\n    //\u522b\u5fd8\u4e86\u628a\u51cf\u7684 inf \u52a0\u56de\u6765\n}\n```",
        "postTime": 1625384629,
        "uid": 231710,
        "name": "zhouyixian",
        "ccfLevel": 8,
        "title": "P6943Conquer The World \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9898\u7684\u590d\u6742\u5ea6\u53ef\u4ee5\u4e0d\u4f9d\u8d56\u4e8e $\\sum v$\uff0c\u590d\u6742\u5ea6\u4e3a $O(n\\log^2n)$ \u6216 $O(n\\log n)$\u3002\n\n\u4ecd\u7136\u8003\u8651\u6a21\u62df\u8d39\u7528\u6d41\u3002\u4ee4 $a_i=x_i-y_i$\uff0c\u76f8\u5f53\u4e8e\u8981\u62ff\u6b63\u7684\u53bb\u62b5\u6d88\u8d1f\u7684\u3002\u56e0\u4e3a\u8d1f\u7684\u5f3a\u5236\u6ee1\u6d41\uff0c\u6240\u4ee5\u968f\u4fbf\u9009\u4e00\u4e2a\u987a\u5e8f\u7ed9\u6bcf\u4e2a\u8d1f\u7684 $a_i$ \u6ee1\u6d41\u53ef\u4ee5\u5f97\u5230\u6700\u4f18\u89e3\u3002\u4e0d\u96be\u53d1\u73b0\u6309\u7167 dfs \u5e8f\u8f6c\u79fb\u6bd4\u8f83\u65b9\u4fbf\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u8fb9\u6743\uff08\u5269\u4f59\u6d41\u91cf\uff09\u4ee5\u53ca\u5f53\u524d dfs \u5230\u7684\u70b9\u5230\u6bcf\u4e2a\u70b9\u7684\u8ddd\u79bb\u3002\u4ece\u4e00\u4e2a\u70b9\u8d70\u5230\u4e00\u4e2a\u76f8\u90bb\u70b9\uff0c\u5bf9\u8ddd\u79bb\u7684\u5f71\u54cd\u53ef\u4ee5\u8f6c\u5316\u4e3a\u533a\u95f4\u52a0\u3002\u4fee\u6539\u4e00\u6761\u8fb9\u7684\u8d39\u7528\uff0c\u4e5f\u662f\u533a\u95f4\u52a0\u3002\u7ef4\u62a4\u4e00\u6761\u8fb9\u7684\u8d39\u7528\uff0c\u53ea\u9700\u8981\u5224\u65ad\u53cd\u5411\u8fb9\u5269\u4f59\u6d41\u91cf\u662f\u5426\u4e3a 0\u3002\n\n\u6839\u636e\u52bf\u80fd\u5206\u6790\uff0c\u663e\u7136\u6bcf\u6761\u8fb9\u7684\u53cd\u5411\u8fb9\uff08\u4ece 0 \u53d8\u6210 \u975e 0\uff09\u4ee5\u53ca\uff08\u4ece \u975e 0 \u53d8\u6210 0\uff09\u8fd9\u4e24\u4ef6\u4e8b\u60c5\u53ea\u4f1a\u53d1\u751f\u5e38\u6570\u6b21\u3002\u56e0\u4e3a\u6bcf\u6761\u8fb9\u5728 dfs \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5206\u4e3a\u4e09\u90e8\u5206\uff0c\u7b2c\u4e00\u90e8\u5206\u548c\u7b2c\u4e09\u90e8\u5206\u53ea\u4f1a\u4ece\u5916\u9762\u8d70\u5230\u91cc\u9762\uff0c\u7b2c\u4e8c\u90e8\u5206\u53ea\u4f1a\u4ece\u91cc\u9762\u8d70\u5230\u5916\u9762\u3002\u76f8\u5f53\u4e8e\u5148\u52a0\u4e00\u6bb5\u518d\u51cf\u4e00\u6bb5\u518d\u52a0\u4e00\u6bb5\u3002\u8fd9\u6837\u6839\u636e\u6bcf\u6761\u8fb9\uff08\u662f\u5426\u4e3a 0\uff09\u53ef\u4ee5\u66b4\u529b\u7ef4\u62a4\u51fa\u8fb9\u7684\u8d39\u7528\u4ece\u800c\u7ef4\u62a4\u51fa\u8ddd\u79bb\u3002\n\n\u4ee5\u4e0a\u8fc7\u7a0b\u90fd\u53ef\u4ee5\u7528\u6811\u5256\u5b9e\u73b0\uff0c\u6bd4\u8f83\u590d\u6742\u3002~~\u6362\u6210 LCT \u5c31 1log \u4e86\u3002~~\n\n[\u4ee3\u7801](https://loj.ac/s/1484558)",
        "postTime": 1655361728,
        "uid": 116116,
        "name": "LZDQ",
        "ccfLevel": 0,
        "title": "P6943 [ICPC2018 WF]Conquer The World"
    }
]