[
    {
        "content": "$\\Large{\\text{\u53ef\u4ee5\u5f97\u5230\u6bd4 std \u66f4\u4f18\u7684\u7b54\u6848\uff01\u503c\u5f97\u4e00\u770b\uff01}}$\n\n\u65e2\u7136\u80fd\u5f97\u5230\u6bd4 std \u66f4\u4f18\u7684\u7b54\u6848\uff08\u8fde\u6837\u4f8b\u90fd\u6709\u66f4\u4f18\u7684\u89e3\uff09\uff0c\u8981\u4e0d\u8981\u52a0\u5f3a\u6570\u636e\uff1f\uff08\u96fe\uff09\n\n\u7a7a\u8bf4\u65e0\u51ed\uff0c\u7ed9\u51fa\u4e00\u7ec4\u66f4\u4f18\u7684\u6837\u4f8b\u8f93\u51fa\uff08\u5176\u5b9e\u4eba\u529b\u6c42\u89e3\u4e5f\u53ef\u4ee5\u5f97\u5230\u8fd9\u4e2a\u66f4\u4f18\u89e3\uff09\u3002\n\n```plain\n2\n6\n7\n9\n0\n11\n0\n0\n13\n0\n0\n0\n14\n0\n```\n\n\u5176\u5b9e\u53ea\u662f\u628a $4$ \u7684\u91cd\u513f\u5b50\u4ece $8$ \u6539\u6210\u4e86 $9$ \u800c\u5df2\uff0c\u539f\u7b54\u6848\u662f $18$\uff0c\u65b0\u7b54\u6848\u662f $17$\u3002\n\n\uff08\u53ef\u80fd\u662f\u4e3a\u4e86\u964d\u4f4e\u96be\u5ea6\u624d\u628a std \u7684\u89e3\u6539\u52a3\uff1f\u5982\u679c\u662f\u8fd9\u6837\uff0c\u90a3\u5c31\u4e0d\u8981\u52a0\u5f3a\u4e86\u5427~\uff09\n\n\uff08\u5439\u6c34\u5b8c\u6bd5\uff0c\u9898\u89e3\u6b63\u6587\u5f00\u59cb\uff09\n\n### \u6811\u94fe\u5256\u5206\uff08\u975e\u6a21\u677f\uff09\n\n\u8fd9\u9053\u9898\u5e94\u8be5\u8fd8\u662f\u6709\u4e0d\u5c11\u90e8\u5206\u5206\u7684\u65b9\u6cd5\u7684\uff0c\u6bd4\u5982\u968f\u4fbf\u9009\u4e00\u4e2a\u513f\u5b50\u8f93\u51fa\uff08\u96fe\uff09\uff0c\u6216\u4e0d\u7ba1\u4e09\u4e03\u4e8c\u5341\u4e00\u76f4\u63a5\u91cd\u94fe\u5256\u5206\uff0c\u90fd\u53ef\u4ee5\u62ff\u5230\u4e00\u5b9a\u7684\u5206\u6570\u3002\n\n\u4e0b\u9762\u4ecb\u7ecd\u4e00\u79cd\u601d\u8def\u6bd4\u8f83\u81ea\u7136\u3001\u5b9e\u73b0\u4e0d\u56f0\u96be\u3001\u53ef\u4ee5\u5f97\u5230\u6bd4 std \u66f4\u4f18\u7684\u7b54\u6848\u7684\u6811\u5f62 dp \u65b9\u6cd5\u3002\u4e2a\u4eba\u8ba4\u4e3a\u5e94\u8be5\u5df2\u7ecf\u8fbe\u5230\u4e86\u7406\u8bba\u6700\u4f18\u89e3\uff0c\u6b22\u8fce hack\u3002\n\n#### \u6761\u4ef6\u8f6c\u5316\n\n\u9898\u76ee\u4e2d\u7684\u201c\u6240\u6709\u67e5\u8be2\u7ecf\u8fc7\u7684\u8f7b\u91cd\u94fe\u7684\u603b\u6570\u201d\u4e0d\u662f\u7279\u522b\u5bb9\u6613\u7edf\u8ba1\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u628a\u5b83\u8fdb\u884c\u8f6c\u5316\u3002\n\n\u521d\u59cb\u7684\u4e00\u6b65\u662f\u628a $x\\rightarrow y$ \u7684\u8def\u5f84\u62c6\u6210 $x\\rightarrow \\mathrm{LCA}(x,y),\\ y\\rightarrow \\mathrm{LCA}(x,y)$ \u4e24\u6761\u6811\u94fe\uff0c\u8fd9\u4e00\u6b65\u5e94\u8be5\u5f88\u5bb9\u6613\u60f3\u5230\u3002\u8fd9\u4e00\u6b21\u67e5\u8be2\u7ecf\u8fc7\u7684\u94fe\u7684\u603b\u6570\u5c31\u7b49\u4e8e\u8fd9\u4e24\u6761\u6811\u94fe\u5305\u542b\u7684\u94fe\u7684\u6570\u91cf\u4e4b\u548c\u3002\uff08\u6ce8\uff1a\u6b64\u5904\u201c\u6811\u94fe\u201d\u6307\u7684\u662f\u6811\u4e0a\u4e00\u70b9\u5230\u5b83\u7684\u67d0\u4e2a\u7956\u5148\u7684\u8def\u5f84\u3002\uff09\n\n\u90a3\u4e48\u5982\u4f55\u63cf\u8ff0\u4e00\u6761\u6811\u94fe\u7ecf\u8fc7\u7684\u94fe\u7684\u6570\u91cf\u5462\uff1f  \n\u5047\u8bbe\u6211\u4eec\u662f\u66b4\u529b\u7edf\u8ba1\u8fd9\u4e2a\u91cf\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u601d\u8def\u53ef\u4ee5\u662f\u8fd9\u6837\u7684\uff1a\u4ece $x$ \u4e00\u76f4\u8df3\u5230 $\\mathrm{LCA}(x,y)$\uff0c\u8003\u8651\u6bcf\u4e00\u6761\u8fb9\uff0c\u5982\u679c\u8fd9\u4e00\u6761\u8fb9\u548c\u4e0a\u4e00\u6761\u8fb9\u90fd\u662f\u91cd\u8fb9\uff0c\u90a3\u4e48\u8fd9\u4e24\u6761\u8fb9\u5728\u540c\u4e00\u6761\u91cd\u94fe\u4e0a\uff0c\u4e0d\u9700\u8981\u91cd\u590d\u7edf\u8ba1\uff0c\u7b54\u6848\u4e0d\u53d8\uff1b\u5426\u5219\u7b54\u6848\u52a0 $1$\u3002  \n\u603b\u7ed3\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u201c\u4e00\u6761\u6811\u94fe\u7ecf\u8fc7\u7684\u94fe\u7684\u6570\u91cf\u201d\u53ef\u4ee5\u63cf\u8ff0\u4e3a\u201c\u6811\u94fe\u7684\u957f\u5ea6\u51cf\u53bb\u6811\u94fe\u4e2d\u76f8\u90bb\u91cd\u8fb9\u5bf9\u7684\u6570\u91cf\u201d\uff0c\u4e5f\u5c31\u662f\u5047\u8bbe\u8fd9\u6761\u6811\u94fe\u7684\u8fb9\u4f9d\u6b21\u662f $e_1,e_2,\\cdots,e_k$\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u5e94\u8be5\u662f $k-\\sum_{i=1}^{k-1}[e_i,e_{i+1}\\text{\u90fd\u662f\u91cd\u8fb9}]$\u3002\uff08\u6ce8\uff1a$[\\text{\u6761\u4ef6}]$ \u8868\u793a\u6761\u4ef6\u6210\u7acb\u65f6\u8fd9\u4e2a\u6570\u662f $1$\uff0c\u5426\u5219\u662f $0$\u3002\uff09\n\n\u7531\u4e8e\u6811\u94fe\u4e2d\u8fb9\u7684\u6570\u91cf\u662f\u5b9a\u503c\uff0c\u6240\u4ee5\u60f3\u8981\u8ba9\u201c\u6240\u6709\u67e5\u8be2\u7ecf\u8fc7\u7684\u8f7b\u91cd\u94fe\u7684\u603b\u6570\u201d\u6700\u5c0f\uff0c\u5c31\u5e94\u8be5\u8ba9\u201c\u6240\u6709\u67e5\u8be2\u7684\u6811\u94fe\u6240\u7ecf\u8fc7\u7684\u76f8\u90bb\u91cd\u8fb9\u5bf9\u201d\u6700\u591a\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u6709\u4e86\u6bd4\u8f83\u65b9\u4fbf\u7684\u7edf\u8ba1\u91cf\u3002\u65b9\u4fbf\u5728\u54ea\u91cc\u5462\uff1f\u539f\u6765\u7684\u201c\u7ecf\u8fc7\u8f7b\u91cd\u94fe\u201d\u6240\u6d89\u53ca\u7684\u72b6\u6001\u6bd4\u8f83\u590d\u6742\uff0c\u76f8\u6bd4\u4e4b\u4e0b\u201c\u76f8\u90bb\u91cd\u8fb9\u5bf9\u201d\u5c31\u7b80\u5355\u591a\u4e86\u2014\u2014\u8fd9\u4e2a\u72b6\u6001\u53ea\u4e0e\u201c\u8fd9\u4e00\u6761\u8fb9\u201d\u548c\u201c\u4e0a\u4e00\u6761\u8fb9\u201d\u6709\u5173\u3002\n\n#### \u72b6\u6001\u548c\u72b6\u6001\u8f6c\u79fb\u7684\u8bbe\u8ba1\n\n\u8fd9\u9053\u9898\u662f\u8981\u51b3\u7b56\u201c\u9009\u54ea\u4e2a\u91cd\u513f\u5b50\u201d\uff0c\u53c8\u6709\u4e86\u6bd4\u8f83\u5bb9\u6613\u8868\u793a\u7684\u7edf\u8ba1\u91cf\uff0c\u6211\u4eec\u89c9\u5f97\u53ef\u4ee5\u8bd5\u8bd5\u6811\u5f62 dp\u3002\n\n\u6309\u7167\u6811\u5f62 dp \u7684\u5957\u8def\uff0c\u6211\u4eec\u53ea\u8003\u8651\u67d0\u4e00\u68f5\u5b50\u6811\u3002\n\n\u4e3a\u65b9\u4fbf\u53d9\u8ff0\uff0c\u5148\u5b9a\u4e49\u4e24\u4e2a\u6982\u5ff5\u3002\u76f8\u90bb\u91cd\u8fb9\u5bf9\u9700\u8981\u6709\u4e00\u4e2a\u201c\u7edf\u8ba1\u4f4d\u7f6e\u201d\u3002\u8fd9\u91cc\u6211\u4eec\u628a\u6811\u94fe\u4e0a\u76f8\u90bb\u4e24\u6761\u8fb9\u4e0a\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u79f0\u4e3a\u8fd9\u4e2a\u76f8\u90bb\u8fb9\u5bf9\u7684\u201c\u57fa\u70b9\u201d\uff0c\u5e76\u628a\u57fa\u70b9\u4f5c\u4e3a\u76f8\u90bb\u91cd\u8fb9\u5bf9\u7684\u7edf\u8ba1\u4f4d\u7f6e\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u76f8\u90bb\u8fb9\u5bf9\u5c31\u662f\u57fa\u70b9\u5f80\u4e0a\u8df3\u4e24\u5c42\u3002\u53ef\u4ee5\u8bbe $w[y]$ \u8868\u793a\u6240\u6709\u67e5\u8be2\u8def\u5f84\u4e2d\uff0c\u4ee5 $y$ \u4e3a\u57fa\u70b9\u7684\u76f8\u90bb\u8fb9\u5bf9\u7684\u51fa\u73b0\u6b21\u6570\u3002\u9009\u62e9\u57fa\u70b9\u8fdb\u884c\u7edf\u8ba1\u7684\u7406\u7531\u662f\uff0c\u6bcf\u4e2a\u57fa\u70b9\u552f\u4e00\u5bf9\u5e94\u4e00\u6761\u76f8\u90bb\u8fb9\u5bf9\u3002\u53e6\u5916\uff0c\u6211\u4eec\u79f0\u57fa\u70b9\u7684\u7236\u4eb2\u4e3a\u201c\u4e2d\u70b9\u201d\uff0c\u4e2d\u70b9\u662f\u76f8\u90bb\u8fb9\u5bf9\u7684\u4e24\u6761\u8fb9\u7684\u516c\u5171\u70b9\u3002\n\n\u6211\u4eec\u8bbe $f'[x]$\uff0c\u8868\u793a\u5728\u6240\u6709\u5212\u5206 $x$ \u5b50\u6811\u7684\u8f7b\u91cd\u513f\u5b50\u7684\u65b9\u6848\u4e2d\uff0c\u4e2d\u70b9\u5728 $x$ \u5b50\u6811\u4e2d\uff08\u4e2d\u70b9\u5728 $x$ \u5b50\u6811\u4e2d\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u57fa\u70b9\u4e00\u5b9a\u662f $x$ \u7684\u5b50\u5b59\uff09\u7684\u6709\u6548\u76f8\u90bb\u91cd\u8fb9\u5bf9\u7684\u6700\u5927\u6570\u91cf\u3002\u8fd9\u91cc\u7684\u6709\u6548\u6307\u7684\u662f\u51fa\u73b0\u5728\u67e5\u8be2\u8def\u5f84\u4e2d\uff0c\u800c\u4e14\u201c\u6570\u91cf\u201d\u6307\u7684\u662f\u51fa\u73b0\u5728\u67e5\u8be2\u8def\u5f84\u4e2d\u7684\u603b\u6b21\u6570\u3002$f'[1]$ \u8fbe\u5230\u6700\u4f18\u65f6\uff0c\u6211\u4eec\u4e5f\u5c31\u5f97\u5230\u4e86\u8fd9\u9053\u9898\u7684\u6700\u4f18\u89e3\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u8fd9\u4e2a\u72b6\u6001\u5982\u4f55\u8f6c\u79fb\u5462\uff1f\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u7b97\u51fa\u4e86 $x$ \u7684\u6240\u6709\u5b50\u8282\u70b9\u7684 $f'$\uff0c\u90a3\u4e48 $f'[x]$ \u6bd4\u513f\u5b50\u591a\u51fa\u7684\u90a3\u4e00\u90e8\u5206\uff0c\u5c31\u662f\u4ee5 $x$ \u4e3a\u4e2d\u70b9\uff08\u4e5f\u5c31\u662f\u4ee5 $x$ \u7684\u513f\u5b50\u4e3a\u57fa\u70b9\uff09\u7684\u76f8\u90bb\u91cd\u8fb9\u5bf9\uff0c\u800c\u8fd9\u5c31\u6d89\u53ca\u5230\u201c$x$ \u662f\u4e0d\u662f\u91cd\u513f\u5b50\u201d\u7684\u95ee\u9898\uff1b\u4f46\u5728\u6211\u4eec\u7684\u72b6\u6001\u4e2d\uff0c\u6ca1\u6709\u529e\u6cd5\u5904\u7406\u201c$x$ \u662f\u4e0d\u662f\u91cd\u513f\u5b50\u201d\uff01\n\n\u600e\u4e48\u529e\u5462\uff1f\u52a0\u4e0a\u53bb\u4e0d\u5c31\u597d\u4e86\uff1f\u8bbe $f[x][0/1]$ \u8868\u793a\u5728 $x$ \u4e0d\u662f\uff08$0$\uff09/ \u662f\uff08$1$\uff09 \u91cd\u513f\u5b50\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6240\u6709\u5212\u5206 $x$ \u5b50\u6811\u7684\u8f7b\u91cd\u513f\u5b50\u7684\u65b9\u6848\u4e2d\uff0c\u4e2d\u70b9\u5728 $x$ \u5b50\u6811\u4e2d\u7684\u6709\u6548\u76f8\u90bb\u91cd\u8fb9\u5bf9\u7684\u6700\u5927\u6570\u91cf\u3002\u5f53 $f[1][0]$ \u53d6\u5230\u6700\u4f18\u89e3\u7684\u65f6\u5019\uff0c\u5c31\u5f97\u5230\u672c\u9898\u7684\u7b54\u6848\u3002\n\n\u73b0\u5728\u4f3c\u4e4e\u5c31\u6bd4\u8f83\u5bb9\u6613\u8f6c\u79fb\u4e86\u3002\n\n\u5982\u679c $x$ \u4e0d\u662f\u91cd\u513f\u5b50\uff0c\u90a3\u4e48\u4e0d\u80fd\u4ea7\u751f\u4ee5 $x$ \u4e3a\u4e2d\u70b9\u7684\u76f8\u90bb\u91cd\u8fb9\u5bf9\uff0c\u6b64\u65f6\u53ea\u9700\u8981\u5728 $x$ \u7684\u513f\u5b50\u4e2d\u9009\u51fa\u91cd\u513f\u5b50\u3002$f[x][0]=\\max\\limits_{y\\in \\mathrm{children}[x]}(f[y][1]+\\sum\\limits_{u\\in \\mathrm{children}[x],u\\neq y}f[u][0])$\u3002\u5f0f\u4e2d\u7684 $y$ \u662f\u679a\u4e3e\u7684\u91cd\u513f\u5b50\u3002\n\n\u5982\u679c $x$ \u662f\u91cd\u513f\u5b50\uff0c\u90a3\u4e48\u4f1a\u4ea7\u751f\u4ee5 $x$ \u4e3a\u4e2d\u70b9\u7684\u76f8\u90bb\u91cd\u8fb9\u5bf9\u3002\u5047\u5982 $y$ \u662f $x$ \u7684\u91cd\u513f\u5b50\uff0c\u90a3\u4e48\u76f8\u90bb\u8fb9\u5bf9 $y\\rightarrow x\\rightarrow \\mathrm{par}(x)$ \u5c31\u6210\u4e3a\u4e86\u76f8\u90bb\u91cd\u8fb9\u5bf9\u3002\u56de\u5fc6\u4e00\u4e0b\uff0c\u6211\u4eec\u8bbe $w[y]$ \u8868\u793a\u6240\u6709\u67e5\u8be2\u8def\u5f84\u4e2d\uff0c\u4ee5 $y$ \u4e3a\u57fa\u70b9\u7684\u76f8\u90bb\u8fb9\u5bf9\u7684\u51fa\u73b0\u6b21\u6570\uff1b\u90a3\u4e48\u65b0\u4ea7\u751f\u7684\u76f8\u90bb\u91cd\u8fb9\u5bf9\u7684\u4e2a\u6570\u5c31\u662f $w[y]$\u3002$f[x][1]=\\max\\limits_{y\\in \\mathrm{children}[x]}(f[y][1]+w[y]+\\sum\\limits_{u\\in \\mathrm{children}[x],u\\neq y}f[u][0])$\u3002\n\n\u8fd9\u4e2a\u6811\u5f62 dp \u7684\u4e3b\u6846\u67b6\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002\u6211\u4eec\u53ea\u9700\u8981\u5728\u8ba1\u7b97 $f$ \u7684\u8fc7\u7a0b\u4e2d\uff0c\u8bb0\u5f55\u597d\u201c\u51b3\u7b56\u70b9\u201d\uff0c\u4e5f\u5c31\u662f\u4f7f $f[x][0],f[x][1]$ \u53d6\u6700\u5927\u503c\u7684 $y$ \u5206\u522b\u662f\u591a\u5c11\uff0c\u6700\u540e\u8f93\u51fa\u7b54\u6848\u65f6\u6839\u636e $x$ \u6700\u540e\u662f\u4e0d\u662f\u91cd\u513f\u5b50\u8f93\u51fa\u76f8\u5e94\u7684\u51b3\u7b56\u70b9\u5373\u53ef\u3002\n\n\u73b0\u5728\u7684\u95ee\u9898\u662f\uff0c\u5982\u4f55\u8ba1\u7b97 $w[y]$ \u5462\uff1f\n\n#### \u9884\u5904\u7406\u5de5\u4f5c\n\n\u67e5\u8be2\u4e00\u6761\u8def\u5f84 $x\\rightarrow y$ \u7684\u65f6\u5019\uff0c\u5047\u8bbe\u8fd9\u6761\u8def\u5f84\u662f $x\\rightarrow u\\rightarrow \\mathrm{LCA}(x,y) \\rightarrow v \\rightarrow y$\uff0c\u5176\u4e2d $u,v$ \u90fd\u662f $\\mathrm{LCA}$ \u7684\u76f4\u63a5\u513f\u5b50\uff0c\u90a3\u4e48\u4ece $x$ \u5230 $u$\u3001\u4ece $y$ \u5230 $v$ \u7684\u70b9\uff08\u4e0d\u542b $u,v$\uff09\u7684 $w$ \u90fd\u8981\u52a0 $1$\uff08\u56de\u5fc6\u4e00\u4e0b\uff0c\u57fa\u70b9\u201c\u5f80\u4e0a\u8df3\u4e24\u6b21\u201d\u7684\u6b21\u6570\u662f $w$\uff09\u3002\n\n\u600e\u4e48\u5b9e\u73b0\u8fd9\u4e2a\u52a0 $1$ \u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u7528 ~~\u6811\u94fe\u5256\u5206+\u7ebf\u6bb5\u6811~~ ~~\u6811\u94fe\u5256\u5206+\u6811\u72b6\u6570\u7ec4~~ \u6811\u4e0a\u5dee\u5206\uff08\u56e0\u4e3a\u662f\u5168\u90e8\u52a0\u5b8c\u518d\u67e5\u8be2\uff0c\u76f8\u5f53\u4e8e\u79bb\u7ebf\u64cd\u4f5c\uff0c\u56e0\u6b64\u5dee\u5206\u5c31\u591f\u4e86\uff09\u3002\u8bbe $\\mathrm{delt}[x]$ \u8868\u793a $x$ \u5bf9 $x$ \u548c $x$ \u7684\u7956\u5148\u7684 $w$ \u7684\u8d21\u732e\uff1b\u4e5f\u5c31\u662f $\\mathrm{delt}[x]$ \u52a0 $1$\uff0c\u5c31\u76f8\u5f53\u4e8e\u7ed9 $x$ \u548c $x$ \u7684\u7956\u5148\u7684 $w$ \u90fd\u52a0\u4e86 $1$\u3002\u90a3\u4e48\u5904\u7406\u6bcf\u4e2a\u67e5\u8be2\u65f6\uff0c\u53ea\u9700 `delt[x]++,delt[y]++,delt[u]--,delt[v]--`\uff1b\u6700\u540e\u4ee4 $w[x]$ \u4e3a\u4ee5 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u7684 $\\mathrm{delt}$ \u4e4b\u548c\u5373\u53ef\uff08\u56e0\u4e3a\u53ea\u6709\u5b50\u5b59\u624d\u5bf9 $x$ \u6709\u8d21\u732e\uff0c\u800c\u5b50\u5b59\u7684 $\\mathrm{delt}$ \u4e4b\u548c\u4fbf\u662f\u5b83\u4eec\u5bf9 $x$ \u7684\u603b\u8d21\u732e\uff09\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\uff0c\u5982\u4f55\u6c42\u51fa $u,v$ \u5462\uff1f\u6211\u4eec\u9009\u62e9\u7528\u500d\u589e LCA\uff0c\u5728\u500d\u589e\u7684\u8fc7\u7a0b\u4e2d\u5f88\u5bb9\u6613\u5f97\u5230 $u,v$\u3002\n\n\u53e6\u5916\uff0c\u5982\u679c $x$ \u6216 $y$ \u672c\u8eab\u5c31\u662f $\\mathrm{LCA}$ \u5462\uff1f\u6216\u8005 $x,y$ \u672c\u8eab\u5c31\u662f $\\mathrm{LCA}$ \u7684\u76f4\u63a5\u513f\u5b50\u5462\uff1f\u8fd9\u4e9b\u95ee\u9898\u90fd\u4e0d\u5927\uff0c\u6211\u4eec\u53ea\u8981\u4ee4 `u=x` \u6216 `v=y`\uff0c\u4e00\u52a0\u4e00\u51cf\u5c31\u62b5\u6d88\u4e86\u3002\u5199\u4ee3\u7801\u7684\u65f6\u5019\u6ce8\u610f\u5904\u7406\u3002\n\n#### \u601d\u8def\u603b\u7ed3\n\n\u7efc\u4e0a\uff0c\u8fd9\u9898\u7684\u4e3b\u8981\u89e3\u51b3\u6b65\u9aa4\u662f\uff1a\n\n1. \u8bfb\u5165\u6811\uff0c\u505a\u597d LCA \u7684\u9884\u5904\u7406\uff0c$O(n \\log n)$\n2. \u8bfb\u5165\u67e5\u8be2\uff0c\u7528\u500d\u589e LCA \u627e $u,v$\uff0c\u505a\u6811\u4e0a\u5dee\u5206\uff0c$O(q \\log n)$\n3. dfs \u4e00\u904d\uff0c\u7531\u5dee\u5206\u5f97\u5230 $w$\uff0c$O(n)$\n4. \u8fdb\u884c\u6811\u4e0a dp\uff0c\u6c42\u51fa $f$ \u7684\u51b3\u7b56\u70b9\uff0c$O(n)$\n5. \u6839\u636e\u51b3\u7b56\u60c5\u51b5\u786e\u5b9a\u91cd\u513f\u5b50\uff0c\u8f93\u51fa\u7b54\u6848\uff0c$O(n)$\n\n\u603b\u590d\u6742\u5ea6\u662f $O(n\\log n)$ \u7ea7\u522b\u7684\uff0c\u74f6\u9888\u662f LCA\u3002\n\n\u8fd9\u9053\u9898\u7684\u4e3b\u8981\u542f\u793a\u5c31\u662f\uff0c\u62ff\u5230\u9898\u8981\u52e4\u4e8e\u8f6c\u5316\u9898\u76ee\u7684\u6761\u4ef6\uff0c\u628a\u4e0d\u597d\u5904\u7406\u7684\u6761\u4ef6\u8f6c\u5316\u4e3a\u719f\u6089\u7684\u3001\u5bb9\u6613\u5904\u7406\u7684\u6761\u4ef6\uff0c\u8fd9\u6837\u5c31\u6bd4\u8f83\u5bb9\u6613\u89e3\u9898\u4e86\u3002\n\n#### \u4ee3\u7801\n\n\u4ee3\u7801\u6bd4\u8f83\u957f\uff0c\u4f46\u662f\u57fa\u672c\u90fd\u662f\u5957\u8def\uff0c\u56e0\u6b64\u4e5f\u4e0d\u96be\u5199\u3002\n\n\u5410\u69fd\u4e00\u4e0b\u6570\u636e\u592a\u5f31\uff0c\u628a\u6211\u4e00\u4efd\u8fde\u6837\u4f8b\u90fd\u6ca1\u8fc7\u7684\u9519\u8bef\u4ee3\u7801\uff08\u90a3\u4efd\u4ee3\u7801\u7684 LCA \u5199\u70b8\u4e86\uff09\u653e\u8fc7\u53bb\u4e86\u3002\u5efa\u8bae\u628a\u6837\u4f8b\u52a0\u5165\u6570\u636e\u4e2d\uff08\u7b11\uff09\u3002\n\n\u8bc4\u6d4b\u8bb0\u5f55\u5728[\u8fd9\u91cc](https://www.luogu.com.cn/record/28552121)\u3002\u53ef\u4ee5\u770b\u5230\u7b54\u6848\u57fa\u672c\u4e0a\u90fd\u6bd4 std \u4f18\u3002\n\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <algorithm>\n#define MAXIOLG 25\n#define FILENAME(x)\\\nfreopen(x\".in\",\"r\",stdin);\\\nfreopen(x\".out\",\"w\",stdout);\n#define LOWBIT(x) ((x)&(-(x)))\n#define MAXN 100005\n#define MAXM 200005\n#define MAXLG 17\nusing namespace std;\n\ntypedef long double ld;\ntypedef long long ll;\ntypedef ll io_t;\n//\u5feb\u8bfb\u5feb\u5199\nio_t shin[MAXIOLG];\nio_t seto(void);\nvoid ayano(io_t x,char spliter='\\n');\n\nint n;\n//\u5b58\u56fe\nint g[MAXM];\nint fst[MAXN],nxt[MAXM],edges=0;\n//\u500d\u589e\u7236\u4eb2\u6570\u7ec4, \u513f\u5b50\u6570\u91cf, \u6df1\u5ea6\nint par[MAXLG][MAXN],chs[MAXN],depth[MAXN];\n//log 2 \u7684\u503c\u7684\u9884\u5904\u7406\nint lg[MAXN];\n//\u5dee\u5206\u6570\u7ec4\uff0c\u540e\u6765\u76f4\u63a5\u7528\u6765\u8868\u793a w\nint delt[MAXN];\n//f \u6570\u7ec4\u548c\u51b3\u7b56\u70b9\u6570\u7ec4\nint f[MAXN][2],h[MAXN][2];\n//isp=is preferred\uff0c\u662f\u4e0d\u662f\u91cd\u513f\u5b50\uff1bpr[x] \u8868\u793a x \u7684\u91cd\u513f\u5b50\nint isp[MAXN],pr[MAXN];\n\nvoid dfs1(int x,int pa); //\u9884\u5904\u7406 LCA\nint jmp(int x,int k); //x \u5f80\u4e0a\u8df3 k \u5c42\nvoid solve(int x,int y); //\u5904\u7406\u67e5\u8be2\nvoid dfs2(int x,int pa); //\u6811\u4e0a\u5dee\u5206\u7684\u6c42\u548c, delt \u53d8\u6210 w\nvoid dfs3(int x,int pa); //\u6811\u4e0a dp\nvoid dfs4(int x,int pa); //\u7531\u51b3\u7b56\u70b9\u5f97\u51fa\u7b54\u6848\nvoid addedge(int u,int v); //\u52a0\u8fb9\n\nint main(void){\n    n=seto();\n    int q=seto();\n    {\n        //\u9884\u5904\u7406 log 2\n        lg[0]=lg[1]=0;\n        int tlg=0;\n        for (int i=2;i<=n;i++)\n            (i==LOWBIT(i))?(tlg++):(0),lg[i]=tlg;\n    }\n    for (int i=1;i<n;i++){\n        int u,v;\n        u=seto(),v=seto();\n        addedge(u,v),addedge(v,u);\n    }\n    //\u9884\u5904\u7406 LCA\n    dfs1(1,0);\n    for (int tlg=1,lgn=lg[n];tlg<=lgn;tlg++){\n        int ulg=tlg-1;\n        for (int i=1;i<=n;i++)\n            par[tlg][i]=par[ulg][par[ulg][i]];\n    }\n    //\u5904\u7406\u67e5\u8be2\n    while (q--){\n        int u,v;\n        u=seto(),v=seto();\n        solve(u,v);\n    }\n    //\u6811\u4e0a\u5dee\u5206\u7684\u6c42\u548c, delt \u53d8\u6210 w\n    dfs2(1,0);\n    //\u6811\u4e0a dp\n    dfs3(1,0);\n    //\u7531\u51b3\u7b56\u70b9\u5f97\u51fa\u7b54\u6848\n    isp[1]=0; //1 \u4e0d\u662f\u91cd\u513f\u5b50\n    dfs4(1,0);\n    //\u8f93\u51fa\u7b54\u6848\n    for (int i=1;i<=n;i++)\n        ayano(pr[i]);\n    return 0;\n}\n\nvoid dfs1(int x,int pa){\n    //\u9884\u5904\u7406 LCA\n    par[0][x]=pa,depth[x]=depth[pa]+1;\n    for (int ei=fst[x];ei;ei=nxt[ei]){\n        int v=g[ei];\n        if (v==pa)\n            continue;\n        dfs1(v,x),chs[x]++;\n    }\n}\n\nvoid dfs2(int x,int pa){\n    //\u6811\u4e0a\u5dee\u5206\u7684\u6c42\u548c, delt \u53d8\u6210 w\n    for (int ei=fst[x];ei;ei=nxt[ei]){\n        int v=g[ei];\n        if (v==pa)\n            continue;\n        dfs2(v,x);\n        delt[x]+=delt[v];\n    }\n}\n\nvoid dfs3(int x,int pa){\n    //\u6811\u4e0a dp\n    if (!chs[x]){\n        //\u53f6\u5b50\u8282\u70b9\u7684 f \u548c\u51b3\u7b56\u70b9\u90fd\u662f 0\n        f[x][0]=f[x][1]=h[x][0]=h[x][1]=0;\n        return;\n    }\n    int s0=0; //\u6240\u6709\u513f\u5b50 u \u7684 f[u][0] \u4e4b\u548c\n    for (int ei=fst[x];ei;ei=nxt[ei]){\n        int v=g[ei];\n        if (v==pa)\n            continue;\n        dfs3(v,x);\n        s0+=f[v][0];\n    }\n    int f0=-1,f1=-1; //\u5f53\u524d\u6700\u4f18 f[x][0], f[x][1]\n    int h0=0,h1=0; //\u5f53\u524d\u51b3\u7b56\u70b9\n    for (int ei=fst[x];ei;ei=nxt[ei]){\n        int v=g[ei];\n        if (v==pa)\n            continue;\n        int tf0=s0-f[v][0]+f[v][1];\n        int tf1=tf0+delt[v];\n        (tf0>f0)?(f0=tf0,h0=v):(0);\n        (tf1>f1)?(f1=tf1,h1=v):(0);\n    }\n    f[x][0]=f0,f[x][1]=f1;\n    h[x][0]=h0,h[x][1]=h1;\n}\n\nvoid dfs4(int x,int pa){\n    //\u7531\u51b3\u7b56\u70b9\u5f97\u51fa\u7b54\u6848\n    pr[x]=h[x][isp[x]]; //\u6839\u636e x \u662f\u4e0d\u662f\u91cd\u513f\u5b50\uff0c\u9009\u62e9\u76f8\u5e94\u51b3\u7b56\u70b9\n    (pr[x])?(isp[pr[x]]=1):(0);\n    for (int ei=fst[x];ei;ei=nxt[ei]){\n        int v=g[ei];\n        if (v==pa)\n            continue;\n        dfs4(v,x);\n    }\n}\n\ninline int jmp(int x,int k){\n    //x \u5f80\u4e0a\u8df3 k \u5c42\n    if (!k)\n        return x;\n    for (int i=0,lgk=lg[k];i<=lgk;i++){\n        int tpw=1<<i;\n        (k&tpw)?(x=par[i][x]):(0);\n    }\n    return x;\n}\n\nvoid solve(int x,int y){\n    //\u5904\u7406 x y \u67e5\u8be2\n    if (x==y || par[0][x]==y || par[0][y]==x)\n        //\u7279\u6b8a\u60c5\u51b5\u5224\u65ad\n        return;\n    delt[x]++,delt[y]++;\n    int xd=depth[x],yd=depth[y],dd;\n    if (xd<yd)\n        swap(x,y),dd=yd-xd;\n    else\n        dd=xd-yd;\n    int txans=x,tyans=y; //txans, tyans \u8868\u793a u, v\n    int xjmp=jmp(x,dd);\n    if (xjmp==y){\n        //LCA \u5c31\u662f y\n        txans=jmp(x,dd-1);\n        tyans=y;\n    }\n    else {\n        x=xjmp;\n        for (int tlg=lg[depth[x]];~tlg;tlg--)\n            (par[tlg][x]!=par[tlg][y])?(x=par[tlg][x],y=par[tlg][y]):(0);\n        txans=x,tyans=y;\n    }\n    delt[txans]--,delt[tyans]--;\n}\n\nvoid addedge(int u,int v){\n    //\u52a0\u8fb9\n    edges++;\n    g[edges]=v;\n    nxt[edges]=fst[u],fst[u]=edges;\n}\n\nio_t seto(void){\n    //\u5feb\u8bfb\n    io_t ans=0;\n    int symbol=0;\n    char ch=getchar();\n    while (!isdigit(ch))\n        (ch=='-')?(symbol=1):(0),ch=getchar();\n    while (isdigit(ch))\n        (ans=ans*10+(ch-'0')),ch=getchar();\n    return (symbol)?(-ans):(ans);\n}\n\nvoid ayano(io_t x,char spliter){\n    //\u5feb\u5199\n    if (!x){\n        putchar('0'),putchar(spliter);\n        return;\n    }\n    if (x<0)\n        putchar('-'),x=-x;\n    int len=0;\n    while (x){\n        io_t d=x/10;\n        shin[len++]=x-d*10;\n        x=d;\n    }\n    while (len){\n        len--;\n        putchar(shin[len]+'0');\n    }\n    putchar(spliter);\n}\n\n```",
        "postTime": 1576670142,
        "uid": 25008,
        "name": "Sweetlemon",
        "ccfLevel": 9,
        "title": "\u4e0d\u9519\u7684\u6811\u5f62 dp \u7ec3\u4e60\u9898\u2014\u2014\u6811\u94fe\u5256\u5206\uff08\u975e\u6a21\u677f\uff09"
    }
]