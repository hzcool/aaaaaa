[
    {
        "content": "\u5c71\u7684\u9ad8\u5ea6\u53ea\u53ef\u80fd\u5347\u9ad8\uff0c\u8003\u8651\u5bf9\u6bcf\u4e2a $i$ \u7ef4\u62a4\u6240\u6709\u53ef\u884c\u7684\u4e8c\u5143\u7ec4 $(i,j),i<j$\u3002\u4fee\u6539 $k$ \u65f6\uff0c\u539f\u672c\u7684 $i<k,j>k$ \u7684\u53ef\u884c\u4e8c\u5143\u7ec4 $(i,j)$ \u53ef\u80fd\u53d8\u4e3a\u4e0d\u53ef\u884c\uff0c\u6761\u4ef6\u662f $h_k> h_i+\\frac{h_i-h_j}{i-j}(k-i)\\iff \\frac{h_i-h_j}{i-j}<\\frac{h_i-h_k}{i-k}$\u3002\u5bf9\u6bcf\u4e2a $i$ \u5f00\u4e00\u68f5\u5e8f\u5217\u4e0a\u7684\u7ebf\u6bb5\u6811\u7ef4\u62a4 $\\min f(i,j>i)$\uff0c\u5176\u4e2d $f(i,j)=\\frac{h_i-h_j}{i-j}$\uff0c\u5373\u659c\u7387\u3002\u7136\u540e\u66b4\u529b\u9012\u5f52\u627e\u51fa\u6240\u6709 $f(i,j>k)<f(i,k)$\uff0c\u5220\u6389\u3002\u5bf9\u4e8e\u65b0\u4ea7\u751f\u7684\u53ef\u884c\u4e8c\u5143\u7ec4\uff0c\u66b4\u529b\u679a\u4e3e\u53e6\u4e00\u4e2a\u7aef\u70b9\u5224\u65ad\u662f\u5426\u53ef\u884c\u5e76\u5904\u7406\u3002\u7531\u4e8e\u6bcf\u6b21\u64cd\u4f5c\u6700\u591a\u4f1a\u589e\u52a0 $n$ \u4e2a\u4e8c\u5143\u7ec4\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u4e3a $O((n^2+nq)\\log n)$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nnamespace vectorwyx{\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define pb push_back\n#define eb emplace_back\n#define mk make_pair\n#define sml(x,y) (x=min(x,y))\n#define big(x,y) (x=max(x,y))\n#define ll long long\n#define uint unsigned\n#define ull unsigned long long\n#define umap unordered_map\n#define db double\n#define fo(i,x,y) for(int i=(x);i<=(y);++i)\n#define go(i,x,y) for(int i=(x);i>=(y);--i)\n#define ptc putchar\n#define emp emplace\n#define re return\n#define co continue\n#define brk break\n#define HH (ptc('\\n'))\n#define bctz __builtin_ctz\n#define bclz __builtin_clz\n#define bppc __builtin_popcount\nusing namespace std;\nll seed=chrono::system_clock::now().time_since_epoch().count();\nmt19937 rnd(seed);\ninline int rm(int x,int y){return (int)(rnd()%(y-x+1ll)+x);}\ninline int read(){signed ch=getchar();int x=0,f=1;while(!isdigit(ch)){if(ch==(int)('-'))f=-1;ch=getchar();}while(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}return x*f;}\ninline void out(int *a,int l,int r){fo(i,l,r) cout<<*(a+i)<<' ';puts(\"\");}\n\n//14:50~15:20,15:20\nconst int N=2005,inf=1.1e9;\nstruct frac{\n\tint fz,fm;\n\tfrac(){fz=0,fm=1;}\n\tfrac(int x,int y){if(y<0) x=-x,y=-y;fz=x,fm=y;}\n\tbool operator<(const frac &x)const{re (ll)fz*x.fm<(ll)fm*x.fz;}\n\tbool operator>(const frac &x)const{re (ll)fz*x.fm>(ll)fm*x.fz;}\n\tbool operator<=(const frac &x)const{re (ll)fz*x.fm<=(ll)fm*x.fz;}\n\tbool operator>=(const frac &x)const{re (ll)fz*x.fm>=(ll)fm*x.fz;}\n};\nint h[N],n,q;\nfrac f(int i,int j){re frac(h[i]-h[j],i-j);}\nstruct Sgt{\n#define ls (x<<1)\n#define rs (x<<1|1)\n#define mid ((l+r)>>1)\nstruct Node{\n\tfrac mn,mx;\n\tint cnt;\n\tNode(){mn=frac(inf,1);mx=frac(-inf,1);cnt=0;}\n}tr[N<<2];\nint od;\nvoid ps(int x){\n\ttr[x].mn=min(tr[ls].mn,tr[rs].mn);\n\ttr[x].mx=max(tr[ls].mx,tr[rs].mx);\n\ttr[x].cnt=tr[ls].cnt+tr[rs].cnt;\n}\nvoid build(int x,int l,int r){\n\tif(l==r){\n\t\ttr[x].mn=tr[x].mx=f(od,l);\n\t\ttr[x].cnt=0;\n\t\tre;\n\t}\n\tbuild(ls,l,mid);\n\tbuild(rs,mid+1,r);\n\tps(x);\n}\nvoid upd(int x,int l,int r,int aim){\n//\tif(x==1) printf(\"upd(%d,%d)\\n\",od,aim);\n\tif(l==r){\n\t\ttr[x].cnt=1;\n\t\tre;\n\t}\n\tif(aim<=mid) upd(ls,l,mid,aim);\n\telse upd(rs,mid+1,r,aim);\n\tps(x);\n}\nbool set(int x,int l,int r,int aim,frac v){\n//\tif(x==1) printf(\"%d:set(%d,(%d/%d))\\n\",od,aim,v.fz,v.fm);\n\tif(l==r) re tr[x].mn=tr[x].mx=v,1;\n\tif(aim<=mid){\n\t\tbool ret=set(ls,l,mid,aim,v);\n\t\tps(x);\n\t\tre ret;\n\t}\n\tbool ret=tr[ls].mx<=v&&set(rs,mid+1,r,aim,v);\n\tps(x);\n\tre ret;\n}\nvoid play(int x,int l,int r,int k,frac lim){\n//\tprintf(\"%d:play(%d,%d,%d,%d,(%d/%d)) mn=(%d/%d)\\n\",od,x,l,r,k,lim.fz,lim.fm,tr[x].mn.fz,tr[x].mn.fm);\n\tif(tr[x].cnt==0||tr[x].mn>=lim||r<=k) re;\n\tif(l==r){\n//\t\tprintf(\"(%d,%d) < %d/%d\\n\",od,l,lim.fz,lim.fm);\n\t\ttr[x].cnt=0;\n\t\tre;\n\t}\n\tplay(ls,l,mid,k,lim);\n\tplay(rs,mid+1,r,k,lim);\n\tps(x);\n}\n#undef ls\n#undef mid\n#undef rs\n}tr[N];\n\nvoid build(int i){\n//\tprintf(\"build(%d)!!!!!!!!!!!!!!!!!!!!!!!!!\\n\",i);\n\tif(i==n) re;\n\ttr[i].build(1,i+1,n);\n\tfrac x=frac(-inf,1);\n\tfo(j,i+1,n) if(f(i,j)>=x){\n//\t\tprintf(\"f(%d,%d)=(%d/%d) x=(%d/%d)\\n\",i,j,f(i,j).fz,f(i,j).fm,x.fz,x.fm);\n\t\ttr[i].upd(1,i+1,n,j);\n\t\tx=f(i,j);\n\t}\n}\n\nsigned main(){\n//\tfreopen(\"gen.txt\",\"r\",stdin);freopen(\"mine.txt\",\"w\",stdout);\n\tcin>>n;\n\tfo(i,1,n) h[i]=read(),tr[i].od=i;\n\tfo(i,1,n-1) build(i);\n\tcin>>q;\n\twhile(q--){\n\t\tint k=read(),v=read();\n\t\th[k]+=v;\n\t\tfo(i,1,k-1) tr[i].play(1,i+1,n,k,f(i,k));\n\t\tfo(i,1,k-1){\n\t\t\tif(tr[i].set(1,i+1,n,k,f(i,k))) tr[i].upd(1,i+1,n,k);\n\t\t}\n\t\tbuild(k);\n\t\tint ans=0;\n\t\tfo(i,1,n) ans+=tr[i].tr[1].cnt;\n\t\tcout<<ans<<'\\n';\n\t}\n\treturn 0;\n}\n}\n/*\n5\n2 4 3 1 5\n3\n4 3\n1 3\n3 2\n-------------------------------------------------\n7\n10\n7\n*/\n\n\n\n\n\n\n\n\n\n\nsigned main(){re vectorwyx::main();}\n```",
        "postTime": 1671881618,
        "uid": 238408,
        "name": "vectorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8904 [USACO22DEC] Mountains G"
    },
    {
        "content": "# P8904 \u9898\u89e3\n\n\u6a21\u62df\u3002\n\n## \u9898\u76ee\u5927\u610f\n\n\u6709 $n$ \u5ea7\u5c71\uff0c\u6bcf\u5ea7\u5c71\u6709\u9ad8\u5ea6 $h_i$\uff0c\u6bcf\u6b21\u63d0\u9ad8\u67d0\u4e2a\u5c71\u7684\u9ad8\u5ea6\uff0c\u540c\u65f6\u8be2\u95ee\u6709\u591a\u5c11\u7ec4\u5c71\u80fd\u4e92\u76f8\u770b\u5230\uff08\u80fd\u4e92\u76f8\u770b\u5230\u6307\u5c71\u5cf0\u8fde\u7ebf\u4e0a\u6ca1\u6709\u963b\u6321\uff09\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u8003\u8651\u66b4\u529b\u7528 $n$ \u4e2a set \u7ef4\u62a4\u6bcf\u4e2a\u5c71\u80fd\u770b\u89c1\u7684\u53f3\u8fb9\u7684\u5c71\u3002\n\n\u5bf9\u4e8e\u521d\u59cb\u9ad8\u5ea6\uff0c\u679a\u4e3e\u7b2c $i$ \u4e2a\u5c71\u5cf0\uff0c\u5411\u53f3\u4e0d\u65ad\u627e\u80fd\u770b\u89c1\u7684\u5c71\uff0c\u540c\u65f6\u8ba1\u7b97\u89c6\u7ebf\u659c\u7387\uff0c\u590d\u6742\u5ea6 $O(n^2\\log n)$\u3002\n\n\u6bcf\u6b21\u63d0\u9ad8\u7b2c $x$ \u5ea7\u5c71\u5cf0\u7684\u9ad8\u5ea6\u65f6\uff0c\u679a\u4e3e $x$ \u5de6\u8fb9\u7684\u5c71\u5cf0 $i$\uff0c\u5148\u5224\u65ad $x$ \u80fd\u4e0d\u80fd\u88ab\u770b\u89c1\uff0c\u80fd\u7684\u8bdd\u5c31\u5411\u53f3\u4f9d\u6b21\u5220\u9664\u88ab $x$ \u6321\u4f4f\u7684\u5c71\u5cf0\uff0c\u5bf9\u4e8e\u7b2c $x$ \u5ea7\u5c71\uff0c\u76f4\u63a5\u91cd\u6784\u5bf9\u5e94\u7684 set\u3002\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a $i<x$\uff0c\u6bcf\u6b21\u4fee\u6539\u6700\u591a\u4f7f\u5b83\u80fd\u770b\u89c1\u7684\u5c71\u5cf0\u6570\u52a0 1\uff0c\u6240\u4ee5\u6700\u591a\u5220\u9664 $n+q$ \u6b21\u3002\u5bf9\u4e8e $x$\uff0c\u6bcf\u6b21\u6700\u591a\u4f7f\u5b83\u80fd\u770b\u89c1\u7684\u5c71\u5cf0\u6570\u52a0 $n$\uff0c\u6240\u6709\u5c71\u52a0\u8d77\u6765\u6700\u591a $nq$ \u6b21\uff0c\u590d\u6742\u5ea6 $O((n^2+nq)\\log n)$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O((n^2+nq)\\log n)$\uff0c\u5e38\u6570\u975e\u5e38\u5927\uff0c\u4e0d\u5f00 O2 \u8fc7\u4e0d\u53bb\uff0c\u5f00 O2 \u6700\u6162\u7684\u70b9 2.22s\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=2001;\nint n,q;\nint h[MAXN];\ndouble cal(int i,int j){\n\treturn 1.0*(h[j]-h[i])/(j-i);\n}\nset<int> st[MAXN];\nint lower(int i,int x){\n\tauto p=st[i].lower_bound(x);\n\tp--;\n\treturn *p;\n}\nint upper(int i,int x){\n\tauto p=st[i].upper_bound(x);\n\treturn *p;\n}\nint main(){\n\tios::sync_with_stdio(0);\n\tcin.tie(0),cout.tie(0);\n\tcin>>n;\n\tfor(int i=1;i<=n;i++)cin>>h[i];\n\tint ans=0;\n\tfor(int i=1;i<=n;i++){\n\t\tst[i].insert(0);\n\t\tst[i].insert(n+1);\n\t\tdouble now=-1e9;\n\t\tfor(int j=i+1;j<=n;j++)\n\t\t\tif(now<=cal(i,j))now=cal(i,j),st[i].insert(j),ans++;\n\t}\n\tcin>>q;\n\twhile(q--){\n\t\tint x,y;\n\t\tcin>>x>>y;\n\t\th[x]+=y;\n\t\tfor(int i=1;i<x;i++){\n\t\t\tint y=lower(i,x);\n\t\t\tif(y&&cal(i,y)>cal(i,x))continue;\n\t\t\tif(st[i].find(x)==st[i].end())st[i].insert(x),ans++;\n\t\t\ty=upper(i,x);\n\t\t\twhile(y<=n){\n\t\t\t\tif(cal(i,x)<=cal(i,y))break;\n\t\t\t\tst[i].erase(y),ans--;\n\t\t\t\ty=upper(i,y);\n\t\t\t}\n\t\t}\n\t\tans-=st[x].size()-2;\n\t\tst[x].clear();\n\t\tst[x].insert(0);\n\t\tst[x].insert(n+1);\n\t\tdouble now=-1e9;\n\t\tfor(int j=x+1;j<=n;j++)\n\t\t\tif(now<=cal(x,j))now=cal(x,j),st[x].insert(j),ans++;\n\t\tcout<<ans<<'\\n';\n\t}\n\treturn 0;\n}\n```\n\n\u8c22\u8c22\u89c2\u770b\uff01",
        "postTime": 1672237902,
        "uid": 241520,
        "name": "fanglong",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P8904 [USACO22DEC] Mountains G"
    },
    {
        "content": "\u4e00\u4e2a\u66b4\u529b\u505a\u6cd5\u3002\n\n\u524d\u7f6e\u9898\u76ee\uff1a[\u697c\u623f\u91cd\u5efa](https://www.luogu.com.cn/problem/P4198)\n\n\u53d1\u73b0\u5c31\u662f\u641e $n$ \u4e2a\u697c\u623f\u91cd\u5efa\uff0c\u5177\u4f53\u7684\u6211\u4eec\u5bf9 $i$ \u7ef4\u62a4 $i+1\\cdots n$ \u7684 \u697c\u623f\u91cd\u5efa \u7ebf\u6bb5\u6811\u3002\u6bcf\u6b21\u4fee\u6539\u53ea\u9700\u8981\u5728 $1\\cdots x-1$ \u7684\u7ebf\u6bb5\u6811\u4e0a\u4fee\u6539\uff0c\u7136\u540e\u518d\u91cd\u6784\u7b2c $x$ \u68f5\u7ebf\u6bb5\u6811\u5373\u53ef\uff08\u751a\u81f3\u76f4\u63a5\u66b4\u529b\u5355\u70b9\u8be5\u4ee3\u66ff\u91cd\u6784\u4e5f\u884c\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nq\\log^2n)$\u3002\n\n\u8fd8\u6709\u5927\u4f6c\u6709 $O(nq\\log n)$ \u7684 nb \u505a\u6cd5\uff0c\u819c\u62dc\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define LL long long\n#define U(i,a,b) for(int i(a),i##e(b);i<=i##e;++i)\n#define D(i,b,a) for(int i(b),i##e(a);i>=i##e;--i)\nusing namespace std;\nconst int N(2000);\nint n,ans,h[N+5],Q;\nusing pii=pair<int,int>;\n#define fi first\n#define se second\ndouble calc(pii a,pii b)\n{\n\treturn 1.0*(a.se-b.se)/(a.fi-b.fi);\n}\nstruct SegmentTree\n{\n\tint l[N*4+5];\n\tdouble mx[N*4+5];\n\t#define mid (L+R>>1)\n\t#define Ls rt<<1,L,mid\n\t#define Rs rt<<1|1,mid+1,R\n\tint ask(double lim,int rt,int L,int R)\n\t{\n\t\tif(mx[rt]<lim) return 0;\n\t\tif(L==R) return mx[rt]>=lim;\n\t\tif(mx[rt<<1]<lim) return ask(lim,Rs);\n\t\treturn ask(lim,Ls)+l[rt]-l[rt<<1];\n\t}\n\tvoid modify(int p,double K,int rt,int L,int R) \n\t{\n\t\tif(L==R) return (void)(mx[rt]=K,l[rt]=1);\n\t\t(p<=mid)?modify(p,K,Ls):modify(p,K,Rs);\n\t\tmx[rt]=max(mx[rt<<1],mx[rt<<1|1]);\n\t\tl[rt]=l[rt<<1]+ask(mx[rt<<1],Rs);\n\t}\n\tvoid build(int st,int rt,int L,int R)\n\t{\n\t\tif (L==R) return (void)(mx[rt]=calc({st,h[st]},{L,h[L]}),l[rt]=1);\n\t\tbuild(st,Ls),build(st,Rs);\n\t\tmx[rt]=max(mx[rt<<1],mx[rt<<1|1]);\n\t\tl[rt]=l[rt<<1]+ask(mx[rt<<1],Rs);\n\t}\n} sgt[N+5];\nint main()\n{\n\tcin.tie(0)->sync_with_stdio(0);\n\tcin>>n;\n\tfor (int i(1);i<=n;++i) cin>>h[i];\n\tfor (int i(1);i<n;++i) sgt[i].build(i,1,i+1,n),ans+=sgt[i].l[1];\n\tfor (cin>>Q;Q--;)\n\t{\n\t\tint x,y; cin>>x>>y;\n\t\th[x]+=y;\n\t\tfor (int i(1);i<x;++i)\n\t\t{\n\t\t\tans-=sgt[i].l[1];\n\t\t\tsgt[i].modify(x,calc({i,h[i]},{x,h[x]}),1,i+1,n);\n\t\t\tans+=sgt[i].l[1];\n\t\t}\n\t\tif (x<n)\n\t\t{\n\t\t\tans-=sgt[x].l[1];\n\t\t\tsgt[x].build(x,1,x+1,n);\n\t\t\tans+=sgt[x].l[1];\n\t\t}cout<<ans<<'\\n';\n\t}return 0;\n}\n```",
        "postTime": 1671410408,
        "uid": 312306,
        "name": "LJ07",
        "ccfLevel": 0,
        "title": "[Solution]Mountains"
    },
    {
        "content": "# P8904 \u9898\u89e3\n\n\n\n## \u601d\u8def\u5206\u6790\n\n\u7ebf\u6bb5\u6811\u6a21\u62df\u3002\n\n\u9996\u5148\u89e3\u51b3\u9759\u6001\u7248\u672c\uff1a\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u7edf\u8ba1\u51fa\u6709\u591a\u5c11\u4e2a $j>i$ \u4e14 $i,j$ \u80fd\u591f\u4e92\u76f8\u770b\u5230\uff0c\u663e\u7136\u8fd9\u7b49\u4ef7\u4e8e $\\forall i<k\\le j: \\operatorname{slope}(i,j)\\ge \\operatorname{slope}(i,k)$\uff0c\u56e0\u6b64\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u7ef4\u62a4 $\\operatorname{slope}(i,i+1)\\sim\\operatorname{slope}(i,n)$ \u7684\u524d\u7f00 $\\max$ \u503c $\\max_{i,j}$\uff0c\u5982\u679c\u67d0\u4e2a $j$ \u6ee1\u8db3 $\\operatorname{slope}(i,j)=\\max_{i,j}$ \u5c31\u7edf\u8ba1 $(i,j)$ \u5230\u7b54\u6848\u4e2d\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u6bcf\u6b21\u589e\u52a0\u5c71\u5cf0 $x$ \u7684\u9ad8\u5ea6\uff0c\u5bf9\u4e8e\u6240\u6709 $(x,j)$ \u7684\u5bf9\u76f4\u63a5\u66b4\u529b\u91cd\u6784 $\\max_{x,j}$\uff0c\u91cd\u7b97\u7b54\u6848\u5373\u53ef\uff0c\u800c\u5bf9\u4e8e $(i,x)$ \u7684\u5bf9\uff0c\u6ce8\u610f\u5230\u4fee\u6539\u5b8c\u4e4b\u540e\u4e00\u5b9a\u662f\u589e\u52a0\u4e86 $\\operatorname{slope}(i,x)$ \u7684\u503c\uff0c\u90a3\u4e48\u5728 $\\max_{i,j}$ \u4e0a\uff0c\u76f8\u5f53\u4e8e\u589e\u52a0\u4e86\u4e00\u6bb5\u7684\u503c\uff0c\u5047\u8bbe\u4fee\u6539 $x$ \u540e\uff0c\u6539\u53d8\u4e86 $[x,k]$ \u8fd9\u4e00\u6bb5\u7684 $\\max_{i,j}$ \u503c\uff0c\u90a3\u4e48 $(x,k]$ \u4e2d\u6240\u6709\u7684 $j$ \u90fd\u6709 $\\operatorname{slope}(i,j)<\\operatorname{slope}(i,x)$\uff0c\u8fd9\u6837\u7684 $(i,j)$ \u4f1a\u88ab $x$ \u6321\u4f4f\uff0c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u8bbe\u4e3a $0$\uff0c\u800c $x$ \u66f4\u65b0\u4e86 $\\max_{i,x}$ \u7684\u503c\uff0c$(i,x)$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u53d8\u4e3a $1$\uff0c\u9700\u8981\u7279\u522b\u5224\u65ad\u4fee\u6539\u540e $\\operatorname{slope}(i,x)$ \u7684\u6070\u597d\u7b49\u4e8e\u539f\u672c\u7684 $\\max_{i,x}$ \u7684\u503c\uff0c\u6b64\u65f6\u4e0d\u7528\u66f4\u65b0 $\\max_{i,x}$ \u4e0d\u8fc7\u8981\u6dfb\u52a0\u8d21\u732e\u3002\n\n\u56e0\u6b64\u6211\u4eec\u5f00 $2n$ \u68f5\u7ebf\u6bb5\u6811\uff0c$n$ \u68f5\u7ef4\u62a4 $\\max_{i,j}$\uff0c\u652f\u6301\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u548c\u533a\u95f4\u8986\u76d6\uff0c$n$ \u68f5\u7ef4\u62a4 $(i,j)$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u652f\u6301\u5355\u70b9\u52a0\u533a\u95f4\u6e05\u96f6\u548c\u7edf\u8ba1\u603b\u548c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta((n^2+nq)\\log n)$\u3002\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=2022;\nconst double eps=1e-4,INF=1e9;\ndouble sl[MAXN][MAXN],pre[MAXN][MAXN];\nclass SgtTr1 {\n\tprivate:\n\t\tstruct node {\n\t\t\tdouble max,tag;\n\t\t}\ttree[MAXN<<2];\n\t\tinline int left(int x) { return x<<1; }\n\t\tinline int right(int x) { return x<<1|1; }\n\t\tinline void pushup(int pos) { tree[pos].max=max(tree[left(pos)].max,tree[right(pos)].max); }\n\t\tinline void pushdown(int pos) {\n\t\t\tif(fabs(tree[pos].tag)<eps) return ;\n\t\t\ttree[left(pos)].max=tree[right(pos)].max=tree[pos].tag;\n\t\t\ttree[left(pos)].tag=tree[right(pos)].tag=tree[pos].tag;\n\t\t\ttree[pos].tag=0;\n\t\t}\n\tpublic:\n\t\tinline void Build(int id,int l,int r,int pos) {\n\t\t\ttree[pos].tag=0;\n\t\t\tif(l==r) {\n\t\t\t\ttree[pos].max=pre[id][l];\n\t\t\t\treturn ;\n\t\t\t}\n\t\t\tint mid=(l+r)>>1;\n\t\t\tBuild(id,l,mid,left(pos));\n\t\t\tBuild(id,mid+1,r,right(pos));\n\t\t\tpushup(pos);\n\t\t}\n\t\tinline void Modify(int ul,int ur,double val,int l,int r,int pos) {\n\t\t\tif(ul<=l&&r<=ur) {\n\t\t\t\ttree[pos].max=tree[pos].tag=val;\n\t\t\t\treturn ;\n\t\t\t}\n\t\t\tpushdown(pos);\n\t\t\tint mid=(l+r)>>1;\n\t\t\tif(ul<=mid) Modify(ul,ur,val,l,mid,left(pos));\n\t\t\tif(mid<ur) Modify(ul,ur,val,mid+1,r,right(pos));\n\t\t\tpushup(pos);\n\t\t}\n\t\tinline int Binary(double ther,int l,int r,int pos) {\n\t\t\tif(l==r) return l;\n\t\t\tint mid=(l+r)>>1;\n\t\t\tpushdown(pos);\n\t\t\tif(ther<=tree[left(pos)].max) return Binary(ther,l,mid,left(pos));\t\n\t\t\treturn Binary(ther,mid+1,r,right(pos));\n\t\t}\n\t\tinline double Query(int u,int l,int r,int pos) {\n\t\t\tif(l==r) return tree[pos].max;\n\t\t\tint mid=(l+r)>>1;\n\t\t\tpushdown(pos);\n\t\t\tif(u<=mid) return Query(u,l,mid,left(pos));\n\t\t\treturn Query(u,mid+1,r,right(pos));\n\t\t}\n}\tS[MAXN];\nclass SgtTr2 {\n\tprivate:\n\t\tstruct node {\n\t\t\tint sum,tag;\n\t\t}\ttree[MAXN<<2];\n\t\tinline int left(int x) { return x<<1; }\n\t\tinline int right(int x) { return x<<1|1; }\n\t\tinline void pushup(int pos) { tree[pos].sum=tree[left(pos)].sum+tree[right(pos)].sum; }\n\t\tinline void pushdown(int pos,int l,int r) {\n\t\t\tif(tree[pos].tag==-1) return ;\n\t\t\tint mid=(l+r)>>1;\n\t\t\ttree[left(pos)].sum=tree[pos].tag*(mid-l+1);\n\t\t\ttree[right(pos)].sum=tree[pos].tag*(r-mid);\n\t\t\ttree[left(pos)].tag=tree[right(pos)].tag=tree[pos].tag;\n\t\t\ttree[pos].tag=-1;\n\t\t\treturn ;\n\t\t}\n\tpublic:\n\t\tinline void Modify(int ul,int ur,int val,int l,int r,int pos) {\n\t\t\tif(ul<=l&&r<=ur) {\n\t\t\t\ttree[pos].sum=val*(r-l+1);\n\t\t\t\ttree[pos].tag=val;\n\t\t\t\treturn ;\n\t\t\t}\n\t\t\tpushdown(pos,l,r);\n\t\t\tint mid=(l+r)>>1;\n\t\t\tif(ul<=mid) Modify(ul,ur,val,l,mid,left(pos));\n\t\t\tif(mid<ur) Modify(ul,ur,val,mid+1,r,right(pos));\n\t\t\tpushup(pos);\n\t\t\treturn ;\n\t\t}\n\t\tinline int Query(int ul,int ur,int l,int r,int pos) {\n\t\t\tif(ul<=l&&r<=ur) return tree[pos].sum;\n\t\t\tpushdown(pos,l,r);\n\t\t\tint mid=(l+r)>>1,ret=0;\n\t\t\tif(ul<=mid) ret+=Query(ul,ur,l,mid,left(pos));\n\t\t\tif(mid<ur) ret+=Query(ul,ur,mid+1,r,right(pos));\n\t\t\treturn ret;\n\t\t}\n}\tT[MAXN];\nint a[MAXN];\ninline double slope(int x,int y) {\n\treturn (double)(a[x]-a[y])/(x-y);\n}\nsigned main() {\n\tint n,ans=0;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;++i) {\n\t\tscanf(\"%d\",&a[i]);\n\t}\n\tfor(int i=1;i<=n;++i) {\n\t\tpre[i][0]=-INF;\n\t\tfor(int j=1;j<=n-i;++j) {\n\t\t\tsl[i][j]=slope(i,i+j);\n\t\t\tpre[i][j]=max(pre[i][j-1],sl[i][j]);\n\t\t}\n\t\tpre[i][n-i+1]=INF;\n\t\tS[i].Build(i,1,n-i+1,1);\n\t\tfor(int j=1;j<=n-i;++j) {\n\t\t\tif(fabs(sl[i][j]-pre[i][j])<eps) {\n\t\t\t\t++ans;\n\t\t\t\tT[i].Modify(j,j,1,1,n-i,1);\n\t\t\t}\n\t\t}\n\t}\n\tint q;\n\tscanf(\"%d\",&q);\n\twhile(q--) {\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\ta[x]+=y;\n\t\tfor(int i=1;i<x;++i) {\n\t\t\tdouble k=slope(i,x);\n\t\t\tsl[i][x-i]=k;\n\t\t\tint d=S[i].Binary(k,1,n-i+1,1)+i-1;\n\t\t\tif(d<=x) {\n\t\t\t\tdouble org=S[i].Query(x-i,1,n-i+1,1),bef=(double)(a[x]-y-a[i])/(x-i);\n\t\t\t\tS[i].Modify(x-i,x-i,max(k,org),1,n-i+1,1);\n\t\t\t\tif(bef<org&&org<=k) {\n\t\t\t\t\t++ans;\n\t\t\t\t\tT[i].Modify(x-i,x-i,1,1,n-i,1);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t} \n\t\t\tS[i].Modify(x-i,d-i,k,1,n-i+1,1);\n\t\t\tans-=T[i].Query(x-i,d-i,1,n-i,1);\n\t\t\tT[i].Modify(x-i,d-i,0,1,n-i,1);\n\t\t\t++ans;\n\t\t\tT[i].Modify(x-i,x-i,1,1,n-i,1);\n\t\t}\n\t\tfor(int i=1;i<=n-x;++i) {\n\t\t\tsl[x][i]=slope(x,x+i);\n\t\t\tpre[x][i]=max(pre[x][i-1],sl[x][i]);\n\t\t}\n\t\tS[x].Build(x,1,n-x+1,1);\n\t\tans-=T[x].Query(1,n-x,1,n-x,1);\n\t\tT[x].Modify(1,n-x,0,1,n-x,1);\n\t\tfor(int i=1;i<=n-x;++i) {\n\t\t\tif(fabs(sl[x][i]<pre[x][i])<eps) {\n\t\t\t\t++ans;\n\t\t\t\tT[x].Modify(i,i,1,1,n-x,1);\n\t\t\t}\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1673840866,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "P8904 \u9898\u89e3"
    }
]