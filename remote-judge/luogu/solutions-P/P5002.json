[
    {
        "content": "## \u867d\u7136\u6807\u7b7e\u6709LCA\uff0c\u4f46\u6839\u672c\u6ca1\u6709\u7528\u5230\u6c42LCA\uff08~~\u8c01\u5199\u7684\u6807\u7b7e\uff09~~\n\u5148\u662f\u5b58\u6811\uff0c\u6211\u4e60\u60ef\u7528\u7684\u662f\u9886\u63a5\u8868~~\uff08\u672c\u4eba\u592a\u5f31\uff0c\u4e0d\u4f1a\u7528vector\uff09~~\n```cpp\nint n,m,r,tot;\nint to[N],ne[N],head[N],son[N],ans[50002],de[N];\nvoid add(int x,int y){\n\tto[++tot]=y,ne[tot]=head[x],head[x]=tot;\n}\n```\nn,m,r\u5982\u9898\u610f\u6240\u793a\uff0cson\u6570\u7ec4\u8bb0\u5f55\u6bcf\u4e2a\u5b50\u6811\u7684\u5927\u5c0f\uff0cde\u6570\u7ec4\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u6df1\u5ea6\uff0cans\u6570\u7ec4\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u5bf9\u5e94\u7684\u7b54\u6848\n\n\u672c\u9898\u7684\u6838\u5fc3\u5c31\u662f\u6c42\u6bcf\u68f5\u5b50\u6811\u7684\u5927\u5c0f,\u7136\u540e\u6392\u5217\u7ec4\u5408\u4e00\u4e0b\n```cpp\nvoid dfs(int x,int fa){\n\tson[x]=1;//\u5b50\u6811\u5305\u62ec\u81ea\u8eab \n\tde[x]=de[fa]+1;//\u6682\u65f6\u6ca1\u4ec0\u4e48\u7528\u7684\u6df1\u5ea6 \n\tfor(int i=head[x];i;i=ne[i]){//\u90bb\u63a5\u8868\u904d\u5386 \n\t\tif(to[i]!=fa){//\u6ca1\u4e86\u5b83\u4f60\u7684dfs\u5c31\u4f1a\u5728\u6839\u8282\u70b9\u548c\u4e00\u4e2a\u5b50\u6811\u4e0a\u53cd\u590d\u6a2a\u8df3 \n\t\t\tdfs(to[i],x);\n\t\t\tson[x]+=son[to[i]]%mo;//\u9012\u5f52\uff0c\u6c42\u51fa\u5176\u513f\u5b50\u7684\u5b50\u6811\u7684\u5927\u5c0f\u540e\u518d\u52a0\u4e0a\u53bb\uff0c\u9012\u5f52\u8fb9\u754c\u662f\u53f6\u5b50\u8282\u70b9,son[]\u4e3a1 \n\t\t}\n\t}\n}\n```\n\u8fd9\u6837\u6211\u4eec\u5c31\u5feb\u4e50\u5730\u6c42\u51fa\u4e86\u6240\u6709\u5b50\u6811\u7684\u5927\u5c0f\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5206\u6790\u9898\u76ee\u4e86\uff0c\u9898\u95ee\u6709\u591a\u5c11\u5bf9\u8282\u70b9\uff08x\uff0cy\uff09\u7684LCA\u4e3ap\uff0c\u5f88\u5bb9\u6613\u53d1\u73b0\u4ee5\u4e0b\u6027\u8d28\n\n1. x,y\u4e00\u5b9a\u5728p\u7684\u5b50\u6811\u4e2d\n1. \u5982\u679cx\uff0cy\u90fd\uff01=p\uff0c\u90a3\u4e48x\uff0cy\u7edd\u5bf9\u4e0d\u662fp\u7684\u540c\u4e00\u4e2a\u513f\u5b50\u7684 \u5b50\u6811\n\n\u603b\u7ed3\u4e00\u4e0b\u5c31\u4f1a\u53d1\u73b0\u8981\u4e48\u4e00\u4e2a\u8282\u70b9\u4e3ap\uff0c\u53e6\u4e00\u4e2a\u8282\u70b9\u4e3a\u5b50\u6811p\u4e2d\u7684\u4efb\u4e00\u8282\u70b9\uff08\u4e00\u5171son [ p ]\u5bf9\uff09\uff1b\u8981\u4e48\u4e00\u4e2a\u8282\u70b9\u5728p\u7684\u513f\u5b50\u7684\u5b50\u6811\u4e2d\uff0c\u53e6\u4e00\u4e2a\u8282\u70b9\u5728p\u7684\u5176\u5b83\u513f\u5b50\u7684\u5b50\u6811\u4e2d\uff08\u5305\u62ecp\u8282\u70b9\uff09\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u904d\u5386p\u7684\u513f\u5b50\uff0c\u6bcf\u4e00\u4e2a\u513f\u5b50\u7684\u5b50\u6811\u5927\u5c0f\u4e58\u4e0ap\u5b50\u6811\u4e2d\u9664\u8be5\u5b50\u6811\u7684\u5927\u5c0f\uff0c\u6700\u540e\u52a0\u4e0ason[p]\n```cpp\nint getans(int p){\n\tint x,y=0,z=0;//x\u4e3ap\u7684\u5b50\u6811\u5927\u5c0f\uff0cy\u4e3a\u672c\u6b21\u904d\u5386\u5230\u7684\u5b50\u6811\u7684\u5927\u5c0f\n\tz=x=son[p];//z\u4e3a\u8ba1\u7b97\u7ed3\u679c\n\tfor(int i=head[p];i;i=ne[i]){\n\t\tif(de[to[i]]<de[p]) continue;//\u901a\u8fc7\u6df1\u5ea6\u6765\u4fdd\u8bc1\u641c\u7d22\u7684\u5176\u513f\u5b50\n\t\ty=son[to[i]];\n\t\tz+=(long long)((x-y)*y)%mo;\n\t}\n\treturn z;\n}\n```\n\u7528\u4e86\u8fd9\u4e2a\uff0c\u5c31\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e00\u4e2a\u8be2\u95ee\u7684p\u6c42\u51fa\u76f8\u5e94\u7684\u7ed3\u679c\n```cpp\nfor(int i=1;i<=m;i++){\n\tint p;\n\tcin>>p;\n        ans[p]=getans(p);\n}\nfor(int i=1;i<=m;i++) cout<<ans[i]<<endl;\n```\n\n\u7136\u540e\u3002\u3002\u3002\u7136\u540e\u5c31TLE\u4e86\u4e00\u4e2a\u70b9\n\n\u600e\u4e48\u56de\u4e8b\u5462\uff1f\u518d\u56de\u53bb\u770b\u770b\u9898\u76ee\uff0cM<=50000\u800cN<=10000\uff0c\u8bf6\uff0c\u8be2\u95ee\u6b21\u6570\u6bd4\u70b9\u8981\u591a\uff0c\u8bf4\u660e\u5f88\u591a\u70b9\u88ab\u91cd\u590d\u8be2\u95ee\u4e86\u591a\u6b21\uff08~~\u597d\u5751\u554a~~\uff09\n\n```cpp\n\tfor(int i=1;i<=n;i++) ans[i]=getans(i);\n\tfor(int i=1;i<=m;i++){\n\t\tint p;\n\t\tread(p);\n\t\tcout<<ans[p]<<endl;\n\t}\n```\n\u6240\u4ee5\u6211\u4eec\u5c31\u628a\u6bcf\u4e2a\u70b9\u90fd\u5904\u7406\u4e00\u904d\uff0c\u6700\u540e\u76f4\u63a5\u8f93\u51fa\u5c31\u597d\u4e86\n\n**\u5b8c\u6574\u4ee3\u7801**\n```\n#include<bits/stdc++.h>\n#define INF 0x3f3f3f3f\n#define N 20002\n#define mo 1000000007\nusing namespace std;\nint n,m,r,tot;\nint to[N],ne[N],head[N],son[N],ans[50002],de[N];\nvoid add(int x,int y){\n\tto[++tot]=y,ne[tot]=head[x],head[x]=tot;\n}\nvoid read(int &x) {\n    int f = 1; x = 0;\n    char ch = getchar();\n    while (ch < '0' || ch > '9')   {if (ch == '-') f = -1; ch = getchar();}\n    while (ch >= '0' && ch <= '9') {x = x * 10 + ch - '0'; ch = getchar();}\n    x *= f;\n}\nvoid dfs(int x,int fa){\n\tson[x]=1;//\u5b50\u6811\u5305\u62ec\u81ea\u8eab\n\tde[x]=de[fa]+1;//\u6682\u65f6\u6ca1\u4ec0\u4e48\u7528\u7684\u6df1\u5ea6 \n\tfor(int i=head[x];i;i=ne[i]){//\u90bb\u63a5\u8868\u904d\u5386 \n\t\tif(to[i]!=fa){//\u6ca1\u4e86\u5b83\u4f60\u7684dfs\u5c31\u4f1a\u5728\u6839\u8282\u70b9\u548c\u4e00\u4e2a\u5b50\u6811\u4e0a\u53cd\u590d\u6a2a\u8df3 \n\t\t\tdfs(to[i],x);\n\t\t\tson[x]+=son[to[i]]%mo;//\u9012\u5f52\uff0c\u6c42\u51fa\u5176\u513f\u5b50\u7684\u5b50\u6811\u7684\u5927\u5c0f\u540e\u518d\u52a0\u4e0a\u53bb\uff0c \n\t\t}\n\t}\n}\nint getans(int p){\n\tint x,y=0,z=0;\n\tz=x=son[p];\n\tfor(int i=head[p];i;i=ne[i]){\n\t\tif(de[to[i]]<de[p]) continue;\n\t\ty=son[to[i]];\n\t\tz+=(long long)((x-y)*y)%mo;\n\t}\n\treturn z;\n}\nint main()\n{\n    read(n),read(r),read(m);\n    for(int i=1;i<n;i++){\n    \tint x,y;\n    \tread(x),read(y);\n    \tadd(x,y),add(y,x);\n\t}\n\tdfs(r,r);\n\tfor(int i=1;i<=n;i++) ans[i]=getans(i);\n\tfor(int i=1;i<=m;i++){\n\t\tint p;\n\t\tread(p);\n\t\tcout<<ans[p]<<endl;\n\t}\n\treturn 0;\n}\n\n```\n**~~\u5199\u9898\u89e3\u4e0d\u6613\uff0c\u70b9\u4e2a\u8d5e\u5457~~**\n\n\n\n\n\n",
        "postTime": 1573893165,
        "uid": 235658,
        "name": "llzzxx712",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "## \u9898\u89e3\n\n\u4f20\u9001\u95e8\uff1a[\u900f\u5f7b](https://www.cnblogs.com/ZAGER/p/9911398.html)\n\n\u770b\u5230\u8fd9\u662f\u6d1b\u8c37\u65b0\u51fa\u7684\u9898\uff0c\u770b\u7740\u6709\u70b9\u601d\u8def\u5c31\u505a\u4e86\u3002\n\n\u6211\u5728$dfs$\u65f6\u5c31\u9884\u5904\u7406\u51fa\u4e86$ans$\u6570\u7ec4\uff0c\u5373\u4e3a\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(max(n,m))$\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9$x$\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7b54\u6848\u5206\u6210\u8de8\u8fc7$x$\u7684\u548c\u6ca1\u6709\u8de8\u8fc7$x$\u7684\u65b9\u6848\u4e24\u90e8\u5206\u3002\n\n#### \u6ca1\u6709\u8de8\u8fc7x\u7684\u90e8\u5206\uff1a\n\n\u5f88\u663e\u7136\uff0c\u5176\u4e2d\u4e00\u4e2a\u70b9\u4e00\u5b9a\u662f$x$\uff0c\u6240\u4ee5\u8fd9\u90e8\u5206\u7684\u7b54\u6848\u4e3a$x$\u7684$siz$\u5927\u5c0f\u7684$2$\u500d$-1$\uff08\u56e0\u4e3a\u662f\u70b9\u5bf9\u5e76\u4e14(1,1)\u7b97\u4e00\u79cd\uff09\u3002\n\n\u5373$ans1=2*siz[x]-1$.\n\n#### \u8de8\u8fc7$x$\u7684\u90e8\u5206:\n\n\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u6240\u6709$x$\u7684\u513f\u5b50$son_i$\u7684$siz$\u5927\u5c0f\u76f8\u4e58\u5373\u4e3a\u8fd9\u90e8\u5206\u7684\u7b54\u6848\u3002\n\n\u8bbe$x$\u4e00\u5171\u6709$k$\u68f5\u5b50\u6811\u5373\n\n$$ans2=\\sum_{i=1}^{k}\\sum_{j=1}^{k}siz[son[i]]*siz[son[j]]$$\n$$=\\sum_{i=1}^{k}siz[son[i]]*(siz[x]-1)$$\n$$=(siz[x]-1)*(siz[x]-1)$$\n\n\u4f46\u662f\u6211\u4eec\u4f1a\u53d1\u73b0\u4e0d\u5bf9\uff0c\u56e0\u4e3a\u6211\u4eec\u7b97\u91cd\u4e86\u4e00\u90e8\u5206\uff0c\u5c31\u662f$(i==j)$\u7684\u90e8\u5206\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8fd8\u8981\u51cf\u53bb$\\sum_{i=1}^{k}siz[son[i]]^2$.\n\n\u6240\u4ee5$ans2=(siz[x]-1)^2-\\sum_{i=1}^{k}siz[son[i]]^2$\n\n#### \u7efc\u4e0a\uff1a\n\n$$Ans=ans1+ans2$$\n$$=2*siz[x]-1+(siz[x]-1)^2-\\sum_{i=1}^{k}siz[son[i]]^2$$\n$$=siz[x]^2-\\sum_{i=1}^{k}siz[son[i]]^2$$\n\n\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e0b\u6bcf\u4e2a\u70b9\u5b50\u6811\u7684$siz[son[i]]^2$\u7684\u548c\u5373\u53ef\u83b7\u5f97\u7b54\u6848\u3002\n\n#### \u5410\u69fd\u4e00\u53e5\uff1a\u8fd9\u9898Ans\u6700\u5927\u662f$N^2$\uff0c\u5c45\u7136\u8981\u53bb\u53d6\u6a21\u3002\u3002\u3002\u3002\n\n## code\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cctype>\n#include<cstring>\n#define N 10005\n#define R register\nusing namespace std;\ntemplate<typename T>inline void read(T &a){\n    char c=getchar();T x=0,f=1;\n    while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n    a=f*x;\n}\nint n,rt,m,tot,p;\nint siz[N],ans[N],h[N],sum[N];\nstruct node{\n    int nex,to;\n}edge[N<<1];\ninline void add(R int u,R int v){\n    edge[++tot].nex=h[u];\n    edge[tot].to=v;\n    h[u]=tot;\n}\ninline void dfs(R int x,R int f){\n    siz[x]=1;\n    for(R int i=h[x];i;i=edge[i].nex){\n        R int xx=edge[i].to;\n        if(xx==f)continue;\n        dfs(xx,x);\n        siz[x]+=siz[xx];\n        sum[x]+=siz[xx]*siz[xx];\n    }\n    ans[x]=siz[x]*siz[x]-sum[x];\n}\nint main(){\n    read(n);read(rt);read(m);\n    for(R int i=1,u,v;i<=n-1;i++)\n        read(u),read(v),add(u,v),add(v,u);\n    dfs(rt,0);\n    while(m--){\n    \tread(p);\n    \tprintf(\"%d\\n\",ans[p]);\n    }\n    return 0;\n} \n```\n\n",
        "postTime": 1541421907,
        "uid": 87967,
        "name": "ZAGER",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u5148\u6765\u8003\u8651\u4e00\u4e0b\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b $x, y$ \u7684 LCA \u662f $k$ \u3002\n1. $x, y$ \u4e2d\u6709\u4e00\u4e2a\u4e3a $k$, \u53e6\u4e00\u4e2a\u5728 $k$ \u6240\u5728\u7684\u5b50\u6811\u5185\u3002\n1. $x, y$ \u5c5e\u4e8e $k$ \u7684\u4e24\u4e2a\u4e0d\u540c\u7684\u513f\u5b50\u6240\u5728\u7684\u5b50\u6811\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c $k$ \u6240\u5728\u7684\u5b50\u6811\u5927\u5c0f\u4e58\u4ee5 $2$ \u518d\u51cf\u53bb $1$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c $k$ \u7684\u6240\u6709\u513f\u5b50\u6240\u5728\u7684\u5b50\u6811\u5927\u5c0f\u4e24\u4e24\u76f8\u4e58\uff0c\u8fd9\u4e00\u6b65\u53ef\u4ee5\u901a\u8fc7\u524d\u7f00\u548c\u4f18\u5316\uff0c~~\u5176\u5b9e\u4e0d\u4f18\u5316\u4e5f\u884c\u53cd\u6b63 $O (n^2)$ \u4e5f\u80fd\u8fc7~~\u3002\n\n\u6ce8\u610f\u4e00\u4e0b $x, y$ \u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u8981\u4e58\u4ee5 $2$\u3002\n\n\u7136\u540e\u5c31\u6ca1\u6709\u7136\u540e\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define _ 10010\n#define mod 1000000007\nusing namespace std;\nint n, r, m, a, b;\nint siz[_], cnt[_];\nvector<int> G[_];\nvoid dfs(int x, int f) {\n\tfor (int i = 0; i < G[x].size(); i++) {\n\t\tif (G[x][i] != f) {\n\t\t\tdfs(G[x][i], x);\n\t\t\tcnt[x] = (cnt[x] + 1ll * siz[x] * siz[G[x][i]]) % mod;\n\t\t\tsiz[x] += siz[G[x][i]];\n\t\t}\n\t}\n\tcnt[x] = (cnt[x] + siz[x]) % mod;\n\tcnt[x] = cnt[x] * 2 % mod;\n\tsiz[x]++;\n\tcnt[x]++;\n}\nint main() {\n\tcin >> n >> r >> m;\n\tfor (int i = 1; i < n; i++) {\n\t\tcin >> a >> b;\n\t\tG[a].push_back(b);\n\t\tG[b].push_back(a);\n\t}\n\tdfs(r, 0);\n\twhile (m--) {\n\t\tcin >> r;\n\t\tcout << cnt[r] << endl;\n\t}\n\treturn 0;\n}\n```\n\u7801\u98ce\u5947\u4e11\n\n$\\color{white}{\\texttt{\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\uff0c\u6c42\u8fc7QWQ}}$",
        "postTime": 1613225545,
        "uid": 153422,
        "name": "0x3F",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u6765\u5199\u4e00\u7bc7\u6bd4\u8f83\u5bb9\u6613\u770b\u61c2\u7684\u9898\u89e3\u3002\n\n---\n\u6211\u4eec\u8fd8\u662f\u5148\u5c06\u4e00\u4e0b\u7b97\u6cd5\u7684\u6b65\u9aa4\uff0c\u5f85\u4f1a\u518d\u89e3\u91ca\u8d77\u6765\u65b9\u4fbf\u4e00\u70b9\u3002\n\n## \u7b97\u6cd5\u6b65\u9aa4\n\u9996\u5148\u6211\u4eec\u7b97\u51fa\u6bcf\u4e2a\u5b50\u6811\u7684$size$\u3002\n\n\u6211\u4eec\u5c31\u8bbe\u5f53\u524d\u8bbf\u95ee\u7684\u8282\u70b9\n\n\u7136\u540e\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u5f53\u524d\u8fd9\u4e2a\u8282\u70b9\u7684\u7b54\u6848\u662f\u8fd9\u4e2a\u6811\u6574\u4e2a\u7684$size$\u7684\u4e24\u500d$-1$\uff0c\u518d\u52a0\u4e0a\u4e24\u4e24\u5b50\u6811\u7684$size$\u7684\u79ef\u3002\n\n\u4e5f\u5c31\u662f$ans=size[u] \\times 2 - 1 +\\sum size[i] * size[j] $\n\n\u5176\u4e2d$i$\u548c$j$\u662fu\u7684\u513f\u5b50\u3002\n\n----\n\n\u4e00\u4e0b\u5c31\u662f\u6838\u5fc3\u4ee3\u7801\uff1a\n```cpp\nregister LL ans = sz[p] * 2 - 1;\nfor (Ri i = head[p] ; i ; i = edge[i].next) \n{\n     if ( edge[i].to == fa[p]) continue;\n     sz_rest = sz[p] - sz[edge[i].to] - 1 ;\n     ans = (ans + (sz_rest *  sz[edge[i].to]  ) ) % Mod;\n}\n```\n\n---\n\n## \u89e3\u91ca\u4e00\u4e0b\n\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u660e\u767d\uff0c\u5982\u679c\u8981\u4ee5\u5f53\u524d\u8fd9\u4e2a\u8282\u70b9\u4e3a$LCA$\u7684\u8bdd\uff0c\u90a3\u4e48\u4e24\u4e2a\u8282\u70b9\u5fc5\u987b\u4e0d\u80fd\u662f\u662f\u8fd9\u4e2a\u5f53\u524d\u8fd9\u4e2a\u8981\u67e5\u8be2\u7684\u8282\u70b9\u7684\u7236\u4eb2\uff0c\u8fd9\u4e2a\u5e94\u8be5\u6ca1\u6709\u95ee\u9898\u3002\n\n\u90a3\u4e48\u8fd9\u4e24\u4e2a\u8282\u70b9\u5fc5\u987b\u662f\u5728\u5f53\u524d\u67e5\u8be2\u8282\u70b9\u4e0a\uff0c\u6216\u8005\u662f\u5728\u8fd9\u4e2a\u8282\u70b9\u7684**\u4e0d\u540c**\u5b50\u6811\u4e2d\u3002\uff08**\u6ce8\uff1a\u8fd9\u4e2a\u4e00\u5b9a\u662f\u8981\u5728\u4e0d\u540c\u7684\u5b50\u6811\u4e2d\uff0c\u4e0d\u7136$LCA$\u5c31\u4f1a\u662f\u5728\u8fd9\u4e2a\u5b50\u6811\u5f53\u4e2d\uff0c\u800c\u4e0d\u662f\u5f53\u524d\u7684\u8282\u70b9**\uff09\n\n\u90a3\u4e48\u6211\u4eec\u8981\u8003\u8651\u4e24\u79cd\u60c5\u51b5\n\n* \u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u70b9\u662f\u6211\u4eec\u8981\u8bbf\u95ee\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u70b9\u5c31\u53ef\u4ee5\u662f\u8fd9\u4e2a\u8fd9\u68f5\u5b50\u6811\u4e2d\u4efb\u610f\u7684\u70b9\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u4e24\u4e2a\u7ec6\u8282\uff0c\u8fd9\u4e9b\u70b9\u5bf9\u662f\u6709\u987a\u5e8f\u7684\uff0c\u6240\u4ee5\u7b54\u6848\u9700\u8981$\\times 2$\uff0c\u7b2c\u4e8c\u4e2a\u7ec6\u8282\u662f\u6211\u4eec\u8981\u6ce8\u610f\u6839\u8282\u70b9\u662f\u53ea\u7b97\u4e00\u6b21\u7684\uff0c\u56e0\u4e3a\u76f8\u540c\u7684\u70b9\u653e\u524d\u653e\u540e\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53ea\u7b97\u4e00\u79cd\u3002\n\n* \u5982\u679c\u4e24\u4e2a\u70b9\u662f\u5728\u4e0d\u540c\u7684\u5b50\u6811\u4e2d\uff0c\u90a3\u4e48\u4e00\u68f5\u5b50\u6811\u4e2d\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u4e00\u5b9a\u53ef\u4ee5\u548c\u53e6\u5916\u4e00\u8bfe\u5b50\u6811\u4e2d\u7684\u4efb\u610f\u4e00\u70b9\u76f8\u7ec4\u6210\u4e00\u4e2a\u5408\u6cd5\u7684\u70b9\u5bf9\uff0c\u90a3\u4e48\u5c31\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u5c06\u8fd9\u4e9b\u5b50\u6811\u4e2d\u7684\u8282\u70b9\u6570\u76f8\u4e58\u5728\u76f8\u52a0\u5c31\u662f\u6211\u4eec\u5f97\u5230\u7684\u7b54\u6848\u4e86\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u7b54\u6848\u5440\uff0c\u7b54\u6848\u5c31\u662f\u4e0a\u6587\u4e2d\u6240\u63d0\u5230\u7684$ans=size[u] \\times 2 - 1 +\\sum size[i] * size[j] $\n\n----\n\u4ee5\u4e0b\u662f\u4ee3\u7801\uff0c\u4f46\u662f\u662f\u9519\u7684\uff0c\u4f1aTLE\u4e00\u4e2a\u70b9\u3002\n\n```cpp\n# include <bits/stdc++.h>\n# define Ri register int\n# define for1(i,a,b) for (Ri i(a) ; i <= b; i++ )\n# define for2(i,a,b) for (Ri i(a) ; i >= b; i-- )\n\nusing namespace std;\n\ntypedef long long LL;\n\nconst int Mod = 1e9 + 7;\nconst int Maxn = 50005;\n\nstruct Edge {\n    int to , next ;\n} edge[Maxn<<1] ;\n\nint head[Maxn<<1];\nint sz[Maxn], fa[Maxn];\nint root, n ,m , Nedge;\n\ninline int read ()\n{\n    int w = 0,x = 0; char ch = 0;\n    while ( !isdigit(ch) ) { w |= ch == '-'; ch = getchar() ; }\n    while ( isdigit(ch) ) { x = (x<<1) + (x<<3) + (ch^48); ch = getchar() ; }\n    return w ? -x : x ;\n}\n\ninline void Add_Edge (int u, int v) \n{\n    edge[Nedge] = (Edge) {v , head[u]};\n    head[u] = Nedge++;\n}\n\ninline void dfs (int u , int fat) \n{\n    fa[u] = fat;\n    sz[u] = 1;\n    for (int i = head[u] ; i != -1; i = edge[i].next )\n    {\n        int v = edge[i].to;\n        if ( v == fa[u] ) continue;\n        dfs (v ,u );\n        sz[u] += sz[v];\n    }\n}\n\nint main ()\n{\n    memset( head, -1 ,sizeof(head) );\n    n = read(), root = read(), m = read();\n    for1 (i , 1 , n-1) \n    {\n        int u = read(),v = read();\n        Add_Edge(u, v);  Add_Edge(v, u);\n    }\n    dfs (root , -1);\n    for1 (T ,1 , m ) \n    {\n        int p = read(); \n        LL ans = sz[p] * 2 - 1;\n        for (int i = head[p] ; i != -1 ; i = edge[i].next) \n        {\n            for (int j = head[p] ; j != -1 ; j = edge[j].next) \n            {\n                if (i == j || edge[i].to == fa[p] || edge[j].to == fa[p]) continue;\n                ans = (ans + sz[edge[i].to] * sz[edge[j].to]) % Mod;\n            }\n        }\n        printf (\"%lld\\n\", ans);\n    }\n    return 0 ;\n}\n\n```\n\u7528\u5c3d\u4e86\u5361\u5e38\u6280\u5de7\uff0c\u90fd\u6ca1\u6cd5A\u6389\u6700\u540e\u4e00\u4e2a\u70b9\uff0c\u4e3a\u4ec0\u4e48\uff1f\n\n\u56e0\u4e3a\u6700\u540e\u4e00\u4e2a\u70b9\u592a\u5927\u4e86\uff0c\u5982\u679c\u6309\u7167\u6211\u4eec\u7684\u505a\u6cd5\uff0c\u662f$O(n^3+n^2+ m + n)$\u7684\u590d\u6742\u5ea6\uff0c\u8fd9\u6837\u5b9e\u5728\u662f\u592a\u4e0d\u4f18\u7f8e\u4e86\u3002\n\n\u6211\u4eec\u6765\u60f3\u4e00\u60f3\u4f18\u5316\u3002\n\n\u5176\u5b9e\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u679a\u4e3e\u4e24\u4e2a\u513f\u5b50\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u6709\u4e00\u4e2a\u7236\u4eb2\u6ca1\u6709\u7528\u5230\uff0c\u56e0\u4e3a\u4efb\u610f\u4e00\u4e2a\u513f\u5b50\u9700\u8981$\\times$\u4e0d\u5c5e\u4e8e\u8fd9\u4e2a\u5b50\u6811\u7684\u8282\u70b9\u7684\u6570\u91cf\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u91cf\u5c31\u662f\u7236\u4eb2\u7684$size-$\u513f\u5b50$size-1$\u3002**$-1$\u662f\u51cf\u53bb\u7236\u4eb2\u7684\u8282\u70b9**\n\u90a3\u4e48\u4e5f\u5c31\u662f\u4f18\u5316\u6210$O(2\\times n^2 + n + m)$\n\n\u5176\u5b9e\u4e5f\u5c31\u662f\u4f18\u5316\u4e86\u4e3b\u7a0b\u5e8f\u7684\u4e00\u5c0f\u90e8\u5206\u3002\n```cpp\nfor1 (T ,1 , m ) \n    {\n        register int p = read() ;\n        register int sz_rest; \n        register LL ans = sz[p] * 2 - 1;\n        for (Ri i = head[p] ; i != -1 ; i = edge[i].next) \n        {\n            if ( edge[i].to == fa[p]) continue;\n            sz_rest = sz[p] - sz[edge[i].to] - 1 ;\n            ans = (ans + (sz_rest *  sz[edge[i].to]  ) ) % Mod;\n        }\n        printf (\"%lld\\n\", ans);\n    }\n```\n\u4f46\u662f\u8fd8\u662f\u505a\u4e0d\u4e86\uff0c\u8fd8\u662f\u4f1aT\u6389\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u66f4\u52a0\u725b\u903c\u7684\u4f18\u5316\u4e86\uff0c\u56e0\u4e3a\u7b54\u6848\u4e0d\u5927\uff0c\u6211\u4eec\u5c31\u7528\u4e00\u4e2a\u6876\u8bb0\u5f55\u8fd9\u4e2a\u7b54\u6848\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u628a\u8d85\u5927\u7684$m$\u7f29\u5c0f\u6210\u4e86$n$\u4e86\uff0c\u8fd9\u6837\u6211\u5c31\u521a\u597d\u8fc7\u6389\u4e86\uff0c\u800c\u4e14\u901f\u5ea6\u8001\u5feb\u60f9QAQ\uff01\n\n----\n\u4ee5\u4e0b\u662f\u6b63\u89e3\u4ee3\u7801\n```cpp\n# include <cstdio>\n# include <cstring>\n# include <ctype.h>\n# define Ri register int\n# define for1(i,a,b) for (Ri i(a) ; i <= b; i++ )\n# define for2(i,a,b) for (Ri i(a) ; i >= b; i-- )\n\nusing namespace std;\n\ntypedef long long LL;\n\nconst int Mod = 1e9 + 7;\nconst int Maxn = 50005;\n\nstruct Edge {\n    int to , next ;\n} edge[Maxn<<1] ;\n\nint head[Maxn<<1];\nint sz[Maxn], fa[Maxn];\nint root, n ,m , Nedge;\nLL Ans[Maxn];\n\ninline int read ()\n{\n    int w = 0,x = 0; char ch = 0;\n    while ( !isdigit(ch) ) { w |= ch == '-'; ch = getchar() ; }\n    while ( isdigit(ch) ) { x = (x<<1) + (x<<3) + (ch^48); ch = getchar() ; }\n    return w ? -x : x ;\n}\n\ninline void Add_Edge (int u, int v) \n{\n    edge[Nedge] = (Edge) {v,head[u]};\n    head[u] = Nedge++;\n}\n\ninline void dfs (int u , int fat) //\u8ba1\u7b97size\uff0c\u5e76\u6807\u8bb0\u7236\u4eb2\n{\n    fa[u] = fat; sz[u] = 1;\n    for (Ri i = head[u] ; i ; i = edge[i].next )\n    {\n        int v = edge[i].to;\n        if ( v == fa[u] ) continue;\n        dfs (v ,u );\n        sz[u] += sz[v];//\u7d2f\u52a0size\n    }\n}\n\nint main ()\n{\n    n = read(), root = read(), m = read(); Nedge=1;\n    for1 (i , 1 , n-1) \n    {\n        int u = read(), v = read();\n        Add_Edge(u, v);  Add_Edge(v, u);\n    }\n    dfs (root , -1);\n    for1 (T ,1 , m ) \n    {\n        register int p = read() ;\n        if ( Ans[p] != 0 ) {printf(\"%lld\\n\", Ans[p] ); continue; } //\u5982\u679c\u5f53\u524d\u7684\u7b54\u6848\u5df2\u7ecf\u7b97\u8fc7\u4e86\uff0c\u76f4\u63a5\u8f93\u51fa\n        register int sz_rest; //\u8868\u793a\u5269\u4e0b\u7684\n        register LL ans = sz[p] * 2 - 1; //\u7b97\u7b2c\u4e00\u90e8\u5206\u7684\u7b54\u6848\n        for (Ri i = head[p] ; i ; i = edge[i].next) \n        {\n            if ( edge[i].to == fa[p]) continue;\n            sz_rest = sz[p] - sz[edge[i].to] - 1 ;//\u7b97\u7b2c\u4e8c\u90e8\u5206\u7684\u7b54\u6848\u3002\n            ans = (ans + (sz_rest *  sz[edge[i].to]  ) ) % Mod;//\u7d2f\u52a0\u7b54\u6848\n        }\n        Ans[p] = ans ;\n        printf (\"%lld\\n\", ans);\n    }\n    return 0 ;\n}\n```",
        "postTime": 1541426856,
        "uid": 35567,
        "name": "Ayers",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u672c\u9898\u53d7[P1351 \u8054\u5408\u6743\u503c](https://www.luogu.org/problemnew/show/P1351)\u542f\u53d1\u800c\u51fa\uff0c\u6570\u636e\u6781\u6c34\n\n## $5pts~~$  $!CE$\n\n\u4eba\u53e3\u666e\u67e5\u5206\n\n## $85pts$ \u66b4\u529b......\n\n\u5b9e\u5728\u662f\u6570\u636e\u6c34\uff0c\u60f3\u5361$O(n^2*log~n*m)$\u7684\u66b4\u529b\u4f46\u662f\u4e0d\u4f1a\u2026\u2026\n\n\u76f4\u63a5\u66b4\u529b\u679a\u4e3e$(u,v)$\uff0c\u6811\u5256\u6c42$LCA$\uff0c(\u6ca1\u8bd5\u8fc7\u500d\u589e)\uff0c\u7136\u540e\u5c31\u6ca1\u6709\u7136\u540e\u4e86\n\n\u4e0d\u4f1a\u6c42$LCA?$\u8bf7\u79fb\u6b65[\u6a21\u677f](https://www.luogu.org/problemnew/show/P3379)\uff0c\u91cc\u9762\u6709\u5f88\u591a\u4f18\u8d28\u7684\u9898\u89e3\uff01\n\n## $85pts$ \u7b80\u5355\u6570\u5b66\u4f18\u5316 (~~\u4f60\u6ca1\u770b\u9519\u8fd8\u662f85pts~~)\n\n\u4ee5\u6837\u4f8b\u4e3a\u4f8b![](https://cdn.luogu.com.cn/upload/pic/37971.png)\n\n\u8be2\u95ee\u70b9$1$\uff0c\u4e3a\u4ec0\u4e48\u7b54\u6848\u662f$31$\u5462\uff1f(\u4ee5\u4e0b$size$\u6307\u5b50\u6811\u5927\u5c0f\uff08\u5305\u62ec\u8282\u70b9\u672c\u8eab\uff09)\n\n1. \u70b9$1$ \u6709 $2$\u68f5\u5b50\u6811\uff0c\u4e24\u68f5\u5b50\u6811\u7684$size$\u5206\u522b\u4e3a$3,3~~~$ \u4e58\u6cd5\u539f\u7406\u53ef\u5f97 $ans+=3*3*2$\uff08$*2$\u662f\u56e0\u4e3a$(u,v)$\u53ef\u4ee5\u53cd\u8fc7\u6765\u53d8\u6210$(v,u)$\uff09\n\n2. \u70b9$1$ \u7684 $size$ \u4e3a $8$ $~~~\\therefore ans+=8*2-1~~~~~~$ ($-1$\u662f\u56e0\u4e3a$(1,1)$\u88ab\u91cd\u590d\u8ba1\u7b97\u4e86)\n\n\u5982\u679c\u8be2\u95ee\u7684\u70b9$P_i$\u6709$k$\u68f5\u5b50\u6811\uff0c\u5e76\u4e14\u5b50\u6811$size$\u5206\u522b\u4e3a$a_i$\uff0c\u90a3\u4e48$ans=(\\sum^k_{i=1}\\sum^k_{j=1}a_i*a_j)-\\sum^k_{i=1} (a_i)^2+size_{P_i}*2-1$\n\n\u5de6\u8fb9\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5$O(k)$\u6c42\u51fa\u6765\uff0c\u4e0d\u5c31\u7528**\u5b8c\u5168\u5e73\u65b9\u516c\u5f0f\u641e\u4e00\u4e0b**\u5417\uff1f\n\n```cpp\nlong long solve(long long now) {\n    long long sigma=0,chengji=0;\t//sigma\u662f\u76f8\u52a0\u7684\u548c\n    //chengji\u662f\u5e73\u65b9\u548c\n    for(register long long i=head[now]; i; i=h[i].next) { //\u679a\u4e3e\u513f\u5b50\n        long long d=h[i].node;\n        if(d==fa[now]) continue;\t//\u4e0d\u80fd\u679a\u4e3e\u7236\u4eb2\u8282\u70b9\u9e2d\n        sigma+=son[d];\n        sigma%=mod;\n        chengji+=son[d]*son[d];\n        chengji%=mod;\n    }\n    return (son[now]*2%mod-1+sigma*sigma%mod-chengji+mod)%mod;\n    //\u5c0f\u5fc3\u51fa\u73b0\u8d1f\u6570\uff01\n}\n```\n## $100pts$ \u5b58\u50a8\u91cd\u590d\u7b54\u6848\n\n\u5f53\u60a8\u53d1\u73b0$M>N$\u65f6\uff0c\u60a8\u5c31\u5e94\u8be5\u60f3\u5230\u8fd9\u4e00\u70b9\uff01\n\n## $STD$\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#define maxn (100000+3)\n#define mod (1000000007)\n\nlong long head[maxn],tot;\nstruct edge {\n    long long node,next;\n} h[maxn<<1];\nvoid addedge(long long u,long long v) {\n    h[++tot].next=head[u];\n    head[u]=tot;\n    h[tot].node=v;\n}\nlong long n,r,m;\nlong long son[maxn],fa[maxn],ans[maxn];\nvoid dfs(long long now,long long f) {\t//\u6811\u5256\u5e38\u89c4\u64cd\u4f5c\uff0c\u9884\u5904\u7406size,fa,son\n    fa[now]=f;\n    son[now]=1;\n    for(register long long i=head[now]; i; i=h[i].next) {\n        long long d=h[i].node;\n        if(d==f) continue;\n        dfs(d,now);\n        son[now]+=son[d];\n    }\n}\nlong long solve(long long now) {\n\tif(ans[now])\treturn ans;\n    long long sigma=0,chengji=0;\n    for(register long long i=head[now]; i; i=h[i].next) {\n        long long d=h[i].node;\n        if(d==fa[now]) continue;\n        sigma+=son[d];\n        sigma%=mod;\n        chengji+=son[d]*son[d];\n        chengji%=mod;\n    }\n    return ans[now]=(son[now]*2%mod-1+sigma*sigma%mod-chengji+mod)%mod;\n}\nint main() {\n    scanf(\"%lld%lld%lld\",&n,&r,&m);\n    for(register long long i=1,u,v; i<n; ++i) {\n        scanf(\"%lld%lld\",&u,&v);\n        addedge(u,v);\n        addedge(v,u);\n    }\n    dfs(r,0);\n    for(register long long i=1,p; i<=m; ++i) {\n        scanf(\"%lld\",&p);\n        printf(\"%lld\\n\",solve(p));\n    }\n    return 0;\n}\n```\n",
        "postTime": 1541395083,
        "uid": 47863,
        "name": "Imakf",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u9898\u76ee\u601d\u8def\uff1a\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u53bb\u627e\u4ee5\u5b83\u4e3alca\u7684\u8282\u70b9\u5bf9\u6570\n\n\u800c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u603b\u5171\u53ea\u6709\u4e09\u5f20\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u5f97\u9009\u5b9a\u7684\u4e24\u4e2a\u70b9\u7684lca\u4e3a\u8fd9\u4e00\u4e2a\u70b9\u3002\n\n1. \u4e24\u4e2a\u70b9\u5728\u5b83\u7684\u4e24\u68f5\u4e0d\u540c\u5b50\u6811\u4e0a\n\t\n   \u5982\u56fe,5\u548c4\u7684lca\u662f1\n\n   ![](https://cdn.luogu.com.cn/upload/image_hosting/04c7moyr.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n1. \u4e00\u4e2a\u70b9\u662f\u4ed6\u672c\u8eab\uff0c\u53e6\u4e00\u4e2a\u70b9\u5728\u4ed6\u7684\u4e00\u9897\u5b50\u6811\u4e0a\n\t\n   \u5982\u56fe\uff0c1\u548c5\u7684lca\u662f1\n   \n   ![](https://cdn.luogu.com.cn/upload/image_hosting/kfwr44h1.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n1. \u4e24\u4e2a\u70b9\u90fd\u662f\u4ed6\u672c\u8eab\uff0c\u8fd9\u91cc\u61d2\u5f97\u653e\u56fe\n\n\u8fd9\u91cc\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u5f55\u4e0b\u4ee5\u4ed6\u4e3a\u6839\u7684\u5b50\u6811\u7684\u7ed3\u70b9\u4e2a\u6570\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd0\u7b97\u6c42\u51fa\u7b54\u6848\u4e86\u3002\n\n\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n//u\u662f\u5f53\u524d\u8282\u70b9\uff0cv\u662f\u5b83\u7684\u513f\u5b50\nfor(int i=1;i<=n;i++){\n\tint u=i;\n\tfor(int j=head[u];j;j=edge[j].next){\n\t\tint v=edge[j].to;\n\t\tif(fa[u]==v)continue;\n\t\tans[u]+=(size[u]-size[v])*size[v];\n\t\tans[u]%=10000000007;\n\t}\t\n\tans[u]=(ans[u]+size[u])%10000000007;\t\t\t\n}\n```\n\n\u7136\u540e\u5c31\u53ef\u4ee5AC\u4e86\n\n\u4e0a\u5b8c\u6574\u4ee3\u7801\uff08~~\u5927\u5bb6\u6700\u5173\u6ce8\u7684\u5730\u65b9~~\uff09\n```\n#include<bits/stdc++.h> \nusing namespace std;\nconst int N=100005;\nstruct Edge{\n\tint next,to;\n}edge[N*2];\nint head[N],en,size[N];\nvoid add(int u,int v){\n\tedge[++en].next=head[u];\n\thead[u]=en;\n\tedge[en].to=v;\n\treturn;\n}\nint fa[N],n,r,m;\nlong long ans[N];\nvoid dfs(int u){\n\tsize[u]=1; \n\tfor(int i=head[u];i;i=edge[i].next){\n\t\tint v=edge[i].to;\n\t\tif(fa[u]!=v){\n\t\t\tfa[v]=u;\n\t\t\tdfs(v);\n\t\t\tsize[u]+=size[v];\n\t\t}\n\t}\n\treturn; \n}\nint main(){\n\tcin>>n>>r>>m;\n\tfor(int i=1;i<n;i++){\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tdfs(r);\n\tfor(int i=1;i<=n;i++){\n\t\tint u=i;\n\t\tfor(int j=head[u];j;j=edge[j].next){\n\t\t\tint v=edge[j].to;\n\t\t\tif(fa[u]==v)continue;\n\t\t\tans[u]+=(size[u]-size[v])*size[v];\n\t\t\tans[u]%=10000000007;\n\t\t}\t\n\t\tans[u]=(ans[u]+size[u])%10000000007;\t\t\t\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tint u;\n\t\tscanf(\"%d\",&u);\n\t\tprintf(\"%lld\\n\",ans[u]);\n\t}\n\treturn 0;\n}\n```\n\u611f\u8c22[Graph Editor](https://csacademy.com/app/graph_editor/)\u63d0\u4f9b\u7684\u753b\u56fe\u652f\u63f4",
        "postTime": 1593264519,
        "uid": 181521,
        "name": "\u73c8\u4e50\u552f\u6bd2",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u4e00\u9053\u6a59\u9898\uff1f\u6076\u8bc4\uff1f\n\n### \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u51fa\u4e00\u4e2a\u6811\u548c\u5176\u6839\u8282\u70b9\n\n\u7136\u540e\u6709 $M$ \u4e2a\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u90fd\u6709\u4e00\u4e2a\u6570 $P$ \n\n\u6c42\u8fd9\u9897\u6811\u4e2d\u6709\u591a\u5c11\u5bf9\u8282\u70b9\u7684 LCA \u662f $P$\n\n### \u601d\u8def\n\n\u5f88\u7b80\u5355\u7684\u4e00\u9053\u6811\u7684\u904d\u5386\u9898\n\n\u9996\u5148\u89c2\u5bdf\u6570\u636e\u8303\u56f4 $1 \\le N \\le 10^4 ,1 \\le M \\le 5 \\times 10^4$ \n\n\u663e\u7136\uff0c\u666e\u901a\u7684\u66b4\u529b\u6c42 LCA  \u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u4f1a\u8d85\u65f6\n\n\u8fd9\u4e2a\u65f6\u5019\u89c2\u5bdf\u6570\u636e\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bcf\u4e2a\u8be2\u95ee\u7684\u7b54\u6848\u90fd\u4e0e $P_i$ \u7684\u5404\u4e2a\u5b50\u6811\u548c\u76f8\u5173\n\n\u5982\u679c\u60a8\u6709\u4e00\u4e9b\u5c0f\u5b66\u5965\u6570\u7684\u77e5\u8bc6\uff0c\u4f7f\u7528\u6392\u5217\u7ec4\u5408\u7684\u77e5\u8bc6\u5c31\u53ef\u4ee5\u8f7b\u677e\u89e3\u51b3\u6b64\u9898\n\n\u624b\u73a9\u6837\u4f8b\uff0c\u5f88\u5bb9\u6613\u770b\u51fa\uff0c\u7b54\u6848\u5c31\u662f $ \\sum\\limits_{i=1}^{P_n} \nsize_{P_i} \\cdot (size_P - size_{P_i} ) $ \u5176\u4e2d $P_n$ \u8868\u793a\u8282\u70b9 $P$ \u7684\u5b50\u6811\u4e2a\u6570\uff0c$size_x$ \u8868\u793a\u4ee5\u8282\u70b9 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u8282\u70b9\u548c\n\n$85pts$ \u6570\u5b66\u7b97\u6cd5\u8d85\u65f6\u7684\u540c\u5b66 \u6ce8\u610f\uff1a\u8fd9\u91cc $N \\le M$ ,\u6240\u4ee5\u5fc5\u987b\u91c7\u7528\u8bb0\u5fc6\u5316\u8282\u7ea6\u65f6\u95f4\n\n### \u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <vector>\nusing namespace std;\n#define MAX_N 100010\nstruct tree{\n    vector<int> next;\n}node[MAX_N];\nlong long son_tree[MAX_N],answer[MAX_N];\nint dfs_tree(int now,int fa){\n    int ans = 0,x = 1;\n    for(int i = 0;i < node[now].next.size();i++){\n        int v = node[now].next[i];\n        if(v != fa)\n            ans += dfs_tree(v,now),x = 0;\n    }\n    if(x == 1){\n        son_tree[now] = 1;\n        return 1;\n    }\n    son_tree[now] = ans + 1;\n    return son_tree[now];\n}\nint main() {\n    int n,r,m;\n    cin >> n >> r >> m;\n    for(int i = 1;i < n;i++){\n        int u,v;\n        cin >> u >> v;\n        node[u].next.push_back(v);\n        node[v].next.push_back(u);\n    }\n    dfs_tree(r,-1);\n    for(int i = 1;i <= m;i++){\n        int q,ans = 0;\n        cin >> q;\n        if(answer[q] != 0){\n            cout << answer[q] << endl;\n            continue;\n        }\n        for(int i = 0;i < node[q].next.size();i++){\n            int v = node[q].next[i];\n            if(son_tree[v] < son_tree[q])\n                ans += son_tree[v] * (son_tree[q] - son_tree[v]);\n        }\n        answer[q] = (ans + son_tree[q]) % 1000000007;\n        cout << answer[q] << endl;\n    }\n\n    return 0;\n}\n\n```\n\n### \u540e\u8bb0\n\n$Updata \\ 2020.11.16 \\ $ \u5b8c\u6210\u9898\u89e3",
        "postTime": 1605535786,
        "uid": 355559,
        "name": "FutureThx",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u7136\u800c\u8fd9\u9053\u9898\u548cLCA\u5e76\u6ca1\u6709\u4ec0\u4e48\u5173\u7cfb\u3002\u3002\u3002\n\n\u8fd9\u9053\u9898\u6709\u70b9\u50cf\u5c0f\u5b66\u65f6\u5b66\u7684\u6392\u5217\u7ec4\u5408\n\n\u62ff\u6837\u4f8b\u6765\u8bf4\uff0cP=1\u65f6\uff0c\u6709\u5de6\u53f3\u4e24\u9897\u5b50\u6811\uff0c\u4ece\u6bcf\u9897\u5b50\u6811\u4e2d\u9009\u51fa\u4e00\u4e2a\u70b9\uff0c\u4ed6\u4eec\u7684LCA\u5c31\u662fP\uff0c\u70b9P\u548c\u4efb\u4f55\u4e00\u4e2a\u5b83\u7684\u5b50\u8282\u70b9\u7684LCA\u90fd\u662fP\uff0c\u603b\u517131\u7ec4\uff08\u4e0d\u8981\u5fd8\u4e86u,v\u53ef\u4ee5\u4e92\u6362\uff09\n\n\u4e00\u822c\u60c5\u51b5\uff1a\u82e5P\u7684\u6240\u6709\u5b50\u6811\u7684\u8282\u70b9\u6570\u5206\u522b\u4e3aq1,q2,...,qk\uff0c\u5219P\u4e00\u5171\u6709s=q1+q2+...+qk+1\u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u603b\u5171\u6709(s-1)^2-q1^2-q2^2-...-qk^2+s*2-1\u7ec4(u,v)\n\n\u90a3\u4e48\u6211\u4eec\u7528sum[i]\u8bb0\u5f55i\u8282\u70b9\u7684\u5b50\u8282\u70b9\uff08\u5305\u62eci\uff09\u4e2a\u6570\uff0c\u7528ans[i]\u8bb0\u5f55P=i\u65f6\u6709\u591a\u5c11\u7ec4(u,v)\uff0c\u7136\u540e\u7528dfs\u904d\u5386\u4e00\u904d\u5c31\u53ef\u4ee5\u4e86\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\nusing namespace std;\n\nconst int MAXN=10005;\nstruct node{\n\tint v;//\u90bb\u63a5\u8868\u5b58\u56fe\n\tnode*next;\n}*h[MAXN],pool[MAXN<<1];\nint sum[MAXN],ans[MAXN],n,r,m,a,b,tot=0;\n\nvoid addedge(int u,int v){\n\tnode*p=&pool[++tot];\n\tp->v=v;p->next=h[u];h[u]=p;\n}\n\nvoid dfs(int u,int f){\n\tsum[u]=1;ans[u]=0;//sum\u521d\u59cb\u503c\u4e3a1\n\tfor(node*p=h[u];p!=NULL;p=p->next){\n\t\tif(p->v!=f){\n\t\t\tdfs(p->v,u);//\u5411\u4e0b\u904d\u5386\n\t\t\tsum[u]+=sum[p->v];//\u8bb0\u5f55sum\n\t\t}\n\t}\n\tfor(node*p=h[u];p!=NULL;p=p->next){\n\t\tif(p->v!=f){\n\t\t\tans[u]+=sum[p->v]*(sum[u]-sum[p->v]-1);\n\t\t}\n\t}//\u6c42ans\n\tans[u]=ans[u]+sum[u]*2-1;\n}\n\nint main(){\n\tcin>>n>>r>>m;\n\tfor(int i=1;i<n;i++){\n\t\tcin>>a>>b;\n\t\taddedge(a,b);\n\t\taddedge(b,a);\n\t}\n\tdfs(r,0);\n\tfor(int i=1;i<=m;i++){\n\t\tcin>>a;\n\t\tcout<<ans[a]<<endl;\n\t}\n\treturn 0;\n}\n```\n\u56e0\u4e3a\u6211\u592a\u5f31\u4e86\uff0c\u6240\u4ee5\u6709\u4ec0\u4e48\u7528\u8bcd\u4e0d\u5f53\u7684\u5730\u65b9\u8bf7\u5e2e\u6211\u6539\u6b63\uff0c\u8c22\u8c22\u3002",
        "postTime": 1546516229,
        "uid": 89929,
        "name": "wanghanjun",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u91cd\u70b9\u662f\u6811\u7684\u904d\u5386\u3002    \n\u56e0\u4e3a\u4ed6\u8ba9\u4f60\u6c42LCA\u4e3a\u6539\u70b9\u7684\u70b9\u5bf9\u4e2a\u6570\uff0c\u5f88\u5bb9\u6613\u5c31\u60f3\u5230DFS\u4e00\u904d\u6811\uff0c\u628a\u5404\u4e2a\u5b50\u6811\u76f8\u4e58\uff0c\u5c31\u662f\u8be5\u70b9\u7684answer\u4e86\u3002     \n\u81f3\u4e8e\u600e\u4e48\u904d\u5386.....\u767e\u5ea6\u641c\u7d22dfs\u5305\u6559\u5305\u4f1a\u3002    \n```\n#include<bits/stdc++.h>\nusing namespace std;\nstruct edge{int nex;int to;}c[100002];\nint a,b,d,f[100002],head[100002],tail[100002],top;\nlong long qz[100002];\nbool vis[100002];\ninline int read(){\n    int X=0;char ch=getchar();\n    while(isspace(ch)) ch=getchar();\n    while(isdigit(ch)) X=X*10+(ch^48),ch=getchar();\n    return X;\n}\nint dfs(int wz){\n    vis[wz]=1;\n    long long tot=1;\n    for(int i=head[wz];i;i=c[i].nex)\n        if(!vis[c[i].to]){\n            long long w=dfs(c[i].to);\n            qz[wz]+=tot*w*2;qz[wz]%=mod;tot+=w;\n        }\n    return tot;\n}\ninline void add(int g,int h){\n    top++;\n    if(!head[g]) head[g]=top;\n    else c[tail[g]].nex=top;\n    c[top].to=h;tail[g]=top;\n}\nint main(){\n    a=read(),b=read(),d=read();\n    for(int i=1;i<a;i++){\n        qz[i]=1;\n        int g=read(),h=read();\n        add(g,h);add(h,g);\n    }\n    qz[a]=1;\n    dfs(b);\n    for(int i=1;i<=d;i++)\n        cout<<qz[read()]<<'\\n';\n}\n\n```\n~~\u4e0d\u52a0\u53d6\u6a21\u4f3c\u4e4e\u4e5f\u80fd\u8fc7~~",
        "postTime": 1541420190,
        "uid": 107101,
        "name": "Viston",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "### Update on 2020.11.18 \n\n\u597d\u591a\u9519\u8bef\uff0c\u6539\u6b63\u4e00\u4e0b\u800c\u5df2\u3002\n\n----\n\n[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5002)\n\n## Part1 \u90e8\u5206\u5206\u7b97\u6cd5\n\n\u542c\u8bf4\u7b2c\u4e00\u4e2a\u70b9 $M=0$\uff0c\u6240\u4ee5\u76f4\u63a5\u4e00\u4e2a ```main(){}//zcy\u540a\u6253\u96c6\u8bad\u961f``` \u5c31\u53ef\u4ee5\u8fc7\u7b2c\u4e00\u4e2a\u70b9\u4e86\u3002\n\n\u53e6\u5916\u5982\u679c\u7528\u66b4\u529b\u7684\u601d\u60f3\uff0c\u679a\u4e3e\u6811\u4e0a\u7684\u4e24\u4e2a\u70b9\u8fdb\u884c LCA\uff0c\u542c\u8bf4\u80fd\u62ff $85pts$\u3002\n\n~~\u7ba1\u7406\u5458\u80fd\u4e0d\u80fd\u628a\u90e8\u5206\u5206\u7684\u6570\u636e\u8303\u56f4\u52a0\u4e0a\u53bb\u554a~~\n\n## Part2 \u7531\u6d45\u5165\u6df1\u8fdb\u884c\u8ba8\u8bba\n\n### Part2.1 \u5982\u679c\u8fd9\u662f\u4e00\u68f5\u4e8c\u53c9\u6811\n\n1. $P_i$ \u548c\u5176\u672c\u8eab\u7684 LCA \u5c31\u662f $P_i$\u3002\n2. $P_i$ \u548c\u5176\u4e24\u4e2a\u5b50\u6811\u7684\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u7684 LCA \u662f $P_i$\u3002\n3.  $P_i$ \u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u4e2d\u5206\u522b\u53d6\u4e00\u4e2a\u8282\u70b9\uff0c\u5b83\u4eec\u7684 LCA \u662f $P_i$\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u5148\u4e00\u4e2a dfs \u6c42\u51fa\u6bcf\u4e00\u4e2a\u5b50\u6811\u7684\u5927\u5c0f\uff0c\u7136\u540e\u6c42\u7b54\u6848\u3002\n\n### Part2.2 \u5982\u679c\u8fd9\u662f\u4e00\u68f5\u591a\u53c9\u6811\n\n\u4ece Part2.1 \u7684\u601d\u8def\u63a8\u5bfc\u800c\u6765\uff1a\n\n1. $P_i$ \u548c\u5176\u672c\u8eab\u7684 LCA \u5c31\u662f $P_i$\u3002\n2. $P_i$ \u548c\u5176\u5b50\u6811\u4e2d\u7684\u4efb\u610f\u4e00\u70b9\u7684 LCA \u662f $P_i$\n3. $P_i$ \u5b50\u6811\u4e2d\u4efb\u53d6\u4e24\u68f5\u5b50\u6811\uff0c\u5206\u522b\u533a\u5b83\u4eec\u7684\u4efb\u610f\u4e24\u70b9\u7684\u7684 LCA \u662f $P_i$\n\n\u628a 1,2 \u4e24\u70b9\u7ed3\u5408\uff0c\u5f97 $Ans1=2\\times Size_{P_i} -1$\n\n\u7b2c\u4e09\u70b9\u7b80\u5355\u8bb2\u5c31\u662f $Ans2= (u,v)$ \u7684\u4e2a\u6570\uff0c\u5176\u4e2d $u,v$ \u4e3a $P_i$ \u7684\u4e24\u4e2a\u5b50\u6811\u4e2d\u7684\u8282\u70b9\u3002\n\n\u6700\u7ec8\u7b54\u6848\u4e3a $Ans1+Ans2$\u3002\n\n\u4ed4\u7ec6\u770b\u770b\u7b2c\u4e09\u70b9\uff08\uff08\uff08\n\n\u8279\u8fd9\u4e0d\u5c31\u662f\u8054\u5408\u6743\u503c\u561b\uff01[P1351](/problem/P1351)\n\n\u63a8\u4e00\u4e0b\u67ff\u5b50\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u68f5\u5b50\u6811\u4ed6\u548c\u5176\u4ed6\u4efb\u610f\u5b50\u6811\u4e2d\u5206\u522b\u53d6\u4fe9\u70b9\uff0cLCA \u4e3a $P_i$ \u7684\u662f\uff08\u8bbe $P_i$ \u7684\u5b50\u6811\u4e3a $z_1 \\sim z_k$\uff0c\u8be5\u5b50\u6811\u4e3a $z_u$\uff09\uff1a\n\n$\\color{blue}\\sum \\limits_{i=1}^k (Size_{z_u}\\times Size_{z_i}) \\color{black} - \\color{red}{Size_{z_u}}^2$\n\n\u6211\u4eec\u4e0d\u5982\u628a\u84dd\u8272\u90e8\u5206\u548c\u7ea2\u8272\u90e8\u5206\u5206\u522b\u7ef4\u62a4\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u5bf9\u5e94\u6240\u6709\u5b50\u6811\u4e4b\u548c\u63a8\u4e00\u4e0b\u5c31\u662f $\\sum \\limits_{i=1}^k (Size_{z_u}\\times Size_{z_i}) -(\\sum  \\limits_{i=1}^k Size_{z_u})^2$\uff0c\u524d\u9762\u90e8\u5206\u5c31\u7b49\u4ef7\u4e8e $(Size_{P_i}-1)^2$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\uff01\n\n## Part3 Code\n\n```cpp\n/*\n  Author: BreakPlus\n  Online Judge: Luogu\n  Problem: P5002\n  Date: 2020/8/17\n*/\n#include<cstdio>\n#include<vector>\nusing namespace std;\nvector<int>vec[10010];\nint n,r,m,l,t,p;\nint sz[10010],ans[10010];\nvoid sizing(int x,int f)\n{\n  int len=vec[x].size();\n  int ans1=0;\n  sz[x]=1;\n  for(register int i=0;i<len;i++)\n  {\n    int tmp=vec[x][i];\n    if(tmp==f) continue;\n    sizing(tmp,x);\n    sz[x]+=sz[tmp];\n    ans1+=sz[tmp]*sz[tmp];\n  }\n  int ans3=2*sz[x]-1+(sz[x]-1)*(sz[x]-1)-ans1;\n  ans[x]=ans3;\n}\nint main()\n{\n  scanf(\"%d%d%d\",&n,&r,&m);\n  for(register int i=1;i<n;i++)\n  {\n    scanf(\"%d%d\",&l,&t);\n    vec[l].push_back(t);\n    vec[t].push_back(l);\n  }\n  sizing(r,0);\n  for(register int i=1;i<=m;i++)\n  {\n    scanf(\"%d\",&p);\n    printf(\"%d\\n\",ans[p]);\n  }\n  return 0;\n}\n```",
        "postTime": 1597713056,
        "uid": 334727,
        "name": "BreakPlus",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u521a\u5b66\u5b8c\u500d\u589eLCA\u7684\u6765\u4ecb\u7ecd\u81ea\u5df1\u7684~~\u4e71\u641e~~\u89e3\u9898\u8fc7\u7a0b\uff1a\n\n - ### \u76f4\u63a5\u66b4\u529b\u679a\u4e3e LCA  $O$\uff08$n^2\\log n $\uff0945pts:\n\u76f4\u63a5\u6309\u7167\u9898\u610f\uff0c\u66b4\u529b\u627e\u6bcf\u4e2a\u70b9\u5bf9\u7684[\u6700\u8fd1\u516c\u5171\u7956\u5148](https://www.luogu.com.cn/problem/P3379)\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a~~\uff08\u5176\u5b9e\u52a0\u4e2a\u5feb\u8bfb\u548cO2\u5e94\u8be5\u53ef\u4ee5\u62ff50pts\u7684\uff09~~\n```cpp\n#include<cstdio>\n#include<vector>\nusing namespace std;\nvector<int>G[50005];\n\nvoid add(int u,int v)//\u5b58\u56fe \n{\n\tG[u].push_back(v);\n\tG[v].push_back(u);\n } \n\nint fa[50005][35],deep[50005],lg[50005],n,m,s;\n\nvoid dfs(int now,int father)\n{\n\t \n\tfa[now][0]=father;//\u5411\u4e0a\u8df3 2^0 \u5c31\u662f\u8df3\u5230\u7236\u4eb2\n\tdeep[now]=deep[father]+1;//\u81ea\u5df1\u7684\u6df1\u5ea6\u5c31\u662f\u7236\u4eb2\u6df1\u5ea6\u52a0\u4e00\n\tfor(int i=1;i<=lg[deep[now]];i++)//\u5904\u7406\u5411\u4e0a\u8df3 2^i \u5230\u8fbe\u7684\u70b9 \n\t{\n\t\tfa[now][i]=fa[fa[now][i-1]][i-1];//\u4ece now \u5411\u4e0a\u8df3 2^i \u53ef\u5230\u8fbe\u4ece now \u5411\u4e0a\u8df3 2^(i-1) \u518d\u5411\u4e0a\u8df3 2^(i-1) \u6240\u5230\u8fbe\u7684\u70b9 \n\t } \n\tfor(int i=0;i<G[now].size();i++)\n\t{\n\t\tif(G[now][i]!=father)dfs(G[now][i],now);//\u518d\u5904\u7406\u4e00\u4e0b\u81ea\u5df1\u513f\u5b50\u7684\u4fe1\u606f \n\t}\n}\n\nint LCA(int x,int y)\n{\n\tif(deep[x]<deep[y])swap(x,y);//\u4fdd\u8bc1 x\u7684\u6df1\u5ea6\u5927\n\twhile(deep[x]>deep[y])//\u8ba9\u4e24\u4e2a\u70b9\u6df1\u5ea6\u4e00\u6837 \n\t{\n\t\tx=fa[x][lg[deep[x]-deep[y]]-1];//\u5feb\u5feb\u8df3 \n\t } \n\tif(x==y)return x;//\u5982\u679c\u4e24\u70b9\u4e3a\u540c\u4e00\u70b9 (y\u662fx\u7684\u7956\u5148), \u76f4\u63a5\u8fd4\u56de\n\tfor(int k=lg[deep[x]]-1;k>=0;k--)//\u5012\u7740\u679a\u4e3e2^k,\u770b\u770b\u80fd\u4e0d\u80fd\u5230\u540c\u4e00\u70b9 \n\t{\n\t\tif(fa[x][k]!=fa[y][k])//\u907f\u514d\u8df3\u8fc7\u5934\n\t\t\tx=fa[x][k],y=fa[y][k]; \n\t } \n\treturn fa[x][0];//x \u7684\u7236\u4eb2\u5c31\u662flca \n } \n \nint main()\n{\n\tint n,r,m,ans[10005]={0};\n\tscanf(\"%d%d%d\",&n,&r,&m);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);\n\t}\n\tfor(int i=1;i<=n;i++)//\u9884\u5904\u7406\u51fa log_2(i)+1 \u7684\u503c \n\t{\n\t\tlg[i]=lg[i-1]+(1<<lg[i-1]==i);\n\t } \n\t dfs(r,0);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tint lca=LCA(i,j);\n\t\t\tans[lca]++;\n\t\t}\n\t}\n\tfor(int i=0;i<m;i++)\n\t{\n\t\tint p;\n\t\tscanf(\"%d\",&p);\n\t\tprintf(\"%d\\n\",ans[p]);\n\t}\n\treturn 0;\n } \n```\n\n\n\n - ### \u6b63\u89e3\uff1a$dfs$ + \u627e\u89c4\u5f8b $O$\uff08$n+m$\uff09:\n \u6211\u4eec\u770b\u4e00\u4e0b\u6837\u4f8b\u7ed9\u7684\u56fe\uff0c~~\u5f88\u5bb9\u6613~~\u5c31\u53ef\u4ee5\u627e\u89c4\u5f8b\u53d1\u73b0\uff1a\n $$ans[p]=size[p]^2-\\sum_isize[i]^2\n $$\n \u5176\u4e2d $i$ \u8868\u793a $p$ \u7684\u5b50\u8282\u70b9\uff0c\u7136\u540e\u6211\u4eec\u53ea\u9700\u8981 $dfs$ \u4e00\u6b21\u5168\u90e8\u8282\u70b9\u7684\u5b50\u6811\u5927\u5c0f\uff0c\u7136\u540e\u518d\u6c42\u51fa\u7ed3\u679c\u5373\u53ef\u3002\n \n \u6709\u4e00\u4e2a\u7ec6\u8282\uff1a\u6211\u4eec\u53d1\u73b0 $n\\leq m$ ,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u6570\u7ec4\u8bb0\u5fc6\u5316\u4e00\u4e0b\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5b8c\u7f8e $AC$ \u5566\uff1a\n \n```cpp\n#include<cstdio>\n#include<vector>\n#include<algorithm> \nusing namespace std;\nvector<int>G[10005];\nvoid add(int u,int v)//\u5b58\u56fe\n{\n\tG[u].push_back(v);\n\tG[v].push_back(u);\n}\nint size[10005],fa[10005],ans[10005];//size\u8bb0\u5f55\u5b50\u6811\u5927\u5c0f\uff0cfa\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u7684\u7236\u4eb2\uff0cans\u8bb0\u5fc6\u5316\u7b54\u6848\n\nint dfs(int now,int father)//dfs\u4e00\u4e0b\u7b97\u5b50\u6811\u5927\u5c0f\n{\n\tsize[now]=1;\n\tfa[now]=father;\n\tfor(int i=0;i<G[now].size();i++)\n\t{\n\t\tif(G[now][i]!=father)size[now]+=dfs(G[now][i],now);\n\t}\n\treturn size[now];\n}\n\nint main()\n{\n\tint n,m,s;\n\tscanf(\"%d%d%d\",&n,&s,&m);\n\tfor(int i=0;i<n-1;i++)\n\t{\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);\n\t}\n\tdfs(s,0);\n\tfor(int i=0;i<m;i++)\n\t{\n\t\tint p;\n\t\tscanf(\"%d\",&p);\n\t\tint anss=size[p]*size[p];\n\t\tif(!ans[p])for(int i=0;i<G[p].size();i++)//\u5982\u679c\u8fd9\u4e2a\u70b9\u8fd8\u6ca1\u8bb0\u5fc6\u5316\uff0c\u5c31\u7b97\u4e00\u6b21\n\t\t{\n\t\t\tif(G[p][i]!=fa[p])anss-=size[G[p][i]]*size[G[p][i]];\n\t\t\tans[p]=anss;\n\t\t}\n\t\tprintf(\"%d\\n\",ans[p]);//\u8f93\u51fa\u7b54\u6848\uff0c\u8bb0\u5f97\u7a7a\u884c\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1593261890,
        "uid": 225755,
        "name": "LinkZelda",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u7ed9\u4e00\u4e2a\u9884\u5904\u7406$\\Theta(n)$\uff0c\u67e5\u8be2$\\Theta(1)$\u7684\u505a\u6cd5\u3002\n\n\u4e00\u904d`DFS`\u5c31\u80fd\u6c42\u51fa\u5404\u4e2a\u5b50\u6811\u7684\u5927\u5c0f\u548c\u81ea\u5df1\u7684\u5927\u5c0f\u3002\u5206\u60c5\u51b5\u8ba8\u8bba\uff0c\u4e00\u79cd\u60c5\u51b5\u662f\u524d\u9762\u4e00\u4e2a\u5143\u7d20\u5728`x`\u7684\u5b50\u6811\u4e0a\uff0c\u53e6\u4e00\u79cd\u662f\u524d\u9762\u4e00\u4e2a\u5143\u7d20\u5728`x`\u4e0a\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u679a\u4e3e\u4e00\u904d\u5b50\u6811\uff0c\u7d2f\u52a0\u51fa$(siz[x]-siz[ch])\\times siz[ch]$\u3002\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u5bb9\u6613\u5f97\u51fa\u5c31\u662f$siz[x]$\u3002\n\n\u6700\u7ec8\u53ea\u9700\u8981`DFS`\u4e00\u904d\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$\\Theta(n)$\u3002\u4e0d\u9700\u8981\u5f00$long\\space long$\u3002\n\n\u9644AC\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\nusing namespace std;\n\n#define mod 1000000007\n\nint beg[10005];\nint ed[20005];\nint nxt[20005];\nint top;\n\nvoid addedge(int a,int b)\n{\n\t++top;\n\ted[top] = b;\n\tnxt[top] = beg[a];\n\tbeg[a] = top;\n}\n\nint fa[10005];\nint siz[10005];\nint ans[10005];\n\nvoid dfs(int x)\n{\n\tsiz[x] = 1;\n\tfor(int p=beg[x]; p; p=nxt[p])\n\t\tif(ed[p]!=fa[x])\n\t\t{\n\t\t\tfa[ed[p]] = x;\n\t\t\tdfs(ed[p]);\n\t\t\tsiz[x] += siz[ed[p]];\n\t\t}\n\n\tfor(int p=beg[x]; p; p=nxt[p])\n\t\tif(ed[p]!=fa[x])\n\t\t{\n\t\t\tans[x] += siz[ed[p]]*(siz[x]-siz[ed[p]]);\n\t\t\tans[x] %= mod;\n\t\t}\n\n\tans[x] += siz[x];\n\tans[x] %= mod;\n}\n\nint main()\n{\n\tint n,r,m;\n\tscanf(\"%d%d%d\",&n,&r,&m);\n\tfor(int i=1; i<n; ++i)\n\t{\n\t\tint a,b;\n\t\tscanf(\"%d%d\",&a,&b);\n\t\taddedge(a,b);\n\t\taddedge(b,a);\n\t}\n\n\tdfs(r);\n\n\tfor(int i=1; i<=m; ++i)\n\t{\n\t\tint x;\n\t\tscanf(\"%d\",&x);\n\t\tprintf(\"%d\\n\",ans[x]);\n\t}\n}\n```",
        "postTime": 1570524976,
        "uid": 49458,
        "name": "\u6728\u6728\uff01",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "* **\u3010\u9898\u76ee\u94fe\u63a5\u3011**\n\n[Link:P5002](https://www.luogu.com.cn/problem/P5002)\n\n* **\u3010\u89e3\u9898\u601d\u8def\u3011**\n\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u601d\u8003\u4e00\u4e0b\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b $P_i$ \u4e0e $P_j$ \u7684LCA\u662f $P_r$\u3002\n\n* $P_i$ \u4e0e $P_j$ \u5728\u4e24\u4e2a $P_r$ \u7684\u4e0d\u540c\u7684\u5b50\u6811\u5185\u3002\uff08\u62ff\u6837\u4f8b\u6765\u8bf4\uff0c\u5047\u8bbe $P_j=1$\uff0c\u5219 $P_i\\in\\{2,4,5\\},P_j\\in\\{3,6,7\\}$ \u6216 $P_i\\in\\{3,6,7\\},P_j\\in\\{2,4,5\\}$\uff09\n\n* $P_i=P_r$ \u6216 $P_j=P_r$\u3002\uff08\u5373\u6709\u4e00\u4e2a\u70b9\u662f\u6839\u8282\u70b9\uff0c\u4e5f\u53ef\u4ee5\u4e24\u4e2a\u70b9\u90fd\u662f\u6839\u8282\u70b9\u3002\uff09\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u505a\u4e86\uff1a\n\n\u9996\u5148\uff0c\u6211\u4eec\u53ea\u6709\u8fd9\u4e9b\u8fb9\u662f\u6ca1\u6cd5\u786e\u5b9a\u7236\u8282\u70b9\u548c\u5b50\u8282\u70b9\u7684\u5173\u7cfb\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8981\u7406\u4e00\u4e0b\u8fd9\u4e9b\u4fe1\u606f\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5730\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u904d\u5386\u6811\uff1a\n\n1. \u904d\u5386\u8fde\u63a5\u8fd9\u4e2a\u70b9\u7684\u6bcf\u6761\u8fb9\uff0c\u5982\u679c\u8fd9\u6761\u8fb9\u4e0a\u7684\u53e6\u4e00\u4e2a\u70b9\u5df2\u7ecf\u88ab\u904d\u5386\u8fc7\uff0c\u8bf4\u660e\u8fd9\u662f\u7236\u8282\u70b9\uff1b\u5982\u679c\u6ca1\u6709\u5c31\u662f\u5b50\u8282\u70b9\u3002\n\n2. \u5bf9\u904d\u5386\u5230\u7684\u5b50\u8282\u70b9\u91cd\u590d\u7b2c\u4e00\u6b65\u3002\n\n3. \u904d\u5386\u5b8c\u6240\u6709\u7684\u8fb9\u540e\uff0c\u5982\u679c\u672c\u6b65\u7684\u70b9\u662f\u6839\u8282\u70b9\uff0c\u7ed3\u675f\u5904\u7406\u3002\u5982\u679c\u4e0d\u662f\uff0c\u8fd4\u56de\u7236\u8282\u70b9\uff08\u7ed3\u675f\u672c\u5c42\u9012\u5f52\uff09\u3002\n\n\u90a3\u4e48\uff0c\u5982\u4f55\u7edf\u8ba1\u7b26\u5408\u6761\u4ef6\u7684 $(P_i,P_j)$ \u5462\uff1f\uff08\u4ee5\u4e0b\u5747\u9ed8\u8ba4\u70b9\u5bf9\u65e0\u5e8f\uff09\n\n\u9996\u5148\uff0c\u6211\u4eec\u5e94\u8be5\u7edf\u8ba1\u6bcf\u4e2a\u8282\u70b9\u7684\u5b50\u8282\u70b9\u6570\u3002\u8fd9\u4e2a\u53ef\u4ee5\u5728\u904d\u5386\u6811\u7684\u8fc7\u7a0b\u4e2d\u987a\u4fbf\u5b8c\u6210\u3002\n\n\u63a5\u7740\uff0c\u5047\u8bbe $P_r$ \u6709 $cnt$ \u4e2a\u5b50\u6811\uff0c\u7b2c $i$ \u4e2a\u5b50\u6811\u6709 $node_i$ \u4e2a\u8282\u70b9\uff0c\u5219\u6ee1\u8db3\u5f00\u5934\u63d0\u5230\u7684\u6761\u4ef6 $2$ \u7684\u70b9\u5bf9\u4e2a\u6570\u4e3a\uff1a\n\n$$\\sum_{i=1}^{cnt}node_i$$\n\n\u5176\u5b9e\u5c31\u662f\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u548c\u6839\u8282\u70b9\u914d\u5bf9\u3002\n\n\u6ee1\u8db3\u6761\u4ef6 $1$ \u7684\u70b9\u5bf9\u4e2a\u6570\u4e3a\uff1a\n\n$$\\sum_{i=1}^{cnt-1}\\sum_{j=i+1}^{cnt}node_inode_j$$\n\n\u5373\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u548c\u5176\u4ed6\u5b50\u6811\u7684\u4efb\u4e00\u8282\u70b9\u914d\u5bf9\u3002\n\n\u6ce8\u610f\u5230\u70b9\u5bf9\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u7ed3\u679c\u4e3a\uff1a\n\n$$2\\left[\\left(\\sum_{i=1}^{cnt}node_i\\right)+\\sum_{i=1}^{cnt-1}\\sum_{j=i+1}^{cnt}node_inode_j\\right]+1$$\n\n\u6ca1\u9519\uff0c\u56e0\u4e3a\u8fd9\u91cc\u7b97\u4e0d\u5230 $(1,1)$\uff0c\u6240\u4ee5\u8981\u52a0\u4e00\u3002\n\n\u6ce8\u610f\u5230\u8ba1\u7b97\u8fd9\u4e2a\u5f0f\u5b50\u7684\u590d\u6742\u5ea6\u4e3a $\\Theta(cnt^2)$\uff0c\u4f1aT\u3002\n\n* **\u5982\u4f55\u4f18\u5316\uff1f**\n\n\u4ee5\u4e0b\u5747\u9ed8\u8ba4\u70b9\u5bf9\u65e0\u5e8f\u3002\n\n\u6ce8\u610f\u5230\uff0c\n\n$$\\sum_{i=1}^{cnt}node_i$$\n\n\u5373\u4e3a $P_r$ \u7684\u5b50\u8282\u70b9\u4e2a\u6570\u3002\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5728\u904d\u5386\u6811\u7684\u8fc7\u7a0b\u4e2d\u987a\u4fbf\u5904\u7406\u3002\n\n\u800c\n\n$$\n\\sum_{i=1}^{cnt-1}\\sum_{j=i+1}^{cnt}node_inode_j\n$$\n$$=\\sum_{i=2}^{cnt}node_i\\sum_{j=1}^{i-1}node_j$$\n\n\u5b83\u7684\u610f\u4e49\u662f\uff1a\u6bcf\u641c\u7d22\u5230\u4e00\u4e2a\u65b0\u5b50\u6811\uff0c\u5b83\u6bcf\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u548c\u4ee5\u524d\u641c\u5230\u7684\u6240\u6709\u5b50\u6811\u7684\u4efb\u4e00\u8282\u70b9\u914d\u5bf9\u3002\n\n\u8bbe\u524d $k$ \u4e2a\u5b50\u6811\u7684\u8282\u70b9\u6570\u548c\u4e3a $nodesum_k$\uff0c\u5219\u663e\u7136\u6709\n\n$$nodesum_k=\\begin{cases}node_1&k=1\\\\nodesum_{k-1}+node_k&k>1\\end{cases}$$\n\n\u5f0f\u5b50\u5316\u4e3a\n\n$$\\sum_{i=2}^{cnt}node_inodesum_{i-1}$$\n\n\u800c\u6bcf\u4e00\u8f6e\u7684 $nodesum_i$ \u90fd\u53ef\u4ee5\u7531\u524d\u4e00\u8f6e\u7684 $nodesum_{i-1}~\\Theta(1)$ \u63a8\u51fa\u3002\n\n\u4e8e\u662f\uff0c\u8ba1\u7b97\u8fd9\u4e2a\u5f0f\u5b50\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u5230\u4e86 $\\Theta(cnt)$\u3002\n\n* **\u3010\u5b9e\u73b0\u7ec6\u8282\u3011**\n\n\u6ce8\u610f\u5230\u6bcf\u4e2a\u70b9\u7684\n\n$$\\sum_{i=2}^{cnt}node_inodesum_{i-1}$$\n\n\u4e0e\n\n$$\\sum_{i=1}^{cnt}node_i$$\n\n\u5747\u53ef\u4ee5\u5728\u904d\u5386\u6811\u65f6\u987a\u4fbf\u5168\u90e8\u9884\u5904\u7406\u3002\n\n\u4e8e\u662f\uff0c\u6574\u4e2a\u7a0b\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(N+M)$\u3002\n\n\u4e0d\u7528\u5bf9\u6bcf\u4e2a\u8282\u70b9\u5355\u72ec\u5f00\u6876\u8bb0\u5f55\u7b54\u6848\u3002\n\n\u8fd8\u6709\uff0c\u672c\u9898\u4e0d\u7528\u53d6\u6a21\u3002\n\n\u56e0\u4e3a\uff0c\u672c\u9898\u4e2d\u7b54\u6848\u6700\u591a\u4e3a $(10^4)^2+1=10^8+1$\uff0c**\u8fdc\u8fdc\u8fbe\u4e0d\u5230** $\\mathbf{10^9+7}$\u3002\n\n* **\u3010\u4ee3\u7801\u5b9e\u73b0\u3011**\n\n```cpp\n#include <iostream>\n#include <vector>\n#include <bitset>\n#include <array>\n\nusing namespace std;\n\narray<vector<int>,10001> tree;\narray<int,10001> cnt_son;//\u8bb0\u5f55\u6ee1\u8db3\u6761\u4ef62\u7684\u70b9\u5bf9\u6570\uff0c\u5373\u6bcf\u4e2a\u8282\u70b9\u7684\u5b50\u8282\u70b9\u6570\narray<int,10001> cnt_pairs;//\u8bb0\u5f55\u6ee1\u8db3\u6761\u4ef61\u7684\u70b9\u5bf9\u6570\nbitset<10001> is_searched;\n\nint construct_tree(int root)//\u904d\u5386\u6811+\u9884\u5904\u7406\n{\n\tvector<int> tmp_sons;\n\tint tmp;\n\ttmp_sons=move(tree[root]);\n\ttree[root].clear();\n\tfor(int i=0;i<tmp_sons.size();i++)//\u6838\u5fc3\u90e8\u5206\n\t\tif(!is_searched[tmp_sons[i]]&&(is_searched[tmp_sons[i]]=true))\n\t\t\ttree[root].push_back(tmp_sons[i]),tmp=construct_tree(tmp_sons[i]),\n\t\t\tcnt_pairs[root]=cnt_pairs[root]+cnt_son[root]*tmp,cnt_son[root]+=tmp;\n\treturn cnt_son[root]+1;//\u8fd4\u56de\u8be5\u5b50\u6811\u7684\u8282\u70b9\u6570\n}\n\nint main(int argc,char* argv[],char* envp[])\n{\n\tios::sync_with_stdio(false);\n\tcin.tie(nullptr);\n\tint cntpoint,cntquery,node_a,node_b,root;\n\tcin>>cntpoint>>root>>cntquery;\n\tfor(int i=0;i<cntpoint-1;i++)\n\t\tcin>>node_a>>node_b,tree[node_a].push_back(node_b),tree[node_b].push_back(node_a);\n\tis_searched[root]=true;\n\tconstruct_tree(root);\n\twhile(cntquery--)\n\t\tcin>>root,cout<<(cnt_son[root]+cnt_pairs[root])*2+1<<endl;\n\treturn 0;\n}\n\n```",
        "postTime": 1626088577,
        "uid": 372983,
        "name": "Antarctic_Cube",
        "ccfLevel": 6,
        "title": "Solution:P5002(\u4e13\u5fc3OI - \u627e\u7956\u5148)"
    },
    {
        "content": "\u9898\u610f\u7b80\u8ff0\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6811\u548c $m$ \u4e2a\u70b9\uff0c\u6c42\u7ed9\u51fa\u7684\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u70b9 \u4e3a\u4efb\u610f\u4e8c\u5143\u7ec4 $(u_i,v_i)$ \u7684 LCA\u3002\n\n\u9996\u5148\u62ff\u5230\u8fd9\u4e2a\u9898\u76ee\uff0c\u5f88\u9ad8\u5174\u5730\u5199\u4e86\u4e2a LCA \u677f\u5b50\u5bf9\u6bcf\u4e2a $m_i$ \u8fdb\u884c\u8ba1\u7b97\u64cd\u4f5c\uff0c\u6ca1\u60f3\u5230\u53ea\u62ff\u4e86 $45pts$, TLE\u3002\n\n\u8ba4\u771f\u5206\u6790\u53d1\u73b0\uff0c\u82e5\u4e00\u7ec4\u8282\u70b9 $u_i,v_i$  LCA \u4e3a\u70b9 $p$ \u90a3\u4e48\n\n1. \u8282\u70b9 $p$ \u7684\u5b50\u6811\u91cc\u9762\u968f\u4fbf\u53d6\u5f97\u4e24\u68f5\u5b50\u6811\u7684 LCA \u90fd\u662f $p$ \n2. \u70b9 $p$ \u548c\u70b9 $p$ \u4e0b\u4efb\u610f\u4e00\u68f5\u5b50\u6811\u7684 LCA \u4e3a $p$\n3. $u_i,v_i$ \u603b\u5728 $p$ \u7684\u4e0d\u540c\u5b50\u6811\u4e2d\u3002\n\n\u904d\u5386 $p$ \u7684\u513f\u5b50\uff0c\u6bcf\u4e00\u4e2a\u513f\u5b50\u7684\u5b50\u6811\u5927\u5c0f\u4e58\u4e0a $p$ \u5b50\u6811\u4e2d\u9664\u4e86\u521a\u521a\u8ba1\u7b97\u7684\u5b50\u6811\u7684\u5927\u5c0f\uff0c\u6700\u540e\u52a0\u4e0a $p$ \u7684\u5927\u5c0f\u3002\n\n\n\u6ce8\u610f\u5230 $N\u2264M$ \u6240\u4ee5\u53ef\u80fd\u8981\u91cd\u590d\u95ee\u4e00\u4e2a\u70b9\uff0c\u8bb0\u5f97\u5f00\u4e2a\u6876\u5168\u90e8\u8bb0\u5f55\u7b54\u6848\u66f4\u5feb\u54e6\uff1b\n\n```\n#include<bits\\stdc++.h>\n#define ll long long\n#define N 100001\nusing namespace std;\n\ninline long long read()\n{\n    ll f=1,s=0;char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9')s=(s<<1)+(s<<3)+ch-'0',ch=getchar();\n    return s*f;\n}\n\nconst int mod=1e9+7;\nll n,m,s,x,y,z,maxdep;\nll siz[100001],Ans[100001];\nll dep[100001],deep[100001];\nll f[100001][22],lg[100001],dis[100001];\nll from[N*2],net[N*2],to[N*2],cnt,v[N*2];\n\ninline void add(ll x,ll y){\n\tto[++cnt]=y;\n//\tv[cnt]=var;\n\tnet[cnt]=from[x];\n\tfrom[x]=cnt;\n}\n\nvoid dfs(ll now,ll fa,ll ifuckccf){\n\t//f[now][0]=fa;\n\tdep[now]=dep[fa]+1;\n\tsiz[now]=1;\n\t//for(int i=1;i<=lg[dep[now]];i++) f[now][i]=f[f[now][i-1]][i-1];\n\tfor(int i=from[now];i;i=net[i]) if(to[i]!=fa) dfs(to[i],now,ifuckccf+1),siz[now]+=siz[to[i]]%mod;\n}\n\nll LCA(ll x,ll y){\n\tif(dep[x]<dep[y]) swap(x,y);\n\twhile(dep[x]>dep[y])\n\t\tx=f[x][lg[dep[x]-dep[y]]-1];\n\tif(x==y) return x;\n\tfor(int i=15;i>=0;i--)\n\t\tif(f[x][i]!=f[y][i])\n\t\t\tx=f[x][i],y=f[y][i];\n\treturn f[x][0];\n}\n\nbool cmp(ll a,ll b){\n\treturn a>b;\n}\n\nll cheakall(ll now){\n\tll res=x=siz[now];\n\tfor(int i=from[now];i;i=net[i]){\n\t\tif(dep[to[i]]<dep[now]) continue;\n\t\ty=siz[to[i]];\n\t\tres+=(long long)((x-y)*y)%mod;\n\t}\n\treturn res;\n}\n\nint main(){\n\tn=read();s=read();m=read();\n\tfor(int i=1;i<n;i++){\n\t\tx=read();y=read();\n\t\tadd(x,y);add(y,x);\n\t}\n\tfor(int i=1;i<=n;i++) lg[i]=lg[i>>1]+1;\n\tdfs(s,s,1);\n\tfor(int i=1;i<=n;i++) Ans[i]=cheakall(i);\n \twhile(m-->0) cout<<Ans[read()]<<endl;\n\t return 0;\n} \n```\n",
        "postTime": 1608387702,
        "uid": 120438,
        "name": "Lacrymabre",
        "ccfLevel": 0,
        "title": "P5002 \u4e13\u5fc3OI - \u627e\u7956\u5148\u9898\u89e3"
    },
    {
        "content": "\u4e00\u9053\u5f88\u6709\u8da3\u7684\u9898\uff0c\u4e00\u770b\u5c31\u4e0d\u662f\u4e00\u9053 LCA\u3002  \n\u6211\u624d\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u72af\u4e86\u4e00\u4e2a\u5f31\u667a\u63a8\u67ff\u5b50\u9519\u8bef\u5bfc\u81f4\u4fdd\u9f84\u2026\u2026  \n\u9605\u8bfb\u524d\u8bf7\u6ce8\u610f\uff0c\u5904\u4e8e\u4e60\u60ef\u6211\u7528 $u$ \u4ee3\u8868\u8fd9\u4e2a\u70b9\uff0c$v$ \u4ee3\u8868 $u$ \u7684\u67d0\u4e2a\u513f\u5b50\u3002  \n\u95f2\u8bdd\u5c11\u8bf4\uff0c\u5207\u5165\u6b63\u9898\u3002\n\n---\n\u9996\u5148\uff0c\u770b\u7740\u8fd9\u53cb\u597d\u7684\u6570\u636e\u8303\u56f4\u5c31\u77e5\u9053\u5355\u7eaf\u7684\u66b4\u529b LCA \u662f\u4e0d\u884c\u7684\uff0c\u4e0d\u7136\u8fd9\u9898\u4e5f\u6ca1\u5565\u610f\u601d\u5bf9\u5427\uff0c\u7136\u540e\u4e00\u773c\u5c31\u662f\u6570\u5b66\u90a3\u65b9\u9762\u60f3\u3002  \n\n\u4e0d\u96be\u5f97\u51fa\u8fd9\u6837\u4e00\u6761\u7ed3\u8bba\uff0c\u5c31\u662f\u53ea\u6709\u4e24\u70b9\u4e8e $u$ \u4e0d\u540c\u7684\u5b50\u6811\u4e0a\uff0c\u8fd9\u4e24\u70b9\u7684 LCA \u624d\u662f $u$\u3002\u56e0\u4e3a\u5982\u679c\u4e24\u70b9\u4e8e\u540c\u4e00\u4e2a\u5b50\u6811\uff0c\u90a3\u4e48\u81f3\u5c11\u53ef\u4ee5\u8df3\u5230\u66f4\u6d45\u7684\u8fd9\u9897\u5b50\u6811\u7684\u6839\uff0c\u6240\u4ee5\u4e00\u5b9a\u662f\u8fd9\u6837\u3002  \n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u6211\u4eec\u8981\u628a\u5b83\u4eec\u7684\u8d21\u732e\u5206\u4e3a\u4e24\u7c7b\uff1a  \n1. \u5143\u7d20\u5728 $u$ \u7684\u5b50\u6811\u4e0a\uff0c\u975e $u$\u3002    \n\t\u8fd9\u79cd\u72b6\u51b5\u662f\u8be5\u9898\u7684\u6838\u5fc3\u3002\u9996\u5148\uff0c\u6211\u4eec\u8981\u9884\u5904\u7406\u6bcf\u4e2a\u5b50\u6811\u548c\uff0c\u56e0\u4e3a\u4e0a\u9762\u8bf4\u4e86\u8fd9\u662f\u548c\u5b50\u6811\u6709\u5173\u7684\u3002  \n   \u7136\u540e\u5462\u6839\u636e\u5e38\u8bc6\uff0c\u9664\u53bb\u8fd9\u4e2a\u70b9 $v$ \u7684\u5b50\u6811\u5927\u5c0f $siz_v$\uff0c\u5219\u662f\u6709\u5269\u4e0b $siz_u-siz_v$ \u4e2a\u53ef\u9009\u7684\u3002\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u6bcf\u4e2a $v$ \u7684\u8d21\u732e\u4e3a\uff1a$(siz_u-siz_v)\\times siz_v$\u3002\n2. \u6709\u5143\u7d20\u662f $u$  \n\t\u5728\u8fd9\u79cd\u72b6\u51b5\u4e0b\u6211\u5c31\u65e0\u9700\u591a\u5e9f\u53e3\u820c\u4e86\uff0c\u80af\u5b9a\u90fd\u77e5\u9053\u80af\u5b9a\u5e26\u6765\u7684\u8d21\u732e\u4e3a $siz_u$\u3002  \n    \n\u7136\u540e\u6211\u4eec DFS \u6839\u636e\u4e0a\u9762\u7684\u8d21\u732e\u9884\u5904\u7406\u4e00\u4e0b\uff0c\u5c31\u80fd\u7528 $O(n)$ \u7684\u9884\u5904\u7406\uff0c$O(1)$ \u65f6\u95f4\u590d\u6742\u5ea6\u5b8c\u7f8e AC\uff01  \n\u4ee3\u7801\uff1a  \n```cpp\n#include<iostream>\n#include<vector>\n#define int long long\n#define Mod 1000000007\n#define MAXN 10000\nusing namespace std;\nint siz[MAXN+10],ans[MAXN+10];\nvector<int>gra[MAXN+10];\nint n,m,r;\nvoid link(int x,int y)\n{\n\tgra[x].push_back(y);\n\tgra[y].push_back(x);\n}\nvoid dfs(int u,int fa)\n{\n\tsiz[u]=1;//\u7b97\u4e0a\u81ea\u5df1\uff0c\u540c\u65f6\u53f6\u5b50\u8282\u70b9\u5b50\u6811\u4e3a 1\n\tint rest=1;\n   //\u7b97\u5b50\u6811\u548c\n\tfor(int p=0;p<gra[u].size();p++)\n\t{\n\t\tint v=gra[u][p];//\u513f\u5b50\n\t\tif(fa!=v)//\u8fd9\u662f\u65e0\u5411\u56fe\uff0c\u5982\u679c\u8ddf\u7740\u7236\u4eb2\u8dd1\u5c31\u4f1a\u65e0\u9650\u6253\u8f6c\n\t\t{\n\t\t\tdfs(v,u);//\u627e v \u7684\u5b50\u6811\n\t\t\tsiz[u]=(siz[u]+siz[v])%Mod;//\u8bb0\u5f97\u53d6\u4f59\uff01\n\t\t}\n\t}\n\tfor(int p=0;p<gra[u].size();p++)//\u7edf\u8ba1\u8d21\u732e\n\t{\n\t\tint v=gra[u][p];\n\t\tif(fa!=v)\n\t\t\tans[u]=(ans[u]+((siz[u]-siz[v])*siz[v])%Mod)%Mod;//1 \u7c7b\u8d21\u732e\n\t}\n\tans[u]=(ans[u]+siz[u])%Mod;//2 \u7c7b\u8d21\u732e\n}\nsigned main()\n{\n\t//freopen(\".in\",\"r\",stdin);\n\t//freopen(\".out\",\"w\",stdout);\n\tios::sync_with_stdio(false);\n\tcin>>n>>r>>m;\n\tfor(int p=1,x,y;p<=n-1;p++)\n\t{\n\t\tcin>>x>>y;\n\t\tlink(x,y);\n\t}\n\tdfs(r,0);\n\tfor(int p=1,x;p<=m;p++)\n\t\tcin>>x,cout<<ans[x]<<endl;\n}\n```\n",
        "postTime": 1605277629,
        "uid": 298549,
        "name": "SIXIANG32",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u4e00\u9053\u62ab\u7740LCA\u5916\u8863\u7684\u7ec4\u5408\u8ba1\u6570\u9898\u3002\n\n\u4e00\u5f00\u59cb\u7684\u601d\u8def\uff1a\u66b4\u529b\u6c42\u89e3\uff0c$O(n^2logn)$\uff0c\u54b3\u54b3\u3002\n\n\u60f3\u6b63\u89e3\u5427\uff0c\u5206\u6790\u4e00\u4e0b\u6837\u4f8b\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/65tbitjo.png)\n\n\u5bf9\u4e8e\u4ee5 $1$ \u4e3aLCA\u7684\u70b9\u5bf9\u5171\u670931\u7ec4\uff0c\u8fd931\u7ec4\u662f\u600e\u4e48\u6765\u7684\u5462\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0cLCA\u4e3a1\u7684\u70b9\u5bf9 $(x,y)$ \uff0c\u8981\u4e48 $x,y$ \u5176\u4e2d\u6709\u4e00\u4e2a\u662f1\uff0c\u8981\u4e48\u5206\u5c45\u4e8e1\u7684\u4e24\u68f5\u4e0d\u540c\u7684\u5b50\u6811\u4e0b\u3002\n\n\u5176\u4e2d\u6709\u4e00\u4e2a\u662f1\u7684\u70b9\u5bf9\u4e2a\u6570\u662f $(size[1]-1)*2+1$\u3002\n\n\u5206\u5c45\u4e8e1\u7684\u4e24\u68f5\u4e0d\u540c\u5b50\u6811\u4e0b\u7684\u70b9\u5bf9\u4e2a\u6570\u662f\u4e24\u4e24\u5b50\u6811\u5927\u5c0f\u7684\u4e58\u79ef\u3002\n\n\u7b54\u6848\u5176\u5b9e\u5df2\u7ecf\u51fa\u6765\u4e86\uff0c\u4f46\u8fd9\u6837\u5728\u4ee3\u7801\u5b9e\u73b0\u91cc\u4e0d\u592a\u597d\u7edf\u8ba1\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u7b54\u6848\u91cd\u65b0\u6574\u7406\u4e00\u4e0b\uff0c\u62c6\u6210\u4e24\u90e8\u5206\uff0c\u5bf9\u4e8e\u5b50\u6811\u4e24\u4e24\u4e58\u79ef\uff0c\u5199\u4f5c$size[v]*(size[lca]-size[v])$ \u56e0\u4e3a\u6bcf\u4e00\u68f5\u5b50\u6811\u90fd\u53ef\u4ee5\u548c\u9664\u4e86\u8fd9\u4e2a\u5b50\u6811\u7684\u5176\u4ed6\u5728lca\u5b50\u6811\u4e0b\u7684\u70b9\u6784\u6210\u4e00\u4e2a\u5408\u6cd5\u7684\u70b9\u5bf9\u3002\n\n\u6700\u540e\u52a0\u4e0a\u70b9\u5bf9 (lca,\u5b50\u6811\u5185\u6bcf\u4e2a\u70b9) \uff0c\u4e5f\u5c31\u662f $size[i]$ \u3002\n\n\u603b\u7b54\u6848 $size[i]+size[v]*(size[lca]-size[v])$ \u3002\n\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=1e9+7;\nint idx,n,r,m,res;\nint head[100010],size[100010],dep[100010],ans[100010];\nstruct node{\n\tint nxt,to;\n}edge[200010];\nvoid add(int u,int v)\n{\n\tedge[++idx].nxt=head[u];\n\tedge[idx].to=v;\n\thead[u]=idx;\n}\nvoid dfs(int now,int fath)\n{\n\tdep[now]=dep[fath]+1;\n\tsize[now]=1;\n\tfor(int i=head[now];i;i=edge[i].nxt)\n\t{\n\t\tint v=edge[i].to;\n\t\tif(v==fath)\n\t\tcontinue;\n\t\tdfs(v,now);\n\t\tsize[now]+=size[v];\n\t}\n}\nsigned main()\n{\n\tcin>>n>>r>>m;\n\tfor(int i=1;i<=n-1;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%lld%lld\",&u,&v);\n\t\tadd(u,v);\n\t\tadd(v,u); \n\t}\n\tdfs(r,0);\n\tfor(int i=1;i<=n;i++)//\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\n\t{\n\t\tans[i]=size[i];\n\t\tfor(int j=head[i];j;j=edge[j].nxt)\n\t\t{\n\t\t\tint v=edge[j].to;\n\t\t\tif(dep[v]<dep[i])\n\t\t\tcontinue;\n\t\t\tans[i]+=((size[i]-size[v])*size[v]);\n\t\t}\n\t} \n\twhile(m--)//O(1)\u67e5\u8be2 \n\t{\n\t\tint x;\n\t\tscanf(\"%lld\",&x);\n\t\tprintf(\"%lld\\n\",ans[x]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1601815145,
        "uid": 250699,
        "name": "Herkaii",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u6211\u4eec\u8003\u8651\u4ec0\u4e48\u60c5\u51b5\u4e0b\u70b9\u5bf9 $(u,v)$ \u7684 $LCA$ \u4e3a $p$\uff1f\u9996\u5148\uff0c$p$ \u5fc5\u987b\u662f $u,v$ \u7684\u7956\u5148\u3002\u7136\u540e\uff0c\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\u4e0b\uff1a\n\n- $u,v$ \u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u662f\uff08\u6216\u4e24\u4e2a\u90fd\u662f\uff09$p$\uff0c$LCA(u,v)=p$\u3002\n- $u,v$ \u5728 $p$ \u7684\u5b50\u6811\u4e2d\u7684\u4efb\u610f\u4e24\u68f5\u4e0d\u540c\u7684\u5b50\u6811\u4e2d\uff0c$LCA(u,v)=p$\u3002\u5982\u679c\u4ed6\u4eec\u5728\u540c\u4e00\u68f5\u5b50\u6811\u4e2d\u7684\u8bdd\uff0c\u90a3\u4e48\u4ed6\u4eec\u7684\u516c\u5171\u7956\u5148\u5c31\u4f1a\u6709\u8fd9\u68f5\u5b50\u6811\u7684\u6839\uff0c\u800c\u8fd9\u68f5\u5b50\u6811\u7684\u6839\u660e\u663e\u662f\u6bd4 $p$ \u66f4\u8fd1\u7684\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u60c5\u51b5\uff0c\u6211\u4eec\u628a\u7b54\u6848\u8bb0\u505a$ans1$\uff1b\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u628a\u7b54\u6848\u8bb0\u505a$ans2$\uff1b\u6700\u7ec8\u7ed3\u679c\u8bb0\u505a$Ans$\u3002\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\uff1a\n\n\u9996\u5148\uff0c\u5f53 $u,v$ \u90fd\u7b49\u4e8e $p$ \u65f6\uff0c\u8fd9\u79cd\u60c5\u51b5\u7684\u6570\u91cf\u4e3a $1$\u3002\u7136\u540e\uff0c\u53ea\u6709\u4e00\u4e2a\u7b49\u4e8e $p$ \u65f6\uff0c\u6570\u91cf\u4e3a $2 \\times (size_p - 1)$\uff08\u8fd9\u91cc $size_i$ \u8868\u793a $i$ \u7684\u5b50\u6811\u5927\u5c0f\uff0c\u4e0b\u540c\uff09\uff0c\u56e0\u4e3a $u = p$\u65f6\u4e3a$size_p - 1$\uff0c$v=p$ \u65f6\u4e5f\u4e00\u6837\uff0c\u6240\u4ee5\u8981\u4e58 $2$\u3002\u90a3\u4e48\uff0c\u6700\u7ec8\u7684 $ans1$ \u5c31\u662f\n\n$$ans1 = 2 \\times size_p - 1$$\n\n\u7136\u540e\u662f\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff1a\n\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5f88\u660e\u663e\u5c31\u53ef\u4ee5\u5f97\u5230\n\n$$ans2=\\sum\\limits_{i=1}^k \\sum\\limits_{j=1}^k size_{son_i} \\times size_{son_j}$$\n$$=\\sum\\limits_{i=1}^k size_{son_i} \\times (size_p - 1)$$\n$$=(size_p - 1) \\times (size_p - 1)$$\n\n(\u8fd9\u91cc\u7684 $son_i$ \u8868\u793a $p$ \u7684\u7b2c $i$ \u4e2a\u513f\u5b50\uff0c$k$ \u8868\u793a $p$ \u7684\u513f\u5b50\u6570\u91cf\uff0c\u4e0b\u540c)\n\n\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u770b\u4e0a\u53bb\u597d\u50cf\u6ca1\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u5fd8\u8bb0\u5904\u7406 $i = j$ \u7684\u60c5\u51b5\u4e86\u3002\u6240\u4ee5\u8fd8\u8981\u518d\u51cf\u53bb $\\sum\\limits_{i=1}^k size_{son_i} \\times size_{son_i}$\uff0c\u4e5f\u5c31\u662f\n\n$$ans2 = (size_p - 1) \\times (size_p - 1) - \\sum\\limits_{i=1}^k size_{son_i} \\times size_{son_i}$$\n\n\u90a3\u4e48\u6700\u7ec8\u7ed3\u679c\u5c31\u662f\n\n$$Ans=ans1+ans2$$\n$$= 2 \\times size_p - 1 + (size_p - 1) \\times (size_p - 1) - \\sum\\limits_{i=1}^k size_{son_i} \\times size_{son_i}$$\n$$= size_p \\times size_p - \\sum\\limits_{i=1}^k size_{son_i} \\times size_{son_i}$$\n\n\u7136\u540e\u5462\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a $m$ \u53ef\u80fd\u4f1a\u5927\u4e8e $n$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5 $O(n)$ \u9884\u5904\u7406\u51fa\u6240\u6709\u7684\u7b54\u6848\uff0c\u6700\u7ec8 $O(1)$ \u67e5\u8be2\u3002  \n\u53e6\u5916\uff0c\u8fd9\u9898\u7684 $Ans$ \u6700\u5927\u4e3a $n^2$\uff0c\u6240\u4ee5\u53d6\u4e0d\u53d6\u6a21\u90fd\u6ca1\u5173\u7cfb\u3002  \n\n**code:**\n```cpp\n#include<cstdio>\nusing namespace std;\nint n,r,m,size[10005],ans[10005];\n//size\u610f\u4e49\u540c\u4e0a\uff0cans\u4e3a\u7b54\u6848\nstruct graph//\u94fe\u5f0f\u524d\u5411\u661f\u5b58\u56fe\n{\n\tint tot;\n\tint hd[10005];\n\tint nxt[20005],to[20005];\n\tvoid add(int u,int v)\n\t{\n\t\ttot++;\n\t\tnxt[tot]=hd[u];\n\t\thd[u]=tot;\n\t\tto[tot]=v;\n\t\treturn ;\n\t}\n}g;\nvoid dfs(int now,int f)//\u9884\u5904\u7406\n{\n\tsize[now]=1;\n\tint sum=0;//sum\u5373\u4e3a\u4e0a\u9762\u7684\u5f0f\u5b50\u4e2d\u8981\u51cf\u53bb\u7684\u90a3\u4e00\u5768\n\tfor(int i=g.hd[now];i;i=g.nxt[i])\n\t\tif(g.to[i]!=f)//\u5224\u6389\u7236\u8282\u70b9\n\t\t{\n\t\t\tdfs(g.to[i],now);\n\t\t\tsize[now]+=size[g.to[i]];//\u8bb0\u5f55size\n\t\t\tsum+=size[g.to[i]]*size[g.to[i]];//\u8bb0\u5f55\u7b54\u6848\n\t\t}\n\tans[now]=size[now]*size[now]-sum;//\u8bb0\u5f55\u6700\u7ec8\u7b54\u6848\n\treturn ;\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&r,&m);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tg.add(u,v);\n\t\tg.add(v,u);\n\t}\n\tdfs(r,0);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint p;\n\t\tscanf(\"%d\",&p);\n\t\tprintf(\"%d\\n\",ans[p]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1597809029,
        "uid": 195331,
        "name": "Mine_King",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "$\\color{blue}{\\texttt{[Problem]}}$\n\n- \u7ed9\u4f60\u4e00\u68f5\u4ee5 $r$ \u4e3a\u6839\u7684\u542b\u6709 $n$ \u4e2a\u70b9\u7684\u6811\u548c\u4e00\u4e2a\u5e8f\u5217 $P_{1..m}$\u3002\n- \u8981\u6c42\u5bf9\u4e8e\u6bcf\u4e2a $P_i(1 \\leq i \\leq m)$\uff0c\u6c42\u51fa\u6709\u591a\u5c11\u5bf9 $(u_j,v_j)$ \u6ee1\u8db3 $u_j$ \u548c $v_j$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\uff08\u5373\u5e38\u8bf4\u7684 $\\texttt{LCA}$\uff09\u3002\n- \u7b54\u6848\u5bf9 $1 \\times 10^9+7$ \u53d6\u6a21\u3002$1 \\leq n \\leq 1 \\times 10^4,1 \\leq m \\leq 5 \\times 10^4$\u3002\n\n---------------------------------------\n\n$\\color{blue}{\\texttt{[Solution]}}$\n\n\u8bb0 $s_u$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6709\u591a\u5c11\u4e2a\u8282\u70b9\uff0c\u4e00\u904d `dfs`\uff0c\u5373\u53ef\u6c42\u51fa\u6240\u6709\u7684 $s_i(1\\leq i \\leq n)$\u3002\u8be5\u6b65\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n\u8003\u8651 $\\texttt{LCA}$ \u7684\u6027\u8d28\uff1a\u5982\u679c\u4e24\u4e2a\u8282\u70b9\u7684 $\\texttt{LCA}$ \u4e3a\u70b9 $u$\uff0c\u90a3\u4e48\u8981\u4e48\u5176\u4e2d\u4e00\u4e2a\u70b9\u662f\u70b9 $u$\uff0c\u53e6\u4e00\u4e2a\u70b9\u4e3a $u$ \u7684\u540e\u4ee3\uff0c\u8981\u4e48\u8fd9\u4e24\u4e2a\u70b9\u5206\u5c5e $u$ \u7684\u4e24\u68f5\u5b50\u6811\u3002\n\n\u914d\u4e0a\u56fe\u5e94\u8be5\u597d\u7406\u89e3\u4e00\u70b9\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200531134857604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pIVVlJTkdZRV8xMjM0NTY=,size_16,color_FFFFFF,t_70)\n\n\u8fd9\u662f\u6211\u4eec\u7684\u539f\u6811\uff0c\u7136\u540e\u6211\u4eec\u94a6\u5b9a\u4e00\u4e2a\u70b9\u4e3a $u$\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200531134947683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pIVVlJTkdZRV8xMjM0NTY=,size_16,color_FFFFFF,t_70)\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u4e24\u4e2a\u70b9\u4e2d\u6709\u4efb\u610f\u4e00\u4e2a\u70b9\u4e0d\u662f $u$ \u6216\u8005 $u$ \u7684\u540e\u4ee3\uff0c\u90a3\u4e48\u5b83\u4eec\u7684 $\\texttt{LCA}$ \u90fd\u4e0d\u53ef\u80fd\u662f $u$\u3002\n\n\u5f53\u4e00\u4e2a\u70b9\u662f $u$\uff0c\u53e6\u4e00\u4e2a\u70b9\u4e3a $u$ \u7684\u540e\u4ee3\u65f6\uff0c\u5927\u6982\u662f\u8fd9\u6837\uff1a\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200531135242593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pIVVlJTkdZRV8xMjM0NTY=,size_16,color_FFFFFF,t_70)\n\n\u7ea2\u8272\u6846\u7ebf\u4ee3\u8868\u6211\u4eec\u6240\u9009\u7684\u4e24\u70b9\uff0c\u663e\u7136\u5b83\u4eec\u7684 $\\texttt{LCA}$ \u5c31\u662f $u$\u3002\u5927\u5bb6\u53ef\u4ee5\u4e3e\u53e6\u5916\u7684\u4f8b\u5b50\u3002\n\n\u5f53\u4e24\u4e2a\u70b9\u90fd\u4e0d\u662f $u$ \u65f6\uff0c\u5b83\u4eec\u5fc5\u987b\u5206\u5c5e $u$ \u7684\u4e24\u68f5\u5b50\u6811\uff0c\u5176 $\\texttt{LCA}$ \u624d\u662f $u$\u3002\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200531135558929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pIVVlJTkdZRV8xMjM0NTY=,size_16,color_FFFFFF,t_70)\n\n\u5982\u56fe\uff0c\u5f53\u4e24\u4e2a\u70b9\u5728 $u$ \u7684\u540c\u4e00\u9897\u5b50\u6811\u65f6\uff0c\u663e\u7136\u5b83\u4eec\u7684 $\\texttt{LCA}$ \u4e0d\u662f $u$\u3002\n\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20200531135649578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pIVVlJTkdZRV8xMjM0NTY=,size_16,color_FFFFFF,t_70)\n\n\u53ea\u6709\u5f53\u4e24\u4e2a\u70b9\u5206\u5c5e $u$ \u7684\u4efb\u610f\u4e24\u68f5\u5b50\u6811\u65f6\uff0c\u5b83\u4eec\u7684 $\\texttt{LCA}$ \u624d\u662f $u$\u3002\n\n\u8003\u8651\u6bcf\u79cd\u60c5\u51b5\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff1a\n\n- \u60c5\u51b5\u4e00\uff1a\u5176\u4e2d\u7b2c\u4e00\u4e2a\u70b9\u662f $u$\uff0c\u53e6\u4e00\u4e2a\u70b9\u662f $u$ \u7684\u540e\u4ee3\uff0c\u6240\u4ee5\u603b\u7684\u53ef\u80fd\u60c5\u51b5\u4e3a $1 \\times (s_u-1)$ \u79cd\u3002\u6ce8\u610f\uff01\u7531\u4e8e\u672c\u9898\u5141\u8bb8\u6709 $u_j=v_j$ \u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u4e00\u5171\u6709 $s_u$ \u79cd\u65b9\u6848\u3002\u6ce8\u610f\u8fd9\u91cc\u4e0d\u5305\u62ec\u7b2c\u4e8c\u4e2a\u70b9\u4e3a $u$ \u7684\u60c5\u51b5\u3002\n- \u60c5\u51b5\u4e8c\uff1a\u6211\u4eec\u9009\u5b9a\u4e00\u4e2a\u70b9\u5728 $u$ \u7684\u4e00\u68f5\u5b50\u6811 $y$ \u4e2d\uff0c\u6709 $s_y$\uff0c\u53e6\u5916\u4e00\u4e2a\u70b9\u5373\u6709 $s_u-s_y$ \u79cd\u60c5\u51b5\uff0c\u6ce8\u610f\u53e6\u5916\u4e00\u4e2a\u70b9\u4e3a $u$ \u7684\u60c5\u51b5\u4e0a\u9762\u4e3a\u8003\u8651\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u9700\u8981\u51cf\u4e00\u3002\u603b\u65b9\u6848\u6570\u4e3a $s_y \\times (s_u-s_y)$\u3002\u679a\u4e3e $y$ \u5e76\u7edf\u8ba1\u5373\u53ef\u3002\n\n\u597d\uff0c\u65e2\u7136\u5982\u6b64\uff0c\u6211\u4eec\u518d\u6765\u4e00\u904d `dfs`\uff0c\u5206\u8fd9\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff0c\u5373\u53ef\u6c42\u51fa\u7b54\u6848\u3002\u5f53\u7136\u8fd9\u4e24\u904d `dfs` \u5176\u5b9e\u662f\u53ef\u4ee5\u5408\u5e76\u4e3a\u4e00\u904d\u7684\u3002\u53ef\u4ee5\u8bc1\u660e\u8fd9\u4e00\u6b65\u4e5f\u662f $O(n)$ \u7684\uff0c\u6240\u4ee5\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u66f4\u5927\u7684\u6570\u636e\uff08\u6bd4\u5982 $1 \\times 10^6$\uff09\u3002\n\n------------------------------------\n\n$\\color{blue}{\\texttt{[code]}}$\n\n```cpp\nconst int N=1e4+100;\nint ans[N],size[N],n,m;\nstruct edge{//\u94fe\u5f0f\u524d\u5411\u661f \n\tint next,to;//\u4e24\u91cf\u5b58\u56fe \n}e[N<<1];int h[N],tot,root;\ninline void add(int a,int b){\n\te[++tot]=(edge){h[a],b};h[a]=tot;\n\te[++tot]=(edge){h[b],a};h[b]=tot;\n}\nconst int mod=1e9+7;//\u8bb0\u5f97\u5bf91e9+7\u53d6\u6a21 \ninline int f(int a,int b){//\u65b9\u4fbf\u4f7f\u7528 \n\treturn (size[a]-size[b])*size[b]%mod;\n}//\u60c5\u51b5\u4e8c\u7684\u65b9\u6848\u6570\u8ba1\u7b97\uff08b\u4e3a\u6307\u5b9a\u513f\u5b50\uff09 \nvoid dfs_init_and_calc(int u,int fa){\n\tsize[u]=1;//\u6ce8\u610f\u521d\u59cb!u\u4e5f\u662f\u6709\u5927\u5c0f\u7684! \n\tfor(int i=h[u];i;i=e[i].next){//\u904d\u5386 \n\t\tregister int to=e[i].to;//to:\u513f\u5b50 \n\t\tif (to==fa) continue;//\u53ef\u884c\u6027\u5224\u65ad \n\t\tdfs_init_and_calc(to,u);//\u9012\u5f52\u8ba1\u7b97 \n\t\tsize[u]+=size[to];//\u7d2f\u52a0\u5b50\u6811\u7684\u5927\u5c0f \n\t}//\u524d\u534a\u6bb5:\u6c42\u4ee5u\u4e3a\u6839\u7684\u5b50\u6811\u7684\u5927\u5c0fsize[u] \n\tfor(int i=h[u];i;i=e[i].next){//\u904d\u5386 \n\t\tregister int to=e[i].to;//to:\u513f\u5b50 \n\t\tif (to==fa) continue;//\u53ef\u884c\u6027\u5224\u65ad \n\t\tans[u]=(ans[u]+f(u,to))%mod;//\u66f4\u65b0 \n\t}\n\tans[u]=(ans[u]+size[u])%mod;\n//\t\u6ce8\u610fLCA(u,u)\u4e5f\u7b49\u4e8eu,\u8fd9\u4e5f\u662f\u65b9\u6848 \n}//\u4e24\u904d dfs \u53ef\u4ee5\u5408\u5e76\u4e3a\u4e00\u904d\nint main(){\n//\tfreopen(\"t1.in\",\"r\",stdin);\n\tscanf(\"%d%d%d\",&n,&root,&m);\n\tfor(int i=1,u,v;i<n;i++){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v);//\u52a0\u5165\u8fb9(u,v) \n\t}\n\tdfs_init_and_calc(root,-1);\n\tfor(int i=1,u;i<=m;i++){\n\t\tscanf(\"%d\",&u);\n\t\tprintf(\"%d\\n\",ans[u]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1590905245,
        "uid": 95624,
        "name": "HPXXZYY",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6211\u662f\u7528\u641c\u7d22\u5957\u4e00\u4e2a\u6811\u578bdp\u7684\u601d\u60f3\u505a\u7684\uff0c~~\u53ef\u80fd\u6211\u592a\u5f31\u4e86\uff0c\u53ea\u4f1a\u641c\u7d22\u5427~~\u2026\u2026\n\n\u5e9f\u8bdd\u4e0d\u591a\u8bf4\uff0c\u8fd9\u9053\u9898\u53ef\u4ee5\u8003\u8651\u4e00\u4e2a\u7c7b\u4f3c\u6811\u578bdp\u7684\u601d\u60f3\uff0c\u5148\u6c42\u51fa\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u7684\u5b50\u6811\u7684\u7ed3\u70b9\u6570\uff0c\u8fd9\u91cc\u8bbe\u7b2ci\u4e2a\u7ed3\u70b9\u5b50\u6811\u7ed3\u70b9\u6570\u4e3af[i],\u7528\u641c\u7d22\u4ece\u4e0b\u5f80\u4e0a\u66f4\u65b0\u5373\u53ef\uff0c\u7136\u540e\u8fdb\u884c\u7b2c\u4e8c\u6b21\u641c\u7d22\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u4ee5i\u70b9\u4e3aLCA\u7684\u70b9\u5bf9\u7684\u4e2a\u6570\uff0c\u7b49\u4e8ef[i]+sigma(f[j]*(f[i]-f[j]))\uff0c\u5176\u4e2dj\u4e3ai\u7684\u5b50\u7ed3\u70b9\u3002\u7136\u540e\u8fd9\u6b21\u641c\u7d22\u81ea\u4e0a\u800c\u4e0b\u66f4\u65b0\u3002\u4e4b\u540e\u5c31\u53ef\u4ee5\u5148\u9884\u5904\u7406\u51faf\u6570\u7ec4\u548cans\u6570\u7ec4\uff0c\u6700\u540eO(1)\u67e5\u8be2\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u770b\u4ee3\u7801\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<cctype>\n#define ll long long\n#define maxn 10001\n#define mod 1000000007\nusing namespace std;\nint n,num,r,m,head[maxn],f[maxn];   //f\u4e3a\u4e00\u4e2a\u7ed3\u70b9\u7684\u5b50\u6811\u7ed3\u70b9\u4e2a\u6570\u3002\nll ans[maxn];               //ans\u5c31\u662f\u4ee5i\u70b9\u4e3aLCA\u7684\u70b9\u5bf9\u7684\u4e2a\u6570\uff0c\u6a21\u6570\u90fd\u5230\u4e861e9+7\u4e86\uff0c\u663e\u7136\u8981\u5f00long long\u3002\ninline int qread()             //\u5feb\u8bfb\u3002\n{\n\tchar c=getchar();int num=0,f=1;\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) num=num*10+c-'0';\n\treturn num*f;\n}\nstruct node\n{\n\tint v,nxt;\n}e[100001];\ninline void ct(int u,int v)    //\u94fe\u5f0f\u524d\u5411\u661f\u5b58\u56fe\u3002\n{\n\te[++num].v=v;\n\te[num].nxt=head[u];\n\thead[u]=num;\n}\nvoid dfs1(int u,int fa)    //\u7b2c\u4e00\u6b21\u641c\u7d22\uff0c\u66f4\u65b0f\u6570\u7ec4\u3002\n{\n\tf[u]=1;\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v!=fa)\n\t\t{\n\t\t\tdfs1(v,u);\n\t\t\tf[u]+=f[v];\t\n\t\t}\n\t}\n}\nvoid dfs2(int u,int fa)            //\u7b2c\u4e8c\u6b21\u641c\u7d22\uff0c\u66f4\u65b0ans\u6570\u7ec4\u3002\n{\n\tans[u]=f[u];\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v!=fa)\n\t\t{\n\t\t\tans[u]+=(f[v]*(f[u]-f[v]))%mod;\n\t\t\tans[u]%=mod;\n\t\t\tdfs2(v,u);\n\t\t}\n\t}\n}\nint main()\n{\n\tn=qread(),r=qread(),m=qread();\n\tfor(int i=1,u,v;i<n;++i)\n\t{\n\t\tu=qread(),v=qread();\n\t\tct(u,v);\n\t\tct(v,u);\n\t}\n\tdfs1(r,0);\n\tdfs2(r,0);\n\tfor(int i=1,u;i<=m;++i)        //O(1)\u67e5\u8be2\u3002\n\t{\n\t\tu=qread();\n\t\tcout<<ans[u]<<'\\n';\n\t}\n\treturn 0;\n}\n```\n\n\u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\uff0c\u6700\u597d\u8fd8\u662f\u81ea\u5df1\u5199\u3002",
        "postTime": 1541512188,
        "uid": 68622,
        "name": "King\u4e28\u5e1d\u5fa1\u5a01",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "# \u5176\u5b9e\u5f88\u7b80\u5355\u5566\n\u7531\u9898\u76ee\u7684\u610f\u601d\uff1a\n\n\u6211\u4eec\u5c31\u8981\u8003\u8651\u6bcf\u4e2a\u70b9\u7684\u7b54\u6848\u662f\u7531\u4ec0\u4e48\u8d21\u732e\u7684\uff0c\n\n\u4e8e\u662f\u6211\u4eec\u53d1\u73b0\u6bcf\u4e00\u4e2a\u70b9\u7684\u7b54\u6848\u5fc5\u7136\u662f\u548c\u4ed6\u7684\u513f\u5b50\u6709\u5173\u7684\n\u7ee7\u800c\u53d1\u73b0\uff0c\n\n## \u6bcf\u4e00\u4e2a\u70b9\u7684\u7b54\u6848\u5c31\u662f\n\n\u4ed6\u81ea\u8eab\u4e0e\u6240\u6709\u513f\u5b50\u7684\u8fde\u7ebf\u4e0e\u4ed6\u6240\u6709\u513f\u5b50\u4e2d$\u4efb\u610f\u4e24\u4e2a\u4e0d\u5728\u540c\u4e00\u4e2a\u5b50\u6811\u91cc\u9762\u7684\u513f\u5b50\u4e4b\u95f4\u7684\u8fde\u7ebf$\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u7edf\u8ba1\u7b54\u6848\u4e86\uff0c\u53ea\u8981\u4e00\u904ddfs\u5c31\u53ef\u4ee5\u5b8c\u6210\uff0c\u8981\u8bb0\u5f97 * 2\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u5bf9\u67092\u4e2a\u7b54\u6848\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstdlib>\n#include <algorithm>\n#include <cmath>\n#include <map>\n#include <cstring>\n#include <vector>\n#include <queue>\nusing namespace std;\n#define inf 0x3f3f3f3f\ntypedef long long ll;\nconst int oo=1e5+24;\nint n,rt,m,cnt;\nint h[oo];\nll ans[oo],siz[oo];\nstruct cx{\n    int nxt,to;\n}p[oo<<1];\ninline int reade_int(){\n    int x=0,f=0; char ch=getchar();\n    while(!isdigit(ch)) f|=(ch=='-'),ch=getchar();\n    while(isdigit(ch)) x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n    return f ? -x : x;\n}\nvoid adde(int x,int y){\n    p[++cnt].nxt=h[x];\n    p[cnt].to=y;\n    h[x]=cnt;\n}\nvoid dfs(int x,int fa){\n    siz[x]=1;\n    for(int i=h[x];i;i=p[i].nxt){\n        int u=p[i].to;\n        if(u==fa) continue ;\n        dfs(u,x);\n        ans[x]+=siz[u]*(siz[x]-1)*2;\n        siz[x]+=siz[u];\n    }\n    ans[x]+=siz[x]*2-1;\n    return ;\n}\nint main(){\n    n=reade_int(); rt=reade_int(); m=reade_int();\n    for(int i=1;i<n;i++){\n        int a=reade_int(),b=reade_int();\n        adde(a,b); adde(b,a);\n    }\n    dfs(rt,0);\n    for(int i=1;i<=m;i++){\n        int x=reade_int();\n        printf(\"%lld\\n\",ans[x]);\n    }\n    return 0;\n}\n```",
        "postTime": 1541410458,
        "uid": 70862,
        "name": "\u98ce\u706b",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u84bb\u849f\u7684\u7b2c\u4e00\u7bc7\u9898\u89e3\n\n------------\n\u7b2c\u4e00\u773c\u770b\u4e0a\u53bb\u611f\u89c9\u7528\u4e0d\u4e0alca,\u7136\u540e\uff0c\u771f\u7684\u7528\u4e0d\u4e0a\n\n\u6211\u4eec\u5206\u6790\u4e00\u4e0b\uff0c\u5bf9\u4e8e\u6709\u6839\u6811\u4e0a\u4e00\u70b9u\uff0c\u5982\u679c\u5b83\u662f\u4e24\u4e2a\u5176\u4ed6\u8282\u70b9\u7684lca\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u60c5\u51b5\u3002\n\n1.\u8fd9\u4e2a\u5176\u4ed6\u8282\u70b9\u4e2d\u7684\u4e00\u4e2a\u662fu\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cu\u8282\u70b9\u548c\u5176\u5b50\u6811\u4e0a\u7684\u4efb\u610f\u8282\u70b9\u7684lca\u4e3au\u8282\u70b9\u3002\n\n2.\u8fd9\u4e2a\u4e24\u4e2a\u8282\u70b9\u5206\u522b\u4e3au\u8282\u70b9\u5b50\u6811\u8282\u70b9\u4e14\u4e24\u4e2a\u8282\u70b9\u4e0d\u5728\u4e00\u4e2a\u5b50\u6811\u4e0a\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8bbenum[u]\u4e3au\u8282\u70b9\u53cau\u8282\u70b9\u4ee5\u4e0b\u6240\u6709\u8282\u70b9\u7684\u6570\u91cf\uff0cdp[u]\u4e3a\u4ee5u\u8282\u70b9\u4e3alca\u7684\u8282\u70b9\u7ec4\u5408\u6570\u91cf\u3002\u7531\u4e0a\u77e5\uff0c\u7b2c\u4e00\u79cd\u60c5\u51b5\u8d21\u732enum[u]\u5bf9\uff08\u4e00\u4e2a\u8282\u70b9\u662fu\u8282\u70b9\uff0c\u53e6\u4e00\u4e2a\u8282\u70b9\u6709num[u]\u79cd\u53ef\u80fd\uff09\u3002\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3eu\u8282\u70b9\u7684\u6bcf\u4e2a\u5b50\u8282\u70b9\uff0c\u5219\u8fd9\u4e2a\u5b50\u8282\u70b9\u4e0e\u5176\u4f59\u8282\u70b9\u4e5f\u4ea7\u751f\u8d21\u732e\uff0c\u5171\u6709$\\sum_{i=1}^{t}{(num[u]-zz[i])}$\u5bf9\u3002\n\ndp[u] = (num[u] + $\\sum_{i=1}^{t}{(num[u] - zz[i])}$) % mod\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\nconst int mod = 1e9 + 7;\nconst int N = 5e4 + 5;\nconst int inv2 = 500000004;\nll dp[N], num[N];\nstruct node \n{\n    int to, next;\n}edge[N];\nint head[N], tot = 0;\nint n, r, m;\nvoid add(int u, int v)\n{\n    edge[tot].to = v;\n    edge[tot].next = head[u];\n    head[u] = tot ++;\n}\nvoid dfs(int u, int fa)\n{\n    num[u] = 1;\n    vector <int> zz;\n    for(int i = head[u]; i != -1; i = edge[i].next)\n    {\n        int to = edge[i].to;\n        if(to == fa)\n            continue;\n        dfs(to, u);\n        zz.push_back(num[to]);\n        num[u] += num[to];\n    }\n    for(auto it : zz)\n    {\n        dp[u] = (dp[u] + (num[u] - it) * it % mod) % mod;\n    }\n    dp[u] = (dp[u] + num[u]) % mod;\n}\nint main()\n{\n    freopen(\"test.in\", \"r\", stdin);\n    ios::sync_with_stdio(false);\n    memset(head, -1, sizeof(head));\n    memset(dp, 0, sizeof(dp));\n    memset(num, 0, sizeof(num));\n    cin >> n >> r >> m;\n    for(int i = 0; i < n - 1; i ++)\n    {\n        int u, v;\n        cin >> u >> v;\n        add(u, v);\n        add(v, u);\n    }\n    dfs(r, 0);\n    while(m --)\n    {\n        int d;\n        cin >> d;\n        //cout << num[d] << endl;\n        cout << dp[d] << endl;\n    }\n}\n```\n",
        "postTime": 1566030950,
        "uid": 211915,
        "name": "three_trees",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "![](https://cdn.luogu.com.cn/upload/pic/37971.png)\n\n\u7531\u56fe\u53ef\u77e5\uff1a\n\n\u8ba1\u7b971\u65b9\u6848\u603b\u6570\u7684\u6b65\u9aa4\u4e3a\uff1a\n\n\u5b50\u68112\u65b9\u6848\u6570\uff1asize[2]*(size[1]-aize[2])=size[1]*size[2]-size[2]^2;\n\n\u5b50\u68113\u65b9\u6848\u6570:  size[3]*(size[1]-aize[3])=size[1]*size[3]-size[3]^2;\n\n1\u81ea\u5df1\u65b9\u6848\u6570\uff1asize[1];\n\nans[1]=\n\t\t\tsize[1]*size[2]-size[2]^2+size[1]*size[3]-size[3]^2+size[1]\uff1b\n\n        =size[1]*(1+size[2]+size[3])-size[2]^2-size[3]^2;\n        \n        =size[1]^2-size[2]^2-size[3]^2;\n\n\u7531\u6b64\u53ef\u77e5\uff1a\nans[x]=size[x]^2-(x\u7684\u5b50\u6811\u7684\u5e73\u65b9\u548c);\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e4+4,mod=1e9+7;\nint n,m,s;\nint size[N],ans[N];\nstruct ege{\n\tint v,next;\n}e[2*N];\nint h[2*N];\nint cnt;\nvoid add(int x,int y)\n{\n\tcnt++;\n\te[cnt].v=y;\n\te[cnt].next=h[x];\n\th[x]=cnt;\n}\nvoid find(int x,int fa)\n{\n\tsize[x]=1;\n\tint sum=0;\n\tfor(int i=h[x];i;i=e[i].next)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v==fa) continue;\n\t\tfind(v,x);\n\t\tsize[x]+=size[v];\n\t\tsum=(sum+size[v]*size[v])%mod;\n\t}\n\tans[x]=(size[x]*size[x]%mod-sum);\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&s,&m);\n\tfor(int i=1;i<=n-1;i++)\n\t{\n\t\tint a,b;\n\t\tscanf(\"%d%d\",&a,&b);\n\t\tadd(a,b);\n\t\tadd(b,a);\n\t}\n\tfind(s,0);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint p;\n\t\tscanf(\"%d\",&p);\n\t\tcout<<ans[p]<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1563970790,
        "uid": 203827,
        "name": "\u6c5fyyyz1911",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898emmmm\u81ea\u95ed\u4e86\u8bb8\u4e45\uff0c\u81ea\u5df1\u7684\u4ee3\u7801\u627e\u4e0d\u51fa\u53cd\u4f8b\u3002\u4e8e\u662f\u501f\u9274\u4e86@Chhokmah\u5bf9\u7ec4\u6570\u7684\u5904\u7406\u3002\n\n\u6211\u7684\u601d\u8def\u548c\u5927\u591a\u6570\u4eba\u5dee\u4e0d\u591a\uff0c\u5c31\u662fdfs\u5efa\u6811+\u4fdd\u5b58\u6bcf\u9897\u5b50\u6811\u7684size\u5927\u5c0f\u3002\n\n**\u4ee5\u4e0b\u662fAC\u4ee3\u7801**\n\n\u5148\u8d34\u6211\u7684dfs\u4ee3\u7801\n\n~~~\ninline void dfs(int temp){\n\tfor(int i=head[temp];i;i=edge[i].prev){\n\t\tint to=edge[i].to;if(to==fa[temp]) continue;\n                fa[to]=temp;\n\t\tdfs(to);size[to]++;size[temp]+=size[to];\n\t}\n}\n~~~\n\u8fd9\u4e2adfs\u51fd\u6570\u5e94\u8be5\u80fd\u770b\u61c2\u5427,\u4e0d\u8fc7\u8bb0\u5f97\u628a\u6839\u8282\u70b9size\u7684\u521d\u59cb\u503c\u521d\u59cb\u5316\u4e3a1\u3002\u56e0\u4e3a\u628a\u6bcf\u4e2a\u8282\u70b9\u7684size\u503c\u6253\u5370\u51fa\u6765\u5c31\u4f1a\u53d1\u73b0\u6839\u8282\u70b9\u7684size\u503c\u8981\u5c111\u3002\n\n~~~\ninline void solve(){\n    build(r);\n    fp(i,1,m){\n    \tint p=read();\n    \tif(Ans[p]!=0) {printf(\"%lld\\n\",Ans[p]);continue;}\n    \tint size_rest;\n    \tll num=size[p]*2-1;\n    \tfor(int j=head[p];j;j=edge[j].prev){\n    \t\tint to=edge[j].to;\n    \t\tif(to==fa[p]) continue;\n    \t\tsize_rest=size[p]-size[to]-1;\n    \t\tnum=(num+(size_rest*size[to]))%Mod;\n\t\t}\n\t\tAns[p]=num;\n\t\tprintf(\"%lld\\n\",num);\n\t}\n}\n~~~\nemmm\u8fd9\u90e8\u5206\u5c31\u662f\u501f\u9274\u4e86\u5927\u4f6c\u7684\u5904\u7406\u65b9\u6cd5\u4e86.....\n\u4e0b\u9762\u5c31\u76f4\u63a5\u8d34AC\u7684\u5168\u90e8\u4ee3\u7801\u5427\n~~~\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ninline int read(){\n\tchar c=getchar();int x=0,f=1;\n\twhile(c<'0'||c>'9'){if(c=='-') f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9') x=x*10+c-'0',c=getchar();\n\treturn x*f;\n}\ninline void out(int a){\n\tif(a<0){\n\t\tputchar('-');\n\t\ta=-a;\n\t}\n\tif(a>9) out(a/10);\n\tputchar(a%10+'0');\n}\nint n,r,m;\n#define maxium 60000\n#define fp(i,w,n) for(int i=w;i<=n;i++)\nstruct Edge{\n\tint to,prev;\n}edge[maxium*2];\nint head[20000],fa[20000],cnt;\ninline void add(int x,int y){\n\tedge[++cnt].to=y;\n\tedge[cnt].prev=head[x];\n\thead[x]=cnt;\n}\nint size[20000];\ninline void start(){\n\tn=read(),r=read(),m=read();\n\tfp(i,1,n-1){\n\t\tint x,y;x=read(),y=read();\n\t\tadd(x,y);add(y,x);\n\t}\n\tfp(i,1,n) fa[i]=i;\n\tsize[r]=1;\n}\ninline void dfs(int temp){\n\tfor(int i=head[temp];i;i=edge[i].prev){\n\t\tint to=edge[i].to;if(to==fa[temp]) continue;fa[to]=temp;\n\t\tdfs(to);size[to]++;size[temp]+=size[to];\n\t}\n}\ninline void build(int root){\n\tdfs(root);\n}\nll Ans[20000];\nconst int Mod=1e9+7;\ninline void solve(){\n    build(r);\n    fp(i,1,m){\n    \tint p=read();\n    \tif(Ans[p]!=0) {printf(\"%lld\\n\",Ans[p]);continue;}\n    \tint size_rest;\n    \tll num=size[p]*2-1;\n    \tfor(int j=head[p];j;j=edge[j].prev){\n    \t\tint to=edge[j].to;\n    \t\tif(to==fa[p]) continue;\n    \t\tsize_rest=size[p]-size[to]-1;\n    \t\tnum=(num+(size_rest*size[to]))%Mod;\n\t\t}\n\t\tAns[p]=num;\n\t\tprintf(\"%lld\\n\",num);\n\t}\n}\nint main(){\n\tstart();\n\tsolve();\n\treturn 0;\n}\n~~~",
        "postTime": 1557408178,
        "uid": 182410,
        "name": "RocketTurtle",
        "ccfLevel": 0,
        "title": "\u6d1b\u8c375002"
    },
    {
        "content": "\u4e00\u9053\u6bd4\u8f83\u6c34\u7684\u6811$dfs$\u9898\n\n\u6211\u4eec\u6765\u60f3\u4e00\u60f3\uff0c\u54ea\u4e9b\u70b9\u5bf9$(x,y)$\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u4f1a\u662f\u4e00\u4e2a\u70b9$p$\n\n$1.$ $x,y$\u5904\u4e8e$p$\u7684\u4e0d\u540c\u5b50\u6811\u5185\n\n$2.$ $x,y$\u4e2d\u6709\u4e00\u4e2a\u662f$p$\n\n\u5bf9\u4e8e\u60c5\u51b5$1$\uff0c\u6211\u4eec\u8bb2\u70b9$p$\u6240\u6709\u5b50\u6811\u7684$siz$\u4e24\u4e24\u76f8\u4e58\u5373\u53ef\uff0c\u4f46\u8981\u6ce8\u610f\u4e0d\u80fd\u679a\u4e3e\u5b50\u6811\uff0c\u4f1a\u88ab\u90a3\u79cd$n-1$\u53c9\u6811\u5361\u6b7b\uff0c\u7b54\u6848\u4e3a$\\sum_{x\\in P,y\\in P,x\\neq y} siz[x]*siz[y]$(\u8bbe$p$\u6240\u5728\u7684\u5b50\u6811\u7684\u7ed3\u70b9\u96c6\u5408\u4e3a$P$)\n\n\u5bf9\u4e8e\u60c5\u51b5$2$\uff0c\u6709\u4e00\u4e2a\u662f\u70b9$p$\uff0c\u53e6\u4e00\u4e2a\u70b9\u5728\u5176\u5b50\u6811\u5185\uff0c\u7b54\u6848\u5c31\u662f$siz[u]*2-1$(\u6709\u4e00\u4e2a\u70b9\u5bf9\u4e3a$(p,p)$\uff0c\u53ea\u80fd\u7b97\u4e00\u6b21)\n\n\u7136\u540e$dfs$\u4e00\u904d\u5c31\u597d\u4e86\n\n\u4ee3\u7801${1:}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nint n,r,m,fa[10010];\nlong long ans[10010],siz[10010];\nvector<int> out[10010];\nvoid dfs(int u)\n{\n    siz[u]=1;\n    for(int i=0;i<out[u].size();i++)\n    {\n        int v=out[u][i];\n        if(v==fa[u])\n        {\n            continue;\n        }\n        fa[v]=u;\n        dfs(v);\n        siz[u]+=siz[v];\n    }\n}\nvoid makeans(int u)\n{\n    for(int i=0;i<out[u].size();i++)\n    {\n        for(int j=0;j<out[u].size();j++)\n        {\n            if(i==j)\n            {\n                continue;\n            }\n            int v1=out[u][i],v2=out[u][j];\n            if(v1==fa[u])\n            {\n                break;\n            }\n            if(v2==fa[u])\n            {\n                continue;\n            }\n            ans[u]+=siz[v1]*siz[v2];\n            ans[u]%=mod;\n        }\n    }\n    ans[u]+=(siz[u]<<1)-1;\n    ans[u]%=mod;\n    for(int i=0;i<out[u].size();i++)\n    {\n        int v=out[u][i];\n        if(v==fa[u])\n        {\n            continue;\n        }\n        makeans(v);\n    }\n}\nint main()\n{\n    cin>>n>>r>>m;\n    for(int i=1;i<n;i++)\n    {\n        int x,y;\n        scanf(\"%d%d\",&x,&y);\n        out[x].push_back(y);\n        out[y].push_back(x);\n    }\n    dfs(r);\n    makeans(r);\n    for(int i=1;i<=m;i++)\n    {\n        int x;\n        scanf(\"%d\",&x);\n        printf(\"%d\\n\",ans[x]);\n    }\n}\n```\n\u5f88\u660e\u663e\uff0c\u8fd9\u79cd\u4f1a\u88ab$n-1$\u53c9\u6811\u5361\u6b7b\uff0c\u6211\u4eec\u9700\u8981\u4f18\u5316\n\n\u6ce8\u610f\u5230\u4e58\u6cd5\u5206\u914d\u5f8b\uff0c\u6709$ab+bc=(a+c)b$\uff0c\u5f88\u663e\u7136\uff0c\u5728\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u5b50\u6811\u4f1a\u548c\u5176\u4ed6\u6240\u6709\u5b50\u6811\u90fd\u4e58\u4e00\u904d\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u6811\uff0c\u76f4\u63a5\u7528\u5b83\u7684$siz$\u4e58\u4e0a\u603b$siz$\u51cf\u53bb\u5b83\u7684$siz$\u518d$-1$\u7684\u5dee\u5373\u53ef\n\n\u4ee3\u7801${2:}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nint n,r,m,fa[10010];\nlong long ans[10010],siz[10010];\nvector<int> out[10010];\nvoid dfs(int u)\n{\n    siz[u]=1;\n    for(int i=0;i<out[u].size();i++)\n    {\n        int v=out[u][i];\n        if(v==fa[u])\n        {\n            continue;\n        }\n        fa[v]=u;\n        dfs(v);\n        siz[u]+=siz[v];\n    }\n}\nvoid makeans(int u)\n{\n    for(int i=0;i<out[u].size();i++)\n    {\n        int v=out[u][i];\n        if(v==fa[u])\n        {\n            continue;\n        }\n        ans[u]+=siz[v]*(siz[u]-siz[v]-1);\n        ans[u]%=mod;\n    }\n    ans[u]+=(siz[u]<<1)-1;\n    ans[u]%=mod;\n    for(int i=0;i<out[u].size();i++)\n    {\n        int v=out[u][i];\n        if(v==fa[u])\n        {\n            continue;\n        }\n        makeans(v);\n    }\n}\nint main()\n{\n    cin>>n>>r>>m;\n    for(int i=1;i<n;i++)\n    {\n        int x,y;\n        scanf(\"%d%d\",&x,&y);\n        out[x].push_back(y);\n        out[y].push_back(x);\n    }\n    dfs(r);\n    makeans(r);\n    for(int i=1;i<=m;i++)\n    {\n        int x;\n        scanf(\"%d\",&x);\n        printf(\"%d\\n\",ans[x]);\n    }\n}\n```",
        "postTime": 1545484470,
        "uid": 48265,
        "name": "decoqwq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5002 \u3010\u4e13\u5fc3OI - \u627e\u7956\u5148\u3011"
    }
]