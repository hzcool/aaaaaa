[
    {
        "content": ">[\u66f4\u5570\u55e6\u7684\u9898\u89e3](http://bubbleioa.top/archives/828)\n\n\n## \u9898\u89e3\n\n\n\u7531\u4e8e\u4e0e\u8fd0\u7b97\u548c\u6216\u8fd0\u7b97\u5728\u6bcf\u4e00\u4f4d\u4e0a\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5bf9\u6bcf\u4e00\u4f4d\u8fdb\u884c\u8ba1\u7b97\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u4e0e\u8fd0\u7b97\uff08\u5176\u5b9e\u4e24\u4e2a\u8fd0\u7b97\u662f\u4e00\u6837\u7684\uff09  \n\u4e8e\u662f\u5c31\u6210\u4e86\u4e00\u4e2a\u6c42\u4e00\u4e2a\u77e9\u9635\u4e2d\uff0c\u6709\u591a\u5c11\u4e2a0/1\u5b50\u77e9\u9635\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7528\u5355\u8c03\u6808\u505a\u3002\n\n\u6709\u4e00\u4e2a\u663e\u7136\u7684\u7ed3\u8bba\n\n> \u5728\u4e00\u4e2a $N\\times M$ \u7684\u77e9\u9635\u4e2d\uff0c\u4ee5(n,m)\u4e3a\u53f3\u4e0b\u89d2\u7684\u5b50\u77e9\u9635\u5171\u6709 $N\\times M$ \u4e2a\n\n\u5177\u4f53\u6765\u8bb2\uff0c\u6211\u4eec\u8981\u6c42\u51fa\u4e00\u4e2as\u4e8c\u7ef4\u6570\u7ec4\uff0cs[i][j]\u8868\u793a(i,j)\u70b9\u4e0a\u65b9\u6709\u591a\u5c11\u4e2a\u8fde\u7eed\u76841\uff0c$O(N^2)$\u9884\u5904\u7406\n\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u6211\u4eec\u6765\u8ba1\u7b97**\u4ee5\u5b83\u4e3a\u53f3\u4e0b\u89d2**\u7684\u5b50\u77e9\u9635\u4e2a\u6570\n\u5bf9\u4e8e\u4e00\u822c\u60c5\u51b5\uff0c\u57282\u5904\uff0cA\u533a\u57df\u5c31\u6ca1\u6709\u610f\u4e49\uff0c4\u5904\uff0cB\u533a\u57df\u5c31\u6ca1\u6709\u610f\u4e49\n![](https://cdn.luogu.com.cn/upload/pic/56750.png)\n\u6240\u4ee5\u6211\u4eec\u8981\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6808\uff0c\u6808\u4e2d\u5143\u7d20k\u8981\u6ee1\u8db3s[i][k]\u5355\u8c03\u9012\u589e\uff08\u6808\u9876s[i][k]\u6700\u5927\uff09\n\n\u6bcf\u6b21\u6709\u5143\u7d20\u51fa\u6808\u65f6\uff0c\u8bf4\u660e\u6709\u90e8\u5206\u7b54\u6848\u4e0d\u80fd\u4ea7\u751f\u8d21\u732e\uff0c\u89c1\u4ee3\u7801\u6ce8\u91ca\n\n\u5bf9\u4e8e\u6216\u8fd0\u7b97\uff0c\u6c42\u6240\u67090\u5b50\u77e9\u9635\uff0c\u5168\u96c6-0\u5b50\u77e9\u9635\u6570\u76ee\u5373\u662f\u8d21\u732e\u3002\n\n\u76f4\u63a5\u590d\u5236\u8fd9\u4e2a\u4ee3\u7801\u4f1aT  \nch\u4e0a\u8fd9\u6837\u662f\u8fc7\u5f97\u4e86\u7684\uff0c\u4f46\u662fluogu\u4e0a\u4f60\u9700\u8981\u52a0\u4e00\u4e2a\u5feb\u8bfb\n\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int MAXN=2003,mod=1e9+7;\nint ma[MAXN][MAXN];\nint s[MAXN][MAXN];\nint stk[MAXN],top;\nint n;\nll ans1,ans2;\n\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tscanf(\"%d\",&ma[i][j]);\n\t\t}\n\t}\n\tfor(int k=0;k<31;k++){\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\tif((ma[i][j]>>k)&1)s[i][j]=s[i-1][j]+1;\n\t\t\t\telse s[i][j]=0;\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tll ans=0;top=0;\n\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\tans+=s[i][j];\n\t\t\t\twhile(top&&s[i][stk[top]]>=s[i][j]){\n\t\t\t\t\tans-=(stk[top]-stk[top-1])*(s[i][stk[top]]-s[i][j]);\n\t\t\t\t\t//\u6808\u9876\u5bf9\u4e8e\u7b2c\u4e8c\u5927\u7684\u5143\u7d20\u7684\u8ddd\u79bb\u00d7\u6808\u9876\u4e0ej\u7684\u843d\u5dee\uff0c\u5373\u4e3a\u4e0a\u56fe\u4e2dj=3\u65f6\u7070\u8272\u7ebf\u7684\u4e0a\u534a\u90e8\u5206\n\t\t\t\t\ttop--;\n\t\t\t\t}\n\t\t\t\tans1+=ans<<k;\n\t\t\t\tans1%=mod;\n\t\t\t\tstk[++top]=j;\n\t\t\t}\n\t\t}\n\t}\n\tcout<<ans1<<\" \";\n\tfor(int k=0;k<31;k++){\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\tif((ma[i][j]>>k)&1)s[i][j]=0;\n\t\t\t\telse s[i][j]=s[i-1][j]+1;\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tll ans=0;top=0;\n\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\tans+=s[i][j];\n\t\t\t\twhile(top&&s[i][stk[top]]>=s[i][j]){\n\t\t\t\t\tans-=(stk[top]-stk[top-1])*(s[i][stk[top]]-s[i][j]);\n\t\t\t\t\ttop--;\n\t\t\t\t}\n\t\t\t\tans2+=(i*j-ans)<<k;\n\t\t\t\tans2%=mod;\n\t\t\t\tstk[++top]=j;\n\t\t\t}\n\t\t}\n\t}\n\tcout<<ans2<<endl;\n\t\t\n\treturn 0;\n}\n```\n",
        "postTime": 1555414445,
        "uid": 61150,
        "name": "\u5192\u6ce1ioa",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "~~\u6d4b\u8bd5\u4e00\u5f00\u59cb\u770b\u9519\u9898\u76ee\u6572\u4e86\u4e24\u5c0f\u65f6\uff0c\u53d1\u73b0\u662f\u4e2a\u6c34\u9898~~\n\n---\n\u76ee\u524d\u662f\u6d1b\u5495rk1 ~~\uff08\u5f00\u4e86O2\u7684\u90a3\u79cd\uff09~~  \n\n\u505a\u6cd5\u8f83\u4e3a\u7384\u5b66\uff0c\u6ca1\u6709\u5355\u8c03\u6808 ~~\u56e0\u4e3a\u4e0d\u4f1a~~  \n\n---\n\u9996\u5148\u628a $ and $ \u8f6c\u5316\u6210 $ or $ \uff0c\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u5199\u534a\u9053\u9898\u4e86  \n\n\n\u663e\u7136\u5bf9\u4e8e\u67d0\u4e00\u4e8c\u8fdb\u5236\u4f4d,\u6211\u4eec\u9700\u8981\u6c42\u51fa\u6b64\u4f4d $ or $ \u548c\u4e3a $ 1 $ \u7684\u5b50\u77e9\u9635\u4e2a\u6570\u3002  \n\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4f5c\u4e3a\u53f3\u4e0b\u89d2\uff0c\u8bb0 $ s_i $ \u4e3a\u5230\u5f53\u524d\u884c\u4e3a\u6b62\uff0c\u5f53\u524d\u4f4d\u4e3a $ 1 $ \u7684\u6570\u6700\u540e\u51fa\u73b0\u65f6\u7684\u6240\u5728\u884c\u3002\u90a3\u4e48\u901a\u8fc7\u753b\u56fe\u53ef\u77e5\uff0c\u8fd9\u4e00\u4f4d\u4f5c\u4e3a\u53f3\u4e0b\u89d2\u7684\u8d21\u732e\u5c31\u662f\u4ee5\u5f53\u524d\u5217\u4f5c\u4e3a\u53f3\u7aef\u70b9\u4f5c\u540e\u7f00 $ Max $ \uff0c\u518d\u628a\u540e\u7f00 $ Max $ \u52a0\u8d77\u6765\u7684\u548c\u3002  \n\n\u56e0\u4e3a\u540e\u7f00 $ Max $ \u662f\u5355\u8c03\u7684\uff0c\u800c\u4e14\u6bcf\u6b21\u4fee\u6539\u53ea\u6709\u4e00\u79cd\u64cd\u4f5c\uff1a\u628a\u67d0\u4e2a\u4f4d\u7f6e\uff08\u6b64\u4f4d\u4e3a $ 1 $\uff09\u6539\u6210\u6700\u5927\u503c\uff08\u5f53\u524d\u884c\u53f7\uff09\u3002\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e\u8bb0 $ Pre_i $ \uff0c\u8868\u793a\u5728\u4ed6\u4e4b\u524d\u6700\u540e\u4e00\u4e2a\u6bd4\u4ed6\u5927\u7684\uff0c\u53ef\u4ee5\u53d1\u73b0\u6bcf\u4e2a\u4f4d\u7f6e\u540e\u7f00\u6700\u5927\u503c\u548c\u53ef\u4ee5\u7528\u8fd9\u4e2a $ Pre $ \u6c42\u51fa\u3002\u8003\u8651\u4e00\u6b21\u4fee\u6539\u7684\u5f71\u54cd\uff0c\u6211\u4eec\u53ea\u8981\u626b\u4e00\u904d\uff0c\u8bb0\u4e0b\u6700\u540e\u4e00\u4e2a\u6539\u6210\u6700\u5927\u503c\u7684\u4f4d\u7f6e\uff0c\u518d\u548c\u5f53\u524d\u4f4d\u7684 $ Pre $ \u53d6\u6700\u5927\u5c31\u53ef\u4ee5\u4e86\u3002  \n\n\u65f6\u95f4\u6548\u7387 $ O(n^2log) $  \n\n~~\u800c\u4e14\u4ee3\u7801\u5f88\u77ed\u7684\u5c310.7k~~\n\n\n```cpp\n#include<cstdio>\n#define L long long\nconst L p=1e9+7,N=1002,u=(1ll<<31)-1;\nL n,a[N][N],s[N],v[N],r[N],A,O;\ninline L S(L k) {\n\tL c=0;for(L j=1;j<=n;j++) s[j]=r[j]=0;\n\tfor(L i=1;i<=n;i++)\n\t\tfor(L j=1,w=0;j<=n;j++) {\n\t\t\tif(a[i][j]>>k&1) s[j]=i,r[w=j]=0;\n\t\t\telse if(w>r[j]) r[j]=w;\n\t\t\tv[j]=v[r[j]]+s[j]*(j-r[j]);\n\t\t\tc+=v[j];if(c>=p) c-=p;\n\t\t}return c*(1ll<<k)%p;\n}\nint main() {\n\tscanf(\"%lld\",&n);\n\tfor(L i=1;i<=n;i++) for(L j=1;j<=n;j++)\n\t\tscanf(\"%lld\",&a[i][j]);\n\tfor(L i=0;i<=30;i++) if((O+=S(i))>=p) O-=p;\n\tfor(L i=1;i<=n;i++) for(L j=1;j<=n;j++) {\n\t\ta[i][j]^=u;if((A+=i*j*u%p)>=p) A-=p;\n\t}\n\tfor(L i=0;i<=30;i++) if((A-=S(i))<0) A+=p;\nreturn printf(\"%lld %lld\\n\",A,O),0;}\n```\n",
        "postTime": 1556972828,
        "uid": 89412,
        "name": "szm_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "\u9898\u76ee\u5730\u5740\uff1a[P5300 [GXOI/GZOI2019]\u4e0e\u6216\u548c](https://www.luogu.org/problemnew/show/P5300)\n\n\u8003\u8651\u6309\u4f4d\u8ba1\u7b97\u8d21\u732e\n\n\u5bf9\u4e8e **AND** \u8fd0\u7b97\uff0c\u53ea\u6709\u5168 $1$ \u5b50\u77e9\u9635\u624d\u4f1a\u6709\u8d21\u732e\n\n\u5bf9\u4e8e **OR** \u8fd0\u7b97\uff0c\u6240\u4ee5\u975e\u5168 $0$ \u5b50\u77e9\u9635\u5747\u6709\u8d21\u732e\n\n\u5982\u679c\u6c42\u4e00\u4e2a **01** \u77e9\u9635\u4e2d\u5168 $0/1$ \u5b50\u77e9\u9635\u7684\u4e2a\u6570\u5462\uff1f\n\n\u5355\u8c03\u6808\u53ef\u4ee5 $O(n^2)$ \u5b9e\u73b0\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2k)$ \u5176\u4e2d $k$ \u662f\u4e8c\u8fdb\u5236\u4f4d\u6570\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N = 1e3 + 6, P = 1e9 + 7;\nint n, a[N][N], h[N], s[N], w[N], p;\nll ans[2];\n\ninline ll get(int x) {\n\treturn (1ll * x * (x + 1)) >> 1;\n}\n\ninline ll calc(int o) {\n\tll cnt = 0;\n\tfor (int j = 1; j <= n; j++) h[j] = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tfor (int j = 1; j <= n; j++) {\n\t\t\tif ((a[i][j] & 1) == o) ++h[j];\n\t\t\telse h[j] = 0;\n\t\t\tif (h[j] > s[p]) s[++p] = h[j], w[p] = 1;\n\t\t\telse {\n\t\t\t\tint k = 0;\n\t\t\t\twhile (s[p] > h[j]) {\n\t\t\t\t\tk += w[p];\n\t\t\t\t\tcnt += (s[p] - max(s[p-1], h[j])) * get(k);\n\t\t\t\t\t--p;\n\t\t\t\t}\n\t\t\t\ts[++p] = h[j], w[p] = k + 1;\n\t\t\t}\n\t\t}\n\t\tint k = 0;\n\t\twhile (p) {\n\t\t\tk += w[p];\n\t\t\tcnt += (s[p] - s[p-1]) * (get(k));\n\t\t\t--p;\n\t\t}\n\t}\n\treturn cnt % P;\n}\n\nvoid work(int o) {\n\tif (o == 32) return;\n\tans[0] += calc(1) * (1 << o) % P, ans[0] %= P;\n\tans[1] += (get(n) * get(n) % P - calc(0)) * (1 << o) % P, ans[1] %= P;\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\ta[i][j] >>= 1;\n\twork(o + 1);\n}\n\nint main() {\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\tscanf(\"%d\", &a[i][j]);\n\twork(0);\n\tcout << (ans[0] + P) % P << \" \" << (ans[1] + P) % P << endl;\n\treturn 0;\n}\n```",
        "postTime": 1555432732,
        "uid": 100544,
        "name": "xht",
        "ccfLevel": 9,
        "title": "P5300 [GXOI/GZOI2019]\u4e0e\u6216\u548c"
    },
    {
        "content": "\u8fd9\u4e2a\u9898\u7684\u8bc4\u7d2b\u4e3b\u8981\u8fd8\u662f\u56e0\u4e3a\u6570\u636e\uff0c\u5982\u679c\u7ed9\u51e0\u4e2a$ai <= 1$\u7684\u6d4b\u8bd5\u70b9\uff0c\u76f8\u4fe1\u8fd9\u4e2a\u9898\u80af\u5b9a\u4f1a\u662f\u4e00\u4e2a\u84dd\u9898\u7684\u3002\n\n\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c&\u4e0e|\u8fd9\u4e24\u4e2a\u4f4d\u8fd0\u7b97\uff0c\u90fd\u6709\u4e00\u4e2a\u6027\u8d28\uff0c\u5c31\u662f\u6bcf\u4e00\u4f4d\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\u3002\n\n\u7531\u9898\u610f\u5f97\uff0cai <= $2^{31}$ \u2212 1\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e2a\u6570\u5206\u621031\u4f4d\uff0c\u6bcf\u4e00\u4f4d\u5206\u522b\u8003\u8651\u3002\n\n\u6240\u4ee5\u8f6c\u5316\u6210\u8fd9\u4e48\u4e00\u4e2a\u95ee\u9898\uff0c\u6709\u4e00\u4e2a\u77e9\u9635\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u503c\u8981\u4e48\u4e3a0\uff0c\u8981\u4e48\u4e3a1\u3002\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u77e9\u9635\u6ee1\u8db3\u77e9\u9635\u5404\u4e2a\u4f4d\u7f6e\u5168\u90e8\u662f1\uff08\u5373&\u8fd0\u7b97\uff09,\u6709\u591a\u5c11\u4e2a\u5b50\u77e9\u9635\u6ee1\u8db3\u8be5\u5b50\u77e9\u9635\u5404\u4e2a\u4f4d\u7f6e\u81f3\u5c11\u6709\u4e00\u4e2a1(\u5373|\u8fd0\u7b97)\u3002\n\n\u81f3\u5c11\u6709\u4ec0\u4e48\u4ec0\u4e48\uff0c\u901a\u5e38\u5f88\u96be\u6c42\uff0c\u6240\u4ee5\u53ef\u4ee5\u505a\u4e00\u4e2a\u5bb9\u65a5\u8f6c\u6362\uff0c\u5c31\u50cf\u662f\u9ad8\u4e2d\u6570\u5b66\u9898\uff0c\u6b63\u96be\u5219\u53cd\u561b\uff0c\u6211\u4eec\u53ef\u4ee5\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u77e9\u9635\u6ee1\u8db3\u77e9\u9635\u5404\u4e2a\u4f4d\u7f6e\u5168\u90e8\u662f0\uff0c\u7136\u540e\u7528\u603b\u5b50\u77e9\u9635\u6570-\u8fd9\u4e2a\u7b54\u6848\uff0c\u4e00\u4e2a$n * n$\u7684\u65b9\u9635\uff0c\u5b50\u77e9\u9635\u6570\u76ee = $C_{n + 1}^2 * C_{n + 1}^2$\u7684\uff0c\u56e0\u4e3a\u6709$n + 1$\u6761\u6a2a\u7ebf\u4e0e\u7ad6\u7ebf\uff0c\u6bcf\u4e2a\u5b50\u77e9\u9635\u90fd\u662f\u4e24\u6761\u7ad6\u7ebf\u4e0e\u4e24\u6761\u6a2a\u7ebf\u5708\u8d77\u6765\u7684\uff0c\u6839\u636e\u7ec4\u5408\u6570\u77e5\u8bc6\u53ef\u6c42\u51fa\u4ee5\u4e0a\u7ed3\u679c\u3002\n\n\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u5c31\u662f\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u77e9\u9635\u6ee1\u8db3\u77e9\u9635\u5404\u4e2a\u4f4d\u7f6e\u5168\u90e8\u662f1\uff0c0\u7684\u8bdd\u540c\u7406\u53ef\u505a\u3002\u6211\u4eec\u679a\u4e3e\u5b50\u77e9\u9635\u7684\u53f3\u4e0b\u7aef\u70b9\uff0c\u8003\u8651\u753b\u56fe\u4e0e\u6728\u6876\u539f\u7406\u53ef\u77e5\uff0c\u5b83\u5bf9\u5e94\u7684\u6240\u6709\u5408\u6cd5\u5b50\u77e9\u9635\u7684\u5de6\u4e0a\u7aef\u70b9\u7684\u53ef\u53d6\u503c\u8303\u56f4\u4e00\u5b9a\u662f\u4e00\u4e2a\u5f62\u5982\u8fd9\u4e2a\u6837\u5b50\u7684\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dp7m8z44.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u663e\u7136\u5bf9\u4e8e\u8fd9\u79cd\u6ee1\u8db3\u5355\u8c03\u6027\u6027\u8d28\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5355\u8c03\u6808\u7ef4\u62a4\uff0c\u5177\u4f53\u7ec6\u8282\u8be6\u89c1\u4ee3\u7801\u4e0e\u6ce8\u91ca\u3002\n\n\u590d\u6742\u5ea6O\uff08$n^2logV$)\uff0cV = $2^{31}$ \u2212 1\u3002\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define maxn 1005\n#define int long long\n#define mod 1000000007\n#define For(i, j, n) for(register int i = j ; i <= n ; ++i) \nint n, num, ansa, anso;\nint stk[maxn], a[maxn][maxn], b[maxn][maxn], up[maxn][maxn], cnt[maxn][maxn];\n//up[i][j]\u4ee3\u8868\u77e9\u9635\u7b2ci\u884c\u7b2cj\u5217\u7684\u70b9\u7684\u5408\u6cd5\u9ad8\u5ea6, cnt[i][j]\u4ee3\u8868\u4ece\u77e9\u9635\u7b2ci\u884c\u7b2cj\u5217\u7684\u70b9\u5de6\u8fb9\u5408\u6cd5\u9ad8\u5ea6\u5927\u4e8e\u7b49\u4e8e\u8fd9\u4e2a\u70b9\u7684\u5408\u6cd5\u9ad8\u5ea6\u7684\u5bbd\u5ea6\n\ninline int solve(int x){\n\tint ans = 0;\n\tmemset(up, 0, sizeof(up));\n\tFor(i, 1, n) For(j, 1, n) if(b[i][j] == x) up[i][j] = up[i - 1][j] + 1;\n\tFor(i, 1, n){\n\t\tint top = 0, sum = 0;\n\t\tFor(j, 1, n){\n\t\t\tcnt[i][j] = 1;\n\t\t\tfor( ; top && up[i][stk[top]] >= up[i][j] ; --top) sum -= cnt[i][stk[top]] * up[i][stk[top]], cnt[i][j] += cnt[i][stk[top]];\n\t\t\tsum += cnt[i][j] * up[i][j], ans += sum, stk[++top] = j;\n\t\t}\n\t}\n\treturn ans % mod;\n}\n\nsigned main(){\n\tscanf(\"%lld\", &n), num = n * n * (n + 1) * (n + 1) / 4;\n\tFor(i, 1, n) For(j, 1, n) scanf(\"%lld\", &a[i][j]);\n\tFor(i, 0, 30){\n\t\tFor(j, 1, n) For(k, 1, n) b[j][k] = a[j][k] & 1, a[j][k] >>= 1;\n\t\tansa = (ansa + (solve(1) << i)) % mod , anso = (anso + ((num - solve(0)) % mod << i)) % mod;\n\t}\n\tprintf(\"%lld %lld\", ansa, anso);\n\treturn 0;\n}\n```",
        "postTime": 1586263950,
        "uid": 163980,
        "name": "\u884c\u541f\u5578\u4e5d\u5dde",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "\u8fd9\u4e0d\u4e0e[[WC2015]\u672a\u6765\u7a0b\u5e8f](https://www.luogu.org/problemnew/show/P4920)\u7684\u7b2c$5$\u4e2a\u6d4b\u8bd5\u70b9\u662f\u4e00\u4e2a\u9898\u4e48\u3002\u3002\u3002\n\n\u4e8c\u8fdb\u5236\u6bcf\u4e00\u4f4d$1$\u5355\u72ec\u8003\u8651\u3002\n\nAND\uff1a\u6c42\u6709\u591a\u5c11\u4e2a\u5168$1$\u5b50\u77e9\u9635\n\nOR\uff1a\u6c42\u6709\u591a\u5c11\u4e2a\u5168$0$\u5b50\u77e9\u9635\uff0c\u518d\u7528\u603b\u77e9\u9635\u51cf\u53bb\n\n\u5355\u8c03\u6808\u7ef4\u62a4\u4ee5$a[i][j]$\u4e3a\u53f3\u4e0b\u89d2\u7684\u7b54\u6848\uff0c\u5373\u7ef4\u62a4\u4e00\u4e2a\u68af\u5f62\u9762\u79ef\u3002\n\n```cpp\n#include<cstdio>\n#include<stack>\nusing namespace std;\nconst int N=1005;\nconst int mod=1e9+7;\nint n,A[N][N],AND,OR,qwq;\nint a[N][N],data[N][N],Ans,ans;\ntypedef pair<int,int>pr;\nstack<pr>s;\nvoid clear(){while(s.size())s.pop();ans=0;}\nint count(){\n    Ans=0;\n    for(int i=1;i<=n;i++)\n    for(int j=1;j<=n;j++)\n    a[i][j]=data[i][j]*(a[i-1][j]+1);\n    //\u5904\u7406\u6bcf\u4e2a1\u5411\u4e0a\u7684\u6700\u5927\u5ef6\u4f38\u957f\u5ea6\n    for(int i=1;i<=n;i++){\n        clear();//\u521d\u59cb\u5316\n        for(int j=1;j<=n;j++){\n            if(!a[i][j]){clear();continue;}//\u8be5\u70b9\u4e3a0\uff0c\u6e05\u7a7a\u6808\n            int siz=1;\n            while(s.size()&&s.top().first>=a[i][j]){\n                siz+=s.top().second;\n                ans=(ans-1ll*s.top().first*s.top().second%mod+mod)%mod;\n                s.pop();//\u4e0d\u80fd\u4f5c\u4e3a\u5de6\u4e0a\u7aef\u70b9\u7684\u51cf\u53bb\n            }\n            s.push(pr(a[i][j],siz));//\u63d2\u5165\n            ans=(ans+1ll*a[i][j]*siz%mod)%mod;\n            Ans=(Ans+ans)%mod;//\u8ba1\u7b97\u7b54\u6848\n        }\n    }\n    return Ans;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) \n\tfor(int j=1;j<=n;j++)scanf(\"%d\",&A[i][j]);\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=1;j<=n;j++)qwq=(qwq+i*j)%mod;//\u6c42\u603b\u77e9\u9635\u6570\n\tfor(int i=1073741824;i>=1;i>>=1){\n\t\tfor(int j=1;j<=n;j++)\n\t\tfor(int k=1;k<=n;k++)data[j][k]=(A[j][k]&i)>0;//\u6bcf\u4e00\u4f4d\u5206\u5f00\u8003\u8651\n\t\tAND=(AND+1ll*count()*i%mod)%mod;//AND\n\t\tfor(int j=1;j<=n;j++)\n\t\tfor(int k=1;k<=n;k++)data[j][k]=!data[j][k];\n\t\tOR=(OR+1ll*(qwq-count()+mod)%mod*i%mod)%mod;//\u603b\u77e9\u9635\u51cf\u53bb\n\t}\n\tprintf(\"%d %d\\n\",AND,OR);\n} \n```",
        "postTime": 1555420557,
        "uid": 50092,
        "name": "da32s1da",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "### Analysis\n\n\u9996\u5148\u4e8c\u8fdb\u5236\u6bcf\u4e00\u4f4d\u5206\u5f00\u8003\u8651\u8d21\u732e\uff0c\u82e5\u4ee5 $\\mathtt{AND}$ \u503c\u4e4b\u548c\u4e3a\u4f8b\uff0c\u5219\u95ee\u9898\u8f6c\u5316\u6210\uff1a\n\n**\u7ed9\u5b9a\u4e00\u4e2a $n\\times n$ \u7684 $01$ \u77e9\u9635\uff0c\u6c42\u5168 $1$ \u5b50\u77e9\u9635\u7684\u4e2a\u6570\u3002**\n\n\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u7ebf\u6027\uff0c\u7528\u5355\u8c03\u6808\u89e3\u51b3\u3002\n\n\u5373\u8f6c\u5316\u6210\u8fc7\u4e8e\u7b80\u5355\u7684\u76f4\u65b9\u56fe\u6c42\u5b50\u77e9\u9635\u4e2a\u6570\u95ee\u9898\u3002\n\n\u8fd9\u91cc\u518d\u8bf4\u660e\u4e00\u4e0b\u5177\u4f53\u8fc7\u7a0b\u3002\n\n\u679a\u4e3e\u8be5\u5b50\u77e9\u9635\u7684\u4e0b\u8fb9\u9ad8\u5ea6\uff0c\u5728\u8fd9\u6761\u4e0a\u8bb0\u5f55\u5411\u4e0a\u8fde\u7eed\u7684 $1$ \u7684\u4e2a\u6570\u3002\u7136\u540e\u4ece\u5de6\u5f80\u53f3\u7ef4\u62a4\u5355\u8c03\u6808\u5373\u53ef\u3002\u518d\u5177\u4f53\u53ef\u770b Code \u4e2d `work()` \u7684\u90e8\u5206\u3002\n\n\u603b\u4f53\u65f6\u95f4 $O(31n^2)$\n\n### Code\n\n\u6ce8\u610f\u4ee3\u7801\u4e2d\u6c42\u7684\u662f\u5168 $0$ \u5b50\u77e9\u9635\u3002\n\n```cpp\n//Said no more counting dollars. We'll be counting stars.\n//#pragma GCC optimize(\"Ofast\")\n//#pragma GCC optimize(\"unroll-loops\")//DONT use rashly,I have suffered\n//#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")//DONT use rashly,I have suffered\n#include<bits/stdc++.h>\nusing namespace std;\n#define IOS ios::sync_with_stdio(0);cin.tie(0);cout.tie(0)\n#define fir first\n#define sec second\n#define mkp make_pair\n#define pb emplace_back\n#define mem(x,y) memset(x,y,sizeof(x))\n#define For(i,j,k) for(int i=j;i<=k;i++)\n#define Rof(i,j,k) for(int i=j;i>=k;i--)\n#define Fe(x,y) for(int x=head[y];x;x=e[x].nxt)\n#define ckmx(a,b) a=max(a,b)\n#define ckmn(a,b) a=min(a,b)\n#define fin(s) freopen(s,\"r\",stdin)\n#define fout(s) freopen(s,\"w\",stdout)\n#define file(s) fin(s\".in\");fout(s\".out\")\n#define cerr cerr<<'_'\n#define debug cerr<<\"Passed line #\"<<__LINE__<<endl\ntemplate<typename T>T ov(T x){cerr<<\"Value: \"<<x<<endl;return x;}\n#define ll long long\nconst ll mod=1000000007;\ninline ll pw(ll x,ll y){ll r=1;while(y){if(y&1)r=r*x%mod;x=x*x%mod;y>>=1;}return r;}\ninline void mad(ll &a,ll b){a=(a+b)%mod;while(a<0)a+=mod;}\ninline void mmu(ll &a,ll b){a=a*b%mod;while(a<0)a+=mod;}\n#define inv(a) pw(a,mod-2)\n#define int long long\n#define N 1024\n\nint n,b[N][N],a1=0,a2=0,h[N][N];\nbool a[N][N];\nint st[N],tot;\nint work(){//all 0 count\n\tFor(i,1,n) h[1][i]=a[1][i]^1;\n\tFor(i,2,n){\n\t\tFor(j,1,n){\n\t\t\th[i][j]=(a[i][j]?0:h[i-1][j]+1);\n\t\t}\n\t}\n\tint res=0,now;\n\tFor(i,1,n){\n\t\ttot=now=0;\n\t\tFor(j,1,n){\n\t\t\twhile(tot && h[i][st[tot]]>=h[i][j]){\n\t\t\t\tmad(now,-h[i][st[tot]]*(st[tot]-st[tot-1]));\n\t\t\t\ttot--;\n\t\t\t}\n\t\t\tmad(now,h[i][j]*(j-st[tot]));\n\t\t\tst[++tot]=j;\n\t\t\tmad(res,now);\n\t\t}\n\t}\n\treturn res;\n}\nsigned main(){IOS;\n\tcin>>n;\n\tint all=pw(n*(n+1)/2%mod,2);\n\tFor(i,1,n)For(j,1,n)cin>>b[i][j];\n\tFor(i,0,30){\n\t\tFor(j,1,n)For(k,1,n)a[j][k]=((b[j][k]>>i)&1)^1;\n\t\tmad(a1,pw(2,i)*work());\n\t\tFor(j,1,n)For(k,1,n)a[j][k]=(b[j][k]>>i)&1;\n\t\tmad(a2,pw(2,i)*(all-work()));\n\t}\n\tcout<<a1<<\" \"<<a2<<endl;\nreturn 0;}\n```",
        "postTime": 1650026896,
        "uid": 101868,
        "name": "I_am_Accepted",
        "ccfLevel": 0,
        "title": "P5300 [GXOI/GZOI2019]\u4e0e\u6216\u548c"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P5300)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u770b\u5230\u4f4d\u8fd0\u7b97\uff0c\u7531\u4e8e\u8fdb\u884c\u4f4d\u8fd0\u7b97\u7684\u65f6\u5019\u5404\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u662f\u72ec\u7acb\u7684\uff0c\u6211\u4eec\u4e8e\u662f\u4e0d\u96be\u60f3\u5230\u5c06\u6bcf\u4e00\u4f4d\u5206\u79bb\u51fa\u6765\u5904\u7406\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5c06$a$\u4e2d\u7684\u6570\u7684\u4e8c\u8fdb\u5236\u7b2c$k$\u4f4d\u5206\u79bb\u51fa\u6765\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a$0/1$\u77e9\u9635$b_k$\u3002\u8003\u8651\u679a\u4e3e\u70b9$(i,j)$\uff0c\u5e76\u4e14\u8ba1\u7b97\u51fa\u6240\u6709\u4ee5$(i,j)$\u4e3a\u53f3\u4e0b\u89d2\u7684\u5b50\u77e9\u9635\u7684\u8d21\u732e\u3002\u5bf9\u4e8e$and$\u548c$or$\u8fd0\u7b97\u5206\u522b\u5206\u6790\u6027\u8d28\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$1.and:$\u7531\u4e8e$b_k$\u662f\u4e00\u4e2a$0/1$\u77e9\u9635\uff0c\u6240\u4ee5\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\u7684\u5b50\u77e9\u9635\u53ea\u4f1a\u662f\u4ee5$(i,j)$\u4e3a\u53f3\u4e0b\u89d2\uff0c\u4e14\u5168\u662f$1$\u7684\u5b50\u77e9\u9635\u3002\u5e76\u4e14\u4e0d\u96be\u53d1\u73b0\u5bf9\u4e8e\u90a3\u4e9b\u4ee5$(i,j)$\u4e3a\u53f3\u4e0b\u89d2\u4e14\u6709\u8d21\u732e\u7684\u5b50\u77e9\u9635\uff0c\u5b83\u4eec\u7684\u5de6\u4e0a\u89d2$(x,y)$\uff0c$y$\u7684\u53ef\u7528\u503c\u8303\u56f4\u4f1a\u968f\u7740$i-x$\u7684\u589e\u5927\u800c\u51cf\u5c0f\u3002\u8fd9\u542f\u793a\u6211\u4eec\u7528\u4e00\u4e2a\u5355\u8c03\u6808\u7ef4\u62a4\u4e00\u5757\u5168\u662f$1$\u7684\u3001\u5185\u90e8\u9664$(i,j)$\u5916\u6240\u6709\u4f4d\u7f6e\u90fd\u5728$(i,j)$\u7684\u5de6\u4e0a\u65b9\u7684\u533a\u57df\u7684\u9762\u79ef\u3002\u5728\u8fd9\u4e2a\u533a\u57df\u5185\u7684\u4f4d\u7f6e\u90fd\u53ef\u4ee5\u6210\u4e3a$(i,j)$\u7684\u5de6\u4e0a\u89d2\uff0c\u5e76\u4e14\u5bf9\u7b54\u6848\u6709\u8d21\u732e\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.or:$\u7c7b\u4f3c\u4e0a\u9762\u3002\u5bf9\u7b54\u6848\u9020\u6210\u8d21\u732e\u7684\u5b50\u77e9\u9635\u53ea\u9700\u8981\u91cc\u9762\u6709$1$\u5373\u53ef\u3002\u4e8e\u662f\u8003\u8651\u7528\u603b\u9762\u79ef\u51cf\u53bb\u4e0d\u53ef\u884c\u9762\u79ef\u3002\u6211\u4eec\u73b0\u5728\u8003\u8651\u7ef4\u62a4\u4e00\u5757\u5168\u662f$0$\u7684\u4e14\u5185\u90e8\u9664$(i,j)$\u5916\u6240\u6709\u4f4d\u7f6e\u90fd\u5728$(i,j)$\u7684\u5de6\u4e0a\u65b9\u7684\u533a\u57df\u7684\u9762\u79ef\u3002\u5728\u8fd9\u5757\u533a\u57df\u5185\u7684\u4f4d\u7f6e\u5982\u679c\u4f5c\u4e3a$(i,j)$\u7684\u5de6\u4e0a\u89d2\uff0c\u5c31\u4e0d\u4f1a\u4ea7\u751f\u8d21\u732e\u3002\u51cf\u53bb\u5b83\u4eec\u5373\u53ef\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u603b\u65f6\u95f4\u662f$O(n^2\\log_2 \\max \\{a\\})$  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n\ntypedef long long LL;\n\nconst int mod = 1e9 + 7;\nconst int MAXN = 1005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0; char s = getchar();int f = 1;\n\twhile( s < '0' || '9' < s ) { f = 1; if( s == '-' ) f = -1; s = getchar(); }\n\twhile( '0' <= s && s <= '9' ) { x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar(); }\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ) { putchar( '-' ), x = -x; }\n\tif( 9 < x ) { write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n\treturn a > b ? a : b;\n}\n\ntemplate<typename _T>\n_T MIN( const _T a, const _T b )\n{\n\treturn a < b ? a : b;\n}\n\nint sta[MAXN], top;\nint up[2][MAXN][MAXN];\nint a[MAXN][MAXN];\nint N;\nbool b[MAXN][MAXN];\n\nint main()\n{\n\tfreopen( \"andorsum.in\", \"r\", stdin );\n\tfreopen( \"andorsum.out\", \"w\", stdout );\n\tLL andAns = 0, orAns = 0;\n\tint mx = 0, siz;\n\tread( N );\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\tread( a[i][j] ), mx = MAX( mx, a[i][j] );\n\tfor( int k = 0 ; ( 1ll << k ) <= mx ; k ++ )\n\t{\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\tb[i][j] = ( a[i][j] >> k ) & 1, up[0][i][j] = up[1][i][j] = 0; \n\t\tfor( int t = 0 ; t < 2 ; t ++ )\n\t\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\t\tfor( int j = 1 ; j <= N ; j ++ )\t\n\t\t\t\t\tup[t][i][j] = ( b[i][j] == t ? up[t][i - 1][j] + 1 : 0 );\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t{\n\t\t\tsiz = top = 0, sta[0] = 0;\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t{\n\t\t\t\twhile( top && up[1][i][sta[top]] >= up[1][i][j] )\n\t\t\t\t\tsiz -= up[1][i][sta[top]] * ( sta[top] - sta[top - 1] ), top --;\n\t\t\t\tsiz += up[1][i][j] * ( j - sta[top] ), sta[++ top] = j;\n\t\t\t\tandAns = ( andAns + 1ll * siz * ( 1ll << k ) % mod ) % mod;\n\t\t\t}\n\t\t\tsiz = top = 0, sta[0] = 0;\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t{\n\t\t\t\twhile( top && up[0][i][sta[top]] >= up[0][i][j] )\n\t\t\t\t\tsiz -= up[0][i][sta[top]] * ( sta[top] - sta[top - 1] ), top --;\n\t\t\t\tsiz += up[0][i][j] * ( j - sta[top] ), sta[++ top] = j;\n\t\t\t\torAns = ( orAns + 1ll * ( i * j - siz ) * ( 1ll << k ) % mod ) % mod;\n\t\t\t}\n\t\t}\n\t}\n\twrite( andAns ), putchar( ' ' ), write( orAns ), putchar( '\\n' );\n\treturn 0;\n}\n```\n",
        "postTime": 1576303229,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[GXOI/GZOI2019]\u4e0e\u6216\u548c"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[$luogu$](https://www.luogu.com.cn/problem/P5300).\n# \u9898\u89e3\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u6570\u7ec4\u5f00\u5927\u5149\u8363MLE\u7206\u96f6.~~  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6309\u7167\u4e00\u822c\u7684\u5957\u8def, \u6211\u4eec\u601d\u8003\u77e9\u9635\u5185\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u5bf9\u6700\u540e\u7b54\u6848\u7684\u8d21\u732e. \u7531\u4e8e$and$\u548c$or$\u7684\u8ba1\u7b97\u5bf9\u4e8e\u4e0d\u540c\u7684\u4e8c\u8fdb\u5236\u4f4d\u662f\u72ec\u7acb\u7684, \u6211\u4eec\u8003\u8651\u628a\u539f\u77e9\u9635\u62c6\u6210\u5f88\u591a\u4e2a$01$\u77e9\u9635, \u4ee3\u8868\u5143\u7d20\u67d0\u4e00\u4e8c\u8fdb\u5236\u4f4d\u7684\u503c, \u5206\u522b\u8ba1\u7b97.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u63a5\u4e0b\u6765, \u5148\u601d\u8003$and$\u8fd0\u7b97. \u628a\u4e00\u4e2a\u77e9\u9635\u7684\u8d21\u732e\u8bb0\u5728\u8be5\u77e9\u9635\u53f3\u4e0b\u89d2\u7684\u5143\u7d20\u4e0a, \u53ef\u4ee5\u53d1\u73b0\u95ee\u9898\u8f6c\u5316\u4e3a: **\u6c42\u4ee5\u67d0\u4e2a\u70b9\u4e3a\u53f3\u4e0b\u89d2\u7684\u5168$1$\u77e9\u9635\u7684\u4e2a\u6570**. \u4e0d\u96be\u60f3\u5230\u4f7f\u7528\u5355\u8c03\u6808\u6c42\u89e3. \u679a\u4e3e\u6bcf\u4e00\u884c, \u5e76\u5904\u7406\u5904\u8be5\u884c\u6bcf\u4e00\u4e2a\u5143\u7d20\u4e0a\u65b9 ( \u5305\u62ec\u81ea\u8eab ) \u6709\u591a\u5c11\u4e2a$1$, \u62bd\u8c61\u6210\u4e00\u4e2a\u67f1\u72b6\u56fe, \u5c31\u5f88\u597d\u529e\u4e86.  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u63a5\u4e0b\u6765\u7684\u5267\u60c5\u4f60\u5e94\u8be5\u5df2\u7ecf\u731c\u5230~~, \u7531\u4e8e\u67d0\u4e2a\u77e9\u9635\u5728$or$\u8ba1\u7b97\u4e2d\u4ea7\u751f\u8d21\u732e$iff$\u5176\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u5143\u7d20\u4e3a$1$, \u6211\u4eec\u53ea\u9700\u8981\u628a$and$\u6240\u6c42\u7684\u4e1c\u897f\u53cd\u8fc7\u6765, \u6c42\u5230**\u4ee5\u67d0\u4e2a\u70b9\u4e3a\u53f3\u4e0b\u89d2\u7684\u5168$0$\u77e9\u9635\u7684\u4e2a\u6570**, \u518d\u7528\u4ee5\u8be5\u70b9\u4e3a\u53f3\u4e0b\u89d2\u7684\u6240\u6709\u77e9\u9635\u4e2a\u6570\u51cf\u6389\u5b83\u5373\u53ef.\n# \u4ee3\u7801\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6ce8\u610f\u4ee3\u7801\u4e2d$Upp$\u6570\u7ec4\u7684\u7a7a\u95f4\u6d88\u8017\u975e\u5e38\u5927, \u5c3d\u91cf\u4e0d\u8981\u8fd9\u6837\u505a, \u5728\u679a\u4e3e\u884c\u7684\u65f6\u5019\u987a\u4fbf\u63a8\u51fa\u8be5\u884c\u7684$Upp$\u5373\u53ef. ( \u61d2\u5f97\u6539$qwq$. )\n```cpp\n#include <cstdio>\n#include <utility>\n\n#define Int register int\n#define mkpr( x, y ) make_pair ( x, y )\n#define Bit( x, b ) ( bool ( x & ( 1LL << b ) ) )\n\nusing namespace std;\n\nconst int MAXN = 1000, MOD = 1e9 + 7;\nint n, a[MAXN + 5][MAXN + 5], UpperBit;\nint Upp[2][35][MAXN + 5][MAXN + 5], Top;\npair<int, int> S[MAXN + 5];\n\ninline int rint () {\n\tint x = 0; char s = getchar ();\n\tfor ( ; s < '0' || '9' < s; s = getchar () );\n\tfor ( ; '0' <= s && s <= '9'; s = getchar () ) x = ( x << 3 ) + ( x << 1 ) + ( s ^ '0' );\n\treturn x;\n}\n\ninline void Work () {\n\tn = rint ();\n\tfor ( Int i = 1; i <= n; ++ i ) {\n\t\tfor ( Int j = 1; j <= n; ++ j ) {\n\t\t\ta[i][j] = rint ();\n\t\t\tif ( 1LL << UpperBit < a[i][j] ) {\n\t\t\t\tfor ( ; 1LL << UpperBit <= a[i][j]; ++ UpperBit );\n\t\t\t\t-- UpperBit;\n\t\t\t}\n\t\t}\n\t}\n\tfor ( Int bt = 0; bt <= UpperBit; ++ bt ) {\n\t\tfor ( Int i = 1; i <= n; ++ i ) {\n\t\t\tfor ( Int j = 1; j <= n; ++ j ) {\n\t\t\t\tUpp[1][bt][i][j] = Bit ( a[i][j], bt ) ? Upp[1][bt][i - 1][j] + 1 : 0;\n\t\t\t\tUpp[0][bt][i][j] = ! Bit ( a[i][j], bt ) ? Upp[0][bt][i - 1][j] + 1 : 0;\n\t\t\t}\n\t\t}\n\t}\n\tint Ansor = 0, Ansand = 0;\n\tfor ( Int bt = 0; bt <= UpperBit; ++ bt ) {\n\t\tfor ( Int i = 1; i <= n; ++ i ) {\n\t\t\tint BitCnt = 0;\n\t\t\tS[Top = 0] = mkpr ( -1, 0 );\n\t\t\tfor ( Int j = 1; j <= n; ++ j ) {\n\t\t\t\tint l = 1;\n\t\t\t\tfor ( ; S[Top].first >= Upp[1][bt][i][j]; ) {\n\t\t\t\t\tBitCnt = BitCnt - ( S[Top].first - Upp[1][bt][i][j] ) * S[Top].second;\n\t\t\t\t\tl += S[Top].second;\n\t\t\t\t\t-- Top;\n\t\t\t\t}\n\t\t\t\tS[++ Top] = mkpr ( Upp[1][bt][i][j], l ), BitCnt += Upp[1][bt][i][j];\n\t\t\t\tAnsand = ( Ansand + BitCnt * ( 1LL << bt ) % MOD ) % MOD;\n\t\t\t}\n\t\t\tBitCnt = 0;\n\t\t\tS[Top = 0] = mkpr ( -1, 0 );\n\t\t\tfor ( Int j = 1; j <= n; ++ j ) {\n\t\t\t\tint l = 1;\n\t\t\t\tfor ( ; S[Top].first >= Upp[0][bt][i][j]; ) {\n\t\t\t\t\tBitCnt = BitCnt - ( S[Top].first - Upp[0][bt][i][j] ) * S[Top].second;\n\t\t\t\t\tl += S[Top].second;\n\t\t\t\t\t-- Top;\n\t\t\t\t}\n\t\t\t\tS[++ Top] = mkpr ( Upp[0][bt][i][j], l ), BitCnt += Upp[0][bt][i][j];\n\t\t\t\tAnsor = ( Ansor + ( 1LL * i * j - BitCnt ) * ( 1LL << bt ) % MOD ) % MOD;\n\t\t\t}\n\t\t}\n\t}\n\tprintf ( \"%lld %lld\\n\", Ansand, Ansor );\n}\n\nint main () {\n//\tfreopen ( \"andorsum.in\", \"r\", stdin );\n//\tfreopen ( \"andorsum.out\", \"w\", stdout );\n\tWork ();\n\treturn 0;\n}\n```",
        "postTime": 1576303144,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "\u53c8\u662fGXOI2019\u91cc\u6c34\u6c34\u7684\u9001\u5206\u9898\uff0c\u7136\u800c\u6211\u770b\u9519\u9898+\u7ec6\u8282\u5199\u6302\u6123\u662f\u641e\u4e86\u4e00\u4e2a\u591a\u5c0f\u65f6\uff08\u6df1\u6df1\u7684\u660e\u767d\u81ea\u5df1\u7684\u5f31\u5c0f\uff09\n\n\u9996\u5148\u770b\u5230\u4e8c\u8fdb\u5236\u6211\u4eec\u5c31\u8003\u8651\u5230**\u679a\u4e3e\u6bcf\u4e00\u4f4d**\uff0c\u7b97\u5b50\u77e9\u9635\u4e2d\u8fd9\u4e00\u4f4d\u4e3a$1$\u7684\u65b9\u6848\u6570\u518d\u4e58\u8d77\u6765\u5427\n\n\u7136\u540e\u8fd9\u65f6\u5019\u77e9\u9635\u5c31\u53d8\u6210\u4e86$0/1$\u77e9\u9635\uff08\u5176\u5b9e\u6837\u4f8b1\u5c31\u5728\u63d0\u793a\u4f60\u8fd9\u79cd\u505a\u6cd5\uff09\uff0c\u6211\u4eec\u8003\u8651$AND$\u65f6\u7684\u7b54\u6848\uff0c\u5373\u6c42\u51fa**\u5168$1$\u77e9\u9635**\u4e2a\u6570\n\n\u8fd9\u4e2a\u5f88\u5957\u8def\u5427\uff0c\u6211\u4eec\u9884\u5904\u7406\u51fa$h_{i,j}$\u8868\u793a$(i,j)$\u4ee5\u4e0a\uff08\u5305\u62ec$(i,j)$\u6700\u591a\u6709\u591a\u5c11\u4e2a\u8fde\u7eed\u7684$1$\uff09\n\n\u63a5\u4e0b\u6765\u8003\u8651\u6c42\u51fa\u4ee5\u6bcf\u4e00\u4e2a\u70b9\u4e3a**\u77e9\u9635\u7684\u53f3\u4e0b\u89d2**\u65f6\u7684\u65b9\u6848\u6570\uff0c\u6bcf\u4e00\u5217\u7684\u60c5\u51b5\u53ef\u4ee5**\u5355\u8c03\u6808**\u5904\u7406\uff1a\n\n\u8003\u8651\u8fde\u7eed\u9012\u589e\u7684\u4e00\u6bb5\u7684\u7b54\u6848\uff08\u5982$(3,5,6)$\u6211\u4eec\u662f\u53ef\u4ee5\u8ba1\u7b97\u7684\uff0c\u5c31\u662f\u4e00\u4e2a\u6c42\u548c\u7684\u8fc7\u7a0b\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u7ef4\u62a4**\u5355\u8c03\u9012\u589e**\u7684\u5355\u8c03\u6808\n\n\u7136\u540e\u8003\u8651\u6bcf\u6b21\u52a0\u5165\u4e00\u4e2a\u6570\uff0c\u90a3\u4e48\u524d\u9762\u5927\u4e8e\u5b83\u7684\u90fd\u4f1a\u88ab\u4ed6\u5220\u6389\uff0c\u6b64\u65f6\u7684\u8d21\u732e\u5176\u5b9e\u5c31\u662f\u5220\u6389\u6570\u7684\u4e2a\u6570$\\times$\u5f53\u524d\u7684$h_{i,j}$\n\n\u56e0\u6b64\u5355\u8c03\u6808\u91cc\u518d\u7ef4\u62a4\u4e00\u4e0b\u524d\u7f00\u548c\u4ee5\u53ca\u6570\u7684\u4e2a\u6570\uff08\u56e0\u4e3a\u88ab\u5220\u9664\u7684\u8981\u7d2f\u79ef\u5230\u5220\u9664\u5b83\u7684\u6570\u4e0a\uff09\uff0c\u5c31\u5b8c\u6210\u4e86$AND$\u7684\u505a\u6cd5\n\n\u90a3\u4e48$OR$\u5462\uff0c\u5176\u5b9e\u76f4\u63a5**\u8865\u96c6\u8f6c\u5316**\u4e00\u4e0b\u5c31\u597d\u4e86\uff0c\u7528\u603b\u65b9\u6848\u6570\u51cf\u53bb\u5168$0$\u77e9\u9635\u65b9\u6848\u6570\u5373\u4e3a\u6240\u6c42\n\n\u56e0\u6b64\u7efc\u4e0a\uff0c\u590d\u6742\u5ea6$O(n^2\\log a_i)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\n\nCODE\n\n```cpp\n#include<cstdio>\n#include<cctype>\n#define RI register int\n#define CI const int&\n#define Tp template <typename T>\nusing namespace std;\nconst int N=1005,mod=1e9+7;\nint n,a[N][N],and_ans,or_ans,mx,h[N][N],st[N],sum[N],val[N],top,cur;\nclass FileInputOutput\n{\n\tprivate:\n\t\tstatic const int S=1<<21;\n\t\t#define tc() (A==B&&(B=(A=Fin)+fread(Fin,1,S,stdin),A==B)?EOF:*A++)\n\t\tchar Fin[S],*A,*B;\n\tpublic:\n\t\tTp inline void read(T& x)\n\t\t{\n\t\t\tx=0; char ch; while (!isdigit(ch=tc()));\n\t\t\twhile (x=(x<<3)+(x<<1)+(ch&15),isdigit(ch=tc()));\n\t\t\t\n\t\t}\n\t\t#undef tc\n}F;\ninline void inc(int& x,CI y)\n{\n\tif ((x+=y)>=mod) x-=mod;\n}\ninline int add(CI x,CI y)\n{\n\tint t=x+y; return t>=mod?t-mod:t;\n}\ninline int solve_and(CI bs,int ret=0)\n{\n\tRI i,j; for (i=1;i<=n;++i) for (j=1;j<=n;++j)\n\tif (a[i][j]&bs) h[i][j]=h[i-1][j]+1; else h[i][j]=0;\n\tfor (i=1;i<=n;++i) for (top=0,j=1;j<=n;++j) if (!h[i][j]) top=0; else\n\t{\n\t\tint high=1; while (top&&st[top]>h[i][j]) high+=val[top--];\n\t\tinc(ret,1LL*h[i][j]*high%mod); inc(ret,sum[top]); st[++top]=h[i][j];\n\t\tval[top]=high; sum[top]=add(sum[top-1],1LL*h[i][j]*val[top]%mod);\n\t}\n\treturn 1LL*ret*bs%mod;\n}\ninline int solve_or(CI bs,int ret=0)\n{\n\tRI i,j; for (i=1;i<=n;++i) for (j=1;j<=n;++j)\n\tif (!(a[i][j]&bs)) h[i][j]=h[i-1][j]+1; else h[i][j]=0;\n\tfor (i=1;i<=n;++i) for (top=0,j=1;j<=n;++j) if (!h[i][j]) top=0; else\n\t{\n\t\tint high=1; while (top&&st[top]>h[i][j]) high+=val[top--];\n\t\tinc(ret,1LL*h[i][j]*high%mod); inc(ret,sum[top]); st[++top]=h[i][j];\n\t\tval[top]=high; sum[top]=add(sum[top-1],1LL*h[i][j]*val[top]%mod);\n\t}\n\tret=cur-ret; if (ret<0) ret+=mod; return 1LL*ret*bs%mod;\n}\nint main()\n{\n\t//freopen(\"CODE.in\",\"r\",stdin); freopen(\"CODE.out\",\"w\",stdout);\n\tRI i,j; for (F.read(n),i=1;i<=n;++i) for (j=1;j<=n;++j)\n\tF.read(a[i][j]),mx=a[i][j]>mx?a[i][j]:mx,inc(cur,1LL*i*j%mod);\n\tfor (i=1;i<=mx&&i>0;i<<=1) inc(and_ans,solve_and(i)),inc(or_ans,solve_or(i));\n\treturn printf(\"%d %d\",and_ans,or_ans),0;\n}\n```\n\n",
        "postTime": 1559567139,
        "uid": 41698,
        "name": "hl666",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "**2019.8.15 upd:** afo\u540e\u66f4\u65b0.\u63d2\u5165\u5185\u5bb9\u5728\u9898\u89e3\u7684\u5f00\u5934.\n\n\u679a\u4e3e\u5217$j$,\u4ece\u4e0a\u5411\u4e0b\u8003\u8651\u6bcf\u4e00\u884c$i$,\u5bf9\u4e8e$(i,j)$,\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u53f3\u4e0b\u89d2\u4e3a$(i,j)$\u7684\u6240\u6709\u51681\u77e9\u5f62\u6570\u91cf.  \n**\u5148\u8003\u8651\u77e9\u5f62\u5e73\u884c\u4e8e\u884c\u65b9\u5411\u4e0a\u7684\u957f\u5ea6** \u679a\u4e3e\u957f\u5ea6$k$,\u8d21\u732e\u4e3a$\\sum_{1\\leq k\\leq n}len(k)$\u5176\u4e2d$len(k)$\u4e3a \u4ece$(i,j)$\u5411\u4e0a\u8d70\u6ee1\u8db3$left_{i',j}\\geq k$\u7684$(i',j)$\u80fd\u8d70\u7684\u6700\u5927\u957f\u5ea6,\u6216\u8005\u8bf4\u7528\u957f\u5ea6\u4e3a$k$\u7684\u7ebf\u6bb5\u5411\u4e0a\u6ed1\u52a8,\u8d70\u591a\u8fdc\u4f1a\u88ab\u5361\u4f4f.\u8fd9\u4e2a\u60f3\u6cd5\u7684\u6b63\u786e\u6027\u662f\u663e\u7136\u7684,\u4f46\u662f\u4f1a\u5bfc\u81f4\u603b\u590d\u6742\u5ea6\u5230\u8fbe$O(n^3)$.  \n**\u5148\u8003\u8651\u77e9\u5f62\u5e73\u884c\u4e8e\u5217\u65b9\u5411\u4e0a\u7684\u957f\u5ea6** \u5373\u8003\u8651\u53f3\u4e0a\u89d2\u4e3a$(i',j)$\u65f6\u6784\u6210\u7684\u5b50\u77e9\u9635\u8ba1\u6570.\u8fd9\u6837\u56fa\u5b9a\u4e86\u77e9\u5f62\u7684\u4e00\u6761\u8fb9\u540e,\u8d21\u732e\u662f$min(left_{x,j}\\, x\\in[i',i])$,\u76f8\u5f53\u4e8e\u8003\u8651\u56fa\u5b9a\u4e86\u4e00\u6761\u7eb5\u5411\u7684\u7ebf\u6bb5,\u5411\u5de6\u79fb\u52a8\u591a\u8fdc\u4f1a\u9047\u52300,\u663e\u7136\u53d6\u51b3\u4e8e$left$\u7684\u6700\u5c0f\u503c.  \n\n\u548c\u524d\u4e00\u79cd\u60f3\u6cd5\u8fdb\u884c\u5bf9\u6bd4\u4e00\u4e0b\u5b83\u4eec\u662f\u7b49\u4ef7\u7684.\u4f46\u662f\u8fd9\u79cd\u60f3\u6cd5\u7ed9\u4e86\u6211\u4eec\u4e00\u4e2a\u53ef\u4ee5\u5747\u644a$O(n^2)$\u7ef4\u62a4\u7684\u5f0f\u5b50,\u5373\n$$A(i,j)=\\sum_{0\\lt x\\leq i}min(left_{y,j}\\quad y\\in[x,i])$$  \n\u663e\u7136sigma\u91cc\u9762\u90a3\u4e2a\u4e1c\u897f\u5173\u4e8e$x$\u662f\u5355\u8c03\u4e0d\u589e\u7684,\u6211\u4eec\u8003\u8651\u628a$min(left_{y,j}\\quad y\\in[x,i])$\u76f8\u540c\u7684$x$\u7f29\u8d77\u6765,\u8bb0\u5f55\u5f53\u524d\u7684$A(i,j)$,\u7136\u540e\u8003\u8651\u65b0\u52a0\u5165\u4e00\u4e2a$(i+1,j)\\quad left_{i+1,j}$\u7684\u5f71\u54cd:\u6211\u4eec\u9700\u8981\u628a**\u6700\u8fd1\u7684\u4e00\u4e9b**  $A(i,j)$,\u5176\u4e2d$min(left_{y,j}\\quad y\\in[x,i])\\gt left_{i+1,j}$\u4fee\u6539\u6389(\u6709\u4e86\u66f4\u77ed\u7684\u4e1c\u897f\u5361\u4f4f\u4e86\u4e4b\u524d\u8f83\u957f\u7684\u4e1c\u897fqwq),\u6539\u6210$left_{i+1,j}$,\u8fd9\u4e2a\u7279\u70b9\u5f88\u50cfstack,\u4e8e\u662f\u6211\u4eec\u5927\u6982\u77e5\u9053\u600e\u4e48\u73a9\u4e86!  \n\n\u7ef4\u62a4\u4e00\u4e2astack\u8bb0\u5f55\u90a3\u4e2amin(\u8fd9\u4f1a\u662f\u4ecebottom\u5230top\u5355\u8c03\u589e\u7684),\u540c\u65f6\u8bb0\u5f55stack\u91cc\u9762\u4e1c\u897f\u7684sum.\u65b0\u63d2\u5165\u4e00\u4e2aleft,\u628amin\u8fc7\u5927\u7684\u90e8\u5206\u6539\u6389. \u7136\u540e\u53d1\u73b0\u8fd9\u4e1c\u897f\u5355\u6b21$O(n)$, ~~\u6ca1\u6551\u4e86~~ emm,\u628a\u76f8\u540c\u7684min\u503c\u7f29\u8d77\u6765,\u518d\u8003\u8651\u590d\u6742\u5ea6.\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u6700\u591a\u88ab\u66ff\u6362\u4e00\u6b21,\u800c\u8fde\u7eed\u6bb5\u663e\u7136\u662f$O(n^2)$\u7684,\u4e8e\u662f\u8fd9\u4e2a\u6c42\u51fa\u6240\u6709$A(i,j)$\u7684\u8fc7\u7a0b\u590d\u6742\u5ea6\u4e3a$O(n^2)$...\u5199\u7684\u6709\u70b9\u4e71,\u4e0d\u8fc7\u8fd9\u4e9b\u5e94\u8be5\u80fd\u591f\u5e2e\u52a9\u60a8\u6210\u529f\u7406\u89e3\u4e0b\u9762\u7684\u4e1c\u897f\u4e86(\u6307code).....\n\n---\n\n\u8fd9\u662f\u4e2a\u4e8c\u5408\u4e00\u9898...\u9996\u5148\u770b\u4e00\u4e0b\u8fd9\u4e1c\u897f\u662f\u4f4d\u8fd0\u7b97\u7ed3\u679c\u4e4b\u548c\u6240\u4ee5\u6bcf\u4e00\u4f4d\u7684\u8d21\u732e\u662f\u72ec\u7acb\u7684,\u503c\u57df$2^{31}-1$\u62c632\u4f4d\u5206\u522b\u7b97\u4e58\u4e0a$2^i$\u6c42\u548c\u5373\u53ef.\u7136\u540e\u6bcf\u4e00\u4f4d\u7684\u8d21\u732e\u548b\u7b97\u554a,and\u8981\u6c42\u5168\u90fd\u662f1,or\u7684\u8bdd\u8981\u6c42\u81f3\u5c11\u4e00\u4e2a1,\u53cd\u8f6c\u4e00\u4e0b\u5c31\u662f\u6240\u6709\u5b50\u77e9\u9635\u51cf\u6389\u5168\u662f0\u7684.01\u4e92\u6362\u4e00\u4e0b\u5c31\u548cand\u4e00\u6837\u4e86.\n\n----\n\n\u524d\u9762\u90fd\u662f\u778e\u626f...\u770b\u8fd9\u91cc.  \n1. \u6211\u4eec\u53d1\u73b0\u53ef\u4ee5\u62c6\u4f4d\u7edf\u8ba1,\u56e0\u4e3a(a&b+c&d)=$\\sum_{i=0}^{32}(a[i]\\,and\\,b[i])+(c[i]\\,and\\,d[i])$\n2. \u6bcf\u4e00\u4f4d\u53ea\u80fd\u662f0/1,\u90a3\u4e48\u4e00\u4e2a\u5b50\u77e9\u9635\u7684and\u4e3a1\u5c31\u662f\u51681\u624d\u4f1a\u6709$2^i$\u7684\u8d21\u732e,\u8003\u8651\u4e00\u4e0bor,\u662f\u81f3\u5c11\u4e00\u4e2a1\u7edf\u8ba1\u51680\u5373\u53ef,\u518d01\u53cd\u8f6c,\u5c31\u548cand\u4e00\u81f4\u4e86,\u4e24\u95ee\u6ca1\u6709\u672c\u8d28\u533a\u522b.\n\n\u6211\u4eec\u4e0b\u9762\u8003\u8651\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u8ba1\u6570\u95ee\u9898,\u7ed9\u5b9a\u4e00\u4e2a01\u77e9\u9635,\u6c42\u51681\u77e9\u9635\u6570\u91cf.  \n~~\u8fd9\u662f[\u539f\u9898](https://www.luogu.org/problemnew/show/P3400)~~\n\n\u8003\u8651\u679a\u4e3e$(i,j)$,\u6709\u591a\u5c11\u53f3\u4e0b\u89d2\u662f$(i,j)$,\u8003\u8651\u4e00\u4e0b\u957f\u4e3a$x$\u7684\u77e9\u9635\u80fd\u591f\u6709\u591a\u5c11\u4e2a,\u5c31\u662f\u4e00\u76f4\u5411\u4e0a\u627e$j$\u5217\u7684\u5143\u7d20$(k,j)$,\u4f7f\u5f97$(k,j)$\u5de6\u4fa7\u4e0d\u8db3$x$\u4e2a\u8fde\u7eed1.\n\n\u9996\u5148\u8fd9\u4e2a\u5411\u5de6\u6781\u5927\u8fde\u7eed1\u6211\u4eec\u53ef\u4ee5$n^2$\u4e71\u641e\u51fa\u6765...\n\u7136\u540e\u8003\u8651\u8fd9\u4e2a\u8ba1\u7b97.  \n\u4f3c\u4e4e\u4e0d\u592a\u53ef\u505a?\u7ef4\u62a4\u4e00\u4e0b$(1,j),(2,j),(3,j)...(i,j)$\u8fd9\u6837\u4e00\u4e9b\u4f4d\u7f6e\u5411\u5de6\u5ef6\u7533\u957f\u5ea6\u7684**\u540e\u7f00\u6700\u5c0f\u503c**\u8fd9\u4e1c\u897f\u5411\u4e0a\u8d70\u663e\u7136\u5355\u8c03\u4e0d\u589e..\u66b4\u529b\u8df3\u4e0a\u53bb\u6216\u8005\u500d\u589e\u8df3\u4e0a\u53bb\u5c31\u53ef\u4ee5\u4e86,\u90a3\u679a\u4e3e\u77e9\u5f62\u7684\u957f\u4e3a$x$\u548b\u53bb\u6389\u554a?  \n\n\n\u8fd9\u91cc\u61d2\u5f97\u5212\u5f0f\u5b50...\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u8ba1\u7b97\u65b9\u5f0f.  \n$1,1,1$  \n$0,1,1$  \n$0,0,1$  \n\u8003\u8651\u53f3\u4e0b\u90a3\u4e2a\u4f4d\u7f6e,\u8d21\u732e\u662f$1+1+1$,\u56e0\u4e3a\u4e0a\u9762\u7684\u6269\u5c55\u957f\u5ea6**\u88ab\u6700\u5c0f\u503c\u5361\u6b7b\u4e86**,\u6240\u4ee5\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u8d21\u732e\u662f,\u8fd9\u4e00\u5217\u4e0a\u7684\u540e\u7f00\u6700\u5c0f\u503c\u4e4b\u548c.  \n\n\u540e\u7f00\u6700\u5c0f\u503c\u5728\u5411\u4e0b\u626b\u63cf\u65f6\u663e\u7136\u662f\u4e0d\u589e\u7684,\u6211\u4eec\u8003\u8651\u7528\u4e00\u4e2a\u5355\u8c03\u6808\u6765\u7ef4\u62a4,\u52a0\u5165\u4e86\u4e00\u4e2a\u5143\u7d20$x$\u6211\u4eec\u4e0d\u65ad\u628a\u6808\u9876\u5143\u7d20\u6254\u6389,\u51cf\u6389\u5b83\u7684\u8d21\u732e,\u5982\u679c\u6254\u6389\u4e86k\u4e2a\u5143\u7d20,\u90a3\u4e48\u540e\u7f00\u6700\u5c0f\u503c\u7b49\u4e8e$x$\u7684\u6570\u91cf\u662f$k+1$,\u8d21\u732e\u662f$x(k+1)$.\u6254\u6389\u7684\u5143\u7d20\u53ea\u662f\u88ab$x$\u5361\u6b7b\u4e86,\u6211\u4eec\u8fd8\u9700\u8981\u77e5\u9053\u6709\u591a\u5c11\u4e2a\u5143\u7d20\u88ab\u8e22\u6389\u4e86...\u4e8e\u662f\u5355\u8c03\u6808\u7ef4\u62a4\u4e8c\u5143\u7ec4$(value,count)$\u8868\u793acount\u4e2a\u540e\u7f00\u6700\u5c0f\u503c\u662fvalue.  \n\n\u7136\u540e\u5c31\u505a\u5b8c\u4e86...\n\n\n```cpp\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\nint read(){\n    int x=0;char c;\n    do{c=getchar();}while(!isdigit(c));\n    do{x=x*10+c-'0';c=getchar();}while(isdigit(c));\n    return x;\n}\nconst int N=1000+10;\nconst int LG=32;\nint n,b[N][N];\nbool a[32][N][N];\ntypedef long long Int;\nconst Int mod=Int(1e9)+7LL;\n\nint left[N][N];\nInt solve(int k){// a[k][n*n] ,count full sub matrix\n\n// \u626b\u51fa\u5411\u5de6\u5ef6\u7533\u7684\u6781\u5927\u957f\u5ea6.\n    for(int i=1;i<=n;i++) for(int j=1;j<=n;j++)\n        if(a[k][i][j]) left[i][j]=left[i][j-1]+1;\n        else left[i][j]=0;\n\n    Int ans=0;\n// \u679a\u4e3e\u6bcf\u4e00\u5217...\u4ece\u7b2c\u4e00\u884c\u5f00\u59cb\u626b\u63cf\u4e0b\u53bb.\n    for(int j=1;j<=n;j++){\n        std::stack<std::pair<int,int> > stk; //(value,count)\n        Int s=0; //\u8fd9\u4e2a\u662f\u540e\u7f00\u6700\u5c0f\u503c\u4e4b\u548c.\n        for(int i=1;i<=n;i++){ int c=1;\n            while(!stk.empty()&&stk.top().first>=left[i][j]){\n                std::pair<int,int> p=stk.top(); stk.pop();\n// \u6263\u6389\u8d21\u732e,\u7d2f\u52a0\u8ba1\u6570.\n                s-=p.first*p.second%mod; s=(s%mod+mod)%mod;\n                c+=p.second;\n            }\n// \u8fd9\u91cc,\u6700\u540e$c$\u884c\u7684\u540e\u7f00\u6700\u5c0f\u503c\u90fd\u662f$left_{i,j}$\u628a\u8d21\u732e\u7d2f\u8ba1.\n            s=(s+1LL*left[i][j]*c%mod)%mod;\n            stk.push(std::make_pair(left[i][j],c));\n// (i,j)\u4e3a\u53f3\u4e0b\u89d2\u7684\u77e9\u5f62\u8ba1\u6570,\u6839\u636e\u4e0a\u9762\u5206\u6790\u662f\u5411\u5de6\u6269\u5c55\u957f\u5ea6\u7684\u540e\u7f00\u6700\u5c0f\u503c\u4e4b\u548c.\n            ans=(ans+s)%mod;\n        }\n    }\n    return ans;\n}\n\nint main(){\n    n=read();\n    for(int i=1;i<=n;i++) for(int j=1;j<=n;j++){\n        b[i][j]=read();\n// \u62c632\u4f4d\u7edf\u8ba1.\n        for(int k=0;k<LG;k++) a[k][i][j]=(b[i][j]>>k)&1;\n    }\n\n    Int ans=0,qwq=n*(n+1)/2; qwq=qwq*qwq%mod;\n    for(int i=0;i<LG;i++) ans=(ans+(1LL<<i)%mod*solve(i))%mod;\n    std::cout<<ans<<\" \"; ans=0;\n\n    for(int i=1;i<=n;i++) for(int j=1;j<=n;j++)\n        for(int k=0;k<LG;k++) a[k][i][j]^=1;\n    for(int i=0;i<LG;i++){\n        ans=(ans+(1<<i)%mod*(qwq-solve(i)+mod)%mod)%mod;\n        ans=(ans%mod+mod)%mod;\n    }\n    std::cout<<ans<<std::endl;\n\n    return 0;\n}\n``",
        "postTime": 1555484329,
        "uid": 15295,
        "name": "hehelego",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "\u7a81\u7136\u53d1\u73b0\u54ea\u91cc\u7684\u7701\u9009\u90fd\u6bd4 $ZJOI$ \u53ef\u505a\u2026\u2026\n\n\u5b9e\u8d28\u4e0a\u8fd9\u9898\u5c31\u662f\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u77e9\u9635\u5168\u90e8\u662f $0/1$\n\n\u6211\u4eec\u6bcf\u6b21\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u7684\u6700\u957f $0$ \u533a\u95f4\uff0c\u628a\u95ee\u9898\u8f6c\u5316\u4e3a\u6240\u6709\u533a\u95f4\u6700\u5c0f\u503c\u4e4b\u548c\u3002\n\n\u5efa\u8bae\u7ba1\u7406\u5458\u628a\u8fd9\u9898\u6539\u4e3a\u3010\u6a21\u677f\u3011\u533a\u95f4\u6700\u5c0f\u503c\u4e4b\u548c\u3002\n\n$Code\\ Below:$\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int maxn=1000+10;\nconst int mod=1e9+7;\nint n,a[maxn][maxn],len[maxn];ll val,ans1,ans2;\npair<int,int> sta[maxn];\n\ninline int read()\n{\n\tregister int x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn (f==1)?x:-x;\n}\n\ninline ll solve(int T,int f)\n{\n\tll res=0,sum;int top,tmp;\n\tfor(int i=1;i<=n;i++) len[i]=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tsum=top=0;\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tlen[j]=((a[i][j]>>T)&1)==f?len[j]+1:0;tmp=1;\n\t\t\twhile(top&&sta[top].first>=len[j]) sum-=1ll*sta[top].first*sta[top].second,tmp+=sta[top].second,top--;\n\t\t\tsum+=1ll*len[j]*tmp;(res+=sum)%=mod;sta[++top]=make_pair(len[j],tmp);\n\t\t}\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=n;j++) a[i][j]=read(),(val+=1ll*i*j)%=mod;\n\tfor(int i=0,j=1;i<=30;i++,j<<=1)\n\t{\n\t\t(ans1+=solve(i,1)*j)%=mod;\n\t\t(ans2+=(val-solve(i,0))*j)%=mod;\n\t}\n\t(ans1+=mod)%=mod;(ans2+=mod)%=mod;\n\tprintf(\"%lld %lld\\n\",ans1,ans2);\n\treturn 0;\n}\n```",
        "postTime": 1555416543,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u95ee\u9898\u662f\u4e8c\u8fdb\u5236\u64cd\u4f5c\u3002\u6211\u4eec\u8003\u8651\u62c6\u4f4d\u5206\u522b\u8ba1\u7b97\u3002\n\n\u90a3\u4e48\uff0c\u77e9\u9635\u5c31\u53ea\u5269\u4e0b $0$ \u548c $1$ \u4e24\u79cd\u5143\u7d20\u4e86\u3002\n\n\u533a\u95f4\u4e0e\u4e3a $1$ \u5f53\u4e14\u4ec5\u5f53\u6574\u4e2a\u77e9\u9635\u90fd\u662f $1$ \uff0c\u533a\u95f4\u6216\u4e3a $0$ \u5f53\u4e14\u4ec5\u5f53\u6574\u4e2a\u77e9\u9635\u90fd\u662f $0$ \u3002\u90a3\u4e48\uff0c\u5c31\u53d8\u6210\u4e86\u4e24\u4e2a\u7c7b\u4f3c\u7684\u95ee\u9898\u3002\u4ee5\u533a\u95f4\u4e0e\u4e3a\u4f8b\u3002\n\n\u6211\u4eec\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u8bb0\u5f55\u6570\u503c $h_i$ \u8868\u793a\u4ece\u8fd9\u4e2a\u4f4d\u7f6e\u5411\u4e0b\u5ef6\u4f38\u6700\u957f\u6709\u591a\u5c11\u4e2a $1$ \u3002\u6211\u4eec\u518d\u679a\u4e3e\u77e9\u9635\u5de6\u4e0a\u89d2\u4f4d\u7f6e\uff0c\u7136\u540e\u518d\u679a\u4e3e\u53f3\u4e0a\u89d2\u3002\u53ef\u4ee5\u53d1\u73b0\uff0c\u53f3\u4e0a\u89d2\u5411\u53f3\u79fb\u52a8\u65f6\u77e9\u9635\u7684\u53ef\u80fd\u9ad8\u5ea6\u53ea\u4f1a\u5355\u8c03\u4e0d\u65ad\u7f29\u5c0f\u3002\n\n\u56e0\u6b64\u6211\u4eec\u4ece\u53f3\u5411\u5de6\u679a\u4e3e\u5de6\u4e0a\u89d2\uff0c\u7136\u540e\u7528\u4e00\u4e2a\u5355\u8c03\u6808\u7ef4\u62a4\u53ef\u80fd\u9ad8\u5ea6\u7684\u4e0a\u9650\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n^2\\log w)$ \u3002 $w$ \u4e3a\u6743\u57df\u3002\n\n\u4ee3\u7801:\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cctype>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cassert>\n#include<queue>\n#include<iostream>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mx(a,b) (a>b?a:b)\n#define mn(a,b) (a<b?a:b)\ntypedef unsigned long long uint64;\ntypedef unsigned int uint32;\ntypedef long long ll;\nusing namespace std;\n\nnamespace IO\n{\n\tconst uint32 Buffsize=1<<15,Output=1<<24;\n\tstatic char Ch[Buffsize],*S=Ch,*T=Ch;\n\tinline char getc()\n\t{\n\t\treturn((S==T)&&(T=(S=Ch)+fread(Ch,1,Buffsize,stdin),S==T)?0:*S++);\n\t}\n\tstatic char Out[Output],*nowps=Out;\n\t\n\tinline void flush(){fwrite(Out,1,nowps-Out,stdout);nowps=Out;}\n\n\ttemplate<typename T>inline void read(T&x)\n\t{\n\t\tx=0;static char ch;T f=1;\n\t\tfor(ch=getc();!isdigit(ch);ch=getc())if(ch=='-')f=-1;\n\t\tfor(;isdigit(ch);ch=getc())x=x*10+(ch^48);\n\t\tx*=f;\n\t}\n\n\ttemplate<typename T>inline void write(T x,char ch='\\n')\n\t{\n\t\tif(!x)*nowps++='0';\n\t\tif(x<0)*nowps++='-',x=-x;\n\t\tstatic uint32 sta[111],tp;\n\t\tfor(tp=0;x;x/=10)sta[++tp]=x%10;\n\t\tfor(;tp;*nowps++=sta[tp--]^48);\n\t\t*nowps++=ch;\n\t}\n}\nusing namespace IO;\n\nvoid file()\n{\n#ifndef ONLINE_JUDGE\n\tFILE*DSD=freopen(\"water.in\",\"r\",stdin);\n\tFILE*CSC=freopen(\"water.out\",\"w\",stdout);\n#endif\n}\n\nconst int MAXN=1011;\n\nstatic int n,w[MAXN][MAXN];\n\ninline void init()\n{\n\tread(n);\n\tRep(i,1,n)Rep(j,1,n)read(w[i][j]);\n}\n\nstatic int a[MAXN][MAXN],h[MAXN][MAXN];\n\nstatic int ans0,ans1;\n\nconst int mod=1e9+7;\n\nstatic int sta[MAXN],tp;\n\ninline void solve()\n{\n\tRep(_,0,30)\n\t{\n\t\tll sm=0ll;\n\t\tRep(i,1,n)Rep(j,1,n)a[i][j]=w[i][j]>>_&1;\n\t\tRepe(i,n,1)Rep(j,1,n)h[i][j]=a[i][j]?h[i+1][j]+1:0;\n\t\tRep(i,1,n)h[i][n+1]=-1;\n\t\tRep(i,1,n)\n\t\t{\n\t\t\tint *cr=h[i],as=0;\n\t\t\tsta[tp=1]=n+1;\n\t\t\tRepe(j,n,1)\n\t\t\t{\n\t\t\t\twhile(cr[sta[tp]]>=cr[j])\n\t\t\t\t{\n\t\t\t\t\tint u=sta[tp--];\n\t\t\t\t\tas-=(sta[tp]-u)*cr[u];\n\t\t\t\t}\n\t\t\t\tas+=(sta[tp]-j)*cr[j],sta[++tp]=j;\n\t\t\t\tsm+=as;\n\t\t\t}\n\t\t}\n\t\tans1=(ans1+sm%mod*(1ll<<_))%mod;\n\t\tsm=0;\n\t\tRep(i,1,n)Rep(j,1,n)a[i][j]=~w[i][j]>>_&1;\n\t\tRepe(i,n,1)Rep(j,1,n)h[i][j]=a[i][j]?h[i+1][j]+1:0;\n\t\tRep(i,1,n)\n\t\t{\n\t\t\tint *cr=h[i],as=0;\n\t\t\tsta[tp=1]=n+1;\n\t\t\tRepe(j,n,1)\n\t\t\t{\n\t\t\t\twhile(cr[sta[tp]]>=cr[j])\n\t\t\t\t{\n\t\t\t\t\tint u=sta[tp--];\n\t\t\t\t\tas-=(sta[tp]-u)*cr[u];\n\t\t\t\t}\n\t\t\t\tas+=(sta[tp]-j)*cr[j],sta[++tp]=j;\n\t\t\t\tsm+=(n-i+1)*(n-j+1)-as;\n\t\t\t}\n\t\t}\n\t\tans0=(ans0+sm%mod*(1ll<<_))%mod;\n\t}\n\tprintf(\"%d %d\\n\",ans1,ans0);\n}\n\nint main()\n{\n\tfile();\n\tinit();\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1555412611,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "\u663e\u7136\u5bf9\u4e8e\u6bcf\u4e00\u4f4d\u8003\u8651\u8d21\u732e\u3002\n\n\u4e0e\u6211\u4eec\u5c31\u6c42\u6240\u6709\u5168 1 \u77e9\u9635\u4e2a\u6570\u3002\n\n\u6216\u6211\u4eec\u5c31\u6c42\u6240\u6709\u5168 0 \u77e9\u9635\u4e2a\u6570\u7136\u540e\u7528\u603b\u6570\u51cf\u53bb\u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u8003\u8651\u6c42\u4ee5\u67d0\u4e2a\u70b9\u4e3a\u53f3\u4e0b\u89d2\u7684\u5168 0/1 \u77e9\u9635\u4e2a\u6570\u3002\u91c7\u7528\u7c7b\u4f3c\u60ac\u7ebf\u6cd5\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u6c42\u51fa\u4e00\u4e2a\u70b9\u5411\u4e0a\u6700\u957f\u80fd\u6269\u5f20\u7684\u957f\u5ea6$H[i][j]$\uff0c\u4ee4 $S[i][j]$ \u4e3a\u7b2ci\u884cj\u5217\u7684\u8d21\u732e,\u90a3\u4e48 $S[i][j]=\\sum_{k=1}^{j} min_{l=k}^jH[i][l]$\n\n\u5c31\u662f\u4e2a\u540e\u7f00 min \u6c42\u548c\u3002\u8fd9\u4e2a\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u4e00\u4e2a\u5355\u8c03\u6808\u7ef4\u62a4\u4e86,\u6c42\u51fa\u6bcf\u4e00\u4e2a\u70b9\u524d\u9762\u7b2c\u4e00\u4e2a\u6bd4\u81ea\u5df1\u5c0f\u7684\u540e,\u4e00\u90e8\u5206\u7b54\u6848\u662f\u95f4\u9694\u957f\u5ea6\u4e58\u4ee5\u81ea\u5df1\u7684 $H$ , \u53e6\u4e00\u90e8\u5206\u5c31\u76f4\u63a5\u662f\u90a3\u4e2a\u70b9\u7684 $S$\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define Set(a,b) memset(a,b,sizeof(a))\nusing namespace std;\nconst int N=1005;\nconst int mod=1e9+7;\ntemplate <typename T> inline void init(T&x){\n\tx=0;char ch=getchar();bool t=0;\n\tfor(;ch>'9'||ch<'0';ch=getchar()) if(ch=='-') t=1;\n\tfor(;ch>='0'&&ch<='9';ch=getchar()) x=(x<<1)+(x<<3)+(ch-48);\n\tif(t) x=-x;return;\n}\ntypedef long long ll;\ntemplate<typename T>inline void Inc(T&x,int y){x+=y;if(x>=mod) x-=mod;return;}\ntemplate<typename T>inline void Dec(T&x,int y){x-=y;if(x <  0) x+=mod;return;}\ntemplate<typename T>inline int fpow(int x,T k){int ret=1;for(;k;k>>=1,x=(ll)x*x%mod) if(k&1) ret=(ll)ret*x%mod;return ret;}\ninline int Sum(int x,int y){x+=y;if(x>=mod) return x-mod;return x;}\ninline int Dif(int x,int y){x-=y;if(x < 0 ) return x+mod;return x;}\nint mat[N][N];\nint n,ans0=0,ans1=0,tot;\nint H0[N][N],H1[N][N],S0[N][N],S1[N][N];\nint stk0[N],stk1[N],top0,top1;\ninline void Solve(int k){\n\tint all0=0,all1=0;\n\tfor(int i=1;i<=n;++i){\n\t\ttop0=top1=0;\n\t\tfor(int j=1;j<=n;++j) {\n\t\t\tS0[i][j]=S1[i][j]=0;\n\t\t\tint v=(mat[i][j]>>k)&1,fir;\n\t\t\tif(v) H1[i][j]=H1[i-1][j]+1,H0[i][j]=0;\n\t\t\telse  H1[i][j]=0,H0[i][j]=H0[i-1][j]+1;\n\t\t\twhile(top0&&H0[i][j]<H0[i][stk0[top0]]) --top0;\n\t\t\tfir=stk0[top0];\n\t\t\tS0[i][j]=(ll)(j-fir)*H0[i][j]%mod;\n\t\t\t\n\t\t\tif(top0) Inc(S0[i][j],S0[i][stk0[top0]]);stk0[++top0]=j;\n\t\t\tInc(all0,S0[i][j]);\n\t\t\twhile(top1&&H1[i][j]<H1[i][stk1[top1]]) --top1;\n\t\t\tfir=stk1[top1];\n\t\t\tS1[i][j]=(ll)(j-fir)*H1[i][j]%mod;\n\t\t\t\n\t\t\tif(top1) Inc(S1[i][j],S1[i][stk1[top1]]);stk1[++top1]=j;\n\t\t\tInc(all1,S1[i][j]);\n\t\t}\n\t}int bit=(1<<k)%mod;\n\tInc(ans0,(ll)all1*bit%mod);\n\tInc(ans1,(ll)Dif(tot,all0)*bit%mod);\n\treturn;\n}\nint main()\n{\n\tinit(n);\n\tfor(int i=1;i<=n;++i) for(int j=1;j<=n;++j) Inc(tot,i*j),init(mat[i][j]);\n\tfor(int k=0;k<31;++k) Solve(k);\n\tprintf(\"%d %d\\n\",ans0,ans1);\n\treturn 0;\n}\n\n```",
        "postTime": 1555404949,
        "uid": 47803,
        "name": "NeosKnight",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    },
    {
        "content": "## \u95ee\u9898\u63cf\u8ff0\n\nFreda \u5b66\u4e60\u4e86\u4f4d\u8fd0\u7b97\u548c\u77e9\u9635\u4ee5\u540e\uff0c\u51b3\u5b9a\u5bf9\u8fd9\u79cd\u7b80\u6d01\u800c\u4f18\u7f8e\u7684\u8fd0\u7b97\uff0c\u4ee5\u53ca\u8574\u542b\u6df1\u9083\u7a7a\u95f4\u7684\u7ed3\u6784\u8fdb\u884c\u66f4\u52a0\u6df1\u5165\u7684\u7814\u7a76\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7531\u975e\u8d1f\u6574\u6570\u6784\u6210\u7684\u77e9\u9635\uff0c\u5979\u5b9a\u4e49\u77e9\u9635\u7684 $\\texttt{AND}$ \u503c\u4e3a\u77e9\u9635\u4e2d\u6240\u6709\u6570\u4e8c\u8fdb\u5236 $\\texttt{AND(&)}$ \u7684\u8fd0\u7b97\u7ed3\u679c\uff1b\u5b9a\u4e49\u77e9\u9635\u7684 $\\texttt{OR}$ \u503c\u4e3a\u77e9\u9635\u4e2d\u6240\u6709\u6570\u4e8c\u8fdb\u5236 $\\texttt{OR(|)}$ \u7684\u8fd0\u7b97\u7ed3\u679c\u3002\n\n\u7ed9\u5b9a\u4e00\u4e2a $N \\times N$ \u7684\u77e9\u9635\uff0c\u5979\u5e0c\u671b\u6c42\u51fa\uff1a\n1. \u8be5\u77e9\u9635\u7684\u6240\u6709\u5b50\u77e9\u9635\u7684 $\\texttt{AND}$ \u503c\u4e4b\u548c\uff08\u6240\u6709\u5b50\u77e9\u9635 $\\texttt{AND}$ \u503c\u76f8\u52a0\u7684\u7ed3\u679c\uff09\u3002\n2. \u8be5\u77e9\u9635\u7684\u6240\u6709\u5b50\u77e9\u9635\u7684 $\\texttt{OR}$ \u503c\u4e4b\u548c\uff08\u6240\u6709\u5b50\u77e9\u9635 $\\texttt{OR}$ \u503c\u76f8\u52a0\u7684\u7ed3\u679c\uff09\u3002\n\n\u63a5\u4e0b\u6765\u7684\u5267\u60c5\u4f60\u5e94\u8be5\u5df2\u7ecf\u731c\u5230\u2014\u2014Freda \u5e76\u4e0d\u60f3\u82b1\u8d39\u65f6\u95f4\u89e3\u51b3\u5982\u6b64\u7b80\u5355\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u8fd9\u4e2a\u95ee\u9898\u5c31\u4ea4\u7ed9\u4f60\u4e86\u3002\n\n\u7531\u4e8e\u7b54\u6848\u53ef\u80fd\u975e\u5e38\u7684\u5927\uff0c\u4f60\u53ea\u9700\u8981\u8f93\u51fa\u7b54\u6848\u5bf9 $1,000,000,007 (10^9 + 7)$ \u53d6\u6a21\u540e\u7684\u7ed3\u679c\u3002\n\n[LG5300](https://www.luogu.com.cn/problem/P5300)\n\n---\n\n## \u9898\u89e3\n\n\u53d1\u73b0 and \u548c or \u5927\u6bd2\u7624\u51fa\u73b0~~\u5f00\u5e55\u96f7\u51fb~~\uff0c\u4e8e\u662f\u8003\u8651\u6309\u4f4d\u8ba1\u7b97\u8d21\u732e\u3002\n\n\u95ee\u9898\u5c31\u7b80\u5316\u4e3a\u4e8601\u77e9\u9635\u3002\n\n\u4e8e\u662f\u4e00\u4e2a\u5b50\u77e9\u9635\u5168\u662f0\u7684\u8bdd\u5bf9or\u6709\u8d1f\u8d21\u732e\uff0c\u5168\u662f1\u7684\u8bdd\u5bf9and\u6709\u6b63\u8d21\u732e\u3002\n\n\u5355\u8c03\u6808\u7ef4\u62a4\u5373\u53ef\n\n---\n\n## $\\mathrm{Code}$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\ntemplate <typename Tp>\nvoid read(Tp &x){\n\tx=0;char ch=1;int fh=1;\n\twhile(ch!='-'&&(ch<'0'||ch>'9')) ch=getchar();\n\tif(ch=='-') ch=getchar(),fh=-1;\n\twhile(ch>='0'&&ch<='9') x=x*10+ch-'0',ch=getchar();\n\tx*=fh;\n}\n\nconst int mod=1000000007;\nconst int maxn=1007;\n\nint a[maxn][maxn],n;\nlong long ansor,ansand;\nint s[maxn],h[maxn],val[maxn],pos;\nint mx;\n\nvoid Init(void){\n\tread(n);\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n;j++)\n\t\tread(a[i][j]),mx=max(mx,a[i][j]);\n}\n\nlong long sqr(long long x){\n\treturn (long long)x*(x+1)/2;\n}\n\nint calc(int need){\n\tlong long res=0;\n\tmemset(h,0,sizeof(h));\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tif((a[i][j]&1)==need) h[j]++;\n\t\t\telse h[j]=0;\n\t\t\tif(h[j]>s[pos]) s[++pos]=h[j],val[pos]=1;\n\t\t\telse{\n\t\t\t\tint k=0;\n\t\t\t\twhile(h[j]<s[pos]){\n\t\t\t\t\tk+=val[pos];\n\t\t\t\t\tres=(res+(s[pos]-max(s[pos-1],h[j]))*sqr(k)%mod)%mod;\n\t\t\t\t\t--pos;\n\t\t\t\t}\n\t\t\t\ts[++pos]=h[j],val[pos]=k+1;\n\t\t\t}\n\t\t}\n\t\tint k=0;\n\t\twhile(pos){\n\t\t\tk+=val[pos];\n\t\t\tres=(res+(s[pos]-s[pos-1])*sqr(k)%mod)%mod;\n\t\t\t--pos;\n\t\t}\n\t}\n\treturn res;\n}\n\nvoid Work(void){\n\tint tp=0;\n\twhile(mx){\n\t\tansand=(ansand+calc(1)*(1<<tp)%mod)%mod;\n\t\tansor=(ansor+(sqr(n)*sqr(n)%mod-calc(0))*(1<<tp)%mod)%mod;\n\t\tmx>>=1;tp++;\n\t\tfor(int i=1;i<=n;i++) for(int j=1;j<=n;j++) a[i][j]>>=1;\n\t}\n\tansand=(ansand%mod+mod)%mod;\n\tansor=(ansor%mod+mod)%mod;\n\tprintf(\"%lld %lld\\n\",ansand,ansor);\n}\n\nsigned main(){\n//\tfreopen(\"andorsum.in\",\"r\",stdin);freopen(\"andorsum.out\",\"w\",stdout);\n\tInit();\n\tWork();\n}\n```",
        "postTime": 1579102806,
        "uid": 28910,
        "name": "\u89c8\u904d\u5343\u79cb",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5300 \u3010[GXOI/GZOI2019]\u4e0e\u6216\u548c\u3011"
    }
]