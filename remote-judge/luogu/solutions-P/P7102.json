[
    {
        "content": "**\u9898\u610f** : \u7ed9\u51fa\u4e00\u4e2a $m$ \u9879\u591a\u9879\u5f0f $P(x)$ \u4ee5\u53ca $c,t$\u3002\n\n\u5b9a\u4e49 $s(n)=\\sum\\limits_{i=1}^nP(i)[i\\perp n]$\u3002\n\n\u5206\u522b\u6c42\u51fa $s(c),s(c^2),...,s(c^t)$ \u7684\u503c\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n$t,m\\leq 2\\times 10^5,\\ c\\leq 10^{18}$ \uff0c\u65f6\u9650$\\texttt{1s}$\u3002\n\n------------\n\n$s(n)=\\sum\\limits_{i=1}^nP(i)[i\\perp n]$\n\n$=\\sum\\limits_{i=1}^nP(i)\\sum\\limits_{d|n,d|i}\\mu(d)$\n\n$=\\sum\\limits_{d|n}\\mu(d)\\sum\\limits_{d|i}^nP(i)$\n\n$=\\sum\\limits_{d|n}\\mu(d)\\sum\\limits_{d|i}^n\\sum\\limits_{j=0}^{m-1}P[j]i^j$\n\n$=\\sum\\limits_{d|n}\\mu(d)\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=0}^{m-1}P[j](id)^j$\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]\\sum\\limits_{d|n}\\mu(d)d^j\\sum\\limits_{i=1}^{n/d}i^j$\n\n\u540e\u9762\u7684\u90e8\u5206\u662f\u81ea\u7136\u6570\u5e42\u548c\u3002\n\n\u8bbe\u4f2f\u52aa\u5229\u6570\u7684 `EGF` \u4e3a $\\dfrac{x}{e^x-1}$ \uff0c\u5176\u53ef\u4ee5\u591a\u9879\u5f0f\u6c42\u9006\u8ba1\u7b97\u3002\n\n\u5219\u81ea\u7136\u6570\u5e42\u548c\u7684\u591a\u9879\u5f0f\u4e3a $\\sum\\limits_{i=0}^{n-1}i^k=S_k(n)=k!\\sum\\limits_{i=0}^k\\dfrac{B[k-i]n^{i+1}}{(i+1)!}$\n\n\u6ce8\u610f\u5230\u53ea\u80fd\u5bf9 $[0,n-1]$ \u6c42\u548c\uff0c\u800c\u4e14\u6211\u4eec\u9700\u8981\u7684\u662f $[1,n]$\u3002 \u53ef\u4ee5\u5bf9 $0,n$ \u4e24\u9879\u5355\u72ec\u8ba1\u7b97\u3002\n\n\u63a5\u4e0b\u6765\u5c06\u81ea\u7136\u6570\u5e42\u548c\u591a\u9879\u5f0f\u4ee3\u5165 :\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]\\sum\\limits_{d|n}\\mu(d)d^j\\sum\\limits_{i=0}^{n/d-1}i^j$\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]\\sum\\limits_{d|n}\\mu(d)d^jj!\\sum\\limits_{i=0}^j\\dfrac{B[j-i](n/d)^{i+1}}{(i+1)!}$\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[j-i]}{(i+1)!}\\sum\\limits_{d|n}\\mu(d)d^j(n/d)^{i+1}$\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[j-i]n^{i+1}}{(i+1)!}\\sum\\limits_{d|n}\\mu(d)d^{j-i-1}$\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[i]n^{j-i+1}}{(j-i+1)!}\\sum\\limits_{d|n}\\mu(d)d^{i-1}$\n\n\u8003\u5bdf\u79ef\u6027\u51fd\u6570 $f_k=(\\mu\u00b7id_k)*I$ \uff0c\u6709 $f_k(p^c)=\\mu(1)id_k(1)+\\mu(p)id_k(p)=1-p^k$\n\n\u4e0d\u96be\u53d1\u73b0 $f_k(n)$ \u7684\u53d6\u503c\u53ea\u4e8e $n$ \u7684\u7d20\u56e0\u5b50\u96c6\u5408\u6709\u5173\u3002\n\n\u7531\u4e8e $n^c$ \u548c $n$ \u7684\u7d20\u56e0\u5b50\u96c6\u5408\u76f8\u540c\uff0c\u53ef\u63a8\u77e5 $f_k(n^c)=f_k(n)$\u3002\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[i]n^{j-i+1}}{(j-i+1)!}f_{i-1}(n)$\n\n\u7528 $c^k$ \u66ff\u6362 $n$ ,\u540c\u65f6\u6ce8\u610f\u5230 $f_{i-1}(c^k)=f_{i-1}(c)$\u3002\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[i](c^k)^{j-i+1}}{(j-i+1)!}f_{i-1}(c)$\n\n\u53ef\u4ee5\u5229\u7528 $\\rm Prho$ \u5206\u89e3\u6c42\u89e3\u79ef\u6027\u51fd\u6570 $f_{0...t-1}(c)$\uff0c\u8fd9\u90e8\u5206\u590d\u6742\u5ea6\u4e3a $O(\\sqrt[4]{c}+tw(c))$\u3002\n\n\u4e0d\u59a8\u8bbe $F[i]=F_{i-1}(c)$\u3002\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[i]F[i](c^k)^{j-i+1}}{(j-i+1)!}$\n\n\u6682\u65f6\u7528 $x$ \u66ff\u6362 $c^k$\u3002\n\n$R(x)=\\sum\\limits_{j=0}^{m-1}P[j]j!\\sum\\limits_{i=0}^j\\dfrac{B[i]F[i]x^{j-i+1}}{(j-i+1)!}$\n\n\u4e0b\u9762\u5bf9\u4f59\u4e0b\u7684 $n^k$ \u4e00\u9879\u5355\u72ec\u8ba1\u7b97\u3002\n\n\u4e0d\u96be\u53d1\u73b0 $P[j]j!B[i]F[i]$ \u4f1a\u8d21\u732e\u5230 $x^{j-i+1}$ \u7684\u7cfb\u6570\u5904\uff0c\u8fd9\u662f\u4e2a\u5dee\u5377\u79ef\u3002\n\n\u8ba1\u7b97\u51fa\u4e0a\u8ff0\u591a\u9879\u5f0f\u4e4b\u540e\uff0c\u9700\u8981\u5206\u522b\u6c42 $R(c),R(c^2),...,R(c^t)$ \u7684\u503c\u3002\n\n\u4f7f\u7528 [P6800 \u3010\u6a21\u677f\u3011Chirp Z-Transform](https://www.luogu.com.cn/problem/P6800) \u5373\u53ef\u3002\n\n\u4e0b\u9762\u5bf9\u4f59\u4e0b\u7684 $n^k$ \u4e00\u9879\u5355\u72ec\u8ba1\u7b97\u3002\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]\\sum\\limits_{d|n}\\mu(d)d^j(n/d)^j$\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]n^j\\sum\\limits_{d|n}\\mu(d)$\n\n\u7528 $c^k$ \u66ff\u6362 $n$ \u3002\n\n$=F[1]\\sum\\limits_{j=0}^{m-1}P[j](c^k)^j$\n\n$=F[1]P(c^k)$\n\n\u8fd9\u53ea\u9700\u8981\u518d\u5bf9 $P$ \u505a\u4e00\u6b21 `CZT`\u3002\n\n\u4e0d\u8fc7\u6ce8\u610f\u5230 `CZT`  \u5177\u6709\u7ebf\u6027\u6027\uff0c\u5c06 $F[1]P(x)$ \u548c $R(x)$ \u76f8\u52a0\u540e\u4e00\u8d77\u8ba1\u7b97 `CZT` \u5c31\u80fd\u5f97\u5230\u7b54\u6848\u3002\n\n\u4e0b\u9762\u5bf9\u4f59\u4e0b\u7684 $0^k$ \u4e00\u9879\u5355\u72ec\u8ba1\u7b97\u3002\n\n$=\\sum\\limits_{j=0}^{m-1}P[j]\\sum\\limits_{d|n}\\mu(d)d^j0^j$\n\n$=P[0]\\sum\\limits_{d|n}\\mu(d)=P[0]F[1]$\u3002\n\n\u76f4\u63a5\u51cf\u53bb\u5373\u53ef\u3002\n\n\u7efc\u4e0a\uff0c\u590d\u6742\u5ea6\u4e3a $O\\big((m+t)\\log(m+t)+\\sqrt[4]{c}+m\u00b7w(c)\\big)$\n\n\u5e94\u51fa\u9898\u4eba\u8981\u6c42\uff0c\u4e0d\u7ed9\u51fa\u5b8c\u6574\u4ee3\u7801\u3002\n\n```cpp\n#define clr(f,n) memset(f,0,sizeof((f)[0])*(n))\n#define cpy(f,g,n) memcpy(f,g,sizeof((f)[0])*(n))\nusing namespace std;\ninline ll mul(ll a,ll b,ll m){}\nll powM(ll a,ll t,ll m){}\nbool mr(ll n,ll a)\n{\n  ll t=n-1;\n  while(!(t&1))t>>=1;\n  ll buf=powM(a,t,n);\n  if (buf==1||buf==n-1)return 0;\n  while((t<<=1)<n-1){\n    buf=mul(buf,buf,n);\n    if (buf==n-1)return 0;\n  }return 1;\n}\nconst int testp[8]={2,3,5,7,13,19,61,233};\nbool ptest(ll n)\n{\n  if (n<2)return 0;\n  for (int i=2;i*i<=min(n,1000ll);i++)\n    if (n%i==0)return 0;\n  if (n<=1000)return 1;\n  for (int i=0;i<8;i++)\n    if (mr(n,testp[i]))return 0;\n  return 1;\n}\ninline ll gcd(ll a,ll b){\n  if(a==0)return b;\n  if(a<0)a=-a;\n  ll t;\n  while(b){t=a%b;a=b;b=t;}\n  return a;\n}\nll sav[150];int tot;\nconst int lim=128;\nll prho(ll n,ll c)\n{\n  ll x1=(c+1)%n,x2=(mul(x1,x1,n)+c)%n,buf;\n  tot=0;\n  while(1){\n    buf=mul(x1-x2,buf,n);\n    sav[++tot]=x1-x2;\n    if (tot==lim){\n      if (gcd(buf,n)>1)break;\n      tot=0;\n    }\n    x1=mul(x1,x1,n)+c;\n    x2=mul(x2,x2,n)+c;\n    x2=mul(x2,x2,n)+c;\n  }\n  for (int i=1;i<=tot;i++){\n    buf=gcd(sav[i],n);\n    if (buf>1)return buf;\n  }return n;\n}\nll p[105];int tn;\nvoid factor(ll n)\n{\n  if (n==1)return ;\n  if (ptest(n)){p[++tn]=n;return ;}\n  ll sav=prho(n,rand()%(n-1)+1);\n  while(sav==n)sav=prho(n,rand()%(n-1)+1);\n  factor(sav);factor(n/sav);\n}\nll powM(ll a,int t=mod-2){}\nvoid InitD(int *G,int n,ll x)\n{\n  for (int d=2;d<=100;d++)\n    if(x%d==0){\n      while(x%d==0)x/=d;\n      p[++tn]=d;\n    }\n  factor(x);\n  sort(p+1,p+tn+1);\n  tn=unique(p+1,p+tn+1)-p-1;\n  ll buf[105];\n  for (int i=1;i<=tn;i++)\n    buf[i]=powM(p[i]%=mod);\n  for (int i=0;i<n;i++){\n    ll ret=1;\n    for (int j=1;j<=tn;j++){\n      ret=ret*(mod+1-buf[j])%mod;\n      buf[j]=buf[j]*p[j]%mod;\n    }G[i]=ret;\n  }\n}\nconst int invG=powM(_G);\nint tr[Maxn<<1],tf;\nvoid tpre(int n){\n  if (tf==n)return ;tf=n;\n  for(int i=0;i<n;i++)\n    tr[i]=(tr[i>>1]>>1)|((i&1)?n>>1:0);\n}\nvoid NTT(int *g,bool op,int n)\n{\n  tpre(n);\n  static ull f[Maxn],w[Maxn>>1]={1};\n  for (int i=0;i<n;i++)f[i]=(((ll)mod<<5)+g[tr[i]])%mod;\n  for(int l=1;l<n;l<<=1){\n    ull tG=powM(op?_G:invG,(mod-1)/(l+l));\n    for (int i=1;i<l;i++)w[i]=w[i-1]*tG%mod;\n    for(int k=0;k<n;k+=l+l)\n      for(int p=0;p<l;p++){\n        int tt=w[p]*f[k|l|p]%mod;\n        f[k|l|p]=f[k|p]+mod-tt;\n        f[k|p]+=tt;\n      }      \n  }if (!op){\n    ull invn=powM(n);\n    for(int i=0;i<n;++i)\n      g[i]=f[i]%mod*invn%mod;\n  }else for(int i=0;i<n;++i)g[i]=f[i]%mod;\n}\nvoid px(int *f,int *g,int n)\n{for(int i=0;i<n;++i)f[i]=1ll*f[i]*g[i]%mod;}\nvoid invp(int *f,int m){}//\u591a\u9879\u5f0f\u6c42\u9006\nint fac[Maxn],ifac[Maxn];\nvoid InitF(int n)\n{\n  fac[0]=1;\n  for (int i=1;i<=n;i++) \n    fac[i]=1ll*fac[i-1]*i%mod;\n  ifac[n]=powM(fac[n]);\n  for (int i=n;i;i--)\n    ifac[i-1]=1ll*ifac[i]*i%mod;\n}\nvoid InitB(int *B,int n)\n{\n  for (int i=0;i<n;i++)\n    B[i]=ifac[i+1];\n  invp(B,n);\n}\nvoid calc(int *F,int n,int c,int m,int buf)\n{\n  static int C[Maxn],C2[Maxn];\n  int invc=powM(c);\n  C[0]=C2[0]=1;\n  for (int i=1;i<n+m;i++)C[i]=1ll*C[i-1]*c%mod;\n  for (int i=1;i<n+m;i++)C[i]=1ll*C[i]*C[i-1]%mod;\n  for (int i=1;i<max(n,m);i++)C2[i]=1ll*C2[i-1]*invc%mod;\n  for (int i=1;i<max(n,m);i++)C2[i]=1ll*C2[i]*C2[i-1]%mod;\n  for (int i=0;i<n;i++)F[i]=1ll*F[i]*C2[i]%mod;\n  reverse(C,C+n+m);\n  int len=1;while(len<n+m)len<<=1;\n  NTT(F,1,len);NTT(C,1,len);\n  px(F,C,len);NTT(F,0,len);\n  reverse(F,F+n+m);\n  for (int i=1;i<m;i++)\n    printf(\"%lld\\n\",(1ll*F[i]*C2[i]+buf)%mod);\n}\nint n,m,G[Maxn],B[Maxn],P[Maxn],S[Maxn];ll c;\nint main()\n{\n  scanf(\"%d%lld%d\",&n,&c,&m);\n  InitD(G,max(n,2),c);\n  InitF(n);\n  InitB(B,n);\n  ll sav;\n  for (int i=0;i<n;i++){\n    scanf(\"%d\",&S[i]);\n    if (!i)sav=1ll*G[1]*S[i];\n    P[i]=1ll*S[i]*fac[i]%mod;\n    S[i]=1ll*S[i]*G[1]%mod;\n  }for (int i=0;i<n;i++)\n    B[i]=1ll*B[i]*G[i]%mod;\n  reverse(P,P+n);\n  int len=1;while(len<n+n)len<<=1;\n  NTT(P,1,len);NTT(B,1,len);\n  px(P,B,len);NTT(P,0,len);\n  reverse(P,P+n);\n  for (int i=1;i<=n;i++)\n    S[i]=(S[i]+1ll*P[i-1]*ifac[i])%mod;\n  n++;m++;\n  calc(S,n,c%mod,m,mod-sav);\n  return 0;\n}\n```",
        "postTime": 1606559928,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7102 \u3010[w3R1] \u7b97\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u7efc\u5408\u9898\uff0c\u4e0d\u9700\u8981\u4ec0\u4e48\u9ad8\u6df1\u7684\u77e5\u8bc6\uff0c\u53ea\u9700\u8981\u6bcf\u79cd\u90fd\u4f1a\u4e00\u70b9\u70b9\u7136\u540e\u7206\u63a8\u5c31\u53ef\u4ee5\u4e86\uff0c\u9700\u8981\u6ce8\u610f\u4e00\u4e9b\u7ec6\u8282\n$$\n\\begin{aligned}\n\\quad~ S(n)&=\\sum_{i=1}^n P(i)[(i,n)=1] \\\\\n&=\\sum_{i=1}^n P(i) \\sum_{d|n,d|i} \\mu(d)\\\\\n&=\\sum_{d|n}\\mu(d)\\sum_{i=1}^{n/d}P(id)\\\\\n&=\\sum_{d|n}\\mu(d)\\sum_{i=1}^{n/d}\\sum_{j=0}^{m-1}a_j(id)^j\\\\\n&=\\sum_{d|n}\\mu(d)\\sum_{j=0}^{m-1}a_jd^j\\sum_{i=1}^{n/d}i^j\n\\end{aligned}\n$$\n\u200b\t\t\t\u540e\u9762\u7684\u662f\u4e00\u4e2a\u81ea\u7136\u6570\u5e42\u6c42\u548c\u7684\u5f62\u5f0f\uff0c\u8003\u8651\u4f7f\u7528 $B_i$ \u8868\u793a\u4f2f\u52aa\u5229\u6570\uff0c\u4f46\u662f\u4f2f\u52aa\u5229\u6570\u7684 $i$ \u662f\u4ece $0$ \u5f00\u59cb\u7684\uff0c\u4e8e\u662f\u628a\u4e00\u5f00\u59cb\u7684 $S(n)=\\sum_{i=0}^nP(i)[(i,n)==1]$ \u663e\u7136\u53ea\u6709\u5f53 $n=1$ \u662f\u4e0e\u539f\u6765\u4e0d\u540c\uff0c\u5224\u4e00\u4e0b\u5373\u53ef\uff0c\u63a5\u4e0b\u6765\u6309\u7740\u5f0f\u5b50\u7ee7\u7eed\u63a8\n$$\n\\begin{aligned}\n\\quad~&=\\sum \\mu(d)\\sum_{j=0}^{m-1}a_jd^j\\sum_{i=0}^{n/d}i^j\\\\\n&=\\sum \\mu(d)\\sum_{j=0}^{m-1}a_jd^j\\frac{1}{j+1}\\sum_{i=0}^{j} \\binom{j+1}{i}B_i\n(\\frac n d+1)^{j+1-i}\\\\\n&=\\sum \\mu(d)\\sum_{j=0}^{m-1}a_jd^j\\frac{1}{j+1}\\sum_{i=0}^{j}B_i\\sum\\binom{j+1}{i}\\binom{j+1-i}{k}(\\frac n d)^k\\\\\n&=\\sum \\mu(d)\\sum_{j=0}^{m-1}a_jd^j\\frac{1}{j+1}\\sum_{i=0}^{j}B_i\\sum\\binom{j+1}{k}\\binom{j-k+1}{i}(\\frac n d)^k\\\\\n&=\\sum \\mu(d)\\sum_{j=0}^{m-1}a_jd^j\\frac{1}{j+1}\\sum_{k=0}^{j+1}\\binom{j+1}k\\frac{n^k}{d^k}\\sum_{i=0}^{j}B_i\\binom{j-k+1}{i}\n\\end{aligned}\n$$\n\u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u6c42\u548c\uff0c\u4e0d\u96be\u53d1\u73b0\u5f53 $k!=0$ \u65f6\uff0c\u53d6\u503c\u53ea\u4e0e $j-k$ \u6709\u5173\uff0c\u800c\u5f53 $k=0$ \u65f6\u6839\u636e\u5b9a\u4e49\u9664 $j=0$ \u90fd\u662f $0$\uff0c\u800c $j=0,k=0$ \u7684\u60c5\u51b5\u4e0d\u96be\u8bc1\u660e\u548c\u4e3a $0$ \u4e8e\u662f $k$ \u4ece $1$ \u5f00\u59cb\u7b97\uff0c\u5e76\u4e14\u8bb0$F_k=\\sum_{i=0}^k\\binom k i B_i$\n$$\n\\begin{aligned}\n\\quad~&=\\sum \\mu(d) \\sum_{j=0}^{m-1}a_jd^j\\frac{1}{j+1}\\sum_{k=1}^{j+1}\\binom{j+1}k\\frac{n^k}{d^k}F_{j-k+1}\\\\\n&=\\sum \\mu(d) \\sum_{j=0}^{m-1}\\sum_{k=0}^{j}a_jd^{j-k-1}n^{k+1}\\frac1{j+1}\\binom{j+1}{k+1}F_{j-k}\\\\\n&=\\sum_{k=0}^{m-1}n^{k+1}\\frac1{(k+1)!}\\sum_{j=k}^{m-1}a_jj!F_{j-k}\\frac1{(j-k)!}\\sum_{d|n}\\mu(d)d^{j-k-1} \n\\end{aligned}\n$$\n\u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u548c\u5f0f\uff0c\u8bb0 $H_k=\\sum_{d|n}\\mu(d)d^{k-1}$\uff0c\u56e0\u4e3a\u53ea\u4e0e $n$ \u7684\u4e0d\u5e73\u65b9\u56e0\u5b50\u56e0\u5b50\u6709\u5173\uff0c\u5b83\u5bf9\u4e8e$n=c^q$ \u53d6\u503c\u76f8\u540c\uff0c\u4e8e\u662f\u53ef\u4ee5\u9884\u5904\u7406\uff0c\u800c\u8fd9\u663e\u7136\u662f\u4e2a\u79ef\u6027\u51fd\u6570\uff0c$Rho$ \u4e4b\u540e\u7b97\u4e00\u4e0b\u5373\u53ef\n$$\n\n=\\sum_{k=0}^{m-1}n^{k+1}\\frac1{(k+1)!}\\sum_{j=k}^{m-1}a_jj!F_{j-k}\\frac1{(j-k)!}H_{j-k}\n\n$$\n\u540e\u9762\u662f\u4e00\u4e2a\u5dee\u5377\u79ef\u5f62\u5f0f\uff0c\u4e8e\u662f $S(n)$ \u5c31\u662f\u4e00\u4e2a\u5173\u4e8e $n$ \u7684\u591a\u9879\u5f0f\uff0c\u8ba1\u7b97\u5373\u53ef",
        "postTime": 1608119257,
        "uid": 75982,
        "name": "jiangby",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7102 \u3010[w3R1] \u7b97\u3011"
    }
]