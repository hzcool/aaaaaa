[
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P8442)\n\n\u4eca\u5929\u6bd4\u8d5b\u5feb\u7ed3\u675f\u65f6\uff0c\u542c\u8bf4\u6709\u4eba\u963f\u514b\u4e86\u8fd9\u573a\uff0c\u5c31\u8fdb\u6765\u770b\u4e86\u770b F\uff0c\u8fd9\u4e0d\u662f\u5178\u9898\u5417\uff0c\uff0c\n\n\u9996\u5148\u8fd9\u4e2a\u6a21\u6570\u662f\u4e2a\u5408\u6570\uff0c\u53ef\u4ee5\u5206\u89e3\u4e3a $24000001\\times 30000001$\uff0c\u5206\u522b\u8bbe\u4e3a $p_1$ \u548c $p_2$\u3002\u90a3\u4e48\u53ea\u8981\u5206\u522b\u5bf9 $p_1$ \u548c $p_2$ \u6c42\u89e3\u540e\u7528 crt \u5408\u5e76\u5373\u53ef\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u7ed9\u51fa\u7684 $n$ \u9664\u4e86 $13$ \u90fd\u53ef\u4ee5\u6574\u9664 $p_1-1$ \u548c $p_2-1$\uff0c\u8fd9\u4e9b\u60c5\u51b5\u4e0b $\\omega_n$ \u5728\u6a21 $p_1$ \u548c $p_2$ \u4e0b\u90fd\u5b58\u5728\uff0c\u76f4\u63a5\u7528\n$$\\frac 1n\\sum_{i=0}^{n-1}(\\omega_n^i+\\omega_n^{-i})^m \\ \\ \\texttt{(1)}$$\n\u8ba1\u7b97\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(n \\log p)$ \u7684\u3002\n\n\u8fd8\u6709\u53e6\u5916\u4e00\u79cd\u505a\u6cd5\u662f\u8fdb\u884c\u4e8c\u9879\u5f0f\u5c55\u5f00\uff0c\u5355\u4f4d\u6839\u53cd\u6f14\u5373\u5f97\n$$\\sum_{k=0}^m \\binom mk \\frac 1n\\sum_{i=0}^{n-1}\\omega_n^{(2k-m)i}=\\sum_{k=0}^m\\binom mk[n|(2k-m)] \\ \\ \\texttt{(2)}$$\n\u7528\u8fd9\u79cd\u65b9\u6cd5\u8ba1\u7b97\u4e00\u7ec4\u6570\u636e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(p/n)$\uff0c\u9700\u8981 $\\Theta(p)$ \u9884\u5904\u7406\u9636\u4e58\u3002\n\n\u7efc\u5408\u4e00\u4e0b\u8fd9\u4e24\u79cd\u7b97\u6cd5\uff0c\u89e3\u65b9\u7a0b $n \\log p = p/n$ \u53ef\u4ee5\u5f97\u5230 $n=1000$ \u65f6\u4e3a\u4e34\u754c\u6570\u636e\uff0c\u5c0f\u4e8e $1000$ \u7684\u7528\u65b9\u6cd5 $\\texttt{(1)}$\uff0c\u5927\u4e8e $1000$ \u7684\u7528\u65b9\u6cd5 $\\texttt{(2)}$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e $n=13$ \u8fd9\u4e2a\u7279\u522b\u6570\u636e\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u6a21 $p=30000001$ \u610f\u4e49\u4e0b\u6709\uff1a\n$$(x+x^{12})^p \\equiv x^5+x^8 \\pmod{(x^n-1)}$$\n$$(x^5+x^8)^p\\equiv 2+x^2+x^{11}\\equiv (x+x^{12})^2 \\pmod{(x^n-1)}$$\n\u6545\u76f4\u63a5\u5c06 $m$ \u5bf9 $p^2-1$ \u53d6\u6a21\u5373\u53ef\u3002\u7279\u522b\u5730\uff0c\u5bf9\u4e8e $p=24000001$ \u65f6\u5faa\u73af\u8282\u957f\u5ea6\u53ea\u6709 $p-1$\u3002\n\n\u6700\u540e\u5c31\u662f\u5e38\u6570\u4f18\u5316\uff0c\u4e3b\u8981\u6709\u4e94\u70b9\uff1a\n\n1. \u5bf9\u4e8e\u9898\u76ee\u4e2d\u9650\u5b9a\u7684 $n \\neq 13$ \u7684\u6570\u636e\uff0c$m$ \u4e3a\u5947\u6570\u65f6\u7b54\u6848\u4e3a\u96f6\u3002\n\n2. \u7531\u5355\u4f4d\u6839\u7684\u6027\u8d28\uff0c\u82e5 $m$ \u4e3a\u5076\u6570\uff0c\u5728\u5229\u7528\u65b9\u6cd5 $\\texttt{(1)}$ \u65f6 $i$ \u53ea\u7528\u53d6\u5230\u4e00\u534a\uff0c\u4e4b\u540e\u53d6\u4e8c\u500d\u5373\u53ef\u3002\n\n3. \u5bf9\u4e8e $n=1000$ \u7684\u60c5\u51b5\uff0c\u82e5\u4f7f\u7528\u65b9\u6cd5 $\\texttt{(1)}$\uff0c\u53ef\u4ee5\u5bf9\u5feb\u901f\u5e42\u505a\u4f18\u5316\uff0c\u505a\u9884\u5904\u7406\u3002\u8fd9\u91cc\u6211\u9009\u7528 $8$ \u8fdb\u5236\u5feb\u901f\u5e42\u3002\n\n4. \u5728\u4f7f\u7528\u65b9\u6cd5 $\\texttt{(2)}$ \u65f6\uff0c\u53ef\u4ee5\u53d1\u73b0\u7b54\u6848\u4e5f\u662f\u5bf9\u79f0\u7684\uff0c\u4e5f\u53ef\u4ee5\u53ea\u7b97\u4e00\u534a\u3002\n\n5. \u4f7f\u7528\u65e0\u7b26\u53f7\u6574\u6570\u8fd0\u7b97\uff0c\u6548\u7387\u4f1a\u660e\u663e\u63d0\u5347\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<vector>\n#define ll unsigned long long\n#define int unsigned int\n#define N 30000003\n#define P 720000054000001\n#define i128 __int128_t\nusing namespace std;\n\nconst int pr[2] = {24000001,30000001};\nconst int g[2] = {23,14};\nint ifac[N],sw[503][9][8];\nint p,inv1k;\n\ninline int power(int a,int t,int m){\n    int res = 1;\n    while(t){\n        if(t&1) res = (ll)res*a%m;\n        a = (ll)a*a%m;\n        t >>= 1;\n    }\n    return res;\n}\n\nvoid init(int id){\n    inv1k = power(1000,p-2,p);\n    ifac[0] = 1,ifac[p-1] = p-1;\n    for(int i=p-2;i;--i) ifac[i] = (ll)ifac[i+1]*(i+1)%p;\n    int r = power(g[id],(p-1)/1000,p),w = 1,iw = 1;\n    int ir = power(r,p-2,p);\n    for(int i=0;i<500;++i){ \n        sw[i][0][0] = 1,sw[i][0][1] = w+iw;\n        for(int k=2;k<8;++k) sw[i][0][k] = (ll)sw[i][0][k-1]*sw[i][0][1]%p;\n        for(int j=1;j<9;++j){\n            sw[i][j][0] = 1,sw[i][j][1] =  (ll)sw[i][j-1][7]*sw[i][j-1][1]%p;\n            for(int k=2;k<8;++k) sw[i][j][k] = (ll)sw[i][j][k-1]*sw[i][j][1]%p;\n        }\n        w = (ll)w*r%p,iw = (ll)iw*ir%p;\n    }\n}\n\ninline void multiply(const int *f,const int *g,int n,int *r){\n    static int h[28];\n    memset(h,0,sizeof(h));\n    for(int i=0;i<n;++i)\n    for(int j=0;j<n;++j)\n        h[i+j] = (h[i+j]+(ll)f[i]*g[j])%p;\n    for(int i=0;i<n;++i) r[i] = (h[i]+h[i+n])%p;\n}\n\ninline int solve(int n,ll m,int rt){\n    int pw,t;\n    ll res = 0;\n    if(n==13){\n        static int f[28],g[28];\n        memset(f,0,sizeof(f));\n        memset(g,0,sizeof(g));\n        f[1] = f[n-1] = g[0] = 1;\n        while(1){\n            if(m&1) multiply(f,g,n,g);\n            m >>= 1;\n            if(m==0) break;\n            multiply(f,f,n,f);\n        }\n        return g[0];\n    }\n    if(m&1) return 0;\n    if(n==1000){\n        for(int i=0;i<500;++i){\n            pw = 1,t = m;\n            for(int j=0;t;++j){\n                if(t&7) pw = (ll)pw*sw[i][j][t&7]%p;\n                t >>= 3;\n            }\n            res += pw;\n        }\n        return (res<<1)%p*inv1k%p;\n    }\n    if(n<=100){\n        int r = power(rt,(p-1)/n,p);\n        int ir = power(r,p-2,p),w = 1,iw = 1;\n        n >>= 1;\n        for(int i=0;i<n;++i){\n            res += power(w+iw,m,p);\n            w = (ll)w*r%p,iw = (ll)iw*ir%p;\n        }\n        return (res<<1)%p*power(n<<1,p-2,p)%p;\n    }\n    int st = (m>>1)%(n>>1),len = n>>1;\n    for(int k=st;(k<<1)<m;k+=len) res += (ll)ifac[k]*ifac[m-k]%p;\n    return ((res<<1)+(ll)ifac[m>>1]*ifac[m>>1])%p*power(ifac[m],p-2,p)%p;\n}\n\ninline ll crt(int x,int y){\n    return ((i128)x*pr[1]*power(pr[1],pr[0]-2,pr[0])+(i128)y*pr[0]*power(pr[0],pr[1]-2,pr[1]))%P;\n}\n\nstruct query{\n    int n,m0,m1,x,y;\n    ll m13;\n    inline query(int _n=0,int _m0=0,int _m1=0,int _x=0,int _y=0):n(_n),m0(_m0),m1(_m1),x(_x),y(_y){}\n}a[2503];\n\nchar str[10003];\nint m0,m1,x,y,l,cnt;\nll m13;\n\nsigned main(){\n    int n;\n    p = pr[0];\n    init(0);\n    while(scanf(\"%d%s\",&n,str)==2){\n        l = strlen(str);\n        m1 = m0 = m13 = 0;\n        for(int i=0;i<l;++i) m0 = (m0*10+str[i]-'0')%(pr[0]-1);\n        if(n==13){\n            for(int i=0;i<l;++i) \n                m13 = (m13*10+str[i]-'0')%((ll)pr[1]*pr[1]-1);\n        }else{\n            for(int i=0;i<l;++i)\n                m1 = (m1*10+str[i]-'0')%(pr[1]-1);\n        }\n        x = solve(n,m0,g[0]);\n        a[++cnt] = (query(n,m0,m1,x));\n        a[cnt].m13 = m13;\n    }\n    p = pr[1];\n    init(1);\n    for(int i=1;i<=cnt;++i){\n        x = a[i].x;\n        y = solve(a[i].n,a[i].n==13?a[i].m13:a[i].m1,g[1]);\n        printf(\"%lld\\n\",crt(x,y));\n    }\n    return 0;\n} \n```\n\n\u540e\u8bb0\uff1a\u6211\u6ca1\u770b\u6bd4\u8d5b\u5956\u8bc4\uff0c\u4f46\u8fd9\u4e2a\u51fa\u9898\u4eba\u548b\u8dd1\u90a3\u4e48\u5feb\u554a\uff1f\u66f4\u795e\u5fc5\u7684\u662f\u4ee3\u7801\u91cf\u8fbe\u5230\u4e86\u60ca\u4eba\u7684 $29.49\\text {KB}$\uff0c\u4e0d\u77e5\u9053\u662f\u725b\u903c\u79d1\u6280\u8fd8\u662f\u6253\u8868\u4f18\u5316\u5e38\u6570\u3002 ",
        "postTime": 1658056873,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "P8442\uff08LMOI R1 F\uff09 \u8be6\u89e3"
    },
    {
        "content": "\u8fd9\u4e2a\u6a21\u6570\u53ef\u4ee5\u53d8\u6210\u4e24\u4e2a\u6570\u7684\u4e58\u79ef\uff0c\u5373 $2.4\\times 10^7+1$ \u548c $3\\times 10^7+1$\u3002\n\n\u4e0d\u96be\u53d1\u73b0 $n$ \u7684\u8303\u56f4\u4e2d\u9664\u4e86 $13$ \u90fd\u662f\u8fd9\u4e24\u4e2a\u6570\u51cf\u53bb $1$ \u7684\u56e0\u6570\u3002\n\n\u800c\u9898\u76ee\u8981\u6c42\u7684\u662f $(x+x^{n-1})^m\\pmod{x^n-1}$\uff0c\u5faa\u73af\u5377\u79ef\u7684\u957f\u5ea6\u662f p-1 \u7684\u56e0\u6570\u5f53\u7136\u975e\u5e38\u5feb\u4e50\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6536\u83b7\u4e86\u4e00\u4e2a\u5355\u6b21 $O(n\\log n)$ \u7684\u505a\u6cd5\u3002\n\n\u5e76\u4e14\u6ce8\u610f\u5230\u5176\u5b9e\u4f60\u53ea\u9700\u8981\u6c42\u96f6\u6b21\u9879\uff0cidft\u7684\u65f6\u5019\u76f4\u63a5\u66b4\u529b\u5e26\u5165 $\\omega_n^0$ \u6216\u8005\u76f4\u63a5\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n+n\\log mod)$\u3002\n\n\u4f46\u662f\u5462\uff0c\u5feb\u901f\u5e42\u662f\u6ca1\u6709\u5fc5\u8981\u7684\u3002\u6211\u4eec\u4f7f\u7528\u539f\u6839\u505a\u4e58\u6cd5\uff0c\u76f4\u63a5\u9884\u5904\u7406\u539f\u6839\u7684\u5e42\uff0c\u52a0\u6cd5\u7684\u65f6\u5019\u7528 $\\ln$ \u8f6c\u79fb\u4e0b\u5373\u53ef\u505a\u5230 $O(n)$\u3002~~\u5b9e\u9645\u4e0a\u4f1a\u88ab\u5361\u7a7a\u95f4\uff0c\u4e0d\u5efa\u8bae~~\n\n$m$ \u663e\u7136\u662f\u53ef\u4ee5\u5bf9 $mod-1$ \u53d6\u6a21\u7684\u3002\n\n\u7136\u540e\u8003\u8651\u628a\u4f20\u7403\u7684\u90a3\u9897\u6811\u753b\u51fa\u6765\uff0c\u4e0d\u96be\u53d1\u73b0\u5230\u8fbe\u8fd9\u68f5\u6811\u6700\u5e95\u90e8\u7684\u65b9\u6848\u6570\u662f\u7ec4\u5408\u6570\uff0c\u800c\u4f60\u53ea\u9700\u8981\u6c42 $O(\\frac{m}{n})$ \u4e2a\u4f4d\u7f6e\u7684\u7ec4\u5408\u6570\u3002\n\n\u4e8e\u662f\u53c8\u6536\u83b7\u4e86\u4e00\u4e2a $O(\\frac{mod}{n})$ \u7684\u505a\u6cd5\u3002\n\n\u6839\u53f7\u5206\u6cbb\u4e00\u4e0b\uff0c\u80fd\u591f\u5f97\u5230\u5355\u6b21 $O(\\sqrt{mod})$ \u7684\u505a\u6cd5\u3002\u867d\u7136\u6709 2500 \u6b21\u8be2\u95ee\u4f46\u662f\u4e00\u5b9a\u80fd\u8dd1\u3002\n\n\u51fa\u9898\u4eba\u539f\u672c\u8ba4\u4e3a $n=13$ \u662f\u6700\u96be\u7684\u90e8\u5206\u3002\n\n\u4e8e\u662f\u6211\u8d3a\u4e86\u4e00\u4e2a Berlekamp\u2013Massey\uff0c\u5f88\u5feb\u554a\uff0c\u9012\u63a8\u5f0f\u76f4\u63a5\u6252\u51fa\u6765\u4e86\u3002\n$$f_n=f_{n-1}+7\\times f_{n-2}-6\\times f_{n-3}-14\\times f_{n-4}+9\\times f_{n-5}+7\\times f_{n-6}-2\\times f_{n-7}$$\n\u7136\u540e\u8dd1\u4e00\u4e2a\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u76f4\u63a5\u5355\u6b21 $O(7^2\\sum\\log m)$ \u968f\u4fbf\u4e71\u8349\u3002\n\n\u5982\u679c\u89c9\u5f97\u4e0d\u591f\u8fc7\u763e\u53ef\u4ee5\u5199\u6210\u77e9\u9635\u4e58\u6cd5\uff0c\u7136\u540e\u7528\u7279\u5f81\u591a\u9879\u5f0f\u4f18\u5316\u77e9\u5feb\u6765\u4e00\u4e2a $O(13^4+13^2\\sum\\log m)$ \u72c2\u66b4\u8f70\u5165\u3002\n\n\u4f46\u662f\u5b9e\u9645\u4e0a $\\sum\\log m$ \u6709 2.5e7\uff0c\u8dd1\u4e2a\u9524\u5b50\u554a\uff01\n\n\u53ea\u80fd\u8003\u8651\u5faa\u73af\u8282\u4e86\u3002\u5bf9\u4e8e $p=3\\times 10^7+1$\uff0c\u6709 $(x+x^{12})^p\\equiv\\sum_{i=0}^{p}\\binom{p}{i}x^ix^{12i}\\equiv x^{12p}+x^p\\equiv x^5+x^8\\pmod{x^{13}-1}$\u3002\n\n\u7136\u540e\u80fd\u53d1\u73b0 $(x^5+x^8)^p\\equiv x^{5p}+x^{8p}\\equiv x+x^{12}\\pmod{x^{13}-1}$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4 $p^2$ \u4e00\u5b9a\u662f\u6a21 $3\\times 10^7+1$ \u7684\u5faa\u73af\u8282\u3002\n\n\u540c\u7406\u6a21 $2.4\\times 10^7+1$ \u7684\u5faa\u73af\u8282\u662f $2.4\\times 10^7$\u3002\n\n\u505a\u4e00\u4e2a lcm \u53ef\u4ee5\u53d1\u73b0\u5faa\u73af\u8282\u4e3a $1800000120000000ll$\uff0c\u53ef\u4ee5\u8584\u7eb1\u4e86\u3002\n```cpp\n#include<cstring>\n#include<cstdio>\ntypedef unsigned long long ull;\ntypedef __uint128_t LL;\ntypedef unsigned ui;\nconst ui M=3e7+5,mod1=2.4e7+1,mod2=3e7+1,MOD1=mod1-1,MOD2=mod2-1;\nconst ull MOD=720000054000001ll,MD=1800000120000000ll;\nui n,m,m1,m2,a[M];char s[10005];\ntemplate<const ui mod,const ui g>\nstruct SolveP{\n\tui fac[mod/3000],ifac[mod];\n\tinline ui pow(ui a,ui b=mod-2){\n\t\tui ans(1);for(;b;b>>=1,a=1ull*a*a%mod)if(b&1)ans=1ull*ans*a%mod;return ans;\n\t}\n\tinline void init(){\n\t\tui c(1);fac[0]=1;for(ui i=2;i<mod;++i)if(c=1ull*c*i%mod,!(i%3000))fac[i/3000]=c;\n\t\tc=pow(c);for(ui i=mod-1;i<mod;--i)ifac[i]=c,c=1ull*c*i%mod;\n\t}\n\tinline ui S(const ui&n,const ui&m){\n\t\treturn 1ull*ifac[m]*ifac[n-m]%mod;\n\t}\n\tinline ui Solve1(const ui&n,const ui&m){\n\t\tui sum(0);const ui&c=pow(g,(mod-1)/n),&ic=pow(g,mod-1-(mod-1)/n);\n\t\tfor(ui x(c),y(ic),i=1;(i<<1)<n;++i)sum=(sum+pow((x+y)%mod,m))%mod,x=1ull*x*c%mod,y=1ull*y*ic%mod;\n\t\treturn(2ull*sum+pow(2,m)+pow(mod-2,m))%mod*pow(n)%mod;\n\t}\n\tinline ui Solve2(const ui&n,const ui&m){\n\t\tconst int&lim=m/n;ui sum(0),Fac(fac[m/3000]);for(ui i=ui(m/3000)*3000+1;i<=m;++i)Fac=1ull*Fac*i%mod;\n\t\tfor(int i=-lim;i<=lim;++i)if(!(m+i*n&1))sum=(sum+1ull*Fac*S(m,m+i*n>>1))%mod;return sum;\n\t}\n};SolveP<mod1,23>T1;SolveP<mod2,14>T2;\nnamespace Solve13{\n\tconst ull mod=720000054000001ll,p[8]={mod-1,1,7,mod-6,mod-14,9,7,mod-2},q[7]={1,0,2,0,6,0,20};\n\tstruct Poly{\n\t\tull f[7];\n\t\tPoly(){f[0]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=0;}\n\t\tinline ull&operator[](const ui&x){\n\t\t\treturn f[x];\n\t\t}\n\t\tinline Poly operator*(Poly g){\n\t\t\tstatic ull tmp[13];static Poly ans;\n\t\t\tfor(ui i=0;i^7;++i)for(ui j=0;j^7;++j)tmp[i+j]=(tmp[i+j]+(LL)f[i]*g[j])%mod;\n\t\t\tfor(ui i=12;i>=7;--i)if(const ull c=tmp[i])for(ui j=0;j^8;++j)tmp[i-j]=(tmp[i-j]+(LL)c*p[j])%mod;\n\t\t\tfor(ui i=0;i^7;++i)ans[i]=tmp[i],tmp[i]=0;return ans;\n\t\t}\n\t};\n\tinline ull Qry(ull m){\n\t\tPoly ans,base;ans[0]=base[1]=1;for(;m;m>>=1,base=base*base)if(m&1)ans=ans*base;\n\t\tull sum(0);for(ui i=0;i^7;++i)sum=(sum+ans[i]*q[i])%mod;return sum;\n\t}\n}\ninline ull CRT(ui a,ui b){\n\treturn((LL)23999997ll*mod2*a+(LL)5ll*mod1*b)%MOD;\n}\nsigned main(){\n\tT1.init();T2.init();\n\twhile(~scanf(\"%u%s\",&n,s+1)){\n\t\tm=strlen(s+1);for(ui i=1;i<=m;++i)a[i]=s[i]-48,s[i]='\\0';m1=m2=0;\n\t\tif(n==13){\n\t\t\tull x=0;for(ui i=1;i<=m;++i)x=(10*x+a[i])%MD;\n\t\t\tprintf(\"%llu\\n\",Solve13::Qry(x));\n\t\t}\n\t\telse{\n\t\t\tfor(ui i=1;i<=m;++i)m1=(10*m1+a[i])%MOD1,m2=(10*m2+a[i])%MOD2;\n\t\t\tprintf(\"%llu\\n\",n<=1000?CRT(T1.Solve1(n,m1),T2.Solve1(n,m2)):CRT(T1.Solve2(n,m1),T2.Solve2(n,m2)));\n\t\t}\n\t}\n}\n```",
        "postTime": 1658199293,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u591a\u9879\u5f0f \u5faa\u73af\u5377\u79ef P8442\u9898\u89e3"
    }
]