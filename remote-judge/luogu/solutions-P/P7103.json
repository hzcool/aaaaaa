[
    {
        "content": "\u8fd9\u9053\u9898\u8fd8\u662f\u5f88\u6709\u8da3\u800c\u5de7\u5999\u7684\uff0c\u5148\u6765\u770b\u4e00\u4e0b\u90e8\u5206\u5206\u5427\u3002  \n### 40pts  \n\u4f60\u662f\u4e0d\u662f\u66b4\u529b\u722c\u6811\u4e86\uff0c\u6216\u8005\u8bf4\u4f60\u6ca1\u6709\u9884\u5904\u7406\u3002  \n### 60pts  \n\u5927\u90e8\u5206 $O(nlogn)$ \u505a\u6cd5\u4f1aTLE7,8;MLE9,10\u3002  \uff08\u53ef\u60dc\u6709\u4e9b\u6ca1\u5361\u6389\uff09\n## 100pts  \n\u8981\u60f3\u5f97\u5230\u6b63\u89e3\uff0c\u5c31\u5fc5\u987b\u5728\u8fd9\u9053\u9898\u4e2d\u95f4\u6316\u6398\u6027\u8d28\u3002  \n\u8fd9\u9053\u9898\u6700\u660e\u663e\u7684\u4e00\u4e2a\u6027\u8d28\u5c31\u662f\u6bcf\u4e00\u6b21\u67e5\u8be2\u7684\u4e00\u5c42\u7684\u8282\u70b9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f80\u6811\u7684\u6df1\u5ea6\u8fd9\u4e00\u65b9\u9762\u60f3\u3002  \n\u9996\u51481\u53f7\u70b9\u662f\u6839\u8282\u70b9\u80af\u5b9a\u662f\u6240\u6709\u5c42\u8282\u70b9\u7684\u516c\u5171\u7956\u5148\uff0c\u4ece\u5b83\u5f00\u59cb\u641c\u80af\u5b9a\u6ca1\u6709\u95ee\u9898\u3002  \n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u5982\u679c\u4e00\u4e2a\u70b9 $u$ \u662f\u7b2c $k$ \u5c42\u6240\u6709\u8282\u70b9\u7684\u516c\u5171\u7956\u5148\uff0c\u90a3\u4e48\u5b83\u4e00\u5b9a\u662f\u7b2c $k+1$ \u5c42\u6240\u6709\u8282\u70b9\u7684\u516c\u5171\u7956\u5148\u3002\u901a\u8fc7\u8fd9\u4e2a\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u641c\u7d22\u91cf\u3002  \n\u4f46\u662f\u600e\u4e48\u641c\u7d22\u5462\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u5b50\u6811\u5185\u6df1\u5ea6\u6700\u5927\u7684\u8282\u70b9\u6df1\u5ea6\u662f\u591a\u5c11\uff0c\u8bbe\u70b9 $u$ \u7684\u5b50\u6811\u6700\u5927\u6df1\u5ea6\u4e3a $f(u)$\u3002  \n\u77e5\u9053\u6bcf\u4e00\u4e2a\u70b9\u7684\u5b50\u6811\u6700\u5927\u6df1\u5ea6\u662f\u591a\u5c11\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u5224\u65ad\u5df2\u77e5\u8282\u70b9 $u$ \u662f\u7b2c $k$ \u5c42\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\uff0c\u5b83\u7684\u513f\u5b50 $v$ \u80fd\u5426\u6210\u4e3a\u7b2c $k+1$ \u5c42\u7684\u516c\u5171\u7956\u5148\u4e86\u3002  \n1. $f(v)\\ge k+1$\u3002  \n2. \u5728 $u$ \u9664\u4e86 $v$ \u7684\u5176\u5b83\u513f\u5b50\u4e2d\uff0c\u6ca1\u6709\u4e00\u4e2a\u513f\u5b50 $w$ \u4f7f\u5f97$f(w)\\ge k+1$  \u89e3\u91ca\uff1a\u5982\u679c\u6709\u4e24\u4e2a\u4ee5\u4e0a\u7684\u513f\u5b50\u5230\u8fbe\u7b2c $k+1$ \u5c42\uff0c\u90a3\u4e48\u80af\u5b9a\u4e00\u8fb9\u5206\u4e86\u4e00\u4e9b\uff0c\u6240\u4ee5\u90fd\u4e0d\u662f\u516c\u5171\u7956\u5148\u3002  \n\n\u56e0\u6b64\uff0c\u53ef\u4ee5\u641c\u7d22\u4e24\u904d\uff0c\u7b2c\u4e00\u904d\u8ba1\u7b97\u51fa $f(u)$\uff0c\u5e76\u8ba1\u7b97\u51fa\u513f\u5b50\u4e2d $f$ \u503c\u6700\u5927\u548c\u6b21\u5927\u7684 $v$ \u548c $w$\uff0c\u8fd9\u6837\u5728\u7b2c\u4e8c\u904d\u641c\u7d22\u65f6\u5c31\u80fd\u5f88\u5feb\u8ba1\u7b97\u51fa\u7b54\u6848\u3002\n\u8fd8\u6709\uff0c\u4e00\u5b9a\u8bb0\u5f97\u5982\u679c $u$ \u7684\u513f\u5b50 $v$ \u662f\u5408\u6cd5\u7684\uff0c\u4e00\u5b9a\u8981\u5c06\u5176\u4f5c\u4e3a\u65b0\u7684 $u$ \u7ee7\u7eed\u641c\u7d22\u3002  \n\u6700\u540e\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u8fd9\u4e48\u8ba1\u7b97\uff0c\u5728\u641c\u7d22\u8fc7\u7a0b\u4e2d\uff1a  \n1. \u5047\u5982\u5f53\u524d\u53d1\u751f\u4e86\u66f4\u65b0\uff0c\u90a3\u4e48\u6240\u6709\u66f4\u65b0\u52a0\u8d77\u6765\u4e0d\u4f1a\u8d85\u8fc7 $n$ \u6b21\u3002\n2. \u5047\u5982\u4e0d\u53d1\u751f\u66f4\u65b0\uff0c\u5219\u662f\u4e00\u4e2a\u5e38\u6570\u3002  \n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n)$ \u7684\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace io {\n\tinline int read() {\n\t\tint __x=0,__f=1;\n\t\tchar __c=getchar();\n\t\twhile(__c<'0'||__c>'9') {\n\t\t\tif(__c=='-')__f=-1;\n\t\t\t__c=getchar();\n\t\t}\n\t\twhile(__c>='0'&&__c<='9') {\n\t\t\t__x=__x*10+__c-'0';\n\t\t\t__c=getchar();\n\t\t}\n\t\treturn __x*__f;\n\t}\n\tchar __F[200];\n\tinline void write(int __x) {\n\t\tif(__x==0) {\n\t\t\tputchar('0');\n\t\t\treturn;\n\t\t}\n\t\tint __tmp,__cnt=0;\n\t\tif(__x>0) {\n\t\t\t__tmp=__x;\n\t\t} else {\n\t\t\t__tmp=-__x;\n\t\t}\n\t\tif(__x<0) {\n\t\t\tputchar('-');\n\t\t}\n\t\twhile(__tmp>0) {\n\t\t\t__F[__cnt++]=__tmp%10+'0';\n\t\t\t__tmp/=10;\n\t\t}\n\t\twhile(__cnt>0) {\n\t\t\tputchar(__F[--__cnt]);\n\t\t}\n\t}\n}\nusing namespace io;\nconst int maxn=5e6+5;\nint d[maxn],md[maxn],ans[maxn],h[maxn],f[maxn],n,m,pos,cnt,nowd,maxd,mx1[maxn],mx2[maxn];\nstruct edge {\n\tint next,to;\n} e[maxn];\nvoid addedge(int x,int y) {\n\te[++cnt].next=h[x];\n\te[cnt].to=y;\n\th[x]=cnt;\n}\nint dfs1(int x,int dep) {\n\tmd[x]=d[x]=dep;\n\tmaxd=max(maxd,d[x]);\n\tfor(register int i=h[x]; i; i=e[i].next) {\n\t\tint j=e[i].to;\n\t\tmd[x]=max(md[x],dfs1(j,dep+1));\n\t\tif(md[j]>md[mx1[x]]) {\n\t\t\tmx2[x]=mx1[x];\n\t\t\tmx1[x]=j;\n\t\t} else if(md[j]>md[mx2[x]]) {\n\t\t\tmx2[x]=j;\n\t\t}\n        //\u7b2c\u4e00\u904d\u641c\u7d22\uff0c\u8ba1\u7b97\u51faf(u)\uff0cf\u503c\u6700\u5927\u548c\u6b21\u5927\u7684\u513f\u5b50\n\t}\n\treturn md[x];\n}\nint dfs2(int x,int now) {\n\tif(md[mx2[x]]>=now) {\n\t\treturn x;//\u5982\u679c\u6709\u591a\u4e8e\u4e24\u4e2a\u53ef\u4ee5\u5230now\u8fd9\u4e2a\u6df1\u5ea6\n\t}\n\tif(!md[mx1[x]]||d[x]==now) {\n\t\treturn x;//\u7279\u5224\u6df1\u5ea6\u7b49\u4e8enow\u53ca\u6700\u5927\u7684\u513f\u5b50\u5230\u4e0d\u4e86\u8fd9\u4e48\u8fdc\n\t}\n\treturn dfs2(mx1[x],now);//\u5f80\u513f\u5b50\u8d70\n}\nint main() {\n\tint x;\n\tn=read(),m=read();\n\tfor(register int i=1; i<=n; i++) {\n\t\tf[i]=read();\n\t\taddedge(f[i],i);\n\t}\n\tdfs1(1,1);\n\tans[0]=1;\n\tfor(register int i=1; i<=maxd; i++) {\n\t\tans[i]=dfs2(ans[i-1],i);//\u6309\u7167\u6df1\u5ea6\u9884\u5904\u7406\n\t}\n\tfor(register int i=1; i<=m; i++) {\n    \t\tx=read();\n\t\twrite(ans[x]);\n\t\tputs(\"\");\n\t}\n\treturn 0;\n}\n```  \n\u6700\u540e\uff0c\u63d0\u793a\u4e00\u4e0b\u5927\u5bb6\u7b2c\u4e8c\u79cd\u60f3\u6cd5\uff08\u7531\u4e8e\u6211\u65e0\u6cd5\u8bc1\u660e\u590d\u6742\u5ea6\u6b63\u786e\u6027\u4f46\u662f\u80fd\u8fc7\u800c\u6ca1\u6709\u5199\u5728\u9898\u89e3\u91cc\uff09\u6309\u7167\u6bcf\u4e00\u4e2a\u7ed3\u70b9\u5b50\u6811\u6240\u8986\u76d6\u7684DFS\u5e8f\u8fdb\u884c\u641c\u7d22\u3002[\u5907\u7528\u6807](https://www.luogu.com.cn/record/41450112)\uff08\u5b8c\u6210\u9898\u76ee\u540e\u53ef\u67e5\u770b\uff09",
        "postTime": 1602341254,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--\u65cf\u8c31\u6811"
    },
    {
        "content": "##\n## \u524d\u8a00\n\n\u770b\u89c1\u9898\u89e3\u6709 \u6811\u5256 \u6c42 $LCA$ \u8fc7\u4e86\u52a0\u5f3a\u7684\u6570\u636e.\n\n\u60ca\u4e86\uff0c\u6811\u5256 $(pao)$ \u4e0d\u662f $O(n log^2n)$ \u5417\uff1f\u8fd9\u662f\u591a\u4e48\u5f3a\u608d\u7684\u5361\u5e38\u5927\u4f6c\u554a\uff01\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd\u4ee3\u7801\u77ed\u7684\u677f\u5b50\u505a\u6cd5.\n\n##\n## \u6b63\u6587\n\n\u770b\u89c1\u8fd9\u9898\uff0c\u7b2c\u4e00\u773c\u60f3\u5230\u4e86 $Tarjan$ \u6c42 $LCA$ ( $Tarjan$ \u8001\u4eba\u5bb6 $tql$ ).\n\n### \u6ca1\u9519\uff0c\u5c31\u662f $Tarjan$ .\n\n```cpp\nvoid add(int x,int y)  {e[++cnt].to=y;e[cnt].nx=h[x];h[x]=cnt;}\nvoid qadd(int x,int y)  {qe[++qcnt].to=y;qe[qcnt].nx=qh[x];qh[x]=qcnt;}\nint find(int p)  {return fa[p]==p?p:fa[p]=find(fa[p]);}\nvoid tarjan(int x)\n{\n\tvis[x]=1;\n\tfor(int i=h[x];i;i=e[i].nx)\n\t{\n\t\tint u=e[i].to;\n\t\tif(vis[u])  continue;\n\t\ttarjan(u);fa[u]=x;\n\t}\n\tfor(int i=qh[x];i;i=qe[i].nx)\n\t{\n\t\tint u=qe[i].to;\n\t\tif(vis[u])  lct[(i&1?(i+1):(i-1))]=lct[i]=find(u);\n\t}\n}\n```\n\u5c31\u662f\u8fd9\u4e2a $Tarjan$ \uff01\n\n\u4e0d\u4f1a $Tarjan$ \u6c42 $LCA$ \u7684\u540c\u5fd7\u8bf7 [\u51fa\u95e8\u5de6\u8f6c](https://www.cnblogs.com/JVxie/p/4854719.html)\uff08\u4e0d\u8981\u770b\u80cc\u666f\uff09.\n\n\u4f46\u662f $Tarjan$ \u662f\u79bb\u7ebf\u7684\uff0c\u5982\u679c\u662f $Tarjan$ \u53ef\u80fd\u65e0\u6cd5\u5904\u7406\uff08\u5047\u5982\u6709\u4e09\u4e2a\u6df1\u5ea6\u4e3a $k$ \u7684\u70b9\uff0c\u6700\u66b4\u529b\u7684\u505a\u6cd5\u9700\u8981\u5148\u6c42\u7b2c\u4e00\u548c\u7b2c\u4e8c\u4e2a\u70b9\u7684 $LCA$\uff0c\u518d\u6c42 $LCA$ \u548c\u7b2c\u4e09\u4e2a\u70b9\u7684 $LCA$\uff09\u8fd9\u6837\u52a8\u6001\u7684\u8be2\u95ee.\n\n\u4f3c\u4e4e\u500d\u589e\u53ef\u4ee5\u5e94\u5bf9\u52a8\u6001\u8be2\u95ee\uff0c\u4f46\u59a5\u59a5 $TLE$ \u5230\u98de\u8d77\uff08 \u8fd9\u9898\u5fc5\u987b $O(n+q)$ \u5462 \uff09\uff0c\u6240\u4ee5\u6211\u4eec\u575a\u6301 $Tarjan$ .\n\n\u6ce8\u610f\u5230 $Tarjan$ \u6c42 $LCA$ \u9700\u8981\u5728\u8981\u6c42 $LCA$ \u7684\u70b9\u4e0a\u6302\u8be2\u95ee\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u4e0d\u59a8\u5f00\u4e00\u4e2a\u6570\u7ec4 $ans$\uff0c\u8bbe\u5f53\u524d\u70b9\u4e3a $x$ \uff0c\u6df1\u5ea6\u4e3a $d[x]$ \uff0c\u5219 $ans[d[x]]$ \u8868\u793a\u5904\u7406\u5230 $x$ \u70b9\u4e4b\u524d\u6240\u6709\u6df1\u5ea6\u4e3a $d[x]$ \u7684\u70b9\u7684 $LCA$ , \u90a3\u4e48\u8fd9\u4e2a\u6570\u7ec4\u5c31\u53ef\u4ee5\u8fd1\u4f3c\u5730\u8ba4\u4e3a\u662f\u6302\u5728\u70b9 $x$ \u4e0a\u7684\u8be2\u95ee\uff08\u5b9e\u9645\u4e0a\u5c31\u662f\u8fd9\u6837\u7684\uff09.\n\n$dfs$ \u5230 $x$ \u70b9\u65f6\uff0c\u82e5 $ans[d[x]]=0$ (\u4e4b\u524d\u6ca1\u6709\u6df1\u5ea6\u4e3a $d[x]$ \u7684\u70b9\uff09\uff0c\u5c31\u4ee4 $ans[d[x]]=x$ \uff0c\u5426\u5219\u5c31\u50cf $Tarjan$ \u6c42 $LCA$ \u4e00\u6837\u4ee4 $ans[d[x]]=find(ans[d[x]])$ .\n\n\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e $Tarjan$ \u6c42 $LCA$ \u4e2d\u7684 $lct[i]=find(u)$ \u8fd9\u53e5\uff1a\n\n```\nfor(int i=qh[x];i;i=qe[i].nx)\n{\n\tint u=qe[i].to;\n\tif(vis[u])  lct[(i&1?(i+1):(i-1))]=lct[i]=find(u);\n}\n```\n\u6700\u540e $ans$ \u6570\u7ec4\u5b58\u7684\u5c31\u662f\u7b54\u6848 ( $ans[i]$ \u5c31\u662f\u6240\u6709\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u7684 $LCA$ )\n\n### \u6700\u540e\n\n\u4e0a\u4ee3\u7801\n\n###### ~~\uff08\u53ef\u80fd\u8fd9\u624d\u662f\u4f60\u6700\u671f\u5f85\u7684\uff09~~ \uff1a\n\n##### \u4ee3\u7801\u771f\u7684\u633a\u77ed\u7684\n\n```cpp\n#include<bits/stdc++.h>\n#define R register int\nusing namespace std;\nconst int N=5e6+5;\nint n,d[N],to[N],nx[N],h[N],fa[N],q,in,ans[N];\ninline int read()//\u5feb\u8bfb\u5c31\u4e0d\u7528\u8bf4\u4e86\u5427\n{\n\tint s=0;char c=getchar();\n\twhile(!isdigit(c))  c=getchar();\n\twhile(isdigit(c))  s=(s<<3)+(s<<1)+(c^48),c=getchar();\n\treturn s;\n}\nint find(int p) {return fa[p]==p?p:fa[p]=find(fa[p]);}//\u5e76\u67e5\u96c6\nvoid dfs(int x,int f)\n{\n\td[x]=d[f]+1;\n\tfor(R i=h[x];i;i=nx[i])  dfs(to[i],x),fa[to[i]]=x;//tarjan \u6c42LCA\u7684\u5408\u5e76\n\tans[d[x]]=ans[d[x]]?find(ans[d[x]]):x;//\u6838\u5fc3\u90e8\u5206\uff0ctarjan\u6c42LCA\u4e2d\u7684\u6c42\u7b54\u6848\u90e8\u5206\n}\nint main()\n{\n\tn=read();q=read();\n\tfor(R i=1;i<=n;i++)  fa[i]=i,in=read(),to[i]=i,nx[i]=h[in],h[in]=i;//\u8bfb\u5165+\u52a0\u8fb9+\u5e76\u67e5\u96c6init\n\tdfs(1,0);\n\twhile(q--)  printf(\"%d\\n\",ans[read()]);//O(1) \u5904\u7406\u8be2\u95ee\n\treturn 0;\n}\n```\n\n##\n### \u611f\u8c22\u9605\u8bfb",
        "postTime": 1606474590,
        "uid": 179253,
        "name": "\u65e0\u5c3d\u661f\u7a7a",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "\u4e3a\u4ec0\u4e48 5 \u7bc7\u9898\u89e3 3 \u7bc7\u8fc7\u4e0d\u53bb\u52a0\u5f3a\u6570\u636e\u2026\u2026\n\n---\n\n\u9898\u610f\uff1a\u7ed9\u4e00\u4e2a\u6811\uff0c\u591a\u6b21\u8be2\u95ee\u6240\u6709\u6df1\u5ea6\u4e3a $k$ \u7684\u8282\u70b9\u7684 $\\rm LCA$ \u3002\n\n$n\\leq 5\\times 10^6$ \u3002\n\n\u65f6\u9650\uff1a$\\texttt{1.2s}$ \u3002\n\n\n---\n\n\u6b63\u89e3\u5f53\u7136\u662f $O(n)$ \u7684\uff0c\u4f46\u662f\u6211\u8fd9\u7bc7\u9898\u89e3\u8bb2\u7684\u5e76\u4e0d\u662f\u6b63\u89e3\uff0c\u800c\u662f\u5b9e\u9645\u8fd0\u884c\u901f\u5ea6\u76f8\u5f53\u53ef\u4ee5\u7684 $n\\log n$ \u7684\u76f4\u63a5 $\\rm LCA$ \u505a\u6cd5\uff0c\u548c\u4ed6\u7684\u5e38\u6570\u4f18\u5316\u3002\n\n\u8fd9\u91cc\u7528\u7684\u662f\u6811\u5256\u6c42 $\\rm LCA$ \uff0c\u5f53\u7136\u500d\u589e\u6c42\u94c1 $\\rm MLE$\uff0c\u5e76\u4e14\u500d\u589e\u662f\u8dd1\u6ee1 $\\log $ \u7684\u3002\n\n#### 1. $\\texttt{\u4f18\u53161}$\uff1a\n\n\u5728\u6570\u636e\u4e3a $5\\times 10^6$ \u7684\u60c5\u51b5\u4e0b\uff0c $\\rm dfs$ \u4e00\u904d\u6811\u6240\u8bdd\u7684\u65f6\u95f4\u662f $\\rm 0.8s$ \u5de6\u53f3\uff08\u8fd9\u91cc\u4f7f\u7528\u7684\u662f\u6807\u7a0b\u7684 $\\rm dfs$\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e24\u904d $\\rm dfs$ \u65f6\u95f4\u5c31\u4e0d\u591f\u4e86\uff0c\u751a\u81f3\u6bd4\u540e\u9762\u5e26 $\\log $ \u7684\u90e8\u5206\u8fd8\u6162\u3002\n\n\u8003\u8651\u4f18\u5316 $\\rm dfs$\uff0c\u7b2c\u4e00\u4e2a$\\rm dfs$ \u91cc\u6709\u4ece\u513f\u5b50\u8f6c\u79fb\u7684\u90e8\u5206\uff0c\u82e5\u8981\u6a21\u62df\u53ef\u80fd\u6709\u4e9b\u9ebb\u70e6\uff08\u53ef\u4ee5\u7528\u6808\u6a21\u62df\uff0c\u4f46\u4e0d\u77e5\u9053\u65f6\u95f4\u662f\u5426\u66f4\u5feb\uff09\uff0c\u82e5\u662f\u641e\u4e2a\u961f\u5217\u6b63\u7740\u4e00\u904d\uff0c\u53cd\u7740\u4e00\u904d\u90a3\u66f4\u662f\u901f\u5ea6\u6bd4 $\\rm dfs$ \u8fd8\u6162\u3002\u4f46\u662f\u7b2c\u4e8c\u4e2a $\\rm dfs$ \u5374\u6240\u6709\u8f6c\u79fb\u90fd\u662f\u7236\u4eb2\u5230\u513f\u5b50\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u7528\u961f\u5217\u6a21\u62df\u5373\u53ef\uff08\u5b9e\u6d4b $\\rm STL $ \u7684 queue \u6bd4\u624b\u5199\u7684\u6570\u7ec4\u5feb\uff09\u3002\n\n\u5176\u4e2d @\u8363\u8000\u5357\u51a5 \u5de8\u4f6c\u7528\u7684\u957f\u94fe\u5256\u5206\uff0c\u5c06\u7b2c\u4e8c\u904d $\\rm dfs$ \u526a\u679d\u5b9e\u6d4b\u4e5f\u53ef\u4ee5\u8fc7\u3002\n#### 2. $\\texttt{\u4f18\u53162}$\uff1a\n\n\u5728\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u4e0d $\\rm dfs$\uff0c\u800c\u662f\u76f4\u63a5\u904d\u5386\u6bcf\u4e2a\u70b9\uff0c\u4e00\u6b21\u6027\u628a\u6240\u6709\u70b9\u7edf\u8ba1\uff0c\u6211\u5728\u7edf\u8ba1\u7684\u65f6\u5019\u8fd8\u641e\u4e86\u4e2a\u5faa\u73af\u5c55\u5f00\uff0c\u4e0d\u77e5\u5b9e\u9645\u4f18\u5316\u6548\u679c\u5982\u4f55 \u3002\n\n\n#### 3. $\\texttt{\u4f18\u53163}$\uff1a\n\n\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u6bcf\u6b21\u628a $ans[dep[x]]$ \u548c $x$ \u53d6 $\\rm LCA$ \u7684\u65f6\u5019\uff0c\u82e5$ans[dep[x]]$  \u662f $x$ \u7684\u7956\u5148\uff0c\u5219\u53ef\u4e0d\u5fc5\u64cd\u4f5c\u3002\n\n\u8be2\u95ee\u662f\u5426\u6709\u7956\u5148\u5173\u7cfb\uff0c\u53ef\u4ee5\u7528\u4e24\u4e2a $\\rm dfn$ \u6570\u7ec4\u641e\u5b9a\uff08\u4e00\u4e2a\u8bb0\u5f55\u7b2c\u4e00\u6b21\u5230\u8fd9\u4e2a\u70b9\u7684\u65f6\u95f4\u6233\uff0c\u4e00\u4e2a\u8bb0\u5f55\u56de\u6eaf\u5230\u8fd9\u4e2a\u70b9\u7684\u65f6\u95f4\u6233\uff09\u3002\n\n#### 4. $\\texttt{\u4f18\u53164}$\uff1a\n\n\u52a0\u8fb9\u7684\u65f6\u5019\u8bb0\u5f97\u53ea\u52a0\u7236\u4eb2\u5230\u513f\u5b50\u7684\u5355\u5411\u8fb9\u3002\n\n#### 5. $\\texttt{\u4f18\u53165}$\uff1a\n\n\u8fd9\u9898\u5927\u91cf\u8bfb\u5165/\u8f93\u51fa\uff0c\u4f7f\u7528\u6bd4\u8f83\u5feb\u7684\u8bfb\u5165/\u8f93\u51fa\u6a21\u677f\u3002\n\n---\n\n\u5927\u6982\u5c31\u662f\u8fd9\u4e48\u4e9b\u5c0f\u4f18\u5316\uff0c\u5408\u8d77\u6765\u8fc7\u4e86\u6b64\u65f6\u7684\u6570\u636e $n \\leq 5\\times 10^6$ \uff0c$1.2s$ \uff0c\u7136\u800c\u6807\u7a0b\u6700\u6162\u7684\u70b9\u4e5f\u8dd1\u4e86 $\\rm 973ms$\uff0c\u6807\u7a0b\u662f $O(n)$\u7684\u3002 \n\n\u4ee3\u7801\u53ea\u653e\u90e8\u5206\uff0c\u820d\u53bb\u8bfb\u5165\u8f93\u51fa\u6a21\u677f\uff0c\u8fd9\u4e2a\u4e1c\u897f\u82b1\u4e86\u6211 $\\rm 2h$ \uff0c\u672c\u4eba\u5361\u5e38\u6280\u672f\u4e0d\u4f73\uff0c\u671b\u8bfb\u8005\u89c1\u8c05\u3002\n\n```cpp\n#define For(pos) for(register int k=First[pos];k;k=Next[k])\ninline void add(int z,int y)\n{\n    Next[++cnt]=First[z];\n    First[z]=cnt;\n    to[cnt]=y;\n}\nvoid dfs1(int p,int dep,int father)\n{\n\tdfn1[p]=++dfn1[0];\n    depth[p]=dep;\n    fa[p]=father;\n    int maxv=-1;\n    siz[p]=1;\n    For(p)\n        {\n            dfs1(to[k],dep+1,p);\n            siz[p]+=siz[to[k]];\n            if(siz[to[k]]>maxv)\n            {\n                maxv=siz[to[k]];\n                son[p]=to[k];\n            }\n        }\n    dfn2[p]=dfn1[0];\n}\nint LCA( int x, int y)\n{\n    while(top[x]!=top[y])\n    (depth[top[x]]>=depth[top[y]])? x=fa[top[x]]:y=fa[top[y]];\n    return depth[x]<depth[y]?x:y;\n}\nvoid work()//\u8dd1\u51fa\u6bcf\u4e2a\u70b9\u5bf9\u5e94\u6df1\u5ea6\u7684LCA\n{\n\tint pos=1;\n\tfor(;pos+6<=n;pos+=6)\n\t{\n\tif(ANS[depth[pos]]!=1)\n\t{\n\t\tif(!ANS[depth[pos]])ANS[depth[pos]]=pos;\n\t\telse if(dfn1[ANS[depth[pos]]]>dfn1[pos]||dfn2[ANS[depth[pos]]]<dfn2[pos])//\u5982\u679c\u6ca1\u6709\u7956\u5148\u5173\u7cfb\n\t\tANS[depth[pos]]=LCA(pos,ANS[depth[pos]]);\n\t}\n\tif(ANS[depth[pos+1]]!=1)\n\t{\n\t\tif(!ANS[depth[pos+1]])ANS[depth[pos+1]]=pos+1; \n\t\telse if(dfn1[ANS[depth[pos+1]]]>dfn1[pos+1]||dfn2[ANS[depth[pos+1]]]<dfn2[pos+1])\n\t\t\n\t\tANS[depth[pos+1]]=LCA(pos+1,ANS[depth[pos+1]]);\n\t}\n\tif(ANS[depth[pos+2]]!=1)\n\t{\n\t\tif(!ANS[depth[pos+2]])ANS[depth[pos+2]]=pos+2; \n\t\telse if(dfn1[ANS[depth[pos+2]]]>dfn1[pos+2]||dfn2[ANS[depth[pos+2]]]<dfn2[pos+2])\n\t\t\n\t\tANS[depth[pos+2]]=LCA(pos+2,ANS[depth[pos+2]]);\n\t}\n\tif(ANS[depth[pos+3]]!=1)\n\t{\n\t\tif(!ANS[depth[pos+3]])ANS[depth[pos+3]]=pos+3; \n\t\telse if(dfn1[ANS[depth[pos+3]]]>dfn1[pos+3]||dfn2[ANS[depth[pos+3]]]<dfn2[pos+3])\n\t\t\n\t\tANS[depth[pos+3]]=LCA(pos+3,ANS[depth[pos+3]]);\n\t}\n\tif(ANS[depth[pos+4]]!=1)\n\t{\n\t\tif(!ANS[depth[pos+4]])ANS[depth[pos+4]]=pos+4; \n\t\telse if(dfn1[ANS[depth[pos+4]]]>dfn1[pos+4]||dfn2[ANS[depth[pos+4]]]<dfn2[pos+4])\n\t\t\n\t\tANS[depth[pos+4]]=LCA(pos+4,ANS[depth[pos+4]]);\n\t}\n\tif(ANS[depth[pos+5]]!=1)\n\t{\n\t\tif(!ANS[depth[pos+5]])ANS[depth[pos+5]]=pos+5; \n\t\telse if(dfn1[ANS[depth[pos+5]]]>dfn1[pos+5]||dfn2[ANS[depth[pos+5]]]<dfn2[pos+5])\n\t\t\n\t\tANS[depth[pos+5]]=LCA(pos+5,ANS[depth[pos+5]]);\n\t}\n\t}\n\tfor(;pos<=n;pos++)\n\tif(ANS[depth[pos]]!=1)\n\t{\n\t\tif(!ANS[depth[pos]])ANS[depth[pos]]=pos;\n\t\telse \n\t\tif(dfn1[ANS[depth[pos]]]>dfn1[pos]||dfn2[ANS[depth[pos]]]<dfn2[pos])\n\t\tANS[depth[pos]]=LCA(pos,ANS[depth[pos]]);\n\t}\n}\nint main(){\n\tn=read();m=read();\n\tx=read();\n\tfor(register int i=2;i<=n;i++)add(read(),i);\n\tdfs1(1,1,0);\n\tqueue<pair<int,int > >q;\n\tq.push(make_pair(1,1));\n\tpair<int,int>p;\n\twhile(!q.empty())\n\t{\n\t\tp=q.front();\n\t\tq.pop();\n\t\ttop[p.first]=p.second;\n    \tFor(p.first)\n    \tq.push(make_pair(to[k],to[k]==son[p.first]?p.second:to[k]));\n\t}\n\twork();\n\twhile(m--) write(ANS[R()]),puts(\"\");\n}\n```\n\n",
        "postTime": 1606345763,
        "uid": 220857,
        "name": "\u7d20\u8d28\u73a9\u5bb6\u5b591\u8d85",
        "ccfLevel": 6,
        "title": "\u83dc\u903c\u5206\u4eab\u5361\u5e38\u5c0f\u6280\u5de7"
    },
    {
        "content": "\u4ecb\u7ecd\u4e00\u4e2a $O(n)$ \u7684\u505a\u6cd5\uff0c\u662f\u5927\u4f6c[lsy](https://www.luogu.com.cn/user/100806)\u79d2\u60f3\u5230\u7684\uff0corz\u3002\n\n\u53ef\u4ee5\u627e\u52301\u4e2a\u89c4\u5f8b\uff1a\n+ \u6240\u6709\u6df1\u5ea6\u7684LCA\u90fd\u4e00\u5b9a\u5728\u6700\u6df1\u70b9\u5230\u6811\u6839\u7684\u94fe\u4e0a\uff08\u663e\u800c\u6613\u89c1\uff09\n\n\u6709\u4e86\u8fd9\u4e2a\u89c4\u5f8b\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u6700\u6df1\u5904\u4e00\u4e2a\u4e00\u4e2a\u70b9\u5411\u4e0a\u8df3\u627eLCA\uff0c\u5224\u65ad\u8fd9\u4e2a\u70b9\u662f\u4e0d\u662f\u8fd9\u4e2a\u6df1\u5ea6\u7684\u70b9\u7684LCA\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528dfn\u5e8f\u6765\u5224\u65ad\u3002\n\n\n------------\n\n\u5b9e\u73b0\uff1a\n+ \u4e00\u904ddfs\u6c42dfn\n+ \u4ece\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u4e00\u4e2a\u4e00\u4e2a\u5411\u4e0a\u8df3\u627eLCA\n+ \u8be2\u95ee\uff0c\u6bcf\u6b21 $O(1)$ \u8f93\u51fa\n\n\n------------\n\n\u9898\u5916\u8bdd\uff1a\n\n\u8fd9\u9898\u5361\u5e38\u5f88\u79bb\u8c31\uff0c\u5c31\u8fde\u51fa\u9898\u4eba\u7684\u9898\u89e3\u5728\u4f60\u8c37\u7684\u8bc4\u6d4b\u673a\u90fd\u53ef\u80fd\u4f1aT\uff0c\u6240\u4ee5\u8fd9\u91cc\u7528\u4e86 ``fast io`` \u548c ``register`` \u5361\u4e86\u5361\u5e38\uff0c\u786e\u4fdd\u6211\u7684\u7801\u80fd\u4fdd\u8bc1 $100$% \u5361\u8fc7\u3002\u6700\u540e\uff0c\u8fd9\u9898\u5361\u6811\u5256\u8fd8\u662f\u6ca1\u5361\u6389\uff0c\u540c\u673a\u623f\u7684\u6811\u5256\u5728\u5f00\u5927\u7a7a\u95f4\u540e\u7528\u4e86fast io\u8fc7\u4e86\u3002\n\n\n------------\n\n\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n/* --------------- fast io --------------- */ // begin\nnamespace Fread {\n  const int SIZE = 1 << 21;\n  char buf[SIZE], *S, *T;\n  inline char getchar() {\n    if (S == T) {\n      T = (S = buf) + fread(buf, 1, SIZE, stdin);\n      if (S == T) return EOF;\n    }\n    return *S++;\n  }\n} // namespace Fread\nnamespace Fwrite {\n  const int SIZE = 1 << 21;\n  char buf[SIZE], *S = buf, *T = buf + SIZE;\n  inline void flush() {\n    fwrite(buf, 1, S - buf, stdout);\n    S = buf;\n  }\n  inline void putchar(char c) {\n    *S++ = c;\n    if (S == T) flush();\n  }\n  struct NTR {\n    ~ NTR() { flush(); }\n  }ztr;\n} // namespace Fwrite\n#define getchar Fread :: getchar\n#define putchar Fwrite :: putchar\nnamespace Fastio {\n  struct Reader {\n    template<typename T>\n    Reader& operator >> (T& x) {\n      char c = getchar();\n      T f = 1;\n      while (c < '0' || c > '9') {\n\tif (c == '-') f = -1;\n\tc = getchar();\n      }\n      x = 0;\n      while (c >= '0' && c <= '9') {\n\tx = x * 10 + (c - '0');\n\tc = getchar();\n      }\n      x *= f;\n      return *this;\n    }\n    Reader& operator >> (char& c) {\n      c = getchar();\n      while (c == '\\n' || c == ' ') c = getchar();\n      return *this;\n    }\n    Reader& operator >> (char* str) {\n      int len = 0;\n      char c = getchar();\n      while (c == '\\n' || c == ' ') c = getchar();\n      while (c != '\\n' && c != ' ') {\n\tstr[len++] = c;\n\tc = getchar();\n      }\n      str[len] = '\\0';\n      return *this;\n    }\n    Reader(){}\n  }cin;\n  const char endl = '\\n';\n  struct Writer {\n    template<typename T>\n    Writer& operator << (T x) {\n      if (x == 0) { putchar('0'); return *this; }\n      if (x < 0) { putchar('-'); x = -x; }\n      static int sta[45];\n      int top = 0;\n      while (x) { sta[++top] = x % 10; x /= 10; }\n      while (top) { putchar(sta[top] + '0'); --top; }\n      return *this;\n    }\n    Writer& operator << (char c) {\n      putchar(c);\n      return *this;\n    }\n    Writer& operator << (char* str) {\n      int cur = 0;\n      while (str[cur]) putchar(str[cur++]);\n      return *this;\n    }\n    Writer& operator << (const char* str) {\n      int cur = 0;\n      while (str[cur]) putchar(str[cur++]);\n      return *this;\n    }\n    Writer(){}\n  }cout;\n} // namespace Fastio\n#define cin Fastio :: cin\n#define cout Fastio :: cout\n#define endl Fastio :: endl\n/* --------------- fast io --------------- */ // end\nconst int N=5e6+5;\nint n,Q,ans[N],fa[N];\nint hd[N],nx[N],to[N],tot;\nvoid adde(int u,int v){\n  nx[++tot]=hd[u];to[tot]=v;hd[u]=tot;\n}\nint dfn[N],mi[N],mx[N],ed[N],dep[N],dfstime,maxdep,dopoint;\nvoid dfs(int v){\n  dfn[v]=++dfstime;\n  if(dep[v]>maxdep) maxdep=dep[v],dopoint=v;\n  if(!mi[dep[v]]) mi[dep[v]]=mx[dep[v]]=dfn[v];\n  else mi[dep[v]]=min(mi[dep[v]],dfn[v]),mx[dep[v]]=max(mx[dep[v]],dfn[v]);\n  for(register int i=hd[v];i;i=nx[i]){\n    register int u=to[i];\n    dep[u]=dep[v]+1;\n    dfs(u);\n  }\n  ed[v]=dfstime;\n}\nbool checkin(int x,int y){\n  return x>=dfn[y]&&x<=ed[y];\n}\nint main(){\n  cin>>n>>Q;\n  for(int i=1;i<=n;i++){\n    cin>>fa[i];\n    if(fa[i]) adde(fa[i],i);\n  }\n  dep[1]=1;dfs(1);\n  for(int i=maxdep;i>=1;i--){\n    while(!checkin(mi[i],dopoint)||!checkin(mx[i],dopoint)) dopoint=fa[dopoint];\n    ans[i]=dopoint;\n  }\n  while(Q--){\n    int k;\n    cin>>k;\n    cout<<ans[k]<<endl;\n  }\n  return 0;\n}\n```\n\n",
        "postTime": 1606285100,
        "uid": 186045,
        "name": "itisover",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "### \u9898\u610f\uff1a\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u591a\u6b21\u8be2\u95ee\u8fd9\u68f5\u6811\u6240\u6709\u7b2ck\u5c42\u8282\u70b9\u7684LCA\uff08\u6700\u8fd1\u516c\u5171\u7956\u5148\uff09$n\\le 5*10^6\uff0cm<=n$\n\n### \u63d0\u4f9b\u4e00\u79cd\u597d\u50cf\u6709\u70b9\u5947\u602a\u7684\u505a\u6cd5\n\n$Max[i]$\u8868\u793a\u7f16\u53f7\u4e3a$i$\u7684\u70b9\u7684\u5b50\u6811\u6700\u5927\u6df1\u5ea6\uff0c$aMax[dep]$\u8868\u793a\u6df1\u5ea6\u4e3a$dep$\u7684\u6240\u6709\u8282\u70b9\u7684\u5b50\u6811\u6700\u5927\u6df1\u5ea6\u7684\u6700\u5927\u503c\uff0c$acMax[dep]$\u8868\u793a\u6df1\u5ea6\u4e3a$dep$\u7684\u6240\u6709\u8282\u70b9\u5b50\u6811\u6700\u5927\u6df1\u5ea6\u7684\u6b21\u5927\u503c\u3002\n\n\u8003\u8651\u4e00\u4e2a\u8282\u70b9\u80fd\u4f5c\u4e3a\u67d0\u5c42\u8282\u70b9LCA\u7684\u8981\u6c42\uff1a\n\n\u5982\u679c$acMax[dep[i]]==0$\uff0c\u610f\u5473\u7740\u540c\u4e00\u5c42\u53ea\u6709\u5b83\u8fd9\u4e00\u4e2a\u8282\u70b9\u3002\u90a3\u4e48\u6240\u6709\u6df1\u5ea6\u5728$[dep[i],Max[i]]$\u5c42\u7684\u8282\u70b9\uff0c\u5982\u679c$i$\u7684\u513f\u5b50\u6ca1\u6709\u4f5c\u4e3a\u8fd9\u4e9b\u5c42\u7684LCA\uff0c\u90a3\u4e48$i$\u5c31\u4f5c\u4e3a\u8fd9\u4e9b\u5c42\u7684LCA\n\n\u5982\u679c$acMax[dep[i]]!=0$\uff0c\u610f\u5473\u7740\u540c\u4e00\u5c42$i$\u8fd8\u6709\u5144\u5f1f\u3002\u90a3\u4e48\u6240\u6709\u6df1\u5ea6\u5728$[acMax[dep[i]]+1,Max[i]]$\u5c42\u7684\u8282\u70b9\uff0c\u5982\u679c$i$\u7684\u513f\u5b50\u6ca1\u6709\u4f5c\u4e3a\u8fd9\u4e9b\u5c42\u7684LCA\uff0c\u90a3\u4e48$i$\u5c31\u4f5c\u4e3a\u8fd9\u4e9b\u5c42\u7684LCA\n\n\u5bf9\u4e8e\u5f53\u524d\u70b9\uff0c\u5728\u679a\u4e3e\u4f5c\u4e3a\u54ea\u4e2a\u6df1\u5ea6\u5c42\u6240\u6709\u70b9\u7684LCA\u65f6\uff0c\u4e00\u65e6\u9047\u5230\u4e86\u7b2c\u4e00\u4e2a**\u513f\u5b50\u5df2\u7ecf\u6210\u4e3a\u8be5\u5c42\u8282\u70b9\u7684LCA**\u65f6\uff0c\u5c31break\uff0c\u56e0\u4e3a\u518d\u6df1\u7684\u70b9\u4e00\u5b9a\u4e5f\u6709LCA\u4e86\u3002\u8fd9\u6837\u4fdd\u8bc1\u4e86\u65f6\u95f4\u590d\u6742\u5ea6$O(n)$\n",
        "postTime": 1606871765,
        "uid": 94193,
        "name": "BJEA\u8d75\u5b50\u6f47",
        "ccfLevel": 7,
        "title": "\u6d1b\u8c37\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811"
    },
    {
        "content": "\u7531\u4e8e\u672c\u849f\u84bbLCA\u529f\u5e95\u592a\u5dee\uff0c\u53ea\u4f1a\u500d\u589eLCA\uff0c\u770b\u5230\u8fd9\u9053\u9898\u5c31\u60f3\u4e86\u4e9b\u5947\u602a\u7684\u505a\u6cd5\u3002\r\n\r\n\u4ee5\u4e0b\u6307\u7684\u957f\u5ea6\u90fd\u662f\u6307\u5b50\u6811\u6700\u6df1\u7684\u6df1\u5ea6\uff0c\u67d0\u4e2a\u70b9\u7684\u5b50\u6811\u5305\u542b\u8fd9\u4e2a\u70b9\u3002\r\n\r\n\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\uff0c\u5982\u679c\u5b83\u7684\u6b21\u957f\u513f\u5b50\u5728\u7b2c$k$\u5c42\u8fd8\u6709\u8282\u70b9\uff0c\u90a3\u4e48\u5b83\u7684\u5b50\u6811\u4e0a\u7b2ck\u5c42\u7684LCA\u5c31\u662f\u8fd9\u4e2a\u8282\u70b9\u3002\r\n\r\n\uff08\u4e3a\u4ec0\u4e48\u5462\uff1f\u5982\u679c\u7b2c$k$\u5c42\u4e0a\u6709\u8282\u70b9\u5e76\u4e14\u5b83\u7684\u6b21\u957f\u513f\u5b50\u5728\u7b2c$k$\u5c42\u4e0a\u6ca1\u6709\u8282\u70b9\uff0c\u90a3\u7b2c$k$\u5c42\u7684\u8282\u70b9\u53ea\u4f1a\u5728\u4ed6\u6700\u957f\u513f\u5b50\u4e0a\uff0c\u90a3LCA\u4f1a\u5728\u6700\u957f\u513f\u5b50\u548c\u6700\u957f\u513f\u5b50\u7684\u5b50\u6811\u4e0a\u53d6\u5f97\u800c\u4e0d\u4f1a\u662f\u8fd9\u4e2a\u8282\u70b9\u3002\uff09\r\n\r\n\u8fd9\u6837\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5904\u7406\u51fa\u6bcf\u4e2a\u8282\u70b9\u7684\u6700\u957f\u513f\u5b50\u7684\u957f\u5ea6\u548c\u6b21\u957f\u513f\u5b50\u7684\u957f\u5ea6\uff0c\u7136\u540e\u627e\u5230\u8fd9\u68f5\u6811\u6700\u957f\u94fe\uff0c\u7528\u6700\u957f\u94fe\u4e0a\u7684\u70b9\u6765\u5f97\u51fa\u6bcf\u4e00\u5c42\u7684\u7b54\u6848\uff0c\u8f93\u51fa\u5373\u53ef\u3002\r\n\r\n\u5982\u679c\u4e0a\u9762\u8bf4\u7684\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u4e0d\u592a\u7406\u89e3\u7684\u8bdd\u8bf7\u770b\u4ee3\u7801\uff1a\r\n\r\n```cpp\r\n#include<iostream>\r\n#include<cstdio>\r\n#define rep(i,a,b) for(register int i=(a);i<=b;i++)\r\n#define rop(i,a,b) for(register int i=(a);i<b;i++)\r\n#define per(i,a,b) for(register int i=(a);i>=b;i--)\r\n#define por(i,a,b) for(register int i=(a);i>b;i--)\r\nusing namespace std;\r\nint n,m,q,cnt,cntt,maxd,maxi,fa[5000006],dep[5000006],m2xk[5000006],maxk[5000006],ans[5000006],lian[5000006],h[5000006];\r\n//cnt\u662f\u5904\u7406\u7b54\u6848\u65f6\u679a\u4e3e\u5230\u7684\u6df1\u5ea6\uff0ccntt\u662f\u94fe\u5f0f\u524d\u5411\u661f\u7528\u5230\u7684\uff0cmaxd\u662f\u6700\u6df1\u7684\u6df1\u5ea6\uff0cmaxi\u662f\u6700\u6df1\u7684\u70b9\uff0cfa[x]\u662fx\u7684\u7236\u4eb2\uff0cdep[x]\u662fx\u7684\u6df1\u5ea6\uff0cmaxk[x]\u662fx\u7684\u6700\u957f\u5b50\u6811\u7684\u957f\u5ea6\uff0cm2xk[x]\u662fx\u7684\u6b21\u957f\u5b50\u6811\u7684\u957f\u5ea6\uff0cans[x]\u662f\u6df1\u5ea6\u4e3ax\u65f6\u7684\u7b54\u6848\uff0clian[x]\u662f\u6700\u957f\u94fe\uff0ch[x]\u662f\u94fe\u5f0f\u524d\u5411\u661f\u7528\u5230\u7684\u3002\r\n\r\nstruct node{\t//\u94fe\u5f0f\u524d\u5411\u661f\r\n\tint nx,to;\r\n}e[5000006];\r\n\r\nvoid add(int x,int y){\t//\u52a0\u8fb9\r\n\tcntt++;\r\n\te[cntt].nx=h[x];\r\n\te[cntt].to=y;\r\n\th[x]=cntt;\r\n}\r\n\r\ninline int read(){\t//\u5feb\u8bfb\r\n\tint s=0;char c=getchar();\r\n\twhile(!isdigit(c))  c=getchar();\r\n\twhile(isdigit(c))  s=(s<<3)+(s<<1)+(c^48),c=getchar();\r\n\treturn s;\r\n}\r\n\r\nvoid dfs(int x){\r\n\tdep[x]=dep[fa[x]]+1;\t//x\u8282\u70b9\u7684\u6df1\u5ea6\u662fx\u7684\u7236\u4eb2+1\r\n\tif(dep[x]>=maxd)\tmaxd=dep[x],maxi=x;\t\t//\u627e\u6700\u5927\u6df1\u5ea6\u548c\u5b83\u7684\u7f16\u53f7\uff08\u52a0\u4e0d\u52a0=\u90fd\u884c\uff09\r\n\tfor(int i=h[x];i;i=e[i].nx){\r\n\t\tdfs(e[i].to);\t//dfs\u513f\u5b50\r\n\t\tm2xk[x]=max(m2xk[x],maxk[e[i].to]+1);\t//\u5982\u679c\u73b0\u5728\u5b50\u6811\u6bd4\u6b21\u957f\u5b50\u6811\u957f\uff0c\u6b21\u957f\u5b50\u6811\u53d8\u4e3a\u73b0\u5728\u5b50\u6811\u3002\r\n\t\tif(m2xk[x]>maxk[x])\tswap(m2xk[x],maxk[x]);\t//\u5982\u679c\u6b21\u957f\u5b50\u6811\u6bd4\u6700\u957f\u5b50\u6811\u957f\u4e86\uff0c\u4ea4\u6362\u3002\u7ecf\u8fc7\u8fd9\u4e24\u6b65\u5c31\u53ef\u4ee5\u6c42\u51fa\u6b21\u957f\u5b50\u6811\u7684\u6700\u957f\u5b50\u6811\u7684\u957f\u5ea6\u4e86\r\n\t}\r\n}\r\n\r\nvoid find(int x){\t//\u627e\u6700\u957f\u94fe\r\n\tlian[dep[x]]=x;\r\n\tif(fa[x])\tfind(fa[x]);\r\n}\r\n\r\nint main(){\r\n\tn=read();m=read();\r\n\trep(i,1,n){\r\n\t\tfa[i]=read();\r\n\t\tadd(fa[i],i);\t//\u5efa\u4ece\u7236\u4eb2\u5230\u513f\u5b50\u7684\u8fb9\r\n\t}\r\n\tdfs(1);\t//\u4ece\u6839\u5f00\u59cbdfs\r\n\tfind(maxi);\t//\u4ece\u6700\u6df1\u70b9\u627e\u6700\u957f\u94fe\r\n\trep(i,1,maxd){\r\n\t\twhile(cnt+m2xk[lian[cnt]]<i)\tcnt++;\t//\u4ece\u94fe\u7684\u6700\u9876\u7aef\u5f00\u59cb\u5f80\u4e0b\uff0c\u5982\u679c\u5f53\u524d\u70b9\u7684\u6df1\u5ea6+\u6b21\u957f\u5b50\u6811\u7684\u957f\u5ea6\u4e0d\u80fd\u5230\u8fbei\u8fd9\u4e2a\u6df1\u5ea6\uff0c\u8bf4\u660e\u7b2ci\u5c42\u7684LCA\u5728\u5b83\u7684\u6700\u957f\u5b50\u6811\u4e0a\uff0c\u90a3\u4e48\u5230\u94fe\u7684\u4e0b\u4e00\u4e2a\u70b9\r\n\t\tans[i]=lian[cnt];\t//\u80fd\u5230\u8fbe\u7b54\u6848\u5c31\u662f\u8fd9\u4e2a\u70b9\r\n\t}\r\n\trep(i,1,m){\r\n\t\tq=read();\r\n\t\tprintf(\"%d\\n\",ans[q]);\r\n\t}\r\n\treturn 0;\r\n}\r\n```\r\n\r\n\u4e0d\u96be\u770b\u51fa\uff0c\u590d\u6742\u5ea6$O(N+N+K+2K+M)$($K$\u662f\u6700\u5927\u6df1\u5ea6)\u3002\r\n\r\n## \u6ce8\u610f\uff1a\r\n\r\n1.\u4e0d\u8981\u8bfb\u5165\u65f6\u8ba1\u7b97$dep$\uff0c\u7236\u4eb2\u7f16\u53f7\u53ef\u80fd\u5927\u4e8e\u8be5\u70b9\u7f16\u53f7\u3002\r\n\r\n2.\u4e0d\u8981\u7528$vector$\u5b58\u56fe\uff01\uff01\uff01\uff01\uff01\u65f6\u7a7a\u88ab\u5361\u4e86\u597d\u4e45\uff0c\u6539\u7528\u94fe\u5f0f\u524d\u5411\u661f\u77ac\u95f4\u8fc7\u3002\r\n\r\n\uff08$vector$\u662f\u4eba\u7c7b\u53d1\u660e\u7684\u6700\u65e0\u7528\u7684STL\u3002\u2014\u2014\u3007\u4f6c\uff09\r\n\r\n\uff08\u5176\u5b9e\u8fd8\u662f\u6709\u90a3\u4e48\u4e00\u70b9\u70b9\u7528\u7684kk\uff09",
        "postTime": 1606458957,
        "uid": 181181,
        "name": "NH3_H2O",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "# P7103 \u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\n\n[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P7103)\n\nPS: \u6253\u6bd4\u8d5b\u7684\u65f6\u5019\u8fc7\u4e86\u8fd9\u9053\u9898\uff0c\u540e\u6765\u5e94\u8be5\u662f\u6570\u636e\u52a0\u5f3a\u4e86\uff0c\u957f\u5256\u88ab\u5361\u4e86\uff0cT\u4e86\uff0c~~(\u5927\u96fe)~~\uff0c\u7136\u540e\u6211\u7075\u673a\u4e00\u52a8\uff0c\u60f3\u5230\u4e86\u4f18\u5316\uff0c\u7136\u540e\u6210\u529f\u8fc7\u6389\u4e86\uff0c\u7136\u540e\u6570\u636e\u52a0\u5f3a\u5230 5e6 \u53c8\u88ab\u5361\u4e86\uff0c\u5361\u4e86\u4e00\u5929\u7ec8\u4e8e\u60f3\u5230\u529e\u6cd5\u4e86\uff0c\u4e8e\u662f\u5199\u4e00\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\u3002\n\n\u9996\u5148\u6839\u636e\u9898\u4e2d\u7684\u610f\u601d\uff0c\u5c31\u662f\u8981\u6c42\u56fe\u4e2d\u5404\u4e2a\u6df1\u5ea6\u7684 $ LCA$ \uff0c$ LCA $\u4e00\u822c\u7528\u6811\u5256\uff08\u4e00\u822c\u662f\u91cd\u94fe\u5256\u5206\uff09\u548c\u500d\u589e $ LCA $ \u6765\u6c42\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff0c\u9996\u5148\u4f1a\u6811\u5256 $ LCA $ \u7684\u90fd\u4f1a\u77e5\u9053\u4e00\u4e2a\u6027\u8d28 \n> \u4e00\u4e2a\u70b9\u4e0e\u6811\u4e0a\u4efb\u610f\u5e97\u7684LCA\u4e00\u5b9a\u5728\u8fd9\u4e2a\u70b9\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u4e0a\uff08\u5305\u62ec\u8fd9\u4e2a\u70b9\u548c\u6839\u8282\u70b9\uff09\n\n\u65e2\u7136\u5982\u6b64\uff0c\u6839\u636e\u8fd9\u6761\u6027\u8d28\uff0c\u6211\u4eec\u53d1\u73b0\u6700\u7ec8\u6240\u6709\u6df1\u5ea6\u7684 $ LCA $ \u5fc5\u5b9a\u5728\u8fd9\u6761\u6700\u957f\u7684\u94fe\u4e0a\uff0c\u9053\u7406\u5f88\u7b80\u5355\uff0c\u901a\u8fc7\u67d3\u8272\u6cd5\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6c42\u4e24\u4e2a\u70b9\u7684 $ LCA $ \u5c31\u662f\u662f\u8fd9\u4e2a\u70b9\u5230\u6839\u8def\u5f84\u7684\u91cd\u5408\u90e8\u5206\u7684\u6df1\u5ea6\u6700\u5927\u503c\u7684\u70b9\uff0c\u62d3\u5c55\u4e00\u4e0b\uff0c\u591a\u4e2a\u70b9\u7684 $ LCA $ \u5c31\u662f\u6c42\u591a\u4e2a\u70b9\u5230\u6839\u8282\u70b9\u8def\u5f84\u91cd\u5408\u90e8\u5206\u7684\u6df1\u5ea6\u6700\u5927\u503c\u7684\u70b9\uff0c\u53c8\u56e0\u4e3a\u6700\u957f\u94fe\u4e0a\u5fc5\u5b9a\u4f1a\u51fa\u73b0\u6240\u6709\u6df1\u5ea6\u7684\u70b9\uff0c\u6240\u4ee5\u7b54\u6848\u5c31\u5fc5\u5b9a\u5728\u6700\u957f\u94fe\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u60f3\u5230\u76f4\u63a5\u957f\u94fe\u5256\u5206\uff0c\u66b4\u529b\u5411\u6700\u957f\u94fe\u8df3\uff0c\u8df3\u5230\u6700\u957f\u94fe\u540e\u66f4\u65b0\u8fd9\u4e2a\u6df1\u5ea6\u7684\u7b54\u6848\uff0c\u6570\u636e\u52a0\u5f3a\u524d\u5e94\u8be5\u53ef\u62ff60\u5206\n\n$Code$\n```cpp\nregister int k;\nfor(register int i=1;i<=n;++i){\n\tk=i;\n\twhile(top[k]!=1)k=f[top[k]];\n\tif(dep[k]<dep[ans[dep[i]]])ans[dep[i]]=k;\n}\n```\n\u590d\u6742\u5ea6\u6211\u4e0d\u4f1a\u592a\u5206\u6790\uff0c\u5927\u6982\u662f\u4e5f\u662f $ O(nlogn)  $ \u5427\u3002\u53cd\u6b63 $ O(\u8fc7\u4e0d\u4e86\uff0c\u4f1a\u88ab\u5361) $ \u5c31\u5b8c\u4e86\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7b2c\u4e8c\u904d DFS \u7684\u65f6\u5019\u66f4\u65b0\u8fd9\u4e2a\u70b9\u5230\u6700\u957f\u94fe\u7b2c\u4e00\u4e2a\u70b9\uff0c\u7528 $ f $ \u6570\u7ec4\u4fdd\u5b58\uff0c\u53ef\u77e5\uff0c\u6700\u957f\u94fe\u4e0a\u7684\u70b9 $ f $ \u4e3a\u81ea\u8eab\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3 $ f $ \u503c\u5c31\u662f $ f[ \\ top \\ ] $\n```cpp\n#define v edge[i].to\nvoid dfs(register int u,register int fa){\n\tddep[u]=dep[u]=dep[fa]+1;//ddep\u6570\u7ec4\u8868\u793a\u80fd\u591f\u5230\u8fbe\u7684\u6700\u5927\u6df1\u5ea6\n\tfor(register int i=head[u];i;i=edge[i].next){\n\t\tif(dep[v])continue;\n\t\tdfs(v,u);\n\t\tif(ddep[v]>ddep[u])ddep[u]=ddep[v],son[u]=v;\n\t}\n}\n\nvoid DFS(register int u,register int fa,register bool ff){//ff\u8868\u793a\u662f\u5426\u662f\u5728\u6700\u957f\u94fe\u4e0a\n\ttop[u]=fa;vs[u]=1;\n\tif(son[u])DFS(son[u],fa,ff);\n\tif(!ff)f[u]=f[fa];\n\tfor(register int i=head[u];i;i=edge[i].next){\n\t\tif(vs[v])continue;\n\t\tDFS(v,f[u],0);\n\t}\n}\n#undef v\n```\n\u6700\u540e\u66f4\u65b0\u7b54\u6848\u5c31\u662f $ O(n) $ \uff0c\u4f46\u662f\u4e27\u5fc3\u75c5\u72c2\u7684\u51fa\u9898\u4eba\u628a\u6570\u636e\u52a0\u5f3a\u5230 5e6 \uff0c\u5bfc\u81f4\u4e00\u904dDFS\u7684\u65f6\u95f4\u53d8\u6210\u4e86\u5927\u7ea6 0.8 \u79d2\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6811\u5256\u7684\u4e24\u904d DFS \u4f1a\u76f4\u63a5 T \u6389\uff0c\u800c DFS1 \u662f\u57fa\u672c\u4e0d\u53ef\u51cf\u679d\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u5728 DFS2 \u51cf\u679d\uff0c\u6211\u4eec\u53d1\u73b0\u5728 DFS2 \u4e2d\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u904d\u5386\u6240\u6709\u7684\u70b9\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u904d\u5386\u6700\u957f\u94fe\u4e0a\u7684\u70b9\uff0c\u5bf9\u4e8e\u4e0d\u662f\u6700\u957f\u94fe\u4e0a\u7684\u70b9\uff0c\u6211\u4eec\u53ea\u5173\u5fc3\u4ed6\u5bf9\u5e94\u7684\u6700\u957f\u94fe\u4e0a\u7684\u7b2c\u4e00\u4e2a\u70b9\u662f\u8c01\uff0c\u6240\u4ee5\u6211\u4eec\u6bcf\u6b21\u4ece\u6700\u957f\u94fe\u4e0a\u7684\u70b9 u \u904d\u5386\u5230\u4e0d\u662f\u6700\u957f\u94fe\u7684\u70b9 v \u65f6\uff0c\u53ea\u9700\u8981\u8bb0\u5f55 u \uff0c\u7136\u540e\u66f4\u65b0 dep[v] \u5230 v \u6240\u5728\u7684\u94fe\u80fd\u591f\u5230\u8fbe\u7684\u6700\u5927\u6df1\u5ea6\u7684\u7b54\u6848\u662f\u8c01\u5373\u53ef\uff0c\u7edf\u8ba1\u5b8c\u4e4b\u540e\u76f4\u63a5 return \u3002\u65f6\u95f4\u6548\u7387\u4f18\u5316\u4e86\u8bb8\u591a\u3002\u4e0a\u6b21\u521a\u51fa\u73b0\u7684 $ f $ \u6570\u7ec4\u53ef\u4ee5\u5149\u8363\u9000\u5f79\u4e86\u3002\u7531\u4e8e\u662f\u5728 DFS2 \u76f4\u63a5\u66f4\u65b0\u7b54\u6848\uff0c\u4e8e\u662f\u6211\u4eec\u7684 top \u6570\u7ec4\u4e5f\u53ef\u4ee5\u5149\u8363\u9000\u5f79\u4e86 ~~\uff08\u6ca1\u6709 top \u6570\u7ec4\u7684\u6811\u5256\u8fd8\u80fd\u53eb\u6811\u5256\u5417\uff09~~ \u3002\u6700\u5927\u7684\u70b9\u8dd1\u4e860.7\u79d2\u5de6\u53f3\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u6211\u7684\u4ee3\u7801\u5438\u6c27\u4e4b\u540e\u53d8\u6162\u4e86 3ms \u6211\u4e5f\u8bf4\u4e0d\u660e\u767d\uff0c~~(\u5927\u6982\u662f\u5361\u5e38\u5361\u592a\u6b7b\u4e86)~~\u8fd9\u9053\u9898\u6700\u597d\u7528\u5feb\u8f93\uff0c 5e6 \u7684\u8f93\u51fa\u611f\u89c9 printf \u6709\u70b9\u5403\u529b\n\n\u4fee\u6539\u540e\u7684 DFS2 \n```cpp\nvoid DFS(register int u,register int fa,register bool ff){\n\tif(!ff){\n\t\tfor(int i=dep[u];i<=ddep[u];++i)\n\t\t\tif(dep[fa]<dep[ans[i]])ans[i]=fa;\n\t\treturn;\n\t}else if(dep[fa]<dep[ans[dep[u]]])ans[dep[u]]=fa;\n\tfor(register int i=head[u];i;i=edge[i].next){\n\t\tif(v==son[u]&&ff)DFS(v,v,1);\n\t\telse DFS(v,fa,0);\n\t}\n}\n```\n\n\u4e0b\u9762\u5949\u4e0a\u5b8c\u6574 $ Code $\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define gc() (p1 == p2 ? (p2 = buf + fread(p1 = buf, 1, 1 << 20, stdin), p1 == p2 ? EOF : *p1++) : *p1++)\n#define read() ({ register int x = 0, f = 1; register char c = gc(); while(c < '0' || c > '9') { if (c == '-') f = -1; c = gc();} while(c >= '0' && c <= '9') x = x * 10 + (c & 15), c = gc(); f * x; })\nchar buf[1 << 20], *p1, *p2;\n\nconst int maxn=5e6+10;\nstruct node{\n\tint to,next;\n}edge[maxn];\nint head[maxn],dep[maxn],ans[maxn],ddep[maxn],son[maxn];\n\nvoid print(register int x){\n\tif(x>=10)print(x/10);\n\tputchar(x%10+'0');\n}\n\ninline void add(register int x,register int y,register int z){\n\tedge[z]=(buyaochao){y,head[x]};\n\thead[x]=z;\n}\n\n#define v edge[i].to\nvoid dfs(register int u,register int fa){\n\tdep[u]=dep[fa]+1;\n\tfor(register int i=head[u];i;i=edge[i].next){\n\t\tdfs(v,u);\n\t\tif(ddep[v]>ddep[u])ddep[u]=ddep[v],son[u]=v;\n\t}\n\tif(!ddep[u])ddep[u]=dep[u];\n}\n\nvoid DFS(register int u,register int fa,register bool ff){\n\tif(!ff){\n\t\tfor(int i=dep[u];i<=ddep[u];++i)\n\t\t\tif(dep[fa]<dep[ans[i]])ans[i]=fa;\n\t\treturn;\n\t}else if(dep[fa]<dep[ans[dep[u]]])ans[dep[u]]=fa;\n\tfor(register int i=head[u];i;i=edge[i].next){\n\t\tif(v==son[u]&&ff)DFS(v,v,1);\n\t\telse DFS(v,fa,0);\n\t}\n}\n#undef v\n\nint main(){\n\tregister int n=read(),m=read();\n\tfor(register int i=1;i<=n;++i){\n\t\tadd(read(),i,i);\n\t}dep[0]=0x3f3f3f3f;\n\tdfs(1,1);DFS(1,1,1);\n\tfor(register int i=1;i<=m;++i)\n\t\tprint(ans[read()]),putchar('\\n');\n\treturn 0;\n}\n```\n\u795d\u5927\u5bb6 noip  rp++",
        "postTime": 1606343295,
        "uid": 335214,
        "name": "\u8363\u8000\u5357\u51a5",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "$$\\text{\u524d\u8a00}$$\n\n$\\quad$~~\u6bd2\u7624\u51fa\u9898\u4eba\u9020\u7684\u4ec0\u4e48\u9b3c\u6570\u636e\uff0c\u786c\u751f\u751f\u53d8\u6210\u4e00\u9053\u5361\u5e38\u9898\uff0c\u6211\u8db3\u8db3\u4ea4\u4e86\u4e00\u9875\u624d\u8fc7\u7684\u3002~~\n\n$$\\text{\u5173\u4e8e\u6b64\u9898}$$\n\n$\\quad$\u5148\u8bf4\u8bf4 $80$ \u5206\u505a\u6cd5\uff0c\u5c31\u662f\u6570\u636e\u52a0\u5f3a\u524d $100$ \u5206\u505a\u6cd5\uff0c\u73b0\u5728\u88ab\u5361\u4e86\uff0c\u4f1aT\u6700\u540e\u4e00\u4e2a\u70b9\u3002\n\n$\\quad$\u5c31\u662f\u7b80\u5355\u7684\u6811\u5256\u6c42LCA\uff0c\u5728\u624b\u63a8\u6837\u4f8b\u4e2d\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e\u540c\u4e00\u6df1\u5ea6\u7684\u70b9\u7684LCA\u5c31\u662f\u8fd9\u4e00\u5c42\u6df1\u5ea6\u4e2d\u6700\u5de6\u548c\u6700\u53f3\u7684\u70b9\u7684LCA\uff0c\u5373\u540c\u4e00\u6df1\u5ea6\u4e2ddfs\u5e8f\u6700\u5c0f\u7684\u548c\u6700\u5927\u7684\u70b9\u7684LCA\uff0c\u8fd9\u4e2a\u6027\u8d28\u4e00\u53d1\u73b0\u5c31\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u7b54\u6848\u4e86\u3002\n\n$\\quad$\u56e0\u4e3a\u662f\u9519\u89e3\uff0c\u6240\u4ee5\u53ea\u5c55\u793a\u90e8\u5206\u4ee3\u7801\u3002(\u636e\u8bf4\u673a\u623f $dalao$ [@slzs](https://www.luogu.com.cn/user/109212) \u7528\u6811\u5256 $+$ fast io\u5361\u8fc7\u4e86)\n```cpp\n\nil void dfs1(int x,int fa)\n{\n  dep[x]=dep[fa]+1;size[x]=1;\n  if(!ans[dep[x]][0])ans[dep[x]][0]=x;//\u8bb0\u5f55\u6700\u5148\u641c\u5230\u7684\u70b9\uff0cdfs\u5e8f\u6700\u5c0f\n  else ans[dep[x]][1]=x;//\u8bb0\u5f55\u6700\u540e\u641c\u5230\u7684\u70b9\uff0cdfs\u5e8f\u6700\u5927\n  for(re i=head[x],y;i,y=go[i];i=next[i])\n    {\n      dfs1(y,x);size[x]+=size[y];\n      if(size[y]>size[son[x]])son[x]=y;\n    }\n}\nil void dfs2(int x,int topf)\n{\n  top[x]=topf;\n  if(!son[x])return;\n  dfs2(son[x],topf);\n  for(re i=head[x],y;i,y=go[i];i=next[i])\n    {\n      if(y==son[x])continue;\n      dfs2(y,y);\n    }\n}\nil int LCA(int x,int y)\n{\n  int fx=top[x],fy=top[y];\n  while(fx!=fy)\n    {\n      if(dep[fx]<dep[fy])y=father[fy],fy=top[y];\n      else x=father[fx],fx=top[x];\n    }if(dep[x]>dep[y])return y;\n  return x;\n}\nsigned main()\n{\n  n=read();m=read();\n  for(re i=1,x;i<=n;i++){x=read();if(i>1)father[i]=x,Add(x,i);}\n  dfs1(1,0);dfs2(1,1);\n  for(re i=1,x;i<=m;i++)\n    {\n      x=read();\n      if(!ans[x][1])print(ans[x][0]);\n      else print(LCA(ans[x][0],ans[x][1]));putchar('\\n');}\n  return 0;\n}\n```\n\n$\\quad$\u73b0\u5728\u518d\u6765\u8bf4\u8bf4\u6b63\u89e3\u3002\n\n$\\quad$\u5728 [@lyyi2003](https://www.luogu.com.cn/user/100806#practice) $dalao$ \u7684\u63d0\u793a\u4e0b\uff0c\u6211\u53c8\u53d1\u73b0\u4e86\u7b54\u6848\u7684\u4e00\u4e2a\u6027\u8d28\uff0c\u6240\u6709\u7b54\u6848(\u5c31\u662f\u5404\u4e2a\u6df1\u5ea6\u7684\u70b9\u7684\u516c\u5171LCA)\u5728\u4e00\u6761\u94fe\u4e0a\uff0c\u56e0\u4e3a\u6df1\u5ea6\u5927\u7684\u70b9\u662f\u7531\u6df1\u5ea6\u5c0f\u7684\u70b9\u6269\u5c55\u5f97\u5230\u7684(\u663e\u7136\uff0c\u4e0b\u9762\u7684\u70b9\u662f\u7531\u4e0a\u9762\u7684\u70b9\u6269\u5c55\u800c\u6765\u7684)\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e24\u4e2a\u4e0d\u540c\u7684\u6df1\u5ea6 $i,j$ \uff0c\u6ee1\u8db3 $i<j$\uff0c\u53ef\u4ee5\u53d1\u73b0\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u7684\u516c\u5171LCA\u4e00\u5b9a\u662f\u6df1\u5ea6\u4e3a $j$ \u7684\u70b9\u7684\u516c\u5171LCA\u3002\n\n$\\quad$\u53d1\u73b0\u8fd9\u4e2a\u6027\u8d28\u540e\u5c31\u5f88\u597d\u505a\u4e86\uff0c\u53ea\u9700\u8981\u627e\u5230\u8fd9\u6761\u94fe\u5373\u53ef\uff0c\u4e0d\u7528\u7279\u610f\u627e\uff0c\u4ece\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u5faa\u73af\u4e0a\u6765\u5373\u53ef\uff0c\u6bcf\u6b21\u5224\u65ad\u8fd9\u4e2a\u70b9\u7684\u5b50\u6811\u4e2d\u662f\u5426\u5305\u542b\u6240\u6709\u540c\u4e00\u6df1\u5ea6\u7684\u70b9\uff0c\u770b\u4ee3\u7801\u66f4\u597d\u7406\u89e3\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n#define re register int\n#define il inline\n#define next nee\nil int read()\n{\n  int x=0,f=1;char ch=getchar();\n  while(!isdigit(ch)&&ch!='-')ch=getchar();\n  if(ch=='-')f=-1,ch=getchar();\n  while(isdigit(ch))x=(x<<1)+(x<<3)+ch-'0',ch=getchar();\n  return x*f;\n}\nil void print(int x)\n{\n  if(x<0)putchar('-'),x=-x;\n  if(x/10)print(x/10);\n  putchar(x%10+'0');\n}\nconst int N=5e6+5;\nint n,m,ans[N],dep[N],seg[N],size[N],f[N][2],next[N],go[N],father[N],head[N],tot,Maxdep;\nil void Add(int x,int y)\n{\n  next[++tot]=head[x];\n  head[x]=tot;go[tot]=y;\n}\nil void dfs(int x,int fa)\n{\n  dep[x]=dep[fa]+1;size[x]=1;seg[x]=++seg[0];\n  if(dep[x]>Maxdep)Maxdep=dep[x],f[dep[x]][0]=f[dep[x]][1]=x;//\u8bb0\u5f55\u6700\u5148\u641c\u5230\u7684\u70b9\uff0cdfs\u5e8f\u6700\u5c0f\n  else f[dep[x]][1]=x;//\u8bb0\u5f55\u6700\u540e\u641c\u5230\u7684\u70b9\uff0cdfs\u5e8f\u6700\u5927\n  for(re i=head[x],y;i,y=go[i];i=next[i])\n    {\n      dfs(y,x);size[x]+=size[y];\n    }\n}\nil bool check(int x,int y)//\u5224\u65adx\u662f\u5426\u5728y\u7684\u5b50\u6811\u4e2d\n{return seg[x]>=seg[y]&&seg[x]<=seg[y]+size[y]-1;}\nsigned main()\n{\n  n=read();m=read();\n  for(re i=1,x;i<=n;i++){x=read();if(x)Add(x,i),father[i]=x;}\n  dfs(1,0);\n  int cte=f[Maxdep][0];\n  for(re i=Maxdep;i>=1;i--)//\u7edf\u8ba1\u7b54\u6848\n    {\n      while(!check(f[i][0],cte)||!check(f[i][1],cte))cte=father[cte];//\u5411\u4e0a\u8df3\u76f4\u5230\u4e00\u4e2a\u70b9\u5c06\u6df1\u5ea6\u4e3ai\u7684\u6240\u6709\u70b9\u5305\u542b\n      ans[i]=cte;\n    }\n  for(re i=1,x;i<=m;i++)\n    {x=read();print(ans[x]);putchar('\\n');}\n  return 0;\n}\n\n```\n$\\quad$\u6700\u540e\u5982\u679c\u8fd8\u662f\u5361\u4e0d\u8fc7\u53bb\uff0c\u63a8\u8350\u4f7f\u7528[\u9ad8\u7ea7\u5feb\u8bfb(fast io)](https://www.luogu.com.cn/paste/efcyocpd)\uff0c\u53ef\u4ee5\u8ba9\u4f60\u4eec\u7684\u901f\u5ea6\u66f4\u4e0a\u4e00\u5c42\u697c(700ms+\u53d8\u6210500ms+)\u3002",
        "postTime": 1606286056,
        "uid": 109220,
        "name": "Farkas_W",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u957f\u5256\u505a\u6cd5\u3002\n\n\u957f\u5256\u53ef\u4ee5\u5feb\u901f\u7ef4\u62a4\u51fa\u4e00\u4e2a\u70b9\u5b50\u6811\u7684\u6df1\u5ea6\u4fe1\u606f\u3002\n\n\u8fd9\u4e2a\u9898\u5f88\u663e\u7136\uff0c\n\n\u5148\u4e00\u6b21\u8bb0\u5f55\u4e0b\u6bcf\u4e2a\u6df1\u5ea6\u6709\u591a\u5c11\u4e2a\u70b9\u3002\n\n\u53ea\u8981\u5728\u5408\u5e76\u8f7b\u513f\u5b50\u7684\u65f6\u5019\u5224\u65ad\u8fd9\u4e2a\u6df1\u5ea6\u7684\u70b9\u6709\u6ca1\u6709\u5168\u5728\u8fd9\u68f5\u5b50\u6811\u91cc\u3002\n\n```cpp\n#include <stdio.h>\n#include <string.h>\n#define odl(x) printf(\"%d\\n\",x)\ninline int read()\n{\n\tint num=0,f=1;char c=getchar();\n\twhile(c<48||c>57){if(c=='-')f=-1;c=getchar();}\n\twhile(c>47&&c<58)num=num*10+(c^48),c=getchar();\n\treturn num*f;\n}\nstruct Edge{\n\tint v,nxt;\n}e[10000005];\nint h[10000005],cnt=1;\ninline void addedge(int u,int v)\n{\n\te[cnt]=(Edge){v,h[u]};\n\th[u]=cnt++;\n}\nint buf[10000005],ans[10000005],dep[10000005],son[10000005],Q[10000005];\nint *f[10000005],*g[10000005],*now=buf;\nvoid dfs(int u,int fa=0,int s=1)\n{\n\tfor(int i=h[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v==fa)continue;\n\t\tdfs(v,u,s+1);\n\t\tif(dep[v]>dep[son[u]])son[u]=v;\n\t}\n\tdep[u]=dep[son[u]]+1;\n\tQ[s]++;\n}\nvoid dfs2(int u,int fa=0,int s=1)\n{\n    f[u][0]=1;\n    if(Q[s]==1)ans[s]=u;\n    if(son[u])\n    {\n        f[son[u]]=f[u]+1;\n        dfs2(son[u],u,s+1);\n    }\n    for(int i=h[u];i;i=e[i].nxt)\n    {\n        int v=e[i].v;\n        if (v==son[u]||v==fa)continue;\n        f[v]=now;now+=dep[v];\n        dfs2(v,u,s+1);\n        for (int i=1;i<=dep[v];i++)\n        {\n            f[u][i]+=f[v][i-1];\n            if(f[u][i]==Q[s+i])ans[s+i]=u;\n        }\n    }\n}\nsigned main()\n{\n\tint n=read(),m=read();\n\tfor(int i=1;i<=n;i++){int x=read();addedge(x,i);}\n\tdfs(1);f[1]=now,now+=dep[1];\n\tdfs2(1);\n\tfor(int i=1;i<=m;i++)odl(ans[read()]);\n\treturn 0;\n}\n```",
        "postTime": 1630499429,
        "uid": 171487,
        "name": "cmll02",
        "ccfLevel": 8,
        "title": "awawa"
    },
    {
        "content": "\u8fd9\u4e2a\u6df1\u5ea6\u4e3a $k$ \u7684\u6240\u6709\u70b9\u7684 $\\text{LCA}$\uff0c\u4e8b\u5b9e\u4e0a\u662f\u6c42\u4e00\u4e2a\u6df1\u5ea6\u6700\u5c0f\u7684\u70b9\u5305\u542b\u6240\u6709\u6df1\u5ea6\u4e3a $k$ \u7684\u70b9\u3002\u53ef\u4ee5\u60f3\u5230\u7528\u6876\uff1f\u4f46\u662f\u6876\u5fc5\u987b\u66b4\u529b\u904d\u5386\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\u3002\u8003\u8651\u6362\u4e00\u79cd\u65b9\u6cd5\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6709\u6027\u8d28\uff1a\u82e5\u70b9 $x$ \u662f\u6df1\u5ea6\u4e3a $i$ \u7684\u6240\u6709\u70b9\u7684 $\\text{LCA}$\uff0c\u5219\u5b83\u5fc5\u7136\u4e5f\u662f\u6df1\u5ea6\u4e3a $j$ \u7684\u6240\u6709\u70b9\u7684 $\\text{LCA}$\uff0c\u5176\u4e2d $i<j$\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b54\u6848\u5206\u5e03\u5728\u4e00\u6761\u94fe\u4e0a\uff0c\u94fe\u7684\u4e00\u4e2a\u7aef\u70b9\u662f\u67d0\u4e2a\u6df1\u5ea6\u6700\u5927\u7684\u70b9\uff0c\u53e6\u4e00\u4e2a\u70b9\u662f\u6839\u8282\u70b9 $1$\u3002\u4ece\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u5f00\u59cb\u5411\u4e0a\u8df3\u5230\u6839\u8282\u70b9 $1$\uff0c\u5224\u65ad\u5f53\u524d\u70b9 $x$ \u7684\u5b50\u6811\u662f\u5426\u5305\u542b\u6240\u6709\u6df1\u5ea6\u4e3a $d$ \u7684\u70b9\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u5bf9\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u5206\u6790\u540c $\\text{two-pointer}$\u3002\u800c\u5224\u65ad\u4e00\u4e2a\u70b9 $y$ \u662f\u5426\u5728\u5b50\u6811 $x$ \u5185\uff0c\u4f7f\u7528 $\\text{dfs}$ \u5e8f\u5373\u53ef\u3002\n\n```cpp\n#include<cstdio>\nint mx=0,num=0,cnt=0;\nint h[5000005],to[5000005],ver[5000005];\nint dfn[5000005],pos1[5000005],pos2[5000005],dep[5000005],res[5000005],fa[5000005],size[5000005];\ninline int read() {\n\tregister int x=0,f=1;register char s=getchar();\n\twhile(s>'9'||s<'0') {if(s=='-') f=-1;s=getchar();}\n\twhile(s>='0'&&s<='9') {x=x*10+s-'0';s=getchar();}\n\treturn x*f;\n}\ninline void add(int x,int y) {to[++cnt]=y;ver[cnt]=h[x];h[x]=cnt;}\ninline void dfs(int x) {\n\tdfn[x]=++num; size[x]=1;\n\tif(mx<dep[x]) {mx=dep[x];}\n\tif(!pos1[dep[x]]) pos1[dep[x]]=x;\n\telse pos2[dep[x]]=x;\n\tfor(register int i=h[x];i;i=ver[i]) {\n\t\tint y=to[i]; \n\t\tdep[y]=dep[x]+1; \n\t\tdfs(y); size[x]+=size[y];\n\t}\n}\nint main() {\n\tint n=read(),Q=read();\n\tfor(register int i=1;i<=n;++i) {fa[i]=read(); add(fa[i],i);} \n\tdep[1]=1; dfs(1); int cur=(pos2[mx]? pos2[mx]:pos1[mx]);\n\tfor(register int d=mx;d>=1;--d) {\n\t\tint x=pos1[d],y=pos2[d];\n\t\twhile(!(dfn[cur]<=dfn[x]&&dfn[x]<=dfn[cur]+size[cur]-1)||!((!y)||(dfn[cur]<=dfn[y]&&dfn[y]<=dfn[cur]+size[cur]-1))) cur=fa[cur];\n\t\tres[d]=cur;\n\t}\n\twhile(Q--) {int x=read(); printf(\"%d\\n\",res[x]);}\n\treturn 0;\n}\n```",
        "postTime": 1606733579,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P7103)\n\nupd:\u7ee7\u7eed\u5b8c\u5584\u4e86\u4e0b\u9898\u89e3\uff0c\u6539\u4e86\u683c\u5f0f\uff0c\u5e0c\u671b\u8fd9\u6b21\u80fd\u8fc7\u3002\n\n\u611f\u8c22\u51fa\u9898\u4eba\u7ed9\u6211\u4eec\u51fa\u4e86\u4e00\u9053\u5361\u65f6\u95f4\u597d\u9898\uff0c\u8ba9\u6211\u5728\u8fd9\u9898\u4e0a\u611f\u53d7\u5230\u4e86\u575a\u6301\u4e0d\u61c8\u7684\u7cbe\u795e\n\n\u7ed9\u5927\u5bb6\u770b\u770b\uff0c\u51fa\u9898\u4eba\u6240\u884c\u7684\u5584\u4e8b\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dtuicvhm.png)\n\n[\u5173\u4e8e\u5982\u4f55\u8ba9\u51fa\u9898\u4eba\u7518\u5fc3](https://www.luogu.com.cn/record/42531508)\n\n# Solve 1\n\n\u5f53\u4f60\u8f9b\u8f9b\u82e6\u82e6\u53d1\u73b0\u67d0\u6761\u6027\u8d28\u2014\u2014\n\n\u7b2c $k$ \u5c42 dfn \u6700\u5c0f\u4e0e dfn \u6700\u5927\u7684\u4e24\u70b9\u7684 lca \u5373\u4e3a\u7b54\u6848\uff08\u663e\u7136\u8fd9\u4e2a lca \u53ef\u5c06\u7b2c $k$ \u5c42 dfn \u503c\u5904\u4e8e\u4e2d\u95f4\u6c34\u5e73\u7684\u90a3\u4e9b\u70b9\u56ca\u62ec\u8fdb\u5b50\u6811\uff0c\u4e14\"\u6700\u8fd1\"\u4e5f\u662f\u663e\u7136\u7684\uff09\n\n\u7136\u540e\u6fc0\u52a8\u5730**\u8c03**\u51fa\u4e86\u6811\u5256\n\n\u5982\u4e0b\n\n## code\n\n```cpp\n#include<vector>\n#include<cstdio>\nusing namespace std;\ninline int read() {\n    int num=0;\n    char c=getchar();\n    while(c<'0' || c>'9')c=getchar();\n    while(c>='0' && c<='9') {\n        num=(num<<3)+(num<<1)+c-'0';\n        c=getchar();\n    }\n    return num;\n}\nstruct Edge{\n\tint to,nxt;\n}e[5000005];\nint n,m,head[5000005],cnt,siz[5000005],fa[5000005],top[5000005],son[5000005],dep[2][5000005],dpth[5000005];\ninline void insert( int u,int v) {\n\te[++cnt].to=v;\n\te[cnt].nxt=head[u];\n\thead[u]=cnt;\n}\ninline void dfs (int u,int depth ) {\n\t//dep[0][depth]\u5b58\u50a8\u5f53\u524d\u5c42dfn\u6700\u5c0f\u7684\u70b9\uff0cdep[1][depth]\u4e0e\u4e4b\u76f8\u53cd\n\tif(!dep[0][depth])dep[0][depth]=u;\n\tdep[1][depth]=u;\n    dpth[u]=depth;\n\tint mx=-1,mxs;\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tdfs(e[i].to,depth+1);\n\t\tsiz[u]+=siz[e[i].to]+1;//siz\u5b58\u50a8\u5b50\u6811\u5927\u5c0f\uff0c\u4e0d\u5305\u62ec\u5f53\u524d\u8282\u70b9\n\t\tif(siz[e[i].to]>mx)mx=siz[e[i].to],mxs=e[i].to;\n\t}\n\tson[u]=mxs;\n}\nvoid dfs1(int u){\n    for(int i=head[u];i;i=e[i].nxt){\n        int v=e[i].to;\n        if(v==son[u])top[v]=top[u];\n        else top[v]=v;\n        dfs1(v);\n    }\n}\ninline int lca(int x,int y)\n{\n    if(x==y)return x;\n    while(top[x]!=top[y]){\n        if(dpth[top[x]]<dpth[top[y]])swap(x,y);\n        x=fa[top[x]];\n    }\n    return dpth[x]>dpth[y]?y:x;\n}\nint main() {\n    n=read();m=read();\n    for(int i=1;i<=n;i++) {\n        fa[i]=read();\n    \tinsert(fa[i],i);\n\t}\n\tcnt=0;\n\tdfs(1,1);\n\ttop[1]=1;\n\tdfs1(1);\n\twhile(m--) {\n\t\tint k=read();\n\t\tprintf(\"%d\\n\",lca(dep[0][k],dep[1][k]));\n\t}\n    return 0;\n}\n```\n\n\u7ed3\u679c\u53ea\u56e0\u6bd2\u7624\u51fa\u9898\u4eba\u52a0\u5f3a\u4e86\u6570\u636e\u800c\u4ee5\u5931\u8d25\u544a\u7ec8\u3002\n\n# Solve 2\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u7b54\u6848\u70b9\u5747\u5728\u4e00\u63a2\u5230\u6700\u6df1\u7684\u94fe\u4e0a\uff0c\u5982\u679c\u8fd9\u6837\u7684\u94fe\u6709\u591a\u6761\uff0c\u4e5f\u4e0d\u9700\u7ba1\u5177\u4f53\u662f\u54ea\u6761\uff0c\u56e0\u4e3a\u8fd9\u6761\u94fe\u4e0a\u70b9\u5728\u6811\u4e0a\u5404\u4e2a\u5c42\u90fd\u6709\u5206\u5e03\uff0c\u800c\u6240\u6c42\u7b2c $k$ \u5c42lca\u5fc5\u7136\u662f\u7b2c $k$ \u5c42\u70b9\u7684\u7956\u5148\uff0c\u6545\u5728\u8fd9\u6761\u94fe\u4e0a\u53d6\u7b2c $k$ \u5c42\u70b9\uff0c\u7531\u5176\u5411\u4e0a\u627e\u7956\u5148\uff0c\u518d\u7ed3\u5408Solve 1\u627e\u5230\u7684\u90a3\u4e2a\u5173\u4e8edfn\u7684\u6027\u8d28\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4e0d\u8fc7\u8fd9\u6837\u8fd8\u662f\u4e0d\u80fd\u8fc7\uff0c\u4e8e\u662f\u6211\u4eec\u8fd8\u53ef\u4ee5\u627e\u5230\u53e6\u4e00\u5c42\u6027\u8d28\u3002\n\n\u7b2c $k$ \u5c42\u7956\u5148\u6df1\u5ea6\u4e00\u5b9a\u4e0d\u5927\u4e8e\u7b2c $k+1$ \u5c42\u7956\u5148\u3002\u56e0\u4e3a\u7b2c $k$ \u5c42\u7956\u5148\u4e00\u5b9a\u662f\u7b2c $k+1$ \u5c42\u7956\u5148\uff0c\u6240\u4ee5\u7b2c $k+1$ \u5c42\u7956\u5148\u9876\u591a\u53ea\u4f1a\u79bb\u4e0b\u9762\u66f4\u8fd1\u800c\u4e0d\u4f1a\u6bd4\u7b2c $k$ \u5c42\u7956\u5148\u66f4\u9760\u4e0a\u3002\u5f53\u7136\uff0c\u8003\u8651\u7684\u662f\u7b2c $k+1$ \u5c42\u5b58\u5728\u7684\u60c5\u51b5\u3002\n\n\u901a\u8fc7\u8fd9\u6761\u6027\u8d28\uff0c\u5c31\u53ef\u4ee5\u50cfstd\u4e00\u6837\u7c7b\u4f3cdp\u6765\u505a\u4e86\u3002\u5f53\u7136\uff0c\u5bfb\u627e\u65b9\u5411\u76f8\u53cd\u3002\n\n## code\n\n```cpp\n#include<vector>\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\ninline int read() {\n    int num=0;\n    char c=getchar();\n    while(c<'0' || c>'9')c=getchar();\n    while(c>='0' && c<='9') {\n        num=(num<<3)+(num<<1)+c-'0';\n        c=getchar();\n    }\n    return num;\n}\nstruct Edge{\n\tint to,nxt;\n}e[5000005];\nint n,m,head[5000005],cnt,dfn[5000005],siz[5000005],fa[5000005],lca[5000005],mxdp,dep[2][5000005],dpth[5000005];\ninline void insert( int u,int v) {\n\te[++cnt].to=v;\n\te[cnt].nxt=head[u];\n\thead[u]=cnt;\n}\ninline void dfs (int u,int depth ) {\n    dfn[u]=++cnt;\n\tif(!dep[0][depth])dep[0][depth]=u;\n\tdep[1][depth]=u;\n    dpth[u]=depth;\n    mxdp=max(mxdp,depth);\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tdfs(e[i].to,depth+1);\n\t\tsiz[u]+=siz[e[i].to]+1;\n\t}\n}\nint main() {\n    n=read();m=read();\n    for(int i=1;i<=n;i++) {\n        fa[i]=read();\n    \tinsert(fa[i],i);\n\t}\n\tcnt=0;\n\tdfs(1,1);\n\tlca[mxdp+1]=dep[0][mxdp];\n\tfor(int i=mxdp;i;i--){\n\t\tint u = lca[i+1];\n\t\twhile(dfn[dep[0][i]]<dfn[u] || dfn[dep[1][i]]>dfn[u]+siz[u])u=fa[u];\n\t\tlca[i]=u;\n\t}\n\twhile(m--) {\n\t\tint k=read();\n\t\tprintf(\"%d\\n\",lca[k]);\n\t}\n    return 0;\n}\n```\n\n\u611f\u8c22\u89c2\u770b\uff01",
        "postTime": 1606315993,
        "uid": 152459,
        "name": "wenye05",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "\u88ab\u673a\u623f\u5927\u4f6c\u6002\u607f\u6765\u5361\u8fd9\u9898\u7684\u5e38\uff0c~~\u6ca1\u60f3\u5230\u76f4\u63a5\u8fc7\u4e86~~\u3002\n\n\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u6027\u8d28\u662f,\u4ee4\u6df1\u5ea6$i>j$,\u6709$deep_{lca_i}\\ge deep_{lca_j}$(\u65e2\u7136\u5b83\u80fd\u4f5c\u4e3a\u6df1\u5ea6\u4e3a$j$\u7684\u70b9\u96c6\u7684$lca$\uff0c\u90a3\u4e48\u4e00\u5b9a\u80fd\u8986\u76d6\u70b9\u96c6$i$\u7684\u6240\u6709\u70b9,\u5373\u4e00\u5b9a\u662f\u70b9\u96c6$i$\u7684$lca$)\u3002\n\n\u4e8e\u662f\u9009\u62e9\u6df1\u5ea6\u6700\u6df1\u7684\u70b9\u5f80\u4e0a\u8df3,\u8df3\u8dc3\u7684\u8fc7\u7a0b\u662f$O(n)$\u7684\u3002\u5728\u5411\u4e0a\u8df3\u7684\u8fc7\u7a0b\u4e2d\u7b2c\u4e00\u4e2a\u80fd\u628a\u6df1\u5ea6\u4e3a$i$\u7684\u70b9\u5168\u90e8\u5305\u542b\u7684\u5b50\u6811\u7684\u6839\u5c31\u662f$lca_i$,\u7528\u6b27\u62c9\u5e8f\u5224\u5b9a\u5f53\u524d\u7684\u6839\u80fd\u5426\u4f5c\u4e3a\u7b54\u6848,\u5426\u5219\u76f4\u63a5\u5411\u7236\u4eb2\u8df3\u3002\n\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#define maxn 5001000\nusing namespace std;\nint min(int x,int y){return x>y?y:x;}\nint max(int x,int y){return x>y?x:y;}\nint rd(){\n\tint x=0;char c=getchar();\n\twhile(c<'0'||c>'9')c=getchar();\n\twhile(c>='0'&&c<='9'){\n\t\tx=x*10+c-48;\n\t\tc=getchar();\n\t}\n\treturn x;\n}\nvoid print(int x){\n\tif(x>9)print(x/10);\n\tputchar(x%10^48);\n}\nstruct edge{\n\tint to,next;\n}e[maxn];\nint n,m,k=0,tot=0;\nint head[maxn],ans[maxn],l[maxn],r[maxn],maxl[maxn],maxr[maxn],pos=0,maxx=0,fa[maxn];\nvoid js(int u,int v){\n\te[++k]=(edge){v,head[u]};\n\thead[u]=k;\n}\nvoid dfs(int u,int dep){\n\tif(dep>maxx){\n\t\tmaxx=dep;\n\t\tpos=u;\n\t}\n\tl[u]=++tot;\n\tfor(int i=head[u];i;i=e[i].next)fa[e[i].to]=u,dfs(e[i].to,dep+1);\n\tr[u]=tot;\n\tmaxl[dep]=!maxl[dep]?l[u]:min(l[u],maxl[dep]);\n\tmaxr[dep]=max(l[u],maxr[dep]);\n   //\u8bb0\u5f55dep\u70b9\u96c6\u7684\u6b27\u62c9\u5e8f\u7684\u6700\u5c0f\u503c(\u6700\u5927\u503c)\n}\nint main(){\n\tn=rd(),m=rd();\n\tfor(int v=1,u;v<=n;++v){\n\t\tu=rd();js(u,v);\n\t}\n\tdfs(1,1);\n\tfor(int i=maxx;i>0;--i){\n\t\twhile(l[pos]>maxl[i]||r[pos]<maxr[i])pos=fa[pos];\n\t\tans[i]=pos;\n\t}\n\tfor(int i=1,x;i<=m;++i){\n\t\tx=rd();print(ans[x]),putchar('\\n');\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1606356040,
        "uid": 231739,
        "name": "\u8001\u58c1\u706f",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "\u4e00\u9053\u7a76\u6781\u79bb\u8c31\u5361\u7a7a\u95f4\u5361\u65f6\u95f4\u9898\u3002\n\n//\u51fa\u9898\u4eba\u53c8\u52a0\u5f3a\u4e86\u6570\u636e\u3002\u3002\u3002\u90a3\u6211\u53ea\u597d\u8bb2\u8bb2\u6b63\u89e3\u4e86\u3002\n\n# **80\u5206\u89e3\u9898\u601d\u8def**\n\u8fd9\u9053\u9898\u6211\u89c9\u5f97\u4ed4\u7ec6\u60f3\u60f3\u66b4\u529b\u601d\u8def\u5c31\u51fa\u6765\u4e86\u3002\u628a\u7b2c $k$ \u5c42\u6240\u6709\u7684\u70b9\u90fd\u6c42\u4e00\u904d $lca$ \u7136\u540e\u8bb0\u5f55\u4e0b\u6765\uff0c\u6700\u540e $O(1)$ \u67e5\u8be2\u8f93\u51fa\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(nlogn)$ \uff0c\u7406\u8bba\u4e0a\u662f\u80fd\u5361\u8fc7\u7684\u3002\n\n\u4e00\u5f00\u59cb\u6211\u7528\u7684\u500d\u589e\uff0c\u4f46\u662f\u6700\u540e\u51e0\u4e2a\u70b9\u5168\u90e8 $MLE$ \u3002\u7136\u540e\u53d1\u73b0\u6bd2\u7624\u51fa\u9898\u4eba\u628a\u7a7a\u95f4\u7ed9\u5361\u4e86\u3002\u5728\u4e00\u756a\u601d\u7d22\u540e\u6211\u60f3\u5230\u4e86\u6811\u5256\u3002\n\n\u6811\u5256 $lca$ \u5e76\u4e0d\u5360\u592a\u591a\u7a7a\u95f4\uff0c\u800c\u4e14\u5e38\u6570\u5f88\u5c0f\u3002\u6211\u8bd5\u4e86\u4e00\u4e0b\u53d1\u73b0\u5b8c\u5168\u53ef\u8fc7\u3002\u4f46\u662f\u5e38\u6570\u65b9\u9762\u8fd8\u662f\u8981\u597d\u597d\u5361\u4e00\u4e0b\u7684\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio> \n#include<cstring>\n#include<vector>\nusing namespace std;\nint n,m,f[3000010],dep[3000010],top[3000010],hd[3000010];\nint maxn,zu[3000010],siz[3000010],zher[3000010],ji;\nstruct nod{\n\tint xu,nxt;\n}cun[3000010];\ninline void add(int x,int y){\n\tcun[++ji].xu=y;\n\tcun[ji].nxt=hd[x];\n\thd[x]=ji;\n}\ninline void dfs1(int xu){\n\tdep[xu]=dep[f[xu]]+1;\n\tsiz[xu]=1;\n\tint maxn=-1;\n\tfor(int i=hd[xu];i;i=cun[i].nxt)\n\t\tif(cun[i].xu!=f[xu]){\n\t\t\tdfs1(cun[i].xu);\n\t\t\tsiz[xu]+=siz[cun[i].xu];\n\t\t\tif(siz[cun[i].xu]>maxn){\n\t\t\t\tmaxn=siz[cun[i].xu];\n\t\t\t\tzher[xu]=cun[i].xu;\n\t\t\t}\n\t\t}\n}\ninline void dfs2(int xu,int topp){\n\ttop[xu]=topp;\n\tif(!zher[xu])return;\n\tdfs2(zher[xu],topp);\n\tfor(int i=hd[xu];i;i=cun[i].nxt)\n\t\tif(cun[i].xu!=f[xu]&&cun[i].xu!=zher[xu])\n\t\t\tdfs2(cun[i].xu,cun[i].xu);\n}\ninline int LCA(int x,int y){\n\twhile(top[x]!=top[y]){\n\t\tif(dep[top[x]]<dep[top[y]])swap(x,y);\n\t\tx=f[top[x]];\n\t}\n\tif(dep[x]>dep[y])swap(x,y);\n\treturn x;\n}\ninline int read(){\n\tint date=0,W=1;char ch=0;\n\twhile(!isdigit(ch)){if(ch=='-')W=-1;ch=getchar();}\n\twhile(isdigit(ch)){date=date*10+ch-'0';ch=getchar();}\n\treturn date*W;\n}\nint main(){\n    n=read();\n    m=read();\n    for(int i=1;i<=n;++i){\n    \tint x=read();\n    \tadd(x,i);\n    \tf[i]=x;\n\t}\n\tdfs1(1);\n\tdfs2(1,1);\n\tfor(int i=1;i<=n;++i)\n\t\tif(!zu[dep[i]])zu[dep[i]]=i;\n\t\telse{\n\t\t\tint x=zu[dep[i]],y=i;\n\t\t\twhile(top[x]!=top[y]){\n\t\t\t\tif(dep[top[x]]<dep[top[y]])swap(x,y);\n\t\t\t\tx=f[top[x]];\n\t\t\t}\n\t\t\tzu[dep[i]]=dep[x]<dep[y]?x:y;\n\t\t}\n\tfor(int i=1;i<=m;++i)\n\t\tprintf(\"%d\\n\",zu[read()]);\n    return 0;\n}\n```\n\u4f46\u662f\u7531\u4e8e\u51fa\u9898\u4eba\u53c8\u52a0\u5f3a\u4e86\u6570\u636e\uff0c\u90a3\u4e48\u5728\u8fd9\u91cc\u8bb2\u8bb2\u53e6\u5916\u4e00\u79cd\u601d\u8def\u3002\n# **100\u5206\u601d\u8def**\n\u8fd9\u91cc\u9996\u5148\u8981\u611f\u8c22\u4e00\u4e0b[@wqy_03](https://www.luogu.com.cn/user/250699)\u548c[@rcxkk](https://www.luogu.com.cn/user/235121)\u7ed9\u7684\u601d\u8def\u3002\n\n\u8981\u60f3\u4e0d\u540e\u671f $lca$ \uff0c\u90a3\u53ea\u80fd\u5c1d\u8bd5\u5728 $dfs$ \u91cc\u5c31\u6c42\u51fa\u5b83\u4eec\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u3002\n\n\u9996\u5148\u6211\u4eec\u8981\u60f3\u5230\u4e00\u4e2a\u601d\u8def\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u6709\u591a\u4e2a\u5b50\u6811\uff0c\u90a3\u4e48\u6b21\u6df1\u7684\u90a3\u4e2a\u5b50\u6811\u7684\u6df1\u5ea6\u5230\u8be5\u70b9\u7684\u6df1\u5ea6\u7684\u6bcf\u4e00\u5c42\u6df1\u5ea6\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u90fd\u4e0d\u53ef\u80fd\u5728\u8be5\u70b9\u6df1\u5ea6\u4e4b\u4e0b\uff0c\u4e5f\u5c31\u662f\u6700\u6df1\u5c31\u662f\u8be5\u70b9\u3002\n\n\u56e0\u4e3a\u7531\u4e8e\u662f\u5b50\u6811\u7684\u539f\u56e0\uff0c\u6240\u4ee5\u663e\u7136\u4ed6\u4eec\u7684\u6700\u8fd1\u9053\u8def\u5fc5\u7136\u8981\u7ecf\u8fc7\u8be5\u70b9\u3002\u800c\u53c8\u56e0\u4e3a\u662f\u6b21\u6df1\u7684\u4e00\u4e2a\u5b50\u6811\uff0c\u6240\u4ee5\u8be5\u6df1\u5ea6\u5fc5\u7136\u6709\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u7684\u8282\u70b9\u5728\u8be5\u70b9\u7684\u4e0d\u540c\u5b50\u6811\u91cc\u9762\u3002\n\n\u8fd9\u6837\u5b50\u4ece\u4e0b\u5f80\u4e0a\u63a8\uff0c\u4e0d\u65ad\u66f4\u65b0\uff0c\u6700\u7ec8\u5f97\u5230\u7684\u5c31\u662f\u7b54\u6848\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio> \n#include<cstring>\nusing namespace std;\nint n,m,idx=1;\nint head[10000010],ans[10000010];\nstruct node{\n\tint nxt,to;\n}edge[10000010];\ninline void add(int u,int v){\n\tedge[++idx].nxt=head[u];\n\tedge[idx].to=v;\n\thead[u]=idx;\n}\ninline int dfs(int x,int dep){\n\tint maxn=dep,maxn2=dep;\n\tfor(int i=head[x];i;i=edge[i].nxt){\n\t\tint v=edge[i].to;\n\t\tint s=dfs(v,dep+1);\n\t\tif(s>maxn){\n\t\t\tmaxn2=maxn;\n\t\t\tmaxn=s;\n\t\t}\n\t\telse if(s>maxn2)maxn2=s;\n\t}\n\tfor(int i=dep;i<=maxn2;i++)\n\t\tans[i]=x;\n\treturn maxn;\n}\ninline int read(){\n\tint date=0,W=1;char ch=0;\n\twhile(!isdigit(ch)){if(ch=='-')W=-1;ch=getchar();}\n\twhile(isdigit(ch)){date=date*10+ch-'0';ch=getchar();}\n\treturn date*W;\n}\nint main(){\n\tn=read();\n\tm=read();\n\tfor(int i=1;i<=n;i++){\n\t\tint x=read();\n\t\tadd(x,i);\n\t}\n\tdfs(1,1);\n\tfor(int i=1;i<=m;i++){\n\t\tint x=read();\n\t\tprintf(\"%lld\\n\",ans[x]);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1606189963,
        "uid": 236970,
        "name": "yewanxingkong",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    },
    {
        "content": "\u4e27\u5fc3\u75c5\u72c2\u554a\u8fd9\u51fa\u9898\u4eba\uff0c\u500d\u589eLCA\u90fd\u5361\u3002\n\n\n### 40pts\n\n\u65e2\u7136\u8981\u6c42\u51fa\u67d0\u4e00\u4e2a\u6df1\u5ea6\u7684\u5171\u540cLCA\uff0c\u53ef\u4ee5\u8ba1\u7b97\u4e24\u4e2a\u70b9\u7684LCA\uff0c\u518d\u548c\u7b2c\u4e09\u4e2a\u70b9\u518d\u8ba1\u7b97LCA\uff0c\u5c3d\u7ba1\u53ef\u4ee5\u63d0\u524d\u9884\u5904\u7406\u51fa\u6bcf\u4e24\u4e2a\u70b9\u7684LCA\uff0c\u4f46\u662f\u8fd8\u662f\u5f97T\u98de\u3002~~\u4e0d\u8d34\u4ee3\u7801\u4e86~~\n\n### 60pts\n\n\u629b\u5f00\u66b4\u529b\u601d\u8def\u4e0d\u60f3\uff0c\u6211\u4eec\u4ece\u4e2d\u53bb\u627e\u4e00\u4e9b\u89c4\u5f8b\u3002\uff08~~\u5176\u5b9e\u8fd9\u4e2a\u601d\u8def\u662f\u673a\u623f\u5927\u4f6c\u544a\u8bc9\u6211\u7684\uff0c\u975e\u5e38\u611f\u8c22\u8fd9\u4f4d\u5de8\u4f6c~~\uff09\u3002\u591a\u751f\u51e0\u7ec4\u5c0f\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b54\u6848\u5c31\u662f\u8fd9\u68f5\u6811\u5728\u6df1\u5ea6\u4e3a$k$\u65f6dfs\u5e8f\u7b2c\u4e00\u4e2a\u70b9\u548c\u6700\u540e\u4e00\u4e2a\u70b9\u7684LCA\u3002\n\n\u53ef\u4ee5\u5c06$dep_i=k$\u7684\u70b9\u6254\u8fdbvector\u91cc\uff0c\u7136\u540e\u627e\u5230\u7b2c\u4e00\u4e2a\u8282\u70b9\u548c\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u5e76\u6c42\u51faLCA\u5373\u53ef\u3002\n\n\u4ee3\u7801\u5982\u4e0b\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3000001;\nint read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nstruct node{\n\tint nxt,to;\n}e[N<<1];\nint head[N],cnt=0,dep[N],n,m,fa,q;\nint f[N][20];\nvector<int>D[N];\nvoid add(int u,int v){\n\te[++cnt].nxt=head[u];\n\thead[u]=cnt;\n\te[cnt].to=v;\n}\nvoid base(){\n\tfor(int i=1;i<=19;i++)\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tf[j][i]=f[f[j][i-1]][i-1];\n}\nvoid dfs(int u,int fa,int d){\n\tdep[u]=d;D[d].push_back(u);\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==fa)continue;\n\t\tf[v][0]=u;\n\t\tdfs(v,u,d+1);\n\t}\n}\nint LCA(int x,int y){\n    if(dep[x]<dep[y])swap(x,y);\n    for(int i=19;i>=0;i--)if(dep[f[x][i]]>=dep[y])x=f[x][i];\n    if(x==y)return x;\n    for(int i=19;i>=0;i--)if(f[x][i]!=f[y][i])x=f[x][i],y=f[y][i];\n    return f[x][0];\n}\nint main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++){\n\t\tfa=read();\n\t\tadd(i,fa),add(fa,i);\n\t}\n\tdep[1]=1;\n\tdfs(1,0,1);base();\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d\",&q);\n//\t\tprintf(\"%d %d\\n\",D[q][0],D[q][D[q].size()-1]);\n//\t\tprintf(\"%d\\n\",LCA(7,8));\n\t\tprintf(\"%d\\n\",LCA(D[q][0],D[q][D[q].size()-1]));\n\t}\n\treturn 0;\n}\n```\n\n\u53d1\u73b0\u8fd9\u4e2a\u9898\u7684$N$\u975e\u5e38\u5927\uff0c\u6240\u4ee5\u500d\u589e\u6570\u7ec4\u4f1a\u5bfc\u81f4MLE\u3002\u6240\u4ee5\u8fd8\u662f\u4e0a\u6811\u5256LCA\u5427\uff0c\u4f46\u662f\u56e0\u4e3avector\u5360\u7684\u5185\u5b58\u592a\u5927\uff0c\u8fd8\u662f\u53ea\u670960pts\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3000001;\nint read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nstruct node{\n\tint nxt,to;\n}e[N<<1];\nvector<int>D[1500001];\nint head[N],cnt=0,fa[N],siz[N],num[N],son[N],top[N],n,m,x,dep[N];\nvoid add(int u,int v){\n\te[++cnt].nxt=head[u];\n\thead[u]=cnt;\n\te[cnt].to=v;\n}\nvoid dfs1(int u){\n\tsiz[u]=1;\n\tdep[u]=dep[fa[u]]+1;\n\tD[dep[u]].push_back(u);\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==fa[u])continue;\n\t\tfa[v]=u;\n\t\tdfs1(v);\n\t\tsiz[u]+=siz[v];\n\t\tif(siz[v]>num[u])num[u]=siz[v],son[u]=v;\n\t}\n}\nvoid dfs2(int u,int t){\n\ttop[u]=t;\n\tif(son[u])dfs2(son[u],t);\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t\tif(e[i].to!=fa[u]&&e[i].to!=son[u])dfs2(e[i].to,e[i].to);\n}\nint main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++){\n\t\tx=read();\n\t\tadd(x,i);\n\t}\n\tdfs1(1),dfs2(1,1);\n\tfor(int i=1,q;i<=m;i++){\n\t\tq=read();\n\t\tint x=D[q][0],y=D[q][D[q].size()-1];\n\t\twhile(top[x]!=top[y]){\n\t\t\tif(dep[top[x]]>=dep[top[y]])x=fa[top[x]];\n\t\t\telse y=fa[top[y]];\n\t\t}\n\t\tif(dep[x]<dep[y])printf(\"%d\\n\",x);\n\t\telse printf(\"%d\\n\",y);\n\t}\n}\n\n```\n## 100pts\n\u662f\u6211\u592a\u8822\u4e86\uff0c\u4e3a\u4ec0\u4e48\u504f\u8981\u5f00\u4e2avector\u6765\u5b58\u6240\u6709\u6df1\u5ea6\u4e3ak\u7684\u7ed3\u70b9\uff0c\u6211\u4eec\u53ea\u8981\u5b58\u4e24\u4e2a\u70b9\u5c31\u53ef\u4ee5\u4e86\u3002\n\n$now[dep][0/1]$\u8868\u793a\u6df1\u5ea6\u4e3adep\u7684dfs\u5e8f\u7684\u7b2c\u4e00\u4e2a\u70b9\u548c\u6700\u540e\u4e00\u4e2a\u70b9,$check[dep]$\u5224\u65addep\u6df1\u5ea6\u7684\u70b9\u51fa\u73b0\u7684\u6b21\u6570\u3002\u6ce8\u610f\u5f53\u6811\u662f\u4e00\u6761\u94fe\u7684\u65f6\u5019\uff0c$now[dep][1]=0$,\u6b64\u65f6\u7b54\u6848\u5c31\u662f$now[dep][0]$.\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3000001;\nint read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nstruct node{\n\tint nxt,to;\n}e[N<<1];\nint head[N],cnt=0,fa[N],siz[N],num[N],son[N],top[N],n,m,x,dep[N],now[N][2],check[N];\nvoid add(int u,int v){\n\te[++cnt].nxt=head[u];\n\thead[u]=cnt;\n\te[cnt].to=v;\n}\nvoid dfs1(int u){\n\tsiz[u]=1;\n\tdep[u]=dep[fa[u]]+1;\n\tif(!check[dep[u]])now[dep[u]][0]=u;\n\telse now[dep[u]][1]=u;\n\tcheck[dep[u]]++;\n//\tD[dep[u]].push_back(u);\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==fa[u])continue;\n\t\tfa[v]=u;\n\t\tdfs1(v);\n\t\tsiz[u]+=siz[v];\n\t\tif(siz[v]>num[u])num[u]=siz[v],son[u]=v;\n\t}\n}\nvoid dfs2(int u,int t){\n\ttop[u]=t;\n\tif(son[u])dfs2(son[u],t);\n\tfor(int i=head[u];i;i=e[i].nxt)\n\t\tif(e[i].to!=fa[u]&&e[i].to!=son[u])dfs2(e[i].to,e[i].to);\n}\nint main(){\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++){\n\t\tx=read();\n\t\tadd(x,i);\n\t}\n\tdfs1(1),dfs2(1,1);\n\tfor(int i=1,q;i<=m;i++){\n\t\tq=read();\n\t\tif(check[q]==1){\n\t\t\tprintf(\"%d\\n\",now[q][0]);\n\t\t\tcontinue;\n\t\t}\n\t\tint x=now[q][0],y=now[q][1];\n\t\twhile(top[x]!=top[y]){\n\t\t\tif(dep[top[x]]>=dep[top[y]])x=fa[top[x]];\n\t\t\telse y=fa[top[y]];\n\t\t}\n\t\tif(dep[x]<dep[y])printf(\"%d\\n\",x);\n\t\telse printf(\"%d\\n\",y);\n\t}\n}\n```\n\n\n",
        "postTime": 1606138779,
        "uid": 94531,
        "name": "Watermatter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7103 \u3010\u300cC.E.L.U-01\u300d\u65cf\u8c31\u6811\u3011"
    }
]