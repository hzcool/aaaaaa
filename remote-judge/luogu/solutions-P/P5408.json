[
    {
        "content": "\u4f17\u6240\u5468\u77e5\uff0c\n\n$$x^{\\overline{n}}=\\sum_i\\begin{bmatrix}n\\\\i\\end{bmatrix}x^i$$\n\n\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u6210\u4e86\u6c42 $x$ \u7684 $n$ \u6b21\u4e0a\u5347\u5e42\u3002\n\n\u8003\u8651\u500d\u589e\uff0c\n\n$$x^{\\overline{2n}}=x^{\\overline{n}}(x+n)^{\\overline{n}}$$\n\n\u4e8e\u662f\u73b0\u5728\u6211\u4eec\u6709\u4e00\u4e2a\u591a\u9879\u5f0f $f(x)$\uff0c\u8981\u6c42\u53e6\u4e00\u4e2a\u591a\u9879\u5f0f $f(x+c)$\u3002\n\n$$\\begin{aligned}&f(x+c)\\\\=&\\sum_if_i(x+c)^i\\\\=&\\sum_jx^j\\sum_if_i\\binom{i}{j}c^{j-i}\\\\=&\\sum_jx^j\\frac1{j!}\\sum_ii!f_i\\frac{c^{j-i}}{(j-i)!}\\end{aligned}$$\n\n\u628a $f$ \u53cd\u8fc7\u6765\u505a\u4e00\u6b21\u5377\u79ef\u5373\u53ef\u3002\u4e8e\u662f\u5355\u6b21\u500d\u589e\u590d\u6742\u5ea6\u5c31\u662f $O(n\\log n)$\uff0c\u603b\u590d\u6742\u5ea6 $T(n)=T(n/2)+O(n\\log n)=O(n\\log n)$\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <algorithm>\n#include <cstdio>\n#include <cstring>\n\ntypedef long long LL;\nconst int N = 550050;\nconst int mod = 167772161;\n\nLL pow_mod(LL a, LL b) {\n  LL ans = 1;\n  for (; b; b >>= 1, a = a * a % mod)\n    if (b & 1) ans = ans * a % mod;\n  return ans;\n}\n\nint L, rev[N];\nLL w[N], inv[N], fac[N], ifac[N];\n\nvoid Init(int n) {\n  L = 1;\n  while (L <= n) L <<= 1;\n  for (int i = 1; i < L; ++i)\n    rev[i] = (rev[i >> 1] >> 1) | ((i & 1) * L / 2);\n  LL wn = pow_mod(3, (mod - 1) / L);\n  w[L >> 1] = 1;\n  for (int i = L >> 1; i < L; ++i) w[i + 1] = w[i] * wn % mod;\n  for (int i = (L >> 1) - 1; i; --i) w[i] = w[i << 1];\n}\n\nvoid DFT(LL *A, int len) {\n  int k = __builtin_ctz(L) - __builtin_ctz(len);\n  for (int i = 1; i < len; ++i) {\n    int j = rev[i] >> k;\n    if (j > i) std::swap(A[i], A[j]);\n  }\n  for (int h = 1; h < len; h <<= 1)\n    for (int i = 0; i < len; i += (h << 1))\n      for (int j = 0; j < h; ++j) {\n        LL t = A[i + j + h] * w[j + h] % mod;\n        A[i + j + h] = A[i + j] - t;\n        A[i + j] += t;\n      }\n  for (int i = 0; i < len; ++i) A[i] %= mod;\n}\n\nvoid IDFT(LL *A, int len) {\n  std::reverse(A + 1, A + len);\n  DFT(A, len);\n  int v = mod - (mod - 1) / len;\n  for (int i = 0; i < len; ++i) A[i] = A[i] * v % mod;\n}\n\nvoid offset(const LL *f, int n, LL c, LL *g) {\n  // g(x) = f(x + c)\n  // g[i] = 1/i! sum_{j=i}^n j!f[j] c^(j-i)/(j-i)!\n  static LL tA[N], tB[N];\n  int l = 1; while (l <= n + n) l <<= 1;\n  for (int i = 0; i < n; ++i) tA[n - i - 1] = f[i] * fac[i] % mod;\n  LL pc = 1;\n  for (int i = 0; i < n; ++i, pc = pc * c % mod) tB[i] = pc * ifac[i] % mod;\n  for (int i = n; i < l; ++i) tA[i] = tB[i] = 0;\n  DFT(tA, l); DFT(tB, l);\n  for (int i = 0; i < l; ++i) tA[i] = tA[i] * tB[i] % mod;\n  IDFT(tA, l);\n  for (int i = 0; i < n; ++i)\n    g[i] = tA[n - i - 1] * ifac[i] % mod;\n}\n\nvoid Solve(int n, LL *f) {\n  if (n == 0) return void(f[0] = 1);\n  static LL tA[N], tB[N];\n  int m = n / 2;\n  Solve(m, f);\n  int l = 1; while (l <= n) l <<= 1;\n  offset(f, m + 1, m, tA);\n  for (int i = 0; i <= m; ++i) tB[i] = f[i];\n  for (int i = m + 1; i < l; ++i) tA[i] = tB[i] = 0;\n  DFT(tA, l); DFT(tB, l);\n  for (int i = 0; i < l; ++i) tA[i] = tA[i] * tB[i] % mod;\n  IDFT(tA, l);\n  if (n & 1)\n    for (int i = 0; i <= n; ++i)\n      f[i] = ((i ? tA[i - 1] : 0) + (n - 1) * tA[i]) % mod;\n  else\n    for (int i = 0; i <= n; ++i)\n      f[i] = tA[i];\n}\n\nLL f[N];\n\nint main() {\n  int n;\n  scanf(\"%d\", &n);\n  Init(n * 2);\n  inv[1] = 1;\n  for (int i = 2; i <= n; ++i) inv[i] = -(mod / i) * inv[mod % i] % mod;\n  fac[0] = ifac[0] = 1;\n  for (int i = 1; i <= n; ++i) {\n    fac[i] = fac[i - 1] * i % mod;\n    ifac[i] = ifac[i - 1] * inv[i] % mod;\n  }\n  Solve(n, f);\n  for (int i = 0; i <= n; ++i)\n    printf(\"%lld \", (f[i] + mod) % mod);\n  return 0;\n}\n\n```",
        "postTime": 1558839155,
        "uid": 7868,
        "name": "_rqy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5408 \u3010\u3010\u6a21\u677f\u3011\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "updated\n\n\u597d\u4e0d\u5bb9\u6613\u7ec8\u4e8e\u628a\u8fd9\u9898\u963f\u4e86\uff0c\u4e8e\u662f\u6765\u5199\u4e00\u7bc7\u9898\u89e3\u3002\u3002  \n****  \n\u7b2c $n$ \u884c\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u7684\u751f\u6210\u51fd\u6570\u4e3a \n$$x^{\\overline n}=\\prod\\limits_{i=0}^{n-1}(x+i)=\\sum\\limits_{i=0}^n\\begin{bmatrix} n\\\\i\\end{bmatrix}x^i$$\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u90a3\u4e2a\u8fde\u7eed\u4e58\u79ef\u5c31\u597d\u4e86  \n\n\u8003\u8651\u500d\u589e\u3002  \n$$ x^{\\overline {2n}}=x^{\\overline n}(x+n)^{\\overline n}$$  \n\u4e5f\u5c31\u662f\n$$\\prod\\limits_{i=0}^{2n-1}(x+i)=\\prod\\limits_{i=0}^{n-1}(x+i)\\prod\\limits_{i=0}^{n-1}(x+n+i)$$ \n\u90a3\u4e48\u53ea\u8981\u80fd\u7ed9\u5b9a\u4e00\u4e2a $n$ \u6b21\u591a\u9879\u5f0f $f(x)$\uff0c\u5feb\u901f\u8ba1\u7b97\u51fa $f(x+k)$ \u5c31\u884c\u3002 \n\n\u4e3a\u4e86\u65b9\u4fbf\u4e0b\u9762\u8868\u8ff0\uff0c\u6211\u4eec\u8bbe $a_i=[x^i]f(x)$\u3002\n$$f(x+k)=\\sum\\limits_{i=0}^na_i(x+k)^i$$  \n$$ =\\sum\\limits_{i=0}^na_i\\sum\\limits_{j=0}^i\\binom{i}{j}x^jk^{i-j}$$ \n$$ = \\sum\\limits_{i=0}^nx^i\\sum\\limits_{j=i}^n \\binom{j}{i}k^{j-i}a_j$$  \n$$ =\\sum\\limits_{i=0}^n\\frac{x^i}{i!}\\sum\\limits_{j=i}^{n}\\frac{k^{j-i}}{(j-i)!}j!a_j$$  \n\u522b\u7684\u5927\u4f6c\u90fd\u8bf4\u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u662f\u5377\u79ef\uff0c\u6ca1\u6709\u5177\u4f53\u5199\u51fa\u6765\uff0c\u8fd9\u91cc\u5c31\u5199\u4e00\u4e0b\u5427\uff0c\uff0c\n\n\u8bbe  \n$$g(x)=\\sum\\limits_{i=0}^n\\frac{k^i}{i!}x^{n-i}$$  \n$$ h(x) = \\sum\\limits_{i=0}^ni!a_ix^i$$   \n\u90a3\u4e48\u53ea\u9700\u8981\u5c06 $g(x)$ \u548c $h(x)$ \u4e58\u8d77\u6765\uff0c\u7136\u540e\u5de6\u79fb $n$ \u4f4d ( \u4e5f\u5c31\u662f\u5c06 $i$ \u6b21\u9879\u7cfb\u6570\u53d8\u4e3a $n+i$ \u6b21\u9879\u7cfb\u6570 ) \u4e4b\u540e\uff0c\u7b2c $i$ \u6b21\u90fd\u4e58\u4e0a $i!$ \u5c31\u662f\u6211\u4eec\u60f3\u8981\u7684 $f(x+k)$ \u4e86\u3002\n\n\u5f53\u7136\uff0c\u500d\u589e\u8fc7\u7a0b\u4e2d\u8fd8\u8981\u6709\u8ba1\u7b97 $x^{\\overline n}(x+n)$ \u7684\u60c5\u51b5\uff0c\u66b4\u529b\u7ebf\u6027\u7b97\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\n$$ T(n)=T(n/2)+\\Theta(n\\log n)=\\Theta(n \\log n)$$ \n\nCode\uff1a  \n```cpp\n#pragma GCC optimize (2)\n#pragma GCC optimize (\"unroll-loops\")\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n#include<vector>\n#define N 524292\n#define ll long long\n#define reg register\n#define p 167772161\nusing namespace std;\n\nvoid print(int x){\n    if(x>9) print(x/10);\n    putchar(x%10+'0');\n}\n\ninline int power(int a,int t){\n    int res = 1;\n    while(t){\n        if(t&1) res = (ll)res*a%p;\n        a = (ll)a*a%p;\n        t >>= 1;\n    }\n    return res;\n}\n\nint rt[N],rev[N],fac[N],ifac[N];\nint siz;\n\nvoid init(int n){\n    int w,lim = 1;\n    while(lim<=n) lim <<= 1,++siz;\n    for(reg int i=1;i!=lim;++i) rev[i] = (rev[i>>1]>>1)|((i&1)<<(siz-1));\n    w = power(3,(p-1)>>siz);\n    fac[0] = fac[1] = ifac[0] = ifac[1] = rt[lim>>1] = 1;\n    for(reg int i=lim>>1|1;i!=lim;++i) rt[i] = (ll)rt[i-1]*w%p;\n    for(reg int i=(lim>>1)-1;i;--i) rt[i] = rt[i<<1];\n    for(reg int i=2;i<=n;++i) fac[i] = (ll)fac[i-1]*i%p;\n    ifac[n] = power(fac[n],p-2);\n    for(reg int i=n-1;i;--i) ifac[i] = (ll)ifac[i+1]*(i+1)%p;\n}\n\ninline void dft(int *f,int lim){\n    static unsigned long long a[N];\n    reg int x,shift = siz-__builtin_ctz(lim);\n    for(reg int i=0;i!=lim;++i) a[rev[i]>>shift] = f[i];\n    for(reg int mid=1;mid!=lim;mid<<=1)\n    for(reg int j=0;j!=lim;j+=(mid<<1))\n    for(reg int k=0;k!=mid;++k){\n        x = a[j|k|mid]*rt[mid|k]%p;\n        a[j|k|mid] = a[j|k]+p-x;\n        a[j|k] += x;\n    }\n    for(reg int i=0;i!=lim;++i) f[i] = a[i]%p;\n}\n\ninline void idft(int *f,int lim){\n    reverse(f+1,f+lim);\n    dft(f,lim);\n    int x = p-((p-1)>>__builtin_ctz(lim));\n    for(reg int i=0;i!=lim;++i) f[i] = (ll)f[i]*x%p;\n}\n\ninline void composite(const int *f,int n,int c,int *R){ //\u7531 f(x) \u8ba1\u7b97 f(x+c)\n    static int g[N],h[N];\n    g[0] = 1,h[0] = 0;\n    for(reg int i=1;i<=n;++i){\n        g[i] = (ll)g[i-1]*c%p;\n        h[i] = (ll)f[i]*fac[i]%p;\n    }\n    for(reg int i=2;i<=n;++i) g[i] = (ll)g[i]*ifac[i]%p;\n    reverse(g,g+n+1);\n    int lim = 1<<(32-__builtin_clz(n<<1));\n    memset(g+n+1,0,(lim-n)<<2);\n    memset(h+n+1,0,(lim-n)<<2);\n    dft(g,lim),dft(h,lim);\n    for(reg int i=0;i!=lim;++i) g[i] = (ll)g[i]*h[i]%p;\n    idft(g,lim);\n    for(reg int i=0;i<=n;++i) R[i] = (ll)g[i+n]*ifac[i]%p;\n}\n\nvoid solve(int *f,int n){\n    static int g[N],st[30];\n    int lim = 1,top = 0;\n    while(n){\n        st[++top] = n;\n        n >>= 1;\n    }\n    n = f[1] = st[top--];\n    while(top--){\n        while(lim<=(n<<1)) lim <<= 1;\n        composite(f,n,n,g);\n        memset(g+n+1,0,(lim-n)<<2);\n        dft(f,lim),dft(g,lim);\n        for(reg int i=0;i!=lim;++i) f[i] = (ll)f[i]*g[i]%p;\n        idft(f,lim);\n        n <<= 1;\n        if(n==st[top+1]) continue;\n        f[n+1] = f[n];\n        for(reg int i=n;i;--i) f[i] = (f[i-1]+(ll)f[i]*n)%p;\n        f[0] = (ll)f[0]*n%p;\n        ++n;\n    }\n}\n\nint f[N];\nint n;\n\nint main(){\n    scanf(\"%d\",&n);\n    init(n<<1);\n    solve(f,n);\n    for(reg int i=0;i<=n;++i) print(f[i]),putchar(' ');\n    return 0;   \n}\n```",
        "postTime": 1563368592,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5408 \u3010\u3010\u6a21\u677f\u3011\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "\u8fdb\u535a\u5ba2\u770b\u4f53\u9a8c\u66f4\u4f73\uff1ahttps://www.luogu.com.cn/blog/id-exzang/solution-p5408\n\n\n\u6709 \n\n$$\n\nx^{\\bar{n}}=\\sum_{i=0}^n {\\begin{bmatrix}n \\\\i\\end{bmatrix}}x^i \n\n$$\n\n\u5176\u4e2d $x^{\\bar{n}}$ \u8868\u793a\u4e0a\u5347\u5e42\uff0c\u5373 $\\prod_{i=x}^{x+n-1}i$\n\n\u53ef\u4ee5\u76f4\u63a5\u7528\u5f52\u7eb3\u6cd5\u8bc1\u660e\u3002\n\n$$\nx^{\\bar{n+1}}=(\\sum_{i=0}^n \\begin{bmatrix} n \\\\ i \\end{bmatrix}x^i)(x+n)\n$$\n\n$$\n=\\sum_{i=0}^{n+1} (\\begin{bmatrix} n \\\\ i-1 \\end{bmatrix} +n \\times \\begin{bmatrix} n\\\\i \\end{bmatrix})x^i\n$$\n\n$$\n=\\sum_{i=0}^{n+1}\\begin{bmatrix}n+1\\\\i\\end{bmatrix}x^i\n$$\n\n\n\u81f3\u4e8e\u600e\u4e48\u7b97 $x^{\\bar{n}}$...\u53ef\u4ee5\u91c7\u53d6\u500d\u589e\u6cd5\u3002\n\n\u663e\u7136 $x^{\\bar{2n}}=x^{\\bar{n}}(x+n)^{\\bar{n}}$\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86 $x^{\\bar{n}}$ \uff0c\u90a3\u4e48\u74f6\u9888\u5c31\u5728\u4e8e\u5982\u4f55\u7b97\u51fa $(x+n)^{\\bar{n}}$\n\n\u8bbe $f(x)=x^{\\bar{n}}$\uff0c\u90a3\u4e48 $(x+n)^{\\bar{n}}$ \u5c31\u662f $f(x+n)$\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u4e3a\u600e\u4e48\u4ece\u591a\u9879\u5f0f $f(x)$ \u63a8\u5230\u591a\u9879\u5f0f $f(x+n)$\n\n\n\u5047\u8bbe $f(x)$ \u7684\u7b2c $i$ \u9879\u7cfb\u6570\u4e3a $a_i$ \uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u63a8\u5bfc\u5982\u4e0b\uff1a\n\n\n$$\n\\begin{aligned}\nf(x+n)&=\\sum_{i=0}^{n}a_i(x+n)^i \\\\\n&= \\sum_{i=0}^{n} a_i \\sum_{j=0}^i x^j n^{i-j}  \\binom i j \\\\\n&= \\sum_{j=0}^n x^j \\sum_{i=j}^n a_i n^{i-j} \\binom i j\n\\end{aligned}\n$$\n\n\u7136\u540e\u62c6\u4e00\u4e0b\u4e8c\u9879\u5f0f\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\n\\begin{aligned}\nf(x+n)&=\\sum_{j=0}^n \\frac{x^j}{j!} \\sum_{i=j}^n (a_ii!) \\frac{n^{i-j}}{(i-j)!}\n\\end{aligned}\n$$\n\n\u6211\u4eec\u8bbe $A(i)=a_ii!,B(i)=\\frac{n^i}{i!}$\uff0c\u5c31\u6709\uff1a\n\n$$\n\\begin{aligned}\nf(x+n)&=\\sum_{j=0}^n\\frac{x^j}{j!} \\sum_{i=j}^n A(i) \\times B(i-j)\\\\\n&= \\sum_{j=0}^n \\frac{x^j}{j!} \\sum_{i=0}^{n-j} A(i+j) \\times B(i) \\\\\n&= \\sum_{j=0}^n \\frac{x^j}{j!} \\sum_{i=0}^{n-j} A'(n-j-i) \\times B(i)\n\\end{aligned}\n$$\n\n\u5176\u4e2d $A'$ \u5e8f\u5217 \u8868\u793a $A$ \u5e8f\u5217\u53cd\u8f6c\u540e\u7684\u5e8f\u5217\u3002\n\n\u540e\u9762\u8fd9\u4e2a\u5f0f\u5b50\u662f\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5 `NTT` \u4f18\u5316\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5 $\\mathcal{O}(n \\log n)$ \u7b97\u51fa $f(x+n)$\u3002\n\n\u81f3\u4e8e\u5982\u4f55\u8ba1\u7b97 $f(x)f(x+n)$ \u53ef\u4ee5\u4e5f\u6765\u4e00\u53d1 `NTT`\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $T(n)=T(\\frac{n}{2})+\\mathcal{O}(n\\log n)=\\mathcal{O}(n \\log n)$\n\n\n\u4ee5\u4e0b\u662f\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long \ntypedef long long ll;\nconst ll mod=167772161;\nll G=3,invG;\nconst int N=1200000;\nll ksm(ll b,int n){\n\tll res=1;\n\twhile(n){\n\t\tif(n&1) res=res*b%mod;\n\t\tb=b*b%mod; n>>=1;\n\t}\n\treturn res;\n}\nint read(){\n\tint x=0;char ch=getchar();\n\twhile(!isdigit(ch))ch=getchar();\n\twhile(isdigit(ch)) x=(x*10+(ch-'0'))%mod,ch=getchar();\n\treturn x;\n}\nint tr[N];\nvoid NTT(ll *f,int n,int fl){\n\tfor(int i=0;i<n;++i)\n\t\tif(i<tr[i]) swap(f[i],f[tr[i]]);\n\tfor(int p=2;p<=n;p<<=1){\n\t\tint len=(p>>1);\n\t\tll w=ksm((fl==0)?G:invG,(mod-1)/p);\n\t\tfor(int st=0;st<n;st+=p){\n\t\t\tll buf=1,tmp;\n\t\t\tfor(int i=st;i<st+len;++i)\n\t\t\t\ttmp=buf*f[i+len]%mod,\n\t\t\t\tf[i+len]=(f[i]-tmp+mod)%mod,\n\t\t\t\tf[i]=(f[i]+tmp)%mod,\n\t\t\t\tbuf=buf*w%mod;\n\t\t}\n\t}\n\tif(fl==1){\n\t\tll invN=ksm(n,mod-2);\n\t\tfor(int i=0;i<n;++i)\n\t\t\tf[i]=(f[i]*invN)%mod;\n\t}\n}\nvoid Mul(ll *f,ll *g,int n,int m){\n\tm+=n;n=1;\n\twhile(n<m) n<<=1;\n\tfor(int i=0;i<n;++i)\n\t\ttr[i]=(tr[i>>1]>>1)|((i&1)?(n>>1):0);\n\tNTT(f,n,0);\n\tNTT(g,n,0);\n\tfor(int i=0;i<n;++i) f[i]=f[i]*g[i]%mod;\n\tNTT(f,n,1);\n}\nll inv[N],fac[N];\nll w[N],a[N],b[N],g[N];\nvoid Solve(ll *f,int m){\n\tif(m==1) return f[1]=1,void(0);\n\tif(m&1){\n\t\tSolve(f,m-1);\n\t\tfor(int i=m;i>=1;--i)\n\t\t\tf[i]=(f[i-1]+f[i]*(m-1)%mod)%mod;\n\t\tf[0]=f[0]*(m-1)%mod;\n\t}\n\telse{\n\t\tint n=m/2;ll res=1;\n\t\tSolve(f,n);\n\t\tfor(int i=0;i<=n;++i)\n\t\t\ta[i]=f[i]*fac[i]%mod,b[i]=res*inv[i]%mod,res=res*n%mod;\n\t\treverse(a,a+n+1);\n\t\tMul(a,b,n+1,n+1);\n\t\tfor(int i=0;i<=n;++i)\n\t\t\tg[i]=inv[i]*a[n-i]%mod;\n\t\tMul(f,g,n+1,n+1);\n\t\tint limit=1;\n\t\twhile(limit<(n+1)<<1) limit<<=1;\n\t\tfor(int i=n+1;i<limit;++i) a[i]=b[i]=g[i]=0;\n\t\tfor(int i=m+1;i<limit;++i) f[i]=0;\n\t}\n}\nll f[N];\nvoid init(int n){\n\tfac[0]=1;\n\tfor(int i=1;i<=n;++i)\n\t\tfac[i]=1ll*fac[i-1]*i%mod;\n\tinv[n]=ksm(fac[n],mod-2);\n\tfor(int i=n-1;i>=0;--i)\n\t\tinv[i]=1ll*inv[i+1]*(i+1)%mod;\n}\nsigned main(){\n\tinvG=ksm(G,mod-2);\n\tint n,k=0;\n\tcin>>n;\n\tinit(n+n);\n\tSolve(f,n);\n\tfor(int i=0;i<=n;++i)\n\t\tprintf(\"%lld \",f[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1594283140,
        "uid": 344016,
        "name": "wurzang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5408 \u3010\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "$\\text{upd on }2021.02.08$ \u611f\u8c22 @[\u65f6\u95f4\u62d3\u8352\u8005](https://www.luogu.com.cn/user/35754) \u6307\u51fa\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\u9519\u8bef\u3002\n\n$\\text{upd on }2021.03.05$ \u4fee\u6b63\u4e86\u4e00\u4e2a\u5c0f\u7b14\u8bef\u3002\n\n---\n\n[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5408)\u3002\n\n> \u9898\u610f\uff1a\u7ed9\u5b9a $n$\uff0c\u6c42  $\\begin{bmatrix}n\\\\0\\end{bmatrix}, \\begin{bmatrix}n\\\\1\\end{bmatrix}\\cdots\\begin{bmatrix}n\\\\n\\end{bmatrix}$\uff0c\u7b54\u6848\u5bf9 $167772161$ \u53d6\u6a21\uff0c\u5176\u4e2d $\\begin{bmatrix}n\\\\m\\end{bmatrix}$ \u8868\u793a\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u3002\n\n\u6a21\u677f\u9898\u3002\n\n---\n\n### $Solution:$\n\n\u5173\u4e8e\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u5f0f\u5b50\uff1a\n\n$$x^{\\overline{n}}=\\sum_{i=0}^n\\begin{bmatrix}n\\\\i\\end{bmatrix}x^i$$\n\n\u8bc1\u660e\u7684\u8bdd\u2026\u2026\u76f4\u63a5[\u5f52\u7eb3\u6cd5](https://www.luogu.com.cn/paste/0quk0jq6)\u5c31\u884c\u4e86\u3002\n\n\u6240\u4ee5\u53ea\u9700\u8981\u77e5\u9053 $x^{\\overline n}$ \u5c31\u884c\u4e86\u3002\n\n\u8003\u8651\u500d\u589e\uff0c\u6709\u5f0f\u5b50\uff1a\n\n$$x^{\\overline{2n}}=x^{\\overline{n}}(x+n)^{\\overline{n}}$$\n\n\u8bb0 $f(x)=x^{\\overline n}$\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u5728\u77e5\u9053 $f(x)$ \u7684\u524d\u63d0\u5feb\u901f\u6c42\u51fa $f(x+k)$ \u5373\u53ef\u3002\n\n\u4ee5\u4e0b\u8bb0 $f_i = [x^i]f(x)$\u3002\n\n$$\\begin{aligned}\nf(x+k)\n&=\\sum_{i=0}^nf_i(x+k)^i\n\\\\&=\\sum_{i=0}^nf_i\\sum_{j=0}^i\\binom{i}{j}x^jk^{i-j}\n\\\\&=\\sum_{j=0}^nx^j\\sum_{i=j}^nf_i\\dfrac{i!}{j!(i-j)!}k^{i-j}\n\\\\&=\\sum_{j=0}^n\\dfrac{x^j}{j!}\\sum_{i=j}^nf_ii!\\cdot\\dfrac{k^{i-j}}{(i-j)!}\n\\end{aligned}$$\n\n\u8bb0 $F_i = f_ii!$\uff0c$G_i = \\dfrac{k^i}{i!}$\u3002\n\n$$\\begin{aligned}\nf(x+k)\n&=\\sum_{j=0}^n\\dfrac{x^j}{j!}\\sum_{i=j}^nF_iG_{i-j}\n\\\\&=\\sum_{j=0}^n\\dfrac{x^j}{j!}\\sum_{i=0}^{n-j}F_{i+j}G_{i}\n\\end{aligned}$$\n\n\u770b\u5230\u8fd9\u79cd\u5f62\u5f0f\u7684\u5377\u79ef\uff0c\u7ecf\u5178\u5957\u8def\uff0c\u8bb0 $H_i = F_{n-i}$\u3002\n\n$$\\begin{aligned}\nf(x+k)\n&=\\sum_{j=0}^n\\dfrac{x^j}{j!}\\sum_{i=0}^{n-j}H_{n-j-i}G_i\n\\end{aligned}$$\n\n\u6807\u51c6\u5377\u79ef\u5f0f\uff0c\u4e0d\u59a8\u8bbe $W = H * G$\u3002\n\n$$\\begin{aligned}\nf(x+k)\n&=\\sum_{j=0}^n\\dfrac{W_{n-j}}{j!}x^j\n\\end{aligned}$$\n\n\u7136\u540e\u518d\u548c $f(x)$ \u5377\u79ef\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u5173\u4e8e\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\uff0c\u663e\u7136\u6709\uff1a\n\n$$T(n)=T(\\dfrac{n}{2})+O(n\\log n)$$\n\n\u6839\u636e\u4e3b\u5b9a\u7406\u53ef\u5f97\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\nover.\n\n---\n\n### $Code:$\n\n\u6ce8\u610f\u6a21\u6570\u4e0d\u662f $998244353$\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#include <cmath>\n#include <vector>\n#include <queue>\n#include <map>\n#include <set>\nusing namespace std;\n#define ll long long\n#define ull unsigned long long\n#define fi first\n#define se second\n#define dingyi int mid = l + r >> 1, ls = p << 1, rs = p << 1 | 1\n#define y0 y_csyakioi_0\n#define y1 y_csyakioi_1\n#define rep(i, x, y) for(int i = x; i <= y; ++i)\n#define per(i, x, y) for(int i = x; i >= y; --i)\n#define repg(i, u) for(int i = head[u]; i; i = e[i].nxt)\ninline int read(){\n\tint x = 0, f = 1; char ch = getchar();\n\twhile(ch < '0' || ch > '9'){ if(ch == '-') f = -1; ch = getchar(); }\n\twhile(ch >= '0' && ch <= '9'){ x = x * 10 + (ch ^ 48); ch = getchar(); }\n\treturn x * f;\n}\nconst int N = 1 << 20, mod = 167772161, g_ = 3, invg = 55924054;\nint n, r[N], rev, e[N], S[N], B[N], fac[N], inv[N], a[N], b[N], f[N];\ninline int fpow(int x, int p){ int ans = 1; for(; p; p >>= 1, x = 1ll * x * x % mod) if(p & 1) ans = 1ll * ans * x % mod; return ans; }\ninline void clr(int *A, int x){ memset(A, 0, sizeof(int)*x); }\ninline void cpy(int *A, int *B, int x){ memcpy(A, B, sizeof(int)*x); }\ninline void NTT(int typ, int *a, int lim){\n\tif(rev != lim){ rev = lim; rep(i, 0, lim - 1) r[i] = (r[i >> 1] >> 1) | ((i & 1) ? (lim >> 1) : 0); }\n\trep(i, 0, lim - 1) if(i < r[i]) swap(a[i], a[r[i]]);\n\tfor(int mid = 1; mid < lim; mid <<= 1){\n\t\tint R = mid << 1, rt = fpow(typ == 1 ? g_ : invg, (mod - 1) / R);\n\t\tfor(int j = 0; j < lim; j += R){\n\t\t\tint w = 1;\n\t\t\tfor(int k = 0; k < mid; ++k, w = 1ll * w * rt % mod){\n\t\t\t\tint x = a[j | k], y = 1ll * w * a[j | k | mid] % mod;\n\t\t\t\ta[j | k] = (x + y) % mod; a[j | k | mid] = (x - y + mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ < 0){ int k = fpow(lim, mod - 2); rep(i, 0, lim - 1) a[i] = 1ll * a[i] * k % mod; }\n}\ninline void ptm(int *A, int *B, int len){ rep(i, 0, len - 1) A[i] = 1ll * A[i] * B[i] % mod; }\ninline void print(int *A, int len){ rep(i, 0, len - 1) printf(\"%d \", A[i]); puts(\"\"); }\ninline void Rev(int *A, int len){ rep(i, 0, len - 1 >> 1) swap(A[i], A[len - 1 - i]); }\ninline void Polymul(int *A, int *B, int len, int m){\n\tint lim = 1; while(lim < len) lim <<= 1;\n\tcpy(e, B, lim); clr(e + m, lim - m);\n\tNTT(1, A, lim); NTT(1, e, lim); ptm(A, e, lim);\n\tNTT(-1, A, lim); clr(A + m, lim - m);\n}\ninline void initfac(int n){\n\tfac[0] = 1;\n\trep(i, 1, n) fac[i] = 1ll * fac[i - 1] * i % mod;\n\tinv[n] = fpow(fac[n], mod - 2);\n\tper(i, n - 1, 0) inv[i] = 1ll * inv[i + 1] * (i + 1) % mod;\n}\ninline void PolyS1h(int *A, int len){\n\tif(len == 1){ A[1] = 1; return; }\n\tif(len & 1){\n\t\tPolyS1h(A, len - 1);\n\t\tper(i, len, 1) A[i] = (A[i - 1] + 1ll * A[i] * (len - 1) % mod) % mod;\n\t\tA[0] = 1ll * A[0] * (len - 1) % mod; return;\n\t}\n\tint n = len >> 1, nw = 1;\n\tPolyS1h(A, n); rep(i, 0, n) a[i] = 1ll * A[i] * fac[i] % mod, \n\tb[i] = 1ll * nw * inv[i] % mod, nw = 1ll * nw * n % mod; Rev(a, n + 1);\n\tPolymul(a, b, n + 1 << 1, n + 1);\n\trep(i, 0, n) f[i] = 1ll * a[n - i] * inv[i] % mod;\n\tPolymul(A, f, n + 1 << 1, len + 1);\n\tint lim = 1; while(lim < (n + 1 << 1)) lim <<= 1;\n\tclr(a + n + 1, lim - n - 1); clr(b + n + 1, lim - n - 1);\n\tclr(f + n + 1, lim - n - 1);\n}\ninline void mian(){\n\tn = read(); initfac(n << 1);\n\tPolyS1h(S, n); print(S, n + 1);\n}\nsigned main(){ int qwq = 1; while(qwq--) mian(); return 0; }\n```\n",
        "postTime": 1612419541,
        "uid": 147999,
        "name": "Warriors_Cat",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5408 \u3010\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "### \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u7684\u6027\u8d28\n* $ \\begin{bmatrix}n\\\\1\\end{bmatrix}=(n-1)! $\uff0c\u628a $n$ \u4e2a\u7403\u5212\u5206\u4e3a $1$ \u4e2a\u73af\uff0c\u65b9\u6848\u6570\u5373\u4e3a $n$ \u4e2a\u6570\u7684\u73af\u6392\u5217 $(n-1)!$\u3002\n\n\u5b9a\u4e49 $x^{\\underline{n}}$ \u4e3a $x$ \u7684\u4e0b\u964d\u5e42\uff0c\u5373 $\\prod_{i=0}^{n-1}(x-i)$\uff0c$x^{\\overline{n}}$ \u4e3a $x$ \u7684\u4e0a\u5347\u5e42\uff0c\u5373 $\\prod_{i=0}^{n-1}(x+i)$\u3002\n* $x^{\\underline{n}}=\\sum_{i=1}^{n}(-1)^{n-i}\\begin{bmatrix}n\\\\i\\end{bmatrix}x^{i}$\n\n> \u8bc1\u660e\u5982\u4e0b\uff1a\n\u5f53 $n=1$ \u65f6\uff0c$x^{\\underline{n}}=(-1)^{0}x=x$\uff0c\u663e\u7136\u6210\u7acb\u3002\n\n> \u82e5 $n=k$ \u65f6\u6210\u7acb\uff0c\u5219\u5f53 $n=k+1$ \u65f6\uff1a\n$$x^{\\underline{k+1}}=(x-k)x^{\\underline{k}}$$\n$$=(x-k)\\sum_{i=1}^{k}(-1)^{k-i}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i}$$\n$$=\\sum_{i=1}^{k}(-1)^{k-i}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i+1}-k\\sum_{i=1}^{k}(-1)^{k-i}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i}$$\n$$=\\sum_{i=0}^{k}(-1)^{k-i}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i+1}-k\\sum_{i=1}^{k}(-1)^{k-i}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i}$$\n$$=\\sum_{i=1}^{k+1}(-1)^{k-i+1}\\begin{bmatrix}k\\\\i-1\\end{bmatrix}x^{i}+k\\sum_{i=1}^{k}(-1)^{k-i+1}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i}$$\n$$=x^{k+1}+\\sum_{i=1}^{k}(-1)^{k-i+1}\\begin{bmatrix}k\\\\i-1\\end{bmatrix}x^{i}+k\\sum_{i=1}^{k}(-1)^{k-i+1}\\begin{bmatrix}k\\\\i\\end{bmatrix}x^{i}$$\n$$=x^{k+1}+\\sum_{i=1}^{k}(-1)^{k-i+1}\\begin{bmatrix}k+1\\\\i\\end{bmatrix}x^{i}$$\n$$=\\sum_{i=1}^{k+1}(-1)^{k+1-i}\\begin{bmatrix}k+1\\\\i\\end{bmatrix}x^{i}$$\n\n* $x^{\\overline{n}}=\\sum_{i=1}^{n}\\begin{bmatrix}n\\\\i\\end{bmatrix}x^{i}$\uff0c\u8bc1\u660e\u65b9\u5f0f\u4e0e\u4e0b\u964d\u5e42\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002\n\n* $\\sum_{i=1}^{n}\\begin{bmatrix}n\\\\i\\end{bmatrix}=n!$\uff0c\u5728\u4e0a\u5347\u5e42\u516c\u5f0f\u4e2d\uff0c\u4ee4 $x=1$ \u53ef\u5f97\u3002\n\n### \u6c42\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\n\u76f8\u4fe1 $O(n^2)$ \u7684\u9012\u63a8\u5927\u5bb6\u90fd\u77e5\u9053\u3002\n\n\u4e0b\u9762\u4ecb\u7ecd\u4e00\u79cd $O(nlogn)$ \u6c42\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u67d0\u4e00\u884c\u7684\u65b9\u6cd5\uff1a\n\n\u4e0d\u96be\u53d1\u73b0 $x^{\\overline{n}}$\uff0c\u5373\u4e3a $\\begin{bmatrix}n\\\\i\\end{bmatrix}$ \u7684\u751f\u6210\u51fd\u6570\uff0c\u53c8\u56e0\u4e3a\u6709 $x^{\\overline{2n}}=x^{\\overline{n}}(x+n)^{\\overline{n}}$\uff0c\u8003\u8651\u7528\u5206\u6cbb\u7684\u65b9\u5f0f\u6765\u6c42 $x^{\\overline{n}}$\u3002\n\n\u4ee4 $F_n(x)=x^{\\overline{n}}=\\sum_{i=0}^{n}\\begin{bmatrix}n\\\\i\\end{bmatrix}x^{i}$\uff0c\u6709\uff1a\n$$F_n(x+n)=\\sum_{i=0}^{n}\\begin{bmatrix}n\\\\i\\end{bmatrix}(x+n)^{i}$$\n$$=\\sum_{i=0}^{n}\\begin{bmatrix}n\\\\i\\end{bmatrix}\\sum_{j=0}^{i}\\begin{pmatrix}i\\\\j\\end{pmatrix}x^{j}n^{i-j}$$\n$$=\\sum_{j=0}^{n}\\frac{x^{j}}{j!}\\sum_{i=j}^{n}\\begin{bmatrix}n\\\\i\\end{bmatrix}i!\\frac{n^{i-j}}{(i-j)!}$$\n~~\u8fd9\u4e2a\u67ff\u5b50\u662f\u4e0d\u662f\u770b\u8d77\u6765\u5f88\u597d\u6c42\uff1f~~\n\n\u4ee4 $a_i=\\begin{bmatrix}n\\\\i\\end{bmatrix}i!$\uff0c$b_i=\\dfrac{n^{i}}{i!}$\uff0c\u5219\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n$$=\\sum_{j=0}^{n}\\frac{x^{j}}{j!}\\sum_{i=j}^{n}a_ib_{i-j}$$\n$$=\\sum_{j=0}^{n}\\frac{x^{j}}{j!}\\sum_{i-k=j}a_ib_k$$\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u67ff\u5b50\u540e\u534a\u90e8\u5206\u5f88\u50cf\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\u3002\u53ea\u53ef\u60dc\u4e0d\u662f $i+k=j$\uff0c\u8fd9\u65f6\u5019\u53ea\u9700\u628a $b$ \u6570\u7ec4\u7ffb\u8f6c\u8fc7\u6765\u6c42\u4e00\u6b21FFT\uff0c\u518d\u628a\u6240\u6c42\u7b54\u6848\u5f80\u5de6\u79fb $n$ \u4f4d\u5373\u53ef\u7b97\u51fa $F_n(x+n)$\u3002\n\u81f3\u6b64 $F_n(x+n)$ \u5c31\u53ef\u4ee5\u7528 $F_n(x)$ \u6765\u8ba1\u7b97\uff0c\u800c $F_{2n}(x)$ \u5c31\u662f $F_n(x)$ \u4e0e $F_n(x+n)$ \u7684\u5377\u79ef\uff0c\u5206\u6cbb\u5373\u53ef\u3002\u5982\u679c\u611f\u89c9\u6709\u70b9\u7cca\uff0c\u53ef\u4ee5\u770b\u770b\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n#include <algorithm>\n#define re register\nusing namespace std;\ntypedef long long LL;\nconst LL mod = 167772161LL;\nconst int N = 4e5 + 5;\nLL g, gi, a[N], b[N], f[N], rev[N], fac[N], inv[N];\nint n, l, li;\nLL ksm(LL a, LL n) {\n\tLL res = 1LL, b = a;\n\tfor(; n; n >>= 1LL, b = b * b % mod)\n\t\tif(n & 1LL) res = res * b % mod;\n\treturn res;\n}\nvoid NTT(LL *A, bool op, int lim) {\n\tfor(re int i = 0; i < lim; ++i)\n\t\tif(i < rev[i]) swap(A[i], A[rev[i]]);\n\tfor(re int m = 1; m < lim; m <<= 1) {\n\t\tLL wn = ksm(op ? g : gi, (mod - 1LL) / (m << 1LL));\n\t\tfor(re int L = m << 1, i = 0; i < lim; i += L) {\n\t\t\tLL w = 1LL;\n\t\t\tfor(re int j = 0; j < m; ++j, w = w * wn % mod) {\n\t\t\t\tLL x = A[i + j], y = w * A[i + m + j] % mod;\n\t\t\t\tA[i + m + j] = (x - y + mod) % mod;\n\t\t\t\tA[i + j] = (x + y) % mod;\n\t\t\t} \n\t\t}\n\t}\n}\nvoid solve(int x) {\n\tif(x == 1) { f[1] = 1; return ; }\n\tsolve(x >> 1); int n = x >> 1; LL ba = 1LL;\n\t\n\t// \u6c42\u51faa\u6570\u7ec4\u548cb\u6570\u7ec4\n\tfor(re int i = 0; i <= n; ++i) a[i] = f[i] * fac[i] % mod;\n\tfor(re int i = 0; i <= n; ++i, ba = ba * n % mod) b[i] = ba * inv[i] % mod;\n\t\n\t// \u628ab\u6570\u7ec4\u7ffb\u8f6c\uff0c\u6c42a\uff0cb\u7684\u5377\u79ef\n\tfor(re int i = 0; i <= n / 2; ++i) swap(b[i], b[n - i]);\n\tli = 1; l = 0; while(li <= 2 * n) li <<= 1, ++l;\n\tfor(re int i = 0; i < li; ++i)\n\t\trev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (l - 1));\n\tfor(re int i = n + 1; i < li; ++i) a[i] = b[i] = 0;\n\tNTT(a, 1, li); NTT(b, 1, li);\n\tfor(re int i = 0; i < li; ++i) a[i] = a[i] * b[i];\n\tNTT(a, 0, li); LL invli = ksm(li, mod - 2LL);\n\t\n\t// \u628a\u6c42\u51fa\u7684Fn(x+n)\u5411\u5de6\u79fbn\u4f4d\n\tfor(re int i = 0; i <= n; ++i) a[i] = a[i + n] * invli % mod;\n\t\n\t// \u6c42Fn(x)\u548cFn(x+n)\u7684\u5377\u79ef\n\tfor(re int i = n + 1; i <= 2 * n; ++i) a[i] = 0;\n\tfor(re int i = 0; i <= n; ++i) a[i] = a[i] * inv[i] % mod;\n\tNTT(f, 1, li); NTT(a, 1, li);\n\tfor(re int i = 0; i < li; ++i) f[i] = f[i] * a[i] % mod;\n\tNTT(f, 0, li);\n\tfor(re int i = 0; i <= 2 * n; ++i) f[i] = f[i] * invli % mod;\n\t\n\t// \u5982\u679cn\u4e0d\u80fd\u88ab\u4e8c\u6574\u9664\uff0c\u5219\u9700\u518d\u4e58\u4e00\u4e2a(x+n-1)\uff0c\u4e5f\u5c31\u662f\u628a\u591a\u9879\u5f0f\u5de6\u79fb\u4e00\u4f4d\uff0c\u518d\u52a0\u4e0a\u6bcf\u4e00\u4f4d\u4e58(n-1)\n\t// \u6ce8\u610f\u4e0a\u8ff0\u7684x\u4e0e\u9012\u5f52\u7684x\u4e0d\u540c\uff0c\u8fd9\u91cc\u6307\u591a\u9879\u5f0f\u7684\u81ea\u53d8\u91cf\n\tif(x & 1) {\n\t\tfor(re int i = 2 * n + 1; i >= 1; --i) f[i] = (f[i - 1] + (x - 1) * f[i] % mod) % mod;\n\t\tf[0] = (x - 1) * f[0] % mod;\n\t}\n}\nint main() {\n\tscanf(\"%d\", &n); g = 3LL; gi = ksm(g, mod - 2LL);\n\tfac[0] = fac[1] = inv[0] = inv[1] = 1LL;\n\tfor(re int i = 2; i <= n; ++i) {\n\t\tfac[i] = fac[i - 1] * i % mod;\n\t\tinv[i] = (mod - mod / i) * inv[mod % i] % mod;\n\t}\n\tfor(re int i = 2; i <= n; ++i)\n\t\tinv[i] = inv[i - 1] * inv[i] % mod;\n\tsolve(n);\n\tfor(re int i = 0; i <= n; ++i)\n\t\tprintf(\"%lld \", f[i]);\n\tputs(\"\");\n\treturn 0;\n}\n```\n\u5411\u5b66\u4e60\u66f4\u591a\u65af\u7279\u6797\u6570\u7684\u829d\u58eb\u53ef\u4ee5\u770b[\u8fd9\u4e2a](https://www.luogu.com.cn/blog/oylyer/se-te-lin-shuo-ji-si-te-lin-fan-yan-yang-xie)",
        "postTime": 1635399988,
        "uid": 165375,
        "name": "Fast_Gai_Tle",
        "ccfLevel": 0,
        "title": "P5408 \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c --- \u9898\u89e3"
    },
    {
        "content": "# \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5408)\n## \u601d\u8def\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u7684\u662f:\n\n$$x^{\\overline n}=\\sum_{i=0}^{n}{\\begin{bmatrix} n \\\\ i\\end{bmatrix}}x^i$$\n\n\u8fd9\u4e2a\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5f52\u7eb3\u6cd5\u8bc1\u660e:\n\n$$x^{\\overline {n+1}}=(\\sum_{i=0}^{n} {\\begin{bmatrix} n \\\\ i\\end{bmatrix}}x^i)(x+n) $$\n\n$$=\\sum_{i=0}^{n} ({\\begin{bmatrix} n \\\\ i-1\\end{bmatrix}}+n{\\begin{bmatrix} n \\\\ i\\end{bmatrix}})x^i$$\n\n$$=\\sum_{i=0}^{n} {\\begin{bmatrix} n+1 \\\\ i\\end{bmatrix}}x^i$$\n\n\u8bc1\u6bd5\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u73b0\u5728\u7684\u76ee\u6807\u5c31\u662f\u6c42\u51fa$x^{\\overline n}$\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u5982\u679c\u6211\u4eec\u4f7f\u7528\u5206\u6cbb$\\text {FFT}$\u662f$\\Theta(n\\log^2n)$\u7684\uff0c\u53ea\u80fd\u5f97\u523020\u5206\u3002\u4ee3\u7801\u5c31\u4e0d\u9644\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u500d\u589e\u3002\u5047\u5982\u6211\u4eec\u73b0\u5728\u5df2\u7ecf\u6c42\u51fa\u4e86$x^{\\overline n}$\uff0c\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u6c42\u51fa$x^{\\overline {2n}}$\u3002\n\n\u53c8\u56e0\u4e3a$x^{\\overline {2n}}=x^{\\overline n}(x+n)^{\\overline n}$\u3002\u4e8e\u662f\uff0c\u95ee\u9898\u5c31\u53d8\u6210\u4e86\uff0c\u6211\u4eec\u5df2\u77e5$f(x)$\uff0c\u95ee\u5982\u4f55\u6c42\u51fa$f(x+n)$\u3002\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$f(x+n)=\\sum_{i=0}^{n} f_i (x+n)^i$$\n\n$$\\Rightarrow f(x+n)=\\sum_{i=0}^{n} f_i \\sum_{j=0}^{i} \\binom{i}{j} x^{i} n^{i-j}$$\n\n$$\\Rightarrow f(x+n)=\\sum_{j=0}^{n} \\frac{x^j}{j!}\\sum_{i=j}^{n} f_i i!\\frac{n^{i-j}}{(i-j)!}$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u662f\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0c\u770b\u4e0d\u51fa\u6765\u7684\u53ef\u4ee5\u53bb\u505a\u529b\u3002\n\n\u81f3\u4e8e$x^{\\overline {n+1}}$\u76f4\u63a5\u66b4\u529b\u641e\u5c31\u597d\u4e86\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$\\Theta(n\\log n)$\u3002\n## $\\text {Code}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define Int register int\n#define mod 167772161\n#define Gi 55924054\n#define MAXN 562144\n#define G 3\n\nint quick_pow (int a,int b,int c){\n\tint res = 1;\n\twhile (b){\n\t\tif (b & 1) res = 1ll * res * a % c;\n\t\ta = 1ll * a * a % c;\n\t\tb >>= 1;\n\t}\n\treturn res;\n}\n\nint inv (int x){\n\treturn quick_pow (x,mod - 2,mod);\n}\n\nint rev[MAXN];\n\nstruct Poly{\n\tint fre,a[MAXN];\n\tvoid NTT (int type,int logn){\n\t\tint limit = (1 << logn);\n\t\tfor (Int i = 0;i < limit;++ i) if (i < rev[i]) swap (a[i],a[rev[i]]);\n        for (Int mid = 1;mid < limit;mid <<= 1){\n            int Wn = quick_pow (type == 1 ? G : Gi,(mod - 1) / (mid << 1),mod);\n            for (Int R = mid << 1,j = 0;j < limit;j += R){\n                for (Int k = 0,w = 1;k < mid;++ k,w = 1ll * w * Wn % mod){\n                    int x = a[j + k],y = 1ll * w * a[j + k + mid] % mod;\n                    a[j + k] = (x + y) % mod;\n                    a[j + k + mid] = (x + mod - y) % mod;\n                }\n            }\n        } \n        if (type == 1) return ;\n        int Inv = quick_pow (limit,mod - 2,mod);\n        for (Int i = 0;i < limit;++ i) a[i] = 1ll * a[i] * Inv % mod;\n\t}\n\tvoid Putout (){\n\t\tcout << fre << endl;\n\t\tfor (Int i = 0;i <= fre;++ i) cout << a[i] << \" \";\n\t\tcout << endl;\n\t}\n\tPoly operator * (Poly q){\n\t\tPoly New;New.fre = fre + q.fre;\n\t\tint limit = 1,logn = 0;\n\t\twhile (limit <= New.fre) limit <<= 1,logn ++;\n\t\tfor (Int i = 1;i < limit;++ i) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << logn - 1);\n\t\tfor (Int i = fre + 1;i < limit;++ i) a[i] = 0;\n\t\tfor (Int i = q.fre + 1;i < limit;++ i) q.a[i] = 0;\n\t\tNTT (1,logn),q.NTT (1,logn);\n\t\tfor (Int i = 0;i < limit;++ i) New.a[i] = 1ll * a[i] * q.a[i] % mod;\n\t\tNew.NTT (-1,logn);\n\t\treturn New; \n\t}\n\tPoly Inv (int n){\n\t\tPoly Now;Now.fre = n - 1;\n\t\tif (n == 1){\n\t\t\tNow.a[0] = quick_pow (a[0],mod - 2,mod);\n\t\t\treturn Now;\n\t\t}\n\t\tPoly B = Inv ((n + 1) >> 1),C;\n\t\tint limit = 1,logn = 0;\n\t\twhile (limit <= (n << 1)) limit <<= 1,logn ++;\n\t\tfor (Int i = 1;i < limit;++ i) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << logn - 1);\n\t\tC.fre = n - 1;for (Int i = 0;i < n;++ i) C.a[i] = a[i];\n\t\tfor (Int i = n;i < limit;++ i) C.a[i] = 0;\n        for (Int i = B.fre + 1;i < limit;++ i) B.a[i] = 0;\n\t\tC.NTT (1,logn),B.NTT (1,logn);\n\t\tfor (Int i = 0;i < limit;++ i) Now.a[i] = 1ll * B.a[i] * (2 + mod - 1ll * B.a[i] * C.a[i] % mod) % mod;\n\t\tNow.NTT (-1,logn);\n\t\tfor (Int i = n;i < limit;++ i) Now.a[i] = 0;\n\t\treturn Now;\n\t}\n};\n\nint fac[MAXN];\n\nPoly Solve (int n){\n\tif (n == 1){\n\t\tPoly Now;\n\t\tNow.fre = 1,Now.a[0] = 0,Now.a[1] = 1;\n\t\treturn Now;\n\t}\n\tif (n & 1){\n\t\tPoly Now,Las = Solve (n - 1);\n\t\tNow.fre = Las.fre + 1;\n\t\tfor (Int i = 1;i <= Now.fre;++ i) Now.a[i] = Las.a[i - 1];\n\t\tfor (Int i = 0;i < Now.fre;++ i) Now.a[i] = (Now.a[i] + 1ll * (n - 1) * Las.a[i] % mod) % mod;\n\t\treturn Now; \n\t}\n\telse{\n\t\tPoly Now,Las = Solve (n >> 1),f,g;\n\t\tf.fre = g.fre = Now.fre = n >> 1;\n\t\tfor (Int i = 0;i <= f.fre;++ i) \n\t\t\tf.a[i] = 1ll * Las.a[f.fre - i] * fac[f.fre - i] % mod, \n\t\t\tg.a[i] = 1ll * quick_pow (f.fre,i,mod) * inv (fac[i]) % mod;\n\t\tf = f * g;\n\t\tfor (Int i = 0;i <= Now.fre;++ i) Now.a[i] = 1ll * inv (fac[i]) * f.a[Now.fre - i] % mod;\n\t\tNow = Now * Las;\n\t\treturn Now;\n\t}\n} \n\ntemplate <typename T> inline void read (T &t){t = 0;char c = getchar();int f = 1;while (c < '0' || c > '9'){if (c == '-') f = -f;c = getchar();}while (c >= '0' && c <= '9'){t = (t << 3) + (t << 1) + c - '0';c = getchar();} t *= f;}\ntemplate <typename T,typename ... Args> inline void read (T &t,Args&... args){read (t);read (args...);}\ntemplate <typename T> inline void write (T x){if (x < 0){x = -x;putchar ('-');}if (x > 9) write (x / 10);putchar (x % 10 + '0');}\n\nPoly A;\n\nsigned main(){\n\tint n;read (n);fac[0] = 1;\n\tfor (Int i = 1;i <= n;++ i) fac[i] = 1ll * fac[i - 1] * i % mod;\n\tA = Solve (n);\n\tfor (Int i = 0;i <= n;++ i) write (A.a[i]),putchar (' ');\n\tputchar ('\\n');\n\treturn 0; \n}\n```",
        "postTime": 1591769330,
        "uid": 124781,
        "name": "Walking_Dead",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5408 \u3010\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "$$\\texttt{Foreword}$$\n\n\u53d1\u73b0\u8ba8\u8bba\u533a\u6709\u4eba\u7528 $\\Theta(n \\log ^ 2 n)$ \u7684\u5206\u6cbb $\\text{NTT}$ \u8fc7\u4e86\u8fd9\u9898\uff0c\u4f5c\u6b7b\u5c1d\u8bd5\u4e86\u4e00\u53d1\u53ea\u6709 $70\\ \\text{pts}$\uff0c\u679c\u7136\u6211\u7684\u5e38\u6570\u8fd8\u662f\u90a3\u4e48\u5927 ~~\uff08\u9003~~\n\n$$\\texttt{Description}$$\n\n[P5408 \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c](https://www.luogu.com.cn/problem/P5408)\n\n$$\\texttt{Solution}$$\n\n\u6839\u636e\u4e0a\u5347\u5e42\u7684\u5c55\u5f00\u5f0f\uff1a\n\n$$x ^ {\\overline{n}} = \\sum_{i = 0} ^ n \\begin{bmatrix} n \\\\ i \\end{bmatrix} x ^ i$$\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u591a\u9879\u5f0f\uff1a\n\n$$\\prod_{i = 0} ^ {n - 1} (x + i)$$\n\n\u7684\u6bcf\u4e00\u9879\u7cfb\u6570\u5373\u53ef\u3002\n\n\u9996\u5148\u6709\u4e00\u79cd\u663e\u7136\u7684 $\\Theta(n \\log ^ 2 n)$ \u7684\u5206\u6cbb $\\text{NTT}$ \u7684\u505a\u6cd5\uff0c\u4f46\u662f\u5728\u672c\u9898\u9700\u8981\u4f18\u79c0\u5730\u5b9e\u73b0\u624d\u80fd\u901a\u8fc7\u3002\n\n\u8fd8\u6709\u4e00\u79cd $\\Theta(n \\log n)$ \u7684\u500d\u589e\u505a\u6cd5\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u5982\u4e0b\u4e24\u79cd\u53d8\u6362\uff1a\n\n+ $x ^ {\\overline{n}} \\to x ^ {\\overline{n + 1}}$\n\n+ $x ^ {\\overline{n}} \\to x ^ {\\overline{2n}}$\n\n\u7b2c\u4e00\u79cd\u53d8\u6362\u663e\u7136\u662f\u7ed9\u539f\u591a\u9879\u5f0f\u4e58\u4e86 $(x + n)$\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n)$\u3002\n\n\u8003\u8651\u7b2c\u4e8c\u79cd\u53d8\u6362\uff0c\u663e\u7136 $x ^ {\\overline{2n}} = x ^ {\\overline{n}} {(x + n)} ^ {\\overline{n}}$\u3002\n\n\u8003\u8651\u6c42\u51fa\u7528\u5df2\u77e5\u7684 $x ^ {\\overline{n}}$ \u6c42\u51fa ${(x + n)} ^ {\\overline{n}}$\uff0c\u7136\u540e\u4e24\u4e2a\u591a\u9879\u5f0f\u76f8\u4e58\u5373\u53ef\u3002\n\n\u5047\u8bbe\uff1a\n\n$$x ^ {\\overline{n}} = \\sum_{i = 0} ^ n f_i \\cdot x ^ i$$\n\n\u5219\u6211\u4eec\u8981\u6c42\u51fa\uff1a\n\n$$\\sum_{i = 0} ^ n f_i \\cdot {(x + n)} ^ i = \\sum_{i = 0}^n \\sum_{j = 0}^i x ^ j \\cdot n ^ {i - j} \\cdot {i \\choose j} \\cdot f_j$$\n\n$$= \\sum_{i = 0}^n x ^ i \\sum_{j = i}^n f_j \\cdot {j \\choose i} \\cdot n ^ {j - i}$$\n\n$$= \\sum_{i = 0}^n x ^ i \\sum_{j = i}^n \\dfrac{j!}{i! (j - i)!} \\cdot f_j \\cdot n ^ {j - i}$$\n\n$$= \\sum_{i = 0}^n \\dfrac{x ^ i}{i!} \\cdot \\sum_{j = i} ^ n (j! \\cdot f_j) \\cdot \\dfrac{n ^ {j - i}}{(j - i)!}$$\n\n\u660e\u663e\u8fd9\u662f\u4e00\u4e2a\u5dee\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u5c06\u5377\u79ef\u7684\u7b2c\u4e00\u9879\u7ffb\u8f6c\u8fc7\u6765\uff0c\u7136\u540e\u5c31\u53ef\u4ee5 $\\text{NTT}$ \u5904\u7406\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $T(n) = T(\\dfrac{n}{2}) + \\Theta(n \\log n) = \\Theta(n \\log n)$\u3002\n\n$$\\texttt{Code}$$\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\nusing poly = vector <int>;\n\nconstexpr int mod = 167772161;\n\nint n, rev[800005], fac[400005], ifac[400005];\n\nint qpow(int x, int p) {\n\tint ans = 1;\n\twhile (p) {\n\t\tif (p & 1) ans = 1ll * ans * x % mod;\n\t\tp >>= 1, x = 1ll * x * x % mod;\n\t}\n\treturn ans;\n}\n\nvoid ntt(poly &a, int inv, int len) {\n\tfor (int i = 0; i < len; ++i) {\n\t\tif (i < rev[i]) {\n\t\t\tswap(a[i], a[ rev[i] ]);\n\t\t}\n\t}\n\tint g = 3, ginv = qpow(g, mod - 2);\n\tfor (int mid = 1; mid < len; mid <<= 1) {\n\t\tint gn = qpow(inv == 1 ? g : ginv, (mod - 1) / (mid << 1));\n\t\tfor (int i = 0; i < len; i += mid << 1) {\n\t\t\tfor (int j = 0, g0 = 1; j < mid; ++j, g0 = 1ll * g0 * gn % mod) {\n\t\t\t\tint g1 = a[ i + j ], g2 = 1ll * a[ i + j + mid ] * g0 % mod;\n\t\t\t\ta[ i + j ] = (g1 + g2) % mod;\n\t\t\t\ta[ i + j + mid ] = (g1 - g2 + mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n}\n\npoly shr(poly f, int n) {\n\tint len = 1, lg = 0;\n\twhile (len <= 2 * n) {\n\t\tlen <<= 1, ++lg;\n\t}\n\tfor (int i = 0; i < len; ++i) {\n\t\trev[i] = (rev[ i >> 1 ] >> 1) | ((i & 1) << (lg - 1));\n\t}\n\tpoly a(len, 0), b(len, 0);\n\tfor (int i = 0, pw = 1; i <= n; ++i, pw = 1ll * pw * n % mod) {\n\t\ta[ n - i ] = 1ll * f[i] * fac[i] % mod;\n\t\tb[i] = 1ll * pw * ifac[i] % mod;\n\t}\n\tntt(a, 1, len), ntt(b, 1, len);\n\tfor (int i = 0; i < len; ++i) {\n\t\ta[i] = 1ll * a[i] * b[i] % mod;\n\t}\n\tntt(a, -1, len);\n\tint inv = qpow(len, mod - 2);\n\tpoly g(len, 0);\n\tfor (int i = 0; i <= n; ++i) {\n\t\tg[ n - i ] = 1ll * a[i] * inv % mod;\n\t}\n\tfor (int i = 0; i <= n; ++i) {\n\t\tg[i] = 1ll * g[i] * ifac[i] % mod;\n\t}\n\tf.resize(len, 0);\n\tntt(f, 1, len), ntt(g, 1, len);\n\tfor (int i = 0; i < len; ++i) {\n\t\tf[i] = 1ll * f[i] * g[i] % mod;\n\t}\n\tntt(f, -1, len);\n\tfor (int i = 0; i <= 2 * n; ++i) {\n\t\tf[i] = 1ll * f[i] * inv % mod;\n\t}\n\tf.resize(2 * n + 1);\n\treturn f;\n}\n\npoly setbit(poly f, int n) {\n\tpoly g(n + 2, 0);\n\tfor (int i = 1; i <= n + 1; ++i) {\n\t\tg[i] = f[ i - 1 ];\n\t}\n\tfor (int i = 0; i <= n; ++i) {\n\t\tg[i] = (1ll * g[i] + 1ll * f[i] * n) % mod;\n\t}\n\treturn g;\n}\n\npoly solve(int n) {\n\tif (n == 1) {\n\t\tpoly g(2, 0);\n\t\tg[1] = 1;\n\t\treturn g;\n\t}\n\tpoly g = solve(n / 2);\n\tg = shr(g, n / 2);\n\tif (n & 1) {\n\t\tg = setbit(g, n - 1);\n\t}\n\treturn g;\n}\n\nint main() {\n\tios :: sync_with_stdio(0), cin.tie(0);\n\tcin >> n;\n\tfac[0] = 1;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tfac[i] = 1ll * fac[ i - 1 ] * i % mod;\n\t}\n\tifac[n] = qpow(fac[n], mod - 2);\n\tfor (int i = n; i; --i) {\n\t\tifac[ i - 1 ] = 1ll * ifac[i] * i % mod;\n\t}\n\tpoly ans = solve(n);\n\tfor (int i = 0; i <= n; ++i) {\n\t\tcout << ans[i] << \" \\n\" [ i == n ];\n\t}\n\treturn 0;\n}\n```\n\n$$\\texttt{Thanks for watching!}$$",
        "postTime": 1672664980,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "P5408 \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c"
    },
    {
        "content": "\u8003\u8651\u65b0\u52a0\u5165\u4e00\u4e2a\u6570\uff0c\u8981\u4e48\u65b0\u5f00\u4e00\u4e2a\u73af\uff0c\u8981\u4e48\u653e\u4e4b\u524d\u7684\u73af\u91cc\u9762\uff0c\u4e0d\u96be\u5f97\u5230\u9012\u63a8\u5f0f\n$$\n\\left[\\begin{matrix}n+1\\\\m\\end{matrix}\\right]=\\left[\\begin{matrix}n\\\\m-1\\end{matrix}\\right]+n\\left[\\begin{matrix}n\\\\m\\end{matrix}\\right]\n$$\n\u5199\u6210\u751f\u6210\u51fd\u6570\u5c31\u662f\n$$\nF_n(x)=\\sum_{i=0}^n\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right]x^i\n$$\n\u6839\u636e\u4e0a\u9762\u7684\u8f6c\u79fb\uff0c\u5c31\u6709\n$$\nF_{n+1}(x)=(x+n)F_n(x)\n$$\n\u7ed3\u5408 $F_0(x)=1$\uff0c\u5c31\u662f $F_n(x)=x^{\\overline n}$\n\u7136\u540e\u4f60\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $O(n\\log^2 n)$ \u7684\u5206\u6cbb\u505a\u6cd5\uff1a\n```cpp\nint solve(int l,int r){\n\tif(l==r){\n\t\tf[stk[top]][0]=l-1;\n\t\tf[stk[top]][1]=1;\n\t\treturn stk[top--];\n\t}\n\tint mid=l+r>>1,L,R;\n\tL=solve(l,mid); R=solve(mid+1,r);\n\tmul(f[L],f[R],mid-l+1,r-mid); stk[++top]=R;\n\treturn L;\n}\n```\n~~\u5f53\u7136\u8fd9\u662f\u8d85\u65f6\u7684~~\uff0c\u7ee7\u7eed\u63a8\u5f0f\u5b50\u3002\n\n\u8003\u8651\u500d\u589e\u505a\u6cd5\u3002\u73b0\u5728\u8981\u4ece $x^{\\overline n}$ \u8f6c\u79fb\u5230 $x^{\\overline{2n}}$\n\n$$\nx^{\\overline{2n}}=\\prod_{i=0}^{2n-1}(x+i)=\\prod_{i=0}^{n-1}(x+i)\\prod_{i=n}^{2n-1}(x+n+i)=x^{\\overline n}(x+n)^{\\overline n}\n$$\n\u95ee\u9898\u8f6c\u5316\u4e3a\u5df2\u77e5 $x^{\\overline n}=\\sum_{i=0}^nf_ix^i$ \u6c42\u89e3 $(x+n)^{\\overline n}$\n\n$$\n\\begin{aligned}\n(x+n)^{\\overline n}\n&=\\sum_{i=0}^{n}f_i(x+n)^i\\\\\n&=\\sum_{i=0}^{n}f_i\\sum_{j=0}^i\\left(\\begin{matrix}i\\\\j\\end{matrix}\\right)x^jn^{i-j}\\\\\n&=\\sum_{j=0}^{n}x^j\\sum_{i=j}^{n}\\left(\\begin{matrix}i\\\\j\\end{matrix}\\right)f_in^{i-j}\\\\\n&=\\sum_{j=0}^{n}x^j\\sum_{i=j}^{n}\\frac{i!}{j!(i-j)!}f_in^{i-j}\\\\\n&=\\sum_{j=0}^{n}x^j\\frac1{j!}\\sum_{i=j}^{n}i!f_i\\frac{n^{i-j}}{(i-j)!}\n\\end{aligned}\n$$\n\u5148\u5377\u79ef\u4e00\u4e0b\uff0c\u518d\u5377\u79ef\u4e00\u4e0b\u5c31\u597d\u4e86\n```cpp\n#include<iostream>\n#include<cstdio>\n#define mod 167772161\nusing namespace std;\nint G[2];\nint fac[500001],invfac[500001],inv[500001];\nint f[500001],g[500001],h[500001];\nvoid init(int n){\n\tfac[0]=invfac[0]=inv[1]=fac[1]=invfac[1]=1;\n\tfor(int i=2;i<=n;i+=1){\n\t\tinv[i]=1ll*inv[mod%i]*(mod-mod/i)%mod;\n\t\tfac[i]=1ll*fac[i-1]*i%mod;\n\t\tinvfac[i]=1ll*invfac[i-1]*inv[i]%mod;\n\t}\n\treturn;\n}\nint qp(int x,int y=mod-2){\n\tif(y==0) return 1;\n\tif(y==1) return x;\n\tint res=qp(x,y>>1);\n\tres=1ll*res*res%mod;\n\tif(y&1) res=1ll*res*x%mod;\n\treturn res;\n}\nint add(int x,int y){\n\tif((x+=y)>=mod) x-=mod;\n\treturn x;\n}\nint sub(int x,int y){\n\tif((x-=y)<0) x+=mod;\n\treturn x;\n}\nvoid NTT(int *a,int n){\n\tint x,y,w,w_n;\n\tfor(int i=(n>>1);i;i>>=1){\n\t\tw_n=qp(G[0],(mod-1)/(i<<1));\n\t\tfor(int j=0;j<n;j+=(i<<1)){\n\t\t\tw=1;\n\t\t\tfor(int k=j;k<i+j;k+=1){\n\t\t\t\tx=a[k]; y=a[k+i];\n\t\t\t\ta[k]=add(x,y); a[k+i]=1ll*sub(x,y)*w%mod;\n\t\t\t\tw=1ll*w*w_n%mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn;\n}\nvoid INTT(int *a,int n){\n\tint x,y,w,w_n;\n\tfor(int i=1;i<n;i<<=1){\n\t\tw_n=qp(G[1],(mod-1)/(i<<1));\n\t\tfor(int j=0;j<n;j+=(i<<1)){\n\t\t\tw=1;\n\t\t\tfor(int k=j;k<i+j;k+=1){\n\t\t\t\tx=a[k]; y=1ll*a[k+i]*w%mod;\n\t\t\t\ta[k]=add(x,y); a[k+i]=sub(x,y);\n\t\t\t\tw=1ll*w*w_n%mod;\n\t\t\t}\n\t\t}\n\t}\n\tx=qp(n);\n\tfor(int i=0;i<n;i+=1) a[i]=1ll*a[i]*x%mod;\n\treturn;\n}\nvoid solve(int n){\n\tint top=0,stk[31],m=1;\n\twhile(n){\n\t\tstk[++top]=(n&1);\n\t\tn>>=1;\n\t}\n\ttop-=1; n=1; f[1]=1;\n\twhile(top){\n\t\tfor(int i=0;i<=n;i+=1) g[i]=1ll*f[i]*fac[i]%mod;\n\t\tfor(int i=0;i<=(n>>1);i+=1) swap(g[i],g[n-i]);\n\t\tfor(int i=0;i<=n;i+=1) h[i]=1ll*qp(n,i)*invfac[i]%mod;\n\t\twhile(m<=(n<<1)) m<<=1;\n\t\tNTT(g,m); NTT(h,m);\n\t\tfor(int i=0;i<m;i+=1) g[i]=1ll*g[i]*h[i]%mod,h[i]=0;\n\t\tINTT(g,m);\n\t\tfor(int i=0;i<=(n>>1);i+=1) swap(g[i],g[n-i]);\n\t\tfor(int i=0;i<=n;i+=1) g[i]=1ll*g[i]*invfac[i]%mod;\n\t\tfor(int i=n+1;i<m;i+=1) g[i]=0;\n\t\tNTT(f,m); NTT(g,m);\n\t\tfor(int i=0;i<m;i+=1) f[i]=1ll*f[i]*g[i]%mod,g[i]=0;\n\t\tINTT(f,m); n<<=1;\n\t\tif(stk[top--]){\n\t\t\tn|=1;\n\t\t\tfor(int i=n;i>=1;i-=1){\n\t\t\t\tf[i]=add(f[i-1],1ll*(n-1)*f[i]%mod);\n\t\t\t}\n\t\t}\n\t}\n\treturn;\n}\nint main(){\n\tint n; G[0]=3; G[1]=qp(G[0]);\n\tscanf(\"%d\",&n);\n\tinit(n); solve(n);\n\tint m=1; while(m<=n) m<<=1;\n\tfor(int i=0;i<=n;i+=1) printf(\"%d \",f[i]);\n\tprintf(\"\\n\");\n\treturn 0;\n}\n```\nThanks~",
        "postTime": 1639460453,
        "uid": 189682,
        "name": "QQ82272760",
        "ccfLevel": 7,
        "title": "P5408 \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c \u9898\u89e3"
    },
    {
        "content": "**\u539f\u9898\u94fe\u63a5**\uff1a[P5408 \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c](https://www.luogu.com.cn/problem/P5408)\u3002\n\n\u672c\u9898\u89e3\u7684\u505a\u6cd5\u65e0\u9700\u53e6\u5199\u500d\u589e\uff0c\u4f46\u5e38\u6570\u8f83\u5927\uff0c\u9700\u8981\u501f\u52a9\u5b9e\u73b0\u4f18\u79c0\u7684\u591a\u9879\u5f0f\u677f\u5b50\u624d\u80fd\u901a\u8fc7\u672c\u9898\u3002\n\n------------\n\n**\u6ce8**\uff1a$[x^n]F(x)$ \u7684\u542b\u4e49\u662f\u63d0\u53d6 $F(x)$ \u4e2d $n$ \u6b21\u9879\u7cfb\u6570\uff0c\u4f8b\u5982 $[x^1](3x^2+2x+1)=2,\\,[x^0]F(x)=F(0)$\u3002\n\n\n------------\n\n\u6211\u4eec\u90fd\u77e5\u9053\uff1a\n\n$$\\sum_{i=0}^n\\begin{bmatrix}n\\\\ i\\end{bmatrix}x^i=\\prod_{i=0}^{n-1}(x+i)$$\n\n\u4e0d\u59a8\u628a\u7cfb\u6570\u90fd\u7ffb\u8f6c\u8fc7\u6765\uff1a\n\n$$\\sum_{i=0}^n\\begin{bmatrix}n\\\\ n-i\\end{bmatrix}x^i=\\prod_{i=0}^{n-1}(1+ix)$$\n\n\u5bf9\u53f3\u5f0f\u53d6\u5bf9\u6570\uff1a\n\n$$\\sum_{i=0}^n\\begin{bmatrix}n\\\\ n-i\\end{bmatrix}x^i=\\exp\\Big(\\sum_{i=1}^{n-1}\\ln(1+ix)\\Big)$$\n\n\u6ce8\u610f\u5230\uff1a\n\n$$\\ln(1+x)=\\sum_{j\\ge 1}\\dfrac{(-1)^{j+1}}{j}x^j$$\n\n\u4ee3\u5165\u53ef\u5f97\uff1a\n\n$$\\sum_{i=0}^n\\begin{bmatrix}n\\\\ n-i\\end{bmatrix}x^i=\\exp\\Big(\\sum_{i=1}^{n-1}\\sum_{j\\ge 1}\\dfrac{(-1)^{j+1}}{j}(ix)^j\\Big)$$\n\n\u4ea4\u6362 $i,j$ \u6c42\u548c\u987a\u5e8f\uff1a\n\n$$\\sum_{i=0}^n\\begin{bmatrix}n\\\\ n-i\\end{bmatrix}x^i=\\exp\\Big(\\sum_{j\\ge 1}\\dfrac{(-1)^{j+1}}{j}x^j\\sum_{i=1}^{n-1}i^j\\Big)$$\n\n\u95ee\u9898\u5c31\u53d8\u6210\u5982\u4f55\u5feb\u901f\u6c42 $\\sum_i$ \u91cc\u9762\u90a3\u5806\u4e1c\u897f\u4e86\u3002\n\n\u8bb0 $I_j=\\sum_{i=1}^{n-1}i^j$\uff0c\u5219\u6709\uff1a\n\n$$\n\\begin{aligned}\n\\dfrac{I_j}{j!}=&\\sum_{i=1}^{n-1}\\dfrac{i^j}{j!}\\\\\n=&\\sum_{i=1}^{n-1}[x^j]e^{ix}\\\\\n=&[x^j]\\sum_{i=1}^{n-1}e^{ix}\\\\\n=&[x^j]\\dfrac{e^{nx}-e^x}{e^x-1}\n\\end{aligned}\n$$\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u6570\u5217 $\\{I_j\\}$ \u7684 $\\text{EGF}$ \u662f $\\dfrac{e^{nx}-e^x}{e^x-1}$\u3002\n\n\u9171\u7d2b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa $I_j$\u3002\u7136\u540e\u5c31\u80fd\u5f97\u77e5 $\\sum_{j\\ge 1}\\frac{(-1)^{j+1}}{j}I_jx^j$\uff0c\u505a\u4e2a $\\exp$ \u5c31\u5b8c\u6210\u4e86\u3002\n\n\n------------\n\n**\u8bc4\u4ef7**\uff1a\n\n\n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log n)$\uff0c\u4f46\u662f\u56e0\u4e3a $\\exp$ \u5bfc\u81f4\u8fd9\u79cd\u65b9\u6cd5\u7684\u5e38\u6570\u5f88\u5927\uff0c\u6240\u4ee5\u4e0d\u5982\u4e0a\u5347\u5e42\u7684\u500d\u589e\u3002\n\n\n",
        "postTime": 1665901599,
        "uid": 375984,
        "name": "\u98de\u96e8\u70df\u96c1",
        "ccfLevel": 6,
        "title": "\u300c\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570 \u00b7 \u884c\u300d\u7684\u53e6\u7c7b\u6c42\u6cd5"
    },
    {
        "content": "\u5b89\u5229\u4e2a\u4eba blog\uff1ahttps://www.cnblogs.com/ET2006/\n\n\u6839\u636e\u4e00\u884c\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u7684 OGF $x^{\\bar{n}}=\\sum\\limits_{i=0}^n\\begin{bmatrix}n\\\\i\\end{bmatrix}x^i$ \u53ef\u77e5\u95ee\u9898\u7b49\u4ef7\u4e8e\u6c42 $x^{\\bar{n}}$ \u7684\u5c55\u5f00\u5f0f\u3002\n\n\u4e0b\u9762\u63a2\u8ba8\u600e\u6837\u6c42 $x^{\\bar{n}}$\uff0c\u9996\u5148\u6ce8\u610f\u5230 $x^{\\bar{n+1}}=x^{\\bar{n}}\\times(x+n)$\uff0c\u6545\u53ef\u4ee5\u5728\u7ebf\u6027\u7684\u65f6\u95f4\u5185\u4ece $x^{\\bar{n}}$ \u8f6c\u79fb\u5230 $x^{\\bar{n+1}}$\u3002\n\n\u800c $x^{\\bar{2n}}=x^{\\bar{n}}\\times (x+n)^{\\bar{n}}$\uff0c\u5982\u679c\u6211\u4eec\u8bb0 $f_n(x)=x^{\\bar{n}}$\uff0c\u90a3\u4e48 $(x+n)^{\\bar{n}}=f_n(x+n)$\uff0c$x^{\\bar{2n}}=f_n(x)f_n(x+n)$\uff0c\u6545\u5982\u679c\u6211\u4eec\u80fd\u5feb\u901f\u5bf9\u4e8e\u5df2\u77e5\u591a\u9879\u5f0f $f(x)$ \u6c42\u51fa $f(x+n)$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u8f83\u77ed\u65f6\u95f4\u5185\u4ece $x^{\\bar{n}}$ \u8f6c\u79fb\u5230 $x^{\\bar{2n}}$\uff0c\u4e5f\u5c31\u53ef\u4ee5\u500d\u589e\u89e3\u51b3\u6b64\u9898\u4e86\u3002\n\n\u6211\u4eec\u8003\u8651\u5047\u8bbe $f(x)$ \u4e3a $n$ \u6b21\u591a\u9879\u5f0f\uff0c\u7cfb\u6570\u5206\u522b\u4e3a $a_0,a_1,\\dots,a_n$\uff0c\u4e0b\u9762\u5c06\u63a8\u5bfc $f(x+c)$ \u7684\u503c\uff1a\n\n$$\\begin{aligned}f(x+c)&=\\sum\\limits_{i=0}^na_i(x+c)^i\\\\&=\\sum\\limits_{i=0}^na_i\\sum\\limits_{j=0}^ic^{i-j}\\dbinom{i}{j}x^j\\\\&=\\sum\\limits_{j=0}^nx^j\\sum\\limits_{i=j}^na_ic^{i-j}\\dbinom{i}{j}\\\\&=\\sum\\limits_{j=0}^nx^j\\sum\\limits_{i=j}^na_ic^{i-j}\\times\\dfrac{i!}{j!(i-j)!}\\\\&=\\sum\\limits_{j=0}^n\\dfrac{x^j}{j!}\\sum\\limits_{i=j}^na_ii!\\times\\dfrac{c^{i-j}}{(i-j)!}\\end{aligned}$$\n\n\u4ee4 $g_i=a_ii!,h_i=\\dfrac{c^i}{i!}$\uff0c\u5219 $f(x+c)=\\sum\\limits_{j=0}^n\\dfrac{x^j}{j!}\\times\\sum\\limits_{x-y=j}g_xh_y$\u3002\u6c42\u4e2a\u5dee\u5377\u79ef\u5373\u53ef\u3002\n\n\u6839\u636e\u4e3b\u5b9a\u7406\u53ef\u77e5\u590d\u6742\u5ea6\u4e3a\u7ebf\u6027\u5bf9\u6570\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntemplate<typename T> void read(T &x){\n\tx=0;char c=getchar();T neg=1;\n\twhile(!isdigit(c)){if(c=='-') neg=-1;c=getchar();}\n\twhile(isdigit(c)) x=x*10+c-'0',c=getchar();\n\tx*=neg;\n}\nconst int pr=3;\nconst int ipr=55924054;\nconst int MAXP=1<<19;\nconst int MOD=167772161;\nint qpow(int x,int e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint n,inv[MAXP+5],prs[MAXP+5][2],rev[MAXP+5];\nint fac[MAXP+5],ifac[MAXP+5];\nvoid init_fac(int n){\n\tfac[0]=1;for(int i=1;i<=n;i++) fac[i]=1ll*fac[i-1]*i%MOD;\n\tifac[n]=qpow(fac[n],MOD-2);for(int i=n-1;~i;i--) ifac[i]=1ll*ifac[i+1]*(i+1)%MOD;\n}\nvoid NTT(int *a,int len,int type){\n\tint lg=log2(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=prs[i][type<0];\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*a[(i>>1)+j+k]*w%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1) for(int i=0;i<len;i++) a[i]=1ll*a[i]*inv[len]%MOD;\n}\nint A[MAXP+5],B[MAXP+5],C[MAXP+5],D[MAXP+5];\nvoid polymul(int *a,int *b,int *c,int len){\n\tint LEN=1;\n\twhile(LEN<=len+len) LEN<<=1;\n\tfor(int i=0;i<LEN;i++) A[i]=B[i]=0;\n//\tprintf(\"a: \");for(int i=0;i<=len;i++) printf(\"%d%c\",a[i],(i==len)?'\\n':' ');\n//\tprintf(\"b: \");for(int i=0;i<=len;i++) printf(\"%d%c\",b[i],(i==len)?'\\n':' ');\n\tfor(int i=0;i<=len;i++) A[i]=a[i],B[i]=b[i];\n\tNTT(A,LEN,1);NTT(B,LEN,1);\n\tfor(int i=0;i<LEN;i++) A[i]=1ll*A[i]*B[i]%MOD;\n\tNTT(A,LEN,-1);\n\tfor(int i=0;i<=(len<<1);i++) c[i]=A[i];\n//\tprintf(\"c: \");for(int i=0;i<=(len<<1);i++) printf(\"%d%c\",c[i],(i==(len<<1))?'\\n':' ');\n}\nint ans[MAXP+5];\nvoid solve(int *f,int n){\n\tif(n==1){f[1]=1;return;}\n\tif(n&1){\n\t\tsolve(f,n-1);\n//\t\tprintf(\"%d: \",n-1);for(int i=0;i<=(n-1);i++) printf(\"%d%c\",f[i],(i==(n-1))?'\\n':' ');\n\t\tfor(int i=n;~i;i--) f[i]=(1ll*f[i]*(n-1)+f[i-1])%MOD;\n\t\treturn;\n\t} else {\n\t\tsolve(f,n>>1);\n//\t\tprintf(\"%d: \",n>>1);for(int i=0;i<=(n>>1);i++) printf(\"%d%c\",f[i],(i==(n>>1))?'\\n':' ');\n\t\tfor(int i=0;i<=(n>>1);i++) C[i]=1ll*f[(n>>1)-i]*fac[(n>>1)-i]%MOD;\n\t\tfor(int i=0;i<=(n>>1);i++) D[i]=1ll*qpow((n>>1),i)*ifac[i]%MOD;\n\t\tpolymul(C,D,C,(n>>1));\n//\t\tprintf(\"C: \");for(int i=0;i<=(n>>1);i++) printf(\"%d%c\",C[i],(i==(n>>1))?'\\n':' ');\n\t\tfor(int i=0;i<=(n>>1);i++) D[i]=1ll*ifac[i]*C[(n>>1)-i]%MOD;\n//\t\tprintf(\"D: \");for(int i=0;i<=(n>>1);i++) printf(\"%d%c\",D[i],(i==(n>>1))?'\\n':' ');\n\t\tpolymul(f,D,f,(n>>1));\n\t}\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=MAXP;i<<=1){\n\t\tprs[i][0]=qpow(pr,(MOD-1)/i);\n\t\tprs[i][1]=qpow(ipr,(MOD-1)/i);\n\t\tinv[i]=qpow(i,MOD-2);\n\t} init_fac(MAXP);solve(ans,n);\n\tfor(int i=0;i<=n;i++) printf(\"%d%c\",ans[i],(i==n)?'\\n':' ');\n\treturn 0;\n}\n```",
        "postTime": 1613134762,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5408 \u3010\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "# \u9898\u89e3 P5408 \u3010\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011\n\n[$\\mathfrak{View\\space it\\space on\\space my\\space Blog}$](https://blog.seniorious.cc/2020/luogu-5408/)\n\n## \u9898\u610f\n\n\u6c42$\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right],i=0,1,\\dots,n$\n\n\u5176\u4e2d$\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right]$\u4e3a\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\uff0c\u7ec4\u5408\u610f\u4e49\u4e3a\u5c06$n$\u4e2a\u4e0d\u540c\u5143\u7d20\u653e\u5165$i$\u4e2a\u76f8\u540c\u5706\u6392\u5217\uff08\u975e\u7a7a\uff09\u7684\u65b9\u6848\u6570\uff0c\u6709\u9012\u63a8\u5f0f$\\left[\\begin{matrix}n\\\\m\\end{matrix}\\right]=\\left[\\begin{matrix}n-1\\\\m-1\\end{matrix}\\right]+\\left[\\begin{matrix}n-1\\\\m\\end{matrix}\\right]\\times(n-1)$\n\n## \u63a8\u5bfc\n\n\u4e00\u4e2a\u7ed3\u8bba\uff1a\n\n$$\\boxed{\\sum\\limits^n_{i=0}\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right]x^i=x^{\\overline{n}}}$$\n\n$x^{\\overline{n}}$\u4e3a$x$\u7684$n$\u6b21\u4e0a\u5347\u5e42\uff0c\u7b49\u4e8e$\\prod\\limits^{n-1}_{i=0}(x+i)$\n\n\u8003\u8651\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\uff1a\n\n1. $n=1$\u65f6\u8be5\u7ed3\u8bba\u663e\u7136\u6210\u7acb\n2. \u8bc1\u660e\u4e3a$n$\u65f6\u6210\u7acb\u5219\u4e3a$n+1$\u65f6\u4e5f\u6210\u7acb\uff1a\n\n$$\\begin{aligned}x^{\\overline{n+1}}&=x^{\\overline{n}}\\times(x+n)\\\\&=(x+n)\\times\\sum\\limits^n_{i=0}\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right]x^i\\\\&=\\sum\\limits^{n+1}_{i=1}\\left[\\begin{matrix}n\\\\i-1\\end{matrix}\\right]x^i+\\sum\\limits^n_{i=0}\\left(n\\times\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right]x^i\\right)\\\\&=\\sum\\limits^{n+1}_{i=0}\\left(\\left[\\begin{matrix}n\\\\i-1\\end{matrix}\\right]+n\\times\\left[\\begin{matrix}n\\\\i\\end{matrix}\\right]\\right)x^i\\\\&=\\sum\\limits^{n+1}_{i=0}\\left[\\begin{matrix}n+1\\\\i\\end{matrix}\\right]x^i\\end{aligned}$$\n\n\u4e8e\u662f\u539f\u547d\u9898\u6210\u7acb\n\n\u76f4\u63a5\u6c42\u4e0a\u5347\u5e42\u662f$O(n^2)$\uff0c\u8003\u8651\u5982\u4f55\u4f18\u5316\uff1a\n\n\u5047\u8bbe$n$\u662f\u5076\u6570\uff1a\n\n$$x^{\\overline{n}}=x^{\\overline{\\frac{n}{2}}}\\times(x+\\frac{n}{2})^{\\overline{\\frac{n}{2}}}$$\n\n\u5982\u679c\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u4e86\u524d\u534a\u90e8\u5206\u5bf9\u5e94\u7684\u591a\u9879\u5f0f$f(x)=x^{\\overline{\\frac{n}{2}}}=\\sum\\limits^{\\frac{n}{2}}_{i=0}a_ix^i$\n\n\u8003\u8651\u5982\u4f55\u901a\u8fc7\u524d\u534a\u90e8\u5206\u7684\u7ed3\u679c\u6c42\u51fa\u540e\u534a\u90e8\u5206\uff1a\n\n$$\\begin{aligned}(x+\\frac{n}{2})^{\\overline{\\frac{n}{2}}}&=f(x+\\frac{n}{2})\\\\&=\\sum\\limits^{\\frac{n}{2}}_{i=0}a_i(x+\\frac{n}{2})^i\\\\&=\\sum\\limits^{\\frac{n}{2}}_{i=0}\\left(a_i\\times\\sum\\limits^{i}_{j=0}\\left(\\binom{i}{j}\\times x^j\\times\\left(\\frac{n}{2}\\right)^{i-j}\\right)\\right)\\\\&=\\sum\\limits^{\\frac{n}{2}}_{j=0}\\frac{1}{j!}\\times\\left(\\sum\\limits^{\\frac{n}{2}}_{i=j}\\left(i!\\cdot a_i\\right)\\left(\\frac{\\left(\\frac{n}{2}\\right)^{i-j}}{\\left(i-j\\right)!}\\right)\\right)\\times x^j\\end{aligned}$$\n\n\u5230\u8fd9\u91cc\u53ef\u80fd\u8fd8\u4e0d\u80fd\u53d1\u73b0\u5b83\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u4f46\u662f\u6ce8\u610f\u5230$i-(i-j)=j$\u6240\u4ee5\u5c06\u540e\u9762\u4e00\u90e8\u5206\u7684$i$\u6b21\u9879\u6539\u4e3a$-i$\u6b21\u9879\u5373\u53ef\uff0c\u4f46\u662f\u8d1f\u6b21\u6570\u591a\u9879\u5f0f\u4e0d\u597d\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5148\u5c06\u540e\u534a\u90e8\u5206\u5bf9\u5e94\u7684\u591a\u9879\u5f0f\u53cd\u8fc7\u6765\uff08\u5373\u5c06\u8d1f\u6b21\u6570\u591a\u9879\u5f0f\u4e58\u4e0a$x^{\\frac{n}{2}}$\uff09\uff0c\u5373\u5c06$\\sum\\limits^{\\frac{n}{2}}_{i=0}a_ii!x^i$\u548c$\\sum\\limits^{\\frac{n}{2}}_{i=0}\\frac{\\left(\\frac{n}{2}\\right)^i}{i!}x^{\\frac{n}{2}-i}$\u4e58\u8d77\u6765\u7684\u591a\u9879\u5f0f\u7b2c$i$\u9879\u7684\u7cfb\u6570\u4e3a\u8981\u6c42\u7684\u591a\u9879\u5f0f\u7684\u7b2c$i-\\frac{n}{2}$\u9879\u7684\u7cfb\u6570\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u7531$x^{\\overline{\\frac{n}{2}}}$\u5728$O(n\\log_2n)$\u65f6\u95f4\u5185\u6c42\u51fa$(x+\\frac{n}{2})^{\\overline{\\frac{n}{2}}}$\n\n\u800c$x^{\\overline{\\frac{n}{2}}}$\u53ef\u4ee5\u9012\u5f52\u6c42\u89e3\n\n\u82e5$n$\u662f\u5947\u6570\uff0c\u5219$x^{\\overline{n}}=x^{\\overline{n-1}}\\times(x+n-1)$\n\n\u65f6\u95f4\u590d\u6742\u5ea6$T(n)=T(\\frac{n}{2})+\\Theta(nlog_2n)=\\Theta(nlog_2n)$\n\n## \u4ee3\u7801\n\n\u672c\u9898\u5361\u5e38\uff0cNTT\u7684\u5e38\u6570\u9700\u8981\u5199\u5f97\u8f83\u5c0f\n\n```cpp\nconst int N = 530000;\nconst int Mod = 167772161, g = 3;\n\nclass Polynomial {\npublic:\n  int deg, *a;\n  Polynomial() {\n    a = new int[N];\n    memset(a, 0, sizeof(int) * N);\n  }\n  void NTT(int, bool);\n};\nint r[N];\nPolynomial solve(int);\n\nint fac[N], ifac[N];\nint omega[26];\nint siz;\n\nint main () {\n  int n;\n  read(n);\n  int lim = 1;\n  while (lim <= (n << 1)) {\n    lim <<= 1;\n  }\n  siz = __builtin_ctz(lim);\n  omega[25] = pow(g, (Mod - 1) >> 25, Mod);\n  for (int i = 24; i >= 0; --i) {\n    omega[i] = omega[i + 1] * 1ll * omega[i + 1] % Mod;\n  }\n  for (int i = 0; i < lim; ++i) {\n    r[i] = (r[i >> 1] >> 1) | ((i & 1) * (lim >> 1));\n  }\n  fac[0] = 1;\n  for (int i = 1; i <= lim; ++i) {\n    fac[i] = fac[i - 1] * 1ll * i % Mod;\n  }\n  ifac[lim] = pow(fac[lim], Mod - 2, Mod);\n  for (int i = lim - 1; i >= 0; --i) {\n    ifac[i] = ifac[i + 1] * 1ll * (i + 1) % Mod;\n  }\n  Polynomial ans = solve(n);\n  for (int i = 0; i <= n; ++i) {\n    write(ans.a[i]), SP;\n  }\n  EL;\n  return 0;\n}\n\nvoid Polynomial::NTT(int lim, bool opt) {\n  if (opt) {\n    std::reverse(a + 1, a + lim);\n  }\n  int tp = siz - __builtin_ctz(lim);\n  for (int i = 0; i < lim; ++i) {\n    if (i < (r[i] >> tp)) {\n      std::swap(a[i], a[r[i] >> tp]);\n    }\n  }\n  for (int l = 1, t = 1; l < lim; l <<= 1, ++t) {\n    int gw = omega[t];\n    for (int i = 0; i < lim; i += (l << 1)) {\n      for (int j = 0, gn = 1; j < l; ++j, gn = gn * 1ll * gw % Mod) {\n        int x = a[i + j], y = a[i + j + l] * 1ll * gn % Mod;\n        a[i + j] = (x + y) % Mod;\n        a[i + j + l] = (x - y + Mod) % Mod;\n      }\n    }\n  }\n  if (opt) {\n    int iv = pow(lim, Mod - 2, Mod);\n    for (int i = 0; i < lim; ++i) {\n      a[i] = a[i] * 1ll * iv % Mod;\n    }\n  }\n}\nvoid calc(const Polynomial &f, int n, int lim, Polynomial &g) {\n  Polynomial h;\n  memset(g.a + n + 1, 0, sizeof(int) * (lim - n));\n  g.a[0] = 1, h.a[0] = f.a[0];\n  for (int i = 1; i <= n; ++i) {\n    g.a[i] = g.a[i - 1] * 1ll * n % Mod;\n    h.a[i] = f.a[i] * 1ll * fac[i] % Mod;\n  }\n  for (int i = 1; i <= n; ++i) {\n    g.a[i] = g.a[i] * 1ll * ifac[i] % Mod;\n  }\n  std::reverse(g.a, g.a + n + 1);\n  g.NTT(lim, false), h.NTT(lim, false);\n  for (int i = 0; i < lim; ++i) {\n    g.a[i] = g.a[i] * 1ll * h.a[i] % Mod;\n  }\n  g.NTT(lim, true);\n  for (int i = 0; i <= n; ++i) {\n    g.a[i] = g.a[i + n] * 1ll * ifac[i] % Mod;\n  }\n  memset(g.a + n + 1, 0, sizeof(int) * (lim - n));\n}\nPolynomial solve(int n) {\n  std::stack<bool> S;\n  while (n) {\n    S.push(n & 1);\n    n >>= 1;\n  }\n  int lim = 1;\n  Polynomial A, B;\n  n = A.a[1] = S.top();\n  S.pop();\n  while (!S.empty()) {\n    while (lim <= (n << 1)) {\n      lim <<= 1;\n    }\n    calc(A, n, lim, B);\n    A.NTT(lim, false), B.NTT(lim, false);\n    for (int i = 0; i < lim; ++i) {\n      A.a[i] = A.a[i] * 1ll * B.a[i] % Mod;\n    }\n    A.NTT(lim, true);\n    n <<= 1;\n    if (!S.top()) {\n      S.pop();\n      continue;\n    }\n    S.pop();\n    A.a[n + 1] = A.a[n];\n    for (int i = n; i > 0; --i) {\n      A.a[i] = (A.a[i - 1] + A.a[i] * 1ll * n % Mod) % Mod;\n    }\n    A.a[0] = A.a[0] * 1ll * n % Mod;\n    ++n;\n  }\n  A.deg = n;\n  return A;\n}\n```",
        "postTime": 1585820354,
        "uid": 25251,
        "name": "moongazer",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5408 \u3010\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c\u3011"
    },
    {
        "content": "> \u9898\u610f\uff1a\u7ed9\u5b9a $n$\uff0c\u5bf9\u4e8e\u6240\u6709\u7684\u6574\u6570 $i\\in[0,n]$ \u8f93\u51fa $\\displaystyle {n\\brack i}$\uff0c$n < 262144$\u3002\n\n$\\textrm{Sol}$\uff1a\u4e0d\u60f3\u7528\u4e0a\u5347\u5e42\u600e\u4e48\u529e\uff1f\u5f53\u7136\u53ef\u4ee5\u7528\u672c\u8d28\u5b8c\u5168\u4e00\u81f4\u7684\u4e0b\u964d\u5e42\uff08\uff09\n\n\u5229\u7528\u4e0b\u964d\u5e42\u8f6c\u666e\u901a\u5e42\u7684\u516c\u5f0f $[x^i] x^{\\underline{n}}=\\displaystyle\\sum _{i=0}^n{n \\brack i}(-1)^{n-i}$\uff0c\u76f8\u5f53\u4e8e\u6c42\u51fa $x^{\\underline{n}}$ \u7684\u7cfb\u6570\u8868\u8fbe\uff0c\u5f53\u7136\u53ef\u4ee5 $O(n \\log^2 n)$ \u5206\u6cbb\u5377\u79ef\u3002\u66f4\u4f18\u79c0\u7684\u505a\u6cd5\u662f\u500d\u589e\uff0c\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u6c42\u51fa $\\displaystyle {n \\brack i}$\uff0c\u9700\u8981\u6c42\u51fa $x^{\\underline{2n}}$ \u7684\u7cfb\u6570\u8868\u8fbe\uff1a\n\n$$\n\\begin{aligned}\nx^{\\underline{2n}} &= x^{\\underline{n}} \\cdot (x-n)^{\\underline{n}}\\\\\n(x+n)^{\\underline{n}} &= \\sum_{i=0}^n {n \\brack i}(-1)^{n-i} (x-n)^i\\\\\n&= \\sum_{i=0}^n {n \\brack i}(-1)^{n-i} \\sum _{j=0}^i \\binom{i}{j} (-n)^{i-j} x^j\\\\\n&= \\sum _{j=0}^n \\left(\\sum_{i=j}^n {n \\brack i}(-1)^{n-i} \\frac{i!}{(i-j)!} (-n)^{i-j}\\right) \\frac{x^j}{j!}\n\\end{aligned}\n$$\n\n\u4ee4 $\\displaystyle f(i) = i!{n \\brack i}(-1)^{n-i}$\uff0c$g(i)=\\dfrac{(-n)^i}{i!}$\uff0c$g'(i) = g(n-i) = \\frac{(-n)^{n-i}}{(n-i)!}$ \u5219\u6709\uff1a\n\n$$\n\\begin{aligned}\n(x+n)^{\\underline{n}} &=  \\sum _{j=0}^n \\left(\\sum_{i=j}^n f(i) g(i-j)\\right) \\frac{x^j}{j!}\\\\\n&=  \\sum _{i=0}^n \\left(\\sum_{j=i}^n f(j) g'(n-j+i)\\right) \\frac{x^i}{i!}\n\\end{aligned}\n$$\n\n\u4e2d\u95f4\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6545\u53ef\u4ee5 $O(n \\log n)$ \u89e3\u51b3\uff0c\u7531\u4e8e\u957f\u5ea6\u500d\u589e\uff0c\u603b\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n```cpp\nvoid dft(int* f,int* g,int n){\n\tfill(f+n,f+SZ,0),fill(g+n,g+SZ,0);\n\tntt(f,SZ,1),ntt(g,SZ,1);\n}\n#define W(x) ((x)&1?-1:1)\nvoid S1Row(int n,int* f){\n\tif(n==1)return void(f[1]=1);\n\tstatic int Bf[N],T[N];\n\tint k=n>>1,o=k<<1;\n\tS1Row(k,f),init(o+1);\n\tFOR(i,0,k){\n\t\tchg(f[i]*=W(k-i)),T[i]=1ll*f[i]*fac[i]%mod;\n\t\tBf[i]=1ll*qpow(mod-k,k-i)*ifac[k-i]%mod;\n\t}\n\tdft(Bf,T,k+1);\n\tFOR(i,0,SZ-1)Bf[i]=1ll*T[i]*Bf[i]%mod;\n\tntt(Bf,SZ,-1);\n\tFOR(i,0,k)chg(Bf[i]=1ll*Bf[i+k]*iSZ%mod*ifac[i]%mod);\n\tdft(Bf,f,k+1);\n\tFOR(i,0,SZ-1)f[i]=1ll*f[i]*Bf[i]%mod;\n\tntt(f,SZ,-1),fill(f+o+1,f+SZ,0);\n\tFOR(i,1,o)chg(f[i]=1ll*f[i]*iSZ*W(o-i)%mod);\n\tif(n&1)ROF(i,n,1)f[i]=(f[i]*(n-1ll)+f[i-1])%mod;\n}\n```",
        "postTime": 1635336886,
        "uid": 78372,
        "name": "M4_SOPMODII_JR",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5408 \u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u00b7\u884c"
    }
]