[
    {
        "content": "\u6211\u4eec\u5148\u5c1d\u8bd5\u6c42 $f_1(S)$\u3002\n\n$$\\begin{aligned}\n\\sum_{T \\subseteq S}\\dfrac{\\sigma(T)}{\\pi(T)}&=\\sum_{T \\subseteq S}\\dfrac{\\sum\\limits_{x \\in T}x}{\\prod\\limits_{x \\in T}x}\\\\\n&=\\sum_{T \\subseteq S}\\sum_{x \\in T}\\prod_{y \\in T,y \\neq x}\\dfrac{1}{y}\\\\\n&=\\sum_{x \\in S}\\sum_{T \\subseteq S,x \\in T}\\prod_{y \\in T,y \\neq x}\\dfrac{1}{y}\\\\\n&=\\sum_{x \\in S}\\sum_{T \\subseteq S \\setminus \\{x\\}}\\dfrac{1}{\\pi(T)}\\\\\n&=\\sum_{x \\in S}\\prod_{y \\in S \\setminus \\{x\\}}\\left(\\dfrac{1}{y}+1\\right)\\\\\n&=\\dfrac{\\sum\\limits_{x \\in S}\\dfrac{x}{x+1}}{\\prod\\limits_{x \\in S}\\dfrac{x}{x+1}}.\n\\end{aligned}$$\n\n\u4ee4 $g(S)=\\left\\{\\dfrac{x}{1+x} : x \\in S\\right\\}$\uff0c\u5219 $f_1(S)=f_0(g(S))$\u3002\u663e\u7136 $f_k(S)=f_0(g^{(k)}(S))$\uff08\u5176\u4e2d $g^{(k)}(S)$ \u8868\u793a\u5bf9 $S$ \u8fed\u4ee3 $g$ \u51fd\u6570 $n$ \u6b21\uff0c\u4e0b\u7c7b\u4f3c\uff09\u3002\n\n\u4ee4 $h(x)=\\dfrac{x}{1+x}$\uff0c\u5219\u663e\u7136 $h^{(k)}(x)=\\dfrac{x}{1+kx}$\u3002\u6545 $f_k(S)=\\dfrac{\\sum\\limits_{x \\in S}\\dfrac{x}{1+kx}}{\\prod\\limits_{x \\in S}\\dfrac{x}{1+kx}}$\u3002\n\n\u73b0\u5728\u6211\u4eec\u8981\u6c42\u8fd9\u4e2a\u503c\u3002\u4f46\u662f $1+kx$ \u53ef\u80fd\u4e3a $p$ \u7684\u500d\u6570\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u7279\u6b8a\u5904\u7406\u3002~~\u4e0d\u7279\u6b8a\u5904\u7406\u8fd8\u6709 70 \u5206\uff0c\u771f\u662f\u592a\u826f\u5fc3\u5566\uff01~~\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\nCode:\n```cpp\n#include<cstdio>\n#define rg register\n#define ll long long\ninline char rc()\n{\n\tstatic char buf[1048576],*pn=buf,*pe=buf;\n\treturn (pn==pe)&&(pe=(pn=buf)+fread(buf,1,1048576,stdin),pn==pe)?EOF:*pn++;\n}\ninline int read()\n{\n\tint x=0;\n\tchar cc=rc();\n\twhile(cc<'0'||cc>'9')cc=rc();\n\twhile(cc>='0'&&cc<='9')x=x*10+cc-'0',cc=rc();\n\treturn x;\n}\ninline ll _read()\n{\n\tll x=0;\n\tchar cc=rc();\n\twhile(cc<'0'||cc>'9')cc=rc();\n\twhile(cc>='0'&&cc<='9')x=x*10+cc-'0',cc=rc();\n\treturn x;\n}\ninline ll exgcd(ll a,ll b,ll &x,ll &y)\n{\n\tif(!b)\n\t{\n\t\tx=1,y=0;\n\t\treturn a;\n\t}\n\tll d=exgcd(b,a%b,y,x);\n\ty-=a/b*x;return d;\n}\nint n,t,ntf;\ninline ll _inv(ll a)\n{\n\tll x,y;\n\texgcd(ntf,a,x,y);\n\treturn (y%ntf+ntf)%ntf;\n}\nll k;\nstruct frac\n{\n\tll p,q;\n\tint tim;\n}fr[7000003],ans;\ninline frac add(frac a,frac b)\n{\n\tll _p,_q;\n\tint _tim;\n\tif(a.tim<b.tim)\n\t{\n\t\t_tim=a.tim;\n\t\t_p=a.p*b.q%ntf;\n\t}\n\telse if(b.tim<a.tim)\n\t{\n\t\t_tim=b.tim;\n\t\t_p=b.p*a.q%ntf;\n\t}\n\telse\n\t{\n\t\t_tim=a.tim;\n\t\t_p=(a.p*b.q+b.p*a.q)%ntf;\n\t}\n\t_q=a.q*b.q%ntf;\n\tfrac res;\n\tres.p=_p,res.q=_q,res.tim=_tim;\n\treturn res;\n}\ninline frac mul(frac a,frac b)\n{\n\tll _p=a.p*b.p%ntf,_q=a.q*b.q%ntf;\n\tint _tim=a.tim+b.tim;\n\tfrac res;\n\tres.p=_p,res.q=_q,res.tim=_tim;\n\treturn res;\n}\nint main()\n{\n\tn=read(),k=_read(),ntf=read();\n\tk%=ntf,ans.p=0,ans.q=1,ans.tim=0;\n\tfor(rg int i=1;i<=n;++i)\n\t{\n\t\tfr[i].p=_read(),fr[i].q=(k*fr[i].p+1),fr[i].tim=0;\n\t\twhile(fr[i].q%ntf==0)fr[i].q/=ntf,--fr[i].tim;\n\t\tfr[i].q%=ntf,ans=add(ans,fr[i]);\n\t}\n\tfor(rg int i=1;i<=n;++i)\n\t{\n\t\tll tmp=fr[i].p;\n\t\tfr[i].p=fr[i].q;\n\t\tfr[i].q=tmp;\n\t\tfr[i].tim=-fr[i].tim;\n\t\tans=mul(ans,fr[i]);\n\t}\n\tprintf(\"%lld\\n\",ans.p*_inv(ans.q)%ntf);\n\treturn 0;\n}\n```",
        "postTime": 1616478529,
        "uid": 59388,
        "name": "VinstaG173",
        "ccfLevel": 7,
        "title": "E \u624b\u5199\u7684\u4ece\u524d \u9898\u89e3"
    },
    {
        "content": "# \u9898\u610f\n\n\u8fdc\u5b9a\u4e49\u4e00\u4e2a\u96c6\u5408 $S$ \u7684 **\u6743\u503c** \u4e3a $\\dfrac{\\sigma(S)}{\\pi(S)}$\uff0c\u5176\u4e2d $\\sigma(S)=\\sum\\limits_{x \\in S}x$ \u4e3a $S$ \u4e2d\u6240\u6709\u5143\u7d20\u4e4b\u548c\uff0c $\\pi(S)=\\prod\\limits_{x \\in S}x$ \u4e3a $S$ \u4e2d\u6240\u6709\u5143\u7d20\u4e4b\u79ef\u3002\u751c\u95ee\u4ed6\uff0c\u4e00\u4e2a\u96c6\u5408 $S$ \u7684 **\u6240\u6709\u5b50\u96c6** \u7684 **\u6743\u503c** \u548c\u662f\u591a\u5c11\uff1f\u8fdc\u5f88\u5feb\u5c31\u7b97\u51fa\u4e86\u7b54\u6848\u3002\u751c\u53c8\u95ee\uff0c\u90a3 **\u6240\u6709\u5b50\u96c6** \u7684 **\u6240\u6709\u5b50\u96c6** \u7684 **\u6743\u503c** \u548c\u4e4b\u548c\u662f\u591a\u5c11\uff1f\u8fdc\u53c8\u5f88\u5feb\u5c31\u7b97\u4e86\u51fa\u6765\u3002\u4e8e\u662f\u751c\u53c8\u95ee\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u95ee\u9898\u4e2d\u603b\u5171\u6709 $k$ \u4e2a **\u6240\u6709\u5b50\u96c6**\uff0c\u8fd9\u4e0b\u8fdc\u7b97\u4e0d\u5b8c\u4e86\uff0c\u6240\u4ee5\u4ed6\u627e\u4f60\u5e2e\u5fd9\u3002\u8fdc\u4e0d\u9700\u8981\u56de\u7b54\u4e00\u4e2a\u592a\u5927\u7684\u6570\uff0c\u6240\u4ee5\u7b54\u6848\u53ea\u8981\u53d6\u6a21 $p$\u3002\n\n$k\\le 10^{18},n\\le 7\\times 10^6,p$ \u4e3a\u8d28\u6570\u3002\n\n# \u89e3\u6cd5\n\n\u5bb9\u6613\u60f3\u5230\u8ba1\u7b97 $S$ \u7684\u6bcf\u4e2a\u5b50\u96c6\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u4e8e\u662f\u672c\u9898\u81ea\u7136\u5206\u4e3a\u4e24\u6b65\uff1a\u6bcf\u4e2a\u5b50\u96c6\u5bf9\u7b54\u6848\u8d21\u732e\u591a\u5c11\u6b21\uff1f\u8d21\u732e\u4e4b\u548c\u662f\u591a\u5c11\uff1f\n\n## \u7b2c\u4e00\u6b65\n\n\u8981\u6c42\u4e00\u4e2a\u5b50\u96c6\u5728\u201c\u6240\u6709\u5b50\u96c6 \u7684 \u2026\u2026\uff08$k$ \u4e2a\uff09\u7684 \u6240\u6709\u5b50\u96c6\u201d\u4e2d\u51fa\u73b0\u591a\u5c11\u6b21\u3002\n\n\u5373\uff0c\u5728 $S$ \u4e2d\u9009\u51fa $k$ \u4e2a\u5b50\u96c6 $S_1,\\cdots,S_k$ \u4f7f\u5f97 $S_i\\subseteq S_{i-1}$ \u4e14 $S_k=T$\uff0c\u95ee\u6709\u51e0\u79cd\u65b9\u6cd5\u3002\n\n\u663e\u7136\uff0c\u53ea\u8981\u4e24\u79cd\u9009\u53d6\u65b9\u6cd5\u4e2d\u67d0\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\u4e0d\u540c\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u5c31\u662f\u4e0d\u540c\u7684\u3002\uff08\u56e0\u4e3a\u5b50\u96c6\u524d\u4e00\u4e2a\u5305\u542b\u540e\u4e00\u4e2a\uff09\u4e8e\u662f\u53cd\u8fc7\u6765\u601d\u8003\uff1a\u8003\u8651\u6bcf\u4e2a\u6570\u5c5e\u4e8e\u591a\u5c11\u4e2a\u96c6\u5408\u3002\n\n\u5bf9\u4e8e\u96c6\u5408 $T$ \u4e2d\u7684\u6570\uff0c\u5fc5\u7136\u5c5e\u4e8e\u6240\u6709 $k$ \u4e2a\u5b50\u96c6\uff1b\u5bf9\u4e8e\u4e0d\u5728 $T$ \u4e2d\u7684\u6570\uff08$|S|-|T|$ \u4e2a\uff09\uff0c\u53ef\u4ee5\u6709 $k$ \u4e2d\u4e0d\u540c\u7684\u201c\u5c5e\u4e8e\u65b9\u5f0f\u201d\uff1a\u5c5e\u4e8e $0$ \u4e2a\u5b50\u96c6\u3001$1$ \u4e2a\u5b50\u96c6\u2026\u2026$k-1$ \u4e2a\u5b50\u96c6\u3002\uff08\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u5c5e\u4e8e $k$ \u4e2a\uff1f\u56e0\u4e3a\u5b83\u4e0d\u5728 $S_k$ \u4e2d\u3002\uff09\n\n\u56e0\u6b64 $T$ \u51fa\u73b0\u4e86 $k^{|S|-|T|}$ \u6b21\u3002\n\n## \u7b2c\u4e8c\u6b65\n\n\u7b54\u6848\u662f\u6bcf\u4e2a\u5b50\u96c6 $T$ \u7684\u51fa\u73b0\u6b21\u6570\u4e58\u4e0a $\\dfrac{\\sigma(T)}{\\pi(T)}$\uff1a\n\n$$\\begin{aligned}\n&\\sum_{T\\subseteq S}k^{|S|-|T|}\\dfrac{\\sigma(T)}{\\pi(T)}\\\\\n=&\\sum_{T\\subseteq S}\\dfrac{k^{|S|-|T|}}{\\pi(T)}\\sum_{x\\in T} x\\\\\n=&\\sum_{x\\in S} x\\sum_{T\\subseteq S,x\\in T}\\dfrac{k^{|S|-|T|}}{\\pi(T)}\\\\\n=&\\sum_{x\\in S} \\dfrac{x}{1+kx}\\sum_{T\\subseteq S,x\\in T}\\dfrac{(1+kx)k^{|S|-|T|}}{\\pi(T)}\\\\\n=&\\sum_{x\\in S} \\dfrac{x}{1+kx}\\sum_{T\\subseteq S,x\\in T}\\dfrac{k^{|S|-|T|+1}\\times x}{\\pi(T)}+\\dfrac{k^{|S|-|T|}}{\\pi(T)}\\\\\n=&\\sum_{x\\in S} \\dfrac{x}{1+kx}\\sum_{T\\subseteq S,x\\in T}\\dfrac{k^{|S|-(|T|-1)}}{\\dfrac{\\pi(T)}{x}}+\\dfrac{k^{|S|-|T|}}{\\pi(T)}\\\\\n=&\\sum_{x\\in S} \\dfrac{x}{1+kx}\\sum_{T\\subseteq S}\\dfrac{k^{|S|-|T|}}{\\pi(T)}\\\\\n=&\\sum_{x\\in S} \\dfrac{xk^{|S|}}{1+kx}\\sum_{T\\subseteq S}\\dfrac{1}{\\prod_{y\\in T} ky}\\\\\n\\end{aligned}$$\n\n\u5bf9\u6b64\u5f0f\u540e\u534a\u90e8\u5206\u56e0\u5f0f\u5206\u89e3\uff1a\n\n$$\\begin{aligned}\n=&\\left(\\sum_{x\\in S} \\dfrac{xk^{|S|}}{1+kx}\\right)\\prod_{x\\in S}1+\\dfrac{1}{kx}\\\\\n\\end{aligned}$$\n\n\u81f3\u6b64\uff0c\u5229\u7528[\u7ebf\u6027\u6c42\u9006](https://www.luogu.com.cn/problem/P5431)\u770b\u4f3c\u53ef $O(n)$ \u8ba1\u7b97\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\uff1a$1+kx$ \u7684\u9006\u5143\u53ef\u80fd\u4e0d\u5b58\u5728\u3002\u56e0\u6b64\uff0c\u5c06\u539f\u5f0f\u53d8\u5f62\u4e3a\n$$\\begin{aligned}\n&\\left(\\sum_{x\\in S} \\dfrac{x}{1+kx}\\right)\\prod_{x\\in S}\\dfrac{1+kx}{x}\\\\\n=&\\left(\\sum_{x\\in S} \\dfrac{x\\prod_{y\\in S}1+ky}{1+kx}\\right)\\prod_{x\\in S}\\dfrac{1}{x}\\\\\n=&\\left(\\sum_{i=1}^n \\dfrac{a_i\\prod_{j=1}^n1+ka_j}{1+ka_i}\\right)\\prod_{i=1}^n\\dfrac{1}{a_i}\\\\\n=&\\left(\\sum_{i=1}^n a_i\\prod_{j=1}^{i-1}1+ka_j\\prod_{j=i+1}^{n}1+ka_j\\right)\\dfrac{1}{\\prod_{i=1}^na_i}\\\\\n\\end{aligned}$$\n\n\u7528\u524d\u7f00\u79ef\u9884\u5904\u7406\u51fa \n\n$$\\text{pre}_x=\\prod_{j=1}^{x}1+ka_j,\\text{suf}_x=\\prod_{j=x}^{n}1+ka_j$$\n\n\u5373\u53ef\u8ba1\u7b97\u3002\u5e76\u4e14\u53ea\u7528\u6c42\u4e00\u6b21\u9006\u5143\uff0c\u4e0d\u9700\u8981\u7ebf\u6027\u6c42\u9006\u3002\n# \u4ee3\u7801\n\n\u8bb0\u5f97\u5f00 `long long`\uff0c\u5efa\u8bae\u52a0\u4e0a\u5feb\u8bfb\u3002\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define N 7000000\nusing namespace std;\nint n,k,M,a[N+5],prod=1,pre[N+5],suf[N+5],ans;\ninline int read()\n{\n\tint x=0;\n\tchar cc=getchar();\n\twhile(cc<'0'||cc>'9')cc=getchar();\n\twhile(cc>='0'&&cc<='9')x=x*10+cc-'0',cc=getchar();\n\treturn x;\n}\ninline int tyfc(int x,int y)\n{\n\tif(y==1) return 0;\n\treturn ((1-y*tyfc(y%x,x))/x%y+y)%y;\n}\nsigned main()\n{\n\tn=read(),k=read(),M=read();k%=M;\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read(),\n\t\tprod=prod*a[i]%M,\n\t\tpre[i]=suf[i]=(1+k*a[i])%M;\n\tpre[0]=suf[n+1]=1;\n\tfor(int i=2;i<=n;i++) pre[i]=pre[i]*pre[i-1]%M;\n\tfor(int i=n-1;i>=1;i--) suf[i]=suf[i]*suf[i+1]%M;\n\tfor(int i=1;i<=n;i++) ans=(ans+a[i]*pre[i-1]%M*suf[i+1]%M)%M;\n\tcout<<ans*tyfc(prod,M)%M;\n\treturn 0;\n}\n```\n",
        "postTime": 1679047500,
        "uid": 340940,
        "name": "IAKIOI2357",
        "ccfLevel": 0,
        "title": "P7489 \u300cStoi2031\u300d\u624b\u5199\u7684\u4ece\u524d \u9898\u89e3"
    }
]