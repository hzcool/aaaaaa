[
    {
        "content": "\u5b66OI\u4e00\u5e74\u534a\uff0c\u7ec8\u4e8e\u5207\u4e86\u7b2c\u4e00\u9053\u4ea4\u4e92\u9898\u3002\n\n## \u7b80\u8ff0\u9898\u610f\n\n\u6709\u4e00\u68f5\u6709\u6807\u53f7\u7684\u6811\uff0c$n$\u4e2a\u70b9\uff0c$1$\u4e3a\u6839\uff0c\u521d\u59cb\u53ea\u6709$1$\u5df2\u77e5\u3002\u4f60\u53ef\u4ee5\u8c03\u7528\u4e00\u4e2a`explore(x, y)`\u51fd\u6570\uff0c\u5176\u4e2d$x$\u4e3a\u5df2\u77e5\u70b9\uff0c$y$\u4e3a\u672a\u77e5\u70b9\uff0c\u51fd\u6570\u4f1a\u8fd4\u56de\u4ece$x$\u5f80$y$\u8d70\u7684\u4e0b\u4e00\u4e2a\u70b9\u3002\u9650\u5236\u4f60\u8c03\u7528`explore`\u7684\u6b21\u6570\u5927\u7ea6\u4e3a$n \\log n$\u6b21\uff0c\u4f60\u9700\u8981\u731c\u51fa\u6574\u9897\u6811\u7684\u7ed3\u6784\u3002\n\n## \u89e3\u6cd5\n\n\u9996\u5148\u6211\u4eec\u6709\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u66b4\u529b\u601d\u8def\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u672a\u77e5\u7684\u70b9\uff0c\u6211\u4eec\u4ece$1$\u5f00\u59cb\u8c03\u7528`explore`\uff0c\u4e00\u76f4\u8d70\u5230\u8fd9\u4e2a\u70b9\u3002\n\n\u7531\u4e8e\u6811\u7684\u6df1\u5ea6\u6700\u574f\u662f$O(n)$\u7684\uff0c\u6240\u4ee5\u6bcf\u627e\u4e00\u4e2a\u65b0\u70b9\u9700\u8981\u7684\u65f6\u95f4\u4e5f\u662f$O(n)$\uff0c\u603b\u590d\u6742\u5ea6\u662f$O(n ^ 2)$\u3002\n\n\u8003\u8651\u51cf\u5c0f\u6bcf\u6b21\u8fbe\u5230\u65b0\u70b9\u7684\u590d\u6742\u5ea6\uff0c\u4e5f\u5c31\u662f\u51cf\u5c0f\u201c\u6df1\u5ea6\u201d\uff0c\u4e0d\u96be\u60f3\u5230\u53ef\u4ee5\u5229\u7528\u70b9\u5206\u6cbb\u7684\u6027\u8d28\uff0c\u5373\u70b9\u5206\u6cbb\u6df1\u5ea6\u4e3a$O(\\log n)$\u3002\n\n\u7ef4\u62a4\u5df2\u77e5\u6811\u7684\u70b9\u5206\u6811\uff0c\u4ece\u70b9\u5206\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u8bbe\u5f53\u524d\u6240\u5728\u8282\u70b9\u4e3a$x$\uff0c\u60f3\u627e\u5230$y$\u7684\u4f4d\u7f6e\uff0c\u4ee4$z=$`explore(x, y)`\uff0c\u90a3\u4e48\u6211\u4eec\u4ece$z$\u5f80\u4e0a\u722c\u70b9\u5206\u7236\u4eb2\uff0c\u4e00\u76f4\u722c\u5230$x$\uff0c\u5c31\u53ef\u4ee5\u7528$O(\\log n)$\u7684\u590d\u6742\u5ea6\u77e5\u9053$z$\u5728$x$\u7684\u54ea\u4e2a\u70b9\u5206\u5b50\u6811\u5185\u3002\u6211\u4eec\u8df3\u5230\u8fd9\u4e2a\u70b9\u5206\u513f\u5b50\uff0c\u7ee7\u7eed\u91cd\u590d\u524d\u9762\u7684\u64cd\u4f5c\uff0c\u4e00\u76f4\u5230\u627e\u5230$y$\u4ece\u54ea\u4f38\u51fa\u53bb\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u6bcf\u5bfb\u627e\u4e00\u4e2a$y$\u8282\u70b9\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(\\log ^ 2 n)$\uff0c`explore`\u7684\u8c03\u7528\u6b21\u6570\u662f$O(\\log n)$\u3002\n\n\u73b0\u5728\u6211\u4eec\u7684\u95ee\u9898\u662f\uff0c\u5982\u4f55\u7ed9\u70b9\u5206\u6811\u52a8\u6001\u52a0\u70b9\u3002\u6211\u4eec\u6bcf\u6b21\u5148\u9ed8\u8ba4\u65b0\u52a0\u70b9\u7684\u70b9\u5206\u7236\u4eb2\u662f\u539f\u6811\u7236\u4eb2\uff0c\u4ece\u8fd9\u4e2a\u70b9\u5f80\u4e0a\u722c\u70b9\u5206\u7236\u4eb2\uff0c\u627e\u5230\u6700\u540e\u4e00\u4e2a\u70b9\u5206\u5b50\u6811\u5927\u5c0f\u8d85\u8fc7\u70b9\u5206\u7236\u4eb2\u70b9\u5206\u5b50\u6811\u5927\u5c0f$0.7$\u500d\u7684\u70b9$x$\uff0c\u628a\u4ee5$x$\u7684\u70b9\u5206\u7236\u4eb2\u4e3a\u6839\u7684\u70b9\u5206\u5b50\u6811\u6240\u5bf9\u5e94\u7684\u8054\u901a\u5757\u91cd\u65b0\u6784\u5efa\u70b9\u5206\u6811\u5373\u53ef\u3002\uff08\u8bf4\u7684\u597d\u7ed5\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u9700\u8981\u7279\u522b\u6ce8\u610f\u4e00\u4e0b\u94fe\u7684\u60c5\u51b5\uff0c\u5141\u8bb8\u7684\u8c03\u7528\u6b21\u6570\u662f$O(n + \\log n)$\u7684\u3002\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u628a\u5bfb\u627e\u8282\u70b9\u7684\u6b21\u5e8f`random_shuffle`\u4e00\u4e0b\u3002\u4ee4\u5df2\u77e5\u94fe\u7684\u5de6\u7aef\u70b9\u4e3a$l$\uff0c\u53f3\u7aef\u70b9\u4e3a$r$\uff0c\u76ee\u6807\u70b9\u4e3a$y$\uff0c$z=$`explore(l, y)`\uff0c\u5982\u679c$z$\u672a\u77e5\uff0c\u5c31\u4ece$z$\u5411$y$\u63a8\uff0c\u53cd\u4e4b\u4ece$r$\u5411$y$\u63a8\u3002\u8fd9\u6837\uff0c\u628a$n$\u4e2a\u70b9\u5168\u90e8\u627e\u51fa\u6765\uff0c\u671f\u671b\u7684\u201c\u5931\u8d25\u201d\u6b21\u6570\u662f$O(\\log n)$\u7684\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n//#include \"rts.h\"\n#define MAXN _________\n\nusing namespace std;\nconst int MAXN = 1e6 + 5;\n\nint n, a[MAXN], vis[MAXN], fini[MAXN];\nint explore(int, int);\n// int explore(int x, int y) {}\n// int main() {}\n\nvoid WorkLine() {\n\tsrand(time(0));\n\tfor (int i = 1; i < n; i++) a[i] = i + 1;\n\trandom_shuffle(a + 1, a + n);\n    int l = 1, r = 1;\n\tfini[1] = 1;\n\tfor (int i = 1; i < n; i++) {\n\t\tint ter = a[i];\n\t\tif (fini[ter]) continue;\n\t\tint x = explore(l, ter), now = 0;\n\t\tif (fini[x]) now = r, r = ter;\n\t\telse fini[x] = 1, now = x, l = ter;\n\t\twhile (!fini[ter]) now = explore(now, ter), fini[now] = 1;\n\t}\n}\n\nint to[MAXN], nx[MAXN], head[MAXN], ecnt;\nint dfa[MAXN], ddep[MAXN], dsiz[MAXN], maxw[MAXN], siz[MAXN];\nint nowrt;\n\nvoid Add(int x, int y) {\n\tto[++ecnt] = y; nx[ecnt] = head[x]; head[x] = ecnt;\n\tto[++ecnt] = x; nx[ecnt] = head[y]; head[y] = ecnt;\n}\n\nint Find(int u, int fa, int tot) {\n\tsiz[u] = 1;\n\tmaxw[u] = 0;\n\tint res = 0;\n\tfor (int i = head[u]; i; i = nx[i]) {\n\t\tint v = to[i];\n\t\tif (vis[v] || v == fa) continue;\n\t\tint cen = Find(v, u, tot);\n\t\tif (!res || maxw[cen] < maxw[res]) res = cen;\n\t\tmaxw[u] = max(maxw[u], siz[v]);\n\t\tsiz[u] += siz[v];\n\t}\n\tmaxw[u] = max(maxw[u], tot - siz[u]);\n\tif (!res || maxw[u] < maxw[res]) res = u;\n\treturn res;\n}\n\nvoid Divide(int u, int tot) {\n\tvis[u] = 1;\n\tfor (int i = head[u]; i; i = nx[i]) {\n\t\tint v = to[i];\n\t\tif (vis[v]) continue;\n\t\tint subs = (siz[v] < siz[u] ? siz[v] : tot - siz[u]);\n\t\tint subc = Find(v, u, subs);\n\t\tdfa[subc] = u;\n\t\tddep[subc] = ddep[u] + 1;\n\t\tdsiz[subc] = subs;\n\t\tDivide(subc, subs);\n\t}\n}\n\nvoid Clear(int u, int fa, int lim) {\n\tdfa[u] = 0;\n\tddep[u] = 0;\n\tdsiz[u] = 0;\n\tvis[u] = 0;\n\tfor (int i = head[u]; i; i = nx[i]) {\n\t\tint v = to[i];\n\t\tif (v == fa || ddep[v] < lim) continue;\n\t\tClear(v, u, lim);\n\t}\n};\n\nvoid Rebuild(int u) {\n\tint tot = dsiz[u];\n\tint fa = dfa[u];\n    int depth = ddep[u];\n\tClear(u, 0, depth);\n\tint cen = Find(u, 0, tot);\n\tif (u == nowrt) nowrt = cen;\n\tdfa[cen] = fa;\n\tddep[cen] = depth;\n\tdsiz[cen] = tot;\n\tDivide(cen, tot);\n}\n\nvoid Update(int now) {\n\tint reb = 0;\n\twhile (dfa[now]) {\n\t\tif (1.0 * dsiz[now] > 0.7 * dsiz[dfa[now]]) reb = dfa[now];\n\t\tnow = dfa[now];\n\t}\n\tif (reb) Rebuild(reb);\n}\n\nvoid Reach(int ter) {\n\tint now = nowrt;\n\twhile (!fini[ter]) {\n\t\tint nex = explore(now, ter);\n\t\tif (!fini[nex]) {\n\t\t\tAdd(now, nex);\n\t\t\tdfa[nex] = now;\n\t\t\tddep[nex] = ddep[now] + 1;\n\t\t\tvis[nex] = 1;\n\t\t\tfini[nex] = 1;\n\t\t\tdsiz[nex] = 0;\n\t\t\tfor (int cur = nex; cur; cur = dfa[cur]) dsiz[cur]++;\n\t\t\tnow = nex;\n\t\t\tUpdate(now);\n\t\t} else {\n\t\t\tint son = nex;\n\t\t\twhile (dfa[son] != now) son = dfa[son];\n\t\t\tnow = son;\n\t\t}\n\t}\n}\n\nvoid Work() {\n\tsrand(time(0));\n\tfor (int i = 1; i < n; i++) a[i] = i + 1;\n\trandom_shuffle(a + 1, a + n);\n\tfini[1] = 1;\n\tddep[1] = 1;\n\tvis[1] = 1;\n\tdsiz[1] = 1;\n\tnowrt = 1;\n\tfor (int i = 1; i < n; i++) {\n\t\tint ter = a[i];\n\t\tif (fini[ter]) continue;\n\t\tReach(ter);\n\t}\n}\n\nvoid play(int n, int T, int dataType) {\n\t::n = n;\n\tif (dataType == 3) WorkLine();\n\telse Work();\n}\n```",
        "postTime": 1591607264,
        "uid": 126376,
        "name": "Irelia\u10e6",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6541 \u3010[WC2018]\u5373\u65f6\u6218\u7565\u3011"
    },
    {
        "content": "\u663e\u7136\uff0c\u6211\u4eec\u62d3\u5c55\u51fa\u6765\u7684\u70b9\u6784\u6210\u4e86\u4e00\u4e2a\u8fde\u901a\u5757.    \n\u5148\u8003\u8651\u94fe\u7684\u60c5\u51b5\uff1a\n\u663e\u7136\uff0c\u8fde\u901a\u5757\u7684\u5f62\u5f0f\u662f\u4e00\u6bb5\u533a\u95f4 $[L,R]$.  \n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u968f\u673a\u4e00\u4e2a\u6ca1\u9009\u8fc7\u7684\u70b9 $p$\uff0c\u7136\u540e\u8ba9\u5de6\u7aef\u70b9\u67e5\u8be2\u4e00\u4e0b. \n\u8fd9\u91cc\u6709\u4e24\u79cd\u60c5\u51b5\uff1a \n1. \u672a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u8bf4\u660e\u968f\u673a\u7684\u8282\u70b9\u5728\u5de6\u7aef\u70b9\u5de6\u4fa7\uff0c\u53ef\u4ee5\u4e00\u76f4\u4ee5 $O(1)$ \u7684\u4ee3\u4ef7\u62d3\u5c55\u5230 $p$ \u4e3a\u6b62.    \n2. \u88ab\u8bbf\u95ee\u8fc7\uff0c\u8bf4\u660e $p$ \u5728\u53f3\u7aef\u70b9\u7684\u53f3\u4fa7\uff0c\u90a3\u4e48\u5c31\u8f6c\u79fb\u5230\u53f3\u7aef\u70b9\uff0c\u7136\u540e\u540c\u4e0a\u4e00\u79cd\u60c5\u51b5\u4e00\u6837\u53bb\u62d3\u5c55.\n\n\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684\u603b\u8be2\u95ee\u6b21\u6570\u662f $O(n)$\uff0c\u7b2c\u4e8c\u79cd\u60c5\u51b5\u4e0d\u597d\u5206\u6790.   \n\u5e73\u5747\u4e0b\u6765\uff0c\u8fdb\u884c\u64cd\u4f5c 2 \u7684\u6b21\u6570\u5927\u6982\u662f $O(\\log n)$.   \n\n\u8fd9\u91cc\u518d\u8bf4\u4e00\u4e0b\u6811\u7684\u60c5\u51b5\uff1a  \n\u663e\u7136\uff0c\u5bf9\u4e8e\u5b8c\u5168\u4e8c\u53c9\u6811\u7684\u8bdd\u6bcf\u6b21\u66b4\u529b\u4ece\u6839\u8282\u70b9\u5f00\u59cb\u8df3\u513f\u5b50\u5355\u6b21\u53ea\u9700\u67e5\u8be2 $O(\\log n)$ \u6b21\u5373\u53ef. \n\n\u5bf9\u4e8e\u4e0d\u662f\u5b8c\u5168\u4e8c\u53c9\u6811\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u4e5f\u91c7\u7528\u7c7b\u4f3c\u7684\u65b9\u5f0f.  \n\n\u5bf9\u5f97\u5230\u7684\u8fde\u901a\u5757\u8fdb\u884c\u8f7b\u91cd\u94fe\u5256\u5206\uff0c\u7136\u540e\u5728\u91cd\u94fe\u91cc\u4e8c\u5206\u51fa \u201c\u679d\u6748\u201d \u6700\u65e9\u51fa\u73b0\u7684\u4f4d\u7f6e\u5c31\u884c.   \n\n\u7531\u4e8e\u6211\u4eec\u8981\u52a8\u6001\u8fdb\u884c\u8fde\u8fb9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7528 LCT \u53bb\u7ef4\u62a4.   \n\n\u8bb0\u5f97\u591a $access$ \u51e0\u6b21\u6765\u4fdd\u8bc1\u6811\u9ad8\u7684\u968f\u673a\u6027.  \n\n```cpp\n#include <bits/```cpp\n#include <bits/stdc++.h> \n#define N 1000005\n#define ll long long\n#define lson s[x].ch[0]\n#define rson s[x].ch[1] \n \nusing namespace std; \n \nint vis[N],arr[N],sta[N];                  \n \nint ran(int l) { return (ll)rand()*rand()%l+1; }   \n  \nstruct data {\n    int ch[2],f,rev,l,r; \n}s[N]; \ninline int get(int x) { return s[s[x].f].ch[1]==x; }      \ninline int isr(int x) { return s[s[x].f].ch[0]!=x&&s[s[x].f].ch[1]!=x; }    \ninline void pushup(int x)\n{\n    s[x].l=s[x].r=x; \n    if(lson) s[x].l=s[lson].l; \n    if(rson) s[x].r=s[rson].r; \n}\ninline void mark(int x) { s[x].rev^=1,swap(lson,rson),swap(s[x].l,s[x].r); }   \ninline void push(int x)\n{\n    if(s[x].rev)\n    {\n        if(lson) mark(lson);      \n        if(rson) mark(rson);\n        s[x].rev^=1;\n    }\n}\nvoid rotate(int x)\n{\n    int old=s[x].f,fold=s[old].f,which=get(x); \n    if(!isr(old))\n        s[fold].ch[s[fold].ch[1]==old]=x;    \n    s[old].ch[which]=s[x].ch[which^1]; \n    if(s[old].ch[which])\n        s[s[old].ch[which]].f=old; \n    s[x].ch[which^1]=old,s[old].f=x,s[x].f=fold; \n    pushup(old),pushup(x); \n}\nvoid splay(int x)\n{\n    int v=0,u=x,fa; \n    for(sta[++v]=u;!isr(u);u=s[u].f) sta[++v]=s[u].f;    \n    for(;v;--v) push(sta[v]);  \n    for(u=s[u].f;(fa=s[x].f)!=u;rotate(x)) \n        if(s[fa].f!=u)\n            rotate(get(fa)==get(x)?fa:x);  \n}\nvoid access(int x) \n{\n    for(int y=0;x;y=x,x=s[x].f)\n        splay(x),rson=y,pushup(x);\n}\nvoid makert(int x)\n{\n    access(x),splay(x),mark(x); \n}\nvoid link(int x,int y) { s[x].f=y; }  \nint getrt(int x) { while(!isr(x)) x=s[x].f; return x; }\nvoid play(int n, int T, int dataType)\n{\n    srand((unsigned)time(NULL)); \n    if(dataType==3)\n    {           \n        int L=1,R=1;   \n        for(int i=2;i<=n;++i) arr[i]=i;     \n        random_shuffle(arr+2,arr+1+n); \n        for(int i=2;i<=n;++i)\n        {\n            int u=arr[i];      \n            if(vis[u]) continue;    \n            int p=explore(L,u);     \n            if(!vis[p])\n            {\n                vis[p]=1,L=p;\n                while(p!=u) p=explore(p,u),L=p,vis[p]=1;             \n            }  \n            else\n            {\n                int p2=explore(R,u);   \n                vis[p2]=1,R=p2;  \n                while(p2!=u) p2=explore(p2,u),R=p2,vis[p2]=1;\n            }\n        }\n    }\n    else\n    {\n        vis[1]=1,arr[1]=1;\n        for(int i=2;i<=n;++i) arr[i]=i; \n        random_shuffle(arr+2,arr+1+n);   \n        for(int i=2;i<=n;++i)\n        {\n            int u=arr[i];\n            if(vis[u]) continue;   \n            int x=getrt(1),cn=0;\n            while(1)\n            {\n                push(x);      \n                int cur=explore(x,u);   \n                if(!vis[cur])\n                {\n                    vis[cur]=1,link(cur,x),x=cur;      \n                    while(cur!=u)\n                    {\n                        cur=explore(cur,u);    \n                        vis[cur]=1,link(cur,x),x=cur; \n                    }    \n                    access(x);\n                    break;  \n                }  \n                if(cur==s[rson].l) x=rson;  \n                else if(cur==s[lson].r) x=lson; \n                else x=getrt(cur);                \n            }  \n        }\n    }\n}\n```\n>\n```",
        "postTime": 1590136955,
        "uid": 53622,
        "name": "EM_LGH",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6541 \u3010[WC2018]\u5373\u65f6\u6218\u7565\u3011"
    },
    {
        "content": "[\u6d1b\u8c37\u9898\u9762](https://www.luogu.com.cn/problem/P6541)\n\n[UOJ\u9898\u9762](https://uoj.ac/problem/349)\n\n\u505a\u4ea4\u4e92\u9898\u8fd8\u662f\u5efa\u8bae\u53bbuoj\u6216loj\u5427\uff08loj\u6682\u65f6\u4ea4\u4e0d\u4e86\uff09\uff0c\u6bd5\u7adf\u6d1b\u8c37\u5f62\u5f0f\u4e0d\u89c4\u8303\u3002\n\n\u6211\u6765\u505a\u8fd9\u9898\uff0c\u53ea\u662f\u7eaf\u7cb9\u5730\u65e0\u804a\u3002\u60f3\u8d77noip\u56e0\u4e3aspj\u9898\u7206\u70b8\uff0c\u770b\u5230\u65e5\u62a5\u91cc\u6709\u9053\u4f8b\u9898\u5c31\u6765\u73a9\uff0c\u7136\u540e\u5c31\u662f5h\uff08\u4e8b\u5b9e\u4e0a3.5h\u7684\u65f6\u5019\u6211\u7684\u4ee3\u7801\u5c31\u80fdAC\u4e86\uff0c\u76f4\u52305h\u6211\u624d\u4ea4\u4e86\u4e00\u53d1\uff09\u3002\n\n------------------------\n\n### \u521d\u6b65\u60f3\u6cd5\n\n\u9996\u5148\uff0c\u5173\u4e8e\u8fd9\u4e2a `explore` \u600e\u4e48\u7528\u662f\u8981\u6709\u4e00\u5b9a\u60f3\u6cd5\u7684\u3002\n\n\u5047\u8bbe\u6211\u4eec\u77e5\u9053\u70b9 $x$ \u662f\u5df2\u77e5\u70b9\uff0c \u90a3\u4e48\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u70b9 $y$ \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $\\operatorname{dis}(x,y)$ \u6b21`explore` \u628a\u6574\u6761\u8def\u5f84\u4e0a\u7684\u70b9\u90fd\u53d8\u6210\u5df2\u77e5\u70b9\u3002\u6bcf\u4e00\u6b21 `explore` \u540e\u4ee4 $x$ \u4e3a\u8fd4\u56de\u503c $z$ , \u76f4\u5230 $x=y$ \u5373\u53ef\u3002\n\n------------------------\n\n### \u94fe\n\n\u8fd9\u4e2a `dataType=3` \u4e00\u770b\u5c31\u662f\u8981\u6570\u636e\u5206\u6cbb\u7684\uff0c\u522b\u7684 $T$ \u90fd\u662f $n\\log n$ \u7ea7\u522b\u7684\uff0c\u53ea\u6709\u8fd9\u4e2a\u662f $n+\\log n$ \u7ea7\u522b\u7684\u3002\n\n\u60f3\u4e86\u534a\u5929\u6b63\u89e3\u65e0\u679c\u5c31\u6765\u505a\u8fd9\u4e2a\u90e8\u5206\u5206\u3002\n\n\u53ea\u6709 $21$ \u6b21\u9519\u8bef\u7684\u673a\u4f1a\uff0c\u5176\u4f59\u5fc5\u987b `explore` \u4e00\u6b21\u589e\u52a0\u4e00\u4e2a\u5df2\u77e5\u70b9\u3002\n\n\u6574\u68f5\u6811\u90fd\u4e0d\u77e5\u9053\u600e\u4e48 $\\log$ \u554a\uff1f\uff1f\uff1f\n\n\u9996\u5148\u6709\u4e2a\u663e\u7136\u7684 $T\\le 2n$ \u7684\u505a\u6cd5\uff1a\n\n\u8003\u8651\u5230\u5df2\u77e5\u70b9\u4e00\u5b9a\u662f\u94fe\u4e0a\u7684\u4e00\u6bb5\u533a\u95f4 $[l,r]$\uff0c\u5bf9\u4e8e\u65b0\u52a0\u5165\u7684\u4e00\u4e2a\u70b9 $i$\uff0c\u5982\u679c `explore(l,i)` \u662f\u672a\u77e5\u70b9\uff0c\u90a3\u4e48\u5b83\u5728 $l$ \u5de6\u8fb9\uff0c\u5426\u5219\u5728 $r$ \u7684\u53f3\u8fb9\u3002\u7136\u540e\u7528\u4e0a\u9762\u6240\u8ff0 `explore` \u7684\u7528\u6cd5\u53ef\u4ee5\u76f4\u63a5\u66f4\u65b0\u5de6\u53f3\u7aef\u70b9\u5e76\u4e14\u628a $i$ \u878d\u5165\u5df2\u77e5\u70b9\u7684\u533a\u95f4\u3002\n\n\u6240\u4ee5\u6bcf\u81f3\u591a $2$ \u6b21\u8be2\u95ee\u53ef\u4ee5\u786e\u5b9a\u4e00\u4e2a\u70b9\u3002\u5e76\u4e14\u5728 $i$ \u5230\u5df2\u77e5\u533a\u95f4\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u53ea\u9700\u8981 $1$ \u6b21\u5c31\u53ef\u4ee5\u53d8\u6210\u5df2\u77e5\u70b9\u3002\n\n\u7136\u540e\u5c31\u8981\u70b9\u8111\u6d1e\u4e86\uff1a**\u968f\u673a\u5316**\n\n\u5982\u679c\u6bcf\u6b21\u968f\u673a\u53d6\u4e00\u4e2a\u672a\u77e5\u70b9\u5e76\u4e14\u628a\u5b83\u5f52\u5230\u533a\u95f4\u5185\u3002\u53d1\u73b0\u6bcf\u6b21\u672a\u77e5\u70b9\u533a\u95f4\u957f\u5ea6\u671f\u671b\u51cf\u5c11\u4e00\u534a\u7684\u957f\u5ea6\uff0c\u5c31\u53ef\u4ee5 $\\log$ \u4e86\u3002\n\n\u5410\u69fd\uff1a\u6211\u4e00\u5f00\u59cb\u5fd8\u8bb0\u968f\u673a\u5316\u8fd8\u80fd\u8fc7\uff0c\u8bf4\u660e\u51fa\u9898\u4eba\u94fe\u7684\u968f\u673a\u6027\u4e0d\u9519\uff08\n\n\u8bf4\u53e5\u95f2\u8bdd\uff1a$\\color{black}{\\texttt{S}}\\color{red}{\\texttt{egmentTree}}$ \u95ee\u6211\uff1a\u4f60\u662f\u4e0d\u662f\u7528\u4e86 `mt19937` \uff0c\u8fd9\u4e2a\u4e0d\u662f\u8003\u573a\u4e0a\u4e0d\u80fd\u7528\u7684\u5417\uff1f\n\n\u4e8e\u662f\u6211\u624b\u5199\u4e86\u968f\u673a\u6570\u3002\u540e\u6765\u6211\u53d1\u73b0\u4ed6\u7528\u4e86 `mt19937` \uff08\uff08\uff08\n\n----------------------------\n\n### \u66b4\u529b\n\n\u5f00\u59cb\u8003\u8651\u524d\u9762\u7684\u70b9\u66b4\u529b\u600e\u4e48\u62ff\u3002\u5ffd\u7136\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u672a\u77e5\u70b9\u6267\u884c\u4e0a\u9762\u6240\u8ff0 `explore` \u7684\u8fc7\u7a0b\uff0c\u4ece $1$ \u6269\u5c55\u5230\u8fd9\u4e2a\u672a\u77e5\u70b9\u3002\u7ed3\u5408\u4e0a\u9762 `dataType=3` \u7684\u6570\u636e\u5206\u6cbb\u53ef\u4ee5\u901a\u8fc7\u524d14\u4e2a\u70b9\u5f97\u523070\u5206\u3002\n\n------------------------------\n\n### \u6b63\u89e3\n\n\u5176\u5b9e\u505a\u5230\u73b0\u5728\u5bf9\u4e8e\u8fd9\u4e2a\u6e38\u620f\u600e\u4e48\u73a9\u5e94\u8be5\u6709\u4e00\u5b9a\u60f3\u6cd5\u4e86\uff0c\u6709\u7528\u7684\u64cd\u4f5c\u5c31\u662f\u4ece\u4e00\u4e2a\u5df2\u77e5\u70b9\u5f00\u59cb\uff0c\u5b83\u7684\u4e0b\u4e00\u6b65\u5c31\u662f\u672a\u77e5\u70b9\uff0c\u4e0d\u65ad `explore` \u6574\u4e2a\u8def\u5f84 \u3002\u800c\u6700\u5927\u70b9\u8fc7\u4e0d\u53bb\u7684\u539f\u56e0\u4e5f\u6b63\u662f\u56e0\u4e3a\u4e0a\u9762\u7684\u66b4\u529b\u4f1a\u5927\u9762\u79ef\u91cd\u590d\u904d\u5386\u5df2\u77e5\u70b9\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u4ee5\u6781\u5c11\u7684\u6b21\u6570\u627e\u5230\u4e00\u4e2a\u70b9 $x$ \uff0c\u4f7f\u5f97 $x$ \u5f80\u6211\u4eec\u9700\u8981\u6269\u5c55\u5230\u7684\u672a\u77e5\u70b9 $y$ \u8d70\uff0c\u6bcf\u4e00\u6b65\u8d70\u5230\u7684\u70b9\u90fd\u662f\u672a\u77e5\u70b9\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u8981\u627e\u4ece $y$ \u5f80\u5f53\u524d\u7684\u5df2\u77e5\u70b9\u8054\u901a\u5757\u8d70\uff0c\u7b2c\u4e00\u4e2a\u9047\u4e0a\u7684\u5df2\u77e5\u70b9\u3002\n\n\u5ffd\u7136\u8111\u888b\u91cc\u95ea\u8fc7\u4e86\u70b9\u5206\u6811\uff0c\u786e\u5b9e\uff0c\u8fd9\u4e1c\u897f\u53ef\u4ee5\u5e2e\u6211\u4eec $\\log n$ \u6b21\u8be2\u95ee\u4ee5\u5185\u5b9a\u4f4d\u5230 $x$ \u3002\u5728\u5206\u6cbb\u6811\u4e0a\u8dd1\uff0c\u6bcf\u6b21`explore(\u5206\u6cbb\u4e2d\u5fc3,y)` \uff0c\u4ece\u5f97\u5230\u7684\u70b9\u5f80\u4e0a\u8df3\u5c31\u80fd\u77e5\u9053\u5b83\u5728\u54ea\u4e2a\u5206\u6cbb\u5b50\u6811\uff0c\u8fd9\u6837 $\\log n$ \u6b21 \u4ee5\u5185\u5c31\u53ef\u4ee5\u627e\u5230\u6211\u4eec\u60f3\u8981\u7684\u70b9\u4e86\u3002\n\n\u4f46\u662f\u8fd9\u4e2a\u70b9\u5206\u6811\u663e\u7136\u662f\u52a8\u6001\u52a0\u70b9\u7684\u3002\u7136\u800cWC\u524d\u51e0\u5e74\u7684\u4e00\u9053\u9898\u5bf9\u4e8e\u52a8\u6001\u70b9\u5206\u6811\u8d77\u5230\u4e86\u826f\u597d\u7684\u666e\u53ca\u6548\u679c\uff1a\u7d2b \u8346 \u82b1 \u4e4b \u604b \u3002\u4e0a\u6b21\u8fd9\u9898\u5199\u7684\u4e0d\u987a\u5229\u4e5f\u662f\u6211\u6709\u70b9\u6015\u52a8\u6001\u70b9\u5206\u6811\u7684\u539f\u56e0\u3002\n\n\u70b9\u5206\u6811\u8fc7\u4e8e\u4e0d\u5e73\u8861\u7684\u65f6\u5019\u66ff\u7f6a\u7f8a\u91cd\u6784\u5373\u53ef\uff0c\u4e0d\u8fc7\u591a\u8d58\u8ff0\u505a\u6cd5\u4e86\uff0c\u4e0d\u4f1a\u7684\u770b\u90a3\u9898\u53bb\uff08\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$ \uff0c\u8be2\u95ee\u6b21\u6570 $O(n\\log n)$ \u3002\n\n\u975e\u5e38\u663e\u7136\uff0c$n\\log n > T$ \uff0c\u4f46\u662f\u8fd9\u4e2a $\\log n$ \u5728\u5f00\u59cb\u70b9\u5206\u6811\u6ca1\u6709\u5efa\u6ee1\u7684\u65f6\u5019\u8dd1\u4e0d\u6ee1\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u53ef\u4ee5\u88ab\u5361\u6210\u4ec0\u4e48\u6837\u5b50\uff0c\u6240\u4ee5\u6211\u8fd8\u662f\u968f\u673a\u53d6\u4e00\u4e2a\u672a\u77e5\u70b9\u8fdb\u884c\u6269\u5c55\u3002\n\n----------\n\n\u63a5\u4e0b\u53bb\u8bf4\u8bf4\u6211\u4e3a\u5565\u591a\u8c03\u4e861.5h\u4ee3\u7801\u3002\u56e0\u4e3a\u6211\u672c\u5730\u9020\u4e86\u4e00\u4e2a\u6bd4\u8f83\u5f3a\u608d\u7684\u6570\u636e\uff0c\u5c31\u662f\u94fe\u5e95\u4e0b\u6302\u4e00\u4e2a\u5927\u83ca\u82b1\u3002\u5176\u5b9e\u8fd9\u4e2a\u6570\u636e\u8fc7\u4e86\u57fa\u672c\u4e0a\u5c31\u7a33\u4e86\u3002\n\n\u6211\u7684\u7a0b\u5e8f\u83ab\u540d\u5176\u5999RE\u4e86\uff0c\u6ca1\u6709\u9664\u6cd5\u6ca1\u6709\u8d8a\u754c\uff0c\u5728\u627e\u91cd\u5fc3\u7684\u65f6\u5019\u8dd1\u4e86\u4e00\u534a\u5c31\u6bb5\u9519\u8bef\u4e86\u3002\u6211\u975e\u5e38\u8ff7\u60d1\uff0c\u627e\u4e86\u5927\u698240min\u60f3\u8d77\u6765\u53ef\u80fd\u662f\u6ca1\u5f00\u6808\uff0c`ulimit 512000000` \u3002\uff08\u4f60\u4eec\u90fd\u5e94\u8be5\u770b\u7684\u51fa\u6765\u6211\u5f00\u7684\u662f512G\u5427\uff0c\u663e\u7136\u5f00\u4e0d\u4e0b\uff0c\u76f8\u5f53\u4e8e\u5565\u90fd\u6ca1\u5e72\uff09\n\nRE\u5230\u4e86\u4e0b\u8bfe\uff0c$\\color{black}{\\texttt{F}}\\color{red}{\\texttt{orever\\_Pursuit}}$ \u8fc7\u6765\u968f\u624b `ulimit 512000` \u5c31\u8fc7\u4e86\uff0c\u4e00\u4ea4\u5c31AC\u4e86\u3002\u3002\u3002\n\n\u4ee3\u7801\u7a0d\u5fae\u52a0\u4e86\u70b9\u6ce8\u91ca\uff0c\u5982\u679c\u771f\u7684\u8981\u770b\u51d1\u5408\u7740\u770b\u5427\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#include \"rts.h\"\nusing namespace std;\n#define pb push_back\n#define sz(v) (int)v.size()\n#define rep(i,x,y) for(int i=x,i##end=y;i<=i##end;++i)\n#define per(i,x,y) for(int i=x,i##end=y;i>=i##dnd;--i)\ntemplate<class T>inline bool ckmax(T&x,T y){return x<y?x=y,1:0;}\ntemplate<class T>inline bool ckmin(T&x,T y){return x>y?x=y,1:0;}\ntypedef long long LL;\ntypedef double db;\nconst int N=300005;\nint rd,a[N];\nbool vis[N];\n\nstruct RAND{\nconst int basic=(1<<30)-1;\nunsigned long long sa,sb,sc;\nRAND(){\n\tsrand(time(0));\n\tfor(int i=0,up=::rand()%100;i<=up;++i)::rand();\n\tsrand(::rand()^clock()),sa=1ull*::rand()*::rand()*::rand();\n\tfor(int i=0,up=::rand()%100;i<=up;++i)::rand();\n\tsrand(::rand()^clock()),sb=1ull*::rand()*::rand()*::rand();\n\tfor(int i=0,up=::rand()%100;i<=up;++i)::rand();\n\tsrand(::rand()^clock()),sc=1ull*::rand()*::rand()*::rand();\n}\nint rand(){\n\tsa^=sa<<32,sa^=sa>>13,sa^=sa<<1;\n\tunsigned long long t=sa;\n\tsa=sb,sb=sc,sc^=t^sa;\n\treturn sc&basic;\n}\nint rad(int l,int r){return rand()%(r-l+1)+l;}\n}mk;\n\nnamespace data3{\n\nvoid cov(int x,int y){\n\tvis[x]=1;\n\twhile(x!=y)rd=explore(x,y),vis[x=rd]=1;\n}\nvoid main(const int&n){\n\tint l=1,r=1;\n\trep(i,2,n){\n\t\tint u=a[i];\n\t\tif(vis[u])continue;\n\t\tif(!vis[rd=explore(l,u)])cov(rd,u),l=u;\n\t\telse cov(r,u),r=u;\n\t}\n}\n\n}\n\nnamespace std{\n\nconst db alpha=0.75;\nvector<int>e[N],to[N];\nint fa[N],mx[N],rt,tsize,siz[N],reb,vt[N],sz[N],root;//sz\u662f\u5206\u6cbb\u6811\u7684\u5927\u5c0f\uff0cvt\u662f\u5206\u6cbb\u6811\u4e0a\u7684\u7236\u4eb2\nbool used[N];\nvoid getrt(int u,int ft){//\u627e\u91cd\u5fc3\n\tsiz[u]=1,mx[u]=0;\n\tfor(int i=0,up=sz(e[u]);i<up;++i){\n\t\tint v=e[u][i];\n\t\tif(v==ft||used[v])continue;\n\t\tgetrt(v,u),siz[u]+=siz[v];\n\t\tckmax(mx[u],siz[v]);\n\t}\n\tckmax(mx[u],tsize-siz[u]);\n\tif(mx[u]<mx[rt])rt=u;\n}\nvoid pia(int u){//\u62cd\u6241\uff0c\u540c\u65f6\u7ed9\u8981\u91cd\u6784\u7684\u70b9\u6253\u6807\u8bb0\n\t++tsize,used[u]=0;\n\tfor(int v:to[u])pia(v);\n\tto[u].clear();\n}\nvoid dfs_build(int u){//\u666e\u901a\u5efa\u7acb\u70b9\u5206\u6811\n\tused[u]=1,sz[u]=1;\n\tfor(int i=0,up=sz(e[u]);i<up;++i){\n\t\tint v=e[u][i];\n\t\tif(used[v])continue;\n\t\trt=0,tsize=siz[v],getrt(v,u);\n\t\tint tmp=rt;//\u4e00\u5b9a\u8981\u5b58\u4e00\u4e0b\uff0crt\u5728\u53d8\n\t\tto[u].pb(rt),vt[rt]=u,dfs_build(rt),sz[u]+=sz[tmp];\n\t}\n}\nvoid rebuild(int u){//\u91cd\u6784\n\trt=0,tsize=0,pia(u);\n\tgetrt(u,0);\n\tif(u==root)root=rt;\n\tif(vt[u])\n\t\tfor(int i=0,up=sz(to[vt[u]]);i<up;++i)if(to[vt[u]][i]==u)to[vt[u]][i]=rt;\n\tvt[rt]=vt[u];\n\tdfs_build(rt);\n}\nvoid dfs_ins(int x,int ft){//\u70b9\u5206\u6811\u4e0a\u63d2\u5165\u4e00\u6761\u8fb9\uff0cft\u5df2\u7ecf\u5728\u6811\u4e0a\n\tused[x]=vis[x]=1;\n\tfa[x]=vt[x]=ft,to[ft].pb(x),e[ft].pb(x),e[x].pb(ft);\n\tfor(int i=x;i;i=vt[i])++sz[i];\n\treb=0;\n\tfor(int i=x;vt[i];i=vt[i])if(sz[i]>1.*sz[vt[i]]*alpha)reb=vt[i];\n\tif(reb)rebuild(reb);\n}\nvoid solve(int u,int t){//\u627e\u5230\u90a3\u4e2a\u70b9\u5e76\u4e14\u52a0\u8fb9\n\trd=explore(u,t);\n\tif(!vis[rd]){\n\t\tint x=rd;\n\t\tdfs_ins(x,u);\n\t\twhile(x!=t){\n\t\t\trd=explore(x,t);\n\t\t\tdfs_ins(rd,x);\n\t\t\tx=rd;\n\t\t}\n\t\treturn;\n\t}\n\twhile(vt[rd]!=u)rd=vt[rd];\n\tsolve(rd,t);\n}\nvoid main(const int&n){\n\tvis[1]=1,mx[rt=0]=n,sz[1]=1,used[1]=1,root=1;\n\trep(i,2,n){\n\t\tint u=a[i];\n\t\tif(vis[u])continue;\n\t\tsolve(root,u);\n\t}\n}\n}\n\nvoid play(int n,int T,int dataType){\n\tvis[1]=1;\n\trep(i,2,n)a[i]=i;\n\trep(i,2,n)swap(a[i],a[mk.rad(2,n)]);//\u968f\u673a\u64cd\u4f5c\u5e8f\u5217\n\tif(dataType==3)data3::main(n);\n\telse std::main(n);\n}\n\n```\n\n\n\n",
        "postTime": 1607580708,
        "uid": 123384,
        "name": "tommy0221",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6541 \u3010[WC2018]\u5373\u65f6\u6218\u7565\u3011"
    },
    {
        "content": "### \u94fe\u7684\u60c5\u51b5\n\n\u81f3\u591a\u53ea\u5141\u8bb8 $n+20$ \u6b21\u64cd\u4f5c\u3002\n\n\u6ce8\u610f\u5230\u4efb\u610f\u65f6\u523b\u5df2\u77e5\u8303\u56f4\u4e00\u5b9a\u662f\u4e00\u6761\u94fe\uff0c\u8bbe\u7aef\u70b9\u5206\u522b\u4e3a $l,r$\u3002\n\n\u6bcf\u6b21\u4ece\u672a\u77e5\u7ed3\u70b9\u4e2d\u968f\u673a\u9009\u4e00\u4e2a\u6269\u5c55\u3002\n\n\u6269\u5c55\u4e00\u4e2a\u70b9 $i$ \u65f6\u80fd\u591f\u6269\u5c55\u5230\u672a\u77e5\u7ed3\u70b9\u7684\u67e5\u8be2\u53ea\u6709 $(l,i)$ \u548c $(r,i)$\u3002\n\n\u4ece $l,r$ \u4e2d\u968f\u673a\u9009\u4e00\u4e2a\u5e76\u67e5\u8be2\uff0c\u5982\u679c\u8fd4\u56de\u7684\u7ed3\u70b9\u5df2\u77e5\uff0c\u5c31\u9009\u53e6\u4e00\u4e2a\u518d\u6b21\u67e5\u8be2\u3002\n\n\u7136\u540e\u4e0d\u65ad\u67e5\u8be2\u76f4\u5230\u6269\u5c55\u5230 $i$\u3002\n\n\u8bbe $1$ \u5de6\u4fa7\u672a\u77e5\u7ed3\u70b9\u96c6\u5408\u4e3a $L$\uff0c\u53f3\u4fa7\u4e3a $R$\u3002\n\n\u6bcf\u6269\u5c55\u4e00\u4e2a\u70b9 $i$\uff0c$L$ \u548c $R$ \u4e2d\u5c31\u6709\u4e00\u4e2a\u5927\u5c0f\u671f\u671b\u51cf\u534a\u3002\n\n\u6bcf\u6269\u5c55\u4e00\u4e2a\u70b9 $i$\uff0c\u6709\u4e00\u534a\u7684\u6982\u7387\u65b0\u589e\u4e00\u4e2a\u672a\u6269\u5c55\u5230\u672a\u77e5\u7ed3\u70b9\u7684\u67e5\u8be2\u3002\n\n\u6240\u4ee5\u67e5\u8be2\u603b\u6570\u7ea6\u4e3a $n+\\log n$\u3002\n\n\u770b\u8d77\u6765 $n+20$ \u6b21\u7684\u9650\u5236\u5f88\u5361\uff1f\n\n\u5176\u5b9e\u5199\u4e00\u4e2a\u9012\u63a8\u7a0b\u5e8f\u4f1a\u53d1\u73b0\u6700\u574f\u60c5\u51b5\uff08$n=300000$\uff0c$1$ \u7ed3\u70b9\u4f4d\u4e8e\u94fe\u4e2d\u70b9\uff09\u4e0b\uff0c\u671f\u671b\u67e5\u8be2\u6b21\u6570\u4e5f\u4e0d\u5230 $300012$ \u6b21\u3002\n\n### \u4e00\u822c\u60c5\u51b5\n\n\u81f3\u591a\u5141\u8bb8\u7ea6 $n\\log n$ \u6b21\u64cd\u4f5c\u3002\n\n\u548c\u94fe\u7684\u60c5\u51b5\u4e0d\u540c\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u53f6\u5b50\u7ed3\u70b9\u4f1a\u6709 $O(n)$ \u4e2a\uff0c\u4e0d\u80fd\u679a\u4e3e\u3002\n\n\u9700\u8981\u5feb\u901f\u7f29\u5c0f\u67e5\u8be2\u8303\u56f4\uff0c\u60f3\u5230\u70b9\u5206\u6cbb\u3002\n\n\u56e0\u4e3a\u8981\u591a\u6b21\u67e5\u8be2\uff0c\u8fd8\u8981\u52a0\u70b9\uff0c\u6240\u4ee5\u8981\u52a8\u6001\u70b9\u5206\u6811\uff0c\u4e0d\u4f1a\u7684\u53ef\u4ee5\u53c2\u8003[\u6811\u5206\u6cbb\u5b66\u4e60\u7b14\u8bb0](https://www.luogu.com.cn/blog/221955/shu-fen-zhi-zong-jie-dian-bian-fen-zhi-dian-bian-fen-shu-post)\u3002\n\n\u4f9d\u7136\u662f\u6bcf\u6b21\u4ece\u672a\u77e5\u7ed3\u70b9\u4e2d\u968f\u673a\u9009\u4e00\u4e2a\u6269\u5c55\u3002\n\n\u7136\u540e\u4ece\u6839\u7ed3\u70b9\u5f00\u59cb\uff0c\u6bcf\u6b21\u67e5\u8be2 $explore(j,i)=l$\uff0c\u7136\u540e\u8df3 $l$ \u7684\u7236\u4eb2\uff0c\u76f4\u5230\u8df3\u5230 $k$ \u4f7f\u5f97 $fa_k=j$\uff0c\u90a3\u4e48\u6240\u6c42\u53f6\u7ed3\u70b9\u5728 $k$ \u7684\u70b9\u5206\u6811\u5b50\u6811\u5185\u3002\n\n\u4e00\u76f4\u67e5\u8be2\u76f4\u5230 $k$ \u4e3a\u672a\u77e5\u7ed3\u70b9\uff0c\u7136\u540e\u7ee7\u7eed\u67e5\u8be2 $(k,i)$ \u76f4\u5230 $i$ \u88ab\u6269\u5c55\uff0c\u8fd9\u6837 $1$ \u5230 $i$ \u7684\u94fe\u90fd\u88ab\u6269\u5c55\u3002\n\n\u56e0\u4e3a\u70b9\u5206\u6811\u6811\u9ad8\u662f\u4e25\u683c $\\log n$\uff0c\u800c\u4e14\u5e38\u6570\u4e0d\u6ee1\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u672c\u9898\u4e0d\u5361\u5e38\uff0c$\\alpha$ \u53ef\u4ee5\u8bbe\u5f97\u5c0f\u4e00\u70b9\uff0c\u8fd9\u6837\u6811\u9ad8\u66f4\u4f4e\u3002\n\n\u5f88\u77ed\u7684\u4ee3\u7801\uff01~~\u7136\u800c\u53ef\u8bfb\u6027\u4e0d\u592a\u597d~~\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint explore(int,int);\nconst int N=3e5+3;\nint a[N],f[N],o,m,r,sz[N];\nbool v[N],b[N];\nmt19937 rd(1);\nbasic_string<int>g[N],h,e[N];\nvoid gr(int x,int y){//\u6c42\u91cd\u5fc3\n\th+=x,sz[x]=1;\n\tint w=0;\n\tfor(int i:e[x])if(b[i]&&i!=y)gr(i,x),sz[x]+=sz[i],w=max(w,sz[i]);\n\tif((w=max(w,m-sz[x]))<=o)o=w,r=x;\n}\nvoid wk(int x){//\u70b9\u5206\u6cbb\n\tb[x]=0,g[x]=h;\n\tint l=m;\n\tfor(int i:e[x])if(b[i])o=m=sz[i]<sz[x]?sz[i]:l-sz[x],h={},gr(i,0),f[r]=x,wk(r);\n}\nvoid play(int n,int T,int d){\n\tint i,j,k,l,u,x,y;\n\tif(iota(a,a+n,1),shuffle(a+1,a+n,rd),u=v[1]=1,d==3){//\u94fe\u7684\u90e8\u5206\n\t\tint c[2]={1,1};\n\t\tfor(l=1;l<n;++l)if(!v[i=a[l]]){\n\t\t\tif(j=explore(c[k=rd()&1],i),v[j])j=explore(c[!k],i),c[!k]=i;else c[k]=i;\n\t\t\tfor(;v[j]=1,j!=i;j=explore(j,i));\n\t\t}\n\t\treturn;\n\t}\n\tfor(l=1,g[1]+=1;l<n;++l)if(!v[i=a[l]]){\n\t\tfor(j=u;;j=k)if(v[k=explore(j,i)])for(;f[k]!=j;k=f[k]);else break;//\u70b9\u5206\u6811\u4e0a\u7f29\u5c0f\u67e5\u8be2\u8303\u56f4\n\t\tfor(;j!=i;){//\u7ee7\u7eed\u6269\u5c55\u4e00\u6761\u94fe\n\t\t\tfor(v[k]=1,f[k]=j,e[j]+=k,e[k]+=j,j=k,h={};j;j=f[j])g[j]+=k,h+=j;\n\t\t\tfor(x=h.size()-1;x;--x)if(g[y=h[x]].size()*.7<g[h[x-1]].size()){//\u52a8\u6001\u70b9\u5206\u6811\u91cd\u6784\n\t\t\t\tfor(int o:h=g[y])b[o]=1;\n\t\t\t\tif(o=m=h.size(),h={},gr(y,0),y==u)u=r;\n\t\t\t\tf[r]=f[y],wk(r);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(j=k,j!=i)k=explore(j,i);\n\t\t}\n\t}\n}\n```\n",
        "postTime": 1618987580,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "P6541 [WC2018]\u5373\u65f6\u6218\u7565\uff08\u52a8\u6001\u70b9\u5206\u6811\uff09"
    },
    {
        "content": "~~\u8fd9\u662f\u4e00\u7bc7\u6c42\u52a9...~~\n\n\u8003\u8651\u5b9e\u65f6\u88ab\u6807\u8bb0\u7684\u70b9\u4e00\u5b9a\u662f\u4e00\u4e2a\u8fde\u901a\u5757\uff0c\u6211\u4eec\u7528 LCT \u7ef4\u62a4\u5176\u3002\n\n\u6bcf\u6b21\u968f\u673a\u52a0\u5165\u4e00\u4e2a\u672a\u88ab\u6807\u8bb0\u7684\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u627e\u5230\u5176\u5728\u5f53\u524d\u8fde\u901a\u5757\u6df1\u5ea6\u6700\u5927\u7684\u7956\u5148\u3002\n\n\u4e0d\u59a8\u4ece $1$ \u53f7\u8282\u70b9\u5f00\u59cb\u5728 Splay \u4e0a\u8fdb\u884c\u4e8c\u5206\uff0c\u901a\u8fc7\u5de6\u53f3\u5b50\u6811/\u524d\u9a71/\u540e\u7ee7\u7684\u5173\u7cfb\u6765\u67e5\u627e\u5176\u4f4d\u7f6e\u3002\n\n\u7136\u540e\u627e\u5230\u4e4b\u540e\u6211\u4eec\u6cbf\u9014\u4e00\u76f4\u8d70\u4e0b\u53bb\u5373\u53ef\u3002\n\nSplay \u4e8c\u5206\u6cbf\u9014\u7ecf\u8fc7\u7684\u70b9\u6570\u548c\u4ece $x$ \u5f00\u59cb\u8fdb\u884c access \u7ecf\u8fc7\u7684\u70b9\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u7406\u8bba\u590d\u6742\u5ea6\u5e94\u8be5\u662f $\\mathcal O(n\\log n)$ \u5427\uff1f\n\n\u7136\u800c\u88ab UOJ \u7684 Hack \u6570\u636e\u5361\u4e86...\u6709\u6ca1\u6709\u9e3d\u9e3d\u6559\u5bfc\u6211\u554a TAT\n\n$Code:$\n\n```cpp\n#include \"rts.h\"\n#include<bits/stdc++.h>\nusing namespace std ;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define ls(x) t[x].ch[0]\n#define rs(x) t[x].ch[1]\nconst int N = 3e5 + 5 ; \nint a[N], vis[N] ; \nstruct LCT {\n\tint fa, ch[2], l, r ; \n} t[N] ; \nvoid pushup(int x) {\n\tt[x].l = t[x].r = x ; \n\tif(ls(x)) t[x].l = t[ls(x)].l ;\n\tif(rs(x)) t[x].r = t[rs(x)].r ; \n}\nbool isroot(int x) {\n\treturn (ls(t[x].fa) != x) && (rs(t[x].fa) != x) ; \n}\nvoid rotate( int x ) {\n\tint f = t[x].fa, ff = t[f].fa, d = (rs(f) == x), c = t[x].ch[d ^ 1] ; \n\tt[x].fa = ff ; \n\tif( !isroot(f) ) t[ff].ch[rs(ff) == f] = x ; \n\tt[f].fa = x, t[x].ch[d ^ 1] = f, t[c].fa = f, t[f].ch[d] = c, \n\tpushup(f), pushup(x) ; \n}\nint st[N], top ; \nvoid Splay( int x ) {\n\twhile( !isroot(x) ) {\n\t\tint f = t[x].fa, ff = t[f].fa ; \n\t\tif( !isroot(f) ) ((rs(ff) == f) ^ (rs(f) == x)) ? rotate(x) : rotate(f) ; \n\t\trotate(x) ; \n\t}\n}\nvoid access( int x ) {\n\tfor( re int y = 0; x; y = x, x = t[x].fa ) Splay(x), rs(x) = y, pushup(x) ; \n}\nvoid link( int x, int f ) { t[x].fa = f, access(x), Splay(x) ; }\nvoid Go( int u, int x ) {\n\tint bef = u ; \n\twhile( u != x ) {\n\t\tu = explore(u, x), vis[u] = 1, link(u, bef), bef = u ; \n\t}\n}\nint Sol( int u, int x ) {\n\tSplay(u) ;  \n\twhile(1) {\n\t\tint v = explore(u, x) ; \n\t\tif( !vis[v] ) { link(v, u) ; return v ; }\n\t\tif( v == t[ls(u)].r ) u = ls(u) ; \n\t\telse if( v == t[rs(u)].l ) u = rs(u) ;\n\t\telse return v ; \n\t}\n}\nvoid solve( int x ) {\n\tint u = 1 ; \n\twhile(vis[u]) u = Sol(u, x) ; \n\tvis[u] = 1 ; \n\tGo(u, x), access(x), Splay(x) ;  \n}  \nvoid solve2(int n) {\n\trep( i, 2, n ) if( !vis[a[i]] ) solve(a[i]) ; \n}\nvoid play(int n, int T, int dataType) {\n\tsrand(time(NULL)) ; pushup(1) ; \n\trep( i, 2, n ) a[i] = i ; vis[1] = 1 ; \n\trandom_shuffle( a + 2, a + n + 1 ) ; \n\tsolve2(n) ; \n}\n```",
        "postTime": 1596249307,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6541 \u3010[WC2018]\u5373\u65f6\u6218\u7565\u3011"
    },
    {
        "content": "\u9898\u89e3\uff1a\u9996\u5148\u53d1\u73b0\u5bf9\u4e8edatatype=3\u7684\u70b9\uff0c\u5141\u8bb8\u7684\u8be2\u95ee\u6b21\u6570\u662f$O(n+log_n)$\u7ea7\u522b\u7684\u3002\u90a3\u4e48\u5148\u8003\u8651\u6811\u662f\u4e00\u6761\u94fe\u7684\u60c5\u51b5\u3002\n\n\u8003\u8651\u5f53\u524d\u6211\u4eec\u5df2\u7ecf\u627e\u5230\u4e86\u8fd9\u4e2a\u94fe\u7684\u4e2d\u95f4\u4e00\u6bb5\uff0c\u6211\u4eec\u79f0\u5176\u5de6\u7aef\u70b9\u4e3a$l$\uff0c\u53f3\u7aef\u70b9\u4e3a$r$\uff0c\u90a3\u4e48\u6b64\u65f6\u6709\u610f\u4e49\u7684\u8be2\u95ee\u663e\u7136\u662f$(l/r,x)$\uff0c$x$\u662f\u4e00\u4e2a\u672a\u88ab\u63a2\u7d22\u5230\u7684\u70b9\u3002\u6211\u4eec\u79f0\u4e00\u6b21\u8be2\u95ee\u201c\u5931\u8d25\u201d\uff0c\u5f53\u4e14\u4ec5\u5f53\u8be2\u95ee\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u5df2\u77e5\u7684\u8282\u70b9\u3002\u5982\u679c\u4e00\u6b21\u8be2\u95ee\uff08\u5047\u8bbe\u662f$(l,x)$\uff09\u6210\u529f\u4e86\uff0c\u90a3\u4e48\u4ece$l$\u4e00\u76f4\u5f80\u5de6\u62d3\u5c55\uff0c\u6211\u4eec\u5c31\u80fd\u627e\u5230$l$\u5230$x$\u8fd9\u6761\u94fe\u4e0a\u7684\u6240\u6709\u70b9\u3002\u5426\u5219$x$\u4e00\u5b9a\u5728$r$\u90a3\u8fb9\uff0c\u6211\u4eec\u5411\u53f3\u62d3\u5c55\uff0c\u4e5f\u80fd\u627e\u5230\u4e00\u6761\u94fe\u4e0a\u7684\u6240\u6709\u70b9\u3002\n\n\u8003\u8651\u6bd2\u7624\u51fa\u9898\u4eba\u53ef\u80fd\u4f1a\u53ef\u4ee5\u9020\u6570\u636e\u5361\u4f60\uff0c\u6211\u4eec\u628a$[2,n]$\u8fd9\u4e2a\u5e8f\u5217random_shuffle\u4e00\u4e0b\uff0c\u8fd9\u6837\uff0c\u5982\u679c\u5f53\u524d\u8fd8\u6709$m$\u4e2a\u70b9\u6ca1\u88ab\u63a2\u7d22\u5230\uff0c\u4e00\u6b21\u63a2\u7d22\u8fc7\u7a0b\u671f\u671b\u80fd\u627e\u5230$\\frac{m}{2}$\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u53ea\u4f1a\u6709logn\u6b21\u63a2\u7d22\u8fc7\u7a0b\u3002\u7531\u4e8e\u6bcf\u6b21\u63a2\u7d22\u8fc7\u7a0b\u53ea\u6709\u5728\u7b2c\u4e00\u6b21\u63a2\u7d22\u65f6\u53ef\u80fd\u4f1a\u5931\u8d25\uff0c\u6240\u4ee5\u5931\u8d25\u7684\u671f\u671b\u6b21\u6570\u662f$O(logn)$\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u518d\u8003\u8651datatype=1,2\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u7684\u64cd\u4f5c\u6b21\u6570\u9650\u5236\u5927\u6982\u662f$O(nlogn)$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u6b21\u9700\u8981\u53ea\u7528log\u6b21\u8be2\u95ee\u5c31\u627e\u5230\u4e00\u4e2a\u672a\u88ab\u8bbf\u95ee\u7684\u70b9\u3002\u5148\u8003\u8651\u4e00\u4e2a$O(n^2)$\u7684\u66b4\u529b\u505a\u6cd5\uff1a\u6bcf\u6b21\u90fd\u4ece1\u53f7\u8282\u70b9\u5f00\u59cb\u63a2\u7d22\u3002\u5bf9\u4e8edatatype=2\u7684\u60c5\u51b5\uff0c\u8fd9\u6837\u505a\u662f\u6b63\u786e\u7684\uff0c\u56e0\u4e3a\u8fd9\u68f5\u6709\u6839\u6811\u7684\u6700\u5927\u6df1\u5ea6\u662f$O(logn)$\u7ea7\u522b\u7684\u3002\u90a3\u4e48\u8003\u8651\u5bf9\u4e8e\u666e\u901a\u60c5\u51b5\uff0c\u5982\u4f55\u5c06\u6bd4\u8f83\u6df1\u7684\u6811\u8f6c\u5316\u4e3a\u4e00\u68f5\u6bd4\u8f83\u201c\u5747\u8861\u201d\u7684\u6811\u3002\n\n\u60f3\u5230\u505a\u52a8\u6001\u70b9\u5206\u6cbb\u65f6\uff0c\u70b9\u5206\u6811\u7684\u6df1\u5ea6\u662f$O(logn)$\u7684\uff0c\u90a3\u4e48\u8003\u8651\u5bf9\u4e8e\u5df2\u7ecf\u901a\u8fc7\u63a2\u7d22\u5f97\u5230\u7684\u8fb9\uff0c\u5efa\u51fa\u5b83\u7684\u70b9\u5206\u6811\u3002\u8fd9\u6837\uff0c\u6bcf\u6b21\u53ea\u9700\u8981\u6700\u591a$O(logn)$\u6b21\u8be2\u95ee\uff0c\u5c31\u80fd\u627e\u5230\u81f3\u5c11\u4e00\u4e2a\u672a\u88ab\u8bbf\u95ee\u7684\u70b9\u3002\n\n\u4f46\u662f\u8003\u8651\u5c06\u65b0\u627e\u5230\u7684\u70b9\u52a0\u5165\u540e\uff0c\u70b9\u5206\u6811\u7684\u5e73\u8861\u6027\u53ef\u80fd\u4f1a\u88ab\u7834\u574f\uff0c\u4f46\u6211\u4eec\u53c8\u4e0d\u53ef\u80fd\u6bcf\u6b21\u90fd\u91cd\u6784\u70b9\u5206\u6811\uff0c\u90a3\u4e48\u8003\u8651\u66ff\u7f6a\u7f8a\u6811\u7684\u601d\u60f3\uff0c\u5b9a\u4e49\u4e00\u4e2aalpha\u503c\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5206\u6cbb\u4e2d\u5fc3$u$\uff0c\u5982\u679c\u5728\u70b9\u5206\u6811\u4e0a\u5b58\u5728\u4e00\u4e2a\u513f\u5b50\u7684$siz>siz_u\\times alpha$\uff0c\u6211\u4eec\u5c31\u91cd\u6784\u8fd9\u4e2a\u5206\u6cbb\u4e2d\u5fc3\u7684\u70b9\u5206\u6811\uff08\u53ea\u4fee\u6539\u70b9\u5206\u6811\u4e0a\u7684\u4e00\u4e2a\u5b50\u6811\uff09\u3002\u90a3\u4e48\u6211\u4eec\u6bcf\u6b21\u627e\u5230\u4e00\u4e9b\u65b0\u8282\u70b9\u5e76\u52a0\u5165\u70b9\u5206\u6811\u540e\uff0c\u8df3\u4e00\u4e0bfather\uff0c\u627e\u5230\u70b9\u5206\u6811\u4e0a\u6df1\u5ea6\u6700\u5c0f\u7684\u9700\u8981\u91cd\u6784\u7684\u70b9$u$\uff0c\u8fdb\u884c\u91cd\u6784\u5373\u53ef\u3002\n\n\u5f53\u7136\u7528lct\u4e5f\u53ef\u4ee5\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\u3002\n\n\u64cd\u4f5c\u6b21\u6570\u548c\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f$O(nlogn)$\u7684\uff0c\u81f3\u4e8e\u91cd\u6784\u7684\u590d\u6742\u5ea6\u8bc1\u660e\uff0c\u53ef\u4ee5\u641c\u4e00\u4e0b\u6709\u5173\u66ff\u7f6a\u7f8a\u6811\u7684\u535a\u5ba2\u3002\n\n\u4ee3\u7801\uff1a\uff08wc\u7684\u6240\u6709\u6d4b\u8bd5\u70b9\u90fd\u8fc7\u4e86\uff0clog\u4e0a\u6b7b\u6d3b\u8fc7\u4e0d\u53bbextra test\uff0c~~\u65e0\u9650d\u9020\u6570\u636e\u4eba~~\uff09\n\n```c++\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<map>\n#include<cassert>\n#include \"rts.h\"\nusing namespace std;\n#define F(x,y,z) for(int x=y;x<=z;x++)\n#define FOR(x,y,z) for(int x=y;x>=z;x--)\n#define I void\n#define IN int\n#define C(x,y) memset(x,y,sizeof(x))\n#define STS system(\"pause\")\ntypedef double db;\nconst int INF=1e9+7;\n//IN explore(int,int);\nmap<int,int>mp[303000];\nint N,maxi,Son,lim,cano[300300],num,siz[303000],mx[303000],head[303000],v[303000],vis[303000],tot,sz[303000],fa[303000],xu[303000];\nint root,rot;\nI solve3(int n){\n\tF(i,2,n)xu[i]=i;sort(xu+2,xu+1+n);int L,R;L=R=1;\n\tv[1]=1;\n\tF(cur,2,n){\n\t\tif(v[xu[cur]])continue;\n\t\tint i=xu[cur],p=explore(L,i),now;\n\t\tif(!v[p]){\n\t\t\tnow=p;\n\t\t\twhile(1){\n\t\t\t\tv[now]=1;if(now==i)break;\n\t\t\t\tnow=explore(now,i);\n\t\t\t}\n\t\t\tL=i;\n\t\t}\n\t\telse{\n\t\t\tnow=explore(R,i);\n\t\t\twhile(1){\n\t\t\t\tv[now]=1;if(now==i)break;\n\t\t\t\tnow=explore(now,i);\n\t\t\t}\n\t\t\tR=i;\n\t\t}\n\t}\n}\nstruct E{\n\tint to,nt;\n}e[606000];\n#define T e[k].to\nI add(int x,int y){e[++tot].to=y;e[tot].nt=head[x];head[x]=tot;}\nI findroot(int &roo,int x,int fat){\n\tsiz[x]=1;mx[x]=0;\n\tfor(int k=head[x];k!=-1;k=e[k].nt){\n\t\tif(vis[T]||T==fat)continue;\n\t\tfindroot(roo,T,x);\n\t\tsiz[x]+=siz[T];mx[x]=max(mx[x],siz[T]);\n\t}\n\tmx[x]=max(mx[x],N-siz[x]);\n\tif(mx[x]<maxi)roo=x,maxi=mx[x];\n}\nI getroot(int &roo,int pos,int sum){\n\tmaxi=INF;N=sum;findroot(roo,pos,0);\n}\nI D_1(int x,int fat){\n\tsiz[x]=1;\n\tfor(int k=head[x];k!=-1;k=e[k].nt){\n\t\tif(T==fat||vis[T])continue;\n\t\tD_1(T,x);siz[x]+=siz[T];\n\t}\n}\nI divided(int x,int fat){\n//\tcerr<<\"#\"<<x<<\" \"<<fat<<endl;\n\tfa[x]=fat;mp[x].clear();\n\tD_1(x,fat);vis[x]=1;sz[x]=siz[x];\n\tfor(int k=head[x];k!=-1;k=e[k].nt){\n\t\tif(T==fat||vis[T])continue;\n\t\tint rt;getroot(rt,T,siz[T]);\n\t\tmp[x][T]=rt;divided(rt,x);\n\t}\n}\nI D_2(int x,int fat){\n\tvis[x]=0;num++;\n\tfor(int k=head[x];k!=-1;k=e[k].nt){\n\t\tif(cano[T]){if(T==lim)Son=x;continue;}if(T==fat)continue;\n\t\tD_2(T,x);\n\t}\n}\nI rebuild(int n){\n\tint pos=lim=fa[n];while(pos)cano[pos]=1,pos=fa[pos];\n//\tcerr<<\"!\"<<n<<endl;\n\tnum=0;D_2(n,0);\n\tint rt;getroot(rt,n,num);pos=fa[n];while(pos)cano[pos]=0,pos=fa[pos];\n\tif(n==root){root=rt;divided(root,0);}\n\telse{\n\t\tmp[lim][Son]=rt;assert(rt);divided(rt,lim);\n\t}\n}\nIN ck(int x,int y){\n\tdb w=x*0.6;if(w<y*1.0)return 1;\n\treturn 0;\n}/**/\nvoid play(int n,int _T,int type){\n\t/**/if(type==3)return solve3(n),void();\n\tF(i,2,n)xu[i]=i;random_shuffle(xu+2,xu+n+1);\n\tC(head,-1);tot=-1;\n\troot=v[1]=sz[1]=vis[1]=1;\n\tF(cur,2,n){\n\t\tif(v[xu[cur]])continue;\n//\t\tcerr<<\"@\"<<xu[cur]<<endl;\n\t\tint i=xu[cur],p=root,d;\n\t\twhile(1){\n//\t\t\tcerr<<\"@\";\n//\t\t\tassert(p);\n\t\t\td=explore(p,i);\n\t\t\tif(!v[d])break;\n\t\t\tp=mp[p][d];\n\t\t}\n\t\tint cnt=1,_son=d,now=d,sn=0;v[d]=1;add(p,d);add(d,p);\n\t\twhile(now^i){\n//\t\t\tcerr<<\"#\";\n\t\t\td=explore(now,i);cnt++;N++;\n\t\t\tadd(now,d);add(d,now);v[d]=1;\n\t\t\tnow=d;\n\t\t}\n\t\tgetroot(rot,now,cnt);mp[p][_son]=rot;divided(rot,p);\n\t\twhile(p^root){\n//\t\t\tcout<<\"$\";\n\t\t\tsz[p]+=cnt;if(ck(sz[fa[p]]+cnt,sz[p]))sn=fa[p];\n\t\t\tp=fa[p];\n\t\t}\n\t\tsz[root]+=cnt;\n\t\tif(sn)rebuild(sn);\n//\t\tF(j,1,n)if(v[j])cerr<<\"%\"<<j<<\" \"<<fa[j]<<endl;\n\t}\n}\n//g++ grader.cpp rts.cpp -o rts -O2\n```",
        "postTime": 1595254226,
        "uid": 93453,
        "name": "Purple_wzy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6541 \u3010[WC2018]\u5373\u65f6\u6218\u7565\u3011"
    },
    {
        "content": "\u4ea4\u4e86 100 \u591a\u6b21\uff0c\u603b\u7b97\u5361\u8fc7\u53bb\u4e86\u3002\u7eaa\u5ff5\u4e00\u4e0b\u3002\uff08\u6211\u4e0d\u662f\u8981\u5361\u8bc4\u6d4b\uff01\uff01\uff01\uff09\n\n\u770b\u4e86\u4e0b\u9898\u89e3\uff0c\u6ca1\u6709\u505a\u6cd5\u5b8c\u5168\u4e00\u6837\u7684\u3002\uff08\u4e0d\u8fc7\u8dd1\u5f97\u90fd\u6bd4\u6211\u7684\u5feb\n\n\u5148\u770b\u7b80\u5355\u7684Subtask 2 \u548c 3\u3002\n\n## Subtask 2\n\u7531\u4e8e\u662f\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c $1$ \u53f7\u7ed3\u70b9\u5230\u6bcf\u4e2a\u7ed3\u70b9\u7684\u8ddd\u79bb\u90fd\u662f $O(\\log n)$ \u7ea7\u522b\u7684\u3002\u76f4\u63a5\u66b4\u529b\u8df3\u5373\u53ef\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff1a\n```cpp\nvst[1]=1;\nif(dataType==2){\n\tfor(int i=2;i<=n;i++){\n\t\tif(vst[i])continue;\n\t\tfor(int j=1;j!=i;j=explore(j,i),vst[j]=1);\n\t}\n}\n```\n## Subtask 3\n\u6811\u7684\u5f62\u6001\u662f\u4e00\u6761\u94fe\uff0c\u8981\u6c42 `explore` \u6b21\u6570\u4e3a $n+\\log n$ \u3002\n\n\u7531\u4e8e\u662f\u4e00\u6761\u94fe\uff0c\u56e0\u6b64\u5df2\u63a2\u7d22\u7684\u90e8\u5206\u4e00\u5b9a\u4e5f\u662f\u4e00\u6761\u8fde\u901a\u7684\u94fe\u3002\n\n\u56e0\u6b64\uff0c\u6bcf\u9047\u5230\u4e00\u4e2a\u65b0\u7684\u70b9\uff0c\u4ece\u94fe\u7684\u4e24\u7aef\u8bd5\u7740\u8df3\u5373\u53ef\u3002\n\n\u8fd9\u91cc\u9700\u8981\u968f\u673a\u9009\u70b9\uff0c\u8fd9\u6837\u671f\u671b\u4e0b\u80fd\u8ba9\u6ca1\u63a2\u7d22\u7684\u90e8\u5206\u51cf\u5c11\u4e00\u534a\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u9009 $\\log n$ \u4e2a\u70b9\u5c31\u80fd\u8986\u76d6\u6574\u6761\u94fe\u3002\n\n\u6bcf\u4e2a\u70b9\u88ab\u9009\u4e2d\u5728\u786e\u5b9a\u65b9\u5411\u7684\u65f6\u5019\u6700\u591a\u4f1a\u6d6a\u8d39\u4e00\u6b21\u6b21\u6570\uff0c\u603b\u5171\u5c31\u662f $\\log n$ \u6b21\uff1b\u800c\u5176\u4ed6\u65f6\u5019\u6bcf\u6b21\u64cd\u4f5c\u90fd\u6709\u4e00\u4e2a\u65b0\u7684\u70b9\u52a0\u5165\uff0c\u56e0\u6b64\u603b\u6b21\u6570\u4e3a $n+\\log n$ \uff0c\u53ef\u4ee5\u63a5\u53d7\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff1a(\u7528 `set` \u548c `vector` \u5199\u7684\u53d6\u968f\u673a\u6570\uff0c\u5f88\u7b28\u91cd\uff0cdalao \u4eec\u53ef\u4ee5\u914c\u60c5\u4fee\u6539)\n```cpp\nset<int> S;\nS.clear();\nfor(int i=2;i<=n;i++)S.insert(i);\nvector<int> k;\nint L=1,R=1;\nwhile(!S.empty()){\n\tk.clear();\n\tfor(set<int>::iterator it=S.begin();it!=S.end();it++)k.push_back(*it);\n\tint p=k[rand()%k.size()];\n\tint tmp=explore(L,p);\n\tif(vst[tmp]){\n\t\tfor(int i=R;i!=p;i=explore(i,p),vst[i]=1,S.erase(i));\n\t\tR=p;\n\t}\n\telse{\n\t\tvst[tmp]=1;\n\t\tS.erase(tmp);\n\t\tfor(int i=tmp;i!=p;i=explore(i,p),vst[i]=1,S.erase(i));\n\t\tL=p;\n\t}\n}\n```\n\n## Subtask 1\n\u6811\u65e0\u7279\u6b8a\u5f62\u6001\uff0c\u8981\u6c42 `explore` \u6b21\u6570\u4e3a $O(n\\log n)$ \u7ea7\u522b\u3002\n\n\u66b4\u529b\u8df3\u80af\u5b9a\u662f\u4e0d\u884c\u4e86\uff0c\u8981\u8003\u8651\u5982\u4f55\u5feb\u901f\u5728\u5df2\u77e5\u7684\u6811\u4e0a\u786e\u5b9a\u4e00\u4e2a\u672a\u77e5\u7ed3\u70b9\u63a5\u5165\u7684\u4f4d\u7f6e\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u4e8e\u662f\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1a\n\n>\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u8981\u6c42\u786e\u5b9a\u4e00\u4e2a\u70b9\u7684\u4f4d\u7f6e\u3002\n>\n>\u4f60\u6bcf\u6b21\u53ef\u4ee5\u5bf9\u4e00\u4e2a\u70b9\u63d0\u51fa\u8be2\u95ee\uff1a\u8981\u6c42\u7684\u70b9\u5728\u8be2\u95ee\u7684\u70b9\u7684\u54ea\u4e00\u68f5\u5b50\u6811\u91cc\u3002\n>\n>\u8981\u6c42\u8be2\u95ee\u6b21\u6570 $O(\\log n)$ \u3002\n\n\u663e\u7136\uff0c\u6bcf\u6b21\u5bf9\u6811\u7684\u91cd\u5fc3\u8fdb\u884c\u8be2\u95ee\uff0c\u5c31\u53ef\u4ee5\u628a\u95ee\u9898\u7684\u89c4\u6a21\u964d\u4f4e\u4e00\u534a\uff0c\u4ece\u800c\u5728 $\\log n$ \u6b21\u8be2\u95ee\u4e2d\u627e\u51fa\u7ed3\u679c\u3002\n\n\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u4e00\u4e2a [75 \u5206\u505a\u6cd5](https://www.luogu.com.cn/record/77087446) \uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u672a\u8bbf\u95ee\u8fc7\u7684\u70b9\uff0c\u50cf\u524d\u9762\u90a3\u6837\u627e\u5230\u5728\u5df2\u77e5\u7684\u6811\u4e0a\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u6dfb\u52a0\u4e00\u6761\u94fe\u3002\n\n\u8fd9\u4e2a\u505a\u6cd5\u867d\u7136\u6ee1\u8db3\u4e86\u8be2\u95ee\u6b21\u6570\u7684\u6761\u4ef6\uff0c\u7136\u800c\u5b83\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(nk)$ \u7684(\u5176\u4e2d $k$ \u4e3a\u627e\u70b9\u7684\u4f4d\u7f6e\u5e76\u52a0\u70b9\u7684\u6b21\u6570)\uff0c\u56e0\u4e3a\u627e\u91cd\u5fc3\u7684\u590d\u6742\u5ea6\u662f $O(n)$ \u7684\uff1b\u663e\u7136\u4e00\u5f20\u83ca\u82b1\u56fe\u5c31\u80fd\u628a\u5b83\u5361\u5230 $O(n^2)$ \u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u6bcf\u6b21\u90fd\u627e\u91cd\u5fc3\u592a\u6d6a\u8d39\u4e86\uff0c\u5c24\u5176\u662f\u5f88\u591a\u65f6\u5019\u91cd\u5fc3\u6839\u672c\u6ca1\u6709\u79fb\u52a8\u3002\n\n\u800c\u5173\u4e8e\u91cd\u5fc3\uff0c\u5f88\u5bb9\u6613\u5c31\u80fd\u60f3\u5230\u70b9\u5206\u6811\u3002\n\n\u8fd9\u91cc\u6709\u4eba\u4e5f\u8bb8\u4f1a\u8bf4\uff1a\n\n\u201c\u6bcf\u52a0\u5165\u4e00\u4e2a\u65b0\u70b9\uff0c\u70b9\u5206\u6811\u7684\u5f62\u6001\u5c31\u4f1a\u53d8\u5316\uff0c\u600e\u4e48\u7ef4\u62a4\uff1f\u201d\n\n\u7b54\u6848\u662f\uff0c\u8fd9\u91cc**\u5e76\u4e0d\u9700\u8981\u7ef4\u62a4\u7cbe\u786e\u7684\u70b9\u5206\u6811**\u3002\u53ea\u8981\u5927\u6982\u80fd\u4fdd\u8bc1\u590d\u6742\u5ea6\u5c31\u884c\u4e86\u3002\n\n\u6211\u7ed9\u51fa\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff1a\u6bcf\u52a0\u5165\u4e00\u5b9a\u91cf\u7684\u70b9\uff0c\u5c31\u91cd\u6784\u4e00\u6b21\u70b9\u5206\u6811\u3002\uff08\u6211\u786e\u5b9e\u6ca1\u60f3\u5230\u66ff\u7f6a\u7f8a\u6811\u5f0f\u7684\u91cd\u6784\u65b9\u6cd5\uff09\n\n\u8fd9\u4e2a\u201c\u4e00\u5b9a\u91cf\u201d\uff0c\u6211\u5728\u6700\u521d\u5b9e\u73b0\u65f6\u53d6\u4e86 $\\dfrac{n}{30}$ \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u5171\u4f1a\u91cd\u6784 $30$ \u6b21\u3002\n\n\u8fd9\u6837\uff0c\u5728\u4e0d\u5361\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u62ff\u5230 $85\\sim90$ \u5206\u3002\n\n\u8fd9\u65f6\u5019\uff0c\u6211\u9519\u8bef\u7684\u8ba4\u4e3a\u662f\u524d\u9762\u7684\u5e38\u6570\u8fc7\u5927\uff0c\u53bb\u5361\u5e38\uff1b\n\n\u5361\u4e86 100 \u6b21\u5de6\u53f3\uff0c\u7ec8\u4e8e\u8fc7\u4e86\uff1b\n\n\u7136\u540e\u6211\u628a\u91cd\u6784\u7684\u9608\u503c\u4ece $\\dfrac{n}{30}$ \u6539\u6210 $\\dfrac{n}{10}$ \uff1b\n\n\u7136\u540e\u5b83\u4e00\u53d1\u5c31\u8fc7\u4e86\u3002 /oh\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u60b2\u4f24\u7684\u4e0d\u5fc5\u8981\u7684\u5361\u5e38\u6545\u4e8b\u3002\n\n[\u5b8c\u6574\u4ee3\u7801](https://www.luogu.com.cn/paste/t0r6jacw)\uff08 [\u8dd1\u4e86 6.71 s](https://www.luogu.com.cn/record/78663554) \uff09\uff08 \u5199\u4e86 3KB \u591a\uff0c\u592a\u957f\u4e86\u4e0d\u653e\u6587\u7ae0\u91cc\u4e86 \uff09",
        "postTime": 1657176654,
        "uid": 198266,
        "name": "Y2hlbnlpa2Fp",
        "ccfLevel": 7,
        "title": "P6541\u5361\u5e38\u8bb0"
    }
]