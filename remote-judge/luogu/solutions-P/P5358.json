[
    {
        "content": "[\u5e7f\u544a](https://m-sea-blog.com/)\n\n---\n\n\u8bb0\u4e24\u4e2a\u6807\u8bb0 $addv$ \u548c $mulv$\uff0c\u8868\u793a\u5168\u5c40\u4e58\u548c\u5168\u5c40\u52a0\uff0c\u5e76\u7ef4\u62a4 $sumv$ \u8868\u793a\u6240\u6709\u5143\u7d20\u7684\u548c\u3002\n\n\u5168\u5c40\u52a0\u548c\u5168\u5c40\u4e58\u5f88\u597d\u5904\u7406\uff1b\u5168\u5c40\u8d4b\u503c\u4e5f\u5f88\u597d\u5904\u7406\uff0c\u53ea\u9700\u8981\u4ee4 $mulv\\gets 1$\u3001$addv\\gets w$ \u5373\u53ef\u3002\n\n\u8003\u8651\u5355\u70b9\u8d4b\u503c\u3002\u6211\u4eec\u76f4\u63a5\u5f00\u4e00\u4e2a `unordered_map` \u5b58\u4e0b\u6240\u6709\u88ab\u5355\u70b9\u8d4b\u503c\u8fc7\u7684\u70b9\uff0c\u6bcf\u6b21\u53ea\u9700\u8981\u5c06 $\\frac{w-addv}{mulv}$ \u63d2\u5165\u5176\u4e2d\u5373\u53ef\u3002\u6211\u4eec\u53ea\u8981\u5728\u5168\u5c40\u8d4b\u503c\u65f6\u6e05\u7a7a\u8fd9\u4e2a `unordered_map` \u5373\u53ef\u3002\n\n\u5355\u70b9\u67e5\u8be2\u65f6\uff0c\u53ea\u9700\u8981\u67e5\u8be2 `unordered_map` \u4e2d\u6709\u65e0 $p$ \u6765\u5f97\u5230\u5bf9\u5e94\u503c\uff0c\u518d\u4e58\u4e0a $mulv$ \u5e76\u52a0\u4e0a $addv$ \u5373\u53ef\u5f97\u5230\u771f\u5b9e\u503c\u3002\n\n\u540c\u65f6\u4e0d\u96be\u5728\u4fee\u6539\u64cd\u4f5c\u4e2d\u7ef4\u62a4 $sumv$\uff08\u5bf9\u4e8e\u5355\u70b9\u8d4b\u503c\u53ef\u4ee5\u628a\u539f\u6765\u7684\u51cf\u6389\u518d\u52a0\u4e0a\u65b0\u7684\u503c\uff09\uff0c\u8fd9\u6837\u5b50\u4e5f\u652f\u6301\u4e86\u5168\u5c40\u6c42\u548c\u3002\n\n\u7ebf\u6027\u9884\u5904\u7406\u9006\u5143\uff0c\u5373\u53ef\u505a\u5230 $\\mathcal{O}(qt)$\u3002\n\n\u8fd9\u4e2a\u505a\u6cd5\u5927\u6982\u662f\u7528\u54c8\u5e0c\u8868\u6e05\u7a7a\u4ee3\u66ff\u4e86\u522b\u7684\u9898\u89e3\u4e2d\u7684\u8bb0\u65f6\u95f4\u6233\uff0c\u5c11\u4e86\u4e00\u4e9b\u7ec6\u8282\u4f46\u662f\u8dd1\u5f97\u4f1a\u6162\u4e00\u4e9b\u3002\n\n```cpp\n// ====================================\n//   author: M_sea\n//   website: https://m-sea-blog.com/\n// ====================================\n#include <bits/stdc++.h>\n#define file(x) freopen(#x\".in\",\"r\",stdin),freopen(#x\".out\",\"w\",stdout)\n#define debug(...) fprintf(stderr,__VA_ARGS__)\nusing namespace std;\ntypedef long long ll;\n\nint read() {\n\tint X=0,w=1; char c=getchar();\n\twhile (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n\twhile (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n\treturn X*w;\n}\n\nconst int N=100000+10;\nconst int mod=1e7+19;\n\nint n,Q,T,a[N],b[N],inv[mod],ans=0;\nstruct query { int op,p,w; } q[N];\n\nint addv=0,mulv=1,sumv=0;\nunordered_map<int,int> M;\nint F(int x) { return (1ll*(M.count(x)?M[x]:0)*mulv+addv)%mod; }\nvoid work(query q) {\n\tif (q.op==1) sumv=(sumv-F(q.p)+mod)%mod,M[q.p]=1ll*(q.w-addv+mod)*inv[mulv]%mod,sumv=(sumv+q.w)%mod;\n\tif (q.op==2) addv=(addv+q.w)%mod,sumv=(sumv+1ll*n*q.w)%mod;\n\tif (q.op==3) mulv=1ll*mulv*q.w%mod,addv=1ll*addv*q.w%mod,sumv=1ll*sumv*q.w%mod;\n\tif (q.op==4) mulv=1,addv=q.w,sumv=1ll*n*q.w%mod,M.clear();\n\tif (q.op==5) ans=(ans+F(q.p))%mod;\n\tif (q.op==6) ans=(ans+sumv)%mod;\n}\n\nint main() {\n\tinv[1]=1;\n\tfor (int i=2;i<mod;++i) inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n\tn=read(),Q=read();\n\tfor (int i=1;i<=Q;++i) {\n\t\tq[i].op=read();\n\t\tif (q[i].op==1||q[i].op==5) q[i].p=read();\n\t\tif (q[i].op<=4) q[i].w=(read()%mod+mod)%mod;\n\t\tif (q[i].op==3&&!q[i].w) q[i].op=4; // \u4e58 0 \u76f8\u5f53\u4e8e\u6574\u4f53\u8d4b\u503c\u4e3a 0\n\t}\n\tT=read();\n\tfor (int i=1;i<=T;++i) a[i]=read(),b[i]=read();\n\tfor (int i=1;i<=T;++i)\n\t\tfor (int j=1;j<=Q;++j) work(q[(a[i]+1ll*j*b[i])%Q+1]);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1610972750,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    },
    {
        "content": "\u8003\u8651\u9996\u5148\u53ef\u4ee5\u79bb\u6563\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u5269\u4e0b\u6765\u7684\u64cd\u4f5c\u53ef\u4ee5~~\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4~~\uff1a\n\n\u7ef4\u62a4\u4e24\u4e2a\u6807\u8bb0$(tag,mul)$\u8868\u793a\u5bf9\u4e8e\u4e00\u4e2a\u6570$x$\uff0c\u7b54\u6848\u662f$x*mul+tag$\u3002\n\n\u90a3\u4e48\u9664\u4e86\u533a\u95f4\u8d4b\u503c\u4e4b\u5916\u7684\u6807\u8bb0\u90fd\u53ef\u4ee5\u5f88\u597d\u7684\u7ef4\u62a4\u3002\n\n\u8003\u8651\u533a\u95f4\u8d4b\u503c\u76f4\u63a5\u66b4\u529b\u548c\u4e0a\u4e00\u6b21\u64cd\u4f5c\u4e4b\u95f4\u7684\u6240\u6709\u5355\u70b9\u4fee\u6539\u5168\u90e8\u6539\u6389\u5c31\u884c\u4e86\uff0c\u8fd9\u6837\u5b50\u7684\u590d\u6742\u5ea6$\\sum$\u662f\u4e0d\u4f1a\u8d85\u8fc7$Q$\u7684\u3002\n\n```cpp\n/*====================\nauthor: fexuile\nmail: fexuile@qq.com\nQQ: 2165008534\n====================*/\n#include<stdio.h>\n#include<stdlib.h>\n#include<string.h>\n#include<math.h>\n#include<algorithm>\n#include<queue>\n#include<iostream>\n#include<set>\n#include<map>\nusing namespace std;\n#define mp make_pair\n#define ll long long\n#define re register\ntypedef pair<int,int> pii;\n#define file(a) freopen(a\".in\",\"r\",stdin);freopen(a\".out\",\"w\",stdout)\ninline int gi(){\n\tint f=1,sum=0;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){sum=(sum<<3)+(sum<<1)+ch-'0';ch=getchar();}\n\treturn f*sum;\n}\nconst int N=200010,Mod=1e7+19;\nstruct ques{int opt,id,v,inv;}q[N];\nint n,tot,o[N],Q,sum,pls,tms=1,inv=1,v[N];\nint qpow(int a,int b){int ret=1;while(b){if(b&1)ret=1ll*ret*a%Mod;b>>=1;a=1ll*a*a%Mod;}return ret;}\nvoid modify(int x,int y){\n\tsum=(sum+1ll*(Mod-v[x])*tms%Mod-pls+Mod)%Mod;\n\tv[x]=1ll*(y-pls+Mod)*inv%Mod;\n\tsum=(sum+y)%Mod;o[++tot]=x;\n}\nvoid add(int y){pls=(pls+y)%Mod;sum=(sum+1ll*n*y%Mod)%Mod;}\nvoid cag(int y){\n\twhile(tot)v[o[tot--]]=0;\n\tinv=tms=1;pls=y;sum=1ll*n*y%Mod;\n}\nvoid mul(int y,int ny){\n\tif(!y)cag(0);\n\telse{\n\t\tsum=1ll*sum*y%Mod;tms=1ll*tms*y%Mod;\n\t\tinv=1ll*inv*ny%Mod;pls=1ll*pls*y%Mod;\n\t}\n}\nint query(int x){\n\treturn (1ll*v[x]*tms%Mod+pls)%Mod;\n}\nint main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"in.in\",\"r\",stdin);\n#endif\n\tn=gi();Q=gi();\n\tfor(int i=0;i<Q;i++){\n\t\tq[i].opt=gi();\n\t\tif(q[i].opt==1||q[i].opt==5)q[i].id=o[++tot]=gi();\n\t\tif(q[i].opt<5)q[i].v=(gi()%Mod+Mod)%Mod,q[i].inv=qpow(q[i].v,Mod-2);\n\t}\n\tsort(o+1,o+tot+1);tot=unique(o+1,o+tot+1)-o-1;\n\tfor(int i=0;i<Q;i++)q[i].id=lower_bound(o+1,o+tot+1,q[i].id)-o;\n\ttot=0;int ans=0;\n\tfor(int T=0,t=gi();T<t;T++){\n\t\tint a=gi()%Q,b=gi()%Q;\n\t\tfor(int j=0,k=(a+b)%Q;j<Q;j++,k=(k+b)%Q){\n\t\t\tint opt=q[k].opt,x=q[k].id,y=q[k].v;\n\t\t\tif(opt==1)modify(x,y);\n\t\t\tif(opt==2)add(y);\n\t\t\tif(opt==3)mul(y,q[k].inv);\n\t\t\tif(opt==4)cag(y);\n\t\t\tif(opt==5)ans=(ans+query(x))%Mod;\n\t\t\tif(opt==6)ans=(ans+sum)%Mod;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1593247491,
        "uid": 51343,
        "name": "MLEAutoMaton",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    },
    {
        "content": "\u8fd9\u662f\u8fd9\u6b21SDOI\u552f\u4e00\u4f1a\u505a\u7684\u9898\uff0c~~\u8bdd\u8bf4\u6211\u4eec\u6559\u7ec3\u4e3a\u4ec0\u4e48\u540c\u6b65\u8d5b\u53ea\u901a\u77e5\u7b2c\u4e8c\u573a\uff1f\uff1f\uff1f\uff08\u5927\u96fe\uff09~~\n\n\u9996\u5148\u4e00\u5f00\u59cb\u611f\u89c9\u6709\u70b9\u50cf\u7ebf\u6bb5\u6811\uff0c\u53ef\u662f\u6570\u636e\u8303\u56f4\u4e0d\u5bf9\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u6362\u6362\u601d\u8def\u3002\n\n\u8fd9\u9898\u80af\u5b9a\u4e0d\u662f\u5206\u5757\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u501f\u7528\u5206\u5757\u7684\u6253\u6807\u8bb0\u64cd\u4f5c\u3002\n\n\u56e0\u4e3a\u5148\u52a0\u540e\u4e58\u548c\u5148\u4e58\u540e\u52a0\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u7528 add \u548c mul\u6765 \u6253\u6807\u8bb0\n\n\u7136\u540e\u5bf9\u4e8e$1$\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u7528$v[i]$\u8868\u793a\u81f3\u5c11\u8fdb\u884c\u8fc7\u4e00\u6b21\u64cd\u4f5c\u7684\u7f16\u53f7\uff0c\u7528$v[0]$\u4ee3\u8868\u6ca1\u6709\u8fdb\u884c\u8fc7$1$\u64cd\u4f5c\u7684\u3002\n\n\u600e\u4e48\u7ef4\u62a4 \uff1f\uff1f \u53ea\u8981\u5728\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u7684\u65f6\u5019\u628a\u4ed6\u66f4\u65b0\u6210 \u4ed6\u6bd4\u52a0\u6cd5\u6807\u8bb0\u591a\u591a\u5c11\uff0c\u518d\u4e58\u4e00\u4e2a\u4e58\u6807\u8bb0\u7684\u9006\u5143\u5c31\u597d\u5566\uff01\u3002\n\n\u7136\u540e\u6211\u4eec\u8fd8\u8981\u7ef4\u62a4\u4e00\u4e2a\u65f6\u95f4\u6570\u7ec4\uff0c$tim[i]$\u8868\u793a\u4e0a\u4e00\u6b21\u5bf9$i$\u70b9\u8fdb\u884c\u5355\u70b9\u66f4\u65b0\u7684\u65f6\u95f4\u70b9\u3002\n\n\u7528$last$\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u6574\u4e2a\u66f4\u65b0\u7684\u65f6\u95f4\u70b9\u3002\n\n\u5728$5$\u64cd\u4f5c\u4e2d\uff0c\u53ea\u9700\u8981\u770b\u4ed6\u6700\u8fd1\u4e00\u6b21\u662f\u5355\u70b9\u66f4\u65b0\u8fd8\u662f\u6574\u4f53\u66f4\u65b0\uff0c\u5982\u679c\u5355\u70b9\u66f4\u65b0<=\u6574\u4f53\u66f4\u65b0\u7528$v[0]$\uff0c\u5426\u5219\u5c31\u7528$v[i]$\u3002\n\n\u7136\u540e\u5176\u4ed6\u64cd\u4f5c\u603b\u662f\u633a~~\u7b80\u5355~~\uff08\u96be\uff09\u7684\u5427\uff0c\u5c31\u4e0d\u8bb2\u4e86\n\n\u4ee3\u7801\uff1a\n\n```\n#include<iostream>\n#include <cstdio>\n#include <cstring>\n#include <map>\n#include <unordered_map>\nusing namespace std;\nconst int maxn=1e5+7,mod=1e7+19;\nstruct query {\n\tint c,x,y;\n}q[maxn];\nunordered_map<int,int>mp;\nint n,m,Q,t,mul,add,ans,sum,last,a[maxn],b[maxn],v[maxn],tim[maxn],inv[maxn*100];\nvoid solve(int i,int t)\n{\n    if(q[i].c==6) ans=(ans+sum)%mod;\n    else if(q[i].c==2) sum=(sum+1ll*n*q[i].x)%mod,add=(add+q[i].x)%mod;\n    else if(q[i].c==3) sum=1ll*sum*q[i].x%mod,mul=1ll*mul*q[i].x%mod,add=1ll*add*q[i].x%mod;\n    else if(q[i].c==4) sum=1ll*n*q[i].x%mod,last=t,mul=1,add=0,v[0]=q[i].x;\n    else if(q[i].c==5) {\n        if(tim[q[i].x]<=last) ans=(ans+1ll*mul*v[0]+add)%mod;\n        else ans=(ans+1ll*mul*v[q[i].x]+add)%mod;\n    }\n    else {\n        if(tim[q[i].x]<=last) sum=(sum-1ll*mul*v[0]%mod-add+2*mod)%mod;\n        else sum=(sum-1ll*mul*v[q[i].x]%mod-add+2*mod)%mod;\n        sum=(sum+q[i].y)%mod,tim[q[i].x]=t,v[q[i].x]=1ll*(q[i].y-add+mod)*inv[mul]%mod;\n    }\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&Q);\n    inv[1]=1;for(int i=2;i<mod;++i)inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n    for(int i=1;i<=Q;++i) {\n        scanf(\"%d\",&q[i].c);\n        if(q[i].c!=6) scanf(\"%d\",&q[i].x);\n        if(q[i].c==1) {\n            scanf(\"%d\",&q[i].y);\n            q[i].y=(q[i].y%mod+mod)%mod;\n            if(!mp[q[i].x]) mp[q[i].x]=++m;\n        }\n        else if(q[i].c<=4) q[i].x=(q[i].x%mod+mod)%mod;\n        if(q[i].c==3 && q[i].x==0) q[i].c=4;\n    }\n    for(int i=1;i<=Q;++i)if(q[i].c==1||q[i].c==5) q[i].x=mp[q[i].x];\n    mul=1;\n    scanf(\"%d\",&t);\n    for(int i=1;i<=t;++i) scanf(\"%d%d\",&a[i],&b[i]);\n    for(int i=1;i<=t*Q;++i) {\n        int x=(i-1)/Q+1,y=(i-1)%Q+1;\n        solve((a[x]+1ll*y*b[x])%Q+1,i);\n    }\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n\n```\n\n\u4ee3\u7801\u771f\u77ed\uff01\uff01\uff01\uff01",
        "postTime": 1557290458,
        "uid": 78187,
        "name": "zjjcth330",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    },
    {
        "content": "\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u5b9a\u521d\u59cb\u51680\u7684\u5e8f\u5217\uff0c\u652f\u6301\uff1a\u5355\u70b9\u4fee\u6539\uff0c\u5168\u5c40\u52a0\uff0c\u5168\u5c40\u4e58\uff0c\u5168\u5c40\u8d4b\u503c\uff0c\u5355\u70b9\u67e5\u8be2\uff0c\u5168\u5c40\u67e5\u8be2\u3002\u8981\u6c42\u6bcf\u6b21\u64cd\u4f5cO(1)\u3002\n\n\u73b0\u573a\u5e73\u8861\u6811\u8fc7\u4e86\u7684\u795e\u4ed9\u6df1\u53d7\u6211\u4e00\u62dc\u3002\n\n\u6ce8\u610f\u5230\u64cd\u4f5c\u53ea\u6709\u5355\u70b9\u548c\u5168\u5c40\uff0c\u800c\u4e14\u867d\u7136\u5e8f\u5217\u5f88\u957f\u4f46\u662f\u4fee\u6539\u7684\u70b9\u6700\u591a1e5\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u6240\u6709\u7684\u70b9\u62ce\u51fa\u6765\u91cd\u6807\u53f7\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5176\u5b9e\u6700\u9ebb\u70e6\u7684\u5730\u65b9\u662f\u600e\u4e48\u67e5\u8be2\u5355\u70b9\u7684\u503c\uff0c\u5176\u4f59\u76f4\u63a5\u6a21\u62df\u5c31\u597d\u5566\u3002\n\n\u9700\u8981\u7ef4\u62a4\u7684\u4e1c\u897f\u6709\uff1a\u4e00\u4e2a\u201c\u6807\u51c6\u5143\u7d20\u201d\uff08\u672a\u88ab\u5355\u70b9\u4fee\u6539\u7684\u5143\u7d20\uff09\u7684\u503c\uff0c\u5168\u5c40\u6240\u6709\u5143\u7d20\u7684\u548c\u3002\n\n\u8fd8\u9700\u8981\u8bb0\u5f55\u4e00\u4e0b\u4e00\u4e2a\u70b9\u4e0a\u4e00\u6b21\u88ab\u5355\u70b9\u4fee\u6539\u662f\u4ec0\u4e48\u65f6\u5019\u4ee5\u53ca\u4e0a\u4e00\u6b21\u5168\u5c40\u8d4b\u503c\u662f\u4ec0\u4e48\u65f6\u5019\u3002\n\n\u5355\u70b9\u67e5\u8be2\u65f6\uff0c\u5982\u679c\u4e0a\u4e00\u6b21\u5168\u5c40\u8d4b\u503c\u5728\u5b83\u4e0a\u4e00\u6b21\u5355\u70b9\u4fee\u6539\u4e4b\u540e\uff0c\u90a3\u4e48\u5b83\u7684\u503c\u5f53\u7136\u662f\u201c\u6807\u51c6\u5143\u7d20\u201d\u5566\u3002\n\n\u5426\u5219\u5462\uff1f\u8003\u8651\u4ece\u4e0a\u4e00\u6b21\u5355\u70b9\u4fee\u6539\u4e4b\u540e\uff0c\u8fd9\u4e2a\u5143\u7d20\u7ecf\u5386\u4e86\u4ec0\u4e48\uff1a\n\n\u8bbex\u4e3a\u4e0a\u4e00\u6b21\u5355\u70b9\u4fee\u6539\u65f6\u7684\u521d\u503c\uff1a\n\n((x\u00d7a1+b1)\u00d7a2+b2)\u00d7a3+b3......\n\n\u8fd9\u5176\u4e2dx\u7684\u8d21\u732e\u4e3a\uff1a\n\nx\u00d7a1\u00d7a2\u00d7a3\u00d7\u2026\u2026\n\n\u5982\u679c\u5728\u4e0a\u4e00\u6b21\u5355\u70b9\u4fee\u6539\u65f6\uff0c\u6807\u51c6\u5143\u7d20\u7684\u503c\u662fy\uff0c\u5219\u4e24\u8005\u6700\u7ec8\u76f8\u5dee\uff1a\n\n(x-y)\u00d7a1\u00d7a2\u00d7a3\u00d7\u2026\u2026\n\n\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u5f55\u4e0b\u4fee\u6539\u65f6(x-y)\u7684\u503c\uff0c\u518d\u60f3\u529e\u6cd5\u6c42\u51fa\u8fd9\u6bb5\u533a\u95f4\u5185\u6240\u67093\u64cd\u4f5c\u7684\u8fde\u4e58\u5373\u53ef\u6c42\u51fa\u7b54\u6848\u3002\n\n\u533a\u95f4\u8fde\u4e58\u600e\u4e48\u6c42\uff1f\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u524d\u7f00\u4e58\u4e00\u4e2a\u524d\u7f00\u7684\u9006\u5143\u3002\n\n\u5bf9\u6bcf\u4e2a\u524d\u7f00\u6c42\u9006\u5143\uff0c\u53ea\u9700\u8981\u50cf\u9884\u5904\u7406\u9636\u4e58\u7684\u9006\u5143\u90a3\u6837\uff0c\u6c42\u51fa\u5168\u5c40\u4e58\u79ef\u7684\u9006\u5143\u518d\u5012\u7740\u7b97\u56de\u53bb\u3002\n\n\u7136\u800c\u8fd9\u5c31\u505a\u5b8c\u4e86\u5417\uff1f\u4f60\u4f1a\u53d1\u73b0\u4f60\u83b7\u5f97\u4e860\u5206\u7684\u597d\u6210\u7ee9\u3002\n\n\u539f\u56e0\u662f\u4f60\u53ef\u80fd\u4f1a\u9664\u4ee50\u3002\n\n\u56e0\u6b64\u4f60\u8fd8\u9700\u8981\u8bb0\u5f55\u533a\u95f4\u5185\u6709\u591a\u5c11\u4e2a0\uff0c\u5e76\u5728\u6c42\u524d\u7f00\u79ef\u65f6\u628a\u6240\u6709\u4e3a0\u7684\u9879\u5ffd\u7565\u6389\u3002\u67e5\u8be2\u65f6\u5148\u5224\u65ad\u533a\u95f4\u5185\u6709\u6ca1\u67090\uff0c\u6ca1\u6709\u7684\u8bdd\u518d\u7b97\u524d\u7f00\u4e58\u524d\u7f00\u7684\u9006\u5143\u5c31\u662f\u5bf9\u7684\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define gc getchar()\n#define pc putchar\n#define li long long\ninline li read(){\n\tli x = 0,y = 0,c = gc;\n\twhile(!isdigit(c)) y = c,c = gc;\n\twhile(isdigit(c)) x = (x << 1) + (x << 3) + (c ^ '0'),c = gc;\n\treturn y == '-' ? -x : x;\n}\ninline void print(li q){\n\tif(q < 0) pc('-'),q = -q;\n\tif(q >= 10) print(q / 10);\n\tpc(q % 10 + '0');\n}\nconst int mo = 10000019;\ninline li ksm(li q,li w){\n\tli as = 1;\n\twhile(w){\n\t\tif(w & 1) as = as * q % mo;\n\t\tq = q * q % mo;\n\t\tw >>= 1;\n\t}\n\treturn as;\n}\nint n,m,t;\nstruct qy{\n\tint op,x,y;\n}a[100010];\nunordered_map<int,int> mp;\nli qa[110],qb[110];\nint bh[10000010],nw,tot;\nint jc[10000010],nj[10000010],ling[10000010];\nint lst[100010];\nli vl[100010];\nli an;\nint main(){\n\tint i,j,u,v;\n\tn = read();m = read();\n\tfor(i = 1;i <= m;++i){\n\t\ta[i].op = read();\n\t\tif(a[i].op == 1){\n\t\t\ta[i].x = read();\n\t\t\tif(!mp[a[i].x]) mp[a[i].x] = ++nw;\n\t\t\ta[i].x = mp[a[i].x];\n\t\t\ta[i].y = (read() % mo + mo) % mo;\n\t\t}\n\t\telse if(a[i].op <= 4){\n\t\t\ta[i].x = (read() % mo + mo) % mo;\n\t\t}\n\t\telse if(a[i].op == 5){\n\t\t\ta[i].x = read();\n\t\t\tif(!mp[a[i].x]) mp[a[i].x] = ++nw;\n\t\t\ta[i].x = mp[a[i].x];\n\t\t}\n\t}\n\tt = read();tot = m * t;\n\tfor(i = 1;i <= t;++i){\n\t\tqa[i] = read();qb[i] = read();\n\t}\n\tfor(i = 1;i <= t;++i) for(j = 1;j <= m;++j) bh[(i - 1) * m + j] = (qa[i] + j * qb[i]) % m + 1;\n\tjc[0] = 1;\n\tfor(i = 1;i <= tot;++i){\n\t\tif(a[bh[i]].op != 3) jc[i] = jc[i - 1],ling[i] = ling[i - 1];\n\t\telse if(a[bh[i]].x) jc[i] = 1ll * jc[i - 1] * a[bh[i]].x % mo,ling[i] = ling[i - 1];\n\t\telse jc[i] = jc[i - 1],ling[i] = ling[i - 1] + 1; \n\t}\n\tnj[tot] = ksm(jc[tot],mo - 2);\n\tfor(i = tot - 1;i >= 0;--i){\n\t\tif(a[bh[i + 1]].op == 3 && a[bh[i + 1]].x) nj[i] = 1ll * nj[i + 1] * a[bh[i + 1]].x % mo;\n\t\telse nj[i] = nj[i + 1];\n\t}\n\tli nw1 = 0,nw2 = 0,val,tmp;\n\tint lt = 0;\n\tfor(i = 1;i <= tot;++i){\n\t\tif(a[bh[i]].op == 1){\n\t\t\tu = a[bh[i]].x;\n\t\t\tif(lt >= lst[u]) val = nw1;\n\t\t\telse{\n\t\t\t\tv = lst[u];\n\t\t\t\tif(ling[i] - ling[v]) tmp = 0;\n\t\t\t\telse tmp = 1ll * jc[i] * nj[v] % mo;\n\t\t\t\tval = (nw1 + vl[u] * tmp) % mo;\n\t\t\t}\n\t\t\t(nw2 += a[bh[i]].y - val + mo) %= mo;\n\t\t\tvl[u] = (a[bh[i]].y - nw1 + mo) % mo;\n\t\t\tlst[u] = i;\n\t\t}\n\t\telse if(a[bh[i]].op == 2){\n\t\t\t(nw1 += a[bh[i]].x) %= mo;\n\t\t\t(nw2 += 1ll * n * a[bh[i]].x) %= mo;\n\t\t}\n\t\telse if(a[bh[i]].op == 3){\n\t\t\t(nw1 *= a[bh[i]].x) %= mo;\n\t\t\t(nw2 *= a[bh[i]].x) %= mo;\n\t\t}\n\t\telse if(a[bh[i]].op == 4){\n\t\t\tnw1 = a[bh[i]].x;\n\t\t\tnw2 = 1ll * n * a[bh[i]].x % mo;\n\t\t\tlt = i;\n\t\t}\n\t\telse if(a[bh[i]].op == 5){\n\t\t\tu = a[bh[i]].x;\n\t\t\tif(lt >= lst[u]) val = nw1;\n\t\t\telse{\n\t\t\t\tv = lst[u];\n\t\t\t\tif(ling[i] - ling[v]) tmp = 0;\n\t\t\t\telse tmp = 1ll * jc[i] * nj[v] % mo;\n\t\t\t\tval = (nw1 + vl[u] * tmp) % mo;\n\t\t\t}\n\t\t\t(an += val) %= mo;\n\t\t\t\n\t\t}\n\t\telse{\n\t\t\t(an += nw2) %= mo;\n\t\t}\n\t}\n\tprint(an);\n\treturn 0;\n}\n```",
        "postTime": 1557309526,
        "uid": 45775,
        "name": "liuzhangfeiabc",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e3a\u6570\u4e0d\u591a\u7684\u6211\u81ea\u5df1\u60f3\u51fa\u7684\u5c71\u4e1c\u7701\u9009\u9898\u3002~~\u867d\u7136\u4e5f\u662f\u5168\u573a\u5207~~\n\n### $50pts:$\n\n\u76f4\u63a5\u5e73\u8861\u6811\u7ef4\u62a4\u3002\n\n### $100pts:$\n\n\u6ce8\u610f\u5230\u64cd\u4f5c\u6570\u9ad8\u8fbe $10^7$\uff0c\u51fa\u9898\u4eba\u80af\u5b9a\u8981\u6c42\u5bf9\u4e8e\u6bcf\u6b21\u64cd\u4f5c $O(1)$ \u7ef4\u62a4\u3002\n\n\u4f46\u662f\u672c\u8d28\u4e0d\u540c\u7684\u64cd\u4f5c\u6570\u53ea\u6709 $10^5$\uff0c\u6240\u4ee5\u8fd9\u4e00\u90e8\u5206\u662f\u53ef\u4ee5 $O(q\\log q)$ \u5904\u7406\u3002\u800c\u4e14\u64cd\u4f5c\u90fd\u662f\u5168\u5c40\u64cd\u4f5c/\u5355\u70b9\u4fee\u6539\uff0c\u6240\u4ee5\u9996\u5148\u6392\u9664\u7ebf\u6bb5\u6811\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u4e09\u4e2a\u6807\u8bb0\uff1a\n\n- $mul$ \u5168\u5c40\u4e58\u6807\u8bb0\n\n- $add$ \u5168\u5c40\u52a0\u6807\u8bb0\n\n- $sum$ \u5168\u5c40\u548c\n\n\u4e3a\u4e86\u66f4\u597d\u9664\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u7ef4\u62a4 $mul$ \u7684\u9006\u5143 $inv$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u53ea\u6709\u6700\u591a $q$ \u4e2a\u4f4d\u7f6e\u9700\u8981\u5355\u72ec\u5904\u7406\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e9b\u5143\u7d20\u5355\u72ec\u62ff\u51fa\u6765\u79bb\u6563\u5316\u4e00\u4e0b\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c $5$ \uff0c\u6211\u4eec\u5148\u5728\u5355\u72ec\u5904\u7406\u7684\u64cd\u4f5c $1$ \u4e0a\u4e8c\u5206\uff0c\u82e5 $i$ \u5728\u64cd\u4f5c $1$ \u4e0a\u51fa\u73b0\u8fc7\uff0c\u6211\u4eec $O(1)$ \u628a\u8fd9\u4e2a\u5143\u7d20\u53d6\u51fa\u6765\uff0c\u5426\u5219\u76f4\u63a5\u628a\u666e\u901a\u4f4d\u7f6e\u7684\u5143\u7d20\u53d6\u51fa\u6765\u5373\u53ef\u3002\n\n\u4f46\u662f\u6709\u64cd\u4f5c $4$\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u5168\u90e8\u904d\u5386 $O(q)$ \u7684\u5143\u7d20\u3002\n\n\u90a3\u4e48\u6211\u4eec\u628a\u6240\u6709\u7684\u64cd\u4f5c $1$ \u8bb0\u4e0b\u6765\uff0c\u6bcf\u6b21\u64cd\u4f5c $4$ \u7684\u65f6\u5019\u5220\u6389\u3002\u8fd9\u6837\u6bcf\u4e2a\u64cd\u4f5c $1$ \u53ea\u4f1a\u88ab\u64cd\u4f5c $4$ \u5220\u6389\u4e00\u6b21\uff0c\u65f6\u95f4\u5c31\u4e0d\u4f1a\u9000\u5316\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(q\\log q+t\\times q)$\n\n\u6709\u53d6\u6a21\u6240\u4ee5\u5e38\u6570\u6bd4\u8f83\u5927\u3002\n\n$Code\\ Below:$\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int maxn=100000+10;\nconst int mod=1e7+19;\nint n,m,T,A[maxn],B[maxn],id[maxn],rid[maxn],cnt,mp[maxn],tot;ll a[maxn],mul,add,sum,inv,ans;\n\nstruct Query\n{\n    int op,x,y;\n}q[maxn];\n\ninline ll fpow(ll a,ll b)\n{\n    ll ret=1;\n    for(;b;b>>=1,a=a*a%mod)\n        if(b&1) ret=ret*a%mod;\n    return ret;\n}\n\ninline void solve(int op,int x,int y)\n{\n\tll old,now;\n\tif(op==1)\n\t{\n\t\told=(a[id[x]]*mul+add)%mod;sum=(sum-old+y)%mod;\n\t\tnow=(y-add)*inv%mod;!id[x]?rid[id[x]=++cnt]=x:0;a[id[x]]=now;\n\t}\n\tif(op==2)\n\t{\n\t\tadd=(add+x)%mod;sum=(sum+1ll*n*x)%mod;\n\t}\n\tif(op==3)\n\t{\n\t\tadd=add*x%mod;mul=mul*x%mod;sum=sum*x%mod;inv=inv*y%mod;\n\t}\n\tif(op==4)\n\t{\n\t\tmul=inv=1;add=0;sum=1ll*n*x%mod;\n\t\tfor(int i=1;i<=cnt;i++) id[rid[i]]=0,a[i]=rid[i]=0;\n\t\ta[0]=x;cnt=0;\n\t}\n\tif(op==5)\n\t{\n\t\tif(!x||!id[x]) ans=(ans+(a[0]*mul+add)%mod)%mod;\n\t\telse ans=(ans+(a[id[x]]*mul+add)%mod)%mod;\n\t}\n\tif(op==6) ans=(ans+sum)%mod;\n}\n\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=m;i++)\n    {\n        scanf(\"%d\",&q[i].op);\n        if(q[i].op<6) scanf(\"%d\",&q[i].x);\n        if(q[i].op==1) scanf(\"%d\",&q[i].y),q[i].y%=mod,mp[++tot]=q[i].x;\n        if(q[i].op>=2&&q[i].op<=4) q[i].x%=mod;\n    }\n    scanf(\"%d\",&T);\n    for(int i=1;i<=T;i++) scanf(\"%d%d\",&A[i],&B[i]);\n    sort(mp+1,mp+tot+1);\n    tot=unique(mp+1,mp+tot+1)-mp-1;\n    int now;\n    for(int i=1;i<=m;i++)\n    {\n        if(q[i].op==1) q[i].x=lower_bound(mp+1,mp+tot+1,q[i].x)-mp;\n        if(q[i].op==3) q[i].y=fpow(q[i].x,mod-2);\n        if(q[i].op==5) now=lower_bound(mp+1,mp+tot+1,q[i].x)-mp,q[i].x=(mp[now]==q[i].x)?now:0;\n    }\n    mul=inv=1;add=sum=0;\n    for(int i=1;i<=T;i++)\n        for(int j=1;j<=m;j++) now=(A[i]+1ll*j*B[i]%m)%m+1,solve(q[now].op,q[now].x,q[now].y);\n    ans=(ans%mod+mod)%mod;\n\tprintf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1557370618,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    },
    {
        "content": "#### \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u64cd\u4f5c\u6570\u5217 $a$\uff0c\u521d\u59cb\u65f6 $a$ \u4e2d\u7684\u6240\u6709\u5143\u7d20\u5747\u4e3a $0$\uff0c\u7ed9\u5b9a\u82e5\u5e72\u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u5f62\u5982\u5355\u70b9\u8d4b\u503c\uff0c\u6574\u4f53\u52a0\uff0c\u6574\u4f53\u4e58\uff0c\u6574\u4f53\u8d4b\u503c\uff0c\u5355\u70b9\u8be2\u95ee\u6216\u8be2\u95ee\u6240\u6709\u5143\u7d20\u7684\u548c\u3002\n\n\u4e3a\u4e86\u51cf\u5c11\u8bfb\u5165\u8f93\u51fa\u91cf\uff0c\u5c06\u53ea\u8f93\u5165 $q$ \u4e2a\u6807\u51c6\u64cd\u4f5c\u4ee5\u53ca $t$ \u7ec4\u6b63\u6574\u6570 $(a_i,b_i)$\uff0c\u8868\u793a\u4f60\u9700\u8981\u8fdb\u884c $qt$ \u6b21\u64cd\u4f5c\uff0c\u5176\u4e2d\u7b2c $\\Big((i-1)q+j\\Big)$ \u6b21\u64cd\u4f5c\u4e3a\u7b2c $\\Big((a_i+jb_i)\\bmod q+1\\Big)$ \u4e2a\u7ed9\u5b9a\u7684\u6807\u51c6\u64cd\u4f5c\uff0c\u4e14\u6700\u7ec8\u4f60\u53ea\u9700\u8981\u8f93\u51fa\u6700\u7ec8\u7b54\u6848\u5bf9 $P=10^7+19$ \u53d6\u6a21\u540e\u7684\u503c\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $50\\%$ \u7684\u6570\u636e\uff0c\u6ee1\u8db3 $n\\le5\\times10^5$\uff0c$t\\le5$\uff1b  \n\u5bf9\u4e8e\u5168\u90e8\u6570\u636e\uff0c\u6ee1\u8db3 $n\\le10^9$\uff0c$q\\le10^5$\uff0c$t\\le100$ \u4e14\u81f3\u5c11\u5b58\u5728\u4e00\u6b21\u8be2\u95ee\u64cd\u4f5c\u3002\n\n#### \u9898\u76ee\u89e3\u6cd5\n\n\u663e\u7136\uff0c\u91c7\u7528\u4efb\u4f55\u5bf9\u6570\u590d\u6742\u5ea6\u7684\u6570\u636e\u7ed3\u6784\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u90fd\u662f\u4e0d\u73b0\u5b9e\u7684\uff0c\u8fd9\u63d0\u793a\u6211\u4eec\u9700\u8981\u91c7\u7528**\u7ebf\u6027\u7b97\u6cd5**\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u770b\u5230\u201c\u6574\u4f53\u52a0\u201d\uff0c\u201c\u6574\u4f53\u4e58\u201d\uff0c\u201c\u6574\u4f53\u8d4b\u503c\u201d\u7b49\u5b57\u773c\uff0c\u8ba9\u6211\u4eec\u4e0d\u7981\u60f3\u5230**\u7ef4\u62a4\u4e00\u4e2a\u7edf\u4e00\u7684\u53d8\u6362**\u3002\n\n\u5728\u672c\u9898\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u53d8\u6362\u8bbe\u7f6e\u4e3a $ax+b$\uff0c\u5219\u6574\u4f53\u52a0\uff0c\u6574\u4f53\u4e58\uff0c\u6574\u4f53\u8d4b\u503c\u90fd\u53ef\u4ee5\u8f7b\u677e\u5904\u7406\u3002\n\n\u8003\u8651\u5355\u70b9\u8d4b\u503c\u7684\u5904\u7406\uff0c\u6bd4\u8f83\u66b4\u529b\u7684\u60f3\u6cd5\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5143\u7d20\u7ef4\u62a4\u4e00\u4e2a\u6700\u8fd1\u66f4\u65b0\u65f6\u95f4\u7684\u65f6\u95f4\u6233\uff0c\u4f46\u66f4\u4e3a\u7cbe\u5999\u7684\u65b9\u6cd5\u662f\u5bf9\u4e8e\u5047\u8bbe\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u7684\u65f6\u95f4\u6233\u5747\u4e3a $0$\uff0c\u6839\u636e\u4fee\u6539\u540e\u7684\u503c $y$ **\u9006\u63a8\u51fa\u6700\u5f00\u59cb\u7684\u503c $x$**\u3002\n\n\u5177\u4f53\u5730\uff0c\u6211\u4eec\u6709 $ax+b=y$\uff0c\u6240\u4ee5\u53ea\u9700\u8ba9\u6700\u5f00\u59cb\u7684 $x$ \u4e3a $\\dfrac{y-b}{a}$ \u5373\u53ef\uff0c\u8fd9\u53ef\u4ee5\u7528\u4e00\u4e2a**\u54c8\u5e0c\u8868**\u6765\u7ef4\u62a4\u3002\n\n\u4e3a\u4e86\u8ba9 $a$ \u4e0d\u4e3a $0$\uff0c\u6211\u4eec\u9700\u8981\u8ba9\u521d\u59cb\u548c\u533a\u95f4\u8d4b\u503c\u540e\u7684 $a$ \u4e3a\u4efb\u610f\u975e $0$ \u6574\u6570\uff0c\u4f46\u662f\uff0c\u6709\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\u662f\u5f53\u6574\u4f53\u4e58\u4e0a $0$ \u7684\u65f6\u5019\uff0c\u6b64\u65f6 $a$ \u548c $b$ \u90fd\u4f1a\u53d8\u6210 $0$\u3002\u6211\u4eec\u53d1\u73b0\u8fd9\u79cd\u60c5\u51b5\u4e0e\u533a\u95f4\u8d4b\u503c\u4e3a $0$ \u7c7b\u4f3c\uff0c\u53ea\u9700\u8ba9 $a=1$\uff0c$b=0$ \u5373\u53ef\u3002\n\n\u6700\u540e\u8003\u8651\u67e5\u8be2\u64cd\u4f5c\uff0c\u5355\u70b9\u67e5\u8be2\u662f\u7b80\u5355\u7684\uff0c\u6574\u4f53\u8be2\u95ee\u76f8\u5f53\u4e8e\u6c42 $\\sum\\limits_{i=1}^{n}(ax_i+b)=a\\sum\\limits_{i=1}^{n}x_i+bn$ \u7684\u503c\uff0c\u53ef\u4ee5\u5728\u4fee\u6539 $x$ \u7684\u8fc7\u7a0b\u4e2d\u987a\u4fbf\u7ef4\u62a4 $\\sum\\limits_{i=1}^{n}x_i$ \u7684\u53d8\u5316\u91cf\uff0c\u6700\u7ec8\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(qt)$\u3002\n\n#### \u603b\u7ed3\n\n\u7c7b\u4f3c\u7ebf\u6bb5\u6811\u7684\uff0c\u6574\u4f53\u7684\u64cd\u4f5c\u4fee\u6539\u4e5f\u53ef\u4ee5\u4f7f\u7528\u61d2\u6807\u8bb0\u89e3\u51b3\uff0c\u5e76\u4e14\u5728\u8fc7\u7a0b\u4e2d\u7ef4\u62a4\u4e00\u4e9b\u7279\u6b8a\u4f4d\u7684\u4fe1\u606f\u65f6\u4e0d\u4e00\u5b9a\u9700\u8981\u7ef4\u62a4\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u7684\u5207\u5165\u65f6\u95f4\u6233\uff0c\u6291\u6216\u662f\u901a\u8fc7\u4e0b\u4f20\u6807\u8bb0\u7b49\u65b9\u5f0f\u6765\u89e3\u51b3\uff0c\u800c\u662f\u53ef\u4ee5\u901a\u8fc7\u9006\u63a8\u521d\u59cb\u65f6\u7684\u60c5\u51b5\u6765\u89e3\u51b3\u95ee\u9898\uff0c\u7ef4\u62a4\u7279\u6b8a\u4f4d\u7684\u4fe1\u606f\u53ef\u4ee5\u91c7\u53d6\u54c8\u5e0c\u8868\u7b49\u65b9\u5f0f\u8fdb\u884c\u7ef4\u62a4\u3002",
        "postTime": 1680947212,
        "uid": 183609,
        "name": "hhoppitree",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5358"
    },
    {
        "content": "### \u9898\u610f\n\u7ef4\u62a4\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\uff0c\u8981\u6c42\u652f\u6301\u5355\u70b9\u8d4b\u503c\u3001\u6574\u4f53\u8d4b\u503c\u3001\u6574\u4f53\u52a0\u3001\u6574\u4f53\u4e58\u3001\u5355\u70b9\u67e5\u8be2\u548c\u6574\u4f53\u6c42\u548c\u3002\n\n$n\\le10^9$\uff0c\u8be2\u95ee\u6b21\u6570 $10^7.$\n\n\n### \u5206\u6790\n\u5c06\u6240\u6709\u6570\u90fd\u5199\u6210 $kx_i+b$ \u7684\u5f62\u5f0f\uff0c\u7ef4\u62a4 $k,b$ \u4ee5\u53ca $\\sum x_i$ \u5373\u53ef\u3002\u4e58\u548c\u52a0\u5c31\u76f4\u63a5\u7ef4\u62a4\u6807\u8bb0\uff0c\u8003\u8651\u5355\u70b9\u8d4b\u503c\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u4ee4 $x_i=\\frac{v-b}{k}$\uff0c\u4f46\u662f\u8fd9\u6837\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5373\u4e58 $0$ \u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u60c5\u51b5\u4e5f\u5f88\u597d\u5904\u7406\uff0c\u6211\u4eec\u8bb0\u5f55\u4e0b\u5f53\u524d $x_i$ \u4e0d\u4e3a $0$ \u7684\u4f4d\u7f6e\uff0c\u6bcf\u6b21\u66b4\u529b\u4fee\u6539\u6210 $0$ \u5373\u53ef\u3002\u4e00\u6b21\u5355\u70b9\u8d4b\u503c\u6700\u591a\u53ea\u4f1a\u8fdb\u884c\u4e00\u6b21\u5220\u9664\u3002\u6240\u4ee5\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u662f\u7ebf\u6027\u7684\u3002\u533a\u95f4\u8d4b\u503c\u5c31\u76f8\u5f53\u4e8e\u4e58 $0$ \u540e\u52a0 $v$\uff0c\u4e8e\u662f\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u6700\u540e\uff0c$n$ \u662f $10^9$ \u7ea7\u522b\u6570\u7ec4\u5f00\u4e0d\u4e0b\uff0c\u63d0\u524d\u79bb\u6563\u5316\u9884\u5904\u7406\u5c31\u597d\u4e86\u3002\n\n\u4ee3\u7801\u4e0d\u96be\u5199\uff0c\u8fd0\u884c\u6548\u7387\u4e5f\u8fd8\u884c\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int MaxN(100003);\n\nnamespace io\n{\n\tconst int SIZE = 1 << 22 | 1;\n\tchar iBuf[SIZE], *iS, *iT, c;\n\t#define gc() (iS == iT ? iT = iBuf + fread(iS = iBuf, 1, SIZE, stdin), (iS == iT ? EOF : *iS++) : *iS++)\n\ttemplate<class I> void gi(I &x)\n\t{\n\t\tint f = 1;\n\t\tfor(c = gc(); c < '0' || c > '9'; c = gc())\n\t\t\tif(c == '-') f = -1;\n\t\tfor(x = 0; c >= '0' && c <= '9'; c = gc())\n\t\t\tx = (x << 3) + (x << 1) + (c & 15);\n\t\tx *= f;\n\t}\n}\n\nusing io :: gi;\n\n#define ull unsigned long long\n\nconst int Mod(1e7 + 19);\n\nint K(1), invK(1), B(0), sum(0), ans(0);\nint tmp[MaxN], x[MaxN], nn, n;\nint v[MaxN], invv[MaxN];\nint op[MaxN], a[MaxN];\nvector<int> A;\n\ninline void inc(int &x, int y)\n{\n\t(x += y) >= Mod ? x -= Mod : x;\n}\n\ninline void dec(int &x, int y)\n{\n\t(x -= y) < 0 ? x += Mod : x;\n}\n\nint fexp(int x, int k)\n{\n\tint res = 1;\n\tfor(; k; k >>= 1, x = (ull) x * x % Mod)\n\t\tif(k & 1) res = (ull) res * x % Mod;\n\treturn res;\n}\n\nvoid work(int i)\n{\n\tif(op[i] == 1)\n\t{\n\t\tdec(sum, x[a[i]]);\n\t\tx[a[i]] = (ull) (v[i] + Mod - B) * invK % Mod;\n\t\tA.push_back(a[i]), inc(sum, x[a[i]]);\n\t}\n\telse if(op[i] == 2) inc(B, v[i]);\n\telse if(op[i] == 3)\n\t{\n\t\tif(!v[i])\n\t\t{\n\t\t\tfor(auto j : A) x[j] = 0;\n\t\t\tA.clear(), K = invK = 1, B = 0, sum = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tK = (ull) K * v[i] % Mod;\n\t\t\tB = (ull) B * v[i] % Mod;\n\t\t\tinvK = (ull) invK * invv[i] % Mod;\n\t\t}\n\t}\n\telse if(op[i] == 4)\n\t{\n\t\tfor(auto j : A) x[j] = 0;\n\t\tA.clear(), K = invK = 1, B = v[i], sum = 0;\n\t}\n\telse if(op[i] == 5)\n\t\tans = (ans + (ull) x[a[i]] * K + B) % Mod;\n\telse\n\t\tans = (ans + (ull) sum * K + (ull) B * n) % Mod;\n}\n\nint main()\n{\n\tint q, t;\n#ifdef conical\n\tfreopen(\"que.in\", \"r\", stdin);\n\tfreopen(\"que.out\", \"w\", stdout);\n#endif\n\tgi(n), gi(q);\n\tfor(int i = 1; i <= q; i++)\n\t{\n\t\tgi(op[i]);\n\t\tif(op[i] == 1 || op[i] == 5)\n\t\t\tgi(a[i]), tmp[++nn] = a[i];\n\t\tif(op[i] <= 4)\n\t\t{\n\t\t\tgi(v[i]);\n\t\t\tv[i] = (Mod + v[i] % Mod) % Mod;\n\t\t\tinvv[i] = fexp(v[i], Mod - 2);\n\t\t}\n\t}\n\tsort(tmp + 1, tmp + 1 + nn);\n\tnn = unique(tmp + 1, tmp + 1 + nn) - tmp - 1;\n\tfor(int i = 1; i <= q; i++)\n\t\tif(a[i]) a[i] = lower_bound(tmp + 1, tmp + 1 + nn, a[i]) - tmp;\n\tgi(t);\n\tfor(int i = 1, a, b; i <= t; i++)\n\t{\n\t\tgi(a), gi(b);\n\t\tfor(int j = 1; j <= q; j++)\n\t\t\twork((a + (ull) b * j) % q + 1);\n\t}\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1557843494,
        "uid": 7004,
        "name": "Conical",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    },
    {
        "content": "~~SDOI R2\u5b8c\u7f8e\u7206\u70b8\u540e\u5199\u9898\u89e3\u589e\u52a0rp~~\n\n~~\u8fd9\u9898\u597d\u50cf\u5c31\u662fSDSC2018\u65f6dzm\u67d0\u9053\u9898\u7684\u52a0\u5f3a\u7248~~\n\n~~\u5f53\u65f6\u6211\u5728\u4e0d\u4f1a\u7ebf\u6bb5\u6811\u7684\u60c5\u51b5\u4e0b\u76f4\u63a5A\u4e86~~\n\n\u636e\u8bf4\u6570\u636e\u968f\u673a\uff0c\u7528\u6570\u636e\u7ed3\u6784\u4e71\u641e\u5c31\u80fd\u8fc7\n\n\u4e0d\u8fc7\u4e3a\u4e86\u4fdd\u9669\uff0c\u6211\u8fd8\u662f\u5199\u7684$O(qt)$\u7684\u505a\u6cd5\n\n\u9996\u5148\u53d1\u73b0\uff0c\u53ea\u6709\u5355\u70b9\u64cd\u4f5c\u548c\u5168\u5c40\u64cd\u4f5c\n\n\u6240\u4ee5\u8003\u8651\u628a\u6d89\u53ca\u7684\u6240\u6709\u5355\u70b9\u64cd\u4f5c\u6240\u5728\u4f4d\u7f6e\u79bb\u6563\u5316\n\n\u8fd9\u91cc\u6211\u7684\u505a\u6cd5\u662f\uff1a\u5bf9\u4e8e\u5355\u70b9\u4fee\u6539\uff0c\u5c06\u8fd9\u4e2a\u4f4d\u7f6e\u79bb\u6563\u5316\n\n\u5bf9\u4e8e\u5355\u70b9\u67e5\u8be2\uff0c\u5982\u679c\u6709\u5bf9\u5e94\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u5c31\u628a\u64cd\u4f5c\u6620\u5c04\u5230\u90a3\u4e2a\u4f4d\u7f6e\uff0c\u5426\u5219\uff0c\u6620\u5c04\u5230$0$\u4f4d\u7f6e\n\n\u5bf9\u4e8e\u5168\u5c40\u64cd\u4f5c\uff0c\u76f4\u63a5\u5168\u5c40\u6253\u6807\u8bb0\u5373\u53ef\n\n\u7136\u800c\uff0c\u95ee\u9898\u6765\u4e86\uff1a\u600e\u4e48\u5904\u7406\u6807\u8bb0\uff1f\n\n\u9996\u5148\u4e0d\u8003\u8651\u5168\u5c40\u8d4b\u503c\u64cd\u4f5c\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9\uff0c\u53ef\u4ee5\u5148\u628a\u4e4b\u524d\u7684\u6240\u6709\u64cd\u4f5c\u64a4\u9500\uff0c\u7136\u540e\u518d\u5bf9\u8fd9\u4e2a\u70b9\u6267\u884c\u6240\u6709\u6267\u884c\u8fc7\u7684\u64cd\u4f5c\n\n\u5199\u4e86\u4e2a\u68c0\u9a8c\u5668\uff0c\u53d1\u73b0\u6a21\u6570\u662f\u8d28\u6570\uff0c~~\u592a\u597d\u4e86~~\n\n\u8fd9\u6837\uff0c\u5bf9\u4e8e\u52a0\u6cd5\uff0c\u4f5c\u51cf\u6cd5\u5c31\u53ef\u4ee5\u64a4\u9500\n\n\u5bf9\u4e8e\u4e58\u6cd5\uff0c\u5982\u679c\u5168\u5c40\u4e58\u7684\u6570\u662f$p$\u7684\u500d\u6570\uff0c\u5c31\u628a\u8fd9\u6b21\u64cd\u4f5c\u6362\u4e3a\u4e00\u6b21\u4fee\u6539\u64cd\u4f5c\uff0c\u5426\u5219\uff0c\u53ef\u4ee5\u4e58\u4ee5\u9006\u5143\u6765\u64a4\u9500\n\n\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u7ef4\u62a4\u5df2\u7ecf\u6267\u884c\u8fc7\u7684\u64cd\u4f5c\u5373\u53ef\n\n\u7b49\u7b49\uff0c\u9006\u5143\u5e26\u4e00\u4e2a$\\log m$\n\n\u89e3\u51b3\u529e\u6cd5\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5148\u628a\u6240\u6709\u4e58\u6cd5\u64cd\u4f5c\u7684\u9006\u5143\u6c42\u51fa\u6765\uff0c\u6267\u884c\u64cd\u4f5c\u65f6\u7ef4\u62a4\u9006\u5143\u5373\u53ef\n\n\u5982\u679c\u6709\u5168\u5c40\u8d4b\u503c\u64cd\u4f5c\uff1f\n\n\u53d1\u73b0\u6267\u884c\u5168\u5c40\u8d4b\u503c\u64cd\u4f5c\u540e\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6807\u8bb0\u90fd\u4f1a\u5931\u6548\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u8bb0\u5f55\u4e0a\u4e00\u6b21\u5168\u5c40\u8d4b\u503c\u64cd\u4f5c\u751f\u6548\u7684\u65f6\u95f4\n\n\u5982\u679c\u53d1\u73b0\u8fd9\u4e2a\u70b9\u9700\u8981\u6267\u884c\u5168\u5c40\u8d4b\u503c\u64cd\u4f5c\uff0c\u5c31\u76f4\u63a5\u628a\u6570\u503c\u4fee\u6539\n\n\u5426\u5219\uff0c\u628a\u52a0\u6cd5\u548c\u4e58\u6cd5\u64cd\u4f5c\u6309\u4e4b\u524d\u7684\u505a\u6cd5\u6267\u884c\u5c31\u53ef\u4ee5\n\n\u800c\u5168\u5c40\u6c42\u548c\u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u6bcf\u6b21\u64cd\u4f5c\u540e\u7ef4\u62a4\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\n\n\u4e0d\u8fc7\u8fd9\u6837\u6bd4\u8f83\u5bb9\u6613\u5199\u9519\n\n\u6ce8\u610f\u6267\u884c\u987a\u5e8f\uff0c\u4ee5\u53ca\u67d0\u4e2a\u64cd\u4f5c\u5bf9\u5176\u5b83\u6807\u8bb0\u7684\u5f71\u54cd\n\n\u64a4\u9500\u65f6\uff0c\u5e94\u5f53\u5148\u64a4\u9500\u52a0\u6cd5\uff0c\u518d\u64a4\u9500\u4e58\u6cd5\uff0c\u800c\u6267\u884c\u65f6\u987a\u5e8f\u6070\u597d\u53cd\u8fc7\u6765\n\n\u6267\u884c\u5168\u5c40\u4fee\u6539\u64cd\u4f5c\u65f6\uff0c\u628a\u52a0\u6cd5\u6807\u8bb0\u8d4b\u503c\u4e3a0\uff0c\u4e58\u6cd5\u548c\u9006\u5143\u6807\u8bb0\u8d4b\u503c\u4e3a1\n\n\u6267\u884c\u5168\u5c40\u52a0\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u5bf9\u5168\u5c40\u4fee\u6539\u64cd\u4f5c\u6807\u8bb0\u4f5c\u52a0\u6cd5\n\n\u6267\u884c\u5168\u5c40\u4e58\u6cd5\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u5c06\u53e6\u5916\u4e24\u4e2a\u6807\u8bb0\u5206\u522b\u4f5c\u4e58\u6cd5\n\n\u7136\u540e\u5728\u8003\u573a\u4e0a\u5efa\u8bae\u5199\u66b4\u529b\u5bf9\u62cd\uff08\u867d\u7136\u66b4\u529b\u662f0\u5206\uff09\n\n\u6700\u540e\u662f\u4ee3\u7801\n```cpp\n#include<cstdio>\n#include<map>\nconst int Q=100007;\nconst long long M=1e7+19;\nlong long read(){\n\tlong long n=0;char c=getchar();bool f=0;\n\twhile(c!='-'&&(c<'0'||c>'9'))c=getchar();\n\tif(c=='-'){f=1;c=getchar();}\n\twhile(c>='0'&&c<='9'){n=n*10+c-'0';c=getchar();}\n\tif(f)return -n;\n\telse return n;\n}\nchar res[25];\nvoid write(long long num){\n\tif(num==0){putchar('0');return;}\n\tif(num<0){putchar('-');num=-num;}\n\tint t=0;\n\twhile(num){\n\t\tres[t++]=num%10+'0';\n\t\tnum/=10;\n\t}\n\twhile(t--)putchar(res[t]);\n\treturn;\n}\nlong long inv(long long n){\n\tint p=M-2;\n\tlong long ans=1;\n\twhile(p){\n\t\tif(p&1){\n\t\t\tans=ans*n%M;\n\t\t}\n\t\tp>>=1;\n\t\tn=n*n%M;\n\t}\n\treturn ans;\n}\nint n,q,t;\nint a,b;\nint opt[Q];\nint place[Q];\nlong long optn[Q];\nlong long invn[Q];\nlong long ans=0;\nstd::map<int,int> ids;\nint id=1;\n\nnamespace seg{\n\tint glen;\n\tlong long list[Q];\n\tlong long add[Q],inv[Q],dfn[Q];\n\tlong long addt,mult,sett,invt,cur;\n\tlong long gsum;\n\tvoid reset(){\n\t\tglen=n%M;\n\t\tcur=0;\n\t\taddt=0;\n\t\tmult=1;\n\t\tsett=0;\n\t\tinvt=1;\n\t\tgsum=0;\n\t\tfor(int i=0;i<=id;i++){\n\t\t\tadd[i]=0;\n\t\t\tinv[i]=1;\n\t\t\tdfn[i]=0;\n\t\t}\n\t}\n\tvoid pushdown(int p){\n\t\tif(dfn[p]<cur){\n\t\t\tdfn[p]=cur;\n\t\t\tlist[p]=sett;\n\t\t\tadd[p]=addt;\n\t\t\tinv[p]=invt;\n\t\t}else{\n\t\t\tlist[p]-=add[p];\n\t\t\tif(list[p]<0)list[p]+=M;\n\t\t\tlist[p]=list[p]*inv[p]%M;\n\t\t\t\n\t\t\tlist[p]=list[p]*mult%M;\n\t\t\tlist[p]+=addt;\n\t\t\tif(list[p]>=M)list[p]-=M;\n\t\t\t\n\t\t\tadd[p]=addt;\n\t\t\tinv[p]=invt;\n\t\t}\n\t}\n\tvoid pset(int p,long long n){\n\t\tpushdown(p);\n\t\tgsum-=list[p];\n\t\tif(gsum<0)gsum+=M;\n\t\tgsum+=n;\n\t\tif(gsum>=M)gsum-=M;\n\t\t\n\t\t\n\t\tlist[p]=n;\n\t}\n\tlong long pquery(int p){\n\t\tpushdown(p);\n\t\treturn list[p];\n\t}\n\tvoid gset(long long n){\n\t\tgsum=n*glen%M;\n\t\tcur++;\n\t\taddt=0;\n\t\tmult=1;\n\t\tsett=n;\n\t\tinvt=1;\n\t}\n\tvoid gadd(long long n){\n\t\tsett+=n;\n\t\tif(sett>=M)sett-=M;\n\t\taddt+=n;\n\t\tif(addt>=M)addt-=M;\n\t\tgsum=(gsum+n*glen)%M;\n\t}\n\tvoid gmul(long long n,long long inv){\n\t\tsett=sett*n%M;\n\t\taddt=addt*n%M;\n\t\tmult=mult*n%M;\n\t\tinvt=invt*inv%M;\n\t\tgsum=gsum*n%M;\n\t}\n\tlong long qsum(){\n\t\treturn gsum;\n\t}\n}\nlong long last;\nint main(){\n\tfreopen(\"query.in\",\"r\",stdin);\n\tfreopen(\"query.out\",\"w\",stdout);\n\tn=read();q=read();\n\tfor(int i=1;i<=q;i++){\n\t\topt[i]=read();\n\t\tif(opt[i]==1||opt[i]==5){\n\t\t\tplace[i]=read();\n\t\t}\n\t\tif(opt[i]<=4){\n\t\t\toptn[i]=read();\n\t\t\toptn[i]%=M;\n\t\t\tif(optn[i]<0)optn[i]+=M;\n\t\t}\n\t\tif(opt[i]==3){\n\t\t\tif(optn[i]==0){\n\t\t\t\topt[i]=4;\n\t\t\t}else{\n\t\t\t\tinvn[i]=inv(optn[i]);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=q;i++){\n\t\tif(opt[i]==1){\n\t\t\tint previd=ids[place[i]];\n\t\t\tif(previd){place[i]=previd;continue;}\n\t\t\tids[place[i]]=id;\n\t\t\tplace[i]=id;\n\t\t\tid++;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<=q;i++){\n\t\tif(opt[i]==5){\n\t\t\tint id=ids[place[i]];\n\t\t\tif(!id){\n\t\t\t\tplace[i]=0;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tplace[i]=id;\n\t\t}\n\t}\n\tseg::reset();\n\tt=read();\n\twhile(t--){\n\t\ta=read();b=read();\n\t\ta%=q;b%=q;\n\t\tfor(int i=1;i<=q;i++){\n\t\t\ta+=b;\n\t\t\tif(a>=q)a-=q;\n\t\t\ta++;\n\t\t\tswitch(opt[a]){\n\t\t\t\tcase 1:\n\t\t\t\t\tseg::pset(place[a],optn[a]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tseg::gadd(optn[a]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tseg::gmul(optn[a],invn[a]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tseg::gset(optn[a]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\tlast=seg::pquery(place[a]);\n\t\t\t\t\tans+=last;\n\t\t\t\t\tif(ans>=M)ans-=M;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\tlast=seg::qsum();\n\t\t\t\t\tans+=last;\n\t\t\t\t\tif(ans>=M)ans-=M;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\ta--;\n\t\t}\n\t}\n\twrite(ans);\n}\n\t\n```\n~~\u539f\u5c01\u4e0d\u52a8\u7684\u8003\u573a\u4ee3\u7801\uff0c\u4e00\u4e2a\u5b57\u8282\u4e5f\u6ca1\u6539~~",
        "postTime": 1557322029,
        "uid": 86649,
        "name": "Hope2075",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5358 \u3010[SDOI2019]\u5feb\u901f\u67e5\u8be2\u3011"
    }
]