[
    {
        "content": "\u5199\u5728\u524d\u9762\uff1a\u9898\u76ee\u63cf\u8ff0\u4e2d\u7684\u5927\u5199\u5b57\u6bcd\u8fd9\u91cc\u90fd\u7528\u5c0f\u5199\u5b57\u6bcd\u4ee3\u66ff\uff0c\u5bf9\u4e8e $a-b$ \u8fd9\u6837\u7684\u5f0f\u5b50\uff0c\u4e0b\u9762\u7684\u524d\u9762\u4e00\u9879\u6307\u7684\u662f $a$ \uff0c\u540e\u9762\u4e00\u9879\u6307\u7684\u662f $b$ \u3002\n\n\u9996\u5148\u8003\u8651\u6ca1\u6709\u4fee\u6539\uff0c\u5373\u53ea\u8be2\u95ee\u4e00\u6b21\uff1a\u5bb9\u6613\u53d1\u73b0\u8d5a\u53d6\u7684\u5c0f\u8d39\u7684\u591a\u5c11\u53ea\u4e0e\u70d8\u7119\u987a\u5e8f\u6709\u5173\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe\u5df2\u7ecf\u6309\u7167\u67d0\u79cd\u987a\u5e8f\u7ed9\u8fd9 $n$ \u4e2a\u5c45\u6c11\u6392\u597d\u4e86\u70d8\u7119\u987a\u5e8f\uff0c\u53ef\u4ee5\u63a8\u63a8\u5f0f\u5b50\uff1a\n\n\u8bbe $c_i$ \u8868\u793a\u80fd\u4ece\u7b2c $i$ \u4e2a\u5c45\u6c11\u4e0a\u83b7\u53d6\u591a\u5c11\u5c0f\u8d39\uff08\u5982\u679c\u662f\u8d1f\u6570\u5c31\u662f\u8981\u5411\u8fd9\u4e2a\u5c45\u6c11\u652f\u4ed8\u8d39\u7528\uff09\uff0c\u90a3\u4e48\uff1a\n$$\nc_i=l_i-\\sum_{j=1}^i t_i\n$$\n\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\uff1a\u524d\u9762\u8fd9\u4e00\u9879\u662f\u6307\u5f53\u524d\u5c45\u6c11\u9884\u5b9a\u7684\u65f6\u95f4\uff0c\u540e\u9762\u8fd9\u4e00\u9879\u662f\u6307\u70d8\u7119\u597d\u8fd9\u4e2a\u5c45\u6c11\u7684\u62ab\u8428\u65f6\u523b\uff0c\u6309\u7167\u9898\u76ee\u7684\u8981\u6c42\u7a0d\u5fae\u6a21\u62df\u4e00\u4e0b\u5c31\u80fd\u591f\u5f97\u5230\u8fd9\u4e2a\u5f0f\u5b50\u3002\n\n\u90a3\u4e48\u6700\u7ec8\u7b54\u6848\u5c31\u662f\uff1a\n$$\n\\sum_{i=1}^n c_i = \\sum_{i=1}^n (l_i-\\sum_{j=1}^i t_j)\n$$\n$$\n=\\sum_{i=1}^nl_i - \\sum_{i=1}^n\\sum_{j=1}^i t_j\n$$\n\u4ece\u7b2c\u4e00\u884c\u5230\u7b2c\u4e8c\u884c\u7684\u53d8\u5316\u662f\u7528\u4e86\u52a0\u6cd5\u7684\u4ea4\u6362\u5f8b\u548c\u7ed3\u5408\u5f8b\u3002\n\n\u5bf9\u4e8e\u540e\u9762\u8fd9\u4e00\u9879\uff0c\u8003\u8651\u7ee7\u7eed\u63a8\uff1a\u5bf9\u4e8e $t_j$ \u8fd9\u4e2a\u6570\u6765\u8bf4\uff0c\u5b83\u5728 $i=j,j+1,j+2\\cdots n$ \u7684\u65f6\u5019\u90fd\u4f1a\u88ab\u7b97\u4e00\u6b21\uff0c\u4e00\u5171\u5c31\u88ab\u7b97\u4e86$n-j+1$ \u6b21\uff0c\u56e0\u6b64\u539f\u5f0f\u7b49\u4e8e\uff1a\n$$\n\\sum_{i=1}^n l_i - \\sum_{i=1}^n t_i \\times(n - i + 1)\n$$\n\u7136\u540e\u518d\u6765\u8003\u8651\u600e\u4e48\u786e\u5b9a\u70d8\u7119\u7684\u987a\u5e8f\uff1a\u9996\u5148\u524d\u9762\u8fd9\u4e00\u9879\u65e0\u8bba\u600e\u4e48\u6392\u90fd\u662f\u4e0d\u53d8\u7684\uff0c\u5173\u952e\u662f\u540e\u9762\u8fd9\u4e00\u9879\u3002\n\n\u56e0\u4e3a\u6700\u7ec8\u7684\u7ed3\u679c\u8981\u6700\u5927\uff0c\u5728\u524d\u9762\u4e00\u9879\u4e0d\u53d8\u7684\u57fa\u7840\u4e0a\uff0c\u540e\u9762\u4e00\u9879\u80af\u5b9a\u8d8a\u5c0f\u8d8a\u597d\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8d8a\u5c0f\u7684 $j$ \uff0c $n-j+1$ \u4f1a\u8d8a\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5c3d\u91cf\u8ba9\u8fd9\u4e2a $j$ \u6240\u5bf9\u5e94\u7684 $t_j$ \u8d8a\u5c0f\u3002\n\n\u4e8e\u662f\u5f52\u7eb3\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\uff1a\u5c06 $t$ \u6574\u4e2a\u6570\u7ec4**\u4ece\u5c0f\u5230\u5927**\u6392\u5e8f\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u4f1a\u5f97\u5230\u6700\u5927\u503c\u3002\n\n------\n\n\u4e0b\u9762\u4e3a\u4e86\u5199\u7684\u5b57\u6570\u5c11\u4e00\u70b9\uff0c\u5b9a\u4e49\uff1a\n$$\nans1=\\sum_{i=1}^n l_i ,ans2 = \\sum_{i=1}^n t_i \\times (n-i+1)\n$$\n\u7136\u540e\u56e0\u4e3a\u6709\u4fee\u6539\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u80fd\u7b80\u5355\u5730\u7528\u4e0b\u6807\u4e86\uff0c\u8fd9\u91cc\u5b9a\u4e49 $pos_i$ \u8868\u793a\u6bd4 $t_i$ \u5c0f\u7684\u6570\u5b57\u4e2a\u6570 $+1$ \uff08\u4e5f\u5c31\u662f\u6392\u597d\u5e8f\u4e4b\u540e\u8fd9\u4e2a\u6570\u7684\u4e0b\u8868\uff09\uff0c $ans2$ \u5c31\u53ef\u4ee5\u8868\u793a\u4e3a $\\sum_{i=1}^n t_i \\times(n - pos_i + 1)$\u3002\n\n\u518d\u6765\u8003\u8651\u6709\u4fee\u6539\u7684\u60c5\u51b5\uff1a\n\n\u9996\u5148\u6211\u4eec\u9700\u8981**\u4e24\u4e2a\u6570\u7ec4 $a,b$ \u6765\u5206\u522b\u5b58\u50a8\u5f53\u524d\u7684 $l$ \u548c $t$** \u3002\n\n\u5982\u679c\u8ba9 $a_x \\gets k$ \u7684\u8bdd\uff0c\u90a3\u4e48\u76f4\u63a5\u66f4\u65b0 $ans1$ \uff08$ans1\\gets ans1 - a_i + k$\uff09\uff0c\u540c\u65f6\u66f4\u65b0 $a$ \u6570\u7ec4\u5373\u53ef\u3002\n\n\u5982\u679c\u8ba9 $b_x \\gets k$ \u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u64cd\u4f5c\u770b\u6210\u5148\u4ece\u539f\u6765\u7684\u6570\u7ec4\u91cc\u9762\u5220\u6389 $b_x$ \uff0c\u518d\u63d2\u5165\u4e00\u4e2a\u6570\u5b57 $k$ \uff0c\u63a5\u4e0b\u6765\u5bf9\u63d2\u5165\u548c\u5220\u9664\u5bf9\u4e8e $ans2$ \u7684\u53d8\u5316\u5206\u5f00\u6765\u8ba1\u7b97\u3002\n\n\u5bf9\u4e8e\u5220\u9664\uff0c\u539f\u5148\u7684 $ans2$ \u662f\uff1a\n$$\n\\sum_{i=1}^n b_i \\times (n-pos_i + 1)\n$$\n\u5220\u6389\u4e86 $b_x$ \u4e4b\u540e\uff0c\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n1. \u5bf9\u4e8e $\\forall b_i < b_x$ \uff0c $pos_i$ \u662f\u4e0d\u4f1a\u53d8\u7684\uff0c\u4f46\u662f $n$ \u56e0\u4e3a\u5220\u9664\u4e86\u4e00\u4e2a\u6570\u51cf\u53bb\u4e86 $1$ \uff0c\u73b0\u5728\u7684 $c_i$ \u662f\uff1a\n\n$$\nc_i= b_i \\times (n - pos_i + 1 - 1)= b_i \\times (n - pos_i)\n$$\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c$b_i$ \u4e58\u7684\u6570\u5b57\u51cf\u53bb\u4e86 $1$ \uff0c\u6240\u4ee5\u5bf9\u4e8e $ans2$ \u5c31\u662f\u51cf\u53bb\u4e86\u6240\u6709\u5c0f\u4e8e $b_x$ \u7684\u6570\u7684\u548c\uff0c\u5373 $\\sum_{b_i<b_x}b_i$ \u3002\n\n2. \u5bf9\u4e8e $\\forall t_i \\geq t_x$ \uff0c$pos_i$ \u56e0\u4e3a\u5220\u9664\u4e86\u4e00\u4e2a\u6570\u51cf\u53bb\u4e86 $1$ \uff0c $n$ \u4e5f\u51cf\u53bb\u4e86 $1$ \uff0c\u73b0\u5728\u7684 $c_i$ \u662f\uff1a\n\n$$\nc_i=b_i\\times((n-1)-(pos_i-1)+1)=b_i\\times(n-1-pos_i+1+1)\n$$\n\n$$\n=b_i \\times (n-pos_i+1)\n$$\n\n\u8fd9\u4e00\u90e8\u5206\u7684\u6570\u548c\u539f\u6765\u662f**\u4e00\u6837\u7684**\uff0c\u5bf9 $ans2$ \u6ca1\u6709\u5f71\u54cd\u3002\n\n\u5f53\u7136\u5220\u9664 $b_x$ \u4e5f\u8ba9\u7b54\u6848\u51cf\u6389\u4e86 $b_x\\times(n-pos_x+1)$ \u3002\n\n\u56e0\u6b64**\u5220\u9664 $b_x$ \u7684\u7ed3\u8bba\u5c31\u662f**\uff1a$ans2$ \u51cf\u53bb\u4e86\u6240\u6709\u5c0f\u4e8e $b_x$ \u7684\u6570\u7684\u548c\uff0c\u540c\u65f6\u4e5f\u51cf\u53bb\u4e86 $b_x$ \u7684\u8d21\u732e\uff0c\u7528\u6570\u5b66\u7684\u5f0f\u5b50\u8868\u793a\u5c31\u662f\uff1a\n$$\nans2\\gets ans2 - b_x\\times(n-pos_x+1)-\\sum_{b_i<b_x}b_i\n$$\n\u63d2\u5165\u4e5f\u662f\u57fa\u672c\u4e00\u6837\u7684\uff0c\u9650\u4e8e\u7bc7\u5e45\u8fd9\u91cc\u76f4\u63a5\u7ed9\u7ed3\u8bba\uff1a\n\n$ans2$ \u52a0\u4e0a\u4e86\u6240\u6709\u5c0f\u4e8e $b_x$ \u7684\u6570\u7684\u548c\uff0c\u540c\u65f6\u4e5f\u52a0\u4e0a\u4e86 $b_x$ \u7684\u8d21\u732e\u7528\u6570\u5b66\u7684\u5f0f\u5b50\u8868\u793a\u5c31\u662f\uff1a\n$$\nans2\\gets ans2 + b_x\\times(n-pos_x+1)+\\sum_{b_i<b_x}b_i\n$$\n\u5230\u8fd9\u91cc\u5c31\u57fa\u672c\u660e\u4e86\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\uff1a\n\n1. \u63d2\u5165/\u5220\u9664\u3002\n2. \u67e5\u8be2\u6bd4\u4e00\u4e2a\u6570\u5c0f\u7684\u6570\u7684\u4e2a\u6570\uff08\u7528\u4e8e\u83b7\u53d6 $pos_x$\uff09\u3002\n3. \u67e5\u8be2\u6bd4\u4e00\u4e2a\u6570\u5c0f\u7684\u6570\u7684\u548c\u3002\n\n\u53ef\u4ee5\u7528\u5e73\u8861\u6811\u6216\u8005\u6811\u72b6\u6570\u7ec4\uff0c\u6700\u7ec8\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f $\\mathcal{O}(n \\log n)$ \u3002\n\n\u8fd9\u91cc\u6211\u4e24\u79cd\u90fd\u5199\u4e86\uff0c\u4f46\u662f Splay \u7684\u65f6\u95f4\u662f\u6811\u72b6\u6570\u7ec4\u7684 $4$ \u500d\uff0c\u5e38\u6570\u662f\u771f\u7684\u5927\u3002\n\n\u5bf9\u4e86\uff0c\u4e0d\u8981\u5fd8\u4e86\u4e00\u5f00\u59cb\u5bf9\u4e8e\u539f\u59cb\u7684\u6570\u636e\u8981\u6c42\u4e00\u904d\u7b54\u6848\uff0c\u7136\u540e\u8f93\u51fa\u7684\u503c\u5176\u5b9e\u662f\u4e0a\u9762\u7684 $ans1-ans2$ \u3002\n\n[\u4ee3\u7801\u653e\u5728\u4e91\u526a\u8d34\u677f\u91cc](https://www.luogu.com.cn/paste/v2a0egf0)\n\n------\n\nUpdate on 2021.6.12 \uff1a\u91cd\u6784\u4e86\u8fd9\u7bc7\u6587\u7ae0\uff0c\u540c\u65f6\u52a0\u5165\u6811\u72b6\u6570\u7ec4\u7684\u5199\u6cd5\u3002\n\nUpdate on 2021.6.17 \uff1a\u66f4\u65b0\u4e86 $\\LaTeX$ \u7684\u9519\u8bef\u3002",
        "postTime": 1623418674,
        "uid": 177893,
        "name": "recollector",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7619 [COCI2011-2012#2] RASPORED"
    },
    {
        "content": "\n\u6211\u4eec\u9996\u5148\u8003\u8651\u6ca1\u6709\u4fee\u6539\u7684\u60c5\u51b5\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u5047\u8bbe\u5df2\u7ecf\u7ed9\u6240\u6709\u7684\u5c45\u6c11\u5206\u914d\u597d\u4e86\u4e00\u4e2a\u70d8\u7119\u62ab\u8428\u7684\u65b9\u6848\uff0c\u5e76\u7528 $pos_i$ \u4ee3\u8868\u7b2c $i$ \u4f4d\u5c45\u6c11\u7684\u62ab\u8428\u662f\u7b2c $pos_i$ \u4e2a\u70d8\u7119\u7684\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u8bbe $C_i$ \u4e3a\u4ece\u7b2c $i$ \u540d\u5c45\u6c11\u8eab\u4e0a\u83b7\u53d6\u7684\u5c0f\u8d39\u6570\u989d\uff08\u5982\u679c\u4e3a\u8d1f\u6570\u5219\u8868\u793a\u9700\u8981\u5411\u8be5\u4f4d\u5c45\u6c11\u652f\u4ed8\u7684\u6570\u989d\u7684\u76f8\u53cd\u6570\uff09\uff0c\u90a3\u4e48\u5c31\u4f1a\u6709\u5982\u4e0b\u7684\u5f0f\u5b50\uff1a\n\n$$\nC_i = L_i - \\sum_{j=1}^{pos_i} T_j\n$$\n\n\u90a3\u4e48\u5bf9\u4e8e Mirko \u6536\u83b7\u5c0f\u8d39\u7684\u603b\u548c $\\sum_{i=1}^n C_i$\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u4e00\u4e0b\u5f0f\u5b50\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{i=1}^n C_i &= \\sum_{i=1}^n (L_i - \\sum_{j=1}^{pos_i} T_j) \\\\\n&= \\sum_{i=1}^n L_i - \\sum_{i=1}^n \\sum_{j=1}^{pos_i} T_j \\\\\n&= \\sum_{i=1}^n L_i - \\sum_{i=1}^n T_i \\times (n- pos_i + 1)\n\\end{aligned}\n$$\n\n\u6700\u540e\u4e00\u6b65\u662f\u8fd9\u6837\u63a8\u51fa\u6765\u7684\uff1a\n\n\u5bf9\u4e8e $T_i$ \u6765\u8bf4\uff0c\u5b83\u4f1a\u5728\u8ba1\u7b97\u6240\u6709 $pos_j \\geq pos_i$ \u7684 $j$ \u7684\u65f6\u5019\u88ab\u8ba1\u7b97\u5230\uff0c\u6240\u4ee5\u603b\u5171\u5c31\u662f $\\sum_{j=pos_i}^n T_i$\uff0c\u5373 $T_i \\times (n-pos_i + 1)$\u3002\n\n----\n\n\u7136\u540e\u770b\u5e26\u4fee\u6539\u7684\u3002\n\n\u6211\u4eec\u770b\u521a\u624d\u63a8\u51fa\u6765\u7684\u5f0f\u5b50\uff0c\u53ef\u4ee5\u770b\u51fa\u6211\u4eec\u80fd\u591f\u5bf9\u4e8e $L$ \u4e0e $T$ \u5206\u5f00\u8003\u8651\uff0c\u800c\u4e8b\u5b9e\u4e0a\u6211\u4eec\u4e5f\u5c31\u662f\u8fd9\u6837\u505a\u7684\u3002\n\n\u6211\u4eec\u5bf9\u4e8e\u4e00\u5f00\u59cb\u6ca1\u6709\u88ab\u4fee\u6539\u65f6\u7684\u6570\u636e\u8ba1\u7b97\u51fa\u4e00\u4e2a $suml = \\sum_{i=1}^n L_i$\uff0c\u7136\u540e\u518d\u8ba1\u7b97\u51fa\u4e00\u4e2a $sumt = \\sum_{i=1}^n T_i \\times (n- pos_i + 1)$\u3002  \n\u6211\u4eec\u6700\u7ec8\u8f93\u51fa\u7684\u6570\u503c\u5c31\u662f $suml-sumt$\u3002\n\n\u5047\u8bbe\u6211\u4eec\u6709\u4e86\u4e00\u4e2a\u65b0\u7684\u4fee\u6539\uff0c\u5c06 $(L_x,T_x)$ \u4fee\u6539\u4e3a $(L_y,T_y)$\u3002\n\n\u5bf9\u4e8e $suml$\uff0c\u5176\u53ea\u9700\u8981\u53d8\u4e3a $suml-L_x+L_y$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e $sumt$\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u6210\u9996\u5148\u4ece\u6570\u5217\u91cc\u9762\u5220\u9664\u4e86\u4e00\u4e2a $T_x$\uff0c\u7136\u540e\u518d\u63d2\u5165\u4e86\u4e00\u4e2a $T_y$\uff1b\u5176\u4e2d $T_x$ \u5220\u9664\u524d\u7684\u4f4d\u7f6e\u662f $pos_x$\uff0c$T_y$ \u5220\u9664\u540e\u7684\u4f4d\u7f6e\u662f $pos_y$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u5220\u9664\u548c\u63d2\u5165\u5206\u5f00\u8ba8\u8bba\uff0c\u4e5f\u53ef\u4ee5\u53ea\u8ba8\u8bba\u6539\u53d8\u4f4d\u7f6e\u7684\u5143\u7d20\u3002\n\n\u5982\u679c\u5206\u5f00\u8ba8\u8bba\u5220\u9664\u548c\u63d2\u5165\u7684\u8bdd\uff0c\u6211\u4eec\u7684\u5206\u6790\u8fc7\u7a0b\u662f\u8fd9\u4e2a\u6837\u5b50\u7684\uff1a\n\n1. \u5bf9\u4e8e $\\forall T_i < T_x$\uff0c\u6211\u4eec\u7684 $pos_i$ \u4e0d\u4f1a\u53d8\uff0c\u4f46\u662f $n$ \u4f1a\u56e0\u5220\u9664\u800c\u51cf\u5c0f $1$\uff1b\u800c\u5bf9\u4e8e $\\forall T_i \\geq T_x$\uff0c\u6211\u4eec\u7684 $pos_i$ \u548c $n$ \u90fd\u4f1a\u51cf\u5c0f $1$ \u800c\u6700\u7ec8\u62b5\u6d88\uff1b\u5bf9\u4e8e $T_x$\uff0c\u6211\u4eec\u9700\u8981\u51cf\u53bb\u5b83\u7684\u8d21\u732e\u3002\n\n\u6240\u4ee5\u6211\u4eec\u7684 $sumt$ \u5728\u5220\u9664 $T_x$ \u4e4b\u540e\u4f1a\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\uff1a\n$$\nsumt \\to sumt - T_x \\times (n - pos_x + 1) - \\sum_{T_i<T_x} T_i\n$$\n\n2. \u5bf9\u4e8e $\\forall T_i < T_x$\uff0c\u6211\u4eec\u7684 $pos_i$ \u4e0d\u4f1a\u53d8\uff0c\u4f46\u662f $n$ \u4f1a\u56e0\u63d2\u5165\u800c\u589e\u5927 $1$\uff1b\u800c\u5bf9\u4e8e $\\forall T_i \\geq T_x$\uff0c\u6211\u4eec\u7684 $pos_i$ \u548c $n$ \u90fd\u4f1a\u589e\u5927 $1$ \u800c\u6700\u7ec8\u62b5\u6d88\uff1b\u5bf9\u4e8e $T_y$\uff0c\u6211\u4eec\u9700\u8981\u52a0\u4e0a\u5b83\u7684\u8d21\u732e\u3002\n\n\u6240\u4ee5\u6211\u4eec\u7684 $sumt$ \u5728\u63d2\u5165 $T_y$ \u4e4b\u540e\u4f1a\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\uff1a\n$$\nsumt \\to sumt + T_x \\times (n - pos_y + 1) + \\sum_{T_i<T_x} T_i\n$$\n\n\u5982\u679c\u53ea\u8ba8\u8bba\u6539\u53d8\u4f4d\u7f6e\u7684\u5143\u7d20\u7684\u8bdd\uff0c\u6211\u4eec\u7684\u5206\u6790\u8fc7\u7a0b\u662f\u8fd9\u4e2a\u6837\u5b50\u7684\uff1a\n\n1. \u5982\u679c $T_x < T_y$\uff0c\u90a3\u4e48\u5bf9\u4e8e $\\{T_i | pos_i \\in (pos_x,pos_y)\\}$\uff0c\u5176 $pos_i$ \u4f1a\u51cf\u5c11 $1$\uff0c\u4ece\u800c\u5bfc\u81f4 $sumt$ \u51cf\u5c11 $\\sum_{pos_i \\in (pos_x,pos_y)} T_i$\u3002\n\n1. \u5982\u679c $T_x > T_y$\uff0c\u90a3\u4e48\u5bf9\u4e8e $\\{T_i | pos_i \\in (pos_y,pos_x)\\}$\uff0c\u5176 $pos_i$ \u4f1a\u589e\u52a0 $1$\uff0c\u4ece\u800c\u5bfc\u81f4 $sumt$ \u589e\u52a0 $\\sum_{pos_i \\in (pos_x,pos_y)} T_i$\u3002\n\n\u603b\u7684\u6765\u770b\uff0c\u6211\u4eec\u7684\u53d8\u5316\u91cf\u53ef\u4ee5\u770b\u505a $\\sum_{T_i<T_x} T_i - \\sum_{T_i<T_x} T_i$\u3002\n\n\u518d\u52a0\u4e0a $T_y$ \u7684\u8d21\u732e\uff0c\u51cf\u53bb$T_x$ \u7684\u8d21\u732e\uff0c\u6211\u4eec\u63a8\u51fa\u7684\u5f0f\u5b50\u8ddf\u4e0a\u9762\u7684\u662f\u4e00\u6837\u7684\u3002\n\n----\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u9700\u8981\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\n\n1. \u63d2\u5165\u548c\u5220\u9664\u5143\u7d20\n2. \u67e5\u8be2\u5c0f\u4e8e\u4e00\u4e2a\u5143\u7d20\u7684\u6570\u5b57\u4e2a\u6570\n3. \u67e5\u8be2\u5c0f\u4e8e\u4e00\u4e2a\u5143\u7d20\u7684\u6570\u5b57\u4e4b\u548c\n\n\u6811\u72b6\u6570\u7ec4\u3001\u6743\u503c\u7ebf\u6bb5\u6811\u548c\u5e73\u8861\u6811\u5747\u53ef\u3002\n\n\u6211\u8fd9\u91cc\u4f7f\u7528\u7684\u662f\u66ff\u7f6a\u7f8a\u6811\u3002\n\n\u5bf9\u4e8e\u4e0d\u77e5\u9053\u66ff\u7f6a\u7f8a\u6811\u7684\u4eba\uff0c\u6211\u5728\u8fd9\u91cc\u5b89\u5229\u4e00\u4e0b[\u6211\u7684\u535a\u5ba2](https://kaiserwilheim.github.io/OI/scapegoat-tree/)\uff0c\u540c\u65f6\u4e5f\u7ed9\u51fa[OI-Wiki](https://oi-wiki.org/ds/sgt/)\u5173\u4e8e\u66ff\u7f6a\u7f8a\u6811\u7684\u8bb2\u89e3\u3002\n\n\u66ff\u7f6a\u7f8a\u6811\u867d\u7136\u6bd4\u8f83\u6162\uff0c\u4f46\u662f\u6240\u6709\u7684\u64cd\u4f5c\u65f6\u95f4\u590d\u6742\u5ea6\u5747\u644a\u4e4b\u540e\u90fd\u662f $O(\\log n\n)$ \u7ea7\u522b\u7684\u3002\n\n\u8fd9\u91cc\u7c98\u4e00\u4e0b\u4ee3\u7801\uff1a\n\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int N = 200010;\nll n, m;\ndouble alpha = 0.75;\nstruct Scapegoat\n{\n\tint ls, rs;\n\tll w, wn;\n\tint s, sz, sd;\n\tll sum;\n}tr[N];\nint cnt, rt;\nvoid calc(int p)\n{\n\ttr[p].s = tr[tr[p].ls].s + tr[tr[p].rs].s + 1;\n\ttr[p].sz = tr[tr[p].ls].sz + tr[tr[p].rs].sz + tr[p].wn;\n\ttr[p].sd = tr[tr[p].ls].sd + tr[tr[p].rs].sd + (tr[p].wn != 0);\n\ttr[p].sum = tr[tr[p].ls].sum + tr[tr[p].rs].sum + tr[p].wn * tr[p].w;\n}\nbool canrbu(int p)\n{\n\treturn tr[p].wn && (alpha * tr[p].s <= ( double )max(tr[tr[p].ls].s, tr[tr[p].rs].s) || ( double )tr[p].sd <= alpha * tr[p].s);\n}//can rebuild\nint ldr[N];\nvoid rbuunf(int &ldc, int p)\n{\n\tif(!p)return;\n\trbuunf(ldc, tr[p].ls);\n\tif(tr[p].wn)ldr[ldc++] = p;\n\trbuunf(ldc, tr[p].rs);\n}//rebuild-unfold\nint rbubld(int l, int r)\n{\n\tif(l >= r)return 0;\n\tint mid = (l + r) >> 1;\n\ttr[ldr[mid]].ls = rbubld(l, mid);\n\ttr[ldr[mid]].rs = rbubld(mid + 1, r);\n\tcalc(ldr[mid]);\n\treturn ldr[mid];\n}//rebuild-build\nvoid rbuild(int &p)\n{\n\tint ldc = 0;\n\trbuunf(ldc, p);\n\tp = rbubld(0, ldc);\n}//rebuild\nvoid insert(int &p, ll k)\n{\n\tif(!p)\n\t{\n\t\tp = ++cnt;\n\t\tif(!rt)rt = 1;\n\t\ttr[p].w = k;\n\t\ttr[p].ls = tr[p].rs = 0;\n\t\ttr[p].wn = tr[p].s = tr[p].sz = tr[p].sd = 1;\n\t\ttr[p].sum = k;\n\t}\n\telse\n\t{\n\t\tif(tr[p].w == k)tr[p].wn++;\n\t\telse if(tr[p].w < k)insert(tr[p].rs, k);\n\t\telse insert(tr[p].ls, k);\n\t\tcalc(p);\n\t\tif(canrbu(p))rbuild(p);\n\t}\n}\nvoid loschn(int &p, ll k)\n{\n\tif(!p)return;\n\tif(tr[p].w == k)\n\t{\n\t\tif(tr[p].wn)tr[p].wn--;\n\t}\n\telse\n\t{\n\t\tif(tr[p].w < k)loschn(tr[p].rs, k);\n\t\telse loschn(tr[p].ls, k);\n\t}\n\tcalc(p);\n\tif(canrbu(p))rbuild(p);\n}//l\u00f6schen\uff0cdelete\u662f\u5173\u952e\u5b57\u5c31\u4e0d\u7528\u4e86\nll uprgtr(int p, ll k)\n{\n\tif(!p)\n\t\treturn 0;\n\telse if(tr[p].w == k && tr[p].wn)\n\t\treturn tr[tr[p].ls].sz;\n\telse if(tr[p].w < k)\n\t\treturn tr[tr[p].ls].sz + tr[p].wn + uprgtr(tr[p].rs, k);\n\telse\n\t\treturn uprgtr(tr[p].ls, k);\n}//\u76f8\u5f53\u4e8e\u662f\u4f7f\u7528greater<>\u51fd\u6570\u6392\u5e8f\u4e4b\u540e\u7684upper_bound\n//\u8f93\u51fa\u7684\u7ed3\u679c\u662f\u5c0f\u4e8e\u67d0\u4e2a\u5143\u7d20\u7684\u6570\u7684\u4e2a\u6570\nll uprsum(int p, ll k)\n{\n\tif(!p)\n\t\treturn 0;\n\telse if(tr[p].w == k && tr[p].wn)\n\t\treturn tr[tr[p].ls].sum;\n\telse if(tr[p].w < k)\n\t\treturn tr[tr[p].ls].sum + tr[p].wn * tr[p].w + uprsum(tr[p].rs, k);\n\telse\n\t\treturn uprsum(tr[p].ls, k);\n}//\u8ddf\u4e0a\u9762\u5dee\u4e0d\u591a\uff0c\u8f93\u51fa\u7684\u662f\u5c0f\u4e8e\u67d0\u4e2a\u5143\u7d20\u7684\u6570\u4e4b\u548c\nll suml, sumt;\nll l[N], t[N];\nint main()\n{\n\tscanf(\"%lld%lld\", &n, &m);\n\tint temp[N];\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\tscanf(\"%lld%lld\", &l[i], &t[i]);\n\t\tsuml += l[i];\n\t\tinsert(rt, t[i]);\n\t\ttemp[i] = t[i];\n\t}\n\tsort(temp + 1, temp + 1 + n);\n\tfor(int i = 1; i <= n; i++)\n\t\tsumt += (n - i + 1) * temp[i];\n\tprintf(\"%lld\\n\", suml - sumt);\n\twhile(m--)\n\t{\n\t\tint a;\n\t\tll b, c;\n\t\tscanf(\"%d%lld%lld\", &a, &b, &c);\n\t\tsuml -= l[a] - b;\n\t\tl[a] = b;\n\t\tll sum1 = uprsum(rt, t[a]), cnt1 = uprgtr(rt, t[a]);\n\t\tloschn(rt, t[a]);\n\t\tinsert(rt, c);\n\t\tll sum2 = uprsum(rt, c), cnt2 = uprgtr(rt, c);\n\t\tsumt += c * (n - cnt2) + sum2 - t[a] * (n - cnt1) - sum1;\n\t\tt[a] = c;\n\t\tprintf(\"%lld\\n\", suml - sumt);\n\t}\n    return 0;\n}\n```\n\n\u611f\u8c22\u9605\u8bfb~qwq",
        "postTime": 1653314079,
        "uid": 196903,
        "name": "\u5357\u9633\u5218\u5b50\u9aa5",
        "ccfLevel": 6,
        "title": "P7619 [COCI2011-2012#2] RASPORED \u9898\u89e3"
    },
    {
        "content": "\u8bc4\u5206\u865a\u9ad8\u3002\n\n\u9996\u5148\u83b7\u5f97\u7684\u5c0f\u8d39\u53ea\u548c\u8003\u714e\u997c\u7684\u987a\u5e8f\u6709\u5173\u3002\u6211\u4eec\u4ee4\u70e4\u714e\u997c\u7684\u987a\u5e8f\u4e3a\u6392\u5217 $p$\uff0c\u90a3\u4e48\u4e0d\u96be\u76f4\u63a5\u5199\u51fa\u7b54\u6848\u3002\n\n$$Ans=\\sum\\limits_{i=1}^n L_{p_i}-\\sum\\limits_{j=1}^{i}T_{p_j}$$ \n\n\u76f4\u63a5\u62c6\u5f00\u7b97\u3002\n\n$$Ans=\\sum\\limits_{i=1}^n L_i-\\sum\\limits_{i=1}^{n}(n-i+1)T_{p_i}$$ \n\n\u524d\u8005\u53ef\u4ee5 $\\mathcal{O}(1)$ \u7ef4\u62a4\u3002\n\n\u5bf9\u4e8e\u540e\u8005\uff0c\u5982\u679c\u5355\u6b21\u67e5\u8be2\uff0c\u6211\u4eec\u76f4\u63a5\u5bf9 $T$ \u4ece\u5c0f\u5230\u8fbe\u6392\u5e8f\u3002\n\n\u6211\u4eec\u8fd8\u9700\u8981\u652f\u6301\u5355\u70b9\u4fee\u6539\uff0c\u4e5f\u5c31\u662f\u8981\u5728\u7ebf\u7ef4\u62a4\u6bcf\u4e2a\u6570\u6bd4\u5b83\u5c0f\u7684\u6709\u591a\u5c11\u4e2a\u6570\uff0c\u548c\u6bd4\u5b83\u5c0f\u7684\u6570\u4e4b\u548c\u3002\n\n\u503c\u57df\u5f88\u5c0f\uff0c\u76f4\u63a5\u5f00\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 200005\n#define int long long\nusing namespace std;\nint n,m,u[N],t[N],o[N],c[N][2],sum;\ninline void add(int x,int y,int op){for(;x<=N-5;x+=x&-x)c[x][op]+=y;}\ninline int ask(int x,int op){int sum=0;for(;x;x-=x&-x)sum+=c[x][op];return sum;}\nsigned main(){\n\tscanf(\"%lld%lld\",&n,&m);\n\trep(i,1,n)scanf(\"%lld%lld\",&u[i],&t[i]),o[i]=t[i],sum+=u[i],add(t[i],1,0),add(t[i],t[i],1);\n\tsort(o+1,o+n+1);rep(i,1,n)sum-=o[i]*(n-i+1);\n\tprintf(\"%lld\\n\",sum);\n\twhile(m--){\n\t\tint x;scanf(\"%lld\",&x);\n\t\tsum -= u[x];add(t[x],-1,0);add(t[x],-t[x],1);\n\t\tint cur = ask(t[x],0),now = ask(t[x],1);\n\t\tsum += t[x] * (n - cur) + now;\n\t\tscanf(\"%lld%lld\",&u[x],&t[x]);\n\t\tsum += u[x];\n\t\tcur = ask(t[x],0),now=ask(t[x],1);\n\t\tsum -= t[x] * (n - cur) + now;\n\t\tadd(t[x],1,0);add(t[x],t[x],1);\n\t\tprintf(\"%lld\\n\",sum);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1624546587,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011[COCI2011-2012#2] RASPORED"
    },
    {
        "content": "[P7619 [COCI2011-2012#2] RASPORED](/problem/P7619)\n\n## \u95f2\u8bdd\n\n\u62b1\u7740 **\u4e00\u68f5 FHQ \u8d70\u5929\u4e0b**\u7684\u5fc3\u6001\u505a\u8fd9\u9898\uff0c~~\u4e00\u4ea4\u5c31 6 \u9875\uff0c\u4e0d\u6127\u662f\u6211~~\n\n\u4f46\u662f\uff0c**FHQ \u771f\u7684\u51e0\u4e4e\u4e07\u80fd\uff01\uff01**\n\n## \u8bfb\u9898\n\n\u5bf9\u4e8e\u80fd\u8d5a\u5230\u7684\u6d88\u8d39\uff0c\u53ef\u4ee5\u770b\u505a $\\sum (lunch_i-time_i)$\n\n\u5316\u7b80\uff1a$\\sum lunch_i-\\sum time_i$\n\n\u524d\u8005\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u540e\u8005\u53c8\u53ef\u4ee5\u7406\u89e3\u4e3a $\\sum(bake_i\\times$ \u4ed6\u7684\u9910\u7b2c\u51e0\u4e2a\u88ab\u505a $)$\uff08 $time$ \u662f\u505a\u5230\u4ed6\u5171\u7528\u4e86\u591a\u4e45\uff0c$bake$ \u662f\u5355\u72ec\u505a\u4ed6\u7684\u8981\u7528\u591a\u4e45\uff09\n\n\u4e0d\u96be\u770b\u51fa\uff0c\u8ba9\u65f6\u95f4\u5c11\u7684\u5148\u505a\uff0c\u65f6\u95f4\u591a\u7684\u540e\u505a\u662f\u6700\u4f18\u7684\u3002\n\n\u6b64\u65f6\u6700\u4f18\u60c5\u51b5\u7b54\u6848 $=\\sum(bake_i\\times rank(bake_i))$\n\n## \u4fee\u6539\u64cd\u4f5c\n\n\u7531\u4e8e $bake_i$ \u4f1a\u4e3a\u7b54\u6848\u4f5c $bake_i\\times rank(bake_i)$ \u7684\u8d21\u732e\uff0c\u90a3\u4e48\u5047\u5982\u4e00\u4e2a\u6570 $a$ \u4ece $rank\\,\\rm x$ \u53d8\u6210 $rank\\,\\rm y$ \u5b83\u505a\u51fa\u7684\u8d21\u732e\u53d8\u5316\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/vdfs297y.png)\n\n\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bb9\u65a5\u539f\u7406\uff08\u5927\u6982\n\n\u4ee5 $x\\lt y$ \u4e3e\u4f8b\u3002\u5bf9\u4e8e\u5728 $x,y$ \u5916\u7684\uff0c\u8d21\u732e\u90fd\u6ca1\u6709\u53d8\u3002\u6392\u540d\u4e3a $x$ \u7684\u6570\u8d21\u732e\u53d8\u6210\u4e86 $y$\uff0c$x+1\\sim y$ \u5168\u90e8 ${}-1$\u3002\n\n\u5bf9\u4e8e\u6392\u540d $x$ \u7684\u8d21\u732e\u53d8\u6210 $y$\uff0c\u4f1a\u5bf9\u7b54\u6848\u9020\u6210 $(y-x)\\times a$ \u7684\u5f71\u54cd\u3002  \n\u5bf9\u4e8e\u6392\u540d\u5728 $x+1\\sim y$ \u533a\u95f4\u5185\u6240\u6709\u6570\u7684\u548c $sum$\uff0c\u4f1a\u5bf9\u7b54\u6848\u9020\u6210 $sum$ \u7684\u5f71\u54cd\u3002\n\n## FHQ\n\n\u5bf9\u4e8e\u60c5\u51b5 1\uff0c$(y-x)\\times a$ \u53ea\u9700\u8981\u7528\u5230\u5e73\u8861\u6811\u7684\u6392\u540d\u67e5\u8be2\u3002  \n\u5bf9\u4e8e\u60c5\u51b5 2\uff0c\u7ef4\u62a4\u6240\u6709\u6392\u540d\u5c0f\u4e8e $x$ \u6570\u7684\u548c $-$ \u6240\u6709\u6392\u540d\u5c0f\u4e8e $y$ \u7684\u6570\u548c\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u7ed9 FHQ \u5f00\u4e00\u4e2a $sum$ \u6570\u7ec4\uff0c\u8bb0\u5f55\u5b50\u6811\u548c\uff0c\u67e5\u8be2\u5c0f\u4e8e $a$ \u7684\u6570\u7684\u548c\uff0c\u9700\u8981\u5206\u88c2\u51fa $\\lt a$ \u4e0e $\\ge a$\uff0c\u6700\u540e\u5de6\u8fb9\u7684\u5b50\u6811\u548c\u5c31\u662f\u7b54\u6848\u3002\n\n## \u5b9e\u73b0\n\n\u7531\u4e8e\u4fee\u6539\u7684\u67e5\u8be2\u6392\u540d\u64cd\u4f5c\u4f1a\u51fa\u73b0\u5220\u9664\u5143\u7d20\u540e\u6392\u540d\u4e0d\u5bf9\u7684\u60c5\u51b5\uff0c\u56e0\u6b64\u6709\u8f83\u597d\u7684\u5b9e\u73b0\u65b9\u6848\u5982\u4e0b\uff1a\n\n```\na=old_value\nb=new_value\nx=rank(a)\nans-=x*a\nans-=sum(x)\nerase(x)\ninsert(y)\ny=rank(b)\nans+=y*b\nans+=sum(y)\n```\n\n\u5982\u679c\u8ba4\u771f\u9605\u8bfb\u4e0a\u9762\u7684\u6587\u5b57\uff0c\u4e0d\u96be\u5199\u51fa\u4ee3\u7801\n\n[**\u300c\u4ee3\u7801\u4e0d\u653e\uff0c\u8be6\u89c1\u63d0\u4ea4\u8bb0\u5f55\u300d**](https://www.luogu.com.cn/record/54905827)\n\n~~\u559c\u83b7 50pts MLE\uff01\uff01\uff01~~\n\n## \u4f18\u5316\n\n\u4e3a\u4ec0\u4e48\u4f1a MLE\uff1f\u5176\u4e2d\u5f88\u5927\u7684\u4e00\u4e2a\u539f\u56e0\u662f\uff1a**\u5220\u9664\u6b21\u6570\u592a\u591a\uff0c\u9020\u6210\u5f88\u5927\u7684\u7a7a\u95f4\u6d6a\u8d39**\u3002\n\n\u4f18\u5316\u8fd9\u6837\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u5728\u5220\u9664\u540c\u65f6\uff0c**\u8bb0\u5f55\u53ef\u7528\u7684\u7a7a\u95f4**\uff0c\u7533\u8bf7\u7a7a\u95f4\u65f6\uff0c**\u770b\u770b\u6709\u6ca1\u6709\u53ef\u4ee5\u56de\u6536\u7684\u7a7a\u95f4**\u3002\n\n```cpp\nint use[maxn],top = 0,now;\nint new_node(int x){\n\tif(top) now = use[top],--top;// \u6709\u53ef\u4ee5\u56de\u6536\u7684\u7a7a\u95f4\u5c31\u7528\n\telse now = ++cnt;// \u5426\u5219\u65b0\u5f00\u7a7a\u95f4\n\tsiz[now] = 1;\n\tval[now] = x;\n\tsum[now] = 1LL * x;\n\theap[now] = rand();\n\treturn now;\n}\nvoid erase(int k){\n\tsplit(rt,k,x,z);\n\tsplit(x,k - 1,x,y);\n\tnewy = merge(lc[y],rc[y]);\n\tuse[++top] = y;// \u52a0\u5230\u53ef\u4ee5\u56de\u6536\u7684\u7a7a\u95f4\u4e4b\u4e2d\n\tlc[y] = rc[y] = 0;// \u6e05\u7a7a\u5f88\u91cd\u8981\uff01\uff01\n\trt = merge(merge(x,newy),z);\n}\n```\n\n[**\u300c\u4ee3\u7801\u4e0d\u653e\uff0c\u8be6\u89c1\u63d0\u4ea4\u8bb0\u5f55\u300d**](https://www.luogu.com.cn/record/56648550)\n\n\u8fd9\u6837\uff0c~~\u4f60\u5c31\u83b7\u5f97\u4e86 TLE~~/cy\n\n\u6ca1\u5f00 O2 \u662f $\\tt 50pts$\uff0c$\\tt 1200ms$\uff0c\u5f00\u4e86\u5c31\u4f1a\u5feb\u4e00\u4e9b\u3002\n\n## \u6700\u540e\u4f18\u5316\n\n\u5e38\u6570\u4ee5\u53ca\u7b97\u6cd5\u672c\u8d28\u7684\u4f18\u5316\u3002\n\n+ `fread` \u5feb\u8bfb\u52a0\u901f\n+ \u53bb\u6389 `define int long long` \u800c\u5728\u8981\u5f00\u7684\u5730\u65b9\u5f00 `ll` \u4f1a\u5feb\u5f88\u591a\n+ FHQ $\\mathcal O(n)$ \u5efa\u6811\n+ O2 \u975e\u5e38\u91cd\u8981\uff01\uff01\u5feb\u5f88\u591a\uff01\uff01\n\n## AC Code\n\n```cpp\n#include<stdio.h>\n#include<stdlib.h>\n#include<algorithm>\ntypedef long long ll;\nconst int maxn = 2e5 + 1;\nstatic char buf[100000],*p1=buf,*p2=buf;\n#define getchar() p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++\ninline int read(){// fread+\u5feb\u8bfb\n    register int x = 0,f = 1;\n    register char c = getchar();\n    for(;c < '0' || c > '9';c = getchar());\n    for(;c >= '0' && c <= '9';c = getchar())\n        x = x * 10 + (c ^ 48);\n    return x;\n}\nint n,m;\nll ans1 = 0,ans2 = 0;// \u5728\u8981\u5f00ll\u7684\u5730\u65b9\u624d\u5f00\nint use[maxn],top = 0,now;\nint lunch[maxn],bake[maxn];\nint tmp[maxn],j,b,l;\nint lc[maxn],rc[maxn],val[maxn],heap[maxn],siz[maxn],cnt = 0,rt;\nll sum[maxn];\nint new_node(int x){\n\tif(top) now = use[top],--top;\n\telse now = ++cnt;\n\tsiz[now] = 1;\n\tval[now] = x;\n\tsum[now] = 1LL * x;\n\theap[now] = rand();\n\treturn now;\n}\nvoid push_up(int i){\n\tsiz[i] = 1 + siz[lc[i]] + siz[rc[i]];\n\tsum[i] = 1LL * val[i] + sum[lc[i]] + sum[rc[i]];\n}\nint merge(int x,int y){\n\tif(!x || !y) return x + y;\n\tif(heap[x] < heap[y]){\n\t\trc[x] = merge(rc[x],y);\n\t\tpush_up(x);\n\t\treturn x; \n\t} else {\n\t\tlc[y] = merge(x,lc[y]);\n\t\tpush_up(y);\n\t\treturn y;\n\t}\n}\nvoid split(int i,int k,int& x,int& y){\n\tif(!i) x = y = 0;\n\telse {\n\t\tif(val[i] <= k){\n\t\t\tx = i;\n\t\t\tsplit(rc[i],k,rc[i],y);\n\t\t} else {\n\t\t\ty = i;\n\t\t\tsplit(lc[i],k,x,lc[i]);\n\t\t}\n\t\tpush_up(i);\n\t}\n}\nint build(int l,int r){\n\tif(l == r) return new_node(tmp[l]);\n\tint mid = l + r >> 1; \n\treturn merge(build(l,mid),build(mid + 1,r));\n}\nint x,y,z,newy,ret;\nll res;\nvoid insert(int k){\n\tsplit(rt,k,x,y);\n\trt = merge(merge(x,new_node(k)),y);\n}\nvoid erase(int k){\n\tsplit(rt,k,x,z);\n\tsplit(x,k - 1,x,y);\n\tnewy = merge(lc[y],rc[y]);\n\tuse[++top] = y;\n\tlc[y] = rc[y] = 0;\n\trt = merge(merge(x,newy),z);\n}\nint rank(int k){\n\tsplit(rt,k - 1,x,y);\n\tret = siz[x] + 1;\n\trt = merge(x,y);\n\treturn n + 1 - ret;\n}\nll summary(int k){\n\tsplit(rt,k - 1,x,y);\n\tres = sum[x];\n\trt = merge(x,y);\n\treturn res;\n}\nint main(){\n\tn = read(),m = read();\n\tfor(int i = 1;i <= n;++i){\n\t\tlunch[i] = read(),bake[i] = read();\n\t\tans1 += lunch[i];\n\t\ttmp[i] = bake[i];\n\t}\n\tstd::sort(tmp + 1,tmp + n + 1);\n\trt = build(1,n);\n\tfor(int i = 1;i <= n;++i)\n\t    ans2 += 1LL * tmp[i] * (n - i + 1);\n\tprintf(\"%lld\\n\",ans1 - ans2);\n\twhile(m--){\n\t\tj = read(),l = read(),b = read();\n\t\tans1 += l - lunch[j],lunch[j] = l;\n\t\tans2 -= summary(bake[j]) + 1LL * rank(bake[j]) * bake[j];// \u9700\u8981\u7684\u5730\u65b9\u5f3a\u8f6cll\n\t\terase(bake[j]);\n\t\tbake[j] = b;\n\t\tinsert(bake[j]);\n\t\tans2 += summary(bake[j]) + 1LL * rank(bake[j]) * bake[j];\n\t\tprintf(\"%lld\\n\",ans1 - ans2);\n\t}\n    return 0;\n}\n```\n---\n\n\u8c03\u4e86 20 \u5929\u7ec8\u4e8e\u624d AC\uff0c\u5b8c\u7ed3\u6492\u82b1qwq~",
        "postTime": 1629634012,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "\u9898\u89e3-P7619"
    },
    {
        "content": "\u6b64\u9898\u89e3\u4f7f\u7528\u5e73\u8861\u6811\u89e3\u51b3\u3002\r\n\r\n## 1\u3001\u539f\u59cb\u60c5\u51b5\r\n\r\n\u9996\u5148\uff0c\u6211\u4eec\u8003\u8651\u672a\u4fee\u6539\u7684\u60c5\u51b5\u3002\u8bbe $L_i$ \u4e3a\u5403\u996d\u65f6\u95f4\uff0c$a_i$ \u4e3a\u5236\u4f5c\u6240\u9700\u65f6\u95f4\u3002\u5bf9\u4e8e $n$ \u4e2a\u5c45\u6c11\uff0c\u5047\u8bbe\u6211\u4eec\u4e0d\u5bf9\u505a\u62ab\u8428\u7684\u987a\u5e8f\u8fdb\u884c\u4fee\u6539\uff0c\u5373\u6309\u7167\u539f\u59cb\u987a\u5e8f\u7684\u8bdd\uff0c\u53ef\u4ee5\u5199\u51fa\u7b54\u6848\uff1a\r\n\r\n$ans = (L_1 - a_1) + [L_2 - (a_1 + a_2)] + [L_3 - (a_1 + a_2 + a_3)] ......$ \r\n\r\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6574\u7406\u540e\u5373\u53ef\u5f97\u5230\uff1a\r\n\r\n$ans = (L_1 + L_2 + L_3 + ..... + L_n) - [na_1 + (n-1)a_2 + (n-2)a_3 + ...... + a_n]$\r\n\r\n\u4e0d\u96be\u770b\u51fa\uff0c\u9001\u62ab\u8428\u7684\u5148\u540e\u987a\u5e8f\u5bf9\u4e8e $L_i$ \u6765\u8bf4\u662f\u6ca1\u6709\u5f71\u54cd\u7684\u3002\u800c\u5bf9\u4e8e\u540e\u534a\u90e8\u5206\uff0c\u6211\u4eec\u8981\u60f3\u4f7f\u5f97\u603b\u7b54\u6848\u6700\u5927\uff0c\u80af\u5b9a\u8981\u4f7f\u5f97 $a_1$ \u6700\u5c0f\uff0c $a_2$ \u6b21\u5927\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u56e0\u6b64\uff0c\u53ea\u9700\u8981\u901a\u8fc7\u4e00\u6b21\u6392\u5e8f\uff0c\u6211\u4eec\u4fbf\u80fd\u8f7b\u677e\u6c42\u51fa\u4fee\u6539\u524d\u6700\u5927\u7684\u5c0f\u8d39\u6536\u76ca\u3002\r\n\r\n## 2\u3001\u4fee\u6539\r\n\r\n\u63a5\u4e0b\u6765\u8003\u8651\u6bcf\u6b21\u7684\u4fee\u6539\u3002\u9996\u5148\uff0c\u5bf9\u4e8e $L_i$ \u7684\u53d8\u5316\uff0c\u6211\u4eec\u76f4\u63a5\u52a0\u51cf\u5373\u53ef\u3002\u91cd\u70b9\u8003\u8651 $a_i$ \u7684\u53d8\u5316\u3002\u4e0d\u59a8\u5982\u6b64\u5047\u8bbe\uff1a\u4ee4 $a_i$ \u539f\u5148\u7684\u6392\u540d\u4e3a $l$, \u800c\u5176\u4fee\u6539\u540e\u7684\u6392\u540d\u4e3a $r (l \\le r)$, \u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u6709\u533a\u95f4 $(l,r)$ \u5185\u90e8\u7684\u6570\u53d7\u5230\u4e86\u5f71\u54cd\uff0c\u4ed6\u4eec\u7684\u7cfb\u6570\u5168\u90e8\u51cf\u5c0f $1$, \u5373\u5bf9\u4e8e\u8be5\u6b21\u4fee\u6539\uff0c\u6211\u4eec\u8981\u51cf\u6389 $\\sum a_i (i \\in (l,r))$\u3002\u5f53 $l \\ge r$ \u7684\u65f6\u5019\u540c\u7406\uff0c\u53cd\u8fc7\u6765\u5373\u53ef\u3002\r\n\r\n## 3\u3001\u5177\u4f53\u64cd\u4f5c\r\n\u8003\u8651\u5230\u6211\u4eec\u9700\u8981\u63d0\u53d6\u4e00\u5b9a\u533a\u95f4\u5185\u90e8\u7684\u6240\u6709\u6570\uff0c\u4f7f\u7528 FHQ-Treap \u53ef\u4ee5\u5f88\u597d\u7684\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u5728\u4f20\u7edf\u5199\u6cd5\u7684\u57fa\u7840\u4e0a\uff0c\u8bb0 $w$ \u4e3a\u6bcf\u4e2a\u8282\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u4e4b\u548c\uff0c\u65b9\u4fbf\u5feb\u901f\u67e5\u8be2\u3002 ~~(\u60f3\u6cd5\u6765\u81ea\u7ebf\u6bb5\u6811)~~\r\n\r\n\u7ec6\u8282\u5904\u7406\u8bf7\u89c1\u4ee3\u7801\u6ce8\u91ca\u3002\r\n## 4\u3001\u540e\u8bb0\r\n- \u4e0d\u5f00 **long long** \u89c1\u7956\u5b97\uff01\r\n- \u6bcf\u6b21\u4fee\u6539\u540e\u7684\u6570\u636e\u5e94\u8be5\u4fdd\u7559\uff0c\u624b\u6478\u6837\u4f8b\u53ef\u4ee5\u53d1\u73b0\u3002\r\n\r\n\u4e0a\u4ee3\u7801\uff08\u5e38\u6570\u7565\u5927\uff0c\u5927\u5bb6\u53ef\u81ea\u884c\u4f18\u5316\u4e00\u4e0b\u3002\uff09\r\n\r\n```\r\n#include <bits/stdc++.h>\r\nusing namespace std;\r\n#define N 2000010\r\n#define ll long long\r\n#define int long long\r\n\r\ntemplate <class T>\r\ninline void read(T& a){\r\n\tT x = 0, s = 1;\r\n\tchar c = getchar();\r\n\twhile(!isdigit(c)){ if(c == '-') s = -1; c = getchar(); }\r\n\twhile(isdigit(c)){ x = x * 10 + (c ^ '0'); c = getchar(); }\r\n\ta = x * s;\r\n\treturn ;\r\n}\r\n\r\nint n, Q;\r\nstruct people{\r\n  int L, T; \r\n  int id; \r\n} a[N]; \r\n\r\nbool cmp1(people a, people b){\r\n  return a.T < b.T; \r\n}\r\n\r\nbool cmp2(people a, people b){\r\n  return a.id < b.id; \r\n}\r\n\r\nll ans = 0; \r\n\r\n/*\u7ecf\u5178 FHQ-Treap \u5199\u6cd5\uff0c\u4e0d\u8fc7\u591a\u89e3\u91ca\u3002*/\r\nint root = 0; \r\n\r\nstruct node{\r\n  int siz, val, ch[2]; \r\n  int pri, w;     // w \u4e3a\u603b\u548c\uff0c val \u4e3a\u5f53\u524d\u70b9\u7684\u503c\r\n} t[N]; \r\n\r\n#define lson ch[0]\r\n#define rson ch[1]\r\n\r\nint tot = 0;\r\ninline int build(int x){\r\n  t[++tot].siz = 1;\r\n  t[tot].val = x; \r\n  t[tot].pri = rand(); \r\n  t[tot].lson = t[tot].rson = 0;\r\n  t[tot].w = x; \r\n  return tot; \r\n}\r\n\r\ninline void pushup(int now){\r\n  t[0].siz = t[0].w = t[0].val = 0; \r\n  t[now].siz = t[t[now].lson].siz + t[t[now].rson].siz + 1; \r\n  t[now].w = t[t[now].lson].w + t[t[now].rson].w + t[now].val; \r\n  return ; \r\n}\r\n\r\nvoid split(int now, int key, int& x, int& y){  // \u5206\u88c2\r\n  if(!now){\r\n    x = y = 0;\r\n    return ; \r\n  }\r\n  if(t[now].val <= key){\r\n    x = now; \r\n    split(t[now].rson, key, t[now].rson, y); \r\n  }\r\n  else {\r\n    y = now; \r\n    split(t[now].lson, key, x, t[now].lson); \r\n  }\r\n  pushup(now); \r\n  return ; \r\n}\r\n\r\nint merge(int x, int y){\r\n  if(!x || !y) return x + y;\r\n  if(t[x].pri > t[y].pri){\r\n    t[x].rson = merge(t[x].rson, y); \r\n    pushup(x);\r\n    return x; \r\n  }\r\n  else{\r\n    t[y].lson = merge(x, t[y].lson); \r\n    pushup(y);\r\n    return y; \r\n  }\r\n  return 0; \r\n}\r\n\r\nvoid insert(int key){\r\n  int x, y; \r\n  split(root, key - 1, x, y); \r\n  root = merge(merge(x, build(key)), y); \r\n  return ; \r\n}\r\n\r\nvoid del(int key){\r\n  int x, y, z; \r\n  split(root, key, x, z); \r\n  split(x, key - 1, x, y); \r\n  if(y) y = merge(t[y].lson, t[y].rson); \r\n  root = merge(merge(x, y), z); \r\n  return ; \r\n}\r\n\r\nint get_ans(int ori, int key){  // \u5904\u7406\u6bcf\u6b21\u4fee\u6539\u540e T \u7684\u53d8\u5316\r\n  if(ori == key) return 0; \r\n  int x, y, z, sum = 0; \r\n  split(root, ori, x, y);         /*\u5bf9\u4e8e\u5927\u5c0f\u76f8\u540c\u7684\u91cd\u590d\u8282\u70b9\u7684\u5904\u7406\uff1a\u76f4\u63a5\u628a\u5f53\u524d\u70b9\u8ba4\u4f5c\u6392\u540d\u6700\u540e\u7684\u4e00\u4e2a\u70b9\u3002\u56e0\u4e3a\u4ed6\u4eec\u7684\u5148\u540e\u987a\u5e8f\u4e0d\u5f71\u54cd\u7b54\u6848.*/\r\n  sum += (n - t[x].siz + 1) * ori;   \r\n  root = merge(x, y); \r\n  del(ori); \r\n  // \u6d88\u9664\u539f\u6709\u5f71\u54cd\r\n\r\n  insert(key); \r\n  if(key > ori){   // \u6ce8\u610f\u5206\u7c7b\u8ba8\u8bba\uff0c\u63d0\u53d6\u533a\u95f4\u5185\u7684\u6240\u6709\u6570\uff0c\u5efa\u8bae\u753b\u56fe\u8ba8\u8bba\r\n    split(root, ori, x, z); \r\n    split(z, key, y, z); \r\n    sum -= t[y].w - key; \r\n    root = merge(merge(x, y), z); \r\n  }\r\n  else {\r\n    split(root, ori, x, z); \r\n    split(x, key, x, y); \r\n    sum += t[y].w; \r\n    root = merge(merge(x, y), z); \r\n  }\r\n  split(root, key, x, y);   // \u4e0d\u8981\u5fd8\u4e86\u8fd9\u4e2a\u6570\u81ea\u5df1\r\n  sum -= (n - t[x].siz + 1) * key; \r\n  root = merge(x, y); \r\n  return sum; \r\n}\r\n\r\nsigned main(){\r\n  read(n); read(Q);\r\n  for(int i = 1; i <= n; i++){\r\n    read(a[i].L), read(a[i].T); \r\n    a[i].id = i; \r\n  }\r\n  sort(a + 1, a + n + 1, cmp1); \r\n  for(int i = 1; i <= n; i++){\r\n    ans += a[i].L; \r\n    ans -= (n - i + 1) * a[i].T; \r\n  }\r\n  cout << ans << endl; \r\n  for(int i = 1; i <= n; i++)\r\n    insert(a[i].T); \r\n  sort(a + 1, a + n + 1, cmp2); \r\n  while(Q--){\r\n    int opt, L, T; \r\n    read(opt), read(L), read(T); \r\n    ans -= a[opt].L; \r\n    ans += L; \r\n    a[opt].L = L; \r\n    ans += get_ans(a[opt].T, T); \r\n    a[opt].T = T; \r\n    printf(\"%lld\\n\", ans); \r\n  }\r\n  return 0;\r\n}\r\n```\r\n",
        "postTime": 1665028915,
        "uid": 234224,
        "name": "\u9752\u9e1f_Blue_Bird",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P7619 [COCI2011-2012#2] RASPORED"
    }
]