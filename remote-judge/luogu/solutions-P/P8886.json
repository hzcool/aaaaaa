[
    {
        "content": "# \u3010DMOI \u5b98\u65b9\u9898\u89e3\u3011\n\n## \u89e3\u9898\u601d\u8def\n\n### \u90e8\u5206\u5206\n\n\u989d\uff0c\u51fa\u9898\u4eba\u60f3\u7740\u7b2c\u4e00\u6863\u90e8\u5206\u5206\u5e94\u8be5\u662f\u4e71\u505a\u5427\uff1f\u66b4\u529b dfs \u5c31\u884c\u4e86\u3002\u800c\u7b2c\u4e8c\u6863\u90e8\u5206\u5206\uff0c\u4e5f\u5c31\u662f $60\\%$ \u7684\uff0c\u5e94\u8be5\u5c31\u662f dfs \u52a0\u4e0a\u4e00\u4e9b\u526a\u679d\uff0c\u6216\u8005 01bfs \u6ca1\u6709\u5b9e\u73b0\u597d\u7684\u540c\u5b66\u5427\u3002\n\n### \u6b63\u89e3\n\n\u6211\u4eec\u8981\u6c42\u7684\u662f\u4f20\u9001\u95e8\u67aa\u6700\u5c11\u4f7f\u7528\u6b21\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u7528\u7ba1\u8d70\u8def\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u8fde\u901a\u7684\u7a7a\u5730\u89c6\u4e3a\u4e00\u4e2a\u8fde\u901a\u5757\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u662f\u8981\u770b\u5982\u679c\u8981\u4ece\u8d77\u70b9\u6240\u5728\u7684\u8fde\u901a\u5757\u8d70\u5230\u7ec8\u70b9\u6240\u5728\u7684\u8fde\u901a\u5757\u81f3\u5c11\u8981\u7ecf\u8fc7\u591a\u5c11\u8fde\u901a\u5757\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u4ece\u4e00\u4e2a\u8fde\u901a\u5757\u62b5\u8fbe\u53e6\u4e00\u4e2a\u8fde\u901a\u5757\uff0c\u8fd9\u4e24\u4e2a\u8fde\u901a\u5757\u4e4b\u95f4\u5fc5\u987b\u5b58\u5728\u4e00\u4e2a\u5730\u65b9\u4ec5\u5b58\u5728\u4e00\u4e2a\u5899\u58c1,\u5982 `..#..` \u5de6\u53f3\u4e24\u4e2a\u8fde\u901a\u5757\u53ef\u4e92\u76f8\u62b5\u8fbe\uff0c\u4f46 `..##..` \u5de6\u53f3\u4e24\u4e2a\u8fde\u901a\u5757\u5c31\u4e0d\u53ef\u4e92\u76f8\u62b5\u8fbe\u3002\n\n\u4e0d\u8fc7\u6211\u4eec\u8981\u601d\u8003\u4e0b\u9762\u8fd9\u4e48\u4e00\u4e2a\u60c5\u51b5\uff1a\n\n```\n.***.\n*.#..\n****#\n*..#.\n****.\n```\n\n\u6211\u4eec\u7528\u6570\u5b57\u8868\u793a\u4e0d\u540c\u7684\u8fde\u901a\u5757\uff0c\u4e00\u4e2a\u8fde\u901a\u5757\u7684\u7a7a\u5730\u7528\u540c\u4e00\u4e2a\u6570\u5b57\u8868\u793a\u3002\n\n```\n1***2\n*3#22\n****#\n*44#5\n****5\n```\n\n\u4f46\u6211\u4eec\u522b\u5fd8\u4e86\u5730\u56fe\u5916\u9762\u4e5f\u90fd\u662f\u5899\uff0c\u56e0\u6b64\u6211\u4eec\u7684\u771f\u6b63\u7684\u5730\u56fe\u5982\u4e0b\uff1a\n\n```\n#######\n#1***2#\n#*3#22#\n#****##\n#*44#5#\n#****5#\n#######\n```\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6709\u5982\u4e0b\u8fde\u901a\u5757\u5230\u8fbe\u5173\u7cfb\uff0c\u5176\u4e2d $i \\to j$ \u8868\u793a\u8fde\u901a\u5757 $i$ \u53ef\u4ee5\u5230\u8fbe\u8fde\u901a\u5757 $j$\uff1a\n\n```\n1 -> 2\n2 -> 1\n2 -> 3\n2 -> 4\n2 -> 5\n4 -> 2\n4 -> 3\n5 -> 2\n5 -> 4\n```\n\n\u6211\u4eec\u53d1\u73b0\u8fde\u901a\u5757 2 \u548c 3 \u4e4b\u95f4\u5b58\u5728\u4e00\u4e2a\u5730\u65b9\u53ea\u6709\u4e00\u4e2a\u5899\u95f4\u9694\uff0c\u4f46\u662f 3 \u4e0d\u80fd\u5230 2 \uff0c 2 \u53ef\u4ee5\u5230 3 \uff0c\u56e0\u4e3a 3 \u65c1\u8fb9\u9664\u4e86\u4e00\u5835\u5899\u4ee5\u5916\u90fd\u662f\u865a\u7a7a\uff0c\u65e0\u6cd5\u5efa\u7acb\u4e24\u4e2a\u4e0d\u540c\u989c\u8272\u7684\u4f20\u9001\u95e8\uff0c\u4f46 2 \u53ef\u4ee5\u3002\n\n\u8fd8\u662f\u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\uff0c\u6ce8\u610f\u8fde\u901a\u5757 4 \u53ef\u4ee5\u62b5\u8fbe\u8fde\u901a\u5757 2 \u548c 3\uff0c\u56e0\u4e3a\u4f20\u9001\u95e8\u662f\u53ef\u4ee5\u7a7f\u8fc7\u865a\u7a7a\u7684\uff0c\u4f46\u662f 4 \u4e0d\u53ef\u4ee5\u62b5\u8fbe\u8fde\u901a\u5757 5\uff0c\u56e0\u4e3a\u4e0d\u80fd\u5728\u865a\u7a7a\u4e2d\u8d70\u8def\u3002\n\n\u8fd8\u8981\u6ce8\u610f\uff0c\u4e0d\u80fd\u5728\u4e00\u5835\u5899\u4e0a\u5efa\u4e24\u9762\u4f20\u9001\u95e8\u3002\n\n\u60f3\u6e05\u695a\u4e86\u4ee5\u4e0a\u60c5\u51b5\u540e\uff0c\u6211\u4eec\u5c31\u6709\u4e00\u4e2a\u6e05\u6670\u7684\u601d\u8def\uff0c\u53ef\u4ee5\u5efa\u7acb\u51fa\u6765\u4e00\u4e2a\u6709\u5411\u56fe\uff0c$i \\to j$ \u8868\u793a\u8fde\u901a\u5757 $i$ \u53ef\u4ee5\u62b5\u8fbe\u8fde\u901a\u5757 $j$\uff0c\u6bcf\u6761\u8fb9\u7684\u8fb9\u6743\u90fd\u4e3a $1$\uff0c\u8981\u6c42\u7684\u5c31\u662f\u8d77\u70b9\u6240\u5728\u8fde\u901a\u5757\u5230\u7ec8\u70b9\u6240\u5728\u8fde\u901a\u5757\u7684\u6700\u77ed\u8ddd\u79bb\uff0c\u5c31\u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u9009\u62e9 $1 \\to 2,2 \\to 5$ \u4e24\u6761\u8fb9\u5373\u53ef\u5230\u8fbe\u7ec8\u70b9\u6240\u5728\u8fde\u901a\u5757\u3002\n\n\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u91c7\u7528 01bfs \u7684\u65b9\u5f0f\uff0c\u4e0d\u5efa\u56fe\u8dd1\uff0c\u4f46\u8fd9\u6837\u7684\u8bdd\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u4e00\u5b9a\u7684\u526a\u679d\uff0c\u4e0d\u8fc7\u5982\u679c\u5b9e\u73b0\u5f97\u6bd4\u8f83\u597d\u7684\u8bdd\uff0c\u4e0d\u526a\u679d\u4e5f\u53ef\u4ee5\u8fc7\u3002\n\n\u4e0d\u8fc7\u4ee3\u7801\u5b9e\u73b0\u4e0a\u8981\u8003\u8651\u5230\u7684\u8fd8\u662f\u633a\u591a\u7684\u3002\n\n## \u89e3\u9898\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<queue>\n#include<map>\nusing namespace std;\ninline int read(){\n\tint x=0;\n\tint ch=getchar(),f=0;\n\twhile(ch<48||ch>57) f=(ch=='-'),ch=getchar();\n\twhile(ch>47&&ch<58) x=(x<<3)+(x<<1)+(ch&15),ch=getchar();\n\treturn f?-x:x;\n}\ninline void write(int x,char end='\\n'){\n\tif(x==0){\n\t\tputchar('0');\n\t\tputchar(end);\n\t\treturn;\n\t}\n\tif(x<0) putchar('-'),x=-x;\n\tint st[70],sr=0;\n\twhile(x){\n\t\tst[sr++]=x%10;\n\t\tx/=10;\n\t}\n\twhile(sr--) putchar(st[sr]+48);\n\tputchar(end);\n\treturn;\n}\nconst int N=2005,INF=2e9;\nconst int M=2500005,M2=5000005;\nconst int dx[4]={0,1,-1,0},dy[4]={1,0,0,-1};\nint n;\nchar s[N][N];\nint dis[N];\nint col[N][N];\nint head,tail;\nstruct node{\n    int x,y;\n};\nstruct edge{\n\tint to,nxt;\n}e[M2];\nint hd[M2],ecnt;\ninline void add(int u,int v){\n\te[++ecnt].to=v;\n\te[ecnt].nxt=hd[u];\n\thd[u]=ecnt;\n}\nnode q[M2];\nint cango[10],only[M2][2];\n#define mp make_pair\nmap<pair<int,int>,bool> mps;\ninline void bfs(){\n\tint cnt=0;\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=n;++j){\n\t\t\tif(s[i][j]=='.'&&!col[i][j]){\n\t\t\t\thead=1,tail=0;\n\t\t\t\t++cnt;\n\t\t\t\tq[++tail]=(node{i,j});\n\t\t\t\twhile(head<=tail){\n\t\t\t\t\tnode h=q[head++];\n\t\t\t\t\tint x=h.x,y=h.y;\n\t\t\t\t\tcol[x][y]=cnt;\n\t\t\t\t\tfor(int i=0;i<4;++i){\n\t\t\t\t\t\tint tx=x+dx[i],ty=y+dy[i];\n\t\t\t\t\t\tif(s[tx][ty]!='.') continue;\n\t\t\t\t\t\tif(!col[tx][ty]){\n\t\t\t\t\t\t\tcol[tx][ty]=cnt;\n\t\t\t\t\t\t\tq[++tail]=(node{tx,ty});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=cnt;++i) only[i][0]=only[i][1]=-1;\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=n;++j){\n\t\t\tif(col[i][j]){\n\t\t\t\tint g=col[i][j];\n\t\t\t\tif(s[i-1][j]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i-1;\n\t\t\t\t\t\tonly[g][1]=j;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t\tif(s[i+1][j]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i+1;\n\t\t\t\t\t\tonly[g][1]=j;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t\tif(s[i][j-1]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i;\n\t\t\t\t\t\tonly[g][1]=j-1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t\tif(s[i][j+1]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i;\n\t\t\t\t\t\tonly[g][1]=j+1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=0;i<=n+1;++i){\n\t\tfor(int j=0;j<=n+1;++j){\n\t\t\tif(s[i][j]=='#'){\n//\t\t\t\tprintf(\"now judging:%d %d\\n\",i,j);\n\t\t\t\tfor(int k=1;k<=4;++k) cango[k]=-1;\n\t\t\t\tbool nowflag=0;\n\t\t\t\tif(i<n&&col[i+1][j]) cango[1]=col[i+1][j],nowflag=1;\n\t\t\t\tif(i>1&&col[i-1][j]) cango[2]=col[i-1][j],nowflag=1;\n\t\t\t\tif(j<n&&col[i][j+1]) cango[3]=col[i][j+1],nowflag=1;\n\t\t\t\tif(j>1&&col[i][j-1]) cango[4]=col[i][j-1],nowflag=1;\n\t\t\t\tif(!nowflag) continue;\n\t\t\t\tfor(int k=j-1;k>=1&&s[i][k]!='#';--k){\n\t\t\t\t\tint c=col[i][k];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==j-1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n//\t\t\t\t\t\t\t\t\t\tprintf(\"%d %d\\n\",cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(only[c][0]==i&&only[c][1]==j) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int k=j+1;k<=n&&s[i][k]!='#';++k){\n\t\t\t\t\tint c=col[i][k];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==j+1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n//\t\t\t\t\t\t\t\t\t\tprintf(\"%d %d\\n\",cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(only[c][0]==i&&only[c][1]==j) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int k=i-1;k>=1&&s[k][j]!='#';--k){\n\t\t\t\t\tint c=col[k][j];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==i-1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n//\t\t\t\t\t\t\t\t\t\tprintf(\"%d %d\\n\",cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(only[c][0]==i&&only[c][1]==j) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int k=i+1;k<=n&&s[k][j]!='#';++k){\n\t\t\t\t\tint c=col[k][j];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==i+1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n//\t\t\t\t\t\t\t\t\t\tprintf(\"%d %d\\n\",cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(only[c][0]==i&&only[c][1]==j) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tdis[1]=0;\n\tfor(int i=2;i<=cnt;++i) dis[i]=INF;\n\tpriority_queue<pair<int,int> > q2;\n\tq2.push(mp(0,1));\n\twhile(!q2.empty()){\n\t\tint u=q2.top().second;\n\t\tq2.pop();\n\t\tfor(int i=hd[u];i;i=e[i].nxt){\n\t\t\tint v=e[i].to;\n\t\t\tif(dis[v]>dis[u]+1){\n\t\t\t\tdis[v]=dis[u]+1;\n\t\t\t\tq2.push(mp(-dis[v],v));\n\t\t\t}\n\t\t}\n\t}\n\tmps.clear();\n\tfor(int i=1;i<=ecnt;++i) e[i]=edge{0,0};\n\tecnt=0;\n\tfor(int i=1;i<=cnt;++i) hd[i]=0;\n\tcnt=0;\n}\nint main(){\n    int T=read();\n    while(T--){\n    \tn=read();\n        for(int i=1;i<=n;i++)\n            scanf(\"%s\",s[i]+1);\n        if(s[1][1]!='.'||s[n][n]!='.')\n            return 0;\n        for(int i=0;i<=n+1;++i)\n        \tfor(int j=0;j<=n+1;++j)\n        \t\tcol[i][j]=0;\n        for(int i=0;i<=n+1;++i) s[i][0]=s[i][n+1]='#';\n        for(int i=0;i<=n+1;++i) s[0][i]=s[n+1][i]='#';\n\t\tbfs();\n//        for(int i=0;i<=n+1;++i){\n//        \tfor(int j=0;j<=n+1;++j){\n//        \t\tprintf(\"%d \",col[i][j]);\n//\t\t\t}\n//\t\t\tputs(\"\");\n//\t\t}\n        if(dis[col[n][n]]==INF) puts(\"-1\");\n        else printf(\"%d\\n\",dis[col[n][n]]*2);\n    }\n    return 0;\n}\n```\n\n### \u540e\u8bb0\n\n\u5176\u5b9e\u4e00\u5f00\u59cb\u51fa\u9898\u4eba std \u6302\u6389\u4e86\uff0c\u6f0f\u8003\u8651\u4e86\u4e00\u6b21\u5224\u65ad\uff0c\u7ed3\u679c\u65b0\u9020\u7684\u6570\u7adf\u7136\u5361\u4e0d\u6389\u9519\u8bef\u7684 std\uff0c\u5728\u5199\u9898\u89e3\u65f6\u624d\u53d1\u73b0\u81ea\u5df1\u624b\u9020\u7684\u6570\u636e\u4f7f\u5f97\u539f\u6765\u7684 std \u6302\u4e86\u3002\n\n\u5728\u7ecf\u8fc7\u8bb8\u591a\u6b21\u5bf9\u62cd\u540e\u53d1\u73b0\u5361\u4e0d\u6389\u8fd9\u79cd\u9519\u6cd5\uff0c\u53ea\u597d\u4f5c\u7f62\uff0c\u628a\u539f std \u8d34\u51fa\u6765\uff0c\u5e0c\u671b\u5404\u4f4d\u80fd\u591f\u628a\u5b83\u7ed9 hack \u6389\uff1a\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<queue>\n#include<map>\nusing namespace std;\ninline int read(){\n\tint x=0;\n\tint ch=getchar(),f=0;\n\twhile(ch<48||ch>57) f=(ch=='-'),ch=getchar();\n\twhile(ch>47&&ch<58) x=(x<<3)+(x<<1)+(ch&15),ch=getchar();\n\treturn f?-x:x;\n}\ninline void write(int x,char end='\\n'){\n\tif(x==0){\n\t\tputchar('0');\n\t\tputchar(end);\n\t\treturn;\n\t}\n\tif(x<0) putchar('-'),x=-x;\n\tint st[70],sr=0;\n\twhile(x){\n\t\tst[sr++]=x%10;\n\t\tx/=10;\n\t}\n\twhile(sr--) putchar(st[sr]+48);\n\tputchar(end);\n\treturn;\n}\nconst int N=2005,INF=2e9;\nconst int M=2500005,M2=5000005;\nconst int dx[4]={0,1,-1,0},dy[4]={1,0,0,-1};\nint n;\nchar s[N][N];\nint dis[N];\nint col[N][N];\nint head,tail;\nstruct node{\n    int x,y;\n};\nstruct edge{\n\tint to,nxt;\n}e[M2];\nint hd[M2],ecnt;\ninline void add(int u,int v){\n\te[++ecnt].to=v;\n\te[ecnt].nxt=hd[u];\n\thd[u]=ecnt;\n}\nnode q[M2];\nint cango[10],only[M2][2];\n#define mp make_pair\nmap<pair<int,int>,bool> mps;\ninline void bfs(){\n\tint cnt=0;\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=n;++j){\n\t\t\tif(s[i][j]=='.'&&!col[i][j]){\n\t\t\t\thead=1,tail=0;\n\t\t\t\t++cnt;\n\t\t\t\tq[++tail]=(node{i,j});\n\t\t\t\twhile(head<=tail){\n\t\t\t\t\tnode h=q[head++];\n\t\t\t\t\tint x=h.x,y=h.y;\n\t\t\t\t\tcol[x][y]=cnt;\n\t\t\t\t\tfor(int i=0;i<4;++i){\n\t\t\t\t\t\tint tx=x+dx[i],ty=y+dy[i];\n\t\t\t\t\t\tif(s[tx][ty]!='.') continue;\n\t\t\t\t\t\tif(!col[tx][ty]){\n\t\t\t\t\t\t\tcol[tx][ty]=cnt;\n\t\t\t\t\t\t\tq[++tail]=(node{tx,ty});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=cnt;++i) only[i][0]=only[i][1]=-1;\n\tfor(int i=1;i<=n;++i){\n\t\tfor(int j=1;j<=n;++j){\n\t\t\tif(col[i][j]){\n\t\t\t\tint g=col[i][j];\n\t\t\t\tif(s[i-1][j]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i-1;\n\t\t\t\t\t\tonly[g][1]=j;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t\tif(s[i+1][j]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i+1;\n\t\t\t\t\t\tonly[g][1]=j;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t\tif(s[i][j-1]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i;\n\t\t\t\t\t\tonly[g][1]=j-1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t\tif(s[i][j+1]=='#'){\n\t\t\t\t\tif(only[g][0]==-1){\n\t\t\t\t\t\tonly[g][0]=i;\n\t\t\t\t\t\tonly[g][1]=j+1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tonly[g][0]=only[g][1]=-2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=0;i<=n+1;++i){\n\t\tfor(int j=0;j<=n+1;++j){\n\t\t\tif(s[i][j]=='#'){\n//\t\t\t\tprintf(\"now judging:%d %d\\n\",i,j);\n\t\t\t\tfor(int k=1;k<=4;++k) cango[k]=-1;\n\t\t\t\tif(i<n&&col[i+1][j]) cango[1]=col[i+1][j];\n\t\t\t\tif(i>1&&col[i-1][j]) cango[2]=col[i-1][j];\n\t\t\t\tif(j<n&&col[i][j+1]) cango[3]=col[i][j+1];\n\t\t\t\tif(j>1&&col[i][j-1]) cango[4]=col[i][j-1];\n\t\t\t\tfor(int k=j-1;k>=1&&s[i][k]!='#';--k){\n\t\t\t\t\tint c=col[i][k];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==j-1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int k=j+1;k<=n&&s[i][k]!='#';++k){\n\t\t\t\t\tint c=col[i][k];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==j+1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int k=i-1;k>=1&&s[k][j]!='#';--k){\n\t\t\t\t\tint c=col[k][j];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==i-1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int k=i+1;k<=n&&s[k][j]!='#';++k){\n\t\t\t\t\tint c=col[k][j];\n\t\t\t\t\tif(c){\n\t\t\t\t\t\tfor(int l=1;l<=4;++l){\n\t\t\t\t\t\t\tif(cango[l]==-1) continue;\n\t\t\t\t\t\t\tif(c==cango[l]) continue;\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]&&mps[mp(cango[l],c)]) continue;\n\t\t\t\t\t\t\tif(only[c][0]==-1) continue;\n\t\t\t\t\t\t\tif(k==i+1){\n\t\t\t\t\t\t\t\tif(only[cango[l]][0]==-2){\n\t\t\t\t\t\t\t\t\tif(!mps[mp(cango[l],c)]){\n\t\t\t\t\t\t\t\t\t\tmps[mp(cango[l],c)]=1;\n\t\t\t\t\t\t\t\t\t\tadd(cango[l],c);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(mps[mp(c,cango[l])]) continue;\n\t\t\t\t\t\t\tmps[mp(c,cango[l])]=1;\n\t\t\t\t\t\t\tadd(c,cango[l]);\n//\t\t\t\t\t\t\tprintf(\"%d %d\\n\",c,cango[l]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tdis[1]=0;\n\tfor(int i=2;i<=cnt;++i) dis[i]=INF;\n\tpriority_queue<pair<int,int> > q2;\n\tq2.push(mp(0,1));\n\twhile(!q2.empty()){\n\t\tint u=q2.top().second;\n\t\tq2.pop();\n\t\tfor(int i=hd[u];i;i=e[i].nxt){\n\t\t\tint v=e[i].to;\n\t\t\tif(dis[v]>dis[u]+1){\n\t\t\t\tdis[v]=dis[u]+1;\n\t\t\t\tq2.push(mp(-dis[v],v));\n\t\t\t}\n\t\t}\n\t}\n\tmps.clear();\n\tfor(int i=1;i<=ecnt;++i) e[i]=edge{0,0};\n\tecnt=0;\n\tfor(int i=1;i<=cnt;++i) hd[i]=0;\n\tcnt=0;\n}\nint main(){\n\tfreopen(\"portal.in\",\"r\",stdin);\n\tfreopen(\"std2.out\",\"w\",stdout);\n    int T=read();\n    while(T--){\n    \tn=read();\n        for(int i=1;i<=n;i++)\n            scanf(\"%s\",s[i]+1);\n        if(s[1][1]!='.'||s[n][n]!='.')\n            return 0;\n        for(int i=0;i<=n+1;++i)\n        \tfor(int j=0;j<=n+1;++j)\n        \t\tcol[i][j]=0;\n        for(int i=0;i<=n+1;++i) s[i][0]=s[i][n+1]='#';\n        for(int i=0;i<=n+1;++i) s[0][i]=s[n+1][i]='#';\n\t\tbfs();\n//        for(int i=0;i<=n+1;++i){\n//        \tfor(int j=0;j<=n+1;++j){\n//        \t\tprintf(\"%d \",col[i][j]);\n//\t\t\t}\n//\t\t\tputs(\"\");\n//\t\t}\n        if(dis[col[n][n]]==INF) puts(\"-1\");\n        else printf(\"%d\\n\",dis[col[n][n]]*2);\n    }\n    return 0;\n}\n```",
        "postTime": 1669256368,
        "uid": 389192,
        "name": "andychen_2012",
        "ccfLevel": 5,
        "title": "Portal \u9898\u89e3"
    }
]