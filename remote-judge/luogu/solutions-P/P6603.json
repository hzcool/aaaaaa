[
    {
        "content": "# \u9898\u89e3 - $\\mathrm{P6603}\\ $\u751c\u68a6\n\n### \u9898\u76ee\u610f\u601d\n\n* [\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6603)\n\n### $\\mathrm{Sol}$\n\n* **\u4e00\u9053\u5f88\u795e\u4ed9\u7684\u72b6\u538b$DP$**\n\n* \u6211\u4eec\u53d1\u73b0$l\\leq 12$\uff0c\u6211\u4eec\u81ea\u7136\u800c\u7136\u5730\u60f3\u5230\u4e86\u72b6\u538b\u3002\u4e8e\u662f$f_{S,u}$\u8868\u793a\u5728\u72b6\u6001$S$\u4e0b\u8f83\u5c0f\u7684\u70b9\u4e3a$u$\u7684\u6700\u5927\u5feb\u4e50\u503c\u3002$S$\u8fd9\u4e2a\u4e1c\u897f\u5176\u5b9e\u662f\u5bf9$[u,u+l]$\u8fd9\u6bb5\u533a\u95f4\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u3002\n\n* \u6211\u4eec\u5982\u4f55\u7528\u8f83\u5c0f$u$\u6807\u53f7\u53bb\u63a8\u51fa\u8f83\u5927\u6807\u53f7$v$\uff0c\u6211\u4eec\u9996\u5148\u8bf4\u51fa\u7ed3\u8bba$v=u+High(S)$\u3002\u5176\u4e2d$High(S)$\u4e3a$S$\u72b6\u6001\u4e0b\u6700\u9ad8\u4f4d$1$\u7684\u4f4d\u7f6e\u3002\u5177\u4f53\u662f\u56e0\u4e3a\u6211\u4eec\u7684$DAG$\u662f\u8d70\u4e0d\u4e86\u56de\u5934\u8def\u7684\uff0c\u6240\u4ee5$v$\u4e00\u5b9a\u662f\u5f53\u524d\u72b6\u6001\u4e0b\u7684\u6700\u9ad8\u4f4d\u3002\u8fd9\u4e2a\u8fd8\u662f\u53ef\u4ee5\u7406\u89e3\u7684\u5427\u3002\n\n* \u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u8f6c\u79fb\uff0c\u5176\u5b9e\u83ab\u8fc7\u4e8e$3$\u79cd\u60c5\u51b5\u3002\n\n* $[1]$ $u,v$\u540c\u65f6\u79fb\u52a8\u5230$P$\n\n  * \u90a3\u4e48\u8f6c\u79fb\uff1a$f_{1,P}=\\max(f_{1,P},f_{S,u}+val_{P})$\n  * \u8fd9\u4e2a\u597d\u7406\u89e3\u5c31\u662f\u4e24\u4e2a\u70b9\u5e76\u5230\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u66f4\u65b0\u72b6\u6001\u4e3a$1(2^0)$\n\n* $[2]$ $v$\u79fb\u52a8\u5230$P$\uff0c$u$\u4e0d\u52a8\n\n  * \u90a3\u4e48\u8f6c\u79fb\uff1a$f_{S|(1<<P-u),u}=\\max(f_{S|(1<<P-u),u},f_{S,u}+val_P$\n\n   * \u8fd9\u4e2a\u4e0d\u9700\u8981\u8003\u8651\u4ee5\u524d\u72b6\u6001\u662f\u5426\u51fa\u73b0\u8fc7\uff0c\u56e0\u4e3a\u7f16\u53f7\u662f\u9012\u589e\u7684\n\n* $[3]\\ u$\u79fb\u52a8\u5230$P$\uff0c$v$\u4e0d\u52a8\n\n  * \u5982\u679c\u6b64\u65f6$P>v$\u90a3\u4e48$v$\u6210\u4e3a\u8f83\u5c0f\u70b9\uff0c\u4e8e\u662f$f_{(S>>v-u)|(1<<P-v),v}=\\max(f_{(S>>v-u)|(1<<P-v),v},f_{S,u}+val_{P})$\n\n   * \u6b64\u65f6\u8fd9\u4e2a$val_P$\u8981\u770b\u5728\u4e0a\u4e00\u4e2a\u72b6\u6001\u4e2d\u662f\u5426\u51fa\u73b0\u8fc7\n\n\n   * \u5982\u679c\u6b64\u65f6$P<v$\u90a3\u4e48$P$\u8fd8\u662f\u8f83\u5c0f\u70b9\uff0c\u4e8e\u662f$f_{S>>P-u|1,u}=\\max(f_{S>>P-u|1,u},f_{S,u}+val_{P})$\n\n\n   * \u6b64\u65f6\u8fd9\u4e2a$val_P$\u8981\u770b\u5728\u4e0a\u4e00\u4e2a\u72b6\u6001\u4e2d\u662f\u5426\u51fa\u73b0\u8fc7\n\n   \n\n* \u4e8e\u662f\u7b54\u6848\u5c31\u662f$f_{1,n}$\u3002\u5c31\u662f\u4e24\u4e2a\u70b9\u90fd\u5728$n$\u70b9\uff0c\u5176\u4ed6\u5c31\u662f\u5199\u7ec6\u8282\u95ee\u9898\u5566~~~\n\n\n### $\\mathrm{Code}$\n\n```cpp\n#include <bits/stdc++.h>\n#define For(i,a,b) for ( int i=(a);i<=(b);i++ )\n#define Dow(i,b,a) for ( int i=(b);i>=(a);i-- )\n#define GO(i,x) for ( int i=head[x];i;i=e[i].nex )\n#define mem(x,s) memset(x,s,sizeof(x))\n#define cpy(x,s) memcpy(x,s,sizeof(x))\n#define YES return puts(\"YES\"),0\n#define NO return puts(\"NO\"),0\n#define GG return puts(\"-1\"),0\n#define pb push_back\nusing namespace std;\n\ninline int read()\n{\n\tint sum=0,ff=1; char ch=getchar();\n\twhile(!isdigit(ch))\n\t{\n\t\tif(ch=='-') ff=-1;\n\t\tch=getchar();\n\t}\n\twhile(isdigit(ch))\n\t\tsum=sum*10+(ch^48),ch=getchar();\n\treturn sum*ff;\n}\n\nconst int mod=1e9+7;\nconst int mo=998244353;\nconst int N=5005;\nconst int M=1<<13|1;\n\nint n,m,l,val[N],a[N][N],f[N][M],High[M];\nvector<int> G[N];\n\nint main()\n{\n\tn=read();m=read();l=read();\n\tFor(i,1,n) val[i]=read();\n\tFor(i,1,m)\n\t{\n\t\tint x,y;\n\t\tx=read(),y=read();\n\t\tif(!a[x][y]) a[x][y]=1,G[x].pb(y);\n\t}\n\tFor(S,0,(1<<l+1)-1) for ( int j=l+1;~j;j-- ) if((S>>j)&1)\n\t{\n\t\tHigh[S]=j;\n\t\tbreak;\n\t}\n\tmemset(f,-1,sizeof(f));\n\tFor(i,1,n)\n\t{\n\t\tif(f[i][1]==-1) f[i][1]=0;\n\t\tFor(S,0,(1<<l+1)-1)\n\t\t{\n\t\t\tif(!(S&1)) continue;\n\t\t\tint idv=i+High[S];\n\t\t\tif(f[i][S]==-1) continue;\n\t\t\tFor(j,0,(int)G[idv].size()-1)\n\t\t\t{\n\t\t\t\tint v=G[idv][j];\n\t\t\t\tif(a[i][v]) f[v][1]=max(f[i][S]+val[v],f[v][1]);\n\t\t\t\tif(v-i>l) continue;\n\t\t\t\tint nxt=S|(1<<v-i);\n\t\t\t\tf[i][nxt]=max(f[i][nxt],f[i][S]+val[v]);\n\t\t\t}\n\t\t\tFor(j,0,(int)G[i].size()-1)\n\t\t\t{\n\t\t\t\tint v=G[i][j];\n\t\t\t\tif(v-idv>l) continue;//1:\n\t\t\t\tif(v>idv)\n\t\t\t\t{\n\t\t\t\t\tint nxt=(S>>idv-i)|(1<<v-idv);\n\t\t\t\t\tif(S>>v-i&1) f[idv][nxt]=max(f[idv][nxt],f[i][S]);\n\t\t\t\t\telse f[idv][nxt]=max(f[idv][nxt],f[i][S]+val[v]);\n\t\t\t\t}\n\t\t\t\telse \n\t\t\t\t{\n\t\t\t\t\tint nxt=S>>v-i|1;\n\t\t\t\t\tif(S>>v-i&1) f[v][nxt]=max(f[v][nxt],f[i][S]);\n\t\t\t\t\telse f[v][nxt]=max(f[v][nxt],f[i][S]+val[v]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%d\\n\",f[n][1]);\n\treturn 0;\n}\n\t\t\t\t\n\t\t\n\t\t\n```\n\n   ",
        "postTime": 1592185082,
        "uid": 308464,
        "name": "\u5947\u7c73",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6603 \u3010\u300cEZEC-2\u300d\u751c\u68a6\u3011"
    },
    {
        "content": "**P0:\u9898\u5916\u8bdd**\uff1a\n\nupdate: \u8d5b\u540e\u7684\u7a7a\u95f4\u7ed9\u8db3\u4e86256MB\uff0c\u73b0\u5728\u53ea\u8981\u5199\u6b63\u89e3\u90fd\u80fd\u8fc7\u3002\n\n~~\u5e9f\u8bdd\u6709\u70b9\u591a\uff0c\u4e0d\u60f3\u770b\u7684\u76f4\u63a5\u5f80\u4e0b\u7ffb~~\n\n~~\u8fd9\u9898\u771f\u662f\u6211\u68a6\u91cc\u60f3\u51fa\u6765\u76842333~~\n\n\u6709\u4eba\u5199\u51fa\u6211\u7684\u9898\u4e86\uff0c\u597d\u5f00\u5fc3\u554a!\uff08\u96fe\n\n\u4e0d\u8fc7\u8fd9\u6b21\u7279\u6b8a\u5956\u52b1\u6ca1\u4eba\u62ff\u5230\u6709\u70b9\u53ef\u60dc\u60f9\n\n\u67d0\u5929\u9192\u6765\u7a81\u7136\u53d1\u73b0\u67d0\u5927\u4f6c\u95ee\u6211\u67d0\u4e2a\u6d4b\u8bd5\u70b9\u4e3a\u5565WA\uff0c\u4e00\u770b\u4ed6\u7684\u66b4\u529b\u526a\u679d\u89e3\u6cd5 $95$ \u3002\u3002\u3002\u8fd9\u624d\u53d1\u73b0\u6570\u636e\u7684\u5783\u573e\uff08\u4e8b\u5b9e\u8bc1\u660e\u90a3\u4e2a\u526a\u679d\u4e0d\u53ef\u884c\uff0c\u5f53\u65f6\u8fd8\u6000\u7591\u6211\u7684\u65b9\u6cd5\u4e0d\u662f\u552f\u4e00\u89e3\u6cd5233\uff09\n\n\u8fd9\u9053\u9898\u6b63\u89e3\u5b8c\u5168\u4e0d\u5361\u65f6\u95f4\u7a7a\u95f4\uff0cstd\u7684\u65f6\u7a7a\u5728\u4e0d\u5f00 $O_2$ \u7684\u60c5\u51b5\u4e0b\u5747\u6709\u5341\u500d\u4ee5\u4e0a\u7684\u5bbd\u88d5(\u800c\u4e14std\u5e76\u6ca1\u6709\u5361\u5e38)\u3002\u7a7a\u95f4\u548c\u65f6\u95f4\u7684\u7d27\u8feb\u4ec5\u5bf9\u4e8e\u67d0\u4e9b\u4e0d\u662f\u6b63\u89e3\u7684\u6ee1\u5206\u505a\u6cd5\u9002\u7528\uff08~~\u6240\u4ee5\u6211\u6ca1\u5361\u90a3\u4e9b\u505a\u6cd5\u5c31\u4e0d\u7b97\u6bd2\u7624\u5427~~\uff09\n\n\u5361\u7a7a\u95f4\u7684\u539f\u56e0\u6709\u56db\u4e2a\uff1a\n\n1.\u8fd9\u9898\u7684\u7a7a\u95f4\u80fd\u591f\u4f18\u5316 $400$ \u500d\u4ee5\u4e0a\n\n2.\u8fd9\u9898\u7684\u6b63\u89e3\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u65b9\u6cd5\u4ee5\u4e0d\u90a3\u4e48\u5e38\u89c1\u7684\u65b9\u5f0f\u5199\n\n3.\u5728\u5361\u7a7a\u95f4\u7684\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u53d8\n\n4.\u6b63\u89e3\u7684\u65b9\u6cd5\u4e0d\u5c11\uff0c\u800c\u4e14\u6bcf\u79cd\u90fd\u6709\u5b58\u5728\u7684\u610f\u4e49\n\n\u6211\u65e2\u7136\u6562\u5361\u5c31\u6562\u627f\u62c5\u8d23\u4efb\u3002\u8981\u55b7\u8bf7\u5c3d\u60c5\u55b7\uff0c\u5982\u679c\u6709\u9053\u7406\u7684\u6211\u4e00\u5b9a\u4f1a\u63a5\u53d7\u3002\n\n------------\n**P1:\u6700\u57fa\u7840\u7684\u89c2\u5bdf\uff1a**\n\n\u867d\u7136\u4e0d\u89c2\u5bdf\u8fd9\u4e2a\u89e3\u9898\u4e5f\u6ca1\u5f71\u54cd\u00bf\n\n\u7531\u4e8e\u53ef\u4ee5\u540c\u65f6\u8d70\u5e76\u4e14\u4fdd\u8bc1\u8fde\u901a\uff0c\u8fd9\u9898\u4e0d\u53ef\u80fd\u51fa\u73b0\u65e0\u89e3\u72b6\u6001\u3002(~~\u6ca1\u9519\u5c31\u662f\u4e3a\u4e86\u8003\u89c2\u5bdf\u95f2\u7740\u65e0\u804a\u52a0\u4e0a\u53bb\u7684~~)\n\n\u4e3a\u5565\u8981\u8fd9\u4e48\u641e\u5462\uff1f\u56e0\u4e3a\u4e0a\u6b21\u65e0\u89e3\u7ed9\u4e86\u4e94\u5206\uff0c\u7ed3\u679c\u5230\u7ed3\u675f\u6ca1\u4eba\u5199\u6b63\u89e3\uff0c\u5012\u662f\u6709\u8d85\u8fc7 $50$ \u4eba\u9a97\u4e86\u4e94\u5206\u3002\u3002\u3002\n\n\u4e0d\u662f\u8bf4\u8fd9\u79cd\u9a97\u5206\u4e0d\u597d\uff0c\u4f46\u662f\u5230\u65f6\u5019\u6765\u4e2a\u6346\u7ed1\u8fd9\u79cd\u9a97\u5206\u4e0d\u5c31\u8499\u4e86\u5417\uff08\n\n\u5f53\u7136\uff0c\u8fd9\u6b21\u4ecd\u7136\u7ed9\u4e86\u9a97\u5206\u7684\u6570\u636e\uff0c\u540e\u9762\u4f1a\u8bb2\u5230\u3002\n\n------------\n\n**P2:\u9898\u89e3\uff1a**\n\n\u5bf9\u4e8e $ n <= 10$ \u7684\u70b9\uff0c\u66b4\u529b $dfs$\uff0c\u590d\u6742\u5ea6 $O(n!)$\u3002\n\n\u88f8\u7684 $dfs$ \u6211\u653e\u4e86\u4e00\u624b\uff0c\u7ed9\u4e86 $20$ \u5206\uff0c\u653e\u8fc7\u4e86\u4e24\u4e2a\u4e0d\u7a20\u5bc6\u7684 $n\\le 16$ \u7684\u70b9\u3002\u4f46\u5982\u679c\u8981\u6bd2\u7624\u8d77\u6765\u4e0d\u6ce8\u91cd\u5e38\u6570\u4f18\u5316\u8fde $n<=10$ \u90fd\u672a\u5fc5\u8fc7\u5f97\u53bb\u3002\n\n\u6838\u5fc3\u679a\u4e3e\u4ee3\u7801\uff1a\n```\ninline void dfs(int fir, int sec, int num){\n  if (fir==sec && sec==n) {ans = max(ans,num);return;}\n  for (int v : adj[fir]){\n    if (mp[sec][v]) dfs(v,v,num+pos[v]);//\u5982\u679c\u4ed6\u4fe9\u540c\u65f6\u80fd\u53bb\u67d0\u4e2a\u70b9\n    if (abs(v-sec)>l) continue;//\u5982\u679c\u53bb\u7684\u70b9\u8ddfsec\u5dee\u592a\u8fdc\u4e86\n    if (!vis[v]){\n      vis[v] = true;\n      dfs(v,sec,num+pos[v]);//\u5982\u679c\u8fd9\u4e2a\u70b9\u6ca1\u53bb\u8fc7,\u5c31\u52a0\u4e0a\u70b9\u6743\u53bb\u4e00\u6b21\n      vis[v] = false;\n    }else{\n      dfs(v,sec,num);//\u5982\u679c\u53bb\u8fc7,\u53ef\u4ee5\u4e0d\u52a0\u70b9\u6743\u53bb\u4e00\u6b21\n    }\n  }\n  for (int v : adj[sec]){\n    if (abs(v-fir)>l) continue;\n    if (!vis[v]){\n      vis[v] = true;\n      dfs(fir,v,num+pos[v]);\n      vis[v] = false;\n    }else{\n      dfs(fir,v,num);\n    }//\u540c\u4e0a\n  }\n}\n```\n\n------------\n\u5bf9\u4e8e $ n <= 16$ \u7684\u70b9\uff0c\u8003\u8651\u5168\u5c40\u72b6\u538b\u3002\u7528 $dp[i][j][k]$ \u6765\u8bb0\u5f55\u5728\u53d6\u70b9\u72b6\u6001\u4e3a $i$\uff0c\u4e14\u4e24\u4e2a\u70b9\u5206\u522b\u5728 $j$ \u548c $k$ \u65f6\u80fd\u5f97\u5230\u7684\u6700\u5927\u5feb\u4e50\u503c\u3002\u8f6c\u79fb\u4e3a:\n\n$$ dp[i][j][k] = \\left\\{\n\\begin{aligned}\n&dp[i+(1<<v_{j})][v_{j}][k]& \\\\\n&dp[i+(1<<v_{k})][j][v_{k}]& \\\\\n&dp[i+(1<<v_{j,k})][v_{j,k}][v_{j,k}]&\n\\end{aligned}\n\\right.\n$$\n\n\n\u590d\u6742\u5ea6 $O(2^n*n^2)$\u3002\n\n------------\n\u5bf9\u4e8e $ n <= 100$ \u7684\u70b9\uff0c$dp$ \u8bb0\u5f55\u5168\u5c40\u72b6\u6001\u663e\u7136\u4e0d\u53ef\u53d6\u3002\n\n\u56e0\u4e3a PF \u4e0d\u4f1a\u8d70\u56de\u5934\u8def\uff0c\u6240\u4ee5\u5f53\u4e24\u4e2a\u70b9\u7684\u7f16\u53f7\u5747\u5927\u4e8e\u4e00\u4e2a\u6570 $K$\uff0c\u90a3\u4e48\u72b6\u6001\u5185\u6240\u6709\u6bd4 $K$ \u5c0f\u70b9\u90fd\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u53ea\u8bb0\u5f55\u4e24\u4e2a\u8282\u70b9\u4e4b\u95f4\u7684\u72b6\u6001\u3002\u800c\u8fd9\u4e2a\u72b6\u6001\u7684\u6570\u91cf\u4e3a $2^l$\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u7684 $dp$ \u53d8\u4e3a\u56db\u7ef4\uff1a$dp[i][j][k][l]$\uff0c\u5176\u4e2d $i$ \u8868\u793a\u5df2\u7ecf\u6ca1\u7528\u7684\u70b9\u6570\uff0c$j$ \u8868\u793a\u8fd9\u5341\u4e2a\u70b9\u7684\u72b6\u6001\uff0c$k,l$ \u5206\u522b\u8868\u793a\u5de6\u53f3\u4e24\u4e2a\u68a6\u5883\u5728\u8fd9\u5341\u4e2a\u70b9\u7684\u4f4d\u7f6e\u3002\n\n\u72b6\u6001\u8981\u8003\u8651\u4e00\u4e0b\u600e\u4e48\u79fb\u52a8\uff0c\u6bd4\u5982\u5728\u8fd9\u9898\u4e2d $0100010$ \u53ef\u4ee5\u7b80\u5316\u4e3a $0010001$\u3002\n\n\u8f6c\u79fb\u65b9\u6cd5\u6ca1\u6709\u53d8\u5316\uff0c\u590d\u6742\u5ea6\u4e3a $O(n\\times2^l \\times l^2)$\n\n\u53e6\u4e00\u79cd\u53ef\u884c\u65b9\u6cd5\u4e3a $dp[i][j][k]$\uff0c$i$ \u8868\u793a\u5341\u4e2a\u70b9\u4e4b\u95f4\u7684\u72b6\u6001\uff0c$j,k$ \u66b4\u529b\u8bb0\u5f55\u5de6\u53f3\u4e24\u70b9\u7684\u4f4d\u7f6e\u8fdb\u884c\u8f6c\u79fb\uff0c\u590d\u6742\u5ea6 $O(2^l \\times n^2)$\uff0c\u90fd\u80fd\u901a\u8fc7\u8fd9\u7ec4\u6570\u636e\u3002\n\n------------\n\u5bf9\u4e8e $ n <= 10^3$ \u7684\u70b9\uff0c\u8003\u8651\u964d\u7ef4\u3002\n\n~~\u901a\u8fc7\u89c2\u5bdf~~\uff0c\u53ef\u4ee5\u53d1\u73b0\u8f6c\u79fb\u7684\u65f6\u5019\u5982\u679c\u5b58\u7684\u7f16\u53f7\u8f83\u5c0f\u7684\u70b9\u4e0d\u662f $l$ \u4e2a\u72b6\u6001\u7684\u7b2c\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u524d\u9762\u7684\u70b9\u4ecd\u7136\u6ca1\u6709\u610f\u4e49\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u8f83\u5c0f\u7684\u70b9\u4e25\u683c\u4e3a\u72b6\u6001\u7684\u7b2c\u4e00\u70b9\uff0c\u5b58\u50a8 $dp[i][j][k]$\uff0c\u5176\u4e2d $i$ \u8868\u793a\u8f83\u5c0f\u70b9\u7684\u7f16\u53f7\uff0c$j$ \u8868\u793a\u76ee\u524d\u7684\u72b6\u6001\uff0c$k$ \u8868\u793a\u8f83\u5927\u7684\u70b9\uff0c\u800c\u8f83\u5927\u70b9\u7684\u7f16\u53f7\u4e3a $i+k$\uff0c\u53ef\u8bc1 $k$ \u7684\u6700\u5927\u503c\u4e0d\u4f1a\u8d85\u8fc7 $l$\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u7684\u65f6\u95f4\u5c31\u51cf\u5c11\u5230\u4e86 $O(n \\times 2^l \\times l)$\uff0c\u80fd\u591f\u901a\u8fc7\u8fd9\u7ec4\u6570\u636e\u3002\n\n------------\n\u5bf9\u4e8e $ n <= 5 \\times 10^3,l\\le 11$ \u7684\u70b9\uff0c\u8003\u8651\u53ea\u8bb0\u5f55\u4e00\u4e2a\u70b9\u3002\n\n\u6211\u4eec\u80fd\u591f\u53d1\u73b0\uff0c\u5f53\u8f83\u5c0f\u70b9\u4e3a\u72b6\u6001\u4e2d\u7684\u7b2c\u4e00\u4e2a\u65f6\uff0c\u8f83\u5927\u70b9\u4e00\u5b9a\u4f1a\u662f\u72b6\u6001\u4e2d\u7f16\u53f7\u7684\u6700\u5927\u7684\u90a3\u4e2a\u70b9\uff08\u56e0\u4e3a\u6ca1\u6cd5\u8d70\u56de\u5934\u8def\uff0c\u800c\u8f83\u5c0f\u7684\u70b9\u56fa\u5b9a\u5728\u7b2c\u4e00\u4e2a\uff0c\u5982\u679c\u76ee\u524d\u70b9\u7f16\u53f7\u4e0d\u591f\u72b6\u6001\u4e2d\u6700\u5927\u70b9\u7684\u7f16\u53f7\u5927\uff0c\u90a3\u4e48\u90a3\u4e2a\u6700\u5927\u70b9\u4e0d\u53ef\u80fd\u88ab\u5230\u8fbe\u8fc7\uff09\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u5b58\u50a8 $dp[i][j]$\uff0c\u5206\u522b\u8868\u793a\u8f83\u5c0f\u70b9\u7684\u7684\u7f16\u53f7\u4ee5\u53ca\u73b0\u5728\u7684\u72b6\u6001\u3002\n\n\u6c42\u67d0\u4e2a\u72b6\u6001\u4e0b\u7684\u6700\u5927\u70b9\u53ef\u4ee5\u7528\u6570\u7ec4\u9884\u5904\u7406\u8bb0\u5f55\uff1a\u628a\u6bcf\u79cd $l$ \u7684\u6700\u5927\u70b9\u5217\u4e3e\u4e00\u904d\uff0c\u5f00\u4e00\u4e2a\u6570\u7ec4\u8bb0\u5f55\u5c31\u80fd\u505a\u5230 $O(2^l)$ \u7684\u9884\u5904\u7406\u4e4b\u540e $O(1)$ \u6c42\u51fa\u67d0\u72b6\u6001\u4e0b\u7684\u6700\u5927\u70b9\u3002\n\n\u8f6c\u79fb\u65b9\u6cd5: (\u4e0b\u9762\u7528 $curr$ \u8868\u793a\u8f83\u5927\u70b9)\n\n$$ dp[i][j] = \\left\\{\n\\begin{aligned}\n&dp[i][j+(1<<v)] \\space\\{v-i \\le l\\}&\\\\\n&dp[v][(j>>(i-v))|1] \\space \\{v<curr\\} &\\\\\n&dp[curr][(j>>(curr-i)) + (1<<(v-curr))] \\space \\{ 0\\le v-curr \\le l\\}&\\\\\n&dp[v][1] \\{i \\to v\\space \\&\\&\\space curr \\to v\\}&\n\n\\end{aligned}\n\\right.\n$$\n\n\u6838\u5fc3\u9884\u5904\u7406\u548c\u8f6c\u79fb\u4ee3\u7801\uff1a\n```cpp\n  for (int i=1;i<(1<<(l+1));i++){\n    for (int k=l+1;k>=0;k--){\n      if ((i>>k) & 1) {top[i] = k; break;}\n    }\n  }//\u9884\u5904\u7406\n  memset (dp,0xff,sizeof(dp)); dp[1][1] = 0;\n  for (int i=1;i<=n;i++){\n    for (int j=1;j<(1<<(l+2));j++){\n      int curr = i+top[j];//\u8f83\u5927\u70b9\u7684\u7f16\u53f7\n      if (dp[i][j]==-1 || ((j|1)!=j)) continue;//\u5982\u679c\u8fd9\u4e2a\u72b6\u6001\u4e0d\u53ef\u5230\u8fbe\u6216\u8005\u8f83\u5c0f\u70b9\u4e0d\u57282^0\u90a3\u91cc.\n      for (int v : adj[curr]){//\u8f83\u5927\u70b9\u7684\u8f6c\u79fb\n        if (mp[i][v]) dp[v][1] = max(dp[v][1],dp[i][j]+pos[v]);\n        if (v-i>l) continue;//\u4e0d\u80fd\u8ddf\u8f83\u5c0f\u7684\u5dee\u8ddd\u592a\u5927\n        int nxt = j+(1<<(v-i));//\u8f6c\u79fb\u540e\u7684\u72b6\u6001\n        dp[i][nxt] = max(dp[i][nxt],dp[i][j]+pos[v]);\n      }\n      for (int v : adj[i]){\n        if (v-curr>l) continue;//\u5982\u679c\u8f6c\u79fb\u540e\u6bd4\u8f83\u5927\u70b9\u5927\u592a\u591a\n        if (v>curr){//\u6ce8\u610f:\u5982\u679c\u8f6c\u79fb\u7684\u70b9\u6bd4\u8f83\u5927\u70b9\u5927,\u90a3\u4e48\u8f83\u5927\u70b9\u73b0\u5728\u53d8\u6210\u8f83\u5c0f\u70b9,\u9700\u8981\u76f4\u63a5\u66ff\u6362i\u5e76\u8fdb\u884c\u79fb\u4f4d\u64cd\u4f5c\n          int nxt = (j>>(curr-i)) + (1<<(v-curr));\n          dp[curr][nxt] = max(dp[curr][nxt],dp[i][j]+(((j>>(v-i))&1) ? 0 : pos[v]));\n        }else{//\u5426\u5219\u7528v\u4ee3\u66ff\u548c\u79fb\u4f4d\n          int nxt = (j>>(v-i))|1;\n          dp[v][nxt] = max(dp[v][nxt],dp[i][j]+(((j>>(v-i))&1) ? 0 : pos[v]));\n        }\n      }\n    }\n  }\n  cout << dp[n][1] << endl;\n}\n```\n\n\u590d\u6742\u5ea6 $O(2^l + n\\times2^l)$\u3002\n\n\u8fd9\u6863\u90e8\u5206\u5206\u597d\u50cf\u4e5f\u53ef\u4ee5\u7528 $bfs$ \u72b6\u538b\u6216 $dfs$ \u72b6\u538b\u5b9e\u73b0\uff1f\u4e0d\u8fc7\u51fa\u9898\u4eba\u592a\u61d2\u4e86\u5c31\u6ca1\u5199\u3002\n\n------------\n\u5bf9\u4e8e $ n <= 5 \\times 10^3,l\\le 12$ \u7684\u70b9\uff0c\u4e0a\u9762\u7684\u65b9\u6cd5\u867d\u7136\u65f6\u95f4\u590d\u6742\u5ea6\u6b63\u786e\uff0c\u4f46\u7a7a\u95f4\u4f1a\u7206\u70b8\u3002\n\n\u601d\u8003\u4e00\u4e0b\uff0c\u5f53\u6211\u4eec\u5b58\u4efb\u610f\u4e00\u4e2a\u70b9\u65f6\uff0c\u7531\u4e8e\u72b6\u6001\u4e0d\u53ef\u80fd\u4e0d\u5b58\u3002\u7a7a\u95f4\u590d\u6742\u5ea6\u4e00\u5b9a\u4e3a $n*2^l$\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u53ea\u80fd\u60f3\u60f3\u600e\u4e48\u4e00\u4e2a\u70b9\u90fd\u4e0d\u5b58\u3002\n\n\u4e3a\u4e86\u4e0d\u523b\u610f\u5361\u7a7a\u95f4\u5e38\u6570\uff0c\u6211\u7ed9\u4e86 $128MB$\u3002\u8fd9\u610f\u5473\u7740\u521a\u624d\u7684\u89e3\u6cd5\u53ea\u4f1a\u7206\u4e24\u500d\u7a7a\u95f4\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5~~\u4e71\u641e\u4e00\u6ce2~~\u3002\n\n\u505a\u6cd5\u4e00(\u79bb\u6563\u5316)\uff1a\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u4fdd\u8bc1 $dp$ \u7b2c\u4e00\u7ef4\u662f\u6700\u5c0f\u70b9\u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u7ef4\u7684\u72b6\u6001\u5982\u679c\u4e0d\u542b\u6709$1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u72b6\u6001\u65e0\u610f\u4e49\u3002\n\n\u77e5\u8bc6\u70b9\u4e00\uff1a\u6211\u4eec\u53ef\u4ee5\u5bf9\u72b6\u6001\u8fdb\u884c\u7b5b\u9009\uff0c\u5e76\u79bb\u6563\u5316\u72b6\u6001\u3002\u6b64\u505a\u6cd5\u80fd\u591f\u8282\u7701 $2$ \u500d\u7a7a\u95f4\u4e0e\u65f6\u95f4\uff0c\u521a\u597d\u80fd\u591f\u901a\u8fc7\u8fd9\u4e2a\u6570\u636e\u3002\n\n\u90e8\u5206\u79bb\u6563\u4ee3\u7801\uff1a\n\n```cpp\nfor (int i=1;i<(1<<(l+1));i++){\n    if ((i|1)==i) num.push_back(i),head[i] = num.size()-1;\n}\n\n...\n\nfor (int i=1;i<=n;i++){\n    for (int z=0;z<num.size();z++){\n      int j = num[z];\n      int curr = i+top[j];\n\n...\n\n\tfor (int v : adj[curr]){//\u8f83\u5927\u70b9\u8f6c\u79fb\uff0c\u539f\u7406\u4e0e\u6700\u5c0f\u70b9\u4e00\u6837\uff0c\u56e0\u6b64\u53ea\u653e\u4e00\u4e2a\u3002\n          if (mp[i][v]) dp[v][0] = max(dp[v][0],dp[i][z]+pos[v]);\n          if (v-i>l) continue;\n          int nxt = head[j+(1<<(v-i))];\n          dp[i][nxt] = max(dp[i][nxt],dp[i][z]+pos[v]);\n     \t}\n```\n\n\u505a\u6cd5\u4e8c (map)\uff1a\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5f53\u67d0\u4e2a\u70b9\u7684\u8f6c\u79fb\u5168\u90e8\u5b8c\u6210\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u7684\u6240\u6709\u6570\u636e\u90fd\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u4e86\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 unordered_map \u6765\u8bb0\u5f55\u3002\u800c $umap$ \u7684\u67e5\u8be2\u4e3a\u5927\u5e38\u6570\u7684 $O(1)$ \uff0c\u6211\u5728\u8fd9\u91cc\u6682\u4e14\u5f53\u4ed6\u4e3a $O(1)$\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u7684\u505a\u6cd5\u53d8\u4e3a\uff1a\u5f53\u4e00\u4e2a\u70b9\u7684\u8f6c\u79fb\u5168\u90e8\u7ed3\u675f\uff0c\u6211\u4eec\u5c31\u5c06\u5b83\u7684\u6240\u6709\u72b6\u6001\u5220\u9664\u3002\n\n\u77e5\u8bc6\u70b9\u4e8c\uff1a\u6211\u4eec\u53ef\u4ee5\u5efa\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\uff0c\u7136\u540e\u5c06\u5b83\u8ddf $map$ \u7684\u67d0\u7ef4\u8fdb\u884c\u7f6e\u6362\uff0c\u65f6\u95f4\u5220\u9664\u7531 $O(n)$ \u7684 $map.clear()$ \u53d8\u4e3a $O(1)$\u3002\n\n```cpp\nunordered_map<int,int> tmp;\nif (i!=n)swap(tmp,dp[i]);\n ```\n \n\u8fd9\u4e2a\u5e38\u6570\u4f1a\u8ba9\u8fd9\u79cd\u505a\u6cd5\u8dd1\u4e0d\u8fdb\u4e00\u79d2\uff0c\u6240\u4ee5\u65f6\u9650\u6211\u5f00\u5927\u4e86\u3002\n\n\u6b64\u505a\u6cd5\u80fd\u591f\u8ddf\u505a\u6cd5\u4e00\u7ed3\u5408\uff0c\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u5feb\u4e24\u500d\uff0c\u5bf9\u5361\u5e38\u7684\u73a9\u5bb6\u66f4\u52a0\u53cb\u597d\u3002\n\n\u3010\u6b63\u89e3\u3011\u505a\u6cd5\u4e09(\u6eda\u52a8\u6570\u7ec4)\uff1a\n\n~~\u663e\u7136~~\u8fd9\u9898\u7684\u6eda\u52a8\u6570\u7ec4\u5e76\u4e0d\u80fd\u7528 $dp[2][1<<l]$ \u6c42\u3002\u539f\u56e0\u662f\u6bcf\u4e2a\u7f16\u53f7\u4e0d\u6b62\u4f1a\u5173\u8054\u5230\u4ed6\u540e\u9762\u90a3\u4e00\u4e2a\u3002\n\n\u4f46\u662f\uff0c\u6839\u636e\u9898\u76ee\u53d1\u73b0\uff0c\u6bcf\u4e2a\u7f16\u53f7\u6700\u591a\u53ea\u4f1a\u5173\u8054\u5230\u540e\u9762 $l$ \u4e2a\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 $dp[l+1][1<<l]$ \u6765\u5b58\u3002\u8fd9\u6837\u80fd\u591f\u4fdd\u8bc1\u5728\u6eda\u52a8\u7684\u540c\u65f6\u4e0d\u9057\u6f0f\u3002\n\n\u5bf9\u4e8e\u540c\u65f6\u79fb\u52a8\u7684\u64cd\u4f5c\uff0c\u7531\u4e8e\u6eda\u52a8\u6570\u7ec4\u7684\u539f\u56e0\uff0c\u6211\u4eec\u65e0\u6cd5\u5728 $dp$ \u5185\u8bb0\u5f55\u3002\u7136\u800c\uff0c\u6211\u4eec\u53ef\u4ee5\u53e6\u5f00\u4e00\u4e2a\u6570\u7ec4\uff0c\u8bb0\u5f55\u5f53\u4e24\u70b9\u540c\u65f6\u5230\u8fbe\u67d0\u4e2a\u70b9\u65f6\u7684\u6700\u5927\u503c\uff0c\u7136\u540e\u5f53\u4f7f\u7528\u7684\u65f6\u5019\u5148\u53d6\u4e86\u6700\u5927\u503c\u518d\u5f00\u59cb\u8f6c\u79fb\u3002\n\n```cpp\n#include <iostream>\n#include <unordered_map>\n#include <algorithm>\n#include <vector>\n#include <fstream>\n#include <cstring>\n#include <vector>\nusing namespace std;\nconst int MAXN = 5e3+5;\nconst int MAXL = 13;\nunordered_map<int,unordered_map<int,bool> > mp;\nint n,m,l,pos[MAXN],dp[MAXL][(1<<MAXL)+5],top[(1<<MAXL)+5],big[MAXN],ans,now;\nvector<int> adj[MAXN],num;\ninline int max(int a, int b) {return a>b?a:b;}\nint main(){\n  cin >> n >> m >> l;\n  for (int i=1;i<=n;i++) cin >> pos[i];\n  for (int i=1;i<=m;i++){\n    int a,b; cin >> a >> b; if (!mp[a][b]) mp[a][b] = true,adj[a].push_back(b);\n  }\n  memset(top,0xff,sizeof(top));\n  for (int i=1;i<(1<<(l+1));i++){\n    for (int k=l+1;k>=0;k--){\n      if ((i>>k) & 1) {top[i] = k; break;}\n    }\n  }//\u9884\u5904\u7406\n  memset (dp,0xff,sizeof(dp));\n  for (int i=1;i<=n;i++){\n    now = (i-1)%MAXL;//\u73b0\u5728\u7f16\u53f7\u5728\u6eda\u52a8\u6570\u7ec4\u7684\u4f4d\u7f6e\n    dp[now][1] = max(dp[now][1],big[i]);//\u5148\u4fdd\u8bc1\u8fd9\u4e1c\u897f\u6700\u5927\n    for (int j=1;j<(1<<(l+1));j++){\n      int pos1 = i;\n      int pos2 = i+top[j];\n      if (dp[now][j]==-1) continue;\n      for (int v : adj[pos2]){\n        if (mp[pos1][v]) big[v] = max(big[v],dp[now][j]+pos[v]);//\u989d\u5916\u7684\u6570\u7ec4\n        if (v-i>l)continue;\n        int nxt = j+(1<<(v-pos1));\n        dp[now][nxt] = max(dp[now][nxt],dp[now][j]+pos[v]);\n      }\n      for (int v : adj[pos1]){\n        if (v-pos2>l) continue;\n        if (v>pos2){\n          int nxt = (j>>(pos2-pos1)) + (1<<(v-pos2));\n          int to = (pos2-1)%MAXL;\n          dp[to][nxt] = max(dp[to][nxt],dp[now][j]+(((j>>(v-pos1)) & 1) ? 0 : pos[v]));\n        }else{\n          int nxt = (j>>(v-pos1))|1;\n          int to = (v-1)%MAXL;\n          dp[to][nxt] = max(dp[to][nxt],dp[now][j]+(((j>>(v-pos1)) & 1) ? 0 : pos[v]));\n        }\n      }\n      if (i!=n)dp[now][j] = -1;//\u64cd\u4f5c\u5b8c\u5c31\u5c06\u5b83\u8bbe\u4e3a-1,\u6ce8\u610f\u522b\u628a\u7ec8\u70b9\u7ed9\u66f4\u4e86\u3002\u3002\u3002\n    }\n  }\n  cout << dp[(n-1)%MAXL][1] << endl;\n}\n```\n\n\u8fd9\u91cc\u5bf9\u8f6c\u79fb\u70b9\u7528\u4e86 $map$\uff0c\u5982\u679c\u6539\u7528\u6570\u7ec4\u5b58\uff0c\u65f6\u95f4\u4f1a\u5feb\u4e00\u500d\uff0c\u7a7a\u95f4\u5927\u4e24\u500d(\u53cd\u6b63\u90fd\u662f20M\u4ee5\u4e0b)\u3002\n\n\u8d5b\u65f6\u67d0\u4f4d\u795e\u4ed9\u7528\u4ed6\u81ea\u5df1\u7684\u505a\u6cd5\u5199\u8fc7\u53bb\u4e86\uff0c\u8fd9\u91cc\u4e0d\u8bb2\uff0c\u5982\u679c\u4ed6\u613f\u610f\u53ef\u4ee5\u53d1\u9898\u89e3\u641e\u8d21\u732e\u5206\u3002\n\n------------\n\n\n**P3:\u9a97\u5206\u505a\u6cd5**\n\n1.\u826f\u5fc3\u9a97\u5206 $5$ \u5206\u53bb\u54ea\u4e86\uff1f\u5176\u5b9e\u5728\u7b2c $11$ \u4e2a\u6d4b\u8bd5\u70b9\u90a3\n\n\u89c2\u5bdf\u9898\u610f\u53d1\u73b0\uff0c\u6bcf\u4e2a\u70b9\u90fd\u80fd\u4ece\u8d77\u70b9\u5230\u8fbe\uff0c\u5e76\u4e14\u90fd\u80fd\u8fde\u5230\u7ec8\u70b9\u3002\u7531\u4e8e\u68a6\u5883\u662f\u4e00\u68f5\u6811\uff0c\u6545\u8981\u5c06\u6240\u6709\u5355\u5411\u8fb9\u8fde\u8d77\u6765\u5e76\u8fde\u5230\u7ec8\u70b9\u7684\u65b9\u6cd5\u4e00\u5b9a\u552f\u4e00\uff1a$1 \\to 2 \\space  $ $&&$ $ \\space 2\\to 3 ...$\u3002\u6240\u4ee5\u4e0d\u7ba1\u68a6\u5883\u9009\u62e9\u518d\u600e\u4e48\u82b1\u91cc\u80e1\u54e8\uff0c\u4e24\u4e2a\u70b9\u540c\u65f6\u5f80\u540e\u4e00\u683c\u4e00\u683c\u8d70\u5c31\u80fd\u4fdd\u8bc1\u62ff\u6ee1\uff0c\u800c\u7b54\u6848\u5c31\u662f\u6240\u6709\u5feb\u4e50\u503c\u52a0\u8d77\u6765\u3002\n\n2.\u67d0\u4e9b\u8d2a\u5fc3\u505a\u6cd5\n\n\u5728 $dfs$ \u7684\u65f6\u5019\u53ea\u8bb0\u5f55\u4e24\u4e2a\u70b9\u8fdb\u884c\u8f6c\u79fb\uff0c\u8bb0\u5f55 $dp[i][j]$\uff0c \u5982\u679c\u7ecf\u8fc7\u8fd9\u4e2a\u70b9\u7684\u65f6\u5019 $dp[i][j]$ \u592a\u5c0f\u4e86\uff0c\u90a3\u4e48\u76f4\u63a5\u8df3\u8fc7\u3002\n\n\u8fd9\u4e2a\u505a\u6cd5\u5c31\u662f\u6570\u636e\u5783\u573e\u65f6 $95$ \u7684\u505a\u6cd5\u3002\u7136\u800c\uff0c\u6211\u4eec\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u54ea\u6015\u4f60\u8bb0\u5f55\u4e86 $dp[i][j]$\uff0c\u4e0a\u6b21\u7ecf\u8fc7\u548c\u8fd9\u6b21\u7ecf\u8fc7\u65f6\u4e2d\u95f4\u70b9\u7684\u53d6\u820d\u53ef\u80fd\u4e0d\u4e00\u6837\uff0c\u6545\u8fd9\u4e2a\u8d2a\u5fc3\u4e0d\u6210\u7acb(\u4f46\u662f\u641e\u7b11\u7684\u662f\uff0c\u6709 $80\\%$ \u4ee5\u4e0a\u7684\u6570\u636e\u7528\u8bcd\u89e3\u6cd5\u8ddf\u6b63\u89e3\u7b54\u6848\u76f8\u540c\uff0c\u6240\u4ee5\u6570\u636e\u9020\u5f97\u6211\u6000\u7591\u4eba\u751f)\u3002\n\n\u4e0d\u4ec5\u5982\u6b64\uff0c\u8fd9\u4e2a\u8d2a\u5fc3\u7684\u590d\u6742\u5ea6\u4ecd\u7136\u662f $O(n!)$\uff0c\u80fd\u8fc7 $100$ \u90fd\u5f88\u5e78\u8fd0\u4e86\u3002\n\n\u4e3a\u4e86\u7ed9\u9a97\u5206\u7684\u673a\u4f1a\uff0c\u6211\u7ed9\u4e86\u8fd9\u79cd\u89e3\u6cd5\u989d\u5916\u7684 $10$ \u5206\uff0c\u5176\u4ed6\u4f1a$WA+TLE$\u3002\n\n\u5bf9\u8d2a\u5fc3\u8fdb\u884c\u5206\u522b\u5224\u65ad\uff0c\u5728 $n\\le16$ \u65f6\u4e0d\u8fdb\u884c\u8d2a\u5fc3\uff0c\u5e76\u8fdb\u884c\u5404\u79cd\u7384\u5b66\u5e38\u6570\u4f18\u5316\uff0c\u80fd\u591f\u518d\u62ff\u5341\u5206\u3002\n\n\u56e0\u6b64\uff0c\u65e0\u4efb\u4f55\u72b6\u538b\u80fd\u62ff\u5230\u7684\u5206\u6570\u662f $20(\u57fa\u7840)+10(\u649e\u6b63\u89e3)+5(\u6811\u94fe\u5b50)+10(\u5e38\u6570\u4f18\u5316) = 45$ \uff0c\u5e94\u8be5\u5728\u4e0d\u5199\u6b63\u89e3\u7684\u60c5\u51b5\u4e0b\u7b97\u826f\u5fc3\u7684\u4e86\u3002\n\n",
        "postTime": 1587793691,
        "uid": 219099,
        "name": "pocafup",
        "ccfLevel": 0,
        "title": "[Round2 \u516d\u516d\u5feb\u4e50\u8d5b] \u751c\u68a6"
    },
    {
        "content": "\u4e0d\u5361\u7a7a\u95f4\u4e86\uff0c\u597d\u8bc4\uff0c\u53ef\u4ee5\u53bb\u6389\u6eda\u52a8\u6570\u7ec4\u4e86\uff08\u96fe\n\n\u9996\u5148\u53d1\u73b0 $l$ \u76f8\u5f53\u5c0f\uff0c\u53e6\u5916\u56fe\u662f\u4e00\u4e2a DAG\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u72b6\u538b dp\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u7528 $f_{u, S}$\uff08$S$ \u662f\u4e00\u4e2a\u538b\u4f4d\u7684\u4e8c\u8fdb\u5236\u6570\uff09\u6765\u8868\u793a\u5176\u4e2d\u8f83\u5c0f\u70b9\u5728 $u$ \u65f6\u7684\u6700\u5927\u5feb\u4e50\u503c\u3002$S$ \u4ee3\u8868\u7684\u662f\u7f16\u53f7\u4e3a $[u, u+l]$ \u7684\u7ed3\u70b9\u7684\u8bbf\u95ee\u72b6\u6001\uff08$1$ \u8868\u793a\u8bbf\u95ee\u8fc7\u4e86\uff0c$0$ \u8868\u793a\u6ca1\u8bbf\u95ee\u8fc7\uff09\u3002\u8fd9\u610f\u5473\u7740\uff0c$S$ \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u957f\u5ea6\u4e3a $l+1$ \u7684 bitset\u3002\n\n\u4e0b\u9762\u7528 $S_i$ \u8868\u793a $S$ \u7684\u7b2c $i$ \u4f4d\u7684\u503c\uff08\u6700\u4f4e\u4f4d\u4e3a $0$\uff0c\u6700\u9ad8\u4f4d\u4e3a $l$\uff09\u3002\n\n\u663e\u7136\uff0c\u5982\u679c $S_0 = 0$ \u7684\u8bdd\u8fd9\u4e2a\u72b6\u6001\u53ef\u4ee5\u5e9f\u6389\u4e86\uff0c\u56e0\u4e3a $S_0$ \u4ee3\u8868\u7684\u662f $u$ \u8fd9\u4e2a\u70b9\uff0c\u65e2\u7136 $f_{u, S}$ \u8868\u793a\u8f83\u5c0f\u70b9\u5728 $u$\uff0c\u90a3 $u$ \u4e0d\u53ef\u80fd\u6ca1\u88ab\u8bbf\u95ee\u8fc7\u3002\n\n\u6211\u4eec\u53ea\u77e5\u9053\u4e86\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\uff0c\u80fd\u4e0d\u80fd\u77e5\u9053\u53e6\u4e00\u4e2a\u70b9 $v$ \u5728\u54ea\u91cc\u5462\uff1f\n\n\u5f88\u663e\u7136\uff0c\u56e0\u4e3a\u968f\u7740\u79fb\u52a8\uff0c$u$ \u548c $v$ \u53ea\u4f1a\u5355\u8c03\u4e0a\u5347\uff0c\u56e0\u6b64\uff0c$S$ \u7684\u6700\u9ad8\u4f4d\uff08\u6307\u7684\u662f\u4e3a $1$ \u7684\u6700\u9ad8\u4f4d\uff09\u6240\u4ee3\u8868\u7684\u503c\u5c31\u662f $v$ \u7684\u7f16\u53f7\u3002\u8fd9\u662f\u56e0\u4e3a\u5982\u679c $v$ \u4e0d\u662f\u6700\u9ad8\u4f4d\u7684\u8bdd\uff0c\u6bd4 $v$ \u5927\u7684\u4f4d\u7f6e\u662f\u4e0d\u53ef\u80fd\u8bbf\u95ee\u8fc7\u7684\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u9884\u5904\u7406\u4e2a $\\operatorname{highbit}(S)$ \u8868\u793a $S$ \u7684\u6700\u9ad8\u4f4d\u7684**\u7f16\u53f7**\uff08\u8fd4\u56de\u503c\u4e3a $[0, l]$\uff09\uff0c\u5219\u6709 $v = S + \\operatorname{highbit}(S)$\u3002\n\n\u4e0d\u59a8\u91c7\u7528\u300c\u53bb\u66f4\u65b0\u300d\u7684\u65b9\u5f0f\u8f6c\u79fb\uff0c\u5bf9\u4e8e\u4e00\u4e2a $f_{u, S}$\uff0c\u53ef\u4ee5\u7528\u6765\u8f6c\u79fb\u54ea\u4e9b\u72b6\u6001\u5462\uff1f\n\n*\u4e0b\u6587 $f_x + z\\to f_y$ \u53ef\u4ee5\u7406\u89e3\u4e3a $f_y = \\max\\{f_y, f_x + z\\}$\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u300c\u53bb\u66f4\u65b0\u300d\u7684\u610f\u601d\u3002\n\n\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b:\n\n1. \u540c\u65f6\u8dd1  \n\n   \u679a\u4e3e\u4e00\u4e2a $w$\uff0c$w$ \u663e\u7136\u53ef\u4ee5\u4e3a\u4efb\u4f55**\u540c\u65f6\u548c $u, v$ \u8fde\u901a\u7684\u6570**\uff0c\u90a3\u4e48\uff0c\u6700\u7ec8\u72b6\u6001\u5c31\u662f\u4e24\u4e2a\u70b9\u90fd\u5728 $w$\uff0c\u4e5f\u5c31\u662f $f_{w, 1}$\uff0c\u6240\u4ee5\u7528 $f_{u, S} + a_w \\to f_{w, 1}$\u3002\n\n   \u4ee3\u7801\u4e2d\u8fd9\u4e2a\u548c\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5199\u5728\u4e86\u4e00\u8d77\uff0c\u76ee\u7684\u662f\u65b9\u4fbf\uff08\n\n2. \u53ea\u8dd1\u5927\u7684\n\n   \u663e\u7136\uff0c\u5927\u7684\u8dd1\u5b8c\u540e\u8fd8\u8981\u4fdd\u8bc1 $w - u \\le l$\uff0c\u90a3\u4e48\u679a\u4e3e\u5b8c\u4e0e $v$ \u8fde\u901a\u7684 $w$ \u540e\uff0c\u53ef\u4ee5\u5148\u786e\u4fdd\u8fd9\u4e2a\u7ea6\u675f\u6210\u7acb\uff0c\u8bb0 $S'$ \u4e3a\u65b0\u7684\u72b6\u6001\uff0c\u5219\uff1a\n  \n   $$ S' = S \\cup (w -u) $$\n\n   \u4e5f\u5c31\u662f\u6807\u8bb0 $w$ \u8bbf\u95ee\u8fc7\u4e86\uff0c\u7136\u540e\uff0c\u7528 $f_{u, S} + a_w \\to f_{u, S'}$\u3002\n\n3. \u53ea\u8dd1\u5c0f\u7684\n\n   \u8fd9\u79cd\u5e94\u8be5\u662f\u6700\u9ebb\u70e6\u7684\u4e86\u3002\n  \n   \u540c\u6837\u679a\u4e3e\u4e00\u4e2a\u548c $u$ \u8fde\u901a\u7684 $w$\uff0c\u540c\u65f6\u8981\u786e\u4fdd $w - v \\le l$ \u6210\u7acb\uff08\u8fd9\u91cc\u4e0d\u9700\u8981\u53d6 $|w - v|$ \u7684\u7edd\u5bf9\u503c\uff0c\u60f3\u4e00\u60f3\uff0c\u4e3a\u4ec0\u4e48\uff1f\uff09\n  \n   \u518d\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n  \n   * \u7b2c\u4e00\u4e2a\u662f $w > v$\uff0c\u90a3\u4e48\u8fd9\u65f6\u8f83\u5c0f\u7684\u70b9\u53d8\u6210\u4e86 $v$\uff0c\u4e5f\u5c31\u662f\u539f\u6765\u7684 $S_0$ \u5bf9\u5e94\u7684\u662f $u$\uff0c\u73b0\u5728\u5219\u5bf9\u5e94 $v$\uff0c\u540e\u9762\u7684\u4e5f\u8981\u968f\u4e4b\u53d8\u5316\uff0c\u53ef\u4ee5\u7528 `S >> (v - u)` \u6765\u4f53\u73b0\uff0c\u540e\u9762\u4e3a\u4e86\u6570\u5b66\u516c\u5f0f\u89c4\u8303\u7528 $\\operatorname{up}_{u \\to v}(S)$ \u6765\u8868\u793a\u3002\n  \n     $$ S' = \\operatorname{up}_{u \\to v}(S) \\cup (w - v)$$\n  \n     \u5982\u679c $S_{w - u} = 1$ \u4e86\uff0c\u90a3\u4e48\u8bf4\u660e $w$ \u4e4b\u524d\u5df2\u7ecf\u8bbf\u95ee\u8fc7\uff0c\u4e0d\u518d\u7d2f\u52a0\u8d21\u732e\uff0c$f_{u, S} \\to f_{v, S'}$\uff0c\u5426\u5219 $f_{u, S} + a_w \\to f_{v, S'}$\u3002\n   \n   * \u7b2c\u4e8c\u4e2a\u662f $w < v$\uff0c\u540c\u7406\uff0c\u6709\uff1a\n   \n     $$ S' = \\operatorname{up}_{u \\to w}(S) \\cup (w - w) $$\n     \n     \u5982\u679c $S_{w - u} = 1$\uff0c\u5219 $f_{u, S} \\to f_{w, S'}$\uff0c\u5426\u5219\uff0c$f_{u, S} + a_w \\to f_{w, S'}$\u3002\n\n\u90a3\u4e48\uff0c\u6700\u7ec8\u7b54\u6848\u5c31\u662f $f_{n, 1}$\uff08\u4e24\u4e2a\u70b9\u90fd\u5728 $n$\uff09\u3002\n\n$-1$ \u5176\u5b9e\u4e0d\u7528\u5355\u72ec\u5224\u65ad\uff0c\u53ea\u8981\u5148\u5c06 $f$ \u7684\u521d\u59cb\u503c\u90fd\u8d4b\u503c\u4e3a $-1$\uff0c\u5982\u679c $f_{n, 1}$ \u6ca1\u6709\u5408\u6cd5\u6765\u6e90\u66f4\u65b0\u8fc7\uff0c\u81ea\u7136\u5c31\u662f $-1$ \u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n 2^l)$\u3002\n\n\u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define rg register\nusing namespace std;\ninline int read()\n{\n\tint v = 0; char c = getchar();\n\twhile(c < '0' || c > '9') c = getchar();\n\twhile(c >= '0' && c <= '9') v = (v << 3) + (v << 1) + (c ^ 48), c = getchar();\n\treturn v;\n}\nconst int N = 5e3 + 5, L = 13;\nint n, m, l, val[N], highbit[1 << L];\nint f[N][1 << L];\nvector<int> G[N];\nunordered_map<int, unordered_map<int, bool> > mp; \nint main()\n{\n\tn = read(); m = read(); l = read();\n\tfor(rg int i = 1; i <= n; i++) val[i] = read();\n\tfor(rg int i = 1; i <= m; i++)\n\t{\n\t\tint u = read(), v = read();\n\t\tif(!mp[u][v])\n\t\t{\n\t\t\tmp[u][v] = true;\n\t\t\tG[u].push_back(v);\n\t\t}\n\t}\n\tfor(rg int i = 1; i < (1 << l + 1); i++)\n\t{\n\t\tfor(rg int k = l + 1; ~k; k--)\n\t\t{\n\t\t\tif(i >> k & 1)\n\t\t\t{\n\t\t\t\thighbit[i] = k;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tmemset(f, -1, sizeof f);\n\tfor(rg int i = 1; i <= n; i++)\n\t{\n\t\tif(f[i][1] == -1) f[i][1] = 0; \n\t\tfor(rg int s = 1; s < (1 << l + 1); s++)\n\t\t{\n            if(s & 1 == 0) continue; // \u6700\u5c0f\u7684\u70b9\uff08\u81ea\u5df1\uff09\u6ca1\u5230\u8fbe\u8fc7\u7684\u72b6\u6001\u53ef\u4ee5\u6b47\u4e86 \n\t\t\tint u = i, v = i + highbit[s];\n\t\t\tif(f[u][s] == -1) continue;\n\t\t\tfor(int w : G[v])\n\t\t\t{\n\t\t\t\t// \u540c\u65f6\u8dd1 \n\t\t\t\tif(mp[u][w]) f[w][1] = max(f[w][1], f[u][s] + val[w]);\n\t\t\t\t\n\t\t\t\t// \u53ea\u8dd1\u5927\u7684 \n\t\t\t\tif(w - u > l) continue;\n\t\t\t\trg int nxt = s | (1 << w - u);\n\t\t\t\tf[u][nxt] = max(f[i][nxt], f[u][s] + val[w]);\n\t\t\t}\n\t\t\tfor(int w : G[u]) // \u8f6c\u79fb\u5c0f\u7684\u70b9\n\t\t\t{\n\t\t\t\tif(w - v > l) continue;\n\t\t\t\tif(w > v) // \u5c0f\u7684\u70b9\u53d8\u6210 v\n\t\t\t\t{\n\t\t\t\t\trg int nxt = (s >> v - u) | (1 << w - v);\n\t\t\t\t\tif(s >> w - u & 1) // \u539f\u672c\u8d70\u8fc7 w \u4e86 \n\t\t\t\t\t\tf[v][nxt] = max(f[v][nxt], f[u][s]);\n\t\t\t\t\telse f[v][nxt] = max(f[v][nxt], f[u][s] + val[w]);\n\t\t\t\t}\n\t\t\t\telse // \u5c0f\u7684\u70b9\u53d8\u6210 w \n\t\t\t\t{\n\t\t\t\t\trg int nxt = s >> w - u | 1;\n\t\t\t\t\tif(s >> w - u & 1) // \u539f\u672c\u8d70\u8fc7 w \u4e86 \n\t\t\t\t\t\tf[w][nxt] = max(f[w][nxt], f[u][s]);\n\t\t\t\t\telse f[w][nxt] = max(f[w][nxt], f[u][s] + val[w]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%d\\n\", f[n][1]);\n\treturn 0;\n}\n```",
        "postTime": 1591806669,
        "uid": 51971,
        "name": "syksykCCC",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6603 \u3010\u300cEZEC-2\u300d\u751c\u68a6\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9\uff0c$m$ \u6761\u8fb9\u7684\u56fe\u3002\n\n\u6709\u4e24\u4e2a\u4eba\uff0c\u521d\u59cb\u5728\u8282\u70b9 $1$\uff0c\u6bcf\u6b21\u4e24\u4e2a\u4eba\u53ef\u4ee5\u540c\u65f6\u79fb\u52a8\u5230\u4ed6\u4eec\u4fe9\u5f53\u524d\u540c\u65f6\u76f4\u63a5\u76f8\u8fde\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u6216\u8005\u5176\u4e2d\u4e00\u4e2a\u4eba\u5355\u72ec\u79fb\u52a8\u5230\u5176\u76f4\u63a5\u76f8\u8fde\u7684\u4e00\u4e2a\u8282\u70b9\u3002\n\n\u6bcf\u4e2a\u8282\u70b9\u6709\u70b9\u6743 $a_i$\uff0c\u7b2c\u4e00\u6b21\u7ecf\u8fc7\u65f6\u4f1a\u7d2f\u52a0\u70b9\u6743\u4f5c\u4e3a\u8d21\u732e\uff0c\u8981\u4fdd\u8bc1\u4e24\u4e2a\u4eba\u4efb\u610f\u65f6\u523b\u6240\u5728\u8282\u70b9\u5750\u6807\u5dee\u4e0d\u80fd\u8d85\u8fc7 $l$\uff0c\u6c42\u4e24\u4eba\u540c\u65f6\u5230\u8fbe\u8282\u70b9 $n$ \u65f6\u7684\u6700\u5927\u70b9\u6743\u548c\u3002\n\n$1\\leq n\\leq 5\\times 10^3,1\\leq m \\leq 3\\times 10^4,1\\leq a_i\\leq10^4,1\\leq l\\leq 12$\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u4e2a\u4eba\u611f\u89c9\u662f\u4e00\u9053\u5f88\u5999\u7684\u52a8\u6001\u89c4\u5212\uff0c\u6211\u4eec\u89c2\u5bdf\u6570\u636e\u8303\u56f4\uff0c\u53d1\u73b0 $1\\leq l\\leq 12$\uff0c\u90a3\u8fd9\u5c31\u8bf4\u660e\u4e86\u8fd9\u9053\u9898\u7684\u7a81\u7834\u53e3\u5728 $l$ \u4e0a\uff0c\u4ed4\u7ec6\u8bfb\u9898\uff0c\u53d1\u73b0\u4e0b\u6807\u5dee\u4e0d\u8d85\u8fc7 $l$\uff0c\u8bf4\u660e\u5f53 $u$ \u786e\u5b9a\u65f6\uff0c$v$ \u80fd\u5728\u7684\u8282\u70b9\u8303\u56f4\u5f88\u5c0f\uff0c\u6211\u4eec\u8003\u8651\u7528\u72b6\u538b\uff0c\u76f4\u63a5\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5047\u8bbe $u$ \u662f\u5f53\u524d\u4e0b\u6807\u8f83\u5c0f\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u7528 $dp_{u,st}$ \u8868\u793a\u5f53\u524d\u8f83\u5c0f\u7684\u8282\u70b9\u4e3a $u$ \u65f6\uff0c\u4e0b\u6807\u5728 $[u,u+l]$ \u7684\u4fe1\u606f\u4e3a $st$\u3002\n\n\u4f46\u662f\u8fd9\u65f6\u5019\u5c31\u6709\u4eba\u8981\u95ee\u4e86\uff0c\u5982\u679c\u6211\u53ea\u8bb0\u5f55\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5230\u65f6\u5019\u6211\u8d70\u56de\u5934\u8def\u65f6\u600e\u4e48\u5904\u7406\u5462\uff1f\n\n\u6211\u4eec\u8981\u4ed4\u7ec6\u89c2\u5bdf\u9898\u76ee\uff1a\n\n- \u8fb9\u6ee1\u8db3 $u<v$\u3002\n\n- \u8f93\u5165\u4fdd\u8bc1\u6bcf\u4e2a\u573a\u666f\u90fd\u80fd\u4ece\u8d77\u70b9\u5230\u8fbe\uff0c\u5e76\u4e14\u90fd\u80fd\u8fde\u5230\u7ec8\u70b9\u3002\n\n\u8fd9\u4fdd\u8bc1\u4e86\u4ec0\u4e48\uff1f~~\u4fdd\u8bc1\u6709\u89e3~~\u4fdd\u8bc1\u8fd9\u4e2a\u56fe\u662f\u4e00\u5f20 $DAG$\uff08\u6709\u5411\u65e0\u73af\u56fe\uff09\uff0c\u8fd9\u6709\u4ec0\u4e48\u4f18\u7f8e\u6027\u8d28\u5462\uff1f\u6211\u4eec\u4e0d\u4f1a\u8d70\u56de\u5934\u8def\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u90a3\u4e2a\u7591\u95ee\u5c31\u89e3\u51b3\u4e86\u3002\u540c\u65f6\u8fd8\u8868\u793a\uff0c\u5f53\u524d\u4e0b\u6807\u6700\u5927\u7684\u8282\u70b9\uff0c\u5fc5\u5b9a\u6709\u4e00\u4e2a\u4eba\u5728\uff0c\u56e0\u4e3a\u8d70\u4e0d\u4e86\u56de\u5934\u8def\u561b\uff0c\u8fd9\u6837\u4e5f\u987a\u624b\u89e3\u51b3\u4e86\u600e\u4e48\u8868\u793a\u5f53\u524d\u4eba\u6240\u5728\u8282\u70b9\u7684\u95ee\u9898\uff1a\n\n\u8bbe $hb_{st}$ \u8868\u793a $st$ \u6700\u9ad8\u4f4d\u7684 $1$ \u662f\u54ea\u4e00\u4f4d\uff0c\u90a3\u4e48\u72b6\u6001 $dp_{u,st}$ \u7684\u53e6\u4e00\u4e2a\u4eba\u6240\u5728\u7684\u8282\u70b9 $v$ \u7684\u4e0b\u6807\u5373\u4e3a $u+hb_{st}$\u3002\n\n## \u5177\u4f53\u505a\u6cd5\n\n\u611f\u89c9\u94fa\u57ab\u7684\u5dee\u4e0d\u591a\u4e86\uff0c\u6211\u4eec\u6bcf\u6b21\u8f6c\u79fb\u8003\u8651\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a\n\n- \u5982\u679c\u5f53\u524d\u4e24\u4e2a\u70b9\u90fd\u80fd\u5230\u8fbe\u70b9 $now$\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u8f6c\u79fb\u8fc7\u53bb\uff0c\u5426\u5219\u8003\u8651\u8f6c\u79fb\u5355\u70b9\n- \u8003\u8651\u8f6c\u79fb\u5355\u70b9\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8003\u8651\u54ea\u4e2a\u70b9\u8f6c\u79fb\uff0c\u5982\u679c\u8f6c\u79fb $v$\uff0c\u90a3\u4e48\u4e0d\u505a\u7279\u6b8a\u5904\u7406\uff0c\u82e5\u8f6c\u79fb $u$\uff0c\u5219\u9700\u8981\u5224\u65ad\u679a\u4e3e\u5230\u7684\u70b9 $now$ \u4e0e $v$ \u7684\u4e0b\u6807\u54ea\u4e2a\u66f4\u5927\uff0c\u5982\u679c $now>v$ \u8981\u6ce8\u610f\u66f4\u6539 $v$ \u4e3a\u5f53\u524d\u8f83\u5c0f\u7684\u503c\uff0c\u540c\u65f6\u8fd8\u8981\u8003\u8651\u5f53\u524d\u679a\u4e3e\u7684\u8282\u70b9 $now$ \u4e4b\u524d\u7684\u8d21\u732e\u662f\u5426\u52a0\u4e0a\u4e86\u3002\n\n\u5177\u4f53\u7684\u5199\u6cd5\u548c\u7ec6\u8282\u770b\u770b\u4ee3\u7801\u5e94\u8be5\u5c31\u597d\n\n\u6700\u540e\u7b54\u6848\u5c31\u662f $dp_{n,1}$ \u8868\u793a\u6700\u540e\u4e24\u4e2a\u4eba\u90fd\u5728 $n$ \u8282\u70b9\u3002\n\n## Code\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#include <queue>\n#include <cmath>\nusing namespace std;\nint read(){\n\tint x=0,f=1;char ch = getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-'){f=-1;}ch = getchar();}\n\twhile(ch>='0'&&ch<='9'){x = x*10+ch-'0';ch = getchar();}\n\treturn x*f;\n}\nconst int N = 5e3+5;\nconst int S = (1<<13)+5;\nbool e[N][N];\nint a[N];\nstruct aa{\n\tint nxt,to;\n}edge[N*6];\nint head[N],hb[S];\nint tot;\nvoid add(int u,int v){\n\tedge[++tot].nxt = head[u];edge[tot].to = v;head[u] = tot;\n}\nint dp[N][S];\nint main(){\n\tint n,m,l;\n\tn = read();m = read();l = read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i] = read();\n\t}\n\tint u,v;\n\twhile(m--){\n\t\tu = read();v = read();\n\t\tif(!e[u][v]){\n\t\t\te[u][v]=1;\n\t\t\tadd(u,v);\n\t\t}\n\t}\n\tint s = (1<<(l+1))-1;\n\tfor(int i=1;i<=s;i++){\n\t\tfor(int k=l+1;k>=0;k--){\n\t\t\tif((i>>k)&1){\n\t\t\t\thb[i] = k;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tmemset(dp,-1,sizeof(dp));\n\tdp[1][1] = 0;\n\tfor(int i=1;i<=n;i++){\n\t\tif(dp[i][1]==-1){\n\t\t\tdp[i][1] = 0;\n\t\t}\n\t\tfor(int st=1;st<=s;st+=2){//\u6709\u4e9b\u5c0f\u7ec6\u8282\u5c31\u5728\u4ee3\u7801\u5199\u4e86\n\t\t\t//\u6bd4\u5982\u8fd9\u91cc st+=2 \u662f\u4e3a\u4e86\u4fdd\u8bc1 st \u7b2c1\u4f4d\u662f 1\uff0c\u4ee5\u4fdd\u8bc1\u5f53\u524d\u72b6\u6001\u5185 u \u51fa\u73b0\u8fc7 \n\t\t\tint u = i,v = i+hb[st];\n\t\t\tif(dp[u][st]==-1){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor(int j=head[v];j;j=edge[j].nxt){\n\t\t\t\tint now = edge[j].to;\n\t\t\t\tif(e[u][now]){\n\t\t\t\t\tdp[now][1] = max(dp[now][1],dp[u][st]+a[now]);\n\t\t\t\t}\n\t\t\t\tif(abs(now-u)>l){//\u8fd9\u91cc\u548c\u4e0b\u9762\u5176\u5b9e\u4e0d\u7528\u52a0 abs \u6211\u4e00\u5f00\u59cb\u8bfb\u9898\u6ca1\u6ce8\u610f\u5230 u<v \u8fd9\u4e00\u9650\u5236 \n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tdp[u][st|(1<<(now-u))] = max(dp[u][st|(1<<(now-u))],dp[u][st]+a[now]);//\u6bd4v\u5927\u7684\u6570\u5f53\u524d\u8d21\u732e\u4e00\u5b9a\u6ca1\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u7528\u5206\u8ba8 \n\t\t\t}\n\t\t\tfor(int j=head[u];j;j=edge[j].nxt){\n\t\t\t\tint now = edge[j].to;\n\t\t\t\tif(abs(v-now)>l){\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(now>v){\n\t\t\t\t\tint res = (st>>(v-u))|(1<<(now-v));//\u8fd9\u91cc\u81ea\u5df1\u624b\u73a9\u4e00\u4e0b\u5c31\u77e5\u9053\u600e\u4e48\u7531 u-v \u53d8\u6210 v-now \u4e86 \n\t\t\t\t\tdp[v][res] = max(dp[v][res],dp[u][st]+a[now]);//\u8fd9\u91cc\u6ca1\u5fc5\u8981\u5206\u8ba8\uff0c\u8fd8\u662f\u56e0\u4e3a\u6bd4 v \u5927\u7684\u6570\u8d21\u732e\u4e00\u5b9a\u6ca1\u8bb0\u5f55 \n\t\t\t\t}else{\n\t\t\t\t\tint res = (st>>(now-u))|1;\n\t\t\t\t\tif((st>>(now-u))&1){//\u5206\u8ba8 \n\t\t\t\t\t\tdp[now][res] = max(dp[now][res],dp[u][st]);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tdp[now][res] = max(dp[now][res],dp[u][st]+a[now]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcout<<dp[n][1]<<\"\\n\";\n\treturn 0;\n}\n\n```\n\n\u6700\u540e\u5b8c\u7ed3\u6492\u82b1\u54af",
        "postTime": 1667449403,
        "uid": 369399,
        "name": "yizhiming",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010P6603 \u300cEZEC-2\u300d\u751c\u68a6\u3011"
    }
]