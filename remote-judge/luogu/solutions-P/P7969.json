[
    {
        "content": "\u96be\u5f97\u4e00\u89c1\u7684 CNOI \u98ce\u5de8\u5927\u5957\u8def\u9898\u3002\n\n\u8bbe $f_{i,j,0/1}$ \u4e3a\u586b\u4e86\u524d $i$ \u4e2a\u5b57\u7b26\uff0c\u6b64\u65f6\u5b57\u7b26\u4e32\u6743\u503c\u4e3a $j$\uff0c\u7b2c $i$ \u4e2a\u5b57\u7b26\u662f A/B \u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\u65f6\u679a\u4e3e\u4e0a\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u7ed3\u5c3e $k$ \u8fdb\u884c\u8f6c\u79fb\uff0c\u6211\u4eec\u4ee5\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e3a A \u7684\u60c5\u51b5\u4e3a\u4f8b\uff0c\u8bbe\u4e0a\u4e00\u4e2a B \u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $p_i$\uff0c\u4e0d\u96be\u53d1\u73b0\u5408\u6cd5\u7684 $k$ \u6ee1\u8db3 $k \\in [p_i,i-1]$\u3002\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n- \u5f53 $i - p_i < m$ \u65f6\uff0c\u65b0\u5212\u5206\u51fa\u7684\u8fd9\u4e00\u6bb5\u5bf9\u6743\u503c\u6ca1\u6709\u8d21\u732e\uff0c\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n$$f_{i,j,0}= \\sum_{k=p_i}^{i-1} f_{k,j,1}$$\n\n- \u5f53 $i - p_i \\geq m$ \u65f6\uff0c\u6211\u4eec\u5c06\u5bf9\u6743\u503c\u6709\u8d21\u732e\u7684\u90e8\u5206\u548c\u5bf9\u6743\u503c\u6ca1\u6709\u8d21\u732e\u7684\u90e8\u5206\u5206\u4e24\u6bb5\u8fdb\u884c\u8f6c\u79fb\u3002\u5bf9\u4e8e\u4e00\u4e2a\u957f\u4e3a $l(l \\geq m)$ \u7684\u8fde\u7eed\u6bb5\uff0c\u5176\u5bf9\u6743\u503c\u7684\u8d21\u732e\u4e3a $l-m+1$\u3002\u56e0\u6b64\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n$$f_{i,j,0} = \\sum_{k=i-m+1}^{i-1}f_{k,j,1}+\\sum_{k=p_i}^{i-m}f_{k,j-[(i-k)-m+1],1}$$\n\n\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e3a B \u7684\u60c5\u51b5\u540c\u7406\u3002\u8fb9\u754c $f_{0,0,0/1} =1$\u3002\u7136\u800c\u8fd9\u6837\u662f $O(n^3)$ \u7684\uff0c\u6211\u4eec\u8fd8\u5f97\u60f3\u529e\u6cd5\u4f18\u5316\u4e0a\u9762\u7684\u4e1c\u897f\u3002\n\n\u5bf9\u4e8e\u5bf9\u6743\u503c\u6ca1\u6709\u8d21\u732e\u7684\u90e8\u5206\u7528\u524d\u7f00\u548c\u4f18\u5316\u5373\u53ef\u3002\u6bd4\u8f83\u68d8\u624b\u7684\u662f\u5bf9\u6743\u503c\u6709\u8d21\u732e\u7684\u90e8\u5206\u3002\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u8f6c\u79fb\u65f6\u7528\u5230\u7684\u72b6\u6001\u7684\u4e24\u4e2a\u4e0b\u6807 $i,j$ \u4e4b\u5dee\uff1a\n\n$$j - [(i-k)-m+1]-k = j - i + m - 1$$\n\n\u800c\u8fd9\u4e2a\u4e1c\u897f\u548c $k$ \u662f\u65e0\u5173\u7684\u3002\u8fd9\u542f\u53d1\u6211\u4eec\u591a\u8bbe\u4e00\u4e2a $h_{i,k,0/1}$ \u8868\u793a\u524d $i$ \u4f4d\u4e2d\uff0c\u6240\u6709 $j-i = k$ \u7684 $f_{i,j,0/1}$ \u4e4b\u548c\uff0c\u524d\u7f00\u548c\u641e\u4e00\u4e0b\u5c31\u80fd\u505a\u5230 $O(n^2)$ \u4e86\u3002\u8fb9\u754c $g_{0,0,0/1}=h_{0,0,0/1}= 1$\u3002\n\n\u7136\u540e\u9700\u8981\u6ce8\u610f\u7684\u662f $j-i$ \u53ef\u80fd\u51cf\u51fa\u8d1f\u6570\uff0c\u6211\u4eec\u628a\u4e0b\u6807\u5e73\u79fb $n$ \u5c31\u53ef\u4ee5\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\n\n```cpp\nconst int MN = 3e3 + 5, Mod = 1e9 + 7;\n\nint N, M, K, f[MN][MN][2], g[MN][MN][2], h[MN][2 * MN][2], pA[MN], pB[MN];\nchar s[MN];\n\nsigned main(void) {\n    N = read(), M = read(), K = read(), scanf(\"%s\", s + 1);\n    for (int i = 1, A = 0, B = 0; i <= N; i++) {\n        if (s[i] == 'A') A = i;\n        if (s[i] == 'B') B = i;\n        pA[i] = A, pB[i] = B;\n    }\n    g[0][0][0] = g[0][0][1] = h[0][N][0] = h[0][N][1] = 1;\n    for (int i = 1; i <= N; i++) {\n        for (int j = 0; j <= K; j++) {\n            if (s[i] != 'B') {\n                if (i - pB[i] < M) {\n                    f[i][j][0] = (f[i][j][0] + ((g[i - 1][j][1] - (pB[i] ? g[pB[i] - 1][j][1] : 0)) % Mod + Mod) % Mod) % Mod;\n                } else {\n                    int x = j - i + M - 1 + N;\n                    f[i][j][0] = (f[i][j][0] + ((g[i - 1][j][1] - g[i - M][j][1]) % Mod + Mod) % Mod) % Mod;\n                    f[i][j][0] = (f[i][j][0] + ((h[i - M][x][1] - (pB[i] ? h[pB[i] - 1][x][1] : 0)) % Mod + Mod) % Mod) % Mod;\n                }\n            }\n            if (s[i] != 'A') {\n                if (i - pA[i] < M) {\n                    f[i][j][1] = (f[i][j][1] + ((g[i - 1][j][0] - (pA[i] ? g[pA[i] - 1][j][0] : 0)) % Mod + Mod) % Mod) % Mod;\n                } else {\n                    int x = j - i + M - 1 + N;\n                    f[i][j][1] = (f[i][j][1] + ((g[i - 1][j][0] - g[i - M][j][0]) % Mod + Mod) % Mod) % Mod;\n                    f[i][j][1] = (f[i][j][1] + ((h[i - M][x][0] - (pA[i] ? h[pA[i] - 1][x][0] : 0)) % Mod + Mod) % Mod) % Mod;\n                }\n            }\n            g[i][j][0] = (g[i - 1][j][0] + f[i][j][0]) % Mod;\n            g[i][j][1] = (g[i - 1][j][1] + f[i][j][1]) % Mod;\n            h[i][j - i + N][0] = (h[i - 1][j - i + N][0] + f[i][j][0]) % Mod;\n            h[i][j - i + N][1] = (h[i - 1][j - i + N][1] + f[i][j][1]) % Mod;\n        }\n    }\n    int Ans = 0;\n    Ans = (f[N][K][0] + f[N][K][1]) % Mod;\n    printf(\"%d\\n\", Ans);\n    return 0;\n}\n```\n",
        "postTime": 1637930989,
        "uid": 246019,
        "name": "_came11ia_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7969 \u3010[KSN2021] Self Defence\u3011"
    },
    {
        "content": "\u672c\u6587\u8d77\u7b14\u4e8e```2022.01.08```\u3002\n\n[P7969 [KSN2021] Self Defence](https://www.luogu.com.cn/problem/P7969) \n\n\u9996\u5148\u5f88\u5bb9\u6613\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a $O(n^3)$ \u7684\u5957\u8def $\\text{dp}$\uff0c\u8bbe $f(i,j,k,0/1)$ \u8868\u793a\u5f53\u524d\u5904\u7406\u5230\u7b2c $i$ \u4e2a\u5b57\u7b26\uff0c\u5df2\u7ecf\u6709\u4e86 $j$ \u4e2a\u5355\u4f4d\u7684\u6743\u503c\uff0c\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e3a $\\text{A/B}$\uff0c\u4e14\u7b2c $i$ \u4e2a\u5b57\u7b26\u6240\u5728\u7684\u6781\u957f\u8fde\u7eed\u6bb5\u957f\u5ea6\u4e3a $k$ \u65f6\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u5f88\u7b80\u5355\uff0c\u7565\u8fc7\u3002\n\n\u524d\u4e24\u7ef4\u96be\u4ee5\u4f18\u5316\u6389\uff0c\u90a3\u53ea\u597d\u4f18\u5316\u6389\u7b2c\u4e09\u7ef4\uff0c\u65b9\u6cd5\u662f\u901a\u8fc7\u589e\u52a0\u51b3\u7b56\u91cf\u6765\u51cf\u5c11\u72b6\u6001\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf $\\text{dp}$ \u7684\u8f6c\u79fb\u6211\u4eec\u8bbe $m=M-1$\uff0c\u5219\u957f\u5ea6\u4e3a $l$ \u7684\u8fde\u7eed\u6bb5\uff08\u5168\u90e8\u7531\u540c\u4e00\u79cd\u5b57\u7b26\u7ec4\u6210\uff09\u7684\u6743\u503c\u4e3a $\\max\\{l-m,0\\}$\u3002\n\n\u8bbe $f(i,j,0/1)$ \u8868\u793a\u5f53\u524d\u5904\u7406\u5230\u7b2c $i$ \u4e2a\u5b57\u7b26\uff0c\u5df2\u7ecf\u6709\u4e86 $j$ \u4e2a\u5355\u4f4d\u7684\u6743\u503c\uff0c\u4e14\u7b2c $i$ \u4e2a\u5b57\u7b26\u6240\u5728\u7684\u6781\u957f\u8fde\u7eed\u6bb5\u7531 $\\text{A/B}$ \u7ec4\u6210\uff0c\u5219\u51b3\u7b56\u65f6\u679a\u4e3e\u4e0a\u4e00\u4e2a\u6781\u957f\u8fde\u7eed\u6bb5\uff08\u7531\u4e0e\u76ee\u524d\u5b57\u7b26\u76f8\u53cd\u7684\u5b57\u7b26 $\\text{B/A}$ \u7ec4\u6210\uff09\u7684\u672b\u5c3e\u4f4d\u7f6e\uff0c\u7136\u540e\u8f6c\u79fb\u3002\n$$\nf(i,j,fg)=\\sum_{k=0}^{i-1}f(k,j-\\max\\{i-k-m,0\\},fg\\oplus 1)\n$$\n\u7136\u800c\u4e0a\u9762\u7684\u8f6c\u79fb\u4e0d\u5b8c\u5168\u6b63\u786e\uff0c\u6211\u4eec\u8fd8\u8981\u7279\u5224\u4e00\u4e0b\u5b57\u7b26\u4e32\u5b50\u6bb5 $str[k+1,i]$ \u662f\u5426\u80fd\u6784\u6210\u7531\u5168\u90e8\u7531 $fg$ \u5bf9\u5e94\u5b57\u7b26\u7ec4\u6210\u7684\u6781\u957f\u8fde\u7eed\u6bb5\uff0c\u4e8e\u662f\u8bbe $s(i,fg)$ \u4e3a $k$ \u6240\u80fd\u53d6\u5230\u7684\u6700\u5c0f\u503c\uff0c\u5373\u4e3a\u6ee1\u8db3 $str[k+1,i]$ \u4e3a\u7531 $fg$ \u5bf9\u5e94\u5b57\u7b26\u7ec4\u6210\u7684\u6781\u957f\u8fde\u7eed\u6bb5\u7684\u6700\u5c0f\u7684 $k$\uff0c$s$ \u662f\u5f88\u5bb9\u6613\u9884\u5904\u7406\u7684\u3002\n\n\u8fd8\u8981\u6ce8\u610f $j-\\max\\{i-k-m,0\\}$ \u4e0d\u80fd\u4e3a\u8d1f\u6570\uff0c\u5373 $k\\ge i-m-j$\uff0c\u4e8e\u662f\u6b63\u786e\u7684\u8f6c\u79fb\u65b9\u7a0b\u4e3a\n$$\nf(i,j,fg)=\\sum_{k=\\max\\{s(i,fg),i-m-j\\}}^{i-1}f(k,j-\\max\\{i-k-m,0\\},fg\\oplus 1)\n$$\n\u7136\u540e\u6839\u636e $\\max$ \u53d6\u5de6\u8fb9\u7684\uff0c\u8fd8\u662f\u53d6\u53f3\u8fb9\u7684\u8fdb\u884c\u5206\u6bb5\n$$\n\\begin{aligned}\nf(i,j,fg)&=\\sum_{k=\\max\\{s(i,fg),i-m-j\\}}^{i-m-1}f(k,k+(m+j-i),fg\\oplus 1)\\\\\n&+\\sum_{k=\\max\\{s(i,fg),i-m\\}}^{i-1}f(k,j,fg\\oplus 1)\\\\\n\\end{aligned}\n$$\n\u663e\u7136\uff0c\u8fd9\u4e2a\u8f6c\u79fb\u662f\u53ef\u4ee5\u901a\u8fc7\u524d\u7f00\u548c\u4f18\u5316\u7684\n\n\u8bbe\n$$\n\\begin{aligned}\n&g(i,j,fg)=\\sum_{k=0}^{\\min\\{i,j\\}}f(i-k,j-k,fg)\\\\\n&h(i,j,fg)=\\sum_{k=0}^{i}f(k,j,fg)\\\\\n\\end{aligned}\n$$\n\u518d\u8bbe\n$$\n\\begin{aligned}\n&b_1=\\max\\{s(i,fg),i-m-j\\},&t_1=i-m-1\\\\\n&b_2=\\max\\{s(i,fg),i-m\\},&t_2=i-1\\\\\n&x=m+j-i&\\\\\n\\end{aligned}\n$$\n\u6240\u4ee5\u6709\n$$\n\\begin{aligned}\nf(i,j,fg)&=\\sum_{k=b_1}^{t_1}f(k,k+x,fg\\oplus 1)\\\\\n&+\\sum_{k=b_2}^{t_2}f(k,j,fg\\oplus 1)\\\\\n&=g(t_1,t_1+x,fg\\oplus1)-g(b_1-1,b_1-1+x,fg\\oplus1)\\\\\n&+h(t_2,j,fg\\oplus1)-h(b_2,j,fg\\oplus1)\n\\end{aligned}\n$$\n\u800c\u5f53 $b_i>t_i$ \u65f6\uff0c\u5bf9\u5e94\u7684\u6c42\u548c\u5f0f\u4e3a $0$\uff0c\u8fd9\u4e2a\u8981\u7279\u5224\u4e00\u4e0b\u3002\n\n\u8fb9\u754c\u6761\u4ef6\u4e3a \n$$\n\\begin{aligned}\n&f(0,j,fg)=g(0,j,fg)=h(0,j,fg)=[j=0]\\\\\n&f(i,j,fg)=0\\quad(j>\\max\\{i-m,0\\})\\\\\n\\end{aligned}\n$$\n\u6700\u7ec8\u7b54\u6848\u4e3a\n$$\nans = f(N,K,0)+f(N,K,1)\n$$\n\u4ee3\u7801\n\n```cpp\n#include <stdio.h>\n#include <algorithm>\n#include <string.h>\n#include <iostream>\n#include <assert.h>\nusing namespace std;\n\n#define re register\n#define sf scanf\n#define pf printf\n#define nl() putchar('\\n')\n#define ms(x, val) memset(x, val, sizeof(x))\n#define ll long long\n#define db double\n#define ull unsigned long long\n#define _for(i, a, b) for(re int (i) = (a); (i) < (b); ++(i))\n#define _rfor(i, a, b) for(re int (i) = (a); (i) <= (b); ++(i))\n#define _fev(p, u) for(re int (p) = head[(u)]; (p); (p) = nex[(p)])\n#define inf 0x7fffffff\n#define maxn 3005\n#define mod 1000000007ll\n\ntemplate <class T>\nvoid print(string name, T arr[], int n, int flag = 1){\n\tcout<<name<<\":\";\n\t_for(i, 0, n)cout<<\" \"<<arr[i+flag];\n\tcout<<endl;\n}\n\nint rdnt(){\n\tre int x = 0, sign = 1;\n\tre char c = getchar();\n\twhile (c < '0' || c > '9') { if (c == '-') sign = -1; c = getchar(); }\n\twhile (c >= '0' && c <= '9') x = (x<<3) + (x<<1) + (c ^ 48), c = getchar();\n\treturn x * sign;\n}\n\nchar str[maxn];\nint s[maxn][2], f[maxn][maxn][2], g[maxn][maxn][2], h[maxn][maxn][2];\n\nbool yes(char x, char c){\n\treturn x == '?' || x == c;\n}\n\nint cg(re int b, re int t, re int k, re int fg){\n\tif (b > t) return 0;\n\telse return (g[t][t+k][fg]+(b>0?mod-g[b-1][b-1+k][fg]:0))%mod;\n}\n\nint ch(re int b, re int t, re int j, re int fg){\n\tif (b > t) return 0;\n\telse return (h[t][j][fg]+(b>0?mod-h[b-1][j][fg]:0))%mod;\n}\n\nvoid print(int arr[maxn][maxn][2], int n, int k){\n\t_rfor(i, 0, n){\n\t\tpf(\"(%d):\", i);\n\t\t_rfor(j, 0, k) pf(\" %d|%d\", arr[i][j][0], arr[i][j][1]);\n\t\tnl();\n\t}nl();\n}\n\nint main(){\n\t#ifndef ONLINE_JUDGE\n\tfreopen(\"sample.in\", \"r\", stdin);\n\t//freopen(\"sample.out\", \"w\", stdout);\n\t#endif\n\t\n\tre int n = rdnt(), m = rdnt()-1, K = rdnt();\n\tsf(\"%s\", str+1);\n\ts[0][0] = s[0][1] = 0;\n\t_rfor(i, 1, n){\n\t\tif (yes(str[i], 'A')) s[i][0] = yes(str[i-1], 'A')?s[i-1][0]:i-1;\n\t\tif (yes(str[i], 'B')) s[i][1] = yes(str[i-1], 'B')?s[i-1][1]:i-1;\n\t\tif (str[i] == 'A') s[i][1] = i;\n\t\tif (str[i] == 'B') s[i][0] = i;\n\t}\n\t\n\tre int b1, b2, t1, t2;\n\tf[0][0][0] = f[0][0][1] = g[0][0][0] = g[0][0][1] = h[0][0][0] = h[0][0][1] = 1;\n\t_rfor(i, 1, n) _rfor(j, 0, K) _rfor(fg, 0, 1){\n\t\tb1 = max(s[i][fg], i-m-j); t1 = i-m-1;\n\t\tb2 = max(s[i][fg], i-m); t2 = i-1;\n\t\t\n\t\tif (j <= max(0, i-m)) f[i][j][fg] = (cg(b1, t1, m+j-i, fg^1) + ch(b2, t2, j, fg^1))%mod;\n\t\telse f[i][j][fg] = 0;\n\t\tg[i][j][fg] = (f[i][j][fg] + (j>0?g[i-1][j-1][fg]:0))%mod;\n\t\th[i][j][fg] = (f[i][j][fg] + h[i-1][j][fg])%mod;\n\t}\n\t\n//\tprint(f, n, K);\n//\tprint(g, n, K);\n//\tprint(h, n, K);\n\t\n\tre int ans = (f[n][K][0] + f[n][K][1])%mod;\n\tpf(\"%d\\n\", ans);\n\n\treturn 0;\n}\n```\n\n\n\n\n\n",
        "postTime": 1641627587,
        "uid": 474113,
        "name": "MoYuFang",
        "ccfLevel": 7,
        "title": "\u3010P7969 [KSN2021] Self Defence\u3011\u9898\u89e3"
    },
    {
        "content": "\u8bbe $f_{i,j,0/1}$\uff0c\u8868\u793a\u524d $i$ \u4e2a\u5b57\u7b26\uff0c\u6743\u503c\u4e3a $j$\uff0c\u6700\u540e\u4e00\u4e2a\u662f $A/B$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\u53ef\u4ee5\u4e00\u6bb5\u4e00\u6bb5\u8f6c\u79fb\uff0c\u5047\u8bbe\u5f53\u524d\u65b0\u589e\u7684\u8fde\u7eed\u6bb5\u957f\u5ea6\u4e3a $k$\uff0c\u90a3\u4e48\u4f1a\u8f6c\u79fb\u5230 $f_{i+k,j+\\max(0,k-K+1)}$\u3002\n\n\u6bcf\u6b21\u9009\u62e9\u7684 $k$ \u4e0b\u754c\u662f $1$\uff0c\u4e0a\u754c\u662f\u4e0b\u4e00\u4e2a\u4e0d\u540c\u5b57\u7b26\u5230\u5f53\u524d\u4f4d\u7f6e\u7684\u8ddd\u79bb\u3002\n\n\u5c06 $\\max$ \u62c6\u5f00\uff0c\u53d8\u6210\u4e24\u90e8\u5206\uff0c\u90fd\u53ef\u4ee5\u7528\u5dee\u5206\u4f18\u5316\u8f6c\u79fb\uff0c\u5177\u4f53\u7684\uff0c\u4e3a\u6bcf\u4e2a\u72b6\u6001\u6253\u4e24\u4e2a\u6807\u8bb0\uff0c\u5206\u522b\u7ef4\u62a4\u8d21\u732e\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read(){\n\tre int t=0;re char v=getchar();\n\twhile(v<'0')v=getchar();\n\twhile(v>='0')t=(t<<3)+(t<<1)+v-48,v=getchar();\n\treturn t;\n}\nconst int M=1e9+7;\ninline void add(re int &x,re int y){(x+=y)>=M?x-=M:x;}\ninline int Mod(re int x){return x>=M?x-M:x;}\ninline int ksm(re int x,re int y){\n\tre int s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%M;\n\t\tx=1ll*x*x%M,y>>=1;\n\t}\n\treturn s;\n}\nint f[3002][3002][2],n,m,K,sa[3002],sb[3002],tg[3002][3002][2],nxta[3002],nxtb[3002],tg1[3002][3002][2];\nchar s[3002];\nint main(){\n\tn=read(),m=read(),K=read(),scanf(\"%s\",s+1);\n\tfor(re int i=1;i<=n;++i)sa[i]=sa[i-1]+(s[i]=='A'),sb[i]=sb[i-1]+(s[i]=='B');\n\tnxta[n+1]=nxtb[n+1]=n+1;\n\tfor(re int i=n;~i;--i){\n\t\tnxta[i]=nxta[i+1],nxtb[i]=nxtb[i+1];\n\t\tif(s[i+1]=='A')nxta[i]=i+1;\n\t\tif(s[i+1]=='B')nxtb[i]=i+1;\n\t}\n\tf[0][0][0]=f[0][0][1]=1;\n\tfor(re int i=0;i<=n;++i)\n\t\tfor(re int j=0;j<=min(K,i);++j){\n\t\t\tif(i)add(tg[i][j][0],tg[i-1][j][0]);\n\t\t\tif(i)add(tg[i][j][1],tg[i-1][j][1]);\n\t\t\tif(i&&j)add(tg1[i][j][0],tg1[i-1][j-1][0]),add(tg1[i][j][1],tg1[i-1][j-1][1]);\n\t\t\tadd(f[i][j][0],tg[i][j][0]);\n\t\t\tadd(f[i][j][1],tg[i][j][1]);\n\t\t\tadd(f[i][j][0],tg1[i][j][0]);\n\t\t\tadd(f[i][j][1],tg1[i][j][1]);\n\t\t\tif(s[i+1]!='A'){\n\t\t\t\tadd(tg[i+1][j][1],f[i][j][0]);\n\t\t\t\tadd(tg[min(nxta[i],i+m)][j][1],M-f[i][j][0]);\n\t\t\t}\n\t\t\tif(s[i+1]!='B'){\n\t\t\t\tadd(tg[i+1][j][0],f[i][j][1]);\n\t\t\t\tadd(tg[min(nxtb[i],i+m)][j][0],M-f[i][j][1]);\n\t\t\t}\n\t\t\tif(i+m<=n&&sa[i+m]==sa[i])add(tg1[i+m][j+1][1],f[i][j][0]),add(tg1[nxta[i]][j+nxta[i]-i-m+1][1],M-f[i][j][0]);\n\t\t\tif(i+m<=n&&sb[i+m]==sb[i])add(tg1[i+m][j+1][0],f[i][j][1]),add(tg1[nxtb[i]][j+nxtb[i]-i-m+1][0],M-f[i][j][1]);\n\t\t}\n\tprintf(\"%d\",Mod(f[n][K][0]+f[n][K][1]));\n}\n\n\n```\n",
        "postTime": 1637736535,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7969"
    },
    {
        "content": "## \u601d\u8def\n\n\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a DP\uff0c\u4ee4 $f_{i,j,0/1}$ \u8868\u793a\u7b2c $i$ \u4f4d\u7684\u5b57\u6bcd\u586b $A/B$ \u662f\u6743\u503c\u4e3a $j$ \u7684\u60c5\u51b5\u6570\u3002\n\n\u8003\u8651\u9884\u5904\u7406 $pre_{i,0/1}$ \u8868\u793a\u7b2c $i$ \u4f4d\u524d\u7b2c\u4e00\u4e2a\u5df2\u7ecf\u586b\u597d\u7684 $A/B$\u3002\n\n\u5f53 $i-pre_i<m$ \u65f6\uff0c\u6700\u65b0\u7684\u4e00\u6bb5\u8fde\u7eed\u7684 $A/B$ \u6ca1\u6709\u8d21\u732e\u3002\u679a\u4e3e\u524d\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u6700\u540e\u4e00\u4f4d $l$\u3002\n\n### $f_{i,j}=\\sum_{l=pre_i}^{i-1} f_{l,j}$\n\n\u5f53 $i-pre_i\\ge m$ \u65f6\uff0c\u6211\u4eec\u628a\u7b54\u6848\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u6709\u8d21\u732e\uff0c\u53e6\u4e00\u90e8\u5206\u6ca1\u6709\u3002\n\n### $f_{i,j}=\\sum_{l=i-m+1}^{i-1} f_{l,j}+\\sum_{l=pre_i}^{i-m} f_{l,j-(i-k-m+1)}$\n\n\u663e\u7136 $f_{0,0,0/1}=1$\uff0c\u6700\u540e\u7b54\u6848\u4e3a $f_{n,k,0}+f_{n,k,1}$\u3002\n\n\u4f46\u8fd9\u6837\u65f6\u95f4\u662f $n^3$ \u7684\uff0c\u6211\u4eec\u8003\u8651\u524d\u7f00\u548c\u4f18\u5316\u3002\n\n\u6ca1\u8d21\u732e\u7684\u90a3\u90e8\u5206\u7528 $s_{i,j,0/1}$ \u8bb0\u5f55\u6240\u6709 $f_{l,j,0/1}$ \u7684\u503c\u3002\n\n\u5bf9\u4e8e\u6709\u8d21\u732e\u7684\u90e8\u5206\uff0c\u6211\u4eec\u53d1\u73b0 $j-(i-k-m+1)-l=j-i+m-1$\uff0c\u6240\u4ee5\u53ef\u4ee5\u4ee4 $p_{i,x,0/1}$ \u8868\u793a\u6240\u6709 $l-j=x$ \u7684 $f_{l,j,0/1}$ \u7684\u503c\u3002\u4e8e\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u662f $n^2$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3e3+10,mod=1e9+7;\nint n,m,k,pre[N][2],f[N][N][2],s1[N][N][2],s2[N][N*2][2];\nstring s;\nint main()\n{\n\tint x,y;\n\tcin>>n>>m>>k;\n\tcin>>s;\n\ts=\" \"+s;\n\tx=y=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(s[i]=='A')\n\t\t{\n\t\t\tx=i;\n\t\t}else if(s[i]=='B')\n\t\t{\n\t\t\ty=i;\n\t\t}\n\t\tpre[i][0]=x;\n\t\tpre[i][1]=y;\n\t}\n\tf[0][0][0]=f[0][0][1]=1;\n\ts1[0][0][0]=s1[0][0][1]=1;\n\ts2[0][n][0]=s2[0][n][1]=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=0;j<=k;j++)\n\t\t{\n\t\t\tif(s[i]=='?')\n\t\t\t{\n\t\t\t\tfor(x=0;x<2;x++)\n\t\t\t\t{\n\t\t\t\t\tif(i-pre[i][1-x]<m)\n\t\t\t\t\t{\n\t\t\t\t\t\tf[i][j][x]=((s1[i-1][j][1-x]-(pre[i][1-x]? s1[pre[i][1-x]-1][j][1-x]:0))%mod+mod)%mod;\n\t\t\t\t\t}else\n\t\t\t\t\t{\n\t\t\t\t\t\tf[i][j][x]=((s1[i-1][j][1-x]-s1[i-m][j][1-x])%mod+mod)%mod;\n\t\t\t\t\t\tf[i][j][x]=(((f[i][j][x]+s2[i-m][j-i+m-1+n][1-x])%mod-(pre[i][1-x]? s2[pre[i][1-x]-1][j-i+m-1+n][1-x]:0))%mod+mod)%mod;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else\n\t\t\t{\n\t\t\t\tx=s[i]-'A';\n\t\t\t\tif(i-pre[i][1-x]<m)\n\t\t\t\t{\n\t\t\t\t\tf[i][j][x]=((s1[i-1][j][1-x]-(pre[i][1-x]? s1[pre[i][1-x]-1][j][1-x]:0))%mod+mod)%mod;\n\t\t\t\t}else\n\t\t\t\t{\n\t\t\t\t\tf[i][j][x]=((s1[i-1][j][1-x]-s1[i-m][j][1-x])%mod+mod)%mod;\n\t\t\t\t\tf[i][j][x]=(((f[i][j][x]+s2[i-m][j-i+m-1+n][1-x])%mod-(pre[i][1-x]? s2[pre[i][1-x]-1][j-i+m-1+n][1-x]:0))%mod+mod)%mod;\n\t\t\t\t}\n\t\t\t}\n\t\t\ts1[i][j][0]=(s1[i-1][j][0]+f[i][j][0])%mod;\n\t\t\ts1[i][j][1]=(s1[i-1][j][1]+f[i][j][1])%mod;\n\t\t\ts2[i][j-i+n][0]=(s2[i-1][j-i+n][0]+f[i][j][0])%mod;\n\t\t\ts2[i][j-i+n][1]=(s2[i-1][j-i+n][1]+f[i][j][1])%mod;\n\t\t}\n\t}\n\tcout<<(f[n][k][0]+f[n][k][1])%mod;\n}\n```\n",
        "postTime": 1684056640,
        "uid": 310581,
        "name": "ethan090328",
        "ccfLevel": 5,
        "title": "P7969\u9898\u89e3"
    }
]