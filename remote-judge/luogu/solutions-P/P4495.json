[
    {
        "content": "### \u9898\u89e3\n\u6211\u4eec\u9996\u5148\u8003\u8651 $n=1$ \u7684\u60c5\u51b5\uff0c~~\u901a\u8fc7\u6253\u8868~~\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4f53\u79ef\u4e3a $v$ \u7684\u7269\u54c1\uff0c\u5728\u53ef\u4ee5\u53d6\u65e0\u9650\u6b21\u7684\u6761\u4ef6\u4e0b\uff0c\u80fd\u591f\u53d6\u5230\u7684\u4f53\u79ef\u5bf9 $P$ \u53d6\u819c\u7684\u503c\u53ef\u4ee5\u4e3a\n\n$gcd(v,P),2*gcd(v,P),3*gcd(v,P)...$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u7269\u54c1\u7684\u4f53\u79ef\u770b\u505a $gcd(v,P)$\uff0c\u8fd9\u5bf9\u7b54\u6848\u4e0d\u4f1a\u6709\u4efb\u4f55\u5f71\u54cd\u3002\n\n\u7531\u6b64\u6211\u4eec\u5f97\u5230\u542f\u53d1\uff0c$O(\\sqrt{P})$ \u9884\u5904\u7406\u51fa $P$ \u7684\u6bcf\u4e2a\u7ea6\u6570\uff0c\u5b58\u50a8\u6bcf\u4e2a\u7ea6\u6570\u51fa\u73b0\u7684\u6b21\u6570\u3002\u7531\u4e8e\u540c\u4e00\u4e2a\u7ea6\u6570\u591a\u6b21\u9009\u53d6\u5bf9\u7b54\u6848\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\uff0c\u5bb9\u6613\u5f97\u51fa\uff0c\u5982\u679c $P$ \u7684\u4e00\u4e2a\u7ea6\u6570\u51fa\u73b0\u6b21\u6570\u4e3a $x$\uff0c\u5219\u6709 $2^x-1$ \u79cd\u65b9\u6848\u9009\u53d6\u8fd9\u4e2a\u7ea6\u6570\u3002\n\n~~\u7ee7\u7eed\u6253\u8868~~\u6211\u4eec\u53c8\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u9009\u53d6\u4e86 $P$ \u7684\u4e24\u4e2a\u7ea6\u6570 $a_{1},a_{2}$\uff0c\u80fd\u591f\u53d6\u5230\u7684\u503c\u819c $P$ \u7684\u503c\u53ef\u4ee5\u4e3a\n\n$gcd(a_{1},a_{2}),2*gcd(a_{1},a_{2}),3*gcd(a_{1},a_{2})...$\n\n\u6211\u4eec\u53ef\u4ee5~~\u53e3\u80e1~~\u8bc1\u660e\uff0c\u5f53\u9009\u53d6\u7ea6\u6570\u4e2a\u6570\u5927\u4e8e 2 \u65f6\uff0c\u4e0a\u5f0f\u4f9d\u7136\u6210\u7acb\u3002\n\n\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u5199\u51faDP\u65b9\u7a0b\uff0c\u8bbe $F[i][j]$ \u8868\u793a\u9009\u5230 $P$ \u7684\u7b2c $i$ \u4e2a\u7ea6\u6570\uff0c\u9009\u51fa\u7684\u6570\u7684 gcd \u503c\u4e3a $P$ \u7684\u7b2c $j$ \u4e2a\u7ea6\u6570\u7684\u65b9\u6848\u6570\uff0c\u5219\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n\n$F[i][j]=F[i-1][j]+(1+\\sum{_{gcd(a[k],a[i])==a[j]}F[i-1][k]})*(2^{s[i]}-1)$\n\n\u5176\u4e2d $a[i]$ \u8868\u793a $P$ \u7684\u7b2c $i$ \u4e2a\u7ea6\u6570\uff0c$s[i]$ \u8868\u793a\u7b2c $i$ \u4e2a\u7ea6\u6570\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u8be5\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(M^2logM)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(M^2)$ \u6216 $O(2M)$ \uff08\u6eda\u52a8\u6570\u7ec4\uff09\uff0c\u5176\u4e2d $M$ \u4e3a $P$ \u7684\u7ea6\u6570\u4e2a\u6570\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee $w_{i}$\uff0c\u6211\u4eec\u5bb9\u6613\u5f97\u51fa\u7b54\u6848\u5c31\u662f\n\n$\\sum{_{a[i]|w_{i}}F[n][i]}$\n\n\u4f46\u662f\u8be2\u95ee\u6570\u91cf\u53ef\u4ee5\u8fbe\u5230 $10^6$ \uff0c$M$ \u6700\u5927\u53ef\u4ee5\u8fbe\u5230 $10^3$ \u4ee5\u4e0a\uff0c$O(qM)$ \u7684\u66b4\u529b\u7edf\u8ba1\u4f9d\u7136\u4f1aTLE\u3002\n\n\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u4e00\u4e2a\u6570\u65e2\u662f $P$ \u7684\u7ea6\u6570\uff0c\u53c8\u662f $w_{i}$ \u7684\u7ea6\u6570\uff0c\u90a3\u4e48\u5b83\u4e00\u5b9a\u662f $gcd(P,w_{i})$ \u7684\u7ea6\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u7edf\u8ba1\n\n$\\sum{_{a[i]|gcd(P,w_{i})}F[n][i]}$\n\n\u800c\u8fd9\u53ef\u4ee5\u5728DP\u4e4b\u540e\u5c31\u9884\u5904\u7406\u51fa\u6765\uff1a\n\n$G[i]=\\sum{_{a[j]|a[i]}F[n][j]}$\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5 $O(1)$ \u56de\u7b54\u8be2\u95ee\uff0c\u8fd9\u6837\u603b\u590d\u6742\u5ea6\u5c31\u662f $O(\\sqrt{P}+M^2logM+q)$\uff0c\u8fd9\u9053\u9898\u5c31\u53ef\u4ee5AC\u5566\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int N=1000010,M=10050,mod=1000000007;\nint n,q,P,v[N],num[M],tot[M],cnt=0,f[2][M],g[M],now=0,sum[N];\n\ninline void init(){\n    sum[1]=2;\n    for(register int i=2;i<=n;i++)sum[i]=sum[i-1]*2%mod;\n    for(register int i=1;i<=n;i++)sum[i]=(sum[i]+mod-1)%mod;\n    \n    for(register int i=1;i<=sqrt(P);i++)if(P%i==0)num[++cnt]=i;\n    for(register int i=cnt;i>1;i--)if(P/num[i]!=num[i])num[++cnt]=P/num[i];\n    for(register int i=1;i<=n;i++){\n        int pos=lower_bound(num+1,num+cnt+1,v[i])-num;\n        tot[pos]++;\n    }\n    \n    for(register int i=1;i<=cnt;i++)if(tot[i]){\n        now^=1;\n        for(register int j=1;j<=cnt;j++)f[now][j]=f[now^1][j];\n        for(register int j=1;j<=cnt;j++)if(f[now^1][j]){\n            int nxt=__gcd(num[j],num[i]);\n            int pos=lower_bound(num+1,num+cnt+1,nxt)-num;\n            (f[now][pos]+=1LL*f[now^1][j]*sum[tot[i]]%mod)%=mod;\n        }\n        (f[now][i]+=sum[tot[i]])%=mod;\n    }\n    for(register int i=1;i<=cnt;i++){\n    \tfor(register int j=1;j<=i;j++)if(num[i]%num[j]==0){\n            (g[i]+=f[now][j])%=mod;\n        }\n    }\n}\n\nint main(){\n    scanf(\"%d%d%d\",&n,&q,&P);\n    for(register int i=1;i<=n;i++)scanf(\"%d\",&v[i]),v[i]=__gcd(v[i],P);\n    init();\n    for(register int i=1;i<=q;i++){\n        int x,ans=0;scanf(\"%d\",&x);x=__gcd(x,P);\n        int pos=lower_bound(num+1,num+cnt+1,x)-num;\n        printf(\"%d\\n\",g[pos]);\n    }\n    return 0;\n}\n```",
        "postTime": 1531118006,
        "uid": 27003,
        "name": "Bruteforces",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4495 \u3010[HAOI2018]\u5947\u602a\u7684\u80cc\u5305\u3011"
    },
    {
        "content": "\u8bbe\u5f53\u524d\u9009\u53d6\u7684\u7269\u54c1\u5e8f\u5217\u4e3a$v_{a_1},v_{a_2},...,v_{a_k}$\n\n\u5219\u53ef\u4ee5\u51d1\u51fa$w$\u7684\u6761\u4ef6\u662f$gcd(P, v_{a_1},v_{a_2},...,v_{a_k})|w$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5$DP$\u4e86\u3002\n\n\u8bbe$f_{i,j}$\u8868\u793a\u8003\u8651\u4e86\u524d$i$\u4e2a\u7269\u54c1\uff0c\u5f53\u524d\u9009\u53d6\u7684\u7269\u54c1\u4e0e$P$\u7684$gcd$\u4e3a$j$\u7684\u65b9\u6848\u6570\u3002\u6bcf\u6b21\u8f6c\u79fb\u53ea\u9700\u8981\u8003\u8651\u9009\u8fd8\u662f\u4e0d\u9009\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(d(p)n)$\uff0c$d(p)$\u662f$P$\u7684\u56e0\u5b50\u4e2a\u6570\uff0c\u7ea6\u4e3a$P^{\\frac{1}{3}}$\u3002\n\n\u4f18\u5316\u65b9\u6cd5\u662f\u628a\u4e0e$gcd(v_i,P)$\u7684$v_i$\u538b\u5728\u4e00\u8d77\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u4e3a$O(d(p)^2log)$\u3002\n\n```\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int maxn = 1000005, maxw = 1505, mod = 1e9 + 7;\n\ntypedef long long lint;\nint n, m, q, P, tot, v[maxn], cnt[maxw], d[maxw], f[maxw][maxw], ans[maxw], pow2[maxn];\nmap<int, int> g;\n\ninline int gi()\n{\n    char c = getchar();\n    while (c < '0' || c > '9') c = getchar();\n    int sum = 0;\n    while ('0' <= c && c <= '9') sum = sum * 10 + c - 48, c = getchar();\n    return sum;\n}\n\ninline int gcd(int a, int b)\n{\n    if (b == 0) return a;\n    return gcd(b, a % b);\n}\n\ninline void inc(int &a, int b) {a += b; if (a >= mod) a -= mod;}\n\nint main()\n{\n    n = gi(); q = gi(); P = gi();\n    for (int i = 1; i <= n; ++i) v[i] = gcd(P, gi());\n    sort(v + 1, v + n + 1);\n\n    for (int i = 1; i <= n; ++i)\n        if (v[i] != v[i - 1]) ++tot, v[tot] = v[i], cnt[tot] = 1;\n        else ++cnt[tot];\n    n = tot;\n    \n    for (int i = 1; i * i <= P; ++i) {\n        if (P % i == 0) {\n            d[++m] = i;\n            if (i * i != P) d[++m] = P / i;\n        }\n    }\n    sort(d + 1, d + m + 1);\n    for (int i = 1; i <= m; ++i) g[d[i]] = i;\n\n    pow2[0] = 1;\n    for (int i = 1; i <= 100000; ++i) pow2[i] = pow2[i - 1] * 2 % mod;\n    f[0][m] = 1;\n    for (int i = 1; i <= n; ++i)\n        for (int j = 1; j <= m; ++j) {\n            int k = g[gcd(v[i], d[j])];\n            inc(f[i][j], f[i - 1][j]);\n            inc(f[i][k], (lint)f[i - 1][j] * (pow2[cnt[i]] - 1) % mod);\n        }\n\n    for (int i = 1; i <= m; ++i)\n        for (int j = 1; j <= i; ++j)\n            if (d[i] % d[j] == 0) inc(ans[i], f[n][j]);\n\n    for (int i = 1; i <= q; ++i) printf(\"%d\\n\", ans[g[gcd(gi(), P)]]);\n    \n    return 0;\n}\n```",
        "postTime": 1548808112,
        "uid": 119899,
        "name": "dsidsi",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4495 \u3010[HAOI2018]\u5947\u602a\u7684\u80cc\u5305\u3011"
    },
    {
        "content": "### \u524d\u8a00\n\n\u8001\u5e08\u7ed9\u7684**\u592f\u57fa\u8bad\u7ec3**\u9898\uff0c\u611f\u89c9\u5df2\u6709\u9898\u89e3\u505a\u6cd5\u590d\u6742\u5ea6\u7a0d\u9ad8\uff0c\u4e3a\u6b64\u4f18\u5316\u4e4b\u3002\n\n### \u4e00\u4e9b\u8bb0\u53f7\n\n* $\\tau(P)$ \u8868\u793a $P$ \u7684\u56e0\u5b50\u4e2a\u6570\uff08\u5373 $\\operatorname{d}(P)$\uff09\u3002\n* $\\omega(P)$ \u8868\u793a $P$ \u7684\u672c\u8d28\u4e0d\u540c\u8d28\u56e0\u5b50\u4e2a\u6570\u3002\n\n### \u601d\u8def\n\n\u628a\u6bcf\u4e2a\u6570 $v$ \u53d8\u4e3a $\\gcd\\{v,P\\}$\uff0c\u663e\u7136\u4e0d\u5f71\u54cd\u7b54\u6848\u3002\n\n\u6b64\u65f6\u6570\u7684\u79cd\u7c7b\u53ea\u6709 $O(\\tau(P))$ \u79cd\u3002\n\n\u5219\u663e\u7136\u6b64\u65f6\u4e00\u79cd\u9009\u6cd5\u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53 $\\gcd\\{v|v\\in\\mathcal B\\}|w$\uff0c\u5176\u4e2d $\\mathcal B$ \u4ee3\u8868\u9009\u62e9\u7684\u6570\u7684\u96c6\u5408\uff08\u80cc\u5305\uff09\u3002\n\n\u6211\u4eec\u8fdb\u884c\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u5219\u6bcf\u4e2a\u6570\u53ef\u88ab\u552f\u4e00\u5206\u89e3\u3002\n\n$$P=\\prod p_k^{a_k},v=\\prod p_k^{b_k}(b_k\\le a_k)$$\n\n\u56e0\u6b64\u5728\u6b64\u610f\u4e49\u4e0b\u6709\u826f\u597d\u7684\u504f\u5e8f\u5173\u7cfb\u3002\n\n\u5b9a\u4e49\u6bcf\u4e2a\u6570 $v$ \u7684\u9009\u6cd5\u7684 GF \u4e3a $z^P+z^v$\u3002\n\n\u4e0d\u59a8\u8003\u8651\u5bf9\u6bcf\u4e2a\u6570\u7684 GF \u5728\u6bcf\u4e2a\u8d28\u6570\u7684\u5e42\u6b21\u4e0a\u540c\u65f6\u505a $\\min$ \u5377\u79ef\uff0c\u5373\u6240\u8c13 $\\gcd$ \u5377\u79ef\u3002\u663e\u7136\u6b64\u65f6\u518d\u505a\u4e00\u6b21 zeta \u53d8\u6362\uff08\u4e5f\u5373 Dirichlet \u524d\u7f00\u548c\uff09\u5373\u5f97\u7b54\u6848\u7cfb\u6570\u3002\n\n$\\gcd$ \u5377\u79ef\u5c31\u548c\u6211\u4eec\u7684\u4ea4 / \u5e76\u5377\u79ef\u7c7b\u4f3c\u4e86\u3002\n\n\u4e8e\u662f\u8003\u8651\u8c03\u7528 CF449D \u7684\u5957\u8def\u3002\n\n$$\\prod z^P+z^v$$\n\n\u5176\u4e2d\u4e58\u6cd5\u6307 $\\gcd$ \u5377\u79ef\u3002\n\n\u6211\u4eec\u628a\u6bcf\u4e2a GF \u7528 FMT \u5728\u6570\u8bba\u4e0a\u505a\u4e00\u904d\uff0c\u9010\u9879\u5206\u522b\u4e58\u8d77\u6765\uff0cIFMT \u56de\u53bb\uff0c\u5c31\u662f $\\gcd$ \u5377\u79ef\uff0c\u4f46\u8fd9\u6837\u590d\u6742\u5ea6\u4e0d\u591f\u4f18\uff08\u4e3a $O(\\min\\{n,\\tau(P)\\}\\tau(P)\\omega(P))$ \u7684\uff0c\u4e5f\u5373**\u6b64\u9898\u5927\u591a\u6570\u9898\u89e3\u7684\u590d\u6742\u5ea6**\uff09\u3002\n\n\u7531\u4e8e\u65e0\u8bba\u54ea\u4e2a\u4f4d\u7f6e\uff0c$z^P$ \u5728 FMT \u540e\u90fd\u4f1a\u5bf9\u4e4b\u65bd\u4ee5\u8d21\u732e\uff0c\u6240\u4ee5\u6bcf\u4e2a $z^v$ \u5728\u5176\u6240\u80fd\u5f71\u54cd\u7684\u8303\u56f4\u7684**\u52a0\u4e0a $1$** \u76f8\u5f53\u4e8e\u628a $1$ \u53d8\u6210 $2$\uff0c\u4e5f\u5373**\u4e58\u4ee5 $2$**\u3002\n\n\u4e8e\u662f\u4e0d\u59a8\u4ee4\u6240\u6709 $v$ \u5bf9 $v$ \u4f4d\u7f6e\u76f4\u63a5\u65bd\u4ee5 $+1$ \u7684\u8d21\u732e\uff0c\u518d\u505a\u4e00\u6b21 FMT\uff0c\u7136\u540e\u5728\u628a\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u503c $a$ \u53d8\u4e3a $2^a$\uff0c\u6700\u540e\u518d IFMT \u56de\u6765\u3002\n\n### \u590d\u6742\u5ea6\u5206\u6790\n\n\u81f3\u6b64\uff0c\u590d\u6742\u5ea6\u4e3a $O(n\\log P+q\\log P+\\tau(P)\\omega(P))$\uff0c\u53ef\u8fd1\u4f3c\u8ba4\u4e3a\u662f $O(n\\log P+q\\log P+P^{\\frac13}\\log\\log P)$\uff0c\u5176\u4e2d $\\log P$ \u56e0\u5b50\u6765\u6e90\u4e8e $\\gcd$ \u9884\u5904\u7406\uff08\u5f53\u7136\uff0c\u662f\u5bf9\u7740 $P$ \u7684\u5206\u89e3\u5f0f\u641e\uff09\u3002\n\n\u5bf9 $P$ \u7684\u8d28\u56e0\u6570\u5206\u89e3\u53ef\u7528 Pollad-Rho \u505a\u5230 $O(P^{\\frac14+\\epsilon})$\uff0c\u6b64\u5904\u4e0d\u8ba1\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u901a\u8fc7\u66f4\u7cbe\u7ec6\u7684\u65b9\u6cd5\uff0c\u5bf9 $n,q$ \u65c1\u7684 $\\log P$ \u56e0\u5b50\u53ef\u4ee5\u4f5c\u51fa\u8fdb\u4e00\u6b65\u4f18\u5316\u3002\n",
        "postTime": 1659080992,
        "uid": 105050,
        "name": "myee",
        "ccfLevel": 7,
        "title": "4495"
    },
    {
        "content": "\u5148\u60f3\u4e00\u4ef6\u4e8b\u60c5\uff1a\u6211\u4eec\u9700\u8981\u4ec0\u4e48\uff1f\n\n\u5982\u679c\u6709\u4e00\u4e2a\u7269\u54c1\u7684\u4f53\u79ef\u4e3a $w$\uff0c\u90a3\u4e48\u4ee4\u4e00\u4e2a\u6570\u4e0d\u65ad\u5730\u52a0\u4e0a $w$\uff0c\u6700\u540e\u4e00\u5b9a\u4f1a\u56de\u5230 $0$\u3002\n\n\u800c\u5bf9\u4e8e\u4e00\u5806\u7269\u54c1\uff0c\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a $w$ \u548c\u8fd9\u4e00\u5806\u7269\u54c1\u7b49\u4ef7\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5982\u679c\u6211\u53d6 $(P-1)$ \u4e2a $w$ \u76f8\u5f53\u4e8e\u53d6\u4e86\u4e00\u4e2a $-w$\u3002\u8fd0\u7528\u88f4\u8700\u5b9a\u7406\u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a $w$ \u4e3a\u8fd9\u4e00\u5806\u7269\u54c1\u7684 $\\gcd$\u3002\n\n\u7136\u540e\u8be2\u95ee\u4e00\u4e2a $p$ \u5173\u5fc3\u7684\u662f\u6709\u591a\u5c11\u79cd\u65b9\u6848\u51d1\u6210\u7684 $w$ \u662f $p$ \u7684\u56e0\u6570\u3002\n\n\u6240\u4ee5\u6211\u4eec\u76f8\u5f53\u4e8e\u8981\u62ff\u4e00\u5806\u6570\u505a\u4e00\u4e2a $\\gcd$ \u80cc\u5305\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u53e6\u4e00\u4ef6\u4e8b\uff0c\u7269\u54c1 $w$ \u548c\u7269\u54c1 $\\gcd(P,w)$ \u7b49\u4ef7\u3002\u6240\u4ee5\u6211\u4eec\u76f8\u5f53\u4e8e\u662f\u62ff\u82e5\u5e72\u4e2a\u6570\uff08\u4e0d\u8d85\u8fc7 $1344$ \u4e2a\uff09\u6765\u505a $\\gcd$ \u80cc\u5305\u3002\u4e8e\u662f\u628a\u6570\u586b\u8fdb\u6876\u4e4b\u540e\u83ab\u53cd\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u8be2\u95ee $p$ \u65f6\u76f8\u5f53\u4e8e\u8be2\u95ee $\\gcd(P,p)$\uff0c\u53ea\u9700\u8981\u4e00\u904d $\\gcd$ \u5373\u53ef\u3002\n\n\u83ab\u53cd\u7684\u8fc7\u7a0b\u6709\u70b9\u513f\u50cf\u5377\u4e0a\u4e00\u4e2a $\\mu$\uff0c\u6240\u4ee5\u5927\u6982\u662f\u53ef\u4ee5\u505a\u5230 $O(\\sigma(P)\\omega(P)+q\\log P)$\uff0c\u5927\u4e0d\u4e86 $O(\\sigma(P)^2+q\\log P)$ \u4e5f\u662f\u7a33\u8fc7\u7684\u3002\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<cctype>\ntypedef unsigned ui;\nconst ui M=1350,mod=1e9+7;\nui n,q,P,m,p[35],k[35],K[35],f[M],id[M],val[M],vis[M];double inv[M];\ninline ui pow(ui a,ui b=mod-2){\n\tui ans(1);for(;b;b>>=1,a=1ull*a*a%mod)if(b&1)ans=1ull*ans*a%mod;return ans;\n}\ninline void Divide(ui n){\n\tfor(ui i=2;i*i<=n;++i)if(!(n%i)){\n\t\tp[++m]=i;inv[m]=1./i+1e-15;while(!(n%i))++k[m],n/=i;\n\t}\n\tif(n^1)p[++m]=n,inv[m]=1./n+1e-15,k[m]=1;K[m+1]=1;for(ui i=m;i>=1;--i)K[i]=K[i+1]*(k[i]+1);\n}\ninline ui Getid(ui V){\n\tui id(0);for(ui i=1;i<=m;++i)for(ui j(1);j<=k[i]&&V==ui(V*inv[i])*p[i];++j)id+=K[i+1],V*=inv[i];return id;\n}\ninline void DFS(const ui&n,ui V,const ui&tag,const ui&id){\n\tif(id==m+1)return vis[n]=tag,val[n]=V,void();\n\tfor(ui i=0;i<=k[id];++i)DFS(n+i*K[id+1],V,tag|((i==k[id])<<id),id+1),V*=p[id];\n}\ninline ui read(){\n\tui n(0);char s;while(!isdigit(s=getchar()));while(n=n*10+(s&15),isdigit(s=getchar()));return n;\n}\ninline void write(ui n){\n\tstatic char s[10];ui top(0);while(s[++top]=n%10^48,n/=10);while(putchar(s[top]),--top);putchar(10);\n}\nsigned main(){\n\tn=read();q=read();P=read();Divide(P);\n\twhile(n--)++f[Getid(read())];DFS(0,1,0,1);for(ui i=0;i<K[1];++i)id[i]=i;\n\tstd::sort(id,id+K[1],[&](const ui&x,const ui&y){return val[x]<val[y];});\n\tfor(ui i=1;i<=m;++i)for(ui x,j=K[1]-1;~j;--j)if(!(vis[x=id[j]]>>i&1))f[x]=(f[x]+f[x+K[i+1]])%mod;\n\tfor(ui i=0;i<K[1];++i)f[i]=(pow(2,f[i])-1);\n\tfor(ui i=1;i<=m;++i)for(ui x,j=0;j<K[1];++j)if(!(vis[x=id[j]]>>i&1))f[x]=(f[x]+mod-f[x+K[i+1]])%mod;\n\tfor(ui i=1;i<=m;++i)for(ui x,j=0;j<K[1];++j)if(!(vis[x=id[j]]>>i&1))f[x+K[i+1]]=(f[x+K[i+1]]+f[x])%mod;\n\twhile(q--)write(f[Getid(read())]);\n}\n```",
        "postTime": 1650335438,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u8bba DP+\u83ab\u53cd P4495\u9898\u89e3"
    },
    {
        "content": "\n### HAOI 2018 \u5947\u602a\u7684\u80cc\u5305\n\n#### \u524d\u8a00\n\n\u7279\u522b\u9e23\u8c22 $\\text{Dxy}$ \u5927\u4f6c\u7684\u5e2e\u52a9\u3002\n\n#### \u4e00\u4e2aYY\u7684\u8bc1\u660e\n\n\u9996\u5148\u7ed9\u51fa\u4e00\u4e2a\u5b9a\u7406\u3002 \n\n> \u5bf9\u4e8e\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u6570 $\\{ v_1,v_2,v_3\u2026v_n|v_i\\in\\mathbb{N}^+\\}$\u3002\n\n> \u5982\u679c $\\gcd(v_1,v_2\u2026v_n)|w$\uff0c\u90a3\u4e48\u4e0b\u9762\u8fd9\u4e2a\u5f0f\u5b50\u4e00\u5b9a\u6210\u7acb\u3002\n\n> $$k_1v_1+k_2v_2+\u2026+k_nv_n=w$$\n\n\u8bbe $\\gcd(v_1,v_2\u2026v_n)=m$\uff0c$l_i=\\dfrac{v_i}{m}$,\u5219\u53ef\u4ee5\u5f97\u5230\u7684\u662f\uff1a\n\n$$k_1v_1+k_2v_2+\u2026+k_nv_n=\\left( k_1l_1+k_2l_2+\u2026+k_nl_n\\right)m$$\n\n$$\\text{\u56e0\u4e3a}\\gcd(v_1,v_2\u2026v_n)|w$$\n\n$$\\therefore w\\  \\text{\u4e3a} \\gcd(v_1,,v_2\u2026v_n) \\text{\u7684\u500d\u6570}$$\n\n$$\\therefore w=(k_1l_1+k_2l_2+\u2026+k_nl_n)m$$\n\n$$\\therefore k_1v_1+k_2v_2+\u2026+k_nv_n=w$$\n\n#### \u601d\u8def\n\n\u9996\u5148\u80af\u5b9a\u662f\u8981\u6c42 $$k_1V_1+k_2V_2+\u2026+k_nV_n=w \\ \\ \\ (\\bmod\\ \\ P)$$\n\n\u7684\u65b9\u6848\u6570\u3002\n\n\u6839\u636e\u4e0a\u9762\u7684\u8bc1\u660e\u53ef\u4ee5\u5f97\u5230\uff0c\u6700\u7ec8\u95ee\u9898\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1a\u6c42\u6709\u591a\u5c11\u4e2a\u96c6\u5408\u6ee1\u8db3 $\\gcd(V_i,P)|w$ \u3002\n\n\u53d1\u73b0\u95ee\u9898\u5176\u5b9e\u8fd8\u53ef\u4ee5\u5316\u7b80\uff0c\u56e0\u4e3a\u5de6\u8fb9\u7684\u5f0f\u5b50\u4e00\u5b9a\u662f $P$ \u7684\u4e00\u4e2a\u56e0\u5b50\uff0c\u800c\u4e14\u8fd9\u4e2a\u56e0\u5b50\u4e00\u5b9a\u4f1a\u51fa\u73b0\u5728 $w$ \u4e2d\u624d\u6709\u53ef\u80fd\u88ab\u6574\u9664\u3002\u6240\u4ee5\u4e5f\u5c31\u662f\u6c42\uff1a\n\n\u6709\u591a\u5c11\u79cd\u96c6\u5408\u6ee1\u8db3 $\\gcd(V_i,P)|\\gcd(w,P)$\n\n\u8fd9\u4e2a\u65f6\u5019\u4f60\u53ef\u80fd\u8981\u95ee\u4e86\uff0c\u4e3a\u4ec0\u4e48\u662f\u6574\u9664 $w$ \u7684\u6700\u5927\u516c\u56e0\u6570\uff0c\u522b\u7684 $P,w$ \u7684\u516c\u5171\u56e0\u5b50\u4e3a\u4ec0\u4e48\u4e0d\u884c\uff1f~~(\u6765\u81ea\u5199\u9898\u89e3\u65f6\u7684\u795e\u5947\u7591\u60d1)~~\n\n\u8fd9\u91cc\u6765\u4e00\u4e2a\u5c0f\u5c0f\u7684\u8bc1\u660e\uff1a\n\n\u6839\u636e\u7b97\u6570\u57fa\u672c\u5b9a\u7406\u53ef\u5f97\uff1a\n\n$$ w=w_1^{c_1}\u00b7w_2^{c_2}\u00b7w_3^{c_3}\u00b7\u2026\u00b7w_n^{c_3},(w_i\\in \\ \\text{prime})$$\n\n$$P=p_1^{k_1}\u00b7p_2^{k_2}\u00b7p_3^{k_3}\u00b7\u2026\u00b7p_n^{k_n},(p_i\\in\\ \\text{prime})$$\n\n\u90a3\u4e48\u6765\u770b $\\gcd(w,P)$\uff1a\n\n$$\\gcd(w,P)=a_1^{b_1}\u00b7a_2^{b_2}\u00b7a_3^{b_3}\u00b7\u2026\u00b7a_n^{b_n},(a_i \\in \\text{}prime)$$\n\n\u4e5f\u5c31\u662f $w,P$ \u7684\u5168\u90e8\u516c\u5171\u90e8\u5206\uff0c\u81f3\u4e8e\u5176\u4ed6\u7684\u66f4\u5c0f\u7684\u56e0\u5b50\uff0c\u4e00\u5b9a\u5305\u542b\u5728 $\\gcd(w,P)$ \u4e2d\uff0c\u4e5f\u5c31\u4e00\u5b9a\u80fd\u6574\u9664 $\\gcd(w,P)$\u3002\n\n**Tip1** \n\n\u56e0\u4e3a\u662f\u4e0e\u6700\u5927\u516c\u7ea6\u6570\u548c\u56e0\u5b50\u6709\u5173\uff0c\u6240\u4ee5\u76f4\u63a5\u8003\u8651\u628a\u6240\u6709\u7684 $V_i$ \u90fd\u8f6c\u5316\u6210 $\\gcd(V_i,P)$ , \u628a $w$ \u8f6c\u5316\u4e3a $\\gcd(w,P)$\u3002\n\n**Tip2**\n\n\u90a3\u4e48\u73b0\u5728\u5c31\u53ef\u4ee5\u8bbe\u65b9\u7a0b\u4e86\uff0c\u9996\u5148**\u9898\u76ee\u7684\u8be2\u95ee\u4e0e\u79cd\u7c7b**\u6709\u5173\uff0c\u90a3\u4e48\u6709\u4e00\u7ef4\u53ef\u4ee5\u662f\u8868\u793a\u79cd\u7c7b\u7684\uff0c\u5176\u6b21\uff0c\u901a\u8fc7\u8f6c\u5316\u7684\u9898\u76ee\u53ef\u4ee5\u5f97\u5230\uff0c\u4e0e**\u96c6\u5408\u4e2d\u7684\u6240\u6709 $V_i$ \u4e0e $P$ \u7684\u6700\u5927\u516c\u7ea6\u6570**\u6709\u5173\uff0c\u6240\u4ee5\u8fd9\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u7ef4\u3002\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u8bbe $f_{i,j}$ \u8868\u793a\u5728\u524d $i$ \u4e2a\u7269\u54c1\u4e2d\u9009\u53d6\u82e5\u5e72\u4e2a\uff0c\u4e0e $P$ \u7684\u6700\u5927\u516c\u7ea6\u6570\u4e3a $j$ \u7684\u65b9\u6848\u6570\u3002\n\n**Tip3**\n\n\u89c2\u5bdf $P$\uff0c\u7531\u4e8e\u4e0a\u9762\u8bb0\u5f55\u7684\u90fd\u662f\u4e0e $P$ \u7684\u56e0\u5b50\u6709\u5173\uff0c\u4e0e $P$ \u672c\u8eab\u7684\u5173\u7cfb\u4e0d\u5927\uff0c\u6240\u4ee5\u5c31\u8003\u8651\u628a $P$ \u7684\u56e0\u5b50\u8bb0\u5f55\u4e0b\u6765\uff0c\u65b9\u4fbf\u4f7f\u7528\u3002\n\n\u4f46\u662f\u770b\u5230 $P\\leq 10^9$ \u5e76\u4e14 $P=998244353$ \u7684\u65f6\u5019\u56e0\u5b50\u662f $998244353$ \u5de8\u5927\uff0c\u8981\u662f\u628a\u56e0\u5b50\u5f53\u505a\u4e0b\u6807\u80af\u5b9a\u662f\u5b58\u4e0d\u4e0b\u7684\uff0c\u6b64\u5904\u79bb\u6563\u5316\u5373\u53ef\uff0c\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7136\u540e\u79bb\u6563\u4e3a\u6392\u540d\u5373\u53ef\u3002\n\n\u770b $V_i$\uff0c\u4e3a\u4e86\u51cf\u5c11\u679a\u4e3e\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u8003\u8651\u628a $\\gcd(V_i,P)$ \u76f8\u540c\u7684\u7269\u54c1\u5408\u5e76\uff0c\u8bbe\u6570\u7ec4\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u76f8\u540c\u7684\u91cf\u5373\u53ef\u3002\n\n**\u6ce8\uff1a** \u4ee5\u4e0b\u7684 $V_i$ \u5168\u90e8\u8868\u793a $\\gcd(V_i,P)$\u3002\n\n**Tip4**\n\n\u6839\u636e\u63d0\u793a\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bcf\u4e00\u79cd\u53ef\u4ee5\u6709\u9009\u548c\u4e0d\u9009\u4e24\u79cd\u72b6\u6001\uff0c\u901a\u8fc7 **Tip3** \u4e2d\u7684\u9884\u5904\u7406\uff0c\u53ef\u4ee5\u8003\u8651\u9884\u5904\u7406 $2^k$\uff0c\u56e0\u4e3a\u5c06\u76f8\u540c $\\gcd(V_i,P)$ \u5408\u5e76\u4ee5\u540e\u53ef\u80fd\u4f1a\u6709\u5f88\u591a\u79cd\uff0c\u9884\u5904\u7406\u53ef\u4ee5\u51cf\u5c11\u591a\u4f59\u7684\u679a\u4e3e\u6c42\u77e5\u3002\n\n**Tip5**\n\n\u601d\u8003\u5982\u4f55\u8f6c\u79fb\u3002\n\n\u6839\u636e\u8bbe\u7684\u72b6\u6001\u5f88\u663e\u7136\u662f\u4e24\u5c42\u5faa\u73af\uff0c\u5916\u5c42\u679a\u4e3e\u5408\u5e76\u540e\u7684 $\\gcd(V_i,P)$ \u5185\u5c42\u679a\u4e3e\u79bb\u6563\u5316\u540e\u7684 $P$ \u56e0\u5b50\u6570\u7ec4\u3002\n\n\u56de\u89c2\u6211\u4eec\u7684\u72b6\u6001 $f_{i,j}$ \u662f\u8868\u793a\u524d $i$ \u4e2a\u4e2d\u9009\u62e9\u82e5\u5e72\u4e2a\uff0c\u7136\u800c\u5e76\u6ca1\u6709\u9650\u5236\u5168\u90e8\u9009\u62e9\uff0c\u6240\u4ee5\u5728\u987a\u5e8f\u679a\u4e3e\u5916\u5c42\u7684\u65f6\u5019\uff0c\u8bb0\u5f97\u8981\u9012\u63a8\u5408\u5e76\u4e0a\u4e00\u6b65\u7684\u5f0f\u5b50\uff0c\u4e5f\u5c31\u662f\uff1a\n\n$$f_{i-1,j}\\to f_{i,j} $$\n\n\u518d\u8003\u8651\u53e6\u5916\u7684\u8f6c\u79fb\uff1a\n\n\u8bbe $k=\\gcd(V_i\uff0cp_i)$ \u5176\u4e2d $p_i$ \u662f $P$ \u7684\u4e00\u4e2a\u56e0\u5b50\u3002\n\n\u53ef\u4ee5\u5f97\u5230\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_{i-1,j}\u00b7\\left( 2^{cnt_i}-1\\right)\\to f_{i,j}$$\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u51cf\u4e00\uff0c\u56e0\u4e3a\u8fd9\u662f\u9009\u62e9\u82e5\u5e72 $V_i$ \u7684\u8f6c\u79fb\uff0c\u6240\u4ee5\uff0c\u4e0d\u53ef\u80fd\u4f1a\u51fa\u73b0\u5168\u90e8\u4e0d\u9009\u8fd9\u79cd\u60c5\u51b5\uff0c\u56e0\u6b64\u8981\u51cf\u4e00\u3002\n\n**Tip6**\n\n\u6700\u540e\u4e00\u6b65\u5408\u5e76\u7b54\u6848\u3002\n\n$\\text{ans}$ \u6570\u7ec4\u7684\u4e0b\u6807\u4e00\u5b9a\u662f $\\gcd(w,P)$ \u65e0\u7591\u4e86\uff0c\u90a3\u4e48\u5c31\u679a\u4e3e $P$ \u7684\u56e0\u5b50\uff0c\u770b\u4e00\u770b\u90a3\u4e9b\u53ef\u4ee5\u6574\u9664 $\\gcd(w,P)$ \u5408\u5e76\u4e0a\u53bb\u5373\u53ef\u3002\n\n#### \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n#include<map>\nusing namespace std;\nconst int N=1e6+9;\nconst int K=1e5+9;\nconst int M=2e3+9; \nconst int mod=1e9+7;\nint n,v[N],q,P;\nint poi[M];//\u8fd9\u662fP\u7684\u56e0\u5b50(:\nint kar;//poi\u7684\u8ba1\u6570\u5668 \nint cnt[M];//\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u679a\u4e3e\uff0c\u8bb0\u5f55\u76f8\u540c\u7684v\u7684_gcd \nint top;//\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u7684gcd \nmap<int,int> pi;//\u8bb0\u5f55P\u7684\u8d28\u56e0\u5b50\u6709\u54ea\u4e9b\nint pow2[K];\nint f[M][M];//\u5728\u524di\u4e2av\u4e2d\u9009\u62e9\u4e86\u82e5\u5e72\u4e2a,v\u7684gcd\u662fj\u7684\u65b9\u6848\u6570\u3002 \nint ans[M];\nint read()\n{\n\tint f=1,x=0;\n\tchar s=getchar();\n\twhile(s<'0'||s>'9'){if(s=='-')f=-1;s=getchar();\t} \n\twhile(s>='0'&&s<='9'){x=(x<<1)+(x<<3)+(s^'0');s=getchar();}\n\treturn f*x;\n} \nint gcd(int a,int b)\n{\n\tif(!b) return a;\n\telse return gcd(b,a%b); \n}\nvoid Madev()\n{\n\tsort(v+1,v+1+n);//\u5148\u6392\u5e8f\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(v[i]!=v[i-1])//\u51fa\u73b0\u65b0\u7684gcd\n\t\t{\n\t\t\tv[++top]=v[i];//\u91cd\u65b0\u8bb0\u5f55/qq \n\t\t\tcnt[top]++;\n\t\t}\n\t\telse cnt[top]++;\n\t}\n} \nvoid MadeP()//\u5904\u7406P\u7684\u56e0\u5b50 \n{\n\t//\u7528\u83ab\u53cd\u7684\u65b9\u6cd5\uff0c\u5c06\u5904\u7406\u56e0\u5b50\u5316\u4e3a sqrt(P) \u7684\u65f6\u95f4\u590d\u6742\u5ea6 \n\tfor(int i=1;i*i<=P;i++)//1\u4e5f\u662f\u4e00\u4e2a\u56e0\u5b50,\u7528sqrt(P)\u6d6a\u8d39\u65f6\u95f4\n\t{\n\t\tif(P%i==0)\n\t\t{\n\t\t\tpoi[++kar]=i;\n\t\t\tif(i*i!=P)\n\t\t\t\tpoi[++kar]=P/i;\n\t\t\t//\u53ef\u4ee5\u540c\u65f6\u627e\u5230\u4e24\u4e2a\u56e0\u5b50\uff0c\u590d\u6742\u5ea6-- \n\t\t}\n\t}\n\tsort(poi+1,poi+1+kar);\n\t//\u56e0\u4e3a\u8003\u8651\u5230gcd\u53ef\u80fd\u4f1a\u5f88\u5927\uff0c\u4e3a\u4e86\u51cf\u5c11\u5f00\u5185\u5b58\u7684\u65f6\u95f4\u548c\u7a7a\u95f4\u5f00\u9500\uff0c\u79bb\u6563\u5316\uff0c\n\t//\u7528unodered_map\u66f4\u5feb \uff0c\u5927\u4e0d\u4e86\u81ea\u5df1\u624b\u5199=_=;\n\tfor(int i=1;i<=kar;i++)\n\t\tpi[poi[i]]=i;//\u79bb\u6563\u5316\u3002 \n}\nvoid Madetwo()\n{\n\tpow2[0]=1;\n\tfor(int i=1;i<=100000;i++)//\u4e71\u731c\u56e0\u5b50\u4e2a\u6570\uff0cP^{1/3}\u5de6\u53f3\n\t\tpow2[i]=pow2[i-1]*2%mod;//Wrong:\u5929\u624d*i \n} \nvoid prepare()\n{\n\tfor(int i=1;i<=n;i++)\n\t\tv[i]=gcd(read(),P);//\u76f4\u63a5\u9884\u5904\u7406\u6210\u6700\u5927\u516c\u56e0\u6570\n\tMadev();//\u5bf9v\u8fdb\u884c\u53bb\u91cd\uff0c\u672c\u9898\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u5141\u8bb8\u8fc7\u591a\u5197\u6742\u72b6\u6001\n\tMadeP();\n\tMadetwo(); \n\t//\u56e0\u4e3a\u9009\u62e9\u80af\u5b9a\u662f 2^n\u7684\u9009\u62e9\uff0c\u9884\u5904\u7406pow2\uff1b \n}\n//-----------------------\u9884\u5904\u7406\u90e8\u5206--------------------------- \nvoid DP()\n{\n\tf[0][kar]=1;//\u552f\u4e00\u80fd\u60f3\u5230\u7684\u9884\u5904\u7406/kk\n\t//\u522b\u5199\u6210f[0][P]? 998244353\u6491\u4e0d\u4e0b \n\tfor(int i=1;i<=top;i++)//\u679a\u4e3e v\n\t \tfor(int j=1;j<=kar;j++)//\u679a\u4e3e poi,P\u7684\u56e0\u5b50\n\t\t{\n\t\t\tint k=pi[gcd(v[i],poi[j])];\n\t\t\tf[i][j]+=f[i-1][j];//\u5237\u8868\u9012\u63a8\n\t\t\tif(f[i][j]>=mod)\n\t\t\t\tf[i][j]%=mod;\n\t\t\tf[i][k]=f[i][k]+(1ll*f[i-1][j]*(pow2[cnt[i]]-1)%mod);//\u6839\u636e\u65b9\u6848\u6570\u5408\u5e76\n\t\t\t//\u6ce8\u610f\u4e0d\u80fd\u5565\u4e5f\u4e0d\u9009\uff0c\u6240\u4ee5\u8981-1\u8fd9\u4e2a\u65b9\u6848\u6570 \n\t\t\tif(f[i][k]>=mod)\n\t\t\t\tf[i][k]%=mod; \n\t\t}\n\tfor(int i=1;i<=kar;i++)\n\t\tfor(int j=1;j<=i;j++)\n\t\t\tif(poi[i]%poi[j]==0)\n\t\t\t{\n\t\t\t\tans[i]=ans[i]+f[top][j];//Wrong \u60f3\u5f53\u7136\u5199\u6210 n \u5e94\u8be5\u662f top\n\t\t\t\tif(ans[i]>=mod)\n\t\t\t\t\tans[i]%=mod;\t\n\t\t\t} \n\t\t\t\n\treturn;\n}\nint main()\n{\n\tn=read();\n\tq=read();//\u8be2\u95ee \n\tP=read();//\u6a21\u6570 \n\tprepare();\n\tDP();\n\twhile(q--)\n\t{\n\t\tint opt=read();\n\t\tprintf(\"%d\\n\",ans[pi[gcd(opt,P)]]);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1620303204,
        "uid": 230804,
        "name": "Durancer",
        "ccfLevel": 4,
        "title": "\u3010\u9898\u89e3\u3011P4495 [HAOI2018]\u5947\u602a\u7684\u80cc\u5305"
    },
    {
        "content": "\u8003\u8651\u65b9\u7a0b $ax+by=\\gcd(x,y)$\uff0c\u88f4\u8700\u5b9a\u7406\u544a\u8bc9\u6211\u4eec\u5b83\u603b\u662f\u6709\u89e3\u7684\n\n\u540c\u65f6\uff0c\u4e0d\u96be\u53d1\u73b0\u67e5\u8be2\u7684 $w_i$ \u4ee5\u53ca\u53ef\u4ee5\u4f7f\u7528\u7684 $v_i$ \u5747\u53ef\u4ee5\u89c6\u4e3a $\\gcd(x,P)$\uff0c\u8fd9\u5bf9\u4e8e\u7b54\u6848\u662f\u6ca1\u6709\u5f71\u54cd\u7684\u3002\u539f\u56e0\u662f\u88f4\u8700\u5b9a\u7406\u3002\u4e0d\u59a8\u8bbe $a_i=\\gcd(v_i,P)$\n\n\u5047\u8bbe\u4f7f\u7528\u4e86\u82e5\u5e72\u4e2a\u6570\uff0c\u4ecd\u7136\u7531\u4e8e\u88f4\u8700\u5b9a\u7406\uff0c\u6211\u4eec\u53d1\u73b0\u4f7f\u7528\u82e5\u5e72\u4e2a\u6570\u7b49\u4ef7\u4e8e\u4f7f\u7528\u82e5\u5e72\u4e2a $\\gcd(a_{i_1},a_{i_2}...a_{i_m})$\uff0c\u4e8e\u662f\u67e5\u8be2\u7b49\u4ef7\u4e8e\u7ed9\u5b9a $x$ \u6c42\u6709\u591a\u5c11\u79cd\u65b9\u5f0f\u9009\u51fa\u82e5\u5e72\u4e2a\u6570\u4f7f\u5f97 $\\gcd(a,b,c...)|x$\n\n\u5bf9 P \u5206\u89e3\u8d28\u56e0\u6570\uff0c~~\u4e3a\u4e86\u953b\u70bc\u4ee3\u7801\u80fd\u529b\u6211\u9009\u62e9 PR~~\uff0c\u679a\u4e3e\u6bcf\u4e2a\u7ea6\u6570\uff0c\u5219\u53ea\u9700\u8981\u7edf\u8ba1\u6709\u591a\u5c11\u79cd\u65b9\u6848\u9009\u51fa\u82e5\u5e72\u4e2a\u6570\u4f7f\u5f97 $\\gcd(a,b,c..)=d$\n\n\u8003\u8651\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u8bbe $F(x)$ \u4e3a $\\gcd$ \u81f3\u5c11\u4e3a $x$ \u7684\u65b9\u6848\u6570\uff0c\u5219\u6709 $F(x)=2^{cnt_x}$\uff0c\u4e14 $f(x)=\\sum_{x|d}F(d)\\mu(\\frac{d}{x})$\n\n\u5bb9\u6613\u53d1\u73b0\u5408\u6cd5\u7684 $d$ \u4ee5\u53ca $\\frac{d}{x}$ \u90fd\u662f $P$ \u7684\u7ea6\u6570\u4e14\u4e0d\u542b $P$ \u672c\u8eab\uff0c\u6211\u4eec\u6ce8\u610f\u5230 $\\sigma(P)$ \u5728 $10^9$ \u8303\u56f4\u5185\u6700\u5927\u4e3a $1344$\uff0c\u6240\u4ee5\u76f4\u63a5 $\\mathcal O(\\sigma(P)^2)$ \u66b4\u529b\u5373\u53ef\uff0c\u590d\u6742\u5ea6\u4e3a $\\mathcal O(\\sigma(P)^2+(n+m)\\log P)$\n\n\u4e0d\u8fc7\u7531\u4e8e\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u672c\u8d28\u4e0a\u5c31\u662f\u5bb9\u65a5\u7cfb\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5bb9\u65a5\u3002\n\n\u4e0d\u8fc7\u7531\u4e8e\u8981\u8bbf\u95ee\u975e\u8fde\u7eed\u7684\u4e0b\u6807...\u6211\u76f4\u63a5\u7528\u4e86\u4e00\u4e2a $\\rm map$\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define int long long\nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int N = 2000 + 5 ; \nconst int M = 1e6 + 5 ; \nconst int mod = 1e9 + 7 ; \nint n, q, P, st[N], c[N], D[N], f[N], F[N], num, top, cnt ; \nint w[M] ; \nmap<int, int> o, id ;\nint fpow( int x, int k, int p ) {\n\tint ans = 1, base = x ; \n\twhile( k ) {\n\t\tif( k & 1 ) ans = 1ll * ans * base % p ;\n\t\tbase = 1ll * base * base % p, k >>= 1 ; \n\t} return ans ; \n}\nint SD( int x ) {\n\treturn 1ll * ( ( 1ll * rand() << 15ll ) | rand() ) % x ; \n}\nbool M_R( int p ) {\n\tif( p == 2 || p == 3 ) return 1 ;\n\tif( p == 1 || ( p % 2 ) == 0 ) return 0 ; \n\tint d = p - 1, s = 0 ; \n\twhile( !(d & 1) ) ++ s, d >>= 1 ; \n\trep( i, 0, 7 ) {\n\t\tre int a = SD( p - 3 ) + 2, x = fpow( a, d, p ), y = 0 ;\n\t\tfor( re int j = 0; j < s; ++ j ) {\n\t\t\ty = 1ll * x * x % p ; if( ( y == 1 ) && ( x != 1 ) && ( x != p - 1 ) ) return 0 ;\n\t\t\tx = y ; \n\t\t} if( y != 1 ) return 0 ; \n\t} return 1 ; \n}\nint gcd( int x, int y ) {\n\treturn ( x == 0 ) ? y : gcd( y % x, x ) ;\n} \nint work( int p ) {\n\tint k = 2, x = SD( p - 1 ) + 1, y = x, d = 1, c = SD(p - 1) + 1 ;\n\tfor( re int i = 1; d == 1; ++ i ) {\n\t\tx = ( 1ll * x * x + c ) % p, d = gcd( (x > y) ? x - y : y - x, p ) ;\n\t\tif( i == k ) y = x, k <<= 1 ; \n\t} return d ; \n}\nvoid Pollard_Rho( int p ) {\n\tif( p == 1 ) return ; \n\tif( M_R(p) ) { st[++ top] = p ; return ; }\n\tint x = p ; while( x == p ) x = work(p) ;\n\tPollard_Rho(p / x), Pollard_Rho(x) ;\n}\nvoid dfs( int x, int d ) {\n\tif( x == num + 1 ) { D[++ cnt] = d ; return ; }\n\tint t = 1 ; \n\trep( k, 0, c[x] ) dfs( x + 1, d * t ), t = t * w[x] ;\n}\nsigned main()\n{\n\tn = gi(), q = gi(), P = gi() ; \n\tPollard_Rho(P) ; \n\tsort( st + 1, st + top + 1 ) ;\n\trep( i, 1, top ) ( st[i] == st[i - 1] ) ? ++ c[num] : c[++ num] = 1, w[num] = st[i] ;\n\tdfs( 1, 1 ), sort( D + 1, D + cnt + 1 ), -- cnt ;\n\tw[0] = 1 ; int x ; \n\trep( i, 1, n ) x = gi(), ++ o[gcd( x, P )], w[i] = w[i - 1] * 2 % mod ; \n\trep( i, 1, cnt ) {\n\t\trep( j, i, cnt ) if( D[j] % D[i] == 0 ) F[i] += o[D[j]] ;\n\t\tF[i] = w[F[i]] - 1, id[D[i]] = i ; \n\t}\n\tdrep( i, 1, cnt ) {\n\t\tf[i] = F[i] ; \n\t\trep( j, i + 1, cnt ) if( D[j] % D[i] == 0 ) f[i] = ( f[i] - f[j] + mod ) % mod ; \n\t}\n\tdrep( i, 1, cnt ) rep( j, i + 1, cnt ) if( D[j] % D[i] == 0 ) f[j] = ( f[j] + f[i] ) % mod ; \n\trep( i, 1, q ) x = gi(), printf(\"%lld\\n\", f[id[gcd( x, P )]] ) ;\n\treturn 0 ;\n}\n```",
        "postTime": 1592573766,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4495 \u3010[HAOI2018]\u5947\u602a\u7684\u80cc\u5305\u3011"
    },
    {
        "content": "\u7701\u9009 D1T1 \u90fd\u4e0d\u592a\u4f1a\u505a\u4e86\u5c5e\u4e8e\u662f\u3002\u3002\u3002\n\n\u9996\u5148\u8bbe\u4f60\u9009\u7684\u7269\u54c1\u96c6\u5408\u4e3a $S$\uff0c\u5bf9\u4e8e\u7b2c $j$ \u4e2a\u8be2\u95ee\uff0c\u5bb9\u6613\u5f97\u51fa\u8fd9\u4e2a\u96c6\u5408\u5408\u6cd5\u9700\u8981\u6ee1\u8db3 $\\gcd_{i\\in S}\\{\\gcd(V_i,P)\\}|\\gcd(w_j,P)$ \u8fd9\u4e2a\u6761\u4ef6\u3002\n\n\u8bc1\u660e\u7528\u88f4\u8700\u5b9a\u7406\u968f\u4fbf\u8bc1\u8bc1\u5373\u53ef\u3002\n\n\u7531\u4e8e $d(P)$ \u5f88\u5c0f\uff0c\u6700\u591a\u53ea\u6709 $1344$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e2a $\\gcd_{i\\in S}\\{\\gcd(V_i,P)\\}$ \u7684\u6570\u91cf\u6700\u540e $O(1)$ \u5904\u7406\u6bcf\u4e2a\u8be2\u95ee\u3002\n\n\u9884\u5904\u7406\u4e0d\u96be\u60f3\u5230 dp\uff0c\u8bbe $dp_{i,j}$ \u4e3a\u4ece\u524d $i$ \u4e2a\u6570\u4e2d\u9009\u4e86\u82e5\u5e72\u4e2a\u6570\u4f5c\u4e3a\u96c6\u5408\u4e14\u96c6\u5408\u5185\u7684\u6240\u6709\u5143\u7d20\u6240\u4ee3\u8868\u7684\u4f53\u79ef\u7684 $\\gcd$ \u4e3a $j$\uff0c\u4e00\u5f00\u59cb $dp_{0,P}=1$\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\u4e0d\u96be\u5217\u51fa\uff0c\u4e14\u7b2c\u4e8c\u7ef4\u6709\u7528\u7684\u5176\u5b9e\u5f88\u5c11\uff0c\u6240\u4ee5\u6211\u4eec\u7528 unordered_map \u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u6570\u6240\u4ee3\u8868\u7684\u7b2c\u4e8c\u7ef4\u7684\u7f16\u53f7\u5373\u53ef\u3002\n\n\u4f46\u662f\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8fd9\u662f $O(nd(P))$ \u7684\uff0c\u53ea\u80fd\u62ff $80$ \u5206\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0 $\\gcd(V_i,P)$ \u7684\u4e0d\u540c\u6570\u91cf\u5176\u5b9e\u4e5f\u662f\u6700\u591a\u53ea\u6709 $d(P)$ \u79cd\u7684\uff0c\u4e14\u4e00\u65e6\u9009\u4e86\u8fd9\u4e00\u79cd\u6570\uff0c\u540e\u9762\u65e0\u8bba\u9009\u591a\u5c11\u4e0e\u5b83\u76f8\u540c\u7684\u6570\u5176\u5b9e\u90fd\u662f\u7b49\u4ef7\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5168\u7a0b\u6309\u503c\u57df\u8fdb\u884c dp,\u5176\u5b9e\u5c31\u662f\u628a\u72b6\u6001\u7684\u7b2c\u4e00\u7ef4\u7684\u524d $i$ \u4e2a\u6570\u6539\u6210\u524d $i$ \u79cd\u503c\u5373\u53ef\uff0c\u540c\u65f6\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u9700\u8981\u7a0d\u5fae\u7684\u6539\u4e00\u4e0b\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(d(P)^2+(n+q)\\log P+\\sqrt P)$\u3002\n# AC code:\n```cpp\ninline int gcd(int x,int y){int z;while(y) z=x,x=y,y=z%y;return x;}\nump<int,int> mp;\nint a[1350],dp[1350][1350],sum[1350],mi[1000005];\ninline int rmod(int x){if(x>=mod) return x-mod;return x;}\nint main(){\n\tint n=read(n),q=read(q),p=read(p),cnt=0,i,j;\n\tmi[0]=1;for(i=1;i<=n;i++) mi[i]=rmod(mi[i-1]<<1);\n\tfor(i=1;i*i<=p;i++) if(!(p%i)){a[++cnt]=i;if(i*i^p) a[++cnt]=p/i;}\n\tsort(a+1,a+cnt+1);for(i=1;i<=cnt;i++) mp[a[i]]=i;\n\twhile(n--){int x=read(x);sum[mp[gcd(x,p)]]++;}dp[0][cnt]=1;\n\tfor(i=1;i<=cnt;i++) for(j=1;j<=cnt;j++){\n\t\tint tmp=gcd(a[i],a[j]);\n\t\tdp[i][j]=rmod(dp[i][j]+dp[i-1][j]);\n\t\tdp[i][mp[tmp]]=(dp[i][mp[tmp]]+(ll)dp[i-1][j]*(mi[sum[i]]-1))%mod;\n\t}\n\tfor(i=cnt-1;i;i--) for(j=i+1;j<=cnt;j++) if(!(a[j]%a[i])) dp[cnt][j]=rmod(dp[cnt][j]+dp[cnt][i]);\n\twhile(q--){int x=read(x);print(dp[cnt][mp[gcd(x,p)]]),enter;}\n\treturn 0;\n}\n```\n",
        "postTime": 1644080371,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4495"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problemnew/show/P4495)\n\n\u66b4\u529b$dp$\u597d\u6709\u9053\u7406\u554a\n\n\u4e8e\u662f\u6211\u4eec\u6765\u4e2a\u53cd\u6f14\u5427\n\n\u8003\u8651\u4e00\u4e2a\u4f53\u79ef\u5e8f\u5217$\\{v_1,v_2,...v_n\\}$\u80fd\u51d1\u6210$w$\u7684\u6761\u4ef6\n\n\u663e\u7136\u662f\n\n$$v_1x_1+v_2x_2+...+v_nx_n\\equiv w(mod\\ P)$$\n\n\u6839\u636e\u8d1d\u7956\u5b9a\u7406\uff0c\u6211\u4eec\u77e5\u9053\u4e0a\u9762\u7684\u540c\u4f59\u65b9\u7a0b\u6709\u89e3\u7684\u6761\u4ef6\u662f\n\n$$gcd(v_1,v_2...v_n,P)|w$$\n\n\u73b0\u5728\u9898\u76ee\u8f6c\u5316\u6210\u4e86\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u96c6\u6ee1\u8db3$gcd(v_1,v_2..v_n,P)|w$\u4e86\n\n\u663e\u7136\u4e00\u4e2a\u66b4\u529b$dp$\u8bb0\u5f55\u4e00\u4e0b\u5f53\u524d$gcd$\u8f6c\u79fb\u5c31\u597d\u4e86\uff0c\u7531\u4e8e$gcd$\u5fc5\u7136\u662f$P$\u7684\u7ea6\u6570\uff0c$P$\u7684\u7ea6\u6570\u662f$\\sqrt{P}$\u7ea7\u522b\uff0c\u6211\u4eec\u6211\u4eec\u53ea\u5b58\u8fd9\u4e9b\u6709\u7528\u7684\u72b6\u6001\uff0c\u4e4b\u540e\u6bcf\u6b21\u66b4\u529b\u8f6c\u79fb\u5c31\u597d\u4e86\uff0c\u590d\u6742\u5ea6$O(n\\sqrt{P})$\u5c31\u6ca1\u4e86\n\n\u4f46\u662f\u6211\u4eec\u6765\u53cd\u6f14\u4e00\u6ce2\u5427\n\n\u8bbe$F(n)$\u8868\u793a\u6709\u591a\u5c11\u4e2a\u5b50\u96c6\u7684$gcd$\u662f$n$\u7684\u500d\u6570\uff0c$f(n)$\u8868\u793a\u6709\u591a\u5c11\u4e2a\u5b50\u96c6\u7684$gcd$\u662f$n$\n\n\u975e\u5e38\u663e\u7136\u5b58\u5728\n\n$$F(n)=\\sum_{n|d}f(d)$$\n\n\u53cd\u6f14\u53ef\u5f97\n\n$$f(n)=\\sum_{n|d}F(d)\\mu(\\frac{d}{n})$$\n\n$F(n)$\u6211\u4eec\u968f\u4fbf\u641e\u4e00\u641e\u5c31\u597d\u4e86\uff0c\u82e5\u6709$s$\u4e2a\u6570\u90fd\u6709$n$\u8fd9\u4e2a\u7ea6\u6570\uff0c\u90a3\u4e48$F(n)=2^s-1$\n\n\u4e4b\u540e\u53cd\u6f14\u5f97\u5230$f$\uff0c\u8fd9\u91cc\u76f4\u63a5\u679a\u4e3e$P$\u7684\u7ea6\u6570\uff0c\u590d\u6742\u5ea6\u662f$O(\\sigma^2(P))$\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u9700\u8981\u6c42\u4e00\u4e2a$\\mu$\uff0c\u914d\u5408\u7ebf\u7b5b\u9884\u5904\u7406\u8fd8\u662f\u633a\u5feb\u7684\n\n\u6700\u540e\u6211\u4eec\u7684\u7b54\u6848\u662f\n\n$$Ans(n)=\\sum_{d|n}f(d)$$\n\n\u6211\u4eec\u7d2f\u52a0\u4e00\u904d\u5c31\u597d\u4e86\n\n\u590d\u6742\u5ea6\u5f88\u7384\u5b66\uff0c\u6bd5\u7adf\u6709\u4e00\u4e2a$\\mu$\u9700\u8981\u6c42\uff0c\u53ef\u80fd\u662f$O(\\sigma^2(P)\\sqrt{P})$\n\n\u4ee3\u7801\n\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<cmath>\n#define re register\n#define LL long long\n#define max(a,b) ((a)>(b)?(a):(b))\n#define min(a,b) ((a)<(b)?(a):(b))\nconst int maxn=1e6+5;\nconst int mod=1e9+7;\nconst int M=2e5+5;\ninline int read() {\n    char c=getchar();int x=0;while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9') x=(x<<3)+(x<<1)+c-48,c=getchar();return x;\n}\nint d[M],F[M],ans[M],f[M],g[M];\nint pw[maxn],a[maxn];\nint n,m,P,Sqr,tot;\nint is[M],p[M>>1],mu[M],id2[M],id1[M];\ninline int find(int x) {return (x<=Sqr)?id1[x]:id2[P/x];}\ninline int gcd(int a,int b) {return !b?a:gcd(b,a%b);}\ninline void Init() {\n    is[1]=1;mu[1]=1;\n    for(re int i=2;i<=Sqr;i++) {\n        if(!is[i]) p[++p[0]]=i,mu[i]=-1;\n        for(re int j=1;j<=p[0]&&p[j]*i<=Sqr;j++) {\n            is[p[j]*i]=1;\n            if(i%p[j]==0) break;\n            mu[p[j]*i]=-1*mu[i];\n        }\n    }\n    for(re int i=1;i<=tot;i++) \n    if(d[i]<=Sqr) id1[d[i]]=i;\n        else id2[P/d[i]]=i;\n}\ninline int getMu(int x) {\n    if(x<=Sqr) return mu[x];\n    int now=1,t=x;\n    for(re int i=1;p[i]*p[i]<=t&&i<=p[0];i++)\n    if(x%p[i]==0) {\n        x/=p[i];\n        if(x%p[i]==0) return 0;\n        now=-1*now;\n        if(x==1) break;\n    }\n    if(x!=1) now=-1*now;\n    return now;\n}\nint main() {\n    n=read(),m=read(),P=read();\n    for(re int i=1;i*i<=P;i++)\n    if(P%i==0) {\n        d[++tot]=i;\n        if(i!=P/i) d[++tot]=P/i;\n    }\n    pw[0]=1;\n    for(re int i=1;i<=n;i++) pw[i]=(pw[i-1]+pw[i-1])%mod;\n    for(re int i=1;i<=n;i++) a[i]=read();\n    std::sort(d+1,d+tot+1);\n    Sqr=std::sqrt(P);Init();\n    for(re int i=1;i<=n;i++) {\n        int k=gcd(a[i],P);\n        g[find(k)]++;\n    }\n    for(re int i=1;i<=tot;i++)\n        for(re int j=i;j<=tot;j++) {\n            if(d[j]%d[i]) continue;\n            F[i]+=g[j];\n        }\n    for(re int i=1;i<=tot;i++) F[i]=pw[F[i]]-1;\n    for(re int i=1;i<=tot;i++)\n        for(re int j=i;j<=tot;j++) {\n            if(d[j]%d[i]) continue;\n            f[i]+=F[j]*getMu(d[j]/d[i]);\n            f[i]%=mod;\n            f[i]=(f[i]+mod)%mod;\n        }\n    for(re int i=1;i<=tot;i++)\n        for(re int j=i;j<=tot;j++) {\n            if(d[j]%d[i]) continue;\n            ans[j]=(ans[j]+f[i])%mod;\n        }\n    for(re int i=1;i<=m;i++) {\n        int x=read();\n        int k=gcd(x,P);\n        printf(\"%d\\n\",ans[find(k)]);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1553483693,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4495 \u3010[HAOI2018]\u5947\u602a\u7684\u80cc\u5305\u3011"
    },
    {
        "content": "\u6570\u8bba\u9898\uff08\u7b2c\u4e00\u6b21\u6ca1\u770b\u9898\u89e3\u8036\uff09...\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u7269\u54c1\u53ef\u4ee5\u653e\u65e0\u9650\u591a\u6b21\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u6c5f a[i] \u89c6\u4f5c \u4e0e a[i] \u4e0e p \u7684 $gcd$, \u53ea\u8981\u662f\u8fd9\u4e2a $gcd$ \u7684\u500d\u6570\u7684\u6570, a[i] \u90fd\u80fd\u8868\u793a\uff08\u6570\u8bba\u57fa\u7840\uff09\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u8bfb\u5165 a[i] \u7684\u65f6\u5019\uff0c\u76f4\u63a5\u6c5f\u5176\u5904\u7406\u4e3a $gcd(a[i],p)$ \u5373\u53ef\n\n\u8fd9\u70b9\u76f8\u4fe1\u5927\u5bb6\u90fd\u80fd\u591f\u63a8\u5bfc\u5230\uff0c\u63a5\u4e0b\u6765\u7684\u63a8\u5bfc\u4e5f\u5e76\u4e0d\u56f0\u96be\n\n1. \u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u5230 a[i] \u7684\u53d6\u503c\uff0c\u6211\u4eec\u53d1\u73b0 a[i] \u53ea\u53ef\u80fd\u662f p \u7684\u7ea6\u6570\uff08\u8c8c\u4f3c\u5f88\u663e\u7136\uff09\uff0c\u800c p \u7684\u7ea6\u6570\u5728 1e9 \u8303\u56f4\u5185\u4e0d\u5230 2000 \u4e2a\uff08\u636e\u67d0\u5927\u4f6c\u7edf\u8ba1\u8c8c\u4f3c\u8fde1400\u90fd\u4e0d\u5230\uff09\n\n2. \u6211\u4eec\u518d\u8003\u8651\u4e24\u4e2a\u6570 a[i], a[j] \u80fd\u8868\u793a\u54ea\u4e9b\u6570\uff0c\u5176\u5b9e a[i], a[j] \u53ef\u4ee5\u8868\u793a\u7684\u6570\u4ecd\u7136\u662f p \u7684\u7ea6\u6570\uff0c\u5e76\u4e14\u80fd\u88ab $gcd(a[i],[j])$ \u6574\u9664\n\n\u4e0a\u9762\u4e24\u70b9\u542f\u793a\u6211\u4eec\u53ef\u4ee5\u5199\u4e2a n^2 \u66b4\u529b\uff08\u5f53\u7136\u7528\u5230\u4e0b\u9762\u7684map\u8fd8\u8981\u52a0\u4e2a log \uff09\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u6c5f p \u7684\u6240\u6709\u7ea6\u6570\u7b5b\u51fa\u6765\uff0c\u5e76\u4e14\u5b58\u8fdb s \u6570\u7ec4\uff0c\u540c\u65f6\u7528 map \u8bb0\u5f55 p \u7684\u7ea6\u6570 i \u5728 s \u4e2d\u7684\u4f4d\u7f6e mp[i] \n\n\u7136\u540e\u5269\u4e0b\u7684\u5c31\u662f\u52a8\u89c4\u8f6c\u79fb\u4e86\uff0c\u6211\u4eec\u4ee4 f[i][j] \u8868\u793a\u4ece\u524d i \u4e2a\u7ea6\u6570\u4e2d\u53d6\u51fa\u4efb\u610f\u6570\u4f7f\u5b83\u4eec\u7684 $gcd=s[j]$ \u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u8f6c\u79fb\u662f\u8fd9\u6837\u7684\n\n\n$$f[i][x]=\\sum f[i-1][a]\\times f[i-1][b]\\times [gcd(s[a],s[b])=s[x] ]$$\n\n\u901a\u4fd7\u8bb2\u5c31\u662f $gcd$ \u4e3a x \u7684\u4e24\u4e2a\u6570\u7684 **\u6784\u6210\u65b9\u6848\u6570** \u7684\u4e58\u79ef\u7d2f\u52a0\u8fdb f[i][x]\n\n\u4ee3\u7801\u91cc\u7528\u4e86\u6eda\u52a8\u6570\u7ec4\u4f46\u5176\u5b9e\u5e76\u4e0d\u9700\u8981\uff0c\u7136\u540e\u8981\u8bf4\u4f18\u5316\u7a7a\u95f4\u7684\u8bdd\u5176\u5b9e map \u53ef\u4ee5\u6362 HASH \uff0c\u4f5c\u8005\u592a\u61d2\u592a\u83dc\u5c31\u4e0d\u6539\u4e86...\uff08\u5982\u8981\u62a2\u6700\u4f18\u89e3 top \u7684\u540c\u5b66\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\uff09\n\n```\n//by Judge\n#include<map>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define ll long long\nusing namespace std;\nconst int mod=1e9+7;\nconst int M=1e6+3;\ntypedef int arr[M];\nint gcd(int a,int b){return b?gcd(b,a%b):a;}\ninline void ADD(int& a,int b){a+=a+b>=mod?b-mod:b;}\ninline int qpow(int x,int p){ ll s=1;\n\tfor(;p;p>>=1,x=1ll*x*x%mod)\n\t\tif(p&1) s=1ll*s*x%mod; return s;\n}\n#ifndef Judge\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n#endif\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){ int x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} char sr[1<<21],z[20];int C=-1,Z;\ninline void Ot(){fwrite(sr,1,C+1,stdout),C=-1;}\ninline void print(int x,char chr='\\n'){\n    if(C>1<<20)Ot();if(x<0)sr[++C]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++C]=z[Z],--Z);sr[++C]=chr;\n} int n,p,q,ans,a[M],s[M],num[M],f[2][M]; map<int,int> mp;\n\ninline void prep(int n){\n\tfor(int i=1;i*i<=n;++i) if(!(n%i)){\n\t\ts[++s[0]]=i; if(i*i<n) s[++s[0]]=n/i;\n\t} sort(s+1,s+1+s[0]);\n\tfor(int i=1;i<=s[0];++i) mp[s[i]]=i;\n}\nint main(){\n\tn=read(),q=read(),p=read(),prep(p);\n\tfor(int i=1;i<=n;++i) a[i]=read(),a[i]=gcd(a[i],p);\n\tfor(int i=1;i<=n;++i) a[i]=lower_bound(s+1,s+1+s[0],a[i])-s,++num[a[i]];\n\tfor(int i=1;i<=s[0];++i) if(num[i]) f[0][i]=qpow(2,num[i]),ADD(f[0][i],mod-1);\n\tfor(int i=1;i<=s[0];++i){ memcpy(f[i&1],f[i&1^1],s[0]+1<<4);\n\t\tfor(int j=1;j<i;++j) ADD(f[i&1][mp[gcd(s[i],s[j])]],1ll*f[i&1^1][i]*f[i&1^1][j]%mod);\n\t}\n\tmemcpy(f[s[0]&1],f[s[0]&1^1],s[0]+1<<2);\n\tfor(int i=s[0];i;--i) for(int j=1;j<i;++j)\n\t\tif(!(s[i]%s[j])) ADD(f[1][i],f[1][j]);\n\tfor(int x;q;--q,print(f[1][mp[x]]))\n\t\tx=read(),x=gcd(p,x); return Ot(),0;\n}\n```\n\n\n\n",
        "postTime": 1552444233,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4495 \u3010[HAOI2018]\u5947\u602a\u7684\u80cc\u5305\u3011"
    },
    {
        "content": "~~\u4f3c\u4e4e\u6211\u7684\u505a\u6cd5\u548c\u522b\u4eba\u90fd\u4e0d\u4e00\u6837\uff1f\uff1f\uff1f~~\n\n\u4e00\u4e2a\u91cd\u91cf\u4e3a$V_i$\u7684\u7269\u54c1\uff0c\u53ef\u4ee5\u653e\u51fa\u6240\u6709$gcd(V_i,P)$\u7684\u91cd\u91cf\uff0c\u800c\u591a\u4e2a\u7269\u54c1\u4e5f\u53ea\u8981$gcd$\u5c31\u597d\u4e86\u3002  \n\u73b0\u5728\u7684\u95ee\u9898\u8f6c\u53d8\u6210\u4e86\u6709\u591a\u5c11\u4e2a\u96c6\u5408$S$\uff0c\u6ee1\u8db3$S+\\{P\\}$\u4e2d\u6240\u6709\u6570\u7684$gcd$\u662f$w$\u7684\u56e0\u6570\u3002\u90a3\u4e48\u5b9e\u9645\u4e0a\u5c31\u662f\u76f4\u63a5\u4ee4$a[i]'=gcd(a[i],P)$\uff0c\u7136\u540e\u9009\u51fa\u4e00\u4e2a\u96c6\u5408\u4f7f\u5f97\u5b83\u662f$gcd(P,w)$\u7684\u56e0\u6570\u3002  \n\u8003\u8651\u5bf9\u4e8e$P$\u7684\u6bcf\u4e2a\u56e0\u6570\u9884\u5904\u7406\u7b54\u6848\uff0c\u4e0d\u8bb0\u5f97\u5728\u54ea\u91cc\u770b\u5230\u7684\uff0c\u5f53$P$\u8f83\u5927\u7684\u65f6\u5019\uff0c\u5176\u7ea6\u6570\u4e2a\u6570\u662f$P^{\\frac{1}{3}}$\u7ea7\u522b\uff0c\u90a3\u4e48\u5728\u8fd9\u91cc\u5c31\u53ef\u4ee5\u66b4\u529b\u628a\u6240\u6709\u56e0\u6570\u7b97\u51fa\u6765\u4e4b\u540e$O(\\sigma^2)$\u8ba1\u7b97\uff0c\u5373\u5148\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a$a[i]'$\u662f\u5f53\u524d$d$\u7684\u500d\u6570\uff0c\u90a3\u4e48\u8d21\u732e\u662f$2^{s}-1$\uff0c\u7136\u540e\u5bb9\u65a5\u51cf\u53bb\u6240\u6709$d$\u7684\u500d\u6570\u7684\u7b54\u6848\u5c31\u662f$gcd$\u4e3a$d$\u7684\u7b54\u6848\u3002\u7136\u540e\u518d$O(\\sigma^2)$\u7684\u8ba1\u7b97\u7ea6\u6570\u548c\u5c31\u597d\u4e86\u3002  \n\u8fd9\u6837\u5b50\u590d\u6742\u5ea6\u5927\u6982\u662f$O((n+Q)logP+\\sigma(P)^2)$\uff0c\u524d\u9762\u90a3\u4e2a$log$\u6765\u81ea\u4e8e$gcd$\u7684\u590d\u6742\u5ea6\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\n#define MOD 1000000007\n#define MAX 1000100\ninline int read()\n{\n\tint x=0;bool t=false;char ch=getchar();\n\twhile((ch<'0'||ch>'9')&&ch!='-')ch=getchar();\n\tif(ch=='-')t=true,ch=getchar();\n\twhile(ch<='9'&&ch>='0')x=x*10+ch-48,ch=getchar();\n\treturn t?-x:x;\n}\nint n,Q,P,a[MAX],bin[MAX];\nconst int blk=50000;\nint w[blk],tot,id1[blk],id2[blk],f[blk],s[blk];\nint ID(int x){return x<blk?id1[x]:id2[P/x];}\nint S[blk],top;\nint main()\n{\n\tn=read();Q=read();P=read();\n\tfor(int i=1;i<=n;++i)a[i]=__gcd(read(),P);\n\tbin[0]=1;for(int i=1;i<=n;++i)bin[i]=(bin[i-1]<<1)%MOD;\n\tfor(int i=1;i*i<=P;++i)\n\t\tif(P%i==0)\n\t\t{\n\t\t\tw[++tot]=i;\n\t\t\tif(P/i!=i)w[++tot]=P/i;\n\t\t}\n\tsort(&w[1],&w[tot+1]);\n\tfor(int i=1;i<=tot;++i)\n\t\tif(w[i]<blk)id1[w[i]]=i;\n\t\telse id2[P/w[i]]=i;\n\tfor(int i=1;i<=n;++i)s[ID(a[i])]+=1;\n\tfor(int i=tot;i;--i)\n\t{\n\t\tint cnt=0;top=0;\n\t\tfor(int j=i;j<=tot;++j)\n\t\t\tif(w[j]%w[i]==0)S[++top]=j,cnt+=s[j];\n\t\tf[i]=bin[cnt]-1;\n\t\tfor(int j=2;j<=top;++j)f[i]=(f[i]+MOD-f[S[j]])%MOD;\n\t}\n\tfor(int i=tot;i;--i)\n\t\tfor(int j=1;j<i;++j)\n\t\t\tif(w[i]%w[j]==0)f[i]=(f[i]+f[j])%MOD;\n\twhile(Q--)\n\t{\n\t\tint d=__gcd(read(),P);\n\t\tprintf(\"%d\\n\",f[ID(d)]);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1550713135,
        "uid": 21283,
        "name": "yybyyb",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4495 \u3010[HAOI2018]\u5947\u602a\u7684\u80cc\u5305\u3011"
    }
]