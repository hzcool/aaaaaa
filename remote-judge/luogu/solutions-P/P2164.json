[
    {
        "content": "\u9898\u76ee\u8fd8\u7b97\u4e0d\u96be\u5427\n\n\u9996\u5148\u6211\u4eec\u679a\u4e3e\u70b9$i$\uff0c\u5c06\u5176\u4ed6\u6240\u6709\u70b9\u5230\u8fd9\u4e2a\u70b9\u7684\u6700\u77ed\u8def\u6c42\u51fa\u6765\n\n\u7136\u540e\u6211\u4eec\u5728\u8fd9\u4e00\u6b21\u5efa\u51fa\u7684\u6700\u77ed\u8def$DAG$\u7684**\u53cd\u56fe**\u4e0a\u8fdb\u884c\u62d3\u6251\u6392\u5e8f\u3002\u5047\u8bbe\u6211\u4eec\u7b97\u5230\u4e86\u70b9$j$\uff0c\u70b9$j$\u7684\u4eba\u6d41\u91cf\u4e3a$t_j$\uff0c\u70b9$j$\u8fde\u51fa\u53bb\u7684\u8fb9\u5230\u8fbe\u7684\u70b9\u4e3a\u70b9\u96c6$\\{v\\}$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9$u \\in \\{v\\}$\uff0c\u8fb9$(j,u)$\u7684\u6d41\u91cf\u5c31\u4f1a\u589e\u52a0$\\frac{t_j}{|\\{v\\}|}$\uff0c$t_u$\u4f1a\u52a0\u4e0a$\\frac{t_j}{|\\{v\\}|}$\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(N^2)$\n\n\u5f3a\u884c\u63d2\u5165\u81ea\u5df1\u7684[blog](https://www.cnblogs.com/Itst/p/10186886.html)\n\n```\n#include<bits/stdc++.h>\n#define ld long double\nusing namespace std;\ninline int read(){\n    int a = 0;\n    char c = getchar();\n    while(!isdigit(c))\tc = getchar();\n    while(isdigit(c))\ta = (a << 3) + (a << 1) + (c ^ '0') , c = getchar();\n    return a;\n}\ninline int max(int a , int b){\n    return a > b ? a : b;\n}\nstruct Ed{\n    int start , end , upEd;\n}ans[100001];\nbool vis[301] , ifRail[301][301];\nlong long Times[301];\nint firEd[301] , minRoute[301];\nld peo[301][301] , To[301][301];\nstruct cmp{\n    bool operator() (const int& a, const int& b ){\n        return minRoute[a] < minRoute[b];\n    }\n};\nint main(){\n    int N = read() , M = read();\n    for(int i = 1 ; i <= M ; i++){\n        int a = read() , b = read();\n        ans[(i << 1) - 1].start = a;\n        ans[(i << 1) - 1].end = b;\n        ans[(i << 1) - 1].upEd = firEd[a];\n        firEd[a] = (i << 1) - 1;\n        ans[i << 1].start = b;\n        ans[i << 1].end = a;\n        ans[i << 1].upEd = firEd[b];\n        firEd[b] = i << 1;\n        ifRail[a][b] = ifRail[b][a] = 1;\n    }\n    for(int i = 1 ; i <= N ; i++)\n        for(int j = 1 ; j <= N ; j++)\tTo[i][j] = read();\n    for(int i = 1 ; i <= N ; i++){\n        memset(minRoute , 0x3f , sizeof(minRoute));\n        memset(Times , 0 , sizeof(Times));\n        minRoute[i] = 0;\n        Times[i] = 1;\n        queue < int > q;\n        priority_queue < int , vector < int > , cmp > q1;\n        q.push(i);\n        while(!q.empty()){\n            int t = q.front();\n            q.pop();\n            bool f = 0;\n            for(int j = firEd[t] ; j ; j = ans[j].upEd)\n                if(minRoute[ans[j].end] > minRoute[t] + 1){\n                    minRoute[ans[j].end] = minRoute[t] + 1;\n                    Times[ans[j].end] = Times[t];\n                    q.push(ans[j].end);\n                    f = 1;\n                }\n                else\tif(minRoute[ans[j].end] == minRoute[t] + 1){\n                    Times[ans[j].end] += Times[t];\n                    f = 1;\n                }\n            if(!f)\tq1.push(t);\n        }\n        memset(vis , 0 , sizeof(vis));\n        vis[i] = 1;\n        while(!q1.empty()){\n            int t = q1.top();\n            q1.pop();\n            for(int j = 1 ; j <= N ; j++)\n                if(ifRail[j][t] && minRoute[j] == minRoute[t] - 1){\n                    ld t1 = (ld)To[i][t] * Times[j] / Times[t];\n                    peo[j][t] += t1;\n                    peo[t][j] += t1;\n                    To[i][j] += t1;\n                    if(!vis[j]){\n                        vis[j] = 1;\n                        q1.push(j);\n                    }\n                }\n        }\n    }\n    for(int i = 1 ; i <= M ; i++)\n        cout << fixed << setprecision(1) << peo[ans[i << 1].start][ans[i << 1].end] + 1e-8 << endl;\n    return 0;\n}\n```",
        "postTime": 1545910391,
        "uid": 96296,
        "name": "Itst",
        "ccfLevel": 0,
        "title": "P2164 SHOI2007 \u4ea4\u901a\u7f51\u7edc"
    },
    {
        "content": "### \u4e00\u3001\u524d\u7f6e\u77e5\u8bc6\n\n+ [\u6700\u77ed\u8def\u5f84](https://www.luogu.com.cn/problem/P4779)\n\n+ [\u62d3\u6251\u6392\u5e8f](https://oi-wiki.org/graph/topo/)\n\n### \u4e8c\u3001\u9898\u76ee\u89e3\u6790\n\n+ \u7531\u9898\u76ee\u53ef\u77e5\uff0c\u6211\u4eec\u9700\u8981\u6c42\u7684\u6bcf\u6761\u8fb9\u7684\u5ba2\u6d41\u91cf\u662f\u6cbf\u7740\u6700\u77ed\u8def\u5f84\u4f20\u64ad\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u51fa\u53d1\u70b9 $i$\uff0c\u6211\u4eec\u4e00\u5b9a\u53ef\u4ee5\u627e\u5230\u4e00\u4e9b\u7ec8\u70b9\uff0c\u4f7f\u5f97\u6240\u6709\u70b9\u90fd\u5728 $i$ \u5230\u7ec8\u70b9\u7684\u6700\u77ed\u8def\u5f84\u4e0a\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5728\u6700\u77ed\u8def\u8fc7\u7a0b\u4e2d\u8bb0\u5f55\u4e0b\u6240\u6709\u51fa\u5ea6\u4e3a 0 \u7684\u70b9\uff0c\u518d\u53cd\u8fc7\u6765\u6309\u7167\u62d3\u6251\u5e8f\u5904\u7406\u5373\u53ef\u3002\n\n+ \u800c\u5bf9\u4e8e\u5f53\u524d\u5904\u7406\u7684\u70b9 $j$\uff0c\u5b83\u7684\u4eba\u6d41\u91cf\u4e3a $to_{i,j}$\uff0c\u5219\u5bf9\u4e8e\u6700\u77ed\u8def\u5f84\u4e0a\u53ef\u4ee5\u5230\u8fbe\u5b83\u7684\u70b9 $u \\in \\left \\{  v\\right \\} $\uff0c\u8fb9 $(u,j)$ \u7684\u6d41\u91cf\u53ef\u4ee5\u589e\u52a0 $\\frac{to_{i,j}}{\\left | \\left \\{ v \\right \\}  \\right | }$\u3002\n\n+ \u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u4f7f\u7528\u7684\u6700\u77ed\u8def\u6709\u5173\u7cfb\u3002\u5982\u679c\u7528 spfa \u5c31\u662f $O(n^2m)$ \u7528\u5806\u4f18\u5316 dijstra \u5c31\u662f $O(n^2\\log_{2}{m} )$ ~~\u867d\u7136\u6ca1\u5fc5\u8981~~\n\n### \u4e09\u3001\u4ee3\u7801\n\n+ \u7c7b\u4f3c\u4e8e spfa\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef long double ld;\ntemplate<typename T>inline void rd(T&x) {\n\tx = 0;\n\tT f = 1;\n\tchar ch = getchar();\n\twhile (!isdigit(ch))f = (ch == '-') ? -1 : 1, ch = getchar();\n\twhile (isdigit(ch))x = (x << 1) + (x << 3) + ch - '0', ch = getchar();\n\tx *= f;\n}\nconst ll M = 100010, N = 310;\nstruct EDGE {\n\tll s, t;\n} ed[M << 1];\nll n, m, d[N][N];\nll dis[N], in[N];\nbool vis[M];\nstruct Node {\n\tll x, dis;\n\tbool operator <(const Node&a)const {\n\t\treturn dis < a.dis;\n\t}\n};\npriority_queue<Node>q1;\nvoid dij(ll s) {\n\tqueue<ll>q;\n\tmemset(dis, 0x3f, sizeof dis);\n\tmemset(in, 0, sizeof in);\n\tdis[s] = 0;\n\tin[s] = 1;\n\tq.push(s);\n\twhile (!q.empty()) {\n\t\tll x = q.front();\n\t\tq.pop();\n\t\tbool f = 0;\n\t\tfor (ll j = 1; j <= n; j++)\n\t\t\tif (dis[x] + d[x][j] < dis[j]) {\n\t\t\t\tdis[j] = dis[x] + d[x][j];\n\t\t\t\tin[j] = in[x];\n\t\t\t\tq.push(j);\n\t\t\t\tf = 1;\n\t\t\t} else if (dis[x] + d[x][j] == dis[j])in[j] += in[x], f = 1;\n\t\tif (!f)q1.push({x, dis[x]});\n\t}\n}\nld to[N][N],ans[N][N];\nint main() {\n\trd(n), rd(m);\n\tmemset(d, 0x3f, sizeof d);\n\tfor (ll i = 1; i <= m; i++) {\n\t\tll x, y;\n\t\trd(x), rd(y);\n\t\ted[i] = {x, y};\n\t\td[x][y] = d[y][x] = 1;\n\t}\n\tfor(ll i=1;i<=n;i++)\n\t\tfor(ll j=1;j<=n;j++)cin>>to[i][j];\n\tfor (ll i = 1; i <= n; i++) {\n\t\tdij(i);\n\t\tmemset(vis, 0, sizeof(vis));\n\t\tvis[i] = 1;\n\t\twhile (!q1.empty()) {\n\t\t\tll x = q1.top().x;\n\t\t\tq1.pop();\n\t\t\tfor (ll j = 1 ; j <= N ; j++)\n\t\t\t\tif (d[j][x]==1 && dis[j] == dis[x] - 1) {\n\t\t\t\t\tld t = (ld)to[i][x] * in[j] / in[x];\n\t\t\t\t\tans[j][x] += t;\n\t\t\t\t\tans[x][j] += t;\n\t\t\t\t\tto[i][j] += t;\n\t\t\t\t\tif (!vis[j]) {\n\t\t\t\t\t\tvis[j] = 1;\n\t\t\t\t\t\tq1.push({j,dis[j]});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\t}\n\tfor(ll i=1;i<=m;i++)printf(\"%.6Lf\\n\",ans[ed[i].s][ed[i].t]);\n\treturn 0;\n}\n\n```\n\n+ \u5806\u4f18\u5316 dijstra\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define int ll\ntemplate<typename T>inline void rd(T&x) {\n\tx = 0;\n\tT f = 1;\n\tchar ch = getchar();\n\twhile (!isdigit(ch))f = (ch == '-') ? -1 : 1, ch = getchar();\n\twhile (isdigit(ch))x = (x << 1) + (x << 3) + ch - '0', ch = getchar();\n\tx *= f;\n}\nconst int M = 100010, inf = INT_MAX, N = 400;\nint dis[M];\nstruct Node {\n\tint x, dis;\n};\nbool operator <(const Node &a, const Node &b) {\n\treturn a.dis > b.dis;\n}\nstruct NODE {\n\tint x, dis;\n};\nbool operator <(const NODE &a, const NODE &b) {\n\treturn a.dis < b.dis;\n}\npriority_queue < NODE> q1;\npriority_queue<Node>q;\nstruct Edge {\n\tint to, nxt, v;\n} e[M << 1];\nstruct edge {\n\tint s, t;\n} ed[M];\nint hd[N], tot = 0, n, m, vis[N], s,in[N],b[N][N];\ninline void addedge(int x, int y, int v) {\n\te[++tot] = {y, hd[x], v};\n\thd[x] = tot;\n}\ndouble ans[N][N];\ninline void dij(int s) {\n\tfill(dis, dis + n + 1, inf);\n\tmemset(vis, 0, sizeof vis);\n\tmemset(dis, 0x3f, sizeof dis);\n\tmemset(in, 0, sizeof in);\n\tdis[s] = 0;\n\tin [s] = 1;\n\tq.push({s, 0});\n\twhile (!q.empty()) {\n\t\tint x = q.top().x, ds = q.top().dis;\n\t\tq.pop();\n\t\tbool f = 1;\n\t\tif (vis[x] || ds != dis[x])continue;\n\t\tfor (int i = hd[x]; i; i = e[i].nxt) {\n\t\t\tint go = e[i].to;\n\t\t\tif (go == x)continue;\n\t\t\tif (dis[go] > ds + e[i].v) {\n\t\t\t\tdis[go] = ds + e[i].v;\n\t\t\t\tq.push({go, dis[go]});\n\t\t\t\tin[go] = in[x];\n\t\t\t\tf = 0;\n\t\t\t} else if (dis[go] == ds + e[i].v)in[go] += in[x], f = 0;\n\t\t}\n\t\tif (f)q1.push({x, dis[x]});\n\t}\n}\ndouble d[N][N];\nsigned main() {\n\trd(n), rd(m);\n\tfor (int i = 1; i <= m; i++) {\n\t\tint x, y;\n\t\trd(x), rd(y);\n\t\ted[i] = {x, y};\n\t\taddedge(x, y, 1);\n\t\taddedge(y, x, 1);\n\t\tb[x][y]=b[y][x]=1;\n\t}\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= n; j++)cin >> d[i][j];\n\tfor (int i = 1; i <= n; i++) {\n\t\tdij(i);\n\n\t\tmemset(vis, 0, sizeof(vis));\n\t\tvis[i] = 1;\n\t\twhile (!q1.empty()) {\n\t\t\tint x = q1.top().x;\n\t\t\tq1.pop();\n\t\t\tfor (int j = 1 ; j <= n ; j++)\n\t\t\t\tif (b[j][x]&&dis[j] == dis[x] - 1) {\n\t\t\t\t\tdouble t1 = (double)d[i][x] * in[j] / in[x];\n\t\t\t\t\tans[j][x] += t1;\n\t\t\t\t\tans[x][j] += t1;\n\t\t\t\t\td[i][j] += t1;\n\t\t\t\t\tif (!vis[j]) {\n\t\t\t\t\t\tvis[j] = 1;\n\t\t\t\t\t\tq1.push({j, dis[j]});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\t}\n\tfor (int i = 1; i <= m; i++)\n\t\tprintf(\"%.6lf\\n\", ans[ed[i].s][ed[i].t]);\n\treturn 0;\n}\n\n```\n\n### \u56db\u3001\u5751\u70b9\n\n+ \u540c\u5fd7\u4eec\u4e00\u5b9a\u8981\u6ce8\u610f\u7cbe\u5ea6\u591a\u4fdd\u7559\u51e0\u4f4d\u5c0f\u6570\uff0c\u4e0d\u5f00 long long \u89c1\u7956\u5b97",
        "postTime": 1652328040,
        "uid": 233260,
        "name": "zyp123456",
        "ccfLevel": 7,
        "title": "P2164\u9898\u89e3"
    }
]