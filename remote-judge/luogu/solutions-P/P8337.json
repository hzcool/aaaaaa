[
    {
        "content": "**sol of P8337**\n\n# \u7ebf\u6027\u7a7a\u95f4\uff0c\u7ebf\u6027\u67e5\u8be2\u4f60\u4e5f\u5361\u5e38\u662f\u5427\uff1f\n# \u7ebf\u6027\u7a7a\u95f4\uff0c\u7ebf\u6027\u67e5\u8be2\u4f60\u4e5f\u5361\u5e38\u662f\u5427\uff1f\n# \u7ebf\u6027\u7a7a\u95f4\uff0c\u7ebf\u6027\u67e5\u8be2\u4f60\u4e5f\u5361\u5e38\u662f\u5427\uff1f\n\n\u7136\u540e\u8fd8\u6709\u66f4\u6bd2\u7624\u7684\u5e26\u7a7a\u95f4\u7248\u672c\uff0c\u6211\u4e0d\u61c2\u4e86\u3002Ynoi \u4e0d\u662f\u4e3a\u4e86\u5361\u5e38\u800c\u5361\u5e38\u3002\u867d\u7136\u4e5f\u4e60\u60ef\u4e86\uff0c\u6bd5\u7adf\u7834\u9632\u6f14\u7ec3\u3002\n\n~~\u6700\u79bb\u8c31\u7684\u662f\u8981\u4e86\u4e09\u4efd\u4ee3\u7801\u5bf9\u62cd\u524d\u4e24\u4efd\u90fd UB \u4e86\u3002~~\n\n\u4e00\u5e74\u524d\u5c31\u5b9e\u73b0\u8fc7\u4e86\uff0c\u7136\u540e\u5bc4\u4e86\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u8f6c\u5316\u95ee\u9898\uff0c\u53d1\u73b0\u67e5\u8be2\u7684\u8981\u6c42\u5b50\u533a\u95f4 $[x,y]$ \u6761\u4ef6\u7b49\u4ef7\u4e8e $[x,y]$ \u4e2d\u7684\u6570\u7ec4\u6210\u96c6\u5408 $S$\uff0c\u6ee1\u8db3 $span(S) = S$ \u4e14 $0 \\in S$\u3002\n\n\u8003\u8651\u53cd\u8bc1\u6cd5\u3002\u5047\u8bbe\u5b58\u5728 $span(S) \\not = S$ \u4e14\u4efb\u610f\u7684 $i \\bigoplus j \\in S$\u3002\u539f\u95ee\u9898\u9650\u5236\u4e0b\u9664\u975e\u7a7a\u96c6\u5219 $S$ \u4e2d\u5fc5\u7136\u542b $0$\u3002\u82e5 $span(S) \\not = S$ \u8003\u8651\u4e00\u4e2a\u5b50\u96c6 $T$ \u7684\u6309\u4f4d\u5f02\u6216\u548c $V$\uff0c\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u5730\u5c06\u5176\u5206\u62c6\u6210\u4e24\u4e2a\u6570\u6309\u4f4d\u5f02\u6216\u7684\u5f62\u5f0f\uff0c\u4f8b\u5982 $(x_1,x_2,x_3,x_4)$\uff0c\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u5730\u5c06 $x_1 \\bigoplus x_2,x_3 \\bigoplus x_4$ \u8fd9\u4e24\u4e2a\u6570\u5728 $S$ \u5185\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u63a8\u5bfc\u51fa\u6765 $x_1 \\bigoplus x_2 \\bigoplus x_3 \\bigoplus x_4$ \u5728 $S$ \u5185\u3002\n\n\u7136\u540e\u5c31\u7b80\u5355\u4e86\uff1a\u5408\u6cd5\u7684 $[x,y]$ \u6ee1\u8db3\u5176\u4e2d\u7684\u989c\u8272\u6570\u4e3a $2 ^ k$\u3002\u56fa\u5b9a\u53f3\u7aef\u70b9 $r$\uff0c\u679a\u4e3e\u6240\u6709\u5408\u6cd5\u957f\u5ea6\uff0c\u5bf9\u4e8e\u6bcf\u79cd\u957f\u5ea6\u5408\u6cd5\u5de6\u7aef\u70b9 $l$ \u5f62\u6210\u4e86\u4e00\u4e2a\u533a\u95f4 $[l_1,l_2]$\uff0c\u7528\u4e00\u4e2a\u4e09\u5143\u7ec4\u63cf\u8ff0\u5c31\u662f $(l_1,l_2,r)$\uff0c\u8fd9\u6837\u7684\u4e09\u5143\u7ec4\u81f3\u591a $O(n \\log n)$ \u4e2a\u3002\n\n\u6211\u4eec\u91c7\u7528\u53ef\u626b\u63cf\u7ebf\u7684\u7ebf\u6027\u57fa\u5373\u53ef\u7ef4\u62a4\u56fa\u5b9a $r$ \u65f6\u957f\u4e3a\u4e00\u5b9a\u91cf\u7684\u7ebf\u6027\u57fa\u8303\u56f4\uff0c\u6ce8\u610f\u7279\u5224\u6700\u8fd1\u7684 $0$ \u7684\u4f4d\u7f6e\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u79cd\u957f\u5ea6\uff0c\u968f\u7740 $r$ \u7684\u9012\u589e\uff0c$(l_1,l_2)$ \u5355\u8c03\u4e0d\u4e0b\u964d\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u76f4\u63a5\u524d\u7f00\u548c\u7ef4\u62a4\u7684\uff0c\u6211\u628a\u5177\u4f53\u65b9\u6cd5\u5199\u4ee3\u7801\u91cc\u4e86\uff0c\u81ea\u5df1\u770b\u5427\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\uff0c\u5f3a\u5236\u5728\u7ebf\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n\u7136\u540e\u5361\u5e38\uff1a\n\n- \u57fa\u7840\u7684\u5361\u5e38\uff0c\u5361\u5361\u5faa\u73af\u5c55\u5f00\uff0c\u6307\u4ee4\u96c6\uff0c\u8fd8\u6709\u4e00\u4e9b cache\uff1b\n\n- \u6392\u7ebf\u6027\u57fa\u7684 tim \u5e8f\u65f6\u522b\u5199 $O(\\log n \\log \\log n)$ \u7684\uff1b\n\n- \u67e5\u8be2\u65f6\u6839\u636e\u533a\u95f4\u957f\u4ece\u5c0f\u957f\u5ea6\u533a\u95f4\u95ee\u5230\u5927\u957f\u5ea6\u533a\u95f4\u3002\n\n\u5b9e\u73b0\u65f6\u6211\u8fd8\u7279\u5224\u4e86\u5168 $0$\uff0c\u5373\u96c6\u5408\u989c\u8272\u6570\u4e3a $1$ \u7684\u533a\u95f4\u8fd9\u79cd\u60c5\u51b5\u3002\n\n\u5176\u5b9e\u8fd9\u9053\u9898\u6b63\u5e38\u5199\u4e0d\u5361\u5e38\u7684\uff0c\u5361\u7a7a\u95f4\u5012\u662f\uff0c\u6211\u4e5f\u5361\u4e0d\u8fc7 256MB \u548c 1.37s\u3002\u8fd9\u9053\u9898\u4e5f\u662f\u5361\u7740\u8dd1\u7684\uff0c\u5efa\u8bae\u4e0d\u8981\u76f4\u63a5\u5b66\u5b9e\u73b0\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\n\n```cpp\n/*\n\u8bbe (l,r,R') \u662f\u8d21\u732e\u5143\u7ec4\uff0c(L,R) \u662f\u67e5\u8be2\u533a\u95f4 \nr >= L & l < L & R' <= R ;L <= l & r <= R\u3002\n\u7ef4\u62a4 r \u91cc\u9762\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e L \u7684\u533a\u95f4\uff0c\u7ef4\u62a4 l \u91cc\u9762\u6700\u540e\u4e00\u4e2a < L \u7684\u533a\u95f4\uff0c\u7ef4\u62a4 R' <= R \u7684\u6700\u540e\u4e00\u4e2a\u533a\u95f4 \n(l,R')\n\u7ef4\u62a4 l \u91cc\u9762\u7b2c\u4e00\u4e2a >= L \u7684\u533a\u95f4\uff0c\u7ef4\u62a4 R' <= R \u7684\u6700\u540e\u4e00\u4e2a\u533a\u95f4 \n\u524d\u7f00\u548c\u5185\u7ef4\u62a4\u7684\u4e1c\u897f\n\u7b2c\u4e00\u7c7b\uff1a\\sum r\uff1bL \u7ef4\u62a4\u7684\u7cfb\u6570\uff1b+1 \u7684\u7cfb\u6570\n\u7b2c\u4e8c\u7c7b\uff1a\u76f4\u63a5\u533a\u95f4\u548c\u3002\n*/\nconst int Len = 6e5 + 5 , M = 1e6 + 5 , LOG = 30 , V = 20;\nint lsh[Len],ct,a[Len],n,q,m;vector<int> rk;\ninline bool cmp(int x,int y){return x > y;}\nstruct Linearbasis\n{\n\tint a[LOG + 5],tim[LOG + 5]; \n\tLinearbasis(){memset(a , 0 , sizeof a);memset(tim , 0 , sizeof tim);}\n\tinline void getSt(int x,int y)\n\t{\n\t\tint i = 0 , j = 0 , Sz = (int)rk.size() , tt = 0;\n\t\tvector<int> ns;ns.reserve(Sz + (!x));\n\t\twhile(i < Sz && j < 1)\n\t\t{\n\t\t\tif(rk[i] == x && !tt) \n\t\t\t{\n\t\t\t\ttt ++;\n\t\t\t\ti ++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(rk[i] > y) ns.push_back(rk[i ++]);\n\t\t\telse ns.push_back(y) , j ++;\n\t\t}\n\t\twhile(i < Sz) \n\t\t{\n\t\t\tif(rk[i] == x && !tt) \n\t\t\t{\n\t\t\t\ttt ++;\n\t\t\t\ti ++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tns.push_back(rk[i ++]);\n\t\t}\n\t\twhile(j < 1) ns.push_back(y) , j ++;\n\t\tswap(ns , rk);\n\t}\n\tinline void ins(int x,int tm)\n\t{\n\t\tconst int idd = tm;\n\t\tfor(int i = LOG - 1 ; i >= 0 ; i -= 3)\n\t\t{\n\t\t\tif((x >> i) & 1) \n\t\t\t{\n\t\t\t\tif(tim[i] < tm) swap(x , a[i]) , swap(tim[i] , tm);\n\t\t\t\tif(!tm){ct ++;break;}\n\t\t\t\tx ^= a[i];\n\t\t\t}\n\t\t\tint I = i - 1;\n\t\t\tif(I < 0) break;\n\t\t\tif((x >> I) & 1) \n\t\t\t{\n\t\t\t\tif(tim[I] < tm) swap(x , a[I]) , swap(tim[I] , tm);\n\t\t\t\tif(!tm){ct ++;break;}\n\t\t\t\tx ^= a[I];\n\t\t\t}\n\t\t\tI = i - 2;\n\t\t\tif(I < 0) break;\n\t\t\tif((x >> I) & 1) \n\t\t\t{\n\t\t\t\tif(tim[I] < tm) swap(x , a[I]) , swap(tim[I] , tm);\n\t\t\t\tif(!tm){ct ++;break;}\n\t\t\t\tx ^= a[I];\n\t\t\t}\n\t\t}\n\t\tif(tm != idd) getSt(tm , idd);\n\t}\n}Bs;\nint cc[V][Len],nm[V],idx[V];\nll sr[V][Len];\nint so[V][Len],sL[V][Len];\nint len[V];\nll ss[V][Len];\nint sufr[V][Len],prel[V][Len],sufl[V][Len],preR[V][Len],zsm[Len];\nint col[V][Len],nmm[V],idxx[V];\ninline void get(const int le)\n{\n\twhile(nm[le] > (1 << le)) \n\t{\n\t\tcc[le][a[idx[le]]] --;\n\t\tif(!cc[le][a[idx[le] ++]]) nm[le] --;\n\t}\n}\ninline void gtt(const int le)\n{\n\tint tt = 0;\n\twhile(nmm[le] >= (1 << le)) \n\t{\n\t\ttt ++;\n\t\tcol[le][a[idxx[le]]] --;\n\t\tif(!col[le][a[idxx[le] ++]]) nmm[le] --;\n\t}\n\tif(tt) nmm[le] ++ , idxx[le] -- , col[le][a[idxx[le]]] ++;\n}\ninline void add(int le,int x){if(!cc[le][x] ++) nm[le] ++;}\ninline void adx(int le,int x){if(!col[le][x] ++) nmm[le] ++;}\nint lstl[V],lstr[V],lstR[V],lstid[V];\nint cmd[Len];int nmmm;\ninline void Work()\n{\n\tint lst0 = -1 , lsto0 = -1;for(int j = 0 ; j < V ; ++ j) idx[j] = idxx[j] = 1 , nm[j] = nmm[j] = 0;\n\tfor(int i = 1 ; i <= n ; ++ i)\n\t{\n\t\tif(!cmd[a[i]] ++) nmmm ++;\n\t\tif(!lsh[a[i]]) lst0 = i;\n\t\telse lsto0 = i;\n\t\tfor(int j = 0 ; j < V ; ++ j) \n\t\t{\n\t\t\tadd(j , a[i]) , adx(j , a[i]);\n\t\t\tget(j) , gtt(j);\n\t\t}\n\t\tBs.ins(lsh[a[i]] , i);\n\t\tint l,r,L,R,ul,ur;\n\t\tif(lst0 != -1)\n\t\t{\n\t\t\tconst int LIM = min(V , (int)rk.size());\n\t\t\tfor(int j = 1 ; j <= LIM && (1 << j) <= nmmm ; ++ j) \n\t\t\t{\n\t\t\t\tif(nm[j] >= (1 << j)) \n\t\t\t\t{\n\t\t\t\t\tl = idx[j] , r = idxx[j];\n\t\t\t\t\tif(j >= (int)rk.size()) L = 1 , R = rk[j - 1];\n\t\t\t\t\telse L = rk[j] + 1 , R = rk[j - 1];\n\t\t\t\t\tR = min(lst0 , R);if(L > R) continue;\n\t\t\t\t\tul = max(l , L) , ur = min(r , R);if(ul > ur) continue;\n\t\t\t\t\tlen[j] ++;const int now = len[j];\n\t\t\t\t\tsr[j][now] = sr[j][now - 1] , sL[j][now] = sL[j][now - 1] , so[j][now] = so[j][now - 1];\n\t\t\t\t\tsr[j][now] += ur , sL[j][now] -- , so[j][now] ++;\n\t\t\t\t\tss[j][now] = ss[j][now - 1] + (ur - ul + 1);\n\t\t\t\t\tfor(int k = lstr[j] + 1 ; k <= ur ; ++ k) sufr[j][k] = now;\n\t\t\t\t\tif(lstl[j] != ul)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor(int k = lstl[j] + 1 ; k <= ul ; ++ k) prel[j][k] = lstid[j];\n\t\t\t\t\t}\n\t\t\t\t\tfor(int k = lstl[j] + 1 ; k <= ul ; ++ k) sufl[j][k] = len[j];\n\t\t\t\t\tfor(int k = lstR[j] ; k < i ; ++ k) preR[j][k] = lstid[j];\n\t\t\t\t\tlstl[j] = ul , lstr[j] = ur , lstR[j] = i , lstid[j] = len[j];\n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t\tif(!lsh[a[i]]) \n\t\t{\n\t\t\tul = lsto0 + 1 , ur = i;int j = 0;\n\t\t\tlen[j] ++;const int now = len[j];\n\t\t\tsr[j][now] = sr[j][now - 1] , sL[j][now] = sL[j][now - 1] , so[j][now] = so[j][now - 1];\n\t\t\tsr[j][now] += ur , sL[j][now] += -1 , so[j][now] ++;\n\t\t\tss[j][now] = ss[j][now - 1] + (ur - ul + 1);\n\t\t\tfor(int k = lstr[j] + 1 ; k <= ur ; k += 3) \n\t\t\t{\n\t\t\t\tsufr[j][k] = now;\n\t\t\t\tif(k + 1 <= ur) sufr[j][k + 1] = now;\n\t\t\t\tif(k + 2 <= ur) sufr[j][k + 2] = now;\n\t\t\t}\n\t\t\tif(lstl[j] != ul)\n\t\t\t{\n\t\t\t\tfor(int k = lstl[j] + 1 ; k <= ul ; k += 3) \n\t\t\t\t{\n\t\t\t\t\tprel[j][k] = lstid[j];\n\t\t\t\t\tif(k + 1 <= ul) prel[j][k + 1] = lstid[j];\n\t\t\t\t\tif(k + 2 <= ul) prel[j][k + 2] = lstid[j];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(int k = lstl[j] + 1 ; k <= ul ; k += 3) \n\t\t\t{\n\t\t\t\tsufl[j][k] = len[j];\n\t\t\t\tif(k + 1 <= ul) sufl[j][k + 1] = len[j];\n\t\t\t\tif(k + 2 <= ul) sufl[j][k + 2] = len[j];\n\t\t\t}\n\t\t\tfor(int k = lstR[j] ; k < i ; k += 3) \n\t\t\t{\n\t\t\t\tpreR[j][k] = lstid[j];\n\t\t\t\tif(k + 1 < i) preR[j][k + 1] = lstid[j];\n\t\t\t\tif(k + 2 < i) preR[j][k + 2] = lstid[j];\n\t\t\t}\n\t\t\tlstl[j] = ul , lstr[j] = ur , lstR[j] = i , lstid[j] = len[j];\n\t\t}\n\t\tif(i == n) \n\t\t{\n\t\t\tfor(int j = min(V , (int)rk.size()) ; j >= 0 ; -- j) \n\t\t\t{\n\t\t\t\tif(nm[j] >= (1 << j)) \n\t\t\t\t{\n\t\t\t\t\tfor(int k = lstl[j] + 1 ; k <= n ; ++ k) prel[j][k] = lstid[j];\n\t\t\t\t\tfor(int k = lstR[j] ; k <= n ; ++ k) preR[j][k] = lstid[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\ninline ll Q(int l,int r)\n{\n\tl ++ , r ++;\n\tll ret = 0;int L,R;const int LEN = r - l + 1;\n\tfor(int i = 0 ; i < V && (1 << i) <= LEN ; i += 3) \n\t{\n\t\tL = sufr[i][l] - 1 , R = min(prel[i][l] , preR[i][r]);\n\t\tif(~L && R && L < R) ret += (sr[i][R] - sr[i][L]) + (1ll * (sL[i][R] - sL[i][L])) * l + (so[i][R] - so[i][L]);\t\t\n\t\tL = sufl[i][l] - 1 , R = preR[i][r];\n\t\tif(~L && R && L < R) ret += ss[i][R] - ss[i][L];\n\t\tconst int I1 = i + 1 , I2 = i + 2;\n\t\tif(I1 < V && (1 << (I1)) <= LEN)\n\t\t{\n\t\t\tL = sufr[I1][l] - 1 , R = min(prel[I1][l] , preR[I1][r]);\t\n\t\t\tif(~L && R && L < R) ret += (sr[I1][R] - sr[I1][L]) + (1ll * (sL[I1][R] - sL[I1][L])) * l + (so[I1][R] - so[I1][L]);\t\t\n\t\t\tL = sufl[I1][l] - 1 , R = preR[I1][r];\n\t\t\tif(~L && R && L < R) ret += ss[I1][R] - ss[I1][L];\n\t\t}\n\t\tif(I2 < V && (1 << (I2)) <= LEN)\n\t\t{\n\t\t\tL = sufr[I2][l] - 1 , R = min(prel[I2][l] , preR[I2][r]);\n\t\t\tif(~L && R && L < R) ret += (sr[I2][R] - sr[I2][L]) + (1ll * (sL[I2][R] - sL[I2][L])) * l + (so[I2][R] - so[I2][L]);\t\t\n\t\t\tL = sufl[I2][l] - 1 , R = preR[I2][r];\n\t\t\tif(~L && R && L < R) ret += ss[I2][R] - ss[I2][L];\n\t\t}\n\t} \n\treturn ret;\n}\nint ctt;\ninline void init(int N,int Q,vector<int> A)\n{\n\tn = N , m = Q;\n\tfor(int i = 1 ; i <= n ; i ++) lsh[i] = a[i] = A[i - 1];\n\tsort(lsh + 1 , lsh + 1 + n);\n\tctt = unique(lsh + 1 , lsh + 1 + n) - lsh - 1;int l = 1 , r = ctt , as = 0;\n\tfor(int i = 1 ; i <= n ; i ++) \n\t{\n\t\tl = 1 , r = ctt , as = 0;\n\t\twhile(l <= r)\n\t\t{\n\t\t\tint mid = (l + r) >> 1;\n\t\t\tif(lsh[mid] >= a[i]) as = mid , r = mid - 1;\n\t\t\telse l = mid + 1;\n\t\t}\n\t\ta[i] = as;\n\t}\n\tWork();\n}\n```",
        "postTime": 1675164182,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u5e7b\u60f3\u7684\u5927\u60b2\u5492\uff01\u9f99\u9c7c\u6ce2\u7279\u8ba4\u4e3a\u5728\u4e94\u5927\u5b66\u79d1\u7ade\u8d5b\u7684\u5b66\u4e60\u4e2d\uff0c\u8574\u6db5\u7740\u4e09\u7c7b\u6210\u529f\u578b\u5185\u5377\u601d\u60f3\uff0c\u8fd9\u4e09\u79cd\u601d\u60f3\u662f\uff1a1\u3001\u522b\u4eba\u4e0d\u5377\u6211\u8981\u5377\uff1b2\u3001\u522b\u4eba\u8bf4\u6211\u5377\u6211\u5c31\u53cd\u54ac\u4e00\u53e3\uff1b3\u3001\u6253\u4e0d\u8fc7\u6211\u5c31\u9b54\u6cd5\u5c11\u5973\u554a\uff0c\u53d8\u8eab\u53cb\u5229\u5948\u7eea\u554a\u603c\u603c\u603c\u3002"
    },
    {
        "content": "## Preface\n\n\u4e3a\u4ec0\u4e48\u6211\u5199\u7684\u8fd9\u4e48\u5361\u5e38\u5462\uff1f\n\n## Analysis\n\n\u9996\u5148\u4e0d\u96be\u53d1\u73b0\u5408\u6cd5\u7684\u96c6\u5408\u5927\u5c0f\u4e00\u5b9a $2^k$\uff0c\u5373\u8fd9\u4e9b\u6570\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u6709 $1$ \u7684\u4e3a\u6709 $k$ \u4f4d\uff0c\u4e14\u6240\u6709\u8fd9\u4e9b\u6570\u5168\u90e8\u5b58\u5728\u4e8e\u96c6\u5408\u4e2d\u3002\u56e0\u6b64\u96c6\u5408\u5927\u5c0f\u53ea\u6709 $\\log n$ \u79cd\u3002\u8003\u8651\u5bf9\u6bcf\u79cd\u96c6\u5408\u5927\u5c0f\u5206\u522b\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u663e\u7136\u5bf9\u4e8e\u4e00\u79cd\u96c6\u5408\u5927\u5c0f\uff0c\u4ee5\u6bcf\u4e2a\u4f4d\u7f6e\u4e3a\u53f3\u7aef\u70b9\u7684**\u5408\u6cd5\u533a\u95f4\u7684\u5de6\u7aef\u70b9**\u4e00\u5b9a\u662f\u4e00\u4e2a\u533a\u95f4\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u53cc\u6307\u9488\u7b97\u51fa\u5bf9\u4e8e\u6bcf\u4e2a\u53f3\u7aef\u70b9\u7684\u8fd9\u4e2a\u5de6\u7aef\u70b9\u533a\u95f4\u3002\n\n\u60f3\u5fc5\u5927\u5bb6\u90fd\u505a\u8fc7 [CF1100F](https://www.luogu.com.cn/problem/CF1100F) \u5427\uff0c\u4ed6\u53ef\u4ee5\u5e2e\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u7c7b\u4f3c\u533a\u95f4\u7ebf\u6027\u57fa\u7684\u4e1c\u897f\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5 $O(n\\log V)$ \u5efa\u51fa\u524d\u7f00\u7ebf\u6027\u57fa\uff0c\u7136\u540e $O(\\log V)$ \u67e5\u8be2\u51fa\u4e00\u4e2a\u533a\u95f4\u7684\u7ebf\u6027\u57fa\u96c6\u5408\u5927\u5c0f\u4e86\u3002\n\n\u6211\u4eec\u540c\u65f6\u7ef4\u62a4\u8fd9 $\\log n$ \u79cd\u5927\u5c0f\u7684\u5408\u6cd5\u96c6\u5408\u7684\u5de6\u7aef\u70b9\u533a\u95f4\u4f4d\u7f6e\u3002\n\n\u9996\u5148\u6211\u4eec\u4e0d\u7ba1\u662f\u5426\u80fd\u53d6\u904d\u8fd9 $2^k$ \u4e2a\u6570\uff0c\u6211\u4eec\u7b97\u51fa\u53ea\u5173\u5fc3\u7ebf\u6027\u57fa\u5927\u5c0f\u65f6\u7684\u5de6\u7aef\u70b9\u533a\u95f4\u3002\u53f3\u7aef\u70b9\u79fb\u5230\u4e00\u4e2a\u4f4d\u7f6e\u65f6\uff0c\u6211\u4eec\u67e5\u51fa\u8fd9\u4e2a\u524d\u7f00\u7ebf\u6027\u57fa\uff0c\u524d\u7f00\u7ebf\u6027\u57fa\u4e2d\u9760\u540e\u7684 $\\log n$ \u4e2a\u4f4d\u7f6e\u5c31\u662f\u8fd9 $\\log n$ \u4e2a\u5927\u5c0f\u7684\u5408\u6cd5\u96c6\u5408\u5728\u4ec5\u8003\u8651\u7ebf\u6027\u57fa\u5927\u5c0f\u65f6\u7684\u5de6\u7aef\u70b9\u7684\u533a\u95f4\u8303\u56f4\u4e86\uff08\u6709\u70b9\u7ed5\uff0c\u8bf7\u8bfb\u8005\u81ea\u884c\u7406\u89e3\uff09\u3002\n\n\u7136\u540e\u6211\u4eec\u8fd8\u8981\u7b97\u533a\u95f4\u5143\u7d20\u79cd\u7c7b\u6570\u662f\u5426\u6ee1\u8db3\u662f $2^k$\u3002\u6211\u4eec\u7b97\u51fa\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u524d\u9a71\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u79fb\u52a8\u6307\u9488\u65f6\u5c31\u80fd\u5feb\u901f\u786e\u5b9a\u4e00\u4e2a\u4f4d\u7f6e\u5bf9\u533a\u95f4\u79cd\u7c7b\u6570\u7684\u8d21\u732e\uff0c\u4e8e\u662f\u76f4\u63a5\u53cc\u6307\u9488\u626b\u63cf\u5373\u53ef\u3002\u6700\u7ec8\u6211\u4eec\u5728 $O(n\\log V)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u4e86\u6240\u6709\u7684\u5408\u6cd5\u5de6\u7aef\u70b9\u533a\u95f4\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u7edf\u8ba1\u7b54\u6848\u3002\u9996\u5148 $\\log n$ \u79cd\u5927\u5c0f\u7684\u7b54\u6848\u6211\u4eec\u5206\u5f00\u8ba1\u7b97\u3002\u4ee5\u4e0b\u8ba8\u8bba\u9488\u5bf9\u4e8e\u4e00\u79cd\u96c6\u5408\u5927\u5c0f\u3002\n\n\u6211\u4eec\u628a\u6240\u6709\u7684\u8d21\u732e\u62bd\u8c61\u6210\u4e8c\u7ef4\u5e73\u9762\u4e0a\u7684\u7ebf\u6bb5\uff0c\u5c31\u4f1a\u6709\u5982\u4e0b\u56fe\u7684\u8d21\u732e\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fu42au3p.png)\n\n\u4e14\u8fd9\u4e9b\u7ebf\u6bb5\u6709\u5f88\u597d\u7684\u6027\u8d28\uff0c\u5c31\u662f\u5de6\u53f3\u7aef\u70b9\u90fd\u662f\u5206\u522b\u5355\u8c03\u4e0d\u964d\u7684\u3002\u4e00\u6b21\u8be2\u95ee\u662f\u95ee\u5982\u56fe\u7ea2\u8272\u4e09\u89d2\u5f62\u5185\u7684\u7ebf\u6bb5\u957f\u5ea6\u4e4b\u548c\u3002\u8003\u8651\u5c06\u7ebf\u6bb5\u6cbf\u76f4\u7ebf $r=l$ \u5dee\u5206\uff0c\u53d8\u6210\u5982\u4e0b\u7ebf\u6bb5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/c2ktrof2.png)\n\n\u5373\u6a59\u8272\u7ebf\u6bb5\u957f\u5ea6\u548c\u51cf\u53bb\u7eff\u8272\u7ebf\u6bb5\u957f\u5ea6\u548c\u3002\u800c\u6240\u6709\u7ebf\u6bb5\u7684\u5de6\u7aef\u70b9\u53c8\u662f\u5355\u8c03\uff0c\u6240\u4ee5\u8be2\u95ee\u7684\u4e09\u89d2\u5f62\u533a\u95f4\u4e0b\u534a\u90e8\u5206\u662f\u9876\u7740\u8fb9\u754c\u7684\uff0c\u4e0a\u534a\u90e8\u5206\u662f\u6240\u6709\u7ebf\u6bb5\u7684\u957f\u5ea6\u548c\u3002\u9884\u5904\u7406\u524d\u7f00\u548c\u548c\u5230\u8fbe\u6bcf\u4e2a\u6a2a\u5750\u6807\u7684\u6700\u5c0f\u7eb5\u5750\u6807\u4f4d\u7f6e\uff0c\u5373\u53ef\u505a\u5230 $O(1)$ \u7684\u67e5\u8be2\uff0c\u9884\u5904\u7406\u662f $O(n)$ \u7684\u3002\n\n\u7531\u4e8e\u6709 $\\log n$ \u79cd\u96c6\u5408\u5927\u5c0f\uff0c\u4e8e\u662f\u8fd9\u4e00\u90e8\u5206\u7684\u590d\u6742\u5ea6\u662f $O(n\\log n + q\\log n)$ \u7684\u3002\n\n\u5047\u8bbe $n,q$ \u540c\u9636\uff0c\u590d\u6742\u5ea6 $O(n\\log V+n\\log n)$\u3002\n\n## Code\n\n[Submission](https://www.luogu.com.cn/record/98398832)\u3002\u542c\u8bf4 Ynoi \u6700\u8fd1\u6d41\u884c\u4e0d\u653e\u4ee3\u7801\uff0c\u6240\u4ee5\u4e0d\u653e\u4e86\uff0c\u8981\u4ee3\u7801\u79c1\u4fe1\uff08~~\u611f\u89c9\u4ee3\u7801\u6bd4\u6211\u5728\u8fd9\u91cc\u778e\u903c\u903c\u6e05\u695a~~\uff09\u3002",
        "postTime": 1672893515,
        "uid": 169574,
        "name": "Enucai",
        "ccfLevel": 7,
        "title": "P8337 [Ynoi2004] rsxc"
    },
    {
        "content": "## \u524d\u8a00\n\u6211\u771f\u7684\u5361\u4e0d\u8fdb 256MB\uff01\n## \u601d\u8def\n\u8fd9\u9898\u5206\u4e3a\u4e24\u90e8\u5206\u3002\n\n\u9996\u5148\u4e00\u4e2a\u533a\u95f4\u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53 $|S|=2^k$\uff0c\u4e14 $S$ \u6784\u6210\u7684\u7ebf\u6027\u57fa\u6070\u6709 $k$ \u4e2a\u5143\u7d20\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u5728\u4e8e\u627e\u5230\u6240\u6709\u5408\u6cd5\u7684\u533a\u95f4\uff0c\u4ee5\u53ca\u5feb\u901f\u7edf\u8ba1\u5408\u6cd5\u5b50\u533a\u95f4\u7684\u4e2a\u6570\u3002\n\n### \u627e\u5230\u5408\u6cd5\u7684\u533a\u95f4\n\n- $O(n^2\\log a)$\n\n\u66b4\u529b\u626b\u63cf\u6240\u6709\u533a\u95f4\uff0c\u7ef4\u62a4\u96c6\u5408\u5927\u5c0f\u548c\u7ebf\u6027\u57fa\u3002\n\n- $O(n\\log^2n\\log^2a)$\n\n\u9996\u5148\u679a\u4e3e $|S|$\uff0c\u5171 $O(\\log n)$ \u4e2a\u53d6\u503c\u3002\n\n\u7136\u540e\u53cc\u6307\u9488\u626b\u4e00\u904d $r$\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $r$ \u6c42\u51fa\u5408\u6cd5\u7684 $l$ \u533a\u95f4\u3002\n\n\u7136\u540e\u6211\u4eec\u9700\u8981\u5224\u65ad\u6b64\u65f6 $[l,r]$ \u662f\u5426\u5408\u6cd5\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7ebf\u6027\u57fa\u5373\u53ef\u3002\n\n\u4e00\u6b21\u7ebf\u6027\u57fa\u5408\u5e76 $O(\\log ^2 a)$\uff0c\u9700\u8981 $O(\\log n)$ \u6b21\u5408\u5e76\u3002\n\n- $O(n\\log n\\log ^2 a)$\n\n\u6709\u4e00\u4e2a\u795e\u5947\u7684\u4e1c\u897f\u53eb\u505a\u4e0d\u5e26\u5220\u53cc\u6307\u9488\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u5408\u5e76\u4e00\u6b21\u3002\n\n- $O(n\\log a)$\n\n\u60f3\u5fc5\u5927\u5bb6\u90fd\u505a\u8fc7 CF1100F \u5427\u3002\n\n\u6211\u4eec\u4f18\u5316\u7ebf\u6027\u57fa\u63d2\u5165\u7684\u8fc7\u7a0b\uff0c\u8ba9\u5b83\u63d2\u5165\u7684\u65f6\u5019\u76f4\u63a5\u9738\u5728\u6700\u9ad8\u4f4d\u4e0a\uff0c\u5982\u679c\u6700\u9ad8\u4f4d\u6709\u6570\u5219\u8ba9\u90a3\u4e2a\u6570\u7ee7\u7eed\u5411\u4e0b\u9012\u5f52\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u67d0\u4e00\u4f4d\u6700\u5927\u80fd\u5728\u54ea\u4e2a $l$ \u88ab\u53d6\u5230\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5 $O(\\log a)$ \u63d2\u5165\u4e00\u6b21\uff0c\u7136\u540e\u6c42\u51fa\u82e5\u5e72\u4e2a\u5f71\u54cd\u7ebf\u6027\u57fa\u5927\u5c0f\u7684\u65ad\u70b9\u3002\n\n### \u7edf\u8ba1\u5408\u6cd5\u5b50\u533a\u95f4\u4e2a\u6570\n\n- $O(n^2)-O(1)$ \u6216 $O(1)-O(n^2)$\n\n\u6211\u4f1a\u679a\u4e3e\uff01\u6211\u4f1a\u524d\u7f00\u548c\uff01\n\n- $O(n\\log^3n)-O(\\log^2n)$\n\n\u4e8c\u7ef4\u7ebf\u6bb5\u6811\uff0c\u6ce8\u610f\u5230\u8fd9\u73a9\u610f\u7a7a\u95f4\u662f $O(n\\log^2 n)$ \u7684\uff0c\u5e76\u4e0d\u80fd\u8fc7 $10^5$\u3002\n\n- $O(n\\log n)-O(\\log n)$\n\n\u9996\u5148\u679a\u4e3e $k$\uff0c\u7136\u540e\u6211\u4eec\u4f1a\u5bf9\u4e8e\u6bcf\u4e2a $r$ \u5f97\u5230\u4e00\u4e2a $[l_1,l_2]$ \u4ee3\u8868\u5408\u6cd5\u533a\u95f4\uff0c\u7136\u540e $l_1,l_2$ \u90fd\u968f $r$ \u589e\u5927\u800c\u589e\u5927\u3002\n\n\u8bb0\u8be2\u95ee\u533a\u95f4\u4e3a $[L,R]$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42 $r\\leq R$ \u7684\u6240\u6709\u533a\u95f4\u548c $[L,R]$ \u7684\u4ea4\u7684\u957f\u5ea6\u7684\u548c\u3002\n\n\u4e8e\u662f\u5269\u4e0b\u7684\u90e8\u5206\u662f\u5e73\u51e1\u7684\uff0c\u5927\u6982\u5c31\u662f\u9884\u5904\u7406\u4e00\u4e9b\u4e1c\u897f\u5206\u7c7b\u8ba8\u8bba\u3002\n\n### \u5361\u7a7a\u95f4\n\n\u7531\u4e8e\u6211\u5e76\u4e0d\u4f1a\u9884\u5904\u7406\u548c\u5206\u7c7b\u8ba8\u8bba\uff0c\u6211\u5199\u51fa\u6765\u7684\u4ee3\u7801\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u975e\u5e38\u975e\u5e38\u9ad8\uff08\u60b2\uff09\n\n\u4e3a\u4e86\u5f3a\u884c\u901a\u8fc7\u6b64\u9898\uff0c\u6211\u4f7f\u7528 ``int48`` \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n``int48`` \u4ee3\u7801\u89c1\u4e0b\uff0c\u5b8c\u6574\u4ee3\u7801\u53ef\u4ee5\u79c1\u4fe1\u3002\n\n```cpp\n#pragma pack(push,1)\nstruct i48{\n    ll x:48;\n    operator ll(){\n        return x;\n    }\n    i48 operator=(ll y){x=y;return*this;}\n    i48 operator=(i48 y){x=y.x;return*this;}\n    i48 operator=(int y){x=y;return*this;}\n    i48 operator+=(ll y){x+=y;return*this;}\n    i48 operator+=(i48 y){x+=y.x;return*this;}\n    i48 operator+=(int y){x+=y;return*this;}\n    i48 operator+(ll y){return (i48){x+y};}\n    i48 operator+(i48 y){return (i48){x+y.x};}\n    i48 operator+(int y){return (i48){x+y};}\n    i48 operator-=(ll y){x-=y;return*this;}\n    i48 operator-=(i48 y){x-=y.x;return*this;}\n    i48 operator-=(int y){x-=y;return*this;}\n};\n```",
        "postTime": 1656321999,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8337"
    }
]