[
    {
        "content": "\u7ed9\u5b9a $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u56fe\uff0c\u7b2c $i$ \u6761\u8fb9\u7684\u6743\u503c\u4e3a $w_i$\uff0c\u6bcf\u6761\u8fb9\u6709 $\\frac{1}{2}$ \u7684\u6982\u7387\u88ab\u4fdd\u7559\uff0c\u6c42\u6700\u540e\u8fd9\u5f20\u56fe\u7684\u6700\u5927\u57fa\u73af\u6811\u68ee\u6797\u7684\u8fb9\u6743\u548c\u3002\n\n### Solution\n\n$\\mathcal O(2^m\\cdot m\\alpha(n))$ \u662f\u663e\u7136\u7684\u3002\n\n\u7c7b\u6bd4\u4e00\u4e0b Kruskal \u6c42 MST \u5c31\u4f1a\u505a\u4e86\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u6211\u4eec\u4e0d\u59a8\u8003\u8651\u5224\u5b9a\u4e00\u6761\u8fb9\u4ec0\u4e48\u60c5\u51b5\u4e0b**\u4e0d\u4f1a**\u88ab\u52a0\u5165\u7b54\u6848\uff0c\u7b49\u4ef7\u4e8e\u4ec5\u8003\u8651\u8fb9\u6743\u5927\u4e8e\u4ed6\u7684\u8fb9\uff0c\u6709\u4ed6\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\uff1a\n\n1. \u8fde\u901a\uff0c\u4e14\u6b64\u65f6\u4e0d\u4e3a\u6811\u3002\n2. \u4e0d\u8fde\u901a\uff0c\u6b64\u65f6\u8fd9\u4e24\u4e2a\u70b9\u5206\u522b\u5728\u4e00\u4e2a\u57fa\u73af\u6811\u4e0a\u3002\n\n\u7b2c\u4e00\u7c7b\u8d21\u732e\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u7edf\u8ba1\u4ec5\u4fdd\u7559\u8fd9\u4e9b\u8fb9\u65f6\u70b9\u96c6 $S$ \u7684\u751f\u6210\u6811\u7684\u6570\u91cf\u3002\u8fd9\u4e2a\u53ef\u4ee5\u679a\u4e3e\u5b50\u96c6 $T\\subseteq S$\uff0c\u7136\u540e\u8ba1\u7b97\u4e00\u68f5\u751f\u6210\u6811\uff0c\u4e0d\u96be\u53d1\u73b0\u6bcf\u68f5\u751f\u6210\u6811\u4f1a\u88ab\u8ba1\u7b97 $|S|-1$ \u6b21\uff0c\u9664\u6389\u5373\u53ef\u3002\n\n\u7edf\u8ba1 $T\\to T\\land S$ \u4e2d\u7684\u8fb9\u6570\u901a\u8fc7 $cnt_S-cnt_T-cnt_{T\\land S}$ \u6765\u8ba1\u7b97\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u4e3a $\\mathcal O(m\\cdot 3^n)$\uff0c\u9700\u8981\u9002\u5f53\u51cf\u679d\uff0c\u6bd4\u5982\u70b9\u96c6 $S$ \u7684\u8fb9\u6570\u5c0f\u4e8e $|S|-1$ \u65f6\u5c31\u76f4\u63a5 out\n\n\u63a5\u4e0b\u6765\u8003\u8651\u7edf\u8ba1\u7b2c\u4e8c\u7c7b\u8d21\u732e\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u7b2c\u4e8c\u7c7b\u8d21\u732e\u7b49\u4ef7\u4e8e\u70b9\u96c6 $A$ \u548c\u70b9\u96c6 $B$ \u6ee1\u8db3 $x\\in A,y\\in B$ \u4e14 $A$ \u662f\u8054\u901a\u56fe\u4e0d\u662f\u751f\u6210\u6811\uff0c$B$ \u662f\u8054\u901a\u56fe\u4e0d\u662f\u6811\u3002\n\n\u679a\u4e3e $A,B$ \u7684\u603b\u91cf\u662f $3^n$ \u7684\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u9884\u5904\u7406\u8054\u901a\u56fe\u8ba1\u6570\uff0c\u7ecf\u5178\u7684\u5bb9\u65a5\u624b\u6bb5\u53ef\u4ee5\u505a\u5230 $\\mathcal O(3^n)$\n\n\u6700\u540e\uff0c\u6211\u4eec\u5728 $\\mathcal O(m3^n)$ \u7684\u590d\u6742\u5ea6\u89e3\u51b3\u4e86\u6b64\u95ee\u9898\u3002\n\n- \u9884\u5904\u7406 $cnt$ \u6570\u7ec4\u6211\u662f\u7528\u9ad8\u7ef4\u524d\u7f00\u548c\u7b97\u7684\u3002\n\nps : \u770b\u7740\u4e0d\u80fd\u8fc7\uff0c\u4f46\u5b9e\u9645\u4e0a\u6709\u4e00\u4e9b\u7ec6\u8282\u53ef\u4ee5\u51cf\u4e00\u4e0b\u679d\uff0c\u5927\u6982\u53ef\u4ee5\u51cf\u5c11 $\\frac{1}{3}\\sim \\frac{1}{9}$ \u4e0d\u7b49\u7684\u5e38\u6570\uff0c\u7136\u540e\u6211 UB \u4e86\u8c03\u4e86\u4e00\u665a\u4e0a...\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define int long long\nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int P = 998244353 ; \nconst int N = (1 << 16) + 5 ; \nint n, m, limit, bit[N], ip[N], fac[70], iv[35], f[N], g[N], cnt[N], Ans ; \nstruct E {\n\tint u, v, w ; \n} e[100] ;\nbool cmp(E x, E y) { return x.w > y.w ; }\nint fpow(int x, int k) {\n\tint ans = 1, base = x ;\n\twhile(k) {\n\t\tif(k & 1) ans = 1ll * ans * base % P ;\n\t\tbase = 1ll * base * base % P, k >>= 1 ;\n\t} return ans ;\n}\nvoid inc(int &x, int y) { ((x += y) >= P) && (x -= P) ; }\nvoid solve(int x) {\n\tmemset( cnt, 0, sizeof(cnt) ), memset( f, 0, sizeof(f) ), memset( g, 0, sizeof(g) ) ;\n\trep( i, 1, x - 1 ) ++ cnt[(1 << e[i].u) | (1 << e[i].v)] ;\n\tfor(re int k = 1; k <= limit; k <<= 1 )\n\trep( i, 0, limit ) if(i & k) cnt[i] += cnt[i ^ k] ; \n\trep( S, 1, limit ) {\n\t\tif( bit[S] == 1 ) { f[S] = g[S] = 1 ; continue ; }\n\t\tif( cnt[S] < bit[S] - 1 ) { f[S] = 0 ; g[S] = 0 ; continue ; }\n\t\tint w = (1 << ip[S]), z = S ^ w ; f[S] = 0, g[S] = fac[cnt[S]] ; \n\t\tfor(re int i = z; i; i = (i - 1) & z) {\n\t\t\tint u = i ^ S, t = cnt[S] - cnt[i] - cnt[u] ; \n\t\t\tf[S] = (f[S] + 1ll * f[i] * f[u] % P * t ) ;\n\t\t\tg[S] = (g[S] - g[u] * fac[cnt[i]] % P) ; \n\t\t}\n\t\tf[S] %= P, g[S] = (g[S] % P + P) % P ; \n\t\tf[S] = f[S] * iv[bit[S] - 1] % P ; \n\t}\n\tint ans = 0, u = (1 << e[x].u), v = (1 << e[x].v) ;\n\trep( S, 1, limit ) g[S] = (g[S] % P - f[S] % P + P) % P ; \n\trep( S, 1, limit ) {\n\t\tif( (!(S & u)) || (!(S & v)) ) continue ; \n\t\tint d = g[S] ; d = d * fac[cnt[limit ^ S]] % P ;\n\t\tans = (ans + d) % P ;\n\t\t//S \u8054\u901a\u4e14\u4e0d\u4e3a\u6811\uff0c\u679a\u4e3e S\uff0c\u5916\u90e8\u4efb\u610f \n\t}\n\trep( A, 1, limit ) {\n\t\tif( (!(A & u)) || (A & v) ) continue ; \n\t\tint T = A ^ limit ; \n\t\tfor(re int B = T; B; B = (B - 1) & T) {\n\t\t\tif( !(B & v) ) continue ; \n\t\t\tans = (ans + 1ll * g[A] * g[B] % P * fac[cnt[limit ^ A ^ B]] % P) % P ; \n\t\t}\n\t} \n\tint ffv = (P + 1) / 2 ; \n\tans = ans * fpow( fac[x], P - 2 ) % P, ans = (ffv - ans + P) % P ; \n\tAns = (Ans + ans * e[x].w) % P ; \n}\nsigned main()\n{\n\tn = gi(), m = gi() ; \n\trep( i, 1, m ) \n\t\te[i].u = gi() - 1, e[i].v = gi() - 1, e[i].w = gi() ; \n\tsort(e + 1, e + m + 1, cmp), iv[0] = fac[0] = 1 ; \n\trep( i, 1, n ) iv[i] = fpow(i, P - 2) ; \n\trep( i, 1, m ) fac[i] = fac[i - 1] * 2 % P ;\n\tlimit = (1 << n) - 1 ; \n\trep( i, 1, limit ) {\n\t\tbit[i] = __builtin_popcountll(i) ; \n\t\trep( j, 0, n - 1 ) if((1 << j) & i) { ip[i] = j ; break ; }\n\t}\n\trep( i, 1, m ) solve(i) ; \n\tcout << (long long)Ans << endl ; \n\treturn 0 ;\n}\n```\n\n",
        "postTime": 1603292912,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6789 \u3010\u5bd2\u5996\u738b\u3011"
    }
]