[
    {
        "content": "## \u601d\u8def\uff1a\n\u8fd9\u9053\u9898\u5176\u5b9e\u5c31\u662f\u4e00\u9053\u53ccLazy\u7ebf\u6bb5\u6811\u88f8\u9898\n\n\u56e0\u4e3a\u6211\u4eec\u77e5\u9053\uff0c\u5f53k\u4e00\u5b9a\u65f6\uff0c\u53d6\u53cd\u5076\u6570\u6b21\u6700\u540ek\u4f4d\u7b49\u4e8e\u4e0d\u53d6\u53cd\n\n\u540c\u7406\uff0c\u5f53k\u4e00\u5b9a\u65f6\uff0c\u7ffb\u8f6c\u5076\u6570\u6b21\u6700\u540ek\u4f4d\u7b49\u4e8e\u4e0d\u53d6\u53cd\n\n\u6211\u4eec\u4f7f\u7528\u53ccLazy\u5206\u522b\u5b58\u4e0b\u8fd9\u4e24\u4e2a\u4e1c\u897f\n\n\u540c\u65f6\u4e00\u76f4\u5bf92\u53d6\u6a21\n\n\u540c\u65f6\u6211\u4eec\u4f7f\u7528\u6807\u8bb0\u6c38\u4e45\u5316\n\n\u5411\u4e0b\u4f20\u53c2Lazy\n\n\u5355\u70b9\u67e5\u8be2\u5230\u8fd9\u4e2a\u70b9\u65f6\uff0c\u5224\u65ad\u662f\u5426\u9700\u8981\u53d6\u53cd\u5373\u53ef\n\n\u53d6\u53cd\u548c\u7ffb\u8f6c\u662f\u4f4d\u8fd0\u7b97\u57fa\u672c\u77e5\u8bc6\n\n\u5927\u5bb6\u53ef\u4ee5\u770b\u4ee3\u7801\n\n## \u4ee3\u7801\uff1a\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define rij register int j\n#define rii register int i\n#define rs 65536\nusing namespace std;\nstruct tree{\n    int fz,qf,val;\n}x[250005];\nint n,k,q,t,bs[50];\nvoid ycl()\n{\n    bs[0]=1;\n    for(rii=1;i<=25;i++)\n    {\n        bs[i]=bs[i-1]*2;\n    }\n}\nvoid cf(int val)\n{\n    unsigned int kkk=val;\n    while(kkk!=0)\n    {\n        cout<<kkk%2<<\" \";\n        kkk/=2;\n    }\n    cout<<endl;\n}\nint qf(int val)\n{\n    int bs=(1<<k);\n    int ltt=val%bs;\n    val-=ltt;\n    ltt=-ltt;\n    ltt--;\n    unsigned kkk=ltt;\n    kkk%=bs;\n    return val+kkk;\n}\nint fz(int val)\n{\n    int bis=(1<<k);\n    int ltt=val%bis;\n    int v=0;\n    val-=ltt;\n    for(rii=1;i<=k;i++)\n    {\n        v+=(ltt%2)*bs[k-i];\n        ltt/=2;\n    }\n    return val+v;\n}\nvoid add(int wz,int nl,int nr,int val,int bh)\n{\n    if(wz==nl&&wz==nr)\n    {\n        x[bh].val=val;\n        return;\n    }\n    int mid=(nl+nr)/2;\n    if(wz<=mid)\n    {\n        add(wz,nl,mid,val,bh*2);\n    }\n    else\n    {\n        add(wz,mid+1,nr,val,bh*2+1);\n    }\n}\nvoid change1(int l,int r,int nl,int nr,int bh)\n{\n    if(l<nl)\n    {\n        l=nl;\n    }\n    if(r>nr)\n    {\n        r=nr;\n    }\n    if(l==nl&&r==nr)\n    {\n        x[bh].qf++;\n        x[bh].qf%=2;\n        return;\n    }\n    int mid=(nl+nr)/2;\n    if(l<=mid)\n    {\n        change1(l,r,nl,mid,bh*2);\n    }\n    if(r>mid)\n    {\n        change1(l,r,mid+1,nr,bh*2+1);\n    }\n}\nvoid change2(int l,int r,int nl,int nr,int bh)\n{\n    if(l<nl)\n    {\n        l=nl;\n    }\n    if(r>nr)\n    {\n        r=nr;\n    }\n    if(l==nl&&r==nr)\n    {\n        x[bh].fz++;\n        x[bh].fz%=2;\n        return;\n    }\n    int mid=(nl+nr)/2;\n    if(l<=mid)\n    {\n        change2(l,r,nl,mid,bh*2);\n    }\n    if(r>mid)\n    {\n        change2(l,r,mid+1,nr,bh*2+1);\n    }\n}\nint query(int wz,int nl,int nr,int bh,int lazy1,int lazy2)\n{\n    lazy1%=2;\n    lazy2%=2;\n    if(wz==nl&&wz==nr)\n    {\n        lazy1+=x[bh].qf;\n        lazy2+=x[bh].fz;\n        int ltt=x[bh].val;\n        if(lazy1==1)\n        {\n            ltt=qf(ltt);\n        }\n        if(lazy2==1)\n        {\n            ltt=fz(ltt);\n        }\n        return ltt;\n    }\n    int mid=(nl+nr)/2;\n    if(wz<=mid)\n    {\n        return query(wz,nl,mid,bh*2,lazy1+x[bh].qf,lazy2+x[bh].fz);\n    }\n    else\n    {\n        return query(wz,mid+1,nr,bh*2+1,lazy1+x[bh].qf,lazy2+x[bh].fz);\n    }\n}\nvoid pd(int wz,int l,int r)\n{\n    if(l==r)\n    {\n        if(x[wz].fz!=0)\n        {\n            x[wz].fz=0;\n            x[wz].val=fz(x[wz].val);\n        }\n        if(x[wz].qf!=0)\n        {\n            x[wz].qf=0;\n            x[wz].val=qf(x[wz].val);\n        }\n        return;\n    }\n    if(x[wz].fz!=0)\n    {\n        x[wz*2].fz++;\n        x[wz*2].fz%=2;\n        x[wz*2+1].fz++;\n        x[wz*2+1].fz%=2;\n    }\n    if(x[wz].qf!=0)\n    {\n        x[wz*2].qf++;\n        x[wz*2].qf%=2;\n        x[wz*2+1].qf++;\n        x[wz*2+1].qf%=2;\n    }\n    x[wz].qf=0;\n    x[wz].fz=0;\n    int mid=(l+r)/2;\n    pd(wz*2,l,mid);\n    pd(wz*2+1,mid+1,r);\n}\nint main()\n{\n//     freopen(\"XiaoX10.in\",\"r\",stdin);\n//     freopen(\"XiaoX10.out\",\"w\",stdout);\n    ycl();\n    scanf(\"%d%d\",&n,&t);\n    for(rii=1;i<=n;i++)\n    {\n        int val;\n        scanf(\"%d\",&val);\n        add(i,1,rs,val,1);\n    }\n    for(rii=1;i<=t;i++)\n    {\n        if(i!=1)\n        {\n            pd(1,1,rs);\n        }\n        scanf(\"%d%d\",&q,&k);\n        int pid,l,r,wz;\n        for(rij=1;j<=q;j++)\n        {\n            scanf(\"%d\",&pid);\n            if(pid==1)\n            {\n                scanf(\"%d%d\",&l,&r);\n                change1(l,r,1,rs,1);\n            }\n            if(pid==2)\n            {\n                scanf(\"%d%d\",&l,&r);\n                change2(l,r,1,rs,1);\n            }\n            if(pid==3)\n            {\n                scanf(\"%d\",&wz);\n                int ltt=query(wz,1,rs,1,0,0);\n                printf(\"%d\\n\",ltt);\n            }\n        }\n    }\n    k=4;\n}\n```",
        "postTime": 1541303119,
        "uid": 52176,
        "name": "ztz11",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4991 \u3010\u6124\u6012\u7684XiaoX\u3011"
    },
    {
        "content": "## \u89e3\u9898\u601d\u8def\n\n**\u7ebf\u6bb5\u6811**\uff0c\u53ea\u4e0d\u8fc7\u8981\u7ef4\u62a4\u4e24\u4e2a\u6807\u8bb0\n\n### \u5206\u6790\n\n \u00b7 \u64cd\u4f5c $1$\uff0c\u5bf9\u6bcf\u4f4d\u53d6\u53cd\uff0c\u76f4\u63a5\u5f02\u6216\u4e0a `(1<<k)+1` \u5373\u53ef\n\n \u00b7 \u64cd\u4f5c $2$\uff0c\u7ffb\u8f6c\u4e8c\u8fdb\u5236\u6bd4\u8f83\u590d\u6742\uff0c\u8c8c\u4f3c\u4e5f\u6ca1\u6709\u76f4\u63a5\u7ffb\u8f6c\u7684\u51fd\u6570\uff0c\u5c31\u53ea\u80fd\u624b\u5199\n\n\u518d\u6df1\u7a76\u53d1\u73b0\uff0c\u5176\u5b9e\u4e24\u4e2a\u64cd\u4f5c\u662f**\u4e92\u4e0d\u5f71\u54cd**\u7684\uff0c\u56e0\u6b64\u53ea\u9700\u7ef4\u62a4\u4e24\u4e2a $tag$ \u5373\u53ef\uff0c\u518d\u770b\u9898\u76ee\u4e2d\u7684 $k$ \u7684\u9650\u5236\uff0c\u4e00\u7cfb\u5217\u64cd\u4f5c\u7684 $k$ \u503c\u76f8\u540c\uff0c\u56e0\u6b64 $tag$ \u7ef4\u62a4\u7684\u4fe1\u606f\u5e94\u4e3a $bool$ \u7c7b\u578b\uff0c\u8868\u793a\u4e0a\u8ff0\u64cd\u4f5c\u662f\u5426\u505a\u4e86\uff08\u56e0\u4e3a\u540c\u4e00\u4e2a\u64cd\u4f5c\u505a\u4e24\u6b21\u5c31\u662f\u65e0\u6548\u7684\n\n\u53c8\u6709 $t$ \u5c0f\u4e8e $5$\uff0c\u6240\u4ee5\u5728 $k$ \u503c\u6539\u53d8\uff0c\u4e5f\u5c31\u662f\u505a\u4e0b\u4e00\u7ec4\u8be2\u95ee\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u628a\u5148\u524d\u7684\u6807\u8bb0\u5168\u90e8\u4e0b\u4f20\n\n\u5173\u4e8e\u67e5\u8be2\uff0c\u5176\u5b9e\u53ea\u8981\u628a \u5bf9\u67e5\u8be2\u7684\u70b9\u6709\u5f71\u54cd\u7684\u6807\u8bb0 \u4e0b\u4f20\u5373\u53ef\uff0c\u90fd\u4e0d\u7528\u7ef4\u62a4\u533a\u95f4\n\n### warning\n\n\u8c8c\u4f3c\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u5751\u7684\u5730\u65b9\uff0c\u590d\u5236\u7c98\u8d34\u7684\u65f6\u5019\u8bb0\u5f97\u6539\u51fd\u6570\u540d\u5c31\u597d\u4e86~~\uff08\u5c34\u5c2c~~\n\n## Code\n\n```cpp\n#include<bits/stdc++.h>\n#define rgt register\n#define rint rgt int\n#define LL long long\n#define rll rgt LL\n#define inf 0x7f7f7f7f\n#define N 50003\nusing namespace std;\ntemplate<class K>inline bool cmax(K&a,const K&b){return (a<b)?a=b,1:0;}\ntemplate<class K>inline bool cmin(K&a,const K&b){return (a>b)?a=b,1:0;}\ninline int read() {\n\trint s=0;\n\trgt char c=getchar();\n\twhile(!isdigit(c)) c=getchar();\n\twhile(isdigit(c)) s=(s<<1)+(s<<3)+c-'0',c=getchar();\n\treturn s;\n}\nint n,m,T,K,b[N],L,R,pos,y;\nbool tag[N<<2],rev[N<<2];\ninline void push(rint k,rint l,rint r) {//\u4e0b\u4f20\u6807\u8bb0\n\tif(l==r) {//\u5982\u679c\u5df2\u7ecf\u5230\u4e86\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u76f4\u63a5\u4fee\u6539\n\t\tif(tag[k]) b[l]^=y;//\u53cd\u8f6c\u76f4\u63a5\u5f02\u6216(1<<k)-1\n\t\tif(rev[k]) {//\u7ffb\u8f6c\u8981\u81ea\u5df1\u5199\n\t\t\trint i,c=b[l]&y,s=0;b[l]-=c;\n\t\t\tfor(i=0;i<K;++i) {\n\t\t\t\tif(c&(1<<i)) s+=1<<(K-i-1);\n\t\t\t}b[l]+=s;\n\t\t}\n\t}\n\telse {//\u5426\u5219\u4e0b\u4f20\u6807\u8bb0\n\t\trint ls=k<<1;\n\t\tif(tag[k]) tag[ls]^=1,tag[ls|1]^=1;\n\t\tif(rev[k]) rev[ls]^=1,rev[ls|1]^=1;\n\t}\n\ttag[k]=rev[k]=0;\n}\ninline void Modify(rint k,rint l,rint r) {//\u6253\u53cd\u8f6c\u6807\u8bb0\n\tpush(k,l,r);if(r<L||R<l) return;\n\tif(L<=l&&r<=R) {tag[k]^=1;return push(k,l,r);}\n\trint m=(l+r)>>1,ls=k<<1;\n\tModify(ls,l,m),Modify(ls|1,m+1,r);\n}\ninline void Flip(rint k,rint l,rint r) {//\u6253\u7ffb\u8f6c\u6807\u8bb0\n\tpush(k,l,r);if(r<L||R<l) return;\n\tif(L<=l&&r<=R) {rev[k]^=1;return push(k,l,r);}\n\trint m=(l+r)>>1,ls=k<<1;\n\tFlip(ls,l,m),Flip(ls|1,m+1,r);\n}\ninline void Query(rint k,rint l,rint r) {//\u67e5\u8be2 \u5373\u5c06\u6709\u5f71\u54cd\u7684\u6807\u8bb0\u4e0b\u4f20\n\tpush(k,l,r);if(l==r) return;\n\trint m=(l+r)>>1,ls=k<<1;\n\t(pos<=m)?Query(ls,l,m):Query(ls|1,m+1,r);\n}\ninline void Update(rint k,rint l,rint r) {//\u66b4\u529b\u4e0b\u4f20\u6240\u6709\u6807\u8bb0\n\tpush(k,l,r);if(l==r) return;\n\trint m=(l+r)>>1,ls=k<<1;\n\tUpdate(ls,l,m),Update(ls|1,m+1,r);\n}\nint main() {\n\trint i,op;\n\tn=read(),T=read();\n\tfor(i=1;i<=n;i++) b[i]=read();\n\twhile(T--) {\n\t\tm=read(),K=read(),y=(1<<K)-1;//\u53d6\u53cd\u5f02\u6216\u7528\n\t\twhile(m--) {\n\t\t\top=read();\n\t\t\tif(op==3) pos=read(),Query(1,1,n),printf(\"%d\\n\",b[pos]);//\u4e0b\u4f20\u6807\u8bb0\u540e\u76f4\u63a5\u8f93\u51fa\u5f53\u524d\u503c\n\t\t\telse {\n\t\t\t\tL=read(),R=read();\n\t\t\t\tif(op==1) Modify(1,1,n);\n\t\t\t\telse Flip(1,1,n);\n\t\t\t}\n\t\t}Update(1,1,n);//\u66b4\u529b\u4e0b\u4f20\u6807\u8bb0\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1572488496,
        "uid": 83564,
        "name": "hovny",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4991 \u3010\u6124\u6012\u7684XiaoX\u3011"
    }
]