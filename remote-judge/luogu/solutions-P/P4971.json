[
    {
        "content": "\u9898\u76ee\u5927\u81f4\u5c31\u662f\u8981\u8ba9\u4f60\u652f\u6301\u4e09\u4e2a\u64cd\u4f5c\uff1a\n1. \u628a\u67d0\u4e2a\u70b9\u7684\u6743\u503c\u51cf\u5c0f\u81f3 $0$\n1. \u628a\u67d0\u4e2a\u96c6\u5408\u7684\u6700\u5927\u503c\u51cf\u5c0f\u81f3\u67d0\u4e2a\u503c\n1. \u628a\u67d0\u4e24\u4e2a\u96c6\u5408\u5408\u5e76\n\n\u660e\u663e\u7528\u5de6\u504f\u6811\uff0c\u4e0d\u4f1a\u7684\u5de6\u8f6c\u6a21\u677f\u7684\u9898\u89e3\u533a\u3002\n\n\u7136\u540e\u4e3b\u8981\u8ba8\u8bba\u8be5\u600e\u4e48\u51cf\u5c0f\u6743\u503c\uff0c\u5176\u5b9e\u5bf9\u4e8e\u51cf\u5c0f\u6743\u503c\u7684\u8fd9\u4e2a\u70b9\uff0c\u53ef\u80fd\u9700\u8981\u8c03\u6574\u7684\u662f\u4ed6\u7684\u513f\u5b50\uff0c\u56e0\u4e3a\u4ed6\u672c\u6765\u5c31\u6bd4\u7236\u4eb2\u5c0f\uff0c\u7136\u540e\u51cf\u5c0f\u540e\u80af\u5b9a\u8fd8\u4f1a\u6bd4\u7236\u4eb2\u5c0f\uff0c\u4f46\u662f\u513f\u5b50\u5c31\u6bd4\u4e00\u5b9a\u8fd8\u6bd4\u4ed6\u5c0f\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u628a\u4ed6\u7684\u4e24\u4e2a\u513f\u5b50\u5408\u5e76\u8d77\u6765\uff0c\u518d\u548c\u6574\u4e2a\u5806\u91cd\u65b0\u5408\u5e76\u4e00\u4e0b\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u628a\u8fd9\u4e2a\u70b9\u7684\u513f\u5b50\u62ff\u8d70\u540e\u4ed6\u7684 dist \u4e5f\u53d8\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5f80\u4e0a\u8c03\uff0c\u53ef\u662f\u6811\u9ad8\u662f\u53ef\u4ee5\u8fbe\u5230 $O(n)$ \u7684\u554a\uff0c\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u5f80\u4e0a\u8c03\uff0c\u8c03\u5230\u4e0d\u80fd\u8c03\u4e3a\u6b62\uff0c\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u8fd8\u662f $O(\\log_2 n)$ \u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u8c03\u6574\u7684\u6b21\u6570\u662f\u7ed3\u675f\u8c03\u6574\u65f6\u90a3\u4e2a\u70b9\u7684 dist\uff0c\u800c\u6811\u4e2d\u4efb\u4f55\u4e00\u4e2a\u70b9\u7684 dist \u90fd\u4e0d\u4f1a\u8d85\u8fc7 $\\log_2 n$\u3002\n\n\u4f46\u662f\u672c\u9898\u7a0d\u7a0d\u6709\u70b9\u95ee\u9898\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u7f6a\u6076\u503c\u76f8\u7b49\u7684\u574f\u4e8b\uff0c\u9898\u76ee\u6ca1\u8bf4\u600e\u4e48\u5904\u7406\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u7684\u5de6\u504f\u6811\u5199\u6cd5\u548c\u9898\u89e3\u6709\u533a\u522b\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u8fc7\u4e0d\u4e86\uff0c\u4e8e\u662f\u6211\u9650\u5b9a\u4e86\u4e00\u4e0b\uff0c\u8981\u6c42\u5bf9\u4e8e\u7f6a\u6076\u503c\u76f8\u7b49\u7684\u574f\u4e8b\uff0c\u8ba4\u4e3a\u7f16\u53f7\u66f4\u5c0f\u7684\u66f4\u574f\uff0c\u5728[\u8fd9\u91cc](https://www.luogu.com.cn/problem/U166042)\uff0c\u987a\u4fbf\u5361\u6389\u4e86\u6ca1\u6709\u8def\u5f84\u538b\u7f29\u7684\u5e76\u67e5\u96c6\u3002\n\n\u8d34\u4e00\u4efd\u6211\u7684[\u4ee3\u7801](https://www.luogu.com.cn/paste/bq3g3hzw)\uff0c\u5199\u6cd5\u8f83\u4e3a\u5947\u602a\uff0c\u89c1\u8c05\u3002\u7531\u4e8e\u4e0a\u9762\u63d0\u5230\u7684\u539f\u56e0\u5bfc\u81f4\u8fc7\u4e0d\u4e86\u8fd9\u9053\u9898\uff0c\u4f46\u662f\u662f\u53ef\u4ee5\u8fc7\u6389\u6211\u91cd\u65b0\u9020\u7684\u6570\u636e\u7684\u90a3\u9053\u9898\u3002",
        "postTime": 1624787410,
        "uid": 203008,
        "name": "toaru",
        "ccfLevel": 5,
        "title": "P4971 \u65ad\u7f6a\u8005 \u9898\u89e3"
    },
    {
        "content": "###\u9898\u76ee\u4fee\u6539\uff0c \u66f4\u65b0\u9898\u89e3\n###     [\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P4971)\n   \u6d4f\u89c8\u8fd9\u9053\u9898\uff0c\u53ef\u4ee5\u770b\u5230\u51e0\u4e2a\u5173\u952e\u8bcd\uff0c\u201c **\u6700\u5927\u7f6a\u6076\u503c** \u201d\uff0c\u201c **\u96c6\u5408** \u201d\uff0c\u201c **\u5408\u5e76** \u201d\u3002\n   \u6240\u4ee5\u5f88\u5bb9\u6613\u8054\u60f3\u5230 **\u5806** \uff0c **\u5e73\u8861\u6811** \u7b49\u7ed3\u6784\u3002\n    \u518d\u8003\u8651\u6570\u636e\u8303\u56f4 $T\u226410$\uff0c$n\u22642*10^6$ ,\u65f6\u95f4\u9650\u5236 $1.00s$ ~ $2.00s $.(\u5e38\u6570\u5927\u7684\u5e73\u8861\u6811\u679c\u65ad\u6392\u9664\uff09\u3002\n   \n   \u8003\u8651  $nlogn$ \u7684 **\u53ef\u5e76\u5806** \uff0c\u6700\u5e38\u89c1\u7684\u53ef\u5e76\u5806\u662f **\u5de6\u504f\u6811** \uff0c$lg$ \u4e5f\u6709\u4e13\u95e8\u7684 **[\u6a21\u677f\u9898](https://www.luogu.com.cn/problem/P3377)**\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u5de6\u504f\u6811 \u3002\n##    1.\u5408\u5e76\n\n\n**\u4ee3\u7801\uff1a**\n\n```cpp\nint merge(int x,int y){\n\tif(!x||!y)return x+y\n\tif(val[x]<val[y])swap(x,y);\n\tr[x]=merge(r[x],y);if(dis[l[x]]<dis[r[x]])swap(l[x],r[x]);\n\tfa[l[x]]=fa[r[x]]=fa[x]=x,dis[x]=dis[r[x]]+1;\n\treturn x;\n}\n```\n------------\n\n##   2.\u5220\u9664\n **\u6572\u91cd\u70b9**\n \n\u5728$P3377$\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f **$Pop$\uff08\u4ec5\u5220\u9664\u5806\u9876\uff09\uff0c\u4f46\u8fd9\u91cc\u662f $Extract$\uff08\u652f\u6301\u5220\u9664\u5806\u4e2d\u4efb\u610f\u8282\u70b9\uff09\u3002**\n\n**\u5177\u4f53\u5b9e\u73b0\u89c1\u4ee3\u7801\uff1a**\n```cpp\ninline void extract(register int x){\n    register int L=l[x],R=r[x];\n    fa[L]=L,fa[R]=R,l[x]=r[x]=dis[x]=0;\n    merge(merge(L,R),get(x));//\u5408\u5e76x\u8282\u70b9\u7684\u4e24\u4e2a\u513f\u5b50\uff0c\u548c\u5b83\u6240\u5728\u96c6\u5408\u4ee3\u8868\u5143\u7d20\u3002\n}\n```\n**\u8fd9\u6837\u64cd\u4f5c\u4f60\u5c31\u4f1a\u53d1\u73b0 $x$ \u8282\u70b9\u4e0d\u89c1\u4e86\u3002**\n\n------------\n\u63a5\u4e0b\u6765\u5c31\u662f\u7b80\u5355\u6a21\u62df\u4e86\u3002\n### \u4ee3\u7801\uff1a\n\n\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define maxn 2000100\nusing namespace std;\nint t,m,n,w;\nbool v[maxn]; \nint fa[maxn],l[maxn],r[maxn],dis[maxn];\nlong long k,val[maxn];\ninline int get(int x){return fa[x]==x?x:fa[x]=get(fa[x]);}\nint merge(int x,int y){\n\tif(!x||!y)return x+y;\n\tif(val[x]<val[y]||val[x]==val[y]&&x>y)swap(x,y);\n\tr[x]=merge(r[x],y);if(dis[l[x]]<dis[r[x]])swap(l[x],r[x]);\n\tfa[l[x]]=fa[r[x]]=fa[x]=x,dis[x]=dis[r[x]]+1;\n\treturn x;\n}\ninline void extract(register int x){\n    register int L=l[x],R=r[x];\n    fa[L]=L,fa[R]=R,l[x]=r[x]=dis[x]=0;\n    merge(merge(L,R),get(x));\n}\ninline void clear(){\n    fa[0]=dis[0]=l[0]=r[0]=0;\n    memset(v,0,sizeof(v));\n}\nint main(){\n    scanf(\"%d%d%d\",&t,&w,&k);\n    while(t--){\n        clear(); \n        scanf(\"%d%d\",&n,&m);\n        for(register int i=1;i<=n;i++){\n        \tscanf(\"%lld\",&val[i]);\n\t\t\tfa[i]=i,r[i]=l[i]=dis[i]=0;\n\t\t}\n        while(m--){\n            register int f,a,b;\n            scanf(\"%d\",&f);\n            if(f==2){scanf(\"%d\",&a);val[a]=0;extract(a);}\n            else if(f==3){scanf(\"%d%d\",&a,&b);a=get(a);val[a]-=val[a]>b?b:val[a];extract(a);}\n            else{\n                scanf(\"%d%d\",&a,&b);a=get(a);b=get(b);\n                if(a==b)continue;\n                merge(a,b);\n            }\n        }\n        long long sum=0,cmax=0;\n        for(int i=1;i<=n;i++){\n            register int root=get(i);\n            if(v[root])continue;v[root]=1;\n            cmax=max(cmax,val[root]);\n            sum+=val[root];\n        }\n        if(w==2)sum-=cmax;\n        if(w==3)sum+=cmax;\n        if(sum==0)printf(\"Gensokyo 0\\n\");\n        else if(sum<=k)printf(\"Heaven %lld\\n\",sum);\n        else printf(\"Hell %lld\\n\",sum);\n    }\n    return 0;\n} \n```\n------------\n\n## \u6570\u7ec4\u5b58\u5de6\u504f\u6811\uff0c\u7801\u98ce\u53ef\u80fd\u6bd4\u8f83\u7279\u522b\uff0c\u8bf7\u89c1\u8c05",
        "postTime": 1580778769,
        "uid": 104006,
        "name": "\u968f\u60c5\u82f1",
        "ccfLevel": 6,
        "title": "P4971 \u65ad\u7f6a\u8005"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u7bc7\u4ecb\u7ecdpb_ds\u7684\u9898\u89e3\u3002\n\npb_ds\u5c01\u88c5\u4e86\u8bb8\u591a\u6709\u7528\u7684\u4e1c\u897f\uff0c\u5176\u4e2d\u4e4b\u4e00\u5c31\u662f\u5de6\u504f\u6811\uff08\u53ef\u5e76\u5806\uff09\uff0c\u548c\u666e\u901a\u7684`priority_queue`\u5f88\u50cf\u3002\n\n~~CCF\u6bd4\u8d5b\u80fd\u7528\u4f60\u5c31\u8bf4\u9999\u4e0d\u9999\u3002~~\n\n\u8fd9\u9053\u9898\u5f88\u7b80\u5355\uff0c\u5c31 $4$ \u79cd\u64cd\u4f5c\uff1a\n\n1. \u5408\u5e76\u5806\n2. \u7ed3\u70b9\u503c\u6e05\u96f6\n3. \u5806\u4e2d\u6700\u5927\u503c\u51cf\u5c11\n4. \u589e\u52a0/\u51cf\u5c11\u6700\u5927\u503c\n\n\u7b2c\u4e00\u79cd\u64cd\u4f5c\u663e\u7136\u53ef\u4ee5\u4f7f\u7528pb_ds\u4e2d`priority_queue`\u7684 `join` \u51fd\u6570\uff0c\u4f7f\u7528\u65b9\u6cd5\u4e3a`q1.join(q2)`\u3002\n\n\u7b2c\u4e8c\u79cd\u64cd\u4f5c\u53ef\u4ee5\u4f7f\u7528\u6570\u7ec4\u6807\u8bb0\uff08\u65e0\u589e\u503c\u64cd\u4f5c\uff09\u3002\n\n\u7b2c\u4e09\u79cd\u5c06\u9876\u90e8\u503c\u51cf\u5c0f\u540e\u5728\u52a0\u5165\u5373\u53ef\uff08\u8bb0\u5f97\u628a\u539f\u6765\u7684\u5220\u4e86\uff09\u3002\n\n\u7b2c\u56db\u79cd\u6700\u540e\u8bb0\u5f55\u6700\u5927\u503c\uff0c\u518d\u589e\u6216\u51cf\u3002\n\n\u5177\u4f53\u89c1\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#include <bits/extc++.h>\n#define ext __gnu_pbds\nusing namespace std;//\u4e0d\u5f15\u7528__gnu_pbds\u65f6\u8bb0\u5f97\u52a0\u4e0aext::\nlong long t, w, k, n, m, f[2000010], x;\nbool s[2000010], ss[2000010];//s\u4e3a\u6e05\u96f6\uff0css\u4e3a\u8ba1\u7b97\u7684\u96c6\u5408\u6807\u8bb0\ntemplate <typename T> inline void read(T &t) {\n    t = 0;\n    char c = getchar();\n    int f = 1;\n    while (!isdigit(c)) {\n        if (c == '-') {\n            f = -f;\n        }\n        c = getchar();\n    }\n    while (isdigit(c)) {\n        t = (t << 3) + (t << 1) + (c ^ '0');\n        c = getchar();\n    }\n    t *= f;\n}\ntemplate <typename T, typename ... Args> inline void read(T &t, Args&... args) {\n    read(t);\n    read(args...);\n}\nstruct Node{\n    long long s, id;\n    bool operator<(const Node&p)const{\n        if (s != p.s) return s < p.s;//\u5927\u7684\u6392\u524d\u9762\u7528<\n        else return id > p.id;//\u5c0f\u7684\u6392\u524d\u9762\u7528>\n    }\n};\ninline Node merge(int a, int b){\n    return ((Node){a, b});\n}\next::priority_queue<Node> q[2000010];\nint find(int n){\n    if (n == f[n]) return n;\n    return f[n]=find(f[n]);\n}\nint main(){\n    read<long long>(t, w, k);\n    while (t--){\n        read<long long>(n, m);\n        memset(s, 0, sizeof(bool)*(n+10));\n        memset(ss, 0, sizeof(bool)*(n+10));\n        for (int i = 1; i <= n; i++){\n            read<long long>(x);\n            q[i].clear();//\u6e05\u7a7a\n            q[i].push(merge(x,i));\n            f[i]=i;\n        }\n        while (m--){\n            long long aa, bb, cc;\n            read<long long>(aa);\n            if (aa == 2){\n                read<long long>(bb);\n                s[bb] = 1;//\u6e05\u96f6\u6807\u8bb0\n            }\n            else if (aa == 3){\n                read<long long>(bb, cc);\n                long long fabb = find(bb);\n                while (!q[fabb].empty()&&s[q[fabb].top().id]) q[fabb].pop();//\u5c06\u6e05\u96f6\u7684\u7ed3\u70b9\u5220\u9664\uff08\u56e0\u4e3a\u6ca1\u6709\u589e\u52a0\u503c\u64cd\u4f5c\uff09\n                if (q[fabb].empty()) continue;\n                long long tmp = q[fabb].top().s - cc;\n                q[fabb].push(merge((tmp>0?tmp:0),q[fabb].top().id));\n                q[fabb].pop();//\u51cf\u53bb\u540e\u52a0\u5165\u5e76\u5220\u9664\u539f\u6765\u7684\u503c\n            }\n            else{\n                read<long long>(bb, cc);\n                int fabb = find(bb), facc = find(cc);\n                if (fabb == facc) continue;\n                if (q[fabb].size()>q[facc].size()) q[facc].join(q[fabb]), f[fabb]=facc;//\u5408\u5e76\n                else q[fabb].join(q[facc]), f[facc] = fabb;\n            }\n        }\n        long long sum = 0, maxx = -1;\n        for (int i = 1; i <= n; i++){\n            long long fai = find(i);\n            while (!q[fai].empty()&&s[q[fai].top().id]) q[fai].pop();\n            if (ss[fai]) continue;//\u907f\u514d\u91cd\u590d\u67e5\u627e\u540c\u4e00\u96c6\u5408\n            ss[fai]=1;\n            maxx = max(maxx, (q[fai].empty()?0ll:q[fai].top().s));//\u8bb0\u5f55\u6700\u5927\u81ea\n            sum += (q[fai].empty()?0:q[fai].top().s);\n        }\n        if (w == 2) sum -= maxx;\n        if (w == 3) sum += maxx;\n        if (sum == 0) puts(\"Gensokyo 0\");\n        else if (sum <= k) printf(\"Heaven %lld\\n\", sum);\n        else printf(\"Hell %lld\\n\", sum);\n    }\n    return 0;\n}\n```",
        "postTime": 1661785450,
        "uid": 377643,
        "name": "__Cartesian__Tree__",
        "ccfLevel": 5,
        "title": "P4971\u9898\u89e3"
    },
    {
        "content": "### \u7b80\u8981\u9898\u610f\n\n\u5bf9\u4e8e\u4e00\u4e2a\u5e8f\u5217\uff0c\u6700\u521d\u5c06\u5176\u6240\u6709\u5143\u7d20\u5206\u522b\u72ec\u7acb\u51fa\u6765\u4f5c\u4e3a\u4e00\u4e2a\u96c6\u5408\uff0c\u5b9e\u73b0\u4ee5\u4e0b\u51e0\u79cd\u529f\u80fd : \n\n1. \u6e05\u96f6\u4e00\u4e2a\u7279\u5b9a\u7684\u5143\u7d20\n\n2. \u5c06\u4e00\u4e2a\u96c6\u5408\u4e2d\u6700\u5927\u5143\u7d20\u51cf\u5c11\u4e00\u4e2a\u7279\u5b9a\u503c\uff0c\u51cf\u5c11\u5230 0 \u53ca\u4ee5\u4e0b\u9ed8\u8ba4\u628a\u8fd9\u4e2a\u5143\u7d20\u8bbe\u4e3a 0\n\n3. \u5408\u5e76\u4e24\u4e2a\u96c6\u5408\n\n\u6c42\u5b8c\u6210\u64cd\u4f5c\u540e\u6240\u6709\u96c6\u5408\u7684\u6700\u5927\u5143\u7d20\u603b\u548c\n\n\u663e\u7136\u5bf9\u4e8e\u53d6\u51fa\u4e00\u4e2a\u96c6\u5408\u6700\u5927\u5143\u7d20\u7684\u64cd\u4f5c\u5c31\u9700\u8981\u7ef4\u62a4\u5927\u6839\u5806\uff0c\u800c\u5408\u5e76\u66f4\u662f\u4e00\u4e2a\u660e\u663e\u7684\u64cd\u4f5c\uff0c\u8003\u8651 **\u53ef\u5e76\u5806**\u3002\n\n### \u5de6\u504f\u6811\n\n\u4e00\u79cd\u80fd\u5728 $\\mathrm{O}(\\log n)$ \u65f6\u95f4\u5185\u5408\u5e76\u7684\u5806\uff0c\u4f18\u52bf\u662f\u7a33\u5b9a\u4e14\u7801\u91cf\u5c0f\u4e8e Fibonacci\u5806\u3002\n\n~~\u914d\u5bf9\u5806\u590d\u6742\u5ea6\u53ea\u6709\u660e\u786e\u7684\u4e0a\u754c\u548c\u4e0b\u754c\uff0c\u611f\u89c9\u4e0d\u9760\u8c31~~\n\n[\u6a21\u677f\u9898](https://www.luogu.com.cn/problem/P3377)\n\n\u5c06\u7ed3\u70b9\u5c01\u88c5\u4e3a\u7ed3\u6784\u4f53 :\n\n```cpp\nstruct Node {\n    int val,ch[2],dist;\n}T[N];\n\n```\n\n#### \u5de6\u504f\u6811\u7684 ``dist``\n\n\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u70b9\u7684 ``dist`` \u5982\u4e0b :\n\n\u5b9a\u4e49\u6ca1\u6709\u5de6\u513f\u5b50\u6216\u53f3\u513f\u5b50\u7684\u7ed3\u70b9\u4e3a **\u5916\u7ed3\u70b9** \uff0c\u5176``dist`` \u4e3a 1\uff0c\u7a7a\u7ed3\u70b9 ``dist`` \u4e3a 0\uff0c\u4e0d\u662f\u5916\u8282\u70b9\u7684\u8282\u70b9 ``dist`` \u4e3a\u5176\u5230\u5b50\u6811\u4e2d\u6700\u8fd1\u7684\u5916\u8282\u70b9\u7684\u8ddd\u79bb\u52a0\u4e00\u3002\n\n\u4e3a\u4e86\u7ef4\u62a4\u5de6\u504f\u7684\u6027\u8d28\uff0c\u5de6\u504f\u6811\u4e00\u4e2a\u7ed3\u70b9\u7684\u5de6\u513f\u5b50\u7684 ``dist`` \u90fd\u8981\u5927\u4e8e\u53f3\u513f\u5b50\u7684 ``dist``\u3002\n\n\u6216\u8005\u53ef\u4ee5\u603b\u662f\u8ba4\u4e3a  ``dist`` \u5927\u7684\u7ed3\u70b9\u4e3a\u5de6\u513f\u5b50\u3002\n\n```cpp\n// \u53d6\u5f97\u53f3\u513f\u5b50\ninline int& rs(int x) {\n    return T[x].ch[T[T[x].ch[1]].dist < T[T[x].ch[0]].dist];\n}\n```\n\n### \u5b9e\u73b0\n\n\u8fc7\u7a0b\u5c31\u662f\u6a21\u62df\u9898\u610f\uff0c\u8003\u8651\u5982\u4f55\u5b9e\u73b0\u5173\u952e\u64cd\u4f5c\u3002\n\n#### 0.\u67e5\u627e\u6bcf\u4e2a\u5143\u7d20\u6240\u5728\u7684\u96c6\u5408\n\n\u6570\u636e\u8303\u56f4\u6709 $2 \\times 10^6$ \uff0c\u5fc5\u7136\u4e0d\u80fd\u66b4\u529b\u8df3\u3002\n\n\u8003\u8651\u4f7f\u7528\u8def\u5f84\u538b\u7f29\u7684\u5e76\u67e5\u96c6\uff0c\u7531\u4e8e\u5de6\u504f\u6811\u5408\u5e76\u662f\u57fa\u4e8e\u6743\u503c\u7684\uff0c\u8fd9\u4e2a\u5e76\u67e5\u96c6\u5e76\u4e0d\u80fd\u6309\u79e9\u5408\u5e76\u3002\n\n#### 1.\u5408\u5e76\n\n\u53c2\u8003\u666e\u901a\u7684\u53ef\u5e76\u5806\u5408\u5e76\uff0c\u4f46\u662f\u5982\u679c\u4e24\u4e2a\u7ed3\u70b9\u6743\u503c\u76f8\u540c\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u9009\u62e9\u7f16\u53f7\u5c0f\u7684\u7ed3\u70b9\u4f5c\u4e3a\u6839\u3002\n\n```cpp\nint merge(int x,int y) {\n    if(!x || !y) return x | y;\n    if(T[x].val < T[y].val || (T[x].val == T[y].val && x > y)) \n    \tstd::swap(x,y);\n    rs(x) = merge(rs(x),y);\n    T[x].dist = T[rs(x)].dist + 1;\n    return x;\n}\n```\n\n#### 2.\u6e05\u7a7a\u5806\u5185\u4efb\u610f\u7ed3\u70b9\n\n\u5bf9\u4e8e\u4e00\u4e2a\u975e\u5806\u9876\u7684\u7ed3\u70b9\uff0c\u9996\u5148\u53d6\u51fa\u5176\u5de6\u53f3\u513f\u5b50\uff0c\u5c06\u5176\u5408\u5e76\u540e\u5206\u79bb\u51fa\u6765,\u518d\u4e0e\u539f\u5806\u5408\u5e76\u5373\u53ef\u3002\n\n\u53ef\u4ee5\u8bc1\u660e\u8fd9\u4e2a\u64cd\u4f5c\u4e5f\u662f $\\mathrm{O}(\\log n)$ \u7684\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\u8fd9\u91cc\u4e0d\u662f\u5220\u9664\u8282\u70b9\u800c\u662f\u6e05\u7a7a\uff0c\u5c31\u662f\u8fd9\u4e2a\u8282\u70b9\u8fd8\u5728\u539f\u6765\u7684\u96c6\u5408\u91cc\uff0c\u53ef\u4ee5\u5c06\u5176\u79fb\u51fa\u5806\u4f46\u662f**\u4e0d\u80fd\u6e05\u7a7a\u5e76\u67e5\u96c6**\u3002\n\n#### 3.\u53d6\u51fa\u5806\u5185\u6700\u5927\u503c\u5e76\u51cf\u53bb\u4e00\u4e2a\u503c\n\n\u5bf9\u4e8e\u5927\u6839\u5806\uff0c\u6700\u5927\u503c\u5c31\u662f\u6839.\n\n\u4f46\u662f\u76f4\u63a5\u51cf\u53bb\u540e\u4e0d\u7b26\u5408\u5806\u7684\u6027\u8d28\uff0c\u8003\u8651\u5148\u5408\u5e76\u5de6\u53f3\u513f\u5b50\u518d\u628a\u51cf\u53bb\u7279\u5b9a\u503c\u7684\u5143\u7d20\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u5806\u5408\u5e76\u8fdb\u53bb\u5373\u53ef.\n\n\u8fd9\u65f6\u5019\u8981\u6ce8\u610f\u5982\u4f55\u7ef4\u62a4\u5e76\u67e5\u96c6\u4ee5\u4f7f\u5f97\u5e76\u67e5\u96c6\u627e\u5230\u7684\u603b\u662f\u8fd9\u4e2a\u5143\u7d20\u6240\u5728\u7684\u5806\u7684**\u6839\u7ed3\u70b9**\u3002\n\n#### 4.\u7edf\u8ba1\u7b54\u6848\n\n\u628a\u6bcf\u4e2a\u5806\u7684\u6839\u8282\u70b9\u6743\u503c\u52a0\u8d77\u6765\uff0c\u987a\u5e26\u7edf\u8ba1\u6700\u5927\u503c\u3002\n\n\u5f00 ``bool`` \u6570\u7ec4\u67e5\u91cd\u3002\n\n#### 5.\u6613\u9519\u70b9\n\n- \u5982\u679c\u5728``merge()``\u7684\u65f6\u5019\u66f4\u65b0\u5e76\u67e5\u96c6\uff0c\u5c31\u4e0d\u5fc5\u5728\u4e3b\u51fd\u6570\u91cc\u66f4\u65b0\u4e86\u3002\n\n- **\u4e0d\u8981**\u6e05\u7a7a\u88ab2\u64cd\u4f5c\u6e05\u96f6\u7684\u70b9\u7684\u5e76\u67e5\u96c6\u6807\u5fd7\u3002\n\n- \u5728\u6e05\u7a7a\u4e00\u4e2a\u7ed3\u70b9\u4e4b\u524d\u5148\u8bb0\u5f55\u5176\u5de6\u53f3\u513f\u5b50\u3002\n\n- \u5f00 ``long long`` ,\u7279\u522b\u662f ``K`` \u4e5f\u8981\u5f00\u3002\n\n- \u5feb\u8bfb\u5feb\u5199\u4e5f\u8981\u5f00``long long``\u3002\n\n### \u4ee3\u7801\n\n~~\u6211\u600e\u4e48\u5c31\u8fd9\u4e48\u62ff\u6700\u4f18\u89e3\u4e86~~\n\n\u5220\u9664\u4e86\u5934\u6587\u4ef6\u548c\u5feb\u8bfb\u3002\n\n```cpp\nint dsu[N];// disjoin set union\nint find(int x) {\n    return dsu[x] == x ? x : dsu[x] = find(dsu[x]);\n}\n\nbool vis[N];\nstruct Node {\n    ll val;\n    int ch[2],dist;\n}T[N];\n\ninline int& rs(int x) {\n    return T[x].ch[ T[T[x].ch[1]].dist < T[T[x].ch[0]].dist ];\n}\n\nint merge(int x,int y) {\n    if(!x || !y) return x | y;\n    if(T[x].val < T[y].val || (T[x].val == T[y].val && x > y)) \n    \tstd::swap(x,y);\n    rs(x) = merge(rs(x),y);\n    T[x].dist = T[rs(x)].dist + 1;\n    dsu[T[x].ch[0]] = dsu[T[x].ch[1]] = dsu[x] = x;\n    return x;\n}\n\nint W;\nll K;\n\nvoid solve() {\n    int n = read(),m = read();\n    memset(vis,0,sizeof(vis));\n    T[0].ch[0] = T[0].ch[1] = T[0].dist = 0;\n    for(int i = 1;i <= n;++i) {\n        T[i].val = read();\n        T[i].ch[0] = T[i].ch[1] = T[i].dist = 0;\n        dsu[i] = i;\n    }\n    for(int i = 1;i <= m;++i) {\n        int op = read(),x = read();\n        if(op == 2) {\n            // Clear Node x\n            if(vis[x]) continue;\n            vis[x] = 1;\n            int ch0 = T[x].ch[0],ch1 = T[x].ch[1];\n            dsu[ch0] = ch0,dsu[ch1] = ch1;\n            T[x].val = T[x].ch[0] = T[x].ch[1] = T[x].dist = 0;\n            merge(merge(ch0,ch1),find(x));\n        }\n        else if(op == 3) {\n            // Decrease Key\n            ll y = read();\n            x = find(x);\n            T[x].val -= y;\n            if(T[x].val < 0) T[x].val = 0;\n            int ch0 = T[x].ch[0],ch1 = T[x].ch[1];\n            dsu[ch0] = ch0,dsu[ch1] = ch1;\n            T[x].ch[0] = T[x].ch[1] = T[x].dist = 0;\n            merge(merge(ch0,ch1),x);\n        }\n        else {\n            // Merge\n            int y = read();\n            x = find(x),y = find(y);\n            if(x == y) continue;\n            merge(x,y);\n        }\n    }\n    ll mx = 0,ans = 0;\n    for(int i = 1;i <= n;++i) {\n        int rt = find(i);\n        if(vis[rt]) continue;\n        vis[rt] = 1;\n        ans += T[rt].val;\n        mx = std::max(mx,T[rt].val);\n    }\n    if(W == 2) ans -= mx;\n    else if(W == 3) ans += mx;\n    if(!ans)\n        putC('G'),putC('e'),putC('n'),putC('s'),putC('o'),putC('k'),putC('y'),putC('o');\n    else if(ans > K)\n        putC('H'),putC('e'),putC('l'),putC('l');\n    else\n        putC('H'),putC('e'),putC('a'),putC('v'),putC('e'),putC('n');\n    space,write(ans),enter;\n}\n\nint main() {\n\tinit_IO();\n\tint T = read();W = read(),K = read();\n\twhile(T--) solve();\n\tend_IO();\n\treturn 0;\n}\n```",
        "postTime": 1635753388,
        "uid": 122520,
        "name": "\u671b\u6708Asta",
        "ccfLevel": 6,
        "title": "P4971 \u9898\u89e3"
    },
    {
        "content": "\u5173\u952e\u8bcd\uff1a\u5de6\u504f\u6811\u3002\n\n\u8981\u6c42\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\uff1a\n\n1. \u5220\u9664\u96c6\u5408\u5143\u7d20\n  \n2. \u51cf\u5c0f\u96c6\u5408\u6700\u5927\u503c\n  \n3. \u5408\u5e76\u4e24\u4e2a\u96c6\u5408\n  \n4. \u67e5\u8be2\u96c6\u5408\u6700\u5927\u503c\n  \n\n\u672c\u9898\u76f8\u5f53\u4e8e\u662f\u5de6\u504f\u6811\u7684\u6a21\u677f\u9898\uff0c\u5de6\u504f\u6811\u662f\u4e00\u79cd\u53ef\u5e76\u5806\uff0c\u5177\u6709\u5806\u7684\u6027\u8d28\u5e76\u4e14\u53ef\u4ee5\u5feb\u901f\u5408\u5e76\u96c6\u5408\u3002\u5de6\u504f\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u8bb0\u5f55\u4e86\u4e00\u4e2a `dist`\uff0c\u8fd9\u4e2a\u503c\u5bf9\u4e8e\u7a7a\u8282\u70b9\u662f 0\uff0c\u5bf9\u4e8e\u5de6\u5b50\u8282\u70b9\u6216\u53f3\u5b50\u8282\u70b9\u4e3a\u7a7a\u7684\u8282\u70b9\uff08\u8fd9\u7c7b\u8282\u70b9\u4e5f\u79f0\u4e3a\u5916\u8282\u70b9\uff09\u662f 1\uff0c\u5bf9\u4e8e\u5176\u4f59\u7684\u8282\u70b9\u5219\u4e3a\u8be5\u8282\u70b9\u5230\u6700\u8fd1\u5916\u8282\u70b9\u7684\u8ddd\u79bb\u52a0\u4e00\u3002\u5de6\u504f\u6811\u5177\u6709\u7684\u5de6\u504f\u6027\u8d28\u7531 `dist` \u4fdd\u8bc1\uff0c\u5373\u6bcf\u4e2a\u8282\u70b9\u7684 `dist` \u90fd\u662f\u5176\u53f3\u5b50\u8282\u70b9\u7684 `dist` \u52a0\u4e00\u3002\u6ce8\u610f `dist` \u5e76\u4e0d\u7b49\u4ef7\u4e8e\u5de6\u504f\u6811\u7684\u6df1\u5ea6\uff0c\u6240\u4ee5\u5de6\u504f\u6811\u7684\u6df1\u5ea6\u5e76\u65e0\u4fdd\u8bc1\u3002\n\n**\u5408\u5e76\u96c6\u5408**\n\n\u5de6\u504f\u6811\u4f5c\u4e3a\u4e00\u79cd\u53ef\u5e76\u5806\uff0c\u6700\u91cd\u8981\u7684\u64cd\u4f5c\u662f\u5408\u5e76\u4e24\u4e2a\u96c6\u5408\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5feb\u5730\u60f3\u5230\u5e76\u67e5\u96c6\u5408\u5e76\u4e24\u4e2a\u96c6\u5408\u3002\u7531\u4e8e\u8981\u6ee1\u8db3\u5806\u7684\u6027\u8d28\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u503c\u8f83\u5927\u7684\u6839\u4f5c\u4e3a\u6839\u8282\u70b9\uff0c\u8ba9\u503c\u8f83\u5c0f\u7684\u96c6\u5408\u4ee5\u6839\u8282\u70b9\u7684\u5de6\u5b50\u8282\u70b9\u7684\u8eab\u4efd\u5408\u5e76\u5165\u8fd9\u4e2a\u96c6\u5408\uff0c\u7136\u540e\u9012\u5f52\u4e0b\u53bb\uff0c\u4e0d\u65ad\u5408\u5e76\u6839\u8282\u70b9\u53f3\u5b50\u8282\u70b9\u5bf9\u5e94\u96c6\u5408\u548c\u53e6\u4e00\u4e2a\u96c6\u5408\uff0c\u6ce8\u610f\u5728\u9012\u5f52\u8fc7\u7a0b\u4e2d\u7ef4\u62a4\u5de6\u504f\u6027\u8d28\u3002\n\n\u4e0b\u9762\u7684\u4ee3\u7801\u5b9e\u73b0\u4e2d\uff0c`root` \u5c31\u662f\u5e76\u67e5\u96c6\u7684\u6570\u7ec4\uff0c\u8fd9\u4e2a\u5e76\u67e5\u96c6\u53ef\u4ee5\u8def\u5f84\u538b\u7f29\u3002\n\n```cpp\nint merge(int u,int v){\n  if(u==0||v==0) return u|v;\n  if(tree[u].val<tree[v].val) std::swap(u,v);\n  else if(tree[u].val==tree[v].val&&u>v) std::swap(u,v);\n  tree[u].rson=merge(tree[u].rson,v);\n  if(tree[tree[u].lson].dis<tree[tree[u].rson].dis)\n    std::swap(tree[u].lson,tree[u].rson);\n  root[tree[u].lson]=root[tree[u].rson]=root[u]=u;\n  tree[u].dis=tree[tree[u].rson].dis+1;\n  return u;\n}\n```\n\n**\u5220\u9664\u96c6\u5408\u5143\u7d20**\n\n\u5148\u5c06\u88ab\u5220\u9664\u5143\u7d20\u5bf9\u5e94\u8282\u70b9\u7684\u5de6\u53f3\u5b50\u8282\u70b9\u5408\u5e76\u6210\u4e00\u4e2a\u5806\uff0c\u4e4b\u540e\u5c06\u8fd9\u4e2a\u5408\u5e76\u540e\u7684\u5806\u548c\u539f\u672c\u88ab\u5220\u9664\u5143\u7d20\u5bf9\u5e94\u8282\u70b9\u6240\u5728\u96c6\u5408\u7684\u6839\u5408\u5e76\uff0c\u8fd9\u6837\u5c31\u5b64\u7acb\u51fa\u4e86\u8fd9\u4e2a\u88ab\u5220\u9664\u7684\u8282\u70b9\uff0c\u628a\u8fd9\u4e2a\u8282\u70b9\u6e05\u7a7a\u5373\u53ef\u3002\u6ce8\u610f\u5728\u8fc7\u7a0b\u4e2d\u7ef4\u62a4 `dist`\u3002\n\n```cpp\nint find(int u){\n  if(root[u]==u) return u;\n  return root[u]=find(root[u]);\n}\nvoid pop(int u){\n  int ls=tree[u].lson,rs=tree[u].rson;\n  root[ls]=ls,root[rs]=rs;\n  tree[u]=node{0,0,0,0};\n  merge(merge(ls,rs),find(u));\n}\n```\n\n**\u51cf\u5c0f\u96c6\u5408\u6700\u5927\u503c**\n\n\u627e\u5230\u96c6\u5408\u7684\u6700\u5927\u503c\u540e\u76f4\u63a5\u5bf9\u8fd9\u4e2a\u8282\u70b9\u7684\u503c\u8fdb\u884c\u4fee\u6539\u3002\u8fd9\u6837\u505a\u53ef\u80fd\u7834\u574f\u5806\u7684\u6027\u8d28\uff0c\u6240\u4ee5\u6211\u4eec\u50cf\u4e0a\u8ff0\u64cd\u4f5c\u4e00\u6837\u5c06\u8fd9\u4e2a\u88ab\u4fee\u6539\u7684\u8282\u70b9\u5b64\u7acb\u51fa\u6765\uff0c\u4f46\u662f\u4e0d\u628a\u5b83\u6e05\u7a7a\uff0c\u800c\u662f\u8ba9\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u96c6\u5408\u548c\u5b83\u539f\u672c\u7684\u5de6\u53f3\u5b50\u8282\u70b9\u5bf9\u5e94\u7684\u4e24\u4e2a\u96c6\u5408\u5408\u5e76\u3002\n\n```cpp\nvoid reduce(int u,ll val){\n  u=find(u);\n  int ls=tree[u].lson,rs=tree[u].rson;\n  tree[u].val=std::max(0LL,tree[u].val-val);\n  root[tree[u].lson]=ls;\n  root[tree[u].rson]=rs;\n  tree[u]=node{0,0,0,tree[u].val};\n  merge(merge(ls,rs),u);\n}\n```\n\n**\u67e5\u8be2\u96c6\u5408\u6700\u5927\u503c**\uff08\u7edf\u8ba1\u7b54\u6848\uff09\n\n\u524d\u9762\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u53ea\u662f\u8fd9\u9053\u9898\u524d\u9762\u64cd\u4f5c\u7684\u90e8\u5206\uff0c\u540e\u9762\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u662f\u6240\u6709\u96c6\u5408\u7684\u6700\u5927\u503c\u76f8\u52a0\uff0c\u5e76\u6839\u636e\u8f93\u5165\u6761\u4ef6\u51cf\u53bb\u6216\u52a0\u4e0a\u6240\u6709\u96c6\u5408\u7684\u6700\u5927\u503c\u4e2d\u6700\u5927\u7684\u503c\u3002\u7531\u4e8e\u5de6\u504f\u6811\u662f\u4e00\u4e2a\u53ef\u5e76\u5806\uff0c\u5177\u6709\u5806\u7684\u6027\u8d28\uff0c\u6240\u4ee5\u53ea\u9700\u53d6\u51fa\u5806\u9876\u5373\u53ef\u3002\u4e3a\u4e86\u9632\u6b62\u91cd\u590d\u7edf\u8ba1\u96c6\u5408\u6216\u662f\u7edf\u8ba1\u4e86\u5df2\u7ecf\u88ab\u5220\u9664\u7684\u8282\u70b9\uff0c\u6211\u4eec\u5728\u5de6\u504f\u6811\u5916\u53e6\u5f00\u4e00\u4e2a\u6570\u7ec4\u6765\u8bb0\u5f55\u8fd9\u4e2a\u96c6\u5408\u7684\u8d21\u732e\u662f\u5426\u9700\u8981\u7edf\u8ba1\u3002\n\n\u4e0b\u9762\u7684\u4ee3\u7801\u5b9e\u73b0\u4e2d\uff0c`LT` \u662f\u6211\u5c01\u88c5\u7684\u4e00\u4e2a\u5de6\u504f\u6811\u7ed3\u6784\u4f53\u3002\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\u7684\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nscanf(\"%d%d\",&n,&m);\nLT.clear(n);\nstd::fill(kind,kind+n+1,false);\nfor(int cx=1;cx<=n;++cx)\n  scanf(\"%lld\",&LT.tree[cx].val);\nfor(int cx=1;cx<=m;++cx){\n  int opt,u,v; ll val;\n  scanf(\"%d\",&opt);\n  if(opt==2){\n    scanf(\"%d\",&u);\n    if(kind[u]) continue;\n    kind[u]=true;\n    LT.pop(u);\n  }else if(opt==3){\n    scanf(\"%d%lld\",&u,&val);\n    LT.reduce(u,val);\n  }else if(opt==4){\n    scanf(\"%d%d\",&u,&v);\n    int fu=LT.find(u),fv=LT.find(v);\n    if(fu==fv) continue;\n    LT.merge(fu,fv);\n  }\n}\n```\n\n\u7edf\u8ba1\u7b54\u6848\u7684\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a\n\n```cpp\nll mx=0,ans=0;\nfor(int cx=1;cx<=n;++cx){\n int rt=LT.find(cx);\n if(kind[rt]) continue;\n kind[rt]=true;\n ans+=LT.tree[rt].val;\n mx=std::max(mx,LT.tree[rt].val);\n}\nif(w==2) ans-=mx;\nelse if(w==3) ans+=mx;\nif(ans==0) puts(\"Gensokyo 0\");\nelse if(ans>k) printf(\"Hell %lld\\n\",ans);\nelse printf(\"Heaven %lld\\n\",ans);\n```\n\n\u6ce8\u610f\u672c\u9898\u591a\u6d4b\uff0c\u8981\u8bb0\u5f97\u91cd\u65b0\u521d\u59cb\u5316\u3002\u90a3\u4e48\u8fd9\u9053\u9898\u7684\u4e3b\u8981\u4ee3\u7801\u5b9e\u73b0\u5c31\u90fd\u8bb2\u89e3\u5b8c\u4e86\u3002\n\n\u53e6\u9644\uff1a[\u63d0\u4ea4\u8bb0\u5f55](https://www.luogu.com.cn/record/74739306)\uff0c\u60f3\u8981\u5b8c\u6574\u4ee3\u7801\u53ef\u4ee5\u627e\u6211\u3002",
        "postTime": 1651237844,
        "uid": 496840,
        "name": "SAMSHAWCRAFT",
        "ccfLevel": 0,
        "title": "\u65ad\u7f6a\u8005 - \u9898\u89e3"
    },
    {
        "content": "## 0.\u524d\u8a00\r\n\r\n\u672c\u7bc7\u9898\u89e3\u9002\u5408\u6709\u5de6\u504f\u6811\u57fa\u7840\u7684 OIer\uff0c\u82e5\u6ca1\u6709\u5b66\u8fc7\u6b64\u7b97\u6cd5\uff0c\u8bf7\u79fb\u6b65\u81f3\u6a21\u677f\u9898\u3002\r\n\r\n## 1.\u9898\u610f\r\n\r\n\u8981\u6c42\u4e00\u5171\u6709\u4e09\u4e2a\u64cd\u4f5c\uff1a\r\n\r\n`2 A` \u5c06 $A$ \u7684\u503c\u4fee\u6539\u4e3a $0$\r\n\r\n`3 A B` $A$ \u6240\u5728\u7684\u96c6\u5408\u6700\u5927\u503c\u51cf\u5c0f $B$\uff0c\u4e0e $0$ \u53d6\u6700\u5927\u503c\r\n\r\n`4 A B` \u5408\u5e76 $A,B$ \u96c6\u5408\r\n\r\n\u67e5\u8be2\u64cd\u4f5c\u8be6\u7ec6\u770b\u9898\u9762\u3002\r\n\r\n## 2.\u5206\u6790\r\n\r\n\u96c6\u5408\uff0c\u6700\u5927\u503c\uff0c\u5408\u5e76\u7b49\u5173\u952e\u8bcd\uff0c\u53ef\u4ee5\u60f3\u5230\u7528\u5de6\u504f\u6811\u6765\u7ef4\u62a4\u3002\r\n\r\n\u5bf9\u4e8e\u4fee\u6539\u4efb\u4e00\u8282\u70b9\uff0c\u5c06\u5176\u5de6\u53f3\u513f\u5b50\u5408\u5e76\uff0c\u518d\u4e0e\u539f\u5de6\u53f3\u513f\u5b50\u6240\u5728\u7684\u5806\u5408\u5e76\u5373\u53ef\u3002\r\n\r\n\u6ce8\u610f\u4fee\u6539\u65f6\u9700\u8981\u81ea\u5e95\u5411\u4e0a\u66f4\u65b0 $dist$\uff0c\u4e0d\u6ee1\u8db3\u5de6\u504f\u6811\u6027\u8d28\u65f6\u5219\u4ea4\u6362\u5de6\u53f3\u8282\u70b9\u3002\r\n\r\n## 3. \u4ee3\u7801\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define int long long\r\nusing namespace std;\r\nint T,n,m,w,k,opt,a,b,sum,maxx;\r\nbool vis[2000005];\r\nstruct node{\r\n\tint dist,ch[2],val,id,fa;\r\n\tbool operator<(node &x)const{return val==x.val?id>=x.id:val<x.val;}//\u91cd\u8f7d\u8fd0\u7b97\u7b26 \r\n}t[2000005];\r\nint find(int x){return t[x].fa==x?x:t[x].fa=find(t[x].fa);}//\u7528\u8def\u5f84\u538b\u7f29\u7684\u65b9\u6cd5\u628a\u627e\u5230\u5f53\u524d\u5806\u6839\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u5230 O(nlogn) \r\nint& rs(int x){return t[x].ch[t[t[x].ch[0]].dist<t[t[x].ch[1]].dist];}//\u8fd4\u56de\u53f3\u513f\u5b50\u8282\u70b9\r\nvoid pushup(int x){\r\n\tif(!x)return;\r\n\tif(t[x].dist^(t[rs(x)].dist+1))t[x].dist=t[rs(x)].dist+1,pushup(t[x].fa);//\u81ea\u5e95\u5411\u4e0a\u66f4\u65b0dist \r\n}\r\nint merge(int x,int y){\r\n\tif((!x)||(!y))return x|y;\r\n\tif(t[x]<t[y])swap(x,y);\r\n\tt[rs(x)=merge(rs(x),y)].fa=x;//\u57fa\u7840\u5408\u5e76\u64cd\u4f5c \r\n\tpushup(x);return x;//\u66f4\u65b0dist \r\n}\r\nsigned main(){\r\n\tcin>>T>>w>>k;\r\n\tfor(int i=1;i<=T;i++){\r\n\t\tmemset(vis,0,sizeof vis);\r\n\t\tcin>>n>>m;sum=maxx=0; //\u6ce8\u610f\u521d\u59cb\u5316\uff01\uff01\uff01 \r\n\t\tt[0].dist=t[0].ch[0]=t[0].ch[1]=t[0].val=t[0].id=t[0].fa=0;\r\n\t\tfor(int j=1;j<=n;j++)cin>>t[j].val,t[j].id=t[j].fa=j,t[j].ch[0]=t[j].ch[1]=t[j].dist=0;\r\n\t\tfor(int j=1;j<=m;j++){\r\n\t\t\tcin>>opt>>a;\r\n\t\t\tif(opt==2){\r\n\t\t\t\tint q=0;\r\n\t\t\t\tt[a].val=0;\r\n\t\t\t\tq=t[t[a].ch[0]].fa=t[t[a].ch[1]].fa=merge(t[a].ch[0],t[a].ch[1]);\r\n\t\t\t\tq=find(q);\r\n\t\t\t\tt[a].ch[0]=t[a].ch[1]=t[a].dist=0;\r\n\t\t\t\ta=find(a);\r\n\t\t\t\tt[a].fa=t[q].fa=merge(q,a);\r\n\t\t\t}\r\n\t\t\tif(opt==3){\r\n\t\t\t\tcin>>b;a=find(a);\r\n\t\t\t\tint q=0;\r\n\t\t\t\tt[a].val=max(t[a].val-b,0ll);\r\n\t\t\t\tq=t[t[a].ch[0]].fa=t[t[a].ch[1]].fa=merge(t[a].ch[0],t[a].ch[1]);\r\n\t\t\t\tq=find(q);\r\n\t\t\t\tt[a].ch[0]=t[a].ch[1]=t[a].dist=0;\r\n\t\t\t\ta=find(a);\r\n\t\t\t\tt[a].fa=t[q].fa=merge(q,a);\r\n\t\t\t}\r\n\t\t\tif(opt==4){\r\n\t\t\t\tcin>>b;a=find(a),b=find(b);\r\n\t\t\t\tif(a^b)t[a].fa=t[b].fa=merge(a,b);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(int j=1;j<=n;j++){//\u67e5\u8be2\u76f4\u63a5\u6a21\u62df\u5373\u53ef \r\n\t\t\tint x=find(j);\r\n\t\t\tif(!vis[x]){\r\n\t\t\t\tvis[x]=1;\r\n\t\t\t\tmaxx=max(maxx,t[x].val),sum+=t[x].val;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(w==2)sum-=maxx;\r\n\t\tif(w==3)sum+=maxx;\r\n\t\tif(!sum)puts(\"Gensokyo 0\");\r\n\t\telse if(sum<=k)printf(\"Heaven %lld\\n\",sum);\r\n\t\telse printf(\"Hell %lld\\n\",sum);\r\n\t}\r\n\treturn 0;\r\n}\r\n```\r\n## 4.\u51e0\u4e2a\u5751\u70b9\r\n\u6211\u5168\u90fd\u8e29\u8fc7\u554aqwq\r\n\r\n1. \u591a\u6d4b\u6ce8\u610f\u521d\u59cb\u5316\uff01\r\n\r\n2. \u6ce8\u610f\u4fee\u6539\u503c\u4e4b\u540e\u8bb0\u5f97\u4e0e\u539f\u5de6\u53f3\u513f\u5b50\u7684\u5806\u5408\u5e76\uff0c\u5e76\u4e0d\u662f\u628a\u5b83\u6c38\u4e45\u5220\u9664\uff01\r\n\r\n3. \u6211\u7684 `merge` \u51fd\u6570\u4e2d\u6ca1\u6709\u627e $x,y$ \u7684\u5806\u7684\u6839\u8282\u70b9\uff0c\u6240\u4ee5\u6ce8\u610f\u8981\u4fdd\u8bc1\u5408\u5e76\u65f6 $x,y$ \u5df2\u7ecf\u662f\u5806\u7684\u6839\u8282\u70b9\uff08\u5373\u5728 `merge` \u4e4b\u524d `find`\uff0c\u8be6\u60c5\u89c1\u4ee3\u7801\uff09\uff01\r\n\r\n4. \u6ce8\u610f\u662f\u503c\u76f8\u540c\u65f6\uff0c\u7f16\u53f7\u8d8a\u5c0f\u7684\u8d8a\u201c\u5927\u201d\uff0c\u6240\u4ee5\u91cd\u8f7d\u8fd0\u7b97\u7b26\u65f6\u9700\u8981\u641e\u6e05\u695a\u7b26\u53f7\uff01\r\n\r\n\u5c31\u63d0\u9192\u8fd9\u4e48\u591a\u4e86\uff0c\u5404\u4f4d\u597d\u8fd0/bx",
        "postTime": 1679464875,
        "uid": 373355,
        "name": "alex_liu",
        "ccfLevel": 0,
        "title": "P4971 \u65ad\u7f6a\u8005"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4971)\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\n\n[\u5de6\u504f\u6811](https://wdsa001.github.io/2021/12/17/zui-xiao-shu-xing-tu-zuo-pian-shu/#toc-heading-6)\n\n[\u5e76\u67e5\u96c6](https://wdsa001.github.io/2021/12/23/ke-chi-jiu-hua-bing-cha-ji/#toc-heading-1)\n\n\u9898\u76ee\u8981\u6211\u4eec\u5b9e\u73b0\u5e76\u67e5\u96c6\u7684\u4e09\u4e2a\u64cd\u4f5c\uff1a\u5220\u70b9\uff0c\u5355\u70b9\u4fee\u6539\uff0c\u5408\u5e76\u96c6\u5408\uff08\u6ce8\u610f\uff1a\u9898\u76ee\u4e2d\u7684\u56db\u79cd\u64cd\u4f5c\u53ea\u4f1a\u6709\u540e\u4e09\u79cd\u64cd\u4f5c\uff09\u3002\n\n\u800c\u5bf9\u4e8e\u6b7b\u4ea1\u65b9\u5f0f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b58\u50a8\u6700\u5927\u7684\u7f6a\u6076\u503c\uff0c\u5355\u72ec\u8ba8\u8bba\u5373\u53ef\u3002\n\n### \u601d\u8def\n\n- \u6e05\u7a7a\uff0c\u521d\u59cb\u5316\u6570\u636e\uff08\u6ce8\u610f\u662f\u591a\u6d4b\uff09\u3002\n\n- \u8bfb\u5165\u57fa\u672c\u4fe1\u606f\u3002\n\n\u5728\u5904\u7406\u5355\u70b9\u4fee\u6539\u65f6\uff0c\u9898\u76ee\u8981\u6211\u4eec\u627e\u5230\u6700\u5927\u7684\u7f6a\u6076\u503c\u8fdb\u884c\u4fee\u6539\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u7ef4\u62a4\u6700\u5927\u503c\uff0c\u8fd9\u91cc\u7528\u7684\u65b9\u6cd5\u662f\u5de6\u504f\u6811\u3002\n\n\u6211\u4eec\u7528\u5de6\u504f\u6811\u6765\u7ef4\u62a4\u7f6a\u6076\u503c\u7684\u5927\u6839\u5806\u3002\n\n- \u5220\u70b9\uff1a\n\n\u5c06\u8282\u70b9\u7684\u57fa\u7840\u4fe1\u606f\u6e05\u7a7a\uff08\u7f6a\u6076\u503c\uff0c\u5de6\u53f3\u5b50\u6811\u8282\u70b9\u8bb0\u53f7\uff0c\u8fd8\u6709\u5de6\u53f3\u5b50\u6811\u7684\u7236\u8282\u70b9\u53d8\u6210\u5176\u672c\u8eab\uff09\uff0c\u5e76\u66f4\u65b0\u5de6\u504f\u6811\uff0c\u8fd9\u65f6\u6211\u4eec\u9700\u8981\u6709\u57fa\u7840\u64cd\u4f5c\uff1a\u5408\u5e76\u5de6\u53f3\u5b50\u6811\u3002\u5c31\u662f\u5de6\u504f\u6811\u7684\u57fa\u672c\u64cd\u4f5c\u3002\n\n- \u5408\u5e76\u5de6\u504f\u6811\uff1a\n\n\u6309\u7167\u7f6a\u6076\u503c\u5efa\u6210\u4e00\u4e2a\u5927\u6839\u5806\u7684\u5de6\u504f\u6811\uff0c\u6211\u4eec\u53ea\u8981\u5feb\u901f\u6c42\u6700\u5927\u503c\u3002\u5176\u4ed6\u7684\u548c\u5de6\u504f\u6811\u6ca1\u53d8\u5316\u3002\n\n- \u5355\u70b9\u4fee\u6539\uff1a\n\n\u627e\u5230\u76ee\u6807\u96c6\u5408\u7684\u7956\u5148\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7ef4\u62a4\u7684\u5de6\u504f\u6811\u7684\u6839\u8282\u70b9\uff08\u6700\u5927\u7f6a\u6076\u503c\u8282\u70b9\uff09\u6839\u636e\u8981\u6c42\u66f4\u65b0\u3002\u66f4\u65b0\u5b8c\u540e\uff0c\u5c06\u8282\u70b9\u5220\u9664\u3002\n\n- \u96c6\u5408\u5408\u5e76\uff1a\n\n\u5c06\u76ee\u6807\u7f16\u53f7\u7684\u7956\u5148\u627e\u5230\u5de6\u504f\u6811\u5b50\u6811\u5408\u5e76\u5373\u53ef\u3002\n\n- \u53bb\u4e16\u65b9\u5f0f\uff1a\n\n\u5c06\u6240\u6709\u7f6a\u6076\u503c\u7edf\u8ba1\u4e00\u904d\uff0c\u6ce8\u610f\u8bbe\u4e00\u4e2a\u6570\u7ec4\u5224\u91cd\uff0c\u5e76\u8bb0\u5f55\u6700\u5927\u7684\u7f6a\u6076\u503c\u3002\u8fd9\u6837\u64cd\u4f5c $2,3$ \u5c31\u53d8\u6210\u4e86\uff0c\u51cf\u53bb\u6700\u5927\u503c\u548c\u52a0\u4e0a\u6700\u5927\u503c\u3002\n\n\u6700\u540e\u6839\u636e\u9898\u76ee\u8981\u6c42\u8f93\u51fa\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<string>\n#include<cstring>\n#include<cctype>\nusing namespace std;\nlong long r_r(){//\u5feb\u8bfb \n\tlong long x=0,f=1;\n\tchar c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=(x<<1)+(x<<3)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\nconst int o_o=1e7+10;\nlong long t=r_r(),w=r_r(),k=r_r();\nlong long v_v[o_o];//\u6bcf\u4ef6\u4e8b\u7684\u7f6a\u6076\u503c \nlong long d_p[o_o];//\u5de6\u504f\u6811\u53f6\u5b50\u7ed3\u70b9\u6df1\u5ea6 \nbool b_b[o_o];//\u6807\u8bb0\uff0c\u53bb\u91cd \nlong long f_a[o_o];//\u5b58\u7236\u8282\u70b9 \nlong long l_i[o_o];//\u5b58\u7ed3\u70b9\u5de6\u5b50\u6811\u7f16\u53f7 \nlong long r_i[o_o];//\u5b58\u7ed3\u70b9\u53f3\u5b50\u6811\u7f16\u53f7 \nlong long f(long long x){//\u67e5\u627e\u7956\u5148\u8282\u70b9 \n\tif(f_a[x]==x)return x;\n\treturn f_a[x]=f(f_a[x]);\n}\nlong long b_g(long long x,long long y){//\u5408\u5e76\u5b50\u6811 \n\tif(!x||!y)return x+y;//\u5b58\u5728\u7a7a\u53f6\u5b50\uff0c\u76f4\u63a5\u5408\u5e76 \n\t\n\tif(v_v[x]<v_v[y]||(v_v[x]==v_v[y]&&x>y))swap(x,y);\n\t//\u4fdd\u8bc1\u5de6\u5b50\u6811\u7f6a\u6076\u503c\u5c0f\u4e8e\u53f3\u5b50\u6811\u7f6a\u6076\u503c \n\n\tr_i[x]=b_g(r_i[x],y);//\u53f3\u8282\u70b9\u548c\u53f3\u5b50\u8282\u70b9\u7ee7\u7eed\u6bd4\u8f83\uff0c\u5e76\u66f4\u65b0\u6839\u8282\u70b9 \n\t\n\tif(d_p[l_i[x]]<d_p[r_i[x]])swap(l_i[x],r_i[x]);\n\t//\u4fdd\u8bc1\u5de6\u5b50\u6811\u7684\u6df1\u5ea6\u4e0d\u5c0f\u4e8e\u53f3\u5b50\u6811\u6df1\u5ea6\n\t\n\tf_a[l_i[x]]=f_a[r_i[x]]=f_a[x]=x;//\u66f4\u65b0\u7236\u8282\u70b9 \n\td_p[x]=d_p[r_i[x]]+1;//\u66f4\u65b0\u6df1\u5ea6 \n\treturn x;//\u8fd4\u56de\u6839\u8282\u70b9\u7f16\u53f7 \n}\nvoid d_l(long long x){\n\tlong long l=l_i[x],r=r_i[x];//\u8bb0\u5f55\u5de6\u53f3\u5b50\u6811 \n\t\n\t//\u66f4\u65b0\u7236\u8282\u70b9 \n\tf_a[l]=l;\n\tf_a[r]=r;\n\t\n\tl_i[x]=r_i[x]=d_p[x]=0;//\u6e05\u7a7a\u8bb0\u5f55 \n\tb_g(b_g(l,r),f(x));//\u5408\u5e76\u5de6\u53f3\u5b50\u6811 \n}\nint main(){\n\tfor(int i=1;i<=t;i++){\n\t\t\n\t\t//\u521d\u59cb\u5316\u57fa\u7840\u4fe1\u606f \n\t\td_p[0]=0;\n\t\tf_a[0]=0;\n\t\tl_i[0]=r_i[0]=0;\n    \tmemset(b_b,0,sizeof(b_b));\n    \t\n\t\tlong long n=r_r(),m=r_r();\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tv_v[i]=r_r();//\u8bfb\u5165\u7f6a\u6076\u503c \n\t\t\tf_a[i]=i;//\u521d\u59cb\u5316\u7236\u8282\u70b9 \n\t\t\tr_i[i]=l_i[i]=d_p[i]=0;//\u521d\u59cb\u5316\u4fe1\u606f \n\t\t}\n\t\tfor(int i=1;i<=m;i++){\n\t\t\tlong long t_p=r_r(),x=r_r();\n\t\t\tif(t_p==4){\n\t\t\t\tlong long y=r_r();\n\t\t\t\tx=f(x);//\u7956\u5148\u8282\u70b9 \n\t\t\t\ty=f(y);//\u7956\u5148\u8282\u70b9 \n                if(x==y)continue;//\u5df2\u7ecf\u5728\u4e00\u4e2a\u96c6\u5408\u4e86\uff0c\u4e0d\u7528\u5408\u5e76\u4e86 \n                b_g(x,y);//\u5408\u5e76\u5b50\u6811 \n\t\t\t}else if(t_p==2){\n\t\t\t\tv_v[x]=0;//\u6e05\u96f6 \n\t\t\t\td_l(x);//\u5220\u70b9 \n\t\t\t}else {\n\t\t\t\tlong long y=r_r();\n\t\t\t\tx=f(x);//\u7956\u5148\u8282\u70b9\uff08\u7f6a\u6076\u503c\u6700\u5927\u8282\u70b9\uff09 \n\t\t\t\tv_v[x]=max(v_v[x]-y,0ll);//\u5982\u679c\u591f\u51cf\u76f4\u63a5\u51cf\uff0c\u5426\u5219\u6e05\u96f6 \n\t\t\t\td_l(x);//\u5220\u70b9 \n\t\t\t}\n\t\t}\n\t\tlong long s_m=0,m_a=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tlong long g_g=f(i);//\u7956\u5148\u8282\u70b9 \n\t\t\tif(b_b[g_g])continue;//\u5df2\u7ecf\u6807\u8bb0\u8fc7 \n\t\t\tb_b[g_g]=1;//\u6807\u8bb0 \n\t\t\tm_a=max(m_a,v_v[g_g]);//\u8bb0\u5f55\u6700\u5927\u503c \n\t\t\ts_m+=v_v[g_g];//\u8bb0\u5f55\u7f6a\u6076\u503c\u7684\u548c \n\t\t}\n\t\tif(w==2)s_m-=m_a;//\u514d\u9664\u6700\u5927\u7f6a\u6076\u503c \n\t\telse if(w==3)s_m+=m_a;//\u6700\u5927\u7f6a\u6076\u503c\u7ffb\u500d \n\t\t\n\t\t//\u6839\u636e\u89c4\u5b9a\u8f93\u51fa \n\t\tif(!s_m)printf(\"Gensokyo 0\\n\"); \n\t\telse if(s_m>k)printf(\"Hell %lld\\n\",s_m);\n\t\telse printf(\"Heaven %lld\\n\",s_m);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1640260614,
        "uid": 120012,
        "name": "\u738b\u5927\u795e\u2014\u2014A001",
        "ccfLevel": 0,
        "title": "P4971 \u65ad\u7f6a\u8005\u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P4971)\n\n\u7ed9\u4f60 $t$ \u7ec4\u6570\u636e\u548c\u8f93\u51fa\u65b9\u5f0f $w$\uff0c\u8981\u6c42\u5b9e\u73b0\u4e09\u4e2a\u64cd\u4f5c\uff1a\n\n1. \u4efb\u610f\u5220\u9664\u67d0\u4e2a\u70b9\n\n2. \u628a\u5806\u9876\u5143\u7d20\u6539\u4e3a\u67d0\u4e2a\u503c\n\n3. \u5408\u5e76\u4e24\u4e2a\u5806\n\n\u901a\u4fd7\u4e00\u70b9\u7684\u610f\u601d\u5c31\u662f\u7ef4\u62a4\u5de6\u504f\u6811\u3002\n\n## \u505a\u6cd5\n### \u7b97\u6cd5\u5206\u6790\n\u5f88\u660e\u663e\u66b4\u529b\u6a21\u62df\u4e00\u5b9a\u4f1a\u70b8\uff0c\u800c\u6839\u636e\uff0c\u6700\u5927\u503c\u548c\u5408\u5e76\u4e24\u4e2a\u5806\u8fd9\u4e24\u4e2a\u5173\u952e\u6027\u8bcd\u8bed\uff0c\u5c31\u53ef\u4ee5\u6572\u5b9a\u505a\u6cd5\u4e3a\u5de6\u504f\u6811\uff08\u53ef\u5e76\u5806\uff09\u3002\n### \u7b97\u6cd5\u5b9e\u73b0\n\u5de6\u504f\u6811\u94fe\u63a5\uff1a[link](https://www.luogu.com.cn/blog/natieyes/post-suan-fa-zuo-pian-shu-ke-bing-dui-post)\u3002\n\n\u4f7f\u7528\u5de6\u504f\u6811\u7ef4\u62a4\u6bcf\u4e2a\u5e8f\u5217\uff0c\u518d\u6839\u636e\u5904\u5211\u65b9\u5f0f $w$ \u6c42\u5f97\u7b54\u6848\u3002\n\n\u7531\u4e8e\u662f\u5927\u6839\u5806\uff0c\u6240\u4ee5 `merge` \u51fd\u6570\u4e2d\u7684 `swap` \u7684\u5224\u65ad\u6761\u4ef6\u5e94\u8be5\u6539\u4e3a `val[x]<val[y] or (val[x]==val[y] and x>y)`\u3002\n\n\u518d\u6765\u8bf4\u4e00\u4e0b\u5220\u9664\u4efb\u610f\u8282\u70b9\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u4e5f\u5f88\u7b80\u5355\uff1a\u628a\u6b64\u70b9\u53d6\u6d88\uff0c\u518d\u628a\u5de6\u53f3\u5b50\u6811\u5408\u5e76\uff0c\u6700\u540e\u518d\u628a\u5de6\u53f3\u5b50\u6811\u5408\u5e76\u6240\u5f62\u6210\u7684\u6811\u548c\u5176\u7236\u8282\u70b9\u6240\u5728\u7684\u6811\u5408\u5e76\uff0c\u5c31\u53ef\u5b8c\u6210\u64cd\u4f5c\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\nvoid Delete(long long x) {\n\tlong long L=l[x],R=r[x];\n\tfa[L]=L,fa[R]=R;\n\tl[x]=r[x]=dis[x]=0;\n\tmerge(merge(L,R),find(x));//\u5408\u5e76\n}\n```\n\n\u53e6\u5916\u7531\u4e8e\u591a\u7ec4\u6570\u636e\uff0c\u6240\u4ee5\u6bcf\u6c42\u5b8c\u4e00\u6b21\u7ed3\u679c\uff0c\u5c31\u5fc5\u987b\u628a\u6e05\u7a7a\uff08\u53ca\u4ee3\u7801\u4e2d\u7684 `clear` \u51fd\u6570\uff09\uff0c\u5176\u4ed6\u7684\u5305\u62ec\u8f93\u5165\uff0c\u5efa\u6811\u5957\u7b49\u7528\u6a21\u677f\u5373\u53ef\uff0c\u8bb0\u5f97\u6ce8\u610f\u89c4\u8303\u3002\n\n\u6ce8\u610f\u5f00 `long long`\u3002\n### Code\n```cpp\n#include <iostream>\n#include <cstring>\n\nusing namespace std;\nlong long t,w,k;\nlong long val[2000001],dis[2000001];\nlong long vis[2000001],fa[2000001];\nlong long l[2000001],r[2000001];\n\ninline void clear(){//\u521d\u59cb\u5316\n    fa[0]=dis[0]=l[0]=r[0]=0;\n    memset(vis,0,sizeof(vis));\n}\n\nlong long find(long long x) {return (fa[x]==x?x:fa[x]=find(fa[x]));}\n\nlong long merge(long long x,long long y) {//\u5408\u5e76\n\tif (!x or !y) {\n\t\treturn x+y;\n\t}\n\tif (val[x]<val[y] or (val[x]==val[y] and x>y)) swap(x,y);//\u6ce8\u610f\u5927\u6839\u5806\n\tr[x]=merge(r[x],y);\n\tif (dis[l[x]]<dis[r[x]]) swap(l[x],r[x]);\n\tfa[l[x]]=fa[r[x]]=fa[x]=x;\n\tdis[x]=dis[r[x]]+1;//\u66f4\u65b0\n\treturn x;\n}\n\nvoid Delete(long long x) {//\u5220\u9664\n\tlong long L=l[x],R=r[x];\n\tfa[L]=L,fa[R]=R;\n\tl[x]=r[x]=dis[x]=0;\n\tmerge(merge(L,R),find(x));\n}\n\nint main() {\n\tcin>>t>>w>>k;\n\tfor (long long i=1;i<=t;i++) {\n\t\tclear();\n\t\tlong long n,m;\n\t\tcin>>n>>m;\n\t\tfor (long long i=1;i<=n;i++) {\n\t\t\tcin>>val[i];\n\t\t\tfa[i]=i;\n\t\t\tr[i]=l[i]=dis[i]=0;\n\t\t}\n\t\tfor (long long i=1;i<=m;i++) {\n\t\t\tlong long tmp,x,y;\n\t\t\tcin>>tmp>>x;\n\t\t\tif (tmp==2) {\n\t\t\t\tval[x]=0;\n\t\t\t\tDelete(x);\n\t\t\t} else if (tmp==3) {\n\t\t\t\tcin>>y;\n\t\t\t\tx=find(x);val[x]-=val[x]>y?y:val[x];Delete(x);\n\t\t\t} else {\n\t\t\t\tcin>>y;\n\t\t\t\tx=find(x);y=find(y);\n                if (x==y) continue;\n                merge(x,y);\n\t\t\t}\n\t\t}\n\t\tlong long sum=0,maxn=0;\n\t\tfor (long long i=1;i<=n;i++) {\n\t\t\tlong long root=find(i);\n\t\t\tif (vis[root]) continue;\n\t\t\tvis[root]=1;\n\t\t\tmaxn=max(maxn,val[root]);\n\t\t\tsum+=val[root];\n\t\t}\n        //\u8f93\u51fa\u65b9\u5f0f\n\t\tif (w==2) sum-=maxn;\n\t\telse if (w==3) sum+=maxn;\n\t\tif (!sum) cout<<\"Gensokyo \"<<sum<<endl;\n\t\telse if (sum>k) cout<<\"Hell \"<<sum<<endl;\n\t\telse cout<<\"Heaven \"<<sum<<endl;\n\t}\n}\n```\n## \u94fe\u63a5\n[\u5de6\u504f\u6811\u6d45\u8c08](https://www.luogu.com.cn/blog/natieyes/post-suan-fa-zuo-pian-shu-ke-bing-dui-post)",
        "postTime": 1632299005,
        "uid": 420129,
        "name": "Nt_Tsumiki",
        "ccfLevel": 5,
        "title": "\u3010\u9898\u89e3\u3011 P4971 \u65ad\u7f6a\u8005"
    }
]