[
    {
        "content": "$$\n\\begin{aligned}\nR(v)&=\\sum_{s}\\sum_{t}\\frac{a_sa_t\\sigma_{st}(v)}{\\sigma_{st}}\\\\\n&=\\sum_s a_s \\sum_t \\frac{a_t \\sigma_{sv}\\sigma_{vt}}{\\sigma_{st}}\\\\\n&= \\sum_s a_s \\sigma_{sv} \\sum_t \\frac{a_t\\sigma_{tv}}{\\sigma_{st}}\n\\end{aligned}\n$$\n\n\u8003\u8651\u7528\u8ba1\u7b97\u8d21\u732e\u7684\u65b9\u6cd5\u505a\u3002\n\n$$\nR(v) \\leftarrow a_s \\sigma_{sv} \\sum_t \\frac{a_t\\sigma_{tv}}{\\sigma_{st}}\n$$\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9 $s$\uff0c\u5efa\u51fa\u4ee5\u5176\u4e3a\u6e90\u70b9\u7684\u6700\u77ed\u8def DAG \uff08\u5c06\u8fb9\u53cd\u5411\uff0c\u56e0\u4e3a DP \u7684\u987a\u5e8f\u4e3a\u62d3\u6251\u9006\u5e8f\uff09\uff0c\u7136\u540e DAG \u4e0a DP\u3002$\\sigma$ \u5728\u6c42\u6700\u77ed\u8def\u7684\u65f6\u5019\u5c31\u80fd\u7b97\u3002\u8bbe $f_u=\\sum_t\\frac{a_t\\sigma_{tv}}{\\sigma_{st}}$\u3002\u8f6c\u79fb\u4e3a\u5c06 $\\sigma_{u,t}=\\sigma_{u,v}\\times \\sigma_{v,t}$ \uff1a\n\n$$\nf_u=\\frac{a_u}{\\sigma_{su}}+\\sum_{v\\to u} f_vw_{uv}\n$$\n\n\u8981\u6ce8\u610f\uff0c$f$ \u5305\u542b $u=t$ \u7684\u60c5\u51b5\uff0c\u4e8e\u662f\u7b54\u6848\u9700\u8981\u5ffd\u7565\u8fd9\u79cd\u60c5\u51b5\u3002\n\n```cpp\n#define rep(i,a,b) for(register int i=(a);i<=(b);i++)\n#define per(i,a,b) for(register int i=(a);i>=(b);i--)\nusing namespace std;\nconst int N=1009, M=5009;\ntypedef pair<int,int> pii;\n\ninline long long read() {\n    register long long x=0, f=1; register char c=getchar();\n    while(c<'0'||c>'9') {if(c=='-') f=-1; c=getchar();}\n    while(c>='0'&&c<='9') {x=(x<<3)+(x<<1)+c-48,c=getchar();}\n    return x*f;\n}\n\nstruct edge {int to,nxt,w; double wd;} e[M*2]; int hd[N],tot=1;\nvoid add(int u,int v,int w,double wd) {e[++tot]=(edge){v,hd[u],w,wd};hd[u]=tot;}\n\nint n,m,d[N],deg[N],a[N];\nlong double sig[N],f[N],ans[N];\nbool vst[N];\nvector<edge>dag[N];\n\nvoid dijkstra(int s) {\n\tpriority_queue<pii>q; q.push(make_pair(0,s));\n\tmemset(d,0x3f,sizeof(d)), memset(vst,0,sizeof(vst));\n\td[s]=0, sig[s]=1;\n\twhile(!q.empty()) {\n\t\tint u=q.top().second; q.pop();\n\t\tif(vst[u]) continue; vst[u]=1;\n\t\tfor(int i=hd[u],v;i;i=e[i].nxt) {\n\t\t\tif(d[v=e[i].to]>d[u]+e[i].w)\n\t\t\t\td[v]=d[u]+e[i].w, q.push(make_pair(-d[v],v)), sig[v]=sig[u]*e[i].wd;\n\t\t\telse if(d[v]==d[u]+e[i].w) sig[v]+=sig[u]*e[i].wd;\n\t\t}\n\t}\n}\nvoid topo(int s) {\n\tqueue<int>q; memset(f,0,sizeof(f));\n\trep(i,1,n) if(!deg[i]) q.push(i);\n\twhile(!q.empty()) {\n\t\tint u=q.front(); q.pop();\n\t\tans[u]+=a[s]*sig[u]*f[u], f[u]+=a[u]/sig[u];\n\t\tfor(auto ed:dag[u]) {\n\t\t\tint v=ed.to; double wd=ed.wd;\n\t\t\tf[v]+=f[u]*wd, deg[v]--;\n\t\t\tif(!deg[v]) q.push(v);\n\t\t}\n\t}\n}\n\nint main() {\n\tn=read(), m=read();\n\trep(i,1,n) a[i]=read();\n\trep(i,1,m) {\n\t\tint u,v,w; double wd; scanf(\"%d%d%d%lf\",&u,&v,&w,&wd);\n\t\tadd(u,v,w,wd), add(v,u,w,wd);\n\t}\n\trep(s,1,n) {\n\t\tdijkstra(s); sig[s]=0;\n\t\trep(u,1,n) for(int i=hd[u],v;i;i=e[i].nxt) if(d[u]+e[i].w==d[v=e[i].to])\n\t\t\tdag[v].push_back(e[i^1]), deg[u]++;\n\t\ttopo(s);\n\t\trep(u,1,n) dag[u].clear();\n\t}\n\trep(i,1,n) printf(\"%.6Lf\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1619275401,
        "uid": 180652,
        "name": "_lgswdn",
        "ccfLevel": 0,
        "title": "P5882 [CTSC2015]misc"
    }
]