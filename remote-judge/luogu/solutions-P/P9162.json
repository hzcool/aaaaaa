[
    {
        "content": "#### \u5148\u8003\u8651\u7b80\u5316\u6240\u6c42\u7b54\u6848\uff1a\r\n\r\n\u5bf9\u4e0e\u539f\u5e8f\u5217\u7684 $m=\\large\\frac{n(n+1)}2$ \u4e2a\u533a\u95f4\uff0c\u8bbe\u533a\u95f4\u6309\u4f4d\u6216\u7684\u503c\u4e3a $o_1,o_2,\\dots,o_m$\uff0c\u5bf9\u5e94\u7684\u6309\u4f4d\u5f02\u6216\u7684\u503c\u4e3a $x_1,x_2,\\dots,x_m$\uff0c\u5219\u6bcf\u4e2a\u533a\u95f4\u7684 $f$ \u503c\u4e3a $f_i=o_i+x_i\\kern{3pt} (i=1,2,\\dots,m)$\uff0c\u6240\u6c42\u7b54\u6848\u5373\u4e3a $f_1,f_2,\\dots,f_m$ \u8fd9 $m$ \u4e2a\u6570\u7684\u65b9\u5dee\u7684 $m^2$ \u500d $\\kern{1pt}\\mathrm {mod}\\kern{3pt} 998244353$ \u7684\u503c\u3002\r\n\r\n\u8bbe\u8fd9 $m$ \u4e2a\u6570\u7684\u5e73\u5747\u6570\u4e3a $\\bar{f}=\\frac{1}{m}\\sum_{i=1}^{m}f_i$\uff0c\u65b9\u5dee\u4e3a $s^2=\\frac{1}{m}\\sum_{i=1}^m(f_i-\\bar{f})^2$\uff0c\u8003\u8651\u7b80\u5316\u6240\u6c42\u7b54\u6848 $m^2s^2$\uff1a\r\n$$\r\n\\begin{aligned}\r\n&m^2s^2\\\\\r\n&=m\\sum_{i=1}^m(f_i-\\bar f)^2\\\\\r\n&=m\\sum_{i=1}^m(f_i^2-2f_i\\bar f+\\bar f^2)\\\\\r\n&=m\\sum_{i=1}^mf_i^2-2m\\bar f\\sum_{i=1}^mf_i+m^2\\bar f^2\\\\\r\n&=m\\sum_{i=1}^mf_i^2-2\\times(\\sum_{i=1}^mf_i)^2+(\\sum_{i=1}^mf_i)^2\\\\\r\n&=m\\sum_{i=1}^mf_i^2-(\\sum_{i=1}^mf_i)^2\r\n\\end{aligned}\r\n$$\r\n\u53c8\u7531 $f_i=o_i+x_i$\uff0c\u6709\uff1a\r\n$$\r\n\\begin{aligned}\r\n&m^2s^2\\\\\r\n&=m\\sum_{i=1}^mf_i^2-(\\sum_{i=1}^mf_i)^2\\\\\r\n&=m\\sum_{i=1}^m(o_i+x_i)^2-(\\sum_{i=1}^m(o_i+x_i))^2\\\\\r\n&=m\\times(\\sum_{i=1}^m o_i^2+\\sum_{i=1}^m 2o_ix_i+\\sum_{i=1}^m x_i^2)-(\\sum_{i=1}^m o_i+\\sum_{i=1}^m x_i)^2\r\n\\end{aligned}\r\n$$\r\n\u6240\u4ee5\u7b54\u6848\u53ef\u8f6c\u5316\u4e3a\u6c42\u5404\u4e2a\u533a\u95f4\u4e94\u90e8\u5206\u548c\uff1a\r\n$$\r\nA=\\sum_{i=1}^m o_i^2\\quad\r\nB=\\sum_{i=1}^m 2o_ix_i\\quad\r\nC=\\sum_{i=1}^m x_i^2\\quad\r\nD=\\sum_{i=1}^m o_i\\quad\r\nE=\\sum_{i=1}^m x_i\r\n$$\r\n\r\n#### \u9996\u5148\u8003\u8651\u4ec5\u4e0e $o_i$ \u76f8\u5173\u7684 $A,D$\uff1a\r\n\r\n\u4e00\u79cd\u66b4\u529b\u7684\u65b9\u6cd5\u662f\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u5de6\u7aef\u70b9 $l$\uff0c\u521d\u59cb\u5316\u533a\u95f4\u6309\u4f4d\u6216\u548c\u4e3a $o=0$\u3002\u63a5\u4e0b\u6765\u53f3\u7aef\u70b9 $r$ \u4f9d\u6b21\u904d\u5386 $l,l+1,\\dots,n$\uff0c\u6bcf\u6b21\u904d\u5386\u5230\u65b0\u7684 $r$ \u5c31\u5c06 $o$ \u8d4b\u503c\u4e3a $o\\vee a_r$\uff0c\u5c31\u5f97\u5230\u4e86\u533a\u95f4 $[l,r]$ \u5bf9\u5e94\u7684\u6309\u4f4d\u5f02\u6216\u548c\uff0c\u5206\u522b\u7d2f\u52a0 $o$ \u548c $o^2$ \u5373\u53ef\u3002\r\n\r\n\u4ed4\u7ec6\u8003\u8651\u6574\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u53d1\u73b0 $o$ \u7684\u53d8\u5316\u662f\u5b58\u5728\u7ea6\u675f\u7684\u3002\u8be6\u7ec6\u5730\u8bf4\uff0c\u5728\u4e8c\u8fdb\u5236\u4e0b\uff0c$o$ \u4e0d\u65ad\u6309\u4f4d\u6216\u5e76\u8d4b\u503c\u7684\u8fc7\u7a0b\u4e2d\uff0c$o$ \u4e2d\u5df2\u7ecf\u4e3a $1$ \u7684\u4e8c\u8fdb\u5236\u4f4d\u4e0d\u4f1a\u53d8\u4e3a $0$\uff0c\u53ea\u6709\u4ecd\u7136\u4e3a $0$ \u7684\u4f4d\u53ef\u80fd\u5728\u67d0\u6b21\u6309\u4f4d\u6216\u540e\u53d8\u6210 $1$\uff0c\u5e76\u4fdd\u7559\u5230\u5f53\u524d\u5de6\u7aef\u70b9\u5904\u7406\u5b8c\u3002\u8fd9\u4e48\u770b\u6765\u5728 $n$ \u8f83\u5927\u65f6\uff0c$o$ \u5728\u53f3\u7aef\u70b9\u904d\u5386\u8fc7\u7a0b\u4e2d\u5f88\u591a\u65f6\u5019\u662f\u4e0d\u53d8\u7684\u3002\u5177\u4f53\u5730\u63cf\u8ff0 $o$ \u7684\u6539\u53d8\u6b21\u6570\uff0c\u8bbe $a$ \u7684\u503c\u57df\u4e3a $V$\uff0c\u6bcf\u6b21\u6539\u53d8\u4f1a\u4f7f $o$ \u4e8c\u8fdb\u5236\u4e0b $0$ \u7684\u4e2a\u6570\u81f3\u5c11\u51cf\u5c11 $1$\uff08\u7531\u4e8e\u4f4d\u8fd0\u7b97\u7279\u70b9\uff0c\u6b64\u5904\u5305\u62ec\u4ee5\u4e0b\u8ba8\u8bba\u53ea\u8003\u8651\u6bcf\u4e2a\u6570\u4e8c\u8fdb\u5236\u4e0b\u6700\u4f4e\u7684 $\\lceil\\log V\\rceil+1$ \u4f4d\uff09\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e00\u4e2a\u5de6\u7aef\u70b9\uff0c$o$ \u7684\u6539\u53d8\u6b21\u6570\u81f3\u591a\u4e3a $\\lceil\\log V\\rceil+1$ \u6b21\u3002\u636e\u6b64\u5bf9\u53f3\u7aef\u70b9\u5206\u6bb5\uff0c\u53ef\u5f97\u5230 $O(\\log V)$ \u6bb5\u3002\u6bcf\u6bb5\u4e2d $o$ \u4e3a\u5b9a\u503c\uff0c\u5219\u5bf9\u4e8e $A,D$ \u7684\u8d21\u732e\u6613\u6c42\u3002\r\n\r\n#### \u63a5\u4e0b\u6765\u8003\u8651\u4ec5\u4e0e $x_i$ \u76f8\u5173\u7684 $C,E$\uff1a\r\n\r\n\u6309\u4f4d\u5f02\u6216\u6ca1\u6709\u4e0a\u8ff0\u6309\u4f4d\u6216\u7684\u6027\u8d28\uff0c\u4f46\u533a\u95f4\u6309\u4f4d\u5f02\u6216\u53ef\u4ee5\u7528\u5f02\u6216\u524d\u7f00\u548c\u8f6c\u5316\u4e3a\u4e24\u4e2a\u6570\u7684\u5f02\u6216\u3002\r\n\r\n\u8bbe $s_i=a_1\\oplus a_2\\oplus\\dots\\oplus a_i$\uff0c\u7279\u522b\u5730\uff0c$s_0=0$\u3002\u5219\u5bf9\u4e8e\u533a\u95f4 $[l,r]$\uff0c$a_l\\oplus a_{l+1}\\oplus\\dots\\oplus a_r=s_{l-1}\\oplus s_r$\u3002\r\n\r\n\u4ecd\u7136\u56fa\u5b9a\u5de6\u7aef\u70b9 $l$\u3002\u8bbe $\\mathrm{bit}(x,i)\\in \\{0,1\\}$ \u4e3a\u81ea\u7136\u6570 $x$ \u4e8c\u8fdb\u5236\u4e0b\u4ece\u4f4e\u81f3\u9ad8\u7b2c $i$ \u4f4d\uff08\u4ece $0$ \u5f00\u59cb\uff09\u4e0a\u7684\u503c\uff0c\u5219\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u6570 $i$ \u548c\u53f3\u7aef\u70b9 $r$\uff0c\u82e5 $\\mathrm{bit}(s_{l-1}, i)\\oplus \\mathrm{bit}(s_r,i)=1$\uff0c\u4f1a\u5bf9 $E$ \u4ea7\u751f $2^i$ \u7684\u8d21\u732e\u3002\u8fdb\u4e00\u6b65\u5730\uff0c\u82e5\u6709 $\\mathrm{cnt}1_{i,j}$\uff08\u5176\u4e2d $0\\leq i\\leq\\lceil\\log{V}\\rceil,j\\in\\{0,1\\}$\uff09 \u4e2a\u53f3\u7aef\u70b9 $r$ \u6ee1\u8db3 $l\\leq r\\leq n$ \u4e14 $\\mathrm{bit}(s_r,i)=j$\uff0c\u90a3\u4e48\u5de6\u7aef\u70b9 $l$ \u5bf9 $E$ \u7684\u8d21\u732e\u4e3a $\\sum_{i=0}^{\\lceil\\log{V}\\rceil}2^i\\times \\mathrm{cnt}1_{i,\\mathrm{bit}(s_{l-1},i)\\oplus1}$\u3002\r\n\r\n$C$ \u7684\u8ba1\u7b97\u4e0e\u6b64\u7c7b\u4f3c\u3002\u8bbe $\\mathrm{val}(x,i)=2^i\\times \\mathrm{bit}(x,i)$\uff0c\u5219\r\n\r\n$x=\\sum_{i=0}^{\\lceil\\log{V}\\rceil}\\mathrm{val}(x,i)$\uff0c$x^2=\\sum_{0\\leq i,j\\leq\\lceil\\log{V}\\rceil}\\mathrm{val}(x,i)\\times \\mathrm{val}(x,j)=\\sum_{0\\leq i,j\\leq\\lceil\\log{V}\\rceil}\\mathrm{bit}(x,i)\\times \\mathrm{bit}(x,j)\\times2^{i+j}$\u3002\r\n\r\n\u5bf9\u4e8e\u6bcf\u4e24\u4e2a\u4f4d\u6570 $i,j$ \u548c\u53f3\u7aef\u70b9 $r$\uff0c\u82e5 $\\mathrm{bit}(s_{l-1},i)\\oplus \\mathrm{bit}(s_r,i)=1$ \u4e14 $\\mathrm{bit}(s_{l-1},j)\\oplus \\mathrm{bit}(s_r,j)=1$\uff0c\u4f1a\u5bf9 C \u4ea7\u751f $2^{i+j}$ \u7684\u8d21\u732e\u3002\u8fdb\u4e00\u6b65\u5730\uff0c\u82e5\u6709 $\\mathrm{cnt}2_{i,u,j,v}$\uff08\u5176\u4e2d $0\\leq i,j\\leq\\lceil\\log{V}\\rceil,u,v\\in\\{0,1\\}$\uff09\u4e2a\u53f3\u7aef\u70b9 $r$ \u6ee1\u8db3 $l\\leq r\\leq n$ \u4e14 $\\mathrm{bit}(s_{l-1},i)=u$ \u4e14 $\\mathrm{bit}(s_{l-1},j)=v$\uff0c\u90a3\u4e48\u5de6\u7aef\u70b9 $l$ \u5bf9 $C$ \u7684\u8d21\u732e\u4e3a $\\sum_{0\\leq i,j\\leq\\lceil\\log{V}\\rceil}\\mathrm{cnt}2_{i,\\mathrm{bit}(s_{l-1},i)\\oplus1,j,\\mathrm{bit}(s_{l-1},j)\\oplus1}\\times2^{i+j}$\u3002\r\n\r\n\u800c $\\mathrm{cnt1,cnt2}$ \u5728 $l$ \u4ece\u5927\u5230\u5c0f\u7684\u904d\u5386\u8fc7\u7a0b\u4e2d\u4e0d\u96be\u6c42\u5f97\uff0c\u6545 $C,E$ \u53ef\u6c42\u3002\r\n\r\n#### \u6700\u540e\u8003\u8651 $B$\r\n\r\n\u56fa\u5b9a\u5de6\u7aef\u70b9 $l$\uff0c\u5e76\u5c06\u53f3\u7aef\u70b9\u6309\u7167\u6309\u4f4d\u6216\u7684\u6027\u8d28\u5206\u6bb5\u3002\u8bbe\u53f3\u7aef\u70b9 $r$ \u5728 $i\\leq r\\leq j$ \u7684\u533a\u95f4\u4e2d\uff0c\u6240\u5f97\u533a\u95f4 $[l,r]$ \u6309\u4f4d\u6216\u7684\u503c\u90fd\u662f $o$\uff0c\u5219\u8fd9\u6bb5\u7684\u8d21\u732e\u4e3a $\\sum 2o_kx_k=2o\\sum x_k$\uff08\u5373\u63d0\u51fa\u56fa\u5b9a\u7684 $2o$\uff0c\u4e0d\u5199\u51fa\u786e\u5207\u7684\u4e0a\u4e0b\u754c\uff09\u3002$\\sum x_k$ \u4ecd\u8003\u8651\u6309\u4e8c\u8fdb\u5236\u4f4d\u8ba1\u7b97\u8d21\u732e\u3002\u8bbe $1,2,...,k$ \u4e2d\u6709 $\\mathrm{cnt}3_{k,u,v}$ \u4e2a\u4f4d\u7f6e $x$ \u6ee1\u8db3 $\\mathrm{bit}(s_x,u)=v$\uff0c\u5219\u56fa\u5b9a\u7684 $l$ \u4e0e $i\\leq r\\leq j$ \u7684 $r$ \u5bf9 $B$ \u7684\u8d21\u732e\u4e3a $2o\\sum_{k=0}^{\\lceil\\log{V}\\rceil}2^i\\times(\\mathrm{cnt}3_{j-1,\\mathrm{bit}(s_{l-1},k)\\oplus1}-\\mathrm{cnt}3_{i-1,\\mathrm{bit}(s_{l-1},k)\\oplus1})$\u3002\r\n\r\n$\\mathrm{cnt}3$ \u53ef\u4ee5\u5728\u8bfb\u5165\u540e\u521d\u59cb\u5316\uff0c\u6545 $B$ \u7684\u8ba1\u7b97\u53ef\u4ee5\u4e0e $A,D$ \u4e00\u540c\u5b8c\u6210\u3002\r\n\r\n#### \u590d\u6742\u5ea6\u5206\u6790\r\n\r\n\u5bf9\u4e8e $A,B,D$ \u5206\u6bb5\u8fc7\u7a0b\u7684\u5b9e\u73b0\u53ef\u4ee5\u501f\u52a9\u9884\u5904\u7406\u6570\u7ec4 $b_{i,j}$\uff1a \u8868\u793a\u6700\u5c0f\u7684 $k\\geq i$ \u6ee1\u8db3 $\\mathrm{bit}(a_k,j)=1$\u3002\u5bf9\u4e8e\u56fa\u5b9a\u5de6\u7aef\u70b9 $l,r$\uff0c\u4ece $l$ \u5f00\u59cb\uff0c\u501f\u52a9 $b$ \u627e\u5230\u4e0b\u4e00\u4e2a\u5206\u6bb5\u70b9 $rr$\uff0c\u4f7f\u5f97\u53f3\u7aef\u70b9\u5728 $[r,rr)$ \u4e2d\u65f6\u5bf9\u5e94\u533a\u95f4\u7684\u6309\u4f4d\u6216\u4e3a\u5b9a\u503c\u3002\u7531\u4e8e\u6709 $O(n\\log V)$ \u6bb5\uff0c\u800c\u6b21\u5bfb\u627e\u4e0b\u4e00\u4e2a\u65ad\u70b9\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log V)$\uff0c\u6545\u5206\u6bb5\u8fc7\u7a0b\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log^2{V})$\u3002\r\n\r\n\u6bcf\u4e00\u6bb5\u4e2d\uff0c$A,D$ \u7684\u8d21\u732e\u8ba1\u7b97\u662f $O(1)$ \u7684\uff0c\u800c $B$ \u7684\u8ba1\u7b97\u9700\u8981\u679a\u4e3e\u6bcf\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log V)$\uff0c\u6545 $A,B,D$ \u7684\u8ba1\u7b97\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log^2 V)$\u3002\r\n\r\n\u5bf9\u4e8e $C,E$ \u7684\u8ba1\u7b97\uff0c\u5728\u4ece\u5927\u5230\u5c0f\u904d\u5386\u5de6\u7aef\u70b9\u7684\u8fc7\u7a0b\u4e2d\uff0c$\\mathrm{cnt}1$ \u7684\u8ba1\u7b97\u662f\u6bcf\u6b21 $O(\\log V)$\uff0c$\\mathrm{cnt}2$ \u7684\u8ba1\u7b97\u662f\u6bcf\u6b21 $O(\\log^2 V)$\u3002\u800c\u901a\u8fc7 $\\mathrm{cnt}1$ \u8ba1\u7b97 $E$ \u9700\u8981\u679a\u4e3e\u6bcf\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff0c\u6bcf\u4e2a\u5de6\u7aef\u70b9\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log V)$\uff1b\u901a\u8fc7 $\\mathrm{cnt}2$ \u8ba1\u7b97 $C$ \u9700\u8981\u679a\u4e3e\u6bcf\u5bf9\u4e8c\u8fdb\u5236\u4f4d\uff0c\u6bcf\u4e2a\u5de6\u7aef\u70b9\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log^2 V)$\u3002\u6545\u8ba1\u7b97 $C$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log^2 V)$\uff0c\u8ba1\u7b97 $E$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log V)$\u3002\r\n\r\n\u5bf9\u4e8e\u7a7a\u95f4\u590d\u6742\u5ea6\uff0c\u5bb9\u6613\u53d1\u73b0\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u6570\u7ec4\u5f00\u9500\u6700\u5927\u4e3a $O(n\\log V)$\u3002\r\n\r\n#### \u603b\u7ed3\r\n\r\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u4ee5 $O(n\\log^2 V)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c$O(n\\log V)$ \u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002",
        "postTime": 1677070963,
        "uid": 483037,
        "name": "Galex",
        "ccfLevel": 6,
        "title": "variance \u9898\u89e3"
    },
    {
        "content": "\u6c42\u65b9\u5dee\u53ea\u9700\u8981\u6c42\u51fa $\\sum_{l=1}^n\\sum_{r=l}^{n} f(l,r)$ \u548c $\\sum_{l=1}^n\\sum_{r=l}^{n} f(l,r)^2$\u3002\u56e0\u4e3a\u7b2c\u4e00\u4e2a\u660e\u663e\u5f31\u4e8e\u7b2c\u4e8c\u4e2a\u6240\u4ee5\u53ea\u8003\u8651\u7b2c\u4e8c\u4e2a\u600e\u4e48\u6c42\u3002\r\n\r\n\u8003\u8651\u5c06\u8d21\u732e\u62c6\u4f4d\uff0c\u5e76\u5c06\u5e73\u65b9\u62c6\u6210\u4e24\u4f4d\u7684\u4e58\u79ef\u3002\u679a\u4e3e\u4e24\u4f4d $i,j$\uff0c\u8bbe\u5206\u522b $b_k,c_k$ \u8868\u793a $a_k$  \u7b2c $i,j$ \u4f4d\u7684\u503c\uff0c\u4e8e\u662f $f_{l,r}$ \u5728\u7b2c\u4e00\u4f4d\u4e3a $i$\uff0c\u7b2c\u4e8c\u4f4d\u4e3a $j$ \u65f6\u7684\u8d21\u732e\u5c31\u662f \r\n$$((b_l\u2295b_{l+1}\u2295\\cdots \u2295b_r)+(b_l\u2228b_{l+1}\u2228\\cdots \u2228b_r))\\times((c_l\u2295c_{l+1}\u2295\\cdots \u2295c_r)+(c_l\u2228c_{l+1}\u2228\\cdots \u2228c_r))$$\r\n\r\n\u5206\u522b\u5bf9\u5de6\u53f3\u4e24\u4e2a\u62ec\u53f7\u4e3a $1/2,1/2$ \u7684\u56db\u79cd\u60c5\u51b5\u8ba1\u6570\u5373\u53ef\u3002\u8ba1\u6570\u7684\u65b9\u6cd5\u53ef\u4ee5\u7ef4\u62a4\u6700\u540e\u4e00\u4e2a $1$ \u7684\u4f4d\u7f6e\u548c\u524d\u7f00\u548c\u7684\u5947\u5076\u6027\uff0c\u8fd9\u91cc\u4e0d\u61c2\u7684\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\r\n\r\n\u65f6\u95f4 $O(n\\log^2 V)$\uff0c\u7a7a\u95f4 $O(n)$\u3002\r\n\r\n```cpp\r\n\r\n#include<bits/stdc++.h>\r\n#define N 1001001\r\n#define MAX 2001\r\n#define inf 1e18\r\nusing namespace std;\r\ntypedef long long ll;\r\ntypedef long double db;\r\nconst ll mod=998244353,inv2=(mod+1)/2;\r\ninline void read(ll &ret)\r\n{\r\n    ret=0;char c=getchar();bool pd=false;\r\n    while(!isdigit(c)){pd|=c=='-';c=getchar();}\r\n    while(isdigit(c)){ret=(ret<<1)+(ret<<3)+(c&15);c=getchar();}\r\n    ret=pd?-ret:ret;\r\n    return;\r\n}\r\nll n,a[N],sum,sum2,b[N],b1[N],b2[N],c[N][2][2];\r\nsigned main()\r\n{\r\n\tread(n);\r\n\tfor(int i=1;i<=n;i++)\r\n\t\tread(a[i]);\r\n\tfor(int k=0;k<=31;k++)//\u548c\r\n\t{\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t\tb[i]=((a[i]>>k)&1);\r\n\t\tll res=0;\r\n\t\tll cnt0=0,cnt1=0;\r\n\t\tcnt0++;\r\n\t\tll s=0;\r\n\t\tll las=0;\r\n\t\tfor(int r=1;r<=n;r++)\r\n\t\t{\r\n\t\t\ts+=b[r];\r\n\t\t\ts&=1;\r\n\t\t\tif(s==1)\r\n\t\t\t\tres+=cnt0,cnt1++;\r\n\t\t\telse\r\n\t\t\t\tres+=cnt1,cnt0++;\r\n\t\t\tif(b[r])\r\n\t\t\t\tlas=r;\r\n\t\t\tres+=las;\r\n\t\t\tres%=mod;\r\n\t\t}\r\n\t\tsum+=res*((1ll<<k)%mod)%mod;\r\n\t\tsum%=mod;\r\n\t\tsum-=sum>=mod?mod:0;\r\n\t}\r\n\tfor(int k1=0;k1<=31;k1++)//\u5e73\u65b9\u548c\r\n\t{\r\n\t\tfor(int k2=0;k2<=31;k2++)\r\n\t\t{\r\n\t\t\tll res=0;\r\n\t\t\tfor(int i=1;i<=n;i++)\r\n\t\t\t\tb1[i]=(a[i]>>k1)&1,b2[i]=(a[i]>>k2)&1;\r\n\t\t\tc[0][0][0]=1;\r\n\t\t\tll las1=0,las2=0,s1=0,s2=0;\r\n\t\t\tfor(int i=1;i<=n;i++)\r\n\t\t\t{\r\n\t\t\t\tmemcpy(c[i],c[i-1],sizeof(c[i]));\r\n\t\t\t\tif(b1[i])\r\n\t\t\t\t\tlas1=i;\r\n\t\t\t\tif(b2[i])\r\n\t\t\t\t\tlas2=i;\r\n\t\t\t\ts1+=b1[i],s2+=b2[i];\r\n\t\t\t\ts1&=1,s2&=1;\r\n\t\t\t\tc[i][s1][s2]++;\r\n\t\t\t\tif(min(las1,las2)==0)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tres+=1*1*(c[min(las1,las2)-1][s1][s2]);\r\n\t\t\t\tres+=1*2*(c[min(las1,las2)-1][s1][s2^1]);\r\n\t\t\t\tres+=2*1*(c[min(las1,las2)-1][s1^1][s2]);\r\n\t\t\t\tres+=2*2*(c[min(las1,las2)-1][s1^1][s2^1]);\r\n\t\t\t\tres%=mod;\r\n\t\t\t}\r\n\t\t\tsum2+=((1ll<<k1)%mod)*((1ll<<k2)%mod)%mod*res%mod;\r\n\t\t\tsum2%=mod;\r\n\t\t\tsum2-=sum2>=mod?mod:0;\r\n\t\t}\r\n\t}\r\n\tprintf(\"%lld\\n\",(sum2*n%mod*(n+1)%mod*inv2%mod-sum*sum%mod+mod)%mod);\r\n    exit(0);\r\n}\r\n```",
        "postTime": 1679475285,
        "uid": 176990,
        "name": "Celtic",
        "ccfLevel": 9,
        "title": "P9162"
    }
]