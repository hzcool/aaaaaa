[
    {
        "content": "# \u4e8c\u5206 $\\times$ \u7f51\u7edc\u6d41\n\n\u4e00\u5f00\u59cb\u770b\u5230\u9898\u76ee\u8111\u5b50\u4e00\u7247\u7a7a\u767d\u3002\u3002\u3002QAQ\n\n\u4ed4\u7ec6\u89c2\u5bdf\u9898\u76ee\uff1a\n\n```\n\u9009\u62e9\u4e24\u4e2a\u76f8\u90bb\u7684\u683c\u5b50\n```\n\n\u9ed1\u767d\u67d3\u8272\uff01QwQ\n\n```\n\u5e76\u4f7f\u8fd9\u4e24\u4e2a\u6570\u90fd\u52a0\u4e0a1\n```\n\n\u4e8c\u5206\u56fe\uff01QwQ\n\n```\n\u68cb\u76d8\u4e0a\u7684\u6570\u90fd\u53d8\u6210\u540c\u4e00\u4e2a\u6570\n```\n\n\u6700\u5927\u6d41\uff01QwQ\n\n```\n\u6700\u5c11\u591a\u5c11\u6b21\n```\n\n\u4e8c\u5206\uff01QwQ\n\n\u597d\u4e86\u8fd9\u9898\u89e3\u6cd5\u5df2\u7ecf\u5f88\u660e\u6717\u4e86\u3002\u3002\u3002\uff08\u8bf6\u8bf6\u4f60\u521a\u521a\u8bf4\u4e86\u4ec0\u4e48\u6765\u7740\uff1f\uff09\n\n## \u5177\u4f53\u6765\u8bf4\n\n\u56e0\u4e3a\u8fd9\u9898\u662f\u4e8c\u7ef4\u68cb\u76d8\uff0c\u8003\u8651\u9ed1\u767d\u67d3\u8272\uff0c\u5efa\u7acb\u4e8c\u5206\u56fe\u3002\n\n\u8bbe\u9ed1\u70b9\u7684\u4e2a\u6570\u6709 $B$ \u4e2a\uff0c\u6743\u503c\u603b\u548c\u4e3a $b$ \uff0c\u767d\u70b9\u7684\u4e2a\u6570\u6709 $W$ \u4e2a\uff0c\u6743\u503c\u603b\u548c\u4e3a $w$ \u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u64cd\u4f5c\uff0c\u56e0\u4e3a\u662f\u9009\u62e9\u76f8\u90bb\u7684\u4e24\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u9ed1\u70b9\u767d\u70b9\u80af\u5b9a\u5404\u6709\u4e00\u4e2a\u88ab\u64cd\u4f5c\uff0c\u5373 $b$ \u548c $w$ \u5404\u52a0\u4e00\u3002\n\n\u8bbe\u6700\u540e\u5168\u90e8\u6570\u5b57\u90fd\u53d8\u6210 $X$ \uff0c\u90a3\u4e48\u5c31\u4f1a\u6709\u6709 $B \\times X - b = W \\times X - w$ \uff08\u7b49\u4e8e\u64cd\u4f5c\u7684\u6b21\u6570\uff09\u3002\n\n\u7a0d\u5fae\u5316\u7b80\u4e00\u4e0b\uff1a $ (B - W) \\times X = b - w$ \uff0c $ X = (b - w) \\div (B - W)$ \u3002\n\n\u8fd9\u6761\u7b49\u5f0f\u6210\u7acb\u7684\u6761\u4ef6\u662f $B \\ne W$ \uff0c\uff08\u5c0f\u5b66\u5965\u6570\uff1a\u9664\u6570\u4e0d\u80fd\u4e3a0\uff09\n\n## $B \\ne W$\n\n\u5982\u679c $B \\ne W$ \uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6c42\u51fa $X$ \u3002\n\n\u7136\u800c\uff0c\u6211\u4eec\u76f4\u63a5\u6c42\u51fa\u7684$X$\u4e0d\u4e00\u5b9a\u662f\u53ef\u884c\u7684\uff0c\u9700\u8981\u4f7f\u7528`check`\u5224\u5b9a\u5b83\u662f\u5426\u53ef\u884c\uff08\u89c1\u540e\uff09\u3002\n\n## $B = W$\n\n\u5982\u679c $B = W$ \uff0c\u5c31\u610f\u5473\u7740 $N$ \u3001 $M$ \u4e2d\u6709\u4e00\u4e2a\u662f\u5076\u6570\uff08\u5f88\u660e\u663e\u597d\u5427qwq\uff09\u3002\n\n\u5728 $B=W$ \u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e00\u4e2a $X$ \u53ef\u884c\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u94fa\u6ee1\u6574\u4e2a\u68cb\u76d8\uff0c\u4f7f\u6574\u4e2a\u68cb\u76d8\u7684\u6240\u6709\u6570\u90fd\u52a0\u4e0a\u4e00\uff0c\u5373 $X+1$ \u4e5f\u53ef\u884c\u3002\n\n\u540c\u7406\uff0c\u5f53 $X$ \u4e0d\u53ef\u884c\u65f6\uff0c $X-1$ \u4e5f\u80af\u5b9a\u4e0d\u53ef\u884c\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u51fa $X$ \uff0c\u540c\u6837\u4f7f\u7528`check`\u5224\u5b9a\u3002\n\n\u6ce8\u610f\uff1a\u6211\u4eec\u6bcf\u6b21 $b$ \u548c $w$ \u5404\u52a0\u4e00\uff0c\u800c\u4e14 $B = W$ \uff0c\u6700\u540e\u6240\u6709\u6570\u90fd\u53d8\u6210 $X$ \uff0c\u56e0\u6b64\u82e5\u4e00\u5f00\u59cb\u7684 $b$ \u4e0d\u7b49\u4e8e $w$ \uff0c\u6211\u4eec\u4e0d\u7ba1\u600e\u4e48\u64cd\u4f5c\uff0c\u90fd\u4e0d\u80fd\u6c42\u51fa\u4e00\u4e2a\u5408\u6cd5\u7684\u89e3\u3002\n\n## check\u51fd\u6570\n\n$check(x)$\uff1a\n\n\u8bbe\u7b2c $i$ \u4e2a\u70b9\u7684\u503c\u4e3a $v[i]$ \uff0c\n\n\u7f51\u7edc\u6d41\u5efa\u56fe\uff0c\u5c06 $S$ \u5411\u6240\u6709\u9ed1\u70b9 $i$ \u8fde\u8fb9\uff0c\u5bb9\u91cf\u4e3a $x - v[i]$ \uff0c\u610f\u5473\u7740\u9700\u8981\u5bf9\u8fd9\u4e2a\u70b9\u64cd\u4f5c $x - v[i]$ \u6b21\u3002\n\n\u5c06\u6240\u6709\u9ed1\u70b9 $i$ \u5411\u5176\u76f8\u90bb\u7684\u767d\u70b9 $j$ \u8fde\u8fb9\uff0c\u5bb9\u91cf\u4e3a $INF$ \u3002\n\n\u5c06\u6240\u6709\u767d\u70b9 $j$ \u5411 $T$ \u8fde\u8fb9\uff0c\u5bb9\u91cf\u4e3a $x - v[j]$ \uff0c\u610f\u5473\u7740\u8fd9\u4e2a\u70b9\u6700\u591a\u63a5\u53d7 $x - v[j]$ \u6b21\u6765\u81ea\u9ed1\u70b9\u7684\u64cd\u4f5c\u3002\n\n\u8bbe\u6240\u6709 $x - v[i]$ \u7684\u548c\u4e3a $V$ \uff0c\n\n\u5728\u56fe\u4e0a\u8fd0\u884c\u6700\u5927\u6d41\uff0c\u5224\u65ad\u6700\u5927\u6d41\u662f\u5426\u7b49\u4e8e $V$ \u5373\u53ef\u3002\n\n\u82e5\u6700\u5927\u6d41\u7b49\u4e8e $V$ \uff0c\u90a3\u4e48\u610f\u5473\u7740\u56fe\u4e0a\u6240\u6709\u8fb9\u90fd\u6d41\u6ee1\uff0c\u5373 $x$ \u53ef\u884c\uff0c\u8fd4\u56de`true`\u3002\n\n\u5426\u5219\u8fd4\u56de`false`\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nint INF;\nconst int dx[] = {0, 0, -1, 1};\nconst int dy[] = {-1, 1, 0, 0};\nstruct Graph{\n\tstatic const int MAXM=200000+10;\n\tstatic const int MAXN=10000+10;\n\tstruct Edge{\n\t\tint from,to,cap;\n\t\tint next;\n\t}node[MAXM];\n\tint head[MAXN],top;\n\tvoid init(){\n\t\ttop=1;\n\t\tmemset(head, 0, sizeof(head));\n\t\ts = MAXN - 1;\n\t\tt = MAXN - 2;\n\t}\n\tvoid add(int u,int v,int cap){\n\t\ttop++;\n\t\tnode[top].next=head[u];\n\t\tnode[top].from=u;\n\t\tnode[top].to=v;\n\t\tnode[top].cap=cap;\n\t\thead[u]=top;\n\t\ttop++;\n\t\tnode[top].next=head[v];\n\t\tnode[top].from=v;\n\t\tnode[top].to=u;\n\t\tnode[top].cap=0;\n\t\thead[v]=top;\n\t}\n\tint s,t;\n\tint dis[MAXN];\n\tqueue<int> Q;\n\tbool bfs(){\n\t\tmemset(dis,-1,sizeof(dis));\n\t\tQ.push(s);\n\t\tdis[s]=0;\n\t\twhile(!Q.empty()){\n\t\t\tint u=Q.front();\n\t\t\tQ.pop();\n\t\t\tfor(int i=head[u];i;i=node[i].next){\n\t\t\t\tint v=node[i].to;\n\t\t\t\tif(dis[v]==-1&&node[i].cap){\n\t\t\t\t\tdis[v]=dis[u]+1;\n\t\t\t\t\tQ.push(v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn dis[t]!=-1;\n\t}\n\tint dfs(int u,int flow){\n\t\tif(u==t)\n\t\t\treturn flow;\n\t\telse{\n\t\t\tint ret=flow;\n\t\t\tfor(int i=head[u];i&&ret;i=node[i].next){\n\t\t\t\tint v=node[i].to;\n\t\t\t\tif(dis[v]==dis[u]+1&&node[i].cap){\n\t\t\t\t\tint k=dfs(v,min(ret,node[i].cap));\n\t\t\t\t\tnode[i].cap-=k;\n\t\t\t\t\tnode[i^1].cap+=k;\n\t\t\t\t\tret-=k;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(ret == flow)\n\t\t\t\tdis[u] = -1;\n\t\t\treturn flow-ret;\n\t\t}\n\t}\n\tint dinic(){\n\t\tint ans=0;\n\t\twhile(bfs())\n\t\t\tans+=dfs(s,INF);\n\t\treturn ans;\n\t}\n}G;\n#define POINT(X, Y) ((X) * 40 + (Y))\nint T, n, m;\nint a[100][100];\nbool check(int val) {\n\tG.init();\n\tint sum = 0;\n\tfor(int i = 1; i <= n; i ++) {\n\t\tfor(int j = 1; j <= m; j ++) {\n\t\t\tif((i + j) % 2 == 0) {  //  X\n\t\t\t\tG.add(G.s, POINT(i, j), val - a[i][j]);\n\t\t\t\tsum += val - a[i][j];\n\t\t\t\tfor(int k = 0; k < 4; k ++) {\n\t\t\t\t\tint tx = i + dx[k];\n\t\t\t\t\tint ty = j + dy[k];\n\t\t\t\t\tif(tx >= 1 && tx <= n && ty >= 1 && ty <= m) {\n\t\t\t\t\t\tG.add(POINT(i, j), POINT(tx, ty), INF);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {  //  Y\n\t\t\t\tG.add(POINT(i, j), G.t, val - a[i][j]);\n\t\t\t}\n\t\t}\n\t}\n\treturn G.dinic() == sum;\n}\nsigned main() {\n\tINF = 0x7F7F7F7F7F7F7F7F;\n\tcin>>T;\n\twhile(T --) {\n\t\tcin>>n>>m;\n\t\tint max1 = 0;\n\t\tint s0, s1, c0, c1;\n\t\ts0 = s1 = c0 = c1 = 0;\n\t\tfor(int i = 1; i <= n; i ++) {\n\t\t\tfor(int j = 1; j <= m; j ++) {\n\t\t\t\tcin>>a[i][j];\n\t\t\t\tmax1 = max(max1, a[i][j]);\n\t\t\t\tif((i + j) % 2 == 0) {\n\t\t\t\t\ts0 += a[i][j];\n\t\t\t\t\tc0 ++;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\ts1 += a[i][j];\n\t\t\t\t\tc1 ++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(c0 != c1) {\n\t\t\tint x = (s0 - s1) / (c0 - c1);  //  c0 > c1\n\t\t\tif(x >= max1 && check(x)) {\n\t\t\t\tcout<<x * c1 - s1<<endl;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcout<<-1<<endl;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif(s0 != s1) {\n\t\t\t\tcout<<-1<<endl;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tint top = INF >> 1, end = max1 - 1;\n\t\t\t\twhile(end + 1 != top) {\n\t\t\t\t\tint mid = (top + end) >> 1;\n\t\t\t\t\tif(check(mid)) {  //  >= mid is OK\n\t\t\t\t\t\ttop = mid;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tend = mid;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(top == INF >> 1) {\n\t\t\t\t\tcout<<-1<<endl;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcout<<top * c1 - s1<<endl;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1542967774,
        "uid": 57525,
        "name": "longlongzhu123",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5038 \u3010[SCOI2012]\u5947\u602a\u7684\u6e38\u620f\u3011"
    },
    {
        "content": "\u9aa8\u724c\u9898\u8003\u8651\u9ed1\u767d\u67d3\u8272\uff0c\u8bbe\u9ed1\u767d\u70b9\u4e2a\u6570\u5206\u522b\u4e3a $c_{\\sf B}, c_{\\sf W}$\uff0c\u6743\u503c\u548c\u5206\u522b\u4e3a $s_{\\sf B}, s_{\\sf W}$ .\n\n\u6bcf\u6b21\u64cd\u4f5c\u80af\u5b9a\u662f\u6070\u597d\u64cd\u4f5c\u4e00\u4e2a\u9ed1\u70b9\u548c\u4e00\u4e2a\u767d\u70b9\uff0c\u4e8e\u662f\u8bbe\u6700\u540e\u6240\u6709\u70b9\u90fd\u53d8\u6210\u4e86 $x$\uff0c\u5219\u6709 $c_{\\sf B}\\cdot x-s_{\\sf B}=c_{\\sf W}\\cdot x-s_{\\sf W}$\uff0c\u4e5f\u5373 $(c_{\\sf B}-c_{\\sf W})x=s_{\\sf B}-s_{\\sf W}$ .\n\n\u8ba8\u8bba\uff1a\n1. \u5f53 $c_{\\sf B} - c_{\\sf W} \\neq = 0$ \u65f6 .\n2. \u5f53 $c_{\\sf B} - c_{\\sf W} = s_{\\sf B} - s_{\\sf W} = 0$ \u65f6 .\n3. \u5176\u4ed6\u60c5\u51b5\u65e0\u89e3 .\n\n***\n\n**Case 1.** \u53ef\u4ee5\u89e3\u5f97 $x=\\dfrac{s_{\\sf B}-s_{\\sf W}}{c_{\\sf B} - c_{\\sf W}}$ .\n\n\u4e8e\u662f\u53ea\u8981\u5224\u65ad $x$ \u662f\u5426\u80fd\u4f5c\u4e3a\u4e00\u4e2a\u89e3\u5373\u53ef\uff0c\u5177\u4f53\u89c1\u540e .\n\n****\n\n**Case 2.** \u8fd9\u8868\u660e\u9ed1\u767d\u8272\u5757\u6570\u91cf\u76f8\u7b49\u4e14\u6743\u503c\u548c\u76f8\u7b49 .\n\n\u56e0\u4e3a\u9ed1\u767d\u8272\u5757\u6570\u91cf\u76f8\u7b49\u6240\u4ee5\u5982\u679c $x$ \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u89e3\u90a3\u4e48 $x+1$ \u5fc5\u7136\u4e5f\u53ef\u4ee5 .\n\n\u4e5f\u5c31\u662f\u89e3\u6709\u5355\u8c03\u6027\uff0c\u4e8c\u5206\u7b54\u6848\u5373\u53ef . \u5224\u65ad $x$ \u662f\u5426\u80fd\u4f5c\u4e3a\u4e00\u4e2a\u89e3\u7684\u505a\u6cd5\u5982\u4e0b\uff1a\n\n\u8003\u8651\u5efa\u7acb\u865a\u62df\u6e90\u6c47\u70b9 $s,t$\uff1a\n- $s$ \u5411\u6240\u6709\u9ed1\u70b9 $(i,j)$ \u8fde\u8fb9\u6743\u4e3a $x-a_{i,j}$ \u7684\u6709\u5411\u8fb9 .\n- \u6240\u6709\u767d\u70b9 $(i,j)$ \u5411 $t$ \u8fde\u8fb9\u6743\u4e3a $x-a_{i,j}$ \u7684\u6709\u5411\u8fb9 .\n- \u6240\u6709\u9ed1\u70b9 $(i,j)$ \u5411\u76f8\u90bb\u767d\u70b9\u8fde\u8fb9\u6743\u4e3a $+\\infty$ \u7684\u6709\u5411\u8fb9 .\n\n\u56e0\u4e3a $x-a_{i,j}$ \u662f\u9700\u8981\u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u4e8e\u662f\u56e0\u4e3a\u9ed1\u767d\u8272\u5757\u6570\u91cf\u6743\u503c\u548c\u76f8\u7b49\uff0c\u5982\u679c\u6709\u89e3\u90a3\u4e48\u6d41\u80af\u5b9a\u80fd\u4ece $s$ \u6d41\u5230\u9ed1\u70b9\u6d41\u5230\u767d\u70b9\u518d\u6d41\u5230 $t$ .\n\n\u4e8e\u662f\u53ea\u8981\u5224\u65ad\u4ee5 $s$ \u4e3a\u6e90\u70b9\uff0c$t$ \u4e3a\u6c47\u70b9\u7684\u6700\u5927\u6d41\u662f\u5426\u7b49\u4e8e\u6240\u6709\u9ed1\u70b9\u4e4b\u6743\u503c\u548c\u5373\u53ef .\n\n\u56e0\u4e3a\u662f\u4e8c\u5206\u56fe\uff0c\u6240\u4ee5 Dinic \u662f $O(\\sqrt nm)$ \u7684 .\n***\n\u8fd9\u4e2a\u8fd8\u4e0d\u8db3\u4ee5\u4f5c\u4e3a\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\uff0c\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u4e00\u4e2a\u4e8c\u5206\u7b54\u6848\u7684\u4e0a\u754c .\n\n\u8bb0 $\\displaystyle A = \\max_i\\{a_i\\}$\uff0c\u8bbe\u4e8c\u5206\u56fe\u5de6\u90e8\u4e3a $L$\uff0c**\u5bf9\u5e94\u7684** \u53f3\u90e8\u4e3a $R$ .\n\n\u5219\u6839\u636e\u6700\u5927\u6d41\u5b9a\u4e49\uff0c\u6709\u89e3\u5f53\u4e14\u4ec5\u5f53 $s$ \u8fde\u5411 $L$ \u7684\u5bb9\u91cf\u548c $c_0$ \u4e0d\u5c0f\u4e8e $R$ \u8fde\u5411 $t$ \u7684\u5bb9\u91cf\u548c $c_1$ .\n\nHall \u5b9a\u7406\uff08[7.16 \u95f2\u8bdd](https://www.cnblogs.com/CDOI-24374/p/16485312.html)\uff09\u544a\u8bc9\u6211\u4eec\uff0c\u5bf9\u4e8e\u4efb\u4f55\u4e00\u4e2a $L$\uff0c\u90fd\u6709 $|L|\\le |R|$ .\n\n\u8ba8\u8bba\uff1a\n- \u5f53 $|L|=|R|$ \u65f6\uff0c$c_0=c_1$ .\n- \u5f53 $|L|<|R|$ \u65f6\uff0c\u5f53\u7b54\u6848\u4e3a $0$ \u65f6 $|c_0-c_1|\\le A\\cdot nm$ .\n \n  \u6ce8\u610f\u5230\uff0c\u82e5\u7b54\u6848\u589e\u52a0 $1$\uff0c$|c_0-c_1|$ \u7684 **\u51cf\u5c11\u91cf** $\\Delta\\ge |T|-|S|\\ge 1$ .\n  \n  \u4e8e\u662f\u7b54\u6848\u7684\u4e00\u4e2a\u4e0a\u754c\u4e3a $A\\cdot nm$ .\n  \n\u8fd9\u6837\u6211\u4eec\u77e5\u9053\u4e86\u7b54\u6848\u7684\u4e00\u4e2a\u4e0a\u754c\uff0c\u5c31\u53ef\u4ee5\u505a\u590d\u6742\u5ea6\u5206\u6790\u4e86 .\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\n$$\\begin{aligned}T(n,m,A)&=O(\\sqrt{nm}\\cdot nm\\cdot\\log(A\\cdot nm))\\\\&=O(n^{3/2}m^{3/2}(\\log A+\\log n+\\log m))\\\\&=O(n^{3/2}m^{3/2}\\log\\max\\{A,n,m\\})\\end{aligned}$$\n\n\u6ce8\u610f\u5230\u539f\u9898\u6570\u636e\u8303\u56f4\u7ed9\u51fa $A$ \u7684\u91cf\u7ea7\u8fdc\u5927\u4e8e $n,m$\uff0c\u4e8e\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^{3/2}m^{3/2}\\log A)$ .\n\n<details>\n<summary>Code</summary>\n\n```cpp\n#include <bits/stdc++.h>\ntemplate<typename T>\ninline T chkmin(T& x, const T& y){if (x > y) x = y; return x;}\ntemplate<typename T>\ninline T chkmax(T& x, const T& y){if (x < y) x = y; return x;}\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int, int> pii;\nconst int TD = 44, N = 19198;\nconst ll INF = 0x3f3f3f3f3f;\nstruct dinic\n{\n\tstruct Node\n\t{\n\t\tint u, v; ll w;\n\t\tNode() = default;\n\t\tNode(int a, int b, ll c) : u(a), v(b), w(c){}\n\t};\n\tvector<Node> e;\n\tvector<int> g[N];\n\tinline void addedge(int u, int v, ll w)\n\t{\n\t\tint s = e.size();\n\t\te.emplace_back(Node(u, v, w)); g[u].emplace_back(s++);\n\t\te.emplace_back(Node(v, u, 0)); g[v].emplace_back(s);\n\t}\n\tint cur[N], depth[N];\n\tinline void clear(int n){e.clear(); do g[n].clear(); while (n--);}\n\tinline bool bfs(int s, int t)\n\t{\n\t\tmemset(cur, 0, sizeof cur);\n\t\tmemset(depth, -1, sizeof depth);\n\t\tqueue<int> q; q.push(s); depth[s] = 0;\n\t\twhile (!q.empty())\n\t\t{\n\t\t\tint u = q.front(); q.pop();\n\t\t\tfor (int ee : g[u])\n\t\t\t{\n\t\t\t\tint v = e[ee].v;\n\t\t\t\tif (!~depth[v] && e[ee].w){depth[v] = depth[u] + 1; q.push(v);}\n\t\t\t}\n\t\t}\n\t\treturn ~depth[t];\n\t}\n\tll dfs(int u, int t, ll flow)\n\t{\n\t\tif ((u == t) || (flow <= 0)) return flow;\n\t\tll ans = 0; int s = g[u].size();\n\t\tfor (int& p = cur[u]; p < s; p++)\n\t\t{\n\t\t\tint ee = g[u][p], v = e[ee].v;\n\t\t\tif (depth[u] + 1 != depth[v]) continue;\n\t\t\tll nxt = dfs(v, t, min(flow, e[ee].w));\n\t\t\te[ee].w -= nxt; e[ee^1].w += nxt;\n\t\t\tans += nxt; flow -= nxt;\n\t\t\tif (flow <= 0) break;\n\t\t}\n\t\tif (ans <= 0) depth[u] = -1;\n\t\treturn ans;\n\t}\n\tinline ll maxflow(int s, int t)\n\t{\n\t\tll ans = 0;\n\t\twhile (bfs(s, t)) ans += dfs(s, t, INF);\n\t\treturn ans;\n\t}\n}F;\nint n, m, a[TD][TD];\ninline int color(int x, int y){return (x & 1) ^ (y & 1);}\ninline int tonode(int x, int y){return x * 40 + y;}\ninline bool check(ll x)\n{\n\tint s = tonode(n, m) + 1, t = s + 1;\n\tF.clear(t);\n\tll flow = 0;\n\tfor (int i=1; i<=n; i++)\n\t\tfor (int j=1; j<=m; j++)\n\t\t{\n\t\t\tif (color(i, j))\n\t\t\t{\n\t\t\t\tflow += x - a[i][j];\n\t\t\t\tF.addedge(s, tonode(i, j), x - a[i][j]);\n\t\t\t\tif (i > 1) F.addedge(tonode(i, j), tonode(i-1, j), INF); \n\t\t\t\tif (j > 1) F.addedge(tonode(i, j), tonode(i, j-1), INF); \n\t\t\t\tif (i < n) F.addedge(tonode(i, j), tonode(i+1, j), INF); \n\t\t\t\tif (j < m) F.addedge(tonode(i, j), tonode(i, j+1), INF); \n\t\t\t}\n\t\t\telse F.addedge(tonode(i, j), t, x - a[i][j]);\n\t\t}\n\treturn F.maxflow(s, t) == flow;\n}\ninline void solve()\n{\n\tscanf(\"%d%d\", &n, &m);\n\tll b = 0, w = 0; int B = 0, W = 0, M = 0;\n\tauto readInt = []()\n\t{\n\t\tint ans = 0; char ch;\n\t\twhile (!isdigit(ch = getchar()));\n\t\tdo ans = (ans<<3) + (ans<<1) + ch - 48; while (isdigit(ch = getchar()));\n\t\treturn ans;\n\t};\n\tfor (int i=1; i<=n; i++)\n\t\tfor (int j=1; j<=m; j++)\n\t\t{\n//\t\t\ta[i][j] = readInt();\n\t\t\tscanf(\"%d\", a[i] + j);\n\t\t\tchkmax(M, a[i][j]);\n\t\t\tif (color(i, j)){++B; b += a[i][j];}\n\t\t\telse{++W; w += a[i][j];}\n\t\t}\n\tif (B != W)\n\t{\n\t\tll x = (b - w) / (B - W);\n\t\tif ((x >= M) && check(x)) printf(\"%lld\\n\", x * W - w);\n\t\telse puts(\"-1\");\n\t\treturn ;\n\t}\n\tif (b != w){puts(\"-1\"); return ;}\n\tll l = M, r = 3e9, ans = -1;\n\twhile (l <= r)\n\t{\n\t\tll mid = (l + r) >> 1;\n\t\tif (check(mid)){r = mid - 1; ans = mid;}\n\t\telse l = mid + 1;\n\t}\n\tif (!~ans) puts(\"-1\");\n\telse printf(\"%lld\\n\", ans * W - w);\n}\nint main()\n{\n#ifndef ONLINE_JUDGE\n\tfreopen(\"i.in\", \"r\", stdin);\n#endif \n\tint T; scanf(\"%d\", &T);\n\twhile (T--) solve();\n\treturn 0;\n}\n```\n</details>",
        "postTime": 1657976113,
        "uid": 227514,
        "name": "jijidawang",
        "ccfLevel": 0,
        "title": "P5038"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problemnew/show/P5038)\n\n\u8bdd\u8bf4\u6709\u6ca1\u6709\u8ddf\u6211\u4e00\u6837\u76f4\u63a5\u731c\u4e86\u4e00\u4e2a\u6700\u5927\u503c\u4e0d\u4f1a\u6539\u53d8\u8fd9\u6837\u4e00\u4e2a\u4e8c\u4e4e\u4e4e\u7684\u7ed3\u8bba\u4e4b\u540e\u4ea4\u4e0a\u53bb\u4fdd\u9f84\u7684\u5440\n\n\u9996\u5148\u770b\u5230\u68cb\u76d8\uff0c\u9009\u62e9\u76f8\u90bb\u7684\u683c\u5b50\uff0c\u975e\u5e38\u7ecf\u5178\u7684\u9ed1\u767d\u67d3\u8272\n\n\u663e\u7136\u90a3\u4e2a\u4e8c\u4e4e\u4e4e\u7684\u7ed3\u8bba\u662f\u9519\u7684\uff0c\u968f\u4fbf\u5c31\u80fd$hack$\u4e86\n\n\u4e8e\u662f\u6211\u4eec\u4e8c\u5206\u8fd9\u4e2a\u6700\u5927\u503c\n\n\u5982\u679c\u5f53\u524d\u4e8c\u5206\u51fa\u6765\u7684\u6700\u5927\u503c\u662f$mid$\uff0c$i+j$\u4e3a\u5947\u6570\uff0c\u8d77\u70b9\u8fde$mid-a[i][j]$\u7684\u8fb9\uff0c\u5426\u5219\u5411\u7ec8\u70b9\u8fde$mid-a[i][j]$\u7684\u8fb9\uff0c\u76f8\u90bb\u7684\u683c\u5b50\u8fde\u6d41\u91cf\u65e0\u7a77\u7684\u8fb9\uff0c\u8dd1\u6700\u5927\u6d41\u770b\u770b\u8d77\u70b9\u8fde\u51fa\u53bb\u7684\u8fb9\u548c\u8fde\u5411\u7ec8\u70b9\u7684\u8fb9\u662f\u5426\u90fd\u6ee1\u6d41\u5c31\u597d\u4e86\n\n\u4f46\u662f\u8fd9\u6837\u4ec5\u9650\u4e8e$n\\times m$\u4e3a\u5076\u6570\u7684\u60c5\u51b5\n\n\u56e0\u4e3a\u4e4b\u540e\u5f53$n\\times m$\u4e3a\u5076\u6570\u7684\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u628a\u6574\u4e2a\u68cb\u76d8\u6574\u4f53\u52a0$1$\uff0c\u56e0\u6b64\u5b58\u5728\u5355\u8c03\u6027\uff0c\u4e8e\u662f\u53ef\u4ee5\u4e8c\u5206\n\n\u4f46\u662f\u5f53$n\\times m$\u4e3a\u5947\u6570\u7684\u65f6\u5019\u6211\u4eec\u65e0\u8bba\u5982\u4f55\u90fd\u5f97\u7a7a\u81f3\u5c11\u4e00\u4e2a\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u6700\u540e\u68cb\u76d8\u53d8\u6210\u4e86$x$\n\n\u90a3\u4e48\u5c31\u4f1a\u5b58\u5728\n\n$$x\\times num_{\\text{\u5947}}-sum_{\\text{\u5947}}=x\\times num_{\\text{\u5076}}-sum_{\\text{\u5076}}$$\n\n\u8fd9\u4e2a\u5176\u5b9e\u8fd8\u662f\u6765\u6e90\u4e8e\u4e0a\u9762\u7684\u7f51\u7edc\u6d41\u5efa\u56fe\uff0c\u5c31\u662f\u8ba9\u4e24\u8fb9\u6d41\u91cf\u5e73\u8861\uff0c\u7531\u4e8e$num_{\\text{\u5947}}!=num_{\\text{\u5076}}$\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u89e3\u5f97\n\n$$x=\\frac{sum_{\\text{\u5947}}-sum_{\\text{\u5076}}}{num_{\\text{\u5947}}-num_{\\text{\u5076}}}$$\n\n\u7531\u4e8e\u6211\u4eec\u4e0d\u80fd\u518d\u8ba9\u68cb\u76d8\u6574\u4f53\u52a0\u4e86\uff0c\u4e8e\u662f\u76f4\u63a5\u5224\u65ad$x$\u662f\u5426\u5408\u6cd5\u5c31\u597d\u4e86\n\n\u4ee3\u7801\n\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<queue>\n#define re register\n#define LL long long\n#define max(a,b) ((a)>(b)?(a):(b))\n#define min(a,b) ((a)<(b)?(a):(b))\nconst int maxn=2005;\nconst LL inf=5e12;\ninline int read() {\n\tchar c=getchar();int x=0;while(c<'0'||c>'9') c=getchar();\n\twhile(c>='0'&&c<='9') x=(x<<3)+(x<<1)+c-48,c=getchar();return x;\n}\nstd::queue<int> q;\nconst int dx[]={0,0,1,-1};\nconst int dy[]={1,-1,0,0};\nint head[maxn],d[maxn],id[51][51],S,T,num;\nint n,m,a[51][51],pd[maxn],cur[maxn];\nstruct E{int v,nxt;LL f;}e[maxn*40];\ninline void C(int x,int y,LL f) {\n\te[++num].v=y;e[num].nxt=head[x];\n\thead[x]=num;e[num].f=f;\n}\ninline void add(int x,int y,LL f) {C(x,y,f),C(y,x,0);}\ninline int BFS() {\n\tfor(re int i=S;i<=T;i++) d[i]=0,cur[i]=head[i];\n\td[S]=1,q.push(S);\n\twhile(!q.empty()) {\n\t\tint k=q.front();q.pop();\n\t\tfor(re int i=head[k];i;i=e[i].nxt)\n\t\tif(e[i].f&&!d[e[i].v]) d[e[i].v]=d[k]+1,q.push(e[i].v);\n\t}\n\treturn d[T];\n}\nLL dfs(int x,LL now) {\n\tif(x==T||!now) return now;\n\tLL flow=0,ff;\n\tfor(re int& i=cur[x];i;i=e[i].nxt)\n\tif(d[e[i].v]==d[x]+1) {\n\t\tff=dfs(e[i].v,min(now,e[i].f));\n\t\tif(ff<=0) continue;\n\t\tnow-=ff,flow+=ff,e[i].f-=ff,e[i^1].f+=ff;\n\t\tif(!now) break;\n\t}\n\treturn flow;\n}\ninline int check(LL mx) {\n\tnum=1;memset(head,0,sizeof(head));\n\tfor(re int i=1;i<=n;i++)\n\t\tfor(re int j=1;j<=m;j++) {\n\t\t\tpd[id[i][j]]=num+1;\n\t\t\tif((i+j)&1) add(S,id[i][j],mx-a[i][j]);\n\t\t\t\telse add(id[i][j],T,mx-a[i][j]);\n\t\t\tif(mx<a[i][j]) return 0;\n\t\t}\n\tfor(re int i=1;i<=n;i++)\n\t\tfor(re int j=1;j<=m;j++) {\n\t\t\tif(!((i+j)&1)) continue;\n\t\t\tfor(re int k=0;k<4;k++) {\n\t\t\t\tint x=i+dx[k],y=j+dy[k];\n\t\t\t\tif(x<1||y<1||x>n||y>m) continue;\n\t\t\t\tadd(id[i][j],id[x][y],inf);\n\t\t\t}\n\t\t}\n\twhile(BFS()) dfs(S,inf);\n\tint flag=1;\n\tfor(re int i=1;i<=n;i++)\t\n\t\tfor(re int j=1;j<=m;j++)\n\t\t\tflag&=(e[pd[id[i][j]]].f==0);\n\treturn flag;\n}\nint main() {\n\tint Test=read();\n\twhile(Test--) {\n\t\tn=read(),m=read();T=0;\n\t\tfor(re int i=1;i<=n;i++)\n\t\t\tfor(re int j=1;j<=m;j++) a[i][j]=read();\n\t\tfor(re int i=1;i<=n;i++)\n\t\t\tfor(re int j=1;j<=m;j++) id[i][j]=++T;\n\t\t++T;\n\t\tLL s[2],tot[2];\n\t\ttot[0]=tot[1]=s[0]=s[1]=0;\n\t\tfor(re int i=1;i<=n;i++)\n\t\t\tfor(re int j=1;j<=m;j++)\n\t\t\t\ttot[(i+j)&1]++,s[(i+j)&1]+=a[i][j];\n\t\tif((n*m)&1) {\n\t\t\tLL x=(s[1]-s[0])/(tot[1]-tot[0]);\n\t\t\tif(check(x)) \n\t\t\t\tprintf(\"%lld\\n\",x*tot[1]-s[1]);\n\t\t\telse puts(\"-1\");\t\t\t\n\t\t}\n\t\telse {\n\t\t\tLL ans=-1,l=1,r=2e9;\n\t\t\tfor(re int i=1;i<=n;i++)\n\t\t\t\tfor(re int j=1;j<=m;j++) l=max(l,a[i][j]);\n\t\t\twhile(l<=r) {\n\t\t\t\tLL mid=l+r>>1;\n\t\t\t\tif(check(mid)) r=mid-1,ans=mid;\n\t\t\t\t\telse l=mid+1;\n\t\t\t}\n\t\t\tif(ans==-1) puts(\"-1\");\n\t\t\telse printf(\"%lld\\n\",ans*tot[1]-s[1]);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1553496975,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5038 \u3010[SCOI2012]\u5947\u602a\u7684\u6e38\u620f\u3011"
    },
    {
        "content": "## \u9898\u89e3\n[\u9898\u76ee](https://www.luogu.com.cn/problem/P5038)  \n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/nanfeng-blog/p/14903824.html)\n\n\u505a\u8fd9\u9898\u4e4b\u524d\uff0c\u505a\u4e86\u4e00\u9053\u53eb[\u661f\u9645\u6218\u4e89](https://www.luogu.com.cn/problem/P3324)\u7684\u9898\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u4e8c\u5206+\u7f51\u7edc\u6d41\uff0c\u90a3\u4e48\u4e8c\u5206\u5565\u5462\uff1f\n\n\u6211\u4eec\u5148\u63a8\u4e00\u4e0b\u5f0f\u5b50\uff0c\u56e0\u4e3a\u662f\u5bf9\u76f8\u90bb\u683c\u5b50\u52a0\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u8054\u60f3\u5230\u9ed1\u767d\u67d3\u8272\u7c7b\u95ee\u9898\u3002\n\n\u8bbe\u6709\u9ed1\u8272\u683c\u5b50 B \u4e2a\uff0c\u5176\u683c\u5b50\u4e2d\u521d\u59cb\u6570\u7684\u548c\u4e3a b\uff0c\u767d\u8272\u683c\u5b50\u540c\u7406\uff0c\u4e2a\u6570\u4e3a W \u4e2a\uff0c\u521d\u59cb\u6743\u503c\u548c\u4e3a w \u4e2a\uff0c\u6700\u540e\u53d8\u6210\u7684\u540c\u4e00\u4e2a\u6570\u4e3a num\u3002\n\n\u53ef\u4ee5\u5f97\u51fa $B\u00d7num-b=W\u00d7num-w$ \u5316\u7b80\u5f97 $num=\\frac{b-w}{B-W}$\u3002\n\n\u9996\u5148\u5bf9\u4e8e\u5316\u7b80\u5f0f\uff0c\u5176\u5fc5\u8981\u6761\u4ef6\u662f $B\\neq W$\uff0c\u90a3\u4e48\u6211\u4eec\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\u3002\n\n\u5bf9\u4e8e $B\\neq W$ \u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7b97\u51fa $num$ \uff0c\u4f46\u662f\u6211\u4eec\u8981\u68c0\u9a8c\u5176\u662f\u5426\u5408\u6cd5\u3002\n\n\u5bf9\u4e8e $B=W$ \u7684\u60c5\u51b5\uff0c\u9996\u5148\u6211\u4eec\u8981\u4fdd\u8bc1 $b=w$ \u5426\u5219\u76f4\u63a5\u65e0\u89e3\u3002\u7136\u540e\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5408\u6cd5\u7684 $num$\uff0c$num+1$ \u4e5f\u662f\u5408\u6cd5\u7684\uff0c\u56e0\u4e3a $B=W$ \u6240\u4ee5\u5728 $n,m$ \u4e2d\u4e00\u5b9a\u6709\u4e00\u4e2a\u662f\u5076\u6570\u3002\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u4e8c\u5206\u6c42\u89e3\uff0c\u627e\u5230\u4e34\u754c\u7684 $num$ \u5c31\u662f\u7b54\u6848\u3002\n\n\u8fd9\u4e2a ``check()`` \u6211\u4eec\u53ef\u4ee5\u7528\u6700\u5927\u6d41\u6c42\u89e3\uff0c\u5bf9\u6bcf\u4e2a\u9ed1\u683c\u5b50\uff0c\u6211\u4eec\u5206\u522b\u5411\u6e90\u70b9 s\uff0c\u6743\u503c\u4e3a $num-w_i$\uff0c\u5b83\u80fd\u5230\u7684\u767d\u683c\u5b50\uff0c\u6743\u503c\u4e3a INF \u8fde\u8fb9\uff0c\u5bf9\u6bcf\u4e2a\u767d\u683c\u5b50\uff0c\u6211\u4eec\u5411\u6c47\u70b9 t \u8fde\u8fb9\uff0c\u6743\u503c\u4e3a $num-w_i$\u3002\n\n\u5bf9\u8fd9\u5f20\u56fe\u8dd1\u6700\u5927\u6d41\uff0c\u5982\u679c\u6700\u5927\u6d41\u7b49\u4e8e $B\u00d7num-b$ \u90a3\u4e48\u8bf4\u660e\u8fd9\u5f20\u56fe\u8dd1\u6ee1\u4e86\uff0c\u8bf4\u660e\u7b54\u6848\u6b63\u786e\u3002\n\n$AC\\kern 0.4em CODE:$\n```cpp\n#include<bits/stdc++.h>\n#define ri register signed\n#define p(i) ++i\nusing namespace std;\nnamespace IO{\n    char buf[1<<21],*p1=buf,*p2=buf;\n    #define gc() p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++\n    inline int read() {\n        ri x=0,f=1;char ch=gc();\n        while(ch<'0'||ch>'9') {if (ch=='-') f=-1;ch=gc();}\n        while(ch>='0'&&ch<='9') {x=(x<<1)+(x<<3)+(ch^48);ch=gc();}\n        return x*f;\n    }\n}\nusing IO::read;\nnamespace nanfeng{\n    #define int long long//\u61d2\u4eba\u5fc5\u5907\n    #define cmax(x,y) ((x)>(y)?(x):(y))\n    #define cmin(x,y) ((x)>(y)?(y):(x))\n    #define FI FILE *IN\n    #define FO FILE *OUT\n    #undef bool\n    static const int N=45;\n    int ch[N][N],id[N][N],n,m,T,tot=1,B,b,W,w,mx;\n    namespace NetworkFlows{\n        #define jud(i,j) ((i)&&(j)&&(i)<=n&&(j)<=m)\n        static const int INF=1e18+7;\n        int first[N*N],dep[N*N],cur[N*N],que[N*N],t=2,sw,s=1,et;\n        signed dx[5]={0,1,0,-1,0},dy[5]={0,0,1,0,-1};\n        struct edge{int v,nxt,w;}e[N*N*5];\n        inline void add(int u,int v,int w) {\n            e[t].v=v,e[t].w=w;\n            e[t].nxt=first[u];\n            first[u]=t++;\n        }\n        inline void init() {et=n*m+2,t=2,sw=0;memset(first,0,sizeof(first));}\n        inline void build(int w) {\n            for (ri i(1);i<=n;p(i)) {\n                for (ri j(1);j<=m;p(j)) {\n                    if (!((i+j)%2)) {\n                        sw+=w-ch[i][j];\n                        add(s,id[i][j],w-ch[i][j]);\n                        add(id[i][j],s,0);\n                        for (ri d(1);d<=4;p(d)) {\n                            if (jud(i+dx[d],j+dy[d])) add(id[i][j],id[i+dx[d]][j+dy[d]],INF),add(id[i+dx[d]][j+dy[d]],id[i][j],0);\n                        }\n                    } else add(id[i][j],et,w-ch[i][j]),add(et,id[i][j],0);\n                }\n            }\n        }\n        inline bool bfs(int s,int t) {\n            memset(dep,0,sizeof(dep));\n            ri hd=1,tl=0;\n            dep[que[p(tl)]=s]=1;\n            cur[s]=first[s];\n            while(hd<=tl) {\n                s=que[hd++];\n                for (ri i(first[s]),v;i;i=e[i].nxt) {\n                    if (e[i].w&&!dep[v=e[i].v]) {\n                        dep[v]=dep[s]+1;\n                        cur[que[p(tl)]=v]=first[v];\n                        if (v==t) return 1;\n                    }\n                }\n            }\n            return 0;\n        }\n        int dfs(int x,int flow) {\n            if (x==et||!flow) return flow;\n            int rst=flow;\n            for (ri i(cur[x]),v;i&&rst;i=e[i].nxt) {\n                if (e[i].w&&dep[v=e[i].v]==dep[x]+1) {\n                    register int k;\n                    if (!(k=dfs(v,cmin(e[i].w,rst)))) dep[v]=0;\n                    e[i].w-=k,e[i^1].w+=k,rst-=k;\n                }\n                cur[x]=i;\n            }\n            return flow-rst;\n        }\n        inline int dinic() {\n            int res=0;\n            while(bfs(s,et)) res+=dfs(s,INF);\n            return res;\n        }\n    }\n    inline bool check(int w) {\n        NetworkFlows::init();\n        NetworkFlows::build(w);\n        return NetworkFlows::dinic()==NetworkFlows::sw;\n    }\n    inline void init() {mx=B=b=W=w=0,tot=1;}\n    inline int main() {\n        // FI=freopen(\"nanfeng.in\",\"r\",stdin);\n        // FO=freopen(\"nanfeng.out\",\"w\",stdout);\n        T=read();\n        for (ri z(1);z<=T;p(z)) {\n            init();\n            n=read(),m=read();\n            for (ri i(1);i<=n;p(i)) {\n                for (ri j(1);j<=m;p(j)) {\n                    ch[i][j]=read(),id[i][j]=p(tot);\n                    mx=cmax(mx,ch[i][j]);\n                    if (!((i+j)%2)) p(B),b+=ch[i][j];\n                    else p(W),w+=ch[i][j];\n                }\n            }\n            if (B!=W) {\n                int num=(b-w)/(B-W);\n                if (num>=mx&&check(num)) printf(\"%lld\\n\",B*num-b);\n                else puts(\"-1\"); \n            } else {\n                if (b!=w) {puts(\"-1\");continue;}\n                int l=mx,r=1e11,res=-1;\n                while(l<=r) {\n                    int mid((l+r)>>1);\n                    if (check(mid)) r=mid-1,res=mid;\n                    else l=mid+1;\n                }\n                printf(\"%lld\\n\",res==-1?-1:B*res-b);\n            }\n        }\n        return 0;\n    }\n    #undef int\n}\nint main() {return nanfeng::main();}\n```",
        "postTime": 1624097907,
        "uid": 141958,
        "name": "\u6960\u67ab",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5038 [SCOI2012]\u5947\u602a\u7684\u6e38\u620f"
    },
    {
        "content": "\u633a\u6709\u610f\u601d\u7684\u4e00\u9053\u9898\u3002\n\n\u6211\u4eec\u77e5\u9053\u5728\u65b9\u683c\u56fe\u4e0a\u9762\u76f8\u90bb\u7684\u4e24\u4e2a\u70b9\u7684\u5750\u6807\u548c\u7684\u5947\u5076\u6027\u662f\u4e0d\u540c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u636e\u6b64\u8fdb\u884c\u9ed1\u767d\u67d3\u8272\uff0c\u8fd9\u4e2a\u9996\u5148\u5e94\u8be5\u662f\u5957\u8def\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u6bcf\u6b21\u64cd\u4f5c\u90fd\u5fc5\u7136\u6bcf\u6b21\u6709\u4e00\u4e2a\u9ed1\u683c\u548c\u4e00\u4e2a\u767d\u683c\u6743\u503c\u589e\u52a0 $1$\uff0c\u4e5f\u5c31\u662f\uff0c\u5982\u679c\u6700\u7ec8\u5300\u4e0b\u6765\u90a3\u4e2a\u6743\u503c\u771f\u7684\u5b58\u5728\u90a3\u4e48\u9996\u5148\u9ed1\u767d\u683c\u5b50\u589e\u52a0\u7684\u91cf\u5fc5\u987b\u76f8\u540c\u3002\n\n\u4e5f\u5c31\u662f\uff0c\u8bbe\u6700\u7ec8\u503c\u4e3a $x$\uff0c\u6709\n$$\ncnt_a\\times x-sum_a=cnt_b\\times x-sum_b\n$$\n\u90a3\u4e48\u4e8b\u5b9e\u4e0a\u8981\u662f\u9ed1\u683c\u548c\u767d\u683c\u7684\u6570\u76ee\u4e0d\u76f8\u540c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u90a3\u4e2a\u503c\u7b97\u51fa\u6765\uff0c\u5e76\u4e14\u53ef\u884c\u5f53\u4e14\u4ec5\u5f53\u8fd9\u4e2a\u503c\u53ef\u884c\u3002\u4e3a\u4ec0\u4e48\u76f8\u540c\u4e0d\u80fd\u76f4\u63a5\u7b97\u89c1\u4e0b\u9762\u67ff\u5b50\uff08\u9664\u96f6\u9519\uff09\u3002\n$$\nx=\\frac{sum_b-sum_a}{cnt_b-cnt_a}\n$$\n\u6316\u6398\u4e00\u4e0b $cnt_a$ \u548c $cnt_b$ \u7684\u610f\u4e49\uff0c\u53d1\u73b0\u8fd9\u4e24\u4e2a\u76f8\u540c\uff0c\u5f53\u4e14\u4ec5\u5f53 $n\\times m$ \u4e3a\u5076\u6570\u3002\u56e0\u4e3a\u8fd9\u4e1c\u897f\u662f\u9ed1\u767d\u67d3\u8272\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7ed3\u8bba\u5f88\u660e\u663e\uff0c\u4e4b\u6240\u4ee5\u76f8\u540c\u4e0d\u80fd\u8fd9\u4e48\u641e\uff0c\u662f\u56e0\u4e3a\u663e\u7136\u8fd9\u6837\u81f3\u5c11\u6709\u4e00\u6761\u8fb9\u957f\u5ea6\u662f\u5076\u6570\uff0c\u4e8e\u662f\u663e\u7136\u5982\u679c\u67d0\u4e2a\u503c\u5408\u6cd5\uff0c\u90a3\u4e48\u4e00\u5b9a\u53ef\u4ee5\u5f80\u4e0a\u518d\u5806\u4e00\u5c42\u4ecd\u7136\u5408\u6cd5\u3002\u4e8e\u662f\u5408\u6cd5\u503c\u5c31\u6709 $\\text{inf}$ \u4e2a\u4e86\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u90a3\u4e2a\u503c\u6ee1\u8db3\u5355\u8c03\u6027\uff0c\u53ef\u4ee5\u4e8c\u5206\u3002\n\n\u4e0e\u6b64\u540c\u65f6\uff0c\u8fd9\u6837\u4e5f\u5e26\u6765\u4e86\u4e00\u4e2a\u65b0\u7ea6\u675f\uff0c\u4e5f\u5c31\u662f\u6743\u503c\u76f8\u540c\uff0c\u70b9\u6570\u76f8\u540c\uff0c\n\n\u7136\u540e\u662f\u5982\u4f55\u68c0\u67e5\u67d0\u4e2a\u503c\u7684\u5408\u6cd5\u6027\uff0c\u9996\u5148\u5efa\u51fa\u4e8c\u5206\u56fe\uff0c\u9ed1\u7684\u8fde\u6e90\u767d\u7684\u8fde\u6c47\uff0c\u6743\u503c\u662f\u76ee\u6807\u503c\u51cf\u53bb\u539f\u6743\u503c\u3002\u7136\u540e\u9ed1\u7684\u5411\u5468\u8fb9\u767d\u7684\u8fde\u8fb9\uff0c\u6743\u503c $\\text{inf}$\u3002\u6ce8\u610f\u8fd9\u91cc\u7684 $\\text{inf}$ \u4e00\u5b9a\u8981\u5f00\u7684\u591f\u5927\uff0c\u6211\u5f00 $10^{16}$ \u90fd\u6302\u4e86\u2026\u2026\n\n\u8fd9\u4e2a\u6a21\u578b\u7684\u6b63\u786e\u6027\u6bd4\u8f83\u663e\u7136\uff0c\u4e00\u4e2a\u6d41\u91cf\u5bf9\u5e94\u589e\u52a0\u4e00\u4e2a\u6743\u503c\uff0c\u67d0\u4e00\u4e2a\u989c\u8272\u7684\u6743\u503c\u589e\u52a0\u5fc5\u987b\u8981\u5468\u8fb9\u7684\u683c\u5b50\u6743\u503c\u4e5f\u589e\u52a0\uff0c\u6700\u540e\u5224\u4e00\u4e0b\u662f\u5426\u6ee1\u6d41\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nstruct Edge{\n    int u,v;\n    long long c,w;\n};\nstruct dinic{\n    const static int N=100005;\n    int n,m,s,t;\n    vector<Edge>E;\n    vector<int>to[N];\n    int d[N],C[N];//\u53bb\u6389\u4e86\u5f53\u524d\u5f27\u4f18\u5316 | \u53c8\u52a0\u4e0a\u4e86\uff08\n    bool vis[N];\n    void clear(int n){\n        for(int i=1;i<=n;i++)\n            to[i].clear();\n        E.clear();\n    }\n    void AddEdge(int u,int v,long long w){\n        E.push_back({u,v,w,0});\n        E.push_back({v,u,0,0});\n        m=E.size();\n        to[u].push_back(m-2);\n        to[v].push_back(m-1);\n    }\n    bool bfs(){\n        memset(vis,0,sizeof(vis));\n        queue<int>que;\n        que.push(s);\n        d[s]=0;\n        vis[s]=1;\n        while(!que.empty()){\n            int cur=que.front();\n            que.pop();\n            for(int i=0;i<to[cur].size();i++){\n                Edge& x=E[to[cur][i]];\n                if(!vis[x.v]&&x.c>x.w){\n                    vis[x.v]=1;\n                    d[x.v]=d[cur]+1;\n                    que.push(x.v);\n                }\n            }\n        }\n        return vis[t];\n    }\n    long long dfs(int u,long long v){\n        if(u==t||v==0)\n            return v;\n        long long w=0,f;\n        for(int i=C[u];i<to[u].size();i++){\n            C[u]=i;\n            Edge& e=E[to[u][i]];\n            if(d[u]+1==d[e.v]&&(f=dfs(e.v,min(v,e.c-e.w)))>0){\n                e.w+=f;\n                E[to[u][i]^1].w-=f;\n                w+=f;\n                v-=f;\n                if(v==0)\n                    break;\n            }\n        }\n        return w;\n    }\n    long long Maxflow(int s,int t){\n        this->s=s;\n        this->t=t;\n        long long res=0;\n        while(bfs()){\n            memset(C,0,sizeof(C));\n            res+=dfs(s,1e18);\n        }\n        return res;\n    }\n}R;\nint T,n,m,ans,a[50][50],mx;\nint ca,cb,sa,sb;\nint MK(int u,int v){\n    return (u-1)*m+v;\n}\nbool JiNiTaiMei(int u,int v){\n    return u>=1&&u<=n&&v>=1&&v<=m;\n}\nbool CaiXuKun(int val){\n    if(mx>val)\n        return 0;\n    R.clear(n*m+2);\n    long long sum=val*ca-sa;\n    for(int i=1;i<=n;i++)\n        for(int j=1;j<=m;j++){\n            if((i+j)%2){\n                R.AddEdge(1,MK(i,j)+2,val-a[i][j]);\n                if(JiNiTaiMei(i-1,j))\n                    R.AddEdge(MK(i,j)+2,MK(i-1,j)+2,1e18);\n                if(JiNiTaiMei(i+1,j))\n                    R.AddEdge(MK(i,j)+2,MK(i+1,j)+2,1e18);\n                if(JiNiTaiMei(i,j-1))\n                    R.AddEdge(MK(i,j)+2,MK(i,j-1)+2,1e18);\n                if(JiNiTaiMei(i,j+1))\n                    R.AddEdge(MK(i,j)+2,MK(i,j+1)+2,1e18);\n            }else R.AddEdge(MK(i,j)+2,2,val-a[i][j]);\n        }\n    return R.Maxflow(1,2)==sum;\n}\nsigned main(){\n    scanf(\"%lld\",&T);\n    while(T--){\n        scanf(\"%lld%lld\",&n,&m);\n        ca=cb=sa=sb=mx=0;\n        for(int i=1,u;i<=n;i++)\n            for(int j=1;j<=m;j++){\n                scanf(\"%lld\",&a[i][j]);\n                mx=max(mx,a[i][j]);\n                if((i+j)%2){\n                    ca++;\n                    sa+=a[i][j];\n                }else {\n                    cb++;\n                    sb+=a[i][j];\n                }\n            }\n        if(cb!=ca){\n            long long _=(sb-sa)/(cb-ca);\n            if(CaiXuKun(_))\n                printf(\"%lld\\n\",_*ca-sa);\n            else puts(\"-1\");\n        }else {\n            if(sa!=sb){\n                puts(\"-1\");\n                continue;\n            }\n            ans=-1;\n            int l=mx,r=1e18,mid;\n            while(l<=r){\n                mid=(l+r)/2;\n                if(CaiXuKun(mid)){\n                    ans=mid*ca-sa;\n                    r=mid-1;\n                }else l=mid+1;\n            }\n            printf(\"%lld\\n\",ans);\n        }\n    }\n}/*\n\n*/\n```\n\n\u6574\u597d\u529b/cy",
        "postTime": 1609755199,
        "uid": 251723,
        "name": "Schwarzkopf_Henkal",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5038 \u3010[SCOI2012]\u5947\u602a\u7684\u6e38\u620f\u3011"
    },
    {
        "content": "\u670d\u4e86\u2026\u2026\u6572\u5b8c\u677f\u5b50\u53bb\u677f\u5b50\u533a\u6d4b \u53d1\u73b0\u8fc7\u4e86 \u8c03\u4e86\u534a\u5929\u6700\u540e\u8fd8\u662f\u677f\u5b50\u7684\u95ee\u9898\u2026\u2026\n\n#### \u7b80\u8ff0\u6a21\u578b\n\n> \u7ed9\u5b9a $n\\times m$ \u7684\u65b9\u9635\uff0c\u6bcf\u6b21\u53ef\u4ee5\u9009\u62e9\u4e24\u4e2a\u76f8\u90bb\u6570 $+1,$ \u95ee\u80fd\u5426\u5f97\u5230\u4e00\u4e2a\u6240\u6709\u6570\u90fd\u76f8\u7b49\u7684\u77e9\u9635\u3002\n\n\u8003\u8651\u7ecf\u5178\u5957\u8def\u3002\u5c24\u5176\u662f\u8fd9\u79cd\u76f8\u90bb\u7684\u4f4d\u7f6e\uff0c\u76f4\u63a5\u9ed1\u767d\u67d3\u8272\uff0c\u9ed1\u8272\u683c\u5b50\u7684\u548c\u4e0e\u767d\u8272\u683c\u5b50\u7684\u548c\u4e0d\u53d8\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5bf9\u4e8e $2|n\\times m$ \u7684\u60c5\u51b5\uff0c\u5982\u679c $x$ \u662f\u53ef\u884c\u89e3\uff0c\u5219 $x+1$ \u5fc5\u7136\u662f\u53ef\u884c\u89e3\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u7528\u82e5\u5e72\u64cd\u4f5c\u8986\u76d6\u6240\u6709\u68cb\u76d8\u683c\u3002\n\n\u663e\u7136\u53ef\u4ee5\u4e8c\u5206\u6c42\u89e3\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e $n\\times m$ \u4e3a\u5947\u6570\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53d1\u73b0\u9ed1\u767d\u683c\u5b50\u53ea\u6709\u4e00\u4e2a\u683c\u5b50\u53ef\u4ee5\u4e0d\u4e00\u6837\uff0c\u800c\u8fd9\u4e2a\u5dee\u503c\u5c31\u662f\u6700\u7ec8\u7684\u68cb\u76d8\u683c\u5b50\u4e0a\u7684\u6570\u3002\u56e0\u4e3a\u64cd\u4f5c\u4e0d\u4f1a\u6539\u53d8\u5dee\uff0c\u5982\u679c\u6700\u7ec8\u7b54\u6848\u4e0d\u662f\u8fd9\u4e2a\u6570\uff0c\u90a3\u4e48\u4e00\u5b9a\u4e0d\u4f1a\u6ee1\u8db3\u521d\u59cb\u60c5\u51b5\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u7b54\u6848 $v$ \u5982\u4f55\u68c0\u9a8c\u662f\u5426\u5408\u6cd5\u3002\u6211\u4eec\u663e\u7136\u9ed1\u767d\u4e8c\u5206\u56fe\uff0c\u6211\u4eec\u4ece $s$ \u5411\u9ed1\u70b9\u8fde\u8fb9\uff0c\u767d\u70b9\u5411 $t$ \u8fde\u8fb9\uff0c\u6e90\u6c47\u70b9\u4e4b\u95f4\u7684\u6d41\u91cf\u5c31\u662f $x-a_{i,j},$ \u8868\u793a\u8fd9\u4e2a\u70b9\u8fd8\u5dee\u8fd9\u4e48\u591a\u6d41\u91cf\u8fbe\u5230\u9650\u5236\uff0c\u800c\u76f8\u90bb\u683c\u5b50\u4e4b\u95f4\u8fde\u6d41\u91cf\u65e0\u9650\u5927\u7684\u8fb9\uff0c\u6700\u540e\u53ea\u9700\u8981\u770b\u8fb9\u662f\u5426\u6ee1\u6d41\u5c31\u884c\u4e86\u3002\u6216\u8005\u76f4\u63a5\u770b $s$ \u7684\u51fa\u6d41\u91cf\u662f\u5426\u548c $\\sum x-a_{i,j}$ \u76f8\u7b49\u5373\u53ef\u3002\u6c42\u548c\u53f7\u91cc\u9762\u7684\u683c\u5b50\u662f\u9ed1\u8272\u683c\u5b50\u3002\n\n\u81f3\u4e8e\u5982\u4f55\u9ed1\u767d\u67d3\u8272\uff0c\u6309\u7167\u5750\u6807\u4e4b\u548c\u7684\u5947\u5076\u6027\u5212\u5206\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n^2m\\log v)$\n\n\u6ce8\u610f\u591a\u7ec4\u6570\u636e\uff0c\u4ee5\u53ca\u6d1b\u8c37\u7684\u6a21\u677f\u9898\uff08\u6d4b\u8fc7\u4e86\u4e5f\u4e0d\u4e00\u5b9a\u5199\u7684\u6ca1\u95ee\u9898\u2026\u2026\uff09\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef double db;\n#define int long long\n#define fi first\n#define se second\n#define mk make_pair\n#define pb emplace_back\n#define poly vector<int>\n#define Bt(a) bitset<a>\n#define bc __builtin_popcount\n#define pc putchar\n#define ci const int&\n#define Mem(a,b) memset(a,0,sizeof a)\nconst int mod = 1e9 + 7;\nconst db eps = 1e-10;\nconst int inf = (1LL << 60);\ninline int Max(ci x, ci y) {return x > y ? x : y;}\ninline int Min(ci x, ci y) {return x < y ? x : y;}\ninline db Max(db x, db y) {return x - y > eps ? x : y;}\ninline db Min(db x, db y) {return x - y < eps ? x : y;}\ninline int Add(ci x, ci y, ci M = mod) {return (x + y) % M;}\ninline int Mul(ci x, ci y, ci M = mod) {return 1ll * x * y % M;}\ninline int Dec(ci x, ci y, ci M = mod) {return (x - y + M) % M;}\ntypedef pair<int, int> pii;\ninline int Abs(int x) {return x < 0 ? -x : x;}\n//char buf[1<<21],*p1=buf,*p2=buf;\n//#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar Obuf[105000],*O=Obuf;//Siz shoule be the size of Out File\nint pst[30],ptop;\ninline void Fprint(){fwrite(Obuf,1,O-Obuf,stdout);}\ninline void Fwrite(int x){\n  if(x==0){*O++='0';return;}\n  if(x<0)*O++='-',x=-x;ptop=0;\n  while(x)pst[++ptop]=x%10,x/=10;\n  while(ptop)*O++=pst[ptop--]+'0';\n  if(O-Obuf>100000)Fprint(),O=Obuf;\n}\ninline int read() {\n    int s = 0, w = 1;\n    char ch = getchar();\n    while (!isdigit(ch)) {if (ch == '-') w = -1;ch = getchar();}\n    while (isdigit(ch)) {s = s * 10 + ch - '0';ch = getchar();}\n    return s * w;\n}\ninline void write(int x) {\n    if (x < 0)putchar('-'), x = -x;\n    if (x > 9)write(x / 10);\n\tpc(x % 10 + '0');\n}\ninline int qpow(int x, int y) {\n    int res = 1;\n    while (y) {if (y & 1)res = Mul(res, x);x = Mul(x, x);y >>= 1;}\n    return res;\n}\ninline void cadd(int &x, int y) {x += y;}\ninline void cmul(int &x, int y) {x *= y;}\ninline void cmax(int &x, int y) {x = Max(x, y);}\ninline void cmin(int &x, int y) {x = Min(x, y);}\nconst int N = 2e5 + 10;\nnamespace Refined_heart{\n\tconst int dx[]={0,1,0,-1};\n\tconst int dy[]={1,0,-1,0};\n\tint T,a[501][501],stfg;\n\tint n,m,s,t,cur[N],node,head[N],tot=1,gap[N],dep[N];\n\tstruct E{int nxt,to,flow;}e[N];\n\tinline void link(int x,int y,int w){\n\t\te[++tot]=(E){head[x],y,w};head[x]=tot;\n\t\te[++tot]=(E){head[y],x,0};head[y]=tot;\n\t}\n\tqueue<int>q;\n\tint bfs(int s,int t){\n\t\twhile(!q.empty())q.pop();\n\t\tmemset(dep,0,sizeof dep);\n\t\tmemset(gap,0,sizeof gap);\n\t\tdep[t]=1;q.push(t);++gap[1];\n\t\twhile(!q.empty()){\n\t\t\tint x=q.front();q.pop();cur[x]=head[x];\n\t\t\tfor(int i=head[x];i;i=e[i].nxt){\n\t\t\t\tint j=e[i].to;\n\t\t\t\tif(dep[j]||!e[i^1].flow)continue;\n\t\t\t\tdep[j]=dep[x]+1;++gap[dep[j]];\n\t\t\t\tq.push(j);\n\t\t\t}\n\t\t}\n\t\treturn dep[s];\n\t}\n\tint ISAP(int u,int t,int flow){\n\t\tif(u==t||flow<=0)return flow;\n\t\tint rest=flow;\n\t\tfor(int &i=cur[u];i;i=e[i].nxt){\n\t\t\tint j=e[i].to;\n\t\t\tif(dep[j]==dep[u]-1&&e[i].flow){\n\t\t\t\tint tmp=ISAP(j,t,Min(e[i].flow,rest));\n\t\t\t\te[i].flow-=tmp;e[i^1].flow+=tmp;rest-=tmp;\n\t\t\t\tif(rest<=0)return flow-rest;\n\t\t\t}\n\t\t}\n\t\tcur[u]=head[u];--gap[dep[u]];\n\t\tif(!gap[dep[u]])stfg=1;\n\t\t++gap[++dep[u]];return flow-rest;\n\t}\n\tint CALC(int s,int t){\n\t\tint res=0;\n\t\tif(bfs(s,t))while(!stfg)res+=ISAP(s,t,inf);\n\t\treturn res;\n\t}\n\tvoid clear(){\n\t\tMem(head,0);Mem(cur,0);\n\t\tfor(int i=1;i<=tot;++i)e[i]=(E){0,0,0};\n\t\ttot=1;node=0;stfg=0;\n\t}\n\tint np[501][501];\n\tinline int getpos(int x,int y){return (x-1)*m+y;}\n\tinline int ckin(int x,int y){return x>=1&&x<=n&&y>=1&&y<=m;}\n\tvoid CLLL(){\n\t\ts=0;t=0;tot=1;node=0;\n\t\tMem(head,0);Mem(np,0);stfg=0;\n\t}\n\tbool check(int nowv,int &R){\n\t\tclear();s=++node;t=++node;\n\t\tfor(int i=1;i<=n;++i)\n\t\t\tfor(int j=1;j<=m;++j){\n\t\t\t\tnp[i][j]=++node;\n\t\t\t}\n\t\tint sm=0;\n\t\tfor(int i=1;i<=n;++i)\n\t\t\tfor(int j=1;j<=m;++j){\n\t\t\t\tif((i+j)&1)link(s,np[i][j],nowv-a[i][j]),sm+=nowv-a[i][j];\n\t\t\t\telse link(np[i][j],t,nowv-a[i][j]);\n\t\t\t}\n\t\tfor(int i=1;i<=n;++i)\n\t\t\tfor(int j=1;j<=m;++j){\n\t\t\t\tif(!((i+j)&1))continue;\n\t\t\t\tfor(int k=0;k<4;++k){\n\t\t\t\t\tint x=i+dx[k];\n\t\t\t\t\tint y=j+dy[k];\n\t\t\t\t\tif(x<1||y<1||x>n||y>m)continue;\n\t\t\t\t\tlink(np[i][j],np[x][y],inf);\n\t\t\t\t}\n\t\t\t}\n\t\tint fl=CALC(s,t);R=fl;\n\t\tif(fl!=sm)return false;\n\t\treturn true;\n\t}\n\tvoid work(){\n\t\tCLLL();\n\t\tn=read();m=read();s=++node;t=++node;\n\t\tfor(int i=1;i<=n;++i)for(int j=1;j<=m;++j)a[i][j]=read();\n\t\tint siz=n*m;\n\t\tif(siz&1){\n\t\t\tint js=0,os=0;\n\t\t\tfor(int i=1;i<=n;++i)\n\t\t\t\tfor(int j=1;j<=m;++j)\n\t\t\t\t\tif((i+j)&1)js+=a[i][j];\n\t\t\t\t\telse os+=a[i][j];\n\t\t\tint c=os-js;\n\t\t\tint mx=-1;\n\t\t\tfor(int i=1;i<=n;++i)for(int j=1;j<=m;++j)cmax(mx,a[i][j]);\n\t\t\tif(mx>c){\n\t\t\t\tputs(\"-1\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tint gg=0;\n\t\t\tint g=check(c,gg);\n\t\t\tif(!g)puts(\"-1\");\n\t\t\telse write(gg),pc('\\n');\n\t\t\treturn;\n\t\t}\n\t\telse{\n\t\t\tint js=0,os=0;\n\t\t\tfor(int i=1;i<=n;++i)\n\t\t\t\tfor(int j=1;j<=m;++j)\t\n\t\t\t\t\tif((i+j)&1)js+=a[i][j];\n\t\t\t\t\telse os+=a[i][j];\n\t\t\tif(js!=os){\n\t\t\t\tputs(\"-1\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tint mx=-1;\n\t\t\tfor(int i=1;i<=n;++i)for(int j=1;j<=m;++j)cmax(mx,a[i][j]);\n\t\t\tint l=mx,r=(1LL<<50),ans=-1;\n\t\t\twhile(l<=r){\n\t\t\t\tint mid=(l+r)/2;int fll=0;\n\t\t\t\tif(check(mid,fll))ans=fll,r=mid-1;\n\t\t\t\telse l=mid+1;\n\t\t\t}\n\t\t\twrite(ans);pc('\\n');\n\t\t}\n\t}\n\tvoid solve(){\n\t\tT=read();\n\t\twhile(T--)work();\n\t}\n}\nsigned main(){\n\tfreopen(\"in.txt\",\"r\",stdin);\n//\tfreopen(\"My.out\",\"w\",stdout);\n\tRefined_heart::solve();\n\treturn 0;\n}\n\n```\n",
        "postTime": 1641892004,
        "uid": 128591,
        "name": "Refined_heart",
        "ccfLevel": 9,
        "title": "P5038 [SCOI2012]\u5947\u602a\u7684\u6e38\u620f \u9898\u89e3"
    },
    {
        "content": "\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u5b9a\u4e00\u4e2a$n\\times m$\u3001\u6bcf\u4e2a\u70b9\u5e26\u6743\u7684\u77e9\u9635\uff0c\u6bcf\u6b21\u64cd\u4f5c\u53ef\u4ee5\u9009\u4e24\u4e2a\u76f8\u90bb\u7684\u70b9\u4f7f\u5b83\u4eec\u6743\u503c\u52a01\u3002\u6c42\u8981\u662f\u77e9\u9635\u4e2d\u5de6\u53f3\u70b9\u6743\u503c\u76f8\u540c\uff0c\u81f3\u5c11\u8981\u51e0\u6b21\u64cd\u4f5c\u3002\u6c38\u8fdc\u4e0d\u80fd\u8f93\u51fa-1\u3002\n\n[\u539f\u9898](https://www.luogu.com.cn/problem/P5038)\n\n\u9996\u5148\uff0c\u663e\u7136\u53ef\u4ee5\u5bf9\u77e9\u9635\u8fdb\u884c\u9ed1\u767d\u67d3\u8272\uff0c\u6bcf\u6b21\u64cd\u4f5c\u53ea\u4f1a\u5728\u4e00\u9ed1\u4e00\u767d\u4e4b\u95f4\u8fdb\u884c\uff0c\u5373\u9ed1\u767d\u6240\u589e\u52a0\u7684\u503c\u4e00\u5b9a\u76f8\u540c\n\n\u7b97\u51fa\u9ed1\u70b9\u6570\u91cf$numb$\uff0c\u767d\u70b9\u6570\u91cf$numw$\uff0c\u9ed1\u70b9\u6743\u503c\u548c$sumb$\uff0c\u767d\u70b9\u6743\u503c\u548c$sumw$\u3002\u4ee4\u6700\u7ec8\u6240\u6709\u70b9\u53d8\u4e3a$x$\u3002\n\n\u90a3\u4e48\u6709$numb\\times x-sumb=numw \\times x- sumw$\n\n\u79fb\u9879\u5f97\u5230 $(numw-numb)\\times x=sumw-sumb$\n\n\u90a3\u4e48\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n\u5f53$numw\\ne numb$\uff0c\u663e\u7136\u53ef\u4ee5\u76f4\u63a5\u7b97\u51fax\uff0c\u53ea\u8981\u5224\u65adx\u662f\u5426\u53ef\u884c\u5373\u53ef\u3002\u6bd5\u7adf\u6709\u4e9b\u65f6\u5019\uff0c\u8fd9\u4e2ax\u7b97\u51fa\u6765\u8fd8\u6ca1\u6709\u77e9\u9635\u4e2d\u6700\u5927\u503c\u5927\uff0c\u5982\u6837\u4f8b\uff1b\u8fd8\u6709\u4e9b\u65f6\u5019\u5c31\u662f\u65e0\u6cd5\u8fbe\u5230\u4e86\uff0c\u5982$n=1$,$m=3$\uff0c\u77e9\u9635\u4e3a$1,2,1$\u3002\n\n\u8fd9\u4e2a\u600e\u4e48\u5224\u65ad\u89c1\u4e0b\u6587\u3002\n\n\u5f53$numw = numb$ \uff0c\u90a3\u4e48\u5c31\u9700\u8981\u518d\u60f3\u70b9\u529e\u6cd5\u4e86\u3002\n\n\u9996\u5148\u8981\u662f$sumw \\ne sumb$\uff0c\u90a3\u4e48x\u65e0\u89e3\uff0c\u8f93\u51fa-1\u5373\u53ef\u3002\n\n\u5426\u5219\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5408\u6cd5\u7684$x$\u3002\u90a3\u4e48\u65e2\u7136$numw=numb$\uff0c\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u4e00\u5b9a\u6570\u91cf\u7684\u64cd\u4f5c\u6765\u4f7f\u6574\u4e2a\u77e9\u9635\u4e0a\u7684\u70b9\u90fd\u88ab\u64cd\u4f5c\u4e00\u6b21\u3002\u6bd5\u7adf\u6b64\u65f6\uff0c$n\\times m$\u662f\u5076\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4$n$\u548c$m$\u4e2d\u5fc5\u6709\u81f3\u5c11\u4e00\u4e2a\u5076\u6570\u3002\n\n**\u5373\uff0c\u82e5x\u4e0d\u5408\u6cd5\uff0cx-1\u4e00\u5b9a\u4e0d\u5408\u6cd5\uff1b\u82e5x\u5408\u6cd5\uff0cx+1\u4e00\u5b9a\u4e5f\u5408\u6cd5\u3002**\n\n\u6240\u4ee5x\u5b58\u5728\u4e00\u4e2a\u65ad\u70b9\uff0c\u65ad\u70b9\u4ee5\u4e0b\u5168\u90e8\u4e0d\u5408\u6cd5\uff0c\u65ad\u70b9\u4ee5\u4e0a\u5168\u90e8\u5408\u6cd5\u3002\u90a3\u4e48\u5c31\u53ef\u4ee5\u4e8c\u5206\u53bb\u627e\u8fd9\u4e2a\u65ad\u70b9\u4e86\u3002\n\n\u6700\u540e\u53ea\u5269\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u4f55\u5224\u65ad\u4e00\u4e2a$x$\u662f\u5426\u5408\u6cd5\uff1f\n\n\u7f51\u7edc\u6d41\u3002\u5efa\u7acb\u6e90\u70b9s\uff0c\u5c06s\u4e0e\u6240\u6709\u9ed1\u70b9(\u6743\u503c\u4e3a$v$)\u76f8\u8fde\u4e00\u6761\u6d41\u91cf\u4e0a\u9650\u4e3a $x-v$\u7684\u8fb9\uff0c\u8868\u793a\u6bcf\u4e2a\u9ed1\u70b9\u81f3\u591a\u88ab\u64cd\u4f5c$x-v$\u6b21\uff1b\u5728\u5c06\u6bcf\u4e2a\u9ed1\u70b9\u4e0e\u5176\u76f8\u90bb\u767d\u70b9\u5efa\u8fb9\uff0c\u6d41\u91cf\u4e0a\u9650\u81f3\u5c11\u4e3a$x-v$\uff0c\u5f53\u7136\u5f80\u4e0a\u5f00\u4e5f\u884c\uff1b\u6700\u540e\u628a\u6240\u6709\u767d\u70b9(\u6743\u503c\u4e3a$v$)\u4e0e\u6c47\u70b9t\u5efa\u8fb9\uff0c\u8868\u793a\u6bcf\u4e2a\u767d\u70b9\u81f3\u591a\u88ab\u64cd\u4f5c$x-v$ \u6b21\u3002\u7528DINIC\u5f97\u5230\u7684\u6700\u5927\u6d41\u5373\u4e3a\u64cd\u4f5c\u6b21\u6570\u7684\u6700\u5927\u503c\u3002\u5224\u65ad\u8be5\u503c\u662f\u5426\u4e0ex\u6240\u5bf9\u5e94\u7684\uff0c\u5e94\u8be5\u7684\u64cd\u4f5c\u6b21\u6570\u76f8\u7b49\u5373\u53ef\u3002\n\n\u6211\u7684\u4ee3\u7801\u7528$(i-1)\\times m+j$\u8868\u793a\u70b9$(i,j)$\uff0c\u7528\u4e24\u4e2aset\u4fdd\u5b58\u767d\u70b9\u4e0e\u9ed1\u70b9\u3002\u56e0\u6b64\uff0c\u4e0d\u5438\u6c27\u4f1aT\u6389\u3002\u4e0d\u8fc7\u8981\u60f3\u6539\u6210\u6570\u7ec4\u4e5f\u4e0d\u96be\u6539\uff0c\u751a\u81f3\u90fd\u53ef\u4ee5\u4e0d\u4fdd\u5b58\uff0c\u7528set\u53ea\u662f\u4e2a\u4eba\u7231\u597d\u800c\u5df2\u3002\n\n$\\texttt{Talk is cheap,show me your code.}$\n```\n#include <cstdio>\n#include <queue>\n#include <set>\n\n#define int long long\n\nconst int maxn=105,inf=1e18+7;\n\nstruct edge{\n\tint v,nxt,w;\n}e[maxn*maxn];\n\nint n,m,a[maxn*maxn],edge_cnt,fir[maxn*maxn];\nint sum_b,sum_w,num_b,num_w;\nint maxflow,dep[maxn*maxn],go[maxn*maxn],least;\n\nstd::queue<int> q;std::set<int> b,w;\ntypedef std::set<int>::iterator IT;\n\ninline int max(int a,int b){\n\treturn a>b?a:b;\n}\n\ninline int min(int a,int b){\n\treturn a<b?a:b;\n}\n\ninline void add_edge(int u,int v,int w){\n\te[++edge_cnt].nxt=fir[u];e[edge_cnt].v=v,e[edge_cnt].w=w;fir[u]=edge_cnt;\n}\n\nbool bfs(){\n\tfor(int i=1;i<=n*m+1;i++) dep[i]=-1;\n\tq.push(0);\n\twhile(!q.empty()){\n\t\tint u=q.front();q.pop();\n\t\tgo[u]=fir[u];\n\t\tfor(int i=fir[u];~i;i=e[i].nxt){\n\t\t\tint v=e[i].v;if(~dep[v]||e[i].w<=0) continue;\n\t\t\tdep[v]=dep[u]+1;q.push(v);\n\t\t}\n\t}\n\treturn ~dep[n*m+1];\n}\n\nint dfs(int now,int minflow){\n\tif(now==n*m+1) return minflow;\n\tint useflow=0;\n\tfor(int i=go[now];~i&&minflow>0;i=e[i].nxt){\n\t\tgo[now]=i;int v=e[i].v;\n\t\tif(dep[v]==dep[now]+1&&e[i].w>0){\n\t\t\tint tmp=dfs(v,min(minflow,e[i].w));\n\t\t\tif(!tmp) dep[v]=-1;\n\t\t\te[i].w-=tmp,e[i^1].w+=tmp;\n\t\t\tuseflow+=tmp,minflow-=tmp;\n\t\t}\n\t}\n\treturn useflow;\n}\n\nvoid dinic(){\n\twhile(bfs()){\n\t\tmaxflow+=dfs(0,inf);\n\t}\n}\n\nbool check(int key){\n\tif(key<least) return 0;//\u5982\u679c\u8fd8\u6ca1least\u5927\u5c31\u5e9f\u4e86\n\tint pos=num_b*key-sum_b;//\u5e94\u8be5\u7684\u64cd\u4f5c\u6b21\u6570\n\tedge_cnt=-1;for(int i=0;i<=n*m+1;i++) fir[i]=-1;\n\tfor(IT it=b.begin();it!=b.end();it++){\n\t\tint now=*it;\n\t\tadd_edge(0,now,key-a[now]),add_edge(now,0,0);\n\t\tif(w.count(now-1)&&now%m!=1) add_edge(now,now-1,inf),add_edge(now-1,now,0);//\u8981\u5224\u65ad\u662f\u5426\u5728\u77e9\u9635\u6700\u5de6\u4fa7/\u6700\u53f3\u4fa7\uff0c\u8fd9\u91cc\u5751\u4e86\u6211\u4e00\u4e2a\u4e0b\u5348\n\t\tif(w.count(now+1)&&now%m!=0) add_edge(now,now+1,inf),add_edge(now+1,now,0);//\u540c\u4e0a\n\t\tif(w.count(now-m)) add_edge(now,now-m,inf),add_edge(now-m,now,0);\n\t\tif(w.count(now+m)) add_edge(now,now+m,inf),add_edge(now+m,now,0);\n\t}\n\tfor(IT it=w.begin();it!=w.end();it++){\n\t\tadd_edge(*it,n*m+1,key-a[*it]),add_edge(n*m+1,*it,0);\n\t}//\u7f51\u7edc\u6d41\u5efa\u56fe\n\tmaxflow=0;dinic();//\u8dd1dinic,\u8fd9\u4e2a\u8981\u662f\u4e0d\u4f1a\u8bf7\u79fb\u6b65P3376\n\treturn maxflow==pos;\n}\n\nsigned main(){\n\tint cas;scanf(\"%lld\",&cas);\n\twhile(cas--){\n\t\t\n\t\tscanf(\"%lld%lld\",&n,&m);least=0;sum_b=sum_w=num_b=num_w=0;b.clear(),w.clear();\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\tint now=m*(i-1)+j;scanf(\"%lld\",&a[now]);\n\t\t\t\tleast=max(least,a[now]);//least\u8868\u793a\u77e9\u9635\u4e2d\u6700\u5927\u503c\u3002\n\t\t\t\tif((i+j)&1) sum_b+=a[now],num_b++,b.insert(now);\n\t\t\t\telse sum_w+=a[now],num_w++,w.insert(now);//\u7ef4\u62a4\u767d\u70b9\uff0c\u9ed1\u70b9\u7684\u96c6\u5408\n\t\t\t}\n\t\t}\n\t\tif(num_b!=num_w){\n\t\t\tint x=(sum_w-sum_b)/(num_w-num_b);//\u6211\u8fd9\u767d\u70b9\u6bd4\u9ed1\u70b9\u591a\uff0c\u539f\u56e0\u53c2\u89c1\u6211\u5982\u4f55\u89c4\u5b9a\u90a3\u4e9b\u662f\u767d\u70b9\n\t\t\tif(check(x)) printf(\"%lld\\n\",x*num_w-sum_w);\n\t\t\telse printf(\"-1\\n\");\n\t\t}\n\t\telse{\n\t\t\tif(sum_b!=sum_w){printf(\"-1\\n\");continue;}\n\t\t\tint l=least,r=inf,ans=-1;//\u81f3\u5c11\u8981\u6bd4least\u5927\n\t\t\twhile(l<=r){\n\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\tif(check(mid)){\n\t\t\t\t\tr=mid-1;\n\t\t\t\t\tans=mid*num_b-sum_b;\n\t\t\t\t}\n\t\t\t\telse l=mid+1;\n\t\t\t}\n\t\t\tprintf(\"%lld\\n\",ans);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1599137541,
        "uid": 101984,
        "name": "Rui_R",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5038 \u3010[SCOI2012]\u5947\u602a\u7684\u6e38\u620f\u3011"
    },
    {
        "content": "## \u5206\u6790\n\u4e0d\u662f\u5f88\u597d\u60f3\u3002\n\n\u770b\u5230\u4e8c\u7ef4\u68cb\u76d8\u4e0a\u7684\u95ee\u9898\u8003\u8651\u9ed1\u767d\u67d3\u8272\uff0c\u8bbe\u4e00\u5171\u6709 $cnt_1$ \u4e2a\u767d\u70b9\uff0c\u8fd9\u4e9b\u767d\u70b9\u7684\u6743\u503c\u548c\u4e3a $sum_1$\uff1b\u8bbe\u4e00\u5171\u6709 $cnt_2$ \u4e2a\u9ed1\u70b9\uff0c\u8fd9\u4e9b\u9ed1\u70b9\u7684\u6743\u503c\u548c\u4e3a $sum_2$\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u6bcf\u4e00\u6b21\u4f1a\u5bf9\u76f8\u90bb\u7684\u683c\u5b50\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\u64cd\u4f5c\u82e5\u5e72\u6b21\u540e\uff0c\u9ed1\u70b9\u548c\u767d\u70b9\u589e\u52a0\u7684\u603b\u4ef7\u503c\u662f\u76f8\u540c\u7684\uff0c\u8bbe\u6700\u540e\u68cb\u76d8\u4e0a\u7684\u70b9\u90fd\u53d8\u6210\u4e86 $x$\uff0c\u90a3\u4e48\u5c31\u6709 $x \\times cnt_1-sum_1=x \\times cnt_2 -sum_2$\u3002\n\n\u5316\u7b80\u540e\u53ef\u5f97 $x(cnt_1-cnt_2)=sum_1-sum_2$\u3002\n\n\u6b64\u65f6\uff0c\u5982\u679c $cnt_1-cnt_2$ \u4e0d\u4e3a $0$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u4e00\u90e8\u5206\u9664\u8fc7\u53bb\u5f97\u5230 $x$ \u7684\u503c\u5224\u65ad\u662f\u5426\u5408\u6cd5\u5373\u53ef\uff1b\u5982\u679c\u4e3a $0$\uff0c\u90a3\u4e48\u8bf4\u660e\u68cb\u76d8\u5185\u683c\u5b50\u7684\u603b\u4e2a\u6570\u4e00\u5b9a\u4e3a\u5076\u6570\u3002\n\n\u5982\u679c $x$ \u5408\u6cd5\uff0c\u4e00\u5b9a\u53ef\u4ee5\u7ecf\u8fc7\u82e5\u5e72\u6b21\u64cd\u4f5c\u540e\u53d8\u6210 $x+1$\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e8c\u5206\u7b54\u6848\u7136\u540e\u5224\u65ad\u662f\u5426\u5408\u6cd5\uff0c\u5224\u65ad\u662f\u5426\u5408\u6cd5\u53ef\u4ee5\u8dd1\u7f51\u7edc\u6d41\u3002\n\n\u8bbe\u68cb\u76d8\u4e2d\u539f\u6765\u7684\u6570\u4e3a $val$\uff0c\n\n$1$\u3001\u4ece\u6e90\u70b9\u5411\u6240\u6709\u767d\u70b9\u5efa\u4e00\u6761\u6743\u503c\u4e3a $x-val$ \u7684\u8fb9\u3002\n\n$2$\u3001\u4ece\u767d\u70b9\u5411\u6240\u6709\u548c\u5b83\u76f8\u90bb\u7684\u9ed1\u70b9\u5efa\u4e00\u6761\u6743\u503c\u4e3a $inf$ \u7684\u8fb9\u3002\n\n$3$\u3001\u4ece\u9ed1\u70b9\u5411\u6c47\u70b9\u5efa\u4e00\u6761\u6743\u503c\u4e3a $x-val$ \u7684\u8fb9\u3002\n\n\u5224\u65ad\u6700\u5927\u6d41\u662f\u5426\u7b49\u4e8e $\\sum(x-val)$ \u5373\u53ef\u3002\n\n\u6ce8\u610f\u4e8c\u5206\u7684\u4e0b\u754c\u8981\u4ece\u539f\u56fe\u7684\u6700\u5927\u6743\u503c\u5f00\u59cb\u9009\u3002\n## \u4ee3\u7801\n``` cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#define rg register\ninline int read(){\n\trg int x=0,fh=1;\n\trg char ch=getchar();\n\twhile(ch<'0' || ch>'9'){\n\t\tif(ch=='-') fh=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0' && ch<='9'){\n\t\tx=(x<<1)+(x<<3)+(ch^48);\n\t\tch=getchar();\n\t}\n\treturn x*fh;\n}\nconst int maxn=2e3+5,maxm=2e4+5;\nconst int dx[6]={0,0,-1,1},dy[6]={-1,1,0,0};\nconst long long INF=100000000000000LL;\nint h[maxn],tot=2,n,m,tt;\nstruct asd{\n\tint to,nxt;\n\tlong long val;\n}b[maxm];\nvoid ad(int aa,int bb,long long cc){\n\tb[tot].to=bb;\n\tb[tot].nxt=h[aa];\n\tb[tot].val=cc;\n\th[aa]=tot++;\n}\nint js(int i,int j){\n\treturn (i-1)*m+j;\n}\nint a[maxn][maxn],s,t,h2[maxn],mmax,cnt0,cnt1,jlmax;\nbool jud[maxn][maxn];\nlong long sum0,sum1;\nint dep[maxn],q[maxn],head,tail;\nbool bfs(){\n\tfor(rg int i=0;i<=mmax;i++){\n\t\tdep[i]=0;\n\t\th[i]=h2[i];\n\t}\n\tq[head=tail=1]=s;\n\tdep[s]=1;\n\twhile(head<=tail){\n\t\trg int now=q[head++];\n\t\tfor(rg int i=h[now];i!=-1;i=b[i].nxt){\n\t\t\trg int u=b[i].to;\n\t\t\tif(!dep[u] && b[i].val){\n\t\t\t\tdep[u]=dep[now]+1;\n\t\t\t\tq[++tail]=u;\n\t\t\t}\n\t\t}\n\t}\n\treturn dep[t];\n}\nlong long dfs(int now,long long ac1){\n\tif(now==t) return ac1;\n\tlong long ac2=0;\n\tfor(rg int i=h[now];i!=-1;i=b[i].nxt){\n\t\th[now]=i;\n\t\trg int u=b[i].to;\n\t\tif(dep[u]==dep[now]+1 && b[i].val){\n\t\t\trg long long nans=dfs(u,std::min(ac1,b[i].val));\n\t\t\tac1-=nans;\n\t\t\tac2+=nans;\n\t\t\tb[i].val-=nans;\n\t\t\tb[i^1].val+=nans;\n\t\t}\n\t\tif(ac1==0) break;\n\t}\n\tif(ac2==0) dep[now]=0;\n\treturn ac2;\n}\nbool pd(long long val){\n\tmemset(h,-1,sizeof(h));\n\ttot=2;\n\tfor(rg int i=1;i<=n;i++){\n\t\tfor(rg int j=1;j<=m;j++){\n\t\t\tif(jud[i][j]==0){\n\t\t\t\tad(s,js(i,j),std::max(val-a[i][j],0LL));\n\t\t\t\tad(js(i,j),s,0);\n\t\t\t} else {\n\t\t\t\tad(js(i,j),t,std::max(val-a[i][j],0LL));\n\t\t\t\tad(t,js(i,j),0);\n\t\t\t}\n\t\t}\n\t}\n\tfor(rg int i=1;i<=n;i++){\n\t\tfor(rg int j=1;j<=m;j++){\n\t\t\tif(jud[i][j]) continue;\n\t\t\tfor(rg int k=0;k<4;k++){\n\t\t\t\trg int nx=i+dx[k],ny=j+dy[k];\n\t\t\t\tif(nx<1 || ny<1 || nx>n || ny>m || jud[nx][ny]==jud[i][j]) continue;\n\t\t\t\tad(js(i,j),js(nx,ny),INF);\n\t\t\t\tad(js(nx,ny),js(i,j),0);\n\t\t\t}\n\t\t}\n\t}\n\trg long long nans=0,mans=0;\n\tfor(rg int i=1;i<=n;i++){\n\t\tfor(rg int j=1;j<=m;j++){\n\t\t\tif(jud[i][j]==0) mans+=std::max(val-a[i][j],0LL);\n\t\t}\n\t}\n\tfor(rg int i=0;i<=mmax;i++){\n\t\th2[i]=h[i];\n\t}\n\twhile(bfs()){\n\t\tnans+=dfs(s,INF);\n\t}\n\tif(nans==mans) return 1;\n\telse return 0;\n}\nint main(){\n\ttt=read();\n\twhile(tt--){\n\t\tsum0=sum1=0,cnt0=cnt1=jlmax=0;\n\t\tn=read(),m=read();\n\t\tfor(rg int i=1;i<=n;i++){\n\t\t\tfor(rg int j=1;j<=m;j++){\n\t\t\t\ta[i][j]=read();\n\t\t\t\tjlmax=std::max(jlmax,a[i][j]);\n\t\t\t}\n\t\t}\n\t\tfor(rg int i=1;i<=n;i++){\n\t\t\tfor(rg int j=1;j<=m;j++){\n\t\t\t\tif(j==1){\n\t\t\t\t\tjud[i][j]=jud[i-1][j]^1;\n\t\t\t\t} else {\n\t\t\t\t\tjud[i][j]=jud[i][j-1]^1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(rg int i=1;i<=n;i++){\n\t\t\tfor(rg int j=1;j<=m;j++){\n\t\t\t\tif(jud[i][j]){\n\t\t\t\t\tcnt1++;\n\t\t\t\t\tsum1+=a[i][j];\n\t\t\t\t} else {\n\t\t\t\t\tcnt0++;\n\t\t\t\t\tsum0+=a[i][j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ts=0,t=n*m+1,mmax=n*m+1;\n\t\tif(cnt0!=cnt1){\n\t\t\trg long long now=1LL*(sum1-sum0)/(cnt1-cnt0);\n\t\t\tif(pd(now) && now>=jlmax) printf(\"%lld\\n\",1LL*now*cnt0-sum0);\n\t\t\telse printf(\"-1\\n\");\n\t\t} else {\n\t\t\trg long long l=jlmax,r=INF,mids;\n\t\t\twhile(l<=r){\n\t\t\t\tmids=(l+r)>>1;\n\t\t\t\tif(pd(mids)) r=mids-1;\n\t\t\t\telse l=mids+1;\n\t\t\t}\n\t\t\tif(pd(l)==0) printf(\"-1\\n\");\n\t\t\telse printf(\"%lld\\n\",1LL*cnt0*l-sum0);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1657582364,
        "uid": 316322,
        "name": "hzoi_liuchang",
        "ccfLevel": 7,
        "title": "P5038 [SCOI2012]\u5947\u602a\u7684\u6e38\u620f \u9898\u89e3"
    },
    {
        "content": "\u9898\u76ee\u8be2\u95ee\u4e86\u4e00\u4e2a\u4e0d\u80fd\u786e\u5b9a\u7684\u65f6\u95f4\uff0c\u6240\u4ee5\u663e\u7136\u505a\u6cd5\u4e2d\u8981\u5305\u542b\u4e00\u4e2a\u4e8c\u5206\u7b54\u6848\u3002\n\n\u6211\u4eec\u5c06\u6574\u5f20\u56fe\u5206\u4e3a\u9ed1\u767d\u70b9\u4e24\u79cd\uff0c\u9ed1\u70b9\u65c1\u8fb9\u7684\u70b9\u5c31\u662f\u767d\u70b9\uff0c\u767d\u70b9\u65c1\u8fb9\u7684\u70b9\u5c31\u662f\u9ed1\u70b9\uff0c\u60f3\u4e00\u4e0b\u5c31\u80fd\u77e5\u9053\uff0c\u6bcf\u6b21\u64cd\u4f5c\u4f1a\u4f7f\u9ed1\u767d\u70b9\u7684\u6570\u5b57\u5404\u52a0\u4e00\uff0c\u800c\u6211\u4eec\u7684\u76ee\u7684\u5c31\u662f\u8ba9\u6574\u5f20\u56fe\u7684\u9ed1\u767d\u70b9\u90fd\u662f\u540c\u4e00\u4e2a\u6570\u5b57\u3002\n\n\u8bbe\u8fd9\u4e2a\u6570\u5b57\u662f $x$\uff0c\u9ed1\u70b9\u6709 $num_0$ \u4e2a\uff0c\u672a\u64cd\u4f5c\u524d\u7684\u6570\u5b57\u603b\u548c\u662f $sum_0$\uff0c\u767d\u70b9\u6709 $num_1$ \u4e2a\uff0c\u672a\u64cd\u4f5c\u524d\u7684\u6570\u5b57\u603b\u548c\u662f $sum_1$\uff0c\u56e0\u4e3a\u64cd\u4f5c\u6b21\u6570\u76f8\u7b49\u3002\n\n\u90a3\u4e48\u6709\uff1a\n\n$$num_0\\times x-sum_0=num_1\\times x-sum_1$$\n\n\u79fb\u9879\u53ef\u5f97\uff1a\n\n$$x=(sum_1-sum_0)/(num_1-num_0)$$\n\n\u4e8e\u662f\uff1a\n1. \u5f53 $num_1 \\not= num_0$ \u65f6\uff0c\u53ef\u4ee5\u89e3\u51fa $x$\uff0c\u82e5\u5b83\u662f\u4e2a\u5c0f\u6570\u5219\u65e0\u89e3\u3002\u53e6\u5916\u6211\u4eec\u8981\u64cd\u4f5c\u7684\u6b21\u6570\u4e3a $(x\\times n\\times m-sum_1-sum_0)/2$ \uff0c\u6240\u4ee5\u5982\u679c\u8fd9\u4e5f\u662f\u4e00\u4e2a\u5c0f\u6570\u4e5f\u65e0\u89e3\uff0c\u63a5\u7740\u6211\u4eec\u7528\u7f51\u7edc\u6d41check\u4e00\u4e0b $x$\uff0c\u5f97\u51fa\u5b83\u80fd\u64cd\u4f5c\u591a\u5c11\u6b21\uff0c\u548c\u4e0a\u9762\u7b97\u7684\u4e00\u6837\u5c31\u6709\u89e3\uff0c\u5426\u5219\u65e0\u89e3\u3002\n\n2. $num_1=num_0$ \u663e\u7136\u8fd9\u8bf4\u660e $n,m$ \u4e2d\u81f3\u5c11\u4e00\u4e2a\u662f\u5076\u6570\uff0c\u64cd\u4f5c\u6b21\u6570\u8fd8\u662f $(x\\times n\\times m-sum_1-sum_0)/2$\uff0c\u524d\u4e00\u9879\u662f\u5076\u6570\uff0c\u540e\u4e24\u9879\u7b97\u4e00\u4e0b\u5982\u679c\u662f\u5947\u6570\uff0c\u90a3\u4e48\u7b97\u51fa\u6b21\u6570\u4e00\u5b9a\u662f\u5c0f\u6570\uff0c\u4e5f\u65e0\u89e3\uff0c\u5426\u5219\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u5355\u8c03\u6027\u4e8c\u5206\u51fa\u5408\u9002\u7684 $x$ \uff0c\u5229\u7528\u7f51\u7edc\u6d41\u5f97\u51fa\u7b54\u6848\uff0c\u5176\u4e2d\uff0c\u4e8c\u5206\u4e0b\u754c\u662f\u6240\u6709\u683c\u5b50\u6570\u5b57\u7684\u6700\u5927\u503c\uff0c\u56e0\u4e3a\u683c\u5b50\u7684\u6570\u5b57\u53ea\u80fd\u589e\u4e0d\u80fd\u964d\uff0c\u4e0d\u80fd\u8ba9\u6700\u5927\u7684\u6570\u5b57\u964d\u56de\u53bb\u3002\u800c\u4e0a\u754c\u53ef\u4ee5\u8bbe\u6210\u4e00\u4e2a\u8f83\u5927\u7684\u503c\uff0c\u8fd9\u91cc\u8bbe\u7684\u662f1e14\u3002\n\n\u5355\u8c03\u6027\u8bc1\u660e\uff1a\n\u56e0\u4e3a $num_1=num_0$\uff0c \u5219\n$$(num_1+num_0)\\bmod 2=0$$\n\n\u5373\u53ef\u4ee5\u6784\u9020\u4e00\u5c42\u6b63\u597d\u7684\u6ee1\u8986\u76d6\u3002\u4e5f\u5c31\u662f\u5728\u6b63\u786e\u7b54\u6848\u540e\u591a\u94fa\u4e86\u51e0\u5c42\u3002\u6240\u4ee5\u5177\u6709\u5355\u8c03\u6027\u3002\n\n\u5bf9\u4e8e\u7f51\u7edc\u6d41\u5efa\u56fe\uff1a\n\n\u6211\u4eec\u5bf9\u4e8e\u8d77\u59cb\u70b9 $S$ \u5411\u6bcf\u4e2a\u9ed1\u70b9\u8fde\u8fb9\uff0c\u6743\u503c\u662f\u5b83\u589e\u52a0\u5230 $x$ \u9700\u8981\u591a\u5c11\u6b21\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u9ed1\u70b9\u5411\u76f8\u90bb\u767d\u70b9\u8fde\u8fb9\uff0c\u6743\u503c\u662f $inf$\uff0c\u767d\u70b9\u5411\u6c47\u70b9 $T$ \u8fde\u8fb9\uff0c\u6743\u503c\u662f\u5b83\u589e\u52a0\u5230 $x$ \u9700\u6837\u8dd1\u51fa\u6765\u7684\u6700\u5927\u6d41\u5c31\u662f\u6211\u4eec\u6700\u591a\u80fd\u64cd\u4f5c\u591a\u5c11\u6b21\uff0c\u548c\u5bf9\u5e94\u7684\u4e8c\u5206\u7b54\u6848\u6bd4\u8f83\u5373\u53ef\u3002\n\n\u5728\u8fd9\u91cc\u6211\u7528\u7684\u662f $Dinic$ \u7b97\u6cd5\uff0c\u5728\u4e8c\u5206\u56fe\u60c5\u51b5\u4e0b\u590d\u6742\u5ea6\u662f $O(n^{0.5}m)$ \uff0c\u6240\u4ee5\u5728\u6b64\u9898\u4e0b\u7ef0\u7ef0\u6709\u4f59\u3002\n\n\u4e8e\u662f\u672c\u9898\u5c31\u6109\u5feb\u7684\u505a\u5b8c\u4e86\uff5e\n\n## Code\n```cpp\n#include<cstring>\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\nnamespace EMT{\n\ttypedef long long ll;typedef double db;//(double)clock() / (double)CLOCKS_PER_SEC;\n\t#define int long long\n\t#define pf printf\n\t#define F(i,a,b) for(register int i=a;i<=b;i++)\n\t#define D(i,a,b) for(register int i=a;i>=b;i--)\n\tinline int read(){int x=0,f=1;char ch=getchar();while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}while(ch>='0'&&ch<='9')x=x*10+ch-'0',ch=getchar();return x*f;}\n\tinline void file(){freopen(\"in.in\",\"r\",stdin);freopen(\"my.out\",\"w\",stdout);}\n\tinline int max(int a,int b){return a>b?a:b;}inline int min(int a,int b){return a<b?a:b;}\n\tinline void pi(int x){pf(\"%lld \",x);}inline void pn(){pf(\"\\n\");}\n\tconst int N=1650;struct dp{int num,sum;}p[2];const int inf1=1e18,inf2=1e14;\n\tint head[N],dis[N],co,Hd[N],n,pos[45][45],q[N],hd,tot,tl,cnt,m,S,T,a[45][45],b[45][45];struct node{int next,to,w;}e[N*10];\n\tinline void add(int next,int to,int w){e[++co].next=head[next],e[co].to=to,e[co].w=w,head[next]=co;}\n\tinline bool bfs(){\n\t\tmemcpy(head,Hd,sizeof(Hd));\n\t\tmemset(dis,0x3f,sizeof(dis));\n\t\tq[hd=tl=1]=S;dis[S]=0;\n\t\twhile(hd<=tl){\n\t\t\tint x=q[hd++];\n\t\t\tfor(register int i=head[x];i;i=e[i].next)if(e[i].w){\n\t\t\t\tif(dis[e[i].to]>dis[x]+1){\n\t\t\t\t\tdis[e[i].to]=dis[x]+1;\n\t\t\t\t\tq[++tl]=e[i].to;\n\t\t\t\t}\n\t\t\t}if(x==T)return 1;\n\t\t}return 0;\n\t}\n\tinline int dfs(int x,int in){\n\t\tif(x==T)return in;\n\t\tint rest=in,go;\n\t\tfor(register int i=head[x];i;head[x]=i=e[i].next)if(e[i].w){\n\t\t\tif(dis[e[i].to]==dis[x]+1){\n\t\t\t\tgo=dfs(e[i].to,min(e[i].w,rest));\n\t\t\t\tif(go)e[i].w-=go,e[i^1].w+=go,rest-=go;\n\t\t\t\telse dis[e[i].to]=0;\n\t\t\t}if(!rest)break;\n\t\t}return in-rest;\n\t}\n\tinline int check(int x){\n\t\tint ans=0;co=1;\n\t\tmemset(head,0,sizeof(head));tot=x*n*m-p[0].sum-p[1].sum;\n\t\tF(i,1,n)\n\t\t\tF(j,1,m)\n\t\t\tif(b[i][j]){\n\t\t\t\tif(j+1<=m)add(pos[i][j],pos[i][j+1],inf1),add(pos[i][j+1],pos[i][j],0);\n\t\t\t\tif(j-1>=1)add(pos[i][j],pos[i][j-1],inf1),add(pos[i][j-1],pos[i][j],0);\n\t\t\t\tif(i-1>=1)add(pos[i][j],pos[i-1][j],inf1),add(pos[i-1][j],pos[i][j],0);\n\t\t\t\tif(i+1<=n)add(pos[i][j],pos[i+1][j],inf1),add(pos[i+1][j],pos[i][j],0);\n\t\t\t\tadd(S,pos[i][j],x-a[i][j]);add(pos[i][j],S,0);\n\t\t\t}else add(pos[i][j],T,x-a[i][j]),add(T,pos[i][j],0);\n\t\tmemcpy(Hd,head,sizeof(head));\n\t\twhile(bfs())ans+=dfs(S,inf1);\n\t\tif(ans>=tot/2)return ans;else return 0;\n\t}\n\tinline short main(){\n\t\tint TT=read();\n\t\twhile(TT--){\n\t\t\tcnt=0;n=read(),m=read();S=++cnt;T=++cnt;int maxn=0;\n\t\t\tp[0].num=p[0].sum=p[1].num=p[1].sum=0;\n\t\t\tF(i,1,n)\n\t\t\t\tF(j,1,m){\n\t\t\t\t\tif(j==1)b[i][j]=b[i-1][j]^1;else b[i][j]=b[i][j-1]^1;\n\t\t\t\t\tp[b[i][j]].num++;pos[i][j]=++cnt;\n\t\t\t\t\ta[i][j]=read();p[b[i][j]].sum+=a[i][j];\n\t\t\t\t\tmaxn=max(maxn,a[i][j]);\n\t\t\t\t}\n\t\t\tif(p[1].num!=p[0].num){\n\t\t\t\tif((p[1].sum-p[0].sum)%(p[1].num-p[0].num)!=0){pi(-1);pn();}\n\t\t\t\tint tt=(p[1].sum-p[0].sum)/(p[1].num-p[0].num);\n\t\t\t\tint x;\n\t\t\t\tif(tt!=(int)tt){pi(-1);pn();continue;}else x=tt;\n\t\t\t\tif((x*n*m-p[1].sum-p[0].sum)&1||x*n*m<p[1].sum+p[0].sum){pi(-1);pn();continue;}\n\t\t\t\tif(!check(x)){pi(-1);pn();}\n\t\t\t\telse{pi(check(x));pn();}\n\t\t\t}else{\n\t\t\t\tint l=maxn,r=inf2,ans=inf2;\n\t\t\t\tif((p[0].sum+p[1].sum)&1){pi(-1);continue;}\n\t\t\t\twhile(l<=r){\n\t\t\t\t\tint mid=(l+r)>>1;\n\t\t\t\t\tint t=check(mid);\n\t\t\t\t\tif(t)r=mid-1,ans=t;\n\t\t\t\t\telse l=mid+1;\n\t\t\t\t}\n\t\t\t\tif(ans==inf2){pi(-1);pn();continue;}\n\t\t\t\telse pi(ans),pn();\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n}\nsigned main(){return EMT::main();}\n```",
        "postTime": 1627788727,
        "uid": 451066,
        "name": "letitdown",
        "ccfLevel": 9,
        "title": "P5038 \u5947\u602a\u7684\u6e38\u620f"
    }
]