[
    {
        "content": "19 \u5e74\u5c31\u5bf9\u7740\u81ea\u5df1\u7684\u8f93\u5165\u6cd5\u51fa\u51fa\u6765\u7684\u4e00\u9053\u9898\uff0c\u5f53\u521d\u89c9\u5f97\u597d\u96be\uff0c\u8981 n \u91cd\u6570\u636e\u7ed3\u6784\uff0c\u73b0\u5728\u770b\u8d77\u6765\u3002\u3002\u3002\u3002\u3002\u3002  \n\u8fd8\u662f\u5148\u6765\u770b\u90e8\u5206\u5206\u5427\u3002  \n### 10pts  \n\u5efa\u4e00\u68f5 Trie\uff0c\u66b4\u529b\u7ef4\u62a4\u5b50\u6811\u6700\u5927\u503c\uff0c\u6216\u8005\u5e72\u8106 Trie \u90fd\u4e0d\u5efa\u76f4\u63a5\u67e5\u3002  \n### 20pts  \n\u5efa\u4e00\u68f5 Trie\uff0c\u66b4\u529b\u5c06\u5176\u503c\u6392\u5e8f\uff0c\u7136\u540e\u66f4\u65b0\u7b54\u6848\u3002  \n### 30pts  \n\u53d1\u73b0\u6700\u5927\u503c\u53ea\u589e\u4e0d\u51cf\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a Trie \u7684\u8282\u70b9\u4e0a\u53ea\u7528\u8bb0\u5f55\u6700\u5927\u503c\u548c\u90a3\u4e2a\u5b57\u7b26\u4e32\uff0c\u6bcf\u6b21\u5b50\u6811\u5185\u6709\u4e1c\u897f\u53d1\u751f\u66f4\u65b0\u5c31\u6765\u66f4\u65b0\u4e00\u4e0b\u81ea\u5df1\u7684\u6700\u5927\u503c\uff0c\u7531\u4e8e Trie \u5c42\u6570\u5c0f\u4e8e\u7b49\u4e8e10\uff0c\u6240\u4ee5\u590d\u6742\u5ea6 $O(n)$\uff0c\u662f\u6b63\u786e\u7684\u3002  \n### 50~95 pts  \n\u9632\u6b62\u5e38\u6570\u8fc7\u5927\u8005\u53d8\u6210\u66b4\u529b\u5206\u3002  \n## 100pts  \n\u8003\u8651\u6b63\u89e3\u3002\u80af\u5b9a\u8981\u628a\u5b57\u7b26\u4e32\u96c6\u5408\u5efa\u6210\u4e00\u68f5 Trie\u3002\u5b83\u7684\u540e\u7f00\u5c31\u76f8\u5f53\u4e8e Trie \u8282\u70b9\u7684\u5b50\u6811\u3002\u9996\u5148\uff0c\u6211\u4eec\u5728\u6bcf\u4e00\u4e2a Trie \u8282\u70b9\u5f00\u4e00\u68f5\u5e73\u8861\u6811\u5b58\u5165\u5b50\u6811\u5185\u7684\u503c\u548c\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837\u5c31\u5f88\u65b9\u4fbf\u7684\u7ef4\u62a4\u5b50\u6811 kth\u3002  \n\u6bcf\u4e00\u6b21\uff0c\u6211\u4eec\u627e\u5230\u4e86\u4e00\u4e2a\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff0c\u5c31\u53bb\u6240\u6709\u5b83\u7684\u524d\u7f00\u53bb\u66f4\u65b0\u5b83\u7684\u503c\uff0c\u4ee5\u4fbf\u4e0b\u4e00\u6b21\u66f4\u65b0\u3002  \n\u5982\u679c Trie \u8282\u70b9\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u8f93\u51fa `404Error`\u3002  \n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nlogn)$\u3002  \n\u4ee3\u7801\u5982\u4e0b\uff0c\u5199\u7684\u662f\u6807\u51c6 Trie \u5957 Splay\uff0c\u6709\u4ebf\u70b9\u70b9\u957f\u3002  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=5e5+5;\nint n,m;\nstruct splaytree {\n\tint news,cnt;\n\tsplaytree() {\n\t\tcnt=0;\n\t}\n\tstruct tree {\n\t\tint sum,f,siz,ch[2];\n\t\tstring s;\n\t} t[maxn*10];\n\tvoid pushup(int x) {\n\t\tt[x].siz=t[t[x].ch[0]].siz+t[t[x].ch[1]].siz+1;\n\t\treturn;\n\t}\n\tvoid rotate(int x,int &rot) {\n\t\tint y=t[x].f,z=t[y].f,L=(t[y].ch[0]!=x),R=L^1;\n\t\tif(y==rot) {\n\t\t\trot=x;\n\t\t} else {\n\t\t\tt[z].ch[t[z].ch[0]!=y]=x;\n\t\t}\n\t\tt[x].f=z;\n\t\tt[y].f=x;\n\t\tt[t[x].ch[R]].f=y;\n\t\tt[y].ch[L]=t[x].ch[R];\n\t\tt[x].ch[R]=y;\n\t\tpushup(y);\n\t\tpushup(x);\n\t}\n\tvoid splay(int x,int &rot) {\n\t\twhile(x!=rot) {\n\t\t\tint y=t[x].f,z=t[y].f;\n\t\t\tif(y!=rot) {\n\t\t\t\tif(t[y].ch[0]==x^t[z].ch[0]==y) {\n\t\t\t\t\trotate(x,rot);\n\t\t\t\t} else {\n\t\t\t\t\trotate(y,rot);\n\t\t\t\t}\n\t\t\t}\n\t\t\trotate(x,rot);\n\t\t}\n\t}\n\tvoid insert(int rot,int x,string s) {\n\t\tif((t[rot].sum<x||(t[rot].sum==x&&t[rot].s>s))&&t[rot].ch[0]) {\n\t\t\tinsert(t[rot].ch[0],x,s);\n\t\t} else if((t[rot].sum>x||(t[rot].sum==x&&t[rot].s<s))&&t[rot].ch[1]) {\n\t\t\tinsert(t[rot].ch[1],x,s);\n\t\t} else {\n\t\t\tt[rot].ch[t[rot].sum>x|(t[rot].sum==x&t[rot].s<s)]=++cnt;//\u6ce8\u610f\u8fd9\u91cc\u503c\u662f\u4ece\u5927\u5230\u5c0f\u6392\uff0c\u7b26\u53f7\u4e0d\u8981\u5199\u53cd\uff0c\u5148\u540e\u987a\u5e8f\u4e0d\u8981\u5f04\u9519\n\t\t\tt[cnt].f=rot;\n\t\t\tt[cnt].siz=1;\n\t\t\tt[cnt].sum=x;\n\t\t\tt[cnt].s=s;\n\t\t\tnews=cnt;\n\t\t}\n\t\tpushup(rot);\n\t}\n\tint getfront(int rot) {\n\t\tint x=t[rot].ch[0];\n\t\twhile(t[x].ch[1]) {\n\t\t\tx=t[x].ch[1];\n\t\t}\n\t\treturn x;\n\t}\n\tint getback(int rot) {\n\t\tint x=t[rot].ch[1];\n\t\twhile(t[x].ch[0]) {\n\t\t\tx=t[x].ch[0];\n\t\t}\n\t\treturn x;\n\t}\n\tvoid del(int &root,int rot,int x,string s) {\n\t\tif((t[rot].sum<x||(t[rot].sum==x&&t[rot].s>s))&&t[rot].ch[0]) {\n\t\t\tdel(root,t[rot].ch[0],x,s);\n\t\t} else if((t[rot].sum>x||(t[rot].sum==x&&t[rot].s<s))&&t[rot].ch[1]) {\n\t\t\tdel(root,t[rot].ch[1],x,s);//\u5220\u9664\u7684\u65f6\u5019\u4e5f\u4e00\u6837\n\t\t} else {\n\t\t\tsplay(rot,root);\n\t\t\tint he=getfront(root),ta=getback(root);\n\t\t\tsplay(he,root);\n\t\t\tsplay(ta,t[he].ch[1]);\n\t\t\tt[rot].f=t[rot].siz=t[rot].sum=t[ta].ch[0]=0;\n\t\t\tt[rot].s=\"\";\n\t\t\tpushup(ta);\n\t\t\tpushup(he);\n\t\t}\n\t\tpushup(rot);\n\t}\n\tint findx(int &rot,int x,string s) {\n\t\tif(!rot)return 0;\n\t\tint u=rot;\n\t\twhile(t[u].ch[t[u].sum>x|(t[u].sum==x&t[u].s<s)]&&t[u].sum!=x&&t[u].s!=s) {\n\t\t\tu=t[u].ch[t[u].sum>x|(t[u].sum==x&t[u].s<s)];//\u8fd9\u91cc\u53ef\u80fd\u6709\u70b9\u4e11\uff0c\u610f\u4e49\u662f\u4ece\u6839\u627e\u5230\u5b83\u90a3\u4e00\u68f5\u5b50\u6811\n\t\t}\n\t\tsplay(u,rot);\n\t\treturn t[t[rot].ch[0]].siz-1;\n\t}\n\tint findk(int rot,int k) {\n\t\tint lsiz=t[t[rot].ch[0]].siz;\n\t\tif(!rot)return 0;\n\t\tif(lsiz==k-1) {\n\t\t\treturn rot;\n\t\t} else if(lsiz>=k) {\n\t\t\treturn findk(t[rot].ch[0],k);\n\t\t} else {\n\t\t\treturn findk(t[rot].ch[1],k-lsiz-1);\n\t\t}\n\t}\n\tvoid tab(int &root) {\n\t\troot=++cnt;\n\t\tcnt++;//\u8fd9\u91cc\u5982\u679c\u5199t[++cnt].f=cnt-1;\u4f1a\u6709UB\n\t\tt[cnt].f=cnt-1;\n\t\tt[cnt-1].ch[0]=cnt;\n\t\tt[cnt].sum=INT_MAX;\n\t\tt[cnt-1].sum=INT_MIN+1;//\u521d\u59cb\u5316\u65f6\u503c\u7684\u987a\u5e8f\u4e0d\u8981\u5f04\u53cd\n\t\tt[cnt].siz=1;\n\t\tt[cnt-1].siz=2;\n\t\tt[cnt].s=\"\";\n\t}\n} Splay;\nstruct Trietree {\n\tint t[maxn*3][26],cnt,rt[maxn*3];\n\tTrietree() {\n\t\tcnt=0;\n\t}\n\tvoid insert(string s) {\n\t\tint root=0,y;\n\t\tfor(register int i=0; i<s.length(); i++) {\n\t\t\ty=s[i]-'a';\n\t\t\tif(!t[root][y]) {\n\t\t\t\tt[root][y]=++cnt;\n\t\t\t\tSplay.tab(rt[cnt]);\n\t\t\t}\n\t\t\troot=t[root][y];\n\t\t\tSplay.insert(rt[root],0,s);\n\t\t}\n\t}\n\tstring ask(string s,int k) {\n\t\tint root=0,y;\n\t\tfor(register int i=0; i<s.length(); i++) {\n\t\t\ty=s[i]-'a';\n\t\t\tif(!t[root][y]) {\n\t\t\t\treturn \"404Error\";\n\t\t\t}\n\t\t\troot=t[root][y];\n\t\t}\n\t\tk=min(k,Splay.t[rt[root]].siz-2);//\u5904\u7406\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u5148\u53d6\u4e00\u4e2amin\uff0c\u6ce8\u610f\u662fsiz-2\n\t\tint w=Splay.findk(rt[root],k+1),p=Splay.t[w].sum+1;\n\t\tstring astr=Splay.t[w].s;//astr\u548cp\u662f\u627e\u5230\u7684\u5b57\u7b26\u4e32\u7684\u503c\n\t\troot=0;\n\t\tfor(register int i=0; i<astr.length(); i++) {\n\t\t\ty=astr[i]-'a';\n\t\t\troot=t[root][y];\n\t\t\tSplay.del(rt[root],rt[root],p-1,astr);//\u6ce8\u610f\u5220\u9664\u662f\u5220\u503c\u4e3ap-1\n\t\t\tSplay.insert(rt[root],p,astr);\n\t\t\tSplay.splay(Splay.news,rt[root]);\n\t\t}\n\t\treturn astr;\n\t}\n} Trie;\nchar str[10];\nint main() {\n\tint x;\n\tstring s1;\n\tscanf(\"%d\",&n);\n\tfor(register int i=1; i<=n; i++) {\n\t\tscanf(\"%s\",str);\n\t\ts1=str;\n\t\tTrie.insert(s1);\n\t}\n\tscanf(\"%d\",&m);\n\tfor(register int i=1; i<=m; i++) {\n\t\tscanf(\"%s%d\",str,&x);\n\t\ts1=str;\n\t\tcout<<Trie.ask(s1,x);\n\t}\n\treturn 0;\n}\n```  \n\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7 DFS \u5e8f\u628a Trie \u62cd\u6241\uff0c\u7136\u540e\u5728 dfn \u5e8f\u4e0a\u67e5\u8be2\u533a\u95f4\u7b2c $k$ \u5927\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nlog^2n)\\sim O(nlog^3n)$\u3002",
        "postTime": 1609159725,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--\u7b80\u6613\u8f93\u5165\u6cd5"
    },
    {
        "content": "\u8865\u4e00\u53d1\u6811\u5957\u6811\u7684\u505a\u6cd5\u3002\n\n\u4e8b\u5148\u5c06\u4e32\u6254 trie \u6811\u4e0a\u540e\u5f97\u5230 dfn \u5e8f\uff08\u5373\u5b57\u5178\u5e8f\uff09\uff0c\u7136\u540e\u6bcf\u6b21\u8be2\u95ee\u627e\u5230\u5176\u5bf9\u5e94\u8282\u70b9\u540e\u5c31\u53ef\u77e5\u9053\u5b83\u6240\u5bf9\u5e94\u7684\u533a\u95f4\u3002\u7136\u540e\u5c31\u76f8\u5f53\u4e8e\u6309dfn\u5e8f\u6392\u5e8f\u540e\u5728\u4e00\u4e2a\u533a\u95f4\u7684\u5b57\u7b26\u4e32\u91cc\u627e\u7b2c k \u5927\uff0c\u6240\u4ee5\u4f7f\u7528\u6811\u5957\u6811\uff0c\u5916\u5c42\u7528\u6811\u72b6\u6570\u7ec4\uff0c\u5185\u5c42\u7528\u4ee5\u8f93\u51fa\u6b21\u6570\u4e3a\u4e0b\u6807\u7684\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u5728\u4e0a\u9762\u4e8c\u5206\u5373\u53ef\uff0c\u4e0d\u8fc7\u6bcf\u4e2a\u8282\u70b9\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a\u503c\uff0c\u6240\u4ee5\u53f6\u5b50\u8282\u70b9\u8981\u4f7f\u7528\u5e73\u8861\u6811\u5bfb\u627e dfn \u5e8f\u7b2ck\u5927\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <map>\n#include <algorithm>\n#include <cstring>\n#include <set>\n#include <ext/pb_ds/assoc_container.hpp>\n#include <ext/pb_ds/tree_policy.hpp>\nusing namespace std;\nusing namespace __gnu_pbds;\nconst int N = 5e5 + 10;\ntree <int,null_type,less<int>,rb_tree_tag,tree_order_statistics_node_update> se[N];\nint n, m;\nint tot[N << 1], num, zong;\nint a[N];\nchar op[N][3];\nint que[N][4];\nstruct t\n{\n\tint son[2], val;\n}tr[N * 160];\nint mins[N], dy[N];\nint bit[N];\nvoid opt1(int &o, int l, int r, int i, int w)\n{\n\tif(o == 0)o = ++ num;\n\ttr[o].val += w;\n\tif(l == r)\n\treturn;\n\tint mid = (l + r) >> 1;\n\tif(mid >= i) opt1(tr[o].son[0], l, mid, i, w);\n\telse opt1(tr[o].son[1], mid + 1, r, i, w);\n}\nvoid add(int o, int val)\n{\n\tint pos = a[dy[o]];\n\tfor (; o <= n; o += o & -o)opt1(bit[o], 1, m + 1, pos, val);\n}\nint to1[20], to2[20], num1, num2;\nint bb[20];\nint opt2(int l, int r, int k, int gu)\n{\n\tif(l == r)\n\t{\n\t\tint re = 0;\n\t\tfor (int i = 1; i <= num1; ++ i)\n\t\tre += tr[to1[i]].val;\n\t\treturn *se[l].find_by_order(k - 1 + re);\n\t}\n\tint now = 0;\n\tfor (int i = 1; i <= num2; ++ i)\n\tnow += tr[tr[to2[i]].son[0]].val;\n\tfor (int i = 1; i <= num1; ++ i)\n\tnow -= tr[tr[to1[i]].son[0]].val;\n\tint mid = (l + r) >> 1;\n\tif(now >= k)\n\t{\n\t\tfor (int i = 1; i <= num1; ++ i)\n\t\tto1[i] = tr[to1[i]].son[0];\n\t\tfor (int i = 1; i <= num2; ++ i)\n\t\tto2[i] = tr[to2[i]].son[0];\n\t\treturn opt2(l, mid, k, gu);\n\t}\n\telse\n\t{\n\t\tfor (int i = 1; i <= num1; ++ i)\n\t\tto1[i] = tr[to1[i]].son[1];\n\t\tfor (int i = 1; i <= num2; ++ i)\n\t\tto2[i] = tr[to2[i]].son[1];\n\t\treturn opt2(mid + 1, r, k - now, gu);\n\t}\n}\nint qu(int l, int r, int k)\n{\n\tnum1 = num2 = 0;\n\tmemset(to1, 0, sizeof(to1));\n\tmemset(to2, 0, sizeof(to2));\n\tmemset(bb, 0, sizeof(bb));\n\tfor(int i = l - 1; i; i -= i & -i)to1[++ num1] = bit[i];\n\tfor(int i = r; i; i -= i & -i)to2[++ num2] = bit[i];\n\tmemcpy(bb, to1, sizeof(bb));\n\treturn opt2(1, m + 1, k, l - 1);\n}\nint ch[N * 10][30], siz[N * 10];\nint dfn[N * 10], ids[N * 10];\nchar s[N][12];\nvoid ins(int now)\n{\n\tint o = 0;\n\t++ siz[o];\n\tfor (int i = 0; i < strlen(s[now]); ++ i)\n\t{\n\t\tif(ch[o][s[now][i] - 'a'] == 0)\n\t\tch[o][s[now][i] - 'a'] = ++ num;\n\t\to = ch[o][s[now][i] - 'a'];\n\t\t++ siz[o];\n\t}\n\tids[o] = now;\n}\nvoid dfs(int o)\n{\n\tmins[o] = 1e9;\n\tfor (int i = 25; i >= 0; -- i)\n\tif(ch[o][i])\n\tdfs(ch[o][i]), mins[o] = min(mins[o], mins[ch[o][i]]);\n\tif(ids[o])\n\tdfn[ids[o]] = ++ num, dy[num] = ids[o], mins[o] = min(mins[o], num);\n}\nchar f[12];\nint find()\n{\n\tint o = 0;\n\tfor (int i = 0; i < strlen(f); ++ i)\n\t{\n\t\tif(ch[o][f[i] - 'a'] == 0)\n\t\treturn -1;\n\t\to = ch[o][f[i] - 'a'];\n\t}\n\treturn o;\n}\nint main()\n{\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\tscanf(\"%s\", s[i]);\n\t\tins(i);\n\t}\n\tnum = 0;\n\tdfs(0);\n\tscanf(\"%d\", &m);\n\tnum = 0;\n\tfor (int i = 1; i <= n; ++ i)\n\t{\n\t\ta[i] = 1;\n\t\tadd(i, 1);\n\t\tse[a[i]].insert(i);\n\t}\n\tfor (int i = 1; i <= m; ++ i)\n\t{\n\t\tint k;\n\t\tscanf(\"%s%d\", f, &k);\n\t\tint now = find();\n\t\tif(now <= 0)\n\t\tprintf(\"404Error\\n\");\n\t\telse\n\t\t{\n\t\t\tif(k > siz[now])\n\t\t\tk = siz[now];\n\t\t\tk = siz[now] - k + 1;\n\t\t\tint pos = qu(mins[now], mins[now] + siz[now] - 1, k);\n\t\t\tif(pos < 0 || pos > n)\n\t\t\t{\n\t\t\t\tprintf(\"404Error\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tprintf(\"%s\\n\", s[dy[pos]]);\n\t\t\tadd(pos, -1);\n\t\t\tse[a[dy[pos]]].erase(pos);\n\t\t\t++ a[dy[pos]];\n\t\t\tse[a[dy[pos]]].insert(pos);\n\t\t\tadd(pos, 1);\n\t\t}\n\t}\n}\n```\n",
        "postTime": 1617269965,
        "uid": 111728,
        "name": "\u5e7b\u5f71\u661f\u575a\u5f3a",
        "ccfLevel": 7,
        "title": "P7475"
    },
    {
        "content": "## Preface\n\n\u5e73\u8861\u6811\u662f\u4e0d\u53ef\u80fd\u624b\u6253\u7684\uff0c\u7edd\u5bf9\u4e0d\u53ef\u80fd\u7684\u3002\uff08\n\n\u5b57\u5178\u6811\u5957\u5e73\u8861\u6811\u3002~~\u5947\u602a\u7684\u6811\u5957\u6811\u589e\u52a0\u4e86\uff01~~\n\n## Solution\n\n\u5bf9\u4e8e\u591a\u7ec4\u6a21\u5f0f\u4e32\u524d\u7f00\u76f8\u5173\u7684\u95ee\u9898\uff0c\u7b2c\u4e00\u65f6\u95f4\u60f3\u5230\u5b57\u5178\u6811\u3002\n\n\u63d2\u5165\u65f6\u4e0e\u666e\u901a\u5b57\u5178\u6811\u76f8\u540c\u3002\n\n\u8be2\u95ee\u8981\u6c42**\u52a8\u6001**\u7ef4\u62a4\u6240\u6709**\u6587\u672c\u4e32\u662f\u8be5\u4e32\u524d\u7f00**\u7684\u6a21\u5f0f\u4e32\u4e2d**\u4f9d\u6b21\u6309\u51fa\u73b0\u6b21\u6570\u3001\u5b57\u5178\u5e8f**\u6392\u5e8f\u540e\u4f4d\u4e8e\u7b2c $k$ \u4f4d\u7684\u6570\u3002\n\n\u5b57\u5178\u5e8f\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5b57\u5178\u6811\u4e0a\u7684 dfs \u5e8f\uff0c\u8fd9\u6837\u80fd\u591f\u907f\u514d\u5927\u91cf\u7684\u5b57\u7b26\u4e32\u6bd4\u8f83\u3002\n\n\u5e73\u8861\u6811\u663e\u7136\u53ef\u4ee5\u7ef4\u62a4\u67e5\u8be2\uff08\u5373\u67e5\u627e\u6392\u540d\u4e3a $k$ \u7684\u5b57\u7b26\u4e32\uff09\u3002\u4f46\u5e73\u8861\u6811\u7801\u91cf\u592a\u5927\u4e0d\u60f3\u5199\uff0c\u600e\u4e48\u529e\uff1f\n\n- Method 1\n\n\u4f7f\u7528 set\u3002~~\u65f6\u95f4\u590d\u6742\u5ea6\u4f3c\u4e4e\u4e0d\u592a\u6b63\u786e\u2026\u2026~~\n\n\u7406\u8bba\u6700\u574f\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nq\\log n)$ \uff0c\u4f46\u6570\u636e\u8fc7\u6c34\uff0c\u7a0d\u52a0\u5361\u5e38\u53ef\u4ee5\u901a\u8fc7\u3002\n\n```cpp\n//Author: Cxny\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define fi first\n#define se second\nconst int maxn = 5e4 + 10, maxm = 1e5 + 10, maxl = 5e5 + 10;\nint n, m, son[maxl][26], cnt = 0, ind[maxl], dfn[maxl], res[maxm], tot = 0, used[maxm];\nset<pair<int, pair<int, int>>> t[maxl];\nvoid insert(string s, int x){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tif(!son[u][s[i] - 'a']) son[u][s[i] - 'a'] = ++cnt;\n\t\tu = son[u][s[i] - 'a'];\n\t}\n\tind[u] = x;\n}\nint query(string s){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tif(!son[u][s[i] - 'a']) return -1;\n\t\tu = son[u][s[i] - 'a'];\n\t}\n\treturn u;\n}\nvoid dfs(int u){\n\tdfn[u] = ++tot;\n\tif(ind[u]) res[ind[u]] = tot;\n\tfor(int i = 0; i < 26; i++) if(son[u][i]) dfs(son[u][i]);\n}\nvoid build(string s, int x){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tu = son[u][s[i] - 'a'];\n\t\tt[u].insert({0, {res[x], x}});\n\t}\n}\nvoid modify(string s, int x){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tu = son[u][s[i] - 'a'];\n\t\tauto it = t[u].find({-used[x], {res[x], x}});\n\t\tt[u].erase(it), t[u].insert({-used[x] - 1, {res[x], x}});\n\t}\n}\nstring s[maxn];\nint main(){\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i <= n; i++) cin >> s[i], insert(s[i], i);\n\tdfs(0);\n\tfor(int i = 1; i <= n; i++) build(s[i], i);\n\tscanf(\"%d\", &m);\n\tfor(int i = 1; i <= m; i++){\n\t\tstring q; int k;\n\t\tcin >> q >> k;\n\t\tint pos = query(q);\n\t\tif(pos == -1) puts(\"404Error\");\n\t\telse{\n\t\t\tif(k > (int)t[pos].size()) k = t[pos].size();\n\t\t\tint x;\n\t\t\tif(k <= (int)t[pos].size() / 2){\n\t\t\t\tauto it = t[pos].begin(); \n\t\t\t\twhile(--k) it++;\n\t\t\t\tx = it->se.se;\n\t\t\t}else{\n\t\t\t\tauto it = t[pos].rbegin(); int sz = t[pos].size();\n\t\t\t\twhile(++k <= sz) it++;\n\t\t\t\tx = it->se.se;\n\t\t\t}\n\t\t\tcout << s[x] << endl;\n\t\t\tmodify(s[x], x);\n\t\t\tused[x]++;\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n- Method 2\n\n\u4f7f\u7528 pbds \u4e2d\u5b9a\u4e49\u7684\u5e73\u8861\u6811\u3002\uff08\u8003\u573a\u53ef\u7528\u3002\uff09\n```cpp\n//Author: Cxny\n#include<bits/stdc++.h>\n#include<bits/extc++.h>\nusing namespace std;\nusing namespace __gnu_pbds;\n#define ll long long\n#define fi first\n#define se second\nconst int maxn = 5e4 + 10, maxm = 1e5 + 10, maxl = 5e5 + 10;\nint n, m, son[maxl][26], cnt = 0, ind[maxl], dfn[maxl], res[maxm], sz[maxl], tot = 0, used[maxm];\ntree<pair<int, pair<int, int>>, null_type, less<pair<int, pair<int, int>>>, rb_tree_tag, tree_order_statistics_node_update> t[maxl];\nvoid insert(string s, int x){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tif(!son[u][s[i] - 'a']) son[u][s[i] - 'a'] = ++cnt;\n\t\tu = son[u][s[i] - 'a'];\n\t}\n\tind[u] = x;\n}\nint query(string s){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tif(!son[u][s[i] - 'a']) return -1;\n\t\tu = son[u][s[i] - 'a'];\n\t}\n\treturn u;\n}\nvoid dfs(int u){\n\tdfn[u] = ++tot;\n\tif(ind[u]) res[ind[u]] = tot;\n\tfor(int i = 0; i < 26; i++) if(son[u][i]) dfs(son[u][i]);\n}\nvoid build(string s, int x){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tu = son[u][s[i] - 'a'], sz[u]++;\n\t\tt[u].insert({0, {res[x], x}});\n\t}\n}\nvoid modify(string s, int x){\n\tint u = 0;\n\tfor(int i = 0; s[i]; i++){\n\t\tu = son[u][s[i] - 'a'];\n\t\tauto it = t[u].lower_bound({-used[x], {res[x], x}});\n\t\tt[u].erase(it), t[u].insert({-used[x] - 1, {res[x], x}});\n\t}\n}\nstring s[maxn];\nint main(){\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i <= n; i++) cin >> s[i], insert(s[i], i);\n\tdfs(0);\n\tfor(int i = 1; i <= n; i++) build(s[i], i);\n\tscanf(\"%d\", &m);\n\tfor(int i = 1; i <= m; i++){\n\t\tstring q; int k;\n\t\tcin >> q >> k;\n\t\tint pos = query(q);\n\t\tif(pos == -1) puts(\"404Error\");\n\t\telse{\n\t\t\tif(k > sz[pos]) k = sz[pos];\n\t\t\tauto it = t[pos].find_by_order(k - 1);\n        //\u6ce8\u610f pbds \u5e73\u8861\u6811\u4e2d\u6392\u540d\u4ece 0 \u5f00\u59cb\n\t\t\tint x = it->se.se;\n\t\t\tcout << s[x] << endl;\n\t\t\tmodify(s[x], x);\n\t\t\tused[x]++;\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1660304888,
        "uid": 170890,
        "name": "Cxny",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7475 \u300cC.E.L.U-02\u300d\u7b80\u6613\u8f93\u5165\u6cd5"
    },
    {
        "content": "\u8fd9\u4e48\u597d\u7684\u9898\u7adf\u7136\u6ca1\u4eba\u5199 FHQ\uff0c\u6211\u6765\u8865\u4e0a\u3002\n\n\u524d\u7f6e\u77e5\u8bc6\uff1aTrie\uff0cFHQ_Treap\u3002\n# \u601d\u8def\n\u6211\u4eec\u77e5\u9053\uff0c\u82e5 Trie \u4e0a\u4ece\u6839\u5230 $x$ \u7684\u8def\u5f84\u8868\u793a\u5b57\u7b26\u4e32 $s$\uff0c\n\n\u5219\u4ee5 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u53ef\u4ee5\u8868\u793a\u6709\u524d\u7f00 $s$ \u7684\u5b57\u7b26\u4e32\u7684\u96c6\u5408\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6837\u4f8b 2\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/gyb0sft2.png)\n\n\u4ee5 $\\text{1u}$ \u4e3a\u6839\u7684\u5b50\u6811\u53ef\u4ee5\u8868\u793a\u6709\u524d\u7f00 $\\text u$ \u7684\u5b57\u7b26\u4e32\u7684\u96c6\u5408 $\\{\\text{usa},\\text{usaco},\\text{usssu},\\text{uva}\\}$\uff0c\n\n\u4ee5 $\\text{4s}$ \u4e3a\u6839\u7684\u5b50\u6811\u53ef\u4ee5\u8868\u793a\u6709\u524d\u7f00 $\\text{us}$ \u7684\u5b57\u7b26\u4e32\u7684\u96c6\u5408 $\\{\\text{usa},\\text{usaco},\\text{usssu}\\}$\uff0c\n\n\u4ee5 $\\text{5a}$ \u4e3a\u6839\u7684\u5b50\u6811\u53ef\u4ee5\u8868\u793a\u6709\u524d\u7f00 $\\text{usa}$ \u7684\u5b57\u7b26\u4e32\u7684\u96c6\u5408 $\\{\\text{usa},\\text{usaco}\\}$\uff0c\u5176\u4ed6\u8282\u70b9\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u6240\u4ee5\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee $s$\uff0c\u5728 Trie \u4e0a\u627e\u5230\u6709\u524d\u7f00 $s$ \u7684\u5b57\u7b26\u4e32\u7684\u96c6\u5408\uff0c\n\n\u7b54\u6848\u5373\u4e3a\u96c6\u5408\u4e2d\u4ee5\u8f93\u51fa\u6b21\u6570\u964d\u5e8f\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c\u4ee5\u5b57\u5178\u5e8f\u5347\u5e8f\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u7684\u7b2c $x$ \u5927\u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u540e\u5c06\u8f93\u51fa\u7684\u5b57\u7b26\u4e32\u51fa\u73b0\u6b21\u6570\u52a0\u4e00\uff0c\u66f4\u65b0\u6240\u6709\u5305\u542b\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u96c6\u5408\u3002\n\n\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684\u96c6\u5408\u5373\u53ef\u3002\n\n\u6709 $O(n|s|)$ \u4e2a\u96c6\u5408\uff0c\u63d2\u5165\u64cd\u4f5c\u590d\u6742\u5ea6\u4e3a $O(|s|\\log n)$\uff0c\n\n\u6240\u6709\u8be2\u95ee\u8981\u8bbf\u95ee $O(m|s|)$ \u4e2a\u96c6\u5408\uff0c\u67e5\u8be2\u4e0e\u66f4\u65b0\u590d\u6742\u5ea6\u4e3a $O(|s|\\log n)$\uff0c\n\n\u5219\u603b\u590d\u6742\u5ea6\u4e3a $O((n+m)|s|^2\\log n)$\uff0c\u53ef\u4ee5\u8fc7\u6389\u3002\n# \u4ee3\u7801\n\u6bd4\u5927\u90e8\u5206 Splay \u77ed\u4e00\u534a\uff0c\u5feb 1s\u3002\n```cpp\n#include <string>\n#include <cstdlib>\n#include <iostream>\nusing namespace std;\nint n, m, z, x;string s, q;\nstruct P\n{\n\tint x;string s;inline P operator++() {return P{x, s + '\\0'};}\n\tinline bool operator<(P p) {return x == p.x ? s < p.s : x > p.x;}\n}p;\nstruct F\n{\n\tF *l, *r;P v;int k, s;\n\tinline F(P _) : l(0), r(0), v(_), k(rand()), s(1) {}\n\tinline void p() {s = 1;if(l) s += l->s;if(r) s += r->s;}\n}*a, *b, *c;\nvoid S(F *x, P v, F *&a, F *&b)\n{\n\tif(!x) {a = b = 0;return;}\n\tif(x->v < v) a = x, S(x->r, v, a->r, b), a->p();\n\telse b = x, S(x->l, v, a, b->l), b->p();\n}\nF *M(F *a, F *b)\n{\n\tif(!a) return b;if(!b) return a;\n\tif(a->k < b->k) {a->r = M(a->r, b);a->p();return a;}\n\telse {b->l = M(a, b->l);b->p();return b;}\n}\nstruct T\n{\n\tT *d[26];F *r = 0;\n\tinline void I(P v) {S(r, v, a, b);r = M(a, M(new F(v), b));}\n\tinline void D(P v) {S(r, v, a, b);S(b, ++v, b, c);r = M(a, c);delete b;}\n\tinline P K(int k)\n\t{\n\t\ta = r;k = min(k, a->s);while(1)\n\t\t{\n\t\t\tz = a->l ? a->l->s : 0;if(k == z + 1) return a->v;\n\t\t\tif(k <= z) a = a->l;else k -= z + 1, a = a->r; \n\t\t}\n\t}\n}*r = new T(), *t;\nint main()\n{\n\tios::sync_with_stdio(0);cin.tie();cout.tie();\n\tsrand(388651);cin >> n;while(n--)\n\t{\n\t\tcin >> s;t = r;for(int i = 0;i < s.length();++i)\n\t\t\t(t = t->d[x = s[i] - 'a'] ? t->d[x] : t->d[x] = new T())->I(P{0, s});\n\t}\n\tcin >> m;while(m--)\n\t{\n\t\tcin >> s >> z;t = r;for(int i = 0;i < s.length();++i)\n\t\t\tif(!(t = t->d[s[i] - 'a'])) {cout << \"404Error\" << endl;break;}\n\t\tif(!t) continue;cout << (q = (p = t->K(z)).s) << endl;\n\t\tx = p.x;t = r;for(int i = 0;i < q.length();++i)\n\t\t\t(t = t->d[q[i] - 'a'])->D(p), t->I(P{x + 1, q});\n\t}\n\treturn 0;\n}\n```\n\u6ce8\u610f `struct  P` \u4e2d\u91cd\u8f7d `operator++` \u5904\u7406\u5220\u9664\u64cd\u4f5c\u7684\u6280\u5de7\u3002\n# \u5c0f\u4f18\u5316\n\u5b9e\u9645\u4e0a\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u5b57\u7b26\u4e32\u96c6\u5408\u4e2d\uff0c\u5b57\u7b26\u4e32\u6709\u516c\u5171\u524d\u7f00\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u516c\u5171\u524d\u7f00\u7701\u6389\uff0c\u53ea\u5b58\u6bcf\u4e2a\u5b57\u7b26\u4e32\u7684\u540e\u7f00\u3002\n\n\u4f46\u5b9e\u9645\u4f18\u5316\u6548\u679c\u5e76\u4e0d\u660e\u663e\uff08~~\u5e94\u8be5\u662f\u5199\u4e11\u4e86~~\uff09\uff0c\u7ed9\u51fa\u53c2\u8003\u4ee3\u7801\uff1a\n```cpp\n#include <string>\n#include <cstdlib>\n#include <iostream>\nusing namespace std;\nint n, m, z, x;string s, q;\nstruct P\n{\n\tint x;string s;inline P operator++() {return P{x, s + '\\0'};}\n\tinline bool operator<(P p) {return x == p.x ? s < p.s : x > p.x;}\n}p;\nstruct F\n{\n\tF *l, *r;P v;int k, s;\n\tinline F(P _) : l(0), r(0), v(_), k(rand()), s(1) {}\n\tinline void p() {s = 1;if(l) s += l->s;if(r) s += r->s;}\n}*a, *b, *c;\nvoid S(F *x, P v, F *&a, F *&b)\n{\n\tif(!x) {a = b = 0;return;}\n\tif(x->v < v) a = x, S(x->r, v, a->r, b), a->p();\n\telse b = x, S(x->l, v, a, b->l), b->p();\n}\nF *M(F *a, F *b)\n{\n\tif(!a) return b;if(!b) return a;\n\tif(a->k < b->k) {a->r = M(a->r, b);a->p();return a;}\n\telse {b->l = M(a, b->l);b->p();return b;}\n}\nstruct T\n{\n\tT *d[26];F *r = 0;\n\tinline void I(P v) {S(r, v, a, b);r = M(a, M(new F(v), b));}\n\tinline void D(P v) {S(r, v, a, b);S(b, ++v, b, c);r = M(a, c);delete b;}\n\tinline P K(int k)\n\t{\n\t\ta = r;k = min(k, a->s);while(1)\n\t\t{\n\t\t\tz = a->l ? a->l->s : 0;if(k == z + 1) return a->v;\n\t\t\tif(k <= z) a = a->l;else k -= z + 1, a = a->r; \n\t\t}\n\t}\n}*r = new T(), *t;\nint main()\n{\n\tios::sync_with_stdio(0);cin.tie();cout.tie();\n\tsrand(388651);cin >> n;while(n--)\n\t{\n\t\tcin >> s;t = r;for(auto i = s.begin(), l = s.end();i != l;++i)\n\t\t\t(t = t->d[x = *i - 'a'] ? t->d[x] : t->d[x] = new T())->I(P{0, string(i + 1, l)});\n\t}\n\tcin >> m;while(m--)\n\t{\n\t\tcin >> s >> z;t = r;for(int i = 0;i < s.length();++i)\n\t\t\tif(!(t = t->d[s[i] - 'a'])) {cout << \"404Error\" << endl;break;}\n\t\tif(!t) continue;cout << (s += (q = (p = t->K(z)).s)) << endl;\n\t\tx = p.x;t = r;for(auto i = s.begin(), l = s.end();i != l;++i)\n\t\t\tq = string(i + 1, l), (t = t->d[*i - 'a'])->D(P{x, q}), t->I(P{x + 1, q});\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1656984172,
        "uid": 388651,
        "name": "5k_sync_closer",
        "ccfLevel": 7,
        "title": "P7475 \u300cC.E.L.U-02\u300d\u7b80\u6613\u8f93\u5165\u6cd5 \u9898\u89e3"
    }
]