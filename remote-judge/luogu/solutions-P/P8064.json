[
    {
        "content": "> \u7ed9\u5b9a\u4e00\u4e2a $N\\times N$ \u7684\u7f51\u683c\uff0c\u6709 $K$ \u4e2a\u683c\u5b50\u662f\u969c\u788d\uff0c\u4f60\u9700\u8981\u627e\u51fa\u6700\u957f\u7684\u87ba\u65cb\u8def\u5f84\u3002\u87ba\u65cb\u8def\u5f84\u7684\u5b9a\u4e49\u662f\u4ece\u4e00\u4e2a\u70b9\u51fa\u53d1\uff0c\u5411\u4e00\u4e2a\u65b9\u5411\u8d70\u6700\u5c11\u4e00\u683c\uff0c\u7136\u540e\u53f3\u8f6c $90$ \u00b0\uff0c\u4e00\u5171\u53f3\u8f6c\u4e09\u6b21\uff0c\u8d70\u4e86\u56db\u6bb5\uff0c\u4e14\u4e00\u683c\u683c\u5b50\u6700\u591a\u7ecf\u8fc7\u4e00\u6b21\uff0c$N\\le 1000,K\\le 2000$\u3002\n\n\u4e0d\u5931\u4e00\u822c\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u7edf\u8ba1\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5\u3002\u7136\u540e\u5c06\u7ea2\u7ebf\u4e0a\u4e0b\u5206\u5f00\u7edf\u8ba1\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/qzsbgjyu.png)\n\n\u5bf9\u4e8e\u7ea2\u7ebf\u4e0b\u9762\u7684\u90e8\u5206\uff0c\u53ef\u4ee5\u7b80\u5355 DP \u5728 $\\mathcal{O}(N^2)$ \u7684\u65f6\u95f4\u5185\u5b8c\u6210\u3002\n\n\u7136\u540e\u8003\u8651\u7ea2\u7ebf\u4e0a\u9762\uff0c\u9700\u8981\u548c\u7ea2\u7ebf\u6784\u6210\u4e00\u683c\u77e9\u5f62\u3002\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4ece\u4e0a\u5230\u4e0b\u626b\u63cf\u7ebf\u3002\n\n\u6211\u4eec\u8bb0\u5f55 $f(l,r)$ \u8868\u793a\u5de6\u53f3\u8fb9\u754c\u5206\u522b\u4e3a\u4e3a $l,r$ \u7684\u62f1\u5f62\u7684\u6700\u5927\u957f\u5ea6\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u969c\u788d\u7269\uff0c\u6700\u591a\u53ea\u4f1a\u5bf9 $N$ \u4e2a $f(l, r)$ \u4ea7\u751f\u5f71\u54cd\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u5e73\u8861\u6811\u7ef4\u62a4 $f(l, \\cdots)$\uff0c\u652f\u6301\u5220\u9664\u4e00\u683c\u4f4d\u7f6e\uff0c\u52a0\u5165 $\\le p$ \u7684\u88ab\u5220\u9664\u7684\u4f4d\u7f6e\uff0c\u548c\u67e5\u8be2\u6700\u5c0f\u503c\u3002\n\n\u5220\u9664\u662f $\\mathcal{O}(\\log)$ \u7684\uff0c\u52a0\u5165\u7684\u4f4d\u7f6e\u4e00\u5b9a\u88ab\u5220\u9664\u8fc7\uff0c\u6240\u4ee5\u662f\u5747\u644a\u590d\u6742\u5ea6\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}((N^2 + NK)\\log N)$\uff0c\u5bf9\u4e8e $4$ \u4e2a\u65b9\u5411\uff0c\u548c\u7ffb\u8f6c\u4e4b\u540e\u7684\u65b9\u5411\u90fd\u8981\u505a\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u662f $\\mathcal{O}(8(N^2 + NK)\\log N)$\u3002\n\n\u6709\u4e24\u4e2a\u70b9\u4e00\u76f4\u5361\u4e0d\u8fc7\u53bb\uff0c\u53ef\u4ee5 ``assert`` \u4e00\u4e0b\u6570\u636e\u7c7b\u578b\uff0c\u7136\u540e\u53bb\u6389 $8$ \u500d\u5e38\u6570\u3002\n\n```cpp\n#define N 1005\n#define M 2005\nint n, m, u[M], v[M], f[N][N], a[N][N], ans;\nvector<int>c[N];\nstruct node{\n\tint w[N], tag, st;\n\tmultiset<int>s, t;\n\tvoid init(int x){\n\t\tst = x, tag = 0; \n\t\ts.clear(), t.clear();\n\t\trep(i, x + 1, n)t.insert(i);\n\t}\n\tvoid ins(int p){\n\t\twhile(!t.empty()){\n\t\t\tint x = *t.begin();\n\t\t\tif(x <= p)t.erase(x), w[x] = x - st + 1 - tag, s.insert(w[x]);\n\t\t\telse break;\n\t\t}\n\t}\n\tvoid del(int p){\n\t\tif(p <= st || t.find(p) != t.end())return;\n\t\ts.erase(s.find(w[p])), t.insert(p);\n\t}\n\tint val(){\n\t\tif(!s.empty())return *s.rbegin() + tag;\n\t\treturn 0;\n\t}\n}o[N];\nvoid check(int l,int r){\n\tif(l > r)return;\n\trep(i, l, r - 1)o[i].ins(r);\n}\nvoid calc(){\n\tmemset(a, 0, sizeof(a));\n\tmemset(f, 0, sizeof(f));\n\trp(i, m)a[u[i]][v[i]] = 1;\n\tpr(i, n){\n\t\tint w = 0;\n\t\tpr(j, n)\n\t\t\tif(!a[i][j]){\n\t\t\t\tw++;\n\t\t\t\tif(f[i + 1][j])f[i][j] = 1 + f[i + 1][j];\n\t\t\t\tif(w > 1)cmx(f[i][j], w);\n\t\t\t}\n\t\t\telse w = 0;\n\t}\n\trp(i, n)c[i].clear(), o[i].init(i);\n\trp(i, m)c[u[i]].pb(v[i]);\n\trp(i, n - 1){\n\t\tsort(c[i].begin(), c[i].end());\n\t\tgo(x, c[i]){\n\t\t\trp(j, x - 1)o[j].del(x);\n\t\t\trep(j, x + 1, n)o[x].del(j);\n\t\t}\n\t\trp(j, n){\n\t\t\to[j].tag += 2;\n\t\t\tint cur = o[j].val();\n\t\t\tif(cur && f[i + 1][j])cmx(ans, cur + f[i + 1][j]);\n\t\t}\n\t\tif(c[i].empty())check(1, n);\n\t\telse{\n\t\t\tcheck(1, c[i][0] - 1), \n\t\t\tcheck(c[i][si(c[i]) - 1] + 1, n);\n\t\t\trp(j, si(c[i]) - 1)check(c[i][j - 1] + 1, c[i][j] - 1);\n\t\t}\n\t}\n}\nvoid rotate(){\n\trp(i, m){\n\t\tint uu = v[i], vv = n - u[i] + 1;\n\t\tu[i] = uu, v[i] = vv;\n\t}\n}\nint main() {\n\tread(n, m);\n\trp(i, m)read(u[i], v[i]);\n\tif(n > 990 && m > 1990){\n\t\trotate(), rotate(), rotate();\n\t\trp(i, m)v[i] = n - v[i] + 1;\n\t\trotate(), rotate(), calc(), rotate(), calc();\n\t}\n\telse{\n\t\tcalc();\n\t\trotate(), calc();\n\t\trotate(), calc();\n\t\trotate(), calc();\n\t\trp(i, m)v[i] = n - v[i] + 1;\n\t\tcalc();\n\t\trotate(), calc();\n\t\trotate(), calc();\n\t\trotate(), calc();\n\t}\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1658214244,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011[BalkanOI 2012] Spiral"
    }
]