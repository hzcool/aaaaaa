[
    {
        "content": "\u9996\u5148\uff0c\u9898\u76ee\u63cf\u8ff0\u8fc7\u4e8e\u62bd\u8c61\uff0c\u672c\u8d28\u662f\u6c42 $A$ \u7684\u4e00\u4e2a\u5b50\u5e8f\u5217\uff0c\u4f7f\u5f97\u8fd9\u4e2a\u5b50\u5e8f\u5217\u5305\u542b $A_n$\uff0c\u5e76\u4e14\u5b50\u5e8f\u5217\u4e2d\u76f8\u90bb\u7684\u5143\u7d20\u4f4d\u7f6e\u8ddd\u79bb $\\le D$\uff0c\u5e76\u4e14\u4ece\u524d\u5f80\u540e\u7834\u7eaa\u5f55\u5143\u7d20\u5c3d\u91cf\u591a\uff0c\u6c42\u7834\u7eaa\u5f55\u5143\u7d20\u4e2a\u6570\u3002\n\n\u53ea\u6709 $A$ \u76f8\u5bf9\u987a\u5e8f\u6709\u7528\uff0c\u6240\u4ee5\u5148\u5c06 $A$ \u79bb\u6563\u5316\u3002\n\n\u8003\u8651 dp\uff0c\u5176\u4e2d $dp[i]$ \u4e3a $i$ \u4e3a\u7834\u7eaa\u5f55\u5143\u7d20\u65f6\u80fd\u5305\u542b\u51e0\u4e2a\u7834\u7eaa\u5f55\u5143\u7d20\u3002$i$ \u80af\u5b9a\u4e3a\u7834\u7eaa\u5f55\u5143\u7d20\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u679a\u4e3e\u5728 $i$ \u524d\u9762\u7684\u7b2c\u4e00\u4e2a\u7834\u7eaa\u5f55\u5143\u7d20 $j$\u3002\u5219 $A_j<A_i$\u3002\u800c\u4e3a\u4e86\u4fdd\u8bc1\u5b58\u5728\u4e00\u4e2a\u5b50\u5e8f\u5217\u5305\u542b $i$ \u548c $j$\uff0c\u8fd8\u6ee1\u8db3\u76f8\u90bb\u5143\u7d20\u8ddd\u79bb $\\le D$\uff0c\u5fc5\u987b\u5b58\u5728 $j<p_1<p_2<\\dots<p_x<i$ \u4f7f\u5f97 \n\n - $p_1-j,p_2-p_1,p_3-p_2,\\dots,p_x-p_{x-1},i-p_x\\le D$\n - $A_{p_1},A_{p_2},\\dots,A_{p_k}<A_i$\uff08\u6765\u4fdd\u8bc1 $A_i$ \u662f\u7834\u7eaa\u5f55\u5143\u7d20\uff0c\u6ce8\u610f\u4e0d\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u5c0f\u4e8e $A_j$\uff0c\u56e0\u4e3a\u8fd9\u6837\u80af\u5b9a\u4e0d\u4f18\uff09\n\n\u5219\u53ef\u4ee5\u53d6\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684 $j$ \u5e76\u4e14\u6c42 $dp[i]=\\max(dp[j])+1$\u3002\u76f4\u63a5 dp \u53ef\u4ee5\u505a\u5230 $O(n^2)$\u3002\u800c\u53d1\u73b0\u7531\u4e8e $i:1\\to n$ \u65f6 $A_i$ \u7684\u5927\u91cf\u53d8\u5316\uff0c\u7ef4\u62a4\u76f8\u90bb\u5143\u7d20\u8ddd\u79bb\u7ea6\u675f\u76f8\u5bf9\u56f0\u96be\uff0c\u4e8e\u662f\u8003\u8651\u5bf9 $A_i$ \u626b\u63cf\u7ebf\u3002\n\n\u6309\u7167 $A_i$ \u4ece\u5c0f\u5230\u5927\u66f4\u65b0 $dp[i]$\uff0c\u5219\u8ba1\u7b97\u67d0\u4e2a $dp[i]$ \u7684\u65f6\u5019\u80af\u5b9a\u53ea\u6709\u5df2\u7ecf\u88ab\u66f4\u65b0\u7684 $dp[j]$ \u80fd\u5f71\u54cd $dp[i]$\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a set \u5305\u542b\u6240\u6709\u5df2\u7ecf\u88ab\u66f4\u65b0\u7684\u4f4d\u7f6e\uff1a\u8fd9\u4e9b\u4f4d\u7f6e\u4e0a\u7684\u503c\u5747\u5c0f\u4e8e $A_i$\u3002\u7ef4\u62a4\u4e00\u4e2a\u5e76\u67e5\u96c6\uff0c\u5176\u4e2d $i$ \u548c $j$ \u8fde\u901a\u5f53\u4e14\u4ec5\u5f53 $i$ \u548c $j$ \u88ab\u66f4\u65b0\u5e76\u4e14 $j-i\\le D$\uff0c\u5219\u53ef\u4ee5\u4ece\u5e76\u67e5\u96c6\u7684\u8fde\u901a\u5757\u4fe1\u606f\u5f97\u51fa\u4efb\u4f55 $i$ \u7684\u6700\u5de6\u7aef $j$ \u4f7f\u5f97\u76f8\u90bb\u5143\u7d20\u8ddd\u79bb\u7ea6\u675f\u6210\u7acb\u3002\n\n\u7136\u540e\u7528\u5e76\u67e5\u96c6\u5f97\u5230 $j$ \u4e4b\u540e\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4 $dp$ \u533a\u95f4\u6700\u5927\u503c\uff0c\u603b\u5171\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define all(a) a.begin(), a.end()\n#define fi first\n#define se second\n#define pb push_back\n#define mp make_pair\n\nusing ll = long long;\nusing pii = pair<int, int>;\n//#define int ll\nconst int MOD = 1000000007;\n\nint las[300005];\n\nint ufs(int u) {\n  if (las[u] == -1)\n    return u;\n  return las[u] = ufs(las[u]);\n}\nvoid conn(int u, int v) {\n  u = ufs(u), v = ufs(v);\n  if (u != v)\n    las[max(u, v)] = min(u, v);\n}\n\nint seg[300005 << 2];\nvoid upd(int idx, int l, int r, int u, int v) {\n  if (!(l <= u && u < r))\n    return;\n  if (r - l == 1) {\n    seg[idx] = v;\n    return;\n  }\n  upd(idx * 2, l, (l + r) / 2, u, v);\n  upd(idx * 2 + 1, (l + r) / 2, r, u, v);\n  seg[idx] = max(seg[idx * 2], seg[idx * 2 + 1]);\n}\nint qry(int idx, int l, int r, int L, int R) {\n  if (L <= l && r <= R)\n    return seg[idx];\n  if (R <= l || r <= L)\n    return 0;\n  return max(qry(idx * 2, l, (l + r) / 2, L, R),\n             qry(idx * 2 + 1, (l + r) / 2, r, L, R));\n}\nsigned main() {\n  ios_base::sync_with_stdio(false);\n  cin.tie(0);\n  memset(las, -1, sizeof las);\n  int n, d;\n  cin >> n >> d;\n  vector<pii> x(n);\n  for (int i = 0; i < n; i++)\n    cin >> x[i].fi, x[i].se = -i;\n  sort(all(x));\n  set<int> on;\n  int ans = 0;\n  for (auto [_, i] : x) {\n    i = -i;\n    auto pos = on.insert(i).fi;\n    if (pos != on.begin() && *pos - *prev(pos) <= d)\n      conn(*pos, *prev(pos));\n    if (next(pos) != on.end() && *next(pos) - *pos <= d)\n      conn(*pos, *next(pos));\n    int dp = qry(1, 0, n, ufs(i), i) + 1;\n    ans = max(ans, dp);\n    upd(1, 0, n, i, dp);\n  }\n  cout << ans << endl;\n}\n```",
        "postTime": 1635344850,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "P7804 [JOI Open 2021] Financial Report"
    },
    {
        "content": "\u601d\u8def\u6765\u81ea @[Chinese\\_zjc\\_](https://www.luogu.com.cn/user/118239) ![](//\u56fe.tk/3)\n\n### \u9898\u610f\n\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a_1,a_2,a_3,\\cdots,a_n$\n\n\u9009\u51fa\u4e00\u4e2a\u5b50\u5e8f\u5217 $a_{p_1},a_{p_2},a_{p_3},\\cdots,a_{p_m}$\uff0c\u8981\u6c42\u6ee1\u8db3\u5982\u4e0b\u9650\u5236\uff1a\n\n- $p_m=n$\n- $p_i<p_{i+1}$\n- $m=1 \\operatorname{or} p_{i+1}-p_i\\leq d$\n\n\u5b9a\u4e49\u4e00\u4e2a\u5e8f\u5217\u7684\u4ef7\u503c\u4e3a\u6ee1\u8db3 $\\max_{i=1}^{j-1}a_i<a_j$ \u7684\u4e0b\u6807 $j$ \u4e2a\u6570 \n\n\u6c42\u6240\u6709\u5b50\u5e8f\u5217\u4e2d\u6700\u5927\u7684\u4ef7\u503c\n\n### \u9898\u89e3\n\n\u8bbe\u4ee5 $a_i$ \u7ed3\u5c3e\u7684\u5e8f\u5217\uff0c\u6700\u5927\u7684 $m$ \u4e3a $dp_i$\n\n\u56e0\u4e3a\u8981\u6c42 $a_{p_i}<a_{p_{i+1}}$\uff0c\u6240\u4ee5 $dp_i$ \u4f1a\u6309\u7167 $a_i$ \u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u8f6c\u79fb\n\n\u56e0\u4e3a\u8981\u6c42 $p_i<p_{i+1}$ \uff0c\u6240\u4ee5 $a_i$ \u76f8\u7b49\u65f6\uff0c\u4ece\u524d\u5f80\u540e\u8f6c\u79fb\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u7684 `stable_sort()` \u4e00\u53d1 **\u4e0d\u8981\u6253\u6210 `sort()`** ~~\u6302\u4e86\u597d\u51e0\u53d1 \u60e8\u6848QAQ~~\n\n\u5047\u8bbe\u5f53\u524d\u6b63\u5728\u8f6c\u79fb\u7b2c $i$ \u4e2a\uff0c\u901a\u8fc7\u4e0d\u65ad\u8df3\u6700\u591a $d$ \u4e2a\u7684\u65b9\u5f0f\uff0c\u4ece $i$ \u5411\u524d\u8df3\u6700\u8fdc\u53ef\u4ee5\u8df3\u5230\u7b2c $j$ \u4e2a\n\n\u5219 $dp_i=\\max_{k=j-d}^{i-1}dp_k+1$\n\n\u6c42\u5411\u524d\u8df3\u6700\u8fdc\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\uff0c\u6c42 `max` \u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\n\n### \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define ls (pos<<1)\n#define rs (pos<<1|1)\n#define mid ((l+r)>>1)\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9')\n\t{\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9')\n\t{\n\t\tx=x*10+(c^'0');\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\ninline void write(int x)\n{\n\tif(x<0)\n\t{\n\t\tputchar('-');\n\t\tx=-x;\n\t}\n\tif(x>9)\n\t\twrite(x/10);\n\tputchar(x%10+'0');\n}\nint n,d,a[300005],rk[300005],fa[300005];\nint seg[300005<<2];\nvoid update(int loc,int val,int pos=1,int l=1,int r=n)\n{\n\tif(l==r)return void(seg[pos]=val);\n\tif(loc<=mid)update(loc,val,ls,l,mid);\n\telse update(loc,val,rs,mid+1,r);\n\tseg[pos]=max(seg[ls],seg[rs]);\n}\nint query(int lx,int rx,int pos=1,int l=1,int r=n)\n{\n\tif(rx<l||lx>r)return 0;\n\tif(lx<=l&&r<=rx)return seg[pos];\n\tint ans=INT_MIN;\n\tif(lx<=mid)ans=max(ans,query(lx,rx,ls,l,mid));\n\tif(rx>mid)ans=max(ans,query(lx,rx,rs,mid+1,r));\n\treturn ans;\n}\nint find(int lx,int rx,int pos=1,int l=1,int r=n)\n{\n\tif(rx<l||lx>r||!seg[pos])return 0;\n\tif(l==r)return l;\n\treturn find(lx,rx,ls,l,mid)?:find(lx,rx,rs,mid+1,r);\n}\nint find(int x)\n{\n\tif(fa[x]==x)\n\t{\n\t\tint res=find(x-d,x-1);\n\t\tif(res)fa[x]=find(res);\n\t\treturn fa[x];\n\t}\n\treturn fa[x]=find(fa[x]);\n}\nint main()\n{\n\tn=read(),d=read();\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tfor(int i=1;i<=n;i++)fa[i]=i;\n\tfor(int i=1;i<=n;i++)rk[i]=n+1-i;\n\tstable_sort(rk+1,rk+1+n,[](int x,int y){return a[x]<a[y];});\n\tfor(int i=1;i<=n;i++)update(rk[i],query(find(rk[i])-d,rk[i]-1)+1);\n\twrite(query(1,n));\n}\n```",
        "postTime": 1633434402,
        "uid": 87434,
        "name": "_Life_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7804 \u3010Financial Report\u3011"
    }
]