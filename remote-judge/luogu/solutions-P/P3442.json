[
    {
        "content": "> [P3442 [POI2006]NAJ-The Invasion](https://www.luogu.com.cn/problem/P3442)\n>\n> [POI \u5408\u96c6](https://www.cnblogs.com/alex-wei/p/POI.html)\u3002\n\n\u6bd4\u8f83\u57fa\u7840\u7684\u51f8\u5305\u9898\u76ee\u3002\n\n\u8003\u8651\u679a\u4e3e\u4e09\u89d2\u5f62\u7684\u4e09\u4e2a\u70b9\uff0c\u6211\u4eec\u5fc5\u987b\u505a\u5230 $\\mathcal{O}(1)$ \u5224\u65ad\u4e09\u89d2\u5f62\u5185\u70b9\u7684\u4ef7\u503c\u4e4b\u548c\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u9884\u5904\u7406 $f_{i,j}$ \u8868\u793a\u5411\u91cf $\\overrightarrow{P_iP_j}$ \u9006\u65f6\u9488\u65b9\u5411\u4e0e\u51f8\u5305\u4e4b\u95f4\u5f62\u6210\u7684\u533a\u57df\u5305\u542b\u7684\u70b9\u7684\u4ef7\u503c\u4e4b\u548c\uff0c\u7136\u540e\u7528\u603b\u4ef7\u503c\u51cf\u53bb $f_{i,j}+f_{j,k}+f_{k,i}\\ (1\\leq i<j<k\\leq n)$ \u5f97\u5230\u3002\u7531\u4e8e\u4e09\u89d2\u5f62\u5305\u542b\u8fb9\u754c\uff0c\u6240\u4ee5 $f_{i,j}$ \u4e0d\u5305\u542b\u8fb9\u754c\u3002\n\n$f_{i,j}$ \u5982\u4f55\u9884\u5904\u7406\u5462\uff1f\u679a\u4e3e\u6bcf\u4e2a\u7269\u8d44 $Q_k$\uff0c\u987a\u65f6\u9488\u4e8c\u5206\u627e\u5230\u7b2c\u4e00\u4e2a\u4f4d\u7f6e $p$ \u4f7f\u5f97 $\\overrightarrow{P_iQ_k}$ \u5728 $\\overrightarrow{P_iP_j}$ \u7684\u9006\u65f6\u9488\u65b9\u5411\uff0c\u5373$\\overrightarrow{P_iP_j} \\times \\overrightarrow{P_iQ_k}> 0$\uff0c\u6b64\u65f6\u6240\u6709\u5728 $p$ \u987a\u65f6\u9488\u65b9\u5411\u76f4\u5230 $i-1$ \u7684\u6240\u6709\u70b9 $j$ \u7684 $f_{i,j}$ \u90fd\u9700\u8981\u52a0\u4e0a $c_k$\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u7834\u73af\u6210\u94fe + \u5dee\u5206\u505a\u5230\u3002\n\n\u6ce8\u610f\u9700\u8981\u7279\u5224\u5728\u9876\u70b9\u4e0a\u7684\u7269\u8d44\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n(n^2+m\\log n))$\u3002$n^3$ \u6709 $\\dfrac 1 6$ \u7684\u5e38\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n```cpp\nconst int N = 600 + 5;\nconst int M = 1e4 + 5;\n\nint n, x[N << 1], y[N << 1], val[N], f[N][N];\nint m, a[M], b[M], c[M], tot, ans = -1e9;\nint cross(int ax, int ay, int bx, int by) {return ax * by - ay * bx;}\nint main(){\n\tcin >> n; for(int i = 1; i <= n; i++) cin >> x[i] >> y[i], x[n + i] = x[i], y[n + i] = y[i];\n\tcin >> m; for(int i = 1; i <= m; i++) {\n\t\tint found = 0; cin >> a[i] >> b[i] >> c[i];\n\t\tfor(int j = 1; j <= n; j++) if(a[i] == x[j] && b[i] == y[j]) found = j;\n\t\tfound ? (val[found] += c[i], c[i] = 0) : tot += c[i];\n\t} for(int i = 1; i <= n; i++) {\n\t\tstatic int buc[N << 1]; mem(buc, 0, N << 1);\n\t\tfor(int j = 1; j <= m; j++) if(c[j]) {\n\t\t\tint l = i + 1, r = i + n + 1;\n\t\t\twhile(l < r) {\n\t\t\t\tint m = l + r >> 1;\n\t\t\t\tcross(x[m] - x[i], y[m] - y[i], a[j] - x[i], b[j] - y[i]) > 0 ? r = m : l = m + 1;\n\t\t\t} buc[l] += c[j];\n\t\t} for(int j = 1; j <= n << 1; j++) buc[j] += buc[j - 1];\n\t\tfor(int j = i + 1; j <= n; j++) f[i][j] = buc[j];\n\t\tfor(int j = 1; j < i; j++) f[i][j] = buc[j + n];\n\t} for(int i = 1; i < n; i++) for(int j = i + 1; j < n; j++) for(int k = j + 1; k <= n; k++)\n\t\tcmax(ans, tot - f[i][j] - f[j][k] - f[k][i] + val[i] + val[j] + val[k]);\n\tcout << ans << endl;\n\treturn 0;\n}\n```",
        "postTime": 1639411802,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P3442 [POI2006]NAJ-The Invasion"
    }
]