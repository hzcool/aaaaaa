[
    {
        "content": "\u540c\u6b65\u53d1\u5e03\u4e8e[cnblogs](https://www.cnblogs.com/Itst/p/12241180.html)\n\n## \u524d\u8a00\n\n> \u4f60\u6253\u5f00\u4e86\u201cP4000 \u6590\u6ce2\u90a3\u5951\u6570\u5217\u201d\u4e00\u9898\uff1b\n\n> \u4f60\u53d1\u73b0\u662f\u5df2\u7ecf\u5199\u8fc7 $\\mathrm{998244853}$ \u904d\u7684\u6c42 $\\mathrm{Fib}_n$\uff1b\n\n> \u4f60\u719f\u7ec3\u5730\u5199\u51fa\u77e9\u9635\u5feb\u901f\u5e42\u5e76\u63d0\u4ea4\uff1b\n\n> \u4f60\u5f97\u5230\u4e86\u4e00\u7248\u7684 $\\mathrm{TLE}$ \uff0c\u56e0\u4e3a $n \\leq 10^{30000000}$\uff1b\n\n> \u4f60\u70b9\u5f00\u4e86\u9898\u89e3\uff0c\u53d1\u73b0\u7b2c\u4e00\u7bc7\u9898\u89e3\u4e00\u5927\u7247\u516c\u5f0f\u548c\u5b9a\u7406\uff1b\n\n> \u4f60\u5411\u4e0b\u6ed1\u52a8\u754c\u9762\uff0c\u5176\u4ed6\u7684\u9898\u89e3\u90fd\u76f4\u63a5\u6446\u7ed3\u8bba\u3002\n\n\u76f8\u4fe1\u7ecf\u5386\u4e86\u8fd9\u4e48\u591a\u7684\u4f60\u5fc3\u4e2d\u6ee1\u6ee1\u7684\u201c\u6211\u592a\u96be\u4e86\u201d\u3002\n\n\u90a3\u4e48\u8fd9\u7bc7\u9898\u89e3\u5c06\u62ef\u6551\u4f60\u4e8e\u6c34\u706b\u4e4b\u4e2d\uff08\uff1f\uff09\n\n## \u524d\u7f6e\u829d\u58eb\n\n- \u4e3b\u89d2\uff1a\u751f\u65e5\u6096\u8bba\uff1b\n- \u8f85\u52a9\u7ed3\u8bba\uff1a\u6a21\u6570\u4e3a $p$ \u7684\u6590\u6ce2\u90a3\u5951\u5faa\u73af\u8282\u957f\u5ea6 $\\pi(p) \\leq 6p$\uff1b\n- $O(\\sqrt p)-O(1)$ \u5feb\u901f\u5e42\uff0c[LOJ\u6709\u6a21\u677f\u9898](https://loj.ac/problem/162)\u3002\n\n\u5173\u4e8e\u8f85\u52a9\u7ed3\u8bba\u7684\u8bc1\u660e\uff0c\u56e0\u4e3a\u524d\u7f6e\u7ed3\u8bba\u6bd4\u8f83\u591a ~~\uff08\u5b9e\u9645\u4e0a\u662f\u6211\u4e0d\u4f1a\uff09~~ \uff0c\u6545\u5728\u672c\u7bc7\u9898\u89e3\u4e2d\u88ab\u7701\u7565\u3002\u5982\u679c\u4f60\u6709\u6761\u4ef6\uff0c\u53ef\u4ee5\u53c2\u8003 $\\mathrm{Wikipedia}$ \u4e2d\u7684 $\\mathrm{Pisano\\ Period}$ \u6761\u76ee\uff0c\u5176\u4e2d\u6709\u8bc1\u660e\u3002\n\n\u6240\u4ee5\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u505a\u6cd5\u4e5f\u6709\u5f88\u591a\u524d\u7f6e\u3002\u4f46\u662f\u76f8\u6bd4\u7eaf\u6570\u8bba\u505a\u6cd5\uff0c\u7ed3\u8bba\u53ea\u6709\u8fd9\u4e00\u4e2a\uff0c\u800c\u4e14\u8fd9\u4e2a\u7ed3\u8bba\u5f88\u597d\u8bb0\u3002\n\n## \u7b97\u6cd5\u6d41\u7a0b\n\n\u4e00\u4ef6\u663e\u7136\u7684\u4e8b\u60c5\u662f\u9700\u8981\u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u5faa\u73af\u8282\u3002\u66b4\u529b\u505a\u6cd5\u57fa\u672c\u6ca1\u6709\u4f18\u5316\u7a7a\u95f4\uff0c\u8003\u8651\uff1a\u8bbe\u5faa\u73af\u8282\u957f\u5ea6\u4e3a $\\pi(p)$\uff0c\u5bf9\u4e8e $i \\neq j$ \uff0c\u5982\u679c $\\mathrm{Fib}_i = \\mathrm{Fib}_j$ \u4e14 $\\mathrm{Fib}_{i+1} = \\mathrm{Fib}_{j+1}$\uff0c\u90a3\u4e48$\\pi(p) \\mid j-i$\u3002\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u627e\u5230\u4e24\u4e2a\u4f4d\u7f6e $i,j$ \u6ee1\u8db3\u6761\u4ef6\u5c31\u53ef\u4ee5\u5f97\u5230\u5faa\u73af\u8282\u957f\u5ea6\u7684\u67d0\u4e2a\u500d\u6570\u3002\n\n\u56e0\u4e3a\u53ea\u9700\u6c42\u503c\uff0c\u6240\u4ee5\u6c42\u51fa$\\pi(p)$\u7684\u771f\u5b9e\u503c\u6ca1\u6709\u5fc5\u8981\uff0c\u6c42\u51fa\u5176\u500d\u6570\u4e5f\u53ef\u4ee5\u63a5\u53d7\u3002\u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u968f\u673a\u5316\u5f97\u5230\u4e00\u4e2a\u65b0\u7b97\u6cd5\uff1a\u6bcf\u4e00\u6b21\u968f\u673a\u4e24\u4e2a\u6570 $i,j$\uff0c\u8ba1\u7b97 $\\mathrm{Fib}_i , \\mathrm{Fib}_{i+1} , \\mathrm{Fib}_j , \\mathrm{Fib}_{j+1}$ \u7684\u503c\u5224\u65ad\u662f\u5426\u76f8\u7b49\u3002\n\n\u663e\u7136\u8fd9\u4e2a\u505a\u6cd5\u662f\u671f\u671b $O(p)$ \u7684\uff0c\u8ddf\u66b4\u529b\u6ca1\u6709\u533a\u522b\u3002\u4f46\u6211\u4eec\u53ef\u4ee5\u6362\u4e00\u4e2a\u89d2\u5ea6\u63cf\u8ff0\u8fd9\u4e2a\u95ee\u9898\uff1a\u6bcf\u4e00\u6b21\u968f\u673a\u4e24\u4e2a\u4f4d\u7f6e $i,j$\uff0c\u76f8\u5f53\u4e8e\u968f\u673a\u4e24\u4e2a\u6570 $x = i \\mod \\pi(p)$ \u548c $y = j \\mod \\pi(p)$\uff0c\u5982\u679c $x=y$ \u5c31\u53ef\u4ee5\u627e\u5230\u5faa\u73af\u8282\u7684\u500d\u6570\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u95ee\u9898\u4e0e\u201c\u751f\u65e5\u6096\u8bba\u201d\u95ee\u9898\u57fa\u672c\u4e00\u81f4\u3002\u5229\u7528\u751f\u65e5\u6096\u8bba\u601d\u60f3\uff0c\u6bcf\u4e00\u6b21\u968f\u673a\u4e24\u4e2a\u547d\u4e2d\u6982\u7387\u5f88\u5c0f\uff0c\u4f46\u968f\u673a\u4e09\u4e2a\u3001\u56db\u4e2a\u3001\u5f88\u591a\u4e2a\u4f4d\u7f6e\uff0c\u968f\u7740\u968f\u673a\u7684\u6570\u91cf\u589e\u957f\uff0c\u547d\u4e2d\u6982\u7387\u662f\u4ee5\u5e73\u65b9\u7ea7\u522b\u589e\u957f\u7684\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u66f4\u4f18\u79c0\u7684\u7b97\u6cd5\uff1a\u4f7f\u7528\u4e00\u4e2a\u54c8\u5e0c\u8868\u8bb0\u5f55\u4e4b\u524d\u968f\u673a\u5230\u7684\u6240\u6709 $(\\mathrm{Fib}_i , \\mathrm{Fib}_{i+1} , i)$ \u4e09\u5143\u7ec4\uff0c\u6bcf\u6b21\u968f\u673a\u4f4d\u7f6e $j$ \u5e76\u5f97\u5230 $(\\mathrm{Fib}_j , \\mathrm{Fib}_{j+1} , j)$\uff0c\u5982\u679c\u5728\u54c8\u5e0c\u8868\u4e2d\u53ef\u4ee5\u627e\u5230\u6ee1\u8db3 $\\mathrm{Fib}_i = \\mathrm{Fib}_j$ \u4e14 $\\mathrm{Fib}_{i+1} = \\mathrm{Fib}_{j+1}$ \u7684\u4e09\u5143\u7ec4 $(\\mathrm{Fib}_i , \\mathrm{Fib}_{i+1} , i)$\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u5faa\u73af\u8282\u7684\u67d0\u4e2a\u500d\u6570\u3002\n\n\u6839\u636e\u751f\u65e5\u6096\u8bba\uff0c\u4e0a\u8ff0\u7b97\u6cd5\u5728\u671f\u671b $O(\\sqrt p)$ \u6b21\u5185\u53ef\u4ee5\u5b8c\u6210\u5bfb\u627e\u3002\u4f7f\u7528 $O(\\sqrt p) - O(1)$ \u77e9\u9635/\u6269\u57df\u5feb\u901f\u5e42\u5b9e\u73b0\u6c42\u6590\u6ce2\u90a3\u5951\u6570\uff0c\u53ef\u4ee5\u505a\u5230 $O(\\sqrt p)$ \u6c42\u51fa\u5faa\u73af\u8282\u3002\n\n## \u540e\u8bdd\n\n\u8fd9\u4e2a\u505a\u6cd5\u662f\u5728\u590d\u4e60`Pollard-rho`\u7b97\u6cd5\u65f6 ~~\u6253\u9694\u819c~~ \u7ffb\u5230\u6709\u535a\u5ba2\u8bb0\u5f55 $\\pi(p) \\leq 6p$ \u65f6\u6d6e\u73b0\u7684\u3002\u5982\u679c\u5728\u8003\u573a\u4e0a\u9047\u5230\u4e86\u7c7b\u4f3c\u95ee\u9898\uff0c\u53ea\u9700\u8981\u4fe1\u4ef0\u731c\u60f3\u5faa\u73af\u8282\u957f\u5ea6\u4e3a\u6a21\u6570\u7ea7\u522b\u3001\u628a $\\frac{\\text{\u5faa\u73af\u8282\u957f\u5ea6}}{\\text{\u6a21\u6570}}$ \u8fd9\u4e2a\u5e38\u6570\u4f30\u8ba1\u5927\u4e00\u4e9b\u7136\u540e\u5957\u7528\u672c\u9898\u505a\u6cd5\u5c31\u53ef\u4ee5\u4e86\uff0c\u62d3\u5c55\u6027\u6bd4\u8f83\u9ad8\u3002\n\n\u5982\u679c\u60f3\u6c42 $\\pi(p)$ \u7684\u771f\u5b9e\u503c\uff0c\u53ea\u9700\u8981\u679a\u4e3e\u7b97\u51fa\u6765\u7684\u5faa\u73af\u8282\u7684\u7ea6\u6570\u7136\u540e\u9010\u4e2a\u5224\u65ad\u5373\u53ef\u3002\n\n## Show me the Code.\n\n\u4e24\u4e2a\u5b9e\u73b0\u7ec6\u8282\uff1a\n\n- \u5efa\u8bae\u968f\u673a\u4f4d\u7f6e\u4e0a\u754c\u5927\u4e8e $12p$\uff0c\u5426\u5219\u671f\u671b\u6b21\u6570\u53ef\u80fd\u4f1a\u9000\u5316\u3002\u4ee3\u7801\u4e2d\u7684\u968f\u673a\u4e0a\u754c\u662f $2^{36}$\uff0c\u9009\u62e9\u4e8c\u7684\u6b21\u5e42\u4f5c\u4e3a\u6a21\u6570\uff08\u6216\u8bb8\uff09\u53ef\u4ee5\u6700\u5c0f\u5316\u56e0\u4e3a\u53d6\u6a21\u5bfc\u81f4\u7684`mt19937_64`\u968f\u673a\u4e0d\u5747\u5300\u95ee\u9898\u3002\n- $p < 2^{31}$ \u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u7528\u4e00\u4e2a`long long`\u5b58\u4e0b $(\\mathrm{Fib}_i,\\mathrm{Fib}_{i+1})$ \u4e8c\u5143\u7ec4\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7528 `unordered_map`\u5b9e\u73b0\u54c8\u5e0c\u8868\u4e86\u3002\n\n\u4e0e\u6b64\u540c\u65f6\u8fd9\u4efd\u4ee3\u7801\u5e38\u6570\u6bd4\u8f83\u5927\uff0c\u7528\u6269\u57df\u5e38\u6570\u4f1a\u5c0f\u4e00\u534a\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define ll long long\n#define ull unsigned long long\nunordered_map < ull , ll > circ; ll len;\nint MOD , MX = 1 << 18; mt19937_64 rnd(time(0));\nstruct matrix{\n\tll arr[2][2];\n\tmatrix(){memset(arr , 0 , sizeof(arr));}\n\tll* operator [](int x){return arr[x];}\n\tfriend matrix operator *(matrix p , matrix q){\n\t\tmatrix x;\n\t\tfor(int i = 0 ; i < 2 ; ++i)\n\t\t\tfor(int j = 0 ; j < 2 ; ++j)\n\t\t\t\tfor(int k = 0 ; k < 2 ; ++k)\n\t\t\t\t\tx[i][k] += p[i][j] * q[j][k];\n\t\tfor(int i = 0 ; i < 2 ; ++i)\n\t\t\tfor(int j = 0 ; j < 2 ; ++j) x[i][j] %= MOD;\n\t\treturn x;\n\t}\n}G , T[2][1 << 18 | 1];\n\nsigned main(){\n\tstatic char str[300000003]; scanf(\"%s %d\" , str + 1 , &MOD);\n\tT[0][0][0][0] = T[0][0][1][1] = T[1][0][0][0] = T[1][0][1][1] = 1;\n\tT[0][1][0][1] = T[0][1][1][0] = T[0][1][1][1] = 1;\n\tfor(int i = 2 ; i <= MX ; ++i) T[0][i] = T[0][i - 1] * T[0][1];\n\tT[1][1] = T[0][MX]; for(int i = 2 ; i <= MX ; ++i) T[1][i] = T[1][i - 1] * T[1][1];\n\twhile(1){\n\t\tll x = (rnd() << 28 >> 28); matrix C = T[0][x & (MX - 1)] * T[1][x >> 18];\n\t\tull val = ((1ull * C[0][0]) << 32) | C[0][1];\n\t\tif(circ.find(val) != circ.end()){len = abs(circ[val] - x); break;}\n\t\tcirc[val] = x;\n\t}\n\tll sum = 0; \n\tfor(int i = 1 ; str[i] ; ++i) sum = (sum * 10 + str[i] - '0') % len;\n\tcout << (T[0][sum & (MX - 1)] * T[1][sum >> 18])[0][1];\n\treturn 0;\n}\n```",
        "postTime": 1580300033,
        "uid": 96296,
        "name": "Itst",
        "ccfLevel": 0,
        "title": "P4000 \u6590\u6ce2\u90a3\u5951\u6570\u5217 \u53e6\u7c7b\u505a\u6cd5"
    },
    {
        "content": "#### \u539f\u9898\u94fe\u63a5\uff1a[P4000 \u6590\u6ce2\u90a3\u5951\u6570\u5217](https://www.luogu.com.cn/problem/P4000)\n\n\n------------\n\n~~\uff08\u4e00\u5f00\u59cb\u4ee5\u4e3a\u662f\u9053\u6c34\u9898\uff0c\u6ca1\u60f3\u5230\u7adf\u7136\u5982\u6b64\u590d\u6742\uff0c\u545c\u545c\u545c\uff09~~\n\n> \u9898\u76ee\uff1a\u6c42 $f_n\\bmod P$ \u7684\u503c\u3002\n\n**\u6ce8\uff1a** \u539f\u9898\u7684\u6a21\u6570\u662f\u5c0f\u5199\u7684 $p$\uff0c\u6b64\u5904\u4e3a\u4e86\u533a\u5206\u4e0b\u6587\u7684\u8d28\u6570 $p$\uff0c\u6539\u4e3a\u5927\u5199\u7684 $P$\u3002\n\n\u9996\u5148\uff0c$n$ \u8fbe\u5230\u4e86 $10^{30000000}$ \u7684\u7ea7\u522b\uff0c\u77e9\u9635\u5feb\u901f\u5e42\u80af\u5b9a TLE\u3002\n\n\u4e8e\u662f\u6211\u4eec\u60f3\u5230\u4e86\u8981\u901a\u8fc7\u4e00\u4e9b\u65b9\u6cd5\u964d\u4f4e $n$ \u7684\u5927\u5c0f\uff0c\u6700\u5148\u60f3\u5230\u7684\u662f\u5bf9 $n$ \u6a21\u4ee5\u67d0\u4e2a\u6570\uff0c\u7136\u540e\u518d\u77e9\u9635\u5feb\u901f\u5e42\u4e0d\u5c31\u597d\u4e86\u561b\u3002\n\n\u90a3\u4e48\u5148\u624b\u7b97\u4e00\u4e0b\u53d6\u6a21\u7684\u8fd9\u4e2a\u6570\u548c $P$ \u7684\u5173\u7cfb\u5427\uff0c\u5047\u8bbe $P=4$\uff0c\u90a3\u4e48\u6590\u6ce2\u90a3\u5951\u6570\u5217\u957f\u8fd9\u6837\uff1a\n\n$$1,1,2,3,1,0,1,1,2,3,1,0,...$$\n\n\u597d\u50cf\u786e\u5b9e\u6709\u89c4\u5f8b\uff0c\u9488\u5bf9 $P=4$ \u65f6\u6211\u4eec\u53ea\u9700\u6c42 $f_{n\\bmod 6}$ \u5c31\u597d\u4e86\uff01\n\n\u53ef\u662f\u5bf9\u4e8e\u5176\u4ed6\u7684 $P$ \u8981\u600e\u4e48\u6c42\uff1f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u4e00\u70b9\u524d\u7f6e\u77e5\u8bc6\u2026\u2026\n\n------------\n\n## \u524d\u7f6e\u77e5\u8bc6\uff1a\u4e8c\u6b21\u5269\u4f59\n\n------------\n\n\u53ef\u80fd\u9700\u5148\u638c\u63e1\u300c[\u539f\u6839](https://www.luogu.com.cn/problem/P6091)\u300d\u7684\u77e5\u8bc6\u3002\n\n\u4e8c\u6b21\u5269\u4f59\u662f\u6307\u8fd9\u6837\u4e00\u7c7b\u95ee\u9898\uff1a\n\n> \u5df2\u77e5 $n,p$ \u7684\u503c\uff0c\u89e3\u65b9\u7a0b $x^2\\equiv n\\pmod p$ \u3002\n\n\u6d1b\u8c37\u4e0a\u6709\u6a21\u677f\u9898\uff1a[P5491 \u3010\u6a21\u677f\u3011\u4e8c\u6b21\u5269\u4f59](https://www.luogu.com.cn/problem/P5491)\u3002\u6b64\u5904\u4e0d\u505a\u8be6\u8ff0\uff0c\u53ea\u8bb2\u4e0e\u4e0b\u6587\u6709\u5173\u7684\uff0c\u5373 $p$ \u662f\u5947\u7d20\u6570\u7684\u60c5\u51b5\u3002\n\n\u9996\u5148 $p\\mid n$ \u65f6\uff0c$x^2\\equiv n\\equiv 0\\pmod p$\uff0c\u6545 $x=0$\u3002\n\n\u5f53 $p\\nmid n$ \u65f6\uff0c$x$ \u53ef\u80fd\u65e0\u89e3\uff0c\u5982 $n=2,p=3$ \u65f6\u3002\u90a3\u4e48 $n,p$ \u6ee1\u8db3\u4ec0\u4e48\u6761\u4ef6\u65f6 $x$ \u6709\u89e3\u5462\uff1f\n\n**\u7ed3\u8bba\u4e00**\uff1a$n^{\\frac{p-1}{2}}\\equiv 1\\pmod p$ \u662f $x$ \u6709\u4e0d\u4e3a $0$ \u7684\u89e3\u7684\u5145\u8981\u6761\u4ef6\u3002\u4ee5\u4e0b\u8bc1\u660e\uff1a\n\n\u5f53 $x$ \u6709\u4e0d\u4e3a $0$ \u7684\u89e3\u65f6\uff0c$x^{p-1}\\equiv 1$\u3002\u56e0\u6b64 $n^{\\frac{p-1}{2}}\\equiv(x^2)^{\\frac{p-1}{2}}\\equiv x^{p-1}\\equiv 1$\uff0c\u5fc5\u8981\u6027\u8bc1\u6bd5\u3002\n\n\u5f53 $n^{\\frac{p-1}{2}}\\equiv 1$ \u65f6\uff0c\u8bbe $g$ \u662f $p$ \u7684\u539f\u6839\uff0c\u5219\u5b58\u5728 $k$ \u4f7f\u5f97 $n=g^k$\uff0c\u6545 $g^{\\frac{k}{2}(p-1)}\\equiv 1$\u3002\u56e0\u4e3a $g$ \u7684\u9636\u662f $p-1$\uff0c\u6240\u4ee5 $(p-1)|\\frac{k}{2}(p-1)$\uff0c\u5373 $k$ \u662f\u5076\u6570\u3002\u90a3\u4e48\u89e3\u5f97 $x\\equiv g^{\\frac{k}{2}}$\uff0c\u6709\u4e0d\u4e3a $0$ \u7684\u89e3\u3002\u5145\u5206\u6027\u8bc1\u6bd5\u3002\n\n\u90a3\u4ec0\u4e48\u65f6\u5019\u65e0\u89e3\u5462\uff1f\u56e0\u4e3a $n^{p-1}\\equiv 1$\uff0c$(n^{\\frac{p-1}{2}}-1)(n^{\\frac{p-1}{2}}+1)\\equiv 0$\uff0c\u5373 $n^{\\frac{p-1}{2}}\\equiv \\pm1$\u3002\u7531\u7ed3\u8bba\u4e00\u63a8\u7406\u5f97\uff0c$n^{\\frac{p-1}{2}}\\equiv -1$ \u662f $x$ \u65e0\u89e3\u7684\u5145\u8981\u6761\u4ef6\uff0c\u8bb0\u4e3a**\u7ed3\u8bba\u4e8c**\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u4e0a\u9762\u8fd9\u4e9b\u5bf9\u4e0b\u6587\u6709\u7528\u7684\u53ea\u6709\u8fd9\u53e5\u8bdd\uff1a\n\n$x^2=n\\pmod p$ \u65e0\u89e3\u7b49\u4ef7\u4e8e $n^{\\frac{p-1}{2}}\\equiv -1\\pmod p$\u3002\n\n------------\n\n## \u6590\u6ce2\u90a3\u5951\u5faa\u73af\u8282\n\n------------\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u4e3b\u7ebf\u60c5\u8282\u4e86\u3002\n\n**\u7ed3\u8bba\u4e09**\uff1a\u6590\u6ce2\u90a3\u5951\u6570\u5217 $\\{f_i\\}$ \u5bf9 $p$ \u53d6\u6a21\u540e\u5fc5\u5b9a\u662f\u5468\u671f\u6570\u5217\u3002\n\n\u663e\u7136\uff0c\u53ea\u8981\u5b58\u5728 $i\\neq j$ \u6ee1\u8db3 $f_i\\equiv f_j$ \u4e14 $f_{i+1}\\equiv f_{j+1}$\u3002\u90a3\u4e48\u7531\u9012\u63a8\u5173\u7cfb\u53ef\u4ee5\u5f97\u5230 $f_{i+k}\\equiv f_{j+k}$\uff0c\u547d\u9898\u5c31\u6210\u7acb\u4e86\u3002\n\n\u8981\u8bc1\u660e\u5b58\u5728\u8fd9\u6837\u7684 $i,j$ \u4e5f\u4e0d\u96be\uff0c\u56e0\u4e3a\u4e0d\u53ef\u80fd\u6709\u65e0\u7a77\u591a\u5bf9\u4e0d\u540c\u7684 $(f_i,f_{i+1})$\uff0c\u81f3\u591a $p^2$ \u5bf9\uff0c\u56e0\u6b64\u4e00\u5b9a\u5b58\u5728 $i\\neq j$\uff0c\u6ee1\u8db3 $f_i\\equiv f_j$ \u4e14 $f_{i+1}\\equiv f_{j+1}$\u3002\u6545\u5faa\u73af\u8282\u4e00\u5b9a\u5b58\u5728\uff0c\u4e14\u957f\u5ea6\u4e0d\u8d85\u8fc7 $p^2$\uff0c\u8bc1\u6bd5\u3002\n\n\u8bbe $\\pi(p)$ \u662f\u8fd9\u4e2a\u6570\u5217\u7684\u5468\u671f\uff08\u6ce8\u610f\uff0c\u6b64\u5904\u5e76\u4e0d\u8981\u6c42 $\\pi(p)$ \u662f\u6700\u5c0f\u6b63\u5468\u671f\uff09\u3002\u90a3\u8981\u600e\u6837\u6c42 $\\pi(p)$\uff1f\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u82e5\u5b58\u5728 $k$ \u6ee1\u8db3 $\\forall i, f_{i}\\equiv f_{i+k}\\pmod p$\uff0c\u90a3 $k$ \u5c31\u662f $\\{f_i\\bmod p\\}$ \u7684\u5468\u671f\uff0c\u53d6 $\\pi(p)=k$ \u5c31\u597d\u4e86\u3002\n\n------------\n\n### Part 1\uff1a\n\n\u8ba9\u6211\u4eec\u4ece\u6700\u7b80\u5355\u7684\u60c5\u51b5\u5f00\u59cb\uff1a\u5f53\u6a21\u6570 $P$ \u7b49\u4e8e**\u67d0\u4e2a\u8d28\u6570** $p$ \u7684\u65f6\u5019\u3002\n\n\u5148\u642c\u51fa\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u901a\u9879\u516c\u5f0f\uff1a$f_i=\\dfrac{(\\frac{1+\\sqrt 5}{2})^i-(\\frac{1-\\sqrt 5}{2})^i}{\\sqrt 5}$\u3002\n\n\u56e0\u4e3a\u516c\u5f0f\u91cc\u6709 $\\sqrt 5,\\frac1 2$\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u5355\u72ec\u8ba8\u8bba $p=2,5$ \u7684\u60c5\u51b5\uff1a\u7ecf\u8ba1\u7b97\u53d6 $\\pi(2)=3,\\pi(5)=20$\u3002\n\n\u6487\u9664\u8fd9\u4e9b\u7279\u6b8a\u60c5\u51b5\u540e\uff0c$p$ \u4fbf\u662f\u4e00\u4e2a\u4e0d\u7b49\u4e8e $5$ \u7684\u5947\u7d20\u6570\u3002\u4f46\u6839\u636e\u4e8c\u6b21\u5269\u4f59\u7684\u77e5\u8bc6\uff0c$\\sqrt 5$ \u6a21 $p$ \u65f6\u4e0d\u4e00\u5b9a\u80fd\u8868\u793a\u6210\u6574\u6570\uff0c\u9700\u5206\u7c7b\u8ba8\u8bba\u3002\n\n- $x^2\\equiv 5\\pmod p$ \u6709\u975e $0$ \u89e3\n\n\u8fd9\u65f6 $x$ \u7b49\u4ef7\u4e8e $\\sqrt 5$ \uff0c\u90a3\u4e48 $\\sqrt 5,\\frac{1}{\\sqrt 5},\\frac 1 2$ \u6a21 $p$ \u5c31\u90fd\u6709\u610f\u4e49\uff0c\u5373 $\\frac{1+\\sqrt 5}{2},\\frac{1-\\sqrt 5}{2}$ \u80fd\u7528\u6574\u6570\u8868\u793a\uff0c\u9002\u7528\u4e8e\u6b27\u62c9\u5b9a\u7406\u3002\u6240\u4ee5\uff1a\n\n$$\\begin{aligned}f_{i+\\varphi(p)}&\\equiv \\frac{(\\frac{1+\\sqrt 5}{2})^{i+\\varphi(p)}-(\\frac{1-\\sqrt 5}{2})^{i+\\varphi(p)}}{\\sqrt 5}\\\\&\\equiv\\frac{(\\frac{1+\\sqrt 5}{2})^i-(\\frac{1-\\sqrt 5}{2})^i}{\\sqrt 5}=f_i\\end{aligned}$$\n\n\u6545 $\\varphi(p)$ \u662f\u6570\u5217\u7684\u4e00\u4e2a\u5468\u671f\uff0c\u53d6 $\\pi(p)= \\varphi(p)=p-1$\u3002\n\n- $x^2\\equiv 5\\pmod p$ \u65e0\u89e3\n\n\u65e0\u89e3\u610f\u5473\u7740\u627e\u4e0d\u5230\u6574\u6570\u66ff\u4ee3 $\\sqrt 5$\uff0c\u9700\u8981**\u6269\u57df**\u3002\n\n\u6269\u57df\u6307\u7684\u662f\u4ee4\u67d0\u4e2a\u6570 $w$ \u6ee1\u8db3 $w^2\\equiv K$\uff0c\u5176\u4e2d $K^{\\frac{p-1}{2}}\\equiv -1$\u3002\u56e0\u4e3a $x^2\\equiv K$ \u65e0\u89e3\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684 $w$ \u7c7b\u4f3c\u4e8e $i^2=-1$ \u7684 $i$\uff0c\u5e76\u975e\u6574\u6570\u3002\u540c\u65f6\uff0c\u7531 $w$ \u6784\u6210\u7684\u6570 $a+bw$ \u4e5f\u4e0d\u6ee1\u8db3\u6b27\u62c9\u5b9a\u7406\u7b49\uff0c\u9700\u8981\u65b0\u7684\u7ed3\u8bba\u3002 \n\n**\u7ed3\u8bba\u56db**\uff1a\u5bf9\u4e8e\u5947\u7d20\u6570 $p$\uff0c\u6709 $(a+bw)^{p+1}\\equiv a^2-b^2K\\pmod p$\u3002\n\n\u4ee5\u4e0b\u8bc1\u660e\uff1a\u7531\u4e8c\u9879\u5f0f\u5b9a\u7406\u53ef\u5f97\uff1a\n\n$$(a+bw)^{p+1}=\\sum_{i=0}^{p+1}C_{p+1}^ia^{p+1-i}(bw)^i$$\n\n\u805a\u7126\u4e8e\u7ec4\u5408\u6570 $C_{p+1}^i\\equiv\\frac{p!}{i!(p+1-i)!}$\uff0c\u53ef\u4ee5\u53d1\u73b0\u4ec5\u5728 $i=0,1,p,p+1$ \u8fd9\u56db\u4e2a\u503c\u65f6\u7ec4\u5408\u6570\u6a21 $p$ \u540e\u4e0d\u4e3a $0$\u3002\u56e0\u6b64\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$C_{p+1}^0a^{p+1-0}(bw)^0+C_{p+1}^1a^{p+1-1}(bw)^1+C_{p+1}^{p}a^{p+1-p}(bw)^p+C_{p+1}^{p+1}a^{p+1-p-1}(bw)^{p+1}$$\n\n\u5373 $a^{p+1}+a^{p}bw+ab^pw^p+b^{p+1}w^{p+1}\\equiv a^2+abw+abw^p+b^2w^{p+1}$\u3002\n\n$\\because w^2\\equiv K,K^{\\frac{p-1}{2}}\\equiv -1$\n\n$\\therefore (w^2)^{\\frac{p-1}{2}}\\equiv w^{p-1}\\equiv -1$\n\n\u4ee3\u5165\u539f\u5f0f\u5f97\uff1a$a^2-b^2w^2\\equiv a^2-b^2K$\uff0c\u8bc1\u6bd5\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u8bbe $w^2\\equiv 5$\uff0c\u5219\u901a\u9879\u516c\u5f0f\u53ef\u5199\u6210\uff1a$f_i=\\dfrac{(\\frac{p+1}{2}+\\frac{p+1}{2}w)^i-(\\frac{p+1}{2}-\\frac{p+1}{2}w)^i}{w}$\u3002\n\n\u5148\u770b $\\frac{p+1}{2}+\\frac{p+1}{2}w$\uff0c\u7531\u7ed3\u8bba\u56db\u5f97\uff1a$(\\frac{p+1}{2}+\\frac{p+1}{2}w)^{p+1}\\equiv (\\frac{p+1}{2})^2-5(\\frac{p+1}{2})^2\\equiv -1$\u3002\n\n\u6240\u4ee5 $(\\frac{p+1}{2}+\\frac{p+1}{2}w)^{2p+2}\\equiv 1$\uff0c\u540c\u7406 $(\\frac{p+1}{2}-\\frac{p+1}{2}w)^{2p+2}\\equiv 1$\u3002\n\n\u56e0\u6b64 $f_{i+2p+2}\\equiv f_i$\uff0c\u53d6 $\\pi(p)=2p+2$\u3002\n\n------------\n\n### Part 2\uff1a\n\n\u63a5\u4e0b\u6765\uff0c\u8ba8\u8bba\u6a21\u6570 $P$ \u662f**\u67d0\u4e2a\u8d28\u6570\u7684\u5e42**\u7684\u60c5\u51b5\uff0c\u8bb0 $P=p^k$\u3002\n\n**\u6ce8**\uff1aPart 2 \u7684\u8bc1\u660e\u53c2\u8003\u4e86\u90e8\u5206\u8d44\u6599\uff08\u94fe\u63a5\u89c1\u6587\u672b\uff09\u3002\n\n**\u7ed3\u8bba\u4e94**\uff1a\u5bf9\u4e8e\u8d28\u6570 $p$\uff0c\u5df2\u77e5 $a\\equiv 1\\pmod p$\uff0c\u5219 $a^{p^k}\\equiv 1\\pmod {p^{k+1}}$\u3002\n\n\u4ee5\u4e0b\u8bc1\u660e\uff1a\u8003\u8651\u6570\u5b66\u5f52\u7eb3\u6cd5\uff0c\u5047\u8bbe $k$ \u65f6\u7b49\u5f0f\u6210\u7acb\uff0c\u8bc1\u660e $k+1$ \u65f6\u7b49\u5f0f\u4e5f\u6210\u7acb\u3002\n\n\u8bbe $a^{p^{k}}=sp^{k+1}+1$\uff0c\u90a3\u4e48 $a^{p^{k+1}}=(a^{p^k})^p=(sp^{k+1}+1)^p$\u3002\n\n\u7531\u4e8c\u9879\u5f0f\u5b9a\u7406\uff1a\n\n$$(sp^{k+1}+1)^p=\\sum_{i=0}^pC_p^i(sp^{k+1})^i$$\n\n\u5f53 $i\\ge 2$ \u65f6\uff0c$p^{(k+1)i}\\bmod p^{k+2}=0$\uff0c\u53ea\u9700\u7b97\u51fa $i=0,1$ \u7684\u503c\u3002\u4ee3\u5165\u5f97 $1+sp^{k+2}\\equiv 1\\pmod {p^{k+2}}$\uff0c\u8bc1\u6bd5\u3002\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u8bb0 $\\frac{1+\\sqrt 5}{2}=u,\\frac{1-\\sqrt 5}{2}=v$\u3002\n\n**\u7ed3\u8bba\u516d**\uff1a\u5bf9\u4e8e\u8d28\u6570 $p$\uff0c\u6709 $u^{\\pi(p)}\\equiv v^{\\pi(p)}\\equiv 1\\pmod p$\u3002\n\n$\\because f_{\\pi(p)}\\equiv 0\\pmod p$\n\n$\\therefore u^{\\pi(p)}\\equiv v^{\\pi(p)}$\n\n$\\because f_{\\pi(p)+1}\\equiv 1$\n\n$\\therefore {u^{\\pi(p)}u-v^{\\pi(p)}v}\\equiv \\sqrt 5$\n\n\u4ee3\u5165 $u^{\\pi(p)}\\equiv v^{\\pi(p)}$ \u5316\u7b80\u5f97\uff1a$u^{\\pi(p)}\\equiv v^{\\pi(p)}\\equiv 1$\uff0c\u8bc1\u6bd5\u3002\n\n\u7ed3\u5408\u7ed3\u8bba\u4e94\u548c\u7ed3\u8bba\u516d\u53ef\u5f97\uff1a$u^{\\pi(p)p^{k-1}}\\equiv v^{\\pi(p)p^{k-1}}\\equiv 1\\pmod {p^k}$\u3002\n\n\u56e0\u6b64 $f_{\\pi(p)p^{k-1}}\\equiv \\frac{1}{\\sqrt 5}(u^{\\pi(p)p^{k-1}}-v^{\\pi(p)p^{k-1}})\\equiv 0\\pmod {p^k}$\u3002\n\n\u4e14 $f_{1+\\pi(p)p^{k-1}}\\equiv \\frac{1}{\\sqrt 5}(u^{\\pi(p)p^{k-1}}u-v^{\\pi(p)p^{k-1}}v)\\equiv \\frac{u-v}{\\sqrt 5}\\equiv 1\\pmod {p^k}$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff1a$f_{i+\\pi(p)p^{k-1}}\\equiv f_i\\pmod {p^k}$\uff0c\u53d6 $\\pi(p^k)=\\pi(p)p^{k-1}$\u3002\n\n------------\n\n### Part 3\uff1a\n\n\u6700\u540e\u4e00\u6b65\u4e86\uff0c\u4e5f\u662f\u6700\u7b80\u5355\u7684\u60c5\u51b5\u3002\n\n**\u7ed3\u8bba\u4e03**\uff1a\u8bbe\u6a21\u6570 $P$ \u7684\u8d28\u56e0\u6570\u5206\u89e3\u5f0f\u4e3a $\\prod p^k$\uff0c\u5219\u53ef\u53d6 $\\pi(P)=\\operatorname{lcm}(\\pi(p_i^{k_i}))$\u3002\n\n\u4ee5\u4e0b\u8bc1\u660e\uff1a\n\n$\\because f_{\\pi(P)}\\equiv 0\\pmod{p_i^{k_i}},p_i^{k_i}\\mid f_{\\pi(P)}$\n\n$\\therefore {\\pi(p_i^{k_i})}\\mid {\\pi(P)}$\n\n\u53d6 $\\pi(P)$ \u4e3a $\\pi(p_i^{k_i})$ \u7684\u6700\u5c0f\u516c\u500d\u6570\u5373\u53ef\uff0c\u8bc1\u6bd5\u3002\n\n------------\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n------------\n\n\u56de\u5230\u539f\u9898\uff0c\u5f00\u59cb\u6574\u7406\u601d\u8def\u3002\n\n1. \u5bf9 $P$ \u8fdb\u884c\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sqrt P)$\uff1b\n\n2. \u5bf9\u4e8e $P$ \u7684\u6bcf\u4e2a\u8d28\u56e0\u6570\u5206\u89e3 $p_i^{k_i}$\uff0c\u6c42\u51fa\u5bf9\u5e94\u7684\u5468\u671f\u957f $\\pi(p_i^{k_i})$\uff1b\n\n3. \u6c42\u51fa\u6bcf\u4e2a\u5468\u671f\u7684\u6700\u5c0f\u516c\u500d\u6570\uff0c\u4f5c\u4e3a $\\pi(P)$ \u7684\u503c\uff1b\n\n4. \u628a\u8bfb\u5165\u7684 $n$ \u6a21\u4ee5 $\\pi(P)$\uff0c\u7136\u540e\u77e9\u9635\u5feb\u901f\u5e42\u89e3\u51b3\u3002\n\n\u5c31\u8fd9\u6837\uff0c\u4ee3\u7801\u5728\u6b64\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#define ll long long\nusing namespace std;\n\nll FastPow(ll a, ll b, ll mod){\n    ll res = 1;\n    while(b){\n        if(b & 1) res = res * a % mod;\n        b >>= 1, a = a * a % mod;\n    }\n    return res;\n}\n\nll FastPowNoMod(ll a, ll b){\n    ll res = 1;\n    while(b){\n        if(b & 1) res = res * a;\n        b >>= 1, a = a * a;\n    }\n    return res;\n}\n\nconst int Mx = 3e7 + 10;\nint Fac[30], Tim[30], tot;\nchar N[Mx];\n\nvoid Divide(int p){ // \u5206\u89e3\u8d28\u56e0\u6570\n    for(int i = 2; i * i <= p; ++i) if(p % i == 0){\n        Fac[++tot] = i;\n        while(p % i == 0) p /= i, ++Tim[tot];\n    }\n    if(p != 1) Fac[++tot] = p, Tim[tot] = 1;\n}\n\nll PrimeLoop(ll p){ // \u6c42 pi(p)\n    if(p == 2) return 3;\n    if(p == 5) return 20;\n    if(FastPow(5, (p - 1) >> 1, p) == 1) return p - 1;\n    return 2 * p + 2;\n}\n\nll PrimePow(int id){ return FastPowNoMod(Fac[id], Tim[id] - 1) * PrimeLoop(Fac[id]);} // \u6c42 pi(p^k)\n\nll Gcd(ll a, ll b){ return b == 0 ? a : Gcd(b, a % b);}\n\nll GetLoop(){ // \u6c42 pi(P)\n    ll res = PrimePow(1), temp;\n    for(int i = 2; i <= tot; ++i) temp = PrimePow(i), res = res / Gcd(res, temp) * temp;\n    return res;\n}\n\nint P;\n\nstruct Matrix{\n    ll val[3][3];\n    Matrix operator * (const Matrix& a) const {\n        Matrix Res = (*this);\n        for(int i = 1; i <= 2; ++i) for(int j = 1; j <= 2; ++j)\n            Res.val[i][j] = (val[i][1] * a.val[1][j] % P + val[i][2] * a.val[2][j] % P) % P;\n        return Res;\n    }\n    Matrix operator *= (const Matrix& a) { return (*this) = a * (*this);}\n    Matrix operator ^ (ll k) const {\n        Matrix Res, Temp = (*this);\n        Res.val[1][1] = Res.val[2][2] = 1, Res.val[1][2] = Res.val[2][1] = 0;\n        while(k){\n            if(k & 1) Res *= Temp;\n            k >>= 1, Temp *= Temp;\n        }\n        return Res;\n    }\n} Fibo, Cell;\n\nvoid Solve(ll n){\n    if(n == 0){\n        printf(\"0\");\n        return;\n    }\n\tFibo.val[1][1] = 0, Fibo.val[2][1] = Fibo.val[1][2] = Fibo.val[2][2] = 1;\n\tCell.val[1][1] = 1, Cell.val[1][2] = 1;\n    Matrix Res = Cell * (Fibo ^ (n - 1));\n    printf(\"%lld\", Res.val[1][1] % P);\n}\n\nint main(){\n    scanf(\" %s %d\", N, &P);\n    if(P == 1){\n        printf(\"0\");\n        return 0;\n    }\n    Divide(P);\n    ll Loop = GetLoop(), n = 0;\n    int Len = strlen(N);\n    for(int i = 0; i < Len; ++i) n = (n * 10 + (N[i] ^ 48)) % Loop;\n    Solve(n);\n    return 0;\n}\n```\n\n------------\n\n#### \u53c2\u8003\u8d44\u6599\uff1a\n\n- [Pisano Period](https://www.cnblogs.com/cjoierShiina-Mashiro/p/11385287.html)\n\n- [The Period of the Fibonacci Sequence Modulo j\n](https://gradprogram.math.arizona.edu/~ura-reports/071/Campbell.Charles/Final.pdf)",
        "postTime": 1649655277,
        "uid": 375984,
        "name": "\u98de\u96e8\u70df\u96c1",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4000 \u3010\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3011"
    },
    {
        "content": "\u601d\u8def\u6765\u81ea @jklover orz \u3002\n\n\u6709\u7ed3\u8bba\uff0c\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u5faa\u73af\u8282\u7684\u4e0a\u754c\u4e3a $6p$ \u3002\u8003\u8651\u77e9\u9635\u52a0\u901f\uff0c\u8bbe\u6590\u6ce2\u90a3\u5951\u7684\u7b2c $i$ \u9879\u548c\u7b2c $i + 1$ \u9879\u6784\u6210\u7684\u77e9\u9635\u4e3a $A _ i$ \uff0c\u8f6c\u79fb\u77e9\u9635\u4e3a $B$ \u3002\u5982\u679c\u6709\u5faa\u73af\u8282 $k$ \uff0c\u90a3\u4e48\u6709 $A _ 1 B ^ k = A _ 1 \\bmod p$ \u3002$A, B$ \u663e\u7136\u90fd\u662f\u5b58\u5728\u9006\u7684\uff0c\u90a3\u4e48 $B ^ k = I$ \uff0c\u5176\u4e2d $I$ \u8868\u793a\u5355\u4f4d\u77e9\u9635\u3002\u8fd9\u6837\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a BSGS \u7684\u6807\u51c6\u5f62\u5f0f\u3002\u7528 BSGS \u53ef\u4ee5\u5728 $O(\\sqrt p \\log \\sqrt p)$ \u7684\u65f6\u95f4\u5185\u89e3\u5f97 $k$ \u3002\u7136\u540e\u76f4\u63a5\u77e9\u9635\u52a0\u901f\u5373\u53ef\u3002\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <array>\n#include <map>\n#include <cstring>\nusing namespace std;\ntemplate <class Type>\nvoid read (Type &x)\n{\n    char c;\n    bool flag = false;\n    while ((c = getchar()) < '0' || c > '9')\n        c == '-' && (flag = true);\n    x = c - '0';\n    while ((c = getchar()) >= '0' && c <= '9')\n        x = (x << 1) + (x << 3) + c - '0';\n    flag && (x = ~x + 1);\n}\ntemplate <class Type, class ...rest>\nvoid read (Type &x, rest &...y) { read(x), read(y...); }\ntemplate <class Type>\nvoid write (Type x)\n{\n    x < 0 && (putchar('-'), x = ~x + 1);\n    x > 9 && (write(x / 10), 0);\n    putchar('0' + x % 10);\n}\nconst int N = 2, M = 3e7 + 10;\ntypedef long long LL;\ntypedef array<array<int, N>, N> Matrix;\nint p;\nMatrix operator * (const Matrix &a, const Matrix &b)\n{\n    Matrix res;\n    for (int i = 0; i < N; ++i)\n        for (int j = 0; j < N; ++j)\n        {\n            res[i][j] = 0;\n            for (int k = 0; k < N; ++k)\n                res[i][j] = (res[i][j] + (LL)a[i][k] * b[k][j]) % p;\n        }\n    return res;\n}\nMatrix binpow (Matrix b, LL k)\n{\n    Matrix res;\n    for (int i = 0; i < N; ++i)\n        for (int j = 0; j < N; ++j)\n            res[i][j] = i == j;\n    for (; k; k >>= 1, b = b * b)\n        if (k & 1) res = res * b;\n    return res;\n}\nLL BSGS (Matrix A, Matrix B)\n{\n    int k = sqrt(p * 6ll) + 1;\n    map <Matrix, int> H;\n    Matrix s = B;\n    for (int i = 0; i < k; ++i, s = s * A) H[s] = i;\n    Matrix t = binpow(A, k);\n    s = t;\n    for (int i = 1; i <= k; ++i, s = s * t)\n        if (H.count(s)) return (LL)i * k - H[s];\n    return -1;\n}\nchar str[M];\nint main ()\n{\n    scanf(\"%s\", str);\n    read(p);\n    Matrix A, B;\n    A[0][0] = A[0][1] = A[1][0] = 1, A[1][1] = 0;\n    B[0][0] = B[1][1] = 1, B[0][1] = B[1][0] = 0;\n    LL mod = BSGS(A, B);\n    int len = strlen(str);\n    LL n = 0;\n    for (int i = 0; i < len; ++i)\n        n = (n * 10ll + str[i] - '0') % mod;\n    write(binpow(A, n)[1][0]);\n    return 0;\n}\n```",
        "postTime": 1658406617,
        "uid": 185726,
        "name": "RuSun",
        "ccfLevel": 8,
        "title": "Solution P4000"
    },
    {
        "content": "\u9898\u610f:\n\n\u6c42 $fib_n$\uff0c $n \\leq 10^{30000000}$\uff0c $mod < 2^{31}$\n\n~~\u8bf6\u597d\u96be\uff0c\u5f03\u4e86~~\n\n\u5173\u4e8e\u8fd9\u9898\u7684\u4e00\u4e2a\u91cd\u8981\u7ed3\u8bba\uff1a$fib$ \u7684\u5faa\u73af\u8282\u4e0d\u4f1a\u8d85\u8fc7 $6 \\times mod$\u3002\n~~\uff08\u8bb0\u4f4f\u8fd9\u4e2a\u662f\u5faa\u73af\u8282\u800c\u4e0d\u662f\u5355\u4e2a\u6570\u3002\uff09~~\n\n\u7136\u540e\u600e\u4e48\u627e\u5faa\u73af\u8282\u5462\uff1f\n\n\u9996\u5148\u4ecb\u7ecd\u4e00\u4e0b\u751f\u65e5\u6096\u8bba\u3002\n\n\u8bbe $E(n)$ \u4e3a $n$ \u4e2a\u4eba\u4e2d\u4e24\u4e2a\u4eba\u751f\u65e5\u76f8\u540c\u7684\u6982\u7387\u3002\n\n$E(n) = 1-\\prod_{i=1}^{n-1}(\\frac{365-i}{365})$\n\n\u53d1\u73b0 $n = 23$ \u7684\u65f6\u5019\u8fd9\u4e2a $E(23) \\geq \\frac{1}{2}$ \u4e86\u3002\n\n\u540c\u6837\u751f\u65e5\u6096\u8bba\u7528\u5230\u8fd9\u9898\u4e0a\uff0c\u4e24\u4e2a\u6570\u91cd\u590d\u7684\u6982\u7387\u76f8\u5f53\u5927\u3002\n\n\u6211\u4eec\u7528\u5149\u901f\u4e58\u7684\u529e\u6cd5\u5904\u7406\u77e9\u9635\u3002\n\n\u7136\u540e\u5c31\u6ca1\u4e86\uff1f\n\n```cpp\n#include <bits/stdc++.h>\nstd::mt19937_64 rnd(time(0));\nint mod;\nconst int MX = 1 << 18;\nstruct matrix {\n\tlong long a[2][2];\n\tmatrix() {\n\t\tmemset(a, 0, sizeof(a));\n\t}\n\tlong long * operator [](int x) {\n\t\treturn a[x];\n\t}\n\tfriend matrix operator * (matrix a, matrix b) {\n\t\tmatrix res;\n\t\tfor (int i = 0; i < 2; i++) {\n\t\t\tfor (int j = 0; j < 2; j++) {\n\t\t\t\tfor (int k = 0; k < 2; k++) {\n\t\t\t\t\tres[i][j] += a[i][k] * b[k][j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (int i = 0; i < 2; i++) {\n\t\t\tfor (int j = 0; j < 2; j++) {\n\t\t\t\tres[i][j] %= mod;\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n} T[2][1 << 18 | 1];\nint main() {\n\tstd::ios_base::sync_with_stdio(false);\n\tstd::cin.tie(nullptr);\n\tstd::string s;\n\tstd::cin >> s;\n\tstd::cin >> mod;\n\tT[0][0][0][0] = T[0][0][1][1] = 1;\n\tT[1][0][0][0] = T[1][0][1][1] = 1;\n\tT[0][1][0][1] = T[0][1][1][0] = T[0][1][1][1] = 1;\n\tfor (int i = 2; i <= MX; i++) {\n\t\tT[0][i] = T[0][i - 1] * T[0][1];\n\t}\n\tT[1][1] = T[0][MX];\n\tfor (int i = 2; i <= MX; i++) {\n\t\tT[1][i] = T[1][i - 1] * T[1][1];\n\t}\n\tstd::map <unsigned long long, long long> loop;\n\tlong long length = 0;\n\twhile (true) {\n\t\tlong long a = (rnd() << 28 >> 28);\n\t\tmatrix res = T[0][a & (MX - 1)] * T[1][a >> 18];\n\t\tunsigned long long val = ((1ull * res[0][0]) << 32ull) | res[0][1];\n\t\tif (loop.find(val) != loop.end()) {\n\t\t\tlength = std::abs(loop[val] - a);\n\t\t\tbreak;\n\t\t}\n\t\tloop[val] = a;\n\t}\n\tlong long n = 0;\n\tfor (char c : s) {\n\t\tn = (n * 10 + (c ^ '0')) % length;\n\t}\n\tstd::cout << (T[0][n & (MX - 1)] * T[1][n >> 18])[0][1] << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1592285542,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4000 \u3010\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3011"
    },
    {
        "content": "\u5927\u5bb6\u597d\uff0c\u6211\u662f\u4e00\u4e2a\u975e\u5e38\u559c\u6b22\u5361\u5e38\u7684\u6bd2\u7624\uff0c\u56e0\u6b64\u6211\u7528\u66b4\u529b\u901a\u8fc7\u4e86\u8fd9\u9053\u9898(\u800c\u4e14\u6bd4\u4e0d\u5c11\u4eba\u7684\u6b63\u89e3\u8dd1\u7684\u8fd8\u5feb)\n\n\u63d0\u4ea4\u8bb0\u5f55\n\n[Link](https://www.luogu.com.cn/record/95907487)\n\n\u8fd9\u9053\u9898\u6b63\u5e38\u7684\u89e3\u6cd5\u5e94\u8be5\u662f\u751f\u65e5\u6096\u8bba+\u54c8\u5e0c\u5224\u91cd\u6216\u8005\u6570\u8bba\u76f4\u63a5\u8ba1\u7b97\u5faa\u73af\u8282\u3002\n\n\u8ba1\u7b97\u5faa\u73af\u8282\u7684\u590d\u6742\u5ea6\u4e3a $O(\\sqrt p)$ \u6216\u8005 $O(p^{1/4})$ ,\u53d6\u51b3\u4e8e\u4f60\u4f7f\u7528\u7684\u8d28\u56e0\u6570\u5206\u89e3\u7b97\u6cd5\u3002\n\n\u5982\u679c\u4f7f\u7528\u751f\u65e5\u6096\u8bba+\u54c8\u5e0c\u5224\u91cd\uff0c\u7531\u4e8e\u5faa\u73af\u8282\u4e0d\u8d85\u8fc7 $6p$ ,\u9884\u5904\u7406\u5373\u53ef\u505a\u5230 $O(\\sqrt p)$ \u3002\n\n\u4f46\u8bfb\u5165\u5e76\u53d6\u6a21\u7684\u590d\u6742\u5ea6\u5c31\u5df2\u7ecf\u8fbe\u5230\u4e86 $O(\\log{n})$ \u7684\u7ea7\u522b\uff0c\u800c\u6211\u4eec\u6ce8\u610f\u5230\u76f4\u63a5\u4f7f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97\u590d\u6742\u5ea6\u4e5f\u662f $O(\\log{n})$ ,\u4e4b\u6240\u4ee5\u5361\u4e0d\u8fc7\u662f\u56e0\u4e3a\u5e38\u6570\u592a\u5927\u3002\n\n\u6211\u4eec\u6765\u8003\u8651\u600e\u4e48\u5361\u5e38\u3002\n\n\u9996\u5148\u5bf9\u4e8e\u8fd9\u4e2a\u8f93\u5165\u683c\u5f0f\u6765\u8bf4\u5fc5\u987b\u91c7\u7528\u5341\u8fdb\u5236\u4e0b\u7684\u77e9\u9635\u5feb\u901f\u5e42\uff0c\u56e0\u4e3a\u8f6c\u6362\u5230\u4e8c\u8fdb\u5236\u590d\u6742\u5ea6\u4e3a $O(\\log^2n)$ \u590d\u6742\u5ea6\u4e0a\u5b8c\u5168\u65e0\u6cd5\u63a5\u53d7\u3002\n\n\u77e9\u9635\u4e58\u6cd5\u672c\u8eab\u5e38\u6570\u662f\u975e\u5e38\u5927\u7684\uff0c\u4f46\u5bf9\u4e8e\u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u6570\u5217\u8fd9\u4e2a\u7279\u6b8a\u60c5\u51b5\u6765\u8bf4\u5e76\u4e0d\u9700\u8981\u4e00\u4e2a\u771f\u6b63\u7684\u77e9\u9635\u4e58\u6cd5\u3002\n\n\u8fd9\u4e2a\u77e9\u9635\u4e2d\u6052\u6709 $F_{12}=F_{21}$ \u56e0\u6b64\u6211\u4eec\u8003\u8651\u628a\u8fd9\u4e24\u4e2a\u7f29\u6210\u4e00\u4e2a\u5e76\u53bb\u9664\u5faa\u73af \u8fd9\u6837\u5c31\u80fd\u4f18\u5316\u63891/4\u7684\u8ba1\u7b97\u5e38\u6570\u548c\u6c27\u6c14\u4e0b\u81ea\u52a8\u5c55\u5f00\u7684\u5faa\u73af\u5e38\u6570\u3002\n\n\u4f46\u662f\u8fd8\u662f\u65e0\u6cd5\u901a\u8fc7\u3002\n\n\u628a\u53d6\u6a21\u53bb\u6389\u76f4\u63a5\u8ba1\u7b97\uff0c\u5c45\u7136\u6ca1\u6709T\u6389\u800c\u4e14\u8dd1\u7684\u76f8\u5f53\u5feb(\u4e0d\u8fc7\u5168wa\u4e86)\uff0c\u663e\u7136\u5de8\u5927\u7684\u5e38\u6570\u6765\u81ea\u53d6\u6a21\u64cd\u4f5c\uff0c\u7531\u4e8e\u6a21\u6570\u53ef\u53d8\uff0c\u7f16\u8bd1\u5668\u65e0\u6cd5\u4f18\u5316\u53d6\u6a21\u8fd0\u7b97\uff0c\u53d6\u6a21\u8fd0\u7b97\u7684\u5de8\u5927\u5e38\u6570\u66b4\u9732\u65e0\u7591\u3002\n\n\u56e0\u6b64\u8003\u8651\u4f18\u5316\u53d6\u6a21\u64cd\u4f5c\uff0c\u5bf9\u4e8e\u56fa\u5b9a\u7684\u6a21\u6570\uff0cbarret\u7ea6\u51cf\u975e\u5e38\u9002\u5408\u4f18\u5316(\u5bf9\u4e8e\u56fa\u5b9a\u6a21\u6570\u7f16\u8bd1\u5668\u5c31\u662f\u91c7\u7528\u4e86barret\u7ea6\u51cf\u8fdb\u884c\u4f18\u5316)\uff0cbarret\u7ea6\u51cf\u5728\u9884\u5904\u7406\u540e\u4f7f\u7528\u4e00\u6b21\u4e58\u6cd5\u4e0e\u4e00\u6b21\u4f4d\u79fb\u4ee3\u66ff\u9664\u6cd5\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u8db3\u4ee5\u901a\u8fc7\u4e86\u3002\n\n\u6700\u540e\u989d\u5916\u4f18\u5316\uff1a\n\n\u5b9e\u9645\u4e0a\uff0c\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5373\u53ef\u8868\u793a\u8fd9\u4e2a\u77e9\u9635\u4e58\u6cd5\u3002\n\n\u6211\u4eec\u4ee4$f_n$\u8868\u793a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u7b2cn\u9879\uff0c\u5219\u6709:\n\n$(f_{n+m},f_{n+m-1})=(f_n{\\times}f_m+f_n{\\times}f_{m-1}+f_m{\\times}f_{n-1},f_n{\\times}f_m+f_{n-1}{\\times}f_{m-1})$\n\n\u8bc1\u660e\u53ef\u4ee5\u901a\u8fc7\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u901a\u9879\u516c\u5f0f\u3002\n\n\u5faa\u73af\u5c55\u5f00\u4e5f\u53ef\u4ee5\u8fdb\u4e00\u6b65\u4f18\u5316\u5e38\u6570\u3002\n\nCode:\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef unsigned long long ll;\nstruct barret{//barret\u7ea6\u51cf \u52a0\u901f\u5927\u91cf\u9664\u6cd5\n\ttypedef unsigned __int128 lll;\n\ttypedef unsigned long long ll;\n\tll m;//m \u4e3a\u53d6\u6a21\u53c2\u6570\n\tint p;//p \u8868\u793a\u4f7f\u7528\u7684\u6a21\u6570\n    int c;//c \u4e3a\u53e6\u4e00\u4e2a\u53d6\u6a21\u53c2\u6570\n    inline void init(int t){\n\t\tc=31+2*ceil(log2(t)),p=t,m=(ll((lll(1)<<c)/t))+1;\n\t}\n    friend inline ll operator % (ll n,const barret &d) {\n\t\treturn n-((lll(n)*d.m)>>d.c)*d.p;\n\t}//return n%d\n}modp;\nconst int maxlgn=3e7+20;\nint p;\nchar buf[maxlgn];\nint len,rlen;\nvoid qread(){\n\tlen=fread(buf,1,maxlgn,stdin);\n\trlen=len;\n    while (buf[rlen]>'9'||buf[rlen]<'0'){rlen--;}\n\twhile(rlen--){\n\t\tif(buf[rlen]>'9'||buf[rlen]<'0'){\n\t\t\tdo{rlen--;}while(buf[rlen]>'9'||buf[rlen]<'0');\n\t\t\tbreak;\n\t\t}\n\t}\n\tint now=rlen;\n\tchar _ch=buf[++now];\n\twhile (_ch>'9'||_ch<'0'){_ch=buf[++now];}\n\twhile(_ch<='9'&&_ch>='0'){p=p*10+(_ch-48);_ch=buf[++now];}\n}//fread\u8bfb\u5165 \u4e0escanf\u8bfb\u5165\u76f8\u6bd4\u5927\u6982\u5feb\u4e8650ms\u5de6\u53f3\n\nstruct node{\n\tll x1,x2;\n};\nconst node e={0,1};//\u5355\u4f4d\u5143\nconst node fib={1,0};//\u7b2c\u4e00\u9879\n\ninline node operator * (const node &a,const node &b){\n\treturn {(a.x1*b.x1+a.x1*b.x2+a.x2*b.x1)%modp,(a.x1*b.x1+a.x2*b.x2)%modp};\n}//\u4e58\u6cd5\u64cd\u4f5c\n\nnode pow10w[10005]={e,fib};\n\nvoid init(){\n\tmodp.init(p);\n\tfor(int i=2;i<=10000;++i){\n\t\tpow10w[i]=pow10w[i-1]*fib;\n        //cout<<pow10w[i].x1<<\" \"<<pow10w[i].x2<<endl;\n\t}\n}//\u521d\u59cb\u5316modp \u9884\u5904\u74061~10000\u7684\u7b54\u6848\n\nll count(){\n\tif(p==1){return 0;}//p==1\u7279\u5224\n\tnode ans=e;\n\tint nlen=(rlen/4)*4;\n\tfor(int i=0;i<nlen;i+=4){\n\t\tnode mid=ans*ans;\n\t\tmid=mid*mid;mid=mid*mid;ans=mid=mid*mid;//ans=mid=ans^16\n\t\tmid=mid*mid;mid=mid*mid;mid=mid*mid;mid=mid*mid;//mid=ans^256\n\t\tans=ans*mid;//ans=ans^272\n\t\tmid=mid*mid;//mid=ans^512\n\t\tans=ans*mid;//ans=ans^784\n\t\tmid=mid*mid;//mid=ans^1024\n\t\tans=ans*mid;//ans=ans^2008\n\t\tmid=mid*mid;mid=mid*mid;mid=mid*mid;//mid=ans^8192\n\t\tans=ans*mid;//ans=ans^10000\n\t\tans=ans*pow10w[(buf[i]-48)*1000+(buf[i+1]-48)*100+(buf[i+2]-48)*10+(buf[i+3]-48)];\n\t}//\u5faa\u73af\u5c55\u5f00\n\tfor(int i=nlen;i<=rlen;++i){\n\t\tnode mid=ans*ans;//mid=ans^2\n\t\tans=mid;//ans=ans^2\n\t\tmid=mid*mid;mid=mid*mid;//mid=ans^8\n\t\tans=ans*mid;//ans=ans^10\n\t\tans=ans*pow10w[buf[i]^48];\n\t}//\u5904\u7406\u672b\u5c3e\u7684\u5269\u4f59\u90e8\u5206\n\treturn ans.x1;\n}\nint main(){\n\tqread();\n\t//scanf(\"%s %d\",buf,&p);\n\tinit();\n\tprintf(\"%lld\",count());\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1672069093,
        "uid": 746640,
        "name": "Pulsating_Dust",
        "ccfLevel": 7,
        "title": "fib(10^30000000)"
    },
    {
        "content": "\u8003\u8651\u91c7\u7528\u4e00\u4e2a\u5b66\u672f\u754c\u5c1a\u672a\u88ab\u8bc1\u660e\u4f46\u662f\u6570\u636e\u8303\u56f4\u5185\u662f\u6b63\u786e\u7684\u5f15\u7406\uff1a\u5bf9\u4e8e\u6a21\u6570\u4e3a\u8d28\u6570\u7684\u5e42\u7684\u60c5\u51b5\uff0c\u8bbe\u5468\u671f\u4e3a $ f(p^k) $\uff0c\u5219 $ f(p^k)=f(p) \\times p^{k-1} $\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u5bf9\u8fd9\u4e2a\u6570\u8d28\u56e0\u6570\u5206\u89e3\u4e4b\u540e\u5206\u522b\u6c42\u51fa\u5468\u671f\u4e4b\u540e\u53d6 $\\operatorname{lcm}$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e $ f(p) $ \u7684\u6c42\u6cd5\uff1a\u5f53 $ p \\bmod 10 = 1 $ \u6216\u8005 $ p \\bmod 10 = 9 $ \u65f6\u8ba1\u7b97 $ f(x-1) $\uff0c\u5426\u5219\u8ba1\u7b97 $ 2 \\times (p+1) $ \uff0c\u53ef\u77e5\u8fd9\u6837\u5f97\u5230\u7684\u7ed3\u679c\u4e00\u5b9a\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u4e00\u4e2a\u5faa\u73af\u8282\uff08\u4f46\u4e0d\u4e00\u5b9a\u662f\u6700\u5c0f\u5faa\u73af\u8282\uff09\uff0c\u7136\u540e\u66b4\u529b\u679a\u4e3e\u6240\u6709\u53ef\u884c\u7684\u8d28\u56e0\u5b50\u5206\u89e3\uff0c\u5982\u679c\u5faa\u73af\u8282\u5185\u5305\u542b\u66f4\u5c0f\u7684\u5faa\u73af\u8282\u5219\u66f4\u65b0\u7b54\u6848\uff0c\u6ce8\u610f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u503c\u3002\n\n\u5176\u4ed6\u7684\u9898\u89e3\u7528\u7684\u8d28\u56e0\u6570\u5206\u89e3\u90fd\u662f $ \\mathcal{O}(\\sqrt{p}) $ \u7684\uff0c\u5176\u5b9e\u53ef\u4ee5\u7528 Pollard-rho \u7b97\u6cd5\u505a\u5230\u66f4\u5feb\u5730\u8fdb\u884c\u8d28\u56e0\u6570\u5206\u89e3\u4e4b\u540e\u8ba1\u7b97\u5faa\u73af\u8282\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u4f18\u5316\u5230 $ \\mathcal{O}(p^{1/4}) $\u3002\uff08\u5176\u5b9e\u6709\u4e00\u7bc7\u9898\u89e3\u4e5f\u662f\u8fd9\u4e2a\u505a\u6cd5\uff0c\u4f46\u611f\u89c9\u6ca1\u8bb2\u6e05\u695a\uff09\n\n\u6700\u540e\u76f4\u63a5\u628a\u9879\u6570\u5bf9\u6700\u5c0f\u5faa\u73af\u8282\u53d6\u6a21\u540e\u505a\u4e00\u904d\u6b63\u5e38\u7684\u77e9\u9635\u5feb\u901f\u5e42\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define gc c=getchar()\n#define r(x) read(x)\n#define ll long long\n#define int long long\ntemplate<typename T>\ninline void read(T&x)\n{\n    x=0;T k=1;char gc;\n    while(!isdigit(c)){if(c=='-')k=-1;gc;}\n    while(isdigit(c)){x=x*10+c-'0';gc;}x*=k;\n}\n#define li inline\n#define re register\ninline int add(int a,int b,int p)\n{\n\ta+=b;\n\tif(a>=p)\n    \ta-=p;\n\treturn a;\n}\ninline int mul(int a,int b,int mod)\n{\n\treturn a*b%mod;\n}\nll pow(ll a, ll b, ll m) \n{\n  ll ans = 1;\n  for (a %= m; b; b >>= 1, a = mul(a, a, m))\n    if (b & 1) \n    \tans = mul(ans, a, m);\n  return ans;\n}\nll gcd(ll a,ll b)\n{\n\treturn b?gcd(b,a%b):a;\n}\nll lcm(ll a,ll b)\n{\n\treturn a/gcd(a,b)*b;\n}\nbool MR_check(ll a, ll p, ll s, int d) \n{\n  ll k = pow(a, s, p);\n  if (k == 1) \n  \treturn true;\n  for (; d; --d, k = mul(k, k, p)) \n  {\n    if (k == p - 1) \n    \treturn true;\n    if (k == 1) \n    \treturn false;\n  }\n  return k == 1;\n}\nbool MR(ll x) \n{\n  static const int cnt = 12;\n  static const int p[cnt] = { 2, 3, 5, 7, 11, 13, 17, 19, 61, 2333, 4567, 24251 };\n  if (x == 1) \n  \treturn false;\n  ll s = x - 1; \n  int d = 0;\n  while (!(s & 1)) \n  \t++d, s >>= 1;\n  for (int i = 0; i < cnt; ++i) \n  {\n    if (x % p[i] == 0) \n    \treturn x == p[i];\n    if (!MR_check(p[i], x, s, d)) \n    \treturn false;\n  }\n  return true;\n}\nnamespace Pollard_Rho \n{\nll PR_check(ll c, ll p) \n{\n  ll y = rand() % p, z = y;\n  int k = 1, j = 0;\n  while(1145141919810) \n  {\n    z = (mul(z, z, p) + c) % p;\n    ll t = gcd(p, std::abs(z - y));\n    if (t > 1) \n    \treturn t;\n    if (++j == k) \n    \ty = z, k <<= 1;\n  }\n}\nvoid factor_(ll x, std::vector<ll> &v) \n{\n  if (x == 1) \n  return;\n  if (MR(x)) { v.push_back(x); return; }\n  ll y = x;\n  while (y == x) y = PR_check(rand() % x, x);\n  factor_(y, v);\n  factor_(x / y, v);\n}\nvoid factor(ll x, std::vector<ll> &v) \n{\n  v.clear();\n  if (!(x & 1)) { v.push_back(2); x /= (x & -x); }\n  factor_(x, v);\n  std::sort(v.begin(), v.end());\n  v.erase(std::unique(v.begin(), v.end()), v.end());\n}\n}\nusing Pollard_Rho::factor;\nstruct fib \n{\n  ll a, b; \n  fib(ll a, ll b) : a(a), b(b) {}\n};\nfib mul(const fib &u, const fib &v, ll m) \n{\n  ll x = mul(u.a, v.a, m), y = mul(u.b, v.b, m),\n     z = mul(u.a + u.b, v.a + v.b, m);\n  return fib((x + y) % m, (z - x + m) % m);\n}\nbool check_period(ll d, ll m) \n{\n  fib ans(1, 0), a(0, 1);\n  for (; d; d >>= 1, a = mul(a, a, m))\n    if (d & 1) ans = mul(ans, a, m);\n  return ans.a == 1 && ans.b == 0;\n}\ninline int query(int x)\n{\n\tif(x==2)\n    \treturn 3;\n\tif(x==3)\n    \treturn 8;\n\tif(x==5)\n    \treturn 20;\n\tll t = (x % 10 == 1 || x % 10 == 9) ? x - 1 : 2 * (x + 1);\n  \tvector<ll> d;\n  \tfactor(t, d);\n  \tfor (auto g : d)\n    \twhile (!(t % g) && check_period(t / g, x))\n      \tt /= g;\n  \treturn t;\n}\ninline ll solve(int n)\n{\n\tll ans=1;\n    \tvector<int>d;\n    \tfactor(n, d);\n    \tfor(auto res:d)\n    \t{\n    \tint p=1;\n    \twhile(n%res==0)\n    \tn/=res,p*=res;\n    \tans=lcm(ans,p/res*query(res));\n    \t}\n\treturn ans;\n}\nsigned main()\n{\n    ios::sync_with_stdio(0);\n    string s;\n    int p;\n    cin>>s>>p;\n    n=2;\n    m=p;\n    int per=solve(p);\n    f.g[1][1]=1;f.g[1][2]=1;\n    f.g[2][1]=1;f.g[2][2]=0;\n    for(int i=0;i<s.size();i++)\n    k*=10,k+=(s[i]-'0'),k%=per;\n    if(k==0)\n    k+=per;\n    solve();\n}\n```\n",
        "postTime": 1661357799,
        "uid": 714821,
        "name": "loser_seele",
        "ccfLevel": 4,
        "title": "P4000\u9898\u89e3"
    },
    {
        "content": "\n\u6700\u7ec8\u6838\u5fc3\u4ee3\u7801\u53ea\u6709\u8fd9\u4e00\u5c0f\u6bb5\u3002\u56e0\u5b50\u5206\u89e3\u53ef\u4ee5\u7528Pollard-Rho\uff0c\u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u6570\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u3002\u522b\u7684\u6ca1\u6709\u7279\u522b\u9ad8\u7ea7\u7684\u7b97\u6cd5\u3002\n\n```c\n\nconst unsigned long long Rest[6] = {0, 1, 3, 8, 6, 20};\n\nunsigned long long g(unsigned long long p)\n{\n    if (p <= 5)\n    {\n        return Rest[p];\n    }\n    if (p % 5 == 1 || p % 5 == 4)\n    {\n        return p - 1;\n    } else\n    {\n        return (p + 1) << 1;\n    }\n}\n\nstruct prime\n{\n    unsigned long long p;\n    int times;\n};\n\nstruct prime pp[2048];\nint pptop;\n\nunsigned long long get_cycle_from_mod(unsigned long long mod)\n{\n    pptop = 0;\n    unsigned long long n = mod;\n    srand(time(nullptr));\n    while (n != 1)\n    {\n        __int128_t factor = (__int128_t) 10000000000 * 10000000000;\n        min_factor(n, &factor);\n        struct prime temp;\n        temp.p = factor;\n        temp.times = 0;\n        while (!(n % factor))\n        {\n            n /= factor;\n            temp.times++;\n        }\n        pp[pptop] = temp;\n        pptop++;\n    }\n    unsigned long long m = 1;\n    int it;\n    for (it = 0; it < pptop; ++it)\n    {\n        m = lcm(m, g(pp[it].p) * qpow2(pp[it].p, (unsigned long long) pp[it].times - 1));\n    }\n    return m;\n}\n\n```\n\n\u539f\u7406\u8fd8\u662f\u5bfb\u627e\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u5faa\u73af\u8282\u3002\u53ea\u662f\uff0c\u4e0d\u5f3a\u6c42\u53bb\u5bfb\u627e\u6700\u5c0f\u5faa\u73af\u8282\uff0c\u800c\u662f\u627e\u5230\u4e00\u4e2a\u4e0d\u592a\u5927\u7684\u5faa\u73af\u8282\u5c31\u591f\u4e86\u3002\n\n\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u5faa\u73af\u8282\uff08\u53d6\u6a21\u610f\u4e49\u4e0b\uff09\u79f0\u4e3a\u201c\u76ae\u8428\u8bfa\u5468\u671f\u201d[OEIS A001175](http://oeis.org/A001175)\uff0c\u5f88\u5bb9\u6613\u5728OEIS\u4e0a\u627e\u5230\u3002\u66f4\u591a\u5185\u5bb9\u53ef\u4ee5\u53c2\u89c1OEIS\u3002\n\n\u6700\u7ec8\u7528\u5230\u7684\u9ad8\u7ea7\u7ed3\u8bba\u67093\u6761\u3002\u8bc1\u660e\u8fd9\u4e9b\u7ed3\u8bba\u9700\u8981\u7528\u5230\u4e8c\u6b21\u5269\u4f59\u3002\u540e\u4e24\u6761\u5370\u8c61\u91cc\u662f\u300a\u547d\u9898\u4eba\u8bb2\u5ea7\u00b7\u521d\u7b49\u6570\u8bba\u300b\uff08\u51af\u5fd7\u521a\u8457\uff09\u67d0\u7ae0\u7684\u4f8b\u9898\u3002\u8fd9\u4e66\u6682\u65f6\u4e0d\u5728\u624b\u5934\u2026\u2026\n\n**\u5982\u679cM\u662f\u6a21$p^{k-1}$\u7684\u5468\u671f\uff0c\u90a3\u4e48Mp\u662f\u6a21$p^k$\u7684\u5468\u671f\u3002**\n\n**\u5bf9\u4e8e$p\\equiv 1,4 \\pmod 5$\uff0cp-1\u662f\u6a21$p$\u7684\u5468\u671f\u3002**\n\n**\u5bf9\u4e8e$p\\equiv 2,3 \\pmod 5$\uff0c2p+2\u662f\u6a21$p$\u7684\u5468\u671f\u3002**\n\n\u6ce8\u610f\uff1a\u8fd9\u91cc\u7684\u5468\u671f\u90fd\u4e0d\u4e00\u5b9a\u662f\u6700\u5c0f\u5468\u671f\u3002\n\n\u7136\u540e\u7b14\u7b97\uff08\u6216\u53e3\u7b97\uff09\u5c31\u80fd\u77e5\u9053\u6a215\u7684\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6700\u5c0f\u5468\u671f\u662f20\u3002\u8fd9\u4e2a\u5c31\u7b97\u4f5c\u5e38\u8bc6\uff0c\u4e0d\u80fd\u7b97\u4f5c\u9ad8\u7ea7\u7ed3\u8bba\u4e86\u3002\n",
        "postTime": 1628010419,
        "uid": 343167,
        "name": "Great_designer",
        "ccfLevel": 0,
        "title": "\u6700\u7ec8\u6574\u7406\u6210C\u8bed\u8a00\u901a\u8fc7\u4e86\u672c\u9898"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8\u3002](https://www.luogu.com.cn/problem/P4000)\n\n#### \u601d\u8def\n\n\u9996\u5148\u4f60\u9700\u8981\u77e5\u9053[\u4ec0\u4e48\u662fpisano\u5468\u671f](https://oi-wiki.org/math/combinatorics/fibonacci/)\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6590\u6ce2\u90a3\u5951\u6570 $n$\uff0c\u6211\u4eec\u6c42 $n$ \u6570\u6a21 $p$ \u7684\u6700\u5c0f\u5faa\u73af\u8282 $f(n)$ \u65b9\u6cd5\u5982\u4e0b\u3002\n\n\u628a $n$ \u8d28\u56e0\u5b50\u5206\u89e3\uff0c\u5373 $n=\\prod p_i^{\\alpha_i}$\u3002\n\n\u6709 $f(n)=\\operatorname{lcm}(f(p_i^{\\alpha_i}))$\u3002\n\n\u8fd9\u4e2a\u5f88\u597d\u8bc1\u660e\uff1a\n\n\u6839\u636e\u6027\u8d28\uff0c$Fib_{f(n)}\\equiv 0 \\pmod p\\Leftrightarrow \\forall i\\in[1,s],Fib_{f(n)}\\equiv 0 \\pmod {p_i^{\\alpha_i}}$ \n\n\u56e0\u6b64 $\\forall i\\le s,f(p_i^{\\alpha_i})|f(n)$\u3002\n\n\u6240\u4ee5\u6709 $f(n)=\\operatorname{lcm}(f(p_i^{\\alpha_i}))$\u3002\n\n\u6709\u4e00\u4e2a\u7384\u5b66\u7684\u5b9a\u7406\uff0c$f(n)=f(p_i)\\times p_i^{\\alpha_i-1}$\u3002\n\n\u5bf9\u4e8e $f(n)$ \u6c42\u6211\u4eec\u5229\u7528\u5982\u4e0b\u5b9a\u7406\uff1a\u5047\u5982 $5$ \u662f\u6a21 $p$ \u7684\u4e8c\u6b21\u5269\u4f59\uff0c\u90a3\u4e48\u5faa\u73af\u8282\u7684\u7684\u957f\u5ea6\u662f $p-1$ \u7684\u56e0\u5b50\uff0c\u5426\u5219\uff0c\u5faa\u73af\u8282\u7684\u957f\u5ea6\u662f $2(p+1)$ \u7684\u56e0\u5b50\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e $5$ \u53ca\u4ee5\u4e0b\u7684 $f(n)$ \u76f4\u63a5\u66b4\u529b\u6c42\u5373\u53ef\uff0c$f(2)=3,f(3)=8,f(5)=20$\u3002\n\n$f$ \u51fd\u6570\u4ee3\u7801\uff1a\n\n```cpp\nll f(ll n){\n    if(n==2) return 3;\n    if(n==3) return 8;\n    if(n==5) return 20;\n    if(ksm(5,(n-1)/2,n)==1)return n-1;\n    return n*2+2;\n}\n```\n\n\u4f46\u662f $f(n)=f(p_i)\\times p_i^{\\alpha_i-1}$ \u8fd8\u662f\u4e00\u4e2a\u6570\u5b66\u731c\u60f3\uff0c\u5e76\u6ca1\u6709\u5177\u4f53\u8bc1\u660e\uff0c\u76ee\u524d\u53ea\u8bc1\u660e\u4e86\u662f\u7ea6\u6570\uff0c\u4f46\u662f\u5728 $p\\le 10^9$ \u5185\u662f\u53ef\u4ee5\u4fdd\u8bc1\u6b63\u786e\u6027\u7684\u3002\n\n\u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u5728 $O(\\sqrt {p})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7b97\u51fa pisano \u5468\u671f\uff0c\u63a5\u4e0b\u6765\u7684\u5c31\u662f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u7b97\u5c31\u884c\u3002\n\n\u63a8\u8350\u4e60\u9898\uff1a\n\n[P4994](https://www.luogu.com.cn/problem/P4994)\uff0c\u53ef\u4ee5\u8bf4 pisano \u5468\u671f\u5165\u95e8\u5427\u3002\n\n[SP12007](https://www.luogu.com.cn/problem/SP12007)\uff0cpisano \u6a21\u677f\u9898\uff0c\u6ce8\u610f\u770b\u9898\u89e3\u3002\n\n[SP13419](https://www.luogu.com.cn/problem/SP13419)\uff0cpisano \u6a21\u677f\u9898\uff0c\u6ce8\u610f\u8981\u52a0\u4e0a pollard-rho \u4f18\u5316\u8d28\u56e0\u6570\u5206\u89e3\u3002",
        "postTime": 1679220819,
        "uid": 590600,
        "name": "MoriyaSuwako",
        "ccfLevel": 0,
        "title": "P4000\u9898\u89e3"
    },
    {
        "content": "### Solve\n\n\u524d\u7f6e\u7ed3\u8bba\uff1a\u6a21\u6570\u4e3a $p$ \u7684\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5faa\u73af\u8282\u957f\u5ea6 $\\le 6\\cdot p$\u3002\n\n\u5982\u679c $i\\ne j$\uff0c$f_i=f_j$ \u4e14 $f_{i+1}=f_{j+1}$\uff0c\u610f\u5473\u7740\u627e\u5230\u4e86\u5faa\u73af\u8282\uff0c\u5faa\u73af\u8282\u7684\u957f\u5ea6\u662f $|i-j|$ \u7684\u56e0\u5b50\u3002\n\n\u8003\u8651\u968f\u673a\u5316\u3002\u4efb\u610f\u968f\u673a\u4e00\u4e2a\u4f4d\u7f6e $i$ \u8ba1\u7b97 $f_i,f_{i+1}$\uff0c\u628a $((f_{i},f_{i+1}),i)$ \u5b58\u8fdb\u54c8\u5e0c\u8868\u3002\u82e5\u54c8\u5e0c\u8868\u4e2d\u6709\u4e24\u4e2a\u76f8\u540c\u7684\u5143\u7d20\uff0c\u6211\u4eec\u5c31\u627e\u5230\u4e86\u5faa\u73af\u8282\u957f\u5ea6\u7684\u67d0\u4e2a\u500d\u6570\u3002\u7531\u4e8e\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u77e5\u9053\u5faa\u73af\u8282\u7684\u5177\u4f53\u957f\u5ea6\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u505c\u6b62\u5bfb\u627e\u3002\n\n\u7531\u4e8e\u5faa\u73af\u8282\u957f\u5ea6 $\\le 6\\cdot p$\uff0c\u6211\u4eec\u4e00\u6b21\u968f\u673a\u76f8\u5f53\u4e8e\u968f\u673a\u4e86\u4e00\u4e2a $[0,6\\cdot p)$ \u4e2d\u7684\u6570\u3002\u6839\u636e\u751f\u65e5\u6096\u8bba\u53ef\u77e5\uff0c\u8fd9\u6837\u51fa\u73b0\u91cd\u590d\u6570\u5b57\u7684\u671f\u671b\u6b21\u6570\u662f $\\sqrt{p}$ \u7ea7\u522b\u7684\u3002\n\n\u5b9e\u73b0\u4e0a\uff0c\u8ba1\u7b97 $f_i,f_{i+1}$ \u53ef\u4ee5\u4f7f\u7528\u77e9\u9635\u4e58\u914d\u5408\u5149\u901f\u5e42 $\\mathcal{O}(1)$ \u8ba1\u7b97\u3002\n\n### Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define pb push_back\n#define int long long\nint n, mod, high = (1ll << 36), base = (1ll << 18);\nmap<unsigned int, int> mp;\nmt19937_64 rnd(time(0));\n#define rand rnd\nstruct Matrix {\n\tint n, m, a[5][5];\n\tint* operator [] (int k) { return a[k]; }\n\tMatrix() {\n\t\tn = m = 0;\n\t\tmemset(a, 0, sizeof a);\n\t}\n\tMatrix(int q) {\n\t\tn = m = q;\n\t\tmemset(a, 0, sizeof a);\n\t\tfor (int i = 1; i <= n; i++) a[i][i] = 1;\n\t}\n} init[2][(1ll << 18) + 5];\nMatrix operator * (const Matrix a, const Matrix b) {\n\tMatrix c;\n\tc.n = a.n, c.m = b.m;\n\tfor (int i = 1; i <= c.n; i++)\n\t\tfor (int j = 1; j <= c.m; j++)\n\t\t\tfor (int k = 1; k <= a.m; k++)\n\t\t\t\tc.a[i][j] = (c.a[i][j] + a.a[i][k] * b.a[k][j]) % mod; \n\treturn c;\n} \nMatrix power(const int &x) {\n\treturn init[0][x % base] * init[1][x / base];\n}\nchar str[30000010];\nint read(int mod) {\n\tint num = 0;\n\tint len = strlen(str);\n\tfor (int i = 0; i < len; i++)\n\t\tif (isdigit(str[i])) {\n\t\t    num = num * 10 + str[i] - '0';\n\t\t    while (num >= mod) num -= mod;\n\t\t}\n\treturn num;\n}\nsigned main() {\n    srand((unsigned)time(0));\n\tcin >> str;\n\tcin >> mod;\n\tMatrix tmp;\n\ttmp.n = tmp.m = 2; tmp[1][1] = tmp[1][2] = tmp[2][1] = 1; tmp[2][2] = 0;\n\tinit[0][0] = Matrix(2);\n\tfor (int i = 1; i <= base; i++) init[0][i] = init[0][i - 1] * tmp;\n\tinit[1][0] = Matrix(2);\n\tfor (int i = 1; i <= base; i++) init[1][i] = init[1][i - 1] * init[0][base];\n\tMatrix pre;\n\tpre.n = 2, pre.m = 1; pre[1][1] = pre[2][1] = 1;\n\tint len = 0;\n\twhile (true) {\n\t\tint p = rand() % high;\n\t\tMatrix now = power(p - 1) * pre;\n\t\tunsigned int con = (now[1][1] << 32ll) + now[2][1];\n\t\tif (mp.find(con) != mp.end() && mp[con] != p) {\n\t\t\tlen = abs(p - mp[con]);\n\t\t\tbreak;\n\t\t} else mp[con] = p;\n\t}\n\tn = (read(len) + len - 1) % len + 1;\n\tif (n == 1 || n == 2) {\n\t\tcout << 1 % mod << \"\\n\";\n\t\treturn 0;\n\t}\n\tcout << (power(n - 2) * pre)[1][1] << \"\\n\";\n\treturn 0;\n} \n```\n",
        "postTime": 1670125233,
        "uid": 534654,
        "name": "Network_Error",
        "ccfLevel": 0,
        "title": "P4000 \u6590\u6ce2\u90a3\u5951\u6570\u5217 \u9898\u89e3"
    }
]