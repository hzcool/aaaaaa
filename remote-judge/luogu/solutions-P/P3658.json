[
    {
        "content": "## \u9898\u89e3- P3658 Why Did the Cow Cross the Road III P\n\n* **\u9898\u76ee\u5927\u610f**\n\n\u5f88\u5c0f\u6e05\u65b0\u3002\u5c31\u662f\u7ed9\u4f60\u4e24\u4e2a\u6392\u5217$A,B$\u4f7f\u5f97\u4e24\u4e2a\u6392\u5217\u4e2d\u76f8\u540c\u7684\u6570\u5b57\u4e24\u8fb9\u76f8\u8fde\u3002\u6700\u540e\u95ee\u4f60\u5b58\u5728\u591a\u5c11\u5bf9\u6570\u5bf9\u6ee1\u8db3\u6709\u4ea4\u53c9\u4e14$abs(Ai-Aj)>m$\n\n* $Solution$\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u9898\u76ee\u8f6c\u5316\u7684\u66f4\u52a0\u5c0f\u6e05\u65b0\u3002\u56e0\u4e3a\u8981\u6709\u4ea4\u663e\u7136\u6ee1\u8db3$PA(Ai)<PB(Ai)$\u4ee5\u53ca$PA(Aj)<PB(Aj)[PA,PB$\u4e3a\u8be5\u5143\u7d20\u5728$A,B$\u6392\u5217\u4e2d\u7684\u4f4d\u7f6e$]$\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u8bbe\u4e00\u4e2a\u4e09\u5143\u7ec4$(x,y,z)$\u6ee1\u8db3\n\n* $xi<xj$\n* $yi>yj$\n* $|zi-zj]>m$\n\n\u4e8e\u662f\u8fd9\u6837\u5c31\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e09\u7ef4\u504f\u5e8f\u7684\u7b80\u5355\u95ee\u9898\uff0c\u4e09\u7ef4\u504f\u5e8f\u89c1[\u6233\u8fd9\u91cc](https://www.luogu.org/problem/P3810)\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5355\u6b21\u8ba1\u7b97\u7684\u8d21\u732e\u663e\u7136\u4e3a$[z-m,z+m]$\u8fd9\u6bb5\u533a\u95f4\u91cc\u7684\u7b54\u6848\uff0c\u7b80\u5355\u5bb9\u65a5\u5373\u53ef\n\n\n* $Code$\n\n```cpp\n#include <bits/stdc++.h>\n#define For(i,a,b) for ( int i=(a);i<=(b);i++ )\n#define Dow(i,a,b) for ( int i=(a);i>=(b);i-- )\n#define FOR(i,t) for ( int i=head[t];i;i=e[i].nex )\n#define int long long\n#define db double\n#define mem(x,s) memset(x,s,sizeof(x))\n#define cpy(x,s) memcpy(x,s,sizeof(x))\n#define lowbit(x) x&(-x)\nusing namespace std;\n\nnamespace IO {\n\t#define gc getchar\n\t#define pt putchar\n\tinline int read() {\n\t\tint sum=0,ff=1; char ch=gc();\n\t\twhile(!isdigit(ch)) {\n\t\t\tif(ch=='-') ff=-1;\n\t\t\tch=gc();\n\t\t}\n\t\twhile(isdigit(ch))\n\t\t\tsum=sum*10+(ch^48),ch=gc();\n\t\treturn sum*ff;\n\t}\n\n\tinline void write(int x) {\n\t\tif(x<0) pt('-'),x=-x;\n\t\tif(x>9) write(x/10);\n\t\tpt(x%10|48);\n\t}\n\n\tinline void wln(int x) {\n\t\twrite(x); pt('\\n');\n\t}\n\n\tinline void wrn(int x) {\n\t\twrite(x); pt(' ');\n\t}\n}\n\nusing namespace IO;\n\nconst int N=1000005;\n\nint n,m,c[N*2],bo[N],ans;\n\nstruct number {\n\tint x,y,z;\n};\nnumber a[N],tmp[N];\n\ninline bool cmpy(number a,number b) {\n\tif(a.y==b.y) return a.z<b.z;\n\treturn a.y>b.y;\n}\n\ninline bool cmpx(number a,number b) {\n\tif(a.x==b.x) {\n\t\tif(a.y==b.y) return a.z<b.z;\n\t\treturn a.y>b.y;\n\t}\n\treturn a.x<b.x;\n}\n//\u4e09\u7ef4\u6392\u5e8f\n\ninline void add(int x,int val) {\n\twhile(x<=n) {\n\t\tc[x]+=val;\n\t\tx+=lowbit(x);\n\t}\n}\n\ninline int query(int x) {\n\tint ret=0;\n\tx=min(x,n);\n\tx=max(x,0ll);\n    //\u6ce8\u610f\u8fb9\u754c,\u88ab\u5751\u4e86\u597d\u4e45\n\twhile(x) {\n\t\tret+=c[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn ret;\n}\n\ninline void cdq(int l,int r) {\n//cdq\u6a21\u677f\n\tif(l==r) return;\n\tint mid=(l+r)/2;\n\tcdq(l,mid);\n\tcdq(mid+1,r);\n\tsort(a+l,a+mid+1,cmpy);\n\tsort(a+mid+1,a+r+1,cmpy);\n\tint i=mid+1,j=l;\n\tfor (;i<=r;i++) {\n\t\twhile(j<=mid&&a[j].y>a[i].y) {\n\t\t\tadd(a[j].z,1);\n\t\t\tj++;\n\t\t}\n\t\tans+=query(a[i].z-m-1)+query(n)-query(a[i].z+m);\n       //\u8ba1\u7b97\u5355\u6b21\u8d21\u732e\n\t}\n\tFor(i,l,j-1) add(a[i].z,-1);//\u6e05\u7a7a\u6811\u72b6\u6570\u7ec4\n}\n\t\nsigned main() {\n\tn=read();\n\tm=read();\n\tFor(i,1,n) bo[read()]=i;\n    //\u6620\u5c04\u6570\u7ec4\n\tFor(i,1,n) {\n\t\tint x=read();\n\t\ta[i]=(number){bo[x],i,x};\n        //\u5efa\u7acb\u4e09\u5143\u7ec4\n\t}\n\tsort(a+1,a+n+1,cmpx);\n\tcdq(1,n);\n\twln(ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1572773639,
        "uid": 172612,
        "name": "\u7c73\u5947\u5947\u7c73",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3658 \u3010[USACO17FEB]Why Did the Cow Cross the Road III P\u3011"
    },
    {
        "content": "\u6bd4\u8f83\u7b80\u5355\u7684\u6a21\u578b\u8f6c\u6362\n\n\u8bb0\u5f55\u4e24\u4e2a\u5e8f\u5217\u6bcf\u4e2a\u5143\u7d20\u51fa\u73b0\u7684\u4f4d\u7f6e.\n\n$c_i$ \u8868\u793a\u4e3a\u54c1\u79cd $c_i$\n\n$a_i$,$b_i$\u5206\u522b\u8868\u793a\u54c1\u79cd $c_i$\u51fa\u73b0\u5728\u4e24\u4e2a\u5e8f\u5217\u7684\u4f4d\u7f6e\n\n\u6709\u4ea4\u53c9\u70b9: $a_i<a_j$\u4e14 $b_i>b_j$\n\n\u8fd8\u6709\u4e00\u4e2a\u6761\u4ef6\u662f $abs(c_i-c_j)>k$\n\n\u7136\u540e\u5c31\u662f\u88f8\u7684\u4e86,\u800c\u4e14\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u60c5\u51b5,\u6bd4\u8f83\u597d\u5904\u7406\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int qmax(int &x,int y) {if (x<y) x=y;}\ninline int qmin(int &x,int y) {if (x>y) x=y;}\ninline int read()\n{\n    char s;\n    int k=0,base=1;\n    while((s=getchar())!='-'&&s!=EOF&&!(s>='0'&&s<='9'));\n    if(s=='-')base=-1,s=getchar();\n    while(s>='0'&&s<='9')\n    {\n        k=k*10+(s^48);\n        s=getchar();\n    }\n    return k*base;\n}\nvoid write(int x)\n{\n    if(x<0){putchar('-');write(-x);}\n    else{if(x/10)write(x/10);putchar(x%10+'0');}\n}\nconst int maxn=1e5+10;\nint n,k,X;\nint Map[maxn];\nlong long ans;\nint t[maxn];\ninline void xg(int x) {while (x<=n) t[x]+=1,x+=x&(-x);}\ninline void xg1(int x) {while (x<=n) t[x]-=1,x+=x&(-x);}\ninline int qh(int x) {x=x>n?n:x;if (x<=0) return 0;int s=0;while (x) s+=t[x],x^=x&(-x);return s;}\nstruct node\n{\n    int x,y,z;//x:p1,y:p2,z:\u6743\u503c\n} a[maxn],b[maxn];\nbool cmp(node aa,node bb) {return aa.x==bb.x?(aa.y==bb.y)?(aa.z<bb.z):aa.y>bb.y:aa.x<bb.x;}\ninline void hb(int l,int r)\n{\n    if (l==r) return;\n    int mid=(l+r)>>1;\n    int i=l,j=mid+1,p=l-1;\n    while (i<=mid&&j<=r) {if (a[i].y>a[j].y) b[++p]=a[i++]; else b[++p]=a[j++];}\n    while (i<=mid) b[++p]=a[i++];\n    while (j<=r) b[++p]=a[j++];\n    for (int k=l;k<=r;k++) a[k]=b[k];\n}\ninline void ef(int l,int r)\n{\n    if (l==r) return;\n    int mid=(l+r)>>1;\n    ef(l,mid);ef(mid+1,r);hb(l,mid);hb(mid+1,r);\n    int i=l,j=mid+1;\n    while (j<=r)\n    {\n        while (i<=mid&&a[i].y>a[j].y) xg(a[i++].z);\n        ans=ans+(long long)qh(a[j].z-k-1)+(long long)qh(n)-qh(a[j].z+k);\n        ++j;\n    }\n    for (int k=l;k<i;k++) xg1(a[k].z);\n}\nint main()\n{\n    n=read();k=read();\n    for (int i=1;i<=n;i++) Map[read()]=i;\n    for (int i=1;i<=n;i++)\n    {\n        X=read();\n        a[i].x=Map[X];a[i].y=i;a[i].z=X;\n    }\n    sort(a+1,a+n+1,cmp);\n    ef(1,n);\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1511865608,
        "uid": 2674,
        "name": "\u300cQQ\u7ea2\u5305\u300d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3658 \u3010[USACO17FEB]Why Did the Cow Cross the Road III P\u3011"
    },
    {
        "content": "\u9898\u610f\n\n\u4e24\u5217$n$\u7684\u6392\u5217\uff0c\u76f8\u540c\u7684\u6570\u8fde\u8fb9\uff0c\u5982\u679c\u4e00\u5bf9\u6570\u6709\u4ea4\u53c9\u4e14\u5dee\u7684\u7edd\u5bf9\u503c$>k$\uff0c\u5219$++ans$\uff0c\u6c42$ans$\n\n\u9898\u89e3\n\n\u53ef\u4ee5\u628a\u6bcf\u4e00\u4e2a\u6570\u5b57\u770b\u6210\u4e00\u4e2a\u4e09\u5143\u7ec4$(x,y,z)$\uff0c\u5176\u4e2d$x$\u8868\u793a\u5728\u7b2c\u4e00\u5217\u7684\u4f4d\u7f6e\uff0c$y$\u8868\u793a\u5728\u7b2c\u4e8c\u5217\u7684\u4f4d\u7f6e\uff0c$z$\u8868\u793a\u6743\u503c\n\n\u4e24\u6761\u7ebf\u4ea4\u53c9\uff0c\u5c31\u662f$x<x'$\u4e14$y>y'$\uff0c\u53c8\u8981\u6ee1\u8db3\u5dee\u503c\u7684\u7edd\u5bf9\u503c\u5c0f\u4e8e\u7b49\u4e8e$k$\uff0c\u5c31\u662f$|z-z'|<=k$\n\n\u4e8e\u662f\u5c31\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u76f4\u63a5\u4e0aCDQ\n\n\u5177\u4f53\u7ec6\u8282\u8bf7\u770b\u4ee3\u7801\n```\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#define ll long long\nusing namespace std;\n#define getc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\ninline int read(){\n    #define num ch-'0'\n    char ch;bool flag=0;int res;\n    while(!isdigit(ch=getc()))\n    (ch=='-')&&(flag=true);\n    for(res=num;isdigit(ch=getc());res=res*10+num);\n    (flag)&&(res=-res);\n    #undef num\n    return res;\n}\nconst int N=1e5+5;\nint n,k,b[N];\nll ans;int c[N];\ninline void add(int x){\n    for(;x<=n;x+=x&-x) c[x]+=1;\n}\ninline void clear(int x){\n    for(;x<=n;x+=x&-x)\n    if(c[x]) c[x]=0;\n    else break;\n}\ninline int query(int x){\n    int res=0;x=x>n?n:x;if(x<=0) return 0;\n    for(;x;x-=x&-x) res+=c[x];\n    return res;\n}\nstruct node{\n    int x,y,z;\n    node(){}\n    node(int x,int y,int z):x(x),y(y),z(z){}\n    inline bool operator <(const node &b)const\n    {return x!=b.x?x<b.x:\n            y!=b.y?y>b.y:\n            z<b.z;}\n}a[N],p[N];\nvoid CDQ(int l,int r){\n    if(l==r) return;\n    int mid=l+r>>1;\n    CDQ(l,mid),CDQ(mid+1,r);\n    for(int j=mid+1,i=l;j<=r;++j){\n        while(i<=mid&&a[i].y>a[j].y) add(a[i++].z);\n        ans+=1ll*query(a[j].z-k-1)+query(n)-query(a[j].z+k);\n    }\n    for(int i=l;i<=mid;++i) clear(a[i].z);\n    for(int i=l,j=l,k=mid+1;i<=r;){\n        if(k>r||(j<=mid&&a[j].y>a[k].y)) p[i++]=a[j++];\n        else p[i++]=a[k++];\n    }\n    for(int i=l;i<=r;++i) a[i]=p[i];\n}\nint main(){\n    //freopen(\"testdata.in\",\"r\",stdin);\n    n=read(),k=read();\n    for(int i=1;i<=n;++i){\n        int x=read();b[x]=i;\n    }\n    for(int i=1;i<=n;++i){\n        int x=read();\n        a[i]=node(b[x],i,x);\n    }\n    sort(a+1,a+1+n);\n    CDQ(1,n);\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1534041769,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3658 \u3010[USACO17FEB]Why Did the Cow Cross the Road III P\u3011"
    },
    {
        "content": "# \u9898\u89e3\n\u5047\u8bbe $i$ \u5728\u6392\u5217 $A$ \u4e2d\u7684\u4f4d\u7f6e\u4e3a $a_i$\uff0c\u5728\u6392\u5217 $B$ \u4e2d\u7684\u4f4d\u7f6e\u4e3a $b_i$\u3002\u7531\u4e8e\u5b83\u4eec\u6240\u5728\u4e24\u4e2a\u6392\u5217\u95f4\u5bf9\u5e94\u7684\u7ebf\u4ea4\u53c9\uff0c\u4e0d\u96be\u5f97\u5230 $a_i>a_j,b_i<b_j$ \u6216 $a_i<a_j,b_i>b_j$\u3002\u901a\u8fc7\u6837\u4f8b\u53d1\u73b0\uff0c$(x,y)$ \u548c $(y,x)$ \u662f\u540c\u4e00\u79cd\u7b54\u6848\uff0c\u6240\u4ee5\u6211\u4eec\u94a6\u5b9a $i>j+k$\uff0c\u505a\u4e24\u6b21 cdq \u5206\u6cbb\u5373\u53ef\u3002\n\n\u5206\u522b\u4ee5 $a_i,b_i,i$ \u4e3a\u7b2c\u4e00\u3001\u7b2c\u4e8c\u3001\u7b2c\u4e09\u5173\u952e\u5b57\uff0c\u5148\u6309\u7b2c\u4e00\u7ef4\u6392\u5e8f\uff0c\u5728 cdq \u5206\u6cbb\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5728\u4fdd\u8bc1\u7b2c\u4e8c\u5173\u952e\u5b57\u6709\u5e8f\u7684\u540c\u65f6\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u7b2c\u4e09\u5173\u952e\u5b57\u5373\u53ef\u3002\n\n## Code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define N 100005\nstruct node\n{\n\tint x,y,z;\n}a[N];\nint n,k,t;\nll c[N<<1],ans;\nbool cmp1(node u,node v)\n{\n\treturn u.x<v.x;\n}\nbool cmp2(node u,node v)\n{\n\treturn u.y>v.y;\n}\nbool cmp3(node u,node v)\n{\n\treturn u.x>v.x;\n}\nbool cmp4(node u,node v)\n{\n\treturn u.y<v.y;\n}\nint lowbit(int x)\n{\n\treturn x&(-x); \n}\nvoid add(int x,int y)\n{\n\twhile(x<=n)\n\t{\n\t\tc[x]+=y;\n\t\tx+=lowbit(x);\n\t}\n}\nll query(int x)\n{\n\tll res=0;\n\twhile(x)\n\t{\n\t\tres+=c[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn res;\n}\nvoid cdq1(int l,int r)\n{\n\tif(l==r)\n\t\treturn;\n\tint mid=l+r>>1,i,j=r;\n\tcdq1(l,mid);\n\tcdq1(mid+1,r);\n\tsort(a+l,a+mid+1,cmp2);\n\tsort(a+mid+1,a+r+1,cmp2);\n\tfor(i=mid;i>=l;i--)\n\t{\n\t\twhile(a[i].y>a[j].y&&j>mid)\n\t\t{\n\t\t\tadd(a[j].z,1);\n\t\t\tj--;\n\t\t}\n\t\tif(a[i].z>k)\n\t\t\tans+=query(a[i].z-k-1);\n\t}\n\tfor(i=r;i>j;i--)\n\t\tadd(a[i].z,-1);\n}\nvoid cdq2(int l,int r)\n{\n\tif(l==r)\n\t\treturn;\n\tint mid=l+r>>1,i,j=r;\n\tcdq2(l,mid);\n\tcdq2(mid+1,r);\n\tsort(a+l,a+mid+1,cmp4);\n\tsort(a+mid+1,a+r+1,cmp4);\n\tfor(i=mid;i>=l;i--)\n\t{\n\t\twhile(a[i].y<a[j].y&&j>mid)\n\t\t{\n\t\t\tadd(a[j].z,1);\n\t\t\tj--;\n\t\t}\n\t\tif(a[i].z>k)\n\t\t\tans+=query(a[i].z-k-1);\n\t}\n\tfor(i=r;i>j;i--)\n\t\tadd(a[i].z,-1);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&t);\n\t\ta[t].x=i;\n\t\ta[i].z=i;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&t);\n\t\ta[t].y=i;\n\t}\n\tsort(a+1,a+n+1,cmp1);\n\tcdq1(1,n);\n\tsort(a+1,a+n+1,cmp3);\n\tcdq2(1,n);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1658911783,
        "uid": 379058,
        "name": "Ginger_he",
        "ccfLevel": 0,
        "title": "\u6d1b\u8c37P3658\u9898\u89e3"
    },
    {
        "content": "###### \u4e2a\u4eba\u5199\u7684\u7b2c\u4e09\u9053cdq\u5206\u6cbb\uff0c\u8ba9\u6211\u5bf9cdq\u5206\u6cbb\u7684\u7406\u89e3\u53c8\u52a0\u6df1\u4e86\u3002\n\n\u9898\u610f\u5df2\u7ecf\u591f\u7cbe\u7b80\u4e86\uff0c\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u5177\u4f53\u505a\u6cd5\n\n$op_i$ \u8868\u793a\u4e0a\u9762\u6392\u5217\u4e0b\u6807\u4e3a $i$ \u7684\u6570\u5728\u4e0b\u9762\u6392\u5217\u4e2d\u5bf9\u5e94\u6570\u7684\u4e0b\u6807\u3002\n\n\u53ea\u8981\u627e\u5230\u6240\u6709 $i<j$ \u4e14 $op_i>op_j$ \u4e14 $|(a_i-a_j)>k|$ \u7684\u6570\u5bf9\u5373\u53ef\u3002\n\n\u8fd9\u6837\u4e00\u8f6c\u6362\u5c31\u6210\u4e86\u4e09\u7ef4\u504f\u5e8f\u7684\u677f\u5b50\uff0c\u53ef\u7528cdq\u5206\u6cbb\u5b9e\u73b0\u3002\n\n\u6709\u4e00\u4e2a\u5c0f\u4f18\u5316\uff0c\u4e00\u8fb9\u5904\u7406\u8d21\u732e\u4e00\u8fb9\u5f52\u5e76\uff0c\u7701\u53bb\u4e86sort\u7684\u65f6\u95f4\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9') f=(ch=='-')?-1:1,ch=getchar();\n\twhile(ch>='0'&&ch<='9') x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn x*f;\n}\nconst int N=100005;\nstruct obj{int y,z;}a[N],A[N];//A\u6570\u7ec4\u7684\u4f5c\u7528\u662f\u5904\u7406\u8d21\u732e\u65f6\u5b58\u5f52\u5e76\u540e\u7684\u6570\u7ec4\n//\u672c\u6765\u5f00\u4e86x,y,z\u4e09\u4e2a\u7ef4\u5ea6\uff0c\u540e\u6765\u53d1\u73b0\u6211\u4ee5\u4e0b\u6807\u4e3a\u7b2c\u4e00\u7ef4\uff0c\u65e0\u9700\u6392\u5e8f\uff0c\u6240\u4ee5x\u7ef4\u5ea6\u53ef\u4ee5\u7701\u7565\nint b[N],c[N],x,n,k;\nlong long ans;\nvoid add(int x,int k){while(x<=n) c[x]+=k,x+=x&-x;}\nint ask(int x){int s=0;while(x) s+=c[x],x-=x&-x;return s;}\nvoid cdq(const int l,const int r)\n{\n\tif(l==r) return;\n\tint mid=l+r>>1;\n\tcdq(l,mid),cdq(mid+1,r);\n\tint ll=l,cnt=ll;\n\tfor(int rr=mid+1;rr<=r;rr++)\n\t{\n\t\twhile(ll<=mid&&a[ll].y>a[rr].y) A[cnt++]=a[ll],add(a[ll].z,1),ll++;\n\t\tA[cnt++]=a[rr];\n\t\tint x1=a[rr].z-k,x2=a[rr].z+k;\n\t\tif(x1>1) ans+=ask(x1-1);//\u5904\u7406\u6743\u503c\u6bd4\u5f53\u524d\u6570\u5c0f\u81f3\u5c11k+1\u7684\u8d21\u732e\n\t\tif(x2<n) ans+=ask(n)-ask(x2);//\u5904\u7406\u6743\u503c\u6bd4\u5f53\u524d\u6570\u5927\u81f3\u5c11k+1\u7684\u8d21\u732e\n\t}\n\tfor(int i=l;i<ll;i++) add(a[i].z,-1);\n\twhile(ll<=mid) A[cnt++]=a[ll++];\n\tfor(int i=l;i<=r;i++) a[i]=A[i];\n\treturn;\n}\nint main()\n{\n\tn=read(),k=read();\n\tfor(int i=1;i<=n;i++) b[read()]=i;\n\tfor(int i=1;i<=n;i++) a[i].z=read(),a[i].y=b[a[i].z];//\u6211\u662f\u4ee5\u4e0b\u9762\u7684\u6392\u5217\u4e3a\u57fa\u51c6\n\treturn cdq(1,n),printf(\"%lld\\n\",ans),0;//\u5c0f\u5c0f\u538b\u884c\uff0c\u65e0\u4f24\u5927\u96c5\n}\n```",
        "postTime": 1671092521,
        "uid": 196631,
        "name": "xuzz",
        "ccfLevel": 6,
        "title": "P3658 [USACO17FEB]Why Did the Cow Cross the Road III P"
    },
    {
        "content": "\u7b80\u5355\u8f6c\u5316+cdq\u5206\u6cbb\u3002\n\n\u5148\u7b80\u5316\u9898\u610f\uff1a\n\n\u7ed9\u4f60\u4e24\u4e2a\u5e8f\u5217\uff0c\u5e8f\u5217\u4e24\u8fb9\u76f8\u540c\u7684\u6570\u4e92\u76f8\u8fde\u7ebf\uff0c\u82e5\u4e24\u4e24\u8fde\u7ebf\u4ea7\u751f\u4ea4\u70b9\uff0c\u4e14\u4e24\u6761\u8fde\u7ebf\u7684\u6570\u7684\u7edd\u5bf9\u503c\u5dee\u4e0d\u8d85\u8fc7k\uff0c\u5219\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u52a0\u4e00\u3002\n\n\u8bbe\u4e00\u4e2a\u6570\u4e3ac\uff0c\u5728\u4e24\u4e2a\u5e8f\u5217\u5206\u522b\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3aa\uff0cb\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e24\u6570 $c_i$ \u548c $c_j$\uff0c\n\u6c42\u6ee1\u8db3\uff1a$a_i>a_j$\uff0c$b_i<b_j$\uff0c $|c_i-c_j|\\le k$ \u7684\u60c5\u51b5\u3002\n\n\u8fd9\u91cc\u5f88\u660e\u663e\u662f\u9053\u4e09\u7ef4\u504f\u5e8f\u7684\u88f8\u9898\uff0c\u5177\u4f53\u8fc7\u7a0b\u4e0d\u518d\u8d58\u8ff0\uff0c\u8fd9\u91cc\u4e3b\u8981\u8bf4\u4e00\u4e2a\u5730\u65b9\u3002\n\n\u53cc\u6307\u9488\u679a\u4e3e\u65f6\uff0c\u6211\u7528\u7684\u662f\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u524d\u7f00\u548c\uff0c\u603b\u7684\u51cf\u53bb\u53cb\u597d\u7684\u6570\u76ee\u5373\u4e3a\u6240\u6c42\u6570\uff0c\u6ce8\u610f\u8303\u56f4\u4e0d\u8981\u8d8a\u754c,\u5927\u6982\u662f\u8fd9\u6837\uff1a \n\n$query(N-1)-query(min(q[j].c+K,N-1))+query(max(q[j].c-K-1,0))$\n\n\u6700\u540e\uff0c\u6ce8\u610f\u5f00long long\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e6+5;\ntypedef long long ll;\nstruct nod{\n\tint a,b,c;\n\tll res;\n}q[N],w[N];\nint tr[N],n,K;\nll ans;\nbool cmp(nod x,nod y){\n\treturn x.a>y.a;\n}\nint lowbit(int x){\n\treturn x&-x;\n}\nvoid add(int x,int v){\n\tfor(int i=x;i<N;i+=lowbit(i)){\n\t\ttr[i]+=v;\n\t}\n}\nint query(int x){\n\tint res=0;\n\tfor(int i=x;i;i-=lowbit(i)){\n\t\tres+=tr[i];\n\t}\n\treturn res;\n}\nvoid merg_sort(int l,int r){\n\tif(l>=r)return ;\n\tint mid=(l+r)/2;\n\tmerg_sort(l,mid);\n\tmerg_sort(mid+1,r);\n\tint i=l,j=mid+1,k=1;\n\twhile(i<=mid&&j<=r){\n\t\tif(q[i].b<q[j].b)add(q[i].c,1),w[k++]=q[i++];\n\t\telse q[j].res+=query(N-1)-query(min(q[j].c+K,N-1))+query(max(q[j].c-K-1,0)),w[k++]=q[j++];\n\t}\n\twhile(i<=mid)add(q[i].c,1),w[k++]=q[i++];\n\twhile(j<=r)q[j].res+=query(N-1)-(query(min(q[j].c+K,N-1))-query(max(q[j].c-K-1,0))),w[k++]=q[j++];\n\tfor(int i=l;i<=mid;i++){\n\t\tadd(q[i].c,-1);\n\t}\n\tfor(i=l,j=1;j<k;i++,j++){\n\t\tq[i]=w[j];\n\t}\t\n}\nint main(){\n\tscanf(\"%d%d\",&n,&K);\n\tfor(int i=1;i<=n;i++){\n\t\tint j;\n\t\tscanf(\"%d\",&j);\n\t\tq[j].a=i;\n\t\tq[j].c=j;\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tint j;\n\t\tscanf(\"%d\",&j);\n\t\tq[j].b=i;\n\t}\n\tsort(q+1,q+n+1,cmp);\n\tmerg_sort(1,n);\n\tfor(int i=1;i<=n;i++){\n\t\tans+=q[i].res;\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1619010404,
        "uid": 277664,
        "name": "\u968f\u4fbfAK",
        "ccfLevel": 6,
        "title": "P3658 [USACO17FEB]Why Did the Cow Cross the Road III P \u9898\u89e3"
    },
    {
        "content": "a[x]\u662f\u6570\u5b57x\u5728\u7b2c\u4e00\u5217\u7684\u4f4d\u7f6e b[]\u662f\u7b2c\u4e8c\u5217\n\n\u4e0d\u53cb\u597d\u5373\uff1aa[y]>a[x]&&b[y]<b[x]&&|x-y|>k\n\n\u8fd9\u662f\u4e00\u4e2a\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898 \u6700\u540e\u4e00\u5c42\u90a3\u4e2a\u7edd\u5bf9\u503c\u4e0d\u597d\u641e\n\n\u6211\u4eec\u628a\u5b83\u8f6c\u5316\u6210y<x-k||y>x+k\n\n\u5148\u6392\u5e8f\u6389\u4e00\u7ef4\u7136\u540e\u7528\u6811\u5957\u6811(\u6811\u72b6\u6570\u7ec4\u5957Treap)\u89e3\u51b3\n```cpp\n#include<cstdio>\n#include<algorithm>\n#define reg register\nusing std::sort;\ntypedef long long ll;\nconst int N=1e5+10;\ntemplate<class type>inline const void read(reg type &in)\n{\n\tin=0;reg char ch=getchar();reg bool fh=0;\n\twhile (ch<48||ch>57)fh=ch=='-'?1:fh,ch=getchar();\n\twhile (ch>47&&ch<58)in=(in<<3)+(in<<1)+(ch&15),ch=getchar();\n\tif (fh)in=-in;\n}\ntemplate<class type>inline const void write(reg type out)\n{\n\tif (out>9)write(out/10);\n\tputchar(out%10+48);\n}\nint n,k;\nll ans;\nstruct rapid\n{\n    int a,b,c;\n    inline const bool operator<(reg const rapid &p)const\n    {\n        return a>p.a;\n    }\n}w[N];\n//namespace Treap{\n    struct tree\n    {\n        tree *son[2];\n        int key,size,priority;\n        inline const void pushup()\n        {\n            size=son[0]->size+1+son[1]->size;\n        }\n    }memory_pool[N<<5],*tail,*null;\n    inline const void init()\n    {\n        tail=memory_pool;\n        null=tail++;\n        null->son[0]=null->son[1]=null;\n        null->key=null->size=null->priority=0;\n    }\n    inline tree *spawn(reg int key)\n    {\n        tree *p=tail++;\n        p->size=1;\n        p->key=key;\n        p->priority=rand();\n        p->son[0]=p->son[1]=null;\n        return p;\n    }\n    inline const void rotate(reg tree *&fa,reg bool f)\n    {\n        reg tree *p=fa->son[f];\n        fa->son[f]=p->son[f^1];\n        p->son[f^1]=fa;\n        fa->pushup();(fa=p)->pushup();\n    }\n    inline const void insert(reg tree *&p,reg int key)\n    {\n        if (p==null)return (void)(p=spawn(key));\n        reg bool f=p->key<key;\n        insert(p->son[f],key);p->pushup();\n        if (p->son[f]!=null&&p->son[f]->priority<p->priority)rotate(p,f);\n    }\n    inline const int less(reg tree *p,reg int key)\n    {\n        if (p==null)return 0;\n        if (key<p->key)return less(p->son[0],key);\n        if (p->key==key)return p->son[0]->size;\n        return less(p->son[1],key)+p->son[0]->size+1;\n    }\n    inline const int greater(reg tree *p,reg int key)\n    {\n        if (p==null)return 0;\n        if (key>p->key)return greater(p->son[1],key);\n        if (p->key==key)return p->son[1]->size;\n        return greater(p->son[0],key)+p->son[1]->size+1;\n    }\n//}using namespace Treap;\nclass Binary_Indexed_Tree\n{\n    private:\n    \ttree *root[N];\n    \tinline const int lowbit(reg int x)\n    \t{\n\t\t\treturn x&-x;\n\t\t}\n\t\tinline const int prefix_query(reg int x,reg int y)\n\t\t{\n\t\t\treg int sum=0;\n\t\t\tfor (;x;x-=lowbit(x))sum+=less(root[x],y-k)+greater(root[x],y+k);\n\t\t\treturn sum;\n\t\t}\n\tpublic:\n\t\tinline const void init()\n\t\t{\n\t\t\tfor (reg int i=1;i<=n;i++)root[i]=null;\n\t\t}\n\t\tinline const void update(reg int x,reg int y)\n\t\t{\n\t\t\tfor (;x<=n;x+=lowbit(x))insert(root[x],y);\n\t\t}\n\t\tinline const int query(reg int l,reg int r,reg int x)\n\t\t{\n\t\t\tif (l>r)return 0;\n\t\t\treturn prefix_query(r,x)-prefix_query(l-1,x);\n\t\t}\n}bit;\nint main()\n{\n    read(n);read(k);\n    //scanf(\"%d%d\",&n,&k);\n    for (reg int i=1;i<=n;i++)w[i].c=i;\n    for (reg int x,i=1;i<=n;i++)//scanf(\"%d\",&x),\n\tread(x),\n\tw[x].a=i;\n    for (reg int x,i=1;i<=n;i++)//scanf(\"%d\",&x),\n\tread(x),\n\tw[x].b=i;\n    sort(w+1,w+n+1);init();bit.init();\n    for (reg int i=1;i<=n;i++)\n        ans+=bit.query(1,w[i].b-1,w[i].c),\n        bit.update(w[i].b,w[i].c);\n //   printf(\"%lld\\n\",ans);\n \twrite(ans);\n    return 0;\n}\n```",
        "postTime": 1562741619,
        "uid": 14374,
        "name": "zhengrunzhe",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3658 \u3010[USACO17FEB]Why Did the Cow Cross the Road III P\u3011"
    },
    {
        "content": "### Solution\n\n\u5148\u8bb2\u66b4\u529b\u3002\u5728\u7b2c\u4e00\u4e2a\u6570\u5217\u4e2d\u679a\u4e3e\u4f4d\u7f6e\uff0c\u540c\u65f6\u5728\u7b2c\u4e8c\u4e2a\u6570\u5217\u4e2d\u679a\u4e3e\u4f4d\u7f6e\uff0c\u7528\u4e00\u4e2a\u6570\u7ec4\u8868\u793a\u8fd9\u4e2a\u6570\u5728\u4e0b\u4e00\u4e2a\u5e8f\u5217\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u6700\u540e\u5224\u65ad\u662f\u4e0d\u662f\u4ea4\u53c9\u76f8\u7b49\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u6b63\u89e3\u4e5f\u5f88\u660e\u663e\uff0c\u89c2\u5bdf\u5230\u51b3\u5b9a\u7b54\u6848\u7684\u56e0\u7d20\u6709\u4ee5\u4e0b\u4e09\u4e2a\u4e1c\u897f\uff1a\n\n1. \u6570 $i$ \u5728\u7b2c\u4e00\u4e2a\u6570\u5217\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\u5c0f\u4e8e $j$ \u5728\u7b2c\u4e00\u4e2a\u6570\u5217\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\n\n2. \u6570 $i$ \u5728\u7b2c\u4e00\u4e2a\u6570\u5217\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\u5927\u4e8e $j$ \u5728\u7b2c\u4e00\u4e2a\u6570\u5217\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\n\n3. $i$ \u548c $j$ \u7684\u7edd\u5bf9\u503c\u5927\u4e8e $k$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u524d\u4e24\u70b9\u53ef\u4ee5\u5224\u65ad\u4ed6\u4eec\u662f\u5426\u4ea4\u53c9\u76f8\u7b49\uff0c\u800c\u7b2c\u4e09\u4e2a\u8981\u6c42\u663e\u7136\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6216\u8005\u7ebf\u6bb5\u6811\u6c42\u3002\n\n\u6ce8\u610f\uff1a\u6c42\u7684\u65f6\u5019\u6709\u53ef\u80fd\u8d8a\u754c\uff0c\u6ce8\u610f\u5224\u65ad\u3002\n\n##  Code\n\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long \n#define x first\n#define y second\nusing namespace std;\ntypedef pair<int,int> pii;\nconst int N=1e5+10;\nint n,k;\nint f[N]; \nint ans=0;\nint tr1[N],tr2[N];\nint read(){\n\tint x=0,f=1; char ch=getchar();\n\twhile(ch<'0'||ch>'9') f=(ch=='-')?-1:1,ch=getchar();\n\twhile(ch>='0'&&ch<='9') x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn x*f;\n}\nstruct Node{ \n\tint w; \n\tint x,y; \n}a[N]; \ninline int lowbit(int x){ return x&-x; }\ninline bool cmp1(Node a,Node b){\n\treturn a.x<b.x;\n}\ninline bool cmp2(Node a,Node b){\n\treturn a.y>b.y;\n} \ninline void add1(int x,int val){\n\tfor(int i=x;i<=n;i+=lowbit(i)) tr1[i]+=val;  \n}\ninline int query1(int x){\n\tif(x<1) return 0; int res=0;\n\tfor(int i=x;i;i-=lowbit(i)) res+=tr1[i];\n\treturn res;\n}\ninline void add2(int x,int val){\n\tfor(int i=x;i;i-=lowbit(i)) tr2[i]+=val;\n}\ninline int query2(int x){\n\tif(x>n) return 0; int res=0;\n\tfor(int i=x;i<=n;i+=lowbit(i)) res+=tr2[i];\n\treturn res;\n}\ninline void CDQ(int l,int r){\n\tif(l==r) return ;\n\tint mid=l+r>>1,j=l;\n\tCDQ(l,mid),CDQ(mid+1,r); \n\tsort(a+l,a+mid+1,cmp2); \n\tsort(a+mid+1,a+r+1,cmp2);\n\tfor(int i=mid+1;i<=r;i++){ \n\t\twhile(j<=mid&&a[j].y>a[i].y) add1(a[j].w,1),add2(a[j].w,1),j++; \n\t\tans+=query1(a[i].w-k-1)+query2(a[i].w+k+1); \n\t} for(int i=l;i<j;i++) add1(a[i].w,-1),add2(a[i].w,-1); \n}\nsigned main(){\n\tn=read(),k=read(); \n\tfor(int i=1,x;i<=n;i++) x=read(),a[x].x=i,a[x].w=x;\n\tfor(int i=1,x;i<=n;i++) x=read(),a[x].y=i;\n\tsort(a+1,a+n+1,cmp1); CDQ(1,n); printf(\"%lld\\n\",ans);\n\treturn 0; \n}/*\n4 1\n4 3 2 1 \n1 4 2 3  \n\n\n\n*/\n```\n",
        "postTime": 1685460836,
        "uid": 706523,
        "name": "zhengdongwen",
        "ccfLevel": 0,
        "title": "P3658 \u9898\u89e3"
    },
    {
        "content": "[\u6d1b\u8c37 P3658 [USACO17FEB]Why Did the Cow Cross the Road III P](https://www.luogu.com.cn/problem/P3658)\n\n\u8bb0\u5f55\u4e00\u4e0b\u81ea\u5df1\u7528\u4e86\u72ec\u7279\u7684\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\u89e3\u6cd5\u3002\n\n\u6211\u4eec\u5f00\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u8bb0\u5f55\u4e09\u4e2a\u4e1c\u897f $up,down,val$\uff0c\u5206\u522b\u8868\u793a\u8fd9\u4e2a\u6570 $val$ \u5728 $A$ \u6392\u5217\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5728 $B$ \u6392\u5217\u4e2d\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u6570\u7684\u503c$($\u4e5f\u5c31\u662f$val)$\u3002\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u9053\u9898\u5c31\u53d8\u6210\u4e86\u4e00\u9053\u4e09\u4f4d\u504f\u5e8f\u7684\u95ee\u9898\u3002\u6211\u4eec\u53ef\u4ee5\u5148\u6309 $up$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\u5982\u679c\u8981\u6ee1\u8db3\u5bf9\u5e94\u7684\u7ebf\u4ea4\u53c9\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e24\u4e2a\u6570 $x,y$\uff0c\u5982\u679c\u5728 $A$ \u4e2d $x$ \u5728 $y$ \u524d\u9762\uff0c\u90a3\u4e48\u5728 $B$ \u4e2d $x$ \u5c31\u5fc5\u987b\u5728 $y$ \u540e\u9762\u3002\u90a3\u4e48\u7531\u4e8e\u7b2c\u4e00\u7ef4\u662f\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u7684\uff0c\u7b2c\u4e8c\u7ef4\u6211\u4eec\u5c31\u8981\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002\u8fd8\u662f\u5206\u6210\u4e24\u4e2a\u533a\u95f4 $[l,mid]$ \u548c $[mid+1,r]$\uff0c\u5206\u522b\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002\n\n\u8003\u8651\u5982\u4f55\u7b97\u8d21\u732e\u3002\u6211\u4eec\u8bb0 $i$ \u6307\u5411 $[mid+1,r]$\uff0c$j$ \u6307\u5411 $[l,mid]$\uff0c\u90a3\u4e48\u5f53 $a[j].down > a[i].down$ \u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u7ef4\u7684\u504f\u5e8f\u4e5f\u6ee1\u8db3\u5173\u7cfb\u4e86\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u8003\u8651\u600e\u4e48\u628a\u5f0f\u5b50\u7ed9\u62c6\u5f00\u3002\n\n$| i-j | > k \\Rightarrow  i-j>k$ \u6216 $i-j<-k \\Rightarrow i>j+k$ \u6216 $i<j-k$\n\n\u90a3\u4e48\u6211\u4eec\u5f00\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u4e00\u4e2a\u5f80\u4e0a\u7ef4\u62a4\uff0c\u4e00\u4e2a\u5f80\u4e0b\u7ef4\u62a4\u3002\u5728 $j$ \u6ee1\u8db3\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5206\u522b\u5728\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\u4e2d\uff0c$a[j].val$ \u4e3a\u4e0b\u6807\u7684\u5730\u65b9 $+1$\u3002\u7136\u540e\u6211\u4eec\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u6211\u4eec $query1(a[i].val-k-1)$\uff0c\u4e00\u4e2a $query2(a[i].val+k+1)$\uff0c\u8fd9\u4e24\u4e2a\u7684\u548c\u5c31\u662f\u7b54\u6848\u3002\n\n\u6ce8\u610f\uff0c\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u7531\u4e8e\u7ef4\u62a4\u7684\u65b9\u5411\u6b63\u597d\u662f\u76f8\u53cd\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5f00\u4e24\u4e2a\u6570\u7ec4\u3002\u6211\u4e00\u5f00\u59cb\u5c31\u5f00\u4e86\u4e00\u4e2a\u6570\u7ec4\uff0c\u7136\u540e\u6539\u4e86\u597d\u957f\u65f6\u95f4\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define re register\n#define ll long long \n#define int long long \n#define rep(a,b,c)  for(re int a(b) ; a<=c ; ++a)\n#define drep(a,b,c) for(re int a(b) ; a>=c ; --a)\nusing namespace std;\ninline int read(){\n    int x=0,f=1;char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch == '-') f=-1 ; ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48) ; ch=getchar();}\n    return x*f;\n}\nconst int M = 2e5+10;\nint n,k,ans;\nint c1[M],c2[M];\nstruct node{\n    int up,down,val;\n}a[M];\ninline int lowbit(int x) { return x & -x; }\ninline void update1(int x,int y){\n    while(x <= n){\n        c1[x] += y;\n        x += lowbit(x);\n    }\n}\ninline void update2(int x,int y){\n    while(x){\n        c2[x] += y;\n        x -= lowbit(x);\n    }\n}\ninline int query1(int x){\n    if(x < 1) return 0;\n    int res = 0;\n    while(x){\n        res += c1[x];\n        x -= lowbit(x);\n    }\n    return res;\n}\ninline int query2(int x){\n    if(x > n) return 0;\n    int res = 0;\n    while(x <= n){\n        res += c2[x];\n        x += lowbit(x);\n    }\n    return res;\n}\ninline bool cmp1(node a,node b) { return a.up < b.up; }\ninline bool cmp2(node a,node b) { return a.down > b.down; }\ninline void cdq(int l,int r){\n    if(l == r) return;\n    int mid = (l+r)>>1;\n    cdq(l,mid),cdq(mid+1,r);\n    sort(a+l,a+mid+1,cmp2),sort(a+mid+1,a+r+1,cmp2);\n    int j = l;\n    rep(i,mid+1,r){\n        while(j <= mid && a[j].down > a[i].down){\n            update1(a[j].val,1);\n            update2(a[j].val,1);\n            j++;\n        }\n        ans += query1(a[i].val-k-1) + query2(a[i].val+k+1);\n    }\n    rep(k,l,j-1) update1(a[k].val,-1),update2(a[k].val,-1);\n}\nsigned main(){\n    n = read(),k = read();\n    rep(i,1,n){\n        int x = read();\n        a[x].up = i;\n        a[x].val = x;\n    }\n    rep(i,1,n){\n        int x = read();\n        a[x].down = i;\n    }\n    sort(a+1,a+n+1,cmp1);\n    cdq(1,n);\n    printf(\"%lld\\n\",ans);\n    return 0;   \n}\n```\n",
        "postTime": 1666006560,
        "uid": 226367,
        "name": "glorious_dream",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 \u6d1b\u8c37P3658[USACO17FEB]Why Did the Cow Cross the Road III P"
    },
    {
        "content": "\u89c2\u5bdf\u6837\u4f8b\u53d1\u73b0\uff0c$(1,3),(1,4)$ \u53ea\u4f1a\u7b97\u4e00\u6b21\uff0c\u4e5f\u5c31\u662f\u8bf4 $(3,1),(4,1)$ \u4e0d\u7b97\u5165\u7b54\u6848\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u59a8\u94a6\u5b9a $i<j$\u3002\n\n\u7531\u4e8e\u662f\u4e00\u4e2a\u6392\u5217\uff0c\u6240\u4ee5\u4ee4 $\\forall i \\in [1,n]$ \u5728 $A$ \u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $a_i$\uff0c\u5728 $B$ \u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $b_i$\u3002\u753b\u4e2a\u56fe\u53ef\u4ee5\u53d1\u73b0\u6709\u4ea4\u53c9\u5f53\u4e14\u4ec5\u5f53 $a_i<a_j,b_i>b_j$ \u6216 $a_i>a_j,b_i<b_j$\u3002\u7531\u4e8e\u6211\u4eec\u94a6\u5b9a\u4e86 $i<j$\uff0c\u6240\u4ee5 $|i-j|>k$ \u7684\u6761\u4ef6\u5c31\u8f6c\u5316\u4e3a\u4e86 $j-i>k,j>i+k$\u3002\u4ee4 $c_i=i,d_i=i+k$\uff0c\u5219\u539f\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\uff1a\n\n$$\\{(i,j)|a_i<a_j,b_i>b_j,d_i<c_j\\} \\cup \\{(i,j)|a_i>a_j,b_i<b_j,d_i<c_j\\}$$\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u6807\u51c6\u7684\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u7528 cdq \u5206\u6cbb + \u6811\u72b6\u6570\u7ec4\u5373\u53ef\u89e3\u51b3\u3002\n\n\u867d\u7136\u4e24\u79cd\u60c5\u51b5\u90fd\u662f $d_i<c_j$\uff0c\u4f46\u662f $c,d$ \u662f\u4e24\u4e2a\u6570\u7ec4\u3002\u4e3a\u4e86\u907f\u514d\u5728\u6392\u5e8f\u4e0a\u7684\u74f6\u9888\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86\u4e24\u6b21 cdq \u5206\u6cbb\u3002\u6bcf\u6b21\u6309 $a$ \u6392\u5e8f\uff0ccdq \u5206\u6cbb\u628a $b$ \u5408\u6cd5\u7684 $j$ \u52a0\u5165\u6811\u72b6\u6570\u7ec4\u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u7b97\u51fa\u5df2\u7ecf\u52a0\u5165\u6811\u72b6\u6570\u7ec4\u7684\u4f7f\u5f97 $c_j>d_i$ \u7684 $j$ \u6709\u591a\u5c11\u4e2a\u5373\u53ef\u3002\n\n### Code\uff1a\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\nint n, m, k, ans, tmp;\nstruct node{\n\tint x, y, c, d, tot;\n}a[100010];\nint cmp1(node p, node q){\n\treturn p.x < q.x;\n}\nint cmp2(node p, node q){\n\treturn p.x > q.x;\n}\nint cmp3(node p, node q){\n\treturn p.y < q.y;\n}\nint cmp4(node p, node q){\n\treturn p.y > q.y;\n}\nstruct BIT{\n\tint d[200010];\n\tvoid add(int p, int x){\n\t\tfor (; p<=n+k; p+=p&-p) d[p] += x;\n\t}\n\tint query(int p){\n\t\tint ret = 0;\n\t\tfor (; p; p-=p&-p) ret += d[p];\n\t\treturn ret;\n\t}\n}S, T;\nvoid cdq1(int l, int r){\n\tif (l == r) return ;\n\tint mid = l + r >> 1;\n\tcdq1(l, mid); cdq1(mid+1, r);\n\tsort (a+l, a+mid+1, cmp3);\n\tsort (a+mid+1, a+r+1, cmp3);\n\tint i=l, j=mid+1;\n\tfor (; i<=mid; i++){\n\t\twhile (j <= r && a[i].y > a[j].y){\n\t\t\tS.add(a[j].c, 1);\n\t\t\tj ++;\n\t\t}\n\t\ta[i].tot += S.query(n+k) - S.query(a[i].d);\n\t}\n\tfor (i=mid+1; i<j; i++){\n\t\tS.add(a[i].c, -1);\n\t}\n}\nvoid cdq2(int l, int r){\n\tif (l == r) return ;\n\tint mid = l + r >> 1;\n\tcdq2(l, mid); cdq2(mid+1, r);\n\tsort (a+l, a+mid+1, cmp4);\n\tsort (a+mid+1, a+r+1, cmp4);\n\tint i=l, j=mid+1;\n\tfor (; i<=mid; i++){\n\t\twhile (j <= r && a[i].y < a[j].y){\n\t\t\tT.add(a[j].c, 1);\n\t\t\tj ++;\n\t\t}\n\t\ta[i].tot += T.query(n+k) - T.query(a[i].d);\n\t}\n\tfor (int i=mid+1; i<j; i++){\n\t\tT.add(a[i].c, -1);\n\t}\n}\nsigned main(){\n\tscanf (\"%lld%lld\", &n, &k);\n\tfor (int i=1; i<=n; i++){\n\t\tscanf (\"%lld\", &tmp);\n\t\ta[tmp].x = i;\n\t\ta[i].c = i, a[i].d = i + k;\n\t}\n\tfor (int i=1; i<=n; i++){\n\t\tscanf (\"%lld\", &tmp);\n\t\ta[tmp].y = i;\n\t}\n\tsort (a+1, a+n+1, cmp1);\n\tcdq1(1, n);\n\tsort (a+1, a+n+1, cmp2);\n\tcdq2(1, n);\n\tfor (int i=1; i<=n; i++){\n\t\tans += a[i].tot;\n\t}\n\tprintf (\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1658910780,
        "uid": 399286,
        "name": "\u82cf\u8054\u5c0f\u6e23",
        "ccfLevel": 0,
        "title": "[\u9898\u89e3] P3658 [USACO17FEB]Why Did the Cow Cross the Road III P"
    },
    {
        "content": "## \u89e3\u9898\u601d\u8def\uff1a\n\u9898\u76ee\u8981\u6c42\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\u7684\u70b9\u5bf9 $(i,j)$ \u6570\uff1a\n\n$\\begin{cases}a_i>b_i\\\\a_j<b_j\\\\|i-j|>k\\end{cases}$\n\n$a_i$ \u548c $b_i$ \u5206\u522b\u8868\u793a $i$ \u6392\u5217 $A$ \u548c\u6392\u5217 $B$ \u4e2d\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u628a\u76f8\u540c\u7684\u6570\u8fde\u8d77\u6765\uff0c\u4e24\u6761\u8fde\u7ebf\u76f8\u4ea4\uff0c\u6240\u4ee5\u8981\u6ee1\u8db3\u524d\u4e24\u4e2a\u5f0f\u5b50\u3002\n\n\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u6570\u5bf9 $(x,y,z)$ \u7684\u4e09\u7ef4\u504f\u5e8f\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528 cdq \u5206\u6cbb\uff08[\u6a21\u677f\u9898](https://www.luogu.com.cn/problem/P3810)\uff09\u89e3\u51b3\u3002\n\n$x$ \u4e3a\u67d0\u4e2a\u6570\u5b57\u5728 $A$ \u4e2d\u7684\u4f4d\u7f6e\uff0c$y$ \u4e3a\u8fd9\u4e2a\u6570\u5b57\u5728 $B$ \u4e2d\u7684\u4f4d\u7f6e\uff0c$z$ \u4e3a\u8fd9\u4e2a\u6570\u5b57\u3002\n\n\u9996\u5148\u901a\u8fc7\u7b2c\u4e00\u5173\u952e\u5b57\u548c\u7b2c\u4e8c\u5173\u952e\u5b57\u7684\u5904\u7406\u65b9\u6cd5\u548c\u6a21\u677f\u4e00\u6837\uff0c\u5bf9\u4e8e\u7b2c\u4e09\u7ef4\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff1a\n```cpp\nans+=query(n)-(query(no[i].c+k)-query(no[i].c-k-1));\n```\n\u8fd0\u7528\u4e86\u67e5\u5206\u524d\u7f00\u548c\u7684\u601d\u60f3\uff0c$sum[1,c-k-1]+sum[c+k+1,n]=sum[1,n]-(sum[1,c+k]-sum[1,c-k-1])$\u3002\n\n\u6700\u540e\u6ce8\u610f\u4e24\u4e2a\u70b9\uff1a\n\n1\u3001\u6ce8\u610f\u6811\u72b6\u6570\u7ec4\u67e5\u8be2\u65f6\u7684\u5b9a\u4e49\u57df\u8981\u63a7\u5236\u5728 $[0,n]$\u3002\n\n2\u3001\u8bb0\u5f97 $ans$ \u5f00 long long\uff0c\u4e0d\u7136 wa \u7b2c $2$ \u4e2a\u70b9\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#define rep(x,y,z) for(int x=y;x<=z;x++)\n#define per(x,y,z) for(int x=z;x>=y;x--)\nusing namespace std;\nconst int N=1e5+10;\nstruct node\n{\n\tint a,b,c;\n}no[N];\nint MAP[N];\nlong long ans;\nint t[N],n,k;\ninline void add(int i,int x) {while(i<=n) t[i]+=x,i+=i&-i;}\ninline int query(int i) {i=min(i,n);i=max(i,0);int sum=0;while(i) sum+=t[i],i-=i&-i;return sum;}\nbool comp(const node &P,const node &Q) {return P.a!=Q.a?(P.a<Q.a):(P.b!=Q.b?P.b>Q.b:P.c<Q.c);}\nbool comp2(const node &P,const node &Q) {return P.b!=Q.b?P.b>Q.b:P.c<Q.c;}\nvoid CDQ(int l,int r)\n{\n\tif(l==r) return ;\n\tint mid=l+r>>1;\n\tCDQ(l,mid);\n\tCDQ(mid+1,r);\n\tsort(no+l,no+mid+1,comp2);//[l,mid]\n\tsort(no+mid+1,no+r+1,comp2);//[mid+1,r]\n\tint j=l;\n\trep(i,mid+1,r)\n\t{\n\t\twhile(j<=mid&&no[j].b>no[i].b) add(no[j].c,1),j++;\n\t\tans+=query(n)-(query(no[i].c+k)-query(no[i].c-k-1));//[1,no[i].c-k],[no[i].c+k,n]\n\t}\n\trep(i,l,j-1) add(no[i].c,-1);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&k);\n\trep(i,1,n) {int x;scanf(\"%d\",&x);MAP[x]=i;}\n\trep(i,1,n)\n\t{\n\t\tint x;\n\t\tscanf(\"%d\",&x);\n\t\tno[i]=(node) {MAP[x],i,x};\n\t}\n\tsort(no+1,no+1+n,comp);\n\tCDQ(1,n);\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1656229139,
        "uid": 571634,
        "name": "hgzxwzf",
        "ccfLevel": 7,
        "title": "P3658 [USACO17FEB]"
    },
    {
        "content": "\u8bbe\u4e24\u4e2a\u5e8f\u5217\u4e3aa,b\u3002\n\nb\u4e2d\u4f4d\u7f6ei,j\u88ab\u8ba1\u7b97\n\n\u6ee1\u8db3\u7684\u6761\u4ef6\u5c31\u662f\n\ni<j\ni\u5bf9\u5e94\u7684a\u4e2d\u7684\u4f4d\u7f6e>j\u5bf9\u5e94\u7684\n\n|b[i]-b[j]|>k\n\u8fd9\u662f\u4e00\u4e2a\u4e09\u7ef4\u504f\u5e8f\u95ee\u9898\u3002\n\n\u53ef\u4ee5\u6309\u987a\u5e8f\u679a\u4e3e\u4e00\u7ef4\uff0c\u7528kd-tree\u7ef4\u62a4\u5176\u4ed6\u4e24\u7ef4\u3002\n\n\u65f6\u95f4O(nlog^2)\n\n\n\u56e0\u4e3akd-tree\u4f3c\u4e4e\u4f1a\u6bd4cdq\u5206\u6cbb\u6162\u4e00\u4e9b\n\n\u6240\u4ee5\u8fd9\u9898\u4f1a\u6bd4\u8f83\u5361\u5e38(\u672c\u673a\u8dd1\u76841.1s)\n\n\u6240\u4ee5\u6211\u8fc7\u4e0d\u4e86\u3002\u3002\n\n```cpp\n# pragma opitimie \"O2\"\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\n#define rep(i,n) for(int i=1;i<=n;++i)\n#define gc (c=getchar())\nint read()\n{\n    char c;\n    while(gc<'0');\n    int x=c-'0';\n    while(gc>='0')x=x*10+c-'0';\n    return x;\n}\n\nconst int N=1e5+5;\nint n,dya[N]; \nstruct node\n{\n    int b,dy;//dy=b\u4e2d\u4f4d\u7f6ei\u5bf9\u5e94\u7684a\u4e2d\u4f4d\u7f6e\n    node *f,*cl,*cr;\n    int mndy,mxdy,mxb,mnb,s;bool live;\n}T[N];\nnode *q[N],*now,*rt;\n\nconst int L=2000;\nint nl,nr,ndy;ll ans;\n#define ok(mndy,mxb,mnb) (mndy>ndy&&(mxb<nl||mnb>nr))\nvoid qiu()\n{\n    static node *q[L];\n    q[1]=rt;\n    int tail=1;\n    for(int head=1;head<=tail;++head)\n    {\n     node *x=q[head];\n     if(!x->s)continue;\n     if(x->mxdy<ndy)continue;\n     if(x->mnb>=nl&&x->mxb<=nr)continue;\n     if(ok(x->mndy,x->mxb,x->mnb)){ans+=x->s;continue;}\n     if(x->live)\n     {\n        if(ok(x->dy,x->b,x->b)) ++ans;\n     }\n     if(x->cl)q[++tail]=x->cl;\n     if(x->cr)q[++tail]=x->cr;\n    }\n}\nvoid modify()\n{\n    int nb=now->b;\n    now->live=1;\n    for(node *x=now;x;x=x->f)\n    {\n        if(++x->s==1) {x->mndy=x->mxdy=ndy;x->mnb=x->mxb=nb;}\n        else \n        {\n            if(x->mndy>ndy)x->mndy=ndy; else\n            if(x->mxdy<ndy)x->mxdy=ndy;\n            if(x->mnb>nb)x->mnb=nb; else\n            if(x->mxb<nb)x->mxb=nb;\n        }\n    }\n}\n\nbool dy_xiao(node *x,node *y)\n{\n    return x->dy<y->dy;\n}\nbool b_xiao(node *x,node *y)\n{\n    return x->b<y->b;\n}\nnode* build(int l,int r,bool d)\n{\n    int mid=l+r>>1;\n    nth_element(q+l,q+mid,q+r+1,!d?dy_xiao:b_xiao);\n    node *rt=q[mid];\n    if(l!=mid)(rt->cl=build(l,mid-1,!d))->f=rt;\n    if(r!=mid)(rt->cr=build(mid+1,r,!d))->f=rt;\n    return rt;\n}\n\nint main()\n{\n    n=read();int k=read();\n    rep(i,n)dya[read()]=i;\n    rep(i,n)T[i].dy=dya[T[i].b=read()];\n    \n    rep(i,n)q[i]=T+i;\n    rt=build(1,n,0);\n    \n    rep(i,n)\n    {\n        now=T+i;\n        nl=now->b-k;nr=now->b+k;ndy=now->dy;\n        qiu();\n        modify();\n    }\n    printf(\"%lld\\n\",ans);\n}\n```",
        "postTime": 1496806359,
        "uid": 9168,
        "name": "kczno1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3658 \u3010[USACO17FEB]Why Did the Cow Cross the Road III P\u3011"
    }
]