[
    {
        "content": "## F - Quark and Graph\n\n#### $\\text{Description}$\n\n\u73b0\u6709\u4e00 $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u6709\u6807\u53f7\u7b80\u5355\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u8fb9\u6743\u5168\u4e3a $1$\u3002\n\n\u5df2\u77e5 $1$ \u8282\u70b9\u5230\u6240\u6709\u8282\u70b9\u7684\u6700\u77ed\u8def\u957f\uff0c\u6c42\u8fd9\u5f20\u56fe\u6709\u591a\u5c11\u79cd\u53ef\u80fd\u7684\u5f62\u6001\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n\u4e24\u5f20\u56fe $G=(V,E)$ \u548c $G'=(V',E')$ \u5f62\u6001\u4e0d\u540c\u5f53\u4e14\u4ec5\u5f53\u5b58\u5728\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(u,v)$ \u6ee1\u8db3 $u,v\\in[1,n]\\cap N_+,(u,v)\\in E,(u,v)\\notin E'$\u3002\n\n#### $\\text{Solution}$\n\n\u6309\u7167\u6700\u77ed\u8def\u957f\u5206\u5c42\uff08\u6700\u77ed\u8def\u957f\u5373\u5c42\u6570\uff09\uff0c\u8bb0 $1$ \u5230 $x$ \u7684\u6700\u77ed\u8def\u957f\u4e3a $d_x$\uff0c\u5b9a\u4e49 $t_i,T$\uff1a\n\n$$t_i=\\displaystyle\\sum_{j=1}^n[d_j=i],T=\\max\\limits_{t_i>0}\\{i\\}$$\n\n\u6211\u4eec\u79f0\u76f8\u90bb\u4e24\u5c42\u4e4b\u95f4\u7684\u8fb9\u4e3a\u6811\u8fb9\uff0c\u540c\u5c42\u4e4b\u95f4\u7684\u8fb9\u4e3a\u975e\u6811\u8fb9\uff0c\u5b9a\u4e49 $f_i,f^\\ast_i$ \u5206\u522b\u8868\u793a\u6811\u8fb9\u53d6 $i$ \u6761\u7684\u65b9\u6848\u6570\uff0c\u975e\u6811\u8fb9\u53d6 $i$ \u6761\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u6700\u540e\u7b54\u6848\u4e3a\uff1a\n\n$$Ans=\\displaystyle\\sum_{i+j=m}f_i\\cdot f^\\ast_j$$\n\n\u4e0a\u5f0f\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u6c42\u51fa $f_i,f^\\ast_i $\uff0c\u7136\u540e\u518d\u5377\u8d77\u6765\u3002\n\n\u5148\u8003\u8651 $f_i$\u3002\u53d1\u73b0\u6700\u540e\u7b54\u6848\u662f\u7b2c $1$ \u5c42\u5230\u7b2c $T$ \u5c42\u4e0e\u5176\u4e0a\u4e00\u5c42\u4e4b\u95f4\u7684\u7b54\u6848\u7684\u5377\u79ef\u3002\u6240\u4ee5\u6211\u4eec\u5206\u522b\u8003\u8651\u6bcf\u4e00\u5c42\u3002\u6211\u4eec\u5c06\u6bcf\u4e00\u5c42\u4e0e\u5176\u4e0a\u4e00\u5c42\u4e4b\u95f4\u7684\u8fb9\u6309\u7167\u5f53\u524d\u5c42\u7684\u70b9\u5206\u4e3a $t_i$ \u4e2a\u90e8\u5206\uff0c\u7b2c $i$ \u4e2a\u90e8\u5206\u5305\u542b\u7684\u662f\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u4e3a $i$ \u8282\u70b9\u7684\u8fb9\u3002\u90a3\u4e48\u6bcf\u4e00\u5c42\u4e0e\u5176\u4e0a\u4e00\u5c42\u7684\u7b54\u6848\u53c8\u662f\u5176\u6bcf\u4e2a\u90e8\u5206\u7684\u7b54\u6848\u7684\u5377\u79ef\u3002\u6bcf\u4e2a\u90e8\u5206\u7684\u751f\u6210\u51fd\u6570\u6839\u636e\u4e8c\u9879\u5f0f\u5b9a\u7406\u53ef\u4ee5\u5f97\u5230\u662f\uff1a\n\n$$K(x)=(1+x)^{t_{i-1}}-1$$\n\n\u8fdb\u4e00\u6b65\u5730\uff0c\u6bcf\u4e00\u5c42\u7684\u7b54\u6848\u5b9e\u9645\u4e0a\u662f\uff1a\n\n$K^{\\ast}(x)=[(1+x)^{t_{i-1}}-1]^{t_i}$\n\n\u90a3\u4e48\u6811\u8fb9\u7684\u751f\u6210\u51fd\u6570\u5b9e\u9645\u4e0a\u5c31\u662f\uff1a\n\n$F(x)=\\displaystyle \\prod\\limits_{i=1}^T[(1+x)^{t_{i-1}}-1]^{t_{i}}$\n\nPS\uff1a\u505a\u5230\u8fd9\u4e00\u6b65\u65f6\uff0c\u6211\u4eec\u628a\u6bcf\u4e00\u5c42\u7684\u751f\u6210\u51fd\u6570\u5904\u7406\u51fa\u6765\uff0c\u7136\u540e\u7528\u7c7b\u4f3c\u5408\u5e76\u679c\u5b50\u7684\u65b9\u6cd5\uff0c\u6bcf\u6b21\u53d6\u51fa\u6b21\u6570\u6700\u4f4e\u7684\u4e24\u4e2a\u591a\u9879\u5f0f\u76f8\u4e58\uff0c\u5728\u672c\u9898\u7684\u9650\u5236\u4e0b\u53ef\u4ee5\u505a\u5230 $O(n\\log^2 n)$\uff0c\u505a\u6cd5\u6765\u81ea EA\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\uff0c\u6211\u4eec\u5b9a\u4e49 $G(x)$\uff1a\n\n$$G(x)=F(x-1)=\\displaystyle\\prod\\limits_{i=1}^T[x^{t_{i-1}}-1]^{t_{i}}$$\n\n\u53f3\u8fb9\u662f\u4e58\u79ef\uff0c\u4e0d\u597d\u641e\uff0c\u5bf9\u5b83\u53d6 $\\ln$ \u540e\u518d\u505a $\\exp$\uff1a\n\n$$G(x)=\\displaystyle\\exp\\ln \\prod_{i=1}^T[x^{t_{i-1}}-1]^{t_{i}}$$\n\n\u7136\u540e\u5e38\u89c4\u5730\u4e58\u5316\u52a0\uff0c\u5e42\u5316\u4e58\uff1a\n\n$$G(x)=\\displaystyle\\exp[\\sum_{i=1}^Tt_i\\ln(x^{t_{i-1}}-1) ]$$\n\n\u7136\u540e\u9700\u8981\u628a $\\ln $ \u5316\u6210\u6211\u4eec\u60f3\u8981\u7684\u5f62\u5f0f\uff1a\n\n$$G(x)=\\displaystyle\\exp\\{\\sum_{i=1}^Tt_i[\\ln(-1)-\\ln(\\frac{1}{1-x^{t_{i-1}}})] \\}$$\n\n\u53d1\u73b0\u524d\u534a\u90e8\u5206\u53ef\u4ee5\u62c6\u51fa\u6765\uff1a\n\n$$G(x)=\\displaystyle\\frac{(-1)^{\\sum\\limits_{i=1}^Tt_i}}{\\exp[\\sum\\limits_{i=1}^Tt_i\\cdot\\ln(\\frac{1}{1-x^{t_{i-1}}})]}$$\n\n\u6211\u4eec\u5b9a\u4e49 $H(x)$\uff1a\n\n$$H(x)=\\displaystyle\\sum\\limits_{i=1}^Tt_i\\cdot\\ln(\\frac{1}{1-x^{t_{i-1}}})$$\n\n\u7136\u540e\u5bf9 $\\ln$ \u6765\u4e00\u6ce2\u6cf0\u52d2\u5c55\u5f00\uff1a\n\n$$H(x)=\\displaystyle\\sum\\limits_{i=1}^Tt_i\\cdot\\sum\\limits_{j=1}^{+\\infty}\\frac{x^{jt_{i-1}}}{j}$$\n\n\u8bb0 $c_k=\\displaystyle\\sum\\limits_{i=1}^Tt_i[t_{i-1}=k]$\n\n\u679a\u4e3e $k$\uff0c\u5408\u5e76\u4e00\u4e0b\u540c\u7c7b\u9879\uff1a\n\n$$H(x)=\\displaystyle\\sum_{k=1}^nc_k\\sum\\limits_{j=1}^{+\\infty}\\frac{x^{jk}}{j}$$ \n\n\u7531\u4e8e\u6211\u4eec\u5b9e\u9645\u8981\u6c42\u7684\uff1a\n\n$$G(x)=\\displaystyle\\frac{(-1)^{n-1}}{\\exp H(x)}$$\n\n\u8bb0\u6811\u8fb9\u603b\u6570\u4e3a $s$\uff0c\u6211\u4eec\u8981\u6c42\u51fa $G$ \u7684\u524d $s+1$ \u9879\uff0c\u56e0\u4e3a\u9ad8\u6b21\u9879\u53ef\u4ee5\u901a\u8fc7\u4e8c\u9879\u5f0f\u5b9a\u7406\u8d21\u732e\u5230\u4f4e\u6b21\u9879\u3002\n\n\u90a3\u4e48\u600e\u4e48\u901a\u8fc7 $G(x)=F(x-1)$ \u6c42\u5f97 $F(x)$ \u5462\uff1f\n\n\u6ce8\u610f\u5230 $G(x+ 1)=F(x)$\uff0c\u6211\u4eec\u5c55\u5f00\u6309\u7167 CF923E \u7684\u505a\u6cd5\u5373\u53ef\u3002\n\n---\n\n\u73b0\u5728\u6765\u8003\u8651\u975e\u6811\u8fb9\u7684\u751f\u6210\u51fd\u6570 $F^\\ast(x)$\u3002\n\n\u5148\u6c42\u975e\u6811\u8fb9\u603b\u6570\uff1a\n\n$S=\\displaystyle\\sum_{i=1}^T\\frac{t_i(t_{i}-1)}{2}$\n\n\u90a3\u4e48\u751f\u6210\u51fd\u6570\u5e94\u8be5\u662f\uff1a\n\n$$F^\\ast(x)=\\displaystyle\\sum_{i=0}^{+\\infty}{S\\choose i}x^i$$\n\n\u7531\u4e8e\u6211\u4eec\u662f\u5728\u6a21 $P=998244353$ \u610f\u4e49\u4e0b\u8fdb\u884c\u8fd0\u7b97\uff0c\u6240\u4ee5\u5f53 $S>P$ \u65f6\u4f1a\u6709\u4e9b\u5947\u602a\u7684\u95ee\u9898\u3002\u8fdb\u4e00\u6b65\u5206\u6790\uff0c\u53d1\u73b0\u5f53 $i>S\\bmod{P}$ \u65f6\u7cfb\u6570\u90fd\u4e3a $0$\u3002\u8fd9\u662f\u56e0\u4e3a\u5c06\u7ec4\u5408\u6570\u62c6\u5f00\u540e\uff0c$(S-i)!$ \u6ca1\u80fd\u628a $S!$ \u7684\u8d28\u56e0\u5b50\u4e2d\u7684 $P$ \u5168\u90e8\u6d88\u53bb\u3002\u6545\u6211\u4eec\u53ea\u9700\u8ba1\u7b97\uff1a\n\n$$F^\\ast(x)=\\displaystyle\\sum_{i=0}^{\\min(m,S\\bmod{P})}{S\\choose i}x^i$$\n\n\u6211\u4eec\u89c2\u5bdf\u7ec4\u5408\u6570\u516c\u5f0f\uff1a\n\n$$\\displaystyle{n\\choose m}=\\frac{n!}{m!(n-m)!}$$\n\n\u5728\u5f0f\u5b50\u4e2d\uff0c$m$ \u7684\u9636\u4e58\u7531\u4e8e\u5176\u6bd4\u8f83\u5c0f\uff0c\u6211\u4eec\u5728\u4e0a\u9762\u9884\u5904\u7406\u65f6\u5df2\u7ecf\u6c42\u8fc7\u4e86\uff0c\u6240\u4ee5\u91cd\u70b9\u89c2\u5bdf\u53e6\u4e24\u4e2a\u9636\u4e58\u3002\n\n\u6ce8\u610f\u5230\u6211\u4eec\u8981\u6c42\u7684\u5b9e\u9645\u4e0a\u662f\uff1a\n\n$$S^{\\underline{k}},(0\\le k\\le S\\bmod{P})$$\n\n\u5728\u6c42\u503c\u7684\u65f6\u5019\u52a8\u6001\u7ef4\u62a4\u4e00\u4e2a\u540e\u7f00\u79ef\u5373\u53ef\u3002\n\n\u6700\u540e\u590d\u6742\u5ea6\u5b9e\u9645\u4e0a\u548c\u6811\u8fb9\u603b\u6570\u6709\u5173\uff08\u4e00\u4e2a log\uff09\uff0c\u90a3\u4e2a\u5947\u602a\u7684\u9650\u5236\u5b9e\u9645\u4e0a\u662f\u5bf9\u6811\u8fb9\u603b\u6570\u4e00\u4e2a\u7c97\u7565\u7684\u4f30\u8ba1\u3002",
        "postTime": 1588500855,
        "uid": 83547,
        "name": "LCuter",
        "ccfLevel": 7,
        "title": "[QkOI#R1] Quark and Graph \u5b98\u65b9\u9898\u89e3"
    },
    {
        "content": "## \u9898\u9762\n\u5df2\u77e5\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u65e0\u6743\u65e0\u5411\u56fe\u4e2d 1 \u53f7\u70b9\u5230 $i (1\\le i\\le n)$ \u53f7\u70b9\u7684\u6700\u77ed\u8def $d_i$\uff0c\u8bd5\u6c42\u6070\u597d $m$ \u6761\u8fb9\u7684\u65b9\u6848\u6570\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$n\\le 10^5, m\\le 2\\cdot 10^5$\uff0c\u4ee4 $t_i=\\sum_j [d_j=i]$ \u5219\u6709 $\\sum_i t_it_{i+1}\\le 2\\cdot 10^5$\u3002\n\n## \u9898\u89e3\n\n\u5c06\u56fe\u53d8\u6210\u5206\u5c42\u56fe\uff0c\u8fb9\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u662f\u6bcf\u5c42\u95f4\u7684\u8fb9\uff0c\u4e00\u90e8\u5206\u662f\u76f8\u90bb\u4e24\u5c42\u7684\u8fb9\uff0c\u6240\u4ee5\u4e0d\u96be\u77e5\u9053\u7b54\u6848\u662f\n\n$$ [x^m] \\prod_{i=0}^{D-1} \\left( \\sum_{n\\ge 1} x^n \\binom{a_i}{n} \\right)^{a_{i+1}} \\prod_{i=0}^n \\left( \\sum_{n\\ge 0} x^n \\binom{a_i(a_i-1)/2}{n} \\right) $$\n\n\u8fd9\u4e2a\u751f\u6210\u51fd\u6570\u662f\n\n$$ \\left( \\prod_{i=0}^{D-1} ((x+1)^{a_i} -1) ^{a_{i+1}} \\right) (x+1)^{\\sum\\limits_{i=0}^D a_i(a_i-1)/2 } $$\n\n\u63a5\u4e0b\u6765\u5e94\u5f53\u6ce8\u610f\u5230\u9898\u76ee\u4e2d\u5947\u602a\u7684\u6570\u636e\u8303\u56f4 $\\sum\\limits_i a_ia_{i+1} \\le 2\\cdot 10^5$\uff0c\u4ee4\u5176\u4e3a $S$\uff0c\u5219\u53ef\u4ee5\u53d1\u73b0\u5de6\u4fa7\u7684\u4e58\u79ef\u5f0f\u7684\u957f\u5ea6\u662f $S$ \u7ea7\u522b\u7684\uff0c\u6240\u4ee5\u6211\u731c\u6d4b\u8fd9\u91cc\u5e94\u8be5\u5df2\u7ecf\u80fd\u591f\u505a\u4e86\uff0c\u4f46\u6211\u4e0d\u662f\u592a\u6e05\u695a\u3002\n\n\u8a00\u5f52\u6b63\u4f20\uff0c\u63a5\u4e0b\u6765\u4f7f\u7528\u5957\u8def\uff1a\n\n$$ \\prod_{i=0}^{D-1} ((x+1)^{a_i} -1) ^{a_{i+1}} = \\exp \\sum_{i=0}^{D-1} a_{i+1} \\ln ((x+1)^{a_i} -1) $$\n\n\u597d\u5427\u8fd9\u662f\u4e2a\u4ec0\u4e48\u73a9\u610f\uff0cln \u91cc\u8fb9\u7684\u5f62\u5f0f\u5e42\u7ea7\u6570\u4e00\u6b21\u9879\u6839\u672c\u5c31\u662f 0\u3002\n\n\u6240\u4ee5\u91cd\u65b0\u505a\u4e00\u904d\uff0c\u6211\u4eec\u505a\u6362\u5143 $z=x+1$\uff0c\u518d\u505a\u4e00\u6b21\uff1a\n\n$$\nG(z)=\\prod_{i=0}^{D-1} (z^{a_i} - 1) ^{a_{i+1}} = (-1)^{\\sum\\limits_{i=1}^D a_i} \\exp \\left( \\sum_{i=0}^{D-1} a_{i+1} \\ln (1-z^{a_i})  \\right) = (-1)^{\\sum\\limits_{i=1}^D a_i} \\exp \\left( - \\sum_{i=0}^{D-1} a_{i+1} \\sum_{j\\ge 1} \\frac{z^{ja_i}}{j}  \\right)\n$$\n\n\u5982\u679c\u6211\u4eec\u8981\u6c42\u51fa\u8fd9\u4e2a\u5f62\u5f0f\u5e42\u7ea7\u6570\u7684\u524d $L$ \u9879\uff0c\u7531\u4e8e exp \u91cc\u7684\u5f62\u5f0f\u5e42\u7ea7\u6570\u7684\u6709\u6548\u9879\u4e3a $O(\\sum_i \\frac{L}{i})=O(L\\log L)$\uff0c\u56e0\u6b64\u6c42\u51fa\u8fd9\u4e2a\u5f0f\u5b50\u7684\u590d\u6742\u5ea6\u662f $O(L\\log L)$\u3002\n\n\u73b0\u5728\u6211\u4eec\u9700\u8981\u8fd8\u539f\u6362\u5143\u4e4b\u524d\u7684\u5f0f\u5b50\uff0c\u5f88\u660e\u663e\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fd9\u4e2a\u5f62\u5f0f\u5e42\u7ea7\u6570\uff08\u591a\u9879\u5f0f\uff09\u6240\u6709\u7684\u4fe1\u606f\uff0c\u6240\u4ee5\u6c42\u51fa $[z^{0\\sim S}]G(z)$\u3002\n\n$$\n\\begin{aligned}\nF(x) = G(x+1) = \\sum_{i\\ge 0} g_i (x+1)^i = \\sum_{i\\ge 0} g_i \\sum_{j\\ge 0} \\binom{i}{j} x^j = \\sum_{j\\ge 0} x^j \\sum_{i\\ge 0} g_i \\binom{i}{j} \\\\\n= \\sum_{j\\ge 0} x^j \\sum_{i\\ge 0} g_{i+j} \\frac{(i+j)!}{i!j!} = \\sum_{j\\ge 0} \\frac{x^j}{j!} \\sum_{i\\ge 0} \\frac{h_{S-i-j}}{i!}\n\\end{aligned}\n$$\n\n\u5176\u4e2d $h_i=g_{S-i} (S-i)!$\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f $O(S\\log S)$ \u89e3\u51b3\u3002\n\n\u73b0\u5728\u8981\u8bf4\u521a\u624d\u88ab\u5ffd\u7565\u7684\u53f3\u534a\u90e8\u5206\uff0c\u7406\u6027\u5206\u6790\u4e00\u4e0b\u53d1\u73b0\u9879\u6570\u4e0d\u591a\u6240\u4ee5\u6211\u4eec\u7ef4\u62a4\u4e0b\u964d\u5e42\u5c31\u597d\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n + S\\log S + m\\log m)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\n#define ri register int\n\nconst int MAXN = 1000005, MOD = 998244353, Gen = 3;\n\nll q_pow(ll a, ll b, ll p = MOD) {\n\tll ret = 1;\n\tfor (; b; a = a * a % p, b >>= 1) if (b & 1) ret = ret * a % p;\n\treturn ret;\n}\nll inv(ll x, ll p = MOD) { return q_pow(x, p - 2, p); }\n\ninline int add(int x, int y) { return x + y > MOD ? x + y - MOD : x + y; }\ninline int dec(int x, int y) { return x - y < 0 ? x - y + MOD : x - y; }\ninline void Add(int& x, int y) { x += y; if (x >= MOD) x -= MOD; }\ninline void Dec(int& x, int y) { x -= y; if (x < 0) x += MOD; }\n\nint rev[21][MAXN], fac[MAXN], ifac[MAXN], I[MAXN];\nint rt[MAXN], irt[MAXN];\nvoid Dft(int* A, int LIM, int L) {\n\tfor (ri i = 0; i < LIM; ++i) if (i < rev[L][i]) swap(A[i], A[rev[L][i]]);\n\tfor (ri l = 2; l <= LIM; l <<= 1) {\n\t\tfor (ri i = 0; i < LIM; i += l) {\n\t\t\tfor (ri j = 0; j < (l >> 1); ++j) {\n\t\t\t\tll x = A[j | i], y = (ll)A[j | i | (l >> 1)] * rt[l | j] % MOD;\n\t\t\t\tA[j | i] = add(x, y), A[j | i | (l >> 1)] = dec(x, y);\n\t\t\t}\n\t\t}\n\t}\n}\nvoid iDft(int* A, int LIM, int L) {\n\tfor (ri i = 0; i < LIM; ++i) if (i < rev[L][i]) swap(A[i], A[rev[L][i]]);\n\tfor (ri l = 2; l <= LIM; l <<= 1) {\n\t\tfor (ri i = 0; i < LIM; i += l) {\n\t\t\tfor (ri j = 0; j < (l >> 1); ++j) {\n\t\t\t\tll x = A[j | i], y = (ll)A[j | i | (l >> 1)] * irt[l | j] % MOD;\n\t\t\t\tA[j | i] = add(x, y), A[j | i | (l >> 1)] = dec(x, y);\n\t\t\t}\n\t\t}\n\t}\n\tint invLIM = inv(LIM);\n\tfor (ri i = 0; i < LIM; ++i) A[i] = 1ll * A[i] * invLIM % MOD;\n}\nvoid Multiply(int* A, int* B, int LIM, int L) {\n\tDft(A, LIM, L), Dft(B, LIM, L);\n\tfor (ri i = 0; i < LIM; ++i) A[i] = 1ll * A[i] * B[i] % MOD;\n\tiDft(A, LIM, L);\n}\n\nint Tinv[MAXN];\nvoid Inverse(const int* F, int* G, int LIM, int L) {\n\tG[0] = inv(F[0]);\n\tfor (ri lim = 2, l = 1; lim <= LIM; lim <<= 1, ++l) {\n\t\tfor (ri i = 0; i < lim; ++i) Tinv[i] = F[i];\n\t\tfor (ri i = lim; i < (lim << 1); ++i) Tinv[i] = 0;\n\t\tDft(Tinv, lim << 1, l + 1), Dft(G, lim << 1, l + 1);\n\t\tfor (ri i = 0; i < (lim << 1); ++i) G[i] = dec(add(G[i], G[i]), 1ll * Tinv[i] * G[i] % MOD * G[i] % MOD);\n\t\tiDft(G, lim << 1, l + 1);\n\t\tfor (ri i = lim; i < (lim << 1); ++i) G[i] = 0;\n\t}\n}\nvoid Derivative(int* F, int LIM) {\n\tfor (ri i = 0; i < LIM - 1; ++i) F[i] = 1ll * F[i + 1] * (i + 1) % MOD;\n\tF[LIM - 1] = 0;\n}\nvoid Inter(int* F, int LIM) {\n\tfor (ri i = LIM - 1; i >= 1; --i) F[i] = 1ll * F[i - 1] * I[i] % MOD;\n\tF[0] = 0;\n}\nint Tln[MAXN];\nvoid Ln(int* F, int LIM, int L) {\n\tInverse(F, Tln, LIM, L);\n\tDerivative(F, LIM);\n\tMultiply(F, Tln, LIM << 1, L + 1);\n\tInter(F, LIM);\n\tfor (ri i = 0; i < (LIM << 1); ++i) Tln[i] = 0;\n}\n\nint Texp[MAXN];\nvoid Exp(const int* F, int* G, int LIM, int L) {\n\tG[0] = 1;\n\tfor (ri lim = 2, l = 1; lim <= LIM; lim <<= 1, ++l) {\n\t\tfor (ri i = 0; i < lim; ++i) Texp[i] = G[i];\n\t\tfor (ri i = lim; i < (lim << 1); ++i) Texp[i] = 0;\n\t\tLn(G, lim, l);\n\t\tfor (ri i = 0; i < lim; ++i) G[i] = dec(F[i], G[i]);\n\t\tG[0] = add(G[0], 1);\n\t\tMultiply(G, Texp, lim << 1, l + 1);\n\t\tfor (ri i = lim; i < (lim << 1); ++i) G[i] = 0;\n\t}\n}\n\nint N, M, LIM = 1, L, a[MAXN], b[MAXN], D, S;\nint F[MAXN], G[MAXN], H[MAXN];\nint main() {\n\tscanf(\"%d%d\", &N, &M); int t;\n\tfor (int i = 1; i <= N; ++i) scanf(\"%d\", &t), ++a[t], D = max(t, D);\n\tfor (int i = 0; i < D; ++i) S += a[i] * a[i + 1];\n\n\twhile (LIM <= max(M, S) + 2) {\n        LIM <<= 1, ++L;\n        for (ri i = 0; i < LIM; ++i) rev[L][i] = (rev[L][i >> 1] >> 1) | ((i & 1) << (L - 1));\n        irt[LIM] = rt[LIM] = 1; int Wn = q_pow(Gen, (MOD - 1) / LIM), iWn = inv(Wn);\n        for (ri i = 1; i < (LIM >> 1); ++i) rt[i | LIM] = 1ll * rt[(i - 1) | LIM] * Wn % MOD, irt[i | LIM] = 1ll * irt[(i - 1) | LIM] * iWn % MOD;\n    }\n    LIM <<= 1, ++L;\n    for (ri i = 0; i < LIM; ++i) rev[L][i] = (rev[L][i >> 1] >> 1) | ((i & 1) << (L - 1));\n    irt[LIM] = rt[LIM] = 1; int Wn = q_pow(Gen, (MOD - 1) / LIM), iWn = inv(Wn);\n    for (ri i = 1; i < (LIM >> 1); ++i) rt[i | LIM] = 1ll * rt[i - 1 | LIM] * Wn % MOD, irt[i | LIM] = 1ll * irt[i - 1 | LIM] * iWn % MOD;\n    LIM >>= 1, --L;\n    fac[0] = ifac[0] = fac[1] = ifac[1] = I[1] = 1;\n    for (ri i = 2; i <= LIM; ++i) {\n        fac[i] = 1ll * fac[i - 1] * i % MOD, I[i] = 1ll * (MOD - MOD / i) * I[MOD % i] % MOD, ifac[i] = 1ll * ifac[i - 1] * I[i] % MOD;\n    }\n    \n    for (int i = 0; i < D; ++i) Dec(b[a[i]], a[i + 1]);\n\tfor (int i = 0; i < LIM; ++i) if (b[i]) {\n\t\tfor (int j = 1; j * i < LIM; ++j) Add(F[j * i], 1ll * b[i] * I[j] % MOD);\n\t}\n\tExp(F, G, LIM, L);\n\tif (N % 2 == 0) {\n\t\tfor (int i = 0; i < LIM; ++i) G[i] = dec(0, G[i]);\n\t}\n\tfor (int i = 0; i < LIM; ++i) H[i] = F[i] = 0;\n\tfor (int i = 0; i <= S; ++i) H[S - i] = 1ll * G[i] * fac[i] % MOD;\n\tfor (int i = 0; i <= S; ++i) F[i] = ifac[i];\n\tMultiply(H, F, LIM << 1, L + 1);\n\tfor (int i = 0; i <= S; ++i) F[i] = 1ll * H[S - i] * ifac[i] % MOD;\n\tfor (int i = S + 1; i < LIM; ++i) F[i] = 0;\n\tint sum = 1, tmp = 0;\n\tfor (int i = 0; i <= D; ++i) Add(tmp, 1ll * a[i] * dec(a[i], 1) % MOD * I[2] % MOD);\n\tfor (int i = 0; i < LIM; ++i) G[i] = 0;\n\tfor (int i = 0; i <= max(M, S); ++i) G[i] = 1ll * ifac[i] * sum % MOD, sum = 1ll * sum * tmp % MOD, Dec(tmp, 1);\n\tMultiply(F, G, LIM << 1, L + 1);\n\tprintf(\"%d\\n\", F[M]);\n\treturn 0;\n}\n```",
        "postTime": 1588988933,
        "uid": 62308,
        "name": "Mr_Wu",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6516 \u3010[QkOI#R1] Quark and Graph\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u51fa\u4e00\u5f20$n$\u4e2a\u70b9\u3001$m$\u6761\u8fb9\u6784\u6210\u7684\u65e0\u5411\u56fe\uff0c\u5df2\u77e5$1$\u53f7\u70b9\u5230\u5404\u5b9a\u70b9\u7684\u6700\u77ed\u8ddd\u79bb$d_i$\uff0c\u6c42\u65b9\u6848\u6570\uff08\u5bf9$998244353$\u53d6\u6a21\uff09\n\n\u8bbe $t_i=\\sum_j[d_j=i]$\uff0c\u8fd8\u5e94\u6ee1\u8db3$\\sum_{i}t_it_{i-1}\\le 2\\times 10^5$\n## \u9898\u89e3\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cd\u5927\u5e38\u6570\u7684$\\mathcal{O}(n\\log^2n)$\u505a\u6cd5\uff0c\u5927\u4f6c\u8f7b\u55b7\u3002\n\n~~\u9996\u5148\u9898\u76ee\u91cc\u5904\u5904\u662f\u63d0\u793a\uff0c~~ \u89c2\u5bdf\u6570\u636e\u8303\u56f4\uff0c\u8003\u8651\u5efa\u4e00\u5f20\u5206\u5c42\u56fe\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a\u8fb9\u5206\u6210\u4e24\u90e8\u5206\uff1a\n- \u4ece\u524d\u4e00\u5c42\u5230\u540e\u4e00\u5c42\u7684\n- \u5728\u4e00\u5c42\u4e2d\u8fde\u6765\u8fde\u53bb\u7684\n\n\u90a3\u4e48\u8003\u8651\u751f\u6210\u51fd\u6570\u3002\u5bf9\u4e8e\u524d\u4e00\u90e8\u5206\uff0c\u8003\u8651\u4e24\u4e2a\u4e4b\u95f4\u7684\u751f\u6210\u51fd\u6570\u4e3a$1+x$\uff0c\u90a3\u4e48$t_i$\u4e2a\u5230\u4e00\u4e2a\u7684\u751f\u6210\u51fd\u6570\u4e3a$(1+x)^{t_i}$\uff0c\u4f46\u56e0\u4e3a\u4e0d\u80fd\u4e0d\u8fde\u8fb9\uff0c\u5e38\u6570\u9879\u5f3a\u5236\u4e3a$0$\uff0c\u5373$(1+x)^{t_i}-1$\u3002\u90a3\u4e48\u8fde\u5230$t_{i+1}$\u5728\u6b21\u65b9\u5c31\u884c\u4e86\u3002\n\n\u4e8e\u662f\u5bf9\u4e8e\u7b2c\u4e00\u90e8\u5206\u751f\u6210\u51fd\u6570\u6709\uff1a\n$$\\prod_{i=0}^{\\max(d)-1}((1+x)^{t_i}-1)^{t_{i+1}}$$\n\u8fd9\u4e2a\u6211\u4eec\u53ef\u4ee5$\\ln$+$\\exp$\u5b9e\u73b0\u5feb\u901f\u5e42\uff0c\u5728\u5206\u6cbb\u6b7b\u7b97\u5f97\u5230\u3002\u76f4\u63a5copy[\u6a21\u677f](https://www.luogu.com.cn/blog/CJL/caiji-de-poly)\u5373\u53ef\u3002\n\n\u7b2c\u4e8c\u90e8\u5206\u4e00\u5171\u6709$\\sum_{i=0}^{\\max(d)}\\tbinom{t_i}{2}$\u6761\u8fb9\u53ef\u9009\uff0c\u56e0\u6b64\u751f\u6210\u51fd\u6570\u662f\n$$(1+x)^{\\sum_{i=0}^{\\max(d)}\\tbinom{t_i}{2}}$$\n\n\u7528\u4e00\u4e0b\u4e0a\u9762\u7684\u677f\u5b50\u5c31ok\u4e86\u3002\n## \u4ee3\u7801\n\u8d34\u4e0a\u83dc\u9e21\u7684\u5927\u5e38\u6570\u4ee3\u7801\uff0c\u4ec5\u4f9b\u5bf9\u62cd...\n```cpp\n#include<bits/stdc++.h>\nnamespace in{\n\tchar buf[1<<21],*p1=buf,*p2=buf;\n\tinline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n\ttemplate <typename T>inline void read(T& t){\n\t\tt=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n\t    while(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n\t}\n\ttemplate <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n}\nnamespace out{\n\tchar buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n\tinline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n\tinline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n\ttemplate <typename T>void write(T x) {\n\t\tstatic char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n\t\twhile (len>=0)putc(buf[len]),--len;\n\t}\n}\nusing namespace std;\ntemplate<const int mod>\nstruct modint{\n    int x;\n    modint<mod>(int o=0){x=o;}\n    modint<mod> &operator = (int o){return x=o,*this;}\n    modint<mod> &operator +=(modint<mod> o){return x=x+o.x>=mod?x+o.x-mod:x+o.x,*this;}\n    modint<mod> &operator -=(modint<mod> o){return x=x-o.x<0?x-o.x+mod:x-o.x,*this;}\n    modint<mod> &operator *=(modint<mod> o){return x=1ll*x*o.x%mod,*this;}\n    modint<mod> &operator ^=(int b){\n        modint<mod> a=*this,c=1;\n        for(;b;b>>=1,a*=a)if(b&1)c*=a;\n        return x=c.x,*this;\n    }\n    modint<mod> &operator /=(modint<mod> o){return *this *=o^=mod-2;}\n    modint<mod> &operator +=(int o){return x=x+o>=mod?x+o-mod:x+o,*this;}\n    modint<mod> &operator -=(int o){return x=x-o<0?x-o+mod:x-o,*this;}\n    modint<mod> &operator *=(int o){return x=1ll*x*o%mod,*this;}\n    modint<mod> &operator /=(int o){return *this *= ((modint<mod>(o))^=mod-2);}\n\ttemplate<class I>friend modint<mod> operator +(modint<mod> a,I b){return a+=b;}\n    template<class I>friend modint<mod> operator -(modint<mod> a,I b){return a-=b;}\n    template<class I>friend modint<mod> operator *(modint<mod> a,I b){return a*=b;}\n    template<class I>friend modint<mod> operator /(modint<mod> a,I b){return a/=b;}\n    friend modint<mod> operator ^(modint<mod> a,int b){return a^=b;}\n    friend bool operator ==(modint<mod> a,int b){return a.x==b;}\n    friend bool operator !=(modint<mod> a,int b){return a.x!=b;}\n    bool operator ! () {return !x;}\n    modint<mod> operator - () {return x?mod-x:0;}\n\tmodint<mod> &operator++(int){return *this+=1;}\n};\nconst int N=4e6+5;\n\nconst int mod=998244353;\nconst modint<mod> GG=3,Ginv=modint<mod>(1)/3,I=86583718;\nstruct poly{\n\tvector<modint<mod>>a;\n\tmodint<mod>&operator[](int i){return a[i];}\n\tint size(){return a.size();}\n\tvoid resize(int n){a.resize(n);}\n\tvoid reverse(){std::reverse(a.begin(),a.end());}\n\tvoid print(){for(int i=0;i<a.size();i++)printf(\"%d \",a[i].x);puts(\"\");}\n};\nint rev[N];\ninline int ext(int n){int k=0;while((1<<k)<n)k++;return k;}\ninline void init(int k){int n=1<<k;for(int i=0;i<n;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(k-1));}\ninline void ntt(poly&a,int k,int typ){\n\tint n=1<<k;\n\tfor(int i=0;i<n;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\tfor(int mid=1;mid<n;mid<<=1){\n\t\tmodint<mod> wn=(typ>0?GG:Ginv)^((mod-1)/(mid<<1));\n\t\tfor(int r=mid<<1,j=0;j<n;j+=r){\n\t\t\tmodint<mod> w=1;\n\t\t\tfor(int k=0;k<mid;k++,w=w*wn){\n\t\t\t\tmodint<mod> x=a[j+k],y=w*a[j+k+mid];\n\t\t\t\ta[j+k]=x+y,a[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ<0){\n\t\tmodint<mod> inv=modint<mod>(1)/n;\n\t\tfor(int i=0;i<n;i++)a[i]*=inv;\n\t}\n}\ninline poly one(){poly a;a.a.push_back(1);return a;}\npoly operator +(poly a,poly b){\n\tint n=max(a.size(),b.size());a.resize(n),b.resize(n);\n\tfor(int i=0;i<n;i++)a[i]+=b[i];return a;\n}\npoly operator -(poly a,poly b){\n\tint n=max(a.size(),b.size());a.resize(n),b.resize(n);\n\tfor(int i=0;i<n;i++)a[i]-=b[i];return a;\n}\ninline poly operator*(poly a,poly b){\n\tint n=a.size()+b.size()-1,k=ext(n);\n\ta.resize(1<<k),b.resize(1<<k),init(k);\n\tntt(a,k,1);ntt(b,k,1);for(int i=0;i<(1<<k);i++)a[i]*=b[i];\n\tntt(a,k,-1),a.resize(n);return a;\n}\ninline poly operator*(poly a,modint<mod> b){for(int i=0;i<a.size();i++)a[i]*=b;return a; }\ninline poly operator/(poly a,modint<mod> b){for(int i=0;i<a.size();i++)a[i]/=b;return a; }\ninline poly operator-(poly a){for(int i=0;i<a.size();i++)a[i]=-a[i];return a; }\npoly inv(poly F,int k){\n\tint n=1<<k;F.resize(n);\n\tif(n==1){F[0]=modint<mod>(1)/F[0];return F;}\n\tpoly G,H=inv(F,k-1);\n\tG.resize(n),H.resize(n<<1),F.resize(n<<1);\n\tfor(int i=0;i<n/2;i++)G[i]=H[i]*2;\n\tinit(k+1),ntt(H,k+1,1),ntt(F,k+1,1);\n\tfor(int i=0;i<(n<<1);i++)H[i]=H[i]*H[i]*F[i];\n\tntt(H,k+1,-1),H.resize(n);\n\tfor(int i=0;i<n;i++)G[i]-=H[i];return G;\n}\ninline poly inv(poly a){\n\tint n=a.size();\n\ta=inv(a,ext(n)),a.resize(n);return a;;\n}\ninline poly deriv(poly a){//\u6c42\u5bfc \n\tint n=a.size()-1;\n\tfor(int i=0;i<n;i++)a[i]=a[i+1]*(i+1);\n\ta.resize(n);return a;\n}\ninline poly inter(poly a){//\u6c42\u539f \n\tint n=a.size()+1;a.resize(n);\n\tfor(int i=n;i>=1;i--)a[i]=a[i-1]/i;\n\ta[0]=0;return a;\n}\ninline poly ln(poly a){\n\tint n=a.size();\n\ta=inter(deriv(a)*inv(a));\n\ta.resize(n);return a;\n}\npoly exp(poly a,int k){\n\tint n=1<<k;a.resize(n);\n\tif(n==1)return one();\n\tpoly f0=exp(a,k-1);f0.resize(n);\n\treturn f0*(one()+a-ln(f0)); \n}\npoly exp(poly a){\n\tint n=a.size();\n\ta=exp(a,ext(n));a.resize(n);return a;\n}\ninline poly pow(poly a,modint<mod> k){//\u4fdd\u8bc1a[0]=1 \n\ta=ln(a);for(int i=0;i<a.size();i++)a[i]*=k.x;\n\treturn exp(a);\n}\nstruct modpair{\n\t//\u7528\u4e8e\u5feb\u901f\u5e42\u4e2d\u7684\u6b21\u6570\n\tmodint<mod>k1;modint<mod-1>k2;\n\tstruct trueint{\n\t\tdouble lg;int x;\n \t\ttrueint &operator=(int o){return x=o,lg=log10(o),*this;}\n \t\ttrueint &operator+=(int o){return lg<=8&&(x+=o,lg=log10(x)),*this;}\n\t\ttrueint &operator*=(int o){return x*=o,lg+=log10(o),*this;}\n\t}k3;\n\tmodpair(modint<mod>_1,modint<mod-1>_2,trueint _3):k1(_1),k2(_2),k3(_3){}\n\tmodpair(int o=0){k1=o,k2=o,k3=o;}\n    modpair &operator = (int o){return k1=o,k2=o,k3=o,*this;}\n    modpair &operator +=(int o){return k1+=o,k2+=o,k3+=o,*this;}\n    modpair &operator *=(int o){return k1*=o,k2*=o,k3*=o,*this;}\n    friend modpair operator +(modpair a,int o){return a+=o;}\n    friend modpair operator *(modpair a,int o){return a*=o;}\n    modpair operator-(){return modpair(k1,k2,k3);}\n};\ninline poly pow2(poly a,modpair m){//\u4e0d\u4fdd\u8bc1a[0]=1 \n\tint k=0;modint<mod> val;\n\twhile(a[k]==0&&k<a.size())k++;\n\tif(k==a.size()||k!=0&&m.k3.lg>8||1ll*m.k3.x*k>=a.size()){\n\tfor(int i=0;i<a.size();i++)a[i]=0;return a;}//bye~\n\tval=a[k];poly b;b.resize(a.size()-k);\n\tfor(int i=0;i<b.size();i++)b[i]=a[i+k]/val;\n\tb=pow(b,m.k1);for(int i=0;i<a.size();i++)a[i]=0;\n\tfor(int i=0;i<b.size()&&i+k*m.k1.x<a.size();i++)\n\t\ta[i+k*m.k1.x]=b[i]*(val^m.k2.x);\n\treturn a;\n}\nint n,m,t[N],M;\n#define mid (l+r>>1)\npoly solve(int l,int r){\n\tif(l==r){\n\t\t//((1+x)^t[l]-1)^t[l+1]\n\t\t//printf(\"%d,%d\\n\",l,r);\n\t\tpoly F;F.resize(t[l]*t[l+1]+1);\n\t\tF[0]=F[1]=1;F=pow(F,t[l]);F[0]=0;\n\t\t//F.print();\n\t\tF=pow2(F,modpair(t[l+1]));\n\t\t//F.print();\n\t\treturn F;\n\t}\n\tpoly F=solve(l,mid)*solve(mid+1,r);\n\t//printf(\"%d,%d\\n\",l,r);\n\tif(F.size()>=m+1)F.resize(m+1);\n\t//F.print();\n\treturn F;\n}\n#define C(x) (1ll*(x)*((x)-1)/2)\nsigned main(){\n\tin::read(n,m);for(int i=1,d;i<=n;i++)in::read(d),t[d]++,M=max(M,d);\n\tpoly f=solve(0,M-1),g;g.resize(m+1);g[0]=g[1]=1;\n\t//for(int i=0;i<f.size();i++)printf(\"%d \",f[i].x);puts(\"\");\n\tmodint<mod>T=0;for(int i=0;i<=n;i++)T+=C(t[i]);\n\tf=f*pow(g,T);out::write(f[m].x);\n\tout::flush();\n\treturn 0;\n}\n```",
        "postTime": 1610375693,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6516 \u3010[QkOI#R1] Quark and Graph\u3011"
    }
]