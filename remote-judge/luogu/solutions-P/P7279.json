[
    {
        "content": "\u672c\u6587\u540c\u6b65\u53d1\u8868\u4e8e\u6211\u7684\u535a\u5ba2\uff1a<https://www.alpha1022.me/articles/lg-7279.htm>\u3002\n\n\u9996\u5148\u5c06\u9650\u5236\u8f6c\u5316\u4e3a $\\le R$ \u3002  \n\u5efa\u51fa\u53cd\u4e32\u7684\u540e\u7f00\u6811\uff0c\u6267\u884c\u9759\u6001\u94fe\u5206\u6cbb\uff08\u5373\u6811\u4e0a\u542f\u53d1\u5f0f\u5408\u5e76\uff09\u3002  \n\u8bbe\u5f53\u524d\u7ed3\u70b9\u5305\u542b\u5b57\u7b26\u4e32\u7684\u6700\u957f\u957f\u5ea6\u4e3a $\\rm len$\uff0c\u5219\u8003\u8651\u5b50\u6811\u5185\u7684\u540e\u7f00 $i,j$ \u7684\u8d21\u732e\u3002  \n\u663e\u7136\u662f $\\min(R - (a_i \\oplus a_j),{\\rm len})$\u3002\n\n\u8003\u8651\u5206\u7c7b\u8ba8\u8bba\u3002  \n\u82e5 $a_i \\oplus a_j \\le R - {\\rm len}$\uff0c\u9700\u8981\u8fd9\u90e8\u5206\u7684\u6570\u5bf9\u7684\u4e2a\u6570\u3002  \n\u82e5 $R - {\\rm len} < a_i \\oplus a_j \\le R$\uff0c\u9700\u8981\u8fd9\u90e8\u5206\u7684\u6570\u5bf9\u7684 $a_i \\oplus a_j$ \u4e4b\u548c\u4ee5\u53ca\u4e2a\u6570\u3002\n\n\u5219\u95ee\u9898\u53d8\u4e3a\u7ef4\u62a4\u4e00\u4e2a\u591a\u91cd\u96c6 $S$\uff0c\u652f\u6301\u5bf9\u4e8e  $i \\in S$\uff0c\u67e5\u8be2\u6ee1\u8db3 $i \\oplus v \\le R$ \u7684 $i$ \u7684\u4e2a\u6570\u4ee5\u53ca $i \\oplus v$ \u7684\u548c\u3002  \n\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Trie \u6765\u7ef4\u62a4\uff0c\u67e5\u8be2\u65f6\u5728 Trie \u4e0a\u8d70 $v \\oplus R$ \u7684\u8def\u5f84\uff0c\u5f53\u67d0\u4e2a\u65f6\u523b $R$ \u7684\u5f53\u524d\u4f4d\u4e3a $1$\uff0c\u5219\u610f\u5473\u7740\u82e5\u8d70\u5411\u53e6\u4e00\u4e2a\u513f\u5b50\uff0c\u5f02\u6216\u503c\u7684\u8fd9\u4e00\u4f4d\u4f1a\u53d8\u4e3a $0$\uff0c\u6545\u5c06\u7b54\u6848\u52a0\u4e0a\u53e6\u4e00\u4e2a\u513f\u5b50\u5b50\u6811\u5185\u7684\u8d21\u732e\u5373\u53ef\u3002  \n\u5f53\u7136\uff0c\u8fd8\u8981\u52a0\u4e0a $v \\oplus R$ \u672c\u8eab\u7684\u8d21\u732e\u3002  \n\u800c\u540c\u65f6\u8981\u67e5\u8be2\u548c\uff0c\u53ef\u4ee5\u5957\u8def\u5730\u7ef4\u62a4\u6bcf\u4e00\u4f4d $1$ \u7684\u4e2a\u6570\u6765\u652f\u6301\u67e5\u8be2\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n \\log^2 a_i)$\u3002  \n\u56e0\u4e3a\u8fd9\u662f\u4e00\u68f5\u540e\u7f00\u6811\uff0c\u53ef\u4ee5\u76f8\u4fe1\u826f\u5fc3\u51fa\u9898\u4eba\u6ca1\u6709\u5361\u6811\u5256\uff0c\u6240\u4ee5\u662f\u53ef\u4ee5\u8fc7\u7684\u3002\n\n\u5f53\u7136\uff0c\u5728 SA \u7684 height \u6570\u7ec4\u4e0a\u5e76\u67e5\u96c6\u542f\u53d1\u5f0f\u5408\u5e76\u6216\u6240\u8c13\u300c\u542f\u53d1\u5f0f\u5206\u88c2\u300d\u5e76\u4f7f\u7528\u53ef\u6301\u4e45\u5316 Trie \u4e5f\u662f\u53ef\u4ee5\u7684\u3002  \n\u5b9e\u9645\u4e0a\u8fd9\u4e24\u79cd\u505a\u6cd5\u90fd\u76f8\u5f53\u4e8e\u5728 height \u6570\u7ec4\u7684\u7b1b\u5361\u5c14\u6811\u4e0a\u505a\u9759\u6001\u94fe\u5206\u6cbb\uff0c\u800c height \u6570\u7ec4\u7684\u7b1b\u5361\u5c14\u6811\u548c\u540e\u7f00\u6811\u67d0\u79cd\u610f\u4e49\u4e0a\u662f\u7b49\u4ef7\u7684\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n#include <vector>\n#include <cstring>\n#include <utility>\n#include <algorithm>\nusing namespace std;\nconst int N = 1e5;\nconst int LG = 16;\nconst int mod = 998244353;\nint n,L,R,w[N + 5];\nchar s[N + 5];\nint ans;\nnamespace TRIE\n{\n\tstruct node\n\t{\n\t\tint ch[2];\n\t\tint cnt,sum[LG + 5];\n\t} tr[(N << 5) + 5];\n\tint tot = 1;\n\tinline void insert(int v,int d)\n\t{\n\t\tint p = 1;\n\t\ttr[p].cnt += d;\n\t\tfor(register int k = 0;k <= LG;++k)\n\t\t\ttr[p].sum[k] += ((v >> k) & 1) * d;\n\t\tfor(register int i = LG;~i;--i)\n\t\t{\n\t\t\t!(tr[p].ch[(v >> i) & 1]) && (tr[p].ch[(v >> i) & 1] = ++tot),\n\t\t\tp = tr[p].ch[(v >> i) & 1];\n\t\t\ttr[p].cnt += d;\n\t\t\tfor(register int k = 0;k <= LG;++k)\n\t\t\t\ttr[p].sum[k] += ((v >> k) & 1) * d;\n\t\t}\n\t}\n\tinline pair<int,int> query(int v,int r)\n\t{\n\t\tif(r < 0)\n\t\t\treturn make_pair(0,0);\n\t\tint p = 1;\n\t\tint cnt = 0,sum = 0;\n\t\tfor(register int i = LG;~i && p;--i)\n\t\t{\n\t\t\tif((r >> i) & 1)\n\t\t\t{\n\t\t\t\tcnt += tr[tr[p].ch[(((v ^ r) >> i) & 1) ^ 1]].cnt;\n\t\t\t\tfor(register int k = 0;k <= LG;++k)\n\t\t\t\t\tif((v >> k) & 1)\n\t\t\t\t\t\tsum = (sum + (tr[tr[p].ch[(((v ^ r) >> i) & 1) ^ 1]].cnt - tr[tr[p].ch[(((v ^ r) >> i) & 1) ^ 1]].sum[k]) * (1LL << k)) % mod;\n\t\t\t\t\telse\n\t\t\t\t\t\tsum = (sum + tr[tr[p].ch[(((v ^ r) >> i) & 1) ^ 1]].sum[k] * (1LL << k)) % mod;\n\t\t\t}\n\t\t\tp = tr[p].ch[((v ^ r) >> i) & 1];\n\t\t}\n\t\tcnt += tr[p].cnt;\n\t\tfor(register int k = 0;k <= LG;++k)\n\t\t\tif((v >> k) & 1)\n\t\t\t\tsum = (sum + (tr[p].cnt - tr[p].sum[k]) * (1LL << k)) % mod;\n\t\t\telse\n\t\t\t\tsum = (sum + tr[p].sum[k] * (1LL << k)) % mod;\n\t\treturn make_pair(cnt,sum);\n\t}\n}\nnamespace SAM\n{\n\tstruct node\n\t{\n\t\tint ch[26];\n\t\tint fa,len;\n\t} sam[(N << 1) + 5];\n\tint las = 1,tot = 1;\n\tint c[N + 5],a[(N << 1) + 5];\n\tint sz[(N << 1) + 5],son[(N << 1) + 5];\n\tvector<int> edp[(N << 1) + 5];\n\tinline void insert(int x,int pos)\n\t{\n\t\tint cur = las,p = ++tot;\n\t\tsam[p].len = sam[cur].len + 1;\n\t\tfor(;cur && !sam[cur].ch[x];cur = sam[cur].fa)\n\t\t\tsam[cur].ch[x] = p;\n\t\tif(!cur)\n\t\t\tsam[p].fa = 1;\n\t\telse\n\t\t{\n\t\t\tint q = sam[cur].ch[x];\n\t\t\tif(sam[cur].len + 1 == sam[q].len)\n\t\t\t\tsam[p].fa = q;\n\t\t\telse\n\t\t\t{\n\t\t\t\tint nxt = ++tot;\n\t\t\t\tsam[nxt] = sam[q],sam[nxt].len = sam[cur].len + 1,sam[p].fa = sam[q].fa = nxt;\n\t\t\t\tfor(;cur && sam[cur].ch[x] == q;cur = sam[cur].fa)\n\t\t\t\t\tsam[cur].ch[x] = nxt;\n\t\t\t}\n\t\t}\n\t\t++sz[las = p],edp[las].push_back(pos);\n\t}\n\tint to[(N << 1) + 5],pre[(N << 1) + 5],first[(N << 1) + 5];\n\tinline void add(int u,int v)\n\t{\n\t\tstatic int tot = 0;\n\t\tto[++tot] = v,pre[tot] = first[u],first[u] = tot;\n\t}\n\tinline void build()\n\t{\n\t\tfor(register int i = 1;i <= tot;++i)\n\t\t\t++c[sam[i].len],i > 1 && (add(sam[i].fa,i),1);\n\t\tfor(register int i = 1;i <= n;++i)\n\t\t\tc[i] += c[i - 1];\n\t\tfor(register int i = tot;i > 1;--i)\n\t\t\ta[c[sam[i].len]--] = i;\n\t\tfor(register int i = tot;i > 1;--i)\n\t\t{\n\t\t\tsz[sam[a[i]].fa] += sz[a[i]];\n\t\t\tif(!son[sam[a[i]].fa] || sz[a[i]] > sz[son[sam[a[i]].fa]])\n\t\t\t\tson[sam[a[i]].fa] = a[i];\n\t\t}\n\t}\n\tvoid dfs(int p)\n\t{\n\t\tint len = sam[p].len;\n\t\tpair<int,int> res1,res2;\n\t\tfor(register int i = first[p];i;i = pre[i])\n\t\t\tif(to[i] ^ son[p])\n\t\t\t{\n\t\t\t\tdfs(to[i]);\n\t\t\t\tfor(register vector<int>::iterator it = edp[to[i]].begin();it != edp[to[i]].end();++it)\n\t\t\t\t\tTRIE::insert(w[*it],-1);\n\t\t\t}\n\t\tif(son[p])\n\t\t\tdfs(son[p]);\n\t\tfor(register vector<int>::iterator it = edp[p].begin();it != edp[p].end();++it)\n\t\t\tres1 = TRIE::query(w[*it],R - len),\n\t\t\tres2 = TRIE::query(w[*it],R),\n\t\t\tans = (ans + (long long)res1.first * len) % mod,\n\t\t\tans = (ans + (long long)(res2.first - res1.first) * R % mod - (res2.second - res1.second + mod) % mod + mod) % mod,\n\t\t\tres1 = TRIE::query(w[*it],L - 1 - len),\n\t\t\tres2 = TRIE::query(w[*it],L - 1),\n\t\t\tans = (ans - (long long)res1.first * len % mod + mod) % mod,\n\t\t\tans = (ans - (long long)(res2.first - res1.first) * (L - 1) % mod + (res2.second - res1.second + mod) % mod + mod) % mod;\n\t\tfor(register vector<int>::iterator it = edp[p].begin();it != edp[p].end();++it)\n\t\t\tTRIE::insert(w[*it],1);\n\t\tif(son[p])\n\t\t{\n\t\t\tedp[p].swap(edp[son[p]]);\n\t\t\tfor(register vector<int>::iterator it = edp[son[p]].begin();it != edp[son[p]].end();++it)\n\t\t\t\tedp[p].push_back(*it);\n\t\t\tvector<int>().swap(edp[son[p]]);\n\t\t}\n\t\tfor(register int i = first[p];i;i = pre[i])\n\t\t\tif(to[i] ^ son[p])\n\t\t\t{\n\t\t\t\tfor(register vector<int>::iterator it = edp[to[i]].begin();it != edp[to[i]].end();++it)\n\t\t\t\t\tres1 = TRIE::query(w[*it],R - len),\n\t\t\t\t\tres2 = TRIE::query(w[*it],R),\n\t\t\t\t\tans = (ans + (long long)res1.first * len) % mod,\n\t\t\t\t\tans = (ans + (long long)(res2.first - res1.first) * R % mod - (res2.second - res1.second + mod) % mod + mod) % mod,\n\t\t\t\t\tres1 = TRIE::query(w[*it],L - 1 - len),\n\t\t\t\t\tres2 = TRIE::query(w[*it],L - 1),\n\t\t\t\t\tans = (ans - (long long)res1.first * len % mod + mod) % mod,\n\t\t\t\t\tans = (ans - (long long)(res2.first - res1.first) * (L - 1) % mod + (res2.second - res1.second + mod) % mod + mod) % mod;\n\t\t\t\tfor(register vector<int>::iterator it = edp[to[i]].begin();it != edp[to[i]].end();++it)\n\t\t\t\t\tedp[p].push_back(*it),TRIE::insert(w[*it],1);\n\t\t\t\tvector<int>().swap(edp[to[i]]);\n\t\t\t}\n\t}\n}\nint main()\n{\n\tscanf(\"%d%s\",&n,s + 1);\n\tfor(register int i = 1;i <= n;++i)\n\t\tscanf(\"%d\",w + i);\n\tscanf(\"%d%d\",&L,&R);\n\tfor(register int i = 1;i <= n;++i)\n\t\tSAM::insert(s[i] - 'a',i);\n\tSAM::build(),SAM::dfs(1);\n\tprintf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1610865259,
        "uid": 75840,
        "name": "deserter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7279 \u3010\u5149\u68f1\u788e\u7247\u3011"
    },
    {
        "content": "> \u7ed9\u5b9a\u5b57\u7b26\u4e32 $S$\uff0c\u6bcf\u4e00\u4f4d\u989d\u5916\u6709\u6743\u503c $v_i$\uff0c\u6c42\u6709\u591a\u5c11\u5bf9 **\u65e0\u5e8f\u7684** \u672c\u8d28\u76f8\u540c\u4f46\u51fa\u73b0\u4f4d\u7f6e\u4e0d\u540c\u7684\u5b50\u4e32\uff08\u53f3\u7aef\u70b9\u5206\u522b\u4e3a $r_1,r_2$\uff09\u6ee1\u8db3 $L\\le (v_{r_1}\\oplus v_{r_2})+len\\le R$\uff0c\u5176\u4e2d $L$\u3001$R$ \u4e3a\u7ed9\u5b9a\u53c2\u6570\u3002\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n>\n> $1\\le |S|,v_i,L,R\\le 10^5$\n\n[\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P7279)\n\n---\n\n[\u6b22\u8fce\u5230\u6211\u7684\u535a\u5ba2\u67e5\u770b](https://mivik.gitee.io/2021/solution/alpha1022-fragment/)\n\n~~\u6240\u4ee5\u4e3a\u4ec0\u4e48\u8003\u573a\u4e0a\u6211\u76ef\u7740\u751a\u81f3\u5df2\u7ecf\u628a Trie \u5199\u597d\u7684\u66b4\u529b\u770b\u4e86\u534a\u5929\u90fd\u6ca1\u60f3\u5230\u542f\u53d1\u5f0f\u5408\u5e76\uff08\uff09~~\n\n\u8003\u8651\u679a\u4e3e\u7aef\u70b9 $r_1,r_2$\uff0c\u7136\u540e\u8bb0 $l$ \u4e3a $|\\operatorname{lcp}(S_{1,r_1},S_{1,r_2})|$\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7528 SAM \u6c42\u3002\u7136\u540e\u8fd9\u5bf9 $r_1,r_2$ \u7684\u8d21\u732e\u5c31\u662f $\\sum_{i=1}^l \\left[L-i\\le \\left(v_{r_1}\\oplus v_{r_2}\\right)\\le R-i\\right]$\u3002\u628a $(v_{r_1}\\oplus v_{r_2})$ \u7684\u503c\u653e\u5230\u5e8f\u5217 $A$ \u4e0a\uff0c\u76f8\u5f53\u4e8e\u6c42\u4e86 $A$ \u5e8f\u5217\u7684\u591a\u4e2a\u533a\u95f4\u548c\uff0c\u4e5f\u5c31\u662f $A$ \u4e8c\u6b21\u524d\u7f00\u548c\u540e\uff08\u8bb0\u4e3a $B$\uff09\u7684\u5355\u70b9\u67e5\u3002\u5177\u4f53\u5730\uff0c\u539f\u5f0f\u5373\u4e3a $(B_{R}-B_{R-l})-(B_{L-1}-B_{L-l-1})$\u3002\u7136\u540e\u6ce8\u610f\u5230 $A_i$ \u5bf9 $B_j$ \u7684\u8d21\u732e\u662f $\\max\\{j-i+1,0\\}$\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u5f97\u5230\u4e86 $O(n^2)$ \u505a\u6cd5\u3002\n\n\u7136\u540e\u8003\u8651\u542f\u53d1\u5f0f\u5408\u5e76 $endpos$\u3002\u4e8e\u662f\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u96c6\u5408 $S$\uff0c\u652f\u6301\u67e5\u8be2\u5bf9\u4e8e\u7ed9\u5b9a\u7684 $x$ \u548c $lim$\uff0c$\\sum_{v\\in S}\\max\\{lim-v,0\\}$ \u7684\u503c\uff0c\u4e5f\u5c31\u662f\u8981\u7ef4\u62a4 $\\sum_{v\\in S}\\left[(v\\oplus x)\\le lim\\right]$ \u548c $\\sum_{v\\in S}(v\\oplus x)$ \u7684\u503c\u3002\u8fd9\u4e2a\u53ef\u4ee5\u7528 01 Trie \u505a\u5230\u63d2\u5165\u67e5\u8be2 $O(\\log^2V)$\u3002\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^3n)$\u3002\n\n[mivik.h](https://mivik.gitee.io/mivik.h)\n\n[\u4ee3\u7801](https://paste.ubuntu.com/p/nrbCDnZ8vd/)\n",
        "postTime": 1610881747,
        "uid": 45182,
        "name": "Mivik",
        "ccfLevel": 9,
        "title": "[\u9898\u89e3] [Alpha1022 \u7684\u65e0\u8da3\u6bd4\u8d5b] \u5149\u68f1\u788e\u7247"
    },
    {
        "content": "[\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P7279)\n\n>\u9898\u610f\uff1a  \n\u5bf9\u6c42\u51fa\u65e0\u5e8f\u5b50\u4e32\u5bf9 $(S[l1\\dots r1],S[l2\\dots r2])$ \u7684\u4e2a\u6570\uff0c  \n\u6ee1\u8db3 $S[l1\\dots r1]=S[l2\\dots r2]$ \u4e14 $L\\leq a_{r1} \\operatorname{xor} a_{r2}+r1-l1+1\\leq R$\u3002  \n\u5176\u4e2d $L,R,a_{1\\dots |S|}$ \u662f\u7ed9\u5b9a\u7684\u3002\n\n\u9996\u5148\uff0c$L,R$ \u7684\u9650\u5236\u53ef\u4ee5\u901a\u8fc7\u5dee\u5206\u8f6c\u4e3a $\\geq lim$ \u7684\u8d21\u732e\uff0c\u7b97\u4e24\u6b21\u3002\n\n\u6240\u4ee5\u53ea\u9700\u770b $a_{r_1} \\operatorname{xor} a_{r_1}+r1-l1+1\\geq lim$\u3002\n\n\u6254\u5230 $\\text{SAM}$ \u7684 $\\text{parent}$ \u6811\u4e0a\u540e\uff0c\u5bf9\u6bcf\u4e2a\u5b50\u4e32\u7684 $\\text{endpos}$ \u8003\u8651\u3002\u8bbe\u70b9 $i,j$ \u5206\u522b\u5bf9\u5e94\u539f\u5e8f\u5217\u4e2d $r_1,r_2$ \u7684\u4f4d\u7f6e\uff0c$x=\\operatorname{lca}(i,j)$ \uff0c\u5219\u4e0a\u5f0f\u4e3a $a_{r_1}\\operatorname{xor} a_{r_2}+[1,len_x]\\geq lim$ \u3002\u5176\u4e2d $[1,len_x]$ \u662f\u56e0\u4e3a\u4efb\u4f55\u6bd4\u5176 $\\text{lcs}$ \u77ed\u7684\u5b50\u4e32\u90fd\u80fd\u76f8\u7b49\u3002\uff08$[1,len_x]$ \u6307\u8fd9\u4e00\u6bb5\u533a\u95f4\uff0c\u5199\u6cd5\u53ef\u80fd\u4e0d\u89c4\u8303\u4f46\u5e94\u8be5\u5bb9\u6613\u7406\u89e3\uff09\n\n\u6ce8\u610f\u6b64\u65f6\u6bcf\u4e2a $a_{r_1}\\operatorname{xor}a_{r_2}$ \u53ea\u8981\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\u90fd\u4f1a\u7b97\u5165\u4e00\u6b21\uff0c\u56e0\u4e3a\u4f1a\u5bf9\u5e94\u4e0d\u540c\u4f4d\u7f6e\u7684\u5b50\u4e32\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c $a_{r_1}\\operatorname{xor}a_{r_2}\\geq lim-1$ \uff0c\u5219 $[1,len_x]$ \u533a\u95f4\u5185\u90fd\u80fd\u6ee1\u8db3\u6761\u4ef6\uff0c\u4f1a\u88ab\u7b97\u5165 $len_x$ \u6b21\uff0c\u53ea\u9700\u6c42\u51fa\u4e2a\u6570\u3002\u4f46\u5982\u679c $a_{r_1}\\operatorname{xor}a_{r_2}\\in[lim-len_x,lim-1)$ \uff0c\u5219\u4f1a\u88ab\u7b97\u5165 $a_{r_1}\\operatorname{xor}a_{r_2}-lim+len_x+1$ \u6b21\uff0c\u8fd9\u5c31\u8981\u6c42\u51fa\u4e2a\u6570\uff0c\u4ee5\u53ca\u8fd9\u90e8\u5206\u7684\u548c\u3002\n\n\u5206\u6790\u5230\u6b64\u7ed3\u675f\uff0c\u5b9e\u73b0\u547c\u4e4b\u6b32\u51fa\u3002\n\n\u5bf9\u6bcf\u4e2a $x$\uff0c\u7edf\u8ba1\u5b50\u6811\u5185\u8def\u5f84 $\\text{lca}$ \u4e3a $x$ \u7684\u8d21\u732e\u3002\n\n\u901a\u8fc7 $\\text{dsu on tree}$ \u628a\u4e4b\u524d\u5b50\u6811\u5185\u7684 $a_{r_1}$ \u63d2\u5230 $\\text{01trie}$ \u4e2d\uff0c\u904d\u5386\u8f7b\u513f\u5b50\u5b50\u6811\u65f6\u5148\u7b97\u4f5c\u4e3a $a_{r_2}$ \u7684\u8d21\u732e\uff0c\u7136\u540e\u518d\u5c06\u5176\u63d2\u5165 $\\text{01trie}$\u3002\n\n\u800c\u7b97\u8d21\u732e\u65f6\u8981\u7528 $\\text{01trie}$ \u6c42\u51fa $\\operatorname{xor}v$ \u540e $\\geq k$ \u7684\u4e2a\u6570\uff0c\u4ee5\u53ca\u548c\u3002\n\n\u5728 $\\text{01trie}$ \u4e0a\u627e\u51fa $v\\operatorname{xor} s=k$ \u7684\u4e00\u6761\u94fe $s$ \uff0c\u5982\u679c\u8fd9\u4e00\u4f4d\u4e0a $k$ \u4e3a $0$ \uff0c\u5219\u627e\u5230 $s$ \u7684\u53e6\u4e00\u4e2a\u513f\u5b50\uff0c\u4f7f\u8fd9\u4e00\u4f4d\u4e3a $1$\u3002\u4e2a\u6570\u5373\u4e3a\u5b50\u6811\u548c\uff0c\u800c\u6c42\u548c\u53ef\u4ee5\u5728 $\\text{01trie}$ \u4e0a\u62c6\u4f4d\u5b9e\u73b0\u3002\u7531\u4e8e\u662f $\\geq k$\uff0c\u6700\u7ec8\u5230\u7684\u70b9\u540c\u6837\u8981\u7b97\u5165\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log^3 n)$\uff0c$\\text{dsu on tree\uff0c01trie}$ \u4ee5\u53ca\u62c6\u4f4d\u5404\u5e26\u4e00\u4e2a $\\log$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log^2 n)$\u3002\n\n\u4ee3\u7801\uff1a\n```\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=1e5+10,K=20,mod=998244353;\nint n,m,x,y,xx,last=1,tot=1,ts,rt,t_tot,ti,l,lx,ksb;\nint lim_l,lim_r,zt1[2],zt2[2];ll tmp,tmps,tt,tts,res,ans;\nint mxlen[N<<1],pos[N<<1],link[N<<1],trans[N<<1][26];\nint to[N<<1],nextn[N<<1],h[N<<1],edg;bool b,bb,tb[K+1];\nint size[N<<1],son[N<<1],w[N<<1],a[N];char ch,s[N];\ninline void read(int &x){\n\tx=0;ch=getchar();while(ch<48)ch=getchar();\n\twhile(ch>47)x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n}\nvoid write(int x){if(x>9)write(x/10);putchar(48+x%10);}\ninline void extend(char a){\n\ty=last;ts=++tot;mxlen[ts]=mxlen[y]+1;\n\tfor(;y&&!trans[y][a];y=link[y])trans[y][a]=ts;\n\tif(!y)link[ts]=1;\n\telse {\n\t\tx=trans[y][a];\n\t\tif(mxlen[x]==mxlen[y]+1)link[ts]=x;\n\t\telse {\n\t\t\txx=++tot;link[xx]=link[x];mxlen[xx]=mxlen[y]+1;\n\t\t\tmemcpy(trans[xx],trans[x],sizeof(trans[xx]));\n\t\t\tfor(;trans[y][a]==x;y=link[y])trans[y][a]=xx;\n\t\t\tlink[ts]=link[x]=xx;\n\t\t}\n\t}\n\tlast=ts;\n}\ninline void add(int x,int y){to[++edg]=y;nextn[edg]=h[x],h[x]=edg;}\nvoid init(int x){\n\tint i,y;size[x]=1;\n\tfor(i=h[x];y=to[i];i=nextn[i]){\n\t\tinit(y);size[x]+=size[y];\n\t\tif(size[y]>size[son[x]])son[x]=y;\n\t}\n}\nstruct trie{int son[2],sz,t[K+1];}t[N*(K+1)];\nvoid update(int &k,int x,int i,int v){\n\tif(!k)k=++t_tot;t[k].sz+=v;\n\tfor(ti=K;~ti;--ti)if(tb[ti])t[k].t[ti]+=v;\n\tif(~i)update(t[k].son[(x>>i)&1],x,i-1,v);\n}\nvoid inquiry(int k,int x,int i){\n\tif(~i){\n\t\tb=(l>>i)&1;bb=b^((x>>i)&1);\n\t\tif(!b)tmp+=t[t[k].son[!bb]].sz;\n\t\tinquiry(t[k].son[bb],x,i-1);\n\t}\n\telse tmp+=t[k].sz;\n}//\u6c42\u4e2a\u6570\nvoid inquirys(int k,int x,int i){\n\tif(~i){\n\t\tb=(l>>i)&1;bb=b^((x>>i)&1);\n\t\tif(!b&&(ksb=t[k].son[!bb])){\n\t\t\tfor(ti=K;~ti;--ti){\n\t\t\t\tif(tb[ti])tmps=(tmps+(1ll<<ti)*(t[ksb].sz-t[ksb].t[ti]+mod)%mod)%mod;\n\t\t\t\telse tmps=(tmps+(1ll<<ti)*t[ksb].t[ti]%mod)%mod;\n\t\t\t}\n\t\t}\n\t\tinquirys(t[k].son[bb],x,i-1);\n\t}\n\telse if(k)tmps=(tmps+1ll*t[k].sz*l)%mod;\n}//\u6c42\u548c\ninline void update(int x,int v){\n\tfor(ti=K;~ti;--ti)tb[ti]=(x>>ti)&1;\n\tupdate(rt,x,K,v);\n}\ninline void inquiry(int x,int lim,bool b){\n\ttmp=0;l=zt1[b];inquiry(rt,x,K);\n\tres=(res+tmp*lx%mod)%mod;tt=tmp;//>=lim-1\u7684\u4e2a\u6570\n\ttmp=0;l=zt2[b];inquiry(rt,x,K);tt=tmp-tt;\n\tfor(ti=K;~ti;--ti)tb[ti]=(x>>ti)&1;\n\ttmps=0;l=zt2[b];inquirys(rt,x,K);tts=tmps;\n\ttmps=0;l=zt1[b];inquirys(rt,x,K);tts-=tmps;\n\tres=(res-tt*(lim-lx-1+mod)%mod+tts)%mod;\n//\u6c42[lim-lx,lem-1)\u7684\u4e2a\u6570\u4ee5\u53ca\u548c\n}\ninline void inquiry(int x){\n\tres=0;inquiry(x,lim_l,false);ans=(ans+res)%mod;\n\tres=0;inquiry(x,lim_r,true);ans=(ans-res)%mod;\n}\nvoid calc(int x){\n\tif(pos[x])inquiry(w[x]);register int i,y;\n\tfor(i=h[x];y=to[i];i=nextn[i])calc(y);\n}\nvoid dfs(int x){\n\tif(pos[x])update(w[x],1);register int i,y;\n\tfor(i=h[x];y=to[i];i=nextn[i])dfs(y);\n}\nvoid clear(int x){\n\tif(pos[x])update(w[x],-1);register int i,y;\n\tfor(i=h[x];y=to[i];i=nextn[i])clear(y);\n}\nvoid solve(int x){\n\tregister int i,y;\n\tfor(i=h[x];y=to[i];i=nextn[i])if(y^son[x])solve(y),clear(y);\n\tif(son[x])solve(son[x]);\n\tif(lx=mxlen[x]){\n\t\tzt2[0]=max(lim_l-lx,0);zt2[1]=max(lim_r-lx,0);//\u6ce8\u610f\u8981\u548c0\u53d6max\n\t\tif(pos[x])inquiry(w[x]),update(w[x],1);\n\t\tfor(i=h[x];y=to[i];i=nextn[i])if(y^son[x])calc(y),dfs(y);\n\t}\n}\nmain(){\n\twhile(ch<97)ch=getchar();register int i;\n\twhile(ch>96)s[++n]=ch-'a',ch=getchar();\n\tfor(i=1;i<=n;++i)extend(s[i]),pos[ts]=i;\n\tfor(i=2;i<=tot;++i)add(link[i],i);init(1);\n\tfor(i=1;i<=n;++i)read(a[i]);init(1);\n\tfor(i=1;i<=tot;++i)if(pos[i])w[i]=a[pos[i]];\n\tread(lim_l);zt1[0]=max(lim_l-1,0);\n\tread(lim_r);zt1[1]=lim_r;++lim_r;\n\tsolve(1);ans=(ans%mod+mod)%mod;write(ans);\n}\n```\n",
        "postTime": 1635562253,
        "uid": 334380,
        "name": "Y_B_X",
        "ccfLevel": 7,
        "title": "\u9898\u89e3[P7279 \u5149\u68f1\u788e\u7247]"
    }
]