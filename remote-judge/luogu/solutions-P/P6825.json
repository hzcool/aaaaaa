[
    {
        "content": "## ~~\u5b98\u65b9\u9898\u89e3~~\n\n### update on 2020/9/9 \u66f4\u65b0\u4e86\u590d\u6742\u5ea6\u8bc1\u660e\u3002\n\n~~\u6211\u592a\u83dc\u4e86\u2026\u2026\u9898\u89e3\u6539\u4e86\u597d\u591a\u6b21\uff0c\u9ebb\u70e6\u7ba1\u7406\u4e86qwq~~\n\n\u5bf9\u4e8e\u767e\u5206\u4e4b\u5341\u7684\u6570\u636e\uff1a\u968f\u4fbf\u8fc7\u3002\n\n\u4e0b\u9762\u63a8\u5f0f\u5b50\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^n\\gcd(i,j)^{i+j}$$\n\n$$=\\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^nd^{i+j}[\\gcd(i,j)=d]$$\n\n$$=\\sum_{d=1}^n\\sum_{i=1}^\\frac{n}{d}\\sum_{j=1}^\\frac{n}{d}d^{d(i+j)}[\\gcd(i,j)=1]$$\n\n$$=\\sum_{d=1}^n\\sum_{i=1}^\\frac{n}{d}\\sum_{j=1}^\\frac{n}{d}d^{d(i+j)}\\sum_{k|\\gcd(i,j)}\\mu(k)$$\n\n$$=\\sum_{d=1}^n\\sum_{k=1}^\\frac{n}{d}\\mu(k)\\sum_{i=1}^\\frac{n}{kd}\\sum_{j=1}^\\frac{n}{kd}d^{kd(i+j)}$$\n\n\u4ee4$T=kd:$\n\n$$=\\sum_{T=1}^n\\sum_{k|T}\\mu(k)\\sum_{i=1}^\\frac{n}{T}\\sum_{j=1}^\\frac{n}{T}[(\\frac{T}{k})^T]^{i+j}$$\n\n\u73b0\u5728\u7684\u95ee\u9898\u5728\u4e8e$\\sum_{i=1}^\\frac{n}{T}\\sum_{j=1}^\\frac{n}{T}[(\\frac{T}{k})^T]^{i+j}.$\n\n* \u7ebf\u6027\u9012\u63a8\n\n\u4ee5\u4e0b\u662f@SOSCHINA\u5927\u4f6c\u7684\u601d\u8def\uff1a\n\n\u8bbe$g(n)=\\sum_{i=1}^n\\sum_{j=1}^n k^s.$\n\n\u679a\u4e3e$s=i+j.$\n\n\u5219\u6709\uff1a\n\n$$g(n)=\\sum_{s=2}^{n+1}(s-1)k^s+\\sum_{s=n+2}^{2n}(2n-s+1)k^s$$\n\n$$g(n+1)=\\sum_{s=2}^{n+1}(s-1)k^s+\\sum_{s=n+2}^{2n+2}(sn+3-s)k^s$$\n\n\n$$g(n+1)-g(n)=\\sum_{s=n+2}^{2n}2k^s+2k^{2n+1}+k^{2n+2}$$\n\n\u7b2c\u4e09\u884c\u5c31\u662f\u4e24\u884c\u76f8\u51cf\u3002\n\n\u5bf9\u7b2c\u4e00\u884c\u7684\u89e3\u91ca\uff1a$[2,n+1]$\u8fd9\u91cc\u7684\u6570\uff0c\u6bcf\u4e2a\u6570\u4f5c\u4e3a$i+j$\u90fd\u51fa\u73b0\u4e86$x-1$\u6b21\u3002\u56e0\u4e3a$i$\u53ef\u4ee5\u53d6\u904d$[1,x-1].$\u540e\u9762\u7684\u90a3\u4e00\u4e9b,$[n+2,2n]$\u4f1a\u53d1\u73b0$i$\u6700\u5927\u53ea\u80fd\u5230$n,$\u4e0d\u80fd\u518d\u53d6\u904d$x-1$\u4e2a\u503c\u4e86\u3002\u6b64\u65f6\u80fd\u53d6\u5230\u7684\u5e94\u8be5\u662f$2n-s+1$\u79cd\u3002\n\n\u5bf9\u4e8e$g(n+1):$\u8fd9\u91cc\u662f\u628a\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u7684\u6700\u540e\u4e00\u4e2a\u503c\u79fb\u52a8\u5230\u4e86\u540e\u9762\u90a3\u4e2a\u5f0f\u5b50\uff0c\u65b9\u4fbf\u505a\u5dee\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u5728\u5c0f\u6a21\u6570\u7684\u60c5\u51b5\u4e0b\u505a\u5230$O(n*mod$)\u7684\u9884\u5904\u7406\u3002\n\n* \u5316\u7b80\u5f62\u5f0f\n\n\u4ee4$x=(\\frac{T}{k})^T.$\n\n\n\u5219\u539f\u5f0f\u4e3a$\\sum_{i=1}^\\frac{n}{T}\\sum_{j=1}^\\frac{n}{T} x^{i+j}.$\n\n\u50cf\u4e0d\u50cf\u4e00\u4e2a\u591a\u9879\u5f0f\u3002\n\n\u5b83\u5c31\u7b49\u4e8e$(x+x^2+...x^\\frac{n}{T})^2.$\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u89e3\u51fa\u3002\n\n\u5269\u4e0b\u7684\uff0c\u53ef\u4ee5\u505a\u5230$O(n\\log n\\log mod)$\u5904\u7406\u51fa\u6574\u4e2a\u5f0f\u5b50\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=1500001;\nint mod,TT;\nbitset<MAXN+1>vis;\nint p[MAXN+1],mu[MAXN+1],T[MAXN+1],cnt,n,Ans;\ninline int Mod(long long x){\n\tif(x<0)return x+mod;\n    if(x>=mod)return x%mod;\n    return x;\n}\ninline int add(int x,int y) {return Mod(1ll*x+1ll*y+1ll*mod);}\ninline int mul(int x,int y) {return Mod(1ll*x*y);}\ninline int qpow(int a,int b) {\n\tif(!b)return 1;\n\tif(a<=1||b==1)return a;\n\ta %= mod; \n\tint res=1;\n\twhile(b) {\n\t\tif(b&1)res=mul(res,a);\n\t\ta=mul(a,a);\n\t\tb>>=1;\n\t}\n\treturn res;\n}\ninline int calc(int x,int y){\n\tif(y==1)return x;\n\tif(x==1)return y;\n\tint ans=x;\n\tint inv=qpow((1-x+mod)%mod,mod-2);\n\tint fm=(1-qpow(x,y)+mod)%mod;\n\tans=mul(ans,mul(fm,inv));\n\treturn ans;\n}\ninline int Calc(int x,int y){int ans=calc(x,y);return mul(ans,ans);} \nint main() {\n\tscanf(\"%d\",&TT);\n\tmu[1]=1;\n\tint N=MAXN;\n\tfor(register int i=2; i<=N; ++i) {\n\t\tif(!vis[i])p[++cnt]=i,mu[i]=-1;\n\t\tfor(register int j=1; j<=cnt&&i*p[j]<=N; ++j) {\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif(i%p[j]==0)break;\n\t\t\tmu[i*p[j]]=-mu[i];\n\t\t}\n\t}\n\twhile(TT--) {\n\t\tscanf(\"%d%d\",&n,&mod);\n\t\tN=n;Ans=0;\n\t\tfor(register int i=1; i<=N; ++i) {\n\t\t\tfor(register int j=i,k,x; j<=N; j+=i) {\n\t\t\t\tk=i;if(!mu[k])continue;\n\t\t\t\tx=qpow(j/k,j);\n\t\t\t\tT[j]=add(T[j],mul(mu[k],Calc(x,n/j)));\n\t\t\t}\n\t\t}\n\t\tfor(register int i=1; i<=n; ++i)Ans=add(Ans,T[i]),T[i]=0;\n\t\tprintf(\"%d\\n\",Ans);\n\t}\n\n\treturn 0;\n}\n```\n\u7531\u4e8e\u8fd9\u91cc\u662f$5*10^5$\u7684\u6570\u636e\uff0c\u6240\u4ee5\u7565\u5fae\u5361\u5e38\uff0c\u4f46\u7b14\u8005\u901a\u8fc7\u975e\u5e38\u4e0d\u7cbe\u6e5b\u7684\u5361\u5e38\u6280\u672f\u8dd1\u5230\u4e86$3s$\u4ee5\u5185\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684\u65f6\u95f4\u9650\u5236\u6211\u5f00\u4e86$3.2s$.\n\n\u5bf9\u7b49\u6bd4\u6570\u5217\u8fdb\u884c\u7cbe\u7ec6\u5904\u7406\uff0c\u53ef\u4ee5\u505a\u5230$O(n\\log^2n)$\u7684\u590d\u6742\u5ea6\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int MAXN=1500000;\nint mod,TT;\nbitset<MAXN<<1>vis;\nint p[MAXN<<1],mu[MAXN<<1],T[MAXN<<1],cnt,n,Ans;\ninline int Mod(long long x){\n    if(x>=mod)return x%mod;\n    return x;\n}\ninline int add(int x,int y) {\n\treturn Mod(x+y+mod);\n}\ninline int mul(int x,int y) {\n\treturn Mod(1ll*x*y);\n}\ninline int qpow(int a,int b) {\n\tif(!b)return 1;\n\tif(a<=1||b==1)return a;\n\ta %= mod; \n\tint res=1;\n\twhile(b) {\n\t\tif(b&1)res=mul(res,a);\n\t\ta=mul(a,a);\n\t\tb>>=1;\n\t}\n\treturn res;\n}\ninline int calc(int x,int y){\n\tif(y==1)return x;\n\t\tint res=calc(x,y/2);\n\tres=add(res,mul(res,qpow(x,y/2)));\n\tif(y&1)res=add(res,mul(x,qpow(x,y-1)));\n\treturn res;\n}\ninline int Calc(int x,int y){int ans=calc(x,y);return mul(ans,ans);} \nsigned main() {\n\tscanf(\"%lld\",&TT);\n\tmu[1]=1;\n\tint N=MAXN;\n\tfor(int i=2; i<=N; ++i) {\n\t\tif(!vis[i])p[++cnt]=i,mu[i]=-1;\n\t\tfor(int j=1; j<=cnt&&i*p[j]<=N; ++j) {\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif(i%p[j]==0)break;\n\t\t\tmu[i*p[j]]=-mu[i];\n\t\t}\n\t}\n\twhile(TT--) {\n\t\tscanf(\"%lld%lld\",&n,&mod);\n\t\tN=n;\n\t\tAns=0;\n\t\tfor(int i=1; i<=N; ++i) {\n\t\t\tfor(int j=i; j<=N; j+=i) {\n\t\t\t\tint k=i;\n\t\t\t\tint x=qpow(j/k,j);\n\t\t\t\tif(!mu[k])continue;\n\t\t\t\tT[j]=add(T[j],mul(mu[k],Calc(x,n/j)));\n\t\t\t}\n\t\t}\n\t\tfor(int i=1; i<=n; ++i)Ans=add(Ans,T[i]),T[i]=0;\n\t\tcout<<Ans<<endl;\n\t}\n\n\treturn 0;\n}\n```\n\u7531\u4e8e\u5e38\u6570\u7b49\u539f\u56e0\uff0c\u8fd9\u5206\u4ee3\u7801\u53ef\u4ee5\u62ff\u5230$50$\u5206\u7684\u597d\u6210\u7ee9\u3002\u4f46\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53e6\u4e00\u79cd\u505a\u6cd5\u5c06\u5e38\u6570/\u590d\u6742\u5ea6\u964d\u4f4e\u3002\n\n##  \u53e6\u4e00\u79cd\u505a\u6cd5\n\n\u89c2\u5bdf\uff1a\n\n$$\\sum_{d=1}^n\\sum_{k=1}^\\frac{n}{d}\\mu(k)\\sum_{i=1}^\\frac{n}{kd}\\sum_{j=1}^\\frac{n}{kd}d^{kd(i+j)}$$\n\n$$=\\sum_{d=1}^n \\sum_{k=1}^\\frac{n}{d} \\mu(k)(d^{kd}+d^{2kd}+...+d^{\\frac{n}{kd}*kd=n})^2.$$\n\n\u8fd9\u91cc\u540c\u6837\u89c2\u5bdf\u5f0f\u5b50\u53d1\u73b0\u53ef\u4ee5\u76f4\u63a5\u7b97\u3002\u524d\u4e00\u90e8\u5206\u662f$O(n\\ln n)$\u7684$n$\u500d\u8c03\u548c\u7ea7\u6570\u7684\u590d\u6742\u5ea6\uff0c\u540e\u9762\u5e26\u4e0a\u4e00\u4e2a$O(\\log n)$\u7cbe\u7ec6\u5904\u7406\u7684\u7b49\u6bd4\u6570\u5217\u6c42\u6c42\u548c\u590d\u6742\u5ea6\u3002\n\n\uff08\u4ee3\u7801\u4e2d\u7684\u4f18\u5316\u5373\u4f7f\u4e0d\u52a0\u4e5f\u662f\u53ef\u4ee5\u8fc7\u7684\uff09\n\n```cpp\n#define __AVX__ 1\n#define __AVX2__ 1\n#define __SSE__ 1\n#define __SSE2__ 1\n#define __SSE2_MATH__ 1\n#define __SSE3__ 1\n#define __SSE4_1__ 1\n#define __SSE4_2__ 1\n#define __SSE_MATH__ 1\n#define __SSSE3__ 1\n#pragma GCC optimize(\"Ofast,no-stack-protector,unroll-loops,fast-math\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4.1,sse4.2,avx,avx2,popcnt,tune=native\")\n#include <immintrin.h>\n#include <emmintrin.h>\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <string>\n#include <bitset>\nusing namespace std;\nconst int MAXN=1.5e6+10;\nint mod,T;\nbitset<MAXN+1>vis;\nint p[MAXN+1],cnt,mu[MAXN+1],N;\ninline int Mod(long long a, int pp){\n    return a>=pp ? a%pp : a>=0 ? a : a+pp;\n}\ninline int add(int x,int y){return Mod( (1ll+x+y+mod-1ll),mod);}\ninline int mul(int x,int y){return Mod(1ll*x*y,mod);}\nvoid pretreatment(){\n\tmu[1]=1;\n\tfor(int i=2;i<=MAXN;++i){\n\t\tif(!vis[i])p[++cnt]=i,mu[i]=-1;\n\t\tfor(int j=1;j<=cnt&&i*p[j]<=MAXN;++j){\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif(Mod(i,p[j])==0)break;\n\t\t\tmu[i*p[j]]=-mu[i];\n\t\t}\n\t}\n}\ninline int qpow(int a,int b){\n\tif(!b)return 1;\n\tif(a<=1||b==1)return a;\n\tint res=1;\n\twhile(b){\n\t\tif(b&1)res=mul(res,a);\n\t\ta=mul(a,a);b>>=1;\n\t}\n\treturn res;\n}\ninline int calc(int x,int y){\n\tif(y==1)return x;\n\tint res=calc(x,y>>1);\n\tres=add(res,mul(res,qpow(x,y>>1)));\n\tif(y&1)res=add(res,mul(x,qpow(x,y-1)));\n\treturn res;\n}\n\ninline int Calc(int x,int y){int ans=calc(x,y);return mul(ans,ans);} \nint ssolve(int n,int d){\n\tint res=0;\n\tfor(register int l=1;l<=n;++l){\n\t\tif(!mu[l])continue;\n\t\tres=add(res,mul(mu[l],Calc(qpow(d,l),n/l)));\n\t}\n\treturn res;\n}\nint solve(int n){\n\tint ans=0;\n\tfor(register int l=1;l<=n;l++){\n\t\tans=add(ans,ssolve(n/l,qpow(l,l)));\n\t}\n\treturn ans;\n}\nsigned main(){\n\tscanf(\"%lld\",&T);\n\tpretreatment();\n\tfor(;T;T--){\n\t\tscanf(\"%lld%lld\",&N,&mod);\n\t\tprintf(\"%lld\\n\",solve(N));\n\t}\n\treturn 0;\n}\n```\n\n\u53ef\u4ee5\u7528\u6574\u9664\u5206\u5757\u51cf\u5c11\u5faa\u73af\u4e2d\u4e58\u6cd5\u7684\u4f7f\u7528\uff0c\u5bf9\u4ee3\u7801\u901f\u5ea6\u53ef\u80fd\u6709\u4e00\u5b9a\u7684\u63d0\u5347\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=1.5e6+10;\nint mod,T;\nbitset<MAXN+1>vis;\nint p[MAXN+1],cnt,mu[MAXN+1],N;\ninline int Mod(long long a, int pp){return a>=pp ? a%pp : a>=0 ? a : a+pp;}\ninline int add(int x,int y){return Mod( (1ll+x+y+mod-1ll),mod);}\ninline int mul(int x,int y){return Mod(1ll*x*y,mod);}\ninline int qpow(int a,int b){\n\tif(!b)return 1;\n\tif(a<=1||b==1)return a;\n\ta=Mod(a,mod);\n\tint res=1;\n\twhile(b){\n\t\tif(b&1)res=mul(res,a);\n\t\ta=mul(a,a);b>>=1;\n\t}\n\treturn res;\n}\ninline int calc(int x,int y){\n\tif(y==1)return x;\n\tint res=calc(x,y>>1);\n\tres=add(res,mul(res,qpow(x,y>>1)));\n\tif(y&1)res=add(res,mul(x,qpow(x,y-1)));\n\treturn res;\n}\ninline int Calc(int x,int y){int ans=calc(x,y);return mul(ans,ans);} \nint ssolve(int n,int d){\n\tint res=0;\n\tfor(register int l=1,r;l<=n;l=r+1){\n\t\tr=(n/(n/l));\n\t\tint D=n/l;\n\t\tfor(int i=l;i<=r;++i){\n\t\t\tif(!mu[i])continue;\n\t\t\tres=add(res,mul(mu[i],Calc(qpow(d,i),D)));\n\t\t}\n\t}\n\treturn res;\n}\nint solve(int n){\n\tint ans=0;\n\tfor(register int l=1,r;l<=n;l=r+1){\n\t\tr=(n/(n/l));\n\t\tint D=n/l;\n\t\tfor(int i=l;i<=r;++i)ans=add(ans,ssolve(D,qpow(i,i)));\n\t}\n\treturn ans;\n}\nint main(){\n\tscanf(\"%d\",&T);\n\tmu[1]=1;\n\tfor(register int i=2;i<=MAXN;++i){\n\t\tif(!vis[i])p[++cnt]=i,mu[i]=-1;\n\t\tfor(register int j=1;j<=cnt&&i*p[j]<=MAXN;++j){\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif(Mod(i,p[j])==0)break;\n\t\t\tmu[i*p[j]]=-mu[i];\n\t\t}\n\t}\n\tfor(;T;T--){\n\t\tscanf(\"%d%d\",&N,&mod);\n\t\tprintf(\"%d\\n\",solve(N));\n\t}\n\treturn 0;\n}\n```\n\nupdate on 2020.9.8\uff1a\n\n\u7ecf\u7531\u5927\u4f6c @C3H5ClO \u5927\u4f6c\u8bc1\u660e\uff0c\u4e0a\u9762\u8fd9\u4efd\u4ee3\u7801\u5b9e\u9645\u4e0a\u662f$O(n\\log n)$\u7684\u3002\n\n\u6700\u540e\u501f\u7528\u4e00\u4e0b @C3H5ClO \u5927\u4f6c\u7684\u8bc1\u660e\uff1a\n\n$$f(n)=\\sum_{d=1}^n\\sum_{e=1}^{\\lfloor \\frac{n}{d} \\rfloor}\\mu(e)(\\sum_{i=1}^{\\lfloor \\frac{n}{de}\\rfloor}d^{de})^2$$\n\n$$T(n)=O(\\sum_{d=1}^n\\sum_{e=1}^{\\lfloor \\frac{n}{d} \\rfloor}\\log\\lfloor \\frac{n}{de}\\rfloor)$$\n\n$$T(n)=O(\\sum_{i=1}^n\\int_0^{\\frac{n}{i}}\\log\\frac{n}{ix}\\mathrm{d}x)$$\n\n>$$\\int\\log\\frac{n}{x}\\mathrm{d}x=(\\log n+1)x-x\\log x+C$$\n>\n>$$\\int_0^n\\log\\frac{n}{x}\\mathrm{d}x=n$$\n\n$$T(n)=O(\\sum_{i=1}^n\\frac{n}{i})=O(n\\ln n)$$\n\n\n\u51fa\u8fd9\u9898\u7684\u672c\u610f\u5176\u5b9e\u662f\u60f3\u770b\u770b\u6709\u6ca1\u6709\u540a\u6253$\\text{std}$\u7684\u505a\u6cd5\u7684\uff0c\u7b14\u8005\u63a8\u4e86\u5f88\u4e45\u5e76\u6ca1\u6709\u627e\u5230\u7ebf\u6027\u7684\u505a\u6cd5\u3002",
        "postTime": 1599561691,
        "uid": 128591,
        "name": "Refined_heart",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6825 \u3010\u300cEZEC-4\u300d\u6c42\u548c\u3011"
    },
    {
        "content": "\u79d1\u6280\u7684\u529b\u91cf\uff01\uff01\uff01\uff01\uff01\uff01~~\u6211\u5fb7\u610f\u5fd7\u79d1\u6280\u5929\u4e0b\u7b2c\u4e00\uff01\uff01\uff01~~\n\n\u8fd9\u662f\u4e00\u7bc7\u9700\u8981\u4e00\u70b9\u513f\u79d1\u6280\u7684\u9898\u89e3\uff0c\u4f46\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u79d1\u6280\u6211\u8ba4\u4e3a\u751a\u81f3\u7b97\u4e0d\u4e0a\u79d1\u6280\uff0c\u592a simple \u4e86\u3002\n\n\u9996\u5148\u662f\u63a8\u67ff\u5b50\uff1a\n$$ \\sum_{i=1}^n\\sum_{j=1}^n\\gcd(i,j)^{i+j} $$\n$$ \\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^n[\\gcd(i,j)=d]d^{i+j} $$\n$$ \\sum_{d=1}^n\\sum_{i=1}^{\\lfloor \\frac n d \\rfloor}\\sum_{j=1}^{\\lfloor \\frac n d \\rfloor}[\\gcd(i,j)=1](d^d)^{i+j} $$\n$$ \\sum_{d=1}^n\\sum_{i=1}^{\\lfloor \\frac n d \\rfloor}\\sum_{j=1}^{\\lfloor \\frac n d \\rfloor}\\sum_{k|i,k|j}\\mu(k)(d^d)^{i+j} $$\n$$ \\sum_{d=1}^n\\sum_{k=1}^{\\lfloor \\frac n d \\rfloor}\\sum_{i=1}^{\\lfloor \\frac n {dk} \\rfloor}\\sum_{j=1}^{\\lfloor \\frac n {dk} \\rfloor\n}\\mu(k)(d^{dk})^{i+j} $$\n\u8bbe\n$$ f(d,n)=\\sum_{i=1}^n\\sum_{j=1}^nd^{i+j} $$\n\u7279\u522b\u7684\uff0c\u5f53 $ d=1 $ \u65f6\uff0c$ f(1,n)=n^2 $\n\n\u5426\u5219\u4e0a\u9762\u90a3\u73a9\u610f\u513f\u5c31\u662f\uff1a\n$$ (\\sum_{i=1}^nd^i)^2 $$\n\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u5728 $ O(\\log n) $ \u7684\u65f6\u95f4\u5185\u7b97\u51fa\u6765\u3002\n\n\u56de\u5230\u539f\u67ff\uff1a\n$$ \\sum_{d=1}^n\\sum_{k=1}^{\\lfloor \\frac n d \\rfloor}\\mu(k)f(d^{dk},\\lfloor \\frac n {dk} \\rfloor) $$\n\u8003\u8651\u5c06 $ (d^d)^k $ \u5e26\u5165 $ f $\u3002\u53ef\u4ee5\u53d1\u73b0 $ f $ \u53ea\u4e0e $ d^d $ \u7684\u82e5\u5e72\u6b21\u65b9\u6709\u5173\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5e42\u7684\u4e0a\u754c\u662f $ O(k \\times \\lfloor \\frac n {dk} \\rfloor)=O(n) $\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u6240\u6709\u7684 $ d^d $ \u9884\u5904\u7406\u5149\u901f\u5e42\u6570\u7ec4\u3002\u53ef\u4ee5\u53c2\u8003[\u8fd9\u91cc](https://www.luogu.com.cn/paste/umoclwgy)\uff0c\u590d\u6742\u5ea6\u662f $ O(\\sqrt [4] {lim})-O(1) $\u3002\u672c\u9898\u7684 $ lim $ \u4e3a $ 1.5 \\times 10^6 $\uff0c\u4e0d\u8fc7\u5b9e\u9645\u4e0a\u5f53 $ d=1 $ \u65f6\u4e0d\u9700\u8981\u5149\u901f\u5e42\u6570\u7ec4\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u4e0a\u754c\u4e0d\u5230 $ 10^6 $\u3002\u522b\u5c0f\u770b\u8fd9\u4e00\u70b9\uff0c$ 2^{20}>10^6 $\uff0c\u8fd9\u5bfc\u81f4\u4e86\u7a7a\u95f4\u548c\u65f6\u95f4\u590d\u6742\u5ea6\u5f97\u5230\u4e86\u6539\u5584\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53d1\u73b0\u552f\u4e00\u7684\u95ee\u9898\u662f\u6c42 $ (d^d)^k-1 $ \u7684\u9006\u5143\u3002\u6211\u4eec\u4f7f\u7528\u79bb\u7ebf\u6c42\u9006\u5143\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f\u5c01\u88c5\u597d\u7684\u79bb\u7ebf\u6c42\u9006\u5143\u3002\n\n\u4ee5\u53ca\uff0c\u8fd9\u4e2a\u5c51\u9898\u5361\u7a7a\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9 $ [1,n] $ \u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u5bf9\u6bcf\u4e00\u6bb5\u4f7f\u7528\u79bb\u7ebf\u6c42\u9006\u5143\u548c\u5149\u901f\u5e42\u3002\u79bb\u7ebf\u6c42\u9006\u5143\u5f53\u7f13\u5b58\u6ee1\u4e86\u7684\u65f6\u5019\u9700\u8981\u6e05\u7a7a\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u6bcf\u6bb5\u7684\u957f\u5ea6\u6700\u597d\u662f $ 8 $\uff0c\u56e0\u4e3a\u79bb\u7ebf\u6c42\u9006\u5143\u6700\u591a\u53ea\u4f1a\u6267\u884c $ 10^5 $ \u6b21\uff0c\u4e14\u5149\u901f\u5e42\u7684\u9884\u5904\u7406\u4e0d\u4f1a\u70b8\u7a7a\u95f4\u3002\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\u5c31\u662f\uff0c\u8fd9\u4f7f\u5f97\u79bb\u7ebf\u6c42\u9006\u5143\u7684\u7f13\u5b58\u533a\u5f88\u77ed\uff0c\u80fd\u591f\u5361\u8fdb\u6267\u884c\u6587\u4ef6\u7684\u7f13\u5b58\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u5e38\u6570\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a $ O(n\\sqrt [4] {n}+n\\ln n) $\u3002\n\n\u4f18\u53161\uff1a\u53ea\u679a\u4e3e $ \\mu(k) \\neq 0 $ \u7684 $ k $\uff0c\u5e38\u6570\u964d\u4f4e\u3002\n\n\u4f18\u53162\uff1a\u5f53 $ d $ \u8f83\u5927\u65f6\uff0c\u80fd\u591f\u4e0e\u5176\u5339\u914d\u7684 $ k $ \u8fc7\u5c11\uff0c\u6b64\u65f6\u4f7f\u7528\u5feb\u901f\u5e42\u6bd4\u5149\u901f\u5e42\u66f4\u4f18\u3002\n\n\u4e0d\u8fc7\u4e0d\u77e5\u9053\u4e3a\u5565\u53ea\u8dd1\u4e86 1.16s\uff0c\u8dd1\u5f97\u98de\u5feb\u3002\u3002\u3002\n\ncode:\n```cpp\n#include<cstdio>\n#include<vector>\ntypedef unsigned uint;\ntypedef __uint128_t L;\ntypedef unsigned long long ull;\nconst uint M=1.5e6+5;\nuint P,top,pri[M],mu[M];bool zhi[M];\nstruct FastMod{\n    ull b,m;\n    FastMod(ull b):b(b),m(ull((L(1)<<64)/b)){}\n    friend inline ull operator%(const ull&a,const FastMod&mod){\n        ull r=a-(L(mod.m)*a>>64)*mod.b;\n        return r>=mod.b?r-mod.b:r;\n    }\n}mod(2);\nstruct Pow{\n\tstd::vector<uint>p1,p2,p3,p4;\n\tinline void clear(){\n\t\tstd::vector<uint>().swap(p1);std::vector<uint>().swap(p2);\n\t\tstd::vector<uint>().swap(p3);std::vector<uint>().swap(p4);\n\t}\n\tinline void init(register uint x){\n\t\tregister uint i;\n\t\tp1.reserve(33);p2.reserve(33);p3.reserve(33);p4.reserve(33);\n\t\tp1[0]=p2[0]=p3[0]=p4[0]=1;\n\t\tfor(p1[1]=x,i=2;i<=32;++i)p1[i]=1ull*p1[i-1]*x%mod;\n\t\tfor(x=p2[1]=p1[32],i=2;i<=32;++i)p2[i]=1ull*p2[i-1]*x%mod;\n\t\tfor(x=p3[1]=p2[32],i=2;i<=32;++i)p3[i]=1ull*p3[i-1]*x%mod;\n\t\tfor(x=p4[1]=p3[32],i=2;i<=32;++i)p4[i]=1ull*p4[i-1]*x%mod;\n\t}\n\tinline uint pow(const uint&x){\n\t\treturn 1ull*p1[x&31]*p2[x>>5&31]%mod*p3[x>>10&31]%mod*p4[x>>15&31]%mod;\n\t}\n\tPow(){\n\t\tclear();\n\t}\n}p[M>>1];\ninline uint pow(uint a,uint b){\n\tuint ans=1;\n\tfor(;b;b>>=1,a=1ull*a*a%mod)if(b&1)ans=1ull*ans*a%mod;\n\treturn ans;\n}\ninline void sieve(const uint&M){\n\tregister uint i,j,x;mu[1]=1;\n\tfor(i=2;i<=M;++i){\n\t\tif(!zhi[i])mu[pri[++top]=i]=-1;\n\t\tfor(j=1;j<=top&&(x=i*pri[j])<=M;++j){\n\t\t\tzhi[x]=true;if(!(i%pri[j]))break;mu[x]=-mu[i];\n\t\t}\n\t}\n}\ninline uint calc(const uint&d,const uint&D,const uint&len,const uint&k,const uint&inv){\n\tuint S=(1ull*D*p[d].pow(len*k)%mod-p[d].pow(k)+P)*inv%mod;\n\treturn 1ull*S*S%mod;\n}\nstruct GetAns{\n\tuint ans,len,d[131073],k[131073],l[131073],f[131073],S[131073];bool o[131073];\n\tinline void flush(){\n\t\tuint i,s;if(!len)return;\n\t\tfor(i=1;i<=len;++i)S[i]=1ull*S[i-1]*f[i]%mod;s=pow(S[len],P-2);\n\t\tdo{\n\t\t\tif(o[len])ans=(ans+calc(d[len],f[len]+1,l[len],k[len],1ull*s*S[len-1]%mod))%mod;\n\t\t\telse ans=(ans+P-calc(d[len],f[len]+1,l[len],k[len],1ull*s*S[len-1]%mod))%mod;\n\t\t\ts=1ull*s*f[len]%mod;\n\t\t}while(--len);\n\t}\n\tinline void Insert(const uint&cd,const uint&ck,const uint&cl,const uint&cf,const bool&co){\n\t\t++len;d[len]=cd;k[len]=ck;l[len]=cl;f[len]=cf;o[len]=co;\n\t\tif(!(len&131071))flush();\n\t}\n}q;\ninline uint Solve(const uint&n){\n\tconst uint&lim4=n/4,&lim3=n/3,lim2=n/2;\n\tregister uint i,k,x,ans=0,lst=2;q.ans=q.len=0;\n\tfor(i=1;i<=n;++i){\n\t\tif(mu[i]==1)ans=(ans+1ull*(n/i)*(n/i))%mod;\n\t\telse if(mu[i])ans=(ans+P-1ull*(n/i)*(n/i)%mod)%mod;\n\t}\n\tfor(i=2;(i<<1)<=n;++i){\n\t\tif(!(i&7)){\n\t\t\tq.flush();while(lst^i)p[lst++].clear();\n\t\t}\n\t\tp[i].init(pow(i,i));\n\t\tfor(k=1;i*k<=n;++k){\n\t\t\tif(mu[k]){\n\t\t\t\tx=p[i].pow(k)-1;\n\t\t\t\tif(!x){\n\t\t\t\t\tif(mu[k]==1)ans=(ans+1ull*(n/(i*k))*(n/(i*k)))%mod;\n\t\t\t\t\telse if(mu[k])ans=(ans+P-1ull*(n/(i*k))*(n/(i*k))%mod)%mod;\n\t\t\t\t}\n\t\t\t\telse q.Insert(i,k,n/(i*k),x,mu[k]==1);\n\t\t\t}\n\t\t}\n\t}\n\tq.flush();while(lst^i)p[lst++].clear();\n\tfor(ans=(ans+q.ans)%mod;i<=n;++i)k=pow(i,i),ans=(ans+1ull*k*k)%mod;\n\treturn ans;\n}\nsigned main(){\n\tuint T,n1,n2,m1,m2;q.S[0]=1;\n\tscanf(\"%u\",&T);\n\tif(T==1)scanf(\"%u%u\",&n1,&m1),sieve(n1),mod=FastMod(P=m1),printf(\"%u\",Solve(n1));\n\telse{\n\t\tscanf(\"%u%u%u%u\",&n1,&m1,&n2,&m2);\n\t\tsieve(n1>n2?n1:n2);\n\t\tmod=FastMod(P=m1);printf(\"%u\\n\",Solve(n1));\n\t\tmod=FastMod(P=m2);printf(\"%u\",Solve(n2));\n\t}\n}\n```\n\u95f2\u8bdd\uff1a\u8fd9\u4e2a $ O(n\\log n) $ \u53ef\u6bd4\u5b98\u65b9\u9898\u89e3\u7684 $ O(n\\log n) $  \u9760\u8c31\u591a\u4e86\u3002",
        "postTime": 1629363392,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u8bba \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14+\u5149\u901f\u5e42 P6825\u9898\u89e3"
    },
    {
        "content": "\u662f\u4e00\u9053\u953b\u70bc\u5361\u5e38\u6c34\u5e73\u7684\u597d\u9898\uff01\n\n\u5148\u63a8\u67ff\u5b50\n$$\n\\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^nd^{i+j}[gcd(i,j)=d]\n$$\n\n$$\n\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor{n/d\\rfloor}}\\sum_{j=1}^{\\lfloor{n/d\\rfloor}}d^{di+dj}[gcd(i,j)=1]\n$$\n\n$$\n\\sum_{d=1}\\sum_{k=1}\\mu(k)\\sum_{i=1}^{\\lfloor{n/dk\\rfloor}}d^{idk}\\sum_{j=1}^{\\lfloor{n/dk\\rfloor}}d^{jdk}\n$$\n\n\u8003\u8651\u52a0\u4e0a$dk\\le n$\u7684\u6761\u4ef6\uff0c\u7b54\u6848\u4e0d\u53d8\n$$\n\\sum_{d=1}\\sum_{k=1}^{\\lfloor n/d\\rfloor}\\mu(k)\\sum_{i=1}^{\\lfloor{n/dk\\rfloor}}d^{idk}\\sum_{j=1}^{\\lfloor{n/dk\\rfloor}}d^{jdk}\n$$\n\u524d\u9762\u4e24\u4e2a\u5408\u8d77\u6765\u662f\u8c03\u548c\u7ea7\u6570\uff0c\u540e\u9762\u5c31\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u7206\u7b97\uff0c\u590d\u6742\u5ea6$\\mathcal O(n\\log n\\log p)$ \u53ef\u5f9750\u5206\u3002\n\n\u53d1\u73b0\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u90a3\u91cc$\\mathcal O(\\log p)$\u662f\u56e0\u4e3a\u6c42\u9006\u5143\u3002\u90a3\u4e48\u4e0d\u59a8**\u79bb\u7ebf\u6c42\u9006\u5143**\uff0c\u90a3\u5c31\u53ea\u6709\u4e00\u4e2a\u5feb\u901f\u5e42\u7684\u590d\u6742\u5ea6\u4e86\uff0c\u603b\u5171\u5c31\u662f$\\mathcal O(n\\log^2 n)$.\n\n\u53e6\u5916\uff0c\u76f4\u63a5\u79bb\u7ebf\u6c42\u9006\u5143\u7a7a\u95f4\u4e0d\u591f\uff0c\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6bcf\u6bb5\u957f\u5ea6$10^6$\u53bb\u7b97\u5c31\u597d\u3002\n\n\u52aa\u529b\u5361\u5e38\u5373\u53efAC\u3002[code](https://pasteme.cn/51851)\n\nPS:\u540e\u6765\u6709\u4eba\u4e00\u901a\u79ef\u5206\u8bc1\u51fa\u6765\u662f$\\mathcal O(n\\log n)$\u7684\u3002\n\n~~PPS:\u52a0\u4e86\u4e00\u5806\u5feb\u901f\u53d6\u6a21\u7b49\u4f18\u5316\uff0c\u6211\u5361\u8fdb\u4e86\u6700\u4f18\u89e3\u7b2c\u4e00\u9875\uff0c\u4e00\u8d77\u6765\u5361\u5e38\u554a~~",
        "postTime": 1599721311,
        "uid": 73142,
        "name": "\u4e07\u5f18",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6825 \u3010\u300cEZEC-4\u300d\u6c42\u548c\u3011"
    },
    {
        "content": "# \u9898\u76ee\u63cf\u8ff0\n\n$T$ \u7ec4\u6570\u636e\uff0c\u5bf9\u4e8e\u6bcf\u7ec4\u6570\u636e\uff0c\u7ed9\u5b9a $n,p$\uff0c\u8ba1\u7b97\u4e0b\u9762\u7684\u5f0f\u5b50\u5bf9 $p$ \u53d6\u4f59\u7684\u7ed3\u679c\u3002\n\n$$\n\\sum_{i=1}^n\\sum_{i=1}^n\\gcd(i, j)^{i+j}\n$$\n\n\u5176\u4e2d $1 \\leq T \\leq 2,1 \\leq \\sum n \\leq 1.5 \\times 10^6, 2 \\leq p \\leq 2^{31}-1 \\text{\u4e14 p \u4e3a\u8d28\u6570}$\u3002\n\n# $\\mathcal{Solution}$\n\n\u63a8\u4e00\u4e0b\u5f0f\u5b50\uff1a\n\n$$\n\\sum_{i=1}^n \\sum_{j=1}^n \\gcd(i,j)^{i+j}\n\\\\\n\\sum_{d=1}^n\\sum_{i=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } \\sum_{j=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } [\\gcd(i,j)=1]d^{id+jd}\n$$\n\n\u5229\u7528 $\\mu*1=\\epsilon$\uff1a\n\n$$\n\\sum_{d=1}^n\\sum_{i=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } \\sum_{j=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } \\sum_{k|i,k|j} \\left ( \\mu(k)\\times d^{id+jd} \\right ) \n$$\n\n\u628a\u679a\u4e3e $k$ \u63d0\u5230\u524d\u9762\uff0c\u539f\u5148\u7684\u679a\u4e3e $i,j$ \u5c31\u53d8\u6210\u4e86\u679a\u4e3e $k$ \u7684\u500d\u6570 $ik,jk$\u3002\n\n$$\n\\sum_{d=1}^n\\sum_{k=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor} \\mu(k)\\sum_{i=1}^{\\left \\lfloor \\frac{n}{kd} \\right \\rfloor } \\sum_{j=1}^{\\left \\lfloor \\frac{n}{kd} \\right \\rfloor } d^{ikd+jkd}\n$$\n\n\u8bbe $T=kd$\uff1a\n\n$$\n\\sum_{d=1}^n\\sum_{k=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } \\mu(k) \\sum_{i=1}^{\\left \\lfloor \\frac{n}{T} \\right \\rfloor } \\sum_{j=1}^{\\left \\lfloor \\frac{n}{T} \\right \\rfloor } d^{iT}\\times d^{jT}\n\\\\\n\\sum_{d=1}^n\\sum_{k=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } \\mu(k) \\left ( \\sum_{i=1}^{\\left \\lfloor \\frac{n}{T} \\right \\rfloor }d^{iT} \\right )  \\left ( \\sum_{j=1}^{\\left \\lfloor \\frac{n}{T} \\right \\rfloor }  d^{jT} \\right )\n\\\\\n\\sum_{d=1}^n\\sum_{k=1}^{\\left \\lfloor \\frac{n}{d} \\right \\rfloor } \\mu(k) \\left ( \\sum_{i=1}^{\\left \\lfloor \\frac{n}{T} \\right \\rfloor }{(d^{T})}^i \\right )^2\n$$\n\n\u5e73\u65b9\u91cc\u9762\u662f\u4e2a\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u53ef\u4ee5\u5728 $\\mathcal{O}(\\log \\left \\lfloor \\frac{n}{T} \\right \\rfloor)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\uff0c\u81f3\u4e8e $d^T$\uff0c\u53ef\u4ee5\u5728\u6bcf\u679a\u4e3e\u5230\u4e00\u4e2a $d$ \u7684\u65f6\u5019\u5feb\u901f\u5e42\u4e00\u4e0b $d^d$\uff0c\u7136\u540e\u5728\u679a\u4e3e $k$ \u4e00\u6b65\u4e00\u6b65\u4e58\u3002\n\n\u679a\u4e3e $d,k$ \u662f\u8c03\u548c\u7ea7\u6570 $\\mathcal{O}(n\\log n)$\uff0c~~\u540e\u9762\u590d\u6742\u5ea6\u5c31\u4e0d\u4f1a\u5206\u6790\u4e86~~\uff0c\u6709\u5927\u4f6c\u8bc1\u660e\u51fa\u662f $\\mathcal{O}(n\\log n)$ \u7684\u3002\n\n\u5982\u4f55\u5728 $\\mathcal{O}(\\log n)$ \u7684\u65f6\u95f4\u5185\u7b97 $n$ \u9879\u7b49\u6bd4\u6570\u5217\u7684\u548c\uff1f\n\n\u8bbe $S_n$ \u4e3a\u7b49\u6bd4\u6570\u5217\u7684\u524d $n$ \u9879\u548c\uff0c\u90a3\u4e48\u6709\uff1a\n$$\nS_n=\\left\\{\\begin{matrix}\nS_{\\frac{n}{2}}(1+q^{\\frac{n}{2}}),n\\bmod2=0\n \\\\\nS_{\\frac{n-1}{2}}(1+q^{\\frac{n-1}{2}})+q^n,n\\bmod2=1\n\\end{matrix}\\right.\n$$\n\u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u5206\u6cbb\u5feb\u901f\u5e42\u7b97 $q^n$ \u7684\u65f6\u5019\u987a\u5e26\u7b97\u4e86\u4e00\u4e0b $S_n$\uff0c\u6ce8\u610f\u5230\u5728\u7b97 $S_{n}$ \u7684\u65f6\u5019\u628a $q^n$ \u7b97\u51fa\u6765\u540e\u4f20\u7ed9\u4e0a\u4e00\u5c42\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u4e3a $\\mathcal{O}(\\log n)$ \u4e86\uff0c\u4e0d\u5fc5\u518d\u5feb\u901f\u5e42\u8ba1\u7b97 $q^n$\u3002\n\n# $\\mathcal{Code}$\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\nnamespace do_while_true {\n\t#define ld double\n\t#define ll long long\n\t#define re register\n\t#define pb push_back\n\t#define fir first\n\t#define sec second\n\t#define pp std::pair<ll, ll>\n\t#define mp std::make_pair\n\ttemplate <typename T>\n\tinline T Max(T x, T y) { return x > y ? x : y; }\n\ttemplate <typename T>\n\tinline T Min(T x, T y) { return x < y ? x : y; }\n\ttemplate <typename T>\n\tinline T Abs(T x) {\treturn x < 0 ? -x : x; }\n\ttemplate <typename T>\n\tinline T& read(T& r) {\n\t\tr = 0; bool w = 0; char ch = getchar();\n\t\twhile(ch < '0' || ch > '9') w = ch == '-' ? 1 : 0, ch = getchar();\n\t\twhile(ch >= '0' && ch <= '9') r = r * 10 + (ch ^ 48), ch = getchar();\n\t\treturn r = w ? -r : r;\n\t}\n\ttemplate <typename T>\n\tinline T qpow(T x, T y, T mod) {\n\t\tre T sumq = 1; x %= mod;\n\t\twhile(y) {\n\t\t\tif(y&1) sumq = sumq * x % mod;\n\t\t\tx = x * x % mod;\n\t\t\ty >>= 1;\n\t\t}\n\t\treturn sumq;\n\t}\n\tchar outch[110];\n\tint outct;\n\ttemplate <typename T>\n\tinline void print(T x) {\n\t\tdo {\n\t\t\toutch[++outct] = x % 10 + '0';\n\t\t\tx /= 10;\n\t\t} while(x);\n\t\twhile(outct >= 1) putchar(outch[outct--]);\n\t}\n}\nusing namespace do_while_true;\n\nconst int N = 1500010 + 10;\ntemplate <typename T, typename T2>\ninline T Mod(T x, T2 p) { return x % p; }\n\nll ans;\nbool vis[N];\nint prime[N], ct, mu[N];\n\npp db(ll x, int n, ll p) {\n\tif(n == 0) return mp(1ll, 1ll);\n\tif(n == 1) return mp(x, x);\n\tif((n & 1) == 0) {\n\t\tpp temp = db(x, n / 2, p);\n\t\treturn mp(temp.fir * ((1 + temp.sec) % p) % p, temp.sec * temp.sec % p);\n\t}\n\tpp temp = db(x, (n-1) / 2, p);\n\tll qn = temp.sec * temp.sec % p * x % p;\n\treturn mp((temp.fir * ((1 + temp.sec) % p) % p + qn) % p, qn);\n}\n\nvoid mian(int n, ll p) {\n\tans = 0;\n\tfor(int d = 1; d <= n; ++d) {\n\t\tll dd = qpow(1ll * d, 1ll * d, p);\n\t\tll kd = dd;\n\t\tfor(int k = 1; k <= n / d; ++k) {\n\t\t\tpp temp = db(kd, n / (k * d), p);\n\t\t\tans = (ans + temp.fir * temp.fir % p * Mod(mu[k] + p, p) % p) % p;\n\t\t\tkd = kd * dd % p;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", ans);\n}\n\nint n[3], mx;\nll p[3];\n\nvoid pre() {\n\tvis[1] = 1; mu[1] = 1;\n\tfor(int i = 2; i <= mx; ++i) {\n\t\tif(!vis[i]) {\n\t\t\tprime[++ct] = i;\n\t\t\tmu[i] = -1;\n\t\t}\n\t\tfor(int j = 1; j <= ct && 1ll * i * prime[j] <= mx; ++j) {\n\t\t\tvis[i * prime[j]] = 1;\n\t\t\tif(i % prime[j] == 0) {\n\t\t\t\tmu[i * prime[j]] = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i * prime[j]] = mu[i] * mu[prime[j]];\n\t\t}\n\t}\n}\n\nsigned main() {\n\tint T = 1;\n\tread(T);\n\tfor(int i = 1; i <= T; ++i) read(n[i]), read(p[i]), mx = Max(mx, n[i]);\n\tpre();\n\tfor(int i = 1; i <= T; ++i) mian(n[i], p[i]);\n\tfclose(stdin);\n\treturn 0;\n}\n```",
        "postTime": 1616752467,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6825 \u300cEZEC-4\u300d\u6c42\u548c"
    },
    {
        "content": "\n\n### [P6825 \u300cEZEC-4\u300d\u6c42\u548c](https://www.luogu.com.cn/problem/P6825)\n\n\u6c42\uff1a\n$$\n\\sum_{i=1}^{n}\\sum_{j=1}^{n}\\gcd(i,j)^{i+j}\n$$\n\u5148\u5316\u7b80\u539f\u5f0f\uff0c\u6709\uff1a\n$$\n\\begin{aligned}\n&\\sum_{i=1}^{n}\\sum_{j=1}^{n}\\gcd(i,j)^{i+j}\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{n}\\sum_{j=1}^{n}d^{i+j}[\\gcd(i,j)=d]\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}d^{d\\cdot(i+j)}[\\gcd(i,j)=1]\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}d^{d\\cdot(i+j)}\\sum_{p|\\gcd(i,j)}\\mu(p)\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}d^{d\\cdot(i+j)}[p|i][p|j]\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{pd}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{pd}\\rfloor}d^{dp\\cdot(i+j)}\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{T}\\rfloor}d^{T\\cdot(i+j)} & T=dp\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}(d^T)^i\\sum_{j=1}^{\\lfloor\\frac{n}{T}\\rfloor}(d^T)^j\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p)\\left(\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}(d^T)^i\\right)^2\n\\end{aligned}\n$$\n\n\u518d\u770b\u540e\u9762\u90a3\u90e8\u5206\uff0c\u4ee4 $x=\\frac{T}{p}^T$\u3002\n\n\u8bbe $S_n$ \u4e3a\u7b49\u6bd4\u6570\u5217\u524d $n$ \u9879\u548c\uff0c\u5219\u6709\uff1a\n$$\nS_n=S_{\\lfloor\\frac{n}{2}\\rfloor}(1+a^{\\lfloor\\frac{n}{2}\\rfloor})+a^n[2 \\nmid n]\n$$\n\u5373\u53ef $\\mathcal O(\\log n)$ \u6c42\u89e3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n \\log n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define ll long long\n\n#define pll pair<ll, ll>\n\n#define mpr make_pair\n\n#define fi first\n\n#define se second\n\nconst int _ = 1.5e6 + 10;\n\nint mod;\n\nint read()\n{\n    int x = 0, f = 1;\n    char c = getchar();\n    while (c < '0' || c > '9')\n    {\n        if (c == '-')\n            f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9')\n    {\n        x = x * 10 + c - '0';\n        c = getchar();\n    }\n    return x * f;\n}\n\nint qpow(int x, int y)\n{\n    int res = 1;\n    while (y)\n    {\n        if (y & 1)\n            res = 1ll * res * x % mod;\n        x = 1ll * x * x % mod;\n        y >>= 1;\n    }\n    return res;\n}\n\npll qsum(int a, int n)\n{\n    if (n == 0)\n        return mpr(1, 1);\n    if (n == 1)\n        return mpr(a, a);\n    pll tmp = qsum(a, n / 2);\n    if (n & 1)\n        return mpr((tmp.fi * (tmp.se + 1) % mod + tmp.se * tmp.se % mod * a % mod) % mod, tmp.se * tmp.se % mod * a % mod);\n    else\n        return mpr(tmp.fi * (tmp.se + 1) % mod, tmp.se * tmp.se % mod);\n}\n\nint T, n, m, k;\n\nbitset<_> vis;\n\nint cnt, pri[_], mu[_];\n\nvoid init(int n)\n{\n    mu[1] = 1;\n    for (int i = 2; i <= n; i++)\n    {\n        if (!vis[i])\n            pri[++cnt] = i, mu[i] = -1;\n        for (int j = 1; j <= cnt && i * pri[j] <= n; j++)\n        {\n            vis[i * pri[j]] = 1;\n            if (i % pri[j] == 0)\n                break;\n            mu[i * pri[j]] = -mu[i];\n        }\n    }\n}\n\nint solve(int n)\n{\n    int ans = 0;\n    for (int d = 1; d <= n; d++)\n    {\n        int a = qpow(d, d);\n        int b = a;\n        for (int p = 1; p <= n / d; p++)\n        {\n            pll tmp = qsum(b, n / (d * p));\n            ans = (ans + tmp.fi * tmp.fi % mod * (mu[p] + mod) % mod) % mod;\n            b = 1ll * b * a % mod;\n        }\n    }\n    return ans;\n}\n\nsigned main()\n{\n    T = read();\n    init(_ - 10);\n    while (T--)\n    {\n        n = read(), mod = read();\n        printf(\"%d\\n\", solve(n));\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1642252684,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P6825 \u300cEZEC-4\u300d\u6c42\u548c"
    },
    {
        "content": "\u9898\u76ee\u7b80\u8ff0\uff1a\n\n$$\n\\sum_{i=1}^n\\sum_{j=1}^{n} \\gcd(i,j)^{i+j}\n$$\n\n\u6c42\u8fd9\u4e2a\u67ff\u5b50\u6a21 $p$ \u7684\u503c\uff0c\u591a\u7ec4\u8be2\u95ee\u3002$\\sum n\\leq 1.5\\times 10^6,p\\in primes,p\\leq 2^{32}-1$\n\n\u5957\u8def\u83ab\u53cd\u9898\uff0c\u4f46\u662f\u6709\u5f88\u591a\u7ec6\u8282\u503c\u5f97\u5546\u69b7\u3002\n\n\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5f97\u5230\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n$$\n\\sum_{d=1}^n\\mu(d)\\times \\sum_{d|T}\\left(\\sum_{i=1}^{\\frac{n}{T}}\\left(d^T\\right)^i\\right)^2\n$$\n\n~~**\u62ff\u9519\u4e86\u6362\u4e00\u4e2a\uff08\u6211\u624d\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u8fb9\u754c\u5199\u9519\u4e86\u63a8\u51fa\u8fd9\u4e2a\u5947\u602a\u7684\u67ff\u5b50**~~\n\n$$\n\\sum_{d=1}^n\\sum_{k=1}^{\\frac{n}{d}}\\mu(k)\\left(\\sum_{i=1}^{\\frac{n}{kd}} (d^{dk})^{i}\\right)^2\n$$\n\n\u4e5f\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u770b\u51fa\u662f\u4e00\u4e2a\u8c03\u548c\u7ea7\u6570\u5957\u7b49\u6bd4\u6570\u5217\u3002\n\n\u91cd\u70b9\u5176\u5b9e\u5728\u4e8e\u7b49\u6bd4\u6570\u5217\u7684\u6c42\u89e3\u4e0a\uff0c\u8fd9\u91cc\u6709\u4e24\u79cd\u89e3\u6cd5\uff08~~\u5176\u5b9e\u6709\u4e09\u79cd\u4f46\u662f\u67d0\u795e\u4ed9\u8ba9\u6211\u522b\u8bf4\u7b2c\u4e09\u79cd\uff0c\u5624\u5624\u5624~~\n\n- \u516c\u5f0f\u6cd5\uff0c\u53ea\u9700\u7528 $S_n=\\frac{a_1(1-q^n)}{1-q}$\u3002\u5728\u672c\u9898\u4e2d $d^{dk}$ \u4e3a\u516c\u6bd4 $q$\uff0c\u4f46\u662f\u6d89\u53ca\u6c42\u9006\u5143\uff0c\u5982\u679c\u76f4\u63a5\u5feb\u901f\u5e42\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n \\ln n \\log p)$ \u7684\uff0c\u4f1a\u83b7\u5f97\u66b4\u529b\u7684\u597d\u6210\u7ee9$\\color{purple}awa$\u3002\u4f46\u662f $\\color{black}\\rm{E}\\color{red}\\rm{legia}$ \u795e\u4ed9\u544a\u8bc9\u6211\u53ef\u4ee5\u7ebf\u6027\u6c42\u9006\u5143\uff0c\u6240\u4ee5\u5176\u5b9e\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n \\ln n)$ \u7684\uff0c\u5177\u4f53\u53ef\u4ee5\u89c1\u67d0\u4f4d\u795e\u4ed9\u7528\u5fae\u79ef\u5206\u7684\u8bc1\u660e\uff08\u3002\n\n- \u5206\u6cbb\u6cd5\uff0c\u5b9a\u4e49 $S_n=\\sum_{i=0}^{n-1} q^i$\uff0c\u6839\u636e\u4e0b\u5f0f\uff1a\n$$\n\\begin{cases}\nS_n=S_{\\frac{n}{2}}(1+q^{\\frac{n}{2}}),n\\equiv0\\pmod 2\n\\\\\nS_n=S_{\\frac{n+1}{2}}(1+q^{\\frac{n-1}{2}})-q^{\\frac{n-1}{2}},n\\equiv1\\pmod 2 \n\\end{cases}\n$$\n- \u4f7f\u7528\u5feb\u901f\u5e42\u8ba1\u7b97 $q^{\\frac{n}{2}},q^{\\frac{n-1}{2}}$ \u53ef\u4ee5\u5728\u4e0d\u4f4e\u4e8e $O(n \\ln n \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\uff1b\u8fd9\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u592a\u4f18\u79c0\uff0c\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5df2\u7ecf\u8ba1\u7b97\u8fc7\u7684 $q$ \u8ba1\u7b97\u51fa\u73b0\u5728 \u7684 $q$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728\u7a33\u5b9a\u4f4e\u4e8e $O(n \\ln n \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n",
        "postTime": 1600266722,
        "uid": 95244,
        "name": "tommymio",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6825 \u3010\u300cEZEC-4\u300d\u6c42\u548c\u3011"
    },
    {
        "content": "\u96be\u8fc7\u554a\u96be\u8fc7\uff0c\u8c01\u77e5\u9053 $O(n \\log n \\log p)$ \u4f1a\u76f4\u63a5\u7206\u6210 $10$ \u5206\uff1f\n\n---\n\n\u63a8\u63a8\u5f0f\u5b50\u3002\n\n\n$$\n\\sum_{i=1}^n \\sum_{j=1}^n \\gcd(i,j)^{i+j}\n$$\n$$\n\\sum_{d=1}^n \\sum_{i=1}^n \\sum_{j=1}^n [\\gcd(i,j)=d] d^{i+j}$$\n$$\n\\sum_{d=1}^n \\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor} \\sum_{j=1}^{\\lfloor \\frac{n}{d}\\rfloor} [\\gcd(i,j)=1] d^{id+jd}\n$$\n$$\n\\sum_{d=1}^n \\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor} d^{id} \\sum_{j=1}^{\\lfloor \\frac{n}{d}\\rfloor} d^{jd} \\sum_{D|i,D|j} \\mu(D)\n$$\n\n\u53d1\u73b0\u4e2d\u95f4\u7684\u4e24\u5768\u53ef\u4ee5\u76f4\u63a5\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u4e8e\u662f\u679a\u4e3e $d$\uff0c\u7136\u540e\u679a\u4e3e\u679a\u4e3e $d$ \u7684\u500d\u6570\u3002\n\n\u7136\u540e\u6700\u5751\u4eba\u7684\u5730\u65b9\u6765\u4e86\u3002\u5f53\u65f6\u5728\u505a\u8fd9\u9053\u9898\uff0c\u53d1\u73b0\u76f4\u63a5\u7528\u516c\u5f0f\u6cd5\u7b97\u8981\u6c42\u9006\u5143\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\ln n \\log p)$\u3002\n\n@Walking_Dead \u5199\u4e86\u4e00\u53d1\u53ea\u6709 $10$ \u5206\uff0c\u4e8e\u662f\u5f88\u75db\u82e6\uff0c\u8ba4\u4e3a\u6b63\u89e3/$50$ \u5206\u4ee3\u7801\u5e94\u8be5\u662f $O(n \\log n)$ \u53ca\u4ee5\u4e0b\u7684\u3002\n\n\u5b9e\u9645\u4e0a\u6211\u4eec\u60f3\u8981\u4f18\u5316\u6389\u8fd9\u4e2a $O(\\log p)$\n\uff0c\u5e94\u8be5\u6362\u4e00\u79cd\u65b9\u5f0f\u6c42\u7b49\u6bd4\u6570\u5217\u548c\u3002\u53ef\u4ee5\u7528\u9012\u5f52\u5904\u7406\u3002\n\n\u7136\u540e\u5c31\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\ln n \\log n)$\uff0c\u6b3a\u8d1f\u7684\u5e94\u8be5\u662f\u6211\u8fd9\u79cd\u4e0d\u4f1a\u5947\u6deb\u6280\u5de7\u7684\u83dc\u9e21\u9009\u624b\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nLL mu[1500000+5],prime[1500000+5],cnt,n,p;\nbool vis[1500000+5];\nvoid shai(LL up)\n{\n\tmu[1]=1;\n\tfor(LL i=2;i<=up;++i)\n\t{\n\t\tif(!vis[i])\tprime[++cnt]=i,mu[i]=-1;\n\t\tfor(LL j=1;j<=cnt && i*prime[j]<=up;++j)\n\t\t{\n\t\t\tvis[i*prime[j]]=true;\n\t\t\tif(i%prime[j]==0)\n\t\t\t{\n\t\t\t\tmu[i*prime[j]]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i*prime[j]]=-mu[i];\n\t\t}\n\t}\n}\nLL QuickPow(LL x,LL pose,LL mod)\n{\n\tLL base=x,ans=1;\n\twhile(pose)\n\t{\n\t\tif(pose&1)\tans*=base,ans%=mod;\n\t\tbase*=base;\n\t\tbase%=mod;\n\t\tpose>>=1;\n\t}\n\treturn ans;\n}\nLL sum(LL now,LL up,LL mod)\n{\n\tif(up==1)\treturn now;\n\tif(up&1)\treturn ((1+QuickPow(now,up/2,mod))*sum(now,up/2,mod)%mod+QuickPow(now,up,mod))%mod;\n\treturn (1+QuickPow(now,up/2,mod))*sum(now,up/2,mod)%mod;\n}\nLL refuse(LL x){return x>0?x:(p+x);}\nint main(){\n\tshai(1500000);\n\tLL T;\n\tscanf(\"%lld\",&T);\n\twhile(T-->0)\n\t{\n\t\tscanf(\"%lld %lld\",&n,&p);\n\t\tLL ans=0;\n\t\tfor(LL i=1;i<=n;++i)\n\t\t{\n\t\t\tLL s=QuickPow(i,i,p),t=s;\n\t\t\tfor(LL j=1;j<=n/i;++j)\n\t\t\t{\n\t\t\t\tans+=refuse(mu[j])*sum(t,n/(i*j),p)%p*sum(t,n/(i*j),p)%p;\n\t\t\t\tans%=p;\n\t\t\t\tt*=s;\n\t\t\t\tt%=p;\n//\t\t\t\tprintf(\"%lld\\n\",ans);\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1599571432,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6825 \u3010\u300cEZEC-4\u300d\u6c42\u548c\u3011"
    },
    {
        "content": "\u7b80\u5355\u9898\uff0c\u4f46\u662f\u7279\u522b\u5361\u5e38\u3002\n\n\u524d\u7f6e\u829d\u58eb\uff1a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u3002\n\n\u7ed9\u5b9a $n$\u3002\n\n\u6c42\n$$\n\\sum_{i=1}^n\\sum_{j=1}^n \\gcd(i,j)^{i+j}\n$$\n\n\u8003\u8651\u5199\u6210\n$$\n\\sum_{i=1}^n\\sum_{j=1}^n \\gcd(i,j)^i\\gcd(i,j)^j\n$$\n\n\u8001\u5957\u8def\uff0c\u80af\u5b9a\u8981\u679a\u4e3e $\\gcd$\u3002\n\n$$\n\\sum_{d=1}^n \\sum_{i=1}^nd^i\\sum_{j=1}^nd^j[\\gcd(i,j)=d]\n$$\n\n$$\n\\sum_{d=1}^n \\sum_{i=1}^{\\frac{n}{d}}d^{id}\\sum_{j=1}^{\\frac{n}{d}}d^{jd}[\\gcd(i,j)=1]\n$$\n\n$$\n\\sum_{d=1}^n \\sum_{i=1}^{\\frac{n}{d}}d^{id}\\sum_{j=1}^{\\frac{n}{d}}d^{jd}[\\gcd(i,j)=1]\n$$\n\n$$\n\\sum_{d=1}^n \\sum_{i=1}^{\\frac{n}{d}}d^{id}\\sum_{j=1}^{\\frac{n}{d}}d^{jd}\\sum_{D|\\gcd(i,j)}\\mu(D)\n$$\n$$\n\\sum_{d=1}^n \\sum_{D=1}^{\\frac{n}{d}}\\mu(D)\\sum_{i=1}^{\\frac{n}{dD}}d^{idD}\\sum_{j=1}^{\\frac{n}{dD}}d^{jdD}\n$$\n\n$$\n\\sum_{d=1}^n \\sum_{D=1}^{\\frac{n}{d}}\\mu(D)(\\sum_{i=1}^{\\frac{n}{dD}}d^{idD})^2\n$$\n\n\uff08\u8fd9\u91cc\u53ef\u4ee5\u5199\u6210 $T=dD$ \u7684\u5f62\u5f0f\uff0c\u4f46\u662f\u56e0\u4e3a\u5e38\u6570\u592a\u5927\uff0c\u8fc7\u4e0d\u4e86\uff0c\u6240\u4ee5\u5c31\u4e0d\u7528\u6539\u5199\uff09\n\n\u53d1\u73b0\u540e\u9762\u8fd9\u4e00\u5768\u662f\u4e00\u4e2a\u4ee5\u9996\u9879\u4e3a $d^{dD}$ \u4e3a\u9996\u9879\uff0c\u516c\u6bd4\u4e3a $d^{dD}$ \u7684\u7b49\u6bd4\u6570\u5217\uff0c\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u7528\u7b49\u6bd4\u6570\u5217\u7684\u6c42\u548c\u516c\u5f0f\u6c42\u548c\u3002\n\n\u8fd9\u91cc\u6709\u4e24\u4e2a\u5b9e\u73b0\u65b9\u5f0f:\n\n1.\u516c\u5f0f\u6cd5\uff0c\u9700\u8981\u6c42\u9006\u5143\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O(\\log p)}$\uff0c\u4f1a\u6b7b\u5f97\u5f88\u60e8\u3002~~\uff08\u8fd9\u91cc\u5c0f\u58f0\u7684bb\u4e00\u53e5\uff0c\u4e0d\u77e5\u9053\u5361\u516c\u5f0f\u6cd5\u6709\u4ec0\u4e48\u610f\u4e49\uff0c\u800c\u4e14\u8fd8\u5361\u6210\u66b4\u529b\u5206\uff09~~\n\n2.\u9012\u5f52\u6cd5\uff0c\u76f4\u63a5\u9012\u5f52\u5206\u6cbb\u6c42\uff0c\u5c31\u4e0d\u9700\u8981\u6c42\u9006\u5143\u4e86\uff0c\u4e0d\u4f1a\u7684\u4e0a\u7f51\u641c\u4e00\u641c\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O(\\log n)}$\u3002\n\n\u4e8e\u662f\u73b0\u5728\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O(n\\ln n\\log n)}$\u3002\n\n\u4f46\u662f\uff0c\u8fd8\u6ca1\u5b8c\uff0c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u600e\u4e48\u5feb\u901f\u6c42 $d^{dD}$ \u8fd9\u4e2a\u9996\u9879\u554a\uff0c\u5982\u679c\u76f4\u63a5\u5feb\u901f\u5e42\u6c42\u65f6\u95f4\u590d\u6742\u5ea6\u53c8\u53d8\u6210\u4e86 $\\mathcal{O(n\\ln n\\log p)}$\uff0c\u8003\u8651\u6bcf\u6b21\u5148\u7b97\u51fa $d^{d}$ \uff0c\u7136\u540e\u6bcf\u7b97\u5b8c\u4e00\u6b21\u5c31\u8ba9\u9996\u9879\u4e58\u4ee5 $d^{d}$ \u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(n\\ln n\\log n)}$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <algorithm>\nusing namespace std;\n#define LL long long\n#define ll long long\n#define R register\nconst int MAXN = 1.5e6 + 5;\nbool vis[MAXN];\nint len, mu[MAXN], prime[MAXN], mod;\nint qkpow(int x, int power, int mod) {\n    int ans = 1;\n    for (; power; power >>= 1, x = 1ll * x * x % mod)\n        if (power & 1)\n            ans = 1ll * ans * x % mod;\n    return ans;\n}\nvoid Getmu() {\n    mu[1] = 1;\n    for (R int i = 2; i <= MAXN - 5; i++) {\n        if (!vis[i])\n            prime[++len] = i, mu[i] = -1;\n        for (R int j = 1; j <= len && i * prime[j] <= MAXN - 5; j++) {\n            vis[i * prime[j]] = 1;\n            if (i % prime[j] == 0) {\n                mu[i * prime[j]] = 0;\n                break;\n            }\n            mu[i * prime[j]] = -mu[i];\n        }\n    }\n}\nint pf(int x) { return 1ll * x * x % mod; }\nint PowSumMod(int a, int n, int m) {\n    if (n == 1)\n        return a;\n    if (n % 2 == 0)\n        return 1ll * (1 + qkpow(a, n / 2, m)) * PowSumMod(a, n / 2, m) % m;\n    return 1ll * (1ll * (1 + qkpow(a, (n - 1) / 2, m)) * PowSumMod(a, (n - 1) / 2, m) % m + qkpow(a, n, m)) %\n           m;\n}\nint S(int n, int d, int T, int x) { return PowSumMod(x, n / T, mod); }\nint calc(int n) {\n    int ans = 0;\n    for (R int i = 1; i <= n; i++) {\n        int now = qkpow(i, i, mod), Now;\n        Now = now;\n        for (R int j = 1; j <= n / i; j++) {\n            ans = 1ll * (ans + (1ll * pf(S(n, i, i * j, Now)) * mu[j])) % mod;\n            Now = 1ll * Now * now % mod;\n        }\n    }\n\n    return (ans + mod) % mod;\n}\nsigned main() {\n    Getmu();\n    int t, n;\n    scanf(\"%d\", &t);\n    while (t--) {\n        scanf(\"%d %d\", &n, &mod);\n        printf(\"%d\\n\", calc(n));\n    }\n    return 0;\n}\n```",
        "postTime": 1599540472,
        "uid": 154560,
        "name": "Silver187",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6825 \u3010\u300cEZEC-4\u300d\u6c42\u548c\u3011"
    }
]